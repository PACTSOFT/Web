(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{"/GLD":function(e,t,n){"use strict";n.r(t),n.d(t,"AddDenominationViewModel",(function(){return h}));var i=n("Do2H"),a=n("Lp6j"),s=n("ScVY"),o=n("8B8H"),l=n("0/4Q"),r=n("ockk");class h extends s.b{constructor(e,t=null){super(),this.GrdDenomination=new o.a,this.Currency=new l.e,this.ShowTitle=!1,this.SaveVisible=!0,this.Width=0,this.NumericPADView=null,this.TouchVisibility=!1,this.ActualFileName="",this.AliasFileName="",this.ActualFile="",this.FileDescription="",this.MainFilePath="",this.FilePath="",this.RelativeFileName="",this.FileExtension="",this.AttachmentID=0,this.CostCentrID=0,this.Module="ACC",this.PrevValue=null,this.ClassName="AddDenominationViewModel",this.CostCentrID=12,this.Parent=e,this.GrdDenomination.Columns=[],this.GrdDenomination.Table=[],this.GrdDenomination.TableColumns.push("SNO"),this.GrdDenomination.TableColumns.push("Imagefilepath"),this.GrdDenomination.TableColumns.push("Notes"),this.GrdDenomination.TableColumns.push("Change"),this.GrdDenomination.TableColumns.push("ImageFile"),this.GrdDenomination.TableColumns.push("ActualFileName"),this.GrdDenomination.TableColumns.push("FilePath"),this.GrdDenomination.TableColumns.push("RelativeFileName"),this.GrdDenomination.TableColumns.push("FileExtension"),this.GrdDenomination.TableColumns.push("GUID"),this.Currency.Label=i.a.GetResource("Currency_Title"),"AddCurrencyViewModel"==e.ClassName&&(this.GrdDenomination.CanUserAddRows=!0,this.GrdDenomination.CanUserDeleteRows=!0),this.GrdDenomination.OnLinkClick.Subscribe(this,"OnGridLinkClick"),this.GrdDenomination.OnCellEditEnding.Subscribe(this,"OnCellEndEdit"),this.GrdDenomination.OnBeginEdit.Subscribe(this,"OnBeginEdit");let n=new r.a;if(n.DataType="FLOAT",n.Header=i.a.GetResource("Sno"),n.DisplayMember="SNO",n.Width=50,n.ReadOnly=!0,this.GrdDenomination.Columns.push(n),n=new r.a,n.Header=i.a.GetResource("Image"),n.DisplayMember="Imagefilepath",n.DataType="IMAGE_BUTTON",n.Width=60,n.IsVisible=!0,n.ReadOnly=!0,this.GrdDenomination.Columns.push(n),n=new r.a,n.DataType="FLOAT",n.Header=i.a.GetResource("Notes"),n.DisplayMember="Notes",n.Width=150,this.GrdDenomination.Columns.push(n),this.GrdDenomination.Height=200,"POSPayModesViewModel"==this.Parent.ClassName&&null!=this.Parent.Selectedbtn&&"8"==this.Parent.Selectedbtn.SectionID&&(this.Currency.Visible=!1,this.AddDummyRows()),"AddCurrencyViewModel"!=e.ClassName&&(n.Width=65,this.SaveVisible=!1,"AddEditDocumentViewModel"==e.ClassName||"POSExitViewModel"==e.ClassName?(this.ShowTitle=!0,this.GrdDenomination.Width=""):"POSPayModesViewModel"==e.ClassName?(this.GrdDenomination.Height=200,this.GrdDenomination.Width="390"):"PostVoucherSaveViewModel"==e.ClassName&&(this.GrdDenomination.Width=""),"POSPayModesViewModel"==e.ClassName&&null!=e.Selectedbtn&&"8"==e.Selectedbtn.SectionID&&(n.Header=i.a.GetResource("Coupon_Amount"),n.Width=120),"POSPayModesViewModel"==e.ClassName&&null!=e.Selectedbtn&&"8"==e.Selectedbtn.SectionID||(n.ReadOnly=!0),n=new r.a,n.DataType="FLOAT",n.Header=i.a.GetResource("NotesTender"),n.DisplayMember="Notestender",n.Width=87,this.GrdDenomination.Columns.push(n),"POSPayModesViewModel"==e.ClassName&&null!=e.Selectedbtn&&"8"==e.Selectedbtn.SectionID&&(n.Header=i.a.GetResource("Quantity"),n.Width=100),this.GrdDenomination.TableColumns.push("Notestender")),"POSPayModesViewModel"==e.ClassName&&null!=e.Selectedbtn&&"8"==e.Selectedbtn.SectionID||(n=new r.a,n.DataType="FLOAT",n.Header=i.a.GetResource("CurrencyChange"),n.DisplayMember="Change",n.Width=100,this.GrdDenomination.Columns.push(n),"AddCurrencyViewModel"!=e.ClassName&&(n.Width=70,n.ReadOnly=!0,n=new r.a,n.DataType="FLOAT",n.Header=i.a.GetResource("ChangeTender"),n.DisplayMember="ChangeTender",n.Width=100,this.GrdDenomination.Columns.push(n),this.GrdDenomination.TableColumns.push("ChangeTender"))),n=new r.a,n.Header=i.a.GetResource("Com_Attachments_FileName"),n.DisplayMember="ActualFileName",n.DataType="LINK",n.Width=130,n.IsVisible="AddCurrencyViewModel"==e.ClassName,n.ReadOnly=!0,this.GrdDenomination.Columns.push(n),n=new r.a,n.Header=i.a.GetResource("Select_Image"),n.DisplayMember="ImageFile",n.DataType="LINK",n.Width=100,n.IsVisible="AddCurrencyViewModel"==e.ClassName,n.ReadOnly=!0,this.GrdDenomination.Columns.push(n),n=new r.a,n.Header=i.a.GetResource("FilePath"),n.DisplayMember="FilePath",n.DataType="string",n.Width=200,n.IsVisible=!1,n.ReadOnly=!0,this.GrdDenomination.Columns.push(n),n=new r.a,n.Header=i.a.GetResource("RelativeFileName"),n.DisplayMember="RelativeFileName",n.DataType="string",n.Width=200,n.IsVisible=!1,n.ReadOnly=!0,this.GrdDenomination.Columns.push(n),n=new r.a,n.Header=i.a.GetResource("FileExtension"),n.DisplayMember="FileExtension",n.DataType="string",n.Width=200,n.IsVisible=!1,n.ReadOnly=!0,this.GrdDenomination.Columns.push(n),n=new r.a,n.Header=i.a.GetResource("GUID"),n.DisplayMember="GUID",n.DataType="string",n.Width=50,n.IsVisible=!1,n.ReadOnly=!0,this.GrdDenomination.Columns.push(n),"AddCurrencyViewModel"==e.ClassName){this.Currency.Items.push(l.d.ComboBoxItems_2(e.CurrencyName,"1"));for(let t=0;t<e.DataTable.length;t++)a.e.IsEmpty(e.DataTable[t].Name)||this.Currency.Items.push(l.d.ComboBoxItems_2(e.DataTable[t].Name.toString(),e.DataTable[t].CurrencyID.toString()))}else{if("POSPayModesViewModel"!=e.ClassName||null==e.Selectedbtn||"8"!=e.Selectedbtn.SectionID){let t=[];t.push(0),t.push(i.a.SessionManager.UserID),t.push(i.a.SessionManager.LanguageID);let n=i.a.admin.GetCurrencies(t);if(null!=n&&n.Tables.length>0){var s=this.GrdDenomination.Columns.find(e=>"Imagefilepath"==e.DisplayMember);if(s&&s.IsVisible){let t=n.Tables[4].filter(e=>"ShowImage"==e.Name);if(t.length>0&&"TRUE"==t[0].Value.toString().toUpperCase()){let i=0;t=n.Tables[4].filter(e=>"ImageWidth"==e.Name),t.length>0&&(i=a.e.Double(t[0].Value)),i>10&&(s.Width=i,"POSPayModesViewModel"==e.ClassName&&(this.GrdDenomination.Width=""!=this.GrdDenomination.Width?(parseInt(this.GrdDenomination.Width)+i).toString():"")),i=0,t=n.Tables[4].filter(e=>"ImageHeight"==e.Name),t.length>0&&(i=a.e.Double(t[0].Value)),i>10&&(this.GrdDenomination.RowHeight=i)}else s.IsVisible=!1}if(null!=n&&n.Tables[0].length>0&&this.Currency.Items.push(l.d.ComboBoxItems_2(n.Tables[0][0].Name.toString(),n.Tables[0][0].CurrencyID.toString())),n&&n.Tables.length>1)for(let e=0;e<n.Tables[1].length;e++)this.Currency.Items.push(l.d.ComboBoxItems_2(n.Tables[1][e].Name.toString(),n.Tables[1][e].CurrencyID.toString()))}}if("POSPayModesViewModel"==e.ClassName&&""!=e.denominationxml){let t=new a.f;t.LoadXml("<PosPayModes>"+e.denominationxml+"</PosPayModes>");let n=t.SelectNodes("PosPayModes/XML");if(n.length>0&&null!=n[0].attributes.CurrencyID&&""!=n[0].attributes.CurrencyID.Value&&0!=parseInt(n[0].attributes.CurrencyID.Value))if("POSPayModesViewModel"==e.ClassName&&null!=e.Selectedbtn&&"8"==e.Selectedbtn.SectionID){let e=1;this.GrdDenomination.Clear();for(let t=0;t<n.length;t++){let i=n[t];if(null!=i.attributes.Notes&&""!=i.attributes.Notes.Value&&0!=parseInt(i.attributes.Notes.Value)&&null!=i.attributes.NotesTender&&""!=i.attributes.NotesTender.Value&&parseInt(i.attributes.NotesTender.Value)>0){let t=this.GrdDenomination.NewRow();t.SNO=e.toString(),t.Notes=i.attributes.Notes.Value,t.NotesTender=i.attributes.NotesTender.Value,this.GrdDenomination.addRow(t),e++}}this.AddDummyRows()}else{this.Currency.SelectedValue=n[0].attributes.CurrencyID.Value,this.OnSave("Currency");for(let e=0;e<n.length;e++){let t=n[e];if(null!=t.attributes.Notes&&""!=t.attributes.Notes.Value&&0!=parseInt(t.attributes.Notes.Value)&&null!=t.attributes.NotesTender&&""!=t.attributes.NotesTender.Value&&parseInt(t.attributes.NotesTender.Value)>0){let e=this.GrdDenomination.Table.filter(e=>e.Notes==t.attributes.Notes.Value);e.length>0&&(e[0].NotesTender=t.attributes.NotesTender.Value)}if(null!=t.attributes.Change&&""!=t.attributes.Change.Value&&0!=parseInt(t.attributes.Change.Value)&&null!=t.attributes.ChangeTender&&""!=t.attributes.ChangeTender.Value&&parseInt(t.attributes.ChangeTender.Value)>0){let e=this.GrdDenomination.Table.filter(e=>e.Change==t.attributes.Change.Value);e.length>0&&(e[0].ChangeTender=t.attributes.ChangeTender.Value)}}}this.GetTotal()}else if(!a.e.IsEmpty(t)){let e=new a.f;e.LoadXml("<PosPayModes>"+t+"</PosPayModes>");let n=e.SelectNodes("PosPayModes/XML");if(n.length>0&&null!=n[0].attributes.CurrencyID&&""!=n[0].attributes.CurrencyID.Value&&0!=parseInt(n[0].attributes.CurrencyID.Value)){this.Currency.SelectedValue=n[0].attributes.CurrencyID.Value,this.OnSave("Currency");for(let e=0;e<n.length;e++){let t=n[e];if(null!=t.attributes.Notes&&""!=t.attributes.Notes.Value&&0!=parseInt(t.attributes.Notes.Value)&&null!=t.attributes.NotesTender&&""!=t.attributes.NotesTender.Value&&parseInt(t.attributes.NotesTender.Value)>0){let e=this.GrdDenomination.Table.filter(e=>e.Notes==t.attributes.Notes.Value);e.length>0&&(e[0].NotesTender=t.attributes.NotesTender.Value)}if(null!=t.attributes.Change&&""!=t.attributes.Change.Value&&0!=parseInt(t.attributes.Change.Value)&&null!=t.attributes.ChangeTender&&""!=t.attributes.ChangeTender.Value&&0!=parseInt(t.attributes.ChangeTender.Value)){let e=this.GrdDenomination.Table.filter(e=>e.Change==t.attributes.Change.Value);e.length>0&&(e[0].ChangeTender=t.attributes.ChangeTender.Value)}}}this.GetTotal()}this.Currency.Visible&&a.e.IsEmpty(this.Currency.SelectedValue)&&(this.Currency.SelectedValue="1",this.OnSave("Currency")),this.GrdDenomination.refreshDataView()}}get Total(){return this._Total}set Total(e){e!=this._Total&&(this._Total=e,"PostVoucherSaveViewModel"==this.Parent.ClassName?this.Parent.Amount.Text=e:"POSPayModesViewModel"==this.Parent.ClassName&&(this.Parent.IsCashFC?this.Parent.FcAmt=e:this.Parent.Amount.Text=e))}OnGridLinkClick(e,t,n){"ImageFile"==t?this.onClick():"ActualFileName"==t?this.OpenImage():"Imagefilepath"==t&&(this.GrdDenomination.TableColumns.Contains("NotesTender")&&(e.NotesTender=null==e.NotesTender?1:parseInt(e.NotesTender)+1),"AddCurrencyViewModel"!=this.Parent.ClassName&&this.GetTotal())}onClick(){}OpenImage(){}OnCellEndEdit(e,t,n){"AddCurrencyViewModel"!=this.Parent.ClassName&&this.GetTotal()}OnBeginEdit(e,t,n){if("POSPayModesViewModel"==this.Parent.ClassName){let n=this.GrdDenomination.Columns.find(e=>!a.e.IsEmpty(e.DisplayMember)&&e.DisplayMember==t);null!=this.Parent.NumericPADView&&"FLOAT"==n.DataType.toUpperCase()&&(this.Parent.NumericPADView.DisplayMember=n.DisplayMember,""!=e[n.DisplayMember].toString()&&(this.Parent.NumericPADView.txt.Text=e[n.DisplayMember].toString()))}else if("PostVoucherSaveViewModel"==this.Parent.ClassName){let n=this.GrdDenomination.Columns.find(e=>!a.e.IsEmpty(e.DisplayMember)&&e.DisplayMember==t);null!=this.Parent.NumericPADView&&"FLOAT"==n.DataType.toUpperCase()&&(this.Parent.NumericPADView.DisplayMember=n.DisplayMember,""!=e[n.DisplayMember].toString()&&(this.Parent.NumericPADView.txt.Text=e[n.DisplayMember].toString()))}else{let n=this.GrdDenomination.Columns.find(e=>!a.e.IsEmpty(e.DisplayMember)&&e.DisplayMember==t);null!=this.NumericPADView&&"FLOAT"==n.DataType.toUpperCase()&&(this.NumericPADView.DisplayMember=n.DisplayMember,""!=e[n.DisplayMember].toString()&&(this.NumericPADView.txt.Text=e[n.DisplayMember].toString()))}return!1}GetTotal(){let e=0;for(let t=0;t<this.GrdDenomination.Table.length;t++)a.e.IsEmpty(this.GrdDenomination.Table[t].Notes)&&a.e.IsEmpty(this.GrdDenomination.Table[t].Change)||(a.e.IsEmpty(this.GrdDenomination.Table[t].Notes)||a.e.IsEmpty(this.GrdDenomination.Table[t].NotesTender)||(e+=parseFloat(this.GrdDenomination.Table[t].Notes)*parseFloat(this.GrdDenomination.Table[t].NotesTender)),a.e.IsEmpty(this.GrdDenomination.Table[t].Change)||a.e.IsEmpty(this.GrdDenomination.Table[t].ChangeTender)||(e+=parseFloat(this.GrdDenomination.Table[t].Change)*parseFloat(this.GrdDenomination.Table[t].ChangeTender)));return this.Total=e.ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount),e}AddDummyRows(){if("AddCurrencyViewModel"==this.Parent.ClassName)for(let e=this.GrdDenomination.Table.length;e<10;e++){let t=this.GrdDenomination.NewRow();t.SNO=(e+1).toString(),t.ImageFile=i.a.GetResource("Image"),this.GrdDenomination.addRow(t)}}OnSave(e){try{if("Currency"==e){if(this.PrevValue==this.Currency.SelectedValue&&this.GrdDenomination.Table.length>0)return;if(this.GrdDenomination.Table.Clear(),!a.e.IsEmpty(this.Currency.SelectedValue)){this.PrevValue=this.Currency.SelectedValue;let e=i.a.admin.GetDenominations(this.Currency.SelectedValue);for(let t=0;t<e.Tables[0].length;t++){let n=this.GrdDenomination.NewRow();n.SNO=(t+1).toString(),n.Notes=e.Tables[0][t].Notes.toString(),n.Change=e.Tables[0][t].Change.toString(),n.ImageFile=i.a.GetResource("Image"),n.ActualFileName=e.Tables[0][t].ActualFileName.toString(),n.FilePath=e.Tables[0][t].FilePath.toString(),n.RelativeFileName=e.Tables[0][t].RelativeFileName.toString(),n.FileExtension=e.Tables[0][t].FileExtension.toString(),n.GUID=e.Tables[0][t].GUID.toString(),n.Imagefilepath=a.e.GetPath(e.Tables[0][t].GUID.toString()+"."+e.Tables[0][t].FileExtension.toString()),this.GrdDenomination.addRow(n)}this.AddDummyRows(),this.GrdDenomination.refreshUI()}}else if("Save"==e)if("AddCurrencyViewModel"==this.Parent.ClassName){let e="",n="";e+="<XML>";for(let t=0;t<this.GrdDenomination.Table.length;t++)a.e.IsEmpty(this.GrdDenomination.Table[t].Notes)&&a.e.IsEmpty(this.GrdDenomination.Table[t].Change)||(a.e.IsEmpty(this.GrdDenomination.Table[t].Notes)?e+='<Row Notes="0"  Change="':e+='<Row Notes="'+this.GrdDenomination.Table[t].Notes.toString()+'"  Change="',a.e.IsEmpty(this.GrdDenomination.Table[t].Change)?e+='0" />':e+=this.GrdDenomination.Table[t].Change.toString()+'" />');e+="</XML>";let s=a.e.NewGuid();n+="<AttachmentXML>";for(let i=0;i<this.GrdDenomination.Table.length;i++)if(!a.e.IsEmpty(this.GrdDenomination.Table[i].Notes)||!a.e.IsEmpty(this.GrdDenomination.Table[i].Change)){try{s="",a.e.IsEmpty(this.GrdDenomination.Table[i].RelativeFileName)||Logger.InfoLog("AddAttachmentViewModel::Exiting file upload")}catch(t){}a.e.IsEmpty(this.GrdDenomination.Table[i].Notes)?n+='<Row Notes="0"  Change="':n+='<Row Notes="'+this.GrdDenomination.Table[i].Notes.toString()+'"  Change="',a.e.IsEmpty(this.GrdDenomination.Table[i].Change)||(n+=this.GrdDenomination.Table[i].Change.toString()),n+='"  FilePath="'+this.GrdDenomination.Table[i].FilePath.toString(),n+='"  ActualFileName="'+this.GrdDenomination.Table[i].ActualFileName.toString(),n+='"  RelativeFileName="'+this.GrdDenomination.Table[i].RelativeFileName.toString(),n+='"  FileExtension="'+this.GrdDenomination.Table[i].FileExtension.toString(),n+='"  IsProductImage="1',n+='"  AllowInPrint="1',n+='"  FeatureID="'+this.CostCentrID,n+='"  CostCenterID="'+this.CostCentrID,n+='"  FeaturePK="'+this.Currency.SelectedValue,n+='"  IsDefaultImage="1',n+='"  RowSeqNo="0',""==s.toString()?(s=a.e.NewGuid(),n+='"  GUID="'+s):n+='"  GUID="'+s,n+='" />'}n+="</AttachmentXML>";let o=i.a.admin.SaveDenominations(this.Currency.SelectedValue,e.toString(),n.toString());this.DisplayMessage=o.Message,alert(o.Message)}else"POSPayModesViewModel"==this.Parent.ClassName?this.Parent.Amount.Text=this.GetTotal().toString():"POSExitViewModel"==this.Parent.ClassName?null!=this.Parent.ExitGrid.SelectedItem?this.Parent.AddDenom():i.a.page.HideDialog():"AddEditDocumentViewModel"==this.Parent.ClassName&&(null!=this.Parent.SelectedRow&&(this.Parent.SelectedRow.DenominationsXML=this.GetXML()),i.a.page.HideDialog());else"Cancel"==e&&("AddEditDocumentViewModel"==this.Parent.ClassName&&null==this.Parent.SelectedRow&&(this.Parent.DialogResult=!1),i.a.page.HideDialog())}catch(t){Logger.ErrorLog("AddCurrencyViewModel:: OnCurrencyDenomination"+t.stack)}}GetXML(){let e="";for(let t=0;t<this.GrdDenomination.Table.length;t++)(!a.e.IsEmpty(this.GrdDenomination.Table[t].Notes)&&!a.e.IsEmpty(this.GrdDenomination.Table[t].NotesTender)&&parseInt(this.GrdDenomination.Table[t].NotesTender)>0||!a.e.IsEmpty(this.GrdDenomination.Table[t].Change&&0!=parseFloat(this.GrdDenomination.Table[t].Change)&&parseInt(this.GrdDenomination.Table[t].ChangeTender)>0))&&(e+='<XML IsDenom="1" ',e+="POSPayModesViewModel"==this.Parent.ClassName&&null!=this.Parent.Selectedbtn&&"8"==this.Parent.Selectedbtn.SectionID?' CurrencyID="-10"':' CurrencyID="'+this.Currency.SelectedValue+'"',!a.e.IsEmpty(this.GrdDenomination.Table[t].Notes)&&!a.e.IsEmpty(this.GrdDenomination.Table[t].NotesTender)&&parseFloat(this.GrdDenomination.Table[t].Notes)>0&&parseFloat(this.GrdDenomination.Table[t].NotesTender)>0?(e+=' Notes="'+this.GrdDenomination.Table[t].Notes.toString()+'"  NotesTender="',e+=this.GrdDenomination.Table[t].NotesTender.toString()+'"  Change="'):e+=' Notes="0" NotesTender="0" Change="',!a.e.IsEmpty(this.GrdDenomination.Table[t].Change)&&!a.e.IsEmpty(this.GrdDenomination.Table[t].ChangeTender)&&parseFloat(this.GrdDenomination.Table[t].Change)>0&&parseFloat(this.GrdDenomination.Table[t].ChangeTender)>0?e+=this.GrdDenomination.Table[t].Change+'" ChangeTender="'+this.GrdDenomination.Table[t].ChangeTender+'" />':e+='0" ChangeTender="0" />');return e.toString()}static CheckImprest(e,t,n){if(n.Contains("NoData"))return!0;let i=t.filter(e=>e.NotesTender>0&&e.Notes>0).sort((e,t)=>t.Notes-e.Notes),a=e.filter(e=>1==e.Type).sort((e,t)=>t.Denom-e.Denom);if(i.length!=a.length)return!1;for(let l=0;l<i.length;l++)if(parseFloat(i[l].Notes)!=parseFloat(a[l].Denom)||parseInt(i[l].NotesTender)!=parseInt(a[l].Tender))return!1;let s=t.filter(e=>e.ChangeTender>0&&e.Change>0).sort((e,t)=>t.Change-e.Change),o=e.filter(e=>2==e.Type).sort((e,t)=>t.Denom-e.Denom);if(s.length!=o.length)return!1;for(let l=0;l<s.length;l++)if(parseFloat(s[l].Change)!=parseFloat(o[l].Denom)||parseInt(s[l].ChangeTender)!=parseInt(o[l].Tender))return!1;return!0}}}}]);
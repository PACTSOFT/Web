function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var a,i=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;a=Reflect.construct(i,arguments,n)}else a=i.apply(this,arguments);return _possibleConstructorReturn(this,a)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[116],{k7Da:function(e,t,a){"use strict";a.r(t),a.d(t,"DeletedRecords",(function(){return T})),a.d(t,"AddCurrencyViewModel",(function(){return S}));var i=a("Do2H"),n=a("Lp6j"),s=a("4HhE"),r=a("ockk"),l=a("NkMH"),o=a("n56n"),h=a("0/4Q"),c=a("ScVY"),u=a("4ADR"),D=a("8B8H"),b=a("/GLD"),g=a("JIg3"),C=function(e){_inherits(a,e);var t=_createSuper(a);function a(e){var i;return _classCallCheck(this,a),(i=t.call(this)).SaveNote=new s.b,i.Enable=!1,i.NoteID=0,i.NoteText="",i.CurrencyTypes=[],i.Index=0,i.ClassName="AddExchViewModel",Logger.InfoLog("AddExchViewModel::Entering AddExchViewModel with Parent="+e),i.Parent=e,i.CurrencyTypes=[],i.SaveNote.Subscribe(_assertThisInitialized(i),"OnSaveExchRate","onCanSaveOnSaveExchRate"),i.ExchDate=new g.a(0),i.ExchDate.Date=Date.Today(),i.ExchDate.Label="Date",i.ExchDate.DBColumnName="ExchDate",Logger.InfoLog("AddExchViewModel::Exiting AddExchViewModel"),i}return _createClass(a,[{key:"OnSaveExchRate",value:function(e){if(null!=e&&"Cancel"==e.toString());else{if(Logger.InfoLog("AddExchViewModel::Entering OnSaveExchRate"),null==this.SelectedItem)return void alert("Please set Daily exchange rate for this currency");if(0==this.ExchRate.Trim().length||null==this.SelectedItem.Name||""==this.SelectedItem.Name)return;if(!this.Parent.ViewExhangeRates.ExchList.Contains(this)){for(var t=0,a=0;a<this.Parent.ViewExhangeRates.ExchList.length;a++)if(!n.e.IsEmpty(this.Parent.ViewExhangeRates.ExchList[a].SelectedItem)&&!n.e.IsEmpty(this.Parent.ViewExhangeRates.ExchList[a].ExchDate)&&this.Parent.ViewExhangeRates.ExchList[a].SelectedItem.Name==this.SelectedItem.Name&&this.Parent.ViewExhangeRates.ExchList[a].ExchDate.Date==this.ExchDate.Date&&(t++,this.Index=a,!confirm("Exchange rate already exists for this date, do you want to overwrite?")))return;if(0==t){this.Parent.ViewExhangeRates.ExchList.push(this),this.Parent.ViewExhangeRates.ExchListDataTable.addEmptyRow();var s=this.Parent.ViewExhangeRates.ExchListDataTable.Table.length-1;this.Parent.ViewExhangeRates.ExchListDataTable.Table[s].Sno=s+1,this.Parent.ViewExhangeRates.ExchListDataTable.Table[s].SelectedCurrencyType=this.SelectedCurrencyType,this.Parent.ViewExhangeRates.ExchListDataTable.Table[s].Name=this.SelectedItem.Name,this.Parent.ViewExhangeRates.ExchListDataTable.Table[s].Text=this.ExchDate.Date,this.Parent.ViewExhangeRates.ExchListDataTable.Table[s].ExchDate=this.ExchDate.Date.ToString(i.a.SessionManager.Preferences["Date Format"]),this.Parent.ViewExhangeRates.ExchListDataTable.Table[s].ExchRate=this.ExchRate,this.Parent.ViewExhangeRates.ExchListDataTable.updateRow(this.Parent.ViewExhangeRates.ExchListDataTable.Table[s])}var r=this.Parent.Exch.SelectedCurrencyType;this.Parent.OnAddExchangeRate(),this.Parent.Exch.SelectedCurrencyType=r,Logger.InfoLog("AddExchViewModel::Exiting OnSaveExchRate")}}}},{key:"onCanSaveOnSaveExchRate",value:function(e){return!0}},{key:"OnDeleteCallBack",value:function(){this.Parent.ViewExhangeRates.ExchList.RemoveAt(this.Index),this.Parent.ViewExhangeRates.ExchList.push(this),this.Parent.ViewExhangeRates.ExchListDataTable.Table.RemoveAt(this.Index),this.Parent.ViewExhangeRates.ExchListDataTable.addEmptyRow();var e=this.Parent.ViewExhangeRates.ExchListDataTable.Table.length-1;this.Parent.ViewExhangeRates.ExchListDataTable.Table[e].SelectedCurrencyType=this.SelectedCurrencyType,this.Parent.ViewExhangeRates.ExchListDataTable.Table[e].Name=this.SelectedItem.Name,this.Parent.ViewExhangeRates.ExchListDataTable.Table[e].Text=new Date(this.ExchDate.Date),this.Parent.ViewExhangeRates.ExchListDataTable.Table[e].ExchDate=new Date(this.ExchDate.Date).ToString(i.a.SessionManager.Preferences["Date Format"]),this.Parent.ViewExhangeRates.ExchListDataTable.Table[e].ExchRate=this.ExchRate}}]),a}(c.b),d=a("EQd/"),y=function(e){_inherits(a,e);var t=_createSuper(a);function a(e){var n,o;_classCallCheck(this,a),(n=t.call(this)).ColumnSpan="4",n.SelectionChangedCommandAssign=new s.b,n.Currency=[],n.FromDate=new g.a(0),n.Todate=new g.a(0),n.contextVisible=!0,n.ShowNewExchange=new s.b,n.ButtonClick=new s.b,n.ExchListDataTable=new D.a,n.ExchList=[],n.ColumnSource=new Array,n.DeletedNotes=[],n.ButtonAdd=new l.a,n.ButtonUpdate=new l.a,n.ButtonDelete=new l.a,n.Module="ACC",n.cmnItem_Click=new s.b,n.ClassName="ViewExchangeRateViewModel",Logger.InfoLog("ViewExchangeRateViewModel::Entering ViewExchangeRateViewModel with Parent="+e),n.Parent=e,n.FromDate.Label=i.a.GetResource("Calender_FromDate"),n.Todate.Label=i.a.GetResource("Calender_ToDate"),n.SelectionChangedCommandAssign.Subscribe(_assertThisInitialized(n),"onSelectionChangedAssign"),n.Currency=[],n.ButtonUpdate.Visible||n.ButtonDelete.Visible||(n.contextVisible=!1),n.cmnItem_Click.Subscribe(_assertThisInitialized(n),"OnCmnItem_Click","onCanCmnItem_Click"),n.ShowNewExchange.Subscribe(_assertThisInitialized(n),"OnShowNewExchange"),n.ButtonClick.Subscribe(_assertThisInitialized(n),"OnButtonClick"),n.ExchListDataTable.Table=[],n.ExchListDataTable.TableColumns.push("Sno"),n.ExchListDataTable.TableColumns.push("SelectedCurrencyType"),n.ExchListDataTable.TableColumns.push("Name"),n.ExchListDataTable.TableColumns.push("Text"),n.ExchListDataTable.DataTypes.Date.push("Text"),n.ExchListDataTable.TableColumns.push("ExchDate"),n.ExchListDataTable.TableColumns.push("ExchRate"),(o=new r.a).Header=i.a.GetResource("Currency_CurrencyName"),o.DisplayMember="Name",o.DataType="TextBlock",o.ReadOnly=!0,o.Width=250,n.ColumnSource.push(o),(o=new r.a).Header=i.a.GetResource("Exch_Date"),o.DisplayMember="ExchDate",o.ReadOnly=!0,o.DataType="TextBlock",o.Width=250,n.ColumnSource.push(o),(o=new r.a).Header=i.a.GetResource("Currency_ExchangeRate"),o.DisplayMember="ExchRate",o.DataType="TextBlock",o.Width=250,o.ReadOnly=!0,n.ColumnSource.push(o),n.ExchListDataTable.Columns=n.ColumnSource,n.ExchListDataTable.ContextMenuClickSubject.subscribe((function(e){n.OnCmnItem_Click(e.item.Tag)})),n.ExchListDataTable.ContextMenu.Items=[];var h=new r.b;return h.Header="EDIT",h.Tag="EDIT",h.Visibility=!0,n.ExchListDataTable.ContextMenu.Items.push(h),(h=new r.b).Header="DELETE",h.Tag="DELETE",h.Visibility=!0,n.ExchListDataTable.ContextMenu.Items.push(h),Logger.InfoLog("ViewExchangeRateViewModel::Exiting ViewExchangeRateViewModel "),n}return _createClass(a,[{key:"onSelectionChangedAssign",value:function(e){for(var t=0;t<this.ExchList.length;t++)this.ExchListDataTable.addEmptyRow(),this.ExchListDataTable.Table[t].SelectedCurrencyType=this.ExchList[t].SelectedCurrencyType,this.ExchListDataTable.Table[t].Name=this.ExchList[t].SelectedItem.Name,this.ExchListDataTable.Table[t].Text=this.ExchList[t].ExchDate.Date,this.ExchListDataTable.Table[t].ExchDate=this.ExchList[t].ExchDate.Date.ToString(i.a.SessionManager.Preferences["Date Format"]),this.ExchListDataTable.Table[t].ExchRate=this.ExchList[t].ExchRate}},{key:"OnCmnItem_Click",value:function(e){Logger.InfoLog("ViewExchangeRateViewModel::Entering OnCmnItem_Click with Command="+e),this.SelectedNote=null;var t=this.angularGrid.slickGrid.getSelectedRows();if(t.length>0){switch(this.SelectedNote=this.ExchListDataTable.Table[t[0]],e){case"EDIT":null!=this.SelectedNote&&(this.Parent.ExchangeVisibility=!0,this.Parent.Exch.SelectedCurrencyType=this.SelectedNote[this.ExchListDataTable.TableColumns[1]],n.e.isValidDate(this.SelectedNote[this.ExchListDataTable.TableColumns[3]])&&(this.Parent.Exch.ExchDate.Date=new Date(this.SelectedNote[this.ExchListDataTable.TableColumns[3]])),this.Parent.Exch.ExchRate=this.SelectedNote[this.ExchListDataTable.TableColumns[5]]);break;case"DELETE":null!=this.SelectedNote&&(this.ExchListDataTable.removeRow(this.SelectedNote),this.angularGrid.gridService.deleteItem(this.SelectedNote))}Logger.InfoLog("ViewExchangeRateViewModel::Exiting OnCmnItem_Click")}}},{key:"onCanCmnItem_Click",value:function(e){return!0}},{key:"GetXML",value:function(){Logger.InfoLog("ViewExchangeRateViewModel::Entering GetXML");for(var e="",t=0;t<this.ExchList.length;t++)null!=this.ExchList[t].SelectedItem&&(e+='<Row Action="NEW"',e+=' CurrencyID="'+this.ExchList[t].SelectedCurrencyType+'"',e+=' Currency="'+d.d.GetValidXml(this.ExchList[t].SelectedItem.Name)+'"',e+=' ExchDate="'+new Date(d.d.GetValidXml(this.ExchList[t].ExchDate.Date.toString())).ToString("dd/MMM/yyyy")+'"',e+=' ExchRate="'+d.d.GetValidXml(this.ExchList[t].ExchRate)+'"',e+="/>");for(var a=0;a<this.DeletedNotes.length;a++)e+='<Row Action="DELETE"',e+=' CurrencyID="'+this.DeletedNotes[a].SelectedCurrencyType+'"/>';return e.length>0&&(e="<ExchXML>"+e+"</ExchXML>"),Logger.InfoLog("ViewExchangeRateViewModel::Exiting GetXML which returns XML="+e),e.Replace("&","&amp;"),e.toString()}},{key:"OnShowNewExchange",value:function(e){Logger.InfoLog("ViewExhangeRateViewModel::Entering OnShowNewExchange");try{this.ButtonAdd.Enable&&this.ButtonAdd.Visible&&(this.Parent.Exch=new C(this.Parent),this.Parent.ExchangeVisibility=!0,this.Parent.OnShowExchangeRate()),Logger.InfoLog("ViewExhangeRateViewModel::Exiting OnShowNewExchange")}catch(t){Logger.ErrorLog("AddProductViewModel:: OnShowNewExchange"+t.stack)}}},{key:"OnButtonClick",value:function(e){var t=this;"Refresh"==e&&(this.ExchListDataTable.Table=this.Parent.DataTable.length>this.Parent.SelectedNode?this.ExchListDataTable.Table.filter((function(e){return e.SelectedCurrencyType==t.Parent.DataTable[t.Parent.SelectedNode].CurrencyID.toString()&&e.Text>=t.FromDate.Date&&e.Text<=t.Todate.Date})):[])}},{key:"Animate",value:function(){}},{key:"LoadExchRates",value:function(e){var t=this;Logger.InfoLog("ViewExchangeRateViewModel::Entering LoadExchRates with TableData="+e),this.ExchListDataTable.Clear(),this.ExchList.Clear();for(var a=function(a){if("0"==n.e.StringValue(e[a].ED))return"continue";var s=new C(t.Parent);null!=(r=t.Parent.Exch.CurrencyTypes.find((function(t){return t.Name==e[a].Name.toString()})))&&(s.SelectedItem=r),s.NoteID=a+1,s.SelectedCurrencyType=e[a].CurrencyID.toString(),s.ExchDate.Date=new Date(e[a].ExchangeDate.toString().split(" ")[0]),s.ExchDate.Text=new Date(e[a].ExchangeDate).ToString(i.a.SessionManager.Preferences["Date Format"]),s.ExchRate=e[a].ExchangeRate.toString(),t.ExchList.push(s);var l=t.ExchListDataTable.NewRow();l.Sno=a+1,l.SelectedCurrencyType=e[a].CurrencyID.toString(),l.Name=e[a].Name.toString(),l.Text=new Date(e[a].ExchangeDate),l.ExchDate=new Date(e[a].ExchangeDate).ToString(i.a.SessionManager.Preferences["Date Format"]),l.ExchRate=e[a].ExchangeRate.toString(),t.ExchListDataTable.addRow(l)},s=0;s<e.length;s++){var r;a(s)}Logger.InfoLog("ViewExchangeRateViewModel::Exiting LoadExchRates")}},{key:"OnDeleteCallBack",value:function(){null!=this.SelectedNote&&null!=this.SelectedNote[0]&&""!=this.SelectedNote[0].toString()&&parseInt(this.SelectedNote[0].toString())>0&&(this.id=parseInt(this.SelectedNote[0].toString()),this.DeletedNotes.push(this.ExchList[this.id-1])),this.ExchList.length>=this.id&&(this.ExchList.RemoveAt(this.id-1),this.ExchListDataTable.Table.RemoveAt(this.id-1))}},{key:"angularGrid",get:function(){return this.ExchListDataTable.angularGrid}}]),a}(c.b),m=a("VxiT"),T=function e(t){_classCallCheck(this,e),this.iSeqno=0,this.iSeqno=t},S=function(e){_inherits(a,e);var t=_createSuper(a);function a(){var e;_classCallCheck(this,a),(e=t.call(this)).CustomTab=new u.a,e.TabIndex=new u.b,e.SelectedItem=new s.b,e.lstDeletedRecords=[],e.CurrencyTypes=[],e.Currency=[],e.CurrencyCombo=new h.e,e.Dim=new o.b(0),e._GUID="",e.DataTableObj=new D.a,e.ButtonAdd=new l.a,e.ButtonUpdate=new l.a,e.ButtonDelete=new l.a,e._NumericColumnSource=[],e.DynamicCommand=new s.b,e.SaveCurrency=new s.b,e.RowDelete=new s.b,e.cmnItem_Click=new s.b,e.ExTable=[],e.CurrLookup=null,e.Module="ACC",e.SNO=1,e.PACTControlData=[],e.ClassName="AddCurrencyViewModel",e.lblExchangeRate=i.a.GetResource("Currency_ExchangeRate"),e.lblDecimals=i.a.GetResource("Currency_Decimals"),e.lblIsBaseCurrency=i.a.GetResource("Currency_IsBaseCurrency"),e.lblTitle=i.a.GetResource("Currency_Title"),e.lblHeader=i.a.GetResource("Currency_GroupHeader"),Logger.InfoLog("AddCurrencyViewModel::Entering AddCurrencyViewModel"),e.DataTableObj.CellEditEnding.Subscribe(_assertThisInitialized(e),"OnCellEditEnding"),e.DataTableObj.BeginEdit.Subscribe(_assertThisInitialized(e),"onBeginEdit"),e.SelectedItem.Subscribe(_assertThisInitialized(e),"OnSelectedItem"),e.ViewExhangeRates=new y(_assertThisInitialized(e)),e.Exch=new C(_assertThisInitialized(e)),i.a.SessionManager.HideUnathorizedAccess?e.ButtonAdd.Visible=i.a.SessionManager.IsActionAssigned(12,"Create"):e.ButtonAdd.Enable=i.a.SessionManager.IsActionAssigned(12,"Create"),i.a.SessionManager.HideUnathorizedAccess?e.ButtonUpdate.Visible=i.a.SessionManager.IsActionAssigned(12,"Update"):e.ButtonUpdate.Enable=i.a.SessionManager.IsActionAssigned(12,"Update"),i.a.SessionManager.HideUnathorizedAccess?e.ButtonDelete.Visible=i.a.SessionManager.IsActionAssigned(12,"Delete"):e.ButtonDelete.Enable=i.a.SessionManager.IsActionAssigned(12,"Delete"),e._ScreenID="12",e.PactScreenID="12",e.worker_DoWork(null,null),e.worker_RunWorkerCompleted(null,null),e.BuildGridData(),e.BindCurrencies(1),e.MessageVisibility=!1,e.DisplayMessage="Currency",e._ScreenID="12",e.PactScreenID="12",e.DataTableObj.TableNewRow.Subscribe(_assertThisInitialized(e),"onAddRow"),e.DataTableObj.RowDeleted.Subscribe(_assertThisInitialized(e),"onDeleteRow"),e.cmnItem_Click.Subscribe(_assertThisInitialized(e),"OnCmnItem_Click"),e.SaveCurrency.Subscribe(_assertThisInitialized(e),"OnSaveCurrency, onCanSaveCurrency"),e.AddTabDetails(),e.CurrencyTypes=e.Exch.CurrencyTypes,e.Currency=e.ViewExhangeRates.Currency,e.ExchangeVisibility=!0,e.DataTable.length>0&&""!=e.DataTable[0].CurrencyID.toString()&&(e.SelectedNode=0,e.ViewExhangeRates.SelectedCurrencyText=e.DataTable[0].Name.toString(),e.ViewExhangeRates.ExchListDataTable.Table=e.ViewExhangeRates.ExchListDataTable.Table.filter((function(t){return t.SelectedCurrencyType==e.DataTable[0].CurrencyID.toString()&&t.Text>=e.ViewExhangeRates.FromDate.Date.ToString("dd MMM yyyy")&&t.Text<=e.ViewExhangeRates.Todate.Date.ToString("dd MMM yyyy")})));var r;return(r=n.e.IntTryParse(i.a.SessionManager.Preferences.DimensionwiseCurrency))>5e4?(e.Dim.Visible=!0,e.Dim.CCID=r,e.Dim.TypeID=1,e.Dim.OnPactListBoxValueChanged.Subscribe(_assertThisInitialized(e),"OnvalueChanged")):e.Dim.Visible=!1,e.CurrencyCombo.SelectionChangedCommand.Subscribe(_assertThisInitialized(e),"OnCurrencyComboChange"),Logger.InfoLog("AddCurrencyViewModel::Exiting AddCurrencyViewModel"),e}return _createClass(a,[{key:"OnCmnItem_Click",value:function(e){Logger.InfoLog("AddCurrencyViewModel::Entering OnCmnItem_Click"),this.DataTable.length<1&&(this.DisplayMessage=i.a.GetResource("Cur_NO"),this.MessageVisibility=!0);var t=null,a=this.angularGrid.slickGrid.getSelectedRows();if(a.length>0){if(t=this.DataTable[a[0]],this.SelectedNode<this.DataTable.length)switch(e){case"DELETE":this.DataTableObj.removeRow(t),this.angularGrid.gridService.deleteItem(t)}Logger.InfoLog("AddCurrencyViewModel::Exiting OnCmnItem_Click")}}},{key:"onCanCmnItem_Click",value:function(e){return!0}},{key:"OnCurrencyComboChange",value:function(e){if(null!=this.CurrLookup)if(n.e.IsEmpty(e))this.Symbol="",this.Change="";else{var t=this.CurrLookup.filter((function(t){return t.Name==e.SelectedValue}));t.length>0?(this.Symbol=t[0].Code.toString(),this.Change=t[0].Change.toString()):(this.Symbol="",this.Change="")}}},{key:"OnvalueChanged",value:function(e){this.DisplayMessage="",this.MessageVisibility=!1,this.Dim.SelectedValue>0?this.BindCurrencies(this.Dim.SelectedValue):(this.DataTableObj.Clear(),this._CurrencyID=0,this.BaseCurr=0,this.CurrencyName="",this.Symbol="",this.Change="",this.ExTable.Rows.Clear())}},{key:"AddCurrencyDetails",value:function(){this.ViewExhangeRates.Currency.Clear(),this.ViewExhangeRates.Currency.push(h.d.ComboBoxItems_2("All","-100")),this.Exch.CurrencyTypes.Clear();for(var e=0;e<this.DataTable.length;e++)null!=this.DataTable[e].IsDailyRates&&""!=this.DataTable[e].IsDailyRates.toString()&&"true"==this.DataTable[e].IsDailyRates.toString().toLowerCase()&&(this.Exch.CurrencyTypes.push(h.d.ComboBoxItems_2(this.DataTable[e].Name.toString(),this.DataTable[e].CurrencyID.toString())),this.ViewExhangeRates.Currency.push(h.d.ComboBoxItems_2(this.DataTable[e].Name.toString(),this.DataTable[e].CurrencyID.toString())))}},{key:"OnSelectedItem",value:function(e){var t=this;try{if("DataGridComboBoxColumn"==e.column.className)return;if(null!=e.item){var a=e.item;this.Exch.SelectedCurrencyType=a.CurrencyID.toString(),n.e.IsEmpty(a.CurrencyID)||(this.ViewExhangeRates.ExchListDataTable.Table=this.ViewExhangeRates.ExchListDataTable.Table.filter((function(e){return e.SelectedCurrencyType==parseInt(a.CurrencyID)&&e.Text>=t.ViewExhangeRates.FromDate.Date.ToString("dd MMM yyyy")&&e.Text<=t.ViewExhangeRates.Todate.Date.ToString("dd MMM yyyy")})))}}catch(i){}}},{key:"OnCellEditEnding",value:function(e){var t=e.item;if(null!=t&&"StatusID"==e.column.field)null!=t.IsDailyRates&&""!=t.IsDailyRates.toString()&&"true"==t.IsDailyRates.toString().toLowerCase()&&(0==this.Exch.CurrencyTypes.filter((function(e){return e.Name==t.Name.toString()})).length&&(""!=t.CurrencyID.toString()?(this.Exch.CurrencyTypes=[],this.Exch.CurrencyTypes.push(h.d.ComboBoxItems_2(t.Name.toString(),t.CurrencyID.toString())),this.Exch.SelectedCurrencyType=t.CurrencyID.toString(),this.Exch.SelectedItem=this.Exch.CurrencyTypes.find((function(e){return e.Value==t.CurrencyID}))):(t.CurrencyID=0==this.Exch.CurrencyTypes.length?-1:parseInt(2)-1,this.Exch.CurrencyTypes=[],this.Exch.CurrencyTypes.push(h.d.ComboBoxItems_2(t.Name.toString(),t.CurrencyID.toString())),this.Exch.SelectedCurrencyType=t.CurrencyID.toString(),this.Exch.SelectedItem=this.Exch.CurrencyTypes.find((function(e){return e.Value==t.CurrencyID})))),0==this.ViewExhangeRates.Currency.filter((function(e){return e.Name==t.Name.toString()})).length&&this.ViewExhangeRates.Currency.push(h.d.ComboBoxItems_2(t.Name.toString(),t.CurrencyID.toString())));else if(null!=t&&"Symbol"==e.column.field){for(var a=0,i=0;i<this.DataTable.length;i++)n.e.IsEmpty(this.DataTable[i].Name)||this.DataTable[i].Name.toString().toLowerCase()==t.Name.toString().toLowerCase()&&a++;if(a>1&&(this.DisplayMessage="Duplicate Currency Name",t.Name=""),""!=t.Name.toString()){t.IsDailyRates="False",t.StatusID="True";var s=this.DataTable.Compute("max","CurrencyID");null!=s&&null!=s&&(t.CurrencyID=parseInt(s)+1)}else t.IsDailyRates="",t.StatusID="";if(this.CurrencyCombo.Visible)if(""!=n.e.String(t.Name)){var r=this.CurrLookup.filter((function(e){return e.Name==t.Name.toString()}));r.length>0?(t.Symbol=n.e.String(r[0].Code),t.Change=n.e.String(r[0].Change)):(t.Symbol="",t.Change="")}else t.Symbol="",t.Change="";this.DataTableObj.updateRow(t)}else if(null!=t&&"Change"==e.column.field){for(var l=0,o=0;o<this.DataTable.length;o++)n.e.IsEmpty(this.DataTable[o].Symbol)||this.DataTable[o].Symbol.toString().toLowerCase()==t.Symbol.toString().toLowerCase()&&l++;l>1&&(this.DisplayMessage="Duplicate Currency Symbol",t.Symbol="")}else if(null!=t&&"Decimals"==e.column.field){n.e.DoubleTryParse(t.ExchangeRate.toString())<=0&&(this.DisplayMessage="Invalid Exchange Rate")}else if(null!=t&&"IsDailyRates"==e.column.field){n.e.DoubleTryParse(t.Decimals.toString())<=0&&(this.DisplayMessage="Invalid Decimals"),""!=t.CurrencyID.toString()&&(this.Exch.CurrencyTypes=[],this.Exch.CurrencyTypes.push(h.d.ComboBoxItems_2(t.Name.toString(),t.CurrencyID.toString())),this.Exch.SelectedCurrencyType=t.CurrencyID.toString(),this.Exch.SelectedItem=this.Exch.CurrencyTypes.find((function(e){return e.Value==t.CurrencyID})))}}},{key:"onBeginEdit",value:function(e){var t=this.DataTableObj.Table.indexOf(e.args.item);if(t=-1==t||1==this.DataTableObj.Table.length||0==this.DataTableObj.Table.length||this.DataTableObj.Table.length-t<=1?1:0,this.DataTableObj.CanUserAddRows)for(var a=0;a<t;a++){var i=this.DataTableObj.NewRow();this.DataTableObj.addRow(i)}}},{key:"AddTabDetails",value:function(){var e;(e=new u.b).Name="Exchange Rate",e.Header=i.a.GetResource("Currency_ExchangeRate"),this.CustomTab.Pages.push(e),this.CustomTab.SelectedTab=e,this.CustomTab.Pages[0].Fields.push(this.ViewExhangeRates),(e=new u.b).Name="Denomination",e.Header=e.Header=i.a.GetResource("Denomination"),this.CustomTab.Pages.push(e);var t=new b.AddDenominationViewModel(this);this.CustomTab.Pages[1].Fields.push(t)}},{key:"BuildGridData",value:function(){var e=this;this._NumericColumnSource=[];var t=new r.a;t.Header=i.a.GetResource("UOM_Sno"),t.DisplayMember="SNO",t.DataType="TextBlock",t.ReadOnly=!0,t.Width=50,t.IsFrozen=!0,this.NumericColumnSource.push(t),(t=new r.a).Header=i.a.GetResource("Currency_GridName"),t.DisplayMember="Name",null==this.CurrLookup?t.DataType="TextBlock":(t.ValueBinding="Name",t.DataType="ComboBox",t.DisplayMember="Name",t.ValueMember="Name",t.ComboData=this.CurrLookup),t.Width=200,this.NumericColumnSource.push(t),(t=new r.a).Header=i.a.GetResource("Currency_GridSymbol"),t.DisplayMember="Symbol",t.DataType="TextBlock",t.ReadOnly=null!=this.CurrLookup,t.Width=80,t.IsFrozen=!0,this.NumericColumnSource.push(t),(t=new r.a).Header=i.a.GetResource("Currency_GridChange"),t.DisplayMember="Change",t.DataType="TextBlock",t.ReadOnly=null!=this.CurrLookup,t.Width=150,t.IsFrozen=!0,this.NumericColumnSource.push(t),(t=new r.a).Header=i.a.GetResource("Currency_GridExchangeRate"),t.DisplayMember="ExchangeRate",t.DataType="FLOAT",t.Width=100,t.IsFrozen=!0,this.NumericColumnSource.push(t),(t=new r.a).Header=i.a.GetResource("Currency_GridDecimals"),t.DisplayMember="Decimals",t.DataType="TextBlock",t.Width=100,t.IsFrozen=!0,this.NumericColumnSource.push(t),(t=new r.a).Header=i.a.GetResource("Reports_LblDaily"),t.ValueBinding="IsDailyRates",t.DataType="ComboBox",t.DisplayMember="Name",t.ValueMember="Value",t.Width=100;var a=[];a.push(h.d.ComboBoxItems_2(i.a.GetResource("Vehicle_Yes"),"True")),a.push(h.d.ComboBoxItems_2(i.a.GetResource("Vehicle_No"),"False")),t.ComboData=a,this.NumericColumnSource.push(t),(t=new r.a).Header=i.a.GetResource("Document_Status"),t.ValueBinding="StatusID",t.DataType="ComboBox",t.DisplayMember="Name",t.ValueMember="Value",t.Width=100;var n=[];n.push(h.d.ComboBoxItems_2(i.a.GetResource("RevenUReport_Active"),"True")),n.push(h.d.ComboBoxItems_2(i.a.GetResource("Attributes_Inactive"),"False")),t.ComboData=n,this.NumericColumnSource.push(t),(t=new r.a).Header="IsDivide",t.ValueBinding="IsDivide",t.DataType="ComboBox",t.DisplayMember="Name",t.ValueMember="Value",t.Width=100,(n=[]).push(h.d.ComboBoxItems_2("Yes","True")),n.push(h.d.ComboBoxItems_2("No","False")),t.ComboData=n,t.IsVisible=!(!i.a.SessionManager.Preferences.ContainsKey("DivideCurrency")||"true"!=i.a.SessionManager.Preferences.DivideCurrency.toLowerCase()),this.NumericColumnSource.push(t),this.DataTableObj.Table=[],this.DataTableObj.CanUserAddRows=!0,this.DataTableColumns.push("CurrencyID"),this.DataTableColumns.push("SNO"),this.DataTableColumns.push("Name"),this.DataTableColumns.push("Symbol"),this.DataTableColumns.push("Change"),this.DataTableColumns.push("ExchangeRate"),this.DataTableObj.DataTypes.Double.push("ExchangeRate"),this.DataTableColumns.push("Decimals"),this.DataTableColumns.push("IsDailyRates"),this.DataTableColumns.push("StatusID"),this.DataTableColumns.push("GUID"),this.DataTableColumns.push("IsDivide"),this.DataTableObj.Columns=this.NumericColumnSource,this.DataTableObj.ContextMenuClickSubject.subscribe((function(t){e.OnCmnItem_Click(t.item.Tag)})),this.DataTableObj.ContextMenu.Items=[];var s=new r.b;s.Header="DELETE",s.Tag="DELETE",s.Visibility=!0,this.DataTableObj.ContextMenu.Items.push(s)}},{key:"onAddRow",value:function(e,t){this.UpdateSequence(),t.Row.SNO=this.SNO}},{key:"onDeleteRow",value:function(e,t){this.UpdateSequence()}},{key:"UpdateSequence",value:function(){var e=this;this.SNO=1,this.DataTableObj.Table.forEach((function(t){t.SNO=e.SNO++}))}},{key:"GetCurrencyXMl",value:function(){var e="";if(null!=this.DataTable&&this.DataTable.length>0){e+="<XML>";for(var t=0;t<this.DataTable.length;t++)n.e.IsEmpty(this.DataTable[t].Name)||n.e.IsEmpty(this.DataTable[t].ExchangeRate)||(n.e.IsEmpty(this.DataTable[t][this.DataTableColumns[0]])?e+="<Row CurrencyID='0' Name='"+this.DataTable[t][this.DataTableColumns[2]].toString()+"' Symbol='"+this.DataTable[t][this.DataTableColumns[3]].toString()+"' Change='"+this.DataTable[t][this.DataTableColumns[4]].toString()+"' ExchangeRate='"+this.DataTable[t][this.DataTableColumns[5]].toString()+"' Decimals='"+this.DataTable[t][this.DataTableColumns[6]].toString()+"' Daily='"+this.DataTable[t][this.DataTableColumns[7]].toString()+"'  StatusID='"+this.DataTable[t][this.DataTableColumns[8]].toString()+"' IsDivide='"+this.DataTable[t].IsDivide.toString()+"' GUID='"+this.DataTable[t].GUID.toString()+"' Action='Insert'/>":parseInt(this.DataTable[t][this.DataTableColumns[0]])>0?parseInt(this.DataTable[t][this.DataTableColumns[0]])==this.BaseCurr?(e+="<Row CurrencyID='"+this.DataTable[t][this.DataTableColumns[0]].toString()+"' Name='"+this.DataTable[t][this.DataTableColumns[2]].toString()+"' Symbol='"+this.DataTable[t][this.DataTableColumns[3]].toString()+"' Change='"+this.DataTable[t][this.DataTableColumns[4]].toString()+"' ExchangeRate='"+this.DataTable[t][this.DataTableColumns[5]].toString()+"' Decimals='"+this.DataTable[t][this.DataTableColumns[6]].toString()+"' Daily='"+this.DataTable[t][this.DataTableColumns[7]].toString()+"'  StatusID='"+this.DataTable[t][this.DataTableColumns[8]].toString()+"' IsDivide='"+this.DataTable[t].IsDivide.toString()+"'  GUID='"+this.DataTable[t].GUID.toString()+"'   Action='Update'/>",e+="<Row CurrencyID='"+this._CurrencyID+"' Name='"+this.CurrencyName+"' Symbol='"+Symbol+"' Change='"+this.Change+"' ExchangeRate='1'   Action='Update'/>"):e+="<Row CurrencyID='"+this.DataTable[t][this.DataTableColumns[0]].toString()+"' Name='"+this.DataTable[t][this.DataTableColumns[2]].toString()+"' Symbol='"+this.DataTable[t][this.DataTableColumns[3]].toString()+"' Change='"+this.DataTable[t][this.DataTableColumns[4]].toString()+"' ExchangeRate='"+this.DataTable[t][this.DataTableColumns[5]].toString()+"' Decimals='"+this.DataTable[t][this.DataTableColumns[6]].toString()+"' Daily='"+this.DataTable[t][this.DataTableColumns[7]].toString()+"'  StatusID='"+this.DataTable[t][this.DataTableColumns[8]].toString()+"'  IsDivide='"+this.DataTable[t].IsDivide.toString()+"' GUID='"+this.DataTable[t].GUID.toString()+"'   Action='Update'/>":parseInt(this.DataTable[t][0])<=0&&(e+="<Row CurrencyID='0' Name='"+this.DataTable[t][this.DataTableColumns[2]].toString()+"' Symbol='"+this.DataTable[t][this.DataTableColumns[3]].toString()+"' Change='"+this.DataTable[t][this.DataTableColumns[4]].toString()+"' ExchangeRate='"+this.DataTable[t][this.DataTableColumns[5]].toString()+"' Decimals='"+this.DataTable[t][this.DataTableColumns[6]].toString()+"' Daily='"+this.DataTable[t][this.DataTableColumns[7]].toString()+"'  StatusID='"+this.DataTable[t][this.DataTableColumns[8]].toString()+"' IsDivide='"+this.DataTable[t].IsDivide.toString()+"' GUID='"+this.DataTable[t].GUID.toString()+"' Action='Insert'/>"));this.BaseCurr==this._CurrencyID&&(e+="<Row CurrencyID='"+this._CurrencyID+"' Name='"+this.CurrencyName+"' Symbol='"+this.Symbol+"' Change='"+this.Change+"' ExchangeRate='1'  GUID='"+this._GUID+"'   Action='Update'/>")}else e+="<XML>";for(var a=0;a<this.lstDeletedRecords.length;a++)e+='<Row Action="Delete"',e+=' CurrencyID="'+this.lstDeletedRecords[a].iSeqno+'"/>';return(e=(e+="</XML>").Replace("&","&amp;")).toString()}},{key:"BindCurrencies",value:function(e){var t=this,a=[];a.push(0),a.push(e),a.push(i.a.SessionManager.UserID),a.push(i.a.SessionManager.LanguageID);var s=i.a.admin.GetCurrencies(a);if(null!=s&&s.Tables.length>0&&s.Tables[0].length>0&&(this._CurrencyID=parseInt(s.Tables[0][0].CurrencyID),this.BaseCurr=this._CurrencyID,this.CurrencyName=s.Tables[0][0].Name.toString(),this.Symbol=n.e.String(s.Tables[0][0].Symbol),this.Change=n.e.String(s.Tables[0][0].Change),this._GUID=n.e.String(s.Tables[0][0].GUID)),null!=s&&s.Tables.length>1&&(this.DataTableObj.Table=s.Tables[1]),s.Tables.length>2&&(this.ExTable=s.Tables[2]),s.Tables.length>3&&!s.Columns[3].Contains("NoDimCurrency")&&s.Tables[3].length>0){if(this.Dim.Label=s.Tables[3][0].Name.toString(),this.Dim.SelectedValue=e,""!=s.Tables[3][0].CurrencyID.toString()&&parseInt(s.Tables[3][0].CurrencyID.toString())!=this.BaseCurr){var r=this.DataTable.filter((function(e){return e.CurrencyID==s.Tables[3][0].CurrencyID.toString()}));r.length>0&&(this._CurrencyID=parseInt(r[0].CurrencyID.toString()),this.CurrencyName=r[0].Name.toString(),Symbol=r[0].Symbol.toString(),this.Change=r[0].Change.toString(),r[0].CurrencyID=this.BaseCurr,r[0].Change=s.Tables[0][0].Change.toString(),r[0].Name=s.Tables[0][0].Name.toString(),r[0].Symbol=s.Tables[0][0].Symbol.toString())}for(var l=function(e){var a=s.Tables[2].filter((function(a){return 0==a.D&&a.CurrencyID==t.DataTable[e].CurrencyID.toString()}));t.DataTable[e].ExchangeRate=a.length>0?a[0].ExchangeRate.toString():0},o=0;o<this.DataTable.length;o++)l(o)}this.AddCurrencyDetails(),this.ViewExhangeRates.LoadExchRates(this.ExTable),this.DataTableObj.addEmptyRow(),this.DataTable[s.Tables[1].length-1].SNO=s.Tables[1].length}},{key:"Validate",value:function(){if(this.Dim.Visible&&0==this.Dim.SelectedValue)return this.DisplayMessage=" select "+this.Dim.Label,this.MessageVisibility=!0,!1;if(null==this.CurrencyName.Trim()||""==this.CurrencyName.Trim())return this.DisplayMessage=" Please Enter Base Currency",this.MessageVisibility=!0,!1;if(null==this.Symbol.Trim()||""==this.Symbol.Trim())return this.DisplayMessage=" Please Enter Base Symbol",this.MessageVisibility=!0,!1;if(null==this.Change.Trim()||""==this.Change.Trim())return this.DisplayMessage=" Please Enter Base Currency Change",this.MessageVisibility=!0,!1;for(var e=0;e<this.DataTable.length;e++)if(!n.e.IsEmpty(this.DataTable[e].Name)||!n.e.IsEmpty(this.DataTable[e].Symbol)||!n.e.IsEmpty(this.DataTable[e].ExchangeRate)){if(n.e.IsEmpty(this.DataTable[e].Name))return this.DisplayMessage=i.a.GetResource("Curr_Name")+(e+1).toString(),this.MessageVisibility=!0,!1;if(n.e.IsEmpty(this.DataTable[e].Symbol))return this.DisplayMessage=i.a.GetResource("Curr_Symbol")+(e+1).toString(),this.MessageVisibility=!0,!1;if(n.e.IsEmpty(this.DataTable[e].Change))return this.DisplayMessage=i.a.GetResource("Curr_Change")+(e+1).toString(),this.MessageVisibility=!0,!1;if(n.e.IsEmpty(this.DataTable[e].ExchangeRate)||parseFloat(this.DataTable[e].ExchangeRate)<=0)return this.DisplayMessage=i.a.GetResource("Curr_Exch")+(e+1).toString(),this.MessageVisibility=!0,!1;if(n.e.IsEmpty(this.DataTable[e].Decimals)||parseFloat(this.DataTable[e].Decimals)<=0)return this.DisplayMessage=i.a.GetResource("Curr_Decimals")+(e+1).toString(),this.MessageVisibility=!0,!1}return!0}},{key:"OnSaveCurrency",value:function(e){var t=this;this.MessageVisibility=!1,Logger.InfoLog("AddCurrencyViewModel::Entering OnSaveCurrency");try{if(this.Validate()){var a,n=[];if(this.BaseCurr!=this._CurrencyID){n.push(this.BaseCurr);var s=this.DataTable.filter((function(e){return e.CurrencyID==t.BaseCurr.toString()}));if(!(s.length>0))return this.DisplayMessage="Base currency deleted.please refresh data",void(this.MessageVisibility=!0);n.push(s[0].Name.toString()),n.push(s[0].Symbol.toString()),n.push(s[0].Change.toString())}else n.push(this._CurrencyID),n.push(this.CurrencyName),n.push(this.Symbol),n.push(this.Change);n.push(this.GetCurrencyXMl()),n.push(this.ViewExhangeRates.GetXML()),n.push(this.Dim.Visible?this.Dim.SelectedValue:1),n.push(i.a.SessionManager.CompanyGUID),n.push(this._GUID),n.push(i.a.SessionManager.UserName),n.push(i.a.SessionManager.RoleID),n.push(i.a.SessionManager.LanguageID);var r=i.a.admin.SetCurrencies(n);this.MessageVisibility=!0,a=r.Message;var l=r.ret;this.DisplayMessage=a,l>0&&this.BindCurrencies(this.Dim.Visible?this.Dim.SelectedValue:1),Logger.InfoLog("AddCurrencyViewModel::Entering OnSaveCurrency")}}catch(o){Logger.ErrorLog("AddCurrencyViewModel:: OnSaveCurrency"+o.stack)}}},{key:"onCanSaveCurrency",value:function(e){return!0}},{key:"UpdateUIIndicators",value:function(e){this.PACTControlData=e,this.DisplayName="Currency"}},{key:"CallBackBuildControls",value:function(e){}},{key:"worker_DoWork",value:function(e,t){var a=this;Logger.InfoLog("AddCurrencyViewModel::Entering worker_DoWork"),this._ScreenData=this.BuildControls(),Logger.InfoLog("AddCurrencyViewModel::BuildControls Success"),this.CurrencyNameEnabled=!0,this.SymbolEnabled=!0,this.ChangeEnabled=!0,this.ApplyResources(this._ScreenData.Tables[0]),this.CurrencyCombo.Visible=!1;for(var n=0;n<this._ScreenData.Tables.length;n++)if(this._ScreenData.Columns[n].Contains("CurrLookupID")){this.CurrLookup=this._ScreenData.Tables[n],this.CurrencyCombo.Visible=!0,this.CurrencyCombo.Label=i.a.GetResource("Currency_BaseCurrency"),this.CurrLookup.forEach((function(e){a.CurrencyCombo.Items.push(h.d.ComboBoxItems_2(e.Name,e.Name))}));break}}},{key:"worker_RunWorkerCompleted",value:function(e,t){this.DisplayName=i.a.GetResource("Currency_ScreenName")}},{key:"BuildControls",value:function(){Logger.InfoLog("AddCurrencyViewModel::Entering BuildControls");try{return(new m.a).GetControls(this._ScreenID,i.a.SessionManager.CompanyIndex)}catch(e){return Logger.ErrorLog("AddCurrencyViewModel:: BuildControls"+e.stack),null}}},{key:"ApplyFieldSecurity",value:function(e){Logger.InfoLog("AddCurrencyViewModel::Entering ApplyFieldSecurity");var t=e;t=t.filter((function(e){return 172==e.ColID})),this.CurrencyNameEnabled=t.length>0,t=t.filter((function(e){return 173==e.ColID})),this.SymbolEnabled=t.length>0,t=t.filer((function(e){return 174==e.ColID})),this.ChangeEnabled=t.length>0,Logger.InfoLog("AddCurrencyViewModel::Exiting ApplyFieldSecurity")}},{key:"ApplyResources",value:function(e){Logger.InfoLog("AddCurrencyViewModel::Entering ApplyResources");var t=e;t=t.filter((function(e){return 172==e.CostCenterColID})),this.lblCurrencyName=t.length>0?t[0].ResourceData.toString():"",t=t.filter((function(e){return 173==e.CostCenterColID})),this.lblSymbol=t.length>0?t[0].ResourceData.toString():"",t.RowFilter="CostCenterColID=174",this.lblChange=t.length>0?t[0].ResourceData.toString():"",Logger.InfoLog("AddCurrencyViewModel::Exiting ApplyResources")}},{key:"OnShowExchangeRate",value:function(){this.AddCurrencyDetails()}},{key:"OnAddExchangeRate",value:function(){this.Exch=new C(this),this.AddCurrencyDetails()}},{key:"OnDeleteCallBack",value:function(){for(var e=0,t=0;t<this.DataTable.length;t++)if(e=parseInt(this.DataTable[t].SNO),this.SelectedNode==e-1&&!n.e.IsEmpty(this.DataTable[t][0])){this.lstDeletedRecords.push(new T(parseInt(this.DataTable[t][0])));break}this.SelectedNode<this.DataTable.length&&this.DataTableObj.Table.RemoveAt(this.SelectedNode),this.UpdateSequence()}},{key:"SelectedNode",get:function(){return this._SelectedNode},set:function(e){e!=this._SelectedNode&&(this._SelectedNode=e,this.ViewExhangeRates.SelectedCurrencyText=this._SelectedNode>=0&&this.DataTable.length>this._SelectedNode?this.DataTable[this._SelectedNode].Name.toString():"")}},{key:"CurrencyName",get:function(){return this._CurrencyName},set:function(e){e!=this._CurrencyName&&(this.CurrencyCombo.SelectedValue=e,this._CurrencyName=e)}},{key:"angularGrid",get:function(){return this.DataTableObj.angularGrid}},{key:"DataTable",get:function(){return this.DataTableObj.Table}},{key:"DataTableColumns",get:function(){return this.DataTableObj.TableColumns}},{key:"NumericColumnSource",get:function(){return this._NumericColumnSource}},{key:"NumericdDt",get:function(){return this._NumericdDt}}]),a}(c.b)}}]);
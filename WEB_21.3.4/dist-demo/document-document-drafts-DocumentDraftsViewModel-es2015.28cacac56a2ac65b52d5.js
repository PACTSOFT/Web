(window.webpackJsonp=window.webpackJsonp||[]).push([[150],{ouML:function(e,t,a){"use strict";a.r(t),a.d(t,"DocumentDraftsViewModel",(function(){return D}));var s=a("mrSG"),i=a("Do2H"),r=a("Lp6j"),o=a("ScVY"),n=a("8B8H"),l=a("ockk"),h=a("rJVx"),d=a("CUWK");class D extends o.b{constructor(e,t,a=0){if(super(),this.Grid=new n.a,this.IsFromDocs=!1,this.PopupWidth=0,this.ReportType=0,this.Parent=null,this.CCID=0,this.WID=0,this.LevelID=0,this.PactGridVisible=!1,this.CCID=a,this.Parent=e,this.ReportType=t,this.Parent instanceof h.GeneralDashboardViewModel||"DashAddOnsViewModel"==this.Parent.ClassName)1==t&&(this.ColSource=h.GeneralDashboardViewModel.InitColumns("Document Drafts_DashBoardCustomize"));else{let e;1==t?this.DisplayName="Drafts":2==t?this.DisplayName="Hold Documents":3==t?this.DisplayName="Approval History":4==t&&(this.DisplayName="Level Info",this.PactGrid=new n.a),this.Title=this.DisplayName,this.IsFromDocs=!0,this.FillGrid(),this.Grid.OnLinkClick.Subscribe(this,"GridLinkClick"),this.ColSource=[],1==t?(this.ColSource=h.GeneralDashboardViewModel.InitColumns("Document Drafts_DashBoardCustomize"),this.PopupWidth=22,this.ColSource.forEach(e=>{this.PopupWidth=this.PopupWidth+e.Width})):2==t?(e=new l.a,e.DataType="TextBlock",e.Header="Hold Date",e.DisplayMember="HoldDate_Key",e.Width=100,this.ColSource.push(e),e=new l.a,e.DataType="LINK",e.Header=i.a.GetResource("DocName"),e.DisplayMember="DocName",e.Width=135,this.ColSource.push(e),e=new l.a,e.DataType="TextBlock",e.Header="NetValue",e.DisplayMember="NetValue",e.Width=100,this.ColSource.push(e),e=new l.a,e.DataType="TextBlock",e.Header="NoOfProducts",e.DisplayMember="NoOfProducts",e.Width=50,this.ColSource.push(e),e=new l.a,e.DataType="LINK",e.Header=i.a.GetResource("Delete"),e.DisplayMember="Delete",e.Width=100,this.ColSource.push(e),this.PopupWidth=450):3==t?(e=new l.a,e.DataType="TextBlock",e.Header="User",e.DisplayMember="CreatedBy",e.Width=90,this.ColSource.push(e),e=new l.a,e.DataType="TextBlock",e.Header="FirstName",e.DisplayMember="FirstName",e.Width=90,this.ColSource.push(e),e=new l.a,e.DataType="TextBlock",e.Header="LastName",e.DisplayMember="LastName",e.Width=90,this.ColSource.push(e),e=new l.a,e.DataType="TextBlock",e.Header="Email",e.DisplayMember="Email1",e.Width=150,this.ColSource.push(e),e=new l.a,e.DataType="TextBlock",e.Header=i.a.GetResource("Date"),e.DisplayMember="AppDate",e.Width=128,this.ColSource.push(e),e=new l.a,e.DataType="LINK",e.Header="Level",e.DisplayMember="LevelName",e.Width=93,this.ColSource.push(e),e=new l.a,e.DataType="TextBlock",e.Header="Status",e.DisplayMember="Status",e.Width=80,this.ColSource.push(e),e=new l.a,e.DataType="Format",e.Header="Remarks",e.DisplayMember="Remarks",e.Width=190,this.ColSource.push(e),this.PopupWidth=950,"AddEditDocumentViewModel"==this.Parent.ClassName&&(e=new l.a,e.Header="WorkFlowName",e.DisplayMember="WorkFlowName",e.Width=200,this.ColSource.push(e)),this.PopupWidth=950):4==t&&(e=new l.a,e.DataType="TextBlock",e.ReadOnly=!0,e.Header="User Name",e.DisplayMember="UserName",e.Width=120,this.ColSource.push(e),e=new l.a,e.DataType="TextBlock",e.ReadOnly=!0,e.Header="First Name",e.DisplayMember="FirstName",e.Width=120,this.ColSource.push(e),e=new l.a,e.DataType="TextBlock",e.ReadOnly=!0,e.Header="Last Name",e.DisplayMember="LastName",e.Width=120,this.ColSource.push(e),this.PactGrid.Columns=this.ColSource,this.PopupWidth=400)}}get Table(){return this.Grid.Table}set Table(e){this.Grid.Table=e}get TableColumns(){return this.Grid.TableColumns}set TableColumns(e){this.Grid.TableColumns=e}get ColSource(){return this.Grid.Columns}set ColSource(e){this.Grid.Columns=e}get SelectedRow(){return this.Grid.SelectedItem}set SelectedRow(e){this.Grid.SelectedItem=e}onClick(e){event.preventDefault(),null!=this.SelectedRow&&this.LoadDraft(this.SelectedRow)}FillGrid(){let e=0,t=null;if(r.e.IsType(this.Parent,"AddEditDocumentViewModel")?(t=this.Parent,e=0==this.CCID?t.CostCenterID:this.CCID):r.e.IsEmpty(this.Parent.ClassName)||"AddEditRenContractViewModel"!=this.Parent.ClassName||(e=this.CCID),1==this.ReportType||2==this.ReportType){let a;a=r.e.IsEmpty(this.Parent.ClassName)||"AddEditRenContractViewModel"!=this.Parent.ClassName?null==t||38!=t.ScreenObject.DocumentType&&39!=t.ScreenObject.DocumentType?i.a.document.GetDocumentDrafts(0,e,this.ReportType,!1):i.a.document.GetDocumentDrafts(t.ScreenObject.RegisterNodeID,e,this.ReportType,!1,!0):i.a.document.GetDocumentDrafts(0,this.Parent.CostCenterID,this.ReportType,!1),a.subscribe(e=>{this.Table=e.Tables[0],this.Grid.TableColumns.Contains("Date_Text")||(this.Grid.TableColumns.push("Date_Text"),this.Grid.TableColumns.push("Delete")),this.Grid.TableColumns.Contains("HoldDate_Key")||this.Grid.TableColumns.push("HoldDate_Key"),this.Table.forEach(e=>{e.Delete="Delete",e.id=i.a.slick.rowid,e.Date_Text=new Date(e.Date).ToString(i.a.SessionManager.Preferences["Date Format"]+" hh:mm a"),null!=e.HoldDate&&(e.HoldDate_Key=new Date(e.HoldDate).ToString(i.a.SessionManager.Preferences["Date Format"]))})})}else if(3==this.ReportType){let t=null;if(r.e.IsType(this.Parent,"AddEditDocumentViewModel")?(t=this.Parent.ScreenObject.GetDocStatusHistory(),t.Tables.length>1&&t.Tables[1].length>0&&t.Columns[1].Contains("WID")&&(this.WID=parseInt(t.Tables[1][0].WID))):r.e.IsEmpty(this.Parent.ClassName)||"AddEditRenContractViewModel"!=this.Parent.ClassName?r.e.IsEmpty(this.Parent.ClassName)||"AddEditCasesViewModel"!=this.Parent.ClassName||(t=this.GetDocStatusHistory(73,this.Parent.CaseID,!1)):t=i.a.rental.GetHistory(e,this.Parent.ContractID),null!=t&&t.Tables.length>0){this.Table=t.Tables[0],this.Grid.TableColumns.push("AppDate");for(let t=0;t<this.Table.length;t++)""!=this.Table[t].Date.toString()&&(this.Table[t].AppDate=new Date(this.Table[t].Date.toString()).ToString(i.a.SessionManager.Preferences["Date Format"]+" hh:mm a"));let e=0,a=0;this.Table.length>0&&(e=r.e.IntTryParse(this.Table[this.Table.length-1].WorkFlowLevel.toString()),a=r.e.IntTryParse(this.Table[this.Table.length-1].StatusID.toString())),369!=a&&(t.Tables[1]=t.Tables[1].filter(t=>t.levelID>e),t.Tables[1].forEach(e=>{let t=this.Grid.NewRow();t.LevelName=e.LevelName,t.Status="Pending",t.WorkFlowLevel=e.LevelID,this.Grid.addRow(t)}));for(let t=this.Table.length;t<7;t++)this.Grid.addEmptyRow()}}else if(4==this.ReportType){let e=null;if("WFLevelDoc"==this.Parent.ClassName?e=i.a.SessionManager.Preferences.ContainsKey("CanApproveFunction")&&"True"==i.a.SessionManager.Preferences.CanApproveFunction?i.a.report.GetExtWFDet(this.Parent.WID,this.Parent.LevelID,this.Parent.ccid,this.Parent.DOcId):i.a.report.GetWorkFlowLevelDetails(this.Parent.WID,this.Parent.LevelID,this.Parent.ccDate):this.Parent instanceof D&&(i.a.SessionManager.Preferences.ContainsKey("CanApproveFunction")&&"True"==i.a.SessionManager.Preferences.CanApproveFunction?"AddEditDocumentViewModel"==this.Parent.Parent.ClassName?e=i.a.report.GetExtWFDet(this.Parent.WID,this.Parent.LevelID,this.Parent.Parent.CostCenterID,this.Parent.Parent.ScreenObject.DocID):"ReportViewModel"==this.Parent.Parent.ClassName&&"INV_ComparisonReport"==this.Parent.Parent.StaticReportObject&&(e=i.a.report.GetExtWFDet(this.Parent.WID,this.Parent.LevelID,this.Parent.Parent.StaticReportObject.QuotationDocument,this.Parent.Parent.StatusDocID)):e=i.a.report.GetWorkFlowLevelDetails(this.Parent.WID,this.Parent.LevelID,"AddEditDocumentViewModel"==this.Parent.Parent.ClassName?this.Parent.Parent.ScreenObject.DocDate.Date:Date.Today())),null!=e){for(let t=e.Tables[0].length;t<8;t++)e.Tables[0].push();this.PactGrid.Table=e.Tables[0]}this.PactGrid.Width="",this.PactGrid.SearchVisible=!0,this.PactGrid.SearchCols.Width="85",this.PactGrid.SearchOptions.Width="90",this.PactGrid.SearchText.Width="110",this.PactGridVisible=!0}}GetDocStatusHistory(e,t,a){Logger.InfoLog("DocumentDraftsViewModel:: Inside GetDocStatusHistory");let s=[];s.push(e),s.push(t),s.push(a),s.push(i.a.SessionManager.UserID),s.push(i.a.SessionManager.LanguageID);let r=i.a.document.GetDocStatusHistory(s);return Logger.InfoLog("DocumentDraftsViewModel:: Exiting GetDocStatusHistory"),r}OnButtonClick(e){"Cancel"==e.toString()&&(r.e.IsType(this.Parent,"AddEditDocumentViewModel")&&this.CCID>0&&(this.Parent.res="No"),i.a.page.HideDialog())}DeleteDraft(e){let t;t=r.e.IsEmpty(this.Parent.ClassName)||"AddEditRenContractViewModel"!=this.Parent.ClassName?i.a.document.DeleteDocumentDraft(parseInt(e.DraftID)):i.a.rental.DeleteQuotation(parseInt(e.CostCenterID),parseInt(e.DraftID)),t.RetValue>0&&this.Grid.removeRow(e)}LoadDraft(e){return Object(s.b)(this,void 0,void 0,(function*(){if(r.e.IsEmpty(this.Parent.ClassName)||"AddEditRenContractViewModel"!=this.Parent.ClassName){const{AddEditDocumentViewModel:t}=yield Promise.all([a.e(2),a.e(1),a.e(3),a.e(5),a.e(4),a.e(6),a.e(7),a.e(10),a.e(9),a.e(12),a.e(11),a.e(13),a.e(19),a.e(15),a.e(21),a.e(20),a.e(16),a.e(14),a.e(18),a.e(17),a.e(22),a.e(89)]).then(a.bind(null,"1Cra")),{AddEditDocumentComponent:s}=yield Promise.all([a.e(4),a.e(6)]).then(a.bind(null,"MCKn"));let r,o;o=i.a.document.GetDocumentDrafts(parseInt(e.DraftID),0,1,!1),o.subscribe(a=>{if(r=a.Tables[0],null!=r&&r.length>0)if("AddEditDocumentViewModel"==this.Parent.ClassName||"POSDocumentViewModel"==this.Parent.ClassName)this.CCID>0||(this.Parent.clear(1),this.Parent.LoadDraftXML(r[0]),i.a.page.HideDialog(),this.Parent.ScreenObject.GridDataObj.RefreshGridView());else{let a=1==this.ReportType,o=new t(parseInt(e.CostCenterID),e.Type.toString(),a);i.a.page.addNewTab({component:s,params:{obj:o}}),o.LoadDraftXML(r[0],a)}})}else d.RibbonExtViewModel.LoadDraftRentalContract(this.Parent,parseInt(e.DraftID)),i.a.page.HideDialog()}))}GridLinkClick(e,t,a){event.preventDefault(),"Delete"==t?this.DeleteDraft(e):"Date_Text"!=t&&"DocName"!=t||this.LoadDraft(e)}}}}]);
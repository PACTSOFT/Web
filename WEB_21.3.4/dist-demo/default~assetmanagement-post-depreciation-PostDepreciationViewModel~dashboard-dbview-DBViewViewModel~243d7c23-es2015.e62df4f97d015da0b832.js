(window.webpackJsonp=window.webpackJsonp||[]).push([[50,113],{"7SrT":function(e,t,s){"use strict";s.r(t),s.d(t,"PostDepreciationViewModel",(function(){return C}));var i=s("Do2H"),a=s("Lp6j"),o=s("vTM8"),r=s("eQJW"),h=s("8iaB"),n=s("8B8H"),l=s("JIg3"),D=s("ockk"),u=s("7fVR"),p=s("6z9j"),c=s("0/4Q"),d=s("jDOZ"),S=s("4HhE"),g=s("NM0h");class C extends h.a{constructor(e,t,s){super(),this.FilterVisibility=!1,this.DateFilter="",this.FromDate=new l.a(0),this.AsonDate=new l.a(0),this.PostButtonLabel=null,this.Enable=!0,this.IsDashBoard=!1,this.IsUnPostScreen=!1,this.SystemDate=Date.Today(),this.IsPostingOnScheduleDate=!1,this.AllowEditPostingDate=!1,this.strSelect="",this.strJoin="",this.DateColIDs=new Array,this.Ddate=Date.Today(),this.SelectUnCheck=0,this.sbSchdulesDeleted="",this.iLoop=0,this.iStart=1,this.JVCCID=0,this.iFailure=0,this.dicVouchers=new o.a,this.dicVouchersCnt=new o.a,this.ClassName="PostDepreciationViewModel",this.IsDashBoard=t,this.DisplayName=this.Title=e,this.IsUnPostScreen=s,this.FromDate.Date=Date.Today().AddDays(1-Date.Today().getDate()),this.AsonDate.Date=this.FromDate.Date.AddMonths(1).AddDays(-1),t?(this.FromDate.Width="190",this.AsonDate.Width="190",this.FromDate.LblWidth="72",this.AsonDate.LblWidth="80",window.innerWidth<=1540&&(this.FromDate.Width="",this.AsonDate.Width="",this.FromDate.LblWidth="",this.AsonDate.LblWidth="")):(this.FromDate.Width="150",this.AsonDate.Width="150"),this.PostButtonLabel=s?"Un-Post":i.a.GetResource("Post"),this.FromDate.Label=i.a.GetResource("FromDate"),this.AsonDate.Label=i.a.GetResource("ToDate");try{this.DepreciationGrid=new n.a,this.DepreciationGrid.Width="",this.DepreciationGrid.Height=0,t||(this.DepreciationGrid.SearchVisible=!0,this.DepreciationGrid.SelectAll.Visible=!0,this.DepreciationGrid.SortVisible=!0,this.FilterVisibility=!0),this.DepreciationGrid.SelectAll.DBColumnName="select",this.InitColumns(),this.FilterVisibility?this.InitFilterScreen():this.DeprDataFilling()}catch(a){Logger.ErrorLog("PostDepreciationViewModel","Constructor",a)}}InitColumns(){let e=new Array,t=new D.a;t.Header=i.a.GetResource("select"),t.DisplayMember="select",t.DataType="CheckBox",t.Width=55,t.CheckedChanged.Subscribe(this,"OnCheckedChanged"),e.push(t),this.IsUnPostScreen||(this.AllowEditPostingDate=i.a.SessionManager.IsActionAssigned(72,"Allow editing of depreciation posting date"),this.AllowEditPostingDate&&(t=new D.a,t.Header="Post Date",t.DisplayMember="PostDate",t.DataType="DATE",t.Width=110,t.ReadOnly=!1,t.CheckedChanged.Subscribe(this,"OnCheckedChanged"),e.push(t)));let s,o=i.a.report.GetReportData(12,this.IsUnPostScreen?201:197,null),h=1,n="";o.Tables[0].forEach(t=>{s=new D.a,s.Header="Asset Code"==t.Caption.toString()?i.a.GetResource("PDAssetCode"):"Asset Name"==t.Caption.toString()?i.a.GetResource("PDAssetName"):"Start Date"==t.Caption.toString()?i.a.GetResource("PDStartDate"):"End Date"==t.Caption.toString()?i.a.GetResource("PDEndDate"):"Depr Amount"==t.Caption.toString()?i.a.GetResource("PDDeprAmount"):"Accu. Depr"==t.Caption.toString()?i.a.GetResource("PDAccuDepr"):"Net Value"==t.Caption.toString()?i.a.GetResource("PDNetValue"):"Put To Use"==t.Caption.toString()?i.a.GetResource("PDPuttouse"):t.Caption.toString(),s.ID=t.ID.toString(),s.DisplayMember=t.ID.toString(),s.DataType=t.DType.toString(),"DATE"==s.DataType?(this.DateColIDs.push(s.DisplayMember),s.DisplayMember=s.DisplayMember+"_Key"):"FLOAT"==s.DataType?s.DecimalPoints=a.e.IsNum(t.Decimals)?a.e.Int(t.Decimals).toString():i.a.SessionManager.Preferences.DecimalsinAmount:"VoucherNo"==s.ID&&(s.DataType="LINK_VOUCHER"),s.ReadOnly=!0,s.Width=parseInt(t.Width),null!=t.Visible&&0==parseInt(t.Visible)&&(s.IsVisible=!1),e.push(s),33==s.ID.length&&(n="T"+h,"ACC_Assets"==t.SFSysTableName.toString()?null!=t.SSFIsFK&&Object(r.j)(t.SSFIsFK)?(this.strSelect+="DATE"==s.DataType?",convert(datetime,"+n+"."+t.SSFSysColumnName.toString()+") "+s.ID:","+n+"."+t.SSFSysColumnName.toString()+" "+s.ID,this.strJoin+=" left join "+t.SSFParentCostCenterSysName.toString()+" "+n+" with(nolock) on "+n+"."+t.SSFParentCostCenterColSysName.toString()+"=acc."+t.SFSysColumnName.toString()):this.strSelect+="DATE"==s.DataType?",convert(datetime,Acc."+t.SFSysColumnName.toString()+") "+s.ID:",Acc."+t.SFSysColumnName.toString()+" "+s.ID:"COM_CCCCDATA"==t.SFSysTableName.toString()&&null!=t.SSFIsFK&&Object(r.j)(t.SSFIsFK)&&(this.strSelect+="DATE"==s.DataType?",convert(datetime,"+n+"."+t.SSFSysColumnName.toString()+") "+s.ID:","+n+"."+t.SSFSysColumnName.toString()+" "+s.ID,this.strJoin+=" left join "+t.SSFParentCostCenterSysName.toString()+" "+n+" with(nolock) on "+n+"."+t.SSFParentCostCenterColSysName.toString()+"=cc."+t.SFSysColumnName.toString())),h++}),this.DepreciationGrid.Columns=e}DeprDataFilling(){if(this.deprTable=null,null==this.FromDate.Date||null==this.AsonDate.Date)return null==this.AsonDate.Date?this.DisplayMessage="Select "+this.AsonDate.Label:null==this.FromDate.Date&&(this.DisplayMessage="Select "+this.FromDate.Label),void(this.MessageVisibility=!0);let e,t,s={strTreeJoin:"",strTreeWhere:""};if(this.IsDashBoard||(this.DateFilter="From : "+this.FromDate.Date.ToString(i.a.SessionManager.Preferences["Date Format"]),this.DateFilter+="    To : "+this.AsonDate.Date.ToString(i.a.SessionManager.Preferences["Date Format"]),this.GetFilters(s)),this.SystemDate=Date.Today(),this.deprTable=d.a.GetDepreciationDocuments(this.IsUnPostScreen,this.FromDate.Date,this.AsonDate.Date,this.strSelect,s.strTreeJoin+this.strJoin,s.strTreeWhere),null!=this.deprTable&&this.deprTable.Tables.length>0&&this.deprTable.Tables[0].length>0){this.deprTable.Columns[0].push("select"),this.AllowEditPostingDate&&(this.deprTable.Columns[0].push("PostDate_Key"),this.deprTable.Columns[0].push("PostDate"));let s=this.deprTable.Tables[1].filter(e=>"AssetDeprPostDate"==e.Name);s.length>0&&"ScheduleDate"==a.e.String(s[0].Value)?this.IsPostingOnScheduleDate=!0:this.SystemDate=new Date(this.deprTable.Tables[2][0].SystemDate),this.DateColIDs.forEach(e=>{this.deprTable.Columns[0].push(e+"_Key")}),this.deprTable.Tables[0].forEach(s=>{s.select=!1,this.DateColIDs.forEach(o=>{e=o+"_Key",a.e.IsEmpty(s[o])||(t=new Date(s[o]),s[e]=t.ToString(i.a.SessionManager.Preferences["Date Format"])),this.AllowEditPostingDate&&(this.IsPostingOnScheduleDate?(s.PostDate_Key=s.ToDate,s.PostDate=new Date(s.ToDate).ToString(i.a.SessionManager.Preferences["Date Format"])):(s.PostDate_Key=this.SystemDate,s.PostDate=this.SystemDate.ToString(i.a.SessionManager.Preferences["Date Format"])))})})}this.DepreciationGrid.SelectAll.IsChecked=!1,this.DepreciationGrid.Table=this.deprTable.Tables[0],this.DepreciationGrid.setRowid()}OnButtonClick(e){"PostDepreciation"==e?this.IsUnPostScreen?this.worker_DoWork():(new u.a).DepreciationScheduleViewModel_2(this.deprTable,this):"RefreshDepr"==e?this.DeprDataFilling():"Regenerate"==e?this.FilterVisibility=!0:"DeprExport"==e||("FilterOK"==e?(this.DeprDataFilling(),this.FilterVisibility=!1):"FilterCancel"==e&&(this.FilterVisibility=!1))}SelectUnselectAll(e){for(let t=0;t<this.DepreciationGrid.Table.length;t++)0==this.SelectUnCheck&&(this.DepreciationGrid.Table[t].Select=e);this.SelectUnCheck=0}OnCheckedChanged(e,t){t||1==this.DepreciationGrid.SelectAll.IsChecked&&(this.SelectUnCheck=1,this.DepreciationGrid.SelectAll.IsChecked=!1)}worker_RunWorkerCompleted(){if(this.Enable=!0,this.sbSchdulesDeleted.length>0){let e;this.sbSchdulesDeleted.toString().split(",").forEach(t=>{e=this.DepreciationGrid.Table.filter(e=>e.ScheduleID==t),e.length>0&&this.DepreciationGrid.removeRow(e[0])})}}worker_DoWork(){this.Enable=!1;let e=this.DepreciationGrid.Table;if(this.drrPost=[],e.length>0&&(this.drrPost=e.filter(e=>1==e.select),this.drrPost.SortBy([{name:"ToDate",desc:!0},"VoucherNo"])),0==this.drrPost.length)return void(this.DisplayMessage=i.a.GetResource("PleaseSelectDepreciation"));this.DisplayMessage="Posting 0 of "+this.drrPost.length,this.sbSchdulesDeleted="",this.JVCCID=0;let t,s=this.deprTable.Tables[1].filter(e=>"DepreciationJV"==e.Name);s.length>0&&parseInt(s[0].Value)>0&&(this.JVCCID=parseInt(s[0].Value)),this.iFailure=0,this.dicVouchers.Clear(),this.dicVouchersCnt.Clear();for(let i=0;i<this.drrPost.length;i++)t=this.drrPost[i].VoucherNo.toString(),this.dicVouchers.ContainsKey(t)?(this.dicVouchers[t]+=","+this.drrPost[i].ScheduleID.toString(),this.dicVouchersCnt[t]++):(this.dicVouchers.push(t,this.drrPost[i].ScheduleID.toString()),this.dicVouchersCnt.push(t,1));this.iStart=1,this.iLoop=0,this.PostDepr_CallBack()}PostDepr_CallBack(){if(this.iLoop>=this.dicVouchers.keys.length)return void this.worker_RunWorkerCompleted();let e=this.dicVouchers.keys[this.iLoop];this.DisplayMessage=1==this.dicVouchersCnt[e]?"Posting "+this.iStart+" of "+this.drrPost.length:"Posting ("+this.iStart+"-"+(this.iStart+this.dicVouchersCnt[e]-1)+") of "+this.drrPost.length,g.a.SetsPostDeprReverseJV(this.JVCCID,e,this.dicVouchers[e]).then(t=>{this.DisplayMessage=t.Message,a.e.Int(t.RetValue)>0?(this.sbSchdulesDeleted.length>0&&(this.sbSchdulesDeleted+=","),this.sbSchdulesDeleted+=this.dicVouchers[e]):this.iFailure+=this.dicVouchersCnt[e],this.iStart+=this.dicVouchersCnt[e],this.iLoop++,this.PostDepr_CallBack()})}InitFilterScreen(){this.tree=new Array,this.CostCenterFilters=new Array,this.CostCenters=new c.e(0),this.CostCenters.Label=i.a.GetResource("SelectCostCenter"),this.CostCenters.SelectionChangedCommand.Subscribe(this,"OnCostCenterChange"),i.a.common.GetDataTable("ASS002",i.a.SessionManager.LanguageID).forEach(e=>{let t=parseInt(e.FeatureID);this.CostCenters.Items.push(c.d.ComboBoxItems_2(e.Name.toString(),e.FeatureID.toString())),72==t&&(this.CostCenters.SelectedValue="72",this.CostCenters.SelectedItem=this.CostCenters.Items[this.CostCenters.Items.length-1])}),this.LoadCostCenterTree(parseInt(this.CostCenters.SelectedValue),0,0,null)}OnCostCenterChange(e){if(!a.e.IsEmpty(this.CostCenters.SelectedValue)&&(0==this.tree.length||this.tree[0].CostCenterID!=parseInt(this.CostCenters.SelectedValue))){let e=0;null==this.CostCenters.SelectedItem||a.e.IsEmpty(this.CostCenters.SelectedItem.Parent)||(e=a.e.Int(this.CostCenters.SelectedItem.Parent)),this.LoadCostCenterTree(parseInt(this.CostCenters.SelectedValue),e,0,null)}}LoadCostCenterTree(e,t,s,o){this.tree.Clear();let r,h="";if(50002==e&&"True"==i.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==i.a.SessionManager.Preferences["LW Reports"]&&(h=a.e.IsEmpty(i.a.SessionManager.LocationWhere)?"NodeID IN (-1234)":"NodeID IN ("+i.a.SessionManager.LocationWhere+")"),null==o)for(let i=0;i<this.CostCenterFilters.length;i++){let s=this.CostCenterFilters[i];if(s.CostCenterID==e&&s.LookupTypeID==t){o=s.SelectedNodes;break}}44==e&&t>0&&(h="A.LookupType="+t),r=new p.a,null==o?r.TreeViewModel_5(e,this,s,h,null):r.TreeViewModel_6(e,this,s,h,o,null),r.LookupTypeID=t,r.HeaderVisiblity=!1,r.OnNodeSelected=new S.b,r.OnNodeSelected.Subscribe(this,"OnNodeSelected"),this.tree.push(r)}GetFilters(e){e.strTreeJoin="",e.strTreeWhere="";let t="",s="";this.CostCenterFilters.forEach(i=>{if(s="",72==i.CostCenterID){for(let e=0;e<i.SelectedNodes.length;e++)null!=i.SelectedNodes[e].Parent&&i.SelectedNodes[e].Parent.IsSelected||(s.length>0&&(s+=","),s+=i.SelectedNodes[e].Id);s.length>0&&(e.strTreeJoin+=" join Acc_Assets GTP with(nolock) on Acc.lft between GTP.lft AND GTP.rgt",t+=" and GTP.AssetID in ("+s.toString()+")")}else{for(let e=0;e<i.SelectedNodes.length;e++)i.SelectedNodes[e].IsGroup||(s.length>0&&(s+=","),s+=i.SelectedNodes[e].Id);s.length>0&&(t+=" and CC.CCNID"+(i.CostCenterID-5e4)+" in ("+s.toString()+")")}}),e.strTreeWhere=t.toString()}}},"7fVR":function(e,t,s){"use strict";s.d(t,"a",(function(){return p}));var i=s("Do2H"),a=s("Lp6j"),o=s("eQJW"),r=s("ScVY"),h=s("8B8H"),n=s("ockk"),l=s("CUWK"),D=s("NM0h"),u=s("MCLT");class p extends r.b{constructor(){super(),this.DeprMessage="",this.oparent=null,this.PostVisible=!1,this.DeleteVisible=!1,this.JVCCID=0,this.AssetID=0,this.CreditAcc=0,this.DebitAcc=0,this.IsDeprSummary=!1,this.iFailure=0,this.IsPostingOnScheduleDate=!1,this.AllowEditPostingDate=!1,this.SystemDate=Date.Today(),this.CV=null,this.oNotif=null,this.iLoop=0,this.iStart=0,this.strTo=null,this.strDrAcc=null,this.strCrAcc=null,this.strDeprIDs="",this.strDtColumn="",this.JVOK=!1,this.JVUNOK=!1,this.objAsset=new D.a,this.Title=i.a.GetResource("ASM_ScheduleDepreciation")}get oTable(){return this.Schedules.Table}DepreciationScheduleViewModel_1(e){"AssetManagement"==(null==e?void 0:e.ClassName)?(this.oparent=e,this.AssetID=this.oparent.AssetID,this.PostVisible=!0,this.DeleteVisible=!!i.a.SessionManager.IsActionAssigned(72,"Delete Depreciatin Schedule"),1!=this.oparent.IsFullDispose&&3!=this.oparent.IsFullDispose||(this.PostVisible=!1,this.DeleteVisible=!1)):"ChangeValue"==(null==e?void 0:e.ClassName)&&(this.CV=e,this.PostVisible=!1,this.DeleteVisible=!1),this.InitGrid()}DepreciationScheduleViewModel_2(e,t){this.oNotif=t;let s=e.Tables[1].filter(e=>"DepreciationJV"==e.Name);s.length>0&&parseInt(s[0].Value)>0&&(this.JVCCID=parseInt(s[0].Value)),s=e.Tables[1].filter(e=>"ClubDeprPosting"==e.Name),s.length>0&&"TRUE"==s[0].Value.toString().toUpperCase()&&(this.IsDeprSummary=!0),this.worker_DoWork()}worker_RunWorkerCompleted(){this.oNotif.Enable=!0,this.oNotif.DisplayMessage=this.DeprMessage,this.oNotif.DeprDataFilling()}worker_DoWork(){this.oNotif.Enable=!1;let e=this.oNotif.DepreciationGrid.Table;this.drrPost=e.length>0?e.filter(e=>e.select&&Object(u.isNullOrUndefined)(e.DocID)):[],0!=this.drrPost.length?(this.oNotif.DisplayMessage="Posting 0 of "+this.drrPost.length,this.iFailure=0,this.IsDeprSummary?(this.iStart=0,this.strDeprIDs="",this.strDtColumn=this.oNotif.AllowEditPostingDate?"PostDate_Key":"ToDate",this.drrPost=e.filter(e=>e.select&&Object(u.isNullOrUndefined)(e.DocID)),this.drrPost.SortBy([this.strDtColumn,"DebitAccount","CreditAccount"]),this.iLoop=0,this.PostDeprJV_CallBack()):(this.iLoop=0,this.PostDeprJVDetail_CallBack())):this.oNotif.DisplayMessage=i.a.GetResource("PleaseSelectDepreciation")}PostDeprJV_CallBack(){if(this.iLoop>=this.drrPost.length)this.strDeprIDs.length>0?(this.oNotif.DisplayMessage="Posting ("+(this.iStart+1)+"-"+this.drrPost.length+") of "+this.drrPost.length,this.PostDeprJV_Summary(this.strDeprIDs,this.strTo,this.strDrAcc,this.strCrAcc,this.iStart,this.drrPost.length).then(e=>{this.worker_RunWorkerCompleted()})):this.worker_RunWorkerCompleted();else{for(;this.iLoop<this.drrPost.length;this.iLoop++){if(this.strTo!=this.drrPost[this.iLoop][this.strDtColumn].toString()||this.strDrAcc!=this.drrPost[this.iLoop].DebitAccount.toString()||this.strCrAcc!=this.drrPost[this.iLoop].CreditAccount.toString()){if(this.strDeprIDs.length>0)return this.oNotif.DisplayMessage="Posting ("+(this.iStart+1)+"-"+this.iLoop+") of "+this.drrPost.length,this.PostDeprJV_Summary(this.strDeprIDs,this.strTo,this.strDrAcc,this.strCrAcc,this.iStart,this.iLoop).then(e=>{this.PostDeprJV_CallBack()}),this.strDeprIDs="",this.strTo=this.drrPost[this.iLoop][this.strDtColumn].toString(),this.strDrAcc=this.drrPost[this.iLoop].DebitAccount.toString(),this.strCrAcc=this.drrPost[this.iLoop].CreditAccount.toString(),void(this.iStart=this.iLoop);this.strDeprIDs="",this.strTo=this.drrPost[this.iLoop][this.strDtColumn].toString(),this.strDrAcc=this.drrPost[this.iLoop].DebitAccount.toString(),this.strCrAcc=this.drrPost[this.iLoop].CreditAccount.toString(),this.iStart=this.iLoop}this.strDeprIDs.length>0&&(this.strDeprIDs+=","),this.strDeprIDs+=this.drrPost[this.iLoop].ScheduleID.toString()}this.strDeprIDs.length>0&&this.PostDeprJV_CallBack()}}PostDeprJVDetail_CallBack(){if(this.iLoop>=this.drrPost.length)return void this.worker_RunWorkerCompleted();let e="";e="",e+="<JVXML>",e+="<ROWS>",e+='<DepreciationID DepID="'+this.drrPost[this.iLoop].ScheduleID.toString()+'" AssetID="'+this.drrPost[this.iLoop].AssetID.toString()+'"',a.e.IsEmpty(this.drrPost[this.iLoop].PostDate_Key)||(e+=' Dt="'+new Date(this.drrPost[this.iLoop].PostDate_Key).ToString("dd MMM yyyy")+'"'),e+="/>",e+="</ROWS>",e+="</JVXML>",this.oNotif.DisplayMessage="Posting "+(this.iLoop+1)+" of "+this.drrPost.length;let t=0;this.objAsset.PostAssetID=this.AssetID,this.objAsset.PostCCID=this.JVCCID,this.objAsset.JVXML=e.toString(),this.objAsset.Post=!0,this.objAsset.PostDeprJV().subscribe(e=>{this.DisplayMessage=e.Message,t=e.RetValue,t<=0&&this.iFailure++,this.DeprMessage=this.DisplayMessage,this.iLoop++,this.PostDeprJVDetail_CallBack()})}PostDeprJV_Summary(e,t,s,i,a,o){let r=new Date(t);return this.oNotif.AllowEditPostingDate||this.oNotif.IsPostingOnScheduleDate||(r=this.oNotif.SystemDate),this.objAsset.PostDeprJVSummary(this.JVCCID,r,s,i,e).then(e=>{this.DisplayMessage=e.Message,e.RetValue<=0&&(this.iFailure+=o-a),this.DeprMessage=this.DisplayMessage})}InitGrid(){this.Schedules=new h.a,this.Schedules.Width="",this.Schedules.Height=400,this.Schedules.TableColumns.push("ID"),this.Schedules.TableColumns.push("period"),this.Schedules.TableColumns.push("From"),this.Schedules.TableColumns.push("FromText"),this.Schedules.TableColumns.push("To"),this.Schedules.TableColumns.push("ToText"),this.Schedules.TableColumns.push("DepAmt"),this.Schedules.TableColumns.push("AccDep"),this.Schedules.TableColumns.push("AccDepWithPrev"),this.Schedules.TableColumns.push("NetValue"),this.Schedules.TableColumns.push("Status"),this.Schedules.TableColumns.push("DocID"),this.Schedules.TableColumns.push("DocNo"),this.Schedules.TableColumns.push("select"),this.Schedules.TableColumns.push("PostingDate"),this.Schedules.TableColumns.push("CostCenterID"),this.Schedules.TableColumns.push("PostingDate_Key"),this.Schedules.TableColumns.push("DocumentName"),this.Schedules.TableColumns.push("DocPrefix"),this.Schedules.TableColumns.push("DocNumber"),this.oColumns=new Array;let e=new n.a;e.Header="#",e.DisplayMember="period",e.ReadOnly=!0,e.Width=45,e.IsFrozen=!0,this.oColumns.push(e),e=new n.a,e.Header=i.a.GetResource("From"),e.DisplayMember="FromText",e.ReadOnly=!0,e.Width=90,e.IsFrozen=!0,this.oColumns.push(e),e=new n.a,e.Header=i.a.GetResource("To"),e.DisplayMember="ToText",e.ReadOnly=!0,e.Width=90,e.IsFrozen=!0,this.oColumns.push(e),e=new n.a,e.Header="Depr. Amount",e.DisplayMember="DepAmt",e.IsCalculated=1,e.Width=95,e.ReadOnly=!0,e.DataType="FLOAT",this.oColumns.push(e),e=new n.a,e.Header="Acc. Depr",e.DisplayMember="AccDepWithPrev",e.IsCalculated=1,e.Width=100,e.ReadOnly=!0,e.DataType="FLOAT",this.oColumns.push(e),e=new n.a,e.Header="Net Value",e.DisplayMember="NetValue",e.IsCalculated=1,e.Width=100,e.ReadOnly=!0,e.DataType="FLOAT",this.oColumns.push(e),e=new n.a,e.Header=i.a.GetResource("Status"),e.DisplayMember="Status",e.ReadOnly=!0,e.Width=80,this.oColumns.push(e),null!=this.CV&&(e=new n.a,e.Header="Actual Depr",e.DisplayMember="ActualDeprAmt",e.IsCalculated=1,e.Width=100,e.ReadOnly=!0,e.DataType="FLOAT",this.oColumns.push(e)),null!=this.oparent&&(e=new n.a,e.Header=i.a.GetResource("DocumentDesigner_VoucherNo"),e.DisplayMember="DocNo",e.DataType="LINK",e.ReadOnly=!0,e.Width=140,this.oColumns.push(e),e=new n.a,e.Header=i.a.GetResource("select"),e.DisplayMember="select",e.DataType="CheckBox",e.Width=60,this.oColumns.push(e)),this.AllowEditPostingDate=i.a.SessionManager.IsActionAssigned(72,"Allow editing of depreciation posting date"),this.AllowEditPostingDate&&null!=this.oparent&&(this.Schedules.TableColumns.push("PostDate_Key"),this.Schedules.TableColumns.push("PostDate"),e=new n.a,e.Header="Post Date",e.DisplayMember="PostDate",e.DataType="DATE",e.Width=110,e.ReadOnly=!1,this.oColumns.push(e)),e=new n.a,e.Header=i.a.GetResource("DocID"),e.DisplayMember="CostCenterID",e.IsVisible=!1,e.Width=80,this.oColumns.push(e),this.Schedules.OnLinkClick.Subscribe(this,"OnLinkClickEvent"),this.Schedules.Table=[],this.Schedules.addEmptyRow(),this.Schedules.addEmptyRow(),this.Schedules.addEmptyRow(),this.Schedules.addEmptyRow(),this.Schedules.addEmptyRow(),this.Schedules.addEmptyRow(),this.Schedules.addEmptyRow(),this.Schedules.Columns=this.oColumns}OnLinkClickEvent(e,t,s){l.RibbonExtViewModel.LoadDocument(e),i.a.page.HideDialog()}LoadData(e,t,s){this.Schedules.Clear();let o=this.oparent.ScreenObject.Data.Tables[4].filter(e=>"DepreciationJV"==e.Name);o.length>0&&parseInt(o[0].Value)>0&&(this.JVCCID=parseInt(o[0].Value)),a.e.IsEmpty(e.Tables[4][0].AccumDeprACCID)||(this.CreditAcc=parseInt(e.Tables[4][0].AccumDeprACCID.toString())),a.e.IsEmpty(e.Tables[4][0].DeprExpenseACCID)||(this.DebitAcc=parseInt(e.Tables[4][0].DeprExpenseACCID.toString()));let r=a.e.Double(e.Tables[4][0].PreviousDepreciation);if(o=this.oparent.ScreenObject.Data.Tables[4].filter(e=>"AssetDeprPostDate"==e.Name),o.length>0&&"ScheduleDate"==o[0].Value.toString()&&(this.IsPostingOnScheduleDate=!0),e.Tables.length>10){let o=1;e.Tables[10].filter(e=>new Date(e.FromDate)>=t&&new Date(e.ToDate)<=s).forEach(e=>{let t=this.Schedules.NewRow();t.period=(o++).toString(),t.From=e.FromDate,t.ID=e.ScheduleID,t.FromText=new Date(e.FromDate).ToString(i.a.SessionManager.Preferences["Date Format"]),t.To=e.ToDate,t.ToText=new Date(e.ToDate).ToString(i.a.SessionManager.Preferences["Date Format"]),t.DocID=e.DocID,t.DocNo=e.VoucherNo,t.Status=e.StatusID,t.CostCenterID=e.CostCenterID,t.DocPrefix=e.DocPrefix,t.DocNumber=e.DocNumber,t.DocumentName=e.DocumentName,t.DepAmt=parseFloat(e.DeprAmt).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount),t.AccDep=parseFloat(e.accmDepr).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount),t.NetValue=parseFloat(e.NetValue).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount),t.AccDepWithPrev=(parseFloat(e.accmDepr)+r).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount),t.select=!1,this.AllowEditPostingDate&&a.e.IsEmpty(t.DocNo)&&(this.IsPostingOnScheduleDate?(t.PostDate_Key=e.ToDate,t.PostDate=new Date(e.ToDate).ToString(i.a.SessionManager.Preferences["Date Format"])):(t.PostDate_Key=this.SystemDate,t.PostDate=this.SystemDate.ToString(i.a.SessionManager.Preferences["Date Format"]))),this.Schedules.addRow(t)})}}GetJVXML(){let e="",t=0;return e+="<JVXML>",this.oTable.forEach(s=>{!a.e.IsEmpty(s.select)&&Object(o.j)(s.select)&&a.e.IsEmpty(s.DocID)&&(t++,e+='<ROWS><DepreciationID DepID="'+s.ID.toString()+'" AssetID="'+this.AssetID+'"',this.Schedules.TableColumns.Contains("PostDate_Key")&&(e+=' Dt="'+new Date(s.PostDate_Key).ToString("dd MMM yyyy")+'"'),e+="/>",e+="</ROWS>")}),t>0&&(this.JVOK=!0),e+="</JVXML>",e.toString()}GetUnPostJVXML(){let e="",t=0;e+="<JVXML>";for(let s=this.oTable.length-1;s>=0;s--)a.e.IsEmpty(this.oTable[s].select)||!Object(o.j)(this.oTable[s].select)||a.e.IsEmpty(this.oTable[s].DocID)||(t++,e+='<DepreciationID DepID="'+this.oTable[s].ID.toString()+'" AssetID="'+this.AssetID+'"></DepreciationID>');return e+="</JVXML>",t>0&&(this.JVUNOK=!0),e.toString()}OnButtonClick(e){if(this.DisplayMessage="","Cancel"==e)i.a.page.HideDialog();else if("Delete"==e){if(!confirm("Do you want to delete depreciation schedule?"))return;let e=D.a.DeleteAssetDeprSchedule(this.AssetID);this.DisplayMessage=e.Message,a.e.Int(e.RetValue)>0&&(this.oparent.ds.Tables[10].Clear(),this.Schedules.Clear())}else if("Post"==e){let e=0;this.objAsset.PostAssetID=this.AssetID,this.objAsset.PostCCID=this.JVCCID,this.objAsset.JVXML=this.GetJVXML(),this.objAsset.Post=!0,this.JVOK?this.objAsset.PostDeprJV().subscribe(t=>{if(e=t.RetValue,this.DisplayMessage=t.Message,e>0){let e=0;for(let t=0;t<this.oTable.length;t++)if(!a.e.IsEmpty(this.oTable[t].select)&&Object(o.j)(this.oTable[t].select)&&a.e.IsEmpty(this.oTable[t].DocID)){this.oparent.ViewTransactionHistory.TransactionHisInfoObj.addEmptyRow();let s=this.oparent.ViewTransactionHistory.TransactionHisInfo.length-1;0==s?e=this.oparent.GetDeprStartValue():s>0&&(e=0==t?this.oparent.GetDeprStartValue():parseFloat(this.oTable[t-1].NetValue.toString())),this.oparent.ViewTransactionHistory.TransactionHisInfo[s].Type="Depreciation Schedule Post",this.oparent.ViewTransactionHistory.TransactionHisInfo[s].Date=Date.Today().ToString("dd/MMM/yyyy"),this.oparent.ViewTransactionHistory.TransactionHisInfo[s].OldValue=e,this.oparent.ViewTransactionHistory.TransactionHisInfo[s].ChangeType="6",this.oparent.ViewTransactionHistory.TransactionHisInfo[s].Percentage=this.oTable[t].DepAmt.toString(),this.oparent.ViewTransactionHistory.TransactionHisInfo[s].NewValue=e-parseFloat(this.oTable[t].DepAmt.toString()),null!=this.oTable[t].DepAmt&&""!=this.oTable[t].DepAmt&&this.oparent.CurrentValueCallBack(e-parseFloat(this.oTable[t].DepAmt.toString())),this.oparent.ViewTransactionHistory.TransactionHisInfoObj.updateRow(this.oparent.ViewTransactionHistory.TransactionHisInfo[s])}return this.LoadData(D.a.GetAssetManagementDetails(this.AssetID),this.oparent.DeprFromDate,this.oparent.DeprToDate),this.MessageVisibility=!0,void(this.JVOK=!1)}}):this.DisplayMessage="Please select record to post"}else if("UnPost"==e){let e=0;this.objAsset.PostAssetID=this.AssetID,this.objAsset.PostCCID=this.JVCCID,this.objAsset.JVXML=this.GetUnPostJVXML(),this.objAsset.Post=!1,this.JVUNOK?this.objAsset.PostDeprJV().subscribe(t=>{if(e=t.RetValue,this.DisplayMessage=t.Message,e>0){let e=0;for(let t=this.oTable.length-1;t>=0;t--)if(!a.e.IsEmpty(this.oTable[t].select)&&Object(o.j)(this.oTable[t].select)&&!a.e.IsEmpty(this.oTable[t].DocID)){this.oparent.ViewTransactionHistory.TransactionHisInfoObj.addEmptyRow();let s=this.oparent.ViewTransactionHistory.TransactionHisInfo.length-1;0==s?e=this.oparent.GetDeprStartValue():s>0&&(e=0==t?this.oparent.GetDeprStartValue():parseFloat(this.oTable[t-1].NetValue.toString())),this.oparent.ViewTransactionHistory.TransactionHisInfo[s].Type="Depreciation Schedule UnPost",this.oparent.ViewTransactionHistory.TransactionHisInfo[s].Date=Date.Today().ToString("dd/MMM/yyyy"),this.oparent.ViewTransactionHistory.TransactionHisInfo[s].OldValue=e-parseFloat(this.oTable[t].DepAmt.toString()),this.oparent.ViewTransactionHistory.TransactionHisInfo[s].ChangeType="6",this.oparent.ViewTransactionHistory.TransactionHisInfo[s].Percentage=this.oTable[t].DepAmt.toString(),this.oparent.ViewTransactionHistory.TransactionHisInfo[s].NewValue=e,null!=this.oTable[t].DepAmt&&""!=this.oTable[t].DepAmt&&this.oparent.CurrentValueCallBack(e),this.oparent.ViewTransactionHistory.TransactionHisInfoObj.updateRow(this.oparent.ViewTransactionHistory.TransactionHisInfo[s])}return this.LoadData(D.a.GetAssetManagementDetails(this.AssetID),this.oparent.DeprFromDate,this.oparent.DeprToDate),this.MessageVisibility=!0,void(this.JVUNOK=!1)}}):this.DisplayMessage="Please select record to Un post"}}}},NM0h:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var i=s("Do2H"),a=s("Lp6j");class o{constructor(){this.ChangeValueXML=null,this.DetailsXML=null,this.AMCode=null,this.AMName=null,this.AMPurchaseValue=null,this.HistoryXML=null,this.DocNo=null,this.XML=null,this.DocSave=null,this.CodePrefix=null,this.Sno=null,this.AssetClassID=0,this.DeprBookID=0,this.AcqnCostACCID=0,this.AccumDeprACCID=0,this.AcqnCostDispACCID=0,this.AccumDeprDispACCID=0,this.GainsDispACCID=0,this.LossDispACCID=0,this.MaintExpenseACCID=0,this.DeprExpenseACCID=0,this.PostingGroupID=0,this.AMStatusID=0,this.CodeNumber=0,this.AMAssetID=0,this.AMParentAssetID=0,this.IsGroup=!1,this.Post=!1,this.StatusID=0,this.DeprBookMethod=0,this.DeprBookMethodBasedOn=0,this.AveragingMethodID=0,this.DeprScheduleID=0,this.DeprTypeID=0,this.AssetClassCode=null,this.AssetClassName=null,this.GUID=null,this.DeprBookCode=null,this.DeprBookName=null,this.PostGroupCode=null,this.PostGroupName=null,this.AMGUID=null,this.RecordType=null,this.AMGroup=!1,this.IsIncreaseAssetValue=!1,this.EmpName=null,this.EmpCode=null,this.EmpID=0,this.SelectedNodeID=0,this.PostCCID=0,this.PostAssetID=0,this.ScheduleID=0,this.LocationID=0,this.AddressXML=null,this.NotesXML=null,this.ContactsXML=null,this.CustomCostCenterFieldsQuery=null,this.CustomFieldsQuery=null,this.PrimaryContactQuery=null,this.AttachmetsXML=null,this.DepreciationXML=null,this.JVXML=null,this.Description=null,this.DeprStartValue=0,this.ChangeVal=0,this.AssetNetValueChange=0,this.DeprBookMethodBasedOnValue=0,this.TotalYears=0}static GetAssetClassDetails(e){let t=[];return t.push(e),t.push(i.a.SessionManager.UserID),t.push(i.a.SessionManager.LanguageID),i.a.accounting.GetAssetClassDetails(t)}static GetPostingGroupDetails(e){let t=[];return t.push(e),t.push(i.a.SessionManager.UserID),t.push(i.a.SessionManager.LanguageID),i.a.accounting.GetPostingGroupDetails(t)}SaveAssetClass(){0==this.AssetClassID&&(this.GUID=a.e.NewGuid());let e=[];return e.push(this.AssetClassID),e.push(null!=this.AssetClassCode?this.AssetClassCode:""),e.push(null!=this.AssetClassName?this.AssetClassName:""),e.push(this.PostingGroupID),e.push(this.DeprBookID),e.push(this.DeprTypeID),e.push(this.TotalYears),e.push(this.StatusID),e.push(i.a.SessionManager.CompanyGUID),e.push(this.GUID),e.push(""),e.push(i.a.SessionManager.UserName),e.push(i.a.SessionManager.UserID),e.push(i.a.SessionManager.LanguageID),i.a.accounting.SetAssetClass(e)}static GetDeprBookDetails(e){let t=[];return t.push(e),t.push(i.a.SessionManager.UserID),t.push(i.a.SessionManager.LanguageID),i.a.accounting.GetDeprBookDetails(t)}PostJVvoucher(){this.GUID=a.e.NewGuid();let e=[];return e.push(this.PostAssetID),e.push(this.PostCCID),e.push(this.JVXML),e.push(this.Post),e.push(this.DeprTypeID),e.push(this.DocXML),e.push(this.DocSave),e.push(this.DepreciationXML),e.push(this.RecordType),e.push(i.a.SessionManager.CompanyGUID),e.push(this.GUID),e.push(i.a.SessionManager.UserName),e.push(i.a.SessionManager.UserID),e.push(i.a.SessionManager.LanguageID),i.a.accounting.GetPostJvVoucher(e)}SetAssetDispose(e){this.GUID=a.e.NewGuid();let t=[];return t.push(this.PostAssetID),t.push(e.ToString("dd/MMM/yyyy")),t.push(this.PostCCID),t.push(this.JVXML),t.push(this.Post),t.push(this.DeprTypeID),t.push(this.DocXML),t.push(this.DocSave),t.push(this.DepreciationXML),t.push(this.RecordType),t.push(i.a.SessionManager.CompanyGUID),t.push(this.GUID),t.push(i.a.SessionManager.UserName),t.push(i.a.SessionManager.UserID),t.push(i.a.SessionManager.LanguageID),i.a.accounting.SetAssetDispose(t)}SaveDeprBook(e,t,s){0==this.DeprBookID&&(this.GUID=a.e.NewGuid());let o=[];return o.push(this.DeprBookID),o.push(this.DeprBookCode),o.push(this.DeprBookName),o.push(this.DeprBookMethod),o.push(this.DeprBookMethodBasedOn),o.push(this.DeprBookMethodBasedOnValue),o.push(this.StatusID),o.push(this.AveragingMethodID),o.push(e),o.push(t),o.push(s),o.push(i.a.SessionManager.CompanyGUID),o.push(this.GUID),o.push(""),o.push(i.a.SessionManager.UserName),o.push(i.a.SessionManager.UserID),o.push(i.a.SessionManager.LanguageID),i.a.accounting.SetDeprBook(o)}SaveFAPostingGroup(){0==this.PostingGroupID&&(this.GUID=a.e.NewGuid());let e=[];return e.push(this.PostingGroupID),e.push(this.PostGroupCode),e.push(this.PostGroupName),e.push(this.AcqnCostACCID),e.push(this.AccumDeprACCID),e.push(this.AcqnCostDispACCID),e.push(this.AccumDeprDispACCID),e.push(this.GainsDispACCID),e.push(this.LossDispACCID),e.push(this.MaintExpenseACCID),e.push(this.DeprExpenseACCID),e.push(this.StatusID),e.push(0),e.push(this.IsGroup),e.push(i.a.SessionManager.CompanyGUID),e.push(this.GUID),e.push(i.a.SessionManager.UserName),e.push(i.a.SessionManager.UserID),e.push(i.a.SessionManager.LanguageID),i.a.accounting.SetPostingGroup(e)}static GetAssetManagementDetails(e){let t=[];return t.push(e),t.push(i.a.SessionManager.UserID),t.push(i.a.SessionManager.LanguageID),i.a.accounting.GetAssetManagementDetails(t)}static GetAssetDeprSchDetails(e){let t=[];return t.push(e),t.push(i.a.SessionManager.UserID),t.push(i.a.SessionManager.LanguageID),i.a.accounting.GetAssetDeprSchDetails(t)}SetAssetManagementDetails(){let e=[];return e.push(this.AMAssetID),e.push(this.AMCode),e.push(this.AMName),e.push(this.AMStatusID),e.push(this.AMPurchaseValue),e.push(this.AMParentAssetID),e.push(this.AMGroup),e.push(this.CodePrefix),e.push(this.CodeNumber),e.push(this.Sno),e.push(this.DetailsXML),e.push(this.ChangeValueXML),e.push(this.CustomFieldsQuery),e.push(this.CustomCostCenterFieldsQuery),e.push(this.DepreciationXML),e.push(this.HistoryXML),e.push(this.NotesXML),e.push(this.AttachmetsXML),e.push(i.a.SessionManager.CompanyGUID),e.push(this.AMGUID),e.push(i.a.SessionManager.UserName),e.push(i.a.SessionManager.UserID),e.push(i.a.SessionManager.LanguageID),i.a.accounting.SetAssetManagementDetails(e).toPromise()}static DeleteAsset(e){let t=[];return t.push(e),t.push(i.a.SessionManager.UserID),t.push(i.a.SessionManager.RoleID),i.a.accounting.DeleteAsset(t)}static DeleteAssetDeprSchedule(e){let t=[];return t.push(e),t.push(i.a.SessionManager.RoleID),t.push(i.a.SessionManager.LanguageID),i.a.accounting.DeleteAssetDeprSchedule(t)}static DeleteAssetRefDoc(e,t){let s=[];return s.push(e),s.push(t),s.push(i.a.SessionManager.UserID),i.a.accounting.DeleteAssetRefDoc(s)}PostDeprJV(){this.GUID=a.e.NewGuid();let e=[];return e.push(this.PostCCID),e.push(this.JVXML),e.push(this.Post),e.push(i.a.SessionManager.CompanyGUID),e.push(this.GUID),e.push(i.a.SessionManager.UserName),e.push(i.a.SessionManager.UserID),e.push(i.a.SessionManager.LanguageID),e.push(i.a.SessionManager.RoleID),i.a.accounting.PostDeprJV(e)}PostDeprJVSummary(e,t,s,o,r){this.GUID=a.e.NewGuid();let h=[];return h.push(e),h.push(t),h.push(s),h.push(o),h.push(r),h.push(i.a.SessionManager.CompanyGUID),h.push(i.a.SessionManager.UserName),h.push(i.a.SessionManager.UserID),h.push(i.a.SessionManager.LanguageID),i.a.accounting.SetDeprPostingJVSummary(h).toPromise()}static SetsPostDeprReverseJV(e,t,s){let a=[];return a.push(e),a.push(t),a.push(s),a.push(i.a.SessionManager.CompanyGUID),a.push(i.a.SessionManager.UserName),a.push(i.a.SessionManager.UserID),a.push(i.a.SessionManager.LanguageID),i.a.accounting.SetsPostDeprReverseJV(a)}ChangeValue(e,t){this.GUID=a.e.NewGuid();let s=[];return s.push(this.PostAssetID),s.push(e),s.push(this.ChangeVal),s.push(this.AssetNetValueChange),s.push(t.ToString("dd/MMM/yyyy")),s.push(this.Description),s.push(this.DepreciationXML),s.push(this.ChangeValueXML),s.push(this.HistoryXML),s.push(this.LocationID),s.push(this.IsIncreaseAssetValue),s.push(this.JVXML),s.push(this.ChangeValueTypeID),s.push(i.a.SessionManager.CompanyGUID),s.push(this.GUID),s.push(i.a.SessionManager.UserName),s.push(i.a.SessionManager.UserID),s.push(i.a.SessionManager.LanguageID),i.a.accounting.SetAssetChangeValue(s)}DisposeReverse(e){let t=[];return t.push(e),t.push(i.a.SessionManager.UserName),t.push(i.a.SessionManager.UserID),t.push(i.a.SessionManager.LanguageID),i.a.accounting.DisposeReverse(t)}}}}]);
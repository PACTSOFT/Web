(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{JUeo:function(e,t,i){"use strict";i.r(t),i.d(t,"ProductSearchField",(function(){return P})),i.d(t,"PactListSearchViewModel",(function(){return b})),i.d(t,"ProductSearchCatalogViewModel",(function(){return g}));var s=i("Do2H"),n=i("Lp6j"),r=i("eQJW"),a=i("ScVY"),o=i("0/4Q"),l=i("JIg3"),c=i("ockk"),d=i("6z9j"),h=i("n56n"),u=i("8B8H"),C=i("EQd/"),m=i("N0aR"),D=i("4/f/"),S=i("4HhE");class P extends S.c{constructor(e,t,i,s,r,a,l,c,d){if(super(),this.IsColumnInuse=!1,this.OtherDimensions=null,this.OtherDimensionsTbl=null,this.IsEvaluated=!1,this.IsParentFilter=!1,this.OtherDimensionDisplayMember=null,this.IsColumnInuse=a,this.DataType=e,this.ColumnName=t,this.Header=i,this.Condition=new o.e(0),this.FromValue=new C.d(0),this.CC=new h.b(0),c.Contains("~")){let e=c.split("~");this.OtherDimensions=[],this.OtherDimensionsTbl=[];for(let t=0;t<e.length;t++)this.OtherDimensions.push(),this.OtherDimensionsTbl.push(),this.OtherDimensions[t]=parseInt(e[t])}else"PARENT"==c&&(this.IsParentFilter=!0);let u=n.e.Int(s);u>0?(this.CC.CCID=u,u=1,u=n.e.Int(r),this.CC.TypeID=u,this.CC.Visible=!0,this.CC.Label=this.Header,l>0&&(this.CC.SelectedValue=l),3==this.CC.CCID&&0==this.CC.SelectedValue&&(this.CC.SelectedValue=-1),113==this.CC.CCID&&(this.CC.CustomWhere="CostCenterID="+d),this.Condition.Visible=!1,this.FromValue.Visible=!1):(this.CC.Visible=!1,this.Condition.Visible=!0,this.FromValue.Visible=!0,this.Condition.LblWidth="1",this.FromValue.LblWidth="1"),this.LoadConditions(this.DataType)}LoadConditions(e){this.Condition.Items.Clear(),this.Condition.Items.push(o.d.ComboBoxItems_2(s.a.GetResource("Com_Equals"),"1")),this.Condition.Items.push(o.d.ComboBoxItems_2(s.a.GetResource("Com_NotEquals"),"2")),this.Condition.Items.push(o.d.ComboBoxItems_2(s.a.GetResource("Com_BeginsWith"),"3")),this.Condition.Items.push(o.d.ComboBoxItems_2(s.a.GetResource("Com_EndsWith"),"4")),this.Condition.Items.push(o.d.ComboBoxItems_2(s.a.GetResource("Com_Contains"),"5")),this.Condition.Items.push(o.d.ComboBoxItems_2(s.a.GetResource("Com_NotContains"),"6")),this.Condition.SelectedValue="5"}}class b{constructor(e){this.ToSearch=e}onClick(e){"AddNew"==e||"Cancel"!=e&&"click"!=e||s.a.page.HideDialog()}}class g extends a.b{constructor(e,t,i,a,h){if(super(),this.ProductID=null,this.ProductName=null,this.Width=0,this.ProductCode=null,this.FullTextSearchCtrl=new C.d,this.GridDataObj=new u.a,this.SelectedGridObj=new u.a,this.ProductsGridDataObj=new u.a,this.AllProducstsVisibility=!0,this.GridDataVisibility=!0,this.GrHeight=0,this.GrWidth=0,this.ReportVisibility=!1,this.IsDocument=!1,this.ReportsDialogVisibility=!1,this.SelectedItemsVisiblility=!0,this.Report=null,this.Options=new o.e(0),this.Reports=new o.e(0),this.ReportFromDate=new l.a(0),this.ReportToDate=new l.a(0),this.NextPrevious=!1,this.qtycc=[],this.Parent=null,this.GridViewID=0,this.CostCenterID=0,this.DisplayCOl=null,this.lstctrl=null,this.GridFilter="",this.sBarcodeWhere="",this.sFulltextSearchWhere="",this.lst=[],this.CostCenterID=i,this.GridViewID=t,this.DisplayCOl=a,this.lstctrl=h,this.Options.Label=s.a.GetResource("SearchType"),this.FullTextSearchCtrl.Label=s.a.GetResource("Tree_Fulltext"),this.Options.LblWidth="120",this.FullTextSearchCtrl.LblWidth="120",this.DisplayName=this.Title=s.a.GetResource("Search"),null!=e||null!=this.lstctrl?(this.Parent=e,this.IsDocument=!0,this.GrHeight=210):(this.IsDocument=!1,this.GrHeight=500),this.Options.Items.push(o.d.ComboBoxItems_2("All","3")),this.Options.Items.push(o.d.ComboBoxItems_2("Basic","0")),this.Options.Items.push(o.d.ComboBoxItems_2("Subtitutes","1")),this.Options.Items.push(o.d.ComboBoxItems_2("Linked","2")),this.Options.SelectedValue="3",3!=this.CostCenterID)this.NextPrevious=!0,this.Options.Visible=!1,this.SelectedItemsVisiblility=!1,null!=h&&(this.CostCenterID=h.CCID,this.GridViewID=h.GridViewID);else{null==e||"AddEditDocumentViewModel"!=e.ClassName||n.e.IsEmpty(e.HoldProdSearch)?e instanceof d.a&&(this.SelectedItemsVisiblility=!1):this.FullTextSearch=e.HoldProdSearch,this.setFullTextSearch=!1;let t=!1;s.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&n.e.Int(s.a.SessionManager.Preferences["Maintain Dimensionwise stock"])>0&&this.qtycc.push(n.e.Int(s.a.SessionManager.Preferences["Maintain Dimensionwise stock"])),s.a.SessionManager.Preferences.ContainsKey("Location Stock")&&Object(r.j)(s.a.SessionManager.Preferences["Location Stock"])&&this.qtycc.push(50002),t=!1,s.a.SessionManager.Preferences.ContainsKey("Division Stock")&&Object(r.j)(s.a.SessionManager.Preferences["Division Stock"])&&this.qtycc.push(50001)}this.ProductFields=[];let m,D=s.a.inventory.GetProductSearchFields(this.GridViewID);if(null!=D&&D.Tables.length>0&&!D.Columns[0].Contains("ErrorMessage"))for(let s=0;s<D.Tables[0].length;s++)if(D.Tables[0][s].SysColumnName=n.e.String(D.Tables[0][s].SysColumnName),!D.Columns[0].Contains("columntype")||n.e.IsEmpty(D.Tables[0][s].columntype)||"2"!=D.Tables[0][s].columntype.toString())if("Dropdown"!=D.Tables[0][s].description.toString()||""==D.Tables[0][s].costcentercolid.toString()||261!=parseInt(D.Tables[0][s].costcentercolid.toString())&&262!=parseInt(D.Tables[0][s].costcentercolid.toString())){let t=0;"AddEditDocumentViewModel"==e.ClassName&&null!=e.SelectedRow&&D.Tables[0][s].SysColumnName.toString().startsWith("CCNID")&&e.SelectedRowColumns.Contains("dc"+D.Tables[0][s].SysColumnName.toString()+"_Key")&&!n.e.IsEmpty(e.SelectedRow["dc"+D.Tables[0][s].SysColumnName.toString()+"_Key"])&&(t=parseInt(e.SelectedRow["dc"+D.Tables[0][s].SysColumnName.toString()+"_Key"])),console.log(D.Tables[0]),this.ProductFields.push(new P(n.e.String(D.Tables[0][s].ColumnDataType),n.e.String(D.Tables[0][s].SysColumnName),n.e.String(D.Tables[0][s].ResourceData),n.e.String(D.Tables[0][s].ColumnCostCenterID),n.e.String(D.Tables[0][s].ColumnCCListViewTypeID),Object(r.j)(D.Tables[0][s].iscolumninuse),t,D.Tables[0][s].description.toString(),this.CostCenterID))}else 261==parseInt(D.Tables[0][s].costcentercolid.toString())?this.ProductFields.push(new P("ListBox",D.Tables[0][s].SysColumnName.toString(),D.Tables[0][s].Resourcedata.toString(),"3","100",Object(r.j)(D.Tables[0][s].iscolumninuse.toString()),0,D.Tables[0][s].description.toString(),this.CostCenterID)):262==parseInt(D.Tables[0][s].costcentercolid.toString())&&this.ProductFields.push(new P("ListBox",D.Tables[0][s].SysColumnName.toString(),D.Tables[0][s].Resourcedata.toString(),"3","10",Object(r.j)(D.Tables[0][s].iscolumninuse.toString()),0,D.Tables[0][s].description.toString(),this.CostCenterID));if(m=new c.a,m.Header="#",m.DisplayMember="Sno",m.DataType="TextBlock",m.Width=24,m.IsVisible=!0,m.ReadOnly=!0,m.IsFrozen=!0,this.ColumnSource.push(m),3==this.CostCenterID&&(m=new c.a,m.Header="#",m.DisplayMember="Sno",m.DataType="TextBlock",m.Width=24,m.ReadOnly=!0,this.SelectedColumnSource.push(m)),null==D||D.Tables.length>0&&D.Columns[0].Contains("ErrorMessage"))return D.Tables[0].length>0&&(this.DisplayMessage=D.Tables[0][0].ErrorMessage.toString()),void(this.MessageVisibility=!0);this.Width=null!=this.Parent&&null!=D&&D.Tables.length>2&&!D.Columns[2].Contains("ErrorMessage")&&D.Tables[2].length>0&&!n.e.IsEmpty(D.Tables[2][0].ColumnWidth)?parseInt(D.Tables[2][0].ColumnWidth):1e3,null!=D&&D.Tables.length>2&&D.Columns[2].Contains("Filter")&&D.Tables[2].length>0&&(this.GridFilter=D.Tables[2][0].Filter.toString(),this.GridFilter=this.GridFilter.replace("CC.","C.").replace("a.","P."));let S=D.Tables[0].filter(e=>2==e.columntype);if(S.Sort="columnorder",S.forEach(e=>{m=new c.a,m.Header=e.ResourceData.toString(),m.DisplayMember=e.SysColumnName.toString(),m.DataType="TextBlock",m.ReadOnly=!0,m.Width=n.e.IsEmpty(e.ColumnWidth)?120:parseInt(e.ColumnWidth),this.ColumnSource.push(m),this.GridDataColumns.Contains(e.SysColumnName.toString())||(this.GridDataColumns.push(e.SysColumnName.toString()),3==this.CostCenterID&&(this.SelectedGridColumns.push(e.SysColumnName.toString()),this.SelectedColumnSource.push(m)))}),3==this.CostCenterID){m=new c.a,m.Header="Total QOH",m.DisplayMember="QTYonHand",m.DataType="LINK",m.Width=80,m.Click.Subscribe(this,"onQtyClick"),s.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=s.a.SessionManager.Preferences.DecimalsinQty&&(m.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinQty),this.ColumnSource.push(m);for(let e=0;e<this.ProductFields.length;e++)null!=this.ProductFields[e].OtherDimensions&&(m=new c.a,m.Header=this.ProductFields[e].Header,this.ProductFields[e].OtherDimensionDisplayMember="DIMNAME_"+this.ProductFields[e].OtherDimensions[this.ProductFields[e].OtherDimensions.length-1].toString().replace("-","N"),m.DisplayMember=this.ProductFields[e].OtherDimensionDisplayMember,m.DataType="TextBlock",m.ReadOnly=!0,m.Width=90,this.ColumnSource.push(m),this.GridDataColumns.Contains(m.DisplayMember)||(this.GridDataColumns.push(m.DisplayMember),this.SelectedGridColumns.push(m.DisplayMember),this.SelectedColumnSource.push(m)))}if(m=new c.a,m.Header=this.Parent instanceof d.a?"Select":"Add",m.DisplayMember="Add",m.DataType="LINK",m.Width=60,m.IsVisible=!0,m.ReadOnly=!0,m.Click.Subscribe(this,"onClick"),this.ColumnSource.push(m),3==this.CostCenterID){let t=s.a.report.GetQueryDefnScreenDetails(5,98,0);null!=t&&t.Tables.length>0&&(this.ReportFromDate.Date=s.a.SessionManager.ReportsFromDate,this.ReportToDate.Date=Date.Today(),t.Tables[0].forEach(e=>{this.Reports.Items.push(o.d.ComboBoxItems_2(e.ReportName.toString(),e.ReportID.toString()))}),this.Reports.Items.length>0&&(this.Reports.SelectedItem=this.Reports.Items[0],this.Reports.SelectedValue=this.Reports.Items[0].Value,m=new c.a,m.Header="Analysis",m.DisplayMember="Analysis",m.DataType="LINK",m.Width=60,m.IsVisible=!1,m.ReadOnly=!0,m.Click.Subscribe(this,"onViewClick"),this.ColumnSource.push(m))),null!=e&&"AddEditDocumentViewModel"==e.ClassName&&e.ScreenObject.Preferences.ContainsKey("EnableSubtitutes")&&""!=e.ScreenObject.Preferences.EnableSubtitutes.toString()&&Object(r.j)(e.ScreenObject.Preferences.EnableSubtitutes)&&(m=new c.a,m.Header="Subtitutes",m.DisplayMember="Subtitutes",m.DataType="LINK",m.Width=80,m.IsVisible=!0,m.ReadOnly=!0,m.Click.Subscribe(this,"onSubtitutesClick"),this.ColumnSource.push(m)),m=new c.a,m.Header="Quantity",m.DisplayMember="QTY",m.DataType="FLOAT",m.Width=75,s.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=s.a.SessionManager.Preferences.DecimalsinQty&&(m.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinQty),this.SelectedColumnSource.push(m),this.SelectedGridColumns.push("Sno"),this.SelectedGridColumns.push("ProductName_Key"),this.SelectedGridColumns.push("QTY")}this.GridDataColumns.push("Sno"),this.GridDataColumns.push("ProductName_Key"),this.GridDataColumns.push("QTYonHand"),this.GridDataColumns.push("Add"),this.GridDataColumns.push("Analysis"),this.GridDataColumns.push("Subtitutes"),this.setFullTextSearch=!0,this.GridDataObj.SearchVisible=!0}set setGridFocus(e){}set setFullTextSearch(e){}get FullTextSearch(){return this.FullTextSearchCtrl.Text}set FullTextSearch(e){this.FullTextSearchCtrl.Text=e}get GridData(){return this.GridDataObj.Table}get GridDataColumns(){return this.GridDataObj.TableColumns}get ColumnSource(){return this.GridDataObj.Columns}get SelectedRow(){return this.GridDataObj.SelectedItem}get SelectedIndex(){return this.GridDataObj.SelectedIndex}get SelectedGrid(){return this.SelectedGridObj.Table}get SelectedGridColumns(){return this.SelectedGridObj.TableColumns}get SelectedColumnSource(){return this.SelectedGridObj.Columns}get ProductsGridData(){return this.ProductsGridDataObj.Table}get ProductsGridDataColumns(){return this.ProductsGridDataObj.TableColumns}get ProductsColumnSource(){return this.ProductsGridDataObj.Columns}set ProductsColumnSource(e){this.ProductsGridDataObj.Columns=e}onSetFocusonGrid(e){this.setGridFocus=!0}onSetFocusonSearch(e){this.setFullTextSearch=!0}onSubtitutesClick(){if(this.DisplayMessage="",null!=this.SelectedRow){this.GridDataObj.TableColumns.Contains("ProductCode")&&(this.ProductCode=this.SelectedRow.ProductCode.toString()),this.GridDataObj.TableColumns.Contains("ProductName")&&(this.ProductName=this.SelectedRow.ProductName.toString()),this.ProductID=this.SelectedRow.ProductName_Key.toString();let e=null;if(e=this.Parent.ScreenObject.GetSubtituteProducts(parseInt(this.ProductID),this.Parent.DocumentDate,"0",this.Parent.SelectedRow?this.Parent.SelectedRow:null),e.Tables.length>0&&!e.Columns[0].Contains("ErrorMessage")&&e.Tables[0].length>0){let t=new m.a(this.Parent,e.Tables[0],e.Columns[0],e.Tables[1],this.ProductName,this.ProductCode,this.ProductID.toString());t.ColumnSource[0].IsVisible=!1,t.GridData.length>0&&s.a.page.ShowDialog(t,D.a)}}}onViewClick(){this.DisplayMessage="",null!=this.SelectedRow?(this.GridDataObj.TableColumns.Contains("ProductCode")&&(this.ProductCode=this.SelectedRow.ProductCode.toString()),this.GridDataObj.TableColumns.Contains("ProductName")&&(this.ProductName=this.SelectedRow.ProductName.toString()),this.ProductID=this.SelectedRow.ProductName_Key.toString(),this.ReportVisibility=!1,this.ReportsDialogVisibility=!0,this.SelectedItemsVisiblility=!1):this.DisplayMessage="Please Select Row"}onQtyClick(){if(null!=this.SelectedRow){this.GridDataObj.TableColumns.Contains("ProductCode")&&(this.ProductCode=this.SelectedRow.ProductCode.toString()),this.GridDataObj.TableColumns.Contains("ProductName")&&(this.ProductName=this.SelectedRow.ProductName.toString()),this.ProductID=this.SelectedRow.ProductName_Key.toString();let e=Date.Today();null!=this.Parent&&"AddEditDocumentViewModel"==this.Parent.ClassName&&(e=this.Parent.DocumentDate);let t=s.a.inventory.GetProductQOH(this.ProductID,e,"");if(null!=t&&t.Tables.length>0&&t.Columns[0].Contains("QOH")){this.ProductsGridData.Clear();let e=[];for(let i=0;i<t.Columns[0].length;i++){if("QOH"==t.Columns[0][i]){let t=new c.a;t.Header="QOH",t.DisplayMember="QOH",t.DataType="FLOAT",t.Width=75,s.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=s.a.SessionManager.Preferences.DecimalsinQty&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinQty),this.ProductsGridDataColumns.push("QOH"),e.push(t);break}{this.ProductsGridDataColumns.push(t.Columns[0][i+1]);let s=new c.a;s.Header=t.Columns[0][i],s.DisplayMember=t.Columns[0][i+1],s.DataType="TextBlock",s.Width=150,e.push(s),i++}}this.ProductsColumnSource=e;for(let i=0;i<t.Tables[0].length;i++){let e=this.ProductsGridDataObj.NewRow();for(let s=0;s<t.Columns[0].length;s++){if("QOH"==t.Columns[0][s]){e.QOH=t.Tables[0][i].QOH.toString();break}e[t.Columns[0][s+1]]=t.Tables[0][i][t.Columns[0][s]].toString(),s++}this.ProductsGridDataObj.addRow(e)}}this.AllProducstsVisibility=!1,this.GridDataVisibility=!0}}onClick(){if(null!=this.lstctrl||null!=this.DisplayCOl&&3!=this.DisplayCOl.CostCenterID)this.AddData();else if(this.Parent instanceof d.a)this.SelectTreeNode();else if(null!=this.Parent&&null!=this.SelectedRow){if("AddEditDocumentViewModel"==this.Parent.ClassName&&!n.e.IsEmpty(this.SelectedRow.ProductName_Key)&&parseInt(this.SelectedRow.ProductName_Key)!=this.Parent.ScreenObject.TempProductID&&this.Parent.ScreenObject.Preferences.ContainsKey("DuplicateProduct_IncrementQuantity")&&""!=this.Parent.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity&&Object(r.j)(this.Parent.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity)){let e=this.SelectedGrid.filter(e=>e.ProductName_Key==this.SelectedRow.ProductName_Key);if(e.length>0){let t=n.e.Double(e[0].QTY);return void(e[0].QTY=t+1)}}let e=this.SelectedGridObj.NewRow();e.Sno=(this.SelectedGrid.length+1).toString();for(let t=0;t<this.SelectedGridColumns.length;t++)"Sno"!=this.SelectedGridColumns[t]&&"ProductName_Key"!=this.SelectedGridColumns[t]&&"QTY"!=this.SelectedGridColumns[t]&&(e[this.SelectedGridColumns[t]]=this.SelectedRow[this.SelectedGridColumns[t]]);e.ProductName_Key=this.SelectedRow.ProductName_Key,e.QTY=1,this.SelectedGridObj.addRow(e)}}AddData(){if(null!=this.SelectedRow&&!n.e.IsEmpty(this.SelectedRow.ProductName_Key)){if(null!=this.lstctrl){if(this.lstctrl.SelectedValue=parseInt(this.SelectedRow.ProductName_Key),s.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==s.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()){var e=this.ColumnSource.find(e=>"name"==e.DisplayMember.toLowerCase());2==this.CostCenterID&&(e=this.ColumnSource.find(e=>"accountname"==e.DisplayMember.toLowerCase())),e&&(this.lstctrl.SelectedValueText=this.SelectedRow[e.DisplayMember].toString())}}else if(null!=this.DisplayCOl&&"AddEditDocumentViewModel"==this.Parent.ClassName)if(38!=this.Parent.ScreenObject.DocumentType&&39!=this.Parent.ScreenObject.DocumentType||!s.a.SessionManager.Preferences.ContainsKey("POSItemCodeDimension")||s.a.SessionManager.Preferences.POSItemCodeDimension!=this.CostCenterID.toString())null!=this.Parent.SelectedRow&&(e=this.ColumnSource.find(e=>"name"==e.DisplayMember.toLowerCase()),2==this.CostCenterID&&(e=this.ColumnSource.find(e=>"accountname"==e.DisplayMember.toLowerCase())),e&&this.Parent.SelectedRowColumns.Contains(this.DisplayCOl.DisplayMember)&&(this.Parent.SelectedRow[this.DisplayCOl.DisplayMember]=this.SelectedRow[e.DisplayMember].toString()),this.Parent.SelectedRowColumns.Contains(this.DisplayCOl.ValueMember)&&(this.Parent.SelectedRow[this.DisplayCOl.ValueMember]=this.SelectedRow.ProductName_Key.toString()));else{let t=this.Parent.GetEmptyRowPosition(this.Parent.ScreenObject.GridDataObj,"ProductID_Key"),i=this.Parent.ScreenObject.GridData[t];i[this.DisplayCOl.ValueMember]=this.SelectedRow.ProductName_Key.toString(),(e=this.ColumnSource.find(e=>"code"==e.DisplayMember.toLowerCase()))&&this.Parent.AddProductData(i,!1,!1,!1,null,this.SelectedRow[e.DisplayMember].toString())}s.a.page.HideDialog()}}GetLocations(e){let t=e.toString();if(null!=s.a.SessionManager.Locations){let i=e;for(;i>0;){let e=s.a.SessionManager.Locations.filter(e=>e.NodeID==i.toString());null!=e&&e.length>0&&!n.e.IsEmpty(e[0].parentid)&&parseInt(e[0].parentid.toString())>0?(i=parseInt(e[0].parentid.toString()),e=s.a.SessionManager.Locations.filter(e=>e.NodeID==i.toString()),e.length>0&&!n.e.IsEmpty(e[0].IsGroup)&&Object(r.j)(e[0].IsGroup.toString())?t+=","+i.toString():i=0):i=0}}return t}onSave(e){if("Clear"==e){this.GridDataObj.Clear();for(let e=0;e<this.ProductFields.length;e++)this.ProductFields[e].CC.Visible?this.ProductFields[e].CC.SelectedValue=0:this.ProductFields[e].FromValue.Text=""}else if("Add"==e||"DblClick"==e){if(null!=this.lstctrl||null!=this.DisplayCOl&&3!=this.DisplayCOl.CostCenterID)return void this.AddData();if(this.Parent instanceof d.a)return void this.SelectTreeNode();if(null!=this.SelectedRow&&null!=this.Parent){if("AddEditDocumentViewModel"==this.Parent.ClassName&&!n.e.IsEmpty(this.SelectedRow.ProductName_Key)&&parseInt(this.SelectedRow.ProductName_Key)!=this.Parent.ScreenObject.TempProductID&&this.Parent.ScreenObject.Preferences.ContainsKey("DuplicateProduct_IncrementQuantity")&&""!=this.Parent.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity&&Object(r.j)(this.Parent.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity)){let e=this.SelectedGrid.filter(e=>e.ProductName_Key==this.SelectedRow.ProductName_Key);if(e.length>0){let t=n.e.Double(e[0].QTY);return void(e[0].QTY=t+1)}}let t=this.SelectedGridObj.NewRow();t.Sno=(this.SelectedGrid.length+1).toString();for(let e=0;e<this.SelectedGridColumns.length;e++)"Sno"!=this.SelectedGridColumns[e]&&"ProductName_Key"!=this.SelectedGridColumns[e]&&"QTY"!=this.SelectedGridColumns[e]&&(t[this.SelectedGridColumns[e]]=this.SelectedRow[this.SelectedGridColumns[e]]);t.ProductName_Key=this.SelectedRow.ProductName_Key,t.QTY=1,this.SelectedGridObj.addRow(t),"DblClick"==e&&this.onSave("OK")}this.AllProducstsVisibility=!0,this.ReportsDialogVisibility=!1,this.GridDataVisibility=!0}else if("ViewReport"==e);else if("back"==e)this.AllProducstsVisibility=!0,this.GridDataVisibility=!0,this.ReportsDialogVisibility=!1,this.SelectedItemsVisiblility=!0;else if("Cancel"==e){if(null!=this.lstctrl||null!=this.DisplayCOl&&3!=this.DisplayCOl.CostCenterID)return void s.a.page.HideDialog();if(null==this.Parent)return;null!=this.FullTextSearch&&"AddEditDocumentViewModel"==this.Parent.ClassName&&(this.Parent.HoldProdSearch=this.FullTextSearch.toString()),s.a.page.HideDialog()}else if("Filter"==e||"Next"==e||"Previous"==e){let i,n,r,a,l;this.AllProducstsVisibility=!0,this.ReportsDialogVisibility=!1,this.GridDataVisibility=!0;let c={},h=this.GetQuery(c);i=c.qtywhere,n=c.fulltext,r=c.join,a=c.OtherDimSelect,l=c.LocWhere,n.length>3&&(n=n.Remove(0,3),""!=this.sFulltextSearchWhere&&(n=n+" "+this.sFulltextSearchWhere)),""!=this.GridFilter.Trim()?h.length>0?h+=" and "+this.GridFilter:h=this.GridFilter:h.length>0?h+=" and P.Isgroup=0":h=" P.Isgroup=0";let u=!1;if("Next"==e||"Previous"==e&&this.GridData.length>0){var t=this.ColumnSource.find(e=>"code"==e.DisplayMember.toLowerCase());2==this.CostCenterID&&(t=this.ColumnSource.find(e=>"accountcode"==e.DisplayMember.toLowerCase())),t||(t=this.ColumnSource.find(2==this.CostCenterID?e=>"accountname"==e.DisplayMember.toLowerCase():e=>"name"==e.DisplayMember.toLowerCase())),t&&this.GridData.length>0&&("Next"==e?h+=" and "+t.DisplayMember+">'"+this.GridData[this.GridData.length-1][t.DisplayMember]+"'":(h+=" and "+t.DisplayMember+"<'"+this.GridData[0][t.DisplayMember]+"'",u=!0))}let C=Date.Today();"AddEditDocumentViewModel"==this.Parent.ClassName&&(C=this.Parent.DocumentDate),""!=this.sBarcodeWhere&&(h=h+" "+this.sBarcodeWhere);let m=s.a.inventory.SearchProductCatalog(this.GridViewID,h,i,C,this.Options.Visible?this.Options.SelectedValue:"0",n,r,a,l,u);if(null!=m&&m.Tables.length>0&&!m.Columns[0].Contains("ErrorMessage")){if(("Next"==e||"Previous"==e)&&0==m.Tables[0].length)return;this.GridDataObj.Clear();for(let e=0;e<m.Tables[0].length;e++){let t=this.GridDataObj.NewRow();t.Sno=(e+1).toString(),t.ProductName_Key=m.Tables[0][e].productid;for(let i=0;i<this.GridDataColumns.length;i++)"Sno"!=this.GridDataColumns[i]&&"ProductName_Key"!=this.GridDataColumns[i]&&"QTY"!=this.GridDataColumns[i]&&("productid"==this.GridDataColumns[i].toLowerCase()&&this.CostCenterID.toString()==s.a.SessionManager.Preferences.POSItemCodeDimension?t.Productid=m.Tables[0][e].ProductName:m.Columns[0].Contains(this.GridDataColumns[i])&&(t[this.GridDataColumns[i]]=m.Tables[0][e][this.GridDataColumns[i]]));m.Columns[0].Contains("onHand")&&(t.QTYonHand=m.Tables[0][e].onHand),t.Add=this.Parent instanceof d.a?"Select":"Add",t.Analysis="View",t.Subtitutes="Subtitutes",u&&this.GridData.length>0?this.GridDataObj.insertRowAt(t,0):this.GridDataObj.addRow(t)}if(u)for(let e=0;e<this.GridData.length;e++)this.GridData[e].Sno=(e+1).toString();if(m.Tables.length>1){this.lst.Clear();let e="",t=this.GridData.length;for(let i=0;i<m.Tables[0].length;i++){let s=m.Tables[0][i];if(e=s.ParentID.toString(),0==this.lst.filter(t=>t.Name==e).length){let i=m.Tables[1].filter(e=>e.ProductID==s.ParentID);if(this.lst.push(o.d.ComboBoxItems_1(e)),i.length>0){let e=this.GridDataObj.NewRow();e.Sno=(t+1).toString(),e.ProductName_Key=s.ParentID;for(let t=0;t<this.SelectedGridColumns.length;t++)"Sno"!=this.SelectedGridColumns[t]&&"ProductName_Key"!=this.SelectedGridColumns[t]&&"QTY"!=this.SelectedGridColumns[t]&&m.Columns[1].Contains(this.SelectedGridColumns[t])&&(e[this.SelectedGridColumns[t]]=i[0][this.SelectedGridColumns[t]]);e.Add="",e.Analysis="View",e.Subtitutes="Subtitutes",this.GridDataObj.addRow(e),t+=1}}}}}}else if("OK"==e){if(null!=this.lstctrl||null!=this.DisplayCOl&&3!=this.DisplayCOl.CostCenterID)return void this.AddData();if(this.Parent instanceof d.a)return void this.SelectTreeNode();if(null==this.Parent)return;if(null!=this.FullTextSearch&&(this.Parent.HoldProdSearch=this.FullTextSearch.toString()),s.a.page.HideDialog(),"AddEditDocumentViewModel"==this.Parent.ClassName){let e,t=0;null!=this.Parent.SelectedRow&&(t=this.Parent.ScreenObject.GridData.indexOf(this.Parent.SelectedRow));for(let i=0;i<this.SelectedGrid.length;i++)null!=this.Parent.SelectedRow&&i==this.SelectedGrid.length-1?e=this.Parent.SelectedRow:(e=this.Parent.ScreenObject.GridDataObj.NewRow(),this.Parent.ScreenObject.GridDataObj.insertRowAt(e,t+i)),e.ProductID_Key=this.SelectedGrid[i].ProductName_Key.toString(),e.ProductID_Key=this.SelectedGrid[i].ProductName_Key.toString(),e.ProductID_Key=this.SelectedGrid[i].ProductName_Key.toString(),e.Quantity=n.e.IsEmpty(this.SelectedGrid[i].QTY)?1:this.SelectedGrid[i].QTY,this.Parent.AddProductData(e,!1,!0),n.e.IsNum(e.UOMConversion)&&(e.UOMConvertedQty=n.e.Double(e.UOMConversion)*parseFloat(e.Quantity)),this.Parent.CalculateTotals(e,!1);this.Parent.ScreenObject.UpdateSequence(),this.Parent.RefreshGrid=!this.Parent.RefreshGrid}else if(null!=this.Parent&&"LeadsProductViewModel"==this.Parent.ClassName)for(let e=0;e<this.SelectedGrid.length;e++)n.e.IsEmpty(this.SelectedGrid[e].ProductName_Key)||this.Parent.AddProductToGrid(parseInt(this.SelectedGrid[e].ProductName_Key))}}onTxtChanged(){}OnTimerTick(e,t){this.FullTextSearch.length>3&&this.onSave("Filter"),this._timer.Stop(),this._timer=null}GetTableName(e){let t="";return t=50001==e?" COM_Division":50002==e?" COM_Location":50003==e?" COM_Branch":50004==e?" COM_Department":50005==e?" COM_Salesman":50006==e?" COM_Category":50007==e?" COM_Area":50008==e?" COM_Teritory":" COM_CC"+e,t}GetQuery(e){e.qtywhere="",e.fulltext="",e.join="",e.OtherDimSelect="",e.LocWhere="";let t="";this.sBarcodeWhere="",this.sFulltextSearchWhere="";let i,r="",a="",o=!1,l=[];for(let c=0;c<this.ProductFields.length;c++){if(t="",i="",this.ProductFields[c].IsEvaluated=!1,113==this.ProductFields[c].CC.CCID&&(e.join=e.join+" left join COM_Status sta WITH(NOLOCK) ON P.StatusID=sta.StatusID ",r+="sta.Status='"+this.ProductFields[c].CC.Text+"' and "),this.ProductFields[c].CC.Visible){if(!(this.ProductFields[c].CC.SelectedValue>0)){if(!n.e.IsEmpty(this.FullTextSearch))if(3==this.ProductFields[c].CC.CCID&&this.CostCenterID.toString()!=s.a.SessionManager.Preferences.POSItemCodeDimension)e.fulltext+=" or "+this.ProductFields[c].ColumnName+" like '%"+this.FullTextSearch+"%' ";else if(""==this.ProductFields[c].ColumnName&&this.ProductFields[c].CC.CCID>5e4)if(null!=this.ProductFields[c].OtherDimensions){let s;this.ProductFields[c].IsEvaluated=!0;let n=-1,r="",a="",o=[];if(c>0){for(let t=0;t<c;t++)o.push(0);for(let t=0;t<c;t++)if(o[t]=-1,null!=this.ProductFields[t].OtherDimensions&&0!=this.ProductFields[t].IsEvaluated)for(let e=0;e<this.ProductFields[c].OtherDimensions.length&&e<this.ProductFields[t].OtherDimensions.length&&this.ProductFields[t].OtherDimensions[e]==this.ProductFields[c].OtherDimensions[e];e++)o[t]++;let e=Math.max.apply(null,o);if(e>=0)for(let t=0;t<c;t++)if(o[t]==e){n=t;break}}for(let d=0;d<this.ProductFields[c].OtherDimensions.length;d++)s=Math.abs(this.ProductFields[c].OtherDimensions[d]),r=this.ProductFields[c].OtherDimensions[d]<0?r+"_N"+s:r+"_"+s,t="DIM"+r,-1!=n&&o[n]>=d?(this.ProductFields[c].OtherDimensionsTbl[d]=t,a=r):(this.ProductFields[c].OtherDimensions[d]<0?(i="CMAPDIM"+a,l.Contains(i)||(l.push(i),e.join+=0==d?"\nleft join COM_CostCenterCostCenterMap "+i+" with(nolock) on "+i+".ParentCostCenterID=3 AND "+i+".ParentNodeID=P.ProductID ":"\nleft join COM_CostCenterCostCenterMap "+i+" with(nolock) on "+i+".ParentCostCenterID="+Math.abs(this.ProductFields[c].OtherDimensions[d-1])+" and "+i+".ParentNodeID="+this.ProductFields[c].OtherDimensionsTbl[d-1]+".NodeID"),e.join+="\nleft join "+this.GetTableName(s)+" "+t+" with(nolock) on "+t+".NodeID="+i+".NodeID AND "+i+".CostCenterID="+s):0==d?e.join+="\nleft join "+this.GetTableName(s)+" "+t+" with(nolock) on C.CCNID"+(s-5e4).toString()+"="+t+".NodeID ":(l.Contains("C"+a)||(l.push("C"+a),e.join+="\nleft join COM_CCCCDATA C"+a+" with(nolock) on C"+a+".NodeID="+this.ProductFields[c].OtherDimensionsTbl[d-1]+".NodeID AND C"+a+".CostCenterID="+Math.abs(this.ProductFields[c].OtherDimensions[d-1])),e.join+="\nleft join "+this.GetTableName(s)+" "+t+" with(nolock) on C"+a+".CCNID"+(s-5e4).toString()+"="+t+".NodeID "),this.ProductFields[c].OtherDimensionsTbl[d]=t,a=this.ProductFields[c].OtherDimensions[d]<0?a+"_N"+s:a+"_"+s);e.fulltext+=" or "+t+".Name like '%"+this.FullTextSearch+"%' ",e.OtherDimSelect+=","+t+".Name "+this.ProductFields[c].OtherDimensionDisplayMember}else this.ProductFields[c].IsParentFilter?(i="GCMAP_"+this.ProductFields[c].CC.CCID,e.join+="\nleft join COM_CostCenterCostCenterMap "+i+" with(nolock) on "+i+".ParentCostCenterID=3 AND "+i+".CostCenterID="+this.ProductFields[c].CC.CCID+" and "+i+".ParentNodeID=P.ParentID ",e.join+="\nleft join "+this.GetTableName(this.ProductFields[c].CC.CCID)+" ft"+c.toString()+" with(nolock) on ft"+c.toString()+".NodeID="+i+".NodeID ",e.fulltext+=" or ft"+c.toString()+".Name like '%"+this.FullTextSearch+"%' "):(i="CMAP_"+this.ProductFields[c].CC.CCID,e.join+="\nleft join COM_CostCenterCostCenterMap "+i+" with(nolock) on "+i+".ParentCostCenterID=3 AND "+i+".CostCenterID="+this.ProductFields[c].CC.CCID+" and "+i+".ParentNodeID=P.ProductID ",e.join+="\nleft join "+this.GetTableName(this.ProductFields[c].CC.CCID)+" ft"+c.toString()+" with(nolock) on ft"+c.toString()+".NodeID="+i+".NodeID ",e.fulltext+=" or ft"+c.toString()+".Name like '%"+this.FullTextSearch+"%' ");else this.ProductFields[c].IsParentFilter?(o||(o=!0,e.join+=" join COM_CCCCData GC with(nolock) on GC.NodeID=p.ParentID  AND C.CostCenterID = 3 "),e.join+=" left join "+this.GetTableName(this.ProductFields[c].CC.CCID)+" ft"+c.toString()+" with(nolock) on GC.CCNID"+(this.ProductFields[c].CC.CCID-5e4).toString()+"=ft"+c.toString()+".NodeID ",e.fulltext+=" or ft"+c.toString()+".Name like '%"+this.FullTextSearch+"%' "):3==this.ProductFields[c].CC.CCID&&this.CostCenterID.toString()==s.a.SessionManager.Preferences.POSItemCodeDimension?e.fulltext+=" or PE.Productcode like '%"+this.FullTextSearch+"%' or PE.ProductName like '%"+this.FullTextSearch+"%' ":(e.join+=" left join "+this.GetTableName(this.ProductFields[c].CC.CCID)+" ft"+c.toString()+" with(nolock) on C.CCNID"+(this.ProductFields[c].CC.CCID-5e4).toString()+"=ft"+c.toString()+".NodeID ",e.fulltext+=" or ft"+c.toString()+".Name like '%"+this.FullTextSearch+"%' ");continue}if(this.qtycc.Contains(this.ProductFields[c].CC.CCID)&&(e.qtywhere+=" dcCCNID"+(this.ProductFields[c].CC.CCID-5e4).toString()+"="+this.ProductFields[c].CC.SelectedValue+" and "),3==this.CostCenterID&&s.a.SessionManager.Preferences.ContainsKey("LW Products")&&"True"==s.a.SessionManager.Preferences["LW Products"].toString()&&50002==this.ProductFields[c].CC.CCID&&(e.LocWhere=this.GetLocations(this.ProductFields[c].CC.SelectedValue)),!this.ProductFields[c].IsColumnInuse)continue;a=3==this.ProductFields[c].CC.CCID&&this.CostCenterID.toString()!=s.a.SessionManager.Preferences.POSItemCodeDimension?"='"+this.ProductFields[c].CC.Text+"'":"="+this.ProductFields[c].CC.SelectedValue}else{if(null==this.ProductFields[c].FromValue.Text||""==this.ProductFields[c].FromValue.Text.Trim()){n.e.IsEmpty(this.FullTextSearch)||("description"==this.ProductFields[c].ColumnName.toLowerCase()||"aliasname"==this.ProductFields[c].ColumnName.toLowerCase()||this.CostCenterID>5e4?e.fulltext+=" or p."+this.ProductFields[c].ColumnName+" like '%"+this.FullTextSearch+"%' ":0==this.ProductFields[c].CC.CCID&&"barcodeid"==this.ProductFields[c].ColumnName.toLowerCase()?(e.fulltext+=" or P."+this.ProductFields[c].ColumnName+" like '%"+this.FullTextSearch+"%' ",e.join+="  LEFT JOIN INV_PRODUCTBARCODE B WITH(NOLOCK) on B.ProductID=P.ProductID ",this.sFulltextSearchWhere=" or B.Barcode like '%"+this.FullTextSearch+"%' "):e.fulltext+=" or "+this.ProductFields[c].ColumnName+" like '%"+this.FullTextSearch+"%' ");continue}switch(this.ProductFields[c].Condition.SelectedValue){case"1":a=" ='"+this.ProductFields[c].FromValue.Text+"' ";break;case"2":a=" <>'"+this.ProductFields[c].FromValue.Text+"' ";break;case"3":a=" like '"+this.ProductFields[c].FromValue.Text+"%' ";break;case"4":a=" like '%"+this.ProductFields[c].FromValue.Text+"' ";break;case"5":a=" like '%"+this.ProductFields[c].FromValue.Text+"%' ";break;case"6":a=" not like '%"+this.ProductFields[c].FromValue.Text+"%' "}}if("description"==this.ProductFields[c].ColumnName.toLowerCase()||"aliasname"==this.ProductFields[c].ColumnName.toLowerCase())r+=" p."+this.ProductFields[c].ColumnName+a+" and ";else if(""==this.ProductFields[c].ColumnName&&this.ProductFields[c].CC.CCID>5e4)if(null!=this.ProductFields[c].OtherDimensions)if(""!=t)r+=t+".NodeID"+a+" and ";else{let s;this.ProductFields[c].IsEvaluated=!0;let n=-1,o="",d="",h=[];if(c>0){for(let t=0;t<c;t++)h.push(0);for(let t=0;t<c;t++)if(h[t]=-1,null!=this.ProductFields[t].OtherDimensions&&0!=this.ProductFields[t].IsEvaluated)for(let e=0;e<this.ProductFields[c].OtherDimensions.length&&e<this.ProductFields[t].OtherDimensions.length&&this.ProductFields[t].OtherDimensions[e]==this.ProductFields[c].OtherDimensions[e];e++)h[t]++;let e=Math.max.apply(null,h);if(e>=0)for(let t=0;t<c;t++)if(h[t]==e){n=t;break}}for(let r=0;r<this.ProductFields[c].OtherDimensions.length;r++)s=Math.abs(this.ProductFields[c].OtherDimensions[r]),o=this.ProductFields[c].OtherDimensions[r]<0?o+"_N"+s:o+"_"+s,t="DIM"+o,-1!=n&&h[n]>=r?(this.ProductFields[c].OtherDimensionsTbl[r]=t,d=o):(this.ProductFields[c].OtherDimensions[r]<0?(i="CMAPDIM"+d,l.Contains(i)||(l.push(i),e.join+=0==r?"\nleft join COM_CostCenterCostCenterMap "+i+" with(nolock) on "+i+".ParentCostCenterID=3 AND "+i+".ParentNodeID=P.ProductID ":"\nleft join COM_CostCenterCostCenterMap "+i+" with(nolock) on "+i+".ParentCostCenterID="+Math.abs(this.ProductFields[c].OtherDimensions[r-1])+" and "+i+".ParentNodeID="+this.ProductFields[c].OtherDimensionsTbl[r-1]+".NodeID"),e.join+="\nleft join "+this.GetTableName(s)+" "+t+" with(nolock) on "+t+".NodeID="+i+".NodeID AND "+i+".CostCenterID="+s):0==r?e.join+="\nleft join "+this.GetTableName(s)+" "+t+" with(nolock) on C.CCNID"+(s-5e4).toString()+"="+t+".NodeID ":(l.Contains("C"+d)||(l.push("C"+d),e.join+="\nleft join COM_CCCCDATA C"+d+" with(nolock) on C"+d+".NodeID="+this.ProductFields[c].OtherDimensionsTbl[r-1]+".NodeID AND C"+d+".CostCenterID="+Math.abs(this.ProductFields[c].OtherDimensions[r-1])),e.join+="\nleft join "+this.GetTableName(s)+" "+t+" with(nolock) on C"+d+".CCNID"+(s-5e4).toString()+"="+t+".NodeID "),this.ProductFields[c].OtherDimensionsTbl[r]=t,d=this.ProductFields[c].OtherDimensions[r]<0?d+"_N"+s:d+"_"+s);r+=t+".NodeID"+a+" and ",e.OtherDimSelect+=","+t+".Name "+this.ProductFields[c].OtherDimensionDisplayMember}else this.ProductFields[c].IsParentFilter?(""==i&&(i="GCMAP",e.join+=" left join COM_CostCenterCostCenterMap "+i+" with(nolock) on "+i+".ParentCostCenterID=3 AND "+i+".CostCenterID="+this.ProductFields[c].CC.CCID+" and "+i+".ParentNodeID=P.ParentID "),r+=i+".NodeID"+a+" and "):(""==i&&(i="CMAP",e.join+=" left join COM_CostCenterCostCenterMap "+i+" with(nolock) on "+i+".ParentCostCenterID=3 AND "+i+".CostCenterID="+this.ProductFields[c].CC.CCID+" and "+i+".ParentNodeID=P.ProductID "),r+=i+".NodeID"+a+" and ");else this.ProductFields[c].CC.CCID>5e4?this.ProductFields[c].IsParentFilter?(o||(o=!0,e.join+=" join COM_CCCCData GC with(nolock) on GC.NodeID=P.ParentID  AND C.CostCenterID = 3 "),r+="GC."+this.ProductFields[c].ColumnName+a+" and "):r+="C."+this.ProductFields[c].ColumnName+a+" and ":3==this.ProductFields[c].CC.CCID&&this.CostCenterID.toString()==s.a.SessionManager.Preferences.POSItemCodeDimension?r+="p.ProductID"+a+" and ":this.CostCenterID>5e4?r+="p."+this.ProductFields[c].ColumnName+a+" and ":0==this.ProductFields[c].CC.CCID&&"barcodeid"==this.ProductFields[c].ColumnName.toLowerCase()?(r+="P."+this.ProductFields[c].ColumnName+a+" and ",e.join+="  LEFT JOIN INV_PRODUCTBARCODE B WITH(NOLOCK) on B.ProductID=P.ProductID ",this.sBarcodeWhere=" or B.Barcode "+a):r+=this.ProductFields[c].ColumnName+a+" and "}for(let s=0;s<this.ProductFields.length;s++)null!=this.ProductFields[s].OtherDimensions&&(this.ColumnSource.find(e=>e.DisplayMember==this.ProductFields[s].OtherDimensionDisplayMember).IsVisible=this.ProductFields[s].IsEvaluated);if(this.ProductFields.filter(e=>null!=e.OtherDimensions).length>0){let e=[];this.ColumnSource.forEach(t=>{e.push(t)}),this.GridDataObj.Columns=e}return e.qtywhere.length>5&&(e.qtywhere=e.qtywhere.substr(0,e.qtywhere.length-4)),r.length>5?r.substr(0,r.length-4):""}SelectTreeNode(){null!=this.SelectedRow&&this.SelectedRow.ProductName_Key.toString().length>0&&parseInt(this.SelectedRow.ProductName_Key),s.a.page.HideDialog()}}},N0aR:function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var s=i("Do2H"),n=i("Lp6j"),r=i("eQJW"),a=i("ScVY"),o=i("8B8H"),l=i("n56n"),c=i("ockk");class d extends a.b{constructor(e,t,i,a,c,d,h){super(),this.GridDataObj=new o.a,this.Width=0,this.AllProducstsVisibility=!0,this.AllLocationVisibility=!0,this.Parent=null,this.ProductsGridDataObj=new o.a,this.PID="",this.GridDataObj.Columns=[],this.GridDataObj.Table=[],this.AllLocationVisibility=!1,this.Parent=e,this.PID=h,this.Title=" Subsitutes of : "+d+" - "+c,this.InitGrid(a,i.Contains("SubstituteType"));let u="",C=null;C=t;for(let s=0;s<C.length;s++){u+=C[s].ProductName_Key.toString()+",";let e=this.GridDataObj.NewRow();e.ProductName_Key=C[s].ProductName_Key.toString();for(let t=1;t<this.ColumnSource.length;t++)i.Contains(this.ColumnSource[t].DisplayMember)&&(e[this.ColumnSource[t].DisplayMember]=n.e.StringValue(C[s][this.ColumnSource[t].DisplayMember]));C[s].ProductName_Key.toString()==h?this.GridDataObj.insertRowAt(e,0):this.GridDataObj.addRow(e)}u.length>1&&(u=u.substr(u.length-1,1));var m=e.ScreenObject.ColumnSource.find(e=>null!=e.DisplayMember&&"rate"==e.DisplayMember.toLowerCase());let D=null;if(m&&null!=m.Formula&&""!=m.Formula&&m.Formula.toLowerCase().Contains("avgrate")&&e.ScreenObject.AvgrateExists&&this.GridDataObj.TableColumns.Contains("Price")){let i=[],a=n.e.IntTryParse(s.a.SessionManager.Preferences["Maintain Dimensionwise AverageRate"]);a>5e4&&i.push(a),s.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&Object(r.j)(s.a.SessionManager.Preferences.EnableLocationWise)&&s.a.SessionManager.Preferences.ContainsKey("Location AverageRate")&&Object(r.j)(s.a.SessionManager.Preferences["Location AverageRate"])&&i.push(50002),s.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&Object(r.j)(s.a.SessionManager.Preferences.EnableDivisionWise)&&s.a.SessionManager.Preferences.ContainsKey("Division AverageRate")&&Object(r.j)(s.a.SessionManager.Preferences["Division AverageRate"])&&i.push(50001);let o="";o+="<PXML>";let c="";for(let t=0;t<e.ScreenObject._CCFields.length;t++){let s=e.ScreenObject._CCFields[t];s instanceof l.b&&s.DBColumnName.Contains("TO")&&5==e.ScreenObject.DocumentType||s instanceof l.b&&s.SelectedValue>0&&i.Contains(s.CCID)&&(c+=" and dcCCNID"+(s.CCID-5e4).toString()+"="+s.SelectedValue.toString()+" ")}e.ScreenObject.ColumnSource.forEach(t=>{t.CostCenterID>5e4&&i.Contains(t.CostCenterID)&&!n.e.StringIsNullOrEmpty(e.ScreenObject.GridData[e.ScreenObject.SelectedGridRowIndex][t.ValueMember])&&(c+=" and dcCCNID"+(t.CostCenterID-5e4).toString()+"="+e.ScreenObject.GridData[e.ScreenObject.SelectedGridRowIndex][t.ValueMember].toString()+"  ")});for(let e=0;e<t.length;e++)o+="<Row ",o+=' ProductID="'+t[e].ProductName_Key.toString()+'" ',o+=' QTY="1" ',o+=' DETAILSID="0" ',o+=' avgwhere="'+c+'" ></Row> ';o+="</PXML>",D=e.ScreenObject.GetReconcileAvgRate(o.toString(),e.DocumentDate)}if(this.GridDataObj.TableColumns.Contains("Price")||this.GridDataObj.TableColumns.Contains("SellingRateA")||e.ScreenObject.Preferences.ContainsKey("TransitDOcs")&&""!=e.ScreenObject.Preferences.TransitDOcs){let t,i=e.ScreenObject.GetProductDetails(u,e.DocumentDate,0,1,"0",null);if(null!=i&&i.Tables.length>0&&i.Columns[0].Contains("ProductID")){let a="";a=1==e.ScreenObject.DocumentType||25==e.ScreenObject.DocumentType||2==e.ScreenObject.DocumentType||3==e.ScreenObject.DocumentType||4==e.ScreenObject.DocumentType||10==e.ScreenObject.DocumentType||26==e.ScreenObject.DocumentType||27==e.ScreenObject.DocumentType||34==e.ScreenObject.DocumentType||31==e.ScreenObject.DocumentType?"PurchaseRate":"SellingRate",m&&null!=m.Formula&&i.Columns[0].Contains(m.Formula)&&"avgrate"!=m.Formula.toLowerCase().trim()?a=m.Formula:null!=m&&null!=m.Formula&&""!=m.Formula&&(a="",e.FillDictionary(e.SelectedRow,!1));for(let o=0;o<this.GridData.length;o++){if(null==this.GridData[o].ProductName_Key)continue;let l=null;if(this.GridDataObj.TableColumns.Contains("Price"))if(i.Tables.length>1&&i.Tables[1].filter(e=>e.ProductID==this.GridData[o].ProductName_Key).length>0?l=i.Tables[1].filter(e=>e.ProductID==this.GridData[o].ProductName_Key):i.Tables.length>2&&i.Tables[2].filter(e=>e.ProductID==this.GridData[o].ProductName_Key).length>0?l=i.Tables[2].filter(e=>e.ProductID==this.GridData[o].ProductName_Key):i.Tables.length>0&&i.Tables[0].filter(e=>e.ProductID==this.GridData[o].ProductName_Key).length>0&&(l=i.Tables[0].filter(e=>e.ProductID==this.GridData[o].ProductName_Key)),""!=a)this.GridData[o].Price=null!=l&&l.length>0&&!n.e.StringIsNullOrEmpty(l[0][a])?l[0][a].toString():0;else{let t=e.ScreenObject.GridDataObj.NewRow();if(null!=l&&l.length>0){if(t.RATE=1==e.ScreenObject.DocumentType||25==e.ScreenObject.DocumentType||2==e.ScreenObject.DocumentType||3==e.ScreenObject.DocumentType||4==e.ScreenObject.DocumentType||10==e.ScreenObject.DocumentType||26==e.ScreenObject.DocumentType||27==e.ScreenObject.DocumentType||34==e.ScreenObject.DocumentType||31==e.ScreenObject.DocumentType?n.e.StringIsNullOrEmpty(l[0].PurchaseRate)?0:l[0].PurchaseRate.toString():n.e.StringIsNullOrEmpty(l[0].SellingRate)?0:l[0].SellingRate.toString(),null!=D&&D.Tables.length>0&&D.Columns[0].Contains("PID")){let e=D.Tables[0].filter(e=>e.PID==this.GridData[o].ProductName_Key);e.length>0&&(t.AVGRATE=n.e.StringIsNullOrEmpty(e[0].AvgRate)?0:e[0].AvgRate.toString())}this.FillSalesPurchase(t,l[0]),e.CalculateTotals(t,!1),this.GridData[o].Price=t.RATE.toString()}}this.GridDataObj.TableColumns.Contains("SellingRateA")&&(t=1,s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(r.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&null!=e.Currency&&n.e.IsNum(e.Currency.ExchangeRate.Text)&&(t=parseFloat(e.Currency.ExchangeRate.Text)),this.GridData[o].SellingRateA=i.Tables.length>1&&i.Tables[1].filter(e=>e.ProductID==this.GridData[o].ProductName_Key).length>0&&n.e.DoubleTryParse(i.Tables[1].filter(e=>e.ProductID==this.GridData[o].ProductName_Key)[0].SellingRateA)>0?0!=t?parseFloat(i.Tables[1].filter(e=>e.ProductID==this.GridData[o].ProductName_Key.toString())[0].SellingRateA.toString())/t:i.Tables[1].filter(e=>e.ProductID==this.GridData[o].ProductName_Key.toString())[0].SellingRateA.toString():i.Tables.length>2&&i.Tables[2].filter(e=>e.ProductID==this.GridData[o].ProductName_Key.toString()).length>0&&n.e.DoubleTryParse(i.Tables[2].filter(e=>e.ProductID==this.GridData[o].ProductName_Key.toString())[0].SellingRateA.toString())>0?0!=t?parseFloat(i.Tables[2].filter(e=>e.ProductID==this.GridData[o].ProductName_Key.toString())[0].SellingRateA.toString())/t:i.Tables[2].filter(e=>e.ProductID==this.GridData[o].ProductName_Key.toString())[0].SellingRateA.toString():i.Tables.length>0&&i.Tables[0].filter(e=>e.ProductID==this.GridData[o].ProductName_Key.toString()).length>0&&n.e.DoubleTryParse(i.Tables[0].filter(e=>e.ProductID==this.GridData[o].ProductName_Key.toString())[0].SellingRateA.toString())>0?0!=t?parseFloat(i.Tables[0].filter(e=>e.ProductID==this.GridData[o].ProductName_Key.toString())[0].SellingRateA.toString())/t:i.Tables[0].filter(e=>e.ProductID==this.GridData[o].ProductName_Key.toString())[0].SellingRateA.toString():"0")}}this.CheckGoodsinTransit(i)}this.CheckLocationWiseQty(),this.ShowSubQOH(),this.GridData.length>0&&this.FillEmptyRows()}get GridData(){return this.GridDataObj.Table}get ColumnSource(){return this.GridDataObj.Columns}get SelectedRow(){return this.GridDataObj.SelectedItem}set SelectedRow(e){this.GridDataObj.SelectedItem=e}get ProductsGridData(){return this.ProductsGridDataObj.Table}get ProductsColumnSource(){return this.ProductsGridDataObj.Columns}CheckGoodsinTransit(e){if(this.Parent.ScreenObject.Preferences.ContainsKey("TransitDOcs")&&""!=this.Parent.ScreenObject.Preferences.TransitDOcs){let n="";var t=this.Parent.ScreenObject._CCFields.find(e=>e instanceof l.b&&50002==e.CCID);if(t&&t instanceof l.b)n=t.Text;else{var i=this.ColumnSource.find(e=>null!=e.DisplayMember&&"50002"==e.DisplayMember);i&&(n=i.Header)}this.GridDataObj.TableColumns.push("transit");let r=new c.a;if(r.Header=n+" transit",r.DisplayMember="transit",r.DataType="FLOAT",r.Width=80,r.ReadOnly=!0,r.DisableTab=!0,s.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=s.a.SessionManager.Preferences.DecimalsinQty&&(r.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinQty),this.ColumnSource.length>9?this.ColumnSource.InsertAt(r,9):this.ColumnSource.push(r),null!=e&&e.Tables.length>3&&e.Columns[3].Contains("PendingOrders"))for(let t=0;t<this.GridData.length;t++)null!=this.GridData[t].ProductName_Key&&e.Tables[3].filter(e=>e.ProductID==this.GridData[t].ProductName_Key.toString()).length>0&&(this.GridData[t].transit=e.Tables[3].filter(e=>e.ProductID==this.GridData[t].ProductName_Key.toString())[0].PendingOrders.toString())}}ShowSubQOH(){if(this.Parent.ScreenObject.Preferences.ContainsKey("ShowSubQOH")&&""!=this.Parent.ScreenObject.Preferences.ShowSubQOH&&Object(r.j)(this.Parent.ScreenObject.Preferences.ShowSubQOH))if(this.GridDataObj.TableColumns.Contains("SubQOH")){let i=this.Parent.ScreenObject.ColumnSource.find(e=>!n.e.StringIsNullOrEmpty(e.OPParams)&&e.OPParams.Contains(i.ID));if(i){let r=[];var e=i.IPParams.split(",");for(let i=0;i<e.length;i++)if(""!=e[i]){var t=this.Parent.ScreenObject.ColumnSource.find(t=>t.ID==e[i]);if(t&&3==t.CostCenterID){let e="";for(let t=0;t<this.GridData.length;t++)null!=this.GridData[t].ProductName_Key&&(e+=this.GridData[t].ProductName_Key.toString()+",");e.length>1&&(e=e.substr(0,e.length-1)),r.push(e)}else r.push(this.Parent.ScreenObject.GetValueBYCOLID(e[i],this.Parent.SelectedRow))}r.push(s.a.SessionManager.UserID),r.push(s.a.SessionManager.LanguageID);let a=s.a.document.GetData(JSON.stringify(r),i.SPName);if(null!=a&&a.Tables.length>0&&a.Columns[0].Contains("ProductID")&&a.Tables[0].length>0)for(let e=0;e<this.GridData.length;e++){let t=a.Tables[0].filter(t=>t.ProductID==this.GridData[e].ProductName_Key.toString());t.length>0&&n.e.DoubleTryParse(t[0][a.Columns[0][0]])>0?t.length>0&&(this.GridData[e].SubQOH=t[0][a.Columns[0][0]].toString()):(this.GridDataObj.removeRow(this.GridData[e]),e--)}}let r=0;for(let e=0;e<this.GridData.length;e++)if(!n.e.StringIsNullOrEmpty(this.GridData[e].ProductName_Key)&&this.GridData[e].ProductName_Key.toString()!=this.PID){r++;break}0==r&&this.GridData.Clear()}else if(this.GridDataObj.TableColumns.Contains("QOH"))for(let i=0;i<this.GridData.length;i++)null!=this.GridData[i].ProductName_Key&&(n.e.DoubleTryParse(this.GridData[i].QOH)>0||(this.GridDataObj.removeRow(this.GridData[i]),i--));else{let e="";for(let i=0;i<this.GridData.length;i++)null!=this.GridData[i].ProductName_Key&&(e+=this.GridData[i].ProductName_Key.toString()+",");let t=this.Parent.ScreenObject.GetProductQtyOnHand(e,this.Parent.DocumentDate);if(""!=e&&null!=t&&t.Tables.length>0&&t.Columns[0].Contains("ProductID"))for(let i=0;i<this.GridData.length;i++){let e=t.Tables[0].filter(e=>e.ProductID==this.GridData[i].ProductName_Key.toString());e.length>0&&n.e.DoubleTryParse(e[0].QOH)>0||(this.GridDataObj.removeRow(this.GridData[i]),i--)}}}CheckLocationWiseQty(){if(this.Parent.ScreenObject.Preferences.ContainsKey("LocationWiseQty")&&""!=this.Parent.ScreenObject.Preferences.LocationWiseQty&&Object(r.j)(this.Parent.ScreenObject.Preferences.LocationWiseQty)){let e="";for(let t=0;t<this.GridData.length;t++)null!=this.GridData[t].ProductName_Key&&(e+=this.GridData[t].ProductName_Key.toString()+",");if(""!=e){let t=!1;e=e.substr(e.length-1,1);let i=Date.Today();n.e.IsType(this.Parent,"AddEditDocumentViewModel")&&(i=this.Parent.DocumentDate);let a=s.a.inventory.GetProductQOH("0",i,e);if(null!=a&&a.Tables.length>0&&a.Columns[0].Contains("QOH")){if(a.Tables.length>1&&a.Columns[1].Contains("NodeID"))for(let i=0;i<a.Tables[1].length;i++)if(t=s.a.SessionManager.IsActionAssigned(43,"Override Location For Substitutes"),!s.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")||""==s.a.SessionManager.Preferences.EnableLocationWise||!Object(r.j)(s.a.SessionManager.Preferences.EnableLocationWise)||s.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&""!=s.a.SessionManager.Preferences.EnableLocationWise&&Object(r.j)(s.a.SessionManager.Preferences.EnableLocationWise)&&(s.a.SessionManager.LocationWhere.Contains(","+a.Tables[1][i].NodeID.toString()+",")||s.a.SessionManager.LocationWhere.startsWith(a.Tables[1][i].NodeID.toString()+",")||s.a.SessionManager.LocationWhere.endsWith(","+a.Tables[1][i].NodeID.toString())||s.a.SessionManager.LocationWhere==a.Tables[1][i].NodeID.toString()||t)){this.GridDataObj.TableColumns.push(a.Tables[1][i].NodeID.toString());let e=new c.a;e.Header=a.Tables[1][i].Name.toString(),e.DisplayMember=a.Tables[1][i].NodeID.toString(),e.DataType="FLOAT",e.Width=50,e.ReadOnly=!0,e.DisableTab=!0,s.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=s.a.SessionManager.Preferences.DecimalsinQty&&(e.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinQty),(this.Parent.ScreenObject.LocationID>0&&a.Tables[1][i].NodeID.toString()==this.Parent.ScreenObject.LocationID.toString()||s.a.SessionManager.LocationID>0&&a.Tables[1][i].NodeID.toString()==s.a.SessionManager.LocationID.toString())&&this.ColumnSource.length>8?this.ColumnSource.InsertAt(e,8):this.ColumnSource.push(e)}let e="";if("true"==s.a.SessionManager.Preferences.EnableLocationWise.toLowerCase()&&"true"==s.a.SessionManager.Preferences["Location Stock"].toLowerCase()&&(e="dcccnid2"),"true"==s.a.SessionManager.Preferences.EnableDivisionWise.toLowerCase()&&"true"==s.a.SessionManager.Preferences["Division Stock"].toLowerCase()&&(e="dcccnid1"),n.e.IntTryParse(s.a.SessionManager.Preferences["Maintain Dimensionwise stock"])>0&&(e="dcccnid"+(parseInt(s.a.SessionManager.Preferences["Maintain Dimensionwise stock"])-5e4)),a.Columns[0].Contains(e)){this.ColumnSource[4].IsVisible=!1,this.ColumnSource[5].DataType="FLOAT";for(let t=0;t<this.GridData.length;t++){if(null==this.GridData[t].ProductName_Key)continue;let i=a.Tables[0].filter(e=>e.ProductID==this.GridData[t].ProductName_Key.toString());for(let n=0;n<i.length;n++){if(!this.GridDataObj.TableColumns.Contains(i[n][e].toString())){if(a.Tables.length>1)continue;this.GridDataObj.TableColumns.push(i[n][e].toString());let t=new c.a;t.Header=i[n][0].toString(),t.DisplayMember=i[n][e].toString(),t.DataType="FLOAT",t.ReadOnly=!0,t.Width=80,s.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=s.a.SessionManager.Preferences.DecimalsinQty&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinQty),this.ColumnSource.push(t)}this.GridData[t][i[n][e].toString()]=i[n].QOH.toString()}}}for(let t=0;t<this.GridData.length;t++)if(null!=this.GridData[t].ProductName_Key)for(let e=5;e<this.GridDataObj.TableColumns.length;e++)""==this.GridData[t][e].toString()&&(this.GridData[t][e]=0)}}}}FillEmptyRows(){for(let e=0;e<this.GridData.length;e++)if(null!=this.GridData[e].ProductName_Key)for(let t=1;t<this.ColumnSource.length;t++)!n.e.StringIsNullOrEmpty(this.ColumnSource[t].DecimalPoints)&&this.GridDataObj.TableColumns.Contains(this.ColumnSource[t].DisplayMember)&&n.e.IsNum(this.GridData[e][this.ColumnSource[t].DisplayMember])&&(this.GridData[e][this.ColumnSource[t].DisplayMember]=parseFloat(this.GridData[e][this.ColumnSource[t].DisplayMember].toString()).ToString("N"+this.ColumnSource[t].DecimalPoints));for(let e=this.GridData.length;e<10;e++)this.GridDataObj.addEmptyRow();for(let e=0;e<this.GridData.length;e++)this.GridData[e].Select=!1}onClick(e,t){if(t&&null!=this.SelectedRow&&!n.e.StringIsNullOrEmpty(this.SelectedRow.ProductName_Key)){let e;if(s.a.page.HideDialog(),e=this.Parent.SelectedRow,e.Subexists="1",e.ProductID_Key.toString()!=this.SelectedRow.ProductName_Key.toString()&&this.GridData.filter(t=>t.ProductName_Key==e.ProductID_Key).length>0){let t=this.Parent.ScreenObject.Data.Tables[0];t.length>0&&(t=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&55200==e.LinkData),t.length>0&&this.Parent.ScreenObject.GridDataObj.TableColumns.Contains(t[0].SysColumnName.toString())&&(this.Parent.ScreenObject.GridDataObj.TableColumns.Contains(t[0].SysColumnName.toString()+"_Key")?(e[t[0].SysColumnName.toString()+"_Key"]=e.ProductID_Key,this.Parent.ScreenObject.GridDataObj.TableColumns.Contains("ProductName")&&(e[t[0].SysColumnName.toString()]=e.ProductName)):e[t[0].SysColumnName.toString()]=e.ProductID_Key))}this.Parent.ScreenObject.Preferences.ContainsKey("Dontresetvaluesonproductchange")&&""!=this.Parent.ScreenObject.Preferences.Dontresetvaluesonproductchange&&Object(r.j)(this.Parent.ScreenObject.Preferences.Dontresetvaluesonproductchange)?e.ProductID_Key.toString()!=this.SelectedRow.ProductName_Key.toString()&&(e.ProductID_Key=this.SelectedRow.ProductName_Key.toString(),this.Parent.ScreenObject.GridDataObj.TableColumns.Contains("ProductCode")&&this.GridDataObj.TableColumns.Contains("ProductCode")&&(e.ProductCode=this.SelectedRow.ProductCode.toString()),this.Parent.ScreenObject.GridDataObj.TableColumns.Contains("ProductName")&&this.GridDataObj.TableColumns.Contains("ProductName")&&(e.ProductName=this.SelectedRow.ProductName.toString()),this.dontresetvalues(e)):(e.ProductID_Key=this.SelectedRow.ProductName_Key.toString(),this.Parent.ScreenObject.GridDataObj.TableColumns.Contains("ProductCode")&&this.GridDataObj.TableColumns.Contains("ProductCode")&&(e.ProductCode=this.SelectedRow.ProductCode.toString()),this.Parent.ScreenObject.GridDataObj.TableColumns.Contains("ProductName")&&this.GridDataObj.TableColumns.Contains("ProductName")&&(e.ProductName=this.SelectedRow.ProductName.toString()),e.Quantity="1",this.Parent.AddProductData(e,!1,!1,!0)),this.Parent.CalculateTotals(e,!1),this.Parent.SubDialogResult=!0,this.Parent.ReportDimension.SelectedValue=parseInt(this.SelectedRow.ProductName_Key.toString()),this.Parent.ProdID=0,this.Parent.ScreenObject.GridDataObj.updateRow(e)}}dontresetvalues(e){let t=this.Parent.GetProductValues(e,0);if(null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&!t.Columns[0].Contains("ErrorMessage")&&(e.Type=t.Tables[0][0].ProductTypeID.toString(),this.Parent.ScreenObject.GridDataColumns.Contains("BinWise")&&t.Columns[0].Contains("BinWise")&&(e.BinWise=t.Tables[0][0].BinWise.toString()),this.Parent.ScreenObject.GridDataColumns.Contains("QtyType")&&t.Columns[0].Contains("QtyAdjustType")&&(e.QtyType=t.Tables[0][0].QtyAdjustType.toString()),this.Parent.ScreenObject.GridDataColumns.Contains("PackType")&&t.Columns[0].Contains("IsPacking")&&(e.PackType=t.Tables[0][0].IsPacking.toString()),this.Parent.ScreenObject.GridDataColumns.Contains("IsTestCase")&&t.Columns[0].Contains("TestCaseExists")&&(e.IsTestCase=t.Tables[0][0].TestCaseExists.toString()),this.Parent.ScreenObject.GridDataColumns.Contains("landingType")&&t.Columns[0].Contains("IsBillOfEntry")&&(e.landingType=t.Tables[0][0].IsBillOfEntry.toString()),this.Parent.ScreenObject.GridDataColumns.Contains("SchemeProductID")&&(e.SchemeProductID=null),e.ExtraXML=null),this.Parent.ScreenObject.Preferences.ContainsKey("ResetFields")&&""!=this.Parent.ScreenObject.Preferences.ResetFields.toString()){let a="";var i=this.Parent.ScreenObject.Preferences.ResetFields.toString().split(",");for(let s=0;s<i.length;s++){a+="'"+i[s]+"',",this.Parent.ScreenObject.GridDataObj.TableColumns.Contains(i[s])&&(e[i[s]]=null),this.Parent.ScreenObject.GridDataObj.TableColumns.Contains(i[s]+"_Key")&&(e[i[s]+"_Key"]=null);let r=t.Tables[4].filter(e=>e.SysColumnName==i[s]);r.length>0?(e[i[s]]=r[0].Value.toString(),e["default"+i[s]]=r[0].Value.toString()):"Unit"==i[s]&&t.Tables.length>0&&t.Columns[0].Contains("uomid")&&!n.e.StringIsNullOrEmpty(t.Tables[0][0].uomid)?(e.Unit=t.Tables[0][0].UnitName.toString(),e.Unit_key=t.Tables[0][0].uomid.toString()):"Rate"==i[s]&&(t.Tables.length>3&&t.Tables[3].length>0?1==this.Parent.ScreenObject.DocumentType||25==this.Parent.ScreenObject.DocumentType||2==this.Parent.ScreenObject.DocumentType||3==this.Parent.ScreenObject.DocumentType||4==this.Parent.ScreenObject.DocumentType||10==this.Parent.ScreenObject.DocumentType||26==this.Parent.ScreenObject.DocumentType||27==this.Parent.ScreenObject.DocumentType||34==this.Parent.ScreenObject.DocumentType||31==this.Parent.ScreenObject.DocumentType?n.e.StringIsNullOrEmpty(t.Tables[3][0].PurchaseRate)||(e.Rate=t.Tables[3][0].PurchaseRate.toString()):n.e.StringIsNullOrEmpty(t.Tables[3][0].SellingRate)||(e.Rate=t.Tables[3][0].SellingRate.toString()):t.Tables.length>0&&t.Tables[0].length>0&&(1==this.Parent.ScreenObject.DocumentType||25==this.Parent.ScreenObject.DocumentType||2==this.Parent.ScreenObject.DocumentType||3==this.Parent.ScreenObject.DocumentType||4==this.Parent.ScreenObject.DocumentType||10==this.Parent.ScreenObject.DocumentType||26==this.Parent.ScreenObject.DocumentType||27==this.Parent.ScreenObject.DocumentType||34==this.Parent.ScreenObject.DocumentType||31==this.Parent.ScreenObject.DocumentType?n.e.StringIsNullOrEmpty(t.Tables[0][0].PurchaseRate)||(e.Rate=t.Tables[0][0].PurchaseRate.toString()):n.e.StringIsNullOrEmpty(t.Tables[0][0].SellingRate)||(e.Rate=t.Tables[0][0].SellingRate.toString())))}a.length>1&&(a=a.substr(0,a.length-1));var s=this.Parent.ScreenObject.ColumnSource.find(e=>!n.e.StringIsNullOrEmpty(e.ValueMember)&&"productid_key"==e.ValueMember.toLowerCase());let o=this.Parent.ScreenObject.Data.Tables[0].filter(e=>a.split(",").Contains(e.SysColumnName)&&null!=e.LocalReference&&e.LocalReference==s.ID);o.length>0&&this.Parent.ScreenObject.GetLinkReferenceData(parseInt(s.ID),this.Parent.DocumentID,parseInt(e.ProductID_Key),Date.Today(),"",3,e,i);var r=this.Parent.ScreenObject.ColumnSource.find(e=>!n.e.StringIsNullOrEmpty(e.ValueMember)&&e.ValueMember.toLowerCase()==s.ValueMember.toLowerCase()&&e.ID!=s.ID);r&&(o=this.Parent.ScreenObject.Data.Tables[0].filter(e=>a.split(",").Contains(e.SysColumnName)&&null!=e.LocalReference&&e.LocalReference==r.ID),o.length>0&&this.Parent.ScreenObject.GetLinkReferenceData(parseInt(r.ID),this.Parent.DocumentID,parseInt(e.ProductID_Key),Date.Today(),"",3,e,i))}}InitGrid(e,t){let i;this.GridDataObj.TableColumns.push("Select"),this.GridDataObj.TableColumns.push("ProductName_Key"),this.GridDataObj.TableColumns.push("SubstituteType"),i=new c.a,i.Header="Select",i.DisplayMember="Select",i.DataType="RadioButton",i.Width=50,i.CheckedChanged=this.onClick,i.IsFrozen=!0,i.IsVisible=!1,this.ColumnSource.push(i),t&&(i=new c.a,i.Header="Type",i.DisplayMember="SubstituteType",i.Width=75,i.IsFrozen=!0,i.ReadOnly=!0,this.ColumnSource.push(i));for(let a=0;a<e.length;a++)i=new c.a,i.Header=e[a].UserColumnName.toString(),i.DisplayMember=n.e.StringValue(e[a].SYSCOLUMNNAME),i.Width=n.e.StringIsNullOrEmpty(e[a].ColumnWidth)?50:parseInt(e[a].ColumnWidth.toString()),""==n.e.StringValue(e[a].SYSCOLUMNNAME)?i.DisplayMember=e[a].CCID.toString():"26428"==e[a].ColID.toString()?i.DisplayMember="onHand":"PurchaseRate"==e[a].SYSCOLUMNNAME&&this.Parent.ScreenObject.IsPurchase?i.DisplayMember="Price":"SellingRate"!=e[a].SYSCOLUMNNAME||this.Parent.ScreenObject.IsPurchase||(i.DisplayMember="Price"),"FLOAT"==e[a].usercolumntype&&(i.DataType="FLOAT","onHand"==i.DisplayMember||"Price"==i.DisplayMember||i.DisplayMember.Contains("Rate")?s.a.SessionManager.Preferences.ContainsKey("DecimalsinAmount")&&""!=s.a.SessionManager.Preferences.DecimalsinAmount&&(i.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinAmount):s.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=s.a.SessionManager.Preferences.DecimalsinQty&&(i.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinQty)),i.ReadOnly=!0,this.ColumnSource.push(i),this.GridDataObj.TableColumns.push(i.DisplayMember);if(this.Parent.ScreenObject.Preferences.ContainsKey("SubstituteOnQty")&&""!=this.Parent.ScreenObject.Preferences.SubstituteOnQty&&this.Parent.ScreenObject.GridDataObj.TableColumns.Contains(this.Parent.ScreenObject.Preferences.SubstituteOnQty)){var r=this.Parent.ScreenObject.ColumnSource.find(e=>e.DisplayMember.toLowerCase()==this.Parent.ScreenObject.Preferences.SubstituteOnQty.toLowerCase());r&&(i=new c.a,i.Header=r.Header,i.DisplayMember="SubQOH",i.Width=r.Width,i.ReadOnly=!0,this.ColumnSource.push(i),this.GridDataObj.TableColumns.push(i.DisplayMember))}}onQtyClick(){if(null!=this.SelectedRow&&null!=this.SelectedRow.ProductName_Key){this.GridDataObj.TableColumns.Contains("ProductCode")&&(this.ProductCode=this.SelectedRow.ProductCode.toString()),this.GridDataObj.TableColumns.Contains("ProductName")&&(this.ProductName=this.SelectedRow.ProductName.toString()),this.ProductID=this.SelectedRow.ProductName_Key.toString();let e=Date.Today();n.e.IsType(this.Parent,"AddEditDocumentViewModel")&&(e=this.Parent.DocumentDate);let t=s.a.inventory.GetProductQOH(this.ProductID,e,"");if(null!=t&&t.Tables.length>0&&t.Columns[0].Contains("QOH")){this.ProductsGridDataObj.Table=[];let e=[];for(let i=0;i<t.Tables[0].Columns.length;i++){if("QOH"==t.Tables[0].Columns[i]){let t=new c.a;t.Header="QOH",t.DisplayMember="QOH",t.DataType="FLOAT",t.ReadOnly=!0,t.Width=75,s.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=s.a.SessionManager.Preferences.DecimalsinQty&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinQty),this.ProductsGridDataObj.TableColumns.push("QOH"),e.push(t);break}{this.ProductsGridDataObj.TableColumns.push(t.Tables[0].Columns[i+1]);let n=new c.a;n.Header=t.Tables[0].Columns[i],n.DisplayMember=t.Tables[0].Columns[i+1],n.DataType="TextBlock",n.ReadOnly=!0,n.Width=150,s.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=s.a.SessionManager.Preferences.DecimalsinQty&&(n.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinQty),e.push(n),i++}}this.ProductsGridDataObj.Columns=e;for(let i=0;i<t.Tables[0].length;i++){let e=this.ProductsGridDataObj.NewRow();for(let s=0;s<t.Tables[0].Columns.length;s++){if("QOH"==t.Tables[0].Columns[s]){e.QOH=t.Tables[0][i].QOH.toString();break}e[t.Tables[0].Columns[s+1]]=t.Tables[0][i][t.Tables[0].Columns[s]].toString(),s++}this.ProductsGridDataObj.addRow(e)}}this.AllProducstsVisibility=!1,this.AllLocationVisibility=!0}}OnButtonClick(e){if("Cancel"==e)s.a.page.HideDialog(),null!=this.Parent&&null!=this.Parent.SelectedRow&&(this.Parent.SelectedRow.Subexists="1"),this.Parent.SubDialogResult=!1;else if("onClick"==e);else if("back"==e)this.AllProducstsVisibility=!0,this.AllLocationVisibility=!1;else if("OK"==e)return void this.onClick(this.SelectedRow,!0)}FillSalesPurchase(e,t){this.FillDatarow(e,t,"22821","SellingRate"),this.FillDatarow(e,t,"22793","SellingRateA"),this.FillDatarow(e,t,"22794","SellingRateB"),this.FillDatarow(e,t,"22795","SellingRateC"),this.FillDatarow(e,t,"22796","SellingRateD"),this.FillDatarow(e,t,"22797","SellingRateE"),this.FillDatarow(e,t,"22798","SellingRateF"),this.FillDatarow(e,t,"22799","SellingRateG"),this.FillDatarow(e,t,"22820","PurchaseRate"),this.FillDatarow(e,t,"22786","PurchaseRateA"),this.FillDatarow(e,t,"22787","PurchaseRateB"),this.FillDatarow(e,t,"22788","PurchaseRateC"),this.FillDatarow(e,t,"22789","PurchaseRateD"),this.FillDatarow(e,t,"22790","PurchaseRateE"),this.FillDatarow(e,t,"22791","PurchaseRateF"),this.FillDatarow(e,t,"22792","PurchaseRateG")}FillDatarow(e,t,i,s){let r=this.Parent.ScreenObject.Data.Tables[0];r.length>0&&(r=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&e.LinkData==i),r.length>0&&this.Parent.ScreenObject.GridDataColumns.Contains(r[0].SysColumnName.toString())&&(n.e.StringIsNullOrEmpty(t[s])?e[r[0].SysColumnName.toString()]=0:e[r[0].SysColumnName.toString()]=t[s].toString()))}}}}]);
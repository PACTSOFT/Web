function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var s=0;s<e.length;s++){var a=e[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _createClass(t,e,s){return e&&_defineProperties(t.prototype,e),s&&_defineProperties(t,s),t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _createSuper(t){var e=_isNativeReflectConstruct();return function(){var s,a=_getPrototypeOf(t);if(e){var i=_getPrototypeOf(this).constructor;s=Reflect.construct(a,arguments,i)}else s=a.apply(this,arguments);return _possibleConstructorReturn(this,s)}}function _possibleConstructorReturn(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}(window.webpackJsonp=window.webpackJsonp||[]).push([[168],{qXLx:function(t,e,s){"use strict";s.r(e),s.d(e,"AddEditBatchViewModel",(function(){return D}));var a=s("Do2H"),i=s("Lp6j"),r=s("VxiT"),n=s("NkMH"),o=s("EQd/"),h=s("0/4Q"),c=s("JIg3"),l=s("n56n"),u=s("RJs6"),d=s("OvA8"),b=s("THE7"),S=s("ScVY"),y=s("eQJW"),D=function(t){_inherits(s,t);var e=_createSuper(s);function s(t,i,S){var y;return _classCallCheck(this,s),(y=e.call(this)).ColumnSpan="4",y.CostCenterID=0,y.objBatch=null,y.ScreenObject=new r.a,y.BtnCustomize=new n.a,y.DisplayName="",y.MessageVisibility=!1,y.DisplayMessage="",y.DetailsVisibility=!1,y.ContactVisibility=!1,y.ContactExpanded=!1,y.NoteVisibility=!1,y.AttachmentVisibility=!1,y.ScreenName="",y.BatchNumber=new o.d(1558),y.BatchCode=new o.a(27184),y.Status=new h.e(1552),y.Group=new h.e(1557),y.MfgDateFormat=new o.d(1562),y.MfgDate=new c.c(1563),y.ExpiryDateFormat=new o.d(1564),y.ExpiryDate=new c.c(1565),y.RetestDate=new c.c(53584),y.MRPRate=new o.d(1566),y.MRPCurrID=new l.b(1567),y.MRPExchRT=new o.d(1568),y.RetailRate=new o.d(1569),y.RRCurrID=new l.b(1570),y.RRExchRT=new o.d(1571),y.StockistRate=new o.d(1572),y.SRCurrID=new l.b(1573),y.SRExchRT=new o.d(1574),y.ProductID=new l.b(1575),y.VendorAccountID=new l.b(1581),y.AlertDays=new o.d(1582),y.PreExpiryDays=new o.d(1584),y.parent=0,y.AddressTypes=[],y.SelectedAddressType="",y.Address1="",y.Address2="",y.Address3="",y.City="",y.State="",y.Country="",y.Pin="",y.Phone1="",y.Phone2="",y.Fax="",y.Email1="",y.Email2="",y.PrimaryContact="",y.URL="",y.BatchID=0,y.OnlyMonthYear=!1,Logger.InfoLog("AddEditBatchViewModel::Entering AddEditBatchViewModel With _Name="+t+"ID"+i),y.ScreenName=t,y.Title=y.ScreenName,y.objBatch={},y.objBatch.BatchID=i,y.BatchID=i,y.CostCenterID=16,parent=S,y.ViewContacts=new b.a(_assertThisInitialized(y)),y.ViewNotes=new u.a(_assertThisInitialized(y),a.a.SessionManager,a.a.admin),y.ViewAttachments=new d.ViewAttachmentViewModel(_assertThisInitialized(y),a.a.SessionManager,a.a.admin),y.OnLoad(),null!=y.MfgDate&&y.MfgDate.SelectedDateChanged.Subscribe(_assertThisInitialized(y),"OnDateChanged"),y.DisplayName=y.ScreenName,y.AutoGenerateCode(),y.ContactVisibility=!1,Logger.InfoLog("AddEditBatchViewModel::Exiting AddEditBatchViewModel"),y}return _createClass(s,[{key:"onTabSelectionChanged",value:function(t){null!=this.ScreenObject.CustomTab.SelectedTab&&("Notes"==this.ScreenObject.CustomTab.SelectedTab.Name?(this.AttachmentVisibility=!1,this.ContactVisibility=!1,this.ViewNotes=new u.a(this,a.a.SessionManager,a.a.admin)):"Attachments"==this.ScreenObject.CustomTab.SelectedTab.Name?(this.ViewAttachments.OnShowNewAttachment(null),this.NoteVisibility=!1,this.ContactVisibility=!1):"Contacts"==this.ScreenObject.CustomTab.SelectedTab.Name?(this.NoteVisibility=!1,this.AttachmentVisibility=!1,this.ViewContacts.OnShowNewContact(null)):(this.NoteVisibility=!1,this.AttachmentVisibility=!1,this.ContactVisibility=!1))}},{key:"OnDateChanged",value:function(t){if(this.MfgDate.Date&&null!=this.ProductID&&this.ProductID.SelectedValue>0){var e=this.ScreenObject.GetProductShelfLife(this.ProductID.SelectedValue.toString());null!=this.ExpiryDate&&e>0&&(this.ExpiryDate.Date=this.MfgDate.Date.AddDays(e))}}},{key:"OnLoad",value:function(){var t=this;this.DisplayName=a.a.GetResource("Loading"),this.ScreenObject.LoadScreen_2(this,16),"INT"!=this.MRPRate.DataType&&"FLOAT"!=this.MRPRate.DataType||(this.MRPRate.Align="Right",this.MRPRate.DecimalPoints=a.a.SessionManager.Preferences.DecimalsinExtraFields.toString()),"INT"!=this.StockistRate.DataType&&"FLOAT"!=this.StockistRate.DataType||(this.StockistRate.Align="Right",this.MRPRate.DecimalPoints=a.a.SessionManager.Preferences.DecimalsinExtraFields.toString()),"INT"!=this.RetailRate.DataType&&"FLOAT"!=this.RetailRate.DataType||(this.RetailRate.Align="Right",this.MRPRate.DecimalPoints=a.a.SessionManager.Preferences.DecimalsinExtraFields.toString()),null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>9&&this.ScreenObject.Data.Columns[9].Contains("IsParentCodeInherited")&&this.ScreenObject.Data.Tables[9].length>0&&this.ScreenObject.InitAutoCode(this.ScreenObject.Data.Tables[9],this.objBatch.IsGroup);var e=this.ScreenObject.Data.Tables[5].filter((function(t){return"OnlyMonthYear"==t.Name}));e.length>0&&(this.OnlyMonthYear=Object(y.j)(e[0].Value)),this.OnlyMonthYear&&(this.RetestDate.CustomFormat=this.MfgDate.CustomFormat=this.ExpiryDate.CustomFormat="MMM/yyyy"),this.ScreenObject.Data.Tables[3].forEach((function(e){t.Status.Items.push(h.d.ComboBoxItems_2(e[Object.keys(e)[1]].toString(),e[Object.keys(e)[0]].toString()))})),this.ScreenObject.Data.Tables[3].length>0&&(this.Status.SelectedValue=this.ScreenObject.Data.Tables[3][0][Object.keys(this.ScreenObject.Data.Tables[3][0])[0]].toString()),this.ScreenObject.Data.Tables[4].forEach((function(e){t.Group.Items.push(h.d.ComboBoxItems_2(e[Object.keys(e)[1]].toString(),e[Object.keys(e)[0]].toString()))})),0!=this.objBatch.BatchID?this.FillControls():(this.objBatch.GUID="",this.Group.SelectedValue=parent.toString()),Logger.InfoLog("AddEditBatchViewModel::Exiting worker_DoWork"),this.AddressTypes=[],this.AddressTypes.push(h.d.ComboBoxItems_2(a.a.GetResource("Address_Permanent"),"1")),this.AddressTypes.push(h.d.ComboBoxItems_2(a.a.GetResource("Address_Temporary"),"2")),this.SelectedAddressType="1",this.AssignRowColumns();for(var s=this.ScreenObject.CustomTab.Pages.length-1;s>=0;s--){var i=this.ScreenObject.CustomTab.Pages[s];switch(i.Name){case"Notes":i.Fields.push(this.ViewNotes);break;case"Contacts":i.Fields.push(this.ViewContacts);break;case"Attachments":i.Fields.push(this.ViewAttachments)}}}},{key:"SetLastDay",value:function(t){t.Date.getDate()!=t.Date.DaysInMonth()&&(t.Date=new Date(t.Date.getFullYear(),t.Date.getMonth(),t.Date.DaysInMonth()))}},{key:"OnSaveBatch",value:function(t){var e=this;Logger.InfoLog("AddEditBatchViewModel::Entering OnSaveBatch");try{var s=this.ScreenObject.ValidateData();if(s.length>0)return this.MessageVisibility=!0,void(this.DisplayMessage=s);if(0==this.objBatch.BatchID){var i={StrCode:this.objBatch.BatchCode,CodePrefix:this.objBatch.CodePrefix,CodeNumber:this.objBatch.CodeNumber};if(this.DisplayMessage=this.ScreenObject.SetAutoCodeParams_3(this.BatchCode,this.objBatch.BatchGroup,this.ScreenObject.Data.Tables[9],i),this.objBatch.BatchCode=i.StrCode,this.objBatch.CodePrefix=i.CodePrefix,this.objBatch.CodeNumber=i.CodeNumber,this.DisplayMessage.length>0)return}else this.objBatch.BatchCode=this.BatchCode.Text;this.objBatch.BatchNumber=this.BatchNumber.Text,this.objBatch.MfgDateFormat=this.MfgDateFormat.Text,this.MfgDate.Date?(this.OnlyMonthYear&&this.SetLastDay(this.MfgDate),this.objBatch.MfgDate=this.MfgDate.Date.ToString("dd/MMM/yyyy")):this.objBatch.MfgDate="1/JAN/1900",this.objBatch.ExpiryDateFormat=this.ExpiryDateFormat.Text,this.ExpiryDate.Date?(this.OnlyMonthYear&&this.SetLastDay(this.ExpiryDate),this.objBatch.ExpiryDate=this.ExpiryDate.Date.ToString("dd/MMM/yyyy")):this.objBatch.ExpiryDate="1/JAN/1900",this.objBatch.BatchStatus=parseInt(this.Status.SelectedValue),this.objBatch.MRPRate=""!=this.MRPRate.Text?parseFloat(this.MRPRate.Text):0,this.objBatch.MRPCurrID=""!=this.MRPCurrID.SelectedValue.toString()?this.MRPCurrID.SelectedValue:0,this.objBatch.MRPExchRT=""!=this.MRPExchRT.Text?parseFloat(this.MRPExchRT.Text):0,this.objBatch.RetailRate=""!=this.RetailRate.Text?parseFloat(this.RetailRate.Text):0,this.objBatch.RRCurrID=""!=this.RRCurrID.SelectedValue.toString()?this.RRCurrID.SelectedValue:0,this.objBatch.RRExchRT=""!=this.RRExchRT.Text?parseFloat(this.RRExchRT.Text):0,this.objBatch.StockistRate=""!=this.StockistRate.Text?parseFloat(this.StockistRate.Text):0,this.objBatch.SRCurrID=""!=this.SRCurrID.SelectedValue.toString()?this.SRCurrID.SelectedValue:0,this.objBatch.SRExchRT=""!=this.SRExchRT.Text?parseFloat(this.SRExchRT.Text):0,this.objBatch.ProductID=""!=this.ProductID.SelectedValue.toString()&&"0"!=this.ProductID.SelectedValue.toString()?this.ProductID.SelectedValue:0,this.objBatch.VendorAccountID=""!=this.VendorAccountID.SelectedValue.toString()&&"0"!=this.VendorAccountID.SelectedValue.toString()?this.VendorAccountID.SelectedValue:0,this.objBatch.AlertDays=""!=this.AlertDays.Text?parseInt(this.AlertDays.Text):0,this.objBatch.PreExpiryDays=""!=this.PreExpiryDays.Text?parseInt(this.PreExpiryDays.Text):0,this.objBatch.BatchGroup=""!=this.Group.SelectedValue?parseInt(this.Group.SelectedValue):0;var r="";this.RetestDate.Date?(this.OnlyMonthYear&&this.SetLastDay(this.RetestDate),r=this.RetestDate.Date.ToString("dd/MMM/yyyy")):r="1/JAN/1900",this.objBatch.CustomFieldsQuery=this.ScreenObject.GetCustomFieldsQuery(),this.objBatch.CustomCostCenterFieldsQuery=this.ScreenObject.GetCustomCostCenterFieldsQuery(),this.objBatch.CustomFieldCCMapXML=this.ScreenObject.GetCustomFieldCCMapXML(),this.objBatch.ContactsXML=this.ViewContacts.GetXML(),this.objBatch.NotesXML=this.ViewNotes.GetXML(),this.objBatch.AttachmetsXML=this.ViewAttachments.GetXML(),null!=this.SelectedAddressType&&(this.objBatch.SelectedAddressType=this.SelectedAddressType),null!=this.PrimaryContact&&(this.objBatch.PrimaryContact=this.PrimaryContact),null!=this.Address1&&(this.objBatch.Address1=this.Address1),null!=this.Address2&&(this.objBatch.Address2=this.Address2),null!=this.Address3&&(this.objBatch.Address3=this.Address3),null!=this.City&&(this.objBatch.City=this.City),null!=this.State&&(this.objBatch.State=this.State),null!=this.Pin&&(this.objBatch.Pin=this.Pin),null!=this.Country&&(this.objBatch.lengthry=this.Country),null!=this.Phone1&&(this.objBatch.Phone1=this.Phone1),null!=this.Phone2&&(this.objBatch.Phone2=this.Phone2),null!=this.Fax&&(this.objBatch.Fax=this.Fax),null!=this.Email1&&(this.objBatch.Email1=this.Email1),null!=this.objBatch&&(this.objBatch.Email2=this.Email2),null!=URL&&(this.objBatch.URL=URL);a.a.inventory.AddBatch(this.objBatch,"AddBatch",r).subscribe((function(t){e.MessageVisibility=!0,e.DisplayMessage=t.Message,t.RetValue>0&&(e.ScreenObject.Clear(),e.ViewContacts.ContactsListObj.Clear(),e.ViewNotes.NotesListObj.Clear(),e.ViewAttachments.AttachmentsListObj.Clear(),e.PrimaryContact="",e.Address1="",e.Address2="",e.Address3="",e.City="",e.State="",e.Pin="",e.Country="",e.Phone1="",e.Phone2="",e.Fax="",e.Email1="",e.Email2="",e.URL="",e.BatchID>0&&(e.BatchCode.Text="")),Logger.InfoLog("AddEditBatchViewModel::Exiting OnSaveBatch")}),(function(t){console.log("AddEditBatchViewModel Save : "+JSON.stringify(t))}))}catch(n){Logger.InfoLog("AddEditBatchViewModel::Exception OnSaveBatch:"+n.stack)}}},{key:"onCanSaveBatch",value:function(t){return!0}},{key:"FillControls",value:function(){var t=a.a.inventory.GetBatchDetails(this.BatchID);if(Object.assign(this.objBatch,t.obj),t.Tables.length>0&&t.Tables[0].length>0){if(i.e.StringIsNullOrEmpty(t.Tables[0][0].BatchCode)||(this.BatchCode.Text=t.Tables[0][0].BatchCode.toString()),(this.ScreenObject.InheritParentCode||this.ScreenObject.IsAutoCode)&&(this.BatchCode.Enable=!1),i.e.StringIsNullOrEmpty(t.Tables[0][0].BatchNumber)||(this.BatchNumber.Text=t.Tables[0][0].BatchNumber.toString()),i.e.StringIsNullOrEmpty(t.Tables[0][0].StatusID)||(this.Status.SelectedValue=t.Tables[0][0].StatusID.toString()),i.e.StringIsNullOrEmpty(t.Tables[0][0].ParentID)||(this.Group.SelectedValue=t.Tables[0][0].ParentID.toString()),i.e.StringIsNullOrEmpty(t.Tables[0][0].MfgDateFormat)||(this.MfgDateFormat.Text=t.Tables[0][0].MfgDateFormat.toString()),i.e.StringIsNullOrEmpty(t.Tables[0][0].MfgDate)||(this.MfgDate.Text=t.Tables[0][0].MfgDate.toString()),i.e.StringIsNullOrEmpty(t.Tables[0][0].MfgDate)||(this.MfgDate.Date=new Date(t.Tables[0][0].MfgDate)),i.e.StringIsNullOrEmpty(t.Tables[0][0].ExpiryDateFormat)||(this.ExpiryDateFormat.Text=t.Tables[0][0].ExpiryDateFormat.toString()),i.e.StringIsNullOrEmpty(t.Tables[0][0].ExpiryDate)||(this.ExpiryDate.Text=t.Tables[0][0].ExpiryDate.toString()),i.e.StringIsNullOrEmpty(t.Tables[0][0].ExpiryDate)||(this.ExpiryDate.Date=new Date(t.Tables[0][0].ExpiryDate)),i.e.StringIsNullOrEmpty(t.Tables[0][0].RetestDate)||(this.RetestDate.CustomFormat=a.a.SessionManager.Preferences["Date Format"].toString(),this.RetestDate.Text=new Date(t.Tables[0][0].RetestDate).ToString(a.a.SessionManager.Preferences["Date Format"]),this.RetestDate.Date=new Date(t.Tables[0][0].RetestDate)),i.e.StringIsNullOrEmpty(t.Tables[0][0].MRPRate)||(this.MRPRate.Text=t.Tables[0][0].MRPRate.toString()),i.e.StringIsNullOrEmpty(t.Tables[0][0].MRPCurrID)||(this.MRPCurrID.SelectedValue=parseInt(t.Tables[0][0].MRPCurrID)),i.e.StringIsNullOrEmpty(t.Tables[0][0].MRPExchRT)||(this.MRPExchRT.Text=t.Tables[0][0].MRPExchRT.toString()),i.e.StringIsNullOrEmpty(t.Tables[0][0].RetailRate)||(this.RetailRate.Text=t.Tables[0][0].RetailRate.toString()),i.e.StringIsNullOrEmpty(t.Tables[0][0].RRCurrID)||(this.RRCurrID.SelectedValue=parseInt(t.Tables[0][0].RRCurrID)),i.e.StringIsNullOrEmpty(t.Tables[0][0].RRExchRT)||(this.RRExchRT.Text=t.Tables[0][0].RRExchRT.toString()),i.e.StringIsNullOrEmpty(t.Tables[0][0].StockistRate)||(this.StockistRate.Text=t.Tables[0][0].StockistRate.toString()),i.e.StringIsNullOrEmpty(t.Tables[0][0].SRCurrID)||(this.SRCurrID.SelectedValue=parseInt(t.Tables[0][0].SRCurrID)),i.e.StringIsNullOrEmpty(t.Tables[0][0].SRExchRT)||(this.SRExchRT.Text=t.Tables[0][0].SRExchRT.toString()),i.e.StringIsNullOrEmpty(t.Tables[0][0].ProductID)||(this.ProductID.SelectedValue=parseInt(t.Tables[0][0].ProductID)),i.e.StringIsNullOrEmpty(t.Tables[0][0].VendorAccountID)||(this.VendorAccountID.SelectedValue=parseInt(t.Tables[0][0].VendorAccountID)),i.e.StringIsNullOrEmpty(t.Tables[0][0].AlertDays)||(this.AlertDays.Text=t.Tables[0][0].AlertDays.toString()),i.e.StringIsNullOrEmpty(t.Tables[0][0].PreExpiryDays)||(this.PreExpiryDays.Text=t.Tables[0][0].PreExpiryDays.toString()),t.Tables[2].length>0){var e=t.Tables[2];i.e.IsEmpty(e[0].AddressTypeID)||(this.SelectedAddressType=e[0].AddressTypeID.toString()),i.e.IsEmpty(e[0].ContactName)||(this.PrimaryContact=e[0].ContactName.toString()),i.e.IsEmpty(e[0].Address1)||(this.Address1=e[0].Address1.toString()),i.e.IsEmpty(e[0].Address2)||(this.Address2=e[0].Address2.toString()),i.e.IsEmpty(e[0].Address3)||(this.Address3=e[0].Address3.toString()),i.e.IsEmpty(e[0].City)||(this.City=e[0].City.toString()),i.e.IsEmpty(e[0].State)||(this.State=e[0].State.toString()),i.e.IsEmpty(e[0].Zip)||(this.Pin=e[0].Zip.toString()),i.e.IsEmpty(e[0].Country)||(this.Country=e[0].Country.toString()),i.e.IsEmpty(e[0].Phone1)||(this.Phone1=e[0].Phone1.toString()),i.e.IsEmpty(e[0].Phone2)||(this.Phone2=e[0].Phone2.toString()),i.e.IsEmpty(e[0].Email1)||(this.Email1=e[0].Email1.toString()),i.e.IsEmpty(e[0].Email2)||(this.Email2=e[0].Email2.toString()),i.e.IsEmpty(e[0].Fax)||(this.Fax=e[0].Fax.toString()),i.e.IsEmpty(e[0].URL)||(this.URL=e[0].URL.toString())}this.ScreenObject.LoadCustomFieldsData(t.Tables[0]),this.ScreenObject.LoadCustomFieldsCCData(t.Tables[5]),this.ViewContacts.LoadContacts(t.Tables[2],t.Columns[2]),this.ViewNotes.LoadNotes(t.Tables[3]),this.ViewAttachments.LoadAttachments(t.Tables[4])}}},{key:"BuildControls",value:function(){Logger.InfoLog("AddEditBatchViewModel::Entering BuildControls");try{return(new r.a).GetControls(this.CostCenterID.toString(),a.a.SessionManager.CompanyIndex)}catch(t){return Logger.ErrorLog("AddEditBatchViewModel:: BuildControls"+t.stack),null}}},{key:"AutoGenerateCode",value:function(){0==this.BatchID&&(this.objBatch.BatchGroup=""!=this.Group.SelectedValue?parseInt(this.Group.SelectedValue)>0?parseInt(this.Group.SelectedValue):0:1,this.ScreenObject.SetAutoCode(this.BatchCode,this.objBatch.IsGroup,this.objBatch.BatchGroup,this.ScreenObject.Data.Tables[9]))}},{key:"load",value:function(){}},{key:"AssignRowColumns",value:function(){var t;t=this.ScreenObject.CustomFields.length;for(var e=0;e<t;e++);}}]),s}(S.b)}}]);
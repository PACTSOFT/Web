function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,i=_getPrototypeOf(e);if(t){var o=_getPrototypeOf(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[202],{IK0V:function(e,t,n){"use strict";n.r(t),n.d(t,"QuickAddUnitViewModel",(function(){return b}));var i=n("Do2H"),o=n("Lp6j"),r=n("eQJW"),s=n("ScVY"),a=n("EQd/"),l=n("0/4Q"),c=n("n56n"),u=n("NkMH"),d=n("VxiT"),p=n("c6GQ"),f=n("4k0m"),h=n("++IR"),S=n("Lslp"),b=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,s,p,f){var h;if(_classCallCheck(this,n),(h=t.call(this)).Unitsmodel={},h.UnitID=0,h.parentid=0,h.selectedNode=0,h.group=!1,h.ScreenName="",h.Title="",h.DetailButtonVisibility=!0,h.UnitCode=new a.d(25624),h.UnitType=new a.d(25625),h.Status=new l.e(25626),h.Property=new c.b(25623),h.Group=new c.b(25721),h.RetValue=0,h.ScreenObject=new d.a,h.ScreenObject.LoadScreen_1(_assertThisInitialized(h),93,p),h.UnitID=r,h.parent=e,h.parentid=s,h.Group.CCID=93,h.Group.TypeID=1,h.Property.CCID=92,h.Property.TypeID=2,h.selectedNode=f,h.group=p,null!=h.ScreenObject.Data&&h.ScreenObject.Data.Tables.length>0&&h.ScreenObject.Data.Tables[0].length>0){var S=h.ScreenObject.Data.Tables[0].filter((function(e){return 54205==e.CostCenterColID}));S.length>0&&(h.Unitsmodel.BasedOn=o.e.String(S[0].UserDefaultValue))}if(0==h.group?h.Title=i.a.GetResource(0==h.UnitID?"REN_UnitsAdd":"REN_UnitsEdit"):(h.Title=i.a.GetResource("CRMLead_AddGroup"),h.DetailButtonVisibility=!1,h.Unitsmodel.GUID="GUID"),h.Unitsmodel.UnitID=h.UnitID,h.ButtonSave=new u.a,0==h.UnitID)h.Group.SelectedValue=s,h.AutoGenerateCode(),h.Unitsmodel.GUID="GUID";else{var b=i.a.rental.GetUnitDetails(h.UnitID);b.Tables.length>0&&b.Tables[0].length>0&&(h.Unitsmodel.GUID=b.Tables[0][0].GUID.toString(),h.UnitCode.Text=b.Tables[0][0].Code.toString(),h.UnitType.Text=b.Tables[0][0].Name.toString(),h.Status.SelectedValue=b.Tables[0][0].Status.toString(),h.Group.SelectedValue=parseInt(b.Tables[0][0].ParentID),h.Property.SelectedValue=parseInt(b.Tables[0][0].PropertyID),h.ScreenObject.CanApprove(b.Tables[0][0],b.Tables[8][0],h.ButtonSave))}return h.MessageVisibility=!1,_possibleConstructorReturn(h)}return _createClass(n,[{key:"AutoGenerateCode",value:function(){var e=this,t=i.a.common.GetAutoSequence(93,"","93",i.a.SessionManager.CompanyIndex.toString());if(null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>4){var n=this.ScreenObject.Data.Tables[4].filter((function(e){return"CodeAutoGen"==e.Name}));n.length>0&&(Object(r.j)(n[0].Value)?(this.UnitCode.Enable=!1,this.UnitCode.Mandatory=!1,0==this.Unitsmodel.UnitID&&(this.UnitCode.Text=t)):this.UnitCode.Enable=!0)}null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>3&&(this.Status.Items.Clear(),this.ScreenObject.Data.Tables[3].forEach((function(t){e.Status.Items.push(l.d.ComboBoxItems_2(t.Status.toString(),t.StatusID.toString()))})),this.Status.SelectedValue="424")}},{key:"OnSave",value:function(e){var t=this;if("Cancel"==e)this.parent.DetailsVisibility=!0,i.a.page.HideDialog();else if("Save"==e){Logger.InfoLog("SaveUnitViewModel:: OnSave");try{var n=this.ScreenObject.ValidateData();if(!o.e.IsEmpty(n))return this.DisplayMessage=n,void(this.MessageVisibility=!0);this.Unitsmodel.Code=this.UnitCode.Text,this.Unitsmodel.StatusID=o.e.IsEmpty(this.Status.SelectedValue)?0:parseInt(this.Status.SelectedValue),this.Unitsmodel.Name=this.UnitType.Text,this.Unitsmodel.IsGroup=this.group,this.Unitsmodel.Property=0!=this.Property.SelectedValue?this.Property.SelectedValue:0,this.Unitsmodel.SelectedNodeID=this.selectedNode,this.Unitsmodel.WID=this.ScreenObject.CheckWorkFlow(),0==this.Unitsmodel.UnitID?i.a.rental.SaveUnits(this.Unitsmodel,"SaveUnits").subscribe((function(e){t.DisplayMessage=e.Message,t.MessageVisibility=!0,t.RetValue=e.RetValue,t.RetValue>0&&(t.UnitCode.Text="",t.Status.SelectedValue="424",t.UnitID=0,t.UnitType.Text="",t.Unitsmodel.UnitID=0,null!=t.parent&&t.parent.Refresh(),t.AutoGenerateCode(),t.Group.SelectedValue=t.selectedNode)}),(function(e){console.log(" Unit Save : "+JSON.stringify(e))})):i.a.rental.SaveUnits(this.Unitsmodel,"QuickUpdateUnit").subscribe((function(e){t.DisplayMessage=e.Message,t.MessageVisibility=!0,t.RetValue=e.RetValue,t.RetValue>0&&(t.UnitCode.Text="",t.Status.SelectedValue="424",t.UnitID=0,t.UnitType.Text="",t.Unitsmodel.UnitID=0,null!=t.parent&&t.parent.Refresh(),t.AutoGenerateCode(),t.Group.SelectedValue=t.selectedNode)}),(function(e){console.log(" Quick Unit Save : "+JSON.stringify(e))})),Logger.InfoLog("SaveUnitViewModel:: OnSave")}catch(n){Logger.ErrorLog("SaveUnitViewModel:: OnSave"+n.stack)}}else if("Details"==e.toString()){i.a.page.HideDialog();var r=new p.AddEditUnitsViewModel(this.UnitID,this.group,this.parentid,this.selectedNode);i.a.page.addNewTab({title:r.Title,component:S.AddEditUnitsComponent,params:{obj:r}})}else if("ShowApprove"==e.toString()){var s=new f.a(93,this.Unitsmodel.UnitID,this.ScreenObject,this);i.a.page.ShowDialog(s,h.a,{ShowCenter:!0,Title:i.a.GetResource("ApproveReject")})}}}]),n}(s.b)}}]);
function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var i,a=_getPrototypeOf(e);if(t){var r=_getPrototypeOf(this).constructor;i=Reflect.construct(a,arguments,r)}else i=a.apply(this,arguments);return _possibleConstructorReturn(this,i)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[138],{"5h7L":function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var a=i("3Pt+"),r=i("eQJW"),s=i("Do2H"),o=i("fVK4"),n=i("Lp6j"),l=i("fXoL"),h=i("jhN1"),u=i("gqLd"),c=function(){var e=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){var r;return _classCallCheck(this,i),(r=t.call(this,e)).form=new a.j({}),r.gridid=s.a.slick.gridid,r}return _createClass(i,[{key:"ngOnInit",value:function(){this.obj.RefreshGridColumns.Subscribe(this,"setColumnDefinitions"),this.setColumnDefinitions(),this.setGridOptions(),s.a.page.ActiveTab&&(s.a.page.ActiveTab.grids||(s.a.page.ActiveTab.grids=[]),s.a.page.ActiveTab.grids.push(this.obj))}},{key:"setColumnDefinitions",value:function(){for(var e=[],t=0;t<this.obj.ReportColumns.length;t++){var i=this.obj.ReportColumns[t],a={};a.id=i.ID,a.name=i.HeaderText,a.DataContext=this.obj.ReportColumns[t],a.type=r.e.string,a.filterable=!1,a.sortable=!1,a.formatter=this.cellFormatter,i.HeaderAppearance.IsVisible?a.width=parseInt(i.width):(a.width=0,a.maxWidth=0,a.minWidth=0,a.name="",a.selectable=!1,a.cssClass="display-none",a.headerCssClass="display-none"),a.headerCssClass+=" Column_"+t,a.Index=t,e.push(a)}this.columnDefinitions=e}},{key:"setGridOptions",value:function(){this.gridOptions={autoResize:{containerId:"report-container",sidePadding:0},enableAutoResize:!0,multiSelect:!0,frozenColumn:void 0,enableAutoSizeColumns:!1,enableExport:!1,enableFiltering:!0,showHeaderRow:!1,enableCheckboxSelector:!1,enableRowSelection:!0,enableCellNavigation:!0,colspanCallback:this.setColSpan,checkboxSelector:{hideInColumnTitleRow:!0,hideInFilterHeaderRow:!0,hideSelectAllCheckbox:!1},rowSelectionOptions:{selectActiveRow:!0},dataView:{syncGridSelection:!0},enableRowMoveManager:!1,rowMoveManager:{singleRowMove:!0,disableRowSelection:!0,cancelEditOnDrag:!0},enableTranslate:!0,i18n:s.a.translate,headerRowHeight:2,rowHeight:26,topPanelHeight:5,presets:{}}}},{key:"angularGridReady",value:function(e){var t=this;this.obj.angularGrid=e,this.gridObj=e.slickGrid,e.slickGrid.onKeyDown.subscribe((function(e,i){t.Grd_PreviewKeyDown("",e,i)}))}},{key:"refreshUI",value:function(){this.obj.angularGrid&&this.obj.angularGrid.resizerService.resizeGrid()}},{key:"Grd_PreviewKeyDown",value:function(e,t,i){if(t.ctrlKey&&67==t.which&&!n.e.IsEmpty(this.gridObj.getActiveCell())){var a=this.gridObj.getActiveCell();n.e.IsEmpty(this.obj.SelectedRow)||n.e.IsEmpty(a.cell)||(n.e.copyToClipboard(this.obj.SelectedRow.Cells[a.cell].Text.toString()),t.preventDefault())}}},{key:"handleSelectedRowsChanged1",value:function(e,t){var i=this;Array.isArray(t.rows)&&this.obj.angularGrid&&t.rows.map((function(e){i.obj.SelectedRow=i.obj.angularGrid.slickGrid.getDataItem(e)}))}},{key:"onCellClicked",value:function(e,t){var i,a;try{if(this.obj.DataClick.IsSubscribed&&("A"==(null===(i=e.target)||void 0===i?void 0:i.nodeName)||"a"==(null===(a=e.target)||void 0===a?void 0:a.nodeName))){var r=e.target.innerText;if(e.target.attributes.tag&&e.target.attributes.tag.value&&(r=e.target.attributes.tag.value),r.length>0){var s=t.grid.getColumns()[t.cell],o=this.obj.angularGrid.slickGrid.getDataItem(t.row);this.obj.angularGrid.slickGrid.setSelectedRows([t.row]),this.obj.SelectedIndex=t.row,this.obj.SelectedItem=o,this.obj.DataClick.Call({Column:s.DataContext,ColumnIndex:t.cell,Row:o,Content:r})}}}catch(n){}}},{key:"onDblClick",value:function(e,t){if(this.obj.RowDblClick.IsSubscribed){var i=this.obj.angularGrid.slickGrid.getDataItem(t.row);this.obj.RowDblClick.Call(i,t.cell)}}}]),i}(o.a);return e.\u0275fac=function(t){return new(t||e)(l.Tb(h.b))},e.\u0275cmp=l.Nb({type:e,selectors:[["app-report-grid"]],inputs:{obj:"obj"},features:[l.Ab],decls:5,vars:6,consts:[[1,"PactReportGrid","Pactpagetree"],["GridStyles","",3,"gridId","isreport","gridobj","columnDefinitions","gridOptions","dataset","onAngularGridCreated","sgOnSelectedRowsChanged","sgOnClick","sgOnDblClick"]],template:function(e,t){1&e&&(l.Zb(0,"div",0),l.Wc(1,"\n    "),l.Zb(2,"angular-slickgrid",1),l.hc("onAngularGridCreated",(function(e){return t.angularGridReady(e)}))("sgOnSelectedRowsChanged",(function(e){return t.handleSelectedRowsChanged1(e.detail.eventData,e.detail.args)}))("sgOnClick",(function(e){return t.onCellClicked(e.detail.eventData,e.detail.args)}))("sgOnDblClick",(function(e){return t.onDblClick(e.detail.eventData,e.detail.args)})),l.Wc(3,"\n    "),l.Yb(),l.Wc(4,"\n"),l.Yb()),2&e&&(l.Db(2),l.vc("gridId","slkSubRPT_",t.gridid,""),l.tc("isreport",!0)("gridobj",t.obj)("columnDefinitions",t.columnDefinitions)("gridOptions",t.gridOptions)("dataset",t.obj.Data))},directives:[r.a,u.a],encapsulation:2}),e}()},EArz:function(e,t,i){"use strict";i.r(t),i.d(t,"DBViewViewModel",(function(){return ie})),i.d(t,"DBPanel",(function(){return ae})),i.d(t,"DBReportFilterViewModel",(function(){return re}));var a,r=i("mrSG"),s=i("Do2H"),o=i("Lp6j"),n=i("ScVY"),l=i("8iaB"),h=i("6z9j"),u=i("XPEG"),c=i("w8Sz"),D=i("USNh"),d=i("4HhE"),p=i("0/4Q"),C=i("ThYU"),T=i("eQJW"),y=i("dH+5"),m=i("z64C"),I=i("Agar"),g=i("vTM8"),f=i("uMy8"),S=i("Huqd"),F=i("1xwR"),b=i("APT5"),A=i("0loF"),v=i("4lLs"),R=function e(){_classCallCheck(this,e),this.IsGroupsExists=!1},M=function(e){_inherits(i,e);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this)).Chart=null,e.LoadingVisibility=!0,e._WidgetVisibility=!0,e._CalendarVisibility=!1,e.ForeColor="#FFFFFF",e.SubFieldsBgColor="#008000",e.SubFieldsBgColorArr=["#017EFF","#FF9700","#3498FB","#0093A4","#9972B5","#FF4040","#2BADCE","#E69500"],e.WidgetID=0,e.TypeID=0,e.Decimals=2,e.strAccounts="",e.Groups="",e.PrevData=0,e.IncludeOpening=!1,e.IsGroupsExists=!1,e.IncludePDC=!1,e.ShowPositive=!1,e.IsAccDoc=!1,e.IsExecutedDocs=!1,e.IsGeneralDocs=!1,e.IsBWDocs=!1,e.IsDurationDifference=!1,e.IsDifferenceView=!1,e.IsFieldsDifference=!1,e.CurrencyType=0,e.ForeignCurrencyID=0,e.Slabs=new Array,e.dicExecutedQuery=new g.a,e.dicUserWiseDims=new g.a,e.dicFilters=new g.c,e.dicLookupFilters=new g.c,e.HeaderValuePostfix="",e.IsLink=!1,e.CallStatusID="",e.eval=new f.b,e.fldDict=new g.a,e.ClassName="WidgetViewModel",e}return _createClass(i,[{key:"WidgetViewModel_1",value:function(e,t,i){if(this.WidgetID=t,this.Header=new w,this.SubFields=[],this.SubFieldsText=[],this.SubFieldsBgColor=this.SubFieldsBgColorArr[Math.abs(t)%8],0!=i.length){var a=new o.f;a.LoadXml(i),this.DBWidgetFilter=o.f.SelectSingleNode(a.DocumentElement,"TreeFilters"),this.InitWidget(),this.ForeColor=e.HeaderForeColor,this.BackgroundColor=e.BodyBackColor,i.split("!")[0].split(","),this.IsDurationDifference=null!=a.DocumentElement.attributes.IsDurationDifference&&"1"==a.DocumentElement.attributes.IsDurationDifference.value,this.IsFieldsDifference=null!=a.DocumentElement.attributes.IsFieldsDifference&&"1"==a.DocumentElement.attributes.IsFieldsDifference.value,this.IsFieldsDifference&&(this.IsDurationDifference=!0),this.IsDurationDifference&&(this.Header.ShowArrow=!0),(this.IsDurationDifference||this.IsFieldsDifference||104==this.TypeID||105==this.TypeID||106==this.TypeID||107==this.TypeID)&&(this.IsDifferenceView=!0),this.Header.LabelType=a.DocumentElement.attributes.HF.value;var r=o.f.SelectSingleNode(a.DocumentElement,"HFForm");if(null!=r&&(this.Header.Formula=r.innerHTML),this.Header.Label=e.Header,this.Header.ForeColor=this.ForeColor,this.Header.txtLbl=new N,this.IsDurationDifference&&!this.IsFieldsDifference){this.DurationLinks=[],this.Header.LabelType="";for(var s=o.f.SelectNodes(a.DocumentElement,"DF"),n=0;n<s.length;n++){var l=new N;l.Row=s[n].attributes.Duration.value,l.Text=s[n].attributes.Caption.value,this.DurationLinks.push(l)}var h=["CurMon","PrevMn"];this.DurationLinks.length>0&&(h=this.SetDurationFilter(this.DurationLinks[0],!1));for(var u=0;u<h.length;u++){var c=new w;c.LabelType=h[u],c.Label=0==u?"Current":"Previous",c.Row=u.ToString(),c.ForeColor=this.ForeColor,c.SetSubFields(),this.SubFields.push(c),this.SubFieldsText.push(c.txtLbl),this.SubFieldsText.push(c.txtValue),this.SubFieldsText.push(c.txtSep),this.SubFieldsText.push(c.txtPercent)}}else 11==this.TypeID||12==this.TypeID||13==this.TypeID||14==this.TypeID||15==this.TypeID||18==this.TypeID||19==this.TypeID||20==this.TypeID||102==this.TypeID?(o.e.IsEmpty(this.Header.LabelType)&&(this.Header.LabelType="YrToDate"),11!=this.TypeID&&12!=this.TypeID&&13!=this.TypeID&&18!=this.TypeID&&19!=this.TypeID&&20!=this.TypeID||(this.Header.Visible=!1)):26!=this.TypeID&&27!=this.TypeID||(this.CalendarVisibility=!0,this.WidgetCalendar=new L(this));if(11!=this.TypeID){for(var D=o.f.SelectNodes(a.DocumentElement,"SF"),d=0;d<D.length;d++){var p=new w;p.LabelType=D[d].attributes.Field.value,p.Label=D[d].attributes.Caption.value,null!=D[d].attributes.Perc&&"1"==D[d].attributes.Perc.value&&(p.ShowPercentage=!0),null!=(r=o.f.SelectSingleNode(D[d],"Form"))&&(p.Formula=r.innerHTML),p.Row=d.toString(),p.ForeColor=this.ForeColor,p.SetSubFields(),16==this.TypeID?p.StatusID=a.DocumentElement.attributes.StatusFilter.value:17==this.TypeID&&(p.StatusID=p.LabelType,p.LabelType=a.DocumentElement.attributes.StatusFilter.value),103==this.TypeID&&(p.txtPercent.Visible=!1),this.SubFields.push(p),this.SubFieldsText.push(p.txtLbl),this.SubFieldsText.push(p.txtSep),this.SubFieldsText.push(p.txtValue),this.SubFieldsText.push(p.txtPercent)}17==this.TypeID?(this.Header.StatusID=this.Header.LabelType,this.Header.LabelType=a.DocumentElement.attributes.StatusFilter.value):16==this.TypeID&&(this.Header.StatusID=a.DocumentElement.attributes.StatusFilter.value)}16!=this.TypeID&&17!=this.TypeID||(this.IsGeneralDocs=!0,("21"==this.Header.StatusID||"22"==this.Header.StatusID||"23"==this.Header.StatusID||this.SubFields.find((function(e){return"21"==e.StatusID||"22"==e.StatusID||"23"==e.StatusID})))&&(this.SubFields.find((function(e){return"21"!=e.StatusID&&"22"!=e.StatusID&&"23"!=e.StatusID&&"0"!=e.StatusID}))||(this.IsGeneralDocs=!1),this.IsExecutedDocs=!0),"31"!=this.Header.StatusID&&"32"!=this.Header.StatusID&&"33"!=this.Header.StatusID&&null==this.SubFields.find((function(e){return"31"==e.StatusID||"32"==e.StatusID||"33"==e.StatusID}))||(null==this.SubFields.find((function(e){return"21"!=e.StatusID&&"22"!=e.StatusID&&"23"!=e.StatusID&&"0"!=e.StatusID}))&&(this.IsGeneralDocs=!1),this.IsBWDocs=!0)),this.fldDict.push("value",new f.c("value",0)),this.fldDict.push("Value",new f.c("Value",0)),this.fldDict.push("VALUE",new f.c("VALUE",0)),this.eval.ThrowException=!1,this.eval.SetKeyWords("REPORT")}}},{key:"WidgetViewModel_2",value:function(e,t,i){this.Chart=e,this.WidgetID=t,this.DBWidgetFilter=i,this.Header=new w,this.InitWidget(),17==this.TypeID&&(this.Header.StatusID=this.Header.LabelType),this.Header.LabelType="CHART",this.Header.Label="",14!=this.TypeID&&15!=this.TypeID&&19!=this.TypeID&&20!=this.TypeID&&102!=this.TypeID||(e.ToDate.Date=new Date)}},{key:"InitWidget",value:function(){var e,t,i=this,a=new o.f,r=s.a.report.Widgets(1,this.WidgetID,"",0,1,!1,null,null);if(this.TypeID=parseInt(r.Tables[0][0].WType),this.TypeID>=21&&this.TypeID<=100&&(this.Decimals=0),16!=this.TypeID&&17!=this.TypeID||(this.IsLink=!0),null!=this.DBWidgetFilter?this.LoadTreeFilters(this.DBWidgetFilter):(t=o.e.String(r.Tables[0][0].AccountsXML)).length>0&&(a.LoadXml(t),this.LoadTreeFilters(a.DocumentElement)),(t=o.e.String(r.Tables[0][0].OptionsXML)).length>0){if(a.LoadXml(t),null!=(e=o.f.SelectSingleNode(a.DocumentElement,"Opening"))&&"1"==e.innerHTML&&(this.IncludeOpening=!0),null!=(e=o.f.SelectSingleNode(a.DocumentElement,"PDC"))&&"1"==e.innerHTML&&(this.IncludePDC=!0),null!=(e=o.f.SelectSingleNode(a.DocumentElement,"ShowPositive"))&&"1"==e.innerHTML&&(this.ShowPositive=!0),null!=(e=o.f.SelectSingleNode(a.DocumentElement,"IsAccDoc"))&&"1"==e.innerHTML&&(this.IsAccDoc=!0),null!=(e=o.f.SelectSingleNode(a.DocumentElement,"UserWiseDims"))&&e.innerHTML.length>0)for(var n=e.innerHTML.split(","),l=function(e){var t=void 0,a=s.a.report.IsGroupNode(parseInt(n[e]),0),r=s.a.report.GetDataTable("RPT041",a.TableName,s.a.SessionManager.UserID,n[e]);t="",r.forEach((function(e){t.length>0&&(t+=","),t+=o.e.String(e.NodeID)})),0==t.length&&(t="-12345"),i.dicUserWiseDims.push(n[e],t)},h=0;h<n.length;h++)l(h);null!=(e=o.f.SelectSingleNode(a.DocumentElement,"CurrencyType"))&&(this.CurrencyType=parseInt(e.innerHTML),1==this.CurrencyType?(o.e.IsEmpty(s.a.SessionManager.Preferences.DimensionwiseCurrency)||0==parseInt(s.a.SessionManager.Preferences.DimensionwiseCurrency))&&(this.CurrencyType=0):2==this.CurrencyType&&(e=o.f.SelectSingleNode(a.DocumentElement,"FCCurrency"),this.ForeignCurrencyID=parseInt(e.innerHTML)))}return 14!=this.TypeID&&15!=this.TypeID&&102!=this.TypeID||(t=r.Tables[1][0].DefaultPreferences.toString(),a.LoadXml(t),(e=o.f.SelectSingleNode(a.DocumentElement,"Slabs")).childNodes.forEach((function(e){parseInt(e.innerHTML)>0&&i.Slabs.push(parseInt(e.innerHTML))}))),r}},{key:"LoadTreeFilters",value:function(e){for(var t,a,r=!1,s=i.DefaultTreeCCID(this.TypeID.toString()),n=0;n<e.children.length;n++){var l=e.children[n];if(t="",r=!1,null!=(a=o.f.SelectSingleNode(l,"Groups"))&&(r=!0,t=a.innerHTML),null!=(a=o.f.SelectSingleNode(l,"Nodes"))&&(t.length>0&&(t+=","),t+=a.innerHTML),l.attributes.CC.value==s.toString())this.strAccounts=t,this.IsGroupsExists=r;else{var h=new R;h.Nodes=t,h.IsGroupsExists=r,"44"==l.attributes.CC.value?this.dicLookupFilters.push(parseInt(l.attributes.LookupTypeID.value),h):this.dicFilters.push(parseInt(l.attributes.CC.value),h)}}}},{key:"SetDurationFilter",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.DurationLinks.map((function(e){return e.IsLink=!1})),e.IsLink=!0;var i=["CurMon","PrevMn"];if("Year"==e.Row?(i[0]="YrToDate",i[1]="LastYr"):"Quarter"==e.Row?(i[0]="QtrToDate",i[1]="PrevQtr"):"Week"==e.Row?(i[0]="WeekToDate",i[1]="PrevWeek"):"Day"==e.Row&&(i[0]="Today",i[1]="Yesterday"),!t)return i;this.SubFields[0].LabelType=i[0],this.SubFields[1].LabelType=i[1],this.Refresh()}},{key:"SetValue",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(o.e.IsEmpty(e.LabelType))return null;var a=null;if(19==this.TypeID||20==this.TypeID)a=this.SetQueryBatchExpiryAgeing(e);else if(this.TypeID>=21&&this.TypeID<=100)a=this.SetQueryHRM(e);else{var r=null;if(null==(r=14==this.TypeID||15==this.TypeID||102==this.TypeID||104==this.TypeID||105==this.TypeID||106==this.TypeID||107==this.TypeID?this.SetQueryAgeing(e):16==this.TypeID||17==this.TypeID?this.SetQueryDocumentStatus(e):103==this.TypeID?this.SetQueryDocumentLastInfo(e):this.SetQuery(e)))return null;a=s.a.report.DataSetAsyn("RPT022",r)}return a?a.then((function(a){var r=t.SetValueCallBack(e,a);null!=t.Chart&&t.Chart.WidgetCallBack(i,r),t.LoadingVisibility=!1}),(function(e){t.LoadingVisibility=!1,Logger.ErrorLog("widget error",e),null!=t.Chart&&t.Chart.WidgetCallBack(i,null)})):void 0}},{key:"SetValueCallBack",value:function(e,t){var i=this;if(104==this.TypeID||105==this.TypeID||106==this.TypeID||107==this.TypeID){var a=0;if(t.Tables[0].forEach((function(e){a+=parseFloat(e.Balance)})),t.Tables[0].push({ID:3,Balance:a}),e.Value="",0==t.Tables[0].length)return null;if(!o.e.StringIsNullOrEmpty(e.LabelType)){var r=t.Tables[0].filter((function(t){return t.ID==parseInt(e.LabelType)}));r.length>0&&(e.dbl=parseFloat(r[0].Balance),e.Value=this.GetNumberFormatted(e.dbl,2,e))}this.SubFields.forEach((function(e){if(!o.e.StringIsNullOrEmpty(e.LabelType)){var a=t.Tables[0].filter((function(t){return t.ID==parseInt(e.LabelType)}));e.dbl=a.length>0?parseFloat(a[0].Balance):0,e.txtValue.Text=i.GetNumberFormatted(e.dbl,2,e)}}))}if(null!=this.Chart){if(5==this.TypeID||6==this.TypeID){var n,l,h=[];if(t.Tables[0].length>0)for(var u=function(e){if(l=h.filter((function(i){return i.AccountID==t.Tables[0][e].AccountID})),n=parseFloat(t.Tables[0][e].Balance),l.length>0)l[0].Balance=parseFloat(l[0].Balance)+n;else{var i={};i.AccountID=t.Tables[0][e].AccountID,i.Balance=n,h.push(i)}},c=t.Tables[0].length-1;c>=0;c--)u(c);else h=[];if(this.IncludeOpening){if(6==this.TypeID)for(var D=t.Tables[1].length-1;D>=0;D--)t.Tables[1][D].OpBalance=-parseFloat(t.Tables[1][D].OpBalance);for(var d=function(e){if(l=h.filter((function(i){return i.AccountID==t.Tables[1][e].AccountID})),n=parseFloat(t.Tables[1][e].OpBalance),l.length>0)l[0].Balance=parseFloat(l[0].Balance)+n;else{var i={};i.AccountID=t.Tables[1][e].AccountID,i.Balance=n,h.push(i)}},p=t.Tables[1].length-1;p>=0;p--)d(p);for(var C=function(e){parseFloat(h.filter((function(i){return i.AccountID==t.Tables[1][e].AccountID.toString()}))[0].Balance)<0&&t.Tables[1].RemoveAt(e)},T=t.Tables[1].length-1;T>=0;T--)C(T);var y=t.Tables[1].Compute("sum","OpBalance");null==y&&(y=0),t.Tables[1].Clear();var m={};m.OpBalance=parseFloat(y),t.Tables[1].push(m)}for(var I=function(e){parseFloat(h.filter((function(i){return i.AccountID==t.Tables[0][e].AccountID}))[0].Balance)<0&&t.Tables[0].RemoveAt(e)},g=t.Tables[0].length-1;g>=0;g--)I(g);n=0;var f=null,S=null;if("YrWise"==this.Groups)for(var F=0;F<t.Tables[0].length;F++)f!=t.Tables[0][F].Yr.toString()?(n=parseFloat(t.Tables[0][F].Balance),f=t.Tables[0][F].Yr.toString()):(n+=parseFloat(t.Tables[0][F].Balance),t.Tables[0].RemoveAt(F),F--,t.Tables[0][F].Balance=n);else for(var b=0;b<t.Tables[0].length;b++)f!=t.Tables[0][b].Yr.toString()||S!=t.Tables[0][b].Mn.toString()?(n=parseFloat(t.Tables[0][b].Balance),f=t.Tables[0][b].Yr.toString(),S=t.Tables[0][b].Mn.toString()):(n+=parseFloat(t.Tables[0][b].Balance),t.Tables[0].RemoveAt(b),b--,t.Tables[0][b].Balance=n)}e.dbl=0,this.IncludeOpening&&(e.dbl=parseFloat(t.Tables[1][0].OpBalance)),this.ShowPositive&&(e.dbl=-e.dbl,t.Tables[0].forEach((function(e){e.Balance=-parseFloat(e.Balance)})))}else if(16==this.TypeID||17==this.TypeID)this.SetDocStatusCount(e,t),e.Value=this.GetNumberFormatted(e.dbl,0,e);else if(66==this.TypeID){var A=new Date((new Date).getFullYear(),s.a.SessionManager.AccountingFromMonth,1),v=new Date(s.a.SessionManager.AccountingFromMonth>1?(new Date).getFullYear()+1:(new Date).getFullYear(),s.a.SessionManager.AccountingToMonth,1);v=v.AddMonths(1).AddDays(-1),e.Value=A.ToString("MMM yyyy")+" - "+v.ToString("MMM yyyy")}else 67==this.TypeID?(e.breakSpaces=!0,e.Value="Assigned     Used        Balance\r\n",e.Value+=t.Tables[0].length>0?t.Tables[0][0].Assigned.toString()+"                 "+t.Tables[0][0].Deducted.toString()+"                 "+t.Tables[0][0].Balance.toString():"0                   0                 0"):103==this.TypeID||104==this.TypeID||105==this.TypeID||106==this.TypeID||107==this.TypeID||(t.Columns[0].Contains("Balance")&&o.e.StringValue(t.ColumnsTypes[0][t.Columns[0].indexOf("Balance")]).toLowerCase().Contains("string")?t.Tables[0].length>0&&(o.e.IsEmpty(t.Tables[0][0].Balance)||(e.Value=t.Tables[0][0].Balance.toString())):(e.dbl=t.Tables[0].length>0?parseFloat(t.Tables[0][0].Balance):0,this.ShowPositive&&(e.dbl=-e.dbl),e.Value=this.GetNumberFormatted(e.dbl,this.Decimals,e)));if(null==this.Chart){if(17==this.TypeID)this.Header.IsLink=this.IsLink,this.SubFields.forEach((function(e){i.SetDocStatusCount(e,t),e.txtValue.IsLink=i.IsLink,e.txtValue.Text=i.GetNumberFormatted(e.dbl,0,e),e.ShowPercentage&&(e.txtPercent.Text=0!=e.dbl?"  ["+(100*i.Header.dbl/e.dbl).Commas("N0")+"%]":"  ["+(0).Commas("N0")+"%]")}));else if(103==this.TypeID){if(e.Value="",0==t.Tables[0].length)return null;if(!o.e.StringIsNullOrEmpty(e.LabelType)&&t.Columns[0].Contains(e.LabelType))if("Amount"==e.LabelType){var R=o.e.Double(t.Tables[0][0][e.LabelType]);e.Value=this.GetNumberFormatted(R,2,e)}else e.Value="DocDate"==e.LabelType?new Date(t.Tables[0][0][e.LabelType]).ToString(s.a.SessionManager.Preferences["Date Format"]):o.e.String(t.Tables[0][0][e.LabelType]);this.SubFields.forEach((function(e){if(!o.e.StringIsNullOrEmpty(e.LabelType)&&t.Columns[0].Contains(e.LabelType))if("Amount"==e.LabelType){var a=o.e.Double(t.Tables[0][0][e.LabelType]);e.txtValue.Text=i.GetNumberFormatted(a,2,e)}else e.txtValue.Text="DocDate"==e.LabelType?new Date(t.Tables[0][0][e.LabelType]).ToString(s.a.SessionManager.Preferences["Date Format"]):o.e.String(t.Tables[0][0][e.LabelType])}))}else if(11==this.TypeID||12==this.TypeID||13==this.TypeID||14==this.TypeID||15==this.TypeID||18==this.TypeID||19==this.TypeID||20==this.TypeID||102==this.TypeID){if(this.SubFields.Clear(),this.SubFieldsText.Clear(),e.Value="0.00",0==t.Tables[0].length)return null;14!=this.TypeID&&15!=this.TypeID&&102!=this.TypeID||(e.dbl=t.Tables[0].length>0?parseFloat(t.Tables[0].Compute("sum","Balance")):0,this.ShowPositive&&(e.dbl=-e.dbl),e.Value=this.GetNumberFormatted(e.dbl,2,e));for(var M=0;M<t.Tables[0].length;M++){var N=new w;N.Row=M.toString(),N.ForeColor=this.ForeColor,N.SetSubFields(),N.txtLbl.Text=t.Tables[0][M][t.Columns[0][0]].toString();var L=parseFloat(t.Tables[0][M].Balance);this.ShowPositive&&(L=-L),N.dbl=L,N.txtValue.Text=this.GetNumberFormatted(L,2,N),11!=this.TypeID&&12!=this.TypeID&&13!=this.TypeID&&18!=this.TypeID||(N.txtPercent.Visible=!1),this.SubFields.push(N),this.SubFieldsText.push(N.txtLbl),this.SubFieldsText.push(N.txtValue),this.SubFieldsText.push(N.txtSep)}}17==this.TypeID||14==this.TypeID||15==this.TypeID||102==this.TypeID?this.SubFields.forEach((function(e){i.Header.Value&&i.Header.Value.length>0?(0!=e.dbl?(e.txtPercent.Percentage=0==i.Header.dbl||e.dbl>i.Header.dbl?100:100*e.dbl/i.Header.dbl,e.txtPercent.Percentage<0&&(e.txtPercent.Percentage=0)):e.txtPercent.Percentage=0,e.txtPercent.Text=0!=e.txtPercent.Percentage&&Math.abs(e.txtPercent.Percentage)<1?"  ["+e.txtPercent.Percentage.Commas("N1")+"%]":"  ["+e.txtPercent.Percentage.Commas("N0")+"%]"):e.txtPercent.Visible=!1})):this.SubFields.find((function(t){return t==e}))&&(this.Header.Value&&this.Header.Value.length>0?(0!=e.dbl?(e.txtPercent.Percentage=0==this.Header.dbl||e.dbl>this.Header.dbl?100:100*e.dbl/this.Header.dbl,e.txtPercent.Percentage<0&&(e.txtPercent.Percentage=0)):e.txtPercent.Percentage=0,e.txtPercent.Text=0!=e.txtPercent.Percentage&&Math.abs(e.txtPercent.Percentage)<1?"  ["+e.txtPercent.Percentage.Commas("N1")+"%]":"  ["+e.txtPercent.Percentage.Commas("N0")+"%]"):e.txtPercent.Visible=!1)}return e.IsDataReady=!0,this.IsDurationDifference&&2==this.SubFields.length&&!this.SubFields.find((function(e){return!e.IsDataReady}))&&(this.Header.dbl=this.SubFields[0].dbl-this.SubFields[1].dbl,this.Header.Value=this.GetNumberFormatted(this.Header.dbl,this.Decimals,this.Header)),t.Tables[0]}},{key:"SetQuery",value:function(e){var t,i,a=!1,r="",s="",o="",n="",l="",h="";null!=this.Chart&&11!=this.TypeID&&12!=this.TypeID&&13!=this.TypeID&&18!=this.TypeID&&(a=!0),i=this.IncludeOpening&&null==this.Chart?" and D.DocDate<=@To":" and D.DocDate between @Fr and @To";var u=this.GetDateVariable(e);l="D.DocDate<@Fr";var c=" AND (D.StatusID=369 or D.StatusID=429)",D="(D.StatusID=370 OR D.StatusID=439 OR D.StatusID=452)";this.IncludePDC?(n=this.IncludeOpening&&!a?" AND ("+D+" OR (D.DocumentType<>14 AND D.DocumentType<>19"+c+"))":" AND D.DocumentType<>16 AND ("+D+" OR (D.DocumentType<>14 AND D.DocumentType<>19"+c+"))",l+=" AND ("+D+" OR (D.DocumentType<>14 AND D.DocumentType<>19"+c+"))"):(n=this.IncludeOpening&&!a?" AND D.DocumentType NOT IN (14,19)"+c:" AND D.DocumentType NOT IN (16,14,19)"+c,l+=" AND D.DocumentType<>14 AND D.DocumentType<>19"+c);var d=this.GetDimensionWhere("DCC.dcCCNID");(d.length>0||this.Groups.startsWith("DIM_"))&&(s=" join COM_DocCCDATA DCC with(nolock) on DCC.AccDocDetailsID=D.AccDocDetailsID",o=" join COM_DocCCDATA DCC with(nolock) on DCC.InvDocDetailsID=D.InvDocDetailsID"),this.ForeignCurrencyID>0?(t="AmountFC",r=" AND D.CurrencyID="+this.ForeignCurrencyID):(t=1==this.CurrencyType?"AmountBC":"Amount",r="");var p="",C="",T="",y="",m="";if(5==this.TypeID||6==this.TypeID||11==this.TypeID||12==this.TypeID||18==this.TypeID?(C="A.AccountID,",T+="A.AccountID,"):13==this.TypeID&&(C="INV.ProductID,",T+="INV.ProductID,"),"YrWise"==this.Groups?(C+="year(convert(datetime,D.DocDate)) Yr,",T+="year(convert(datetime,D.DocDate)),",y+="Yr,"):"MnWise"==this.Groups||"QtrWise"==this.Groups?(C+="year(convert(datetime,D.DocDate)) Yr,month(convert(datetime,D.DocDate)) Mn,",T+="year(convert(datetime,D.DocDate)),month(convert(datetime,D.DocDate)),",y+="Yr,Mn,"):this.Groups.startsWith("DIM_")&&(C+="DIM.Name,",T+="DIM.Name,",y+="Name,",s+=" join "+F.b.GetTagTableName(parseInt(this.Groups.substr(4)))+" DIM with(nolock) on DIM.NodeID=DCC.dcCCNID"+(parseInt(this.Groups.substr(4))-5e4),o+=" join "+F.b.GetTagTableName(parseInt(this.Groups.substr(4)))+" DIM with(nolock) on DIM.NodeID=DCC.dcCCNID"+(parseInt(this.Groups.substr(4))-5e4)),T.length>0&&(T=" GROUP BY "+T.Trim(",")),11==this.TypeID||12==this.TypeID||13==this.TypeID)this.strAccounts.length>0?(this.IsGroupsExists?(m=" join ACC_Accounts GT on A2.lft BETWEEN GT.lft AND GT.rgt",p=this.strAccounts.Contains(",")?"GT.AccountID IN ("+this.strAccounts+")":"GT.AccountID="+this.strAccounts):p=this.strAccounts.Contains(",")?"A2.AccountID IN ("+this.strAccounts+")":"A2.AccountID="+this.strAccounts,11==this.TypeID||13==this.TypeID?p+=" and A.AccountTypeID=7":12==this.TypeID&&(p+=" and A.AccountTypeID=6")):11==this.TypeID||13==this.TypeID?p="A.AccountTypeID=7 and (A2.AccountTypeID=4 or A2.AccountTypeID=11)":12==this.TypeID&&(p="A.AccountTypeID=6 and (A2.AccountTypeID=5 or A2.AccountTypeID=14)"),s+=" join ACC_Accounts A2 with(nolock) on D.XXA2XX=A2.AccountID",o+=" join ACC_Accounts A2 with(nolock) on D.XXA2XX=A2.AccountID",13==this.TypeID&&(s+=" join INV_DocDetails INV with(nolock) on D.InvDocDetailsID=INV.InvDocDetailsID",o+=" join INV_DocDetails INV with(nolock) on D.InvDocDetailsID=INV.InvDocDetailsID");else if(this.strAccounts.length>0)this.IsGroupsExists?(m=" join ACC_Accounts GT on A.lft BETWEEN GT.lft AND GT.rgt",p=this.strAccounts.Contains(",")?"GT.AccountID IN ("+this.strAccounts+")":"GT.AccountID="+this.strAccounts):p=this.strAccounts.Contains(",")?"A.AccountID IN ("+this.strAccounts+")":"A.AccountID="+this.strAccounts;else if(101==this.TypeID)p="A.AccountTypeID=4";else if(2==this.TypeID)p="A.AccountTypeID=5";else if(3==this.TypeID||18==this.TypeID)p="(A.AccountTypeID=9 or A.AccountTypeID=12)";else if(4==this.TypeID)p="(A.AccountTypeID=8 or A.AccountTypeID=11)";else if(5==this.TypeID||6==this.TypeID)p="(A.AccountTypeID=6 or A.AccountTypeID=7)";else if(7==this.TypeID)p="(A.AccountTypeID=1 or A.AccountTypeID=10)";else if(8==this.TypeID)p="(A.AccountTypeID=2 or A.AccountTypeID=3)";else if(9==this.TypeID||10==this.TypeID)return null;return h+=u+"\r\n",5==this.TypeID||6==this.TypeID?(h+=y.length>0?"select "+y+"AccountID,isnull(sum(Balance),0) Balance from(":"select "+y+"isnull(sum(Balance),0) Balance from(",h+=5==this.TypeID?"select "+y+"AccountID,sum(Dr)-sum(Cr) Balance from(":"select "+y+"AccountID,sum(Cr)-sum(Dr) Balance from("):h+=11==this.TypeID||18==this.TypeID?"select top 5 A.AccountName,isnull(sum(Dr)-sum(Cr),0) Balance from(":12==this.TypeID?"select top 5 A.AccountName,isnull(sum(Cr)-sum(Dr),0) Balance from(":13==this.TypeID?"select top 5 P.ProductName,isnull(sum(Dr)-sum(Cr),0) Balance from(":"select "+y+"sum(Dr)-sum(Cr) Balance from(",h+="\nselect "+C+"sum("+t+") Dr,0 Cr from Acc_DocDetails D with(nolock)"+s.Replace("XXA2XX","CreditAccount")+"\njoin ACC_Accounts A with(nolock) on D.DebitAccount=A.AccountID"+m+"\nwhere "+p+i+d+n+r,h+=T,h+="\nunion all\nselect "+C+"0 Dr,sum("+t+") Cr from Acc_DocDetails D with(nolock)"+s.Replace("XXA2XX","DebitAccount")+"\njoin ACC_Accounts A with(nolock) on D.CreditAccount=A.AccountID"+m+"\nwhere "+p+i+d+n+r,h+=T,d.length>0&&(h+="\nunion all\nselect "+C+"sum("+t+") Dr,0 Cr from Acc_DocDetails D with(nolock)"+o.Replace("XXA2XX","CreditAccount")+"\njoin ACC_Accounts A with(nolock) on D.DebitAccount=A.AccountID"+m+"\nwhere "+p+i+d+r+" AND D.StatusID=369",h+=T,h+="\nunion all\nselect "+C+"0 Dr,sum("+t+") Cr from Acc_DocDetails D with(nolock)"+o.Replace("XXA2XX","DebitAccount")+"\njoin ACC_Accounts A with(nolock) on D.CreditAccount=A.AccountID"+m+"\nwhere "+p+i+d+r+" AND D.StatusID=369",h+=T),5!=this.TypeID&&6!=this.TypeID||(h+=")AS T group by AccountID",y.length>0?(h+=","+y.Trim(","),y+="AccountID,"):h+=5==this.TypeID?" having sum(Dr)-sum(Cr)>0":" having sum(Dr)-sum(Cr)<0"),h+=")AS T",11==this.TypeID||12==this.TypeID||18==this.TypeID?(h+=" join ACC_Accounts A with(nolock) on T.AccountID=A.AccountID",h+=" GROUP BY A.AccountName",h+=" ORDER BY Balance DESC"):13==this.TypeID?(h+=" join INV_Product P with(nolock) on T.ProductID=P.ProductID",h+=" GROUP BY P.ProductName",h+=" ORDER BY Balance DESC"):y.length>0&&(h+=" GROUP BY "+y.Trim(","),h+=" ORDER BY "+y.Trim(",")),this.IncludeOpening&&a&&(5==this.TypeID||6==this.TypeID?(C="A.AccountID,",T=" GROUP BY A.AccountID",y="AccountID,"):C=T=y="",h+="\n--OPENING\nselect "+y+"sum(Dr)-sum(Cr) OpBalance from(",h+="\nselect "+C+"sum("+t+") Dr,0 Cr from Acc_DocDetails D with(nolock)"+s.Replace("XXA2XX","CreditAccount")+"\njoin ACC_Accounts A with(nolock) on D.DebitAccount=A.AccountID"+m+"\nwhere "+p+d+r+" and ((D.DocumentType=16"+c+") OR ("+l+"))"+T,h+="\nunion all\nselect "+C+"0 Dr,sum("+t+") Cr from Acc_DocDetails D with(nolock)"+s.Replace("XXA2XX","DebitAccount")+"\njoin ACC_Accounts A with(nolock) on D.CreditAccount=A.AccountID"+m+"\nwhere "+p+d+r+" and ((D.DocumentType=16"+c+") OR ("+l+"))"+T,d.length>0&&(h+="\nunion all\nselect "+C+"sum("+t+") Dr,0 Cr from Acc_DocDetails D with(nolock)"+o.Replace("XXA2XX","CreditAccount")+"\njoin ACC_Accounts A with(nolock) on D.DebitAccount=A.AccountID"+m+"\nwhere "+p+d+r+" and D.DocDate<@Fr AND D.StatusID=369"+T,h+="\nunion all\nselect "+C+"0 Dr,sum("+t+") Cr from Acc_DocDetails D with(nolock)"+o.Replace("XXA2XX","DebitAccount")+"\njoin ACC_Accounts A with(nolock) on D.CreditAccount=A.AccountID"+m+"\nwhere "+p+d+r+" and D.DocDate<@Fr AND D.StatusID=369"+T),h+=")AS T",y.length>0&&(h+=" group by "+y.TrimEnd(","),h+=" order by "+y.TrimEnd(","))),h.toString()}},{key:"SetQueryAgeing",value:function(e){var t,i="",a="",r="",s="",o=new Date;i="declare @Fr float,@To float",null!=this.Chart?(i+=" set @Fr=convert(float,convert(datetime,'"+this.Chart.FromDate.Date.ToString("dd MMM yyyy")+"'))",i+=" set @To=convert(float,convert(datetime,'"+this.Chart.ToDate.Date.ToString("dd MMM yyyy")+"'))"):i+=" set @Fr=0 set @To=convert(float,convert(datetime,'"+o.ToString("dd MMM yyyy")+"'))";var n=" AND (B.StatusID=369 or B.StatusID=429)";r=this.IncludePDC?" AND ((B.StatusID=370 OR B.StatusID=439 OR B.StatusID=452) OR (B.DocType<>14 AND B.DocType<>19"+n+"))":" AND B.DocType NOT IN (14,19)"+n;var l=this.GetDimensionWhere("B.dcCCNID");this.ForeignCurrencyID>0?(t="AmountFC",a=" AND B.AdjCurrID="+this.ForeignCurrencyID):(t=1==this.CurrencyType?"AmountBC":"AdjAmount",a="");var h="",u="";if(this.strAccounts.length>0?this.IsGroupsExists?(u=" JOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID join ACC_Accounts GT on A.lft BETWEEN GT.lft AND GT.rgt",h=this.strAccounts.Contains(",")?" and GT.AccountID IN ("+this.strAccounts+")":" and GT.AccountID="+this.strAccounts):h=this.strAccounts.Contains(",")?" and B.AccountID IN ("+this.strAccounts+")":" and B.AccountID="+this.strAccounts:(u=" JOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID",h=" and (A.AccountTypeID=6 or A.AccountTypeID=7)"),s+=i+"\r\n",s+="declare @TblAccs as Table(AccID bigint) ",104!=this.TypeID&&105!=this.TypeID&&106!=this.TypeID&&107!=this.TypeID){s+=" declare @Tbl As Table(ID INT,Slab nvarchar(15),FromDate FLOAT,ToDate FLOAT)";for(var c=0;c<=this.Slabs.length;c++)s+=c==this.Slabs.length?" INSERT INTO @Tbl VALUES("+c+",'>"+this.Slabs[this.Slabs.length-1]+"',1,@To-"+this.Slabs[this.Slabs.length-1]+")":0==c?" INSERT INTO @Tbl VALUES("+c+",'0-"+(this.Slabs[c]-1)+"',@To-"+(this.Slabs[c]-1)+",@To)":" INSERT INTO @Tbl VALUES("+c+",'"+this.Slabs[c-1]+"-"+(this.Slabs[c]-1)+"',@To-"+(this.Slabs[c]-1)+",@To-"+this.Slabs[c-1]+")"}var D;return D=15==this.TypeID||105==this.TypeID||106==this.TypeID?"<0":14==this.TypeID||104==this.TypeID||107==this.TypeID?">0":"!=0",104==this.TypeID||105==this.TypeID||106==this.TypeID||107==this.TypeID?(s+="\nselect DueStatus ID,"+(105==this.TypeID||106==this.TypeID?"-":"")+"isnull(sum(Balance),0) Balance from\n(\nSELECT case when isnull(DocDueDate,DocDate)<@To then 2 else 1 end DueStatus\n,"+t+"+ISNULL((SELECT SUM(CB."+t+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@To"+r.Replace("B.","CB.")+"),0) Balance\nFROM COM_Billwise B with(nolock)\nJOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID\nWHERE B.IsNewReference=1 AND B.DocDate<=@To",104==this.TypeID||106==this.TypeID?s+=" and A.AccountTypeID=7":105!=this.TypeID&&107!=this.TypeID||(s+=" and A.AccountTypeID=6"),s+=r,s+=l,s+=a,s+="\n) AS T\nwhere Balance"+D+"\ngroup by DueStatus"):(s+="\n            insert into @TblAccs\n            select AccountID from (\n            SELECT B.AccountID\n            ,"+t+"+ISNULL((SELECT SUM(CB."+t+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@To"+r.Replace("B.","CB.")+"),0) Balance\n            FROM COM_Billwise B with(nolock)"+u+"\n            WHERE B.IsNewReference=1 AND B.DocDate<=@To",s+=r+h,s+=l,s+=a,s+="\n            ) as T\n            group by AccountID\n            having sum(Balance)"+D+" and abs(sum(Balance))>0.01",s+="\n    select S.Slab,"+(15==this.TypeID?"-":"")+"isnull(sum(Balance),0) Balance from\n    (\n    SELECT T.ID\n    ,"+t+"+ISNULL((SELECT SUM(CB."+t+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@To"+r.Replace("B.","CB.")+"),0) Balance\n    FROM COM_Billwise B with(nolock)\n    join @TblAccs TA on TA.AccID=B.AccountID\n    join @Tbl T on B.DocDate BETWEEN T.FromDate AND T.ToDate\n    WHERE B.IsNewReference=1 AND B.DocDate<=@To",s+=r,s+=l,s+=a,s+="\n    ) AS T\n    right join @Tbl S on S.ID=T.ID\n    where Balance"+D+"\n    group by S.ID,S.Slab\n    order by S.ID"),s.toString()}},{key:"SetQueryDocumentStatus",value:function(e){var t,i,a="",r="";i="AsOnDate"==e.LabelType?" and D.DocDate<=@To":" and D.DocDate between @Fr and @To";var o=this.GetDateVariable(e),n=this.GetDimensionWhere("DCC.dcCCNID");n.length>0&&(a=this.IsAccDoc?" join COM_DocCCDATA DCC with(nolock) on DCC.AccDocDetailsID=D.AccDocDetailsID":" join COM_DocCCDATA DCC with(nolock) on DCC.InvDocDetailsID=D.InvDocDetailsID"),2!=s.a.SessionManager.RoleType&&3!=s.a.SessionManager.RoleType||(n+=" and (D.DebitAccount="+s.a.SessionManager.ESSID+" or D.CreditAccount="+s.a.SessionManager.ESSID+")"),t=this.IsAccDoc?"ACC_DocDetails":"INV_DocDetails";var l="",h="",u="";if("YrWise"==this.Groups?(h+="year(convert(datetime,D.DocDate)) Yr,",u+="year(convert(datetime,D.DocDate)),","Yr,"):"MnWise"!=this.Groups&&"QtrWise"!=this.Groups||(h+="year(convert(datetime,D.DocDate)) Yr,month(convert(datetime,D.DocDate)) Mn,",u+="year(convert(datetime,D.DocDate)),month(convert(datetime,D.DocDate)),","Yr,Mn,"),u.length>0&&(u=" GROUP BY "+u.Trim(",")),l=this.strAccounts.length>0?this.strAccounts.Contains(",")?"D.CostCenterID in ("+this.strAccounts+")":"D.CostCenterID="+this.strAccounts:"1=1",16==this.TypeID&&"0"!=e.StatusID&&"21"!=e.StatusID&&"22"!=e.StatusID&&"23"!=e.StatusID&&"31"!=e.StatusID&&"32"!=e.StatusID&&"33"!=e.StatusID&&(l+=" and D.StatusID="+e.StatusID),r+=o+"\r\n",this.IsGeneralDocs?("376"==this.Header.StatusID||this.SubFields.find((function(e){return"376"==e.StatusID}))||(n+=" and D.StatusID!=376"),r+="select T.StatusID,count(*) Balance\nfrom\n(\nselect DocID,VoucherNo,case when count(*)>1 then -1 else max(StatusID) end StatusID\nfrom\n(\nselect "+h+"DocID,VoucherNo,StatusID\nfrom "+t+" D with(nolock)"+a+"\nwhere "+l+i+n+"\ngroup by DocID,VoucherNo,StatusID\n) AS T\ngroup by DocID,VoucherNo\n) AS T\ngroup by T.StatusID"):r+=" select 0 NOQUERY where 1!=1",!this.IsAccDoc&&this.IsExecutedDocs&&this.strAccounts.length>0){var c=this.strAccounts.split(",");r+="\nselect StatusID,count(*) Balance from(\nselect DocID,case when sum(Quantity)<=sum(ExeQty) then 22 when sum(ExeQty)>0 and sum(Quantity)>sum(ExeQty) then 23 else 21 end StatusID\nfrom(\r\n";for(var D=0;D<c.length;D++){if(!this.dicExecutedQuery.ContainsKey(c[D])){var d=s.a.report.GetExecutedQtyQuery(0,c[D],null,null,!0,!1);d=0==d.length?"0":d.Replace("INV.","D.").Replace("inv.","D."),this.dicExecutedQuery.push(c[D],d)}D>0&&(r+="\r\nunion all\r\n"),this.dicExecutedQuery[c[D]].Contains("NUM")&&!a.Contains("COM_DocNumData")&&(a+=this.IsAccDoc?" join COM_DocNumData NUM with(nolock) on NUM.AccDocDetailsID=D.AccDocDetailsID":" join COM_DocNumData NUM with(nolock) on NUM.InvDocdetailsID=D.InvDocdetailsID"),r+="SELECT D.DocID,D.Quantity,"+this.dicExecutedQuery[c[D]]+" ExeQty\nFROM INV_DocDetails D with(nolock)"+a+"\nWHERE D.CostCenterID="+c[D]+" and D.StatusID!=376"+i+n}r+=") AS T\ngroup by DocID\n) as T\ngroup by StatusID"}else r+=" select 0 NOQUERY where 1!=1";return this.IsBWDocs&&(r+="\n            select StatusID, count(*) Balance from(\n                select case when PaidAmt = 0 then 31 when BillAmt > PaidAmt then 32  else 33 end StatusID from(\n                    select VoucherNo\n                    , (SELECT ISNULL(SUM(abs(AdjAmount)), 0) FROM COM_Billwise CB WITH(NOLOCK) WHERE CB.DocNo = D.VoucherNo) BillAmt\n                , (SELECT ISNULL(SUM(abs(AdjAmount)), 0) FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference = 0 AND(CB.RefDocNo = D.VoucherNo OR CB.DocNo = D.VoucherNo)) PaidAmt\n            from "+t+" D with (nolock) "+a+"\n            where "+l+i+n+" and StatusID = 369\n            group by VoucherNo) AS T\n) AS T\n            group by StatusID"),r.toString()}},{key:"SetQueryDocumentStatusDetails",value:function(e,t){var i,a,r="",o="";a="AsOnDate"==e.LabelType?" and D.DocDate<=@To":" and D.DocDate between @Fr and @To";var n=this.GetDateVariable(e),l=this.GetDimensionWhere("DCC.dcCCNID");l.length>0&&(r=this.IsAccDoc?" join COM_DocCCDATA DCC with(nolock) on DCC.AccDocDetailsID=D.AccDocDetailsID":" join COM_DocCCDATA DCC with(nolock) on DCC.InvDocDetailsID=D.InvDocDetailsID"),i=this.IsAccDoc?"ACC_DocDetails":"INV_DocDetails";var h="",u="";if("YrWise"==this.Groups?("year(convert(datetime,D.DocDate)) Yr,",u+="year(convert(datetime,D.DocDate)),","Yr,"):"MnWise"!=this.Groups&&"QtrWise"!=this.Groups||("year(convert(datetime,D.DocDate)) Yr,month(convert(datetime,D.DocDate)) Mn,",u+="year(convert(datetime,D.DocDate)),month(convert(datetime,D.DocDate)),","Yr,Mn,"),u.length>0&&(u=" GROUP BY "+u.Trim(",")),h=this.strAccounts.length>0?this.strAccounts.Contains(",")?"D.CostCenterID in ("+this.strAccounts+")":"D.CostCenterID="+this.strAccounts:"1=1","0"!=t&&"21"!=t&&"22"!=t&&"23"!=t&&"31"!=t&&"32"!=t&&"33"!=t&&(h+=" and D.StatusID="+t),o+=n+"\r\n","21"!=t&&"22"!=t&&"23"!=t)"376"==this.Header.StatusID||this.SubFields.find((function(e){return"376"==e.StatusID}))||(l+=" and D.StatusID!=376"),o+="\nselect convert(datetime,D.DocDate) DocDate,D.VoucherNo"+(this.IsAccDoc?"":",sum(D.Quantity) Quantity")+"\nfrom "+i+" D with(nolock)"+r+"\nwhere "+h+a+l+"\ngroup by DocDate,VoucherNo\n";else if(!this.IsAccDoc&&this.IsExecutedDocs&&this.strAccounts.length>0){var c=this.strAccounts.split(",");o+="\nselect Convert(DateTime,DocDate) DocDate,VoucherNo,sum(Quantity) Quantity,sum(ExeQty) ExeQty,case when sum(Quantity)<=sum(ExeQty) then 22 when sum(ExeQty)>0 and sum(Quantity)>sum(ExeQty) then 23 else 21 end StatusID\nfrom(\r\n";for(var D=0;D<c.length;D++){if(!this.dicExecutedQuery.ContainsKey(c[D])){var d=s.a.report.GetExecutedQtyQuery(0,c[D],null,null,!0,!1);d=0==d.length?"0":d.Replace("INV.","D.").Replace("inv.","D."),this.dicExecutedQuery.push(c[D],d)}D>0&&(o+="\r\nunion all\r\n"),this.dicExecutedQuery[c[D]].Contains("NUM")&&!r.Contains("COM_DocNumData")&&(r+=this.IsAccDoc?" join COM_DocNumData NUM with(nolock) on NUM.AccDocDetailsID=D.AccDocDetailsID":" join COM_DocNumData NUM with(nolock) on NUM.InvDocdetailsID=D.InvDocdetailsID"),o+="SELECT D.DocDate,D.VoucherNo,D.Quantity,"+this.dicExecutedQuery[c[D]]+" ExeQty\nFROM INV_DocDetails D with(nolock)"+r+"\nWHERE D.CostCenterID="+c[D]+" and D.StatusID!=376"+a+l}o+="\n) AS T\ngroup by DocDate,VoucherNo","21"==t?o+=" having sum(ExeQty)=0":"22"==t?o+=" having sum(Quantity)<=sum(ExeQty)":"23"==t&&(o+=" having sum(ExeQty)>0 and sum(Quantity)>sum(ExeQty)")}return o.toString()}},{key:"SetQueryDocumentLastInfo",value:function(e){var t,i="",a=this.GetDimensionWhere("DCC.dcCCNID");a.length>0&&(i=this.IsAccDoc?" join COM_DocCCDATA DCC with(nolock) on DCC.AccDocDetailsID=D.AccDocDetailsID":" join COM_DocCCDATA DCC with(nolock) on DCC.InvDocDetailsID=D.InvDocDetailsID"),2!=s.a.SessionManager.RoleType&&3!=s.a.SessionManager.RoleType||(a+=" and (D.DebitAccount="+s.a.SessionManager.ESSID+" or D.CreditAccount="+s.a.SessionManager.ESSID+")");return("\n        declare @Vno nvarchar(max)\n        select top 1 @Vno=VoucherNo\n        from "+(t=this.IsAccDoc?"ACC_DocDetails":"INV_DocDetails")+" D with (nolock) "+i+"\n        where "+(this.strAccounts.length>0?this.strAccounts.Contains(",")?"D.CostCenterID in ("+this.strAccounts+")":"D.CostCenterID="+this.strAccounts:"1=1")+a+"\n        order by D.Docdate desc, D.CreatedDate desc\n\n        select max(VoucherNo) VoucherNo, Convert(datetime, max(DocDate)) DocDate"+(this.IsAccDoc?",sum(D.Amount)/2 Amount":",sum(D.StockValue) Amount")+"\n        from "+t+" D with (nolock) "+i+"\n        where VoucherNo =@Vno").toString()}},{key:"SetQueryBatchExpiryAgeing",value:function(e){var t=new Date;null!=this.Chart&&(t=this.Chart.ToDate.Date);var i=this.GetDimensionWhere("DCC.dcCCNID"),a=[];return a.push(t),a.push(19==this.TypeID?1:0),a.push(i),a.push(s.a.SessionManager.LanguageID),s.a.report.BatchAgeing(a)}},{key:"SetQueryHRM",value:function(e){var t=this.GetDateVariable(e),i="";i=this.GetDimensionWhere(22==this.TypeID||23==this.TypeID||24==this.TypeID?"DCC.CCNID":"DCC.dcCCNID"),this.dicLookupFilters.ContainsKey(108)&&(this.dicLookupFilters[108].Nodes.Contains(",")?i+=" and E.Nationality in ("+this.dicLookupFilters[108].Nodes+")":i+=" and E.Nationality="+this.dicLookupFilters[108].Nodes),this.dicLookupFilters.ContainsKey(123)&&(this.dicLookupFilters[123].Nodes.Contains(",")?i+=" and E.Gender in ("+this.dicLookupFilters[123].Nodes+")":i+=" and E.Gender="+this.dicLookupFilters[123].Nodes);var a=[];return a.push(this.TypeID),a.push(this.Groups),a.push(t),a.push(i),a.push(s.a.SessionManager.LanguageID),s.a.report.GetWidgetHRM(a)}},{key:"GetDateVariable",value:function(e){var t="";t="declare @Fr float,@To float,@EMPID bigint",this.HeaderValuePostfix="";var i=new Date,a=new Date((new Date).getFullYear(),s.a.SessionManager.AccountingFromMonth-1,1);if(a>new Date&&(a=a.AddYears(-1)),null!=this.Chart)this.PrevData>0?(t+=" set @Fr=convert(float,convert(datetime,'"+this.Chart.FromDate.Date.AddYears(-this.PrevData).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+this.Chart.ToDate.Date.ToString("dd MMM yyyy")+"'))"):(t+=" set @Fr=convert(float,convert(datetime,'"+this.Chart.FromDate.Date.ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+this.Chart.ToDate.Date.ToString("dd MMM yyyy")+"'))");else if("Today"==e.LabelType)this.HeaderValuePostfix="Today",t+=" set @Fr=convert(float,convert(datetime,'"+i.ToString("dd MMM yyyy")+"')) set @To=@Fr";else if("Yesterday"==e.LabelType)this.HeaderValuePostfix="YSTD",t+=" set @Fr=convert(float,convert(datetime,'"+i.AddDays(-1).ToString("dd MMM yyyy")+"')) set @To=@Fr";else if("AsOnDate"==e.LabelType)this.HeaderValuePostfix="AOD",t+=" set @Fr=0 set @To=convert(float,convert(datetime,'"+i.ToString("dd MMM yyyy")+"'))";else if("MnToDate"==e.LabelType)this.HeaderValuePostfix="MTD",t+=" set @Fr=convert(float,convert(datetime,'"+new Date(i.getFullYear(),i.getMonth(),1).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+i.ToString("dd MMM yyyy")+"'))";else if("QtrToDate"==e.LabelType){this.HeaderValuePostfix="QTD";var r=(i.iMonth()-1)/3+1;t+=" set @Fr=convert(float,convert(datetime,'"+(i=new Date(i.getFullYear(),3*(r-1),1)).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+(new Date).ToString("dd MMM yyyy")+"'))"}else if("YrToDate"==e.LabelType)this.HeaderValuePostfix="YTD",t+=" set @Fr=convert(float,convert(datetime,'"+a.ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+i.ToString("dd MMM yyyy")+"'))";else if("CurMon"==e.LabelType)this.HeaderValuePostfix="CM",t+=" set @Fr=convert(float,convert(datetime,'"+(i=new Date(i.getFullYear(),i.getMonth(),1)).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+i.AddMonths(1).AddDays(-1).ToString("dd MMM yyyy")+"'))";else if("CurMonToDate"==e.LabelType)this.HeaderValuePostfix="CMTD",t+=" set @Fr=convert(float,convert(datetime,'"+(i=new Date(i.getFullYear(),i.getMonth(),1)).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+Date.Today().ToString("dd MMM yyyy")+"'))";else if("PrevMn"==e.LabelType)this.HeaderValuePostfix="PM",t+=" set @Fr=convert(float,convert(datetime,'"+(i=new Date(i.getFullYear(),i.getMonth(),1)).AddMonths(-1).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+i.AddDays(-1).ToString("dd MMM yyyy")+"'))";else if("PrevMnToDate"==e.LabelType)this.HeaderValuePostfix="PMTD",t+=" set @To=convert(float,convert(datetime,'"+i.AddMonths(-1).ToString("dd MMM yyyy")+"'))",t+=" set @Fr=convert(float,convert(datetime,'"+(i=new Date(i.getFullYear(),i.getMonth(),1)).AddMonths(-1).ToString("dd MMM yyyy")+"'))";else if("PrevQtr"==e.LabelType){this.HeaderValuePostfix="PQ";var o=(i.iMonth()-1)/3+1;t+=" set @Fr=convert(float,convert(datetime,'"+(i=new Date(i.getFullYear(),3*(o-1),1)).AddMonths(-3).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+i.AddDays(-1).ToString("dd MMM yyyy")+"'))"}else if("PrevQtrToDate"==e.LabelType){this.HeaderValuePostfix="PQTD";var n=(i.iMonth()-1)/3+1;t+=" set @Fr=convert(float,convert(datetime,'"+(i=new Date(i.getFullYear(),3*(n-1),1)).AddMonths(-3).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+(new Date).AddMonths(-3).ToString("dd MMM yyyy")+"'))"}else if("LastYr"==e.LabelType)this.HeaderValuePostfix="LY",t+=" set @Fr=convert(float,convert(datetime,'"+a.AddYears(-1).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+a.AddDays(-1).ToString("dd MMM yyyy")+"'))";else if("LastYrToDate"==e.LabelType)this.HeaderValuePostfix="LYTD",i=new Date(i.getFullYear()-1,0,1),t+=" set @Fr=convert(float,convert(datetime,'"+a.AddYears(-1).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+(new Date).AddYears(-1).ToString("dd MMM yyyy")+"'))";else if("LastYrMn"==e.LabelType)this.HeaderValuePostfix="LYM",t+=" set @Fr=convert(float,convert(datetime,'"+(i=new Date(i.getFullYear()-1,i.getMonth(),1)).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+i.AddMonths(1).AddDays(-1).ToString("dd MMM yyyy")+"'))";else if("LastYrMnToDate"==e.LabelType)this.HeaderValuePostfix="LYMTD",t+=" set @Fr=convert(float,convert(datetime,'"+(i=new Date(i.getFullYear()-1,i.getMonth(),1)).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+(new Date).AddYears(-1).ToString("dd MMM yyyy")+"'))";else if("LastYrQtr"==e.LabelType){this.HeaderValuePostfix="LYQ";var l=(i.iMonth()-1)/3+1;t+=" set @Fr=convert(float,convert(datetime,'"+(i=new Date(i.getFullYear()-1,3*(l-1),1)).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+i.AddMonths(3).AddDays(-1).ToString("dd MMM yyyy")+"'))"}else if("LastYrQtrToDate"==e.LabelType){this.HeaderValuePostfix="LYQTD";var h=(i.iMonth()-1)/3+1;t+=" set @Fr=convert(float,convert(datetime,'"+(i=new Date(i.getFullYear()-1,3*(h-1),1)).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+(new Date).AddYears(-1).ToString("dd MMM yyyy")+"'))"}else if("WeekToDate"==e.LabelType){this.HeaderValuePostfix="WTD";var u=i.getDate()-i.getDay();i.setDate(u+1),t+=" set @Fr=convert(float,convert(datetime,'"+i.ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+Date.Today().ToString("dd MMM yyyy")+"'))"}else if("PrevWeek"==e.LabelType){this.HeaderValuePostfix="LWTD";var c=i.getDate()-i.getDay();i.setDate(c+1),t+=" set @Fr=convert(float,convert(datetime,'"+i.AddDays(-7).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+i.AddDays(-1).ToString("dd MMM yyyy")+"'))"}return t+=" set @EMPID="+s.a.SessionManager.iEmployee}},{key:"GetDimensionWhere",value:function(e){var t=this,i="";return"True"==s.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==s.a.SessionManager.Preferences["LW Reports"]&&(s.a.SessionManager.LocationID>0?i=" and "+e+"2="+s.a.SessionManager.LocationID:"1"!=s.a.SessionManager.RoleID&&s.a.SessionManager.LocationWhere.length>0&&(i=" and "+e+"2 in ("+s.a.SessionManager.LocationWhere+")")),this.dicUserWiseDims.keys.forEach((function(a){var r={Key:a,Value:t.dicUserWiseDims[a]};r.Value.Contains(",")?i+=" and "+e+(parseInt(r.Key)-5e4)+" in ("+r.Value+")":i+=" and "+e+(parseInt(r.Key)-5e4)+"="+r.Value})),this.dicFilters.keys.forEach((function(a){var r={Key:a,Value:t.dicFilters[a]};r.Key>5e4&&(r.Value.Nodes.Contains(",")?i+=" and "+e+(r.Key-5e4)+" in ("+r.Value.Nodes+")":i+=" and "+e+(r.Key-5e4)+"="+r.Value.Nodes)})),i}},{key:"SetDocStatusCount",value:function(e,t){var i,a=t.Tables[0];if("21"==e.StatusID||"22"==e.StatusID||"23"==e.StatusID?a=t.Tables[1]:"31"==e.StatusID||"32"==e.StatusID||"33"==e.StatusID?a=t.Tables[2]:"0"==e.StatusID&&t.Columns[0].Contains("NOQUERY")&&(a=t.Tables[1]),"0"==e.StatusID){var r=a.filter((function(e){return 376!=e.StatusID})).Compute("sum","Balance");e.dbl=null!=r?parseFloat(r):0}else i=a.filter((function(t){return t.StatusID==e.StatusID})),e.dbl=i.length>0?parseFloat(i[0].Balance):0}},{key:"Refresh",value:function(){var e=this;this.LoadingVisibility=!0;try{if(26==this.TypeID||27==this.TypeID)return void this.WidgetCalendar.Refresh();var t=this.SetValue(this.Header);this.Header.Visible&&null!=this.Header.txtLbl&&this.HeaderValuePostfix.length>0&&(this.Header.txtLbl.Text=" ["+this.HeaderValuePostfix+"]"),11!=this.TypeID&&12!=this.TypeID&&13!=this.TypeID&&14!=this.TypeID&&15!=this.TypeID&&17!=this.TypeID&&18!=this.TypeID&&19!=this.TypeID&&20!=this.TypeID&&102!=this.TypeID&&103!=this.TypeID&&104!=this.TypeID&&105!=this.TypeID&&106!=this.TypeID&&107!=this.TypeID&&(null==t&&(t=new Promise((function(e,t){e("hi")}))),t.then((function(){e.SubFields.map((function(e){return 0==e.IsDataReady})),e.SubFields.forEach((function(t){e.SetValue(t)}))}),(function(t){e.LoadingVisibility=!1})))}catch(i){this.LoadingVisibility=!1,Logger.ErrorLog("Widget Refresh: ",i)}}},{key:"OnValueClick",value:function(e){var t=null!=e?e.WzLbl.StatusID:this.Header.StatusID,i=this.SetQueryDocumentStatusDetails(this.Header,t);if(null!=i){var a=s.a.report.DataSet("RPT022",i);this.CallStatusID=t;var r=new b.AccountDrillDownViewModel(null,this);r.Title=null!=e?e.WzLbl.txtLbl.Text:this.Header.Label,r.LoadWidgetData(a),s.a.page.ShowDialog(r,A.a,{ShowCenter:!0})}}},{key:"GetNumberFormatted",value:function(e,t,i){var a="";if(o.e.IsEmptySpace(i.Formula)){var r;r=t>0?"N"+t.toString():"N0",a=e.Commas(r)}else{var s=this.fldDict;this.fldDict.value.setFieldValue(e),this.fldDict.Value.setFieldValue(e),this.fldDict.VALUE.setFieldValue(e);try{a=this.eval.EvaluateExpression(i.Formula,s).toString()}catch(l){var n;n=t>0?"N"+t.toString():"N0",a="#"+e.Commas(n)}}return a}},{key:"OnNumberClick",value:function(e){if(17==this.TypeID||16==this.TypeID){var t="",i=this.GetDateFilterXML(e);if(i.length>0&&(t="<XML>"+i+"</XML>"),0==this.strAccounts.length)return void alert("No Documents Selected For Widget");var a=o.e.Int(e.StatusID),r=this.strAccounts.split(",");21==a||22==a||23==a?(21==a?a=-1:22==a?a=-2:23==a&&(a=-3),v.a.LoadDocumentLandingPage(r[0],r[0],a,"",{DocsList:this.strAccounts,ReportFilterXML:t},!0)):v.a.LoadDocumentLandingPage(r[0],r[0],a>0?" and INV.StatusID="+a:"","",{DocsList:this.strAccounts,ReportFilterXML:t},!0)}}},{key:"GetDateFilterXML",value:function(e){var t="",i=new Date,a=new Date((new Date).getFullYear(),s.a.SessionManager.AccountingFromMonth-1,1);if(a>new Date&&(a=a.AddYears(-1)),null!=this.Chart)t=this.PrevData>0?"<Row ColID='FROMDATE' Value='"+this.Chart.FromDate.Date.AddYears(-this.PrevData).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+this.Chart.ToDate.Date.ToString("dd MMM yyyy")+"'/>":"<Row ColID='FROMDATE' Value='"+this.Chart.FromDate.Date.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+this.Chart.ToDate.Date.ToString("dd MMM yyyy")+"'/>";else if("Today"==e.LabelType)t="<Row ColID='FROMDATE' Value='"+i.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+i.ToString("dd MMM yyyy")+"'/>";else if("Yesterday"==e.LabelType)t="<Row ColID='FROMDATE' Value='"+i.AddDays(-1).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+i.AddDays(-1).ToString("dd MMM yyyy")+"'/>";else if("AsOnDate"==e.LabelType)t="<Row ColID='ASONDATE' Value='"+i.ToString("dd MMM yyyy")+"'/>";else if("MnToDate"==e.LabelType)t="<Row ColID='FROMDATE' Value='"+new Date(i.getFullYear(),i.getMonth(),1).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+i.ToString("dd MMM yyyy")+"'/>";else if("QtrToDate"==e.LabelType){var r=(i.iMonth()-1)/3+1;t="<Row ColID='FROMDATE' Value='"+(i=new Date(i.getFullYear(),3*(r-1),1)).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+(new Date).ToString("dd MMM yyyy")+"'/>"}else if("YrToDate"==e.LabelType)t="<Row ColID='FROMDATE' Value='"+a.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+i.ToString("dd MMM yyyy")+"'/>";else if("CurMon"==e.LabelType)i.iMonth(),t="<Row ColID='FROMDATE' Value='"+(i=new Date(i.getFullYear(),i.getMonth(),1)).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+i.AddMonths(1).AddDays(-1).ToString("dd MMM yyyy")+"'/>";else if("CurMonToDate"==e.LabelType)t="<Row ColID='FROMDATE' Value='"+(i=new Date(i.getFullYear(),i.getMonth(),1)).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+Date.Today().ToString("dd MMM yyyy")+"'/>";else if("PrevMn"==e.LabelType)t="<Row ColID='FROMDATE' Value='"+(i=new Date(i.getFullYear(),i.getMonth(),1)).AddMonths(-1).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+i.AddDays(-1).ToString("dd MMM yyyy")+"'/>";else if("PrevMnToDate"==e.LabelType)t="<Row ColID='TODATE' Value='"+i.AddMonths(-1).ToString("dd MMM yyyy")+"'/>",t+="<Row ColID='FROMDATE' Value='"+(i=new Date(i.getFullYear(),i.getMonth(),1)).AddMonths(-1).ToString("dd MMM yyyy")+"'/>";else if("PrevQtr"==e.LabelType){var o=(i.iMonth()-1)/3+1;t="<Row ColID='FROMDATE' Value='"+(i=new Date(i.getFullYear(),3*(o-1),1)).AddMonths(-3).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+i.AddDays(-1).ToString("dd MMM yyyy")+"'/>"}else if("PrevQtrToDate"==e.LabelType){var n=(i.iMonth()-1)/3+1;t="<Row ColID='FROMDATE' Value='"+(i=new Date(i.getFullYear(),3*(n-1),1)).AddMonths(-3).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+(new Date).AddMonths(-3).ToString("dd MMM yyyy")+"'/>"}else if("LastYr"==e.LabelType)t="<Row ColID='FROMDATE' Value='"+a.AddYears(-1).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+a.AddDays(-1).ToString("dd MMM yyyy")+"'/>";else if("LastYrToDate"==e.LabelType)i=new Date(i.getFullYear()-1,0,1),t="<Row ColID='FROMDATE' Value='"+a.AddYears(-1).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+(new Date).AddYears(-1).ToString("dd MMM yyyy")+"'/>";else if("LastYrMn"==e.LabelType)t="<Row ColID='FROMDATE' Value='"+(i=new Date(i.getFullYear()-1,i.getMonth(),1)).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+i.AddMonths(1).AddDays(-1).ToString("dd MMM yyyy")+"'/>";else if("LastYrMnToDate"==e.LabelType)t="<Row ColID='FROMDATE' Value='"+(i=new Date(i.getFullYear()-1,i.getMonth(),1)).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+(new Date).AddYears(-1).ToString("dd MMM yyyy")+"'/>";else if("LastYrQtr"==e.LabelType){var l=(i.iMonth()-1)/3+1;t="<Row ColID='FROMDATE' Value='"+(i=new Date(i.getFullYear()-1,3*(l-1),1)).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+i.AddMonths(3).AddDays(-1).ToString("dd MMM yyyy")+"'/>"}else if("LastYrQtrToDate"==e.LabelType){var h=(i.iMonth()-1)/3+1;t="<Row ColID='FROMDATE' Value='"+(i=new Date(i.getFullYear()-1,3*(h-1),1)).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+(new Date).AddYears(-1).ToString("dd MMM yyyy")+"'/>"}else if("WeekToDate"==e.LabelType){this.HeaderValuePostfix="WTD";var u=i.getDate()-i.getDay();i.setDate(u+1),t="<Row ColID='FROMDATE' Value='"+i.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+Date.Today().ToString("dd MMM yyyy")+"'/>"}else if("PrevWeek"==e.LabelType){this.HeaderValuePostfix="LWTD";var c=i.getDate()-i.getDay();i.setDate(c+1),t="<Row ColID='FROMDATE' Value='"+i.AddDays(-7).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+i.AddDays(-1).ToString("dd MMM yyyy")+"'/>"}return t}},{key:"WidgetVisibility",get:function(){return this._WidgetVisibility},set:function(e){this._WidgetVisibility!=e&&(this.CalendarVisibility=!1,this._WidgetVisibility=e)}},{key:"CalendarVisibility",get:function(){return this._CalendarVisibility},set:function(e){this._CalendarVisibility!=e&&(this.WidgetVisibility=!1,this._CalendarVisibility=e)}}],[{key:"DefaultTreeCCID",value:function(e){return"16"==e||"17"==e||"103"==e?300:"21"==e||"22"==e||"23"==e||"24"==e||"25"==e||"26"==e||"27"==e?50002:2}}]),i}(n.b),w=function(){function e(){_classCallCheck(this,e),this.dbl=0,this.IsDataReady=!1,this.breakSpaces=!1,this.Visible=!0,this.FontSize=12,this.FontFamily="Calibri",this.IsLink=!1,this.ShowPercentage=!1,this.ShowArrow=!1,this.txtSep=new N,this.txtValue=new N,this.txtPercent=new N}return _createClass(e,[{key:"SetSubFields",value:function(){this.txtLbl=new N,this.txtLbl.Text=this.Label,this.txtLbl.Row=this.Row,this.txtLbl.Column="0",this.txtLbl.ForeColor=this.ForeColor,this.txtLbl.Align="Left",this.txtSep.Text=" : ",this.txtSep.Row=this.Row,this.txtSep.Column="1",this.txtSep.ForeColor=this.ForeColor,this.txtValue.Text="",this.txtValue.Row=this.Row,this.txtValue.Column="2",this.txtValue.ForeColor=this.ForeColor,this.txtValue.Align="Right",this.txtValue.WzLbl=this,this.txtPercent.Text="",this.txtPercent.Row=this.Row,this.txtPercent.Column="3",this.txtPercent.ForeColor=this.ForeColor}}]),e}(),N=function e(){_classCallCheck(this,e),this.Percentage=0,this.FontSize=12,this.IsLink=!1,this.FontFamily="Calibri",this.Visible=!0,this.WzLbl=null},L=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){var a;_classCallCheck(this,i),(a=t.call(this)).Chart=null,a.RefreshCalender=null,a.DisplayStartDate=new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate()),a.EmployeeList=new S.a(0),a.dsData=null,a.SelectedEmpID=0,a.widget=e,a.HeaderLabels=[],a.EmployeeList.Code.TypeID=4,a.EmployeeList.Name.TypeID=1,a.EmployeeList.Code.Visible=a.EmployeeList.Name.Visible=!1,a.EmployeeList.Code.Column=0,a.EmployeeList.Name.Column=1,a.EmployeeList.Code.Visible=!0,a.EmployeeList.Name.Visible=!0,a.EmployeeList.Code.CCID=a.EmployeeList.Name.CCID=50051,a.EmployeeList.SelectionCallBack.Subscribe(_assertThisInitialized(a),"OnEmployeeChanged"),a.EmployeeList.t.Interval=200;var r=s.a.report.GetDataTable("RPT042",s.a.SessionManager.UserName);if(null!=r&&r.length>0&&(a.EmployeeList.SelectedValue=parseInt(r[0].NodeID)),26==e.TypeID){a.bgPresent="rgb(34, 177, 76)",a.bgSinglePunch="rgb(70, 230, 198)",a.bgAbsent="rgb(242, 97, 85)",a.bgHoliday="rgb(231, 204, 97)",a.bgWeeklyOff="rgb(180, 146, 99)";var o=new w;o.LabelType="Present",o.Label="Present",o.Value="0",o.ForeColor="#22B14C",a.HeaderLabels.push(o),(o=new w).LabelType="SinglePunch",o.Label="Single Punch",o.Value="0",o.ForeColor="#46E6C6",a.HeaderLabels.push(o),(o=new w).LabelType="Absent",o.Label="Absent",o.Value="0",o.ForeColor="#F26155",a.HeaderLabels.push(o),(o=new w).LabelType="Holidays",o.Label="Holidays",o.Value="0",o.ForeColor="#E7CC61",a.HeaderLabels.push(o),(o=new w).LabelType="WeeklyOff",o.Label="Weekly Off",o.Value="0",o.ForeColor="#B49263",a.HeaderLabels.push(o)}else if(27==e.TypeID){var n=new w;n.LabelType="TotalHours",n.Label="Total Hours",n.Value="0",n.ForeColor="Orange",a.HeaderLabels.push(n),(n=new w).LabelType="UtilizedHours",n.Label="Utilized Hours",n.Value="0",n.ForeColor="Green",a.HeaderLabels.push(n),(n=new w).LabelType="Un-Utilized Hours",n.Label="Un-Utilized Hours",n.Value="0",n.ForeColor="Red",a.HeaderLabels.push(n)}return a.DisplayStartDate=new Date((new Date).getFullYear(),(new Date).getMonth(),1),a}return _createClass(i,[{key:"OnButtonClick",value:function(e){"PreviousMonth"==e.toString()?(this.DisplayStartDate=this.DisplayStartDate.AddMonths(-1),this.Refresh()):"NextMonth"==e.toString()&&(this.DisplayStartDate=this.DisplayStartDate.AddMonths(1),this.Refresh())}},{key:"OnEmployeeChanged",value:function(e){this.Refresh()}},{key:"Refresh",value:function(){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.SelectedEmpID=this.EmployeeList.Code.SelectedValue,e.next=3,this.SetQueryHRM();case 3:this.dsData=e.sent,null!=this.RefreshCalender&&this.RefreshCalender.Call(),this.widget.LoadingVisibility=!1;case 6:case"end":return e.stop()}}),e,this)})))}},{key:"SetQueryHRM",value:function(){var e="";e="declare @Fr float,@To float,@EMPID bigint",e+=" set @Fr=convert(float,convert(datetime,'"+this.DisplayStartDate.ToString("dd MMM yyyy")+"'))",e+=" set @To=convert(float,convert(datetime,'"+this.DisplayStartDate.AddMonths(1).AddDays(1).ToString("dd MMM yyyy")+"'))",e+=" set @EMPID="+this.EmployeeList.SelectedValue;var t=this.widget.GetDimensionWhere("TDCC.dcCCNID"),i="";if(s.a.SessionManager.Preferences.ContainsKey("HolidaysBasedOn")&&""!=s.a.SessionManager.Preferences.HolidaysBasedOn)for(var a=s.a.SessionManager.Preferences.HolidaysBasedOn.split(","),r=0;r<a.length;r++)""!=a[r]&&(parseInt(a[r]),i+=" AND EDCC.CCNID"+(parseInt(a[r])-5e4)+"=TDCC.dcCCNID"+(parseInt(a[r])-5e4));var o=[];return o.push(this.widget.TypeID),o.push(i),o.push(e),o.push(t),o.push(s.a.SessionManager.LanguageID),s.a.report.GetWidgetHRM(o)}}]),i}(n.b),x=i("mvPR"),V=i("JIg3"),k=i("GYN/"),E=i("wlFP"),B=function e(){_classCallCheck(this,e),this.Decimals=0,this.Divider=1},P=((a=function(e){_inherits(i,e);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this)).PrintExportCallBack=new d.b,e.LoadingVisibility=!0,e.TabularDataObj=new k.a,e.ShowGrid=!1,e.ShowGridOn=!1,e.ShowPoint=0,e.IsWidgetChart=!1,e.ShowWidgetFilter=!1,e.FromDate=new V.a(0),e.ToDate=new V.a(0),e.GrossTotalAppearance=new x.a,e.GrossTotalAppearance_Data=new x.a,e.RefreshAMChart=new d.b,e.IsStackChart=!1,e.objFormat=new x.b,e.HeaderAppearance=new x.a,e.NumberDataAppearance=new x.a,e.dtStack=null,e.lstDrillFilter=new Array,e.WidgetCallsComplated=0,e.CurrentLevel=0,e.DrillBackVisible=!1,e.Is3D=new E.a,e.ChartDataColumns=[],e._ChartData=a.EmptyChartData,e.ClassName="RevenUChartViewModel",e.Chart=[],e.ChartTypes=new p.e,e.ChartDimColumns=new p.e,e}return _createClass(i,[{key:"RevenUChartViewModel_1",value:function(e,t,i){var a=this;if(this.Parent=e,this.Report=t,this.drChartDefn=i,this.Chart=[],this.ChartTypes=new p.e(0),this.ChartTypes.Label="Chart Type",this.ChartTypes.LblWidth="80",this.ChartTypes.SelectionChangedCommand.Subscribe(this,"OnChartTypeChanged"),this.ChartTypes.Items.push(p.d.ComboBoxItems_2(s.a.GetResource("ChartType_Area"),"6")),this.ChartTypes.Items.push(p.d.ComboBoxItems_2(s.a.GetResource("ChartType_Bar"),"2")),this.ChartTypes.Items.push(p.d.ComboBoxItems_2(s.a.GetResource("ChartType_Bubble"),"7")),this.ChartTypes.Items.push(p.d.ComboBoxItems_2(s.a.GetResource("ChartType_Candlestick"),"8")),this.ChartTypes.Items.push(p.d.ComboBoxItems_2(s.a.GetResource("ChartType_Column"),"3")),this.ChartTypes.Items.push(p.d.ComboBoxItems_2(s.a.GetResource("ChartType_Cube"),"9")),this.ChartTypes.Items.push(p.d.ComboBoxItems_2(s.a.GetResource("ChartType_Curve"),"10")),this.ChartTypes.Items.push(p.d.ComboBoxItems_2(s.a.GetResource("ChartType_CurveArea"),"11")),this.ChartTypes.Items.push(p.d.ComboBoxItems_2(s.a.GetResource("ChartType_Doughnut"),"5")),this.ChartTypes.Items.push(p.d.ComboBoxItems_2(s.a.GetResource("ChartType_Funnel"),"12")),this.ChartTypes.Items.push(p.d.ComboBoxItems_2(s.a.GetResource("ChartType_Line"),"4")),this.ChartTypes.Items.push(p.d.ComboBoxItems_2(s.a.GetResource("ChartType_Pie"),"1")),this.ChartTypes.Items.push(p.d.ComboBoxItems_2(s.a.GetResource("ChartType_Polar"),"15")),this.ChartTypes.Items.push(p.d.ComboBoxItems_2(s.a.GetResource("ChartType_Pyramid"),"16")),this.ChartTypes.Items.push(p.d.ComboBoxItems_2(s.a.GetResource("ChartType_Radar"),"17")),this.ChartTypes.Items.push(p.d.ComboBoxItems_2(s.a.GetResource("ChartType_TreeMap"),"21")),this.ChartTypes.Items.push(p.d.ComboBoxItems_2(s.a.GetResource("ChartType_Scatter"),"18")),this.ChartTypes.Items.push(p.d.ComboBoxItems_2(s.a.GetResource("ChartType_Step"),"19")),this.ChartTypes.Items.push(p.d.ComboBoxItems_2(s.a.GetResource("ChartType_Surface"),"20")),this.ChartTypes.SelectedValue=i.GraphType.toString(),this.Is3D.Label="3D",this.Is3D.CheckedChangedCommand.Subscribe(this,"OnChartTypeChanged"),null!=e.xOptions&&null!=o.f.SelectSingleNode(e.xOptions.DocumentElement,"IsStackChart")&&(this.IsStackChart=!0),null==t){null==e.Parent.dsWidgetNames&&(e.Parent.dsWidgetNames=s.a.report.Widgets(3,0,"",0,1,!1,null,null)),this.FromDate.Label=s.a.GetResource("Reports_LblFromDate"),this.ToDate.Label=s.a.GetResource("Reports_LblToDate");var r=new Date(Date.Today().getFullYear(),s.a.SessionManager.AccountingFromMonth-1,1);r>Date.Today()&&(r=r.AddYears(-1)),this.FromDate.Date=r,this.ToDate.Date=r.AddYears(1).AddDays(-1)}this.ShowGrid=Object(T.j)(i.ShowGrid),this.NumSeriesColor=o.e.StringIsNullOrEmpty(i.NumSeriesColor)?null:i.NumSeriesColor.toString().split(","),null!=i.ShowPoint&&(this.ShowPoint=parseInt(i.ShowPoint)),this.TextFields=i.TextField.toString().split(","),this.NumericFields=i.NumericField.toString().split(","),this.NumFormula=new Array(this.NumericFields.length),this.ChartWidgetFilters=new Array(this.NumericFields.length),this.arrNumFormat=new Array(this.NumericFields.length);var n=null;null!=e.xOptions&&(n=o.f.SelectNodes(e.xOptions.DocumentElement,"Chart/Num"));for(var l=0;l<this.NumFormula.length;l++)if(this.NumFormula[l]="",null!=n&&l<n.length){this.ChartWidgetFilters[l]=o.f.SelectSingleNode(n[l],"WidgetFilter/TreeFilters");var h=o.f.SelectSingleNode(n[l],"Formula");if(null!=h&&(this.NumFormula[l]=h.innerHTML,h.innerHTML.length>0)){var u=[],c=new f.a;if(c.SetKeyWords("REPORT"),c.ParseFormula(this.NumFormula[l],u),10==u.length){var D=new B;D.FormatText=u[8].tokenValue.toString().split("~")[0],D.FormatKey=u[6].tokenValue.toString().split("~")[0],D.Decimals=parseInt(u[4].tokenValue),"K"==D.FormatKey?D.Divider=1e3:"L"==D.FormatKey?D.Divider=1e5:"M"==D.FormatKey?D.Divider=1e6:"C"==D.FormatKey?D.Divider=1e7:"B"==D.FormatKey&&(D.Divider=1e9),this.arrNumFormat[l]=D}}}if(this.ChartDimColumns=new p.e(0),this.ChartDimColumns.LblWidth="0",this.TextFieldsColumnSource=new Array(this.TextFields.length),this.NumericFieldsColumnSource=new Array(this.NumericFields.length),null!=t){this.IsWidgetChart=!1,this.ChartName=!e.ShowHeader||o.e.StringIsNullOrEmpty(e.Header)?t.DisplayName:"",this.FilterName=t.FilterText.toString();for(var d=function(e){a.TextFieldsColumnSource[e]=t.ColumnSource.find((function(t){return t.ID==a.TextFields[e]}))},C=0;C<this.TextFields.length;C++)d(C);for(var m=function(e){a.NumericFieldsColumnSource[e]=t.ColumnSource.find((function(t){return t.ID==a.NumericFields[e]})),e<a.NumFormula.length&&(a.NumericFieldsColumnSource[e].DataFormat.NumberFormat=a.NumFormula[e])},I=0;I<this.NumericFields.length;I++)m(I);for(var g=!1,S=t.ReportColumns.length,F=0;F<S;F++){var b=t.ReportColumns[F];if(b.HeaderAppearance.IsVisible&&"FLOAT"!=b.ColumnType&&"INT"!=b.ColumnType&&(this.ChartDimColumns.Items.push(p.d.ComboBoxItems_2(b.HeaderText,b.ID)),!g&&"DATE"==b.ColumnType&&o.e.IsEmpty(b.Formula))){g=!0;var A=b.Clone();A.ID=b.ID+"_Yr",A.HeaderText="Year-Wise",A.ColumnType="",A.Formula='DATENAME("yyyy",'+b.ID+")",this.ChartDimColumns.Items.push(p.d.ComboBoxItems_2(A.HeaderText,A.ID)),t.ReportColumns.push(A),t.ColumnSourceALL.push(A),(A=b.Clone()).ID=b.ID+"_Mn",A.HeaderText="Month-Wise",A.ColumnType="",A.Formula='DATENAME("MMM-yy",'+b.ID+")",this.ChartDimColumns.Items.push(p.d.ComboBoxItems_2(A.HeaderText,A.ID)),t.ReportColumns.push(A),t.ColumnSourceALL.push(A),(A=b.Clone()).ID=b.ID+"_Qtr",A.HeaderText="Quarter-Wise",A.ColumnType="",A.Formula='DATENAME("QUARTERLY",'+b.ID+")",this.ChartDimColumns.Items.push(p.d.ComboBoxItems_2(A.HeaderText,A.ID)),t.ReportColumns.push(A),t.ColumnSourceALL.push(A),F+=3}}t.Chart=this}else{this.IsWidgetChart=!0;var v=new y.b;"YrWise"==this.TextFields[0]?(v.HeaderText="Year",this.FromDate.Date=this.FromDate.Date.AddYears(-e.PrevDataFilter)):"MnWise"==this.TextFields[0]?(v.HeaderText="Month",this.FromDate.Date=this.FromDate.Date.AddMonths(-e.PrevDataFilter)):"QtrWise"==this.TextFields[0]?(v.HeaderText="Quarter",this.FromDate.Date=this.FromDate.Date.AddMonths(3*-e.PrevDataFilter)):this.TextFields[0].startsWith("DIM_")&&(v.HeaderText="Name");var R=this.NumericFields.length>0?parseInt(this.NumericFields[0]):0;if(e.PrevData>0&&this.NumericFields.length>0){this.NumericFields=new Array(e.PrevData+1);for(var w=0;w<=e.PrevData;w++)this.NumericFields[w]=1==s.a.SessionManager.AccountingFromMonth?this.FromDate.Date.AddYears(-w).getFullYear().toString():this.FromDate.Date.AddYears(-w).getFullYear().toString()+"-"+((this.FromDate.Date.AddYears(-w).getFullYear()+1)%100).toString();this.Widgets=new Array(1)}else this.Widgets=new Array(this.NumericFields.length);v.ID=this.TextFields[0],this.TextFieldsColumnSource=[],this.TextFieldsColumnSource.push(v),this.NumericFieldsColumnSource=new Array(this.NumericFields.length);for(var N=function(t){var i=new y.b;if(e.PrevData>0)i.ID=a.NumericFields[t],i.HeaderText=a.NumericFields[t];else{i.ID="NUM_"+t;var r=e.Parent.dsWidgetNames.Tables[0].filter((function(e){return e.ID==a.NumericFields[t]}));i.HeaderText=r.length>0?11==R||12==R||13==R||14==R||15==R||20==R?"Value":19==R?"Quantity":r[0].Name.toString():"WID-"+a.NumericFields[t]}if(i.ColumnType="FLOAT",i.DataFormat=new x.b,i.width=110,i.DataFormat.DecimalsPoints=2,i.DataFormat.Commas="Millions"==s.a.SessionManager.Preferences.Commas?1:2,a.NumericFieldsColumnSource[t]=i,t<a.NumFormula.length&&(a.NumericFieldsColumnSource[t].DataFormat.NumberFormat=a.NumFormula[t]),e.PrevData>0&&t>0)return a.NumericFieldsColumnSource[t].DataFormat.NumberFormat=a.NumericFieldsColumnSource[t-1].DataFormat.NumberFormat,"continue";var o=new M;o.WidgetViewModel_2(a,e.PrevData>0?R:parseInt(a.NumericFields[t]),a.ChartWidgetFilters[t]),11==o.TypeID||12==o.TypeID||18==o.TypeID?(v.width=160,a.TextFields[0]=v.ID="AccountName",v.HeaderText="Account Name"):13==o.TypeID?(v.width=160,a.TextFields[0]=v.ID="ProductName",v.HeaderText="Product Name"):14!=o.TypeID&&15!=o.TypeID&&19!=o.TypeID&&20!=o.TypeID||(a.TextFields[0]=v.ID="Slab",v.HeaderText="Slab"),o.PrevData=e.PrevData,o.Groups=v.ID,a.Widgets[t]=o},L=0;L<this.NumericFields.length;L++)N(L)}this.ChartDimColumns.Items.length>0&&(this.ChartDimColumns.SelectedValue=this.TextFields[0],this.ChartDimColumns.SelectionChangedCommand.Subscribe(this,"OnChartDimColumnsChange")),(this.ChartDimColumns.Items.length<=1||this.IsStackChart)&&(this.ChartDimColumns.Visible=!1),this.ShowGrid&&this.InitGrid()}},{key:"InitGrid",value:function(){var e=this,t=new x.a;this.HeaderAppearance.Alignment="Center",this.HeaderAppearance.FontFamilyName="Arial",this.HeaderAppearance.FontSize=12,this.HeaderAppearance.IsBold=!0,this.HeaderAppearance.BackColor="White",this.HeaderAppearance.ForeColor="Black",t.Alignment="Left",t.FontFamilyName="Arial",t.FontSize=12,t.BackColor="White",t.ForeColor="Black",this.NumberDataAppearance.Alignment="Right",this.NumberDataAppearance.FontFamilyName="Arial",this.NumberDataAppearance.FontSize=12,this.NumberDataAppearance.BackColor="White",this.NumberDataAppearance.ForeColor="Black",this.GrossTotalAppearance.IsBold=!0,this.GrossTotalAppearance.ForeColor="#FF000000",this.GrossTotalAppearance.BackColor="White",this.GrossTotalAppearance.FontFamilyName="Arial",this.GrossTotalAppearance_Data.IsBold=!0,this.GrossTotalAppearance_Data.ForeColor="#FF000000",this.GrossTotalAppearance_Data.BackColor="White",this.GrossTotalAppearance_Data.FontFamilyName="Arial",this.GrossTotalAppearance_Data.Alignment="Right",this.objFormat.DecimalsPoints=parseInt(s.a.SessionManager.Preferences.DecimalsinAmount),"Millions"==s.a.SessionManager.Preferences.Commas?this.objFormat.Commas=1:"Lakhs"==s.a.SessionManager.Preferences.Commas&&(this.objFormat.Commas=2),this.objFormat.DateType=s.a.SessionManager.Preferences["Date Format"];var i=new y.b;i.gridLines=3,i.ID=this.TextFieldsColumnSource[0].ID,i.FieldName=this.TextFieldsColumnSource[0].ID,i.HeaderText=this.TextFieldsColumnSource[0].HeaderText,i.HeaderAppearance=this.HeaderAppearance,i.DataAppearance=t,i.HeaderHeight=22,i.width=.8*this.TextFieldsColumnSource[0].width,i.DataFormat=this.objFormat,i.ColumnType="STRING",this.TabularColumns.push(i),this.IsStackChart||this.NumericFieldsColumnSource.forEach((function(t){(i=new y.b).gridLines=3,i.ID=t.ID,i.FieldName=t.ID,i.HeaderText=t.HeaderText,i.HeaderAppearance=e.HeaderAppearance,i.DataAppearance=e.NumberDataAppearance,i.HeaderHeight=22,i.width=.8*t.width,i.DataFormat=e.objFormat,i.ColumnType="FLOAT",e.TabularColumns.push(i)}))}},{key:"OnButtonClick",value:function(e){if("DrillBack"==e){if(0==this.CurrentLevel)return;this.CurrentLevel--,this.lstDrillFilter.RemoveAt(this.lstDrillFilter.length-1),0==this.CurrentLevel&&(this.DrillBackVisible=!1),this.RefreshChart()}else if("WidgetFilterOK"==e){if(this.Parent.PrevData>0&&this.FromDate.Date.getFullYear()!=this.ToDate.Date.getFullYear())return void(this.DisplayMessage="Select From Date and To Date of same year");this.ShowWidgetFilter=!1,this.RefreshChart()}else"WidgetFilterCancel"==e?(this.ShowWidgetFilter=!1,this.RefreshChart()):"ShowGridOn"==e&&(this.ShowGridOn=!this.ShowGridOn)}},{key:"LoadChartData",value:function(){var e,t,i,a=this;this.ShowGrid&&this.TabularDataObj.Clear();var r=null,s=new g.b;this.dtStack=null,0!=this.Report.lstGroup.filter((function(e){return"Summary"==e.DisplayMode})).length&&null!=this.Report.ReportSummaryData?(e=t=this.Report.ReportSummaryData,"".length>0&&(e=t=this.Report.ReportSummaryData),i=e.ToTable(!0,[this.TextFields[this.CurrentLevel]])):(e=t=this.Report.ReportData,"".length>0&&(e=t=this.Report.ReportSummaryData),i=e.ToTable(!0,[this.TextFields[this.CurrentLevel]])),null!=this.TabularColumns&&this.TabularColumns.length>0&&this.TabularColumns[0].HeaderText!=this.TextFieldsColumnSource[this.CurrentLevel].HeaderText&&(this.TabularColumns[0].HeaderText=this.TextFieldsColumnSource[this.CurrentLevel].HeaderText,this.TabularDataObj.RefreshColumns());var n=[],l=[];if(l.push(this.TextFieldsColumnSource[this.CurrentLevel].HeaderText),this.IsStackChart){this.dtStack_C0=this.TextFields[1],this.dtStack=e.ToTable(!0,[this.dtStack_C0]);for(var h=this.TabularColumns.length-1;h>0;h--)this.TabularColumns.RemoveAt(h);for(var u=0;u<this.dtStack.length;u++)if(l.push(o.e.String(this.dtStack[u][this.dtStack_C0])),null!=this.TabularColumns){var c=new y.b;c.gridLines=3,c.ID=c.FieldName=c.HeaderText=o.e.String(this.dtStack[u][this.dtStack_C0]),c.HeaderAppearance=this.HeaderAppearance,c.DataAppearance=this.NumberDataAppearance,c.HeaderHeight=22,c.width=.8*this.NumericFieldsColumnSource[0].width,c.DataFormat=this.objFormat,c.ColumnType="FLOAT",this.TabularColumns.push(c)}null!=this.TabularColumns&&this.TabularDataObj.RefreshColumns()}else for(var D=0;D<this.NumericFields.length;D++)l.push(this.NumericFieldsColumnSource[D].HeaderText);var d=0,p=this.IsStackChart?new Array(this.dtStack.length).fill(0):new Array(this.NumericFieldsColumnSource.length).fill(0);this.IsStackChart&&(this.CurrentLevel=0);for(var T=function(h){var u=i[h];e=t.filter(a.IsStackChart?function(e){return e[a.TextFields[0]]==u[a.TextFields[0]]}:function(e){return e[a.TextFields[a.CurrentLevel]]==u[a.TextFields[a.CurrentLevel]]});var c=new x.c,D=new x.c;C.ReportViewModel.SetCellValue(u[a.TextFields[a.CurrentLevel]],a.TextFieldsColumnSource[a.CurrentLevel].DataFormat,a.TextFieldsColumnSource[a.CurrentLevel].ColumnType,-1,c);var T={};if(T[a.TextFieldsColumnSource[a.CurrentLevel].HeaderText]=c.Text,a.ShowGrid&&((r=new x.d(a.TabularColumns.length)).Height=22,r.Cells[0]=c),a.IsStackChart)for(var y=e.filter((function(e){return!0})),m=function(t){e=y.filter((function(e){return e[a.TextFields[1]]==a.dtStack[t][a.dtStack_C0].toString()}));var i=0;e.forEach((function(e){!o.e.IsEmpty(e[a.NumericFields[0]])&&e[a.NumericFields[0]].toString().length>0&&(i+=parseFloat(e[a.NumericFields[0]]))})),p[t]+=i,l.Contains(a.dtStack[t][a.dtStack_C0].toString())&&(T[a.dtStack[t][a.dtStack_C0].toString()]=i),0==t&&C.ReportViewModel.SetCellValue(i,a.NumericFieldsColumnSource[0].DataFormat,a.NumericFieldsColumnSource[0].ColumnType,-1,D),a.ShowGrid&&C.ReportViewModel.SetCellValue(i,a.NumericFieldsColumnSource[0].DataFormat,a.NumericFieldsColumnSource[0].ColumnType,-1,r.Cells[t+1])},I=0;I<a.dtStack.length;I++)m(I);else for(var g=function(t){var i=0;e.forEach((function(e){!o.e.IsEmpty(e[a.NumericFields[t]])&&e[a.NumericFields[t]].toString().length>0&&(i+=parseFloat(e[a.NumericFields[t]]))})),p[t]+=i,T[a.NumericFieldsColumnSource[t].HeaderText]=i,0==t&&C.ReportViewModel.SetCellValue(i,a.NumericFieldsColumnSource[0].DataFormat,a.NumericFieldsColumnSource[0].ColumnType,-1,D),a.ShowGrid&&C.ReportViewModel.SetCellValue(i,a.NumericFieldsColumnSource[t].DataFormat,a.NumericFieldsColumnSource[t].ColumnType,-1,r.Cells[t+1])},f=0;f<a.NumericFields.length;f++)g(f);if(n.push(T),d++,a.ShowGrid&&(a.Report.IsDefaultSortColumnExists||a.TabularDataObj.addRow(r),s.push(T,r)),!a.Report.IsDefaultSortColumnExists&&a.Report.TopRecords>=0&&d==a.Report.TopRecords)return"break"},m=0;m<i.length&&"break"!==T(m);m++);if(this.Report.IsDefaultSortColumnExists){var I,f=this.NumericFieldsColumnSource.find((function(e){return e.ID==a.Report.Preferences.DefaultSortColumn}));if(f?n.sort("DESC"==this.Report.Preferences.DefaultSortOrder?function(e,t){return e[f.HeaderText]<t[f.HeaderText]?1:-1}:function(e,t){return e[f.HeaderText]>t[f.HeaderText]?1:-1}):Logger.DebugLog('Default Sort Column "'+this.Report.Preferences.DefaultSortColumn+'" can not be applied to chart'),this.ShowGrid&&this.TabularDataObj.Clear(),p[0]=0,this.Report.TopRecords>0)for(d=n.length-1;d>=this.Report.TopRecords;d--)n.Remove(n[d]);this.ShowGrid&&n.forEach((function(e){null!=e[a.NumericFieldsColumnSource[0].HeaderText]&&(I=o.e.Double(e[a.NumericFieldsColumnSource[0].HeaderText]),p[0]+=I),a.TabularDataObj.addRow(s.GetValue(e))}))}if(this.ChartData=n,this.ChartDataColumns=l,this.RefreshAMChart.Call(),0==this.ChartData.length&&this.ChartData.push({}),this.ShowGrid){if((r=new x.d(this.TabularColumns.length)).Height=24,r.Cells[0].IsNormal=!1,r.Cells[0].CellAppearance=this.GrossTotalAppearance,r.Cells[0].Text="Total",this.IsStackChart)for(var S=1;S<this.TabularColumns.length;S++)r.Cells[S].IsNormal=!1,r.Cells[S].CellAppearance=this.GrossTotalAppearance_Data,this.Report.SetCellValue(p[S-1],this.NumericFieldsColumnSource[0].DataFormat,this.NumericFieldsColumnSource[0].ColumnType,r.Cells[S]);else for(var F=0;F<this.NumericFields.length;F++)r.Cells[F+1].IsNormal=!1,r.Cells[F+1].CellAppearance=this.GrossTotalAppearance_Data,this.Report.SetCellValue(p[F],this.NumericFieldsColumnSource[F].DataFormat,this.NumericFieldsColumnSource[F].ColumnType,r.Cells[F+1]);this.TabularDataObj.addRow(r)}}},{key:"LoadChartDataByRows",value:function(){var e=this;this.ShowGrid&&this.TabularDataObj.Clear();for(var t=this.Report.Data.filter((function(e){return e.Visible&&(e.Type==x.f.Detail||e.Type==x.f.BalanceBF||e.Type==x.f.GrossTotal)})),i=parseInt(t.Compute("max","LevelNo")),a=t.filter((function(e){return e.LevelNo==i})),r=new Array(this.TextFields.length).fill(0),s=function(t){if(null==(c=e.Report.ReportColumns.find((function(i){return i.ID==e.TextFields[t]}))))return{v:void Logger.ErrorLog("TextFields["+t+"] not found")};r[t]=e.Report.ReportColumns.indexOf(c)},o=0;o<this.TextFields.length;o++){var n=s(o);if("object"==typeof n)return n.v}for(var l=new Array(this.NumericFields.length).fill(0),h=function(t){if(null==(c=e.Report.ReportColumns.find((function(i){return i.ID==e.NumericFields[t]}))))return{v:void Logger.ErrorLog("NumericFields["+t+"] not found")};l[t]=e.Report.ReportColumns.indexOf(c)},u=0;u<this.NumericFields.length;u++){var c,D=h(u);if("object"==typeof D)return D.v}var d=[],p=[];p.push(this.TextFieldsColumnSource[0].HeaderText);for(var T=0;T<this.NumericFields.length;T++)p.push(this.NumericFieldsColumnSource[T].HeaderText);for(var y=0,m=0,I=0;I<a.length;I++){var g=a[I],f=0;null!=g.Cells[l[0]].Value&&(f=parseFloat(g.Cells[l[0]].Value)),m+=f;var S=new x.c,F=new x.c;C.ReportViewModel.SetCellValue(g.Cells[r[0]].Value,this.TextFieldsColumnSource[0].DataFormat,this.TextFieldsColumnSource[0].ColumnType,-1,S),C.ReportViewModel.SetCellValue(f,this.NumericFieldsColumnSource[0].DataFormat,this.NumericFieldsColumnSource[0].ColumnType,-1,F);var b={};b[this.TextFieldsColumnSource[0].HeaderText]=S.Text;for(var A=0;A<this.NumericFields.length;A++)try{null!=g.Cells[l[A]].Value&&(b[this.NumericFieldsColumnSource[A].HeaderText]=g.Cells[l[A]].Value)}catch(M){}if(d.push(b),y++,this.ShowGrid){var v=new x.d(this.TabularColumns.length);v.Height=22,v.Cells[0]=S,v.Cells[1]=F,this.Report.IsDefaultSortColumnExists||this.TabularDataObj.addRow(v)}if(!this.Report.IsDefaultSortColumnExists&&this.Report.TopRecords>=0&&y==this.Report.TopRecords)break}if(this.ChartData=d,this.ChartDataColumns=p,this.RefreshAMChart.Call(),this.ShowGrid){var R=new x.d(this.TabularColumns.length);R.Height=24,R.Cells[0].IsNormal=!1,R.Cells[0].CellAppearance=this.GrossTotalAppearance,R.Cells[0].Text="Total",R.Cells[1].IsNormal=!1,R.Cells[1].CellAppearance=this.GrossTotalAppearance_Data,this.Report.SetCellValue(m,this.TabularColumns[1].DataFormat,this.TabularColumns[1].ColumnType,R.Cells[1]),this.TabularDataObj.addRow(R)}}},{key:"LoadChartDataForWidget",value:function(){if(this.ShowGrid&&this.TabularDataObj.Clear(),this.ChartData=null,this.Parent.PrevData>0){var e=new Date(this.FromDate.Date.getFullYear(),s.a.SessionManager.AccountingFromMonth-1,1);if(e>this.FromDate.Date&&(e=e.AddYears(-1)),this.ToDate.Date>e.AddYears(1).AddDays(-1))return;if("YrWise"==this.TextFields[0]||0==this.NumericFields.length)return;for(var t=0;t<=this.Parent.PrevData;t++)this.NumericFields[t]=1==s.a.SessionManager.AccountingFromMonth?this.FromDate.Date.AddYears(-t).getFullYear().toString():this.FromDate.Date.AddYears(-t).getFullYear().toString()+"-"+((this.FromDate.Date.AddYears(-t).getFullYear()+1)%100).toString(),this.NumericFieldsColumnSource[t].ID=this.NumericFields[t],this.NumericFieldsColumnSource[t].HeaderText=this.NumericFields[t],this.TabularColumns[t+1].HeaderText=this.NumericFields[t];this.TabularColumns[0].HeaderText=this.TextFieldsColumnSource[this.CurrentLevel].HeaderText,this.TabularDataObj.RefreshColumns()}this.WidgetCallsComplated=0,this.widgetds=new Array(this.Widgets.length);for(var i=0;i<this.Widgets.length;i++)this.widgetds[i]=this.Widgets[i].SetValue(this.Widgets[i].Header,i)}},{key:"WidgetCallBack",value:function(e,t){this.widgetds[e]=t,this.WidgetCallsComplated++,this.WidgetCallsComplated==this.Widgets.length&&this.LoadChartDataForWidgetCallBack(this.widgetds)}},{key:"LoadChartDataForWidgetCallBack",value:function(e){var t=this;this.LoadingVisibility=!1;var i,a,r,o,n=null,l=[],h=[];h.push(this.TextFieldsColumnSource[this.CurrentLevel].HeaderText);for(var u=0;u<this.NumericFields.length;u++)h.push(this.NumericFieldsColumnSource[u].HeaderText);if("MnWise"==this.TextFields[0])for(h.push("Mn"),h.push("Yr"),r=new Date(this.FromDate.Date.getFullYear(),this.FromDate.Date.getMonth(),1);r<=this.ToDate.Date;)(i={}).Mn=r.getMonth(),i.Yr=r.getFullYear(),i[this.TextFieldsColumnSource[this.CurrentLevel].HeaderText]=this.FromDate.Date.getFullYear()==this.ToDate.Date.getFullYear()||this.Parent.PrevData>0?r.ToString("MMM"):r.ToString("MMM-yy"),l.push(i),r=r.AddMonths(1);else if("QtrWise"==this.TextFields[0]){h.push("Mn"),h.push("Yr");var c=new Date(this.FromDate.Date.getFullYear(),s.a.SessionManager.AccountingFromMonth-1,1);c>this.FromDate.Date&&(c=c.AddYears(-1));var D="",d=1;for(c.getFullYear();c.AddMonths(3)<=this.FromDate.Date;)d++,c.getFullYear(),c=c.AddMonths(3);for(0==this.Parent.PrevData&&(D=" "+(D=1==s.a.SessionManager.AccountingFromMonth?c.getFullYear().toString():c.iMonth()>=s.a.SessionManager.AccountingFromMonth?c.getFullYear().toString()+"-"+((c.getFullYear()+1)%100).toString():(c.getFullYear()-1).toString()+"-"+(c.getFullYear()%100).toString())),(i={}).Mn=c.getMonth(),i.Yr=c.getFullYear(),i[this.TextFieldsColumnSource[this.CurrentLevel].HeaderText]="Q"+d+D,l.push(i);c.AddMonths(3)<=this.ToDate.Date;)5==++d&&(d=1),c=c.AddMonths(3),0==this.Parent.PrevData&&(D=" "+(D=1==s.a.SessionManager.AccountingFromMonth?c.getFullYear().toString():c.iMonth()>=s.a.SessionManager.AccountingFromMonth?c.getFullYear().toString()+"-"+((c.getFullYear()+1)%100).toString():(c.getFullYear()-1).toString()+"-"+(c.getFullYear()%100).toString())),(i={}).Mn=c.getMonth(),i.Yr=c.getFullYear(),i[this.TextFieldsColumnSource[this.CurrentLevel].HeaderText]="Q"+d+D,l.push(i)}else if("YrWise"==this.TextFields[0])for(h.push("Yr"),r=new Date(this.FromDate.Date.getFullYear(),this.FromDate.Date.getMonth(),1);r<=this.ToDate.Date;)(i={}).Yr=r.getFullYear(),i[this.TextFieldsColumnSource[this.CurrentLevel].HeaderText]=r.getFullYear(),l.push(i),r=r.AddYears(1);else this.TextFields[0].startsWith("DIM_");11==this.Widgets[0].TypeID||12==this.Widgets[0].TypeID||13==this.Widgets[0].TypeID||14==this.Widgets[0].TypeID||15==this.Widgets[0].TypeID||18==this.Widgets[0].TypeID||19==this.Widgets[0].TypeID||20==this.Widgets[0].TypeID?(e[0].length>0&&(o=Object.keys(e[0][0])[0]),e[0].forEach((function(e){(i={})[h[0]]=e[o].toString(),i[h[1]]=parseFloat(e.Balance),l.push(i)}))):function(){var r,o=0;if(t.Parent.PrevData>0){if(o=t.Widgets[0].Header.dbl,e[0].Rows.forEach((function(e){"MnWise"==t.TextFields[0]?a=l.filter((function(t){return t.Mn==e.Mn})):"QtrWise"==t.TextFields[0]&&(a=l.filter((function(t){return t.Mn<=e.Mn&&t.Mn+3>=e.Mn}))),r=1!=s.a.SessionManager.AccountingFromMonth?parseInt(e.Mn)>=s.a.SessionManager.AccountingFromMonth?e.Yr.toString()+"-"+((parseInt(e.Yr)+1)%100).toString():(parseInt(e.Yr)-1).toString()+"-"+(parseInt(e.Yr)%100).toString():e.Yr.toString(),t.Widgets[0].IncludeOpening?o+=parseFloat(e.Balance):a.length>0&&(o=null!=a[0][r]?parseFloat(e.Balance)+parseFloat(a[0][r]):parseFloat(e.Balance)),a.length>0&&(a[0][r]=o)})),t.Widgets[0].IncludeOpening)for(var n=0;n<l.length;n++){i=l[n];for(var h=t.NumericFields.length-1;h>=0;h--)null==i[t.NumericFields[h]]&&(i[t.NumericFields[h]]=0==n?h==t.NumericFields.length-1?o:l[l.length-1][t.NumericFields[h+1]]:l[n-1][t.NumericFields[h]])}}else for(var u=function(r){if(o=t.Widgets[r].Header.dbl,e[r].forEach((function(e){"MnWise"==t.TextFields[0]?a=l.filter((function(t){return t.Yr==e.Yr&&t.Mn==e.Mn})):"QtrWise"==t.TextFields[0]?a=l.filter((function(t){return t.Yr==e.Yr&&t.Mn<=e.Mn&&t.Mn+3>=e.Mn})):"YrWise"==t.TextFields[0]?a=l.filter((function(t){return t.Yr==e.Yr})):t.TextFields[0].startsWith("DIM_")&&(a=l.filter((function(t){return t.Name==e.Name.toString()}))),0==a.length&&t.TextFields[0].startsWith("DIM_")&&((i={}).Name=e.Name.toString(),l.push(i),(a=[]).push(i)),t.Widgets[r].IncludeOpening?o+=parseFloat(e.Balance):a.length>0&&(o=null!=a[0][t.NumericFieldsColumnSource[r].HeaderText]?parseFloat(e.Balance)+parseFloat(a[0][t.NumericFieldsColumnSource[r].HeaderText]):parseFloat(e.Balance)),a.length>0&&(a[0][t.NumericFieldsColumnSource[r].HeaderText]=o)})),t.Widgets[r].IncludeOpening)for(var s=0;s<l.length;s++)null==(i=l[s])[t.NumericFieldsColumnSource[r].HeaderText]&&(i[t.NumericFieldsColumnSource[r].HeaderText]=0==s?o:l[s-1][t.NumericFieldsColumnSource[r].HeaderText])},c=0;c<t.Widgets.length;c++)u(c)}(),l.forEach((function(e){for(var i=0;i<t.NumericFields.length;i++)e[h[i+1]]||(e[h[i+1]]=0)})),h.Contains("Mn")&&h.Remove("Mn"),h.Contains("Yr")&&h.Remove("Yr"),null!=this.TabularColumns&&this.TabularColumns.length>0&&this.TabularColumns[0].HeaderText!=this.TextFieldsColumnSource[this.CurrentLevel].HeaderText&&(this.TabularColumns[0].HeaderText=this.TextFieldsColumnSource[this.CurrentLevel].HeaderText,this.TabularDataObj.RefreshColumns());var p=new Array(this.NumericFieldsColumnSource.length).fill(0);if(this.ShowGrid){l.forEach((function(e){var i=new x.c;new x.c,C.ReportViewModel.SetCellValue(e[h[0]],t.TextFieldsColumnSource[t.CurrentLevel].DataFormat,t.TextFieldsColumnSource[t.CurrentLevel].ColumnType,-1,i),(n=new x.d(t.TabularColumns.length)).Height=22,n.Cells[0]=i;for(var a=0;a<t.NumericFields.length;a++)t.Parent.PrevData>0?t.Widgets[0].IncludeOpening?p[a]=parseFloat(e[h[a+1]]):p[a]+=parseFloat(e[h[a+1]]):t.Widgets[a].IncludeOpening?p[a]=parseFloat(e[h[a+1]]):p[a]+=parseFloat(e[h[a+1]]),C.ReportViewModel.SetCellValue(e[h[a+1]],t.NumericFieldsColumnSource[a].DataFormat,t.NumericFieldsColumnSource[a].ColumnType,-1,n.Cells[a+1]);t.TabularDataObj.addRow(n)})),(n=new x.d(this.TabularColumns.length)).Height=24,n.Cells[0].IsNormal=!1,n.Cells[0].CellAppearance=this.GrossTotalAppearance,n.Cells[0].Text="Total";for(var T=0;T<this.NumericFields.length;T++)n.Cells[T+1].IsNormal=!1,n.Cells[T+1].CellAppearance=this.GrossTotalAppearance_Data,C.ReportViewModel.SetCellValue(p[T],this.NumericFieldsColumnSource[T].DataFormat,this.NumericFieldsColumnSource[T].ColumnType,-1,n.Cells[T+1]);this.TabularDataObj.addRow(n)}this.ChartData=l,this.ChartDataColumns=h,this.RefreshAMChart.Call(),0==this.ChartData.length&&this.ChartData.push({})}},{key:"OnChartTypeChanged",value:function(e){o.e.IsEmpty(this.ChartTypes.SelectedValue)||-1==o.e.Int(this.ChartTypes.SelectedValue)||this.RefreshAMChart.Call()}},{key:"OnChartDimColumnsChange",value:function(e){var t=this;this.TextFields[0]=this.ChartDimColumns.SelectedValue,this.TextFieldsColumnSource[0]=this.Report.ColumnSource.find((function(e){return e.ID==t.TextFields[0]})),this.RefreshChart()}},{key:"RefreshChart",value:function(){var e=this;this.IsWidgetChart?(this.LoadingVisibility=!0,this.LoadChartDataForWidget()):(null!=this.Report.ReportData?(this.LoadChartData(),this.Report.ReportViewType=y.e.DashBoard):this.Report.StaticReportType>0&&(this.LoadChartDataByRows(),this.Report.ReportViewType=y.e.DashBoard),this.Report.FilterText.forEach((function(t){null!=t.Text&&(e.ChartName=e.ChartName+" - "+t.Label+" : "+t.Text)}))),this.TabularDataObj.Width=0,this.ShowGrid&&this.TabularDataObj.ReportColumns.forEach((function(t){t.HeaderAppearance.IsVisible&&(e.TabularDataObj.Width+=t.width)}))}},{key:"DrillDownChartFX",value:function(e){var t=this;if(!(this.IsStackChart||this.CurrentLevel+1>=this.TextFields.length)){this.CurrentLevel++,this.DrillBackVisible=!0;var i=this.ChartData[e][this.TextFieldsColumnSource[this.CurrentLevel-1].HeaderText].toString(),a=!1;0!=this.Report.lstGroup.filter((function(e){return"Summary"==e.DisplayMode})).length&&null!=this.Report.ReportSummaryData?this.Report.ReportSummaryDataColumns.Contains(this.TextFields[this.CurrentLevel-1])&&"date"==this.Report.ColumnSourceALL.find((function(e){return e.ID==t.TextFields[t.CurrentLevel-1]})).ColumnType.toLowerCase()&&(a=!0):this.Report.ReportDataColumns.Contains(this.TextFields[this.CurrentLevel-1])&&"date"==this.Report.ColumnSourceALL.find((function(e){return e.ID==t.TextFields[t.CurrentLevel-1]})).ColumnType.toLowerCase()&&(a=!0),this.lstDrillFilter.push(a?"["+this.TextFields[this.CurrentLevel-1]+"]= convert('"+this.ChartData[e][this.TextFields[this.CurrentLevel-1]+"_DATE"]+"',System.DateTime)":"["+this.TextFields[this.CurrentLevel-1]+"]= '"+i+"'"),this.RefreshChart()}}},{key:"TabularColumns",get:function(){return this.TabularDataObj.ReportColumns}},{key:"ChartData",get:function(){return this._ChartData},set:function(e){var t=this;null!=e&&null!=this.arrNumFormat.find((function(e){return null!=e}))&&e.forEach((function(e){if(t.IsStackChart)for(var i=0;i<t.dtStack.length;i++)null!=t.arrNumFormat[0]&&t.arrNumFormat[0].Divider>1&&(e[t.dtStack[i][t.dtStack_C0].toString()]=parseFloat(e[t.dtStack[i][t.dtStack_C0].toString()])/t.arrNumFormat[0].Divider);else for(var a=0;a<t.NumericFieldsColumnSource.length;a++)null!=t.arrNumFormat[a]&&t.arrNumFormat[a].Divider>1&&(e[t.NumericFieldsColumnSource[a].HeaderText]=parseFloat(e[t.NumericFieldsColumnSource[a].HeaderText])/t.arrNumFormat[a].Divider)})),e!=this._ChartData&&(this._ChartData=e)}}],[{key:"RevenUChartViewModel",value:function(){a.EmptyChartData.push({Name:"",Value:0})}}]),i}(n.b)).EmptyChartData=[],a),H=i("OQq8"),O=i("YU11"),_=i("CUWK"),W=i("vSGu"),G=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){var a;return _classCallCheck(this,i),(a=t.call(this)).StaticFields=new Array,a.DocsArrowData=new Array,a.FavouriteID=0,a.BgColor="#f9f9f9",a.ClassName="DashFavoritesViewModel",a.DisplayName=s.a.GetResource("Favorite"),a.Column1="0.25*",a.Column2="0.25*",a.Column3="0.25*",a.Column4="0.25*",a.Title=a.DisplayName,a.FavouriteID=e,s.a.admin.GetFavorite("VIEW",e,!0).subscribe((function(e){a.ds=e,a.onLoad()}),(function(e){})),Logger.InfoLog("DashFavoritesViewModel::Leaving DashFavoritesViewModel"),a}return _createClass(i,[{key:"onClick",value:function(e){var t=new m.a;if(e instanceof H.a){var i=e;if("1"==i.isReport.toString())if("0"==i.Featureactiontypeid)s.a.page.ShowLoading=!1,alert("Report Not Assigned.");else{var a=new C.ReportViewModel;a.ReportViewModel_1(parseInt(i.DBColumnName)),0==a.ReturnType&&s.a.page.addNewTab({component:O.ReportViewComponent,params:{obj:a}})}else{t.FeatureActionID=parseInt(i.DBColumnName),t.ScreenName=i.ScreenName,t.FeatureID=i.FeatureID,50==t.FeatureID?t.FeatureActionTypeID=parseInt(i.Featureactiontypeid):"31"!=i.Featureactiontypeid&&"30"!=i.Featureactiontypeid||(t.FeatureActionTypeID=parseInt(i.Featureactiontypeid)),i.FeatureID>5e4?(t.ScreenType=7,t.FeatureActionTypeID="31"!=i.Featureactiontypeid&&"30"!=i.Featureactiontypeid?2:parseInt(i.Featureactiontypeid)):i.FeatureID>4e4&&(t.ISDoctype=i.DBColumnID);var r={};_.RibbonExtViewModel.OncmdLoadPage(t,r).then((function(e){var i;r.component&&("FeatureActionID"==r.basedon?i=s.a.page.tabs.find((function(e){return e.instance instanceof r.component&&e.instance.FeatureActionID==t.FeatureActionID})):"CostCenterID"==r.basedon?i=s.a.page.tabs.find((function(e){return e.instance instanceof r.component&&e.instance.CostCenterID==t.FeatureID})):"Unique"==r.basedon&&(i=s.a.page.tabs.find((function(e){return e.instance instanceof r.component}))),i?(s.a.page.tabs.map((function(e){return e.active=!1})),i.active=!0):(r.title=t.ScreenName,s.a.page.addNewTab(r)))}))}}else for(var o=0;o<this.StaticFields.length;o++)if(this.oText=this.StaticFields[o],this.oText.DBColumnName==e.toString()){if("1"==this.oText.isReport.toString())(new C.ReportViewModel).ReportViewModel_1(parseInt(this.oText.DBColumnName));else{t.FeatureActionID=parseInt(this.oText.DBColumnName),t.ScreenName=this.oText.ScreenName,t.FeatureID=this.oText.FeatureID,"31"!=this.oText.Featureactiontypeid&&"30"!=this.oText.Featureactiontypeid||(t.FeatureActionTypeID=parseInt(this.oText.Featureactiontypeid)),this.oText.FeatureID>5e4&&(t.ScreenType=7,t.FeatureActionTypeID="31"!=this.oText.Featureactiontypeid&&"30"!=this.oText.Featureactiontypeid?2:parseInt(this.oText.Featureactiontypeid)),_.RibbonExtViewModel.OncmdLoadPage(t,void 0)}break}}},{key:"onLoad",value:function(){var e=this;Logger.InfoLog("DashFavoritesViewModel::Entering onLoad");var t,i=-1;try{if(null!=this.ds&&this.ds.Tables[0].length>0&&this.ds.Tables.length>1&&this.ds.Tables[1].length>0&&(i=parseInt(this.ds.Tables[1][0].MaxRows)),null!=this.ds&&this.ds.Tables.length>2&&this.ds.Tables[2].length>0&&o.e.String(this.ds.Tables[2][0].OptionsXML).length>0){var a=new o.f;a.LoadXml(this.ds.Tables[2][0].OptionsXML.toString()),this.BgColor=o.e.rgbColor(o.f.SelectSingleNodeText(a.DocumentElement,"BgColor")),"#FFFFFF"==this.BgColor&&(this.BgColor="#f9f9f9")}for(var r=function(i){for(var a=function(a){(t=e.ds.Tables[0].filter((function(e){return e.RowNo==i&&e.ColumnNo==a}))).length>0&&(e.oText=new H.a,e.oText.Label=o.e.String(t[0].DisplayName),e.oText.DBColumnName=t[0].FeatureactionID.toString(),e.oText.SmallImage="/assets/images/menu/"+o.e.String(t[0].ImagePath).replace("/","''"),e.oText.Row=i,e.oText.Column=a,e.oText.ClickCommand.Subscribe(e,"onClick"),e.oText.ScreenName=o.e.String(t[0].ScreenName),e.oText.ShortcutKey=o.e.String(t[0].ShortCutKey),o.e.IsEmpty(t[0].FeatureID)||(e.oText.FeatureID=parseInt(t[0].FeatureID)),e.oText.KeyTip=o.e.String(t[0].ButtonKeyTip),e.oText.isReport=o.e.String(t[0].isReport),e.oText.Featureactiontypeid=o.e.String(t[0].FeatureActionTypeID),e.oText.Data=o.e.String(t[0].Link),e.oText.WebIcon=W.FavoritesViewModel.GetIcon(e.oText),o.e.IsEmpty([0].DocumentType)||(e.oText.DBColumnID=parseInt(t[0].DocumentType)),e.StaticFields.push(e.oText))},r=0;r<4;r++)a(r)},s=0;s<=i;s++)r(s);if(this.StaticFields.length>0){var n,l=this.StaticFields.Compute("max","Column");(n=o.e.Int(l))>=0&&n<4&&(this.Column1=(100/(n+1)).ToString("N2")+"%",this.Column2=n<1?"0.0*":this.Column1,this.Column3=n<2?"0.0*":this.Column1,this.Column4=n<3?"0.0*":this.Column1),this.StaticFields.filter((function(e){return!o.e.IsEmpty(e.Data)})).forEach((function(t){t.Data.split(",").forEach((function(i){var a=e.StaticFields.find((function(e){return e.FeatureID==parseInt(i)}));if(a){var r=new Y;r.Source=t,r.Destination=a,e.DocsArrowData.push(r)}}))}))}}catch(h){Logger.ErrorLog("DashFavoritesViewModel::onLoad",h)}Logger.InfoLog("DashFavoritesViewModel::Leaving onLoad")}}]),i}(n.b),Y=function e(){_classCallCheck(this,e),this.X1=0,this.X2=0,this.Y1=0,this.Y2=0,this.Stroke="Gray"},j=i("AyOk"),Q=i("ouML"),U=i("Wh9R"),X=i("7SrT"),K=i("HwyT"),z=function(e){_inherits(a,e);var t=_createSuper(a);function a(e){var i;return _classCallCheck(this,a),(i=t.call(this)).TypeID=0,i.UnApprovedDocumentsVisible=!1,i.DocumentDraftsVisible=!1,i.PDCDocumentsVisible=!1,i.NotifEventsVisible=!1,i.DepreciationPostingVisible=!1,i.RejectedDocumentsVisible=!1,i.DocsToApproveGridVisible=!1,i.CalendarVisible=!1,i.ClassName="DashAddOnsViewModel",i.TypeID=e,1==e?(i.UnApprovedDocumentsVisible=!0,i.UnApprovedDocuments=new j.UnAppDocumentsViewModel,i.UnApprovedDocuments.DocumentsGrid.Height=void 0):2==e?(i.DocumentDraftsVisible=!0,i.DocumentDrafts=new Q.DocumentDraftsViewModel(_assertThisInitialized(i),1),setTimeout((function(){i.DocumentDrafts.FillGrid()}),500),i.DocumentDrafts.Grid.Height=void 0):3==e?(i.PDCDocumentsVisible=!0,i.PDCDocuments=new U.DashBoardNotifViewModel(4),i.PDCDocuments.Grid.Height=void 0):4==e?(i.NotifEventsVisible=!0,i.NotifEvents=new U.DashBoardNotifViewModel(2),i.NotifEvents.Grid.Height=void 0):5==e?(i.DepreciationPostingVisible=!0,i.DepreciationPosting=new X.PostDepreciationViewModel("",!0,!1)):7==e?(i.DocsToApproveGridVisible=!0,i.DocsToApprove=new K.a):8==e&&i.LoadCalendar(),i}return _createClass(a,[{key:"LoadCalendar",value:function(){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(i.bind(null,"m+Ff"));case 2:t=e.sent,a=t.RCalenderViewModel,this.Calendar=new a,this.Calendar._RCalenderViewModel(!1),this.CalendarVisible=!0;case 5:case"end":return e.stop()}}),e,this)})))}},{key:"Refresh",value:function(){1==this.TypeID?this.UnApprovedDocuments.OnLoad():2==this.TypeID?this.DocumentDrafts.FillGrid():3==this.TypeID?this.PDCDocuments.InitColumns():4==this.TypeID?this.NotifEvents.RefreshData():5==this.TypeID?this.DepreciationPosting.OnButtonClick("RefreshDepr"):7==this.TypeID&&this.DocsToApprove.LoadDocsToApproveGrid(-1)}},{key:"refreshUI",value:function(){1==this.TypeID?this.UnApprovedDocuments.DocumentsGrid.refreshUI():2==this.TypeID?this.DocumentDrafts.Grid.refreshUI():3==this.TypeID?this.PDCDocuments.Grid.refreshUI():4==this.TypeID?this.NotifEvents.Grid.refreshUI():5==this.TypeID&&this.DepreciationPosting.OnButtonClick("RefreshDepr")}}]),a}(n.b),q=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,a){var r;_classCallCheck(this,i),(r=t.call(this)).Rows=0,r.Columns=0,r.LoadingVisibility=!1,r.ClassName="KPIViewViewModel",r.Report=e,e.Chart=_assertThisInitialized(r),r.KPILabels=[];var s=e.Reportds.Tables[0][0].DashKPIXML.toString(),n=new o.f;n.LoadXml(s),r.Rows=parseInt(n.DocumentElement.attributes.Rows.value),r.Columns=parseInt(n.DocumentElement.attributes.Cols.value);for(var l=0;l<n.DocumentElement.children.length;l++)for(var h=n.DocumentElement.children[l],u=function(t){var i=h.childNodes[t];if(null!=i.attributes.Empty)return"continue";var a=new J;a.Row=l,a.Column=t,a.RowSpan=null!=i.attributes.rs?i.attributes.rs.value:"1",a.ColumnSpan=null!=i.attributes.cs?i.attributes.cs.value:"1",a.ShowCaption=null==i.attributes.caption,a.ShowCaption||(a.Row1Height="0");var s=o.f.SelectSingleNode(i,"ID");null!=s&&(D=e.ReportColumns.find((function(e){return e.ID==s.innerHTML})))&&(a.DBColumnName=D.ID,a.Field=D,a.FieldIndex=e.ReportColumns.indexOf(D),a.ShowCaption&&(a.Header.Label=D.HeaderText,a.Header.FontSize=D.HeaderAppearance.FontSize,a.Header.ForeColor=D.HeaderAppearance.ForeColor,a.Header.BackColor=D.HeaderAppearance.BackColor,a.Header.FontFamily=D.HeaderAppearance.FontFamilyName,a.Header.Align=D.HeaderAppearance.Alignment.toString(),a.Header.VAlign="Center"),a.Data.FontSize=D.DataAppearance.FontSize,a.Data.ForeColor=D.DataAppearance.ForeColor,a.Data.BackColor=D.DataAppearance.BackColor,a.Data.FontFamily=D.DataAppearance.FontFamilyName,a.Data.Align=D.DataAppearance.Alignment.toString(),a.Data.VAlign="Center"),r.KPILabels.push(a)},c=0;c<h.childNodes.length;c++){var D;u(c)}return r}return _createClass(i,[{key:"LoadChartData",value:function(){this.Report.lstGroup.find((function(e){return"Summary"==e.DisplayMode}))&&null!=this.Report.ReportSummaryData?this.Report.ReportSummaryData:this.Report.ReportData;for(var e=this.Report.AddSubtotals_RT(this.Report.GrpReportTotal,0),t=0;t<this.Report.ReportColumns.length;t++)e.Cells[t].CellAppearance=this.Report.ReportColumns[t].DataAppearance.Clone();this.Report.ApplyKPI(e);for(var i=0;i<this.KPILabels.length;i++){var a=this.KPILabels[i];null!=a.Field&&(a.ImagePath=null,-1!=a.FieldIndex&&a.FieldIndex<e.Cells.length&&(a.Data.Label=e.Cells[a.FieldIndex].Text,a.Data.ForeColor=e.Cells[a.FieldIndex].CellAppearance.ForeColor,a.ImagePath="pack://application:,,,/"+e.Cells[a.FieldIndex].CellAppearance.ImagePath))}}},{key:"RefreshChart",value:function(){null!=this.Report.ReportData&&(this.LoadChartData(),this.Report.ReportViewType=y.e.DashBoard)}}]),i}(n.b),J=function(e){_inherits(i,e);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this)).FieldIndex=-1,e.Field=null,e.ShowCaption=!1,e.ShowImage=!1,e.Header=new Z,e.Data=new Z,e.Row1Height="0.4*",e.Row2Height="0.6*",e}return i}(d.c),Z=function(e){_inherits(i,e);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.apply(this,arguments)).FontSize=12,e.FontFamily="Calibri",e.Field=null,e}return i}(d.c),$=i("NipM"),ee=i("7JXL"),te=i("lG8W"),ie=function(e){_inherits(i,e);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this)).InitUI=!1,e.IsDashClick=!1,e.IsAllDashBoardsLoaded=!1,e.AllDashBoards=[],e.DashResize=null,e.ShowList=!1,e._ShowReportFilter=!1,e.BackColor="White",e.Rows=0,e.Columns=0,e.IsRowHeightExists=!1,e.ds=null,e.dsWidgetNames=null,e.disname="",e.DashBoardID=0,e.dicPromises=new g.c,e}return _createClass(i,[{key:"DBViewViewModel_1",value:function(e){this.DashBoardID=e,this.DisplayName=s.a.GetResource("Loading"),this.DBList=new Array,this.InitDashboard(e)}},{key:"InitDashboard",value:function(e){var t=this;this.DashBoardID=e,s.a.report.GetDashBoard(1,e,!0).then((function(e){t.ds=e,t.disname=t.ds.Tables[0][0].DashBoardName.toString();var i=t.ds.Tables[0][0].DashBoardType.toString().split("*");t.Rows=parseInt(i[0]),t.Columns=parseInt(i[1]),t.RowHeight=new Array(t.Rows).fill(0),t.RowHeightXML="",t.DBListTemp=new Array(t.Rows),t.DBListTemp.Clear(),t.DBList.forEach((function(e){e.timer&&(e.timer.Enabled=!1)})),t.DBList.Clear(),t.dicPromises.Clear();for(var a=0;a<t.ds.Tables[0].length;a++){var r=new ae;r.DBPanel_1(t,t.ds.Tables[0][a]),t.DBList.push(r),t.DBListTemp[parseInt(r.Row)]||(t.DBListTemp[parseInt(r.Row)]=[]),t.DBListTemp[parseInt(r.Row)].push(r),1!=r.TypeID&&2!=r.TypeID&&5!=r.TypeID||t.dicPromises.push(a,s.a.report.GetReport(0,r.ReportID,!0))}if(!o.e.StringIsNullOrEmpty(t.RowHeightXML)){if(t.RowHeightXML.Contains(","))for(var n=t.RowHeightXML.split(","),l=0;l<t.Rows;l++)t.RowHeight[l]=l<n.length?parseInt(n[l]):0;else if(parseInt(t.RowHeightXML)>0)for(var h=0;h<t.Rows;h++)t.RowHeight[h]=parseInt(t.RowHeightXML);t.RowHeight.forEach((function(e){e>0&&(t.IsRowHeightExists=!0)}))}return Promise.all(t.dicPromises.values).then((function(e){for(var i=0;i<t.dicPromises.keys.length;i++)t.ds.Tables[0][t.dicPromises.keys[i]].ReportDefn=e[i];t.IsDashClick&&null!=t.DashResize&&(t.DashResize.Call(!0),t.DashResize.Call(!1)),setTimeout((function(){var e=1;t.DBList.forEach((function(t){t.Visible&&(setTimeout((function(){t.DBPanel_1_Async()}),50*e),e++)})),t.worker_RunWorkerCompleted(null,null)}),20)}))}))}},{key:"worker_RunWorkerCompleted",value:function(e,t){this.DisplayName=this.disname}},{key:"getStyles",value:function(){var e={};return s.a.IsMobile?e={gridTemplateColumns:"1fr",gridTemplateRows:"repeat(".concat(this.Rows,",").concat(100/this.Rows,"%)")}:(e={gridTemplateColumns:"repeat(".concat(this.Columns,",").concat(100/this.Columns,"%)"),gridTemplateRows:"repeat(".concat(this.Rows,",").concat(100/this.Rows,"%)")},this.IsRowHeightExists&&(e.gridTemplateRows=""+this.RowHeight.map((function(e){return e>0?e+"px":"1fr"})).join(" "))),e}},{key:"getBackground",value:function(e){if(s.a.IsMobile)return{background:e.BodyBackColor}}},{key:"getDBpanelStyles",value:function(e){if(s.a.IsMobile){var t={};return t={margin:"5px 5px 5px 0"},this.RowHeight[e.Row]>0&&e.Visible?t.height=e.RowSpan*this.RowHeight[e.Row]+"px":e.Visible?6!=e.TypeID&&(t.height="calc(".concat(100/this.Rows,"%)"),t.minHeight="calc(".concat(100/this.Rows,"%)")):(t.margin="0",t.height="0",t.display="none"),1237!=e.dr.NodeID&&1234!=e.dr.NodeID&&1238!=e.dr.NodeID||(t.height="auto"),t}return{margin:"5px 5px 5px 0",gridColumnStart:""+(parseInt(e.Column)+1),gridColumnEnd:"span "+e.ColumnSpan,gridRowStart:""+(parseInt(e.Row)+1),gridRowEnd:"span "+e.RowSpan}}},{key:"LoadDashList",value:function(){var e=this;this.IsAllDashBoardsLoaded=!0,this.ShowList=!0;var t=s.a.report.GetDashBoard(2,0),i=null;t.Tables[0].forEach((function(t){if(i!=t.GroupName.toString()){i=t.GroupName.toString();var a=new I.a;a.Label=i,a.SectionID="1",e.AllDashBoards.push(a)}var r=new m.a;r.FeatureActionTypeID=parseInt(t.DashBoardID),r.AppPath=r.FeatureActionTypeID==e.DashBoardID?"#FFE8A6":"#F9F9F9",r.Label=t.DashBoardName.toString(),e.AllDashBoards.push(r)}))}},{key:"OnDashBoardClick",value:function(e){this.IsDashClick=!0;var t=this.AllDashBoards.find((function(e){return e instanceof m.a&&"#FFE8A6"==e.AppPath}));t&&(t.AppPath="#F9F9F9"),e.AppPath="#FFE8A6",this.InitDashboard(e.FeatureActionTypeID)}},{key:"OnButtonClick",value:function(e){"ShowList"==e?(this.ShowList=!this.ShowList,o.e.SetPersonalize("ShowDBList",this.ShowList?"1":"0"),this.IsAllDashBoardsLoaded||this.LoadDashList()):"DashboardFilter"==e&&(null==this.ReportFilter&&(this.ReportFilter=new re(this)),this.ShowReportFilter=!0)}},{key:"ApplyDBFilters",value:function(){var e=this;setTimeout((function(){e.filterworker_DoWork(null,null)}),50)}},{key:"filterworker_DoWork",value:function(e,t){this.DBList.forEach((function(e){2==e.TypeID&&null!=e.Chart?e.Chart.IsWidgetChart?e.Chart.OnButtonClick("WidgetFilterOK"):e.Chart.Report.OnButtonClick("OK_CLICK"):5==e.TypeID&&null!=e.KPI&&e.KPI.Report.OnButtonClick("OK_CLICK")}))}},{key:"ShowReportFilter",get:function(){return this._ShowReportFilter},set:function(e){this._ShowReportFilter=e,e&&this.ReportFilter.RefreshCostCenterItems()}}]),i}(n.b),ae=function(){function e(){_classCallCheck(this,e),this.TypeID=0,this.AddOnID=0,this.Parent=null,this.Visible=!1,this.AutoRefresh=!1,this.Filter=!1,this.RefreshRate=0,this.TopRecords=0,this.timer=null,this.Row="0",this.Column="0",this.ColumnSpan="1",this.RowSpan="1",this.ShowBorder=!1,this.ShowUILoad=!0,this.ExportVisible=!1,this.PrintVisible=!0,this.RefreshVisibility=!0,this.RegenerateVisibility=!0,this.FilterVisibility=!1,this.GetAllDataVisibility=!0,this.ButtonColor="#111111",this.ButtonOpacity=1,this.HeaderForeColor="#00A9DA",this.HeaderBackColor="#FFFF00",this.BodyBackColor="#FFFFFF",this.PointsColor="#777777",this.ShowHeader=!0,this.ScreenTemp=[],this.PrevData=0,this.PrevDataFilter=0,this.IsMaximize=!1,this.IsWidgetChart=!1,this.xOptions=null,this.EmpWidgetTypeID=0,this.ShowLoading=!0}return _createClass(e,[{key:"DBPanel_1",value:function(e,t){this.dr=t,this.Parent=e,this.AutoRefresh=Object(T.j)(t.AutoRefresh),this.AutoRefresh&&(this.RefreshRate=parseFloat(t.RefreshRate),this.RefreshRate<=0&&(this.AutoRefresh=!1)),null!=t.Filter&&(this.Filter=Object(T.j)(t.Filter)),this.Header=t.ReportName.toString(),this.TopRecords=parseInt(t.TopRecords),this.TypeID=null!=t.TypeID?parseInt(t.TypeID):1,this.Row=t.RowNo.toString(),this.Column=t.ColNo.toString(),this.RowSpan=t.RowSpan.toString(),this.ColumnSpan=t.ColSpan.toString(),this.ShowBorder=!0;var i=o.e.String(t.Options);if(i.length>0&&i.startsWith("<Options>")){var a;this.xOptions=new o.f,this.xOptions.LoadXml(i),this.HeaderBackColor=o.e.rgbColor(o.f.SelectSingleNodeText(this.xOptions.DocumentElement,"HeaderBackClr")),this.HeaderForeColor=o.e.rgbColor(o.f.SelectSingleNodeText(this.xOptions.DocumentElement,"HeaderForeClr")),this.ButtonColor="#FFFFFF00"==this.HeaderBackColor||"#FFFFFF"==this.HeaderBackColor||"White"==this.HeaderBackColor?"#111111":this.HeaderForeColor,null!=(a=o.e.rgbColor(o.f.SelectSingleNode(this.xOptions.DocumentElement,"BodyBackClr")))&&"#FFFFFF00"!=a.innerHTML&&(this.BodyBackColor=o.e.rgbColor(a.innerHTML)),a=o.f.SelectSingleNode(this.xOptions.DocumentElement,"HideHeader"),this.ShowHeader=null==a||"1"!=a.innerHTML,null!=(a=o.f.SelectSingleNode(this.xOptions.DocumentElement,"WIDGETCHART"))&&(this.IsWidgetChart=!0,null!=(a=o.f.SelectSingleNode(this.xOptions.DocumentElement,"WidgetChartPrevious"))&&(this.PrevData=parseInt(a.innerHTML)),null!=(a=o.f.SelectSingleNode(this.xOptions.DocumentElement,"WidgetChartPreviousFilter"))&&(this.PrevDataFilter=parseInt(a.innerHTML))),null!=(a=o.f.SelectSingleNode(this.xOptions.DocumentElement,"BackColor"))&&""!=a.innerHTML&&(e.BackColor=o.e.rgbColor(a.innerHTML),"#FFFFFF"!=e.BackColor&&"#FFFFFF00"!=e.BackColor&&(this.ShowBorder=!1)),null!=(a=o.f.SelectSingleNode(this.xOptions.DocumentElement,"RowHeight"))&&(e.RowHeightXML=a.innerHTML),a=o.e.rgbColor(o.f.SelectSingleNode(this.xOptions.DocumentElement,"PointsColor")),this.PointsColor=null!=a?a.innerHTML:"#777777"}else{var r=i.split("~");r.length>1&&(this.HeaderBackColor=o.e.rgbColor(r[0]),this.HeaderForeColor=o.e.rgbColor(r[1]),this.ButtonColor="#FFFFFF00"==this.HeaderBackColor||"#FFFFFF"==this.HeaderBackColor||"White"==this.HeaderBackColor?"#111111":r[1],r.length>2&&"#00FFFFFF"!=r[2]&&(this.BodyBackColor=o.e.rgbColor(r[2])),this.ShowHeader=!(r.length>3&&"1"==r[3]),r.length>4&&"WIDGETCHART"==r[4]&&(this.IsWidgetChart=!0,r.length>5&&""!=r[5]&&(this.PrevData=parseInt(r[5]))),r.length>6&&""!=r[6]&&(e.BackColor=o.e.rgbColor(r[6]),"#FFFFFF"!=e.BackColor&&"#FFFFFF00"!=e.BackColor&&(this.ShowBorder=!1)),r.length>7&&""!=r[7]&&(this.PointsColor=o.e.rgbColor(r[7])))}this.PrevRow=this.Row,this.PrevColumn=this.Column,this.PrevRowSpan=this.RowSpan,this.PrevColumnSpan=this.ColumnSpan,this.Screen=[],this.ReportID=parseInt(t.ReportID),0==this.TypeID?this.Visible=!1:2==this.TypeID&&this.IsWidgetChart?this.Visible=!0:this.ReportID>0?(this.Visible=!0,this.PrintVisible=!1,this.ExportVisible=!1):this.Visible=!1}},{key:"DBPanel_1_Async",value:function(){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,i,a,r,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:2==this.TypeID&&this.IsWidgetChart?(this.Visible=!0,this.PrintVisible=!0,this.ExportVisible=!0,this.Chart=new P,this.Chart.RevenUChartViewModel_1(this,null,this.dr),this.ScreenTemp.push(this.Chart),"My Salary"==this.Chart.drChartDefn.ReportName&&(this.EmpWidgetTypeID=101)):this.ReportID>0&&(this.Visible=!0,this.PrintVisible=!1,this.ExportVisible=!1,1==this.TypeID?(this.Report=new C.ReportViewModel,207==this.ReportID||307==this.ReportID||306==this.ReportID||308==this.ReportID||276==this.ReportID||310==this.ReportID?(this.EmpWidgetTypeID=this.ReportID,this.Report.ReportViewModel_2(this.ReportID,y.e.DashBoard,this.dr.ReportDefn,this,null,s.a.SessionManager.iEmployee)):this.Report.ReportViewModel_2(this.ReportID,y.e.DashBoard,this.dr.ReportDefn,this,null),this.Report.SearchVisibility=this.Filter,this.ScreenTemp.push(this.Report),this.FilterVisibility=!0,this.PrintVisible=!0,this.ExportVisible=!0,this.PrintVisible=s.a.SessionManager.HideUnathorizedAccess?this.Report.ButtonPrint.Visible:this.Report.ButtonPrint.Enable,this.ExportVisible=s.a.SessionManager.HideUnathorizedAccess?this.Report.ButtonExport.Visible:this.Report.ButtonExport.Enable):2==this.TypeID?((t=new C.ReportViewModel).ReportViewModel_2(this.ReportID,y.e.LoadDataOnly,this.dr.ReportDefn,this,null),this.Chart=new P,this.Chart.RevenUChartViewModel_1(this,t,this.dr),this.ScreenTemp.push(this.Chart),this.PrintVisible=!0,this.ExportVisible=!0):5==this.TypeID?((i=new C.ReportViewModel).ReportViewModel_2(this.ReportID,y.e.LoadDataOnly,this.dr.ReportDefn,this,null),this.KPI=new q(i,this.dr),this.ScreenTemp.push(this.KPI)):6==this.TypeID?72==this.ReportID?(this.EmpWidgetTypeID=this.ReportID,this.QuickViewDetails=new te.a,(a=this.QuickViewDetails.QuickViewScreenViewModel_2(50051,s.a.SessionManager.iEmployee,-1))&&a.then((function(){n.ScreenTemp.push(n.QuickViewDetails)}))):(this.EmpWidgetTypeID=this.ReportID,this.Widget=new M,this.Widget.WidgetViewModel_1(this,this.ReportID,this.dr.WidgetXML.toString()),this.ScreenTemp.push(this.Widget)):3==this.TypeID?(this.RefreshVisibility=!1,this.RegenerateVisibility=!1,this.GetAllDataVisibility=!1,this.AddOnID=this.ReportID,this.AddOnID>0&&(this.RefreshVisibility=!0,this.AddOn=new z(this.AddOnID),this.ScreenTemp.push(this.AddOn))):4==this.TypeID?(this.RefreshVisibility=!1,this.RegenerateVisibility=!1,this.GetAllDataVisibility=!1,r=new G(this.ReportID),this.BodyBackColor=r.BgColor,this.ScreenTemp.push(r)):7==this.TypeID&&(this.RefreshVisibility=!1,this.RegenerateVisibility=!1,this.GetAllDataVisibility=!1,this.ReportID>0&&this.ScreenTemp.push(new $.BulkEditViewModel(this.ReportID,this)))),2==this.TypeID&&null!=this.Chart?this.Chart.IsWidgetChart?this.Chart.RefreshChart():this.Chart.Report.Refresh():5==this.TypeID&&null!=this.KPI?this.KPI.Report.Refresh():6==this.TypeID&&null!=this.Widget&&this.Widget.Refresh(),this.ShowLoading=!1,this.AutoRefresh&&this.Visible&&(this.timer=new o.d,this.timer.Interval=this.RefreshRate<1?1e4*this.RefreshRate:60*this.RefreshRate*1e3,this.timer.Elapsed(this,"timer_Elapsed"),this.timer.Enabled=!0);case 2:case"end":return e.stop()}}),e,this)})))}},{key:"OnButtonClick",value:function(e){var t=this;"Regenerate"==e?1==this.TypeID?this.Report.OnButtonClick("Regenerate"):2==this.TypeID?this.Chart.IsWidgetChart?this.Chart.ShowWidgetFilter=!0:this.Chart.Report.OnButtonClick("Regenerate"):3==this.TypeID||5==this.TypeID&&this.KPI.Report.OnButtonClick("Regenerate"):"Refresh"==e?1==this.TypeID?this.Report.Refresh():2==this.TypeID?this.Chart.IsWidgetChart?this.Chart.RefreshChart():this.Chart.Report.Refresh():3==this.TypeID?this.AddOn.Refresh():5==this.TypeID&&this.KPI.Report.Refresh():"GetAllData"==e?1==this.TypeID?(this.Report.TopRecords=0,this.Report.Refresh()):2==this.TypeID?this.Chart.IsWidgetChart?this.Chart.RefreshChart():(this.Chart.Report.TopRecords=0,this.Chart.Report.Refresh()):3==this.TypeID||5==this.TypeID&&(this.KPI.Report.TopRecords=0,this.KPI.Report.Refresh()):"Filter"==e?1==this.TypeID&&(this.Report.ShowExport=!1,this.Report.ShowReportFilter?(this.Report.ShowReportFilter=!1,this.Report.ShowRightPanel=!1):(this.Report.ShowReportFilter=!0,this.Report.ShowRightPanel=!0)):"Maximize"==e&&(this.IsMaximize=!this.IsMaximize,setTimeout((function(){null!=t.Chart?t.Chart.TabularDataObj.refreshUI():null!=t.AddOn?t.AddOn.refreshUI():7==t.TypeID?t.ScreenTemp.length>0&&t.ScreenTemp[0]instanceof $.BulkEditViewModel&&t.ScreenTemp[0].EditGrid.refreshUI():1==t.TypeID&&"ReportViewModel"==t.ScreenTemp[0].ClassName&&t.ScreenTemp[0].angularGrid.resizerService.resizeGrid()}),50))}},{key:"timer_Elapsed",value:function(e,t){this.timer.Enabled=!1,s.a.page.isActiveTab(this.Parent)&&(1==this.TypeID?this.Report.LoadingVisibility||this.Report.process.IsBusy||this.Report.Refresh(!1):2==this.TypeID?this.Chart.Report.Refresh():3==this.TypeID?this.AddOn.Refresh():5==this.TypeID?this.KPI.Report.Refresh():6==this.TypeID&&this.Widget.Refresh()),this.timer.Enabled=!0}},{key:"IsReportWidget",get:function(){return 1==this.TypeID&&!o.e.IsEmpty(this.Report)&&(276==this.Report.ReportID||304==this.Report.ReportID||305==this.Report.ReportID||310==this.Report.ReportID||307==this.Report.ReportID||306==this.Report.ReportID||308==this.Report.ReportID)||6==this.TypeID&&(72==this.EmpWidgetTypeID||26==this.EmpWidgetTypeID||60==this.EmpWidgetTypeID)||2==this.TypeID&&101==this.EmpWidgetTypeID}},{key:"ReportFilterText",get:function(){return null!=this.Report?this.Report:null!=this.Chart?this.Chart.Report:null!=this.KPI?this.KPI.Report:null}}]),e}(),re=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){var a;_classCallCheck(this,i),(a=t.call(this)).Parent=e,a.tree=[],a.CostCenterFilters=[],a.CostCenters=new p.e(0),a.CostCenters.Label=s.a.GetResource("Reports_SelectCostCenter"),a.CostCenters.LblWidth="140",a.CostCenters.SelectionChangedCommand.Subscribe(_assertThisInitialized(a),"OnCostCenterChange");var r=new u.a;r.IsReportViewScreen=!0,a.DateField=new c.a(r),a.DateField.ID="DateField";var o=new D.a;return a.DateField.Caption.Text="Date",a.DateField.CDGDO=o,a.DateField.CDGDO.DataType="DATE",a.DateField.Condition.SelectedValue="Between",a.DateField.Condition.SetSelectedItem(a.DateField.Condition.SelectedValue),a.DateField.OnConditionSelectionChanged(a.DateField.Condition.SelectedValue),a.DateField.Member.Visible=!1,a.DateField.DeleteVisible=!1,a}return _createClass(i,[{key:"RefreshCostCenterItems",value:function(){var e=this;this.CostCenters.CrFilter!=this.Parent.DashBoardID&&(this.CostCenters.Items.Clear(),this.CostCenters.SelectedIndex=-1,this.CostCenterFilters.Clear(),null!=this.tree&&this.tree.Clear()),this.CostCenters.CrFilter=this.Parent.DashBoardID,this.Parent.DBList.forEach((function(t){1==t.TypeID&&null!=t.Report?null!=t.Report.oReportDialog?e.FillCostCenterItems(t.Report.oReportDialog.CostCenters):null!=t.Report.Filter&&e.FillCostCenterItems(t.Report.Filter.CostCenters):2==t.TypeID&&null!=t.Chart&&(t.Chart.IsWidgetChart||(null!=t.Chart.Report.oReportDialog?e.FillCostCenterItems(t.Chart.Report.oReportDialog.CostCenters):null!=t.Chart.Report.Filter&&e.FillCostCenterItems(t.Chart.Report.Filter.CostCenters)))}))}},{key:"FillCostCenterItems",value:function(e){var t=this;e.Items.forEach((function(e){t.CostCenters.Items.find((function(t){return t.Value==e.Value&&t.Parent==e.Parent}))||t.CostCenters.Items.push(e)}))}},{key:"OnButtonClick",value:function(e){var t=this;"FilterCancel"==e?this.Parent.ShowReportFilter=!1:"FilterOK"==e&&(this.Parent.DBList.forEach((function(e){1==e.TypeID&&null!=e.Report?(e.Report.FromDatePicker.Date=t.DateField.FromDatePicker.Date,e.Report.ToDatePicker.Date=t.DateField.ToDatePicker.Date,t.SetCCFilters(e.Report.oReportDialog?e.Report.oReportDialog:e.Report.Filter),e.Report.OnButtonClick("OK_CLICK")):2==e.TypeID&&null!=e.Chart?e.Chart.IsWidgetChart?(e.Chart.FromDate.Date=t.DateField.FromDatePicker.Date,e.Chart.ToDate.Date=t.DateField.ToDatePicker.Date):(e.Chart.Report.FromDatePicker.Date=t.DateField.FromDatePicker.Date,e.Chart.Report.ToDatePicker.Date=t.DateField.ToDatePicker.Date,t.SetCCFilters(e.Chart.Report.oReportDialog?e.Chart.Report.oReportDialog:e.Chart.Report.Filter)):5==e.TypeID&&null!=e.KPI&&(e.KPI.Report.FromDatePicker.Date=t.DateField.FromDatePicker.Date,e.KPI.Report.ToDatePicker.Date=t.DateField.ToDatePicker.Date,t.SetCCFilters(e.KPI.Report.oReportDialog?e.KPI.Report.oReportDialog:e.KPI.Report.Filter))})),this.Parent.ShowReportFilter=!1,this.Parent.ApplyDBFilters())}},{key:"SetCCFilters",value:function(e){this.CostCenterFilters.forEach((function(t){if(t.SelectedNodes.length>0&&e.CostCenters.Items.find((function(e){return parseInt(e.Value)==t.CostCenterID}))){var i=e.CostCenterFilters.find((function(e){return e.CostCenterID==t.CostCenterID}));null!=i?(i.SelectedNodes=t.SelectedNodes,i.SelectedNodesTag=t.SelectedNodesTag):((i=new ee.a(t.CostCenterID,t.LookupTypeID>0?t.LookupTypeID.toString():"",t.CostCenter,e)).SelectedNodes=t.SelectedNodes,i.SelectedNodesTag=t.SelectedNodesTag,e.CostCenterFilters.push(i)),"StaticReportFilterViewModel"==e.ClassName&&e.TreeCCID==t.CostCenterID&&(e.DefaultTreeSelectedNodes=i.SelectedNodes)}}))}},{key:"OnCostCenterChange",value:function(e){if(!o.e.IsEmpty(this.CostCenters.SelectedValue)&&(0==this.tree.length||this.tree[0].CostCenterID!=parseInt(this.CostCenters.SelectedValue))){var t=0;null==this.CostCenters.SelectedItem||o.e.IsEmpty(this.CostCenters.SelectedItem.Parent)||(t=o.e.Int(this.CostCenters.SelectedItem.Parent)),this.LoadCostCenterTree(parseInt(this.CostCenters.SelectedValue),t,0,null)}}},{key:"LoadCostCenterTree",value:function(e,t,i,a){this.tree.Clear();var r,n="";if(50002==e&&"True"==s.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==s.a.SessionManager.Preferences["LW Reports"]&&(n=o.e.IsEmpty(s.a.SessionManager.LocationWhere)?"NodeID IN (-1234)":"NodeID IN ("+s.a.SessionManager.LocationWhere+")"),null==a)for(var l=0;l<this.CostCenterFilters.length;l++){var u=this.CostCenterFilters[l];if(u.CostCenterID==e&&u.LookupTypeID==t){a=u.SelectedNodes;break}}44==e&&t>0&&(n="A.LookupType="+t),r=new h.a,null==a?r.TreeViewModel_5(e,this,i,n,""):r.TreeViewModel_6(e,this,i,n,a,""),r.LookupTypeID=t,r.HeaderVisiblity=!1,r.OnNodeSelected||(r.OnNodeSelected=new d.b,r.OnNodeSelected.Subscribe(this,"OnNodeSelected")),this.tree.push(r)}}]),i}(l.a)}}]);
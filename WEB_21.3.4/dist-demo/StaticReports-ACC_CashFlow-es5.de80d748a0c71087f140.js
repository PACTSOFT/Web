function _defineProperties(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var o,n=_getPrototypeOf(e);if(t){var i=_getPrototypeOf(this).constructor;o=Reflect.construct(n,arguments,i)}else o=n.apply(this,arguments);return _possibleConstructorReturn(this,o)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{LOar:function(e,t,o){"use strict";o.r(t),o.d(t,"ACC_CashFlow",(function(){return C}));var n=o("Do2H"),i=o("Lp6j"),l=o("vTM8"),a=o("1xwR"),s=o("mvPR"),r=o("uMy8"),h=o("0/4Q"),u=o("MCLT"),c=function e(){_classCallCheck(this,e)},d=function(e){return e[e.None=0]="None",e[e.MonthWise=1]="MonthWise",e[e.QtrWise=4]="QtrWise",e[e.HalfYearWise=5]="HalfYearWise",e[e.YearWise=3]="YearWise",e[e.TagWise=2]="TagWise",e}({}),C=function(e){_inherits(o,e);var t=_createSuper(o);function o(e){var n;return _classCallCheck(this,o),(n=t.call(this,e)).Show=d.None,n.k=0,n.dtMonthBF=null,n.dtMonthTrans=null,n.dtMonthColsing=null,n.colSpanBF=-1,n.colTotalIndex=-1,n.colMonthIndex=-1,n.CntMonths=0,n.YTDIndex=0,n.YTD_LYIndex=0,n.BAL_LYIndex=0,n.ForeignCurrencyID=0,n.CurrencyType=0,n.ShowYearWise=!1,n.AllowFromDateFilter=!1,n.dsYTD=null,n.dsBAL_LY=null,n.dsYTD_LY=null,n.xCFDoc=new i.f,n.dbl=0,n.dblValue=0,n.SectionHeaderAppearance=new s.a,n.SectionHeadingAppearance=new s.a,n.MonthColumns=new Array,n.lstTags=new Array,n.YearSlots=new l.a,n.QtrSlot=new l.a,n.AllMnQtrSlot=new l.a,n.LYTDfldDict=new l.a,n.iLoop=0,n.YearfldDict=new l.a,n.RatioComplete1Promise=[],n.ShowTotal=!1,n.SectionRow=null,n.HeaderRow=null,n.SectionHeaderAppearance.IsBold=!0,n.SectionHeaderAppearance.FontSize=14,n.SectionHeaderAppearance.ForeColor="#FF00465A",n.SectionHeaderAppearance.BackColor="White",n.SectionHeaderAppearance.FontFamilyName="Arial",n.SectionHeadingAppearance.IsBold=!1,n.SectionHeadingAppearance.FontSize=12,n.SectionHeadingAppearance.ForeColor="#FF00465A",n.SectionHeadingAppearance.BackColor="White",n.SectionHeadingAppearance.FontFamilyName="Arial",n}return _createClass(o,[{key:"LoadReport",value:function(){var e=this;this.GrdRow=-1,this.AggTotal=i.e.NumArray(this.oColumns.length,2);for(var t=0;t<this.ViewModel.ColumnSource.length;t++)if("FLOAT"==this.ViewModel.ColumnSource[t].ColumnType){this.colSpanBF=t;break}for(var o=this.ViewModel.ColumnSource.length-1;o>=0;o--)if("Months"==this.ViewModel.ColumnSource[o].ID){this.colMonthIndex=o;break}for(var a=new Array,s=0;s<this.ViewModel.ColumnSource.length;s++)a.push(this.ViewModel.ColumnSource[s]);if(this.CntMonths=0,-1!=this.colMonthIndex)if(this.ViewModel.TotalCols.Clear(),this.ViewModel.GrpReportTotal.TotalCols.Clear(),this.ViewModel.AddTotalColumnsToGroup(this.ViewModel.GrpReportTotal,this.ViewModel.ReportDoc.SelectSingleNode("PactRevenURpts/PactRevenURptDef/ReportTotal/Columns")),this.ViewModel.TotalCols.Contains("Months")&&this.ViewModel.TotalCols.Remove("Months"),this.ViewModel.GrpReportTotal.TotalCols.ContainsKey("Months")&&this.ViewModel.GrpReportTotal.TotalCols.Remove("Months"),"1"!=this.ViewModel.Preferences.MonthWiseData)a.RemoveAt(this.colMonthIndex),this.colMonthIndex=-1;else{for(var h=new Date(this.ViewModel.FromDatePicker.Date.getFullYear(),this.ViewModel.FromDatePicker.Date.getMonth(),1),u=this.ViewModel.ToDatePicker.Date;h<=u;){var C=this.ViewModel.ColumnSource[this.colMonthIndex].Clone();C.ID="Y"+h.getFullYear()+"M"+h.iMonth(),C.HeaderText=h.ToString("MMM yyyy"),a.Insert(this.colMonthIndex+this.CntMonths+1,C),h=h.AddMonths(1),this.ViewModel.TotalCols.push(C.ID),this.ViewModel.GrpReportTotal.TotalCols.push(C.ID,this.colMonthIndex+this.CntMonths),this.MonthColumns.push(C),this.CntMonths++}a.RemoveAt(this.colMonthIndex)}this.YTDIndex=this.YTD_LYIndex=this.BAL_LYIndex=-1;for(var D=a.length-1;D>=0;D--)"Balance"==a[D].ID?this.colTotalIndex=D:"YTD"==a[D].ID?(this.YTDIndex=D,this.LYTDfldDict.push(a[D].ID,null)):"LastYearBalance"==a[D].ID||"LastYearPeriodValue"==a[D].ID?(this.BAL_LYIndex=D,this.LYTDfldDict.push(a[D].ID,null)):"LastYearValue"==a[D].ID?this.LYTDfldDict.push(a[D].ID,null):"LastYearYTD"==a[D].ID&&(this.YTD_LYIndex=D,this.LYTDfldDict.push(a[D].ID,null));this.AggTotal=i.e.NumArray(a.length,2),this.ViewModel.ReportColumns=a,this.oColumns=this.ViewModel.ReportColumns,this.ViewModel.IsTotalColsAdded=!0,this.ViewModel.totals=i.e.NumArray(this.oColumns.length,4),this.dtYearStartMonth=new Date(Date.Today().getFullYear(),n.a.SessionManager.AccountingFromMonth-1,1),this.dtYearStartMonth>Date.Today()&&(this.dtYearStartMonth=this.dtYearStartMonth.AddYears(-1));try{if(this.PDCInclude=!(!this.ViewModel.Preferences.ContainsKey("IncludePDCs")||"1"!=this.ViewModel.Preferences.IncludePDCs),this.IncludeTerminatedPDC=!this.ViewModel.Preferences.ContainsKey("IncludeTerminatedPDC")||"0"!=this.ViewModel.Preferences.IncludeTerminatedPDC,this.UnPostedDocsInclude=!(!this.ViewModel.Preferences.ContainsKey("IncludeUnPostedDocs")||"1"!=this.ViewModel.Preferences.IncludeUnPostedDocs),this.UnPostedDocsList=this.UnPostedDocsInclude&&this.ViewModel.Preferences.ContainsKey("IncludeUnPostedDocsList")?this.ViewModel.Preferences.IncludeUnPostedDocsList:"",this.CurrencyType=0,this.ForeignCurrencyID=0,this.ViewModel.Preferences.ContainsKey("ForeignCurrency")){var T=new i.f;T.LoadXml("<XML>"+this.ViewModel.Preferences.ForeignCurrency+"</XML>");var p=i.f.SelectSingleNode(T.DocumentElement,"IsChecked");null!=p&&"1"==p.innerHTML&&(this.ForeignCurrencyID=parseInt(i.f.SelectSingleNode(T.DocumentElement,"Value").innerHTML))}else if(this.ViewModel.Preferences.ContainsKey("Currency")){var w=new i.f;w.LoadXml("<XML>"+this.ViewModel.Preferences.Currency+"</XML>"),this.CurrencyType=parseInt(i.f.SelectSingleNode(w.DocumentElement,"Type").innerHTML),1==this.CurrencyType?(i.e.IsEmpty(n.a.SessionManager.Preferences.DimensionwiseCurrency)||0==parseInt(n.a.SessionManager.Preferences.DimensionwiseCurrency))&&(this.CurrencyType=0):2==this.CurrencyType&&(this.ForeignCurrencyID=parseInt(i.f.SelectSingleNode(w.DocumentElement,"Value").innerHTML))}if(98==this.ViewModel.StaticReportType){var A="0";if(this.AllowFromDateFilter=!(!this.ViewModel.Preferences.ContainsKey("AllowFromDateFilter")||"1"!=this.ViewModel.Preferences.AllowFromDateFilter),this.AllowFromDateFilter&&this.ViewModel.Preferences.ContainsKey("FinalReportsShow")&&(A=this.ViewModel.Preferences.FinalReportsShow),"1"==A?this.Show=d.MonthWise:"4"==A?this.Show=d.QtrWise:"3"==A&&(this.Show=d.YearWise,this.ViewModel.oReportDialog.FromDate.Date.getFullYear()==this.ViewModel.oReportDialog.ToDate.Date.getFullYear()&&(this.ViewModel.Preferences.ContainsKey("FinalReportsShowPrevMn")||this.ViewModel.Preferences.ContainsKey("FinalReportsShowDifference")||this.ViewModel.Preferences.ContainsKey("FinalReportsShowVarPer")||(this.Show=d.None))),this.dtMain=[],this.dtColumnsMain=[],this.dtColumnsMain.push("RatioName"),this.dtColumnsMain.push("Value"),this.dtColumnsMain.push("Perc"),this.xCFDoc.LoadXml("<RatioAnalysisXml>"+this.ViewModel.Preferences.RatioAnalysisXml+"</RatioAnalysisXml>"),this.Show!=d.None)for(var M=!(!this.ViewModel.Preferences.ContainsKey("Sort")||"ASC"!=this.ViewModel.Preferences.Sort),f=new Date(this.dtYearStartMonth.getFullYear(),this.dtYearStartMonth.getMonth(),1),m=new Date(this.ViewModel.oReportDialog.FromDate.Date.getFullYear(),this.ViewModel.oReportDialog.FromDate.Date.getMonth(),1),I=1,g=this.Show==d.HalfYearWise?6:3,R="",S=!0,V=a.find((function(e){return"Value"==e.ID})),N=a.indexOf(V),y=0;m<=this.ViewModel.oReportDialog.ToDate.Date;){var v=V.Clone();if(this.Show==d.MonthWise)v.HeaderText=m.ToString("MMM yy"),v.ID="Y"+m.getFullYear()+"M"+m.iMonth(),this.YearSlots.push(v.ID,m);else if(this.Show==d.QtrWise||this.Show==d.HalfYearWise){if(S){for((m=new Date(this.ViewModel.FromDatePicker.Date.getFullYear(),n.a.SessionManager.AccountingFromMonth-1,1))>this.ViewModel.FromDatePicker.Date&&(m=m.AddYears(-1)),I=1;m.AddMonths(g)<=this.ViewModel.FromDatePicker.Date;)I++,m=m.AddMonths(g);R=1==n.a.SessionManager.AccountingFromMonth?m.getFullYear().toString():m.iMonth()>=n.a.SessionManager.AccountingFromMonth?m.getFullYear().toString()+"-"+((m.getFullYear()+1)%100).toString():(m.getFullYear()-1).toString()+"-"+(m.getFullYear()%100).toString()}else I++,(this.Show==d.QtrWise&&5==I||this.Show==d.HalfYearWise&&3==I)&&(I=1),R=1==n.a.SessionManager.AccountingFromMonth?m.getFullYear().toString():m.iMonth()>=n.a.SessionManager.AccountingFromMonth?m.getFullYear().toString()+"-"+((m.getFullYear()+1)%100).toString():(m.getFullYear()-1).toString()+"-"+(m.getFullYear()%100).toString();v.HeaderText=(this.Show==d.HalfYearWise?"H":"Q")+I+" "+R,v.ID="Y"+m.getFullYear()+"M"+m.iMonth(),this.YearSlots.push(v.ID,m),S=!1;var F=new c;F.dtStart=m,F.dtEnd=m.AddMonths(g).AddDays(-1),this.QtrSlot.push(v.ID,F);for(var L=m,Y=0;Y<g;Y++)this.AllMnQtrSlot.push(L.ToString("yyyy-M"),v.ID),L=L.AddMonths(1)}else v.HeaderText=m.ToString("yyyy"),v.ID="Y"+m.getFullYear(),this.YearSlots.push(v.ID,f),f=f.AddYears(1);this.lstTags.push(v.ID),this.dtColumnsMain.push(v.ID),++y,a.Insert(M?N+y:N+1,v),m=this.Show==d.MonthWise?m.AddMonths(1):this.Show==d.QtrWise||this.Show==d.HalfYearWise?m.AddMonths(g):m.AddYears(1)}else if(!this.AllowFromDateFilter&&this.ViewModel.Preferences.ContainsKey("ShowYearWise")){var O=new i.f;O.LoadXml("<XML>"+this.ViewModel.Preferences.ShowYearWise+"</XML>");var b=i.f.SelectSingleNode(O.DocumentElement,"IsChecked");if(null!=b&&"1"==b.innerHTML&&(this.ShowYearWise=!0,b=i.f.SelectSingleNode(O.DocumentElement,"Text"),this.CntMonths=i.e.Int(b.innerHTML),this.CntMonths<=0&&(this.ShowYearWise=!1),this.ShowYearWise)){var E=a.find((function(e){return"Value"==e.ID})),P=a.indexOf(E);a.Remove(E);var _=new Date(Date.Today().getFullYear(),n.a.SessionManager.AccountingFromMonth-1,1);_>Date.Today()&&(_=_.AddYears(-1));for(var B=!(!this.ViewModel.Preferences.ContainsKey("Sort")||"ASC"!=this.ViewModel.Preferences.Sort),k=0;k<this.CntMonths;k++){var H=E.Clone();H.HeaderText=_.ToString("yyyy"),H.ID=_.getFullYear().toString(),this.lstTags.push(H.ID),this.dtColumnsMain.push(H.ID),B?a.Insert(P,H):a.push(H),_=_.AddYears(-1)}this.ViewModel.ReportColumns=new Array,this.ViewModel.ReportColumns=a,this.oColumns=this.ViewModel.ReportColumns}}this.ViewModel.ReportColumns=a,this.oColumns=this.ViewModel.ReportColumns,this.eval=new r.b,this.fldDict=new l.a,this.YearfldDict.Clear(),this.iLoop=0;var W=i.f.SelectSingleNode(this.xCFDoc.DocumentElement,"VariablesList");this.xVarListMain=W.childNodes,this.Show!=d.None?(this.lstTags.forEach((function(t){e.YearfldDict.push(t,new l.a)})),this.YearfldDict.push("Value",new l.a),this.RatioCallBack_NotNone()):this.ShowYearWise?(this.lstTags.forEach((function(t){e.YearfldDict.push(t,new l.a)})),this.RatioCallBack_Year()):this.RatioCallBack_None()}else if(99==this.ViewModel.StaticReportType){var x;this.xCFDoc.LoadXml("<CashFlowXml>"+this.ViewModel.Preferences.CashFlowXml+"</CashFlowXml>"),this.ChunkSize=this.ViewModel.Preferences.ContainsKey("ChunkSize")?parseInt(this.ViewModel.Preferences.ChunkSize):1;var G="",U="",K=new Array,X=new Array;this.xCFDoc.DocumentElement.childNodes.forEach((function(e){for(var t=0;t<e.childNodes.length;t++)"Group"==(x=e.childNodes[t]).attributes.Type.value?X.Contains(x.attributes.ACC.value)||(G.length>0&&(G+=","),G+=x.attributes.ACC.value,X.push(x.attributes.ACC.value)):"Account"==x.attributes.Type.value&&(K.Contains(x.attributes.ACC.value)||(U.length>0&&(U+=","),U+=x.attributes.ACC.value,K.push(x.attributes.ACC.value)))}));var Q=[];Q.push(this.ViewModel.oReportDialog.FromDate.Date),Q.push(this.ViewModel.oReportDialog.ToDate.Date),Q.push(this.UnPostedDocsInclude),Q.push(this.PDCInclude),Q.push(this.IncludeTerminatedPDC),Q.push(G.toString()),Q.push(U.toString()),Q.push(-1!=this.colMonthIndex),"1"==this.ViewModel.Preferences.ShowProjections&&this.ViewModel.Preferences.ContainsKey("Documents")?Q.push(this.ViewModel.Preferences.Documents):Q.push("");var j="";this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(j=i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),Q.push(j+this.GetDimensionFilter("DCC.dcCCNID")),Q.push(n.a.SessionManager.LanguageID);var z=new l.a;if(z.push("ds",n.a.report.GetCashFlow(Q)),-1!=this.YTDIndex){var J=Q.Copy();J[0]=this.dtYearStartMonth,J[6]=!1,z.push("dsYTD",n.a.report.GetCashFlow(J))}if(-1!=this.BAL_LYIndex){var q=Q.Copy();q[0]=this.ViewModel.oReportDialog.FromDate.Date.AddYears(-1),q[1]=this.ViewModel.oReportDialog.ToDate.Date.AddYears(-1),q[6]=!1,z.push("dsBAL_LY",n.a.report.GetCashFlow(q))}if(-1!=this.YTD_LYIndex){var Z=Q.Copy();Z[0]=this.dtYearStartMonth.AddYears(-1),Z[1]=this.ViewModel.oReportDialog.ToDate.Date.AddYears(-1),Z[6]=!1,z.push("dsYTD_LY",n.a.report.GetCashFlow(Z))}Promise.all(z.values).then((function(t){var o;e.ds=t[0],e.dvAcc=e.dvAccTable=e.ds.Tables[0],e.dvAccColumns=e.ds.Columns[0],e.dvGroup=e.dvGroupTable=e.ds.Tables[1],e.dvGroupColumns=e.ds.Columns[1],-1!=e.YTDIndex&&(o=z.keys.indexOf("dsYTD"),e.dsYTD=t[o],e.ds.Columns[0].push("YTD"),e.ds.Columns[1].push("YTD")),-1!=e.BAL_LYIndex&&(o=z.keys.indexOf("dsBAL_LY"),e.dsBAL_LY=t[o],e.ds.Columns[0].push("LastYearBalance"),e.ds.Columns[1].push("LastYearBalance")),-1!=e.YTD_LYIndex&&(o=z.keys.indexOf("dsYTD_LY"),e.dsYTD_LY=t[o],e.ds.Columns[0].push("LastYearYTD"),e.ds.Columns[1].push("LastYearYTD")),e.AddMonthColumns(e.ds.Tables[0],e.ds.Columns[0]),e.AddMonthColumns(e.ds.Tables[1],e.ds.Columns[1]),e.dvBills=e.dvPaymentTerms=null,e.ds.Tables.length>=4&&(e.dvBills=e.dvBillsTable=e.ds.Tables[2],e.dvPaymentTerms=e.dvPaymentTermsTable=e.ds.Tables[3]),e.xCFDoc.DocumentElement.childNodes.forEach((function(t){e.AddRows(t)})),e.AddSectionHeadingTotal(1,!0),e.ViewModel.Preferences.ContainsKey("DontShowCashFlowData")&&"1"==e.ViewModel.Preferences.DontShowCashFlowData?e.ViewModel.process_RunWorkerCompleted():e.GetCashFlowData(j).then((function(t){var o=t.Tables[0];e.dtMonthBF=e.dtMonthTrans=e.dtMonthColsing=null,-1!=e.colMonthIndex&&(e.dtMonthBF=o.ToTable(!0,["AccountID","Particulars"]),e.dtMonthTrans=e.dtMonthBF.Copy(),e.dtMonthColsing=e.dtMonthBF.Copy()),e.AddCFBalance(o,e.dtMonthTrans,"Trans","Change In Cash / Bank / BankCC"),e.AddCFBalance(o,e.dtMonthBF,"Opening","Opening"),e.AddCFBalance(o,e.dtMonthColsing,"Closing","Closing"),e.ViewModel.process_RunWorkerCompleted()}))}))}}catch($){return void Logger.ErrorLog("ACC_CashFlow::Error LoadReport ",$)}}},{key:"RatioCallBack_None",value:function(){var e=this;if(this.iLoop>=this.xVarListMain.length)this.RatioCallBack_Complete1();else{var t=this.xVarListMain[this.iLoop],o=new r.c;o.setFieldDetails(t.attributes.Name.value,2,1,"",1,!1,!1),i.f.SelectSingleNode(t,"Nodes"),this.GetVariableValue(t).then((function(n){o.setFieldValue(null!=n?parseFloat(n[0].Balance):0),e.fldDict.push(t.attributes.Name.value,o),e.iLoop++,e.RatioCallBack_None()}))}}},{key:"RatioCallBack_NotNone",value:function(){var e=this;if(this.iLoop>=this.xVarListMain.length)this.RatioCallBack_Complete1();else{var t=this.xVarListMain[this.iLoop];i.f.SelectSingleNode(t,"Nodes").innerHTML.length>0&&this.GetVariableValue(t).then((function(o){e.dbl=0;var n=new r.c;n.setFieldDetails(t.attributes.Name.value,2,1,"",0,!1,!1),e.YearfldDict.Value.push(t.attributes.Name.value,n);var l=null!=i.f.SelectSingleNode(t,"CurrentYear")?parseInt(i.f.SelectSingleNode(t,"CurrentYear").innerHTML):0;if(o&&o.length>0){var a=o.Compute("sum(Balance)","");null!=a&&n.setFieldValue(parseFloat(a)),e.Show==d.QtrWise?(o.Columns.push("Tag"),o.forEach((function(t){e.AllMnQtrSlot.ContainsKey(t.YrMn.toString())?t.Tag=e.AllMnQtrSlot[t.YrMn.toString()]:0==l&&(e.dbl+=parseFloat(t.Balance))}))):0==l&&o.forEach((function(t){e.lstTags.Contains(t.Tag.toString())||(e.dbl+=parseFloat(t.Balance))}))}for(var s=function(n){1==l&&(e.dbl=0);var i=new r.c;if(i.setFieldDetails(t.attributes.Name.value,2,1,"",1,!1,!1),e.YearfldDict[e.lstTags[n]].push(t.attributes.Name.value,i),o){var a=o.filter((function(t){return t.Tag==e.lstTags[n]}));a.length>0&&(e.Show==d.QtrWise?a.forEach((function(t){null!=t.Balance&&(e.dbl+=parseFloat(t.Balance))})):null!=a[0].Balance&&(e.dbl+=parseFloat(a[0].Balance)))}i.setFieldValue(e.dbl)},h=0;h<e.lstTags.length;h++)s(h);e.iLoop++,e.RatioCallBack_NotNone()}))}}},{key:"RatioCallBack_Year",value:function(){var e=this;if(this.iLoop>=this.xVarListMain.length)this.RatioCallBack_Complete1();else{var t=this.xVarListMain[this.iLoop];if(this.lstTags.length>0){var o=i.f.SelectSingleNode(t,"Nodes"),n=new r.c;n.setFieldDetails(t.attributes.Name.value,2,1,"",1,!1,!1),this.YearfldDict[this.lstTags[0]].push(t.attributes.Name.value,n),o.innerHTML.length>0&&this.GetVariableValue(t).then((function(t){if(null!=t){var o=t.filter((function(t){return t.Tag==e.lstTags[0]}));n.setFieldValue(o.length>0&&null!=o[0].Balance?parseFloat(o[0].Balance):0)}}))}for(var l=1;l<this.lstTags.length;l++){var a=new r.c;a.setFieldDetails(t.attributes.Name.value,2,1,"",1,!1,!1),this.YearfldDict[this.lstTags[l]].push(t.attributes.Name.value,a),a.setFieldValue(0)}this.iLoop++,this.RatioCallBack_Year()}}},{key:"RatioCallBack_Complete1",value:function(){var e=this;this.RatioComplete1Promise=[],this.LYTDfldDict.keys.forEach((function(t){e.dtColumnsMain.push(t),e.LYTDfldDict[t]=e.SetRationVariables(e.xVarListMain,t)})),Promise.all(this.RatioComplete1Promise).then((function(t){e.RatioCallBack_Complete2()}))}},{key:"RatioCallBack_Complete2",value:function(){var e=this,t=this.fldDict,o=this.ViewModel.oReportDialog.DefaultProperties.find((function(e){return e instanceof h.b&&"RatioList"==e.DBColumnName}));for(i.f.SelectSingleNode(this.xCFDoc.DocumentElement,"RatiosList").childNodes.forEach((function(n){if(o.Items[0].IsChecked||o.Items.filter((function(e){return e.Name==n.attributes.Name.value&&e.IsChecked})).length>0){var i={};if(i.RatioName=n.attributes.Name.value,null!=n.attributes.Perc&&(i.Perc="1"),n.attributes.Formula.value.length>0)try{e.Show!=d.None||e.ShowYearWise?e.YearfldDict.forEach((function(o){t=o.Value,i[o.Key]=e.eval.EvaluateExpression(n.attributes.Formula.value,t).toString()})):i.Value=e.eval.EvaluateExpression(n.attributes.Formula.value,t).toString(),e.LYTDfldDict.keys.forEach((function(o){t=e.LYTDfldDict[o],i[o]=e.eval.EvaluateExpression(n.attributes.Formula.value,t).toString()}))}catch(l){}e.dtMain.push(i)}})),this.ViewModel.ReportData=this.dtMain,this.ViewModel.ReportDataColumns=this.dtColumnsMain,this.ViewModel.ConstructFormulaFields(!0),this.k=0;this.k<this.dtMain.length;this.k++){this.row=this.NewReportRow();for(var n=0;n<this.oColumns.length;n++)this.dtColumnsMain.Contains(this.oColumns[n].ID)&&(this.ViewModel.SetCellValue(this.dtMain[this.k][this.oColumns[n].ID],this.oColumns[n].DataFormat,this.oColumns[n].ColumnType,this.row.Cells[n]),n>0&&null!=this.dtMain[this.k].Perc&&!i.e.IsEmptySpace(this.row.Cells[n].Text)&&(this.row.Cells[n].Text=this.row.Cells[n].Text+"%"));this.ViewModel.addRow(this.row)}this.ViewModel.process_RunWorkerCompleted()}},{key:"LoadReportWithPostFilters",value:function(e){}},{key:"GetCashFlowData",value:function(e){var t,o,i="",l="",a="",s="",r="",h="",u="",c="",d="";this.ForeignCurrencyID>0?(t="AmountFC",o=" AND ACC.CurrencyID="+this.ForeignCurrencyID):(t=1==this.CurrencyType?"AmountBC":"Amount",o="");var C=this.GetDimensionFilter("DCC.dcCCNID");if((e.length>0||C.length>0)&&(l=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.AccDocDetailsID=ACC.AccDocDetailsID "+C+e,a=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=ACC.InvDocDetailsID "+C+e),-1!=this.colMonthIndex&&(h=",'Y'+CONVERT(NVARCHAR,yy)+'M'+ CONVERT(NVARCHAR,mm) Mn",u=",0 yy, 0 mm",c=",yy,mm",d=",YEAR(ACC.DocDate) yy, MONTH(ACC.DocDate) mm"),r="DocDate<@From",this.PDCInclude){var D="(ACC.StatusID=370 OR ACC.StatusID=439"+(this.IncludeTerminatedPDC?" OR ACC.StatusID=452":"")+")";this.UnPostedDocsInclude?(s=" AND ACC.DocumentType<>16 AND (\n"+D+" OR (ACC.DocumentType<>14 AND ACC.DocumentType<>19))",r+=" AND ("+D+" OR (ACC.DocumentType<>14 AND ACC.DocumentType<>19))"):(s=" AND ACC.DocumentType<>16 AND (\n"+D+" OR (ACC.DocumentType<>14 AND ACC.DocumentType<>19 AND (ACC.StatusID=369 or ACC.StatusID=429)))",r+=" AND ("+D+" OR (ACC.DocumentType<>14 AND ACC.DocumentType<>19 AND (ACC.StatusID=369 or ACC.StatusID=429)))")}else s=" AND ACC.DocumentType NOT IN (16,14,19)",r+=" AND ACC.DocumentType<>14 AND ACC.DocumentType<>19",this.UnPostedDocsInclude||(s+=" AND (ACC.StatusID=369 or ACC.StatusID=429)",r+=" AND (ACC.StatusID=369 or ACC.StatusID=429)");return i+="DECLARE @From FLOAT,@To FLOAT,@AccountID BIGINT\nSET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))\n\nSELECT A.AccountID,MAX(A.AccountName) Particulars,SUM(OP_Dr)-SUM(OP_Cr) Opening,SUM(TR_Dr)-SUM(TR_Cr) Trans"+h+"\nFROM (",i+="\n--Opening Dr\nSELECT DebitAccount AccountID"+u+",ACC."+t+" OP_Dr,0 OP_Cr,0 TR_Dr,0 TR_Cr\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+l+"\nWHERE (ACC.DocumentType=16 OR ("+r+"))"+o+"\nUNION ALL--Opening Cr\nSELECT CreditAccount AccountID"+u+",0 OP_Dr,ACC."+t+" OP_Cr,0 TR_Dr, 0 TR_Cr\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+l+"\nWHERE (ACC.DocumentType=16 OR ("+r+"))"+o+"\nUNION ALL--Transaction Dr\nSELECT DebitAccount AccountID"+d+",0 OP_Dr,0 OP_Cr,"+t+" TR_Dr,0 TR_Cr\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+l+"\nWHERE (DocDate BETWEEN @From AND @To)"+s+o+"\nUNION ALL--Transaction Cr\nSELECT CreditAccount AccountID"+d+",0 OP_Dr,0 OP_Cr,0 TR_Dr,"+t+" TR_Cr\nFROM ACC_DocDetails ACC  WITH(NOLOCK)"+l+"\nWHERE (DocDate BETWEEN @From AND @To)"+s+o,a.length>0&&(i+="\n--INEVENTORY DATA\nUNION ALL--Opening Dr\nSELECT DebitAccount AccountID"+u+",ACC."+t+" OP_Dr,0 OP_Cr,0 TR_Dr,0 TR_Cr\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+a+"\nWHERE (ACC.DocumentType=16 OR ("+r+"))"+o+"\nUNION ALL--Opening Cr\nSELECT CreditAccount AccountID"+u+",0 OP_Dr,ACC."+t+" OP_Cr,0 TR_Dr, 0 TR_Cr\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+a+"\nWHERE (ACC.DocumentType=16 OR ("+r+"))"+o+"\nUNION ALL--Transaction Dr\nSELECT DebitAccount AccountID"+d+",0 OP_Dr,0 OP_Cr, "+t+" TR_Dr,0 TR_Cr\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+a+"\nWHERE (DocDate BETWEEN @From AND @To)"+s+o+"\nUNION ALL--Transaction Cr\nSELECT CreditAccount AccountID"+d+",0 OP_Dr,0 OP_Cr,0 TR_Dr, "+t+" TR_Cr\nFROM ACC_DocDetails ACC  WITH(NOLOCK)"+a+"\nWHERE (DocDate BETWEEN @From AND @To)"+s+o),i+=") AS ACC INNER JOIN ACC_Accounts A WITH(NOLOCK) ON A.AccountID=ACC.AccountID\nGROUP BY A.AccountTypeID,A.AccountID,A.IsGroup,A.TB_INT"+c+"\nHAVING A.AccountID>1",i+=" AND A.AccountTypeID IN (1,2,3) AND A.IsGroup=0",i+=" Order By A.AccountTypeID,Particulars",n.a.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,i.toString())}},{key:"AddMonthColumns",value:function(e,t){for(var o=new Date(this.ViewModel.FromDatePicker.Date.getFullYear(),this.ViewModel.FromDatePicker.Date.getMonth(),1),n=this.ViewModel.ToDatePicker.Date;o<=n;)t.push("Y"+o.getFullYear()+"M"+o.iMonth()),o=o.AddMonths(1)}},{key:"AddRows",value:function(e){var t=this;if(0!=e.childNodes.length){var o;this.row=this.NewReportRow_2(s.f.Header,this.SectionHeaderAppearance),this.row.LevelNo=1,this.row.IsGroup=!0,this.row.IsExpanded=!0,this.row.Cells[0].Text=e.attributes.Caption.value,this.row.Cells[0].ColSpan=this.oColumns.length,this.SectionRow=this.row,this.ViewModel.addRow(this.row),this.ShowTotal=!1;var n,l,a,r,h,u,c,d,C,D=0;this.HeaderRow=null;for(var T=0;T<e.childNodes.length;T++)if("Heading"==(o=e.childNodes[T]).attributes.Type.value)this.AddSectionHeadingTotal(3,this.ShowTotal),this.row=this.NewReportRow_2(s.f.SubReportHeader,this.GrossTotalAppearance),this.row.IsGroup=!0,this.row.IsExpanded=!0,this.row.LevelNo=2,this.row.Parent=this.SectionRow,this.HeaderRow=this.row,this.row.Cells[0].Text="  "+o.attributes.Heading.value,this.row.Cells[0].ColSpan=this.oColumns.length,this.ViewModel.addRow(this.row),this.ShowTotal="1"==o.attributes.Total.value;else{if(this.row=this.NewReportRow(),this.row.LevelNo=3,this.row.Parent=null==this.HeaderRow?this.SectionRow:this.HeaderRow,a=o.attributes.ACC.value,this.row.NodeID=parseInt(a),"Group"==o.attributes.Type.value?(C=1,h=u=this.dvGroup,c=this.dvGroupColumns):(C=0,h=u=this.dvAcc,c=this.dvAccColumns),(h=u.filter((function(e){return e.AccountID==a}))).length>0){if(D=0,null!=this.dvBills){this.dvBills=this.dvBillsTable.filter((function(e){return e.AccountID==a}));for(var p=function(e){t.dvPaymentTerms=t.dvPaymentTermsTable.filter((function(o){return o.VoucherNo==t.dvBills[e].DocNo})),t.dvPaymentTerms.length>0?(n=Math.abs(parseFloat(t.dvBills[e].Paid)),l=parseFloat(t.dvBills[e].Amount),t.dvPaymentTerms.forEach((function(e){t.dbl=parseFloat(e.Amount),d=new Date(e.DueDate),t.dbl=t.dbl-n,t.dbl<0?n=-t.dbl:t.dbl>0?(n=0,l<0&&(t.dbl=-t.dbl),-1!=t.colMonthIndex?(r="Y"+d.getFullYear()+"M"+d.iMonth(),c.Contains(r)&&(t.dblValue=i.e.Double(h[0][r]),h[0][r]=t.dblValue+t.dbl),D+=t.dbl):(t.dblValue=i.e.Double(h[0].Balance),h[0].Balance=t.dblValue+t.dbl)):n=0}))):(d=new Date(t.dvBills[e].DocDate),t.dblValue=parseFloat(t.dvBills[e].Amount)+parseFloat(t.dvBills[e].Paid),-1!=t.colMonthIndex?(r="Y"+d.getFullYear()+"M"+d.iMonth(),c.Contains(r)&&(i.e.Double(h[0][r]),h[0][r]=t.dbl+t.dblValue),D+=t.dblValue):(t.dbl=i.e.Double(h[0].Balance),h[0].Balance=t.dbl+t.dblValue))},w=0;w<this.dvBills.length;w++)p(w)}if(-1!=this.colMonthIndex){var A=0;for((r=i.e.String(h[0].Mn)).length>0&&(A=parseFloat(h[0].Balance),h[0][r]=h[0].Balance);h.length>1;)(r=i.e.String(h[1].Mn)).length>0&&(A+=parseFloat(h[1].Balance),h[0][r]=h[1].Balance),u.Remove(h[1]),h.Remove(h[1]);h[0].Balance=A+D}if(-1!=this.YTDIndex){var M=this.dsYTD.Tables[C].filter((function(e){return e.AccountID==a}));M.length>0&&(h[0].YTD=M[0].Balance)}if(-1!=this.BAL_LYIndex){var f=this.dsBAL_LY.Tables[C].filter((function(e){return e.AccountID==a}));f.length>0&&(h[0].LastYearBalance=f[0].Balance)}if(-1!=this.YTD_LYIndex){var m=this.dsYTD_LY.Tables[C].filter((function(e){return e.AccountID==a}));m.length>0&&(h[0].LastYearYTD=m[0].Balance)}for(var I=0;I<this.oColumns.length;I++)this.CellValue=null,c.Contains(this.oColumns[I].ID)&&(this.CellValue=h[this.k][this.oColumns[I].ID]),null!=this.CellValue&&(0==I&&(this.CellValue="    "+this.CellValue.toString()),this.ViewModel.SetCellValue(this.CellValue,this.oColumns[I].DataFormat,this.oColumns[I].ColumnType,this.row.Cells[I]),i.e.IsNum(this.CellValue)&&(this.dbl=i.e.Double(this.CellValue),this.ViewModel.totals[I][3]+=this.dbl))}this.ViewModel.ApplyKPI(this.row),this.ViewModel.addRow(this.row)}this.AddSectionHeadingTotal(3,this.ShowTotal),this.AddSectionHeadingTotal(2,!0)}}},{key:"AddSectionHeadingTotal",value:function(e,t){if(t){for(var o="",n=0;n<e-1;n++)o+="  ";3==e?(this.row=this.NewReportRow_2(s.f.ReportTotal,this.BalanceBFAppearance_Data),this.row.Parent=null==this.HeaderRow?this.SectionRow:this.HeaderRow,this.row.Cells[0].Text=o+"Total"):2==e?(this.row=this.NewReportRow_2(s.f.ReportTotal,this.GrossTotalAppearance_Data),this.row.Parent=this.SectionRow,this.row.Cells[0].Text=o+"TOTAL"):(this.row=this.NewReportRow_2(s.f.SubTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance_Data),this.row.Cells[0].Text=o+this.ViewModel.GrpReportTotal.SubTotalPrefix[0]),this.row.LevelNo=e-1,this.row.Cells[0].CellAppearance.Alignment="Left";for(var i=0;i<this.oColumns.length;i++)this.ViewModel.GrpReportTotal.TotalCols.ContainsKey(this.oColumns[i].ID)&&this.ViewModel.SetCellValue(this.ViewModel.totals[i][e],this.oColumns[i].DataFormat,"FLOAT",this.row.Cells[i]),this.ViewModel.totals[i][e-1]+=this.ViewModel.totals[i][e],this.ViewModel.totals[i][e]=0;this.ViewModel.addRow(this.row)}else for(var l=0;l<this.oColumns.length;l++)this.ViewModel.totals[l][e-1]+=this.ViewModel.totals[l][e],this.ViewModel.totals[l][e]=0}},{key:"AddCFBalance",value:function(e,t,o,n){var l=this;this.row=this.NewReportRow_2(s.f.SubReportHeader,this.GrossTotalAppearance),this.row.IsGroup=!0,this.row.IsExpanded=!0,this.row.LevelNo=1,this.HeaderRow=this.row,this.row.Cells[0].Text=n,this.row.Cells[0].ColSpan=this.oColumns.length,this.ViewModel.addRow(this.row);for(var a=-1,r=-1,h=0;h<this.oColumns.length;h++)"Particulars"==this.oColumns[h].ID?a=h:"Balance"==this.oColumns[h].ID&&(r=h);if(-1==this.colMonthIndex)for(this.k=0;this.k<e.length;this.k++)this.row=this.NewReportRow(),this.row.LevelNo=3,this.row.Parent=this.HeaderRow,-1!=a&&this.ViewModel.SetCellValue(e[this.k].Particulars,this.oColumns[a].DataFormat,this.oColumns[a].ColumnType,this.row.Cells[a]),-1!=r&&this.ViewModel.SetCellValue("Closing"==o?parseFloat(e[this.k].Opening)+parseFloat(e[this.k].Trans):e[this.k][o],this.oColumns[r].DataFormat,this.oColumns[r].ColumnType,this.row.Cells[r]),this.ViewModel.addRow(this.row);else!function(){if("Trans"==o)for(l.k=0;l.k<t.length;l.k++){var n=e.filter((function(e){return e.AccountID==t[l.k].AccountID}));l.dbl=0,n.forEach((function(e){"Y0M0"!=e.Mn.toString()&&(t[l.k][e.Mn.toString()]=e.Trans,l.dbl+=parseFloat(e.Trans))})),t[l.k].Balance=l.dbl,l.row=l.NewReportRow(),l.row.LevelNo=3,l.row.Parent=l.HeaderRow,l.row.NodeID=parseInt(t[l.k].AccountID);for(var a=0;a<l.oColumns.length;a++)l.CellValue=null,Object(u.isUndefined)(t[l.k][l.oColumns[a].ID])||(l.CellValue=t[l.k][l.oColumns[a].ID]),null!=l.CellValue&&l.ViewModel.SetCellValue(l.CellValue,l.oColumns[a].DataFormat,l.oColumns[a].ColumnType,l.row.Cells[a]);l.ViewModel.addRow(l.row)}else if("Opening"==o)for(l.k=0;l.k<t.length;l.k++){var s=e.filter((function(e){return e.AccountID==t[l.k].AccountID&&"Y0M0"==e.Mn}));l.dbl=0,s.length>0&&(l.dbl=parseFloat(s[0].Opening)),t[l.k][l.oColumns[l.colMonthIndex].ID]=l.dbl;for(var r=0;r<l.CntMonths-1;r++)l.dblValue=i.e.Double(l.dtMonthTrans[l.k][l.oColumns[l.colMonthIndex+r].ID]),l.dbl+=l.dblValue,t[l.k][l.oColumns[l.colMonthIndex+r+1].ID]=l.dbl;t[l.k].Balance=l.dbl,l.row=l.NewReportRow(),l.row.LevelNo=3,l.row.Parent=l.HeaderRow,l.row.NodeID=parseInt(t[l.k].AccountID);for(var h=0;h<l.oColumns.length;h++)l.CellValue=null,Object(u.isUndefined)(t[l.k][l.oColumns[h].ID])||(l.CellValue=t[l.k][l.oColumns[h].ID]),null!=l.CellValue&&l.ViewModel.SetCellValue(l.CellValue,l.oColumns[h].DataFormat,l.oColumns[h].ColumnType,l.row.Cells[h]);l.ViewModel.addRow(l.row)}else if("Closing"==o)for(l.k=0;l.k<t.length;l.k++){l.dbl=0;for(var c=0;c<l.CntMonths;c++)l.dbl=i.e.Double(l.dtMonthBF[l.k][l.oColumns[l.colMonthIndex+c].ID]),l.dblValue=i.e.Double(l.dtMonthTrans[l.k][l.oColumns[l.colMonthIndex+c].ID]),l.dbl=l.dbl+l.dblValue,t[l.k][l.oColumns[l.colMonthIndex+c].ID]=l.dbl;t[l.k].Balance=l.dbl,l.row=l.NewReportRow(),l.row.LevelNo=3,l.row.Parent=l.HeaderRow,l.row.NodeID=parseInt(t[l.k].AccountID);for(var d=0;d<l.oColumns.length;d++)l.CellValue=null,Object(u.isUndefined)(t[l.k][l.oColumns[d].ID])||(l.CellValue=t[l.k][l.oColumns[d].ID]),null!=l.CellValue&&l.ViewModel.SetCellValue(l.CellValue,l.oColumns[d].DataFormat,l.oColumns[d].ColumnType,l.row.Cells[d]);l.ViewModel.addRow(l.row)}}()}},{key:"SetRationVariables",value:function(e,t){var o=this,n=new l.a;return e.forEach((function(e){if(i.f.SelectSingleNode(e,"Nodes").innerHTML.length>0){var l=o.GetVariableValue(e,t).then((function(t){var o=0,i=new r.c;i.setFieldDetails(e.attributes.Name.value,2,1,"",1,!1,!1),n.push(e.attributes.Name.value,i),null!=t&&t.length>0&&(o=parseFloat(t[0].Balance)),i.setFieldValue(o)}));o.RatioComplete1Promise.push(l)}else{var a=new r.c;a.setFieldDetails(e.attributes.Name.value,2,1,"",1,!1,!1),n.push(e.attributes.Name.value,a),a.setFieldValue(0)}})),n}},{key:"GetVariableValue",value:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",l="",a=e.attributes.Name.value.toLowerCase();if("openingstock"==a||"closingstock"==a){var s="";if(this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(s=i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?"-1":this.ViewModel.oReportDialog.LocationWhere),"OpeningStock"==e.attributes.Name.value)return n.a.report.GetStockBalance(1,s,this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,this.UnPostedDocsInclude,this.CurrencyType,this.ForeignCurrencyID,this.ViewModel.IsReportDB).then((function(e){var t=e,o=[];return o.push({}),o[0].Balance=t,o}));if("ClosingStock"==e.attributes.Name.value)return n.a.report.GetStockBalance(0,s,this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,this.UnPostedDocsInclude,this.CurrencyType,this.ForeignCurrencyID,this.ViewModel.IsReportDB).then((function(e){var t=e,o=[];return o.push({}),o[0].Balance=t,o}))}else"grossprofit"==a?l="4,5,8,9":"netprofit"==a&&(l="4,5,8,9,11,12");var r="",h=i.f.SelectSingleNode(e,"Nodes");if(0==h.innerHTML.length&&0==l.length)return null;var u,c,C=h.innerHTML,D=null!=i.f.SelectSingleNode(e,"GroupNodesExists"),T=null!=i.f.SelectSingleNode(e,"CurrentYear")?parseInt(i.f.SelectSingleNode(e,"CurrentYear").innerHTML):0,p="",w="",A="";this.ForeignCurrencyID>0?(u="AmountFC",c=" AND ACC.CurrencyID="+this.ForeignCurrencyID):(u=1==this.CurrencyType?"AmountBC":"Amount",c="");var M=this.GetDimensionFilter("DCC.dcCCNID"),f="";this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(f=i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),(f.length>0||M.length>0)&&(p=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.AccDocDetailsID=ACC.AccDocDetailsID",w=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=ACC.InvDocDetailsID");var m="";0==this.UnPostedDocsList.length?m=" AND (ACC.StatusID=369 or ACC.StatusID=429)":m+=" AND ACC.StatusID IN (369,429,"+this.UnPostedDocsList+")",A=this.PDCInclude?" AND ((ACC.StatusID=370 OR ACC.StatusID=439"+(this.IncludeTerminatedPDC?" OR ACC.StatusID=452":"")+") OR (ACC.DocumentType<>14 AND ACC.DocumentType<>19"+m+"))":" AND ACC.DocumentType NOT IN (14,19)"+m;var I="";I=T>0||this.ShowYearWise||o.length>0||l.length>0?"(DocDate BETWEEN @From AND @To)":"(DocDate<=@To)",I+=M+f;var g="",R="",S="";l.length>0?(g="-",R=" join ACC_Accounts AT on AT.AccountID=T1.AccountID",S="AT.AccountTypeID IN ("+l+")"):D?(S="T1.AccountID=GTP.GTID",R=C.Contains(",")?",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID IN ("+C+") group by T.AccountID) AS GTP ":",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID="+C+" group by T.AccountID) AS GTP "):S=C.Contains(",")?"T1.AccountID IN ("+C+")":"T1.AccountID="+C;var V="",N="",y=new Date(this.ViewModel.oReportDialog.ToDate.Date.getFullYear(),n.a.SessionManager.AccountingFromMonth-1,1);y>this.ViewModel.oReportDialog.ToDate.Date&&(y=y.AddYears(-1));var v=this.AllowFromDateFilter?this.ViewModel.oReportDialog.FromDate.Date:y,F=this.ViewModel.oReportDialog.ToDate.Date;if("YTD"==o)v=y,F=this.ViewModel.oReportDialog.ToDate.Date;else if("LastYearYTD"==o)v=y.AddYears(-1),F=this.ViewModel.oReportDialog.ToDate.Date.AddYears(-1);else if("LastYearPeriodValue"==o)v=this.ViewModel.oReportDialog.FromDate.Date.AddYears(-1),F=this.ViewModel.oReportDialog.ToDate.Date.AddYears(-1);else if("LastYearValue"==o)F=(v=y.AddYears(-1)).AddYears(1).AddDays(-1);else if(this.Show==d.MonthWise)v=this.ViewModel.oReportDialog.FromDate.Date,V=",'Y'+CONVERT(NVARCHAR,YEAR(convert(datetime,ACC.DocDate)))+'M'+ CONVERT(NVARCHAR,Month(convert(datetime,ACC.DocDate))) Tag",N=",Tag";else if(this.Show==d.QtrWise||this.Show==d.HalfYearWise)v=this.ViewModel.oReportDialog.FromDate.Date,V=",CONVERT(NVARCHAR,YEAR(convert(datetime,ACC.DocDate)))+'-'+ CONVERT(NVARCHAR,Month(convert(datetime,ACC.DocDate))) YrMn",N=",YrMn";else if(this.Show==d.YearWise)v=this.ViewModel.oReportDialog.FromDate.Date,V=",'Y'+CONVERT(NVARCHAR,Year(convert(datetime,ACC.DocDate))) Tag",N=",Tag";else if(this.ShowYearWise){for(var L=1;L<this.CntMonths;)y=y.AddYears(-1),L++;v=y,V=",Year(convert(datetime,ACC.DocDate)) Tag",N=",Tag"}return r+="DECLARE @From FLOAT,@To FLOAT\nSET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+v.ToString("dd MMM yyyy")+"'))\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+F.ToString("dd MMM yyyy")+"'))\n\nSELECT "+g+"SUM(Balance) Balance"+N+" FROM (\nSELECT T1.AccountID,ISNULL(SUM(DR),0)-IsNULL(SUM(CR),0) Balance"+N+" FROM (",r+="\n--Opening Dr\nSELECT DebitAccount AccountID,ACC."+u+" DR,0 CR"+V+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+p+"\nWHERE "+I+A+c+"\nUNION ALL--Opening Cr\nSELECT CreditAccount AccountID,0 DR,ACC."+u+" CR"+V+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+p+"\nWHERE "+I+A+c,w.length>0&&(r+="\n--INEVENTORY DATA\nUNION ALL--Opening Dr\nSELECT DebitAccount AccountID,ACC."+u+" DR,0 CR"+V+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+w+"\nWHERE "+I+A+c+"\nUNION ALL--Opening Cr\nSELECT CreditAccount AccountID,0 DR,ACC."+u+" CR"+V+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+w+"\nWHERE "+I+A+c),r+=") AS T1"+R,r+=" WHERE "+S,r+=" GROUP BY T1.AccountID"+N,r+=") AS T2",N.length>0&&(r+=" GROUP BY "+N.TrimStart(",")),n.a.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,r).then((function(e){return t.ds=e,null!=t.ds&&t.ds.Tables[0].length>0&&null!=t.ds.Tables[0][0].Balance?t.ds.Tables[0]:null}))}}]),o}(a.b)}}]);
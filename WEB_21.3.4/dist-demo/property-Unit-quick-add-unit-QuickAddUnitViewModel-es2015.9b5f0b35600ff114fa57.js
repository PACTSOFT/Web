(window.webpackJsonp=window.webpackJsonp||[]).push([[202],{IK0V:function(e,t,i){"use strict";i.r(t),i.d(t,"QuickAddUnitViewModel",(function(){return D}));var s=i("Do2H"),a=i("Lp6j"),n=i("eQJW"),l=i("ScVY"),o=i("EQd/"),h=i("0/4Q"),r=i("n56n"),d=i("NkMH"),c=i("VxiT"),u=i("c6GQ"),S=i("4k0m"),U=i("++IR"),p=i("Lslp");class D extends l.b{constructor(e,t,i,n,l){if(super(),this.Unitsmodel={},this.UnitID=0,this.parentid=0,this.selectedNode=0,this.group=!1,this.ScreenName="",this.Title="",this.DetailButtonVisibility=!0,this.UnitCode=new o.d(25624),this.UnitType=new o.d(25625),this.Status=new h.e(25626),this.Property=new r.b(25623),this.Group=new r.b(25721),this.RetValue=0,this.ScreenObject=new c.a,this.ScreenObject.LoadScreen_1(this,93,n),this.UnitID=t,this.parent=e,this.parentid=i,this.Group.CCID=93,this.Group.TypeID=1,this.Property.CCID=92,this.Property.TypeID=2,this.selectedNode=l,this.group=n,null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>0&&this.ScreenObject.Data.Tables[0].length>0){let e=this.ScreenObject.Data.Tables[0].filter(e=>54205==e.CostCenterColID);e.length>0&&(this.Unitsmodel.BasedOn=a.e.String(e[0].UserDefaultValue))}if(0==this.group?this.Title=s.a.GetResource(0==this.UnitID?"REN_UnitsAdd":"REN_UnitsEdit"):(this.Title=s.a.GetResource("CRMLead_AddGroup"),this.DetailButtonVisibility=!1,this.Unitsmodel.GUID="GUID"),this.Unitsmodel.UnitID=this.UnitID,this.ButtonSave=new d.a,0==this.UnitID)this.Group.SelectedValue=i,this.AutoGenerateCode(),this.Unitsmodel.GUID="GUID";else{let e=s.a.rental.GetUnitDetails(this.UnitID);e.Tables.length>0&&e.Tables[0].length>0&&(this.Unitsmodel.GUID=e.Tables[0][0].GUID.toString(),this.UnitCode.Text=e.Tables[0][0].Code.toString(),this.UnitType.Text=e.Tables[0][0].Name.toString(),this.Status.SelectedValue=e.Tables[0][0].Status.toString(),this.Group.SelectedValue=parseInt(e.Tables[0][0].ParentID),this.Property.SelectedValue=parseInt(e.Tables[0][0].PropertyID),this.ScreenObject.CanApprove(e.Tables[0][0],e.Tables[8][0],this.ButtonSave))}this.MessageVisibility=!1}AutoGenerateCode(){let e=s.a.common.GetAutoSequence(93,"","93",s.a.SessionManager.CompanyIndex.toString());if(null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>4){let t=this.ScreenObject.Data.Tables[4].filter(e=>"CodeAutoGen"==e.Name);t.length>0&&(Object(n.j)(t[0].Value)?(this.UnitCode.Enable=!1,this.UnitCode.Mandatory=!1,0==this.Unitsmodel.UnitID&&(this.UnitCode.Text=e)):this.UnitCode.Enable=!0)}null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>3&&(this.Status.Items.Clear(),this.ScreenObject.Data.Tables[3].forEach(e=>{this.Status.Items.push(h.d.ComboBoxItems_2(e.Status.toString(),e.StatusID.toString()))}),this.Status.SelectedValue="424")}OnSave(e){if("Cancel"==e)this.parent.DetailsVisibility=!0,s.a.page.HideDialog();else if("Save"==e){Logger.InfoLog("SaveUnitViewModel:: OnSave");try{let e=this.ScreenObject.ValidateData();if(!a.e.IsEmpty(e))return this.DisplayMessage=e,void(this.MessageVisibility=!0);this.Unitsmodel.Code=this.UnitCode.Text,this.Unitsmodel.StatusID=a.e.IsEmpty(this.Status.SelectedValue)?0:parseInt(this.Status.SelectedValue),this.Unitsmodel.Name=this.UnitType.Text,this.Unitsmodel.IsGroup=this.group,this.Unitsmodel.Property=0!=this.Property.SelectedValue?this.Property.SelectedValue:0,this.Unitsmodel.SelectedNodeID=this.selectedNode,this.Unitsmodel.WID=this.ScreenObject.CheckWorkFlow(),0==this.Unitsmodel.UnitID?s.a.rental.SaveUnits(this.Unitsmodel,"SaveUnits").subscribe(e=>{this.DisplayMessage=e.Message,this.MessageVisibility=!0,this.RetValue=e.RetValue,this.RetValue>0&&(this.UnitCode.Text="",this.Status.SelectedValue="424",this.UnitID=0,this.UnitType.Text="",this.Unitsmodel.UnitID=0,null!=this.parent&&this.parent.Refresh(),this.AutoGenerateCode(),this.Group.SelectedValue=this.selectedNode)},e=>{console.log(" Unit Save : "+JSON.stringify(e))}):s.a.rental.SaveUnits(this.Unitsmodel,"QuickUpdateUnit").subscribe(e=>{this.DisplayMessage=e.Message,this.MessageVisibility=!0,this.RetValue=e.RetValue,this.RetValue>0&&(this.UnitCode.Text="",this.Status.SelectedValue="424",this.UnitID=0,this.UnitType.Text="",this.Unitsmodel.UnitID=0,null!=this.parent&&this.parent.Refresh(),this.AutoGenerateCode(),this.Group.SelectedValue=this.selectedNode)},e=>{console.log(" Quick Unit Save : "+JSON.stringify(e))}),Logger.InfoLog("SaveUnitViewModel:: OnSave")}catch(t){Logger.ErrorLog("SaveUnitViewModel:: OnSave"+t.stack)}}else if("Details"==e.toString()){s.a.page.HideDialog();let e=new u.AddEditUnitsViewModel(this.UnitID,this.group,this.parentid,this.selectedNode);s.a.page.addNewTab({title:e.Title,component:p.AddEditUnitsComponent,params:{obj:e}})}else if("ShowApprove"==e.toString()){let e=new S.a(93,this.Unitsmodel.UnitID,this.ScreenObject,this);s.a.page.ShowDialog(e,U.a,{ShowCenter:!0,Title:s.a.GetResource("ApproveReject")})}}}}}]);
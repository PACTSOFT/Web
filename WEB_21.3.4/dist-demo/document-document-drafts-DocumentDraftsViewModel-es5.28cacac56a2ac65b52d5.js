function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var a,r=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;a=Reflect.construct(r,arguments,n)}else a=r.apply(this,arguments);return _possibleConstructorReturn(this,a)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[150],{ouML:function(e,t,a){"use strict";a.r(t),a.d(t,"DocumentDraftsViewModel",(function(){return d}));var r=a("mrSG"),n=a("Do2H"),o=a("Lp6j"),i=a("ScVY"),s=a("8B8H"),l=a("ockk"),c=a("rJVx"),u=a("CUWK"),d=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,a){var r,o,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(_classCallCheck(this,i),(r=t.call(this)).Grid=new s.a,r.IsFromDocs=!1,r.PopupWidth=0,r.ReportType=0,r.Parent=null,r.CCID=0,r.WID=0,r.LevelID=0,r.PactGridVisible=!1,r.CCID=u,r.Parent=e,r.ReportType=a,r.Parent instanceof c.GeneralDashboardViewModel||"DashAddOnsViewModel"==r.Parent.ClassName)?1==a&&(r.ColSource=c.GeneralDashboardViewModel.InitColumns("Document Drafts_DashBoardCustomize")):(1==a?r.DisplayName="Drafts":2==a?r.DisplayName="Hold Documents":3==a?r.DisplayName="Approval History":4==a&&(r.DisplayName="Level Info",r.PactGrid=new s.a),r.Title=r.DisplayName,r.IsFromDocs=!0,r.FillGrid(),r.Grid.OnLinkClick.Subscribe(_assertThisInitialized(r),"GridLinkClick"),r.ColSource=[],1==a?(r.ColSource=c.GeneralDashboardViewModel.InitColumns("Document Drafts_DashBoardCustomize"),r.PopupWidth=22,r.ColSource.forEach((function(e){r.PopupWidth=r.PopupWidth+e.Width}))):2==a?((o=new l.a).DataType="TextBlock",o.Header="Hold Date",o.DisplayMember="HoldDate_Key",o.Width=100,r.ColSource.push(o),(o=new l.a).DataType="LINK",o.Header=n.a.GetResource("DocName"),o.DisplayMember="DocName",o.Width=135,r.ColSource.push(o),(o=new l.a).DataType="TextBlock",o.Header="NetValue",o.DisplayMember="NetValue",o.Width=100,r.ColSource.push(o),(o=new l.a).DataType="TextBlock",o.Header="NoOfProducts",o.DisplayMember="NoOfProducts",o.Width=50,r.ColSource.push(o),(o=new l.a).DataType="LINK",o.Header=n.a.GetResource("Delete"),o.DisplayMember="Delete",o.Width=100,r.ColSource.push(o),r.PopupWidth=450):3==a?((o=new l.a).DataType="TextBlock",o.Header="User",o.DisplayMember="CreatedBy",o.Width=90,r.ColSource.push(o),(o=new l.a).DataType="TextBlock",o.Header="FirstName",o.DisplayMember="FirstName",o.Width=90,r.ColSource.push(o),(o=new l.a).DataType="TextBlock",o.Header="LastName",o.DisplayMember="LastName",o.Width=90,r.ColSource.push(o),(o=new l.a).DataType="TextBlock",o.Header="Email",o.DisplayMember="Email1",o.Width=150,r.ColSource.push(o),(o=new l.a).DataType="TextBlock",o.Header=n.a.GetResource("Date"),o.DisplayMember="AppDate",o.Width=128,r.ColSource.push(o),(o=new l.a).DataType="LINK",o.Header="Level",o.DisplayMember="LevelName",o.Width=93,r.ColSource.push(o),(o=new l.a).DataType="TextBlock",o.Header="Status",o.DisplayMember="Status",o.Width=80,r.ColSource.push(o),(o=new l.a).DataType="Format",o.Header="Remarks",o.DisplayMember="Remarks",o.Width=190,r.ColSource.push(o),r.PopupWidth=950,"AddEditDocumentViewModel"==r.Parent.ClassName&&((o=new l.a).Header="WorkFlowName",o.DisplayMember="WorkFlowName",o.Width=200,r.ColSource.push(o)),r.PopupWidth=950):4==a&&((o=new l.a).DataType="TextBlock",o.ReadOnly=!0,o.Header="User Name",o.DisplayMember="UserName",o.Width=120,r.ColSource.push(o),(o=new l.a).DataType="TextBlock",o.ReadOnly=!0,o.Header="First Name",o.DisplayMember="FirstName",o.Width=120,r.ColSource.push(o),(o=new l.a).DataType="TextBlock",o.ReadOnly=!0,o.Header="Last Name",o.DisplayMember="LastName",o.Width=120,r.ColSource.push(o),r.PactGrid.Columns=r.ColSource,r.PopupWidth=400));return _possibleConstructorReturn(r)}return _createClass(i,[{key:"onClick",value:function(e){event.preventDefault(),null!=this.SelectedRow&&this.LoadDraft(this.SelectedRow)}},{key:"FillGrid",value:function(){var e=this,t=0,a=null;if(o.e.IsType(this.Parent,"AddEditDocumentViewModel")?(a=this.Parent,t=0==this.CCID?a.CostCenterID:this.CCID):o.e.IsEmpty(this.Parent.ClassName)||"AddEditRenContractViewModel"!=this.Parent.ClassName||(t=this.CCID),1==this.ReportType||2==this.ReportType)(o.e.IsEmpty(this.Parent.ClassName)||"AddEditRenContractViewModel"!=this.Parent.ClassName?null==a||38!=a.ScreenObject.DocumentType&&39!=a.ScreenObject.DocumentType?n.a.document.GetDocumentDrafts(0,t,this.ReportType,!1):n.a.document.GetDocumentDrafts(a.ScreenObject.RegisterNodeID,t,this.ReportType,!1,!0):n.a.document.GetDocumentDrafts(0,this.Parent.CostCenterID,this.ReportType,!1)).subscribe((function(t){e.Table=t.Tables[0],e.Grid.TableColumns.Contains("Date_Text")||(e.Grid.TableColumns.push("Date_Text"),e.Grid.TableColumns.push("Delete")),e.Grid.TableColumns.Contains("HoldDate_Key")||e.Grid.TableColumns.push("HoldDate_Key"),e.Table.forEach((function(e){e.Delete="Delete",e.id=n.a.slick.rowid,e.Date_Text=new Date(e.Date).ToString(n.a.SessionManager.Preferences["Date Format"]+" hh:mm a"),null!=e.HoldDate&&(e.HoldDate_Key=new Date(e.HoldDate).ToString(n.a.SessionManager.Preferences["Date Format"]))}))}));else if(3==this.ReportType){var r=null;if(o.e.IsType(this.Parent,"AddEditDocumentViewModel")?(r=this.Parent.ScreenObject.GetDocStatusHistory()).Tables.length>1&&r.Tables[1].length>0&&r.Columns[1].Contains("WID")&&(this.WID=parseInt(r.Tables[1][0].WID)):o.e.IsEmpty(this.Parent.ClassName)||"AddEditRenContractViewModel"!=this.Parent.ClassName?o.e.IsEmpty(this.Parent.ClassName)||"AddEditCasesViewModel"!=this.Parent.ClassName||(r=this.GetDocStatusHistory(73,this.Parent.CaseID,!1)):r=n.a.rental.GetHistory(t,this.Parent.ContractID),null!=r&&r.Tables.length>0){this.Table=r.Tables[0],this.Grid.TableColumns.push("AppDate");for(var s=0;s<this.Table.length;s++)""!=this.Table[s].Date.toString()&&(this.Table[s].AppDate=new Date(this.Table[s].Date.toString()).ToString(n.a.SessionManager.Preferences["Date Format"]+" hh:mm a"));var l=0,c=0;this.Table.length>0&&(l=o.e.IntTryParse(this.Table[this.Table.length-1].WorkFlowLevel.toString()),c=o.e.IntTryParse(this.Table[this.Table.length-1].StatusID.toString())),369!=c&&(r.Tables[1]=r.Tables[1].filter((function(e){return e.levelID>l})),r.Tables[1].forEach((function(t){var a=e.Grid.NewRow();a.LevelName=t.LevelName,a.Status="Pending",a.WorkFlowLevel=t.LevelID,e.Grid.addRow(a)})));for(var u=this.Table.length;u<7;u++)this.Grid.addEmptyRow()}}else if(4==this.ReportType){var d=null;if("WFLevelDoc"==this.Parent.ClassName?d=n.a.SessionManager.Preferences.ContainsKey("CanApproveFunction")&&"True"==n.a.SessionManager.Preferences.CanApproveFunction?n.a.report.GetExtWFDet(this.Parent.WID,this.Parent.LevelID,this.Parent.ccid,this.Parent.DOcId):n.a.report.GetWorkFlowLevelDetails(this.Parent.WID,this.Parent.LevelID,this.Parent.ccDate):this.Parent instanceof i&&(n.a.SessionManager.Preferences.ContainsKey("CanApproveFunction")&&"True"==n.a.SessionManager.Preferences.CanApproveFunction?"AddEditDocumentViewModel"==this.Parent.Parent.ClassName?d=n.a.report.GetExtWFDet(this.Parent.WID,this.Parent.LevelID,this.Parent.Parent.CostCenterID,this.Parent.Parent.ScreenObject.DocID):"ReportViewModel"==this.Parent.Parent.ClassName&&"INV_ComparisonReport"==this.Parent.Parent.StaticReportObject&&(d=n.a.report.GetExtWFDet(this.Parent.WID,this.Parent.LevelID,this.Parent.Parent.StaticReportObject.QuotationDocument,this.Parent.Parent.StatusDocID)):d=n.a.report.GetWorkFlowLevelDetails(this.Parent.WID,this.Parent.LevelID,"AddEditDocumentViewModel"==this.Parent.Parent.ClassName?this.Parent.Parent.ScreenObject.DocDate.Date:Date.Today())),null!=d){for(var h=d.Tables[0].length;h<8;h++)d.Tables[0].push();this.PactGrid.Table=d.Tables[0]}this.PactGrid.Width="",this.PactGrid.SearchVisible=!0,this.PactGrid.SearchCols.Width="85",this.PactGrid.SearchOptions.Width="90",this.PactGrid.SearchText.Width="110",this.PactGridVisible=!0}}},{key:"GetDocStatusHistory",value:function(e,t,a){Logger.InfoLog("DocumentDraftsViewModel:: Inside GetDocStatusHistory");var r=[];r.push(e),r.push(t),r.push(a),r.push(n.a.SessionManager.UserID),r.push(n.a.SessionManager.LanguageID);var o=n.a.document.GetDocStatusHistory(r);return Logger.InfoLog("DocumentDraftsViewModel:: Exiting GetDocStatusHistory"),o}},{key:"OnButtonClick",value:function(e){"Cancel"==e.toString()&&(o.e.IsType(this.Parent,"AddEditDocumentViewModel")&&this.CCID>0&&(this.Parent.res="No"),n.a.page.HideDialog())}},{key:"DeleteDraft",value:function(e){(o.e.IsEmpty(this.Parent.ClassName)||"AddEditRenContractViewModel"!=this.Parent.ClassName?n.a.document.DeleteDocumentDraft(parseInt(e.DraftID)):n.a.rental.DeleteQuotation(parseInt(e.CostCenterID),parseInt(e.DraftID))).RetValue>0&&this.Grid.removeRow(e)}},{key:"LoadDraft",value:function(e){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var r,i,s,l,c,d=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!o.e.IsEmpty(this.Parent.ClassName)&&"AddEditRenContractViewModel"==this.Parent.ClassName){t.next=12;break}return t.next=3,Promise.all([a.e(2),a.e(1),a.e(3),a.e(5),a.e(4),a.e(6),a.e(7),a.e(10),a.e(9),a.e(12),a.e(11),a.e(13),a.e(19),a.e(15),a.e(21),a.e(20),a.e(16),a.e(14),a.e(18),a.e(17),a.e(22),a.e(89)]).then(a.bind(null,"1Cra"));case 3:return r=t.sent,i=r.AddEditDocumentViewModel,t.next=7,Promise.all([a.e(4),a.e(6)]).then(a.bind(null,"MCKn"));case 7:s=t.sent,l=s.AddEditDocumentComponent,n.a.document.GetDocumentDrafts(parseInt(e.DraftID),0,1,!1).subscribe((function(t){if(null!=(c=t.Tables[0])&&c.length>0)if("AddEditDocumentViewModel"==d.Parent.ClassName||"POSDocumentViewModel"==d.Parent.ClassName)d.CCID>0||(d.Parent.clear(1),d.Parent.LoadDraftXML(c[0]),n.a.page.HideDialog(),d.Parent.ScreenObject.GridDataObj.RefreshGridView());else{var a=1==d.ReportType,r=new i(parseInt(e.CostCenterID),e.Type.toString(),a);n.a.page.addNewTab({component:l,params:{obj:r}}),r.LoadDraftXML(c[0],a)}})),t.next=13;break;case 12:u.RibbonExtViewModel.LoadDraftRentalContract(this.Parent,parseInt(e.DraftID)),n.a.page.HideDialog();case 13:case"end":return t.stop()}}),t,this)})))}},{key:"GridLinkClick",value:function(e,t,a){event.preventDefault(),"Delete"==t?this.DeleteDraft(e):"Date_Text"!=t&&"DocName"!=t||this.LoadDraft(e)}},{key:"Table",get:function(){return this.Grid.Table},set:function(e){this.Grid.Table=e}},{key:"TableColumns",get:function(){return this.Grid.TableColumns},set:function(e){this.Grid.TableColumns=e}},{key:"ColSource",get:function(){return this.Grid.Columns},set:function(e){this.Grid.Columns=e}},{key:"SelectedRow",get:function(){return this.Grid.SelectedItem},set:function(e){this.Grid.SelectedItem=e}}]),i}(i.b)}}]);
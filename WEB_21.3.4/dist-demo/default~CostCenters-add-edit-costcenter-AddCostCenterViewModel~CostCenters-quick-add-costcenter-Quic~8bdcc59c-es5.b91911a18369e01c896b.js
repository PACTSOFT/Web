function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,r=_getPrototypeOf(e);if(t){var i=_getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{JJ8n:function(e,t,n){"use strict";n.d(t,"a",(function(){return C}));var r=n("mrSG"),i=n("Do2H"),a=n("Lp6j"),o=n("eQJW"),s=n("ScVY"),c=n("n56n"),l=n("0/4Q"),u=n("JIg3"),b=n("8B8H"),D=n("ockk"),S=n("MCKn"),d=n("4HhE"),C=function(e){_inherits(s,e);var t=_createSuper(s);function s(){var e;return _classCallCheck(this,s),(e=t.call(this)).InProgress=null,e.ProgressMessage=null,e.ProgressValue=0,e.ProgressMax=0,e.DimVisibility=!1,e.TextVisibility=!1,e.FromDate=new u.b,e.LineNo=1,e.Label=null,e.GridVisibility=!1,e.DocVisibility=!1,e.LineVisibility=!0,e.calltype=0,e.DailogResult=!1,e.FromDate.Visible=!1,e}return _createClass(s,[{key:"GoToLineViewModel_1",value:function(e,t){this.ButtonClick=new d.b,this.oParent=e,this.calltype=t,this.DimVisibility=!1,0==this.calltype?(this.TextVisibility=!0,this.Title="Add "+e.TempscreenTitle.replace("Add ","").replace("Edit ",""),this.Label="No. of "+e.TempscreenTitle.replace("Add ","").replace("Edit ","")):1==this.calltype&&(this.TextVisibility=!1,this.Title="Date",this.Label="Date",this.FromDate.Visible=!0,this.FromDate.Date=Date.Today(),this.FromDate.CustomFormat=i.a.SessionManager.Preferences["Date Format"]+" hh:mm tt"),this.ButtonClick.Subscribe(this,"OnButtonClick")}},{key:"GoToLineViewModel_2",value:function(e){Logger.InfoLog("GoToLineViewModel:: Entering GoToLineViewModel"),this.Parent=e,this.Title="Go to line",this.DimVisibility=!1,this.TextVisibility=!0,this.Label="Line Number(1-"+(e.ScreenObject.GridData.length-1).toString()+"):",Logger.InfoLog("GoToLineViewModel:: Entering GoToLineViewModel")}},{key:"GoToLineViewModel_3",value:function(e,t,n){var r,i=this;this.Parent=e,this.Title="Select Document",this.GridVisibility=!0,this.LineVisibility=!1,this.calltype=n,this.Documents=new b.a,this.Documents.OnLinkClick.Subscribe(this,"OnGridLinkClick"),this.Documents.Table=[],this.Documents.TableColumns.push("CostCenterID"),this.Documents.TableColumns.push("DocName"),this.Documents.Columns=[],(r=new D.a).Header="Document Nme",r.DisplayMember="DocName",r.DataType="LINK",r.ReadOnly=!0,r.IsFrozen=!0,r.Width=270,this.Documents.Columns.push(r),t.forEach((function(e){var t=i.Documents.NewRow();t.CostCenterID=e.CostCenterIDBase.toString(),t.DocName=e.DocName.toString(),i.Documents.Table.push(t)}));for(var a=this.Documents.Table.length;a<5;a++)this.Documents.addEmptyRow()}},{key:"GoToLineViewModel_4",value:function(e,t,n){var r=this;if(Logger.InfoLog("GoToLineViewModel:: Entering GoToLineViewModel"),this.Parent=e,this.DimVisibility=!0,this.TextVisibility=!1,400==t)this.Title="Select Document",this.Label="Doc No",this.Dimension=new c.b(0),this.Dimension.CCID=t,this.Dimension.TypeID=2,this.Dimension.CustomWhere=" a.CostCenterID="+e.CostCenterID.toString();else if(2==t)this.Title="Select Account",this.Label="Account",this.Dimension=new c.b(0),this.Dimension.CCID=t,this.Dimension.TypeID=2,this.Options=new l.e,this.Options.Visible=!1;else{this.Title="Stock Posting",this.Label="Post based on",this.Options=new l.e(0),this.Options.Visible=!0,this.Dimension=new c.b(0),this.Dimension.Visible=!1;var i="",s=this.Parent.ScreenObject.ColumnSource.find((function(e){return e.ID==r.Parent.ScreenObject.Preferences.QOHField}));if(s&&(i=s.DisplayMember),e.ScreenObject.ColumnSource.forEach((function(e){!a.e.StringIsNullOrEmpty(e.DisplayMember)&&e.DisplayMember.toLowerCase().Contains("dcnum")&&e.DisplayMember!=i&&r.Options.Items.push(l.d.ComboBoxItems_2(e.Header,e.DisplayMember))})),this.Parent.ScreenObject.Preferences.ContainsKey("StockPostingAll")&&Object(o.j)(this.Parent.ScreenObject.Preferences.StockPostingAll)){var u=this.Parent.ScreenObject.GetPSPProducts(this.Parent.ScreenObject.DocID,this.Parent.DocumentDate,"",0);if(null!=u&&u.Tables.length>0&&u.Tables[0].length>0){var S;this.DocVisibility=!0,this.Documents=new b.a,this.Documents.Table=[],this.Documents.TableColumns.push("CostCenterID"),this.Documents.TableColumns.push("DocName"),this.Documents.Columns=[],this.Documents.Height=200,(S=new D.a).Header="Open Documents",S.DisplayMember="DocName",S.DataType="LINK",S.ReadOnly=!0,S.IsFrozen=!0,S.Width=270,this.Documents.Columns.push(S);for(var d=0;d<u.Tables[0].length;d++){var C=this.Documents.NewRow();C.CostCenterID=u.Tables[0][d].Costcenterid.toString(),C.DocName=u.Tables[0][d].Voucherno.toString(),this.Documents.Table.push(C)}for(var f=this.Documents.Table.length;f<5;f++)this.Documents.addEmptyRow()}}}Logger.InfoLog("GoToLineViewModel:: Entering GoToLineViewModel")}},{key:"OnGridLinkClick",value:function(e,t,n){e.CostCenterID.toString().length>0&&(i.a.page.HideDialog(),1==this.calltype?this.Parent.GenerateDocfromProject(parseInt(e.CostCenterID.toString())):this.Parent.GenerateLinkDocument(parseInt(e.CostCenterID.toString())))}},{key:"OnButtonClick",value:function(e){if(null!=e&&"Cancel"==e.toString())this.DailogResult=!1,i.a.page.HideDialog();else if(null!=e&&"OK"==e.toString())if(null!=this.oParent)0==this.calltype?(this.ProgressMessage="Adding Bins.Please wait...",i.a.page.HideDialog()):1==this.calltype&&(this.DailogResult=!0,i.a.page.HideDialog());else if(i.a.page.HideDialog(),this.DimVisibility){if(null!=this.Options){if(a.e.StringIsNullOrEmpty(this.Options.SelectedValue))return this.DisplayMessage="select post on",void(this.MessageVisibility=!0);this.PostDocumentObj()}else if(null!=this.Dimension){var t=Date.Today();this.Dimension.SelectedValue>0&&this.Parent.ScreenObject.OnDocPrefixChanged("lostFocus",0,this.Dimension.SelectedValue,t,!0)}}else this.Parent.LineNo=this.LineNo}},{key:"PostDocumentObj",value:function(){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,r,s,l,u,b,D,d,C,f,m,g,h,O,P,p,y,j,I,v,N,T,G,M,w=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.e(2),n.e(1),n.e(3),n.e(5),n.e(4),n.e(6),n.e(7),n.e(10),n.e(9),n.e(12),n.e(11),n.e(13),n.e(19),n.e(15),n.e(21),n.e(20),n.e(16),n.e(14),n.e(18),n.e(17),n.e(22),n.e(148)]).then(n.bind(null,"1Cra"));case 2:for(t=e.sent,r=t.AddEditDocumentViewModel,(l=new r(parseInt(this.Parent.ScreenObject.Preferences.PostingDOC),"",!1)).CheckStockDimensions(),l.DocumentDate=this.Parent.DocumentDate,l.ScreenObject._CCFields.forEach((function(e){if(e instanceof c.b){var t=w.Parent.ScreenObject._CCFields.find((function(t){return t instanceof c.b&&t.CCID==e.CCID}));t&&(e.PreviousSelectedValue=t.SelectedValue,e.SelectedValue=t.SelectedValue)}})),u=l.ScreenObject.ColumnSource.find((function(e){return e.CostCenterID.toString()==i.a.SessionManager.Preferences.POSItemCodeDimension})),b="",(D=l.ScreenObject.ColumnSource.find((function(e){return e.ID==l.ScreenObject.Preferences.CntField})))&&(b=D.DisplayMember),d="",(D=this.Parent.ScreenObject.ColumnSource.find((function(e){return e.ID==w.Parent.ScreenObject.Preferences.QOHField})))&&(d=D.DisplayMember),f="",(D=l.ScreenObject.ColumnSource.find((function(e){return e.ID==l.ScreenObject.Preferences.VarienceField})))&&(f=D.DisplayMember),l.ScreenObject.GridData.Clear(),m=new a.f,g=function(e){if(!a.e.StringIsNullOrEmpty(w.Parent.ScreenObject.GridData[e].ProductID_Key)){if(C="",s=l.ScreenObject.GridDataObj.NewRow(),l.ScreenObject.ColumnSource.forEach((function(t){if(t.CostCenterID>5e4)if(w.Parent.ScreenObject.GridDataColumns.Contains("dcCCNID"+(t.CostCenterID-5e4)))a.e.StringIsNullOrEmpty(w.Parent.ScreenObject.GridData[e]["dcCCNID"+(t.CostCenterID-5e4)+"_Key"])||(s["dcCCNID"+(t.CostCenterID-5e4)+"_Key"]=w.Parent.ScreenObject.GridData[e]["dcCCNID"+(t.CostCenterID-5e4)+"_Key"].toString(),s["dcCCNID"+(t.CostCenterID-5e4)]=w.Parent.ScreenObject.GridData[e]["dcCCNID"+(t.CostCenterID-5e4)].toString());else{var n=w.Parent.ScreenObject._CCFields.find((function(e){return e instanceof c.b&&e.CCID==t.CostCenterID}));n&&(s["dcCCNID"+(t.CostCenterID-5e4)]=n.SelectedValue)}})),s.ProductID_Key=w.Parent.ScreenObject.GridData[e].ProductID_Key.toString(),l.ScreenObject.GridDataColumns.Contains("ProductCode")&&(s.ProductCode=w.Parent.ScreenObject.GridData[e].ProductCode),l.ScreenObject.GridDataColumns.Contains("ProductName")&&(s.ProductName=w.Parent.ScreenObject.GridData[e].ProductName),s.Rate=w.Parent.ScreenObject.GridData[e].Rate,s.Type=w.Parent.ScreenObject.GridData[e].Type,s.Unit=w.Parent.ScreenObject.GridData[e].Unit,s.Unit_key=w.Parent.ScreenObject.GridData[e].Unit_key,!w.Parent.ScreenObject.Preferences.ContainsKey("DontCalcQOH")||a.e.StringIsNullOrEmpty(w.Parent.ScreenObject.Preferences.DontCalcQOH)||l.ScreenObject.Preferences.ContainsKey("DontCalcQOH")||l.ScreenObject.Preferences.push("DontCalcQOH",w.Parent.ScreenObject.Preferences.DontCalcQOH),w.Parent.ScreenObject.Preferences.ContainsKey("DontCalcQOH")&&!a.e.StringIsNullOrEmpty(w.Parent.ScreenObject.Preferences.DontCalcQOH)&&Object(o.j)(w.Parent.ScreenObject.Preferences.DontCalcQOH)){if("5"==w.Parent.ScreenObject.GridData[e].Type.toString()&&!a.e.StringIsNullOrEmpty(w.Parent.ScreenObject.GridData[e].ExtraXML)){m.LoadXml(w.Parent.ScreenObject.GridData[e].ExtraXML.toString());var t=m.SelectNodes("xml/Row");t.length>0&&null!=t[0].attributes.BatchID&&!a.e.StringIsNullOrEmpty(t[0].attributes.BatchID.value)&&(C=t[0].attributes.BatchID.value)}""!=d&&(s.QOH=w.Parent.ScreenObject.GridData[e][d]),s.UOMConversion=w.Parent.ScreenObject.GridData[e].UOMConversion,O=l.ScreenObject.ColumnSource.find((function(e){return"Quantity"==e.DisplayMember})),s.Quantity=O&&!a.e.StringIsNullOrEmpty(O.DefaultValue)&&isFinite(O.DefaultValue)?O.DefaultValue:1,a.e.StringIsNullOrEmpty(s.UOMConversion)||(s.UOMConvertedQty=parseFloat(s.UOMConversion.toString())*parseFloat(s.Quantity.toString()));var n=l.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&25398==e.LinkData}));n.length>0&&l.ScreenObject.GridDataColumns.Contains(n[0].SysColumnName.toString())&&(s[n[0].SysColumnName.toString()]=w.Parent.ScreenObject.GridData[e][d])}else if("5"==w.Parent.ScreenObject.GridData[e].Type.toString()){if(!a.e.StringIsNullOrEmpty(w.Parent.ScreenObject.GridData[e].ExtraXML)){m.LoadXml(w.Parent.ScreenObject.GridData[e].ExtraXML.toString());var r=m.SelectNodes("xml/Row");if(r.length>0&&null!=r[0].attributes.BatchID&&!a.e.StringIsNullOrEmpty(r[0].attributes.BatchID.value)){C=r[0].attributes.BatchID.value,s.QOH=l.ScreenObject.GetBatchWiseQOH(s.ProductID_Key.toString(),C,s);var D=l.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&25398==e.LinkData}));D.length>0&&l.ScreenObject.GridDataColumns.Contains(D[0].SysColumnName.toString())&&(s[D[0].SysColumnName.toString()]=s.QOH)}}}else l.AddProductData(s,!1,!0,!1,null,null,u);if(""!=b&&(s[b]=w.Parent.ScreenObject.GridData[e][w.Options.SelectedValue]),l.ScreenObject.GridDataColumns.Contains("DueDate")&&w.Parent.ScreenObject.GridDataColumns.Contains("DueDate")&&!a.e.StringIsNullOrEmpty(w.Parent.ScreenObject.GridData[e].DueDate_Key)&&(s.DueDate=w.Parent.ScreenObject.GridData[e].DueDate.toString(),s.DueDate_Key=w.Parent.ScreenObject.GridData[e].DueDate_Key.toString()),l.ScreenObject.GridDataColumns.Contains("LinkedInvDocDetailsID")&&(s.LinkedInvDocDetailsID=w.Parent.ScreenObject.GridData[e].DocDetailsID),l.ScreenObject.GridDataColumns.Contains("RefNo")&&(s.RefNo=w.Parent.ScreenObject.VoucherNo),l.ScreenObject.GridData.push(s),l.CalculateTotals(s,!1),"5"==w.Parent.ScreenObject.GridData[e].Type.toString()&&""!=C&&""!=f&&l.ScreenObject.GridDataColumns.Contains(f)&&!a.e.StringIsNullOrEmpty(l.ScreenObject.GridData[e][f])&&0!=parseFloat(l.ScreenObject.GridData[e][f].toString())){var S=parseFloat(l.ScreenObject.GridData[e][f].toString().replace("-",""));s.ExtraXML='<xml><Row  ProductID="'+s.ProductID_Key.toString()+'"  BatchID="'+C+'"  Quantity="'+S+'"  Hold="0" Release="'+S+'"  ></Row></xml>'}"2"!=a.e.String(w.Parent.ScreenObject.GridData[e].Type)||a.e.IsEmpty(w.Parent.ScreenObject.GridData[e].ExtraXML)||""==f||!l.ScreenObject.GridDataColumns.Contains(f)||a.e.IsEmpty(l.ScreenObject.GridData[e][f])||0==parseFloat(l.ScreenObject.GridData[e][f].toString())||function(){var t=0,n=0;i.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&Object(o.j)(i.a.SessionManager.Preferences.EnableDivisionWise)&&i.a.SessionManager.Preferences.ContainsKey("DW SNOS")&&Object(o.j)(i.a.SessionManager.Preferences["DW SNOS"])&&(null!=(v=w.Parent.ScreenObject._CCFields.find((function(e){return"dcccnid1"==e.DBColumnName.toLowerCase()})))&&null!=v&&v instanceof c.b&&v.SelectedValue>0?t=v.SelectedValue:null!=s&&l.ScreenObject.GridDataColumns.Contains("dcCCNID1_Key")&&!a.e.IsEmpty(s.dcCCNID1_Key)&&(t=parseInt(s.dcCCNID1_Key.toString()))),i.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&Object(o.j)(i.a.SessionManager.Preferences.EnableLocationWise)&&i.a.SessionManager.Preferences.ContainsKey("LW SNOS")&&Object(o.j)(i.a.SessionManager.Preferences["LW SNOS"])&&(null!=(v=w.Parent.ScreenObject._CCFields.find((function(e){return"dcccnid2"==e.DBColumnName.toLowerCase()})))&&null!=v&&v instanceof c.b&&v.SelectedValue>0?n=v.SelectedValue:null!=s&&l.ScreenObject.GridDataColumns.Contains("dcCCNID2_Key")&&!a.e.IsEmpty(s.dcCCNID2_Key)&&(n=parseInt(s.dcCCNID2_Key.toString())));var r=i.a.document.GetSerialNumberScreenDetails(parseInt(s.ProductID_Key),0,0,t,n,!1),u=parseFloat(l.ScreenObject.GridData[e][f].toString());m.LoadXml(w.Parent.ScreenObject.GridData[e].ExtraXML.toString());var b=m.SelectNodes("xml/Row"),D="";if(D+="<xml>",u>0)for(var S=function(e){null==b[e].attributes.SerialNumber||a.e.IsEmpty(b[e].attributes.SerialNumber.value)||0==r.Tables[1].filter((function(t){return t.SerialNumber==b[e].attributes.SerialNumber.value})).length&&(D+='<Row SerialNumber="'+b[e].attributes.SerialNumber.value+'" Quantity="1"  StatusID="157" ',D+=' RefInvDocDetailsID="0" SerialGUID="'+a.e.NewGuid()+'" IsIssue="0" IsAvailable="1"',D+=" >",D+="</Row>")},d=0;d<b.length;d++)S(d);else if(u<0){for(var C=new Array[b.length],g=0;g<b.length;g++)null==b[g].attributes.SerialNumber||a.e.IsEmpty(b[g].attributes.SerialNumber.value)||(C[g]=b[g].attributes.SerialNumber.value);for(var h=0;h<r.Tables[1].length;h++)C.Contains(r.Tables[1][h].SerialNumber.toString())||(D+='<Row SerialNumber="'+r.Tables[1][h].SerialNumber.toString()+'" Quantity="1"  StatusID="158" ',D+=' RefInvDocDetailsID="'+r.Tables[1][h].InvDocDetailsID.toString()+'" SerialGUID="'+r.Tables[1][h].SerialGUID.toString()+'" IsIssue="1" IsAvailable="0"',D+=" >",D+="</Row>")}D+="</xml>",s.ExtraXML=D.toString()}()}},h=0;h<this.Parent.ScreenObject.GridData.length;h++)g(h);if(this.Parent.ScreenObject.Preferences.ContainsKey("StockPostingAll")&&Object(o.j)(this.Parent.ScreenObject.Preferences.StockPostingAll)&&null!=(P=this.Parent.ScreenObject.GetPSPProducts(this.Parent.ScreenObject.DocID,this.Parent.DocumentDate,b,1))&&P.Tables.length>0&&P.Tables[0].length>0)for(p=0;p<P.Tables[0].length;p++)if(C="",(s=l.ScreenObject.GridDataObj.NewRow()).ProductID_Key=P.Tables[0][p].ProductID.toString(),l.ScreenObject.GridDataColumns.Contains("ProductCode")&&(s.ProductCode=P.Tables[0][p].ProductCode),l.ScreenObject.GridDataColumns.Contains("ProductName")&&(s.ProductName=P.Tables[0][p].ProductName),s.Rate=P.Tables[0][p].Rate,s.Type=P.Tables[0][p].ProductTypeID,s.Unit_key=P.Tables[0][p].Unit,s.QOH=P.Tables[0][p].QOH,s.UOMConversion=P.Tables[0][p].UOMConversion,O=l.ScreenObject.ColumnSource.find((function(e){return"Quantity"==e.DisplayMember})),s.Quantity=O&&!a.e.StringIsNullOrEmpty(O.DefaultValue)&&isFinite(O.DefaultValue)?O.DefaultValue:1,a.e.StringIsNullOrEmpty(s.UOMConversion)||(s.UOMConvertedQty=parseFloat(s.UOMConversion.toString())*parseFloat(s.Quantity.toString())),(y=l.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&25398==e.LinkData}))).length>0&&l.ScreenObject.GridDataColumns.Contains(y[0].SysColumnName.toString())&&(s[y[0].SysColumnName.toString()]=P.Tables[0][p].QOH),b&&!a.e.StringIsNullOrEmpty(P.Tables[0][p].cntfld)&&(s[b]=P.Tables[0][p].cntfld.toString()),a.e.hasprop(s,"DueDate")&&!a.e.StringIsNullOrEmpty(P.Tables[0][p].DueDate)&&(s.DueDate=new Date(P.Tables[0][p].DueDate.toString()).ToString(i.a.SessionManager.Preferences["Date Format"]),s.DueDate_Key=new Date(P.Tables[0][p].DueDate.toString())),a.e.StringIsNullOrEmpty(P.Tables[0][p].invdocdetailsid)||"0"==P.Tables[0][p].invdocdetailsid.toString()||(s.LinkedInvDocDetailsID=P.Tables[0][p].invdocdetailsid,l.ScreenObject.GridDataColumns.Contains("RefNo")&&(s.RefNo=P.Tables[0][p].Voucherno.toString())),null!=u&&P.Columns[0].Contains("StkCode")&&(s[u.DisplayMember]=P.Tables[0][p].Code,s[u.ValueMember]=P.Tables[0][p].StkCode),l.ScreenObject.GridDataObj.addRow(s),l.CalculateTotals(s,!1,"",!1),"2"==s.Type.toString()&&""!=f&&l.ScreenObject.GridDataColumns.Contains(f)&&!a.e.IsEmpty(s[f])&&0!=parseInt(s[f].toString())){for(j=0,I=0,i.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&Object(o.j)(i.a.SessionManager.Preferences.EnableDivisionWise)&&i.a.SessionManager.Preferences.ContainsKey("DW SNOS")&&Object(o.j)(i.a.SessionManager.Preferences["DW SNOS"])&&(null!=(v=this.Parent.ScreenObject._CCFields.find((function(e){return"dcccnid1"==e.DBColumnName.toLowerCase()})))&&null!=v&&v instanceof c.b&&v.SelectedValue>0?j=v.SelectedValue:null!=s&&s.Table.Columns.Contains("dcCCNID1_Key")&&!a.e.IsEmpty(s.dcCCNID1_Key)&&(j=parseInt(s.dcCCNID1_Key.toString()))),i.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&Object(o.j)(i.a.SessionManager.Preferences.EnableLocationWise)&&i.a.SessionManager.Preferences.ContainsKey("LW SNOS")&&Object(o.j)(i.a.SessionManager.Preferences["LW SNOS"])&&(null!=(v=this.Parent.ScreenObject._CCFields.find((function(e){return"dcccnid2"==e.DBColumnName.toLowerCase()})))&&null!=v&&v instanceof c.b&&v.SelectedValue>0?I=v.SelectedValue:null!=s&&s.Table.Columns.Contains("dcCCNID2_Key")&&!a.e.IsEmpty(s.dcCCNID2_Key)&&(I=parseInt(s.dcCCNID2_Key.toString()))),N=i.a.document.GetSerialNumberScreenDetails(parseInt(s.ProductID_Key),0,0,j,I,!1),T=parseFloat(s[f].toString()),G="",G+="<xml>",M=0;M<N.Tables[1].length&&!(M>=Math.abs(T));M++)G+='<Row SerialNumber="'+N.Tables[1][M].SerialNumber.toString()+'" Quantity="1"  StatusID="158" ',G+=' RefInvDocDetailsID="'+N.Tables[1][M].InvDocDetailsID.toString()+'" SerialGUID="'+N.Tables[1][M].SerialGUID.toString()+'" IsIssue="1" IsAvailable="0"',G+=" >",G+="</Row>";G+="</xml>",s.ExtraXML=G.toString()}else"5"==s.Type.toString()&&""!=f&&l.ScreenObject.GridDataColumns.Contains(f)&&a.e.IsEmpty(s[f])&&0!=parseFloat(s[f].toString())&&l.fillbatches(s,"",!0);l.CalculateTotals(null,!1),l.ScreenObject.UpdateSequence(),l.ScreenObject.AvgrateExists&&this.CalcAvgRate(l),i.a.page.addNewTab({component:S.AddEditDocumentComponent,params:{obj:l}}),l.RefreshGrid=!l.RefreshGrid;case 18:case"end":return e.stop()}}),e,this)})))}},{key:"CalcAvgRate",value:function(e){var t=[];i.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise AverageRate")&&a.e.IntTryParse(i.a.SessionManager.Preferences["Maintain Dimensionwise AverageRate"])>5e4&&t.push(parseInt(i.a.SessionManager.Preferences["Maintain Dimensionwise AverageRate"])),i.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&Object(o.j)(i.a.SessionManager.Preferences.EnableLocationWise)&&i.a.SessionManager.Preferences.ContainsKey("Location AverageRate")&&Object(o.j)(i.a.SessionManager.Preferences["Location AverageRate"])&&t.push(50002),i.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&Object(o.j)(i.a.SessionManager.Preferences.EnableDivisionWise)&&i.a.SessionManager.Preferences.ContainsKey("Division AverageRate")&&Object(o.j)(i.a.SessionManager.Preferences["Division AverageRate"])&&t.push(50001);var n="";n+="<PXML>";for(var r="",s=0;s<e.ScreenObject._CCFields.length;s++){var l=e.ScreenObject._CCFields[s];l instanceof c.b&&l.DBColumnName.Contains("TO")&&5==e.ScreenObject.DocumentType||l instanceof c.b&&l.SelectedValue>0&&t.Contains(l.CCID)&&(r+=" and dcCCNID"+(l.CCID-5e4).toString()+"="+l.SelectedValue.toString()+" ")}for(var u=function(i){if(!a.e.StringIsNullOrEmpty(e.ScreenObject.GridData[i].ProductID_Key)){var o="",s=a.e.DoubleTryParse(e.ScreenObject.GridData[i].Quantity);0==s&&(s=1),n+="<Row ",n+=' ProductID="'+e.ScreenObject.GridData[i].ProductID_Key.toString()+'" ',n+=' QTY="'+s+'" ',n+=' DETAILSID="'+e.ScreenObject.GridData[i].DocDetailsID.toString()+'" ',e.ScreenObject.ColumnSource.forEach((function(n){n.CostCenterID>5e4&&t.Contains(n.CostCenterID)&&e.ScreenObject.GridDataColumns.Contains(n.ValueMember)&&!a.e.StringIsNullOrEmpty(e.ScreenObject.GridData[i][n.ValueMember])&&(o+=" and dcCCNID"+(n.CostCenterID-5e4).toString()+"="+e.ScreenObject.GridData[i][n.ValueMember].toString()+"  ")})),n+=' avgwhere="'+o+r+'" ></Row> '}},b=0;b<e.ScreenObject.GridData.length;b++)u(b);n+="</PXML>";var D=e.ScreenObject.GetReconcileAvgRate(n.toString(),e.DocumentDate);if(null!=D&&D.Tables.length>0&&D.Columns[0].Contains("invid"))for(var S=function(t){if(!a.e.StringIsNullOrEmpty(e.ScreenObject.GridData[t].ProductID_Key)){var n=D.Tables[0].filter((function(n){return n.invid==e.ScreenObject.GridData[t].DocDetailsID}));n.length>0&&(e.ScreenObject.GridData[t].AVGRATE=a.e.StringIsNullOrEmpty(n[0].AvgRate)?0:n[0].AvgRate.toString(),e.CalculateTotals(e.ScreenObject.GridData[t],!0))}},d=0;d<e.ScreenObject.GridData.length;d++)S(d)}},{key:"save",value:function(){this.ProgressMax=this.LineNo;var e=0,t="",n=1;if(!this.oParent.ScreenObject.IsNameAutoGenerate){var r;t=this.oParent.Name.Text;for(var o=!1,s=0;s<t.length;s++)if(!a.e.IsDigit(t[t.length-s-1])){if(s<=15&&(o=!0,s>0)){r=t.substr(t.length-s);for(var c=0;c<r.length&&"0"==r[c];c++)s--;n=parseInt(t.substr(t.length-s)),t=t.substr(0,t.length-s),n++}break}if(!o&&null!=t&&""!=t.trim()){var l=t.length;l>15?(l=15,r=t.substr(t.length-l)):r=t;for(var u=0;u<r.length&&"0"==r[u];u++)l--;n=parseInt(t.substr(t.length-l)),t=t.substr(0,t.length-l),n++}}for(var b=0;b<this.LineNo;b++,n++){var D=this.oParent.objCostCenter.SaveCostCenter();this.oParent.objCostCenter.NodeID=0;var S={StrCode:this.oParent.objCostCenter.Code,CodePrefix:this.oParent.objCostCenter.CodePrefix,CodeNumber:this.oParent.objCostCenter.CodeNumber};if(this.DisplayMessage=this.oParent.ScreenObject.SetAutoCodeParams(this.oParent.Code,this.oParent.GroupID,this.oParent.ScreenObject.Data.Tables[7]),this.oParent.objCostCenter.Code=S.StrCode,this.oParent.objCostCenter.CodePrefix=S.CodePrefix,this.oParent.objCostCenter.CodeNumber=S.CodeNumber,!(this.DisplayMessage.length>0)){var d=this.oParent.ScreenObject.Data.Tables[7].filter((function(e){return 1==e.IsName}));this.oParent.ScreenObject.IsName=!0,d.length>0&&(this.oParent.Name.Text=this.oParent.ScreenObject.IsNameAutoGenerate?this.oParent.ScreenObject.SetAutoCodeParams(this.oParent.Name,this.oParent.GroupID,d):t+n.toString(),this.oParent.objCostCenter.Name=this.oParent.Name.Text),D<0&&e++,this.ProgressValue++,this.InProgress=this.ProgressValue+" of "+this.ProgressMax}}this.LineNo>0&&this.LineNo>e&&(this.oParent.RetValue=1),this.oParent.DisplayMessage=i.a.GetResource("UOM_Saved")+" :"+(this.LineNo-e).toString()}}]),s}(s.b)},Tvp0:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n("fXoL");function i(e,t){if(1&e){var n=r.ac();r.Zb(0,"input",11),r.hc("ngModelChange",(function(e){return r.Ic(n),r.lc(2).obj.LineNo=e})),r.Yb()}if(2&e){var i=r.lc(2);r.tc("ngModel",i.obj.LineNo)}}function a(e,t){if(1&e&&(r.Zb(0,"div",12),r.Wc(1,"\n                "),r.Vb(2,13),r.Wc(3,"\n            "),r.Yb()),2&e){var n=r.lc(2);r.Db(2),r.tc("obj",n.obj.FromDate)}}function o(e,t){if(1&e&&(r.Zb(0,"div",12),r.Wc(1,"\n                "),r.Vb(2,13),r.Wc(3,"\n                "),r.Vb(4,13),r.Wc(5,"\n            "),r.Yb()),2&e){var n=r.lc(2);r.Db(2),r.tc("obj",n.obj.Dimension),r.Db(2),r.tc("obj",n.obj.Options)}}function s(e,t){if(1&e&&(r.Zb(0,"div"),r.Wc(1,"\n            "),r.Zb(2,"label",8),r.Wc(3),r.Yb(),r.Wc(4,"\n            "),r.Uc(5,i,1,1,"input",9),r.Wc(6,"\n            "),r.Uc(7,a,4,1,"div",10),r.Wc(8,"\n            "),r.Uc(9,o,6,2,"div",10),r.Wc(10,"\n        "),r.Yb()),2&e){var n=r.lc();r.Db(3),r.Yc("",n.obj.Label," "),r.Db(2),r.tc("ngIf",n.obj.TextVisibility),r.Db(2),r.tc("ngIf",n.obj.FromDate.Visible),r.Db(2),r.tc("ngIf",n.obj.DimVisibility)}}function c(e,t){if(1&e&&(r.Zb(0,"div",14),r.Wc(1,"\n            "),r.Ub(2,"app-PactGridView",15),r.Wc(3,"  \n        "),r.Yb()),2&e){var n=r.lc();r.Db(2),r.tc("obj",n.obj.Documents)("group",n.form)}}var l=function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"ngOnInit",value:function(){}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=r.Nb({type:e,selectors:[["app-go-to-line"]],inputs:{obj:"obj"},decls:25,vars:8,consts:[[1,"master-screen",2,"padding-bottom","4px","width","300px"],[1,"PACTHeaderFields","row","form-row","dialogSubBody"],[4,"ngIf"],["class","row form-row","style","width: 100%;",4,"ngIf"],[1,"Pactdailogfooter"],[1,"primary-btn-wicon",3,"click"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-rectangle-xmark"],[1,"input_cntrl_label"],["autocomplete","off","class","input_cntrl",3,"ngModel","ngModelChange",4,"ngIf"],["class","form-group col-xl-12 col-md-12 col-sm-12 col-xs-12 PACTControl",4,"ngIf"],["autocomplete","off",1,"input_cntrl",3,"ngModel","ngModelChange"],[1,"form-group","col-xl-12","col-md-12","col-sm-12","col-xs-12","PACTControl"],["FieldDirective","",3,"obj"],[1,"row","form-row",2,"width","100%"],[2,"width","100%",3,"obj","group"]],template:function(e,t){1&e&&(r.Zb(0,"div",0),r.Wc(1,"\n    "),r.Zb(2,"div",1),r.Wc(3,"\n        "),r.Uc(4,s,11,4,"div",2),r.Wc(5,"\n        "),r.Uc(6,c,4,2,"div",3),r.Wc(7,"\n    "),r.Yb(),r.Wc(8,"\n    "),r.Zb(9,"div",4),r.Wc(10,"\n      "),r.Zb(11,"div"),r.Wc(12,"\n        "),r.Zb(13,"button",5),r.hc("click",(function(){return t.obj.OnButtonClick("OK")})),r.Wc(14),r.mc(15,"translate"),r.Yb(),r.Wc(16,"\n        "),r.Zb(17,"button",6),r.hc("click",(function(){return t.obj.OnButtonClick("Cancel")})),r.Ub(18,"i",7),r.Wc(19),r.mc(20,"translate"),r.Yb(),r.Wc(21,"\n      "),r.Yb(),r.Wc(22,"\n  "),r.Yb(),r.Wc(23,"\n"),r.Yb(),r.Wc(24,"\n")),2&e&&(r.Db(4),r.tc("ngIf",t.obj.LineVisibility),r.Db(2),r.tc("ngIf",t.obj.GridVisibility),r.Db(8),r.Xc(r.nc(15,4,"Ok")),r.Db(5),r.Xc(r.nc(20,6,"Cancel")))},encapsulation:2}),e}()}}]);
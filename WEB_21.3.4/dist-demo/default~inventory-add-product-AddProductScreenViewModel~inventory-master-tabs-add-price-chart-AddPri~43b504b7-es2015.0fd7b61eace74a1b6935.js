(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{J5xz:function(e,t,s){"use strict";s.r(t),s.d(t,"AddTaxChartNewViewModel",(function(){return I}));var i=s("8B8H"),a=s("ockk"),l=s("0/4Q"),n=s("Do2H"),r=s("Lp6j"),o=s("eQJW"),h=s("EQd/"),u=s("JIg3"),d=s("ZDA+"),c=s("8iaB"),C=s("7JXL"),D=s("XFVb"),m=s("6z9j"),g=s("/G+I"),T=s("4HhE");class I extends c.a{constructor(){super(),this.Module="INV",this.ClassName="AddTaxChartNewViewModel",this.Visible=!0,this.contextVisible=!0,this.ProfileID=0,this.SelectedNodeID=0,this.Mode="",this.DeletedIDs=new Array,this.oChart=new D.a,this.DisplayName="",this.FilterVisibility=!1,this.IsEdit=!1,this._IsEditFilter=!1,this._GenerateVisibility=!0,this.ColumnSpan="",this.TreeViewModel=null,this.PriceChartAtProduct=!1,this.RightPanelVisibility=!0,this.MessageVisibility=!1,this.Title="",this.DisplayMessage="",this.CopyVisible=!1,this.Name=new h.d(0),this.Documents=new l.e(0),this.Columns=new l.e(0),this.Price=new h.d(0),this.WEF=new u.a(0),this.TillDate=new u.c(0),this.MultipleDocs=!1,this.StatusID=1,this.CreatedBy=0,this.HasAccess=!1,this.dtDocFields=[],this.dblPrice=0,this.stkValue="",this.stkCC=null,this.stkID=null,this.stkName=null,this.dbQuery="",this.sbQuery="",this.CCUpdate="",this.lstTemp=new Array,this.lstTempCC=new Array,this.SelectedDocument="",this.SelectedColumn="",this.SelectedColumnName=""}get IsEditFilter(){return this._IsEditFilter}set IsEditFilter(e){e!=this._IsEditFilter&&(e&&(this.GenerateVisibility=!1),this._IsEditFilter=e)}get GenerateVisibility(){return this._GenerateVisibility}set GenerateVisibility(e){e!=this._GenerateVisibility&&(e&&(this.IsEditFilter=!1),this._GenerateVisibility=e)}AddTaxChartNewViewModel(e,t,s=0){this.ProfileID=t,this.Mode=e,this.SelectedNodeID=s,this.TillDate.Date=null,this.SetTitle(),this.MessageVisibility=!1,this.DisplayMessage="",this.Documents.SelectionChangedCommand.Subscribe(this,"OnDocumentChange"),this.tree=[],this.CostCenters=new l.e(0),this.CostCenterFilters=[],this.CostCenters.SelectionChangedCommand.Subscribe(this,"OnCostCenterChange"),this.InitControls(),this.Clear(),this.FilterVisibility=!0}InitControls(){this.Name.Label=n.a.GetResource("Com_Contacts_Name"),this.WEF.Label=n.a.GetResource("Service_WEF"),this.TillDate.Label=n.a.GetResource("TillDate"),this.Price.Label=n.a.GetResource("Value"),this.Documents.Label=n.a.GetResource("Doc_LinkDocument"),this.Columns.Label=n.a.GetResource("Import_Column"),this.CostCenters.Label=n.a.GetResource("CostCenter_CostCenterslist"),this.MultipleDocuments=new l.b,this.MultipleDocuments.Label="Documents";let e=n.a.inventory.GetTaxChart(0,this.ProfileID,"");if("EDIT"==this.Mode){this.Name.Text=e.Tables[2][0].ProfileName.toString(),this.StatusID=parseInt(e.Tables[2][0].StatusID),e.Tables.length>4&&e.Tables[4].length>0&&(this.CreatedBy=parseInt(e.Tables[4][0].UserID),this.HasAccess=Object(o.j)(e.Tables[4][0].HasAccess));for(let t=0;t<e.Tables[0].length;t++){let s=l.d.ComboBoxItems_2(e.Tables[0][t].NAME.toString(),e.Tables[0][t].ID.toString());if(this.CostCenters.Items.push(l.d.ComboBoxItems_2(e.Tables[0][t].NAME.toString(),e.Tables[0][t].ID.toString())),e.Tables[3].filter(e=>e.CostCenterID==s.Value).length>0){s.Aliasname="BOLD";let e=new C.a(parseInt(s.Value),"",s.Name,this);e.SelectedNodes=[],this.CostCenterFilters.push(e)}}}else if("SEARCH"==this.Mode)for(let i=0;i<e.Tables[0].length;i++)this.CostCenters.Items.push(l.d.ComboBoxItems_2(e.Tables[0][i].NAME.toString(),e.Tables[0][i].ID.toString())),e.Tables[3].filter(t=>t.CostCenterID==e.Tables[0][i].ID.toString()).length>0&&(this.CostCenters.Items[this.CostCenters.Items.length-1].Aliasname="BOLD");else for(let i=0;i<e.Tables[0].length;i++)this.CostCenters.Items.push(l.d.ComboBoxItems_2(e.Tables[0][i].NAME.toString(),e.Tables[0][i].ID.toString()));this.CostCenters.SelectedValue="2",this.OnCostCenterChange(null);for(let i=0;i<e.Tables[1].length;i++)this.Documents.Items.push(l.d.ComboBoxItems_2(e.Tables[1][i].NAME.toString(),e.Tables[1][i].ID.toString())),this.MultipleDocuments.Items.push(l.c.CheckedListBoxItem_3(e.Tables[1][i].NAME.toString(),e.Tables[1][i].ID.toString()));this.Documents.Items.length>0&&(this.Documents.SelectedValue="40011",this.OnDocumentChange("")),this.TaxGrid=new i.a,this.TaxGrid.OnLinkClick.Subscribe(this,"OnGridLinkClick"),this.TaxGrid.OnPreviewKeyDown.Subscribe(this,"OnPreviewKeyDown"),this.TaxGrid.TableColumns.push("sno"),this.TaxGrid.TableColumns.push("select"),this.TaxGrid.TableColumns.push("Document_Key"),this.TaxGrid.TableColumns.push("Column"),this.TaxGrid.TableColumns.push("Column_Key"),this.TaxGrid.TableColumns.push("Combination"),this.TaxGrid.TableColumns.push("Price"),this.TaxGrid.TableColumns.push("wef"),this.TaxGrid.TableColumns.push("wef_Key"),this.TaxGrid.TableColumns.push("tillDate"),this.TaxGrid.TableColumns.push("tillDate_Key"),this.TaxGrid.TableColumns.push("CC"),this.TaxGrid.TableColumns.push("CCID"),this.TaxGrid.TableColumns.push("Query"),this.TaxGrid.TableColumns.push("Action"),this.TaxGrid.TableColumns.push("CCTaxID"),this.TaxGrid.TableColumns.push("ProfileName"),this.TaxGrid.TableColumns.push("Message"),this.TaxGrid.Table=[];let t=[],s=new a.a;s.Header=n.a.GetResource("Service_Sno"),s.DisplayMember="sno",s.ReadOnly=!0,s.IsFrozen=!0,s.Width=45,t.push(s),this.CopyVisible&&(s=new a.a,s.Header="",s.DisplayMember="select",s.DataType="CheckBox",s.IsFrozen=!0,s.Width=30,t.push(s)),this.PriceChartAtProduct||(s=new a.a,s.Header=n.a.GetResource("Service_Action"),s.DisplayMember="Action",s.DataType="LINK",s.ReadOnly=!0,s.IsFrozen=!0,s.Width=60,t.push(s)),"SEARCH"==this.Mode&&(s=new a.a,s.Header="ProfileName",s.DisplayMember="ProfileName",s.ReadOnly=!0,s.Width=120,s.IsFrozen=!0,t.push(s));let r=[];e.Tables[1].forEach(e=>{let t={};t.CostCenter=e.NAME.toString(),t.CostCenterID=e.ID.toString(),r.push(t)}),s=new a.a,s.Header="Document",s.DataType="ComboBox",s.DisplayMember="CostCenter",s.ValueMember="CostCenterID",s.ValueBinding="Document_Key",s.Width=180,s.IsFrozen=!0,s.ComboData=r,t.push(s),s=new a.a,s.Header="Column",s.DataType="PactComboBox",s.DisplayMember="Column",s.ValueMember="ColumnID",s.ValueBinding="Column",s.FilterCondition="Document_Key={0}",s.FilterColumn="Document_Key",s.Width=90,s.IsFrozen=!0,s.ComboData=this.dtDocFields,t.push(s),s=new a.a,s.Header=n.a.GetResource("Price"),s.DisplayMember="Price",s.DataType="FLOAT",s.DecimalPoints=n.a.SessionManager.Preferences.DecimalsinAmount,s.Width=100,t.push(s),s=new a.a,s.Header=n.a.GetResource("Service_WEF"),s.DisplayMember="wef",s.DataType="DATE",s.Width=115,t.push(s),s=new a.a,s.Header=n.a.GetResource("TillDate"),s.DisplayMember="tillDate",s.DataType="DATE",s.Width=115,t.push(s),s=new a.a,s.Header=n.a.GetResource("Service_Combination"),s.DisplayMember="Combination",s.ReadOnly=!0,s.DefaultValue="Select",s.Width=260,t.push(s),s=new a.a,s.Header=n.a.GetResource("DocumentDesigner_Message"),s.DisplayMember="Message",s.Width=150,t.push(s),this.TaxGrid.SelectAll.Visible=!0,this.TaxGrid.SearchVisible=!0,this.TaxGrid.SortVisible=!0,this.TaxGrid.SearchColStartIndex="SEARCH"==this.Mode?2:3,this.TaxGrid.Columns=t,this.TaxGrid.CellEditEnding.Subscribe(this,"OnGridCellEditEnding")}OnPreviewKeyDown(e,t){let s="";if(e.grid.getCellEditor()&&e.grid.getCellEditor().args.column.name&&(s=e.grid.getCellEditor().args.column.name),"F6"==t.Key){if(!confirm(" Do you want to override all.? "))return!0;let t=this.TaxGrid.Table;for(let i=0;i<t.length;i++)t[i][s]=e[s].toString(),this.TaxGrid.TableColumns.Contains(s+"_Key")&&(t[i][s+"_Key"]=e[s+"_Key"].toString()),this.TaxGrid.updateRow(t[i]);return!0}return!1}SetTitle(){let e="";"ADD"==this.Mode?e="Add Tax Chart":"EDIT"==this.Mode?(e="Edit Tax Chart",this.IsEdit=!0,this.IsEditFilter=!0,this.CopyVisible=!0):"SEARCH"==this.Mode?(e="Search Tax Chart",this.GenerateVisibility=!1,this.CopyVisible=!1):"PRODUCT_SEARCH"==this.Mode&&(this.GenerateVisibility=!1,this.CopyVisible=!1,this.Mode="SEARCH",this.Title="",this.PriceChartAtProduct=!0,this.Name.Visible=!1),this.Title=e,this.DisplayName=e}OnButtonClick(e){if("FilterCancel"==e)this.FilterVisibility=!1;else if("ShowFilter"==e)this.FilterVisibility=!0;else if("Generate"==e)"EDIT"==this.Mode?this.IsEditFilter?this.LoadEditData():this.GenerateClick():"SEARCH"==this.Mode?this.LoadEditData():this.GenerateClick();else if("Load"==e)I.LoadDimensionNodes(this,this.ProfileID);else if("Save"==e)this.SaveClick();else if("CLEAR"==e)this.Clear();else if("Copy"==e){let e=this.TaxGrid.Table.filter(e=>1==e.select),t=this.TaxGrid.Table.length,s=null;e.forEach(e=>{e.select=!1;let t=this.TaxGrid.NewRow();for(let s=0;s<this.TaxGrid.TableColumns.length;s++)t[this.TaxGrid.TableColumns[s]]=e[this.TaxGrid.TableColumns[s]];t.wef=(new Date).Date().ToString(n.a.SessionManager.Preferences["Date Format"]),t.wef_key=(new Date).Date(),t.select=!1,t.CCTaxID=null,t.sno=this.TaxGrid.Table.length+1,null==s&&(s=t),this.TaxGrid.addRow(t)}),e.length>0?(this.DisplayMessage="Duplicate rows added at end",this.TaxGrid.SelectedItem=this.TaxGrid.Table[t]):this.DisplayMessage="Please select row to copy"}}LoadEditData(){let e=1,t="",s="",i="";this.CostCenterFilters.forEach(a=>{if(2==a.CostCenterID?(t="AccountID",s="T.AccountID"):3==a.CostCenterID?(t="ProductID",s="T.ProductID"):a.CostCenterID>5e4&&(e=2,t="NodeID",s="T.CCNID"+(a.CostCenterID-5e4)),a.SelectedNodes.length>0){if(1==a.SelectedNodes.length)i+=" AND ",i+=s+"="+a.SelectedNodes[0].Id;else if(null==a.SelectedNodes.find(t=>t.Id==e&&t.IsGroup))if(i+=" AND ",g.IPrefetchFilter.IsGroupTree(a)){let e="";for(let t=0;t<a.SelectedNodes.length;t++)null!=a.SelectedNodes[t].Parent&&a.SelectedNodes[t].Parent.IsSelected||(e.length>0&&(e+=","),e+=a.SelectedNodes[t].Id);0==e.length&&(e+=-12912),i+=s+" IN ",i+=" (select T."+t+" GTID from "+r.e.GetTagTableName(a.CostCenterID)+" T with(nolock),"+r.e.GetTagTableName(a.CostCenterID)+" GTP with(nolock) where T.lft BETWEEN GTP.lft AND GTP.rgt AND GTP."+t+" IN ( "+e.toString()+")  group by T."+t+")"}else{i+=s+" IN (";for(let e=0;e<a.SelectedNodes.length;e++)e>0&&(i+=","),i+=a.SelectedNodes[e].Id;i+=")"}}else a.DeleteButtonVisibility||(i+=" AND ",i+=s+"=-12912")}),this.LoadProfileData(-1,0,(new Date).Date(),"",i.toString()),this.FilterVisibility=!1}static LoadDimensionNodes(e,t){let s=n.a.inventory.GetTaxChart(8,t,e instanceof I?"2":"1");for(let a=0;a<s.Tables[0].length;a++){let t=parseInt(s.Tables[0][a].CostCenterID);var i=e.CostCenterFilters.find(e=>e.CostCenterID==t);null==i&&((i=new C.a(t,"",s.Tables[0][a].Name.toString(),e)).SelectedNodes=[],e.CostCenterFilters.push(i)),null==i.SelectedNodes?i.SelectedNodes=[]:i.SelectedNodes.Clear();let l="";for(let e=0;e<s.Tables[a+1].length;e++){const t=s.Tables[a+1][e];let n=new d.a;if(n.Id=parseInt(t.PK),n.Text.push(t.Name.toString()),n.IsSelected=!0,n.IsGroup=Object(o.j)(t.IsGroup),i.SelectedNodesTag=n.Text[0],i.SelectedNodes.push(n),l.length<146&&(l.length>0&&(l+=", "),l+=t.Name.toString(),l.length>140)){l+=" . . .";break}}i.SelectedNodesTag=l,e.tree[0].CostCenterID==i.CostCenterID&&(e.tree[0].RefreshData=!0)}}OnGridLinkClick(e,t,s){"Action"==t&&(null!=e.CCTaxID&&parseInt(e.CCTaxID)>0&&!this.DeletedIDs.Contains(parseInt(e.CCTaxID))&&this.DeletedIDs.push(parseInt(e.CCTaxID)),this.TaxGrid.removeRow(e),this.TaxGrid.RefreshSno())}OnGridCellEditEnding(e,t,s){if("Document_Key"==e.column.field)try{if(e.args.item.Document_Key.toString().length>0&&this.LoadDocumentFields(parseInt(e.args.item.Document_Key)),e.args.item.Column.toString().length>0&&0==this.dtDocFields.filter(t=>t.Document_Key==e.args.item.Document_Key.toString()&&t.ColumnID==e.args.item.Column.toString()).length){let t=this.dtDocFields.filter(t=>t.Document_Key==e.args.item.Document_Key.toString()&&t.Column==e.args.item.Column_Key.toString());t.length>0?e.args.item.Column=t[0].ColumnID:(e.args.item.Column=null,e.args.item.Column_Key=null),this.TaxGrid.updateRow(e.args.item)}}catch(i){}}onCopy(e){"DataGridPactListBoxColumn"==e.column.className&&e.grid.getEditorLock().commitCurrentEdit();let t="";if(t=e.column.field,t=e.column.field,"Price"==t||"wef"==t||"tillDate"==t||"Message"==t){var s=confirm("Do you want to override all?\nNo to copy blank.");for(let i=0;i<this.TaxGrid.Table.length;i++)if("DataGridPactListBoxColumn"==e.column.className&&e.grid.getEditorLock().commitCurrentEdit(),""!=this.TaxGrid.Table[i].Document_Key.toString()){if(0==s&&!r.e.IsEmpty(this.TaxGrid.Table[i][t])&&0==parseFloat(this.TaxGrid.Table[i][t].toString()))continue;if(this.TaxGrid.Table[i][t]=e.item[t].toString(),"DataGridDateTimeColumn"==e.column.className||"DataGridDateColumn"==e.column.className&&this.TaxGrid.TableColumns.Contains(t+"_key"))this.TaxGrid.Table[i][t+"_key"]=e.item[t+"_key"].toString();else if("DataGridPactListBoxColumn"==e.column.className){let s=this.TaxGrid.Columns.find(e=>e.DisplayMember==t);null!=s&&(this.TaxGrid.Table[i][s.ValueMember]=e.item[s.ValueMember].toString())}}}}ChangeColumns(){this.Columns.Items.Clear(),this.MultipleDocs?(this.LoadDocumentFields(401),this.dtDocFields.filter(e=>401==e.Document_Key).forEach(e=>{this.Columns.Items.push(l.d.ComboBoxItems_2(e.Column.toString(),e.ColumnID.toString()))})):(this.LoadDocumentFields(parseInt(this.Documents.SelectedValue)),this.dtDocFields.filter(e=>e.Document_Key==this.Documents.SelectedValue).forEach(e=>{this.Columns.Items.push(l.d.ComboBoxItems_2(e.Column.toString(),e.ColumnID.toString()))})),this.Columns.Items.length>0&&(this.Columns.SelectedItem=this.Columns.Items[0],this.Columns.SelectedValue=this.Columns.Items[0].Value)}LoadDocumentFields(e){if(0==this.dtDocFields.filter(t=>t.Document_Key==e).length){n.a.inventory.GetTaxChart(1,e,"").Tables[0].forEach(t=>{let s={};s.Document_Key=e,s.Column=t.ColumnName,s.ColumnID=parseInt(t.ID),s.Index=parseInt(t.Index),this.dtDocFields.push(s)});let t={};t.Document_Key=e,t.Column="Message",t.ColumnID=-1,t.Index=-1,this.dtDocFields.push(t)}}SaveClick(){if("SEARCH"!=this.Mode&&r.e.IsEmpty(this.Name.Text))return void(this.DisplayMessage="Select "+this.Name.Label);if(this.ProfileID>0&&1!=this.StatusID&&(parseInt(n.a.SessionManager.UserID)!=this.CreatedBy||!this.HasAccess))return void(this.DisplayMessage="In-Active profiles can not be modified");let e=this.TaxGrid.Table.filter(e=>null==e.Column||""==e.Column);if(e.length>0){let t=this.TaxGrid.Table.indexOf(e[0]);return t>=0&&t<this.TaxGrid.Table.length&&(this.TaxGrid.SelectedItem=this.TaxGrid.Table[t]),void(this.DisplayMessage="Please select document field")}let t=0,s="";for(let a=0;a<this.TaxGrid.Table.length;a++){const e=this.TaxGrid.Table[a];if(s+="<Row ",null!=e.CCTaxID&&(s+=' CCTaxID="'+r.e.String(e.CCTaxID)+'"'),s+=' DocID="'+r.e.String(e.Document_Key)+'"',s+=' ColID="'+r.e.String(e.Column)+'"',s+=r.e.String(e.Query),t=r.e.Double(e.Price),0==t&&"-1"!=r.e.String(e.Column))return void(this.DisplayMessage="Price instanceof Zero at row "+e.sno.toString());if(s+=' Price="'+e.Price+'"',!r.e.IsEmpty(e.wef_key)&&r.e.isValidDate(e.wef_key)?s+=' WEF="'+new Date(e.wef_key).ToString("dd/MMM/yyyy")+'"':s+=' WEF="'+this.WEF.Date.ToString("dd/MMM/yyyy")+'"',!r.e.IsEmpty(e.tillDate_key)&&r.e.isValidDate(e.tillDate_key)&&(s+=' TillDate="'+new Date(e.tillDate_key).ToString("dd/MMM/yyyy")+'"'),"-1"==r.e.String(e.Column)){if(""==r.e.String(e.Message))return void(this.DisplayMessage="Enter Message at row "+e.sno.toString());s+=' Message="'+e.Message+'"'}else s+=' Message=""';s+="/>"}let i="";if(this.DeletedIDs.length>0&&(i+="<XML>",this.DeletedIDs.forEach(e=>{i+='<Row  ID="'+e+'" />'}),i+="</XML>"),s.length>0||i.length>0){s="<XML>"+s+"</XML>";let e,t="",a=this.oChart.SetTaxChartNew(this.ProfileID,this.Name.Text,this.SelectedNodeID,!1,s.toString(),i.toString(),!1);t=a.Message,e=a.RetValue,e>0&&("EDIT"==this.Mode||(null!=this.TreeViewModel&&this.TreeViewModel.Refresh(),this.Name.Text=""),this.Clear()),this.DisplayMessage=t}}Clear(){this.TaxGrid.Clear(),this.DeletedIDs.Clear()}OnDocumentChange(e){this.ChangeColumns()}GenerateClick(){if(this.dblPrice=0,this.DisplayMessage="",r.e.IsEmpty(this.Price.Text)){if("-1"!=this.Columns.SelectedValue)return void(this.DisplayMessage="Enter "+this.Price.Label)}else try{if(this.dblPrice=r.e.Double(this.Price.Text),0==this.dblPrice&&"-1"!=this.Columns.SelectedValue)return void(this.DisplayMessage="Invalid "+this.Price.Label)}catch(i){}let e,t=new Array;if(this.MultipleDocs){if(0==this.MultipleDocuments.Items.filter(e=>e.IsChecked).length)return void(this.DisplayMessage="Select Documents");for(let e=0;e<this.MultipleDocuments.Items.filter(e=>e.IsChecked).length;e++){const s=this.MultipleDocuments.Items.filter(e=>e.IsChecked)[e];if(t.push(s.Value),this.LoadDocumentFields(parseInt(s.Value)),0==this.dtDocFields.filter(e=>e.Document_Key==s.Value&&e.Index==this.Columns.SelectedValue).length)return void(this.DisplayMessage=this.Columns.GetselectedItem().Name+" not exists in document - "+s.Name)}}else{if(null==this.Documents.SelectedItem)return void(this.DisplayMessage="Select "+this.Documents.Label);if(null==this.Columns.SelectedItem)return void(this.DisplayMessage="Select "+this.Columns.Label)}this.lstTemp.Clear(),this.lstTempCC.Clear();let s=this.CostCenterFilters.sort((e,t)=>e.CostCenterID-t.CostCenterID);for(let a=0;a<s.length;a++){const t=s[a];if(t.HideFilter.IsChecked){if(e=t.SelectedNodes.filter(e=>!e.IsGroup),0==e.length)return void(this.DisplayMessage="Please Select "+t.CostCenter)}else{e=new Array;for(let s=0;s<t.SelectedNodes.length;s++)null!=t.SelectedNodes[s].Parent&&t.SelectedNodes[s].Parent.IsSelected||e.push(t.SelectedNodes[s]);if(0==e.length)return void(this.DisplayMessage="Please Select "+t.CostCenter)}this.lstTemp.push(e),this.lstTempCC.push(t.CostCenterID)}this.MultipleDocs?t.forEach(e=>{this.SelectedDocument=e;let t=this.dtDocFields.filter(t=>t.Document_Key==e&&t.Index==this.Columns.SelectedValue);t.length>0&&(this.SelectedColumn=t[0].ColumnID.toString(),this.SelectedColumnName=t[0].Column.toString(),this.GenerateForDocument())}):(this.SelectedDocument=this.Documents.SelectedItem.Value,this.SelectedColumn=this.Columns.SelectedItem.Value,this.SelectedColumnName=this.Columns.SelectedItem.Name,this.GenerateForDocument()),this.FilterVisibility=!1}GenerateForDocument(){let e=this.lstTemp.length;if(this.stkCC=new Array(e),this.stkID=new Array(e),this.stkName=new Array(e),this.lstTemp.length>0)this.CallRecursive(0);else{let e=this.TaxGrid.NewRow();e.sno="1",e.Document_Key=this.SelectedDocument,this.LoadDocumentFields(parseInt(e.Document_Key)),e.Column_Key=this.SelectedColumnName,e.Column=this.SelectedColumn,e.Price="-1"==this.SelectedColumn?0:this.dblPrice,e.wef=this.WEF.Date.ToString(n.a.SessionManager.Preferences["Date Format"]),e.wef_key=this.WEF.Date,null!=this.TillDate.Date&&(e.tillDate=this.TillDate.Date.ToString(n.a.SessionManager.Preferences["Date Format"]),e.tillDate_key=this.TillDate.Date),e.Action=n.a.GetResource("Delete"),this.TaxGrid.addRow(e)}}CallRecursive(e){for(let t=0;t<this.lstTemp[e].length;t++)if(this.stkName[e]=this.lstTemp[e][t].Text.length>1?this.lstTemp[e][t].Text[1]:this.lstTemp[e][t].Text[0],this.stkCC[e]=this.lstTempCC[e],this.stkID[e]=this.lstTemp[e][t].Id,e==this.lstTemp.length-1){let e=this.TaxGrid.NewRow();for(this.sbQuery="",this.dbQuery="",this.CCUpdate="",this.j=0;this.j<this.stkCC.length;this.j++)3==this.stkCC[this.j]?(this.sbQuery+=' ProductID="'+this.stkID[this.j]+'"',this.dbQuery+=" ProductID='"+this.stkID[this.j]+"' and "):2==this.stkCC[this.j]?(this.sbQuery+=' AccountID="'+this.stkID[this.j]+'"',this.dbQuery+=" AccountID='"+this.stkID[this.j]+"' and "):(this.CCUpdate+=",CCNID"+(parseInt(this.stkCC[this.j])-5e4)+"="+this.stkID[this.j],this.dbQuery+=" CCNID"+(parseInt(this.stkCC[this.j])-5e4)+"='"+this.stkID[this.j]+"' AND");if(this.CCUpdate.length>0&&(this.sbQuery+=' CCUpdate="'+this.CCUpdate+'"'),e.Query=this.sbQuery.toString(),this.TaxGrid.Table.filter(e=>e.Query==this.sbQuery.toString()&&e.Document_Key==this.Documents.SelectedItem.Value&&e.Column==this.Columns.SelectedItem.Value&&e.wef_Key==this.WEF.Date.ToString("dd/MMM/yyyy")).length>0)return this.DisplayMessage="Data already exists with same combination on wef date",void(this.MessageVisibility=!0);if(this.dbQuery.length>0){let t=n.a.common.GetDataSet3("PTC004",this.dbQuery,this.Documents.SelectedItem.Value+"~"+this.Columns.SelectedItem.Value,this.WEF.Date.ToString("dd/MMM/yyyy"));if(null!=t&&t.Tables.length>0&&t.Tables[0].length>0)return this.DisplayMessage="Data already exists with same combination on wef date",void(this.MessageVisibility=!0);this.TaxGrid.addRow(e)}else this.TaxGrid.addRow(e);for(e[0]=this.TaxGrid.Table.length,e.Document_Key=this.SelectedDocument,this.LoadDocumentFields(parseInt(e.Document_Key)),e.Column_Key=this.SelectedColumnName,e.Column=this.SelectedColumn,e.Price=this.dblPrice,e.wef=this.WEF.Date.ToString(n.a.SessionManager.Preferences["Date Format"]),e.wef_key=this.WEF.Date,this.TillDate.Date&&(e.tillDate=this.TillDate.Date.ToString(n.a.SessionManager.Preferences["Date Format"]),e.tillDate_key=this.TillDate.Date),e.Action=n.a.GetResource("Delete"),this.stkValue="",this.j=0;this.j<this.stkName.length;this.j++)this.stkValue.length>0&&(this.stkValue+="::"),this.stkValue+=this.stkName[this.j];e.Combination=this.stkValue}else this.CallRecursive(e+1)}LoadProfileData(e,t,s,i,a){let l,r=n.a.inventory.GetTaxChart(2,this.ProfileID,a),o=this.TaxGrid.Table;this.DeletedIDs.Clear();let h,u,d=1,c=0;r.Tables[0].forEach(a=>{for(l={},l.sno=d,l.select=!1,1==d&&(this.Documents.SelectedValue=a.DocID.toString()),l.Document_Key=a.DocID,this.LoadDocumentFields(parseInt(l.Document_Key)),l.Column_Key=a.Col,l.Column=a.ColID,l.Price=a.Value,c=parseFloat(l.Price),1==e?(c+=t,l.Price=c):2==e?(c=parseFloat(l.Price),c+=c*t/100,l.Price=c.ToString(n.a.SessionManager.Preferences.DecimalsinAmount)):3==e?(c-=t,c<0&&(c=0),l.Price=c):4==e&&(c=parseFloat(l.Price),c-=c*t/100,c<0&&(c=0),l.Price=c.ToString(n.a.SessionManager.Preferences.DecimalsinAmount)),"SEARCH"==this.Mode&&(l.ProfileName=a.ProfileName.toString()),-1==e?(l.wef=new Date(a.WEF_DATE).ToString(n.a.SessionManager.Preferences["Date Format"]),l.wef_Key=a.WEF_DATE,l.CCTaxID=a.CCTaxID,null!=a.Till_Date&&(l.tillDate=new Date(a.Till_Date).ToString(n.a.SessionManager.Preferences["Date Format"]),l.tillDate_Key=a.Till_Date)):(l.wef=s.ToString(n.a.SessionManager.Preferences["Date Format"]),l.wef_Key=s,""!=i&&(l.tillDate=new Date(i).ToString(n.a.SessionManager.Preferences["Date Format"]),l.tillDate_Key=new Date(i))),l.Message=a.Message,l.Action="Delete",this.sbQuery="",u="",parseInt(a.AccountID)>0&&(this.sbQuery+=' AccountID="'+a.AccountID+'"',u+=a.AccountName.toString()),parseInt(a.ProductID)>0&&(this.sbQuery+=' ProductID="'+a.ProductID+'"',u+=a.ProductName.toString()),h=1;h<=200;h++)Object.keys(a).Contains("CC"+h)&&Object.keys(a).Contains("CCNID"+h)&&parseInt(a["CCNID"+h])>0&&(u.length>0&&(u+="::"),u+=a["CC"+h].toString());l.Query=this.sbQuery.toString(),l.Combination=u,o.push(l),d++}),this.TaxGrid.Table=o}OnCostCenterChange(e){if(!r.e.IsEmpty(this.CostCenters.SelectedValue)&&(0==this.tree.length||this.tree[0].CostCenterID!=parseInt(this.CostCenters.SelectedValue))){let e=0;null==this.CostCenters.SelectedItem||r.e.IsEmpty(this.CostCenters.SelectedItem.Parent)||(e=r.e.Int(this.CostCenters.SelectedItem.Parent)),this.LoadCostCenterTree(parseInt(this.CostCenters.SelectedValue),e,0,null)}}LoadCostCenterTree(e,t,s,i){this.tree.Clear();let a="";50002==e&&"True"==n.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==n.a.SessionManager.Preferences["LW Reports"]&&(a=r.e.IsEmpty(n.a.SessionManager.LocationWhere)?"A.NodeID IN (-1234)":"A.NodeID IN ("+n.a.SessionManager.LocationWhere+")");let l=new m.a;if(null==i)for(let n=0;n<this.CostCenterFilters.length;n++){const s=this.CostCenterFilters[n];if(s.CostCenterID==e&&s.LookupTypeID==t){i=s.SelectedNodes;break}}null==i?l.TreeViewModel_5(e,this,s,a,""):l.TreeViewModel_6(e,this,s,a,i,""),l.LookupTypeID=t,l.HeaderVisiblity=!1,l.OnNodeSelected||(l.OnNodeSelected=new T.b,l.OnNodeSelected.Subscribe(this,"OnNodeSelected")),this.tree.push(l)}}},XFVb:function(e,t,s){"use strict";s.d(t,"a",(function(){return l}));var i=s("Do2H"),a=s("Lp6j");class l{GetPriceChart(e,t,s){try{return i.a.inventory.GetPriceChart(e,t,s)}catch(a){return Logger.ErrorLog("PriceChart:: GetPriceChart"+a.stack),null}}GetShcemesScreenDetails(e,t){try{let s,a=[];return a.push(e),a.push(t),a.push(i.a.SessionManager.UserID),a.push(i.a.SessionManager.LanguageID),s}catch(s){return Logger.ErrorLog("PriceChart:: GetPriceChartScreenDetails"+s.stack),null}}GetProductsUOM(e){try{let t=[];return t.push(e),t.push(i.a.SessionManager.UserID),t.push(i.a.SessionManager.LanguageID),i.a.inventory.GetProductsUOM(t)}catch(t){return Logger.ErrorLog("PriceChart:: GetProductUOM"+t.stack),null}}GetTaxChart(e,t,s){let a=[];a.push(e),a.push(t),a.push(s),a.push(i.a.SessionManager.UserID),a.push(i.a.SessionManager.LanguageID)}SetPriceChartNew(e,t,s,l,n,r,o,h){let u=0,d=null,c={RetValue:u,Message:""};if(0==e&&i.a.SessionManager.LicenseSettings.ContainsKey("PriceCharts")){let e,t=i.a.common.GetDataSet("PTC001","");if(u=parseInt(t.Tables[0][0][Object.keys(t.Tables[0][0])[0]]),e=a.e.Int(i.a.SessionManager.LicenseSettings.PriceCharts),u>e)return u=0,c.Message="Your License Does not Support",c.RetValue=0,c}return d=[],d.push(e),d.push(t),d.push(s),d.push(l),d.push(n),d.push(r),d.push(o),d.push(h),d.push(i.a.SessionManager.CompanyGUID),d.push(i.a.SessionManager.UserName),d.push(i.a.SessionManager.RoleID),d.push(i.a.SessionManager.LanguageID),i.a.inventory.SetPriceChartNew(d)}SetTaxChartNew(e,t,s,l,n,r,o){let h=0,u=null,d={RetValue:h,Message:""};if(0==e&&i.a.SessionManager.LicenseSettings.ContainsKey("TaxCharts")){let e;if(u=[],u.push("SELECT ISNULL(COUNT(*),0) FROM COM_CCTaxesDefn WITH(NOLOCK) WHERE IsGroup=0 AND ProfileID>0"),u.push(i.a.SessionManager.UserID),u.push(i.a.SessionManager.LanguageID),e=a.e.Int(i.a.SessionManager.LicenseSettings.TaxCharts),h>e)return h=0,d.Message="Your License Does not Support",d.RetValue=0,d}return u=[],u.push(e),u.push(t),u.push(s),u.push(l),u.push(n),u.push(r),u.push(o),u.push(i.a.SessionManager.CompanyGUID),u.push(i.a.SessionManager.UserName),u.push(i.a.SessionManager.RoleID),u.push(i.a.SessionManager.LanguageID),i.a.inventory.SetTaxChartNew(u)}DeletePriceChartNew(e){let t=[];t.push(5),t.push(e),t.push(""),t.push(i.a.SessionManager.UserID),t.push(i.a.SessionManager.LanguageID)}DeleteScheme(e){try{let t="",s=[];return s.push(5),s.push(e),s.push(i.a.SessionManager.UserID),s.push(i.a.SessionManager.LanguageID),Logger.InfoLog("PriceChart:: Success: DBH.GetShcemesScreenDetails "+(0).toString()),t}catch(t){return Logger.ErrorLog("PriceChart:: DeleteScheme"+t.stack),""}}DeleteTaxChartNew(e){let t=[];t.push(5),t.push(e),t.push(""),t.push(i.a.SessionManager.UserID),t.push(i.a.SessionManager.LanguageID)}GetProductLocationNames(e,t){try{return i.a.inventory.GetProductLocationNames(e,t)}catch(s){return Logger.ErrorLog("PriceChart:: GetProductLocationNames"+s.stack),null}}GetTagData(e){try{return i.a.inventory.GetTagData(e).Tables[0]}catch(t){return Logger.ErrorLog("PriceChart:: GetTagData"+t.stack),null}}GetPriceChartLatestData(e){try{let t=[];return t.push(e),t.push(i.a.SessionManager.UserID),t.push(i.a.SessionManager.LanguageID),i.a.inventory.GetPriceChartLatestData(t)}catch(t){return Logger.ErrorLog("PriceChart:: GetLatestPriceChartData"+t.stack),null}}}}}]);
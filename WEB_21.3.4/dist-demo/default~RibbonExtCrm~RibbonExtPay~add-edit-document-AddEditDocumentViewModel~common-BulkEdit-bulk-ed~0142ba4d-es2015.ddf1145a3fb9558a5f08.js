(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{"0LKI":function(e,t,i){"use strict";i.d(t,"b",(function(){return o})),i.d(t,"a",(function(){return l})),i.d(t,"c",(function(){return a}));var n,r=i("Do2H"),s=function(e){return e[e.None=0]="None",e[e.ExchangeParent=1]="ExchangeParent",e[e.ExchangeChild=2]="ExchangeChild",e[e.RemoveParent=3]="RemoveParent",e[e.RemoveChild=4]="RemoveChild",e[e.AddParent=5]="AddParent",e[e.AddChild=6]="AddChild",e[e.NewParent=7]="NewParent",e}({}),o=function(e){return e[e.None=0]="None",e[e.Parent=1]="Parent",e[e.Child=2]="Child",e[e.Self=3]="Self",e}({}),d=function(e){return e[e.None=0]="None",e[e.SubSet=1]="SubSet",e[e.SuperSet=2]="SuperSet",e[e.Intersect=3]="Intersect",e[e.Duplicate=4]="Duplicate",e[e.Independent=5]="Independent",e}({}),h=function(e){return e[e.None=0]="None",e[e.Immediate=1]="Immediate",e[e.Regular=2]="Regular",e[e.Independent=3]="Independent",e}({});class l{constructor(e=null,t=0,i=""){this.nDims=0,n.set(this,void 0),this.currBudgetTable=e,this.newBudgetRow=null,this.nDims=t,this.anyDefn=i.Trim(),this.processedDimRows=[],this.strDecimals="N"+r.a.SessionManager.Preferences.DecimalsinAmount}setBudgetTable(e){this.currBudgetTable=e}deleteBudgetDimRow(e,t,i){let n=0;if(this.newBudgetRow=e,e.getRowDim()!=this.nDims)return i.errMsg="Incorrect number of dimensions being added in the new row",1;try{if(0==this.currBudgetTable.length||null==this.newBudgetRow||0==this.nDims)n=0;else{let n={delRowId:0};if(!this.alreadyExistInBudgetTable(e,n))return i.errMsg="RowID : "+e.rowID+" not found!",2;{let e=this.getDimensionRow(n.delRowId),i=[],r=[];for(let n=0;n<e.childSet.length;n++){let r=parseInt(e.childSet[n]),s=this.getDimensionRow(r);i.push(r),this.removeParent(s,e,t)}for(let n=0;n<e.parentSet.length;n++){let i=parseInt(e.parentSet[n]),s=this.getDimensionRow(i);r.push(i),this.removeChild(e,s,t)}for(let n=0;n<i.length;n++)for(let e=0;e<r.length;e++){let s=parseInt(i[n]),o=parseInt(r[e]),l=this.getDimensionRow(s),a=this.getDimensionRow(o),w=0,u={sType:d.None,ssType:h.None};w=this.isDimRowSubset(l,a,u),u.sType==d.SubSet&&(this.addParent(l,a,t),this.addChild(l,a,t))}for(let t=0;t<this.currBudgetTable.length;t++)if(0==this.currBudgetTable[t].rowID){this.currBudgetTable.RemoveAt(t);break}}}}catch(r){throw r}return n}checkAddBudgetConflicts(e,t,i){let n=0;this.newBudgetRow=e;try{if(0==this.currBudgetTable.length||null==this.newBudgetRow||0==this.nDims)n=0;else if(n=this.getRowsToEvaluateFurther(t,i),n>0)return n}catch(r){throw r}return n}checkEditBudgetConflicts(e,t){try{if(0==this.currBudgetTable.length||null==e||0==this.nDims)return 0;let i=e,n=this.getDimensionRow(i.rowID),r=0,s={sType:d.None,ssType:h.None};if(this.newBudgetRow=e,r=this.isDimRowSubset(i,n,s),s.sType==d.Duplicate){if(i.amount==n.amount)return t.errMsg="No edits performed!!!",0;{let e=0,r="";for(let t=0;t<n.childSet.length;t++){let i=parseInt(n.childSet[t]);e+=this.getDimensionRow(i).amount,r+=i.toString()+", "}if(i.amount<e)return t.errMsg="Invalid budget edit between : "+i.rowID.toString()+" & RowId group "+r+". Changed amount shall be minimum "+e.toString(),1;for(let i=0;i<n.parentSet.length;i++){e=0,r="";let s=parseInt(n.parentSet[i]),o=this.getDimensionRow(s);for(let t=0;t<o.childSet.length;t++){let i=parseInt(o.childSet[t]);e+=this.getDimensionRow(i).amount,r+=i.toString()+", "}if(o.amount<e)return t.errMsg="Invalid budget edit between : "+o.rowID.toString()+" & RowId group "+r+". Parent's amount shall be minimum "+e.toString(),2}}}}catch(i){throw i}return 0}checkBudgetTransUsage(e,t,i){let n=0;try{if(0==this.currBudgetTable.length||0==this.nDims)return n=1,i.errMsg="No budget defined to check validity of current transaction",n;if(e.getRowDim()!=this.nDims)return n=2,i.errMsg="Dimensions mis-match between input transaction and Budget Definition instance",n;n=this.getRelatedBudgetDefinitions(e,t,i),this.newBudgetRow=e}catch(r){throw r}return n}updateDimsRowsWithNewRowId(e,t,i){let n=t.length;try{let r=e.rowID;for(let e=0;e<n;e++){let n=t[e];if(n.isNewRowInvolved)switch(n.operation){case s.AddChild:{let e=null,t=null;n.childRowId==r&&(e=this.getDimensionRow(r),e.rowID=i,n.childRowId=i),n.parentRowId==r?(t=this.getDimensionRow(r),t.rowID=i,n.parentRowId=i):t=this.getDimensionRow(n.parentRowId);for(let n=0;n<t.childSet.length;n++)r==parseInt(t.childSet[n])&&(t.childSet[n]=i)}break;case s.AddParent:{let e=null,t=null;n.childRowId==r?(e=this.getDimensionRow(r),e.rowID=i,n.childRowId=i):e=this.getDimensionRow(n.childRowId),n.parentRowId==r&&(t=this.getDimensionRow(r),t.rowID=i,n.parentRowId=i);for(let n=0;n<e.parentSet.length;n++)r==parseInt(e.parentSet[n])&&(e.parentSet[n]=i)}break;case s.ExchangeChild:{let e=null,t=null,s=null;n.currentDimRowId==r?(e=this.getDimensionRow(r),e.rowID=i,n.currentDimRowId=i):e=this.getDimensionRow(n.currentDimRowId),n.oldChildRowId==r?(t=this.getDimensionRow(r),t.rowID=i,n.oldChildRowId=i):t=this.getDimensionRow(n.oldChildRowId),n.newChildRowId==r?(s=this.getDimensionRow(r),s.rowID=i,n.newChildRowId=i):s=this.getDimensionRow(n.newChildRowId);for(let n=0;n<e.childSet.length;n++)r==parseInt(e.childSet[n])&&(e.childSet[n]=i);for(let n=0;n<s.childSet.length;n++)r==parseInt(s.childSet[n])&&(s.childSet[n]=i)}break;case s.ExchangeParent:{let e=null,t=null,s=null;n.currentDimRowId==r?(e=this.getDimensionRow(r),e.rowID=i,n.currentDimRowId=i):e=this.getDimensionRow(n.currentDimRowId),n.oldParentRowId==r?(t=this.getDimensionRow(r),t.rowID=i,n.oldParentRowId=i):t=this.getDimensionRow(n.oldParentRowId),n.newParentRowId==r?(s=this.getDimensionRow(r),s.rowID=i,n.newParentRowId=i):s=this.getDimensionRow(n.newParentRowId);for(let n=0;n<e.parentSet.length;n++)r==parseInt(e.parentSet[n])&&(e.parentSet[n]=i);for(let n=0;n<s.parentSet.length;n++)r==parseInt(s.parentSet[n])&&(s.parentSet[n]=i)}break;case s.RemoveChild:case s.RemoveParent:{let e=null,t=null;n.childRowId==r&&(e=this.getDimensionRow(r),e.rowID=i,n.childRowId=i),n.parentRowId==r&&(t=this.getDimensionRow(r),t.rowID=i,n.parentRowId=i)}}}}catch(r){throw r}return 0}getTransactionLogSummary(e,t){let i=e.length,n="";for(let r=0;r<i;r++){let t=e[r];switch(t.operation){case s.AddChild:n+="Added Child(RowID:"+t.childRowId.toString()+") to Parent(RowID:"+t.parentRowId.toString()+")\r\n";break;case s.AddParent:n+="Added Parent(RowID:"+t.parentRowId.toString()+") to Child(RowID:"+t.childRowId.toString()+")\r\n";break;case s.ExchangeChild:n+="Exchanged Child of DimRow(RowID:"+t.currentDimRowId.toString()+") - Old Child(RowID:",n+=t.oldChildRowId.toString()+") + New Child(RowID:"+t.newChildRowId.toString()+")\r\n";break;case s.ExchangeParent:n+="Exchanged Parent of DimRow(RowID:"+t.currentDimRowId.toString()+") - Old Parent(RowID:",n+=t.oldParentRowId.toString()+") + New Parent(RowID:"+t.newParentRowId.toString()+")\r\n";break;case s.RemoveChild:n+="Removed Child(RowID:"+t.childRowId.toString()+") from Parent(RowID:"+t.parentRowId.toString()+")\r\n";break;case s.RemoveParent:n+="Removed Parent(RowID:"+t.parentRowId.toString()+") from Child(RowID:"+t.childRowId.toString()+")\r\n"}}return t.strTransLog=n,!0}checkTransValidity(e,t,i,n,s){let d=0;try{if(0==n.length)return d=1,0!=e||r.a.SessionManager.IsActionAssigned(101,"Dont Show Transactional Logs")?Logger.DebugLog("Budget : checkTransValidity : No dimension rows to check validity of current transaction"):s.errMsg="No dimension rows to check validity of current transaction\r\n",d;if(i.getRowDim()!=this.nDims)return d=2,s.errMsg="Dimensions mis-match between input transaction and Budget Definition instance\r\n",d;s.errMsg="",s.errMsgCmplt="";let h={errMsg:"",errMsgCmplt:""};for(let i=0;i<n.length;i++){let r=n[i],l=this.getDimensionRow(r.childRowId),a=this.getDimensionRow(r.parentRowId);if(r.relation==o.Child||r.relation==o.Self){let i=0;i=this.checkTransAmountValidity(a,l,r.relation,e,t,h),i>0&&(s.errMsg+=h.errMsg,h.errMsg="",s.errMsgCmplt+=h.errMsgCmplt,h.errMsgCmplt="",d=i)}}}catch(h){throw h}return d}rollbackChanges(e){this.rollbackTransactions(e)}isDimRowProcessed(e){for(let t=0;t<this.processedDimRows.length;t++)if(e==parseInt(this.processedDimRows[t]))return!0;return!1}clearProcessedDimRows(){this.processedDimRows.Clear()}checkTransAmountValidity(e,t,i,n,r,s){let d=0;if(i==o.Self){for(let i=0;i<e.parentSet.length;i++){let o=parseInt(e.parentSet[i]),h=this.getDimensionRow(o),l=h.amount-h.budgetUsed;if(l<t.budgetUsed){let e={Msg:s.errMsg};this.ErrorMessage(n,r,t.budgetUsed,l,h.rowID,h.docSeqNo,e),s.errMsg=e.Msg,d=11}if(l=h.totalAmount-h.budgetUsed,l<t.budgetUsed){let e={Msg:s.errMsgCmplt};this.ErrorMessage(n,r,t.budgetUsed,l,h.rowID,h.docSeqNo,e),s.errMsgCmplt=e.Msg,d=11}}{let i=e.amount-e.budgetUsed;if(i<t.budgetUsed){let o={Msg:s.errMsg};this.ErrorMessage(n,r,t.budgetUsed,i,e.rowID,e.docSeqNo,o),s.errMsg=o.Msg,d=12}if(i=e.totalAmount-e.budgetUsed,i<t.budgetUsed){let o={Msg:s.errMsgCmplt};this.ErrorMessage(n,r,t.budgetUsed,i,e.rowID,e.docSeqNo,o),s.errMsgCmplt=o.Msg,d=12}}}else{let i=e.amount-e.budgetUsed;if(i<t.budgetUsed){let o={Msg:s.errMsg};this.ErrorMessage(n,r,t.budgetUsed,i,e.rowID,e.docSeqNo,o),s.errMsg=o.Msg,d=13}if(i=e.totalAmount-e.budgetUsed,i<t.budgetUsed){let o={Msg:s.errMsgCmplt};this.ErrorMessage(n,r,t.budgetUsed,i,e.rowID,e.docSeqNo,o),s.errMsgCmplt=o.Msg,d=13}}return d}ErrorMessage(e,t,i,n,r,s,o){1==e?o.Msg+=" Invalid Quantity "+this.GetNumberFormat(i)+". Quantity left to use is "+this.GetNumberFormat(n)+".":2==e?o.Msg+="Invalid Value "+this.GetNumberFormat(i)+". Value left to use is "+this.GetNumberFormat(n)+".":(3==t&&(o.Msg+=" Requested amount is exceeding monthly budget amount.\r\n"),o.Msg+=" Invalid Transaction Amount "+this.GetNumberFormat(i)+". Budget left to use is "+this.GetNumberFormat(n)+"."),o.Msg+="\r\nRefer RowId : "+r+" for budget definition",o.Msg+="\r\nRefer RowNo : "+s+"\r\n"}checkAmountValidity(e,t,i){let n=0,r=0,s=null,o="";if(e.childSet.length>0)for(let d=0;d<e.childSet.length;d++){let t=parseInt(e.childSet[d]);o+=t.toString()+", ",s=this.getDimensionRow(t),r+=s.amount}return r+=t.amount,e.amount<r&&(n=1,i.errMsg=e.childSet.length>0?"Budget conflict between rowID : "+e.rowID.toString()+" and rowID group : "+o+t.rowID.toString()+". Budget should be atleast "+r.toString()+" !!!":"Budget conflict between rowID : "+e.rowID.toString()+" and rowID : "+t.rowID.toString()+". Budget should be atleast "+r.toString()+" !!!"),n}isDimRowChild(e,t){if(t.childSet.length>0)for(let i=0;i<t.childSet.length;i++)if(e.rowID==t.childSet[i])return!0;return!1}getDimensionRow(e){let t=!1,i=null;if(null!=this.newBudgetRow&&e==this.newBudgetRow.rowID)return i=this.newBudgetRow,i;for(let n=0;n<this.currBudgetTable.length;n++)if(i=this.currBudgetTable[n],i.rowID==e){t=!0;break}return t||(i=new a,i.rowID=-1),i}getDimensionRowId(e,t){for(let i=0;i<this.currBudgetTable.length;i++)if(this.currBudgetTable[i].rowID==e)return 0;return 1}isDimRowSubset(e,t,i){let n=0,r=!1,s=0,o=0;i.sType=d.None,i.ssType=h.None;let l=0,a=0;for(let d=0;d<this.nDims;d++){let i=e.row[d].toString().Trim(),n=t.row[d].toString().Trim();""==i&&(i=this.anyDefn),""==n&&(n=this.anyDefn),i!=this.anyDefn&&n!=this.anyDefn?(r=!1,i==n?s++:o++):(r=r&&!0,n==this.anyDefn?t.nAnysComputed||t.nAnys++:a++,i==this.anyDefn?e.nAnysComputed||e.nAnys++:l++)}return t.nAnysComputed||(t.nAnysComputed=!0),e.nAnysComputed||(e.nAnysComputed=!0),r?(n=0,i.sType=d.Independent,i.ssType=h.Independent):(0==s&&0==o&&(l>0&&a>0?(n=0,i.sType=d.Independent,i.ssType=h.None):(n=0,i.sType=d.None,i.ssType=h.None)),0==s&&o>0&&(n=0,i.sType=d.Independent,i.ssType=h.Independent),s>0&&o>0&&(n=0,i.sType=d.Intersect,i.ssType=h.None),s>0&&0==o&&(l>0&&a>0?(n=0,i.sType=d.Intersect,i.ssType=h.None):t.nAnys!=e.nAnys?(e.nAnys==t.nAnys+1&&(n=0,i.sType=d.SuperSet,i.ssType=h.Immediate),e.nAnys>t.nAnys+1&&(n=0,i.sType=d.SuperSet,i.ssType=h.Regular),e.nAnys+1==t.nAnys&&(n=0,i.sType=d.SubSet,i.ssType=h.Immediate),e.nAnys+1<t.nAnys&&(n=0,i.sType=d.SubSet,i.ssType=h.Regular)):t.nAnys+s==this.nDims?(n=0,i.sType=d.Duplicate,i.ssType=h.None):(n=0,i.sType=d.Intersect,i.ssType=h.None))),n}addChild(e,t,i){t.addChild(e.rowID);let n=new w;n.operation=s.AddChild,n.childRowId=e.rowID,n.parentRowId=t.rowID,0!=t.rowID&&0!=e.rowID||(n.isNewRowInvolved=!0),i.push(n)}addParent(e,t,i){e.addParent(t.rowID);let n=new w;n.operation=s.AddParent,n.childRowId=e.rowID,n.parentRowId=t.rowID,0!=t.rowID&&0!=e.rowID||(n.isNewRowInvolved=!0),i.push(n)}removeChild(e,t,i){t.childSet.length>0&&t.childSet.Remove(e.rowID);let n=new w;n.operation=s.RemoveChild,n.childRowId=e.rowID,n.parentRowId=t.rowID,0==t.rowID&&(n.isNewRowInvolved=!0),i.push(n)}removeParent(e,t,i){e.parentSet.length>0&&e.parentSet.Remove(t.rowID);let n=new w;n.operation=s.RemoveParent,n.childRowId=e.rowID,n.parentRowId=t.rowID,0==e.rowID&&(n.isNewRowInvolved=!0),i.push(n)}exchangeParent(e,t,i,n){e.parentSet.length>0&&e.parentSet.Remove(t.rowID),e.addParent(i.rowID),i.addParent(t.rowID);let r=new w;r.operation=s.ExchangeParent,r.currentDimRowId=e.rowID,r.oldParentRowId=t.rowID,r.newParentRowId=i.rowID,0!=e.rowID&&0!=t.rowID&&0!=i.rowID||(r.isNewRowInvolved=!0),n.push(r)}exchangeChild(e,t,i,n){e.childSet.length>0&&e.childSet.Remove(t.rowID),e.addChild(i.rowID),i.addChild(t.rowID);let r=new w;r.operation=s.ExchangeChild,r.currentDimRowId=e.rowID,r.oldChildRowId=t.rowID,r.newChildRowId=i.rowID,0!=e.rowID&&0!=t.rowID&&0!=i.rowID||(r.isNewRowInvolved=!0),n.push(r)}existParent(e,t){for(let i=0;i<e.parentSet.length;i++)if(parseInt(e.parentSet[i])==t.rowID)return!0;return!1}existChild(e,t){for(let i=0;i<t.childSet.length;i++)if(parseInt(t.childSet[i])==e.rowID)return!0;return!1}isDuplicate(e,t){let i=!1,n={sType:d.None,ssType:h.None},r=0;return r=this.isDimRowSubset(e,t,n),n.sType==d.Duplicate&&(i=!0),i}alreadyExistInBudgetTable(e,t){for(let i=0;i<this.currBudgetTable.length;i++){let n=this.currBudgetTable[i];if(e!=n&&this.isDuplicate(e,n))return t.delRowId=n.rowID,!0}return!1}alreadyExchanged(e,t,i){return!(this.existParent(e,t)&&this.existChild(t,e)||!this.existParent(e,i)||!this.existChild(i,e))}insertDimRowAsChild(e,t,i,n){let r=!1;for(let s=0;s<e.childSet.length;s++){let o={sType:d.None,ssType:h.None},l=0,a=parseInt(e.childSet[s]),w=this.getDimensionRow(a);if(l=this.isDimRowSubset(t,w,o),this.isDimRowProcessed(a))r=o.sType==d.SubSet||o.sType==d.SuperSet;else switch(this.processedDimRows.push(w.rowID),o.sType){case d.SuperSet:if(o.sType==d.SuperSet){if(l=this.checkAmountValidity(t,w,n),0!=l)return!1;if(l=this.checkAmountValidity(e,t,n),0!=l)return!1;this.exchangeParent(w,e,t,i),this.exchangeChild(e,w,t,i),r=!0}break;case d.SubSet:if(o.ssType==h.Immediate){if(l=this.checkAmountValidity(w,t,n),0!=l)return!1;for(let e=0;e<t.parentSet.length;e++){let n=parseInt(t.parentSet[e]),r=this.getDimensionRow(n),s={sType:d.None,ssType:h.None};l=this.isDimRowSubset(w,r,s),s.sType==d.SubSet&&(this.removeChild(t,r,i),this.removeParent(t,r,i))}this.addParent(t,w,i),this.addChild(t,w,i),r=!0}if(o.ssType==h.Regular&&(r=this.insertDimRowAsChild(w,t,i,n),!r&&""==n.errMsg)){if(l=this.checkAmountValidity(w,t,n),0!=l)return!1;this.addParent(t,w,i),this.addChild(t,w,i),r=!0}break;default:r||(r=!1)}}return r}insertDimRowAsParent(e,t,i,n){let r=!1;for(let s=0;s<e.parentSet.length;s++){let o={sType:d.None,ssType:h.None},l=0,a=parseInt(e.parentSet[s]),w=this.getDimensionRow(a);if(l=this.isDimRowSubset(w,t,o),this.isDimRowProcessed(a))r=o.sType==d.SubSet||o.sType==d.SuperSet;else switch(this.processedDimRows.push(w.rowID),o.sType){case d.SuperSet:if(l=this.checkAmountValidity(w,t,n),0!=l)return!1;if(l=this.checkAmountValidity(t,e,n),0!=l)return!1;this.exchangeParent(e,w,t,i),this.exchangeChild(w,e,t,i),r=!0;break;case d.SubSet:if(o.ssType==h.Immediate){if(l=this.checkAmountValidity(t,w,n),0!=l)return!1;for(let e=0;e<w.parentSet.length;e++){let n=parseInt(w.parentSet[e]),r=this.getDimensionRow(n),s={sType:d.None,ssType:h.None};l=this.isDimRowSubset(t,r,s),s.sType==d.SubSet&&(this.removeChild(w,r,i),this.removeParent(w,r,i))}this.addParent(w,t,i),this.addChild(w,t,i),r=!0}if(o.ssType==h.Regular&&(r=this.insertDimRowAsParent(w,t,i,n),!r&&""==n.errMsg)){if(l=this.checkAmountValidity(t,w,n),0!=l)return!1;this.addParent(w,t,i),this.addChild(w,t,i),r=!0}break;default:r||(r=!1)}}return r}getRowsToEvaluateFurther(e,t){let i=0,n=this.newBudgetRow;if(n.getRowDim()!=this.nDims)return t.errMsg="Incorrect number of dimensions being added in the new row",2;let r={delRowId:-1};if(this.alreadyExistInBudgetTable(n,r))return t.errMsg="DimensionRow already exist as RowId : "+r.delRowId.toString(),6;for(let s=0;s<this.currBudgetTable.length;s++){let r=0,o={sType:d.None,ssType:h.None},l=this.currBudgetTable[s];if(l.getRowDim()!=this.nDims)return t.errMsg="Incorrect number of dimensions in the budget table",3;if(!this.isDimRowProcessed(l.rowID))switch(this.processedDimRows.push(l.rowID),r=this.isDimRowSubset(n,l,o),o.sType){case d.SubSet:switch(o.ssType){case h.Immediate:{let s={sType:d.None,ssType:h.None},o=null;for(let h=0;h<l.childSet.length;h++){let a=parseInt(l.childSet[h]);if(o=this.getDimensionRow(a),this.processedDimRows.push(o.rowID),r=this.isDimRowSubset(o,n,s),s.sType==d.SubSet&&!this.isDimRowChild(o,n)){if(i=this.checkAmountValidity(n,o,t),0!=i)return i=6,i;this.exchangeParent(o,l,n,e),this.exchangeChild(l,o,n,e)}}if(!this.existChild(n,l)&&!this.existParent(n,l)){if(i=this.checkAmountValidity(l,n,t),0!=i)return i=7,i;this.addChild(n,l,e),this.addParent(n,l,e)}break}case h.Regular:if(l.childSet.length>0){let r=this.insertDimRowAsChild(l,n,e,t);if(!r&&""==t.errMsg&&!this.existChild(n,l)&&!this.existParent(n,l)){if(i=this.checkAmountValidity(l,n,t),0!=i)return i=8,i;this.addChild(n,l,e),this.addParent(n,l,e)}if(!r&&""!=t.errMsg)return i=9,i}else if(!this.isDimRowChild(n,l)){if(i=this.checkAmountValidity(l,n,t),0!=i)return i=10,i;this.addParent(n,l,e),this.addChild(n,l,e)}}break;case d.SuperSet:switch(o.ssType){case h.Immediate:{let s={sType:d.None,ssType:h.None},o=null;for(let h=0;h<l.parentSet.length;h++){let a=parseInt(l.parentSet[h]);if(o=this.getDimensionRow(a),this.processedDimRows.push(o.rowID),r=this.isDimRowSubset(o,n,s),s.sType==d.SuperSet&&!this.isDimRowChild(n,o)){if(i=this.checkAmountValidity(o,n,t),0!=i)return i=11,i;this.exchangeChild(o,l,n,e),this.exchangeParent(l,o,n,e)}}if(!this.existChild(l,n)&&!this.existParent(l,n)){if(i=this.checkAmountValidity(n,l,t),0!=i)return i=11,i;this.addChild(l,n,e),this.addParent(l,n,e)}}break;case h.Regular:if(l.parentSet.length>0){let r=this.insertDimRowAsParent(l,n,e,t);if(!r&&""==t.errMsg&&!this.existChild(l,n)&&!this.existParent(l,n)){if(i=this.checkAmountValidity(n,l,t),0!=i)return i=13,i;this.addChild(l,n,e),this.addParent(l,n,e)}if(!r&&""!=t.errMsg)return i=14,i}else if(!this.isDimRowChild(l,n)){if(i=this.checkAmountValidity(n,l,t),0!=i)return i=15,i;this.addParent(l,n,e),this.addChild(l,n,e)}}break;case d.Independent:case d.Intersect:break;case d.Duplicate:return t.errMsg="Duplicate rows. RowID : "+n.rowID.toString()+" & RowID : "+l.rowID.toString(),4;case d.None:return t.errMsg="Cannot evaluate dimension rows! RowID : "+n.rowID.toString()+" & RowID : "+l.rowID.toString(),5}}return this.clearProcessedDimRows(),i}addDimRowAction(e,t){let i=!1;for(let n=0;n<t.length;n++)if(t[n].isEqual(e)){i=!0;break}i||t.push(e)}getRelatedBudgetDefinitions(e,t,i){if(this.clearProcessedDimRows(),null!=Logger.logLevel&&Logger.logLevel.Contains("BUDGET")){let t="";t+="<Buget>",t+='<Input amt="'+e.amount+'" d="';for(let i=0;i<e.row.length;i++)t+=","+e.row[i].toString();t+='" />';for(let e=0;e<this.currBudgetTable.length;e++){t+='<r amt="'+this.currBudgetTable[e].amount+'" d="';for(let i=0;i<this.currBudgetTable[e].row.length;i++)t+=","+this.currBudgetTable[e].row[i].toString();t+='" />'}t+="</Buget>",Logger.DebugLog("Buget XML: "+t.toString())}for(let n=0;n<this.currBudgetTable.length;n++){let i=0,r={sType:d.None,ssType:h.None},s=this.currBudgetTable[n];i=this.isDimRowSubset(e,s,r);let l=new w;if(!this.isDimRowProcessed(s.rowID))if(this.processedDimRows.push(s.rowID),r.sType==d.Duplicate)l.relation=o.Self,l.parentRowId=s.rowID,l.childRowId=e.rowID,this.addDimRowAction(l,t);else if(r.sType==d.SubSet&&r.ssType==h.Immediate)l.relation=o.Child,l.parentRowId=s.rowID,l.childRowId=e.rowID,this.addDimRowAction(l,t);else if(r.sType==d.SuperSet&&r.ssType==h.Immediate)l.relation=o.Parent,l.parentRowId=e.rowID,l.childRowId=s.rowID,this.addDimRowAction(l,t);else if(r.sType==d.SubSet||r.sType==d.SuperSet){let n=-1,a=!0,w=s,u=r.sType;for(;a;){n=w.rowID;let t,s=null;for(r.sType==d.SubSet&&(s=w.childSet),r.sType==d.SuperSet&&(s=w.parentSet),t=0;t<s.length;t++){let o=parseInt(s[t]);if(w=this.getDimensionRow(o),i=this.isDimRowSubset(e,w,r),r.sType==d.SubSet||r.sType==d.SuperSet){u=r.sType,n=w.rowID,r.ssType==h.Immediate&&(a=!1);break}}if(t>=s.length)break}u==d.SubSet&&(l.relation=o.Child,l.parentRowId=n,l.childRowId=e.rowID,this.addDimRowAction(l,t)),r.sType==d.SuperSet&&(l.relation=o.Parent,l.parentRowId=e.rowID,l.childRowId=n,this.addDimRowAction(l,t))}}return this.clearProcessedDimRows(),0}rollbackTransactions(e){let t=e.length,i=[],n=null,r=null,o=null,d=null,h=null,l=null,a=null;try{for(let w=t;w>0;w--){let t=e[w-1];switch(t.operation){case s.AddChild:n=this.getDimensionRow(t.childRowId),r=this.getDimensionRow(t.parentRowId),this.removeChild(n,r,i);break;case s.AddParent:n=this.getDimensionRow(t.childRowId),r=this.getDimensionRow(t.parentRowId),this.removeParent(n,r,i);break;case s.RemoveChild:n=this.getDimensionRow(t.childRowId),r=this.getDimensionRow(t.parentRowId),this.addChild(n,r,i);break;case s.RemoveParent:n=this.getDimensionRow(t.childRowId),r=this.getDimensionRow(t.parentRowId),this.addParent(n,r,i);break;case s.ExchangeChild:o=this.getDimensionRow(t.oldChildRowId),d=this.getDimensionRow(t.newChildRowId),a=this.getDimensionRow(t.currentDimRowId),this.exchangeChild(a,d,o,i);break;case s.ExchangeParent:h=this.getDimensionRow(t.oldParentRowId),l=this.getDimensionRow(t.newParentRowId),a=this.getDimensionRow(t.currentDimRowId),this.exchangeParent(a,l,h,i)}}}catch(w){throw w}}GetNumberFormat(e){return e.ToString(this.strDecimals)}}n=new WeakMap;class a{constructor(e=-1,t=null){this.rowID=0,this.docSeqNo=0,this.amount=0,this.totalAmount=0,this.budgetUsed=0,this.nAnys=0,this.nAnysComputed=!1,this.dbCalled=!1,this.row=[],this.nAnys=0,this.rowID=e,this.docSeqNo=0,this.linkedDimRows=t,this.tempLinkedDimRows=-1,this.nAnysComputed=!1,this.budgetUsed=0,this.parentRowID=-1,this.childSet=[],this.parentSet=[]}DimensionRow_1(e){this.rowID=e.rowID,this.docSeqNo=e.docSeqNo,this.amount=e.amount,this.totalAmount=e.totalAmount,this.budgetUsed=e.budgetUsed,this.nAnys=e.nAnys,this.nAnysComputed=e.nAnysComputed,this.CF=e.CF;for(let t=0;t<e.row.length;t++)this.row.push(e.row[t]);for(let t=0;t<e.childSet.length;t++)this.childSet.push(e.childSet[t]);for(let t=0;t<e.parentSet.length;t++)this.parentSet.push(e.parentSet[t])}addDimValue(e){this.row.push(e)}addChild(e){let t=!1;for(let i=0;i<this.childSet.length;i++)if(e==this.childSet[i]){t=!0;break}t||this.childSet.push(e)}addParent(e){let t=!1;for(let i=0;i<this.parentSet.length;i++)if(e==this.parentSet[i]){t=!0;break}t||this.parentSet.push(e)}getRowDim(){return this.row.length}}class w{constructor(){this.isNewRowInvolved=!1,this.currentDimRowId=0,this.oldParentRowId=0,this.newParentRowId=0,this.oldChildRowId=0,this.newChildRowId=0,this.childRowId=0,this.parentRowId=0}DimensionRowAction(){this.operation=s.None,this.relation=o.None,this.currentDimRowId=-1,this.oldParentRowId=-1,this.newParentRowId=-1,this.oldChildRowId=-1,this.newChildRowId=-1,this.childRowId=-1,this.parentRowId=-1,this.isNewRowInvolved=!1}isEqual(e){let t=!1;return this.operation==e.operation&&this.relation==e.relation&&this.currentDimRowId==e.currentDimRowId&&this.isNewRowInvolved==e.isNewRowInvolved&&this.oldParentRowId==e.oldParentRowId&&this.newParentRowId==e.newParentRowId&&this.oldChildRowId==e.oldChildRowId&&this.newChildRowId==e.newChildRowId&&this.childRowId==e.childRowId&&this.parentRowId==e.parentRowId&&(t=!0),t}}}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[170],{X43T:function(t,e,s){"use strict";s.r(e),s.d(e,"AddBatchGroupViewModel",(function(){return r}));var h=s("Do2H"),a=s("ScVY"),o=s("VxiT"),i=s("EQd/"),c=s("0/4Q");class r extends a.b{constructor(t,e,s){super(),this.objBatch={},this._ScreenData=[],this.ScreenObject=new o.a,this.BatchCode=new i.a(27184),this.BatchNumber=new i.d(1558),this.Status=new c.e(1552),this.NodeID=0,this.Group=new c.e(1557),this._ParentID=0,Logger.InfoLog("AddBatchGroupViewModel::Entering AddBatchGroupViewModel With ID"+t+",_Parent"+e+",ScreenName"+s),this.BatchCode.Label="Batch Code",this.BatchNumber.Label="Batch Number",this.BatchNumber.Mandatory=!0,this.Status.Label="Status",this.Group.Label="Group",this.Group.Mandatory=!0,this.objBatch.BatchID=0,this._ParentID=e,this._ScreenData=this.BuildControls(),this.ScreenObject.LoadScreen_2(this,16),null!=this._ScreenData&&this.ScreenObject.Data.Tables[3].forEach(t=>{this.Status.Items.push(c.d.ComboBoxItems_2(t[Object.keys(t)[1]].toString(),t[Object.keys(t)[0]].toString()))}),this.ScreenObject.Data.Tables[3].length>0&&(this.Status.SelectedValue=this.ScreenObject.Data.Tables[3][0][Object.keys(this.ScreenObject.Data.Tables[3][0])[0]].toString()),this.ScreenObject.Data.Tables[4].forEach(t=>{this.Group.Items.push(c.d.ComboBoxItems_2(t[Object.keys(t)[1]].toString(),t[Object.keys(t)[0]].toString()))}),0!=e&&(this.Group.SelectedValue=e.toString()),this.objBatch.GUID="",this.objBatch.IsGroup=!0,null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>9&&this.ScreenObject.Data.Columns[9].Contains("IsParentCodeInherited")&&this.ScreenObject.Data.Tables[9].length>0&&this.ScreenObject.InitAutoCode(this.ScreenObject.Data.Tables[9],this.objBatch.IsGroup),t>0&&(this.NodeID=t,this.objBatch.BatchID=this.NodeID,this.FillControls()),0==t&&this.AutoGenerateCode(),Logger.InfoLog("AddBatchGroupViewModel::Exiting AddBatchGroupViewModel")}BuildControls(){Logger.InfoLog("QuickAddBatchViewModel::Entering BuildControls");try{let t=new o.a;return this.PactScreenID="16",t.GetControls(this.PactScreenID,h.a.SessionManager.CompanyIndex)}catch(t){return Logger.ErrorLog("QuickAddBatchViewModel:: BuildControls"+t.stack),null}}FillControls(){if(this.NodeID>0){this.objBatch.BatchID=this.NodeID;let t=h.a.inventory.GetBatchDetails(this.NodeID);Object.assign(this.objBatch,t.obj),""!=this.objBatch.BatchCode&&(this.BatchCode.Text=this.objBatch.BatchCode),(this.ScreenObject.InheritParentCode||this.ScreenObject.IsAutoCode)&&(this.BatchCode.Enable=!1),this.BatchNumber.Enable&&(this.BatchNumber.Text=this.objBatch.BatchNumber),this.Status.Enable&&(this.Status.SelectedValue=this.objBatch.BatchStatus.toString()),this.Group.Enable&&(this.Group.SelectedValue=this.objBatch.BatchGroup.toString())}else this.objBatch.GUID=""}OnSaveGroup(t){Logger.InfoLog("AddBatchGroupViewModel::Entering OnSaveGroup");try{if("Save"==t.toString()){let t=this.ScreenObject.ValidateData();if(t.length>0)return this.MessageVisibility=!0,void(this.DisplayMessage=t);let e=[];if(0==this.objBatch.BatchID){let t={StrCode:this.objBatch.BatchCode,CodePrefix:this.objBatch.CodePrefix,CodeNumber:this.objBatch.CodeNumber};if(this.DisplayMessage=this.ScreenObject.SetAutoCodeParams_3(this.BatchCode,this.objBatch.BatchGroup,this.ScreenObject.Data.Tables[9],t),this.objBatch.BatchCode=t.StrCode,this.objBatch.CodePrefix=t.CodePrefix,this.objBatch.CodeNumber=t.CodeNumber,this.DisplayMessage.length>0)return}else this.objBatch.BatchCode=this.BatchCode.Text;e.push(this.BatchNumber.Text),e.push(null),e.push(null),e.push(""),e.push(null),e.push(parseInt(this.Status.SelectedValue)),e.push(0),e.push(null),e.push(0),e.push(0),e.push(null),e.push(0),e.push(0),e.push(null),e.push(0),e.push(null),e.push(0),e.push(0),e.push(0),e.push(parseInt(this.Group.SelectedValue)),e.push(null);let s=0;h.a.inventory.AddBatchQuickAndGroup(this.objBatch,"AddBatchQuickAndGroup",JSON.stringify(e)).subscribe(t=>{this.MessageVisibility=!0,this.DisplayMessage=t.Message,s=t.RetValue,s>0&&(this.ScreenObject.Clear(),this.Parent.Refresh(),this.objBatch.BatchID>0&&(this.BatchCode.Text="")),Logger.InfoLog("AddEditBatchViewModel::Exiting OnSaveBatch")},t=>{console.log("AddEditBatchViewModel Save : "+JSON.stringify(t))})}else"Cancel"==t.toString()&&h.a.page.HideDialog();Logger.InfoLog("AddBatchGroupViewModel::Exiting OnSaveGroup")}catch(e){Logger.ErrorLog("AddBatchGroupViewModel:: OnSaveGroup"+e.stack)}}onCanGroup(t){return!0}AutoGenerateCode(){0==this.objBatch.BatchID&&(this.objBatch.BatchGroup=""!=this.Group.SelectedValue?parseInt(this.Group.SelectedValue)>0?parseInt(this.Group.SelectedValue):0:1,this.ScreenObject.SetAutoCode(this.BatchCode,this.objBatch.IsGroup,this.objBatch.BatchGroup,this.ScreenObject.Data.Tables[9]))}}}}]);
function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var s=0;s<t.length;s++){var a=t[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,s){return t&&_defineProperties(e.prototype,t),s&&_defineProperties(e,s),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var s,a=_getPrototypeOf(e);if(t){var i=_getPrototypeOf(this).constructor;s=Reflect.construct(a,arguments,i)}else s=a.apply(this,arguments);return _possibleConstructorReturn(this,s)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[76],{dZHe:function(e,t,s){"use strict";s.r(t),s.d(t,"RibbonExtPay",(function(){return ie}));var a=s("V7Sd"),i=s("Saj9"),o=s("Do2H"),l=s("V+gx"),n=s("+0zN"),r=s("E7Kr"),d=s("R89Y"),h=s("Lp6j"),p=s("vTM8"),m=s("eQJW"),c=s("8B8H"),C=s("ScVY"),u=s("VxiT"),y=s("ockk"),g=s("0/4Q"),M=s("s7Y5"),P=s("/G+I"),D=s("1xwR"),E=s("PGQ+"),I=s("EUZL"),S=function(e){_inherits(s,e);var t=_createSuper(s);function s(e){var a;return _classCallCheck(this,s),(a=t.call(this)).DialogResult=!1,a.dtData=null,a.dtDataColumns=null,a.ExcelData=[],a.DisplayMessage="",a.Parent=e[0],a.Parent.Opacity=.3,a.dgv=new c.a,a.dgv.Columns=new Array,a.dgv.Width="450",a.dgv.Table=[],a}return _createClass(s,[{key:"Button_Click",value:function(e){if("Load"==e.toString()){if(0==this.dgv.Table.length)return this.DisplayMessage="View the data before loading.",void(this.MessageVisibility=!0);try{var t;this.dtData=[],this.dtDataColumns=[];for(var s=0;s<this.dgv.Columns.length;s++)this.dtDataColumns.push(this.dgv.TableColumns[s]);for(var a=0;a<this.dgv.Table.length;a++){t={};for(var i=0;i<this.dgv.Columns.length;i++)null!=this.dgv.Table[a][i]&&null!=this.dgv.Table[a][i]&&(t[i]=this.dgv.Table[a][i].toString());this.dtData.push(t)}this.dtData=this.dgv.Table}catch(m){}null!=this.Parent&&(this.Parent.Opacity=1,this.Parent.DialogResult=!0),this.DialogResult=!0,o.a.page.HideDialog()}else if("View"==e.toString()){var l;this.dgv.Columns.Clear(),this.dgv.TableColumns.Clear(),this.dgv.Clear();var n=new Array;if(null!=this.ExcelTable&&this.ExcelTable.length>0){for(var r=0;r<this.ExcelTableColumns.length;r++)(l=new y.a).Header=this.ExcelTableColumns[r],l.DisplayMember=this.ExcelTableColumns[r],l.ID=this.ExcelTableColumns[r],l.Width=100,l.ReadOnly=!0,n.push(l),this.dgv.TableColumns.push(this.ExcelTableColumns[r]);var d;this.dgv.Columns=n;for(var h=1;h<this.ExcelTable.length;h++){d=this.dgv.NewRow();for(var p=0;p<this.ExcelTableColumns.length;p++)d[this.ExcelTableColumns[p]]=this.ExcelTable[h][p];this.dgv.Table.push(d),this.dgv.updateRow(d)}}}else"Browse"==e.toString()||"Cancel"==e.toString()&&(null!=this.Parent&&(this.Parent.Opacity=1,this.Parent.DialogResult=!1),this.DialogResult=!1,o.a.page.HideDialog());Logger.InfoLog("ConsMPLoadViewModel::Exiting Button_Click")}},{key:"OpenFile",value:function(e){var t=this;if(1!==e.target.files.length)throw new Error("Cannot use multiple files");var s=new FileReader,a=e.target.files[0];this.fileExt=a.name.split(".").pop(),this.fileName=a.name,s.onload=function(e){var a=I.read(s.result,{type:"binary"});if(t.ExcelData=I.utils.sheet_to_json(a.Sheets[a.SheetNames[0]],{header:1}),!h.e.IsEmpty(t.ExcelData)&&t.ExcelData.length>0)try{t.ExcelTable=t.ExcelData,t.ExcelTableColumns=t.ExcelData[0],t.ActualFileName=t.fileName}catch(i){return void(t.DisplayMessage=i.Message)}},s.readAsBinaryString(a)}}]),s}(C.b),T=s("qeHP"),L=s("BUEH"),b=s("Iab2"),f=function(e){_inherits(s,e);var t=_createSuper(s);function s(e){var a;_classCallCheck(this,s),(a=t.call(this)).Opacity=1,a.DialogResult=!1,a.ProgressVisibility=!1,a.ProgressValue=0,a.ProgressMax=0,a._SelectAll=!1,a.IsProcessWithArrears=!1,a.PostVisiblility=!0,a.UnPostVisiblility=!0,a.ExportVisiblility=!0,a.GridColumnType=new p.a,a.CostCenterID=0,a.sCrAccount="0",a.sDrAccount="0",a.dtRes=null,a.drwRes=null,a.SelectUnCheck=0,a.objCMPLData=null,a.IsProcessed=!1,a.sFilter="",a.sBGWorkType="",a.dtArrData=null,a.iEmpIndex=0,a.strResult="",a.Failed="",a.FailedCount=0,a.DefProdID=0;try{Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering ConsolidatedMonthlyPayrollViewModel()"),a.ClassName="ConsolidatedMonthlyPayrollViewModel",a.CostCenterID=40054,a.dtRes=o.a.common.GetDataTable("PAY073",o.a.SessionManager.LangID),a.DisplayName=o.a.GetResource(e.Replace(" ","")),a.Title=o.a.GetResource(e.Replace(" ","")),a.DisplayMessage="",a.sPayrollMonth=" / ["+o.a.SessionManager.PayrollMonth.ToString("MMM-yyyy")+"]",a.lblPayrollMonth=o.a.SessionManager.PayrollMonth.ToString("MMM, yyyy"),a.lblPayrollMonthStart=o.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy"),a.lblPayrollMonthEnd=o.a.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy"),a.PostVisiblility=o.a.SessionManager.IsActionAssigned(a.CostCenterID,"Create"),a.UnPostVisiblility=o.a.SessionManager.IsActionAssigned(a.CostCenterID,"Delete"),a.ExportVisiblility=o.a.SessionManager.IsActionAssigned(a.CostCenterID,"Export"),a.LoadGrid(),a.btnFilter_Click()}catch(i){Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION ConsolidatedMonthlyPayrollViewModel()",i)}return a}return _createClass(s,[{key:"SerializeGridColumnType",value:function(){this.GridColumnType.ContainsKey("id")||this.GridColumnType.push("id","Int64");for(var e=0;e<this.dgvEmployees.TableColumns.length;e++);}},{key:"sPayrollMonth_MouseDoubleClick",value:function(e){var t=this,s=new i.SetPayrollDateViewModel;o.a.page.ShowDialog(s,l.SetPayrollDateComponent,{ShowCenter:!0,Title:o.a.GetResource("Pay_SetPayrollDate")}).subscribe((function(){s.DialogResult&&t.btnClear_Click()}))}},{key:"dgvEmployees_EndEdit",value:function(e,t,s){var a=this.dgvEmployees.Table.indexOf(e);this.iEmpIndex=this.lstSelectedEmps.indexOf(a),this.iEmpIndex<0||("DaysAttended"==t?(this.oCMP.SetDaysAttended(this.iEmpIndex,"Days Attended",parseFloat(e[t])),this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays<0?(this.DisplayMessage=o.a.GetResource("EnterValidDaysAttended"),this.MessageVisibility=!0):this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays<this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP?(this.DisplayMessage="Employee Should have atleast "+this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP+" LOP Days",this.MessageVisibility=!0):this.DisplayMessage="",e.LOPDays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays.ToString("0.0")):"LOPDays"==t?this.oCMP.SetDaysAttended(this.iEmpIndex,"LOP",parseFloat(e[t])):t.startsWith("EarningOTHrs")?this.oCMP.ReEvaluateData(this.iEmpIndex,1,parseInt(t.Replace("EarningOTHrs","")),e[t].toString()):t.startsWith("Earning")&&!t.endsWith("_Arr")?this.oCMP.ReEvaluateData(this.iEmpIndex,0,parseInt(t.Replace("Earning","")),e[t].toString()):t.startsWith("DeductionOTHrs")?this.oCMP.ReEvaluateData(this.iEmpIndex,3,parseInt(t.Replace("DeductionOTHrs","")),e[t].toString()):t.startsWith("Deduction")&&!t.endsWith("_Arr")?this.oCMP.ReEvaluateData(this.iEmpIndex,2,parseInt(t.Replace("Deduction","")),e[t].toString()):t.startsWith("dcAlpha")?t.endsWith("_Key")?this.oCMP.UpdateExtraFieldData(this.iEmpIndex,t.Replace("_Key",""),new Date(e[t]).ToString("dd/MMM/yyyy")):this.oCMP.UpdateExtraFieldData(this.iEmpIndex,t,e[t].toString()):t.startsWith("dcCCNID")&&(e.Table.Columns.Contains(t+"_Key")?this.oCMP.UpdateExtraFieldData(this.iEmpIndex,t,e[t+"_Key"].toString()):this.oCMP.UpdateExtraFieldData(this.iEmpIndex,t,e[t].toString())),this.dgvEmployees.updateRow(e),this.FillProcessedData(a))}},{key:"GetResource",value:function(e,t){var s=e;return this.drwRes=this.dtRes.filter((function(s){return s.CCID==t&&s.Code==e})),null!=this.drwRes&&this.drwRes.length>0?1==o.a.SessionManager.LanguageID?this.drwRes[0].Name.toString():this.drwRes[0].AliasName.toString():s}},{key:"LoadGrid",value:function(){var e,t=this,a=new u.a;this.dsDocDesig=a.GetScreenInfo(this.CostCenterID),null!=(e=this.dsDocDesig.Tables[0].filter((function(e){return"CreditAccount"==e.SysColumnName})))&&e.length>0&&!h.e.IsEmptySpace(e[0].UserDefaultValue)&&(this.sCrAccount=e[0].UserDefaultValue.toString()),null!=(e=this.dsDocDesig.Tables[0].filter((function(e){return"DebitAccount"==e.SysColumnName})))&&e.length>0&&!h.e.IsEmptySpace(e[0].UserDefaultValue)&&(this.sDrAccount=e[0].UserDefaultValue.toString()),this.dgvEmployees=new c.a,this.dgvEmployees.gridtype="CMP",this.dgvEmployees.Height=0,this.dgvEmployees.SelectAll.Visible=!0,this.dgvEmployees.OnCellEditEnding.Subscribe(this,"dgvEmployees_EndEdit"),this.dgvEmployees.CanUserDeleteRows=!0,this.dgvEmployees.UpdateFooter(),this.dgvEmployees.UpdateTotals();var i=new y.a;if(this.dgvEmployees.Columns=new Array,this.dgvEmployees.Table=[],(i=new y.a).Header=this.GetResource("Select",40054),i.DisplayMember="Select",i.ID="Select",i.DataType="CheckBox",i.Width=50,i.IsFrozen=!0,i.CheckedChanged.Subscribe(this,"dgColSelect_CheckedChanged"),this.dgvEmployees.Columns.push(i),this.dgvEmployees.TableColumns.push("Select"),this.dgvEmployees.DataTypes.Bool.push("Select"),(i=new y.a).Header=this.GetResource("S No",40054),i.DisplayMember="SNo",i.ID="SNo",i.DataType="TextBlock",i.Width=50,i.ReadOnly=!0,i.IsFrozen=!0,this.dgvEmployees.Columns.push(i),this.dgvEmployees.TableColumns.push("SNo"),(i=new y.a).Header="EmpSeqNo",i.DisplayMember="EmpSeqNo",i.ID="EmpSeqNo",i.DataType="TextBlock",i.Width=50,i.ReadOnly=!0,i.IsFrozen=!0,i.IsVisible=!1,this.dgvEmployees.Columns.push(i),this.dgvEmployees.TableColumns.push("EmpSeqNo"),(i=new y.a).Header=this.GetResource("Employee Code",40054),i.DisplayMember="EmpCode",i.ID="EmpCode",i.CrRefColName="dcCCNID51",i.DataType="TextBlock",i.Width=150,i.ReadOnly=!0,i.IsFrozen=!0,this.dgvEmployees.Columns.push(i),this.dgvEmployees.TableColumns.push("EmpCode"),(i=new y.a).Header=this.GetResource("Employee Name",40054),i.DisplayMember="EmpName",i.ID="EmpName",i.CrRefColName="dcCCNID51",i.DataType="TextBlock",i.Width=250,i.ReadOnly=!0,i.IsFrozen=!0,this.dgvEmployees.Columns.push(i),this.dgvEmployees.TableColumns.push("EmpName"),(i=new y.a).Header=this.GetResource("dcAlpha3",40054),i.DisplayMember="NetSalary",i.ID="NetSalary",i.CrRefColName="dcAlpha3",i.DataType="FLOAT",i.DecimalPoints=o.a.SessionManager.Preferences.PayrollNoOfDecimals,i.Width=90,i.ReadOnly=!0,i.IsFontBold=!0,i.IsFrozen=!0,i.ShowTotal=!0,i.IsCalculated=1,this.dgvEmployees.Columns.push(i),this.dgvEmployees.TableColumns.push("NetSalary"),this.dgvEmployees.DataTypes.Double.push("NetSalary"),(i=new y.a).Header=this.GetResource("Month Days",40054),i.DisplayMember="MonthDays",i.ID="MonthDays",i.CrRefColName="dcAlpha4",i.DataType="FLOAT",i.DecimalPoints="1",i.Width=60,i.ReadOnly=!0,this.dgvEmployees.Columns.push(i),this.dgvEmployees.TableColumns.push("MonthDays"),this.dgvEmployees.DataTypes.Double.push("MonthDays"),(i=new y.a).Header=this.GetResource("dcAlpha5",40054),i.DisplayMember="DaysAttended",i.ID="DaysAttended",i.CrRefColName="dcAlpha5",i.DataType="FLOAT",i.DecimalPoints="1",i.Width=60,i.ReadOnly=!1,this.dgvEmployees.Columns.push(i),this.dgvEmployees.TableColumns.push("DaysAttended"),this.dgvEmployees.DataTypes.Double.push("DaysAttended"),(i=new y.a).Header=this.GetResource("dcAlpha24",40054),i.DisplayMember="PaidLeaves",i.ID="PaidLeaves",i.CrRefColName="dcAlpha24",i.DataType="FLOAT",i.DecimalPoints="1",i.Width=60,i.ReadOnly=!0,i.ForeColor="Gray",this.dgvEmployees.Columns.push(i),this.dgvEmployees.TableColumns.push("PaidLeaves"),this.dgvEmployees.DataTypes.Double.push("PaidLeaves"),(i=new y.a).Header=this.GetResource("dcAlpha6",40054),i.DisplayMember="TotalLeaves",i.ID="TotalLeaves",i.CrRefColName="dcAlpha6",i.DataType="FLOAT",i.DecimalPoints="1",i.Width=60,i.ReadOnly=!0,i.ForeColor="Gray",this.dgvEmployees.Columns.push(i),this.dgvEmployees.TableColumns.push("TotalLeaves"),this.dgvEmployees.DataTypes.Double.push("TotalLeaves"),(i=new y.a).Header=this.GetResource("dcAlpha7",40054),i.DisplayMember="WeeklyOffs",i.ID="WeeklyOffs",i.CrRefColName="dcAlpha7",i.DataType="FLOAT",i.DecimalPoints="1",i.Width=60,i.ReadOnly=!0,i.ForeColor="Gray",this.dgvEmployees.Columns.push(i),this.dgvEmployees.TableColumns.push("WeeklyOffs"),this.dgvEmployees.DataTypes.Double.push("WeeklyOffs"),(i=new y.a).Header=this.GetResource("dcAlpha8",40054),i.DisplayMember="Holidays",i.ID="Holidays",i.CrRefColName="dcAlpha8",i.DataType="FLOAT",i.DecimalPoints="1",i.Width=60,i.ReadOnly=!0,i.ForeColor="Gray",this.dgvEmployees.Columns.push(i),this.dgvEmployees.TableColumns.push("Holidays"),this.dgvEmployees.DataTypes.Double.push("Holidays"),(i=new y.a).Header=this.GetResource("dcAlpha9",40054),i.DisplayMember="LOPDays",i.ID="LOPDays",i.CrRefColName="dcAlpha9",i.DataType="FLOAT",i.DecimalPoints="1",i.Width=60,i.ReadOnly=!1,this.dgvEmployees.Columns.push(i),this.dgvEmployees.TableColumns.push("LOPDays"),this.dgvEmployees.DataTypes.Double.push("LOPDays"),(i=new y.a).Header=this.GetResource("dcAlpha10",40054),i.DisplayMember="UnpaidDays",i.ID="UnpaidDays",i.CrRefColName="dcAlpha10",i.DataType="FLOAT",i.DecimalPoints="1",i.Width=60,i.ReadOnly=!0,i.ForeColor="Gray",this.dgvEmployees.Columns.push(i),this.dgvEmployees.TableColumns.push("UnpaidDays"),this.dgvEmployees.DataTypes.Double.push("UnpaidDays"),(i=new y.a).Header=this.GetResource("dcAlpha4",40054),i.DisplayMember="TotalDays",i.ID="TotalDays",i.CrRefColName="dcAlpha4",i.DataType="FLOAT",i.DecimalPoints="1",i.Width=60,i.ReadOnly=!0,i.ForeColor="Gray",this.dgvEmployees.Columns.push(i),this.dgvEmployees.TableColumns.push("TotalDays"),this.dgvEmployees.DataTypes.Double.push("TotalDays"),this.dsStructure=o.a.common.GetDataSet("PAY058",o.a.SessionManager.PayrollMonth.ToString("dd MMM yyyy")),null!=this.dsStructure&&this.dsStructure.Tables.length>0){if((e=this.dsStructure.Tables[0].filter((function(e){return 1==e.Type&&"Yes"==e.Applicable}))).SortBy(["SNo"]),null!=e&&e.length>0)for(var l=0;l<e.length;l++)(h.e.IsEmpty(e[l].Behaviour)||"Accruals"!=e[l].Behaviour.toString()&&"Accruals-AccumulateForPreviousYears"!=e[l].Behaviour.toString())&&((i=new y.a).Header=this.GetResource(e[l].ComponentCode.toString(),50052),i.CrRefColID=parseInt(e[l].ComponentID),i.DisplayMember="Earning"+e[l].SNo.toString(),i.ID="Earning"+e[l].SNo.toString(),i.DataType="FLOAT",i.DecimalPoints=o.a.SessionManager.Preferences.PayrollNoOfDecimals,i.ReadOnly=!0,i.ShowTotal=!0,i.IsCalculated=1,i.HeaderBackColor="LightBlue",i.Width=80,"OverTime"==e[l].FieldType.toString()?(i.DisplayMember="EarningOTHrs"+e[l].SNo.toString(),i.ID="EarningOTHrs"+e[l].SNo.toString(),i.DecimalPoints="2",i.Width=60,i.ReadOnly=!1):"Monthly"==e[l].FieldType.toString()?i.ReadOnly=!1:i.ForeColor="Gray","-1"!=e[l].Visible.toString()&&(i.IsVisible="1"==e[l].Visible.toString()),"-1"!=e[l].Width.toString()&&(i.Width=parseInt(e[l].Width)),"-1"!=e[l].IndexValue.toString()&&(i.DisplayIndex=parseInt(e[l].IndexValue)),"-1"!=e[l].ReadOnly.toString()&&(i.ReadOnly="1"==e[l].ReadOnly.toString()),"-1"!=e[l].Mandatory.toString()&&(i.Mandatory="1"==e[l].Mandatory.toString()),this.dgvEmployees.Columns.push(i),this.dgvEmployees.TableColumns.push(i.DisplayMember),this.dgvEmployees.DataTypes.Double.push(i.DisplayMember),"OverTime"==e[l].FieldType.toString()&&((i=new y.a).Header=this.GetResource(e[l].ComponentCode.toString(),50052)+"_Amount",i.CrRefColID=parseInt(e[l].ComponentID),i.DisplayMember="EarningOTAmt"+e[l].SNo.toString(),i.ID="EarningOTAmt"+e[l].SNo.toString(),i.DataType="FLOAT",i.DecimalPoints=o.a.SessionManager.Preferences.PayrollNoOfDecimals,i.Width=80,i.ReadOnly=!0,i.ShowTotal=!0,i.IsCalculated=1,i.ForeColor="Gray",i.HeaderBackColor="LightBlue","-1"!=e[l].Visible.toString()&&(i.IsVisible="1"==e[l].Visible.toString()),"-1"!=e[l].Width.toString()&&(i.Width=parseInt(e[l].Width)),"-1"!=e[l].IndexValue.toString()&&(i.DisplayIndex=parseInt(e[l].IndexValue)),"-1"!=e[l].ReadOnly.toString()&&(i.ReadOnly="1"==e[l].ReadOnly.toString()),"-1"!=e[l].Mandatory.toString()&&(i.Mandatory="1"==e[l].Mandatory.toString()),this.dgvEmployees.Columns.push(i),this.dgvEmployees.TableColumns.push(i.DisplayMember),this.dgvEmployees.DataTypes.Double.push(i.DisplayMember)));if((i=new y.a).Header=this.GetResource("dcAlpha11",40054),i.DisplayMember="TotalEarnings",i.ID="TotalEarnings",i.CrRefColName="dcAlpha11",i.DataType="FLOAT",i.DecimalPoints=o.a.SessionManager.Preferences.PayrollNoOfDecimals,i.ReadOnly=!0,i.ShowTotal=!0,i.IsCalculated=1,i.HeaderBackColor="LightBlue",i.Width=90,this.dgvEmployees.Columns.push(i),this.dgvEmployees.TableColumns.push(i.DisplayMember),this.dgvEmployees.DataTypes.Double.push(i.DisplayMember),null!=e&&e.length>0)for(var n=0;n<e.length;n++)h.e.IsEmpty(e[n].Behaviour)||"Accruals"!=e[n].Behaviour.toString()&&"Accruals-AccumulateForPreviousYears"!=e[n].Behaviour.toString()||((i=new y.a).Header=this.GetResource(e[n].ComponentCode.toString(),50052),i.CrRefColID=parseInt(e[n].ComponentID),i.DisplayMember="Earning"+e[n].SNo.toString(),i.ID="Earning"+e[n].SNo.toString(),i.DataType="FLOAT",i.DecimalPoints=o.a.SessionManager.Preferences.PayrollNoOfDecimals,i.ReadOnly=!0,i.ShowTotal=!0,i.IsCalculated=1,i.HeaderBackColor="GreenYellow",i.Width=80,"Monthly"==e[n].FieldType.toString()?i.ReadOnly=!1:i.ForeColor="Gray","-1"!=e[n].Visible.toString()&&(i.IsVisible="1"==e[n].Visible.toString()),"-1"!=e[n].Width.toString()&&(i.Width=parseInt(e[n].Width)),"-1"!=e[n].IndexValue.toString()&&(i.DisplayIndex=parseInt(e[n].IndexValue)),"-1"!=e[n].ReadOnly.toString()&&(i.ReadOnly="1"==e[n].ReadOnly.toString()),"-1"!=e[n].Mandatory.toString()&&(i.Mandatory="1"==e[n].Mandatory.toString()),this.dgvEmployees.Columns.push(i),this.dgvEmployees.TableColumns.push(i.DisplayMember));if((e=this.dsStructure.Tables[0].filter((function(e){return e.Type="Yes"==e.Applicable}))).SortBy(["SNo"]),null!=e&&e.length>0)for(var r=0;r<e.length;r++)(i=new y.a).Header=this.GetResource(e[r].ComponentCode.toString(),50052),i.CrRefColID=parseInt(e[r].ComponentID),i.DisplayMember="Deduction"+e[r].SNo.toString(),i.ID="Deduction"+e[r].SNo.toString(),i.DataType="FLOAT",i.DecimalPoints=o.a.SessionManager.Preferences.PayrollNoOfDecimals,i.ReadOnly=!0,i.ShowTotal=!0,i.IsCalculated=1,i.HeaderBackColor="LightCoral",i.Width=80,"OverTime"==e[r].FieldType.toString()?(i.DisplayMember="DeductionOTHrs"+e[r].SNo.toString(),i.ID="DeductionOTHrs"+e[r].SNo.toString(),i.DecimalPoints="2",i.Width=60,i.ReadOnly=!1):"Monthly"==e[r].FieldType.toString()?i.ReadOnly=!1:i.ForeColor="Gray","-1"!=e[r].Visible.toString()&&(i.IsVisible="1"==e[r].Visible.toString()),"-1"!=e[r].Width.toString()&&(i.Width=parseInt(e[r].Width)),"-1"!=e[r].IndexValue.toString()&&(i.DisplayIndex=parseInt(e[r].IndexValue)),"-1"!=e[r].ReadOnly.toString()&&(i.ReadOnly="1"==e[r].ReadOnly.toString()),"-1"!=e[r].Mandatory.toString()&&(i.Mandatory="1"==e[r].Mandatory.toString()),this.dgvEmployees.Columns.push(i),this.dgvEmployees.TableColumns.push(i.DisplayMember),this.dgvEmployees.DataTypes.Double.push(i.DisplayMember),"OverTime"==e[r].FieldType.toString()&&((i=new y.a).Header=this.GetResource(e[r].ComponentCode.toString(),50052)+"_Amount",i.CrRefColID=parseInt(e[r].ComponentID),i.DisplayMember="DeductionOTAmt"+e[r].SNo.toString(),i.ID="DeductionOTAmt"+e[r].SNo.toString(),i.DataType="FLOAT",i.DecimalPoints=o.a.SessionManager.Preferences.PayrollNoOfDecimals,i.Width=80,i.ReadOnly=!0,i.ShowTotal=!0,i.IsCalculated=1,i.ForeColor="Gray",i.HeaderBackColor="LightCoral","-1"!=e[r].Visible.toString()&&(i.IsVisible="1"==e[r].Visible.toString()),"-1"!=e[r].Width.toString()&&(i.Width=parseInt(e[r].Width)),"-1"!=e[r].IndexValue.toString()&&(i.DisplayIndex=parseInt(e[r].IndexValue)),"-1"!=e[r].ReadOnly.toString()&&(i.ReadOnly="1"==e[r].ReadOnly.toString()),"-1"!=e[r].Mandatory.toString()&&(i.Mandatory="1"==e[r].Mandatory.toString()),this.dgvEmployees.Columns.push(i),this.dgvEmployees.TableColumns.push(i.DisplayMember),this.dgvEmployees.DataTypes.Double.push(i.DisplayMember));if((e=this.dsStructure.Tables[0].filter((function(e){return 3==e.Type}))).SortBy(["SNo"]),null!=e&&e.length>0)for(var d=0;d<e.length;d++)(i=new y.a).Header=this.GetResource(e[d].ComponentCode.toString(),50052),i.CrRefColID=parseInt(e[d].ComponentID),i.DisplayMember="Loan"+e[d].SNo.toString(),i.ID="Loan"+e[d].SNo.toString(),i.DataType="FLOAT",i.DecimalPoints=o.a.SessionManager.Preferences.PayrollNoOfDecimals,i.ReadOnly=!0,i.ShowTotal=!0,i.IsCalculated=1,i.ForeColor="Gray",i.HeaderBackColor="LightGoldenrodYellow",i.Width=80,"-1"!=e[d].Visible.toString()&&(i.IsVisible="1"==e[d].Visible.toString()),"-1"!=e[d].Width.toString()&&(i.Width=parseInt(e[d].Width)),"-1"!=e[d].IndexValue.toString()&&(i.DisplayIndex=parseInt(e[d].IndexValue)),"-1"!=e[d].ReadOnly.toString()&&(i.ReadOnly="1"==e[d].ReadOnly.toString()),"-1"!=e[d].Mandatory.toString()&&(i.Mandatory="1"==e[d].Mandatory.toString()),this.dgvEmployees.Columns.push(i),this.dgvEmployees.TableColumns.push(i.DisplayMember),this.dgvEmployees.DataTypes.Double.push(i.DisplayMember);if((i=new y.a).Header=this.GetResource("dcAlpha12",40054),i.DisplayMember="TotalDeductions",i.ID="TotalDeductions",i.CrRefColName="dcAlpha12",i.DataType="FLOAT",i.DecimalPoints=o.a.SessionManager.Preferences.PayrollNoOfDecimals,i.ReadOnly=!0,i.ShowTotal=!0,i.IsCalculated=1,i.HeaderBackColor="LightCoral",i.Width=90,this.dgvEmployees.Columns.push(i),this.dgvEmployees.TableColumns.push(i.DisplayMember),this.dgvEmployees.DataTypes.Double.push(i.DisplayMember),(e=this.dsStructure.Tables[0].filter((function(e){return 4==e.Type}))).SortBy(["SNo"]),null!=e&&e.length>0)for(var p=0;p<e.length;p++)(i=new y.a).Header=this.GetResource(e[p].ComponentCode.toString(),50052),i.CrRefColID=parseInt(e[p].ComponentID),i.DisplayMember="Leave"+e[p].SNo.toString(),i.ID="Leave"+e[p].SNo.toString(),i.DataType="FLOAT",i.DecimalPoints="1",i.ReadOnly=!0,i.ShowTotal=!0,i.IsCalculated=1,i.ForeColor="Gray",i.HeaderBackColor="LightGreen",i.Width=60,"-1"!=e[p].Visible.toString()&&(i.IsVisible="1"==e[p].Visible.toString()),"-1"!=e[p].Width.toString()&&(i.Width=parseInt(e[p].Width)),"-1"!=e[p].IndexValue.toString()&&(i.DisplayIndex=parseInt(e[p].IndexValue)),"-1"!=e[p].ReadOnly.toString()&&(i.ReadOnly="1"==e[p].ReadOnly.toString()),"-1"!=e[p].Mandatory.toString()&&(i.Mandatory="1"==e[p].Mandatory.toString()),this.dgvEmployees.Columns.push(i),this.dgvEmployees.TableColumns.push(i.DisplayMember),this.dgvEmployees.DataTypes.Double.push(i.DisplayMember)}var C=this.dsDocDesig.Tables[0].filter((function(e){return 1==e.IsColumnUserDefined&&(2==e.SectionID&&"H"==e.SectionName||3==e.SectionID)}));if(null!=C&&C.length>0)for(var M=0;M<C.length;M++){switch((i=new y.a).Header=this.GetResource(C[M].SysColumnName.toString(),40054),i.DisplayMember=C[M].SysColumnName.toString(),i.ID=C[M].SysColumnName.toString(),i.CrRefColName=C[M].SysColumnName.toString(),i.DataType=C[M].ColumnDataType.toString(),i.IsColumnUserDefined=Object(m.j)(C[M].IsColumnUserDefined),i.Mandatory=Object(m.j)(C[M].IsMandatory),i.DataType.toUpperCase()){case"LISTBOX":i.ValueMember=i.ID+"_Key",this.dgvEmployees.TableColumns.push(i.ID),this.dgvEmployees.TableColumns.push(i.ID+"_Key"),this.dgvEmployees.DataTypes.Int.push(i.ID+"_Key"),i.CostCenterID=parseInt(C[M].ColumnCostCenterID.toString()),i.TypeID=parseInt(C[M].ColumnCCListViewTypeID.toString()),h.e.IsEmpty(C[M].FetchMaxRows)?h.e.IsEmpty(C[M].UserProbableValues)||(i.FilterColumn=C[M].UserProbableValues.toString()):i.GridViewID=parseInt(C[M].FetchMaxRows.toString());break;case"TEXT":case"STRING":case"COMBOBOX":if(this.dgvEmployees.TableColumns.push(i.ID),i.IsColumnUserDefined)if("Date"==C[M].UserColumnType.toString()&&(i.DataType="DATE",this.dgvEmployees.TableColumns.push(i.ID+"_Key"),this.dgvEmployees.DataTypes.Date.push(i.ID+"_Key")),"DateTime"==C[M].UserColumnType.toString())i.DataType="DATETIME",this.dgvEmployees.TableColumns.push(i.ID+"_Key");else if("Time"==C[M].UserColumnType.toString())i.DataType="TIME",this.dgvEmployees.TableColumns.push(i.ID+"_Key");else if("Numeric"==C[M].UserColumnType.toString())i.DataType="FLOAT";else if("SELECTIONBOX"==C[M].UserColumnType.toString()||"editablecombobox"==C[M].UserColumnType.toString().toLowerCase())i.DataType="SELECTIONBOX",i.CostCenterID=this.CostCenterID;else if("combobox"==C[M].UserColumnType.toString().toLowerCase()){if(i.ValueBinding=i.ID,!h.e.IsEmpty(C[M].linkData)&&22803==parseInt(C[M].linkData.toString())||"@YEAR"==i.DefaultValue){i.DataType="PactComboBox";for(var P=[],D=1980;D<2100;D++){var E={};E.Year=D.toString(),P.push(E)}i.DisplayMember="Year",i.ValueMember="Year",i.ComboData=P,"@YEAR"==i.DefaultValue&&(i.DefaultValue="")}else{i.DataType="ComboBox",i.DisplayMember="Name",i.ValueMember="Value";var I=[],S=C[M].UserProbableValues.toString().Trim();if(S.length>0)for(var T=S.split(";"),L=0;L<T.length;L++)I.push(g.d.ComboBoxItems_2(T[L],T[L]));i.ComboData=I}this.dgvEmployees.TableColumns.push(i.ID+"_Key")}else if("LISTBOX"==C[M].UserColumnType.toString())if(44==parseInt(C[M].ColumnCostCenterID.toString())){i.ValueBinding=i.ID,i.DataType="ComboBox",i.DisplayMember="Name",i.ValueMember="Value";var b=s.GetLookupData(parseInt(C[M].ColumnCCListViewTypeID));if(null!=b){for(var f=[],F=0;F<b.length;F++)f.push(g.d.ComboBoxItems_2(b[F].Name.toString(),b[F].NodeID.toString()));i.ComboData=f}this.dgvEmployees.TableColumns.push(i.ID+"_Key")}else i.DataType="LISTBOX",i.ValueMember=i.ID+"_Key",this.dgvEmployees.TableColumns.push(i.ID+"_Key"),i.CostCenterID=parseInt(C[M].ColumnCostCenterID.toString()),i.TypeID=parseInt(C[M].ColumnCCListViewTypeID.toString());else if("Attachment"==C[M].UserColumnType.toString())i.DataType="LINK",i.ReadOnly=!0,i.FilterCondition=C[M].BasedOnXml.toString(),i.Dependantinuse=!1;else if("Image"==C[M].UserColumnType.toString())i.DataType="LINK",i.ReadOnly=!0,i.Dependantinuse=!0;else if("LOOKUP"==C[M].UserColumnType.toString()){i.ValueBinding=i.ID,i.DataType="ComboBox",i.DisplayMember="Name",i.ValueMember="Value";var N=s.GetLookupData(parseInt(C[M].ColumnCCListViewTypeID));if(null!=N){for(var A=[],v=0;v<N.length;v++)A.push(g.d.ComboBoxItems_2(N[v].Name.toString(),N[v].NodeID.toString()));i.ComboData=A}this.dgvEmployees.TableColumns.push(i.ID+"_Key")}break;case"DATE":i.DataType="DATE",this.dgvEmployees.TableColumns.push(i.ID),this.dgvEmployees.TableColumns.push(i.ID+"_Key"),this.dgvEmployees.DataTypes.Date.push(i.ID+"_Key")}i.Width=100,i.HeaderBackColor="LightGray",this.dgvEmployees.Columns.push(i),this.dgvEmployees.TableColumns.Contains(C[M].SysColumnName.toString())||this.dgvEmployees.TableColumns.push(C[M].SysColumnName.toString())}var O=o.a.common.GetDataTable("PAY059",o.a.SessionManager.RoleID);if(null!=O&&O.length>0){var x=new h.f;if(x.ReadXml(O[0].ValueXml.toString()),null!=x&&x.Tables.length>0&&x.Tables[0].length>0)for(var R,w=function(e){(R=x.Tables[0].filter((function(s){return s.SysColumnName==t.dgvEmployees.Columns[e].CrRefColName}))).length>0?(t.dgvEmployees.Columns[e].DisplayIndex=parseInt(R[0].Index)+3,t.dgvEmployees.Columns[e].Width=parseInt(R[0].Width),t.dgvEmployees.Columns[e].ReadOnly=null!=R[0].ReadOnly&&null!=R[0].ReadOnly&&"1"==R[0].ReadOnly.toString(),t.dgvEmployees.Columns[e].Mandatory=null!=R[0].Mandatory&&null!=R[0].Mandatory&&"1"==R[0].Mandatory.toString(),t.dgvEmployees.Columns[e].IsVisible=null!=R[0].Visible&&null!=R[0].Visible&&"1"==R[0].Visible.toString()):null!=(R=x.Tables[0].filter((function(s){return s.ID==t.dgvEmployees.Columns[e].CrRefColID})))&&R.length>0?(t.dgvEmployees.Columns[e].DisplayIndex=parseInt(R[0].Index)+3,t.dgvEmployees.Columns[e].Width=parseInt(R[0].Width),t.dgvEmployees.Columns[e].ReadOnly=null!=R[0].ReadOnly&&null!=R[0].ReadOnly&&"1"==R[0].ReadOnly.toString(),t.dgvEmployees.Columns[e].Mandatory=null!=R[0].Mandatory&&null!=R[0].Mandatory&&"1"==R[0].Mandatory.toString(),t.dgvEmployees.Columns[e].IsVisible=null!=R[0].Visible&&null!=R[0].Visible&&"1"==R[0].Visible.toString()):null!=(R=x.Tables[0].filter((function(s){return s.ID==-t.dgvEmployees.Columns[e].CrRefColID})))&&R.length>0?(t.dgvEmployees.Columns[e].DisplayIndex=parseInt(R[0].Index)+3,t.dgvEmployees.Columns[e].Width=parseInt(R[0].Width),t.dgvEmployees.Columns[e].ReadOnly=null!=R[0].ReadOnly&&null!=R[0].ReadOnly&&"1"==R[0].ReadOnly.toString(),t.dgvEmployees.Columns[e].Mandatory=null!=R[0].Mandatory&&null!=R[0].Mandatory&&"1"==R[0].Mandatory.toString(),t.dgvEmployees.Columns[e].IsVisible=null!=R[0].Visible&&null!=R[0].Visible&&"1"==R[0].Visible.toString()):t.dgvEmployees.Columns[e].DisplayIndex=e},V=0;V<this.dgvEmployees.Columns.length;V++)w(V);this.dgvEmployees.Columns.SortBy([{name:"DisplayIndex",parser:parseInt}])}(i=new y.a).Header=this.GetResource("Result",40054),i.DisplayMember="Result",i.ID="Result",i.DataType="TextBlock",i.Width=250,i.ReadOnly=!0,this.dgvEmployees.Columns.push(i),this.dgvEmployees.TableColumns.push("Result"),this.dgvEmployees.OnPreviewKeyDown.Subscribe(this,"OnPreviewKeyDown")}},{key:"OnPreviewKeyDown",value:function(e,t,s){if("F5"==t.key){var a=this.dgvEmployees.Columns.find((function(e){return e.DisplayMember==s}));if(null!=a){if(a.ReadOnly||"sno"==s.toLowerCase())return!0;if(!confirm("Do you want to override all.?"))return!0;for(var i=0;i<this.dgvEmployees.Table.length;i++)this.dgvEmployees.Table[i][s]=e[s].toString(),this.dgvEmployees.TableColumns.Contains(s+"_Key")&&(this.dgvEmployees.Table[i][s+"_Key"]=e[s+"_Key"].toString()),this.dgvEmployees.updateRow(this.dgvEmployees.Table[i]),this.dgvEmployees_EndEdit(this.dgvEmployees.Table[i],s,-1)}}else if(t.ctrlKey)if("F"==t.key)this.dgvEmployees.SearchVisible?this.dgvEmployees.SearchVisible=!1:(this.dgvEmployees.SearchVisible=!0,this.dgvEmployees.AddSearchCols()),t.Handled=!0;else if("E"==t.key){var o=this.GetRawExportHTML().toString(),l=new Blob([o],{type:"text/plain;charser=utf-8"});b.saveAs(l,this.ScreenName+"_XlsExport_"+(new Date).getTime()+".xls"),t.Handled=!0}return!1}},{key:"dgColSelect_CheckedChanged",value:function(e,t){t||1==this.SelectAll&&(this.SelectUnCheck=1,this.SelectAll=!1)}},{key:"SelectUnselectAll",value:function(e){for(var t=0;t<this.dgvEmployees.Table.length;t++)0==this.SelectUnCheck&&(this.dgvEmployees.Table[t].Select=e);this.SelectUnCheck=0}},{key:"Button_Click",value:function(e){if(Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering Button_Click()"),"Post"==e.toString()){if(!this.IsProcessed)return this.DisplayMessage="Data has been modified, Please Process the Payroll again, then Post...",void(this.MessageVisibility=!0);this.btnPost_Click()}else"Clear"==e.toString()?this.btnClear_Click():"UnPost"==e.toString()?this.btnUnPost_Click():"Filter"==e.toString()?this.btnFilter_Click():"Process"==e.toString()?this.btnProcess_Click():"Load"==e.toString()?this.btnLoad_Click():"Export"==e.toString()&&this.btnExport_Click();Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting Button_Click()")}},{key:"btnExport_Click",value:function(){}},{key:"btnLoad_Click",value:function(){var e=this;try{Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering btnLoad_Click()"),this.objCMPLData=null;var t=[];t.push(this);var s=new S(t);o.a.page.ShowDialog(s,T.a,{Title:"Load Data"}).subscribe((function(){if(s.DialogResult){if(!s.dtDataColumns.Contains("Employee Code"))return e.DisplayMessage="'Employee Code' Column not found.",void(e.MessageVisibility=!0);e.objCMPLData=s.dtData,e.sBGWorkType="LOAD",e.bgworker_DoWork(null,null),e.bgworker_RunWorkerCompleted(null,null)}Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting btnLoad_Click()")}))}catch(a){Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION btnLoad_Click()",a)}}},{key:"LoadXLData",value:function(e){var t=this;Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering LoadXLData()"),this.InProgress="";var s=0;if(null!=e&&e.length>0){var a;s=e.length,this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=s,this.ProgressMessage="Loading Excel Data, please wait ...";for(var i="",l=-1,n=function(n){if(!h.e.IsEmpty(t.dgvEmployees.Table[n].EmpCode)&&(i="",(a=e.filter((function(e){return e["Employee Code"]==t.dgvEmployees.Table[n].EmpCode.toString()}))).length>0)){for(var r=1;r<Object.keys(e[0]).length;r++)for(var d=Object.keys(e[0])[r],p=0;p<t.dgvEmployees.TableColumns.length;p++)if(t.dgvEmployees.Columns[p].Header==d&&t.dgvEmployees.TableColumns.Contains(t.dgvEmployees.Columns[p].ID)){t.dgvEmployees.Table[n][t.dgvEmployees.Columns[p].ID]=a[0][r].toString(),function(){var e=t.dgvEmployees.Table.indexOf(t.dgvEmployees.Table[n]);t.iEmpIndex=t.lstSelectedEmps.indexOf(e);var s=0,d=-1;t.dgvEmployees.Columns[p].ID.startsWith("EarningOTHrs")?(s=1,d=parseInt(t.dgvEmployees.Columns[p].ID.Replace("EarningOTHrs","")),i=t.dgvEmployees.Columns[p].ID,l=p):t.dgvEmployees.Columns[p].ID.startsWith("Earning")?(s=0,d=parseInt(t.dgvEmployees.Columns[p].ID.Replace("Earning","")),i=t.dgvEmployees.Columns[p].ID,l=p):t.dgvEmployees.Columns[p].ID.startsWith("DeductionOTHrs")?(s=3,d=parseInt(t.dgvEmployees.Columns[p].ID.Replace("DeductionOTHrs","")),i=t.dgvEmployees.Columns[p].ID,l=p):t.dgvEmployees.Columns[p].ID.startsWith("Deduction")&&(s=2,d=parseInt(t.dgvEmployees.Columns[p].ID.Replace("Deduction","")),i=t.dgvEmployees.Columns[p].ID,l=p);var h=t.oCMP.arrLstCPFields[t.iEmpIndex][s].find((function(e){return e.SNo==d}));null!=h&&(h.dActual=parseFloat(a[0][r].toString()).ToString(o.a.SessionManager.sPayrollDecimals)),t.oCMP.othMPField=t.oCMP.arrLstOthMPFields[t.iEmpIndex],"DaysAttended"!=t.dgvEmployees.Columns[p].ID&&"LOPDays"!=t.dgvEmployees.Columns[p].ID||t.dgvEmployees_EndEdit(t.dgvEmployees.Table[n],t.dgvEmployees.Columns[p].ID,p)}();break}l>=0&&t.dgvEmployees_EndEdit(t.dgvEmployees.Table[n],i,l),t.ProgressValue=n+1,t.InProgress=n+1+" of "+s}},r=0;r<this.dgvEmployees.Table.length;r++)n(r);this.DisplayMessage="Data Loaded Successfully",this.MessageVisibility=!0}Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting LoadXLData()")}},{key:"btnProcess_Click",value:function(){this.AddArrearColumns(),this.sBGWorkType="PROCESS",this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null)}},{key:"AddArrearColumns",value:function(){var e=this;if(this.IsProcessWithArrears){var t=this.dsStructure.Tables[0].filter((function(e){return 1==e.Type&&"Yes"==e.Applicable&&"OverTime"!=e.FieldType}));t.sort((function(e,t){return e.SNo-t.SNo})),this.AddEarDedArrearColumns(t,"Earning"),(t=this.dsStructure.Tables[0].filter((function(e){return 2==e.Type&&"Yes"==e.Applicable&&"OverTime"!=e.FieldType}))).sort((function(e,t){return e.SNo-t.SNo})),this.AddEarDedArrearColumns(t,"Deduction")}else{var s;!function(){var t=e.dsStructure.Tables[0].filter((function(e){return 1==e.Type&&"Yes"==e.Applicable&&"OverTime"!=e.FieldType}));if(t.sort((function(e,t){return e.SNo-t.SNo})),null!=t&&t.length>0)for(var a=function(a){e.dgvEmployees.TableColumns.Contains("Earning"+t[a].SNo+"_Arr")&&(e.dgvEmployees.TableColumns.Remove("Earning"+t[a].SNo+"_Arr"),null!=(s=e.dgvEmployees.Columns.find((function(e){return e.DisplayMember=="Earning"+t[a].SNo+"_Arr"})))&&e.dgvEmployees.Columns.Remove(s))},i=0;i<t.length;i++)a(i);if(null!=(t=e.dsStructure.Tables[0].filter((function(e){return 2==e.Type&&"Yes"==e.Applicable&&"OverTime"!=e.FieldType})))&&t.length>0)for(var o=function(a){e.dgvEmployees.TableColumns.Contains("Deduction"+t[a].SNo+"_Arr")&&(e.dgvEmployees.TableColumns.Remove("Deduction"+t[a].SNo+"_Arr"),null!=(s=e.dgvEmployees.Columns.find((function(e){return e.DisplayMember=="Deduction"+t[a].SNo+"_Arr"})))&&e.dgvEmployees.Columns.Remove(s))},l=0;l<t.length;l++)o(l)}()}for(var a=[],i=0;i<this.dgvEmployees.Columns.length;i++)a.push(this.dgvEmployees.Columns[i]);this.dgvEmployees.Columns=a}},{key:"AddEarDedArrearColumns",value:function(e,t){var s=this;if(null!=e&&e.length>0)for(var a,i=function(i){if(s.dgvEmployees.TableColumns.Contains(t+e[i].SNo)){if(s.dgvEmployees.TableColumns.Contains(t+e[i].SNo+"_Arr"))return"break";if(!h.e.IsEmpty(e[i].Behaviour)&&("Accruals"==e[i].Behaviour.toString()||"Accruals-AccumulateForPreviousYears"==e[i].Behaviour.toString()))return"continue";(a=new y.a).Header=s.GetResource(e[i].ComponentCode.toString(),50052)+"_Arr",a.DisplayMember=t+e[i].SNo.toString()+"_Arr",a.ID=t+e[i].SNo.toString()+"_Arr",a.DataType="FLOAT",a.DecimalPoints=o.a.SessionManager.Preferences.PayrollNoOfDecimals,a.ReadOnly=!0,a.ShowTotal=!0,a.IsCalculated=1,a.HeaderBackColor="Earning"==t?"LightBlue":"LightCoral",a.Width=80,"-1"!=h.e.String(e[i].Visible)&&(a.IsVisible="1"==h.e.String(e[i].Visible)),"-1"!=h.e.String(e[i].Width)&&(a.Width=parseInt(e[i].Width)),"-1"!=h.e.String(e[i].IndexValue)&&(a.DisplayIndex=parseInt(e[i].IndexValue)),"-1"!=h.e.String(e[i].Mandatory)&&(a.Mandatory="1"==h.e.String(e[i].Mandatory));var l=s.dgvEmployees.Columns.find((function(s){return s.DisplayMember==t+e[i].SNo.toString()}));null!=l&&(s.dgvEmployees.Columns.Insert(s.dgvEmployees.Columns.indexOf(l)+1,a),s.dgvEmployees.TableColumns.push(a.DisplayMember))}},l=0;l<e.length;l++){var n=i(l);if("break"===n)break}}},{key:"btnUnPost_Click",value:function(){this.sBGWorkType="UNPOST",this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null)}},{key:"btnClear_Click",value:function(){this.oCMP=null,this.dgvEmployees.Clear(),this.dgvEmployees.UpdateTotals(),this.sPayrollMonth=" / ["+o.a.SessionManager.PayrollMonth.ToString("MMM-yyyy")+"]",this.lblPayrollMonth=o.a.SessionManager.PayrollMonth.ToString("MMM, yyyy"),this.lblPayrollMonthStart=o.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy"),this.lblPayrollMonthEnd=o.a.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy"),this.SelectAll=!1,this.FailedCount=0,this.Failed="",this.sBGWorkType="",this.lstSelectedEmps=new Array,this.IsProcessed=!1}},{key:"btnPost_Click",value:function(){this.sBGWorkType="POST",this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null)}},{key:"btnFilter_Click",value:function(){var e=this;this.sFilter="",o.a.SessionManager.Preferences.ContainsKey("ConsolidatedPayrollFilter")&&parseInt(o.a.SessionManager.Preferences.ConsolidatedPayrollFilter)>0?null==this.objEmpFilter?this.objEmpFilter=new M.a("",0,3):(this.objEmpFilter.CostCenterFilters.length>0?this.objEmpFilter.CostCenters.SelectedValue=this.objEmpFilter.CostCenterFilters[0].CostCenterID.toString():(this.objEmpFilter.Filter=3,this.objEmpFilter.InitControls()),this.objEmpFilter.CostCenters.Enable=!0):null==this.objEmpFilter?this.objEmpFilter=new M.a("",0,0):(this.objEmpFilter.Filter=0,this.objEmpFilter.InitControls()),o.a.page.ShowDialog(this.objEmpFilter,L.a,{ShowCenter:!0,HideHeader:!0}).subscribe((function(){if(e.DialogResult=e.objEmpFilter.IsCompleted,e.objEmpFilter.IsCompleted&&(e.objEmpFilter.CostCenterFilters.length>0&&function(){for(var t=1,s="",a="",i="",o=0;o<e.objEmpFilter.CostCenterFilters.length;o++){var l=e.objEmpFilter.CostCenterFilters[o];if(l.CostCenterID>5e4&&(t=2,s="NodeID",a=50051==l.CostCenterID?"EmpSeqNo":"CCNID"+(l.CostCenterID-5e4)),l.SelectedNodes.length>0){if(1==l.SelectedNodes.length)i+=" AND ",i+=a+"="+l.SelectedNodes[0].Id;else if(!l.SelectedNodes.find((function(e){return e.Id==t&&e.IsGroup})))if(i+=" AND ",P.IPrefetchFilter.IsGroupTree(l)){for(var n="",r=0;r<l.SelectedNodes.length;r++)null!=l.SelectedNodes[r].Parent&&l.SelectedNodes[r].Parent.IsSelected||(n.length>0&&(n+=","),n+=l.SelectedNodes[r].Id);0==n.length&&(n+=-12912),i+=a+" IN ",i+=" (select T."+s+" GTID from "+D.b.GetTagTableName(l.CostCenterID)+" T with(nolock),"+D.b.GetTagTableName(l.CostCenterID)+" GTP with(nolock) where T.lft BETWEEN GTP.lft AND GTP.rgt AND GTP."+s+" IN ",i+=n.toString()+")  group by T."+s+")"}else{i+=a+" IN (";for(var d=0;d<l.SelectedNodes.length;d++)d>0&&(i+=","),i+=l.SelectedNodes[d].Id;i+=")"}}else l.DeleteButtonVisibility||(i+=" AND ",i+=a+"=-12912")}e.sFilter=i.toString()}(),e.objEmpFilter.Filter>0)){e.sFilter+=" AND ( CONVERT(DATETIME,EMP.DOJ) <='"+o.a.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")+"' AND CONVERT(DATETIME,EMP.DORelieve)  >='"+o.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"' ) ","True"==o.a.SessionManager.Preferences.NPDontAllowPayrollProcessing&&(e.sFilter+=" AND EmpSeqNo NOT IN ( Select NodeID From COM_CC50051 WITH(NOLOCK) \n                        Where ResignStatus='Posted' AND DateDiff(day,ISNULL(CONVERT(DATETIME,DORelieve),'01-Jan-9000'),'"+o.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')<=0\n                        AND DateDiff(day,CONVERT(DATETIME,CONVERT(DATETIME,('01-'+CONVERT(NVARCHAR(3),DATENAME(MONTH,ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000')))+'-'+CONVERT(NVARCHAR,YEAR(ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000'))))) ),'"+o.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')>=0 )"),"True"==o.a.SessionManager.Preferences.DontConsiderEmpsForPayroll&&parseInt(o.a.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)>0&&(e.sFilter+=" AND NOT ( MONTH(CONVERT(DATETIME,EMP.DOJ))="+o.a.SessionManager.PayrollMonth.iMonth()+" AND YEAR(CONVERT(DATETIME,EMP.DOJ))="+o.a.SessionManager.PayrollMonth.getFullYear()+" AND DAY(CONVERT(DATETIME,EMP.DOJ))>="+parseInt(o.a.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)+" ) "),o.a.SessionManager.LocationID>0&&o.a.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&o.a.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(e.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+o.a.SessionManager.LocationID+")"),h.e.IsEmpty(o.a.SessionManager.sWHEmpFilteredEmpSeqNos)||(e.sFilter+="  AND EmpSeqNo IN ("+o.a.SessionManager.sWHEmpFilteredEmpSeqNos+")"),"Processed"==e.objEmpFilter.StatusModes.SelectedValue?e.sFilter+=" AND EmpSeqNo IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                    JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                    JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                    WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+o.a.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))":"UnProcessed"==e.objEmpFilter.StatusModes.SelectedValue&&(e.sFilter+=" AND EmpSeqNo NOT IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                    JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                    JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                    WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+o.a.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))");var t=o.a.SessionManager.Preferences.ConsolidateMonthlyPayrollSort;""!=t.Trim()&&"None"!=t&&(e.sFilter+="TreeView"==t?" ORDER BY EMP.lft ":" ORDER BY EMP."+t);var s=[];s.push(o.a.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")),s.push(e.sFilter),s.push(0),s.push(o.a.SessionManager.RoleID),s.push(o.a.SessionManager.UserID),s.push(o.a.SessionManager.LanguageID);var a=o.a.empService.GetData(s,"spPAY_GetEmpMasterCCDetails");if(e.btnClear_Click(),null!=a&&a.Tables.length>0&&a.Tables[0].length>0)for(var i=function(t){var s=void 0,i=e.dgvEmployees.NewRow();i.EmpSeqNo=a.Tables[0][t].EmpSeqNo,i.EmpCode=a.Tables[0][t].EmpCode,i.EmpName=a.Tables[0][t].EmpName,i.SNo=(t+1).toString(),i.Select=!1;for(var l="",n=0;n<e.dgvEmployees.TableColumns.length;n++)((l=e.dgvEmployees.TableColumns[n]).startsWith("dcAlpha")||l.startsWith("dcCCNID"))&&(null!=(s=e.dsDocDesig.Tables[0].filter((function(e){return e.SysColumnName==l})))&&s.length>0&&(h.e.IsEmpty(s[0].UserColumnType)||("LISTBOX"==s[0].UserColumnType.toString().toUpperCase()?h.e.IsEmpty(s[0].UserDefaultValue)||(i[l+"_Key"]=s[0].UserDefaultValue.toString()):"TEXT"==s[0].UserColumnType.toString().toUpperCase()||"COMBOBOX"==s[0].UserColumnType.toString().toUpperCase()?h.e.IsEmpty(s[0].UserDefaultValue)||(i[l]=s[0].UserDefaultValue.toString()):"DATE"==s[0].UserColumnType.toString().toUpperCase()&&(h.e.IsEmpty(s[0].UserDefaultValue)||"TODAY"==s[0].UserDefaultValue.toString().toUpperCase()&&(i[l]=(new Date).ToString(o.a.SessionManager.Preferences["Date Format"]),e.dgvEmployees.TableColumns.Contains(l+"_Key")&&(i[l+"_Key"]=new Date))))));e.dgvEmployees.addRow(i),e.dgvEmployees.RefreshGrid=!0},l=0;l<a.Tables[0].length;l++)i(l)}})),Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting Filter_Click()")}},{key:"bgworker_DoWork",value:function(e,t){Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering bgworker_DoWork()"),"PROCESS"==this.sBGWorkType?this.ProcessPayrollData():"POST"==this.sBGWorkType?this.PostPayrollData():"UNPOST"==this.sBGWorkType?this.UnPostPayrollData():"LOAD"==this.sBGWorkType&&this.LoadXLData(this.objCMPLData),this.dgvEmployees.UpdateTotals(),Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting bgworker_DoWork()")}},{key:"ProcessPayrollData",value:function(){var e=this;Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering ProcessPayrollData()"),this.InProgress="";var t=0,s=0;if(null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0){this.lstSelectedEmps=new Array;for(var a="",i=0;i<this.dgvEmployees.Table.length;i++)Object(m.j)(this.dgvEmployees.Table[i].Select)&&(a+=this.dgvEmployees.Table[i].EmpSeqNo.toString()+",",this.lstSelectedEmps.push(i),s++);if(a.length>0&&s>0){if(a=a.substr(0,a.length-1),t=s,this.FailedCount=0,this.Failed="",this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=t,this.ProgressMessage="Payroll is processing, please wait ...",this.oCMP=new E.a,this.oCMP.oParent=this,this.oCMP.sSelectedEmpSeqNos=a,this.oCMP.PayrollMonth=o.a.SessionManager.PayrollMonth,this.oCMP.PayrollMonthStart=o.a.SessionManager.PayrollMonthStart,this.oCMP.PayrollMonthEnd=o.a.SessionManager.PayrollMonthEnd,this.oCMP.ProcessPayroll(),this.oCMP.IsCompleted){for(this.ProgressValue=0,this.ProgressMax=t,this.ProgressMessage="Filling data, please wait ...",this.iEmpIndex=0;this.iEmpIndex<this.oCMP.arrLstOthMPFields.length;this.iEmpIndex++)if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.length>0){if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.endsWith("NumFields"))return this.DisplayMessage=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.Replace("NumFields",""),void(this.MessageVisibility=!0);this.strResult=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage,this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++,this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult}else{this.strResult="",this.CalculateAccruals(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo);var l=null;if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].IsAlreadyProcessed){if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(l=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter((function(t){return t.EmpSeqNo==e.oCMP.arrLstOthMPFields[e.iEmpIndex].EmpSeqNo&&11==t.VoucherType}))),this.IsProcessWithArrears){if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&null!=l&&l.length>0)if(h.e.IsEmpty(l[0].dcAlpha21)||""==h.e.String(l[0].dcAlpha21).Trim())this.CalculateArrears(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo));else{null!=l[0].dcAlpha21&&null!=l[0].dcAlpha21&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths=l[0].dcAlpha21.toString()),null!=l[0].dcAlpha22&&null!=l[0].dcAlpha22&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays=l[0].dcAlpha22.toString());var n=o.a.common.GetDataTable("PAY099",new Date(o.a.SessionManager.PayrollMonth).ToString("dd MMM yyyy"));if(null!=n&&n.length>0)for(var r=o.a.common.GetDataTable("PAY100",this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo),d=function(t){var s=new Date(n[t].ArrearsCalcMonths);if(null!=r&&r.length>0){var a=r.filter((function(e){return e.ArrAdjMonth==s}));if(null!=a&&a.length>0){for(var i=0;i<e.oCMP.arrLstCPFields[e.iEmpIndex][0].length;i++)null!=a[0]["Earning"+e.oCMP.arrLstCPFields[e.iEmpIndex][0][i].SNo]&&null!=a[0]["Earning"+e.oCMP.arrLstCPFields[e.iEmpIndex][0][i].SNo]&&""!=a[0]["Earning"+e.oCMP.arrLstCPFields[e.iEmpIndex][0][i].SNo].toString()&&(e.oCMP.arrLstCPFields[e.iEmpIndex][0][i].ArrData+=s.ToString("dd MMM yyyy")+","+parseFloat(a[0]["Earning"+e.oCMP.arrLstCPFields[e.iEmpIndex][0][i].SNo])+",");for(var o=0;o<e.oCMP.arrLstCPFields[e.iEmpIndex][2].length;o++)null!=a[0]["Deduction"+e.oCMP.arrLstCPFields[e.iEmpIndex][2][o].SNo]&&null!=a[0]["Deduction"+e.oCMP.arrLstCPFields[e.iEmpIndex][2][o].SNo]&&""!=a[0]["Deduction"+e.oCMP.arrLstCPFields[e.iEmpIndex][2][o].SNo].toString()&&(e.oCMP.arrLstCPFields[e.iEmpIndex][2][o].ArrData+=s.ToString("dd MMM yyyy")+","+parseFloat(a[0]["Deduction"+e.oCMP.arrLstCPFields[e.iEmpIndex][2][o].SNo])+",")}}},p=0;p<n.length;p++)d(p)}}else if(null!=l&&l.length>0){for(var c=0;c<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;c++)this.oCMP.arrLstCPFields[this.iEmpIndex][0][c].dArrear="0";for(var C=0;C<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;C++)this.oCMP.arrLstCPFields[this.iEmpIndex][2][C].dArrear="0";this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarArrears=0,this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedArrears=0,this.oCMP.iEmpIndex=this.iEmpIndex,this.oCMP.othMPField=this.oCMP.arrLstOthMPFields[this.iEmpIndex],this.oCMP.ExecuteAllFormulas(),this.oCMP.CalculateNet(),null!=l[0].dcAlpha21&&null!=l[0].dcAlpha21&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths=""),null!=l[0].dcAlpha22&&null!=l[0].dcAlpha22&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays="")}}else this.IsProcessWithArrears&&this.CalculateArrears(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo));this.FillProcessedData(this.lstSelectedEmps[this.iEmpIndex]),this.ProgressValue=this.iEmpIndex+1,this.InProgress=this.iEmpIndex+1+" of "+t}this.MessageVisibility=!0,this.FailedCount>0&&this.Failed.length>1?(this.Failed=this.Failed.substr(0,this.Failed.length-1),this.DisplayMessage="Failed count : "+this.FailedCount+", Emp.Codes : ( "+this.Failed+" )"):null!=this.dgvEmployees&&null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0&&this.dgvEmployees.Table.filter((function(e){return Object(m.j)(e.Select)})).length>0&&(this.DisplayMessage="Processed Successfully")}}else this.DisplayMessage="Select atleast one Employee."}else this.DisplayMessage="No Employees found to process payroll.";this.MessageVisibility=!0,this.CheckViewForUser(0),Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting ProcessPayrollData()")}},{key:"CalculateArrears",value:function(e){var t=this;try{Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering CalculateArrears()"),this.dtArrData=[];var s=new Array,a=o.a.common.GetDataSet3("PAY077",e.toString(),o.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),"");if(null!=a&&a.Tables[0].length>0){var i=new Date(a.Tables[0][0].DtApplyFrom.toString()),l=new Date(a.Tables[0][0].DtEffectFrom.toString()),n=a.Tables[1][0].ArrCalcMonths.toString();if(l>i&&o.a.SessionManager.PayrollMonth>=l)for(var r=i;r<l;)n.Contains(r.ToString("dd/MMM/yyyy"))||s.push(r.ToString("dd/MMM/yyyy")),r=r.AddMonths(1)}s.length>0&&function(){for(var a,i,l="",n=0;n<s.length;n++)l.length>0&&(l+=";"),l+=s[n],(a={}).PayrollMonth=s[n],t.dtArrData.push(a);var r="'"+l.Replace(";","','")+"'",d=o.a.common.GetDataSet3("PAY079",e.toString(),r).Tables[0];if(null!=d&&d.length>0){i=d.filter((function(e){return 11==e.VoucherType}));for(var p=0;p<i.length;p++)t.oCMP.arrLstOthMPFields[t.iEmpIndex].sArrCalcMonthPaydays.length>0&&(t.oCMP.arrLstOthMPFields[t.iEmpIndex].sArrCalcMonthPaydays+=";"),t.oCMP.arrLstOthMPFields[t.iEmpIndex].sArrCalcMonthPaydays=t.oCMP.arrLstOthMPFields[t.iEmpIndex].sArrCalcMonthPaydays+h.e.String(i[p].PaidDays)}t.oCMP.arrLstOthMPFields[t.iEmpIndex].sArrsCalcMonths=l;var m=l.split(";");if(m.length>0){for(var c=0;c<t.oCMP.arrLstCPFields[t.iEmpIndex][0].length;c++)t.oCMP.arrLstCPFields[t.iEmpIndex][0][c].dArrear="0";for(var C=0;C<t.oCMP.arrLstCPFields[t.iEmpIndex][2].length;C++)t.oCMP.arrLstCPFields[t.iEmpIndex][2][C].dArrear="0";t.oCMP.arrLstOthMPFields[t.iEmpIndex].totEarArrears=0,t.oCMP.arrLstOthMPFields[t.iEmpIndex].totDedArrears=0;for(var u,y,g=o.a.common.GetDataTable("PAY098",""),M=o.a.common.GetDataSet3("PAY101",e.toString(),o.a.SessionManager.PayrollMonth.ToString("dd MMM yyyy")),P=0,D=function(s){if(null!=m[s]&&""!=m[s]&&(i=d.filter((function(e){return e.PayrollMonth=="'"+m[s]+"'"}))).length>0){var a=g.filter((function(e){return e.GradeID==i[0].dcCCNID53&&e.CPayrollDate<=m[s]})).Compute("max","CPayrollDate"),l=g.filter((function(e){return e.GradeID==i[0].dcCCNID53&&e.CPayrollDate==a.toString()})),n=new E.a;if(n.oParent=t,n.sSelectedEmpSeqNos=e.toString(),n.PayrollMonth=o.a.SessionManager.PayrollMonth,n.PayrollMonthStart=o.a.SessionManager.PayrollMonthStart,n.PayrollMonthEnd=o.a.SessionManager.PayrollMonthEnd,n.drcArrStructure=l,n.IsArrearclick=!0,n.ArrGradeID=parseInt(i[0].dcCCNID53),n.ProcessPayroll(),n.IsCompleted){n.arrLstOthMPFields[0].TotalDays=parseFloat(i[0].TotalDays),n.arrLstOthMPFields[0].MonthDays=parseFloat(i[0].TotalDays),n.arrLstOthMPFields[0].TotalLeaves=parseFloat(i[0].LeavesTaken),n.arrLstOthMPFields[0].WeeklyOffs=parseFloat(i[0].WOffs),n.arrLstOthMPFields[0].Holidays=parseFloat(i[0].Holidays);var r=parseFloat(i[0].TotalDays.toString())-parseFloat(i[0].LOPDays.toString())-parseFloat(i[0].LeavesTaken.toString())-parseFloat(i[0].UnpaidDays.toString());null!=(u=M.Tables[0].filter((function(e){return e.AdjMonth==new Date(m[s])})))&&u.length>0&&(r+=parseFloat(u[0].Days)),y=M.Tables[1].filter((function(e){return 2==e.DType&&e.ArrAdjMonth==new Date(m[s])})),n.SetDaysAttended(0,"Days Attended",r);var p=0,c=-1,C=0;i=d.filter((function(e){return e.PayrollMonth=="'"+m[s]+"'"&&11==e.VoucherType}));for(var D=0;D<t.oCMP.arrLstCPFields[t.iEmpIndex][0].length;D++)if(null==t.oCMP.arrLstCPFields[t.iEmpIndex][0][D].CalculateArrears||""==t.oCMP.arrLstCPFields[t.iEmpIndex][0][D].CalculateArrears||"No"!=t.oCMP.arrLstCPFields[t.iEmpIndex][0][D].CalculateArrears)for(var I=0;I<n.arrLstCPFields[0][0].length;I++)if(t.oCMP.arrLstCPFields[t.iEmpIndex][0][D].SNo==n.arrLstCPFields[0][0][I].SNo){C=0,P=0,c=t.oCMP.arrLstCPFields[t.iEmpIndex][0][D].SNo,h.e.IsEmpty(i[0]["dcCalcNum"+c])||(C=parseFloat(i[0]["dcCalcNum"+c])),null!=y&&y.length>0&&(h.e.IsEmpty(y[0]["Earning"+c])||(P=parseFloat(y[0]["Earning"+c]))),p=parseFloat(n.arrLstCPFields[0][0][I].dEarned)-C-P,t.oCMP.arrLstCPFields[t.iEmpIndex][0][D].ArrData+=m[s]+","+p+",",t.oCMP.arrLstCPFields[t.iEmpIndex][0][D].dArrear=(parseFloat(t.oCMP.arrLstCPFields[t.iEmpIndex][0][D].dArrear)+p).ToString(o.a.SessionManager.sPayrollDecimals),t.oCMP.arrLstCPFields[t.iEmpIndex][0][D].isArrCalculated=!0,null==t.oCMP.arrLstCPFields[t.iEmpIndex][0][D].AddToNet||""==t.oCMP.arrLstCPFields[t.iEmpIndex][0][D].AddToNet||"Net"!=t.oCMP.arrLstCPFields[t.iEmpIndex][0][D].AddToNet&&"NetAndTax"!=t.oCMP.arrLstCPFields[t.iEmpIndex][0][D].AddToNet||(t.oCMP.arrLstOthMPFields[t.iEmpIndex].totEarArrears+=p);break}i=d.filter((function(e){return e.PayrollMonth=="'"+m[s]+"'"&&12==e.VoucherType}));for(var S=0;S<t.oCMP.arrLstCPFields[t.iEmpIndex][2].length;S++)if(null==t.oCMP.arrLstCPFields[t.iEmpIndex][2][S].CalculateArrears||""==t.oCMP.arrLstCPFields[t.iEmpIndex][2][S].CalculateArrears||"No"!=t.oCMP.arrLstCPFields[t.iEmpIndex][2][S].CalculateArrears)for(var T=0;T<n.arrLstCPFields[0][2].length;T++)if(t.oCMP.arrLstCPFields[t.iEmpIndex][2][S].SNo==n.arrLstCPFields[0][2][T].SNo){C=0,P=0,c=t.oCMP.arrLstCPFields[t.iEmpIndex][2][S].SNo,null!=i[0]["dcCalcNum"+c]&&null!=i[0]["dcCalcNum"+c]&&""!=i[0]["dcCalcNum"+c].toString()&&(C=parseFloat(i[0]["dcCalcNum"+c])),null!=y&&y.length>0&&null!=y[0]["Deduction"+c]&&null!=y[0]["Deduction"+c]&&""!=y[0]["Deduction"+c].toString()&&(P=parseFloat(y[0]["Deduction"+c])),p=parseFloat(n.arrLstCPFields[0][2][T].dEarned)-C-P,t.oCMP.arrLstCPFields[t.iEmpIndex][2][S].ArrData+=m[s]+","+p+",",t.oCMP.arrLstCPFields[t.iEmpIndex][2][S].dArrear=(parseFloat(t.oCMP.arrLstCPFields[t.iEmpIndex][2][S].dArrear)+p).ToString(o.a.SessionManager.sPayrollDecimals),t.oCMP.arrLstCPFields[t.iEmpIndex][2][S].isArrCalculated=!0,null==t.oCMP.arrLstCPFields[t.iEmpIndex][2][S].AddToNet||""==t.oCMP.arrLstCPFields[t.iEmpIndex][2][S].AddToNet||"Net"!=t.oCMP.arrLstCPFields[t.iEmpIndex][2][S].AddToNet&&"NetAndTax"!=t.oCMP.arrLstCPFields[t.iEmpIndex][2][S].AddToNet||(t.oCMP.arrLstOthMPFields[t.iEmpIndex].totDedArrears+=p);break}}n.IsArrearclick=!1}},I=0;I<m.length;I++)D(I);var S,T;S=t.oCMP.arrLstOthMPFields[t.iEmpIndex].sArrCalcMonthPaydays,T=t.oCMP.arrLstOthMPFields[t.iEmpIndex].sArrsCalcMonths,t.oCMP.iEmpIndex=t.iEmpIndex,t.oCMP.othMPField=t.oCMP.arrLstOthMPFields[t.iEmpIndex],t.oCMP.ExecuteAllFormulas(),t.oCMP.arrLstOthMPFields[t.iEmpIndex].sArrCalcMonthPaydays=S,t.oCMP.arrLstOthMPFields[t.iEmpIndex].sArrsCalcMonths=T,t.oCMP.CalculateNet(),t.FillProcessedData(t.lstSelectedEmps[t.iEmpIndex])}}(),Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting CalculateArrears()")}catch(d){Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION btnArrears_Click()\r\n"+d.Message+"\r\n"+d.stack)}}},{key:"CalculateAccruals",value:function(e){var t=this.oCMP.arrLstOthMPFields[0].dsAllEmpsData.Tables[2];if((t=t.filter((function(t){return t.EmpSeqNo==e}))).length>0&&new Date(t[0].cEffectFrom).getFullYear()==o.a.SessionManager.PayrollMonth.getFullYear()&&new Date(t[0].cEffectFrom).iMonth()==o.a.SessionManager.PayrollMonth.iMonth()&&this.oCMP.lstAccrAccumulateSNos.length>0){for(var s="",a=0,i=0,l=0,n=0,r=0,d=0,h=0,p=0,m=0,c=-1,C=0;C<this.oCMP.lstAccrAccumulateSNos.length;C++)s.length>0&&(s+=","),s+="ISNULL(dcCalcNum"+this.oCMP.lstAccrAccumulateSNos[C]+",0) as dcCalcNum"+this.oCMP.lstAccrAccumulateSNos[C]+",ISNULL(dcCalcNumFC"+this.oCMP.lstAccrAccumulateSNos[C]+",0) as dcCalcNumFC"+this.oCMP.lstAccrAccumulateSNos[C];var u=o.a.empService.GetQueryData(e,"CONS002",JSON.stringify(s),o.a.SessionManager.PayrollMonth.ToString("dd MMM yyyy"),"");if(null!=u&&u.length>0)for(var y=0;y<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;y++)if(i=0,l=0,this.oCMP.arrLstCPFields[this.iEmpIndex][0][y].IsAccrualType&&"Accruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][y].Behaviour){c=this.oCMP.arrLstCPFields[this.iEmpIndex][0][y].SNo,a=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][y].dActual);for(var g=0;g<u.length;g++)r=parseFloat(u[g].TotalDays),n=parseFloat(u[g].DaysAttended)+parseFloat(u[g].PaidLeaves)+parseFloat(u[g].LOPDays),d=parseFloat(u[g]["dcCalcNum"+c]),h=parseFloat(u[g]["dcCalcNumFC"+c]),p=parseFloat((n/r*a).ToString(o.a.SessionManager.sPayrollDecimals)),m=parseFloat((p-d).ToString(o.a.SessionManager.sPayrollDecimals)),i+=parseFloat(m.ToString(o.a.SessionManager.sPayrollDecimals)),l+=h;this.oCMP.arrLstCPFields[this.iEmpIndex][0][y].dAdjusted=(i-l).ToString(o.a.SessionManager.sPayrollDecimals)}}}},{key:"FillProcessedData",value:function(e){var t=this;if(Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering FillProcessedData()"),null!=this.oCMP&&this.oCMP.IsCompleted&&!(this.iEmpIndex>this.oCMP.arrLstOthMPFields.length-1)){if(this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0)for(var s=0;s<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;s++)this.dgvEmployees.TableColumns.Contains("Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][s].SNo)&&(this.dgvEmployees.Table[e]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][s].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][s].dEarned).ToString(o.a.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][s].SNo+"_Arr")&&(this.dgvEmployees.Table[e]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][s].SNo+"_Arr"]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][s].dArrear).ToString(o.a.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][1].length>0)for(var a=0;a<this.oCMP.arrLstCPFields[this.iEmpIndex][1].length;a++)this.dgvEmployees.TableColumns.Contains("EarningOTHrs"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][a].SNo)&&(this.dgvEmployees.Table[e]["EarningOTHrs"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][a].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][1][a].dActual).ToString(o.a.SessionManager.sPayrollDecimals2)),this.dgvEmployees.TableColumns.Contains("EarningOTAmt"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][a].SNo)&&(this.dgvEmployees.Table[e]["EarningOTAmt"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][a].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][1][a].dEarned).ToString(o.a.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][2].length>0)for(var i=0;i<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;i++)this.dgvEmployees.TableColumns.Contains("Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][i].SNo)&&(this.dgvEmployees.Table[e]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][i].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][2][i].dEarned).ToString(o.a.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][i].SNo+"_Arr")&&(this.dgvEmployees.Table[e]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][i].SNo+"_Arr"]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][2][i].dArrear).ToString(o.a.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][3].length>0)for(var l=0;l<this.oCMP.arrLstCPFields[this.iEmpIndex][3].length;l++)this.dgvEmployees.TableColumns.Contains("DeductionOTHrs"+this.oCMP.arrLstCPFields[this.iEmpIndex][3][l].SNo)&&(this.dgvEmployees.Table[e]["DeductionOTHrs"+this.oCMP.arrLstCPFields[this.iEmpIndex][3][l].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][3][l].dActual).ToString(o.a.SessionManager.sPayrollDecimals2)),this.dgvEmployees.TableColumns.Contains("DeductionOTAmt"+this.oCMP.arrLstCPFields[this.iEmpIndex][3][l].SNo)&&(this.dgvEmployees.Table[e]["DeductionOTAmt"+this.oCMP.arrLstCPFields[this.iEmpIndex][3][l].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][3][l].dEarned).ToString(o.a.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0)for(var n=0;n<this.oCMP.arrLstCPFields[this.iEmpIndex][4].length;n++)this.dgvEmployees.TableColumns.Contains("Loan"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][n].SNo)&&null!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][n].LoanInstAmt&&(this.dgvEmployees.Table[e]["Loan"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][n].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][4][n].LoanInstAmt).ToString(o.a.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][5].length>0)for(var r=0;r<this.oCMP.arrLstCPFields[this.iEmpIndex][5].length;r++)this.dgvEmployees.TableColumns.Contains("Leave"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][r].SNo)&&(this.dgvEmployees.Table[e]["Leave"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][r].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][5][r].LeaveTaken).ToString(o.a.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][6].length>0)for(var d=function(s){if(t.dgvEmployees.TableColumns.Contains(t.oCMP.arrLstCPFields[t.iEmpIndex][6][s].ExtraFieldName))if("LISTBOX"==t.oCMP.arrLstCPFields[t.iEmpIndex][6][s].ExtraFieldDataType){if("EMPTY"!=t.oCMP.arrLstCPFields[t.iEmpIndex][6][s].ExtraFieldValue&&""!=t.oCMP.arrLstCPFields[t.iEmpIndex][6][s].ExtraFieldValue){var a=o.a.SessionManager.dtFeatures.filter((function(e){return e.FeatureID==parseInt(t.oCMP.arrLstCPFields[t.iEmpIndex][6][s].ExtraFieldName.Replace("dcCCNID",""))+5e4}));if(null!=a&&a.length>0){var i=o.a.empService.GetQueryData(t.oCMP.arrLstCPFields[t.iEmpIndex][6][s].ExtraFieldValue,"CONS001",a[0].TableName.toString(),"","");null!=i&&i.length>0&&(t.dgvEmployees.Table[e][t.oCMP.arrLstCPFields[t.iEmpIndex][6][s].ExtraFieldName]=i[0].Name.toString(),t.dgvEmployees.Table[e][t.oCMP.arrLstCPFields[t.iEmpIndex][6][s].ExtraFieldName+"_Key"]=t.oCMP.arrLstCPFields[t.iEmpIndex][6][s].ExtraFieldValue)}}}else"DATE"==t.oCMP.arrLstCPFields[t.iEmpIndex][6][s].ExtraFieldUserColumnType?"EMPTY"!=t.oCMP.arrLstCPFields[t.iEmpIndex][6][s].ExtraFieldValue&&(h.e.IsEmpty(t.oCMP.arrLstCPFields[t.iEmpIndex][6][s].ExtraFieldValue)||(t.dgvEmployees.Table[e][t.oCMP.arrLstCPFields[t.iEmpIndex][6][s].ExtraFieldName]=t.oCMP.arrLstCPFields[t.iEmpIndex][6][s].ExtraFieldValue,h.e.IsEmpty(t.oCMP.arrLstCPFields[t.iEmpIndex][6][s].ExtraFieldValue)||(t.dgvEmployees.Table[e][t.oCMP.arrLstCPFields[t.iEmpIndex][6][s].ExtraFieldName+"_Key"]=new Date(t.oCMP.arrLstCPFields[t.iEmpIndex][6][s].ExtraFieldValue)))):"EMPTY"!=t.oCMP.arrLstCPFields[t.iEmpIndex][6][s].ExtraFieldValue&&(t.dgvEmployees.Table[e][t.oCMP.arrLstCPFields[t.iEmpIndex][6][s].ExtraFieldName]=t.oCMP.arrLstCPFields[t.iEmpIndex][6][s].ExtraFieldValue)},p=0;p<this.oCMP.arrLstCPFields[this.iEmpIndex][6].length;p++)d(p);this.dgvEmployees.TableColumns.Contains("MonthDays")&&(this.dgvEmployees.Table[e].MonthDays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalDays.ToString("0.0")),this.dgvEmployees.TableColumns.Contains("DaysAttended")&&(this.dgvEmployees.Table[e].DaysAttended=this.oCMP.arrLstOthMPFields[this.iEmpIndex].DaysAttended.ToString("0.0")),this.dgvEmployees.TableColumns.Contains("TotalLeaves")&&(this.dgvEmployees.Table[e].TotalLeaves=this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalLeaves.ToString("0.0")),this.dgvEmployees.TableColumns.Contains("PaidLeaves")&&(this.dgvEmployees.Table[e].PaidLeaves=this.oCMP.arrLstOthMPFields[this.iEmpIndex].PaidLeaves.ToString("0.0")),this.dgvEmployees.TableColumns.Contains("WeeklyOffs")&&(this.dgvEmployees.Table[e].WeeklyOffs=this.oCMP.arrLstOthMPFields[this.iEmpIndex].WeeklyOffs.ToString("0.0")),this.dgvEmployees.TableColumns.Contains("Holidays")&&(this.dgvEmployees.Table[e].Holidays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].Holidays.ToString("0.0")),this.dgvEmployees.TableColumns.Contains("LOPDays")&&(this.dgvEmployees.Table[e].LOPDays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays.ToString("0.0")),this.dgvEmployees.TableColumns.Contains("UnpaidDays")&&(this.dgvEmployees.Table[e].UnpaidDays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].UnpaidDays.ToString("0.0")),this.dgvEmployees.TableColumns.Contains("TotalDays")&&(this.dgvEmployees.Table[e].TotalDays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalDays.ToString("0.0")),this.dgvEmployees.TableColumns.Contains("Basic")&&(this.dgvEmployees.Table[e].Basic=this.oCMP.arrLstOthMPFields[this.iEmpIndex].BasicMonthly.ToString(o.a.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("TotalEarnings")&&(this.dgvEmployees.Table[e].TotalEarnings=this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarnings.ToString(o.a.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("TotalDeductions")&&(this.dgvEmployees.Table[e].TotalDeductions=(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDeductions+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totLoans).ToString(o.a.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("NetSalary")&&(this.dgvEmployees.Table[e].NetSalary=this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary.ToString(o.a.SessionManager.sPayrollDecimals)),this.dgvEmployees.updateRow(this.dgvEmployees.Table[e]),this.dgvEmployees.UpdateTotals(),Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting FillProcessedData()")}}},{key:"CheckViewForUser",value:function(e){if(null!=this.dsDocDesig&&this.dsDocDesig.Tables.length>6&&this.dsDocDesig.Tables[6].length>0)for(var t=0;t<this.dgvEmployees.Columns.length;t++)this.SetView(this.dgvEmployees.Columns[t])}},{key:"SetView",value:function(e){var t=this.dsDocDesig.Tables[6],s=this.dsDocDesig.Tables[0];t=t.filter((function(e){return 1==e.Mode||2==e.Mode||3==e.Mode||4==e.Mode})),e instanceof y.a&&(t=e.CrRefColID>0?t.filter((function(t){return t.CostCenterColID==1e6+e.CrRefColID})):null!=e.CrRefColName&&""!=e.CrRefColName&&e.CrRefColName.startsWith("dcAlpha")?t.filter((function(t){return t.SysColumnName==e.CrRefColName})):[]),t.length>0?(e instanceof y.a&&(e.IsVisible=Object(m.j)(t[0].IsVisible.toString())),h.e.IsEmpty(t[0].IsMandatory)||e instanceof y.a&&(e.Mandatory=Object(m.j)(t[0].IsMandatory)),e instanceof y.a&&(e.ReadOnly=!Object(m.j)(t[0].IsEditable)),e instanceof y.a&&(e.Expression=h.e.String(t[0].Expression)),e instanceof y.a&&(e.Message=h.e.String(t[0].FailureMessage)),h.e.IsEmpty(t[0].ActionOptionID)?e instanceof y.a&&(e.Action=0):e instanceof y.a&&(e.Action=parseInt(t[0].ActionOptionID)),h.e.IsEmpty(t[0].NumFieldEditOptionID)?e instanceof y.a&&(e.EditOption=0):e instanceof y.a&&(e.EditOption=parseInt(t[0].NumFieldEditOptionID.toString()))):(e instanceof y.a&&(s="combobox"==e.DataType.toLowerCase()?s.filter((function(t){return t.SysColumnName==e.ValueBinding})):s.filter(3==e.CostCenterID||2==e.CostCenterID?function(t){return t.CostcenterColid==e.ID}:function(t){return t.SysColumnName==e.DisplayMember})),s.length>0&&(e instanceof y.a&&(o.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==o.a.SessionManager.Preferences.EnableDivisionWise.toString()&&50001==e.CostCenterID||o.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==o.a.SessionManager.Preferences.EnableLocationWise.toString()&&50002==e.CostCenterID||(e.ReadOnly=!Object(m.j)(s[0].IsEditable.toString()))),h.e.IsEmpty(s[0].IsMandatory)||e instanceof y.a&&(e.Mandatory=Object(m.j)(s[0].IsMandatory)),e instanceof y.a&&(e.IsVisible=Object(m.j)(s[0].IsVisible.toString()))),e instanceof y.a&&(e.EditOption=0),e instanceof y.a&&(e.Expression=""),e instanceof y.a&&(e.Message=""),e instanceof y.a&&(e.Action=0))}},{key:"UnPostPayrollData",value:function(){var e=this;Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering UnPostPayrollData()"),this.InProgress="";var t=0,s=0;if(null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0){this.lstSelectedEmps=new Array;for(var a="",i=0;i<this.dgvEmployees.Table.length;i++)Object(m.j)(this.dgvEmployees.Table[i].Select)&&(a+=this.dgvEmployees.Table[i].EmpSeqNo.toString()+",",this.lstSelectedEmps.push(i),s++);a.length>0&&s>0?function(){var i,l=(a=a.substr(0,a.length-1)).split(",");t=s,e.FailedCount=0,e.Failed="",e.ProgressVisibility=!0,e.ProgressValue=0,e.ProgressMax=t,e.ProgressMessage="Unposting Payroll, please wait ...";for(var n=o.a.common.GetDataSet3("PAY061",a,o.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")).Tables[0],r=function(s){if(e.strResult="",null!=l[s]&&""!=l[s]){if(null!=(i=n.filter((function(e){return e.EmpSeqNo==l[s]})))&&i.length>0){var a=0,r=[];r.push(e.CostCenterID),r.push(parseInt(i[0].DocID)),r.push(1);var d=o.a.document.DeleteSelectedRows(r,a);e.strResult=d.Message,a=d.RetValue}else e.strResult="No Data exits to delete.",e.Failed+=e.dgvEmployees.Table[e.lstSelectedEmps[s]].EmpCode.toString()+",",e.FailedCount++;e.dgvEmployees.Table[e.lstSelectedEmps[s]].Result=e.strResult,e.dgvEmployees.updateRow(e.dgvEmployees.Table[e.lstSelectedEmps[s]])}e.ProgressValue=s+1,e.InProgress=s+1+" of "+t},d=0;d<l.length;d++)r(d);e.FailedCount>0&&e.Failed.length>1?(e.Failed=e.Failed.substr(0,e.Failed.length-1),e.DisplayMessage="Failed count : "+e.FailedCount+", Emp.Codes : ( "+e.Failed+" )"):null!=e.dgvEmployees&&null!=e.dgvEmployees.Table&&e.dgvEmployees.Table.length>0&&e.dgvEmployees.Table.filter((function(e){return Object(m.j)(e.Select)})).length>0&&(e.DisplayMessage="Unposted Successfully"),e.MessageVisibility=!0}():this.DisplayMessage="Select atleast one Employee."}else this.DisplayMessage="No Employees found to unpost payroll.";this.MessageVisibility=!0,Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting UnPostPayrollData()")}},{key:"bgworker_RunWorkerCompleted",value:function(e,t){this.ProgressVisibility=!1,this.dgvEmployees.UpdateTotals(),this.dgvEmployees.RefreshGrid=!0,"PROCESS"==this.sBGWorkType?this.IsProcessed=!0:"POST"==this.sBGWorkType&&(this.IsProcessed=!1)}},{key:"PostPayrollData",value:function(){var e=this;Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering PostPayrollData()"),this.InProgress="";var t=0,s=0;if(null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0){for(var a=0;a<this.dgvEmployees.Table.length;a++)Object(m.j)(this.dgvEmployees.Table[a].Select)&&s++;if(s>0){t=s,this.FailedCount=0,this.Failed="",this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=t,this.ProgressMessage="Posting data, please wait...";for(var i=function(s){if(Object(m.j)(e.dgvEmployees.Table[s].Select)){var a=e.oCMP.arrLstOthMPFields.find((function(t){return t.EmpSeqNo==e.dgvEmployees.Table[s].EmpSeqNo.toString()}));if(e.iEmpIndex=e.oCMP.arrLstOthMPFields.indexOf(a),e.iEmpIndex>=0){if(e.oCMP.arrLstOthMPFields[e.iEmpIndex].IsAlreadyProcessed&&null!=e.oCMP.arrLstOthMPFields[e.iEmpIndex].drcPayProcessed[0].WorkFlowID&&null!=e.oCMP.arrLstOthMPFields[e.iEmpIndex].drcPayProcessed[0].WorkFlowID&&""!=e.oCMP.arrLstOthMPFields[e.iEmpIndex].drcPayProcessed[0].WorkFlowID.toString()&&parseInt(e.oCMP.arrLstOthMPFields[e.iEmpIndex].drcPayProcessed[0].WorkFlowID)>0){var i=o.a.common.GetDataTable("PAY087",e.oCMP.arrLstOthMPFields[e.iEmpIndex].drcPayProcessed[0].INVDocDetailsID.toString()+",54,'"+o.a.SessionManager.UserName+"',40054,"+e.oCMP.arrLstOthMPFields[e.iEmpIndex].drcPayProcessed[0].WorkFlowID.toString()+","+e.oCMP.arrLstOthMPFields[e.iEmpIndex].drcPayProcessed[0].WorkFlowLevel.toString()+","+e.oCMP.arrLstOthMPFields[e.iEmpIndex].drcPayProcessed[0].StatusID.toString()+","+e.oCMP.arrLstOthMPFields[e.iEmpIndex].drcPayProcessed[0].CreatedDate.toString()+","+o.a.SessionManager.UserID+","+o.a.SessionManager.RoleID);null!=i&&i.length>0&&(h.e.IsEmpty(i[0].CanApprove)||"TRUE"!=i[0].CanApprove.toString().toUpperCase())&&(369!=parseInt(e.oCMP.arrLstOthMPFields[e.iEmpIndex].drcPayProcessed[0].StatusID)||o.a.SessionManager.IsActionAssigned(e.CostCenterID,"Edit Posted Docs")?441!=parseInt(e.oCMP.arrLstOthMPFields[e.iEmpIndex].drcPayProcessed[0].StatusID)||o.a.SessionManager.IsActionAssigned(e.CostCenterID,"Edit Approved Docs")||(e.oCMP.arrLstOthMPFields[e.iEmpIndex].sErrorMessage="Can't Edit Approved Document"):e.oCMP.arrLstOthMPFields[e.iEmpIndex].sErrorMessage="Can't Edit Posted Document")}e.oCMP.arrLstOthMPFields[e.iEmpIndex].sErrorMessage.length>0?(e.strResult=e.oCMP.arrLstOthMPFields[e.iEmpIndex].sErrorMessage,e.Failed+=e.oCMP.arrLstOthMPFields[e.iEmpIndex].EmpCode+",",e.FailedCount++,e.dgvEmployees.Table[s].Result=e.strResult):(e.strResult="",e.SaveVoucher(),e.ProgressValue=e.iEmpIndex+1,e.InProgress=e.iEmpIndex+1+" of "+t)}e.IsProcessed=!1}},l=0;l<this.dgvEmployees.Table.length;l++)i(l);this.MessageVisibility=!0,this.FailedCount>0&&this.Failed.length>1?(this.Failed=this.Failed.substr(0,this.Failed.length-1),this.DisplayMessage="Failed count : "+this.FailedCount+", Emp.Codes : ( "+this.Failed+" )"):null!=this.dgvEmployees&&null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0&&this.dgvEmployees.Table.filter((function(e){return Object(m.j)(e.Select)})).length>0&&(this.DisplayMessage="Posted Successfully")}else this.DisplayMessage="Select atleast one Employee."}else this.DisplayMessage="No Employees found to post payroll.";this.MessageVisibility=!0,Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting PostPayrollData()")}},{key:"ValidatePosting",value:function(){try{if(Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering IsValidated()"),null!=o.a.SessionManager.Preferences.PayrollProduct&&""!=o.a.SessionManager.Preferences.PayrollProduct&&(this.DefProdID=parseInt(o.a.SessionManager.Preferences.PayrollProduct)),0==this.DefProdID)return this.strResult+="Select any Default Payroll Product at Global Preferences",this.MessageVisibility=!0,!1;for(var e=0;e<this.dgvEmployees.Columns.length;e++)if(this.dgvEmployees.Columns[e].ID.startsWith("dcAlpha")&&!this.dgvEmployees.Columns[e].ID.endsWith("_Key")&&this.dgvEmployees.Columns[e].Mandatory&&"SELECTIONBOX"!=this.dgvEmployees.Columns[e].DataType&&""==h.e.String(this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]][this.dgvEmployees.Columns[e].ID]))return this.strResult+="Enter "+this.dgvEmployees.Columns[e].Header.toString(),this.MessageVisibility=!0,!1;return this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays<0?(this.strResult+="Days mismatch : Month days and Total days.",this.MessageVisibility=!0,!1):this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays<this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP?(this.strResult+="Employee Should have atleast "+this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP+" LOP Days",this.MessageVisibility=!0,!1):this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary<0&&("False"==o.a.SessionManager.Preferences.CreateLoanIfNetSalLessThanZero||0==parseInt(o.a.SessionManager.Preferences.CreateLoanType))?(this.strResult+="Net Amount should be greater than or equal to zero.",this.MessageVisibility=!0,!1):(Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting IsValidated()"),!0)}catch(t){return Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION IsValidated()",t),!1}}},{key:"SaveVoucher",value:function(){try{if(Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering btnPost_Click()"),this.ValidatePosting()){var e=[];e.push(this.CostCenterID),e.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].DocID),e.push(o.a.SessionManager.PayrollMonth.ToString("MMM'/'yyyy")+"-"),e.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].DocNo),e.push(Date.Today().ToString("dd/MMM/yyyy")),e.push(o.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")),e.push(""),e.push(this.GetDocumentXML()),e.push(""),e.push(""),e.push(""),e.push(this.GetActivityXML()),e.push("false"),o.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==o.a.SessionManager.Preferences.EnableLocationWise.toString()?e.push(o.a.SessionManager.LocationID>0?o.a.SessionManager.LocationID:1):e.push(0),o.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==o.a.SessionManager.Preferences.EnableDivisionWise.toString()?e.push(o.a.SessionManager.DivisionID>0?o.a.SessionManager.DivisionID:1):e.push(0),e.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].WID),e.push(o.a.SessionManager.RoleID),e.push(""),e.push(0),e.push(0),e.push(o.a.SessionManager.CompanyGUID),e.push(o.a.SessionManager.UserName),e.push(o.a.SessionManager.UserID),e.push(o.a.SessionManager.LanguageID),e.push(o.a.SessionManager.IsOffline);var t,s=o.a.document.SetTempInvDocumentPostPayroll(e);s.obj;var a=s;t=null!=a&&a.Tables.length>0&&a.Tables[a.Tables.length-1].length>0&&a.Columns[a.Tables.length-1].Contains("ErrorMessage")?a.Tables[a.Tables.length-1][0].ErrorMessage.toString():"Problem in processing your request,Please contact administrator.",s.obj>0?null!=a&&a.Tables.length>0&&a.Tables[a.Tables.length-1].length>0&&a.Columns[a.Tables.length-1].Contains("VoucherNo")&&a.Tables[a.Tables.length-1][0].VoucherNo.toString():null!=a&&a.Tables.length>0&&a.Tables[a.Tables.length-1].length>0&&a.Columns[a.Tables.length-1].Contains("ServerMessage")&&(this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++,"-407"==a.Tables[a.Tables.length-1][0].ServerMessage.toString()?-407:-12345),this.strResult+=t,this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult,this.dgvEmployees.updateRow(this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]])}else this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++;Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting btnPost_Click()")}catch(i){this.strResult+=i.message,Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION btnPost_Click()"+i.stack)}this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult}},{key:"GetDocumentXML",value:function(){var e,t=this,s="",a="",i="",l="",n="",r="",d=new Array,p=" dcAlpha1='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].BasicMonthly+"',dcAlpha3='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary+"',dcAlpha4='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalDays+"',dcAlpha5='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].DaysAttended+"',dcAlpha6='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalLeaves+"',dcAlpha7='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].WeeklyOffs+"',dcAlpha8='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].Holidays+"',dcAlpha9='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays+"',dcAlpha10='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].UnpaidDays+"',\n                    dcAlpha11='"+(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarnings+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTAmount)+"',dcAlpha12='"+(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDeductions+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totLoans)+"',dcAlpha13='0'";o.a.SessionManager.Preferences.ContainsKey("ShowPaymentModeselectionWhilePayrollProcessing")&&"True"==o.a.SessionManager.Preferences.ShowPaymentModeselectionWhilePayrollProcessing&&"Default"!=this.objEmpFilter.PaymentModes.SelectedValue?(p+=",dcAlpha14='"+this.objEmpFilter.PaymentModes.SelectedValue.toString()+"'",p+="Bank Transfer"==this.objEmpFilter.PaymentModes.SelectedValue?",dcAlpha15='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank.toString()+"',dcAlpha16='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].BankAccNo.toString()+"'":",dcAlpha15='',dcAlpha16=''"):(p+=",dcAlpha14='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()+"'","Bank Transfer"==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()?p+=",dcAlpha15='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank.toString()+"',dcAlpha16='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].BankAccNo.toString()+"'":p+=",dcAlpha15='',dcAlpha16=''"),p+=",dcAlpha17='"+o.a.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")+"',dcAlpha18='"+o.a.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")+"',\n                                dcAlpha19='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTHours+"',dcAlpha20='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTAmount+"',\n                                dcAlpha21='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths+"',dcAlpha22='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays+"' ",p+=",dcAlpha23='' ",p+=",dcAlpha24='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].PaidLeaves+"' ",p+=",dcAlpha25='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totActEarnings+"' ",p+=",dcAlpha26='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarArrears+"' ",p+=",dcAlpha27='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarAdjustments+"' ",p+=",dcAlpha28='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totActDeductions+"' ",p+=",dcAlpha29='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedArrears+"' ",p+=",dcAlpha30='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedAdjustments+"' ",p+=",dcAlpha31='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totLoans+"' ",o.a.SessionManager.Preferences.ContainsKey("ShowPaymentModeselectionWhilePayrollProcessing")&&"True"==o.a.SessionManager.Preferences.ShowPaymentModeselectionWhilePayrollProcessing&&"Default"!=this.objEmpFilter.PaymentModes.SelectedValue?p+="Bank Transfer"==this.objEmpFilter.PaymentModes.SelectedValue?",dcAlpha34='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].IBANNo.toString()+"'":",dcAlpha34=''":"Bank Transfer"==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()?p+=",dcAlpha34='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].IBANNo.toString()+"'":p+=",dcAlpha34=''",i+='<Alpha Query="',i+=p;for(var m=0;m<this.dgvEmployees.TableColumns.length;m++)this.dgvEmployees.TableColumns[m].startsWith("dcAlpha")&&!this.dgvEmployees.TableColumns[m].endsWith("_Key")&&(n+=" "+this.dgvEmployees.TableColumns[m]+"='"+h.e.EncodeXML(this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]][this.dgvEmployees.TableColumns[m]].toString())+"',");(n+=" ").length>0&&(i+=","+n),i+='" ></Alpha>',n="",l+='<CostCenters Query="',n+=" dcCCNID51="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+",",n+=" dcCCNID53="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].GradeID+",",null==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank||"0"==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank.toString()||null==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank||"Cash"==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()?n+=" dcCCNID68=1,":n+=" dcCCNID68="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank.toString()+",",d.push("dcCCNID51"),d.push("dcCCNID53"),d.push("dcCCNID68");var c="",C="";if(null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim.length>0)for(var u=0;u<Object.keys(this.oCMP.arrLstOthMPFields[0].dsAllEmpsData.Tables[24][0]).length;u++)c=Object.keys(this.oCMP.arrLstOthMPFields[0].dsAllEmpsData.Tables[24][0])[u].toString(),C=this.oCMP.arrLstOthMPFields[0].drcAsOnDim[0][c].toString(),c.Contains("CCNID")&&"CCNID51"!=c&&"CCNID53"!=c&&"CCNID68"!=c&&(n+=" dc"+c+"="+C+",",d.Contains("dc"+c)||d.push("dc"+c));for(var y=0;y<this.dgvEmployees.TableColumns.length;y++)this.dgvEmployees.TableColumns[y].startsWith("dcCCNID")&&(d.Contains(this.dgvEmployees.TableColumns[y])||this.dgvEmployees.TableColumns[y].endsWith("_Key")||(n+=" "+this.dgvEmployees.TableColumns[y]+"="+h.e.EncodeXML(this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]][this.dgvEmployees.TableColumns[y]+"_Key"].toString())+","));if(n.length>0&&(l+=n),l+='" ></CostCenters>',a+='" ProductID="'+this.DefProdID+'" Quantity="0" Unit="1" UOMConversion="1" UOMConvertedQty="0" Rate="0" Gross="0" IsQtyIgnored="1" AverageRate="0" StockValue="0" StockValueFC="0" RefNO="" BillDate="'+o.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+'" CurrencyID="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].CurrencyID+'" ExchangeRate="1" DebitAccount="'+this.sDrAccount+'" CreditAccount="'+this.sCrAccount+'" CommonNarration="'+h.e.EncodeXML("POSTED FROM CONSOLIDATED MONTHLY PAYROLL"),this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0){if(s+="\x11",s+="<Row>",s+="<AccountsXML></AccountsXML>",s+='<Transactions DocSeqNo="1" VoucherType="11" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Earning',r="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(null!=(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter((function(e){return e.EmpSeqNo==t.oCMP.arrLstOthMPFields[t.iEmpIndex].EmpSeqNo&&11==e.VoucherType})))&&e.length>0&&(r=e[0].InvDocDetailsID.toString())),s+=r.length>0?'" DocDetailsID="'+r:'" DocDetailsID="',s+=a.toString()+'" ></Transactions>',n="",s+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0)for(var g=0;g<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;g++)null==this.oCMP.arrLstCPFields[this.iEmpIndex][0][g].SNo||h.e.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][0][g].SNo)||(n+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][g].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][g].dActual.Replace(",","")+",",n+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][g].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][g].dEarned.Replace(",","")+",",n+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][g].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][g].dArrear.Replace(",","")+",",n+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][g].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][g].dAdjusted.Replace(",","")+",");if(this.oCMP.arrLstCPFields[this.iEmpIndex][1].length>0)for(var M=0;M<this.oCMP.arrLstCPFields[this.iEmpIndex][1].length;M++)h.e.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][1][M].SNo)||(n+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][M].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][1][M].dActual.Replace(",","")+",",n+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][M].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][1][M].dEarned.Replace(",","")+",");n.length>0&&(s+=n),s+='" ></Numeric>',s+=i.toString(),s+=l.toString(),s+="<EXTRAXML></EXTRAXML>",s+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][2].length>0){if(s+="\x11",s+="<Row>",s+="<AccountsXML></AccountsXML>",s+='<Transactions DocSeqNo="2" VoucherType="12" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Deduction',r="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(null!=(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter((function(e){return e.EmpSeqNo==t.oCMP.arrLstOthMPFields[t.iEmpIndex].EmpSeqNo&&12==e.VoucherType})))&&e.length>0&&(r=e[0].InvDocDetailsID.toString())),s+=r.length>0?'" DocDetailsID="'+r:'" DocDetailsID="',s+=a.toString()+'" ></Transactions>',n="",s+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][2].length>0)for(var P=0;P<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;P++)h.e.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][2][P].SNo)||(n+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][P].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][P].dActual.Replace(",","")+",",n+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][P].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][P].dEarned.Replace(",","")+",",n+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][P].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][P].dArrear.Replace(",","")+",",n+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][P].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][P].dAdjusted.Replace(",","")+",");n.length>0&&(s+=n),s+='" ></Numeric>',s+=i.toString(),s+=l.toString(),s+="<EXTRAXML></EXTRAXML>",s+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].iExtLoansCnt>0){if(s+="\x11",s+="<Row>",s+="<AccountsXML></AccountsXML>",s+='<Transactions DocSeqNo="3" VoucherType="13" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Loan',r="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(null!=(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter((function(e){return e.EmpSeqNo==t.oCMP.arrLstOthMPFields[t.iEmpIndex].EmpSeqNo&&13==e.VoucherType})))&&e.length>0&&(r=e[0].InvDocDetailsID.toString())),s+=r.length>0?'" DocDetailsID="'+r:'" DocDetailsID="',s+=a.toString()+'" ></Transactions>',n="",s+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0)for(var D=0;D<this.oCMP.arrLstCPFields[this.iEmpIndex][4].length;D++)h.e.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][4][D].SNo)||1!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][D].IsVisible||(n+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][D].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][D].LoanActInstAmt.Replace(",","")+",",n+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][D].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][D].LoanInstAmt.Replace(",","")+",",n+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][D].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][D].LoanBalAmt.Replace(",","")+",",n+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][D].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][D].LoanPayStatus+",");n.length>0&&(s+=n),s+='" ></Numeric>',s+=i.toString(),s+=l.toString(),s+="<EXTRAXML></EXTRAXML>",s+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][5].length>0){if(s+="\x11",s+="<Row>",s+="<AccountsXML></AccountsXML>",s+='<Transactions DocSeqNo="4" VoucherType="14" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Leaves',r="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(null!=(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter((function(e){return e.EmpSeqNo==t.oCMP.arrLstOthMPFields[t.iEmpIndex].EmpSeqNo&&14==e.VoucherType})))&&e.length>0&&(r=e[0].InvDocDetailsID.toString())),s+=r.length>0?'" DocDetailsID="'+r:'" DocDetailsID="',s+=a.toString()+'" ></Transactions>',n="",s+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][5].length>0)for(var E=0;E<this.oCMP.arrLstCPFields[this.iEmpIndex][5].length;E++)h.e.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][5][E].SNo)||(n+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][E].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][E].LeaveTotOPBal.Replace(",","")+",",n+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][E].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][E].LeaveTaken.Replace(",","")+",",n+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][E].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][E].LeaveMonOPBal.Replace(",","")+",",n+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][E].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][E].LeaveNetBal.Replace(",","")+",");n.length>0&&(s+=n),s+='" ></Numeric>',s+=i.toString(),s+=l.toString(),s+="<EXTRAXML></EXTRAXML>",s+="</Row>"}return s.toString()}},{key:"GetActivityXML",value:function(){var e,t=this,s="",a="",i="";if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0)for(var l=0;l<this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length;l++)s+="~"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[l].InvDocDetailsID.toString();var n="";if(n+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].IsAlreadyProcessed?s.length>0?'<XML DetailIds="'+s+'" AppRejDate="'+(new Date).ToString("dd/MMM/yyyy")+'" >':'<XML AppRejDate="'+(new Date).ToString("dd/MMM/yyyy")+'" >':s.length>0?'<XML DetailIds="'+s+'" >':"<XML>",this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].iExtLoansCnt>0&&function(){var s,l,r,d,p,m,c="0";if(a=i="",null!=t.oCMP.arrLstOthMPFields[t.iEmpIndex].drcLoanRepay&&t.oCMP.arrLstOthMPFields[t.iEmpIndex].drcLoanRepay.length>0&&(c=t.oCMP.arrLstOthMPFields[t.iEmpIndex].drcLoanRepay[0].DocID.toString()),n+='<LoanRepaymentXML DocID="'+c+'" DocDetIDs="" WorkFlowID="0" >',n+="<DOCXML>",t.oCMP.arrLstCPFields[t.iEmpIndex][4].length>0){var C=0;null!=o.a.SessionManager.dtDocDefAccs&&(null!=(e=o.a.SessionManager.dtDocDefAccs.filter((function(e){return 40057==e.CostCenterID&&"CreditAccount"==e.SysColumnName})))&&e.length>0&&null!=e[0].UserDefaultValue&&""!=e[0].UserDefaultValue.toString().Trim()&&(a=e[0].UserDefaultValue.toString()),null!=(e=o.a.SessionManager.dtDocDefAccs.filter((function(e){return 40057==e.CostCenterID&&"DebitAccount"==e.SysColumnName})))&&e.length>0&&null!=e[0].UserDefaultValue&&""!=e[0].UserDefaultValue.toString().Trim()&&(i=e[0].UserDefaultValue.toString()));for(var u=0;u<t.oCMP.arrLstCPFields[t.iEmpIndex][4].length;u++)h.e.IsEmpty(t.oCMP.arrLstCPFields[t.iEmpIndex][4][u].SNo)||1!=t.oCMP.arrLstCPFields[t.iEmpIndex][4][u].IsVisible||h.e.IsEmpty(t.oCMP.arrLstCPFields[t.iEmpIndex][4][u].LoanInstAmt)||function(){s=t.oCMP.arrLstCPFields[t.iEmpIndex][4][u].LoanDocNo,r=t.oCMP.arrLstCPFields[t.iEmpIndex][4][u].LoanActInstNo,p=3==parseInt(t.oCMP.arrLstCPFields[t.iEmpIndex][4][u].LoanPayStatus)?t.oCMP.arrLstCPFields[t.iEmpIndex][4][u].LoanActInstAmt.Replace(",",""):t.oCMP.arrLstCPFields[t.iEmpIndex][4][u].LoanInstAmt.Replace(",","");var e=parseInt(r);t.oCMP.arrLstOthMPFields[t.iEmpIndex].IsAlreadyProcessed?null!=(m=t.oCMP.arrLstOthMPFields[t.iEmpIndex].dsAllEmpsData.Tables[11].filter((function(e){return e.EmpSeqNo==t.oCMP.arrLstOthMPFields[t.iEmpIndex].EmpSeqNo&&e.RefNo==s&&e.dcAlpha5==o.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")})))&&m.length>0&&(e=parseInt(m[0].dcNum1)):(o.a.SessionManager.Preferences.ContainsKey("ShowLoanBalRespDedMonthWhilePayProc")&&"True"==o.a.SessionManager.Preferences.ShowLoanBalRespDedMonthWhilePayProc?(m=t.oCMP.arrLstOthMPFields[t.iEmpIndex].dsAllEmpsData.Tables[10].filter((function(a){return a.EmpSeqNo==t.oCMP.arrLstOthMPFields[t.iEmpIndex].EmpSeqNo&&a.DocNo==s&&a.InstallmentNo==e}))).SortBy(["InstallmentNo"]):(m=t.oCMP.arrLstOthMPFields[t.iEmpIndex].dsAllEmpsData.Tables[10].filter((function(a){return a.EmpSeqNo==t.oCMP.arrLstOthMPFields[t.iEmpIndex].EmpSeqNo&&a.DocNo==s&&a.InstBalance>0&&a.InstallmentNo<e}))).SortBy(["InstallmentNo"]),null!=m&&m.length>0&&(e=parseInt(m[0].InstallmentNo)));var h=parseFloat(p),c=0,y=0;do{C++,m=t.oCMP.arrLstOthMPFields[t.iEmpIndex].dsAllEmpsData.Tables[10].filter((function(a){return a.EmpSeqNo==t.oCMP.arrLstOthMPFields[t.iEmpIndex].EmpSeqNo&&a.DocNo==s&&a.InstallmentNo==e})),l=m[0].InvDocDetailsID.toString(),d=m[0].InstallmentAmt.toString().Replace(",",""),c=h>parseFloat(m[0].InstBalance)?parseFloat(m[0].InstBalance):h,n+="<RowHead/>",n+="<Row>",n+="<AccountsXML></AccountsXML>",n+='<Transactions DocSeqNo="'+C+'"  DocDetailsID="0" LinkedInvDocDetailsID="'+l+'" LinkedFieldName="dcNum3" LineNarration="" ProductID="'+t.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1" Rate="0" Gross="0" RefNO="'+s+'" LinkedFieldValue="'+c+'" IsQtyIgnored="1" AverageRate="0" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+i+'"  CreditAccount="'+a+'"  ></Transactions>',n+='<Numeric Query="dcNum1='+e+", dcCalcNum1="+e+", dcNum2="+d.Replace(",","")+", dcCalcNum2="+d.Replace(",","")+", dcNum3="+c.toString().Replace(",","")+", dcCalcNum3="+c.toString().Replace(",","")+', " ></Numeric>',n+="<Alpha Query=\"dcAlpha1=N'"+t.oCMP.arrLstCPFields[t.iEmpIndex][4][u].LoanApprovedAmt+"',dcAlpha2=N'"+(parseFloat(t.oCMP.arrLstCPFields[t.iEmpIndex][4][u].LoanBalAmt)-y)+"', dcAlpha3=N'"+p+"', dcAlpha4=N'"+new Date(m[0].DeductionMonth).ToString("dd/MMM/yyyy")+"', dcAlpha5=N'"+o.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"',dcAlpha6=N'1',dcAlpha7=N'"+t.oCMP.arrLstCPFields[t.iEmpIndex][4][u].LoanPayStatus+"', \" ></Alpha>",n+='<CostCenters Query="dcCCNID51='+t.oCMP.arrLstOthMPFields[t.iEmpIndex].EmpSeqNo+", dcCCNID52="+t.oCMP.arrLstCPFields[t.iEmpIndex][4][u].ComponentID+', " ></CostCenters>',n+="<EXTRAXML></EXTRAXML>",n+="</Row>",y+=c,h-=c,e++}while(h>0)}()}n+="</DOCXML>",n+="<BillXML></BillXML></LoanRepaymentXML>"}(),this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.length>0){var r=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.split(";"),d=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays.split(";");if(r.length>0){n+="<ArrearsXML>",n+="<Rows>";for(var p=0;p<r.length;p++)n+='<Row PayrollMonth="'+o.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),n+='" EmpSeqNo="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo,n+='" ArrearsCalcMonths="'+new Date(r[p]).ToString("dd/MMM/yyyy"),n+='" ArrCalcMonthPayDays="'+d[p].toString(),n+='" ArrearsCalcDays="',n+='" />';n+="</Rows>",n+="</ArrearsXML>"}}if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanCrNetSalLessZero.length>0&&(n+='<DelLoanXML DocID="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanCrNetSalLessZero[0].DocID.toString()+'" > </DelLoanXML>'),this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary<0&&"True"==o.a.SessionManager.Preferences.CreateLoanIfNetSalLessThanZero&&parseInt(o.a.SessionManager.Preferences.CreateLoanType)>0&&(a=i="",null!=o.a.SessionManager.dtDocDefAccs&&(null!=(e=o.a.SessionManager.dtDocDefAccs.filter((function(e){return 40056==e.CostCenterID&&"CreditAccount"==e.SysColumnName})))&&e.length>0&&null!=e[0].UserDefaultValue&&""!=e[0].UserDefaultValue.toString().Trim()&&(a=e[0].UserDefaultValue.toString()),null!=(e=o.a.SessionManager.dtDocDefAccs.filter((function(e){return 40056==e.CostCenterID&&"DebitAccount"==e.SysColumnName})))&&e.length>0&&null!=e[0].UserDefaultValue&&""!=e[0].UserDefaultValue.toString().Trim()&&(i=e[0].UserDefaultValue.toString())),n+='<CreateLoanXML DocID="" DocDetIDs="" WorkFlowID="0" >',n+="<DOCXML>",n+="<RowHead/>",n+="<Row>",n+="<AccountsXML></AccountsXML>",n+='<Transactions DocSeqNo="1"  DocDetailsID="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="" CommonNarration="LOAN CREATED FROM MONTHLY PAYROLL WHEN NET SALARY LESS THAN 0" ProductID="'+this.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1" Rate="0" Gross="0" RefNO="0" IsQtyIgnored="1" AverageRate="0" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+i+'"  CreditAccount="'+a+'"  ></Transactions>',n+='<Numeric Query="dcNum1=1, dcCalcNum1=1, dcNum2='+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+", dcCalcNum2="+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+', " ></Numeric>',n+="<Alpha Query=\"dcAlpha6=N'"+o.a.SessionManager.PayrollMonth.AddMonths(1).ToString("dd/MMM/yyyy")+"',dcAlpha1=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"', dcAlpha2=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"', dcAlpha4=N'1', dcAlpha3=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"',dcAlpha5=N'"+o.a.SessionManager.PayrollMonth.AddMonths(1).ToString("dd/MMM/yyyy")+"',dcAlpha7=N'"+o.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"', \" ></Alpha>",n+='<CostCenters Query="dcCCNID51='+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+", dcCCNID52="+o.a.SessionManager.Preferences.CreateLoanType+', " ></CostCenters>',n+="<EXTRAXML></EXTRAXML>",n+="</Row>",n+="</DOCXML>",n+="<BillXML></BillXML></CreateLoanXML>"),this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.length>0){var m=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.split(";");if(m.length>0){var c="";c+="    DELETE FROM PAY_EmpMonthlyArrAdjDetails WHERE EmpSeqNo="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+" AND DType=1 AND PayrollMonth='"+o.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"'";for(var C=0;C<m.length;C++){var u="",y="";c+="  INSERT INTO PAY_EmpMonthlyArrAdjDetails(EmpSeqNo,PayrollMonth,ArrAdjMonth,DType",u+="VALUES("+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+",'"+o.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"','"+m[C].toString()+"',1";for(var g=0;g<this.oCMP.arrLstCPFields[0][0].length;g++){var M="";if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][g].ArrData&&this.oCMP.arrLstCPFields[this.iEmpIndex][0][g].ArrData.length>0){var P;if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][g].ArrData=this.oCMP.arrLstCPFields[this.iEmpIndex][0][g].ArrData.TrimEnd(","),null!=(P=this.oCMP.arrLstCPFields[this.iEmpIndex][0][g].ArrData.split(";"))&&P.length>0)for(var D=0;D<P.length;D+=2)new Date(P[D]).ToString("dd MMM yyyy")==new Date(m[C]).ToString("dd MMM yyyy")&&(M=P[D+1])}y+=",Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][g].SNo,u+=null!=M&&""!=M?","+M:",0"}for(var E=0;E<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;E++){var I="";if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][E].ArrData&&this.oCMP.arrLstCPFields[this.iEmpIndex][2][E].ArrData.length>0){var S;if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][E].ArrData=this.oCMP.arrLstCPFields[this.iEmpIndex][2][E].ArrData.TrimEnd(","),null!=(S=this.oCMP.arrLstCPFields[this.iEmpIndex][2][E].ArrData.split(";"))&&S.length>0)for(var T=0;T<S.length;T+=2)new Date(S[T]).ToString("dd MMM yyyy")==new Date(m[C]).ToString("dd MMM yyyy")&&(I=S[T+1])}y+=",Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][E].SNo,u+=null!=I&&""!=I?","+I:",0"}c+=y+")",c+=u+")"}n+='<ArrearsDetailXML Query="'+c+'"></ArrearsDetailXML>'}}return(n+="</XML>").toString()}},{key:"GetRawExportHTML",value:function(){var e=this,t="",s="";t+="<html><meta charset='utf-8' /><body style='color:blac;background-color:white;'>",s+=".hdr{text-align:cente; padding:5px; background-color:#4F81BD;color:white;font-family:Arial;font-size:11pt} ",s+=".grp{padding:2p; background-color:#87CEEB; color:#FFFCF7;font-family:arial; font-size:10pt;}",s+=".tot{background-color:whit; color:red;font-family:arial; font-weight:bold; font-size:8pt;}",s+=".alt{background-color:whitesmok; color:black; font-family:arial; font-size:9pt; align:right;}",t+="<style>"+(s+=".null{background-color:#ECF9C;}").toString()+"</style>";var a=this.dgvEmployees.Table;t+="<table>",t+="<tr><td style='padding-top:10p;'><table border=1 style='border-collapse:collapse;  font-family:arial; font-size:9pt;' >",t+="<COLGROUP>";for(var i=null,o=function(s){n=e.dgvEmployees.TableColumns[s],null!=(i=e.dgvEmployees.Columns.find((function(t){return t.DisplayMember.toUpperCase()==e.dgvEmployees.TableColumns[s][n].toUpperCase()})))&&i.IsVisible&&(t+="<COL>")},l=0;l<this.dgvEmployees.TableColumns.length;l++){var n;o(l)}t+="</COLGROUP>",t+="<tr style=''>";for(var r=function(s){n=e.dgvEmployees.Table[s],null!=(i=e.dgvEmployees.Columns.find((function(t){return t.DisplayMember.toUpperCase()==e.dgvEmployees.TableColumns[s][n].toUpperCase()})))&&i.IsVisible&&(t+="<th class='hdr'>",t+=i.Header,t+="</th>")},d=0;d<this.dgvEmployees.Table.length;d++)r(d);t+="</tr>";for(var h=0;h<a.length;h++){if(t+="<tr",h%2==1&&(t+=" class=alt"),t+=">",0==this.dgvEmployees.TableColumns.length)t+="<td colspan="+this.dgvEmployees.TableColumns.length+">DELETED ROW</td>";else for(var p=function(s){n=e.dgvEmployees.TableColumns[h],null!=(i=e.dgvEmployees.Columns.find((function(t){return t.DisplayMember.toUpperCase()==e.dgvEmployees.TableColumns[s][n].toUpperCase()})))&&i.IsVisible&&(null==a[h][s]?t+="<td class='null'>":(t+="<td>",t+=a[h][s].toString()),t+="</td>")},m=0;m<this.dgvEmployees.TableColumns.length;m++)p(m);t+="</tr>"}return t+="</table>",t+="</td></tr></table>",(t+="</body><html>").toString()}},{key:"SelectAll",get:function(){return this._SelectAll},set:function(e){e!=this._SelectAll&&(this._SelectAll=e,this.SelectUnselectAll(e))}}],[{key:"GetLookupData",value:function(e){var t=o.a.common.GetDataSet("PAY060",e.toString());return null!=t&&t.Tables.length>0&&t.Columns[0].Contains("NodeID")?t.Tables[0]:null}}]),s}(C.b),F=s("EW98"),N=s("mrSG"),A=s("4HhE"),v=s("wlFP"),O=s("OPQN"),x=function(e){_inherits(a,e);var t=_createSuper(a);function a(e){var s;_classCallCheck(this,a),(s=t.call(this)).ButtonClick=new A.b,s.ProgressVisibility=!1,s.chkPostBasedOnDailyAttendance=new v.a,s.chkPostBasedOnAttDimWise=new v.a,s.chkIncludeOTHours=new v.a,s.EmployeesList=new c.a,s.PostVisiblility=!0,s.UnPostVisiblility=!0,s.dsDailyAttendanceData=null,s.sPayrollMonthMouseDoubleClickCommand=new A.b,s.btnCancelFlag=!1,s.sCrAccount="0",s.sDrAccount="0",s.SelectUnCheck=0,s.sFilter="",s.IsPosting=!1,s.iEmpIndex=0,s.strResult="",s.Failed="",s.FailedCount=0,s.DefProdID=0;try{Logger.InfoLog("PostPayrollViewModel::Entering PostPayrollViewModel()"),s.ClassName="PostPayrollViewModel",s.CostCenterID=40054,s.DisplayName=o.a.GetResource(e),s.Title=o.a.GetResource(e),s.DisplayMessage="",s.sPayrollMonth=" / ["+o.a.SessionManager.PayrollMonth.ToString("MMM-yyyy")+"]",s.ButtonClick.Subscribe(_assertThisInitialized(s),"Button_Click"),s.sPayrollMonthMouseDoubleClickCommand.Subscribe(_assertThisInitialized(s),"sPayrollMonth_MouseDoubleClick"),s.lblPayrollMonth=o.a.SessionManager.PayrollMonth.ToString("MMM, yyyy"),s.lblPayrollMonthStart=o.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy"),s.lblPayrollMonthEnd=o.a.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy"),s.PostVisiblility=o.a.SessionManager.IsActionAssigned(s.CostCenterID,"Create"),s.UnPostVisiblility=o.a.SessionManager.IsActionAssigned(s.CostCenterID,"Delete"),s.btnCancelFlag=!1,s.chkPostBasedOnDailyAttendance.Label=o.a.GetResource("PostbasedonDailyAttendance"),s.chkIncludeOTHours.Label=o.a.GetResource("IncludeOverTimeHours"),s.chkPostBasedOnAttDimWise.Label=o.a.GetResource("PostbasedonAttendanceDimensionwise"),s.LoadGrid(),s.btnFilter_Click(),"True"==o.a.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll&&(s.chkPostBasedOnDailyAttendance.IsChecked=!0,s.chkIncludeOTHours.IsChecked=!0),Logger.InfoLog("PostPayrollViewModel::Exiting PostPayrollViewModel()")}catch(i){Logger.ErrorLog("PostPayrollViewModel::EXCEPTION PostPayrollViewModel()"+i.stack)}return s}return _createClass(a,[{key:"sPayrollMonth_MouseDoubleClick",value:function(e){return Object(N.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,a,i,l,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(s.bind(null,"Saj9"));case 2:return t=e.sent,a=t.SetPayrollDateViewModel,e.next=6,Promise.resolve().then(s.bind(null,"V+gx"));case 6:i=e.sent,l=i.SetPayrollDateComponent,n=new a,o.a.page.ShowDialog(n,l,{ShowCenter:!0,Title:o.a.GetResource("Pay_SetPayrollDate")}),n.DialogResult&&this.btnClear_Click();case 10:case"end":return e.stop()}}),e,this)})))}},{key:"LoadGrid",value:function(){var e,t=(new u.a).GetScreenInfo(this.CostCenterID);null!=(e=t.Tables[0].filter((function(e){return"CreditAccount"==e.SysColumnName})))&&e.length>0&&!h.e.IsEmpty(e[0].UserDefaultValue)&&(this.sCrAccount=e[0].UserDefaultValue.toString()),null!=(e=t.Tables[0].filter((function(e){return"DebitAccount"==e.SysColumnName})))&&e.length>0&&null!=e[0].UserDefaultValue&&""!=e[0].UserDefaultValue.toString().Trim()&&(this.sDrAccount=e[0].UserDefaultValue.toString()),this.EmployeesList=new c.a,this.EmployeesList.CanUserDeleteRows=!0,this.EmployeesList.Height=0,this.EmployeesList.Table=[],this.EmployeesList.SelectAll.Visible=!0,this.EmployeesList.TableColumns.push("Select"),this.EmployeesList.DataTypes.Bool.push("Select"),this.EmployeesList.TableColumns.push("SNo"),this.EmployeesList.TableColumns.push("EmpSeqNo"),this.EmployeesList.TableColumns.push("EmpCode"),this.EmployeesList.TableColumns.push("EmpName"),this.EmployeesList.TableColumns.push("Result");var s=new y.a;this.EmployeesList.Columns=[],(s=new y.a).Header=o.a.GetResource("Pay_Select"),s.DisplayMember="Select",s.DataType="CheckBox",s.Width=50,s.CheckedChanged.Subscribe(this,"dgColSelect_CheckedChanged"),this.EmployeesList.Columns.push(s),(s=new y.a).Header=o.a.GetResource("Payroll_EmpSNo"),s.DisplayMember="SNo",s.DataType="TextBlock",s.Width=50,s.ReadOnly=!0,this.EmployeesList.Columns.push(s),(s=new y.a).Header=o.a.GetResource("EmployeeCode"),s.DisplayMember="EmpCode",s.DataType="TextBlock",s.Width=250,s.ReadOnly=!0,this.EmployeesList.Columns.push(s),(s=new y.a).Header=o.a.GetResource("EmployeeName"),s.DisplayMember="EmpName",s.DataType="TextBlock",s.Width=250,s.ReadOnly=!0,this.EmployeesList.Columns.push(s),(s=new y.a).Header=o.a.GetResource("Result"),s.DisplayMember="Result",s.DataType="TextBlock",s.Width=250,s.ReadOnly=!0,this.EmployeesList.Columns.push(s)}},{key:"dgColSelect_CheckedChanged",value:function(e,t){t||1==this.SelectAll&&(this.SelectUnCheck=1,this.SelectAll=!1)}},{key:"SelectUnselectAll",value:function(e){for(var t=0;t<this.EmployeesList.Table.length;t++)0==this.SelectUnCheck&&(this.EmployeesList.Table[t].Select=e);this.SelectUnCheck=0,this.EmployeesList.refreshDataView()}},{key:"Button_Click",value:function(e){Logger.InfoLog("PostPayrollViewModel::Entering Button_Click()"),"Post"==e.toString()?this.btnPost_Click():"Clear"==e.toString()?this.btnClear_Click():"UnPost"==e.toString()?this.btnUnPost_Click():"Filter"==e.toString()&&this.btnFilter_Click(),Logger.InfoLog("PostPayrollViewModel::Exiting Button_Click()")}},{key:"btnUnPost_Click",value:function(){this.IsPosting=!1,this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null)}},{key:"btnClear_Click",value:function(){this.EmployeesList.Clear(),this.sPayrollMonth=" / ["+o.a.SessionManager.PayrollMonth.ToString("MMM-yyyy")+"]",this.lblPayrollMonth=o.a.SessionManager.PayrollMonth.ToString("MMM, yyyy"),this.lblPayrollMonthStart=o.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy"),this.lblPayrollMonthEnd=o.a.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy"),this.SelectAll=!1,this.chkIncludeOTHours.IsChecked=!1,this.chkPostBasedOnDailyAttendance.IsChecked=!1,this.chkPostBasedOnAttDimWise.IsChecked=!1,this.FailedCount=0,this.Failed="",this.InProgress="",this.IsPosting=!1,this.lstSelectedEmps=[],"True"==o.a.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll&&(this.chkPostBasedOnDailyAttendance.IsChecked=!0,this.chkIncludeOTHours.IsChecked=!0)}},{key:"btnPost_Click",value:function(){this.IsPosting||(this.IsPosting=!0,this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null))}},{key:"btnFilter_Click",value:function(){var e=this;Logger.InfoLog("PostPayrollViewModel::Entering Filter_Click()"),o.a.SessionManager.Preferences.ContainsKey("PostPayrollFilter")&&parseInt(o.a.SessionManager.Preferences.PostPayrollFilter)>0?null==this.objEmpFilter?this.objEmpFilter=new M.a("",0,2):this.objEmpFilter.CostCenterFilters.length>0?this.objEmpFilter.CostCenters.SelectedValue=this.objEmpFilter.CostCenterFilters[0].CostCenterID.toString():(this.objEmpFilter.Filter=2,this.objEmpFilter.InitControls()):null==this.objEmpFilter?this.objEmpFilter=new M.a("",0,0):(this.objEmpFilter.Filter=0,this.objEmpFilter.InitControls()),this.objEmpFilter.Filter>0&&o.a.page.ShowDialog(this.objEmpFilter,L.a,{ShowCenter:!0,HideHeader:!0}).subscribe((function(){e.DialogResult=e.objEmpFilter.IsCompleted,e.objEmpFilter.IsCompleted&&(e.objEmpFilter.CostCenterFilters.length>0?function(){for(var t=1,s="",a="",i="",l=0;l<e.objEmpFilter.CostCenterFilters.length;l++){var n=e.objEmpFilter.CostCenterFilters[l];if(n.CostCenterID>5e4&&(t=2,s="NodeID",a=50051==n.CostCenterID?"EmpSeqNo":"CCNID"+(n.CostCenterID-5e4)),n.SelectedNodes.length>0){if(1==n.SelectedNodes.length)i+=" AND ",i+=a+"="+n.SelectedNodes[0].Id;else if(!n.SelectedNodes.find((function(e){return e.Id==t&&e.IsGroup})))if(i+=" AND ",P.IPrefetchFilter.IsGroupTree(n)){for(var r="",d=0;d<n.SelectedNodes.length;d++)null!=n.SelectedNodes[d].Parent&&n.SelectedNodes[d].Parent.IsSelected||(r.length>0&&(r+=","),r+=n.SelectedNodes[d].Id);0==r.length&&(r+=-12912),i+=a+" IN ",i+=" (select T."+s+" GTID from "+D.b.GetTagTableName(n.CostCenterID)+" T with(nolock),"+D.b.GetTagTableName(n.CostCenterID)+" GTP with(nolock) where T.lft BETWEEN GTP.lft AND GTP.rgt AND GTP."+s+" IN (",i+=r.toString()+")  group by T."+s+")"}else{i+=a+" IN (";for(var p=0;p<n.SelectedNodes.length;p++)p>0&&(i+=","),i+=n.SelectedNodes[p].Id;i+=")"}}else n.DeleteButtonVisibility||(i+=" AND ",i+=a+"=-12912")}e.sFilter=i.toString(),e.sFilter+=" AND ( CONVERT(DATETIME,EMP.DOJ) <='"+o.a.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")+"' AND CONVERT(DATETIME,EMP.DORelieve)  >='"+o.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"' ) ","True"==o.a.SessionManager.Preferences.NPDontAllowPayrollProcessing&&(e.sFilter+=" AND EmpSeqNo NOT IN ( Select NodeID From COM_CC50051 WITH(NOLOCK) \n                                                            Where ResignStatus='Posted' AND DateDiff(day,ISNULL(CONVERT(DATETIME,DORelieve),'01-Jan-9000'),'"+o.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')<=0\n                                                            AND DateDiff(day,CONVERT(DATETIME,CONVERT(DATETIME,('01-'+CONVERT(NVARCHAR(3),DATENAME(MONTH,ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000')))+'-'+CONVERT(NVARCHAR,YEAR(ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000'))))) ),'"+o.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')>=0 )"),"True"==o.a.SessionManager.Preferences.DontConsiderEmpsForPayroll&&parseInt(o.a.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)>0&&(e.sFilter+=" AND NOT ( MONTH(CONVERT(DATETIME,EMP.DOJ))="+o.a.SessionManager.PayrollMonth.iMonth()+" AND YEAR(CONVERT(DATETIME,EMP.DOJ))="+o.a.SessionManager.PayrollMonth.getFullYear()+" AND DAY(CONVERT(DATETIME,EMP.DOJ))>="+parseInt(o.a.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)+" ) "),o.a.SessionManager.LocationID>0&&o.a.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&o.a.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(e.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+o.a.SessionManager.LocationID+")"),h.e.IsEmpty(o.a.SessionManager.sWHEmpFilteredEmpSeqNos)||(e.sFilter+="  AND EmpSeqNo IN ("+o.a.SessionManager.sWHEmpFilteredEmpSeqNos+")"),"Processed"==e.objEmpFilter.StatusModes.SelectedValue?e.sFilter+=" AND EmpSeqNo IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                                JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                                JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                                WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+o.a.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))":"UnProcessed"==e.objEmpFilter.StatusModes.SelectedValue&&(e.sFilter+=" AND EmpSeqNo NOT IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                                JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                                JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                                WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+o.a.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))");var m=o.a.SessionManager.Preferences.ConsolidateMonthlyPayrollSort;""!=m.Trim()&&"None"!=m&&(e.sFilter+="TreeView"==m?" ORDER BY EMP.lft ":" ORDER BY EMP."+m);var c=[];c.push(o.a.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")),c.push(e.sFilter),c.push(0),c.push(o.a.SessionManager.RoleID),c.push(o.a.SessionManager.UserID),c.push(o.a.SessionManager.LanguageID);var C=o.a.empService.GetData(c,"spPAY_GetEmpMasterCCDetails");if(e.EmployeesList.Clear(),null!=C&&C.Tables.length>0&&C.Tables[0].length>0)for(var u=0;u<C.Tables[0].length;u++){var y=e.EmployeesList.NewRow();y.EmpSeqNo=C.Tables[0][u].EmpSeqNo,y.EmpCode=C.Tables[0][u].EmpCode,y.EmpName=C.Tables[0][u].EmpName,y.SNo=(u+1).toString(),y.Select=!1,e.EmployeesList.addRow(y)}}():e.objEmpFilter.Filter>0&&e.FilterEmployees())})),Logger.InfoLog("PostPayrollViewModel::Exiting Filter_Click()")}},{key:"FilterEmployees",value:function(){try{Logger.InfoLog("PostPayrollViewModel::Entering FilterEmployees()"),this.sFilter=" AND ( CONVERT(DATETIME,EMP.DOJ) <='"+o.a.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")+"' AND CONVERT(DATETIME,EMP.DORelieve) >='"+o.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"' ) ","True"==o.a.SessionManager.Preferences.NPDontAllowPayrollProcessing&&(this.sFilter+=" AND EmpSeqNo NOT IN ( Select NodeID From COM_CC50051 WITH(NOLOCK) \n\t\t\t                                        Where ResignStatus='Posted' AND DateDiff(day,ISNULL(CONVERT(DATETIME,DORelieve),'01-Jan-9000'),'"+o.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')<=0\n\t\t\t                                        AND DateDiff(day,CONVERT(DATETIME,CONVERT(DATETIME,('01-'+CONVERT(NVARCHAR(3),DATENAME(MONTH,ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000')))+'-'+CONVERT(NVARCHAR,YEAR(ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000'))))) ),'"+o.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')>=0 )"),"True"==o.a.SessionManager.Preferences.DontConsiderEmpsForPayroll&&parseInt(o.a.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)>0&&(this.sFilter+=" AND NOT ( MONTH(CONVERT(DATETIME,EMP.DOJ))="+o.a.SessionManager.PayrollMonth.iMonth()+" AND YEAR(CONVERT(DATETIME,EMP.DOJ))="+o.a.SessionManager.PayrollMonth.getFullYear()+" AND DAY(CONVERT(DATETIME,EMP.DOJ))>="+parseInt(o.a.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)+" ) "),o.a.SessionManager.LocationID>0&&o.a.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&o.a.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+o.a.SessionManager.LocationID+")"),h.e.IsEmpty(o.a.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sFilter+="  AND EmpSeqNo IN ("+o.a.SessionManager.sWHEmpFilteredEmpSeqNos+")"),"Processed"==this.objEmpFilter.StatusModes.SelectedValue?this.sFilter+=" AND EmpSeqNo IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                    JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                    JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                    WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+o.a.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))":"UnProcessed"==this.objEmpFilter.StatusModes.SelectedValue&&(this.sFilter+=" AND EmpSeqNo NOT IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                    JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                    JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                    WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+o.a.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))");var e=o.a.SessionManager.Preferences.ConsolidateMonthlyPayrollSort;""!=e.Trim()&&"None"!=e&&(this.sFilter+="TreeView"==e?" ORDER BY EMP.lft ":" ORDER BY EMP."+e);var t=[];t.push(o.a.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")),t.push(this.sFilter),t.push(0),t.push(o.a.SessionManager.RoleID),t.push(o.a.SessionManager.UserID),t.push(o.a.SessionManager.LanguageID);var s=o.a.empService.GetData(t,"spPAY_GetEmpMasterCCDetails");if(this.EmployeesList.Clear(),null!=s&&s.Tables.length>0&&s.Tables[0].length>0)for(var a=0;a<s.Tables[0].length;a++){var i=this.EmployeesList.NewRow();i.EmpSeqNo=s.Tables[0][a].EmpSeqNo,i.EmpCode=s.Tables[0][a].EmpCode,i.EmpName=s.Tables[0][a].EmpName,i.SNo=(a+1).toString(),i.Select=!1,this.EmployeesList.addRow(i)}Logger.InfoLog("PostPayrollViewModel::Exiting FilterEmployees()")}catch(l){Logger.ErrorLog("PostPayrollViewModel::EXCEPTION FilterEmployees()"+l.stack)}}},{key:"bgworker_DoWork",value:function(e,t){Logger.InfoLog("PostPayrollViewModel::Entering bgworker_DoWork()"),this.IsPosting?this.PostPayrollData():this.UnPostPayrollData(),Logger.InfoLog("PostPayrollViewModel::Exiting bgworker_DoWork()")}},{key:"UnPostPayrollData",value:function(){var e=this;Logger.InfoLog("PostPayrollViewModel::Entering UnPostPayrollData()"),this.InProgress="";var t=0,s=0;if(null!=this.EmployeesList.Table&&this.EmployeesList.Table.length>0){this.lstSelectedEmps=[];for(var a="",i=0;i<this.EmployeesList.Table.length;i++)Object(m.j)(this.EmployeesList.Table[i].Select)&&(a+=this.EmployeesList.Table[i].EmpSeqNo.toString()+",",this.lstSelectedEmps.push(i),s++);a.length>0&&s>0?function(){var i,l=(a=a.substr(0,a.length-1)).split(",");t=s,e.FailedCount=0,e.Failed="",e.ProgressVisibility=!0,e.ProgressValue=0,e.ProgressMax=t,e.ProgressMessage="Unposting Payroll, please wait ...",o.a.page.ShowDialog({progress:e.ProgressValue,total:e.ProgressMax,ProgressMessage:e.ProgressMessage},O.a,{HideHeader:!0,ShowCenter:!0,Title:"ProgressMessage"});for(var n=o.a.report.GetDataTable("PPVM01",a,o.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")),r=function(s){if(e.strResult="",null!=l[s]&&""!=l[s]){if(null!=(i=n.filter((function(e){return e.EmpSeqNo==l[s]})))&&i.length>0){var a=0,r=[];r.push(e.CostCenterID),r.push(parseInt(i[0].DocID)),r.push(1);var d=o.a.document.DeleteSelectedRows(r,a);e.strResult=d.Message,a=d.RetValue}else e.strResult="No Data exits to delete.",e.Failed+=e.EmployeesList.Table[e.lstSelectedEmps[s]].EmpCode.toString()+",",e.FailedCount++;e.EmployeesList.Table[e.lstSelectedEmps[s]].Result=e.strResult,e.EmployeesList.updateRow(e.EmployeesList.Table[e.lstSelectedEmps[s]])}e.ProgressValue=s+1,e.InProgress=s+1+" of "+t},d=0;d<l.length;d++)r(d);e.FailedCount>0&&e.Failed.length>1?(e.Failed=e.Failed.substr(0,e.Failed.length-1),e.DisplayMessage="Failed count : "+e.FailedCount+", Emp.Codes : ( "+e.Failed+" )"):null!=e.EmployeesList&&null!=e.EmployeesList.Table&&e.EmployeesList.Table.length>0&&e.EmployeesList.Table.filter((function(e){return 1==e.Select})).length>0&&(e.DisplayMessage="Unposted Successfully"),e.MessageVisibility=!0}():this.DisplayMessage="Select atleast one Employee."}else this.DisplayMessage="No Employees found to unpost payroll.";this.MessageVisibility=!0,Logger.InfoLog("PostPayrollViewModel::Exiting UnPostPayrollData()")}},{key:"bgworker_RunWorkerCompleted",value:function(e,t){Logger.InfoLog("PostPayrollViewModel::Entering worker_RunWorkerCompleted()"),this.ProgressVisibility=!1,this.IsPosting=!1,Logger.InfoLog("PostPayrollViewModel::Exiting worker_RunWorkerCompleted()")}},{key:"PostPayrollData",value:function(){Logger.InfoLog("PostPayrollViewModel::Entering PostPayrollData()"),this.InProgress="";var e=0,t=0;if(this.iEmpIndex=0,null!=this.EmployeesList.Table&&this.EmployeesList.Table.length>0){this.lstSelectedEmps=[];for(var s="",a=0;a<this.EmployeesList.Table.length;a++)Object(m.j)(this.EmployeesList.Table[a].Select)&&(s+=this.EmployeesList.Table[a].EmpSeqNo.toString()+",",this.lstSelectedEmps.push(a),t++);if(s.length>0&&t>0){if(s=s.substr(0,s.length-1),e=t,this.FailedCount=0,this.Failed="",this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=e,this.ProgressMessage="Payroll is processing, please wait ...",o.a.page.ShowDialog({progress:this.ProgressValue,total:this.ProgressMax,ProgressMessage:this.ProgressMessage},O.a,{HideHeader:!0,ShowCenter:!0,Title:"ProgressMessage"}),this.chkPostBasedOnDailyAttendance.IsChecked&&o.a.SessionManager.Preferences.ContainsKey("CaputureDimensionData")&&"True"==o.a.SessionManager.Preferences.CaputureDimensionData.toString()){var i=[];i.push(s),i.push(o.a.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")),i.push(o.a.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")),i.push(this.chkIncludeOTHours.IsChecked?1:0),i.push(h.e.IntTryParse(o.a.SessionManager.UserID)),i.push(o.a.SessionManager.LanguageID),this.dsDailyAttendanceData=o.a.empService.GetData(i,"spPAY_PostDailyAttendancetoPayroll")}if(this.oCMP=new E.a,this.oCMP.oParent=this,this.oCMP.sSelectedEmpSeqNos=s,this.oCMP.IsPostFullAttendance=!0,this.chkPostBasedOnDailyAttendance.IsChecked&&(this.oCMP.IsPostBasedOnDailyAttendance=!0),this.chkPostBasedOnAttDimWise.IsChecked&&(this.oCMP.IsPostBasedOnAttDimWise=!0),this.chkIncludeOTHours.IsChecked&&(this.oCMP.IncludeOTHours=!0),this.oCMP.PayrollMonth=o.a.SessionManager.PayrollMonth,this.oCMP.PayrollMonthStart=o.a.SessionManager.PayrollMonthStart,this.oCMP.PayrollMonthEnd=o.a.SessionManager.PayrollMonthEnd,this.oCMP.ProcessPayroll(),this.oCMP.IsCompleted){for(this.ProgressValue=0,this.ProgressMax=e,this.ProgressMessage="Saving data, please wait ...",this.iEmpIndex=0;this.iEmpIndex<this.oCMP.arrLstOthMPFields.length;this.iEmpIndex++){if(null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID&&null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID&&""!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID.toString()&&parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID)>0){var l=o.a.common.GetDataTable("PAY088",this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].INVDocDetailsID.toString()+",54,'"+o.a.SessionManager.UserName+"',40054,"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowLevel.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].CreatedDate.toString()+","+o.a.SessionManager.UserID+","+o.a.SessionManager.RoleID);null!=l&&l.length>0&&(h.e.IsEmpty(l[0].CanApprove)||"TRUE"!=l[0].CanApprove.toString().toUpperCase())&&(369!=parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID)||o.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Posted Docs")?441!=parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID)||o.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Approved Docs")||(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage="Can't Edit Approved Document"):this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage="Can't Edit Posted Document")}if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.length>0){if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.endsWith("NumFields"))return this.DisplayMessage=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.Replace("NumFields",""),void(this.MessageVisibility=!0);this.strResult=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage,this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++,this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult,this.EmployeesList.updateRow(this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]])}else this.strResult="",this.CalculateAccruals(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo),this.SaveVoucher(),this.ProgressValue=this.iEmpIndex+1,this.InProgress=this.iEmpIndex+1+" of "+e}this.MessageVisibility=!0,this.FailedCount>0&&this.Failed.length>1?(this.Failed=this.Failed.substr(0,this.Failed.length-1),this.DisplayMessage="Failed count : "+this.FailedCount+", Emp.Codes : ( "+this.Failed+" )"):null!=this.EmployeesList&&null!=this.EmployeesList.Table&&this.EmployeesList.Table.length>0&&this.EmployeesList.Table.filter((function(e){return 1==e.Select})).length>0&&(this.DisplayMessage="Posted Successfully",this.SelectAll=!1,"True"==o.a.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll?(this.chkPostBasedOnDailyAttendance.IsChecked=!0,this.chkIncludeOTHours.IsChecked=!0):(this.chkIncludeOTHours.IsChecked=!1,this.chkPostBasedOnDailyAttendance.IsChecked=!1))}}else this.DisplayMessage="Select atleast one Employee."}else this.DisplayMessage="No Employees found to post payroll.";this.MessageVisibility=!0,Logger.InfoLog("PostPayrollViewModel::Exiting PostPayrollData()")}},{key:"CalculateAccruals",value:function(e){var t=this.oCMP.arrLstOthMPFields[0].dsAllEmpsData.Tables[2];if((t=t.filter((function(t){return t.EmpSeqNo==e}))).length>0&&new Date(t[0].cEffectFrom).getFullYear()==o.a.SessionManager.PayrollMonth.getFullYear()&&new Date(t[0].cEffectFrom).iMonth()==o.a.SessionManager.PayrollMonth.iMonth()&&this.oCMP.lstAccrAccumulateSNos.length>0){for(var s="",a=0,i=0,l=0,n=0,r=0,d=0,h=0,p=0,m=0,c=-1,C=0;C<this.oCMP.lstAccrAccumulateSNos.length;C++)s.length>0&&(s+=","),s+="ISNULL(dcCalcNum"+this.oCMP.lstAccrAccumulateSNos[C]+",0) as dcCalcNum"+this.oCMP.lstAccrAccumulateSNos[C]+",ISNULL(dcCalcNumFC"+this.oCMP.lstAccrAccumulateSNos[C]+",0) as dcCalcNumFC"+this.oCMP.lstAccrAccumulateSNos[C];var u=o.a.empService.GetQueryData(e,"PostCalculateAccural",JSON.stringify(s),o.a.SessionManager.PayrollMonth.ToString("dd MMM yyyy"),"");if(null!=u&&u.length>0)for(var y=0;y<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;y++)if(i=0,l=0,this.oCMP.arrLstCPFields[this.iEmpIndex][0][y].IsAccrualType&&"Accruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][y].Behaviour){c=this.oCMP.arrLstCPFields[this.iEmpIndex][0][y].SNo,a=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][y].dActual);for(var g=0;g<u.length;g++)r=parseFloat(u[g].TotalDays),n=parseFloat(u[g].DaysAttended)+parseFloat(u[g].PaidLeaves)+parseFloat(u[g].LOPDays),d=parseFloat(u[g]["dcCalcNum"+c]),h=parseFloat(u[g]["dcCalcNumFC"+c]),p=parseFloat((n/r*a).ToString(o.a.SessionManager.sPayrollDecimals)),m=parseFloat((p-d).ToString(o.a.SessionManager.sPayrollDecimals)),i+=parseFloat(m.ToString(o.a.SessionManager.sPayrollDecimals)),l+=h;this.oCMP.arrLstCPFields[this.iEmpIndex][0][y].dAdjusted=(i-l).ToString(o.a.SessionManager.sPayrollDecimals)}}}},{key:"ValidatePosting",value:function(){try{return Logger.InfoLog("PostPayrollViewModel::Entering IsValidated()"),null!=o.a.SessionManager.Preferences.PayrollProduct&&""!=o.a.SessionManager.Preferences.PayrollProduct&&(this.DefProdID=parseInt(o.a.SessionManager.Preferences.PayrollProduct)),0==this.DefProdID?(this.strResult+="Select any Default Payroll Product at Global Preferences",this.MessageVisibility=!0,!1):this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays<0?(this.strResult+="Days mismatch : Month days and Total days.",this.MessageVisibility=!0,!1):this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays<this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP?(this.strResult+="Employee Should have atleast "+this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP+" LOP Days",this.MessageVisibility=!0,!1):this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary<0&&("False"==o.a.SessionManager.Preferences.CreateLoanIfNetSalLessThanZero||0==parseInt(o.a.SessionManager.Preferences.CreateLoanType))?(this.strResult+="Net Amount should be greater than or equal to zero.",this.MessageVisibility=!0,!1):(Logger.InfoLog("PostPayrollViewModel::Exiting IsValidated()"),!0)}catch(e){return Logger.ErrorLog("PostPayrollViewModel::EXCEPTION IsValidated()"+e.stack),!1}}},{key:"SaveVoucher",value:function(){try{if(Logger.InfoLog("PostPayrollViewModel::Entering btnPost_Click()"),this.ValidatePosting()){var e=0,t=[];t.push(this.CostCenterID),t.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].DocID),t.push(o.a.SessionManager.PayrollMonth.ToString("MMM'/'yyyy")+"-"),t.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].DocNo),t.push(Date.Today().ToString("dd/MMM/yyyy")),t.push(o.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")),t.push(""),t.push(this.GetDocumentXML()),t.push(""),t.push(""),t.push(""),t.push(this.GetActivityXML()),t.push("false"),o.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==o.a.SessionManager.Preferences.EnableLocationWise.toString()?t.push(o.a.SessionManager.LocationID>0?o.a.SessionManager.LocationID:1):t.push(0),o.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==o.a.SessionManager.Preferences.EnableDivisionWise.toString()?t.push(o.a.SessionManager.DivisionID>0?o.a.SessionManager.DivisionID:1):t.push(0),t.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].WID),t.push(o.a.SessionManager.RoleID),t.push(""),t.push(0),t.push(0),t.push(o.a.SessionManager.CompanyGUID),t.push(o.a.SessionManager.UserName),t.push(o.a.SessionManager.UserID),t.push(o.a.SessionManager.LanguageID),t.push(o.a.SessionManager.IsOffline);var s,a=o.a.document.SetTempInvDocumentPostPayroll(t);e=a.obj;var i=a;s=null!=i&&i.Tables.length>0&&i.Tables[i.Tables.length-1].length>0&&i.Tables[i.Tables.length-1].some((function(e){return e.hasOwnProperty("ErrorMessage")}))?i.Tables[i.Tables.length-1][0].ErrorMessage.toString():"Problem in processing your request,Please contact administrator.",e>0?null!=i&&i.Tables.length>0&&i.Tables[i.Tables.length-1].length>0&&i.Tables[i.Tables.length-1].some((function(e){return e.hasOwnProperty("VoucherNo")}))&&i.Tables[i.Tables.length-1][0].VoucherNo.toString():null!=i&&i.Tables.length>0&&i.Tables[i.Tables.length-1].length>0&&i.Tables[i.Tables.length-1].some((function(e){return e.hasOwnProperty("ServerMessage")}))&&(this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++,e="-407"==i.Tables[i.Tables.length-1][0].ServerMessage.toString()?-407:-12345),this.strResult+=s,this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult,this.EmployeesList.updateRow(this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]])}else this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++;Logger.InfoLog("PostPayrollViewModel::Exiting btnPost_Click()")}catch(l){this.strResult+=l.message,Logger.ErrorLog("PostPayrollViewModel::EXCEPTION btnPost_Click()",l)}this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult,this.EmployeesList.updateRow(this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]])}},{key:"GetDocumentXML",value:function(){var e,t=this,s="",a="",i="",l="",n="",r="",d=[],p=" dcAlpha1='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].BasicMonthly+"',dcAlpha3='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary+"',dcAlpha4='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalDays+"',dcAlpha5='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].DaysAttended+"',dcAlpha6='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalLeaves+"',dcAlpha7='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].WeeklyOffs+"',dcAlpha8='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].Holidays+"',dcAlpha9='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays+"',dcAlpha10='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].UnpaidDays+"', dcAlpha11='"+(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarnings+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTAmount)+"',dcAlpha12='"+(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDeductions+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totLoans)+"',dcAlpha13='0'";o.a.SessionManager.Preferences.ContainsKey("ShowPaymentModeselectionWhilePayrollProcessing")&&"True"==o.a.SessionManager.Preferences.ShowPaymentModeselectionWhilePayrollProcessing&&"Default"!=this.objEmpFilter.PaymentModes.SelectedValue?(p+=",dcAlpha14='"+this.objEmpFilter.PaymentModes.SelectedValue.toString()+"'",p+="Bank Transfer"==this.objEmpFilter.PaymentModes.SelectedValue?",dcAlpha15='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank.toString()+"',dcAlpha16='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].BankAccNo.toString()+"'":",dcAlpha15='',dcAlpha16=''"):(p+=",dcAlpha14='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()+"'","Bank Transfer"==h.e.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode)?p+=",dcAlpha15='"+h.e.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank)+"',dcAlpha16='"+h.e.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].BankAccNo)+"'":p+=",dcAlpha15='',dcAlpha16=''"),p+=",dcAlpha17='"+o.a.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")+"',dcAlpha18='"+o.a.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")+"', dcAlpha19='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTHours+"',dcAlpha20='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTAmount+"', dcAlpha21='',dcAlpha22=''",p+=",dcAlpha23='' ",p+=",dcAlpha24='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].PaidLeaves+"' ",p+=",dcAlpha25='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totActEarnings+"' ",p+=",dcAlpha26='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarArrears+"' ",p+=",dcAlpha27='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarAdjustments+"' ",p+=",dcAlpha28='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totActDeductions+"' ",p+=",dcAlpha29='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedArrears+"' ",p+=",dcAlpha30='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedAdjustments+"' ",p+=",dcAlpha31='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totLoans+"' ",o.a.SessionManager.Preferences.ContainsKey("ShowPaymentModeselectionWhilePayrollProcessing")&&"True"==o.a.SessionManager.Preferences.ShowPaymentModeselectionWhilePayrollProcessing&&"Default"!=this.objEmpFilter.PaymentModes.SelectedValue?p+="Bank Transfer"==this.objEmpFilter.PaymentModes.SelectedValue?",dcAlpha34='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].IBANNo.toString()+"'":",dcAlpha34=''":"Bank Transfer"==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()?p+=",dcAlpha34='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].IBANNo.toString()+"'":p+=",dcAlpha34=''",i+='<Alpha Query="',i+=p,(n+=" ").length>0&&(i+=","+n),i+='" ></Alpha>',n="",l+='<CostCenters Query="',n+=" dcCCNID51="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+",",n+=" dcCCNID53="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].GradeID+",",""==h.e.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank)||"0"==h.e.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank)||"Cash"==h.e.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode)?n+=" dcCCNID68=1,":n+=" dcCCNID68="+h.e.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank)+",",d.push("dcCCNID51"),d.push("dcCCNID53"),d.push("dcCCNID68");var m="",c="";if(null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim.length>0)for(var C=0;C<Object.keys(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim[0]).length;C++)m=Object.keys(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim[0])[C],c=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim[0][m],m.Contains("CCNID")&&"CCNID51"!=m&&"CCNID53"!=m&&"CCNID68"!=m&&(n+=" dc"+m+"="+c+",",d.Contains("dc"+m)||d.push("dc"+m));if(n.length>0&&(l+=n),l+='" ></CostCenters>',a+='" ProductID="'+this.DefProdID+'" Quantity="0',a+='" Unit="1" UOMConversion="1" UOMConvertedQty="0',a+='" Rate="0" Gross="0" IsQtyIgnored="1" AverageRate="0',a+='" StockValue="0" StockValueFC="0" RefNO="',a+='" BillDate="'+o.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),a+='" CurrencyID="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].CurrencyID+'" ExchangeRate="1',a+='" DebitAccount="'+this.sDrAccount+'" CreditAccount="'+this.sCrAccount,a+='" CommonNarration="'+h.e.EncodeXML("POSTED FROM POST PAYROLL"),this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0){if(s+="\x11",s+="<Row>",s+="<AccountsXML></AccountsXML>",s+='<Transactions DocSeqNo="1" VoucherType="11',s+='" LinkedInvDocDetailsID="0" LinkedFieldName="',s+='" LineNarration="Earning',r="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(null!=(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.filter((function(e){return e.EmpSeqNo==t.oCMP.arrLstOthMPFields[t.iEmpIndex].EmpSeqNo&&11==e.VoucherType})))&&e.length>0&&(r=e[0].InvDocDetailsID.toString())),s+=r.length>0?'" DocDetailsID="'+r:'" DocDetailsID="',s+=a.toString()+'" ></Transactions>',n="",s+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0)for(var u=0;u<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;u++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][u].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][u].SNo.toString()&&(n+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][u].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][u].dActual.Replace(",","")+",",n+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][u].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][u].dEarned.Replace(",","")+",",n+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][u].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][u].dArrear.Replace(",","")+",",n+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][u].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][u].dAdjusted.Replace(",","")+",");if(this.oCMP.arrLstCPFields[this.iEmpIndex][1].length>0)for(var y=0;y<this.oCMP.arrLstCPFields[this.iEmpIndex][1].length;y++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][1][y].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][1][y].SNo.toString()&&(n+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][y].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][1][y].dActual.Replace(",","")+",",n+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][y].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][1][y].dEarned.Replace(",","")+",");n.length>0&&(s+=n),s+='" ></Numeric>',s+=i.toString(),s+=l.toString(),s+="<EXTRAXML></EXTRAXML>",s+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][2].length>0){if(s+="\x11",s+="<Row>",s+="<AccountsXML></AccountsXML>",s+='<Transactions DocSeqNo="2" VoucherType="12',s+='" LinkedInvDocDetailsID="0" LinkedFieldName="',s+='" LineNarration="Deduction',r="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(null!=(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter((function(e){return e.EmpSeqNo==t.oCMP.arrLstOthMPFields[t.iEmpIndex].EmpSeqNo&&12==e.VoucherType})))&&e.length>0&&(r=e[0].InvDocDetailsID.toString())),s+=r.length>0?'" DocDetailsID="'+r:'" DocDetailsID="',s+=a.toString()+'" ></Transactions>',n="",s+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][2].length>0)for(var g=0;g<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;g++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][g].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][g].SNo.toString()&&(n+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][g].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][g].dActual.Replace(",","")+",",n+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][g].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][g].dEarned.Replace(",","")+",",n+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][g].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][g].dArrear.Replace(",","")+",",n+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][g].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][g].dAdjusted.Replace(",","")+",");n.length>0&&(s+=n),s+='" ></Numeric>',s+=i.toString(),s+=l.toString(),s+="<EXTRAXML></EXTRAXML>",s+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].iExtLoansCnt>0){if(s+="\x11",s+="<Row>",s+="<AccountsXML></AccountsXML>",s+='<Transactions DocSeqNo="3" VoucherType="13',s+='" LinkedInvDocDetailsID="0" LinkedFieldName="',s+='" LineNarration="Loan',r="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(null!=(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter((function(e){return e.EmpSeqNo==t.oCMP.arrLstOthMPFields[t.iEmpIndex].EmpSeqNo&&13==e.VoucherType})))&&e.length>0&&(r=e[0].InvDocDetailsID.toString())),s+=r.length>0?'" DocDetailsID="'+r:'" DocDetailsID="',s+=a.toString()+'" ></Transactions>',n="",s+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0)for(var M=0;M<this.oCMP.arrLstCPFields[this.iEmpIndex][4].length;M++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][M].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][M].SNo.toString()&&1==this.oCMP.arrLstCPFields[this.iEmpIndex][4][M].IsVisible&&(n+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][M].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][M].LoanActInstAmt.Replace(",","")+",",n+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][M].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][M].LoanInstAmt.Replace(",","")+",",n+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][M].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][M].LoanBalAmt.Replace(",","")+",",n+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][M].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][M].LoanPayStatus+",");n.length>0&&(s+=n),s+='" ></Numeric>',s+=i.toString(),s+=l.toString(),s+="<EXTRAXML></EXTRAXML>",s+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][5].length>0){if(s+="\x11",s+="<Row>",s+="<AccountsXML></AccountsXML>",s+='<Transactions DocSeqNo="4" VoucherType="14',s+='" LinkedInvDocDetailsID="0" LinkedFieldName="',s+='" LineNarration="Leave',r="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(null!=(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter((function(e){return e.EmpSeqNo==t.oCMP.arrLstOthMPFields[t.iEmpIndex].EmpSeqNo&&14==e.VoucherType})))&&e.length>0&&(r=e[0].InvDocDetailsID.toString())),s+=r.length>0?'" DocDetailsID="'+r:'" DocDetailsID="',s+=a.toString()+'" ></Transactions>',n="",s+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][5].length>0)for(var P=0;P<this.oCMP.arrLstCPFields[this.iEmpIndex][5].length;P++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][5][P].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][5][P].SNo.toString()&&(n+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][P].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][P].LeaveTotOPBal.Replace(",","")+",",n+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][P].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][P].LeaveTaken.Replace(",","")+",",n+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][P].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][P].LeaveMonOPBal.Replace(",","")+",",n+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][P].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][P].LeaveNetBal.Replace(",","")+",");n.length>0&&(s+=n),s+='" ></Numeric>',s+=i.toString(),s+=l.toString(),s+="<EXTRAXML></EXTRAXML>",s+="</Row>"}return s.toString()}},{key:"GetActivityXML",value:function(){var e,t=this,s="",a="",i="";if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0)for(var l=0;l<this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length;l++)s+="~"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[l].InvDocDetailsID.toString();var n="";if(n+=null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0?s.length>0?'<XML DetailIds="'+s+'" AppRejDate="'+(new Date).ToString("dd/MMM/yyyy")+'" >':'<XML AppRejDate="'+(new Date).ToString("dd/MMM/yyyy")+'" >':s.length>0?'<XML DetailIds="'+s+'" >':"<XML>",this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].iExtLoansCnt>0&&function(){var s,l,r,d,h,p,m="0";if(a=i="",null!=t.oCMP.arrLstOthMPFields[t.iEmpIndex].drcLoanRepay&&t.oCMP.arrLstOthMPFields[t.iEmpIndex].drcLoanRepay.length>0&&(m=t.oCMP.arrLstOthMPFields[t.iEmpIndex].drcLoanRepay[0].DocID.toString()),n+='<LoanRepaymentXML DocID="'+m+'" DocDetIDs="" WorkFlowID="0" >',n+="<DOCXML>",t.oCMP.arrLstCPFields[t.iEmpIndex][4].length>0){var c=0;null!=o.a.SessionManager.dtDocDefAccs&&(null!=(e=o.a.SessionManager.dtDocDefAccs.filter((function(e){return 40057==e.CostCenterID&&"CreditAccount"==e.SysColumnName})))&&e.length>0&&null!=e[0].UserDefaultValue&&""!=e[0].UserDefaultValue.toString().Trim()&&(a=e[0].UserDefaultValue.toString()),null!=(e=o.a.SessionManager.dtDocDefAccs.filter((function(e){return 40057==e.CostCenterID&&"DebitAccount"==e.SysColumnName})))&&e.length>0&&null!=e[0].UserDefaultValue&&""!=e[0].UserDefaultValue.toString().Trim()&&(i=e[0].UserDefaultValue.toString()));for(var C=0;C<t.oCMP.arrLstCPFields[t.iEmpIndex][4].length;C++)null!=t.oCMP.arrLstCPFields[t.iEmpIndex][4][C].SNo&&""!=t.oCMP.arrLstCPFields[t.iEmpIndex][4][C].SNo.toString()&&1==t.oCMP.arrLstCPFields[t.iEmpIndex][4][C].IsVisible&&null!=t.oCMP.arrLstCPFields[t.iEmpIndex][4][C].LoanInstAmt&&""!=t.oCMP.arrLstCPFields[t.iEmpIndex][4][C].LoanInstAmt.toString()&&function(){s=t.oCMP.arrLstCPFields[t.iEmpIndex][4][C].LoanDocNo,r=t.oCMP.arrLstCPFields[t.iEmpIndex][4][C].LoanActInstNo,h=3==parseInt(t.oCMP.arrLstCPFields[t.iEmpIndex][4][C].LoanPayStatus)?t.oCMP.arrLstCPFields[t.iEmpIndex][4][C].LoanActInstAmt.Replace(",",""):t.oCMP.arrLstCPFields[t.iEmpIndex][4][C].LoanInstAmt.Replace(",","");var e=parseInt(r);t.oCMP.arrLstOthMPFields[t.iEmpIndex].IsAlreadyProcessed?null!=(p=t.oCMP.arrLstOthMPFields[t.iEmpIndex].dsAllEmpsData.Tables[11].filter((function(e){return e.EmpSeqNo==t.oCMP.arrLstOthMPFields[t.iEmpIndex].EmpSeqNo&&e.RefNo==s&&new Date(e.dcAlpha5)==o.a.SessionManager.PayrollMonth})))&&p.length>0&&(e=parseInt(p[0].dcNum1)):(o.a.SessionManager.Preferences.ContainsKey("ShowLoanBalRespDedMonthWhilePayProc")&&"True"==o.a.SessionManager.Preferences.ShowLoanBalRespDedMonthWhilePayProc?(p=t.oCMP.arrLstOthMPFields[t.iEmpIndex].dsAllEmpsData.Tables[10].filter((function(a){return a.EmpSeqNo==t.oCMP.arrLstOthMPFields[t.iEmpIndex].EmpSeqNo&&a.RefNo==s&&a.InstallmentNo==e}))).SortBy([{name:"InstallmentNo",parser:parseInt}]):(p=t.oCMP.arrLstOthMPFields[t.iEmpIndex].dsAllEmpsData.Tables[10].filter((function(a){return a.EmpSeqNo==t.oCMP.arrLstOthMPFields[t.iEmpIndex].EmpSeqNo&&a.DocNo==s&&a.InstBalance>0&&a.InstallmentNo<e}))).SortBy([{name:"InstallmentNo",parser:parseInt}]),null!=p&&p.length>0&&(e=parseInt(p[0].InstallmentNo)));var m=parseFloat(h),u=0,y=0;do{c++,(p=t.oCMP.arrLstOthMPFields[t.iEmpIndex].dsAllEmpsData.Tables[10].filter((function(a){return a.EmpSeqNo==t.oCMP.arrLstOthMPFields[t.iEmpIndex].EmpSeqNo&&a.DocNo==s&&a.InstallmentNo==e}))).length>0?(l=p[0].InvDocDetailsID.toString(),d=p[0].InstallmentAmt.toString().Replace(",",""),u=m>parseFloat(p[0].InstBalance)?parseFloat(p[0].InstBalance):m,n+="<RowHead/>",n+="<Row>",n+="<AccountsXML></AccountsXML>",n+='<Transactions DocSeqNo="'+c+'"  DocDetailsID="0" LinkedInvDocDetailsID="'+l+'" LinkedFieldName="dcNum3" LineNarration="',n+='" ProductID="'+t.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1',n+='" Rate="0" Gross="0" RefNO="'+s+'" LinkedFieldValue="'+u+'" IsQtyIgnored="1" AverageRate="0',n+='" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+i+'"  CreditAccount="'+a+'"  ></Transaction>',n+='<Numeric Query="dcNum1='+e+", dcCalcNum1="+e+", dcNum2="+d.Replace(",","")+", dcCalcNum2="+d.Replace(",","")+", dcNum3="+u.toString().Replace(",","")+", dcCalcNum3="+u.toString().Replace(",","")+', " ></Numeric>',n+="<Alpha Query=\"dcAlpha1=N'"+t.oCMP.arrLstCPFields[t.iEmpIndex][4][C].LoanApprovedAmt+"',dcAlpha2=N'"+(parseFloat(t.oCMP.arrLstCPFields[t.iEmpIndex][4][C].LoanBalAmt)-y)+"', dcAlpha3=N'"+h+"', dcAlpha4=N'"+new Date(p[0].DeductionMonth).ToString("dd/MMM/yyyy")+"', dcAlpha5=N'"+o.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"',dcAlpha6=N'1',dcAlpha7=N'"+t.oCMP.arrLstCPFields[t.iEmpIndex][4][C].LoanPayStatus+"', \" ></Alpha>",n+='<CostCenters Query="dcCCNID51='+t.oCMP.arrLstOthMPFields[t.iEmpIndex].EmpSeqNo+", dcCCNID52="+t.oCMP.arrLstCPFields[t.iEmpIndex][4][C].ComponentID+', " ></CostCenters>',n+="<EXTRAXML></EXTRAXML>",n+="</Row>",y+=u,m-=u,e++):m=0}while(m>0)}()}n+="</DOCXML>",n+="<BillXML></BillXML></LoanRepaymentXML>"}(),this.chkPostBasedOnDailyAttendance.IsChecked&&o.a.SessionManager.Preferences.ContainsKey("CaputureDimensionData")&&"True"==o.a.SessionManager.Preferences.CaputureDimensionData.toString()){var r,d="",p="",m="",c="",C="";if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData.length>0){m=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData[0].DocID.toString();for(var u=0;u<this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData.length;u++)c+="~"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData[u].InvDocDetailsID.toString()}r=C="",null!=o.a.SessionManager.dtDocDefAccs&&(null!=(e=o.a.SessionManager.dtDocDefAccs.filter((function(e){return 40079==e.CostCenterID&&"CreditAccount"==e.SysColumnName})))&&e.length>0&&null!=e[0].UserDefaultValue&&""!=e[0].UserDefaultValue.toString().Trim()&&(r=e[0].UserDefaultValue.toString()),null!=(e=o.a.SessionManager.dtDocDefAccs.filter((function(e){return 40079==e.CostCenterID&&"DebitAccount"==e.SysColumnName})))&&e.length>0&&null!=e[0].UserDefaultValue&&""!=e[0].UserDefaultValue.toString().Trim()&&(C=e[0].UserDefaultValue.toString())),n+='<AttendanceDimensionwiseXML DocID="'+m+'" DocDetIDs="'+c+'" WorkFlowID="0" >',n+="<DOCXML>";var y=null;if(null!=this.dsDailyAttendanceData&&this.dsDailyAttendanceData.Tables.length>0&&(y=this.dsDailyAttendanceData.Tables[0].filter((function(e){return e.EMPNODE==t.oCMP.arrLstOthMPFields[t.iEmpIndex].EmpSeqNo}))),null!=y&&y.length>0){var g,M,P,D,E=[],I=[];I.push("EMPNODE");for(var S=0;S<this.dsDailyAttendanceData.Tables[3].length;S++)I.push(this.dsDailyAttendanceData.Tables[3][S].Data.toString());I.push("OT1"),I.push("OT2"),I.push("OT3"),I.push("OT4"),I.push("OT5"),I.push("DAYSATTENDED"),I.push("ABSENTDAYS"),I.push("Leaves"),I.push("TOTALOTAMOUNT");for(var T=0;T<y.length;T++)if(null!=(M=this.ApplyFilter(E,y[T]))&&M.length>0)for(var L=0;L<I.length;L++)I[L].startsWith("OT")&&(M[0][I[L]]=h.e.SUMHoursAndMinutes(M[0][I[L]].toString(),y[T][I[L]].toString()));else{(g={}).EMPNODE=y[T].EMPNODE;for(var b=1;b<I.length;b++)g[b]=y[T][I[b]];if(null!=(P=this.ApplyFilter(this.dsDailyAttendanceData.Tables[1],y[T]))&&P.length>0){if(D=this.ApplyFilter(this.dsDailyAttendanceData.Tables[2],y[T]),g.ABSENTDAYS=null!=D&&D.length>0?D[0].ABSENTDAYS:"0",null==this.dsDailyAttendanceData.Tables[4]||this.dsDailyAttendanceData.Columns[4].Contains("NODATA"))g.Leaves="0";else{var f=this.ApplyFilter(this.dsDailyAttendanceData.Tables[4],y[T]),F=0;if(null!=f&&f.Table.length>0){var N=void 0,A=void 0;F=0;for(var v=0;v<f.length;v++)N=new Date(f[v].FromDate),A=new Date(f[v].ToDate),N>=o.a.SessionManager.PayrollMonthStart?A<=o.a.SessionManager.PayrollMonthEnd?F+=parseFloat(f[v].Leaves):N<=o.a.SessionManager.PayrollMonthEnd&&(F+=this.oCMP.GetNoOfDays(N,o.a.SessionManager.PayrollMonthEnd,parseInt(f[v].ComponentID))):A<=o.a.SessionManager.PayrollMonthEnd?A>=o.a.SessionManager.PayrollMonthStart&&(F+=this.oCMP.GetNoOfDays(o.a.SessionManager.PayrollMonthStart,A,parseInt(f[v].ComponentID))):F+=this.oCMP.GetNoOfDays(o.a.SessionManager.PayrollMonthStart,o.a.SessionManager.PayrollMonthEnd,parseInt(f[v].ComponentID))}g.Leaves=F>0?F:"0"}g.DAYSATTENDED=parseFloat(P[0].DAYSATTENDED)-parseFloat(g.ABSENTDAYS),g.TOTALOTAMOUNT=P[0].TOTALOTAMOUNT}E.push(g)}for(var O="0",x=0;x<E.length;x++){if(O="0",null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay.length>x&&(O=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay[x].InvDocDetailsID.toString()),d="",n+="<RowHead/>",n+="<Row>",n+="<AccountsXML></AccountsXML>",n+='<Transactions DocSeqNo="'+x+'"  DocDetailsID="'+O+'" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="',n+='" ProductID="'+this.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1',n+='" Rate="0" Gross="0" RefNO="0" LinkedFieldValue="0" IsQtyIgnored="1" AverageRate="0',n+='" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+C+'"  CreditAccount="'+r+'"  ></Transaction>',n+='<Numeric Query="dcNum1='+parseFloat(E[x].TOTALOTAMOUNT)+", dcCalcNum1="+parseFloat(E[x].TOTALOTAMOUNT)+", ",n+="dcNum5="+parseFloat(E[x].OT1)+", dcCalcNum5="+parseFloat(E[x].OT1)+", ",n+="dcNum7="+parseFloat(E[x].OT2)+", dcCalcNum7="+parseFloat(E[x].OT2)+", ",n+="dcNum9="+parseFloat(E[x].OT3)+", dcCalcNum9="+parseFloat(E[x].OT3)+", ",n+="dcNum11="+parseFloat(E[x].OT4)+", dcCalcNum11="+parseFloat(E[x].OT4)+", ",n+="dcNum13="+parseFloat(E[x].OT5)+", dcCalcNum13="+parseFloat(E[x].OT5)+", ",n+='" ></Num>',n+="<Alpha Query=\"dcAlpha1=N'"+o.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"',dcAlpha2=N'"+parseFloat(E[x].DAYSATTENDED)+"', dcAlpha3=N'"+parseFloat(E[x].ABSENTDAYS)+"', dcAlpha4=N'"+parseFloat(E[x].Leaves)+"', \" ></Alpha>",n+='<CostCenters Query="',d+=" dcCCNID51="+parseInt(E[x].EMPNODE)+",",this.dsDailyAttendanceData.Tables[3].length>0){p="";for(var R=0;R<this.dsDailyAttendanceData.Tables[3].length;R++)d+=" "+(p=this.dsDailyAttendanceData.Tables[3][R].Data.toString())+"="+parseInt(E[x][p])+","}d.length>0&&(n+=d),n+='" ></CostCenters>',n+="<EXTRAXML></EXTRAXML>",n+="</Row>"}}n+="</DOCXML>",n+="</AttendanceDimensionwiseXML>"}return this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanCrNetSalLessZero.length>0&&(n+='<DelLoanXML DocID="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanCrNetSalLessZero[0].DocID.toString()+'" > </DelLoanXML>'),a=i="",this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary<0&&"True"==o.a.SessionManager.Preferences.CreateLoanIfNetSalLessThanZero&&parseInt(o.a.SessionManager.Preferences.CreateLoanType)>0&&(null!=o.a.SessionManager.dtDocDefAccs&&(null!=(e=o.a.SessionManager.dtDocDefAccs.filter((function(e){return 40056==e.CostCenterID&&"CreditAccount"==e.SysColumnName})))&&e.length>0&&null!=e[0].UserDefaultValue&&""!=e[0].UserDefaultValue.toString().Trim()&&(a=e[0].UserDefaultValue.toString()),null!=(e=o.a.SessionManager.dtDocDefAccs.filter((function(e){return 40056==e.CostCenterID&&"DebitAccount"==e.SysColumnName})))&&e.length>0&&null!=e[0].UserDefaultValue&&""!=e[0].UserDefaultValue.toString().Trim()&&(i=e[0].UserDefaultValue.toString())),n+='<CreateLoanXML DocID="" DocDetIDs="" WorkFlowID="0" >',n+="<DOCXML>",n+="<RowHead/>",n+="<Row>",n+="<AccountsXML></AccountsXML>",n+='<Transactions DocSeqNo="1"  DocDetailsID="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="" CommonNarration="LOAN CREATED FROM MONTHLY PAYROLL WHEN NET SALARY LESS THAN 0',n+='" Rate="0" Gross="0" RefNO="0" IsQtyIgnored="1" AverageRate="0',n+='" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+i+'"  CreditAccount="'+a+'"  ></Transaction>',n+='<Numeric Query="dcNum1=1, dcCalcNum1=1, dcNum2='+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+", dcCalcNum2="+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+', " ></Numeric>',n+="<Alpha Query=\"dcAlpha6=N'"+o.a.SessionManager.PayrollMonth.AddMonths(1).ToString("dd/MMM/yyyy")+"',dcAlpha1=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"', dcAlpha2=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"', dcAlpha4=N'1', dcAlpha3=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"',dcAlpha5=N'"+o.a.SessionManager.PayrollMonth.AddMonths(1).ToString("dd/MMM/yyyy")+"',dcAlpha7=N'"+o.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"', \" ></Alpha>",n+='<CostCenters Query="dcCCNID51='+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+", dcCCNID52="+o.a.SessionManager.Preferences.CreateLoanType+', " ></CostCenters>',n+="<EXTRAXML></EXTRAXML>",n+="</Row>",n+="</DOCXML>",n+="<BillXML></BillXML></CreateLoanXML>"),(n+="</XML>").toString()}},{key:"ApplyFilter",value:function(e,t){for(var s=this,a=e.filter((function(e){return e.EMPNODE==s.oCMP.arrLstOthMPFields[s.iEmpIndex].EmpSeqNo})),i=function(e){a=a.filter((function(a){return a.this.dsDailyAttendanceData.Tables[3][e].Data.toString()==t[s.dsDailyAttendanceData.Tables[3][e].Data.toString()]}))},o=0;o<this.dsDailyAttendanceData.Tables[3].length;o++)i(o);return a}},{key:"SelectAll",get:function(){return this._SelectAll},set:function(e){e!=this._SelectAll&&(this._SelectAll=e,this.SelectUnselectAll(e))}}]),a}(C.b),R=s("c42x"),w=s("n56n"),V=s("Huqd"),k=s("CUWK"),_=s("MCKn"),G=function(e){_inherits(s,e);var t=_createSuper(s);function s(e){var a;_classCallCheck(this,s),(a=t.call(this)).ProgressVisibility=!1,a.ProgressValue=0,a.ProgressMax=0,a.DialogResult=!1,a.PostVisiblility=!0,a._SelectAll=!1,a.ChkBtnPostOnlyFirstAndLastTrans=new v.a,a.PostOnlyFirstInLastOut=!1,a.PostOnlyFirstInLastOutVisibility=!0,a.btnCancelFlag=!1,a.SelectUnCheck=0,a.dsEmps=null,a.sEmpSeqNosOnGrid="",a.sFilter="",a.iPostDocType=0,a.iEmpIndex=0,a.strResult="",a.Failed="",a.FailedCount=0,a.DefProdID=0;try{a.DisplayName=e,a.Title=e,a.DisplayMessage="",a.btnCancelFlag=!1,a.LoadGrid(),a.btnFilter_Click()}catch(i){Logger.ErrorLog("PostAttTimeSheetToDailyAttViewModel::EXCEPTION PostAttTimeSheetToDailyAttViewModel()",i)}return a}return _createClass(s,[{key:"LoadGrid",value:function(){this.dgv=new c.a,this.dgv.Height=0,this.dgv.SelectAll.Visible=!0,this.dgv.CanUserDeleteRows=!0,this.dgv.Table=[],this.dgv.TableColumns.push("Select"),this.dgv.TableColumns.push("SNo"),this.dgv.TableColumns.push("EmpSeqNo"),this.dgv.TableColumns.push("EmpCode"),this.dgv.TableColumns.push("EmpName"),this.dgv.TableColumns.push("VoucherNo"),this.dgv.TableColumns.push("CheckInDate"),this.dgv.TableColumns.push("CheckInTime"),this.dgv.TableColumns.push("CheckOutDate"),this.dgv.TableColumns.push("CheckOutTime"),this.dgv.TableColumns.push("TotalTime"),this.dgv.TableColumns.push("Result"),this.dgv.TableColumns.push("Row_Background"),this.dgv.TableColumns.push("InvDocDetailsID");var e,t=new y.a;if(this.dgv.Columns=new Array,(t=new y.a).Header="Select",t.DisplayMember="Select",t.DataType="CheckBox",t.Width=50,t.CheckedChanged.Subscribe(this,"dgColSelect_CheckedChanged"),this.dgv.Columns.push(t),(t=new y.a).Header="#",t.DisplayMember="SNo",t.DataType="TextBlock",t.Width=40,t.ReadOnly=!0,this.dgv.Columns.push(t),(t=new y.a).Header="Employee Code",t.DisplayMember="EmpCode",t.DataType="TextBlock",t.Width=100,t.ReadOnly=!0,this.dgv.Columns.push(t),(t=new y.a).Header="Employee Name",t.DisplayMember="EmpName",t.DataType="TextBlock",t.Width=220,t.ReadOnly=!0,this.dgv.Columns.push(t),(t=new y.a).Header="Voucher No.",t.DisplayMember="VoucherNo",t.DataType="LINK_VOUCHER",t.Width=180,t.ReadOnly=!0,this.dgv.Columns.push(t),(t=new y.a).Header="Check-in Date",t.DisplayMember="CheckInDate",t.DataType="TextBlock",t.Width=120,t.ReadOnly=!0,t.TextAlign="Center",this.dgv.Columns.push(t),(t=new y.a).Header="Check-in Time",t.DisplayMember="CheckInTime",t.DataType="TextBlock",t.Width=120,t.ReadOnly=!0,t.TextAlign="Center",this.dgv.Columns.push(t),(t=new y.a).Header="Check-out Date",t.DisplayMember="CheckOutDate",t.DataType="TextBlock",t.Width=120,t.ReadOnly=!0,t.TextAlign="Center",this.dgv.Columns.push(t),(t=new y.a).Header="Check-out Time",t.DisplayMember="CheckOutTime",t.DataType="TextBlock",t.Width=120,t.ReadOnly=!0,t.TextAlign="Center",this.dgv.Columns.push(t),(t=new y.a).Header="Total Time",t.DisplayMember="TotalTime",t.DataType="TextBlock",t.Width=100,t.ReadOnly=!0,t.TextAlign="Center",this.dgv.Columns.push(t),(t=new y.a).Header="Result",t.DisplayMember="Result",t.DataType="TextBlock",t.Width=200,t.ReadOnly=!0,this.dgv.Columns.push(t),this.dsCols=o.a.common.GetDataSet("PAY062",""),null!=this.dsCols&&this.dsCols.Tables.length>0&&(null!=(e=this.dsCols.Tables[0].filter((function(e){return 1==e.IsColumnInUse})))&&e.length>0))for(var s=0;s<e.length;s++)(t=new y.a).Header=e[s].USERCOLUMNNAME.toString(),t.DisplayMember=e[s].SysColumnName.toString(),t.ID=e[s].SysColumnName.toString(),t.DataType="LISTBOX",t.CostCenterID=parseInt(e[s].ColumnCostCenterID),t.TypeID=parseInt(e[s].ColumnCCListViewTypeID),t.ReadOnly=!0,t.Width=120,this.dgv.Columns.push(t),this.dgv.TableColumns.push(t.DisplayMember),(t=new y.a).DisplayMember=e[s].SysColumnName.toString()+"_Key",t.IsVisible=!1,this.dgv.Columns.push(t),this.dgv.TableColumns.push(t.DisplayMember)}},{key:"dgColSelect_CheckedChanged",value:function(e,t){t||1==this.SelectAll&&(this.SelectUnCheck=1,this.SelectAll=!1)}},{key:"SelectUnselectAll",value:function(e){for(var t=0;t<this.dgv.Table.length;t++)0==this.SelectUnCheck&&(this.dgv.Table[t].Select=e);this.SelectUnCheck=0}},{key:"Button_Click",value:function(e){"Post"==e.toString()?this.btnPost_Click():"Clear"==e.toString()?this.btnClear_Click():"Filter"==e.toString()?this.btnFilter_Click():"Export"==e.toString()&&this.Export_Click()}},{key:"Export_Click",value:function(){}},{key:"btnClear_Click",value:function(){this.dgv.Clear(),this.SelectAll=!1,this.FailedCount=0,this.Failed="",this.InProgress="",this.lstSelectedEmps=new Array}},{key:"btnPost_Click",value:function(){var e=this;this.ValidatePosting()&&function(){var t,s,a=null;if(89==e.iPostDocType?o.a.SessionManager.Preferences.ContainsKey("PostAttendanceDataGroupBy")&&""!=o.a.SessionManager.Preferences.PostAttendanceDataGroupBy&&(a=o.a.SessionManager.Preferences.PostAttendanceDataGroupBy.toString().split(",")):o.a.SessionManager.Preferences.ContainsKey("PostTimeSheetDataGroupBy")&&""!=o.a.SessionManager.Preferences.PostTimeSheetDataGroupBy&&(a=o.a.SessionManager.Preferences.PostTimeSheetDataGroupBy.toString().split(",")),null!=a){var i=e.GetGroupByFilterEmployees();if(null!=i&&i.length>0){var l="";if(null!=a&&a.length>0){for(var n=0;n<a.length;n++)h.e.IsEmptySpace(a[n])||(l.length>0&&(l+=","),l+="-1"==a[n]?"RptManager":"-2"==a[n]?"EmpSeqNo":"CCNID"+(parseInt(a[n])-5e4));if(l.length>0){var r=i.ToTable(!0,l.split(","));if(null!=r&&r.length>0){e.dgv.TableColumns.Contains("Flag")&&e.dgv.TableColumns.Remove("Flag"),e.dgv.TableColumns.push("Flag");for(var d=function(a){for(var l=i,n=function(e){var t=Object.keys(r[0])[e],s=r[0][t];l=l.filter((function(e){return e[t]==h.e.String(s)}))},d=0;d<Object.keys(r[0]).length;d++)n(d);Object.keys(r[0]).length>0&&l.length>0&&k.RibbonExtViewModel.GetDocumentObject(40067,"",!1,"PostAttTimeSheet").then((function(a){a.ScreenObject.GridData.Clear();for(var i=-1,n=0;n<e.dgv.Table.length;n++)if(Object(m.j)(e.dgv.Table[n].Select)&&(null!=(s=e.dtData.filter((function(t){return t.InvDocDetailsID==e.dgv.Table[0].InvDocDetailsID})))&&s.length>0&&"1"!=h.e.String(e.dgv.Table[n].Flag)&&l.filter((function(e){return e.EmpCode==s[0].EmpCode.toString()})).length>0)){if(e.dgv.Table[n].Flag="1",i++,t=a.ScreenObject.GridDataObj.NewRow(),a.ScreenObject.GridDataObj.addRow(t),a.ScreenObject.GridDataColumns.Contains("dcCCNID51Code")&&(a.ScreenObject.GridData[i].dcCCNID51Code=s[0].EmpCode),a.ScreenObject.GridData[i].dcCCNID51_key=s[0].EmpSeqNo,a.ScreenObject.GridData[i].dcCCNID51=s[0].EmpName,a.FillDefaultProd(a.ScreenObject.GridData[i],"dcCCNID51"),a.ScreenObject.GridDataColumns.Contains("RefNo")&&(a.ScreenObject.GridData[i].RefNo=s[0].InvDocDetailsID),a.ScreenObject.GridData[i].dcAlpha1=new Date(s[0].CheckInDate).ToString(o.a.SessionManager.Preferences["Date Format"]),a.ScreenObject.GridData[i].dcAlpha1_Key=new Date(s[0].CheckInDate),a.Celleditend(a.ScreenObject.GridData[i],"dcCCNID51",0),a.ScreenObject.GridData[i].dcAlpha2=new Date(s[0].CheckInTime).ToString("HH:mm"),a.ScreenObject.GridData[i].dcAlpha2_Key=new Date(s[0].CheckInTime),a.ScreenObject.GridData[i].dcAlpha3=new Date(s[0].CheckOutTime).ToString("HH:mm"),a.ScreenObject.GridData[i].dcAlpha3_Key=new Date(s[0].CheckOutTime),a.Celleditend(a.ScreenObject.GridData[i],"dcAlpha3",40067),a.ScreenObject._CCFields.length>0)for(var r=0;r<a.ScreenObject._CCFields.length;r++)"DCCCNID51"!=a.ScreenObject._CCFields[r].DBColumnName.toUpperCase()&&(a.ScreenObject.GridDataColumns.Contains(a.ScreenObject._CCFields[r].DBColumnName+"_key")?a.ScreenObject.GridData[i][a.ScreenObject._CCFields[r].DBColumnName+"_key"]=s[0][a.ScreenObject._CCFields[r].DBColumnName].toString():(a.ScreenObject._CCFields[r]instanceof w.b||a.ScreenObject._CCFields[r]instanceof V.a)&&(a.ScreenObject._CCFields[r].SelectedValue=parseInt(s[0][a.ScreenObject._CCFields[r].DBColumnName])));for(var d=0;d<a.ScreenObject.GridDataColumns.length;d++)!a.ScreenObject.GridDataColumns[d].startsWith("dcCCNID")||a.ScreenObject.GridDataColumns[d].endsWith("_Key")||a.ScreenObject.GridDataColumns[d].endsWith("Code")||"DCCCNID51"!=a.ScreenObject.GridDataColumns[d].toUpperCase()&&(a.ScreenObject.GridData[i][a.ScreenObject.GridDataColumns[d]+"_Key"]=s[0][a.ScreenObject.GridDataColumns[d]]);a.CalculateTotals(a.ScreenObject.GridData[i],!1),a.ScreenObject.GridDataObj.updateRow(a.ScreenObject.GridData[i]),a.ScreenObject.GridDataObj.RefreshGrid=!0}h.e.IsEmptySpace("")||(a.DisplayMessage="",a.MessageVisibility=!0),a.UpdateFooter=!0,a.RefreshGrid=!0,o.a.page.addNewTab({title:a.DisplayName,component:_.AddEditDocumentComponent,params:{obj:a}});var p=a.ScreenObject._StaticFields.find((function(e){return"CommonNarration"==e.DBColumnName}));null!=p&&(p.SetFocus=!0)}))},p=0;p<r.length;p++)d()}}}}}else k.RibbonExtViewModel.GetDocumentObject(40067,"",!1,"PostAttTimeSheet").then((function(a){a.ScreenObject.GridData.Clear();for(var i=-1,l=function(l){if(Object(m.j)(e.dgv.Table[l].Select)&&(null!=(s=e.dtData.filter((function(t){return t.InvDocDetailsID==e.dgv.Table[l].InvDocDetailsID.toString()})))&&s.length>0)){if(i++,t=a.ScreenObject.GridDataObj.NewRow(),a.ScreenObject.GridDataObj.addRow(t),a.ScreenObject.GridDataColumns.Contains("dcCCNID51Code")&&(a.ScreenObject.GridData[i].dcCCNID51Code=s[0].EmpCode),a.ScreenObject.GridData[i].dcCCNID51_key=s[0].EmpSeqNo,a.ScreenObject.GridData[i].dcCCNID51=s[0].EmpName,a.FillDefaultProd(a.ScreenObject.GridData[i],"dcCCNID51"),a.ScreenObject.GridDataColumns.Contains("RefNo")&&(a.ScreenObject.GridData[i].RefNo=s[0].InvDocDetailsID),a.ScreenObject.GridData[i].dcAlpha1=new Date(s[0].CheckInDate).ToString(o.a.SessionManager.Preferences["Date Format"]),a.ScreenObject.GridData[i].dcAlpha1_Key=new Date(s[0].CheckInDate),a.Celleditend(a.ScreenObject.GridData[i],"dcCCNID51",0),a.ScreenObject.GridData[i].dcAlpha2=new Date(s[0].CheckInTime).ToString("HH:mm"),a.ScreenObject.GridData[i].dcAlpha2_Key=new Date(s[0].CheckInTime),a.ScreenObject.GridData[i].dcAlpha3=new Date(s[0].CheckOutTime).ToString("HH:mm"),a.ScreenObject.GridData[i].dcAlpha3_Key=new Date(s[0].CheckOutTime),a.Celleditend(a.ScreenObject.GridData[i],"dcAlpha3",40067),a.ScreenObject._CCFields.length>0)for(var n=0;n<a.ScreenObject._CCFields.length;n++)"DCCCNID51"!=a.ScreenObject._CCFields[n].DBColumnName.toUpperCase()&&(a.ScreenObject.GridDataColumns.Contains(a.ScreenObject._CCFields[n].DBColumnName+"_key")?a.ScreenObject.GridData[i][a.ScreenObject._CCFields[n].DBColumnName+"_key"]=s[0][a.ScreenObject._CCFields[n].DBColumnName].toString():(a.ScreenObject._CCFields[n]instanceof w.b||a.ScreenObject._CCFields[n]instanceof V.a)&&(a.ScreenObject._CCFields[n].SelectedValue=parseInt(s[0][a.ScreenObject._CCFields[n].DBColumnName])));for(var r=0;r<a.ScreenObject.GridDataColumns.length;r++)a.ScreenObject.GridDataColumns[r].startsWith("dcCCNID")&&!a.ScreenObject.GridDataColumns[r].endsWith("_Key")&&"DCCCNID51"!=a.ScreenObject.GridDataColumns[r].toUpperCase()&&(a.ScreenObject.GridData[i][a.ScreenObject.GridDataColumns[r]+"_Key"]=s[0][a.ScreenObject.GridDataColumns[r]]);a.CalculateTotals(a.ScreenObject.GridData[i],!1),a.ScreenObject.GridDataObj.updateRow(a.ScreenObject.GridData[i]),a.ScreenObject.GridDataObj.RefreshGrid=!0}},n=0;n<e.dgv.Table.length;n++)l(n);h.e.IsEmptySpace("")||(a.DisplayMessage="",a.MessageVisibility=!0),a.UpdateFooter=!0,a.RefreshGrid=!0,o.a.page.addNewTab({title:a.DisplayName,component:_.AddEditDocumentComponent,params:{obj:a}});var r=a.ScreenObject._StaticFields.find((function(e){return"CommonNarration"==e.DBColumnName}));r&&(r.SetFocus=!0)}))}()}},{key:"GetGroupByFilterEmployees",value:function(){var e="  AND EmpSeqNo IN ("+this.sEmpSeqNosOnGrid+")",t=[];return t.push(Date.Today().ToString("dd MMM yyyy")),t.push(e),t.push(0),t.push(o.a.SessionManager.RoleID),t.push(o.a.SessionManager.UserID),t.push(o.a.SessionManager.LanguageID),o.a.empService.GetData(t,"spPAY_GetEmpMasterCCDetails").Tables[0]}},{key:"ValidatePosting",value:function(){try{Logger.InfoLog("PostAttTimeSheetToDailyAttViewModel::Entering IsValidated()");for(var e=0,t=0;t<this.dgv.Table.length;t++)Object(m.j)(this.dgv.Table[t].Select)&&e++;if(0==e)return this.DisplayMessage="Select atleast one Document to post",!1;for(var s=0;s<this.dgv.Table.length;s++)if(Object(m.j)(this.dgv.Table[s].Select)&&(null==this.dgv.Table[s].CheckInTime||null==this.dgv.Table[s].CheckInTime||""==this.dgv.Table[s].CheckInTime.toString()||null==this.dgv.Table[s].CheckOutTime||null==this.dgv.Table[s].CheckOutTime||""==this.dgv.Table[s].CheckOutTime.toString()))return this.DisplayMessage="CheckInTime/CheckOutTime is empty at Row No. : "+(s+1).toString(),!1;return Logger.InfoLog("PostAttTimeSheetToDailyAttViewModel::Exiting IsValidated()"),!0}catch(a){return Logger.ErrorLog("PostAttTimeSheetToDailyAttViewModel::EXCEPTION IsValidated()"+a.stack),!1}}},{key:"btnFilter_Click",value:function(){var e=this;Logger.InfoLog("PostAttTimeSheetToDailyAttViewModel::Entering Filter_Click()"),null==this.objEmpFilter?this.objEmpFilter=new M.a("",0,10):(this.objEmpFilter.Filter=10,this.objEmpFilter.InitControls()),this.objEmpFilter.Filter>0?o.a.page.ShowDialog(this.objEmpFilter,L.a,{ShowCenter:!0,HideHeader:!0}).subscribe((function(){e.btnFilter_Click_CallBack()})):this.btnFilter_Click_CallBack()}},{key:"btnFilter_Click_CallBack",value:function(){var e=this;this.DialogResult=this.objEmpFilter.IsCompleted,this.objEmpFilter.IsCompleted&&(this.sEmpSeqNosOnGrid="",this.objEmpFilter.CostCenterFilters.length>0&&function(){for(var t=1,s="",a="",i="",o=0;o<e.objEmpFilter.CostCenterFilters.length;o++){var l=e.objEmpFilter.CostCenterFilters[o];if(l.CostCenterID>5e4&&(t=2,s="NodeID",a=50051==l.CostCenterID?"EmpSeqNo":"CCNID"+(l.CostCenterID-5e4)),l.SelectedNodes.length>0){if(1==l.SelectedNodes.length)i+=" AND ",i+=a+"="+l.SelectedNodes[0].Id;else if(!l.SelectedNodes.find((function(e){return e.Id==t&&e.IsGroup})))if(i+=" AND ",P.IPrefetchFilter.IsGroupTree(l)){for(var n="",r=0;r<l.SelectedNodes.length;r++)null!=l.SelectedNodes[r].Parent&&l.SelectedNodes[r].Parent.IsSelected||(n.length>0&&(n+=","),n+=l.SelectedNodes[r].Id);0==n.length&&(n+=-12912),i+=a+" IN ",i+=" (select T."+s+" GTID from "+D.b.GetTagTableName(l.CostCenterID)+" T with(nolock),"+D.b.GetTagTableName(l.CostCenterID)+" GTP with(nolock) where T.lft BETWEEN GTP.lft AND GTP.rgt AND GTP."+s+" IN (",i+=n.toString()+")  group by T."+s+")"}else{i+=a+" IN (";for(var d=0;d<l.SelectedNodes.length;d++)d>0&&(i+=","),i+=l.SelectedNodes[d].Id;i+=")"}}else l.DeleteButtonVisibility||(i+=" AND ",i+=a+"=-12912")}e.sFilter=i.toString()}(),this.FilterEmployees())}},{key:"FilterEmployees",value:function(){this.sEmpSeqNosOnGrid="",this.iPostDocType=this.objEmpFilter.rBtnPostAttDocs?89:90,this.ChkBtnPostOnlyFirstAndLastTrans.Visible=90==this.iPostDocType,this.ChkBtnPostOnlyFirstAndLastTrans.Visible=!1;try{o.a.SessionManager.LocationID>0&&o.a.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&o.a.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+o.a.SessionManager.LocationID+")"),h.e.IsEmpty(o.a.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sFilter+="  AND EmpSeqNo IN ("+o.a.SessionManager.sWHEmpFilteredEmpSeqNos+")"),Logger.InfoLog("PostAttTimeSheetToDailyAttViewModel::Entering FilterEmployees()");var e=[];e.push(Date.Today().ToString("dd MMM yyyy")),e.push(this.sFilter),e.push(0),e.push(o.a.SessionManager.RoleID),e.push(o.a.SessionManager.UserID),e.push(o.a.SessionManager.LanguageID);var t=o.a.empService.GetData(e,"spPAY_GetEmpMasterCCDetails"),s="";if(this.dgv.Clear(),null!=t&&t.Tables.length>0&&t.Tables[0].length>0){for(var a=0;a<t.Tables[0].length;a++)s.Trim().length>0&&(s+=","),s+=t.Tables[0][a].EmpSeqNo.toString();var i=o.a.common.GetDataSet3("PAY063",this.iPostDocType.toString(),s,this.objEmpFilter.FromDatePicker.Date.ToString("dd/MMM/yyyy")+"~"+this.objEmpFilter.ToDatePicker.Date.ToString("dd/MMM/yyyy"));if(this.dtData=i.Tables[0],!(null!=i&&i.Tables.length>0&&i.Tables[0].length>0))return void(this.DisplayMessage="No documents found for the selected Employees.");for(var l,n=0;n<i.Tables[0].length;n++){(l=this.dgv.NewRow()).Select=!1,l.SNo=(n+1).toString(),this.sEmpSeqNosOnGrid.length>0&&(this.sEmpSeqNosOnGrid+=","),this.sEmpSeqNosOnGrid+=i.Tables[0][n].EmpSeqNo.toString(),l.EmpSeqNo=i.Tables[0][n].EmpSeqNo,l.EmpCode=i.Tables[0][n].EmpCode,l.EmpName=i.Tables[0][n].EmpName,l.InvDocDetailsID=i.Tables[0][n].InvDocDetailsID,l.VoucherNo=i.Tables[0][n].VoucherNo,l.CheckInDate=i.Tables[0][n].CheckInDate,h.e.IsEmptySpace(i.Tables[0][n].CheckInTime)||(l.CheckInTime=new Date(i.Tables[0][n].CheckInTime).ToString("HH:mm")),h.e.IsEmptySpace(i.Tables[0][n].CheckOutDate)?l.Row_Background="#F77B7E":l.CheckOutDate=i.Tables[0][n].CheckOutDate,h.e.IsEmptySpace(i.Tables[0][n].CheckOutTime)||(l.CheckOutTime=new Date(i.Tables[0][n].CheckOutTime).ToString("HH:mm")),l.TotalTime=h.e.IsEmptySpace(i.Tables[0][n].TotalTime)?"0.00":i.Tables[0][n].TotalTime,0==parseFloat(l.TotalTime.toString().Replace(":","."))&&(l.Row_Background="#F77B7E");for(var r=0;r<this.dgv.TableColumns.length;r++)this.dgv.TableColumns[r].startsWith("dcCCNID")&&!this.dgv.TableColumns[r].endsWith("_Key")&&(l[this.dgv.TableColumns[r]+"_Key"]=i.Tables[0][n][this.dgv.TableColumns[r]]);this.dgv.addRow(l)}this.dgv.refreshDataView()}Logger.InfoLog("PostAttTimeSheetToDailyAttViewModel::Exiting FilterEmployees()")}catch(d){Logger.ErrorLog("PostAttTimeSheetToDailyAttViewModel::EXCEPTION FilterEmployees()"+d.stack)}}},{key:"SelectAll",get:function(){return this._SelectAll},set:function(e){e!=this._SelectAll&&(this._SelectAll=e,this.SelectUnselectAll(e))}},{key:"RefreshGrid",set:function(e){}}]),s}(C.b),j=s("26AK"),W=s("fKF8"),B=s("Kz05"),U=s("EQd/"),H=s("JIg3"),X=s("OvA8"),q=s("xnJf"),Y=s("9WDa"),K=s("wnwj"),Q=s("7i9q"),J=function(e){_inherits(s,e);var t=_createSuper(s);function s(e){var a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";_classCallCheck(this,s),(a=t.call(this)).ApproveVisibility=!1,a.PostVisiblility=!0,a.UnPostVisiblility=!0,a.WID=0,a.DocID=0,a.txtDocNo=new U.d(0),a.dtpDocDate=new H.a(0),a.EmployeeList=new V.a(0),a.dtpDateOfJoining=new H.a(0),a.dtpDateOfRelieving=new H.a(0),a.txtRemarks=new U.d(0),a.txtNetAmount=new U.d(0),a.DialogResult=!1,a.AttachmentVisibility=!1,a.CostCenterID=40095,a.CalculateClick=new A.b,a.EmpSelectionChanged=new A.b,a.strCustomEmpFilter="",a.sCmdParameter="",a.IsSaved=!1,a.sVNo="",a.dtRes1=null,a.drwRes=null,a.SelectedEmpID=0,a.StatusColor="#736F6F",a.StatusID=0,a.WFDocLevelList=new Array,a.ClassName="FinalSettlementViewModel";try{a.CostCenterID=40095,a.dtRes1=o.a.common.GetDataTable("CRM030",o.a.SessionManager.LangID),a.txtDocNo.Label=a.GetResource("VoucherNo",40095),a.dtpDocDate.Label=a.GetResource("DocDate",40095),a.EmployeeList.Label=a.GetResource("Employee",40095),a.dtpDateOfJoining.Label=a.GetResource("Date of Joining",40095),a.dtpDateOfRelieving.Label=a.GetResource("Date of Relieving",40095),a.txtNetAmount.Label=a.GetResource("Net Amount",40095),a.DisplayName=e,a.Title=e,a.sVNo=i,a.DisplayMessage="",a.DocStatus="[UnPosted]",a.ViewAttachments=new X.ViewAttachmentViewModel(_assertThisInitialized(a),o.a.SessionManager,o.a.admin),a.OnAddAttachment(),a.txtDocNo.LblWidth="",a.txtRemarks.Label=o.a.GetResource("Remarks"),a.txtNetAmount.IsReadOnly=!0,a.EmployeeList.Code.TypeID=4,a.EmployeeList.Name.TypeID=1,a.EmployeeList.Code.Visible=a.EmployeeList.Name.Visible=!1,a.EmployeeList.Code.Column=0,a.EmployeeList.Name.Column=1,a.EmployeeList.Code.Visible=!0,a.EmployeeList.Name.Visible=!0,a.EmployeeList.Code.CCID=a.EmployeeList.Name.CCID=50051,a.EmployeeList.Code.Visible&&(a.EmployeeList.Code.CCID=50051,a.EmployeeList.Code.TypeID=4),a.EmployeeList.Name.Visible&&(a.EmployeeList.Name.CCID=50051,a.EmployeeList.Name.TypeID=1),a.strCustomEmpFilter=a.FilterEmployees(),a.EmployeeList.Code.CustomWhere=a.EmployeeList.Name.CustomWhere=a.strCustomEmpFilter,a.EmployeeList.SelectionCallBack.Subscribe(_assertThisInitialized(a),"EmployeeList_SelectedValueChanged"),a.cmbResignType=new g.e(0),a.cmbResignType.Items.push(g.d.ComboBoxItems_2("Resigned","Resigned")),a.cmbResignType.Items.push(g.d.ComboBoxItems_2("Terminated","Terminated")),a.cmbResignType.Items.push(g.d.ComboBoxItems_2("Terminated With Cause","Terminated With Cause")),a.cmbResignType.Items.push(g.d.ComboBoxItems_2("Terminated Without Cause","Terminated Without Cause")),a.cmbResignType.Label=a.GetResource("Resign Type",40095),a.cmbSettlementType=new g.e(0),a.cmbSettlementType.Items.push(g.d.ComboBoxItems_2("Final","Final")),a.cmbSettlementType.Items.push(g.d.ComboBoxItems_2("Partial","Partial")),a.cmbSettlementType.Label=a.GetResource("Settlement Type",40095),a.PostVisiblility=o.a.SessionManager.IsActionAssigned(a.CostCenterID,"Create"),a.UnPostVisiblility=o.a.SessionManager.IsActionAssigned(a.CostCenterID,"Delete"),o.a.SessionManager.Preferences.ContainsKey("DisableDateOfRelievingFieldInFinalSettlement")&&"True"==o.a.SessionManager.Preferences.DisableDateOfRelievingFieldInFinalSettlement.toString()&&(a.dtpDateOfRelieving.Enable=!1),o.a.SessionManager.Preferences.ContainsKey("DisableResignTypeFieldInFinalSettlement")&&"True"==o.a.SessionManager.Preferences.DisableResignTypeFieldInFinalSettlement.toString()&&(a.cmbResignType.Enable=!1),Logger.InfoLog("FinalSettlementViewModel::Exiting FinalSettlementViewModel()")}catch(l){Logger.ErrorLog("FinalSettlementViewModel::EXCEPTION FinalSettlementViewModel()",l)}return a}return _createClass(s,[{key:"EmployeeList_SelectedValueChanged",value:function(e){try{this.DisplayMessage="",this.SelectedEmpID=this.EmployeeList.Code.SelectedValue,this.SelectedEmpID>0&&this.EmpSelectionChanged.Call(this.SelectedEmpID)}catch(t){Logger.ErrorLog("FinalSettlementViewModel::EXCEPTION EmployeeList_SelectedValueChanged()",t)}}},{key:"setStatusColor",value:function(){this.StatusColor=this.DocStatus.startsWith("["+o.a.GetResource("Doc_Draft")+"]")||this.DocStatus.startsWith("[UnPosted]")?o.a.SessionManager.Preferences.DraftColor:this.DocStatus.startsWith("[Partial]")?o.a.SessionManager.Preferences.partialColor:369==this.StatusID?o.a.SessionManager.Preferences.PostedColor:370==this.StatusID?o.a.SessionManager.Preferences.PDCColor:371==this.StatusID?o.a.SessionManager.Preferences.UnApprovedColor:372==this.StatusID?o.a.SessionManager.Preferences.RejectedColor:376==this.StatusID?o.a.SessionManager.Preferences.CancelledColor:429==this.StatusID?o.a.SessionManager.Preferences.BouncedColor:441==this.StatusID?o.a.SessionManager.Preferences.ApprovedColor:"#FF736F6F",9==this.StatusColor.length&&(this.StatusColor.startsWith("#FF")||this.StatusColor.startsWith("#ff"))&&(this.StatusColor="#"+this.StatusColor.substr(3))}},{key:"Button_Click",value:function(e){try{if("Clear"==e.toString())this.EmployeeList.SelectedValue=0,this.SelectedEmpID=0,this.CalculateClick.Call(e);else if("EMail"==e.toString()){if(!(this.DocID>0))return void(this.DisplayMessage="Load document in Edit Mode");o.a.page.ShowDialog(new K.SendEmailSMSViewModel(!0,50051,this.EmployeeList.SelectedValue,this),Q.SendEmailSMSComponent)}else"Attachments"==e.toString()?(this.AttachmentVisibility=!0,o.a.page.ShowDialog(this.Attachment,Y.a,{Title:this.Attachment.Title})):this.CalculateClick.Call(e)}catch(t){Logger.ErrorLog("FinalSettlementViewModel::EXCEPTION Button_Click()",t)}}},{key:"SetDocStatus",value:function(e,t,s,a,i,l,n){var r=[];return r.push(e),r.push(null!=i?i:""),r.push(a.ToString("dd/MMM/yyyy")),r.push(!0),r.push(this.DocID),r.push(this.CostCenterID),r.push(t),r.push(s),r.push(l),r.push(n),r.push(o.a.SessionManager.CompanyGUID),r.push(o.a.SessionManager.UserName),r.push(o.a.SessionManager.UserID),r.push(o.a.SessionManager.RoleID),r.push(o.a.SessionManager.LanguageID),o.a.document.SetDocStatus(r)}},{key:"FilterEmployees",value:function(){var e="";try{Logger.InfoLog("FinalSettlementViewModel::Entering FilterEmployees()"),o.a.SessionManager.LocationID>0&&o.a.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&o.a.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(e=e+" a.NodeID IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+o.a.SessionManager.LocationID+")"),Logger.InfoLog("FinalSettlementViewModel::Exiting FilterEmployees()")}catch(t){Logger.ErrorLog("FinalSettlementViewModel::EXCEPTION FilterEmployees()",t)}return e}},{key:"SaveFinalSettlement",value:function(e){return o.a.document.SetTempInvDocument(e)}},{key:"OnShowAttachment",value:function(){Logger.InfoLog("AddProductViewModel::Entering OnShowAttachment"),Logger.InfoLog("AddProductViewModel::Exiting OnShowAttachment")}},{key:"OnAddAttachment",value:function(){Logger.InfoLog("AddProductViewModel::Entering AddAttachment");var e="";null!=this.Attachment&&(e=this.Attachment.ColID);var t=null;null!=this.Attachment&&(t=this.Attachment.RowID),this.Attachment=new q.AddAttachmentViewModel,this.Attachment.AddAttachmentViewModel_2(this),""==e?(this.Attachment.ColID="",this.Attachment.RowID=null):(this.Attachment.ColID=e,this.Attachment.RowID=t),Logger.InfoLog("AddProductViewModel::Entering AddAttachment")}},{key:"GetResource",value:function(e,t){var s=e;return this.drwRes=this.dtRes1.filter((function(s){return s.CCID==t&&s.Code==e})),null!=this.drwRes&&this.drwRes.length>0?1==o.a.SessionManager.LanguageID?this.drwRes[0].Name.toString():this.drwRes[0].AliasName.toString():s}},{key:"PostApplyLeaves",value:function(e,t,s){return o.a.empService.ExecuteQuery_SP(t,s)}},{key:"DocStatus",get:function(){return this._DocStatus},set:function(e){e!=this._DocStatus&&(this._DocStatus=e,this.setStatusColor())}}]),s}(C.b),z=function e(){_classCallCheck(this,e),this.EmpCode="",this.EmpName="",this.EmpAliasName="",this.Gender="",this.CodePrefix="",this.ParentName="",this.CCMapXML="",this.HistoryXML="",this.PayQuery="",this.CustomFieldsQuery="",this.CustomCostCenterFieldsQuery="",this.NotesXML="",this.ContactsXML="",this.AddressXML="",this.AttachmetsXML="",this.AccLinkXML="",this.PrimaryContactQuery="",this.StaticFieldsQuery="",this.CompanyGUID="",this.GUID="",this.UserName="",this.DocumentsXML="",this.EmpYear="",this.NodeID=0,this.CodeNumber=0,this.StatusID=0,this.EmpTypeID=0,this.ParentID=0,this.CurrencyID=0,this.SelectedNodeID=0,this.ProbationDays=0,this.RptManager=0,this.UserId=0,this.LanguageId=0,this.GroupSeqNoLength=0,this.WID=0,this.IsGroup=!1,this.IDHistoryXML="",this.PaymentModeXML=""},Z=s("Jnyl"),$=s("Agar"),ee=function(e){_inherits(s,e);var t=_createSuper(s);function s(){var e;_classCallCheck(this,s),(e=t.call(this)).CostCenterID=0,e.TypeID=0,e.AttachmentVisibility=!1,e.Employee=new V.a(0),e.PayrollTaxFields=new Array,e.dtPayrollTaxCmptsObj=new c.a,e.Savereturnvalue=-1,e.oRadio1=null,e.dsTaxComponents=null,e.CostCenterID=262,e.objEmp=new z,e.ViewAttachments=new X.ViewAttachmentViewModel(_assertThisInitialized(e)),e.OnAddAttachment(),e.EmpYear=new g.e(0),e.EmpYear.LblWidth="60",e.EmpYear.Label=o.a.GetResource("Doc_Year"),e.EmpYear.SelectionChangedCommand.Subscribe(_assertThisInitialized(e),"OnYearSelected");for(var a=2e3;a<2100;a++){var i=g.d.ComboBoxItems_2(a.toString(),a.toString());e.EmpYear.Items.push(i)}return e.EmpYear.SelectedValue=new Date(o.a.SessionManager.PayrollMonth).ToString("yyyy"),e.Employee.Visible=!0,e.Employee.Code.TypeID=4,e.Employee.Name.TypeID=1,e.Employee.Code.Visible=e.Employee.Name.Visible=!1,e.Employee.Code.Column=0,e.Employee.Name.Column=1,e.Employee.Code.Visible=!0,e.Employee.Name.Visible=!0,e.Employee.Code.CCID=e.Employee.Name.CCID=50051,e.Employee.LblWidth="80",e.Employee.Label=o.a.GetResource("Pay_Employee"),e.Employee.Code.Visible&&(e.Employee.Code.CCID=50051,e.Employee.Code.TypeID=4),e.Employee.Name.Visible&&(e.Employee.Name.CCID=50051,e.Employee.Name.TypeID=1),e.FilterEmployees(),e.Employee.SelectionCallBack.Subscribe(_assertThisInitialized(e),"Employee_SelectedValueChanged"),e.dtPayrollTaxCmptsObj.Table=[],e.dtPayrollTaxCmptsObj.Columns=new Array,e.dtPayrollTaxCmptsObj.Height=110,e.GenerateTaxComponentFields(0,0,e.PayrollTaxFields),e.BindHRAGridColumns(),e}return _createClass(s,[{key:"BindHRAGridColumns",value:function(){this.PayrollColumnSourceTaxComponents.Clear(),this.dtPayrollTaxCmptsObj.Clear();var e=new y.a;e.Header="FromDate",e.DisplayMember="ITFromDate",e.ValueMember="ITFromDate_Key",e.DataType="DATE",e.ReadOnly=!1,e.Width=85,this.PayrollColumnSourceTaxComponents.push(e),(e=new y.a).Header="ToDate",e.DisplayMember="ITToDate",e.ValueMember="ITToDate_Key",e.DataType="DATE",e.ReadOnly=!1,e.Width=85,this.PayrollColumnSourceTaxComponents.push(e),(e=new y.a).Header="Amount",e.DisplayMember="Amount",e.DataType="TextBlock",e.ReadOnly=!1,e.Width=75,this.PayrollColumnSourceTaxComponents.push(e),(e=new y.a).Header="Metro",e.ValueBinding="Metro",e.DataType="ComboBox",e.DisplayMember="Name",e.ValueMember="Value",e.Width=60;var t=[];t.push(g.d.ComboBoxItems_2("Yes","Yes")),t.push(g.d.ComboBoxItems_2("No","No")),e.ComboData=t,this.PayrollColumnSourceTaxComponents.push(e),(e=new y.a).Header="HRAAddress",e.DisplayMember="HRAAddress",e.DataType="TextArea",e.ReadOnly=!1,e.Width=200,this.PayrollColumnSourceTaxComponents.push(e),(e=new y.a).Header="Name of Landlord",e.DisplayMember="NameofLandlord",e.DataType="TextBlock",e.ReadOnly=!1,e.Width=153,this.PayrollColumnSourceTaxComponents.push(e),(e=new y.a).Header="Pan of Landlord",e.DisplayMember="PanofLandlord",e.DataType="TextBlock",e.ReadOnly=!1,e.Width=150,this.PayrollColumnSourceTaxComponents.push(e),this.dtPayrollTaxCmptsObj.RefreshGridView()}},{key:"Employee_SelectedValueChanged",value:function(e){""!=this.EmpYear.SelectedValue.toString()?(this.PayrollTaxFields.Clear(),this.dtPayrollTaxCmptsObj.Clear(),null!=this.ViewAttachments&&this.ViewAttachments.AttachmentsListObj.Clear(),this.ViewAttachments=new X.ViewAttachmentViewModel(this),this.OnAddAttachment(),this.GenerateTaxComponentFields(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue,this.PayrollTaxFields)):this.DisplayMessage="Please select the Year"}},{key:"OnYearSelected",value:function(e){this.Employee.SelectedValue=0,this.FilterEmployees(),this.dtPayrollTaxCmptsObj.Columns.Clear(),this.PayrollTaxFields.Clear(),this.dtPayrollTaxCmptsObj.Clear(),this.Employee.SelectedValue>0?this.GenerateTaxComponentFields(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue,this.PayrollTaxFields):this.GenerateTaxComponentFields(0,0,this.PayrollTaxFields)}},{key:"OnComponentSelection",value:function(e){var t=this,s="";this.PayrollTaxFields.forEach((function(e){if(e instanceof Z.b){var a=e;if(null!=(s=a.Currency.SelectedValue))for(var i=t.dsTaxComponents.Tables[0].filter((function(e){return"ComboTextValue"==e.ControlType&&e.NodeID==parseInt(s)})),o=0;o<i.length;o++){var l=i[o];switch(h.e.String(l.ControlType)){case"COMBOTEXTVALUE":a.Label=h.e.String(l.AmountLimit)}}}}))}},{key:"GenerateTaxComponentFields",value:function(e,t,s){var a=this;try{Logger.InfoLog("VoucherGenerator:: Inside GenerateCustomFields");var i,l=0,n=null,r=null;if(null===t&&(t=0),0!=e&&0!=t&&(n=o.a.common.GetDataSet3("PAY071",e.toString(),t.toString())),null!=n&&n.Tables.length>0&&n.Tables[0].length>0&&!h.e.IsEmpty(n.Tables[0][0].SEQNO)&&(r=o.a.common.GetDataSet("PAY072",n.Tables[0][0].SEQNO.toString())),this.dsTaxComponents=o.a.empService.GetIncomeTaxComponents(0,e,t),this.dsTaxComponents.Tables[0].length>0&&this.dsTaxComponents.Columns[0].Contains("ITComponentsValidationMessage")&&!h.e.IsEmpty(this.dsTaxComponents.Tables[0][0].ITComponentsValidationMessage))return void(this.DisplayMessage=this.dsTaxComponents.Tables[0][0].ITComponentsValidationMessage.toString());var d=this.dsTaxComponents.Tables[0];if(d.forEach((function(e){switch(h.e.String(e.CONTROLTYPE).toUpperCase()){case"LABEL":(i=new $.a).Label=h.e.String(e.NAME),s.push(i),i.tabname="LABEL";break;case"TEXTBOX":a.LabelLimitAmount=h.e.String(e.AMOUNTLIMIT),a.oText=new U.d(parseInt(e.NODEID)),a.oText.Label=h.e.String(e.NAME),a.oText.KeyTip=a.LabelLimitAmount,a.oText.Text=e.AMOUNT.toString(),a.oText.LblWidth="400",a.oText.tabname="TEXTBOX",s.push(a.oText);break;case"COMBOTEXTVALUE":var t=d.filter((function(t){return"ComboTextValue"==t.CONTROLTYPE&&t.GROUPID==parseInt(e.GROUPID)})),o=s.find((function(t){return t instanceof Z.b&&t.DBColumnID==parseInt(e.GROUPID)}));null==o?(a.oRadio1=new Z.b,a.oRadio1.DBColumnID=parseInt(e.GROUPID)):a.oRadio1=o,a.oRadio1.tabname="COMBOTEXTVALUE",a.oRadio1.LblWidth="1",0!=l&&l==parseInt(e.GROUPID)||t.length>0&&(t.forEach((function(e){a.oRadio1.Currency.Items.push(g.d.ComboBoxItems_2(h.e.String(e.NAME).TrimStart(" "),h.e.String(e.NODEID)))})),a.oRadio1.Currency.SelectedValue=a.oRadio1.Currency.Items[0].Value,a.oRadio1.Currency.SelectionChangedCommand.Subscribe(a,"OnComponentSelection"),s.push(a.oRadio1)),parseInt(e.SELECTEDNODE)>0?(a.oRadio1.Currency.SelectedValue=h.e.String(e.SELECTEDNODE),a.oRadio1.ExchangeRate.Text=e.AMOUNT.toString(),a.oRadio1.Label=e.SELECTEDAMTLIMIT.toString()):""==a.oRadio1.ExchangeRate.Text&&(a.oRadio1.ExchangeRate.Text=e.AMOUNT.toString()),null==a.oRadio1.Label&&(a.LabelLimitAmount=h.e.String(e.AMOUNTLIMIT),a.oRadio1.Label=a.LabelLimitAmount),(0==l||l!=parseInt(e.GROUPID))&&(l=parseInt(e.GROUPID))}})),null!=this.dsTaxComponents&&this.dsTaxComponents.Tables.length>1&&this.dsTaxComponents.Tables[1].length>0)for(var p,m=0;m<this.dsTaxComponents.Tables[1].length;m++)(p=this.dtPayrollTaxCmptsObj.NewRow()).ITFromDate=new Date(this.dsTaxComponents.Tables[1][m].FromDate).ToString("MMM/yyyy"),p.ITFromDate_Key=new Date(this.dsTaxComponents.Tables[1][m].FromDate).ToString("dd-MMM-yyyy"),p.ITToDate=new Date(this.dsTaxComponents.Tables[1][m].ToDate).ToString("MMM/yyyy"),p.ITToDate_Key=new Date(this.dsTaxComponents.Tables[1][m].ToDate).ToString("dd-MMM-yyyy"),p.Amount=this.dsTaxComponents.Tables[1][m].Amount.toString(),p.Metro=this.dsTaxComponents.Tables[1][m].Metro.toString().TrimEnd(),p.HRAAddress=this.dsTaxComponents.Tables[1][m].Address.toString(),p.NameofLandlord=this.dsTaxComponents.Tables[1][m].Landlord.toString(),p.PanofLandlord=this.dsTaxComponents.Tables[1][m].LandlordPAN.toString(),this.dtPayrollTaxCmptsObj.addRow(p);if(null!=r&&r.Tables.length>0&&r.Tables[0].length>0){var c=r.Tables[0];if(null!=c&&c.length>0)for(var C=0;C<c.length;C++){var u=new q.AddAttachmentViewModel;u.AddAttachmentViewModel_2(this),u.AttachmentID=parseInt(c[C].FileID),u.ActualFileName=c[C].ActualFileName.toString(),u.FileExtension=c[C].FileExtension.toString(),u.FileDescription=c[C].FileDescription.toString(),u.FilePath=h.e.GetPath(c[C].GUID+"."+c[C].FileExtension),u.RelativeFileName=c[C].RelativeFileName.toString(),u.IsProductImage=!1,this.ViewAttachments.AttachmentsList.push(u)}}else this.BindEmptyRows(2)}catch(y){Logger.ErrorLog("Error : "+y),this.DisplayMessage=y.message}}},{key:"OnSaveITDeclarations",value:function(e){try{Logger.InfoLog("ITDeclarationsViewModel::Entering OnSaveITDeclarations()");var t="";if(""!=(t=this.DataValid()).toString())return void(this.DisplayMessage=t);this.SaveEmpIncomeTax(),this.OnClear(e)}catch(s){Logger.ErrorLog("ITDeclarationsViewModel::EXCEPTION OnSaveITDeclarations()"+s)}}},{key:"DataValid",value:function(){var e,t,s="",a=0,i=0;0==this.Employee.SelectedValue&&(s+="Please select the Employee \r\n"),""==this.EmpYear.SelectedValue.toString()&&(s+="Please select the Year \r\n"),this.PayrollTaxFields.forEach((function(e){if(e instanceof U.d){var t=e;a=h.e.Double(t.KeyTip),i=h.e.Double(t.Text),a>0&&i>a&&(s=s+"Amount should be less than Limit Amount for '"+t.Label.toString().Trim()+"'\r\n")}if(e instanceof Z.b){var o=e;a=h.e.Double(o.Label),i=h.e.Double(o.ExchangeRate.Text),a>0&&i>a&&(s=s+"Amount should be less than Limit Amount for '"+o.Currency.Text.toString().Trim()+"'\r\n")}}));for(var o=0;o<this.dtPayrollTaxCmpts.length;o++)h.e.IsEmpty(this.dtPayrollTaxCmpts[o].ITFromDate_Key)||(new Date(new Date(this.dtPayrollTaxCmpts[o].ITFromDate_Key).ToString("MMM/yyyy"))>new Date(new Date(this.dtPayrollTaxCmpts[o].ITToDate_Key).ToString("MMM/yyyy"))?s=s+"Fromdate should be less than todate at row no ('"+o.toString()+"')\r\n":new Date(new Date(this.dtPayrollTaxCmpts[o].ITToDate_Key).ToString("MMM/yyyy"))<new Date(new Date(this.dtPayrollTaxCmpts[o].ITFromDate_Key).ToString("MMM/yyyy"))&&(s=s+"Todate should be greater than fromdate at row no ('"+o.toString()+"')\r\n"));for(var l=0;l<this.dtPayrollTaxCmpts.length&&""!=h.e.String(this.dtPayrollTaxCmpts[l].ITFromDate_Key);l++){e=new Date(new Date(this.dtPayrollTaxCmpts[l].ITFromDate_Key).ToString("MMM/yyyy")),t=new Date(new Date(this.dtPayrollTaxCmpts[l].ITToDate_Key).ToString("MMM/yyyy"));for(var n=0;n<this.dtPayrollTaxCmpts.length;n++)if(l!=n){if(""==h.e.String(this.dtPayrollTaxCmpts[n].ITFromDate_Key))break;if(+e.Date>=+new Date(this.dtPayrollTaxCmpts[n].ITFromDate_Key).OnlyDate()&&+e.Date<=+new Date(this.dtPayrollTaxCmpts[n].ITToDate_Key).OnlyDate()||+t.Date>=+new Date(this.dtPayrollTaxCmpts[n].ITFromDate_Key).OnlyDate()&&+t.Date<=+new Date(this.dtPayrollTaxCmpts[n].ITToDate_Key).OnlyDate()||+e.Date>=+new Date(this.dtPayrollTaxCmpts[n].ITFromDate_Key).OnlyDate()&&+t.Date<=+new Date(this.dtPayrollTaxCmpts[n].ITToDate_Key).OnlyDate()||+new Date(this.dtPayrollTaxCmpts[n].ITFromDate_Key).OnlyDate()>=+e.Date&&+new Date(this.dtPayrollTaxCmpts[n].ITToDate_Key).OnlyDate()<=+t.Date){s=s+"Invalid dates entered at row no ('"+n.toString()+"')\r\n";break}}}return s}},{key:"SaveEmpIncomeTax",value:function(){var e=this;Logger.InfoLog("ITDeclarationsViewModel::Entering SaveEmpIncomeTax");try{var t="";this.objEmp.EmpYear=this.EmpYear.SelectedValue,this.objEmp.EmpCode=this.Employee.SelectedValue.toString(),t+="<Rows>",this.PayrollTaxFields.forEach((function(e){if(e instanceof U.d){var s=e;t+='<row ComponentID="'+s.DBColumnID,t+='" AmountLimit="'+s.KeyTip,t+=null!=s.Text?'" Amount="'+parseFloat(s.Text):'" Amount="0',t+='"/>'}else if(e instanceof Z.b){var a=e;t+='<row ComponentID="'+a.Currency.SelectedValue,t+='" AmountLimit="'+a.Label,t+=null!=a.ExchangeRate.Text?'" Amount="'+parseFloat(a.ExchangeRate.Text):'" Amount="0',t+='"/>'}})),t+="</Rows>";var s="";s+="<HRAINFO>";for(var a=0;a<this.dtPayrollTaxCmpts.length;a++)""==h.e.String(this.dtPayrollTaxCmpts[a].ITFromDate_Key)&&""==h.e.String(this.dtPayrollTaxCmpts[a].ITToDate_Key)||(s+='<row FromDt="'+new Date(this.dtPayrollTaxCmpts[a].ITFromDate_Key).ToString("dd-MMM-yyyy"),s+='" ToDt="'+new Date(this.dtPayrollTaxCmpts[a].ITToDate_Key).ToString("dd-MMM-yyyy"),""!=this.dtPayrollTaxCmpts[a].Amount.toString()?s+='" Amt="'+parseFloat(this.dtPayrollTaxCmpts[a].Amount):s+='" Amt="0',s+='" Metro="'+this.dtPayrollTaxCmpts[a].Metro,s+='" Address="'+this.dtPayrollTaxCmpts[a].HRAAddress,s+='" Landlord="'+this.dtPayrollTaxCmpts[a].NameofLandlord,s+='" LandlordPAN="'+this.dtPayrollTaxCmpts[a].PanofLandlord,s+='"/>');s+="</HRAINFO>";var i=this.ViewAttachments.GetXML();o.a.empService.SaveEmpTaxDeclarations(t.toString(),s.toString(),i.toString(),this.objEmp.EmpYear,this.objEmp.EmpCode).subscribe((function(t){e.DisplayMessage=t.Message,e.Savereturnvalue=t.RetValue}))}catch(l){Logger.ErrorLog("ITDeclarationsViewModel:: SaveEmpIncomeTax"+l.stack)}}},{key:"OnClear",value:function(e){try{this.Employee.SelectedValue=0,this.PayrollColumnSourceTaxComponents.Clear(),this.PayrollTaxFields.Clear(),this.BindHRAGridColumns(),this.GenerateTaxComponentFields(0,0,this.PayrollTaxFields),null!=this.ViewAttachments&&this.ViewAttachments.AttachmentsList.Clear(),this.ViewAttachments=new X.ViewAttachmentViewModel(this),this.OnAddAttachment()}catch(t){Logger.ErrorLog("Error : "+t),this.DisplayMessage=t.message}}},{key:"BindEmptyRows",value:function(e){this.dtPayrollTaxCmptsObj.addEmptyRows(e)}},{key:"FilterEmployees",value:function(){try{Logger.InfoLog("ITDeclarationsViewModel::Entering FilterEmployees()");var e,t,s="";e=new Date(parseInt(this.EmpYear.SelectedValue),o.a.SessionManager.AccountingFromMonth-1,1),t=(t=new Date(o.a.SessionManager.AccountingFromMonth>1?parseInt(this.EmpYear.SelectedValue)+1:parseInt(this.EmpYear.SelectedValue),o.a.SessionManager.AccountingToMonth-1,1)).AddMonths(1).AddDays(-1),s=(s=(s=" ( a.StatusID=250 AND (ISNULL(CONVERT(DATETIME,a.DORelieve),'01-Jan-9000')='01-Jan-9000') ")+" or (Year(CONVERT(DATETIME,'"+t.ToString("dd/MMM/yyyy")+"'))<=Year(CONVERT(DATETIME,a.DORelieve)) and CONVERT(DATETIME,'"+e.ToString("dd/MMM/yyyy")+"')<=CONVERT(DATETIME,a.DORelieve)) ")+" or ( CONVERT(DATETIME,'"+e.ToString("dd/MMM/yyyy")+"')<=CONVERT(DATETIME,a.DORelieve))) ",o.a.SessionManager.LocationID>0&&o.a.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&o.a.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(s=s+" AND a.NodeID IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+o.a.SessionManager.LocationID+")"),h.e.IsEmpty(o.a.SessionManager.sWHEmpFilteredEmpSeqNos)||(s+="  AND a.NodeID IN ("+o.a.SessionManager.sWHEmpFilteredEmpSeqNos+")"),this.Employee.Code.CustomWhere=this.Employee.Name.CustomWhere=s,Logger.InfoLog("ITDeclarationsViewModel::Exiting FilterEmployees()")}catch(a){Logger.ErrorLog("ITDeclarationsViewModel::EXCEPTION FilterEmployees()"+a.stack)}}},{key:"OnAddAttachment",value:function(){Logger.InfoLog("AddProductViewModel::Entering AddAttachment");var e="";null!=this.Attachment&&(e=this.Attachment.ColID);var t=null;null!=this.Attachment&&(t=this.Attachment.RowID),this.Attachment=new q.AddAttachmentViewModel,this.Attachment.AddAttachmentViewModel_2(this),""==e?(this.Attachment.ColID="",this.Attachment.RowID=null):(this.Attachment.ColID=e,this.Attachment.RowID=t),Logger.InfoLog("AddProductViewModel::Entering AddAttachment")}},{key:"OnClickAttachment",value:function(e){this.AttachmentVisibility=!0}},{key:"CCID",get:function(){return this.CostCenterID},set:function(e){this.CostCenterID=e}},{key:"dtPayrollTaxCmpts",get:function(){return this.dtPayrollTaxCmptsObj.Table}},{key:"PayrollColumnSourceTaxComponents",get:function(){return this.dtPayrollTaxCmptsObj.Columns}}]),s}(C.b),te=s("Gc3p"),se=function(e){_inherits(s,e);var t=_createSuper(s);function s(){var e;return _classCallCheck(this,s),(e=t.apply(this,arguments)).CostCenterID=0,e.TypeID=0,e.Employee=new V.a(0),e.RepEmployee=new V.a(0),e.dtPayrollTaxCmptsObj=new c.a,e.Savereturnvalue=0,e.dsITComputation=null,e.sbComputationData="",e.sbValidation="",e}return _createClass(s,[{key:"IncomeTaxComputationViewModel",value:function(){Logger.InfoLog("ITComputationViewModel::Entering ITComputationViewModel"),this.objEmp=new z,this.EmpYear=new g.e(0),this.EmpYear.SelectionChangedCommand.Subscribe(this,"OnYearSelected");for(var e=2e3;e<2100;e++){var t=g.d.ComboBoxItems_2(e.toString(),e.toString());this.EmpYear.Items.push(t)}this.EmpYear.SelectedValue=new Date(o.a.SessionManager.PayrollMonth).ToString("yyyy"),this.Employee.Visible=!0,this.Employee.Code.TypeID=4,this.Employee.Name.TypeID=1,this.Employee.Code.Visible=this.Employee.Name.Visible=!1,this.Employee.Code.Column=0,this.Employee.Name.Column=1,this.Employee.Code.Visible=!0,this.Employee.Name.Visible=!0,this.Employee.Code.CCID=this.Employee.Name.CCID=50051,this.Employee.Code.Visible&&(this.Employee.Code.CCID=50051,this.Employee.Code.TypeID=4),this.Employee.Name.Visible&&(this.Employee.Name.CCID=50051,this.Employee.Name.TypeID=1),this.RepEmployee.Visible=!0,this.RepEmployee.Name.Visible=!0,this.RepEmployee.Name.CCID=50051,this.RepEmployee.Name.TypeID=1,this.FilterEmployees(),this.Employee.SelectionCallBack.Subscribe(this,"Employee_SelectedValueChanged"),this.dtPayrollTaxCmptsObj.Table=[],this.dtPayrollTaxCmptsObj.Columns=[],Logger.InfoLog("ITComputationViewModel::Exiting ITComputationViewModel")}},{key:"Employee_SelectedValueChanged",value:function(e){this.dsITComputation=o.a.empService.GetIncomeTaxCalcDetails(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue,o.a.SessionManager.AccountingFromMonth)}},{key:"lstResponsiblePerson_SelectedValueChanged",value:function(e){return o.a.common.GetDataSet("PAY070",this.RepEmployee.SelectedValue.toString())}},{key:"OnYearSelected",value:function(e){this.FilterEmployees(),this.dsITComputation=o.a.empService.GetIncomeTaxCalcDetails(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue,o.a.SessionManager.AccountingFromMonth)}},{key:"OnSaveITComputation",value:function(e){var t=this;try{Logger.InfoLog("ITComputationViewModel::Entering OnSaveITComputation()"),this.sbValidation?this.DisplayMessage=this.sbValidation.toString():o.a.empService.SaveEmpTaxComputation(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue,this.sbComputationData.toString()).subscribe((function(e){t.DisplayMessage=e.Message,t.Savereturnvalue=e.RetValue}))}catch(s){Logger.ErrorLog("ITComputationViewModel::EXCEPTION OnSaveITComputation()"+s.stack)}}},{key:"OnDeleteITComputation",value:function(e){var t=this;try{this.sbValidation?this.DisplayMessage=this.sbValidation.toString():o.a.empService.DeleteEmpTaxComputation(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue).subscribe((function(e){t.DisplayMessage=e.Message,t.Savereturnvalue=e.RetValue}))}catch(s){Logger.ErrorLog("ITComputationViewModel::EXCEPTION OnDeleteITComputation()"+s.stack)}}},{key:"FilterEmployees",value:function(){try{Logger.InfoLog("ITComputationViewModel::Entering FilterEmployees()");var e,t,s="";e=new Date(parseInt(this.EmpYear.SelectedValue),o.a.SessionManager.AccountingFromMonth-1,1),t=(t=new Date(o.a.SessionManager.AccountingFromMonth>1?parseInt(this.EmpYear.SelectedValue)+1:parseInt(this.EmpYear.SelectedValue),o.a.SessionManager.AccountingToMonth-1,1)).AddMonths(1).AddDays(-1),s=(s=(s=" ( a.StatusID=250 AND (ISNULL(CONVERT(DATETIME,a.DORelieve),'01-Jan-9000')='01-Jan-9000') ")+" or (Year(CONVERT(DATETIME,'"+t.ToString("dd/MMM/yyyy")+"'))<=Year(CONVERT(DATETIME,a.DORelieve)) and CONVERT(DATETIME,'"+e.ToString("dd/MMM/yyyy")+"')<=CONVERT(DATETIME,a.DORelieve)) ")+" or ( CONVERT(DATETIME,'"+e.ToString("dd/MMM/yyyy")+"')<=CONVERT(DATETIME,a.DORelieve))) ",o.a.SessionManager.LocationID>0&&o.a.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&o.a.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(s=s+" AND a.NodeID IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+o.a.SessionManager.LocationID+")"),h.e.IsEmpty(o.a.SessionManager.sWHEmpFilteredEmpSeqNos)||(s+="  AND a.NodeID IN ("+o.a.SessionManager.sWHEmpFilteredEmpSeqNos+")"),this.Employee.Code.CustomWhere=this.Employee.Name.CustomWhere=this.RepEmployee.Name.CustomWhere=s,Logger.InfoLog("ITComputationViewModel::Exiting FilterEmployees()")}catch(a){Logger.ErrorLog("ITComputationViewModel::EXCEPTION FilterEmployees()"+a.stack)}}},{key:"CCID",get:function(){return this.CostCenterID},set:function(e){this.CostCenterID=e}},{key:"dtPayrollTaxCmpts",get:function(){return this.dtPayrollTaxCmptsObj.Table}},{key:"PayrollColumnSourceTaxComponents",get:function(){return this.dtPayrollTaxCmptsObj.Columns}}]),s}(C.b),ae=s("eBJM"),ie=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"LoadPayrollScreen",value:function(e,t){if(50054==e.FeatureID);else if(256==e.FeatureID){var s=new i.SetPayrollDateViewModel;o.a.page.ShowDialog(s,l.SetPayrollDateComponent,{ShowCenter:!0,Title:o.a.GetResource("Pay_SetPayrollDate")})}else if(258==e.FeatureID){var h=o.a.page.tabs.find((function(e){var t;return(null===(t=e.params)||void 0===t?void 0:t.obj)instanceof x}));if(h)o.a.page.SetActiveTab(h);else{var p=new x(t);p.DisplayName=t,o.a.page.addNewTab({title:e.ScreenName,component:F.a,params:{obj:p}})}}else if(260==e.FeatureID){var m=o.a.page.tabs.find((function(e){var t;return(null===(t=e.params)||void 0===t?void 0:t.obj)instanceof f}));if(m)o.a.page.SetActiveTab(m);else{var c=new f(t);c.DisplayName=t,o.a.page.addNewTab({title:e.ScreenName,component:d.a,params:{obj:c}})}}else if(261==e.FeatureID){var C=o.a.page.tabs.find((function(e){var t;return(null===(t=e.params)||void 0===t?void 0:t.obj)instanceof j.a}));if(C)o.a.page.SetActiveTab(C);else{var u=new j.a(t);u.DisplayName=t,o.a.page.addNewTab({title:e.ScreenName,component:W.a,params:{obj:u}})}}else if(262==e.FeatureID){var y=o.a.page.tabs.find((function(e){var t;return(null===(t=e.params)||void 0===t?void 0:t.obj)instanceof ee}));if(y)o.a.page.SetActiveTab(y);else{var g=new ee;g.Title=g.DisplayName=t,o.a.page.addNewTab({title:e.ScreenName,component:te.a,params:{obj:g}})}}else if(263==e.FeatureID);else if(264==e.FeatureID){var M=o.a.page.tabs.find((function(e){var t;return(null===(t=e.params)||void 0===t?void 0:t.obj)instanceof se}));if(M)o.a.page.SetActiveTab(M);else{var P=new se;P.Title=P.DisplayName=t,o.a.page.addNewTab({title:e.ScreenName,component:ae.a,params:{obj:P}})}}else if(40095==e.FeatureID){var D=o.a.page.tabs.find((function(e){var t;return(null===(t=e.params)||void 0===t?void 0:t.obj)instanceof J}));if(D)o.a.page.SetActiveTab(D);else{var E=new J(t);E.DisplayName=t,o.a.page.addNewTab({title:e.ScreenName,component:B.a,params:{obj:E}})}}else if(141==e.FeatureID);else if(266==e.FeatureID){var I=o.a.page.tabs.find((function(e){var t;return(null===(t=e.params)||void 0===t?void 0:t.obj)instanceof G}));if(I)o.a.page.SetActiveTab(I);else{var S=new G(t);S.DisplayName=t,o.a.page.addNewTab({title:e.ScreenName,component:R.a,params:{obj:S}})}}else if(267==e.FeatureID);else if(40054==e.FeatureID){var T=o.a.page.tabs.find((function(e){var t;return(null===(t=e.params)||void 0===t?void 0:t.obj)instanceof n.MonthlyPayrollViewModel}));if(T)o.a.page.SetActiveTab(T);else{var L=new n.MonthlyPayrollViewModel(e.ScreenName,"");L.DisplayName=t,o.a.page.addNewTab({title:e.ScreenName,component:r.MonthlyPayrollComponent,params:{obj:L}})}}else if(40088==e.FeatureID);else switch(e.FeatureActionID.toString()){case"4101":return{component:a.TreeViewPageComponent,params:{ScreenName:e.ScreenName,FeatureActionID:e.FeatureActionID,CostCenterID:e.FeatureID,Call:"C3"},basedon:"CostCenterID"}}}},{key:"LoadMonthlyPayrolByVoucherNo",value:function(e,t){return new n.MonthlyPayrollViewModel(e,"",t)}},{key:"LoadFinalSettlementByVoucherNo",value:function(e,t){return new J(e,t)}}]),e}()}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{LSMh:function(e,t,s){"use strict";s.r(t),s.d(t,"CopyProductViewModel",(function(){return P}));var a=s("Do2H"),n=s("Lp6j"),l=s("ScVY"),i=s("n56n"),o=s("0/4Q"),r=s("wlFP"),u=s("4HhE"),h=s("EQd/"),c=s("JIg3"),D=s("jgdN"),C=s("MCLT"),m=s("3Pt+");class P extends l.b{constructor(e){super(),this.Product=new i.b(0),this.Reports=new o.e(0),this.Fields=[],this.lstCols=null,this.form=new m.j({});let t=0,s=0;this.Reports.Visible=!1;let n=null;if("AddProductScreenViewModel"==e.ClassName){this.Parent=e;let l=a.a.report.GetReportData(11,parseInt(a.a.SessionManager.UserID),null);l.Tables[0].length>0&&(this.Reports.Visible=!0,l.Tables[0].forEach(e=>{this.Reports.Items.push(o.d.ComboBoxItems_3(e.ReportName.toString(),e.ReportID.toString(),e.ReportDefnXML.toString()))}),this.Reports.SelectedValue=this.Reports.Items[0].Value),a.a.SessionManager.PersonalSettings.ContainsKey("InvPrdCopyTabs")&&(n=a.a.SessionManager.PersonalSettings.InvPrdCopyTabs.split(",")),this.Reports.Visible||(this.oPactCheck=new r.a(-1),this.oPactCheck.CheckedChangedCommand.Subscribe(this,"OnCheckedChangedCommand"),this.oPactCheck.Label="Product Fields",this.oPactCheck.Row=t,this.oPactCheck.Column=s,this.oPactCheck.FeatureID=0,3==s?(t+=1,s=0):s+=1,(null==n||n.Contains("-1"))&&(this.oPactCheck.IsChecked=!0),this.Fields.push(this.oPactCheck));for(let e=0;e<this.Parent.ScreenObject.CustomTab.Pages.length;e++){const l=this.Parent.ScreenObject.CustomTab.Pages[e];if(l.Visible&&551!=l.DBColumnID){let e=[551,552,553,554,555,558,559,567,607,989];if(this.Reports.Visible&&!e.Contains(l.DBColumnID)&&0==l.QuickViewCCID&&"Vehicles"!=l.Name&&"Link"!=l.Name)continue;this.oPactCheck=new r.a(l.DBColumnID),this.oPactCheck.CheckedChangedCommand.Subscribe(this,"OnCheckedChangedCommand"),this.oPactCheck.Label="Purchase Details"==l.Name?a.a.GetResource("PurchaseDetails"):"Depreciation"==l.Name?a.a.GetResource("Depreciation"):"Notes"==l.Name?a.a.GetResource("CPNotes"):"Attachments"==l.Name?a.a.GetResource("CPAttachments"):"General"==l.Name?a.a.GetResource("CPGeneral"):"FA Accounts"==l.Name?a.a.GetResource("CPFAAccounts"):l.Name,this.oPactCheck.Row=t,this.oPactCheck.Column=s,this.oPactCheck.FeatureID=l.QuickViewCCID,3==s?(t+=1,s=0):s+=1,(null==n||n.Contains(l.DBColumnID.toString()))&&(this.oPactCheck.IsChecked=!0),this.Fields.push(this.oPactCheck)}}this.Product.CCID=3,this.Product.Label=a.a.GetResource("CopyProduct"),this.Product.TypeID=105}else{this.AssetParent=e,a.a.SessionManager.PersonalSettings.ContainsKey("AccAssCopyTabs")&&(n=a.a.SessionManager.PersonalSettings.AccAssCopyTabs.split(","));for(let e=0;e<this.AssetParent.ScreenObject.CustomTab.Pages.length;e++){const l=this.AssetParent.ScreenObject.CustomTab.Pages[e];624!=l.DBColumnID&&625!=l.DBColumnID&&626!=l.DBColumnID&&986!=l.DBColumnID&&l.Visible&&(this.oPactCheck=new r.a(l.DBColumnID),this.oPactCheck.CheckedChangedCommand.Subscribe(this,"OnCheckedChangedCommand"),this.oPactCheck.Label="Purchase Details"==l.Name?a.a.GetResource("PurchaseDetails"):"Depreciation"==l.Name?a.a.GetResource("Depreciation"):"Notes"==l.Name?a.a.GetResource("CPNotes"):"Attachments"==l.Name?a.a.GetResource("CPAttachments"):"General"==l.Name?a.a.GetResource("CPGeneral"):"FA Accounts"==l.Name?a.a.GetResource("CPFAAccounts"):l.Name,this.oPactCheck.Row=t,this.oPactCheck.Column=s,3==s?(t+=1,s=0):s+=1,(null==n||n.Contains(l.DBColumnID.toString()))&&(this.oPactCheck.IsChecked=!0),this.Fields.push(this.oPactCheck))}this.Product.CCID=72,this.Product.Label=a.a.GetResource("CopyAsset"),this.Product.TypeID=1}}CopyProductViewModel_1(){}OnCheckedChangedCommand(e){let t="";for(let s=0;s<this.Fields.length;s++){const e=this.Fields[s];e.IsChecked&&(t.length>0&&(t+=","),t+=e.DBColumnID.toString())}null!=this.Parent?n.e.SetPersonalize("InvPrdCopyTabs",t):null!=this.AssetParent&&n.e.SetPersonalize("AccAssCopyTabs",t)}OnSearch(e){"OK"==e.toString()?0==this.Product.SelectedValue?(null!=this.Parent?this.DisplayMessage=a.a.GetResource("CopyProductSelection"):null!=this.AssetParent&&(this.DisplayMessage="Please select a Asset"),this.MessageVisibility=!0):(null!=this.Parent?(this.Parent.DialogResult=!0,this.SelectProduct(this.Product.SelectedValue)):null!=this.AssetParent&&(this.AssetParent.DialogResult=!0,this.SelectAsset(this.Product.SelectedValue)),a.a.page.HideDialog()):"Cancel"==e.toString()&&(null!=this.Parent?this.Parent.DialogResult=!1:null!=this.AssetParent&&(this.AssetParent.DialogResult=!1),a.a.page.HideDialog())}SelectProduct(e){let t=a.a.inventory.GetCopyProductDetails(e),s=t.Tables[1],l=t.Tables[7];if(this.Reports.Visible){this.lstCols=[];let e=new n.f;e.LoadXml(this.Reports.GetselectedItem().Parent),e.SelectNodes("PactRevenURpts/PactRevenURptDef/Columns/ColumnDef/Identity/Field").forEach(e=>{n.e.IsEmpty(e.InnerText)||this.lstCols.Contains(parseInt(e.InnerText))||0==parseInt(e.InnerText)||this.lstCols.push(parseInt(e.InnerText))}),t.Tables.length>0&&t.Tables[0].length>0&&(this.Parent.ProductCode.Enable&&(null==this.lstCols||this.lstCols.Contains(this.Parent.ProductCode.DBColumnID))&&(this.Parent.ProductCode.Text=n.e.String(t.Tables[0][0].ProductCode)),this.Parent.ProductName.Enable&&(null==this.lstCols||this.lstCols.Contains(this.Parent.ProductName.DBColumnID))&&(this.Parent.ProductName.Text=n.e.String(t.Tables[0][0].ProductName)),(null==this.lstCols||this.lstCols.Contains(this.Parent.AliasName.DBColumnID))&&(this.Parent.AliasName.Text=n.e.String(t.Tables[0][0].AliasName)),(null==this.lstCols||this.lstCols.Contains(this.Parent.ProductTypes.DBColumnID))&&(this.Parent.ProductTypes.SelectedValue=n.e.String(t.Tables[0][0].ProductTypeID)),(null==this.lstCols||this.lstCols.Contains(this.Parent.ProductStatuses.DBColumnID))&&(this.Parent.ProductStatuses.SelectedValue=n.e.String(t.Tables[0][0].StatusID)),(null==this.lstCols||this.lstCols.Contains(this.Parent.ProductGroups.DBColumnID))&&(this.Parent.ProductGroups.SelectedValue=parseInt(n.e.String(t.Tables[0][0].ParentID))),(null==this.lstCols||this.lstCols.Contains(this.Parent.ValuationMethods.DBColumnID))&&(this.Parent.ValuationMethods.SelectedValue=n.e.String(t.Tables[0][0].ValuationID)),(null==this.lstCols||this.lstCols.Contains(this.Parent.QtyAdjustment.DBColumnID))&&(this.Parent.QtyAdjustment.SelectedValue=n.e.String(t.Tables[0][0].QtyAdjustType)),(null==this.lstCols||this.lstCols.Contains(this.Parent.BinWise.DBColumnID))&&(this.Parent.BinWise.SelectedValue=parseInt(n.e.String(t.Tables[0][0].BinWise)).toString()),(null==this.lstCols||this.lstCols.Contains(this.Parent.Description.DBColumnID))&&(this.Parent.Description.Text=n.e.String(t.Tables[0][0].Description)))}this.Fields.forEach(e=>{if(e.IsChecked)if(-1==e.DBColumnID)t.Tables.length>0&&t.Tables[0].length>0&&(this.Parent.ProductCode.Enable&&(this.Parent.ProductCode.Text=t.Tables[0][0].ProductCode.toString()),this.Parent.ProductName.Enable&&(this.Parent.ProductName.Text=t.Tables[0][0].ProductName.toString()),this.Parent.AliasName.Text=t.Tables[0][0].AliasName.toString(),this.Parent.ProductTypes.SelectedValue=t.Tables[0][0].ProductTypeID.toString(),this.Parent.ProductStatuses.SelectedValue=t.Tables[0][0].StatusID.toString(),this.Parent.ProductGroups.SelectedValue=parseInt(t.Tables[0][0].ParentID.toString()),this.Parent.ValuationMethods.SelectedValue=t.Tables[0][0].ValuationID.toString(),this.Parent.QtyAdjustment.SelectedValue=t.Tables[0][0].QtyAdjustType.toString(),this.Parent.BinWise.SelectedValue=parseInt(t.Tables[0][0].BinWise).toString(),this.Parent.Description.Text=t.Tables[0][0].Description.toString(),this.Parent.PurchaseRate.Text=t.Tables[0][0].PurchaseRate.toString(),this.Parent.SellingRate.Text=t.Tables[0][0].SellingRate.toString(),this.Parent.UOM.SelectedValue=t.Tables[0][0].UOMID.toString());else if(554==e.DBColumnID)this.Parent.ViewNotes.LoadNotes(t.Tables[3]);else if(555==e.DBColumnID)this.Parent.ViewAttachments.LoadAttachments(t.Tables[4]),this.Parent.ViewAttachments.LoadAttachmentsCopy();else if(989==e.DBColumnID)t.Tables.length>17&&this.Parent.ViewBins.LoadBins(t.Tables[17]);else if(558==e.DBColumnID)this.Parent.ViewSubstitutes.LoadSubstitutes(t.Tables[5]);else if(559==e.DBColumnID)this.Parent.ViewVendors.LoadVendors(t.Tables[6]),this.Parent.ViewVendors.LoadVendorsCopy();else if(553==e.DBColumnID)this.Parent.ProductKit.LoadBundels(t.Tables[8]);else if("Link"==e.Label);else if(552==e.DBColumnID)this.Parent.ProductSerialization.LoadSerialization(t.Tables[9]);else if(551==e.DBColumnID)this.Parent.ProductAttributes.LoadAttributes(t.Tables[0],!0),this.Parent.ProductAttributes.LoadSubItems(t.Tables[10]);else if(607==e.DBColumnID);else{let a=this.Parent.ScreenObject.CustomTab.Pages.find(t=>t.DBColumnID==e.DBColumnID);null!=a&&null!=a&&(this.LoadExtraFieldsData(a,s,l),this.LoadStaticFieldsTabData(a,t.Tables[0],550==e.DBColumnID&&t.Tables.length>13?t.Tables[13]:null)),e.FeatureID>0&&(this.Parent.LoadQuickAssign(t.Tables[11],e.DBColumnID),t.Tables[11].filter(t=>t.CostCenterId=="'"+e.FeatureID+"'").forEach(e=>{t.Tables[11].Remove(e)}))}}),this.Reports.Visible&&this.Parent.ScreenObject.CustomTab.Pages.forEach(e=>{null==this.Fields.find(t=>t.DBColumnID==e.DBColumnID)&&(this.LoadExtraFieldsData(e,s,l),this.LoadStaticFieldsTabData(e,t.Tables[0],550==e.DBColumnID&&t.Tables.length>13?t.Tables[13]:null))}),this.Parent.isCopy=!1}SelectAsset(e){let t=a.a.inventory.GetAssetManagementDetails(parseInt(e)),s=t.Tables[16],l=t.Tables[17];if(t.Tables.length>3&&t.Tables[4].length>0){if(n.e.IsEmpty(t.Tables[4][0].AssetCode)||(this.AssetParent.Code.Text=t.Tables[4][0].AssetCode.toString()),n.e.IsEmpty(t.Tables[4][0].AssetName)||(this.AssetParent.Name.Text=t.Tables[4][0].AssetName.toString()),n.e.IsEmpty(t.Tables[4][0].StatusID)||(this.AssetParent.Status.SelectedValue=t.Tables[4][0].StatusID.toString()),n.e.IsEmpty(t.Tables[4][0].Description)||(this.AssetParent.Description.Text=t.Tables[4][0].Description.toString()),n.e.IsEmpty(t.Tables[4][0].SerialNo)||(this.AssetParent.Sno.Text=t.Tables[4][0].SerialNo.toString()),n.e.IsEmpty(t.Tables[4][0].ParentID)||(this.AssetParent.ParentAsset.SelectedValue=parseInt(t.Tables[4][0].ParentID.toString()),this.AssetParent.ParentID=parseInt(t.Tables[4][0].ParentID.toString())),parseInt(t.Tables[4][0].DeprBookID)>0?(this.AssetParent.ViewDeprTab.Book.SelectedValue=t.Tables[4][0].DeprBookID.toString(),this.AssetParent.ViewDeprTab.EnableControls(!1)):(this.AssetParent.ViewDeprTab.Book.SelectedValue=null,this.AssetParent.ViewDeprTab.EnableControls(!0)),this.AssetParent.DeprSchedule.SelectedValue=t.Tables[4][0].IsDeprSchedule.toString(),this.AssetParent.DeprAvgMethod.SelectedValue=t.Tables[4][0].AveragingMethod.toString(),this.AssetParent.DeprMethod.SelectedValue=t.Tables[4][0].DepreciationMethod.toString(),this.AssetParent.DeprPeriod.SelectedValue=t.Tables[4][0].Period.toString(),n.e.IsEmpty(t.Tables[4][0].DeprStartDate)||(this.AssetParent.DepSDate=new Date(t.Tables[4][0].DeprStartDate).ToString("dd/MMM/yyyy")),n.e.IsEmpty(t.Tables[4][0].DeprEndDate)||(this.AssetParent.DepEDate=new Date(t.Tables[4][0].DeprEndDate).ToString("dd/MMM/yyyy")),this.AssetParent.SalValue=n.e.String(t.Tables[4][0].SalvageValue),this.AssetParent.EstLife=n.e.String(t.Tables[4][0].EstimateLife),!n.e.IsEmpty(t.Tables[4][0].DeprBookGroupID)){let e=t.Tables[4][0].DeprBookGroupID.toString().split(",");for(let t=0;t<e.length;t++)for(let s=0;s<this.AssetParent.DepreciationBooks.Items.length;s++)if(this.AssetParent.DepreciationBooks.Items[s].Value==e[t]){this.AssetParent.DepreciationBooks.Items[s].IsChecked=!0;break}}n.e.IsEmpty(t.Tables[4][0].ClassID)||(this.AssetParent.Class.SelectedValue=t.Tables[4][0].ClassID.toString()),this.AssetParent.FAGroup.SelectedValue=null!=t.Tables[4][0].PostingGroupID?parseInt(t.Tables[4][0].PostingGroupID):0,this.AssetParent.DeprBook.SelectedValue=t.Tables[4][0].DeprBookID.toString(),n.e.IsEmpty(t.Tables[4][0].LocationID)||this.AssetParent.Location.SetValue(parseInt(t.Tables[4][0].LocationID)),n.e.IsEmpty(t.Tables[4][0].EmployeeID)||this.AssetParent.Employee.SetValue(parseInt(t.Tables[4][0].EmployeeID)),this.AssetParent.LoadTabFields(t.Tables[4])}this.Fields.forEach(e=>{e.IsChecked&&(623==e.DBColumnID&&this.AssetParent.LoadTabFields(t.Tables[4]),627==e.DBColumnID?this.AssetParent.ViewNotes.LoadNotes(t.Tables[14]):628==e.DBColumnID?(this.AssetParent.ViewAttachments.LoadAttachments(t.Tables[15]),this.AssetParent.ViewAttachments.LoadAttachmentsCopy()):this.AssetParent.ScreenObject.CustomTab.Pages.forEach(t=>{e.DBColumnID!=t.DBColumnID||this.LoadExtraFieldsData(t,s,l)}))})}LoadExtraFieldsData(e,t,s){let a;for(let l=0;l<e.Fields.length;l++){const r=e.Fields[l];if(a=r instanceof u.c?r:null,null==a||!this.Reports.Visible||null==this.lstCols||this.lstCols.Contains(a.DBColumnID))if(null!=a&&null!=a.DBColumnName&&null!=t[0][a.DBColumnName]&&a.DBColumnName.toLowerCase().Contains("alpha")){if(r instanceof h.d)r.Text=n.e.String(t[0][a.DBColumnName]);else if(r instanceof o.e)r.SelectedValue=n.e.String(t[0][a.DBColumnName]);else if(r instanceof h.c)r.Text=n.e.String(t[0][a.DBColumnName]);else if(r instanceof c.c){let e;!n.e.IsEmpty(t[0][a.DBColumnName])&&n.e.isValidDate(t[0][a.DBColumnName].toString())&&(r.Date=new Date(e))}else if(r instanceof c.b){let e;!n.e.IsEmpty(t[0][a.DBColumnName])&&n.e.isValidDate(t[0][a.DBColumnName].toString())&&(r.Date=new Date(e))}else if(r instanceof c.a){let e;!n.e.IsEmpty(t[0][a.DBColumnName])&&n.e.isValidDate(t[0][a.DBColumnName].toString())&&(r.Date=new Date(e))}else if(r instanceof D.a)r.Text=n.e.String(t[0][a.DBColumnName]);else if(r instanceof i.b){let e=0;e=n.e.IntTryParse(parseInt(t[0][a.DBColumnName])),r.SelectedValue=e}else if(r instanceof i.a){let e;e=n.e.IntTryParse(parseInt(t[0][a.DBColumnName])),r.SetValue(e)}}else r instanceof i.b&&!n.e.IsEmpty(r.DBColumnName)&&!n.e.IsEmpty(s[0][r.DBColumnName])?null!=this.Parent?(r.SelectedValue=50006==r.CCID&&this.Parent.Category.SelectedValue>1&&1==parseInt(s[0][r.DBColumnName].toString())?this.Parent.Category.SelectedValue:50004==r.CCID&&this.Parent.Department.SelectedValue>1&&1==parseInt(s[0][r.DBColumnName].toString())?this.Parent.Department.SelectedValue:parseInt(n.e.String(s[0][r.DBColumnName])),null!=this.Parent.Linkedcc&&this.Parent.Linkedcc.CCID==r.CCID&&this.Parent.OnlinkccChanged(r),r.SelectedValue=parseInt(n.e.String(s[0][r.DBColumnName]))):null!=this.AssetParent&&(r.SelectedValue=parseInt(n.e.String(s[0][r.DBColumnName]))):r instanceof i.a&&!n.e.IsEmpty(r.DBColumnName)&&!n.e.IsEmpty(s[0][r.DBColumnName])&&(null!=this.Parent?(50006==r.CCID&&this.Parent.Category.SelectedValue>1&&1==parseInt(s[0][r.DBColumnName].toString())?r.SelectedValue=this.Parent.Category.SelectedValue:50004==r.CCID&&this.Parent.Department.SelectedValue>1&&1==parseInt(s[0][r.DBColumnName].toString())?r.SetValue(this.Parent.Department.SelectedValue):r.SelectedValue=parseInt(n.e.String(s[0][r.DBColumnName])),null!=this.Parent.Linkedcc&&this.Parent.Linkedcc.CCID==r.CCID&&this.Parent.OnlinkccChanged(r),r.SetValue(parseInt(n.e.String(s[0][r.DBColumnName])))):null!=this.AssetParent&&r.SetValue(parseInt(n.e.String(s[0][r.DBColumnName]))))}}LoadStaticFieldsTabData(e,t,s){let a;for(let l=0;l<e.Fields.length;l++){const r=e.Fields[l];if(a=r instanceof u.c?r:null,(null==a||!this.Reports.Visible||null==this.lstCols||this.lstCols.Contains(a.DBColumnID))&&null!=a&&null!=a.DBColumnName&&null!=t[0][a.DBColumnName])if(r instanceof h.d)r.Text=n.e.String(t[0][a.DBColumnName]);else if(r instanceof o.e){if(Object(C.isBoolean)(t[0][a.DBColumnName])){let e=0;e=n.e.IntTryParse(r.Items[0].Value),r.SelectedValue=e>0?parseInt(t[0][a.DBColumnName]).toString():t[0][a.DBColumnName].toString()}else r.SelectedValue=t[0][a.DBColumnName].toString();a.DBColumnID==this.Parent.ManufacturerBarcode.DBColumnID?"True"==t[0][a.DBColumnName].toString()&&(r.SelectedValue="1"):a.DBColumnID==this.Parent.UOM.DBColumnID&&null!=s&&(this.Parent.dtProductWise=s,this.Parent.LoadUnitsProductWise(s))}else if(r instanceof h.c)r.Text=n.e.String(t[0][a.DBColumnName]);else if(r instanceof i.b)null!=t[0][a.DBColumnName]&&(r.SelectedValue=parseInt(t[0][a.DBColumnName])),null!=this.Parent.Linkedcc&&(50006==this.Parent.Linkedcc.CCID&&a.DBColumnID==this.Parent.Category.DBColumnID?this.Parent.OnlinkccChanged(this.Parent.Category):50004==this.Parent.Linkedcc.CCID&&a.DBColumnID==this.Parent.Department.DBColumnID&&this.Parent.OnlinkccChanged(this.Parent.Department));else if(r instanceof i.a)null!=t[0][a.DBColumnName]&&r.SetValue(parseInt(t[0][a.DBColumnName])),null!=this.Parent.Linkedcc&&(50006==this.Parent.Linkedcc.CCID&&a.DBColumnID==this.Parent.Category.DBColumnID?this.Parent.OnlinkccChanged(this.Parent.Category):50004==this.Parent.Linkedcc.CCID&&a.DBColumnID==this.Parent.Department.DBColumnID&&this.Parent.OnlinkccChanged(this.Parent.Department));else if(r instanceof c.c){let e;!n.e.IsEmpty(t[0][a.DBColumnName])&&n.e.isValidDate(t[0][a.DBColumnName].toString())&&(r.Date=new Date(e))}else if(r instanceof c.b){let e;!n.e.IsEmpty(t[0][a.DBColumnName])&&n.e.isValidDate(t[0][a.DBColumnName].toString())&&(r.Date=new Date(e))}else if(r instanceof c.a){let e;!n.e.IsEmpty(t[0][a.DBColumnName])&&n.e.isValidDate(t[0][a.DBColumnName].toString())&&(r.Date=new Date(e))}else r instanceof D.a&&(r.Text=n.e.String(t[0][a.DBColumnName]))}}}}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[10,73,214],{"/EUh":function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var n=s("Do2H");class i{static GetEmailSMS(e,t,s){try{let i=[];return i.push(e),i.push(t),i.push(s),i.push(n.a.SessionManager.RoleID),i.push(n.a.SessionManager.UserID),i.push(n.a.SessionManager.LanguageID),n.a.report.GetEmailSMS(i)}catch(i){return Logger.ErrorLog("Notifications:: GetEmailSMS"+i),null}}static GetScheduleEvents(e){let t=[];return t.push(e),t.push(n.a.SessionManager.RoleID),t.push(n.a.SessionManager.UserID),t.push(n.a.SessionManager.LanguageID),n.a.report.GetScheduleEvents(t)}static SetNotifEventTemp(e){return e.push(n.a.SessionManager.CompanyGUID),e.push("GUID"),e.push(n.a.SessionManager.UserName),e.push(n.a.SessionManager.UserID),e.push(n.a.SessionManager.LanguageID),n.a.report.SetNotifEventTemp(e)}}},"5FTv":function(e,t,s){"use strict";s.r(t),s.d(t,"VoucherExportExcel",(function(){return i}));var n=s("Do2H");class i{static GetPrintLayouts(e,t){let s=[];return s.push(e),s.push(t),s.push(0),s.push(parseInt(n.a.SessionManager.RoleID)),s.push(parseInt(n.a.SessionManager.UserID)),s.push(n.a.SessionManager.LanguageID),n.a.report.GetPrintLayout(s)}static GetPrintLayouts_1(e,t,s){let i=[];return i.push(e),i.push(t),i.push(s),i.push(null),i.push(n.a.SessionManager.RoleID),i.push(n.a.SessionManager.UserID),i.push(n.a.SessionManager.LanguageID),n.a.report.GetPrintLayouts(i)}static GetLocationPrintLayouts(e,t,s,i=1){let a=[];return a.push(i),a.push(e),a.push(t),a.push(n.a.SessionManager.LocationID),a.push(n.a.SessionManager.RoleID),a.push(n.a.SessionManager.UserID),a.push(s),a.push(n.a.SessionManager.LanguageID),n.a.report.GetPrintLayouts(a)}static GetLayoutTemplates(e,t,s){let i=[];return i.push(2),i.push(t),i.push(s),i.push(e),i.push(n.a.SessionManager.RoleID),i.push(n.a.SessionManager.UserID),i.push(n.a.SessionManager.LanguageID),n.a.report.GetPrintLayouts(i)}static AllowRePrint(e,t,s){let i=[];return i.push(3),i.push(e),i.push(t),i.push(s),i.push(n.a.SessionManager.RoleID),i.push(n.a.SessionManager.UserID),i.push(n.a.SessionManager.LanguageID),n.a.report.GetPrintLayouts(i)}}},"7i9q":function(e,t,s){"use strict";s.r(t),s.d(t,"SendEmailSMSComponent",(function(){return C}));var n=s("3Pt+"),i=s("fXoL");function a(e,t){if(1&e&&(i.Zb(0,"div",12),i.Wc(1,"\n                "),i.Vb(2,13),i.Wc(3,"\n            "),i.Yb()),2&e){const e=i.lc();i.Db(2),i.tc("obj",e.obj.Template)("group",e.form)}}function o(e,t){if(1&e&&(i.Zb(0,"div",12),i.Wc(1,"\n                "),i.Vb(2,13),i.Wc(3,"\n            "),i.Yb()),2&e){const e=i.lc();i.Db(2),i.tc("obj",e.obj.Location)("group",e.form)}}function l(e,t){if(1&e&&(i.Zb(0,"div",12),i.Wc(1,"\n                "),i.Vb(2,13),i.Wc(3,"\n            "),i.Yb()),2&e){const e=i.lc();i.Db(2),i.tc("obj",e.obj.Report)("group",e.form)}}function c(e,t){if(1&e&&(i.Zb(0,"div",14),i.Wc(1,"\n                "),i.Vb(2,13),i.Wc(3,"\n            "),i.Yb()),2&e){const e=i.lc();i.Db(2),i.tc("obj",e.obj.To)("group",e.form)}}function r(e,t){if(1&e&&(i.Zb(0,"div",14),i.Wc(1,"\n                "),i.Vb(2,13),i.Wc(3,"\n            "),i.Yb()),2&e){const e=i.lc();i.Db(2),i.tc("obj",e.obj.CC)("group",e.form)}}function h(e,t){if(1&e&&(i.Zb(0,"div",14),i.Wc(1,"\n                "),i.Vb(2,13),i.Wc(3,"\n            "),i.Yb()),2&e){const e=i.lc();i.Db(2),i.tc("obj",e.obj.BCC)("group",e.form)}}function m(e,t){if(1&e&&(i.Zb(0,"div",14),i.Wc(1,"\n                "),i.Vb(2,13),i.Wc(3,"\n            "),i.Yb()),2&e){const e=i.lc();i.Db(2),i.tc("obj",e.obj.Subject)("group",e.form)}}function u(e,t){if(1&e&&(i.Zb(0,"div",12),i.Wc(1,"\n                "),i.Vb(2,13),i.Wc(3,"\n            "),i.Yb()),2&e){const e=i.lc();i.Db(2),i.tc("obj",e.obj.AttachmentType)("group",e.form)}}function p(e,t){if(1&e&&(i.Zb(0,"div",12),i.Wc(1,"\n                "),i.Vb(2,13),i.Wc(3,"\n            "),i.Yb()),2&e){const e=i.lc();i.Db(2),i.tc("obj",e.obj.SendReportAs)("group",e.form)}}function b(e,t){if(1&e&&(i.Zb(0,"div",12),i.Wc(1,"\n                "),i.Vb(2,13),i.Wc(3,"\n            "),i.Yb()),2&e){const e=i.lc();i.Db(2),i.tc("obj",e.obj.Attachments)("group",e.form)}}function d(e,t){if(1&e&&(i.Zb(0,"div"),i.Wc(1,"\n                "),i.Vb(2,13),i.Wc(3,"\n            "),i.Yb()),2&e){const e=t.$implicit,s=i.lc();i.Db(2),i.tc("obj",e)("group",s.form)}}const g=function(){return{height:"300px"}};function S(e,t){if(1&e){const e=i.ac();i.Zb(0,"div",2),i.Wc(1,"\n            "),i.Zb(2,"div",14),i.Wc(3,"\n                "),i.Zb(4,"quill-editor",15,16),i.hc("ngModelChange",(function(t){return i.Ic(e),i.lc().obj.BodyDocument=t})),i.Yb(),i.Wc(6,"\n            "),i.Yb(),i.Wc(7,"\n        "),i.Yb()}if(2&e){const e=i.lc();i.Db(4),i.tc("styles",i.xc(2,g))("ngModel",e.obj.BodyDocument)}}function T(e,t){if(1&e&&(i.Zb(0,"div",2),i.Wc(1,"\n            "),i.Zb(2,"div",14),i.Wc(3,"\n                "),i.Vb(4,13),i.Wc(5,"\n            "),i.Yb(),i.Wc(6,"\n        "),i.Yb()),2&e){const e=i.lc();i.Db(4),i.tc("obj",e.obj.SMSBody)("group",e.form)}}let C=(()=>{class e{constructor(){}ngOnInit(){this.form=new n.j({})}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i.Nb({type:e,selectors:[["app-send-email-sms"]],inputs:{obj:"obj"},decls:70,vars:21,consts:[[1,"master-screen",2,"padding-bottom","4px"],[1,"PACTHeaderFields","dialogSubBody"],[1,"row","form-row"],["class","form-group col-xl-6 col-md-6 col-sm-12 col-xs-12 PACTControl",4,"ngIf"],["class","form-group col-xl-12 col-md-12 col-sm-12 col-xs-12 PACTControl",4,"ngIf"],[4,"ngFor","ngForOf"],["class","row form-row",4,"ngIf"],[1,"Pactdailogfooter"],[1,"primary-btn-wicon",3,"click"],[1,"fa-envelope","fa-light"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-rectangle-xmark"],[1,"form-group","col-xl-6","col-md-6","col-sm-12","col-xs-12","PACTControl"],["FieldDirective","",3,"obj","group"],[1,"form-group","col-xl-12","col-md-12","col-sm-12","col-xs-12","PACTControl"],[3,"styles","ngModel","ngModelChange"],["editor",""]],template:function(e,t){1&e&&(i.Zb(0,"div",0),i.Wc(1,"\n    "),i.Zb(2,"div",1),i.Wc(3,"\n        "),i.Zb(4,"div",2),i.Wc(5,"\n            "),i.Uc(6,a,4,2,"div",3),i.Wc(7,"\n            "),i.Uc(8,o,4,2,"div",3),i.Wc(9,"\n            \n            "),i.Uc(10,l,4,2,"div",3),i.Wc(11,"\n        "),i.Yb(),i.Wc(12,"\n\n        "),i.Zb(13,"div",2),i.Wc(14,"\n            "),i.Uc(15,c,4,2,"div",4),i.Wc(16,"\n        "),i.Yb(),i.Wc(17,"\n\n        "),i.Zb(18,"div",2),i.Wc(19,"\n            "),i.Uc(20,r,4,2,"div",4),i.Wc(21,"\n        "),i.Yb(),i.Wc(22,"\n\n        "),i.Zb(23,"div",2),i.Wc(24,"\n            "),i.Uc(25,h,4,2,"div",4),i.Wc(26,"\n        "),i.Yb(),i.Wc(27,"\n\n        \n        "),i.Zb(28,"div",2),i.Wc(29,"\n            "),i.Uc(30,m,4,2,"div",4),i.Wc(31,"\n        "),i.Yb(),i.Wc(32,"\n\n        "),i.Zb(33,"div",2),i.Wc(34,"\n            "),i.Uc(35,u,4,2,"div",3),i.Wc(36,"\n            "),i.Uc(37,p,4,2,"div",3),i.Wc(38,"\n            \n            "),i.Uc(39,b,4,2,"div",3),i.Wc(40,"            \n        "),i.Yb(),i.Wc(41,"\n\n        "),i.Zb(42,"div"),i.Wc(43,"\n            "),i.Uc(44,d,4,2,"div",5),i.Wc(45,"\n        "),i.Yb(),i.Wc(46,"\n\n        "),i.Uc(47,S,8,3,"div",6),i.Wc(48,"\n        \n        "),i.Uc(49,T,7,2,"div",6),i.Wc(50,"\n    "),i.Yb(),i.Wc(51,"\n    "),i.Zb(52,"div",7),i.Wc(53,"\n      "),i.Zb(54,"div"),i.Wc(55,"\n        "),i.Wc(56,"\n        "),i.Zb(57,"button",8),i.hc("click",(function(){return t.obj.OnButtonClick("Send")})),i.Ub(58,"i",9),i.Wc(59),i.mc(60,"translate"),i.Yb(),i.Wc(61,"\n        "),i.Zb(62,"button",10),i.hc("click",(function(){return t.obj.OnButtonClick("Cancel")})),i.Ub(63,"i",11),i.Wc(64),i.mc(65,"translate"),i.Yb(),i.Wc(66,"\n      "),i.Yb(),i.Wc(67,"\n  "),i.Yb(),i.Wc(68,"\n"),i.Yb(),i.Wc(69,"\n")),2&e&&(i.Sc("width",t.obj.IsMobile?"unset":"900px"),i.Db(6),i.tc("ngIf",t.obj.Template.Visible),i.Db(2),i.tc("ngIf",t.obj.Location.Visible),i.Db(2),i.tc("ngIf",t.obj.ReportVisible),i.Db(5),i.tc("ngIf",t.obj.To.Visible),i.Db(5),i.tc("ngIf",t.obj.CC.Visible),i.Db(5),i.tc("ngIf",t.obj.BCC.Visible),i.Db(5),i.tc("ngIf",t.obj.Subject.Visible),i.Db(5),i.tc("ngIf",t.obj.AttachmentType.Visible),i.Db(2),i.tc("ngIf",t.obj.SendReportAs.Visible),i.Db(2),i.tc("ngIf",t.obj.Attachments.Visible),i.Db(5),i.tc("ngForOf",t.obj.AttachmentList.Items),i.Db(3),i.tc("ngIf",t.obj.IsEmail),i.Db(2),i.tc("ngIf",t.obj.SMSBody.Visible),i.Db(10),i.Xc(i.nc(60,17,"Send")),i.Db(5),i.Xc(i.nc(65,19,"Cancel")))},encapsulation:2}),e})()},MQtK:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var n=s("fXoL");let i=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=n.Nb({type:e,selectors:[["app-email-add-attachment"]],inputs:{obj:"obj"},decls:29,vars:7,consts:[[1,"master-screen",2,"padding-bottom","4px"],[1,"PACTHeaderFields","dialogSubBody"],[1,"row","form-row"],[1,"form-group","col-xl-12","col-md-12","col-sm-12","col-xs-12","PACTControl"],["FieldDirective","",3,"obj"],[1,"Pactdailogfooter"],[1,"primary-btn-wicon",3,"click"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-rectangle-xmark"]],template:function(e,t){1&e&&(n.Zb(0,"div",0),n.Wc(1,"\n    "),n.Zb(2,"div",1),n.Wc(3,"\n        "),n.Zb(4,"div",2),n.Wc(5,"\n            "),n.Zb(6,"div",3),n.Wc(7,"\n                "),n.Vb(8,4),n.Wc(9,"\n            "),n.Yb(),n.Wc(10,"\n        "),n.Yb(),n.Wc(11,"\n    "),n.Yb(),n.Wc(12,"\n    "),n.Zb(13,"div",5),n.Wc(14,"\n      "),n.Zb(15,"div"),n.Wc(16,"\n        "),n.Zb(17,"button",6),n.hc("click",(function(){return t.obj.OnButtonClick("OK")})),n.Wc(18),n.mc(19,"translate"),n.Yb(),n.Wc(20,"\n        "),n.Zb(21,"button",7),n.hc("click",(function(){return t.obj.OnButtonClick("Cancel")})),n.Ub(22,"i",8),n.Wc(23),n.mc(24,"translate"),n.Yb(),n.Wc(25,"\n      "),n.Yb(),n.Wc(26,"\n  "),n.Yb(),n.Wc(27,"\n"),n.Yb(),n.Wc(28,"\n")),2&e&&(n.Db(8),n.tc("obj",t.obj.Attachments),n.Db(10),n.Xc(n.nc(19,3,"Com_OK")),n.Db(5),n.Xc(n.nc(24,5,"Cancel")))},encapsulation:2}),e})()},wnwj:function(e,t,s){"use strict";s.r(t),s.d(t,"SendEmailSMSViewModel",(function(){return g})),s.d(t,"EmailAddAttachmentViewModel",(function(){return S}));var n=s("mrSG"),i=s("Do2H"),a=s("Lp6j"),o=s("eQJW"),l=s("ScVY"),c=s("EQd/"),r=s("0/4Q"),h=s("c9yc"),m=s("wlFP"),u=s("5FTv"),p=s("/EUh"),b=s("4HhE"),d=s("MQtK");class g extends l.b{constructor(e,t,s,n){if(super(),this.retValue=0,this.To=new c.d(0),this.CC=new c.d(0),this.BCC=new c.d(0),this.AttachmentType=new r.e(0),this.Attachments=new r.e(0),this.Subject=new c.d(0),this.SMSBody=new c.c(0),this.SendReportAs=new r.e(0),this.IsEmail=!1,this.CostCenterID=0,this.NodeID=0,this.Parent=null,this.drTemplate=null,this.drTemplateColumns=null,this.ReportVisible=!1,this.EmailDisplayName="",Logger.InfoLog("SendEmailSMSViewModel::Entering Construcor"),this.IsEmail=e,this.CostCenterID=t,this.NodeID=s,this.Parent=n,this.Attachments.Label=i.a.GetResource("Com_Attachments"),this.SendReportAs.Visible=!1,this.IsWhatsApp=new m.a,this.IsWhatsApp.Label="WhatsApp",this.Template=new r.e,this.Template.Label="Template",this.AttachmentList=new h.a,this.To.Label=i.a.GetResource("Format_To"),this.CC.Label=i.a.GetResource("Vehicle_CC"),this.BCC.Label=i.a.GetResource("Format_BCC"),this.Subject.Label=i.a.GetResource("Format_Subject"),this.To.LblWidth=this.CC.LblWidth=this.BCC.LblWidth=this.Subject.LblWidth=this.SMSBody.LblWidth="150",this.AttachmentType.LblWidth=this.SendReportAs.LblWidth=this.Attachments.LblWidth=this.Template.LblWidth="150",this.Attachments.LblClick=new b.b,this.Attachments.LblClick.Subscribe(this,"OnButtonClick","AddAttachment"),this.To.LblClick=new b.b,this.To.LblClick.Subscribe(this,"OnButtonClick","ToClick"),50==t){this.Report=n,this.Template.Visible=!0,this.Template.SelectionChangedCommand.Subscribe(this,"OnTemplateChange"),this.SendReportAs.SelectionChangedCommand.Subscribe(this,"OnSendReportAsChange"),this.SendReportAs.Visible=!0,this.SendReportAs.Label="Send Report",this.SendReportAs.Items.push(r.d.ComboBoxItems_2("Whole","0")),this.SendReportAs.Items.push(r.d.ComboBoxItems_2("Line Wise","1")),this.SendReportAs.Items.push(r.d.ComboBoxItems_2("Group Wise","2")),this.SendReportAs.Items.push(r.d.ComboBoxItems_2("Level Wise","3")),this.SendReportAs.Items.push(r.d.ComboBoxItems_2("Selected Rows","4")),this.SendReportAs.SelectedValue="0";let i=p.a.GetEmailSMS(7,t,'<XML Type="'+(e?"1":"2")+'" ReportID="'+s+'"/>');e&&this.Template.Items.push(r.d.ComboBoxItems_2("","")),i.Tables[0].forEach(e=>{this.Template.Items.push(r.d.ComboBoxItems_2(e.TemplateName.toString(),e.TemplateID.toString()))}),this.Template.Items.length>0&&(this.Template.SelectedValue=this.Template.Items[0].Value,this.OnTemplateChange(null))}else if(t>0){this.Template.Visible=!0,this.Template.SelectionChangedCommand.Subscribe(this,"OnTemplateChange");let s=p.a.GetEmailSMS(6,t,e?"1":"2");this.Template.Items.push(r.d.ComboBoxItems_2("","")),s.Tables[0].forEach(e=>{this.Template.Items.push(r.d.ComboBoxItems_2(e.TemplateName.toString(),e.TemplateID.toString()))})}if(e?(this.SMSBody.Visible=!1,this.IsWhatsApp.Visible=!1):(this.CC.Visible=!1,this.BCC.Visible=!1,this.Subject.Visible=!1,this.AttachmentType.Visible=!1,this.Attachments.Visible=!1,this.SMSBody.Visible=!0,this.SMSBody.Label="Message",i.a.SessionManager.Preferences.ContainsKey("WhProvider")&&""!=i.a.SessionManager.Preferences.WhProvider||(this.IsWhatsApp.Visible=!1)),this.AttachmentType.Label=i.a.GetResource("Com_AttachmentType"),this.AttachmentType.Items.push(r.d.ComboBoxItems_2("","")),this.AttachmentType.Items.push(r.d.ComboBoxItems_2("PDF","PDF")),this.AttachmentType.Items.push(r.d.ComboBoxItems_2("Excel","Excel")),50==t&&this.AttachmentType.Items.push(r.d.ComboBoxItems_2("Excel (Open XML)","Excel(Open XML)")),this.AttachmentType.SelectedValue="PDF",95==t&&(this.To.Text=n.Obj.Email),e&&50!=t||(this.Attachments.Visible=!1),-999==t&&(this.Template.Visible=!1,this.Attachments.Visible=!1,this.AttachmentType.Visible=!1,i.a.SessionManager.Preferences.ContainsKey("ReportIssueEmail")&&(this.To.Text=i.a.SessionManager.Preferences.ReportIssueEmail),a.e.IsEmpty(i.a.SessionManager.CompanyName)||(this.Subject.Text="Issue @ "+i.a.SessionManager.CompanyName)),this.Attachments.Visible&&(this.Attachments.Items.push(r.d.ComboBoxItems_2("","0")),u.VoucherExportExcel.GetPrintLayouts_1(0,t,0).Tables[0].forEach(e=>{this.Attachments.Items.push(r.d.ComboBoxItems_2(e.Name.toString(),e.DocPrintLayoutID.toString())),Object(o.j)(e.IsDefault)&&(this.Attachments.SelectedValue=e.DocPrintLayoutID.toString())}),40054==t&&(this.Attachments.SelectedValue=n.drSelectedPrintLayout.DocPrintLayoutID.toString(),this.Attachments.Enable=!1)),this.Title=i.a.GetResource(e?"SMTP_Email":"SMTP_SMS"),this.DisplayName=this.Title,this.Location=new r.e,this.Location.Visible=!1,this.Location.LblWidth="130","TRUE"==i.a.SessionManager.Preferences.EnableLocationWise.toUpperCase()&&i.a.SessionManager.Preferences.ContainsKey("LWEmailSMS")&&"TRUE"==i.a.SessionManager.Preferences.LWEmailSMS.toUpperCase()){this.Location.Visible=!0,this.Location.Items.push(r.d.ComboBoxItems_2("","0"));let s=i.a.SessionManager.LocationWhere.split(","),n=p.a.GetEmailSMS(8,t,e?"1":"2");n.Tables[0].forEach(e=>{s.Contains(e.NodeID.toString())&&this.Location.Items.push(r.d.ComboBoxItems_2(e.Name.toString(),e.NodeID.toString()))}),i.a.SessionManager.LocationID>0&&n.Tables[0].filter(e=>e.NodeID==i.a.SessionManager.LocationID).length>0&&(this.Location.SelectedValue=i.a.SessionManager.LocationID.toString())}}CallFromLandingPage(){}OnTemplateChange(e){return Object(n.b)(this,void 0,void 0,(function*(){if(this.drTemplate=null,this.EmailDisplayName="",!a.e.IsEmpty(this.Template.SelectedValue)){let t=p.a.GetEmailSMS(2,parseInt(this.Template.SelectedValue),this.IsEmail?"1":"2");if(t.Tables[0].length>0){this.drTemplateColumns=t.Columns[0],this.drTemplate={};for(let e=0;e<t.Columns[0].length;e++)this.drTemplate[t.Columns[0][e]]=t.Tables[0][0][t.Columns[0][e]];this.To.Text=this.drTemplate.To.toString(),this.CC.Text=this.drTemplate.CC.toString(),this.BCC.Text=this.drTemplate.BCC.toString(),this.Attachments.SelectedValue=this.drTemplate.AttachmentID.toString(),this.IsEmail?this.Subject.Text=this.drTemplate.Subject.toString():this.IsWhatsApp.IsChecked="WhatsApp"==this.drTemplate.Subject.toString(),this.AttachmentType.SelectedValue=this.drTemplate.AttachmentType.toString(),this.SendReportAs.SelectedValue=this.drTemplate.SendReportAs.toString(),this.EmailDisplayName=this.drTemplate.DisplayName.toString();let s=this.drTemplate.Body.toString();if(this.IsEmail){if(s.startsWith("<FlowDocument")){try{if(s.startsWith("<FlowDocument")){let e="";s.Contains('xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"')&&(e='xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"'),s=s.Replace('xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"',"");let t=new a.f;t.LoadXml(s),""!=e&&(s=s.Replace("<FlowDocument ","<FlowDocument "+e+" "));let n=t.SelectNodes("FlowDocument/Paragraph/Floater/BlockUIContainer/Image");if(n.length>0){let e="",t="",i="",o="",l="",c="",r=null;for(let h=0;h<n.length;h++)i=n[h].attributes.Source.value,i=i.Replace("file:///",""),i=i.Replace("{x:Null}",""),""!=i&&(o=i,r=o.split("/"),r.length>0&&(e=r[r.length-1].toString(),o=t,l=n.Item(h).attributes.Source.Value,c=a.e.GetPath(e.toString()),s=s.Replace(l,c)))}}}catch(e){}let t=yield i.a.common.ConvertXamlToHtml(s.toString());this.BodyDocument=t.HtmlText}else if(""!=s){s='<FlowDocument xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"><Paragraph>'+s+"</Paragraph></FlowDocument >";let e=yield i.a.common.ConvertXamlToHtml(s.toString());this.BodyDocument=e.HtmlText}}else this.SMSBody.Text=s}}}))}OnSendReportAsChange(e){this.ReportVisible="4"==this.SendReportAs.SelectedValue}OnButtonClick(e){if(this.DisplayMessage="","Send"==e)this.Send();else if("Cancel"==e)this.HideDialg();else if("ToClick"==e){if(this.CostCenterID>4e4&&this.CostCenterID<5e4){let e=this.Parent;if(!e.IsInventoryVoucher)return;let t=null;if(t=e.IsPurchase?e.ScreenObject.CreditAccount:e.ScreenObject.DebitAccount,null!=t&&t.SelectedValue>0){let e=new S(this,"To");p.a.GetEmailSMS(9,t.SelectedValue,this.IsEmail?"1":"0").Tables[0].forEach(t=>{e.Attachments.Items.push(r.c.CheckedListBoxItem_2(t.ToAdd.toString(),t.ToAdd.toString()))}),i.a.page.ShowDialog(e,d.a,{ShowCenter:!0})}}}else if("AddAttachment"==e&&this.CostCenterID>4e4&&this.CostCenterID<5e4){let e=this.Parent;if(null==e.ViewAttachments)return;let t=new S(this,"Attachments");e.ViewAttachments.AttachmentsList.forEach(e=>{t.Attachments.Items.push(r.c.CheckedListBoxItem_3(e.ActualFileName,e.guid+"."+e.FileExtension)),this.AttachmentList.Items.find(t=>t.DBColumnName==e.guid+"."+e.FileExtension)&&(t.Attachments.Items[t.Attachments.Items.length-1].IsChecked=!0)}),i.a.page.ShowDialog(t,d.a,{ShowCenter:!0})}}Send(){return Object(n.b)(this,void 0,void 0,(function*(){let e,t="";if(this.IsEmail){let e=i.a.SessionManager.Preferences.ContainsKey("LWEmailSMS")&&"TRUE"==i.a.SessionManager.Preferences.LWEmailSMS.toUpperCase();if(a.e.IsEmptySpace(i.a.SessionManager.UserEmail)&&!e)return void(this.DisplayMessage="Please set email address for user '"+i.a.SessionManager.UserName+"'");if(!i.a.SessionManager.UserEmail.Contains("@")&&!e)return void(this.DisplayMessage="Invalid email address '"+i.a.SessionManager.UserEmail+"' for user '"+i.a.SessionManager.UserName+"'")}if(-999==this.CostCenterID);else if(this.CostCenterID>4e4&&this.CostCenterID<5e4){if(this.IsEmail)for(let e=0;e<this.AttachmentList.Items.length;e++){let s=this.AttachmentList.Items[e];s.IsChecked&&(t+="<File>",t+="<FilePath>"+s.DBColumnName+"</FilePath>",t+="<ActualName>"+s.Label+"</ActualName>",t+="</File>")}}else if(50==this.CostCenterID){let t={Type:"Email"};if(this.drTemplate||(this.drTemplate={},this.drTemplate.TemplateID=0),t.drTemplate=this.drTemplate,this.drTemplate.To=this.To.Text,this.drTemplate.TemplateType=this.IsEmail?"1":"2",this.drTemplate.SendReportAs=this.SendReportAs.SelectedValue,this.drTemplate.To=this.To.Text,this.drTemplate.TemplateType=this.IsEmail?"1":"2",this.drTemplate.SendReportAs=this.SendReportAs.SelectedValue,t.LocationID=0==this.Location.Visible||null==this.Location.SelectedValue?0:parseInt(this.Location.SelectedValue),this.drTemplate.Login_Email1=i.a.SessionManager.UserEmail,this.drTemplate.Login_UserName=i.a.SessionManager.UserName,this.IsEmail){this.drTemplate.CC=this.CC.Text,this.drTemplate.BCC=this.BCC.Text,this.drTemplate.Subject=this.Subject.Text,this.drTemplate.AttachmentType=this.AttachmentType.SelectedValue;try{if(null!=this.BodyDocument){let t="";if(t.startsWith("<FlowDocument")){let e="";t.Contains('xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"')&&(e='xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"'),t=t.Replace('xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"',"");let s=new a.f;s.LoadXml(t),""!=e&&(t=t.Replace("<FlowDocument ","<FlowDocument "+e+" "));let n=s.SelectNodes("FlowDocument/Paragraph/Floater/BlockUIContainer/Image");if(n.length>0){let e="",s="",i="",o="",l="",c="",r=null;for(let h=0;h<n.length;h++)i=n[h].attributes.Source.value,i=i.Replace("file:///",""),i=i.Replace("{x:Null}",""),""!=i&&(o=i,r=o.split("/"),r.length>0&&(e=r[r.length-1].toString(),o=s,l=n[h].attributes.Source.value,Logger.DebugLog("SendEmailSmsVM-FlowDocument: ExistUrl"+i),c=a.e.GetPath(e.toString()),Logger.DebugLog("SendEmailSmsVM-FlowDocument: LocalUrl"+c),t=t.Replace(l,c)))}}let s=yield i.a.common.ConvertXamlToHtml(e.toString());this.BodyDocument=s.HtmlText}}catch(n){}}else this.drTemplate.Body=this.SMSBody.Text,this.drTemplate.BCC=this.BCC.Text;return void this.Parent.EmailSMSReport(t)}if(t.length>0&&(t="<XML>"+t+"</XML>"),this.IsEmail){let t;a.e.IsEmpty(this.BodyDocument)||(t=(yield i.a.common.ConvertHtmlToXaml(this.BodyDocument)).xamlText),e=null==this.BodyDocument?e="":t}else e=this.SMSBody.Text;let s=[];if(s.push(1),s.push(this.CostCenterID),s.push(40054==this.CostCenterID?this.Parent.sDocIDs:this.NodeID),s.push(0),s.push(0),s.push(this.IsEmail?1:2),s.push(i.a.SessionManager.UserEmail),s.push(this.EmailDisplayName),s.push(this.To.Text),this.IsEmail?(s.push(this.CC.Text),s.push(this.BCC.Text),s.push(this.AttachmentType.SelectedValue),s.push(null!=this.Attachments.SelectedValue?this.Attachments.SelectedValue:0),s.push(this.Subject.Text)):(s.push(""),s.push(this.BCC.Text),s.push(null),s.push(0),s.push(this.IsWhatsApp.IsChecked?"WhatsApp":"")),this.IsEmail)try{if(e.startsWith("<FlowDocument")){let t="";e.Contains('xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"')&&(t='xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"'),e=e.Replace('xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"',"");let s=new a.f;s.LoadXml(e),""!=t&&(e=e.Replace("<FlowDocument ","<FlowDocument "+t+" "));let n=s.SelectNodes("FlowDocument/Paragraph/Floater/BlockUIContainer/Image");if(n.length>0){let t="",s="",i="",o="",l="",c="",r=null;for(let h=0;h<n.length;h++)i=n[h].attributes.Source.value,i=i.Replace("file:///",""),i=i.Replace("{x:Null}",""),""!=i&&(o=i,r=o.split("/"),r.length>0&&(t=r[r.length-1].toString(),o=s,l=n[h].attributes.Source.value,Logger.DebugLog("SendEmailSmsVM-FlowDocument: ExistUrl"+i),c=a.e.GetPath(t.toString()),Logger.DebugLog("SendEmailSmsVM-FlowDocument: LocalUrl"+c),e=e.Replace(l,c)))}}}catch(n){}s.push(e),s.push(t.toString()),a.e.IsEmpty(this.Template.SelectedValue)?s.push(null):s.push(parseInt(this.Template.SelectedValue)),this.Location.Visible&&!a.e.IsEmpty(this.Location.SelectedValue)?s.push(parseInt(this.Location.SelectedValue)):s.push(0),p.a.SetNotifEventTemp(s).subscribe(e=>{this.DisplayMessage=e.Message,this.retValue=e.RetValue,this.retValue>0&&this.HideDialg()},e=>{console.log(e),this.DisplayMessage="Error in sending mail."})}))}HideDialg(){i.a.page.HideDialog()}OnRowDoubleClick(e,t){return!0}static PushDeleteEvents(e,t){let s=0,n=[];n.push(4),n.push(e),n.push(t),n.push("DELETE_EMAIL"),n.push(i.a.SessionManager.UserName),n.push(i.a.SessionManager.UserID),n.push(i.a.SessionManager.LanguageID);try{let e=i.a.report.GetDeleteNotifTemplete(n);null!=e&&e.Tables[1].length>0&&e.Tables[0].Merge(e.Tables[1]),null!=e&&e.Tables[0].length>0&&(s=parseInt(e.Tables[0][0].TemplateID),e.Tables[0].forEach(t=>{(void 0).SetDocument_ds(t),e.Columns[0].Contains("FilterXML")||(t.Table.Columns.push("FilterXML"),t.Table.Columns.push("Login_Email1"),t.Table.Columns.push("Login_UserName"),t.Table.Columns.push("Login_FirstName"),t.Table.Columns.push("Login_MiddleName"),t.Table.Columns.push("Login_LastName")),t.Login_Email1=i.a.SessionManager.UserEmail,t.Login_UserName=i.a.SessionManager.UserName;let s=i.a.common.GetDataSet("DOC038",i.a.SessionManager.UserID).Tables[0];s.length>0&&(t.Login_FirstName=s.Rows[0].FirstName.toString(),t.Login_MiddleName=s.Rows[0].MiddleName.toString(),t.Login_LastName=s.Rows[0].LastName.toString()),t.Table.Columns.push("OtherDocsNos"),(void 0).TemplateType=parseInt(t.TemplateType),(void 0).InitData(t)}))}catch(a){}}}class S extends l.b{constructor(e,t){super(),this.CallType=t,this.Parent=e,"Attachments"==t?this.Title="Add Attachments":"To"==t&&(this.Title="Select"),this.Attachments=new r.b}OnButtonClick(e){"OK"==e?("Attachments"==this.CallType?(this.Parent.AttachmentList.Items.Clear(),this.Attachments.Items.forEach(e=>{if(e.IsChecked){let t=new m.a;t.DBColumnName=e.Value,t.Label=e.Name,t.IsChecked=!0,this.Parent.AttachmentList.Items.push(t)}})):"To"==this.CallType&&(null==this.Parent.To.Text&&(this.Parent.To.Text=""),this.Attachments.Items.forEach(e=>{e.IsChecked&&(this.Parent.To.Text.length>0&&(this.Parent.To.Text+="; "),this.Parent.To.Text+=e.Name)})),i.a.page.HideDialog()):i.a.page.HideDialog()}}}}]);
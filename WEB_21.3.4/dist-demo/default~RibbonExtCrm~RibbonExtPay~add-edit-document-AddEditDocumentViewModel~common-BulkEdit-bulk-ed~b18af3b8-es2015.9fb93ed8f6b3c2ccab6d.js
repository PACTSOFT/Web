(window.webpackJsonp=window.webpackJsonp||[]).push([[22,151],{"+ryo":function(e,t,s){"use strict";s.r(t),s.d(t,"CasesContactViewModel",(function(){return D}));var i=s("ScVY"),a=s("EQd/"),n=s("JIg3"),r=s("4HhE"),o=s("0/4Q"),l=s("n56n"),c=s("Jnyl"),h=s("EggS"),u=s("Do2H"),d=s("3Pt+");class D extends i.b{constructor(e,t){super(),this.Fields=new Array,this.SaveOrganization=new r.b,this.Contact=new o.e(0),this.JobTitle=new a.d(0),this.Title_=new a.d(0),this.Dept=new a.d(0),this.FirstName=new a.d(0),this.LastName=new a.d(0),this.MiddleName=new a.d(0),this.Company=new a.d(0),this.Phone1=new a.d(0),this.Phone2=new a.d(0),this.Email1=new a.d(0),this.Email2=new a.d(0),this.Fax=new a.d(0),this.Salutation=new o.e(0),this.Territory=new l.b(0),this.oText=null,this.oDate=null,this.oCombo=null,this.oTextArea=null,this.OComboText=null,this.Dset=null,this.ContactChange=new r.b,this.SelectionChangedCommand=new r.b,this.form=new d.j({}),Logger.InfoLog("CasesContactViewModel::Entering CasesContactViewModel"),(null!=t&&"AddEditCasesViewModel"==t.ClassName||null!=t&&"AddEditDocumentViewModel"==t.ClassName)&&(this.OParnt=t),this.CasesContactVisibility=!0,this.ContactChange.Subscribe(this,"onContactSelectionChanged"),this.SelectionChangedCommand.Subscribe(this,"onCompanySelectionChanged"),this.EnableControls(!1);try{let t=u.a.crmService.GetFeedbackDetails(120);this.Oparent=e,this.Salutation.Items.Clear(),null!=t&&t.Tables.length>5&&t.Tables[5].length>0&&t.Tables[5].forEach(e=>{this.Salutation.Items.push(o.d.ComboBoxItems_2(e[t.Columns[5][2]].toString(),e[t.Columns[5][0]].toString()))}),this.SaveOrganization.Subscribe(this,"OnSave")}catch(s){Logger.ErrorLog("CasesContactViewModel:: CasesContactViewModel"+s.stack)}Logger.InfoLog("CasesContactViewModel::Exiting CasesContactViewModel")}onContactSelectionChanged(e){this.EnableControls(!0),null!=this.dvContacts&&null!=this.Contact.SelectedValue&&"0"!=this.Contact.SelectedValue&&(this.dvContacts=this.dvContacts.filter(e=>e.ContactID==this.Contact.SelectedValue),this.dvContacts.length>0&&(this.FirstName.Visible&&(this.FirstName.Text=this.dvContacts[0].FirstName.toString(),this.FirstName.Enable=!1),this.MiddleName.Visible&&(this.MiddleName.Text=this.dvContacts[0].MiddleName.toString(),this.MiddleName.Enable=!1),this.LastName.Visible&&(this.LastName.Text=this.dvContacts[0].LastName.toString(),this.LastName.Enable=!1),this.JobTitle.Visible&&(this.JobTitle.Text=this.dvContacts[0].JobTitle.toString(),this.JobTitle.Enable=!1),this.Salutation.Visible&&""!=this.dvContacts[0].SalutationID.toString()&&(this.Salutation.SelectedValue=this.dvContacts[0].SalutationID.toString(),this.Salutation.Enable=!1),this.Dept.Visible&&(this.Dept.Text=this.dvContacts[0].Department.toString(),this.Dept.Enable=!1),this.JobTitle.Visible&&(this.JobTitle.Text=this.dvContacts[0].JobTitle.toString(),this.JobTitle.Enable=!1)))}EnableControls(e){this.FirstName.Visible&&(this.FirstName.Enable=e,this.FirstName.Text=""),this.LastName.Visible&&(this.LastName.Enable=e,this.LastName.Text=""),this.MiddleName.Visible&&(this.MiddleName.Enable=e,this.MiddleName.Text=""),this.Salutation.Visible&&(this.Salutation.Enable=e,this.Salutation.SelectedValue="0"),this.JobTitle.Visible&&(this.JobTitle.Enable=e,this.JobTitle.Text=""),this.Dept.Visible&&(this.Dept.Enable=e,this.Dept.Text=""),this.Title_.Visible&&(this.Title_.Enable=e,this.Title_.Text=""),this.JobTitle.Visible&&(this.JobTitle.Enable=e,this.JobTitle.Text=""),this.Phone1.Visible&&(this.Phone1.Enable=e,this.Phone1.Text=""),this.Phone2.Visible&&(this.Phone2.Enable=e,this.Phone2.Text=""),this.Email1.Visible&&(this.Email1.Enable=e,this.Email1.Text=""),this.Email2.Visible&&(this.Email2.Enable=e,this.Email2.Text=""),this.Fax.Visible&&(this.Fax.Enable=e,this.Fax.Text=""),this.Company.Visible&&(this.Company.Enable=e,this.Company.Text="")}onCompanySelectionChanged(e){this.Contact.Items.Clear();let t=(new h.a).GetCustomerDetails();if(t.Tables.length>1&&t.Tables[2].length>0){for(let e=0;e<t.Tables[2].length;e++)this.Contact.Items.push(o.d.ComboBoxItems_2(t.Tables[2][e].Fname.toString(),t.Tables[2][e].ContactID.toString()));this.dvContacts=t.Tables[2]}}OnSave(e){Logger.InfoLog("DemoKitViewModel::Entering OnSave");try{if("Customize"==e.toString());else if("Cancel"==e.toString())this.Oparent.Parent.CasesContactVisibility=!1;else if("Save"==e.toString()){if(null!=this.Oparent&&null==this.Oparent.SelectedRow){let e=this.Oparent.OrganizationDataObj.NewRow();(this.OParnt.ClassName="AddEditCasesViewModel")?(e.Customer=this.OParnt.Customer.Text,e.CustomerID=this.OParnt.Customer.SelectedValue):(e.Customer=this.OParnt.ScreenObject.CreditAccount.Text,e.CustomerID=this.OParnt.ScreenObject.CreditAccount.SelectedValue),e.ContactName=this.FirstName.Text,e.MiddleName=this.MiddleName.Text,e.LastName=this.LastName.Text,e.ContactID=this.Contact.SelectedValue,e.Salutation=this.Salutation.GetText(),e.SalutationID=this.Salutation.SelectedValue,e.JobTitle=this.JobTitle.Text,e.Department=this.Dept.Text,e.Company=this.Company.Text,e.Phone1=this.Phone1.Text,e.Email1=this.Email1.Text,e["Phon e2"]=this.Phone2.Text,e.Email2=this.Email2.Text,e.Fax=this.Fax.Text;for(let t=0;t<this.Fields.length;t++){let s=this.Fields[t];s instanceof a.d&&(this.oText=s,e[this.oText.SysColumnName]=this.oText.Text),s instanceof n.a&&(this.oDate=s,e[this.oDate.SysColumnName]=this.oDate.Date),s instanceof o.e&&(this.oCombo=s,e[this.oCombo.SysColumnName]=this.oCombo.SelectedValue),s instanceof c.a&&(this.OComboText=s,e[this.OComboText.SysColumnName]=this.OComboText.TextBox.Text),s instanceof a.c&&(this.oTextArea=s,e[this.oTextArea.SysColumnName]=this.oTextArea.Text),s instanceof l.b&&(this.oPactCombo=s,e[this.oPactCombo.SysColumnName+"_Key"]=this.oPactCombo.SelectedValue,e[this.oPactCombo.SysColumnName]=this.oPactCombo.Text)}this.Oparent.OrganizationDataObj.addRow(e)}else this.Oparent.SelectedRow.ContactName=this.FirstName.Text,this.Oparent.SelectedRow.LastName=this.LastName.Text,this.Oparent.SelectedRow.MiddleName=this.MiddleName.Text,null!=this.Contact.SelectedValue&&(this.Oparent.SelectedRow.ContactID=this.Contact.SelectedValue),this.Oparent.SelectedRow.Salutation=this.Salutation.GetText(),this.Oparent.SelectedRow.SalutationID=this.Salutation.SelectedValue,this.Oparent.SelectedRow.JobTitle=this.JobTitle.Text,this.Oparent.SelectedRow.Department=this.Dept.Text,this.Oparent.SelectedRow.Email1=this.Email1.Text,this.Oparent.SelectedRow.Email2=this.Email2.Text,this.Oparent.SelectedRow.phone1=this.Phone1.Text,this.Oparent.SelectedRow.phone2=this.Phone2.Text,this.Oparent.SelectedRow=null;this.ClearFields(),this.Territory.SelectedValue=0,this.FirstName.Text="",this.MiddleName.Text="",this.LastName.Text="",this.JobTitle.Text="",this.Title_.Text="",this.Dept.Text="",this.Company.Text="",this.Email1.Text="",this.Phone1.Text="",this.Email2.Text="",this.Phone2.Text="",this.Fax.Text="",this.Salutation.SelectedValue="",this.Contact.SelectedValue="0"}}catch(t){Logger.ErrorLog("DemoKitViewModel:: OnSave"+t.stack)}Logger.InfoLog("DemoKitViewModel::Exiting OnSave")}ClearFields(){for(let e=0;e<this.Fields.length;e++){let t=this.Fields[e];t instanceof a.d&&(this.oText=t,this.oText.Text=""),t instanceof n.a&&(this.oDate=t),t instanceof o.e&&(this.oCombo=t,this.oCombo.SelectedValue=""),t instanceof c.a&&(this.OComboText=t,this.OComboText.TextBox.Text=""),t instanceof a.c&&(this.oTextArea=t,this.oTextArea.Text=""),t instanceof l.b&&(this.oPactCombo=t,this.oPactCombo.SelectedValue=0)}}}},"1Cra":function(e,t,s){"use strict";s.r(t),s.d(t,"AddEditDocumentViewModel",(function(){return es})),s.d(t,"FailureMessage",(function(){return ts}));var i=s("mrSG"),a=s("Do2H"),n=s("Lp6j"),r=s("vTM8"),o=s("eQJW"),l=s("ScVY"),c=s("lUlH"),h=s("NkMH"),u=s("EQd/"),d=s("JIg3"),D=s("0/4Q"),S=s("wlFP"),m=s("n56n"),b=s("4HhE"),C=s("Huqd"),p=s("Jnyl"),y=s("ockk"),g=s("jgdN"),O=s("uMy8"),I=s("RHAd"),f=s("MCLT"),T=s("4ADR"),j=s("OvA8"),P=s("lG8W"),A=s("c6C+"),M=s("RJs6"),G=s("xnJf"),N=s("tDup"),E=s("dQvv"),w=s("lvkM"),F=s("8B8H"),V=s("CUWK"),L=s("hTlG");class R extends l.b{constructor(){super(),this.ImportVisiblity=!1,this.ActualFileName=null,this.RimFileName=null,this.GridHeight=200,this.IsInventory=!1,this.CanDist=!1,this.GridWidth=0,this.Width=0,this._FifoEnabled=!0,this._Fifo=!1,this.NewReferenceDetailsVisibility=!1,this.ForeignCurrency=!1,this.PostVisibility=!1,this.OkVisible=!1,this.SaveVisible=!0,this.ColumnSource=[],this.DBCRColumnSource=[],this.DetailsColumnSource=[],this.NewRefColumnSource=[],this.GridData=[],this.GridDataColumns=[],this.GridDataObj=new F.a,this.GridDataDBCR=[],this.GridDataDBCRObj=new F.a,this.NewReferenceDetails=[],this.NewReferenceDetailsColumns=[],this.NewReferenceDetailsObj=new F.a,this.NewReferenceVisibility=!1,this.DBCRVisibility=!1,this.NewReferenceDt=[],this.NewReferenceDtColumns=[],this.NewReferenceDtObj=new F.a,this.CurrencyID=1,this.ExchangeRate=1,this.AccountID=0,this.IsCredit=!1,this.Accounts=new D.e(0),this.NewReference=new u.d(0),this.NegAmount=new u.d(0),this.AdjustAmt=new u.d(0),this.AmtToAdjust=new u.d(0),this.FromDate=new d.a,this.ToDate=new d.a,this.ToSearchVisible=!1,this.ToSearch="",this._UpdateFooter=!1,this.decimalpoints="",this.DbCrNetFld="",this.DocSeqNo=1,this.TotTaxableAmt=0,this.DiscCol=null,this.drdbcr=null,this.dtccData=null,this.AdvanceRowsCNT=0,this.VatAdvanceXML=null,this.GridDataDBCRObj.Table=this.GridDataDBCR,this.GridDataDBCRObj.SearchVisible=!0,this.GridDataDBCRObj.CanUserAddRows=!1,this.GridDataDBCRObj.CanUserDeleteRows=!1,this.Title=a.a.GetResource("BillWise_Title"),this.GridDataObj.Table=this.GridData,this.GridDataObj.TableColumns=this.GridDataColumns,this.GridDataObj.SearchVisible=!0,this.GridDataObj.CanUserAddRows=!1,this.GridDataObj.CanUserDeleteRows=!1,this.NewReferenceDtObj.MaxHeight=500,this.NewReferenceDtObj.Table=this.NewReferenceDt,this.NewReferenceDtObj.TableColumns=this.NewReferenceDtColumns,this.NewReferenceDtObj.Columns=this.NewRefColumnSource,this.NewReferenceDtObj.Height=200,this.NewReferenceDetailsObj.Table=this.NewReferenceDetails,this.NewReferenceDetailsObj.TableColumns=this.NewReferenceDetailsColumns,this.NewReferenceDetailsObj.Columns=this.DetailsColumnSource,this.NewReferenceDetailsObj.Height=200,this.Accounts.Label="Account",this.Accounts.LblWidth="70",this.NewReference.Label=a.a.GetResource("BillWise_NewReference"),this.AmtToAdjust.Label=a.a.GetResource("BillWise_AmtAdjust"),this.AdjustAmt.Label=a.a.GetResource("BillWise_AdjustedAmt")}get FifoEnabled(){return this._FifoEnabled}get Fifo(){return this._Fifo}set Fifo(e){e!=this._Fifo&&(this._Fifo=e,this.AdjustBills())}get SeletedNewRef(){return this.NewReferenceDetailsObj.SelectedItem}get UpdateFooter(){return this._UpdateFooter}set UpdateFooter(e){this._UpdateFooter=!this._UpdateFooter}get SelectedRow(){return this.GridDataObj.SelectedItem}BindExchageRate(){if(this.ExRate=this.ExchangeRate.toString(),this.Parent.ScreenObject.Data.Tables.length>14&&this.Parent.ScreenObject.Data.Tables[14].length>0){let e=this.Parent.ScreenObject.Data.Tables[14].filter(e=>e.CurrencyID==this.CurrencyID);e.length>0&&(this.CurrencyName=e[0].Name.toString())}}UpdateTotals(){let e=0;for(let t=0;t<this.ColumnSource.length;t++)null!=this.ColumnSource[t].DecimalPoints&&"ExchgRate"!=this.ColumnSource[t].DisplayMember&&(e=0,this.GridData.forEach(s=>{n.e.IsEmpty(s[this.ColumnSource[t].DisplayMember])||""==s[this.ColumnSource[t].DisplayMember].toString().Trim()||(e+=parseFloat(s[this.ColumnSource[t].DisplayMember]))}),this.ColumnSource[t].footer=e.ToString("N"+this.ColumnSource[t].DecimalPoints),this.DBCRVisibility&&(e=0,this.GridDataDBCR.forEach(s=>{n.e.IsEmpty(s[this.ColumnSource[t].DisplayMember])||(e+=parseFloat(s[this.ColumnSource[t].DisplayMember]))}),this.DBCRColumnSource[t].footer=e.ToString("N"+this.ColumnSource[t].DecimalPoints)));this.UpdateFooter=!0}LoadColumns(e){this.decimalpoints=this.Parent.ScreenObject.Preferences.ContainsKey("DecimalsBillWise")&&""!=this.Parent.ScreenObject.Preferences.DecimalsBillWise&&isFinite(this.Parent.ScreenObject.Preferences.DecimalsBillWise)&&parseInt(this.Parent.ScreenObject.Preferences.DecimalsBillWise)>0?this.Parent.ScreenObject.Preferences.DecimalsBillWise:a.a.SessionManager.Preferences.ContainsKey("DecimalsinAmount")?a.a.SessionManager.Preferences.DecimalsinAmount:"2";let t=new y.a;t.Header="#",t.DisplayMember="SNO",t.DataType="TextBlock",t.Width=24,t.ReadOnly=!0,this.ColumnSource.push(t),this.Parent.ScreenObject.Preferences.ContainsKey("UnappinBills")&&"True"==this.Parent.ScreenObject.Preferences.UnappinBills&&(t=new y.a,t.Header="Status",t.DisplayMember="Status",t.ReadOnly=!0,t.DataType="text",t.Width=2,t.DisableTab=!0,t.IsVisible=!0,t.ID="0",this.ColumnSource.push(t),this.GridDataColumns.push("Status_COLOR"),this.GridDataColumns.push("Status")),null!=this.Parent&&this.Parent.ScreenObject.Preferences.ContainsKey("ShowNewReference")&&"True"==this.Parent.ScreenObject.Preferences.ShowNewReference&&(t=new y.a,t.Header="Adjust Bill",t.DisplayMember="AdjustBill",t.ReadOnly=!0,t.DataType="LINK",t.ReadOnly=!1,t.Click.Subscribe(this,"OnAdjustBill"),t.Width=100,t.DisableTab=!0,t.IsVisible=!0,t.ID="0",this.ColumnSource.push(t),this.GridDataColumns.push("AdjustBill"));for(let s=0;s<e.length;s++){if(t=new y.a,t.Header=e[s].UserColumnName.toString(),t.DisplayMember=!n.e.IsEmpty(e[s].CostCenterID)&&parseInt(e[s].CostCenterID)>5e4&&parseInt(e[s].CostCenterID)<50100?"A"+e[s].CostCenterID.toString():e[s].Name.toString(),"DocDueDate"==t.DisplayMember&&(t.DisplayMember="DueDate"),t.ReadOnly=!Object(o.j)(e[s].IsEditable),"DiscAmount"==t.DisplayMember){if(this.IsInventory)continue;{let e=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&25927==e.LinkData);if(0==e.length||!this.Parent.ScreenObject.GridDataColumns.Contains(e[0].SysColumnName.toString()))continue;this.DiscCol=this.Parent.ScreenObject.ColumnSource.find(t=>t.DisplayMember==e[0].SysColumnName.toString()),t.ReadOnly=!1,t.DataType="FLOAT"}}else"DocNo"==t.DisplayMember?(t.DataType="LINK",t.ReadOnly=!1,t.Click.Subscribe(this,"OnserieslinkClick")):t.DataType=e[s].UserColumnType.toString();"FLOAT"==t.DataType&&""!=this.decimalpoints&&(t.DecimalPoints=this.decimalpoints),a.a.SessionManager.Preferences.ContainsKey("BillwiseCurrency")&&"true"==a.a.SessionManager.Preferences.BillwiseCurrency.toLowerCase()&&"amountpaidlc"==t.DisplayMember.toLowerCase()&&(t.ReadOnly=!0),n.e.IsEmpty(e[s].ColumnWidth)||(t.Width=parseInt(e[s].ColumnWidth)),t.ID=n.e.StringValue(e[s].CostCenterID),this.ColumnSource.push(t)}this.GridDataObj.Columns=this.ColumnSource,t=new y.a,t.Header="#",t.DisplayMember="SNO",t.DataType="TextBlock",t.Width=24,t.ReadOnly=!0,this.DetailsColumnSource.push(t),t=new y.a,t.Header=a.a.GetResource("BillWise_DocumentNo"),t.DisplayMember="DocumentNo",t.DataType="TextBlock",t.Width=100,t.ReadOnly=!0,t.DataType="LINK",t.Click.Subscribe(this,"OnlinkClick"),this.DetailsColumnSource.push(t),t=new y.a,t.Header=a.a.GetResource("BillWise_DocDate"),t.DisplayMember="DocDate",t.DataType="TextBlock",t.Width=80,t.ReadOnly=!0,this.DetailsColumnSource.push(t),t=new y.a,t.Header=a.a.GetResource("BillWise_AmountPaid"),t.DisplayMember="AmountPaid",t.DataType="FLOAT",t.Width=80,t.ReadOnly=!0,""!=this.decimalpoints&&(t.DecimalPoints=this.decimalpoints),this.DetailsColumnSource.push(t),t=new y.a,t.Header=a.a.GetResource("BillWise_AmountFC"),t.DisplayMember="AmountFC",t.DataType="FLOAT",t.Width=150,t.ReadOnly=!0,""!=this.decimalpoints&&(t.DecimalPoints=this.decimalpoints),t.IsVisible=!!this.ForeignCurrency,this.DetailsColumnSource.push(t)}OnAdjustBill(){return Object(i.b)(this,void 0,void 0,(function*(){try{if(null!=this.SelectedRow&&!n.e.IsEmpty(this.SelectedRow.CostCenterID)){const{AddEditDocumentViewModel:e}=yield Promise.all([s.e(2),s.e(1),s.e(3),s.e(5),s.e(4),s.e(6),s.e(7),s.e(10),s.e(9),s.e(12),s.e(11),s.e(13),s.e(19),s.e(15),s.e(21),s.e(20),s.e(16),s.e(14),s.e(18),s.e(17),s.e(22),s.e(89)]).then(s.bind(null,"1Cra"));let t=new e(parseInt(this.SelectedRow.CostCenterID),"",!0);t.ScreenObject.DocPrefix.ComboBox.SelectedValue=this.SelectedRow.DocPrefix.toString(),t.ScreenObject.DocPrefix.TextBox.Text=this.SelectedRow.DocNoStr.toString(),t.OnDocPrefixChanged("lostFocus"),t.ScreenObject.FillDocumentPrefix(!0),t.DialogResult=!1,""==this.Parent.ScreenObject.guid&&(this.Parent.ScreenObject.guid=n.e.NewGuid()),t.ScreenObject.guid=this.Parent.ScreenObject.guid;let i=new R;i.BillWiseViewModel_2(t,0,this.AccountID,!this.IsCredit,1,1,!0,""),t.DialogResult||(i.OkVisible=!1,i.SaveVisible=!1,a.a.page.ShowDialog(i,L.a).subscribe(()=>{let e=t.ScreenObject.GetPendingAmount(this.AccountID.toString()),s=0;if(null!=e&&e.Tables.length>0&&e.Columns[0].Contains("bal")&&e.Tables[0].length>0){var i=e.Tables[0].filter(e=>e.docno==t.ScreenObject.VoucherNo);i.length>0&&(s=parseFloat(i[0].bal.toString()))}if(!n.e.IsEmpty(this.SelectedRow.Due)&&parseFloat(this.SelectedRow.Due.toString())!=s&&(this.SelectedRow.Due=s.ToString("N"+this.decimalpoints),this.GridDataColumns.Contains("DueFC")&&!n.e.IsEmpty(this.SelectedRow.ExchgRate)&&(this.SelectedRow.DueFC=(s/parseFloat(this.SelectedRow.ExchgRate.toString())).ToString("N"+this.decimalpoints)),n.e.IsEmpty(this.SelectedRow.Amount)||(this.SelectedRow.Paid=(parseFloat(this.SelectedRow.Amount.toString())-s).ToString("N"+this.decimalpoints)),!this.GridDataColumns.Contains("PaidFC")||n.e.IsEmpty(this.SelectedRow.Paid)||n.e.IsEmpty(this.SelectedRow.ExchgRate)||(this.SelectedRow.PaidFC=(parseFloat(this.SelectedRow.Paid.toString())/parseFloat(this.SelectedRow.ExchgRate.toString())).ToString("N"+this.decimalpoints)),null!=this.NewReferenceDt)){if(null!=e&&e.Tables.length>0&&e.Columns[0].Contains("bal")&&e.Tables[0].length>0)for(let t=0;t<this.NewReferenceDt.length;t++){let s=null;s=n.e.IsEmpty(this.NewReferenceDt[t].DocSeqNo)?e.Tables[0].filter(e=>e.docno==this.NewReferenceDt[t].DocumentNo.toString()):e.Tables[0].filter(e=>e.docno==this.NewReferenceDt[t].DocumentNo.toString()&&e.DocSeqNo==this.NewReferenceDt[t].DocSeqNo.toString()),s.length>0&&(this.NewReferenceDt[t].Due=parseFloat(s[0].bal.toString()))}var a=this.NewReferenceDt.filter(e=>e.DocumentNo==this.SelectedRow.DocNo.toString()&&e.DocSeqNo==this.SelectedRow.DocSeqNo.toString());a.length>0&&(a[0].Due=s.ToString("N"+this.decimalpoints))}}))}}catch(e){Logger.ErrorLog("Billwise","OnAdjustBill",e.Message)}}))}OnserieslinkClick(){try{null!=this.SelectedRow&&(Object(f.isUndefined)(this.SelectedRow.CostCenterID)||(a.a.page.HideDialog(),V.RibbonExtViewModel.LoadDocument(this.SelectedRow)))}catch(e){Logger.ErrorLog("UnAppDocumentsViewModel","OnLinkClickEvent",e.stack)}}BillWiseViewModel_1(e,t){this.BillWiseViewModel_2(e,0,0,!1,1,1,t,"")}BillWiseViewModel_2(e,t,s,i,r,l,c,h){this.DbCrNetFld=h,this.IsInventory=e.IsInventoryVoucher,this.OkVisible=this.IsInventory,this.Parent=e,""!=this.DbCrNetFld?(this.NegAmount.Visible=!0,this.NegAmount.Label=i?"Adjusted Credits":"Adjusted Debits"):this.NegAmount.Visible=!1;let u="",d=!1;if(e.IsInventoryVoucher){s>0&&(d=!0);for(let t=0;t<e.BillWisedt.length;t++)!n.e.IsEmpty(e.BillWisedt[t].AccountID)&&parseInt(e.BillWisedt[t].AccountID)>0&&(u+='<Row AccountID="'+e.BillWisedt[t].AccountID.toString()+'" Iscr="'+e.BillWisedt[t].IsCredit.toString()+'" ',e.BillWisedtColumns.Contains("DocSeqNo")&&(u+=' DocSeqNo="'+e.BillWisedt[t].DocSeqNo.toString()+'" '),u+="  />")}u.length>0&&(u="<XML>"+u+"</XML>");let S=null;e.IsInventoryVoucher||null==e.SelectedRow||(S=e.SelectedRow);let m=new n.f;if(!this.IsInventory&&null!=e.SelectedRow){let t=n.e.StringValue(e.SelectedRow.ExtraXML);if(""!=t&&m.ReadXml(t),e.ScreenObject.Preferences.ContainsKey("DbCrBills")&&"True"==e.ScreenObject.Preferences.DbCrBills.toString()&&(this.DBCRVisibility=!0,this.Parent.ScreenObject.GridDataColumns.Contains("guidCol")&&!n.e.IsEmpty(S.guidCol))){let t;if(t=this.Parent.ScreenObject.GridData.filter(18==this.Parent.ScreenObject.DocumentType||19==this.Parent.ScreenObject.DocumentType||21==this.Parent.ScreenObject.DocumentType||22==this.Parent.ScreenObject.DocumentType?e=>e.CreditAccount_Key==s&&e.guidCol==S.guidCol.toString():14==this.Parent.ScreenObject.DocumentType||15==this.Parent.ScreenObject.DocumentType||20==this.Parent.ScreenObject.DocumentType||23==this.Parent.ScreenObject.DocumentType?e=>e.DebitAccount_Key==s&&e.guidCol==S.guidCol.toString():e=>e.AccountID_Key==s&&e.guidCol==S.guidCol.toString()),t.length>1&&(this.drdbcr=t[0]==S?t[1]:t[0]),null!=this.drdbcr&&!n.e.IsEmpty(S.Amount)&&parseFloat(S.Amount.toString())<0)return void(e.DialogResult=!0)}}let b="";this.IsInventory||null==e.SelectedRow||n.e.IsEmpty(e.SelectedRow.DocSeqNo)||(this.DocSeqNo=parseInt(e.SelectedRow.DocSeqNo)),this.IsInventory||null==e.SelectedRow||!e.ScreenObject.GridDataColumns.Contains("OldSeqNo")||n.e.IsEmpty(e.SelectedRow.OldSeqNo)||(this.DocSeqNo=parseInt(e.SelectedRow.OldSeqNo)),null!=m&&m.Tables.length>0&&m.Columns[0].Contains("VNO")&&m.Tables[0].length>0?b=e.ScreenObject.ChildVNos:e.ScreenObject.IsDocEdit&&(b=e.ScreenObject.VoucherNo);let C=e.ScreenObject.GetBillWiseDetails(s,u.toString(),i,b,this.DocSeqNo,S,e.DocumentDate,d);if(e.IsInventoryVoucher){if(null==C||0==C.Tables.length)return void(e.DialogResult=!0)}else{if(null==C||0==C.Tables.length)return null!=e.SelectedRow&&(e.SelectedRow.ExtraXML=null,e.SelectedRow.Type=null),void(e.DialogResult=!0);null!=S&&(S.Type=!0)}if(this.IsInventory&&e.ScreenObject.GridDataColumns.Contains("dcCalcdcNum51")){var p=e.ScreenObject.GridData.Compute("sum","dcCalcdcNum51");null!=p&&(this.TotTaxableAmt=n.e.Double(p))}this.NewReference.Enable=!e.IsInventoryVoucher&&0==t,this.ForeignCurrency=!!a.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(o.j)(a.a.SessionManager.Preferences["Use Foreign Currency"]);let y=0;this.IsInventory||null==this.Parent.SelectedRow||n.e.IsEmpty(this.Parent.SelectedRow.DocDetailsID)||(y=parseInt(this.Parent.SelectedRow.DocDetailsID)),this.PostVisibility=!(this.DBCRVisibility||!this.Parent.ScreenObject.IsDocEdit||!a.a.SessionManager.IsActionAssigned(this.Parent.CostCenterID,"Post Billwise")||!(!e.IsInventoryVoucher&&y>0||d)),a.a.SessionManager.PersonalSettings.ContainsKey("BillwiseWidth")?(this.Width=n.e.Double(a.a.SessionManager.PersonalSettings.BillwiseWidth),this.GridWidth=this.Width-20):(this.Width=990,this.GridWidth=780),this.GridDataColumns.push("SNO"),this.GridDataColumns.push("DocAbbr"),this.GridDataColumns.push("DocPrefix"),this.GridDataColumns.push("Docnumber"),this.GridDataColumns.push("DocNoStr"),this.GridDataColumns.push("CostCenterID"),this.GridDataColumns.push("DocSeqNo"),this.GridDataColumns.push("DocDate"),this.GridDataColumns.push("DocDate_Key"),this.GridDataColumns.push("DueDate"),this.GridDataColumns.push("DueDate_Key"),this.GridDataColumns.push("DueDays"),this.GridDataColumns.push("CurrID"),this.GridDataColumns.push("CurrName"),this.GridDataColumns.push("ExchgRate"),this.GridDataColumns.push("Amount"),this.GridDataColumns.push("Due"),this.GridDataColumns.push("Paid"),this.GridDataColumns.push("StatusID"),this.GridDataColumns.push("AmountFC"),this.GridDataColumns.push("DueFC"),this.GridDataColumns.push("PaidFC"),this.GridDataColumns.push("DiscAmount"),this.GridDataColumns.push("DiscAccount"),this.GridDataColumns.push("AmountPaid"),this.GridDataColumns.push("AmountPaidLC"),this.GridDataColumns.push("exchgl"),this.GridDataColumns.push("VatAdvance"),this.GridDataColumns.push("IsIncl"),this.GridDataColumns.push("Remarks"),!this.IsInventory&&this.Parent.ScreenObject.Preferences.ContainsKey("NonAccDocs")&&""!=this.Parent.ScreenObject.Preferences.NonAccDocs&&this.GridDataColumns.push("NonAc");let g=2;this.DBCRVisibility&&(g=4);for(let a=0;a<C.Tables[g].length;a++)!n.e.IsEmpty(C.Tables[g][a].CostcenterID)&&parseInt(C.Tables[g][a].CostcenterID)>5e4&&parseInt(C.Tables[g][a].CostcenterID.toString())<50100?this.GridDataColumns.Contains("A"+C.Tables[g][a].CostcenterID.toString())||this.GridDataColumns.push("A"+C.Tables[g][a].CostcenterID.toString()):this.GridDataColumns.Contains(C.Tables[g][a].Name.toString())||(this.GridDataColumns.push(C.Tables[g][a].Name.toString()),"DATE"==C.Tables[g][a].UserColumnType.toString().toUpperCase()&&this.GridDataColumns.push(C.Tables[g][a].Name.toString()+"_Key"));if(this.LoadColumns(C.Tables[g]),this.Accounts.Visible=this.Parent.IsInventoryVoucher,this.AmtToAdjust.Enable=!1,this.AdjustAmt.Enable=!1,this.Parent.IsInventoryVoucher){if(console.log("BILL"),console.log(this.Parent.BillWisedt),null!=C&&C.Tables.length>3)if(C.Columns[3].Contains("AccountID"))for(let t=0;t<C.Tables[3].length;t++){let s=this.Parent.BillWisedt.filter(e=>e.AccountID==C.Tables[3][t].AccountID);if(s.length>0)if(e.BillWisedtColumns.Contains("DocSeqNo"))for(let e=0;e<s.length;e++)s[e].AccountName=C.Tables[3][t].AccountName.toString(),this.Accounts.Items.push(D.d.ComboBoxItems_8(C.Tables[3][t].AccountName.toString(),C.Tables[3][t].AccountID.toString(),Object(o.j)(s[e].IsCredit),""!=this.decimalpoints?parseFloat(s[e].Amount).ToString("N"+this.decimalpoints):s[e].Amount.toString(),parseInt(s[e].CurrencyID),parseFloat(s[e].ExchangeRate),parseInt(s[e].DocSeqNo))),C.Tables[3].length>0&&C.Tables[3][0].SelectedAcc.toString()==C.Tables[3][t].AccountID.toString()&&C.Tables[3][0].SelSeq.toString()==s[e].DocSeqNo.toString()&&(this.AccountID=parseInt(C.Tables[3][t].AccountID),this.Accounts.SelectedValue=this.AccountID.toString(),this.IsCredit=Object(o.j)(s[e].IsCredit),this.AmtToAdjust.Text=s[e].Amount.toString(),this.NewReference.Text=s[e].Amount.toString(),this.AdjustAmt.Text="0",this.CurrencyID=parseInt(s[e].CurrencyID),this.ExchangeRate=parseFloat(s[e].ExchangeRate),this.DocSeqNo=parseInt(s[e].DocSeqNo),this.BindExchageRate());else s[0].AccountName=C.Tables[3][t].AccountName.toString(),this.Accounts.Items.push(D.d.ComboBoxItems_8(C.Tables[3][t].AccountName.toString(),C.Tables[3][t].AccountID.toString(),Object(o.j)(s[0].IsCredit),""!=this.decimalpoints?parseFloat(s[0].Amount).ToString("N"+this.decimalpoints):s[0].Amount.toString(),parseInt(s[0].CurrencyID),parseFloat(s[0].ExchangeRate),1)),C.Tables[3].length>0&&C.Tables[3][0].SelectedAcc.toString()==C.Tables[3][t].AccountID.toString()&&(this.AccountID=parseInt(C.Tables[3][t].AccountID),this.Accounts.SelectedValue=this.AccountID.toString(),this.IsCredit=Object(o.j)(s[0].IsCredit),this.AmtToAdjust.Text=parseFloat(s[0].Amount).Commas("N"+this.decimalpoints),this.NewReference.Text=parseFloat(s[0].Amount).Commas("N"+this.decimalpoints),this.AdjustAmt.Text="0",this.CurrencyID=parseInt(s[0].CurrencyID),this.ExchangeRate=parseFloat(s[0].ExchangeRate),this.BindExchageRate())}else C.Columns[3].Contains("AdjAmount")&&C.Tables[3].length>0&&(this.AccountID=s,this.AmtToAdjust.Text=C.Tables[3][0].AmountFC.toString().replace("-",""),this.NewReference.Text=C.Tables[3][0].AmountFC.toString().replace("-",""),this.IsCredit=i,this.AdjustAmt.Text="0",this.CurrencyID=parseInt(C.Tables[3][0].AdjCurrID),this.ExchangeRate=parseFloat(C.Tables[3][0].AdjExchRT),this.Accounts.Items.push(D.d.ComboBoxItems_8(C.Tables[3][0].AccountName.toString(),this.AccountID.toString(),this.IsCredit,this.AmtToAdjust.Text.RemoveComma(),this.CurrencyID,this.ExchangeRate,1)),this.Accounts.SelectedValue=this.AccountID.toString())}else""!=this.decimalpoints?(this.AmtToAdjust.Text=t.Commas("N"+this.decimalpoints),this.NewReference.Text=t.Commas("N"+this.decimalpoints)):(this.AmtToAdjust.Text=t.toString(),this.NewReference.Text=t.toString()),this.AdjustAmt.Text="0",this.AccountID=s,this.IsCredit=i,this.CurrencyID=r,this.ExchangeRate=l,this.BindExchageRate();this.GetBillWiseDetails(m,C),this.GridDataObj.BeginEdit.Subscribe(this,"OnBeginEdit"),this.GridDataObj.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.GridDataDBCRObj.BeginEdit.Subscribe(this,"OnBeginEdit"),this.GridDataDBCRObj.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.Accounts.SelectionChangedCommand.Subscribe(this,"OnSave","SelectionChanged"),this.NewReferenceDetailsVisibility||this.NewReferenceVisibility||this.DBCRVisibility||(this.GridHeight=a.a.SessionManager.PersonalSettings.ContainsKey("BillwiseHeight")&&isFinite(a.a.SessionManager.PersonalSettings.BillwiseHeight)?n.e.Double(a.a.SessionManager.PersonalSettings.BillwiseHeight):500),this.IsInventory||!a.a.SessionManager.Preferences.ContainsKey("DistributeCost")||"True"!=a.a.SessionManager.Preferences.DistributeCost||!a.a.SessionManager.Preferences.ContainsKey("CostBasedON")||"True"!=a.a.SessionManager.Preferences.CostBasedON||!a.a.SessionManager.Preferences.ContainsKey("CostBasedONDims")||""==a.a.SessionManager.Preferences.CostBasedONDims||e.ScreenObject.Preferences.ContainsKey("DistributeCost")&&"True"==e.ScreenObject.Preferences.DistributeCost.toString()||this.GroupByDocNo()}GroupByDocNo(){this.GridDataColumns.push("IsClubed"),this.GridDataColumns.push("StyleHeightZero");let e=new Array;if(!n.e.IsEmpty(this.Parent.SelectedRow.DocDetailsID)&&parseInt(this.Parent.SelectedRow.DocDetailsID.toString())>0&&a.a.SessionManager.IsActionAssigned(43,"Billwise Distribute on Edit"))this.CanDist=!0;else if(!n.e.IsEmpty(this.Parent.SelectedRow.ExtraXML)){var t=this.ColumnSource.find(e=>"amountpaidlc"==e.DisplayMember.toLowerCase());null!=t&&(t.ReadOnly=!0),null!=(t=this.ColumnSource.find(e=>"amountpaid"==e.DisplayMember.toLowerCase()))&&(t.ReadOnly=!0),this._FifoEnabled=!1}let s=!1;for(let a=0;a<this.GridData.length;a++)if(!e.Contains(n.e.String(this.GridData[a].DocNo))){e.push(n.e.String(this.GridData[a].DocNo));let t=0,r=0,o=0,l=0,c=0;var i=this.GridData.filter(e=>e.DocNo=="'"+this.GridData[a].DocNo+"'");if(i.length>1){s=!0;let e=!1;i.forEach(s=>{n.e.IsEmpty(s.Due)||(r+=parseFloat(s.Due.toString())),n.e.IsEmpty(s.Amount)||(t+=parseFloat(s.Amount.toString())),!n.e.IsEmpty(s.Paid)&&parseFloat(s.Paid.toString())>0?o+=parseFloat(s.Paid.toString()):e||(e=!0),n.e.IsEmpty(s.AmountPaidLC)||(c+=parseFloat(s.AmountPaidLC.toString())),n.e.IsEmpty(s.AmountPaid)||(l+=parseFloat(s.AmountPaid.toString())),s.IsClubed=1,s.sno=-1,s.StyleHeightZero=1});let h=this.GridDataObj.NewRow();for(let s=0;s<this.GridDataColumns.length;s++)"Due"==this.GridDataColumns[s]?h.Due=r:"Amount"==this.GridDataColumns[s]?h.Amount=t:"Paid"==this.GridDataColumns[s]?h.Paid=o:"AmountPaidLC"==this.GridDataColumns[s]?h.AmountPaidLC=c:"AmountPaid"==this.GridDataColumns[s]?h.AmountPaid=l:"StyleHeightZero"!=this.GridDataColumns[s]&&(h[this.GridDataColumns[s]]=i[0][this.GridDataColumns[s]]);h.IsClubed=o>0&&e?3:2,this.GridDataObj.insertRowAt(h,a)}}if(s){let e=1;for(let t=0;t<this.GridData.length;t++)"1"!=this.GridData[t].IsClubed.toString()&&(this.GridData[t].sno=e,this.GridDataObj.updateRow(this.GridData[t]),e++)}}OnBeginEdit(e){let t=e.args.item,s=e.args.column.DgCol,i=0;if(a.a.SessionManager.IsActionAssigned(43,"Do not adjust future date bills")&&!n.e.IsEmpty(t.DocDate_Key)&&this.Parent.DocumentDate<new Date(t.DocDate_Key))return this.DisplayMessage="Can not adjust future date bills",e.args.Cancel=!0,!1;if("AmountPaid"==s.DisplayMember){let e=n.e.Double(t.AmountPaid);if(n.e.IsEmpty(t.AmountPaid)||0==e){let e,s=0;e=this.GridDataColumns.Contains("IsClubed")?this.GridData.filter(e=>null==e.IsClubed||"1"!=e.IsClubed).Compute("sum","AmountPaid"):this.GridData.Compute("sum","AmountPaid"),null!=e&&null!=e&&(s=n.e.Double(e)),s=n.e.Double(this.AmtToAdjust.Text)+this.GetAdjustedDbCr()-s,a.a.SessionManager.Preferences.ContainsKey("BillwiseCurrency")&&"true"==a.a.SessionManager.Preferences.BillwiseCurrency.toLowerCase()&&!n.e.IsEmpty(t.CurrID)&&parseInt(t.CurrID.toString())==this.CurrencyID?(s>0||this.NewReference.Enable||this.DBCRVisibility&&this.GridDataDBCRObj.Table==this.GridDataDBCR)&&(t.AmountPaid=this.NewReference.Enable||this.DBCRVisibility&&this.GridDataDBCRObj.Table==this.GridDataDBCR||s>parseFloat(t.DueFC)?t.DueFC:""!=this.decimalpoints?s.ToString("N"+this.decimalpoints):s,i=0,n.e.IsEmpty(t.ExchgRate)||parseFloat(t.ExchgRate)==this.ExchangeRate?t.AmountPaidLC=""!=this.decimalpoints?(parseFloat(t.AmountPaid)*this.ExchangeRate).ToString("N"+this.decimalpoints):parseFloat(t.AmountPaid)*this.ExchangeRate:(t.AmountPaidLC=""!=this.decimalpoints?(parseFloat(t.AmountPaid)*parseFloat(t.ExchgRate)).ToString("N"+this.decimalpoints):parseFloat(t.AmountPaid)*parseFloat(t.ExchgRate),i=parseFloat(t.AmountPaid)*(parseFloat(t.ExchgRate)-this.ExchangeRate)),t.exchgl=i):(n.e.IsEmpty(t.CurrID)||parseInt(t.CurrID)!=this.CurrencyID||n.e.IsEmpty(t.ExchgRate)||parseFloat(t.ExchgRate)==this.ExchangeRate?s*=this.ExchangeRate:s*=parseFloat(t.ExchgRate),(s>0||this.NewReference.Enable||this.DBCRVisibility&&this.GridDataDBCRObj.Table==this.GridDataDBCR)&&(t.AmountPaidLC=this.NewReference.Enable||this.DBCRVisibility&&this.GridDataDBCRObj.Table==this.GridDataDBCR||s>parseFloat(t.Due)?t.Due:""!=this.decimalpoints?s.ToString("N"+this.decimalpoints):s,i=0,n.e.IsEmpty(t.CurrID)||parseInt(t.CurrID)!=this.CurrencyID||n.e.IsEmpty(t.ExchgRate)||parseFloat(t.ExchgRate)==this.ExchangeRate?t.AmountPaid=""!=this.decimalpoints?(parseFloat(t.AmountPaidLC)/this.ExchangeRate).ToString("N"+this.decimalpoints):parseFloat(t.AmountPaidLC)/this.ExchangeRate:(t.AmountPaid=""!=this.decimalpoints?(parseFloat(t.AmountPaidLC)/parseFloat(t.ExchgRate)).ToString("N"+this.decimalpoints):parseFloat(t.AmountPaidLC)/parseFloat(t.ExchgRate),i=parseFloat(t.AmountPaid)*(parseFloat(t.ExchgRate)-this.ExchangeRate)),t.exchgl=i))}}else if("AmountPaidLC"==s.DisplayMember){let e=n.e.Double(t.AmountPaidLC);if(n.e.IsEmpty(t.AmountPaidLC)||0==e){let e,s=0;e=this.GridDataColumns.Contains("IsClubed")?this.GridData.filter(e=>null==e.IsClubed||"1"!=e.IsClubed).Compute("sum","AmountPaid"):this.GridData.Compute("sum","AmountPaid"),null!=e&&null!=e&&(s=n.e.Double(e)),s=n.e.Double(this.AmtToAdjust.Text)+this.GetAdjustedDbCr()-s,n.e.IsEmpty(t.CurrID)||parseInt(t.CurrID)!=this.CurrencyID||n.e.IsEmpty(t.ExchgRate)||parseFloat(t.ExchgRate)==this.ExchangeRate?s*=this.ExchangeRate:s*=parseFloat(t.ExchgRate),(s>0||this.NewReference.Enable||this.DBCRVisibility&&this.GridDataDBCRObj.Table==this.GridDataDBCR)&&(t.AmountPaidLC=this.NewReference.Enable||this.DBCRVisibility&&this.GridDataDBCRObj.Table==this.GridDataDBCR||s>parseFloat(t.Due)?t.Due:""!=this.decimalpoints?s.ToString("N"+this.decimalpoints):s,i=0,n.e.IsEmpty(t.CurrID)||parseInt(t.CurrID)!=this.CurrencyID||n.e.IsEmpty(t.ExchgRate)||parseFloat(t.ExchgRate)==this.ExchangeRate?t.AmountPaid=""!=this.decimalpoints?(parseFloat(t.AmountPaidLC)/this.ExchangeRate).ToString("N"+this.decimalpoints):parseFloat(t.AmountPaidLC)/this.ExchangeRate:(t.AmountPaid=""!=this.decimalpoints?(parseFloat(t.AmountPaidLC)/parseFloat(t.ExchgRate)).ToString("N"+this.decimalpoints):parseFloat(t.AmountPaidLC)/parseFloat(t.ExchgRate),i=parseFloat(t.AmountPaid)*(parseFloat(t.ExchgRate)-this.ExchangeRate)),t.exchgl=i)}}}OnlinkClick(e){!this.SeletedNewRef||n.e.IsEmpty(this.SeletedNewRef.DocID)||n.e.IsEmpty(this.SeletedNewRef.CostCenterID)||V.RibbonExtViewModel.LoadDocumentByDocID(this.SeletedNewRef)}FillGriddata(e,t,s,i,r){for(let o=0;o<e.Tables[s].length;o++){let l={};l.SNO=r.length+1,l.DocSeqNo=e.Tables[s][o].DocSeqNo.toString(),this.GridDataColumns.Contains("NonAc")&&(l.NonAc=e.Tables[s][o].NonAc.toString()),this.GridDataColumns.Contains("AdjustBill")&&(l.AdjustBill="Adjust"),e.Columns[s].Contains("DocAbbr")&&e.Columns[s].Contains("DocPrefix")&&e.Columns[s].Contains("Docnumber")&&(l.DocAbbr=e.Tables[s][o].DocAbbr.toString(),l.DocPrefix=e.Tables[s][o].DocPrefix.toString(),l.Docnumber=parseInt(e.Tables[s][o].Docnumber),l.DocNoStr=e.Tables[s][o].Docnumber.toString()),e.Columns[s].Contains("CostCenterID")&&(l.CostCenterID=e.Tables[s][o].CostCenterID.toString()),e.Columns[s].Contains("VatAdvance")&&""!=e.Tables[s][o].VatAdvance.toString()&&(l.VatAdvance=e.Tables[s][o].VatAdvance.toString());let c=0;n.e.IsEmpty(e.Tables[s][o].Amount)||(c=parseFloat(e.Tables[s][o].Amount.toString())),n.e.IsEmpty(e.Tables[s][o].Paid)||(c-=parseFloat(e.Tables[s][o].Paid.toString()));let h="";if(null!=e.Tables[i]&&e.Tables[i].length>0)for(let t=0;t<e.Tables[i].length;t++)h="",h=!n.e.IsEmpty(e.Tables[i][t].CostCenterID)&&parseInt(e.Tables[i][t].CostCenterID.toString())>5e4&&parseInt(e.Tables[i][t].CostCenterID.toString())<50100?"A"+e.Tables[i][t].CostCenterID.toString():(e.Tables[i][t].Name.toString().Contains("dcAlpha"),e.Tables[i][t].Name.toString()),""!=h&&e.Columns[s].Contains(h)&&"DocDate"!=h&&"DocDueDate"!=h&&("DATE"==e.Tables[i][t].UserColumnType.toString().toUpperCase()?n.e.IsEmpty(e.Tables[s][o][h])||(l[h]=new Date(e.Tables[s][o][h].toString()).ToString(a.a.SessionManager.Preferences["Date Format"]),l[h+"_Key"]=e.Tables[s][o][h].toString()):l[h]=n.e.StringValue(e.Tables[s][o][h]).toString());if(l.CurrID=e.Tables[s][o].AdjCurrID.toString(),l.ExchgRate=e.Tables[s][o].AdjExchRT.toString(),l.CurrName=e.Tables[s][o].Name.toString(),e.Columns[s].Contains("StatusID")&&(l.StatusID=e.Tables[s][o].StatusID.toString()),this.GridDataColumns.Contains("Status_COLOR")&&("441"==l.StatusID.toString()?(l.Status_COLOR="BLUE",l.Status="UnApproved"):"371"==l.StatusID.toString()?(l.Status_COLOR="ORANGE",l.Status="UnApproved"):l.Status="Posted"),n.e.IsEmpty(e.Tables[s][o].DocDate)||(l.DocDate=new Date(e.Tables[s][o].DocDate.toString()).ToString(a.a.SessionManager.Preferences["Date Format"]),l.DocDate_Key=new Date(e.Tables[s][o].DocDate.toString())),n.e.IsEmpty(e.Tables[s][o].DocDueDate)||(l.DueDate=new Date(e.Tables[s][o].DocDueDate.toString()).ToString(a.a.SessionManager.Preferences["Date Format"]),l.DueDate_Key=new Date(e.Tables[s][o].DocDueDate.toString())),""!=this.decimalpoints){if(0==parseFloat(c.ToString("N"+this.decimalpoints))&&(!e.Columns[s].Contains("FromDocNo")||n.e.IsEmpty(e.Tables[s][o].FromDocNo)))continue;l.Due=c.ToString("N"+this.decimalpoints),n.e.IsEmpty(e.Tables[s][o].Amount)||(l.Amount=parseFloat(e.Tables[s][o].Amount.toString()).ToString("N"+this.decimalpoints)),n.e.IsEmpty(e.Tables[s][o].Paid)||(l.Paid=parseFloat(e.Tables[s][o].Paid.toString()).ToString("N"+this.decimalpoints)),n.e.IsEmpty(e.Tables[s][o].AdjExchRT)||(e.Columns[s].Contains("Paidfc")&&!n.e.IsEmpty(e.Tables[s][o].Paidfc)&&this.GridDataColumns.Contains("PaidFC")?l.PaidFC=parseFloat(e.Tables[s][o].Paidfc.toString()).ToString("N"+this.decimalpoints):!n.e.IsEmpty(e.Tables[s][o].Paid)&&this.GridDataColumns.Contains("PaidFC")&&(l.PaidFC=(parseFloat(e.Tables[s][o].Paid.toString())/parseFloat(e.Tables[s][o].AdjExchRT.toString())).ToString("N"+this.decimalpoints)),""!=e.Tables[s][o].Amount.toString()&&this.GridDataColumns.Contains("AmountFC")&&(l.AmountFC=e.Columns[s].Contains("AmountFC")?parseFloat(e.Tables[s][o].AmountFC.toString()).ToString("N"+this.decimalpoints):(parseFloat(e.Tables[s][o].Amount.toString())/parseFloat(e.Tables[s][o].AdjExchRT.toString())).ToString("N"+this.decimalpoints)),this.GridDataColumns.Contains("DueFC")&&(l.DueFC=!n.e.IsEmpty(e.Tables[s][o].Paid)&&0==parseFloat(e.Tables[s][o].Paid.toString())&&e.Columns[s].Contains("AmountFC")?parseFloat(e.Tables[s][o].AmountFC.toString()).ToString("N"+this.decimalpoints):this.GridDataColumns.Contains("PaidFC")&&!n.e.IsEmpty(l.PaidFC)?(parseFloat(e.Tables[s][o].AmountFC.toString())-parseFloat(l.PaidFC.toString())).ToString("N"+this.decimalpoints):(c/parseFloat(e.Tables[s][o].AdjExchRT.toString())).ToString("N"+this.decimalpoints)))}else l.Due=c,l.Amount=e.Tables[s][o].Amount.toString(),l.Paid=e.Tables[s][o].Paid.toString(),n.e.IsEmpty(e.Tables[s][o].AdjExchRT)||(!n.e.IsEmpty(e.Tables[s][o].Paid)&&this.GridDataColumns.Contains("PaidFC")&&(l.PaidFC=parseFloat(e.Tables[s][o].Paid.toString())/parseFloat(e.Tables[s][o].AdjExchRT.toString())),!n.e.IsEmpty(e.Tables[s][o].Amount)&&this.GridDataColumns.Contains("AmountFC")&&(l.AmountFC=e.Columns[s].Contains("AmountFC")?e.Tables[s][o].AmountFC.toString():parseFloat(e.Tables[s][o].Amount.toString())/parseFloat(e.Tables[s][o].AdjExchRT.toString())),this.GridDataColumns.Contains("DueFC")&&(l.DueFC=!n.e.IsEmpty(e.Tables[s][o].Paid)&&0==parseFloat(e.Tables[s][o].Paid)&&e.Columns[s].Contains("AmountFC")?e.Tables[s][o].AmountFC.toString():this.GridDataColumns.Contains("PaidFC")&&!n.e.IsEmpty(l.PaidFC)?parseFloat(e.Tables[s][o].AmountFC)-parseFloat(l.PaidFC):c/parseFloat(e.Tables[s][o].AdjExchRT)));if(null!=t&&t.Tables.length>0){let i=null;t.Columns[0].Contains("RefDocNo")&&(i=t.Tables[0].filter(t=>t.RefDocNo==e.Tables[s][o].DocNo.toString().Replace("'","''")&&t.RefDocSeqNo==e.Tables[s][o].DocSeqNo.toString()&&0==t.IsNewReference)),null!=i&&i.length>0?(l.AmountPaid=""!=this.decimalpoints?parseFloat(i[0].AmountFC.toString().Replace("-","")).ToString("N"+this.decimalpoints):i[0].AmountFC.toString().Replace("-",""),this.FillExchageRate(l),l.Remarks=i[0].Narration,t.Columns[0].Contains("DiscAmount")&&!n.e.IsEmpty(i[0].DiscAmount)&&(l.DiscAmount=parseFloat(i[0].DiscAmount.toString()).ToString("N"+this.decimalpoints))):t.Tables.length>1&&t.Columns[1].Contains("RefDocNo")&&(i=t.Tables[1].filter(t=>t.RefDocNo==e.Tables[s][o].DocNo.toString().Replace("'","''")),i.length>0&&(l.AmountPaid=""!=this.decimalpoints?parseFloat(i[0].Amount.toString()).ToString("N"+this.decimalpoints):i[0].Amount.toString().Replace("-",""),this.FillExchageRate(l),l.Remarks=i[0].Narration,t.Columns[1].Contains("DiscAmount")&&!n.e.IsEmpty(i[0].DiscAmount)&&(l.DiscAmount=i[0].DiscAmount.toString())))}else if(this.IsInventory&&e.Tables.length>4&&e.Columns[4].Contains("RefDocNo")){let t=e.Tables[4].filter(t=>t.RefDocNo==e.Tables[s][o].DocNo.toString().Replace("'","''")&&t.RefDocSeqNo==e.Tables[s][o].DocSeqNo.toString()&&0==t.IsNewReference);t.length>0?(l.AmountPaid=""!=this.decimalpoints?parseFloat(t[0].AmountFC.toString().Replace("-","")).ToString("N"+this.decimalpoints):t[0].AmountFC.toString().Replace("-",""),this.FillExchageRate(l),l.Remarks=t[0].Narration):e.Tables.length>5&&e.Columns[5].Contains("docno")&&(t=e.Tables[5].filter(t=>t.docno==e.Tables[s][o].DocNo.toString().Replace("'","''")&&t.DocSeqNo==e.Tables[s][o].DocSeqNo.toString()),t.length>0&&(l.AmountPaid=""!=this.decimalpoints?parseFloat(t[0].amount.toString().Replace("-","")).ToString("N"+this.decimalpoints):t[0].amount.toString().Replace("-",""),this.FillExchageRate(l)))}r.push(l)}}GetAdjustedDbCr(){if(!this.NegAmount.Visible)return 0;var e=this.GridDataDBCR.Compute("sum","AmountPaid");return null!=e&&null!=e?(this.NegAmount.Text=""!=this.decimalpoints?parseFloat(e).ToString("N"+this.decimalpoints):parseFloat(e).toString(),parseFloat(e)):(this.NegAmount.Text=""!=this.decimalpoints?(0).ToString("N"+this.decimalpoints):"0".toString(),0)}GetBillWiseDetails(e,t){if(this.GridData.Clear(),this.NewReferenceDetailsVisibility=!1,this.NewReferenceDetails.Clear(),null!=t&&t.Tables.length>0&&!t.Columns[0].Contains("ErrorMessage")){if(this.DBCRVisibility?this.FillGriddata(t,e,this.IsCredit?0:2,4,this.GridData):this.FillGriddata(t,e,0,2,this.GridData),this.FillInclExcl(),this.DBCRVisibility){let e=new n.f;null==this.drdbcr||n.e.IsEmpty(this.drdbcr.ExtraXML)||e.ReadXml(this.drdbcr.ExtraXML.toString()),this.DBCRColumnSource=[];for(let t=0;t<this.ColumnSource.length;t++)this.DBCRColumnSource.push(this.ColumnSource[t]);this.GridDataDBCR=this.GridData,this.FillGriddata(t,e,this.IsCredit?2:0,4,this.GridDataDBCR)}else if(t.Tables.length>1){if(0==this.NewReferenceDetailsColumns.length){this.NewReferenceDetailsColumns.push("SNO"),this.NewReferenceDetailsColumns.push("DocumentNo"),this.NewReferenceDetailsColumns.push("DocSeqNo"),this.NewReferenceDetailsColumns.push("DocDate"),this.NewReferenceDetailsColumns.push("DueDate"),this.NewReferenceDetailsColumns.push("DueDays"),this.NewReferenceDetailsColumns.push("AmountPaid"),this.NewReferenceDetailsColumns.push("CurrName"),this.NewReferenceDetailsColumns.push("ExchgRate"),this.NewReferenceDetailsColumns.push("AmountFC"),this.NewReferenceDetailsColumns.push("DocID"),this.NewReferenceDetailsColumns.push("CostCenterID"),this.NewReferenceDetailsColumns.push("VatAdvance");for(let e=0;e<t.Tables[2].length;e++)!n.e.IsEmpty(t.Tables[2][e].CostCenterID)&&parseInt(t.Tables[2][e].CostCenterID)>5e4?this.GridDataColumns.Contains("A"+t.Tables[2][e].CostCenterID.toString())||this.GridDataColumns.push("A"+t.Tables[2][e].CostCenterID.toString()):this.NewReferenceDetailsColumns.Contains(t.Tables[2][e].Name.toString())||this.NewReferenceDetailsColumns.push(t.Tables[2][e].Name.toString());this.NewReferenceDetailsColumns.Contains("Remarks")||this.NewReferenceDetailsColumns.push("Remarks")}for(let e=0;e<t.Tables[1].length;e++){this.NewReferenceDetailsVisibility=!0;let s=this.NewReferenceDetailsObj.NewRow();s.SNO=this.NewReferenceDetails.length+1,s.DocumentNo=t.Tables[1][e].DocNo.toString(),s.DocSeqNo=t.Tables[1][e].DocSeqNo.toString(),s.CurrName=t.Tables[1][e].Name.toString(),s.ExchgRate=t.Tables[1][e].AdjExchRT.toString(),n.e.IsEmpty(t.Tables[1][e].VatAdvance)||(s.VatAdvance=t.Tables[1][e].VatAdvance.toString()),s.DocID=t.Tables[1][e].DocID.toString(),s.CostCenterID=t.Tables[1][e].CostCenterID.toString(),n.e.IsEmpty(t.Tables[1][e].DocDate)||(s.DocDate=new Date(t.Tables[1][e].DocDate).OnlyDate()),n.e.IsEmpty(t.Tables[1][e].DocDueDate)||(s.DueDate=new Date(t.Tables[1][e].DocDueDate).OnlyDate()),""!=this.decimalpoints?(s.AmountPaid=parseFloat(t.Tables[1][e].AdjAmount.toString().replace("-","")).ToString("N"+this.decimalpoints),t.Columns[1].Contains("AmountFC")?s.AmountFC=parseFloat(t.Tables[1][e].AmountFC).ToString("N"+this.decimalpoints):!n.e.IsEmpty(s.ExchgRate)&&parseFloat(s.ExchgRate)>0&&(s.AmountFC=(parseFloat(t.Tables[1][e].AdjAmount.toString().replace("-",""))/this.ExchangeRate).ToString("N"+this.decimalpoints))):(s.AmountPaid=t.Tables[1][e].AdjAmount.toString().replace("-",""),t.Columns[1].Contains("AmountFC")?s.AmountFC=t.Tables[1][e].AmountFC.toString():!n.e.IsEmpty(s.ExchgRate)&&parseFloat(s.ExchgRate)>0&&(s.AmountFC=parseFloat(t.Tables[1][e].AdjAmount.toString().replace("-",""))/this.ExchangeRate)),s.Remarks=t.Tables[1][e].Narration,this.NewReferenceDetails.push(s)}}if(!this.DBCRVisibility&&!this.IsInventory&&t.Tables.length>5&&t.Tables[5].length>0){this.NewReferenceVisibility=!0,this.NewReferenceDt=[],this.NewReferenceDtColumns.push("SNO"),this.NewReferenceDtColumns.push("DocumentNo"),this.NewReferenceDtColumns.push("DocSeqNo"),this.NewReferenceDtColumns.push("DocDate"),this.NewReferenceDtColumns.push("DueDate"),this.NewReferenceDtColumns.push("DueDays"),this.NewReferenceDtColumns.push("Amount"),this.NewReferenceDtColumns.push("Due"),this.NewReferenceDtColumns.push("DocID"),this.NewReferenceDtColumns.push("CostCenterID");let e=new y.a;e.Header="#",e.DisplayMember="SNO",e.DataType="TextBlock",e.Width=24,e.ReadOnly=!0,this.NewRefColumnSource.push(e),e=new y.a,e.Header=a.a.GetResource("BillWise_DocumentNo"),e.DisplayMember="DocumentNo",e.DataType="TextBlock",e.Width=100,e.ReadOnly=!0,e.DataType="LINK",e.Click.Subscribe(this,"OnlinkClick"),this.NewRefColumnSource.push(e),e=new y.a,e.Header=a.a.GetResource("BillWise_DocDate"),e.DisplayMember="DocDate",e.DataType="TextBlock",e.Width=78,e.ReadOnly=!0,this.NewRefColumnSource.push(e),e=new y.a,e.Header="Total",e.DisplayMember="Amount",e.DataType="FLOAT",e.Width=80,e.ReadOnly=!0,""!=this.decimalpoints&&(e.DecimalPoints=this.decimalpoints),this.NewRefColumnSource.push(e),e=new y.a,e.Header="Due",e.DisplayMember="Due",e.DataType="FLOAT",e.Width=80,e.ReadOnly=!0,""!=this.decimalpoints&&(e.DecimalPoints=this.decimalpoints),this.NewRefColumnSource.push(e);for(let s=0;s<t.Tables[5].length;s++){let e=this.NewReferenceDtObj.NewRow();e.SNO=this.NewReferenceDt.length+1,e.DocumentNo=t.Tables[5][s].DocNo.toString(),e.DocID=t.Tables[5][s].DocID.toString(),e.CostCenterID=t.Tables[5][s].CostCenterID.toString(),n.e.IsEmpty(t.Tables[5][s].DocDate)||(e.DocDate=new Date(t.Tables[5][s].DocDate).OnlyDate()),n.e.IsEmpty(t.Tables[5][s].DocDueDate)||(e.DueDate=new Date(t.Tables[5][s].DocDueDate).OnlyDate());let i=0;n.e.IsEmpty(t.Tables[5][s].Amount)||(i=parseFloat(t.Tables[5][s].Amount)),n.e.IsEmpty(t.Tables[5][s].Paid)||(i-=parseFloat(t.Tables[5][s].Paid)),""!=this.decimalpoints?(e.Amount=parseFloat(t.Tables[5][s].Amount).ToString("N"+this.decimalpoints),e.Due=i.ToString("N"+this.decimalpoints)):(e.Amount=t.Tables[5][s].AdjAmount.toString(),e.Due=i),this.NewReferenceDt.push(e)}}}let s=0;if(null!=this.GridData.Compute("sum","AmountPaid")&&(s=parseFloat(this.GridData.Compute("sum","AmountPaid"))),this.AdjustAmt.Text=""!=this.decimalpoints?s.Commas("N"+this.decimalpoints):s.toString(),s=n.e.Double(this.AmtToAdjust.Text)+this.GetAdjustedDbCr()-s,this.NewReference.Enable){if(e.Tables.length>0&&e.Columns[0].Contains("IsNewReference")){let t=e.Tables[0].filter(e=>1==e.IsNewReference);if(t.length>0){if(s=parseFloat(t[0].AmountFC.toString().Replace("-","")),this.GridDataColumns.Contains("NonAc")){var i=this.GridData.filter(e=>1==e.NonAc).Compute("sum","AmountPaid");null!=i&&(s-=parseFloat(i))}this.NewReference.Text=""!=this.decimalpoints?s.ToString("N"+this.decimalpoints):s.toString()}}}else this.NewReference.Text=""!=this.decimalpoints?s.Commas("N"+this.decimalpoints):s.toString();this.SetBal(),this.UpdateTotals()}AddBillrows(e,t){null==t.dtmain&&(t.dtmain=[]);let s=new n.f;if(s.ReadXml(e),s.Tables.length>0&&s.Tables[0].length>0&&s.Columns[0].Contains("RefDocNo")&&s.Columns[0].Contains("AdjAmount"))for(let i=0;i<s.Tables[0].length;i++){let e={};e.VoucherNo=s.Tables[0][i].RefDocNo.toString(),e.Amt=s.Tables[0][i].AdjAmount.toString().Replace("-",""),e.SeqNo=s.Tables[0][i].RefDocSeqNo.toString(),e.AmountFC=s.Tables[0][i].AmountFC.toString().Replace("-",""),t.dtmain.push(e)}}SetBal(){let e=null;if(this.Parent.IsInventoryVoucher||null==this.Parent.SelectedRow){if(this.Parent.IsInventoryVoucher&&this.Parent.BillWisedtColumns.Contains("DocSeqNo"))for(let t=0;t<this.Parent.BillWisedt.length;t++)if(this.Parent.BillWisedt[t].AccountID.toString()==this.AccountID.toString()&&this.Parent.BillWisedt[t].DocSeqNo.toString()!=this.DocSeqNo.toString()&&!n.e.IsEmpty(this.Parent.BillWisedt[t].XML)){let s={dsmain:e};this.AddBillrows("<Billwise>"+this.Parent.BillWisedt[t].XML.toString()+"</Billwise>",s),e=s.dsmain}}else{let t;if(t=this.Parent.ScreenObject.GridData.filter(18==this.Parent.ScreenObject.DocumentType||19==this.Parent.ScreenObject.DocumentType||21==this.Parent.ScreenObject.DocumentType||22==this.Parent.ScreenObject.DocumentType?e=>e.CreditAccount_Key==this.AccountID:14==this.Parent.ScreenObject.DocumentType||15==this.Parent.ScreenObject.DocumentType||20==this.Parent.ScreenObject.DocumentType||23==this.Parent.ScreenObject.DocumentType?e=>e.DebitAccount_Key==this.AccountID:e=>e.AccountID_Key==this.AccountID),t.length>1)for(let s=0;s<t.length;s++){let i=t[s];if(!n.e.IsEmpty(i.ExtraXML)&&this.Parent.SelectedRow!=i){let t={dsmain:e};this.AddBillrows(i.ExtraXML.toString(),t),e=t.dsmain}}}if(null!=e&&e.length>0){for(let t=0;t<this.GridData.length;t++)if(!n.e.IsEmpty(this.GridData[t].DocNo)){let s=e.filter(e=>e.VoucherNo==this.GridDataDBCR[t].DocNo.toString()&&e.SeqNo==n.e.String(this.GridData[t].DocSeqNo));if(s.length>0){let e,i=0,a=0;s.forEach(e=>{n.e.IsEmpty(e.Amt)||(i+=parseFloat(e.Amt),a+=parseFloat(e.AmountFC))}),e=n.e.Double(this.GridData[t].Due),e-=i,this.GridData[t].Due=""!=this.decimalpoints?e.ToString("N"+this.decimalpoints):e,e=n.e.Double(this.GridData[t].DueFC),e-=a,this.GridData[t].DueFC=""!=this.decimalpoints?e.ToString("N"+this.decimalpoints):e}}if(this.DBCRVisibility)for(let t=0;t<this.GridDataDBCR.length;t++)if(n.e.IsEmpty(this.GridDataDBCR[t].DocNo)){let s=e.filter(e=>e.VoucherNo==this.GridDataDBCR[t].DocNo.toString()&&e.SeqNo==n.e.String(this.GridDataDBCR[t].DocSeqNo));if(s.length>0){let e,i=0,a=0;s.forEach(e=>{n.e.IsEmpty(e.Amt)||(i+=parseFloat(e.Amt.toString()),a+=parseFloat(e.AmountFC.toString()))}),e=n.e.Double(this.GridDataDBCR[t].Due),e-=i,this.GridDataDBCR[t].Due=""!=this.decimalpoints?e.ToString("N"+this.decimalpoints):e,e=n.e.Double(this.GridDataDBCR[t].DueFC),e-=a,this.GridDataDBCR[t].DueFC=""!=this.decimalpoints?e.ToString("N"+this.decimalpoints):e}}}}FillInclExcl(){let e="";for(let s=0;s<this.GridData.length;s++)!n.e.IsEmpty(this.GridData[s].VatAdvance)&&parseFloat(this.GridData[s].VatAdvance)>0&&(""!=e&&(e+="','"),e+=this.GridData[s].DocNo.toString());if(""!=e){let s=this.Parent.ScreenObject.getVatInclExcl(e);if(null!=s&&s.Tables.length>0&&s.Columns[0].Contains("IsIncl"))for(let e=0;e<s.Tables[0].length;e++){var t=this.GridData.filter(t=>t.DocNo==s.Tables[0][e].voucherno.toString());t.length>0&&t.forEach(t=>{t.IsIncl=s.Tables[0][e].IsIncl.toString()})}}}OnCellEditEnding(e){let t=e.column.DgCol.DisplayMember;"AmountPaid"!=t&&"AmountPaidLC"!=t||this.PaidChange(t,e.item,!0)}PaidChange(e,t,s){if("AmountPaid"==e||"AmountPaidLC"==e){if("AmountPaidLC"==e){let e=0;n.e.IsEmpty(t.AmountPaidLC)?t.AmountPaid=0:n.e.IsEmpty(t.CurrID)||parseInt(t.CurrID)!=this.CurrencyID||n.e.IsEmpty(t.ExchgRate)||parseFloat(t.ExchgRate)==this.ExchangeRate?t.AmountPaid=""!=this.decimalpoints?(parseFloat(t.AmountPaidLC)/this.ExchangeRate).ToString("N"+this.decimalpoints):parseFloat(t.AmountPaidLC)/this.ExchangeRate:(t.AmountPaid=""!=this.decimalpoints?(parseFloat(t.AmountPaidLC)/parseFloat(t.ExchgRate)).ToString("N"+this.decimalpoints):parseFloat(t.AmountPaidLC)/parseFloat(t.ExchgRate),e=parseFloat(t.AmountPaid)*(parseFloat(t.ExchgRate)-this.ExchangeRate)),t.exchgl=e}if(n.e.IsEmpty(t.AmountPaid)||0==parseFloat(t.AmountPaid))t.exchgl=0,t.AmountPaidLC=0;else{let e=n.e.Double(this.AmtToAdjust.Text)+this.GetAdjustedDbCr();if(this.GridDataColumns.Contains("IsClubed")){let s=this.GridData.filter(e=>e.SNO!=t.SNO&&(null==e.IsClubed||"1"!=e.IsClubed));null!=s.Compute("sum","AmountPaid")&&(e-=s.Compute("sum","AmountPaid"))}else{let s=this.GridData.filter(e=>e.SNO!=t.SNO);null!=s.Compute("sum","AmountPaid")&&(e-=s.Compute("sum","AmountPaid"))}if(e=parseFloat(e.ToString("N"+this.decimalpoints)),e<parseFloat(t.AmountPaid)&&!this.NewReference.Enable&&(s&&(e-=parseFloat(t.AmountPaid),e<-1e-4&&(this.DisplayMessage="Entered amount exceeds the amount entered in voucher")),t.AmountPaid=""!=this.decimalpoints?e.ToString("N"+this.decimalpoints):e,this.GridDataObj.updateRow(t)),a.a.SessionManager.Preferences.ContainsKey("BillwiseCurrency")&&"true"==a.a.SessionManager.Preferences.BillwiseCurrency.toLowerCase()&&!n.e.IsEmpty(t.CurrID)&&parseInt(t.CurrID.toString())==this.CurrencyID)parseFloat(t.AmountPaid)>parseFloat(t.DueFc)&&(s&&(this.DisplayMessage="Entered amount is more than due"),t.AmountPaid=parseFloat(t.DueFc),this.GridDataObj.updateRow(t));else{let e=0;e=n.e.IsEmpty(t.CurrID)||parseInt(t.CurrID)!=this.CurrencyID||n.e.IsEmpty(t.ExchgRate)||parseFloat(t.ExchgRate)==this.ExchangeRate?parseFloat(t.AmountPaid)*this.ExchangeRate:parseFloat(t.AmountPaid)*parseFloat(t.ExchgRate),""!=this.decimalpoints&&(e=parseFloat(e.ToString("N"+this.decimalpoints))),e>parseFloat(t.Due)&&(s&&(this.DisplayMessage="Entered amount is more than due"),t.AmountPaid=n.e.IsEmpty(t.CurrID)||parseInt(t.CurrID)!=this.CurrencyID||n.e.IsEmpty(t.ExchgRate)||parseFloat(t.ExchgRate)==this.ExchangeRate?parseFloat(t.Due)/this.ExchangeRate:""!=this.decimalpoints?(parseFloat(t.Due)/parseFloat(t.ExchgRate)).ToString("N"+this.decimalpoints):parseFloat(t.Due)/parseFloat(t.ExchgRate),this.GridDataObj.updateRow(t))}this.FillExchageRate(t)}let i;if(i=this.GridDataColumns.Contains("IsClubed")?this.GridData.filter(e=>null==e.IsClubed||"1"!=e.IsClubed).Compute("sum","AmountPaid"):this.GridData.Compute("sum","AmountPaid"),null!=i||""!=this.DbCrNetFld?(null==i&&(i=0),""!=this.decimalpoints?(this.AdjustAmt.Text=parseFloat(i).Commas("N"+this.decimalpoints),this.NewReference.Enable||(this.NewReference.Text=(n.e.Double(this.AmtToAdjust.Text)+this.GetAdjustedDbCr()-parseFloat(i)).Commas("N"+this.decimalpoints))):(this.AdjustAmt.Text=i.toString(),this.NewReference.Enable||(this.NewReference.Text=(n.e.Double(this.AmtToAdjust.Text)+this.GetAdjustedDbCr()-parseFloat(i)).toString()))):(this.AdjustAmt.Text=""!=this.decimalpoints?(0).ToString("N"+this.decimalpoints):"0",this.NewReference.Enable||(this.NewReference.Text=this.AmtToAdjust.Text)),!n.e.IsEmpty(t.VatAdvance)&&parseFloat(t.VatAdvance)>0&&"1"!=t.IsIncl.toString()&&!n.e.IsEmpty(t.Amount)&&parseFloat(t.Amount)>0&&parseFloat(t.AmountPaid)*this.ExchangeRate>this.TotTaxableAmt)return void(this.DisplayMessage="Can not adjust more than:"+this.TotTaxableAmt.ToString("N"+this.decimalpoints)+" from "+t.DocNo.toString());this.UpdateTotals()}}FillExchageRate(e){let t=0;!n.e.IsEmpty(e.AmountPaid)&&parseFloat(e.AmountPaid)>0&&(this.IsCredit?n.e.IsEmpty(e.CurrID)||parseInt(e.CurrID)!=this.CurrencyID||n.e.IsEmpty(e.ExchgRate)||parseFloat(e.ExchgRate)==this.ExchangeRate?e.AmountPaidLC=""!=this.decimalpoints?(parseFloat(e.AmountPaid)*this.ExchangeRate).ToString("N"+this.decimalpoints):parseFloat(e.AmountPaid)*this.ExchangeRate:(e.AmountPaidLC=""!=this.decimalpoints?(parseFloat(e.AmountPaid)*parseFloat(e.ExchgRate)).ToString("N"+this.decimalpoints):parseFloat(e.AmountPaid)*parseFloat(e.ExchgRate),t=parseFloat("-"+e.AmountPaid)*(parseFloat(e.ExchgRate)-this.ExchangeRate)):n.e.IsEmpty(e.CurrID)||parseInt(e.CurrID)!=this.CurrencyID||n.e.IsEmpty(e.ExchgRate)||parseFloat(e.ExchgRate)==this.ExchangeRate?e.AmountPaidLC=""!=this.decimalpoints?(parseFloat(e.AmountPaid)*this.ExchangeRate).ToString("N"+this.decimalpoints):parseFloat(e.AmountPaid)*this.ExchangeRate:(e.AmountPaidLC=""!=this.decimalpoints?(parseFloat(e.AmountPaid)*parseFloat(e.ExchgRate)).ToString("N"+this.decimalpoints):parseFloat(e.AmountPaid)*parseFloat(e.ExchgRate),t=parseFloat(e.AmountPaid)*(parseFloat(e.ExchgRate)-this.ExchangeRate))),e.exchgl=t}OnSave(e){let t={Message:""};if("Fifo"==e.toString())this.Fifo=!this.Fifo;else if("Disc"==e.toString()&&null!=this.SelectedRow){let e;!n.e.IsEmpty(this.SelectedRow.AmountPaid)&&n.e.Double(this.SelectedRow.DueFC)>0&&(e-=parseFloat(this.SelectedRow.AmountPaid.toString()),this.SelectedRow.DiscAmount=e.ToString("N"+this.decimalpoints),this.GridDataObj.updateRow(this.SelectedRow))}else if("ImportVisiblity"==e.toString())a.a.SessionManager.PersonalSettings.ContainsKey("BillwiseWidth")&&isFinite(a.a.SessionManager.PersonalSettings.BillwiseWidth)?(this.Width=n.e.Double(a.a.SessionManager.PersonalSettings.BillwiseWidth),this.GridWidth=this.Width-270):(this.Width=1050,this.GridWidth=780),this.ImportVisiblity=!0;else if("CancelImport"==e.toString())this.ImportVisiblity=!1,a.a.SessionManager.PersonalSettings.ContainsKey("BillwiseWidth")&&isFinite(a.a.SessionManager.PersonalSettings.BillwiseWidth)?(this.Width=n.e.Double(a.a.SessionManager.PersonalSettings.BillwiseWidth),this.GridWidth=this.Width-20):(this.Width=800,this.GridWidth=780);else if("Import"==e.toString())this.ImportData();else if("Open"==e.toString());else if("openfile"==e.toString());else if("OK"==e.toString())this.GridDataObj.commitEdit(),this.Parent.BillWisedtColumns.Contains("DocSeqNo")?this.Parent.BillWisedt.filter(e=>e.AccountID=this.AccountID&&e.DocSeqNo==this.DocSeqNo&&e.IsCredit==this.IsCredit&&e.CurrencyID==this.CurrencyID)[0].XML=this.GetXml(!1,t):(this.Parent.BillWisedt.filter(e=>e.AccountID==this.AccountID&&e.IsCredit==this.IsCredit&&e.CurrencyID==this.CurrencyID)[0].XML=this.GetXml(!1,t),null!=this.VatAdvanceXML&&this.VatAdvanceXML.length>0&&(this.Parent.BillWisedt.filter(e=>e.AccountID==this.AccountID&&e.IsCredit==this.IsCredit&&e.CurrencyID==this.CurrencyID)[0].DocXML=this.VatAdvanceXML));else if("SelectionChanged"==e.toString())null!=this.Accounts.SelectedItem&&this.FillSelectedAccountDetails(this.Accounts.SelectedItem);else if("SearchSelectionChanged"==e.toString());else if("Save"==e.toString()||"autosave"==e.toString()||"Distsave"==e.toString()||"CntrlSave"==e.toString()){this.GridDataObj.commitEdit(),null!=this.SelectedRow&&"CntrlSave"==e.toString()&&this.PaidChange("AmountPaid",this.SelectedRow,!1);let s=null,i="";if(this.IsInventory||null==this.Parent.SelectedRow){if(this.Parent.BillWisedt.length>0){if(this.Parent.BillWisedtColumns.Contains("DocSeqNo")?this.Parent.BillWisedt.filter(e=>e.AccountID==this.AccountID&&e.DocSeqNo==this.DocSeqNo&&e.IsCredit==this.IsCredit&&e.CurrencyID==this.CurrencyID)[0].XML=this.GetXml(!1,t):(this.Parent.BillWisedt.filter(e=>e.AccountID==this.AccountID&&e.IsCredit==this.IsCredit&&e.CurrencyID==this.CurrencyID)[0].XML=this.GetXml(!1,t),null!=this.VatAdvanceXML&&this.VatAdvanceXML.length>0&&(this.Parent.BillWisedt.filter(e=>e.AccountID==this.AccountID&&e.IsCredit==this.IsCredit&&e.CurrencyID==this.CurrencyID)[0].DocXML=this.VatAdvanceXML)),""!=t.Message)return;for(let e=0;e<this.Accounts.Items.length;e++){let t=this.Accounts.Items[e],s="";s=t.CurrID>0?t.CurrID.toString():this.CurrencyID.toString();let i="";if(i=this.Parent.BillWisedtColumns.Contains("DocSeqNo")?n.e.String(this.Parent.BillWisedt.filter(e=>e.AccountID==this.AccountID&&e.DocSeqNo==t.Seq&&e.IsCredit==this.IsCredit&&e.CurrencyID==this.CurrencyID)[0].XML):n.e.String(this.Parent.BillWisedt.filter(e=>e.AccountID==t.Value&&e.IsCredit==t.Status&&e.CurrencyID==s)[0].XML),""==i)return this.DisplayMessage="Select BillWise for "+t.Name,void(this.Parent.BillWisedtColumns.Contains("DocSeqNo")&&(this.DisplayMessage+=" sno:"+t.Seq))}this.Parent.DialogResult=!0,a.a.page.HideDialog(),this.Parent.IsInventoryVoucher&&this.Parent.SaveDocument()}}else{!(a.a.SessionManager.Preferences.ContainsKey("DistributeCost")&&"True"==a.a.SessionManager.Preferences.DistributeCost&&a.a.SessionManager.Preferences.ContainsKey("CostBasedON")&&"True"==a.a.SessionManager.Preferences.CostBasedON&&a.a.SessionManager.Preferences.ContainsKey("CostBasedONDims"))||n.e.IsEmpty(a.a.SessionManager.Preferences.CostBasedONDims)||(this.Parent.ScreenObject.GridDataColumns.Contains("IsDistributed")&&"1"==n.e.String(this.Parent.SelectedRow.IsDistributed)||!n.e.IsEmpty(this.Parent.SelectedRow.DocDetailsID)&&parseInt(this.Parent.SelectedRow.DocDetailsID.toString())>0)&&"Distsave"!=e.toString()||this.Parent.ScreenObject.Preferences.ContainsKey("DistributeCost")&&"True"==this.Parent.ScreenObject.Preferences.DistributeCost.toString()||(s=a.a.SessionManager.Preferences.CostBasedONDims.split(","),s.forEach(e=>{parseInt(e)>5e4&&(i+=",DCCCNID"+(parseInt(e)-5e4))}),s=a.a.SessionManager.Preferences.DistributeCostDims.split(","),s.forEach(e=>{parseInt(e)>5e4&&(i+=",DCCCNID"+(parseInt(e)-5e4))}),this.Parent.ScreenObject.GridDataColumns.Contains("IsDistributed")||this.Parent.ScreenObject.GridDataColumns.push("IsDistributed"));let r=this.GetXml(!0,t,i);if(""!=t.Message)return;if(("<BillWise>  </BillWise>"!=r||""==i||n.e.IsEmpty(this.Parent.SelectedRow.ExtraXML))&&(this.Parent.SelectedRow.ExtraXML=r),this.NewReference.Enable&&!(null!=this.dtccData&&this.dtccData.length>1)){let e=0;e=isFinite(this.NewReference.Text)?n.e.Double(this.NewReference.Text):0,e+=n.e.Double(this.AdjustAmt.Text),this.Parent.ScreenObject.GridDataColumns.Contains("Amount")&&(this.Parent.SelectedRow.Amount=e)}if(this.VatAdvanceXML.length>0?this.Parent.SelectedRow.DiscXML="<DiscXML>"+this.VatAdvanceXML+"</DiscXML>":this.Parent.ScreenObject.GridDataColumns.Contains("DiscXML")&&!n.e.IsEmpty(this.Parent.SelectedRow.DiscXML)&&(this.Parent.SelectedRow.DiscXML=null),this.DBCRVisibility){if(""!=this.DbCrNetFld){let e=0;e=n.e.Double(this.NewReference.Text)>0?parseFloat(this.NewReference.Text):0,e+=parseFloat(this.AdjustAmt.Text),this.Parent.ScreenObject.GridDataColumns.Contains("Amount")&&(this.Parent.SelectedRow.Amount=e)}t={Message:""},this.GetDBCRXml(t)}this.Parent.DialogResult=!0,this.Parent.ScreenObject.GridDataObj.updateRow(this.Parent.SelectedRow),"autosave"!=e.toString()&&a.a.page.HideDialog()}}else{if("Post"==e.toString()){if(this.GridDataObj.commitEdit(),this.IsInventory||null==this.Parent.SelectedRow){let e=this.GetXml(!0,t);if(""!=t.Message)return;return void(this.DisplayMessage=this.Parent.ScreenObject.PostBillWiseDetails(this.AccountID,this.IsCredit,0,this.DocSeqNo,this.Parent.DocumentDate,e,this.Parent.ScreenObject.guid,{RetValue:0}))}{if(this.Parent.SelectedRow.ExtraXML=this.GetXml(!0,t),""!=t.Message)return;let e=0;this.IsInventory||null==this.Parent.SelectedRow||n.e.IsEmpty(this.Parent.SelectedRow.DocSeqNo)||(this.DocSeqNo=parseInt(this.Parent.SelectedRow.DocSeqNo)),this.IsInventory||null==this.Parent.SelectedRow||!this.Parent.ScreenObject.GridDataColumns.Contains("OldSeqNo")||n.e.IsEmpty(this.Parent.SelectedRow.OldSeqNo)||(this.DocSeqNo=parseInt(this.Parent.SelectedRow.OldSeqNo)),this.IsInventory||null==this.Parent.SelectedRow||n.e.IsEmpty(this.Parent.SelectedRow.DocDetailsID)||(e=parseInt(this.Parent.SelectedRow.DocDetailsID));let s={RetValue:0};return void(this.DisplayMessage=this.Parent.ScreenObject.PostBillWiseDetails(this.AccountID,this.IsCredit,e,this.DocSeqNo,this.Parent.DocumentDate,this.Parent.SelectedRow.ExtraXML.toString(),this.Parent.ScreenObject.guid,s))}}"Cancel"==e.toString()&&(this.Parent.DialogResult=!1,a.a.page.HideDialog())}}ImportData(){}FillSelectedAccountDetails(e){this.AccountID=parseInt(e.Value),this.IsCredit=e.Status,this.AmtToAdjust.Text=e.Aliasname,this.NewReference.Text=e.Aliasname,this.AdjustAmt.Text="0",this.CurrencyID=e.CurrID,this.ExchangeRate=e.ExchgRate,this.Parent.BillWisedtColumns.Contains("DocSeqNo")&&(this.DocSeqNo=e.Seq),this.BindExchageRate();let t="";this.Parent.ScreenObject.IsDocEdit&&(t=this.Parent.ScreenObject.VoucherNo);let s=this.Parent.ScreenObject.GetBillWiseDetails(this.AccountID,"",this.IsCredit,t,this.DocSeqNo,null,this.Parent.DocumentDate);this.GetBillWiseDetails(null,s)}AdjustBills(){if(this.Fifo){let e=n.e.Double(this.AmtToAdjust.Text)+this.GetAdjustedDbCr();for(let t=0;t<this.GridData.length;t++){if(this.GridDataColumns.Contains("IsClubed")&&"1"==n.e.String(this.GridData[t].IsClubed))continue;if(a.a.SessionManager.IsActionAssigned(43,"Do not adjust future date bills")&&!n.e.IsEmpty(this.GridData[t].DocDate_Key)&&this.Parent.DocumentDate<new Date(this.GridData[t].DocDate_Key))continue;let s=0;a.a.SessionManager.Preferences.ContainsKey("BillwiseCurrency")&&"true"==a.a.SessionManager.Preferences.BillwiseCurrency.toLowerCase()&&!n.e.IsEmpty(this.GridData[t].CurrID)&&parseInt(this.GridData[t].CurrID.toString())==this.CurrencyID?s=parseFloat(this.GridData[t].DueFc):(s=parseFloat(this.GridData[t].Due),n.e.IsEmpty(this.GridData[t].CurrID)||parseInt(this.GridData[t].CurrID)!=this.CurrencyID||n.e.IsEmpty(this.GridData[t].ExchgRate)||parseFloat(this.GridData[t].ExchgRate)==this.ExchangeRate?s/=this.ExchangeRate:s/=parseFloat(this.GridData[t].ExchgRate),s=parseFloat(s.ToString("N"+this.decimalpoints))),e>=s?(this.GridData[t].AmountPaid=s,e-=s):!n.e.IsEmpty(this.GridData[t].VatAdvance)&&parseFloat(this.GridData[t].VatAdvance)>0&&"1"!=this.GridData[t].IsIncl.toString()&&e*this.ExchangeRate>this.TotTaxableAmt?(this.GridData[t].AmountPaid=""!=this.decimalpoints?this.TotTaxableAmt.ToString("N"+this.decimalpoints):this.TotTaxableAmt,e-=this.TotTaxableAmt):(this.GridData[t].AmountPaid=""!=this.decimalpoints?e.ToString("N"+this.decimalpoints):e,e=0),this.FillExchageRate(this.GridData[t]),this.GridDataObj.updateRow(this.GridData[t])}""!=this.decimalpoints?(this.AdjustAmt.Text=(n.e.Double(this.AmtToAdjust.Text)+this.GetAdjustedDbCr()-e).Commas("N"+this.decimalpoints),this.NewReference.Text=e.Commas("N"+this.decimalpoints)):(this.AdjustAmt.Text=(n.e.Double(this.AmtToAdjust.Text)+this.GetAdjustedDbCr()-e).toString(),this.NewReference.Text=e.toString())}else{for(let e=0;e<this.GridData.length;e++)this.GridData[e].AmountPaid=0,this.GridData[e].exchgl=0,this.GridData[e].AmountPaidLC=0,this.GridDataObj.updateRow(this.GridData[e]);this.AdjustAmt.Text="0",this.NewReference.Text=this.AmtToAdjust.Text}}AdjustClubbedRows(){for(let t=0;t<this.GridData.length;t++)if(this.GridDataColumns.Contains("IsClubed")&&("2"==n.e.String(this.GridData[t].IsClubed)||"3"==n.e.String(this.GridData[t].IsClubed))&&!n.e.IsEmpty(this.GridData[t].AmountPaid)&&parseFloat(this.GridData[t].AmountPaid.toString())>0){let s,i=0,a=parseFloat(this.GridData[t].AmountPaid.toString()),r=parseFloat(this.GridData.filter(e=>e.IsClubed=e.DocNo=="'"+this.GridData[t].DocNo.toString()+"'").Compute("sum","Amount"));var e=this.GridData.filter(e=>1==e.IsClubed&&e.DocNo=="'"+this.GridData[t].DocNo.toString()+"'");for(let o=0;o<e.length;o++)if("2"==n.e.String(this.GridData[t].IsClubed))s=o==e.length-1?a-i:parseFloat(e[o].Amount)/r*a,s=parseFloat(s.ToString("N"+this.decimalpoints)),e[o].AmountPaid=s,i+=s;else{if(s=parseFloat(e[o].Due.toString()),s=parseFloat(s.ToString("N"+this.decimalpoints)),!(a>s)){e[o].AmountPaid=a;break}e[o].AmountPaid=s,a-=s}}}GetDBCRXml(e){e.Message="",0==this.CurrencyID&&(this.CurrencyID=1),0==this.ExchangeRate&&(this.ExchangeRate=1);let t="";t+="<BillWise> ";let s=0,i=0;for(let a=0;a<this.GridDataDBCR.length;a++)if((!this.GridDataColumns.Contains("IsClubed")||"2"!=this.GridDataDBCR[a].IsClubed.toString()&&"3"!=this.GridDataDBCR[a].IsClubed.toString())&&(!this.GridDataColumns.Contains("NonAc")||"1"!=this.GridDataDBCR[a].NonAc.toString())&&(this.GridDataColumns.Contains("ExchgRate")&&null!=this.GridDataDBCR[a].ExchgRate&&!n.e.IsEmpty(this.GridDataDBCR[a].ExchgRate)&&"0"==this.GridDataDBCR[a].ExchgRate.toString()&&(this.GridDataDBCR[a].ExchgRate="1"),!n.e.IsEmpty(this.GridDataDBCR[a].AmountPaid)&&parseFloat(this.GridDataDBCR[a].AmountPaid.toString())>0)){let e=parseFloat(this.GridDataDBCR[a].AmountPaid.toString());i+=e,t+="<Row ",t+=null!=this.drdbcr?'DocSeqNo="'+this.drdbcr.DocSeqNo.toString()+'" ':'DocSeqNo="1" ',t+='AccountID="'+this.AccountID.toString()+'" ',this.IsCredit?(t+='AmountFC="'+e+'" ',this.GridDataColumns.Contains("CurrID")&&this.GridDataColumns.Contains("ExchgRate")&&!n.e.IsEmpty(this.GridDataDBCR[a].CurrID)&&parseInt(this.GridDataDBCR[a].CurrID.toString())==this.CurrencyID&&!n.e.IsEmpty(this.GridDataDBCR[a].ExchgRate)&&parseFloat(this.GridDataDBCR[a].ExchgRate.toString())!=this.ExchangeRate?(t+=""!=this.decimalpoints?'AdjAmount="'+(e*parseFloat(this.GridDataDBCR[a].ExchgRate.toString())).ToString("N"+this.decimalpoints)+'" ':'AdjAmount="'+e*parseFloat(this.GridDataDBCR[a].ExchgRate.toString())+'" ',t+='AdjExchRT="'+this.GridDataDBCR[a].ExchgRate.toString()+'" ',s+=e*(parseFloat(this.GridDataDBCR[a].ExchgRate.toString())-this.ExchangeRate)):(t+=""!=this.decimalpoints?'AdjAmount="'+(e*this.ExchangeRate).ToString("N"+this.decimalpoints)+'" ':'AdjAmount="'+e*this.ExchangeRate+'" ',t+='AdjExchRT="'+this.ExchangeRate.toString()+'" ')):(t+='AmountFC="-'+e+'" ',this.GridDataColumns.Contains("CurrID")&&this.GridDataColumns.Contains("ExchgRate")&&!n.e.IsEmpty(this.GridDataDBCR[a].CurrID)&&parseInt(this.GridDataDBCR[a].CurrID.toString())==this.CurrencyID&&!n.e.IsEmpty(this.GridDataDBCR[a].ExchgRate)&&parseFloat(this.GridDataDBCR[a].ExchgRate.toString())!=this.ExchangeRate?(t+=""!=this.decimalpoints?'AdjAmount="-'+(e*parseFloat(this.GridDataDBCR[a].ExchgRate.toString())).ToString("N"+this.decimalpoints)+'" ':'AdjAmount="-'+e*parseFloat(this.GridDataDBCR[a].ExchgRate.toString())+'" ',t+='AdjExchRT="'+this.GridDataDBCR[a].ExchgRate.toString()+'" ',s+=e*(parseFloat(this.GridDataDBCR[a].ExchgRate.toString())-this.ExchangeRate)):(t+=""!=this.decimalpoints?'AdjAmount="-'+(e*this.ExchangeRate).ToString("N"+this.decimalpoints)+'" ':'AdjAmount="-'+e*this.ExchangeRate+'" ',t+='AdjExchRT="'+this.ExchangeRate.toString()+'" ')),"0"!=this.CurrencyID.toString()?t+='AdjCurrID="'+this.CurrencyID.toString()+'" ':"0"==this.CurrencyID.toString()&&(t+='AdjCurrID="1" '),t+='IsNewReference="0" ',t+='RefDocNo="'+u.d.GetValidXml(n.e.String(this.GridDataDBCR[a].DocNo))+'" ',t+='RefStatusID="'+n.e.String(this.GridDataDBCR[a].StatusID)+'" ',t+='RefDocSeqNo="'+n.e.String(this.GridDataDBCR[a].DocSeqNo)+'" ',n.e.IsEmpty(this.GridDataDBCR[a].DocDate_Key)||(t+='RefDocDate="'+new Date(this.GridDataDBCR[a].DocDate_Key.toString()).ToString("dd/MMM/yyyy")+'" '),n.e.IsEmpty(this.GridDataDBCR[a].DueDate_Key)||(t+='RefDocDueDate="'+new Date(this.GridDataDBCR[a].DueDate_Key.toString()).ToString("dd/MMM/yyyy")+'" '),t+='Narration="'+n.e.String(this.GridDataDBCR[a].Remarks)+'" ',t+='DiscAmount="0" ',t+='IsDocPDC="0" >',t+=" </Row>"}if(t+=" </BillWise>",i>0){if(null==this.drdbcr){18!=this.Parent.DocumentType&&19!=this.Parent.DocumentType&&21!=this.Parent.DocumentType&&22!=this.Parent.DocumentType||!this.Parent.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")?14!=this.Parent.DocumentType&&15!=this.Parent.DocumentType&&20!=this.Parent.DocumentType&&23!=this.Parent.DocumentType||!this.Parent.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")?this.Parent.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&(this.drdbcr=this.Parent.ScreenObject.GridData[this.Parent.GetEmptyRowPosition(this.Parent.ScreenObject.GridDataObj,"AccountID_Key")]):this.drdbcr=this.Parent.ScreenObject.GridData[this.Parent.GetEmptyRowPosition(this.Parent.ScreenObject.GridDataObj,"DebitAccount_Key")]:this.drdbcr=this.Parent.ScreenObject.GridData[this.Parent.GetEmptyRowPosition(this.Parent.ScreenObject.GridDataObj,"CreditAccount_Key")];for(let e=0;e<this.Parent.ScreenObject.GridDataColumns.length;e++)"DocDetailsID"!=this.Parent.ScreenObject.GridDataColumns[e]&&(this.drdbcr[this.Parent.ScreenObject.GridDataColumns[e]]=this.Parent.SelectedRow[this.Parent.ScreenObject.GridDataColumns[e]]);this.Parent.ScreenObject.GridDataColumns.Contains("guidCol")||this.Parent.ScreenObject.GridDataColumns.push("guidCol"),this.drdbcr.guidCol=n.e.NewGuid(),this.Parent.SelectedRow.guidCol=this.drdbcr.guidCol}this.drdbcr.Amount=-i,""!=this.DbCrNetFld&&(this.Parent.ScreenObject.Preferences.ContainsKey("NegAmountFld")&&!n.e.IsEmpty(this.Parent.ScreenObject.Preferences.NegAmountFld)&&this.Parent.ScreenObject.GridDataColumns.Contains(this.Parent.ScreenObject.Preferences.NegAmountFld)?this.Parent.SelectedRow[this.Parent.ScreenObject.Preferences.NegAmountFld]=-i:i>0&&(this.Parent.DisplayMessage="Define Neg Amount field",this.Parent.MessageVisibility=!0),this.Parent.CalculateTotals(this.Parent.SelectedRow,!1,this.DbCrNetFld),this.Parent.CalculateTotals(this.drdbcr,!1,this.DbCrNetFld),this.Parent.ScreenObject.GridDataColumns.Contains("StyleHeightZero")?"1"!=n.e.String(this.drdbcr.StyleHeightZero)&&(this.Parent.ScreenObject.GridDataColumns.push("tempcol"),this.drdbcr.StyleHeightZero=1,this.Parent.ScreenObject.GridDataColumns.Remove("tempcol")):(this.Parent.ScreenObject.GridDataColumns.push("StyleHeightZero"),this.drdbcr.StyleHeightZero=1)),this.Parent.ScreenObject.UpdateSequence(),this.drdbcr.ExtraXML=t.toString();let e=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&50403==e.LinkData);e.length>0&&this.Parent.ScreenObject.GridDataColumns.Contains(e[0].SysColumnName.toString())?(this.drdbcr[e[0].SysColumnName.toString()]=s,e[0].SysColumnName.toString().toLowerCase().Contains("dcnum")&&(this.drdbcr["dcCalc"+e[0].SysColumnName.toString()]=s)):0!=s&&(this.Parent.DisplayMessage="Define Exchange gain or loss field",this.Parent.MessageVisibility=!0)}else null!=this.drdbcr&&this.Parent.ClearDatarow(this.drdbcr,!0)}GetXml(e,t,s=""){if(t.Message="",this.VatAdvanceXML="",!this.NewReference.Enable||null!=this.dtccData&&this.dtccData.length>1){let e,s=n.e.Double(this.AmtToAdjust.Text);if(e=this.GridDataColumns.Contains("IsClubed")?this.GridData.filter(e=>null==e.IsClubed||"1"!=e.IsClubed).Compute("sum","AmountPaid"):this.GridData.Compute("sum","AmountPaid"),null!=e&&null!=e&&(s-=parseFloat(e)),s=parseFloat(s.ToString("N"+this.decimalpoints)),s<-1e-4)return t.Message=this.DisplayMessage="Entered amount exceeds the amount entered in voucher",""}0==this.CurrencyID&&(this.CurrencyID=1),0==this.ExchangeRate&&(this.ExchangeRate=1);let i=0;if(n.e.Double(this.NewReference.Text)>0&&(i=parseFloat((n.e.Double(this.NewReference.Text)*this.ExchangeRate).ToString("N"+this.decimalpoints))),i>0&&this.Parent.ScreenObject.Preferences.ContainsKey("DisableNewReference")&&!n.e.IsEmpty(this.Parent.ScreenObject.Preferences.DisableNewReference)&&Object(o.j)(this.Parent.ScreenObject.Preferences.DisableNewReference))return this.DisplayMessage="New Reference is Disabled",t.Message=this.DisplayMessage,"";if(this.NewReferenceDetailsVisibility&&this.NewReferenceDetails.length>0){let e=0,s=0;1==this.Parent.ScreenObject.DocumentType||27==this.Parent.ScreenObject.DocumentType||26==this.Parent.ScreenObject.DocumentType||25==this.Parent.ScreenObject.DocumentType||2==this.Parent.ScreenObject.DocumentType||34==this.Parent.ScreenObject.DocumentType||6==this.Parent.ScreenObject.DocumentType||3==this.Parent.ScreenObject.DocumentType||4==this.Parent.ScreenObject.DocumentType||13==this.Parent.ScreenObject.DocumentType?null!=this.Parent.ScreenObject.CreditAccount&&this.Parent.ScreenObject.CreditAccount.SelectedValue>0&&(e=this.Parent.ScreenObject.CreditAccount.SelectedValue):11!=this.Parent.ScreenObject.DocumentType&&5!=this.Parent.ScreenObject.DocumentType&&7!=this.Parent.ScreenObject.DocumentType&&9!=this.Parent.ScreenObject.DocumentType&&24!=this.Parent.ScreenObject.DocumentType&&33!=this.Parent.ScreenObject.DocumentType&&10!=this.Parent.ScreenObject.DocumentType&&8!=this.Parent.ScreenObject.DocumentType&&12!=this.Parent.ScreenObject.DocumentType||null!=this.Parent.ScreenObject.DebitAccount&&this.Parent.ScreenObject.DebitAccount.SelectedValue>0&&(e=this.Parent.ScreenObject.DebitAccount.SelectedValue),this.AccountID==e&&n.e.IsValidID(this.Parent.ScreenObject.PostVoucherDocID)&&(s=this.Parent.ScreenObject.PostVoucherAmount);let r=this.NewReferenceDetails.Compute("sum","AmountPaid");if(null!=r&&parseFloat(parseFloat(r).ToString("N"+this.decimalpoints))-s>i)return this.DisplayMessage=a.a.GetResource("Doc_BillWiseNewRef"),t.Message=this.DisplayMessage,""}let l=0;5==this.Parent.DocumentType&&(l="0"!=this.Parent.BillWisedt.filter(e=>e.AccountID==this.AccountID&&e.IsCredit==this.IsCredit&&e.CurrencyID==this.CurrencyID)[0].FromTo.toString()?1:-1);let c,h="";e&&(h+="<BillWise> "),c=""!=this.decimalpoints?(n.e.Double(this.NewReference.Text)*this.ExchangeRate).ToString("N"+this.decimalpoints):(n.e.Double(this.NewReference.Text)*this.ExchangeRate).toString();let d=this.NewReference.Text.RemoveComma();if(this.GridDataColumns.Contains("NonAc")){let e=this.GridData.filter(e=>1==e.NonAc).Compute("sum","AmountPaid");null!=e&&(d=(parseFloat(d)+parseFloat(e)).ToString("N"+this.decimalpoints),c=(parseFloat(c)+parseFloat(e)).ToString("N"+this.decimalpoints))}let D=0,S=0;if(this.IsInventory||(S=this.Parent.ScreenObject.GridData.indexOf(this.Parent.SelectedRow)),parseFloat(d)>0){let e=1,i=0,r=0,o=null;if(""!=s){var b=a.a.SessionManager.Preferences.CostBasedONDims.split(",");let t="",s=!1;b.forEach(e=>{if(parseInt(e)>5e4)if(this.Parent.ScreenObject.GridDataColumns.Contains("DCCCNID"+(parseInt(e)-5e4)+"_Key"))n.e.IsEmpty(this.Parent.SelectedRow["DCCCNID"+(parseInt(e)-5e4)+"_Key"])||(t+=" and DCCCNID"+(parseInt(e)-5e4)+"="+this.Parent.SelectedRow["DCCCNID"+(parseInt(e)-5e4)+"_Key"].toString());else{var i=this.Parent.ScreenObject._CCFields.find(t=>t instanceof m.b&&t.CCID==parseInt(e));null!=i&&i.SelectedValue>0&&(t+=" and DCCCNID"+(parseInt(e)-5e4)+"="+i.SelectedValue.toString())}else 2==parseInt(e)?t+=" and AccountID in("+this.AccountID+",0)":502==parseInt(e)&&(s=!0,t+=" and (db.AccountID is not null or Cr.AccountID is not null)")}),o=this.Parent.ScreenObject.getProfileBasedon(this.AccountID,0,s,t),null!=o&&o.Tables.length>0&&o.Columns[0].Contains("ProfileID")&&o.Tables[0].length>0&&(e=o.Tables[0].length)}var C=a.a.SessionManager.Preferences.DistributeCostDims.split(",");for(let s=0;s<e;s++){if(e>1?(s+1==o.Tables[0].length?r=parseFloat((parseFloat(d)-i).ToString("N"+a.a.SessionManager.Preferences.DecimalsinAmount.toString())):!n.e.IsEmpty(o.Tables[0][s].Percent)&&parseFloat(o.Tables[0][s].Percent.toString())>0?r=parseFloat((parseFloat(d)*parseFloat(o.Tables[0][s].Percent.toString())/100).ToString("N"+a.a.SessionManager.Preferences.DecimalsinAmount.toString())):!n.e.IsEmpty(o.Tables[0][s].Amount)&&parseFloat(o.Tables[0][s].Amount.toString())>0&&(r=parseFloat(o.Tables[0][s].Amount.toString())),i+=r):r=parseFloat(d),a.a.SessionManager.Preferences.ContainsKey("ExclZerodist")&&"True"==a.a.SessionManager.Preferences.ExclZerodist&&0==r)continue;let u=null;if(D>0){u=this.Parent.ScreenObject.GridDataObj.NewRow(),this.Parent.ScreenObject.GridDataObj.insertRowAt(u,S+D);for(let e=0;e<this.Parent.ScreenObject.GridDataColumns.length;e++)"DocDetailsID"!=this.Parent.ScreenObject.GridDataColumns[e]&&(u[this.Parent.ScreenObject.GridDataColumns[e]]=this.Parent.SelectedRow[this.Parent.ScreenObject.GridDataColumns[e]])}else null!=o&&o.Tables.length>0&&o.Columns[0].Contains("ProfileID")&&o.Tables[0].length>0&&(u=this.Parent.SelectedRow);if(null!=o&&o.Tables.length>0&&o.Columns[0].Contains("ProfileID")&&o.Tables[0].length>0&&(C.forEach(e=>{parseInt(e)>5e4&&o.Columns[0].Contains("DCCCNID"+(parseInt(e)-5e4))&&!n.e.IsEmpty(o.Tables[0][s]["DCCCNID"+(parseInt(e)-5e4)])&&this.Parent.ScreenObject.GridDataColumns.Contains("DCCCNID"+(parseInt(e)-5e4)+"_Key")&&(u["DCCCNID"+(parseInt(e)-5e4)]=null,u["DCCCNID"+(parseInt(e)-5e4)+"_Key"]=o.Tables[0][s]["DCCCNID"+(parseInt(e)-5e4)].toString())}),this.Parent.ScreenObject.GridDataColumns.Contains("Amount")?u.Amount=r:this.IsCredit&&this.Parent.ScreenObject.GridDataColumns.Contains("CreditAmount")?u.CreditAmount=r:!this.IsCredit&&this.Parent.ScreenObject.GridDataColumns.Contains("DebitAmount")&&(u.DebitAmount=r),D++),h+="<Row ",this.IsInventory||null==this.Parent.SelectedRow?this.IsInventory&&null!=this.Parent.BillWisedt&&this.Parent.BillWisedtColumns.Contains("DocSeqNo")?h+='DocSeqNo="'+this.DocSeqNo+'" ':h+='DocSeqNo="1" ':h+='DocSeqNo="'+this.Parent.SelectedRow.DocSeqNo.toString()+'" ',h+='AccountID="'+this.AccountID.toString()+'" ',this.IsCredit?(h+='AmountFC="-'+r+'" ',h+=e>1?'AdjAmount="-'+(r*this.ExchangeRate).ToString("N"+this.decimalpoints)+'" ':'AdjAmount="-'+c+'" '):(h+='AmountFC="'+r+'" ',h+=e>1?'AdjAmount="'+(r*this.ExchangeRate).ToString("N"+this.decimalpoints)+'" ':'AdjAmount="'+c+'" '),h+='AdjCurrID="'+this.CurrencyID.toString()+'" ',h+='AdjExchRT="'+this.ExchangeRate.toString()+'" ',h+='IsNewReference="1" ',h+='Narration="" ',h+='IsDocPDC="0" ',5==this.Parent.DocumentType)h+='InvDocDetID="'+l+'" ';else if(42==this.Parent.DocumentType||40==this.Parent.DocumentType){let e=0;if(this.Parent.ScreenObject.GridDataColumns.Contains("dcCalcdcNum59")){var p=this.Parent.ScreenObject.GridData.Compute("sum","dcCalcdcNum59");null!=p&&(e=n.e.Double(p)),this.IsCredit&&(e*=-1)}if(h+='VatAdvance="'+e+'" ',this.NewReferenceDetailsVisibility&&this.NewReferenceDetails.length>0)return this.DisplayMessage="Vat advance can not be edited after Adjustments.Delete adjustments to edit.",t.Message=this.DisplayMessage,""}h+=" ></Row>",null!=u&&null!=u&&(h+=" </BillWise>",u.IsDistributed=1,u.ExtraXML=h.toString(),h="",h+="<BillWise> ",this.Parent.CalculateTotals(u,!1))}}let y=null,g=new r.a;this.IsInventory||null==this.Parent.SelectedRow||(y=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&99==e.LocalReference&&e.SysColumnName.startsWith("dcAlpha")),y.forEach(e=>{if(this.Parent.ScreenObject.GridDataColumns.Contains(e.SysColumnName.toString())){var t=this.ColumnSource.find(t=>t.ID==e.LinkData.toString());t&&g.push(e.SysColumnName.toString(),t.DisplayMember),this.Parent.SelectedRow[e.SysColumnName.toString()]=null}})),n.e.StringIsNullOrEmpty(s)||this.AdjustClubbedRows();let O=0,I=0,T="";do{let i=0,r=0,o=0,c=null;for(let e=0;e<this.GridData.length;e++)if((!this.GridDataColumns.Contains("IsClubed")||"2"!=n.e.String(this.GridData[e].IsClubed)&&"3"!=n.e.String(this.GridData[e].IsClubed))&&(!this.GridDataColumns.Contains("NonAc")||"1"!=this.GridData[e].NonAc.toString())&&(this.GridDataColumns.Contains("ExchgRate")&&!n.e.IsEmpty(this.GridData[e].ExchgRate)&&"0"==this.GridData[e].ExchgRate.toString()&&(this.GridData[e].ExchgRate="1"),!n.e.IsEmpty(this.GridData[e].AmountPaid)&&parseFloat(this.GridData[e].AmountPaid)>0)){if(!this.IsInventory&&null!=this.Parent.SelectedRow){if(!n.e.IsEmpty(this.GridData[e].VatAdvance)&&parseFloat(this.GridData[e].VatAdvance)>0)return this.DisplayMessage="VatAdvance can not be used in this voucher.",t.Message=this.DisplayMessage,"";if(0==O&&this.FillPickFrom(this.AccountID,this.GridData[e].DocNo.toString(),s),this.NewReference.Enable&&null!=this.dtccData&&this.dtccData.length>1&&!this.dtccData[I].docno.toString().split(",").Contains(this.GridData[e].DocNo.toString()))continue;this.NewReference.Enable&&null!=this.dtccData&&this.dtccData.length>1&&(o+=parseFloat(this.GridData[e].AmountPaid)),O++,g.keys.forEach(t=>{let s=t,i=g[t];O>1&&!n.e.IsEmpty(this.Parent.SelectedRow[s])&&(this.Parent.SelectedRow[s]=this.Parent.SelectedRow[s].toString()+","),this.Parent.SelectedRow[s]=this.Parent.SelectedRow[s].toString()+n.e.StringValue(this.GridData[e][i]),this.GridDataColumns.Contains(i+"_Key")&&this.Parent.ScreenObject.GridDataColumns.Contains(s+"_Key")&&(this.Parent.SelectedRow[s+"_Key"]=n.e.StringValue(this.GridData[e][i+"_Key"]))})}let d=null,S=1,m=0,b=0;if(""!=s&&(d=this.Parent.ScreenObject.getDistribution(s,n.e.String(this.GridData[e].DocNo),this.IsCredit,this.AccountID,n.e.String(this.GridData[e].DocSeqNo)),null!=d&&d.length>0&&null!=d[0].amt&&d.length>0)){S=d.length;let e=d.Compute("sum","amt");null!=e&&null!=e&&(m=parseFloat(e))}for(let s=0;s<S;s++){let o=parseFloat(n.e.String(this.GridData[e].AmountPaid));if(S>1&&m>0){if(o=s+1==S?parseFloat(n.e.String(this.GridData[e].AmountPaid))-b:parseFloat(n.e.String(this.GridData[e].AmountPaid))*(parseFloat(n.e.String(d[0][s].amt))/m),o=parseFloat(o.ToString("N"+this.decimalpoints)),a.a.SessionManager.Preferences.ContainsKey("ExclZerodist")&&"True"==a.a.SessionManager.Preferences.ExclZerodist&&0==o)continue;b+=o}if(D>0){c=this.Parent.ScreenObject.GridDataObj.NewRow(),this.Parent.ScreenObject.GridDataObj.insertRowAt(c,this.Parent.ScreenObject.GridData.indexOf(this.Parent.SelectedRow)+1);for(let e=0;e<this.Parent.ScreenObject.GridDataColumns.length;e++)"DocDetailsID"!=this.Parent.ScreenObject.GridDataColumns[e]&&(c[this.Parent.ScreenObject.GridDataColumns[e]]=this.Parent.SelectedRow[this.Parent.ScreenObject.GridDataColumns[e]])}else null!=d&&d.length>0&&null!=d[0].amt&&(c=this.Parent.SelectedRow);if(null!=d&&d.length>0&&null!=d[0].amt){for(let e=1;e<Object.keys(d[0]).length;e++){const t=Object.keys(d[0])[e];this.Parent.ScreenObject.GridDataColumns.Contains(t+"_Key")&&(c[t]=null,c[t+"_Key"]=n.e.String(d[0][s][t]))}this.Parent.ScreenObject.GridDataColumns.Contains("Amount")?c.Amount=o:this.IsCredit&&this.Parent.ScreenObject.GridDataColumns.Contains("CreditAmount")?c.CreditAmount=o:!this.IsCredit&&this.Parent.ScreenObject.GridDataColumns.Contains("DebitAmount")&&(c.DebitAmount=o),D++}if(h+="<Row ",this.IsInventory||null==this.Parent.SelectedRow?this.IsInventory&&null!=this.Parent.BillWisedt&&this.Parent.BillWisedtColumns.Contains("DocSeqNo")?h+='DocSeqNo="'+this.DocSeqNo+'" ':h+='DocSeqNo="1" ':h+='DocSeqNo="'+this.Parent.SelectedRow.DocSeqNo.toString()+'" ',h+='AccountID="'+this.AccountID.toString()+'" ',this.IsCredit?(h+='AmountFC="-'+o+'" ',this.GridDataColumns.Contains("CurrID")&&this.GridDataColumns.Contains("ExchgRate")&&!n.e.IsEmpty(this.GridData[e].CurrID)&&parseInt(this.GridData[e].CurrID.toString())==this.CurrencyID&&!n.e.IsEmpty(this.GridData[e].ExchgRate)&&parseFloat(this.GridData[e].ExchgRate.toString())!=this.ExchangeRate?(h+=""!=this.decimalpoints?'AdjAmount="-'+(o*parseFloat(this.GridData[e].ExchgRate.toString())).ToString("N"+this.decimalpoints)+'" ':'AdjAmount="-'+o*parseFloat(this.GridData[e].ExchgRate.toString())+'" ',h+='AdjExchRT="'+this.GridData[e].ExchgRate.toString()+'" ',i+=o*(parseFloat(this.GridData[e].ExchgRate.toString())-this.ExchangeRate)):(h+=""!=this.decimalpoints?'AdjAmount="-'+(o*this.ExchangeRate).ToString("N"+this.decimalpoints)+'" ':'AdjAmount="-'+o*this.ExchangeRate+'" ',h+='AdjExchRT="'+this.ExchangeRate.toString()+'" ')):(h+='AmountFC="'+o+'" ',this.GridDataColumns.Contains("CurrID")&&this.GridDataColumns.Contains("ExchgRate")&&!n.e.IsEmpty(this.GridData[e].CurrID)&&parseInt(this.GridData[e].CurrID.toString())==this.CurrencyID&&!n.e.IsEmpty(this.GridData[e].ExchgRate)&&parseFloat(this.GridData[e].ExchgRate.toString())!=this.ExchangeRate?(h+=""!=this.decimalpoints?'AdjAmount="'+(o*parseFloat(this.GridData[e].ExchgRate.toString())).ToString("N"+this.decimalpoints)+'" ':'AdjAmount="'+o*parseFloat(this.GridData[e].ExchgRate.toString())+'" ',h+='AdjExchRT="'+this.GridData[e].ExchgRate.toString()+'" ',i+=o*(parseFloat(this.GridData[e].ExchgRate.toString())-this.ExchangeRate)):(h+=""!=this.decimalpoints?'AdjAmount="'+(o*this.ExchangeRate).ToString("N"+this.decimalpoints)+'" ':'AdjAmount="'+o*this.ExchangeRate+'" ',h+='AdjExchRT="'+this.ExchangeRate.toString()+'" ')),"0"!=this.CurrencyID.toString()?h+='AdjCurrID="'+this.CurrencyID.toString()+'" ':"0"==this.CurrencyID.toString()&&(h+='AdjCurrID="1" '),h+='IsNewReference="0" ',h+='RefDocNo="'+u.d.GetValidXml(n.e.String(this.GridData[e].DocNo))+'" ',h+='RefStatusID="'+n.e.String(this.GridData[e].StatusID)+'" ',h+='RefDocSeqNo="'+n.e.String(this.GridData[e].DocSeqNo)+'" ',n.e.IsEmpty(this.GridData[e].DocDate_Key)||(h+='RefDocDate="'+new Date(this.GridData[e].DocDate_Key.toString()).ToString("dd/MMM/yyyy")+'" '),n.e.IsEmpty(this.GridData[e].DueDate_Key)||(h+='RefDocDueDate="'+new Date(this.GridData[e].DueDate_Key.toString()).ToString("dd/MMM/yyyy")+'" '),h+='Narration="'+n.e.String(this.GridData[e].Remarks)+'" ',5==this.Parent.DocumentType&&(h+='InvDocDetID="'+l+'" '),!n.e.IsEmpty(this.GridData[e].DiscAmount)&&parseFloat(this.GridData[e].DiscAmount.toString())>0){if(0==this.AdvanceRowsCNT&&null!=this.DiscCol){if(3==this.DiscCol.PostingType||4==this.DiscCol.PostingType)return t.Message=this.DisplayMessage="Define Posting Type None for Billwise Discount",this.MessageVisibility=!0,"";if(this.IsCredit&&0==this.DiscCol.DebitAccount)return t.Message=this.DisplayMessage="Define Debit account for Billwise Discount",this.MessageVisibility=!0,"";if(!this.IsCredit&&0==this.DiscCol.CreditAcount)return t.Message=this.DisplayMessage="Define Credit account for Billwise Discount",this.MessageVisibility=!0,"";if(!(this.Parent.ScreenObject.Preferences.ContainsKey("DiscDoc")&&!n.e.IsEmpty(this.Parent.ScreenObject.Preferences.DiscDoc)&&parseInt(this.Parent.ScreenObject.Preferences.DiscDoc)>4e4))return t.Message=this.DisplayMessage="Define Discount Doc to use Billwise Discount",this.MessageVisibility=!0,""}this.GetDiscXML(parseFloat(n.e.String(this.GridData[e].DiscAmount)),e),r+=parseFloat(n.e.String(this.GridData[e].DiscAmount)),this.GridDataColumns.Contains("CurrID")&&this.GridDataColumns.Contains("ExchgRate")&&!n.e.IsEmpty(this.GridData[e].CurrID)&&!n.e.IsEmpty(this.GridData[e].ExchgRate)?h+='DiscCurrID="'+n.e.String(this.GridData[e].CurrID)+'" DiscExchRT="'+n.e.String(this.GridData[e].ExchgRate)+'" ':h+='DiscCurrID="1" DiscExchRT="1" ',h+='DiscAmount="'+parseFloat(n.e.String(this.GridData[e].DiscAmount))+'" ',h+=this.IsCredit?'DiscAccountID="'+this.DiscCol.DebitAccount+'" ':'DiscAccountID="'+this.DiscCol.CreditAcount+'" '}else h+='DiscAmount="0" ';if(!n.e.IsEmpty(this.GridData[e].VatAdvance)&&parseFloat(n.e.String(this.GridData[e].VatAdvance))>0&&!n.e.IsEmpty(this.GridData[e].Amount)&&parseFloat(n.e.String(this.GridData[e].Amount))>0){if(this.Parent.BillWisedtColumns.Contains("DocSeqNo"))return this.DisplayMessage="Vat Advance can not be used in line wise.",this.MessageVisibility=!0,t.Message=this.DisplayMessage,"";if("1"!=n.e.String(this.GridData[e].IsIncl)&&parseFloat(n.e.String(this.GridData[e].AmountPaid))*this.ExchangeRate>this.TotTaxableAmt)return this.DisplayMessage="Can not adjust more than:"+this.TotTaxableAmt.ToString("N"+this.decimalpoints)+" from "+n.e.String(this.GridData[e].DocNo),this.MessageVisibility=!0,t.Message=this.DisplayMessage,"";let s=0;if(s=n.e.Double(this.GridData[e].Amount)==n.e.Double(this.GridData[e].AmountPaidLC)?parseFloat(n.e.String(this.GridData[e].VatAdvance)):parseFloat((parseFloat(n.e.String(this.GridData[e].AmountPaid))*this.ExchangeRate*(parseFloat(n.e.String(this.GridData[e].VatAdvance))/parseFloat(n.e.String(this.GridData[e].Amount)))).ToString("N"+this.decimalpoints)),s>0){if(!(this.Parent.ScreenObject.Preferences.ContainsKey("VatAdvanceDoc")&&""!=this.Parent.ScreenObject.Preferences.VatAdvanceDoc&&parseInt(this.Parent.ScreenObject.Preferences.VatAdvanceDoc)>4e4))return this.DisplayMessage="Define Vat Advance Doc.",this.MessageVisibility=!0,t.Message=this.DisplayMessage,"";if(!this.GetVatAdvanceXML(n.e.String(this.GridData[e].CostCenterID),s))return t.Message=this.DisplayMessage,"";this.IsCredit&&(s*=-1),h+='VatAdvance="'+s+'" '}}if(h+='IsDocPDC="0" >',h+=" </Row>",null!=c&&(h+=" </BillWise>",c.IsDistributed=1,c.ExtraXML=h.toString(),h="",h+="<BillWise> ",this.Parent.CalculateTotals(c,!1),null!=this.dtccData&&this.dtccData.length>1)){let t=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&99==e.LocalReference),s=this.dtccData.filter(t=>t.docno="'"+this.GridData[e].DocNo.toString()+"'"||!1);s.length>0&&t.forEach(e=>{if(!n.e.IsEmpty(e.ColumnCostCenterID)&&parseInt(e.ColumnCostCenterID.toString())>5e4&&!n.e.IsEmpty(e.SysColumnName)){let t=parseInt(e.ColumnCostCenterID.toString());t-=5e4,null!=this.dtccData["dcccnid"+t]&&this.Parent.ScreenObject.GridDataColumns.Contains(e.SysColumnName.toString()+"_Key")&&(c[e.SysColumnName.toString()+"_Key"]=s[0]["dcccnid"+t].toString(),c[e.SysColumnName.toString()]=s[0]["dcccnid"+t+"Name"].toString())}})}}}if(n.e.IsEmpty(s)||(this.Parent.ScreenObject.UpdateSequence(),this.Parent.RefreshGrid=!0),this.IsInventory){if(0!=i){let e=n.e.Int(a.a.SessionManager.Preferences["Exchange Gain/Loss Account"]);if(!a.a.SessionManager.Preferences.ContainsKey("Exchange Gain/Loss Account")||0==e)return this.DisplayMessage=a.a.GetResource("ExchangeGainLossCannotAdjust"),t.Message=this.DisplayMessage,"";let s=1;if(!n.e.IsEmpty(a.a.SessionManager.Preferences.DimensionwiseCurrency)&&parseInt(a.a.SessionManager.Preferences.DimensionwiseCurrency)>5e4){var j=this.Parent.ScreenObject._CCFields.find(e=>e instanceof m.b&&e.CCID==parseInt(a.a.SessionManager.Preferences.DimensionwiseCurrency));j&&j instanceof m.b&&j.SelectedValue>0&&(s=this.Parent.ScreenObject.GetCurrency(j.SelectedValue,j.CCID))}h+="<AccountsRow ",h+=i>0&&!this.IsCredit||this.IsCredit&&i<0?'DebitAccount="'+this.AccountID+'" CreditAccount="'+e+'" Amount="':'DebitAccount="'+e+'" CreditAccount="'+this.AccountID+'" Amount="',h+=Math.abs(i)+'" AmtFc="'+Math.abs(i)+'" CurrencyID="'+s+'" ExchangeRate="1" ></AccountsRow>'}}else{let e=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&50403==e.LinkData);e.length>0&&this.Parent.ScreenObject.GridDataColumns.Contains(e[0].SysColumnName.toString())?(this.Parent.SelectedRow[e[0].SysColumnName.toString()]=i,e[0].SysColumnName.toString().toLowerCase().Contains("dcnum")&&(this.Parent.SelectedRow["dcCalc"+e[0].SysColumnName.toString()]=i)):0!=i&&(this.Parent.DisplayMessage="Define Exchange gain or loss field",this.Parent.MessageVisibility=!0),r>0&&null!=this.DiscCol?(this.Parent.SelectedRow[this.DiscCol.DisplayMember]=r,this.DiscCol.DisplayMember.toLowerCase().Contains("dcnum")&&(this.Parent.SelectedRow["dcCalc"+this.DiscCol.DisplayMember]=r)):null==this.DiscCol||n.e.IsEmpty(this.Parent.SelectedRow[this.DiscCol.DisplayMember])||"0"==this.Parent.SelectedRow[this.DiscCol.DisplayMember].toString()||(this.Parent.SelectedRow[this.DiscCol.DisplayMember]=r,this.DiscCol.DisplayMember.toLowerCase().Contains("dcnum")&&(this.Parent.SelectedRow["dcCalc"+this.DiscCol.DisplayMember]=r))}if(this.GridDataColumns.Contains("NonAc"))for(let e=0;e<this.GridData.length;e++)"0"!=this.GridData[e].NonAc.toString()&&!n.e.IsEmpty(this.GridData[e].AmountPaid)&&parseFloat(this.GridData[e].AmountPaid)>0&&(h+='<NonAccRows RefDocNo="'+this.GridData[e].DocNo.toString()+'" Amount="'+this.GridData[e].AmountPaid.toString()+'" Narration="'+n.e.StringValue(this.GridData[e].Remarks)+'" ></NonAccRows>');if(this.Parent.ScreenObject.Preferences.ContainsKey("UseAsDownPmt")&&"True"==this.Parent.ScreenObject.Preferences.UseAsDownPmt&&(h+='<NonAccRows RefDocNo="" AccountID="'+this.AccountID+'" Amount="'+this.AmtToAdjust.Text+'" ></NonAccRows>'),e&&(h+=" </BillWise>"),n.e.IsEmpty(s))if(null!=this.dtccData&&this.dtccData.length>1&&0==I){let e=n.e.Double(this.NewReference.Text);e+=o,this.Parent.ScreenObject.GridDataColumns.Contains("Amount")?this.Parent.SelectedRow.Amount=e:this.IsCredit&&this.Parent.ScreenObject.GridDataColumns.Contains("CreditAmount")?this.Parent.SelectedRow.CreditAmount=e:!this.IsCredit&&this.Parent.ScreenObject.GridDataColumns.Contains("DebitAmount")&&(this.Parent.SelectedRow.DebitAmount=e),T=h.toString(),h=""}else if(null!=this.dtccData&&this.dtccData.length>1&&I>0){let e=this.Parent.ScreenObject.GridDataObj.NewRow();for(let t=0;t<this.Parent.ScreenObject.GridDataColumns.length;t++)"DocDetailsID"!=this.Parent.ScreenObject.GridDataColumns[t]&&(e[this.Parent.ScreenObject.GridDataColumns[t]]=this.Parent.SelectedRow[this.Parent.ScreenObject.GridDataColumns[t]]);this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&99==e.LocalReference).forEach(t=>{if(!n.e.IsEmpty(t.ColumnCostCenterID)&&parseInt(t.ColumnCostCenterID)>5e4&&!n.e.IsEmpty(t.SysColumnName)){let s=parseInt(t.ColumnCostCenterID);s-=5e4,!Object(f.isUndefined)(this.dtccData[I]["dcCCNID"+s])&&this.Parent.ScreenObject.GridDataColumns.Contains(t.SysColumnName.toString()+"_Key")&&(e[t.SysColumnName.toString()+"_Key"]=this.dtccData[I]["dcCCNID"+s].toString(),e[t.SysColumnName.toString()]=this.dtccData[I]["dcCCNID"+s+"Name"].toString())}}),h="<BillWise> "+h,this.Parent.ScreenObject.GridDataColumns.Contains("Amount")?e.Amount=o:this.IsCredit&&this.Parent.ScreenObject.GridDataColumns.Contains("CreditAmount")?e.CreditAmount=o:!this.IsCredit&&this.Parent.ScreenObject.GridDataColumns.Contains("DebitAmount")&&(e.DebitAmount=o),e.ExtraXML=h.toString(),this.Parent.ScreenObject.GridDataObj.insertRowAt(e,this.Parent.ScreenObject.GridData.indexOf(this.Parent.SelectedRow)+1),this.Parent.CalculateTotals(e,!1),h=""}I++}while(null!=this.dtccData&&I<this.dtccData.length&&n.e.IsEmpty(s));return this.NewReference.Enable&&null!=this.dtccData&&this.dtccData.length>1?(this.Parent.ScreenObject.UpdateSequence(),T):h.toString()}GetVatAdvanceXML(e,t){let s=this.Parent.ScreenObject.GetVatAdvanceAccounts(e);if(!(null!=s&&s.Tables.length>0&&s.Tables[0].length>0&&s.Columns[0].Contains("DebitAccount")&&!n.e.IsEmpty(s.Tables[0][0].CreditAccount)&&parseInt(s.Tables[0][0].CreditAccount)>0&&!n.e.IsEmpty(s.Tables[0][0].DebitAccount)&&parseInt(s.Tables[0][0].DebitAccount)>0))return this.DisplayMessage="Debit or credit account not defined.",!1;{this.AdvanceRowsCNT++,this.VatAdvanceXML+="<Row><Transactions  ",this.VatAdvanceXML+=' DocDetailsID="0"  DocSeqNo="'+this.AdvanceRowsCNT+'" Amount="'+t+'" ',this.VatAdvanceXML+=' AmtFc="'+t+'" ',this.VatAdvanceXML+=' CurrencyID="1"  ExchangeRate="1" ',this.VatAdvanceXML+='CreditAccount="'+s.Tables[0][0].DebitAccount.toString()+'" ',this.VatAdvanceXML+='DebitAccount="'+s.Tables[0][0].CreditAccount.toString()+'" ',this.VatAdvanceXML+="></Transactions> ";let e=this.Parent.ScreenObject.GenerateQueryfromList(this.Parent.ScreenObject._CCFields,!0,{message:""},!1,!1);this.VatAdvanceXML+=' <Numeric /> <Alpha /> <CostCenters  Query="'+e+'"  /> ',this.VatAdvanceXML+="<EXTRAXML> </EXTRAXML>  </Row>"}return!0}GetDiscXML(e,t){this.AdvanceRowsCNT++;let s=1,i=e;this.GridDataColumns.Contains("CurrID")&&this.GridDataColumns.Contains("ExchgRate")&&!n.e.IsEmpty(this.GridData[t].CurrID)&&!n.e.IsEmpty(this.GridData[t].ExchgRate)&&n.e.Double(this.GridData[t].ExchgRate)>0?(s=n.e.Double(this.GridData[t].ExchgRate),i=parseFloat((e*s).ToString("N"+this.decimalpoints))):s=1,this.VatAdvanceXML+="<Row><Transactions  ",this.VatAdvanceXML+=' DocDetailsID="0"  DocSeqNo="'+this.AdvanceRowsCNT+'" Amount="'+i+'" ',this.VatAdvanceXML+=' AmtFc="'+e+'" ',this.VatAdvanceXML+=' CurrencyID="1" ExchangeRate="'+s+'" ',this.VatAdvanceXML+=this.IsCredit?'CreditAccount="'+this.AccountID+'" DebitAccount="'+this.DiscCol.DebitAccount+'" ':'CreditAccount="'+this.DiscCol.CreditAcount+'" DebitAccount="'+this.AccountID+'" ',this.VatAdvanceXML+="></Transactions> ";let a={message:""},r="",o=this.Parent.ScreenObject.GenerateQueryfromList(this.Parent.ScreenObject._CCFields,!0,a,!1,!1);r=a.message,this.VatAdvanceXML+=' <Numeric /> <Alpha /> <CostCenters  Query="'+o+'"  /> ',this.VatAdvanceXML+='<EXTRAXML><BillWise><Row DocSeqNo="'+this.AdvanceRowsCNT+'" ',this.VatAdvanceXML+='AccountID="'+this.AccountID.toString()+'" ',this.IsCredit?(this.VatAdvanceXML+='AmountFC="-'+e+'" ',this.VatAdvanceXML+='AdjAmount="-'+(e*s).ToString("N"+this.decimalpoints)+'" '):(this.VatAdvanceXML+='AmountFC="'+e+'" ',this.VatAdvanceXML+='AdjAmount="'+(e*s).ToString("N"+this.decimalpoints)+'" '),this.VatAdvanceXML+='AdjExchRT="'+s+'" ',this.VatAdvanceXML+='AdjCurrID="1" ',this.VatAdvanceXML+='IsNewReference="0" ',this.VatAdvanceXML+='RefDocNo="'+u.d.GetValidXml(n.e.String(this.GridData[t].DocNo))+'" ',this.VatAdvanceXML+='RefStatusID="'+n.e.String(this.GridData[t].StatusID)+'" ',this.VatAdvanceXML+='RefDocSeqNo="'+n.e.String(this.GridData[t].DocSeqNo)+'" ',n.e.IsEmpty(this.GridData[t].DocDate_Key)||(this.VatAdvanceXML+='RefDocDate="'+new Date(this.GridData[t].DocDate_Key.toString()).ToString("dd/MMM/yyyy")+'" '),n.e.IsEmpty(this.GridData[t].DueDate_Key)||(this.VatAdvanceXML+='RefDocDueDate="'+new Date(this.GridData[t].DueDate_Key.toString()).ToString("dd/MMM/yyyy")+'" '),this.VatAdvanceXML+=' IsDocPDC="0" Narration="" ></Row></BillWise></EXTRAXML></Row>'}FillPickFromNonAcc(e){if(this.Parent.ScreenObject.Data.Tables.length>0&&null!=this.Parent.SelectedRow&&this.Parent.SelectedRow&&!this.Parent.IsInventoryVoucher){let t=this.Parent.ScreenObject.Data.Tables[0];if(t=t.filter(e=>null!=e.LocalReference&&99==e.LocalReference),t.length>0){let s=this.Parent.ScreenObject.GetBillwiseNonAccDetails(e,this.Parent.ScreenObject.CostCenterID);null!=s&&s.Tables.length>0&&!s.Columns[0].Contains("ErrorMessage")&&s.Tables[0].length>0&&t.forEach(e=>{if(""!=e.ColumnCostCenterID.toString()&&parseInt(e.ColumnCostCenterID.toString())>5e4&&""!=e.SysColumnName.toString()){let i=parseInt(e.ColumnCostCenterID.toString());if(i-=5e4,s.Columns[0].Contains("dcccnid"+i)&&this.Parent.ScreenObject.GridData.Columns.Contains(e.SysColumnName.toString()+"_Key"))this.Parent.SelectedRow[e.SysColumnName.toString()+"_Key"]=s.Tables[0][0]["dcccnid"+i].toString(),this.Parent.SelectedRow[e.SysColumnName.toString()]=s.Tables[0][0]["dcccnid"+i+"Name"].toString();else{var t=this.Parent.ScreenObject._CCFields.find(t=>t.DBColumnID==parseInt(e.CostCenterColID));null!=t&&t instanceof m.b&&s.Columns[0].Contains("dcccnid"+i)&&""!=s.Tables[0][0]["dcccnid"+i].toString()&&(t.SelectedValue=parseInt(s.Tables[0][0]["dcccnid"+i].toString()),t.IsAutoLoad&&(t.SelectedValueText=s.Tables[0][0]["dcccnid"+i+"Name"].toString()))}}})}}}FillPickFrom(e,t,s){if(this.Parent.ScreenObject.Data.Tables.length>0&&null!=this.Parent.SelectedRow&&!this.Parent.IsInventoryVoucher){let i=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&99==e.LocalReference);if(i.length>0){if(this.NewReference.Enable||!n.e.IsEmpty(s)){t="";for(let e=0;e<this.GridData.length;e++)this.GridDataColumns.Contains("NonAc")&&"1"==this.GridData[e].NonAc.toString()||!n.e.IsEmpty(this.GridData[e].AmountPaid)&&parseFloat(this.GridData[e].AmountPaid)>0&&(n.e.IsEmpty(t)||(t+="','"),t+=this.GridData[e].DocNo.toString())}let a=this.Parent.ScreenObject.GetBillwiseCCDetails(e,t,this.Parent.ScreenObject.CostCenterID);null!=a&&a.Tables.length>0&&!a.Columns[0].Contains("ErrorMessage")&&a.Tables[0].length>0&&(i.forEach(e=>{if(!n.e.IsEmpty(e.ColumnCostCenterID)&&parseInt(e.ColumnCostCenterID)>5e4&&!n.e.IsEmpty(e.SysColumnName)){let s=parseInt(e.ColumnCostCenterID);if(s-=5e4,a.Columns[0].Contains("dcccnid"+s)&&this.Parent.ScreenObject.GridDataColumns.Contains(e.SysColumnName.toString()+"_Key"))this.Parent.SelectedRow[e.SysColumnName.toString()+"_Key"]=a.Tables[0][0]["dcccnid"+s].toString(),this.Parent.SelectedRow[e.SysColumnName.toString()]=a.Tables[0][0]["dcccnid"+s+"name"].toString();else{var t=this.Parent.ScreenObject._CCFields.find(t=>t.DBColumnID==parseInt(e.CostCenterColID));t&&t instanceof m.b&&a.Columns[0].Contains("dcccnid"+s)&&!n.e.IsEmpty(a.Tables[0][0]["dcccnid"+s])&&(t.SelectedValue=parseInt(a.Tables[0][0]["dcccnid"+s]),t.IsAutoLoad&&(t.SelectedValueText=a.Tables[0][0]["dcccnid"+s+"name"].toString()))}}}),(this.NewReference.Enable&&a.Tables[0].length>1&&t.Contains("','")||!n.e.IsEmpty(s))&&(this.dtccData=a.Tables[0]))}}}}var B=s("MCKn"),v=s("Z9XZ"),x=s("HNy5"),_=s("unLB"),k=s("/Ge1"),K=s("WJZp"),Q=s("gqOg"),H=s("zTKc"),W=s("q0aW"),U=s("JJ8n"),X=s("Tvp0"),q=s("ouML"),Y=s("vgHJ"),J=s("Xpi9");class z extends l.b{constructor(e,t,s,i,a,r,o,l,c){super(),this._Fifo=!1,this.GridDataObj=new F.a,this.Width=0,this.CurrencyID=1,this.ExchangeRate=1,this.AccountID=0,this.IsCredit=!1,this.TotalAmount=0,this.decimalpoints="",this.Title="Return Cheques",this.GridDataObj.Table=[],this.GridDataObj.TableColumns=[],this.GridDataObj.SearchVisible=!0,this.TotalAmount=i,this.Parent=e,this.ParentRow=t,this.VoucherNo=s,this.SetScreenObjectData(),this.GridDataObj.TableColumns.push("SNO"),this.GridDataObj.TableColumns.push("DocNo"),this.GridDataObj.TableColumns.push("DocSeqNo"),this.GridDataObj.TableColumns.push("DocDate"),this.GridDataObj.TableColumns.push("DocDate_Key"),this.GridDataObj.TableColumns.push("DueDate"),this.GridDataObj.TableColumns.push("DueDate_Key"),this.GridDataObj.TableColumns.push("CurrID"),this.GridDataObj.TableColumns.push("CurrName"),this.GridDataObj.TableColumns.push("ExchgRate"),this.GridDataObj.TableColumns.push("Amount"),this.GridDataObj.TableColumns.push("Due"),this.GridDataObj.TableColumns.push("Paid"),this.GridDataObj.TableColumns.push("Total"),this.GridDataObj.TableColumns.push("Remarks"),this.GridDataObj.TableColumns.push("BILLNO");for(let n=0;n<this.ScreenObjectData.Tables[4].length;n++)this.GridDataObj.TableColumns.Contains(this.ScreenObjectData.Tables[4][n].Name.toString())||this.GridDataObj.TableColumns.push(this.ScreenObjectData.Tables[4][n].Name.toString());this.LoadColumns(),this.AccountID=a,this.IsCredit=r,this.CurrencyID=o,this.ExchangeRate=l;let h=new n.f;this.Parent.IsInventoryVoucher&&""!=this.Parent.ChkRtnXml&&h.ReadXml(this.Parent.ChkRtnXml),this.Parent.IsInventoryVoucher||null==t||n.e.IsEmpty(t.ReturnXML)||h.ReadXml(t.ReturnXML),this.GetChequeReturn(h,c),this.SetBalValue(),this.GridDataObj.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.GridDataObj.BeginEdit.Subscribe(this,"OnBeginEdit")}get Fifo(){return this._Fifo}set Fifo(e){e!=this._Fifo&&(this._Fifo=e,this.AdjustBills())}get ColumnSource(){return this.GridDataObj.Columns}get GridData(){return this.GridDataObj.Table}get SelectedRow(){return this.GridDataObj.SelectedItem}set SelectedRow(e){this.GridDataObj.SelectedItem=e}OnBeginEdit(e){let t=e.args,s=t.item;if("Amount"==t.column.field){let e=n.e.Double(s.Amount);if(""==n.e.String(s.Amount)||0==e){let e=0,t=this.GridData.Compute("sum","Amount");null!=t&&(e=n.e.Double(t)),e=this.TotalAmount-e,e>0&&(s.Amount=e>parseFloat(s.Due)?s.Due:e)}}}GetChequeReturn(e,t){if(this.GridData.Clear(),null==this.ParentRow||n.e.IsEmpty(this.ParentRow.DocSeqNo)||parseInt(this.ParentRow.DocSeqNo),null!=t&&t.Tables.length>0&&!t.Columns[0].Contains("ErrorMessage"))for(let s=0;s<t.Tables[0].length;s++){let i=this.GridDataObj.NewRow();i.SNO=this.GridData.length+1,i.DocNo=t.Tables[0][s].DocNo.toString(),i.DocSeqNo=t.Tables[0][s].DocSeqNo.toString(),t.Columns[0].Contains("BILLNO")&&(i.BILLNO=n.e.String(t.Tables[0][s].BILLNO));let r=0;n.e.IsEmpty(t.Tables[0][s].Amount)||(r=parseFloat(t.Tables[0][s].Amount)),n.e.IsEmpty(t.Tables[0][s].Paid)||(r-=parseFloat(t.Tables[0][s].Paid));let o="";if(null!=this.ScreenObjectData.Tables[4]&&this.ScreenObjectData.Tables[4].length>0)for(let e=0;e<this.ScreenObjectData.Tables[4].length;e++)o="",o=!n.e.IsEmpty(this.ScreenObjectData.Tables[4][e].CostcenterID)&&null!=this.ScreenObjectData.Tables[4][e].CostcenterID&&parseInt(this.ScreenObjectData.Tables[4][e].CostcenterID)>5e4?"A"+this.ScreenObjectData.Tables[4][e].CostcenterID.toString():n.e.String(this.ScreenObjectData.Tables[4][e].Name),""!=o&&t.Columns[0].Contains(o)&&"ChequeDate"==o?n.e.IsEmpty(t.Tables[0][s].ChequeDate)||(i[this.ScreenObjectData.Tables[4][e].Name.toString()]=new Date(t.Tables[0][s].ChequeDate).ToString(a.a.SessionManager.Preferences["Date Format"])):""!=o&&t.Columns[0].Contains(o)&&"DocDate"!=o&&"DocDueDate"!=o&&(i[this.ScreenObjectData.Tables[4][e].Name.toString()]=n.e.String(t.Tables[0][s][o]));if(i.CurrID=n.e.String(t.Tables[0][s].AdjCurrID),i.ExchgRate=n.e.String(t.Tables[0][s].AdjExchRT),i.CurrName=n.e.String(t.Tables[0][s].Name),n.e.IsEmpty(t.Tables[0][s].DocDate)||(i.DocDate=new Date(t.Tables[0][s].DocDate).ToString(a.a.SessionManager.Preferences["Date Format"]),i.DocDate_Key=new Date(t.Tables[0][s].DocDate)),n.e.IsEmpty(t.Tables[0][s].DocDueDate)||(i.DueDate=new Date(t.Tables[0][s].DocDueDate).ToString(a.a.SessionManager.Preferences["Date Format"]),i.DueDate_Key=new Date(t.Tables[0][s].DocDueDate)),""!=this.decimalpoints?(n.e.IsEmpty(t.Tables[0][s].Amount)||(i.Total=parseFloat(t.Tables[0][s].Amount).ToString("N"+this.decimalpoints)),i.Due=r.ToString("N"+this.decimalpoints),n.e.IsEmpty(t.Tables[0][s].Paid)||(i.Paid=parseFloat(t.Tables[0][s].Paid).ToString("N"+this.decimalpoints))):(i.Due=r,i.Total=n.e.String(t.Tables[0][s].Amount),i.Paid=n.e.String(t.Tables[0][s].Paid)),e.Tables.length>0&&e.Columns[0].Contains("RefDocNo")){let a=e.Tables[0].filter(e=>e.RefDocNo==n.e.String(t.Tables[0][s].DocNo).replace("'","''")&&e.RefDocSeqNo==t.Tables[0][s].DocSeqNo&&0==e.IsNewReference);a.length>0?(i.Amount=""!=this.decimalpoints?parseFloat(a[0].AdjAmount.toString().replace("-","")).ToString("N"+this.decimalpoints):a[0].AdjAmount.toString().replace("-",""),this.GridDataObj.TableColumns.Contains("Remarks")&&(i.Remarks=a[0].Narration)):i.Amount=(0).ToString("N"+this.decimalpoints)}else i.Amount=(0).ToString("N"+this.decimalpoints);this.GridDataObj.addRow(i)}}LoadColumns(){let e=[];a.a.SessionManager.Preferences.ContainsKey("DecimalsinAmount")&&""!=this.decimalpoints&&(this.decimalpoints=a.a.SessionManager.Preferences.DecimalsinAmount);let t=new y.a;t.Header="#",t.DisplayMember="SNO",t.DataType="TextBlock",t.Width=24,t.ReadOnly=!0,e.push(t);for(let s=0;s<this.ScreenObjectData.Tables[4].length;s++)t=new y.a,t.Header=this.ScreenObjectData.Tables[4][s].UserColumnName.toString(),t.DisplayMember=this.ScreenObjectData.Tables[4][s].Name.toString(),"DocDueDate"==t.DisplayMember&&(t.DisplayMember="DueDate"),t.ReadOnly=!Object(o.j)(this.ScreenObjectData.Tables[4][s].IsEditable),"DocNo"==t.DisplayMember?(t.DataType="LINK",t.ReadOnly=!1,t.Click.Subscribe(this,"OnserieslinkClick")):t.DataType=this.ScreenObjectData.Tables[4][s].UserColumnType.toString(),"FLOAT"==t.DataType&&""!=this.decimalpoints&&(t.DecimalPoints=this.decimalpoints),n.e.IsEmpty(this.ScreenObjectData.Tables[4][s].ColumnWidth)||(t.Width=parseInt(this.ScreenObjectData.Tables[4][s].ColumnWidth)),e.push(t);this.GridDataObj.Columns=e}OnserieslinkClick(){null!=this.SelectedRow&&(Object(f.isUndefined)(this.SelectedRow.CostCenterID)||(V.RibbonExtViewModel.LoadDocument(this.SelectedRow),a.a.page.HideDialog()))}OnCellEditEnding(e){let t=e.item;if("Amount"==e.column.field&&!n.e.IsEmpty(t.Amount)){let e=this.TotalAmount,s=this.GridData.filter(e=>e.SNO!=t.SNO).Compute("sum","Amount");null!=s&&(e-=parseFloat(s)),e<parseFloat(t.Amount)&&(this.MessageVisibility=!0,this.DisplayMessage="Entered amount exceeds the amount entered in voucher",t.Amount=""!=this.decimalpoints?e.ToString("N"+this.decimalpoints):e,this.GridDataObj.updateRow(t));let i=0;i=parseFloat(t.Amount),i>parseFloat(t.Due)&&(this.MessageVisibility=!0,this.DisplayMessage="Entered amount is more than due",t.Amount=parseFloat(t.Due),this.GridDataObj.updateRow(t))}}OnSave(e){"Save"==e.toString()?(this.Parent.IsInventoryVoucher&&(this.Parent.ChkRtnXml=this.GetXml()),this.Parent.IsInventoryVoucher||null==this.ParentRow||(this.ParentRow.ReturnXML=this.GetXml()),this.Parent.DialogResult=!0,a.a.page.HideDialog(),this.Parent.IsInventoryVoucher&&this.Parent.SaveDocument()):"Cancel"==e.toString()&&(this.Parent.DialogResult=!1,a.a.page.HideDialog())}AdjustBills(){if(this.Fifo){let e=this.TotalAmount;for(let t=0;t<this.GridData.length;t++){let s=parseFloat(this.GridData[t].Due);e>=s?(this.GridData[t].Amount=""!=this.decimalpoints?s.ToString("N"+this.decimalpoints):s,e-=s):(this.GridData[t].Amount=""!=this.decimalpoints?e.ToString("N"+this.decimalpoints):e,e=0),this.GridDataObj.updateRow(this.GridData[t])}}else for(let e=0;e<this.GridData.length;e++)this.GridData[e].Amount=0,this.GridDataObj.updateRow(this.GridData[e])}GetXml(){0==this.CurrencyID&&(this.CurrencyID=1),0==this.ExchangeRate&&(this.ExchangeRate=1);let e="",t=0,s="",i=0,a=0;for(let r=0;r<this.GridData.length;r++)this.GridDataObj.TableColumns.Contains("ExchgRate")&&!n.e.IsEmpty(this.GridData[r].ExchgRate)&&"0"==this.GridData[r].ExchgRate.toString()&&(this.GridData[r].ExchgRate="1"),!n.e.IsEmpty(this.GridData[r].Amount)&&parseFloat(this.GridData[r].Amount)>0&&(""==e.toString()&&(e+=this.Parent.IsInventoryVoucher?"<ChkRtnXML> ":"<XML> "),i+=parseFloat(this.GridData[r].Amount),this.Parent.IsInventoryVoucher||0!=t||this.FillPickFrom(this.AccountID,this.GridData[r].DocNo.toString()),t++,e+="<Row ",e+=null!=this.ParentRow?'DocSeqNo="'+this.ParentRow.DocSeqNo.toString()+'" ':'DocSeqNo="1" ',e+='AccountID="'+this.AccountID.toString()+'" ',this.IsCredit?(e+='AmountFC="'+this.GridData[r].Amount.toString()+'" ',e+='AdjAmount="-'+parseFloat(this.GridData[r].Amount)*this.ExchangeRate+'" ',e+='AdjExchRT="'+this.ExchangeRate.toString()+'" '):(e+='AmountFC="-'+this.GridData[r].Amount.toString()+'" ',e+='AdjAmount="'+parseFloat(this.GridData[r].Amount)*this.ExchangeRate+'" ',e+='AdjExchRT="'+this.ExchangeRate.toString()+'" '),"0"!=n.e.String(this.CurrencyID)?e+='AdjCurrID="'+this.CurrencyID.toString()+'" ':"0"==n.e.String(this.CurrencyID)&&(e+='AdjCurrID="1" '),e+='IsNewReference="0" ',e+='RefDocNo="'+this.GridData[r].DocNo.toString()+'" ',e+='RefDocSeqNo="'+this.GridData[r].DocSeqNo.toString()+'" ',n.e.IsEmpty(this.GridData[r].DocDate_Key)||(e+='RefDocDate="'+new Date(this.GridData[r].DocDate_Key).ToString("dd/MMM/yyyy")+'" '),n.e.IsEmpty(this.GridData[r].DueDate_Key)||(e+='RefDocDueDate="'+new Date(this.GridData[r].DueDate_Key).ToString("dd/MMM/yyyy")+'" '),e+='Narration="'+n.e.StringValue(this.GridData[r].Remarks)+'" ',e+='IsDocPDC="0" >',e+=" </Row>",a++,a>1&&(s+=","),s+=this.GridData[r].DocNo.toString());if(""!=e&&(e+=this.Parent.IsInventoryVoucher?" </ChkRtnXML>":" </XML>",this.Parent.ScreenObject.Data.Tables[0].length>0)){let e=this.Parent.ScreenObject.Data.Tables[0].filter(e=>159==e.LocalReference&&27237==e.LinkData);e.length>0&&this.Parent.ScreenObject.GridDataColumns.Contains(e[0].SysColumnName.toString())&&(this.Parent.SelectedRow[e[0].SysColumnName.toString()]=s),e=this.Parent.ScreenObject.Data.Tables[0].filter(e=>159==e.LocalReference&&27250==e.LinkData),e.length>0&&this.Parent.ScreenObject.GridDataColumns.Contains(e[0].SysColumnName.toString())&&(this.Parent.SelectedRow[e[0].SysColumnName.toString()]=i)}return e.toString()}FillPickFrom(e,t){if(this.Parent.ScreenObject.Data.Tables.length>0&&null!=this.Parent.SelectedRow&&!this.Parent.IsInventoryVoucher){let s=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&159==e.LocalReference);if(s.length>0){let i=this.Parent.ScreenObject.GetChequeReturnCCDetails(e,t,this.Parent.ScreenObject.CostCenterID);null!=i&&i.Tables.length>0&&!i.Columns[0].Contains("ErrorMessage")&&i.Tables[0].length>0&&s.forEach(e=>{if(!n.e.IsEmpty(e.ColumnCostCenterID)&&parseInt(e.ColumnCostCenterID)>5e4&&!n.e.IsEmpty(e.SysColumnName)){let s=parseInt(e.ColumnCostCenterID);if(s-=5e4,i.Columns[0].Contains("dcccnid"+s)&&this.Parent.ScreenObject.GridDataColumns.Contains(e.SysColumnName.toString()+"_Key"))this.Parent.SelectedRow[e.SysColumnName.toString()+"_Key"]=i.Tables[0][0]["dcccnid"+s].toString(),this.Parent.SelectedRow[e.SysColumnName.toString()]=i.Tables[0][0]["dcccnid"+s+"Name"].toString();else{var t=this.Parent.ScreenObject._CCFields.find(t=>t.DBColumnID==parseInt(e.CostCenterColID));t&&t instanceof m.b&&i.Columns[0].Contains("dcccnid"+s)&&!n.e.IsEmpty(i.Tables[0][0]["dcccnid"+s])&&(t.SelectedValue=parseInt(i.Tables[0][0]["dcccnid"+s]))}}})}}}SetScreenObjectData(){this.ScreenObjectData=a.a.common.GetScreenInfo(159),this.Width=this.ScreenObjectData.Tables.length>5&&this.ScreenObjectData.Tables[5].length>0&&this.ScreenObjectData.Columns[5].Contains("ColumnWidth")&&!n.e.IsEmpty(this.ScreenObjectData.Tables[5][0].ColumnWidth)?parseFloat(this.ScreenObjectData.Tables[5][0].ColumnWidth):800}SetBalValue(){let e="";if(this.Parent.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")?e="CreditAccount_Key":this.Parent.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")?e="DebitAccount_Key":this.Parent.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&(e="AccountID_Key"),this.ParentRow&&!n.e.IsEmpty(this.ParentRow[e])){let t=this.Parent.ScreenObject.GridData.filter(t=>t[e]==this.ParentRow[e]);if(t.length>0){let e=[];if(t.forEach(t=>{if(!n.e.IsEmpty(t.ReturnXML)&&this.ParentRow!=t){let s=new n.f;if(s.ReadXml(t.ReturnXML),s.Tables.length>0&&s.Tables[0].length>0&&s.Columns[0].Contains("AdjAmount")&&s.Columns[0].Contains("RefDocSeqNo")&&s.Columns[0].Contains("RefDocNo"))for(let t=0;t<s.Tables[0].length;t++){let i={};i.VoucherNo=s.Tables[0][t].RefDocNo.toString(),i.AdjAmount=s.Tables[0][t].AdjAmount.toString(),i.Seq=s.Tables[0][t].RefDocSeqNo.toString(),e.push(i)}}}),e.length>0)for(let s=0;s<this.GridData.length;s++)if(!n.e.IsEmpty(this.GridData[s].DocNo)&&(t=e.filter(e=>e.VoucherNo==this.GridData[s].DocNo.toString()&&e.Seq==this.GridData[s].DocSeqNo),t.length>0)){let e=0,i=0;e=n.e.DoubleTryParse(this.GridData[s].Due);let r=e.toString();a.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=a.a.SessionManager.Preferences.DecimalsinQty&&(r=e.ToString("N"+a.a.SessionManager.Preferences.DecimalsinQty)),e=parseFloat(r),t.forEach(e=>{n.e.IsEmpty(e.AdjAmount)||(i+=parseFloat(e.AdjAmount))}),i<0?e+=i:e-=i,this.GridData[s].Due=a.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=a.a.SessionManager.Preferences.DecimalsinQty?e.ToString("N"+a.a.SessionManager.Preferences.DecimalsinQty):e}}}}}var Z=s("OljK"),$=s("Q01V");class ee extends l.b{constructor(e,t,s,i){if(super(),this.dttemp=[],this.drpDocuments=new D.e(0),this.GridDataObj=new F.a,this.SelectedValueChanged=!1,this.SelectedValue=null,this.SelectedIndex=0,this.DebitAcc=new m.b(0),this.ProductList=new D.b,this.SelectedNode=0,this.ProductID=null,this.dtAbbr=[],this.dsParent={},this.RowPos=0,this.dtTempTable=[],this.SNO=1,this.ProductID=t,this.RowPos=i,this.oparent=e,this.dsParent=s,null!=s&&s.Tables.length>10&&s.Tables[10].length>0&&(this.dtAbbr=s.Tables[10]),this.ProdCols=new D.e(0),this.ProdCols.SelectionChangedCommand.Subscribe(this,"LinkSelectionChanged"),this.DisplayName=a.a.GetResource("LinkTitle"),this.GenerateColumns(),this.DefaultData(),this.GridDataObj.TableNewRow.Subscribe(this,"onAddRow"),this.GridDataObj.RowDeleted.Subscribe(this,"onDeleteRow"),null!=s&&s.Tables.length>0&&s.Tables[0].length>0)for(let n=0;n<s.Tables[0].length;n++){let e=this.GridDataObj.NewRow();e.DocSeqNo=(n+1).toString(),e.Select=!1,e.CostCenterID=s.Tables[0][n].CostCenterID.toString(),e.VoucherNo=s.Tables[0][n].VoucherNO.toString(),e.DocDetailsID=s.Tables[0][n].DocDetailsID.toString(),e.ProductName=s.Tables[0][n].ProductName.toString(),e.ProductCode=s.Tables[0][n].ProductCode.toString(),e.ProductID_Key=s.Tables[0][n].ProductID.toString(),e.Qty=s.Tables[0][n].Quantity.toString(),e.Balance=s.Tables[0][n][0].toString(),e.TobeUsed=s.Tables[0][n][0].toString(),""!=e.Balance.toString()&&""!=e.Qty.toString()&&(e.Executed=parseFloat(e.Qty.toString())-parseFloat(e.Balance.toString()));for(let t=0;t<this.ColumnSource.length;t++)if(4!=this.ColumnSource[t].SectionID&&"LinkedInvDocDetailsID"!=this.ColumnSource[t].DisplayMember&&"RefNo"!=this.ColumnSource[t].DisplayMember&&"LinkedFieldName"!=this.ColumnSource[t].DisplayMember&&!this.ColumnSource[t].DisplayMember.toLowerCase().Contains("dccurrid")&&!this.ColumnSource[t].DisplayMember.toLowerCase().Contains("dcexchrt"))if(this.ColumnSource[t].IsColumnUserDefined)if("SELECTIONBOX"==this.ColumnSource[t].DataType)s.Columns[3].Contains(this.ColumnSource[t].DisplayMember)&&(e[this.ColumnSource[t].DisplayMember]=s.Tables[3][n][this.ColumnSource[t].DisplayMember]);else if(null!=this.ColumnSource[t].CostCenterID&&this.ColumnSource[t].CostCenterID>0)this.ColumnSource[t].DisplayMember.Contains("TO")?s.Columns[1].Contains(this.ColumnSource[t].DisplayMember.Replace("TO",""))&&s.Tables[1].length>n+1&&s.Columns[1].Contains(this.ColumnSource[t].DisplayMember.Replace("TO",""))&&(e[this.ColumnSource[t].DisplayMember+"_Key"]=s.Tables[1][n+1][this.ColumnSource[t].DisplayMember.Replace("TO","")]):s.Columns[1].Contains(this.ColumnSource[t].DisplayMember)&&(e[this.ColumnSource[t].DisplayMember+"_Key"]=s.Tables[1][n][this.ColumnSource[t].DisplayMember]);else if(this.ColumnSource[t].DisplayMember.toLowerCase().Contains("dcnum"))e[this.ColumnSource[t].DisplayMember]=s.Tables[2][n][this.ColumnSource[t].DisplayMember];else if("DATE"==this.ColumnSource[t].DataType){if(s.Columns[3].Contains(this.ColumnSource[t].DisplayMember)&&""!=s.Tables[3][n][this.ColumnSource[t].DisplayMember].toString()){let i="dd/MMM/yyyy";a.a.SessionManager.Preferences.ContainsKey("Date Format")&&""!=a.a.SessionManager.Preferences["Date Format"]&&(i=a.a.SessionManager.Preferences["Date Format"]),e[this.ColumnSource[t].DisplayMember]=new Date(s.Tables[3][n][this.ColumnSource[t].DisplayMember].toString()).ToString(i),e[this.ColumnSource[t].DisplayMember+"_Key"]=new Date(s.Tables[3][n][this.ColumnSource[t].DisplayMember].toString())}}else"ComboBox"==this.ColumnSource[t].DataType?s.Columns[3].Contains(this.ColumnSource[t].ValueBinding)&&(e[this.ColumnSource[t].ValueBinding]=s.Tables[3][n][this.ColumnSource[t].ValueBinding]):s.Columns[3].Contains(this.ColumnSource[t].DisplayMember)&&(e[this.ColumnSource[t].DisplayMember]=s.Tables[3][n][this.ColumnSource[t].DisplayMember]);else if("AccountID_Key"==this.ColumnSource[t].ValueMember||"DebitAmount"==this.ColumnSource[t].DisplayMember||"CreditAmount"==this.ColumnSource[t].DisplayMember){if("AccountID_Key"==this.ColumnSource[t].ValueMember)continue}else if(null==this.ColumnSource[t].ValueMember||!s.Columns[0].Contains(this.ColumnSource[t].ValueMember.Replace("_Key",""))||"DebitAccount_Key"!=this.ColumnSource[t].ValueMember&&"CreditAccount_Key"!=this.ColumnSource[t].ValueMember){if(3==this.ColumnSource[t].CostCenterID&&s.Columns[0].Contains("ProductID"))e[this.ColumnSource[t].ValueMember]=s.Tables[0][n].ProductID;else if("DocSeqNo"!=this.ColumnSource[t].DisplayMember)if("DATE"==this.ColumnSource[t].DataType){if(s.Columns[0].Contains(this.ColumnSource[t].DisplayMember)&&""!=s.Tables[0][n][this.ColumnSource[t].DisplayMember].toString()){let i="dd/MMM/yyyy";a.a.SessionManager.Preferences.ContainsKey("Date Format")&&""!=a.a.SessionManager.Preferences["Date Format"]&&(i=a.a.SessionManager.Preferences["Date Format"]),e[this.ColumnSource[t].DisplayMember]=new Date(s.Tables[0][n][this.ColumnSource[t].DisplayMember]).ToString(i),this.GridDataObj.TableColumns.Contains(this.ColumnSource[t].DisplayMember+"_Key")&&(e[this.ColumnSource[t].DisplayMember+"_Key"]=new Date(s.Tables[0][n][this.ColumnSource[t].DisplayMember].toString()))}}else"gross"==this.ColumnSource[t].DisplayMember.toLowerCase()?s.Columns[0].Contains(this.ColumnSource[t].DisplayMember)&&(e[this.ColumnSource[t].DisplayMember]=s.Tables[0][n][this.ColumnSource[t].DisplayMember]):"Amount"==this.ColumnSource[t].DisplayMember?s.Columns[0].Contains("Amount")&&(e.Amount=s.Tables[0][n].Amount.toString()):"LISTBOX"==this.ColumnSource[t].DataType.toUpperCase()?s.Columns[0].Contains(this.ColumnSource[t].DisplayMember)&&(e[this.ColumnSource[t].ValueMember]=s.Tables[0][n][this.ColumnSource[t].DisplayMember]):s.Columns[0].Contains(this.ColumnSource[t].DisplayMember)&&e.Table.Columns.Contains(this.ColumnSource[t].DisplayMember)&&(e[this.ColumnSource[t].DisplayMember]=s.Tables[0][n][this.ColumnSource[t].DisplayMember])}else null!=this.ColumnSource[t].ValueMember&&"DebitAccount_Key"==this.ColumnSource[t].ValueMember&&(e.DebitAccount_KEY=s.Tables[0][n].DebitAccount),null!=this.ColumnSource[t].ValueMember&&"CreditAccount_Key"==this.ColumnSource[t].ValueMember&&(e.CreditAccount_KEY=s.Tables[0][n].CreditAccount);this.GridData.push(e)}this.dttemp=this.GridData.Copy(),this.RefreshGrid=!0,Logger.InfoLog("LinkProdWiseViewModel::Exiting LinkProdWiseViewModel")}set RefreshGrid(e){}get ColumnSource(){return this.GridDataObj.Columns}get GridData(){return this.GridDataObj.Table}get SelectedRow(){return this.GridDataObj.SelectedItem}set SelectedRow(e){this.GridDataObj.SelectedItem=e}OnSelectionChangedCommand(e){let t=this.dtAbbr;null!=t&&t.length>0&&""!=this.ProdCols.SelectedItem.Parent?(t=this.dtAbbr.filter(e=>e.CostCenterID==this.ProdCols.SelectedItem.Parent),t.length>0||this.GridDataObj.ClearFilters()):this.GridDataObj.ClearFilters()}OnCmnItem_Click(e){switch(e){case"DELETE":confirm(a.a.GetResource("DeleteMessage"))&&this.OnDeleteCallBack()}}DefaultData(){}onAddRow(e){this.UpdateSequence(),e.DocSeqNo=this.SNO}onDeleteRow(e){this.UpdateSequence()}UpdateSequence(){this.SNO=1,this.GridData.forEach(e=>{e.DocSeqNo=this.SNO++})}GenerateColumns(){let e=["ProductCode","ProductName"];this.GridDataObj.TableColumns.push("TobeUsed"),this.GridDataObj.TableColumns.push("DocSeqNo"),this.GridDataObj.TableColumns.push("Select"),this.GridDataObj.TableColumns.push("DocDetailsID"),this.GridDataObj.TableColumns.push("VoucherNo"),this.GridDataObj.TableColumns.push("ProductName"),this.GridDataObj.TableColumns.push("ProductCode"),this.GridDataObj.TableColumns.push("ProductID_Key");let t,s=[],i=[];if("AddEditDocumentViewModel"==this.oparent.ClassName&&null!=this.oparent.ScreenObject&&null!=this.oparent.ScreenObject.Data&&this.oparent.ScreenObject.Data.Tables.length>6&&(t=this.oparent.ScreenObject.Data.Tables[7].AsDataView(),t.RowFilter=" PrefValueType = 'GroupCheckBox'"),"AddEditDocumentViewModel"==this.oparent.ClassName&&this.oparent.ScreenObject.Preferences.ContainsKey("StaticLinkingColumns")&&""!=this.oparent.ScreenObject.Preferences.StaticLinkingColumns){let e=new n.f;e.LoadXml(this.oparent.ScreenObject.Preferences.StaticLinkingColumns);for(let t=0;t<e.DocumentElement.childNodes.length;t++){let i=e.DocumentElement.children[t],a=new y.a;a.Header=i.attributes.Header.value,a.DisplayMember=i.attributes.Name.value,a.DisplayIndex=parseInt(i.attributes.index.value),a.Width=parseInt(i.attributes.WIDTH.value),s.push(a)}}let r=new y.a;r.Header="#",r.DisplayMember="DocSeqNo",r.DataType="TextBlock",r.ReadOnly=!0,r.Width=25,r.DisableTab=!0,i.push(r),r=new y.a,r.Header=a.a.GetResource("Select"),r.DisplayMember="Select",r.DataType="CheckBox",r.Width=50,i.push(r),r=new y.a,r.Header="Voucher No",r.DisplayMember="VoucherNo",r.DataType="TextBlock",r.ReadOnly=!0,r.Width=100,r.DisableTab=!0,i.push(r);for(let a=0;a<e.length;a++){let n=e[a],c=null;if("AddEditDocumentViewModel"==this.oparent.ClassName?c=this.oparent.ScreenObject.ColumnSource.find(e=>e.DisplayMember==n):"DynamicSetViewModel"==this.oparent.ClassName&&(c=this.oparent.ColumnSource.find(e=>e.DisplayMember==n)),null!=c){r=new y.a,r.Header=c.Header,r.DisplayMember=c.DisplayMember,r.DataType=c.DataType,r.Width=100,r.ValueMember=c.ValueMember,r.CostCenterID=c.CostCenterID,r.TypeID=c.TypeID,r.ReadOnly=!0,null!=t&&t.length>0&&"ProductCode"==c.DisplayMember&&(t.RowFilter=" PrefValueType = 'GroupCheckBox' and PrefName = 'ProductCode' ",t.length>0&&(r.IsVisible=Object(o.j)(t[0].PrefValue)),t.RowFilter=" PrefValueType = 'GroupCheckBox'"),null!=t&&t.length>0&&"ProductName"==c.DisplayMember&&(t.RowFilter=" PrefValueType = 'GroupCheckBox' and PrefName = 'ProductName' ",t.length>0&&(r.IsVisible=Object(o.j)(t[0].PrefValue)),t.RowFilter=" PrefValueType = 'GroupCheckBox'");var l=s.find(e=>e.DisplayMember==r.DisplayMember);l&&(r.DisplayIndex=l.DisplayIndex,r.Width=l.Width),i.Contains(r)||i.push(r)}}this.GridDataObj.TableColumns.push("Qty"),r=new y.a,r.Header="Qty",r.DisplayMember="Qty",r.DataType="TextBlock",r.Width=100,r.ReadOnly=!0,null!=t&&t.length>0&&(t.RowFilter=" PrefValueType = 'GroupCheckBox' and PrefName = 'Qty' ",t.length>0&&(r.IsVisible=Object(o.j)(t[0].PrefValue)),t.RowFilter=" PrefValueType = 'GroupCheckBox'");var c=s.find(e=>"Qty"==e.DisplayMember);c&&(r.DisplayIndex=c.DisplayIndex,r.Width=c.Width),i.Contains(r)||i.push(r),this.GridDataObj.TableColumns.push("Executed"),r=new y.a,r.Header=a.a.GetResource("Doc_Executed")+" Qty",r.DisplayMember="Executed",r.DataType="TextBlock",r.Width=100,r.ReadOnly=!0,null!=t&&t.length>0&&(t.RowFilter=" PrefValueType = 'GroupCheckBox' and PrefName = 'ExecutedQty' ",t.length>0&&(r.IsVisible=Object(o.j)(t[0].PrefValue)),t.RowFilter=" PrefValueType = 'GroupCheckBox'"),(c=s.find(e=>"ExecutedQty"==e.DisplayMember))&&(r.DisplayIndex=c.DisplayIndex,r.Width=c.Width),i.Contains(r)||i.push(r),this.GridDataObj.TableColumns.push("Balance"),r=new y.a,r.Header=a.a.GetResource("Doc_Balance")+" Qty",r.DisplayMember="Balance",r.DataType="TextBlock",r.Width=100,r.ReadOnly=!0,null!=t&&t.length>0&&(t.RowFilter=" PrefValueType = 'GroupCheckBox' and PrefName = 'BalanceQty' ",t.length>0&&(r.IsVisible=Object(o.j)(t[0].PrefValue)),t.RowFilter=" PrefValueType = 'GroupCheckBox'"),(c=s.find(e=>"BalanceQty"==e.DisplayMember))&&(r.DisplayIndex=c.DisplayIndex,r.Width=c.Width),i.Contains(r)||i.push(r),r=new y.a,r.Header=a.a.GetResource("Doc_LinkQty"),r.DisplayMember="TobeUsed",r.DataType="TextBlock",r.Width=100,null!=t&&t.length>0&&(t.RowFilter=" PrefValueType = 'GroupCheckBox' and PrefName = 'LinkValue' ",t.length>0&&(r.IsVisible=Object(o.j)(t[0].PrefValue)),t.RowFilter=" PrefValueType = 'GroupCheckBox'"),(c=s.find(e=>"LinkValue"==e.DisplayMember))&&(r.DisplayIndex=c.DisplayIndex,r.Width=c.Width),i.Contains(r)||i.push(r),this.GridDataObj.TableColumns.push("CostCenterID");let h=this.dsParent.Tables[6];h.sort((e,t)=>e.SectionID>t.SectionID||e.SectionID==t.SectionID&&e.SectionSeqNumber>t.SectionSeqNumber?1:-1);for(let n=0;n<h.length;n++)if(r=new y.a,r.Header=h[n].UserColumnName.toString(),r.DisplayMember=h[n].SysColumnName.toString(),r.DataType=h[n].ColumnDataType.toString(),r.Width=100,r.ValueMember="LISTBOX"==r.DataType?h[n].SysColumnName.toString()+"_Key":h[n].SysColumnName.toString(),""!=h[n].IsColumnUserDefined.toString()&&(r.IsColumnUserDefined=Object(o.j)(h[n].IsColumnUserDefined.toString())),null!=h[n].ColumnCostCenterID&&""!=h[n].ColumnCostCenterID.toString()&&(r.CostCenterID=parseInt(h[n].ColumnCostCenterID)),r.ReadOnly=!0,(c=s.find(e=>e.DisplayMember==r.DisplayMember))?(r.DisplayIndex=c.DisplayIndex,r.Width=c.Width):r.DisplayIndex=100,0==i.filter(e=>e.ValueMember==r.ValueMember&&"LISTBOX"==e.DataType||e.DisplayMember==r.DisplayMember&&"LISTBOX"!=e.DataType).length){let e=h[n];if(!this.GridDataObj.TableColumns.Contains(r.DisplayMember))switch(i.push(r),e.ColumnDataType.toString().toUpperCase()){case"BIGINT":this.GridDataObj.TableColumns.push(e.SysColumnName.toString()),r.ShowTotal=!1;break;case"INT":this.GridDataObj.TableColumns.push(e.SysColumnName.toString()),r.ShowTotal=!0;break;case"FLOAT":this.GridDataObj.TableColumns.push(e.SysColumnName.toString()),e.SysColumnName.toString().toLowerCase().Contains("dcnum")?(r.DefaultValue=e.UserDefaultValue.toString(),this.GridDataObj.TableColumns.push("dcCalc"+e.SysColumnName.toString()),a.a.SessionManager.Preferences.ContainsKey("DecimalsinExtraFields")&&""!=a.a.SessionManager.Preferences.DecimalsinExtraFields&&(r.DecimalPoints=a.a.SessionManager.Preferences.DecimalsinExtraFields)):e.SysColumnName.toString().toLowerCase().Contains("dcexchrt")||("Quantity"==e.SysColumnName.toString()?(this.GridDataObj.TableColumns.push("Linked"+e.SysColumnName.toString()),a.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=a.a.SessionManager.Preferences.DecimalsinQty&&(r.DecimalPoints=a.a.SessionManager.Preferences.DecimalsinQty)):"Gross"==e.SysColumnName.toString()||"Rate"==e.SysColumnName.toString()?("Gross"==e.SysColumnName.toString()&&this.GridDataObj.TableColumns.push("Linked"+e.SysColumnName.toString()),a.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=a.a.SessionManager.Preferences.DecimalsinRate&&(r.DecimalPoints=a.a.SessionManager.Preferences.DecimalsinRate)):"Amount"!=e.SysColumnName.toString()&&"DebitAmount"!=e.SysColumnName.toString()&&"CreditAmount"!=e.SysColumnName.toString()||!a.a.SessionManager.Preferences.ContainsKey("DecimalsinAmount")||""==a.a.SessionManager.Preferences.DecimalsinAmount||(r.DecimalPoints=a.a.SessionManager.Preferences.DecimalsinAmount)),e.SysColumnName.toString().toLowerCase().Contains("dcexchrt")||"exchangerate"==e.SysColumnName.toString().toLowerCase()||(r.ShowTotal=!0);break;case"LISTBOX":r.ValueMember=e.SysColumnName.toString()+"_Key","unit"==e.SysColumnName.toString().toLowerCase()?(this.GridDataObj.TableColumns.push(e.SysColumnName.toString()),this.GridDataObj.TableColumns.push(e.SysColumnName.toString()+"_Key"),this.GridDataObj.TableColumns.push("UOMConversion"),this.GridDataObj.TableColumns.push("UOMConvertedQty")):"productid"==e.SysColumnName.toString().toLowerCase()?(r.ValueMember="ProductID_Key",r.DisplayMember=e.UserColumnName.toString().Replace(" ",""),this.GridDataObj.TableColumns.Contains(r.DisplayMember)||this.GridDataObj.TableColumns.push(r.DisplayMember),this.GridDataObj.TableColumns.Contains(r.ValueMember)||this.GridDataObj.TableColumns.push(r.ValueMember)):"accountid"==e.SysColumnName.toString().toLowerCase()||"debitaccount"==e.SysColumnName.toString().toLowerCase()||"creditaccount"==e.SysColumnName.toString().toLowerCase()?(r.DisplayMember=e.UserColumnName.toString().Replace(" ",""),this.GridDataObj.TableColumns.push(r.DisplayMember),this.GridDataObj.TableColumns.Contains(r.ValueMember)||this.GridDataObj.TableColumns.push(r.ValueMember)):(this.GridDataObj.TableColumns.push(e.SysColumnName.toString()),this.GridDataObj.TableColumns.push(e.SysColumnName.toString()+"_Key")),r.CostCenterID=parseInt(e.ColumnCostCenterID.toString()),r.TypeID=parseInt(e.ColumnCCListViewTypeID.toString()),"ProductID_Key"!=r.ValueMember&&"AccountID"!=r.DisplayMember&&"CreditAccount"!=r.DisplayMember&&"DebitAccount"!=r.DisplayMember||(r.FilterCondition=e.UserProbableValues.toString()),a.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==a.a.SessionManager.Preferences.EnableDivisionWise.toString()&&50001==r.CostCenterID&&(r.ReadOnly=!0),a.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==a.a.SessionManager.Preferences.EnableLocationWise.toString()&&50002==r.CostCenterID&&(r.ReadOnly=!0);break;case"TEXT":case"STRING":if(this.GridDataObj.TableColumns.push(e.SysColumnName.toString()),r.IsColumnUserDefined)if("Date"==e.UserColumnType.toString())r.DataType="DATE",this.GridDataObj.TableColumns.push(e.SysColumnName.toString()+"_Key");else if("Numeric"==e.UserColumnType.toString())r.DataType="FLOAT";else if("Combobox"==e.UserColumnType.toString()){r.ValueBinding=e.SysColumnName.toString(),r.DataType="ComboBox",r.DisplayMember="Name",r.ValueMember="Value";let t=[],s=e.UserProbableValues.toString().Trim();if(s.length>0){let e=s.split(";");for(let s=0;s<e.length;s++)t.push(D.d.ComboBoxItems_2(e[s],e[s]))}r.ComboData=t}break;case"DATE":r.DataType="DATE",this.GridDataObj.TableColumns.push(e.SysColumnName.toString()),this.GridDataObj.TableColumns.push(e.SysColumnName.toString()+"_Key");break;case"":r.DataType="TextBlock",this.GridDataObj.TableColumns.push(e.SysColumnName.toString())}}i.sort((e,t)=>e.DisplayIndex-t.DisplayIndex).forEach(e=>{this.ColumnSource.push(e)})}OnSave(e){if(Logger.InfoLog("LinkProdWiseViewModel::Exiting OnSave"),"Cancel"==e)"DynamicSetViewModel"==this.oparent.ClassName?(this.oparent.Parent.Celleditend(this.oparent.GridData[this.RowPos],"ProductName",3),this.oparent.FillDynamicSetData(this.oparent.GridData[this.RowPos])):"AddEditDocumentViewModel"==this.oparent.ClassName&&this.oparent.AddProductData(this.oparent.SelectedRow,!1,!1,!0),a.a.page.HideDialog();else if("Save"==e){let e=0,t=null;for(let s=0,i=0;s<this.GridData.length;s++,i++)if(""!=this.GridData[s].Select.toString()&&Object(o.j)(this.GridData[s].Select.toString())){if(e++,this.dsParent.Tables[0][i][0]=this.GridData[s].TobeUsed.toString(),"AddEditDocumentViewModel"==this.oparent.ClassName&&(t=this.oparent.ScreenObject.GetKitProductDetails(this.oparent.CostCenterID,parseInt(this.GridData[s].DocDetailsID.toString()),parseInt(this.GridData[s].CostCenterID.toString()))),null!=t&&t.Tables.length>3)for(let e=0;e<t.Tables[0].length;e++)this.dsParent.Tables[0].push(t.Tables[0][e].ItemArray),this.dsParent.Tables[1].push(t.Tables[1][e].ItemArray),this.dsParent.Tables[2].push(t.Tables[2][e].ItemArray),this.dsParent.Tables[3].push(t.Tables[3][e].ItemArray)}else this.dsParent.Tables[0].RemoveAt(i),this.dsParent.Tables[1].RemoveAt(i),this.dsParent.Tables[2].RemoveAt(i),this.dsParent.Tables[3].RemoveAt(i),i--;0==e?"DynamicSetViewModel"==this.oparent.ClassName?(this.oparent.Parent.Celleditend(this.oparent.GridData[this.RowPos],"ProductName",3),this.oparent.FillDynamicSetData(this.oparent.GridData[this.RowPos])):"AddEditDocumentViewModel"==this.oparent.ClassName&&this.oparent.AddProductData(this.oparent.SelectedRow,!1,!1,!0):"AddEditDocumentViewModel"==this.oparent.ClassName?this.oparent.LoadLinkData(this.dsParent,[],this.RowPos,[],null):"DynamicSetViewModel"==this.oparent.ClassName&&this.oparent.LoadLinkData(this.dsParent,[],this.RowPos),a.a.page.HideDialog()}Logger.InfoLog("LinkProdWiseViewModel::Exiting OnSave")}OnDeleteCallBack(){let e=0;for(let t=0;t<this.GridData.length&&(e=parseInt(this.GridData[t].DocSeqNo),this.SelectedNode!=e-1||null==this.GridData[t][0]||""==this.GridData[t][0].toString());t++);this.SelectedNode<this.GridData.length&&(this.GridDataObj.removeRowAt(this.SelectedNode),this.UpdateSequence())}}var te=s("DMr2");class se extends l.b{constructor(e){super(),this.GridDataObj=new F.a,this.CatalogCode="",this.Description=null,this.ProductCode=null,this.Parent=null,this.TotalQoh=0,this.Parent=e,this.GridDataObj.CellEditEnding.Subscribe(this,"oncelleditend"),this.InitGrid();let t=null;("AddEditDocumentViewModel"==e.ClassName||"DynamicSetViewModel"==e.ClassName)&&(t=this.Parent.SelectedRow),this.CatalogCode=n.e.String(t.dcCCNID6),this.ProductCode=n.e.String(t.ProductCode);let s=null;if("AddEditDocumentViewModel"==e.ClassName){let e=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&282==e.LinkData);e.length>0&&(this.Description=n.e.String(t[e[0].SysColumnName.toString()])),s=this.Parent.ScreenObject.GetHoldQty(parseInt(t.ProductID_Key.toString()),t.DocDetailsID.toString(),t)}else if("DynamicSetViewModel"==e.ClassName){let e=this.Parent.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&282==e.LinkData);e.length>0&&(this.Description=n.e.String(t[e[0].SysColumnName.toString()])),s=this.Parent.Parent.ScreenObject.GetHoldQty(parseInt(t.ProductID_Key.toString()),t.DocDetailsID.toString(),t)}if(null!=s&&s.Tables.length>0&&s.Columns[0].Contains("HoldQuantity")&&s.Tables[0].length>0){let e=this.GridDataObj.NewRow();e.Name="Order Quantity",e.Qty=t.Quantity.toString(),this.GridDataObj.addRow(e),e=this.GridDataObj.NewRow(),e.Name="Hold Quantity",e.Qty=s.Tables[0][0].HoldQuantity.toString(),this.GridDataObj.addRow(e),""!=s.Tables[0][0].BalQOH.toString()&&(this.TotalQoh+=parseFloat(s.Tables[0][0].BalQOH.toString())),e=this.GridDataObj.NewRow(),e.Name="Executed Qty",e.Qty=s.Tables[0][0].ExecQTY.toString().Replace("-",""),this.GridDataObj.addRow(e),this.GridDataObj.addEmptyRow();let i=0;""!=s.Tables[0][0].Bal.toString()&&(i=parseFloat(s.Tables[0][0].Bal.toString())),e=this.GridDataObj.NewRow(),e.Name="Bal Qty",e.Qty=i,e.StyleHeightZero=1,this.GridDataObj.addRow(e),""!=s.Tables[0][0].Hold.toString()&&(i-=parseFloat(s.Tables[0][0].Hold.toString())),""!=s.Tables[0][0].Res.toString()&&(i-=parseFloat(s.Tables[0][0].Res.toString())),e=this.GridDataObj.NewRow(),e.Name="Free Stock",e.Qty=i,this.GridDataObj.addRow(e),e=this.GridDataObj.NewRow(),e.Name="Bal Qty + Already Hold",e.Qty=s.Tables[0][0].BalQOH.toString(),e.StyleHeightZero=1,this.GridDataObj.addRow(e),this.GridDataObj.addEmptyRow(),e=this.GridDataObj.NewRow(),e.Name="Balance Hold";let a=0;""!=t.Quantity.toString()&&(a=parseFloat(t.Quantity.toString())),""!=s.Tables[0][0].HoldQuantity.toString()?""!=s.Tables[0][0].ExecQTY.toString().Replace("-","")&&parseFloat(s.Tables[0][0].ExecQTY.toString().Replace("-",""))>parseFloat(s.Tables[0][0].HoldQuantity.toString())?a-=parseFloat(s.Tables[0][0].ExecQTY.toString().Replace("-","")):a-=parseFloat(s.Tables[0][0].HoldQuantity.toString()):""!=s.Tables[0][0].ExecQTY.toString().Replace("-","")&&(a-=parseFloat(s.Tables[0][0].ExecQTY.toString().Replace("-",""))),e.Qty=a,e.StyleHeightZero=1,this.GridDataObj.addRow(e),e=this.GridDataObj.NewRow(),e.Name="To Hold",e.Qty=0,this.GridDataObj.addRow(e),e=this.GridDataObj.NewRow(),e.Name="Total Hold",e.Qty=s.Tables[0][0].HoldQuantity.toString(),e.StyleHeightZero=1,this.GridDataObj.addRow(e)}Logger.InfoLog("HoldQtyViewModel:: Entering HoldQtyViewModel")}get GridData(){return this.GridDataObj.Table}get ColumnSource(){return this.GridDataObj.Columns}InitGrid(){this.GridDataObj.TableColumns.push("Name"),this.GridDataObj.TableColumns.push("Qty"),this.GridDataObj.TableColumns.push("StyleHeightZero");let e=new y.a;e.Header="",e.DisplayMember="Name",e.DataType="TextBlock",e.Width=230,e.ReadOnly=!0,this.ColumnSource.push(e),e=new y.a,e.Header="",e.DisplayMember="Qty",e.DataType="FLOAT",e.Width=100,this.ColumnSource.push(e)}oncelleditend(e){let t=0;""!=this.GridData[1].Qty.toString()&&(t=parseFloat(this.GridData[1].Qty.toString())),""!=this.GridData[9].Qty.toString()&&(t+=parseFloat(this.GridData[9].Qty.toString())),this.GridData[10].Qty=t}OnButtonClick(e){if(null!=e&&"Cancel"==e.toString())a.a.page.HideDialog();else if(null!=e&&"OK"==e.toString()){let e=null;("AddEditDocumentViewModel"==this.Parent.ClassName||"DynamicSetViewModel"==this.Parent.ClassName)&&(e=this.Parent.SelectedRow);let t=0;if(""!=e.Quantity.toString()&&(t=parseFloat(e.Quantity.toString())),""!=this.GridData[10].Qty.toString()&&parseFloat(this.GridData[10].Qty.toString())>t)return this.MessageVisibility=!0,void(this.DisplayMessage="Hold quantity can not be greater order quantity");if(""!=this.GridData[10].Qty.toString()&&parseFloat(this.GridData[10].Qty.toString())>this.TotalQoh)return void(this.DisplayMessage="Hold quantity can not be greater balance quantity");if(""!=this.GridData[8].Qty.toString()&&""!=this.GridData[9].Qty.toString()&&parseFloat(this.GridData[9].Qty.toString())>parseFloat(this.GridData[8].Qty.toString()))return void(this.DisplayMessage="Hold quantity can not be greater balance Hold quantity");e.HoldQuantity=this.GridData[10].Qty.toString();let s=null,i=null,n=null;"AddEditDocumentViewModel"==this.Parent.ClassName?(n=this.Parent.ScreenObject.Data.Tables[0],i=this.Parent.ScreenObject.GridDataColumns):"DynamicSetViewModel"==this.Parent.ClassName&&(n=this.Parent.Parent.ScreenObject.Data.Tables[0],i=this.Parent.Parent.ScreenObject.GridDataColumns),n.length>0&&(s.RowFilter=n.filter(e=>null!=e.LocalReference&&79==e.LocalReference&&52638==e.LinkData),s.length>0&&i.Contains(s[0].SysColumnName.toString())&&(e[s[0].SysColumnName.toString()]=this.TotalQoh.toString())),"AddEditDocumentViewModel"==this.Parent.ClassName?this.Parent.CalculateTotals(e,!1):"DynamicSetViewModel"==this.Parent.ClassName&&this.Parent.Parent.CalculateTotals(e,!1),a.a.page.HideDialog()}else{let t=e;"To Hold"!=t.item.Name.toString()&&(t.Cancel=!0)}}}var ie=s("O6o6"),ae=s("ybar"),ne=s("MC0n");class re extends l.b{constructor(e,t,s,i=0){super(),this.GridDataObj=new F.a,this.FooterGridDataObj=new F.a,this.IsGenerate=!1,this.HoldReserve=!1,this.AddRows=new u.d,this.IsPromotional=!1,this.Parent=null,this.mappingdv=null,this.drSel=null,this.isKit=!1,this.isModifier=!1,this.CallType=0,this.stkID=null,this.stkName=null,this.ClassName="DynamicSetViewModel",this.CallType=i,this.drSel=t,2!=i&&e.ScreenObject.Data.Tables.length>15&&(this.mappingdv=e.ScreenObject.Data.Tables[15],this.mappingdvTable=e.ScreenObject.Data.Tables[15],this.mappingdvColumns=e.ScreenObject.Data.Columns[15]),this.Parent=e,null!=this.drSel&&"3"==n.e.String(this.drSel.Type)&&(this.isKit=!0),null==this.drSel||"11"!=n.e.String(this.drSel.Type)&&"12"!=n.e.String(this.drSel.Type)||(this.isModifier=!0),1==i&&(this.IsPromotional=!0),this.Title=this.IsPromotional?"Promotional Products":this.isKit?"KIT":this.isModifier?"Modifiers":2==i||3==i||4==i?"Copy Products":"Dynamic Set",this.InitGrid(),this.GridDataObj.CellEditEnding.Subscribe(this,"onCellEditEnding"),this.FooterGridDataObj.CellEditEnding.Subscribe(this,"onFooterCellEditEnding"),this.GridDataObj.BeginEdit.Subscribe(this,"onBeginEdit"),this.AddRows.Visible=!1,2==this.CallType||3==this.CallType||4==this.CallType?(this.loadData(),4!=this.CallType&&(this.AddRows.Visible=!0),this.AddRows.Label="Rows",this.AddRows.Row=4,this.AddRows.Column=3,4==this.CallType&&(this.IsGenerate=!0)):(this.AddRows.Row=3,this.AddRows.Column=4,this.loadData_ds(s)),this.FillEmptyRows()}get GridData(){return this.GridDataObj.Table}get GridDataColumns(){return this.GridDataObj.TableColumns}get ColumnSource(){return this.GridDataObj.Columns}get SelectedRow(){return this.GridDataObj.SelectedItem}set SelectedRow(e){this.GridDataObj.SelectedItem=e}get FooterGridData(){return this.FooterGridDataObj.Table}get FooterGridDataColumns(){return this.FooterGridDataObj.TableColumns}get FooterColumnSource(){return this.FooterGridDataObj.Columns}set RefreshGrid(e){}set UpdateFooter(e){}OnPickerClick(e){if(Logger.InfoLog("OnPickerClick::Entering OnPickerClick With String="+e),"3"==e){let e=new ae.a;e.SearchPickerViewModel_2(this,"PRODUCTS"),a.a.page.ShowDialog(e,ne.a,{ShowCenter:!0,Title:e.Title})}else if("2"==e){let e=new ae.a;e.SearchPickerViewModel_2(this,"ACCOUNTS"),a.a.page.ShowDialog(e,ne.a)}else{let t=new ae.a;t.SearchPickerViewModel_3(this,"COSTCENTER",e),a.a.page.ShowDialog(t,ne.a,{ShowCenter:!0,Title:t.Title})}Logger.InfoLog("OnPickerClick:: Exiting OnPickerClick")}ParentCallBack(e){if(Logger.InfoLog("ParentCallBack :: Entering ParentCallBack With PickerObject="+e),"COSTCENTER"==e.PickerType||"PRODUCTS"==e.PickerType||"ACCOUNTS"==e.PickerType){let t=this.CCList.filter(t=>t.DataType==e.TreeCCID.toString());if(t.length>0){let s=t[0];e.SelectedNodes.forEach(e=>{e.IsGroup||0==s.Items.filter(t=>t.Value==e.Id.toString()).length&&(s.Items.push(D.c.CheckedListBoxItem_5(e.Text[1],e.Id.toString(),!0)),s.Items[s.Items.length-1].Parent=e.Text[0])})}}Logger.InfoLog("ParentCallBack::Exiting ParentCallBack")}CallRecursive(e){if(this.CCList[e].Items.length>0)for(let t=0;t<this.CCList[e].Items.length;t++)this.CCList[e].Items[t].IsChecked&&("Name"==this.CCList[e].CodeNameCombo.SelectedValue?(this.stkName[e]=this.CCList[e].Items[t].Name,this.stkID[e]=this.CCList[e].Items[t].Value):(this.stkName[e]=this.CCList[e].Items[t].Parent,this.stkID[e]=this.CCList[e].Items[t].Value),this.AddRecurRows(e));else this.AddRecurRows(e)}AddRecurRows(e){if(e==this.CCList.length-1){let e=this.GridData[this.Parent.GetEmptyRowPosition(this.GridDataObj,"ProductID_Key")];e[Object.keys(e)[0]]=this.GridData.length+1;for(let t=0;t<this.GridDataColumns.length;t++)"ExtraXML"==this.GridDataColumns[t]||"DocDetailsID"==this.GridDataColumns[t]||this.GridDataColumns[t].toLowerCase().startsWith("dcccnid")||(e[this.GridDataColumns[t]]=this.FooterGridData[0][this.GridDataColumns[t]]);for(let t=0;t<this.stkName.length;t++)n.e.IsEmpty(this.stkID[t])||(e[this.CCList[t].DBColumnName]=this.stkName[t],e[this.CCList[t].GroupName]=this.stkID[t])}else this.CallRecursive(e+1)}IsGrossMapped(){if(this.IsPromotional||this.Parent.ScreenObject.Preferences.ContainsKey("SplitKit")&&"true"==this.Parent.ScreenObject.Preferences.SplitKit.toLowerCase())return!1;if(null!=this.mappingdv){var e=this.ColumnSource.find(e=>"gross"==e.DisplayMember.toLowerCase());if(e&&(this.mappingdv=this.mappingdvTable.filter(t=>t.CostCenterColIDField==e.ID),console.log(this.mappingdv),this.mappingdv.length>0&&this.FooterGridDataColumns.Contains(this.mappingdv[0].MapSysColumnName.toString())))return!(this.mappingdvColumns.Contains("IgnoreKit")&&this.isKit&&!n.e.IsEmpty(this.mappingdv[0].IgnoreKit)&&Object(o.j)(this.mappingdv[0].IgnoreKit))}return!1}OnDistribute(e){if("PactTextBoxEditor"!=e.column.className)return;let t=e.column.field,s=0;if(n.e.IsNum(e.item[t])){if(s=n.e.Double(e.item[t]),!confirm(a.a.GetResource("Doyouwanttodistribute")))return;let r="";var i=this.ColumnSource.find(e=>e.DisplayMember==t);i&&i.DisplayMember.toLowerCase().Contains("dcnum")&&null!=i.DistributeColName&&""!=i.DistributeColName&&this.GridDataColumns.Contains(i.DistributeColName)&&(r=i.DistributeColName);let o="",l="";!n.e.IsEmpty(i.DependantOn)&&this.GridDataColumns.Contains(i.DependantOn+"_Key")&&(o=i.DependantOn+"_Key",n.e.IsEmpty(e.item[o])||(l=e.item[o].toString())),this.DistributeValues(t,parseFloat(e.item[t]),r,!0,o,l)}}DistributeValues(e,t,s,i,a="",r=""){let o=0;for(let u=0;u<this.GridData.length;u++)if(!n.e.IsEmpty(this.GridData[u].ProductID_Key)){if(""!=a&&this.GridData[u][a].toString()!=r)continue;""==s?o++:n.e.IsNum(this.GridData[u][s])&&(o+=parseFloat(this.GridData[u][s]))}let l=0,c=0;var h=this.ColumnSource.find(t=>t.DisplayMember==e);!h&&e.toLowerCase().Contains("dccalc")&&(h=this.ColumnSource.find(t=>t.DisplayMember==e.replace("dcCalc","")));for(let u=0;u<this.GridData.length;u++)if(!n.e.IsEmpty(this.GridData[u].ProductID_Key)){if(""!=a&&this.GridData[u][a].toString()!=r)continue;if(o>0){let i=0;""==s?i=1/o*t:n.e.IsNum(this.GridData[u][s])&&(i=parseFloat(this.GridData[u][s])/o*t),this.GridData[u][e]=h&&null!=h.DecimalPoints&&""!=h.DecimalPoints?i.ToString("N"+h.DecimalPoints):i,c+=parseFloat(this.GridData[u][e]),l=u}else this.GridData[u][e]=0;i&&this.Parent.CalculateTotals(this.GridData[u],!1)}if(l>0&&t-c!=0){let s=parseFloat(this.GridData[l][e])+t-c;this.GridData[l][e]=null!=h&&null!=h.DecimalPoints&&""!=h.DecimalPoints?s.ToString("N"+h.DecimalPoints):s,i&&this.Parent.CalculateTotals(this.GridData[l],!1)}}loadData(){for(let e=0;e<this.GridDataColumns.length;e++)"ModSelect"!=this.GridDataColumns[e]&&"ModifierName"!=this.GridDataColumns[e]&&"MinSelect"!=this.GridDataColumns[e]&&"MaxSelect"!=this.GridDataColumns[e]&&"ExtraXML"!=this.GridDataColumns[e]&&"DimAdded"!=this.GridDataColumns[e]&&"DocDetailsID"!=this.GridDataColumns[e]&&(this.FooterGridData[0][this.GridDataColumns[e]]=this.drSel[this.GridDataColumns[e]])}loadData_ds(e){let t="";if(t=n.e.String(this.IsPromotional?this.drSel.PromotionXML:this.drSel.ExtraXML),""!=t){if(this.isModifier&&null!=e)for(let t=0;t<e.Tables[5].length;t++){let s=this.GridDataObj.NewRow();s.ModSelect=!1,s.ModifierName=e.Tables[5][t].ModifierName.toString(),s.MinSelect=parseInt(e.Tables[5][t].MinSelect),s.MaxSelect=parseInt(e.Tables[5][t].MaxSelect),this.GridDataColumns.Contains("ProductCode")&&(s.ProductCode=e.Tables[5][t].ProductCode.toString()),this.GridDataColumns.Contains("ProductName")&&(s.ProductName=e.Tables[5][t].ProductName.toString()),s.ProductID_Key=e.Tables[5][t].ProductID.toString(),e.Columns[5].Contains("UNIT")&&!n.e.IsEmpty(e.Tables[5][t].UNIT)&&(s.Unit_Key=e.Tables[5][t].UNIT.toString()),s.Quantity=n.e.String(e.Tables[5][t].Quantity),s.defaultQuantity=n.e.IsEmpty(e.Tables[5][0].KitSize)||n.e.IsEmpty(e.Tables[5][t].Quantity)?e.Tables[5][t].Quantity.toString():parseFloat(e.Tables[5][t].Quantity.toString())/parseFloat(e.Tables[5][0].KitSize.toString()),s.LinkType=n.e.String(e.Tables[5][t].LinkType);let i=1;!n.e.IsEmpty(s.UOMConversion)&&n.e.Int(s.UOMConversion)>0&&(i=parseFloat(s.UOMConversion.toString())),n.e.IsEmpty(s.Quantity)||(s.UOMConvertedQty=i*parseFloat(s.Quantity.toString())),this.GridDataObj.addRow(s)}let i=new n.f;if(i.ReadXmlDataset(t),i.Tables.length>1)for(let t=0;t<i.Tables[1].length;t++){let r=null;if(this.isModifier&&null!=e){var s=this.GridData.filter(e=>e.ProductID_Key==i.Tables[1][t].ProductID.toString());s.length>0&&(r=s[0],r.ModSelect=!0,r.DimAdded=1)}else r=this.GridDataObj.NewRow();this.isKit&&(i.Columns[1].Contains("LinkType")&&(r.LinkType=i.Tables[1][t].LinkType),i.Columns[1].Contains("defaultQuantity")&&(r.defaultQuantity=i.Tables[1][t].defaultQuantity)),i.Columns[1].Contains("AverageRate")&&!n.e.IsEmpty(i.Tables[1][t].AverageRate)&&(r.AvgRate=i.Tables[1][t].AverageRate.toString()),r.Type=i.Tables[1][t].Type;for(let e=0;e<this.ColumnSource.length;e++)if(this.ColumnSource[e].IsColumnUserDefined){if(("ComboBox"==this.ColumnSource[e].DataType||"PactComboBox"==this.ColumnSource[e].DataType)&&!i.Columns[1].Contains(this.ColumnSource[e].ValueBinding)||"ComboBox"!=this.ColumnSource[e].DataType&&"PactComboBox"!=this.ColumnSource[e].DataType&&!i.Columns[1].Contains(this.ColumnSource[e].DisplayMember))continue;if("SELECTIONBOX"==this.ColumnSource[e].DataType)r[this.ColumnSource[e].DisplayMember]=i.Tables[1][t][this.ColumnSource[e].DisplayMember];else if(null!=this.ColumnSource[e].CostCenterID&&this.ColumnSource[e].CostCenterID>0)r[this.ColumnSource[e].DisplayMember+"_Key"]=i.Tables[1][t][this.ColumnSource[e].DisplayMember];else if(this.ColumnSource[e].DisplayMember.toLowerCase().Contains("dcnum"))i.Tables[1].length>0&&(n.e.IsEmpty(i.Tables[1][t][this.ColumnSource[e].DisplayMember])||(r[this.ColumnSource[e].DisplayMember]=i.Tables[1][t][this.ColumnSource[e].DisplayMember]),a.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(o.j)(a.a.SessionManager.Preferences["Use Foreign Currency"])&&i.Columns[1].Contains("dcCalcNumFC"+this.ColumnSource[e].DisplayMember.replace("dcNum",""))?(r["dcCalc"+this.ColumnSource[e].DisplayMember]=i.Tables[1][t]["dcCalcNumFC"+this.ColumnSource[e].DisplayMember.replace("dcNum","")],"-2"==this.ColumnSource[e].DefaultValue?i.Columns[1].Contains("dcCurrID"+this.ColumnSource[e].DisplayMember.toLowerCase().replace("dcnum",""))&&n.e.String(i.Tables[1][t]["dcCurrID"+this.ColumnSource[e].DisplayMember.toLowerCase().replace("dcnum","")])?this.GridDataColumns.Contains(i.Tables[1][t]["dcCurrID"+this.ColumnSource[e].DisplayMember.toLowerCase().replace("dcnum","")].toString())&&(r["dcCurrID"+this.ColumnSource[e].DisplayMember.toLowerCase().replace("dcnum","")+"_Key"]="1",r["dcExchRT"+this.ColumnSource[e].DisplayMember.toLowerCase().replace("dcnum","")]="1"):(this.GridDataColumns.Contains("dcCurrID"+this.ColumnSource[e].DisplayMember.toLowerCase().replace("dcnum","")+"_Key")&&(r["dcCurrID"+this.ColumnSource[e].DisplayMember.toLowerCase().replace("dcnum","")+"_Key"]=i.Tables[1][t]["dcCurrID"+this.ColumnSource[e].DisplayMember.toLowerCase().replace("dcnum","")]),this.GridDataColumns.Contains("dcExchRT"+this.ColumnSource[e].DisplayMember.toLowerCase().replace("dcnum",""))&&(r["dcExchRT"+this.ColumnSource[e].DisplayMember.toLowerCase().replace("dcnum","")]=i.Tables[1][t]["dcExchRT"+this.ColumnSource[e].DisplayMember.toLowerCase().replace("dcnum","")])):"-1"!=this.ColumnSource[e].DefaultValue&&i.Columns[1].Contains("dcExchRT"+this.ColumnSource[e].DisplayMember.toLowerCase().replace("dcnum",""))&&n.e.Int(this.ColumnSource[e].DefaultValue)>0&&this.ColumnSource[e].CurrID>0&&(this.ColumnSource[e].ExhcgRt=n.e.IsEmpty(i.Tables[1][t]["dcExchRT"+this.ColumnSource[e].DisplayMember.toLowerCase().replace("dcnum","")])?1:parseFloat(i.Tables[1][t]["dcExchRT"+this.ColumnSource[e].DisplayMember.toLowerCase().replace("dcnum","")]))):i.Columns[1].Contains("dcCalc"+this.ColumnSource[e].DisplayMember.replace("dc",""))&&!n.e.IsEmpty(i.Tables[1][t]["dcCalc"+this.ColumnSource[e].DisplayMember.replace("dc","")])&&(r["dcCalc"+this.ColumnSource[e].DisplayMember]=i.Tables[1][t]["dcCalc"+this.ColumnSource[e].DisplayMember.replace("dc","")]));else if("DATE"==this.ColumnSource[e].DataType){if(!n.e.IsEmpty(i.Tables[1][t][this.ColumnSource[e].DisplayMember])){let s="dd/MMM/yyyy";a.a.SessionManager.Preferences.ContainsKey("Date Format")&&""!=a.a.SessionManager.Preferences["Date Format"]&&(s=a.a.SessionManager.Preferences["Date Format"]),r[this.ColumnSource[e].DisplayMember]=new Date(i.Tables[1][t][this.ColumnSource[e].DisplayMember]).ToString(s),r[this.ColumnSource[e].DisplayMember+"_Key"]=new Date(i.Tables[1][t][this.ColumnSource[e].DisplayMember])}}else"ComboBox"==this.ColumnSource[e].DataType?r[this.ColumnSource[e].ValueBinding]=i.Tables[1][t][this.ColumnSource[e].ValueBinding]:"PactComboBox"==this.ColumnSource[e].DataType?(r[this.ColumnSource[e].ValueBinding]=i.Tables[1][t][this.ColumnSource[e].ValueBinding],r[this.ColumnSource[e].ValueBinding+"_Key"]=i.Tables[1][t][this.ColumnSource[e].ValueBinding]):"FLOAT"==this.ColumnSource[e].DataType?n.e.IsNum(i.Tables[1][t][this.ColumnSource[e].DisplayMember])&&(r[this.ColumnSource[e].DisplayMember]=i.Tables[1][t][this.ColumnSource[e].DisplayMember]):r[this.ColumnSource[e].DisplayMember]=i.Tables[1][t][this.ColumnSource[e].DisplayMember]}else if(3==this.ColumnSource[e].CostCenterID){if(!i.Columns[1].Contains("ProductID"))continue;r[this.ColumnSource[e].ValueMember]=i.Tables[1][t].ProductID}else if(0!=this.ColumnSource[e].CostCenterID){if(!i.Columns[1].Contains(this.ColumnSource[e].ValueMember.substr(0,this.ColumnSource[e].ValueMember.length-4)))continue;r[this.ColumnSource[e].ValueMember]=i.Tables[1][t][this.ColumnSource[e].ValueMember.substr(0,this.ColumnSource[e].ValueMember.length-4)]}else if("LinkedInvDocDetailsID"==this.ColumnSource[e].DisplayMember)i.Columns[1].Contains(this.ColumnSource[e].DisplayMember)&&!n.e.IsEmpty(i.Tables[1][t][this.ColumnSource[e].DisplayMember])&&(r[this.ColumnSource[e].DisplayMember]=i.Tables[1][t][this.ColumnSource[e].DisplayMember]);else if("DocSeqNo"!=this.ColumnSource[e].DisplayMember)if("DATE"==this.ColumnSource[e].DataType){if(!i.Columns[1].Contains(this.ColumnSource[e].DisplayMember))continue;if(!n.e.IsEmpty(i.Tables[1][t][this.ColumnSource[e].DisplayMember])){let s="dd/MMM/yyyy";a.a.SessionManager.Preferences.ContainsKey("Date Format")&&""!=a.a.SessionManager.Preferences["Date Format"]&&(s=a.a.SessionManager.Preferences["Date Format"]),r[this.ColumnSource[e].DisplayMember]=new Date(i.Tables[1][t][this.ColumnSource[e].DisplayMember]).ToString(s),this.GridDataColumns.Contains(this.ColumnSource[e].DisplayMember+"_Key")&&(r[this.ColumnSource[e].DisplayMember+"_Key"]=new Date(i.Tables[1][t][this.ColumnSource[e].DisplayMember]))}}else if("ComboBox"==this.ColumnSource[e].DataType){if(!i.Columns[1].Contains(this.ColumnSource[e].ValueBinding))continue;r[this.ColumnSource[e].ValueBinding]=i.Tables[1][t][this.ColumnSource[e].ValueBinding]}else"FLOAT"==this.ColumnSource[e].DataType?i.Columns[1].Contains(this.ColumnSource[e].DisplayMember)&&!n.e.IsEmpty(i.Tables[1][t][this.ColumnSource[e].DisplayMember])&&(r[this.ColumnSource[e].DisplayMember]=i.Tables[1][t][this.ColumnSource[e].DisplayMember]):i.Columns[1].Contains(this.ColumnSource[e].DisplayMember)&&(r[this.ColumnSource[e].DisplayMember]=i.Tables[1][t][this.ColumnSource[e].DisplayMember]);i.Columns[1].Contains("ExtraXML")&&!n.e.IsEmpty(i.Tables[1][t].ExtraXML)&&(r.ExtraXML=i.Tables[1][t].ExtraXML),this.isModifier||this.GridDataObj.addRow(r)}if(this.RefreshGrid=!0,!this.IsPromotional)for(let e=0;e<this.GridDataColumns.length;e++)"ModSelect"!=this.GridDataColumns[e]&&"ModifierName"!=this.GridDataColumns[e]&&"MinSelect"!=this.GridDataColumns[e]&&"MaxSelect"!=this.GridDataColumns[e]&&"DimAdded"!=this.GridDataColumns[e]&&"ExtraXML"!=this.GridDataColumns[e]&&"DocDetailsID"!=this.GridDataColumns[e]&&"Type"!=this.GridDataColumns[e]&&"UOMConversion"!=this.GridDataColumns[e]&&"UOMConvertedQty"!=this.GridDataColumns[e]&&"LinkedInvDocDetailsID"!=this.GridDataColumns[e]&&"RefNo"!=this.GridDataColumns[e]&&"LinkedFieldName"!=this.GridDataColumns[e]&&(this.FooterGridData[0][this.GridDataColumns[e]]=this.drSel[this.GridDataColumns[e]])}else if(null!=this.drSel&&null!=e&&e.Tables.length>5&&e.Columns[5].Contains("Quantity")){for(let t=0;t<e.Tables[5].length;t++){let s=this.GridDataObj.NewRow();this.isModifier&&(s.ModSelect=!1,s.ModifierName=e.Tables[5][t].ModifierName.toString(),s.MinSelect=parseInt(e.Tables[5][t].MinSelect),s.MaxSelect=parseInt(e.Tables[5][t].MaxSelect)),this.GridDataColumns.Contains("ProductCode")&&(s.ProductCode=e.Tables[5][t].Productcode.toString()),this.GridDataColumns.Contains("ProductName")&&(s.ProductName=e.Tables[5][t].ProductName.toString()),s.ProductID_Key=e.Tables[5][t].ProductID.toString(),e.Columns[5].Contains("UNIT")&&!n.e.IsEmpty(e.Tables[5][t].UNIT)&&(s.Unit_Key=e.Tables[5][t].UNIT.toString()),this.GridDataObj.addRow(s),this.isModifier||this.Parent.AddProductData(s,!1,!1,!1,e.Tables[5][t].Rate.toString(),null),s.Quantity=e.Tables[5][t].Quantity.toString(),s.defaultQuantity=n.e.IsEmpty(e.Tables[5][0].KitSize)||n.e.IsEmpty(e.Tables[5][t].Quantity)?e.Tables[5][t].Quantity.toString():parseFloat(e.Tables[5][t].Quantity)/parseFloat(e.Tables[5][0].KitSize),s.LinkType=e.Tables[5][t].LinkType.toString();let i=1;!n.e.IsEmpty(s.UOMConversion)&&n.e.Double(s.UOMConversion)>0&&(i=parseFloat(s.UOMConversion.toString())),n.e.IsEmpty(s.Quantity)||(s.UOMConvertedQty=i*parseFloat(s.Quantity.toString())),this.Parent.CalculateTotals(s,!1)}this.FooterGridData[0].Quantity=e.Tables[5].length>0&&!n.e.IsEmpty(e.Tables[5][0].KitSize)?e.Tables[5][0].KitSize.toString():1;for(let t=0;t<this.GridDataColumns.length;t++)"ModSelect"!=this.GridDataColumns[t]&&"ModifierName"!=this.GridDataColumns[t]&&"MinSelect"!=this.GridDataColumns[t]&&"MaxSelect"!=this.GridDataColumns[t]&&"DimAdded"!=this.GridDataColumns[t]&&"ExtraXML"!=this.GridDataColumns[t]&&"DocDetailsID"!=this.GridDataColumns[t]&&"Quantity"!=this.GridDataColumns[t]&&"Type"!=this.GridDataColumns[t]&&"UOMConversion"!=this.GridDataColumns[t]&&"UOMConvertedQty"!=this.GridDataColumns[t]&&"LinkedInvDocDetailsID"!=this.GridDataColumns[t]&&"RefNo"!=this.GridDataColumns[t]&&"LinkedFieldName"!=this.GridDataColumns[t]&&(this.GridDataColumns[t].toLowerCase().Contains("unit")&&null==this.drSel[this.GridDataColumns[t]]&&e.Tables.length>0&&e.Columns[0].Contains("uomid")&&!n.e.IsEmpty(e.Tables[0][0].uomid)?(this.FooterGridData[0].Unit=e.Tables[0][0].UnitName.toString(),this.FooterGridData[0].Unit_key=e.Tables[0][0].uomid.toString()):this.FooterGridData[0][this.GridDataColumns[t]]=this.drSel[this.GridDataColumns[t]]);if(this.FillDynamicSetData(null),this.isModifier||e.Tables[5].length>0&&(!this.Parent.ScreenObject.Preferences.ContainsKey("SplitKit")||"true"!=this.Parent.ScreenObject.Preferences.SplitKit.toLowerCase())&&this.FillXml(!1),this.isModifier&&""!=t){this.drSel.ExtraXML=t,this.FooterGridData[0].Quantity=this.drSel.Quantity,this.OnfooterQtyChanged(this.FooterGridData[0]),this.FooterGridData[0].Rate=this.drSel.Rate,n.e.IsEmpty(this.FooterGridData[0].Rate)||n.e.IsEmpty(this.FooterGridData[0].Quantity)||(this.FooterGridData[0].Gross=parseFloat(this.FooterGridData[0].Rate.toString())*parseFloat(this.FooterGridData[0].Quantity.toString()));let e=new n.f;if(e.ReadXmlDataset(t),e.Tables.length>1)for(let t=0;t<e.Tables[1].length;t++)for(let s=0;s<this.GridData.length;s++)n.e.String(e.Tables[1][t].ProductID)==n.e.String(this.GridData[s].ProductID_Key)&&(this.GridData[s].ModSelect=!0,this.GridData[s].Quantity=e.Tables[1][t].Quantity,this.Parent.Celleditend(this.GridData[s],"Quantity",0))}}else if(!this.IsPromotional)for(let i=0;i<this.GridDataColumns.length;i++)"ModSelect"!=this.GridDataColumns[i]&&"ModifierName"!=this.GridDataColumns[i]&&"MinSelect"!=this.GridDataColumns[i]&&"MaxSelect"!=this.GridDataColumns[i]&&"DimAdded"!=this.GridDataColumns[i]&&"ExtraXML"!=this.GridDataColumns[i]&&"DocDetailsID"!=this.GridDataColumns[i]&&"Type"!=this.GridDataColumns[i]&&"UOMConversion"!=this.GridDataColumns[i]&&"UOMConvertedQty"!=this.GridDataColumns[i]&&"LinkedInvDocDetailsID"!=this.GridDataColumns[i]&&"RefNo"!=this.GridDataColumns[i]&&"LinkedFieldName"!=this.GridDataColumns[i]&&(this.FooterGridData[0][this.GridDataColumns[i]]=this.drSel[this.GridDataColumns[i]])}onBeforeRowDeleting(e){this.isKit&&alert("Can't Delete Kit Products")}OnfooterQtyChanged(e){if((this.isKit||this.isModifier)&&!n.e.IsEmpty(e.Quantity)){for(let t=0;t<this.GridData.length;t++)n.e.IsEmpty(this.GridData[t].defaultQuantity)||(this.GridData[t].Quantity=parseFloat(this.GridData[t].defaultQuantity)*parseFloat(e.Quantity),this.Parent.CalculateTotals(this.GridData[t],!1));this.FillDynamicSetData(null)}if(!n.e.IsEmpty(e.Gross)&&!n.e.IsEmpty(e.Quantity)&&0!=parseFloat(e.Quantity))if(this.CalcRate||(this.CalcRate=this.IsGrossMapped()),this.CalcRate){let t=parseFloat(e.Gross)/parseFloat(e.Quantity);e.Rate="Infinity"!=t.toString()&&"-Infinity"!=t.toString()&&"NaN"!=t.toString()?t:0}else n.e.IsEmpty(e.Rate)||n.e.IsEmpty(e.Quantity)||(e.Gross=parseFloat(e.Rate)*parseFloat(e.Quantity))}onFooterCellEditEnding(e){let t=e.item,s="";if(s=e.column.field,"Quantity"==s)this.OnfooterQtyChanged(t);else if("Rate"==s)n.e.IsEmpty(t.Rate)||n.e.IsEmpty(t.Quantity)||(t.Gross=parseFloat(t.Rate)*parseFloat(t.Quantity));else if("Gross"==s&&!n.e.IsEmpty(t.Gross)&&!n.e.IsEmpty(t.Quantity))if(this.CalcRate||(this.CalcRate=this.IsGrossMapped()),this.CalcRate){let e=parseFloat(t.Gross)/parseFloat(t.Quantity);t.Rate="Infinity"!=e.toString()&&"-Infinity"!=e.toString()&&"NaN"!=e.toString()?e:0}else n.e.IsEmpty(t.Rate)||n.e.IsEmpty(t.Quantity)||(t.Gross=parseFloat(t.Rate)*parseFloat(t.Quantity));this.FooterGridDataObj.updateRow(t)}onCellEditEnding(e){let t=e.item,s="";if(s=e.column.field,"ModSelect"!=s&&"DataGridComboBoxColumn"!=e.column.className){let s=e.column.field,i=0;if("DataGridPactListBoxColumn"==e.column.className&&(i=e.column.DgCol.CostCenterID),3==i&&this.Parent.ScreenObject.Preferences.ContainsKey("dynamicsetProductwiselinking")&&null!=this.Parent.ScreenObject.Preferences.dynamicsetProductwiselinking&&Object(o.j)(this.Parent.ScreenObject.Preferences.dynamicsetProductwiselinking)){if(!n.e.IsEmpty(t.ProductID_Key)){let e;if(e=this.Parent.ScreenObject.GetProductLinkDetails(this.Parent.DocumentID,parseInt(t.ProductID_Key),this.Parent.ScreenObject.DocDate.Date.ToString("dd/MMM/yyyy"),null!=this.Parent.ScreenObject.DueDate&&this.Parent.ScreenObject.DueDate.Date?this.Parent.ScreenObject.DueDate.Date.ToString("dd/MMM/yyyy"):"",t),null!=e&&e.Tables.length>0&&e.Tables[0].length>0){let s=new ee(this,t.ProductID_Key.toString(),e,this.GridData.indexOf(t));a.a.page.ShowDialog(s,te.a)}else this.Parent.Celleditend(t,s,i),this.FillDynamicSetData(t)}}else 2==this.CallType||3==this.CallType||4==this.CallType?this.Parent.Celleditend(t,s,i,1):this.Parent.Celleditend(t,s,i),this.FillDynamicSetData(t)}}FillDynamicSetData(e){if(!(this.IsPromotional||this.Parent.ScreenObject.Preferences.ContainsKey("SplitKit")&&"true"==this.Parent.ScreenObject.Preferences.SplitKit.toLowerCase()))try{if(null!=this.mappingdv)for(let t=0;t<this.ColumnSource.length;t++){let s=this.ColumnSource[t];if(this.mappingdv=this.mappingdvTable.filter(e=>e.CostCenterColIDField==s.ID),this.mappingdv.length>0&&this.FooterGridDataColumns.Contains(n.e.String(this.mappingdv[0].MapSysColumnName))){if(this.mappingdvColumns.Contains("IgnoreKit")&&this.isKit&&!n.e.IsEmpty(this.mappingdv[0].IgnoreKit)&&Object(o.j)(this.mappingdv[0].IgnoreKit))continue;let t="";if(Object(o.j)(this.mappingdv[0].ClubFields)){if("FLOAT"==s.DataType){let e=0;for(let t=0;t<this.GridData.length;t++)n.e.IsEmpty(this.GridData[t][s.DisplayMember])||(e+=parseFloat(this.GridData[t][s.DisplayMember]));t=e.toString()}else if("DATE"!=s.DataType){for(let e=0;e<this.GridData.length;e++)"PactComboBox"==s.DataType||"ComboBox"==s.DataType?n.e.IsEmpty(this.GridData[e][s.ValueBinding])||(t+=this.GridData[e][s.ValueBinding].toString()+this.mappingdv[0].delimiter.toString()):n.e.IsEmpty(this.GridData[e][s.DisplayMember])||(t+=this.GridData[e][s.DisplayMember].toString()+this.mappingdv[0].delimiter.toString());t.length>1&&!n.e.IsEmpty(this.mappingdv[0].delimiter)&&(t=t.substr(0,t.length-1))}}else null!=e&&(t=e[s.DisplayMember].toString());if(this.FooterGridDataColumns.Contains(this.mappingdv[0].MapSysColumnName.toString()))if(this.FooterGridDataObj.DataTypes.Double.Contains(this.mappingdv[0].MapSysColumnName.toString())){let e=n.e.Double(t);this.FooterGridData[0][this.mappingdv[0].MapSysColumnName.toString()]=e}else if(this.FooterGridDataObj.DataTypes.Int.Contains(this.mappingdv[0].MapSysColumnName.toString())){let e=n.e.Int(t);this.FooterGridData[0][this.mappingdv[0].MapSysColumnName.toString()]=e}else if(this.FooterGridDataObj.DataTypes.Date.Contains(this.mappingdv[0].MapSysColumnName.toString())){let e;n.e.isValidDate(t)&&(this.FooterGridData[0][this.mappingdv[0].MapSysColumnName.toString()]=e)}else this.FooterGridData[0][this.mappingdv[0].MapSysColumnName.toString()]=t;if("Gross"==s.DisplayMember&&!n.e.IsEmpty(this.FooterGridData[0].Gross)&&!n.e.IsEmpty(this.FooterGridData[0].Quantity)){let e=parseFloat(this.FooterGridData[0].Gross)/parseFloat(this.FooterGridData[0].Quantity);this.FooterGridData[0].Rate="Infinity"!=e.toString()&&"-Infinity"!=e.toString()&&"NaN"!=e.toString()?e:0}}}}catch(t){this.DisplayMessage="Error mapping Fields",this.MessageVisibility=!0,Logger.ErrorLog("dynamicsetviewmodel","cell edit ending",t)}}FillXml(e){let t="";t+="<xml>";let s=0;var i=this.GridData.Compute("sum","Gross"),r=this.GridData.Compute("sum","Quantity");for(let l=0;l<this.GridData.length;l++)if(!n.e.IsEmpty(this.GridData[l].ProductID_Key)){if(this.isModifier){if(!Object(o.j)(this.GridData[l].ModSelect))continue;if("1"!=n.e.String(this.GridData[l].DimAdded)){let e=this.GridData[l];this.Parent.AddProductData(e,!1,!1,!1,n.e.String(e.Rate),null),this.Parent.CalculateTotals(e,!1)}}s++,t+="<Row ><xml ";let c="",h="",d="",D=!1,S=1,m=1;null!=this.Parent.Currency&&null!=this.Parent.Currency.Currency.SelectedValue&&""!=this.Parent.Currency.Currency.SelectedValue?S=parseInt(this.Parent.Currency.Currency.SelectedValue):null!=this.drSel&&this.Parent.ScreenObject.GridDataColumns.Contains("CurrencyID")&&!n.e.IsEmpty(this.drSel.CurrencyID_Key)&&(S=parseInt(this.drSel.CurrencyID_Key)),null!=this.Parent.Currency&&null!=this.Parent.Currency.ExchangeRate.Text&&""!=this.Parent.Currency.ExchangeRate.Text?m=parseFloat(this.Parent.Currency.ExchangeRate.Text):null!=this.drSel&&this.Parent.ScreenObject.GridDataColumns.Contains("ExchangeRate")&&!n.e.IsEmpty(this.drSel.ExchangeRate)&&(m=parseFloat(this.drSel.ExchangeRate));for(let s=0;s<this.ColumnSource.length;s++)if(!this.ColumnSource[s].DisplayMember.toLowerCase().Contains("modselect")&&!this.ColumnSource[s].DisplayMember.toLowerCase().Contains("modifiername")){if(e&&!this.Parent.ValidateDataonSave_col_dr(this.ColumnSource[s],this.GridData[l]))return!1;if(this.ColumnSource[s].IsColumnUserDefined){if(this.ColumnSource[s].DisplayMember.toLowerCase().Contains("dcexchrt")||this.ColumnSource[s].DisplayMember.toLowerCase().Contains("dccurrid"))continue;if("SELECTIONBOX"==this.ColumnSource[s].DataType)t+=this.ColumnSource[s].DisplayMember+'="'+u.d.GetValidXml(this.GridData[l][this.ColumnSource[s].DisplayMember])+'" ',d+=this.ColumnSource[s].DisplayMember+"='"+u.d.GetValidTextXml(this.GridData[l][this.ColumnSource[s].DisplayMember])+"', ";else if(this.ColumnSource[s].DisplayMember.toLowerCase().Contains("dcnum")){a.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(o.j)(a.a.SessionManager.Preferences["Use Foreign Currency"])&&("-2"==this.ColumnSource[s].DefaultValue?(n.e.IsEmpty(this.GridData[l]["dcCurrID"+this.ColumnSource[s].DisplayMember.toLowerCase().replace("dcnum","")+"_Key"])||(S=parseInt(this.GridData[l]["dcCurrID"+this.ColumnSource[s].DisplayMember.toLowerCase().replace("dcnum","")+"_Key"])),n.e.IsEmpty(this.GridData[l]["dcExchRT"+this.ColumnSource[s].DisplayMember.toLowerCase().replace("dcnum","")])||(m=parseFloat(this.GridData[l]["dcExchRT"+this.ColumnSource[s].DisplayMember.toLowerCase().replace("dcnum","")]))):n.e.Int(this.ColumnSource[s].DefaultValue)>0&&this.ColumnSource[s].CurrID>0&&(S=this.ColumnSource[s].CurrID,m=this.ColumnSource[s].ExhcgRt)),t+=this.ColumnSource[s].DisplayMember+'="'+n.e.String(this.GridData[l][this.ColumnSource[s].DisplayMember])+'" ';let e=n.e.Double(this.GridData[l]["dcCalc"+this.ColumnSource[s].DisplayMember]);a.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(o.j)(a.a.SessionManager.Preferences["Use Foreign Currency"])&&(t+="dcCurrID"+this.ColumnSource[s].DisplayMember.toLowerCase().replace("dcnum","")+'="'+S+'" ',t+="dcExchRT"+this.ColumnSource[s].DisplayMember.toLowerCase().replace("dcnum","")+'="'+m+'" ',t+="dcCalcNumFC"+this.ColumnSource[s].DisplayMember.toLowerCase().replace("dcnum","")+'="'+e+'" '),t+="dcCalc"+this.ColumnSource[s].DisplayMember.replace("dc","")+'="'+e*m+'" ',n.e.IsEmpty(this.GridData[l][this.ColumnSource[s].DisplayMember])?h+=this.ColumnSource[s].DisplayMember+"=0, ":h+=this.ColumnSource[s].DisplayMember+"="+this.GridData[l][this.ColumnSource[s].DisplayMember].toString()+", ",e=n.e.Double(this.GridData[l]["dcCalc"+this.ColumnSource[s].DisplayMember]),a.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(o.j)(a.a.SessionManager.Preferences["Use Foreign Currency"])&&(h+="dcCurrID"+this.ColumnSource[s].DisplayMember.toLowerCase().replace("dcnum","")+"="+S+", ",h+="dcExchRT"+this.ColumnSource[s].DisplayMember.toLowerCase().replace("dcnum","")+"="+m+", ",h+="dcCalcNumFC"+this.ColumnSource[s].DisplayMember.toLowerCase().replace("dcnum","")+"="+e+", "),h+="dcCalc"+this.ColumnSource[s].DisplayMember.replace("dc","")+"="+e*m+", "}else"DATE"==this.ColumnSource[s].DataType?n.e.IsEmpty(this.GridData[l][this.ColumnSource[s].DisplayMember+"_Key"])||(t+=this.ColumnSource[s].DisplayMember+'="'+new Date(this.GridData[l][this.ColumnSource[s].DisplayMember+"_Key"]).ToString("dd/MMM/yyyy")+'" ',d+=this.ColumnSource[s].DisplayMember+"='"+new Date(this.GridData[l][this.ColumnSource[s].DisplayMember+"_Key"]).ToString("dd/MMM/yyyy")+"', "):"ComboBox"==this.ColumnSource[s].DataType?(t+=this.ColumnSource[s].ValueBinding+'="'+u.d.GetValidXml(this.GridData[l][this.ColumnSource[s].ValueBinding])+'" ',d+=this.ColumnSource[s].ValueBinding+"='"+u.d.GetValidTextXml(this.GridData[l][this.ColumnSource[s].ValueBinding])+"', "):"PactComboBox"==this.ColumnSource[s].DataType?(t+=this.ColumnSource[s].ValueBinding+'="'+u.d.GetValidXml(this.GridData[l][this.ColumnSource[s].ValueBinding+"_Key"])+'" ',d+=this.ColumnSource[s].ValueBinding+"='"+u.d.GetValidTextXml(this.GridData[l][this.ColumnSource[s].ValueBinding+"_Key"])+"', "):"LISTBOX"==this.ColumnSource[s].DataType&&0!=this.ColumnSource[s].CostCenterID&&this.ColumnSource[s].DisplayMember.toLowerCase().Contains("alpha")?(t+=this.ColumnSource[s].DisplayMember+'="'+n.e.String(this.GridData[l][this.ColumnSource[s].ValueMember])+'" ',d+=this.ColumnSource[s].DisplayMember+"='"+n.e.String(this.GridData[l][this.ColumnSource[s].ValueMember])+"', "):0!=this.ColumnSource[s].CostCenterID?n.e.Int(this.GridData[l][this.ColumnSource[s].ValueMember])>0&&(t+=this.ColumnSource[s].DisplayMember+'="'+n.e.String(this.GridData[l][this.ColumnSource[s].ValueMember])+'" ',this.ColumnSource[s].DisplayMember.toLowerCase().Contains("dcccnid")&&(c+=this.ColumnSource[s].DisplayMember+"="+n.e.String(this.GridData[l][this.ColumnSource[s].ValueMember])+", ")):(t+=this.ColumnSource[s].DisplayMember+'="'+u.d.GetValidXml(this.GridData[l][this.ColumnSource[s].DisplayMember])+'" ',d+=this.ColumnSource[s].DisplayMember+"='"+u.d.GetValidTextXml(this.GridData[l][this.ColumnSource[s].DisplayMember])+"', ")}else 3==this.ColumnSource[s].CostCenterID?(D||(t+=this.ColumnSource[s].ValueMember.substr(0,this.ColumnSource[s].ValueMember.length-4)+'="'+n.e.String(this.GridData[l][this.ColumnSource[s].ValueMember])+'" '),D=!0):0!=this.ColumnSource[s].CostCenterID?(n.e.Int(this.GridData[l][this.ColumnSource[s].ValueMember])>0&&"CurrencyID"!=this.ColumnSource[s].DisplayMember&&(t+=this.ColumnSource[s].ValueMember.substr(0,this.ColumnSource[s].ValueMember.length-4)+'="'+n.e.String(this.GridData[l][this.ColumnSource[s].ValueMember])+'" '),"unit"==this.ColumnSource[s].DisplayMember.toLowerCase()&&(t+='UOMConversion="'+n.e.String(this.GridData[l].UOMConversion)+'" ',t+='UOMConvertedQty="'+n.e.String(this.GridData[l].UOMConvertedQty)+'" ')):t+="DocDetailsID"==this.ColumnSource[s].DisplayMember?' DocDetailsID="'+n.e.String(this.GridData[l].DocDetailsID)+'" ':"ComboBox"==this.ColumnSource[s].DataType?this.ColumnSource[s].ValueBinding+'="'+u.d.GetValidXml(this.GridData[l][this.ColumnSource[s].ValueBinding])+'" ':this.ColumnSource[s].DisplayMember+'="'+u.d.GetValidXml(this.GridData[l][this.ColumnSource[s].DisplayMember])+'" '}n.e.IsEmpty(this.GridData[l].AVGRATE)||(t+='AverageRate="'+this.GridData[l].AVGRATE.toString()+'" '),t+=' CCQuery="'+c.toString()+'" ',t+=' NumQuery="'+h.toString()+'" ',t+=' texQuery="'+d.toString()+'" ',null!=i&&(t+=' totgross="'+i.toString()+'" '),null!=r&&(t+=' totQty="'+r.toString()+'" '),t+=' Type="'+n.e.String(this.GridData[l].Type)+'" ',this.isKit&&(t+=' LinkType="'+n.e.String(this.GridData[l].LinkType)+'" ',t+=' defaultQuantity="'+n.e.String(this.GridData[l].defaultQuantity)+'" '),n.e.IsEmpty(this.GridData[l].LinkedFieldName)||(t+='LinkedFieldValue="'+this.GridData[l][this.GridData[l].LinkedFieldName.toString()].toString()+'" '),n.e.IsEmpty(this.GridData[l].ExtraXML)||"2"!=n.e.String(this.GridData[l].Type)&&"5"!=n.e.String(this.GridData[l].Type)||(t+=' ExtraXML="'+u.d.GetValidTextXml(this.GridData[l].ExtraXML)+'" '),t+=" />",t+="</Row>"}if(t+="</xml>",this.IsPromotional){let e=this.Parent.ScreenObject.Data.Tables[0].filter(e=>79==e.LocalReference&&55493==e.LinkData);e.length>0&&this.Parent.ScreenObject.GridDataColumns.Contains(e[0].SysColumnName.toString())&&(this.drSel[e[0].SysColumnName.toString()]=s),this.drSel.PromotionXML=t.toString()}else{for(let e=0;e<this.GridDataColumns.length;e++)"ModSelect"!=this.GridDataColumns[e]&&"ModifierName"!=this.GridDataColumns[e]&&"MinSelect"!=this.GridDataColumns[e]&&"MaxSelect"!=this.GridDataColumns[e]&&"ExtraXML"!=this.GridDataColumns[e]&&"DimAdded"!=this.GridDataColumns[e]&&"DocSeqNo"!=this.GridDataColumns[e]&&"DocDetailsID"!=this.GridDataColumns[e]&&"Type"!=this.GridDataColumns[e]&&"UOMConversion"!=this.GridDataColumns[e]&&"UOMConvertedQty"!=this.GridDataColumns[e]&&"LinkedInvDocDetailsID"!=this.GridDataColumns[e]&&"RefNo"!=this.GridDataColumns[e]&&"LinkedFieldName"!=this.GridDataColumns[e]&&"ProductID_Key"!=this.GridDataColumns[e]&&"ProductCode"!=this.GridDataColumns[e]&&"ProductName"!=this.GridDataColumns[e]&&(this.drSel[this.GridDataColumns[e]]=this.FooterGridData[0][this.GridDataColumns[e]]);this.drSel.ExtraXML=t.toString()}return!0}onSearch(e){"PactTextBoxEditor"==e.column.className&&"holdquantity"==e.column.field.toLowerCase()?null!=this.SelectedRow&&!n.e.IsEmpty(this.SelectedRow.DocDetailsID)&&parseInt(this.SelectedRow.DocDetailsID)>0&&a.a.page.ShowDialog(new se(this),ie.a):("quantity"==e.column.field.toLowerCase()&&!n.e.IsEmpty(this.SelectedRow.Quantity)||"FreeQTY"==e.column.field&&!n.e.IsEmpty(this.SelectedRow.FreeQTY))&&"5"==this.SelectedRow.Type.toString()&&(this.Parent.ScreenObject.Preferences.ContainsKey("ShowBatches")&&""!=this.Parent.ScreenObject.Preferences.ShowBatches&&Object(o.j)(this.Parent.ScreenObject.Preferences.ShowBatches)||!this.Parent.DonotUpdateInventory)&&(1==e.Owner.CurrentCellContainer.IsEditing?e.Owner.OnTabKeyDown(null):this.Parent.fillbatches(this.SelectedRow.Row,e.column.field))}onBeginEdit(e){this.Parent.onBeginEdit(e)}FillEmptyRows(){for(let e=this.GridData.length;e<10;e++)this.GridDataObj.addEmptyRow();for(let e=0;e<this.GridData.length;e++)this.GridData[e].DocSeqNo=e+1}InitGrid(){if(this.isModifier){let e=new y.a;e=new y.a,e.ID="0",e.Header="Select",e.DisplayMember="ModSelect",e.DataType="CheckBox",e.Width=70,this.ColumnSource.push(e),e=new y.a,e.ID="0",e.Header="Modifier Name",e.DisplayMember="ModifierName",e.DataType="TextBlock",e.Width=120,e.ReadOnly=!0,this.ColumnSource.push(e),this.GridDataObj.TableColumns.push("ModSelect"),this.GridDataObj.TableColumns.push("ModifierName"),this.GridDataObj.TableColumns.push("MinSelect"),this.GridDataObj.TableColumns.push("MaxSelect"),this.GridDataObj.TableColumns.push("DimAdded")}for(let e=0;e<this.Parent.ScreenObject.GridDataColumns.length;e++)this.GridDataColumns.push(this.Parent.ScreenObject.GridDataColumns[e]),this.FooterGridDataColumns.push(this.Parent.ScreenObject.GridDataColumns[e]);4==this.CallType&&(this.CCList=new Array);for(let e=0;e<this.Parent.ScreenObject.ColumnSource.length;e++){let t=this.Parent.ScreenObject.ColumnSource[e],s=t.Clone(),i=t.Clone();if(4==this.CallType&&i.DisplayMember.toLowerCase().startsWith("dcccnid")){let e=new D.a;e.CheckedListBoxComboData_1(0),e.DBColumnName=i.DisplayMember,e.GroupName=i.ValueMember,e.FeatureID=i.CostCenterID,e.DataType=i.CostCenterID.toString(),e.Label=i.Header,e.Height=150,this.CCList.push(e),n.e.IsEmpty(this.drSel[i.ValueMember])||e.Items.push(D.c.CheckedListBoxItem_5(this.drSel[i.DisplayMember].toString(),this.drSel[i.ValueMember].toString(),!0))}else 2!=this.CallType&&3!=this.CallType&&4!=this.CallType&&(this.isModifier?t.Header.Contains("Product")&&(i.Header="Modifier Product"):t.Header.Contains("Product")&&(i.Header=i.Header.Replace("Product","KIT")),this.mappingdvColumns.length>0&&(this.mappingdv=this.mappingdvTable.filter(e=>e.CostCenterColIDField==t.ID)),this.mappingdv.length>0&&!n.e.IsEmpty(this.mappingdv[0].Show)&&Object(o.j)(this.mappingdv[0].Show)?(s.IsVisible=!0,i.IsVisible=!0):(s.IsVisible=!1,i.IsVisible=!1),this.mappingdv.length>0&&!n.e.IsEmpty(this.mappingdv[0].ListTypeID)&&parseInt(this.mappingdv[0].ListTypeID)>0&&(s.TypeID=parseInt(this.mappingdv[0].ListTypeID)),this.isModifier?s.ReadOnly="ModSelect"!=s.DisplayMember&&"Quantity"!=s.DisplayMember:!this.isKit||"Quantity"!=s.DisplayMember&&"ProductID_Key"!=s.ValueMember||(s.ReadOnly=!0));this.ColumnSource.push(s),this.FooterColumnSource.push(i)}this.FooterGridDataObj.addEmptyRow()}OnButtonClick(e){if(this.GridDataObj.angularGrid&&(this.GridDataObj.angularGrid.resizerService.resizeGrid(),this.GridDataObj.refreshDataView(),this.GridDataObj.RefreshColumns()),"Cancel"==e)this.isModifier&&null!=this.drSel&&""==n.e.String(this.drSel.ExtraXML)&&(this.Parent.ClearDatarow(this.drSel,!0),this.Parent.ScreenObject.GridDataObj.refreshDatawithIDs()),a.a.page.HideDialog();else if("Generate"==e){let e=this.CCList.length;this.stkID=new Array(e),this.stkName=new Array(e),this.CCList.length>0&&this.CallRecursive(0)}else if("AddRows"==e){let e,t=0;if(n.e.IsNum(this.AddRows.Text)){t=n.e.Int(this.AddRows.Text);for(let s=0;s<t;s++){e=this.Parent.GetEmptyRowPosition(this.GridDataObj,"ProductID_Key");for(let t=0;t<this.GridDataColumns.length;t++)"ModSelect"!=this.GridDataColumns[t]&&"ModifierName"!=this.GridDataColumns[t]&&"MinSelect"!=this.GridDataColumns[t]&&"MaxSelect"!=this.GridDataColumns[t]&&"ExtraXML"!=this.GridDataColumns[t]&&"DocDetailsID"!=this.GridDataColumns[t]&&(this.GridData[e][this.GridDataColumns[t]]=this.FooterGridData[0][this.GridDataColumns[t]]);this.GridDataObj.updateRow(this.GridData[e])}this.FillEmptyRows()}}else if("OK"==e||"AutoSave"==e){if(this.isModifier&&this.GridData.length>0){let e=this.GridData;if(null!=e){let t=0,s=0,i=0;for(let a=0;a<e.length;a++)if(!n.e.IsEmpty(e[a].ModifierName)){t=s=i=0,s=parseInt(e[a].MinSelect),i=parseInt(e[a].MaxSelect);for(let s=0;s<this.GridData.length;s++)n.e.String(this.GridData[s].ModifierName)==n.e.String(e[a].ModifierName)&&Object(o.j)(this.GridData[s].ModSelect)&&t++;if(t<s)return this.DisplayMessage="You should select atleast "+s+" for this Modifier : "+e[a].ModifierName.toString(),void(this.MessageVisibility=!0);if(t>i)return this.DisplayMessage="You should select only "+i+" for this Modifier : "+e[a].ModifierName.toString(),void(this.MessageVisibility=!0)}}}if(2==this.CallType||3==this.CallType||4==this.CallType){let e=0,t=0;for(let i=0;i<this.GridData.length;i++)n.e.IsEmpty(this.GridData[i].ProductID_Key)||n.e.IsEmpty(this.GridData[i].Quantity)||(e+=parseFloat(this.GridData[i].Quantity));if(2==this.CallType&&this.FooterGridData.length>0&&!n.e.IsEmpty(this.FooterGridData[0].Quantity)&&parseFloat(this.FooterGridData[0].Quantity).ToString("N2")!=e.ToString("N2"))return this.DisplayMessage="Qty not equal",void(this.MessageVisibility=!0);let s=null;e=0;for(let i=0;i<this.GridData.length;i++)if(!n.e.IsEmpty(this.GridData[i].ProductID_Key)){let a;0==e?(a=this.drSel,"5"!=n.e.String(a.Type)||n.e.IsEmpty(a.ExtraXML)||(s=new n.f,s.LoadXml(a.ExtraXML),s.DocumentElement.children.length>0&&s.DocumentElement.children.length>0&&null!=s.DocumentElement.children[0].attributes.Quantity&&!n.e.IsEmpty(s.DocumentElement.children[0].attributes.Quantity.Value)&&(t=parseFloat(s.DocumentElement.children[0].attributes.Quantity.Value)))):(a=this.Parent.ScreenObject.GridDataObj.NewRow(),this.Parent.ScreenObject.GridDataObj.insertRowAt(a,this.Parent.ScreenObject.SelectedGridRowIndex+e));for(let e=0;e<this.GridDataColumns.length;e++)"ExtraXML"!=this.GridDataColumns[e]&&"DocSeqNo"!=this.GridDataColumns[e]&&"DocDetailsID"!=this.GridDataColumns[e]&&(a[this.GridDataColumns[e]]=this.GridData[i][this.GridDataColumns[e]]);t>0&&null!=s&&!n.e.IsEmpty(a.Quantity)&&(s.DocumentElement.children[0].attributes.Quantity.Value=a.Quantity.toString(),a.ExtraXML=s.getNodeData(s.DocumentElement),t-=parseFloat(a.Quantity)),e++}this.Parent.ScreenObject.UpdateSequence(),this.Parent.ScreenObject.GridDataObj.Update()}else if(this.Parent.ScreenObject.Preferences.ContainsKey("SplitKit")&&"true"==n.e.String(this.Parent.ScreenObject.Preferences.SplitKit).toLowerCase()){this.Parent.ScreenObject.ColumnSource.filter(e=>null!=e.ValueMember&&"productid_key"==e.ValueMember.toString().toLowerCase()).forEach(e=>{this.Parent.ScreenObject.Data.Tables[0].filter(t=>null!=t.LocalReference&&t.LocalReference==e.ID).length>0&&""!=e.ValueMember&&!n.e.IsEmpty(this.FooterGridData[0][e.ValueMember])&&this.Parent.ScreenObject.GetLinkReferenceData(parseInt(e.ID),this.Parent.DocumentID,parseInt(this.FooterGridData[0][e.ValueMember]),Date.Today(),"",e.CostCenterID,this.FooterGridData[0],null,!1)}),this.Parent.ScreenObject.Data.Tables[15].length>0&&this.ColumnSource.forEach(e=>{let t=this.Parent.ScreenObject.Data.Tables[15].filter(t=>0!=t.CostCenterColIDMapping&&t.CostCenterColIDMapping==e.ID);if(t.length>0&&this.GridDataColumns.Contains(t[0].SysColumnName.toString())&&(this.FooterGridDataColumns.Contains(e.DisplayMember)&&!n.e.IsEmpty(this.FooterGridData[0][e.DisplayMember])||"combobox"==e.DataType.toLowerCase()&&!n.e.IsEmpty(this.FooterGridData[0][e.ValueBinding])))for(let s=0;s<this.GridData.length;s++)n.e.IsEmpty(this.GridData[s].ProductID_Key)||("combobox"==e.DataType.toLowerCase()?this.GridData[s][t[0].SysColumnName.toString()]=this.FooterGridData[0][e.ValueBinding].toString():this.GridData[s][t[0].SysColumnName.toString()]=this.FooterGridData[0][e.DisplayMember].toString(),this.GridDataColumns.Contains(t[0].SysColumnName.toString()+"_Key")&&this.FooterGridDataColumns.Contains(e.DisplayMember+"_Key")&&(this.GridData[s][t[0].SysColumnName.toString()+"_Key"]=this.FooterGridData[0][e.DisplayMember+"_Key"].toString()))});let e=0,t=-1;for(let s=0;s<this.GridData.length;s++)if(!n.e.IsEmpty(this.GridData[s].ProductID_Key)){let i;e++,1==e?i=this.drSel:(-1==t&&(t=this.Parent.ScreenObject.GridData.indexOf(this.drSel)),t++,i=this.Parent.ScreenObject.GridDataObj.NewRow(),this.Parent.ScreenObject.GridDataObj.insertRowAt(i,t));for(let e=0;e<this.GridDataColumns.length;e++)"ExtraXML"!=this.GridDataColumns[e]&&"DocSeqNo"!=this.GridDataColumns[e]&&"DocDetailsID"!=this.GridDataColumns[e]&&(i[this.GridDataColumns[e]]=this.GridData[s][this.GridDataColumns[e]])}this.Parent.CalculateTotals(null,!1),e>1&&this.Parent.ScreenObject.UpdateSequence(),this.Parent.res="Yes"}else if(!this.FillXml(!0))return;"AutoSave"!=e&&a.a.page.HideDialog()}}LoadLinkData(e,t,s){if(1==e.Tables.length&&e.Columns[0].Contains("ErrorMessage"))return;let i,a=0;for(let r=0;r<e.Tables[0].length;r++)if((!(t.length>0)||t.Contains(parseInt(e.Tables[0][r].DocDetailsID)))&&(!e.Columns[0].Contains("DynamicInvDocDetailsID")||n.e.IsEmpty(e.Tables[0][r].DynamicInvDocDetailsID)||!n.e.IsValidID(parseInt(e.Tables[0][r].DynamicInvDocDetailsID)))){i=this.GridDataObj.NewRow();for(let t=0,s=0;t<this.ColumnSource.length;t++,s++)"DocDetailsID"!=this.ColumnSource[t].DisplayMember&&"RefNo"!=this.ColumnSource[t].DisplayMember&&"LinkedFieldName"!=this.ColumnSource[t].DisplayMember&&this.Parent.ScreenObject.SetLinkValues(e,this.ColumnSource[t],r,i,null,"");i.LinkedInvDocDetailsID=e.Tables[0][r].DocDetailsID.toString(),i.RefNo=e.Tables[0][r].VoucherNo.toString(),i.LinkedFieldName=e.Tables[0][r][1].toString(),i[e.Tables[0][r][1].toString()]=e.Tables[0][r][0].toString(),this.Parent.ScreenObject.Preferences.ContainsKey("DisableQtyCheck")&&Object(o.j)(this.Parent.ScreenObject.Preferences.DisableQtyCheck)&&(i.defaultQuantity=i.Quantity),e.Columns[0].Contains("ProductTypeID")&&(i.Type=e.Tables[0][r].ProductTypeID.toString(),e.Columns[0].Contains("UOMConversion")?(i.UOMConversion=e.Tables[0][r].UOMConversion.toString(),i.UOMConvertedQty=n.e.IsEmpty(e.Tables[0][r].UOMConversion)?i.Quantity:parseFloat(i.Quantity)*parseFloat(e.Tables[0][r].UOMConversion)):(i.UOMConversion=1,i.UOMConvertedQty=i.Quantity)),this.GridDataObj.insertRowAt(i,s+a),a++,this.Parent.CalculateTotals(i,!1)}a>0&&this.GridDataObj.removeRowAt(s+a),0==t.length&&e.Tables[0].length>0&&(this.RefreshGrid=!0),a>0&&this.FillDynamicSetData(this.GridData[s+a-1])}}var oe=s("6l4u");class le extends l.b{constructor(e,t,s=null){if(super(),this.BOEAdjSummary="",this.BOEAdjSummaryVisibility=!1,this.chkkBOEAdjustFIFOVisibility=!1,this.BOEAdjustFIFOObj=new S.a,this.GridDataObj=new F.a,this.GridMaxWidth=200,this.LoadDataVisibile=!1,this.CustomizeVisible=!1,this.FooterCalcValue=null,this.FooterName=null,this.FooterValue=null,this.QtyType=0,this.AutoAdjustVisibility=!1,this.ImportBtnVisibility=!1,this.ImportScrVisibility=!1,this.Parent=null,this.TotalQoh=0,this.Wt=0,this.Vol=0,this.flds=[],this.strFldsList=new r.a,this.FooterfldID=0,this.Footerfld="",this.Query="",this.Dims="",this.PackWise=!1,this.IsSingleProd=!1,this.drEdit=null,this.dtBins=null,this.dsusedbins=new n.f,this.SelectedRowEditing=!1,this.ExcelTable=[],this.ActualFileName="",this.RimFileName="",this.DtImport=[],this.ImportCols=[],this.GridDataObj.Table=[],this.GridDataObj.CanUserDeleteRows=!1,this.GridDataObj.CanUserAddRows=!1,this.Parent=e,this.QtyType=t,this.GridDataObj.BeginEdit.Subscribe(this,"OnBeginedit"),this.GridDataObj.CellEditEnding.Subscribe(this,"oncelleditend"),this.GridDataObj.DoubleClick.Subscribe(this,"onDoubleClick"),2!=this.QtyType&&(this.chkkBOEAdjustFIFOVisibility=!1,this.BOEAdjustFIFOObj.IsChecked=!1,this.BOEAdjSummaryVisibility=!1,this.BOEAdjSummary=""),6==this.QtyType&&(this.QtyType=3,this.IsSingleProd=!0),3==this.QtyType&&(this.Parent.ScreenObject.Preferences.ContainsKey("PackWiseProds")&&"true"==this.Parent.ScreenObject.Preferences.PackWiseProds.toLowerCase()||this.Parent.ScreenObject.Preferences.ContainsKey("LineWisePacking")&&"true"==this.Parent.ScreenObject.Preferences.LineWisePacking.toLowerCase())&&(this.PackWise=!0),this.TextFields=[],5==this.QtyType){this.Title="Customize";let e=a.a.SessionManager.ListViewDef.Tables[0].filter(e=>3==e.CostCenterID),t=new D.e;t.Label="Product Listview",t.Column=0,t.Row=0;for(let s=0;s<e.length;s++)t.Items.find(t=>t.Value==e[s].ListViewTypeID.toString())||t.Items.push(D.d.ComboBoxItems_2(e[s].LISTVIEWNAME.toString(),e[s].ListViewTypeID.toString()));this.TextFields.push(t)}this.InitGrid();let i=null;if(1==this.QtyType)this.Title=a.a.SessionManager.Preferences.QtyAdjustmentTitle,this.GridDataObj.CanUserAddRows=!0,this.Parent.ScreenObject.Preferences.ContainsKey("QtyAdjust-AutoAdjust")&&"true"==this.Parent.ScreenObject.Preferences["QtyAdjust-AutoAdjust"].toString().toLowerCase()&&(this.AutoAdjustVisibility=!0),this.Parent.ScreenObject.Preferences.ContainsKey("QtyAdjust-Import")&&"true"==this.Parent.ScreenObject.Preferences["QtyAdjust-Import"].toString().toLowerCase()&&(this.ImportBtnVisibility=!0);else if(0==this.QtyType){if(this.Title="Field calculator",n.e.IsType(e,"AddEditDocumentViewModel")){let e=this.Parent.ScreenObject.ColumnSource,t=this.Parent.ScreenObject.Preferences.FieldCalculatorTextFields;if(i=this.Parent.SelectedRow,t.length>0){let s=0,a=new n.f;a.LoadXml(t);for(let t=0;t<a.DocumentElement.children.length;t++){let r=a.DocumentElement.children[t],o=e.find(e=>e.ID==r.attributes.CostCenterColID.value);if(o){let e=new u.d;e.Label=o.Header,this.Parent.ScreenObject.GridDataColumns.Contains(o.DisplayMember)?e.Text=n.e.String(i[o.DisplayMember]):this.Parent.ScreenObject.GridDataColumns.Contains(o.ValueBinding)&&(e.Text=n.e.String(i[o.ValueBinding])),e.Column=s%2,1==e.Column&&(e.Column=3),e.ColumnSpan=2,e.Row=s/2,e.IsReadOnly=!0,this.TextFields.push(e),s++}}}}else if(e instanceof re){i=this.Parent.SelectedRow;let e=new u.d;e.Label="Product Code",e.Column=0,e.Row=0,e.ColumnSpan=2,e.IsReadOnly=!0,e.Text=n.e.String(i.Productcode),this.TextFields.push(e),e=new u.d,e.Label="Product Name",e.Column=3,e.Row=0,e.ColumnSpan=2,e.IsReadOnly=!0,e.Text=n.e.String(i.ProductName),this.TextFields.push(e)}let t=!1;(n.e.IsType(this.Parent,"AddEditDocumentViewModel")&&this.Parent.ScreenObject.Preferences.ContainsKey("CalcFieldsDynamic")&&Object(o.j)(this.Parent.ScreenObject.Preferences.CalcFieldsDynamic)||this.Parent instanceof re&&this.Parent.Parent.ScreenObject.Preferences.ContainsKey("CalcFieldsDynamic")&&Object(o.j)(this.Parent.Parent.ScreenObject.Preferences.CalcFieldsDynamic))&&(t=!0),n.e.IsType(this.Parent,"AddEditDocumentViewModel")&&this.Parent.ScreenObject.Preferences.ContainsKey("CalcFooterField")&&""!=this.Parent.ScreenObject.Preferences.CalcFooterField&&parseInt(this.Parent.ScreenObject.Preferences.CalcFooterField)>0?this.FooterfldID=parseInt(this.Parent.ScreenObject.Preferences.CalcFooterField):this.Parent instanceof re&&this.Parent.Parent.ScreenObject.Preferences.ContainsKey("CalcFooterField")&&""!=this.Parent.Parent.ScreenObject.Preferences.CalcFooterField&&parseInt(this.Parent.Parent.ScreenObject.Preferences.CalcFooterField)>0&&(this.FooterfldID=parseInt(this.Parent.Parent.ScreenObject.Preferences.CalcFooterField));let s=[],a=null,r=null;n.e.IsType(this.Parent,"AddEditDocumentViewModel")?(r=this.Parent.ScreenObject.ColumnSource,a=this.Parent.ScreenObject.GridDataColumns):this.Parent instanceof re&&(r=this.Parent.Parent.ScreenObject.ColumnSource,a=this.Parent.Parent.ScreenObject.GridDataColumns),null!=r&&(s.push(D.d.ComboBoxItems_2("","")),r.forEach(e=>{if(e.ShowinCalc&&e.IsVisible){this.FooterfldID.toString()!=e.ID?s.push(D.d.ComboBoxItems_2(e.Header,e.DisplayMember)):this.FooterfldID.toString()==e.ID&&(this.Footerfld=e.DisplayMember,this.FooterName=e.Header),this.flds.push(e.DisplayMember);let r=this.GridDataObj.NewRow();r.Name=e.DisplayMember,0!=n.e.Double(i[e.DisplayMember])&&(r.Amount=i[e.DisplayMember]),a.Contains("dcCalc"+e.DisplayMember)?(r.CalcAmount=n.e.String(i["dcCalc"+e.DisplayMember]),this.flds.push("dcCalc"+e.DisplayMember)):r.CalcAmount=i[e.DisplayMember],t&&0==n.e.Double(r.Amount)||this.FooterfldID.toString()==e.ID||this.GridDataObj.addRow(r)}})),this.ColumnSource[0].ComboData=s,t||(this.ColumnSource[0].DisableTab=this.ColumnSource[0].ReadOnly=!0),this.SetFocusongrid=!0}else if(2==this.QtyType||7==this.QtyType){this.Title="Bill of Entry",null==s&&(s=this.Parent.SelectedRow),this.Parent.ScreenObject.Preferences.ContainsKey("ShowBOE")&&"true"==this.Parent.ScreenObject.Preferences.ShowBOE.toLowerCase()&&(this.LoadDataVisibile=!0);let e=new u.d;if(e.Label="Scan",e.Column=0,e.Row=0,e.isSKU=!0,e.ColumnSpan=2,e.DBColumnName="SKU",e.TextChangedCommand.Subscribe(this,"Scan"),e.SetFocus=!0,this.TextFields.push(e),2==this.QtyType){this.chkkBOEAdjustFIFOVisibility=!0,this.BOEAdjustFIFOObj.IsChecked=!1,this.BOEAdjSummaryVisibility=!0,!n.e.IsEmpty(s.DocDetailsID)&&parseInt(s.DocDetailsID.toString())>0&&(this.SelectedRowEditing=!0);let t="",i="0";e=new u.d,e.Label="Product",Object.keys(s).Contains("ProductName")?e.Text=n.e.String(s.ProductName):Object.keys(s).Contains("ProductCode")&&(e.Text=n.e.String(["ProductCode"])),e.Column=2,e.Row=0,this.TextFields.push(e),t=e.Text,e=new u.d,e.Label="Qty",e.Text=this.getQty(s),e.Column=3,e.Row=0,e.IsReadOnly=!0,this.TextFields.push(e),i=e.Text,this.BOEAdjSummary="Qty. Adjusted  :  0  of  "+i+"  for the Product  :  "+t;let a="",r="",o="";if(this.Parent.ScreenObject.Preferences.ContainsKey("ClubBoe")&&"True"==this.Parent.ScreenObject.Preferences.ClubBoe&&!this.SelectedRowEditing){for(let e=0;e<this.Parent.ScreenObject.GridData.length;e++)if(!(this.Parent.ScreenObject.GridData[e].ProductID_Key.toString()!=s.ProductID_Key.ToString()||n.e.Int(this.Parent.ScreenObject.GridData[e].DocDetailsID)>0||(n.e.IsEmpty(this.Parent.ScreenObject.GridData[e].LinkedInvDocDetailsID)||(""!=r&&(r+=","),r+=this.Parent.ScreenObject.GridData[e].LinkedInvDocDetailsID.toString()),n.e.IsEmpty(this.Parent.ScreenObject.GridData[e].DocExtraXML)))){let t=new n.f;t.LoadXml(this.Parent.ScreenObject.GridData[e].DocExtraXML);let s=t.SelectNodes("DocExtraXML/Row");for(let e=0;e<s.length;e++){let t=this.GridDataObj.NewRow();if(null!=s[e].attributes.RefID&&!n.e.IsEmpty(s[e].attributes.RefID.value)){var l=this.GridData.filter(t=>t.RefID==s[e].attributes.RefID.value);if(l.length>0){null==s[e].attributes.Qty||n.e.IsEmpty(s[e].attributes.Qty.value)||(l[0].Qty=parseFloat(l[0].Qty)+parseFloat(s[e].attributes.Qty.value));continue}t.RefID=s[e].attributes.RefID.value,""!=a&&(a+=","),a+=s[e].attributes.RefID.value}null==s[e].attributes.Qty||n.e.IsEmpty(s[e].attributes.Qty.value)||(t.Qty=s[e].attributes.Qty.value),t.Type=1,this.GridDataObj.addRow(t)}}}else{for(let e=0;e<this.Parent.ScreenObject.GridData.length;e++)this.Parent.ScreenObject.GridData[e]==s||n.e.IsEmpty(this.Parent.ScreenObject.GridData[e].DocExtraXML)||(o+=this.Parent.ScreenObject.GridData[e].DocExtraXML.toString());if(""!=o&&(o=o.replace("<DocExtraXML>","").replace("</DocExtraXML>",""),o="<DocExtraXML>"+o+"</DocExtraXML>",this.dsusedbins.ReadXml(o)),!n.e.IsEmpty(s.DocExtraXML)){let e=new n.f;e.LoadXml(s.DocExtraXML);let t=e.SelectNodes("DocExtraXML/Row");for(let s=0;s<t.length;s++){let e=this.GridDataObj.NewRow();null==t[s].attributes.RefID||n.e.IsEmpty(t[s].attributes.RefID.value)||(e.RefID=t[s].attributes.RefID.value,""!=a&&(a+=","),a+=t[s].attributes.RefID.value),null==t[s].attributes.Qty||n.e.IsEmpty(t[s].attributes.Qty.value)||(e.Qty=t[s].attributes.Qty.value),e.Type=1,this.GridDataObj.addRow(e)}}}if(this.Parent.ScreenObject.Preferences.ContainsKey("ShowBOE")&&"true"==this.Parent.ScreenObject.Preferences.ShowBOE.toLowerCase())null==s&&(s=this.Parent.SelectedRow),a=this.LoadBoes(a,s);else{let e="0";n.e.IsType(this.Parent,"AddEditDocumentViewModel")&&(null==s&&(s=this.Parent.SelectedRow),e=s.ProductID_Key.toString(),""==r&&(r=s.LinkedInvDocDetailsID.toString()));let t=this.Parent.ScreenObject.GetinvDetails("",a,e,"",r,this.SelectedRowEditing);if(null!=t&&t.Tables.length>0&&t.Tables[0].length>0)for(let s=0;s<t.Tables[0].length;s++){let e=0;this.dsusedbins.Tables.length>0&&this.dsusedbins.Tables[0].filter(e=>e.RefID==t.Tables[0][s].InvDocDetailsID).forEach(t=>{this.dsusedbins.Columns[0].Contains("Qty")&&!n.e.IsEmpty(t.Qty)&&(e+=parseFloat(t.Qty))});let i=this.GridData.filter(e=>e.RefID==t.Tables[0][s].InvDocDetailsID);i.length>0&&(n.e.IsEmpty(t.Tables[0][s].Qty)||(i[0].AvailQty=parseFloat(t.Tables[0][s].Qty)-e))}}this.FillBoeData(a);let h="2";var c=this.ColumnSource.find(e=>"Qty"==e.DisplayMember);null!=c&&(h=c.DecimalPoints);var d=this.GridData.Compute("sum","Qty");null!=d&&""!=d.toString()&&0!=parseFloat(d.toString())||(d=0),this.BOEAdjSummary="Qty. Adjusted  :  "+parseFloat(d.toString()).ToString("N"+h)+"  of  "+this.TextFields[2].Text+"  for the Product  :  "+this.TextFields[1].Text}}else if(3==this.QtyType){let e;if(null==this.Parent.DtPack&&(this.Parent.DtPack=[],this.Parent.DtPackColumns.push("ID"),this.Parent.DtPackColumns.push("Name"),this.Parent.DtPackColumns.push("Label"),this.Parent.DtPackColumns.push("cWeight"),this.Parent.DtPackColumns.push("cVolume"),this.Parent.DtPackColumns.push("Weight"),this.Parent.DtPackColumns.push("Volume"),this.Parent.DtPackColumns.push("Height"),this.Parent.DtPackColumns.push("length"),this.Parent.DtPackColumns.push("Width"),this.Parent.DtPackColumns.push("ActualWeight"),this.Parent.DtPackColumns.push("ActualVolume"),this.PackWise&&this.Parent.DtPackColumns.push("Data")),a.a.SessionManager.IsActionAssigned(43,"Customize Packing")&&(this.CustomizeVisible=!0),this.Title="Packing",!this.PackWise||this.IsSingleProd){e=new u.d,e.Label="Product",this.Parent.ScreenObject.GridDataObj.TableColumns.Contains("ProductName")?e.Text=this.Parent.SelectedRow.ProductName.toString():this.Parent.ScreenObject.GridDataObj.TableColumns.Contains("ProductCode")&&(e.Text=this.Parent.SelectedRow.ProductCode.toString()),e.Column="0",e.Row="0",this.TextFields.push(e),e=new u.d,e.Label="Qty",e.Text=this.Parent.SelectedRow.Quantity.toString(),e.Column="1",e.Row="0",this.TextFields.push(e);let t=this.Parent.ScreenObject.GetProdVWDetails(this.Parent.SelectedRow.ProductID_Key.toString());null!=t&&t.Tables.length>0&&t.Columns[0].Contains("Volume")&&t.Tables[0].length>0&&(n.e.IsEmpty(t.Tables[0][0].Volume)||(this.Vol=parseFloat(t.Tables[0][0].Volume)),n.e.IsEmpty(t.Tables[0][0].Weight)||(this.Wt=parseFloat(t.Tables[0][0].Weight)),this.Dims=t.Tables[0][0][t.Columns[0][0]].toString(),this.Dims.endsWith(",")&&(this.Dims=this.Dims.substr(0,this.Dims.length-1))),this.fillPack(this.Dims)}let t=new m.b;if(t.Label="Pack",t.Column=0,t.Row=1,t.CCID=parseInt(a.a.SessionManager.Preferences.PackDimension),t.TypeID=1,this.Dims.length>0&&(t.CustomWhere=" a.NodeID in("+this.Dims+")"),this.PackWise&&t.OnPactListBoxValueChanged.Subscribe(this,"onPackChanged"),this.Parent.ScreenObject.Preferences.ContainsKey("DefaultPack")&&!n.e.IsEmpty(this.Parent.ScreenObject.Preferences.DefaultPack)&&"0"!=this.Parent.ScreenObject.Preferences.DefaultPack&&(t.SelectedValue=parseInt(this.Parent.ScreenObject.Preferences.DefaultPack),t.DefaultValue=this.Parent.ScreenObject.Preferences.DefaultPack),this.TextFields.push(t),e=new u.d,e.Label="Label",e.Column="1",e.Row="1",this.PackWise&&e.TextChangedCommand.Subscribe(this,"LabelScan"),this.TextFields.push(e),this.Parent.ScreenObject.Preferences.ContainsKey("DefaultLabel")&&!n.e.IsEmpty(this.Parent.ScreenObject.Preferences.DefaultLabel)&&(e.Text=e.DefaultValue=this.Parent.ScreenObject.Preferences.DefaultLabel),this.PackWise&&!this.IsSingleProd){e=new u.d,e.Label="Weight",e.Column="2",e.Row="1",this.TextFields.push(e),e=new u.d,e.Label="Length",e.Column="0",e.Row="2",e.TextChangedCommand.Subscribe(this,"onTextChanged"),this.TextFields.push(e),e=new u.d,e.Label="Width",e.Column="1",e.Row="2",e.TextChangedCommand.Subscribe(this,"onTextChanged"),this.TextFields.push(e),e=new u.d,e.Label="Height",e.Column="2",e.Row="2",e.TextChangedCommand.Subscribe(this,"onTextChanged"),this.TextFields.push(e),e=new u.d,e.Label="Volume",e.Column="3",e.Row="1",this.TextFields.push(e);var b=this.ColumnSource.find(e=>"ActualVolume"==e.DisplayMember);b&&(e.IsReadOnly=b.ReadOnly,e.IsReadOnly&&(e.IsTabStop=!1),e.Visible=b.IsVisible),this.Parent.ScreenObject.Preferences.ContainsKey("PackMandScan")&&"true"==this.Parent.ScreenObject.Preferences.PackMandScan.toLowerCase()?(e=new u.d,e.Label="Scan Product",e.Column="0",e.Row="3",e.ColumnSpan="2",e.TextChangedCommand.Subscribe(this,"PackProductScan"),e.SetFocus=!0,this.TextFields.push(e)):(t=new m.b,t.Label="Product",t.Column=0,t.Row=3,t.ColumnSpan=2,t.CCID=3,t.TypeID=""!=this.Footerfld?parseInt(this.Footerfld):100,t.SelectionChangedCommand.Subscribe(this,"PackProductScan"),t.SelectedValue=-1,this.TextFields.push(t));let s=new p.a;s.Label="Qty",s.Column=2,s.Row=3,s.onGetData.Subscribe(this,"PackProductScan"),this.Parent.ScreenObject.Preferences.ContainsKey("PackMandScan")&&"true"==this.Parent.ScreenObject.Preferences.PackMandScan.toLowerCase()&&(s.Visible=!1),this.TextFields.push(s);let i=new D.e;i.Label="Option",i.Column=3,i.Row=2,i.SelectionChangedCommand.Subscribe(this,"SelectionChange"),i.Items.push(D.d.ComboBoxItems_2("Show Selected","1")),i.Items.push(D.d.ComboBoxItems_2("ShowAll","2")),i.Items.push(D.d.ComboBoxItems_2("To be Packed","3")),i.SelectedValue="1",this.TextFields.push(i);let r=new F.a;r.Columns=[],r.Width="",r.Height=200;let o=new y.a;o.Header="Code",o.DisplayMember="Code",o.ReadOnly=!0,o.Width=200,o.DisableTab=!0,r.Columns.push(o),o=new y.a,o.Header="Name",o.DisplayMember="Name",o.ReadOnly=!0,o.Width=200,o.DisableTab=!0,r.Columns.push(o),o=new y.a,o.Header="Qty",o.DisplayMember="Qty",o.ReadOnly=!0,o.DataType="FLOAT",o.Width=100,o.DisableTab=!0,r.Columns.push(o),o=new y.a,o.Header="Already",o.DisplayMember="Already",o.ReadOnly=!0,o.Width=100,o.DataType="FLOAT",o.DisableTab=!0,r.Columns.push(o),o=new y.a,o.Header="Packed",o.DisplayMember="Packed",o.Width=100,o.DataType="FLOAT",r.Columns.push(o),o=new y.a,o.Header="Bal",o.DisplayMember="Bal",o.ReadOnly=!0,o.Width=100,o.DataType="FLOAT",o.DisableTab=!0,r.Columns.push(o),r.Table=[],r.TableColumns.push("Code"),r.TableColumns.push("ProductID"),r.TableColumns.push("Name"),r.TableColumns.push("Qty"),r.TableColumns.push("Already"),r.TableColumns.push("Packed"),r.TableColumns.push("Bal"),r.TableColumns.push("Unq"),r.TableColumns.push("Volume"),r.TableColumns.push("Weight"),r.Column=0,r.Row=4,r.ColumnSpan=4,r.CellEditEnding.Subscribe(this,"OnGridCellEditEnding"),r.SearchVisible=!0,r.AddSearchCols(),this.TextFields.push(r),this.Parent.ScreenObject.GridDataColumns.Contains("Unq")||this.Parent.ScreenObject.GridDataColumns.push("Unq"),g=null!=(g=this.Parent.ScreenObject.GridData.Compute("max","Unq"))?parseInt(g)+1:0;let l="",c=null;if(this.Parent.ScreenObject.Preferences.ContainsKey("LineWisePacking")&&"true"==this.Parent.ScreenObject.Preferences.LineWisePacking.toLowerCase()){if(!this.Parent.ScreenObject.Preferences.ContainsKey("PackLabel")||""==this.Parent.ScreenObject.Preferences.PackLabel)return void(this.DisplayMessage="Define pack label field");if(c=this.Parent.ScreenObject.ColumnSource.find(e=>e.ID==this.Parent.ScreenObject.Preferences.PackLabel),!c)return void(this.DisplayMessage="Define pack label field linewise");if(l=c.DisplayMember,c=this.Parent.ScreenObject.ColumnSource.find(e=>e.CostCenterID==parseInt(a.a.SessionManager.Preferences.PackDimension)),!c)return void(this.DisplayMessage="Define Pack Dimension linewise")}let h="";for(let e=0;e<this.Parent.ScreenObject.GridData.length;e++)if(!n.e.IsEmpty(this.Parent.ScreenObject.GridData[e].ProductId_Key)&&"true"==this.Parent.ScreenObject.GridData[e].PackType.toString().toLowerCase()){let t=r.NewRow();if(t.ProductID=this.Parent.ScreenObject.GridData[e].ProductId_Key.toString(),this.Parent.ScreenObject.GridDataObj.TableColumns.Contains("ProductCode")&&(t.Code=this.Parent.ScreenObject.GridData[e].ProductCode.toString()),this.Parent.ScreenObject.GridDataObj.TableColumns.Contains("ProductName")&&(t.Name=this.Parent.ScreenObject.GridData[e].ProductName.toString()),t.Qty=this.Parent.ScreenObject.GridData[e].Quantity.toString(),t.Already=0,t.Packed=0,t.Bal=t.Qty,n.e.IsEmpty(this.Parent.ScreenObject.GridData[e].Unq)&&(this.Parent.ScreenObject.GridData[e].Unq=g,g=parseInt(g)+1),t.Unq=this.Parent.ScreenObject.GridData[e].Unq.toString(),""!=l&&!this.FillDtPack(this.Parent.ScreenObject.GridData[e],l,c,t))return void(this.DisplayMessage="check pack at row no:"+this.Parent.ScreenObject.GridData[e].DocSeqNo);r.addRow(t),""!=h&&(h+=","),h+=t.ProductID.toString()}if(3==t.CCID&&(t.CustomWhere=h.length>0?" a.ProductID in ("+h+")":" 1<>1 "),h.length>0){let e=this.Parent.ScreenObject.GetProdVWDetails(h);if(null!=e&&e.Tables.length>0&&e.Columns[0].Contains("Volume")&&e.Tables[0].length>0)for(let t=0;t<r.Table.length;t++){var C=e.Tables[0].filter(e=>e.ProductID==r.Table[t].ProductID);C.length>0&&(n.e.IsEmpty(C[0].Volume)||(r.Table[t].Volume=parseFloat(C[0].Volume)),n.e.IsEmpty(C[0].Weight)||(r.Table[t].Weight=parseFloat(C[0].Weight)))}}}else e=new u.d,e.Label="Qty",e.Column="2",e.Row="1",e.DataType="FLOAT",this.Parent.ScreenObject.Preferences.ContainsKey("PackQty")&&""!=this.Parent.ScreenObject.Preferences.PackQty&&null!=this.Parent.SelectedRow&&this.Parent.ScreenObject.GridDataColumns.Contains(this.Parent.ScreenObject.Preferences.PackQty)&&!n.e.IsEmpty(this.Parent.SelectedRow[this.Parent.ScreenObject.Preferences.PackQty])&&(e.Text=this.Parent.SelectedRow[this.Parent.ScreenObject.Preferences.PackQty].toString()),this.TextFields.push(e);let s,i=new h.a;var g;if(this.PackWise&&!this.IsSingleProd?(i.Enable=!0,i.Row=5,i.Column=3,i.Visible=!1,i.Label="Add Pack"):(this.Parent.ScreenObject.Preferences.ContainsKey("PackQty")&&""!=this.Parent.ScreenObject.Preferences.PackQty&&null!=this.Parent.SelectedRow&&this.Parent.ScreenObject.GridDataColumns.Contains(this.Parent.ScreenObject.Preferences.PackQty)&&(i.Label="Pack All Products",i.Visible=!1,i.Enable=!0,i.Row=1,i.Column=3,i.ClickCommand.Subscribe(this,"OnAddmultipleProd"),this.TextFields.push(i),i=new h.a),i.Label="Add",i.Visible=!0,i.Enable=!1,i.Row=1,i.Column=3),i.ClickCommand.Subscribe(this,"OnAdd"),this.TextFields.push(i),s=this.Dims.length>0?this.Parent.DtPack.filter(e=>this.Dims.split(",").Contains(e.ID)):this.Parent.DtPack,s.forEach(e=>{let t=this.GridDataObj.NewRow();if(t.RefID=e.ID,t.Name=e.Name,t.Label=e.Label,t.UsedWeight=e.cWeight,t.UsedVolume=e.cVolume,t.cWeight=e.cWeight,t.cVolume=e.cVolume,t.Weight=e.Weight,t.Volume=e.Volume,t.Type=2,t.Height=e.Height,t.length=e.length,t.Width=e.Width,this.PackWise&&(t.Data=e.Data,t.ActualWeight=e.ActualWeight,t.ActualVolume=e.ActualVolume,!this.IsSingleProd)){let e=t.Data.toString().split(",");for(let t=0;t<e.length;t++){let s=e[t].split("~"),i=this.TextFields[10].Table.filter(e=>e.Unq==s[0]);if(i.length>0){let e=n.e.DoubleTryParse(i[0].Qty);i[0].Already=n.e.IsEmpty(i[0].Already)?s[1]:parseFloat(i[0].Already)+parseFloat(s[1]),e-=parseFloat(i[0].Already),i[0].Bal=e}}}this.GridDataObj.addRow(t)}),this.PackWise&&this.IsSingleProd&&(this.Parent.ScreenObject.GridDataColumns.Contains("Unq")||this.Parent.ScreenObject.GridDataColumns.push("Unq"),n.e.IsEmpty(this.Parent.SelectedRow.Unq)&&(g=null!=(g=this.Parent.ScreenObject.GridData.Compute("max","Unq"))?parseInt(g)+1:0,this.Parent.SelectedRow.Unq=g)),(!this.PackWise||this.IsSingleProd)&&!n.e.IsEmpty(this.Parent.SelectedRow.PackXML)){let e=new n.f;e.LoadXml(this.Parent.SelectedRow.PackXML);let t=e.SelectNodes("DocExtraXML/Row");for(let s=0;s<t.length;s++)if(null!=t[s].attributes.Label&&!n.e.IsEmpty(t[s].attributes.Label.value)&&null!=t[s].attributes.RefID&&!n.e.IsEmpty(t[s].attributes.RefID.value)){let e=this.GridData.filter(e=>e.RefID==t[s].attributes.RefID.value&&e.Label==t[s].attributes.Label.value);if(e.length>0&&null!=t[s].attributes.Qty&&!n.e.IsEmpty(t[s].attributes.Qty.value)){let i=0;e[0].Qty=t[s].attributes.Qty.value,null==t[s].attributes.Fld1||n.e.IsEmpty(t[s].attributes.Fld1.value)||""==t[s].attributes.Fld1.value||(e[0].length=t[s].attributes.Fld1.value),null==t[s].attributes.Fld2||n.e.IsEmpty(t[s].attributes.Fld2.value)||""==t[s].attributes.Fld2.value||(e[0].Width=t[s].attributes.Fld2.value),null==t[s].attributes.Fld3||n.e.IsEmpty(t[s].attributes.Fld3.value)||""==t[s].attributes.Fld3.value||(e[0].Height=t[s].attributes.Fld3.value),null==t[s].attributes.Fld4||n.e.IsEmpty(t[s].attributes.Fld4.value)||""==t[s].attributes.Fld4.value||(e[0].ActualWeight=t[s].attributes.Fld4.value),null==t[s].attributes.Fld5||n.e.IsEmpty(t[s].attributes.Fld5.value)||""==t[s].attributes.Fld5.value||(e[0].ActualVolume=t[s].attributes.Fld5.value),e[0].pWeight=i=parseFloat(e[0].Qty)*this.Wt,n.e.IsEmpty(e[0].UsedWeight)||(e[0].UsedWeight=parseFloat(e[0].UsedWeight)-i),e[0].pVolume=i=parseFloat(e[0].Qty)*this.Vol,n.e.IsEmpty(e[0].UsedVolume)||(e[0].UsedVolume=parseFloat(e[0].UsedVolume)-i)}}}}else if(4==this.QtyType){this.Title="Quality  Check";let e=new u.d;e.Label="Product",this.Parent.ScreenObject.GridDataObj.TableColumns.Contains("ProductName")?e.Text=this.Parent.SelectedRow.ProductName.toString():this.Parent.ScreenObject.GridDataObj.TableColumns.Contains("ProductCode")&&(e.Text=this.Parent.SelectedRow.ProductCode.toString()),e.Column=0,e.Row=0,this.TextFields.push(e),e=new u.d,e.Label="Observations",e.Column=1,e.Row=0,e.DBColumnName="SKU",e.TextChangedCommand.Subscribe(this,"OnIterationChanged"),this.TextFields.push(e);var O=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&55854==e.LinkData);if(O.length>0&&this.Parent.ScreenObject.GridDataColumns.Contains(O[0].SysColumnName.toString())){let e=new D.h;e.Label="Status",e.Column=2,e.Row=0,e.DBColumnName=O[0].SysColumnName.toString(),e.Items.push(D.d.ComboBoxItems_2("Not Tested","Not Tested")),e.Items.push(D.d.ComboBoxItems_2("Partial","Partial")),e.Items.push(D.d.ComboBoxItems_2("Failed","Failed")),e.Items.push(D.d.ComboBoxItems_2("Passed","Passed"));let t=this.Parent.SelectedRow[O[0].SysColumnName.toString()].toString();"Not Tested"!=t&&"Partial"!=t&&"Failed"!=t&&"Passed"!=t&&e.Items.push(D.d.ComboBoxItems_2(t,t)),e.SelectedValue=t,this.TextFields.push(e)}let t=new n.f;n.e.IsEmpty(this.Parent.SelectedRow.TestCaseXML)||t.ReadXml(this.Parent.SelectedRow.TestCaseXML);let s=0;if(t.Tables.length>0){let e;for(let i=0;i<t.Columns[0].length;i++)t.Columns[0][i].Contains("Fld")&&(e=n.e.IntTryParse(t.Columns[0][i].replace("Fld","")),e>s&&(s=e))}let i=this.Parent.ScreenObject.GetProdTestCaseDetails(this.Parent.SelectedRow.ProductID_Key.toString());if(null!=i&&i.Tables.length>0&&i.Columns[0].Contains("TestCaseID")&&i.Tables[0].length>0){var I=i.Tables[0].Compute("max","Iteration");null!=I&&parseFloat(I)>s&&(s=parseFloat(I)),0==s&&(s=1),this.TextFields[1].Text=s.toString(),this.OnIterationChanged(null,null);let e=1;n.e.IsEmpty(this.Parent.SelectedRow.Quantity)||(e=parseFloat(this.Parent.SelectedRow.Quantity));let r=0,o=0;for(let l=0;l<i.Tables[0].length;l++){let c,h=i.Tables[0].filter(e=>e.TestCaseID==i.Tables[0][l].ParentID);c=h.length>0?h[0]:i.Tables[0][l],"1"==c.SampleType.toString()?(o=1,r=n.e.DoubleTryParse(c.sample),r>1&&e<r&&(r=e)):"3"==c.SampleType.toString()?(o=1,r=n.e.DoubleTryParse(c.sample),r>1&&(r=e*r/100)):(r=1,o=n.e.DoubleTryParse(c.sample),"2"==c.SampleType.toString()&&(o=e*o/100));for(let e=0;e<r;e++){let r=this.GridDataObj.NewRow();if(r.RefID=i.Tables[0][l].TestCaseID.toString(),r.Name="false"==i.Tables[0][l].IsGroup.toString().toLowerCase()?"  "+i.Tables[0][l].Name.toString():i.Tables[0][l].Name.toString(),r.Min=c.Min.toString(),r.Max=c.Max.toString(),r.TestType=c.TestType.toString(),r.ProbableValues=c.ProbableValues.toString(),!n.e.IsEmpty(c.ProbableValues)&&c.ProbableValues.toString().split(";").length>1&&(r.MultiColTYPE="COMBOBOX"),r.Variance=c.Variance.toString(),r.SampleType=c.SampleType.toString(),r.Sample=c.sample.toString(),r.Retest=c.RetestDays.toString(),r.Samplesize=o,r.SampleNo=e+1,r.Unit_Key=this.Parent.SelectedRow.Unit_Key.toString(),t.Tables.length>0){let i=t.Tables[0].filter(t=>t.RefID==r.RefID&&t.Qty==e+1);if(i.length>0){a.a.SessionManager.Preferences.ContainsKey("QCLabNameDimension")&&""!=a.a.SessionManager.Preferences.QCLabNameDimension.toString()&&0!=parseInt(a.a.SessionManager.Preferences.QCLabNameDimension)&&(t.Columns[0].Contains("LabID")&&(r.LabName_Key=i[0].LabID),t.Columns[0].Contains("ReportNo")&&(r.ReportNo=i[0].ReportNo),t.Columns[0].Contains("ReportDate")&&(n.e.IsEmpty(i[0].ReportDate)||(r.ReportDate_Key=new Date(i[0].ReportDate).ToString("dd MMM yyyy"),r.ReportDate=new Date(i[0].ReportDate).ToString(a.a.SessionManager.Preferences["Date Format"])))),t.Columns[0].Contains("Unit")&&(r.Unit_Key=i[0].Unit),t.Columns[0].Contains("Remarks")&&(r.Remarks=i[0].Remarks);for(let e=0;e<s;e++)t.Columns[0].Contains("Fld"+(e+1))&&(r["Result"+(e+1)]=i[0]["Fld"+(e+1)])}}this.GridDataObj.addRow(r)}}this.GridDataObj.RefreshGrid=!0,this.GridDataObj.UpdateFooter()}else this.Parent.res="NO"}else if(8==this.QtyType){let e=new u.d;e.Label="Scan",e.Column=0,e.Row=0,e.ColumnSpan=2,e.DBColumnName="SKU",e.isSKU=!0,e.TextChangedCommand.Subscribe(this,"Scan"),e.SetFocus=!0,this.TextFields.push(e)}}get BOEAdjustFIFO(){return this.BOEAdjustFIFOObj.IsChecked}get GridData(){return this.GridDataObj.Table}set SetColSize(e){}get ColumnSource(){return this.GridDataObj.Columns}set ColumnSource(e){this.GridDataObj.Columns=e}set SetFocusongrid(e){}set UpdateFooter(e){}set RefreshGrid(e){}get SelectedRow(){return this.GridDataObj.SelectedItem}set SelectedRow(e){this.GridDataObj.SelectedItem=e}OnBOEAdjustFIFOCheckedChanged(){if(this.GridData.length>0)for(let i=0;i<this.GridData.length;i++)null!=this.GridData[i].AvailQty&&null!=this.GridData[i].AvailQty&&""!=this.GridData[i].AvailQty.toString()&&parseFloat(this.GridData[i].AvailQty.toString())>0&&(this.GridData[i].Qty="0");if(this.BOEAdjustFIFO&&this.GridData.length>0){let e=parseFloat(this.TextFields[2].Text);for(let t=0;t<this.GridData.length&&(e>0&&!n.e.IsEmpty(this.GridData[t].AvailQty)&&parseFloat(this.GridData[t].AvailQty.toString())>0&&(this.GridData[t].Qty=parseFloat(this.GridData[t].AvailQty)>=e?e:parseFloat(this.GridData[t].AvailQty),e-=parseFloat(this.GridData[t].Qty)),this.GridDataObj.updateRow(this.GridData[t]),0!=e);t++);}let e="2";var t=this.ColumnSource.find(e=>"Qty"==e.DisplayMember);null!=t&&(e=t.DecimalPoints);var s=this.GridData.Compute("sum","Qty");null!=s&&""!=s.toString()&&0!=parseFloat(s.toString())||(s=0),this.BOEAdjSummary="Qty. Adjusted  :  "+parseFloat(s.toString()).ToString("N"+e)+"  of  "+this.TextFields[2].Text+"  for the Product  :  "+this.TextFields[1].Text}getQty(e){if(this.Parent.ScreenObject.Preferences.ContainsKey("ClubBoe")&&"True"==this.Parent.ScreenObject.Preferences.ClubBoe&&!this.SelectedRowEditing){let e=0;return this.Parent.ScreenObject.GridData.filter(e=>0==e.DocDetailsID&&e.ProductID_Key==this.Parent.SelectedRow.ProductID_Key).forEach(t=>{n.e.IsEmpty(t.Quantity)||(e+=parseFloat(t.Quantity))}),e.toString()}return null!=e?e.Quantity.toString():this.Parent.SelectedRow.Quantity.toString()}FillBoeData(e){if(n.e.IsEmpty(e)||n.e.IsEmpty(this.Query))return;let t=this.Parent.ScreenObject.GetinvDetails(this.Query,e,"","","",this.SelectedRowEditing);if(null!=t&&t.Tables.length>0&&t.Columns[0].Contains("InvDocDetailsID")&&t.Tables[0].length>0){for(let e=4;e<this.ColumnSource.length;e++)t.Columns[0].Contains(this.ColumnSource[e].DisplayMember+"_ID")&&!this.GridDataObj.TableColumns.Contains(this.ColumnSource[e].DisplayMember+"_ID")&&this.GridDataObj.TableColumns.push(this.ColumnSource[e].DisplayMember+"_ID");for(let e=0;e<this.GridData.length;e++){let s=t.Tables[0].filter(t=>t.InvDocDetailsID==this.GridData[e].RefID);if(s.length>0)for(let i=4;i<this.ColumnSource.length;i++)this.GridData[e][this.ColumnSource[i].DisplayMember]=s[0][this.ColumnSource[i].DisplayMember].toString(),t.Columns[0].Contains(this.ColumnSource[i].DisplayMember+"_ID")&&!n.e.IsEmpty(s[0][this.ColumnSource[i].DisplayMember+"_ID"])&&(this.GridData[e][this.ColumnSource[i].DisplayMember+"_ID"]=s[0][this.ColumnSource[i].DisplayMember+"_ID"].toString()),this.GridDataObj.updateRow(this.GridData[e])}}}LoadBoes(e,t){let s=this.Parent.ScreenObject.GetinvDetails("","",t.ProductID_Key.toString(),"",t.LinkedInvDocDetailsID.toString(),this.SelectedRowEditing,!0),i=new Array;for(let a=0;a<this.GridData.length;a++)n.e.IsEmpty(this.GridData[a].RefID)||i.push(this.GridData[a].RefID.toString());if(null!=s&&s.Tables.length>0&&s.Columns[0].Contains("InvDocDetailsID")&&s.Tables[0].length>0)for(let a=0;a<s.Tables[0].length;a++){let t=0;if(this.dsusedbins.Tables.length>0&&this.dsusedbins.Tables[0].filter(e=>e.RefID==s.Tables[0][a].InvDocDetailsID).forEach(e=>{this.dsusedbins.Columns[0].Contains("Qty")&&!n.e.IsEmpty(e.Qty)&&(t+=parseFloat(e.Qty))}),this.GridData.filter(e=>e.RefID==s.Tables[0][a].InvDocDetailsID).length>0){let e=this.GridData.filter(e=>e.RefID==s.Tables[0][a].InvDocDetailsID.toString());e.length>0&&(n.e.IsEmpty(s.Tables[0][a].Qty)||(e[0].AvailQty=parseFloat(s.Tables[0][a].Qty)-t))}else{let i=this.GridDataObj.NewRow();i.RefID=s.Tables[0][a].InvDocDetailsID.toString(),""!=e&&(e+=","),e+=i.RefID.toString(),n.e.IsEmpty(s.Tables[0][a].Qty)||(i.AvailQty=parseFloat(s.Tables[0][a].Qty)-t),i.Type=1,this.GridDataObj.addRow(i)}}return e}onTextChanged(e){let t=0,s=0,i=0;t=n.e.DoubleTryParse(this.TextFields[3].Text),s=n.e.DoubleTryParse(this.TextFields[4].Text),i=n.e.DoubleTryParse(this.TextFields[5].Text),this.TextFields[6].Text=(t*s*i).toString()}onPackChanged(e){if(this.TextFields[0]instanceof m.b&&this.TextFields[0].SelectedValue>0&&this.PackWise&&!this.IsSingleProd&&null==this.drEdit){let e=this.Parent.ScreenObject.GetPackDetails(this.TextFields[0].SelectedValue.toString());null!=e&&e.Tables.length>0&&e.Columns[0].Contains("Name")&&e.Tables[0].length>0&&(this.TextFields[6].Text=e.Tables[0][0].Volume.toString(),this.TextFields[2].Text=e.Tables[0][0].Weight.toString(),this.TextFields[3].Text=e.Tables[0][0].length.toString(),this.TextFields[4].Text=e.Tables[0][0].Width.toString(),this.TextFields[5].Text=e.Tables[0][0].Height.toString())}}FillDtPack(e,t,s,i){let a;if(!n.e.IsEmpty(e[t])&&!n.e.IsEmpty(e[s.ValueMember])&&""==n.e.String(e.PackXML)){let n=this.GridData.filter(s=>s.Label==e[t].toString());if(n.length>0){if(a=n[0],a.RefID.toString()!=e[s.ValueMember].toString()&&!confirm("Same label is assigned to diffrent pack.\n Do you want to override pack?"))return!1;a.Data=a.Data.toString()+","+e.Unq.toString()+"~"+e.Quantity.toString()}else{a=this.GridDataObj.NewRow(),a.RefID=e[s.ValueMember].toString(),a.Type=2,a.Label=e[t].toString(),a.Name=e[s.DisplayMember].toString();let i=this.Parent.ScreenObject.GetPackDetails(a.RefID.toString());null!=i&&i.Tables.length>0&&i.Columns[0].Contains("Name")&&i.Tables[0].length>0&&(a.Name=i.Tables[0][0].Name,a.Volume=i.Tables[0][0].Volume,a.Weight=i.Tables[0][0].Weight,a.length=i.Tables[0][0].length,a.Width=i.Tables[0][0].width,a.Height=i.Tables[0][0].height),this.GridDataObj.addRow(a),a.Data=e.Unq.toString()+"~"+e.Quantity.toString()}i.Already=e.Quantity,i.Bal=0}return!0}OnGridCellEditEnding(e,t,s){if("Packed"==t){let t=0;if(n.e.IsEmpty(e.Qty)||(t=parseFloat(e.Qty)),n.e.IsEmpty(e.Already)||(t-=parseFloat(e.Already)),n.e.IsEmpty(e.Packed)||(t-=parseFloat(e.Packed)),t<0){if(!confirm("Qty grater than Document Qty, Do you want to Continue?"))return void(e.Packed=0);n.e.IsEmpty(e.Packed)||(e.Packed=parseFloat(e.Packed)+t),t=0}e.Bal=t,this.GridDataObj.updateRow(e)}}fillPack(e){try{let e="";for(let t=0;t<this.Parent.ScreenObject.GridData.length;t++)n.e.IsEmpty(this.Parent.ScreenObject.GridData[t].ProductID_Key)||"true"!=this.Parent.ScreenObject.GridData[t].PackType.toString().toLowerCase()||n.e.IsEmpty(this.Parent.ScreenObject.GridData[t].PackXML)||(e+=this.Parent.ScreenObject.GridData[t].PackXML.toString().replace("<DocExtraXML>","").replace("</DocExtraXML>",""));""!=e&&(new n.f).ReadXml("<xml>"+e+"</xml>")}catch(t){Logger.ErrorLog("FieldCalculatorViewModel","fillPack","fillPack",t)}}OnAddPack(e){if(n.e.IsEmpty(this.TextFields[1].Text))return void(this.DisplayMessage="Enter Label");if(!(this.TextFields[0].SelectedValue>0))return void(this.DisplayMessage="Select Pack");let t=this.TextFields[10].Table,s="";for(let r=0;r<t.length;r++)n.e.Double(t[r].Packed)>0&&(""!=s&&(s+=","),s+=t[r].Unq.toString()+"~"+t[r].Packed.toString());let i=null,a=this.GridData.filter(e=>e.Label==this.TextFields[1].Text);if(a.length>0){if(null==this.drEdit)return void(this.DisplayMessage="Duplicate Label Name");if(this.drEdit!=a[0])return void(this.DisplayMessage="Re load Pack.");if(""==s)return confirm("Do you want to delete?")?void this.DeletePack(a[0],t):void 0;if(!confirm("Do you want to override?"))return;i=a[0]}if(null!=this.drEdit&&0==a.length){if(""==s)return confirm("Do you want to delete?")?void this.DeletePack(this.drEdit,t):void 0;if(!confirm("Do you want to override?"))return;i=this.drEdit}s="";for(let r=0;r<t.length;r++)if(!n.e.IsEmpty(t[r].Packed)){""!=s&&(s+=","),s+=t[r].Unq.toString()+"~"+t[r].Packed.toString();let e=0;n.e.IsEmpty(t[r].Qty)||(e=parseFloat(t[r].Qty)),n.e.IsEmpty(t[r].Already)?e-=parseFloat(t[r].Packed):(e-=parseFloat(t[r].Packed),e-=parseFloat(t[r].Already),t[r].Already=parseFloat(t[r].Already)+parseFloat(t[r].Packed)),t[r].Bal=e,t[r].Packed=null}if(null==i){if(""==s)return void(this.DisplayMessage="select products to add pack.");i=this.GridDataObj.NewRow(),this.GridDataObj.addRow(i)}i.Data=s,i.RefID=this.TextFields[0].SelectedValue.toString(),i.Type=2,i.Name=this.TextFields[0].Text,i.ActualVolume=this.TextFields[6].Text,i.ActualWeight=this.TextFields[2].Text,i.length=this.TextFields[3].Text,i.Width=this.TextFields[4].Text,i.Height=this.TextFields[5].Text,i.Label=this.TextFields[1].Text,this.TextFields[6].Text="",this.TextFields[2].Text="",this.TextFields[3].Text="",this.TextFields[4].Text="",this.TextFields[5].Text="",this.TextFields[0].SelectedValue=n.e.IsEmpty(this.TextFields[0].DefaultValue)?0:parseInt(this.TextFields[0].DefaultValue),this.AutoIncreamentLabel(1),this.drEdit=null,this.TextFields[11].Label="Add Pack"}DeletePack(e,t){this.GridDataObj.removeRow(e);for(let s=0;s<t.length;s++)if(!n.e.IsEmpty(t[s].Packed)){let e=0;n.e.IsEmpty(t[s].Qty)||(e=parseFloat(t[s].Qty)),n.e.IsEmpty(t[s].Already)?e-=parseFloat(t[s].Packed):(e-=parseFloat(t[s].Packed),e-=parseFloat(t[s].Already),t[s].Already=parseFloat(t[s].Already)+parseFloat(t[s].Packed)),t[s].Bal=e,t[s].Packed=null}}OnAddmultipleProd(e){this.Parent.DtPack.Rows.Clear();for(let s=0;s<this.Parent.ScreenObject.GridData.length;s++)n.e.IsEmpty(this.Parent.ScreenObject.GridData[s].ProductID_Key)||"true"!=this.Parent.ScreenObject.GridData[s].PackType.toString().toLowerCase()||(this.Parent.ScreenObject.GridData[s].PackXML=null);let t=0;for(let s=0;s<this.Parent.ScreenObject.GridData.length;s++)if(!n.e.IsEmpty(this.Parent.ScreenObject.GridData[s].ProductID_Key)&&"true"==this.Parent.ScreenObject.GridData[s].PackType.toString().toLowerCase()){t++,this.Parent.Setselectedrow(s);let e=new le(this.Parent,3);t>1&&e.AutoIncreamentLabel(3),e.OnAddmultiple(null),e.OnButtonClick("AutoResave")}a.a.page.HideDialog()}OnAddmultiple(e){let t=0,s=0,i=0;t=parseFloat(this.Parent.SelectedRow.Quantity),n.e.IsEmpty(this.TextFields[4].Text)&&(this.TextFields[4].Text="1"),n.e.IsEmpty(this.TextFields[4].Text)||""!=this.TextFields[4].ValidateData()||(i=parseFloat(this.TextFields[4].Text));let a=t;i>0&&(a=Math.floor(t/i));for(let n=0;n<a+1;n++){s=0;var r=this.GridData.Compute("sum","Qty");s=null!=r?t-parseFloat(r):t,s>0&&(s<i&&(this.TextFields[4].Text=s.toString()),this.OnAdd(null))}}OnAdd(e){if(this.PackWise&&!this.IsSingleProd)return void this.OnAddPack(null);if(n.e.IsEmpty(this.TextFields[3].Text))return void(this.DisplayMessage="Enter Label");let t=this.Parent.DtPack.filter(e=>e.Label==this.TextFields[3].Text);if(t.length>0)this.DisplayMessage="Duplicate Label Name";else if(t=this.GridData.filter(e=>e.Label==this.TextFields[3].Text),t.length>0)this.DisplayMessage="Duplicate Label Name";else if(this.TextFields[2].SelectedValue>0){let e=this.GridDataObj.NewRow();if(e.Label=this.TextFields[3].Text,t=this.Parent.DtPack.filter(e=>e.ID==this.TextFields[2].SelectedValue),t.length>0)e.RefID=this.TextFields[2].SelectedValue.toString(),e.Type=2,e.Name=t[0].Name,e.Volume=t[0].Volume,e.Weight=t[0].Weight,e.length=t[0].length,e.Width=t[0].width,e.Height=t[0].Height;else{let t=this.Parent.ScreenObject.GetPackDetails(this.TextFields[2].SelectedValue.toString());null!=t&&t.Tables.length>0&&t.Columns[0].Contains("Name")&&t.Tables[0].length>0&&(e.RefID=this.TextFields[2].SelectedValue.toString(),e.Type=2,e.Name=t.Tables[0][0].Name,e.Volume=t.Tables[0][0].Volume,e.Weight=t.Tables[0][0].Weight,e.length=t.Tables[0][0].length,e.Width=t.Tables[0][0].width,e.Height=t.Tables[0][0].height)}n.e.IsEmpty(this.TextFields[4].Text)||""!=this.TextFields[4].ValidateData()||(e.Qty=this.TextFields[4].Text),this.GridDataObj.addRow(e),this.AutoIncreamentLabel(3),n.e.IsEmpty(this.TextFields[2].DefaultValue)||(this.TextFields[2].SelectedValue=parseInt(this.TextFields[2].DefaultValue))}else this.DisplayMessage="Select Pack"}AutoIncreamentLabel(e){if(n.e.IsEmpty(this.TextFields[e].DefaultValue))this.TextFields[e].Text="";else{let t,s=this.TextFields[e].DefaultValue,i=1,a=!1;if(null!=s&&""!=s.Trim())for(let e=0;e<s.length;e++)if(!n.e.IsDigit(s[s.length-e-1])){if(e<=15&&(a=!0,e>0)){t=s.substr(s.length-e);for(let s=0;s<t.length&&"0"==t[s];s++)e--;i=parseInt(s.substr(s.length-e)),s=s.substr(0,s.length-e)}break}if(!a&&null!=s&&""!=s.Trim()){let e=s.length;e>15?(e=15,t=s.substr(s.length-e)):t=s;for(let s=0;s<t.length&&"0"==t[s];s++)e--;i=parseInt(s.substr(s.length-e)),s=s.substr(0,s.length-e)}null!=s&&""!=s.Trim()||(s="");for(let e=0;e<this.GridData.length;e++)n.e.IsEmpty(this.GridData[e].Label)||(""!=s&&this.GridData[e].Label.toString().startsWith(s)&&n.e.DoubleTryParse(this.GridData[e].Label.toString().Remove(0,s.length))>i?i=n.e.DoubleTryParse(this.GridData[e].Label.toString().Remove(0,s.length)):""==s&&n.e.IntTryParse(this.GridData[e].Label)>i&&(i=n.e.IntTryParse(this.GridData[e].Label)));this.TextFields[e].Text=s+(i+1)}}OnIterationChanged(e,t){if(null==t||"13"==t.keyCode){if(n.e.IsNum(this.TextFields[1].Text))return this.DisplayMessage="Enter valid iteration",void(this.MessageVisibility=!0);{let e=11;a.a.SessionManager.Preferences.ContainsKey("QCLabNameDimension")&&!n.e.IsEmpty(a.a.SessionManager.Preferences.QCLabNameDimension)&&0!=parseInt(a.a.SessionManager.Preferences.QCLabNameDimension)&&(e=14);let t=n.e.Double(this.TextFields[1].Text);if(t>10&&(t=10),this.ColumnSource.length>t+e){let s=[];t+=e;for(let e=0;e<t;e++)s.push(this.ColumnSource[e]);for(let e=0;e<this.GridDataObj.TableColumns.length;e++)this.GridDataObj.TableColumns[e].Contains("Result")&&(s.find(t=>t.DisplayMember==this.GridDataObj.TableColumns[e])||(this.GridDataObj.TableColumns.RemoveAt(e),e--));this.ColumnSource=s}else if(this.ColumnSource.length<t+e){let s=[];t=t+e-this.ColumnSource.length;let i=this.ColumnSource.length-e;i++;for(let e=0;e<this.ColumnSource.length;e++)s.push(this.ColumnSource[e]);for(let e=0;e<t;e++,i++){let e=new y.a;e.Header="Result "+i,e.DisplayMember="Result"+i,e.DataType="MULTI_TYPE",e.Width=100,s.push(e),this.GridDataObj.TableColumns.push("Result"+i)}this.ColumnSource=s}}}}SelectionChange(e){}LabelScan(e,t){this.TextFields.length>1&&null!=this.TextFields[1]&&!n.e.IsEmpty(this.TextFields[1].Text)&&"13"==t.keyCode&&this.EditPack(!0)}EditPack(e){let t=this.GridData.filter(e=>e.Label==this.TextFields[1].Text);if(t.length>0){if(e&&!confirm("Do you want to Edit "+this.TextFields[1].Text+" pack?"))return;let s=this.TextFields[10].Table,i=null;if(null!=this.drEdit){i=this.drEdit.Data.toString().split(",");for(let e=0;e<i.length;e++){let t=i[e].split("~"),a=s.filter(e=>e.Unq==t[0]);if(a.length>0){a[0].Already=n.e.IsEmpty(a[0].Already)?t[1]:parseFloat(a[0].Already)+parseFloat(t[1]),a[0].Packed=0;let e=0;n.e.IsEmpty(a[0].Qty)||(e=parseFloat(a[0].Qty)),n.e.IsEmpty(a[0].Already)||(e-=parseFloat(a[0].Already)),a[0].Bal=e}}}this.drEdit=t[0],this.TextFields[11].Label="Save Changes",this.TextFields[0].SelectedValue=parseInt(t[0].RefID),this.TextFields[6].Text=t[0].ActualVolume.toString(),this.TextFields[2].Text=t[0].ActualWeight.toString(),this.TextFields[3].Text=t[0].length.toString(),this.TextFields[4].Text=t[0].Width.toString(),this.TextFields[5].Text=t[0].Height.toString(),i=t[0].Data.toString().split(",");for(let e=0;e<i.length;e++){let t=i[e].split("~"),a=s.filter(e=>e.Unq==t[0]);if(a.length>0){a[0].Packed=t[1];let e=0;n.e.IsEmpty(a[0].Qty)||(e=parseFloat(a[0].Qty)),n.e.IsEmpty(a[0].Already)||(a[0].Already=parseFloat(a[0].Already)-parseFloat(a[0].Packed),e-=parseFloat(a[0].Packed),e-=parseFloat(a[0].Already)),a[0].Bal=e}}}}PackProductScan(e,t){if(this.TextFields.length>7&&null!=this.TextFields[7]&&this.TextFields[7]instanceof u.d&&"13"==t.keyCode)this.PackScan();else if(this.TextFields.length>7&&null!=this.TextFields[7]&&this.TextFields[7]instanceof m.b&&this.TextFields[7].SelectedValue>0&&(null==t||"13"==t.keyCode)&&this.TextFields.length>10&&this.TextFields[10]instanceof F.a){let e=this.TextFields[10].Table.filter(e=>e.ProductID==this.TextFields[7].SelectedValue);if(e.length>0){let t=1;n.e.IsEmpty(this.TextFields[8].TextBox.Text)||(t=n.e.DoubleTryParse(this.TextFields[8].TextBox.Text)),e[0].Packed=n.e.IsEmpty(e[0].Packed)?t:parseFloat(e[0].Packed)+t,this.OnGridCellEditEnding(e[0],"Packed",0)}}}PackScan(){var e=this.Parent.ScreenObject.ColumnSource.find(e=>null!=e.DisplayMember&&"ProductCode"==e.DisplayMember);if(e&&e.UseBarcode){let t={PID:0};if(this.Parent.ReadBarcode(e.BarcodeDef,e.BarcodeProp,null,null,this.TextFields[7].Text,t)&&this.TextFields.length>10&&this.TextFields[10]instanceof F.a){let e=this.TextFields[10].Table.filter(e=>e.ProductID=t.PID);if(e.length>0){let t=1;n.e.IsEmpty(this.TextFields[8].TextBox.Text)||(t=n.e.DoubleTryParse(this.TextFields[8].TextBox.Text)),e[0].Packed=n.e.IsEmpty(e[0].Packed)?1:parseFloat(e[0].Packed)+1,this.OnGridCellEditEnding(e[0],"Packed",0),this.TextFields[7].Text=""}}}}Scan(e,t){this.TextFields.length>0&&null!=this.TextFields[0]&&!n.e.IsEmpty(this.TextFields[0].Text)&&"13"==t.keyCode&&this.MainScan()}MainScan(){if(this.DisplayMessage="",2==this.QtyType){var e=this.GridData.Compute("sum","Qty");if(null!=e&&null!=e&&parseFloat(e)>=parseFloat(this.TextFields[2].Text))return void(this.DisplayMessage="Quantity already adjusted")}let t=1,s=this.TextFields[0].Text;var i=this.Parent.ScreenObject.ColumnSource.find(e=>null!=e.DisplayMember&&"ProductCode"==e.DisplayMember);if(""!=i.BarcodeDef){let e=this.TextFields[0].Text,a=new n.f;if(""!=i.BarcodeProp){a.LoadXml(i.BarcodeProp);let t=a.SelectSingleNode("BarCodeBody/IsFixedBarcodeLength");if(null!=t&&"true"==a.getNodeData(t).toLowerCase()){let s=a.getNodeData(t);if(t=a.SelectSingleNode("BarCodeBody/FixedBarcodeChar"),null!=t&&""!=s.Trim()){let i=s[0];if(t=a.SelectSingleNode("BarCodeBody/IsFixedBarcodePrefix"),null!=t&&"true"==s.Trim())for(let t=0;t<e.length&&e[t]==i;t++)e=e.Remove(0,1),t--;else for(let t=e.length-1;t>=0&&e[t]==i;t--)e=e.Remove(e.length-1,1)}}if(t=a.SelectSingleNode("BarCodeBody/IsExclude"),null!=t&&"true"==a.getNodeData(t).toLowerCase()){let s;t=a.SelectSingleNode("BarCodeBody/ExcludeChar");let i=a.getNodeData(t);if(null!=t&&""!=i.Trim()?s=i[0]:(t=a.SelectSingleNode("BarCodeBody/FixedBarcodeChar"),s=null!=t&&""!=i.Trim()?i[0]:" "),t=a.SelectSingleNode("BarCodeBody/IsExcludePrefix"),null!=t&&"true"==a.getNodeData(t).Trim())for(let t=0;t<e.length&&e[t]==s;t++)e=e.Remove(0,1),t--;else for(let t=e.length-1;t>=0&&e[t]==s;t--)e=e.Remove(e.length-1,1)}t=a.SelectSingleNode("BarCodeBody/IncludeChecksum"),null!=t&&"true"==a.getNodeData(t).toLowerCase()&&(e=e.Remove(e.length-1,1))}a=new n.f,a.LoadXml(i.BarcodeDef);let r=a.SelectNodes("Definition/Field");for(let i=0;i<r.length;i++){let o="",l="",c="",h="",u=0,d=0;null!=a.getDateByNodeName(r[i],"DataSource")&&(o=a.getDateByNodeName(r[i],"DataSource")),null!=a.getDateByNodeName(r[i],"SysColumn")&&(l=a.getDateByNodeName(r[i],"SysColumn")),null!=a.getDateByNodeName(r[i],"Delimiter")&&(c=a.getDateByNodeName(r[i],"Delimiter"));let D=a.getDateByNodeName(r[i],"Width");if(n.e.IsNum(D)&&(u=parseInt(D)),D=a.getDateByNodeName(r[i],"Decimals"),n.e.IsNum(D)&&(d=parseInt(D)),-1==u&&""!=c){let t=e.indexOf(c);t>0&&t<e.length&&(h=e.substr(0,t),e=e.Remove(0,t))}else-1!=u&&e.length>=u?(h=e.substr(0,u),e=e.Remove(0,u)):-1==u&&i==r.length-1&&(h=e);""!=c&&e.length>c.length&&(e=e.Remove(0,c.length)),"Document"==o&&"INVID"==l?""!=h?s=h:e="":"Document"==o&&"quantity"==l.toLowerCase()&&n.e.IsNum(h)&&(t=parseFloat(h))}}let a=this.GridData.filter(e=>e.RefID==s);if(a.length>0){if(a[0].Qty=n.e.IsEmpty(a[0].Qty)?t:parseFloat(a[0].Qty)+t,2==this.QtyType&&!n.e.IsEmpty(a[0].AvailQty)&&parseFloat(a[0].AvailQty)<parseFloat(a[0].Qty)&&(a[0].Qty=a[0].AvailQty,this.DisplayMessage="Can not adjust more than available"),this.TextFields[0].Text="",n.e.PlaySound("beep-02.wav"),2==this.QtyType&&this.Parent.ScreenObject.GridDataObj.TableColumns.Contains("BinWise")&&1==Object(o.j)(this.Parent.SelectedRow.BinWise)&&(null==this.dtBins||0==this.dtBins.filter(e=>e.InvID==s).length)){let e=this.Parent.SelectedRow,t=this.Parent.ScreenObject.GetinvBinDetails(s,e.ProductID_Key.toString(),e.LinkedInvDocDetailsID.toString());this.FillBins(t,0,s)}}else{let e="",i="0",r="";2==this.QtyType&&(r=this.Parent.SelectedRow.LinkedInvDocDetailsID.toString(),i=this.Parent.SelectedRow.ProductID_Key.toString()),2!=this.QtyType&&7!=this.QtyType||!this.Parent.ScreenObject.Preferences.ContainsKey("BilllandingScanField")||n.e.IsEmpty(this.Parent.ScreenObject.Preferences.BilllandingScanField)||n.e.IsEmpty(this.GridDataObj.SearchCols.SelectedValue)||this.GridDataObj.SearchCols.SelectedValue!=this.Parent.ScreenObject.Preferences.BilllandingScanField||(e=this.GridDataObj.SearchCols.SelectedValue);let l="";2==this.QtyType&&(l=this.Parent.SelectedRow.landingType.toString());let c=this.Parent.ScreenObject.GetinvDetails("",s,i,l,r,this.SelectedRowEditing,!1,e);if(!(null!=c&&c.Tables.length>0&&c.Columns[0].Contains("ProductID")&&c.Tables[0].length>0)){if(7==this.QtyType&&this.Parent.ScreenObject.Preferences.ContainsKey("usetempifnotscanned")&&Object(o.j)(this.Parent.ScreenObject.Preferences.usetempifnotscanned)){if(!(this.Parent.ScreenObject.TempProductID>0))return void(this.DisplayMessage="Define Temp product");{let e=this.GridDataObj.NewRow();e.RefID=s,e.Qty=t,e.Type="1",e.ProductID=this.Parent.ScreenObject.TempProductID.toString(),this.GridDataObj.addRow(e)}}else this.DisplayMessage="Product not found";return this.TextFields[0].Text="",void n.e.PlaySound("beep-01.wav")}if("0"!=i&&c.Tables[0][0].ProductID.toString()!=i)return n.e.PlaySound("beep-01.wav"),void(this.DisplayMessage="Different Product Scanned");{if(c.Tables.length>1&&c.Tables[1].length>0)for(let e=0;e<c.Tables[1].length;e++){if(a=this.GridData.filter(t=>t.RefID==c.Tables[1][e].InvDocDetailsID),!(a.length>0))return void(this.DisplayMessage="Select Product in FIFO Order");if(parseFloat(a[0].Qty)<parseFloat(c.Tables[1][e].Qty))return void(this.DisplayMessage="Select Product in FIFO Order")}if(!n.e.IsEmpty(e)){let e=t;for(let i=0;i<c.Tables[0].length&&e>0;i++)if(s=c.Tables[0][i].InvDocDetailsID.toString(),a=this.GridData.filter(e=>e.RefID==s),a.length>0)if(2==this.QtyType){if(n.e.IsEmpty(a[0].AvailQty)?(a[0].Qty=e,e=0):n.e.IsEmpty(a[0].Qty)?parseFloat(a[0].AvailQty)>e?(a[0].Qty=e,e=0):(a[0].Qty=a[0].AvailQty.toString(),e-=parseFloat(a[0].AvailQty)):parseFloat(a[0].AvailQty)>e+parseFloat(a[0].Qty)?(a[0].Qty=parseFloat(a[0].Qty)+e,e=0):(e-=parseFloat(a[0].AvailQty)-parseFloat(a[0].Qty),a[0].Qty=a[0].AvailQty.toString()),!n.e.IsEmpty(a[0].AvailQty)&&parseFloat(a[0].AvailQty)<parseFloat(a[0].Qty)&&(a[0].Qty=a[0].AvailQty,this.DisplayMessage="Can not adjust more than available"),this.TextFields[0].Text="",this.Parent.ScreenObject.GridDataColumns.Contains("BinWise")&&"True"==this.Parent.SelectedRow.BinWise.toString()&&(null==this.dtBins||0==this.dtBins.filter(e=>e.InvID==s).length)){let e=this.Parent.SelectedRow,t=this.Parent.ScreenObject.GetinvBinDetails(s,e.ProductID_Key.toString(),e.LinkedInvDocDetailsID.toString());this.FillBins(t,0,s)}}else a[0].Qty=n.e.IsEmpty(a[0].Qty)?t:parseFloat(a[0].Qty)+t,e=0,this.TextFields[0].Text="";else{let a=0;this.dsusedbins.Tables.length>0&&this.dsusedbins.Tables[0].filter(e=>e.RefID==s).forEach(e=>{this.dsusedbins.Columns[0].Contains("Qty")&&!n.e.IsEmpty(e.Qty)&&(a+=parseFloat(e.Qty))});let r,o=this.GridDataObj.NewRow();if(o.RefID=s,o.Qty=t,o.Type="1",7==this.QtyType?(o.ProductID=c.Tables[0][0].ProductID.toString(),o.Qty=t,e=0):2==this.QtyType&&(n.e.IsEmpty(c.Tables[0][i].Qty)?(o.Qty=e,e=0):(o.AvailQty=parseFloat(c.Tables[0][i].Qty)-a,parseFloat(o.AvailQty)>e?(o.Qty=e,e=0):(o.Qty=o.AvailQty,e-=parseFloat(o.AvailQty)))),""!=this.Query){let e=this.Parent.ScreenObject.GetinvDetails(this.Query,s,"","","",this.SelectedRowEditing);for(let t=4;t<this.ColumnSource.length;t++)o[this.ColumnSource[t].DisplayMember]=e.Tables[0][0][this.ColumnSource[t].DisplayMember].toString()}if(this.GridDataObj.addRow(o),7==this.QtyType)r=this.Parent.ScreenObject.GetinvBinDetails(s,c.Tables[0][0].ProductID.toString(),"");else{let e=this.Parent.SelectedRow;r=this.Parent.ScreenObject.GetinvBinDetails(s,e.ProductID_Key.toString(),e.LinkedInvDocDetailsID.toString())}this.FillBins(r,0,s)}return void(e>0?this.DisplayMessage="Can not adjust more than available":(this.TextFields[0].Text="",n.e.PlaySound("beep-02.wav")))}let i=0;this.dsusedbins.Tables.length>0&&this.dsusedbins.Tables[0].filter(e=>e.RefID==s).forEach(e=>{this.dsusedbins.Columns[0].Contains("Qty")&&!n.e.IsEmpty(e.Qty)&&(i+=parseFloat(e.Qty))});let r=this.GridDataObj.NewRow();if(r.RefID=s,r.Qty=t,r.Type="1",7==this.QtyType&&(r.ProductID=c.Tables[0][0].ProductID.toString()),2!=this.QtyType||n.e.IsEmpty(c.Tables[0][0].Qty)||(r.AvailQty=parseFloat(c.Tables[0][0].Qty)-i,parseFloat(r.AvailQty)<t&&(r.Qty=r.AvailQty,this.DisplayMessage="Can not adjust more than available")),""!=this.Query){let e=this.Parent.ScreenObject.GetinvDetails(this.Query,s,"","","",this.SelectedRowEditing);for(let t=4;t<this.ColumnSource.length;t++)r[this.ColumnSource[t].DisplayMember]=e.Tables[0][0][this.ColumnSource[t].DisplayMember].toString()}if(this.GridDataObj.addRow(r),this.TextFields[0].Text="",n.e.PlaySound("beep-02.wav"),n.e.IsEmpty(e))this.FillBins(c,2,s);else{let e=this.Parent.SelectedRow,t=this.Parent.ScreenObject.GetinvBinDetails(s,e.ProductID_Key.toString(),e.LinkedInvDocDetailsID.toString());this.FillBins(t,0,s)}}}}FillBins(e,t,s){if(null!=e&&e.Tables.length>t&&e.Tables[t].length>0){null==this.dtBins&&(this.dtBins=[],this.dtBinsColumns=[],this.dtBinsColumns.push("BinID"),this.dtBinsColumns.push("Qty"),this.dtBinsColumns.push("InvID"),e.Columns[t].Contains("InvDocDetailsID")&&this.dtBinsColumns.push("InvDocDetailsID"));for(let i=0;i<e.Tables[t].length;i++)if(n.e.Double(e.Tables[t][i].Quantity)>0){let a={};a.BinID=e.Tables[t][i].BinID.toString(),a.Qty=e.Tables[t][i].Quantity.toString(),a.InvID=s,e.Columns[t].Contains("InvDocDetailsID")&&(a.InvDocDetailsID=e.Tables[t][i].InvDocDetailsID.toString()),this.dtBins.push(a)}}}InitGrid(){if(1==this.QtyType){let t=this.Parent.SelectedRow,s=this.Parent.ScreenObject.GridDataObj.TableColumns;this.GridDataObj.CanUserDeleteRows=!0;let i=n.e.String(this.Parent.SelectedRow.ProductID_Key),o=this.Parent.ScreenObject.GetQtyAdjustmentDetails(i);this.fldDict=new r.a;let l=0,c=0,h=new n.f;this.Parent.ScreenObject.Preferences.ContainsKey("QtyAdjXML")&&!n.e.IsEmpty(this.Parent.ScreenObject.Preferences.QtyAdjXML)&&h.LoadXml(this.Parent.ScreenObject.Preferences.QtyAdjXML);let d=h.SelectNodes("XML/Row");this.GridDataObj.TableColumns.push("Islinked");for(let e=0;e<o.Tables[0].length;e++){let a=new y.a;if(a.Header=o.Tables[0][e].ResourceData.toString(),a.DisplayMember=o.Tables[0][e].SysColumnName.toString(),a.Formula=o.Tables[0][e].Cformula.toString(),a.DecimalPoints=n.e.IsEmpty(o.Tables[0][e].Decimal)?"0":o.Tables[0][e].Decimal.toString(),!n.e.IsEmpty(o.Tables[0][e].IsMandatory)){a.Action=parseInt(o.Tables[0][e].IsMandatory);let i="";if(a.Action>0?i="dcNum"+a.Action:-2==a.Action?i="Quantity":-3==a.Action?i="Rate":-4==a.Action&&(i="Gross"),""!=i){a.ShowTotal=!0;let e=new u.d;e.Label=a.Header,s.Contains(i)&&(e.Text=n.e.String(t[i])),e.Column=c%4,e.Row=c/4,e.IsReadOnly=!0,this.TextFields.push(e),c++}}"fld10"!=a.DisplayMember.toLowerCase()&&(a.DataType="FLOAT"),o.Tables.length>1&&o.Tables[1].length>0&&o.Columns[1].Contains(a.DisplayMember)&&(a.DefaultValue=o.Tables[1][0][a.DisplayMember].toString()),l=n.e.IntTryParse(o.Tables[0][e].UserDefaultValue),-1==l?(a.IsReEvaluate=!0,a.ShowTotal=!0):n.e.IsNum(o.Tables[0][e].UserDefaultValue)&&l<-2&&(a.ShowTotal=!1,a.ValueMember=a.DisplayMember+"_Key",this.GridDataObj.TableColumns.push(a.ValueMember),a.DataType="LISTBOX",l=-1*l+5e4,a.CostCenterID=l,a.TypeID=1,"product"==a.Formula.toLowerCase()&&(a.FilterCondition=" cc.productid="+i),a.Formula=""),a.Width=100;for(let e=0;e<d.length;e++)if(null!=d[e].attributes.ColName&&d[e].attributes.ColName.value==a.DisplayMember){null==d[e].attributes.Val||n.e.IsEmpty(d[e].attributes.Val.value)||("2"==d[e].attributes.Val.value?a.ReadOnly=!0:"3"==d[e].attributes.Val.value?a.IsVisible=!1:"4"==d[e].attributes.Val.value&&(a.NoRoundOff=!0)),null==d[e].attributes.Width||n.e.IsEmpty(d[e].attributes.Width.value)||(a.Width=parseInt(d[e].attributes.Width.value));break}this.ColumnSource.push(a),this.GridDataObj.TableColumns.push(a.DisplayMember);let r=new O.c;r.setFieldDetails(a.Header,1,1,"0",1,!1,!1),this.fldDict.push(a.Header,r)}let D=this.Parent.SelectedRow;if(h=new n.f,n.e.IsEmpty(D.QtyXML)){var e=this.ColumnSource.filter(e=>"LISTBOX"==e.DataType&&-1==e.Action);if(e.length>0)for(c=0,c=0;c<e.length;c++){let t,s=e[c],i=s.TypeID>0?s.TypeID:1;a.a.SessionManager.ListViewDef.Columns.Contains("ColumnType")&&(t=1);let r=a.a.SessionManager.ListViewDef.Tables[0].filter(e=>e.CostCenterID==s.CostCenterID&&e.ListViewTypeID==i&&(Object(f.isUndefined)(t)||e.ColumnType==t));if(r.length>0){let e;if(e=n.e.IsEmpty(s.FilterCondition)?this.GetCostCenterListViewData(parseInt(r[0].ListViewID),"a."+r[0].SysColumnName.toString(),r[0].SysColumnName.toString(),0):this.GetCostCenterListViewData(parseInt(r[0].ListViewID),"a."+r[0].SysColumnName.toString(),r[0].SysColumnName.toString(),0,"",s.FilterCondition),null!=e&&e.Tables.length>0&&!e.Columns[0].Contains("ErrorMessage"))for(let t=0;t<e.Tables[0].length;t++){let i;1==c?(i=this.GridDataObj.NewRow(),this.GridDataObj.addRow(i)):this.GridData.length>t?i=this.GridData[t]:(i=this.GridDataObj.NewRow(),this.GridDataObj.addRow(i)),i[s.ValueMember]=parseInt(e.Tables[0][t][e.Columns[0][0]]),i[s.DisplayMember]=e.Tables[0][t][e.Columns[0][1]].toString()}}}}else{h.LoadXml(D.QtyXML),d=h.SelectNodes("QtyAdjustments/Row");for(let e=0;e<d.length;e++){let t=this.GridDataObj.NewRow();for(let s=0;s<this.ColumnSource.length;s++)null==d[e].attributes[this.ColumnSource[s].DisplayMember]||n.e.IsEmpty(d[e].attributes[this.ColumnSource[s].DisplayMember].value)||("LISTBOX"==this.ColumnSource[s].DataType?(t[this.ColumnSource[s].ValueMember]=d[e].attributes[this.ColumnSource[s].DisplayMember].value,null==d[e].attributes[this.ColumnSource[s].ValueMember]||n.e.IsEmpty(d[e].attributes[this.ColumnSource[s].ValueMember].value)||(t[this.ColumnSource[s].DisplayMember]=d[e].attributes[this.ColumnSource[s].ValueMember].value)):t[this.ColumnSource[s].DisplayMember]=d[e].attributes[this.ColumnSource[s].DisplayMember].value);t.Islinked=null==d[e].attributes.Islinked||"1"!=d[e].attributes.Islinked.value&&"True"!=d[e].attributes.Islinked.value?"0":"1",this.GridDataObj.addRow(t)}this.RefreshGrid=!0,this.ColumnSource.filter(e=>1==e.ShowTotal).forEach(e=>{let t=0;for(let s=0;s<this.GridData.length;s++)n.e.IsEmpty(this.GridData[s][e.DisplayMember])||(t+=parseFloat(this.GridData[s][e.DisplayMember]));e.footer=null!=e.DecimalPoints&&""!=e.DecimalPoints?t.ToString("N"+e.DecimalPoints):t.toString(),this.UpdateFooter=!0})}for(let e=0;e<10;e++)this.GridDataObj.addEmptyRow()}else if(0==this.QtyType){this.GridDataObj.TableColumns.push("Name"),this.GridDataObj.TableColumns.push("Amount"),this.GridDataObj.TableColumns.push("CalcAmount");let e=new y.a;e.Header="Field",e.ValueBinding="Name",e.DataType="ComboBox",e.DisplayMember="Name",e.ValueMember="Value",e.Width=230,this.ColumnSource.push(e),e=new y.a,e.Header="Value",e.DisplayMember="Amount",e.DataType="FLOAT",e.Width=100,this.ColumnSource.push(e),e=new y.a,e.Header="Calculated Value",e.DisplayMember="CalcAmount",e.DataType="FLOAT",e.Width=120,this.ColumnSource.push(e)}else if(2==this.QtyType||7==this.QtyType){this.GridDataObj.TableColumns.push("RefID"),this.GridDataObj.TableColumns.push("Qty"),this.GridDataObj.TableColumns.push("Type"),7==this.QtyType&&this.GridDataObj.TableColumns.push("ProductID");let e,t=new y.a;if(t.Header="Code",t.DisplayMember="RefID",t.Width=100,t.ReadOnly=!0,2==this.QtyType&&(t.DisableTab=!0),this.ColumnSource.push(t),t=new y.a,t.Header="Qty",t.DisplayMember="Qty",t.DataType="FLOAT",t.Width=100,t.ReadOnly=!a.a.SessionManager.IsActionAssigned(43,"Enable Qty in BOE"),"AddEditDocumentViewModel"==this.Parent.ClassName){let e=this.Parent.ScreenObject.ColumnSource.find(e=>null!=e.DisplayMember&&"quantity"==e.DisplayMember.toLowerCase());null!=e&&(t.DecimalPoints=e.DecimalPoints)}this.ColumnSource.push(t),this.GridDataObj.TableColumns.push("AvailQty"),t=new y.a,t.Header="Available",t.DisplayMember="AvailQty",t.DataType="FLOAT",t.Width=100,t.ReadOnly=!0,2==this.QtyType&&(t.DisableTab=!0),this.ColumnSource.push(t),t=new y.a,t.Header="Type",t.DisplayMember="Type",t.DataType="FLOAT",t.IsVisible=!1,t.Width=100,t.ReadOnly=!0,2==this.QtyType&&(t.DisableTab=!0),this.ColumnSource.push(t),n.e.IsNum(this.Parent.ScreenObject.Preferences.BilllandingReport)&&(e=n.e.IntTryParse(this.Parent.ScreenObject.Preferences.BilllandingReport))}else if(3==this.QtyType||5==this.QtyType){this.GridDataObj.TableColumns.push("RefID"),this.GridDataObj.TableColumns.push("Name"),this.GridDataObj.TableColumns.push("Qty"),this.GridDataObj.TableColumns.push("Type"),this.GridDataObj.TableColumns.push("cWeight"),this.GridDataObj.TableColumns.push("cVolume"),this.GridDataObj.TableColumns.push("pWeight"),this.GridDataObj.TableColumns.push("pVolume"),this.GridDataObj.TableColumns.push("Weight"),this.GridDataObj.TableColumns.push("Volume"),this.GridDataObj.TableColumns.push("Label"),this.GridDataObj.TableColumns.push("UsedWeight"),this.GridDataObj.TableColumns.push("UsedVolume"),this.GridDataObj.TableColumns.push("length"),this.GridDataObj.TableColumns.push("Width"),this.GridDataObj.TableColumns.push("Height"),this.GridDataObj.TableColumns.push("ActualWeight"),this.GridDataObj.TableColumns.push("ActualVolume"),this.PackWise&&(this.GridDataObj.TableColumns.push("Data"),this.GridDataObj.TableColumns.push("ExtraProductXML"));let e,i=[],r=[],o=this.GridDataObj.NewRow();if(a.a.SessionManager.Preferences.ContainsKey("PackDef")&&""!=a.a.SessionManager.Preferences.PackDef){let s=new n.f;s.LoadXml(a.a.SessionManager.Preferences.PackDef);for(let t=0;t<s.DocumentElement.children.length;t++){let a=s.DocumentElement.children[t];e=new y.a,e.Header=a.attributes.Header.value,e.DisplayMember=a.attributes.Name.value,e.DisplayIndex=parseInt(a.attributes.index.value),e.Width=parseInt(a.attributes.WIDTH.value),"1"==a.attributes.Visible.value?e.IsVisible=!0:"2"==a.attributes.Visible.value?(e.IsVisible=!0,e.ReadOnly=!0):e.IsVisible=!1,5==this.QtyType&&(o[e.DisplayMember]=a.attributes.Visible.value),i.push(e)}var t=s.SelectSingleNode("XML").attributes.ProdList;null==t||n.e.IsEmpty(t.Value)||(5==this.QtyType?this.TextFields[0].SelectedValue=t.Value:this.Footerfld=t.Value)}e=new y.a,e.Header="Pack",e.DisplayMember="Name",e.Width=100,e.ReadOnly=!0,this.SetVarible(i,e),r.push(e),e=new y.a,e.Header="Label",e.DisplayMember="Label",e.DataType="FLOAT",e.Width=100,e.ReadOnly=!0,this.SetVarible(i,e),r.push(e),e=new y.a,e.Header="Qty",e.DisplayMember="Qty",e.DataType="FLOAT",e.Width=100,this.SetVarible(i,e),r.push(e),e=new y.a,e.Header="Type",e.DisplayMember="Type",e.DataType="FLOAT",e.IsVisible=!1,e.Width=100,e.ReadOnly=!0,r.push(e),e=new y.a,e.Header="RefID",e.DisplayMember="RefID",e.IsVisible=!1,e.Width=100,e.ReadOnly=!0,r.push(e),e=new y.a,e.Header="Volume",e.DisplayMember="Volume",e.DataType="FLOAT",e.Width=100,e.ReadOnly=!0,this.SetVarible(i,e),r.push(e),e=new y.a,e.Header="Product Volume",e.DisplayMember="pVolume",e.DataType="FLOAT",e.Width=120,e.ReadOnly=!0,this.SetVarible(i,e),r.push(e),e=new y.a,e.Header="Total Volume",e.DisplayMember="cVolume",e.DataType="FLOAT",e.Width=120,e.ReadOnly=!0,this.SetVarible(i,e),r.push(e),e=new y.a,e.Header="Actual Volume",e.DisplayMember="ActualVolume",e.DataType="FLOAT",e.Width=120,e.ReadOnly=!0,this.SetVarible(i,e),r.push(e),e=new y.a,e.Header="Weight",e.DisplayMember="Weight",e.DataType="FLOAT",e.Width=100,e.ReadOnly=!0,this.SetVarible(i,e),r.push(e),e=new y.a,e.Header="Product Weight",e.DisplayMember="pWeight",e.DataType="FLOAT",e.Width=120,e.ReadOnly=!0,this.SetVarible(i,e),r.push(e),e=new y.a,e.Header="Total Weight",e.DisplayMember="cWeight",e.DataType="FLOAT",e.Width=120,e.ReadOnly=!0,this.SetVarible(i,e),r.push(e),e=new y.a,e.Header="Actual Weight",e.DisplayMember="ActualWeight",e.DataType="FLOAT",e.Width=120,e.ReadOnly=!0,this.SetVarible(i,e),r.push(e),e=new y.a,e.Header="length",e.DisplayMember="length",e.DataType="FLOAT",e.Width=100,e.ReadOnly=!0,this.SetVarible(i,e),r.push(e),e=new y.a,e.Header="Width",e.DisplayMember="Width",e.DataType="FLOAT",e.Width=100,e.ReadOnly=!0,this.SetVarible(i,e),r.push(e),e=new y.a,e.Header="Height",e.DisplayMember="Height",e.DataType="FLOAT",e.Width=120,e.ReadOnly=!0,this.SetVarible(i,e),r.push(e);let l=[];l.push(D.d.ComboBoxItems_2("Editable","1")),l.push(D.d.ComboBoxItems_2("ReadOnly","2")),l.push(D.d.ComboBoxItems_2("Hide","3"));let c=[];c.push(D.d.ComboBoxItems_2("ReadOnly","2")),c.push(D.d.ComboBoxItems_2("Hide","3"));var s=r.sort((e,t)=>e.DisplayIndex-t.DisplayIndex);for(let t=0;t<s.length;t++){let e=s[t];if(5==this.QtyType){if("Type"==e.DisplayMember||"RefID"==e.DisplayMember)continue;e.DataType="ComboBox",e.ComboData="ActualVolume"==e.DisplayMember||"ActualWeight"==e.DisplayMember||"Qty"==e.DisplayMember||"Height"==e.DisplayMember||"Width"==e.DisplayMember||"length"==e.DisplayMember?l:c,e.ValueBinding=e.DisplayMember,e.DisplayMember="Name",e.ValueMember="Value",e.ReadOnly=!1,e.IsVisible=!0}this.ColumnSource.push(e)}if(5==this.QtyType){if(0==i.length)for(let e=0;e<this.GridDataObj.TableColumns.length;e++)o[e]="Qty"==this.GridDataObj.TableColumns[e]?"1":"2";this.GridDataObj.addRow(o)}}else if(4==this.QtyType){this.GridDataObj.TableColumns.push("RefID"),this.GridDataObj.TableColumns.push("Name"),this.GridDataObj.TableColumns.push("Min"),this.GridDataObj.TableColumns.push("Max"),this.GridDataObj.TableColumns.push("TestType"),this.GridDataObj.TableColumns.push("ProbableValues"),this.GridDataObj.TableColumns.push("MultiColTYPE"),this.GridDataObj.TableColumns.push("Variance"),this.GridDataObj.TableColumns.push("Sample"),this.GridDataObj.TableColumns.push("SampleType"),this.GridDataObj.TableColumns.push("Retest"),this.GridDataObj.TableColumns.push("SampleNo"),this.GridDataObj.TableColumns.push("Samplesize"),a.a.SessionManager.Preferences.ContainsKey("QCLabNameDimension")&&!n.e.IsEmpty(a.a.SessionManager.Preferences.QCLabNameDimension)&&0!=parseInt(a.a.SessionManager.Preferences.QCLabNameDimension)&&(this.GridDataObj.TableColumns.push("LabName"),this.GridDataObj.TableColumns.push("LabName_Key"),this.GridDataObj.TableColumns.push("ReportNo"),this.GridDataObj.TableColumns.push("ReportDate"),this.GridDataObj.TableColumns.push("ReportDate_Key")),this.GridDataObj.TableColumns.push("Unit"),this.GridDataObj.TableColumns.push("Unit_Key"),this.GridDataObj.TableColumns.push("Remarks");let e=new y.a;e.Header="Name",e.DisplayMember="Name",e.Width=150,e.ReadOnly=!0,this.ColumnSource.push(e),e=new y.a,e.Header=a.a.GetResource("Inv_TestType"),e.DisplayMember="Name",e.ValueMember="Value",e.ValueBinding="TestType";let t=[];t.push(D.d.ComboBoxItems_2("Numeric","0")),t.push(D.d.ComboBoxItems_2("Visual","1")),e.ComboData=t,e.DataType="ComboBox",e.Width=80,e.ReadOnly=!0,this.ColumnSource.push(e),e=new y.a,e.Header=a.a.GetResource("Inv_Min"),e.DisplayMember="Min",e.DataType="TextBlock",e.Width=75,e.ReadOnly=!0,this.ColumnSource.push(e),e=new y.a,e.Header=a.a.GetResource("Inv_Max"),e.DisplayMember="Max",e.DataType="TextBlock",e.Width=75,e.ReadOnly=!0,this.ColumnSource.push(e),e=new y.a,e.Header=a.a.GetResource("CustomizeCostCenter_ProbableValues"),e.DisplayMember="ProbableValues",e.DataType="TextBlock",e.Width=120,e.ReadOnly=!0,this.ColumnSource.push(e),e=new y.a,e.Header=a.a.GetResource("Inv_Variance"),e.DisplayMember="Variance",e.DataType="TextBlock",e.Width=80,e.ReadOnly=!0,this.ColumnSource.push(e),e=new y.a,e.CostCenterID=11,e.TypeID=1,e.DataType="LISTBOX",e.DisplayMember="Unit",e.ValueMember="Unit_Key",e.Header="Unit",e.Width=100,this.ColumnSource.push(e),e=new y.a,e.Header=a.a.GetResource("Inv_Sample"),e.DisplayMember="SampleNo",e.DataType="TextBlock",e.Width=80,e.ReadOnly=!0,this.ColumnSource.push(e),e=new y.a,e.Header="Samplesize",e.DisplayMember="Samplesize",e.DataType="TextBlock",e.Width=80,e.ReadOnly=!0,this.ColumnSource.push(e),e=new y.a,e.Header=a.a.GetResource("Inv_SampleType"),e.DisplayMember="Name",e.ValueMember="Value",e.ValueBinding="SampleType",t=[],t.push(D.d.ComboBoxItems_2("Value","0")),t.push(D.d.ComboBoxItems_2("Number","1")),t.push(D.d.ComboBoxItems_2("Percentage Value","2")),t.push(D.d.ComboBoxItems_2("Percentage Number","3")),e.ComboData=t,e.DataType="ComboBox",e.Width=120,e.ReadOnly=!0,this.ColumnSource.push(e),a.a.SessionManager.Preferences.ContainsKey("QCLabNameDimension")&&!n.e.IsEmpty(a.a.SessionManager.Preferences.QCLabNameDimension)&&0!=parseInt(a.a.SessionManager.Preferences.QCLabNameDimension)&&(e=new y.a,e.CostCenterID=parseInt(a.a.SessionManager.Preferences.QCLabNameDimension.toString()),e.TypeID=1,e.DataType="LISTBOX",e.DisplayMember="LabName",e.ValueMember="LabName_Key",e.Header="Lab Name",e.Width=100,this.ColumnSource.push(e),e=new y.a,e.DisplayMember="ReportNo",e.Header="Report No.",e.DataType="TextBlock",e.Width=100,e.IsVisible=!0,this.ColumnSource.push(e),e=new y.a,e.Header="Report Date",e.DisplayMember="ReportDate",e.ValueMember="ReportDate_Key",e.DataType="DATE",e.ReadOnly=!1,e.Width=100,this.ColumnSource.push(e)),e=new y.a,e.DisplayMember="Remarks",e.Header=a.a.GetResource("Remarks"),e.DataType="TextBlock",e.Width=200,e.IsVisible=!0,this.ColumnSource.push(e)}this.GridDataObj.SearchVisible=!0}GetCostCenterListViewData(e,t,s,i,n="",r=""){let o=[];return o.push(e),o.push(t),o.push(""),o.push(n),o.push(s),o.push(""),o.push(i),o.push(!1),o.push(""),o.push(""),o.push(r),o.push(""),o.push(""),o.push(0),o.push(!1),o.push(""),o.push(a.a.SessionManager.UserID),o.push(a.a.SessionManager.RoleID),o.push(a.a.SessionManager.LanguageID),a.a.common.GetCostCenterListViewData(a.a.SessionManager.CompanyIndex,o)}SetVarible(e,t){var s=e.find(e=>e.DisplayMember==t.DisplayMember);s&&(t.DisplayIndex=s.DisplayIndex,t.Width=s.Width,t.IsVisible=s.IsVisible,t.ReadOnly=s.ReadOnly)}OnBeginedit(e){if(1==this.QtyType){let s=e.args.column.field;(t=this.ColumnSource.find(e=>e.DisplayMember==s)).NoRoundOff&&"1"==e.Row.Item.Row.Islinked.toString()&&(e.Cancel=!0)}else if(2==this.QtyType){let i=e.args.item;if(this.Parent.ScreenObject.Preferences.ContainsKey("BOEAutoAdjustOnCellEnter")&&"TRUE"==this.Parent.ScreenObject.Preferences.BOEAutoAdjustOnCellEnter.toUpperCase()){let a=e.args.column.field;if("Qty"==a){let e="2";var t;null!=(t=this.ColumnSource.find(e=>e.DisplayMember==a))&&(e=t.DecimalPoints);var s=this.GridData.Compute("sum","Qty");let r=parseFloat(this.TextFields[2].Text),o=0;null!=s&&""!=s.toString()&&0!=parseFloat(s.toString())||(s=0),!n.e.IsEmpty(i.Qty)&&parseFloat(i.Qty.toString())>0&&(s=parseFloat(s.toString())-parseFloat(i.Qty.toString())),o=parseFloat((r-parseFloat(s.toString())).ToString("N"+e)),o>0&&!n.e.IsEmpty(i.AvailQty)&&parseFloat(i.AvailQty)>0&&(i.Qty=parseFloat(i.AvailQty)>=o?o:parseFloat(i.AvailQty)),null!=(s=this.GridData.Compute("SUM(Qty)",""))&&""!=s.toString()&&0!=parseFloat(s.toString())||(s=0),this.BOEAdjSummary="Qty. Adjusted  :  "+parseFloat(s.toString()).ToString("N"+e)+"  of  "+this.TextFields[2].Text+"  for the Product  :  "+this.TextFields[1].Text}}}else if(4==this.QtyType){var i=e.args.column.DgCol;let t=e.args.column.field;if("DataGridPactListBoxColumn"==e.args.column.className&&"Unit"==t){let e="";e=this.Parent.SelectedRow.ProductID_Key.toString();let t=" (BaseID IN ";t+=" (SELECT     BaseID ",t+=" FROM          COM_UOM AS COM_UOM_1 with(nolock) ",t=t+" WHERE      (UOMID =(select UOMID from inv_product with(nolock) where productid="+e+") ))) ",""==e?(i.ProductID=0,t=" (BaseID IN ",t+=" (SELECT     BaseID ",t+=" FROM          COM_UOM AS COM_UOM_1 with(nolock) ",t+=" WHERE      (UOMID =-1 ))) "):i.ProductID=parseInt(e),i.FilterCondition=t}}}onDoubleClick(e){this.IsSingleProd||3!=this.QtyType||!this.PackWise||null==this.SelectedRow||n.e.IsEmpty(this.SelectedRow.Label)||(this.TextFields[1].Text=this.SelectedRow.Label.toString(),this.EditPack(!1))}oncelleditend(e){if("DataGridComboBoxColumn"!=e.column.className)if(1==this.QtyType){let t=e.item;this.ExecuteFormulas(t),this.ExecuteFormulas(t)}else if(0==this.QtyType){let t=e.column.field;"Amount"!=t&&"CalcAmount"!=t||this.calculate()}else if(2==this.QtyType){let i=e.item;if(null!=i&&n.e.Double(i.Qty)>0&&this.Parent.ScreenObject.GridDataColumns.Contains("BinWise")&&"True"==this.Parent.SelectedRow.BinWise.toString()&&(null==this.dtBins||0==this.dtBins.filter(e=>e.InvID==i.RefID).length)){let e=this.Parent.SelectedRow,t=this.Parent.ScreenObject.GetinvBinDetails(i.RefID.toString(),e.ProductID_Key.toString(),e.LinkedInvDocDetailsID.toString());this.FillBins(t,0,i.RefID.toString())}let a="2";var t=this.ColumnSource.find(e=>"Qty"==e.DisplayMember);null!=t&&null!=t&&(a=t.DecimalPoints);var s=this.GridData.Compute("sum","Qty");null!=s&&""!=s.toString()&&0!=parseFloat(s.toString())||(s=0),this.BOEAdjSummary="Qty. Adjusted  :  "+parseFloat(s.toString()).ToString("N"+a)+"  of  "+this.TextFields[2].Text+"  for the Product  :  "+this.TextFields[1].Text}else if(3==this.QtyType&&"Qty"==e.column.field){let t=e.item;n.e.IsEmpty(t.Qty)||(this.Wt>0&&(t.pWeight=parseFloat(t.Qty)*this.Wt,t.cWeight=n.e.IsEmpty(t.UsedWeight)?t.pWeight.toString():parseFloat(t.UsedWeight)+parseFloat(t.pWeight)),this.Vol>0&&(t.pVolume=parseFloat(t.Qty)*this.Vol,t.cVolume=n.e.IsEmpty(t.UsedWeight)?t.pVolume.toString():parseFloat(t.UsedVolume)+parseFloat(t.pVolume)),this.GridDataObj.updateRow(t))}}ExecuteFormulas(e){this.fldDict.forEach(t=>{var s=this.ColumnSource.filter(e=>e.Header==this.fldDict[t.Key].getFieldName());n.e.IsNum(e[s[0].DisplayMember])?this.fldDict[t.Key].setFieldValue(null!=s[0].DecimalPoints&&""!=s[0].DecimalPoints?parseFloat(e[s[0].DisplayMember]).ToString("N"+s[0].DecimalPoints):e[s[0].DisplayMember]):this.fldDict[t.Key].setFieldValue(0)});let t=this.fldDict;for(let i=0;i<this.ColumnSource.length;i++){if(n.e.IsEmpty(this.ColumnSource[i].Formula))!n.e.IsEmpty(this.ColumnSource[i].DefaultValue)&&n.e.IsEmpty(e[this.ColumnSource[i].DisplayMember])&&(e[this.ColumnSource[i].DisplayMember]=this.ColumnSource[i].DefaultValue);else{var s=a.a.eval.EvaluateExpression(this.ColumnSource[i].Formula,t).toString();n.e.IsNum(s)&&(null!=this.ColumnSource[i].DecimalPoints&&""!=this.ColumnSource[i].DecimalPoints?e[this.ColumnSource[i].DisplayMember]=parseFloat(s).ToString("N"+this.ColumnSource[i].DecimalPoints):null!=s&&(e[this.ColumnSource[i].DisplayMember]=s.toString()))}if(this.ColumnSource[i].ShowTotal){let e=0;for(let t=0;t<this.GridData.length;t++)n.e.IsEmpty(this.GridData[t][this.ColumnSource[i].DisplayMember])||(e+=parseFloat(this.GridData[t][this.ColumnSource[i].DisplayMember]));this.ColumnSource[i].footer=null!=this.ColumnSource[i].DecimalPoints&&""!=this.ColumnSource[i].DecimalPoints?e.ToString("N"+this.ColumnSource[i].DecimalPoints):e.toString(),this.UpdateFooter=!0}}}calculate(){let e,t,s=null;n.e.IsType(this.Parent,"AddEditDocumentViewModel")?(s=this.Parent.SelectedRow,e=this.Parent.ScreenObject.GridDataObj.NewRow(),t=this.Parent.ScreenObject.GridDataColumns):this.Parent instanceof re&&(s=this.Parent.SelectedRow);for(let i=0;i<t.length;i++){let a=this.exists(t[i]);e[t[i]]=this.flds.Contains(t[i])&&a>=0&&!n.e.IsEmpty(this.GridData[a].Amount)?this.GridData[a].Amount.toString():s[t[i]]}n.e.IsType(this.Parent,"AddEditDocumentViewModel")?this.Parent.CalculateTotals(e,!1):this.Parent instanceof re&&this.Parent.Parent.CalculateTotals(e,!1);for(let i=0;i<this.GridData.length;i++)if(!n.e.IsEmpty(this.GridData[i].Name)){let s=null;n.e.IsType(this.Parent,"AddEditDocumentViewModel")?s=this.Parent.ScreenObject.ColumnSource.find(e=>null!=e.DisplayMember&&e.DisplayMember.toLowerCase()==this.GridData[i].Name.toString().toLowerCase()):this.Parent instanceof re&&(s=this.Parent.Parent.ScreenObject.ColumnSource.find(e=>null!=e.DisplayMember&&e.DisplayMember.toLowerCase()==this.GridData[i].Name.toString().toLowerCase())),s&&!n.e.IsEmpty(e[this.GridData[i].Name.toString()])&&""!=s.DecimalPoints?(this.GridData[i].Amount=parseFloat(e[this.GridData[i].Name.toString()]).ToString("N"+s.DecimalPoints),t.Contains("dcCalc"+this.GridData[i].Name.toString())&&!n.e.IsEmpty(e["dcCalc"+this.GridData[i].Name.toString()])&&(this.GridData[i].CalcAmount=parseFloat(e["dcCalc"+this.GridData[i].Name.toString()]).ToString("N"+s.DecimalPoints))):(this.GridData[i].Amount=e[this.GridData[i].Name.toString()],t.Contains("dcCalc"+this.GridData[i].Name.toString())&&(this.GridData[i].CalcAmount=e["dcCalc"+this.GridData[i].Name.toString()]))}if(""!=this.Footerfld&&t.Contains(this.Footerfld)){let s=null;n.e.IsType(this.Parent,"AddEditDocumentViewModel")?s=this.Parent.ScreenObject.ColumnSource.find(e=>null!=e.DisplayMember&&e.DisplayMember.toLowerCase()==this.Footerfld.toLowerCase()):this.Parent instanceof re&&(s=this.Parent.Parent.ScreenObject.ColumnSource.find(e=>null!=e.DisplayMember&&e.DisplayMember.toLowerCase()==this.Footerfld.toLowerCase())),s&&!n.e.IsEmpty(e[this.Footerfld])&&""!=s.DecimalPoints?(this.FooterValue=parseFloat(e[this.Footerfld]).ToString("N"+s.DecimalPoints),t.Contains("dcCalc"+this.Footerfld)&&!n.e.IsEmpty(e["dcCalc"+this.Footerfld])&&(this.FooterCalcValue=parseFloat(e["dcCalc"+this.Footerfld]).ToString("N"+s.DecimalPoints))):(this.FooterValue=e[this.Footerfld].toString(),t.Contains("dcCalc"+this.Footerfld)&&(this.FooterCalcValue=e["dcCalc"+this.Footerfld].toString()))}}exists(e){for(let t=0;t<this.GridData.length;t++)if(this.GridData[t].Name.toString()==e)return t;return-1}SaveBoe_Empty(){null!=this.Parent.SelectedRow?this.SaveBoe(this.Parent.SelectedRow):7==this.QtyType&&this.SaveBoe(null)}SaveBoe(e){let t=!1;this.Parent.ScreenObject.Preferences.ContainsKey("ClubBoe")&&"True"==this.Parent.ScreenObject.Preferences.ClubBoe&&!this.SelectedRowEditing&&(t=!0);let s,i=0,r=0;if(a.a.SessionManager.IsWebApplication){let t=0;if(this.GridData.length>0){for(let e=0;e<this.GridData.length;e++)n.e.IsEmpty(this.GridData[e].Qty)||(t+=parseFloat(this.GridData[e].Qty));if(t>parseFloat(e.Quantity))return void(this.DisplayMessage="Quantity can not be greater than actual qty.");t<parseFloat(e.Quantity)&&(i=parseFloat(e.Quantity)-t)}}else if(2==this.QtyType){var o=this.GridData.Compute("sum","Qty");let s="2";var l=this.ColumnSource.find(e=>"Qty"==e.DisplayMember);if(null!=l&&null!=l&&(s=l.DecimalPoints),null!=o&&""!=o.toString()&&(o=parseFloat(o.toString()).ToString("N"+s)),r=parseFloat(this.TextFields[2].Text),null!=o&&!n.e.IsEmpty(o)&&parseFloat(o)>r)return void(this.DisplayMessage="Quantity can not be greater than actual qty.");if(!t&&null!=o&&!n.e.IsEmpty(o)&&parseFloat(o)<r&&(i=parseFloat(e.Quantity)-parseFloat(o)),null!=e&&!n.e.IsEmpty(e.DocDetailsID)&&"0"!=e.DocDetailsID.toString())for(let e=0;e<this.GridData.length;e++)if(!n.e.IsEmpty(this.GridData[e].Qty)&&!n.e.IsEmpty(this.GridData[e].AvailQty)&&parseFloat(this.GridData[e].AvailQty)<parseFloat(this.GridData[e].Qty))return void(this.DisplayMessage="Can not adjust more than available for "+this.GridData[e].RefID.toString());if(this.Parent.ScreenObject.Preferences.ContainsKey("BOEValidateActualAndAdjustedQtys")&&"TRUE"==this.Parent.ScreenObject.Preferences.BOEValidateActualAndAdjustedQtys.toUpperCase()){for(let e=0;e<this.GridData.length;e++)if(null!=this.GridData[e].Qty&&null!=this.GridData[e].Qty&&""!=this.GridData[e].Qty.toString()&&null!=this.GridData[e].AvailQty&&null!=this.GridData[e].AvailQty&&""!=this.GridData[e].AvailQty.toString()&&parseFloat(this.GridData[e].AvailQty.toString())<parseFloat(this.GridData[e].Qty.toString()))return this.DisplayMessage="You can not adjust more than Available Quantity for "+n.e.String(this.GridData[e].RefID),void(this.MessageVisibility=!0);if(0!=i)return this.DisplayMessage="Sum of Quantity should be Equal to the Actual Quantity",void(this.MessageVisibility=!0)}}let c,h=0;c=2==this.QtyType?this.Parent.ScreenObject.GridData.indexOf(e):this.Parent.GetEmptyRowPosition(this.Parent.ScreenObject.GridDataObj,"ProductID_Key");let u=new n.f;if(this.Parent.ScreenObject.Preferences.ContainsKey("BilllandingMap")&&""!=this.Parent.ScreenObject.Preferences.BilllandingMap&&u.ReadXml(this.Parent.ScreenObject.Preferences.BilllandingMap),t){var d=this.Parent.ScreenObject.GridData.filter(e=>0==e.DocDetailsID&&e.ProductID_Key==this.Parent.SelectedRow.ProductID_Key);for(let s=0;s<d.length;s++)d[s].DocExtraXML=null,d[s].BOEID=null,d[s].BinsXML=null;let e=0,t=null;for(let i=0;i<this.GridData.length;i++)if(!n.e.IsEmpty(this.GridData[i].RefID)&&n.e.DoubleTryParse(this.GridData[i].Qty)>0){s=n.e.DoubleTryParse(this.GridData[i].Qty);var D=d.filter(e=>e!=t&&!n.e.IsEmpty(e.LinkedBoe)&&e.LinkedBoe.toString()==this.GridData[i].RefID.toString());if(D.length>0){for(let e=0;e<D.length;e++){if(parseFloat(D[e].Quantity)>s){this.FillData(D[e],i,u,s),s=0;break}if(!(s>0))break;{let t=D[e];if(s-=parseFloat(t.Quantity),this.FillData(t,i,u,parseFloat(t.Quantity)),d.Remove(t),0==s)break}}if(0==s)continue}if((D=d.filter(e=>e!=t&&!n.e.IsEmpty(e.Quantity)&&parseFloat(e.Quantity)==s)).length>0){let e=D[0];this.FillData(e,i,u,s),d.Remove(e)}else if(d.length>0)if(e>0){let a=this.Parent.ScreenObject.GridDataObj.NewRow();if(c=this.Parent.ScreenObject.GridData.indexOf(t),this.Parent.ScreenObject.GridDataObj.insertRowAt(a,c),this.FillDatarow(a,t),e>s)e-=s,a.Quantity=s,this.FillData(a,i,u,s);else if(s-=e,a.Quantity=e,this.FillData(a,i,u,e),d.Remove(t),e=0,t=null,s>0)for(let n=0;n<d.length;n++){if(parseFloat(d[n].Quantity)>s){e=parseFloat(d[n].Quantity)-s,t=d[n],t.Quantity=s,this.FillData(t,i,u,s);break}if(!(s>0))break;if(a=d[n],s-=parseFloat(a.Quantity),this.FillData(a,i,u,parseFloat(a.Quantity)),d.Remove(a),n--,0==s)break}}else for(let a=0;a<d.length;a++){if(parseFloat(d[a].Quantity)>s){e=parseFloat(d[a].Quantity)-s,t=d[a],t.Quantity=s,this.FillData(t,i,u,s);break}if(!(s>0))break;{let e=d[a];if(s-=parseFloat(e.Quantity),this.FillData(e,i,u,parseFloat(e.Quantity)),d.Remove(e),a--,0==s)break}}}null!=t&&e>0&&(t.Quantity=parseFloat(t.Quantity)+e,n.e.IsEmpty(t.UOMConversion)&&(t.UOMConversion="1"),t.UOMConvertedQty=n.e.IsEmpty(t.UOMConversion)||n.e.IsEmpty(t.Quantity)?t.Quantity:parseFloat(t.UOMConversion)*parseFloat(t.Quantity),this.Parent.CalculateTotals(t,!1))}else for(let a=0;a<this.GridData.length;a++)if(!n.e.IsEmpty(this.GridData[a].RefID)&&n.e.DoubleTryParse(this.GridData[a].Qty)>0){let t;s=n.e.DoubleTryParse(this.GridData[a].Qty),h++,2==this.QtyType&&1==h?t=e:(t=this.Parent.ScreenObject.GridDataObj.NewRow(),2==this.QtyType?c+h-1>this.Parent.ScreenObject.GridData.length?this.Parent.ScreenObject.GridDataObj.addRow(t):this.Parent.ScreenObject.GridDataObj.insertRowAt(t,c+h-1):this.Parent.ScreenObject.GridDataObj.insertRowAt(t,c),2==this.QtyType?this.FillDatarow(t,e):(t.ProductID_Key=this.GridData[a].ProductID.toString(),t.Quantity=s,this.Parent.ProdID=0,this.Parent.AddProductData(t,!1,!1,!1,null,null))),this.Parent.ScreenObject.GridDataColumns.Contains("BOEAdjusted")&&(t.BOEAdjusted="1"),t.Quantity=2==this.QtyType&&i>0&&1==h?parseFloat(this.GridData[a].Qty)+i:this.GridData[a].Qty.toString(),this.FillData(t,a,u,s)}(h>1||7==this.QtyType)&&this.Parent.ScreenObject.UpdateSequence()}FillDatarow(e,t){var s=this.Parent.ScreenObject.GridDataColumns;for(let i=0;i<s.length;i++)"BinsXML"!=s[i]&&"DocExtraXML"!=s[i]&&"BOEID"!=s[i]&&(e[i]="DocDetailsID"==s[i]||"TODocDetailsID"==s[i]?0:t[i])}FillData(e,t,s,i){let r="";if(r+='<DocExtraXML><Row  RefID="'+this.GridData[t].RefID.toString()+'" ',r+='Qty="'+i+'" Type="',this.Parent.ScreenObject.Preferences.ContainsKey("BOEInv")&&"True"==this.Parent.ScreenObject.Preferences.BOEInv?r+="11":r+=this.GridData[t].Type.toString(),r+='" /></DocExtraXML>',n.e.IsEmpty(e.UOMConversion)&&(e.UOMConversion="1"),e.UOMConvertedQty=n.e.IsEmpty(e.UOMConversion)||n.e.IsEmpty(e.Quantity)?e.Quantity:parseFloat(e.UOMConversion)*parseFloat(e.Quantity),e.DocExtraXML=r.toString(),e.BOEID=this.GridData[t].RefID.toString(),s.Tables.length>0&&s.Columns[0].Contains("ColID")&&s.Tables[0].length>0)for(let a=0;a<s.Tables[0].length;a++)this.GridDataObj.TableColumns.Contains(s.Tables[0][a].ReportCol.toString())&&(this.GridDataObj.TableColumns.Contains(s.Tables[0][a].ReportCol.toString()+"_ID")&&!n.e.IsEmpty(this.GridData[t][s.Tables[0][a].ReportCol.toString()+"_ID"])?this.Parent.ScreenObject.SetValueBYCOLID(s.Tables[0][a].ColID.toString(),this.GridData[t][s.Tables[0][a].ReportCol.toString()].toString(),this.GridData[t][s.Tables[0][a].ReportCol.toString()+"_ID"].toString(),e):this.Parent.ScreenObject.SetValueBYCOLID(s.Tables[0][a].ColID.toString(),this.GridData[t][s.Tables[0][a].ReportCol.toString()].toString(),"",e));if(7==this.QtyType&&this.GridData[t].ProductID.toString()==this.Parent.ScreenObject.TempProductID.toString()){var l=this.Parent.ScreenObject.ColumnSource.find(e=>!n.e.IsEmpty(e.ValueMember)&&"productid_key"==e.ValueMember.toLowerCase()&&!n.e.IsEmpty(e.Shortcut)&&"lostfocus"==e.Shortcut.toLowerCase());l&&this.Parent.ScreenObject.GetExternalFuncData(l.Mode,l.SPName,l.IPParams,l.OPParams,e)}if(this.Parent.CalculateTotals(e,!1,"",!1),!(this.Parent.ScreenObject.Preferences.ContainsKey("BOEInv")&&"True"==this.Parent.ScreenObject.Preferences.BOEInv||this.Parent.ScreenObject.Preferences.ContainsKey("BinvInv")&&"True"==this.Parent.ScreenObject.Preferences.BinvInv)){if(this.Parent.ScreenObject.Preferences.ContainsKey("ClubBoe")&&"True"==this.Parent.ScreenObject.Preferences.ClubBoe&&!this.SelectedRowEditing&&Object(o.j)(e.BinWise))if(null==this.dtBins){let s=this.Parent.ScreenObject.GetinvBinDetails(this.GridData[t].RefID.toString(),e.ProductID_Key.toString(),e.LinkedInvDocDetailsID.toString());this.FillBins(s,0,this.GridData[t].RefID.toString())}else if(0==(c=this.dtBins.filter(e=>e.InvID==this.GridData[t].RefID)).length){let s=this.Parent.ScreenObject.GetinvBinDetails(this.GridData[t].RefID.toString(),e.ProductID_Key.toString(),e.LinkedInvDocDetailsID.toString());this.FillBins(s,0,this.GridData[t].RefID.toString())}if(2==this.QtyType&&null!=this.dtBins){let s=0,r=0,o=0,l=0,u=0,d=!1;if(a.a.SessionManager.Preferences.ContainsKey("DimensionwiseBins")&&""!=a.a.SessionManager.Preferences.DimensionwiseBins.toString()&&(r=n.e.IntTryParse(a.a.SessionManager.Preferences.DimensionwiseBins),r>0)){s=1;for(let e=0;e<this.Parent.ScreenObject._CCFields.length;e++){let t=this.Parent.ScreenObject._CCFields[e];if(t instanceof m.b&&t.CCID==r){t.SelectedValue>0&&(s=t.SelectedValue),d=!0;break}}d||null!=this.SelectedRow&&r>5e4&&this.Parent.ScreenObject.GridDataObj.TableColumns.Contains("dcCCNID"+(r-5e4).toString()+"_Key")&&n.e.Int(e["dcCCNID"+(r-5e4).toString()+"_Key"])>0&&(s=parseInt(e["dcCCNID"+(r-5e4).toString()+"_Key"]))}if(n.e.IsEmpty(e.DocDetailsID)||(o=parseInt(e.DocDetailsID)),!(r>5e4)||this.Parent.ScreenObject.IsBinWise(r,s)){this.Parent.ScreenObject.Preferences.ContainsKey("BinFilterDim")&&!n.e.IsEmpty(this.Parent.ScreenObject.Preferences.BinFilterDim)&&(u=n.e.IntTryParse(this.Parent.ScreenObject.Preferences.BinFilterDim),u>0&&(l=this.Parent.GetDimValue(u,e)));let a=this.Parent.VoucherType;30==this.Parent.ScreenObject.DocumentType&&this.Parent.ScreenObject.GridDataObj.TableColumns.Contains("VoucherType")&&!n.e.IsEmpty(e.VoucherType)&&(a=parseInt(e.VoucherType));let o=0;-1!=a||n.e.IsEmpty(e.LinkedInvDocDetailsID)||(o=n.e.IntTryParse(e.LinkedInvDocDetailsID));let d=this.Parent.ScreenObject.GetProductwiseBins(parseInt(e.ProductID_Key),this.Parent.ScreenObject.DocID,a,this.Parent.DocumentDate,r,s,u,l,o,0,0,this.Parent.GetBOEIDS(e)),D=new oe.a(this.Parent,a,i,parseInt(e.ProductID_Key),e.ProductName.toString(),d,e);for(let e=0;e<D.BinsGrid.Table.length;e++)n.e.IsEmpty(D.BinsGrid.Table[e].NodeID)||n.e.IsEmpty(D.BinsGrid.Table[e].Allocate)||(i-=parseFloat(D.BinsGrid.Table[e].Allocate));var c=this.dtBins.filter(e=>e.InvID==this.GridData[t].RefID);for(let e=0;e<c.length;e++){var h;if((h=this.dtBinsColumns.Contains("InvDocDetailsID")&&D.BinsGrid.TableColumns.Contains("InvID")?D.BinsGrid.Table.filter(t=>t.NodeID==c[e].BinID&&t.InvID==c[e].InvDocDetailsID):D.BinsGrid.Table.filter(t=>t.NodeID==c[e].BinID)).length>0&&i>0)if(n.e.IsEmpty(h[0].Allocate))i>parseFloat(c[e].Qty)?(h[0].Allocate=c[e].Qty.toString(),D.celledtiend(h[0]),i-=parseFloat(h[0].Allocate)):(h[0].Allocate=i,D.celledtiend(h[0]),i-=parseFloat(h[0].Allocate));else{let t=parseFloat(h[0].Allocate);i>parseFloat(c[e].Qty)?(h[0].Allocate=t+parseFloat(c[e].Qty),D.celledtiend(h[0]),i-=parseFloat(h[0].Allocate)-t):(h[0].Allocate=t+i,D.celledtiend(h[0]),i-=parseFloat(h[0].Allocate)-t)}}D.OnSave("AutoSave")}}}}OnButtonClick(e){if(null!=e&&"Cancel"==e.toString())a.a.page.HideDialog();else if(null!=e&&"Load"==e.toString()){let e=this.LoadBoes("",this.Parent.SelectedRow);this.FillBoeData(e)}else null!=e&&"AutoAdjust"==e.toString()?this.DoAutoAdjustments():"ParentImportBtn"==e.toString()?this.ImportScrVisibility=!0:"openfile"==e.toString()||"Open"==e.toString()||("SubImportBtn"==e.toString()?this.ImportData():"CancelImport"==e.toString()&&(this.ImportScrVisibility=!1));if(null!=e&&"OK"==e.toString()||"AutoResave"==e.toString()){if(1==this.QtyType){let e=this.Parent.SelectedRow;for(let s=0;s<this.ColumnSource.length;s++){let i="";if(this.ColumnSource[s].Action>0?i="dcNum"+this.ColumnSource[s].Action:-2==this.ColumnSource[s].Action?i="Quantity":-3==this.ColumnSource[s].Action?i="Rate":-4==this.ColumnSource[s].Action&&(i="Gross"),""!=i){let a=0;for(let e=0;e<this.GridData.length;e++)n.e.IsEmpty(this.GridData[e][this.ColumnSource[s].DisplayMember])||(a+=parseFloat(this.GridData[e][this.ColumnSource[s].DisplayMember]));if(!n.e.IsEmpty(e[i])&&parseFloat(e[i]).ToString("N0")!=a.ToString("N0")){var t=this.Parent.ScreenObject.ColumnSource.find(e=>e.DisplayMember.toLowerCase()==i.toLowerCase());return void(this.DisplayMessage=this.ColumnSource[s].Header+" is not equal to "+t.Header)}}}if(e.QtyXML=this.GetXml("QtyAdjustments",null,""),this.Parent.ScreenObject.Preferences.ContainsKey("QtyAdjustmentField")&&""!=this.Parent.ScreenObject.Preferences.QtyAdjustmentField&&this.Parent.ScreenObject.GridDataObj.TableColumns.Contains(this.Parent.ScreenObject.Preferences.QtyAdjustmentField)){var s=this.ColumnSource.find(e=>1==e.IsReEvaluate);s&&!n.e.IsEmpty(s.footer)&&(e[this.Parent.ScreenObject.Preferences.QtyAdjustmentField]=s.footer)}}else if(0==this.QtyType){let e,t=null;n.e.IsType(this.Parent,"AddEditDocumentViewModel")?(t=this.Parent.SelectedRow,e=this.Parent.ScreenObject.GridDataObj.TableColumns):this.Parent instanceof re&&(t=this.Parent.SelectedRow,e=this.Parent.GridDataObj.TableColumns);for(let s=0;s<this.GridData.length;s++)n.e.IsEmpty(this.GridData[s].Name)||n.e.IsEmpty(this.GridData[s].Amount)||(t[this.GridData[s].Name.toString()]=this.GridData[s].Amount,e.Contains("dcCalc"+this.GridData[s].Name.toString())&&(t["dcCalc"+this.GridData[s].Name.toString()]=this.GridData[s].CalcAmount));n.e.IsType(this.Parent,"AddEditDocumentViewModel")?this.Parent.CalculateTotals(t,!1):this.Parent instanceof re&&this.Parent.Parent.CalculateTotals(t,!1)}else if(2==this.QtyType||7==this.QtyType){if(this.DisplayMessage="",this.SaveBoe_Empty(),""!=this.DisplayMessage)return}else if(3==this.QtyType){if(this.PackWise&&!this.IsSingleProd){if(this.TextFields.length<12)return;this.Parent.DtPack.Clear();for(let e=0;e<this.Parent.ScreenObject.GridData.length;e++)this.Parent.ScreenObject.GridData[e].PackXML=null;for(let e=0;e<this.GridData.length;e++){let t=this.GridData[e],s=[];if(s.ID=t.RefID,s.Name=t.Name,s.Label=t.Label,s.cWeight=t.cWeight,s.cVolume=t.cVolume,s.Weight=t.Weight,s.Volume=t.Volume,s.length=t.length,s.Width=t.width,s.Height=t.height,s.Data=t.Data,!n.e.IsEmpty(t.Data)){let e=t.Data.toString().split(",");for(let s=0;s<e.length;s++){let i=e[s].split("~"),a=this.Parent.ScreenObject.GridData.filter(e=>e.Unq==i[0]);if(a.length>0){let e="";e+="<Row ",n.e.IsEmpty(t.length)||(e+=' Fld1="'+t.length.toString()+'" '),n.e.IsEmpty(t.Width)||(e+=' Fld2="'+t.Width.toString()+'" '),n.e.IsEmpty(t.Height)||(e+=' Fld3="'+t.Height.toString()+'" '),n.e.IsEmpty(t.ActualWeight)||(e+=' Fld4="'+t.ActualWeight.toString()+'" '),n.e.IsEmpty(t.ActualVolume)||(e+=' Fld5="'+t.ActualVolume.toString()+'" '),e+=' Type="2" ',e+=' Label="'+t.Label.toString()+'" ',e+=' RefID="'+t.RefID.toString()+'" ',e+=' Qty="'+i[1]+'" ',e+=' Volume="'+t.Weight.toString()+'" ',e+=' Weight="'+t.Volume.toString()+'" ',e+=" />",a[0].PackXML=n.e.IsEmpty(a[0].PackXML)?e.toString():a[0].PackXML.toString()+e.toString()}}}n.e.IsEmpty(t.ActualWeight)||(s.ActualWeight=t.ActualWeight),n.e.IsEmpty(t.ActualVolume)||(s.ActualVolume=t.ActualVolume),this.Parent.DtPack.push(s)}for(let e=0;e<this.Parent.ScreenObject.GridData.length;e++)n.e.IsEmpty(this.Parent.ScreenObject.GridData[e].PackXML)||(this.Parent.ScreenObject.GridData[e].PackXML="<DocExtraXML>"+this.Parent.ScreenObject.GridData[e].PackXML.toString()+"</DocExtraXML>")}else{var i=this.GridData.Compute("sum","Qty");if(null==i||n.e.Double(i)!=n.e.Double(this.Parent.SelectedRow.Quantity))return void(this.DisplayMessage="Quantity not equal");let e="";this.PackWise&&this.IsSingleProd&&(e=this.Parent.SelectedRow.Unq.toString());let t="";this.GridData.forEach(e=>{n.e.IsEmpty(e.Qty)||(t+="<Row ",n.e.IsEmpty(e.length)||(t+=' Fld1="'+e.length.toString()+'" '),n.e.IsEmpty(e.Width)||(t+=' Fld2="'+e.Width.toString()+'" '),n.e.IsEmpty(e.Height)||(t+=' Fld3="'+e.Height.toString()+'" '),n.e.IsEmpty(e.ActualWeight)||(t+=' Fld4="'+e.ActualWeight.toString()+'" '),n.e.IsEmpty(e.ActualVolume)||(t+=' Fld5="'+e.ActualVolume.toString()+'" '),t+=' Type="'+e.Type.toString()+'" ',t+=' Label="'+e.Label.toString()+'" ',t+=' RefID="'+e.RefID.toString()+'" ',t+=' Qty="'+e.Qty.toString()+'" ',t+=' Volume="'+this.Vol+'" ',t+=' Weight="'+this.Wt+'" ',t+=" />")}),t.length>0&&(t="<DocExtraXML>"+t+"</DocExtraXML>"),this.Parent.SelectedRow.PackXML=t.toString();for(let s=0;s<this.GridData.length;s++){let t,i=this.GridData[s],a=this.Parent.DtPack.filter(e=>e.Label==i.Label.toString());if(a.length>0){if(t=a[0],t.cWeight=i.cWeight,t.cVolume=i.cVolume,this.IsSingleProd){if(this.Parent.DtPackColumns.Contains("Data")&&t.Data.toString().Contains(e+"~")){let s=t.Data.toString().indexOf(e+"~"),i=t.Data.toString().indexOf(",",s);t.Data=i>0?t.Data.toString().Remove(s,i-s+1):s>0?t.Data.toString().Remove(s-1):null}n.e.Double(i.Qty)>0&&(t.Data=n.e.IsEmpty(t.Data)?e+"~"+i.Qty.toString():t.Data.toString()+","+e+"~"+i.Qty.toString())}}else t={},t.ID=i.RefID,t.Name=i.Name,t.Label=i.Label,t.cWeight=i.cWeight,t.cVolume=i.cVolume,t.Weight=i.Weight,t.Volume=i.Volume,t.length=i.length,t.Width=i.width,t.Height=i.height,this.IsSingleProd&&this.Parent.DtPackColumns.Contains("Data")&&parseFloat(i.Qty)>0&&(t.Data=e+"~"+i.Qty.toString()),this.Parent.DtPack.push(t)}}let e=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&55848==e.LinkData);var r,o;e.length>0&&(r=this.Parent.ScreenObject._TextFields.find(t=>t.DBColumnID.toString()==e[0].CostCenterColID.toString()))&&r instanceof u.d&&(r.Text=this.Parent.DtPack.length.toString()),e=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&55849==e.LinkData),e.length>0&&(r=this.Parent.ScreenObject._TextFields.find(t=>t.DBColumnID.toString()==e[0].CostCenterColID.toString()))&&r instanceof u.d&&null!=(o=this.Parent.DtPack.Compute("sum","ActualWeight"))&&(r.Text=o.toString()),e=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&56672==e.LinkData),e.length>0&&null!=(r=this.Parent.ScreenObject._TextFields.find(t=>t.DBColumnID.toString()==e[0].CostCenterColID.toString()))&&r instanceof u.d&&this.Parent.DtPackColumns.Contains("ActualVolume")&&null!=(o=this.Parent.DtPack.Compute("sum","ActualVolume"))&&(r.Text=o.toString())}else if(4==this.QtyType){let e;if(!n.e.IsNum(this.TextFields[1].Text))return void(this.DisplayMessage="Enter valid iteration");{e=parseFloat(this.TextFields[1].Text);let t="";this.GridData.forEach(s=>{t+="<Row ",t+=' RefID="'+s.RefID.toString()+'" ',t+=' Type="3" ',t+=' Qty="'+s.SampleNo.toString()+'" ',n.e.IsEmpty(s.Retest)||(t+=' Label="'+s.Retest.toString()+'" '),a.a.SessionManager.Preferences.ContainsKey("QCLabNameDimension")&&!n.e.IsEmpty(a.a.SessionManager.Preferences.QCLabNameDimension)&&0!=parseInt(a.a.SessionManager.Preferences.QCLabNameDimension)&&(n.e.IsEmpty(s.LabName_Key)||(t+=' LabID="'+s.LabName_Key.toString()+'" '),n.e.IsEmpty(s.ReportNo)||(t+=' ReportNo="'+s.ReportNo.toString()+'" '),n.e.IsEmpty(s.ReportDate_Key)||(t+=' ReportDate="'+new Date(s.ReportDate_Key).ToString("dd MMM yyyy")+'" ')),n.e.IsEmpty(s.Unit_Key)||(t+=' Unit="'+s.Unit_Key.toString()+'" '),n.e.IsEmpty(s.Remarks)||(t+=' Remarks="'+u.d.GetValidXml(s.Remarks.toString())+'" ');for(let i=0;i<parseInt(e);i++)this.GridDataObj.TableColumns.Contains("Result"+(i+1))&&(t+=" Fld"+i+'1="'+u.d.GetValidXml(s["Result"+(i+1)])+'" ');t+=" />"}),t.length>0&&(t="<DocExtraXML>"+t+"</DocExtraXML>"),this.Parent.SelectedRow.TestCaseXML=t.toString(),this.TextFields.length>2&&this.TextFields[2]instanceof D.h&&(this.Parent.SelectedRow[this.TextFields[2].DBColumnName]=this.TextFields[2].Text)}}if(5==this.QtyType){let e="";this.SetColSize=!0,e+="&lt;XML",n.e.IsEmpty(this.TextFields[0].SelectedValue)||(e+=" ProdList='"+this.TextFields[0].SelectedValue+"'"),e+=" &gt;",this.ColumnSource.forEach(t=>{e+="&lt;Row Name='"+t.ValueBinding+"' WIDTH='"+t.Width,this.GridData.length>0&&(e+="' Visible='"+this.GridData[0][t.ValueBinding].toString()),e+="' Header='"+t.Header+"' index='"+t.DisplayIndex+"' /&gt;"}),e+="&lt;/XML&gt;"}"AutoResave"!=e.toString()&&a.a.page.HideDialog()}}ImportData(){}DoAutoAdjustments(){if(1==this.QtyType){let e=this.Parent.SelectedRow,t=0,s=0,i=0,a="",r="",o="0",l="0";for(let c=0;c<this.GridData.length;c++)for(let h=0;h<this.ColumnSource.length;h++){let u="";this.ColumnSource[h].Action>0?u="dcNum"+this.ColumnSource[h].Action:-2==this.ColumnSource[h].Action?u="Quantity":-3==this.ColumnSource[h].Action?u="Rate":-4==this.ColumnSource[h].Action&&(u="Gross"),-5==this.ColumnSource[h].Action&&(l=this.ColumnSource[h].DecimalPoints,r=this.ColumnSource[h].DisplayMember),""!=u&&(o=this.ColumnSource[h].DecimalPoints,a=this.ColumnSource[h].DisplayMember,0==c&&(n.e.IsEmpty(e[u])||(t=parseFloat(e[u].toString()))),null!=this.GridData[c][this.ColumnSource[h].DisplayMember]&&null!=this.GridData[c][this.ColumnSource[h].DisplayMember]&&""!=this.GridData[c][this.ColumnSource[h].DisplayMember].toString()&&0!=parseFloat(this.GridData[c][a].toString())&&(""!=r&&(this.GridData[c][r]=0,this.ExecuteFormulas(this.GridData[c]),this.ExecuteFormulas(this.GridData[c])),s+=parseFloat(this.GridData[c][this.ColumnSource[h].DisplayMember].toString()),i++))}if(i>0){let e=0,n=0,r=0,o=s-t;if(0!=o){n=parseFloat((Math.abs(o)/i).ToString("N"+l)),r=0;for(let t=0;t<this.GridData.length;t++)if(null!=this.GridData[t][a]&&null!=this.GridData[t][a]&&""!=this.GridData[t][a].toString()&&0!=parseFloat(this.GridData[t][a].toString())){e++;for(let s=0;s<this.ColumnSource.length;s++)-5==this.ColumnSource[s].Action&&(this.GridData[t][this.ColumnSource[s].DisplayMember]=e==i?o>0?-1*(o-r):Math.abs(o)-r:o>0?-1*n:n,r+=n,this.ExecuteFormulas(this.GridData[t]),this.ExecuteFormulas(this.GridData[t]))}}}}}GetXml(e,t,s){let i,a,r="";return this.GridData.forEach(e=>{if(a=0,i="",""==s||!n.e.IsEmpty(e[s])){for(let s=0;s<this.ColumnSource.length;s++)null!=t&&!t.Contains(this.ColumnSource[s].DisplayMember)||n.e.IsEmpty(e[this.ColumnSource[s].DisplayMember])||(1!=this.QtyType||"LISTBOX"!=this.ColumnSource[s].DataType||n.e.IsEmpty(e[this.ColumnSource[s].ValueMember])?i+="FLOAT"==this.ColumnSource[s].DataType?this.ColumnSource[s].DisplayMember+'="'+e[this.ColumnSource[s].DisplayMember].toString().Replace(",","")+'" ':this.ColumnSource[s].DisplayMember+'="'+e[this.ColumnSource[s].DisplayMember].toString()+'" ':(i+=this.ColumnSource[s].DisplayMember+'="'+e[this.ColumnSource[s].ValueMember].toString()+'" ',i+=this.ColumnSource[s].ValueMember+'="'+u.d.GetValidTextXml(e[this.ColumnSource[s].DisplayMember])+'" '),a++);1==this.QtyType&&(n.e.IsEmpty(e.Islinked)?i+='Islinked="0"':i+='Islinked="1"')}a>0&&(i="<Row "+i,3==this.QtyType&&(i+=' Volume="'+this.Vol+'" ',i+=' Weight="'+this.Wt+'" '),i+=" />",r+=i.toString())}),r.length>0&&(r="<"+e+">"+r+"</"+e+">"),r.toString()}ScanMobile(e){this.TextFields.length>0&&null!=this.TextFields[0]&&"Enter"==e&&this.MainScan()}}var ce=s("G0MU"),he=s("F3jS"),ue=s("keYA"),de=s("iR3C"),De=s("N0aR"),Se=s("4/f/"),me=s("EUZL");let be=(()=>{class e extends l.b{constructor(t,s,i,r,l){super(),this.BindingPath="",this.AssetQty=0,this.Vtype=0,this.drSel=null,this.AvailableStatusID=0,this.SoldStatusID=0,this.dtSerials=[],this.dtProdSerial=[],this.GridDataObj=new F.a,this.SerialNumber=new u.d(0),this.Qty=new u.d(0),this.Separator=new u.d(0),this.MultiVisiblility=!1,this.Scanmulitple=!1,this.AddVisiblility=!1,this._SelectALL=!1,this.ActualFileName="",this.ExcelData=[],this.SerialNumber.Label=a.a.GetResource("SerialNo"),this.Qty.Label=a.a.GetResource("SerialNo_Qty"),this.Separator.Label="Separator",this.GridDataObj.Columns=[],this.GridDataObj.SelectAll.Visible=!0,this.Vtype=i,this.BindingPath=s,this.Qty.DataType="INT",this.Qty.Text="1",this.AssetQty=r,this.drSel=l,this.Parent=t,this.Parent.ScreenObject.GridDataColumns.Contains("ProductName")?this.pName=l.ProductName.toString():this.Parent.ScreenObject.GridDataColumns.Contains("ProductCode")&&(this.pName=l.ProductCode.toString()),1==this.Vtype||-1==this.Vtype?(this.Qty.Visible=!0,this.AddVisiblility=!0,e.SearchVisibility=!1,this.Title=a.a.GetResource("SerialNo_Title")):(this.Qty.Visible=!1,this.AddVisiblility=!1,e.SearchVisibility=!0,this.Title=a.a.GetResource("SelectSerialNo"));let c=0,h=0;var d;a.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&Object(o.j)(a.a.SessionManager.Preferences.EnableDivisionWise)&&a.a.SessionManager.Preferences.ContainsKey("DW SNOS")&&Object(o.j)(a.a.SessionManager.Preferences["DW SNOS"])&&(this.Parent.ScreenObject.Preferences.ContainsKey("Donotusedivision")&&""!=this.Parent.ScreenObject.Preferences.Donotusedivision&&Object(o.j)(this.Parent.ScreenObject.Preferences.Donotusedivision)?(d=this.Parent.ScreenObject._CCFields.find(e=>"dcccnid1"==e.DBColumnName.toLowerCase()))&&d instanceof m.b&&d.SelectedValue>0?h=d.SelectedValue:null==l||n.e.StringIsNullOrEmpty(l.dcCCNID1_Key)||(h=parseInt(l.dcCCNID1_Key.toString())):h=this.Parent.ScreenObject.DivisionID>0?this.Parent.ScreenObject.DivisionID:a.a.SessionManager.DivisionID),a.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&Object(o.j)(a.a.SessionManager.Preferences.EnableLocationWise)&&a.a.SessionManager.Preferences.ContainsKey("LW SNOS")&&Object(o.j)(a.a.SessionManager.Preferences["LW SNOS"])&&(this.Parent.ScreenObject.Preferences.ContainsKey("Donotuselocation")&&""!=this.Parent.ScreenObject.Preferences.Donotuselocation&&Object(o.j)(this.Parent.ScreenObject.Preferences.Donotuselocation)?(d=this.Parent.ScreenObject._CCFields.find(e=>"dcccnid2"==e.DBColumnName.toLowerCase()))&&d instanceof m.b&&d.SelectedValue>0?c=d.SelectedValue:null==l||n.e.StringIsNullOrEmpty(l.dcCCNID2_Key)||(c=parseInt(l.dcCCNID2_Key.toString())):c=this.Parent.ScreenObject.LocationID>0?this.Parent.ScreenObject.LocationID:a.a.SessionManager.LocationID),this.Parent.ScreenObject.Preferences.ContainsKey("ScanMultiple")&&""!=this.Parent.ScreenObject.Preferences.ScanMultiple&&(this.MultiVisiblility=Object(o.j)(this.Parent.ScreenObject.Preferences.ScanMultiple),this.MultiVisiblility&&(this.Scanmulitple=!0)),this.Parent.ScreenObject.Preferences.ContainsKey("DefaultDelimiter")&&""!=this.Parent.ScreenObject.Preferences.DefaultDelimiter&&(this.Separator.Text=this.Parent.ScreenObject.Preferences.DefaultDelimiter.length>1?this.Parent.ScreenObject.Preferences.DefaultDelimiter[0].toString():this.Parent.ScreenObject.Preferences.DefaultDelimiter);let D=!1;this.Parent.ScreenObject.Preferences.ContainsKey("DocwiseSNo")&&Object(o.j)(this.Parent.ScreenObject.Preferences.DocwiseSNo)||1!=i||(D=!0),6!=this.Parent.ScreenObject.DocumentType&&39!=this.Parent.ScreenObject.DocumentType||(D=!1);let S=0;n.e.StringIsNullOrEmpty(l.DocDetailsID)||(S=parseInt(l.DocDetailsID)),this.ds=a.a.document.GetSerialNumberScreenDetails(parseInt(l.ProductID_Key),S,this.Parent.ScreenObject.DocID,h,c,D);let b,C=this.Parent.ScreenObject.GridData.filter(e=>e.ProductID_Key==l.ProductID_Key&&e.DocSeqNo!=l.DocSeqNo);if(C.length>0&&C.forEach(e=>{let t=new n.f;n.e.StringIsNullOrEmpty(e.ExtraXML)||(t.ReadXml(e.ExtraXML.toString()),t.Tables.length>0&&t.Tables[0].length>0&&t.Tables[0].forEach(e=>{this.dtSerials.push(e)}))}),this.ds.Tables.length>1)for(let e=0;e<this.ds.Tables[0].length;e++)"Available"==n.e.StringValue(this.ds.Tables[0][e].ActualStatus)?this.AvailableStatusID=parseInt(this.ds.Tables[0][e].StatusID.toString()):"Sold"==n.e.StringValue(this.ds.Tables[0][e].ActualStatus)&&(this.SoldStatusID=parseInt(this.ds.Tables[0][e].StatusID.toString()));if(this.ds.Tables.length>2&&this.ds.Columns[2].length>0&&(this.dtProdSerial=this.ds.Tables[2]),this.SerialNumber.TextChangedCommand.Subscribe(this,"OnSerialScanned"),1==this.Vtype?(b=new y.a,b.Header=a.a.GetResource("UOM_Sno"),b.DisplayMember="Sno",b.DataType="TextBlock",b.ReadOnly=!0,b.Width=50,b.DisableTab=!0,this.ColumnSource.push(b),this.GridDataObj.TableColumns.push("Sno")):(b=new y.a,b.Header=a.a.GetResource("SerialNo_Select"),b.DisplayMember="Select",b.DataType="CheckBox",b.Width=30,b.CheckedChanged.Subscribe(this,"OnCheckedChanged"),this.ColumnSource.push(b),this.GridDataObj.TableColumns.push("Select")),b=new y.a,b.Header="SerialProductID",b.DisplayMember="SerialProductID",b.DataType="TextBlock",b.Width=0,b.IsVisible=!1,this.ColumnSource.push(b),this.GridDataObj.TableColumns.push("SerialProductID"),b=new y.a,b.Header=a.a.GetResource("Document_SerialNumber"),b.DisplayMember="SerialNumber",b.ReadOnly=!0,b.DataType="TextBlock",b.Width=250,this.ColumnSource.push(b),this.GridDataObj.TableColumns.push("SerialNumber"),b=new y.a,b.Header=a.a.GetResource("Document_Status"),b.DisplayMember="Status",b.ValueBinding="StatusID",b.ValueMember="StatusID",this.ds.Tables.length>1&&(b.ComboData=this.ds.Tables[0]),b.DataType="ComboBox",b.Width=76,b.ReadOnly=!0,b.DisableTab=!0,"RecievedQty"==this.BindingPath&&(b.IsVisible=!1),this.ColumnSource.push(b),this.GridDataObj.TableColumns.push("StatusID"),b=new y.a,b.Header="SerialGUID",b.DisplayMember="SerialGUID",b.DataType="TextBlock",b.Width=0,b.IsVisible=!1,b.ReadOnly=!0,b.DisableTab=!0,this.ColumnSource.push(b),this.GridDataObj.TableColumns.push("SerialGUID"),b=new y.a,b.Header="RefInvDocDetailsID",b.DisplayMember="RefInvDocDetailsID",b.DataType="TextBlock",b.Width=0,b.IsVisible=!1,b.ReadOnly=!0,b.DisableTab=!0,this.ColumnSource.push(b),this.GridDataObj.TableColumns.push("RefInvDocDetailsID"),b=new y.a,b.Header="IsAvailable",b.DisplayMember="IsAvailable",b.DataType="TextBlock",b.Width=0,b.IsVisible=!1,b.ReadOnly=!0,b.DisableTab=!0,this.ColumnSource.push(b),this.GridDataObj.TableColumns.push("IsAvailable"),-1==this.Vtype&&this.ds.Tables.length>1&&"RecievedQty"!=this.BindingPath)for(let e=0;e<this.ds.Tables[1].length;e++){let t=this.GridDataObj.NewRow();for(let s=1;s<this.ds.Columns[1].length;s++)this.GridDataObj.TableColumns.Contains(this.ds.Columns[1][s])&&(t[this.ds.Columns[1][s]]=this.ds.Tables[1][e][this.ds.Columns[1][s]]);this.GridDataObj.TableColumns.Contains("Select")&&(t.Select=!1),t.RefInvDocDetailsID=this.ds.Tables[1][e].InvDocDetailsID,t.SerialProductID=0,this.ds.Columns[1].Contains("RefInvDocDetailsID")&&!n.e.StringIsNullOrEmpty(this.ds.Tables[1][e].RefInvDocDetailsID)&&parseInt(this.ds.Tables[1][e].RefInvDocDetailsID)>0&&parseInt(this.ds.Tables[1][e].RefInvDocDetailsID.toString())==S&&(t.StatusID=this.AvailableStatusID),this.GridDataObj.addRow(t)}let p=new n.f;if(null!=this.Parent.SelectedRow){let e=new n.f;if("RecievedQty"==this.BindingPath&&(n.e.StringIsNullOrEmpty(l.RecievedQtyXML)||e.ReadXml(l.RecievedQtyXML.toString())),n.e.StringIsNullOrEmpty(l.ExtraXML))this.QtyAddMessage=this.AssetQty>0?n.e.Format(a.a.GetResource("SerialNo_SelectMessage"),"0",this.AssetQty.toString(),this.pName):this.GridDataObj.TableColumns.Contains("Select")?n.e.Format(a.a.GetResource("SerialNo_SelectMessage"),"0",l[this.BindingPath].toString(),this.pName):n.e.Format(a.a.GetResource("SerialNo_AddMessage"),"0",l.Quantity.toString(),this.pName);else{p.LoadXml(l.ExtraXML.toString());let t=p.SelectNodes("xml/Row");for(let s=0;s<t.length;s++){let i=null;if(this.GridDataObj.TableColumns.Contains("Select"))if("RecievedQty"==this.BindingPath)if(i=this.GridDataObj.NewRow(),e.Tables.length>0&&e.Columns[0].Contains("SerialNumber")&&e.Tables[0].filter(e=>e.SerialNumber==t[s].attributes.SerialNumber.value.toString()).length>0){let a=e.Tables[0].filter(e=>e.SerialNumber==t[s].attributes.SerialNumber.value);i.Select=!0,i.SerialGUID=a[0].SerialGUID.toString(),i.SerialProductID=a[0].SerialProductID.toString()}else i.Select=!1,i.SerialGUID=n.e.NewGuid(),i.SerialProductID=0;else{let e=this.GridData.filter(e=>e.SerialGUID==t[s].attributes.SerialGUID.value.toString());e.length>0&&(i=e[0],i.Select=!0)}else i=this.GridDataObj.NewRow(),i.Sno=(s+1).toString();for(let e=1;e<this.ColumnSource.length;e++)("RecievedQty"!=this.BindingPath||"SerialGUID"!=this.ColumnSource[e].DisplayMember&&"RefInvDocDetailsID"!=this.ColumnSource[e].DisplayMember&&"SerialProductID"!=this.ColumnSource[e].DisplayMember)&&null!=i&&(0==e?i[0]=(this.GridData.length+1).toString():"ComboBox"!=this.ColumnSource[e].DataType||n.e.IsEmpty(t[s].attributes[this.ColumnSource[e].ValueMember])?"ComboBox"==this.ColumnSource[e].DataType||n.e.IsEmpty(t[s].attributes[this.ColumnSource[e].DisplayMember])||(i[this.ColumnSource[e].DisplayMember]=t[s].attributes[this.ColumnSource[e].DisplayMember].value):i[this.ColumnSource[e].ValueMember]=t[s].attributes[this.ColumnSource[e].ValueMember].value);"RecievedQty"==this.BindingPath&&(i.StatusID=this.AvailableStatusID),this.GridDataObj.TableColumns.Contains("Select")&&"RecievedQty"!=this.BindingPath||this.GridDataObj.addRow(i)}if(this.QtyAddMessage=this.AssetQty>0?n.e.Format(a.a.GetResource("SerialNo_SelectMessage"),t.length.toString(),this.AssetQty.toString(),this.pName):this.GridDataObj.TableColumns.Contains("Select")?n.e.Format(a.a.GetResource("SerialNo_SelectMessage"),t.length.toString(),l[this.BindingPath].toString(),this.pName):n.e.Format(a.a.GetResource("SerialNo_AddMessage"),t.length.toString(),l[this.BindingPath].toString(),this.pName),"RecievedQty"==this.BindingPath){let t="0";e.Tables.length>0&&e.Columns[0].Contains("SerialGUID")&&(t=e.Tables[0].length.toString()),this.QtyAddMessage=n.e.Format(a.a.GetResource("SerialNo_SelectMessage"),t,l.RecievedQty.toString(),this.pName)}}}this.GridDataObj.RowDeleted.Subscribe(this,"GridData_RowDeleted")}get ColumnSource(){return this.GridDataObj.Columns}get GridData(){return this.GridDataObj.Table}get SelectedRow(){return this.GridDataObj.SelectedItem}set SelectedRow(e){this.GridDataObj.SelectedItem=e}get SelectedRows(){return this.GridDataObj.SelectedRows}get CanRemove(){return null!=this.SelectedRow}get SelectALL(){return this._SelectALL}set SelectALL(e){e!=this._SelectALL&&(this._SelectALL=e,this.CheckAll(e))}get QtyAddMessage(){return n.e.StringIsNullOrEmpty(this._QtyAddMessage)?"asdfasdf":this._QtyAddMessage}set QtyAddMessage(e){this._QtyAddMessage=e}GridData_RowDeleted(e){if(!this.GridDataObj.TableColumns.Contains("Sno"))return;let t=1;this.GridData.forEach(e=>{e.Sno=t++}),this.QtyAddMessage=n.e.Format(a.a.GetResource("SerialNo_AddMessage"),(t-1).toString(),this.drSel[this.BindingPath].toString(),this.pName)}OnSerialScanned(e,t){n.e.StringIsNullOrEmpty(this.SerialNumber.Text)||"13"!=t.keyCode||(1==this.Vtype?(this.OnSave("Add"),this.QtyAddMessage=n.e.Format(a.a.GetResource("SerialNo_AddMessage"),this.GridData.length.toString(),this.drSel.Quantity.toString(),this.pName)):(this.OnSave("Search"),null!=this.SelectedRow&&n.e.StringValue(this.SelectedRow.SerialNumber)==this.SerialNumber.Text&&(this.SelectedRow.Select=!0,this.SerialNumber.Text="",this.cellEditEnd(this.SelectedRow))))}OnCheckedChanged(e){this.cellEditEnd(e.item)}cellEditEnd(e){Object(o.j)(e.Select)?"RecievedQty"==this.BindingPath?(e.StatusID=this.AvailableStatusID,e.IsAvailable=!0):(e.StatusID=this.SoldStatusID,e.IsAvailable=!1):(e.StatusID=this.AvailableStatusID,e.IsAvailable=!0);let t=0;this.GridData.forEach(e=>{Object(o.j)(e.Select)&&t++}),this.QtyAddMessage=n.e.Format(a.a.GetResource("SerialNo_SelectMessage"),t.toString(),this.drSel[this.BindingPath].toString(),this.pName)}OnRemove(e){if(null!=this.SelectedRow)if(null!=this.SelectedRows&&this.SelectedRows.length>1){if(!confirm("Are you sure you want to delete "+this.SelectedRows.length.toString()+" Rows?"))return;this.SelectedRows.forEach(e=>{e&&this.DeleteRow(e)})}else this.DeleteRow(this.SelectedRow)}DeleteRow(e){parseInt(e.StatusID)!=this.AvailableStatusID?this.DisplayMessage=a.a.GetResource("SerialNumber_CanNotRemove"):this.GridDataObj.removeRow(e)}Setselectedrow(e){this.SelectedRow=this.GridData[e]}CheckAll(e){if(this.GridDataObj.TableColumns.Contains("Select"))if(e){let t=0;t="RecievedQty"==this.BindingPath?parseInt(this.drSel.RecievedQty.toString()):this.AssetQty>0?this.AssetQty:parseInt(this.drSel.Quantity.toString());for(let s=0;s<this.GridData.length;s++)this.GridData[s].Select=s<t?e:!e,this.cellEditEnd(this.GridData[s])}else for(let t=0;t<this.GridData.length;t++)this.GridData[t].Select=!1}OnSave(e){if("Search"==e.toString()){if(""!=this.SerialNumber.Text){let e=0,t=0;for(null!=this.SelectedRow&&(t=this.GridData.indexOf(this.SelectedRow)+1);e<this.GridData.length;e++,t++)if(t>=this.GridData.length&&(t=0),this.GridData[t].SerialNumber.toString().Contains(this.SerialNumber.Text))return void this.Setselectedrow(t)}if(""!=this.SerialNumber.Text)if(this.Scanmulitple&&!n.e.IsEmpty(this.Separator.Text)&&this.GridDataObj.TableColumns.Contains("Select")){var t=this.SerialNumber.Text.split(this.Separator.Text[0]);let e=0;for(this.Parent.ScreenObject.Preferences.ContainsKey("IgnoreFirstDelimiter")&&Object(o.j)(this.Parent.ScreenObject.Preferences.IgnoreFirstDelimiter)&&(e=1);e<t.length;e++)for(let e=0;e<this.GridData.length;e++)(t.Contains(this.GridData[e].SerialNumber.toString())||this.GridData[e].SerialNumber.toString().Contains(this.SerialNumber.Text))&&(this.GridData[e].Select=!0,this.GridData[e].StatusID=this.SoldStatusID,this.GridData[e].IsAvailable=!1);e=0,this.GridData.forEach(t=>{Object(o.j)(t.Select.toString())&&e++}),this.QtyAddMessage=n.e.Format(a.a.GetResource("SerialNo_SelectMessage"),e.toString(),this.drSel[this.BindingPath].toString(),this.pName),this.SerialNumber.Text=""}else{let e=0,t=0;for(null!=this.SelectedRow&&(t=this.GridData.indexOf(this.SelectedRow)+1);e<this.GridData.length;e++,t++)if(t>=this.GridData.length&&(t=0),this.GridData[t].SerialNumber.toString().Contains(this.SerialNumber.Text))return void this.Setselectedrow(t)}}else if("Save"==e.toString()){let e="",t="",s=0;t+="<xml>";for(let a=0;a<this.GridData.length;a++)if(!this.GridDataObj.TableColumns.Contains("Select")||Object(o.j)(this.GridData[a].Select.toString())){t+="<Row ";for(let e=1;e<this.ColumnSource.length;e++)t+="ComboBox"==this.ColumnSource[e].DataType?this.ColumnSource[e].ValueMember+'="'+this.GridData[a][this.ColumnSource[e].ValueMember].toString()+'" ':this.ColumnSource[e].DisplayMember+'="'+this.GridData[a][this.ColumnSource[e].DisplayMember].toString()+'" ';t+=" ></Row>",s++,s>1&&(e+=","),e+=this.GridData[a].SerialNumber.toString()}t+="</xml>";let i=!1;if(this.Parent.ScreenObject.Preferences.ContainsKey("QtyOnSerialNo")&&!n.e.IsEmpty(this.Parent.ScreenObject.Preferences.QtyOnSerialNo)&&Object(o.j)(this.Parent.ScreenObject.Preferences.QtyOnSerialNo)&&(i=!0),"RecievedQty"==this.BindingPath)return parseInt(this.drSel.RecievedQty.toString())!=s?void(this.DisplayMessage=a.a.GetResource("SerialNo_QtyMisMatch")):(this.drSel.RecievedQtyXML=t.toString(),this.Parent.DialogResult=!0,void a.a.page.HideDialog());if(this.AssetQty>0){if(this.AssetQty>=1&&this.AssetQty!=s||this.AssetQty<1&&s>1)return void(this.DisplayMessage=a.a.GetResource("SerialNo_QtyMisMatch"))}else if(parseInt(this.drSel[this.BindingPath].toString().Replace("-",""))!=s&&!i)return void(this.DisplayMessage=a.a.GetResource("SerialNo_QtyMisMatch"));this.drSel.ExtraXML=t.toString();let r=this.Parent.ScreenObject.Data.Tables[0];r.length>0&&(r=this.Parent.ScreenObject.Data.Tables[0].filter(e=>79==e.LocalReference&&54308==e.LinkData),r.length>0&&this.Parent.ScreenObject.GridDataColumns.Contains(r[0].SysColumnName.toString())&&(this.drSel[r[0].SysColumnName.toString()]=e)),i&&(this.drSel.Quantity=n.e.IsEmpty(this.drSel.UOMConversion)?s:s/parseFloat(this.drSel.UOMConversion.toString()),this.Parent.CalculateTotals(this.drSel,!1)),this.Parent.DialogResult=!0,a.a.page.HideDialog()}else if("Import"==e.toString())this.importData();else if("Add"==e.toString()){if(null==this.SerialNumber.Text||""==this.SerialNumber.Text||""!=this.Qty.ValidateData())return;if(this.AssetQty>0){if(this.AssetQty>=1&&this.GridData.length>=this.AssetQty||this.AssetQty<1&&this.GridData.length>0)return void(this.DisplayMessage="Qty already adjusted")}else if(this.GridData.length>=parseInt(this.drSel[this.BindingPath].toString().Replace("-","")))return void(this.DisplayMessage="Qty already adjusted");if(this.Scanmulitple&&!n.e.IsEmpty(this.Separator.Text)){t=this.SerialNumber.Text.split(this.Separator.Text[0]);let e=0;for(this.Parent.ScreenObject.Preferences.ContainsKey("IgnoreFirstDelimiter")&&Object(o.j)(this.Parent.ScreenObject.Preferences.IgnoreFirstDelimiter)&&(e=1);e<t.length;e++)if(!n.e.IsEmpty(t[e])){let s=this.GridDataObj.NewRow();s.Sno=(this.GridData.length+1).toString(),s.SerialProductID=0,s.SerialNumber=t[e],s.StatusID=this.AvailableStatusID,s.SerialGUID=n.e.NewGuid(),s.IsAvailable=1,s.RefInvDocDetailsID=0,this.SerialNumber.Text="",this.GridDataObj.addRow(s)}return}if(null==this.Qty.Text||""==this.Qty.Text.trim()||"1"==this.Qty.Text.trim()){if(31!=this.Parent.DocumentType&&32!=this.Parent.DocumentType){if(this.dtSerials.length>0&&this.dtSerials.filter(e=>e.SerialNumber==this.SerialNumber.Text).length>0||this.GridData.filter(e=>e.SerialNumber==this.SerialNumber.Text).length>0)return void(this.DisplayMessage=a.a.GetResource("SerialNo_Duplicate"));if(null!=this.dtProdSerial&&this.dtProdSerial.length>0&&this.dtProdSerial.filter(e=>e.SerialNumber==this.SerialNumber.Text&&e.InvDocDetailsID!=this.drSel.DocDetailsID).length>0)return void(this.DisplayMessage=a.a.GetResource("SerialNo_Duplicate"))}let e=this.GridDataObj.NewRow();return e.Sno=(this.GridData.length+1).toString(),e.SerialProductID=0,e.SerialNumber=this.SerialNumber.Text,e.StatusID=this.AvailableStatusID,e.SerialGUID=n.e.NewGuid(),e.IsAvailable=1,e.RefInvDocDetailsID=0,this.SerialNumber.Text="",void this.GridDataObj.addRow(e)}let e,s=this.SerialNumber.Text,i=1,r=!1;if(null!=s&&""!=s.Trim())for(let t=0;t<s.length;t++)if(!n.e.IsDigit(s[s.length-t-1])){if(t<=15&&(r=!0,t>0)){e=s.substr(s.length-t);for(let s=0;s<e.length&&"0"==e[s];s++)t--;i=parseInt(s.substr(s.length-t)),s=s.substr(0,s.length-t)}break}if(!r&&null!=s&&""!=s.Trim()){let t=s.length;t>15?(t=15,e=s.substr(s.length-t)):e=s;for(let s=0;s<e.length&&"0"==e[s];s++)t--;i=parseInt(s.substr(s.length-t)),s=s.substr(0,s.length-t)}null!=s&&""!=s.Trim()||(s="");for(let t=0;t<parseInt(this.Qty.Text);t++,i++){let e=this.GridDataObj.NewRow();if(31!=this.Parent.DocumentType&&32!=this.Parent.DocumentType){if(this.dtSerials.length>0&&this.dtSerials.filter(e=>e.SerialNumber==s+i.toString()).length>0||this.GridData.filter(e=>e.SerialNumber==s+i.toString()).length>0)return void(this.DisplayMessage=a.a.GetResource("SerialNo_Duplicate"));if(null!=this.dtProdSerial&&this.dtProdSerial.length>0&&this.dtProdSerial.filter(e=>e.SerialNumber==s+i.toString()&&e.InvDocDetailsID!=this.drSel.DocDetailsID).length>0)return void(this.DisplayMessage=a.a.GetResource("SerialNo_Duplicate"))}e.Sno=(this.GridData.length+1).toString(),e.SerialProductID=0,e.SerialNumber=s+i.toString(),e.StatusID=this.AvailableStatusID,e.SerialGUID=n.e.NewGuid(),e.IsAvailable=1,e.RefInvDocDetailsID=0,this.GridDataObj.addRow(e)}this.SerialNumber.Text="",this.Qty.Text=""}else"Cancel"==e.toString()&&(this.Parent.DialogResult=!1,a.a.page.HideDialog(),this.Parent.PopupVisibility=!1);1==this.Vtype&&(this.QtyAddMessage=n.e.Format(a.a.GetResource("SerialNo_AddMessage"),this.GridData.length.toString(),this.drSel[this.BindingPath].toString(),this.pName))}OpenFile(e){if(1!==e.target.files.length)throw new Error("Cannot use multiple files");const t=new FileReader,s=e.target.files[0];this.fileExt=s.name.split(".").pop(),this.fileName=s.name,t.onload=e=>{const s=me.read(t.result,{type:"binary"});if(this.ExcelData=me.utils.sheet_to_json(s.Sheets[s.SheetNames[0]],{header:1}),!n.e.IsEmpty(this.ExcelData)&&this.ExcelData.length>0)try{this.OnSave("Import")}catch(i){return void(this.DisplayMessage=i.Message)}},t.readAsBinaryString(s)}importData(){if(this.DisplayMessage="",null!=this.Separator.Text&&""!=this.Separator.Text){if(""!=this.fileExt)try{let e=this.fileExt,t="";if(t=[],t.length>0&&(".txt"==e||"txt"==e)){let e=t.Split(this.Separator.Text[0]);if(1==this.Vtype){for(let t=0;t<e.length;t++){if(this.dtSerials.length>0&&this.dtSerials.filter(s=>s.SerialNumber==e[t].toString()).length>0||this.GridData.filter(s=>s.SerialNumber==e[t].toString()).length>0)return void(this.DisplayMessage=a.a.GetResource("SerialNo_Duplicate"));let s=this.GridDataObj.NewRow();s.Sno=(this.GridData.length+1).toString(),s.SerialProductID=0,s.SerialNumber=e[t].toString(),s.StatusID=this.AvailableStatusID,s.SerialGUID=n.e.NewGuid(),s.IsAvailable=1,s.RefInvDocDetailsID=0,this.SerialNumber.Text="",this.GridDataObj.addRow(s)}return void(this.Qty.Text=e.length.toString())}if(-1==this.Vtype&&t.length>0){let t,s="";e.forEach(e=>{t=this.GridData.filter(t=>t.SerialNumber==e),0==t.length?s+=e+",":t.forEach(e=>{e.Select=!0})}),s.length>0&&alert("SerialNo's '"+s+"' Not Exists ")}}else if(".xls"==e||".xlsx"==e||"xls"==e||"xlsx"==e)if(this.ActualFileName=this.fileName,this.ExcelTable=this.ExcelData,1==this.Vtype){if(this.ExcelTable.length>0)for(let e=1;e<this.ExcelTable.length;e++){if(this.dtSerials.length>0&&this.dtSerials.filter(t=>t.SerialNumber==this.ExcelTable[e][0].toString()).length>0||this.GridData.filter(t=>t.SerialNumber==this.ExcelTable[e][0].toString()+"'").length>0)return void(this.DisplayMessage=a.a.GetResource("SerialNo_Duplicate"));let t=this.GridDataObj.NewRow();t[0]=this.ExcelTable[e][0],t.Sno=(this.GridData.length+1).toString(),t.SerialProductID=0,t.SerialNumber=this.ExcelTable[e][0].toString(),t.StatusID=this.AvailableStatusID,t.SerialGUID=n.e.NewGuid(),t.IsAvailable=1,t.RefInvDocDetailsID=0,this.SerialNumber.Text="",this.GridDataObj.addRow(t)}}else if(-1==this.Vtype&&null!=this.ExcelTable&&this.ExcelTable.length>0&&this.ExcelTable.length>0){let e,t="";for(let s=1;s<this.ExcelTable.length;s++)e=this.GridData.filter(e=>e.SerialNumber==this.ExcelTable[s][0].toString()),0==e.length?t+=this.ExcelTable[s][0].toString()+",":e.forEach(e=>{e.Select=!0});t.length>0&&alert("SerialNo's '"+t+"' Not Exists ")}}catch(e){throw Logger.ErrorLog("SerialNumberViewModel: OnSave, sender='Import', message="+e),new Error(e)}}else this.DisplayMessage="Enter Separator"}}return e.SearchVisibility=!1,e})();var Ce=s("l/9E"),pe=s("BqqB");class ye extends l.b{constructor(e,t,s){super(),this.GridDataObj=new F.a,this.Parent=null,this.TotalQoh=0,this.Parent=e,this.InitGrid(),null!=e.SelectedRow&&""==s?(e.ScreenObject.GridDataColumns.Contains("Productname")&&(this.Description=this.CatalogCode=e.SelectedRow.Productname.toString()),e.ScreenObject.GridDataColumns.Contains("Productcode")&&(this.ProductCode=e.SelectedRow.Productcode.toString()),this.lblProductCode="Product code",this.lblProductname="Product Name",this.Title=this.DisplayName="Product Files"):n.e.IntTryParse(t[0].FeatureID)>5e4?(this.Description=this.CatalogCode=s,this.lblProductCode="Code",this.lblProductname="Name",this.Title=this.DisplayName="Files"):(this.Description=this.CatalogCode=s,this.lblProductCode="Account code",this.lblProductname="Account Name",this.Title=this.DisplayName="Account Files");for(let i=0;i<t.length;i++){let e=this.GridDataObj.NewRow();e.Select="false",e.ActualFileName=t[i].ActualFileName.toString(),e.FileExtension=t[i].FileExtension.toString(),e.GUID=t[i].GUID.toString(),e.FileDescription=t[i].FileDescription.toString(),e.RelativeFileName=t[i].RelativeFileName.toString(),e.IsProductImage=Object(o.j)(t[i].IsProductImage),e.AllowinPrint=!0,this.GridDataObj.addRow(e)}}get GridData(){return this.GridDataObj.Table}get ColumnSource(){return this.GridDataObj.Columns}InitGrid(){let e;this.GridDataObj.TableColumns.push("IsProductImage"),this.GridDataObj.TableColumns.push("RelativeFileName"),this.GridDataObj.TableColumns.push("FilePath"),this.GridDataObj.TableColumns.push("FileDescription"),this.GridDataObj.TableColumns.push("GUID"),this.GridDataObj.TableColumns.push("FileExtension"),this.GridDataObj.TableColumns.push("ActualFileName"),this.GridDataObj.TableColumns.push("Select"),this.GridDataObj.TableColumns.push("AllowinPrint"),e=new y.a,e.Header="Select",e.DisplayMember="Select",e.DataType="CheckBox",e.Width=50,this.ColumnSource.push(e),e=new y.a,e.Header="FileName",e.DisplayMember="ActualFileName",e.DataType="TextBlock",e.Width=230,e.ReadOnly=!0,this.ColumnSource.push(e),e=new y.a,e.Header="Description",e.DisplayMember="FileDescription",e.DataType="TextBlock",e.Width=100,this.ColumnSource.push(e),e=new y.a,e.Header="Allow Print",e.DisplayMember="AllowinPrint",e.DataType="CheckBox",e.Width=90,this.ColumnSource.push(e)}OnButtonClick(e){return Object(i.b)(this,void 0,void 0,(function*(){if(null!=e&&"Cancel"==e.toString())a.a.page.HideDialog();else if(null!=e&&"OK"==e.toString()){const{AddAttachmentViewModel:e}=yield Promise.resolve().then(s.bind(null,"xnJf"));a.a.page.HideDialog();for(let t=0;t<this.GridData.length;t++)if(Object(o.j)(this.GridData[t].Select)){let s=new e;s.AddAttachmentViewModel_2(this),s.ActualFileName=this.GridData[t].ActualFileName.toString(),s.FileExtension=this.GridData[t].FileExtension.toString(),s.FileDescription=n.e.String(this.GridData[t].FileDescription),s.FilePath=n.e.String(this.GridData[t].FilePath),s.RelativeFileName=n.e.String(this.GridData[t].RelativeFileName),s.AllowInPrintVisible=!0,s.AllowInPrint=Object(o.j)(this.GridData[t].AllowinPrint),s.isfrmProduct=!0,this.Parent.ViewAttachments.AttachmentsListObj.addRow(s)}}}))}}class ge extends l.b{constructor(){super(),this.GridDataObj=new F.a,this.OKVisbile=!1,this.Parent=null,this.Amount=0,this.AdvanceAmt=0,this.ExchRate=0,this.Accountid=0,this.payds=null,this.Decimals="",this.ShowPercentPayTerms=!1,this.DecimalsNetAmount="2",this.NewRefNode=null,this.IsViewScreen=!1,this.Title=a.a.GetResource("Payterm")}get ColumnSource(){return this.GridDataObj.Columns}get GridData(){return this.GridDataObj.Table}get SelectedRow(){return this.GridDataObj.SelectedItem}set SelectedRow(e){this.GridDataObj.SelectedItem=e}set updateFooter(e){this.GridDataObj.UpdateFooter()}PaymentTermsViewModel_1(e,t){this.Parent=e,this.InitGrid(),this.FillDetails(t,!0),this.OKVisbile=!1,this.Name=new u.d(0),this.Name.Label="Name",this.Terms=new D.e(0),this.Terms.Label="Payment Terms";let s=new n.f;""!=t&&s.ReadXml(t),s.Tables.length>0&&s.Columns[0].Contains("ProfileId")&&s.Columns[0].Contains("ProfileName")&&s.Tables[0].length>0&&!n.e.IsEmpty(s.Tables[0][0].ProfileId)&&(this.Terms.Items.push(D.d.ComboBoxItems_2(s.Tables[0][0].ProfileName.toString(),s.Tables[0][0].ProfileId.toString())),this.Terms.SelectedValue=s.Tables[0][0].ProfileId.toString(),this.Name.Text=s.Tables[0][0].ProfileName.toString()),this.filldimensionValues()}PaymentTermsViewModel_2(e,t,s,i,a){Logger.InfoLog("PaymentTermsViewModel::Entering PaymentTermsViewModel"),this.Parent=e,this.Amount=t,this.NewRefNode=a,this.InitGrid(),this.OKVisbile=!0,this.Accountid=s,this.GridDataObj.CellEditEnding.Subscribe(this,"oncelleditEnd"),this.Name=new u.d(0),this.Name.Label="Name",this.Terms=new D.e(0),this.Terms.Label="Payment Terms",this.Terms.SelectionChangedCommand.Subscribe(this,"OnselectionChanged"),this.payds=i;let r=e.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&26425==e.LinkData);if(r.length>0){var l=e.ScreenObject.FooterGridData.filter(e=>e.ColumnName==r[0].SysColumnName);l.length>0&&n.e.IsEmpty(l[0].Amount)&&(this.AdvanceAmt=parseFloat(l[0].Amount))}if(null!=i&&i.Tables.length>2&&i.Tables[1].length>0){if(i.Tables[1].length>0){let t=null;e.ScreenObject.Preferences.ContainsKey("Paytermids")&&""!=e.ScreenObject.Preferences.Paytermids&&(t=e.ScreenObject.Preferences.Paytermids.split(","));for(let e=0;e<i.Tables[1].length;e++)null!=t&&t.length>0&&!t.Contains(i.Tables[1][e].ProfileID.toString())||this.Terms.Items.push(D.d.ComboBoxItems_2(i.Tables[1][e].ProfileName.toString(),i.Tables[1][e].ProfileID.toString()));i.Tables[0].length>0&&(this.Terms.SelectedValue=n.e.StringValue(i.Tables[0][0].PaymentTerms),this.Name.Text=this.Terms.GetText())}e.ScreenObject.Preferences.ContainsKey("accountwisePaymentTerms")&&""!=e.ScreenObject.Preferences.accountwisePaymentTerms&&Object(o.j)(e.ScreenObject.Preferences.accountwisePaymentTerms)&&(this.Terms.Enable=!1)}if(i.Tables.length>3&&i.Tables[3].length>0&&i.Columns[3].Contains("Percentage")){i.Columns[3].Contains("ProfileID")&&!n.e.IsEmpty(i.Tables[3][0].ProfileID)&&(this.Terms.SelectedValue=i.Tables[3][0].ProfileID.toString());let e,t=0;for(let s=0;s<i.Tables[3].length;s++)if(!n.e.IsEmpty(i.Tables[3][s].Percentage)){let a=0;a=t+parseFloat(i.Tables[3][s].Percentage)>100?100-t:parseFloat(i.Tables[3][s].Percentage),t+=a,e=(this.Amount+this.AdvanceAmt)*a/100,this.AddRow(t,e,i.Tables[3][s],parseInt(i.Tables[3][s].days),n.e.StringValue(i.Tables[3][s].dimccid),n.e.StringValue(i.Tables[3][s].dimnodeid))}this.AdvanceAmt>0&&this.AdvanceAdjustments()}else n.e.Int(this.Terms.SelectedValue)>0?this.LoadPayterms():""!=e.payTermXml&&this.FillDetails(e.payTermXml,!1);for(let o=0;o<this.GridData.length;o++)n.e.IsEmpty(this.GridData[o].Amount)?this.GridData[o].Percentage=0:(this.GridData[o].Amount=parseFloat(this.GridData[o].Amount).ToString(this.Decimals),this.GridData[o].Percentage=(100*parseFloat(this.GridData[o].Amount)/this.Amount).ToString(this.Decimals),this.ExchRate>0&&(this.GridData[o].AmountFC=(parseFloat(this.GridData[o].Amount)/this.ExchRate).ToString(this.Decimals)));for(let n=this.GridData.length;n<10;n++)this.GridDataObj.addEmptyRow();this.CalculateTotals(),this.filldimensionValues(),Logger.InfoLog("PaymentTermsViewModel::Exiting PaymentTermsViewModel")}AdvanceAdjustments(){let e=this.AdvanceAmt;for(let t=0;t<this.GridData.length;t++){if(n.e.Double(this.GridData[t].Amount)>e){this.GridData[t].Amount=parseFloat(this.GridData[t].Amount)-e,this.ExchRate>0&&(this.GridData[t].AmountFC=(parseFloat(this.GridData[t].Amount)/this.ExchRate).ToString(this.Decimals));break}if(parseFloat(this.GridData[t].Amount)==e){this.GridDataObj.removeRow(this.GridData[t]);break}e-=parseFloat(this.GridData[t].Amount),this.GridDataObj.removeRow(this.GridData[t]),t--}for(let t=0;t<this.GridData.length;t++)n.e.IsEmpty(this.GridData[t].Amount)||(this.GridData[t].Percentage=(parseFloat(this.GridData[t].Amount)/this.Amount*100).ToString(this.Decimals))}PaymentTermsViewModel_3(e,t){this.IsViewScreen=!0;let s=a.a.report.GetReportData(20,e,t),i=s.Tables[1].filter(e=>"ShowPercentPayTerms"==e.PrefName);i.length>0&&Object(o.j)(i[0].PrefValue)&&(this.ShowPercentPayTerms=!0),i.length>0&&(this.DecimalsNetAmount=i[0].PrefValue.toString()),this.InitGrid(),this.FillDetails(null,!0,s),this.ColumnSource.map(e=>e.ReadOnly=!0),this.OKVisbile=!1,this.Name=new u.d(0),this.Name.Label="Name",this.Terms=new D.e(0),this.Terms.Label="Payment Terms",this.Terms.Enable=!1,s.Tables.length>0&&s.Columns[0].Contains("ProfileId")&&s.Columns[0].Contains("ProfileName")&&s.Tables[0].length>0&&!n.e.IsEmpty(s.Tables[0][0].ProfileId)&&(this.Terms.Items.push(D.d.ComboBoxItems_2(s.Tables[0][0].ProfileName.toString(),s.Tables[0][0].ProfileId.toString())),this.Terms.SelectedValue=s.Tables[0][0].ProfileId.toString(),this.Name.Text=s.Tables[0][0].ProfileName.toString())}FillDetails(e,t,s=null){try{let i=0;if(null==s&&(s=new n.f,""!=e&&s.ReadXml(e)),s.Tables.length>0){s.Columns[0].Contains("ProfileId")&&s.Tables[0].length>0&&null!=this.Terms&&!n.e.IsEmpty(s.Tables[0][0].ProfileId)&&(this.Terms.SelectedValue=s.Tables[0][0].ProfileId.toString());for(let e=0;e<s.Tables[0].length;e++){let t=this.GridDataObj.NewRow();s.Columns[0].Contains("Percentage")&&!n.e.IsEmpty(s.Tables[0][e].Percentage)&&(t.Percentage=s.Tables[0][e].Percentage),s.Columns[0].Contains("Amount")&&!n.e.IsEmpty(s.Tables[0][e].Amount)&&(t.Amount=s.Tables[0][e].Amount),s.Columns[0].Contains("AmountFC")&&!n.e.IsEmpty(s.Tables[0][e].AmountFC)&&(t.AmountFC=s.Tables[0][e].AmountFC),s.Columns[0].Contains("Days")&&!n.e.IsEmpty(s.Tables[0][e].Days)&&(t.Days=s.Tables[0][e].Days),s.Columns[0].Contains("DueDate")&&!n.e.IsEmpty(s.Tables[0][e].DueDate)&&(t.DueDate_Key=new Date(s.Tables[0][e].DueDate),t.DueDate=new Date(t.DueDate_Key).ToString(a.a.SessionManager.Preferences["Date Format"])),s.Columns[0].Contains("BasedOn")&&!n.e.IsEmpty(s.Tables[0][e].BasedOn)&&(t.BasedOn=s.Tables[0][e].BasedOn),s.Columns[0].Contains("BaseDate")&&!n.e.IsEmpty(s.Tables[0][e].BaseDate)&&(t.BaseDate=s.Tables[0][e].BaseDate),s.Columns[0].Contains("Period")&&!n.e.IsEmpty(s.Tables[0][e].Period)&&(t.Period=s.Tables[0][e].Period),s.Columns[0].Contains("Remarks")&&!n.e.IsEmpty(s.Tables[0][e].Remarks)&&(t.Remarks=s.Tables[0][e].Remarks.toString()),s.Columns[0].Contains("DimCCID")&&!n.e.IsEmpty(s.Tables[0][e].DimCCID)&&(t.DimCCID=s.Tables[0][e].DimCCID.toString()),s.Columns[0].Contains("DimNodeID")&&!n.e.IsEmpty(s.Tables[0][e].DimNodeID)&&(t.DimNodeID=s.Tables[0][e].DimNodeID.toString()),n.e.IsNum(t.Amount)&&(i+=parseFloat(t.Amount.toString())),this.GridDataObj.addRow(t),console.log(t)}t&&(this.Amount=parseFloat(i.ToString(this.Decimals))),this.CalculateTotals(),console.log(this.GridDataObj.Table)}}catch(i){Logger.ErrorLog("Payments Terms","Fill Details",i)}}filldimensionValues(){if(!this.GridDataObj.TableColumns.Contains("Dim"))return;let e="",t="";for(let s=0;s<this.GridData.length;s++)n.e.IsEmpty(this.GridData[s].DimCCID)||n.e.IsEmpty(this.GridData[s].DimNodeID)||(""!=e&&(e+=","),t=this.GridData[s].DimCCID.toString(),e+=this.GridData[s].DimNodeID.toString());if(""!=t&&""!=e){let s=this.Parent.ScreenObject.GetdimensionNames(t,e);s.Tables.length>0&&!s.Columns[0].Contains("ErrorMessage")&&this.GridData.forEach(e=>{if(!n.e.IsEmpty(e.DimNodeID)){let t=s.Tables[0].filter(t=>t.NodeID==e.DimNodeID);t.length>0&&(e.Dim=n.e.StringValue(t[0][1]))}})}}LoadPayterms(){let e=0,t=0,s=this.payds.Tables[2].filter(e=>e.ProfileID==this.Terms.SelectedValue);this.GridData.Clear();for(let i=0;i<s.length;i++)if(!n.e.IsEmpty(s[i].percentage)){let a=0;if(a=t+parseFloat(s[i].percentage)>100?100-t:parseFloat(s[i].percentage),t+=a,e=(this.Amount+this.AdvanceAmt)*a/100,2==n.e.Int(s[i].TypeID))if(n.e.Int(s[i].Occurences)>1){let t=e/parseInt(s[i].Occurences),a=t/(this.Amount+this.AdvanceAmt)*100,r=0;for(let o=1;o<=parseInt(s[i].Occurences);o++)o==parseInt(s[i].Occurences)?t=e-r:r+=parseFloat(t.ToString(this.Decimals)),this.AddRow(a,t,s[i],parseInt(s[i].Days)*o,n.e.StringValue(s[i].dimccid),n.e.StringValue(s[i].dimnodeid))}else this.AddRow(a,e,s[i],parseInt(s[i].Days),n.e.StringValue(s[i].dimccid),n.e.StringValue(s[i].dimnodeid));else if(1==n.e.Int(s[i].TypeID))if(n.e.Int(s[i].Occurences)>1)for(let t=1;t<=parseInt(s[i].Occurences);t++)this.AddRow(a,e,s[i],parseInt(s[i].Days)*t,n.e.StringValue(s[i].dimccid),n.e.StringValue(s[i].dimnodeid));else this.AddRow(a,e,s[i],parseInt(s[i].Days),n.e.StringValue(s[i].dimccid),n.e.StringValue(s[i].dimnodeid));else this.AddRow(a,e,s[i],parseInt(s[i].Days),n.e.StringValue(s[i].dimccid),n.e.StringValue(s[i].dimnodeid))}this.AdvanceAmt>0&&this.AdvanceAdjustments();for(let i=this.GridData.length;i<8;i++)this.GridDataObj.addEmptyRow();this.CalculateTotals()}AddRow(e,t,s,i,r,o){let l=this.GridDataObj.NewRow();l.Percentage=e.ToString(this.Decimals),l.Amount=t.ToString(this.Decimals),this.ExchRate>0&&(l.AmountFC=(t/this.ExchRate).ToString(this.Decimals)),l.Days=i,l.Period=s.Period.toString(),2==n.e.Int(s.BasedOn)?(l.DueDate_Key=2==n.e.Int(s.Period)?this.billdate.AddMonths(i):this.billdate.AddDays(i),l.BaseDate=a.a.SessionManager.IsWebApplication?this.billdate.ToString("dd/MMM/yyyy"):this.billdate,l.BasedOn="2"):(l.BasedOn="1",l.DueDate_Key=2==n.e.Int(s.Period)?this.Parent.DocumentDate.AddMonths(i):this.Parent.DocumentDate.AddDays(i),l.BaseDate=a.a.SessionManager.IsWebApplication?this.Parent.DocumentDate.ToString("dd/MMM/yyyy"):this.Parent.DocumentDate),""!=r&&(l.DimCCID=r),""!=o&&(l.DimNodeID=o),l.DueDate=new Date(l.DueDate_Key).ToString(a.a.SessionManager.Preferences["Date Format"]),l.Remarks=n.e.IsEmpty(s.Remarks)?"":s.Remarks.toString(),this.GridDataObj.addRow(l)}CalculateTotals(){let e=0,t=0;for(let s=0;s<this.GridData.length;s++)n.e.IsNum(this.GridData[s].Percentage)&&(t+=parseFloat(this.GridData[s].Percentage)),n.e.IsNum(this.GridData[s].Amount)&&(e+=parseFloat(this.GridData[s].Amount));"Percentage"==this.ColumnSource[0].DisplayMember?(this.ColumnSource[0].footer=t.Commas(this.Decimals),this.ColumnSource[1].footer=e.Commas(this.Decimals)):this.ColumnSource[0].footer=e.Commas(this.Decimals),this.AdjustedAmt=e.Commas(this.Decimals),this.Balance=(this.Amount-e).Commas(this.Decimals),this.updateFooter=!0}InitGrid(){if(null!=this.Parent){if(this.billdate=this.Parent.DocumentDate,this.Parent.ScreenObject.Preferences.ContainsKey("Paymenttermsbasedon")&&""!=this.Parent.ScreenObject.Preferences.Paymenttermsbasedon){let e=this.Parent.ScreenObject.Preferences.Paymenttermsbasedon;for(let t=0;t<this.Parent.ScreenObject.HeaderFields.length;t++){let s=this.Parent.ScreenObject.HeaderFields[t];if(s instanceof d.c&&s.DBColumnName.toLowerCase()==e.toLowerCase()&&s.Date){this.billdate=s.Date;break}}for(let t=0;t<this.Parent.ScreenObject._TextFields.length;t++){let s=this.Parent.ScreenObject._TextFields[t];if(s instanceof d.c&&s.DBColumnName.toLowerCase()==e.toLowerCase()&&s.Date){this.billdate=s.Date;break}}}this.Decimals=this.Parent.ScreenObject.Preferences.ContainsKey("DecimalsNetAmount")&&""!=this.Parent.ScreenObject.Preferences.DecimalsNetAmount?"N"+this.Parent.ScreenObject.Preferences.DecimalsNetAmount:"N2",this.Amount=parseFloat(this.Amount.ToString(this.Decimals)),this.Balance=this.AmttoAdjust=this.Amount.Commas(this.Decimals),this.AdjustedAmt=(0).Commas(this.Decimals)}let e;null!=this.Parent&&this.Parent.ScreenObject.Preferences.ContainsKey("DecimalsNetAmount")&&""!=this.Parent.ScreenObject.Preferences.DecimalsNetAmount&&(this.DecimalsNetAmount=this.Parent.ScreenObject.Preferences.DecimalsNetAmount),this.GridDataObj.Columns=[],this.GridDataObj.Table=[],this.GridDataObj.TableColumns=[],this.GridDataObj.TableColumns.push("Percentage"),this.GridDataObj.TableColumns.push("Amount"),this.GridDataObj.TableColumns.push("AmountFC"),this.GridDataObj.TableColumns.push("Days"),this.GridDataObj.TableColumns.push("DueDate"),this.GridDataObj.TableColumns.push("DueDate_Key"),this.GridDataObj.TableColumns.push("Remarks"),this.GridDataObj.TableColumns.push("Period"),this.GridDataObj.TableColumns.push("BasedOn"),this.GridDataObj.TableColumns.push("BaseDate"),this.GridDataObj.TableColumns.push("DimCCID"),this.GridDataObj.TableColumns.push("DimNodeID"),(this.ShowPercentPayTerms||null!=this.Parent&&this.Parent.ScreenObject.Preferences.ContainsKey("ShowPercentPayTerms")&&""!=this.Parent.ScreenObject.Preferences.ShowPercentPayTerms&&Object(o.j)(this.Parent.ScreenObject.Preferences.ShowPercentPayTerms))&&(e=new y.a,e.Header="%",e.DisplayMember="Percentage",e.Width=100,e.DecimalPoints="2",e.DataType="FLOAT",e.ShowTotal=!0,e.ReadOnly=!a.a.SessionManager.IsActionAssigned(43,"Override Payment Terms"),this.ColumnSource.push(e)),e=new y.a,e.Header="Amount",e.DisplayMember="Amount",e.DecimalPoints=this.DecimalsNetAmount,e.Width=100,e.DataType="FLOAT",e.ShowTotal=!0,e.ReadOnly=!a.a.SessionManager.IsActionAssigned(43,"Override Payment Terms"),this.ColumnSource.push(e),null!=this.Parent&&null!=this.Parent.Currency&&n.e.IsNum(this.Parent.Currency.ExchangeRate.Text)&&a.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(o.j)(a.a.SessionManager.Preferences["Use Foreign Currency"])&&(this.ExchRate=parseFloat(this.Parent.Currency.ExchangeRate.Text),e=new y.a,e.Header="AmountFC",e.DisplayMember="AmountFC",e.DecimalPoints=this.DecimalsNetAmount,e.Width=100,e.DataType="FLOAT",e.ReadOnly=!0,this.ColumnSource.push(e)),e=new y.a,e.Header="Number",e.DisplayMember="Days",e.Width=100,e.DataType="FLOAT",e.ReadOnly=!a.a.SessionManager.IsActionAssigned(43,"Override Payment Terms"),this.ColumnSource.push(e),e=new y.a,e.Header="Period",e.ValueBinding="Period",e.DataType="ComboBox",e.DisplayMember="Name",e.ValueMember="Value",e.Width=100;let t=[];t.push(D.d.ComboBoxItems_2("Month(s)","2")),t.push(D.d.ComboBoxItems_2("Day(s)","1")),e.ComboData=t,e.ReadOnly=!a.a.SessionManager.IsActionAssigned(43,"Override Payment Terms"),this.ColumnSource.push(e),e=new y.a,e.Header="DueDate",e.DisplayMember="DueDate",e.DataType="DATE",e.Width=100,this.ColumnSource.push(e),e=new y.a,e.Header="Remarks",e.DisplayMember="Remarks",e.Width=200,this.ColumnSource.push(e),""!=a.a.SessionManager.Preferences.EnableDimPayterm&&Object(o.j)(a.a.SessionManager.Preferences.EnableDimPayterm)&&(e=new y.a,e.Header="Dimension",e.DisplayMember="Dim",e.Width=200,this.ColumnSource.push(e),this.GridDataObj.TableColumns.push("Dim"))}onSave(e){if("Cancel"==e)null!=this.Parent&&(this.Parent.DialogResult=!1),a.a.page.HideDialog();else if("OK"==e||"Save"==e){if("OK"==e){let e=0;for(let t=0;t<this.GridData.length;t++)n.e.IsEmpty(this.GridData[t].Amount)||(e+=parseFloat(this.GridData[t].Amount));if(e.ToString(this.Decimals)!=this.Amount.ToString(this.Decimals))return void(this.DisplayMessage="Define 100 % payment");this.Parent.DialogResult=!0}let t="",s=null;this.Parent.ScreenObject.Preferences.ContainsKey("BillwisePosting")&&"2"==this.Parent.ScreenObject.Preferences.BillwisePosting&&(s="",s+="<BillWise> ");for(let e=0;e<this.GridData.length;e++)n.e.Double(this.GridData[e].Amount)>0&&(t+="<Row ",t+=' Percentage="'+this.GridData[e].Percentage.toString()+'" ',t+=' Accountid="'+this.Accountid+'" ',t+=' Amount="'+this.GridData[e].Amount.toString()+'" ',n.e.IsEmpty(this.GridData[e].AmountFC)||(t+=' AmountFC="'+this.GridData[e].AmountFC.toString()+'" '),n.e.IsEmpty(this.GridData[e].Days)?t+=' Days="0" ':t+=' Days="'+this.GridData[e].Days.toString()+'" ',n.e.IsEmpty(this.GridData[e].DueDate_Key)?t+=' DueDate="'+new Date(this.billdate).ToString("dd/MMM/yyyy")+'" ':t+=' DueDate="'+new Date(this.GridData[e].DueDate_Key).ToString("dd/MMM/yyyy")+'" ',n.e.IsEmpty(this.GridData[e].Period)?t+=' Period="1" ':t+=' Period="'+this.GridData[e].Period.toString()+'" ',n.e.IsEmpty(this.GridData[e].DimCCID)||(t+=' DimCCID="'+this.GridData[e].DimCCID.toString()+'" '),n.e.IsEmpty(this.GridData[e].DimNodeID)||(t+=' DimNodeID="'+this.GridData[e].DimNodeID.toString()+'" '),n.e.IsEmpty(this.GridData[e].BasedOn)?t+=' BasedOn="2" ':t+=' BasedOn="'+this.GridData[e].BasedOn.toString()+'" ',null!=this.Terms&&null!=this.Terms.SelectedValue&&""!=this.Terms.SelectedValue&&(t+=' ProfileId="'+this.Terms.SelectedValue+'" ',t+=' ProfileName="'+u.d.GetValidXml(this.Terms.GetText())+'" '),n.e.IsEmpty(this.GridData[e].BaseDate)?t+=' BaseDate="'+new Date(this.billdate).ToString("dd/MMM/yyyy")+'" ':t+=' BaseDate="'+new Date(this.GridData[e].BaseDate).ToString("dd/MMM/yyyy")+'" ',t+=' Remarks="'+u.d.GetValidXml(this.GridData[e].Remarks)+'" ',t+=" /> ",null!=s&&(s+='<Row DocSeqNo="'+e+'1" AccountID="'+this.Accountid.toString()+'" ',s+=1==this.Parent.ScreenObject.DocumentType||27==this.Parent.ScreenObject.DocumentType||26==this.Parent.ScreenObject.DocumentType||25==this.Parent.ScreenObject.DocumentType||2==this.Parent.ScreenObject.DocumentType||34==this.Parent.ScreenObject.DocumentType||6==this.Parent.ScreenObject.DocumentType||39==this.Parent.ScreenObject.DocumentType||3==this.Parent.ScreenObject.DocumentType||4==this.Parent.ScreenObject.DocumentType||13==this.Parent.ScreenObject.DocumentType?'AdjAmount="-'+this.GridData[e].Amount.toString()+'" ':'AdjAmount="'+this.GridData[e].Amount.toString()+'" ',n.e.IsEmpty(this.GridData[e].AmountFC)||null==this.NewRefNode||null==this.NewRefNode.attributes.AdjCurrID||this.NewRefNode.attributes.AdjCurrID.Value!=this.Parent.Currency.Currency.SelectedValue?(s+=1==this.Parent.ScreenObject.DocumentType||27==this.Parent.ScreenObject.DocumentType||26==this.Parent.ScreenObject.DocumentType||25==this.Parent.ScreenObject.DocumentType||2==this.Parent.ScreenObject.DocumentType||34==this.Parent.ScreenObject.DocumentType||6==this.Parent.ScreenObject.DocumentType||39==this.Parent.ScreenObject.DocumentType||3==this.Parent.ScreenObject.DocumentType||4==this.Parent.ScreenObject.DocumentType||13==this.Parent.ScreenObject.DocumentType?'AmountFC="-'+this.GridData[e].Amount.toString()+'" ':'AmountFC="'+this.GridData[e].Amount.toString()+'" ',s+='AdjCurrID="1" AdjExchRT="1" IsNewReference="1" '):(s+=1==this.Parent.ScreenObject.DocumentType||27==this.Parent.ScreenObject.DocumentType||26==this.Parent.ScreenObject.DocumentType||25==this.Parent.ScreenObject.DocumentType||2==this.Parent.ScreenObject.DocumentType||34==this.Parent.ScreenObject.DocumentType||6==this.Parent.ScreenObject.DocumentType||39==this.Parent.ScreenObject.DocumentType||3==this.Parent.ScreenObject.DocumentType||4==this.Parent.ScreenObject.DocumentType||13==this.Parent.ScreenObject.DocumentType?'AmountFC="-'+this.GridData[e].AmountFC.toString()+'" ':'AmountFC="'+this.GridData[e].AmountFC.toString()+'" ',s+='AdjCurrID="'+this.Parent.Currency.Currency.SelectedValue+'" AdjExchRT="'+this.Parent.Currency.ExchangeRate.Text+'" IsNewReference="1" '),n.e.IsEmpty(this.GridData[e].DueDate_Key)?s+=' DueDate="'+new Date(this.billdate).ToString("dd/MMM/yyyy")+'" ':s+=' DueDate="'+new Date(this.GridData[e].DueDate_Key).ToString("dd/MMM/yyyy")+'" ',n.e.IsEmpty(this.GridData[e].DimCCID)||(s+=' DimCCID="'+this.GridData[e].DimCCID.toString()+'" '),n.e.IsEmpty(this.GridData[e].DimNodeID)||(s+=' DimNodeID="'+this.GridData[e].DimNodeID.toString()+'" '),s+='Narration="" IsDocPDC="0"  ></Row>'));t.length>0&&(t="<Paymentterms>"+t+"</Paymentterms>"),null!=s&&(s+=" </BillWise>",this.Parent.BillWiseXML+=s),this.Parent.payTermXml=t,"OK"==e&&(a.a.page.HideDialog(),this.Parent.IsInventoryVoucher&&this.Parent.SaveDocument())}}oncelleditEnd(e){let t=e.item,s=e.column.field;"DataGridComboBoxColumn"!=e.column.className&&(s=e.column.field),"Percentage"==s?(n.e.IsEmpty(t.Percentage)?(t.Amount=0,t.AmountFC=0):(t.Percentage=parseFloat(t.Percentage).ToString(this.Decimals),t.Amount=(this.Amount*parseFloat(t.Percentage)/100).ToString(this.Decimals),this.ExchRate>0&&(t.AmountFC=(parseFloat(t.Amount)/this.ExchRate).ToString(this.Decimals))),this.CalculateTotals()):"Amount"==s&&(n.e.IsEmpty(t.Amount)?t.Percentage=0:(t.Amount=parseFloat(t.Amount).ToString(this.Decimals),t.Percentage=(100*parseFloat(t.Amount)/this.Amount).ToString(this.Decimals),this.ExchRate>0&&(t.AmountFC=(parseFloat(t.Amount)/this.ExchRate).ToString(this.Decimals))),this.CalculateTotals()),"DueDate"!=s?this.FillDates(t):"DueDate"==s&&this.FillDays(t),this.GridDataObj.updateRow(t)}FillDates(e){n.e.IsEmpty(e.Days)||(2==n.e.Int(e.BasedOn)?(e.DueDate_Key=2==n.e.Int(e.Period)?this.billdate.AddMonths(parseInt(e.Days)):this.billdate.AddDays(parseInt(e.Days)),e.BaseDate=this.billdate,e.BasedOn="2"):(e.BasedOn="1",e.DueDate_Key=2==n.e.Int(e.Period)?this.Parent.DocumentDate.AddMonths(parseInt(e.Days)):this.Parent.DocumentDate.AddDays(parseInt(e.Days)),e.BaseDate=this.Parent.DocumentDate),e.DueDate=new Date(e.DueDate_Key).ToString(a.a.SessionManager.Preferences["Date Format"]))}FillDays(e){n.e.IsEmpty(e.DueDate)||(2==n.e.Int(e.BasedOn)?(2==n.e.Int(e.Period)?e.DueDate_Key=this.billdate.AddMonths(parseInt(e.Days)):e.Days=new Date(e.DueDate_Key).Subtract(this.billdate).TotalDays,e.BaseDate=this.billdate,e.BasedOn="2"):(2==n.e.Int(e.Period)?e.DueDate_Key=this.Parent.DocumentDate.AddMonths(parseInt(e.Days)):e.Days=new Date(e.DueDate_Key).Subtract(this.Parent.DocumentDate).TotalDays,e.BaseDate=this.Parent.DocumentDate,e.BasedOn="1"))}OnselectionChanged(e){this.Name.Text=this.Terms.GetText(),this.LoadPayterms(),this.filldimensionValues()}}var Oe=s("UWNR"),Ie=s("sDFv"),fe=s("Dc+n"),Te=s("Ls/t"),je=s("j609");class Pe extends l.b{constructor(e){super(),this.parent=null,this.ContractID=0,this.TerminationDate=new d.a(0),this.ContractNumber=new u.d(0),this.DeleteVisible=!1,this.Reason=new m.b(0),this.Title=a.a.GetResource("Doc_Bounce"),this.parent=e,this.TerminationDate.Label=a.a.GetResource("Doc_BounceDate"),this.ContractNumber.Label=a.a.GetResource("DocumentDesigner_DocumentNumber"),this.ContractNumber.Text=e.ScreenObject.VoucherNo,this.DisplayMessage=a.a.GetResource("Doc_BounceMessage"),this.DeleteVisible=!0}OnDelete(e){if("Cancel"==e)a.a.page.HideDialog();else try{this.parent.SaveAccountingDocument("Bounce")}catch(t){Logger.ErrorLog("DeleteLeadViewModel:: OnDelete"+t)}}}var Ae=s("xSvK"),Me=s("pqJT"),Ge=s("EAB5"),Ne=s("xbaw"),Ee=s("9UOb"),we=s("jDOZ"),Fe=s("C58A"),Ve=s("8PvV");class Le extends l.b{constructor(e){super(),this.Text="",this.RecurDocsWithApproval=new D.e(0),this.Application=new D.e(0),this.Groups=new D.b,this.Roles=new D.b,this.Users=new D.b,this.DeleteButtonVisiblily=!0,this.DocID=0,this.Parent=e,this.Title=a.a.GetResource("Recur"),this.RecurringMethod=new D.e(0),this.RecurringMethod.Label=a.a.GetResource("RecurringMethod"),this.RecurringMethod.Items.push(D.d.ComboBoxItems_2(a.a.GetResource("Normal"),"1")),this.RecurringMethod.Items.push(D.d.ComboBoxItems_2(a.a.GetResource("Reverse"),"2")),this.RecurringMethod.SelectedValue=e.ScreenObject.Preferences.ContainsKey("DefaultRecurringMethod")?e.ScreenObject.Preferences.DefaultRecurringMethod:"1",this.RecurringMethod.SetSelectedItem(this.RecurringMethod.SelectedValue),this.RecurDocsWithApproval.Label=a.a.GetResource("PostRecurDocsWithApproval"),this.RecurDocsWithApproval.Items.push(D.d.ComboBoxItems_2(a.a.GetResource("Autopost"),"2")),this.RecurDocsWithApproval.Items.push(D.d.ComboBoxItems_2(a.a.GetResource("WithApproval"),"1")),this.RecurDocsWithApproval.Items.push(D.d.ComboBoxItems_2(a.a.GetResource("WithoutApproval"),"0")),this.RecurDocsWithApproval.SelectedValue=e.ScreenObject.Preferences.ContainsKey("PostRecurDocument")?e.ScreenObject.Preferences.PostRecurDocument:"0",this.EndDate=new d.a(0),this.EndDate.Label=a.a.GetResource("Bth_EDate"),this.Appointment=new Fe.RecurAppointmentViewModel(this),this.Appointment.FirstPostingDate.Label=a.a.GetResource("FirstPostingDate"),this.Application.Label=a.a.GetResource("Notif_Application"),this.Application.SelectionChangedCommand.Subscribe(this,"OnApplicationChange"),this.Application.Items.push(D.d.ComboBoxItems_2(a.a.GetResource("DocumentDesigner_Groups"),"1")),this.Application.Items.push(D.d.ComboBoxItems_2(a.a.GetResource("DocumentDesigner_Roles"),"2")),this.Application.Items.push(D.d.ComboBoxItems_2(a.a.GetResource("DocumentDesigner_Users"),"3")),this.Application.SelectedValue="1"}LoadData(){this.DocID=this.Parent.DocID,this.Groups.Items.Clear(),this.Roles.Items.Clear(),this.Users.Items.Clear();let e=we.a.GetDocumentRecurrence(this.DocID,this.Parent.CostCenterID);null!=e&&e.Tables.length>0&&(e.Tables[0].forEach(e=>{this.Groups.Items.push(D.c.CheckedListBoxItem_5(e.GroupName.toString(),e.GID.toString(),!1))}),e.Tables[1].forEach(e=>{this.Roles.Items.push(D.c.CheckedListBoxItem_5(e.Name.toString(),e.RoleID.toString(),!1))}),e.Tables[2].forEach(e=>{this.Users.Items.push(D.c.CheckedListBoxItem_5(e.UserName.toString(),e.UserID.toString(),!1))})),this.OnApplicationChange(null),this.Appointment.ScheduleID=0,this.DeleteButtonVisiblily=!1,e.Tables.length>3&&e.Tables[3].length>0&&(this.DeleteButtonVisiblily=!0,this.RecurringMethod.SelectedValue=e.Tables[3][0].RecurMethod.toString(),this.RecurDocsWithApproval.SelectedValue=e.Tables[3][0].RecurAutoPost.toString(),this.Appointment.LoadEditData(e.Tables[3][0]),this.SetSelectedItems(this.Groups,e.Tables[4],"GroupID"),this.SetSelectedItems(this.Roles,e.Tables[4],"RoleID"),this.SetSelectedItems(this.Users,e.Tables[4],"UserID"))}SetSelectedItems(e,t,s){e.Items.forEach(e=>{e.IsChecked=t.filter(t=>t[s]==e.Value).length>0})}OnButtonClick(e){if("Save"==e)this.SaveData();else if("Delete"==e){if(confirm(a.a.GetResource("DeleteMessage"))){let e=we.a.DeleteDocumentRecurrence(this.Appointment.ScheduleID);this.Parent.DisplayMessage=e.Message,e.RetValue>0&&a.a.page.HideDialog()}}else"Cancel"==e?a.a.page.HideDialog():"ShowAppointment"==e&&a.a.page.ShowDialog(this.Appointment,Ve.RecurAppointmentComponent,{ShowCenter:!0})}OnApplicationChange(e){"1"==this.Application.SelectedValue?this.SelectedApplication=this.Groups:"2"==this.Application.SelectedValue?this.SelectedApplication=this.Roles:"3"==this.Application.SelectedValue&&(this.SelectedApplication=this.Users),console.log(this.SelectedApplication)}SaveData(){let e,t,s;if(this.Parent.DisplayMessage="",e=this.GetSelectedItems(this.Groups),t=this.GetSelectedItems(this.Roles),s=this.GetSelectedItems(this.Users),0!=e.length||0!=t.length||0!=s.length){if(this.Appointment.SetSaveData(),n.e.IsEmpty(this.Parent.DisplayMessage)){let i=[];i.push(this.Parent.CostCenterID),i.push(this.DocID),i.push(this.Appointment.ScheduleID),i.push("Recurrence"),i.push(1),i.push(this.Appointment.FreqType),i.push(this.Appointment.FreqInterval),i.push(this.Appointment.FreqSubdayType),i.push(this.Appointment.FreqSubdayInterval),i.push(this.Appointment.FreqRelativeInterval),i.push(this.Appointment.FreqRecurrenceFactor),i.push(this.Appointment.FirstPostingDate.Date.ToString("yyyyMMdd")),i.push(this.Appointment.RangeEnd.Items[0].IsChecked?null:this.Appointment.EndDate.Date.ToString("yyyyMMdd"));let n=new Date(this.Appointment.StartingTime.SelectedValue);i.push(n.getHours().PrefixZero(2)+":"+n.getMinutes().PrefixZero(2)+":"+n.getSeconds().PrefixZero(2)),i.push(null),i.push(null),i.push(e),i.push(t),i.push(s),i.push(this.Appointment.Occurrences.Text),i.push(this.RecurDocsWithApproval.SelectedValue),i.push(parseInt(this.RecurringMethod.SelectedValue)),i.push(a.a.SessionManager.CompanyGUID),i.push(a.a.SessionManager.UserName),i.push(a.a.SessionManager.UserID),i.push(a.a.SessionManager.LanguageID),we.a.SetDocumentRecurrence(i).subscribe(e=>{this.Parent.DisplayMessage=e.Message,e.RetValue>0&&(this.Appointment.ScheduleID=e.RetValue,a.a.page.HideDialog())},e=>{console.log(e)})}}else this.Parent.DisplayMessage="Select altest one Group/Role/User"}GetSelectedItems(e){let t="";return e.Items.forEach(e=>{e.IsChecked&&(t.length>0&&(t+=","),t+=e.Value)}),t}OnDeleteCallBack(){}SetErroMessage(e){this.Parent.DisplayMessage=e}}var Re=s("isE8");class Be extends l.b{constructor(){super(),this.IsApprove=!1,this._Rejectall=!1,this._Approveall=!1,this.chkApproveall=new S.a,this.chkRejectall=new S.a,this.FromDate=new d.a(0),this.ToDate=new d.a(0),this.LinkedData=null,this.Filters="",this.chkApproveall.Label=a.a.GetResource("Approveall"),this.chkRejectall.Label=a.a.GetResource("Rejectall"),this.chkApproveall.CheckedChangedCommand.Subscribe(this,"onApproveCheck"),this.chkRejectall.CheckedChangedCommand.Subscribe(this,"onRejectCheck")}get Rejectall(){return this._Rejectall}set Rejectall(e){e!=this._Rejectall&&(this._Rejectall=e,e&&(this._Approveall=!1,this.chkApproveall.IsChecked=!1),this.linkGrid.Table.forEach(e=>{this._Rejectall&&!n.e.IsEmpty(e.ProductID_Key)&&"1"==n.e.String(e.CanApprove)?e.IsSelected="2":this._Rejectall||"2"!=n.e.String(e.IsSelected)||(e.IsSelected="0")}),this.linkGrid.invalidate())}get Approveall(){return this._Approveall}set Approveall(e){e!=this._Approveall&&(this._Approveall=e,e&&(this._Rejectall=!1,this.chkRejectall.IsChecked=!1),this.linkGrid.Table.forEach(e=>{this._Approveall&&!n.e.IsEmpty(e.ProductID_Key)&&"1"==n.e.String(e.CanApprove)?e.IsSelected="1":this._Approveall||"1"!=n.e.String(e.IsSelected)||(e.IsSelected="0")}),this.linkGrid.invalidate())}onApproveCheck(e){this.Approveall=e.IsChecked}onRejectCheck(e){this.Rejectall=e.IsChecked}UpdateFieldsViewModel_1(e){this.SrcDocument=new D.e(101),this.DestDocument=new D.e(102),this.SrcDocument.Visible=!0,this.DestDocument.Visible=!1,this.SrcDocument.SelectionChangedCommand.Subscribe(this,"onSelectionChangedCommand"),this.SrcDocument.Label="Status",this.SrcDocument.Items.push(D.d.ComboBoxItems_2("Show All","")),this.SrcDocument.Items.push(D.d.ComboBoxItems_2("Posted","369")),this.SrcDocument.Items.push(D.d.ComboBoxItems_2("UnApproved","371")),this.SrcDocument.Items.push(D.d.ComboBoxItems_2("Rejected","372")),this.SrcDocument.Items.push(D.d.ComboBoxItems_2("Approved","441")),this.SrcDocument.SelectedValue="",this.Parent=e,this.IsApprove=!0,this.DisplayName=a.a.GetResource("ApproveReject"),this.linkGrid=new F.a,this.linkGrid.Columns=e.ScreenObject.ColumnSource,this.linkGrid.Table=e.ScreenObject.GridData,this.linkGrid.BeginEdit.Subscribe(this,"OnApproveBeginEdit");var t=this.linkGrid.Columns.find(e=>!n.e.IsEmpty(e.ValueBinding)&&"IsSelected"==e.ValueBinding);t&&(t.IsVisible=!0),(t=this.linkGrid.Columns.find(e=>!n.e.IsEmpty(e.DisplayMember)&&"AppRemarks"==e.DisplayMember))&&(t.IsVisible=!0);for(let i=0;i<this.linkGrid.Table.length;i++)this.linkGrid.Table[i].IsSelected="0";if(e.UserWiseApproval&&""!=a.a.SessionManager.Preferences["Dimension List"].Trim()){let t=e.ScreenObject.GetUserWiseDim();var s=a.a.SessionManager.Preferences["Dimension List"].split(",");for(let e=0;e<s.length;e++){alert("Check:Dcccnid-110");let i=t.Tables[0].filter("CostCenterID="+s[e]);if(i.length>0&&this.linkGrid.TableColumns.Contains("Dcccnid"+(parseInt(s[e])-5e4)+"_Key")){""!=this.Filters&&(this.Filters+=" and "),this.Filters+=" Dcccnid"+(parseInt(s[e])-5e4)+"_Key in (";for(let e=0;e<i.length;e++)e>0&&(this.Filters+=","),this.Filters+=i[e].NodeID.toString();this.Filters+=" )"}}}}UpdateFieldsViewModel_2(e){this.DisplayName=e,this.SrcDocument=new D.e(101),this.DestDocument=new D.e(102),this.SrcDocument.Label="Source",this.DestDocument.Label="Destination",this.SrcDocument.SelectionChangedCommand.Subscribe(this,"onSelectionChangedCommand");let t=we.a.GetAllDocuments();if(null!=t&&t.Tables.length>7&&(this.LinkedData=t.Tables[7]),null!=t&&t.Tables.length>0&&t.Tables[0].length>0)for(let i=0;i<t.Tables[0].length;i++)"0"!=t.Tables[0][i].HasAccess.toString()&&(this.SrcDocument.Items.push(D.d.ComboBoxItems_2(t.Tables[0][i].ResourceData.toString(),t.Tables[0][i].CostCenterID.toString())),null==this.LinkedData&&this.DestDocument.Items.push(D.d.ComboBoxItems_2(t.Tables[0][i].ResourceData.toString(),t.Tables[0][i].CostCenterID.toString())));this.linkGrid=new F.a,this.linkGrid.Columns=[],this.linkGrid.Table=[],this.linkGrid.BeginEdit.Subscribe(this,"OnBeginningEdit"),this.linkGrid.CanUserAddRows=!0,this.linkGrid.CanUserResizeColumns=!1;let s=new y.a;s.Header="Source",s.ValueBinding="SrcCostCenterColID",s.DataType="ComboBox",s.DisplayMember="ResourceData",s.ValueMember="CostCenterColID",s.Width=200,s.ComboData=t.Tables[4],this.linkGrid.Columns.push(s),this.linkGrid.TableColumns.push("SrcCostCenterColID"),s=new y.a,s.Header="Destination",s.ValueBinding="DestCostCenterColID",s.DataType="ComboBox",s.DisplayMember="ResourceData",s.ValueMember="CostCenterColID",s.Width=200,s.ComboData=t.Tables[4],this.linkGrid.Columns.push(s),this.linkGrid.TableColumns.push("DestCostCenterColID");for(let i=0;i<10;i++)this.linkGrid.addEmptyRow();Logger.InfoLog("UpdateFieldsViewModel:: Entering UpdateFieldsViewModel")}UpdateFieldsViewModel_3(){Logger.InfoLog("UpdateFieldsViewModel:: Entering UpdateFieldsViewModel"),this.DisplayName="",this.SrcDocument=new D.e(101),this.DestDocument=new D.e(102),this.SrcDocument.Visible=!1,this.DestDocument.Visible=!1;let e=we.a.GetAllDocuments();null!=e&&e.Tables.length>7&&(this.LinkedData=e.Tables[7]),this.linkGrid=new F.a,this.linkGrid.Columns=[],this.linkGrid.Table=[],this.linkGrid.BeginEdit.Subscribe(this,"OnBeginningEdit"),this.linkGrid.CanUserAddRows=!0,this.linkGrid.CanUserResizeColumns=!1;let t=new y.a;t.Header="Source Doc",t.ValueBinding="SrcCostCenterID",t.DataType="ComboBox",t.DisplayMember="ResourceData",t.ValueMember="CostCenterID",t.Width=200,t.ComboData=e.Tables[0],this.linkGrid.Columns.push(t),this.linkGrid.TableColumns.push("SrcCostCenterID"),t=new y.a,t.Header="Destination Doc",t.ValueBinding="DestCostCenterID",t.DataType="PactComboBox",t.DisplayMember="ResourceData",t.ValueMember="CostCenterID",t.Width=200,t.ComboData=e.Tables[0],this.linkGrid.Columns.push(t),this.linkGrid.TableColumns.push("DestCostCenterID"),this.linkGrid.TableColumns.push("DestCostCenterID_Key"),t=new y.a,t.Header="Source fld",t.ValueBinding="SrcCostCenterColID",t.DataType="PactComboBox",t.DisplayMember="ResourceData",t.ValueMember="CostCenterColID",t.Width=200,t.ComboData=e.Tables[4],this.linkGrid.Columns.push(t),this.linkGrid.TableColumns.push("SrcCostCenterColID"),this.linkGrid.TableColumns.push("SrcCostCenterColID_Key"),t=new y.a,t.Header="Destination fld",t.ValueBinding="DestCostCenterColID",t.DataType="PactComboBox",t.DisplayMember="ResourceData",t.ValueMember="CostCenterColID",t.Width=200,t.ComboData=e.Tables[4],this.linkGrid.Columns.push(t),this.linkGrid.TableColumns.push("DestCostCenterColID"),this.linkGrid.TableColumns.push("DestCostCenterColID_Key");for(let s=0;s<10;s++)this.linkGrid.addEmptyRow()}onSelectionChangedCommand(e){if(null!=e&&101==e.DBColumnID){if(this.IsApprove)return;if(n.e.IsEmpty(this.SrcDocument.SelectedValue))return;this.DestDocument.Items.Clear();let e=this.LinkedData.filter(e=>e.CostCenterIDLinked==this.SrcDocument.SelectedValue);if(e.length>0)for(let t=0;t<e.length;t++)this.DestDocument.Items.push(D.d.ComboBoxItems_2(e[t].SourceDocumentName.toString(),e[t].CostCenterIDBase.toString()))}}OnApproveBeginEdit(e){let t=e.args.column.field;return"IsSelected"!=t&&"AppRemarks"!=t||"0"==e.args.item.CanApprove.toString()}OnBeginningEdit(e){let t=e.args.item,s=e.args.column.field,i=e.args.column;if("DataGridComboBoxColumn"==i.className)i.ItemsSource instanceof DataView&&("DestCostCenterColID"==s?i.ItemsSource.RowFilter=null!=this.DestDocument.SelectedValue&&""!=this.DestDocument.SelectedValue?"CostCenterID="+this.DestDocument.SelectedValue:"CostCenterID=0":"SrcCostCenterColID"==s&&(i.ItemsSource.RowFilter=null!=this.SrcDocument.SelectedValue&&""!=this.SrcDocument.SelectedValue?"CostCenterID="+this.SrcDocument.SelectedValue:"CostCenterID=0"));else if("DataGridPactComboBoxColumn"==i.className&&i.ItemsSource instanceof DataView)if("DestCostCenterColID_Key"==s)i.ItemsSource.RowFilter=""!=t.DestCostCenterID.toString()?"CostCenterID="+t.DestCostCenterID.toString():"CostCenterID=0";else if("SrcCostCenterColID_Key"==s)i.ItemsSource.RowFilter=""!=t.SrcCostCenterID.toString()?"CostCenterID="+t.SrcCostCenterID.toString():"CostCenterID=0";else if("DestCostCenterID_Key"==s)if(""!=t.SrcCostCenterID.toString()){let e=this.LinkedData.filter(e=>e.CostCenterIDLinked==t.SrcCostCenterID);if(e.length>0){let t="";for(let s=0;s<e.length;s++)""!=t&&(t+=","),t+=e[s].CostCenterIDBase.toString();i.ItemsSource.RowFilter="CostCenterID in ("+t+")"}else i.ItemsSource.RowFilter="CostCenterID=0"}else i.ItemsSource.RowFilter="CostCenterID=0";return!1}OnButtonClick(e){if("Cancel"==e)""==this.Filters&&n.e.IsEmpty(this.SrcDocument.SelectedValue)||this.Parent.ScreenObject.GridDataObj.ClearFilters(),a.a.page.HideDialog();else if("Reject"==e){""==this.Filters&&n.e.IsEmpty(this.SrcDocument.SelectedValue)||this.Parent.ScreenObject.GridDataObj.ClearFilters();var t=this.linkGrid.Columns.find(e=>!n.e.IsEmpty(e.DisplayMember)&&"IsSelected"==e.DisplayMember);t&&(t.IsVisible=!1);let e="";for(let t=0;t<this.Parent.ScreenObject.GridData.length;t++)Object(o.j)(this.Parent.ScreenObject.GridData[t].IsSelected.toString())&&(e+='<Row ID="'+this.Parent.ScreenObject.GridData[t].DocDetailsID.toString()+'" Remarks="'+this.Parent.ScreenObject.GridData[t].AppRemarks.toString()+'" />');""!=e.toString()&&(e="<XML>"+e,e+="</XML>",this.Parent.SaveStatus(372,0,e.toString())),a.a.page.HideDialog()}else if("OKApprove"==e){if(!this.IsApprove&&!this.SrcDocument.Visible)return void a.a.page.HideDialog();if(this.linkGrid.Table.filter(e=>2==e.IsSelected||1==e.IsSelected).length>0){if(this.Parent.ScreenObject.Preferences.ContainsKey("CommentsMandatoryforApprove")&&""!=this.Parent.ScreenObject.Preferences.CommentsMandatoryforApprove&&Object(o.j)(this.Parent.ScreenObject.Preferences.CommentsMandatoryforApprove)&&this.linkGrid.Table.filter(e=>e.IsSelected=n.e.IsEmpty(e.AppRemarks)).length>0)return void(this.DisplayMessage="Remarks Mandatory For Approval");if(this.Parent.ScreenObject.Preferences.ContainsKey("CommentsMandatoryforReject")&&""!=this.Parent.ScreenObject.Preferences.CommentsMandatoryforReject&&Object(o.j)(this.Parent.ScreenObject.Preferences.CommentsMandatoryforReject)&&this.linkGrid.Table.filter(e=>e.IsSelected=n.e.IsEmpty(e.AppRemarks)).length>0)return this.DisplayMessage="Remarks Mandatory For Reject",void(this.MessageVisibility=!0);if(a.a.SessionManager.IsActionAssigned(this.Parent.CostCenterID,"Edit"))""==this.Filters&&n.e.IsEmpty(this.SrcDocument.SelectedValue)||this.Parent.ScreenObject.GridDataObj.ClearFilters(),a.a.page.HideDialog(),this.Parent.SaveInventoryDocument_1("Approve");else{let e=!0,t="";for(let s=0;s<this.Parent.ScreenObject.GridData.length;s++)"2"==n.e.StringValue(this.Parent.ScreenObject.GridData[s].IsSelected)&&(t+='<Row ID="'+this.Parent.ScreenObject.GridData[s].DocDetailsID.toString()+'" Remarks="'+n.e.StringValue(this.Parent.ScreenObject.GridData[s].AppRemarks)+'" />',5==this.Parent.DocumentType&&""!=this.Parent.ScreenObject.GridData[s].TODocDetailsID.toString()&&(t+='<Row ID="'+this.Parent.ScreenObject.GridData[s].TODocDetailsID.toString()+'" Remarks="'+n.e.StringValue(this.Parent.ScreenObject.GridData[s].AppRemarks)+'" />'));""!=t.toString()&&(t="<XML>"+t,t+="</XML>",this.Parent.SaveStatus(372,0,t.toString()),e=!1),t="";for(let s=0;s<this.Parent.ScreenObject.GridData.length;s++)"1"==n.e.StringValue(this.Parent.ScreenObject.GridData[s].IsSelected)&&(t+='<Row ID="'+n.e.String(this.Parent.ScreenObject.GridData[s].DocDetailsID),t+='" WID="'+this.Parent.GetWorkFlow(!1,this.Parent.ScreenObject.GridData[s]),t+='" Remarks="'+n.e.String(this.Parent.ScreenObject.GridData[s].AppRemarks)+'" />',5==this.Parent.DocumentType&&""!=this.Parent.ScreenObject.GridData[s].TODocDetailsID.toString()&&(t+='<Row ID="'+n.e.String(this.Parent.ScreenObject.GridData[s].TODocDetailsID),t+='" WID="'+this.Parent.GetWorkFlow(!1,this.Parent.ScreenObject.GridData[s]),t+='" Remarks="'+n.e.String(this.Parent.ScreenObject.GridData[s].AppRemarks)+'" />'));""!=t.toString()&&(t="<XML>"+t,t+="</XML>",this.Parent.SaveStatus(369,0,t.toString(),e)),""==this.Filters&&n.e.IsEmpty(this.SrcDocument.SelectedValue)||this.Parent.ScreenObject.GridDataObj.ClearFilters(),a.a.page.HideDialog()}}else this.DisplayMessage="Select either Approve or Reject or else Cancel to Quit",this.MessageVisibility=!0}else if("OK"==e){let e=this.linkGrid.Columns[0].ComboData;for(let t=0;t<this.linkGrid.Table.length;t++)if(""!=this.linkGrid.Table[t].SrcCostCenterColID.toString()&&""!=this.linkGrid.Table[t].DestCostCenterColID.toString()){let s=e.filter(e=>e.CostCenterColID==this.linkGrid.Table[t].SrcCostCenterColID),i=s[0].SysColumnName.toString();s=e.filter(e=>e.CostCenterColID==this.linkGrid.Table[t].DestCostCenterColID);let n=s[0].SysColumnName.toString();i.toLowerCase().Contains("dcnum")&&n.toLowerCase().Contains("dcnum")?(a.a.common.GetDataSet3("DOC044",n+","+i,this.SrcDocument.SelectedValue+","+this.DestDocument.SelectedValue,this.FromDate.Date.ToString("dd/MMM/yyyy")+","+this.ToDate.Date.ToString("dd/MMM/yyyy")),this.DisplayMessage="updated succesfully"):i.toLowerCase().Contains("dcnum")&&""!=n&&!n.toLowerCase().Contains("dcnum")?(a.a.common.GetDataSet3("DOC045",n+","+i,this.SrcDocument.SelectedValue+","+this.DestDocument.SelectedValue,this.FromDate.Date.ToString("dd/MMM/yyyy")+","+this.ToDate.Date.ToString("dd/MMM/yyyy")),this.DisplayMessage="updated succesfully"):""!=i&&!i.toLowerCase().Contains("dcnum")&&n.toLowerCase().Contains("dcnum")?(a.a.common.GetDataSet3("DOC046",n+","+i,this.SrcDocument.SelectedValue+","+this.DestDocument.SelectedValue,this.FromDate.Date.ToString("dd/MMM/yyyy")+","+this.ToDate.Date.ToString("dd/MMM/yyyy")),this.DisplayMessage="updated succesfully"):""==i||i.toLowerCase().Contains("dcnum")||""==n||n.toLowerCase().Contains("dcnum")||(a.a.common.GetDataSet3("DOC047",n+","+i,this.SrcDocument.SelectedValue+","+this.DestDocument.SelectedValue,this.FromDate.Date.ToString("dd/MMM/yyyy")+","+this.ToDate.Date.ToString("dd/MMM/yyyy")),this.DisplayMessage="updated succesfully")}}}}var ve=s("/dSa"),xe=s("JTUb"),_e=s("5FTv"),ke=s("ia84"),Ke=s("SW+i"),Qe=s("bh5u"),He=s("6z9j");class We extends l.b{constructor(e,t,s){if(super(),this.IsCopy=!1,this.dsCopy=null,this.dscols=null,this.isCancel=!1,this.Parent=e,this.IsCopy=t,this.tree=[],this.Header=this.IsCopy?"Copy":a.a.GetResource("SelectDocument"),this.CostCenters=new D.e(0),this.CostCenters.SelectionChangedCommand.Subscribe(this,"OnCostCenterChange"),t){let e=we.a.GetAllDocuments();if(null!=e&&e.Tables.length>0&&e.Tables[0].length>0){let t=e.Tables[3].filter(e=>e.CostCenterIDBase==s);for(let s=0;s<t.length;s++){let i=t[s];for(let t=0;t<e.Tables[6].length;t++)if(i.CostCenterIDLinked.toString()==e.Tables[6][t].CostCenterID.toString()){if(e.Columns[6].Contains("Isinventory")&&this.Parent.IsInventoryVoucher!=Object(o.j)(e.Tables[6][t].Isinventory.toString()))continue;this.CostCenters.Items.push(D.d.ComboBoxItems_6(e.Tables[6][t].ResourceData.toString(),e.Tables[6][t].CostCenterID.toString(),Object(o.j)(parseInt(i.SelectionType)),i.GridViewID.toString(),e.Tables[6][t].DocumentType.toString()))}}}this.CostCenters.SelectedValue=s,this.CostCenters.SelectedItem=this.CostCenters.GetselectedItem(),this.OnCostCenterChange("")}else this.CostCenters.Items.push(D.d.ComboBoxItems_6("",s.toString(),!1,"0",this.Parent.DocumentType.toString())),this.CostCenters.SelectedValue=s,this.CostCenters.SelectedItem=this.CostCenters.GetselectedItem(),this.OnCostCenterChange(""),this.CostCenters.Visible=!1;this.CostCenters.Label=a.a.GetResource("SelectDocument")}get ClearSelectedNodes(){return this._ClearSelectedNodes}set ClearSelectedNodes(e){this._ClearSelectedNodes=e,this.tree.length>0&&(this.tree[0].ClearAllSelectedNodes=!this.tree[0].ClearAllSelectedNodes)}Refresh(){null!=this.tree&&this.tree.length>0&&(this.tree[0].RefreshData=!0)}OnCostCenterChange(e){if(!n.e.IsEmpty(this.CostCenters.SelectedValue)){if(null!=this.ccID&&this.CostCenters.SelectedValue==this.ccID)return;this.ccID=this.CostCenters.SelectedValue,this.tree.Clear();let e=0;!this.CostCenters.SelectedItem||n.e.IsEmpty(this.CostCenters.SelectedItem.Parent)||n.e.Double(this.CostCenters.SelectedItem.Aliasname)>0||!n.e.IsNum(this.CostCenters.SelectedItem.Parent)?(e=parseInt(this.CostCenters.SelectedValue),e>40999&&!(null!=this.CostCenters.SelectedItem&&parseInt(this.CostCenters.SelectedItem.Aliasname)>0)&&(e=4e4+this.Parent.DocumentType)):parseInt(this.CostCenters.SelectedItem.Parent)<33?e=4e4+parseInt(this.CostCenters.SelectedItem.Parent):33==parseInt(this.CostCenters.SelectedItem.Parent)?e=40998:34==parseInt(this.CostCenters.SelectedItem.Parent)?e=40999:35==parseInt(this.CostCenters.SelectedItem.Parent)?e=40997:36==parseInt(this.CostCenters.SelectedItem.Parent)?e=40995:37==parseInt(this.CostCenters.SelectedItem.Parent)&&(e=40996);let t=new He.a;t.TreeViewModel(e,this,null!=this.CostCenters.SelectedItem?parseInt(this.CostCenters.SelectedItem.Aliasname):0,"",Date.Today(),"","","",this.CostCenters.SelectedValue,""),t.HeaderVisiblity=!1,t.ViewsVisible=!1,this.tree.push(t),null!=t.Data&&t.Data.length>0?this.MessageVisibility=!1:(this.MessageVisibility=!0,this.DisplayMessage=a.a.GetResource("CopyDocNoDocs"))}}OnSearch(e){"OK"==e.toString()?null==this.SelectedNode&&null==this.SelectedNodes?(this.DisplayMessage=a.a.GetResource("CopyDocNoSelection"),this.MessageVisibility=!0):this.SelectDcument(!0):"Cancel"==e.toString()&&(this.Parent.DialogResult=!1,a.a.page.HideDialog())}CommandController(e){this.SelectDcument(!1)}SelectDcument(e){if(!this.IsCopy)return null!=this.SelectedNode&&(this.Parent.ScreenObject.DocPrefix.ComboBox.Items.find(e=>e instanceof D.d&&e.Value==this.SelectedNode.Text[this.SelectedNode.Text.length-2])||this.Parent.ScreenObject.DocPrefix.ComboBox.Items.push(D.d.ComboBoxItems_2(this.SelectedNode.Text[this.SelectedNode.Text.length-2],this.SelectedNode.Text[this.SelectedNode.Text.length-2])),this.Parent.ScreenObject.DocPrefix.ComboBox.SelectedValue=this.SelectedNode.Text[this.SelectedNode.Text.length-2],this.Parent.ScreenObject.DocPrefix.TextBox.Text=this.SelectedNode.Text[this.SelectedNode.Text.length-1],this.Parent.OnDocPrefixChanged("lostFocus")),void a.a.page.HideDialog();let t="";this.Parent.IsInventoryVoucher?t="ProductID_Key":this.Parent.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")?t="CreditAccount_Key":this.Parent.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")?t="DebitAccount_Key":this.Parent.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&(t="AccountID_Key");let s=this.Parent.GetEmptyRowPosition(this.Parent.ScreenObject.GridDataObj,t);if(null!=this.CostCenters.SelectedValue&&(this.dscols=this.Parent.ScreenObject.GetCopyLinkDetails(this.Parent.CostCenterID,parseInt(this.CostCenters.SelectedValue))),null!=this.dscols&&this.dscols.Tables.length>0&&!this.dscols.Columns[0].Contains("ErrorMessage")&&this.dscols.Tables[0].length>0||parseInt(this.CostCenters.SelectedValue)==this.Parent.CostCenterID){if(e&&null!=this.SelectedNodes&&this.SelectedNodes.length>1)for(let e=0;e<this.SelectedNodes.length;e++){let t=this.SelectedNodes[e];this.dsCopy=this.Parent.ScreenObject.GetEditDataCopy(t.Text[this.SelectedNode.Text.length-3],t.Text[this.SelectedNode.Text.length-2],this.CostCenters.SelectedValue),null!=this.CostCenters.SelectedItem&&this.CostCenters.SelectedItem.Status&&a.a.page.HideDialog(),this.isCancel||(null!=this.dscols&&this.dscols.Tables.length>0&&this.dscols.Tables[0].length>0?(this.Parent.LoadLinkData(this.dsCopy,new Array,s,new Array,this.dscols.Tables[0]),null!=this.dsCopy&&this.dsCopy.Tables.length>0&&!this.dsCopy.Columns[0].Contains("ErrorMessage")&&(s+=this.dsCopy.Tables[0].length)):parseInt(this.CostCenters.SelectedValue)==this.Parent.CostCenterID&&(this.Parent.ScreenObject.LoadEditData(this.dsCopy,!0),null!=this.Parent.ViewAttachments&&this.dsCopy.Tables.length>8&&(this.dsCopy.Tables[8].Columns.FileID.Expression="0",this.Parent.ViewAttachments.LoadAttachments(this.dsCopy.Tables[8]))))}else null!=this.SelectedNode&&(this.dsCopy=this.Parent.ScreenObject.GetEditDataCopy(this.SelectedNode.Text[this.SelectedNode.Text.length-3],this.SelectedNode.Text[this.SelectedNode.Text.length-2],this.CostCenters.SelectedValue),null!=this.CostCenters.SelectedItem&&this.CostCenters.SelectedItem.Status&&a.a.page.HideDialog(),this.isCancel||(null!=this.dscols&&this.dscols.Tables.length>0&&this.dscols.Tables[0].length>0?this.Parent.LoadLinkData(this.dsCopy,new Array,s,new Array,this.dscols.Tables[0]):parseInt(this.CostCenters.SelectedValue)==this.Parent.CostCenterID&&(this.Parent.ScreenObject.LoadEditData(this.dsCopy,!0),null!=this.Parent.ViewAttachments&&this.dsCopy.Tables.length>8&&(this.dsCopy.Tables[8].Columns.FileID.Expression="0",this.Parent.ViewAttachments.LoadAttachments(this.dsCopy.Tables[8])))));this.Parent.ScreenObject.UpdateSequence()}this.Parent.DialogResult=!0,a.a.page.HideDialog()}}var Ue=s("CQvG"),Xe=s("DKUf"),qe=s("31sV"),Ye=s("JUeo"),Je=s("V52s"),ze=s("kD5w"),Ze=s("0LKI");class $e{constructor(e){this.sbErrorMsg="",this.sbErrorMsgCmplt="",this.iBudgetDimension=0,this.QtyType=0,this.DueDateCheck=!1,this.BudgetDateField="",this.BudgetAccountField="",this.lstBudgets=new r.c,this.Document=e,this.iBudgetDimension=a.a.SessionManager.Preferences.BudgetDimension.length>0?parseInt(a.a.SessionManager.Preferences.BudgetDimension):0;let t=!0;this.ScreenObject.Preferences.ContainsKey("DonotupdateAccounts")&&""!=this.ScreenObject.Preferences.DonotupdateAccounts&&(t=Object(o.j)(this.ScreenObject.Preferences.DonotupdateAccounts)),this.ScreenObject.IsInventory&&t&&this.ScreenObject.Preferences.ContainsKey("BUDGET_DueDateCheck")&&"TRUE"==this.ScreenObject.Preferences.BUDGET_DueDateCheck.toUpperCase()&&(this.DueDateCheck=!0),this.ScreenObject.IsInventory&&this.ScreenObject.Preferences.ContainsKey("BUDGET_BudgetDateField")&&!n.e.IsEmpty(this.ScreenObject.Preferences.BUDGET_BudgetDateField)&&(this.BudgetDateField=this.ScreenObject.Preferences.BUDGET_BudgetDateField),this.ScreenObject.IsInventory&&this.ScreenObject.Preferences.ContainsKey("BUDGET_BudgetAccountField")&&!n.e.IsEmpty(this.ScreenObject.Preferences.BUDGET_BudgetAccountField)&&(this.BudgetAccountField=this.ScreenObject.Preferences.BUDGET_BudgetAccountField)}get ScreenObject(){return this.Document.ScreenObject}BudgetValidation(e){if(this.Document.DisplayMessage="",this.sbErrorMsg="",this.sbErrorMsgCmplt="",this.Document.IgnoreOnSave.ContainsKey("BUDGET"))return void("true"==a.a.SessionManager.Preferences.GBudgetUnapprove.toLowerCase()&&(this.Document.DisplayMessage=this.Document.IgnoreOnSave.BUDGET.toString()));this.lstBudgets.Clear();let t=new n.f;e.startsWith("\x11".toString())&&(e="<XML>"+(e=e.replace("\x11",""))+"</XML>"),t.LoadXml(e);let s={date:this.ScreenObject.DocDate.Date,strDateXML:""};if(n.e.IsEmpty(this.BudgetDateField)){if(this.DueDateCheck&&(this.BudgetField("DueDate",s,t),0==this.lstBudgets.length))return void Logger.DebugLog("No Budgets Found For Non Accounting Documents.")}else this.BudgetField(this.BudgetDateField,s,t);try{this.CheckBudget(t,s.date,s.strDateXML)}catch(i){this.Document.DisplayMessage="Budget Error",Logger.ErrorLog("BudgetValidation: "+i.stack)}if(this.sbErrorMsg.length>0||this.sbErrorMsgCmplt.length>0)if(this.sbErrorMsg.length>0&&"1"!=a.a.SessionManager.RoleID&&a.a.SessionManager.IsActionAssigned(101,"Dont Save Voucher If Amount Exceeds Budget"))alert(this.sbErrorMsg),this.Document.DisplayMessage="Budget Error";else if(this.sbErrorMsgCmplt.length>0&&"1"!=a.a.SessionManager.RoleID&&a.a.SessionManager.IsActionAssigned(101,"Dont Save Voucher If Amount Exceeds Total Budget"))alert(this.sbErrorMsgCmplt),this.Document.DisplayMessage="Budget Error";else if(this.sbErrorMsg.length>0){let e=confirm(this.sbErrorMsg+"\r\n Do you want to continue?");this.Document.DisplayMessage=e?"true"!=a.a.SessionManager.Preferences.GBudgetUnapprove.toLowerCase()?"":"Budget Error":" "}}BudgetField(e,t,s){var i=this.ScreenObject._TextFields.find(t=>t.DBColumnName==e);if("DueDate"==e&&this.ScreenObject.DueDate||e.Contains("dcAlpha")&&i instanceof d.c){"DueDate"==e&&this.ScreenObject.DueDate.Date?t.date=this.ScreenObject.DueDate.Date:e.Contains("dcAlpha")&&i.Date&&(t.date=i.Date);let s=this.ScreenObject.Data.Tables[5].filter(e=>e.FromDate<=t.date&&e.ToDate>=t.date);s.length>0&&this.lstBudgets.push(parseInt(s[0].BudgetDefID),null)}else{let i=!1;console.log(s.DocumentElement),alert("check:budget-75");let a=n.f.SelectNodes(s.DocumentElement,"Row/Transactions");for(let s=0;s<a.length;s++){let n=a[s];if(null!=n.attributes[e]&&""!=n.attributes[e].Value){t.strDateXML+='<Row Date="'+n.attributes[e].Value+'" />';let s=this.ScreenObject.Data.Tables[5].filter(t=>t.FromDate<=n.attributes[e].Value&&t.ToDate>=n.attributes[e].value);if(0==s.length){Logger.DebugLog("Budget Not Found");continue}let i=parseInt(s[0].BudgetDefID);this.lstBudgets.ContainsKey(i)||this.lstBudgets.push(i,null),n.setAttribute("BudgetID",i.toString())}else{i=!0;let e=this.ScreenObject.Data.Tables[5].filter(e=>e.FromDate<=this.ScreenObject.DocDate.Date&&e.ToDate>=this.ScreenObject.DocDate.Date);if(0==e.length){Logger.DebugLog("Budget Not Found");continue}let t=parseInt(e[0].BudgetDefID);this.lstBudgets.ContainsKey(t)||this.lstBudgets.push(t,null),n.setAttribute("BudgetID",t.toString())}}t.strDateXML.length>0&&(i&&(t.strDateXML+='<Row Date="'+this.ScreenObject.DocDate.Date.ToString("dd MMM yyyy")+'" />'),t.strDateXML="<XML>"+t.strDateXML+"</XML>")}}CheckBudget(e,t,s){let i,o,l,c,h=0,u=0,d=0,D=null,S="";if(this.Document.IsInventoryVoucher){if(0==this.lstBudgets.length){if(D=new et(this.Document,t,0),D.IsEmtyOrNoDefn)return}else this.lstBudgets.keys.forEach(e=>{let s=new et(this.Document,t,e);this.lstBudgets[e]=s});for(let s=0;s<e.DocumentElement.children.length;s++){let i=e.DocumentElement.children[s];if(!n.e.IsEmpty(o.attributes.IsSelected)&&"2"==o.attributes.IsSelected.value)return;c=t,o=n.f.SelectSingleNode(i,"Transactions"),c=t,n.e.IsEmpty(this.BudgetDateField)||null==o.attributes[this.BudgetDateField]||""==o.attributes[this.BudgetDateField].value?this.DueDateCheck&&!n.e.IsEmpty(o.attributes.DueDate)&&""!=o.attributes.DueDate.value&&(c=new Date(o.attributes.DueDate.value)):c=new Date(o.attributes[this.BudgetDateField].value);let r=D;if(this.lstBudgets.length>0&&(r=n.e.IsEmpty(o.attributes.BudgetID)?this.lstBudgets.values[0]:this.lstBudgets[parseInt(o.attributes.BudgetID.value)]),r.IsEmtyOrNoDefn)return;if(r.SetCurrentBudgetColumn(c,!1,this.BudgetDateField),r.IsEmtyOrNoDefn)return;if(r.ClearInput(),l=n.f.SelectSingleNode(i,"CostCenters"),null!=l.attributes.Query){let e,t;l.attributes.Query.value.split(",").forEach(s=>{if(e=s.Trim(),e.startsWith("dcCCNID")&&(e=e.replace("dcCCNID",""),t=e.split("="),parseInt(t[1])>1)){let e="D"+(5e4+parseInt(t[0])).toString();r.dtBdgtTblColumns.Contains(e)&&(r.dtBdgtInp[0][e]=t[1])}})}if(r.dtBdgtTblColumns.Contains("D3")&&(d=parseInt(o.attributes.ProductID.value),r.dtBdgtInp[0].D3=d),r.dtBdgtInp[0].DocSeqNo=o.attributes.DocSeqNo.value,null!=o.attributes.LinkedInvDocDetailsID&&""!=o.attributes.LinkedInvDocDetailsID.value&&(r.dtBdgtInp[0].LinkedInvDocDetailsID=o.attributes.LinkedInvDocDetailsID.value,null!=o.attributes.LinkedFieldValue&&""!=o.attributes.LinkedFieldValue.value&&(r.dtBdgtInp[0].LinkedFieldValue=o.attributes.LinkedFieldValue.value)),r.IsQtyBudget>0){let t=0;for(let s=0;s<e.DocumentElement.children.length;s++)parseInt(o.attributes.ProductID.value)==d&&(1==this.QtyType?null!=o.attributes.IsQtyFreeOffer&&parseInt(o.attributes.IsQtyFreeOffer.value)>0&&(1==parseInt(o.attributes.IsQtyFreeOffer.value)||null!=o.attributes.ParentSchemeID&&"0"!=o.attributes.ParentSchemeID.value)&&(t+=parseFloat(o.attributes.UOMConvertedQty.value)):2==this.QtyType?(null==o.attributes.IsQtyFreeOffer||parseInt(o.attributes.IsQtyFreeOffer.value)>1&&null==n.f.SelectSingleNode(i,"Transactions").attributes.ParentSchemeID)&&(t+=parseFloat(o.attributes.UOMConvertedQty.value)):t+=parseFloat(o.attributes.UOMConvertedQty.value));if(r.dtBdgtInp[0]["Amount Used"]=t,r.dtBdgtTblColumns.Contains("D2")&&(u=this.ScreenObject.IsPurchase?parseInt(o.attributes.CreditAccount.value):parseInt(o.attributes.DebitAccount.value),r.dtBdgtInp[0].D2=u),r.CheckBudgetRow(),this.CheckAlertMsg())return}else if(r.NonAccountingDocs.Contains(this.Document.CostCenterID.toString())){let e=0,t=n.f.SelectSingleNode(i,"Numeric");if(null!=t.attributes.Query){let e;t.attributes.Query.value.split(",").forEach(t=>{e=t.Trim(),e.startsWith("dcCalcNum"+r.NonAccountingDocsField+"=")&&(e=e.replace("dcCalcNum"+r.NonAccountingDocsField+"=",""))})}if(0!=e)if(r.IsAccountTypeWise){if(S=o.attributes.DebitAccount.value+","+o.attributes.CreditAccount.value+",",S.length>0){r.dtBdgtInp[0]["Amount Used"]=0;let t=a.a.common.GetDataSet("DOC036",S.TrimEnd(",")).Tables[0],s=t.filter(e=>e.AccountID==o.attributes.DebitAccount.value);if(s.length>0&&r.SelectedAccountTypes.Contains(s[0].AccountTypeID.toString())&&(r.dtBdgtInp[0]["Amount Used"]=e),s=t.filter(e=>e.AccountID==o.attributes.CreditAccount.value),s.length>0&&r.SelectedAccountTypes.Contains(s[0].AccountTypeID.toString())&&(r.dtBdgtInp[0]["Amount Used"]=-e),r.CheckBudgetRow(),this.CheckAlertMsg())return}}else{if(r.dtBdgtInp[0]["Amount Used"]=e,r.dtBdgtInp[0].D2=parseInt(o.attributes.CreditAccount.value),r.CheckBudgetRow(),this.CheckAlertMsg())return;if(r.dtBdgtInp[0].D2=parseInt(o.attributes.DebitAccount.value),r.CheckBudgetRow(),this.CheckAlertMsg())return}}else if(r.IsAccountTypeWise){S="";let e=n.f.SelectSingleNode(i,"AccountsXML");for(let t=0;t<e.children.length;t++)S+=e.children[t].attributes.DebitAccount.value+",",S+=e.children[t].attributes.CreditAccount.value+",";if(S.length>0){r.dtBdgtInp[0]["Amount Used"]=0;let e,t=a.a.common.GetDataSet("DOC036",S.TrimEnd(",")).Tables[0],s=n.f.SelectSingleNode(i,"AccountsXML").children;for(let i=0;i<s.length;i++){let a=s[i];e=t.filter(e=>e.AccountID==o.attributes.DebitAccount.value),e.length>0&&r.SelectedAccountTypes.Contains(e[0].AccountTypeID.toString())&&(r.dtBdgtInp[0]["Amount Used"]=parseFloat(r.dtBdgtInp[0]["Amount Used"])+parseFloat(a.attributes.Amount.value)),e=t.filter(e=>e.AccountID==o.attributes.CreditAccount.value),e.length>0&&r.SelectedAccountTypes.Contains(e[0].AccountTypeID.toString())&&(r.dtBdgtInp[0]["Amount Used"]=parseFloat(r.dtBdgtInp[0]["Amount Used"])-parseFloat(a.attributes.Amount.value))}if(r.CheckBudgetRow(),this.CheckAlertMsg())return}}else{let e=n.f.SelectSingleNode(i,"AccountsXML").children;for(let t=0;t<e.length;t++){let s=e[t];if(r.dtBdgtInp[0]["Amount Used"]=parseFloat(s.attributes.Amount.value),r.ChkBudgetOnlyForDefnAccounts){if(r.dtBdgtTblColumns.Contains("D2")){if(r.dtBdgtInp[0].D2=parseInt(s.attributes.DebitAccount.value),r.CheckBudgetRow(),this.CheckAlertMsg())return;if(r.dtBdgtInp[0].D2=parseInt(s.attributes.CreditAccount.value),r.CheckBudgetRow(),this.CheckAlertMsg())return}}else if(r.dtBdgtTblColumns.Contains("D2")&&(u=parseInt(s.attributes.DebitAccount.value),r.dtBdgtInp[0].D2=u),r.CheckBudgetRow(),this.CheckAlertMsg())return}if(!n.e.IsEmpty(this.BudgetAccountField)&&null!=o.attributes[this.BudgetAccountField].value&&n.e.IsNum(o.attributes[this.BudgetAccountField].value)&&(u=n.e.Int(o.attributes[this.BudgetAccountField].value),r.dtBdgtInp[0].D2=u,r.CheckBudgetRow(),this.CheckAlertMsg()))return}}}else{if(D=new et(this.Document,t,0),D.IsEmtyOrNoDefn)return;let s,c,u,d=null,m=[],b=[],C=m;D.lstDimensions.forEach(e=>{b.push("D"+e)}),D.IsAccountTypeWise&&b.push("D2"),b.push("Amount"),b.push("AccountType"),b.push("DocSeqNo"),S="",new r.c,new r.c;for(let t=0;t<e.DocumentElement.children.length;t++){let a=e.DocumentElement.children[t],r=[],h=[];o=n.f.SelectSingleNode(a,"Transactions"),l=n.f.SelectSingleNode(a,"CostCenters");let u=[];u=null!=l.attributes.Query?l.attributes.Query.value.split(","):[],c=m,D.lstDimensions.forEach(e=>{if(e>5e4){s="dcCCNID"+(e-5e4)+"=";var t=u.find(e=>e.Trim().startsWith(s));s=t?t.Trim().Replace(s,""):"1",r["D"+e]=h["D"+e]=s,c=m.filter(t=>t["D"+e]==s)}}),i=parseFloat(o.attributes.Amount.value),C=c.filter(e=>e.D2==o.attributes.DebitAccount.value),C.length>0?(C[0].Amount=parseFloat(C[0].Amount)+i,C[0].DocSeqNo=o.attributes.DocSeqNo.value):(S+=o.attributes.DebitAccount.value+",",r.D2=o.attributes.DebitAccount.value,r.Amount=i,r.DocSeqNo=o.attributes.DocSeqNo.value,m.push(r)),C=c.filter(e=>e.D2==o.attributes.CreditAccount.value),C.length>0?(C[0].Amount=parseFloat(C[0].Amount)-i,C[0].DocSeqNo=o.attributes.DocSeqNo.value):(S+=o.attributes.CreditAccount.value+",",h.D2=o.attributes.CreditAccount.value,h.Amount=-i,h.DocSeqNo=o.attributes.DocSeqNo.value,m.push(h))}if(S.length>0&&(d=a.a.common.GetDataSet("DOC036",S.TrimEnd(",")).Tables[0]),m.forEach(e=>{let t=d.filter(t=>t.AccountID==e.D2);u=parseInt(t[0].AccountTypeID),e.AccountType=u}),D.IsAccountTypeWise){let e=!1;for(let t=0;t<m.length;t++)if(u=parseInt(m[t].AccountType),D.SelectedAccountTypes.Contains(u.toString()))for(let s=t+1;s<m.length;s++)if(D.SelectedAccountTypes.Contains(m[s].AccountType.toString())){e=!1;for(let i=0;i<D.lstDimensions.length;i++){let a=D.lstDimensions[i];if(m[t]["D"+a].toString()!=m[s]["D"+a].toString()){e=!0;break}}e||(m[t].Amount=parseFloat(m[t].Amount)+parseFloat(m[s].Amount),m.RemoveAt(s),s--)}else m.RemoveAt(s),s--;else m.RemoveAt(t),t--}for(let e=0;e<m.length;e++){let t=m[e];if(u=parseInt(t.AccountType),h=parseFloat(t.Amount),h>0&&(D.ChkBudgetOnlyForDefnAccounts||7==u||12==u)&&(D.ClearInput(),D.dtBdgtInp[0]["Amount Used"]=t.Amount,D.dtBdgtInp[0].DocSeqNo=t.DocSeqNo,D.lstDimensions.forEach(e=>{D.dtBdgtInp[0]["D"+e]=t["D"+e]}),D.CheckBudgetRow(),this.CheckAlertMsg()))return}}}ValidateBudget(e,t){t.dim=null,t.LineWiseBudget=!1,t.BudID=0,t.BudStartDate=new Date;let s="";if(this.ScreenObject.Data.Tables.length>4&&this.ScreenObject.Data.Tables[5].length>0){let a=this.ScreenObject.Data.Tables[5].filter(t=>t.QtyBudget==e.toString()&&t.FromDate<=this.Document.DocumentDate&&t.ToDate>=this.Document.DocumentDate);if(a.sort((e,t)=>e.BudgetDefID-t.BudgetDefID),a.length>0){t.dim=[],t.BudID=parseInt(a[0].BudgetDefID.toString()),t.BudStartDate=new Date(a[0].FromDate.toString());for(let e=0;e<a.length;e++)if("3"==a[e].CostCenterID.toString()||""!=a[e].CostCenterID.toString()&&parseInt(a[e].CostCenterID.toString())>5e4&&this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(parseInt(a[e].CostCenterID.toString())-5e4)))t.LineWiseBudget=!0,t.dim.push(a[e].CostCenterID.toString());else{var i=this.ScreenObject._CCFields.find(t=>t.DBColumnName.toLowerCase()=="dcccnid"+(parseInt(a[e].CostCenterID.toString())-5e4));i&&i instanceof m.b&&i.SelectedValue>0?s+=" and dcccnid"+(parseInt(a[e].CostCenterID.toString())-5e4)+"="+i.SelectedValue:"2"==a[e].CostCenterID.toString()?this.ScreenObject.IsPurchase&&null!=this.ScreenObject.CreditAccount&&this.ScreenObject.CreditAccount.SelectedValue>0?s+=" and CreditAccount="+this.ScreenObject.CreditAccount.SelectedValue:!this.ScreenObject.IsPurchase&&null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.SelectedValue>0&&(s+=" and DebitAccount="+this.ScreenObject.DebitAccount.SelectedValue):s+=" and dcccnid"+(parseInt(a[e].CostCenterID.toString())-5e4)+"=1"}}}return s}AutoBudgetDate(e,t,s){if(t.Table.Columns.Contains(e+"_Key")&&null!=t[e+"_Key"])s.date=new Date(t[e+"_Key"]);else if("DueDate"==e&&null!=this.ScreenObject.DueDate&&this.ScreenObject.DueDate.Date)s.date=this.ScreenObject.DueDate.Date;else if(e.Contains("dcAlpha")){var i=this.ScreenObject._TextFields.find(t=>t.DBColumnName==e);i instanceof d.c&&i.Date&&(s.date=i.Date)}}AutoLoadBudgetDimension(e,t){let s=this.ScreenObject.DocDate.Date;this.DueDateCheck&&(e.DueDate_Key?s=new Date(e.DueDate_Key):this.ScreenObject.DueDate.Date&&(s=this.ScreenObject.DueDate.Date));let i=this.ScreenObject.Data.Tables[5].filter(e=>e.CostCenterID==a.a.SessionManager.Preferences.BudgetDimension&&0==e.QtyBudget&&(0==this.QtyType||!this.QtyType)&&e.FromDate<=s&&e.ToDate>=s),r="";if(i.length>0&&this.ScreenObject.Data.Tables[5].filter(e=>e.BudgetDefID==i[0].BudgetDefID).forEach(t=>{let s=parseInt(t.CostCenterID);if(2==s){let t="";null!=this.ScreenObject.CreditAccount&&this.ScreenObject.CreditAccount.SelectedValue>0&&(t+=this.ScreenObject.CreditAccount.SelectedValue),null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.SelectedValue>0&&(t.length>0&&(t+=","),t+=this.ScreenObject.DebitAccount.SelectedValue),this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&""!=e.DebitAccount_Key.toString()&&(t.length>0&&(t+=","),t+=e.DebitAccount_Key.toString()),this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&""!=e.CreditAccount_Key.toString()&&(t.length>0&&(t+=","),t+=e.CreditAccount_Key.toString()),this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&""!=e.AccountID_Key.toString()&&(t.length>0&&(t+=","),t+=e.AccountID_Key.toString()),n.e.IsEmpty(this.BudgetAccountField)||!this.ScreenObject.GridDataColumns.Contains(this.BudgetAccountField+"_Key")||n.e.IsEmpty(e[this.BudgetAccountField+"_Key"])||(t.length>0&&(t+=","),t+=e[this.BudgetAccountField+"_Key"].toString()),t.length>0&&(r+=" and B.AccountID in("+t+")")}else if(t.CostCenterID.toString()!=a.a.SessionManager.Preferences.BudgetDimension&&s>5e4)if(this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(s-5e4)))""!=e["dcCCNID"+(s-5e4)+"_Key"].toString()&&(r+=" and B.CCNID"+(s-5e4).toString()+"="+e["dcCCNID"+(s-5e4)+"_Key"].toString());else if(t.CostCenterID.toString()!=a.a.SessionManager.Preferences.BudgetDimension){let e=this.ScreenObject._CCFields.find(e=>e instanceof m.b&&e.DBColumnName.toLowerCase()=="dcccnid"+(parseInt(t.CostCenterID.toString())-5e4));e instanceof m.b&&e.SelectedValue>0&&(r+=" and B.CCNID"+(e.CCID-5e4)+"="+e.SelectedValue)}}),r.length>0){let s=i[0].BudgetDefID.toString();for(let e=1;e<i.length;e++)s+=","+i[e].BudgetDefID.toString();s=i.length>1?"B.BudgetDefID IN ("+s+")":"B.BudgetDefID="+s;let n="A.NodeID IN (select B.CCNID"+(this.iBudgetDimension-5e4)+" from COM_BudgetAlloc B with(nolock)\n                 where "+s+r;if(a.a.SessionManager.Preferences.BudgetAccount.length>0&&(n=n+" union\n                 select B.CCNID"+(this.iBudgetDimension-5e4)+"\n                 from COM_CostCenterCostCenterMap M with(nolock) \n                 inner join COM_BudgetAlloc B with(nolock) ON B.CCNID"+(this.iBudgetDimension-5e4)+"=M.NodeID\n                 where "+s+" and B.AccountID="+a.a.SessionManager.Preferences.BudgetAccount+" and M.ParentCostCenterID=2 and M.CostCenterID="+a.a.SessionManager.Preferences.BudgetDimension+"\n                 "+r.replace("B.AccountID","M.ParentNodeID")+" group by B.CCNID"+(this.iBudgetDimension-5e4)),n+=" )",null!=t)t.Where=n;else if(this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(this.iBudgetDimension-5e4)+"_Key")){let t=a.a.report.GetTableColumns(this.iBudgetDimension),s=a.a.common.GetDataSet3("DOC037",t.TableName,n);1==s.Tables[0].length&&s.Columns[0].Contains("name")?(e["dcCCNID"+(this.iBudgetDimension-5e4)+"_Key"]=s.Tables[0][0].NodeID,e["dcCCNID"+(this.iBudgetDimension-5e4)]=s.Tables[0][0].Name.toString()):0==s.Tables[0].length&&(e["dcCCNID"+(this.iBudgetDimension-5e4)+"_Key"]=null,e["dcCCNID"+(this.iBudgetDimension-5e4)]=null)}}}CheckAlertMsg(){return this.Document.DisplayMessage.length>0&&(this.sbErrorMsg+=this.sbErrorMsg.length>0?"\r\n":""+this.Document.DisplayMessage,this.Document.DisplayMessage=""),null!=this.Document.AppDisplayMessage&&this.Document.AppDisplayMessage.length>0&&(this.sbErrorMsgCmplt+=(this.sbErrorMsgCmplt.length>0?"\r\n":"")+this.Document.AppDisplayMessage,this.Document.AppDisplayMessage=""),!1}}class et{constructor(e,t,s){this.QtyType=0,this.IsQtyBudget=0,this.stPosDim=-1,this.ChkBudgetOnlyForDefnAccounts=!1,this.IsEmtyOrNoDefn=!1,this.strBudUtilizesColumn="",this.NonAccountingDocs="",this.NonAccountingDocsField="",this.dtBdgtTblColumns=[],this.dtCommonAccounts=null,this.BudgetAccount=0,this.CurrentBudegetSlotIndex=-1,this.CurrentBudegetMonthSlotIndex=-1,this.budgetInput=[],this.budgetTable=[],this.dbl=0,this.budgetUsedInp=0,this.lstDimensions=[],this.strTransLog=null,this.IsAccountTypeWise=!1,this.SelectedAccountTypes=null,this.Document=e,this.ScreenObject=this.Document.ScreenObject;let i=et.GetDocumentBudgetDefn(s,this.Document.CostCenterID,t);if(null==i||i.Tables.length<3||0==i.Tables[0].length)this.IsEmtyOrNoDefn=!0;else{this.lstDimensions.Clear(),this.budgetTable.Clear(),this.BudgetID=parseInt(i.Tables[0][0].BudgetID),this.nDims=parseInt(i.Tables[0][0].NumDimensions),this.BudgetType=parseInt(i.Tables[0][0].BudgetTypeID),""!=i.Tables[0][0].QtyType.toString()&&(this.QtyType=parseInt(i.Tables[0][0].QtyType.toString())),this.BudgetStartYear=new Date(i.Tables[0][0].StartYear),this.ChkBudgetOnlyForDefnAccounts=Object(o.j)(i.Tables[0][0].ChkBudgetOnlyForDefnAccounts),this.NonAccountingDocs=i.Tables[0][0].NonAccDocs.toString(),this.NonAccountingDocsField=i.Tables[0][0].NonAccDocsField.toString(),this.IsQtyBudget=0,this.dtBdgtTbl=i.Tables[2],this.dtBdgtTblColumns=i.Columns[2],this.dtCommonAccounts=null,a.a.SessionManager.Preferences.BudgetAccount.length>0&&a.a.SessionManager.Preferences.BudgetDimension.length>0&&(this.BudgetAccount=n.e.Int(a.a.SessionManager.Preferences.BudgetAccount),this.BudgetAccount>0&&(this.dtCommonAccounts=i.Tables[3].length>0?i.Tables[3]:null)),this.stPosDim=this.dtBdgtTblColumns.length-this.nDims,this.dtBdgtTblColumns.push("Row ID"),this.dtBdgtTblColumns.push("Amount Used"),this.dtBdgtTblColumns.push("Budget Amount"),this.dtBdgtTblColumns.push("Utilized"),this.dtBdgtTblColumns.push("DocSeqNo"),this.dtBdgtTblColumns.push("LinkedInvDocDetailsID"),this.dtBdgtTblColumns.push("LinkedFieldValue");for(let e=0;e<12;e++)this.dtBdgtTblColumns.push("UM"+e);i.Tables[1].forEach(e=>{this.lstDimensions.push(parseInt(e.CostCenterID))}),this.lstDimensions.Contains(2)||(this.SelectedAccountTypes=""!=i.Tables[0][0].AccountTypes.toString()?i.Tables[0][0].AccountTypes.toString().split(","):null,null!=this.SelectedAccountTypes&&(this.IsAccountTypeWise=!0)),this.SetCurrentBudgetColumn(t,!0,""),this.dtBdgtInp=[],this.dtBdgtInp.push({})}}SetCurrentBudgetColumn(e,t,s){if(!(n.e.IsEmpty(s)||e>=this.BudgetStartYear&&e<this.BudgetStartYear.AddMonths(12)))return void(this.IsEmtyOrNoDefn=!0);let i="AnnualAmount";if(this.strBudUtilizesColumn="",this.CurrentBudegetSlotIndex=-1,1==this.BudgetType)t&&(this.dtBdgtTblColumns.push("UH0"),this.dtBdgtTblColumns.push("UH1")),e>=this.BudgetStartYear&&e<this.BudgetStartYear.AddMonths(6)?(this.strBudUtilizesColumn="UH0",i="YearH1Amount",this.CurrentBudegetSlotIndex=2):(this.strBudUtilizesColumn="UH1",i="YearH2Amount",this.CurrentBudegetSlotIndex=2);else if(2==this.BudgetType)t&&(this.dtBdgtTblColumns.push("UQ0"),this.dtBdgtTblColumns.push("UQ1"),this.dtBdgtTblColumns.push("UQ2"),this.dtBdgtTblColumns.push("UQ3")),e>=this.BudgetStartYear&&e<this.BudgetStartYear.AddMonths(3)?(this.strBudUtilizesColumn="UQ0",i="Qtr1Amount",this.CurrentBudegetSlotIndex=1):e>=this.BudgetStartYear.AddMonths(3)&&e<this.BudgetStartYear.AddMonths(6)?(this.strBudUtilizesColumn="UQ1",i="Qtr2Amount",this.CurrentBudegetSlotIndex=2):e>=this.BudgetStartYear.AddMonths(6)&&e<this.BudgetStartYear.AddMonths(9)?(this.strBudUtilizesColumn="UQ2",i="Qtr3Amount",this.CurrentBudegetSlotIndex=3):(this.strBudUtilizesColumn="UQ3",i="Qtr4Amount",this.CurrentBudegetSlotIndex=4);else if(3==this.BudgetType){let t=this.BudgetStartYear;for(let s=1;s<=12;s++){if(e>=t&&e<t.AddMonths(1)){this.strBudUtilizesColumn="UM"+(s-1),i="Month"+s+"Amount",this.CurrentBudegetSlotIndex=s;break}t=t.AddMonths(1)}}let a=this.BudgetStartYear;for(let n=1;n<=12;n++){if(e>=a&&e<a.AddMonths(1)){this.CurrentBudegetMonthSlotIndex=n;break}a=a.AddMonths(1)}for(let r=0;r<this.dtBdgtTbl.length;r++){let e=this.dtBdgtTbl[r];if(e["Row ID"]=e.RowID,e["Amount Used"]=0,e["Budget Amount"]=e[i],"M"==e.CF.toString()){this.dbl=0;for(let t=1;t<=this.CurrentBudegetMonthSlotIndex;t++)this.dbl+=parseFloat(e["Month"+t+"Amount"]);e["Budget Amount"]=this.dbl}if(t)this.ValidateBudgetRow(e);else{let t=this.myBudget.currBudgetTable.find(t=>t.dr==e);t&&(t.amount=parseFloat(e["Budget Amount"]),t.totalAmount=parseFloat(e.AnnualAmount))}if(!n.e.IsEmpty(this.Document.DisplayMessage))return}}ValidateBudgetRow(e){let t=new Ze.c(0,"");t.amount=parseFloat(e["Budget Amount"]),t.totalAmount=parseFloat(e.AnnualAmount),t.CF=e.CF.toString();for(let r=0;r<this.nDims;r++)t.addDimValue(n.e.String(e[this.dtBdgtTblColumns[this.stPosDim+r]]));this.inpRow=t,this.budgetInput.Clear(),this.budgetInput.push(this.inpRow);let s={errMsg:""};this.myBudget=new Ze.a(this.budgetTable,this.nDims);let i=[],a=this.myBudget.checkAddBudgetConflicts(this.inpRow,i,s);if(0!=a)return this.Document.DisplayMessage=s.errMsg,this.inpRow.linkedDimRows="",void(this.inpRow.tempLinkedDimRows=0);{let t=this.budgetTable.length+1;if(a=this.myBudget.updateDimsRowsWithNewRowId(this.inpRow,i,t),0==a){let s={strTransLog:this.strTransLog};this.myBudget.getTransactionLogSummary(i,s),this.strTransLog=s.strTransLog;let a=new Ze.c;a.DimensionRow_1(this.inpRow),a.dr=e,a.rowID=t,this.budgetTable.push(a)}}}CheckBudgetRow(){let e=new Ze.c(0,"");try{if(null!=this.dtCommonAccounts&&this.dtBdgtTblColumns.Contains("D2")&&null!=this.dtBdgtInp[0]["D"+a.a.SessionManager.Preferences.BudgetDimension]&&this.dtCommonAccounts.filter(e=>e.AccountID==this.dtBdgtInp[0].D2.toString()&&e.DimID==this.dtBdgtInp[0]["D"+a.a.SessionManager.Preferences.BudgetDimension]).length>0&&(this.dtBdgtInp[0].D2=this.BudgetAccount),this.Document.DisplayMessage="",this.ChkBudgetOnlyForDefnAccounts&&this.dtBdgtTblColumns.Contains("D2")&&0==this.dtBdgtTbl.filter(e=>e.D2==this.dtBdgtInp[0].D2.toString()).length)return;let t=this.dtBdgtInp[0];this.budgetUsedInp=n.e.Double(t["Amount Used"]),e.docSeqNo=n.e.Int(t.DocSeqNo),e.amount=0;for(let a=0;a<this.nDims;a++)e.addDimValue(t[this.dtBdgtTblColumns[this.stPosDim+a]].toString());this.inpRow=e,this.inpRow.budgetUsed=this.budgetUsedInp,this.budgetInput.Clear(),this.budgetInput.push(this.inpRow);let s={errMsg:"",errMsgCmplt:""};this.myBudget=new Ze.a(this.budgetTable,this.nDims),null!=this.budgetTable&&this.budgetTable.forEach(e=>{e.docSeqNo=this.inpRow.docSeqNo});let i=[],r=this.myBudget.checkBudgetTransUsage(this.inpRow,i,s);if(0==r){for(let e=0;e<i.length;e++){let t=i[e];t.childRowId>0&&this.getBudgetUsed(t.childRowId),t.parentRowId>0&&this.getBudgetUsed(t.parentRowId)}if(this.Document.AppDisplayMessage="",s.errMsgCmplt="",r=this.myBudget.checkTransValidity(this.IsQtyBudget,this.BudgetType,this.inpRow,i,s),0==r)for(let e=0;e<i.length;e++){let t=i[e];if(t.relation==Ze.b.Self||t.relation==Ze.b.Child){let e=null;this.getDimensionRow(t.parentRowId,e),e.budgetUsed+=this.budgetUsedInp}}else this.Document.DisplayMessage=s.errMsg,this.Document.AppDisplayMessage=s.errMsgCmplt}else this.Document.DisplayMessage=s.errMsg}catch(t){this.Document.DisplayMessage="Error @ Check Budget",console.log(t)}}getBudgetUsed(e){let t=0,s=0;for(let i=0;i<this.budgetTable.length;i++){let a=this.budgetTable[i];if(a.rowID==e){if(!a.dbCalled){let e=this.dtBdgtInp[0],i="",r=0;s=n.e.Int(e.LinkedInvDocDetailsID),t=n.e.Double(e.LinkedFieldValue),i="<XML>";for(let t=0;t<this.lstDimensions.length;t++)a.row[t].toString().length>0&&parseInt(a.row[t])>1&&(i+='<Row CCID="'+this.lstDimensions[t]+'" NodeID="'+a.row[t].toString()+'"/>');i+="</XML>";let o=et.GetDocsUsedBudget(this.BudgetID,this.Document.DocID,this.Document.CostCenterID,this.IsQtyBudget,this.QtyType,this.BudgetStartYear,i,s,t);if(null!=o&&o.Tables.length>0){let t,s=o.Tables[0],i=!1,l=0,c=new Date(this.BudgetStartYear.getFullYear(),this.BudgetStartYear.getMonth(),1);if(o.Tables[0].forEach(e=>{t=new Date(parseInt(e.YYYY),parseInt(e.MM),1),e.Month=t}),o.Tables[0].length>0&&(r=parseFloat(o.Tables[0].Compute("sum","Balance"))),1==this.BudgetType)c=c.AddMonths(6),e.UH0=this.GetDocsTotal(s.filter(e=>e.Month<c.ToString("dd MMM yyyy"))),e.UH1=this.GetDocsTotal(s.filter(e=>e.Month>=c.ToString("dd MMM yyyy")));else if(2==this.BudgetType)c=c.AddMonths(3),e.UQ0=this.GetDocsTotal(s.filter(e=>e.Month<c.ToString("dd MMM yyyy"))),e.UQ1=this.GetDocsTotal(s.filter(e=>e.Month>=c.ToString("dd MMM yyyy")&&e.Month<c.AddMonths(3).ToString("dd MMM yyyy"))),c=c.AddMonths(3),e.UQ2=this.GetDocsTotal(s.filter(e=>e.Month>=c.ToString("dd MMM yyyy")&&e.Month<c.AddMonths(3).ToString("dd MMM yyyy"))),e.UQ3=this.GetDocsTotal(s.filter(e=>e.Month>=c.AddMonths(3).ToString("dd MMM yyyy")));else if(3==this.BudgetType)for(let a=0;a<12;a++)e["UM"+a]=this.GetDocsTotal(s.filter(e=>e.Month>=c.ToString("dd MMM yyyy")&&e.Month<c.AddMonths(1).ToString("dd MMM yyyy"))),c=c.AddMonths(1);if("M"==a.CF){let t=new Date(this.BudgetStartYear.getFullYear(),this.BudgetStartYear.getMonth(),1);for(let n=0;n<12;n++)3!=this.BudgetType&&(e["UM"+n]=this.GetDocsTotal(s.filter(e=>e.Month>=t.ToString("dd MMM yyyy")&&e.Month<t.AddMonths(1).ToString("dd MMM yyyy"))),t=t.AddMonths(1)),"M"==a.CF&&(i=!0,e["UM"+n]&&(l+=parseFloat(e["UM"+n])))}a.budgetUsed=i?l:this.strBudUtilizesColumn.length>0?n.e.Double(e[this.strBudUtilizesColumn]):r,a.dbCalled=!0}}return a.budgetUsed}}return-1}ClearInput(){for(let e=this.dtBdgtTblColumns.length-this.nDims;e<this.dtBdgtTblColumns.length;e++)this.dtBdgtInp[0][this.dtBdgtTblColumns[e]]=null}UpdateLinkedDimensions(e){for(let t=0;t<this.budgetTable.length;t++){let s=this.budgetTable[t];0!=s.tempLinkedDimRows&&(""!=s.linkedDimRows?s.linkedDimRows+="; "+e.toString():s.linkedDimRows=e.toString(),s.tempLinkedDimRows=0)}}getDimensionRow(e,t){for(let s=0;s<this.budgetTable.length;s++)if(this.budgetTable[s].rowID==e)return 0;return 1}GetDocsTotal(e){let t=0;return e.forEach(e=>{t+=parseFloat(e.Balance)}),t}static GetDocumentBudgetDefn(e,t,s){let i=[];return i.push(e),i.push(t),i.push(s),i.push(a.a.SessionManager.UserID),i.push(a.a.SessionManager.LanguageID),a.a.document.GetDocumentBudgetDefn(i)}static GetDocsUsedBudget(e,t,s,i,n,r,o,l,c){let h=[];return h.push(e),h.push(t),h.push(i),h.push(n),h.push(s),h.push(r),h.push(o),h.push(l),h.push(c),h.push(a.a.SessionManager.UserID),h.push(a.a.SessionManager.LanguageID),a.a.document.GetDocsUsedBudget(h)}}var tt=s("hAwP"),st=s("wnwj"),it=s("7i9q"),at=s("y4Z9"),nt=s("zUnb"),rt=s("0K4e"),ot=s("3L/X"),lt=s("/GLD"),ct=s("MRsC"),ht=s("KNVA");class ut extends l.b{constructor(e){super(),this.FilterVisible=!0,this.AutoPopulateVisible=!0,this.DefaultVisible=!0,this.CustomizeVisible=!0,this.ClubProducts=!0,this.VendorWise=!0,this.SelectAll=!1,this.SelectAllCtrl=null,this._All=!1,this._ProductVendors=!1,this.SelectedValueChanged=!1,this._selectedvalue=0,this.SelectedNode=0,this.GridReadonly=!1,this.drpDocuments=new D.e(0),this.VendorAccountTypes=null,this.GridDataEnquiriesObj=new F.a,this.ProductList=new D.b,this.SNO=1,this.WorkFlowID=0,this.ProductList.Height=145,this.oparent=e,this.GridDataEnquiriesObj.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.SelectAllCtrl=new S.a(0),this.SelectAllCtrl.CheckedChangedCommand.Subscribe(this,"onCheckChange"),this.SelectAllCtrl.DBColumnName="Select",this.SelectAllCtrl.Label=a.a.GetResource("Selectall"),this.Title=this.DisplayName=a.a.GetResource("Doc_AccMEnquiries"),this.VendorAccountTypes=new m.b(0),this.VendorAccountTypes.CCID=2,this.VendorAccountTypes.TypeID=""!=this.oparent.ScreenObject.Preferences.VendorListView.toString()?parseInt(this.oparent.ScreenObject.Preferences.VendorListView.toString()):1,this.drpDocuments.Label=a.a.GetResource("CRMOpportunity_Documents"),this.VendorAccountTypes.Label=a.a.GetResource("Inv_Vendor"),this.ProductList.Label=a.a.GetResource("CRMOpportunity_Products"),this.DefaultData(),this.GenerateColumns(),this.GridDataEnquiriesObj.TableNewRow.Subscribe(this,"onAddRow"),this.GridDataEnquiriesObj.RowDeleted.Subscribe(this,"onDeleteRow"),this.LoadDefault(),n.e.IsEmpty(this.drpDocuments.SelectedValue)&&1==this.drpDocuments.Items.length&&(this.drpDocuments.SelectedValue=this.drpDocuments.Items[0].Value),"1"!=a.a.SessionManager.RoleID&&(this.CustomizeVisible=!1),this.GridReadonly=a.a.SessionManager.IsActionAssigned(43,"bulk enquiries grid Read only")}get All(){return this._All}set All(e){e!=this._All&&(this._All=e,e&&(this.VendorAccountTypes.CustomWhere=""))}get ProductVendors(){return this._ProductVendors}set ProductVendors(e){if(e!=this._ProductVendors&&(this._ProductVendors=e,e)){let e="";for(let t=0;t<this.linkGrid.Table.length;t++)""!=this.linkGrid.Table[t].EnqSel.toString()&&Object(o.j)(this.linkGrid.Table[t].EnqSel.toString())&&""!=this.linkGrid.Table[t].ProductID_Key.toString()&&(e+=this.linkGrid.Table[t].ProductID_Key.toString()+",");""!=e?(e=e.Remove(e.length-1,1),this.VendorAccountTypes.CustomWhere=" a.AccountID in (select IPV.AccountID from INV_ProductVendors IPV WITH(NOLOCK) where IPV.ProductID in ("+e+") ) "):this.VendorAccountTypes.CustomWhere=""}}get SelectedValue(){return this._selectedvalue}set SelectedValue(e){this._selectedvalue!=e&&(this._selectedvalue=e,this.SelectedValueChanged=!this.SelectedValueChanged)}get ColumnSource(){return this.GridDataEnquiriesObj.Columns}get GridDataEnquiries(){return this.GridDataEnquiriesObj.Table}LoadDefault(){let e=a.a.SessionManager.Preferences.EnquieriesLayout;if(null!=e&&""!=e){let t=new n.f;t.LoadXml(e),t.SelectNodes("XML/Row").forEach(e=>{null!=this.drpDocuments.Items.find(t=>t.Value==e.attributes.drpDocuments.value)?this.drpDocuments.SelectedValue=e.attributes.drpDocuments.value.toString():this.drpDocuments.Items.length>0&&(this.drpDocuments.SelectedValue=this.drpDocuments.Items[0].Value),this.VendorAccountTypes.SelectedValue=parseInt(e.attributes.VendorAccountTypes.value),this.All=Object(o.j)(e.attributes.All.value),this.ProductVendors=Object(o.j)(e.attributes.ProductVendors.value),this.ClubProducts=Object(o.j)(e.attributes.ClubProducts.value),this.VendorWise=Object(o.j)(e.attributes.VendorWise.value)})}}OnCellEditEnding(e){if("DataGridComboBoxColumn"==e.column.className)return;let t=e.item;"Qty"==e.column.field&&n.e.IsNum(t.Qty)&&n.e.IsNum(t.UnitPrice)&&(t.Value=parseFloat(t.Qty)*parseFloat(t.UnitPrice))}OnCmnItem_Click(e){switch(e){case"DELETE":confirm(a.a.GetResource("DeleteMessage"))&&this.OnDeleteCallBack()}}DefaultData(){let e=null;if(this.oparent.ScreenObject.Preferences.ContainsKey("DefaultEnquiry")&&""!=this.oparent.ScreenObject.Preferences.DefaultEnquiry.toString()&&(e=this.oparent.ScreenObject.Preferences.DefaultEnquiry.toString().split(",")),null!=this.oparent.ScreenObject.Data&&this.oparent.ScreenObject.Data.Tables.length>13&&this.oparent.ScreenObject.Data.Tables[13].length>0){let t,s;for(let i=0;i<this.oparent.ScreenObject.Data.Tables[13].length;i++)t=n.e.String(this.oparent.ScreenObject.Data.Tables[13][i][this.oparent.ScreenObject.Data.Columns[13][0]]),s=n.e.String(this.oparent.ScreenObject.Data.Tables[13][i][this.oparent.ScreenObject.Data.Columns[13][1]]),(!e||e.Contains(t)||e.Contains("-"+t))&&a.a.SessionManager.RoleActions.length>0&&a.a.SessionManager.RoleActions.filter(e=>1==e.FeatureActionTypeID&&e.FeatureID==parseInt(t)).length>0&&this.drpDocuments.Items.push(D.d.ComboBoxItems_2(s,t))}this.drpDocuments.Items.length>0&&n.e.IsEmpty(this.drpDocuments.SelectedValue)&&(this.drpDocuments.SelectedValue=this.drpDocuments.Items[0].Value,this.drpDocuments.SelectedItem=this.drpDocuments.Items[0])}onAddRow(e){this.UpdateSequence(),e.DocSeqNo=this.SNO}onDeleteRow(e){this.UpdateSequence()}UpdateSequence(){this.SNO=1,this.GridDataEnquiries.forEach(e=>{e.DocSeqNo=this.SNO++,this.GridDataEnquiriesObj.updateRow(e)})}GenerateColumns(){var e=this.oparent.ScreenObject.ColumnSource.find(e=>!n.e.IsEmpty(e.DisplayMember)&&"EnqSel"==e.DisplayMember);if(null!=e)e.IsVisible=!0;else{let e=new y.a;e.Header=a.a.GetResource("Select"),e.DataType="CheckBox",e.DisplayMember="EnqSel",e.ReadOnly=!1,e.Width=50,e.DisableTab=!0,e.ID="0",this.oparent.ScreenObject.ColumnSource.Insert(1,e),this.oparent.ScreenObject.GridDataColumns.push("EnqSel")}this.linkGrid=new F.a,this.linkGrid.Columns=this.oparent.ScreenObject.ColumnSource,this.linkGrid.Table=this.oparent.ScreenObject.GridData,this.linkGrid.Height=175,this.linkGrid.SelectAll.Visible=!0,this.linkGrid.Width="830",this.linkGrid.SelectAll.DBColumnName="EnqSel",this.linkGrid.SelectAll.IsChecked=!1;for(let i=0;i<this.linkGrid.Table.length;i++)this.linkGrid.Table[i].EnqSel=!1;let t=[];if(t.push(D.c.CheckedListBoxItem_6("#","DocSeqNo",!0,25)),t.push(D.c.CheckedListBoxItem_6(a.a.GetResource("ProductCode"),"ProductCode",!0,100)),t.push(D.c.CheckedListBoxItem_6(a.a.GetResource("ProductName"),"ProductName",!0,100)),t.push(D.c.CheckedListBoxItem_6(a.a.GetResource("Vendor"),"Vendor",!0,150)),t.push(D.c.CheckedListBoxItem_6(a.a.GetResource("Qty"),"Qty",!0,100)),t.push(D.c.CheckedListBoxItem_6(a.a.GetResource("Units"),"Units",!0,100)),t.push(D.c.CheckedListBoxItem_6(a.a.GetResource("UnitPrice"),"UnitPrice",!0,80)),t.push(D.c.CheckedListBoxItem_6(a.a.GetResource("Value"),"Value",!0,150)),t.push(D.c.CheckedListBoxItem_6(a.a.GetResource("Remarks"),"Remarks",!0,100)),a.a.SessionManager.Preferences.ContainsKey("EnquiriesCustomize")&&""!=a.a.SessionManager.Preferences.EnquiriesCustomize){let e,i=new n.f;i.LoadXml(a.a.SessionManager.Preferences.EnquiriesCustomize),this.FilterVisible=!1,this.AutoPopulateVisible=!1,this.DefaultVisible=!1;let r=[];for(let a=0;a<i.DocumentElement.children.length;a++){let n=i.DocumentElement.children[a],o=t.find(e=>e.Value==n.attributes.ID.value);if(o)e=new y.a,e.Header=o.Name,e.DisplayMember=o.Value,e.DisplayIndex=parseInt(n.attributes.index.value),e.Width=parseInt(n.attributes.WIDTH.value),this.SetAlignMent(e),r.push(e);else if("Filter"==n.attributes.ID.value)this.FilterVisible=!0;else if("AutoPopulate"==n.attributes.ID.value)this.AutoPopulateVisible=!0;else if("Default"==n.attributes.ID.value)this.DefaultVisible=!0;else{var s=this.oparent.ScreenObject.ColumnSource.find(e=>e.DisplayMember.toLowerCase()==n.attributes.ID.value);s&&(e=new y.a,e.Header=s.Header,e.DisplayMember=s.DisplayMember,e.DisplayIndex=parseInt(n.attributes.index.value),e.Width=parseInt(n.attributes.WIDTH.value),e.Expression=n.attributes.ID.value,e.ReadOnly=!0,this.SetAlignMent(e),r.push(e),this.GridDataEnquiriesObj.TableColumns.push(s.DisplayMember))}}r.sort((e,t)=>e.DisplayIndex-t.DisplayIndex),r.forEach(e=>{this.ColumnSource.push(e)})}else t.forEach(e=>{let t=new y.a;t.Header=e.Name,t.DisplayMember=e.Value,t.Width=e.Type,this.SetAlignMent(t),this.ColumnSource.push(t)});this.GridDataEnquiriesObj.TableColumns.push("DocSeqNo"),this.GridDataEnquiriesObj.TableColumns.push("ProductCode"),this.GridDataEnquiriesObj.TableColumns.push("ProductID"),this.GridDataEnquiriesObj.TableColumns.push("ProductName"),this.GridDataEnquiriesObj.TableColumns.push("Vendor"),this.GridDataEnquiriesObj.TableColumns.push("VendorID"),this.GridDataEnquiriesObj.TableColumns.push("Qty"),this.GridDataEnquiriesObj.TableColumns.push("Units"),this.GridDataEnquiriesObj.TableColumns.push("Unit_Key"),this.GridDataEnquiriesObj.TableColumns.push("UomConversion"),this.GridDataEnquiriesObj.TableColumns.push("UnitPrice"),this.GridDataEnquiriesObj.TableColumns.push("Value"),this.GridDataEnquiriesObj.TableColumns.push("Remarks"),this.GridDataEnquiriesObj.TableColumns.push("DocDetailsID"),Logger.InfoLog("EnquiriesViewModel::Exiting GenerateColumns")}SetAlignMent(e){("Qty"==e.DisplayMember||"Value"==e.DisplayMember||"UnitPrice"==e.DisplayMember||"Quantity"==e.DisplayMember||e.DisplayMember.toLowerCase().Contains("dcnum")||e.DisplayMember.toLowerCase().Contains("dccalcnum"))&&(e.TextAlign="Right")}SaveInventoryDoc(){try{this.DisplayMessage="";let e=this.GetEnquiriesXML(),t=this.oparent.ScreenObject.CheckInvPosting(e);if(null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&t.Columns[0].Contains("ErrorMessage")){if(this.oparent.ScreenObject.Preferences.ContainsKey("DonotAllowDuplicateVendorforEnquiry")&&Object(o.j)(this.oparent.ScreenObject.Preferences.DonotAllowDuplicateVendorforEnquiry))return void(this.DisplayMessage="Enquiries Already exists for."+n.e.String(t.Tables[0][0].ErrorMessage));if(!confirm("Enquiries Already exists for."+n.e.String(t.Tables[0][0].ErrorMessage)+"\n Do you want to continue?"))return}this.oparent.ScreenObject.PostInventoryDocument(e,"","","",this.oparent.DocumentDate,this.WorkFlowID,this.drpDocuments.SelectedValue.toString()).subscribe(e=>{e.RetVal>0?(this.DisplayMessage=" Enquiries Posted Successfully",this.MessageVisibility=!0,this.GridDataEnquiriesObj.Clear()):(this.DisplayMessage=e.Message,this.MessageVisibility=!0)},e=>{console.log(e)})}catch(e){Logger.ErrorLog("EnquiriesViewModel:: EnquiriesViewModel"+e.stack)}}GetEnquiriesXML(){this.WorkFlowID=0;let e=this.oparent.ScreenObject.GetLinkDefDetails(parseInt(this.drpDocuments.SelectedValue),this.oparent.CostCenterID),t="",s="",i="",a="",r="",l=0;null!=e&&e.Tables.length>1&&e.Tables[1].length>0&&e.Columns[1].Contains("WorkFlowID")&&!n.e.IsEmpty(e.Tables[1][0].WorkFlowID)&&(this.WorkFlowID=parseInt(e.Tables[1][0].WorkFlowID));let c=this.oparent.ScreenObject.Data.Tables[7].filter(e=>e.PrefName="LinkPrifixDimensions");if(c.length>0&&!n.e.IsEmpty(c[0].PrefValue)&&Object(o.j)(c[0].PrefValue)){let t=this.oparent.ScreenObject.Data.Tables[8].filter(e=>e.CCID>=50001&&e.CCID<=50050);if(t.length>0){let s,i;for(let a=0;a<t.length;a++)if(s=this.oparent.ScreenObject.Data.Tables[0].filter(e=>e.ColumnCostCenterID==t[a].CCID),s.length>0&&(i=e.Tables[0].filter(e=>e.BASECOL==s[0].SysColumnName),!(i.length>0))){let t={};t.BASECOL=s[0].SysColumnName,t.LINKCOL=s[0].SysColumnName,t.VIEW="False",t.CostCenterColIDLinked=s[0].CostCenterColID,e.Tables[0].push(t)}}}this.lstVendorIDs=[];let h=!1,d=[];d.push("productid"),d.push("uomconversion"),d.push("rate"),d.push("quantity"),d.push("gross"),d.push("exchangerate"),d.push("creditaccount"),d.push("unit"),d.push("refno"),t+="<Enquiries>";for(let o=0;o<this.GridDataEnquiries.length;o++)if(i="",a="",r="",!n.e.IsEmpty(this.GridDataEnquiries[o].ProductID)&&!n.e.IsEmpty(this.GridDataEnquiries[o].VendorID)){if(l=parseInt(this.oparent.ScreenObject.GridData.filter(e=>e.DocDetailsID==this.GridDataEnquiries[o].DocDetailsID)[0].DocSeqNo)-1,this.lstVendorIDs.Contains(parseInt(this.GridDataEnquiries[o].VendorID))||Object(f.isNullOrUndefined)(this.GridDataEnquiries[o].VendorID)||(this.lstVendorIDs.length>0&&(t+="</DocumentXML></ROWS>"),this.lstVendorIDs.push(parseInt(this.GridDataEnquiries[o].VendorID)),t+="<ROWS><DocumentXML>"),t+="<RowHead/><Row><Transactions  ",t+='DocDetailsID="0"  DocSeqNo="1" IsQtyIgnored="1" ProductID="'+n.e.String(this.GridDataEnquiries[o].ProductID)+'" Unit="'+this.GridDataEnquiries[o].Unit_Key.toString()+'" ',null!=e&&e.Tables.length>0&&e.Tables[0].length>0){for(let c=0;c<e.Tables[0].length;c++)if(!d.Contains(n.e.String(e.Tables[0][c].BASECOL).toLowerCase())){if(s="","debitaccount"==n.e.String(e.Tables[0][c].BASECOL).toLowerCase()){if(this.oparent.ScreenObject.GridDataColumns.Contains(n.e.String(e.Tables[0][c].LINKCOL)+"_Key")?t+='DebitAccount="'+n.e.String(this.oparent.ScreenObject.GridData[l][n.e.String(e.Tables[0][c].LINKCOL)+"_Key"])+'" ':t+=null!=this.oparent.ScreenObject.DebitAccount?'DebitAccount="'+this.oparent.ScreenObject.DebitAccount.SelectedValue.toString()+'" ':'DebitAccount="2" ',e.Tables.length>3&&e.Tables[3].length>0&&(S=e.Tables[3].filter(e=>"debitaccount"==e.SysColumnName)).length>0&&e.Tables[3].filter(e=>null!=e.LocalReference&&e.LocalReference==S[0].CostCenterColID).length>0){let e=this.oparent.ScreenObject.GetLinkRefDataSet(parseInt(S[0].CostCenterColID),parseInt(this.drpDocuments.SelectedValue),parseInt(this.GridDataEnquiries[o].VendorID),this.oparent.DocumentDate,S[0].SysColumnName.toString(),2,null,parseInt(this.GridDataEnquiries[o].VendorID)),t={costcenter:r,Numeric:i,Alpha:a};this.FillLocalref(e,t),t.costcenter=r,t.Numeric=i,t.Alpha=a}continue}if("currencyid"==n.e.String(e.Tables[0][c].BASECOL).toLowerCase()){this.oparent.ScreenObject.GridDataColumns.Contains("CurrencyID_Key")?n.e.IsEmpty(this.oparent.ScreenObject.GridData[l].CurrencyID_Key)||(h=!0,t+='CurrencyID="'+n.e.String(this.oparent.ScreenObject.GridData[l].CurrencyID_Key)+'" ',this.oparent.ScreenObject.GridDataColumns.Contains("ExchangeRate")&&!n.e.IsEmpty(this.oparent.ScreenObject.GridData[l].ExchangeRate)&&(t+='ExchangeRate="'+n.e.String(this.oparent.ScreenObject.GridData[l].ExchangeRate)+'" ')):null!=this.oparent.Currency&&this.oparent.Currency.Currency&&!n.e.IsEmpty(this.oparent.Currency.Currency.SelectedValue)&&(t+='CurrencyID="'+this.oparent.Currency.Currency.SelectedValue+'" ',t+='ExchangeRate="'+this.oparent.Currency.ExchangeRate.Text+'" ',h=!0);continue}if("voucherno"==n.e.String(e.Tables[0][c].LINKCOL).toLowerCase())s=this.oparent.ScreenObject.VoucherNo;else if(this.oparent.ScreenObject.GridDataColumns.Contains(n.e.String(e.Tables[0][c].LINKCOL))){let t=e.Tables[0][c].LINKCOL+"_Key";s=this.oparent.ScreenObject.GridDataColumns.Contains(t)?this.oparent.ScreenObject.GridDataObj.DataTypes.Date.Contains(t)&&n.e.isValidDate(this.oparent.ScreenObject.GridData[l][t])?n.e.String(new Date(this.oparent.ScreenObject.GridData[l][t])):n.e.String(this.oparent.ScreenObject.GridData[l][t]):n.e.String(this.oparent.ScreenObject.GridData[l][n.e.String(e.Tables[0][c].LINKCOL)])}else{var D=this.oparent.ScreenObject.HeaderFields.find(t=>t instanceof b.c&&t.DBColumnName&&t.DBColumnName.toLowerCase()==n.e.String(e.Tables[0][c].LINKCOL).toLowerCase());D||(D=this.oparent.ScreenObject._CCFields.find(t=>t instanceof b.c&&t.DBColumnName&&t.DBColumnName.toLowerCase()==n.e.String(e.Tables[0][c].LINKCOL).toLowerCase())),D||(D=this.oparent.ScreenObject._TextFields.find(t=>t instanceof b.c&&t.DBColumnName&&t.DBColumnName.toLowerCase()==n.e.String(e.Tables[0][c].LINKCOL).toLowerCase())),null!=D&&(s=this.GetFldValue(D))}if(""!=s){let o=n.e.String(e.Tables[0][c].BASECOL).toLowerCase();o.Contains("dcccnid")||"userid"==o||"customerid"==o||"contactid"==o?r+=n.e.String(e.Tables[0][c].BASECOL)+"="+s+",  ":o.Contains("dcnum")?i+=n.e.String(e.Tables[0][c].BASECOL)+"="+s+",  ":o.Contains("dcalpha")?a+=n.e.String(e.Tables[0][c].BASECOL)+"=N'"+u.d.GetValidTextXml(s)+"',  ":t+=" "+n.e.String(e.Tables[0][c].BASECOL)+'="'+u.d.GetValidTextXml(s)+'" '}}var S;if(h||(t+=' CurrencyID="1" ExchangeRate="1" '),e.Tables.length>2&&e.Tables[2].length>0&&e.Tables[2].filter(e=>"ProductID"!=e.SysColumnName).length>0&&(S=e.Tables[2].filter(e=>"ProductID"==e.SysColumnName)).length>0){let e=this.oparent.ScreenObject.GetLinkRefDataSet(parseInt(S[0].CostCenterColID),parseInt(this.drpDocuments.SelectedValue),parseInt(this.GridDataEnquiries[o].ProductID),this.oparent.DocumentDate,"ProductID",3,null,parseInt(this.GridDataEnquiries[o].VendorID)),t={costcenter:r,Numeric:i,Alpha:a};this.FillLocalref(e,t),t.costcenter=r,t.Numeric=i,t.Alpha=a}if(e.Tables.length>3&&e.Tables[3].length>0&&(S=e.Tables[3].filter(e=>"CreditAccount"==e.SysColumnName)).length>0&&e.Tables[3].filter(e=>null!=e.LocalReference&&e.LocalReference==S[0].CostCenterColID).length>0){let e=this.oparent.ScreenObject.GetLinkRefDataSet(parseInt(S[0].CostCenterColID),parseInt(this.drpDocuments.SelectedValue),parseInt(this.GridDataEnquiries[o].VendorID),this.oparent.DocumentDate,S[0].SysColumnName.toString(),2,null,parseInt(this.GridDataEnquiries[o].VendorID)),t={costcenter:r,Numeric:i,Alpha:a};this.FillLocalref(e,t),t.costcenter=r,t.Numeric=i,t.Alpha=a}t.toString().Contains("DebitAccount=")||(t+=null!=this.oparent.ScreenObject.DebitAccount?'DebitAccount="'+this.oparent.ScreenObject.DebitAccount.SelectedValue.toString()+'" ':'DebitAccount="2" ')}else this.oparent.ScreenObject._CCFields.forEach(e=>{s=this.GetFldValue(e),""!=s&&(r+=e.DBColumnName+"="+s+", ")});t+=' RefNO="'+this.oparent.ScreenObject.VoucherNo+'" ',t+='LinkedInvDocDetailsID="'+n.e.String(this.GridDataEnquiries[o].DocDetailsID)+'"  LinkedFieldName="Quantity"',t+=' Quantity="'+n.e.String(this.GridDataEnquiries[o].Qty)+'"  Rate="'+n.e.String(this.GridDataEnquiries[o].UnitPrice)+'"  Gross="'+n.e.String(this.GridDataEnquiries[o].Value)+'" CreditAccount ="'+n.e.String(this.GridDataEnquiries[o].VendorID)+'" ',n.e.IsEmpty(this.GridDataEnquiries[o].Qty)||n.e.IsEmpty(this.GridDataEnquiries[o].UomConversion)?t+=' UOMConversion="1" UOMConvertedQty="'+n.e.String(this.GridDataEnquiries[o].Qty)+'" ':t+=' UOMConversion="'+n.e.String(this.GridDataEnquiries[o].UomConversion)+'" UOMConvertedQty="'+parseFloat(this.GridDataEnquiries[o].Qty)*parseFloat(this.GridDataEnquiries[o].UomConversion)+'" ',t+="></Transactions> ",t+=' <Numeric Query="'+i+'" /> <Alpha Query="'+a+'" /> <CostCenters Query="'+r+'" /> <EXTRAXML/>',t+=" </Row>"}return t+="</DocumentXML></ROWS>",t+="</Enquiries>",t}FillLocalref(e,t){if(null!=e&&e.Tables.length>0&&e.Tables[0].length>0){let s;for(let i=0;i<e.Columns[0].length;i++)s=e.Columns[0][i],n.e.IsEmpty(e.Tables[0][0][s])||(e.Columns[0][i].toLowerCase().Contains("dcccnid")&&!t.costcenter.Contains(e.Columns[0][i]+"=")&&n.e.IsDigit(e.Columns[0][i][e.Columns[0][i].length-1])?t.costcenter+=e.Columns[0][i]+"="+n.e.String(e.Tables[0][0][s])+",  ":e.Columns[0][i].toLowerCase().Contains("dcnum")&&!t.Numeric.Contains(e.Columns[0][i]+"=")?t.Numeric+=e.Columns[0][i]+"="+n.e.String(e.Tables[0][0][s])+",  ":e.Columns[0][i].toLowerCase().Contains("dcalpha")&&!t.Alpha.Contains(e.Columns[0][i]+"=")&&(t.Alpha+=e.Columns[0][i]+"=N'"+u.d.GetValidTextXml(e.Tables[0][0][s])+"',  "))}if(null!=e&&e.Tables.length>2){let s;for(let i=2;i<e.Tables.length;i++)s=e.Columns[i][0],!e.Columns[i].Contains("ErrorMessage")&&e.Tables[i].length>0&&e.Columns[i].length>0&&!n.e.IsEmpty(e.Tables[i][0][s])&&(e.Columns[i][0].toLowerCase().Contains("dcccnid")&&!t.costcenter.Contains(e.Columns[i][0]+"=")?t.costcenter+=e.Columns[i][0]+"="+n.e.String(e.Tables[i][0][s])+",  ":e.Columns[i][0].toLowerCase().Contains("dcnum")&&!t.Numeric.Contains(e.Columns[i][0]+"=")?t.Numeric+=e.Columns[i][0]+"="+n.e.String(e.Tables[i][0][s])+",  ":e.Columns[i][0].toLowerCase().Contains("dcalpha")&&!t.Alpha.Contains(e.Columns[i][0]+"=")&&(t.Alpha+=e.Columns[i][0]+"=N'"+u.d.GetValidTextXml(e.Tables[i][0][s])+"',  "))}}GetFldValue(e){let t="";if(e instanceof u.d&&(t=e.Text,n.e.IsEmpty(t)&&(t=""),n.e.IsEmpty(e.Tag)||(t=e.Tag)),e instanceof g.a)t=e.Text,n.e.IsEmpty(t)&&(t="");else if(e instanceof u.c)t=e.Text,n.e.IsEmpty(t)&&(t="");else if(e instanceof D.e)t=e.SelectedValue,n.e.IsEmpty(t)&&(t="");else if(e instanceof d.c)e.Date&&(t=e.Date.ToString("dd/MMM/yyyy")),n.e.IsEmpty(t)&&(t="");else if(e instanceof d.b){let s=e;if(s.Date){let e=s.Date;s.ShowTimePicker&&1900!=s.Date.getFullYear()&&(e=new Date(1900,1,1),e=e.AddHours(s.Date.getHours()),e=e.AddMinutes(s.Date.getMinutes()),e=e.AddSeconds(s.Date.getSeconds())),t=e.ToString("dd/MMM/yyyy hh:mm a")}n.e.IsEmpty(t)&&(t="")}else e instanceof d.a?(t=e.Date.ToString("dd/MMM/yyyy"),n.e.IsEmpty(t)&&(t="")):e instanceof m.b&&e.SelectedValue>0&&(t=e.SelectedValue.toString());return t}OnSave(e){if("Cancel"==e)a.a.page.HideDialog();else if("Customize"==e);else if("Save"==e){if(null==this.drpDocuments.SelectedValue||""==this.drpDocuments.SelectedValue)return void(this.DisplayMessage="please select Document");if(0==this.GridDataEnquiries.length)return void(this.DisplayMessage="please select products to generate enquiries");if(this.GridDataEnquiries.length>0&&(null==this.GridDataEnquiries[0].ProductID||null==this.GridDataEnquiries[0].ProductID))return void(this.DisplayMessage="please select atleast one product to generate enquiry");this.SaveInventoryDoc()}else if("SetAsDefault"==e){let e="";e+="&l;XML&gt;",e+="&l;Row ",e+="drpDocuments='"+this.drpDocuments.SelectedValue+"' ",e+="VendorAccountTypes='"+this.VendorAccountTypes.SelectedValue+"' ",e+="All='"+this.All+"' ",e+="ProductVendors='"+this.ProductVendors+"' ",e+="ClubProducts='"+this.ClubProducts+"' ",e+="VendorWise='"+this.VendorWise+"' ",e+="/&g;",e+="&l;/XML&gt;"}else if("Gnenerate"==e){if(null==this.drpDocuments.SelectedValue)return this.DisplayMessage="please select Document",void(this.MessageVisibility=!0);let e="";for(let t=0;t<this.linkGrid.Table.length;t++)""!=this.linkGrid.Table[t].EnqSel.toString()&&Object(o.j)(this.linkGrid.Table[t].EnqSel.toString())&&""!=this.linkGrid.Table[t].ProductID_Key.toString()&&(e+=this.linkGrid.Table[t].ProductID_Key.toString()+",");if(""==e)return this.DisplayMessage="please select products",void(this.MessageVisibility=!0);if(0==this.VendorAccountTypes.SelectedValue&&!this.VendorWise)return this.DisplayMessage="please select Vendor account",void(this.MessageVisibility=!0);if(this.oparent.ScreenObject.GridData.length>0){let t,s=0;if(this.VendorWise){let i;if(""!=e&&(e=e.Remove(e.length-1,1)),null!=i&&i.Tables.length>0&&!i.Columns[0].Contains("ErrorMessage")){this.GridDataEnquiries.Clear(),s=this.GridDataEnquiries.length;let e=0,r=i.Tables[0].ToTable(!0,["ProductID","AccountID","AccountName"]);for(let s=0;s<r.length;s++,e++)if(t=this.oparent.ScreenObject.GridData.filter(e=>e.ProductID_Key==r.Rows[s].ProductID),t.length>0)for(let e=0;e<t.length;e++){let i=this.GridDataEnquiriesObj.NewRow();i.DocSeqNo=this.GridDataEnquiries.length+1,i.ProductID=n.e.String(t[e].ProductID_Key),i.ProductCode=n.e.String(t[e].ProductCode),i.ProductName=n.e.String(t[e].ProductName),i.DocDetailsID=n.e.String(t[e].DocDetailsID),i.Qty=n.e.IsEmpty(t[e].Quantity)?0:parseFloat(t[e].Quantity).ToString("N"+a.a.SessionManager.Preferences.DecimalsinQty.toString()),i.Units=n.e.IsEmpty(t[e].Unit)?0:n.e.String(t[e].Unit),i.UomConversion=n.e.IsEmpty(t[e].UomConversion)?1:t[e].UomConversion,i.Unit_Key=n.e.IsEmpty(t[e].Unit_Key)?0:n.e.String(t[e].Unit_Key),i.UnitPrice=n.e.IsEmpty(t[e].Rate)?0:parseFloat(t[e].Rate).ToString("N"+a.a.SessionManager.Preferences.DecimalsinRate.toString()),i.Value=n.e.IsEmpty(t[e].Gross)?0:parseFloat(t[e].Gross).ToString("N"+a.a.SessionManager.Preferences.DecimalsinRate.toString()),i.Remarks=n.e.String(t[e].LineNarration),i.Vendor=n.e.String(r.Rows[s].AccountName),i.VendorID=n.e.String(r.Rows[s].AccountID);for(let s=0;s<this.ColumnSource.length;s++)!n.e.IsEmpty(this.ColumnSource[s].Expression)&&this.GridDataEnquiriesObj.TableColumns.Contains(this.ColumnSource[s].DisplayMember)&&(i[this.ColumnSource[s].DisplayMember]=t[e][this.ColumnSource[s].DisplayMember].toString());this.GridDataEnquiriesObj.addRow(i)}}}else{this.GridDataEnquiries.filter(e=>e.Vendor==this.VendorAccountTypes.Text.Replace("'","''")).forEach(e=>{this.GridDataEnquiriesObj.removeRow(e)}),s=this.GridDataEnquiries.length;let e=0;for(let t=0;t<this.linkGrid.Table.length;t++)if(""!=this.linkGrid.Table[t].EnqSel.toString()&&Object(o.j)(this.linkGrid.Table[t].EnqSel.toString())&&""!=this.linkGrid.Table[t].ProductID_Key.toString()){this.GridDataEnquiriesObj.addEmptyRow(),this.GridDataEnquiries[s+e].DocSeqNo=(s+e+1).toString(),this.GridDataEnquiries[s+e].ProductID=this.linkGrid.Table[t].ProductID_Key.toString(),this.GridDataEnquiries[s+e].ProductCode=this.linkGrid.Table[t].ProductCode.toString(),this.GridDataEnquiries[s+e].ProductName=this.linkGrid.Table[t].ProductName.toString(),this.GridDataEnquiries[s+e].DocDetailsID=this.linkGrid.Table[t].DocDetailsID.toString(),this.GridDataEnquiries[s+e].UomConversion=null!=this.linkGrid.Table[t].UomConversion&&""!=this.linkGrid.Table[t].UomConversion.toString()?this.linkGrid.Table[t].UomConversion.toString():1,this.GridDataEnquiries[s+e].Qty=null!=this.linkGrid.Table[t].Quantity&&""!=this.linkGrid.Table[t].Quantity.toString()?parseFloat(this.linkGrid.Table[t].Quantity).ToString("N"+a.a.SessionManager.Preferences.DecimalsinQty.toString()):0,this.GridDataEnquiries[s+e].Units=null!=this.linkGrid.Table[t].Unit&&""!=this.linkGrid.Table[t].Unit.toString()?this.linkGrid.Table[t].Unit.toString():0,this.GridDataEnquiries[s+e].Unit_Key=null!=this.linkGrid.Table[t].Unit_Key&&""!=this.linkGrid.Table[t].Unit_Key.toString()?this.linkGrid.Table[t].Unit_Key.toString():0,this.GridDataEnquiries[s+e].UnitPrice=null!=this.linkGrid.Table[t].Rate&&""!=this.linkGrid.Table[t].Rate.toString()?parseFloat(this.linkGrid.Table[t].Rate).ToString("N"+a.a.SessionManager.Preferences.DecimalsinRate.toString()):0,this.GridDataEnquiries[s+e].Value=null!=this.linkGrid.Table[t].Gross&&""!=this.linkGrid.Table[t].Gross.toString()?parseFloat(this.linkGrid.Table[t].Gross).ToString("N"+a.a.SessionManager.Preferences.DecimalsinRate.toString()):0,this.GridDataEnquiries[s+e].Remarks=this.linkGrid.Table[t].LineNarration.toString(),this.GridDataEnquiries[s+e].Vendor=this.VendorAccountTypes.Text.toString(),this.GridDataEnquiries[s+e].VendorID=this.VendorAccountTypes.SelectedValue.toString();for(let i=0;i<this.ColumnSource.length;i++)!n.e.IsEmpty(this.ColumnSource[i].Expression)&&this.GridDataEnquiriesObj.TableColumns.Contains(this.ColumnSource[i].DisplayMember)&&(this.GridDataEnquiries[s+e][this.ColumnSource[i].DisplayMember]=this.linkGrid.Table[t][this.ColumnSource[i].DisplayMember].toString());e++}}}}}OnDeleteCallBack(){let e=0;for(let t=0;t<this.GridDataEnquiries.length&&(e=parseInt(this.GridDataEnquiries[t].DocSeqNo),this.SelectedNode!=e-1||n.e.IsEmpty(this.GridDataEnquiries[t][0]));t++);this.SelectedNode<this.GridDataEnquiries.length&&this.GridDataEnquiries.RemoveAt(this.SelectedNode),this.UpdateSequence()}}var dt=s("R1nY"),Dt=s("7eIC");class St extends l.b{constructor(){super(),this.ParentTexbox=null,this.BindingPath=null,this.DocID=0,this.lstList=new m.b,this.Query="",this.Title=a.a.GetResource("SelectDocument")}PreviousTextDialog_1(e,t,s,i,r,o){this.IsInventoryVoucher=t,this.CCID=e,this.Query="",this.lstList.CCID=e,this.lstList.TypeID=t?2:1,e>0&&(this.Query="a.CostCenterID="+e),n.e.IsEmpty(o)||(this.Query+=" and  a.VoucherNO  like '"+o+"-%'"),(s>0||i>0||r>5e4)&&(s>0&&(this.Query+=" and dcCCNID2="+s.toString()),i>0&&(this.Query+=" and dcCCNID1="+i.toString())),a.a.SessionManager.IsActionAssigned(43,"User-Wise Documents")&&(this.Query+=" and a.CreatedBy in (select username from ADM_Users WITH(NOLOCK)  where UserID="+a.a.SessionManager.UserID+" or  UserID in (select NodeID from COM_CostCenterCostCenterMap  WITH(NOLOCK)  ",this.Query+=" where parentcostcenterid=7 and parentnodeid="+a.a.SessionManager.UserID+"  and costcenterid=7))"),this.lstList.CustomWhere=this.Query,this.Query="",this.Query="select distinct top {1} DOCID,VoucherNO",this.Query+=t?" from INV_DocDetails a WITH(NOLOCK) ":" from ACC_DocDetails a WITH(NOLOCK) ",(s>0||i>0||r>5e4)&&(this.Query+=" join COM_DocCCData D WITH(NOLOCK) on ",this.Query+=t?" a.INVDocDetailsID=D.INVDocDetailsID ":" a.AccDocDetailsID=D.ACCDocDetailsID ",s>0&&(this.Query+=" and dcCCNID2="+s.toString()),i>0&&(this.Query+=" and dcCCNID1="+i.toString()),r>5e4&&(this.Query+=" JOIN  COM_CostCenterCostCenterMap CCM WITH(NOLOCK) ON  D.DcccNID"+(r-5e4).toString()+" =CCM.NodeID and parentcostcenterid=7 ",this.Query+=" and parentnodeid="+a.a.SessionManager.UserID+" and CCM.costcenterid="+r.toString())),this.Query+=" where ",this.Query+=e>0?" a.CostCenterID="+e.toString():" 1=1",a.a.SessionManager.IsActionAssigned(43,"User-Wise Documents")&&(this.Query+=" and a.CreatedBy in (select username from ADM_Users WITH(NOLOCK)  where UserID="+a.a.SessionManager.UserID+" or  UserID in (select NodeID from COM_CostCenterCostCenterMap  WITH(NOLOCK)  ",this.Query+=" where parentcostcenterid=7 and parentnodeid="+a.a.SessionManager.UserID+"  and costcenterid=7))"),n.e.IsEmpty(o)||(this.Query+=" and  VoucherNO  like '"+o+"-%'"),this.Query+=" and  VoucherNO {0} order by VoucherNO"}btCancel_Click(){a.a.page.HideDialog()}btOk_Click(){this.DocID=this.lstList.SelectedValue,a.a.page.HideDialog()}}var mt=s("0h5z"),bt=s("0/dd"),Ct=s("oiZC"),pt=s("d36O"),yt=s("/G+I"),gt=s("SEJ9"),Ot=s("fPnf"),It=s("vSGu"),ft=s("ddhY"),Tt=s("kTcn");class jt{constructor(e,t,s,i=0){this.CheckedChanged=new b.b,this.ButtonClick=new b.b,this.IsDashboard=!1,this.IsDashboardDefault=!1,this.ListBoxVisible=!0,this.PrintLayouts=new D.e(0),this.ActionType=new D.e(0),this.Application=new D.e(0),this.SelectedApplication=new D.b(0),this.Groups=new D.b,this.Roles=new D.b,this.Users=new D.b,this.Location=new D.b,this.SelectedItem=null,this.IsLocationWise=!1,this.IsAssignVPTFromDocument=!1,this.CallType=0,this.LoadedAction=null,this.LoadedNodeID=0,this.LockCheckedChanged=!1,this.Parent=s,this.REPORTID=e,this.CallType=i,this.ReportName=t,this.ButtonClick.Subscribe(this,"OnButtonClick"),this.Application.SelectionChangedCommand.Subscribe(this,"OnApplicationChange"),this.Application.LblClick=new b.b,this.Application.LblClick.Subscribe(this,"OnButtonClick","ShowAssignGrid"),this.ActionType.SelectionChangedCommand.Subscribe(this,"OnActionChange"),this.SelectedApplication.CheckedChangedCommand.Subscribe(this,"OnCheckedChanged"),"AssignVPTFromDocument"==t?(this.IsAssignVPTFromDocument=!0,this.PrintLayouts.Visible=!0):this.PrintLayouts.Visible=!1,this.SelectedApplication.Visible=!0,this.ActionType.Visible=!1,this.ActionType.Label=a.a.GetResource("Format_Action"),"AddEditRevenUReportViewModel"==s.ClassName?(this.SelectLabel=a.a.GetResource("RevenUReport_Selected"),this.ActionType.Visible=!0,this.ActionType.Items.push(D.d.ComboBoxItems_2("All","0")),this.ActionType.Items.push(D.d.ComboBoxItems_2(a.a.GetResource("Rentals_UnitsView"),"1")),this.ActionType.Items.push(D.d.ComboBoxItems_2(a.a.GetResource("Print"),"2")),this.ActionType.Items.push(D.d.ComboBoxItems_2(a.a.GetResource("lbl_Export"),"3")),this.ActionType.Items.push(D.d.ComboBoxItems_2(a.a.GetResource("SMTP_Email"),"4")),this.ActionType.Items.push(D.d.ComboBoxItems_2(a.a.GetResource("SMTP_SMS"),"5"))):this.SelectLabel=a.a.GetResource("FavoritesViewModel"==s.ClassName?"Selected_Favorites":"ListOfDashBoards"==s.ClassName?"Selected_DashBoard":"View_Selected"),1!=i&&(this.Application.Items.push(D.d.ComboBoxItems_2(a.a.GetResource("DocumentDesigner_Groups"),"1")),this.Application.Items.push(D.d.ComboBoxItems_2(a.a.GetResource("DocumentDesigner_Roles"),"2"))),this.Application.Items.push(D.d.ComboBoxItems_2(a.a.GetResource("DocumentDesigner_Users"),"3")),this.Application.SelectedValue=1!=i?"2":"3",this.Application.Label=a.a.GetResource("Notif_Application"),this.Groups.Items.Clear(),this.Roles.Items.Clear(),this.Users.Items.Clear(),"True"==a.a.SessionManager.Preferences.EnableLocationWise.toString()&&(this.IsLocationWise=!0);let n=null;if("ListOfDashBoards"==s.ClassName)n=a.a.admin.GetDashBoardRoles(parseInt(s.SelectedNode.Id)),this.LoadEditData(n);else if(s instanceof It.FavoritesViewModel)n=a.a.admin.GetAssign(69,e),this.LoadEditData(n),this.Application.SelectedValue="3";else if("AddEditDocumentViewModel"==s.ClassName)if(1==this.CallType)n=a.a.admin.GetAssign(s.CostCenterID,s.DocID),this.LoadEditData(n);else if(this.IsAssignVPTFromDocument){this.IsLocationWise&&this.Application.Items.push(D.d.ComboBoxItems_2(a.a.GetResource("Location"),"50002"));let e=this.GetLocationPrintLayouts(this.Parent.CostCenterID,0,0);e.Tables[0]=e.Tables[0].sort((e,t)=>e.Name-t.Name),e.Tables[0].forEach(e=>{this.PrintLayouts.Items.push(D.d.ComboBoxItems_3(e.Name.toString(),e.DocPrintLayoutID.toString(),""))}),this.PrintLayouts.Items.length>0&&(this.PrintLayouts.SelectedValue=e.Tables[0][0].DocPrintLayoutID.toString()),this.PrintLayouts.SelectionChangedCommand.Subscribe(this,"OnPrintLayoutsChange"),this.OnPrintLayoutsChange(null)}else n=a.a.admin.GetDashBoardRoles(0),this.LoadEditData(n),this.Application.SelectedValue="3";this.OnApplicationChange(null),this.SearchText="Search..."}GetLocationPrintLayouts(e,t,s,i=1){let n=[];return n.push(i),n.push(e),n.push(t),n.push(a.a.SessionManager.LocationID),n.push(a.a.SessionManager.RoleID),n.push(a.a.SessionManager.UserID),n.push(s),n.push(a.a.SessionManager.LanguageID),a.a.report.GetPrintLayouts(n)}OnButtonClick(e){if("Cancel"==e.toString())a.a.page.HideDialog();else if("ShowAssignGrid"==e.toString())null==this.AssignGrid&&(this.AssignGrid=new Pt(!0)),this.AssignGrid.IsShown=!0,this.AssignGrid.RefreshGrid(this.Groups.Items,this.Roles.Items,this.Users.Items),a.a.page.ShowDialog(this.AssignGrid,ft.a,{ShowCenter:!0,Title:a.a.GetResource("Assign")});else if("ShowAssignAllGrid"==e.toString())null==this.AssignGridAll&&(this.AssignGridAll=new Pt(!0,!0,this)),this.AssignGridAll.LoadReportAllGrid(this.Groups.Items,this.Roles.Items,this.Users.Items),a.a.page.ShowDialog(this.AssignGrid,ft.a,{ShowCenter:!0,Title:a.a.GetResource("Assign")});else try{let e,t,s,i="";if(e=this.GetSelectedItems(this.Groups),t=this.GetSelectedItems(this.Roles),s=this.GetSelectedItems(this.Users),null!=this.BasedOnDimension&&(i=this.GetSelectedItems(this.BasedOnDimension)),0==e.length&&0==t.length&&0==s.length)return void(this.DisplayMessage=1==this.CallType?"Select altest one User":"Select altest one Group/Role/User");let n=0;if("AddEditDocumentViewModel"==this.Parent.ClassName&&1==this.CallType){let i=a.a.admin.SetAssign(this.Parent.CostCenterID,this.Parent.DocID,e,t,s);this.DisplayMessage=i.Message,n=parseInt(i.RetValue)}else if("CostCenterViewModel"==this.Parent.ClassName){let i=a.a.admin.SetAssign(this.Parent.CostCenter,this.REPORTID,e,t,s);this.DisplayMessage=i.Message,n=parseInt(i.RetValue)}else if("AddCostCenterViewModel"==this.Parent.ClassName){let i=a.a.admin.SetAssign(this.Parent.CostCenterID,this.REPORTID,e,t,s);this.DisplayMessage=i.Message,n=parseInt(i.RetValue)}else if("AddEditRevenUReportViewModel"==this.Parent.ClassName)this.DisplayMessage=this.obj.AssignReport(this.REPORTID,this.ActionType.SelectedValue,e,t,s);else if("AddEditDocumentViewModel"==this.Parent.ClassName&&!this.IsAssignVPTFromDocument&&null!=this.Parent.SelectedRow){if(!a.a.SessionManager.IsActionAssigned(this.Parent.CostCenterID,"Assign Users"))return void(this.DisplayMessage=this.Parent.this.DisplayMessage="Access denied.");let i="";i+="<AssignXML  ",""!=s&&(i+='Users="'+s+'"  '),""!=t&&(i+='Roles="'+t+'" '),""!=e&&(i+='Groups="'+e+'" '),i+="></AssignXML>",this.Parent.SelectedRow.AssignXML=i.toString(),e=this.GetSelectedNames(this.Groups),t=this.GetSelectedNames(this.Roles),s=this.GetSelectedNames(this.Users),""!=s&&(""!=e?e+=","+s:e=s),""!=t&&(""!=e?e+=","+t:e=t),this.Parent.SelectedRow.dcAlpha13=e.toString()}}catch(t){Logger.ErrorLog("DeleteAccountViewModel:: OnDelete"+t.stack)}}get SearchText(){return this._SearchText}set SearchText(e){e!=this._SearchText&&(this._SearchText=e,this.Search(!0))}Search(e){let t=null;"1"==this.Application.SelectedValue?t=this.Groups:"2"==this.Application.SelectedValue?t=this.Roles:"3"==this.Application.SelectedValue&&(t=this.Users);let s=0;if(null!=t){t.SelectedIndex>=0&&(s=t.SelectedIndex),""==this.SearchText&&(t.SelectedIndex=0,this.SelectedItem=t.Items[0]),-1==s&&(s=0);for(let i=0;i<t.Items.length;i++)if(e?s<t.Items.length-1?s++:s=0:0==s?s=t.Items.length-1:s--,null!=this.SearchText&&""!=this.SearchText&&t.Items[s].Name.toLowerCase().Contains(this.SearchText.toLowerCase()))return void this.SelectSearchItem_2(s,t)}}SelectSearchItem_2(e,t){t.SelectedIndex=e,this.SelectedItem=t.Items[e]}OnActionChange(e){if(this.LoadedAction!=this.ActionType.SelectedValue||this.LoadedNodeID!=this.REPORTID){if(0==this.Users.Items.length){let e=this.obj.GetReportAssignInfo(1,this.ActionType.SelectedValue,this.REPORTID);this.LoadEditData(e)}else{this.Groups.Items.forEach(e=>{e.IsChecked=!1}),this.Roles.Items.forEach(e=>{e.IsChecked=!1}),this.Users.Items.forEach(e=>{e.IsChecked=!1});let e=this.obj.GetReportAssignInfo(3,this.ActionType.SelectedValue,this.REPORTID);this.SetSelectedItems(this.Groups,e.Tables[0],"GroupID={0}"),this.SetSelectedItems(this.Roles,e.Tables[0],"RoleID={0}"),this.SetSelectedItems(this.Users,e.Tables[0],"UserID={0}")}this.LoadedAction=this.ActionType.SelectedValue,this.LoadedNodeID=this.REPORTID}}OnApplicationChange(e){this.ListBoxVisible=!0,"1"==this.Application.SelectedValue?this.SelectedApplication.Items=this.Groups.Items:"2"==this.Application.SelectedValue?this.SelectedApplication.Items=this.Roles.Items:"3"==this.Application.SelectedValue?this.SelectedApplication.Items=this.Users.Items:"50002"==this.Application.SelectedValue?this.SelectedApplication.Items=this.Location.Items:"VPTBasedOnDimension"==this.Application.SelectedValue||"EmailBasedOnDimension"==this.Application.SelectedValue?this.SelectedApplication.Items=this.BasedOnDimension.Items:"EmailSMSBasedOnField"==this.Application.SelectedValue&&(this.ListBoxVisible=!1)}OnPrintLayoutsChange(e){this.REPORTID=null!=this.PrintLayouts.SelectedValue?parseInt(this.PrintLayouts.SelectedValue):0;let t=this.GetAssignVPTInfo(this.REPORTID);("VPTDesignerViewModel"==this.Parent.ClassName||this.IsAssignVPTFromDocument)&&t.Tables.length>5&&t.Columns[5].Contains("Name")&&(this.BasedOnDimension=new D.b,this.Application.Items.push(D.d.ComboBoxItems_2("Based on Dimension","VPTBasedOnDimension"))),this.Groups.Items.Clear(),this.Roles.Items.Clear(),this.Users.Items.Clear(),this.LoadEditData(t)}GetAssignVPTInfo(e){let t=[];t.push(1),t.push(e),t.push(""),t.push(""),t.push(""),t.push(""),t.push(""),"1"!=a.a.SessionManager.UserID?(a.a.SessionManager.Preferences.ContainsKey("LWRole")&&"true"==a.a.SessionManager.Preferences.LWRole.toLowerCase()?t.push(a.a.SessionManager.LocationWhereWithParent):t.push(null),a.a.SessionManager.Preferences.ContainsKey("DWRole")&&"true"==a.a.SessionManager.Preferences.DWRole.toLowerCase()?t.push(a.a.SessionManager.DivisionID>0?a.a.SessionManager.DivisionID.toString():a.a.SessionManager.DivisionWhere):t.push(null)):(t.push(null),t.push(null)),t.push(a.a.SessionManager.UserName),t.push(a.a.SessionManager.UserID),t.push(a.a.SessionManager.LanguageID);try{return a.a.report.GetAssignVPTInfo(t)}catch(s){return Logger.ErrorLog("PrintLayout:: GetAssignVPTInfo"+s.stack),null}}LoadEditData(e){null!=e&&e.Tables.length>0&&(this.Groups.Items.push(D.c.CheckedListBoxItem_6("All","All",!1,0)),e.Tables[0].forEach(e=>{this.Groups.Items.push(D.c.CheckedListBoxItem_6(e.GroupName.toString(),e.GID.toString(),!1,0))}),this.Roles.Items.push(D.c.CheckedListBoxItem_6("All","All",!1,0)),e.Tables[1].forEach(e=>{this.Roles.Items.push(D.c.CheckedListBoxItem_6(e.Name.toString(),e.RoleID.toString(),!1,0))}),this.Users.Items.push(D.c.CheckedListBoxItem_6("All","All",!1,0)),e.Tables[2].forEach(e=>{this.Users.Items.push(D.c.CheckedListBoxItem_6(e.UserName.toString(),e.UserID.toString(),!1,0))}),e.Columns[3].Contains("GroupID")&&(this.SetSelectedItems(this.Groups,e.Tables[3],"GroupID=={0}"),this.SetSelectedItems(this.Roles,e.Tables[3],"RoleID=={0}"),this.SetSelectedItems(this.Users,e.Tables[3],"UserID=={0}")),this.IsLocationWise&&("VPTDesignerViewModel"==this.Parent.ClassName||this.IsAssignVPTFromDocument)&&(this.Location.Items.push(D.c.CheckedListBoxItem_6("All","All",!1,0)),e.Tables[4].forEach(e=>{this.Location.Items.push(D.c.CheckedListBoxItem_5(e.Name.toString(),e.NodeID.toString(),!1))}),this.SetSelectedItems(this.Location,e.Tables[3],"CCNID2={0}")),null==this.BasedOnDimension||"VPTDesignerViewModel"!=this.Parent.ClassName&&!this.IsAssignVPTFromDocument||(this.BasedOnDimension.Items.push(D.c.CheckedListBoxItem_6("All","All",!1,0)),e.Tables[5].forEach(e=>{this.BasedOnDimension.Items.push(D.c.CheckedListBoxItem_5(e.Name.toString(),e.NodeID.toString(),!1))}),this.SetSelectedItems(this.BasedOnDimension,e.Tables[3],"BasedOn={0}")),e.Tables.length>3&&"ListOfDashBoards"==this.Parent.ClassName&&e.Tables[3].length>0&&(this.IsDashboardDefault=!(!e.Columns[3].Contains("IsDefault")||null==e.Tables[3][0].IsDefault&&""==e.Tables[3][0].IsDefault.toString())&&Object(o.j)(e.Tables[3][0].IsDefault.toString())),e.Tables.length>4&&this.Parent instanceof It.FavoritesViewModel&&(this.SetSelectedItems(this.Users,e.Tables[4],"FavName='"+this.ReportName+"' and UserID={0}"),this.SetSelectedItems(this.Roles,e.Tables[4],"FavName='"+this.ReportName+"' and RoleID={0}")))}GetSelectedNames(e){let t,s="";for(let i=1;i<e.Items.length;i++)t=e.Items[i],t.IsChecked&&1!=t.Type&&(s.length>0&&(s+=","),s+=t.Name);return s.toString()}GetSelectedItems(e){let t,s="";for(let i=1;i<e.Items.length;i++)t=e.Items[i],t.IsChecked&&1!=t.Type&&(s.length>0&&(s+=","),s+=t.Value);return s.toString()}SetSelectedItems(e,t,s){this.LockCheckedChanged=!0;let i,a=!0,r=[];for(let o=1;o<e.Items.length;o++)i=e.Items[o],t.RowFilter=n.e.Format(s,i.Value),t.length>0&&(t.RowFilter.startsWith("Group",0)?r=Object.keys(t[0]).Contains("GroupID")?t.filter(e=>e.GroupID==i.Value):t.filter(e=>e.Group==i.Value):t.RowFilter.startsWith("RoleID",0)?r=t.filter(e=>e.RoleID==i.Value):t.RowFilter.startsWith("CCNID2",0)?r=t.filter(e=>e.CCNID2==i.Value):t.RowFilter.startsWith("UserID",0)?r=t.filter(e=>e.UserID==i.Value):t.RowFilter.startsWith("FavName",0)&&t.RowFilter.Contains("UserID")?r=t.filter(e=>e.FavName==this.ReportName&&e.UserID==i.Value):t.RowFilter.startsWith("FavName",0)&&t.RowFilter.Contains("RoleID")&&(r=t.filter(e=>e.FavName==this.ReportName&&e.RoleID==i.Value))),i.IsChecked=r.length>0,e.Items[o].IsChecked=i.IsChecked,i.IsChecked||(a=!1),i.IsChecked&&r.length>0&&!n.e.IsEmpty(r[0].IsParent)&&(i.Type=parseInt(r[0].IsParent.toString()));a&&(e.Items[0].IsChecked=!0),this.LockCheckedChanged=!1}SetSelectedItems_2(e,t){this.LockCheckedChanged=!0;let s,i=!0,a=t.split(",");for(let n=1;n<e.Items.length;n++)s=e.Items[n],s.IsChecked=!!a.Contains(s.Value),s.IsChecked||(i=!1);i&&(e.Items[0].IsChecked=!0),this.LockCheckedChanged=!1}OnCheckedChanged(e){if(!this.LockCheckedChanged&&e.item instanceof D.c){let t=e.item;if("All"==e.item.Value){this.LockCheckedChanged=!0;for(let t=1;t<this.SelectedApplication.Items.length;t++)this.SelectedApplication.Items[t].IsChecked=e.item.IsChecked;this.LockCheckedChanged=!1}else{if(this.LockCheckedChanged=!0,t.IsChecked){this.SelectedApplication.Items[0].IsChecked=!0;for(let e=1;e<this.SelectedApplication.Items.length;e++)if(!this.SelectedApplication.Items[e].IsChecked){this.SelectedApplication.Items[0].IsChecked=!1;break}}else this.SelectedApplication.Items[0].IsChecked=!1;this.LockCheckedChanged=!1}this.LockCheckedChanged=!1}}}class Pt extends l.b{constructor(e,t=!1,s=null){super(),this.ButtonClick=new b.b,this.IsShown=!1,this.GroupsItems=[],this.RolesItems=[],this.UsersItems=[],this.Grid=new F.a,this.ButtonClick.Subscribe(this,"OnButtonClick"),this.IsAllExists=e,this.IsReportAllAssign=t,this.Assign=s,this.Grid=new F.a,this.Grid.Width="",this.Grid.CanUserResizeColumns=!1,this.Grid.CanUserAddRows=!0,this.Grid.CanUserDeleteRows=!0,this.Grid.SearchVisible=!0,this.Grid.SearchColStartIndex=1,this.Grid.Table=[],this.Grid.TableColumns.push("CostCenterId"),this.Grid.DataTypes.Int.push("CostCenterId"),this.Grid.TableColumns.push("NodeID"),this.Grid.DataTypes.Int.push("NodeID"),this.Grid.TableColumns.push("NodeID_Name"),this.Grid.TableColumns.push("All"),this.Grid.DataTypes.Int.push("All"),this.Grid.TableColumns.push("View"),this.Grid.DataTypes.Int.push("View"),this.Grid.TableColumns.push("Print"),this.Grid.DataTypes.Int.push("Print"),this.Grid.TableColumns.push("Export"),this.Grid.DataTypes.Int.push("Export"),this.Grid.TableColumns.push("Email"),this.Grid.DataTypes.Int.push("Email"),this.Grid.TableColumns.push("SMS"),this.Grid.DataTypes.Int.push("SMS"),this.Grid.Columns=[];let i=[],a=new y.a;a.Header="Assign",a.ValueBinding="CostCenterId",a.DataType="ComboBox",a.DisplayMember="Name",a.ValueMember="Value",a.Width=130;let n=[];if(n.push(D.d.ComboBoxItems_2("Roles","6")),n.push(D.d.ComboBoxItems_2("Users","7")),n.push(D.d.ComboBoxItems_2("Groups","100")),a.ComboData=n,i.push(a),a=new y.a,a.Header="Data",a.DataType="LISTBOX",a.DisplayMember="NodeID_Name",a.ValueMember="NodeID",a.TypeID=1,a.Width=220,i.push(a),this.Grid.Columns=i,t){let e;a=new y.a,a.Header="All",a.ValueBinding="All",a.DataType="ComboBox",a.DisplayMember="Name",a.ValueMember="Value",a.Width=70,e.push(D.d.ComboBoxItems_2("Yes","1")),e.push(D.d.ComboBoxItems_2("No","1")),a.ComboData=e,i.push(a),a=new y.a,a.Header="View",a.ValueBinding="View",a.DataType="ComboBox",a.DisplayMember="Name",a.ValueMember="Value",a.Width=70,a.ComboData=e,i.push(a),a=new y.a,a.Header="Print",a.ValueBinding="Print",a.DataType="ComboBox",a.DisplayMember="Name",a.ValueMember="Value",a.Width=70,a.ComboData=e,i.push(a),a=new y.a,a.Header="Export",a.ValueBinding="Export",a.DataType="ComboBox",a.DisplayMember="Name",a.ValueMember="Value",a.Width=70,a.ComboData=e,i.push(a),a=new y.a,a.Header="Email",a.ValueBinding="Email",a.DataType="ComboBox",a.DisplayMember="Name",a.ValueMember="Value",a.Width=70,a.ComboData=e,i.push(a),a=new y.a,a.Header="SMS",a.ValueBinding="SMS",a.DataType="ComboBox",a.DisplayMember="Name",a.ValueMember="Value",a.Width=70,a.ComboData=e,i.push(a)}else this.Grid.SearchCols.Width="90",this.Grid.SearchText.Width="110",this.Grid.SearchOptions.Width="120";this.Grid.OnBeginEdit.Subscribe(this,"onBeginEdit"),this.Grid.OnCellEditEnding.Subscribe(this,"onCellEditEnd")}RefreshGrid(e,t,s){this.GroupsItems=e,this.RolesItems=t,this.UsersItems=s,this.Grid.Clear(),this.LoadSelectedItems(100,e),this.LoadSelectedItems(6,t),this.LoadSelectedItems(7,s);for(let i=0;i<15;i++){let e=this.Grid.NewRow();this.Grid.addRow(e)}}LoadReportAllGrid(e,t,s){}OnButtonClick(e){"Cancel"==e?a.a.page.HideDialog():"OK"==e&&(this.SetSelectedItems(100,this.GroupsItems),this.SetSelectedItems(6,this.RolesItems),this.SetSelectedItems(7,this.UsersItems),a.a.page.HideDialog())}onCellEditEnd(e,t,s){}GetCodeInfo(e){}onBeginEdit(e,t,s){return s instanceof Tt.a&&!n.e.IsEmpty(e.CostCenterId)&&(n.e.IsEmpty(e.CostCenterId)?s.CostCenterID=0:(s.CostCenterID=parseInt(e.CostCenterId),s.TypeID=1)),!1}LoadSelectedItems(e,t){for(let s=this.IsAllExists?1:0;s<t.length;s++)if(t[s].IsChecked){let i=this.Grid.NewRow();i.CostCenterId=e,i.NodeID=t[s].Value,i.NodeID_Name=t[s].Name,this.Grid.addRow(i)}}SetSelectedItems(e,t){let s,i=this.Grid.Table.filter(t=>t.CostCenterId==e);t.forEach(e=>{e.IsChecked=!1}),i.forEach(e=>{s=t.find(t=>t.Value==e.NodeID.toString()),null!=s&&(s.IsChecked=!0)})}}var At=s("e9cK"),Mt=s("BJEe"),Gt=s("kJpQ"),Nt=s("GhW8"),Et=s("2BcO"),wt=s("7ODK"),Ft=s("G8Yv"),Vt=s("PDNK"),Lt=s("/EUh");class Rt extends l.b{constructor(e){super(),this.Parent=null,this.Account=new m.b(0),this.ToDate=new d.a(0),this.FromDate=new d.a(0),this.rdoVTypeList=new Vt.b,this.IsVoucherNoChecked=new Vt.a,this.IsVoucherDateChecked=new Vt.a,this.rdoList=new Vt.b,this.IsPrintChecked=new Vt.a,this.IsExportChecked=new Vt.a,this.IsBarcodeChecked=new Vt.a,this.IsEmailChecked=new Vt.a,this.IsSMSChecked=new Vt.a,this.IsAPIChecked=new Vt.a,this.BarcodeVisibile=!1,this.APIVisibile=!1,this.IsPrintChecked.Label=a.a.GetResource("Print"),this.IsExportChecked.Label=a.a.GetResource("lbl_Export"),this.IsBarcodeChecked.Label=a.a.GetResource("Barcode"),this.IsEmailChecked.Label=a.a.GetResource("SMTP_Email"),this.IsSMSChecked.Label=a.a.GetResource("SMTP_SMS"),this.IsAPIChecked.Label=a.a.GetResource("API"),this.IsPrintChecked.Group=this.rdoList,this.IsExportChecked.Group=this.rdoList,this.IsBarcodeChecked.Group=this.rdoList,this.IsEmailChecked.Group=this.rdoList,this.IsSMSChecked.Group=this.rdoList,this.IsAPIChecked.Group=this.rdoList,this.rdoList.Items.push(this.IsPrintChecked),this.rdoList.Items.push(this.IsExportChecked),this.rdoList.Items.push(this.IsBarcodeChecked),this.rdoList.Items.push(this.IsEmailChecked),this.rdoList.Items.push(this.IsSMSChecked),this.rdoList.Items.push(this.IsAPIChecked),this.IsPrintChecked.IsChecked=!0,this.IsPrintChecked.CheckedChangedCommand.Subscribe(this,"rdoClick"),this.IsExportChecked.CheckedChangedCommand.Subscribe(this,"rdoClick"),this.IsBarcodeChecked.CheckedChangedCommand.Subscribe(this,"rdoClick"),this.IsEmailChecked.CheckedChangedCommand.Subscribe(this,"rdoClick"),this.IsSMSChecked.CheckedChangedCommand.Subscribe(this,"rdoClick"),this.IsAPIChecked.CheckedChangedCommand.Subscribe(this,"rdoClick"),this.Parent=e,this.FromPrefix=new p.a(0),this.ToPrefix=new p.a(0),this.EmailTemplates=new D.e(0),this.ClubAttachments=new S.a(0),this.EmailTemplates.Visible=!1,this.ClubAttachments.Visible=!1,this.Account.Label=a.a.GetResource("DocumentDesigner_Account"),this.Account.LblWidth="130",this.Account.CCID=2,this.Account.TypeID=2,this.ClubAttachments.LblWidth="130",this.EmailTemplates.LblWidth="130",this.IsVoucherNoChecked.IsChecked=!0,this.IsVoucherNoChecked.Label=a.a.GetResource("Doc_DocumentNumber"),this.IsVoucherDateChecked.Label=a.a.GetResource("Reports_LblVoucherDate"),this.IsVoucherNoChecked.Group=this.rdoVTypeList,this.IsVoucherDateChecked.Group=this.rdoVTypeList,this.rdoVTypeList.Items.push(this.IsVoucherNoChecked),this.rdoVTypeList.Items.push(this.IsVoucherDateChecked),this.FromPrefix.Label=a.a.GetResource("StockTransferFrom"),this.FromPrefix.LblWidth="50",this.ToPrefix.Label=a.a.GetResource("StockTransferTo"),this.ToPrefix.LblWidth="50",this.FromDate.Label=a.a.GetResource("StockTransferFrom"),this.FromDate.LblWidth="50",this.ToDate.Label=a.a.GetResource("StockTransferTo"),this.ToDate.LblWidth="50",this.PrintDims=[],a.a.SessionManager.IsActionAssigned(e.CostCenterID,"Save&Barcode")&&(this.BarcodeVisibile=!0),a.a.SessionManager.IsActionAssigned(e.CostCenterID,"API")&&(this.APIVisibile=!0);let t=a.a.SessionManager.Preferences.ContPrintDims.length>0?a.a.SessionManager.Preferences.ContPrintDims.split(","):[];if(t.length>0){let e=a.a.common.GetDataSet("DOC035",a.a.SessionManager.Preferences.ContPrintDims).Tables[0];for(let s=0;s<e.length;s++){let i=new ke.PactQueryListBoxData(parseInt(t[s]));i.Label=e[s].Name.toString(),i.LblWidth="130",i.CCID=parseInt(e[s].FeatureID),i.TypeID=1,i.Row=s,this.PrintDims.push(i)}}this.ToPrefix.ComboBox.SelectionChangedCommand.Subscribe(this,"OnPrefixChanged","ToPrefix"),this.ToPrefix.ComboBox.Items=e.ScreenObject.DocPrefix.ComboBox.Items,this.ToPrefix.ComboBox.SelectedValue=e.ScreenObject.DocPrefix.ComboBox.SelectedValue,this.FromPrefix.ComboBox=this.ToPrefix.ComboBox,this.OnPrefixChanged("ToPrefix"),this.FromPrefix.TextBox.Text="1"}rdoClick(e){e.IsChecked&&(e==this.IsPrintChecked?(this.ClubAttachments.Visible=!1,this.EmailTemplates.Visible=!1):e==this.IsExportChecked?(this.IsAPIChecked.Visible=!1,this.ClubAttachments.Label="Club All Documents In Single File",this.ClubAttachments.Visible=!0,this.EmailTemplates.Visible=!1):e==this.IsBarcodeChecked?(this.ClubAttachments.Visible=!1,this.EmailTemplates.Visible=!1,this.IsAPIChecked.Visible=!1):e==this.IsEmailChecked?(this.ClubAttachments.Label="Club All Documents In Attachment",this.ClubAttachments.Visible=!0,this.IsAPIChecked.Visible=!1,this.LoadEmailTemplates()):e==this.IsSMSChecked?(this.ClubAttachments.Visible=!1,this.IsAPIChecked.Visible=!1,this.LoadEmailTemplates()):e==this.IsAPIChecked&&(this.ClubAttachments.Visible=!1,this.LoadAPITemplates()))}LoadAPITemplates(){this.DisplayMessage="",this.EmailTemplates.Label="API Name",this.EmailTemplates.Visible=!0,this.EmailTemplates.Items.Clear(),a.a.document.GetAPIPostingDetails(this.Parent.CostCenterID,0,0,"").Tables[0].forEach(e=>{this.EmailTemplates.Items.push(D.d.ComboBoxItems_6(e.APIName.toString(),e.APISysName.toString(),!0,e.MapID.toString(),e.APIType.toString()))}),this.EmailTemplates.Items.length>0&&(this.EmailTemplates.SelectedItem=this.EmailTemplates.Items[0],this.EmailTemplates.SelectedValue=this.EmailTemplates.Items[0].Value)}OnPrefixChanged(e){let t=this.FromPrefix;if("FromPrefix"==e)return;"ToPrefix"==e&&(t=this.ToPrefix),t.TextBox.Text="0";let s=a.a.document.getcurrentcode(this.Parent.DocumentID,null==t.ComboBox.SelectedValue?"":t.ComboBox.SelectedValue);if(null!=s&&s.Tables.length>0&&s.Tables[0].length>0&&!s.Columns[0].Contains("ErrorMessage")&&s.Columns[0].Contains("CurrentCodeNumber")&&""!=s.Tables[0][0].CurrentCodeNumber.toString().Trim()){let e=parseInt(s.Tables[0][0].CurrentCodeNumber)-1;t.TextBox.Text=e.toString()}}OnButtonClick(e){"Cancel"==e?a.a.page.HideDialog():"OK"==e&&this.GetDocumentsList()}GetDocumentsList(){let e="";this.DisplayMessage="";let t="";this.PrintDims.forEach(e=>{0!=e.SelectedValue&&(t+=" and DCC.dcCCNID"+(e.CCID-5e4)+"="+e.SelectedValue)});let s=[];s.push(this.Parent.DocumentID),s.push(null==this.FromPrefix.ComboBox.SelectedValue?"":this.FromPrefix.ComboBox.SelectedValue),s.push(this.IsVoucherNoChecked.IsChecked?1:2),s.push(this.Account.SelectedValue);let i=n.e.Int(this.FromPrefix.TextBox.Text);s.push(i),i=n.e.Int(this.ToPrefix.TextBox.Text),s.push(i),s.push(this.FromDate.Date.ToString("dd MMM yyyy")),s.push(this.ToDate.Date.ToString("dd MMM yyyy")),s.push(t),s.push(!this.IsPrintChecked.IsChecked||a.a.SessionManager.IsActionAssigned(43,"Allow Re-Print")),s.push(this.IsPrintChecked.IsChecked||this.IsBarcodeChecked.IsChecked?this.Parent.DoNotPrintUnApprovedDocuments:this.Parent.DoNotEmailSMSUnApprovedDocuments),s.push(a.a.SessionManager.UserID),s.push(a.a.SessionManager.LanguageID);let r=a.a.document.GetDocVouchersList(s);if(null!=r&&r.Tables.length>0&&r.Tables[0].length>0)if(r.Columns[0].Contains("ErrorMessage"))this.DisplayMessage=r.Tables[0][0].ErrorMessage.toString();else{let t=r.Tables[0][0].DocID.toString();for(let s=1;s<r.Tables[0].length;s++)e+=","+r.Tables[0][s].DocID.toString();if(this.IsExportChecked.IsChecked||this.IsPrintChecked.IsChecked||this.IsEmailChecked.IsChecked&&this.ClubAttachments.IsChecked?e.length>0&&(e=e.Remove(0,1)):(e=t+e,t=null),this.IsPrintChecked.IsChecked)a.a.page.HideDialog(),setTimeout(()=>{this.Parent.Export(parseInt(t),e.toString(),!0,-1,!0)},600);else if(this.IsBarcodeChecked.IsChecked)a.a.page.HideDialog(),setTimeout(()=>{this.Parent.PrintBarcode(e.toString(),null)},500);else if(this.IsExportChecked.IsChecked)a.a.page.HideDialog(),setTimeout(()=>{this.Parent.Export(parseInt(t),e.toString(),this.ClubAttachments.IsChecked)},500);else if(this.IsAPIChecked){let e=0,t="";for(let s=0;s<r.Tables[0].length;s++)e=parseInt(r.Tables[0][s].DocID.toString()),t=this.Parent.APICallRequest(this.Parent.CostCenterID,e,parseInt(this.EmailTemplates.SelectedItem.Aliasname),this.EmailTemplates.SelectedItem.Parent);a.a.page.HideDialog()}else if(this.IsEmailChecked.IsChecked||this.IsSMSChecked.IsChecked){if(0==this.EmailTemplates.Items.length||null==this.EmailTemplates.SelectedValue)return void(this.DisplayMessage="Please Select Template");let s=[];s.push(2),s.push(this.Parent.CostCenterID),s.push(0),s.push(0),s.push(0),s.push(this.IsEmailChecked.IsChecked?1:2),s.push(a.a.SessionManager.UserEmail),s.push(""),s.push(null),this.IsEmailChecked.IsChecked?(s.push(null),s.push(null),s.push(null),s.push(parseInt(this.EmailTemplates.SelectedValue)),this.ClubAttachments.IsChecked?(s.push(e.toString()),s.push(t)):(s.push(null),s.push(e.toString()))):(s.push(""),s.push(""),s.push(null),s.push(parseInt(this.EmailTemplates.SelectedValue)),s.push(null),s.push(e.toString())),s.push(null),s.push(null),"TRUE"==a.a.SessionManager.Preferences.EnableLocationWise.toUpperCase()&&a.a.SessionManager.Preferences.ContainsKey("LWEmailSMS")&&"TRUE"==a.a.SessionManager.Preferences.LWEmailSMS.toUpperCase()?s.push(parseInt(this.EmailTemplates.GetselectedItem().Parent)):s.push(0);let i=0;Lt.a.SetNotifEventTemp(s).subscribe(e=>{this.DisplayMessage=e.Message,i=e.RetValue,i>0&&(this.Parent.DisplayMessage=e.Message,a.a.page.HideDialog())},e=>{console.log(e),this.DisplayMessage="Error in mail."})}}}LoadEmailTemplates(){this.DisplayMessage="",this.EmailTemplates.Label=this.IsEmailChecked.IsChecked?"Email Template":"SMS Template",this.EmailTemplates.Visible=!0,this.EmailTemplates.Items.Clear(),Lt.a.GetEmailSMS(6,this.Parent.DocumentID,this.IsEmailChecked.IsChecked?"1":"2").Tables[0].forEach(e=>{this.EmailTemplates.Items.push(D.d.ComboBoxItems_3(e.TemplateName.toString(),e.TemplateID.toString(),e.LocationID.toString()))}),this.EmailTemplates.Items.length>0&&(this.EmailTemplates.SelectedItem=this.EmailTemplates.Items[0],this.EmailTemplates.SelectedValue=this.EmailTemplates.Items[0].Value)}}var Bt=s("phzQ");class vt extends l.b{constructor(e){super(),this.PickFromAddress=new S.a,this.PickToAddress=new S.a,this.ShowAddress=!1,this.ShowDistance=!1,this.ShowLogin=!0,this.Actions=new D.e(0),this.Reasons=new D.e(0),this.GSTIN=new u.d(0),this.UserName=new u.d(0),this.Password=new u.d(0),this.Input=new u.d(0),this.FromPincode=new u.d(0),this.ToPincode=new u.d(0),this.Distance=new u.d(0),this.Parent=e,this.dsScreenDetails=we.a.GetGSTPostingDetails(this.Parent.DocID,this.Parent.CostCenterID,""),this.Actions.LblWidth="80",this.Actions.Label="GST Action : ",this.GSTIN.Label="GSTIN",this.UserName.Label="UserName",this.Password.Label="Password",this.FromPincode.Label="From Pincode",this.ToPincode.Label="To Pincode",this.Distance.Label="Distance",this.PickFromAddress.Label="Get From Address Details",this.PickToAddress.Label="Get To Address Details",this.Input.Visible=!1,this.Reasons.Visible=!1,this.Load(),this.Actions.SelectionChangedCommand.Subscribe(this,"OnselectionChanged")}Load(){if(this.Actions.Items.Clear(),this.Title="",null!=this.dsScreenDetails&&null!=this.dsScreenDetails.Tables&&this.dsScreenDetails.Tables.length>0&&this.dsScreenDetails.Tables[0].length>0)for(let e=0;e<this.dsScreenDetails.Tables[0].length;e++)"EINV"==this.dsScreenDetails.Tables[0][e].GSTType.toString()?(this.Title="E Invoice - Eway Bill",this.Actions.Items.push(D.d.ComboBoxItems_4("Generate IRN","INVOICE","EINV","2001")),this.Actions.Items.push(D.d.ComboBoxItems_4("Generate E-Way Bill By IRN","EWAYBILL","EINV","2003")),this.Actions.Items.push(D.d.ComboBoxItems_4("Cancel E-Way Bill By IRN","EWAYAPI","EINV","2004")),this.Actions.Items.push(D.d.ComboBoxItems_4("Cancel IRN","INVOICE/CANCEL","EINV","2002"))):"EWB"==this.dsScreenDetails.Tables[0][e].GSTType.toString()&&(this.Title.Contains("Eway Bill")||(this.Title="Eway Bill"),this.Actions.Items.push(D.d.ComboBoxItems_4("Generate E-Way Bill","GENEWAYBILL","EWB","2003")),this.Actions.Items.push(D.d.ComboBoxItems_3("Update Part-B/Vehicle Number","VEHEWB","EWB")),this.Actions.Items.push(D.d.ComboBoxItems_3("Extend Validity of E-Way bill","EXTENDVALIDITY","EWB")),this.Actions.Items.push(D.d.ComboBoxItems_3("Update Transporter","UPDATETRANSPORTER","EWB")),this.Actions.Items.push(D.d.ComboBoxItems_4("Cancel E-Way Bill","CANEWB","EWB","2004")),this.Actions.Items.push(D.d.ComboBoxItems_3("Reject E-Way Bill","REJEWB","EWB")))}OnselectionChanged(e){this.dsGSTDetails=we.a.GetGSTPostingDetails(this.Parent.DocID,this.Parent.CostCenterID,this.Actions.SelectedItem.Parent),null!=this.dsGSTDetails&&null!=this.dsGSTDetails.Tables&&this.dsGSTDetails.Tables.length>0&&this.dsGSTDetails.Tables[0].length>0?(this.dsGSTDetails.Columns[0].Contains("fromGstin")&&(this.GSTIN.Text=this.dsGSTDetails.Tables[0][0].fromGstin.toString()),this.dsGSTDetails.Columns[0].Contains("UserName")&&(this.UserName.Text=this.dsGSTDetails.Tables[0][0].UserName.toString())):(this.DisplayMessage="Error while data Fetch",this.MessageVisibility=!0),this.Input.Visible=!1,this.Reasons.Visible=!1,this.ShowAddress=!1,this.ShowDistance=!1,this.ShowLogin=!0,"B2CQRCODE"==this.Actions.SelectedValue?this.ShowLogin=!1:"GENEWAYBILL"==this.Actions.SelectedValue||"INVOICE"==this.Actions.SelectedValue?this.dsGSTDetails.Columns[0].Contains("transDistance")&&(this.ShowDistance=!0,n.e.IsNum(this.dsGSTDetails.Tables[0][0].transDistance)&&(this.Distance.Text=n.e.Int(this.dsGSTDetails.Tables[0][0].transDistance).toString()),n.e.IsNum(this.dsGSTDetails.Tables[0][0].fromPincode)&&(this.FromPincode.Text=n.e.Int(this.dsGSTDetails.Tables[0][0].fromPincode).toString()),n.e.IsNum(this.dsGSTDetails.Tables[0][0].dispPincode)&&(this.FromPincode.Text=n.e.Int(this.dsGSTDetails.Tables[0][0].dispPincode).toString()),n.e.IsNum(this.dsGSTDetails.Tables[0][0].toPincode)&&(this.ToPincode.Text=n.e.Int(this.dsGSTDetails.Tables[0][0].toPincode).toString()),n.e.IsNum(this.dsGSTDetails.Tables[0][0].shipPincode)&&(this.ToPincode.Text=n.e.Int(this.dsGSTDetails.Tables[0][0].shipPincode).toString())):"VEHEWB"==this.Actions.SelectedValue||"EXTENDVALIDITY"==this.Actions.SelectedValue?"VEHEWB"==this.Actions.SelectedValue?(this.Reasons.Visible=!0,this.Reasons.Label="Reason for Update ",this.Reasons.Items.Clear(),this.Reasons.Items.push(D.d.ComboBoxItems_3("Due to Break Down","1","Update")),this.Reasons.Items.push(D.d.ComboBoxItems_3("Due to Transshipment","2","Update")),this.Reasons.Items.push(D.d.ComboBoxItems_3("Others","3","Update")),this.Reasons.Items.push(D.d.ComboBoxItems_3("First Time","4","Update"))):"EXTENDVALIDITY"==this.Actions.SelectedValue&&(this.Input.Visible=!0,this.Input.Label="Remaining Distance ",this.Reasons.Visible=!0,this.Reasons.Label="Reason for Extension ",this.Reasons.Items.Clear(),this.Reasons.Items.push(D.d.ComboBoxItems_3("Natural Calamity","1","Extend")),this.Reasons.Items.push(D.d.ComboBoxItems_3("Law and Order Situation","2","Extend")),this.Reasons.Items.push(D.d.ComboBoxItems_3("Transshipment","4","Extend")),this.Reasons.Items.push(D.d.ComboBoxItems_3("Accident","5","Extend")),this.Reasons.Items.push(D.d.ComboBoxItems_3("Other","99","Extend"))):"UPDATETRANSPORTER"==this.Actions.SelectedValue?(this.Input.Visible=!0,this.Input.Label="Transporter ID "):"CANEWB"!=this.Actions.SelectedValue&&"INVOICE/CANCEL"!=this.Actions.SelectedValue&&"EWAYAPI"!=this.Actions.SelectedValue||(this.Reasons.Visible=!0,this.Reasons.Label="Reason for Cancellation ",this.Reasons.Items.Clear(),this.Reasons.Items.push(D.d.ComboBoxItems_3("Duplicate","1","Cancel")),this.Reasons.Items.push(D.d.ComboBoxItems_3("Order Cancelled","2","Cancel")),this.Reasons.Items.push(D.d.ComboBoxItems_3("Data Entry mistake","3","Cancel")),this.Reasons.Items.push(D.d.ComboBoxItems_3("Others","4","Cancel")))}OnButtonClick(e){if(null!=e)if("Cancel"==e.toString())a.a.page.HideDialog();else if("Distance"==e.toString()){if(n.e.IsEmpty(this.FromPincode.Text))return void(this.DisplayMessage="Please Enter From Pincode");if(n.e.IsEmpty(this.ToPincode.Text))return void(this.DisplayMessage="Please Enter To Pincode");let e,t=e.GetDistance(this.FromPincode.Text,this.ToPincode.Text);if(t>0&&(this.Distance.Text=t.toString(),this.dsGSTDetails.Columns[0].Contains("transDistance")))for(let s=0;s<this.dsGSTDetails.Tables[0].length;s++)this.dsGSTDetails.Tables[0][s].transDistance=t}else if("B2CQRCode"==e.toString()){if(!(null!=this.dsGSTDetails&&null!=this.dsGSTDetails.Tables&&this.dsGSTDetails.Tables.length>0&&this.dsGSTDetails.Tables[0].length>0))return void(this.DisplayMessage="Error while data Fetch");let e;this.dsGSTDetails.Columns[0].Contains("SignedQRCode")||this.dsGSTDetails.Tables[0].Columns.push("SignedQRCode");let s=e.GetB2CQRCode(this.dsGSTDetails.Tables[0]),i=this.dsScreenDetails.Tables[1].filter(e=>e.GSTType==this.Actions.SelectedItem.Parent&&"SignedQRCode"==e.GSTColumnName);if(i.length>0){let e="";(t=this.Parent.ScreenObject._TextFields.find(e=>e.DBColumnName.toString()==i[0].SysColumnName.toString()))&&t instanceof u.d&&(t.Text=s,n.e.IsEmpty(s)?(e=e+"DTD."+i[0].SysColumnName.toString()+"=N'',",this.DisplayMessage="Error while B2C QR Code Generating"):(e=e+"DTD."+i[0].SysColumnName.toString()+"=N'"+s+"',",this.DisplayMessage="B2C QR Code Generated Successfully")),n.e.IsEmpty(e)||a.a.common.GetDataSet3("DOC055",e.TrimEnd(","),this.dsGSTDetails.Tables[0][0].DocID.toString())}}else if("Upload"==e.toString()||"Json"==e.toString()){if(n.e.IsEmpty(this.Actions.SelectedValue))return void(this.DisplayMessage="Please Select Action");if(!(null!=this.dsGSTDetails&&null!=this.dsGSTDetails.Tables&&this.dsGSTDetails.Tables.length>0&&this.dsGSTDetails.Tables[0].length>0))return void(this.DisplayMessage="Error while data Fetch");if(this.Reasons.Visible&&null==this.Reasons.SelectedValue)return void(this.DisplayMessage="Select "+this.Reasons.Label);let s,i,r;if(this.dsGSTDetails.Columns[0].Contains("success")||this.dsGSTDetails.Tables[0].Columns.push("success"),"VEHEWB"==this.Actions.SelectedValue?(this.dsGSTDetails.Columns[0].Contains("reasonRem")||this.dsGSTDetails.Tables[0].Columns.push("reasonRem"),this.dsGSTDetails.Tables[0][0].reasonRem=this.Reasons.SelectedItem.Name):"EXTENDVALIDITY"==this.Actions.SelectedValue?(this.dsGSTDetails.Columns[0].Contains("remainingDistance")||this.dsGSTDetails.Tables[0].Columns.push("remainingDistance"),this.dsGSTDetails.Columns[0].Contains("extnRemarks")||this.dsGSTDetails.Tables[0].Columns.push("extnRemarks"),this.dsGSTDetails.Tables[0][0].remainingDistance=this.Input.Text,this.dsGSTDetails.Tables[0][0].extnRemarks=this.Reasons.SelectedItem.Name):"UPDATETRANSPORTER"==this.Actions.SelectedValue?(this.dsGSTDetails.Columns[0].Contains("transporterId")||this.dsGSTDetails.Tables[0].Columns.push("transporterId"),this.dsGSTDetails.Tables[0][0].transporterId=this.Input.Text):"CANEWB"!=this.Actions.SelectedValue&&"INVOICE/CANCEL"!=this.Actions.SelectedValue&&"EWAYAPI"!=this.Actions.SelectedValue||(this.dsGSTDetails.Columns[0].Contains("cancelRmrk")||this.dsGSTDetails.Tables[0].Columns.push("cancelRmrk"),this.dsGSTDetails.Tables[0][0].cancelRmrk=this.Reasons.SelectedItem.Name),"GENEWAYBILL"==this.Actions.SelectedValue||"INVOICE"==this.Actions.SelectedValue?(r=this.dsGSTDetails.Tables[0],i.pickFromAddress=s.pickFromAddress=this.PickFromAddress.IsChecked,i.pickToAddress=s.pickToAddress=this.PickToAddress.IsChecked):(r=[],r.push(this.dsGSTDetails.Tables[0][0])),"Upload"==e.toString()){if(n.e.IsEmpty(this.GSTIN.Text))return void(this.DisplayMessage="Please Enter GSTIN");if(n.e.IsEmpty(this.UserName.Text))return void(this.DisplayMessage="Please Enter UserName");if(n.e.IsEmpty(this.Password.Text))return void(this.DisplayMessage="Please Enter Password");if(!confirm("Are you sure to "+this.Actions.SelectedItem.Name))return;"EWB"==this.Actions.SelectedItem.Parent?this.DisplayMessage=i.UploadingEWB(this.UserName.Text,this.GSTIN.Text,this.Password.Text,this.Actions.SelectedValue):"EINV"==this.Actions.SelectedItem.Parent&&(this.DisplayMessage=s.UploadingEINV(this.UserName.Text,this.GSTIN.Text,this.Password.Text,this.Actions.SelectedValue));let e=this.dsScreenDetails.Tables[1].filter(e=>e.GSTType==this.Actions.SelectedItem.Parent);if(e.length>0){if("INVOICE/CANCEL"==this.Actions.SelectedValue)this.Parent.onButtonClick("Suspend"),a.a.page.HideDialog();else{let s="";for(let i=0;i<e.length;i++){var t;(t=this.Parent.ScreenObject._TextFields.find(t=>t.DBColumnName.toString()==e[i].SysColumnName.toString()))&&(t instanceof u.d?(t.Text=r[0][e[i].GSTColumnName.toString()].toString(),s=n.e.IsEmpty(r[0][e[i].GSTColumnName.toString()].toString())?s+"DTD."+e[i].SysColumnName.toString()+"=N'',":s+"DTD."+e[i].SysColumnName.toString()+"=N'"+r[0][e[i].GSTColumnName.toString()].toString()+"',"):t instanceof d.b&&(n.e.IsEmpty(r[0][e[i].GSTColumnName.toString()].toString())?t.Date=null:(new Date,t.Date=n.e.isValidDate(r[0][e[i].GSTColumnName.toString()])?new Date(r[0][e[i].GSTColumnName.toString()].toString()):null),s=t.Date?s+"DTD."+e[i].SysColumnName.toString()+"=N'"+t.Date.ToString("dd/MMM/yyyy hh:mm a")+"',":s+"DTD."+e[i].SysColumnName.toString()+"=N'',"))}n.e.IsEmpty(s)||a.a.common.GetDataSet3("DOC055",s.TrimEnd(","),r[0].DocID.toString())}if(!n.e.IsEmpty(this.Actions.SelectedItem.Aliasname)){let e=[];e.push(parseInt(this.Actions.SelectedItem.Aliasname)),e.push(this.Parent.CostCenterID),e.push(this.Parent.DocID),e.push("GUID"),e.push(a.a.SessionManager.UserName),e.push(a.a.SessionManager.UserID),e.push(a.a.SessionManager.LanguageID),a.a.report.SetNotifEvent(e)}}}else"Json"==e.toString()&&("EINV"==this.Actions.SelectedItem.Parent?this.DisplayMessage=s.GenerateJSON("",this.Actions.SelectedValue,""):"EWB"==this.Actions.SelectedItem.Parent&&(this.DisplayMessage=i.GenerateJSON("",this.Actions.SelectedValue,"")));return}}}var xt=s("s7Y5"),_t=s("BUEH");class kt extends l.b{constructor(e,t){super(),this.Title="",this.EmpCode="",this.EmpName="",this.iEmpSeqNo=0,this.iEmpSeqNo=e,this.LoadGrid(t),this.ClassName="VacationCreditedDaysDetailViewModel"}LoadGrid(e){this.dgv=new F.a,this.dgv.Columns=[],this.dgv.Height=200,this.dgv.Width="";let t=new y.a;t.Header="From Date",t.DisplayMember="FDATE",t.ID="FDATE",t.Width=80,t.ReadOnly=!0,this.dgv.Columns.push(t),t=new y.a,t.Header="To Date",t.DisplayMember="TDATE",t.ID="TDATE",t.Width=80,t.ReadOnly=!0,this.dgv.Columns.push(t),t=new y.a,t.Header="Days",t.DisplayMember="Days",t.ID="Days",t.Width=50,t.ReadOnly=!0,t.DataType="FLOAT",t.ShowTotal=!0,t.IsCalculated=1,t.DecimalPoints="2",this.dgv.Columns.push(t),this.dgv.Table=[],this.dgv.TableColumns.push("FDATE"),this.dgv.TableColumns.push("TDATE"),this.dgv.TableColumns.push("Days"),this.BindGrid(this.iEmpSeqNo,e)}BindGrid(e,t){this.iEmpSeqNo=e;let s,i=a.a.common.GetDataTable("PAY076",this.iEmpSeqNo.toString());if(null!=i&&i.length>0?(this.EmpCode="Employee Code : "+i[0].EmpCode.toString(),this.EmpName="Employee Name : "+i[0].EmpName.toString()):this.EmpCode=this.EmpName="",null!=t){let e=0;for(let i=0;i<t.length;i++)s=this.dgv.NewRow(),s.FDATE=new Date(t[i].FDATE).ToString(a.a.SessionManager.Preferences["Date Format"]),s.TDATE=new Date(t[i].TDATE).ToString(a.a.SessionManager.Preferences["Date Format"]),s.Days=parseFloat(t[i].Days).ToString("0.00"),e+=parseFloat(s.Days),this.dgv.addRow(s);this.dgv.Columns[2].footer=e.ToString("0.00"),this.dgv.UpdateFooter(),this.dgv.refreshDatawithIDs()}else s=this.dgv.NewRow(),this.dgv.addRow(s)}Button_Click(e){a.a.page.HideDialog()}}var Kt=s("kBEi"),Qt=s("I/F0");class Ht extends l.b{constructor(e,t){super(),this.Parent=e,this.Title="Select Register",this.RegisterList=t,null==this.SelectedRegister&&this.RegisterList.length>0&&(this.SelectedRegister=this.RegisterList[0]),this.LoadGrid(),this.SelectedRegisterObj.Table=this.RegisterList,this.SelectedRegisterObj.refreshDataView()}onSave(e){if("Cancel"==e)return this.MessageVisibility=!0,void(this.DisplayMessage=a.a.GetResource("Select Register"));if("OK"==e){if(null==this.SelectedRegister||""==n.e.String(this.SelectedRegister.NodeID).Trim())return this.MessageVisibility=!0,void(this.DisplayMessage=a.a.GetResource("Select Register"));this.SelectedRegister=this.SelectedRegisterObj.SelectedItem,this.Parent.ScreenObject.RegisterNodeID=parseInt(this.SelectedRegister.NodeID.toString()),a.a.page.HideDialog()}}LoadGrid(){Logger.InfoLog("AdjustmentsViewModel::Entering LoadGrid()"),this.SelectedRegisterObj=new F.a,this.SelectedRegisterObj.Columns=[],this.SelectedRegisterObj.Width="";let e=new y.a;e.Header="Code",e.DisplayMember="Code",e.ID="Code",e.Width=200,e.ReadOnly=!0,this.SelectedRegisterObj.Columns.push(e),e=new y.a,e.Header="Name",e.DisplayMember="Name",e.ID="Name",e.Width=200,e.ReadOnly=!0,this.SelectedRegisterObj.Columns.push(e),this.SelectedRegisterObj.Clear(),this.SelectedRegisterObj.TableColumns.push("Code"),this.SelectedRegisterObj.TableColumns.push("Name"),Logger.InfoLog("AdjustmentsViewModel::Exiting LoadGrid()")}}var Wt=s("JoYt"),Ut=s("3WaB");class Xt extends l.b{constructor(e){super(),this.ButtonClick=new b.b,this.ControlData=[],this.DisplayMember="",this.TouchVisibility=!1,this.txt=null,this.Parent=null,this.wid="50",this.ht="50",Logger.InfoLog("TouchScreenViewModel:: Entering TouchScreenViewModel"),this.Parent=e,this.ButtonClick.Subscribe(this,"OnButtonClick"),this.FillButtons(),Logger.InfoLog("TouchScreenViewModel:: Entering TouchScreenViewModel")}FillButtons(){return Object(i.b)(this,void 0,void 0,(function*(){this.ControlData=[];let e=new h.a;e.DBColumnID=0,e.Label="0",e.Formula="22",e.Width=(2*parseInt(this.wid)+4).toString(),e.SectionID=this.ht,e.Row=4,e.Column=1,e.ColumnSpan=2,e.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(e),e=new h.a,e.DBColumnID=1,e.Label="1",e.Formula="22",e.Width=this.wid,e.SectionID=this.ht,e.Row=3,e.Column=1,e.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(e),e=new h.a,e.DBColumnID=2,e.Label="2",e.Formula="22",e.Width=this.wid,e.SectionID=this.ht,e.Row=3,e.Column=2,e.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(e),e=new h.a,e.DBColumnID=3,e.Label="3",e.Formula="22",e.Width=this.wid,e.SectionID=this.ht,e.Row=3,e.Column=3,e.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(e),e=new h.a,e.DBColumnID=4,e.Label="4",e.Formula="22",e.Width=this.wid,e.SectionID=this.ht,e.Row=2,e.Column=1,e.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(e),e=new h.a,e.DBColumnID=5,e.Label="5",e.Formula="22",e.Width=this.wid,e.SectionID=this.ht,e.Row=2,e.Column=2,e.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(e),e=new h.a,e.DBColumnID=6,e.Label="6",e.Formula="22",e.Width=this.wid,e.SectionID=this.ht,e.Row=2,e.Column=3,e.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(e),e=new h.a,e.DBColumnID=7,e.Label="7",e.Formula="22",e.Width=this.wid,e.SectionID=this.ht,e.Row=1,e.Column=1,e.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(e),e=new h.a,e.DBColumnID=8,e.Label="8",e.Formula="22",e.Width=this.wid,e.SectionID=this.ht,e.Row=1,e.Column=2,e.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(e),e=new h.a,e.DBColumnID=9,e.Label="9",e.Formula="22",e.Width=this.wid,e.SectionID=this.ht,e.Row=1,e.Column=3,e.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(e),e=new h.a,e.DBColumnID=10,e.Label=".",e.Formula="32",e.Width=this.wid,e.SectionID=this.ht,e.Row=4,e.Column=3,e.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(e),e=new h.a,e.DBColumnID=11,e.Label="Enter",e.Formula="15",e.Width=this.wid,e.SectionID=(2*parseInt(this.ht)+4).toString(),e.Row=3,e.Column=4,e.RowSpan=2,e.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(e),e=new h.a,e.DBColumnID=12,e.Label="+",e.Formula="32",e.Width=this.wid,e.SectionID=this.ht,e.Row=0,e.Column=4,e.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(e),e=new h.a,e.DBColumnID=13,e.Label="-",e.Formula="32",e.Width=this.wid,e.SectionID=this.ht,e.Row=0,e.Column=0,e.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(e),e=new h.a,e.DBColumnID=14,e.Label="C",e.Formula="22",e.Width=this.wid,e.SectionID=this.ht,e.Row=2,e.Column=4,e.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(e),e=new h.a,e.DBColumnID=15,e.Label="<<",e.Formula="22",e.Width=this.wid,e.SectionID=this.ht,e.Row=1,e.Column=4,e.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(e),e=new h.a,e.DBColumnID=16,e.Label="^",e.Formula="25",e.Width=this.wid,e.SectionID=this.ht,e.Row=1,e.Column=0,e.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(e),e=new h.a,e.DBColumnID=17,e.Label="v",e.Formula="22",e.Width=this.wid,e.SectionID=this.ht,e.Row=2,e.Column=0,e.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(e),e=new h.a,e.DBColumnID=18,e.Label="Del",e.Formula="18",e.Width=this.wid,e.SectionID=(2*parseInt(this.ht)+4).toString(),e.Row=3,e.Column=0,e.RowSpan=2,e.ClickCommand.Subscribe(this,"OnButtonClick"),e.Enable="AddEditDocumentViewModel"==this.Parent.ClassName,this.ControlData.push(e),this.txt=new u.d,this.txt.DBColumnID=19,this.txt.Text="0",this.txt.Formula="24",this.txt.Width=(3*parseInt(this.wid)+6).toString(),this.txt.SectionID=this.ht,this.txt.Row=0,this.txt.Column=1,this.txt.ColumnSpan=3,this.ControlData.push(this.txt)}))}OnButtonClick(e){return Object(i.b)(this,void 0,void 0,(function*(){const{AddDenominationViewModel:t}=yield Promise.resolve().then(s.bind(null,"/GLD")),{POSExitViewModel:i}=yield Promise.all([s.e(8),s.e(23),s.e(24),s.e(25),s.e(28),s.e(30),s.e(29),s.e(32),s.e(31),s.e(27),s.e(26),s.e(35),s.e(37),s.e(38),s.e(36),s.e(33),s.e(34),s.e(39),s.e(40),s.e(41),s.e(70)]).then(s.bind(null,"FNqn")),{POSPayModesViewModel:n}=yield Promise.resolve().then(s.bind(null,"I/F0")),{PostVoucherSaveViewModel:r}=yield Promise.resolve().then(s.bind(null,"9UOb"));if(e instanceof h.a){let s=e;if(11==s.DBColumnID)"AddEditDocumentViewModel"==this.Parent.ClassName?null!=this.Parent.SelectedRow&&""!=this.txt.Text&&"0"!=this.txt.Text&&""!=this.DisplayMember&&(this.Parent.SelectedRow[this.DisplayMember]=parseFloat(this.txt.Text),this.Parent.FillDefaultProd(this.Parent.SelectedRow,this.DisplayMember),this.Parent.CalculateTotals(this.Parent.SelectedRow,!1,this.DisplayMember),this.DisplayMember="",this.txt.Text="0"):this.Parent instanceof n||this.Parent instanceof r?""!=this.txt.Text&&""!=this.DisplayMember?null!=this.Parent.Denom.GrdDenomination.SelectedItem&&(this.Parent.Denom.GrdDenomination.SelectedItem[this.DisplayMember]=parseFloat(this.txt.Text),this.Parent.Denom.GetTotal(),this.DisplayMember="",this.txt.Text="0"):""!=this.txt.Text&&""==this.DisplayMember&&(this.Parent.Amount.Text=parseFloat(this.txt.Text).ToString("N"+a.a.SessionManager.Preferences.DecimalsinAmount),this.txt.Text="0"):this.Parent instanceof i?""!=this.txt.Text&&null!=this.Parent.ExitGrid.SelectedItem&&(this.Parent.ExitGrid.SelectedItem.Amount=parseFloat(this.txt.Text),this.txt.Text="0"):this.Parent instanceof t&&""!=this.txt.Text&&""!=this.DisplayMember&&null!=this.Parent.GrdDenomination.SelectedItem&&(this.Parent.GrdDenomination.SelectedItem[this.DisplayMember]=parseFloat(this.txt.Text),this.Parent.GetTotal(),this.DisplayMember="",this.txt.Text="0");else if(12==s.DBColumnID)""==this.DisplayMember&&"AddEditDocumentViewModel"==this.Parent.ClassName?null!=this.Parent.SelectedRow&&""!=this.Parent.SelectedRow.ProductID_Key.toString()&&(this.txt.Text="0",this.Parent.SelectedRow.Quantity=parseFloat(this.Parent.SelectedRow.Quantity)+1,this.Parent.CalculateTotals(this.Parent.SelectedRow,!1,"Quantity")):""!=this.txt.Text&&(this.txt.Text=(parseFloat(this.txt.Text)+1).toString());else if(13==s.DBColumnID)""==this.DisplayMember&&"AddEditDocumentViewModel"==this.Parent.ClassName?null!=this.Parent.SelectedRow&&""!=this.Parent.SelectedRow.ProductID_Key.toString()&&(this.txt.Text="0",parseFloat(this.Parent.SelectedRow.Quantity)>1&&(this.Parent.SelectedRow.Quantity=parseFloat(this.Parent.SelectedRow.Quantity)-1,this.Parent.CalculateTotals(this.Parent.SelectedRow,!1,"Quantity"))):""!=this.txt.Text&&"0"!=this.txt.Text&&(this.txt.Text=(parseFloat(this.txt.Text)-1).toString());else if(14==s.DBColumnID)this.txt.Text="0";else if(15==s.DBColumnID)""!=this.txt.Text&&"0"!=this.txt.Text&&(this.txt.Text=this.txt.Text.substr(this.txt.Text.length-1),""==this.txt.Text&&(this.txt.Text="0"));else if(16==s.DBColumnID||17==s.DBColumnID){if("AddEditDocumentViewModel"==this.Parent.ClassName){if(null!=this.Parent.SelectedRow){let e=0;16==s.DBColumnID?e-=1:e+=1,e>=0&&e<this.Parent.SelectedRow.DataView.Table.length&&this.Parent.Setselectedrow(e),this.DisplayMember="",this.txt.Text="0"}}else if(this.Parent instanceof n){if(null!=this.Parent.Denom.GrdDenomination.SelectedItem){let e=this.Parent.Denom.GrdDenomination.SelectedIndex;16==s.DBColumnID?e-=1:e+=1,e>=0&&e<this.Parent.Denom.GrdDenomination.SelectedItem.DataView.Table.length&&(this.Parent.Denom.GrdDenomination.SelectedIndex=e)}}else if(this.Parent instanceof r){if(null!=this.Parent.Denom.GrdDenomination.SelectedItem){let e=this.Parent.Denom.GrdDenomination.SelectedIndex;16==s.DBColumnID?e-=1:e+=1,e>=0&&e<this.Parent.Denom.GrdDenomination.SelectedItem.DataView.Table.length&&(this.Parent.Denom.GrdDenomination.SelectedIndex=e)}}else if(this.Parent instanceof i){if(null!=this.Parent.ExitGrid.SelectedItem){let e=this.Parent.ExitGrid.SelectedIndex;16==s.DBColumnID?e-=1:e+=1,e>=0&&e<this.Parent.ExitGrid.SelectedItem.DataView.Table.length&&(this.Parent.ExitGrid.SelectedIndex=e)}}else if(this.Parent instanceof t&&null!=this.Parent.GrdDenomination.SelectedItem){let e=this.Parent.GrdDenomination.SelectedIndex;16==s.DBColumnID?e-=1:e+=1,e>=0&&e<this.Parent.GrdDenomination.SelectedItem.DataView.Table.length&&(this.Parent.GrdDenomination.SelectedIndex=e)}}else if(18==s.DBColumnID)"AddEditDocumentViewModel"==this.Parent.ClassName&&this.Parent.CanDeleteRow(this.Parent.SelectedRow)&&this.Parent.OnBeforeRowDeleting(this.Parent.SelectedRow,!0);else if(10==s.DBColumnID){if(this.txt.Text.Contains("."))return;this.txt.Text=this.txt.Text+s.Label}else this.txt.Text="0"==this.txt.Text?(parseFloat(this.txt.Text)+parseFloat(s.Label)).toString():this.txt.Text+s.Label}}))}}class qt extends l.b{constructor(e,t,s,i){super(),this.GridDataObj=new F.a,this.ColumnSource=[],this.Parent=null,this.ind=0,this.MaxLinkID=0,this.MaxLinkID=s,this.ind=i,Logger.InfoLog("LinkedProductsViewModel:: Entering LinkedProductsViewModel"),this.Parent=e,this.InitGrid();for(let a=0;a<t.length;a++)if(""!=t[a].LinkType.toString()&&1==parseInt(t[a].LinkType.toString())){let e=this.GridDataObj.NewRow();e.ProductName_Key=t[a].ProductID.toString(),e.ProductCode=t[a].Productcode.toString(),e.ProductName=t[a].ProductName.toString(),this.GridDataObj.addRow(e)}this.FillEmptyRows(),Logger.InfoLog("LinkedProductsViewModel:: Entering LinkedProductsViewModel")}get GridData(){return this.GridDataObj.Table}FillEmptyRows(){for(let e=this.GridData.length;e<10;e++)this.GridDataObj.addEmptyRow();for(let e=0;e<this.GridData.length;e++)this.GridData[e].Select=!1}CheckAll(e){for(let t=0;t<this.GridData.length;t++)n.e.IsEmpty(this.GridData[t].ProductName_Key)||(this.GridData[t].Select=e)}InitGrid(){let e;this.GridDataObj.TableColumns.push("Select"),this.GridDataObj.TableColumns.push("ProductCode"),this.GridDataObj.TableColumns.push("ProductName"),this.GridDataObj.TableColumns.push("ProductName_Key"),e=new y.a,e.Header="Select",e.DisplayMember="Select",e.DataType="CheckBox",e.Width=50,this.ColumnSource.push(e),e=new y.a,e.Header=a.a.GetResource("BOM_ProductCOde"),e.DisplayMember="ProductCode",e.ValueMember="ProductName_Key",e.DataType="TextBlock",e.Width=230,e.ReadOnly=!0,this.ColumnSource.push(e),e=new y.a,e.Header=a.a.GetResource("BOM_ProductName"),e.DisplayMember="ProductName",e.ValueMember="ProductName_Key",e.DataType="TextBlock",e.Width=230,e.ReadOnly=!0,this.ColumnSource.push(e),this.GridDataObj.Columns=this.ColumnSource,this.GridDataObj.SelectAll.Visible=!0}OnButtonClick(e){if("Cancel"==e)a.a.page.HideDialog();else if("OK"==e){for(let e=0;e<this.GridData.length;e++)if(!n.e.IsEmpty(this.GridData[e].Select)&&!n.e.IsEmpty(this.GridData[e].ProductName_Key)&&Object(o.j)(this.GridData[e].Select.toString())){let t=this.Parent.ScreenObject.GridDataObj.NewRow();t.ProductID_Key=this.GridData[e].ProductName_Key.toString(),t.Quantity="1",t.LinkID=this.MaxLinkID,this.Parent.ScreenObject.GridDataObj.insertRowAt(t,this.ind),this.Parent.AddProductData(t,!0,!1),this.Parent.CalculateTotals(t,!1),this.ind++}this.Parent.ScreenObject.UpdateSequence(),this.Parent.ScreenObject.GridDataObj.gridObj.invalidate(),a.a.page.HideDialog()}}}var Yt,Jt=s("ykB/"),zt=s("aa/T"),Zt=s("utDZ"),$t=s("+ryo");class es extends l.b{constructor(e,t,s=!1,i=null,o="AddEditDocumentViewModel",l=0){if(super(),this.PrevDocID=0,this.AutoPostDocID=0,this.AutoProduceDocID=0,this.PosSessionID=0,this.AutoPOstXML=null,this.AutoProduceXML=null,this.parent=null,this.AutoPostViewModel=null,this.AutoProduce=null,this.IsAutoPost=!1,this.isAutoProduce=!1,this.isSaveXml=!1,this.ScheduleID=0,this.RecurDocumentVoucherNo="",this.IsSuspend=!1,this.IsUserLock=!1,this.DocumentNumber=null,this.sDSCUserName="",this.bDSExists=!1,this.oDSImg=null,this.TempPVSaccid=0,this.TempPVSamt=0,this.TempPVSIsBillwise=!1,this.IsMessageBox=!1,this.IsMessageBoxvalue=0,this.ProductImageVisibility=!1,this.PhotoTextVisibility=!1,this.ProductPhoto="",this.Unit_keyOnBeginEditValue="",this.LineNo=0,this.ReadOnlyBody=!1,this.BodyVisible=!1,this.TabBtnVisible=!1,this.ColumnNo=0,this.ViewActivities=null,this.NodeID=0,this.POSPayModes=null,this.ProductSearchVisibility=!1,this.Activities=null,this.DocHistoryVisibility=!1,this.HoldProdSearch=null,this.HoldDocName=new u.d(0),this.HoldDocDate=new d.a(0),this.VacCrDaysVisibility=!1,this.MappedDocsVisibility=!1,this.ReportInfoVisibility=!1,this.DocLinkVisibility=!1,this.AddressesVisibility=!1,this.AssignVisibility=!1,this.DependencyVisibility=!1,this.AssignFields=null,this.Dependflds=new D.b(0),this.SalesManDimension=null,this.payTermXml="",this.LCBillsXml="",this.ChkRtnXml="",this.BillWiseXML="",this.ArApBills="",this.APIAddressXML="",this.POSpayXml="",this.IsReplaced=0,this.Shortcuts=[],this.t=new n.d,this.ccid=0,this.PrAccID=0,this.dtActionAssigned=null,this.DtPack=null,this.DtPackColumns=[],this.donotupInv=null,this.DtTempSchemes=null,this.DtTempSchemesColumns=null,this.ScreenObject=null,this.IsSales="1",this.Currency=null,this.ChequeBook=null,this.DonotUpdateInventory=!0,this.PDCSCleared=!1,this.DonotUpdateSchemeQty=!0,this.VoucherType=0,this.GridNetTotal=0,this.FooterGridNetTotal=0,this.CashDrwerPrintID=0,this.SaveCallBack=null,this.FooterDics=new r.a,this.BillWisedt=[],this.BillWisedtColumns=[],this.Bal=0,this.DivisionID=0,this.NetAmtVisibility=!0,this._Ddate=Date.Today(),this.FooterVisible=!1,this.QuickInfoVisibility=!1,this.DQuickInfoVisibility=!1,this.VoucherDefVisibility=!1,this.SelectedHistoryRow=null,this.StatusColor="#736F6F",this._DocStatus="",this.DialogResult=!1,this.GridRowHeight=25,this.IgnoreQuickViews=[],this.QuickInfoView=null,this.DQuickInfoView=null,this.IsInventoryVoucher=!1,this.ButtonSave=new h.a,this.ButtonRevise=new h.a,this.ButtonDelete=new h.a,this.ButtonSuspendDoc=new h.a,this.ButtonApprove=new h.a,this.ButtonSuspend=new h.a,this.ButtonSaveandPrint=new h.a,this.ButtonSaveandBarcode=new h.a,this.ButtonBarcode=new h.a,this.NumPadText="",this.ButtonCloseVisibility=!1,this.Remarks=new u.c(0),this.AppRejDate=new d.a(0),this.IsLocked=!1,this.RecurDocsWithApproval=new D.e(0),this.AddressViewVisibility=!1,this.NoteVisibility=!1,this.CaseVisibility=!1,this.OKCancelVisibility=!1,this.SelectedCase=null,this.CaseList=null,this._ApproveVisibility=!1,this._SuspendVisiblity=!1,this.ImportbuttonVisible=!1,this.ImportVisiblity=!1,this.DtImportObj=new F.a,this.IsImport=!1,this.RightPanelWidth=300,this.TouchVisibility=!1,this.FooterTouchVisible=!1,this.TouchView=null,this.NumericPADView=null,this.ImportIsUpdate=!1,this.ImportChunkSize="5",this.SearchVisibility=!1,this._AttachmentVisibility=!1,this.PopupVisibility=!1,this.AppDisplayMessage="",this.ButtonsEnabled=!0,this.Recur=null,this.Bounce=null,this.WFDocLevelList=[],this.ButtonsLeft=[],this.ButtonsPopup=[],this.DistributeInstallmentsVisible=!1,this.LoanGuaranteeVisible=!1,this.FailedRecourdList=[],this.ButtonsPopUp=!1,this.Note=null,this.ViewNotes=null,this._Attachment=null,this.CasesContactViewModel=null,Yt.set(this,void 0),this.DocumentID=0,this.StatusID=0,this.WorkFlowDocLevel=0,this.intRecCount=0,this.NotifWorkflowID=0,this.WfID=0,this.LCDueAmt=0,this.RightPanelVisiblity=!0,this.DisableRightPanel=!1,this.isFromDate=!1,this.OnRejectEdit=!1,this.IsLockDimsLineWise=!1,this.IsEdit=!1,this.LineWiseApproval=!1,this.UserWiseApproval=!1,this.linkStatusRemarks=null,this.timerDraft=new n.d,this.PoleDisplaytimer=new n.d,this.dsData=null,this.dtData=null,this.IsFrmFS_LoanBal=!1,this.IsMPVParent=!1,this.ReevaluateFutureVac=!1,this.GenratePrefix=!1,this.IsDocValid=!1,this.savebulk=!1,this.pdcGCVM=null,this.strEmpFilter="",this.HelpDoc="",this.strValidationMessage="",this.strVacXml="",this.sApprUpdate="",this.strPMCXml="",this.strEmpIsMgr="",this.ProjDims=null,this.dtOTTypes=null,this.dtPayEmps=null,this.dtPayShifts=null,this.sSearchColName="",this.iPMCActivity=0,this.srcDocument=null,this.ErrorMessage="Missing Report Parameter ' ",this.itemSourceFilter=[],this.IsFirstCallSelective=!1,this.dtLoanGuarantees=null,this.dtVacDefineDays=null,this.dtShiftAssRot=null,this.dtVacContract=null,this.isCheckIn=!1,this.isCheckOut=!1,this.isDAValidate=!1,this.DocNumberDelegate=new b.b,this.RightTabSelectedIndex=0,this.IgnoreOnSave=new r.a,this.SaveCallReq={Validate:!0},this.RetValue=0,this.commandprarameter="",this.SaveCallBackMethod=new b.b,this.isChequeReturn=!1,this.IsSelectAll=!1,this.FooterColumn="",this.IsBinwise=null,this.IsToBinwise=null,this.dsProjWOffHol=null,this.ProdID=0,this.PrevValue="",this.SubDialogResult=!1,this.IsLatesProcessTimingsUpdated=!1,this._BudgetObj=null,this.barcodeValues=null,this.ViewOrganizationViewModel=null,this.ShowPrintDialog=!0,this.IsExportPrint=!1,this.sXpsFileName="",this.drSelPrintLayout=null,this.dsTotLayouts=null,this.iLayCnt=0,this.dsVacationdays=null,this.isVacContractedit=!1,this.isVacPopup=!1,this.dsAllEmployeeData=null,this.IsGetAllEmployees=!1,this.sBioErrLogs="",this.sDAErrLogs="",this.iDgColFrom=-1,this.iDgColUpto=-1,this.iDtColFrom=-1,this.iDtColUpto=-1,this.dtEData=null,this.dsHrsDefDict=new r.a,this.dsHrsDef={},this.dsSaved={Tables:[]},this.VacCrDaysScreen=[],this.objPayDayCheck=null,this.strWhere="",this.sFilter="",this.sNodes="",this.IsNewAssignLeave=!1,this.dtALeaveComp=[],this.sEmpFilter="",this.dtPayMon=new Date,this.dtPayMonStart=new Date,this.dtPayMonEnd=new Date,this.dtLatesMonth=new Date,this.dtLatesMonthStart=new Date,this.dtLatesMonthEnd=new Date,this.ExcelData=[],this.leaveTab=new T.b,this.LeaveData=[],this.OnSesionGridDataChanged=new b.b,this.assignedLeaves=new u.d,this.availableLeaves=new u.d,this.noOfDays=new u.d,this.fromDate=new d.a,this.toDate=new d.a,this.session=new D.e,this.displayAgGrid=!1,this.displayLineItems=!1,this.DtImportObj.Table=[],this.ClassName=o,this.POSRegisterID=l,"EMPTY_LOAD"!=t){this.Remarks.Label=a.a.GetResource("Remarks"),this.AppRejDate.Label=a.a.GetResource("Date"),this.RecurDocsWithApproval.Label=a.a.GetResource("PostRecurDocsWithApproval"),this.HoldDocName.Label=a.a.GetResource("DocName"),this.HoldDocDate.Label=a.a.GetResource("Doc_Date"),this.Onload(e,t,s,i),this.RefreshNetAmount(),this.ScreenObject.IsConstructorCall=!1;var S=this.ScreenObject.ColumnSource.filter(e=>"Rate"==e.DisplayMember);0!=S.length&&(this.ScreenObject.RateVisibility=S[0].IsVisible),this.prepareLineItemsToForm()}else this.ScreenObject=new c.a(e,0)}get IsPurchase(){return this.ScreenObject.IsPurchase}get SetFocusongrid(){return this._SetFocusongrid}set SetFocusongrid(e){this._SetFocusongrid=!this._SetFocusongrid,this.ScreenObject.GridDataObj.TosetFocus.Call({LineNo:this.LineNo,ColumnNo:this.ColumnNo})}get POSBalanceAmount(){return this.ScreenObject.Preferences.ContainsKey("DecimalsNetAmount")&&""!=this.ScreenObject.Preferences.DecimalsNetAmount?(a.a.SessionManager.Preferences.ContainsKey("Commas"),this.Bal.ToString("N"+this.ScreenObject.Preferences.DecimalsNetAmount)):(a.a.SessionManager.Preferences.ContainsKey("Commas"),this.Bal.toString())}get NetAmountObs(){return this._NetAmountObs}set NetAmountObs(e){let t=n.e.Double(e);this._NetAmountObs=(this.ScreenObject.Preferences.ContainsKey("DecimalsNetAmount"),t.Commas("N"+this.ScreenObject.Preferences.DecimalsNetAmount))}RefreshNetAmount(){this.NetAmountObs=this.NetAmount}get NetAmount(){let e=1,t=0;return a.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(o.j)(a.a.SessionManager.Preferences["Use Foreign Currency"])&&null!=this.Currency&&null!=this.Currency.ExchangeRate.Text&&""!=this.Currency.ExchangeRate.Text&&this.ScreenObject.Preferences.ContainsKey("NettotaldocumentCurrency")&&""!=this.ScreenObject.Preferences.NettotaldocumentCurrency&&Object(o.j)(this.ScreenObject.Preferences.NettotaldocumentCurrency)&&n.e.IsNum(this.Currency.ExchangeRate.Text)&&(e=parseFloat(this.Currency.ExchangeRate.Text)),t=0!=e?(this.GridNetTotal+this.FooterGridNetTotal)/e:this.GridNetTotal+this.FooterGridNetTotal,this.ScreenObject.Preferences.ContainsKey("DecimalsNetAmount")&&""!=this.ScreenObject.Preferences.DecimalsNetAmount?(a.a.SessionManager.Preferences.ContainsKey("Commas")&&"Millions"!=a.a.SessionManager.Preferences.Commas&&(this.NetAmountObs=t.ToString("N"+this.ScreenObject.Preferences.DecimalsNetAmount)),t.ToString("N"+this.ScreenObject.Preferences.DecimalsNetAmount)):(a.a.SessionManager.Preferences.ContainsKey("Commas")&&"Millions"!=a.a.SessionManager.Preferences.Commas&&(this.NetAmountObs=t.toString()),this.NetAmountObs=t.toString(),this.NetAmountObs)}set DynFooter(e){this.ScreenObject.FooterGridDataObj.CanUserAddRows=e}get DocumentDate(){return this._Ddate}set DocumentDate(e){n.e.isValidDate(e)&&n.e.isValidDate(this._Ddate)&&e.getDate()===this._Ddate.getDate()||e!=this._Ddate&&(this._Ddate=e,this.ScreenObject.ovDate.Date=e,this.ScreenObject.DocDate&&(this.ScreenObject.DocDate.Date=e),0==this.ScreenObject.DocID&&this.CheckDateInDocNumber(!1),this.ReEvaluate(!0),null!=this.AutoPostViewModel&&(this.AutoPostViewModel.DocumentDate=e),a.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(o.j)(a.a.SessionManager.Preferences["Use Foreign Currency"])&&this.FillExchangeRates())}get SelectedRow(){return this.ScreenObject.GridDataObj.SelectedItem}set SelectedRow(e){e!=this.ScreenObject.GridDataObj.SelectedItem&&(n.e.IsEmpty(this.NUmpadBindingPath)||(this.NUmpadBindingPath=""),this.ScreenObject.GridDataObj.SelectedItem=e,this.SetReportDim())}get SelectedRowColumns(){return this.ScreenObject.GridDataColumns}get DocStatus(){return this._DocStatus}set DocStatus(e){e!=this._DocStatus&&(this._DocStatus=e,this.setStatusColor())}get DocStatusText(){return!(this._DocStatus.length>0)||this._DocStatus.Contains("[")&&this._DocStatus.Contains("(")?this._DocStatus:this._DocStatus.substring(1,this._DocStatus.length-1)}set UpdateFooter(e){}set HistoryUpdateFooter(e){}set RefreshGridFooter(e){}set RefreshGrid(e){this.ScreenObject.GridDataObj.RefreshGrid=!0,this.ScreenObject.GridDataObj.RefreshGridView()}set ApproveVisibility(e){e!=this._ApproveVisibility&&(e?a.a.page.ShowDialog(this,xe.a,{ShowCenter:!0,HideClose:!0,NoWidth:!0,Title:a.a.GetResource("ApproveReject")}):a.a.page.HideDialog(),this._ApproveVisibility=e),this._SuspendVisiblity=!1}set SuspendVisiblity(e){e!=this._SuspendVisiblity&&(e||a.a.page.HideDialog(),this._SuspendVisiblity=e)}get DtImport(){return this.DtImportObj.Table}set DtImport(e){this.DtImportObj.Table=e}get IsPOs(){return null!=this.ScreenObject&&(38==this.ScreenObject.DocumentType||39==this.ScreenObject.DocumentType)}get ImportCols(){return this.DtImportObj.Columns}set ImportCols(e){this.DtImportObj.Columns=e}get AttachmentVisibility(){return this._AttachmentVisibility}set AttachmentVisibility(e){e!=this._AttachmentVisibility&&(this._AttachmentVisibility=e)}get DocID(){return null!=this.ScreenObject?this.ScreenObject.DocID:0}get GRIDTABLE(){return null!=this.ScreenObject?this.ScreenObject.GridData:[]}get ColumnSource(){return this.ScreenObject.ColumnSource}get DoNotPrintUnApprovedDocuments(){return!!this.ScreenObject.Preferences.ContainsKey("DoNotPrintUn-ApprovedDocuments")&&"TRUE"==this.ScreenObject.Preferences["DoNotPrintUn-ApprovedDocuments"].toUpperCase()}get DoNotEmailSMSUnApprovedDocuments(){return!!this.ScreenObject.Preferences.ContainsKey("DoNotEmailOrSMSUn-ApprovedDocuments")&&"TRUE"==this.ScreenObject.Preferences["DoNotEmailOrSMSUn-ApprovedDocuments"].toUpperCase()}OnAddNote(){this.Note=new A.AddNoteViewModel,this.Note.AddNoteViewModel_2(this)}get Attachment(){return this._Attachment}set Attachment(e){e!=this._Attachment&&(this._Attachment=e)}OnAddAttachment(){Logger.InfoLog("AddProductViewModel::Entering AddAttachment");let e="";null!=this.Attachment&&(e=this.Attachment.ColID);let t=null;null!=this.Attachment&&(t=this.Attachment.RowID),this.Attachment=new G.AddAttachmentViewModel,this.Attachment.AddAttachmentViewModel_2(this),""==e?(this.Attachment.ColID="",this.Attachment.RowID=null):(this.Attachment.ColID=e,this.Attachment.RowID=t),Logger.InfoLog("AddProductViewModel::Entering AddAttachment")}Onload(e,t,s=!1,i=null){Logger.InfoLog("AddEditDocumentViewModel::Entering AddEditDocumentViewModel"),this.timerDraft.Enabled=!0;try{this.timerDraft.Interval=1e3*parseInt(a.a.SessionManager.Preferences.AutoDocumentDraftTime)}catch(d){this.timerDraft.Interval=6e4}if(this.timerDraft.Elapsed(this,"timerDraft_Elapsed"),this.t.Interval=2e3,this.t.Tick(this,"t_Tick"),this.PoleDisplaytimer.Interval=6e4,this.IsEdit=s,this.CostCenterID=e,this.srcDocument=i,this.ScreenName=t,this.DocumentID=this.CostCenterID,this.ScreenObject=new c.a(this.CostCenterID,0),this.ScreenObject.LoadEditCallBack.Subscribe(this,"LoadEditCallBack"),this.ScreenObject.ClearCallBack.Subscribe(this,"ClearCallBack"),this.ScreenObject.ValidateData.Handler(this,"ValidateDataCallBack"),this.ScreenObject.GridDataObj.BeforeRowDeleting.Subscribe(this,"BeforeRowDeletingEvent"),this.ScreenObject.FooterGridDataObj.CellEditEnding.Subscribe(this,"OnFooterCellEditEnding"),this.ScreenObject.FooterGridDataObj.OnPreviewKeyDown.Subscribe(this,"OnFooterKeyDown"),this.ScreenObject.GridDataObj.CellEditEnding.Subscribe(this,"OnCellEditCommit"),this.ScreenObject.GridDataObj.BeginEdit.Subscribe(this,"onBeginEdit"),this.ScreenObject.GridDataObj.shortcut.Subscribe(this,"Onshortcut"),this.ScreenObject.FooterGridDataObj.BeginEdit.Subscribe(this,"onFooterBeginEdit"),this.ScreenObject.GridDataObj.OnPreviewKeyDown.Subscribe(this,"OnKeyDown"),this.ScreenObject.ReferenceCallBack.Subscribe(this,"ReferenceCallBack"),this.ScreenObject.ShowQuickViewCallBack.Handler(this,"ShowQuickViewCallBack"),this.ScreenObject.GridDataObj.callParentObjMethod.Subscribe(this,"CallfromgridObj"),this.ScreenObject.GridDataObj.OnLinkClick.Subscribe(this,"onGridLinkClick"),this.worker_DoWork(i),this.ScreenObject.IsAccessDenied)return;if(this.RefreshGridFooter=!0,null!=this.ScreenObject.DocPrefix&&(this.ScreenObject.DocPrefix.onGetData.Subscribe(this,"GetData"),this.ScreenObject.DocPrefix.NextVisibility=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Next"),this.ScreenObject.DocPrefix.PreviousVisibility=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Previous"),this.ScreenObject.DocPrefix.LoadVisibility=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"LoadDocument")),this.ScreenObject.Preferences.ContainsKey("Notes")&&""!=this.ScreenObject.Preferences.Notes&&Object(o.j)(this.ScreenObject.Preferences.Notes)){this.ViewNotes=new M.a(this),this.Note=new A.AddNoteViewModel,this.Note.AddNoteViewModel_2(this);let e=this.ScreenObject.CustomTab.Pages.find(e=>"Notes"==e.Name&&3==e.TabType);if(e){e.Fields.Clear(),e.Visible=!0,e.Fields.push(this.ViewNotes);let t=this.GetButton("Notes");t&&(t.Visible=!1)}}if(this.ScreenObject.Preferences.ContainsKey("Activities")&&"True"==this.ScreenObject.Preferences.Activities){this.ViewActivities=new Ue.b(this),this.ViewActivities.NodeID=this.DocID,this.ViewActivities.ViewActivityInSection=!0,this.NodeID=this.DocID,this.Activities=new Xe.a(this,!1),this.Activities.AssignVisiblity=!1,this.ViewActivities.Activities=this.Activities,this.ViewActivities.CloseVisible=!0;let e=this.ScreenObject.CustomTab.Pages.find(e=>"Activities"==e.Name&&3==e.TabType);if(e){e.Fields.Clear(),e.Visible=!0,this.ScreenObject.Preferences.ContainsKey("OneActivity")&&"True"==this.ScreenObject.Preferences.OneActivity?(this.Activities.ActivityOnScreen=!0,this.Activities.IsPopup=!0,this.Activities.OneActivity=!0,e.Fields.push(this.Activities)):this.ScreenObject.Preferences.ContainsKey("ActivityOnScreen")&&"True"==this.ScreenObject.Preferences.ActivityOnScreen?(this.Activities.ActivityOnScreen=!0,this.Activities.IsPopup=!0,e.Fields.push(this.Activities),e.Fields.push(this.ViewActivities)):e.Fields.push(this.ViewActivities);let t=this.GetButton("Activities");t&&(t.Visible=!1)}}if(this.ScreenObject.Preferences.ContainsKey("Attachments")&&""!=this.ScreenObject.Preferences.Attachments&&Object(o.j)(this.ScreenObject.Preferences.Attachments)){this.ViewAttachments=new j.ViewAttachmentViewModel(this),this.ViewAttachments.GridView=this.ScreenObject.Preferences.ContainsKey("AttachementThumbnail")&&""!=this.ScreenObject.Preferences.Attachments&&Object(o.j)(this.ScreenObject.Preferences.AttachementThumbnail);let e=this.ScreenObject.CustomTab.Pages.find(e=>"Attachments"==e.Name&&3==e.TabType);if(e){e.Fields.Clear(),e.Visible=!0,e.Fields.push(this.ViewAttachments);let t=this.GetButton("Attachments");t&&(t.Visible=!1)}}let r=this.ScreenObject.CustomTab.Pages.find(e=>"LinkInfo"==e.Name&&3==e.TabType);r&&(r.Fields.Clear(),r.Visible=!1,this.grdLinkTab=new k.a(this)),this.ReportDimension=new m.b(0),this.ReportDimension.CCID=this.ScreenObject.IsInventory?3:2,this.ScreenObject.IsInventory?(this.ReportDimension.TypeID=10,this.ReportDimension.Label=a.a.GetResource("DocumentDesigner_Product")):(this.ReportDimension.TypeID=100,this.ReportDimension.Label=a.a.GetResource("DocumentDesigner_Account")),this.ReportsList=[],this.DocsList=[];let l=[];if(null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>21&&this.ScreenObject.Data.Tables[21].forEach(e=>{if("2"!=n.e.String(e.Type)){let t=new h.a;t.DBColumnID=parseInt(e.ReportID),t.Label=e.ReportName.toString(),this.ScreenObject.Data.Columns[21].Contains("Shortcut")&&(t.KeyTip=e.Shortcut.toString()),this.ScreenObject.Data.Columns[21].Contains("DisplayAsPopup")&&!n.e.IsEmpty(e.DisplayAsPopup)&&(t.Dependancy=n.e.Int(e.DisplayAsPopup)),this.ScreenObject.Data.Columns[21].Contains("Width")&&!n.e.IsEmpty(e.Width)&&(t.GroupName=e.Width.toString()),this.ScreenObject.Data.Columns[21].Contains("Height")&&!n.e.IsEmpty(e.Height)&&(t.Length=e.Height.toString()),this.ScreenObject.Data.Columns[21].Contains("DocumentField")&&!n.e.IsEmpty(e.DocumentField)&&(t.Formula=e.DocumentField.toString()),this.ScreenObject.Data.Columns[21].Contains("mapxml")&&!n.e.IsEmpty(e.mapxml)&&(t.ToolTipFooterDescription=e.mapxml.toString()),l.Contains(parseInt(e.ReportID))||(l.push(parseInt(e.ReportID)),this.ReportsList.push(t),this.IsPOs&&(this.ScreenObject.Data.Columns[1].Contains("ActionHeight")?(t.SectionID=n.e.IsEmpty(this.ScreenObject.Data.Tables[1][0].ActionHeight)?"60":this.ScreenObject.Data.Tables[1][0].ActionHeight.toString(),t.Width=n.e.IsEmpty(this.ScreenObject.Data.Tables[1][0].ActionWidth)?"62":this.ScreenObject.Data.Tables[1][0].ActionWidth.toString()):(t.Width="62",t.SectionID="60"),t.ComParam="Reports "+t.DBColumnID,this.ButtonsLeft.push(t)))}else{let t=new h.a;t.DBColumnID=parseInt(e.ReportID),t.Label=e.ReportName.toString(),this.ScreenObject.Data.Columns[21].Contains("Shortcut")&&(t.KeyTip=e.Shortcut.toString()),this.ScreenObject.Data.Columns[21].Contains("DisplayAsPopup")&&!n.e.IsEmpty(e.DisplayAsPopup)&&(t.Dependancy=n.e.Int(e.DisplayAsPopup)),this.DocsList.push(t),this.IsPOs&&(this.ScreenObject.Data.Columns[1].Contains("ActionHeight")?(t.SectionID=n.e.IsEmpty(this.ScreenObject.Data.Tables[1][0].ActionHeight)?"60":this.ScreenObject.Data.Tables[1][0].ActionHeight.toString(),t.Width=n.e.IsEmpty(this.ScreenObject.Data.Tables[1][0].ActionWidth)?"62":this.ScreenObject.Data.Tables[1][0].ActionWidth.toString()):(t.Width="62",t.SectionID="60"),t.ComParam="Documents "+t.DBColumnID,this.ButtonsLeft.push(t))}}),a.a.SessionManager.RegisterCCID>0&&0==this.ScreenObject.RegisterNodeID&&this.ScreenObject.Data.Tables.length>18&&this.ScreenObject.Data.Tables[18].length>0&&!this.IsPOs){let e=a.a.admin.GetRegisters();if(e.Tables.length>0&&e.Columns[0].Contains("NodeID"))if(1==e.Tables[0].length)this.ScreenObject.RegisterNodeID=parseInt(e.Tables[0][0].NodeID);else if(e.Tables[0].length>0){let t=new Ht(this,e.Tables[0]);a.a.page.ShowDialog(t,Wt.a,{ShowCenter:!0,Title:t.Title})}}if(this.DocumentNumber&&this.DocumentNumber.DialogOptions&&this.DocumentNumber.DialogOptions.IsOpen||a.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==a.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(this.ScreenObject.FillListViews(!0),this.ReportDimension.IsAutoLoad=!0),35==this.ScreenObject.DocumentType&&(this.ViewOrganizationViewModel=this.GetViewOrganizationViewModel(this),this.CasesContactViewModel=this.GetCasesContactViewModel(this.ViewOrganizationViewModel,this),this.CasesContactViewModel.Contact.Items.Clear(),null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.SelectedValue>0)){let e=a.a.accounting.GetAccountDetails(this.ScreenObject.DebitAccount.SelectedValue);if(null!=e&&e.Tables[0].length>0&&(this.CasesContactViewModel.Contact.Items.push(D.d.ComboBoxItems_2("New","0")),this.CasesContactViewModel.Contact.SelectedValue="0",e.Tables.length>1&&e.Tables[2].length>0)){for(let t=0;t<e.Tables[2].length;t++)this.CasesContactViewModel.Contact.Items.push(D.d.ComboBoxItems_2(e.Tables[2][t].FirstName.toString(),e.Tables[2][t].ContactID.toString()));this.CasesContactViewModel.dvContacts=e.Tables[2].DefaultView}}let u=0;if(this.ScreenObject.Preferences.ContainsKey("Autopostdocument")&&""!=this.ScreenObject.Preferences.Autopostdocument&&parseInt(this.ScreenObject.Preferences.Autopostdocument)>4e4&&(!this.ScreenObject.Preferences.ContainsKey("AutoIssueNextStage")||"True"!=this.ScreenObject.Preferences.AutoIssueNextStage)&&(u=n.e.Int(this.ScreenObject.Preferences.Autopostdocument),this.AutoPostViewModel=new es(u,"",!1,this),this.AutoPostViewModel.IsAutoPost=!0,this.AutoPostViewModel.ScreenObject.GridDataColumns.push("RefSeqNo"),this.ScreenObject.GridDataColumns.push("RefSeqNo"),this.ScreenObject.Preferences.ContainsKey("NoAutoproduce")&&Object(o.j)(this.ScreenObject.Preferences.NoAutoproduce)&&null!=this.AutoPostViewModel.AutoProduce&&(this.AutoPostViewModel.AutoProduce=null)),33==this.DocumentType&&a.a.SessionManager.Preferences.ContainsKey("AutoProduceDoc")&&""!=a.a.SessionManager.Preferences.AutoProduceDoc&&n.e.Int(a.a.SessionManager.Preferences.AutoProduceDoc)>4e4&&(u=n.e.Int(this.ScreenObject.Preferences.AutoProduceDoc),this.AutoProduce=new es(u,"",!1),this.AutoProduce.isAutoProduce=!0,this.AutoProduce.ScreenObject.GridDataColumns.push("AutoRefSeqNo"),this.ScreenObject.GridDataColumns.push("AutoRefSeqNo")),15==this.DocumentType&&this.BatchPayment(),this.SetFocus(),this.SetSaveVisibility(),s||null==this.ScreenObject||null==this.ScreenObject.Link||null==this.ScreenObject.Link.LinkCombo||n.e.IsEmpty(this.ScreenObject.Link.LinkCombo.SelectedValue)||this.OLinkSelectionChanged(null),this.ConsolidateLeaveMonth(),this.SetNewDocFields(),this.CheckListViews(),this.ScreenObject.IsPayrollDocument&&(this.SetButtonVisibility("Recur",!1),this.SetButtonVisibility("Hold",!1),this.SetButtonVisibility("Release",!1),this.SetButtonVisibility("ShowJV",!1),this.SetButtonVisibility("ReEvaluate",!1),this.SetButtonVisibility("PriceChart",!1),this.SetButtonVisibility("PostBills",!1),this.dtPayEmps=a.a.common.GetDataSet("PAY045","").Tables[0],67==this.ScreenObject.DocumentType&&(this.dtPayShifts=a.a.common.GetDataSet("PAY046","").Tables[0],this.dtOTTypes=a.a.common.GetDataSet("PAY047","").Tables[0]),40056!=this.ScreenObject.CostCenterID&&40057!=this.ScreenObject.CostCenterID&&40081!=this.ScreenObject.CostCenterID&&40061!=this.ScreenObject.CostCenterID&&40072!=this.ScreenObject.CostCenterID&&40065!=this.ScreenObject.CostCenterID&&73!=this.ScreenObject.DocumentType&&94!=this.ScreenObject.DocumentType&&97!=this.ScreenObject.DocumentType||(this.ScreenObject.GridDataObj.CanUserAddRows=!1,this.ScreenObject.GridDataObj.CanUserDeleteRows=!1),99==this.ScreenObject.DocumentType&&(this.ScreenObject.GridDataObj.Clear(),this.ScreenObject.GridDataObj.CanUserAddRows=!1,this.ScreenObject.GridDataObj.CanUserDeleteRows=!1),null!=i&&"IsFrmFS_LoanBal"==i.toString()&&(this.DisableRightPanel=!0,this.OKCancelVisibility=!0)),45==this.DocumentType){let e=this.ScreenObject.ColumnSource.find(e=>"dcalpha15"==e.DisplayMember.toLowerCase());null!=e&&(e.FixedDateFormat=a.a.SessionManager.Preferences["Date Format"]+" hh:mm a"),e=this.ScreenObject.ColumnSource.find(e=>"dcalpha16"==e.DisplayMember.toLowerCase()),null!=e&&(e.FixedDateFormat=a.a.SessionManager.Preferences["Date Format"]+" hh:mm a"),e=this.ScreenObject.ColumnSource.find(e=>"dcalpha22"==e.DisplayMember.toLowerCase()),null!=e&&(e.FixedDateFormat=a.a.SessionManager.Preferences["Date Format"]+" hh:mm a"),e=this.ScreenObject.ColumnSource.find(e=>"dcalpha23"==e.DisplayMember.toLowerCase()),null!=e&&(e.FixedDateFormat=a.a.SessionManager.Preferences["Date Format"]+" hh:mm a")}this.ScreenObject.GridDataObj.IsDocument=!0,this.ScreenObject.GridDataObj.IsReadOnlyColor=!0,this.ScreenObject.GridDataObj.Height=this.ScreenObject.GridDataObj.Height+17,Logger.InfoLog("AddEditDocumentViewModel::Exiting AddEditDocumentViewModel")}GetViewOrganizationViewModel(e){return new Zt.a(e)}GetCasesContactViewModel(e,t){return new $t.CasesContactViewModel(e,t)}SetReportDim(){if(null!=this.ReportDimension&&this.ReportDimension.Visible&&null!=this.SelectedRow){if(null==this.SelectedRow)return;let e=this.GetColName();n.e.IsEmpty(this.SelectedRow[e])||(this.ReportDimension.SelectedValue=parseInt(this.SelectedRow[e].toString()),this.ReportDimension.IsAutoLoad&&(this.IsInventoryVoucher&&this.ScreenObject.GridDataColumns.Contains("ProductName")?this.ReportDimension.SelectedValueText=this.ReportDimension.Text=this.SelectedRow.ProductName.toString():this.IsInventoryVoucher&&this.ScreenObject.GridDataColumns.Contains("ProductCode")?this.ReportDimension.SelectedValueText=this.ReportDimension.Text=this.SelectedRow.ProductCode.toString():!this.IsInventoryVoucher&&this.ScreenObject.GridDataColumns.Contains("AccountCode")?this.ReportDimension.SelectedValueText=this.ReportDimension.Text=this.SelectedRow.AccountCode.toString():!this.IsInventoryVoucher&&this.ScreenObject.GridDataColumns.Contains("AccountName")&&(this.ReportDimension.SelectedValueText=this.ReportDimension.Text=this.SelectedRow.AccountName.toString())))}}BatchPayment(){return Object(i.b)(this,void 0,void 0,(function*(){if(this.ScreenObject.Preferences.ContainsKey("batchpaymentreport")&&""!=this.ScreenObject.Preferences.batchpaymentreport&&"0"!=this.ScreenObject.Preferences.batchpaymentreport){let e,t=1,i=1,r=0;null!=this.Currency&&null!=this.Currency.Currency.SelectedValue&&""!=this.Currency.Currency.SelectedValue&&(t=parseInt(this.Currency.Currency.SelectedValue)),null!=this.Currency&&null!=this.Currency.ExchangeRate.Text&&""!=this.Currency.ExchangeRate.Text&&(i=parseFloat(this.Currency.ExchangeRate.Text));const{ReportViewModel:o}=yield Promise.all([s.e(2),s.e(1),s.e(3),s.e(5),s.e(4),s.e(6),s.e(7),s.e(10),s.e(9),s.e(8),s.e(12),s.e(11),s.e(13),s.e(19),s.e(15),s.e(21),s.e(20),s.e(16),s.e(14),s.e(18),s.e(17),s.e(22),s.e(23),s.e(24),s.e(25),s.e(28),s.e(30),s.e(29),s.e(32),s.e(31),s.e(27),s.e(26),s.e(35),s.e(37),s.e(38),s.e(36),s.e(33),s.e(34),s.e(39),s.e(40),s.e(41),s.e(212)]).then(s.bind(null,"ThYU")),{ReportViewComponent:l}=yield Promise.all([s.e(32),s.e(37)]).then(s.bind(null,"YU11"));let c=new o;c.ReportViewModel_1(parseInt(this.ScreenObject.Preferences.batchpaymentreport)),c.DispayAsPopup=!0,c.ButtonSMS.Visible=c.ButtonPrint.Visible=c.ButtonExport.Visible=c.ButtonEmail.Visible=!1,c.ButtonPost.Visible=!0,c.ButtonPost.Label="Ok",a.a.page.ShowDialog(c,l,{HideHeader:!0}).subscribe(()=>{var s=c.Data.filter(e=>e.IsSelected&&""!=e.DataRow.AccountName_ID);if(s.sort((e,t)=>e.DataRow.AccountName_ID-t.DataRow.AccountName_ID),s.length>0){null!=e&&e.DialogResult&&(n.e.IsEmpty(e.sDocDate)||this.ScreenObject.HeaderFields.forEach(t=>{t instanceof d.d&&"docdate"==t.DBColumnName.toLowerCase()?(t.Date=new Date(e.sDocDate),this.ScreenObject.DocDate.Date=new Date(e.sDocDate),this.DocumentDate=new Date(e.sDocDate)):t instanceof d.a&&"actdocdate"==t.DBColumnName.toLowerCase()&&(t.Date=new Date(e.sDocDate))}));let c="";this.ScreenObject.GridDataObj.Clear();let u=null,D=null;for(let d=0;d<s.length;d++){if(d>0&&parseInt(s[d].DataRow.AccountName_ID.toString())!=parseInt(s[d-1].DataRow.AccountName_ID.toString())&&null!=D&&(D.AmtToAdjust.Text=r.ToString("N"+D.decimalpoints),D.NewReference.Text="0",this.ScreenObject.GridDataColumns.Contains("Amount")&&(u.Amount=r.ToString("N"+D.decimalpoints)),this.Celleditend(u,"DocSeqNo",0),D.OnSave("autosave"),u=null,D=null),null==u&&(r=0,u=this.ScreenObject.GridDataObj.NewRow(),u.DebitAccount_Key=s[d].DataRow.AccountName_ID.toString(),this.SelectedRow=this.ScreenObject.GridData[this.ScreenObject.GridData.length-1],D=new R,D.BillWiseViewModel_2(this,0,parseInt(s[d].DataRow.AccountName_ID.toString()),!1,t,i,!0,""),null!=e&&e.DialogResult)){if(e.iPayMode>0&&(null!=(l=this.ScreenObject.ColumnSource.find(e=>"CreditAccount"==e.DisplayMember))&&null!=l&&(u.CreditAccount_Key=e.iPayMode.toString(),this.Celleditend(u,"CreditAccount",2,0)),null==l||null==l)){var o=this.ScreenObject._StaticFields.find(e=>"CreditAccount"==e.DBColumnName);null!=o&&null!=o&&(o instanceof m.b?(o.SelectedValue=e.iPayMode,o.SelectedValueText=e.sPaymodeName,o.Text=e.sPaymodeName,this.ScreenObject.OnGetReference(o)):o instanceof C.a&&(o.Code.SelectedValueText=o.Code.Text=e.sPaymodeCode,o.Name.SelectedValueText=o.Name.Text=e.sPaymodeName,o.SelectedValue=e.iPayMode,this.ScreenObject.OnGetReference(o.Name)))}if(""!=e.sChequeBook&&(null!=(l=this.ScreenObject.ColumnSource.find(e=>"ChequeBookNo"==e.ValueBinding))&&null!=l&&(u.ChequeBookNo=e.sChequeBook),null==l||null==l)){let t=this.ScreenObject._StaticFields.find(e=>"ChequeBookNo"==e.DBColumnName);null!=t&&null!=t&&(t.SelectedValue=e.sChequeBook)}if(""!=e.sChequeNo){if(this.ScreenObject.Preferences.ContainsKey("AutoChequeNo")&&"TRUE"==this.ScreenObject.Preferences.AutoChequeNo.toUpperCase()&&""!=c){let t=parseInt(c);e.sChequeNo=c.Replace(t.toString(),"")+(t+1)}var l;if(null!=(l=this.ScreenObject.ColumnSource.find(e=>"ChequeNumber"==e.DisplayMember))&&null!=l&&(u.ChequeNumber=e.sChequeNo),null==l||null==l){let t=this.ScreenObject._StaticFields.find(e=>"ChequeNumber"==e.DBColumnName);null!=t&&(t.Text=e.sChequeNo)}c=e.sChequeNo}if(""!=e.sChequeDate&&(null!=(l=this.ScreenObject.ColumnSource.find(e=>"ChequeDate"==e.DisplayMember))&&null!=l&&(u.ChequeDate=new Date(e.sChequeDate).ToString(a.a.SessionManager.Preferences["Date Format"]),u.ChequeDate_Key=new Date(e.sChequeDate)),null==l||null==l)){let t=this.ScreenObject._StaticFields.find(e=>"ChequeDate"==e.DBColumnName);null!=t&&(t.Date=new Date(e.sChequeDate))}}if(null!=D){var h=D.GridData.filter(e=>e.DocNo==s[d].DataRow.DocNo.toString()&&e.DocSeqNo==s[d].DataRow.DocSeqNo.toString());if(h.length>0&&!n.e.IsEmpty(h[0].Due)){h[0].AmountPaidLC=h[0].Due;let e=0,s=0;n.e.IsEmpty(h[0].CurrID)||parseInt(h[0].CurrID.toString())!=t||""==h[0].ExchgRate.toString()||parseFloat(h[0].ExchgRate.toString())==i?s=parseFloat(h[0].AmountPaidLC.toString())/i:(s=parseFloat(h[0].AmountPaidLC.toString())/parseFloat(h[0].ExchgRate.toString()),e=parseFloat(h[0].AmountPaid.toString())*(parseFloat(h[0].ExchgRate.toString())-i)),h[0].AmountPaid=s.ToString("N"+D.decimalpoints),h[0].exchgl=e,D.PaidChange("AmountPaid",h[0],!1),r+=s}}}null!=D&&(D.AmtToAdjust.Text=r.ToString("N"+D.decimalpoints),D.NewReference.Text="0",this.ScreenObject.GridDataColumns.Contains("Amount")&&(u.Amount=r.ToString("N"+D.decimalpoints)),this.Celleditend(u,"DocSeqNo",0),D.OnSave("autosave"),this.ScreenObject.GridDataObj.addRow(u),this.ScreenObject.UpdateSequence(),this.RefreshGrid=!0)}})}}))}FillGridData(e){if(null!=e&&e.length>0){let t;this.ScreenObject.GridDataObj.Clear();for(let s=0;s<e.length;s++){t=this.ScreenObject.GridDataObj.NewRow();for(let i=0;i<Object.keys(e[0]).length;i++)t[Object.keys(e[0])[i]]=e[s][Object.keys(e[0])[i]];this.ScreenObject.GridData.push(t)}this.ScreenObject.GridDataObj.refreshDataView()}}CheckListViews(){if(!n.e.IsEmpty(a.a.SessionManager.config.ListViewCache)){let e=a.a.SessionManager.config.ListViewCache.split(",");for(let t=0;t<this.ScreenObject.ColumnSource.length;t++)if("LISTBOX"==this.ScreenObject.ColumnSource[t].DataType&&null!=a.a.SessionManager.ListViewDef){let s;s=this.ScreenObject.ColumnSource[t].TypeID>0?this.ScreenObject.ColumnSource[t].TypeID:1;let i=a.a.SessionManager.ListViewDef.Tables[0].filter(e=>e.CostCenterID==this.ScreenObject.ColumnSource[t].CostCenterID&&e.ListViewTypeID==s);if(i.length>0&&e.Contains(i[0].ListViewID.toString())&&a.a.SessionManager.ListViewCache&&a.a.SessionManager.ListViewCache.ContainsKey(parseInt(i[0].ListViewID)))continue}}}DimensionSelectedvalueData(){let e=0;if(73==this.ScreenObject.DocumentType){let t=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());if((t&&t instanceof m.b&&t.SelectedValue>0||t&&t instanceof C.a&&t.SelectedValue>0)&&(e=t.SelectedValue),0==e)return void(this.DisplayMessage="Please select the employee");if(t=this.ScreenObject._CCFields.find(e=>"dcccnid52"==e.DBColumnName.toLowerCase()),t&&t instanceof m.b&&t.SelectedValue>0&&(this.dsData=this.ScreenObject.GetAdjustmentLeaves(0,e,t.SelectedValue,this.DocID),this.dsData.Tables.length>0))if(this.dsData.Tables[0].length<=0)this.ScreenObject.GridDataObj.Clear(),this.DisplayMessage="No record found";else if(this.dsData.Tables[0].length>0){this.DisplayMessage="",this.MessageVisibility=!1;let e=null,t=0;e=null,this.ScreenObject.GridDataObj.Clear();let s=this.ScreenObject.Data.Tables[0].filter(e=>"ProductID"==e.SysColumnName);for(let i=0;i<this.dsData.Tables[0].length;i++)e=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridData.InsertAt(e,t),t++,s.length>0&&!n.e.IsEmpty(s[0].UserDefaultValue)&&(e.ProductID_Key=s[0].UserDefaultValue),e.dcAlpha1=this.dsData.Tables[0][i].VoucherNo,e.dcAlpha2=new Date(this.dsData.Tables[0][i].FROMDATE).ToString("dd-MMM-yyyy"),e.dcAlpha2_Key=new Date(this.dsData.Tables[0][i].FROMDATE).ToString("dd-MMM-yyyy"),e.dcAlpha3=new Date(this.dsData.Tables[0][i].TODATE).ToString("dd-MMM-yyyy"),e.dcAlpha3_Key=new Date(this.dsData.Tables[0][i].TODATE).ToString("dd-MMM-yyyy"),e.dcNum1=this.dsData.Tables[0][i].NOOFDAYS,e.dcAlpha4="No",e.dcAlpha5=this.dsData.Tables[0][i].DocSeqNo;this.dsData.Tables[0].length>0&&this.ScreenObject.GridDataObj.refreshDataView()}return}if(94==this.ScreenObject.DocumentType){this.ScreenObject.GridDataObj.Clear();let t=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());if((t&&t instanceof m.b&&t.SelectedValue>0||t&&t instanceof C.a&&t.SelectedValue>0)&&(e=t.SelectedValue),0==e)return void(this.DisplayMessage="Please select the employee");if(t=this.ScreenObject._CCFields.find(e=>"dcccnid52"==e.DBColumnName.toLowerCase()),t&&t instanceof m.b&&t.SelectedValue>0){let s=0;if(this.dsData=this.GetLOPLeaveDocuments(e,t.SelectedValue,this.DocumentDate),null!=this.dsData&&this.dsData.Tables.length>0){if(this.dsData.Tables[0].length>0&&this.dsData.Columns[0].Contains("ErrorMessage"))return void(this.DisplayMessage=this.dsData.Tables[0][0].ErrorMessage.toString());if(this.dsData.Tables[0].length>0){let e="",t=0,i=null,a=0;i=null;let r=this.ScreenObject.Data.Tables[0].filter(e=>"ProductID"==e.SysColumnName);for(let o=0;o<this.dsData.Tables[0].length;o++){e=this.dsData.Tables[0][o].VoucherNo.toString(),t=parseFloat(this.dsData.Tables[0][o].NoOfDays);let l=n.e.DTComputeSUM(this.dsData.Tables[1].filter(t=>t.LOPLeaveDocVoucherNo==e),"CurAdjDays",!1);l<t&&(i=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridData.InsertAt(i,a),a++,r.length>0&&!n.e.IsEmpty(r[0].UserDefaultValue)&&(i.ProductID_Key=r[0].UserDefaultValue),i.dcAlpha1=this.dsData.Tables[0][o].VoucherNo,i.dcAlpha2=new Date(this.dsData.Tables[0][o].FROMDATE).ToString("dd-MMM-yyyy"),i.dcAlpha2_Key=new Date(this.dsData.Tables[0][o].FROMDATE).ToString("dd-MMM-yyyy"),i.dcAlpha3=new Date(this.dsData.Tables[0][o].TODATE).ToString("dd-MMM-yyyy"),i.dcAlpha3_Key=new Date(this.dsData.Tables[0][o].TODATE).ToString("dd-MMM-yyyy"),i.dcAlpha4=this.dsData.Tables[0][o].NOOFDAYS,i.dcAlpha5="false",i.dcAlpha6=l.toString(),s++)}this.ScreenObject.GridDataObj.refreshDataView()}}0==s&&(this.ScreenObject.GridDataObj.Clear(),this.DisplayMessage="No record found")}return}let t=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());if(61==this.ScreenObject.DocumentType&&(t=this.ScreenObject._CCFields.find(e=>"dcccnid53"==e.DBColumnName.toLowerCase())),(t&&t instanceof m.b&&t.SelectedValue>0||t&&t instanceof C.a&&t.SelectedValue>0)&&(e=t.SelectedValue),e>0)if(56==this.ScreenObject.DocumentType){if(a.a.SessionManager.Preferences.ContainsKey("DonotAllowApplyLoanDuringProbationPeriod")&&Object(o.j)(a.a.SessionManager.Preferences.DonotAllowApplyLoanDuringProbationPeriod)){let t=a.a.common.GetDataSet3("PAY035",this.ScreenObject.DocDate.Date.ToString("dd/MMM/yyyy"),e.toString()).Tables[0];if(null!=t&&t.length>0&&null!=t[0].Valid&&null!=t[0].Valid&&"1"==t[0].Valid.toString())return void(this.DisplayMessage="Employee is in probation period, can not apply the Loan")}}else if(69==this.ScreenObject.DocumentType){let t=a.a.common.GetDataSet3("PAY036",this.DocID.toString(),e.toString()).Tables[0];if(null!=t&&t.length>0)return void(this.DisplayMessage="Employee Resignation document already exists, Check Document @ "+t[0].VoucherNo.toString())}else if(58==this.ScreenObject.DocumentType)this.dsData=this.ScreenObject.GetEmployeePayrollInfo(e,0,this.ScreenObject.DocDate.Date,0),this.dsData.Tables.length<0&&(this.DisplayMessage="No Employee record found");else if(61==this.ScreenObject.DocumentType){if(this.dsData=this.ScreenObject.GetPayrollComponents(4,e,0,this.ScreenObject.DocDate.Date),this.dsData.Tables.length>0)if(this.dsData.Tables[0].length<=0)this.DisplayMessage="No record found";else if(this.dsData.Tables[0].length>0){this.DisplayMessage="",this.MessageVisibility=!1;let e=null,t=0;e=null,this.ScreenObject.GridDataObj.Clear();let s=this.ScreenObject.Data.Tables[0].filter(e=>"ProductID"==e.SysColumnName);for(let i=0;i<this.dsData.Tables[0].length;i++)e=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridData.InsertAt(e,t),t++,s.length>0&&!n.e.IsEmpty(s[0].UserDefaultValue)&&(e.ProductID_Key=s[0].UserDefaultValue),e.dcAlpha17=this.dsData.Tables[0][i].NODEID,e.dcNum1=this.dsData.Tables[0][i].PERCENTAGE;this.ScreenObject.GridDataObj.refreshDataView()}}else if(65==this.ScreenObject.DocumentType){this.ScreenObject.GridDataObj.Clear();let t=0,s=this.ScreenObject._CCFields.find(e=>"dcccnid52"==e.DBColumnName.toLowerCase());if(s instanceof m.b&&(t=s.SelectedValue),e>1&&t>0&&(this.dsData=this.ScreenObject.GetEmployeePayrollInfo(e,2,this.ScreenObject.DocDate.Date,t),this.dsData.Tables.length>0))if(this.dsData.Tables[0].length<=0)this.DisplayMessage="Employee Vacation/Leave Details Not Found";else if(this.dsData.Tables[0].length>0){this.DisplayMessage="",this.MessageVisibility=!1;let e=null,t=0;e=null;let s=this.ScreenObject.Data.Tables[0].filter(e=>"ProductID"==e.SysColumnName);for(let i=0;i<this.dsData.Tables[0].length;i++)e=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridData.InsertAt(e,t),t++,s.length>0&&!n.e.IsEmpty(s[0].UserDefaultValue)&&(e.ProductID_Key=s[0].UserDefaultValue),e.dcAlpha1=new Date(this.dsData.Tables[0][i].FROMDATE).ToString(a.a.SessionManager.Preferences["Date Format"]),e.dcAlpha1_Key=new Date(this.dsData.Tables[0][i].FROMDATE),e.dcAlpha2=new Date(this.dsData.Tables[0][i].TODATE).ToString(a.a.SessionManager.Preferences["Date Format"]),e.dcAlpha2_Key=new Date(this.dsData.Tables[0][i].TODATE),e.dcAlpha5=parseFloat(this.dsData.Tables[0][i].DOCID),e.LinkedInvDocDetailsID=parseFloat(this.dsData.Tables[0][i].InvDocDetailsID);this.ScreenObject.GridDataObj.refreshDataView()}}else if(71==this.ScreenObject.DocumentType){let t=this.ScreenObject._TextFields.find(e=>"dcAlpha1"==e.DBColumnName.toString());if(this.dsData=this.ScreenObject.GetEmployeePayrollInfo(e,1,t?new Date(t.Date):this.ScreenObject.DocDate.Date,0),this.dsData.Tables.length>0&&this.dsData.Tables[0].length>0)if(parseInt(this.dsData.Tables[0][0].VALIDEMP)<=0)this.DisplayMessage="Employee is not valid for the current fiscal year period",this.ReadOnlyBody=!0,this.PostSalaryDocResetColumns(),this.FillEarnDeductDetails(1,t?parseInt(new Date(t.Date).ToString("yyyy")):parseInt(this.ScreenObject.DocDate.Date.ToString("yyyy")));else{this.DisplayMessage="",this.MessageVisibility=!1,this.ReadOnlyBody=!1,this.SetMonthNames(t?parseInt(new Date(t.Date).ToString("yyyy")):parseInt(this.ScreenObject.DocDate.Date.ToString("yyyy"))),this.SetNoofMonths(this.dsData);let s=null,i=0,a=this.ScreenObject.GetPayrollComponents(2,1,e,this.ScreenObject.DocDate.Date);if(a.Tables[0].sort((e,t)=>e.ParentID-t.ParentID),a.Tables.length>0&&a.Tables[0].length>0){s=null,this.ScreenObject.GridDataObj.Clear();let e=this.ScreenObject.Data.Tables[0].filter(e=>"ProductID"==e.SysColumnName);for(let t=0;t<a.Tables[0].length;t++)s=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridData.InsertAt(s,i),i++,e.length>0&&!n.e.IsEmpty(e[0].UserDefaultValue)&&(s.ProductID_Key=e[0].UserDefaultValue),s.dcAlpha2=a.Tables[0][t].NODEID,s.dcAlpha15=2==parseInt(a.Tables[0][t].ParentID)?"Earnings":"Deductions";this.ScreenObject.GridDataObj.refreshDataView()}}}else if(72==this.ScreenObject.DocumentType)this.ShowVacationCreditDaysDetail(e);else if(78==this.ScreenObject.DocumentType){let t=0,s=this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase());if(!(s instanceof D.e)||n.e.IsEmpty(s.SelectedValue))return void(this.DisplayMessage="Please select the year");t=parseInt(s.SelectedValue),this.FillTdsMonthlyandQuarterlyDetails(0,this._Ddate,e,t)}else if(68==this.ScreenObject.DocumentType){let t=[],s=this.ScreenObject._TextFields.find(e=>"dcAlpha2"==e.DBColumnName.toString());if(s&&(this.dsData=this.ScreenObject.GetPayrollComponents(0,1,e,new Date(s.Date))),this.dsData.Tables.length>0){let e=this.ScreenObject.ColumnSource.find(e=>"dcAlpha1"==e.ValueBinding);if(e&&this.dsData.Tables[0].length>0){for(let e=0;e<=this.dsData.Tables[0].length-1;e++)t.push(D.d.ComboBoxItems_2(this.dsData.Tables[0][e].NAME.toString(),this.dsData.Tables[0][e].NODEID.toString()));e.DisplayMember="Name",e.ValueMember="Value",e.ComboData=t}let s=this.ScreenObject.ColumnSource.find(e=>"dcAlpha3"==e.ValueBinding);s&&(s.DisplayMember="NAME",s.ValueMember="NODEID",s.ComboData=this.dsData.Tables[1],s.FilterColumn="dcAlpha1",s.FilterCondition="PARENTID={0}")}}else if(80==this.ScreenObject.DocumentType){let t=[];if(this.dsData=this.ScreenObject.GetPayrollComponents(7,0,e,this.ScreenObject.DocDate.Date),this.dsData.Tables.length>0){let e=this.ScreenObject.ColumnSource.find(e=>"dcAlpha1"==e.ValueBinding);if(e&&this.dsData.Tables[0].length>0){for(let e=0;e<=this.dsData.Tables[0].length-1;e++)t.push(D.d.ComboBoxItems_2(this.dsData.Tables[0][e].NAME.toString(),this.dsData.Tables[0][e].NODEID.toString()));e.DisplayMember="Name",e.ValueMember="Value",e.ComboData=t}let s=this.ScreenObject.ColumnSource.find(e=>"dcAlpha2"==e.ValueBinding);s&&(s.DisplayMember="NAME",s.ValueMember="NODEID",s.ComboData=this.dsData.Tables[1],s.FilterColumn="dcAlpha1",s.FilterCondition="PARENTID={0}")}}}ApplyVacationValidationMsg(e){let t="";if(e.Tables[0].length>0&&!n.e.IsEmpty(e.Tables[0][0].VacationdaysMessage)&&(t=e.Tables[0][0].VacationdaysMessage.toString()+" \r\n"),e.Tables[1].length>0&&!n.e.IsEmpty(e.Tables[1][0].VacationPreferencesMessage))t=t+e.Tables[1][0].VacationPreferencesMessage.toString()+" \r\n";else if(e.Tables[1].length>0&&parseInt(e.Tables[1][0].VacationField)>0&&n.e.IsEmpty(e.Tables[1][0].VacationPreferencesMessage)){let t=this.ScreenObject._CCFields.find(e=>"dcccnid52"==e.DBColumnName.toLowerCase());t&&t instanceof m.b&&(t.SelectedValue=parseInt(e.Tables[1][0].VacationField))}return e.Tables[2].length>0&&!n.e.IsEmpty(e.Tables[2][0].VacationMessage)&&(t=t+e.Tables[2][0].VacationMessage.toString()+" \r\n"),e.Tables[7].length>0&&!n.e.IsEmpty(e.Tables[7][0].VacationUnderApprovalMessage)&&(t=t+e.Tables[7][0].VacationUnderApprovalMessage.toString()+" \r\n"),t}ConsolidateLeaveMonth(){if(63==this.ScreenObject.DocumentType){let e=this.ScreenObject._TextFields.find(e=>"dcAlpha1"==e.DBColumnName.toString());e instanceof d.c&&(e.Date=new Date,e.CustomFormat="MMM/yyyy")}else if(89==this.ScreenObject.DocumentType||90==this.ScreenObject.DocumentType){let e=this.ScreenObject._TextFields.find(e=>"dcalpha32"==e.DBColumnName.toLowerCase());e instanceof D.e&&("Manual"==e.SelectedValue?(this.ScreenObject._TextFields.forEach(e=>{"dcalpha26"==e.DBColumnName.toLowerCase()?e.IsReadOnly=!0:"dcalpha27"==e.DBColumnName.toLowerCase()&&(e.Enable=!1)}),this.SetButtonVisibility("Save",!0),this.SetButtonVisibility("SaveAndPrint",!0),this.SetButtonVisibility("Check-in",!1),this.SetButtonVisibility("Check-out",!1)):(this.ScreenObject._TextFields.forEach(e=>{"dcalpha26"==e.DBColumnName.toLowerCase()?e.IsReadOnly=!1:"dcalpha27"==e.DBColumnName.toLowerCase()&&(e.Enable=!0)}),this.SetButtonVisibility("Save",!1),this.SetButtonVisibility("SaveAndPrint",!1),this.SetButtonVisibility("Check-in",!0),this.SetButtonVisibility("Check-out",!0)))}else if(56==this.ScreenObject.DocumentType){let e=this.ScreenObject._TextFields.find(e=>"dcAlpha5"==e.DBColumnName.toString());e instanceof d.c&&(e.Date=new Date((new Date).getFullYear(),(new Date).getMonth(),1),e.CustomFormat="MMM/yyyy")}else if(69==this.ScreenObject.DocumentType||86==this.ScreenObject.DocumentType||91==this.ScreenObject.DocumentType||98==this.ScreenObject.DocumentType)this.BodyVisible=!1;else if(92==this.ScreenObject.DocumentType){let e=this.ScreenObject._TextFields.find(e=>"dcalpha4"==e.DBColumnName.toLowerCase());e&&(e.IsReadOnly=this.DocID>0),this.iDtColFrom=this.iDtColUpto=-1;let t=this.ScreenObject.CustomTab.Pages[0].Fields.find(e=>e instanceof d.c&&"dcAlpha1"==e.DBColumnName),s=this.ScreenObject.CustomTab.Pages[0].Fields.find(e=>e instanceof d.c&&"dcAlpha2"==e.DBColumnName);t.Enable=s.Enable=!(this.ScreenObject.DocID>0);for(let a=this.ScreenObject.ColumnSource.length-1;a>=0;a--)null!=this.ScreenObject.ColumnSource[a].DrRefColName&&""!=this.ScreenObject.ColumnSource[a].DrRefColName&&"Date"==this.ScreenObject.ColumnSource[a].DrRefColName&&(this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.ColumnSource[a].DisplayMember)&&this.ScreenObject.GridDataColumns.Remove(this.ScreenObject.ColumnSource[a].DisplayMember),this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.ColumnSource[a].DisplayMember+"_Key")&&this.ScreenObject.GridDataColumns.Remove(this.ScreenObject.ColumnSource[a].DisplayMember+"_Key"),this.ScreenObject.ColumnSource.RemoveAt(a));let i=[];for(let a=0;a<this.ScreenObject.ColumnSource.length;a++)i.push(this.ScreenObject.ColumnSource[a]);this.ScreenObject.ColumnSource=i,this.ScreenObject.GridDataObj.RefreshColumns()}else if(68==this.ScreenObject.DocumentType){let e=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase());null!=e&&null!=e&&(e.IsReadOnly=!1)}}SetNewDocFields(){if(58!=this.ScreenObject.DocumentType&&65!=this.ScreenObject.DocumentType&&71!=this.ScreenObject.DocumentType&&72!=this.ScreenObject.DocumentType&&78!=this.ScreenObject.DocumentType&&68!=this.ScreenObject.DocumentType&&80!=this.ScreenObject.DocumentType||this.ScreenObject._CCFields.forEach(e=>{if(e instanceof m.b&&e.OnPactListBoxValueChanged.Subscribe(this.ScreenObject,"OnGetReference"),72==this.ScreenObject.DocumentType){this.ReportInfoVisibility=!(this.ScreenObject.Preferences.ContainsKey("ShowVacationCreditDaysDetail")&&!n.e.IsEmpty(this.ScreenObject.Preferences.ShowVacationCreditDaysDetail)&&Object(o.j)(this.ScreenObject.Preferences.ShowVacationCreditDaysDetail));let e=this.ScreenObject._TextFields.find(e=>"dcAlpha25"==e.DBColumnName.toString());e&&(e.CustomFormat="MMM/yyyy",e.Date=(new Date).MonthsFirst()),this.ScreenObject._TextFields.forEach(e=>{}),this.FillEarningsDeductions(0,this.ScreenObject.DocDate.Date),this.ShowVacationCreditDaysDetail(0)}}),61==this.ScreenObject.DocumentType)this.ScreenObject._CCFields.forEach(e=>{e instanceof m.b&&"dcccnid53"==e.DBColumnName.toLowerCase()&&e.OnPactListBoxValueChanged.Subscribe(this.ScreenObject,"OnGetReference")}),this.ScreenObject._TextFields.forEach(e=>{e instanceof m.b&&"dcalpha1"==e.DBColumnName.toLowerCase()&&e.OnPactListBoxValueChanged.UnSubscribe(),e instanceof m.b&&"dcalpha5"==e.DBColumnName.toLowerCase()&&e.OnPactListBoxValueChanged.UnSubscribe()}),this.FillVacationManagementComponents();else if(67==this.ScreenObject.DocumentType){let e=a.a.common.GetDataSet("PAY037",this.ScreenObject.CostCenterID.toString());if(null!=e&&0==e.Tables[0].length)return this.DisplayMessage="Please Enable Payroll Document Fields from Global Preferences (Payroll Tab)",void(this.ReadOnlyBody=!0);let t=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());if((t instanceof m.b||t instanceof C.a)&&(t.KeyTip="",this.GetButton("All Employees").Visible=!1,this.GetButton("Get Previous Day").Visible=!1,this.GetButton("Fill Dates").Visible=!0,this.GetButton("Fill General Timings").Visible=!0),null!=this.ScreenObject.ColumnSource.find(e=>"dcccnid51"==e.DisplayMember.toLowerCase())&&(this.GetButton("All Employees").Visible=!0,this.GetButton("Get Previous Day").Visible=!0,this.GetButton("Fill Dates").Visible=!1,this.GetButton("Fill General Timings").Visible=!1),t=this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase()),t instanceof d.c&&(t.KeyTip=""),a.a.SessionManager.Preferences.ContainsKey("BreakHoursImpactToOTS")&&Object(o.j)("True"==a.a.SessionManager.Preferences.BreakHoursImpactToOTS)){let e=this.ScreenObject.ColumnSource.find(e=>"dcNum4"==e.DisplayMember);e&&(e.ReadOnly=!1)}if(a.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")&&Object(o.j)("True"==a.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)){let e=this.ScreenObject.ColumnSource.find(e=>"dcNum4"==e.DisplayMember);e&&(e.ReadOnly=!1);let t=this.ScreenObject.ColumnSource.find(e=>"dcNum5"==e.DisplayMember);t&&(t.ReadOnly=!1);let s=this.ScreenObject.ColumnSource.find(e=>"dcNum7"==e.DisplayMember);s&&(s.ReadOnly=!1);let i=this.ScreenObject.ColumnSource.find(e=>"dcNum9"==e.DisplayMember);i&&(i.ReadOnly=!1);let a=this.ScreenObject.ColumnSource.find(e=>"dcNum11"==e.DisplayMember);a&&(a.ReadOnly=!1);let n=this.ScreenObject.ColumnSource.find(e=>"dcNum13"==e.DisplayMember);n&&(n.ReadOnly=!1)}this.GetButton("Employee Filter").Visible=!0,this.GetButton("Set Columns").Visible=!0}else if(68==this.ScreenObject.DocumentType){let e=this.ScreenObject._TextFields.find(e=>"dcAlpha2"==e.DBColumnName.toString());null!=e&&(e.Date=new Date(a.a.SessionManager.PayrollMonth),e.CustomFormat="MMM/yyyy"),e=this.ScreenObject._TextFields.find(e=>"dcAlpha4"==e.DBColumnName.toString()),null!=e&&(e.Date=new Date(a.a.SessionManager.PayrollMonth),e.CustomFormat="MMM/yyyy");let t=[];if(this.dsData=this.ScreenObject.GetPayrollComponents(0,1,0,new Date(a.a.SessionManager.PayrollMonth)),this.dsData.Tables.length>0){let e=this.ScreenObject.ColumnSource.find(e=>"dcAlpha1"==e.ValueBinding);if(e&&this.dsData.Tables[0].length>0){let s=null;s=this.dsData.Tables[0];let i=this.ScreenObject.Data.Tables[0].filter(t=>t.SysColumnName==e.ValueBinding);if(null!=i&&i.length>0&&!n.e.IsEmpty(i[0].UserProbableValues)&&""!=i[0].UserProbableValues.toString().Trim()&&(s=s.filter(e=>e.NodeID==i[0].UserProbableValues)),s.length>0){for(let e=0;e<=s.length-1;e++)t.push(D.d.ComboBoxItems_2(s[e].NAME.toString(),s[e].NODEID.toString()));e.DisplayMember="Name",e.ValueMember="Value",e.ComboData=t}}let s=this.ScreenObject.ColumnSource.find(e=>"dcAlpha3"==e.ValueBinding);if(s){s.DisplayMember="NAME",s.ValueMember="NODEID",s.ComboData=this.dsData.Tables[1],s.FilterColumn="dcAlpha1",s.FilterCondition="PARENTID={0}";let e=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName==s.ValueBinding);null!=e&&e.length>0&&!n.e.IsEmpty(e[0].UserProbableValues)&&""!=e[0].UserProbableValues.toString().Trim()&&(s.FilterCondition+=" AND NodeID IN("+e[0].UserProbableValues+")")}}}else if(86==this.ScreenObject.DocumentType){let e=this.ScreenObject._TextFields.find(e=>"dcAlpha2"==e.DBColumnName.toString());e instanceof d.b&&(e.CustomFormat="HH:mm",e.Date=new Date),e=this.ScreenObject._TextFields.find(e=>"dcAlpha3"==e.DBColumnName.toString()),e instanceof d.b&&(e.CustomFormat="HH:mm",e.Date=new Date);let t=this.ScreenObject._TextFields.find(e=>"dcAlpha3"==e.DBColumnName.toString());t&&this.onDateChanged(t)}else if(85==this.ScreenObject.DocumentType){let e=this.ScreenObject._TextFields.find(e=>"dcAlpha1"==e.DBColumnName.toString());e&&(e.CustomFormat="MMM/yyyy",e.Date=new Date((new Date).getFullYear(),(new Date).getMonth(),1)),e=this.ScreenObject._TextFields.find(e=>"dcAlpha2"==e.DBColumnName.toString()),e&&(e.CustomFormat="MMM/yyyy",e.Date=new Date((new Date).getFullYear(),(new Date).getMonth(),1)),e=this.ScreenObject._TextFields.find(e=>"dcAlpha4"==e.DBColumnName.toString()),e&&(e.CustomFormat="MMM/yyyy",e.Date=new Date((new Date).getFullYear(),(new Date).getMonth(),1));let t=this.GetButton("Employee Filter");t&&(t.Visible=!0)}else if(58==this.ScreenObject.DocumentType){let e=this.ScreenObject._TextFields.find(e=>"dcAlpha10"==e.DBColumnName.toString());e&&(e.CustomFormat="MMM/yyyy",e.Date=new Date((new Date).getFullYear(),(new Date).getMonth(),1))}else if(79==this.ScreenObject.DocumentType){let e=this.ScreenObject._TextFields.find(e=>"dcAlpha1"==e.DBColumnName.toString());e&&(e.Date=new Date((new Date).getFullYear(),(new Date).getMonth(),1))}else if(70==this.ScreenObject.DocumentType){if(a.a.SessionManager.Preferences.ContainsKey("EmpChecklistDimension")&&("0"==a.a.SessionManager.Preferences.EmpChecklistDimension.toString()||""==a.a.SessionManager.Preferences.EmpChecklistDimension.toString()))return void(this.DisplayMessage="Please set the Checklist Preference");this.ScreenObject.ColumnSource.forEach(e=>{null!=e.DisplayMember&&""!=e.DisplayMember&&e.DisplayMember.toLowerCase().Contains("dcalpha")&&"DATE"==e.DataType&&(e.DefaultValue="today")});let e=[];if(this.dsData=this.ScreenObject.GetPayrollComponents(1,0,0,this.ScreenObject.DocDate.Date),this.dsData.Tables.length>0){let t=this.ScreenObject.ColumnSource.find(e=>"dcAlpha3"==e.ValueBinding);if(t&&this.dsData.Tables[0].length>0){for(let t=0;t<=this.dsData.Tables[0].length-1;t++)e.push(D.d.ComboBoxItems_2(this.dsData.Tables[0][t].NAME.toString(),this.dsData.Tables[0][t].NODEID.toString()));t.DisplayMember="NAME",t.ValueMember="NODEID",t.ComboData=this.dsData.Tables[0]}let s=this.ScreenObject.ColumnSource.find(e=>"dcAlpha1"==e.ValueBinding);s&&(s.DisplayMember="NAME",s.ValueMember="NODEID",s.ComboData=this.dsData.Tables[1],s.FilterColumn="dcAlpha3",s.FilterCondition="PARENTID={0}")}}else if(71==this.ScreenObject.DocumentType){let e=this.ScreenObject._TextFields.find(e=>"dcAlpha1"==e.DBColumnName.toString());e&&e instanceof d.c&&e.SelectedDateChanged.Subscribe(this,"FillPostPastSalEarningDeductionDtls"),this.FillEarnDeductDetails(0,parseInt(new Date(this.ScreenObject.DocDate.Date).ToString("yyyy")))}else if(73==this.ScreenObject.DocumentType)this.ScreenObject._CCFields.forEach(e=>{e instanceof m.b&&"dcccnid51"==e.DBColumnName.toLowerCase()&&e.OnPactListBoxValueChanged.Subscribe(this.ScreenObject,"OnGetReference"),e instanceof m.b&&"dcccnid52"==e.DBColumnName.toLowerCase()&&e.OnPactListBoxValueChanged.Subscribe(this.ScreenObject,"OnGetReference")});else if(94==this.ScreenObject.DocumentType)this.ScreenObject._CCFields.forEach(e=>{e instanceof m.b&&"dcccnid51"==e.DBColumnName.toLowerCase()&&e.OnPactListBoxValueChanged.Subscribe(this.ScreenObject,"OnGetReference"),e instanceof m.b&&"dcccnid52"==e.DBColumnName.toLowerCase()&&e.OnPactListBoxValueChanged.Subscribe(this.ScreenObject,"OnGetReference")});else if(75==this.ScreenObject.DocumentType)this.FillGratuitySettingsExpDetails();else if(76==this.ScreenObject.DocumentType)this.FillForm12BALookupDetails();else if(77==this.ScreenObject.DocumentType)this.FillPayrollLockUnlockDetails(!1);else if(81==this.ScreenObject.DocumentType||this.IsNewAssignLeave)this.ScreenObject._TextFields.forEach(e=>{e instanceof D.e&&"dcalpha1"==e.DBColumnName.toLowerCase()&&e.SelectionChangedCommand.Subscribe(this,"LeavesBasedon")});else if(59==this.ScreenObject.DocumentType)a.a.SessionManager.Preferences.ContainsKey("CompensatoryLeaveType")&&""==a.a.SessionManager.Preferences.CompensatoryLeaveType.toString()&&(this.DisplayMessage="Please set the compensatory leave type preference");else if(80==this.ScreenObject.DocumentType){let e=[];if(this.dsData=this.ScreenObject.GetPayrollComponents(7,1,0,this.ScreenObject.DocDate.Date),this.dsData.Tables.length>0){let t=this.ScreenObject.ColumnSource.find(e=>"dcAlpha1"==e.ValueBinding);if(t&&this.dsData.Tables[0].length>0){for(let t=0;t<=this.dsData.Tables[0].length-1;t++)e.push(D.d.ComboBoxItems_2(this.dsData.Tables[0][t].NAME.toString(),this.dsData.Tables[0][t].NODEID.toString()));t.DisplayMember="Name",t.ValueMember="Value",t.ComboData=e}let s=this.ScreenObject.ColumnSource.find(e=>"dcAlpha2"==e.ValueBinding);s&&(s.DisplayMember="NAME",s.ValueMember="NODEID",s.ComboData=this.dsData.Tables[1],s.FilterColumn="dcAlpha1",s.FilterCondition="PARENTID={0}")}}if(this.DialogResult&&(51==this.ScreenObject.DocumentType||52==this.ScreenObject.DocumentType||53==this.ScreenObject.DocumentType||55==this.ScreenObject.DocumentType||56==this.ScreenObject.DocumentType||57==this.ScreenObject.DocumentType||58==this.ScreenObject.DocumentType||59==this.ScreenObject.DocumentType||60==this.ScreenObject.DocumentType||61==this.ScreenObject.DocumentType||62==this.ScreenObject.DocumentType||63==this.ScreenObject.DocumentType||65==this.ScreenObject.DocumentType||66==this.ScreenObject.DocumentType||67==this.ScreenObject.DocumentType||68==this.ScreenObject.DocumentType||69==this.ScreenObject.DocumentType||70==this.ScreenObject.DocumentType||71==this.ScreenObject.DocumentType||72==this.ScreenObject.DocumentType||73==this.ScreenObject.DocumentType||74==this.ScreenObject.DocumentType||75==this.ScreenObject.DocumentType||76==this.ScreenObject.DocumentType||77==this.ScreenObject.DocumentType||78==this.ScreenObject.DocumentType||80==this.ScreenObject.DocumentType||85==this.ScreenObject.DocumentType||86==this.ScreenObject.DocumentType||97==this.ScreenObject.DocumentType||79==this.ScreenObject.DocumentType||91==this.ScreenObject.DocumentType||92==this.ScreenObject.DocumentType)){let e="";if(67==this.ScreenObject.DocumentType){let t=!0;this.srcDocument&&"PostAttTimeSheet"==this.srcDocument.toString()&&(t=!1),t?this.strEmpFilter=e=this.PopupEmployeesFilter("","SetNewDocFields"):n.e.IsEmpty(e)&&(e=this.FilterEmployees());let s,i=a.a.common.GetDataSet("PAY038",this.ScreenObject.CostCenterID.toString()).Tables[0];if(a.a.SessionManager.Preferences.ContainsKey("UseDailyAttRates"))for(let e=0;e<this.ScreenObject.ColumnSource.length;e++)s=i.filter(t=>t.SysColumnName==this.ScreenObject.ColumnSource[e].DisplayMember),s&&s.length>0&&(this.ScreenObject.ColumnSource[e].IsVisible="True"==a.a.SessionManager.Preferences.UseDailyAttRates.toString());let r=null,o=a.a.common.GetDataSet3("PAY039",this.ScreenObject.CostCenterID.toString(),a.a.SessionManager.RoleID);if(null!=o&&o.Tables[0].length>0&&(r=a.a.common.GetDataSet3("PAY040",this.ScreenObject.CostCenterID.toString(),a.a.SessionManager.RoleID)),null!=r&&r.Tables.length>0){for(let e=0;e<r.Tables[0].length;e++)for(let t=0;t<this.ScreenObject.ColumnSource.length;t++)this.ScreenObject.ColumnSource[t].DisplayMember.toString()==r.Tables[0][e].SysColumnName&&(this.ScreenObject.ColumnSource[t].ReadOnly="1"==r.Tables[0][e].ReadOnly.toString(),this.ScreenObject.ColumnSource[t].Width=parseInt(r.Tables[0][e].Width),this.ScreenObject.ColumnSource[t].Mandatory="1"==r.Tables[0][e].Mandatory.toString(),s=i.filter(e=>e.SysColumnName==this.ScreenObject.ColumnSource[t].DisplayMember),this.ScreenObject.ColumnSource[t].IsVisible=s&&s.length>0?"True"==a.a.SessionManager.Preferences.UseDailyAttRates.toString()&&"1"==r.Tables[0][e].Visible.toString():"1"==r.Tables[0][e].Visible.toString(),this.ScreenObject.ColumnSource[t].DisplayIndex=parseInt(r.Tables[0][e].IndexValue));this.ScreenObject.ColumnSource.sort((e,t)=>e.DisplayIndex-t.DisplayIndex),this.ScreenObject.GridDataObj.RefreshColumns()}}else e=this.FilterEmployees();if(this.SetNewDocFieldsTemp(e),58==this.ScreenObject.DocumentType||60==this.ScreenObject.DocumentType||61==this.ScreenObject.DocumentType||62==this.ScreenObject.DocumentType||73==this.ScreenObject.DocumentType){e="",e=this.FilterLeaveTypes(61==this.ScreenObject.DocumentType?1:0);let t=this.ScreenObject._CCFields.find(e=>"dcccnid52"==e.DBColumnName.toLowerCase());if(t&&t instanceof m.b)t.CustomWhere=e;else if(t=this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase()),t&&t instanceof m.b&&50052==t.CCID)t.CustomWhere=e;else{let t=this.ScreenObject.ColumnSource.find(e=>50052==e.CostCenterID);t&&t instanceof y.a&&(t.FilterCondition=e)}}if(56==this.ScreenObject.DocumentType){let e=a.a.common.GetDataSet("PAY041",a.a.SessionManager.UserID);e&&e.Tables[0].length>0&&(this.strEmpIsMgr=e.Tables[0][0].IsManager.toString(),this.EmployeewiseDocumentView(40056,this.strEmpIsMgr,"False"))}if(92==this.ScreenObject.DocumentType){let e=this.ScreenObject.CustomTab.Pages[0].Fields.find(e=>e instanceof d.c&&"dcAlpha1"==e.DBColumnName),t=this.ScreenObject.CustomTab.Pages[0].Fields.find(e=>e instanceof d.c&&"dcAlpha2"==e.DBColumnName);e.Enable=t.Enable=!(this.ScreenObject.DocID>0);let s=this.GetButton("Fill Dates");s&&(s.Visible=0==this.DocID)}if(97==this.ScreenObject.DocumentType){let e=this.ScreenObject._TextFields.find(e=>"dcAlpha16"==e.DBColumnName.toString());e&&(e.CustomFormat="01/MMM/yyyy",e.Date=a.a.SessionManager.PayrollMonth),e=this.ScreenObject._TextFields.find(e=>"dcAlpha33"==e.DBColumnName.toString()),null!=e&&(e.CustomFormat="01/MMM/yyyy",e.Date=a.a.SessionManager.PayrollMonth),this.ScreenObject.GridDataObj.Clear(),this.dtPayMon=a.a.SessionManager.PayrollMonth}99==this.DocumentType&&this.ScreenObject.GridDataObj.Clear()}}SetNewDocFieldsTemp(e){let t=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());if(t&&t instanceof m.b)t.CustomWhere=e;else if(t&&t instanceof C.a)t.Name.CustomWhere=t.Code.CustomWhere=e;else if(t=this.ScreenObject._TextFields.find(e=>"dcalpha5"==e.DBColumnName.toLowerCase()),t&&t instanceof m.b&&50051==t.CCID)t.CustomWhere=e;else if(t&&t instanceof C.a&&50051==t.CCID)t.Name.CustomWhere=t.Code.CustomWhere=e;else{let t=this.ScreenObject.ColumnSource.find(e=>50051==e.CostCenterID&&"dcCCNID51"==e.DisplayMember);t&&t instanceof y.a&&(t.FilterCondition=e),this.ScreenObject.GridDataColumns.Contains("dcCCNID51Code")&&(t=this.ScreenObject.ColumnSource.find(e=>"dcccnid51code"==e.DisplayMember.toLowerCase()),t&&t instanceof y.a&&(t.FilterCondition=e))}this.ScreenObject.GridDataObj.RefreshColumns()}EmployeewiseDocumentView(e,t,s){if(40056==e&&"No"==t){let e=this.GetButton("Distribute");e&&(e.Visible=!1);let t=this.GetButton("Generate");t&&(t.Visible=!1),this.ReadOnlyBody=!0;let i=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase());i&&("False"==s&&n.e.IsEmpty(i.Text)||"True"==s&&n.e.IsEmpty(i.Text))?(this.BodyVisible=!1,this.ButtonSave.Visible=!0,this.ScreenObject._TextFields.forEach(e=>{e instanceof u.d&&"dcalpha1"==e.DBColumnName.toLowerCase()?(e.IsReadOnly=!1,e.Text="0"):e instanceof u.d&&"dcalpha2"==e.DBColumnName.toLowerCase()||e instanceof u.d&&"dcalpha3"==e.DBColumnName.toLowerCase()||e instanceof u.d&&"dcalpha4"==e.DBColumnName.toLowerCase()?(e.IsReadOnly=!0,e.Text="0"):e instanceof d.c&&"dcalpha5"==e.DBColumnName.toLowerCase()&&(e.Visible=!1)}),i=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase()),(i&&i instanceof m.b||i&&i instanceof C.a)&&(i.IsReadOnly=!1),i=this.ScreenObject._CCFields.find(e=>"dcccnid52"==e.DBColumnName.toLowerCase()),i&&i instanceof m.b&&(i.IsReadOnly=!1)):(i=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase()),i&&i instanceof u.d&&parseFloat(i.Text)>0&&(this.BodyVisible=!0,i.IsReadOnly=!0,this.ScreenObject._TextFields.forEach(e=>{e instanceof u.d&&"dcalpha1"==e.DBColumnName.toLowerCase()||e instanceof u.d&&"dcalpha3"==e.DBColumnName.toLowerCase()||e instanceof u.d&&"dcalpha4"==e.DBColumnName.toLowerCase()?e.IsReadOnly=!0:e instanceof d.c&&"dcalpha5"==e.DBColumnName.toLowerCase()&&(e.Visible=!0,e.IsReadOnly=!0)}),i=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase()),(i&&i instanceof m.b||i&&i instanceof C.a)&&(i.IsReadOnly=!0),i=this.ScreenObject._CCFields.find(e=>"dcccnid52"==e.DBColumnName.toLowerCase()),i&&i instanceof m.b&&(i.IsReadOnly=!0)))}}FillPayrollLockUnlockDetails(e){try{let t=a.a.common.GetDataSet("PAY034","");if(t&&t.Tables.length>0&&t.Tables[0].length>0){let s,i=null;e||this.ScreenObject.GridDataObj.Clear();let a=this.ScreenObject.Data.Tables[0].filter(e=>"ProductID"==e.SysColumnName),r=0;for(let e=0;e<t.Tables[0].length;e++)s=this.ScreenObject.GridData.filter(s=>s.dcAlpha1_Key==new Date(t.Tables[0][e].PayrollMonth)),s&&s.length>0||(i=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridData.InsertAt(i,r),r++,a.length>0&&!n.e.IsEmpty(a[0].UserDefaultValue)&&(i.ProductID_Key=a[0].UserDefaultValue),i.dcAlpha1_Key=new Date(t.Tables[0][e].PayrollMonth),i.dcAlpha1=new Date(t.Tables[0][e].PayrollMonth).ToString("dd/MMM/yyyy"),i.dcAlpha2_Key=new Date(t.Tables[0][e].PayrollMonthStart),i.dcAlpha2=new Date(t.Tables[0][e].PayrollMonthStart).ToString("dd/MMM/yyyy"),i.dcAlpha3_Key=new Date(t.Tables[0][e].PayrollMonthEnd),i.dcAlpha3=new Date(t.Tables[0][e].PayrollMonthEnd).ToString("dd/MMM/yyyy"));this.ScreenObject.GridData.SortBy([{name:"dcAlpha1_Key",desc:!0}]),this.ScreenObject.GridDataObj.refreshDataView(),this.ScreenObject.UpdateSequence()}this.ScreenObject.GridDataObj.CanUserAddRows=!1,this.ScreenObject.GridDataObj.CanUserDeleteRows=!1,Logger.InfoLog("AddEditDocumentViewModel::Exiting FillPayrollLockUnlockDetails()")}catch(t){Logger.ErrorLog("AddEditDocumentViewModel::EXCEPTION FillPayrollLockUnlockDetails()"+t.stack)}}SetSaveVisibility(){this.IsPOs&&(this.ButtonSave.Visible=!1,this.ButtonSaveandBarcode.Visible=!1,this.ButtonSaveandPrint.Visible=!1,this.ButtonRevise.Visible=!1,this.ButtonsLeft.Contains(this.ButtonSaveandPrint)&&this.ButtonsLeft.Remove(this.ButtonSaveandPrint))}OnShortcutClick(e){try{for(let t=0;t<this.Shortcuts.length;t++)this.Shortcuts[t]instanceof b.c&&this.Shortcuts[t].DBColumnID.toString()==e.toString()?this.ScreenObject.GetExternalFuncData(this.Shortcuts[t].Mode,this.Shortcuts[t].ToolTipFooterTitle,this.Shortcuts[t].ToolTipFooterDescription,this.Shortcuts[t].ToolTipDescription,null):this.Shortcuts[t]instanceof y.a&&this.Shortcuts[t].ID==e.toString()&&null!=this.SelectedRow&&this.ScreenObject.GetExternalFuncData(this.Shortcuts[t].Mode,this.Shortcuts[t].SPName,this.Shortcuts[t].IPParams,this.Shortcuts[t].OPParams,this.SelectedRow)}catch(t){this.DisplayMessage="Problem processing request try again",Logger.ErrorLog("AddEditDocumentViewModel","OnShortcutClick",t)}}OnDocLinkClick(e){let t=this.DocsList.find(t=>t.DBColumnID==parseInt(e));if(t)if(1==t.Dependancy){let e=new es(t.DBColumnID,t.Label,!1,this);a.a.page.addNewTab({component:B.AddEditDocumentComponent,params:{obj:e}})}else{let e=a.a.page.indexOf(this),s=this.DocsList;{let i=new es(t.DBColumnID,t.Label,!1,this);i.DocsList.Clear();for(let e=0;e<s.length;e++)s[e].DBColumnID==i.CostCenterID&&(s[e].DBColumnID=this.CostCenterID,s[e].Label=this.DisplayName),i.DocsList.push(s[e]);i.onButtonClick("Documents"),a.a.page.addNewTab({component:B.AddEditDocumentComponent,params:{obj:i},position:e})}a.a.page.removeTab(this)}}OnReportsLinkClick(e){return Object(i.b)(this,void 0,void 0,(function*(){let t=this.ScreenObject.Data.Tables[21].filter(e=>"ProductID"==e.SysColumnName);t.length>0&&t.forEach(e=>{e.SysColumnName="ProductID_Key"});var i=this.ReportsList.find(t=>t.DBColumnID==parseInt(e));let r={strXML:""};if(i&&2==i.Dependancy||(this.DisplayMessage=this.GetReportFilterXML(e,r)),i&&2==i.Dependancy||0==this.DisplayMessage.length){const{ReportViewModel:t}=yield Promise.all([s.e(2),s.e(1),s.e(3),s.e(5),s.e(4),s.e(6),s.e(7),s.e(10),s.e(9),s.e(8),s.e(12),s.e(11),s.e(13),s.e(19),s.e(15),s.e(21),s.e(20),s.e(16),s.e(14),s.e(18),s.e(17),s.e(22),s.e(23),s.e(24),s.e(25),s.e(28),s.e(30),s.e(29),s.e(32),s.e(31),s.e(27),s.e(26),s.e(35),s.e(37),s.e(38),s.e(36),s.e(33),s.e(34),s.e(39),s.e(40),s.e(41),s.e(212)]).then(s.bind(null,"ThYU")),{ReportViewComponent:o}=yield Promise.all([s.e(32),s.e(37)]).then(s.bind(null,"YU11"));if(i&&1==i.Dependancy){let s=new t;s.ReportViewModel_Document(this.CostCenterID,r.strXML,parseInt(e),!0,null,null,this),n.e.Double(i.GroupName)>0&&(s.RptWidth=parseFloat(i.GroupName)),n.e.Double(i.Length)>0&&(s.RptHeight=parseFloat(i.Length)),a.a.page.ShowDialog(s,o,{HideHeader:!0}).subscribe(()=>{null!=s.SelectedRow&&null!=s.SelectedRow.DataRow&&this.FillReportData(s.ReportID,s.SelectedRow.DataRow,s._ReportData),this.LineNo=this.ScreenObject.SelectedGridRowIndex+1,this.SetFocusongrid=!0})}else if(null!=i&&2==i.Dependancy){let e=!1;"-1"==i.GroupName&&(e=!0);let s=new t;s.ReportViewModel_Query(this.IsInventoryVoucher?3:2,0,this.IsInventoryVoucher?"Products":"Accounts",0,null,!0,e),s.DocumentObject=this,n.e.Double(i.GroupName)>0&&(s.RptWidth=parseFloat(i.GroupName)),n.e.Double(i.Length)>0&&(s.RptHeight=parseFloat(i.Length)),a.a.page.ShowDialog(s,o,{HideHeader:!0}).subscribe(()=>{s.SelectedRow&&this.FillReportData(s.ReportID,s.SelectedRow.DataRow,s._ReportData),this.LineNo=this.ScreenObject.SelectedGridRowIndex+1,this.SetFocusongrid=!0})}else{let s=new t;s.ReportViewModel_Document(this.CostCenterID,r.strXML,parseInt(e),!1,null,null),s.DocumentObject=this,a.a.page.addNewTab({component:o,params:{obj:s}})}}}))}FillReportData(e,t,s){let i=this.ReportsList.find(t=>t.DBColumnID==e);if(i&&!n.e.IsEmpty(i.ToolTipFooterDescription)){let r=new n.f;if(r.ReadXml(i.ToolTipFooterDescription),r.Tables.length>0&&r.Columns[0].Contains("ColID")&&r.Tables[0].length>0){let i=this.ScreenObject.Data.Tables[21].filter(t=>t.ReportID==e),l=!1,c=!1;i.forEach(e=>{Object(o.j)(e.MapType)&&(l=!0)});for(let e=0;e<r.Tables[0].length;e++){let o=this.ScreenObject.ColumnSource.find(t=>t.ID==r.Tables[0][e].ColID.toString());if(o&&null==this.SelectedRow&&this.Setselectedrow(this.GetEmptyRowPosition(this.ScreenObject.GridDataObj,this.GetPrimaryColName())),!n.e.IsEmpty(t[r.Tables[0][e].ReportCol.toString()]))if(l){if(n.e.IsEmpty(t[r.Tables[0][e].ReportCol.toString()+"_ID"]))for(let t=0;t<this.ScreenObject.GridData.length;t++){let a=s;for(let e=0;e<i.length;e++){let s=i[e];if(n.e.IsEmpty(s.ReportFieldName)||n.e.IsEmpty(s.SysColumnName)||!this.ScreenObject.GridDataColumns.Contains(s.SysColumnName)||n.e.IsEmpty(this.ScreenObject.GridData[t][s.SysColumnName])){a=[];break}a=a.filter(e=>e[s.ReportFieldName.toString()]==this.ScreenObject.GridData[t][s.SysColumnName].toString())}a.length>0&&this.ScreenObject.SetValueBYCOLID(r.Tables[0][e].ColID.toString(),a[0][r.Tables[0][e].ReportCol.toString()].toString(),"",this.ScreenObject.GridData[t])}}else n.e.IsEmpty(t[r.Tables[0][e].ReportCol.toString()+"_ID"])?this.ScreenObject.SetValueBYCOLID(r.Tables[0][e].ColID.toString(),t[r.Tables[0][e].ReportCol.toString()].toString(),"",null!=this.SelectedRow?this.SelectedRow:null):this.ScreenObject.SetValueBYCOLID(r.Tables[0][e].ColID.toString(),t[r.Tables[0][e].ReportCol.toString()].toString(),t[r.Tables[0][e].ReportCol.toString()+"_ID"].toString(),null!=this.SelectedRow?this.SelectedRow:null);if(!c&&this.IsPOs&&null!=o&&a.a.SessionManager.Preferences.ContainsKey("POSItemCodeDimension")&&""!=a.a.SessionManager.Preferences.POSItemCodeDimension&&parseInt(a.a.SessionManager.Preferences.POSItemCodeDimension)>5e4&&!n.e.IsEmpty(t[r.Tables[0][e].ReportCol.toString()])&&o.CostCenterID==parseInt(a.a.SessionManager.Preferences.POSItemCodeDimension))c=!0,this.onSKUSearch(t[r.Tables[0][e].ReportCol.toString()].toString());else if(!c&&null!=o&&3==o.CostCenterID&&this.IsInventoryVoucher)c=!0,this.AddProductData(this.SelectedRow,!1,!1);else if(30==this.ScreenObject.DocumentType&&this.ScreenObject.Preferences.ContainsKey("AssembleProduct")&&this.ScreenObject.Preferences.AssembleProduct==r.Tables[0][e].ColID.toString()){let t=this.ScreenObject._TextFields.find(t=>t.DBColumnID==parseInt(r.Tables[0][e].ColID));t&&this.OnKitProductChange(t)}if(o&&o.CostCenterID>0)for(let e=0;e<this.ScreenObject.ColumnSource.length;e++)"LINK"==this.ScreenObject.ColumnSource[e].DataType&&!this.ScreenObject.ColumnSource[e].Dependantinuse&&this.ScreenObject.ColumnSource[e].Mandatory&&!n.e.IsEmpty(this.ScreenObject.ColumnSource[e].FilterCondition)&&this.ScreenObject.ColumnSource[e].FilterCondition.split(",").Contains(o.CostCenterID.toString())&&null!=this.SelectedRow&&this.RowAttachments(this.ScreenObject.ColumnSource[e].DisplayMember,!0,this.SelectedRow)}}}}GetReportFilterXML(e,t){let s="";t.strXML="";let i=this.ScreenObject.Data.Tables[21];i=i.filter(t=>t.ReportID==e);let a="",r="",l="",c=!1,h=!1,D=!1;i.forEach(e=>{Object(o.j)(e.GroupLevel)&&(c=!0),null!=e.MapType&&Object(o.j)(e.MapType)&&(h=!0)}),s+="<XML",c&&(s+=' GroupLevel="1"'),s+=" >";let S,b,y=this.ScreenObject.SelectedGridRowIndex,g="",O=this.ScreenObject.GridData,I=this.ScreenObject.GridDataColumns;this.ReportDimension.SelectedValue>0?2==this.ReportDimension.CCID?I.Contains("CreditAccount_Key")?O=this.ScreenObject.GridData.filter(e=>e.CreditAccount_Key==this.ReportDimension.SelectedValue):I.Contains("DebitAccount_Key")?O=this.ScreenObject.GridData.filter(e=>e.DebitAccount_Key==this.ReportDimension.SelectedValue):I.Contains("AccountID_Key")&&(O=this.ScreenObject.GridData.filter(e=>e.AccountID_Key==this.ReportDimension.SelectedValue)):3==this.ReportDimension.CCID&&(O=this.ScreenObject.GridData.filter(e=>e.ProductID_Key==this.ReportDimension.SelectedValue)):!h&&this.SelectedRow&&(O=this.ScreenObject.GridData.filter(e=>e.DocSeqNo==this.SelectedRow.DocSeqNo));for(let f=0;f<i.length;f++){if(b=i[f].ReportField.toString(),s+="<Row ",s+='ColID ="'+b+'" ',D=!1,g=i[f].SysColumnName,S=parseInt(i[f].DocumentField),h=Object(o.j)(i[f].MapType),I.Contains(g)||I.Contains(g+"_Key")){if(h){a="",r="";for(let e=0;e<O.length;e++)I.Contains(g+"_Key")?n.e.IsEmpty(O[e][g+"_Key"])||"0"==O[e][g+"_Key"].toString()||("23148"==b&&O[e][g].toString().length>0&&(r=r+"'"+O[e][g].toString()+"',",I.Contains("LinkedInvDocDetailsID")&&!n.e.IsEmpty(O[e].LinkedInvDocDetailsID)&&"0"!=O[e].LinkedInvDocDetailsID.toString()&&(l=l+O[e].LinkedInvDocDetailsID.toString()+",")),a=a+"'"+O[e][g+"_Key"].toString()+"',"):n.e.IsEmpty(O[e][g])||(a=a+"'"+O[e][g].toString()+"',");if(""==a)return alert(this.ErrorMessage+i[f].DocumentFieldName.toString()+" '"),this.LineNo=y+1,this.SetFocusongrid=!0,"Empty Value";"23148"==b&&r.length>0&&(s+='ValueText="'+r.TrimEnd(",").TrimEnd("'").TrimStart("'")+'" ',s+='LinkedInvDocDetailsIDs="'+l.TrimEnd(",")+'" '),s+='Value ="'+a.TrimEnd(",")+'" '}else if(0==O.length)this.ReportDimension.CCID==parseInt(b)&&(s+='Value ="'+this.ReportDimension.SelectedValue+'" ');else if(I.Contains(g+"_Key")){if(0==n.e.Int(O[0][g+"_Key"]))return alert(this.ErrorMessage+i[f].DocumentFieldName.toString()+" '"),this.LineNo=y+1,this.SetFocusongrid=!0,"Empty Value";if("23148"==b&&O[0][g].toString().length>0){s+='ValueText="'+O[0][g]+'" ';for(let e=0;e<O.length;e++)I.Contains("ProductID_Key")&&I.Contains("LinkedInvDocDetailsID")&&(n.e.IsEmpty(O[e].ProductID_Key)||"0"==O[e].ProductID_Key.toString()||n.e.IsEmpty(O[e].LinkedInvDocDetailsID)||"0"==O[e].LinkedInvDocDetailsID.toString()||(l=l+O[e].LinkedInvDocDetailsID.toString()+","));s+='LinkedInvDocDetailsIDs="'+l.TrimEnd(",")+'" '}s+='Value="'+O[0][g+"_Key"].toString()+'" '}else{if(n.e.IsEmpty(O[0][g]))return alert(this.ErrorMessage+i[f].DocumentFieldName.toString()+" '"),this.LineNo=y+1,this.SetFocusongrid=!0,"Empty Value";if("ProductID_Key"==g&&"3"!=b){let e=this.ScreenObject.Data.Tables[0].filter(e=>e.CostCenterColID==S);if(e.length>0){let t=e[0]=n.e.String(["parentccdefaultcolid"]);if("261"==t){s+='Value ="'+O[0].ProductCode.toString()+'" />';continue}if("262"==t){s+='Value ="'+O[0].ProductName.toString()+'" />';continue}}}s+='Value ="'+O[0][g].toString()+'" '}D=!0}if(!D){for(let e=0;e<this.ScreenObject.HeaderFields.length;e++)if(this.ScreenObject.HeaderFields[e].DBColumnID==S)if(this.ScreenObject.HeaderFields[e]instanceof u.d){if(""==this.ScreenObject.HeaderFields[e].Text)return alert(this.ErrorMessage+this.ScreenObject.HeaderFields[e].Label+" '"),this.LineNo=y+1,this.SetFocusongrid=!0,"Empty Value";s+='Value ="'+this.ScreenObject.HeaderFields[e].Text+'" '}else if(this.ScreenObject.HeaderFields[e]instanceof p.a){let t=this.ScreenObject.HeaderFields[e];if("VoucherNo"==t.DBColumnName)s+='Value ="'+this.ScreenObject.VoucherNo+'" ';else{if(""==t.TextBox.Text||""==t.ComboBox.SelectedValue)return alert(this.ErrorMessage+this.ScreenObject.HeaderFields[e].Label+" '"),this.LineNo=y+1,this.SetFocusongrid=!0,"Empty Value";s+='Value ="'+t.ComboBox.SelectedValue+'" '}}else if(this.ScreenObject.HeaderFields[e]instanceof u.c){if(""==this.ScreenObject.HeaderFields[e].Text)return alert(this.ErrorMessage+this.ScreenObject.HeaderFields[e].Label+" '"),this.LineNo=y+1,this.SetFocusongrid=!0,"Empty Value";s+='Value ="'+this.ScreenObject.HeaderFields[e].Text+'" '}else if(this.ScreenObject.HeaderFields[e]instanceof d.a||this.ScreenObject.HeaderFields[e]instanceof d.d||this.ScreenObject.HeaderFields[e]instanceof d.c){if(this.ScreenObject.HeaderFields[e]instanceof d.a)s+='Value ="'+this.ScreenObject.HeaderFields[e].Date.ToString("dd/MMM/yyyy")+'" ';else if(this.ScreenObject.HeaderFields[e]instanceof d.d)s+='Value ="'+this.DocumentDate.ToString("dd/MMM/yyyy")+'" ';else if(this.ScreenObject.HeaderFields[e]instanceof d.c){if(!this.ScreenObject.HeaderFields[e].Date)return alert(this.ErrorMessage+this.ScreenObject.HeaderFields[e].Label+" '"),this.LineNo=y+1,this.SetFocusongrid=!0,"Empty Value";s+='Value ="'+this.ScreenObject.HeaderFields[e].Date.ToString("dd/MMM/yyyy")+'" '}}else if(this.ScreenObject.HeaderFields[e]instanceof m.b){if(null!=this.ScreenObject._CCFields.find(t=>t.DBColumnName.toLowerCase()==this.ScreenObject.HeaderFields[e].DBColumnName.toLowerCase()))continue;if(""==this.ScreenObject.HeaderFields[e].Text)return alert(this.ErrorMessage+this.ScreenObject.HeaderFields[e].Label+" '"),this.LineNo=y+1,this.SetFocusongrid=!0,"Empty Value";s+='Value ="'+this.ScreenObject.HeaderFields[e].SelectedValue+'" '}else if(this.ScreenObject.HeaderFields[e]instanceof C.a){if(null!=this.ScreenObject._CCFields.find(t=>t.DBColumnName.toLowerCase()==this.ScreenObject.HeaderFields[e].DBColumnName.toLowerCase()))continue;if(""==this.ScreenObject.HeaderFields[e].Text)return alert(this.ErrorMessage+this.ScreenObject.HeaderFields[e].Label+" '"),this.LineNo=y+1,this.SetFocusongrid=!0,"Empty Value";s+='Value ="'+this.ScreenObject.HeaderFields[e].SelectedValue+'" '}for(let e=0;e<this.ScreenObject._CCFields.length;e++)if(this.ScreenObject._CCFields[e].DBColumnID==Math.abs(S)){if(this.ScreenObject._CCFields[e]instanceof m.b){if(S<0&&!this.ScreenObject._CCFields[e].DBColumnName.startsWith("TO"))continue;if(""==this.ScreenObject._CCFields[e].Text)return alert(this.ErrorMessage+this.ScreenObject._CCFields[e].Label+" '"),this.LineNo=y+1,this.SetFocusongrid=!0,"Empty Value";s+='Value ="'+this.ScreenObject._CCFields[e].SelectedValue+'" ';break}if(this.ScreenObject._CCFields[e]instanceof C.a){if(S<0&&!this.ScreenObject._CCFields[e].DBColumnName.startsWith("TO"))continue;if(""==this.ScreenObject._CCFields[e].Text)return alert(this.ErrorMessage+this.ScreenObject._CCFields[e].Label+" '"),this.LineNo=y+1,this.SetFocusongrid=!0,"Empty Value";s+='Value ="'+this.ScreenObject._CCFields[e].SelectedValue+'" ';break}}for(let e=0;e<this.ScreenObject._TextFields.length;e++)if(this.ScreenObject._TextFields[e].DBColumnID==parseInt(i[f].DocumentField))if(this.ScreenObject._TextFields[e]instanceof u.d){if(""==this.ScreenObject._TextFields[e].Text)return alert(this.ErrorMessage+this.ScreenObject._TextFields[e].Label),this.LineNo=y+1,this.SetFocusongrid=!0,"Empty Value";s+='Value ="'+this.ScreenObject._TextFields[e].Text+'" '}else if(this.ScreenObject._TextFields[e]instanceof p.a){if(""==this.ScreenObject._TextFields[e].TextBox.Text||""==this.ScreenObject._TextFields[e].ComboBox.SelectedValue)return alert(this.ErrorMessage+this.ScreenObject._TextFields[e].Label),this.LineNo=y+1,this.SetFocusongrid=!0,"Empty Value";s+='Value ="'+this.ScreenObject._TextFields[e].TextBox.Text+'" '}else if(this.ScreenObject._TextFields[e]instanceof u.c){if(""==this.ScreenObject._TextFields[e].Text)return alert(this.ErrorMessage+this.ScreenObject._TextFields[e].Label),this.LineNo=y+1,this.SetFocusongrid=!0,"Empty Value";s+='Value ="'+this.ScreenObject._TextFields[e].Text+'" '}else if(this.ScreenObject._TextFields[e]instanceof d.a||this.ScreenObject._TextFields[e]instanceof d.d){if(!this.ScreenObject._TextFields[e].Date)return alert(this.ErrorMessage+this.ScreenObject._TextFields[e].Label),this.LineNo=y+1,this.SetFocusongrid=!0,"Empty Value";s+='Value ="'+this.ScreenObject._TextFields[e].Date.ToString("dd/MMM/yyyy")+'" '}else if(this.ScreenObject._TextFields[e]instanceof m.b){if(""==this.ScreenObject._TextFields[e].Text)return alert(this.ErrorMessage+this.ScreenObject._TextFields[e].Label),this.LineNo=y+1,this.SetFocusongrid=!0,"Empty Value";s+='Value ="'+this.ScreenObject._TextFields[e].SelectedValue+'" '}else if(this.ScreenObject._TextFields[e]instanceof C.a){if(""==this.ScreenObject._TextFields[e].Text)return alert(this.ErrorMessage+this.ScreenObject._TextFields[e].Label),this.LineNo=y+1,this.SetFocusongrid=!0,"Empty Value";s+='Value ="'+this.ScreenObject._TextFields[e].SelectedValue+'" '}}s+=" />"}return s+="</XML>",t.strXML=s,""}BeforeRowDeletingEvent(e){if(this.SelectedRow)if(this.SelectedRows&&this.SelectedRows.length>1){let t=new Array,s=!0;for(let e=0;e<this.SelectedRows.length;e++){let i=this.SelectedRows[e];if(i){if(s=this.CanDeleteRow(i),!s)break;t.push(i)}}if(s){if(confirm("Are you sure you want to delete "+this.SelectedRows.length.toString()+" Rows?")){this.IsSelectAll=!0;for(let e=0;e<t.length;e++)this.OnBeforeRowDeleting(t[e],!1);this.IsSelectAll=!1,this.ScreenObject.UpdateSequence(),this.CalculateTotals(null,!1),this.CheckVendorWiseLinkingPref(),e.CanExecute=!1}}else e.CanExecute=!1}else this.CanDeleteRow(this.SelectedRow)?(this.IsSelectAll=!1,e.CanExecute=this.OnBeforeRowDeleting(this.SelectedRow,!0)):e.CanExecute=!1}CanInsertDeleteRow(){if((38==this.DocumentType||39==this.DocumentType)&&a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Do Not Allow Row Insert and Delete")){let e=new Nt.LoginViewModel(a.a.router);e.IsPosMangr=!0,e.ShowRememberMe=!1,e.ShowDefaultCompany=!1,e.LoginText=a.a.GetResource("Com_OK"),e.FeatureID=this.CostCenterID,e.FeatureName="Do Not Allow Row Insert and Delete",e.Mode=Object(o.j)(this.IsEdit)?2:1,e.Title="Authentication",a.a.page.ShowDialog(e,Gt.LoginScreenComponent).subscribe(()=>e.IsLoggedIn)}return!0}CanDeleteRow(e){if(null!=e&&this.ScreenObject.IsInventory){if("Y"==n.e.String(e.IsScheme)&&"2"==n.e.String(e.SchemeID))return alert("Can't Delete Promotional Products"),!1;if(!n.e.IsEmpty(e.LinkType)&&"2"==e.LinkType.toString())return alert("Can't Delete Mandatory linked Products"),!1;if(!n.e.IsEmpty(e.MaxSchemeID)&&"Y"==e.IsScheme.toString()&&"1"!=e.SchemeID.toString())return alert("Can't Delete Scheme Product"),!1;if(this.ScreenObject.GridDataColumns.Contains("RemQty")&&!n.e.IsEmpty(e.RemQty))return alert("Can't Delete first row"),!1;if(null!=e.LinkedQuantity&&null!=e.LinkedQuantity&&parseFloat(e.LinkedQuantity)>0)return alert("Cannot Delete Linked Product"),!1;if(!n.e.IsEmpty(e.ExecutedQty)&&parseFloat(e.ExecutedQty)>0)return alert("Cannot Delete Executed Product"),!1;if(this.IsInventoryVoucher&&!n.e.IsEmpty(e.LinkedInvDocDetailsID)&&parseInt(e.LinkedInvDocDetailsID)>0&&this.ScreenObject.Preferences.ContainsKey("LockLinkedRows")&&""!=this.ScreenObject.Preferences.LockLinkedRows&&Object(o.j)(this.ScreenObject.Preferences.LockLinkedRows))return alert("Cannot Delete Linked Product"),!1;if(this.ScreenObject.GridDataColumns.Contains("IsKit")&&null!=e&&"2"==n.e.String(e.IsKit)&&(!this.ScreenObject.GridDataColumns.Contains("landingType")||"1"!=n.e.String(e.landingType)&&"2"!=n.e.String(e.landingType)||!(this.ScreenObject.GridData.filter(t=>t.IsKit=t.ProductID_Key==n.e.String(e.ProductID_Key)).length>1)))return alert("Can't Delete Kit sub Products"),!1}return this.ScreenObject.Preferences.ContainsKey("LineWisePDC")&&Object(o.j)(this.ScreenObject.Preferences.LineWisePDC)&&this.ScreenObject.GridDataColumns.Contains("RefStatusID")&&!n.e.IsEmpty(e.RefStatusID)&&370!=parseInt(e.RefStatusID)&&!n.e.IsEmpty(e.DocDetailsID)&&parseInt(e.DocDetailsID)>0?(alert("Cannot Delete Converted PDC"),!1):this.CanInsertDeleteRow()}OnBeforeRowDeleting(e,t){if(t)if(this.res="NO",this.IsAutoPost&&this.IsInventoryVoucher)this.res=confirm("Are you sure you want to delete?")?"Yes":"No";else{let t=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&55489==e.LinkData);this.res=t.length>0&&this.ScreenObject.GridDataColumns.Contains(t[0].SysColumnName)&&!n.e.IsEmpty(e[t[0].SysColumnName])&&!n.e.IsEmpty(e.DocDetailsID)&&parseInt(e.DocDetailsID)>0?confirm("Are you sure you want to delete?\n Barcode will also be removed.")?"Yes":"No":confirm("Are you sure you want to delete?")?"Yes":"No"}else this.res="Yes";if("Yes"==this.res){if(null!=e&&this.ScreenObject.IsInventory&&!n.e.IsEmpty(e.LinkType)&&"0"==e.LinkType.toString()&&!n.e.IsEmpty(e.LinkID))return this.ScreenObject.GridData.filter(t=>t.LinkID==e.LinkID.toString()&&t.DocSeqNo!=e.DocSeqNo).foreach(e=>{this.ScreenObject.GridDataObj.removeRow(e)}),this.ScreenObject.GridDataObj.removeRow(e),!1;if(this.ScreenObject.GridDataColumns.Contains("IsKit")&&null!=e&&"1"==e.IsKit.toString())return this.ScreenObject.GridData.filter(e=>2==e.IsKit).foreach(e=>{this.ScreenObject.GridDataObj.removeRow(e)}),this.ScreenObject.GridDataObj.removeRow(e),!1;if(this.IsInventoryVoucher&&!n.e.IsEmpty(e.MaxSchemeID)&&this.ScreenObject.GridData.filter(t=>t.MaxSchemeID==e.MaxSchemeID&&"Y"==t.IsScheme).length>0)if(this.ScreenObject.GridData.filter(t=>t.MaxSchemeID==e.MaxSchemeID&&"N"==t.IsScheme).length>1){let t=this.ScreenObject.GridData.filter(t=>t.MaxSchemeID==e.MaxSchemeID&&"N"==t.IsScheme);if(t[0]!=e){let e=this.ScreenObject.GetSchemes(this.DocumentDate,t[0]);e.Tables.length>0&&e.Columns[0].Contains("SchemeID")&&this.fillSchemevalues(e.Tables[0],e.Columns[0],t[0]),this.ApplySchemes(t[0])}else{let e=this.ScreenObject.GetSchemes(this.DocumentDate,t[1]);e.Tables.length>0&&e.Columns[0].Contains("SchemeID")&&this.fillSchemevalues(e.Tables[0],e.Columns[0],t[1]),this.ApplySchemes(t[1])}}else this.ScreenObject.GridData.filter(t=>t.MaxSchemeID==e.MaxSchemeID&&"Y"==t.IsScheme).forEach(e=>{this.ScreenObject.GridDataObj.removeRow(e)});return null!=this.AutoPostViewModel&&(this.AutoPostViewModel.ScreenObject.GridData.filter(t=>t.RefSeqNo==e.RefSeqNo).forEach(e=>{this.AutoPostViewModel.ScreenObject.GridDataObj.removeRow(e)}),this.AutoPostViewModel.CalculateTotals(null,!1)),this.CheckPackingWtVol(e),this.ScreenObject.GridDataObj.removeRow(e),!1}return!1}onRoundOff(e){if("DataGridPactListBoxColumn"!=e.column.className){if(this.IsInventoryVoucher&&(null==e.Column||"PactTextBoxEditor"==e.Column.GetType().toString())&&e.column){let t=e.column.field,s=e.item;if("quantity"==t.toLowerCase()&&this.ScreenObject.GridDataColumns.Contains("PackType")&&"true"==s.PackType.toString().toLowerCase())a.a.page.ShowDialog(new le(this,6),ce.a,{ShowCenter:!0}).subscribe(()=>{let e=this.ScreenObject.ColumnSource.find(e=>e.DisplayMember==t);this.RoundOffValue(s,e)});else{let e=this.ScreenObject.ColumnSource.find(e=>e.DisplayMember==t);this.RoundOffValue(s,e)}}}else{let t=e.item;if(3==e.column.DgCol.CostCenterID&&!n.e.IsEmpty(t.ProductID_Key)&&parseInt(t.ProductID_Key)>0){let e=this.ScreenObject.GetSubtituteProducts(parseInt(t.ProductID_Key),this.DocumentDate,t.DocDetailsID.toString(),t);if(e.Tables.length>0&&!e.Columns[0].Contains("ErrorMessage")&&e.Tables[0].length>0){let s=new De.a(this,e.Tables[0],e.Columns[0],e.Tables[1],t.ProductName.toString(),t.ProductCode.toString(),t.ProductID_Key.toString());s.GridData.length>0&&a.a.page.ShowDialog(s,Se.a,{ShowCenter:!0}).subscribe(()=>this.SetFocusongrid=!0)}}}}onFooterRoundOff(e){if(!this.IsInventoryVoucher||"PactTextBoxEditor"!=e.Column.GetType().toString())return;let t=e.item,s=e.column.field;if(("Amount"==s||"CalcAmount"==s)&&!n.e.IsEmpty(t.ColumnName)){let e=this.GetCeilValue();0!=e&&(n.e.IsEmpty(t[s])||0==parseFloat(t[s])||(this.SetFooterRoundoffValue(t,0),this.CalculateTotals(null,!1),e=this.GetCeilValue()),this.SetFooterRoundoffValue(t,e),this.CalculateTotals(null,!1),this.ScreenObject.FooterGridDataObj.updateRow(t))}}SetFooterRoundoffValue(e,t){e.Amount=t,e.CalcAmount=t}GetCeilValue(){let e=0,t=0;a.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(o.j)(a.a.SessionManager.Preferences["Use Foreign Currency"])&&null!=this.Currency&&!n.e.IsEmpty(this.Currency.ExchangeRate.Text)&&this.ScreenObject.Preferences.ContainsKey("NettotaldocumentCurrency")&&""!=this.ScreenObject.Preferences.NettotaldocumentCurrency&&Object(o.j)(this.ScreenObject.Preferences.NettotaldocumentCurrency)&&n.e.IsNum(this.Currency.ExchangeRate.Text)&&(t=parseFloat(this.Currency.ExchangeRate.Text)),e=0!=t?(this.GridNetTotal+this.FooterGridNetTotal)/t:this.GridNetTotal+this.FooterGridNetTotal;let s=e%1;return s=s<.5?-s:1-s,s}RoundOffValue(e,t){if(t&&t.DisplayMember.toLowerCase().Contains("dcnum")){let s=this.GetCeilValue();0!=s&&(n.e.IsEmpty(e[t.DisplayMember])||0==parseFloat(e[t.DisplayMember])||(this.SetRoundoffValue(e,t,0),this.CalculateTotals(null,!1),s=this.GetCeilValue()),this.SetRoundoffValue(e,t,s),this.CalculateTotals(e,!1),this.ScreenObject.GridDataObj.updateRow(e))}}SetRoundoffValue(e,t,s){e[t.DisplayMember]=s.ToString("N"+t.DecimalPoints),e["dcCalc"+t.DisplayMember]=s.ToString("N"+t.DecimalPoints)}onEidtQuantity(e){if(null!=e&&"Quantity"==e.toString()&&this.ScreenObject.SelectedGridRowIndex>0){let e=this.ColumnNo,t=this.ScreenObject.ColumnSource.find(e=>!n.e.IsEmpty(e.DisplayMember)&&"quantity"==e.DisplayMember.toLowerCase());t&&(this.ColumnNo=this.ScreenObject.ColumnSource.indexOf(t)+1),this.LineNo=this.ScreenObject.SelectedGridRowIndex,this.SetFocusongrid=!0,this.ColumnNo=e}else if(null!=e&&"MovetoQty"==e.toString()){let e=this.GetEmptyRowPosition(this.ScreenObject.GridDataObj,"ProductID_Key");if(e<0)return;let t=this.ColumnNo,s=this.ScreenObject.ColumnSource.find(e=>!n.e.IsEmpty(e.DisplayMember)&&"quantity"==e.DisplayMember.toLowerCase());s&&(this.ColumnNo=this.ScreenObject.ColumnSource.indexOf(s)+1),this.LineNo=e,this.SetFocusongrid=!0,this.ColumnNo=t}else if(null!=e&&"MovetoSKU"==e.toString()&&this.SKU.Visible)this.SKU.SetFocus=!0;else if(null!=e&&"Attachments"==e.toString()){if(this.SelectedRow){let e=this.SelectedRow;if(this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!n.e.IsEmpty(e.ProductID_Key)&&parseInt(e.ProductID_Key)>0){let t=this.ScreenObject.GetAttachments(3,parseInt(e.ProductID_Key));null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&t.Columns[0].Contains("FileID")&&a.a.page.ShowDialog(new ye(this,t.Tables[0],""),pe.a,{ShowCenter:!0})}else if(!this.IsInventoryVoucher&&this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&!n.e.IsEmpty(e.AccountID_Key)&&parseInt(e.AccountID_Key)>0){let t="";this.ScreenObject.GridDataColumns.Contains("accountName")&&!n.e.IsEmpty(e.accountName)?t=e.accountName.toString():this.ScreenObject.GridDataColumns.Contains("accountcode")&&!n.e.IsEmpty(e.accountcode)&&(t=e.accountcode.toString());let s=this.ScreenObject.GetAttachments(2,parseInt(e.AccountID_Key));null!=s&&s.Tables.length>0&&s.Tables[0].length>0&&s.Columns[0].Contains("FileID")&&a.a.page.ShowDialog(new ye(this,s.Tables[0],t),pe.a,{ShowCenter:!0})}else if(!this.IsInventoryVoucher&&this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!n.e.IsEmpty(e.CreditAccount_Key)&&parseInt(e.CreditAccount_Key)>0){let t="";this.ScreenObject.GridDataColumns.Contains("accountName")&&!n.e.IsEmpty(e.accountName)?t=e.accountName.toString():this.ScreenObject.GridDataColumns.Contains("accountcode")&&!n.e.IsEmpty(e.accountcode)&&(t=e.accountcode.toString());let s=this.ScreenObject.GetAttachments(2,parseInt(e.CreditAccount_Key));null!=s&&s.Tables.length>0&&s.Tables[0].length>0&&s.Columns[0].Contains("FileID")&&a.a.page.ShowDialog(new ye(this,s.Tables[0],t),pe.a,{ShowCenter:!0})}else if(!this.IsInventoryVoucher&&this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!n.e.IsEmpty(e.DebitAccount_Key)&&parseInt(e.DebitAccount_Key)>0){let t="";this.ScreenObject.GridDataColumns.Contains("accountName")&&!n.e.IsEmpty(e.accountName)?t=e.accountName.toString():this.ScreenObject.GridDataColumns.Contains("accountcode")&&!n.e.IsEmpty(e.accountcode)&&(t=e.accountcode.toString());let s=this.ScreenObject.GetAttachments(2,parseInt(e.DebitAccount_Key));null!=s&&s.Tables.length>0&&s.Tables[0].length>0&&s.Columns[0].Contains("FileID")&&a.a.page.ShowDialog(new ye(this,s.Tables[0],t),pe.a,{ShowCenter:!0})}}}else if(null!=e&&"FreeProds"==e.toString())null!=this.SelectedRow&&this.ScreenObject.Preferences.ContainsKey("EnablePromotions")&&""!=this.ScreenObject.Preferences.EnablePromotions&&Object(o.j)(this.ScreenObject.Preferences.EnablePromotions)&&a.a.page.ShowDialog(new re(this,this.SelectedRow,null,1),Ge.a);else if(null==e||"Distribute"!=e.toString()&&"DistributeQty"!=e.toString()){if(null!=e&&"DistributeGen"==e.toString())a.a.page.ShowDialog(new re(this,this.SelectedRow,null,4),Ge.a,{ShowCenter:!0});else if(null!=e&&"Copy"==e.toString())if(this.IsPOs)this.onCopy(e);else if(5==this.DocumentType&&this.ScreenObject.GridDataColumns.Contains("RecievedQty"))for(let e=0;e<this.ScreenObject.GridData.length;e++)!n.e.IsEmpty(this.ScreenObject.GridData[e].ProductID_Key)&&!n.e.IsEmpty(this.ScreenObject.GridData[e].Quantity)&&parseFloat(this.ScreenObject.GridData[e].Quantity)>0&&(this.ScreenObject.GridData[e].RecievedQty=this.ScreenObject.GridData[e].Quantity)}else a.a.page.ShowDialog(new re(this,this.SelectedRow,null,"Distribute"==e.toString()?2:3),Ge.a)}onShowImage(e){if(e&&e.item){let t=e.item;this.ScreenObject.GridDataColumns.Contains("FileExtension")&&this.ShowProductImage(t)}}onFieldCalc(e){a.a.SessionManager.IsActionAssigned(43,"EnableFieldCalculator")&&this.ScreenObject.Preferences.ContainsKey("FieldCalculator")&&""!=this.ScreenObject.Preferences.FieldCalculator&&Object(o.j)(this.ScreenObject.Preferences.FieldCalculator)&&null!=e&&null!=e.item&&a.a.page.ShowDialog(new le(this,0),ce.a,{ShowCenter:!0,Title:"Field calculator"})}onSearchProduct(e){let t=e.column,s=this.ScreenObject.SelectedGridRowIndex;if(null!=e.column){if("DataGridPactListBoxColumn"==t.className){let s=this.ScreenObject.ColumnSource.find(t=>t.DisplayMember==e.column.field),i=0;s&&(i=s.GridViewID),(3==t.DgCol.CostCenterID||i>0)&&(0==i&&(i=268),a.a.page.ShowDialog(new Ye.ProductSearchCatalogViewModel(this,i,t.DgCol.CostCenterID,s,null),Je.ProductSearchCatalogComponent))}else if("PactTextBoxEditor"==t.className){let r="";if(32==this.DocumentType){var i=this.ScreenObject.Preferences.ContainsKey("VarienceField")?this.ScreenObject.ColumnSource.find(e=>e.ID==this.ScreenObject.Preferences.VarienceField):null;null!=i&&(r=i.DisplayMember)}if("holdquantity"==e.column.field.toLowerCase())this.SelectedRow&&!n.e.IsEmpty(this.SelectedRow.DocDetailsID)&&parseInt(this.SelectedRow.DocDetailsID)>0&&a.a.page.ShowDialog(new se(this),ie.a);else if(("quantity"==e.column.field.toLowerCase()&&!n.e.IsEmpty(this.SelectedRow.Quantity)||"FreeQTY"==e.column.field&&!n.e.IsEmpty(this.SelectedRow.FreeQTY)||31==this.DocumentType&&e.column.field.toLowerCase().startsWith("dcnum")&&!n.e.IsEmpty(this.SelectedRow[e.column.field]))&&null!=this.SelectedRow&&5==n.e.Int(this.SelectedRow.Type)){if(this.ScreenObject.Preferences.ContainsKey("ShowBatches")&&""!=this.ScreenObject.Preferences.ShowBatches&&Object(o.j)(this.ScreenObject.Preferences.ShowBatches)||!this.DonotUpdateInventory||31==this.DocumentType){this.fillbatches(this.SelectedRow,e.column.field);let t=this.ColumnNo;return this.ColumnNo=e.column.DisplayIndex+2,this.LineNo=s+1,this.SetFocusongrid=!0,void(this.ColumnNo=t)}}else if("quantity"!=e.column.field.toLowerCase()||"2"==this.SelectedRow.Type.toString()||"5"==this.SelectedRow.Type.toString()||n.e.IsEmpty(this.SelectedRow.BinWise)||"True"!=this.SelectedRow.BinWise.toString()||n.e.IsEmpty(this.SelectedRow.Quantity)){if((this.DonotUpdateInventory||"quantity"!=e.column.field.toLowerCase()&&"recievedqty"!=e.column.field.toLowerCase()&&"freeqty"!=e.column.field.toLowerCase())&&(31!=this.DocumentType||!e.Column.field.toLowerCase().startsWith("dcnum")||n.e.IsEmpty(this.SelectedRow[e.Column.field]))&&(32!=this.DocumentType||""==r||e.Column.field!=r||n.e.IsEmpty(this.SelectedRow[e.Column.field]))||n.e.IsEmpty(this.SelectedRow.Type)||2!=parseInt(this.SelectedRow.Type)){if("amount"==e.column.field.toLowerCase()||"debitamount"==e.column.field.toLowerCase()||"creditamount"==e.column.field.toLowerCase()){let s=e.item,i=t.field,a=1,r=1;null!=this.Currency&&null!=this.Currency.Currency.SelectedValue&&""!=this.Currency.Currency.SelectedValue?a=parseInt(this.Currency.Currency.SelectedValue):this.ScreenObject.GridDataColumns.Contains("CurrencyID")&&!n.e.IsEmpty(s.CurrencyID_Key)&&(a=parseInt(s.CurrencyID_Key)),null!=this.Currency&&null!=this.Currency.ExchangeRate.Text&&""!=this.Currency.ExchangeRate.Text?r=parseFloat(this.Currency.ExchangeRate.Text):this.ScreenObject.GridDataColumns.Contains("ExchangeRate")&&!n.e.IsEmpty(s.ExchangeRate)&&(r=parseFloat(s.ExchangeRate)),"Amount"==i?null!=s[i]&&0!=parseFloat(s[i])&&(18==this.ScreenObject.DocumentType||19==this.ScreenObject.DocumentType||21==this.ScreenObject.DocumentType||22==this.ScreenObject.DocumentType?this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!n.e.IsEmpty(s.CreditAccount_Key)&&(n.e.IsEmpty(s[i])||this.CheckIsBillWise(parseInt(s.CreditAccount_Key),s,i,parseFloat(s[i]),!0,a,r)):14!=this.ScreenObject.DocumentType&&15!=this.ScreenObject.DocumentType&&20!=this.ScreenObject.DocumentType&&23!=this.ScreenObject.DocumentType||this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!n.e.IsEmpty(s.DebitAccount_Key)&&(n.e.IsEmpty(s[i])||this.CheckIsBillWise(parseInt(s.DebitAccount_Key),s,i,parseFloat(s[i]),!1,a,r))):"DebitAmount"==i?null==s[i]||0==parseFloat(s[i])||n.e.IsEmpty(s.AccountID_Key)||n.e.IsEmpty(s[i])||this.CheckIsBillWise(parseInt(s.AccountID_Key),s,i,parseFloat(s[i]),!1,a,r):"CreditAmount"==i&&(0==n.e.Double(s[i])||n.e.IsEmpty(s.AccountID_Key)||this.CheckIsBillWise(parseInt(s.AccountID_Key),s,i,parseFloat(s[i]),!0,a,r))}}else if(30==this.ScreenObject.DocumentType&&(this.VoucherType=this.ScreenObject.GridDataColumns.Contains("VoucherType")&&!n.e.IsEmpty(this.SelectedRow.VoucherType)?parseInt(this.SelectedRow.VoucherType):0),!n.e.IsEmpty(this.SelectedRow[e.column.field.toLowerCase()])&&(parseFloat(this.SelectedRow[e.column.field.toLowerCase()])>0||32==this.ScreenObject.DocumentType&&parseFloat(this.SelectedRow[e.column.field.toLowerCase()].toString())<0)){let t=new be(this,e.column.field.toLowerCase(),this.VoucherType,0,this.SelectedRow);a.a.page.ShowDialog(t,Ce.a,{NoWidth:!0})}}else this.AddBins(this.SelectedRow,!1,!1,null)}this.LineNo=s+1,this.SetFocusongrid=!0}}onDistDim(e){if("PactTextBoxEditor"==e.column.className){let t=e.column.field,s=this.ScreenObject.ColumnSource.find(e=>e.DisplayMember==t);null==s&&(s=this.ScreenObject.ColumnSource.find(e=>e.distDim>5e4&&e.DefaultValueText.toLowerCase()==t.toLowerCase())),s.distDim>5e4&&this.ONDisDim(t)}}ONDisDim(e){let t=new v.ShowJVViewModel;t.ShowJVViewModel_2(this,e,7),a.a.page.ShowDialog(t,x.ShowJVComponent,{ShowCenter:!0,Title:t.Title})}onDistribute(e){let t=e.column.DgCol,s=e.column.field;if(s="DataGridComboBoxColumn"==e.column.className?t.ValueMember:t.DisplayMember,"DataGridPactListBoxColumn"==e.column.className)return void(3==t.CostCenterID&&(this.ScreenObject.Preferences.ContainsKey("UseQtyAdjustment")&&""!=this.ScreenObject.Preferences.UseQtyAdjustment&&Object(o.j)(this.ScreenObject.Preferences.UseQtyAdjustment)&&this.ScreenObject.GridDataColumns.Contains("QtyType")&&!n.e.IsEmpty(e.item.QtyType)&&("1"==e.item.QtyType.toString()||"2"==e.item.QtyType.toString())?a.a.page.ShowDialog(new le(this,1),ce.a,{ShowCenter:!0}):this.ScreenObject.Preferences.ContainsKey("TempInfo")&&""!=this.ScreenObject.Preferences.TempInfo&&Object(o.j)(this.ScreenObject.Preferences.TempInfo)));let i=e.column.field;if("quantity"==i.toLowerCase()&&(!this.ScreenObject.GridDataColumns.Contains("landingType")||"1"!=e.item.landingType.toString()&&"2"!=e.item.landingType.toString()||this.ScreenObject.GridDataColumns.Contains("VoucherType")&&"-1"!=e.item.VoucherType.toString()||(this.ScreenObject.GridDataObj.angularGrid&&this.ScreenObject.GridDataObj.angularGrid.slickGrid.getEditorLock().commitCurrentEdit(),a.a.page.ShowDialog(new le(this,2),ce.a)),this.ScreenObject.GridDataColumns.Contains("IsTestCase"))){this.res="YES";let e=new le(this,4);"NO"!=this.res&&a.a.page.ShowDialog(e,ce.a)}let r=this.ScreenObject.ColumnSource.find(e=>e.DisplayMember==i);if(r&&r.DisplayMember.toLowerCase().Contains("dcnum")&&null!=r.DistributeColName&&""!=r.DistributeColName&&this.ScreenObject.GridDataColumns.Contains(r.DistributeColName)&&(this.ScreenObject.GridDataObj.angularGrid&&this.ScreenObject.GridDataObj.angularGrid.slickGrid.getEditorLock().commitCurrentEdit(),n.e.IsNum(e.item[i])&&confirm(a.a.GetResource("Doyouwanttodistribute")))){this.ScreenObject.GridDataObj.angularGrid&&this.ScreenObject.GridDataObj.angularGrid.slickGrid.getEditorLock().commitCurrentEdit();let t="",s="";!n.e.IsEmpty(r.DependantOn)&&this.ScreenObject.GridDataColumns.Contains(r.DependantOn+"_Key")&&(t=r.DependantOn+"_Key",n.e.IsEmpty(e.item[t])||(s=e.item[t].toString())),this.DistributeValues(i,parseFloat(e.item[i]),r.DistributeColName,!0,t,s)}}GetColName(){return null==this.ScreenObject?"":this.IsInventoryVoucher?"ProductID_Key":this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")?"CreditAccount_Key":this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")?"DebitAccount_Key":this.ScreenObject.GridDataColumns.Contains("AccountID_Key")?"AccountID_Key":""}DistributeValues(e,t,s,i,a="",r=""){let o="";this.IsInventoryVoucher?o="ProductID_Key":this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")?o="CreditAccount_Key":this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")?o="DebitAccount_Key":this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&(o="AccountID_Key");let l=0;for(let d=0;d<this.ScreenObject.GridData.length;d++)if(!n.e.IsEmpty(this.ScreenObject.GridData[d][o])&&!n.e.IsEmpty(this.ScreenObject.GridData[d][s])&&n.e.IsNum(this.ScreenObject.GridData[d][s])){if(""!=a&&this.ScreenObject.GridData[d][a].toString()!=r)continue;l+=parseFloat(this.ScreenObject.GridData[d][s])}let c=0,h=0,u=this.ScreenObject.ColumnSource.find(t=>t.DisplayMember==e);!u&&e.toLowerCase().Contains("dccalc")&&(u=this.ScreenObject.ColumnSource.find(t=>t.DisplayMember==e.replace("dcCalc","")));for(let d=0;d<this.ScreenObject.GridData.length;d++)if(!n.e.IsEmpty(this.ScreenObject.GridData[d][o])){if(""!=a&&this.ScreenObject.GridData[d][a].toString()!=r)continue;if(l>0&&!n.e.IsEmpty(this.ScreenObject.GridData[d][s])&&n.e.IsNum(this.ScreenObject.GridData[d][s])){let i=parseFloat(this.ScreenObject.GridData[d][s])/l*t;this.ScreenObject.GridData[d][e]=u&&null!=u.DecimalPoints&&""!=u.DecimalPoints?i.ToString("N"+u.DecimalPoints):i,h+=parseFloat(this.ScreenObject.GridData[d][e]),c=d}else this.ScreenObject.GridData[d][e]=0;i&&this.CalculateTotals(this.ScreenObject.GridData[d],!1,e)}if(c>0&&t-h!=0){let s=parseFloat(this.ScreenObject.GridData[c][e])+t-h;this.ScreenObject.GridData[c][e]=u&&null!=u.DecimalPoints&&""!=u.DecimalPoints?s.ToString("N"+u.DecimalPoints):s,i&&this.CalculateTotals(this.ScreenObject.GridData[c],!1,e)}}onCopy(e){let t=this.GetPrimaryColName();if(""==t)return;let s=e.column.className;"DataGridPactListBoxColumn"!=s&&e.grid.getEditorLock().commitCurrentEdit();let i="";i=e.column.field;let r=confirm(a.a.GetResource("overrideallNotocopyblank")),o=this.ScreenObject.GridData,l=e.item;for(let h=0;h<o.length;h++)if("DataGridPactListBoxColumn"==s&&e.grid.getEditorLock().commitCurrentEdit(),!n.e.IsEmpty(o[h][t])){if(0==r&&!n.e.IsEmpty(o[h][i])&&(!this.ScreenObject.GridDataObj.DataTypes.Double.Contains(i)||n.e.IsEmpty(this.ScreenObject.GridData[h][i])||0!=parseFloat(this.ScreenObject.GridData[h][i])))continue;if(o[h][i]=l[i].toString(),45==this.DocumentType&&"dcalpha13"==i.toLowerCase()&&this.ScreenObject.GridDataColumns.Contains("AssignXML")&&(o[h].AssignXML=l.AssignXML.toString()),"DataGridDateTimeColumn"!=s&&"DataGridDateColumn"!=s||!this.ScreenObject.GridDataColumns.Contains(i+"_key")){if("DataGridPactListBoxColumn"==s){let e=this.ScreenObject.ColumnSource.find(e=>e.DisplayMember==i);if(e)if(""==n.e.String(l[e.ValueMember]))o[h][e.ValueMember]=null;else{o[h][e.ValueMember]=l[e.ValueMember].toString();let t=this.ScreenObject.Data.Tables[0].filter(t=>null!=t.LocalReference&&t.LocalReference==e.ID);if(t.length>0)for(let e=0;e<t.length;e++)if(""!=n.e.String(t[e].SysColumnName)&&""!=n.e.String(t[e].CostCenterColID)){var c=this.ColumnSource.find(s=>s.ID==t[e].CostCenterColID.toString());if(null!=c){let e,t;"DATE"==c.DataType||"Time2"==c.DataType||"DATETIME"==c.DataType||"TIME"==c.DataType?n.e.isValidDate(n.e.String(l[c.DisplayMember+"_Key"]))&&(o[h][c.DisplayMember+"_Key"]=new Date(l[c.DisplayMember+"_Key"].toString()),"DATE"==c.DataType?o[h][c.DisplayMember]=new Date(l[c.DisplayMember+"_Key"].toString()).ToString(a.a.SessionManager.Preferences["Date Format"]):"Time2"==c.DataType?o[h][c.DisplayMember]=new Date(l[c.DisplayMember+"_Key"].toString()).ToString("HH:mm"):"DATETIME"==c.DataType?o[h][c.DisplayMember]=new Date(l[c.DisplayMember+"_Key"].toString()).ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss tt"):"TIME"==c.DataType&&(o[h][c.DisplayMember]=new Date(l[c.DisplayMember+"_Key"].toString()).ToString("hh:mm:ss tt"))):"ComboBox"==c.DataType?o[h][c.ValueBinding]=l[c.ValueBinding].toString():"PactComboBox"==c.DataType?o[h][c.ValueBinding+"_Key"]=l[c.ValueBinding+"_Key"].toString():"LISTBOX"==c.DataType&&0!=c.CostCenterID?(e=n.e.Int(l[c.ValueMember]),e>0&&(o[h][c.ValueMember]=l[c.ValueMember].toString(),o[h][c.DisplayMember]=l[c.DisplayMember].toString())):"Double"==this.ScreenObject.GridDataColumns[c.DisplayMember].DataType?(t=n.e.Double(l[c.DisplayMember]),t>0&&(o[h][c.DisplayMember]=l[c.DisplayMember].toString())):o[h][c.DisplayMember]=l[c.DisplayMember].toString()}}}}}else o[h][i+"_key"]=""==n.e.String(l[i+"_key"])?null:l[i+"_key"].toString();if("quantity"==i.toLowerCase()){let e=1;n.e.IsNum(o[h].UOMConversion)&&(e=parseFloat(o[h].UOMConversion)),n.e.IsEmpty(o[h].Quantity)||(o[h].UOMConvertedQty=e*parseFloat(this.ScreenObject.GridData[h].Quantity))}this.CalculateTotals(o[h],!1,i)}31!=this.DocumentType&&32!=this.DocumentType||"duedate"!=i.toLowerCase()||(this.ScreenObject.GridDataColumns.Contains(i+"_key")&&!n.e.IsEmpty(l[i+"_key"])?this.CalcQOH(new Date(l[i+"_key"])):this.CalcQOH(this.DocumentDate))}LineItemEditClick(e){this.ScreenObject.GridDataObj.SelectedItem=e,this.ScreenObject.GridDataObj.MobileAddLine.ShowMobileAddLineItem(e)}LineItemFooterEditClick(e){this.ScreenObject.FooterGridDataObj.SelectedItem=e,this.ScreenObject.FooterGridDataObj.MobileAddLine.ShowMobileAddLineItem(e)}LineItemDeleteClick(e){if(this.ScreenObject.GridDataObj.CanUserDeleteRows&&this.CanDeleteRow(this.SelectedRow)){let t=this.ScreenObject.GridData.indexOf(this.SelectedRow);if(this.OnBeforeRowDeleting(this.SelectedRow,!0),"Yes"==this.res&&(this.ScreenObject.GridDataObj.Table.Contains(e)&&this.ScreenObject.GridDataObj.removeRow(e),-1!=t))for(let e=t;e<this.ScreenObject.GridData.length;e++)this.ScreenObject.GridDataObj.updateRow(this.ScreenObject.GridData[e])}}onGridLinkClick(e,t){"drEdit"==t&&"N"!=e.drEdit?this.LineItemEditClick(e):"drDelete"==t&&"N"!=e.drEdit&&this.LineItemDeleteClick(e)}onBeginEdit(e){let t=e.args,s=e.args.item,i=e.args.column,r=i.DgCol,l=n.e.IsEmpty(r.ValueBinding)?r.DisplayMember:r.ValueBinding,c=n.e.IsEmpty(r.ValueBinding)?r.ValueMember:r.ValueBinding,h=i.className;if("DataGridPactComboBoxColumn"==h){if(r&&r.ReadOnly)return void(t.Cancel=!0);r&&(this.PrevValue=n.e.String(s[r.ValueBinding]))}else if(null!=r&&null!=r){if(null!=r&&null!=r&&(r.ReadOnly||"refno"==r.DisplayMember.toLowerCase()))return void(t.Cancel=!0);"POSDocumentViewModel"==this.ClassName&&"FLOAT"==r.DataType&&(this.NUmpadBindingPath=r.DisplayMember,this.NumPadText=n.e.IsEmpty(e.args.item[r.DisplayMember])?"":e.args.item[r.DisplayMember].toString())}if(this.ScreenObject.Preferences.ContainsKey("ControlAccountFilterField")&&""!=this.ScreenObject.Preferences.ControlAccountFilterField&&"0"!=this.ScreenObject.Preferences.ControlAccountFilterField){let e=this.ScreenObject.ColumnSource.find(e=>e.ID==this.ScreenObject.Preferences.ControlAccountFilterField);if(e&&!n.e.IsEmpty(e.DefaultValue)&&n.e.IsEmpty(s[e.ValueMember])&&!n.e.IsEmpty(e.DefaultValueText)&&n.e.IsNum(e.DefaultValue)){let t=e.DefaultValueText.split("\x11");t.length>0&&(s[e.DisplayMember]=t[0]),s[e.ValueMember]=e.DefaultValue}}if(this.ScreenObject.GridDataColumns.Contains("FieldType")&&n.e.IsEmpty(s.FieldType)||100==this.DocumentType)return void(t.Cancel=!0);if(null!=this.NumericPADView&&(null!=r&&null!=r&&"FLOAT"==r.DataType.toUpperCase()?(this.NumericPADView.DisplayMember=r.DisplayMember,n.e.IsEmpty(s[r.DisplayMember])||(this.NumericPADView.txt.Text=s[r.DisplayMember].toString())):(this.NumericPADView.DisplayMember="",this.NumericPADView.txt.Text="0")),r&&"DATE"==r.DataType&&this.ScreenObject.GridDataColumns.Contains(r.DisplayMember+"_Key")&&(this.PrevValue=n.e.String(s[r.DisplayMember+"_Key"])),r&&"Time2"==r.DataType&&this.ScreenObject.GridDataColumns.Contains(r.DisplayMember+"_Key")&&(this.PrevValue=n.e.String(s[r.DisplayMember+"_Key"])),this.ScreenObject.GridDataColumns.Contains("IsKit")&&("1"==n.e.String(s.IsKit)||"2"==n.e.String(s.IsKit))&&("Quantity"==r.DisplayMember||"DataGridPactListBoxColumn"==i.className&&(3==r.CostCenterID||11==r.CostCenterID)||"DataGridPactComboBoxColumn"==i.className&&"VoucherType"==l))return void(t.Cancel=!0);if(!n.e.IsEmpty(s.ExecutedQty)&&parseFloat(s.ExecutedQty)>0)return void(t.Cancel=!0);if(45==this.DocumentType&&r){if(null==this.ProjDims){let e=0;this.ProjDims=[],e=n.e.Int(a.a.SessionManager.Preferences.PMLevel1Dimension),e>0&&this.ProjDims.push(e),e=n.e.Int(a.a.SessionManager.Preferences.PMLevel2Dimension),e>0&&this.ProjDims.push(e),e=n.e.Int(a.a.SessionManager.Preferences.PMLevel3Dimension),e>0&&this.ProjDims.push(e),e=n.e.Int(a.a.SessionManager.Preferences.PMTaskDimension),e>0&&this.ProjDims.push(e)}if("dcalpha12"==r.DisplayMember.toLowerCase())this.Dependencies();else if("dcalpha13"==r.DisplayMember.toLowerCase())this.AssignUsers();else if("dcalpha18"==r.DisplayMember.toLowerCase()&&this.ScreenObject.GridDataColumns.Contains("dcAlpha20")&&"Close"==n.e.String(s.dcAlpha20)||!n.e.IsEmpty(s.DocDetailsID)&&parseInt(s.DocDetailsID)>0&&this.ProjDims.Contains(r.CostCenterID))return void(t.Cancel=!0)}if(this.ScreenObject.GridDataColumns.Contains("CanEdit")&&"0"==n.e.String(s.CanEdit))return void(t.Cancel=!0);if(this.IsInventoryVoucher&&"Y"==n.e.String(s.IsScheme)&&"2"==n.e.String(s.SchemeID))return void(t.Cancel=!0);if(92==this.DocumentType){let e="DayWise",s=this.ScreenObject._TextFields.find(e=>"dcalpha4"==e.DBColumnName.toLowerCase());if(s&&(e=s.SelectedValue),"DayWise"==e&&("dcalpha5_key"==t.model.SortMemberPath.toLowerCase()||"dcalpha6_key"==t.model.SortMemberPath.toLowerCase()||"dcccnid73"==t.model.SortMemberPath.toLowerCase()))return void(t.Cancel=!0)}if(89==this.DocumentType||90==this.DocumentType){let e=this.ScreenObject._TextFields.find(e=>"dcalpha32"==e.DBColumnName.toLowerCase());if(e instanceof D.e){let s="";if(s=null==t.model.Binding?t.model.SelectedValueBinding:t.model.Binding,null==s&&(s=""),null!=e.SelectedValue&&"Manual"==e.SelectedValue){if("dcalpha1_key"==s.toLowerCase()||"dcalpha2"==s.toLowerCase()||"dcalpha3_key"==s.toLowerCase()||"dcalpha4"==s.toLowerCase())return void(t.Cancel=!1)}else if("dcalpha1_key"==s.toLowerCase()||"dcalpha2"==s.toLowerCase()||"dcalpha3_key"==s.toLowerCase()||"dcalpha4"==s.toLowerCase())return void(t.Cancel=!0)}}if(94==this.DocumentType&&"dcalpha7"==t.model.Binding.toLowerCase()&&!Object(o.j)(s.dcAlpha5))return void(t.Cancel=!0);if(62==this.CostCenterID&&this.ScreenObject.GridDataColumns.Contains("dcccnid52_Key")&&this.ScreenObject.GridDataColumns.Contains("dcAlpha10")&&!n.e.IsEmpty(s.dcAlpha10)&&!n.e.IsEmpty(s.DocDetailsID)&&parseFloat(s.DocDetailsID)>0&&"dcccnid52"==t.model.Binding.toLowerCase())return void(t.Cancel=!0);if(40058==this.CostCenterID&&this.ScreenObject.GridDataColumns.Contains("dcccnid52_Key")&&this.ScreenObject.GridDataColumns.Contains("dcAlpha6")&&!n.e.IsEmpty(s.dcAlpha6)&&!n.e.IsEmpty(s.DocDetailsID)&&parseFloat(s.DocDetailsID)>0&&"DataGridPactComboBoxColumn"==i.className&&50052==r.CostCenterID&&("1"==n.e.String(s.dcAlpha6)||"2"==n.e.String(s.dcAlpha6)))return void(t.Cancel=!0);if(40072==this.CostCenterID&&this.ScreenObject.GridDataColumns.Contains("dcAlpha21")&&!n.e.IsEmpty(s.dcAlpha21)){let e=!1,i=this.ScreenObject._TextFields.find(e=>"dcalpha16"==e.DBColumnName.toLowerCase());if(i&&"Yes"==i.SelectedValue&&(e=!0),!e&&"dcNum2"==t.model.Binding)return void(t.Cancel=!0);if("dcNum3"==t.model.Binding)return void(t.Cancel=!0);if("2"==n.e.String(s.dcAlpha21)){if("dcNum1"==t.model.Binding&&this.ScreenObject.GridDataColumns.Contains("dcAlpha23")&&!n.e.IsEmpty(s.dcAlpha23)&&parseFloat(s.dcAlpha23)>0)return void(t.Cancel=!0);if("dcNum2"==t.model.Binding&&this.ScreenObject.GridDataColumns.Contains("dcAlpha23")&&!n.e.IsEmpty(s.dcAlpha23)&&parseFloat(s.dcAlpha23)>0)return void(t.Cancel=!0);if(("dcNum1"==t.model.Binding||"dcNum2"==t.model.Binding)&&this.ScreenObject.GridDataColumns.Contains("dcAlpha23")&&!n.e.IsEmpty(s.dcAlpha23)&&("-1"==s.dcAlpha23.toString()||"-3"==s.dcAlpha23.toString()))return void(t.Cancel=!1)}else if(!("3"!=n.e.String(s.dcAlpha21)&&"4"!=n.e.String(s.dcAlpha21)||"dcNum2"!=t.model.Binding&&"dcNum3"!=t.model.Binding))return void(t.Cancel=!0)}if(40076==this.CostCenterID&&this.ScreenObject.GridDataColumns.Contains("dcAlpha2")&&this.ScreenObject.GridDataColumns.Contains("dcAlpha3")&&!n.e.IsEmpty(s.dcAlpha3)&&"-1"==s.dcAlpha3.toString())return void(t.Cancel=!0);if(40078==this.CostCenterID&&this.ScreenObject.GridDataColumns.Contains("dcAlpha2")&&!n.e.IsEmpty(s.dcAlpha2))if("Quarterly"==s.dcAlpha2){if("dcAlpha4"==t.model.Binding||"dcAlpha5"==t.model.Binding||"dcAlpha6_Key"==t.model.Binding||"dcAlpha7"==t.model.Binding)return void(t.Cancel=!0)}else if("Monthly"==s.dcAlpha2&&("dcAlpha8"==t.model.Binding||"dcNum7"==t.model.Binding))return void(t.Cancel=!0);if(96==this.ScreenObject.DocumentType)if("dcAlpha6"==t.model.Binding){if("Hours"==n.e.String(s.dcAlpha5))return void(t.Cancel=!0)}else if("dcAlpha10"==t.model.Binding&&"Hours"==n.e.String(s.dcAlpha9))return void(t.Cancel=!0);if(67==this.ScreenObject.DocumentType){let e=null,o=null;if("DataGridPactListBoxColumn"!=i.className||"dcccnid51"!=t.model.Binding.toLowerCase()||n.e.IsEmpty(this.strEmpFilter)||(r.FilterCondition=this.strEmpFilter),"dcNum2"==t.model.Binding||"dcNum3"==t.model.Binding||"dcNum6"==t.model.Binding||"dcNum8"==t.model.Binding||"dcNum10"==t.model.Binding||"dcNum12"==t.model.Binding||"dcNum14"==t.model.Binding||"dcNum15"==t.model.Binding){if("dcNum2"!=t.model.Binding)return void(t.Cancel=!0);if((n.e.IsEmpty(s.PayrollType)||"WeeklyOff"!=s.PayrollType)&&"Holiday"!=s.PayrollType)return void(t.Cancel=!0)}if("dcNum4"==t.model.Binding)if(a.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")&&"True"==a.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence);else if(!n.e.IsEmpty(s.PayrollType)&&("WeeklyOff"==s.PayrollType||"Holiday"==s.PayrollType)||a.a.SessionManager.Preferences.ContainsKey("BreakHoursImpactToOTS")&&"False"==a.a.SessionManager.Preferences.BreakHoursImpactToOTS)return void(t.Cancel=!0);if("dcNum5"==t.model.Binding||"dcNum7"==t.model.Binding||"dcNum9"==t.model.Binding||"dcNum11"==t.model.Binding||"dcNum13"==t.model.Binding){if(!a.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=a.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)return void(t.Cancel=!0);{let i=t.model.Binding;if(!n.e.IsEmpty(s.PayrollType))if("WeeklyOff"==s.PayrollType){if(e=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName==i),e.length>0&&(o=this.dtOTTypes.filter(t=>t.CostCenterColID==e[0].LinkData),o.length>0&&"PayWeeklyOffOT"!=o[0].SysColumnName&&"PayHolidayOT"!=o[0].SysColumnName&&"PayEveryDayOT"!=o[0].SysColumnName))return void(t.Cancel=!0)}else if("Holiday"==s.PayrollType){if(e=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName==i),e.length>0&&(o=this.dtOTTypes.filter(t=>t.CostCenterColID==e[0].LinkData),o.length>0&&"PayHolidayMastOT"!=o[0].SysColumnName&&"PayHolidayOT"!=o[0].SysColumnName&&"PayEveryDayOT"!=o[0].SysColumnName))return void(t.Cancel=!0)}else if(e=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName==i),e.length>0&&(o=this.dtOTTypes.filter(t=>t.CostCenterColID==e[0].LinkData),o.length>0&&"PayNormalOT"!=o[0].SysColumnName&&"PayEveryDayOT"!=o[0].SysColumnName))return void(t.Cancel=!0)}}}if(40056==this.CostCenterID&&this.ScreenObject.GridDataColumns.Contains("dcNum2")&&!n.e.IsEmpty(s.dcNum2)&&null!=this.dsData&&"dcNum2"==t.model.Binding&&(this.dsData.Tables[1].filter(e=>e.LinkedInvDocDetailsID==s.DocDetailsID).length>0||0==parseInt(s.dcNum2)))return void(t.Cancel=!0);if(this.IsInventoryVoucher&&"Y"==n.e.String(s.IsScheme)&&!n.e.IsEmpty(s.SchemeID)&&parseInt(s.SchemeID)>2&&("Quantity"==r.DisplayMember||"Gross"==r.DisplayMember||"DataGridPactListBoxColumn"==i.className&&(3==r.CostCenterID||11==r.CostCenterID)))return void(t.Cancel=!0);if(this.ScreenObject.GridDataColumns.Contains("RemQty")&&!n.e.IsEmpty(s.RemQty)&&"DataGridPactListBoxColumn"==i.className&&3==r.CostCenterID)return void(t.Cancel=!0);if("Quantity"==l&&this.ScreenObject.Preferences.ContainsKey("EnableWieghingPopupOnQty")&&""!=this.ScreenObject.Preferences.EnableWieghingPopupOnQty&&Object(o.j)(this.ScreenObject.Preferences.EnableWieghingPopupOnQty)&&"true"==n.e.String(s.IsWeightable).toLowerCase()){let e=this.QtyReader(n.e.String(s.Quantity));s.Quantity=n.e.IsEmpty(e)?"0":e}let u=this.ScreenObject.GridData.indexOf(s);if(u=-1==u||this.ScreenObject.GridData.length-u<3?3:0,this.ScreenObject.GridDataObj.CanUserAddRows)for(let a=0;a<u;a++){let e=this.ScreenObject.GridDataObj.NewRow();e.DocSeqNo=this.ScreenObject.GridData.length+1,e.DocDetailsID=0,this.ScreenObject.GridDataObj.addRow(e)}if(this.IsInventoryVoucher&&!n.e.IsEmpty(s.LinkedInvDocDetailsID)&&parseInt(s.LinkedInvDocDetailsID)>0&&(this.ScreenObject.Preferences.ContainsKey("LockLinkedRows")&&""!=this.ScreenObject.Preferences.LockLinkedRows&&Object(o.j)(this.ScreenObject.Preferences.LockLinkedRows)&&(!this.ScreenObject.Preferences.ContainsKey("LockLinkedCols")||!this.ScreenObject.Preferences.LockLinkedCols.split(",").Contains(l))||this.ScreenObject.Preferences.ContainsKey("DontSavePartiallyLinkedItem")&&""!=this.ScreenObject.Preferences.DontSavePartiallyLinkedItem&&Object(o.j)(this.ScreenObject.Preferences.DontSavePartiallyLinkedItem)&&"PactTextBoxEditor"==h&&s.LinkedFieldName==l))t.Cancel=!0;else if(this.ScreenObject.Preferences.ContainsKey("LineWisePDC")&&Object(o.j)(this.ScreenObject.Preferences.LineWisePDC)&&this.ScreenObject.GridDataColumns.Contains("RefStatusID")&&!n.e.IsEmpty(s.RefStatusID)&&370!=parseInt(s.RefStatusID)&&!n.e.IsEmpty(s.DocDetailsID)&&parseInt(s.DocDetailsID)>0)t.Cancel=!0;else{if("PactTextBoxEditor"==h&&(this.PrevValue=n.e.String(s[l])),(35==this.ScreenObject.DocumentType||202==this.ScreenObject.DocumentType)&&"PactTextBoxEditor"==h){if("dcAlpha20"==r.DisplayMember){let e=0,i=new Date,a=new Date;if(35==this.ScreenObject.DocumentType){if(this.ScreenObject.GridDataColumns.Contains("dcNum2")&&""!=s.dcNum2.toString()&&parseFloat(s.dcNum2.toString())>0&&(e=parseFloat(s.dcNum2.toString())),this.ScreenObject.GridDataColumns.Contains("dcAlpha3")&&this.ScreenObject.GridDataObj.DataTypes.Date.Contains("dcAlpha3"))n.e.String(s.dcAlpha3)||(i=new Date(s.dcAlpha3.toString()));else{let e=this.ScreenObject._TextFields.find(e=>"dcalpha3"==e.DBColumnName.toLowerCase());null!=e&&e instanceof d.c&&e.Date&&(i=e.Date)}if(this.ScreenObject.GridDataColumns.Contains("dcAlpha4")&&this.ScreenObject.GridDataObj.DataTypes.Date.Contains("dcAlpha4"))n.e.String(s.dcAlpha4)||(a=new Date(s.dcAlpha4.toString()));else{let e=this.ScreenObject._TextFields.find(e=>"dcalpha4"==e.DBColumnName.toLowerCase());null!=e&&e instanceof d.c&&e.Date&&(a=e.Date)}}else if(202==this.ScreenObject.DocumentType){if(this.ScreenObject.GridDataColumns.Contains("dcalpha12")&&this.ScreenObject.GridDataObj.DataTypes.Date.Contains("dcAlpha12"))n.e.String(s.dcalpha12)||(i=new Date(s.dcalpha12.toString()));else{let e=this.ScreenObject._TextFields.find(e=>"dcalpha12"==e.DBColumnName.toLowerCase());null!=e&&e instanceof d.c&&e.Date&&(i=e.Date)}if(this.ScreenObject.GridDataColumns.Contains("dcalpha13")&&this.ScreenObject.GridDataObj.DataTypes.Date.Contains("dcAlpha13"))n.e.String(s.dcalpha13)||(a=new Date(s.dcalpha13.toString()));else{let e=this.ScreenObject._TextFields.find(e=>"dcalpha13"==e.DBColumnName.toLowerCase());null!=e&&e instanceof d.c&&e.Date&&(a=e.Date)}e=es.GetTotalMonthsFrom(i,a)}return void(t.Cancel=!0)}if("dcAlpha21"==r.DisplayMember)return void(t.Cancel=!0)}if("DataGridPactComboBoxColumn"==h){let e=t.model.SelectedValueBinding,i=this.ScreenObject.Data.Tables[0].filter(t=>t.SysColumnName==e);if(i.length>0&&!n.e.IsEmpty(i[0].LinkData)&&22803==parseInt(i[0].LinkData)){let e=t.column.editor;this.ScreenObject.GridDataColumns.Contains("EndYear")&&this.ScreenObject.GridDataColumns.Contains("StartYear")&&!n.e.IsEmpty(s.StartYear)?(this.itemSourceFilter.length>0?e.ItemsSource=this.itemSourceFilter:this.itemSourceFilter=e.ItemsSource,e.ItemsSource=this.itemSourceFilter.filter(e=>e.Year>=n.e.String(s.StartYear)),e.ItemsSource=!n.e.IsEmpty(s.EndYear)&&parseInt(s.EndYear)>0?e.ItemsSource.filter(e=>e.Year<=n.e.String(s.EndYear)):e.ItemsSource.filter(e=>e.Year<=(new Date).getFullYear().toString())):e.ItemsSource=this.itemSourceFilter.filter(e=>1==e.Year)}}else if("DataGridPactListBoxColumn"==h){let e=t.model,i=c;if(this.PrevValue=n.e.String(s[i]),3==e.CostCenterID){if(""==this.PrevValue&&this.ScreenObject.Preferences.ContainsKey("AutoSearchcatalog")&&""!=this.ScreenObject.Preferences.AutoSearchcatalog&&Object(o.j)(this.ScreenObject.Preferences.AutoSearchcatalog)){this.ProdID=0;let t=this.ScreenObject.ColumnSource.find(t=>t.CostCenterID==e.CostCenterID),s=0;return t&&(s=t.GridViewID),0==s&&(s=268),void a.a.page.ShowDialog(new Ye.ProductSearchCatalogViewModel(this,s,3,null,null),Je.ProductSearchCatalogComponent)}if(null!=s.LinkedQuantity&&null!=s.LinkedQuantity&&parseFloat(s.LinkedQuantity)>0)return alert("Cannot Edit Linked Product"),void(t.Cancel=!0)}if(11==e.CostCenterID){let t="";this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&(t=n.e.String(s.ProductID_Key)),this.Unit_keyOnBeginEditText=n.e.String(s.Unit);let i=" (BaseID IN ";i+=" (SELECT     BaseID ",i+=" FROM          COM_UOM AS COM_UOM_1 with(nolock) ",i=i+" WHERE      (UOMID =(select UOMID from inv_product with(nolock) where productid="+t+") ))) ",""==t?(e.ProductID=0,i=" (BaseID IN ",i+=" (SELECT     BaseID ",i+=" FROM          COM_UOM AS COM_UOM_1 with(nolock) ",i+=" WHERE      (UOMID =-1 ))) "):e.ProductID=parseInt(t),e.FilterCondition=i,e.ShowMutipleOption=!0,e.QtyWhere=this.ScreenObject.GetQtyWhere(s,"")}else if(2==e.CostCenterID){let t=1,r=this.ScreenObject.ColumnSource.find(e=>e.ValueMember==i);if(r&&r.IsRepeat&&(n.e.IsEmpty(s[r.ValueMember])||!n.e.IsEmpty(s[r.ValueMember])&&0==parseInt(s[r.ValueMember]))){let e=this.ScreenObject.GridData.indexOf(s);e>0&&(s[r.DisplayMember]=this.ScreenObject.GridData[e-1][r.DisplayMember],s[r.ValueMember]=this.ScreenObject.GridData[e-1][r.ValueMember])}this.ScreenObject.DivisionID>0&&(e.DivisionID=this.ScreenObject.DivisionID),this.ScreenObject.LocationID>0&&(e.LocationID=this.ScreenObject.LocationID);let o="";e.Join="";let l=this.ScreenObject._CCFields.filter(e=>e.CrFilter>0);"debitaccount_key"==i.toLowerCase()?l=this.ScreenObject._CCFields.filter(e=>e.DbFilter>0):"creditaccount_key"!=i.toLowerCase()&&"accountid_key"!=i.toLowerCase()&&(l=null),null!=l&&l.forEach(s=>{s instanceof m.b&&s.SelectedValue>0&&(""!=o&&(o+=" and "),s.AccDimInUse?(o="("+s.DBColumnName.replace("dc","")+"="+s.SelectedValue.toString(),1==s.CrFilter&&(o+=" OR "+s.DBColumnName.replace("dc","")+"=1 "),o+=")"):(e.Join+=" join COM_CostCenterCostCenterMap DCCM"+t+" with(nolock) on a.AccountID=DCCM"+t+".ParentNodeID and DCCM"+t+".ParentCostCenterID=2 ",e.Join+=" join "+this.ScreenObject.GetTableName(s.CCID)+" DCCMj"+t+" with(nolock) on DCCM"+t+".CostCenterID="+s.CCID+" and DCCM"+t+".NodeID= DCCMj"+t+".NodeID ",e.Join+=" join "+this.ScreenObject.GetTableName(s.CCID)+" DCG"+t+" with(nolock) on  DCG"+t+".lft between   DCCMj"+t+".lft and  DCCMj"+t+".rgt",o+="  DCG"+t+".NodeID="+s.SelectedValue.toString(),t++))});let c=this.ScreenObject.ColumnSource.filter(e=>e.DisplayMember.toLowerCase().Contains("dcccnid")&&e.CrRefColID>0);if("debitaccount_key"==i.toLowerCase()?c=this.ScreenObject.ColumnSource.filter(e=>e.DisplayMember.toLowerCase().Contains("dcccnid")&&e.DrRefColID>0):"creditaccount_key"!=i.toLowerCase()&&"accountid_key"!=i.toLowerCase()&&(c=null),null!=c)for(let a=0;a<c.length;a++){let r=c[a];n.e.IsEmpty(s[r.ValueMember])||(r.isUpdate?(o+="(CC."+r.DisplayMember.replace("dc","")+"="+s[r.ValueMember].toString(),"debitaccount_key"==i.toLowerCase()?1!=r.DrRefColID&&2!=r.DrRefColID||(o+=" OR CC."+r.DisplayMember.replace("dc","")+"=1 "):"creditaccount_key"==i.toLowerCase()&&(1!=r.CrRefColID&&2!=r.CrRefColID||(o+=" OR CC."+r.DisplayMember.replace("dc","")+"=1 ")),o+=")"):(e.Join+=" join COM_CostCenterCostCenterMap DCCM"+t+" with(nolock) on a.AccountID=DCCM"+t+".ParentNodeID and DCCM"+t+".ParentCostCenterID=2 ",e.Join+=" join "+this.ScreenObject.GetTableName(r.CostCenterID)+" DCCMj"+t+" with(nolock) on DCCM"+t+".CostCenterID="+r.CostCenterID+" and DCCM"+t+".NodeID= DCCMj"+t+".NodeID ",e.Join+=" join "+this.ScreenObject.GetTableName(r.CostCenterID)+" DCG"+t+" with(nolock) on  DCG"+t+".lft between   DCCMj"+t+".lft and  DCCMj"+t+".rgt",o+="  DCG"+t+".NodeID="+s[r.ValueMember].toString(),t++))}if(this.ScreenObject.Preferences.ContainsKey("ControlAccountFilterField")&&""!=this.ScreenObject.Preferences.ControlAccountFilterField&&"0"!=this.ScreenObject.Preferences.ControlAccountFilterField){let t=this.ScreenObject.ColumnSource.find(e=>e.ID==this.ScreenObject.Preferences.ControlAccountFilterField);t&&!n.e.IsEmpty(t.ValueMember)&&(t.ValueMember==i?a.a.SessionManager.Preferences.ContainsKey("IsControlAccounts")&&"TRUE"==a.a.SessionManager.Preferences.IsControlAccounts.toUpperCase()&&(""!=o&&(o+=" and "),o+=" a.AccountID in (1",a.a.SessionManager.Preferences.ContainsKey("DebtorsControlGroup")&&""!=a.a.SessionManager.Preferences.DebtorsControlGroup.toUpperCase()&&(o+=","+a.a.SessionManager.Preferences.DebtorsControlGroup),a.a.SessionManager.Preferences.ContainsKey("CreditorsControlGroup")&&""!=a.a.SessionManager.Preferences.CreditorsControlGroup.toUpperCase()&&(o+=","+a.a.SessionManager.Preferences.CreditorsControlGroup),o+=")"):this.ScreenObject.Preferences.ContainsKey("AccountFilterField")&&""!=this.ScreenObject.Preferences.AccountFilterField&&"0"!=this.ScreenObject.Preferences.AccountFilterField||"LISTBOX"==t.DataType&&this.ScreenObject.GridDataColumns.Contains(t.ValueMember)&&!n.e.IsEmpty(s[t.ValueMember])&&(e.Join+=" join Acc_accounts g with(nolock) on a.lft between g.lft and g.rgt  and g.AccountID="+s[t.ValueMember].toString()+" or a.IsDrCr=1 ","1"==n.e.String(s[t.ValueMember])&&(a.a.SessionManager.Preferences.ContainsKey("DebtorsControlGroup")&&""!=a.a.SessionManager.Preferences.DebtorsControlGroup.toUpperCase()&&(e.Join+=" join Acc_accounts dacg with(nolock) on a.lft not between dacg.lft and dacg.rgt  and dacg.AccountID="+a.a.SessionManager.Preferences.DebtorsControlGroup),a.a.SessionManager.Preferences.ContainsKey("CreditorsControlGroup")&&""!=a.a.SessionManager.Preferences.CreditorsControlGroup.toUpperCase()&&(e.Join+=" join Acc_accounts cacg with(nolock) on a.lft not between cacg.lft and cacg.rgt  and cacg.AccountID="+a.a.SessionManager.Preferences.CreditorsControlGroup))))}if(5!=this.DocumentType&&8!=this.DocumentType&&13!=this.DocumentType||!this.ScreenObject.Preferences.ContainsKey("BudgetFeild")||""==this.ScreenObject.Preferences.BudgetFeild||(S=this.ScreenObject._TextFields.find(e=>e.DBColumnName.toLowerCase()==this.ScreenObject.Preferences.BudgetFeild.toLowerCase()))&&S.SelectedValue>0&&(e.Join+=" join COM_BudgetAlloc budg WITH(NOLOCK) on budg.AccountID=a.Accountid ",""!=o&&(o+=" and "),o+=" budg.BudgetDefID="+S.SelectedValue),this.ScreenObject.Preferences.ContainsKey("AccountFilterField")&&""!=this.ScreenObject.Preferences.AccountFilterField&&"0"!=this.ScreenObject.Preferences.AccountFilterField){let t=this.ScreenObject.ColumnSource.find(e=>e.ID==this.ScreenObject.Preferences.AccountFilterField);if(t&&!n.e.IsEmpty(t.ValueMember)){if(t.ValueMember==i&&this.ScreenObject.Preferences.ContainsKey("ControlAccountFilterField")&&""!=this.ScreenObject.Preferences.ControlAccountFilterField){let t=this.ScreenObject.ColumnSource.find(e=>e.ID==this.ScreenObject.Preferences.ControlAccountFilterField);t&&!n.e.IsEmpty(t.ValueMember)&&"LISTBOX"==t.DataType&&this.ScreenObject.GridDataColumns.Contains(t.ValueMember)&&!n.e.IsEmpty(s[t.ValueMember])&&(e.Join+=" join Acc_accounts g with(nolock) on a.lft between g.lft and g.rgt  and g.AccountID="+s[t.ValueMember].toString(),"1"==n.e.String(s[t.ValueMember])&&(a.a.SessionManager.Preferences.ContainsKey("DebtorsControlGroup")&&""!=a.a.SessionManager.Preferences.DebtorsControlGroup.toUpperCase()&&(e.Join+=" join Acc_accounts dacg with(nolock) on a.lft not between dacg.lft and dacg.rgt  and dacg.AccountID="+a.a.SessionManager.Preferences.DebtorsControlGroup),a.a.SessionManager.Preferences.ContainsKey("CreditorsControlGroup")&&""!=a.a.SessionManager.Preferences.CreditorsControlGroup.toUpperCase()&&(e.Join+=" join Acc_accounts cacg with(nolock) on a.lft not between cacg.lft and cacg.rgt  and cacg.AccountID="+a.a.SessionManager.Preferences.CreditorsControlGroup)))}"LISTBOX"==t.DataType&&this.ScreenObject.GridDataColumns.Contains(t.ValueMember)&&!n.e.IsEmpty(s[t.ValueMember])&&(e.Join+=" join Acc_accounts g with(nolock) on a.lft between g.lft and g.rgt  and g.AccountID="+s[t.ValueMember].toString())}}if("creditaccount_key"==i.toLowerCase()&&this.ScreenObject.Preferences.ContainsKey("onlyProductvendors")&&"True"==this.ScreenObject.Preferences.onlyProductvendors&&!n.e.IsEmpty(s.ProductID_Key)){let e=this.ScreenObject.GetProductVendors(n.e.String(s.ProductID_Key)),t="";if(null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&e.Columns[0].Contains("AccountID"))for(let s=0;s<e.Tables[0].length;s++)""!=t&&(t+=","),t+=n.e.String(e.Tables[0][s].AccountID);""!=t&&(""!=o&&(o+=" and "),o+=" a.AccountID in ("+t+")")}null!=o&&(e.Where=""!=o?null!=e.FilterCondition&&""!=e.FilterCondition?" and "+o:o:"")}else if(3==e.CostCenterID){this.ScreenObject.DivisionID>0&&(e.DivisionID=this.ScreenObject.DivisionID),this.ScreenObject.LocationID>0&&(e.LocationID=this.ScreenObject.LocationID),e.ExcludeSelected=0,e.Join="";let t=0,a="",r="";for(let s=0;s<this.ScreenObject.FilterFields.length;s++){let i=this.ScreenObject.FilterFields[s];if(i.Key.SelectedValue>1){if(65==i.Key.CCID||83==i.Key.CCID)continue;50006==i.Key.CCID||50004==i.Key.CCID?""!=r&&(r+=" and "):""!=a&&(a+=" and "),50006==i.Key.CCID?(r+="( a.CategoryID="+i.Key.SelectedValue.toString()+" ",1!=i.Value&&2!=i.Value||(r+=" OR a.CategoryID=1"),r+=")"):50004==i.Key.CCID?(r+="(a.DepartmentID="+i.Key.SelectedValue.toString()+" ",1!=i.Value&&2!=i.Value||(r+=" OR a.DepartmentID=1"),r+=")"):!this.ScreenObject.ProdFilterinuse.ContainsKey(i.Key.CCID)||Object(o.j)(this.ScreenObject.ProdFilterinuse[i.Key.CCID])?(a+="(CC."+i.Key.DBColumnName.replace("dc","")+"="+i.Key.SelectedValue.toString()+" ",1!=i.Value&&2!=i.Value||(a+=" OR CC."+i.Key.DBColumnName.replace("dc","")+"=1 "),a+=")"):(e.Join+=" join COM_CostCenterCostCenterMap DCCM"+t+" with(nolock) on a.ProductID=DCCM"+t+".ParentNodeID and DCCM"+t+".ParentCostCenterID=3 ",e.Join+=" join "+this.ScreenObject.GetTableName(i.Key.CCID)+" DCCMj"+t+" with(nolock) on DCCM"+t+".CostCenterID="+i.Key.CCID+" and DCCM"+t+".NodeID= DCCMj"+t+".NodeID ",e.Join+=" join "+this.ScreenObject.GetTableName(i.Key.CCID)+" DCG"+t+" with(nolock) on  DCG"+t+".lft between   DCCMj"+t+".lft and  DCCMj"+t+".rgt",a+="  DCG"+t+".NodeID="+i.Key.SelectedValue.toString(),t++)}}for(let i=0;i<this.ScreenObject.FilterColumns.keys.length;i++){let l={Key:this.ScreenObject.FilterColumns.keys[i],Value:this.ScreenObject.FilterColumns.values[i]};if(!n.e.IsEmpty(s[l.Key])&&parseInt(s[l.Key])>0){let i=this.ScreenObject.ColumnSource.find(e=>e.ValueMember==l.Key);if(i){if(65==i.CostCenterID||83==i.CostCenterID)continue;50006==i.CostCenterID||50004==i.CostCenterID?""!=r&&(r+=" and "):""!=a&&(a+=" and "),50006==i.CostCenterID?(r+="(a.CategoryID="+s[l.Key],1!=l.Value&&2!=l.Value||(r+=" OR a.CategoryID=1"),r+=")"):50004==i.CostCenterID?(r+="(a.DepartmentID="+s[l.Key],1!=l.Value&&2!=l.Value||(r+=" OR a.DepartmentID=1"),r+=")"):!this.ScreenObject.ProdFilterinuse.ContainsKey(i.CostCenterID)||Object(o.j)(this.ScreenObject.ProdFilterinuse[i.CostCenterID])?(a+="(CC."+i.DisplayMember.replace("dc","")+"="+s[l.Key],1!=l.Value&&2!=l.Value||(a+=" OR CC."+i.DisplayMember.replace("dc","")+"=1 "),a+=")"):(e.Join+=" join COM_CostCenterCostCenterMap DCCM"+t+" with(nolock) on a.ProductID=DCCM"+t+".ParentNodeID and DCCM"+t+".ParentCostCenterID=3 ",e.Join+=" join "+this.ScreenObject.GetTableName(i.CostCenterID)+" DCCMj"+t+" with(nolock) on DCCM"+t+".CostCenterID="+i.CostCenterID+" and DCCM"+t+".NodeID= DCCMj"+t+".NodeID ",e.Join+=" join "+this.ScreenObject.GetTableName(i.CostCenterID)+" DCG"+t+" with(nolock) on  DCG"+t+".lft between   DCCMj"+t+".lft and  DCCMj"+t+".rgt",a+="  DCG"+t+".NodeID="+s[l.Key],t++)}}}""!=a&&(r+=""!=r?"and "+a:a),Object(o.j)(this.ScreenObject.Preferences.Showvendorwiseproducts)&&null!=this.ScreenObject.CreditAccount&&this.ScreenObject.CreditAccount.SelectedValue>0?(""!=r&&(r+=" and "),e.Join+=" join INV_ProductVendors IPV with(nolock) on a.ProductID=IPV.ProductID",r+=" IPV.AccountID="+this.ScreenObject.CreditAccount.SelectedValue):this.ScreenObject.Preferences.ContainsKey("Showcustomerwiseproducts")&&""!=this.ScreenObject.Preferences.Showcustomerwiseproducts&&Object(o.j)(this.ScreenObject.Preferences.Showcustomerwiseproducts)&&null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.SelectedValue>0&&(""!=r&&(r+=" and "),e.Join+=" join INV_ProductVendors IPV with(nolock) on a.ProductID=IPV.ProductID",r+=" IPV.AccountID="+this.ScreenObject.DebitAccount.SelectedValue);let l=Object(o.j)(this.ScreenObject.Preferences.ExcludeTemproducts);if(null!=e.FilterCondition&&""!=e.FilterCondition?(e.Where=this.ScreenObject.TempProductID>0&&""!=r?l?"and ("+r+" and a.ProductID!="+this.ScreenObject.TempProductID+")":"and ("+r+" or a.ProductID="+this.ScreenObject.TempProductID+")":"and "+r,e.ExcludeSelected=1):(e.ExcludeSelected=1,e.Where=this.ScreenObject.TempProductID>0&&""!=r?l?"("+r+" and a.ProductID!="+this.ScreenObject.TempProductID+")":"("+r+" or a.ProductID="+this.ScreenObject.TempProductID+")":this.ScreenObject.TempProductID>0&&""==r?l?"a.ProductID!="+this.ScreenObject.TempProductID:"":""!=r?r:""),e.QtyWhere=this.ScreenObject.GetQtyWhere(s,""),this.ScreenObject.Preferences.ContainsKey("ProductFilterField")&&""!=this.ScreenObject.Preferences.ProductFilterField){let t=this.ScreenObject.ColumnSource.find(e=>e.ID==this.ScreenObject.Preferences.ProductFilterField);t&&!n.e.IsEmpty(t.ValueMember)&&"LISTBOX"==t.DataType&&this.ScreenObject.GridDataColumns.Contains(t.ValueMember)&&!n.e.IsEmpty(s[t.ValueMember])&&(e.Join+=" join inv_Product g with(nolock) on a.lft between g.lft and g.rgt  and g.ProductID="+s[t.ValueMember])}this.ProdID=this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!n.e.IsEmpty(s.ProductID_Key)?parseInt(s.ProductID_Key):0;let c=this.ScreenObject.ColumnSource.find(e=>e.ValueMember==i);if(c&&c.IsRepeat&&(n.e.IsEmpty(s[c.ValueMember])||!n.e.IsEmpty(s[c.ValueMember])&&0==parseInt(s[c.ValueMember]))){let e=this.ScreenObject.GridData.indexOf(s);e>0&&(s[c.DisplayMember]=this.ScreenObject.GridData[e-1][c.DisplayMember],s[c.ValueMember]=this.ScreenObject.GridData[e-1][c.ValueMember])}}else if(61==e.CostCenterID||e.CostCenterID>5e4){e.Join="";let t=r;e.ProductID=this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!n.e.IsEmpty(s.ProductID_Key)?null==t||2!=t.Filter&&4!=t.Filter?0:parseInt(s.ProductID_Key):0;let i="";if(""!=t.DependantOn)if(5==this.DocumentType&&"-94"==t.DependantOn&&this.ScreenObject.Preferences.ContainsKey("BudgetFeild")&&!n.e.IsEmpty(this.ScreenObject.Preferences.BudgetFeild)){let t="0";var S;r.DisplayMember.startsWith("TO")&&this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!n.e.IsEmpty(s.CreditAccount_Key)?t=s.CreditAccount_Key.toString():r.DisplayMember.startsWith("TO")||!this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")||n.e.IsEmpty(s.DebitAccount_Key)||(t=s.DebitAccount_Key.toString()),(S=this.ScreenObject._TextFields.find(e=>e.DBColumnName.toLowerCase()==this.ScreenObject.Preferences.BudgetFeild.toLowerCase()))&&S.SelectedValue>0&&(e.Join=" join COM_BudgetAlloc budg WITH(NOLOCK) on budg.CCNID"+(r.CostCenterID-5e4)+"=a.NodeID ",i=" budg.BudgetDefID="+S.SelectedValue,i+=" and budg.AccountID="+t)}else if(n.e.IsEmpty(t.FilterColumn))if(t.Dependantinuse)if(this.ScreenObject.GridDataColumns.Contains(t.DependantOn+"_Key"))t.DisplayMember.startsWith("TO")&&this.ScreenObject.GridDataColumns.Contains("TO"+t.DependantOn+"_Key")?!n.e.IsEmpty(s["TO"+t.DependantOn+"_Key"])&&parseInt(s["TO"+t.DependantOn+"_Key"].toString())>1&&(i="("+t.DependantOn.Replace("dc","")+"="+s["TO"+t.DependantOn+"_Key"].toString(),1==t.Dependancy&&(i+=" OR "+t.DisplayMember.Replace("TO","").Replace("dc","")+"=1 "),i+=")"):!n.e.IsEmpty(s[t.DependantOn+"_Key"])&&parseInt(s[t.DependantOn+"_Key"])>1&&(i="("+t.DependantOn.Replace("dc","")+"="+s[t.DependantOn+"_Key"].toString(),1==t.Dependancy&&(i+=" OR "+t.DisplayMember.Replace("dc","")+"=1 "),i+=")");else{let e=this.ScreenObject._CCFields.find(e=>e.DBColumnName.toLowerCase()==t.DependantOn.toLowerCase());(e&&e instanceof m.b&&e.SelectedValue>0||null!=e&&e instanceof C.a&&e.SelectedValue>0)&&(i="("+e.DBColumnName.replace("dc","")+"="+e.SelectedValue.toString(),1==t.Dependancy&&(i+=" OR "+e.DBColumnName.replace("dc","")+"=1 "),i+=")")}else if(this.ScreenObject.GridDataColumns.Contains(t.DependantOn+"_Key")&&!n.e.IsEmpty(s[t.DependantOn+"_Key"])&&parseInt(s[t.DependantOn+"_Key"])>1){let i=this.ScreenObject.ColumnSource.find(e=>null!=e.ValueMember&&e.ValueMember.toLowerCase()==t.DependantOn.toLowerCase()+"_key");i&&(e.Join=5==t.Dependancy?"  JOIN "+this.ScreenObject.GetTableName(t.CostCenterID)+" CMJ with(nolock) ON a.lft between  CMJ.lft and CMJ.rgt JOIN COM_CostCenterCostCenterMap CM with(nolock) on CM.CostCenterID="+t.CostCenterID+" and CM.ParentCostCenterID="+i.CostCenterID+" and CM.ParentNodeID="+s[t.DependantOn+"_Key"].toString()+" and CMJ.NodeID=CM.NodeID ":"  JOIN COM_CostCenterCostCenterMap CM with(nolock) on CM.ParentCostCenterID="+t.CostCenterID+" and a.NodeID=CM.ParentNodeID \n                                    JOIN "+this.ScreenObject.GetTableName(i.CostCenterID)+" CMJ with(nolock) ON CM.CostCenterID= "+i.CostCenterID+"  and CM.NodeID=CMJ.NodeID \n                                    JOIN "+this.ScreenObject.GetTableName(i.CostCenterID)+" CMJG with(nolock) ON CMJG.lft between  CMJ.lft and CMJ.rgt and CMJG.NodeID="+s[t.DependantOn+"_Key"].toString())}else{let s=this.ScreenObject._CCFields.find(e=>e.DBColumnName.toLowerCase()==t.DependantOn.toLowerCase()),i=0,a=0;s&&s instanceof m.b&&s.SelectedValue>0||null!=s&&s instanceof C.a&&s.SelectedValue>0?(i=s.SelectedValue,a=s.CCID):null!=this.ScreenObject.CreditAccount&&this.ScreenObject.CreditAccount.SelectedValue>0&&"creditaccount"==t.DependantOn.toLowerCase()?(i=this.ScreenObject.CreditAccount.SelectedValue,a=2):null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.SelectedValue>0&&"debitaccount"==t.DependantOn.toLowerCase()&&(i=this.ScreenObject.DebitAccount.SelectedValue,a=2),i>0&&(e.Join=5==t.Dependancy?"  JOIN "+this.ScreenObject.GetTableName(t.CostCenterID)+" CMJ with(nolock) ON a.lft between  CMJ.lft and CMJ.rgt JOIN COM_CostCenterCostCenterMap CM with(nolock) on CM.CostCenterID="+t.CostCenterID+" and CM.ParentCostCenterID="+a+" and CM.ParentNodeID="+i.toString()+" and CMJ.NodeID=CM.NodeID ":"  JOIN COM_CostCenterCostCenterMap CM with(nolock) on CM.ParentCostCenterID="+t.CostCenterID+" and a.NodeID=CM.ParentNodeID \n                                    JOIN "+this.ScreenObject.GetTableName(a)+" CMJ with(nolock) ON CM.CostCenterID= "+a+"  and CM.NodeID=CMJ.NodeID \n                                    JOIN "+this.ScreenObject.GetTableName(a)+" CMJG with(nolock) ON CMJG.lft between  CMJ.lft and CMJ.rgt and CMJG.NodeID="+i.toString())}else if(this.ScreenObject.GridDataColumns.Contains(t.DependantOn+"_Key")&&!n.e.IsEmpty(s[t.DependantOn+"_Key"])&&parseInt(s[t.DependantOn+"_Key"])>1)i=t.FilterColumn+"="+s[t.DependantOn+"_Key"].toString();else{let e=this.ScreenObject._CCFields.find(e=>e.DBColumnName.toLowerCase()==t.DependantOn.toLowerCase()),s=0,a=0;e&&e instanceof m.b&&e.SelectedValue>0||e&&e instanceof C.a&&e.SelectedValue>0?(s=e.SelectedValue,a=e.CCID):null!=this.ScreenObject.CreditAccount&&this.ScreenObject.CreditAccount.SelectedValue>0&&"creditaccount"==t.DependantOn.toLowerCase()?(s=this.ScreenObject.CreditAccount.SelectedValue,a=2):null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.SelectedValue>0&&"debitaccount"==t.DependantOn.toLowerCase()&&(s=this.ScreenObject.DebitAccount.SelectedValue,a=2),s>0&&(i=t.FilterColumn+"="+s.toString())}if(""!=i.Trim()&&(e.Where=null!=e.FilterCondition&&""!=e.FilterCondition?"and "+i:i),a.a.SessionManager.Preferences.BudgetAccount.length>0&&a.a.SessionManager.Preferences.BudgetDimension.length>0&&e.CostCenterID==this.BudgetObj.iBudgetDimension&&this.BudgetObj.AutoLoadBudgetDimension(s,e),this.IsInventoryVoucher&&this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!n.e.IsEmpty(s.ProductID_Key)&&this.ScreenObject.Preferences.ContainsKey("ProductWiseBins")&&Object(o.j)(this.ScreenObject.Preferences.ProductWiseBins)&&this.ScreenObject.Preferences.ContainsKey("BinsDimension")&&parseInt(this.ScreenObject.Preferences.BinsDimension)==e.CostCenterID){let t,i=" join INV_ProductBins Bin with(nolock) on a.NodeID=Bin.BinNodeID and Bin.NodeID="+n.e.String(s.ProductID_Key)+" and ";if(a.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==a.a.SessionManager.Preferences.EnableLocationWise.toString()&&a.a.SessionManager.Preferences.ContainsKey("LW Bins")&&""!=a.a.SessionManager.Preferences["LW Bins"]&&Object(o.j)(a.a.SessionManager.Preferences["LW Bins"]))if(this.ScreenObject.GridDataColumns.Contains("dcCCNID2_Key"))n.e.IsEmpty(s.dcCCNID2_Key)||(i+=" Bin.Location="+s.dcCCNID2_Key.toString()+" and ");else{let e=this.ScreenObject._CCFields.find(e=>"dcccnid2"==e.DBColumnName.toLowerCase());e&&e instanceof m.b||null!=e&&e instanceof C.a?e.SelectedValue>0&&(i+=" Bin.Location="+e.SelectedValue+" and "):this.ScreenObject.LocationID>0?i+=" Bin.Location="+this.ScreenObject.LocationID+" and ":a.a.SessionManager.LocationID>0&&(i+=" Bin.Location="+a.a.SessionManager.LocationID+" and ")}if(a.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==a.a.SessionManager.Preferences.EnableDivisionWise.toString()&&a.a.SessionManager.Preferences.ContainsKey("DW Bins")&&""!=a.a.SessionManager.Preferences["DW Bins"]&&Object(o.j)(a.a.SessionManager.Preferences["DW Bins"]))if(this.ScreenObject.GridDataColumns.Contains("dcCCNID1_Key"))n.e.IsEmpty(s.dcCCNID1_Key)||(i+=" Bin.Division="+s.dcCCNID1_Key.toString()+" and ");else{let e=this.ScreenObject._CCFields.find(e=>"dcccnid1"==e.DBColumnName.toLowerCase());e&&e instanceof m.b||null!=e&&e instanceof C.a?e.SelectedValue>0&&(i+=" Bin.Division="+e.SelectedValue+" and "):this.ScreenObject.DivisionID>0?i+=" Bin.Division="+this.ScreenObject.DivisionID+" and ":a.a.SessionManager.DivisionID>0&&(i+=" Bin.Division="+a.a.SessionManager.DivisionID+" and ")}if(a.a.SessionManager.Preferences.ContainsKey("DimensionwiseBins")&&""!=a.a.SessionManager.Preferences.DimensionwiseBins&&n.e.IsNum(a.a.SessionManager.Preferences.DimensionwiseBins)&&parseInt(a.a.SessionManager.Preferences.DimensionwiseBins)>5e4)if(t=parseInt(a.a.SessionManager.Preferences.DimensionwiseBins),this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(t-5e4)+"_Key"))n.e.IsEmpty(s["dcCCNID"+(t-5e4)+"_Key"])||(i+=" Bin.DimNodeID="+s["dcCCNID"+(t-5e4)+"_Key"].toString()+" and ");else{let e=this.ScreenObject._CCFields.find(e=>e.DBColumnName.toLowerCase()=="dcccnid"+(t-5e4));e&&e instanceof m.b?e.SelectedValue>0&&(i+=" Bin.DimNodeID="+e.SelectedValue+" and "):e&&e instanceof C.a&&e.SelectedValue>0&&(i+=" Bin.DimNodeID="+e.SelectedValue+" and ")}i+=" Bin.BinDimension="+e.CostCenterID.toString(),e.Join+=i}}else if(65==e.CostCenterID){let t=r;if(""!=t.DependantOn){let i="";if(this.ScreenObject.GridDataColumns.Contains(t.DependantOn+"_Key")&&!n.e.IsEmpty(s[t.DependantOn+"_Key"])&&parseInt(s[t.DependantOn+"_Key"])>1)i="(FeatureID="+t.CostCenterID+" and  FeaturePK="+s[t.DependantOn+"_Key"].toString(),i+=")";else{let e=this.ScreenObject._CCFields.find(e=>e.DBColumnName.toLowerCase()==t.DependantOn.toLowerCase());e&&e instanceof m.b&&e.SelectedValue>0||null!=e&&e instanceof C.a&&e.SelectedValue>0?(i="(FeatureID="+e.CCID+" and  FeaturePK="+e.SelectedValue.toString(),i+=")"):"debitaccount"==t.DependantOn.toLowerCase()&&null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.SelectedValue>0?(i="(FeatureID=2 and  FeaturePK="+this.ScreenObject.DebitAccount.SelectedValue.toString(),i+=")"):"creditaccount"==t.DependantOn.toLowerCase()&&null!=this.ScreenObject.CreditAccount&&this.ScreenObject.CreditAccount.SelectedValue>0&&(i="(FeatureID=2 and  FeaturePK="+this.ScreenObject.CreditAccount.SelectedValue.toString(),i+=")")}e.Where=null!=e.FilterCondition&&""!=e.FilterCondition?"and "+i:i}}else if(7==e.CostCenterID){let t=0,i=0,a=r;if(this.ScreenObject.GridDataColumns.Contains(a.DependantOn+"_Key")&&!n.e.IsEmpty(s[a.DependantOn+"_Key"])&&parseInt(s[a.DependantOn+"_Key"])>1){let e=this.ScreenObject.ColumnSource.find(e=>null!=e.ValueMember&&e.ValueMember.toLowerCase()==a.DependantOn.toLowerCase()+"_key");e&&!n.e.IsEmpty(s[a.DependantOn+"_Key"])&&(i=e.CostCenterID,t=parseInt(s[a.DependantOn+"_Key"]))}else{let e=this.ScreenObject._CCFields.find(e=>e.DBColumnName.toLowerCase()==a.DependantOn.toLowerCase());e&&e instanceof m.b&&e.SelectedValue>0&&(t=e.SelectedValue,i=e.CCID)}t>0&&(e.Join=" JOIN COM_CostCenterCostCenterMap CM with(nolock) on CM.ParentCostCenterID=7 and a.UserID=CM.ParentNodeID \n                                    and CM.CostCenterID="+i+" and CM.NodeID="+t)}else e.ProductID=0}}}OnKeyDown(e,t){if(t.ctrlKey||112!=t.which)if(t.ctrlKey||113!=t.which)if(t.ctrlKey||114!=t.which)if(t.ctrlKey||116!=t.which)if(t.ctrlKey||117!=t.which)if(t.ctrlKey||118!=t.which)if(t.ctrlKey||119!=t.which)if(t.ctrlKey||121!=t.which){if(t.ctrlKey)if(112==t.which){t.preventDefault();let e=this.SelectedRow;null!=this.SelectedRow&&this.IsInventoryVoucher&&!n.e.IsEmpty(e.DocDetailsID)&&0!=parseInt(e.DocDetailsID)?a.a.page.ShowDialog(new pt.DocumentFlowChartViewModel(!0,"LINEID:"+e.DocDetailsID.toString()+"~"+this.ScreenObject.VoucherNo),Ct.DocumentFlowChartComponent):!n.e.IsEmpty(this.ScreenObject.VoucherNo)&&this.ScreenObject.VoucherNo.length>0&&a.a.page.ShowDialog(new pt.DocumentFlowChartViewModel(!0,this.ScreenObject.VoucherNo),Ct.DocumentFlowChartComponent)}else 114==t.which?(t.preventDefault(),this.onEidtQuantity("DistributeQty")):116==t.which?(t.preventDefault(),this.onEidtQuantity("Distribute")):117==t.which?(t.preventDefault(),this.onEidtQuantity("Copy")):118==t.which?(t.preventDefault(),this.onEidtQuantity("DistributeGen")):113==t.which&&(t.preventDefault(),this.onDistDim(this.ScreenObject.GridDataObj.getArgsObj(e)))}else t.preventDefault(),this.onEidtQuantity("Quantity");else t.preventDefault(),this.onShowImage(this.ScreenObject.GridDataObj.getArgsObj(e));else t.preventDefault(),this.onFieldCalc(this.ScreenObject.GridDataObj.getArgsObj(e));else t.preventDefault(),this.onCopy(this.ScreenObject.GridDataObj.getArgsObj(e)),this.ScreenObject.GridDataObj.refreshDatawithIDs();else t.preventDefault(),this.onDistribute(this.ScreenObject.GridDataObj.getArgsObj(e));else t.preventDefault(),this.ScreenObject.GridDataObj.commitEdit(),this.onSearchProduct(this.ScreenObject.GridDataObj.getArgsObj(e));else t.preventDefault(),this.onRoundOff(this.ScreenObject.GridDataObj.getArgsObj(e));else t.preventDefault(),a.a.page.ShowDialog(new Et.a(this),wt.a)}Onshortcut(e,t){switch(e){case"Ctrl+f5":this.onEidtQuantity("Distribute");break;case"Ctrl+f3":this.onEidtQuantity("DistributeQty");break;case"Ctrl+f6":this.onEidtQuantity("Copy");case"Ctrl+f7":this.onEidtQuantity("DistributeGen");break;case"f5":this.onDistribute(t);break;case"Ctrl+f2":this.onDistDim(t);break;case"f6":this.onCopy(t),this.ScreenObject.GridDataObj.refreshDatawithIDs();break;case"f2":this.onRoundOff(t);break;case"f3":this.ScreenObject.GridDataObj.commitEdit(),this.onSearchProduct(t);break;case"f8":this.onShowImage(t);break;case"f7":this.onFieldCalc(t);break;case"f1":a.a.page.ShowDialog(new Et.a(this),wt.a);break;case"Ctrl+f1":let e=this.SelectedRow;null!=this.SelectedRow&&this.IsInventoryVoucher&&!n.e.IsEmpty(e.DocDetailsID)&&0!=parseInt(e.DocDetailsID)?a.a.page.ShowDialog(new pt.DocumentFlowChartViewModel(!0,"LINEID:"+e.DocDetailsID.toString()+"~"+this.ScreenObject.VoucherNo),Ct.DocumentFlowChartComponent):!n.e.IsEmpty(this.ScreenObject.VoucherNo)&&this.ScreenObject.VoucherNo.length>0&&a.a.page.ShowDialog(new pt.DocumentFlowChartViewModel(!0,this.ScreenObject.VoucherNo),Ct.DocumentFlowChartComponent)}}OnFooterKeyDown(e,t){t.ctrlKey||113!=t.which?t.ctrlKey||116!=t.which||this.DistributeFooter(!1,!0):this.onFooterRoundOff(this.ScreenObject.GridDataObj.getArgsObj(e))}FillDt(e,t,s,i,a,r,o){let l=n.e.Double(i);l<0&&(a=!a,l*=-1);let c=e.find(e=>e.AccountID_Key==t&&e.IsRef==s);c?(parseInt(c.CurrencyID)!=r&&(c.CRAmt=parseFloat(c.CRAmt)*parseFloat(c.ExchangeRate),c.DBAmt=parseFloat(c.DBAmt)*parseFloat(c.ExchangeRate),c.CurrencyID=1,c.ExchangeRate=1,l*=o),a?c.CRAmt=parseFloat(c.CRAmt)+l:c.DBAmt=parseFloat(c.DBAmt)+l):(c={},c.AccountID_Key=t,c.IsRef=s,c.CurrencyID=r,c.ExchangeRate=o,a?(c.CRAmt=l,c.DBAmt=0):(c.DBAmt=l,c.CRAmt=0),e.push(c))}GenerateLinkClick(){if(this.ScreenObject.Data.Tables.length>20){let e=this.ScreenObject.Data.Tables[20].filter(e=>e.CostCenterIDBase>4e4);if(1==e.length)new Promise((t,s)=>{this.genLinkResolve=t,this.GenerateLinkDocument(parseInt(e[0].CostCenterIDBase))}).then(e=>{e||a.a.page.ShowDialog(new k.b(this),_.a)});else if(e.length>1){let t=new U.a;t.GoToLineViewModel_3(this,e,0),a.a.page.ShowDialog(t,X.a,{ShowCenter:!0,NoWidth:!0})}}}GenerateLinkDocument(e){let t;t=this.ScreenObject.Preferences.ContainsKey("PromptDim")&&Object(o.j)(this.ScreenObject.Preferences.PromptDim)?new es(e,"",!1):new es(e,"",!1,this),t.DocumentNumber&&t.DocumentNumber.DialogOptions?t.ToLinkParent=this:this.GenerateLinkDocument_Sub1(t)}GenerateLinkDocument_Sub1(e){if(!e.DialogResult)return this.genLinkResolve&&this.genLinkResolve(!1),!1;if((e.ScreenObject.Preferences.ContainsKey("Debit Account")&&Object(o.j)(e.ScreenObject.Preferences["Debit Account"])||e.ScreenObject.Preferences.ContainsKey("LinkVendorProducts")&&Object(o.j)(e.ScreenObject.Preferences.LinkVendorProducts))&&null!=e.ScreenObject.DebitAccount)if(10==e.DocumentType&&null!=this.ScreenObject.CreditAccount)e.ScreenObject.DebitAccount.SelectedValue=this.ScreenObject.CreditAccount.SelectedValue;else if(null!=this.ScreenObject.DebitAccount)e.ScreenObject.DebitAccount.SelectedValue=this.ScreenObject.DebitAccount.SelectedValue;else if(this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")){let t=this.ScreenObject.ColumnSource.find(e=>!n.e.IsEmpty(e.ValueMember)&&"creditaccount_key"==e.ValueMember.toLowerCase()),s="";for(let e=0;e<this.ScreenObject.GridData.length;e++)n.e.IsEmpty(this.ScreenObject.GridData[e].DebitAccount_Key)||(s+=this.ScreenObject.GridData[e].DebitAccount_Key.toString()+",");s.length>0&&(s=" a.accountid in("+s.substr(0,s.length-1)+")");let i=new U.a;i.GoToLineViewModel_4(this,2,2),t&&(i.Title="Select "+t.Header,i.Label=t.Header),i.Dimension.CustomWhere=s,a.a.page.ShowDialog(i,X.a),i.Dimension.SelectedValue>0&&(e.ScreenObject.DebitAccount.SelectedValue=i.Dimension.SelectedValue)}if((e.ScreenObject.Preferences.ContainsKey("Credit Account")&&Object(o.j)(e.ScreenObject.Preferences["Credit Account"])||e.ScreenObject.Preferences.ContainsKey("LinkVendorProducts")&&Object(o.j)(e.ScreenObject.Preferences.LinkVendorProducts))&&null!=e.ScreenObject.CreditAccount)if(6==e.DocumentType&&null!=this.ScreenObject.DebitAccount)e.ScreenObject.CreditAccount.SelectedValue=this.ScreenObject.DebitAccount.SelectedValue;else if(null!=this.ScreenObject.CreditAccount)e.ScreenObject.CreditAccount.SelectedValue=this.ScreenObject.CreditAccount.SelectedValue;else if(this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")){let t=this.ScreenObject.ColumnSource.find(e=>!n.e.IsEmpty(e.ValueMember)&&"creditaccount_key"==e.ValueMember.toLowerCase()),s="";for(let e=0;e<this.ScreenObject.GridData.length;e++)n.e.IsEmpty(this.ScreenObject.GridData[e].CreditAccount_Key)||(s+=this.ScreenObject.GridData[e].CreditAccount_Key.toString()+",");s.length>0&&(s=" a.accountid in("+s.substr(0,s.length-1)+")");let i=new U.a;i.GoToLineViewModel_4(this,2,2),t&&(i.Title="Select "+t.Header,i.Label=t.Header),i.Dimension.CustomWhere=s,a.a.page.ShowDialog(i,X.a),i.Dimension.SelectedValue>0&&(e.ScreenObject.CreditAccount.SelectedValue=i.Dimension.SelectedValue)}if(e.ScreenObject.Preferences.ContainsKey("DimensionWise")&&""!=e.ScreenObject.Preferences.DimensionWise&&e.ScreenObject.Preferences.DimensionWise.split(",").forEach(t=>{if(""!=t){let s=parseInt(t);if(3==s){let t=e.ScreenObject._TextFields.find(e=>e instanceof m.b&&3==e.CCID);if(t){let e=this.ScreenObject._TextFields.find(e=>e instanceof m.b&&3==e.CCID);e&&e.SelectedValue>0&&(t.SelectedValue=e.SelectedValue)}}else if(s>5e4){let t=e.ScreenObject._CCFields.find(e=>e instanceof m.b&&e.CCID==s);if(t){let e=this.ScreenObject._CCFields.find(e=>e instanceof m.b&&e.CCID==s);null!=e&&e.SelectedValue>0&&(t.SelectedValue=e.SelectedValue)}}}}),null!=e.ScreenObject.Link&&null!=e.ScreenObject.Link.LinkCombo){if(1==e.ScreenObject.Link.LinkCombo.Items.length)e.ScreenObject.Link.LinkCombo.SelectedValue=e.ScreenObject.Link.LinkCombo.Items[0].Value,e.OLinkSelectionChanged(null);else{let t=e.ScreenObject.Link.LinkCombo.Items.find(e=>null!=e.Parent&&e.Parent==this.CostCenterID.toString());t&&(e.ScreenObject.Link.LinkCombo.SelectedValue=t.Value,e.OLinkSelectionChanged(null))}let t=e.ScreenObject.Link.DocumentList.Items.find(e=>e.Value==this.ScreenObject.DocID.toString());if(!t)return this.genLinkResolve&&this.genLinkResolve(!1),!1;if(t.IsChecked=!0,e.IsFirstCallSelective=!0,e.OnLinkDocumentCheckedChanged(t),!e.DialogResult)return this.genLinkResolve&&this.genLinkResolve(!1),!1}return e.RefreshGridFooter||(e.RefreshGridFooter=!0),a.a.page.addNewTab({component:B.AddEditDocumentComponent,params:{obj:e}}),this.genLinkResolve&&this.genLinkResolve(!0),!0}PrepareJV(){let e=[],t=[];t.push("AccountCode"),t.push("AccountID"),t.push("AccountID_Key"),t.push("CRAmt"),t.push("DBAmt"),t.push("IsRef"),t.push("CurrencyID"),t.push("ExchangeRate"),t.push("CRAmtFC"),t.push("DBAmtFC");let s=!0;this.ScreenObject.Preferences.ContainsKey("DonotupdateAccounts")&&""!=this.ScreenObject.Preferences.DonotupdateAccounts&&(s=Object(o.j)(this.ScreenObject.Preferences.DonotupdateAccounts));let i=1,r=1;for(let a=0;a<this.ScreenObject.GridData.length;a++)for(let t=0;t<this.ScreenObject.ColumnSource.length;t++)if(i=this.GetCurrencyID(a),r=this.GetExchRate(a),3==this.ScreenObject.ColumnSource[t].SectionID&&!s&&(3==this.ScreenObject.ColumnSource[t].PostingType||4==this.ScreenObject.ColumnSource[t].PostingType)||!this.IsInventoryVoucher&&(3==this.ScreenObject.ColumnSource[t].PostingType||4==this.ScreenObject.ColumnSource[t].PostingType||"amount"==this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase()||"debitamount"==this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase()||"creditamount"==this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase())){let s=n.e.String(this.ScreenObject.GridData[a][this.ScreenObject.ColumnSource[t].DisplayMember]);if(this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase().Contains("dcnum")&&(s=n.e.String(this.ScreenObject.GridData[a]["dcCalc"+this.ScreenObject.ColumnSource[t].DisplayMember]),this.ScreenObject.GridDataColumns.Contains("dcExchRT"+this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase().replace("dcnum","").toString())&&this.ScreenObject.GridDataColumns.Contains("dcCurrID"+this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase().replace("dcnum","").toString()+"_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[a]["dcCurrID"+this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase().replace("dcnum","").toString()+"_Key"])&&(i=parseInt(this.ScreenObject.GridData[a]["dcCurrID"+this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase().replace("dcnum","").toString()+"_Key"]),r=parseFloat(this.ScreenObject.GridData[a]["dcExchRT"+this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase().replace("dcnum","").toString()]))),""!=s&&0!=n.e.Double(s)){let o=0,l=0,c=!1,h=!1;this.ScreenObject.ColumnSource[t].DrRefColID>0?(o=this.ScreenObject.ColumnSource[t].DrRefColID,h=!0):this.ScreenObject.ColumnSource[t].DebitAccount>0?o=this.ScreenObject.ColumnSource[t].DebitAccount:null!=this.ScreenObject.DebitAccount?o=this.ScreenObject.DebitAccount.SelectedValue:this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[a].DebitAccount_Key)&&(o=parseInt(this.ScreenObject.GridData[a].DebitAccount_Key)),this.ScreenObject.ColumnSource[t].CrRefColID>0?(l=this.ScreenObject.ColumnSource[t].CrRefColID,c=!0):this.ScreenObject.ColumnSource[t].CreditAcount>0?l=this.ScreenObject.ColumnSource[t].CreditAcount:null!=this.ScreenObject.CreditAccount?l=this.ScreenObject.CreditAccount.SelectedValue:this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[a].CreditAccount_Key)&&(l=parseInt(this.ScreenObject.GridData[a].CreditAccount_Key)),this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[a].AccountID_Key)&&"debitamount"==this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase()&&!n.e.IsEmpty(this.ScreenObject.GridData[a].DebitAmount)&&parseFloat(this.ScreenObject.GridData[a].DebitAmount)>0&&(o=parseInt(this.ScreenObject.GridData[a].AccountID_Key)),this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[a].AccountID_Key)&&"creditamount"==this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase()&&!n.e.IsEmpty(this.ScreenObject.GridData[a].CreditAmount)&&parseFloat(this.ScreenObject.GridData[a].CreditAmount)>0&&(l=parseInt(this.ScreenObject.GridData[a].AccountID_Key)),l>0&&this.FillDt(e,l.toString(),c,s,!0,i,r),o>0&&this.FillDt(e,o.toString(),h,s,!1,i,r)}}for(let a=0;a<this.ScreenObject.FooterGridData.length;a++){let t=0,o=this.ScreenObject.ColumnSource.find(e=>e.DisplayMember==n.e.String(this.ScreenObject.FooterGridData[a].ColumnName));if(t=n.e.Double(this.ScreenObject.FooterGridData[a].CalcAmount),o&&0!=t&&!s&&(3==o.PostingType||4==o.PostingType)){this.ScreenObject.FooterColumnSource.length>4&&this.ScreenObject.FooterColumnSource[4].IsVisible&&!n.e.IsEmpty(this.ScreenObject.FooterGridData[a].CreditAccount)&&parseInt(this.ScreenObject.FooterGridData[a].CreditAccount)>0&&(o.CreditAcount=parseInt(this.ScreenObject.FooterGridData[a].CreditAccount));let s=0,l=0,c=!1,h=!1;if(o.DrRefColID>0)s=o.DrRefColID,h=!0;else if(this.ScreenObject.FooterColumnSource.length>3&&this.ScreenObject.FooterColumnSource[3].IsVisible&&!n.e.IsEmpty(this.ScreenObject.FooterGridData[a].DebitAccount)&&parseInt(this.ScreenObject.FooterGridData[a].DebitAccount)>0)s=parseInt(this.ScreenObject.FooterGridData[a].DebitAccount);else if(o.DebitAccount>0)s=o.DebitAccount;else if(null!=this.ScreenObject.DebitAccount)s=this.ScreenObject.DebitAccount.SelectedValue;else if(this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")){this.DistributeValues("dcCalc"+o.DisplayMember,t,""!=o.DistributeColName?o.DistributeColName:"Gross",!1);for(let t=0;t<this.ScreenObject.GridData.length;t++)n.e.IsEmpty(this.ScreenObject.GridData[t].ProductID_Key)||n.e.IsEmpty(this.ScreenObject.GridData[t].DebitAccount_Key)||n.e.IsEmpty(this.ScreenObject.GridData[t]["dcCalc"+o.DisplayMember])||(this.ScreenObject.GridDataColumns.Contains("dcExchRT"+o.DisplayMember.toLowerCase().replace("dcnum","").toString())&&this.ScreenObject.GridDataColumns.Contains("dcCurrID"+o.DisplayMember.toLowerCase().replace("dcnum","").toString()+"_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[t]["dcCurrID"+o.DisplayMember.toLowerCase().replace("dcnum","").toString()+"_Key"])&&(i=parseInt(this.ScreenObject.GridData[t]["dcCurrID"+o.DisplayMember.toLowerCase().replace("dcnum","").toString()+"_Key"].toString()),r=parseFloat(this.ScreenObject.GridData[t]["dcExchRT"+o.DisplayMember.toLowerCase().replace("dcnum","").toString()].toString())),this.FillDt(e,this.ScreenObject.GridData[t].DebitAccount_Key.toString(),!1,this.ScreenObject.GridData[t]["dcCalc"+o.DisplayMember].toString(),!1,i,r))}if(o.CrRefColID>0)l=o.CrRefColID,c=!0;else if(this.ScreenObject.FooterColumnSource.length>4&&this.ScreenObject.FooterColumnSource[4].IsVisible&&!n.e.IsEmpty(this.ScreenObject.FooterGridData[a].CreditAccount)&&parseInt(this.ScreenObject.FooterGridData[a].CreditAccount)>0)l=parseInt(this.ScreenObject.FooterGridData[a].CreditAccount);else if(o.CreditAcount>0)l=o.CreditAcount;else if(null!=this.ScreenObject.CreditAccount)l=this.ScreenObject.CreditAccount.SelectedValue;else if(this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")){this.DistributeValues("dcCalc"+o.DisplayMember,t,""!=o.DistributeColName?o.DistributeColName:"Gross",!1);for(let t=0;t<this.ScreenObject.GridData.length;t++)n.e.IsEmpty(this.ScreenObject.GridData[t].ProductID_Key)||n.e.IsEmpty(this.ScreenObject.GridData[t].CreditAccount_Key)||n.e.IsEmpty(this.ScreenObject.GridData[t]["dcCalc"+o.DisplayMember])||(this.ScreenObject.GridDataColumns.Contains("dcExchRT"+o.DisplayMember.toLowerCase().replace("dcnum","").toString())&&this.ScreenObject.GridDataColumns.Contains("dcCurrID"+o.DisplayMember.toLowerCase().replace("dcnum","").toString()+"_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[t]["dcCurrID"+o.DisplayMember.toLowerCase().replace("dcnum","").toString()+"_Key"])&&(i=parseInt(this.ScreenObject.GridData[t]["dcCurrID"+o.DisplayMember.toLowerCase().replace("dcnum","").toString()+"_Key"].toString()),r=parseFloat(this.ScreenObject.GridData[t]["dcExchRT"+o.DisplayMember.toLowerCase().replace("dcnum","").toString()].toString())),this.FillDt(e,this.ScreenObject.GridData[t].CreditAccount_Key.toString(),!1,this.ScreenObject.GridData[t]["dcCalc"+o.DisplayMember].toString(),!0,i,r))}this.ScreenObject.FooterGridDataColumns.Contains("dcCurrID_Key")&&("-3"==n.e.String(this.ScreenObject.FooterGridData[a].dcCurrID_Key)?(i=o.CurrID,r=o.ExhcgRt):"-1"!=n.e.String(this.ScreenObject.FooterGridData[a].dcCurrID_Key)||null==this.Currency||n.e.IsEmpty(this.Currency.Currency.SelectedValue)?""!=n.e.String(this.ScreenObject.FooterGridData[a].dcCurrID_Key)&&(i=parseInt(this.ScreenObject.FooterGridData[a].dcCurrID_Key.toString()),r=parseFloat(this.ScreenObject.FooterGridData[a].dcExchRT.toString())):(i=parseInt(this.Currency.Currency.SelectedValue),r=parseFloat(this.Currency.ExchangeRate.Text))),l>0&&this.FillDt(e,l.toString(),c,t.toString(),!0,i,r),s>0&&this.FillDt(e,s.toString(),h,t.toString(),!1,i,r)}}if(null!=this.POSPayModes&&this.POSPayModes.GridData.length>0){let t,a=[];for(let e=0;e<this.POSPayModes.GridData.length;e++){if(n.e.IsEmpty(this.POSPayModes.GridData[e].ColumnName))continue;"13"==this.POSPayModes.GridData[e].Type.toString()&&(this.POSPayModes.RedeemPoints=parseFloat(this.POSPayModes.GridData[e].Amount));let s=a.filter(t=>t.ColumnName==this.POSPayModes.GridData[e].ColumnName);0==s.length?(t={},t.Name=this.POSPayModes.GridData[e].Name.toString(),t.ColumnName=this.POSPayModes.GridData[e].ColumnName.toString(),t.Amount=this.POSPayModes.GridData[e].Amount.toString(),t.Description=this.POSPayModes.GridData[e].Description.toString(),t.Details=this.POSPayModes.GridData[e].Details.toString(),t.Denomination=n.e.StringValue(this.POSPayModes.GridData[e].Denomination),a.push(t)):(t=s[0],t.Amount=parseFloat(t.Amount)+parseFloat(this.POSPayModes.GridData[e].Amount),t.Details=t.Details.toString()+this.POSPayModes.GridData[e].Details.toString(),t.Denomination=n.e.StringValue(t.Denomination)+n.e.StringValue(this.POSPayModes.GridData[e].Denomination))}n.e.IsEmpty(this.POSPayModes.Return)||!n.e.IsNum(this.POSPayModes.Return)||n.e.IsEmpty(this.POSPayModes.Returnfld)||(t={},t.Name=this.POSPayModes.ReturnLabel,t.ColumnName=this.POSPayModes.Returnfld,t.Amount=this.POSPayModes.Return.replace("-",""),this.POSpayXml='<XML Amount="'+t.Amount.toString()+'" DBColumnName="'+this.POSPayModes.Returnfld+'" ',this.POSpayXml+=' RegisterID="'+this.ScreenObject.RegisterNodeID+'" ',this.POSpayXml+=' ShiftID="'+this.ScreenObject.ShiftNodeID+'" ',this.POSpayXml+=' DocDate="'+this.DocumentDate.ToString("dd/MMM/yyyy")+'" ',this.POSpayXml+=' Type="12" />',t.Details=this.POSpayXml,a.push(t),this.POSpayXml="");for(let o=0;o<a.length;o++){let t=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName==a[o].ColumnName);if(!(s||"3"!=t[0].PostingType.toString()&&"4"!=t[0].PostingType.toString()||n.e.IsEmpty(a[o].Amount)||0==parseFloat(a[o].Amount))){let s=0,l=0,c=!1,h=!1;n.e.IsEmpty(t[0].DrRefColID)?n.e.IsEmpty(t[0].DebitAccount)?null!=this.ScreenObject.DebitAccount&&(s=this.ScreenObject.DebitAccount.SelectedValue):s=parseInt(t[0].DebitAccount):(s=parseInt(t[0].DrRefColID),h=!0),n.e.IsEmpty(t[0].CrRefColID)?n.e.IsEmpty(t[0].CreditAccount)?null!=this.ScreenObject.CreditAccount&&(l=this.ScreenObject.CreditAccount.SelectedValue):l=parseInt(t[0].CreditAccount):(l=parseInt(t[0].CrRefColID),c=!0),l>0&&this.FillDt(e,l.toString(),c,a[o].Amount.toString(),!0,i,r),s>0&&this.FillDt(e,s.toString(),h,a[o].Amount.toString(),!1,i,r)}}}let l="2";a.a.SessionManager.Preferences.ContainsKey("DecimalsinAmount")&&(l=a.a.SessionManager.Preferences.DecimalsinAmount);let c=[],h="",u="";for(let a=0;a<e.length;a++){let t=e[a];if(parseFloat(t.CRAmt)>0&&parseFloat(t.DBAmt)>0)if(parseFloat(t.CRAmt)>parseFloat(t.DBAmt)){if(0==parseFloat((parseFloat(t.CRAmt)-parseFloat(t.DBAmt)).ToString("N2"))){c.push(t);continue}t.CRAmt=parseFloat(t.CRAmt)-parseFloat(t.DBAmt),t.DBAmt=0}else if(parseFloat(t.DBAmt)>parseFloat(t.CRAmt)){if(0==parseFloat((parseFloat(t.DBAmt)-parseFloat(t.CRAmt)).ToString("N2"))){c.push(t);continue}t.DBAmt=parseFloat(t.DBAmt)-parseFloat(t.CRAmt),t.CRAmt=0}else if(parseFloat(t.DBAmt)==parseFloat(t.CRAmt)){c.push(t);continue}parseFloat(t.CRAmt)>0&&(t.CRAmt=parseFloat(t.CRAmt).ToString("N"+l)),parseFloat(t.DBAmt)>0&&(t.DBAmt=parseFloat(t.DBAmt).ToString("N"+l)),parseFloat(t.DBAmt)!=parseFloat(t.CRAmt)?!n.e.IsEmpty(t.IsRef)&&Object(o.j)(t.IsRef)?(""!=u&&(u+=","),u+=t.AccountID_Key.toString()):(""!=h&&(h+=","),h+=t.AccountID_Key.toString()):c.push(t)}""==h&&(h="0");let d=this.ScreenObject.GetNames(h,u);if(null!=d&&d.Tables.length>0&&!d.Columns[0].Contains("ErrorMessage")){let t;e.forEach(e=>{Object(o.j)(e.IsRef)&&d.Tables.length>1?(t=d.Tables[1].filter(t=>t.CostCenterColID==e.AccountID_Key),t.length>0&&(e.AccountID=t[0][Object.keys(t[0])[1]].toString(),e.AccountCode=t[0][Object.keys(t[0])[1]].toString())):(t=d.Tables[0].filter(t=>t.AccountId==e.AccountID_Key),t.length>0&&(e.AccountID=t[0][Object.keys(t[0])[1]].toString(),e.AccountCode=t[0][Object.keys(t[0])[2]].toString()))})}c.forEach(t=>{e.Remove(t)});let D=new v.ShowJVViewModel;D.ShowJVViewModel_3(e),a.a.page.ShowDialog(D,x.ShowJVComponent,{ShowCenter:!0,Title:D.Title})}onButtonClick(e){var t,r;return Object(i.b)(this,void 0,void 0,(function*(){if(this.isCheckIn=this.isCheckOut=!1,(null===(t=this.ScreenObject.GridDataObj.angularGrid)||void 0===t?void 0:t.slickGrid)&&(null===(r=this.ScreenObject.GridDataObj.angularGrid)||void 0===r?void 0:r.slickGrid.getActiveCellNode())){let e=this.ScreenObject.GridDataObj.angularGrid.slickGrid.getActiveCell();e&&0===e.cell&&0===e.row||this.ScreenObject.GridDataObj.angularGrid.slickGrid.gotoCell(0,0),this.ScreenObject.GridDataObj.angularGrid.slickGrid.getEditorLock().commitCurrentEdit()}if(this.ButtonsPopUp=!1,e instanceof m.b||e instanceof C.a){let t=null;e instanceof m.b?t=e:e instanceof C.a&&(t=e.Name,t.Label=e.Label);let s=new m.b;s.CCID=t.CCID,s.TypeID=t.TypeID,s.CustomWhere=t.CustomWhere,t.IsReadOnly=!1;let i=new Ye.PactListSearchViewModel(t);return void a.a.page.ShowDialog(i,bt.a,{ShowCenter:!0})}let i;if("CancelDialog"==e.toString())a.a.page.HideDialog();else if("Cancel"==e.toString())this.SetVisibiltiFalse(),this.IsPOs?this.ProductSearchVisibility=!0:this.SetDefaultRightPanel();else{if(this.Unit_keyOnBeginEditValue="",this.Unit_keyOnBeginEditText="",e.toString().startsWith("Documents "))return e=e.toString().replace("Documents ",""),void this.OnDocLinkClick(e);if(e.toString().startsWith("Reports "))return e=e.toString().replace("Reports ",""),void this.OnReportsLinkClick(e);if(85==this.DocumentType&&a.a.SessionManager.Preferences.ContainsKey("ConsiderGradeWiseSalarySlabs")&&"True"==a.a.SessionManager.Preferences.ConsiderGradeWiseSalarySlabs&&("PickMin"==e.toString()||"PickMax"==e.toString())){let t=0,s=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());if(null!=s&&null!=s){if(s instanceof C.a&&0==s.SelectedValue)return this.DisplayMessage="Select Employee First, and Employee should be in Header",void(this.MessageVisibility=!0);t=s.SelectedValue}t>0&&(this.ScreenObject.GridDataObj.Clear(),this.FillComponentsBasedOnGradeSlabs(t,e.toString()))}if(68==this.DocumentType&&"Save"==e.toString()){let e=new Date,t=new Date,s=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase());if(e=s.Date,s=this.ScreenObject._TextFields.find(e=>"dcalpha4"==e.DBColumnName.toLowerCase()),t=s.Date,e>t)return this.DisplayMessage="'From Payroll Month' should be less than or equal to 'To Payroll Month'",void(this.MessageVisibility=!0)}let t,r,u;switch(e.toString()){case"next":this.GetData("Next");break;case"prev":this.GetData("Previous");break;case"Load":this.LoadDailyAttendanceDocuments();break;case"Check-in":{let e,t={Flag:"",Msg:""};if(this.isCheckIn=!0,console.log("BaseService.SessionManager.EnableGOLOC =>",a.a.SessionManager.EnableGOLOC),"Yes"==a.a.SessionManager.EnableGOLOC&&(e=yield zt.a.getCurrentPosition()),89==this.DocumentType||90==this.DocumentType){let s="",i="",r=this.ScreenObject._TextFields.find(e=>"dcalpha26"==e.DBColumnName.toLowerCase());if(r&&!r.Date)return void(this.DisplayMessage="Select Date then Check-in");if(s=r.Date.ToString(!a.a.IsAndroid&&a.a.IsNativeMobile?"dd-MMM-yyyy":"dd/MMM/yyyy"),new Date(s).Date()>Date.Today())return void(this.DisplayMessage="Can not allow future dates");if(r=this.ScreenObject._TextFields.find(e=>"dcalpha27"==e.DBColumnName.toLowerCase()),r&&!r.Date)return void(this.DisplayMessage="Select Time then Check-in");i=r.Date.ToString("HH:mm");let o=-1;if(89==this.DocumentType)o=0;else if(this.ScreenObject.SelectedGridRowIndex>=0){if(!confirm("Are you sure want to update the selected row.?"))return;o=this.ScreenObject.SelectedGridRowIndex}else for(let e=0;e<this.ScreenObject.GridData.length;e++)if(n.e.IsEmpty(this.ScreenObject.GridData[e].dcAlpha1_Key)&&n.e.IsEmpty(this.ScreenObject.GridData[e].dcAlpha3_Key)){o=e;break}let l="ProductID_Key",c=this.ScreenObject.ColumnSource.find(e=>null!=e.ValueMember&&e.ValueMember.toLowerCase()==l.toLowerCase());c&&l&&!n.e.IsEmpty(c.DefaultValue)&&null!=c.DefaultValueText&&(n.e.Int(c.DefaultValue)>0||-100==n.e.Int(c.DefaultValue))&&(this.ScreenObject.GridData[o].ProductID_Key=c.DefaultValue),this.ScreenObject.GridData[o].Type=1,this.ScreenObject.GridData[o].dcAlpha1=new Date(s).ToString(a.a.SessionManager.Preferences["Date Format"]),this.ScreenObject.GridData[o].dcAlpha1_Key=new Date(s),this.ScreenObject.GridData[o].dcAlpha2=i,this.ScreenObject.GridData[o].dcAlpha2_Key=new Date(s+" "+i),this.ScreenObject.GridData[o].dcAlpha14=n.e.CurrentTimeZoneName(),n.e.IsEmpty(this.ScreenObject.GridData[o].dcAlpha8)&&(this.ScreenObject.GridData[o].dcAlpha8="Web");let u=a.a.common.GetDataSet("PAY042","").Tables[0];if(this.ScreenObject.GridData[o].dcAlpha28=new Date(u[0].UTCDateTime).ToLocalTime().ToString(a.a.SessionManager.Preferences["Date Format"]),this.ScreenObject.GridData[o].dcAlpha28_Key=new Date(u[0].UTCDateTime).ToLocalTime(),this.ScreenObject.GridData[o].dcAlpha29=new Date(u[0].UTCDateTime).ToLocalTime().ToString("HH:mm"),this.ScreenObject.GridData[o].dcAlpha29_Key=new Date(u[0].UTCDateTime).ToLocalTime(),this.ScreenObject.GridDataObj.updateRow(this.ScreenObject.GridData[o]),this.Celleditend(this.ScreenObject.GridData[o],"dcAlpha1",0),"No"==a.a.SessionManager.EnableGOLOC)return void this.SaveInventoryDocument("Save",!0);console.log("coordinates.coords.latitude (Check In)"+e.coords.latitude),console.log("coordinates.coords.longitude (Check In)"+e.coords.longitude),console.log("EmpAccessibility In ");try{this.EmpAccessibility(a.a.SessionManager.iEmployee,e.coords.latitude,e.coords.longitude,t)}catch(h){console.log("Check in Exception:EmpAccessibility"+h)}if(console.log("EmpAccessibility out "),"200"!=t.Flag)return this.DisplayMessage=t.Msg,void alert(t.Msg);if("200"==t.Flag)if(a.a.IsNativeMobile){let e=yield n.e.UserCurrentLocation();console.log("Response GetUsersCurrentAddress Response Obj = "+e),console.log("Response locationobj.coords.latitude = "+e.coords.latitude),n.e.IsEmpty(e)||(this.ScreenObject.GridData[o].dcAlpha6=e.coords.latitude,this.ScreenObject.GridData[o].dcAlpha7=e.coords.longitude,null!=e.address&&(this.ScreenObject.GridData[o].dcAlpha10=e.address.Address1,this.ScreenObject.GridData[o].dcAlpha11=e.address.Address2,this.ScreenObject.GridData[o].dcAlpha12=e.address.City,this.ScreenObject.GridData[o].dcAlpha13=e.address.State,this.ScreenObject.GridData[o].dcAlpha14=e.address.Country,this.ScreenObject.GridData[o].dcAlpha15=e.address.PinCode))}else{let t=yield n.e.GetUsersCurrentAddress(e);console.log("GetUsersCurrentAddress Response Address = "+t.results[0].formatted),n.e.IsEmpty(t)?console.log("location not detected"):(this.ScreenObject.GridData[o].dcAlpha6=e.coords.latitude,this.ScreenObject.GridData[o].dcAlpha7=e.coords.longitude,n.e.IsEmpty(t.status)||200!=t.status.code||(this.ScreenObject.GridData[o].dcAlpha10=t.results[0].formatted,this.ScreenObject.GridData[o].dcAlpha11=t.results[0].formatted,this.ScreenObject.GridData[o].dcAlpha12=t.results[0].components.city,this.ScreenObject.GridData[o].dcAlpha13=t.results[0].components.state,this.ScreenObject.GridData[o].dcAlpha14=t.results[0].components.country,this.ScreenObject.GridData[o].dcAlpha15=t.results[0].components.postcode))}}"200"==t.Flag&&(this.SaveInventoryDocument("Save",!0),console.log("this.SaveInventoryDocument('Save', true); "));break}case"Check-out":{this.isCheckOut=!0;let e,t={Flag:"",Msg:""};if(console.log("BaseService.SessionManager.EnableGOLOC =>",a.a.SessionManager.EnableGOLOC),"Yes"==a.a.SessionManager.EnableGOLOC&&(e=yield zt.a.getCurrentPosition()),89==this.DocumentType||90==this.DocumentType){let s="",i="",r=this.ScreenObject._TextFields.find(e=>"dcalpha26"==e.DBColumnName.toLowerCase());if(r&&!r.Date)return void(this.DisplayMessage="Select Date then Check-out");if(s=r.Date.ToString(!a.a.IsAndroid&&a.a.IsNativeMobile?"dd-MMM-yyyy":"dd/MMM/yyyy"),new Date(s).Date()>Date.Today())return void(this.DisplayMessage="Can not allow future dates");if(r=this.ScreenObject._TextFields.find(e=>"dcalpha27"==e.DBColumnName.toLowerCase()),r&&!r.Date)return void(this.DisplayMessage="Select Time then Check-out");i=r.Date.ToString("HH:mm");let o=-1;if(89==this.DocumentType)o=0;else if(this.ScreenObject.SelectedGridRowIndex>=0){if(!confirm("Are you sure want to update the selected row.?"))return;if(n.e.IsEmpty(this.ScreenObject.GridData[this.ScreenObject.SelectedGridRowIndex].dcAlpha1_Key))return void(this.DisplayMessage="Enter Check-in Date and Time first for the selected row.");o=this.ScreenObject.SelectedGridRowIndex}else for(let e=this.ScreenObject.GridData.length-1;e>=0;e--)if(!n.e.IsEmpty(this.ScreenObject.GridData[e].dcAlpha1_Key)||!n.e.IsEmpty(this.ScreenObject.GridData[e].dcAlpha3_Key)){o=n.e.IsEmpty(this.ScreenObject.GridData[e].dcAlpha3_Key)?e:e+1;break}let l="ProductID_Key",c=this.ScreenObject.ColumnSource.find(e=>null!=e.ValueMember&&e.ValueMember.toLowerCase()==l.toLowerCase());c&&l&&!n.e.IsEmpty(c.DefaultValue)&&!n.e.IsEmpty(c.DefaultValueText)&&(n.e.Int(c.DefaultValue)>0||-100==n.e.Int(c.DefaultValue))&&(this.ScreenObject.GridData[o].ProductID_Key=c.DefaultValue),this.ScreenObject.GridData[o].Type=1,this.ScreenObject.GridData[o].dcAlpha3=new Date(s).ToString(a.a.SessionManager.Preferences["Date Format"]),this.ScreenObject.GridData[o].dcAlpha3_Key=new Date(s),this.ScreenObject.GridData[o].dcAlpha4=new Date(s+" "+i).ToString("HH:mm"),this.ScreenObject.GridData[o].dcAlpha4_Key=new Date(s+" "+i),this.ScreenObject.GridData[o].dcAlpha24=n.e.CurrentTimeZoneName(),(null==this.ScreenObject.GridData[o].dcAlpha18||null==this.ScreenObject.GridData[o].dcAlpha18||n.e.IsEmpty(this.ScreenObject.GridData[o].dcAlpha18))&&(this.ScreenObject.GridData[o].dcAlpha18="Web");let u=a.a.common.GetDataSet("PAY042","").Tables[0];if(this.ScreenObject.GridData[o].dcAlpha30=new Date(u[0].UTCDateTime).ToLocalTime().ToString(a.a.SessionManager.Preferences["Date Format"]),this.ScreenObject.GridData[o].dcAlpha30_Key=new Date(u[0].UTCDateTime).ToLocalTime(),this.ScreenObject.GridData[o].dcAlpha31=new Date(u[0].UTCDateTime).ToLocalTime().ToString("HH:mm"),this.ScreenObject.GridData[o].dcAlpha31_Key=new Date(u[0].UTCDateTime).ToLocalTime(),this.ScreenObject.GridDataObj.updateRow(this.ScreenObject.GridData[o]),this.Celleditend(this.ScreenObject.GridData[o],"dcAlpha3",0),"No"==a.a.SessionManager.EnableGOLOC)return void this.SaveInventoryDocument("Save",!0);console.log("coordinates.coords.latitude (Check In)"+e.coords.latitude),console.log("coordinates.coords.longitude (Check In)"+e.coords.longitude),console.log("EmpAccessibility In ");try{this.EmpAccessibility(a.a.SessionManager.iEmployee,e.coords.latitude,e.coords.longitude,t)}catch(h){console.log("Check Out Exception:EmpAccessibility"+h)}if(console.log("EmpAccessibility out "),"200"!=t.Flag)return this.DisplayMessage=t.Msg,void alert(t.Msg);if(a.a.IsNativeMobile){let e=yield n.e.UserCurrentLocation();console.log("Response GetUsersCurrentAddress Response Obj = "+e),console.log("Response locationobj.coords.latitude = "+e.coords.latitude),n.e.IsEmpty(e)||(this.ScreenObject.GridData[o].dcAlpha16=e.coords.latitude,this.ScreenObject.GridData[o].dcAlpha17=e.coords.longitude,null!=e.address&&(this.ScreenObject.GridData[o].dcAlpha20=e.address.Address1,this.ScreenObject.GridData[o].dcAlpha21=e.address.Address2,this.ScreenObject.GridData[o].dcAlpha22=e.address.City,this.ScreenObject.GridData[o].dcAlpha23=e.address.State,this.ScreenObject.GridData[o].dcAlpha24=e.address.Country,this.ScreenObject.GridData[o].dcAlpha25=e.address.PinCode))}else{let t=yield n.e.GetUsersCurrentAddress(e);console.log("GetUsersCurrentAddress Response Address = "+t.results[0].formatted),n.e.IsEmpty(t)?console.log("location Address not detected"):(this.ScreenObject.GridData[o].dcAlpha6=e.coords.latitude,this.ScreenObject.GridData[o].dcAlpha7=e.coords.longitude,n.e.IsEmpty(t.status)||200!=t.status.code||(this.ScreenObject.GridData[o].dcAlpha10=t.results[0].formatted,this.ScreenObject.GridData[o].dcAlpha11=t.results[0].formatted,this.ScreenObject.GridData[o].dcAlpha12=t.results[0].components.city,this.ScreenObject.GridData[o].dcAlpha13=t.results[0].components.state,this.ScreenObject.GridData[o].dcAlpha14=t.results[0].components.country,this.ScreenObject.GridData[o].dcAlpha15=t.results[0].components.postcode))}}"200"==t.Flag&&(console.log("SaveInventoryDocument"),this.SaveInventoryDocument("Save",!0));break}case"New":if(this.ConfirmDirtyRead()){if((a.a.SessionManager.Preferences.ContainsKey("ConfirmonNewDocument")&&"TRUE"==a.a.SessionManager.Preferences.ConfirmonNewDocument.toUpperCase()||this.ScreenObject.Preferences.ContainsKey("ConfirmonNewDocument")&&"TRUE"==this.ScreenObject.Preferences.ConfirmonNewDocument.toUpperCase())&&(this.res="No",!confirm("Do you want New Document?")))return;if(0==this.ScreenObject.DocID&&!this.CanInsertDeleteRow())return;let e={value:this._Ddate};this.ScreenObject.OnDocPrefixChanged(this.ScreenObject.Prefix,0,0,e,!1),this._Ddate=e.value,this.clear(1),this.ScreenObject.GridDataObj.UpdateFooter(),15==this.DocumentType&&this.BatchPayment()}break;case"Duplicate":let S=this.ScreenObject.GetEditDataCopy(this.ScreenObject.Prefix,this.ScreenObject.DocPrefix.TextBox.Text,this.CostCenterID.toString()),p={value:this._Ddate};this.ScreenObject.OnDocPrefixChanged(this.ScreenObject.Prefix,0,0,p,!1),this._Ddate=p.value,this.clear(5),this.ScreenObject.LoadEditData(S,!0),null!=this.ViewAttachments&&S.Tables.length>8&&this.ViewAttachments.LoadAttachments(S.Tables[8]);for(let e=0;e<this.ScreenObject.GridData.length;e++)this.IsInventoryVoucher&&this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[e].ProductID_Key)&&(this.ScreenObject.GridDataColumns.Contains("LinkedInvDocDetailsID")&&(this.ScreenObject.GridData[e].LinkedInvDocDetailsID=null),this.ScreenObject.GridDataColumns.Contains("LinkedFieldName")&&(this.ScreenObject.GridData[e].LinkedFieldName=null),this.ScreenObject.GridDataColumns.Contains("RefNo")&&(this.ScreenObject.GridData[e].RefNo=null));this.WfID=0,this.WorkFlowDocLevel=0,this.WFDocLevelList.Clear(),this.StatusID=0,this.CalculateTotals(null,!1),this.RefreshGrid=!0;break;case"Redeposit":this.Redeposit();break;case"QtyAdjustment":this.ScreenObject.GridDataColumns.Contains("QtyXML")||(this.ScreenObject.GridDataColumns.push("QtyType"),this.ScreenObject.GridDataColumns.push("QtyXML")),this.Setselectedrow(0),a.a.page.ShowDialog(new le(this,1),ce.a,{ShowCenter:!0});break;case"Print":let g=this.GetButton("Print");if(null==g||!g.Visible)return;if(this.DisplayMessage="",!a.a.SessionManager.IsActionAssigned(43,"Allow Re-Print")){let e=_e.VoucherExportExcel.AllowRePrint(this.DocumentID,0,this.DocID);if(parseInt(e.Tables[0][0].PrintCount)>0)return void(this.DisplayMessage="Re-Print Not Allowed")}let O=-1;this.ScreenObject.DocPrefix.RevisionCombo.Visible&&this.ScreenObject.DocPrefix.RevisionCombo.Items.length>1&&this.ScreenObject.DocPrefix.RevisionCombo.SelectedValue!=this.ScreenObject.DocPrefix.RevisionCombo.Items[this.ScreenObject.DocPrefix.RevisionCombo.Items.length-1].Value&&(O=parseInt(this.ScreenObject.DocPrefix.RevisionCombo.SelectedValue)),this.DisplayMessage=this.PrintVoucher(!1,this.ScreenObject.DocID.toString(),!0,null,O),this.IsPOs&&null!=this.SKU&&this.SKU.Visible&&this.SKU.IsTabStop&&(this.SKU.SetFocus=!0);break;case"PrintPreview":let I=-1;this.ScreenObject.DocPrefix.RevisionCombo.Visible&&this.ScreenObject.DocPrefix.RevisionCombo.Items.length>1&&this.ScreenObject.DocPrefix.RevisionCombo.SelectedValue!=this.ScreenObject.DocPrefix.RevisionCombo.Items[this.ScreenObject.DocPrefix.RevisionCombo.Items.length-1].Value&&(I=parseInt(this.ScreenObject.DocPrefix.RevisionCombo.SelectedValue)),this.DisplayMessage=this.PrintVoucher(!0,this.ScreenObject.DocID.toString(),!0,null,I);break;case"Save":case"SaveonHold":case"SaveAndPrint":case"SaveAndBarcode":if(this.ScreenObject.Preferences.ContainsKey("AlertMessageOnPost")&&"True"==this.ScreenObject.Preferences.AlertMessageOnPost&&!confirm("Do you want to post document?"))return;this.IsInventoryVoucher?this.SaveInventoryDocument_1(e):this.SaveAccountingDocument(e);break;case"AdjustDownPay":let f=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&26425==e.LinkData);if(!(f.length>0))return void(this.DisplayMessage="Define Advance AR/AP field.");{let e=new v.ShowJVViewModel;e.ShowJVViewModel_2(this,f[0].SysColumnName,2),a.a.page.ShowDialog(e,x.ShowJVComponent,{ShowCenter:!0,Title:e.Title})}break;case"PostBills":if(a.a.SessionManager.Preferences.ContainsKey("On")&&"true"==a.a.SessionManager.Preferences.On.toLocaleLowerCase()){let e=0,t=!1;if(1==this.ScreenObject.DocumentType||39==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||6==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||13==this.ScreenObject.DocumentType?(t=!0,null!=this.ScreenObject.CreditAccount&&this.ScreenObject.CreditAccount.SelectedValue>0&&(e=this.ScreenObject.CreditAccount.SelectedValue)):11!=this.ScreenObject.DocumentType&&38!=this.ScreenObject.DocumentType&&5!=this.ScreenObject.DocumentType&&7!=this.ScreenObject.DocumentType&&9!=this.ScreenObject.DocumentType&&24!=this.ScreenObject.DocumentType&&33!=this.ScreenObject.DocumentType&&10!=this.ScreenObject.DocumentType&&8!=this.ScreenObject.DocumentType&&12!=this.ScreenObject.DocumentType||(t=!1,null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.SelectedValue>0&&(e=this.ScreenObject.DebitAccount.SelectedValue)),e>0){this.DialogResult=!1,this.BillWisedt.Clear();let s=new R;s.BillWiseViewModel_2(this,0,e,t,1,1,!0,""),this.DialogResult||a.a.page.ShowDialog(s,L.a,{ShowCenter:!0})}}break;case"Lock":return i=this.GetButton("Lock"),i.Mandatory?(i.Mandatory=!1,i.Label="Unlock",void(this.DisplayMessage=this.ScreenObject.lockDocument(!0))):(i.Mandatory=!0,i.Label="lock",void(this.DisplayMessage=this.ScreenObject.lockDocument(!1)));case"Advance":if(this.ScreenObject.Preferences.ContainsKey("DonotupdateAccounts")&&""!=this.ScreenObject.Preferences.DonotupdateAccounts&&Object(o.j)(this.ScreenObject.Preferences.DonotupdateAccounts)){if(!(this.ScreenObject.Preferences.ContainsKey("PostVoucherDocument")&&n.e.Int(this.ScreenObject.Preferences.PostVoucherDocument)>4e4))return;let e=0,t=this.GridNetTotal+this.FooterGridNetTotal;1==this.ScreenObject.DocumentType||39==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||6==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||13==this.ScreenObject.DocumentType?null!=this.ScreenObject.CreditAccount&&this.ScreenObject.CreditAccount.SelectedValue>0&&(e=this.ScreenObject.CreditAccount.SelectedValue):11!=this.ScreenObject.DocumentType&&38!=this.ScreenObject.DocumentType&&5!=this.ScreenObject.DocumentType&&7!=this.ScreenObject.DocumentType&&9!=this.ScreenObject.DocumentType&&24!=this.ScreenObject.DocumentType&&33!=this.ScreenObject.DocumentType&&10!=this.ScreenObject.DocumentType&&8!=this.ScreenObject.DocumentType&&12!=this.ScreenObject.DocumentType||null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.SelectedValue>0&&(e=this.ScreenObject.DebitAccount.SelectedValue);let s=1,i=1,r=this.IsAccBillWise(e);null!=this.Currency&&null!=this.Currency.Currency.SelectedValue&&""!=this.Currency.Currency.SelectedValue&&(s=parseInt(this.Currency.Currency.SelectedValue)),null!=this.Currency&&null!=this.Currency.ExchangeRate.Text&&""!=this.Currency.ExchangeRate.Text&&(i=parseFloat(this.Currency.ExchangeRate.Text));let o=new Ee.PostVoucherSaveViewModel(this,parseInt(this.ScreenObject.Preferences.PostVoucherDocument),t,e,s,i,r,!1);a.a.page.ShowDialog(o,Ne.PostVoucherSaveComponent)}break;case"Post Billwise":a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Post Billwise");break;case"DependantOK":if(!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Define Dependencies"))return void(this.DisplayMessage="Access denied.");if(!n.e.IsEmpty(this.SelectedRow.Docdetailsid)&&this.ScreenObject.GridDataColumns.Contains("dcAlpha20")&&"open"!=this.SelectedRow.dcAlpha20.toString().toLowerCase())return void(this.DisplayMessage="Can not change dependencies as activity is "+this.SelectedRow.dcAlpha20.toString());let T="";for(let e=0;e<this.Dependflds.Items.length;e++)this.Dependflds.Items[e].IsChecked&&(T.length>0&&(T+=","),T+=this.Dependflds.Items[e].Value);this.SelectedRow.dcAlpha12=T.toString(),this.SelectedRow.Dependencies=T.toString();break;case"Exit":const{POSExitComponent:j}=yield s.e(0).then(s.bind(null,"Y4/b")),{POSExitViewModel:P}=yield Promise.all([s.e(8),s.e(23),s.e(24),s.e(25),s.e(28),s.e(30),s.e(29),s.e(32),s.e(31),s.e(27),s.e(26),s.e(35),s.e(37),s.e(38),s.e(36),s.e(33),s.e(34),s.e(39),s.e(40),s.e(41),s.e(70)]).then(s.bind(null,"FNqn"));let A=new P;A.POSExitViewModel_1(this,!1,!1,!1),a.a.page.ShowDialog(A,j,{ShowCenter:!0});break;case"Options":if(this.IsPOs){const{POSExitComponent:e}=yield s.e(0).then(s.bind(null,"Y4/b")),{POSExitViewModel:t}=yield Promise.all([s.e(8),s.e(23),s.e(24),s.e(25),s.e(28),s.e(30),s.e(29),s.e(32),s.e(31),s.e(27),s.e(26),s.e(35),s.e(37),s.e(38),s.e(36),s.e(33),s.e(34),s.e(39),s.e(40),s.e(41),s.e(70)]).then(s.bind(null,"FNqn"));let i=new t;i.POSExitViewModel_1(this,!0,!1,!1),a.a.page.ShowDialog(i,e,{ShowCenter:!0})}break;case"SearchSKU":if(null!=this.SKU){let e=this.ScreenObject.ColumnSource.find(e=>e.CostCenterID.toString()==a.a.SessionManager.Preferences.POSItemCodeDimension);e&&e.GridViewID>0?a.a.page.ShowDialog(new Ye.ProductSearchCatalogViewModel(this,e.GridViewID,e.CostCenterID,e,null),Je.ProductSearchCatalogComponent):(e=this.ScreenObject.ColumnSource.find(e=>"3"==e.CostCenterID.toString()),e&&e.GridViewID>0?a.a.page.ShowDialog(new Ye.ProductSearchCatalogViewModel(this,e.GridViewID,e.CostCenterID,e,null),Je.ProductSearchCatalogComponent):this.DisplayMessage="")}break;case"OK":if(this.IsPOs&&""==this.ScreenObject.CCguid)return;this.SaveInventoryDocument_1("Save");break;case"Checkout":if(this.Bal>0)return void(this.DisplayMessage="Pay Balance to check out");this.SaveInventoryDocument_1("Checkout");break;case"Pack":this.ScreenObject.GridDataColumns.Contains("PackType")&&(null!=this.SelectedRow||this.ScreenObject.Preferences.ContainsKey("PackWiseProds")&&"true"==this.ScreenObject.Preferences.PackWiseProds.toLowerCase()||this.ScreenObject.Preferences.ContainsKey("LineWisePacking")&&"true"==this.ScreenObject.Preferences.LineWisePacking.toLowerCase())&&a.a.page.ShowDialog(new le(this,3),ce.a,{ShowCenter:!0});break;case"Revise":if(this.ScreenObject.DocID>0&&this.IsUserLock)return void(this.DisplayMessage="Document is Locked");a.a.page.ShowDialog(new W.a(this,0),H.a,{ShowCenter:!0});break;case"GST":a.a.page.ShowDialog(new vt(this),Bt.a,{ShowCenter:!0});break;case"API":break;case"Pay":if(0==this.DocID&&a.a.SessionManager.Preferences.ContainsKey("PosShifts")&&""!=a.a.SessionManager.Preferences.PosShifts&&parseInt(a.a.SessionManager.Preferences.PosShifts)>5e4&&a.a.SessionManager.IsActionAssigned(this.CostCenterID,"DonotAllowbillingoutofSessionTime")){let e=this.ScreenObject.Data.Tables[1].filter(e=>e.ShiftID==this.ScreenObject.ShiftNodeID);if(e.length>0&&!((new Date).toTimeString().slice(0,8)>e[0].StartTime.toString())&&(new Date).toTimeString().slice(0,8)>e[0].EndTime.toString())return void(this.DisplayMessage="Session Timed out")}if(0==this.POSPayModes.PayModes.length)return void this.SaveInventoryDocument_1("CheckoutPrint");if(!n.e.IsEmpty(this.ScreenObject.GridData[0].ProductID_Key)){let e=this.ScreenObject.ColumnSource.find(e=>-1==e.DistributionColID);!e||3!=e.PostingType&&4!=e.PostingType||this.RoundOffValue(this.ScreenObject.GridData[0],e)}let M=0;if(this.POSPayModes.BillValue=0,this.POSPayModes.points=0,this.POSPayModes.AvailablePoints=0,!this.ScreenObject.Preferences.ContainsKey("UseAsOrder")||"True"!=this.ScreenObject.Preferences.UseAsOrder){let e=this.ScreenObject.GetPosPoints(this.DocumentDate);null!=e&&e.Tables.length>0&&(e.Tables[0].length>0&&e.Columns[0].Contains("ccAlpha49")&&n.e.Double(e.Tables[0][0].ccAlpha49.toString())>0&&n.e.Double(e.Tables[0][0].ccAlpha50.toString())>0&&(this.POSPayModes.BillValue=parseFloat(e.Tables[0][0].ccAlpha49),this.POSPayModes.points=parseFloat(e.Tables[0][0].ccAlpha50)),e.Tables.length>1&&e.Tables[1].length>0&&e.Columns[1].Contains("points")&&!n.e.IsEmpty(e.Tables[1][0].points)&&(this.POSPayModes.AvailablePoints=parseFloat(e.Tables[1][0].points)))}M=0,this.POSPayModes.Return=""!=this.POSPayModes.ReturnDecimalPoints?(0).ToString("N"+this.POSPayModes.ReturnDecimalPoints).replace("-",""):"0".toString();let G=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&26425==e.LinkData);if(G.length>0&&!this.ScreenObject.IsDocEdit){let e=this.ScreenObject.GetArApDetails(0,this.DocumentDate,!1);if(null!=e&&e.Tables.length>0&&e.Columns[0].Contains("DocNo")&&e.Tables[0].length>0){let t,s=this.POSPayModes.GridData.filter(e=>e.ColumnName==G[0].SysColumnName);s.length>0?t=s[0]:(t=this.POSPayModes.GridDataObj.NewRow(),this.POSPayModes.GridData.length>0?this.POSPayModes.GridData.InsertAt(t,0):this.POSPayModes.GridData.push(t));let i="",r=0;for(let a=0;a<e.Tables[0].length;a++)!n.e.IsEmpty(e.Tables[0][a].Amount)&&parseFloat(e.Tables[0][a].Amount)>0&&r+parseFloat(e.Tables[0][a].Amount)<=this.GridNetTotal+this.FooterGridNetTotal&&(r+=parseFloat(e.Tables[0][a].Amount),i+='<NonAccRows  RefDocNo="'+e.Tables[0][a].DocNo.toString()+'" Amount="',i+=e.Tables[0][a].Amount.toString()+'"  />');this.ArApBills=i.toString(),t.Name=G[0].ResourceData.toString(),t.Amount=!n.e.IsEmpty(G[0].Decimal)&&parseFloat(G[0].Decimal)>=0?r.ToString("N"+G[0].Decimal.toString()):a.a.SessionManager.Preferences.ContainsKey("DecimalsinExtraFields")&&""!=a.a.SessionManager.Preferences.DecimalsinExtraFields?r.ToString("N"+a.a.SessionManager.Preferences.DecimalsinExtraFields):r,t.ColumnName=G[0].SysColumnName,t.Type="1"}}for(let e=0;e<this.POSPayModes.GridData.length;e++)n.e.IsEmpty(this.POSPayModes.GridData[e].ColumnName)||n.e.IsEmpty(this.POSPayModes.GridData[e].Amount)||(M+=parseFloat(this.POSPayModes.GridData[e].Amount));if(this.Bal=this.GridNetTotal+this.FooterGridNetTotal-M,this.Bal<0&&(this.POSPayModes.Return=""!=this.POSPayModes.ReturnDecimalPoints?(this.GridNetTotal+this.FooterGridNetTotal-M).ToString("N"+this.POSPayModes.ReturnDecimalPoints).replace("-",""):(this.GridNetTotal+this.FooterGridNetTotal-M).toString().replace("-",""),this.Bal=0),this.POSPayModes.DisplayMessage="",this.POSPayModes.PayModes.length>0&&this.POSPayModes.onClick(this.POSPayModes.PayModes[0].DBColumnName,!1),this.PoleDisplayMessage(3,null),39==this.ScreenObject.DocumentType&&this.ScreenObject.Preferences.ContainsKey("DonotShowPayModesinReturn")&&"TRUE"==this.ScreenObject.Preferences.DonotShowPayModesinReturn.toUpperCase()){if(this.POSPayModes.Selectedbtn=this.POSPayModes.PayModes.find(e=>"9"==e.SectionID),null==this.POSPayModes.Selectedbtn)return void(this.DisplayMessage="Difine PayMode");if(this.POSPayModes.OnButtonClick("OK"),""!=this.POSPayModes.DisplayMessage)return void(this.DisplayMessage=this.POSPayModes.DisplayMessage);this.SaveInventoryDocument_1("CheckoutPrint")}else a.a.page.ShowDialog(this.POSPayModes,Kt.a,{ShowCenter:!0});break;case"PostStock":if(!(this.ScreenObject.Preferences.ContainsKey("PostingDOC")&&""!=this.ScreenObject.Preferences.PostingDOC&&parseInt(this.ScreenObject.Preferences.PostingDOC)>4e4))return void(this.DisplayMessage="Define stock posting document");a.a.document.GetDocumentDrafts(0,parseInt(this.ScreenObject.Preferences.PostingDOC),1,!1).subscribe(e=>{if(e.Tables[0].length>0)this.res="",a.a.page.ShowDialog(new q.DocumentDraftsViewModel(this,parseInt(this.ScreenObject.Preferences.PostingDOC),1),Y.DocumentDraftsComponent).subscribe(()=>{if("No"==this.res){let e=new U.a;e.GoToLineViewModel_4(this,0,0),a.a.page.ShowDialog(e,X.a,{ShowCenter:!0,NoWidth:!0})}});else{let e=new U.a;e.GoToLineViewModel_4(this,0,0),a.a.page.ShowDialog(e,X.a,{ShowCenter:!0,NoWidth:!0})}});break;case"ShowJV":this.PrepareJV();break;case"GenerateLink":this.GenerateLinkClick();break;case"EInv":this.GetEInv(9);break;case"SearchData":this.SearchData();break;case"Activities":let E;if(this.SetVisibiltiFalse(),null==this.ViewActivities?(this.ViewActivities=new Ue.b(this),this.ViewActivities.NodeID=this.DocID,this.NodeID=this.DocID,this.Activities=new Xe.a(this,!1),this.Activities.AssignVisiblity=!1,this.ViewActivities.Activities=this.Activities,this.ViewActivities.CloseVisible=!0):this.NodeID=this.ViewActivities.NodeID=this.DocID,E=this.ScreenObject.Data.Tables[10].filter(this.NodeID>0?e=>-10==e.CostCenterColID&&(2==e.Mode||3==e.Mode):e=>-10==e.CostCenterColID&&(1==e.Mode||3==e.Mode)),E.length>0){if(!Object(o.j)(E[0].IsVisible.toString()))return;this.Activities.Enabled=Object(o.j)(E[0].IsEditable.toString())}else this.Activities.Enabled=!0;this.ScreenObject.IsPurchase?null!=this.ScreenObject.CreditAccount&&this.ScreenObject.CreditAccount.Name.Visible&&(this.Activities.CRMCustomer.Text=this.ScreenObject.CreditAccount.Name.Text):null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.Name.Visible&&(this.Activities.CRMCustomer.Text=this.ScreenObject.DebitAccount.Name.Text),this.ScreenObject.Preferences.ContainsKey("ActivityAsPopUp")&&"True"==this.ScreenObject.Preferences.ActivityAsPopUp.toString()?(this.Activities.Customize=!1,this.Activities.Customize||this.Activities.onViewHistory(null)):a.a.page.ShowDialog(this.Activities,qe.ActivitiesComponent);break;case"LoadDraft":a.a.page.ShowDialog(new q.DocumentDraftsViewModel(this,1),Y.DocumentDraftsComponent);break;case"GoToLine":let w=new U.a;w.GoToLineViewModel_2(this),a.a.page.ShowDialog(w,X.a,{ShowCenter:!0,NoWidth:!0}),this.SetFocusongrid=!0;break;case"Cheque":i=this.GetButton("Pre Payments"),null!=i&&i.Visible&&this.ScreenObject.GridData.length>0&&!n.e.IsEmpty(this.ScreenObject.GridData[0].Amount)&&(this.pdcGCVM.Amount.Text=this.ScreenObject.GridData[0].Amount.toString()),this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&this.ScreenObject.GridData.length>0&&!n.e.IsEmpty(this.ScreenObject.GridData[0].CreditAccount_Key)&&this.pdcGCVM.DebitAcc.Visible&&(this.pdcGCVM.DebitAcc.SelectedValue=parseInt(this.ScreenObject.GridData[0].CreditAccount_Key)),this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&this.ScreenObject.GridData.length>0&&!n.e.IsEmpty(this.ScreenObject.GridData[0].DebitAccount_Key)&&this.pdcGCVM.CredAcc.Visible&&(this.pdcGCVM.CredAcc.SelectedValue=parseInt(this.ScreenObject.GridData[0].DebitAccount_Key)),a.a.page.ShowDialog(this.pdcGCVM,de.a).subscribe(()=>{this.SetFocusongrid=!0});break;case"ReEvaluate":a.a.SessionManager.IsActionAssigned(this.CostCenterID,"ReEvaluate")&&this.ReEvaluate(!0);break;case"ReEvaluateTax":(a.a.SessionManager.IsActionAssigned(this.CostCenterID,"ReEvaluate")||a.a.SessionManager.IsActionAssigned(this.CostCenterID,"ReEvaluateTaxChart"))&&this.ReEvaluatePriceTax(0,"t");break;case"ReEvaluatePrice":(a.a.SessionManager.IsActionAssigned(this.CostCenterID,"ReEvaluate")||a.a.SessionManager.IsActionAssigned(this.CostCenterID,"ReEvaluatePriceChart"))&&this.ReEvaluatePriceTax(0,"p");break;case"Next":case"Previous":if(!this.ScreenObject.DocPrefix.NextVisibility&&"Next"==e.toString()||!this.ScreenObject.DocPrefix.PreviousVisibility&&"Previous"==e.toString())return;this.GetData(e.toString());break;case"ChequeDate":case"BillDate":case"DueDate":case"DocDate":case"ChequeMaturityDate":{let t=this.ScreenObject.HeaderFields.find(t=>t instanceof b.c&&t.DBColumnName==e.toString());t&&(t.SetFocus=!0)}break;case"Hold":if(0!=this.DocID)return this.IsPOs&&null!=this.SKU&&this.SKU.Visible&&this.SKU.IsTabStop&&(this.SKU.SetFocus=!0),void(this.DisplayMessage=a.a.GetResource("Documentalreadysaved"));if(this.HoldDocDate.Date=this.DocumentDate,38==this.DocumentType){const{POSExitComponent:e}=yield s.e(0).then(s.bind(null,"Y4/b")),{POSExitViewModel:t}=yield Promise.all([s.e(8),s.e(23),s.e(24),s.e(25),s.e(28),s.e(30),s.e(29),s.e(32),s.e(31),s.e(27),s.e(26),s.e(35),s.e(37),s.e(38),s.e(36),s.e(33),s.e(34),s.e(39),s.e(40),s.e(41),s.e(70)]).then(s.bind(null,"FNqn"));let i=new t;i.POSExitViewModel_1(this,!1,!0,!1),a.a.page.ShowDialog(i,e,{ShowCenter:!0})}else a.a.page.ShowDialog(this,ze.a,{Title:a.a.GetResource("Com_SaveAsHold"),ShowCenter:!0,NoWidth:!0});this.IsPOs&&null!=this.SKU&&this.SKU.Visible&&this.SKU.IsTabStop&&(this.SKU.SetFocus=!0);break;case"HoldDoc":if(0!=this.DocID)return void(this.DisplayMessage=a.a.GetResource("Documentalreadysaved"));if(n.e.IsEmptySpace(this.HoldDocName.Text))return void(this.DisplayMessage="Enter Name");this.SaveDraft(!1,!1);break;case"Release":a.a.page.ShowDialog(new q.DocumentDraftsViewModel(this,2),Y.DocumentDraftsComponent).subscribe(()=>{this.IsPOs&&null!=this.SKU&&this.SKU.Visible&&this.SKU.IsTabStop&&(this.SKU.SetFocus=!0)});break;case"ChangeLocation":this.ChangeLocation(!0,!1,a.a.SessionManager.LocationID);break;case"Copy":a.a.page.ShowDialog(new We(this,!0,this.CostCenterID.toString()),Qe.a,{ShowCenter:!0,NoWidth:!0}).subscribe(()=>{this.DialogResult&&(this.CalculateTotals(null,!1),this.RefreshGrid=!0)});break;case"LoadDocument":if(!this.ScreenObject.DocPrefix.LoadVisibility)return;this.LoadDOcument();break;case"SaveDraft":if(0!=this.DocID)return void(this.DisplayMessage=a.a.GetResource("Documentalreadysaved"));if(this.ScreenObject.Preferences.ContainsKey("RemarksWhileSavingDrafts")&&"TRUE"==this.ScreenObject.Preferences.RemarksWhileSavingDrafts.toUpperCase()){const{POSExitComponent:e}=yield s.e(0).then(s.bind(null,"Y4/b")),{POSExitViewModel:t}=yield Promise.all([s.e(8),s.e(23),s.e(24),s.e(25),s.e(28),s.e(30),s.e(29),s.e(32),s.e(31),s.e(27),s.e(26),s.e(35),s.e(37),s.e(38),s.e(36),s.e(33),s.e(34),s.e(39),s.e(40),s.e(41),s.e(70)]).then(s.bind(null,"FNqn"));let i=new t;i.POSExitViewModel_1(this,!1,!1,!0),a.a.page.ShowDialog(i,e,{ShowCenter:!0}).subscribe(()=>{this.SaveDraft(!1,!0)})}else this.SaveDraft(!1,!0);break;case"Notes":if(i=this.GetButton("Notes"),null==i||!i.Visible)return;this.OnAddNote(),this.SetVisibiltiFalse(),a.a.page.ShowDialog(this,he.a,{Title:"Notes"});break;case"Attachment":if(i=this.GetButton("Attachments"),null==i||!i.Visible)return;this.OnAddAttachment(),this.SetVisibiltiFalse(),this.AttachmentVisibility=!0,this.ViewAttachments.AttachmentsList.forEach(e=>{e.Height=null==e.RowID&&n.e.IsEmpty(e.ColID)?20:0}),this.Attachment.RowID=null,this.Attachment.ColID="",a.a.page.ShowDialog(this,N.a,{Title:"Attachment"});break;case"Contacts":if(i=this.GetButton("Contacts"),null==i||!i.Visible)return;this.SetVisibiltiFalse();break;case"CancelAction":this.ApproveVisibility=!1;break;case"ApproveVisiblity":if(!this.ButtonApprove.Visible||!this.ButtonApprove.Enable)return;if(this.IsInventoryVoucher&&this.LineWiseApproval){let e=new Be;return e.UpdateFieldsViewModel_1(this),void a.a.page.ShowDialog(e,ve.a,{ShowCenter:!0,HideHeader:!0,HideClose:!0}).subscribe(()=>{let e=this.ScreenObject.ColumnSource.find(e=>!n.e.IsEmpty(e.ValueBinding)&&"IsSelected"==e.ValueBinding);e&&(e.IsVisible=!1),e=this.ScreenObject.ColumnSource.find(e=>!n.e.IsEmpty(e.DisplayMember)&&"AppRemarks"==e.DisplayMember),e&&(e.IsVisible=!1)})}this.ScreenObject.Preferences.ContainsKey("UseAsLC")&&""!=this.ScreenObject.Preferences.UseAsLC&&Object(o.j)(this.ScreenObject.Preferences.UseAsLC)||this.ScreenObject.Preferences.ContainsKey("UseAsTR")&&""!=this.ScreenObject.Preferences.UseAsTR&&Object(o.j)(this.ScreenObject.Preferences.UseAsTR)?this.SaveAccountingDocument("Approve"):(this.SetVisibiltiFalse(),this.ApproveVisibility=!0,this.IsPOs&&(this.ButtonSaveandPrint.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save&Print")),this.RecurDocsWithApproval.Visible=!1,!this.IsInventoryVoucher&&this.ScreenObject.IsRecurDocumet()&&(0==this.RecurDocsWithApproval.Items.length&&(this.RecurDocsWithApproval.Items.push(D.d.ComboBoxItems_2("Auto post","2")),this.RecurDocsWithApproval.Items.push(D.d.ComboBoxItems_2("With Approval","1")),this.RecurDocsWithApproval.Items.push(D.d.ComboBoxItems_2("Without Approval","0")),this.RecurDocsWithApproval.SelectedValue="2"),this.RecurDocsWithApproval.Visible=!0));break;case"SuspendVisiblity":if(!this.ButtonSuspend.Visible||!this.ButtonSuspend.Enable)return;this.SuspendVisiblity=!0,this.ScreenObject.IsDocEdit&&(this.Remarks.Text=this.linkStatusRemarks),a.a.page.ShowDialog(this,xe.a,{ShowCenter:!0,NoWidth:!0,Title:a.a.GetResource("LinkStatusLabel")});break;case"PriceChart":if(i=this.GetButton("PriceChart"),null==i||!i.Visible)return;this.ScreenObject.Preferences.ContainsKey("PriceChartMapping")&&this.ScreenObject.Preferences.PriceChartMapping.length>0?this.LoadPriceChart():this.DisplayMessage="Please Configure Price Chart Mappings";break;case"LinkStatus_Open":this.SaveLinkStatus(369);break;case"LinkStatus_Suspend":this.SaveLinkStatus(445);break;case"Recur":if(i=this.GetButton("Recur"),null==i||!i.Visible)return;this.ScreenObject.IsDocEdit&&(this.SetVisibiltiFalse(),this.Recur=new Le(this),this.Recur.LoadData(),a.a.page.ShowDialog(this.Recur,Re.a));break;case"Delete":if(!this.ButtonDelete.Visible||!this.ButtonDelete.Enable)return;if(0==this.ScreenObject.DocID)return this.DisplayMessage="Cannot Delete Empty Document",void(this.MessageVisibility=!0);if(this.ScreenObject.DocID>0&&this.IsUserLock)return void(this.DisplayMessage="Document is Locked");if(0!=this.ScreenObject.RefNodeID&&86!=this.ScreenObject.RefCCId&&73!=this.ScreenObject.RefCCId&&89!=this.ScreenObject.RefCCId&&!this.ScreenObject.IsRefLCTR)return void(this.DisplayMessage=a.a.GetResource("RefDeleteDocument"));if(!this.IsInventoryVoucher&&this.ScreenObject.IsBouncedorPdcPosted&&(!this.ScreenObject.Preferences.ContainsKey("LineWisePDC")||""==this.ScreenObject.Preferences.LineWisePDC||!Object(o.j)(this.ScreenObject.Preferences.LineWisePDC)))return void(this.DisplayMessage=this.ScreenObject.BouncedorPdcMessage);if(439==this.StatusID)return void(this.DisplayMessage="Discounted PDC can not be deleted");if(75==this.ScreenObject.DocumentType){let e=a.a.common.GetDataSet("PAY052",this.ScreenObject.DocID.toString()).Tables[0];if(null!=e&&e.length>0)return this.DisplayMessage="Final Settlement already Posted for this Grade can not be deleted",void(this.MessageVisibility=!0)}a.a.SessionManager.IsActionAssigned(this.CostCenterID,"API")&&this.GenerateAPIRequest(8),this.DeleteDocument();break;case"Suspend":if(0==this.ScreenObject.DocID)return this.DisplayMessage="Cannot Suspend Empty Document",void(this.MessageVisibility=!0);if(this.ScreenObject.DocID>0&&this.IsUserLock)return void(this.DisplayMessage="Document is Locked");if(!this.ButtonSuspendDoc.Visible||!this.ButtonSuspendDoc.Enable)return;if(0!=this.ScreenObject.RefNodeID&&86!=this.ScreenObject.RefCCId&&73!=this.ScreenObject.RefCCId&&89!=this.ScreenObject.RefCCId&&!this.ScreenObject.IsRefLCTR)return void(this.DisplayMessage="Can not suspend reference document");if(!this.IsInventoryVoucher&&this.ScreenObject.IsBouncedorPdcPosted)return void(this.DisplayMessage=this.ScreenObject.BouncedorPdcMessage);if(439==this.StatusID)return void(this.DisplayMessage="Discounted PDC can not be suspended");if(75==this.ScreenObject.DocumentType){let e="",t=this.ScreenObject._CCFields.find(e=>"dcccnid53"==e.DBColumnName.toLowerCase());null!=t&&null!=t&&(t instanceof m.b||t instanceof C.a)&&(e=t.SelectedValue.toString());let s=a.a.common.GetDataSet("PAY052",e).Tables[0];if(null!=s&&s.length>0)return this.DisplayMessage="Final Settlement already Posted for this Grade can not be suspended",void(this.MessageVisibility=!0)}this.ScreenObject.Preferences.ContainsKey("SuspendRemarksMandatory")&&""!=this.ScreenObject.Preferences.SuspendRemarksMandatory&&Object(o.j)(this.ScreenObject.Preferences.SuspendRemarksMandatory)?a.a.page.ShowDialog(new W.a(this,1),H.a):(a.a.SessionManager.IsActionAssigned(this.CostCenterID,"API")&&this.GenerateAPIRequest(11),this.IsSuspend=!0,confirm("Are you sure you want to suspend?")&&this.OnDeleteCallBack());break;case"CancelAppReject":this.ApproveVisibility=!1;break;case"Approve":case"ApproveandPrint":if(this.ScreenObject.DocID>0&&this.IsUserLock)return void(this.DisplayMessage="Document is Locked");if(this.ScreenObject.Preferences.ContainsKey("CommentsMandatoryforApprove")&&""!=this.ScreenObject.Preferences.CommentsMandatoryforApprove&&Object(o.j)(this.ScreenObject.Preferences.CommentsMandatoryforApprove)&&(null==this.Remarks.Text||""==this.Remarks.Text))return void(this.DisplayMessage="Remarks Mandatory For Approval");a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit")?this.IsInventoryVoucher?this.SaveInventoryDocument_1(e.toString()):this.SaveAccountingDocument(e.toString()):(this.SaveStatus(369,this.GetWorkFlow(!1,null),""),"ApproveandPrint"==e.toString()&&(this.DisplayMessage=this.DisplayMessage+"\r\n "+this.PrintVoucher(!1,this.ScreenObject.DocID.toString(),!0,null))),this.IsPOs&&(this.ButtonSaveandPrint.Visible=!1);break;case"NoWorkFlow":case"NoWorkFlowprint":if(this.ScreenObject.DocID>0&&this.IsUserLock)return void(this.DisplayMessage="Document is Locked");this.IsInventoryVoucher?this.SaveInventoryDocument_1(e):this.SaveAccountingDocument(e);break;case"DocLink":this.SetVisibiltiFalse(),this.DocLinkVisibility=!0;break;case"Addresses":this.SetVisibiltiFalse(),this.AddressesVisibility=!0;break;case"Report":this.SetVisibiltiFalse(),this.ReportInfoVisibility=!0;break;case"Documents":this.SetVisibiltiFalse(),this.MappedDocsVisibility=!0;break;case"VacCrDaysDetail":if(72==this.DocumentType){let e=0,t=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());t&&(t instanceof m.b||t instanceof C.a)&&(t instanceof m.b?t.SelectedValue>0&&(e=t.SelectedValue):t instanceof C.a&&t.SelectedValue>0&&(e=t.SelectedValue)),this.ShowVacationCreditDaysDetail(e)}break;case"Reject":if(this.ScreenObject.Preferences.ContainsKey("CommentsMandatoryforReject")&&""!=this.ScreenObject.Preferences.CommentsMandatoryforReject&&Object(o.j)(this.ScreenObject.Preferences.CommentsMandatoryforReject)&&(null==this.Remarks.Text||""==this.Remarks.Text))return void(this.DisplayMessage="Remarks Mandatory For Reject");if(this.LineWiseApproval){let e=new Be;e.UpdateFieldsViewModel_1(this),a.a.page.ShowDialog(e,ve.a,{ShowCenter:!0,HideHeader:!0,HideClose:!0})}else this.SaveStatus(372,0,"");this.IsPOs&&(this.ButtonSaveandPrint.Visible=!1);break;case"ViewHistory":this.ScreenObject.IsDocEdit&&a.a.page.ShowDialog(new q.DocumentDraftsViewModel(this,3),Y.DocumentDraftsComponent);break;case"ContinuousPrint":if(i=this.GetButton("Print"),null==i||!i.Visible)return;a.a.page.ShowDialog(new Rt(this),Ft.a,{HideHeader:!0,ShowCenter:!0});break;case"Bounce":this.ScreenObject.IsDocEdit&&(this.SetVisibiltiFalse(),this.Bounce=new Pe(this),a.a.page.ShowDialog(this.Bounce,Ae.a));break;case"Enquiries":a.a.page.ShowDialog(new ut(this),ht.a);var l=this.ScreenObject.ColumnSource.find(e=>!n.e.IsEmpty(e.DisplayMember)&&"EnqSel"==e.DisplayMember);null!=l&&(l.IsVisible=!1);break;case"Search":this.ScreenObject.GridDataObj.SearchVisible=!this.ScreenObject.GridDataObj.SearchVisible;break;case"ReviseHistory":this.SetVisibiltiFalse(),this.DocHistoryVisibility=!0,this.DocHistory.Clear(),this.HistCols[0].IsVisible=!0,this.HistCols[1].IsVisible=!0,this.HistoryUpdateFooter=!0;let F=this.ScreenObject.GetReviseHistory();if(null!=F&&F.Tables.length>0&&F.Columns[0].Contains("ModifiedBy"))for(let e=0;e<F.Tables[0].length;e++){let t=a.a.slick.emptyObj();t.VersionNo=F.Tables[0][e].VersionNo,t.ReviseReason=F.Tables[0][e].ReviseReason,t.ModifiedBy=F.Tables[0][e].ModifiedBy,n.e.IsEmpty(F.Tables[0][e].ModifiedDate)||(t.ModifiedDate=new Date(F.Tables[0][e].ModifiedDate).ToString(a.a.SessionManager.Preferences["Date Format"])),this.DocHistory.push(t)}a.a.page.ShowDialog(this,Me.a,{Title:"History"});break;case"DocumentHistory":this.SetVisibiltiFalse(),this.DocHistoryVisibility=!0,this.DocHistory.Clear(),this.HistCols[0].IsVisible=!1,this.HistCols[1].IsVisible=!1,this.HistoryUpdateFooter=!0;let V=this.ScreenObject.GetDocumentHistory();if(null!=V&&V.Tables.length>0&&V.Columns[0].Contains("ModifiedBy")){let e=0;for(let s=0;s<V.Tables[0].length;s++){let t=a.a.slick.emptyObj();t.ModifiedBy=V.Tables[0][s].ModifiedBy,n.e.IsEmpty(V.Tables[0][s].ModifiedDate)||(t.ModifiedDate=new Date(V.Tables[0][s].ModifiedDate).ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss tt")),n.e.IsEmpty(V.Tables[0][s].maxid)||(e<parseInt(V.Tables[0][s].maxid)&&(e=parseInt(V.Tables[0][s].maxid)),t.maxid=V.Tables[0][s].maxid.toString()),this.DocHistory.push(t)}let t=this.DocHistory.filter(t=>t.maxid==e);t.length>0&&(t[0].IsCurrent="YES")}a.a.page.ShowDialog(this,Me.a,{Title:"History"});break;case"LINK":a.a.page.ShowDialog(new k.b(this),_.a);break;case"LINKMAP":n.e.IsEmpty(this.ScreenObject.VoucherNo)||a.a.page.ShowDialog(new pt.DocumentFlowChartViewModel(!0,this.ScreenObject.VoucherNo,this.ScreenObject.CostCenterID,this.ScreenObject.IsInventory),Ct.DocumentFlowChartComponent);break;case"CashDrawer":if(this.ScreenObject.Data.Tables.length>18&&this.ScreenObject.Data.Tables[18].length>0){let e=this.ScreenObject.Data.Tables[18][0];if(this.ScreenObject.RegisterNodeID>0){let e=this.ScreenObject.Data.Tables[18].filter(e=>e.NodeID==this.ScreenObject.RegisterNodeID);if(e.length>0&&null!=e[0].CashDrawPrintID&&parseInt(e[0].CashDrawPrintID)>0)this.CashDrwerPrintID=parseInt(e[0].CashDrawPrintID),this.PrintVoucher(!1,"-1",!1,null),this.CashDrwerPrintID=0;else{if(!(e.length>0)||n.e.IsEmpty(e[0].CashDrawerName)||n.e.IsEmpty(e[0].CashDrawerCommand))return;this.OpenCashDrawer(e[0].CashDrawerName.toString(),e[0].CashDrawerCommand.toString())}}else null!=e&&this.OpenCashDrawer(e.CashDrawerName.toString(),e.CashDrawerCommand.toString())}break;case"ViewPaymentTerms":let K=new ge;K.PaymentTermsViewModel_1(this,this.payTermXml),a.a.page.ShowDialog(K,Oe.a,{NoWidth:!0});break;case"Email":this.ShowEmailSMS(!0);break;case"SMS":this.ShowEmailSMS(!1);break;case"Close":if(this.IsAutoPost&&null!=parent)return this.DisplayMessage="close",void a.a.page.HideDialog();if(!(this.ScreenObject.Preferences.ContainsKey("LcCloseDocument")&&""!=this.ScreenObject.Preferences.LcCloseDocument&&parseInt(this.ScreenObject.Preferences.LcCloseDocument)>4e4))return this.DialogResult=!1,void a.a.page.HideDialog();{let e=0,t=this.ScreenObject.GetLCUsedAmt(parseInt(this.ScreenObject.GridData[0].DocDetailsID));if(null!=t&&t.Tables.length>0&&t.Columns[0].Contains("amt")&&t.Tables[0].length>0&&!n.e.IsEmpty(t.Tables[0][0].amt)&&(e=t.Tables.length>2&&t.Columns[2].Contains("CLoseAmount")&&t.Tables[2].length>0&&!n.e.IsEmpty(t.Tables[2][0].CLoseAmount)?parseFloat(t.Tables[0][0].amt)-parseFloat(t.Tables[2][0].CLoseAmount):parseFloat(t.Tables[0][0].amt)),!(e>0))return void(this.DisplayMessage="lc is already closed");{let s=new es(parseInt(this.ScreenObject.Preferences.LcCloseDocument),"",!1);if(s.LCDueAmt=e,null!=s.ScreenObject.CreditAccount&&null!=this.ScreenObject.CreditAccount)s.ScreenObject.CreditAccount.SelectedValue=this.ScreenObject.CreditAccount.SelectedValue,null!=this.ScreenObject.CreditAccount.Code&&(s.ScreenObject.CreditAccount.Code.SelectedValueText=this.ScreenObject.CreditAccount.Code.Text),null!=this.ScreenObject.CreditAccount.Name&&(s.ScreenObject.CreditAccount.Name.SelectedValueText=this.ScreenObject.CreditAccount.Name.Text),null!=t&&t.Tables.length>1&&t.Tables[1].length>0&&(s.ScreenObject.CreditAccount.Code.CustomWhere=s.ScreenObject.CreditAccount.Name.CustomWhere=" a.AccountID in ("+t.Tables[1][0].account.toString()+","+t.Tables[1][0].MarginAccount.toString()+","+t.Tables[1][0].Traccount.toString()+") ");else if(s.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")){let e=s.ScreenObject.ColumnSource.find(e=>null!=e.ValueMember&&"creditaccount_key"==e.ValueMember.toLowerCase());e&&(e.FilterCondition=" a.AccountID in ("+t.Tables[1][0].account.toString()+","+t.Tables[1][0].MarginAccount.toString()+","+t.Tables[1][0].Traccount.toString()+") ")}s.ScreenObject.IsRefLCTR=!0,s.ScreenObject.RefCCId=400,this.ScreenObject.GridData.length>0&&!n.e.IsEmpty(this.ScreenObject.GridData[0].DocDetailsID)&&parseInt(this.ScreenObject.GridData[0].DocDetailsID)>0&&(s.ScreenObject.RefNodeID=parseInt(this.ScreenObject.GridData[0].DocDetailsID));for(let t=0;t<this.ScreenObject.GridData.length;t++)if(!n.e.IsEmpty(this.ScreenObject.GridData[t].DocDetailsID)&&parseInt(this.ScreenObject.GridData[t].DocDetailsID)>0){if(this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[t].CreditAccount_Key))if(s.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")){s.ScreenObject.GridData[t].CreditAccount_Key=this.ScreenObject.GridData[t].CreditAccount_Key.toString();let e=s.ScreenObject.ColumnSource.filter(e=>null!=e.ValueMember&&""!=e.ValueMember&&"creditaccount_key"==e.ValueMember.toLowerCase());e&&e.forEach(e=>{s.ScreenObject.GridDataColumns.Contains(e.DisplayMember)&&this.ScreenObject.GridDataColumns.Contains(e.DisplayMember)&&(s.ScreenObject.GridData[t][e.DisplayMember]=this.ScreenObject.GridData[t][e.DisplayMember].toString())})}else null!=s.ScreenObject.CreditAccount&&(s.ScreenObject.CreditAccount.SelectedValue=parseInt(this.ScreenObject.GridData[t].CreditAccount_Key));else if(this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[t].DebitAccount_Key))if(s.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")){s.ScreenObject.GridData[t].DebitAccount_Key=this.ScreenObject.GridData[t].DebitAccount_Key.toString();let e=s.ScreenObject.ColumnSource.filter(e=>null!=e.ValueMember&&""!=e.ValueMember&&"debitaccount_key"==e.ValueMember.toLowerCase());e&&e.forEach(e=>{s.ScreenObject.GridDataColumns.Contains(e.DisplayMember)&&this.ScreenObject.GridDataColumns.Contains(e.DisplayMember)&&(s.ScreenObject.GridData[t][e.DisplayMember]=this.ScreenObject.GridData[t][e.DisplayMember].toString())})}else null!=s.ScreenObject.DebitAccount&&(s.ScreenObject.DebitAccount.SelectedValue=parseInt(this.ScreenObject.GridData[t].DebitAccount_Key));s.ScreenObject.GridDataColumns.Contains("Amount")&&(s.ScreenObject.GridData[t].Amount=e),s.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&null!=this.ScreenObject.CreditAccount&&(s.ScreenObject.GridData[t].CreditAccount=this.ScreenObject.CreditAccount.Text,s.ScreenObject.GridData[t].CreditAccount_Key=this.ScreenObject.CreditAccount.SelectedValue)}a.a.page.addNewTab({component:B.AddEditDocumentComponent,params:{obj:s}})}}break;case"ConvertCase":this.ConvertCase();break;case"Export":if(this.ScreenObject.IsDocEdit){if(376==this.StatusID)return void(this.DisplayMessage="Documents is cancelled");if(371==this.StatusID&&this.DoNotPrintUnApprovedDocuments)return void(this.DisplayMessage="Un-Approved Documents not allowed to export");let e=-1;this.ScreenObject.DocPrefix.RevisionCombo.Visible&&this.ScreenObject.DocPrefix.RevisionCombo.Items.length>1&&this.ScreenObject.DocPrefix.RevisionCombo.SelectedValue!=this.ScreenObject.DocPrefix.RevisionCombo.Items[this.ScreenObject.DocPrefix.RevisionCombo.Items.length-1].Value&&(e=parseInt(this.ScreenObject.DocPrefix.RevisionCombo.SelectedValue)),this.Export(this.DocID,null,!1,e)}break;case"Import":this.IsImport?null!=this.ExcelTable&&this.ExcelTable.length>0&&(90!=this.DocumentType&&89!=this.DocumentType||this.SetButtonVisibility("Save",!0),n.e.SetPersonalize("ImportChunkSize",this.ImportChunkSize),this.importWorker_DoWork(null,null)):(this.SortGrid(!1),a.a.page.HideDialog());break;case"SortVisiblity":r=new Array,this.DtImportObj.Clear(),t=new y.a,t.DisplayMember="Name",t.ValueMember="Value",t.ValueBinding="FieldName",t.Header="Column Name",t.DataType="ComboBox",t.Width=150,u=new Array,u.push(D.d.ComboBoxItems_2("","")),this.ScreenObject.ColumnSource.forEach(e=>{!n.e.IsEmpty(e.ValueBinding)&&e.IsVisible?u.push(D.d.ComboBoxItems_2(e.Header,e.ValueBinding)):!n.e.IsEmpty(e.DisplayMember)&&"DocSeqNo"!=e.DisplayMember&&e.IsVisible&&(!this.ScreenObject.GridDataColumns.Contains(e.DisplayMember+"_Key")||"DATE"!=e.DataType&&"DATETIME"!=e.DataType&&"TIME"!=e.DataType&&"Time2"!=e.DataType?u.push(D.d.ComboBoxItems_2(e.Header,e.DisplayMember)):u.push(D.d.ComboBoxItems_2(e.Header,e.DisplayMember+"_Key")))}),t.ComboData=u,r.push(t),this.DtImportObj.TableColumns.push("FieldName"),t=new y.a,t.DisplayMember="Name",t.ValueMember="Value",t.ValueBinding="Order",t.Header="Order",t.DataType="ComboBox",t.Width=80,u=new Array,u.push(D.d.ComboBoxItems_2("Ascending","Asc")),u.push(D.d.ComboBoxItems_2("Descending","Desc")),u.push(D.d.ComboBoxItems_2("Numeric Ascending","NUM")),u.push(D.d.ComboBoxItems_2("Numeric Descending","NUMDesc")),t.ComboData=u,r.push(t),this.DtImportObj.TableColumns.push("Order"),this.IsImport=!1,this.ImportCols=r,this.SetVisibiltiFalse(),this.ImportVisiblity=!0,this.RightTabSelectedIndex=0,this.DtImportObj.addEmptyRow(),this.DtImportObj.addEmptyRow(),this.DtImportObj.addEmptyRow(),this.DtImportObj.addEmptyRow(),this.DtImportObj.Height=200,a.a.page.ShowDialog(this,gt.a,{ShowCenter:!a.a.IsMobile,NoWidth:!0,Title:"Sort"});break;case"ImportVisiblity":let Q;if(r=[],this.DtImportObj.Clear(),this.DtImportObj.Columns=[],t=new y.a,t.DisplayMember="FieldName",t.Header=a.a.GetResource("Import_FieldName"),t.DataType="TextBlock",t.Width=100,t.ReadOnly=!0,r.push(t),this.DtImportObj.TableColumns.push("FieldName"),t=new y.a,t.DisplayMember="Name",t.ValueMember="Value",t.ValueBinding="FeatureFieldName",t.Header=a.a.GetResource("Import_FeatureFieldName"),t.DataType="ComboBox",t.Width=120,u=[],u.push(D.d.ComboBoxItems_2("","")),81==this.DocumentType){let e=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase());if(e&&e instanceof D.e&&n.e.IsEmpty(e.SelectedValue))return void(this.DisplayMessage="Please select Year");if(e=this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase()),e&&e instanceof D.e&&n.e.IsEmpty(e.SelectedValue))return void(this.DisplayMessage="Please select BasedOn")}if(Q=n.e.Int(this.ScreenObject.Preferences.ImpPrf),this.ScreenObject.Preferences.ContainsKey("ImpPrf")&&Q>0){let e=a.a.admin.GetImportDetails(Q,!0);null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&(t.DefaultValue=e.Tables[0][0].FileName.toString(),t.DefaultValueText=e.Tables[0][0].Structure.toString())}this.ScreenObject.ColumnSource.forEach(e=>{!n.e.IsEmpty(e.DisplayMember)&&e.IsVisible&&("DocSeqNo"==e.DisplayMember?u.push(D.d.ComboBoxItems_2(e.Header,"100")):e.CostCenterID>5e4&&e.DisplayMember.endsWith("Code")?u.push(D.d.ComboBoxItems_2(e.Header,"-"+e.ID)):u.push(D.d.ComboBoxItems_2(e.Header,e.ID)))}),this.ScreenObject._StaticFields.forEach(e=>{n.e.IsEmpty(e.DBColumnName)||u.push(D.d.ComboBoxItems_2(e.Label,e.DBColumnID.toString()))}),this.ScreenObject._TextFields.forEach(e=>{n.e.IsEmpty(e.DBColumnName)||u.push(D.d.ComboBoxItems_2(e.Label,e.DBColumnID.toString()))}),this.ScreenObject._CCFields.forEach(e=>{n.e.IsEmpty(e.DBColumnName)||(e instanceof C.a&&u.push(D.d.ComboBoxItems_2(e.Label.replace("*","")+"Code","-"+e.DBColumnID.toString())),u.push(D.d.ComboBoxItems_2(e.Label,e.DBColumnID.toString())))}),u.push(D.d.ComboBoxItems_2("BatchNumber","-500")),t.ComboData=u,r.push(t),this.DtImportObj.TableColumns.push("FeatureFieldName"),this.IsImport=!0,this.ImportCols=r,this.ImportChunkSize=a.a.SessionManager.PersonalSettings.ContainsKey("ImportChunkSize")?a.a.SessionManager.PersonalSettings.ImportChunkSize:"5",this.SetVisibiltiFalse(),this.ImportVisiblity=!0,this.RightTabSelectedIndex=0;let J=this.IsImport?"Import":"Sort";this.DtImportObj.Height=300,a.a.page.ShowDialog(this,gt.a,{NoWidth:!0,Title:J});break;case"DistributeInstallments":let z="";if(this.ScreenObject.Preferences.ContainsKey("Distributebasedon")&&!n.e.IsEmpty(this.ScreenObject.Preferences.Distributebasedon)){let e=this.ScreenObject._TextFields.find(e=>e.DBColumnID.toString()==this.ScreenObject.Preferences.Distributebasedon);e&&e instanceof D.e&&!n.e.IsEmpty(e.SelectedValue)&&(z=e.SelectedValue.toLowerCase())}if(""==z&&(this.DisplayMessage=this.IsDateValid(null,""),""!=this.DisplayMessage))return;this.DistributeInstallments(z);break;case"FillDates":this.FillDates_Click();break;case"FillGeneralTimings":this.FillGeneralTimings_Click();break;case"GetAllEmployees":let Z=this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase());if(Z&&Z instanceof d.c&&!Z.Date)return this.DisplayMessage="Select the daily attendance date",void(Z.SetFocus=!0);null!=Z&&this.GetAllEmployees(Z.Date,this.DocID,this.strEmpFilter);break;case"GetPreviousDay":let $=this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase());if($&&$ instanceof d.c&&!$.Date)return this.DisplayMessage="Select the daily attendance date",void($.SetFocus=!0);this.GetPreviousDay($.Date);break;case"DailyAttendanceFilter":if(40097==this.CostCenterID){let e=this.ScreenObject._TextFields.find(e=>"dcalpha16"==e.DBColumnName.toLowerCase());if(null!=e&&e instanceof d.c&&!e.Date)return this.DisplayMessage="Select Payroll Month",void(e.SetFocus=!0);let t=new Date(e.Date.getFullYear(),e.Date.getMonth(),1),s=this.EmpFilter_Click(t);return void(s.length>0&&(this.ScreenObject.GridDataObj.Clear(),this.DoLateConsiderations(s),this.IsLatesProcessTimingsUpdated=!1))}this.strEmpFilter="",this.strEmpFilter=this.PopupEmployeesFilter("","DailyAttendanceFilter"),this.DailyAttendanceFilterTemp();break;case"Validate":if(67==this.DocumentType)return this.isDAValidate=!0,this.sDAErrLogs="",this.DisplayMessage=this.CheckDocumentValidations(""),this.isDAValidate=!1,""!=this.sDAErrLogs?(this.DisplayMessage=this.sDAErrLogs,void(this.MessageVisibility=!0)):(this.DisplayMessage="Validated Succesfully",void(this.MessageVisibility=!0));break;case"VacationContract":if(72==this.DocumentType&&this.ScreenObject.DocID>0){if(null==this.dtVacContract){let e=a.a.common.GetDataTable("DOC064",this.ScreenObject.DocID.toString());if(null!=e&&e.length>0){let t;this.dtVacContract=[];for(let s=0;s<e.length;s++)t={},t.Select=!0,t.SNo=e[s].Sno.toString(),t.ContractNodeID=e[s].ContractNodeID.toString(),t.ContractCode=e[s].ContractCode.toString(),t.ContractName=e[s].ContractName.toString(),t.ContractFrom=e[s].ContractFrom.toString(),t.ContractTo=e[s].ContractTo.toString(),t.CreditedDays=parseFloat(e[s].CreditedDays),t.PrevTakenDays=parseFloat(e[s].PrevTakenDays),t.BalanceDays=parseFloat(e[s].BalanceDays),t.CanAvail=parseFloat(e[s].CanAvail),this.dtVacContract.push(t)}}this.isVacPopup=!0,this.ApplyVacationContract(),this.isVacPopup=!1}break;case"TabsPopUp":const{DocOptionsComponent:ee}=yield s.e(0).then(s.bind(null,"TvXE")),{DocOptionsViewModel:te}=yield s.e(146).then(s.bind(null,"T8e8"));let se=new te(this,1);a.a.page.ShowDialog(se,ee,{ShowCenter:!0,NoWidth:!0});break;case"SkuSearch":let ie=new m.b;if(a.a.SessionManager.Preferences.ContainsKey("POSItemCodeDimension")&&n.e.Int(a.a.SessionManager.Preferences.POSItemCodeDimension)>5e4){var c=this.ScreenObject.ColumnSource.find(e=>e.CostCenterID.toString()==a.a.SessionManager.Preferences.POSItemCodeDimension);c&&this.ScreenObject.GridDataColumns.Contains(c.DisplayMember)&&(ie.CCID=parseInt(a.a.SessionManager.Preferences.POSItemCodeDimension),c?(ie.TypeID=c.TypeID,ie.Label=c.Header):(ie.TypeID=1,ie.Label="Stock Code"))}else{let e=this.ScreenObject.ColumnSource.find(e=>3==e.CostCenterID&&"ProductCode"==e.DisplayMember),t=new m.b;t.CCID=3,e?(t.TypeID=e.TypeID,t.Label=e.Header):(t.TypeID=1,t.Label="product"),t.SelectedValue=-1}let ae=new Ye.PactListSearchViewModel(ie);if(a.a.page.ShowDialog(ae,rt.a),ie.SelectedValue>0&&ie.SelectedValue>0){let e=this.GetEmptyRowPosition(this.ScreenObject.GridDataObj,"ProductID_Key"),t=this.ScreenObject.GridData[e];t.ProductID_Key=ie.SelectedValue,"0"==this.IsSales?(t.Quantity=-1,this.RowForegroundChange(t)):t.Quantity=1,this.ProdID=0,this.Celleditend(t,"ProductCode",3),this.PoleDisplayMessage(2,t)}else n.e.IsEmpty(ie.Text)||this.onSKUSearch(ie.Text);break;case"ReturnLine":null==this.SelectedRow||n.e.IsEmpty(this.SelectedRow.Quantity)||(this.SelectedRow.Quantity=-1*parseFloat(this.SelectedRow.Quantity),this.CalculateTotals(this.SelectedRow,!1,"Quantity"),this.RowForegroundChange(this.SelectedRow,parseFloat(this.SelectedRow.Quantity)>0));break;case"DeleteLine":null!=this.SelectedRow&&this.CanDeleteRow(this.SelectedRow)&&this.OnBeforeRowDeleting(this.SelectedRow,!0);break;case"Docs":let ne=new m.b;ne.CCID=400,ne.TypeID=2,ne.CustomWhere=" a.CostCenterID="+this.CostCenterID+" and dcCCNID"+(a.a.SessionManager.RegisterCCID-5e4).toString()+"="+this.ScreenObject.RegisterNodeID;let re=new Ye.PactListSearchViewModel(ne);a.a.page.ShowDialog(re,bt.a,{ShowCenter:!0,Title:a.a.GetResource("SelectDocument")}).subscribe(()=>{if(n.e.IsValidID(ne.SelectedValue)){let e={value:this._Ddate};this.ScreenObject.OnDocPrefixChanged("lostFocus",0,ne.SelectedValue,e,!0),this._Ddate=e.value}});break;case"SalesReturn":let oe=this.ButtonsLeft.find(e=>"SalesReturn"==e.ComParam);oe&&(n.e.IsEmpty(oe.ToolTipFooterDescription)&&(oe.ToolTipFooterDescription=oe.ToolTipDescription),oe.ToolTipFooterDescription==oe.ToolTipDescription?(oe.ToolTipDescription="#df4b33",this.IsSales="0"):(oe.ToolTipDescription=oe.ToolTipFooterDescription,this.IsSales="1"));break;case"AssignVPT":let ue=new jt(0,"AssignVPTFromDocument",this);a.a.page.ShowDialog(ue,Ot.a,{HideClose:!1,ShowCenter:!0,Title:a.a.GetResource("Assign")});break;case"Assign":if(this.ScreenObject.DocID>0){let e=new jt(0,this.ScreenObject.VoucherNo,this,1);a.a.page.ShowDialog(e,Ot.a,{HideClose:!1,ShowCenter:!0,Title:a.a.GetResource("Assign")})}}}}))}LoadPriceChart(){return Object(i.b)(this,void 0,void 0,(function*(){yield s.e(178).then(s.bind(null,"eClI"));const{AddPriceChartNewViewModel:e}=yield Promise.all([s.e(2),s.e(1),s.e(43),s.e(52)]).then(s.bind(null,"bSOb"));let t=new e("DOCUMENT",0,0);a.a.page.addNewTab({component:e,params:{obj:t}})}))}ShowEmailSMS(e){this.ScreenObject.IsDocEdit&&(369!=this.StatusID&&this.DoNotEmailSMSUnApprovedDocuments?this.DisplayMessage="Un-Approved Documents not allowed to Email/SMS":a.a.page.ShowDialog(new st.SendEmailSMSViewModel(e,this.CostCenterID,this.DocID,this),it.SendEmailSMSComponent))}SearchData(){try{let e=this.ScreenObject.HeaderFields.find(e=>e instanceof u.d&&e.DBColumnName==this.sSearchColName);null==e&&(e=this.ScreenObject._TextFields.find(e=>e instanceof u.d&&e.DBColumnName==this.sSearchColName)),null==e&&(e=this.ScreenObject._StaticFields.find(e=>e instanceof u.d&&e.DBColumnName==this.sSearchColName)),null!=e&&n.e.IsEmpty(e.Text)}catch(e){}}ConfirmDirtyRead(){return!(this.ScreenObject.IsDocEdit&&this.ScreenObject.IsDirty&&!confirm("Do you want to discard changes?"))}Redeposit(){for(let t=0;t<this.ScreenObject.GridData.length;t++){let e=1,s=1;a.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(o.j)(a.a.SessionManager.Preferences["Use Foreign Currency"])&&(this.Currency&&!n.e.IsEmpty(this.Currency.Currency.SelectedValue)?e=parseInt(this.Currency.Currency.SelectedValue):this.ScreenObject.GridDataColumns.Contains("CurrencyID")&&!n.e.IsEmpty(this.ScreenObject.GridData[t].CurrencyID_Key)&&(e=parseInt(this.ScreenObject.GridData[t].CurrencyID_Key)),null!=this.Currency&&null!=this.Currency.ExchangeRate.Text&&""!=this.Currency.ExchangeRate.Text?s=parseFloat(this.Currency.ExchangeRate.Text):this.ScreenObject.GridDataColumns.Contains("ExchangeRate")&&!n.e.IsEmpty(this.ScreenObject.GridData[t].ExchangeRate)&&(s=parseFloat(this.ScreenObject.GridData[t].ExchangeRate)));let i="",r="";if(r+="<BillWise><Row  ",i+="<XML><Row  ",i+='DocSeqNo="'+this.ScreenObject.GridData[t].DocSeqNo.toString()+'" ',r+='DocSeqNo="'+this.ScreenObject.GridData[t].DocSeqNo.toString()+'" ',14==this.DocumentType||15==this.DocumentType){if(!this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")||n.e.IsEmpty(this.ScreenObject.GridData[t].DebitAccount_Key)||n.e.IsEmpty(this.ScreenObject.GridData[t].Amount)){this.ScreenObject.GridData[t].ReturnXML="",this.ScreenObject.GridData[t].ExtraXML="";continue}i+='AccountID="'+this.ScreenObject.GridData[t].DebitAccount_Key.toString()+'" ',r+='AccountID="'+this.ScreenObject.GridData[t].DebitAccount_Key.toString()+'" ',i+='AmountFC="-'+this.ScreenObject.GridData[t].Amount.toString()+'" ',i+='AdjAmount="-'+parseFloat(this.ScreenObject.GridData[t].Amount)*s+'" ',i+='AdjExchRT="'+s.toString()+'" ',r+='AmountFC="'+this.ScreenObject.GridData[t].Amount.toString()+'" ',r+='AdjAmount="'+parseFloat(this.ScreenObject.GridData[t].Amount)*s+'" '}else{if(!this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")||n.e.IsEmpty(this.ScreenObject.GridData[t].CreditAccount_Key)||n.e.IsEmpty(this.ScreenObject.GridData[t].Amount)){this.ScreenObject.GridData[t].ReturnXML="",this.ScreenObject.GridData[t].ExtraXML="";continue}i+='AccountID="'+this.ScreenObject.GridData[t].CreditAccount_Key.toString()+'" ',r+='AccountID="'+this.ScreenObject.GridData[t].CreditAccount_Key.toString()+'" ',i+='AmountFC="'+this.ScreenObject.GridData[t].Amount.toString()+'" ',i+='AdjAmount="'+parseFloat(this.ScreenObject.GridData[t].Amount)*s+'" ',i+='AdjExchRT="'+s.toString()+'" ',r+='AmountFC="-'+this.ScreenObject.GridData[t].Amount.toString()+'" ',r+='AdjAmount="-'+parseFloat(this.ScreenObject.GridData[t].Amount)*s+'" '}i+='AdjCurrID="'+e.toString()+'" ',i+='IsNewReference="0" ',i+='RefDocNo="'+this.ScreenObject.VoucherNo+'" ',i+='RefDocSeqNo="'+this.ScreenObject.GridData[t].DocSeqNo.toString()+'" ',i+='RefDocDate="'+this.DocumentDate.ToString("dd/MMM/yyyy")+'" ',null!=this.ScreenObject.DueDate&&this.ScreenObject.DueDate.Date&&(i+='RefDocDueDate="'+this.ScreenObject.DueDate.Date.ToString("dd/MMM/yyyy")+'" '),i+='Narration="" ',i+='IsDocPDC="0" >',i+=" </Row>",i+=" </XML>",r+='AdjCurrID="'+s.toString()+'" ',r+='AdjExchRT="'+s.toString()+'" ',r+='IsNewReference="1" ',r+='Narration="" ',r+='IsDocPDC="0" ',r+=" ></Row>",r+=" </BillWise>",this.ScreenObject.GridData[t].DocDetailsID=0,this.ScreenObject.GridData[t].ReturnXML=i,1==Object(o.j)(this.ScreenObject.GridData[t].Type)&&(this.ScreenObject.GridData[t].ExtraXML=r.toString())}this.DocStatus="["+a.a.GetResource("Doc_Draft")+"]",this.ScreenObject.DocID=0,this.ScreenObject.RefCCId=0,this.ScreenObject.RefNodeID=0,this.DocumentDate=Date.Today(),this.SetNewDocButtonVisibility();let e=a.a.document.getcurrentcode(this.ScreenObject.CostCenterID,this.ScreenObject.Prefix);null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&!e.Columns[0].Contains("ErrorMessage")&&e.Columns[0].Contains("CurrentCodeNumber")&&""!=e.Tables[0][0].CurrentCodeNumber.toString().trim()&&(this.ScreenObject.DocPrefix.TextBox.Text=e.Tables[0][0].CurrentCodeNumber.toString())}FillPickDimensionofHistoryControls(){if(null!=this.ScreenObject&&this.ScreenObject.Data.Columns[0].Contains("IsHistory")){let e=[],t=this.ScreenObject.Data.Tables[0].filter(e=>1==e.IsHistory);if(t.length>0){let s=this.GetPrimaryColName();for(let i=0;i<t.length;i++)if(!e.Contains(t[i].LocalReference.toString())){e.push(t[i].LocalReference.toString());let a=this.ScreenObject.ColumnSource.find(e=>!n.e.IsEmpty(e.ID)&&e.ID==t[i].LocalReference.toString());if(a&&this.ScreenObject.GridDataColumns.Contains(a.ValueMember))for(let e=0;e<this.ScreenObject.GridData.length;e++)n.e.IsEmpty(this.ScreenObject.GridData[e][s])||n.e.IsEmpty(this.ScreenObject.GridData[e][a.ValueMember])||this.ScreenObject.GetLinkReferenceData(parseInt(a.ID),this.CostCenterID,parseInt(this.ScreenObject.GridData[e][a.ValueMember]),Date.Today(),a.DisplayMember,a.CostCenterID,this.ScreenObject.GridData[e],null,!1);else{let e=this.ScreenObject._CCFields.find(e=>e.DBColumnID.toString()==t[i].LocalReference.toString());e||(e=this.ScreenObject.HeaderFields.find(e=>e instanceof b.c&&e.DBColumnID==t[i].LocalReference)),(e instanceof m.b||e instanceof C.a)&&this.ScreenObject.GetLinkReferenceData(e.DBColumnID,this.CostCenterID,e.SelectedValue,this.DocumentDate,e.DBColumnName,e.CCID,null,null,!1)}}}}}ReEvaluate(e,t=!0){let s=0,i=!0;if(e&&this.FillPickDimensionofHistoryControls(),this.IsInventoryVoucher&&!this.ScreenObject.IsPayrollDocument)for(let r=0;r<this.ScreenObject.GridData.length;r++)n.e.IsEmpty(this.ScreenObject.GridData[r].ProductID_Key)||(t&&0==s&&a.a.SessionManager.Preferences.ContainsKey("PromptRatechange")&&Object(o.j)(a.a.SessionManager.Preferences.PromptRatechange)&&(confirm("Do you want to ReEvaluate price Chart?")||(i=!1)),s++,this.ReEvaluate_dr(this.ScreenObject.GridData[r],i));0==s&&(this.FillDictionary(null,!1),this.CalcTextFields())}ReEvaluatePriceTax(e,t=""){let s=0;if(this.IsInventoryVoucher&&!this.ScreenObject.IsPayrollDocument)for(let i=0;i<this.ScreenObject.GridData.length;i++)n.e.IsEmpty(this.ScreenObject.GridData[i].ProductID_Key)||(s++,this.ReEvaluatePriceTax_3(this.ScreenObject.GridData[i],e,t));0==s&&(this.FillDictionary(null,!1),this.CalcTextFields())}ReEvaluatePriceTax_3(e,t,s=""){this.ScreenObject.PriceTaxcc.ContainsKey(t)&&(s=this.ScreenObject.PriceTaxcc[t]);let i=1;i=n.e.Double(e.Quantity),0==i&&(i=1);let a=0;n.e.IsEmpty(e.Unit_Key)||(a=parseInt(e.Unit_Key));let r={};if(n.e.IsEmpty(e.ProductID_Key)||(r=this.ScreenObject.GetPriceTax(e.ProductID_Key.toString(),this.DocumentDate,a,i,e.DocDetailsID.toString(),e,s,this.Currency)),s.split(",").Contains("p")&&r.Tables.length>1)if(r.Tables[1].length>0){let t=this.ScreenObject.ColumnSource.find(e=>"Rate"==e.DisplayMember);n.e.IsEmpty(t.Formula)||!r.Columns[1].Contains(t.Formula)||n.e.IsEmpty(r.Tables[1][0][t.Formula])?1==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||10==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||31==this.ScreenObject.DocumentType?n.e.IsEmpty(r.Tables[1][0].PurchaseRate)||(e.Rate=r.Tables[1][0].PurchaseRate.toString(),e.defaultRate=r.Tables[1][0].PurchaseRate.toString()):n.e.IsEmpty(r.Tables[1][0].SellingRate)||(e.Rate=r.Tables[1][0].SellingRate.toString(),e.defaultRate=r.Tables[1][0].SellingRate.toString()):(e.Rate=r.Tables[1][0][t.Formula].toString(),e.defaultRate=r.Tables[1][0][t.Formula].toString()),this.FillSalesPurchase(e,r.Tables[1],r.Tables[1][0])}else this.FillSalesPurchase(e,r.Tables[1],null);if(n.e.IsEmpty(e.ProductID_Key)||parseInt(e.ProductID_Key)==this.ScreenObject.TempProductID||(s.split(",").Contains("a")&&(this.FillDatarow(e,r.Tables[0],null,{LocalReference:79,LinkData:23819},"AvgRate"),e.AVGRATE=r.Columns[0].Contains("AvgRate")&&!n.e.IsEmpty(r.Tables[0][0].AvgRate)?r.Tables[0][0].AvgRate.toString():0),s.split(",").Contains("s")&&(this.FillDatarow(e,r.Tables[0],null,{LocalReference:79,LinkData:25398},"QOH"),this.FillDatarow(e,r.Tables[0],null,{LocalReference:79,LinkData:52638},"QOH"),this.FillDatarow(e,r.Tables[0],null,{LocalReference:79,LinkData:52637},"BalQOH"),this.FillDatarow(e,r.Tables[0],null,{LocalReference:79,LinkData:26421},"HOLDQTY"),this.FillDatarow(e,r.Tables[0],null,{LocalReference:79,LinkData:50454},"CommittedQty"),this.FillDatarow(e,r.Tables[0],null,{LocalReference:79,LinkData:26422},"RESERVEQTY"),this.FillDatarow(e,r.Tables[0],null,{LocalReference:79,LinkData:499943},"TotalReserve"),e.QOH=r.Columns[0].Contains("QOH")&&!n.e.IsEmpty(r.Tables[0][0].QOH)?r.Tables[0][0].QOH.toString():0,e.BalQOH=r.Columns[0].Contains("BalQOH")&&!n.e.IsEmpty(r.Tables[0][0].BalQOH)?r.Tables[0][0].BalQOH.toString():0,e.HOLDQTY=r.Columns[0].Contains("HOLDQTY")&&!n.e.IsEmpty(r.Tables[0][0].HOLDQTY)?r.Tables[0][0].HOLDQTY.toString():0,e.CommittedQty=r.Columns[0].Contains("CommittedQty")&&!n.e.IsEmpty(r.Tables[0][0].CommittedQty)?r.Tables[0][0].CommittedQty.toString():0,e.RESERVEQTY=r.Columns[0].Contains("RESERVEQTY")&&!n.e.IsEmpty(r.Tables[0][0].RESERVEQTY)?r.Tables[0][0].RESERVEQTY.toString():0,e.TotalReserve=r.Columns[0].Contains("TotalReserve")&&!n.e.IsEmpty(r.Tables[0][0].TotalReserve)?r.Tables[0][0].TotalReserve.toString():0)),s.split(",").Contains("t")&&r.Tables.length>2&&this.ScreenObject.ColumnSource.filter(e=>e.DisplayMember.Contains("dcNum")&&4!=e.SectionID).forEach(t=>{let s=r.Tables[2].filter(e=>e.SysColumnName==t.DisplayMember);s.length>0?(e[t.DisplayMember]=s[0].Value.toString(),e["default"+t.DisplayMember]=s[0].Value.toString()):t.IsReEvaluate&&(e[t.DisplayMember]=0,e["default"+t.DisplayMember]=0)}),null!=this.AutoPostViewModel){let s=this.ScreenObject._CCFields.find(e=>e instanceof m.b&&e.CCID==t),i=this.AutoPostViewModel.ScreenObject._CCFields.find(e=>e instanceof m.b&&e.CCID==t);s&&i&&(i.SelectedValue=s.SelectedValue,i.SelectedValueText=s.Text);let a=this.AutoPostViewModel.ScreenObject.GridData.find(t=>t.RefSeqNo==e.RefSeqNo);a.forEach(s=>{n.e.IsEmpty(s.defaultQuantity)||parseFloat(e.Quantity)*parseFloat(s.defaultQuantity)==parseFloat(s.Quantity)||(s.Quantity=parseFloat(e.Quantity)*parseFloat(s.defaultQuantity),n.e.IsEmpty(s.Quantity)||n.e.IsEmpty(s.UOMConversion)||!n.e.IsNum(s.UOMConversion)?n.e.IsEmpty(s.Quantity)||(s.UOMConvertedQty=s.Quantity.toString()):s.UOMConvertedQty=n.e.Double(s.UOMConversion)*parseFloat(s.Quantity)),this.AutoPostViewModel.ReEvaluatePriceTax_3(e,t)});let r=0;a.forEach(e=>{n.e.IsEmpty(e.Gross)||(r+=parseFloat(e.Gross))}),n.e.IsEmpty(e.Quantity)||(e.Rate=r/parseFloat(e.Quantity))}this.CalculateTotals(e,!1)}ReEvaluate_dr(e,t=!0){let s=0;n.e.IsEmpty(e.Unit_Key)||(s=parseInt(e.Unit_Key));let i=this.GetProductValues(e,s,!1,null,!0);if(t&&this.FillRates(i,e),this.ScreenObject.ColumnSource.filter(e=>e.DisplayMember.Contains("dcNum")&&4!=e.SectionID).forEach(t=>{if(i.Tables.length>4){let s=i.Tables[4].filter(e=>e.SysColumnName==t.DisplayMember);s.length>0?(e[t.DisplayMember]=s[0].Value.toString(),e["default"+t.DisplayMember]=s[0].Value.toString()):t.IsReEvaluate&&(e[t.DisplayMember]=0,e["default"+t.DisplayMember]=0)}}),null!=this.AutoPostViewModel){this.AutoPostViewModel.ScreenObject._CCFields.forEach(e=>{let t=this.ScreenObject._CCFields.find(t=>t.DBColumnName==e.DBColumnName);t&&e instanceof m.b&&t instanceof m.b&&(e.SelectedValue=t.SelectedValue,e.SelectedValueText=t.Text)});let t=this.AutoPostViewModel.ScreenObject.GridData.find(t=>t.RefSeqNo==e.RefSeqNo);t.forEach(t=>{n.e.IsEmpty(t.defaultQuantity)||parseFloat(e.Quantity)*parseFloat(t.defaultQuantity)==parseFloat(t.Quantity)||(t.Quantity=parseFloat(e.Quantity)*parseFloat(t.defaultQuantity),n.e.IsEmpty(t.Quantity)||n.e.IsEmpty(t.UOMConversion)||!n.e.IsNum(t.UOMConversion)?n.e.IsEmpty(t.Quantity)||(t.UOMConvertedQty=t.Quantity.toString()):t.UOMConvertedQty=n.e.Double(t.UOMConversion)*parseFloat(t.Quantity)),s=0,n.e.IsEmpty(e.Unit_Key)||(s=parseInt(e.Unit_Key));let i=this.AutoPostViewModel.GetProductValues(e,s,!1,null,!0);this.AutoPostViewModel.FillRates(i,t),this.AutoPostViewModel.CalculateTotals(t,!1)});let i=0;t.forEach(e=>{n.e.IsEmpty(e.Gross)||(i+=parseFloat(e.Gross))}),n.e.IsEmpty(e.Quantity)||(e.Rate=i/parseFloat(e.Quantity))}if("8"==e.Type.toString()||"3"==e.Type.toString()){let s=new re(this,e,null);for(let e=0;e<s.GridData.length;e++)""!=n.e.StringValue(s.GridData[e].ProductID_Key).toString()&&this.ReEvaluate_dr(s.GridData[e],t);s.OnButtonClick("AutoSave")}this.CalculateTotals(e,!1)}ConvertCase(){return Object(i.b)(this,void 0,void 0,(function*(){{const{AddEditCaseComponent:e}=yield s.e(128).then(s.bind(null,"il++")),{AddEditCasesViewModel:t}=yield Promise.all([s.e(8),s.e(23),s.e(35),s.e(127)]).then(s.bind(null,"Hzm0"));let i=new t(0,1,!0);if(i.RefCCID=this.CostCenterID,i.RefNodeID=this.ScreenObject.DocID,this.ScreenObject.Data.Tables.length>20&&this.ScreenObject.Data.Columns[20].Contains("DocumentLinkDefID")){let e=this.ScreenObject.Data.Tables[20].filter(e=>2==e.Mode&&73==e.CostCenterIDBase);if(e.length>0){let t=this.ScreenObject.GetCaseLinkDetails(e[0].DocumentLinkDefID.toString());if(null!=t&&t.Tables.length>0&&t.Columns[0].Contains("BASECOL")){let e;for(let s=0;s<t.Tables[0].length;s++)if(!n.e.IsEmpty(t.Tables[0][s].LINKCOL)){let a="",r="",o=t.Tables[0][s].LINKCOL.toString(),l=t.Tables[0][s].BASECOL.toString();if(this.ScreenObject.GridDataColumns.Contains(o)||"productid"==l.toLowerCase()){let e=this.ScreenObject.ColumnSource.find(e=>"Name"!=e.DisplayMember&&e.DisplayMember==o);if(e||(e=this.ScreenObject.ColumnSource.find(e=>"Name"==e.DisplayMember&&e.ValueBinding==o)),e||(e=this.ScreenObject.ColumnSource.find(e=>""!=e.ValueMember&&e.ValueMember==o+"_Key")),e&&(e.CostCenterID>0&&this.ScreenObject.GridDataColumns.Contains(e.ValueMember)&&!n.e.IsEmpty(this.ScreenObject.GridData[0][e.ValueMember])?a=this.ScreenObject.GridData[0][e.ValueMember].toString():"DATE"!=e.DataType&&"DateTime"!=e.DataType&&0!=n.e.stringCompare(e.DataType,"Time",!0)||!this.ScreenObject.GridDataColumns.Contains(e.DisplayMember+"_Key")||n.e.IsEmpty(this.ScreenObject.GridData[0][e.DisplayMember+"_Key"])?"Name"==e.DisplayMember&&this.ScreenObject.GridDataColumns.Contains(e.ValueBinding)&&!n.e.IsEmpty(this.ScreenObject.GridData[0][e.ValueBinding])?a=this.ScreenObject.GridData[0][e.ValueBinding].toString():this.ScreenObject.GridDataColumns.Contains(e.DisplayMember)&&!n.e.IsEmpty(this.ScreenObject.GridData[0][e.DisplayMember])&&(a=this.ScreenObject.GridData[0][e.DisplayMember].toString()):n.e.isValidDate(this.ScreenObject.GridData[0][e.DisplayMember+"_Key"].toString())&&(a=new Date(this.ScreenObject.GridData[0][e.DisplayMember+"_Key"]).toString()),("productid"==l.toLowerCase()||"uomid"==l.toLowerCase()||"quantity"==l.toLowerCase()||"description"==l.toLowerCase()||l.Contains("Alpha")&&!l.Contains("acAlpha"))&&null!=i.ProductGrid&&null!=i.ProductGrid.ProductGrid&&this.ScreenObject.GridDataColumns.Contains("ProductID_Key"))){for(let t=0;t<this.ScreenObject.GridData.length;t++)!n.e.IsEmpty(this.ScreenObject.GridData[t].ProductID_Key)&&parseInt(this.ScreenObject.GridData[t].ProductID_Key)>0&&(i.ProductGrid.ProductGrid.length<t+1&&i.ProductGrid.ProductGrid.push(),"productid"==l.toLowerCase()&&i.ProductGrid.ProductGridObj.TableColumns.Contains("Product_Key")?(this.ScreenObject.GridDataColumns.Contains("ProductName")&&(i.ProductGrid.ProductGrid[t].ProductName=this.ScreenObject.GridData[t].ProductName.toString()),this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(i.ProductGrid.ProductGrid[t].ProductCode=this.ScreenObject.GridData[t].ProductCode.toString()),i.ProductGrid.ProductGrid[t].Product_Key=this.ScreenObject.GridData[t].ProductID_Key.toString()):"uomid"==l.toLowerCase()&&i.ProductGrid.ProductGridObj.TableColumns.Contains("UOM_Key")?(i.ProductGrid.ProductGrid[t].UOM=this.ScreenObject.GridData[t].Unit.toString(),i.ProductGrid.ProductGrid[t].UOM_Key=this.ScreenObject.GridData[t].Unit_Key.toString()):"quantity"==l.toLowerCase()&&i.ProductGrid.ProductGridObj.TableColumns.Contains("QTY")?i.ProductGrid.ProductGrid[t].QTY=this.ScreenObject.GridData[t][e.DisplayMember].toString():i.ProductGrid.ProductGridObj.TableColumns.Contains(l)&&(i.ProductGrid.ProductGrid[t][l]=this.ScreenObject.GridData[t][e.DisplayMember].toString()));a=""}}else{let e=this.ScreenObject._TextFields.find(e=>e.DBColumnName==o);if(e||(e=this.ScreenObject._CCFields.find(e=>e.DBColumnName==o)),e||(e=this.ScreenObject._StaticFields.find(e=>e.DBColumnName==o)),!e)for(let t=0;t<this.ScreenObject.HeaderFields.length;t++){const s=this.ScreenObject.HeaderFields[t];if("docdate"==o.toLowerCase()&&s instanceof d.d){a=this.DocumentDate.toString();break}s instanceof b.c&&s.DBColumnName.toLowerCase()==o.toLowerCase()&&(e=s)}e&&(r="",e instanceof d.c?e.Date&&(a=e.Date.toString()):e instanceof d.a?a=e.Date.toString():e instanceof m.b?e.SelectedValue>0&&(a=e.SelectedValue.toString(),r=e.Text.toString()):e instanceof C.a?e.SelectedValue>0&&(a=e.SelectedValue.toString()):e instanceof u.d||e instanceof u.c||e instanceof g.a?a=e.Text:e instanceof D.e&&(a=e.SelectedValue))}""==a||n.e.IsEmpty(t.Tables[0][s].BASECOL)||("CreateDate"==l?n.e.isValidDate(a)&&(i.CaseDate.Date=new Date(a)):"CaseNumber"==l?i.CName.Text=r.length>0&&""!=r?r:a:"CustomerID"==l?(e=n.e.Int(a),e>0&&(i.Customer.SelectedValue=e)):"ServiceLvlLookupID"==l?(e=n.e.Int(a),e>0&&(i.ServiceLevel.SelectedValue=e)):"Remarks"==l?i.Comments.Text=a:(l.toLowerCase().Contains("acalpha")||l.toLowerCase().Contains("ccnid"))&&i.ScreenObject.CustomTab.Pages.forEach(e=>{e.Fields.forEach(e=>{e instanceof u.d&&e.DBColumnName.toLowerCase()==l.toLowerCase()&&(e.Text=a),e instanceof D.e&&e.DBColumnName.toLowerCase()==l.toLowerCase()?e.SelectedValue=a:e instanceof m.b&&e.DBColumnName.toLowerCase()==l.toLowerCase()&&n.e.Int(a)>0&&(e.SelectedValue=parseInt(a))})}))}}}}a.a.page.addNewTab({component:e,params:{obj:i}})}}))}setStatusColor(){this.StatusColor=this.DocStatus.startsWith("["+a.a.GetResource("Doc_Draft")+"]")?a.a.SessionManager.Preferences.DraftColor:this.DocStatus.startsWith("[Partial]")?a.a.SessionManager.Preferences.partialColor:369==this.StatusID?a.a.SessionManager.Preferences.PostedColor:370==this.StatusID?a.a.SessionManager.Preferences.PDCColor:371==this.StatusID?a.a.SessionManager.Preferences.UnApprovedColor:372==this.StatusID?a.a.SessionManager.Preferences.RejectedColor:376==this.StatusID?a.a.SessionManager.Preferences.CancelledColor:429==this.StatusID?a.a.SessionManager.Preferences.BouncedColor:441==this.StatusID?a.a.SessionManager.Preferences.ApprovedColor:"#FF736F6F",9==this.StatusColor.length&&(this.StatusColor.startsWith("#FF")||this.StatusColor.startsWith("#ff"))&&(this.StatusColor="#"+this.StatusColor.substr(3))}static getStatusColor(e){let t="#fff";return t=369==e?a.a.SessionManager.Preferences.PostedColor:370==e?a.a.SessionManager.Preferences.PDCColor:371==e?a.a.SessionManager.Preferences.UnApprovedColor:372==e?a.a.SessionManager.Preferences.RejectedColor:376==e?a.a.SessionManager.Preferences.CancelledColor:429==e?a.a.SessionManager.Preferences.BouncedColor:441==e?a.a.SessionManager.Preferences.ApprovedColor:"#FF736F6F",9==t.length&&(t.startsWith("#FF")||t.startsWith("#ff"))&&(t="#"+t.substr(3)),t}SaveStatus(e,t,s,i=!0){let n=this.ScreenObject.SetDocStatus(e,t,s,this.AppRejDate.Date,this.Remarks.Text,!0,i?this.ScreenObject.guid:"");null!=n&&n.Tables.length>0&&n.Tables[0].length>0&&n.Columns[0].Contains("status")&&(a.a.SessionManager.RefreshNotification(),this.DocStatus="["+n.Tables[0][0].status.toString()+"]",this.AppRejDate.Date=new Date,this.Remarks.Text="",this.ButtonApprove.Visible=!1,this.SetVisibiltiFalse(),this.IsPOs||this.SetDefaultRightPanel()),null!=n&&n.Tables.length>0&&n.Tables[n.Tables.length-1].length>0&&n.Columns[n.Columns.length-1].Contains("ErrorMessage")&&(this.DisplayMessage=n.Tables[n.Tables.length-1][0].ErrorMessage.toString()),this.clear(2)}SetDefaultRightPanel(){if(72==this.DocumentType)this.onButtonClick("VacCrDaysDetail");else if(this.ScreenObject.Preferences.ContainsKey("DefaultRightView")&&""!=this.ScreenObject.Preferences.DefaultRightView)switch(this.ScreenObject.Preferences.DefaultRightView){case"Notes":this.onButtonClick("Notes");break;case"Import":this.onButtonClick("ImportVisiblity");break;case"Sort":this.onButtonClick("SortVisiblity");break;case"Attachments":this.RightTabSelectedIndex=5;break;case"Search":this.onButtonClick("Search");break;case"Documents":this.onButtonClick("Documents");break;case"reports":default:this.ReportInfoVisibility=!this.IsMobile,this.RightTabSelectedIndex=1}else this.ReportInfoVisibility=!this.IsMobile}SaveLinkStatus(e){if(n.e.IsEmpty(this.Remarks.Text)&&this.ScreenObject.Preferences.ContainsKey("LinkStatusRemarksMandatory")&&""!=this.ScreenObject.Preferences.LinkStatusRemarksMandatory&&Object(o.j)(this.ScreenObject.Preferences.LinkStatusRemarksMandatory))return void(this.DisplayMessage="Enter remarks");let t=this.ScreenObject.SetDocLinkStatus(e,this.AppRejDate.Date,this.Remarks.Text);null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&t.Columns[0].Contains("status")&&(this.DocStatus="["+t.Tables[0][0].status.toString()+"]",this.DocStatus="["+a.a.GetResource(n.e.String(t.Tables[0][0].status).Replace("-","_").Replace(" ",""))+"]",this.AppRejDate.Date=new Date,this.Remarks.Text="",this.SuspendVisiblity=!1,this.SetVisibiltiFalse(),this.IsPOs||this.SetDefaultRightPanel()),null!=t&&t.Tables.length>0&&t.Tables[t.Tables.length-1].length>0&&t.Columns[t.Columns.length-1].Contains("ErrorMessage")&&(this.DisplayMessage=t.Tables[t.Tables.length-1][0].ErrorMessage.toString())}DeleteDocument(){Logger.InfoLog("AddEditDocumentViewModel::Entering DeleteDocument"),this.IsSuspend=!1,confirm(a.a.GetResource("DeleteMessage"))&&this.OnDeleteCallBack(),Logger.InfoLog("AddEditDocumentViewModel::Exiting DeleteDocument")}ConstructFormulaFields(){this.fldDict=new r.a,this.FooterDics=new r.a;let e=new O.c;if(e.setFieldDetails("RATE",1,1,"",1,!1,!1),this.fldDict.push("RATE",e),e=new O.c,e.setFieldDetails("NET",2,1,"",1,!1,!1),this.fldDict.push("NET",e),e=new O.c,e.setFieldDetails("AVGRT",3,1,"",1,!1,!1),this.fldDict.push("AVGRT",e),e=new O.c,e.setFieldDetails("QTY",4,1,"",1,!1,!1),this.fldDict.push("QTY",e),e=new O.c,e.setFieldDetails("GROSS",5,1,"",1,!1,!1),this.fldDict.push("GROSS",e),e=new O.c,e.setFieldDetails("LSTPRCHSRT",6,1,"",1,!1,!1),this.fldDict.push("LSTPRCHSRT",e),e=new O.c,e.setFieldDetails("LSTLNDGRT",7,1,"",1,!1,!1),this.fldDict.push("LSTLNDGRT",e),e=new O.c,e.setFieldDetails("CONVQTY",8,1,"",1,!1,!1),this.fldDict.push("CONVQTY",e),e=new O.c,e.setFieldDetails("UNITS",9,1,"",1,!1,!1),this.fldDict.push("UNITS",e),e=new O.c,e.setFieldDetails("BASEQTY",10,1,"",1,!1,!1),this.fldDict.push("BASEQTY",e),e=new O.c,e.setFieldDetails("EXCHRT",11,1,"",1,!1,!1),this.fldDict.push("EXCHRT",e),e=new O.c,e.setFieldDetails("HOLDQTY",16,1,"",1,!1,!1),this.fldDict.push("HOLDQTY",e),e=new O.c,e.setFieldDetails("CommittedQty",18,1,"",1,!1,!1),this.fldDict.push("CommittedQty",e),e=new O.c,e.setFieldDetails("RESERVEQTY",17,1,"",1,!1,!1),this.fldDict.push("RESERVEQTY",e),e=new O.c,e.setFieldDetails("TotalReserve",19,1,"",1,!1,!1),this.fldDict.push("TotalReserve",e),e=new O.c,e.setFieldDetails("QOH",12,1,"",1,!1,!1),this.fldDict.push("QOH",e),e=new O.c,e.setFieldDetails("BalQOH",19,1,"",1,!1,!1),this.fldDict.push("BalQOH",e),e=new O.c,e.setFieldDetails("MRate",13,1,"",1,!1,!1),this.fldDict.push("MRate",e),e=new O.c,e.setFieldDetails("RRate",14,1,"",1,!1,!1),this.fldDict.push("RRate",e),e=new O.c,e.setFieldDetails("SRate",15,1,"",1,!1,!1),this.fldDict.push("SRate",e),e=new O.c,e.setFieldDetails("DOCDATE",20,1,"",1,!1,!1),this.fldDict.push("DOCDATE",e),e=new O.c,e.setFieldDetails("ServerDate",23,1,"",1,!1,!1),this.fldDict.push("ServerDate",e),e=new O.c,e.setFieldDetails("DUEDATE",21,1,"",1,!1,!1),this.fldDict.push("DUEDATE",e),e=new O.c,e.setFieldDetails("BILLDATE",22,1,"",1,!1,!1),this.fldDict.push("BILLDATE",e),e=new O.c,e.setFieldDetails("UOMCONVERSION",23,1,"",1,!1,!1),this.fldDict.push("UOMCONVERSION",e),e=new O.c,e.setFieldDetails("MaturityDate",24,1,"",1,!1,!1),this.fldDict.push("MaturityDate",e),e=new O.c,e.setFieldDetails("DocPrefix",25,1,"","",!1,!1),this.fldDict.push("DocPrefix",e),e=new O.c,e.setFieldDetails("FreeQTY",4,1,"",1,!1,!1),this.fldDict.push("FreeQTY",e),this.ScreenObject.ColumnSource.forEach(t=>{let s=t.lbl;t.IsColumnUserDefined&&t.DisplayMember.Contains("dcNum")&&!this.fldDict.ContainsKey(s)?(e=new O.c,e.setFieldDetails(s,3,1,"",0,!1,!1),this.fldDict.push(s,e),e=new O.c,e.setFieldDetails("Calc"+s,3,1,"",0,!1,!1),this.fldDict.push("Calc"+s,e),e=new O.c,e.setFieldDetails(s+"EXRT",3,1,"",0,!1,!1),this.fldDict.push(s+"EXRT",e),this.CheckMaxMinFormula_1(s)):this.fldDict.ContainsKey(s)||(e=new O.c,e.setFieldDetails(s,3,1,"",0,!1,!1),this.fldDict.push(s,e))}),this.ScreenObject._CCFields.forEach(t=>{this.fldDict.ContainsKey(t.Lbl)||(e=new O.c,e.setFieldDetails(t.Lbl,3,1,"",0,!1,!1),this.fldDict.push(t.Lbl,e))}),this.ScreenObject.HeaderFields.forEach(t=>{t instanceof b.c&&!n.e.IsEmpty(t.Lbl)&&!this.fldDict.ContainsKey(t.Lbl)&&(e=new O.c,e.setFieldDetails(t.Lbl,3,1,"",0,!1,!1),this.fldDict.push(t.Lbl,e))}),this.ScreenObject._TextFields.forEach(t=>{this.fldDict.ContainsKey(t.Lbl)||(e=new O.c,e.setFieldDetails(t.Lbl,3,1,"",0,!1,!1),this.fldDict.push(t.Lbl,e))}),null==this.ScreenObject.CreditAccount||this.fldDict.ContainsKey(this.ScreenObject.CreditAccount.Lbl)||(e=new O.c,e.setFieldDetails(this.ScreenObject.CreditAccount.Lbl,3,1,"",0,!1,!1),this.fldDict.push(this.ScreenObject.CreditAccount.Lbl,e)),null==this.ScreenObject.DebitAccount||this.fldDict.ContainsKey(this.ScreenObject.DebitAccount.Lbl)||(e=new O.c,e.setFieldDetails(this.ScreenObject.DebitAccount.Lbl,3,1,"",0,!1,!1),this.fldDict.push(this.ScreenObject.DebitAccount.Lbl,e)),null!=this.POSPayModes&&null!=this.POSPayModes.PayModes)for(let t=0;t<this.POSPayModes.PayModes.length;t++)e=new O.c,e.setFieldDetails(this.POSPayModes.PayModes[t].Lbl,3,1,"",0,!1,!1),this.fldDict.push(this.POSPayModes.PayModes[t].Lbl,e);for(let t=0;t<this.fldDict.keys.length;t++)this.FooterDics.push(this.fldDict.keys[t],this.fldDict.values[t].Clone())}CheckMaxMinFormula(e,t){let s=new O.c;null!=t&&t.Contains("Max"+e)&&!this.fldDict.ContainsKey("Max"+e)&&(s=new O.c,s.setFieldDetails("Max"+e,3,1,"",0,!1,!1),this.fldDict.push("Max"+e,s)),null!=t&&t.Contains("MaxCalc"+e)&&!this.fldDict.ContainsKey("MaxCalc"+e)&&(s=new O.c,s.setFieldDetails("MaxCalc"+e,3,1,"",0,!1,!1),this.fldDict.push("MaxCalc"+e,s)),null!=t&&t.Contains("Min"+e)&&!this.fldDict.ContainsKey("Min"+e)&&(s=new O.c,s.setFieldDetails("Min"+e,3,1,"",0,!1,!1),this.fldDict.push("Min"+e,s)),null!=t&&t.Contains("MinCalc"+e)&&!this.fldDict.ContainsKey("MinCalc"+e)&&(s=new O.c,s.setFieldDetails("MinCalc"+e,3,1,"",0,!1,!1),this.fldDict.push("MinCalc"+e,s))}IsExpressionAvailable(e){for(let t=0;t<this.ScreenObject.ColumnSource.length;t++){let s=this.ScreenObject.ColumnSource[t];if(null!=s.Formula&&s.Formula.Contains(e))return!0}if(null!=this.ScreenObject.FooterDataBind&&this.ScreenObject.FooterDataBindColumns.Contains("Formula"))for(let t=0;t<this.ScreenObject.FooterDataBind.length;t++)if(n.e.String(this.ScreenObject.FooterDataBind[t].Formula).Contains(e))return!0;if(this.ScreenObject.Data.Tables.length>10){if(this.ScreenObject.Data.Columns[10].Contains("Expression"))for(let t=0;t<this.ScreenObject.Data.Tables[10].length;t++)if(n.e.String(this.ScreenObject.Data.Tables[10][t].Expression).Contains(e))return!0;if(this.ScreenObject.Data.Columns[9].Contains("Expression"))for(let t=0;t<this.ScreenObject.Data.Tables[9].length;t++)if(n.e.String(this.ScreenObject.Data.Tables[9][t].Expression).Contains(e))return!0}return!1}CheckMaxMinFormula_1(e){if(this.ScreenObject.ColumnSource.forEach(t=>{this.CheckMaxMinFormula(e,t.Formula)}),null!=this.ScreenObject.FooterDataBind&&this.ScreenObject.FooterDataBindColumns.Contains("Formula"))for(let t=0;t<this.ScreenObject.FooterDataBind.length;t++)this.CheckMaxMinFormula(e,n.e.String(this.ScreenObject.FooterDataBind[t].Formula));if(this.ScreenObject.Data.Tables.length>10){if(this.ScreenObject.Data.Columns[10].Contains("Expression"))for(let t=0;t<this.ScreenObject.Data.Tables[10].length;t++)this.CheckMaxMinFormula(e,n.e.String(this.ScreenObject.Data.Tables[10][t].Expression));if(this.ScreenObject.Data.Columns[9].Contains("Expression"))for(let t=0;t<this.ScreenObject.Data.Tables[9].length;t++)this.CheckMaxMinFormula(e,n.e.String(this.ScreenObject.Data.Tables[9][t].Expression))}}ChangeDateIfDateExists(e){try{let t=!1,s=this.ScreenObject.Data.Tables[8].filter(e=>0==e.SeriesNo);s.sort((e,t)=>e.PrefixOrder-t.PrefixOrder);let i=0,r=0,o=0,l=0,c=0,h=0;for(let u=0;u<s.length;u++)51==parseInt(s[u].CCID)||52==parseInt(s[u].CCID)||53==parseInt(s[u].CCID)?(t=!0,n.e.IsEmpty(s[u].Delimiter)?"D"==s[u].Length.toString()?i>=0&&e.length>=i+2&&n.e.IsNum(e.substr(i,2))&&parseInt(e.substr(i,2))<31?(c=parseInt(e.substr(i,2)),i+=2):n.e.IsNum(e.substr(i,1))&&(c=parseInt(e.substr(i,1)),i++):"DD"==s[u].Length.toString()?i>=0&&e.length>=i+2&&n.e.IsNum(e.substr(i,2))&&parseInt(e.substr(i,2))<31&&(c=parseInt(e.substr(i,2)),i+=2):"MM"==s[u].Length.toString()?i>=0&&e.length>=i+2&&n.e.IsNum(e.substr(i,2))&&parseInt(e.substr(i,2))<13&&(l=parseInt(e.substr(i,2)),i+=2):"M"==s[u].Length.toString()?i>=0&&e.length>=i+2&&n.e.IsNum(e.substr(i,2))&&parseInt(e.substr(i,2))<13?(l=parseInt(e.substr(i,2)),i+=2):n.e.IsNum(e.substr(i,1))&&(l=parseInt(e.substr(i,1)),i++):"MMM"==s[u].Length.toString()?i>=0&&e.length>=i+3&&(l=this.ScreenObject.GetMonthNo(e.substr(i,3)),i+=3):"YY"==s[u].Length.toString()?i>=0&&e.length>=i+2&&n.e.IsNum(e.substr(i,2))&&(o=parseInt(e.substr(i,2))+2e3,i+=2):"YYYY"==s[u].Length.toString()?i>=0&&e.length>=i+4&&n.e.IsNum(e.substr(i,4))&&(o=parseInt(e.substr(i,4)),i+=4):"YY-YY"==s[u].Length.toString()&&i>=0&&e.length>i+5&&n.e.IsNum(e.substr(i,2))&&n.e.IsNum(e.substr(i+3,2))&&(o=0==l?a.a.SessionManager.AccountingToMonth<(new Date).iMonth()?parseInt(e.substr(i,2))+2e3:parseInt(e.substr(i+3,2))+2e3:a.a.SessionManager.AccountingToMonth<l?parseInt(e.substr(i,2))+2e3:parseInt(e.substr(i+3,2))+2e3,i+=5):(r=e.indexOf(s[u].Delimiter.toString(),i),r>0&&(n.e.IsNum(e.substr(i,r-i))?(h=n.e.Int(e.substr(i,r-i)),51==parseInt(s[u].CCID)?c=parseInt(e.substr(i,r-i)):52==parseInt(s[u].CCID)?l=parseInt(e.substr(i,r-i)):53==parseInt(s[u].CCID)&&(o="YY"==s[u].Length.toString()&&r-i==2?parseInt(e.substr(i,r-i))+2e3:parseInt(e.substr(i,r-i))),i=r+1):"YY-YY"==s[u].Length.toString()&&(i>=0&&e.length>=i+5&&n.e.IsNum(e.substr(i,2))&&n.e.IsNum(e.substr(i+3,2))&&(o=0==l?a.a.SessionManager.AccountingToMonth<(new Date).iMonth()?parseInt(e.substr(i,2))+2e3:parseInt(e.substr(i+3,2))+2e3:a.a.SessionManager.AccountingToMonth<l?parseInt(e.substr(i,2))+2e3:parseInt(e.substr(i+3,2))+2e3),i=r+1)))):n.e.IsEmpty(s[u].Delimiter)?n.e.IsNum(s[u].Length)&&(i+=parseInt(s[u].Length)):(r=e.indexOf(s[u].Delimiter.toString(),i),r>0&&(i=r+1));if(t&&(o>0||l>0||c>0)){if(o>0&&this.DocumentDate.getFullYear()==o||l>0&&this.DocumentDate.iMonth()==l||c>0&&this.DocumentDate.getDate()==c)return;0==o&&(o=(new Date).getFullYear()),0==l&&(l=a.a.SessionManager.AccountingToMonth,a.a.SessionManager.AccountingFromMonth>a.a.SessionManager.AccountingToMonth&&0==o&&(o=(new Date).iMonth()<a.a.SessionManager.AccountingFromMonth?(new Date).getFullYear():(new Date).getFullYear()+1)),0==c&&(c=new Date(o,l,1).DaysInMonth()),this._Ddate=new Date(o,l,c)}}catch(t){Logger.ErrorLog("addeditdocument","ChangeDateifDateExists","CheckDateinPrefix",t)}}CheckDateInDocNumber(e,t=!0){let s=!1,i="";if(null==this.ScreenObject.DocPrefix)return;let o=new r.a;if(this.ScreenObject.DocPrefix.Prefixes.keys.forEach(e=>{null!=e&&(i=e);let r=this.ScreenObject.DocPrefix.Prefixes[e];i.Contains("'DD'")?(s=!0,i=this.DocumentDate.getDate()>9?i.replace("'DD'",this.DocumentDate.getDate().toString()):i.replace("'DD'","0"+this.DocumentDate.getDate().toString())):i.Contains("'D'")&&(s=!0,i=i.replace("'D'",this.DocumentDate.getDate().toString())),i.Contains("'MMM'")?(s=!0,i=i.replace("'MMM'",this.ScreenObject.GetMonthName(this.DocumentDate.iMonth(),!1))):i.Contains("'MM'")?(s=!0,i=this.DocumentDate.iMonth()>9?i.replace("'MM'",this.DocumentDate.iMonth().toString()):i.replace("'MM'","0"+this.DocumentDate.iMonth().toString())):i.Contains("'M'")?(s=!0,i=i.replace("'M'",this.DocumentDate.iMonth().toString())):i.Contains("'Name'")&&(s=!0,i=i.replace("'Name'",this.ScreenObject.GetMonthName(this.DocumentDate.iMonth(),!0))),i.Contains("'YYYY'")?(s=!0,i=i.replace("'YYYY'",this.DocumentDate.getFullYear().toString())):i.Contains("'YY'")?(s=!0,i=i.replace("'YY'",this.DocumentDate.getFullYear().toString().substr(2))):i.Contains("'YY-YY'")&&(s=!0,i=this.DocumentDate.iMonth()<a.a.SessionManager.AccountingFromMonth?i.replace("'YY-YY'",(this.DocumentDate.getFullYear()-1).toString().substr(2)+"-"+this.DocumentDate.getFullYear().toString().substr(2)):i.replace("'YY-YY'",this.DocumentDate.getFullYear().toString().substr(2)+"-"+(this.DocumentDate.getFullYear()+1).toString().substr(2))),s||r?this.ScreenObject.DocPrefix.ComboBox.Items.find(e=>e.Value==i)?o.ContainsKey(i)||o.push(i,r):(this.ScreenObject.Preferences.ContainsKey("StartNoForNewPrefix")&&!n.e.IsEmpty(this.ScreenObject.Preferences.StartNoForNewPrefix)&&"0"!=this.ScreenObject.Preferences.StartNoForNewPrefix?this.ScreenObject.DocPrefix.ComboBox.Items.push(D.d.ComboBoxItems_4(i,i,"",this.ScreenObject.Preferences.StartNoForNewPrefix.length.toString())):this.ScreenObject.DocPrefix.ComboBox.Items.push(D.d.ComboBoxItems_4(i,i,"","1")),o.ContainsKey(i)||o.push(i,r),t&&(r||1==this.ScreenObject.DocPrefix.Prefixes.length)&&(this.isFromDate=!0,this.ScreenObject.DocPrefix.ComboBox.SelectedItem=this.ScreenObject.DocPrefix.ComboBox.Items[this.ScreenObject.DocPrefix.ComboBox.Items.length-1],this.ScreenObject.DocPrefix.ComboBox.SelectedValue=i,this.isFromDate=!1)):(null==this.ScreenObject.DocPrefix.ComboBox.Items.find(e=>e.Value==i)&&(this.ScreenObject.Preferences.ContainsKey("StartNoForNewPrefix")&&!n.e.IsEmpty(this.ScreenObject.Preferences.StartNoForNewPrefix)&&"0"!=this.ScreenObject.Preferences.StartNoForNewPrefix?this.ScreenObject.DocPrefix.ComboBox.Items.push(D.d.ComboBoxItems_4(i,i,"",this.ScreenObject.Preferences.StartNoForNewPrefix.length.toString())):this.ScreenObject.DocPrefix.ComboBox.Items.push(D.d.ComboBoxItems_4(i,i,"","1"))),o.ContainsKey(i)||o.push(i,r))}),s&&o.length>0&&!e&&t&&!n.e.IsEmpty(this.ScreenObject.DocPrefix.ComboBox.SelectedValue)&&!o.ContainsKey(this.ScreenObject.DocPrefix.ComboBox.SelectedValue)){this.isFromDate=!0;let e=o.GetItemByValue(!0);this.ScreenObject.DocPrefix.ComboBox.SelectedValue=null==e&&o.length>0?o.keys[0]:e.Key,this.isFromDate=!1}else if(s&&o.length>0&&e&&t&&(n.e.IsEmpty(this.ScreenObject.DocPrefix.ComboBox.SelectedValue)||!o.ContainsKey(this.ScreenObject.DocPrefix.ComboBox.SelectedValue))){this.isFromDate=!0;let e=o.GetItemByValue(!0);this.ScreenObject.DocPrefix.ComboBox.SelectedValue=null==e&&o.length>0?o.keys[0]:e.Key,this.isFromDate=!1}else if(!s&&e){this.isFromDate=!0;let e=this.ScreenObject.DocPrefix.Prefixes.values.indexOf(!0);if(i=-1==e&&this.ScreenObject.DocPrefix.Prefixes.length>0?this.ScreenObject.DocPrefix.Prefixes.keys[0]:this.ScreenObject.DocPrefix.Prefixes.keys[e],null!=i){let e=this.ScreenObject.DocPrefix.ComboBox.Items.find(e=>e.Value==i);n.e.IsEmpty(e)&&(this.ScreenObject.Preferences.ContainsKey("StartNoForNewPrefix")&&!n.e.IsEmpty(this.ScreenObject.Preferences.StartNoForNewPrefix)&&"0"!=this.ScreenObject.Preferences.StartNoForNewPrefix?this.ScreenObject.DocPrefix.ComboBox.Items.push(D.d.ComboBoxItems_4(i,i,"",this.ScreenObject.Preferences.StartNoForNewPrefix.length.toString())):this.ScreenObject.DocPrefix.ComboBox.Items.push(D.d.ComboBoxItems_4(i,i,"","1"))),this.ScreenObject.DocPrefix.ComboBox.SelectedValue=i}this.isFromDate=!1}if(this.IsInventoryVoucher&&(this.ScreenObject.IsPurchase&&null!=this.ScreenObject.CreditAccount&&this.ScreenObject.CreditAccount.SelectedValue>0?this.ScreenObject.GetDueDate(this.ScreenObject.CreditAccount.SelectedValue,this.DocumentDate,this.ScreenObject.IsPurchase):!this.ScreenObject.IsPurchase&&null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.SelectedValue>0&&this.ScreenObject.GetDueDate(this.ScreenObject.DebitAccount.SelectedValue,this.DocumentDate,this.ScreenObject.IsPurchase)),e||t&&(this.DisplayMessage=""),this.ScreenObject.DocPrefix.ComboBox.Items.length>0&&null!=this.ScreenObject.DocPrefix.ComboBox.SelectedValue){let e=this.ScreenObject.DocPrefix.ComboBox.Items.find(e=>e.Value==this.ScreenObject.DocPrefix.ComboBox.SelectedValue);e&&(this.ScreenObject.DocPrefix.ComboBox.SelectedItem=e,this.ScreenObject.DocPrefix.ComboBox.Text=e.Name)}}FillExchangeRates(){if(a.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(o.j)(a.a.SessionManager.Preferences["Use Foreign Currency"])){let e=n.e.Int(a.a.SessionManager.Preferences.DimensionwiseCurrency);this.Currency&&null!=this.Currency.Currency.SelectedValue&&""!=this.Currency.Currency.SelectedValue&&(this.Currency.ExchangeRate.Text="1"==this.Currency.Currency.SelectedValue?e>5e3?this.ScreenObject.GetExchangeRate(parseInt(this.Currency.Currency.SelectedValue),this.DocumentDate).toString():"1.0":this.ScreenObject.GetExchangeRate(parseInt(this.Currency.Currency.SelectedValue),this.DocumentDate).toString()),this.ScreenObject.ColumnSource.forEach(t=>{t.CurrID>0&&(t.ExhcgRt=1==t.CurrID?e>5e3?this.ScreenObject.GetExchangeRate(t.CurrID,this.DocumentDate):1:this.ScreenObject.GetExchangeRate(t.CurrID,this.DocumentDate))});let t=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&55847==e.LinkData);if(t.length>0&&""!=a.a.SessionManager.Preferences.BaseCurrency&&n.e.IsNum(a.a.SessionManager.Preferences.BaseCurrency)&&n.e.Double(a.a.SessionManager.Preferences.BaseCurrency)>0){let e=this.ScreenObject._TextFields.find(e=>e.DBColumnID.toString()==t[0].CostcenterColid.toString());e&&e instanceof u.d&&(e.Text=this.ScreenObject.GetExchangeRate(parseInt(a.a.SessionManager.Preferences.BaseCurrency),this.DocumentDate).toString())}}let e="1";for(let t=0;t<this.ScreenObject.GridData.length;t++){if(this.IsInventoryVoucher){if(!n.e.IsEmpty(this.ScreenObject.GridData[t].ProductID_Key))continue}else{if(this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&n.e.IsEmpty(this.ScreenObject.GridData[t].CreditAccount_Key))continue;if(this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&n.e.IsEmpty(this.ScreenObject.GridData[t].DebitAccount_Key))continue;if(this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&n.e.IsEmpty(this.ScreenObject.GridData[t].AccountID_Key))continue}for(let s=0;s<this.ScreenObject.ColumnSource.length;s++)this.ScreenObject.ColumnSource[s].DisplayMember.toLowerCase().Contains("dcnum")&&(e=this.ScreenObject.ColumnSource[s].DisplayMember.toLowerCase().replace("dcnum","").toString(),this.ScreenObject.GridDataColumns.Contains("dcExchRT"+e)&&this.ScreenObject.GridDataColumns.Contains("dcCurrID"+e+"_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[t]["dcCurrID"+e+"_Key"])&&(this.ScreenObject.GridData[t]["dcExchRT"+e]=1==parseInt(this.ScreenObject.GridData[t]["dcCurrID"+e+"_Key"])?"1":this.ScreenObject.GetExchangeRate(parseInt(this.ScreenObject.GridData[t]["dcCurrID"+e+"_Key"]),this.DocumentDate)));this.CalculateTotals(this.ScreenObject.GridData[t],!1)}if(this.IsInventoryVoucher)for(let t=0;t<this.ScreenObject.FooterGridData.length;t++)n.e.IsEmpty(this.ScreenObject.FooterGridData[t].Amount)||n.e.IsEmpty(this.ScreenObject.FooterGridData[t].dcCurrID_Key)||(this.ScreenObject.FooterGridData[t].dcExchRT=1==parseInt(this.ScreenObject.FooterGridData[t].dcCurrID_Key)?"1":this.ScreenObject.GetExchangeRate(parseInt(this.ScreenObject.FooterGridData[t].dcCurrID_Key),this.DocumentDate))}GetTrimString(e,t){return null!=e&&t>=0&&e.length>t?e.substr(0,t):e}ChangeLocation(e,t,s,i=null){if(31==this.ScreenObject.DocumentType)this.CheckStockDimensions(),this.DocumentNumber=new E.DocumentNumberViewModel(this,this.ScreenObject.Data.Tables[8],!0,i),a.a.page.ShowDialog(this.DocumentNumber,At.a,{HideClose:!0,ShowCenter:!0,Title:a.a.GetResource("DocumentNumberTitle"),CallBack:[this,"DocNumberCallBack"]});else if(this.ScreenObject.Data.Tables.length>8&&this.ScreenObject.Data.Tables[8].length>0||a.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==a.a.SessionManager.Preferences.EnableDivisionWise.toString()&&(!this.ScreenObject.Preferences.ContainsKey("Donotusedivision")||""==this.ScreenObject.Preferences.Donotusedivision||!Object(o.j)(this.ScreenObject.Preferences.Donotusedivision))&&0==a.a.SessionManager.DivisionID||a.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==a.a.SessionManager.Preferences.EnableLocationWise.toString()&&(!this.ScreenObject.Preferences.ContainsKey("Donotuselocation")||""==this.ScreenObject.Preferences.Donotuselocation||!Object(o.j)(this.ScreenObject.Preferences.Donotuselocation))&&0==s||e){let r=this.ScreenObject.Data.Tables[8].filter(e=>e.CCID>5e4);if(r.length>0||a.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==a.a.SessionManager.Preferences.EnableDivisionWise.toString()&&(!this.ScreenObject.Preferences.ContainsKey("Donotusedivision")||""==this.ScreenObject.Preferences.Donotusedivision||!Object(o.j)(this.ScreenObject.Preferences.Donotusedivision))&&0==a.a.SessionManager.DivisionID||a.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==a.a.SessionManager.Preferences.EnableLocationWise.toString()&&(!this.ScreenObject.Preferences.ContainsKey("Donotuselocation")||""==this.ScreenObject.Preferences.Donotuselocation||!Object(o.j)(this.ScreenObject.Preferences.Donotuselocation))&&0==s||e){r=this.ScreenObject.Data.Tables[8].filter(e=>e.CCID>5e4&&50002!=e.CCID);let l=this.ScreenObject.Data.Tables[8].filter(e=>e.CCID>5e4&&50002!=e.CCID&&50001!=e.CCID);if(!e&&s>0&&0==r.length&&(!a.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")||"True"!=a.a.SessionManager.Preferences.EnableDivisionWise.toString()||this.ScreenObject.Preferences.ContainsKey("Donotusedivision")&&""!=this.ScreenObject.Preferences.Donotusedivision&&Object(o.j)(this.ScreenObject.Preferences.Donotusedivision)||0!=a.a.SessionManager.DivisionID)){let e="",t=0;for(let i=0;i<this.ScreenObject.Data.Tables[8].length;i++)0==i&&(t=parseInt(this.ScreenObject.Data.Tables[8][i].SeriesNo)),n.e.IsEmpty(this.ScreenObject.Data.Tables[8][i].SeriesNo)||parseInt(this.ScreenObject.Data.Tables[8][i].SeriesNo)==t||(null==this.ScreenObject.DocPrefix||this.ScreenObject.DocPrefix.Prefixes.ContainsKey(e)||this.ScreenObject.DocPrefix.Prefixes.push(e,Object(o.j)(this.ScreenObject.Data.Tables[8][i-1].Isdefault)),t=parseInt(this.ScreenObject.Data.Tables[8][i].SeriesNo),e=""),50002==parseInt(this.ScreenObject.Data.Tables[8][i].CCID)?e+=this.GetTrimString(this.ScreenObject.GetDocNumberString(this.ScreenObject.Data.Tables[8][i].SysColumnName,50002,s),parseInt(this.ScreenObject.Data.Tables[8][i].Length))+this.ScreenObject.Data.Tables[8][i].Delimiter.toString():51==parseInt(this.ScreenObject.Data.Tables[8][i].CCID)||52==parseInt(this.ScreenObject.Data.Tables[8][i].CCID)||53==parseInt(this.ScreenObject.Data.Tables[8][i].CCID)?e+="'"+this.ScreenObject.Data.Tables[8][i].Length.toString()+"'"+this.ScreenObject.Data.Tables[8][i].Delimiter.toString():54==parseInt(this.ScreenObject.Data.Tables[8][i].CCID)&&(e+=this.ScreenObject.Data.Tables[8][i].Length.toString()+this.ScreenObject.Data.Tables[8][i].Delimiter.toString());this.ScreenObject.Data.Tables[8].length>0&&null!=this.ScreenObject.DocPrefix&&!this.ScreenObject.DocPrefix.Prefixes.ContainsKey(e)&&this.ScreenObject.DocPrefix.Prefixes.push(e,Object(o.j)(this.ScreenObject.Data.Tables[8][this.ScreenObject.Data.Tables[8].length-1].Isdefault)),this.DialogResult=!0}else if(!e&&s>0&&a.a.SessionManager.DivisionID>0&&0==l.length){let e="",t=0;for(let i=0;i<this.ScreenObject.Data.Tables[8].length;i++)0==i&&(t=parseInt(this.ScreenObject.Data.Tables[8][i].SeriesNo)),n.e.IsEmpty(this.ScreenObject.Data.Tables[8][i].SeriesNo)||parseInt(this.ScreenObject.Data.Tables[8][i].SeriesNo)==t||(null==this.ScreenObject.DocPrefix||this.ScreenObject.DocPrefix.Prefixes.ContainsKey(e)||this.ScreenObject.DocPrefix.Prefixes.push(e,Object(o.j)(this.ScreenObject.Data.Tables[8][i-1].Isdefault)),t=parseInt(this.ScreenObject.Data.Tables[8][i].SeriesNo),e=""),50002==parseInt(this.ScreenObject.Data.Tables[8][i].CCID)?e+=this.GetTrimString(this.ScreenObject.GetDocNumberString(this.ScreenObject.Data.Tables[8][i].SysColumnName,50002,s),parseInt(this.ScreenObject.Data.Tables[8][i].Length))+this.ScreenObject.Data.Tables[8][i].Delimiter.toString():50001==parseInt(this.ScreenObject.Data.Tables[8][i].CCID)?e+=this.GetTrimString(this.ScreenObject.GetDocNumberString(this.ScreenObject.Data.Tables[8][i].SysColumnName,50001,a.a.SessionManager.DivisionID),parseInt(this.ScreenObject.Data.Tables[8][i].Length))+this.ScreenObject.Data.Tables[8][i].Delimiter.toString():51==parseInt(this.ScreenObject.Data.Tables[8][i].CCID)||52==parseInt(this.ScreenObject.Data.Tables[8][i].CCID)||53==parseInt(this.ScreenObject.Data.Tables[8][i].CCID)?e+="'"+this.ScreenObject.Data.Tables[8][i].Length.toString()+"'"+this.ScreenObject.Data.Tables[8][i].Delimiter.toString():54==parseInt(this.ScreenObject.Data.Tables[8][i].CCID)&&(e+=this.ScreenObject.Data.Tables[8][i].Length.toString()+this.ScreenObject.Data.Tables[8][i].Delimiter.toString());this.ScreenObject.Data.Tables[8].length>0&&null!=this.ScreenObject.DocPrefix&&!this.ScreenObject.DocPrefix.Prefixes.ContainsKey(e)&&this.ScreenObject.DocPrefix.Prefixes.push(e,Object(o.j)(this.ScreenObject.Data.Tables[8][this.ScreenObject.Data.Tables[8].length-1].Isdefault)),this.DialogResult=!0}else t||(this.DocumentNumber=new E.DocumentNumberViewModel(this,this.ScreenObject.Data.Tables[8],!1,i),this.DocumentNumber.IsFirstCall=!e,n.e.IsEmpty(this.DocumentNumber.DisplayMessage)||t||a.a.page.ShowDialog(this.DocumentNumber,w.DocumentNumberComponent,{HideClose:!0,ShowCenter:!0,Title:a.a.GetResource("DocumentNumberTitle"),CallBack:[this,"DocNumberCallBack"]}))}else{let e="",t=0;for(let s=0;s<this.ScreenObject.Data.Tables[8].length;s++)0==s&&(t=parseInt(this.ScreenObject.Data.Tables[8][s].SeriesNo)),n.e.IsEmpty(this.ScreenObject.Data.Tables[8][s].SeriesNo)||parseInt(this.ScreenObject.Data.Tables[8][s].SeriesNo)==t||(this.ScreenObject.DocPrefix&&!this.ScreenObject.DocPrefix.Prefixes.ContainsKey(e)&&this.ScreenObject.DocPrefix.Prefixes.push(e,s>0?Object(o.j)(this.ScreenObject.Data.Tables[8][s-1].Isdefault):Object(o.j)(this.ScreenObject.Data.Tables[8][s].Isdefault)),t=parseInt(this.ScreenObject.Data.Tables[8][s].SeriesNo),e=""),51==parseInt(this.ScreenObject.Data.Tables[8][s].CCID)||52==parseInt(this.ScreenObject.Data.Tables[8][s].CCID)||53==parseInt(this.ScreenObject.Data.Tables[8][s].CCID)?e+="'"+this.ScreenObject.Data.Tables[8][s].Length.toString()+"'"+this.ScreenObject.Data.Tables[8][s].Delimiter.toString():54==parseInt(this.ScreenObject.Data.Tables[8][s].CCID)&&(e+=this.ScreenObject.Data.Tables[8][s].Length.toString()+this.ScreenObject.Data.Tables[8][s].Delimiter.toString());this.ScreenObject.Data.Tables[8].length>0&&null!=this.ScreenObject.DocPrefix&&!this.ScreenObject.DocPrefix.Prefixes.ContainsKey(e)&&this.ScreenObject.DocPrefix.Prefixes.push(e,Object(o.j)(this.ScreenObject.Data.Tables[8][this.ScreenObject.Data.Tables[8].length-1].Isdefault)),this.DialogResult=!0}}else this.DialogResult=!0;this.DocumentNumber&&this.DocumentNumber.DialogOptions&&this.DocumentNumber.DialogOptions.IsOpen||this.DocNumberCallBack(e)}DocNumberCallBack(e){this.CheckDateInDocNumber(!0),this.OnDocPrefixChanged_2(this.ScreenObject.Prefix,!!e),this.ScreenObject.SetDefaultValuesforCostCenters(0),this.ScreenObject.FillListViews(!1),a.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==a.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(this.ScreenObject.FillListViews(!0),this.ReportDimension&&(this.ReportDimension.IsAutoLoad=!0)),this.ToLinkParent&&(this.ToLinkParent.GenerateLinkDocument_Sub1(this),this.ToLinkParent=null),this.DocNumberDelegate.IsSubscribed&&setTimeout(()=>{this.DocNumberDelegate.Call()},50)}onDeleteRow(e){this.IsSelectAll||(this.ScreenObject.UpdateSequence(),this.CalculateTotals(null,!1),this.CheckVendorWiseLinkingPref())}onCurrencyChanged(e){null==this.ScreenObject||null!=this.lastCurr&&null!=this.Currency.Currency.SelectedValue&&this.Currency.Currency.SelectedValue==this.lastCurr||(this.lastCurr=this.Currency.Currency.SelectedValue,this.Currency.ExchangeRate.Text=null!=this.Currency.Currency.SelectedValue&&""!=this.Currency.Currency.SelectedValue?this.ScreenObject.GetExchangeRate(parseInt(this.Currency.Currency.SelectedValue),this.DocumentDate).toString():"1",this.ScreenObject.PriceTaxcc.ContainsKey(12)&&this.ReEvaluatePriceTax(12))}onExchangeRateChanged(e){this.ScreenObject.GridData.forEach(e=>{(this.IsInventoryVoucher&&this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!n.e.IsEmpty(e.ProductID_Key)&&parseInt(e.ProductID_Key)>0||!this.IsInventoryVoucher&&this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!n.e.IsEmpty(e.DebitAccount_Key)&&parseInt(e.DebitAccount_Key)>0||!this.IsInventoryVoucher&&this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!n.e.IsEmpty(e.CreditAccount_Key)&&parseInt(e.CreditAccount_Key)>0||!this.IsInventoryVoucher&&this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&!n.e.IsEmpty(e.AccountID_Key)&&parseInt(e.AccountID_Key)>0)&&this.CalculateTotals(e,!1)})}onHistoryClick(e){let t=this.GetButton("Save");if(null!=this.SelectedHistoryRow&&!n.e.IsEmpty(this.SelectedHistoryRow.maxid)){let e=!1,s=null;"YES"==this.SelectedHistoryRow.IsCurrent.toString()?(s=this.ScreenObject.GetEditDataByDOCID(),e=!1):(s=this.ScreenObject.GetEditDataByVersion(-1,this.SelectedHistoryRow.maxid.toString()),e=!0),null!=s&&this.ScreenObject.IsDocEdit&&s.Tables.length>0&&s.Tables[0].length>0&&(this.ScreenObject.LoadEditData(s,!1),this.RefreshGrid=!0),e?(this.ButtonSave.Visible=!1,this.ButtonSaveandPrint.Visible=!1,null!=t&&(t.Visible=!1),this.ButtonRevise.Visible=!1,this.ButtonDelete.Visible=!1,this.ButtonSuspendDoc.Visible=!1):(a.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"):this.ButtonSave.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"),a.a.SessionManager.HideUnathorizedAccess?this.ButtonSaveandPrint.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"):this.ButtonSaveandPrint.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"),this.ScreenObject.Preferences.ContainsKey("enebleSaveonhold")&&""!=this.ScreenObject.Preferences.enebleSaveonhold&&Object(o.j)(this.ScreenObject.Preferences.enebleSaveonhold)&&438==this.StatusID&&null!=t?(t.Enable=this.ButtonSave.Enable,t.Visible=this.ButtonSave.Visible):null!=t&&(t.Visible=!1),this.ScreenObject.Preferences.ContainsKey("EnableRevision")&&""!=this.ScreenObject.Preferences.EnableRevision&&Object(o.j)(this.ScreenObject.Preferences.EnableRevision)?a.a.SessionManager.HideUnathorizedAccess?this.ButtonRevise.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Revise"):(this.ButtonRevise.Visible=!0,this.ButtonRevise.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Revise")):this.ButtonRevise.Visible=!1,a.a.SessionManager.HideUnathorizedAccess?this.ButtonDelete.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"):this.ButtonDelete.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),a.a.SessionManager.HideUnathorizedAccess?this.ButtonSuspendDoc.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Suspend"):this.ButtonSuspendDoc.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Suspend"))}}onAttachLinkClick(e){null==e.grid?(this.SelectedRow=e.selectedRow,this.RowAttachments(e.sender.DisplayMember,!1,null!=this.SelectedRow?e.row:null)):(this.SelectedRow=e.grid.getDataItem(e.row),this.RowAttachments(e.sender.DisplayMember,!1,null!=this.SelectedRow?e.row:null))}RowAttachments(e,t,s){Logger.InfoLog("attachclick"),this.OnAddAttachment(),this.SetVisibiltiFalse(),this.AttachmentVisibility=!0,this.RightTabSelectedIndex=5;let i=this.ScreenObject.ColumnSource.find(t=>t.DisplayMember==e),r=null;if(Logger.InfoLog("attachclick",i.toString(),"col"),null!=this.ViewAttachments&&this.ViewAttachments.AttachmentsList.forEach(t=>{t.RowID==s&&t.ColID==e?(t.Height=20,(null!=i&&!n.e.IsEmpty(i.FilterCondition)&&"jpg"==t.FileExtension.toLowerCase()||"jpeg"==t.FileExtension.toLowerCase()||"png"==t.FileExtension.toLowerCase())&&(r=t)):t.Height=0}),this.Attachment.RowID=s,this.Attachment.ColID=e,this.Attachment.SaveVisible&&(this.Attachment.SaveVisible=!1,this.Attachment.OkVisible=!0),i&&i.Dependantinuse){if(null!=r){let e="";e=n.e.IsEmpty(r.FilePath)?n.b.GetLogPath(r.guid+"."+r.FileExtension):r.FilePath}}else if(i&&!n.e.IsEmpty(i.FilterCondition)&&null!=s){let a=i.FilterCondition.split(","),o="";for(let e=0;e<a.length;e++)i=this.ScreenObject.ColumnSource.find(t=>t.CostCenterID.toString()==a[e]),i&&!n.e.IsEmpty(s[i.ValueMember])&&(""!=o&&(o+=" OR "),o+="(FeatureID="+i.CostCenterID.toString()+" and FeaturePK="+s[i.ValueMember].toString()+")");if(!n.e.IsEmpty(o)){let i=this.ScreenObject.GetFiles(0,0,o);if(null!=i&&i.Columns[0].Contains("GUID")){let a="";if(null!=i&&i.Tables.length>0)for(let e=0;e<i.Tables[0].length;e++)a+=n.b.GetLogPath(i.Tables[0][e].GUID.toString()+"."+i.Tables[0][e].FileExtension.toString())+";";let o="";if(null!=r&&(o=n.b.GetLogPath(r.guid+"."+r.FileExtension)),t)return void(1==i.Tables[0].length&&(null!=r?(r.FileExtension=i.Tables[0][0].FileExtension.toString(),r.Guid=i.Tables[0][0].GUID.toString(),r.AllowInPrintVisible=!0,r.isfrmProduct=!0):(r=new G.AddAttachmentViewModel,r.FileExtension=i.Tables[0][0].FileExtension.toString(),r.Guid=i.Tables[0][0].GUID.toString(),r.AllowInPrintVisible=!0,r.isfrmProduct=!0,r.RowID=s,r.ColID=e,this.ViewAttachments.AttachmentsListObj.addRow(r))))}}}a.a.page.ShowDialog(this,N.a,{Title:"Attachment"})}onLinkRefClick(e){if(this.IsInventoryVoucher){if(null!=this.SelectedRow&&this.ScreenObject.GridDataColumns.Contains("LinkedInvDocDetailsID")&&""!=n.e.String(this.SelectedRow.LinkedInvDocDetailsID)){let e=this.ScreenObject.GetDocDetailsByInvID(parseInt(this.SelectedRow.LinkedInvDocDetailsID));if(null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&!e.Columns[0].Contains("ErrorMessage")){let t="";t=e.Columns[0].Contains("DisplayName")&&!n.e.IsEmpty(e.Tables[0][0].DisplayName)?e.Tables[0][0].DisplayName.toString():e.Tables[0][0].ResourceData.toString();let s=new es(parseInt(e.Tables[0][0].CCID),t,!0);s.ScreenObject.DocPrefix.ComboBox.SelectedValue=e.Tables[0][0].Prefix.toString(),s.ScreenObject.DocPrefix.TextBox.Text=e.Tables[0][0].DocNumber.toString(),s.OnDocPrefixChanged("lostFocus"),s.RefreshGridFooter||(s.RefreshGridFooter=!0),s.ScreenObject.FillDocumentPrefix(!0),null==s.ScreenObject.DocPrefix.ComboBox.SelectedValue&&(s.ScreenObject.DocPrefix.ComboBox.SelectedValue=e.Tables[0][0].Prefix.toString()),a.a.page.addNewTab({component:B.AddEditDocumentComponent,params:{obj:s}})}}}else null!=this.SelectedRow&&a.a.page.ShowDialog(new lt.AddDenominationViewModel(this,n.e.String(this.SelectedRow.DenominationsXML)),ot.AddDenominationComponent)}Setselectedrow(e){this.SelectedRow=this.ScreenObject.GridData[e]}onVerionChanged(e){let t;if(!n.e.IsEmpty(e)&&n.e.IsNum(e)){t=0;for(let e=0;e<this.ScreenObject.DocPrefix.RevisionCombo.Items.length;e++)parseInt(this.ScreenObject.DocPrefix.RevisionCombo.Items[e].Value)>t&&(t=parseInt(this.ScreenObject.DocPrefix.RevisionCombo.Items[e].Value));let s=null;parseInt(e)<t?s=this.ScreenObject.GetEditDataByVersion(parseInt(e),"0"):this.ScreenObject.IsDocEdit&&(s=this.ScreenObject.GetEditDataByDOCID(),a.a.SessionManager.HideUnathorizedAccess?this.ButtonDelete.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"):this.ButtonDelete.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),a.a.SessionManager.HideUnathorizedAccess?this.ButtonSuspendDoc.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Suspend"):this.ButtonSuspendDoc.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Suspend"),a.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"):this.ButtonSave.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"),a.a.SessionManager.HideUnathorizedAccess?this.ButtonSaveandPrint.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save&Print"):this.ButtonSaveandPrint.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save&Print"),this.HideButtons("Save&Barcode"),this.HideButtons("BarcodePrint"),this.ScreenObject.Preferences.ContainsKey("EnableRevision")&&""!=this.ScreenObject.Preferences.EnableRevision&&Object(o.j)(this.ScreenObject.Preferences.EnableRevision)?a.a.SessionManager.HideUnathorizedAccess?this.ButtonRevise.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Revise"):(this.ButtonRevise.Visible=!0,this.ButtonRevise.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Revise")):this.ButtonRevise.Visible=!1),null!=s&&this.ScreenObject.IsDocEdit&&s.Tables.length>0&&s.Tables[0].length>0&&(this.ScreenObject.LoadEditData(s,!1),this.RefreshGrid=!0,this.CalculateTotals(null,!1)),parseInt(e)<t&&(this.ButtonSave.Visible=!1,this.ButtonSaveandPrint.Visible=!1,this.ButtonRevise.Visible=!1,this.ButtonDelete.Visible=!1,this.ButtonSuspendDoc.Visible=!1)}}onComboBoxSelectionChanged(e){if(null!=this.ScreenObject)if(72==this.ScreenObject.DocumentType)null==e||n.e.IsEmpty(e)||("dcalpha13"==e.toLowerCase()&&this.ApplyVacationIsEncash(null),"dcalpha15"==e.toLowerCase()&&this.ApplyVacationExcessdays(""),"dcalpha16"==e.toLowerCase()&&this.ApplyVacationIsEncash(null));else if(92==this.DocumentType){let e="DayWise",t=this.ScreenObject._TextFields.find(e=>"dcalpha4"==e.DBColumnName.toLowerCase());t instanceof D.e&&(e=t.SelectedValue),"DayWise"==e?(this.ScreenObject._TextFields.forEach(e=>{e instanceof d.c&&("dcalpha1"==e.DBColumnName.toLowerCase()||"dcalpha2"==e.DBColumnName.toLowerCase())&&(e.IsReadOnly=!1)}),this.SetButtonVisibility("FillDates",!0)):(this.ScreenObject._TextFields.forEach(e=>{e instanceof d.c&&("dcalpha1"==e.DBColumnName.toLowerCase()||"dcalpha2"==e.DBColumnName.toLowerCase())&&(e.IsReadOnly=!0)}),this.SetButtonVisibility("FillDates",!1));for(let s=0;s<this.ScreenObject.ColumnSource.length;s++)"DCALPHA5"!=this.ScreenObject.ColumnSource[s].DisplayMember.toUpperCase()&&"DCALPHA6"!=this.ScreenObject.ColumnSource[s].DisplayMember.toUpperCase()&&"DCCCNID73"!=this.ScreenObject.ColumnSource[s].DisplayMember.toUpperCase()||(this.ScreenObject.ColumnSource[s].Mandatory="DayWise"!=e)}else if(89==this.ScreenObject.DocumentType||90==this.ScreenObject.DocumentType){let e=this.ScreenObject._TextFields.find(e=>"dcalpha32"==e.DBColumnName.toLowerCase());e instanceof D.e&&(null!=e.SelectedValue&&"Manual"==e.SelectedValue?(this.ScreenObject._TextFields.forEach(e=>{"dcalpha26"==e.DBColumnName.toLowerCase()?e.IsReadOnly=!0:"dcalpha27"==e.DBColumnName.toLowerCase()&&(e.Enable=!1)}),this.SetButtonVisibility("Save",!0),this.SetButtonVisibility("SaveAndPrint",!0),this.SetButtonVisibility("Check-in",!1),this.SetButtonVisibility("Check-out",!1)):(this.ScreenObject._TextFields.forEach(e=>{"dcalpha26"==e.DBColumnName.toLowerCase()?e.IsReadOnly=!1:"dcalpha27"==e.DBColumnName.toLowerCase()&&(e.Enable=!0)}),this.SetButtonVisibility("Save",!1),this.SetButtonVisibility("SaveAndPrint",!1),this.SetButtonVisibility("Check-in",!0),this.SetButtonVisibility("Check-out",!0)))}}onTextBoxLostFocus(e){if(null!=this.ScreenObject){if(this.ScreenObject._TextFields.forEach(e=>{this.fldDict.ContainsKey(e.Lbl)&&(e instanceof u.d?"FLOAT"==e.DataType?null!=e.Text&&""!=e.Text&&""==e.ValidateData()?this.fldDict[e.Lbl].setFieldValue(e.Text):this.fldDict[e.Lbl].setFieldValue(0):this.fldDict[e.Lbl].setFieldValue(e.Text):e instanceof D.e?this.fldDict[e.Lbl].setFieldValue(e.SelectedValue):e instanceof g.a?this.fldDict[e.Lbl].setFieldValue(e.Text):e instanceof m.b&&(e.SelectedValue>0&&!n.e.IsEmpty(e.Text)?this.fldDict[e.Lbl].setFieldValue(e.Text):this.fldDict[e.Lbl].setFieldValue("")))}),30==this.ScreenObject.DocumentType&&this.ScreenObject.GridDataColumns.Contains("IsKit")&&this.ScreenObject.Preferences.ContainsKey("AssembleQty")&&!n.e.IsEmpty(this.ScreenObject.Preferences.AssembleQty)){let t,s=this.ScreenObject._TextFields.find(e=>e.DBColumnID.toString()==this.ScreenObject.Preferences.AssembleQty);if(s&&s instanceof u.d&&!n.e.IsEmpty(s.Text)&&n.e.IsNum(s.Text)&&s==e){t=parseFloat(s.Text);let e=this.ScreenObject.GridData.filter(e=>1==e.IsKit);e.length>0&&(n.e.IsEmpty(e[0].Quantity)||parseFloat(e[0].Quantity)!=t)&&(e[0].Quantity=t,this.CalculateTotals(e[0],!1,"Quantity"),e=this.ScreenObject.GridData.find(e=>2==e.IsKit),e.forEach(e=>{e.Quantity=n.e.IsEmpty(e.DefaultQuantity)?t:t*parseFloat(e.DefaultQuantity),this.CalculateTotals(e,!1,"Quantity")}))}}if((e instanceof u.d||e instanceof D.e||e instanceof g.a)&&this.ValidateData(e),72==this.ScreenObject.DocumentType&&e instanceof u.d&&"dcalpha14"==e.DBColumnName.toLowerCase()&&this.ApplyVacationIsTextEncash(null),e instanceof b.c&&!n.e.IsEmpty(e.KeyTip)&&"lostfocus"==e.KeyTip.toLowerCase()&&this.ValidateData(e,!0)&&this.ScreenObject.GetExternalFuncData(e.Mode,e.ToolTipFooterTitle,e.ToolTipFooterDescription,e.ToolTipDescription,null),this.CalcTextFields(),e instanceof u.d&&e.Calculate){let e=0;this.ScreenObject.GridData.forEach(t=>{this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!n.e.IsEmpty(t.ProductID_Key)&&(this.CalculateTotals(t,!1),e++)}),0==e&&this.CalculateTotals(null,!1)}}}CalcQOH(e){let t="";for(let s=0;s<this.ScreenObject.GridData.length;s++)n.e.IsEmpty(this.ScreenObject.GridData[s].ProductID_Key)||(t.length>0&&(t+=","),t+=this.ScreenObject.GridData[s].ProductID_Key.toString());if(t.length>0&&this.ScreenObject.GridDataColumns.Contains("QOH")){let s="";if(this.ScreenObject.Preferences.ContainsKey("QOHField")){let e=this.ScreenObject.ColumnSource.find(e=>e.ID==this.ScreenObject.Preferences.QOHField);!e||31!=this.DocumentType&&32!=this.DocumentType||(s=e.DisplayMember)}let i=this.ScreenObject.GetProductQtyOnHand(t,e);if(null!=i&&i.Tables.length>0&&i.Columns[0].Contains("ProductID"))for(let e=0;e<i.Tables[0].length;e++){let t=this.ScreenObject.GridData.filter(t=>t.ProductID_Key==i.Tables[0][e].ProductID);t[0].QOH=t.length>0?i.Tables[0][e].QOH.toString():0,""!=s&&(t[0][s]=t[0].QOH.toString())}}}onDateChanged(e){if(e instanceof d.c){if(31!=this.DocumentType&&32!=this.DocumentType||"duedate"!=e.DBColumnName.toLowerCase()||this.CalcQOH(e.Date?e.Date:this.DocumentDate),this.ScreenObject.Preferences.ContainsKey("DueDateonBillDate")&&""!=this.ScreenObject.Preferences.DueDateonBillDate){let t=this.ScreenObject.Preferences.DueDateonBillDate;e.DBColumnName.toLowerCase()==t.toLowerCase()&&e.Date&&(this.ScreenObject.IsPurchase&&null!=this.ScreenObject.CreditAccount&&this.ScreenObject.CreditAccount.SelectedValue>0?this.ScreenObject.GetDueDate(this.ScreenObject.CreditAccount.SelectedValue,e.Date,this.ScreenObject.IsPurchase):!this.ScreenObject.IsPurchase&&null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.SelectedValue>0&&this.ScreenObject.GetDueDate(this.ScreenObject.DebitAccount.SelectedValue,e.Date,this.ScreenObject.IsPurchase))}if(35==this.ScreenObject.DocumentType){if("dcalpha3"==e.DBColumnName.toLowerCase()&&e.Date){let t=this.ScreenObject._TextFields.find(e=>"dcalpha4"==e.DBColumnName.toLowerCase());if(t&&t instanceof d.c&&t.Date){let s=this.ScreenObject._numericFields.find(e=>"dcnum30"==e.DBColumnName.toLowerCase());null!=s&&s instanceof u.d&&(s.Text=n.e.Round(t.Date.Subtract(e.Date).Days/30,0).toString())}}if("dcalpha4"==e.DBColumnName.toLowerCase()&&e.Date){let t=this.ScreenObject._TextFields.find(e=>"dcalpha3"==e.DBColumnName.toLowerCase());if(t&&t instanceof d.c&&t.Date){let s=this.ScreenObject._numericFields.find(e=>"dcnum30"==e.DBColumnName.toLowerCase());null!=s&&s instanceof u.d&&(s.Text=n.e.Round(e.Date.Subtract(t.Date).Days/30,0).toString())}}}92==this.ScreenObject.DocumentType?this.iDtColFrom>0&&this.iDtColUpto>0&&("dcalpha1"==e.DBColumnName.toLowerCase()&&e.Date||"dcalpha2"==e.DBColumnName.toLowerCase()&&e.Date)&&(this.DisplayMessage="Changing of Date will be effected on Line wise, Click on Fill Dates.."):72==this.DocumentType?"dcalpha2"==e.DBColumnName.toLowerCase()&&e.Date?this.ApplyVacationFrom(e):"dcalpha3"==e.DBColumnName.toLowerCase()&&e.Date&&this.ApplyVacation(e):97==this.DocumentType&&("dcalpha16"==e.DBColumnName.toLowerCase()&&e.Date&&(e.Date=new Date(e.Date.getFullYear(),e.Date.getMonth(),1),this.ScreenObject.GridData.length>0&&1!=this.dtPayMon.getFullYear()&&this.dtPayMon!=e.Date&&(this.DisplayMessage="Changing of Payroll Month will be effected on Line wise, Click on Filter to Process Lates..")),"dcalpha33"==e.DBColumnName.toLowerCase()&&e.Date&&(e.Date=new Date(e.Date.getFullYear(),e.Date.iMonth(),1))),e instanceof d.c&&e.Calculate&&(this.FillHeaderDictionary(),this.CalcTextFields())}else if(e instanceof d.b){if(this.ScreenObject.Data.Tables[0].filter(t=>t.CostCenterColID==e.DBColumnID&&null!=t.LocalReference&&79==t.LocalReference&&53580==t.LinkData).length>0){let t=a.a.common.GetDataSet("DOC001","");if(null!=t&&t.Tables.length>0&&!t.Columns[0].Contains("ErrorMessage")&&t.Tables[0].length>0&&!n.e.IsEmpty(t.Tables[0][0][t.Columns[0][0]])&&null!=this.fldDict){let s=t.Columns[0][0];if(e.Date=new Date(t.Tables[0][0][s]),null!=this.fldDict)if(a.a.SessionManager.IsWebApplication){let e=new Date(t.Tables[0][0][s]);this.fldDict.ServerDate.setFieldValue(e.ToString("MMM/dd/yyyy")),this.FooterDics.ServerDate.setFieldValue(e.ToString("MMM/dd/yyyy"))}else this.fldDict.ServerDate.setFieldValue(t.Tables[0][0][s]),this.FooterDics.ServerDate.setFieldValue(t.Tables[0][0][s])}}if(86==this.ScreenObject.DocumentType){let t=null,s=null,i=null,a=this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase());if(a&&a instanceof d.c&&(t=a.Date),"dcalpha2"==e.DBColumnName.toLowerCase()||"dcalpha3"==e.DBColumnName.toLowerCase()){let e=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase());e&&e instanceof d.b&&e.Date&&(i=e.Date),e=this.ScreenObject._TextFields.find(e=>"dcalpha3"==e.DBColumnName.toLowerCase()),e&&e instanceof d.b&&e.Date&&(s=e.Date)}if(null!=s&&null!=i){let e=this.ScreenObject._TextFields.find(e=>"dcalpha4"==e.DBColumnName.toLowerCase());e&&e instanceof u.d&&(e.Text=this.CalculateTotalTimeAvailed(t,s,i))}}}e instanceof b.c&&!n.e.IsEmpty(e.KeyTip)&&"lostfocus"==e.KeyTip.toLowerCase()&&this.ValidateData(e,!0)&&this.ScreenObject.GetExternalFuncData(e.Mode,e.ToolTipFooterTitle,e.ToolTipFooterDescription,e.ToolTipDescription,null)}LoadButtons(){var e;let t="",s="",i=40,r=40;this.IsPOs&&(t+="Pay,Print,Hold,Release,Exit,Options,Return Line,Delete Line,Sales Return,Docs,",this.ScreenObject.Data.Columns[1].Contains("ActionHeight")?(r=n.e.IsEmpty(this.ScreenObject.Data.Tables[1][0].ActionHeight)?60:parseInt(this.ScreenObject.Data.Tables[1][0].ActionHeight),i=n.e.IsEmpty(this.ScreenObject.Data.Tables[1][0].ActionWidth)?62:parseInt(this.ScreenObject.Data.Tables[1][0].ActionWidth)):(i=62,r=60)),t+="LinkStatus,Lock,Generate,Adjust Down Payments,Close,Enquiries,Advance,Redeposit,Pack,Approve,Submit,Stock Posting,New,Save,Revise,Post,Delete,SaveAndPrint",this.DocumentType>50&&(t+=",Copy Leaves,Set Columns,Employee Filter,Get Previous Day,All Employees,Guarantees,Distribute,Fill Dates,Fill General Timings"),s="Print,PrintPreview,Suspend,ContinuousPrint,SaveAndBarcode,BarcodePrint,Export,Email,SMS,Draft,Copy,Clone,Import,Sort,Recur,Show JV,Generate Cheques,Pre Payments,Location,Notes,Attachments,Contacts,ReEvaluate,ReEvaluatePriceChart,ReEvaluateTaxChart,Activities,Customize,Search,Report,Documents,History,Bounce,Load Drafts,Hold,Release,CashDrawer,Payment Terms,Convert,DocumentHistory,Revise History,PriceChart,Map,Post Billwise,Help,LinkInfo,TabsPopUp,AssignVPT,Assign",this.ScreenObject.Preferences.ContainsKey("RightButtons")&&!n.e.IsEmpty(this.ScreenObject.Preferences.RightButtons)&&(s=this.ScreenObject.Preferences.RightButtons.toString()),this.ScreenObject.Preferences.ContainsKey("LeftButtons")&&!n.e.IsEmpty(this.ScreenObject.Preferences.LeftButtons)&&(t=this.ScreenObject.Preferences.LeftButtons.toString()),this.DocumentType<=50&&this.ScreenObject.Preferences.ContainsKey("Distributebasedon")&&!n.e.IsEmpty(this.ScreenObject.Preferences.Distributebasedon)&&(t+=",Distribute"),a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Innoviti")&&(t="Innoviti,"+t),89!=this.DocumentType&&90!=this.DocumentType||(t+=",Check-in,Check-out",i=45),85==this.ScreenObject.DocumentType&&a.a.SessionManager.Preferences.ContainsKey("ConsiderGradeWiseSalarySlabs")&&"True"==a.a.SessionManager.Preferences.ConsiderGradeWiseSalarySlabs&&(t+=",Pick Min.,Pick Max.",i=45),61==this.DocumentType&&(t+=",Define Days",i=45),67==this.DocumentType&&(t+=",Validate",i=45),92==this.DocumentType&&(t+=",Rotation",i=45),99==this.DocumentType&&(t+=",Load",i=45),a.a.SessionManager.IsActionAssigned(this.CostCenterID,"GST")&&(t="GST,"+t),a.a.SessionManager.IsActionAssigned(this.CostCenterID,"API")&&(t="API,"+t),s.Contains(",EInv")||(s+=",EInv"),a.a.IsMobile&&(null===(e=this.ScreenObject.Link)||void 0===e?void 0:e.Visible)&&(t+=",DocLink"),a.a.IsMobile&&this.AssignAddress&&(t+=",Addresses"),this.ButtonsLeft.Clear(),this.ButtonsPopup.Clear(),","==t[t.length-1]&&(t=t.Remove(t.length-2,2));let o=a.a.IsMobile?["Customize","Documents"]:["Customize","Report","Documents"],l=t.split(",");for(let n=0;n<l.length;n++)o.Contains(l[n])||(this.ButtonsLeft.filter(e=>e.Visible).length>=7&&a.a.IsMobile?this.AddButton(l[n],this.ButtonsPopup,"POSDocumentViewModel"==this.ClassName&&"Pay"==l[n]?3*i+8:i,r):this.AddButton(l[n],this.ButtonsLeft,"POSDocumentViewModel"==this.ClassName&&"Pay"==l[n]?3*i+8:i,r));l=s.split(",");for(let a=0;a<l.length;a++)o.Contains(l[a])||this.AddButton(l[a],this.ButtonsPopup,40,40);a.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Create"):this.ButtonSave.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Create"),a.a.SessionManager.HideUnathorizedAccess?this.ButtonDelete.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"):this.ButtonDelete.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),a.a.SessionManager.HideUnathorizedAccess?this.ButtonSuspendDoc.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Suspend"):this.ButtonSuspendDoc.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Suspend"),a.a.SessionManager.HideUnathorizedAccess?this.ButtonSaveandPrint.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save&Print"):this.ButtonSaveandPrint.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save&Print"),this.HideButtons("Save&Barcode"),this.HideButtons("BarcodePrint"),this.ButtonRevise.Visible=!1,this.ButtonApprove.Visible=!1;let c=this.GetButton("Generate Cheques");null==c&&(c=this.GetButton("Pre Payments")),null!=c&&(this.pdcGCVM=new ue.a(this))}AddButton(e,t,s,i){let r=new h.a;switch(r.DBColumnName=e,e){case"":return;case"Assign":if(!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"AssignUsers"))return;r.ImgData="btn_assign",r.Icon="fa-light fa-user-plus",r.Label=a.a.GetResource("Assign"),r.ComParam="Assign";break;case"Pick Min.":r.ImgData="btn_PickMin",r.Icon="fa-light fa-layer-minus",r.Label=a.a.GetResource("PickMin"),r.ComParam="PickMin";break;case"EInv":r.ImgData="btn_EInv",r.Icon="fa-light fa-time-circle",r.Label=a.a.GetResource("EInv"),r.ComParam="EInv",r.Visible=!0;break;case"Close":if(!(this.ScreenObject.Preferences.ContainsKey("UseAsLC")&&""!=this.ScreenObject.Preferences.UseAsLC&&Object(o.j)(this.ScreenObject.Preferences.UseAsLC)||this.ScreenObject.Preferences.ContainsKey("UseAsTR")&&""!=this.ScreenObject.Preferences.UseAsTR&&Object(o.j)(this.ScreenObject.Preferences.UseAsTR)))return;r.ImgData="btn_Close",r.Icon="fa-light fa-time-circle",r.Label=a.a.GetResource("Close"),r.ComParam="Close";break;case"next":r.ImgData="btn_PickMax",r.Icon="far fa-angle-right",r.Label=a.a.GetResource("next"),r.ComParam="next";break;case"prev":r.ImgData="far fa-angle-left",r.Label=a.a.GetResource("prev"),r.ComParam="prev";break;case"Pick Max.":r.ImgData="btn_PickMax",r.Icon="fa-light fa-layer-plus",r.Label=a.a.GetResource("PickMax"),r.ComParam="PickMax";break;case"Check-in":r.ImgData="btn_Check-in",r.Label=a.a.GetResource("Check_In"),r.ComParam="Check-in";break;case"Load":r.ImgData="btn_Load",r.Icon="fa-light fa-circle-notch fa-spin",r.Label=a.a.GetResource("Load"),r.ComParam="Load";break;case"Check-out":r.ImgData="btn_Check-out",r.Label=a.a.GetResource("Check_Out"),r.ComParam="Check-out";break;case"Rotation":r.ImgData="btn_Rotation",r.Icon="fa-light fa-arrows-rotate",r.Label=a.a.GetResource("Rotation"),r.ComParam="Rotation";break;case"Validate":r.ImgData="btn_Validate",r.Icon="fa-light fa-arrows-rotate",r.Label=a.a.GetResource("Validate"),r.ComParam="Validate";break;case"Innoviti":r.ImgData="btn_Innoviti",r.Icon="fa-light fa-credit-card",r.Label=a.a.GetResource("CardPay"),r.ComParam="Innoviti";break;case"LinkStatus":this.ButtonSuspend=r,r.DBColumnName=e,r.ImgData="btn_linkStatus",r.Icon="far fa-link",r.Label=a.a.GetResource("LinkStatus"),r.ComParam="SuspendVisiblity";break;case"Lock":if(!a.a.SessionManager.Preferences.ContainsKey("LockEditMode")||!Object(o.j)(a.a.SessionManager.Preferences.LockEditMode))return;r.ImgData="btn_Lock",r.Icon="fa-light fa-lock",r.Label=a.a.GetResource("Lock"),r.ComParam="Lock",r.Visible=!1;break;case"Generate":if(!this.IsInventoryVoucher||this.IsPOs||this.ScreenObject.Preferences.ContainsKey("DisableGenerate")&&"True"==this.ScreenObject.Preferences.DisableGenerate||this.ScreenObject.Data.Tables.length>20&&0==this.ScreenObject.Data.Tables[20].filter(e=>e.CostCenterIDBase>4e4).length)return;r.ImgData="btn_GenerateLink",r.Icon="fa-light fa-link",r.Label=a.a.GetResource("GenerateLink"),r.ComParam="GenerateLink",r.Visible=!1;break;case"New":r.ImgData="btn_new",r.Icon="fa-light fa-file",r.Label=a.a.GetResource("New"),this.IsPOs&&(r.Label=r.Label+" F2"),r.ComParam="New";break;case"Revise":this.ButtonRevise=r,r.DBColumnName=e,r.ImgData="btn_revise",r.Icon="fa-light fa-book-open",r.Label=a.a.GetResource("Revise"),r.ComParam="Revise";break;case"GST":if(!this.IsInventoryVoucher)return;r.ImgData="btn_gst",r.Icon="fa-light fa-money-bill",r.Label=a.a.GetResource("GST"),r.ComParam="GST",r.Visible=!1;break;case"API":r.ImgData="btn_API",r.Icon="fa-light fa-time-circle",r.Label=a.a.GetResource("API"),r.ComParam="API",r.Visible=!1;break;case"Post":this.ButtonSave=r,r.DBColumnName=e,r.ImgData="btn_post",r.Icon="fa-light fa-floppy-disk-circle-arrow-right",r.Label=a.a.GetResource("Post"),r.ComParam="Save";break;case"Save":if(!this.ScreenObject.Preferences.ContainsKey("enebleSaveonhold")||"True"!=this.ScreenObject.Preferences.enebleSaveonhold)return;r.ImgData="btn_saveonhold",r.Icon="fa-light fa-save",r.Label=a.a.GetResource("Save"),r.ComParam="SaveonHold";break;case"Delete":this.ButtonDelete=r,r.DBColumnName=e,r.ImgData="btn_delete",r.Icon="fa-light fa-trash-alt",r.Label=a.a.GetResource("Delete"),r.ComParam="Delete";break;case"SaveAndPrint":this.ButtonSaveandPrint=r,r.DBColumnName=e,r.ImgData="btn_saveprint",r.Icon="fas fa-print",r.Label=a.a.GetResource("SaveAndPrint"),r.ComParam="SaveAndPrint";break;case"Adjust Down Payments":if(!this.ScreenObject.Preferences.ContainsKey("AllowAdjToDownPmt")||"True"!=this.ScreenObject.Preferences.AllowAdjToDownPmt.toString())return;r.ImgData="btn_adjustdownpayments",r.Icon="fa-light fa-money-bill",r.Label=a.a.GetResource("AdjustDownPay"),r.ComParam="AdjustDownPay";break;case"Enquiries":if(25!=this.ScreenObject.DocumentType)return;r.ImgData="btn_enquiries",r.Icon="fa-light fa-megaphone",r.Label=a.a.GetResource("Doc_Enquiries"),r.ComParam="Enquiries";break;case"Advance":if(!(this.ScreenObject.Preferences.ContainsKey("DonotupdateAccounts")&&""!=this.ScreenObject.Preferences.DonotupdateAccounts&&Object(o.j)(this.ScreenObject.Preferences.DonotupdateAccounts)&&this.ScreenObject.Preferences.ContainsKey("AllowAdvRct")&&""!=this.ScreenObject.Preferences.AllowAdvRct&&Object(o.j)(this.ScreenObject.Preferences.AllowAdvRct)&&this.ScreenObject.Preferences.ContainsKey("PostVoucherDocument")&&""!=this.ScreenObject.Preferences.PostVoucherDocument&&n.e.IsNum(this.ScreenObject.Preferences.PostVoucherDocument)&&parseInt(this.ScreenObject.Preferences.PostVoucherDocument)>4e4))return;r.ImgData="btn_advance",r.Icon="fa-light fa-ad",r.Label=a.a.GetResource("Advance"),r.ComParam="Advance";break;case"Redeposit":if(14!=this.DocumentType&&19!=this.DocumentType&&18!=this.ScreenObject.DocumentType&&15!=this.ScreenObject.DocumentType)return;r.ImgData="btn_redeposit",r.Icon="fa-light fa-step-backward",r.Label=a.a.GetResource("Redeposit"),r.ComParam="Redeposit",r.Visible=!1;break;case"Pack":if(!this.ScreenObject.Preferences.ContainsKey("EnablePacking")||"True"!=this.ScreenObject.Preferences.EnablePacking)return;r.ImgData="btn_pack",r.Icon="fa-light fa-archive",r.Label=a.a.GetResource("Pack"),r.ComParam="Pack";break;case"Approve":this.ButtonApprove=r,r.DBColumnName=e,r.ImgData="btn_approve",r.Icon="fa-light fa-user",r.Label=a.a.GetResource("btnApprove"),r.ComParam="ApproveVisiblity",r.Visible=!1;break;case"Submit":r.ImgData="btn_submit",r.Icon="fa-light fa-check-circle",r.Label=a.a.GetResource("Submit"),r.ComParam="NoWorkFlow",r.Visible=!1;break;case"Stock Posting":if(31!=this.ScreenObject.DocumentType)return;r.ImgData="btn_stockposting",r.Icon="fa-light fa-box-check",r.Label=a.a.GetResource("StockPosting"),r.ComParam="PostStock";break;case"Copy Leaves":if(81!=this.ScreenObject.DocumentType)return;r.ImgData="btn_copyleaves",r.Icon="far fa-copy",r.Label=a.a.GetResource("CopyLeaves"),r.ComParam="ALCopy";break;case"Set Columns":if(67!=this.ScreenObject.DocumentType)return;r.ImgData="btn_setcolumns",r.Icon="fa-light fa-columns",r.Label=a.a.GetResource("SetColumns"),r.ComParam="DATCustomize";break;case"Employee Filter":if(67!=this.ScreenObject.DocumentType&&97!=this.ScreenObject.DocumentType)return;r.ImgData="btn_employeefilter",r.Icon="fa-light fa-filter",r.Label=a.a.GetResource("Filter"),r.ComParam="DailyAttendanceFilter";break;case"Get Previous Day":if(67!=this.ScreenObject.DocumentType)return;r.ImgData="btn_getpreviousday",r.Icon="fa-light fa-calendar-minus",r.Label=a.a.GetResource("PreviousDay"),r.ComParam="GetPreviousDay";break;case"All Employees":if(67!=this.ScreenObject.DocumentType)return;r.ImgData="btn_allemployee",r.Icon="fa-light fa-users-class",r.Label="All Employees",r.ComParam="GetAllEmployees";break;case"Fill Dates":if(67!=this.ScreenObject.DocumentType&&92!=this.ScreenObject.DocumentType)return;r.ImgData="btn_filldates",r.Icon="fa-light fa-calendar-day",r.Label=a.a.GetResource("FillDates"),r.ComParam="FillDates";break;case"Fill General Timings":if(67!=this.ScreenObject.DocumentType)return;r.ImgData="btn_fillgeneraltimings",r.Icon="fa-light fa-clock",r.Label=a.a.GetResource("FillGeneralTimings"),r.ComParam="FillGeneralTimings";break;case"Define Days":if(61!=this.ScreenObject.DocumentType)return;r.ImgData="btn_DefineDays",r.Label=a.a.GetResource("DefineDays"),r.ComParam="DefineDays";break;case"Guarantees":if(56!=this.ScreenObject.DocumentType||!a.a.SessionManager.Preferences.ContainsKey("IsLoanGuaranteeMandatory")||"True"!=a.a.SessionManager.Preferences.IsLoanGuaranteeMandatory)return;this.LoanGuaranteeVisible=!0,r.ImgData="btn_guarantees",r.Label=a.a.GetResource("Guarantees"),r.ComParam="LoanGuarantees";break;case"Distribute":if(this.ScreenObject.DocumentType>50&&56!=this.ScreenObject.DocumentType)return;r.ImgData="btn_distribute",r.Icon="fa-project-diagram fa-light",r.Label=a.a.GetResource("Distribute"),r.ComParam="DistributeInstallments";break;case"Pay":if(!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Create")&&!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"))return;r.ImgData="btn_pay",r.Icon="fa-light fa-check",r.Label="Pay F7",r.ComParam="Pay";break;case"Print":if(!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Print"))return;r.ImgData="btn_print",r.Icon="fa-light fa-print",r.Label=a.a.GetResource("Print"),this.IsPOs&&(r.Label=r.Label+" F4"),r.ComParam="Print";break;case"Hold":if(this.IsPOs&&!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Hold")||a.a.SessionManager.LicenseSettings.ContainsKey("Hold_Release")&&"FALSE"==a.a.SessionManager.LicenseSettings.Hold_Release.toUpperCase())return;if(!this.IsPOs&&!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"HoldDoc"))return;r.ImgData="btn_hold",r.Icon="fa-light fa-box",r.Label=a.a.GetResource("Hold")+" F8",r.ComParam="Hold";break;case"Release":if(this.IsPOs&&!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Release")||a.a.SessionManager.LicenseSettings.ContainsKey("Hold_Release")&&"FALSE"==a.a.SessionManager.LicenseSettings.Hold_Release.toUpperCase())return;r.ImgData="btn_release",r.Icon="fa-light fa-box-open",r.Label=a.a.GetResource("Com_Release")+" F6",r.ComParam="Release";break;case"Exit":if(!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Exit"))return;r.ImgData="btn_exit",r.Icon="fa-light fa-share",r.Label="Exit",r.ComParam="Exit";break;case"Options":if(!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Options"))return;r.ImgData="btn_options",r.Icon="fa-light fa-money-check",r.Label=a.a.GetResource("Com_Options"),r.ComParam="Options";break;case"PrintPreview":if(!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Print"))return;r.ImgData="btn_printpreview",r.Icon="fa-light fa-eye",r.Label=a.a.GetResource("VPDesigner_PrintPreview"),r.ComParam="PrintPreview";break;case"Suspend":this.ButtonSuspendDoc=r,r.DBColumnName=e,r.ImgData="btn_suspend",r.Icon="fa-light fa-ban",r.Label=a.a.GetResource("Suspend"),r.ComParam="Suspend";break;case"ContinuousPrint":if(!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"ContinuousPrint"))return;r.ImgData="btn_ContinuousPrint",r.Icon="fa-light fa-shredder",r.Label=a.a.GetResource("Doc_ContinuousPrinting"),r.ComParam="ContinuousPrint";break;case"SaveAndBarcode":this.ButtonSaveandBarcode=r,r.DBColumnName=e,r.ImgData="btn_SaveAndBarcode",r.Icon="fa-light fa-barcode-alt",r.Label=a.a.GetResource("SaveAndBarcode"),r.ComParam="SaveAndBarcode";break;case"BarcodePrint":this.ButtonBarcode=r,r.DBColumnName=e,r.ImgData="btn_barcodeprint",r.Icon="fa-light fa-barcode",r.Label=a.a.GetResource("Barcode"),r.ComParam="BarcodePrint";break;case"Export":if(!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Export"))return;r.ImgData="btn_export",r.Icon="fa-light fa-file-export",r.Label=a.a.GetResource("Export"),r.ComParam="Export";break;case"Email":if(!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Email"))return;r.ImgData="btn_email",r.Icon="fa-light fa-envelope ",r.Label=a.a.GetResource("SMTP_Email"),r.ComParam="Email";break;case"SMS":if(!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"SMS"))return;r.ImgData="btn_sms",r.Icon="fa-light fa-message-dots",r.Label=a.a.GetResource("SMTP_SMS"),r.ComParam="SMS";break;case"Draft":if(!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Draft"))return;r.ImgData="btn_saveasDraft",r.Icon="fa-light fa-clipboard",r.Label=a.a.GetResource("Com_SaveAsDraft"),r.ComParam="SaveDraft";break;case"Copy":if(!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Copy"))return;r.ImgData="btn_copy",r.Icon="fa-light fa-copy",r.Label=a.a.GetResource("Copy"),r.ComParam="Copy";break;case"Clone":if(!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Duplicate"))return;r.ImgData="btn_clone",r.Icon="fa-light fa-clone",r.Label=a.a.GetResource("Clone"),r.ComParam="Duplicate";break;case"Import":if(!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Import")||a.a.SessionManager.LicenseSettings.ContainsKey("Import")&&"FALSE"==a.a.SessionManager.LicenseSettings.Import.toUpperCase())return;r.ImgData="btn_import",r.Icon="fa-light fa-file-import",r.Label=a.a.GetResource("Import_Data"),r.ComParam="ImportVisiblity";break;case"Sort":if(!a.a.SessionManager.IsActionAssigned(43,"Sort Body"))return;r.ImgData="btn_sort",r.Icon="fa-light fa-sort",r.Label=a.a.GetResource("Reports_Sort"),r.ComParam="SortVisiblity";break;case"Recur":if(!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Recur"))return;r.ImgData="btn_Recur",r.Icon="fa-light fa-repeat-alt",r.Label=a.a.GetResource("Recur"),r.ComParam="Recur";break;case"Show JV":if(this.ScreenObject.Preferences.ContainsKey("DonotupdateAccounts")&&""!=this.ScreenObject.Preferences.DonotupdateAccounts&&Object(o.j)(this.ScreenObject.Preferences.DonotupdateAccounts)||30==this.DocumentType)return;if(!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"JV"))return;r.ImgData="btn_showjv",r.Icon="fa-light fa-book",r.Label=a.a.GetResource("ShowJV"),r.ComParam="ShowJV";break;case"Generate Cheques":if(!this.ScreenObject.Preferences.ContainsKey("LineWisePDC")||"True"!=this.ScreenObject.Preferences.LineWisePDC)return;r.ImgData="btn_generatecheques",r.Label=a.a.GetResource("Generate_Cheques"),r.ComParam="Cheque";break;case"Pre Payments":if(this.IsInventoryVoucher||!(this.ScreenObject.Preferences.ContainsKey("PrepaymentDoc")&&!n.e.IsEmpty(this.ScreenObject.Preferences.PrepaymentDoc)&&parseInt(this.ScreenObject.Preferences.PrepaymentDoc)>4e4))return;r.ImgData="btn_prepayments",r.Icon="fa-light fa-money-bill-wave-alt",r.Label=a.a.GetResource("PrePayments"),r.ComParam="Cheque";break;case"Location":if(!this.ScreenObject.Preferences.ContainsKey("LocationVisibility")||"True"!=this.ScreenObject.Preferences.LocationVisibility)return;r.ImgData="btn_changeloc",r.Icon="fa-light fa-map-marker",r.Label=a.a.GetResource("DocChangeLocation"),r.ComParam="ChangeLocation";break;case"Notes":if(!this.ScreenObject.Preferences.ContainsKey("Notes")||"True"!=this.ScreenObject.Preferences.Notes||!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Notes"))return;r.ImgData="btn_note",r.Icon="fa-light fa-sticky-note",r.Label=a.a.GetResource("Notes"),r.ComParam="Notes";break;case"Attachments":if(!this.ScreenObject.Preferences.ContainsKey("Attachments")||"True"!=this.ScreenObject.Preferences.Attachments||!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Attach"))return;r.ImgData="btn_attachment",r.Icon="fa-light fa-paperclip",r.Label=a.a.GetResource("Attachments"),r.ComParam="Attachment";break;case"Contacts":if(!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Contacts"))return;r.ImgData="btn_Contacts",r.Label=a.a.GetResource("Com_Contacts"),r.ComParam="Contacts";break;case"ReEvaluate":if(!this.IsInventoryVoucher||!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"ReEvaluate"))return;r.ImgData="btn_reevaluate",r.Icon="fa-light fa-calculator",r.Label=a.a.GetResource("ReEvaluate"),r.ComParam="ReEvaluate";break;case"ReEvaluatePriceChart":if(!this.IsInventoryVoucher||!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"ReEvaluatePriceChart"))return;r.ImgData="btn_reevaluate",r.Icon="fa-light fa-calculator",r.Label=a.a.GetResource("ReEvaluatePriceChart"),r.ComParam="ReEvaluatePrice";break;case"ReEvaluateTaxChart":if(!this.IsInventoryVoucher||!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"ReEvaluateTaxChart"))return;r.ImgData="btn_reevaluate",r.Icon="fa-light fa-calculator",r.Label=a.a.GetResource("ReEvaluateTaxChart"),r.ComParam="ReEvaluateTax";break;case"Activities":if(!this.ScreenObject.Preferences.ContainsKey("Activities")||"True"!=this.ScreenObject.Preferences.Activities)return;r.ImgData="btn_activity",r.Icon="fa-light fa-calendar-alt",r.Label=a.a.GetResource("Activities"),r.ComParam="Activities";break;case"Customize":if(!a.a.SessionManager.IsFeatureAssigned(43)||!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Customize"))return;r.ImgData="btn_customize",r.Label=a.a.GetResource("Customize"),r.ComParam="Customize";break;case"Search":r.ImgData="btn_search",r.Icon="fa-light fa-search",r.Label=a.a.GetResource("btnSearch"),r.ComParam="Search";break;case"Report":r.ImgData="btn_Report",r.Icon="fa-light fa-file-chart-line",r.Label=a.a.GetResource("Report"),r.ComParam="Report";break;case"Documents":r.ImgData="btn_Report",r.Icon="fa-light fa-book",r.Label=a.a.GetResource("Documents"),r.ComParam="Documents";break;case"DocLink":r.Icon="fa-light fa-project-diagram",r.Label=a.a.GetResource("Doc_link"),r.ComParam="DocLink";break;case"Addresses":r.Icon="fa-light fa-book",r.Label="Address",r.ComParam="Addresses";break;case"Bounce":if(18!=this.ScreenObject.DocumentType&&15!=this.ScreenObject.DocumentType)return;r.ImgData="btn_bounce",r.Icon="fa-light fa-money-check",r.Label=a.a.GetResource("DocumentDesigner_Bounce"),r.ComParam="Bounce";break;case"History":r.ImgData="btn_history",r.Icon="fa-light fa-history",r.Label=a.a.GetResource("History"),r.ComParam="ViewHistory",r.Visible=!1;break;case"Load Drafts":if(!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Draft"))return;r.ImgData="btn_loaddrafts",r.Icon="fa-light fa-file-upload",r.Label=a.a.GetResource("Com_LoadDraft"),r.ComParam="LoadDraft";break;case"CashDrawer":if(!this.ScreenObject.Preferences.ContainsKey("Select Port")||"True"!=this.ScreenObject.Preferences["Select Port"])return;r.ImgData="btn_cashdrawer",r.Label=a.a.GetResource("Com_CashDrawer"),r.ComParam="CashDrawer";break;case"Payment Terms":if(!(this.ScreenObject.Preferences.ContainsKey("Enable Payment Terms")&&""!=this.ScreenObject.Preferences["Enable Payment Terms"]&&Object(o.j)(this.ScreenObject.Preferences["Enable Payment Terms"])||this.ScreenObject.Preferences.ContainsKey("CopyPaymentTerms")&&""!=this.ScreenObject.Preferences.CopyPaymentTerms&&Object(o.j)(this.ScreenObject.Preferences.CopyPaymentTerms)))return;r.ImgData="btn_paymentTerms",r.Icon="fa-light fa-list",r.Label=a.a.GetResource("ViewPaymentTerms"),r.ComParam="ViewPaymentTerms";break;case"Convert":if(!(this.ScreenObject.Data.Tables.length>20&&this.ScreenObject.Data.Columns[20].Contains("DocumentLinkDefID")&&this.ScreenObject.Data.Tables[20].filter(e=>2==e.Mode&&73==e.CostCenterIDBase).length>0))return;r.ImgData="btn_convert",r.Label=a.a.GetResource("Convert"),r.ComParam="Convert",r.Visible=!1;break;case"DocumentHistory":if(!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"DocumentHistory"))return;r.ImgData="btn_dochistory",r.Icon="fa-light fa-file-medical-alt",r.Label=a.a.GetResource("Doc_History"),r.ComParam="DocumentHistory";break;case"Revise History":if(!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"ReviseHistory")||!this.ScreenObject.Preferences.ContainsKey("EnableRevision")||""==this.ScreenObject.Preferences.EnableRevision||!Object(o.j)(this.ScreenObject.Preferences.EnableRevision))return;r.ImgData="btn_revhistory",r.Icon="fa-light fa-history",r.Label=a.a.GetResource("Revise_History"),r.ComParam="ReviseHistory";break;case"PriceChart":if(!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"PriceChart")&&a.a.SessionManager.LicenseSettings.ContainsKey("PriceChartFromDocument")&&"FALSE"==a.a.SessionManager.LicenseSettings.PriceChartFromDocument.toUpperCase())return;r.ImgData="btn_pricechart",r.Icon="fa-light fa-chart-line",r.Label=a.a.GetResource("PriceChart"),r.ComParam="PriceChart";break;case"Map":r.ImgData="btn_map",r.Icon="fa-light fa-project-diagram",r.Label=a.a.GetResource("Map"),r.ComParam="LINKMAP";break;case"Post Billwise":if(!this.IsInventoryVoucher||!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Post Billwise"))return;r.ImgData="btn_postbillwise",r.Icon="fa-light fa-list-alt",r.Label=a.a.GetResource("PostBillwise"),r.ComParam="PostBills";break;case"Help":if(n.e.IsEmpty(this.HelpDoc))return;r.ImgData="btn_help",r.Label=a.a.GetResource("Help"),r.ComParam="HelpDoc";break;case"LinkInfo":if(!this.IsInventoryVoucher||null==this.ScreenObject.Link)return;if(!this.ScreenObject.Preferences.ContainsKey("LinkPopup")||"True"!=this.ScreenObject.Preferences.LinkPopup)return;this.ScreenObject.Link.Visible=!1,r.ImgData="LinkInfo",r.Label=a.a.GetResource("Doc_link"),r.ComParam="LinkInfo";break;case"TabsPopUp":if(this.ScreenObject.Preferences.ContainsKey("TabsPopup")&&"2"==this.ScreenObject.Preferences.TabsPopup)return void(this.TabBtnVisible=!0);if(!this.ScreenObject.Preferences.ContainsKey("TabsPopup")||"1"!=this.ScreenObject.Preferences.TabsPopup||!this.ScreenObject.CustomTab.Visible)return;this.ScreenObject.CustomTab.Visible=!1,r.ImgData="TabsPopUp",r.Icon="fa-light fa-info-square",r.Label=a.a.GetResource("ExtraInfo"),r.ComParam="TabsPopUp";break;case"AssignVPT":if(!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"AssignVPT"))return;r.ImgData="btn_AssignVPT",r.Icon="fa-light fa-user-plus",r.Label=a.a.GetResource("AssignVPT"),r.ComParam="AssignVPT";break;case"Change Qty":r.ImgData="btn_AssignVPT",r.Label="Change Qty",r.ComParam="ChangeQty";break;case"Change Rate":r.ImgData="btn_AssignVPT",r.Label="Change Rate",r.ComParam="ChangeRate";break;case"Change Unit":r.ImgData="btn_AssignVPT",r.Label="Change Unit",r.ComParam="ChangeUnit";break;case"Return Line":r.ImgData="btn_AssignVPT",r.Label=a.a.GetResource("ReturnLine"),r.Icon="fa-light fa-user-plus",r.ComParam="ReturnLine";break;case"Delete Line":r.ImgData="btn_AssignVPT",r.Label="Delete Line",r.Icon="fa-light fa-layer-minus",r.ComParam="DeleteLine";break;case"Sales Return":r.ImgData="btn_AssignVPT",r.Label=a.a.GetResource("SalesReturn"),r.Icon="fa-light fa-file-chart-line",r.ComParam="SalesReturn";break;case"Docs":r.ImgData="btn_Report",r.Icon="fa-light fa-folder ",r.Label=a.a.GetResource("Docs"),r.ComParam="Docs"}r.Width=s.toString(),r.SectionID=i.toString(),t.push(r),"Submit"==e&&(r=new h.a,r.DBColumnName="Submitprint",r.ImgData="M17.099383,21.729994 L17.099383,24.035563 22.019618,24.035563 22.019618,21.729994 z M15.763892,20.31729 L15.763892,22.26473 C15.763892,22.341222 15.827995,22.40534 15.90447,22.40534 L16.537071,22.40534 16.537071,21.167554 22.58193,21.167554 22.58193,22.40534 23.214533,22.40534 C23.291007,22.40534 23.35511,22.341222 23.35511,22.26473 L23.35511,20.31729 z M20.690592,16.192655 L20.690592,17.39824 21.915168,17.39824 z M17.099383,16.17044 L17.099383,19.019888 22.019618,19.019888 22.019618,17.820068 20.268858,17.820068 20.268858,16.17044 z M16.537071,15.608 L20.697621,15.608 22.58193,17.462922 22.58193,17.819929 C22.835533,17.874203 23.02714,18.100584 23.02714,18.369571 L23.02714,19.019888 23.214533,19.019888 C23.678579,19.019888 24.058001,19.314042 24.058001,19.673298 L24.058001,22.26473 C24.058001,22.729022 23.678579,23.108386 23.214533,23.108386 L22.58193,23.108386 22.58193,24.598001 16.537071,24.598001 16.537071,23.108386 15.90447,23.108386 C15.440421,23.108386 15.061,22.729022 15.061001,22.26473 L15.061001,19.673298 C15.061,19.314042 15.440421,19.019888 15.90447,19.019888 L16.091861,19.019888 16.091861,18.369571 C16.091861,18.100584 16.283468,17.874203 16.537071,17.819929 z M9.4247408,7.9182401 L18.343435,7.9182401 C18.343435,7.9182401 22.433113,11.712019 22.433113,11.712018 L22.433113,14.734 20.624731,14.734 20.624731,12.643335 C20.624731,12.643335 17.642112,9.8768835 17.642113,9.8768835 L11.137668,9.8768835 C10.995637,9.8768835 10.880497,9.9810638 10.880497,10.109576 L10.880497,20.192904 C10.880497,20.321415 10.995637,20.425596 11.137668,20.425596 L13.847999,20.425596 13.847999,22.384239 9.4247408,22.384239 C9.229991,22.384239 9.0721149,22.241371 9.0721149,22.065136 L9.0721149,8.2373428 C9.0721149,8.0611076 9.229991,7.9182401 9.4247408,7.9182401 z M15,1.875 C7.7512627,1.875 1.875,7.7512622 1.875,15 1.875,22.248737 7.7512627,28.125 15,28.125 22.248737,28.125 28.125,22.248737 28.125,15 28.125,7.7512622 22.248737,1.875 15,1.875 z M15,0 C23.284269,0 30,6.7157288 30,15 30,23.284271 23.284269,30 15,30 6.7157297,30 0,23.284271 0,15 0,6.7157288 6.7157297,0 15,0 z",r.Label=a.a.GetResource("Submit_print"),r.ComParam="NoWorkFlowprint",r.Visible=!1,r.Width=s.toString(),r.SectionID=i.toString(),t.push(r))}GetButton(e){let t=this.ButtonsLeft.find(t=>t.DBColumnName==e);return null==t&&(t=this.ButtonsPopup.find(t=>t.DBColumnName==e)),t}GetButtonVisibility(e){var t=this.ButtonsLeft.find(t=>t.DBColumnName==e);return null==t&&(t=this.ButtonsPopup.find(t=>t.DBColumnName==e)),null!=t&&t.Visible&&t.Enable}CheckRightTab(e){let t=this.ButtonsLeft.find(t=>t.DBColumnName==e);null!=t?this.ButtonsLeft.Remove(t):(t=this.ButtonsPopup.find(t=>t.DBColumnName==e),null!=t?this.ButtonsPopup.Remove(t):(t=new h.a,t.Visible=!1))}SetButtonVisibility(e,t){let s=this.ButtonsLeft.find(t=>t.ComParam.toUpperCase()==e.toUpperCase());null!=s?s.Visible=t:(s=this.ButtonsPopup.find(t=>t.ComParam.toUpperCase()==e.toUpperCase()),null!=s&&(s.Visible=t))}worker_DoWork(e){if(Logger.InfoLog("AddEditDocumentViewModel::Entering worker_DoWork"),this.DisplayName=a.a.GetResource("Loading"),this.ScreenObject.LoadScreen(this,this.POSRegisterID),this.ScreenObject.IsAccessDenied)return;if(65==this.ScreenObject.DocumentType){let e="";e=this.FilterLeaveTypes(2);let t=this.ScreenObject._CCFields.find(e=>"dcccnid52"==e.DBColumnName.toLowerCase());if(t&&t instanceof m.b){t.CustomWhere=e;let s=a.a.common.GetDataSet("PAY043","").Tables[0];null!=s&&s.length>0&&(t.DefaultValue=s[0].ComponentID.toString(),t.SelectedValue=parseInt(s[0].ComponentID))}}if(94==this.ScreenObject.DocumentType){let e="";e=this.FilterLeaveTypes(3);let t=this.ScreenObject._CCFields.find(e=>"dcccnid52"==e.DBColumnName.toLowerCase());t&&t instanceof m.b&&(t.CustomWhere=e),this.ScreenObject.GridDataObj.Clear()}if(this.IsNewAssignLeave&&(this.dtALeaveComp=a.a.common.GetDataTable("DOC069",""),null!=this.dtALeaveComp&&this.dtALeaveComp.length>0&&this.FillComponent(this.dtALeaveComp)),this.ScreenObject.IsPayrollDocument&&a.a.SessionManager.IsEmpUser){let e=null,t=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());if(t&&t instanceof m.b){if(a.a.SessionManager.lstEmpFilteredEmpSeqNos.Contains(a.a.SessionManager.iEmployee)){t.DefaultValue=a.a.SessionManager.iEmployee.toString(),t.SelectedValue=a.a.SessionManager.iEmployee,this.ScreenObject.OnGetReference(t);let s={ReferenceTable:null,ReferenceEditTable:null,DBColumnName:"Dimension",ccid:0,dr:e};this.ReferenceCallBack(s),e=s.dr}}else if(t&&t instanceof C.a&&a.a.SessionManager.lstEmpFilteredEmpSeqNos.Contains(a.a.SessionManager.iEmployee)){t.DefaultValue=a.a.SessionManager.iEmployee.toString(),t.SelectedValue=a.a.SessionManager.iEmployee,this.ScreenObject.OnGetReference(t.Name);let s={ReferenceTable:null,ReferenceEditTable:null,DBColumnName:"Dimension",ccid:0,dr:e};this.ReferenceCallBack(s),e=s.dr}}if(this.IsPOs&&0==this.ScreenObject.Data.Tables[1].length)return this.DisplayMessage="NO Register Assigned",this.DialogResult=!0,void(this.OKCancelVisibility=!0);if(this.IsPOs&&""==this.ScreenObject.CCguid)return this.DisplayMessage="Define Register in document prefix",this.DialogResult=!0,void(this.OKCancelVisibility=!0);if(this.IsPOs&&(this.POSPayModes=new Qt.POSPayModesViewModel(this)),this.ScreenObject.GridDataColumns.Contains("FieldType")){if(0==this.ScreenObject.Data.Tables[1].length)return this.DisplayMessage="NO Register Assigned",this.DialogResult=!0,void(this.OKCancelVisibility=!0);if(this.ScreenObject.RegisterNodeID=parseInt(this.ScreenObject.Data.Tables[1][0].NodeID),this.ScreenObject.ShiftNodeID=parseInt("0"==this.ScreenObject.Data.Tables[1][0].ShiftID.toString()?"1":this.ScreenObject.Data.Tables[1][0].ShiftID),0==this.ScreenObject.Data.Tables[8].filter(e=>e.CCID==a.a.SessionManager.RegisterCCID).length)return this.DisplayMessage="Define Register in document prefix",this.DialogResult=!0,void(this.OKCancelVisibility=!0);if(!this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key"))return this.DisplayMessage="Define line wise debit account",this.DialogResult=!0,void(this.OKCancelVisibility=!0);if(!this.ScreenObject.Preferences.ContainsKey("PosPaymentTypeFld")||""==this.ScreenObject.Preferences.PosPaymentTypeFld||"0"==this.ScreenObject.Preferences.PosPaymentTypeFld)return this.DisplayMessage="Define Payment type field in preferences",this.DialogResult=!0,void(this.OKCancelVisibility=!0)}let t=this.ScreenObject.Data.Tables[10].filter(e=>-2==e.CostCenterColID&&(1==e.Mode||3==e.Mode));if(t.length>0?(this.BodyVisible=Object(o.j)(t[0].IsVisible),this.ReadOnlyBody=!Object(o.j)(t[0].IsEditable)):(this.BodyVisible=!0,this.ReadOnlyBody=!1),this.ReadOnlyBody=!(!this.ScreenObject.Preferences.ContainsKey("Lock Body")||!Object(o.j)(this.ScreenObject.Preferences["Lock Body"])),!n.e.IsEmpty(a.a.SessionManager.Preferences.DimensionwiseCurrency)&&parseInt(a.a.SessionManager.Preferences.DimensionwiseCurrency)>5e4&&!(this.ScreenObject.DocumentType>=51&&this.ScreenObject.DocumentType<=199)){if(this.ScreenObject.ColumnSource.find(e=>e.CostCenterID==parseInt(a.a.SessionManager.Preferences.DimensionwiseCurrency)&&e.DisplayMember.toLowerCase().startsWith("dcccnid")))return this.DisplayMessage="Define Exchange Rate Dimension in header",this.DialogResult=!0,void(this.OKCancelVisibility=!0);if(null==this.ScreenObject._CCFields.find(e=>e instanceof m.b&&e.CCID==parseInt(a.a.SessionManager.Preferences.DimensionwiseCurrency)))return this.DisplayMessage="Define Exchange Rate Dimension in document",this.DialogResult=!0,void(this.OKCancelVisibility=!0)}this.SetLockDims(),""==this.ScreenName&&this.ScreenObject.Data.Tables.length>3&&this.ScreenObject.Data.Columns[3].Contains("DocumentName")&&this.ScreenObject.Data.Tables[3].length>0&&(this.ScreenName=this.ScreenObject.Data.Tables[3][0].DocumentName.toString()),this.HistCols=[];let s=new y.a;s.Header="Version",s.DisplayMember="VersionNo",s.ReadOnly=!0,s.DisableTab=!0,s.Width=50,this.HistCols.push(s),s=new y.a,s.Header="Reason",s.DisplayMember="ReviseReason",s.ReadOnly=!0,s.DisableTab=!0,s.Width=100,this.HistCols.push(s),s=new y.a,s.Header="User",s.DisplayMember="ModifiedBy",s.ReadOnly=!0,s.DataType="LINK",s.DisableTab=!0,s.Click.Subscribe(this,"onHistoryClick"),s.Width=100,this.HistCols.push(s),s=new y.a,s.Header="Date",s.DisplayMember="ModifiedDate",s.ReadOnly=!0,s.DisableTab=!0,s.Width=120,this.HistCols.push(s),this.DocHistory=[],this.DocHistoryColumns=[],this.DocHistoryColumns.push("ModifiedBy"),this.DocHistoryColumns.push("ModifiedDate"),this.DocHistoryColumns.push("MaxID"),this.DocHistoryColumns.push("IsCurrent"),this.DocHistoryColumns.push("VersionNo"),this.DocHistoryColumns.push("ReviseReason"),null!=this.ScreenObject.Link&&null!=this.ScreenObject.Link.DocumentList&&this.ScreenObject.Link.DocumentList.cmnItem_Click.Subscribe(this,"onselectall");let i=0,r=!1;if(this.ScreenObject.IsInventory&&(r=Object(o.j)(a.a.SessionManager.Preferences.EnableLocationWise),r=Object(o.j)(a.a.SessionManager.Preferences["Location AverageRate"]),a.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&Object(o.j)(a.a.SessionManager.Preferences.EnableLocationWise)&&a.a.SessionManager.Preferences.ContainsKey("Location AverageRate")&&Object(o.j)(a.a.SessionManager.Preferences["Location AverageRate"])&&(this.ScreenObject.PriceTaxcc.ContainsKey(50002)?this.ScreenObject.PriceTaxcc[50002]=this.ScreenObject.PriceTaxcc[50002]+",a":this.ScreenObject.PriceTaxcc.push(50002,"a")),r=Object(o.j)(a.a.SessionManager.Preferences.EnableDivisionWise),r=Object(o.j)(a.a.SessionManager.Preferences["Division AverageRate"]),a.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&Object(o.j)(a.a.SessionManager.Preferences.EnableDivisionWise)&&a.a.SessionManager.Preferences.ContainsKey("Division AverageRate")&&Object(o.j)(a.a.SessionManager.Preferences["Division AverageRate"])&&(this.ScreenObject.PriceTaxcc.ContainsKey(50001)?this.ScreenObject.PriceTaxcc[50001]=this.ScreenObject.PriceTaxcc[50001]+",a":this.ScreenObject.PriceTaxcc.push(50001,"a")),r=Object(o.j)(a.a.SessionManager.Preferences.EnableLocationWise),r=Object(o.j)(a.a.SessionManager.Preferences["Location Stock"]),a.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&Object(o.j)(a.a.SessionManager.Preferences.EnableLocationWise)&&a.a.SessionManager.Preferences.ContainsKey("Location Stock")&&Object(o.j)(a.a.SessionManager.Preferences["Location Stock"])&&(this.ScreenObject.PriceTaxcc.ContainsKey(50002)?this.ScreenObject.PriceTaxcc[50002]=this.ScreenObject.PriceTaxcc[50002]+",s":this.ScreenObject.PriceTaxcc.push(50002,"s")),r=Object(o.j)(a.a.SessionManager.Preferences.EnableDivisionWise),r=Object(o.j)(a.a.SessionManager.Preferences["Division Stock"]),a.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&Object(o.j)(a.a.SessionManager.Preferences.EnableDivisionWise)&&a.a.SessionManager.Preferences.ContainsKey("Division Stock")&&Object(o.j)(a.a.SessionManager.Preferences["Division Stock"])&&(this.ScreenObject.PriceTaxcc.ContainsKey(50001)?this.ScreenObject.PriceTaxcc[50001]=this.ScreenObject.PriceTaxcc[50001]+",s":this.ScreenObject.PriceTaxcc.push(50001,"s")),i=n.e.Int(a.a.SessionManager.Preferences["Maintain Dimensionwise stock"]),a.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&i>5e4&&(this.ScreenObject.PriceTaxcc.ContainsKey(i)?this.ScreenObject.PriceTaxcc[i]=this.ScreenObject.PriceTaxcc[i]+",s":this.ScreenObject.PriceTaxcc.push(i,"s")),i=n.e.Int(a.a.SessionManager.Preferences["Maintain Dimensionwise AverageRate"]),a.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise AverageRate")&&i>5e4&&(this.ScreenObject.PriceTaxcc.ContainsKey(i)?this.ScreenObject.PriceTaxcc[i]=this.ScreenObject.PriceTaxcc[i]+",a":this.ScreenObject.PriceTaxcc.push(i,"a"))),i=0,r=!1,this.SalesManDimension=new m.b,this.SalesManDimension.Visible=!1,this.ScreenObject.ColumnSource.forEach(e=>{if(e.footer="",i++,"RefNo"==e.DisplayMember||"Denomination"==e.DisplayMember)e.DataType="LINK",e.DisableTab=!0,e.Click.Subscribe(this,"onLinkRefClick"),"Denomination"==e.DisplayMember&&this.ScreenObject.GridDataColumns.push("DenominationsXML");else if("LINK"==e.DataType){if(e.ValueBinding)return;e.Click.Subscribe(this,"onAttachLinkClick")}else"CheckBox"==e.DataType&&e.CheckedChanged.Subscribe(this,"OnCheckedChanged");this.ScreenObject.IsInventory&&0==this.ColumnNo?null!=e.ValueMember&&"productid_key"==e.ValueMember.toLowerCase()?r=!0:r&&e.IsVisible&&(this.ColumnNo=i):this.ScreenObject.IsInventory||0!=this.ColumnNo||(null==e.ValueMember||"debitaccount_key"!=e.ValueMember.toLowerCase()&&"creditaccount_key"!=e.ValueMember.toLowerCase()&&"accountid_key"!=e.ValueMember.toLowerCase()?r&&e.IsVisible&&(this.ColumnNo=i):r=!0),38!=this.ScreenObject.DocumentType&&39!=this.ScreenObject.DocumentType||50005!=e.CostCenterID||(this.SalesManDimension.Visible=!0,this.SalesManDimension.CCID=50005,this.SalesManDimension.Label=e.Header,this.SalesManDimension.TypeID=e.TypeID,this.SalesManDimension.GridViewID=e.GridViewID,this.SalesManDimension.GridViewID>0&&(this.SalesManDimension.SearchVisible=!0)),n.e.IsEmpty(e.Shortcut)||this.Shortcuts.push(e)}),this.DynFooter=!(!this.ScreenObject.Preferences.ContainsKey("Dynamic Footer")||null==this.ScreenObject.Preferences["Dynamic Footer"]||"True"!=this.ScreenObject.Preferences["Dynamic Footer"]),this.AppRejDate.Visible=!(!this.ScreenObject.Preferences.ContainsKey("AppDate")||"True"!=this.ScreenObject.Preferences.AppDate),this.ScreenObject.Data.Tables.length>3&&this.ScreenObject.Data.Tables[3].length>0&&(this.ScreenObject.Data.Columns[3].Contains("IsLineWise")&&!n.e.IsEmpty(this.ScreenObject.Data.Tables[3][0].IsLineWise)&&(this.LineWiseApproval=Object(o.j)(this.ScreenObject.Data.Tables[3][0].IsLineWise)),this.ScreenObject.Data.Columns[3].Contains("UserWise")&&!n.e.IsEmpty(this.ScreenObject.Data.Tables[3][0].UserWise)&&(this.UserWiseApproval=Object(o.j)(this.ScreenObject.Data.Tables[3][0].UserWise)),this.ScreenObject.Data.Columns[3].Contains("OnReject")&&!n.e.IsEmpty(this.ScreenObject.Data.Tables[3][0].OnReject)&&(this.OnRejectEdit=Object(o.j)(this.ScreenObject.Data.Tables[3][0].OnReject)),this.ScreenObject.Data.Columns[3].Contains("attachfile")&&!n.e.IsEmpty(this.ScreenObject.Data.Tables[3][0].attachfile)&&(this.HelpDoc=this.ScreenObject.Data.Tables[3][0].attachfile)),this.RightPanelVisiblity=!this.ScreenObject.Preferences.ContainsKey("HideRightNav")||""==this.ScreenObject.Preferences.HideRightNav||"True"!=this.ScreenObject.Preferences.HideRightNav,this.ScreenObject.Preferences.ContainsKey("DisableRightPanel")&&""!=this.ScreenObject.Preferences.DisableRightPanel&&(this.DisableRightPanel=Object(o.j)(this.ScreenObject.Preferences.DisableRightPanel)),this.ScreenObject.Preferences.ContainsKey("EnableRevision")&&""!=this.ScreenObject.Preferences.EnableRevision&&Object(o.j)(this.ScreenObject.Preferences.EnableRevision)&&(this.ScreenObject.DocPrefix.RevisionCombo.Visible=!0,this.ScreenObject.DocPrefix.RevisionCombo.Items.push(D.d.ComboBoxItems_2("","0")),this.ScreenObject.DocPrefix.RevisionCombo.SelectedValue="0",this.ScreenObject.DocPrefix.RevisionCombo.SelectionChangedCommand.Subscribe(this,"onVerionChanged")),this.ScreenObject.Preferences.ContainsKey("DonotupdateInventory")&&""!=this.ScreenObject.Preferences.DonotupdateInventory&&(this.DonotUpdateInventory=Object(o.j)(this.ScreenObject.Preferences.DonotupdateInventory)),this.ScreenObject.Preferences.ContainsKey("DonotUpdateSchemeQty")&&""!=this.ScreenObject.Preferences.DonotUpdateSchemeQty&&(this.DonotUpdateSchemeQty=Object(o.j)(this.ScreenObject.Preferences.DonotUpdateSchemeQty)),this.ScreenObject.Preferences.ContainsKey("HideNetAmt")&&"True"==this.ScreenObject.Preferences.HideNetAmt&&(this.NetAmtVisibility=!1),this.ScreenObject.Preferences.ContainsKey("HideNetAmt")&&"True"==this.ScreenObject.Preferences.HideNetAmt)this.NetAmtVisibility=!1;else if(this.ScreenObject.Data.Tables.length>10){let e=this.ScreenObject.Data.Tables[10].filter(e=>(1==e.Mode||3==e.Mode)&&-1==e.CostCenterColID);e.length>0&&!n.e.IsEmpty(e[0].IsVisible)&&(this.NetAmtVisibility=Object(o.j)(e[0].IsVisible))}if(this.ScreenObject.Preferences.ContainsKey("OptionalInventory")&&""!=this.ScreenObject.Preferences.OptionalInventory&&Object(o.j)(this.ScreenObject.Preferences.OptionalInventory)){let e=new S.a(0);e.Row=3,e.Column=3,this.ScreenObject.HeaderFields.push(e),this.donotupInv=this.ScreenObject.HeaderFields[this.ScreenObject.HeaderFields.length-1],null!=this.donotupInv&&(this.donotupInv.IsChecked=this.DonotUpdateInventory,this.donotupInv.Label="Do not Update Inventory")}if(this.ConstructFormulaFields(),this.IsInventoryVoucher=this.ScreenObject.IsInventory,this.DocumentType=this.ScreenObject.DocumentType,this.LoadButtons(),32==this.ScreenObject.DocumentType&&(this.savebulk=!0),this.ScreenObject.HeaderFields.forEach(e=>{if(e instanceof m.a)e.ClickCommand.Subscribe(this,"OnHistoryButtonClick");else if(e instanceof p.b)this.Currency=e,this.Currency.Currency.SelectionChangedCommand.Subscribe(this,"onCurrencyChanged"),this.Currency.ExchangeRate.LostFocusCommand.Subscribe(this,"onExchangeRateChanged");else if(e instanceof D.e&&"ChequeBookNo"==e.DBColumnName)this.ChequeBook=e,this.ChequeBook.SelectionChangedCommand.Subscribe(this,"OnChequeBookSelection");else if(e instanceof d.c&&"chequematuritydate"==e.DBColumnName.toLowerCase())e.SelectedDateChanged.Subscribe(this,"ValidateDate");else if(e instanceof d.c&&"duedate"==e.DBColumnName.toLowerCase()){if(31!=this.ScreenObject.DocumentType&&32!=this.ScreenObject.DocumentType||e.SelectedDateChanged.Subscribe(this,"onDateChanged"),this.ScreenObject.Preferences.ContainsKey("DueDateonBillDate")&&""!=this.ScreenObject.Preferences.DueDateonBillDate){let t=this.ScreenObject.Preferences.DueDateonBillDate;for(let s=0;s<this.ScreenObject.HeaderFields.length;s++){let i=this.ScreenObject.HeaderFields[s];if(i instanceof d.c&&i.DBColumnName.toLowerCase()==t.toLowerCase()){e.VoucherDate=i;break}}for(let s=0;s<this.ScreenObject._TextFields.length;s++){let i=this.ScreenObject._TextFields[s];if(i instanceof d.c&&i.DBColumnName.toLowerCase()==t.toLowerCase()){e.VoucherDate=i;break}}}}else e instanceof u.d&&"SKU"==e.DBColumnName?(this.SKU=e,this.SKU.isSKU=!0,e.TextChangedCommand.Subscribe(this,"onSKUKeyDown")):e instanceof d.a&&"docdate"==e.DBColumnName.toLowerCase()&&(38==this.ScreenObject.DocumentType||39==this.ScreenObject.DocumentType||this.ScreenObject.GridDataColumns.Contains("FieldType")?(n.e.IsEmpty(this.ScreenObject.Data.Tables[1][0].Day)||(e.DefaultValue=this.ScreenObject.Data.Tables[1][0].Day.toString(),e.Date=new Date(this.ScreenObject.Data.Tables[1][0].Day),e.Text=new Date(this.ScreenObject.Data.Tables[1][0].Day).ToString(a.a.SessionManager.Preferences["Date Format"]),this.DocumentDate=new Date(this.ScreenObject.Data.Tables[1][0].Day)),e.IsReadOnly=!0):a.a.SessionManager.Preferences.ContainsKey("DocumentDateFromServer")&&"true"==a.a.SessionManager.Preferences.DocumentDateFromServer.toLowerCase()&&this.ScreenObject.Data.Tables.length>22&&this.ScreenObject.Data.Columns[22].Contains("ServerDate")&&this.ScreenObject.Data.Tables[22].length>0&&!n.e.IsEmpty(this.ScreenObject.Data.Tables[22][0].ServerDate)&&(e.DefaultValue=this.ScreenObject.Data.Tables[22][0].ServerDate.toString(),this._Ddate=new Date(this.ScreenObject.Data.Tables[22][0].ServerDate)));e instanceof b.c&&!n.e.IsEmpty(e.KeyTip)&&this.Shortcuts.push(e)}),this.ScreenObject.HeaderFields.Remove(this.SKU),this.ScreenObject._TextFields.forEach(e=>{if(e instanceof u.d?e.LostFocusCommand.Subscribe(this,"onTextBoxLostFocus"):e instanceof D.e?(e.LostFocusCommand.Subscribe(this,"onTextBoxLostFocus"),e.SelectionChangedCommand.Subscribe(this,"onComboBoxSelectionChanged")):e instanceof g.a?e.LostFocusCommand.Subscribe(this,"onTextBoxLostFocus"):(e instanceof d.a||e instanceof d.c||e instanceof d.b)&&e.SelectedDateChanged.Subscribe(this,"onDateChanged"),n.e.IsEmpty(e.KeyTip)||this.Shortcuts.push(e),30==this.ScreenObject.DocumentType&&(this.ScreenObject.Preferences.ContainsKey("AssembleType")&&this.ScreenObject.Preferences.AssembleType==e.DBColumnID.toString()?e instanceof D.e&&(e.SelectionChangedCommand.Subscribe(this,"onTypeChange"),e.Items.Clear(),e.Items.push(D.d.ComboBoxItems_2("DisAssemble","DisAssemble")),e.Items.push(D.d.ComboBoxItems_2("Assemble","Assemble")),e.DefaultValue=e.SelectedValue="DisAssemble"==e.DefaultValue?"DisAssemble":"Assemble"):this.ScreenObject.Preferences.ContainsKey("AssembleProduct")&&this.ScreenObject.Preferences.AssembleProduct==e.DBColumnID.toString()&&e instanceof m.b&&(e.OnPactListBoxValueChanged.Subscribe(this,"OnKitProductChange"),e.CustomWhere=" a.ProductTypeID=9 ")),81==this.ScreenObject.DocumentType||this.IsNewAssignLeave){if("dcAlpha1"==e.DBColumnName.toString()&&e instanceof D.e&&(e.SelectionChangedCommand.Subscribe(this,"OnYearSelected"),e.Items.Clear(),e.Items.push(D.d.ComboBoxItems_2("GradeWise","GradeWise")),e.Items.push(D.d.ComboBoxItems_2("EmployeeWise","EmployeeWise")),e.SelectedValue="GradeWise"),"dcAlpha2"==e.DBColumnName.toString()&&e instanceof D.e){e.SelectionChangedCommand.Subscribe(this,"OnYearSelected");for(let t=2e3;t<2100;t++)e.Items.push(D.d.ComboBoxItems_2(t.toString(),t.toString()))}}else 61==this.ScreenObject.DocumentType?"dcAlpha18"==e.DBColumnName.toString()&&e instanceof D.e&&(e.SelectionChangedCommand.Subscribe(this,"OnYearSelected"),e.Items.Clear(),e.Items.push(D.d.ComboBoxItems_2("(VacDaysPerMonth * MonthDaysToConsider)/TotalMonthDays","1")),e.Items.push(D.d.ComboBoxItems_2("(VacDaysPerYear / 365) * MonthDaysToConsider","2")),e.SelectedValue="1"):85==this.ScreenObject.DocumentType?"dcAlpha1"!=e.DBColumnName.toString()&&"dcAlpha2"!=e.DBColumnName.toString()||(e.CustomFormat="MMM/yyyy",e.Date=new Date((new Date).getFullYear(),(new Date).getMonth(),1),"dcAlpha1"==e.DBColumnName.toString()&&e.SelectedDateChanged.Subscribe(this,"dtpBulkApprEffectFrom_SelectedDateChanged")):58==this.ScreenObject.DocumentType?"dcAlpha10"==e.DBColumnName.toString()&&(e.CustomFormat="MMM/yyyy",e.Date=new Date((new Date).getFullYear(),(new Date).getMonth(),1),e.SelectedDateChanged.Subscribe(this,"PayrollMonthTypeOfField_SelectedDateChanged")):72==this.ScreenObject.DocumentType?"dcAlpha25"==e.DBColumnName.toString()&&(e.CustomFormat="MMM/yyyy",e.Date=new Date((new Date).getFullYear(),(new Date).getMonth(),1),e.SelectedDateChanged.Subscribe(this,"PayrollMonthTypeOfField_SelectedDateChanged")):79==this.ScreenObject.DocumentType&&"dcAlpha1"==e.DBColumnName.toString()&&(e.Date=new Date((new Date).getFullYear(),(new Date).getMonth(),1),e.SelectedDateChanged.Subscribe(this,"PayrollMonthTypeOfField_SelectedDateChanged"))}),this.ScreenObject._CCFields.forEach(e=>{e instanceof m.a&&e.ClickCommand.Subscribe(this,"OnHistoryButtonClick"),n.e.IsEmpty(e.KeyTip)||this.Shortcuts.push(e)}),this.ScreenObject.GridDataObj.RowDeleted.Subscribe(this,"onDeleteRow"),31==this.ScreenObject.DocumentType&&(this.ImportbuttonVisible=!0),1==this.ScreenObject.DocumentType||39==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||6==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||13==this.ScreenObject.DocumentType?this.VoucherType=1:11!=this.ScreenObject.DocumentType&&38!=this.ScreenObject.DocumentType&&5!=this.ScreenObject.DocumentType&&7!=this.ScreenObject.DocumentType&&9!=this.ScreenObject.DocumentType&&24!=this.ScreenObject.DocumentType&&33!=this.ScreenObject.DocumentType&&10!=this.ScreenObject.DocumentType&&8!=this.ScreenObject.DocumentType&&12!=this.ScreenObject.DocumentType||(this.VoucherType=-1),this.Title=this.ScreenName,this.DocStatus="POSDocumentViewModel"==this.ClassName?"":"["+a.a.GetResource("Doc_Draft")+"]",this.ChangeLocation(!1,this.IsEdit,a.a.SessionManager.LocationID,e),this.ScreenObject.SetDefaultValuesforCostCenters(0),this.ScreenObject.Data.Tables.length>22&&this.ScreenObject.Data.Columns[22].Contains("ServerDate")&&this.ScreenObject.Data.Tables[22].length>0&&!n.e.IsEmpty(this.ScreenObject.Data.Tables[22][0].ServerDate))if(1==a.a.SessionManager.IsWebApplication){let e=new Date(this.ScreenObject.Data.Tables[22][0].ServerDate);this.fldDict.ServerDate.setFieldValue(e.ToString("MMM/dd/yyyy")),this.FooterDics.ServerDate.setFieldValue(e.ToString("MMM/dd/yyyy"))}else this.fldDict.ServerDate.setFieldValue(this.ScreenObject.Data.Tables[22][0].ServerDate.toString()),this.FooterDics.ServerDate.setFieldValue(this.ScreenObject.Data.Tables[22][0].ServerDate.toString());if(this.IsPOs&&this.DialogResult){let e="",t=0;if(null!=this.DocumentNumber&&this.DocumentNumber.DocNumberFields.length>0)for(let a=0;a<this.DocumentNumber.DocNumberFields.length;a++)this.DocumentNumber.DocNumberFields[a].CCID>5e4&&(e=e+" AND CCD.dcCCNID"+(this.DocumentNumber.DocNumberFields[a].CCID-5e4)+"="+this.DocumentNumber.DocNumberFields[a].SelectedValue);let s=a.a.admin.POSLogin(this.ScreenObject.RegisterNodeID,this.ScreenObject.ShiftNodeID,this.DocumentDate,100,"","",e),i=s;if(this.PosSessionID=s.obj,-11==this.PosSessionID){if(1!=confirm("Shift is closed.Do you want to open another shift?"))return void(this.DialogResult=!1);{let t=a.a.common.GetDataSet3("POS001",a.a.SessionManager.Preferences.PosShifts,this.ScreenObject.GetTableName(parseInt(a.a.SessionManager.Preferences.PosShifts)),this.DocumentDate.ToString("dd/MMM/yyyy"));if(!(null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&t.Columns[0].Contains("NodeID")))return alert("All Shifts are closed."),void(this.DialogResult=!1);{this.ScreenObject.ShiftNodeID=parseInt(t.Tables[0][0].NodeID),s=a.a.admin.POSLogin(this.ScreenObject.RegisterNodeID,this.ScreenObject.ShiftNodeID,this.DocumentDate,100,"","",e),i=s,this.PosSessionID=s.obj;let n=this.ScreenObject._CCFields.find(e=>e instanceof m.b&&e.CCID==parseInt(a.a.SessionManager.Preferences.PosShifts));n&&(n.SelectedValue=this.ScreenObject.ShiftNodeID,n.DefaultValue=this.ScreenObject.ShiftNodeID.toString())}}}if(-9==this.PosSessionID)return alert("Invalid user for this Register"),void(this.DialogResult=!1);if(-10==this.PosSessionID)return alert("POS session locked by user '"+i.Tables[0][0].UserName.toString()+"'"),void(this.DialogResult=!1);if(this.DocumentDate!=Date.Today()&&this.DocumentDate>Date.Today())if(a.a.SessionManager.Preferences.ContainsKey("NoFuturetransaction")&&"True"==a.a.SessionManager.Preferences.NoFuturetransaction){if(!a.a.SessionManager.IsActionAssigned(43,"Re-Open Pos Closed Shift"))return alert("Day is closed."),a.a.common.GetDataSet("POS002",this.PosSessionID.toString()),void(this.DialogResult=!1);if(1==confirm("Day is closed.Do you want to open last shift?")){let e=[];return e.push(this.PosSessionID),e.push(this.ScreenObject.RegisterNodeID),!this.ScreenObject.Preferences.ContainsKey("PosJVOn")||"2"!=this.ScreenObject.Preferences.PosJVOn&&"1"!=this.ScreenObject.Preferences.PosJVOn||(e.push(this.ScreenObject.Preferences.PosJVOn),e.push(a.a.SessionManager.RegisterCCID),e.push(a.a.SessionManager.Preferences.PosShifts),e.push(a.a.SessionManager.UserID),e.push(a.a.SessionManager.UserName),e.push(a.a.SessionManager.RoleID),e.push(a.a.SessionManager.LanguageID)),a.a.document.ReOpenClosedShift(e),void(this.DialogResult=!1)}}else a.a.SessionManager.IsWebApplication&&alert("Document date and system date are not same.");if(this.ScreenObject.Preferences.ContainsKey("RowHeight")&&!n.e.IsEmpty(this.ScreenObject.Preferences.RowHeight)&&n.e.Double(this.ScreenObject.Preferences.RowHeight)>0&&(this.GridRowHeight=parseFloat(this.ScreenObject.Preferences.RowHeight)),38!=this.ScreenObject.DocumentType&&39!=this.ScreenObject.DocumentType||(this.ScreenObject.Preferences.ContainsKey("right panel width")&&!n.e.IsEmpty(this.ScreenObject.Preferences["right panel width"])&&n.e.Double(this.ScreenObject.Preferences["right panel width"])>0&&(this.RightPanelWidth=parseFloat(this.ScreenObject.Preferences["right panel width"])),this.ScreenObject.Data.Columns[1].Contains("RightPanelWidth")&&!n.e.IsEmpty(this.ScreenObject.Data.Tables[1][0].RightPanelWidth)&&n.e.Double(this.ScreenObject.Data.Tables[1][0].RightPanelWidth)>0&&(this.RightPanelWidth=parseFloat(this.ScreenObject.Data.Tables[1][0].RightPanelWidth)),this.ScreenObject.Data.Columns[1].Contains("RowSize")&&!n.e.IsEmpty(this.ScreenObject.Data.Tables[1][0].RowSize)&&n.e.Double(this.ScreenObject.Data.Tables[1][0].RowSize)>0&&(this.GridRowHeight=parseFloat(this.ScreenObject.Data.Tables[1][0].RowSize)),this.ScreenObject.Data.Columns[1].Contains("TouchScreen")&&!n.e.IsEmpty(this.ScreenObject.Data.Tables[1][0].TouchScreen)&&Object(o.j)(this.ScreenObject.Data.Tables[1][0].TouchScreen)&&(this.TouchVisibility=!0,"POSDocumentViewModel"!=this.ClassName&&(this.TouchView=new Ut.a(this),this.NumericPADView=new Xt(this)))),i.Tables.length>0&&i.Columns[0].Contains("IsOpening")&&"1"==i.Tables[0][0].IsOpening.toString())if(this.ScreenObject.Preferences.ContainsKey("DonotConsiderOpeningInPaymode")&&""!=this.ScreenObject.Preferences.DonotConsiderOpeningInPaymode&&Object(o.j)(this.ScreenObject.Preferences.DonotConsiderOpeningInPaymode)){let e=new lt.AddDenominationViewModel(this,null);a.a.page.ShowDialog(e,ot.AddDenominationComponent,{ShowCenter:!0}).subscribe(e=>{this.DialogResult||a.a.common.GetDataSet("POS002",this.PosSessionID.toString())})}else if(a.a.SessionManager.Preferences.ContainsKey("OpeningCashDOc")&&""!=a.a.SessionManager.Preferences.OpeningCashDOc&&"0"!=a.a.SessionManager.Preferences.OpeningCashDOc)try{let e=new Ee.PostVoucherSaveViewModel(this,parseInt(a.a.SessionManager.Preferences.OpeningCashDOc),0,0,1,1,!1,!0);a.a.page.ShowDialog(e,Ne.PostVoucherSaveComponent,{ShowCenter:!0}).subscribe(e=>{this.DialogResult||(a.a.common.GetDataSet("POS002",this.PosSessionID.toString()),a.a.page.removeActiveTab())})}catch(O){this.DisplayMessage="Error In Loading Cash Receipt Document",Logger.ErrorLog("POS CashIn:",O.message)}if(i.Tables.length>1&&i.Columns[1].Contains("EPOSDim")&&"1"!=i.Tables[1][0].EPOSDim.toString()&&a.a.SessionManager.Preferences.ContainsKey("EPOS")&&n.e.Int(a.a.SessionManager.Preferences.EPOS)>0){let e=this.ScreenObject._CCFields.find(e=>e instanceof m.b&&e.CCID==t);null!=e&&(e.CustomWhere=" a.NodeID IN ("+i.Tables[1][0].EPOSDim.toString()+")",i.Tables[1][0].EPOSDim.toString().Contains(",")||(e.SelectedValue=parseInt(i.Tables[1][0].EPOSDim)))}if(i.Tables.length>1&&i.Columns[1].Contains("SmartCardDim")&&"1"!=i.Tables[1][0].SmartCardDim.toString()&&a.a.SessionManager.Preferences.ContainsKey("SmartCard")&&n.e.Int(a.a.SessionManager.Preferences.SmartCard)>0){let e=this.ScreenObject._CCFields.find(e=>e instanceof m.b&&e.CCID==t);null!=e&&(e.CustomWhere=" a.NodeID IN ("+i.Tables[1][0].SmartCardDim.toString()+")",i.Tables[1][0].SmartCardDim.toString().Contains(",")||(e.SelectedValue=parseInt(i.Tables[1][0].SmartCardDim)))}}else this.ScreenObject.Preferences.ContainsKey("EnableTouch")&&Object(o.j)(this.ScreenObject.Preferences.EnableTouch)&&(this.TouchVisibility=!0);null!=this.SKU?38==this.ScreenObject.DocumentType||39==this.ScreenObject.DocumentType?(this.SKU.Mandatory=!0,"POSDocumentViewModel"==this.ClassName&&(this.SKU.Label=this.SKU.Label.replace("*","")+" F12")):this.SKU.Mandatory=!1:(this.SKU=new u.d,this.SKU.isSKU=!0,this.SKU.Visible=!1);let l=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&55500==e.LinkData);if(l.length>0){let e=this.ScreenObject._TextFields.find(e=>e.DBColumnID.toString()==l[0].CostCenterColID.toString());e instanceof u.d&&(e.Text="0")}this.ScreenObject.GridDataObj.Height=this.ScreenObject.CustomTab.Pages.length>0&&this.ScreenObject.FooterGridData.length>0?252:this.ScreenObject.CustomTab.Pages.length>0?300:350;let c=n.e.Int(this.ScreenObject.Preferences.MaxRows);if(this.ScreenObject.Preferences.ContainsKey("MaxRows")&&c>0){if(c*this.ScreenObject.GridDataObj.RowHeight+55<this.ScreenObject.GridDataObj.Height&&(this.ScreenObject.GridDataObj.Height=c*this.ScreenObject.GridDataObj.RowHeight+55),this.ScreenObject.MinRowCount=c,this.ScreenObject.GridData.length>c){c=this.ScreenObject.GridData.length-c;for(let e=0;e<c;e++)this.ScreenObject.GridDataObj.removeRowAt(0);this.ScreenObject.UpdateSequence()}this.ScreenObject.GridDataObj.CanUserAddRows=!1}this.ScreenObject.Preferences.ContainsKey("BulkSaveon")&&n.e.Int(this.ScreenObject.Preferences.BulkSaveon)>0&&(this.ScreenObject.BulkSaveon=c=n.e.Int(this.ScreenObject.Preferences.BulkSaveon)),this.IsInventoryVoucher?(33!=this.ScreenObject.DocumentType&&34!=this.ScreenObject.DocumentType?(this.SetVisibiltiFalse(),(this.ScreenObject.Preferences.ContainsKey("PrimaryAddress")&&Object(o.j)(this.ScreenObject.Preferences.PrimaryAddress)||this.ScreenObject.Preferences.ContainsKey("BillingAddress")&&Object(o.j)(this.ScreenObject.Preferences.BillingAddress)||this.ScreenObject.Preferences.ContainsKey("ShippingAddress")&&Object(o.j)(this.ScreenObject.Preferences.ShippingAddress))&&(this.AssignAddress=new I.a(this),this.AddressViewVisibility=!0,this.AssignAddress.BillsVisibe=!(!this.ScreenObject.Preferences.ContainsKey("BillingAddress")||!Object(o.j)(this.ScreenObject.Preferences.BillingAddress))&&Object(o.j)(this.ScreenObject.Preferences.BillingAddress),this.AssignAddress.ShipVisibe=!(!this.ScreenObject.Preferences.ContainsKey("ShippingAddress")||!Object(o.j)(this.ScreenObject.Preferences.ShippingAddress))&&Object(o.j)(this.ScreenObject.Preferences.ShippingAddress),this.AssignAddress.PrimVisibe=!(!this.ScreenObject.Preferences.ContainsKey("PrimaryAddress")||!Object(o.j)(this.ScreenObject.Preferences.PrimaryAddress))&&Object(o.j)(this.ScreenObject.Preferences.PrimaryAddress),t=this.ScreenObject.Data.Tables[10].length>0?this.ScreenObject.Data.Tables[10].filter(e=>-6==e.CostCenterColID&&(1==e.Mode||3==e.Mode)):[],t.length>0&&(this.AssignAddress.PrimVisibe=Object(o.j)(t[0].IsVisible),this.AssignAddress.PrimMandatory=Object(o.j)(t[0].IsMandatory)),t=this.ScreenObject.Data.Tables[10].length>0?this.ScreenObject.Data.Tables[10].filter(e=>-7==e.CostCenterColID&&(1==e.Mode||3==e.Mode)):[],this.AssignAddress.BillsVisibe&&this.AssignAddress.PrimVisibe&&t.length>0&&(this.AssignAddress.BillsVisibe=Object(o.j)(t[0].IsVisible),this.AssignAddress.BillsMandatory=Object(o.j)(t[0].IsMandatory)),t=this.ScreenObject.Data.Tables[10].length>0?this.ScreenObject.Data.Tables[10].filter(e=>-8==e.CostCenterColID&&(1==e.Mode||3==e.Mode)):[],this.AssignAddress.ShipVisibe&&t.length>0&&(this.AssignAddress.ShipVisibe=Object(o.j)(t[0].IsVisible),this.AssignAddress.ShipMandatory=Object(o.j)(t[0].IsMandatory)))):this.AddressViewVisibility=!1,this.BillWisedt=[],this.BillWisedtColumns.push("AccountID"),this.BillWisedtColumns.push("Amount"),this.BillWisedtColumns.push("IsCredit"),this.BillWisedtColumns.push("CurrencyID"),this.BillWisedtColumns.push("ExchangeRate"),this.BillWisedtColumns.push("XML"),this.BillWisedtColumns.push("FromTo"),this.BillWisedtColumns.push("AccountName"),this.BillWisedtColumns.push("DocXML"),this.BillWisedtColumns.push("Decimal"),this.ScreenObject.Preferences.ContainsKey("BillwisePosting")&&"1"==this.ScreenObject.Preferences.BillwisePosting&&this.BillWisedtColumns.push("DocSeqNo")):this.AddressViewVisibility=!1,this.ScreenObject.DocPrefix&&this.ScreenObject.DocPrefix.ComboBox.SelectionChangedCommand.Subscribe(this,"OnDocPrefixChanged"),null!=this.ScreenObject.Link&&(this.ScreenObject.Link.LinkCombo.SelectionChangedCommand.Subscribe(this,"OLinkSelectionChanged"),this.ScreenObject.Link.DocumentList.CheckedChangedCommand.Subscribe(this,"OnLinkDocumentCheckedChanged")),this.ButtonSuspend.Mandatory=!!this.IsInventoryVoucher&&!!(this.ScreenObject.Data.Tables.length>22&&this.ScreenObject.Data.Columns[22].Contains("CNT")&&this.ScreenObject.Data.Tables[22].length>0&&!n.e.IsEmpty(this.ScreenObject.Data.Tables[22][0].CNT)&&parseInt(this.ScreenObject.Data.Tables[22][0].CNT)>0),this.ButtonSuspend.Visible=!1,this.FooterVisible=!!((this.ScreenObject.FooterGridData.length>0||this.ScreenObject.Preferences.ContainsKey("Dynamic Footer")&&""!=this.ScreenObject.Preferences["Dynamic Footer"]&&Object(o.j)(this.ScreenObject.Preferences["Dynamic Footer"]))&&this.ScreenObject.FooterColumnSource.length>1&&this.ScreenObject.FooterColumnSource[1].ComboData.length>0);let h=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&55847==e.LinkData);if(h.length>0&&""!=a.a.SessionManager.Preferences.BaseCurrency&&n.e.Int(a.a.SessionManager.Preferences.BaseCurrency)>0){let e=this.ScreenObject._TextFields.find(e=>e.DBColumnID.toString()==h[0].CostcenterColid.toString());e&&e instanceof u.d&&(e.Text=this.ScreenObject.GetExchangeRate(parseInt(a.a.SessionManager.Preferences.BaseCurrency),this.DocumentDate).toString())}Logger.InfoLog("AddEditDocumentViewModel::BuildControls Success"),this.DisplayName=this.ScreenName,this.ScreenObject.Preferences.ContainsKey("HideBody")&&!n.e.IsEmpty(this.ScreenObject.Preferences.HideBody)&&Object(o.j)(this.ScreenObject.Preferences.HideBody.toString())&&(this.BodyVisible=!1),Logger.InfoLog("AddEditDocumentViewModel::Exiting worker_DoWork")}OnHistoryButtonClick(e){null==e.Dialog&&(e.Dialog=new Z.a(e));let t=0,s=0;t=e.SelectedValue,e.Dialog.CheckEditData(),a.a.page.ShowDialog(e.Dialog,$.a,{ShowCenter:!0,Title:a.a.GetResource("History")}).subscribe(i=>{s=e.SelectedValue,t!=s&&(this.ScreenObject.Data.Tables[0].filter(t=>null!=t.LocalReference&&t.LocalReference==e.DBColumnID).length>0||this.ScreenObject.DefaultBasedOn.ContainsKey(e.CCID.toString()))&&this.ScreenObject.GetLinkReferenceData(e.DBColumnID,this.CostCenterID,e.SelectedValue,this.DocumentDate,e.DBColumnName,e.CCID,null)})}OnCheckedChanged(e,t){null!=this.SelectedRow&&(t||94==this.DocumentType&&(n.e.IsEmpty(this.SelectedRow.ProductID_Key)||(this.SelectedRow.dcAlpha7=0,this.ScreenObject.GridDataObj.updateRow(this.SelectedRow))))}GetProductByExternFunc(e,t,s){let i=this.ScreenObject.GetProductByExternFunc(e,this.IsSales,this.ScreenObject.Preferences.OnScan,t);if(null!=i&&i.Tables.length>0&&i.Tables[0].length>0&&i.Columns[0].Contains("ProductID"))for(let r=0;r<i.Tables[0].length;r++){if(r>0&&(s=this.GetEmptyRowPosition(this.ScreenObject.GridDataObj,"ProductID_Key"),t=this.ScreenObject.GridData[s]),n.e.IsEmpty(t.DocSeqNo)&&(t.DocSeqNo=s+1),t.ProductID_Key=i.Tables[0][r].ProductID.toString(),this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(t.ProductCode=i.Tables[0][r].ProductCode.toString()),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(t.ProductName=i.Tables[0][r].ProductName.toString()),this.ScreenObject.GridDataColumns.Contains("UOMID")&&(t.UOM=i.Tables[0][r].UnitName.toString(),t.UOM_Key=i.Tables[0][r].UOMID.toString()),t.Type=i.Tables[0][r].ProductTypeID.toString(),t.UOMConversion=i.Tables[0][r].Conversion.toString(),this.ScreenObject.GridDataColumns.Contains("IsWeightable")&&i.Columns[0].Contains("IsWeightable")&&(t.IsWeightable=i.Tables[0][r].IsWeightable.toString()),this.ScreenObject.Preferences.ContainsKey("EnableWieghingPopupOnQty")&&""!=this.ScreenObject.Preferences.EnableWieghingPopupOnQty&&Object(o.j)(this.ScreenObject.Preferences.EnableWieghingPopupOnQty)&&"true"==t.IsWeightable.toString().toLowerCase()){let e=this.QtyReader("0");"0"==this.IsSales?(t.Quantity=n.e.IsEmpty(e)?0:-parseFloat(e),this.RowForegroundChange(t)):t.Quantity=n.e.IsEmpty(e)?0:parseFloat(e)}else"0"==this.IsSales?(t.Quantity=-1,this.RowForegroundChange(t)):t.Quantity=1;t.UOMConvertedQty=n.e.IsEmpty(i.Tables[0][r].Conversion)?"1":parseFloat(t.UOMConversion)*parseFloat(t.Quantity);let e=null;a.a.SessionManager.Preferences.ContainsKey("POSItemCodeDimension")&&""!=a.a.SessionManager.Preferences.POSItemCodeDimension&&parseInt(a.a.SessionManager.Preferences.POSItemCodeDimension)>5e4&&(e=this.ScreenObject.ColumnSource.find(e=>e.CostCenterID.toString()==a.a.SessionManager.Preferences.POSItemCodeDimension),e&&this.ScreenObject.GridDataColumns.Contains(e.DisplayMember)&&(t[e.DisplayMember]=i.Tables[0][r].Code.toString(),!n.e.IsEmpty(e.ValueMember)&&this.ScreenObject.GridDataColumns.Contains(e.ValueMember)&&i.Columns[0].Contains("NodeID")&&(t[e.ValueMember]=i.Tables[0][r].NodeID.toString()))),this.SalesManDimension.Visible&&this.ScreenObject.GridDataColumns.Contains("dcCCNID5")&&this.SalesManDimension.SelectedValue>0&&(t.dcCCNID5=this.SalesManDimension.Text,t.dcCCNID5_Key=this.SalesManDimension.SelectedValue),this.FillDefaultValues(t),this.RepeatRowData(t),this.BindDivisionorLocation(t),this.FillDatarow(t,i.Tables[0],null,{LocalReference:79,LinkData:55490},"AvgPrice"),this.FillDatarow(t,i.Tables[0],null,{LocalReference:79,LinkData:55491},"DealerPrice"),this.FillDatarow(t,i.Tables[0],null,{LocalReference:79,LinkData:55492},"MRP"),i.Tables.length>1&&i.Tables[1].length>0&&(this.FillPromotions(i.Tables[1],s),s+=i.Tables[1].length);for(let s=11;s<i.Tables[0].Columns.length;s++){let e=i.Tables[0].Columns[s];this.ScreenObject.GridDataColumns.Contains(e)&&!n.e.IsEmpty(i.Tables[0][r][e])&&(t[e]=i.Tables[0][r][e])}if(!n.e.IsEmpty(t.ProductID_Key)){this.ProdID=0,this.AddProductData(t,!1,!0,!1,null,null,e);for(let e=11;e<i.Tables[0].Columns.length;e++){let s=i.Tables[0].Columns[e];this.ScreenObject.GridDataColumns.Contains(s)&&s.toLowerCase().Contains("dcnum")&&!n.e.IsEmpty(i.Tables[0][r][s])&&(t[s]=i.Tables[0][r][s])}this.FillScan(t,s)}}else null!=i&&i.Tables.length>0&&i.Tables[0].length>0&&i.Columns[0].Contains("ErrorMessage")&&(this.DisplayMessage=i.Tables[0][0].ErrorMessage.toString())}GetProductByStockCode(e,t,s){let i=this.ScreenObject.GetProductByStockCode(e);if(null!=i&&i.Tables.length>0&&i.Tables[0].length>0){if(t.ProductID_Key=i.Tables[0][0].ProductID.toString(),this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(t.ProductCode=i.Tables[0][0].ProductCode.toString()),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(t.ProductName=i.Tables[0][0].ProductName.toString()),this.ScreenObject.GridDataColumns.Contains("UOMID")&&(t.UOM=i.Tables[0][0].UnitName.toString(),t.UOM_Key=i.Tables[0][0].UOMID.toString()),t.Type=i.Tables[0][0].ProductTypeID.toString(),t.UOMConversion=i.Tables[0][0].Conversion.toString(),this.ScreenObject.GridDataColumns.Contains("IsWeightable")&&i.Columns[0].Contains("IsWeightable")&&(t.IsWeightable=i.Tables[0][0].IsWeightable.toString()),this.ScreenObject.Preferences.ContainsKey("EnableWieghingPopupOnQty")&&""!=this.ScreenObject.Preferences.EnableWieghingPopupOnQty&&Object(o.j)(this.ScreenObject.Preferences.EnableWieghingPopupOnQty)&&"true"==t.IsWeightable.toString().toLowerCase()){let e=this.QtyReader("0");"0"==this.IsSales?(t.Quantity=n.e.IsEmpty(e)?0:-parseFloat(e),this.RowForegroundChange(t)):t.Quantity=n.e.IsEmpty(e)?0:parseFloat(e)}else"0"==this.IsSales?(t.Quantity=-1,this.RowForegroundChange(t)):t.Quantity=1;if(t.UOMConvertedQty=n.e.IsEmpty(i.Tables[0][0].Conversion)?"1":parseFloat(t.UOMConversion)*parseFloat(t.Quantity),a.a.SessionManager.Preferences.ContainsKey("POSItemCodeDimension")){let e=this.ScreenObject.ColumnSource.find(e=>e.CostCenterID.toString()==a.a.SessionManager.Preferences.POSItemCodeDimension);e&&this.ScreenObject.GridDataColumns.Contains(e.DisplayMember)&&(t[e.DisplayMember]=i.Tables[0][0].Code.toString(),!n.e.IsEmpty(e.ValueMember)&&this.ScreenObject.GridDataColumns.Contains(e.ValueMember)&&i.Columns[0].Contains("NodeID")&&(t[e.ValueMember]=i.Tables[0][0].NodeID.toString()))}this.SalesManDimension.Visible&&this.ScreenObject.GridDataColumns.Contains("dcCCNID5")&&this.SalesManDimension.SelectedValue>0&&(t.dcCCNID5=this.SalesManDimension.Text,t.dcCCNID5_Key=this.SalesManDimension.SelectedValue),this.FillDefaultValues(t),this.RepeatRowData(t),this.BindDivisionorLocation(t),this.FillDatarow(t,i.Tables[0],null,{LocalReference:79,LinkData:55490},"AvgPrice"),this.FillDatarow(t,i.Tables[0],null,{LocalReference:79,LinkData:55491},"DealerPrice"),this.FillDatarow(t,i.Tables[0],null,{LocalReference:79,LinkData:55492},"MRP"),i.Tables.length>1&&i.Tables[1].length>0&&(this.FillPromotions(i.Tables[1],s),s+=i.Tables[1].length)}this.ScreenObject.UpdateSequence()}onSKUKeyDown(e,t){a.a.IsNativeMobile&&""!=this.SKU.Text||null!=this.SKU&&"13"==t.keyCode?this.IsInventoryVoucher?this.onSKUSearch(this.SKU.Text):this.SearchInvoice(this.SKU.Text):null!=this.SKU&&"F5"==t.key&&(event.preventDefault(),a.a.page.ShowDialog(new le(this,7),ce.a,{ShowCenter:!0}))}SearchInvoice(e){let t=!1,s="";if(18!=this.DocumentType&&19!=this.DocumentType&&21!=this.DocumentType&&22!=this.DocumentType||!this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")?14!=this.DocumentType&&15!=this.DocumentType&&20!=this.DocumentType&&23!=this.DocumentType||!this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")?this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&(s="AccountID_Key"):s="DebitAccount_Key":(s="CreditAccount_Key",t=!0),""!=s){let i=this.GetEmptyRowPosition(this.ScreenObject.GridDataObj,s),a=this.ScreenObject.GridData[i],n=this.ScreenObject.GetDetailsByDocno(e);if(null!=n&&n.Tables.length>0&&n.Columns[0].Contains("Account1")&&n.Tables[0].length>0){if(a[s]=n.Tables[0][0].Account1.toString(),this.ScreenObject.GridDataColumns.Contains("AccountName")&&(a.AccountName=n.Tables[0][0].AccountName.toString()),this.ScreenObject.GridDataColumns.Contains("AccountCode")&&(a.AccountCode=n.Tables[0][0].AccountCode.toString()),a.Type=Object(o.j)(n.Tables[0][0].IsBillwise.toString()),Object(o.j)(n.Tables[0][0].IsBillwise.toString())){let e=1,r=1;null!=this.Currency&&null!=this.Currency.Currency.SelectedValue&&""!=this.Currency.Currency.SelectedValue&&(e=parseInt(this.Currency.Currency.SelectedValue)),null!=this.Currency&&null!=this.Currency.ExchangeRate.Text&&""!=this.Currency.ExchangeRate.Text&&(r=parseFloat(this.Currency.ExchangeRate.Text)),this.Setselectedrow(i),this.CheckIsBillWise(parseInt(a[s]),a,s,0,t,e,r,n.Tables[0][0].VoucherNo.toString())}this.SKU.Text=""}}}CheckandAddBatch(e,t){let s=0,i=0;if(this.ScreenObject.Preferences.ContainsKey("Donotuselocation")&&""!=this.ScreenObject.Preferences.Donotuselocation&&Object(o.j)(this.ScreenObject.Preferences.Donotuselocation)){let e=this.ScreenObject._CCFields.find(e=>"dcccnid2"==e.DBColumnName.toLowerCase());null!=e&&null!=e&&e instanceof m.b&&e.SelectedValue>0?i=e.SelectedValue:null!=t&&this.ScreenObject.GridDataColumns.Contains("dcCCNID2_Key")&&!n.e.IsEmpty(t.dcCCNID2_Key)&&(i=parseInt(t.dcCCNID2_Key.toString()))}else i=this.ScreenObject.LocationID>0?this.ScreenObject.LocationID:a.a.SessionManager.LocationID;s=this.ScreenObject.DivisionID>0?this.ScreenObject.DivisionID:a.a.SessionManager.DivisionID;let r=0,l=1;!n.e.IsEmpty(t.Quantity)&&parseFloat(t.Quantity.toString())>0?r=parseFloat(t.Quantity.toString()):this.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!n.e.IsEmpty(t.FreeQTY)&&parseFloat(t.FreeQTY.toString())>0&&(r=parseFloat(t.FreeQTY.toString())),this.ScreenObject.GridDataColumns.Contains("UOMConversion")&&!n.e.IsEmpty(t.UOMConversion)&&(l=parseFloat(t.UOMConversion.toString())),r*=l;let c=this.ScreenObject.GetProductwiseBatches(parseInt(t.ProductID_Key.toString()),0,this.VoucherType,t,0,!1),h=0,u=null;if(this.barcodeValues.ContainsKey("Batch_Code")?u=c.Tables[0].filter(e=>e.BatchCode==this.barcodeValues.Batch_Code):this.barcodeValues.ContainsKey("Batch_No")&&(u=c.Tables[0].filter(e=>e.BATCHNUMBER==this.barcodeValues.Batch_No)),null!=u&&0==u.length){if(!this.ScreenObject.Preferences.ContainsKey("OnBatchScan")||"1"!=this.ScreenObject.Preferences.OnBatchScan&&"2"!=this.ScreenObject.Preferences.OnBatchScan)return;{if("1"==this.ScreenObject.Preferences.OnBatchScan&&confirm("Batch not exits.Do you want to create?"))return;let e,s,i=0,r=!1,o="";if(a.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise Batches")&&!n.e.IsEmpty(a.a.SessionManager.Preferences["Maintain Dimensionwise Batches"])&&(i=n.e.Int(a.a.SessionManager.Preferences["Maintain Dimensionwise Batches"].toString()),i>0)){for(let e=0;e<this.ScreenObject._CCFields.length;e++){const t=this.ScreenObject._CCFields[e];if(t instanceof m.b&&t.CCID==i){o="CCNID"+(i-5e4)+"='"+t.SelectedValue+"',",r=!0;break}}r||null!=t&&i>5e4&&this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(i-5e4).toString()+"_Key")&&!n.e.IsEmpty(t["dcCCNID"+(i-5e4).toString()+"_Key"])&&(o=o+"CCNID"+(i-5e4)+"='"+t["dcCCNID"+(i-5e4).toString()+"_Key"].toString()+"',")}if(this.ScreenObject.Preferences.ContainsKey("BatchFilterDim")&&(i=0,r=!1,i=n.e.Int(this.ScreenObject.Preferences.BatchFilterDim.toString()),i>0&&!o.Contains("CCNID"+(i-5e4)+"="))){for(let e=0;e<this.ScreenObject._CCFields.length;e++){const t=this.ScreenObject._CCFields[e];if(t instanceof m.b&&t.CCID==i){t.SelectedValue>0&&(o=o+"CCNID"+(i-5e4)+"='"+t.SelectedValue+"',"),r=!0;break}}r||i>5e4&&this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(i-5e4).toString()+"_Key")&&(r=!0,n.e.IsEmpty(t["dcCCNID"+(i-5e4).toString()+"_Key"])||(o=o+"CCNID"+(i-5e4)+"='"+t["dcCCNID"+(i-5e4).toString()+"_Key"].toString()+"',"))}if(this.barcodeValues.ContainsKey("Batch_MfgDate")&&n.e.isValidDate(this.barcodeValues.Batch_MfgDate)||(e=(new Date).OnlyDate()),this.barcodeValues.ContainsKey("Batch_ExpDate")&&n.e.isValidDate(this.barcodeValues.Batch_ExpDate)||(s=(new Date).OnlyDate().AddYears(1)),h=this.ScreenObject.SaveBatch(this.barcodeValues.Batch_No,e,s,null,0,0,0,t.ProductID_Key.toString(),"",o),h<1)return}}else null!=u&&(h=parseInt(u[0].BatchID.toString()));if(e.length>1&&this.ScreenObject.Preferences.ContainsKey("DuplicateProduct_IncrementQuantity")&&!n.e.IsEmpty(this.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity)&&Object(o.j)(this.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity))for(let a=0;a<e.length;a++){const s=e[a];if(!n.e.IsEmpty(s.ExtraXML)&&s!=t){let e=new n.f;e.LoadXml(s.ExtraXML.toString());let i=e.SelectNodes("xml/Row");if(i.length>0&&null!=i[0].attributes.BatchID.value&&i[0].attributes.BatchID.value==h.toString()){let a=1;return n.e.IsEmpty(t.Quantity)||(a=parseFloat(t.Quantity.toString())),this.ClearDatarow(t,!0),n.e.IsEmpty((t=s).Quantity)||(t.Quantity=parseFloat(t.Quantity.toString())+a),i[0].attributes.Quantity.value=t.Quantity.toString(),null!=i[0].attributes.Release&&(i[0].attributes.Release.value=t.Quantity.toString()),void(t.ExtraXML=e.InnerXml)}}}let d="";d+='<xml><Row ProductID="'+t.ProductID_Key.toString()+'" ',d+=' BatchID="'+h+'" ',d+=' Quantity="'+t.Quantity.toString()+'" ',d+=' Hold="0" ',d+=' Release="'+t.Quantity.toString()+'" ></Row></xml>',t.ExtraXML=d.toString()}onSKUSearch(e){if(this.ScreenObject.Preferences.ContainsKey("MandatorySalesMan")&&"True"==this.ScreenObject.Preferences.MandatorySalesMan&&null!=this.SalesManDimension&&this.SalesManDimension.Visible&&this.SalesManDimension.SelectedValue<1)return void(this.DisplayMessage=a.a.GetResource("Select")+" "+this.SalesManDimension.Label);let t=this.GetEmptyRowPosition(this.ScreenObject.GridDataObj,"ProductID_Key"),s=this.ScreenObject.GridData[t];if(this.ScreenObject.Preferences.ContainsKey("OnScan")&&""!=this.ScreenObject.Preferences.OnScan.toLowerCase())this.GetProductByExternFunc(this.SKU.Text,s,t);else if(this.ScreenObject.Preferences.ContainsKey("PickStockRate")&&"true"==this.ScreenObject.Preferences.PickStockRate.toLowerCase())this.GetProductByStockCode(this.SKU.Text,s,t),n.e.IsEmpty(s.ProductID_Key)||this.FillScan(s,t);else{let e=0,r=this.ScreenObject.ColumnSource.find(e=>null!=e.DisplayMember&&"ProductCode"==e.DisplayMember);if(r&&r.UseBarcode){let t={PID:0};if(this.ReadBarcode(r.BarcodeDef,r.BarcodeProp,null,s,this.SKU.Text,t)){let r;if(e=t.PID,r=31==this.DocumentType&&this.ScreenObject.GridDataColumns.Contains("BOEID")&&this.barcodeValues.ContainsKey("INVID")?this.ScreenObject.GridData.filter(e=>e.BOEID==this.barcodeValues.INVID):this.ScreenObject.GridDataColumns.Contains("IsFullBatchScanned")?this.ScreenObject.GridData.filter(t=>parseInt(t.ProductID_Key)==e&&(null==t.IsFullBatchScanned||"1"!=t.IsFullBatchScanned)):this.barcodeValues.ContainsKey("Unit_Key")?this.ScreenObject.GridData.filter(t=>t.ProductID_Key==e&&t.Unit_Key==this.barcodeValues.Unit_Key):this.ScreenObject.GridData.filter(t=>parseInt(t.ProductID_Key)==e),r.length>0&&r[0]!=s&&(1!=this.VoucherType||!this.barcodeValues.ContainsKey("Batch_Code")&&!this.barcodeValues.ContainsKey("Batch_No"))&&(31==this.DocumentType||this.ScreenObject.Preferences.ContainsKey("DuplicateProduct_IncrementQuantity")&&""!=n.e.String(this.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity)&&"True"==n.e.String(this.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity))){let t=1;if(n.e.IsEmpty(s.Quantity)||(t=parseFloat(s.Quantity)),this.ClearDatarow(s,!0),s=r[0],n.e.IsEmpty(s.Quantity)||(s.Quantity=parseFloat(s.Quantity)+t),this.barcodeValues.ContainsKey("INVID")&&this.ScreenObject.GridDataColumns.Contains("DocExtraXML")&&(s.DocExtraXML='<DocExtraXML><Row RefID="'+this.barcodeValues.INVID+'" Qty="'+s.Quantity.toString()+'" Type="1" ></Row></DocExtraXML>',s.BOEID=this.barcodeValues.INVID.toString(),31!=this.DocumentType)){let t=this.ScreenObject.GetinvBinDetails(this.barcodeValues.INVID.toString(),e.toString(),"");null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&this.AddBins(s,!1,!1,t.Tables[0])}}else if(s.ProductID_Key=e,"0"==this.IsSales?(s.Quantity=-1,this.RowForegroundChange(s)):s.Quantity=1,this.ProdID=0,this.AddProductData(s,!1,!1,!1,null,null),null!=this.barcodeValues&&this.barcodeValues.length>0)for(let e=0;e<this.barcodeValues.keys.length;e++){let t={Key:this.barcodeValues.keys[e],Value:this.barcodeValues.values[e]};if(this.ScreenObject.GridDataColumns.Contains(t.Key))if("Unit"!=t.Key&&this.ScreenObject.GridDataColumns.Contains(t.Key+"_Key")){let e=this.ScreenObject.ColumnSource.find(e=>e.DisplayMember.toLowerCase()==t.Key.toLowerCase());if(e&&e.CostCenterID>0&&11!=e.CostCenterID){let i=this.ScreenObject.GetCCListViewDataID(e.CostCenterID,e.TypeID,t.Value.toString());null!=i&&i.Tables.length>0&&i.Tables[0].length>0&&i.Columns[0].Contains("NodeID")&&!n.e.IsEmpty(i.Tables[0][0].NodeID)&&(s[t.Key+"_Key"]=i.Tables[0][0].NodeID.toString(),s[t.Key]=t.Value,this.ScreenObject.Data.Tables[0].filter(t=>null!=t.LocalReference&&t.LocalReference==e.ID).length>0&&this.ScreenObject.GetLinkReferenceData(parseInt(e.ID),this.DocumentID,parseInt(s[e.ValueMember]),Date.Today(),"",e.CostCenterID,s))}else if(("DATE"==e.DataType||"DATETIME"==e.DataType)&&n.e.isValidDate(t.Value)){let i=new Date(t.Value);s[t.Key+"_Key"]=i,s[t.Key]=i.ToString("DATE"==e.DataType?a.a.SessionManager.Preferences["Date Format"]:a.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss tt")}}else s[t.Key]=t.Value;else if(this.barcodeValues.ContainsKey("INVID")){if(this.ScreenObject.GridDataColumns.Contains("DocExtraXML")&&(this.barcodeValues.ContainsKey("Quantity")&&(s.Quantity=this.barcodeValues.Quantity),s.DocExtraXML='<DocExtraXML><Row RefID="'+this.barcodeValues.INVID+'" Qty="'+s.Quantity.toString()+'" Type="1" ></Row></DocExtraXML>',s.BOEID=this.barcodeValues.INVID.toString(),31!=this.DocumentType)){let e=this.ScreenObject.GetinvBinDetails(this.barcodeValues.INVID.toString(),s.ProductID_Key.toString(),"");null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&this.AddBins(s,!1,!1,e.Tables[0])}}else{let e=this.ScreenObject.ColumnSource.find(e=>!n.e.IsEmpty(e.ValueMember)&&e.ValueMember.toLowerCase()==t.Key.toLowerCase()+"_key");if(e&&e.CostCenterID>0){let i=this.ScreenObject.GetCCListViewDataID(e.CostCenterID,e.TypeID,t.Value.toString());null!=i&&i.Tables.length>0&&i.Tables[0].length>0&&i.Columns[0].Contains("NodeID")&&!n.e.IsEmpty(i.Tables[0][0].NodeID)&&(s[e.ValueMember]=i.Tables[0][0].NodeID.toString(),s[e.DisplayMember]=t.Value,this.ScreenObject.Data.Tables[0].filter(t=>null!=t.LocalReference&&t.LocalReference==e.ID).length>0&&this.ScreenObject.GetLinkReferenceData(parseInt(e.ID),this.DocumentID,parseInt(s[e.ValueMember]),Date.Today(),"",e.CostCenterID,s))}}}if("5"==s.Type.toString()&&(this.barcodeValues.ContainsKey("Batch_Code")||this.barcodeValues.ContainsKey("Batch_No")))if(-1==this.VoucherType){let e=0,t=0;if(this.ScreenObject.Preferences.ContainsKey("Donotuselocation")&&""!=this.ScreenObject.Preferences.Donotuselocation&&Object(o.j)(this.ScreenObject.Preferences.Donotuselocation)){var i=this.ScreenObject._CCFields.find(e=>"dcccnid2"==e.DBColumnName.toLowerCase());null!=i&&i instanceof m.b&&i.SelectedValue>0?t=i.SelectedValue:null!=s&&this.ScreenObject.GridDataColumns.Contains("dcCCNID2_Key")&&!n.e.IsEmpty(s.dcCCNID2_Key)&&(t=parseInt(s.dcCCNID2_Key.toString()))}else t=this.ScreenObject.LocationID>0?this.ScreenObject.LocationID:a.a.SessionManager.LocationID;e=this.ScreenObject.DivisionID>0?this.ScreenObject.DivisionID:a.a.SessionManager.DivisionID;let l=0,c=1;n.e.Double(s.Quantity)>0?l=parseFloat(s.Quantity.toString()):n.e.Double(s.FreeQTY)>0&&(l=parseFloat(s.FreeQTY.toString())),this.ScreenObject.GridDataColumns.Contains("UOMConversion")&&!n.e.IsEmpty(s.UOMConversion)&&(c=parseFloat(s.UOMConversion.toString())),l*=c;let h=new Te.a(this.ScreenObject.GridDataObj);if(h.BatchNumberViewModel_3(this,this.VoucherType,l,parseInt(s.ProductID_Key),s.ProductName.toString(),t,e,s),r.length>2&&this.ScreenObject.Preferences.ContainsKey("DuplicateProduct_IncrementQuantity")&&!n.e.IsEmpty(this.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity)&&Object(o.j)(this.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity)){let e=null;if(this.barcodeValues.ContainsKey("Batch_Code")?e=h.GridData.filter(e=>e.BatchCode==this.barcodeValues.Batch_Code):this.barcodeValues.ContainsKey("Batch_No")&&(e=h.GridData.filter(e=>e.BATCHNUMBER==this.barcodeValues.Batch_No)),null!=e&&e.length>0){let t;for(let i=0;i<r.length;i++){let a=r[i];if(!n.e.IsEmpty(a.ExtraXML)){t=new n.f,t.LoadXml(a.ExtraXML.toString());let i=t.SelectNodes("xml/Row");if(i.length>0&&null!=i[0].attributes.BatchID.value&&i[0].attributes.BatchID.value==e[0].BatchID.toString()){if(null!=i[0].attributes.RefInvID&&i[0].attributes.RefInvID.value!=e[0].RefInvID.toString())continue;if(a!=s){n.e.IsEmpty(e[0].BalQty)||n.e.IsEmpty(a.Quantity)||(e[0].BalQty=h.GridDataColumns.Contains("QtyUom")?parseFloat(e[0].BalQty)+parseFloat(a.Quantity)*c:parseFloat(e[0].BalQty)+parseFloat(a.Quantity)),n.e.IsEmpty(s.ExtraXML)||(t=new n.f,t.LoadXml(s.ExtraXML.toString()),i=t.SelectNodes("xml/Row"),i.length>0&&null!=i[0].attributes.BatchID.value&&(e=h.GridData.filter(e=>e.BatchID==i[0].attributes.BatchID.value),e.length>0&&(e[0].Quantity=null,h.GridDataColumns.Contains("QtyUom")&&(e[0].QtyUom=null)))),s.Quantity=parseFloat(s.Quantity)-1,a.Quantity=parseFloat(a.Quantity)+1,c>1&&(s.UOMConvertedQty=parseFloat(s.Quantity)*c,a.UOMConvertedQty=parseFloat(a.Quantity)*c),s=a,h.BatchQty=parseFloat(s.Quantity)*c,h.drSel=s;break}}}}}}for(let s=0;s<h.GridData.length;s++){if(this.barcodeValues.ContainsKey("Batch_Code")&&n.e.StringValue(h.GridData[s].BatchCode).toString().toLowerCase()==this.barcodeValues.Batch_Code.toString().toLowerCase()){if(!n.e.IsEmpty(h.GridData[s].BalQty)&&!n.e.IsEmpty(h.GridData[s].Quantity)&&parseFloat(h.GridData[s].BalQty.toString())<=parseFloat(h.GridData[s].Quantity.toString()))continue;if(""==n.e.String(h.GridData[s].BalQty)||0==parseFloat(h.GridData[s].BalQty.toString()))continue;h.GridData[s].Quantity=null,h.SelectQty(h.GridData[s]);break}if(this.barcodeValues.ContainsKey("Batch_No")&&n.e.StringValue(h.GridData[s].BATCHNUMBER).toString().toLowerCase()==this.barcodeValues.Batch_No.toString().toLowerCase()){if(!n.e.IsEmpty(h.GridData[s].BalQty)&&!n.e.IsEmpty(h.GridData[s].Quantity)&&parseFloat(h.GridData[s].BalQty.toString())<=parseFloat(h.GridData[s].Quantity.toString()))continue;if(""==n.e.String(h.GridData[s].BalQty)||0==parseFloat(n.e.String(h.GridData[s].BalQty)))continue;h.GridData[s].Quantity=null,h.SelectQty(h.GridData[s]);break}}h.DisplayMessage="",h.OnSave("AutoSaveScan"),""!=h.DisplayMessage&&a.a.page.ShowDialog(h,je.a)}else this.CheckandAddBatch(r,s);null!=this.barcodeValues&&this.barcodeValues.Clear()}else if(this.ScreenObject.Preferences.ContainsKey("usetempifnotscanned")&&Object(o.j)(this.ScreenObject.Preferences.usetempifnotscanned)){if(31==this.DocumentType&&this.ScreenObject.GridDataColumns.Contains("BOEID")&&!this.barcodeValues.ContainsKey("INVID"))return void n.e.PlaySound("beep-01.wav");if(!(this.ScreenObject.TempProductID>0))return n.e.PlaySound("beep-01.wav"),void(this.DisplayMessage="Define Temp product");{let t;if(e=this.ScreenObject.TempProductID,t=31==this.DocumentType&&this.ScreenObject.GridDataColumns.Contains("BOEID")&&this.barcodeValues.ContainsKey("INVID")?this.ScreenObject.GridData.filter(e=>e.BOEID==this.barcodeValues.INVID):this.ScreenObject.GridData.filter(t=>t.ProductID_Key==e),t.length>0&&t[0]!=s&&(31==this.DocumentType||this.ScreenObject.Preferences.ContainsKey("DuplicateProduct_IncrementQuantity")&&""!=n.e.String(this.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity)&&"True"==n.e.String(this.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity))){let e=1;n.e.IsEmpty(s.Quantity)||(e=parseFloat(s.Quantity)),this.ClearDatarow(s,!0),s=t[0],n.e.IsEmpty(s.Quantity)||(s.Quantity=parseFloat(s.Quantity)+e)}else s.ProductID_Key=e,"0"==this.IsSales?(s.Quantity=-1,this.RowForegroundChange(s)):s.Quantity=1,this.ProdID=0,this.AddProductData(s,!1,!1,!1,null,null);if(this.barcodeValues.ContainsKey("INVID")&&this.ScreenObject.GridDataColumns.Contains("DocExtraXML")&&(s.DocExtraXML='<DocExtraXML><Row RefID="'+this.barcodeValues.INVID+'" Qty="'+s.Quantity.toString()+'" Type="1" ></Row></DocExtraXML>',s.BOEID=this.barcodeValues.INVID.toString(),31!=this.DocumentType)){let e=this.ScreenObject.GetinvBinDetails(this.barcodeValues.INVID.toString(),s.ProductID_Key.toString(),"");null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&this.AddBins(s,!1,!1,e.Tables[0])}}}}if(0==e&&(38==this.DocumentType||39==this.DocumentType)){let e=a.a.common.GetDataTable("DOC065",this.SKU.Text);if(!(null!=e&&e.length>0))return this.DisplayMessage="Item not found",void(this.MessageVisibility=!0);if("32"==n.e.String(e[0].StatusID))return this.DisplayMessage="Cannot scan the Inactive item",void(this.MessageVisibility=!0);this.DisplayMessage="",this.MessageVisibility=!1,this.AddProductData(s,!1,!1,!1,null,this.SKU.Text)}n.e.IsEmpty(s.ProductID_Key)||(this.FillScan(s,t),n.e.PlaySound("beep-02.wav"))}if(n.e.IsEmpty(s.ProductID_Key))n.e.PlaySound("beep-01.wav"),this.SKU.Visible&&this.ScreenObject.Preferences.ContainsKey("ShowSearchOnProductNotFound")&&""!=this.ScreenObject.Preferences.ShowSearchOnProductNotFound&&Object(o.j)(this.ScreenObject.Preferences.ShowSearchOnProductNotFound)&&this.onButtonClick("SearchSKU");else{let e=this.ScreenObject.ColumnSource.find(e=>!n.e.IsEmpty(e.ValueMember)&&"productid_key"==e.ValueMember.toLowerCase()&&!n.e.IsEmpty(e.Shortcut)&&"lostfocus"==e.Shortcut.toLowerCase());e&&this.ValidateData_Column(e,s,!0)&&this.ScreenObject.GetExternalFuncData(e.Mode,e.SPName,e.IPParams,e.OPParams,s),this.PoleDisplayMessage(2,s),this.ScreenObject.GridDataObj.updateRow(s),this.ScreenObject.GridDataObj.refreshDatawithIDs()}}FillScan(e,t){if(this.Setselectedrow(38==this.DocumentType||39==this.DocumentType?t:this.ScreenObject.GridData.indexOf(e)),this.SKU.Text="",this.CalculateTotals(e,!1,"Quantity"),Object(o.j)(this.ScreenObject.Preferences.EnableSchemes)){let t="GROSS";if(this.ScreenObject.Preferences.ContainsKey("SchemesNumericFields")&&""!=this.ScreenObject.Preferences.SchemesNumericFields&&"0"!=this.ScreenObject.Preferences.SchemesNumericFields){let e=this.ScreenObject.ColumnSource.find(e=>e.ID==this.ScreenObject.Preferences.SchemesNumericFields);e&&""!=e.DisplayMember&&(t=e.DisplayMember)}if(n.e.Int(e.ProductID_Key)>0){let t=this.ScreenObject.GetSchemes(this.DocumentDate,e);t.Tables.length>0&&t.Columns[0].Contains("SchemeID")&&this.fillSchemevalues(t.Tables[0],t.Columns[0],e)}this.ApplySchemes(e)}(38==this.DocumentType||39==this.DocumentType)&&this.ScreenObject.Preferences.ContainsKey("DuplicateProduct_IncrementQuantity")&&""!=this.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity&&Object(o.j)(this.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity)&&(this.AddProductQty(e,!1)&&(n.e.IsNum(e.Quantity)&&n.e.IsNum(e.UOMConversion)?e.UOMConvertedQty=parseFloat(e.UOMConversion)*parseFloat(e.Quantity):n.e.IsEmpty(e.Quantity)||(e.UOMConvertedQty=e.Quantity.toString()),this.Celleditend(e,"Quantity",this.CostCenterID),this.ScreenObject.GridDataObj.updateRow(e),this.CalculateTotals(e,!1,"Quantity")),this.SKU.SetFocus=!0)}FillPromotions(e,t){let s=0,i=this.ScreenObject.GridData.Compute("max","MaxSchemeID");null!=i&&(s=n.e.Int(i)),s++,this.ScreenObject.GridData[t].MaxSchemeID=s,this.ScreenObject.GridData[t].IsScheme="N",this.ScreenObject.GridData[t].SchemeID="2",t++;for(let a=0;a<e.length;a++){let i=this.ScreenObject.GridDataObj.NewRow();i.ProductID_Key=e[a].ProductID.toString(),this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(i.ProductCode=e[a].ProductCode.toString()),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(i.ProductName=e[a].ProductName.toString()),this.ScreenObject.GridDataColumns.Contains("UOMID")&&(i.UOM=e[a].UnitName.toString(),i.UOM_Key=e[a].Unit.toString()),i.Type=e[a].ProductTypeID.toString(),i.UOMConversion=e[a].Conversion.toString(),i.Quantity=e[a].Quantity.toString(),i.UOMConvertedQty=n.e.IsNum(e[a].Conversion)?parseFloat(i.UOMConversion)*parseFloat(i.Quantity):"1",i.SchemeID="2",i.MaxSchemeID=s,i.IsScheme="Y",this.ScreenObject.GridData.length>t?this.ScreenObject.GridDataObj.insertRowAt(i,t):this.ScreenObject.GridDataObj.addRow(i)}this.ScreenObject.UpdateSequence()}CalcOpRate(){if(30==this.ScreenObject.DocumentType&&this.ScreenObject.Preferences.ContainsKey("AssembleCalcOPRate")&&Object(o.j)(this.ScreenObject.Preferences.AssembleCalcOPRate)&&this.ScreenObject.GridDataColumns.Contains("IsKit")){let e=this.ScreenObject.GridData.filter(e=>2==e.IsKit),t=0;e.forEach(e=>{n.e.IsEmpty(e.DefaultQuantity)||n.e.IsEmpty(e.Rate)||(t+=parseFloat(e.DefaultQuantity)*parseFloat(e.Rate))}),e=this.ScreenObject.GridData.filter(e=>1==e.IsKit),e.length>0&&(e[0].Rate=t,this.CalculateTotals(e[0],!1))}}OnKitProductChange(e){if(e instanceof m.b){if(this.ScreenObject.GridDataColumns.Contains("IsKit")&&this.ScreenObject.GridData.filter(e=>1==e.IsKit||2==e.IsKit).forEach(e=>{this.ScreenObject.GridDataObj.removeRow(e)}),e.SelectedValue>0){let t=!0,s=!1,i=0,a=this.ScreenObject._TextFields.find(e=>e.DBColumnID.toString()==this.ScreenObject.Preferences.AssembleType);a&&a instanceof D.e&&!n.e.IsEmpty(a.SelectedValue)&&"DisAssemble"==a.SelectedValue&&(t=!1),a=this.ScreenObject._TextFields.find(e=>e.DBColumnID.toString()==this.ScreenObject.Preferences.AssembleQty),i=a&&a instanceof u.d&&!n.e.IsEmpty(a.Text)&&n.e.IsNum(a.Text)?parseFloat(a.Text):1,this.ScreenObject.GridDataColumns.Contains("IsKit")||this.ScreenObject.GridDataColumns.push("IsKit");let r=this.ScreenObject.GetProductBundle(e.SelectedValue);null!=r&&r.Tables.length>0&&r.Tables[0].length>0&&r.Columns[0].Contains("KitSize")&&!n.e.IsEmpty(r.Tables[0][0].KitSize)&&(i=parseFloat(r.Tables[0][0].KitSize),s=!0,a&&a instanceof u.d&&(a.Text=i.toString()));let o=0;for(let e=0;e<this.ScreenObject.GridData.length;e++)if(n.e.IsEmpty(this.ScreenObject.GridData[e].ProductID_Key)){o=e;break}let l=this.ScreenObject.GridDataObj.NewRow();this.ScreenObject.GridData.InsertAt(l,o),l.ProductID_Key=e.SelectedValue,l.IsKit=1,l.Quantity=i,this.AddProductData(l,!1,!0),l.VoucherType=t?1:-1;let c=1;n.e.IsNum(l.UOMConversion)&&(c=parseFloat(l.UOMConversion)),l.UOMConvertedQty=c*parseFloat(l.Quantity),this.CalculateTotals(l,!1),o++;for(let e=0;e<r.Tables[0].length;e++)l=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridData.InsertAt(l,o+e),l.ProductID_Key=r.Tables[0][e].ProductID,l.LineNarration=r.Tables[0][e].Remarks,n.e.IsEmpty(r.Tables[0][e].Quantity)?s?(l.Quantity=1,l.DefaultQuantity=1/i):(l.Quantity=i,l.DefaultQuantity=1):s?(l.Quantity=r.Tables[0][e].Quantity.toString(),l.DefaultQuantity=parseFloat(r.Tables[0][e].Quantity)/i):(l.Quantity=i*parseFloat(r.Tables[0][e].Quantity),l.DefaultQuantity=r.Tables[0][e].Quantity.toString()),r.Columns[0].Contains("unit")&&!n.e.IsEmpty(r.Tables[0][e].unit)&&(l.Unit_Key=r.Tables[0][e].unit.toString(),l.Unit=r.Tables[0][e].UnitName.toString()),l.LineNarration=r.Tables[0][e].Remarks,this.AddProductData(l,!1,!0),n.e.IsNum(l.UOMConversion)&&(c=parseFloat(l.UOMConversion)),l.UOMConvertedQty=c*parseFloat(l.Quantity),l.VoucherType=t?-1:1,l.IsKit=2,this.CalculateTotals(l,!1);this.ScreenObject.UpdateSequence(),this.RefreshGrid=!this.RefreshGrid}e instanceof b.c&&!n.e.IsEmpty(e.KeyTip)&&"lostfocus"==e.KeyTip.toLowerCase()&&this.ValidateData(e,!0)&&this.ScreenObject.GetExternalFuncData(e.Mode,e.ToolTipFooterTitle,e.ToolTipFooterDescription,e.ToolTipDescription,null)}}onTypeChange(e){if(null==this.ScreenObject)return;let t=!0,s=this.ScreenObject._TextFields.find(e=>e.DBColumnID.toString()==this.ScreenObject.Preferences.AssembleType);if(s&&s instanceof D.e&&!n.e.IsEmpty(s.SelectedValue)&&"DisAssemble"==s.SelectedValue&&(t=!1),this.ScreenObject.GridDataColumns.Contains("IsKit")){let e=this.ScreenObject.GridData.filter(e=>1==e.IsKit);e.length>0&&(e[0].VoucherType=t?1:-1,e=this.ScreenObject.GridData.filter(e=>2==e.IsKit),e.forEach(e=>{e.VoucherType=t?-1:1}))}}LoadGradeData(e,t,s){let i,r="";if(0==e||2==e){if(i=[],this.dtData=null,null==this.ScreenObject)return;if(this.DocID>0)return;if(n.e.IsEmpty(s))return;Logger.InfoLog("AssignLeavesViewModel::Start Loading Grade data"),a.a.SessionManager.Preferences.ContainsKey("AssignLeavesFilter")&&"True"==a.a.SessionManager.Preferences.AssignLeavesFilter.toString()&&(r=this.PopupEmployeesFilter(s+"~"+t,"LoadGradeData")),this.LoadGradeDataTemp(r,s+"~"+t)}else if(1==e){if(n.e.IsEmpty(s))return;let e=[],t=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase());t&&t instanceof D.e&&(t.IsReadOnly=!0),t=this.ScreenObject._CCFields.find(e=>"dcccnid2"==e.DBColumnName.toLowerCase()),t&&t instanceof m.b&&(t.Enable=!1);let i=this.ScreenObject.ColumnSource.find(e=>50051==e.CostCenterID),a=this.ScreenObject.ColumnSource.find(e=>50053==e.CostCenterID);i&&i instanceof y.a&&("EmployeeWise"==s?(i.IsVisible=!0,a.IsVisible=!1):(a.IsVisible=!0,i.IsVisible=!1)),e=this.ScreenObject.GridData,null!=this.dtData&&this.dtData.length>0&&e.AddRange(this.dtData),"GradeWise"==s?(e=this.ScreenObject.GridData.filter(e=>1!=e.dcCCNID51_Key),this.dtData=e.Copy(),e=this.ScreenObject.GridData.filter(e=>1==e.dcCCNID51_Key),e=e.Copy()):"EmployeeWise"==s&&(e=this.ScreenObject.GridData.filter(e=>1==e.dcCCNID51_Key),this.dtData=e.Copy(),e=this.ScreenObject.GridData.filter(e=>1!=e.dcCCNID51_Key),e=e.Copy()),e.length>0&&(this.ScreenObject.GridDataObj.Clear(),this.ScreenObject.GridDataObj.ClearFilters(),this.ScreenObject.GridDataObj.addRows(e)),this.ScreenObject.UpdateSequence(),this.RefreshGrid=!0}this.ScreenObject.GridDataObj.RefreshColumns()}LoadLeaveyearDates(e){let t=new Date(e,parseInt(a.a.SessionManager.Preferences.LeaveYear),1),s=this.ScreenObject._TextFields.find(e=>"dcalpha3"==e.DBColumnName.toLowerCase());s&&s instanceof d.c&&(s.Date=new Date(t.ToString("dd/MMM/yyyy"))),t=t.AddMonths(12),t=t.AddDays(-t.getDate()),s=this.ScreenObject._TextFields.find(e=>"dcalpha4"==e.DBColumnName.toLowerCase()),s&&s instanceof d.c&&(s.Date=new Date(t.ToString("dd/MMM/yyyy")))}OnChequeBookSelection(e){if(!n.e.IsEmpty(this.ChequeBook.SelectedValue)&&null!=this.ScreenObject){if(this.ScreenObject.Preferences.ContainsKey("AutoChequeonPost")&&"True"==this.ScreenObject.Preferences.AutoChequeonPost)return;let e=0;null!=this.ScreenObject.CreditAccount&&(e=this.ScreenObject.CreditAccount.SelectedValue),this.ScreenObject.HeaderFields.forEach(t=>{t instanceof u.d&&"ChequeNumber"==t.DBColumnName&&0==this.ScreenObject.ChequeBookChecking&&(t.Text=a.a.document.GetChequeNumbers(e,this.ChequeBook.SelectedValue))})}}OnSearchDocument(e){if((null==this.ScreenObject.Link.LinkCombo.SelectedItem||null==this.ScreenObject.Link.LinkCombo.SelectedItem)&&n.e.Int(this.ScreenObject.Link.LinkCombo.SelectedValue)>0&&(this.ScreenObject.Link.LinkCombo.SelectedItem=this.ScreenObject.Link.LinkCombo.Items.find(e=>e.Value==this.ScreenObject.Link.LinkCombo.SelectedValue)),null!=this.ScreenObject.Link.LinkCombo.SelectedItem&&null!=this.ScreenObject.Link.LinkCombo.SelectedItem){let t="",s="",i="",r="";a.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==a.a.SessionManager.Preferences.EnableLocationWise.toString()&&a.a.SessionManager.Preferences.ContainsKey("LocationWiseLinking")&&"True"==a.a.SessionManager.Preferences.LocationWiseLinking.toString()&&(this.ScreenObject.LocationID>0?s=this.ScreenObject.LocationID.toString():a.a.SessionManager.LocationID>0&&(s=a.a.SessionManager.LocationID.toString())),a.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==a.a.SessionManager.Preferences.EnableDivisionWise.toString()&&a.a.SessionManager.Preferences.ContainsKey("DivisionWiseLinking")&&"True"==a.a.SessionManager.Preferences.DivisionWiseLinking.toString()&&(this.ScreenObject.DivisionID>0?i=this.ScreenObject.DivisionID.toString():a.a.SessionManager.DivisionID>0&&(i=a.a.SessionManager.DivisionID.toString())),this.ScreenObject.DueDate&&this.ScreenObject.DueDate.Date&&(t=this.ScreenObject.DueDate.Date.ToString("dd/MMM/yyyy")),this.ScreenObject.Preferences.ContainsKey("DimensionWise")&&""!=this.ScreenObject.Preferences.DimensionWise&&this.ScreenObject.Preferences.DimensionWise.split(",").forEach(e=>{if(""!=e){let t=parseInt(e);for(let e=0;e<this.ScreenObject._CCFields.length;e++){let s=this.ScreenObject._CCFields[e];if(s instanceof m.b&&s.CCID==t){r+=s.SelectedValue>0?" and DCM.dcCCNID"+(t-5e4).toString()+"="+s.SelectedValue.toString():" and DCM.dcCCNID"+(t-5e4).toString()+"=0";break}}}});let l,c=this.ScreenObject.Data.Tables[6].filter(e=>e.DocumentLinkDefID==this.ScreenObject.Link.LinkCombo.SelectedValue);l=c.length>0&&this.ScreenObject.Data.Columns[6].Contains("syscolumnname")&&c[0].syscolumnname.toString().toLowerCase().Contains("dcnum")?" d.":" a.";let h=0;c.length>0&&this.ScreenObject.Data.Columns[6].Contains("DocumentType")&&!n.e.IsEmpty(c[0].DocumentType)&&(h=parseInt(c[0].DocumentType.toString())),(6==this.ScreenObject.DocumentType||10==this.ScreenObject.DocumentType||39==this.ScreenObject.DocumentType)&&6!=h&&10!=h&&39!=h||(6==h||10==h||39==h)&&6!=this.ScreenObject.DocumentType&&10!=this.ScreenObject.DocumentType&&39!=this.ScreenObject.DocumentType?(this.ScreenObject.Preferences.ContainsKey("Debit Account")&&Object(o.j)(this.ScreenObject.Preferences["Debit Account"])&&null!=this.ScreenObject.DebitAccount&&(r+=this.ScreenObject.DebitAccount.SelectedValue>0?" and "+l+"CreditAccount="+this.ScreenObject.DebitAccount.SelectedValue.toString():" and "+l+"CreditAccount=0"),this.ScreenObject.Preferences.ContainsKey("Credit Account")&&Object(o.j)(this.ScreenObject.Preferences["Credit Account"])&&null!=this.ScreenObject.CreditAccount&&(r+=this.ScreenObject.CreditAccount.SelectedValue>0?" and "+l+"DebitAccount="+this.ScreenObject.CreditAccount.SelectedValue.toString():" and "+l+"DebitAccount=0")):(this.ScreenObject.Preferences.ContainsKey("Debit Account")&&Object(o.j)(this.ScreenObject.Preferences["Debit Account"])&&null!=this.ScreenObject.DebitAccount&&(r+=this.ScreenObject.DebitAccount.SelectedValue>0?" and "+l+"DebitAccount="+this.ScreenObject.DebitAccount.SelectedValue.toString():" and "+l+"DebitAccount=0"),this.ScreenObject.Preferences.ContainsKey("Credit Account")&&Object(o.j)(this.ScreenObject.Preferences["Credit Account"])&&null!=this.ScreenObject.CreditAccount&&(r+=this.ScreenObject.CreditAccount.SelectedValue>0?" and "+l+"CreditAccount="+this.ScreenObject.CreditAccount.SelectedValue.toString():" and "+l+"CreditAccount=0")),this.ScreenObject.Preferences.ContainsKey("LinkVendorProducts")&&Object(o.j)(this.ScreenObject.Preferences.LinkVendorProducts)&&(this.ScreenObject.IsPurchase&&null!=this.ScreenObject.CreditAccount?r+=" join INV_ProductVendors PV WITH(NOLOCK) ON p.ProductID=pv.ProductID and pv.AccountID="+this.ScreenObject.CreditAccount.SelectedValue:this.ScreenObject.IsPurchase||null==this.ScreenObject.DebitAccount||(r+=" join INV_ProductVendors PV WITH(NOLOCK) ON p.ProductID=pv.ProductID and pv.AccountID="+this.ScreenObject.DebitAccount.SelectedValue));let u="";if(null!=this.ScreenObject.Link.DocumentList&&this.ScreenObject.Link.DocumentList.Items.forEach(e=>{e.IsChecked&&(u+=e.Value+",")}),"Link"==e.toString()){let e=new Dt.a;e.SearchDocumentViewModel_1(this,this.ScreenObject.Link.LinkCombo.SelectedItem.Value,this.ScreenObject.Link.LinkCombo.SelectedItem.Parent,this.DocumentDate,t,s,i,r,u,!0),a.a.page.ShowDialog(e,dt.a,{HideHeader:!0})}else{let e=new Dt.a;e.SearchDocumentViewModel_1(this,this.ScreenObject.Link.LinkCombo.SelectedItem.Value,this.ScreenObject.Link.LinkCombo.SelectedItem.Parent,this.DocumentDate,t,s,i,r,u,!1),a.a.page.ShowDialog(e,dt.a,{HideHeader:!0})}}}GetWorkFlow(e,t){if(e){if(this.ScreenObject.Data.Tables.length<=1||this.ScreenObject.Data.Tables.length>1&&this.ScreenObject.Data.Tables[1].length<1)return 0}else if(this.ScreenObject.Data.Tables.length<=9||this.ScreenObject.Data.Tables.length>9&&this.ScreenObject.Data.Tables[9].length<1)return 0;if(this.ScheduleID>0&&!this.ScreenObject.IsPostRecurDocumentWithApproval(this.RecurDocumentVoucherNo))return 0;if(null!=this.commandprarameter&&("NoWorkFlow"==this.commandprarameter||"NoWorkFlowReSave"==this.commandprarameter||"NoWorkFlowprint"==this.commandprarameter))return 0;if(this.ScreenObject.Preferences.ContainsKey("NoWorkflowPostedDocs")&&""!=this.ScreenObject.Preferences.NoWorkflowPostedDocs&&Object(o.j)(this.ScreenObject.Preferences.NoWorkflowPostedDocs)&&!this.LineWiseApproval&&369==this.StatusID)return 0;let s=this.WorkFlowDocLevel;if(this.LineWiseApproval||369!=this.StatusID&&370!=this.StatusID||(s=0),null!=t&&(s=0,n.e.IsEmpty(t.WorkFlowLevel)||"369"==t.StatusID.toString()||(s=parseInt(t.WorkFlowLevel)),this.FillDictionary(t,!1)),this.FooterDics.keys.forEach(e=>{let t=e,s=this.ScreenObject.ColumnSource.find(e=>e.lbl==this.FooterDics[t].getFieldName());if(s)if("FLOAT"!=s.DataType)this.FooterDics[t].setFieldValue(this.fldDict[t].getFieldResult());else{let e=0;for(let t=0;t<this.ScreenObject.GridData.length;t++){let i=1;a.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(o.j)(a.a.SessionManager.Preferences["Use Foreign Currency"])&&(null==this.Currency||n.e.IsEmpty(this.Currency.ExchangeRate.Text)?this.ScreenObject.GridDataColumns.Contains("ExchangeRate")&&!n.e.IsEmpty(this.ScreenObject.GridData[t].ExchangeRate)&&(i=parseFloat(this.ScreenObject.GridData[t].ExchangeRate)):i=parseFloat(this.Currency.ExchangeRate.Text)),s.DisplayMember.toLowerCase().Contains("dcnum")&&("-2"==s.DefaultValue&&(i=this.ScreenObject.GridDataColumns.Contains(s.DisplayMember.toLowerCase().replace("dcnum","dcExchRT"))&&!n.e.IsEmpty(this.ScreenObject.GridData[t][s.DisplayMember.toLowerCase().replace("dcnum","dcExchRT")])?parseFloat(this.ScreenObject.GridData[t][s.DisplayMember.toLowerCase().replace("dcnum","dcExchRT")]):1),n.e.Int(s.DefaultValue)>0&&(i=s.CurrID>0?s.ExhcgRt:1)),"Quantity"==s.DisplayMember?n.e.IsEmpty(this.ScreenObject.GridData[t].UOMConvertedQty)||(e+=parseFloat(this.ScreenObject.GridData[t].UOMConvertedQty)):s.IsColumnUserDefined||"FLOAT"!=s.DataType?s.DisplayMember.Contains("dcNum")&&(n.e.IsEmpty(this.ScreenObject.GridData[t]["dcCalc"+s.DisplayMember])||(e+=parseFloat(this.ScreenObject.GridData[t]["dcCalc"+s.DisplayMember])*i)):n.e.IsEmpty(this.ScreenObject.GridData[t][s.DisplayMember])||(e+=parseFloat(this.ScreenObject.GridData[t][s.DisplayMember])*i)}this.FooterDics[t].setFieldValue(e)}else this.FooterDics[t].setFieldValue(0)}),this.ScreenObject._TextFields.forEach(e=>{this.FooterDics.ContainsKey(e.Lbl)&&(e instanceof u.d?"FLOAT"==e.DataType?null!=e.Text&&""!=e.Text&&""==e.ValidateData()?this.FooterDics[e.Lbl].setFieldValue(e.Text):this.FooterDics[e.Lbl].setFieldValue(0):this.FooterDics[e.Lbl].setFieldValue(e.Text):e instanceof D.e?this.FooterDics[e.Lbl].setFieldValue(e.SelectedValue):e instanceof g.a?this.FooterDics[e.Lbl].setFieldValue(e.Text):e instanceof m.b?e.SelectedValue>0&&!n.e.IsEmpty(e.Text)?this.FooterDics[e.Lbl].setFieldValue(e.Text):this.FooterDics[e.Lbl].setFieldValue(""):e instanceof C.a&&(e.SelectedValue>0?e.Code.Visible&&!n.e.IsEmpty(e.Code.Text)?this.FooterDics[e.Lbl].setFieldValue(e.Code.Text):e.Name.Visible&&!n.e.IsEmpty(e.Name.Text)&&this.FooterDics[e.Lbl].setFieldValue(e.Name.Text):this.FooterDics[e.Lbl].setFieldValue("")))}),this.ScreenObject._CCFields.forEach(e=>{this.FooterDics.ContainsKey(e.Lbl)&&(e instanceof m.b&&e.SelectedValue>0&&!n.e.IsEmpty(e.Text)?this.FooterDics[e.Lbl].setFieldValue(e.Text):this.FooterDics[e.Lbl].setFieldValue(""))}),this.ScreenObject.HeaderFields.forEach(e=>{e instanceof b.c&&!n.e.IsEmpty(e.Lbl)&&this.FooterDics.ContainsKey(e.Lbl)&&(e instanceof u.d?"FLOAT"!=e.DataType||!n.e.IsEmpty(e.Text)&&""==e.ValidateData()?this.FooterDics[e.Lbl].setFieldValue(e.Text):this.FooterDics[e.Lbl].setFieldValue(0):e instanceof D.e?this.FooterDics[e.Lbl].setFieldValue(e.SelectedValue):e instanceof g.a?this.FooterDics[e.Lbl].setFieldValue(e.Text):e instanceof d.c&&e.Date?this.FooterDics[e.Lbl].setFieldValue(e.Date):e instanceof m.b&&(e.SelectedValue>0&&!n.e.IsEmpty(e.Text)?this.FooterDics[e.Lbl].setFieldValue(e.Text):this.FooterDics[e.Lbl].setFieldValue("")))}),this.IsInventoryVoucher){let e=this.ScreenObject.ColumnSource.find(e=>"Rate"==e.DisplayMember);e&&!n.e.IsEmpty(e.footer)?this.FooterDics.RATE.setFieldValue(e.footer):this.FooterDics.RATE.setFieldValue(0),e=this.ScreenObject.ColumnSource.find(e=>"Quantity"==e.DisplayMember),e&&!n.e.IsEmpty(e.footer)?this.FooterDics.QTY.setFieldValue(e.footer):this.FooterDics.QTY.setFieldValue(0),e=this.ScreenObject.ColumnSource.find(e=>"Gross"==e.DisplayMember),e&&!n.e.IsEmpty(e.footer)?this.FooterDics.GROSS.setFieldValue(e.footer):this.FooterDics.GROSS.setFieldValue(0),this.FooterDics.NET.setFieldValue(this.NetAmount)}let i,r=null,l=null;i=e?this.ScreenObject.Data.Tables[1]:this.ScreenObject.Data.Tables[9],l=i.filter(this.ScreenObject.IsDocEdit?e=>2==e.Action||6==e.Action:e=>1==e.Action||6==e.Action),l.sort((e,t)=>e.LevelID-t.LevelID);let c=!1;for(let u=0;u<l.length;u++)if(!(s>0&&!n.e.IsEmpty(l[u].LevelID)&&parseInt(l[u].LevelID)<s)&&(!(!this.LineWiseApproval&&s>0&&this.WfID>0)||n.e.IsEmpty(l[u].WorkFlowID)||parseInt(l[u].WorkFlowID)==this.WfID)&&(null==t||!this.ScreenObject.GridDataColumns.Contains("WorkFlowID")||n.e.IsEmpty(t.WorkFlowID)||"0"==t.WorkFlowID.toString()||t.WorkFlowID.toString()==l[u].WorkFlowID.toString())){if(n.e.IsNullOrWhiteSpace(l[u].Expression))return parseInt(l[u].WorkFlowID);if(c=!n.e.IsNullOrWhiteSpace(l[u].IsExpressionLineWise)&&Object(o.j)(l[u].IsExpressionLineWise),null!=l[u].Expression&&""!=l[u].Expression.toString()&&l[u].Expression.toString().Contains("ServerDate")){let e=a.a.common.GetDataTable("DOC068","");null!=this.FooterDics.ServerDate&&this.FooterDics.ServerDate.setFieldValue(new Date(e[0].ServerDate).Date()),null!=this.fldDict.ServerDate&&this.fldDict.ServerDate.setFieldValue(new Date(e[0].ServerDate).Date())}if(null!=l[u].Expression&&""!=l[u].Expression.toString()&&l[u].Expression.toString().Contains("DOCDATE")&&(null!=this.FooterDics.DOCDATE&&this.FooterDics.DOCDATE.setFieldValue(this.DocumentDate.Date()),null!=this.fldDict.DOCDATE&&this.fldDict.DOCDATE.setFieldValue(this.DocumentDate.Date())),c){if(null==t){let e=this.GetPrimaryColName();for(let t=0;t<this.ScreenObject.GridData.length;t++)if(!n.e.IsEmpty(this.ScreenObject.GridData[t][e])){this.FillDictionary(this.ScreenObject.GridData[t],!1),r=this.fldDict;let e=a.a.eval.EvaluateExpression(l[u].Expression.toString(),r);if(null!=e&&"1"==e.toString())return parseInt(l[u].WorkFlowID)}return 0}r=this.fldDict}else r=this.FooterDics;try{let e=a.a.eval.EvaluateExpression(l[u].Expression.toString(),r);if(null!=e&&"1"==e.toString())return parseInt(l[u].WorkFlowID)}catch(h){}}if(null!=t&&(a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Posted Docs")||a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Approved Docs")))for(let u=0;u<l.length;u++){if(""==l[u].Expression.toString().trim())return parseInt(l[u].WorkFlowID);if(c=""!=l[u].IsExpressionLineWise.toString().trim()&&Object(o.j)(l[u].IsExpressionLineWise),null!=l[u].Expression&&""!=l[u].Expression.toString()&&l[u].Expression.toString().Contains("ServerDate")){let e=a.a.common.GetDataTable("DOC068","");null!=this.FooterDics.ServerDate&&this.FooterDics.ServerDate.setFieldValue(new Date(e[0].ServerDate).Date),null!=this.fldDict.ServerDate&&this.fldDict.ServerDate.setFieldValue(new Date(e[0].ServerDate).Date)}if(null!=l[u].Expression&&""!=l[u].Expression.toString()&&l[u].Expression.toString().Contains("DOCDATE")&&(null!=this.FooterDics.DOCDATE&&this.FooterDics.DOCDATE.setFieldValue(this.DocumentDate.Date),null!=this.fldDict.DOCDATE&&this.fldDict.DOCDATE.setFieldValue(this.DocumentDate.Date)),c){if(null==t){let e=this.GetPrimaryColName();for(let t=0;t<this.ScreenObject.GridData.length;t++)if(!n.e.IsEmpty(this.ScreenObject.GridData[t][e])){this.FillDictionary(this.ScreenObject.GridData[t],!1),r=this.fldDict;let e=a.a.eval.EvaluateExpression(l[u].Expression.toString(),r);if(null!=e&&"1"==e.toString())return parseInt(l[u].WorkFlowID)}return 0}r=this.fldDict}else r=this.FooterDics;try{let e=a.a.eval.EvaluateExpression(l[u].Expression.toString(),r);if(null!=e&&"1"==e.toString())return parseInt(l[u].WorkFlowID)}catch(h){}}return 0}GetRowValue(e,t,s){this.ScreenObject.Preferences.ContainsKey("PosPaymentTypeFld")&&this.ScreenObject.Preferences.PosPaymentTypeFld==this.ScreenObject.ColumnSource[s].ID?e.sbText+=this.ScreenObject.ColumnSource[s].DisplayMember+"=N'"+n.e.String(this.ScreenObject.GridData[t].FieldType)+"', ":"SELECTIONBOX"==this.ScreenObject.ColumnSource[s].DataType&&null!=this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[s].DisplayMember]?e.sbText+=this.savebulk?this.ScreenObject.ColumnSource[s].DisplayMember+'="'+u.d.GetValidXml(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[s].DisplayMember])+'" ':this.ScreenObject.ColumnSource[s].DisplayMember+"=N'"+u.d.GetValidTextXml(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[s].DisplayMember])+"', ":"DATE"!=this.ScreenObject.ColumnSource[s].DataType||n.e.IsEmpty(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[s].DisplayMember+"_Key"])?"DATETIME"!=this.ScreenObject.ColumnSource[s].DataType&&"TIME"!=this.ScreenObject.ColumnSource[s].DataType||""==n.e.String(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[s].DisplayMember+"_Key"])?"Time2"==this.ScreenObject.ColumnSource[s].DataType&&""!=n.e.String(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[s].DisplayMember+"_Key"])?e.sbText+=this.ScreenObject.ColumnSource[s].DisplayMember+"=N'"+new Date(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[s].DisplayMember+"_Key"]).ToString("dd/MMM/yyyy HH:mm")+"', ":"ComboBox"==this.ScreenObject.ColumnSource[s].DataType?e.sbText+=this.savebulk?this.ScreenObject.ColumnSource[s].ValueBinding+'="'+u.d.GetValidXml(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[s].ValueBinding])+'" ':this.ScreenObject.ColumnSource[s].ValueBinding+"=N'"+u.d.GetValidTextXml(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[s].ValueBinding])+"', ":"PactComboBox"==this.ScreenObject.ColumnSource[s].DataType?e.sbText+=68==this.DocumentType||70==this.DocumentType||80==this.DocumentType?this.ScreenObject.ColumnSource[s].ValueBinding+"=N'"+u.d.GetValidTextXml(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[s].ValueBinding])+"', ":this.savebulk?this.ScreenObject.ColumnSource[s].ValueBinding+'="'+u.d.GetValidXml(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[s].ValueBinding+"_Key"])+'" ':this.ScreenObject.ColumnSource[s].ValueBinding+"=N'"+u.d.GetValidTextXml(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[s].ValueBinding+"_Key"])+"', ":"LISTBOX"==this.ScreenObject.ColumnSource[s].DataType&&0!=this.ScreenObject.ColumnSource[s].CostCenterID&&this.ScreenObject.ColumnSource[s].DisplayMember.toLowerCase().Contains("alpha")?e.sbText+=this.savebulk?this.ScreenObject.ColumnSource[s].DisplayMember+'="'+n.e.String(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[s].ValueMember])+'" ':this.ScreenObject.ColumnSource[s].DisplayMember+"=N'"+n.e.String(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[s].ValueMember])+"', ":"CheckBox"==this.ColumnSource[s].DataType?"True"==n.e.String(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[s].DisplayMember])?e.sbText+=this.ScreenObject.ColumnSource[s].DisplayMember+"=N'True',":e.sbText+=this.ScreenObject.ColumnSource[s].DisplayMember+"=N'False',":"textblock"==this.ScreenObject.ColumnSource[s].DataType.toLowerCase()||"text"==this.ScreenObject.ColumnSource[s].DataType.toLowerCase()||"float"==this.ScreenObject.ColumnSource[s].DataType.toLowerCase()||"int"==this.ScreenObject.ColumnSource[s].DataType.toLowerCase()||n.e.IsEmpty(this.ScreenObject.ColumnSource[s].DataType)?e.sbText+=this.savebulk?this.ScreenObject.ColumnSource[s].DisplayMember+'="'+u.d.GetValidXml(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[s].DisplayMember])+'" ':89!=this.ScreenObject.DocumentType&&90!=this.ScreenObject.DocumentType||!(this.isCheckIn&&"dcAlpha9"==this.ScreenObject.ColumnSource[s].DisplayMember||this.isCheckOut&&"dcAlpha19"==this.ScreenObject.ColumnSource[s].DisplayMember)?this.ScreenObject.ColumnSource[s].DisplayMember+"=N'"+u.d.GetValidTextXml(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[s].DisplayMember])+"', ":this.ScreenObject.ColumnSource[s].DisplayMember+"=N'WEBIP',":this.savebulk||(e.sbText+=this.ScreenObject.ColumnSource[s].DisplayMember+"=NULL,"):e.sbText+=this.savebulk?this.ScreenObject.ColumnSource[s].DisplayMember+'="'+new Date(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[s].DisplayMember+"_Key"]).ToString("dd/MMM/yyyy hh:mm:ss a")+'" ':this.ScreenObject.ColumnSource[s].DisplayMember+"=N'"+new Date(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[s].DisplayMember+"_Key"]).ToString("dd/MMM/yyyy hh:mm:ss a")+"', ":55==this.DocumentType&&"dcalpha1"==this.ScreenObject.ColumnSource[s].DisplayMember.toLowerCase()||56==this.DocumentType&&"dcalpha5"==this.ScreenObject.ColumnSource[s].DisplayMember.toLowerCase()?e.sbText+=this.ScreenObject.ColumnSource[s].DisplayMember+"=N'"+new Date(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[s].DisplayMember+"_Key"]).ToString("01/MMM/yyyy")+"', ":e.sbText+=this.savebulk?this.ScreenObject.ColumnSource[s].DisplayMember+'="'+new Date(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[s].DisplayMember+"_Key"]).ToString("dd/MMM/yyyy")+'" ':this.ScreenObject.ColumnSource[s].DisplayMember+"=N'"+new Date(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[s].DisplayMember+"_Key"]).ToString("dd/MMM/yyyy")+"', "}DistributeInstallments(e){try{let t=0,s=0,i=1,r=0,o=1,l=0,c=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase());if(c&&c instanceof u.d&&!n.e.IsEmpty(c.Text)&&""==c.ValidateData()&&(t=parseFloat(c.Text)),0==t&&(c=this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase()),c&&c instanceof u.d&&!n.e.IsEmpty(c.Text)&&""==c.ValidateData()&&(t=parseFloat(c.Text))),t>0){c=this.ScreenObject._TextFields.find(e=>"dcalpha3"==e.DBColumnName.toLowerCase()),c&&c instanceof u.d&&!n.e.IsEmpty(c.Text)&&""==c.ValidateData()&&parseFloat(c.Text)>0?(s=parseFloat(c.Text),i=parseInt(t/s),o=parseFloat(t/s),o>i&&o-i>.01&&i++,c=this.ScreenObject._TextFields.find(e=>"dcalpha4"==e.DBColumnName.toLowerCase()),c.Text=i.toString()):(c=this.ScreenObject._TextFields.find(e=>"dcalpha4"==e.DBColumnName.toLowerCase()),c&&c instanceof u.d&&!n.e.IsEmpty(c.Text)&&""==c.ValidateData()&&parseInt(c.Text)>0&&(i=parseInt(c.Text),s=parseFloat(t/i),c=this.ScreenObject._TextFields.find(e=>"dcalpha3"==e.DBColumnName.toLowerCase()),c.Text=s.toString())),0==s&&(s=t);let h=this.ScreenObject.ColumnSource.find(e=>null!=e.DisplayMember&&"dcnum2"==e.DisplayMember.toLowerCase());if(h){let e=n.e.Int(h.DecimalPoints);s=parseFloat(s.ToString("N"+e))}c=this.ScreenObject._TextFields.find(e=>"dcalpha3"==e.DBColumnName.toLowerCase()),c&&c instanceof u.d&&(c.Text=s.toString()),c=this.ScreenObject._TextFields.find(e=>"dcalpha4"==e.DBColumnName.toLowerCase()),c&&c instanceof u.d&&(c.Text=i.toString());let D=null,S=new Date,m=this.ScreenObject.ColumnSource.find(e=>null!=e.ValueMember&&"productid_key"==e.ValueMember.toLowerCase());if(m&&m.DefaultValueText&&n.e.IsNum(m.DefaultValue)&&(D=m.DefaultValueText.split("\x11")),s>t)return void(this.DisplayMessage="Installment amount should be less than or equal to approved amount");if(c=this.ScreenObject._TextFields.find(e=>"dcalpha5"==e.DBColumnName.toLowerCase()),c instanceof d.c){if(!c.Date)return void(this.DisplayMessage=a.a.GetResource("Select")+" "+c.Label);""==e?(S=new Date(parseInt(c.Date.ToString("yyyy")),parseInt(c.Date.ToString("MM"))-1,1),c.Date=S):S=c.Date}else S=this.DocumentDate;let b="";this.IsInventoryVoucher&&(b="ProductID_Key");let C="",p="",y="",g=this.ScreenObject.GridData.filter(e=>!n.e.IsEmpty(e.ProductName));g.length>0&&g.forEach(e=>{""!=C||n.e.IsEmpty(e.LinkedInvDocDetailsID)||(C=e.LinkedInvDocDetailsID.toString(),n.e.IsEmpty(e.LinkedFieldName)||(p=e.LinkedFieldName.toString()),n.e.IsEmpty(e.RefNo)||(y=e.RefNo.toString())),this.ScreenObject.GridDataObj.removeRow(e)});for(let e=10;e<=i;e++){let e=this.ScreenObject.GridDataObj.NewRow();e.DocSeqNo=this.ScreenObject.GridData.length+1,e.DocDetailsID=0,this.ScreenObject.GridDataObj.addRow(e)}for(let n=0;n<i;n++){let o=this.GetEmptyRowPosition(this.ScreenObject.GridDataObj,b);m&&null!=D&&D.length>0&&(this.ScreenObject.GridData[o].ProductID_Key=m.DefaultValue,this.ScreenObject.GridDataColumns.Contains("ProductCode")&&D.length>1&&(this.ScreenObject.GridData[o].ProductCode=D[1]),this.ScreenObject.GridDataColumns.Contains("ProductName")&&D.length>0&&(this.ScreenObject.GridData[o].ProductName=D[0])),""!=C&&(this.ScreenObject.GridData[o].LinkedInvDocDetailsID=C),""!=p&&(this.ScreenObject.GridData[o].LinkedFieldName=p),""!=y&&(this.ScreenObject.GridData[o].RefNo=y),this.ScreenObject.GridDataColumns.Contains("dcAlpha6_Key")&&(this.ScreenObject.GridData[o].dcAlpha6_Key=S,this.ScreenObject.GridData[o].dcAlpha6=S.ToString(a.a.SessionManager.Preferences["Date Format"])),this.ScreenObject.GridDataColumns.Contains("dcNum1")&&(this.ScreenObject.GridData[o].dcNum1=n+1),l=0,this.ScreenObject.GridDataColumns.Contains("dcNum2")&&(this.ScreenObject.GridData[o].dcNum2=n+1==i?t-r:s,l=parseFloat(this.ScreenObject.GridData[o].dcNum2)),this.ScreenObject.GridDataObj.updateRow(this.ScreenObject.GridData[o]),this.CalculateTotals(this.ScreenObject.GridData[o],!1),r+=l,""==e||"monthly"==e?S=S.AddMonths(1):"daily"==e?S=S.AddDays(1):"weekly"==e?S=S.AddDays(7):"quarterly"==e?S=S.AddMonths(3):"halfyearly"==e?S=S.AddMonths(6):"yearly"==e&&(S=S.AddYears(1))}}else this.DisplayMessage=c?c.Label+" should not be empty":"Loan amount should not be empty"}catch(t){Logger.ErrorLog("AddEditDocumentViewModel::"+t.stack,"DistributeInstallments",t)}}SaveInventoryDocument_1(e){if(this.IgnoreOnSave.Clear(),this.ButtonsEnabled&&(null==e||"Approve"==e.toString()||"ApproveandPrint"==e.toString()||"CheckoutSave"==e.toString()||"CheckoutPrint"==e.toString()||"NoWorkFlow"==e.toString()||"NoWorkFlowprint"==e.toString()||this.IsPOs&&"SaveonHold"==e.toString()||this.ButtonRevise.Visible&&"Revise"==e.toString()||this.ButtonSave.Visible&&this.ButtonSave.Enable))if(this.ScreenObject.Preferences.ContainsKey("NoWorkflowPostedDocs")&&""!=this.ScreenObject.Preferences.NoWorkflowPostedDocs&&Object(o.j)(this.ScreenObject.Preferences.NoWorkflowPostedDocs)&&369==this.StatusID&&"Save"==e.toString()&&!this.LineWiseApproval&&(e="NoWorkFlow"),0==this.ScreenObject.RefNodeID||86==this.ScreenObject.RefCCId||73==this.ScreenObject.RefCCId||89==this.ScreenObject.RefCCId||a.a.SessionManager.IsActionAssigned(43,"Edit Reference Documents"))if(this.ScreenObject.DocID>0&&this.IsUserLock)this.DisplayMessage="Document is Locked";else if(56!=this.ScreenObject.DocumentType||!this.LoanGuaranteeVisible||null!=this.dtLoanGuarantees&&0!=this.dtLoanGuarantees.length){if(this.ScreenObject.Preferences.ContainsKey("Linksingledoc")&&""!=this.ScreenObject.Preferences.Linksingledoc&&Object(o.j)(this.ScreenObject.Preferences.Linksingledoc)){let e=this.ScreenObject.GridData.filter(e=>e.LinkedInvDocDetailsID>0);if(e.sort((e,t)=>e.RefNo>t.RefNo?1:-1),e.length>0){let t=e[0].RefNo.toString();for(let s=0;s<e.length;s++)if(t!=e[s].RefNo)return void(this.DisplayMessage="Can link only one document")}}this.ButtonsEnabled=!1,this.SaveInventoryDocument(e,!0)||(this.ButtonsEnabled=!0)}else this.DisplayMessage="Loan Guarantee is Mandatory";else this.DisplayMessage=a.a.GetResource("RefDocument")}DistributeFooter(e,t=!1){let s=[];for(let i=0;i<this.ScreenObject.FooterGridData.length;i++){if(e&&!n.e.IsEmpty(this.ScreenObject.FooterGridData[i].ColumnName)&&!this.ValidateFooterDataonSave(this.ScreenObject.FooterGridData[i]))return!1;let t=0,a=this.ScreenObject.ColumnSource.find(e=>e.DisplayMember==this.ScreenObject.FooterGridData[i].ColumnName);if(t=n.e.Double(this.ScreenObject.FooterGridData[i].Amount),null!=a){s.push(a.DisplayMember),this.ScreenObject.FooterColumnSource.length>3&&this.ScreenObject.FooterColumnSource[3].IsVisible&&n.e.Int(this.ScreenObject.FooterGridData[i].DebitAccount)>0&&(a.DebitAccount=parseInt(this.ScreenObject.FooterGridData[i].DebitAccount)),this.ScreenObject.FooterColumnSource.length>4&&this.ScreenObject.FooterColumnSource[4].IsVisible&&n.e.Int(this.ScreenObject.FooterGridData[i].CreditAccount)>0&&(a.CreditAcount=parseInt(this.ScreenObject.FooterGridData[i].CreditAccount)),n.e.IsEmpty(this.ScreenObject.FooterGridData[i].Remarks)||(a.Remarks=this.ScreenObject.FooterGridData[i].Remarks.toString());for(let e=0;e<this.ScreenObject.GridData.length;e++)n.e.IsEmpty(this.ScreenObject.GridData[e].ProductID_Key)||(this.ScreenObject.GridData[e][a.DisplayMember]=t);t=n.e.Double(this.ScreenObject.FooterGridData[i].CalcAmount),this.DistributeValues("dcCalc"+a.DisplayMember,t,n.e.IsEmpty(a.DistributeColName)?"Gross":a.DistributeColName,!1)}}if(this.ScreenObject.FooterColumnSource[1].ReadOnly||this.ScreenObject.ColumnSource.filter(e=>4==e.SectionID).forEach(e=>{if(!s.Contains(e.DisplayMember))for(let t=0;t<this.ScreenObject.GridData.length;t++)n.e.IsEmpty(this.ScreenObject.GridData[t].ProductID_Key)||(this.ScreenObject.GridData[t][e.DisplayMember]=0,this.ScreenObject.GridData[t]["dcCalc"+e.DisplayMember]=0)}),t)for(let i=0;i<this.ScreenObject.GridData.length;i++)n.e.IsEmpty(this.ScreenObject.GridData[i].ProductID_Key)||this.CalculateTotals(this.ScreenObject.GridData[i],!1);return!0}AutoAdjustbatches(e,t){for(let r=0;r<this.ScreenObject.GridData.length;r++){if(""==n.e.String(this.ScreenObject.GridData[r].ProductID_Key))continue;let l=0;if(this.ScreenObject.Preferences.ContainsKey("ExcludeHold")&&!n.e.IsEmpty(this.ScreenObject.Preferences.ExcludeHold)&&Object(o.j)(this.ScreenObject.Preferences.ExcludeHold)&&this.ScreenObject.GridDataColumns.Contains("HoldQuantity")&&(l=!n.e.IsEmpty(this.ScreenObject.GridData[r].HoldQuantity)&&parseFloat(this.ScreenObject.GridData[r].HoldQuantity.toString())>0?parseFloat(this.ScreenObject.GridData[r].HoldQuantity.toString()):0),this.ScreenObject.Preferences.ContainsKey("ExcludeReserve")&&!n.e.IsEmpty(this.ScreenObject.Preferences.ExcludeReserve)&&Object(o.j)(this.ScreenObject.Preferences.ExcludeReserve)&&this.ScreenObject.GridDataColumns.Contains("ReserveQuantity")&&(l=!n.e.IsEmpty(this.ScreenObject.GridData[r].ReserveQuantity)&&parseFloat(this.ScreenObject.GridData[r].ReserveQuantity.toString())>0?parseFloat(this.ScreenObject.GridData[r].ReserveQuantity.toString()):0),32==this.DocumentType){let e="";var s=this.ScreenObject.ColumnSource.find(e=>e.ID==this.ScreenObject.Preferences.VarienceField);null!=s&&null!=s&&(e=s.DisplayMember),""!=e&&this.ScreenObject.GridDataColumns.Contains(e)&&!n.e.IsEmpty(this.ScreenObject.GridData[r][e])&&(l=parseFloat(n.e.String(this.ScreenObject.GridData[r][e]).Replace("-","")))}if("8"!=n.e.String(this.ScreenObject.GridData[r].Type)&&"3"!=n.e.String(this.ScreenObject.GridData[r].Type)||this.FillAutoBatchesforDynamic(r),(t&&""==n.e.String(this.ScreenObject.GridData[r].ExtraXML)||!this.DonotUpdateInventory||l>0)&&!n.e.IsEmpty(this.ScreenObject.GridData[r].Type)&&5==parseInt(this.ScreenObject.GridData[r].Type.toString())&&(!this.ScreenObject.Preferences.ContainsKey("SameBatchtoall")||"true"!=this.ScreenObject.Preferences.SameBatchtoall.toLowerCase())&&(!e||!this.ScreenObject.Preferences.ContainsKey("BatchBasedon")||""==this.ScreenObject.Preferences.BatchBasedon)&&(!n.e.IsEmpty(this.ScreenObject.GridData[r].Quantity)&&parseFloat(this.ScreenObject.GridData[r].Quantity.toString())>0||l>0||32==this.DocumentType||this.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!n.e.IsEmpty(this.ScreenObject.GridData[r].FreeQTY)&&parseFloat(this.ScreenObject.GridData[r].FreeQTY.toString())>0)&&-1==this.VoucherType&&(this.ScreenObject.Preferences.ContainsKey("AutoBatches")&&!n.e.IsEmpty(this.ScreenObject.Preferences.AutoBatches)&&Object(o.j)(this.ScreenObject.Preferences.AutoBatches)&&(""==n.e.String(this.ScreenObject.GridData[r].DocDetailsID)||0==parseInt(n.e.String(this.ScreenObject.GridData[r].DocDetailsID)))||t&&""==n.e.String(this.ScreenObject.GridData[r].ExtraXML))){let e=0,t=0;if(this.ScreenObject.Preferences.ContainsKey("Donotuselocation")&&""!=this.ScreenObject.Preferences.Donotuselocation&&Object(o.j)(this.ScreenObject.Preferences.Donotuselocation)){var i=this.ScreenObject._CCFields.find(e=>"dcccnid2"==e.DBColumnName.toLowerCase());null!=i&&null!=i&&i instanceof m.b&&i.SelectedValue>0?t=i.SelectedValue:this.ScreenObject.GridDataColumns.Contains("dcCCNID2_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[r].dcCCNID2_Key)&&(t=parseInt(this.ScreenObject.GridData[r].dcCCNID2_Key.toString()))}else t=this.ScreenObject.LocationID>0?this.ScreenObject.LocationID:a.a.SessionManager.LocationID;e=this.ScreenObject.DivisionID>0?this.ScreenObject.DivisionID:a.a.SessionManager.DivisionID,0==l&&(!n.e.IsEmpty(this.ScreenObject.GridData[r].Quantity)&&parseFloat(this.ScreenObject.GridData[r].Quantity.toString())>0&&(l=parseFloat(this.ScreenObject.GridData[r].Quantity.toString())),this.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!n.e.IsEmpty(this.ScreenObject.GridData[r].FreeQTY)&&parseFloat(this.ScreenObject.GridData[r].FreeQTY.toString())>0&&(l=parseFloat(this.ScreenObject.GridData[r].FreeQTY.toString())),this.ScreenObject.GridDataColumns.Contains("UOMConversion")&&!n.e.IsEmpty(this.ScreenObject.GridData[r].UOMConversion)&&(l*=parseFloat(this.ScreenObject.GridData[r].UOMConversion.toString())));let s=new Te.a(this.ScreenObject.GridDataObj);s.BatchNumberViewModel_3(this,this.VoucherType,l,parseInt(this.ScreenObject.GridData[r].ProductID_Key.toString()),this.ScreenObject.GridData[r].ProductName.toString(),t,e,this.ScreenObject.GridData[r]),s.ChkFifo=!0,s.OnSave("AutoSave"),s.count>1&&this.ScreenObject.UpdateSequence()}}}SaveDocument(){this.SaveInventoryDocument(this.SaveCallReq.sender,this.SaveCallReq.Validate,this.SaveCallReq.CheckStock,this.SaveCallReq.CallType,this.SaveCallReq.AutoBatches,this.SaveCallReq.IgnoreBatches,!0)}SaveInventoryDocument(e,t=!1,s=!0,i=null,r=!1,l=!1,c=!1){this.SaveCallReq.sender=e,this.SaveCallReq.Validate=t,this.SaveCallReq.CheckStock=s,this.SaveCallReq.CallType="SYNC_SAVE",this.SaveCallReq.AutoBatches=r,this.SaveCallReq.IgnoreBatches=l,console.log("SaveInventoryDocument In"),Logger.InfoLog("AddEditDocumentViewModel::Entering OnSaveAccount");try{if(this.ScreenObject.BulkSaveon>0){let e=this.ScreenObject.GridData.filter(e=>e.ProductID_Key>0).Compute("count","ProductID_Key");null==e&&(e=0),this.savebulk=parseInt(e)>this.ScreenObject.BulkSaveon}if(this.ScreenObject.Preferences.ContainsKey("LinkAll")&&""!=this.ScreenObject.Preferences.LinkAll&&Object(o.j)(this.ScreenObject.Preferences.LinkAll)&&null!=this.ScreenObject.Link&&null!=this.ScreenObject.Link.DocumentList&&this.ScreenObject.Link.DocumentList.Items.length>0&&this.ScreenObject.Link.DocumentList.Items.forEach(e=>{if(!e.IsChecked||0==this.ScreenObject.GridData.filter(t=>t.RefNo==e.Name).length)return this.DisplayMessage="Link all Documents",!1}),c||this.BillWisedt.Clear(),t&&this.ScreenObject.Preferences.ContainsKey("MadatoryAttachments")&&""!=this.ScreenObject.Preferences.MadatoryAttachments&&Object(o.j)(this.ScreenObject.Preferences.MadatoryAttachments)&&(null==this.ViewAttachments||0==this.ViewAttachments.AttachmentsList.length))return this.DisplayMessage="No Attachments added.",!1;let i=!0,C=!1,p=!1,g=!1,O=!0;if(this.ScreenObject.Preferences.ContainsKey("DonotupdateAccounts")&&""!=this.ScreenObject.Preferences.DonotupdateAccounts&&(i=Object(o.j)(this.ScreenObject.Preferences.DonotupdateAccounts)),this.ScreenObject.Preferences.ContainsKey("DonotupdateInventory")&&""!=this.ScreenObject.Preferences.DonotupdateInventory&&(this.DonotUpdateInventory=Object(o.j)(this.ScreenObject.Preferences.DonotupdateInventory)),null!=this.donotupInv&&(this.DonotUpdateInventory=this.donotupInv.IsChecked),this.ScreenObject.Preferences.ContainsKey("DonotUpdateSchemeQty")&&""!=this.ScreenObject.Preferences.DonotUpdateSchemeQty&&(this.DonotUpdateSchemeQty=Object(o.j)(this.ScreenObject.Preferences.DonotUpdateSchemeQty)),this.ScreenObject.Preferences.ContainsKey("DontSaveIf_ValueZero")&&""!=this.ScreenObject.Preferences.DontSaveIf_ValueZero&&(C=Object(o.j)(this.ScreenObject.Preferences.DontSaveIf_ValueZero)),this.ScreenObject.Preferences.ContainsKey("DontSaveIf_RateZero")&&""!=this.ScreenObject.Preferences.DontSaveIf_RateZero&&(p=Object(o.j)(this.ScreenObject.Preferences.DontSaveIf_RateZero)),this.ScreenObject.Preferences.ContainsKey("DontSaveIf_QtyIsZero")&&""!=this.ScreenObject.Preferences.DontSaveIf_QtyIsZero&&(g=Object(o.j)(this.ScreenObject.Preferences.DontSaveIf_QtyIsZero)),this.ScreenObject.Preferences.ContainsKey("DontSaveIf_QtyIsNegative")&&""!=this.ScreenObject.Preferences.DontSaveIf_QtyIsNegative&&(O=Object(o.j)(this.ScreenObject.Preferences.DontSaveIf_QtyIsNegative)),this.ScreenObject.IsForecast){let e=this.ScreenObject.ForecastObj.Validate();if(e.length>0)return this.DisplayMessage=e,!1}if(t&&30==this.ScreenObject.DocumentType&&this.ScreenObject.GridDataColumns.Contains("VoucherType")&&this.ScreenObject.Preferences.ContainsKey("DontSaveIssueRctequal")&&""!=this.ScreenObject.Preferences.DontSaveIssueRctequal&&Object(o.j)(this.ScreenObject.Preferences.DontSaveIssueRctequal)){let e=this.ScreenObject.GridData.filter(e=>e.ProductID_Key>0&&-1==e.VoucherType).Compute("sum","Quantity"),t=this.ScreenObject.GridData.filter(e=>e.ProductID_Key>0&&1==e.VoucherType).Compute("sum","Quantity");null==t&&(t=0),null==e&&(t=0);let s=parseFloat(e).ToString("N"+a.a.SessionManager.Preferences.DecimalsinQty),i=parseFloat(t).ToString("N"+a.a.SessionManager.Preferences.DecimalsinQty);if(null==e&&null==t);else if(s.toString()!=i.toString())return this.DisplayMessage=a.a.GetResource("IssRcvarenotEqual"),!1}if(81==this.ScreenObject.DocumentType){if(0==this.DocID)for(let e=0;e<this.ScreenObject._CCFields.length;e++){let t=this.ScreenObject._CCFields[e];if(t instanceof m.b&&50002==t.CCID&&t.SelectedValue>0){this.dtData=null;let e=this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase());e&&e instanceof D.e&&!n.e.IsEmpty(e.SelectedValue)&&this.LoadGradeData(this.DocID>0?1:2,new Date,"GradeWiseCopy");break}}if(null!=this.dtData&&this.dtData.length>0){let e=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase());if(e&&e instanceof D.e&&n.e.IsEmpty(e.SelectedValue))return this.DisplayMessage="Please select the Year",!1;let t=new Date(parseInt(e.SelectedValue),parseInt(a.a.SessionManager.Preferences.LeaveYear),1),s=0;if(e=this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase()),e&&e instanceof D.e)if("EmployeeWise"!=e.SelectedValue.toString())for(let a=0;a<this.ScreenObject.GridData.length;a++){if(null!=this.ScreenObject.GridData[a].ProductID_Key)for(let e=0;e<this.dtData.length;e++)parseFloat(this.ScreenObject.GridData[a].dcCCNID53_Key)==parseFloat(this.dtData[e].dcCCNID53_Key)&&parseFloat(this.ScreenObject.GridData[a].dcCCNID52_Key)==parseFloat(this.dtData[e].dcCCNID52_Key)&&(this.dtData[e].dcNum3=parseFloat(this.ScreenObject.GridData[a].dcNum3));s=a}else s=this.ScreenObject.GridData.length-1;let i=this.ScreenObject.GridData.filter(e=>n.e.IsEmpty(e.ProductID_Key)||0==e.ProductID_Key);i.length>0&&i.forEach(e=>{this.ScreenObject.GridDataObj.removeRow(e)}),s+=2;let r=new Date,o=0,l=null,c=null,h=a.a.common.GetDataTable("DOC070","");for(let u=0;u<this.dtData.length;u++){let e=this.ScreenObject.GridDataObj.NewRow();if(this.ScreenObject.GridDataObj.insertRowAt(e,s+u),e.ProductID_Key=parseInt(a.a.SessionManager.Preferences.PayrollProduct),e.Unit_Key=1,e.dcCCNID51_Key=this.dtData[u].dcCCNID51_Key.toString(),e.dcCCNID52_Key=this.dtData[u].dcCCNID52_Key.toString(),e.dcCCNID53_Key=this.dtData[u].dcCCNID53_Key.toString(),o=parseFloat(this.dtData[u].dcNum3),parseInt(e.dcCCNID51_Key)>0&&null!=this.dtPayEmps&&this.dtPayEmps.length>0&&(l=this.dtPayEmps.filter(t=>t.NodeID==e.dcCCNID51_Key),null!=l&&l.length>0))if(null!=h&&h.length>0&&(c=h.filter(t=>t.GradeID==e.dcCCNID53_Key&&t.ComponentID==e.dcCCNID52_Key),c=c.sort((e,t)=>e.PayrollDate>t.PayrollDate?1:-1)),null!=c&&c.length>0&&"No"==n.e.String(c[0].AccrualInProbation)){if(!n.e.IsEmpty(l[0].DOC)&&(r=n.e.IsEmpty(l[0].DOC)?new Date("01-Jan-1900"):new Date(l[0].DOC),r>t)){let e=12-(r.iMonth()-t.iMonth());e>0&&r.getFullYear()==t.getFullYear()?(o=o*e/12,o=Math.round(o)):o=0}}else if(r=n.e.IsEmpty(l[0].DOJ)?new Date("01-Jan-1900"):new Date(l[0].DOJ),r>t){let e=12-(r.iMonth()-t.iMonth());e>0?(o=o*e/12,o=Math.round(o)):o=0}e.dcNum3=o.toString()}this.ScreenObject.GridDataObj.refreshDataView(),this.ScreenObject.UpdateSequence(),this.RefreshGrid=!0,this.dtData.length>0&&this.dtData.Clear()}}if(this.IsNewAssignLeave){let e=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase());if(null!=e&&e instanceof D.e&&""==n.e.String(e.SelectedValue))return this.DisplayMessage="Please select the Year",this.MessageVisibility=!0,!1;let t=new Date(parseInt(e.SelectedValue),parseInt(a.a.SessionManager.Preferences.LeaveYear.toString()),1),s=0;if(e=this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase()),null!=e&&e instanceof D.e)if("EmployeeWise"!=e.SelectedValue.toString())for(let a=0;a<this.ScreenObject.GridData.length;a++){if(null!=this.ScreenObject.GridData[a].ProductID_Key)for(let e=0;e<this.dtData.length;e++){let t=this.dtALeaveComp.filter(t=>t.ComponentID==this.dtData[e].dcCCNID52_Key);parseFloat(this.ScreenObject.GridData[a].dcCCNID53_Key)==parseFloat(this.dtData[e].dcCCNID53_Key)&&this.ScreenObject.GridDataColumns.Contains("dcNum"+t[0].SNo.toString())&&null!=this.ScreenObject.GridData[a]["dcNum"+t[0].SNo.toString()]&&""!=this.ScreenObject.GridData[a]["dcNum"+t[0].SNo.toString()]&&null!=this.ScreenObject.GridData[a]["dcNum"+t[0].SNo.toString()]&&(this.dtData[e].dcNum3=parseFloat(this.ScreenObject.GridData[a]["dcNum"+t[0].SNo.toString()]))}s=a}else s=this.ScreenObject.GridData.length-1;let i=this.ScreenObject.GridData.filter(e=>0==e.ProductID_Key||null==e.ProductID_Key);i.length>0&&i.forEach(e=>{this.ScreenObject.GridData.Remove(e)}),s+=2;let r=new Date,o=0,l=null,c=this.dtData.ToTable(!0,["dcCCNID51_Key"]);for(let n=0;n<c.length;n++){let e=this.dtData.filter(e=>e.dcCCNID51_Key==c[n].dcCCNID51_Key);if(null!=e&&e.length>0){let i=this.ScreenObject.GridDataObj.NewRow();this.ScreenObject.GridDataObj.insertRowAt(i,s+n),i.ProductID_Key=parseInt(a.a.SessionManager.Preferences.PayrollProduct),i.Unit_Key=1,i.dcCCNID51_Key=e[0].dcCCNID51_Key.toString(),i.dcCCNID53_Key=e[0].dcCCNID53_Key.toString();for(let s=0;s<e.length;s++){let a=this.dtALeaveComp.filter(t=>t.ComponentID==e[s].dcCCNID52_Key);if(o=parseFloat(e[s].dcNum3),parseInt(i.dcCCNID51_Key)>0&&null!=this.dtPayEmps&&this.dtPayEmps.length>0&&(l=this.dtPayEmps.filter(e=>e.NodeID==i.dcCCNID51_Key.toString()),null!=l&&l.length>0&&(r=null!=l[0].DOJ&&""!=l[0].DOJ.toString()?new Date(l[0].DOJ):new Date("01-Jan-1900"),r>t))){let e=12-(r.iMonth()-t.iMonth());e>0?(o=o*e/12,o=Math.round(o)):o=0}i["dcNum"+a[0].SNo.toString()]=o.toString(),this.ScreenObject.GridDataObj.updateRow(i)}}}this.ScreenObject.UpdateSequence(),this.RefreshGrid=!0,this.dtData.length>0&&this.dtData.Clear()}if(this.FillHeaderDictionary(),t&&!this.ValidateHeaderSave())return!1;let I="";if(this.DocumentType>50&&(this.DisplayMessage=this.CheckDocumentValidations(I),""!=this.DisplayMessage))return""!=this.strVacXml&&(this.strVacXml=this.strVacXml+this.DisplayMessage),!1;t&&this.FillCreatedByDate(e.toString());let f={message:I};if(this.ScreenObject.GenerateQuery(f,i,this.DocumentDate,t,this.savebulk),I=f.message,null!=this.ScreenObject.DebitAccount&&(this.ScreenObject.strStaticFields+=' DebitAccount="'+this.ScreenObject.DebitAccount.SelectedValue+'" ',this.res="No",(7==this.ScreenObject.DocumentType||11==this.ScreenObject.DocumentType||12==this.ScreenObject.DocumentType)&&t&&!i&&!this.CheckCreditLimit(this.ScreenObject.DebitAccount.SelectedValue,parseFloat(this.NetAmount),!1)))return!1;if(null!=this.ScreenObject.CreditAccount&&(this.ScreenObject.strStaticFields+=' CreditAccount="'+this.ScreenObject.CreditAccount.SelectedValue+'" ',this.res="No",(1==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType)&&t&&!i&&!this.CheckCreditLimit(this.ScreenObject.CreditAccount.SelectedValue,-parseFloat(this.NetAmount),!0)))return!1;if(""!=I)return this.DisplayMessage=I,!1;if("NoWorkFlowReSave"!=e.toString()&&this.ScreenObject.Preferences.ContainsKey("ReEvaluateBeforeSave")&&""!=this.ScreenObject.Preferences.ReEvaluateBeforeSave&&Object(o.j)(this.ScreenObject.Preferences.ReEvaluateBeforeSave)&&this.ReEvaluate(!0,!1),"NoWorkFlowReSave"!=e.toString()&&this.ScreenObject.Preferences.ContainsKey("ValidateSchemeBeforeSave")&&""!=this.ScreenObject.Preferences.ValidateSchemeBeforeSave&&Object(o.j)(this.ScreenObject.Preferences.ValidateSchemeBeforeSave)&&!this.ValidateSchemes())return!1;if(92==this.ScreenObject.DocumentType)return this.SaveShiftAssign();if(this.AutoPOstXML="",null!=this.AutoPostViewModel&&this.ScreenObject.Preferences.ContainsKey("Autopostdocument")&&""!=this.ScreenObject.Preferences.Autopostdocument&&n.e.Int(this.ScreenObject.Preferences.Autopostdocument)&&parseInt(this.ScreenObject.Preferences.Autopostdocument)>4e4){for(let e=0;e<this.ScreenObject.GridData.length;e++)if(!n.e.IsEmpty(this.ScreenObject.GridData[e].ProductID_Key)){let t=this.AutoPostViewModel.ScreenObject.GridData.filter(t=>t.RefSeqNo==this.ScreenObject.GridData[e].RefSeqNo);if(t.length>0){let s=0;if(t.forEach(t=>{this.ScreenObject.Preferences.ContainsKey("ExpFPQTY")&&this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.Preferences.ExpFPQTY)?n.e.IsEmpty(this.ScreenObject.GridData[e][this.ScreenObject.Preferences.ExpFPQTY])||(s=parseFloat(this.ScreenObject.GridData[e][this.ScreenObject.Preferences.ExpFPQTY])):n.e.IsEmpty(this.ScreenObject.GridData[e].Quantity)||(s=parseFloat(this.ScreenObject.GridData[e].Quantity)),n.e.IsEmpty(t.defaultQuantity)||s*parseFloat(t.defaultQuantity)==parseFloat(t.Quantity)||(t.Quantity=s*parseFloat(t.defaultQuantity),n.e.IsEmpty(t.Quantity)||n.e.IsEmpty(t.UOMConversion)||!n.e.IsNum(t.UOMConversion)?n.e.IsEmpty(t.Quantity)||(t.UOMConvertedQty=t.Quantity.toString()):t.UOMConvertedQty=n.e.Double(t.UOMConversion)*parseFloat(t.Quantity),this.AutoPostViewModel.CalculateTotals(t,!1))}),this.ScreenObject.Preferences.ContainsKey("Autopostdocument")&&""!=this.ScreenObject.Preferences.Autopostdocument&&"0"!=this.ScreenObject.Preferences.Autopostdocument){let e=this.AutoPostViewModel.ScreenObject._TextFields.find(e=>e.DBColumnName.toLowerCase()==this.ScreenObject.Preferences.FPQty.toLowerCase());e&&e instanceof u.d&&(e.Text=s.toString())}}}if(this.AutoPostViewModel.ScreenObject.UpdateSequence(),this.AutoPostViewModel.ScreenObject.DocID=this.AutoPostDocID,this.AutoPostViewModel.OKCancelVisibility=!0,this.AutoPostViewModel.parent=this,this.ScreenObject.Preferences.ContainsKey("DisplaydocbeforeSave")&&""!=this.ScreenObject.Preferences.DisplaydocbeforeSave&&Object(o.j)(this.ScreenObject.Preferences.DisplaydocbeforeSave)){if(this.AutoPostViewModel.DisplayMessage="","close"==this.AutoPostViewModel.DisplayMessage)return!1;if(!this.ScreenObject.IsPurchase)for(let e=0;e<this.ScreenObject.GridData.length;e++)if(!n.e.IsEmpty(this.ScreenObject.GridData[e].ProductID_Key)){let t=this.AutoPostViewModel.ScreenObject.GridData.filter(t=>t.RefSeqNo==this.ScreenObject.GridData[e].RefSeqNo),s=0;t.forEach(e=>{n.e.IsEmpty(e.Gross)||(s+=parseFloat(e.Gross))}),this.ScreenObject.GridData[e].Rate=s/parseFloat(this.ScreenObject.GridData[e].Quantity),this.CalculateTotals(this.ScreenObject.GridData[e],!1)}}else if(this.AutoPostViewModel.SaveInventoryDocument("",!0),""!=this.AutoPostViewModel.DisplayMessage)return this.DisplayMessage=" Auto Post"+this.AutoPostViewModel.DisplayMessage,!1}if(null!=this.AutoProduce&&(this.AutoProduce.ScreenObject.UpdateSequence(),this.AutoProduce.ScreenObject.DocID=this.AutoProduceDocID,this.AutoProduce.parent=this,this.AutoProduceXML="",this.AutoProduce.SaveInventoryDocument("",!0),""!=this.AutoProduce.DisplayMessage))return this.DisplayMessage=" Auto Produce:"+this.AutoProduce.DisplayMessage,!1;let T="",j="",P="",A="",M="",G="",N="",E="";this.savebulk&&(j+="<DocXML>",P+="<NumXML>",A+="<TextXML>",M+="<CCXML>",T+="<AccXML>",N+="<EXTRAXML>",E+="<DocExtraXml>");let w,F,V=0,B=0,_=0,k=[],K=[],Q=!1,U=!1,X=0,q=0,Y={dim:k,BudID:X,BudStartDate:w,IsQtyBudLineWise:Q},J=this.ValidateBudget(1,Y);k=Y.dim,X=Y.BudID,w=Y.BudStartDate,Q=Y.IsQtyBudLineWise;let z={dim:K,ValueBudID:q,ValueBudStartDate:F,IsValueBudLineWise:U},Z=this.ValidateBudget(2,z);K=Y.dim,q=z.ValueBudID,F=z.ValueBudStartDate,U=z.IsValueBudLineWise;let $=a.a.SessionManager.Preferences.DecimalsinQty,ee=this.ScreenObject.ColumnSource.find(e=>null!=e.DisplayMember&&"quantity"==e.DisplayMember.toLowerCase());ee&&!n.e.IsEmpty(ee.DecimalPoints)&&($=ee.DecimalPoints),this.BodyVisible&&!this.ReadOnlyBody||this.CheckEmptyGrid();let te="",se="";this.IsBinwise=null,this.IsToBinwise=null;let ie=!1,ae=!1,ne=null;(this.ScreenObject.Preferences.ContainsKey("Alert Duplicate Product")&&""!=this.ScreenObject.Preferences["Alert Duplicate Product"].toString()&&Object(o.j)(this.ScreenObject.Preferences["Alert Duplicate Product"])||this.ScreenObject.Preferences.ContainsKey("DuplicateProduct_IncrementQuantity")&&""!=this.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity&&Object(o.j)(this.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity))&&(ie=!0),0==this.ScreenObject.DocID&&(this.ScreenObject.DistributeCostXML="");let re=0,oe=0;if(1==this.ScreenObject.DocumentType||39==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||6==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||13==this.ScreenObject.DocumentType?(null!=this.ScreenObject.CreditAccount&&this.ScreenObject.CreditAccount.SelectedValue>0&&(re=this.ScreenObject.CreditAccount.SelectedValue),null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.SelectedValue>0&&(oe=this.ScreenObject.DebitAccount.SelectedValue)):11!=this.ScreenObject.DocumentType&&38!=this.ScreenObject.DocumentType&&5!=this.ScreenObject.DocumentType&&7!=this.ScreenObject.DocumentType&&9!=this.ScreenObject.DocumentType&&24!=this.ScreenObject.DocumentType&&33!=this.ScreenObject.DocumentType&&10!=this.ScreenObject.DocumentType&&8!=this.ScreenObject.DocumentType&&12!=this.ScreenObject.DocumentType||(null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.SelectedValue>0&&(re=this.ScreenObject.DebitAccount.SelectedValue),null!=this.ScreenObject.CreditAccount&&this.ScreenObject.CreditAccount.SelectedValue>0&&(oe=this.ScreenObject.CreditAccount.SelectedValue)),a.a.SessionManager.Preferences.ContainsKey("DistributeCost")&&"True"==a.a.SessionManager.Preferences.DistributeCost&&a.a.SessionManager.Preferences.ContainsKey("CostBasedON")&&"True"==a.a.SessionManager.Preferences.CostBasedON&&a.a.SessionManager.Preferences.ContainsKey("CostBasedONDims")&&""!=a.a.SessionManager.Preferences.CostBasedONDims&&(!this.ScreenObject.Preferences.ContainsKey("DistributeCost")||"True"!=this.ScreenObject.Preferences.DistributeCost.toString())?ne=a.a.SessionManager.Preferences.CostBasedONDims.split(","):!a.a.SessionManager.Preferences.ContainsKey("DistributeCost")||"True"!=a.a.SessionManager.Preferences.DistributeCost||this.ScreenObject.Preferences.ContainsKey("DistributeCost")&&"True"==this.ScreenObject.Preferences.DistributeCost.toString()||(ae=this.ScreenObject.IsDistCost(re.toString()+","+oe.toString())),this.ScreenObject.Preferences.ContainsKey("BatchBasedon")&&""!=this.ScreenObject.Preferences.BatchBasedon&&!this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.Preferences.BatchBasedon)){let e=this.ScreenObject._TextFields.find(e=>e instanceof u.d&&e.DBColumnName.toLowerCase()==this.ScreenObject.Preferences.BatchBasedon.toLowerCase());e&&"1"==e.Text&&(l=!0)}-1==this.VoucherType&&(r||this.ScreenObject.Preferences.ContainsKey("AutoBatches")&&!n.e.IsEmpty(this.ScreenObject.Preferences.AutoBatches)&&Object(o.j)(this.ScreenObject.Preferences.AutoBatches))&&this.AutoAdjustbatches(l,r);for(let s=0;s<this.ScreenObject.GridData.length;s++){if(n.e.IsEmpty(this.ScreenObject.GridData[s].ProductID_Key)){if(t)for(let e=0;e<this.ScreenObject.ColumnSource.length;e++)if(this.ScreenObject.ColumnSource[e].IsVisible&&"DocSeqNo"!=this.ScreenObject.ColumnSource[e].DisplayMember&&(("INT"==this.ScreenObject.ColumnSource[e].DataType||"FLOAT"==this.ScreenObject.ColumnSource[e].DataType)&&!n.e.IsEmpty(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[e].DisplayMember])&&0!=parseFloat(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[e].DisplayMember])||"LISTBOX"==this.ScreenObject.ColumnSource[e].DataType&&!n.e.IsEmpty(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[e].ValueMember])&&parseInt(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[e].ValueMember])>0||("SELECTIONBOX"==this.ScreenObject.ColumnSource[e].DataType||"String"==this.ScreenObject.ColumnSource[e].DataType||"TextBlock"==this.ScreenObject.ColumnSource[e].DataType||"TEXT"==this.ScreenObject.ColumnSource[e].DataType)&&!n.e.IsEmpty(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[e].DisplayMember])||("DATE"==this.ScreenObject.ColumnSource[e].DataType||"DATETIME"==this.ScreenObject.ColumnSource[e].DataType)&&!n.e.IsEmpty(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[e].DisplayMember+"_Key"])))return this.DisplayMessage=" Product not selected at row no."+this.ScreenObject.GridData[s].DocSeqNo.toString(),!1;continue}let c=!1;if(!n.e.IsEmpty(this.ScreenObject.GridData[s].SchemeID)&&parseInt(this.ScreenObject.GridData[s].SchemeID)>0&&"Y"==this.ScreenObject.GridData[s].IsScheme.toString()&&(c=!0),t&&ie&&!n.e.IsEmpty(this.ScreenObject.GridData[s].LinkedInvDocDetailsID)&&parseInt(this.ScreenObject.GridData[s].LinkedInvDocDetailsID)>0&&T.Contains('ProductID="'+this.ScreenObject.GridData[s].ProductID_Key.toString()+'"')&&(a.a.SessionManager.Preferences.ContainsKey("ShowProdCodeinErrMsg")&&Object(o.j)(a.a.SessionManager.Preferences.ShowProdCodeinErrMsg)?this.res=this.ScreenObject.GridData[s].ProductCode.toString()+"-"+this.ScreenObject.GridData[s].ProductName.toString():this.ScreenObject.GridDataColumns.Contains("ProductName")?this.res=this.ScreenObject.GridData[s].ProductName.toString():this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(this.res=this.ScreenObject.GridData[s].ProductCode.toString()),!confirm("Duplicate product:"+this.res+" at row no:"+this.ScreenObject.GridData[s].DocSeqNo.toString()+" \n do you want to continue?")))return!1;if(this.ScreenObject.Preferences.ContainsKey("BatchBasedon")&&this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.Preferences.BatchBasedon)&&(l=!1,"1"==this.ScreenObject.GridData[s][this.ScreenObject.Preferences.BatchBasedon].toString()&&(l=!0)),t&&this.ScreenObject.Preferences.ContainsKey("Mandatory")&&Object(o.j)(this.ScreenObject.Preferences.Mandatory)&&(n.e.IsEmpty(this.ScreenObject.GridData[s].LinkedInvDocDetailsID)||!n.e.IsEmpty(this.ScreenObject.GridData[s].LinkedInvDocDetailsID)&&parseInt(this.ScreenObject.GridData[s].LinkedInvDocDetailsID)<1)&&!(this.ScreenObject.GridDataColumns.Contains("jobID")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].jobID)||this.ScreenObject.GridDataColumns.Contains("BOMID")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].BOMID)))return this.DisplayMessage=a.a.GetResource("Doc_MissingRef")+" "+this.ScreenObject.GridData[s].DocSeqNo.toString(),!1;if(t&&!c){if(!n.e.IsEmpty(this.ScreenObject.GridData[s].ProductID_Key)&&parseInt(this.ScreenObject.GridData[s].ProductID_Key)==this.ScreenObject.TempProductID&&this.ScreenObject.Preferences.ContainsKey("MandatorytempPartinfo")&&Object(o.j)(this.ScreenObject.Preferences.MandatorytempPartinfo)&&n.e.IsEmpty(this.ScreenObject.GridData[s].ExtraXML))return this.DisplayMessage=a.a.GetResource("Doc_MandatoryTempInfo")+" "+this.ScreenObject.GridData[s].DocSeqNo.toString(),!1;if(g&&(n.e.IsEmpty(this.ScreenObject.GridData[s].Quantity)||!n.e.IsNum(this.ScreenObject.GridData[s].Quantity)||0==n.e.Double(this.ScreenObject.GridData[s].Quantity)))return this.DisplayMessage=a.a.GetResource("Doc_ZeroQty")+" "+this.ScreenObject.GridData[s].DocSeqNo.toString(),!1;if(O&&!n.e.IsEmpty(this.ScreenObject.GridData[s].Quantity)&&parseFloat(this.ScreenObject.GridData[s].Quantity)<0)return this.DisplayMessage=a.a.GetResource("Doc_NegativeQty")+" "+this.ScreenObject.GridData[s].DocSeqNo.toString(),!1;if(p&&(n.e.IsEmpty(this.ScreenObject.GridData[s].Rate)||!n.e.IsNum(this.ScreenObject.GridData[s].Rate)||0==parseFloat(this.ScreenObject.GridData[s].Rate)))return this.DisplayMessage=a.a.GetResource("Doc_ZeroRate")+" "+this.ScreenObject.GridData[s].DocSeqNo.toString(),!1;if(C&&(n.e.IsEmpty(this.ScreenObject.GridData[s].Gross)||!n.e.IsNum(this.ScreenObject.GridData[s].Gross)||0==parseFloat(this.ScreenObject.GridData[s].Gross)))return this.DisplayMessage=a.a.GetResource("Doc_ZeroValue")+" "+this.ScreenObject.GridData[s].DocSeqNo.toString(),!1}if(t&&this.ScreenObject.GridDataColumns.Contains("QtyType")&&"1"==n.e.String(this.ScreenObject.GridData[s].QtyType)&&n.e.IsEmpty(this.ScreenObject.GridData[s].QtyXML))return this.DisplayMessage="Qty Adjustment not done at row no. "+this.ScreenObject.GridData[s].DocSeqNo.toString(),!1;if(t&&this.ScreenObject.GridDataColumns.Contains("IsTestCase")&&"true"==n.e.LowerCase(this.ScreenObject.GridData[s].IsTestCase)&&n.e.IsEmpty(this.ScreenObject.GridData[s].TestCaseXML))return this.DisplayMessage="Test Case not done at row no. "+this.ScreenObject.GridData[s].DocSeqNo.toString(),!1;if(this.AutoAdjustBOE(s),t&&this.ScreenObject.GridDataColumns.Contains("landingType")&&("1"==n.e.String(this.ScreenObject.GridData[s].landingType)||"2"==n.e.String(this.ScreenObject.GridData[s].landingType))&&(!this.ScreenObject.GridDataColumns.Contains("VoucherType")||"-1"==n.e.String(this.ScreenObject.GridData[s].VoucherType))&&!n.e.IsEmpty(this.ScreenObject.GridData[s].Quantity)&&parseFloat(this.ScreenObject.GridData[s].Quantity)>0){if(""==n.e.String(this.ScreenObject.GridData[s].DocExtraXML))return this.DisplayMessage="Bill of Entry not done at row no. "+this.ScreenObject.GridData[s].DocSeqNo.toString(),!1;{let e=new n.f;e.LoadXml(this.ScreenObject.GridData[s].DocExtraXML);let t=e.SelectNodes("DocExtraXML/Row"),i=0;for(let s=0;s<t.length;s++)null==t[s].attributes.Qty||n.e.IsEmpty(t[s].attributes.Qty.value)||(i+=parseFloat(t[s].attributes.Qty.value));if(parseFloat(this.ScreenObject.GridData[s].Quantity)!=i)return this.DisplayMessage="Bill of Entry not done at row no. "+this.ScreenObject.GridData[s].DocSeqNo.toString(),!1}}if(5==this.ScreenObject.DocumentType&&this.ScreenObject.GridDataColumns.Contains("RecievedQty")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].RecievedQty)&&(!n.e.IsEmpty(this.ScreenObject.GridData[s].Quantity)&&parseFloat(this.ScreenObject.GridData[s].RecievedQty)>parseFloat(this.ScreenObject.GridData[s].Quantity)||n.e.IsEmpty(this.ScreenObject.GridData[s].Quantity)))return this.DisplayMessage="RecievedQty greater than Issued quantity at row no:"+this.ScreenObject.GridData[s].DocSeqNo.toString(),!1;if(V++,this.res="No",1==V){if(0==this.DocID&&this.ScreenObject.Preferences.ContainsKey("AutoadjustDownPmt")&&Object(o.j)(this.ScreenObject.Preferences.AutoadjustDownPmt)&&Object(o.j)(this.ScreenObject.Preferences.AllowAdjToDownPmt)){let e=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&26425==e.LinkData);if(!(e.length>0))return this.DisplayMessage="Define Advance AR/AP field.",!1;{let t=new v.ShowJVViewModel;t.ShowJVViewModel_2(this,e[0].SysColumnName.toString(),1),t.OnSave("OK")}}let i=this.ScreenObject.ColumnSource.find(e=>-1==e.DistributionColID);if(!i||3!=i.PostingType&&4!=i.PostingType||this.RoundOffValue(this.ScreenObject.GridData[s],i),("CheckoutPrint"==e.toString()||"CheckoutSave"==e.toString()||!t)&&null!=this.POSPayModes){this.FillHeaderDictionary();for(let e=0;e<this.POSPayModes.GridData.length;e++)n.e.IsEmpty(this.POSPayModes.GridData[e].ColumnName)||this.FooterDics.ContainsKey(this.POSPayModes.GridData[e].Name.toString().Replace(" ",""))&&this.FooterDics[this.POSPayModes.GridData[e].Name.toString().Replace(" ","")].setFieldValue(this.POSPayModes.GridData[e].Amount.toString());this.CalculateFooter(-1)}if(!this.DistributeFooter(t))return!1}let D=0;do{this.savebulk?(j+="<Transactions ",P+="<Numeric ",M+="<CostCenters ",A+="<Alpha "):(j="",P="",A="",M="",E="",j+="<Transactions ",P+='<Numeric Query="',M+='<CostCenters Query="',A+='<Alpha Query="',this.isSaveXml||(this.IsAutoPost||this.isAutoProduce)&&null!=parent?T+="<RowHead/>":T+="\x11",T+="<Row>",T+="<AccountsXML>"),B=0,G="";let S=0,b=0;if(32==this.DocumentType){let e="";var h=this.ScreenObject.ColumnSource.find(e=>e.ID==this.ScreenObject.Preferences.VarienceField);null!=h&&(e=h.DisplayMember),""!=e&&this.ScreenObject.GridDataColumns.Contains(e)&&""!=this.ScreenObject.GridData[s][e].toString()&&(b=parseFloat(this.ScreenObject.GridData[s][e].toString().Replace("-","")))}else n.e.IsEmpty(this.ScreenObject.GridData[s].Quantity)||(b=parseFloat(this.ScreenObject.GridData[s].Quantity.toString()));let C=new n.f;if(t&&(!this.DonotUpdateInventory||32==this.DocumentType)&&!n.e.IsEmpty(this.ScreenObject.GridData[s].Type)&&2==parseInt(this.ScreenObject.GridData[s].Type)&&b>0){if(n.e.IsEmpty(this.ScreenObject.GridData[s].ExtraXML))return this.DisplayMessage=a.a.GetResource("Doc_SerialNoProductQtyMisMatch")+" "+this.ScreenObject.GridData[s].DocSeqNo.toString(),!1;if(C.LoadXml(this.ScreenObject.GridData[s].ExtraXML),b!=C.SelectNodes("xml/Row").length)return this.DisplayMessage=a.a.GetResource("Doc_SerialNoProductQtyMisMatch")+" "+this.ScreenObject.GridData[s].DocSeqNo.toString(),!1;if(5==this.ScreenObject.DocumentType&&this.ScreenObject.GridDataColumns.Contains("RecievedQty")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].RecievedQty)){if(n.e.IsEmpty(this.ScreenObject.GridData[s].RecievedQtyXML))return this.DisplayMessage="Serial Numbers not defined for RecievedQty at row "+this.ScreenObject.GridData[s].DocSeqNo.toString(),!1;{C.LoadXml(this.ScreenObject.GridData[s].RecievedQtyXML);let e=C.SelectNodes("xml/Row");if(parseInt(this.ScreenObject.GridData[s].RecievedQty)!=e.length)return this.DisplayMessage="Serial Numbers not defined for RecievedQty at row "+this.ScreenObject.GridData[s].DocSeqNo.toString(),!1}}}if(t&&this.ScreenObject.Preferences.ContainsKey("EnableAssetSerialNo")&&"true"==this.ScreenObject.Preferences.EnableAssetSerialNo.toLowerCase()&&!n.e.IsEmpty(this.ScreenObject.GridData[s].Quantity)){let e=0;if(this.ScreenObject.Preferences.ContainsKey("AssetBasedOn")&&this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.Preferences.AssetBasedOn)?"0"==this.ScreenObject.GridData[s][this.ScreenObject.Preferences.AssetBasedOn].toString()?e=0:"1"!=this.ScreenObject.GridData[s][this.ScreenObject.Preferences.AssetBasedOn].toString()&&"2"!=this.ScreenObject.GridData[s][this.ScreenObject.Preferences.AssetBasedOn].toString()||n.e.IsEmpty(this.ScreenObject.GridData[s].Quantity)?"3"!=this.ScreenObject.GridData[s][this.ScreenObject.Preferences.AssetBasedOn].toString()&&"4"!=this.ScreenObject.GridData[s][this.ScreenObject.Preferences.AssetBasedOn].toString()||(e=1):e=parseFloat(this.ScreenObject.GridData[s].Quantity):n.e.IsEmpty(this.ScreenObject.GridData[s].Quantity)||(e=parseFloat(this.ScreenObject.GridData[s].Quantity)),e>0){if(n.e.IsEmpty(this.ScreenObject.GridData[s].ExtraXML))return this.DisplayMessage=a.a.GetResource("Doc_SerialNoProductQtyMisMatch")+" "+this.ScreenObject.GridData[s].DocSeqNo.toString(),!1;{C.LoadXml(this.ScreenObject.GridData[s].ExtraXML);let t=C.SelectNodes("xml/Row");if(e>=1&&e!=t.length||e<1&&t.length>1)return this.DisplayMessage=a.a.GetResource("Doc_SerialNoProductQtyMisMatch")+" "+this.ScreenObject.GridData[s].DocSeqNo.toString(),!1}}else this.ScreenObject.GridData[s].ExtraXML=""}if(!this.ScreenObject.GridDataColumns.Contains("UOMConversion")||!n.e.IsEmpty(this.ScreenObject.GridData[s].UOMConversion)&&n.e.IsNum(this.ScreenObject.GridData[s].UOMConversion)&&0!=parseFloat(this.ScreenObject.GridData[s].UOMConversion)||(this.ScreenObject.GridData[s].UOMConversion="1",n.e.IsEmpty(this.ScreenObject.GridData[s].Quantity)?(this.ScreenObject.GridData[s].UOMConvertedQty=0,this.ScreenObject.GridData[s].Quantity=0):this.ScreenObject.GridData[s].UOMConvertedQty=this.ScreenObject.GridData[s].Quantity.toString()),this.ScreenObject.Preferences.ContainsKey("AutoAdjustBins")&&!n.e.IsEmpty(this.ScreenObject.Preferences.AutoAdjustBins)&&Object(o.j)(this.ScreenObject.Preferences.AutoAdjustBins)&&(n.e.IsEmpty(this.ScreenObject.GridData[s].DocDetailsID)||0==parseInt(this.ScreenObject.GridData[s].DocDetailsID))&&this.AddBins(this.ScreenObject.GridData[s],!1,!1,null,!0),b=0,this.DonotUpdateInventory?this.ScreenObject.Preferences.ContainsKey("ExcludeHoldBins")&&!n.e.IsEmpty(this.ScreenObject.Preferences.ExcludeHoldBins)&&Object(o.j)(this.ScreenObject.Preferences.ExcludeHoldBins)&&(this.ScreenObject.GridDataColumns.Contains("ReserveQuantity")||this.ScreenObject.GridDataColumns.Contains("HoldQuantity"))&&(this.ScreenObject.GridDataColumns.Contains("ReserveQuantity")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].ReserveQuantity)&&parseFloat(this.ScreenObject.GridData[s].ReserveQuantity)>0&&(b=parseFloat(this.ScreenObject.GridData[s].ReserveQuantity)),this.ScreenObject.GridDataColumns.Contains("HoldQuantity")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].HoldQuantity)&&parseFloat(this.ScreenObject.GridData[s].HoldQuantity)>0&&(b=parseFloat(this.ScreenObject.GridData[s].HoldQuantity))):(1==D&&this.ScreenObject.GridDataColumns.Contains("RecievedQty")?!n.e.IsEmpty(this.ScreenObject.GridData[s].RecievedQty)&&parseFloat(this.ScreenObject.GridData[s].RecievedQty)>0&&(b=parseFloat(this.ScreenObject.GridData[s].RecievedQty)):!n.e.IsEmpty(this.ScreenObject.GridData[s].Quantity)&&parseFloat(this.ScreenObject.GridData[s].Quantity)>0?b=parseFloat(this.ScreenObject.GridData[s].Quantity):this.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].FreeQTY)&&parseFloat(this.ScreenObject.GridData[s].FreeQTY)>0?b=parseFloat(this.ScreenObject.GridData[s].FreeQTY):this.ScreenObject.GridDataColumns.Contains("FreeQTY")||n.e.IsEmpty(this.ScreenObject.GridData[s].Quantity)||(b=parseFloat(this.ScreenObject.GridData[s].Quantity)),this.ScreenObject.GridDataColumns.Contains("UOMConversion")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].UOMConversion)&&(b*=parseFloat(this.ScreenObject.GridData[s].UOMConversion))),t&&b>0&&this.ScreenObject.GridDataColumns.Contains("BinWise")&&"True"==this.ScreenObject.GridData[s].BinWise.toString()){let e={DimensionID:0};if(this.IsWarehouseBinwise(s,D,e)){if(!this.ScreenObject.GridDataColumns.Contains("BinStatus")){if(1==D){if(n.e.IsEmpty(this.ScreenObject.GridData[s].TOBinsXML)&&this.ScreenObject.Preferences.ContainsKey("AutoSelectBins")&&"true"==this.ScreenObject.Preferences.AutoSelectBins.toLowerCase()){let e=0;a.a.SessionManager.Preferences.ContainsKey("DimensionwiseBins")&&""!=a.a.SessionManager.Preferences.DimensionwiseBins.toString()&&(e=n.e.Int(a.a.SessionManager.Preferences.DimensionwiseBins)),this.AddToWarehouseBins(e,this.ScreenObject.GridData[s],b,!0)}if(n.e.IsEmpty(this.ScreenObject.GridData[s].TOBinsXML)&&b>0)return this.DisplayMessage=a.a.GetResource("Doc_BinsMissMatch")+" "+this.ScreenObject.GridData[s].DocSeqNo.toString(),!1;n.e.IsEmpty(this.ScreenObject.GridData[s].TOBinsXML)||C.LoadXml(this.ScreenObject.GridData[s].TOBinsXML)}else{if(n.e.IsEmpty(this.ScreenObject.GridData[s].BinsXML)&&this.ScreenObject.Preferences.ContainsKey("AutoSelectBins")&&"true"==this.ScreenObject.Preferences.AutoSelectBins.toLowerCase()&&this.AddBins(this.ScreenObject.GridData[s],!0,!1,null),n.e.IsEmpty(this.ScreenObject.GridData[s].BinsXML)&&b>0)return this.DisplayMessage=a.a.GetResource("Doc_BinsMissMatch")+" "+this.ScreenObject.GridData[s].DocSeqNo.toString(),!1;n.e.IsEmpty(this.ScreenObject.GridData[s].BinsXML)||C.LoadXml(this.ScreenObject.GridData[s].BinsXML)}if(b>0){let t=C.SelectNodes("BinsXML/Row");for(let i=0;i<t.length;i++)if(null!=t[i].attributes.Allocate.value&&""!=t[i].attributes.Allocate.value&&(S+=parseFloat(t[i].attributes.Allocate.value)),null!=t[i].attributes.Warehouse&&!n.e.IsEmpty(t[i].attributes.Warehouse.value)&&t[i].attributes.Warehouse.value!=e.DimensionID.toString())return this.DisplayMessage=a.a.GetResource("Doc_BinsMissMatch")+" "+this.ScreenObject.GridData[s].DocSeqNo.toString(),!1;if(b.ToString("N"+$)!=S.ToString("N"+$))return this.DisplayMessage=a.a.GetResource("Doc_BinsMissMatch")+" "+this.ScreenObject.GridData[s].DocSeqNo.toString(),!1}}}else 1==D?this.ScreenObject.GridData[s].TOBinsXML='<BinsXML> <Row  NodeID="1" Allocate="'+b+'" ></Row></BinsXML>':this.ScreenObject.GridData[s].BinsXML='<BinsXML> <Row  NodeID="1" Allocate="'+b+'" ></Row></BinsXML>'}if(S=0,b=0,this.ScreenObject.Preferences.ContainsKey("ExcludeHold")&&""!=this.ScreenObject.Preferences.ExcludeHold.toString()&&Object(o.j)(this.ScreenObject.Preferences.ExcludeHold)&&this.ScreenObject.GridDataColumns.Contains("HoldQuantity")&&(b=!n.e.IsEmpty(this.ScreenObject.GridData[s].HoldQuantity)&&parseFloat(this.ScreenObject.GridData[s].HoldQuantity)>0?parseFloat(this.ScreenObject.GridData[s].HoldQuantity):0),this.ScreenObject.Preferences.ContainsKey("ExcludeReserve")&&""!=this.ScreenObject.Preferences.ExcludeReserve.toString()&&Object(o.j)(this.ScreenObject.Preferences.ExcludeReserve)&&this.ScreenObject.GridDataColumns.Contains("ReserveQuantity")&&(b=!n.e.IsEmpty(this.ScreenObject.GridData[s].ReserveQuantity)&&parseFloat(this.ScreenObject.GridData[s].ReserveQuantity)>0?parseFloat(this.ScreenObject.GridData[s].ReserveQuantity):0),32==this.DocumentType){let e="",t=this.ScreenObject.ColumnSource.find(e=>e.ID==this.ScreenObject.Preferences.VarienceField);t&&(e=t.DisplayMember),""!=e&&this.ScreenObject.GridDataColumns.Contains(e)&&!n.e.IsEmpty(this.ScreenObject.GridData[s][e])&&(b=parseFloat(this.ScreenObject.GridData[s][e].toString().replace("-","")))}if(-1!=this.VoucherType||!(r||this.ScreenObject.Preferences.ContainsKey("AutoBatches")&&""!=this.ScreenObject.Preferences.AutoBatches.toString()&&Object(o.j)(this.ScreenObject.Preferences.AutoBatches))||"8"!=n.e.String(this.ScreenObject.GridData[s].Type)&&"3"!=n.e.String(this.ScreenObject.GridData[s].Type)&&"11"!=n.e.String(this.ScreenObject.GridData[s].Type)&&"12"!=n.e.String(this.ScreenObject.GridData[s].Type)||this.FillAutoBatchesforDynamic(s),t&&(!this.DonotUpdateInventory||b>0)&&!n.e.IsEmpty(this.ScreenObject.GridData[s].Type)&&5==parseInt(this.ScreenObject.GridData[s].Type)&&(!this.ScreenObject.Preferences.ContainsKey("SameBatchtoall")||"true"!=this.ScreenObject.Preferences.SameBatchtoall.toLowerCase())&&(!l||!this.ScreenObject.Preferences.ContainsKey("BatchBasedon")||""==this.ScreenObject.Preferences.BatchBasedon)&&(!n.e.IsEmpty(this.ScreenObject.GridData[s].Quantity)&&parseFloat(this.ScreenObject.GridData[s].Quantity)>0||b>0||32==this.DocumentType||this.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].FreeQTY)&&parseFloat(this.ScreenObject.GridData[s].FreeQTY)>0)){if(-1==this.VoucherType&&(this.ScreenObject.Preferences.ContainsKey("AutoBatches")&&""!=this.ScreenObject.Preferences.AutoBatches.toString()&&Object(o.j)(this.ScreenObject.Preferences.AutoBatches)&&(n.e.IsEmpty(this.ScreenObject.GridData[s].DocDetailsID)||0==parseInt(this.ScreenObject.GridData[s].DocDetailsID))||r&&n.e.IsEmpty(this.ScreenObject.GridData[s].ExtraXML))){let e=0,t=0;if(this.ScreenObject.Preferences.ContainsKey("Donotuselocation")&&""!=this.ScreenObject.Preferences.Donotuselocation&&Object(o.j)(this.ScreenObject.Preferences.Donotuselocation)){let e=this.ScreenObject._CCFields.find(e=>"dcccnid2"==e.DBColumnName.toLowerCase());e&&e instanceof m.b&&e.SelectedValue>0?t=e.SelectedValue:this.ScreenObject.GridDataColumns.Contains("dcCCNID2_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].dcCCNID2_Key)&&(t=parseInt(this.ScreenObject.GridData[s].dcCCNID2_Key))}else t=this.ScreenObject.LocationID>0?this.ScreenObject.LocationID:a.a.SessionManager.LocationID;e=this.ScreenObject.DivisionID>0?this.ScreenObject.DivisionID:a.a.SessionManager.DivisionID,0==b&&(!n.e.IsEmpty(this.ScreenObject.GridData[s].Quantity)&&parseFloat(this.ScreenObject.GridData[s].Quantity)>0&&(b=parseFloat(this.ScreenObject.GridData[s].Quantity)),this.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].FreeQTY)&&parseFloat(this.ScreenObject.GridData[s].FreeQTY)>0&&(b=parseFloat(this.ScreenObject.GridData[s].FreeQTY)),this.ScreenObject.GridDataColumns.Contains("UOMConversion")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].UOMConversion)&&(b*=parseFloat(this.ScreenObject.GridData[s].UOMConversion)));let i=new Te.a(this.ScreenObject.GridDataObj);if(i.BatchNumberViewModel_3(this,this.VoucherType,b,parseInt(this.ScreenObject.GridData[s].ProductID_Key),this.ScreenObject.GridData[s].ProductName.toString(),t,e,this.ScreenObject.GridData[s]),i.ChkFifo=!0,i.OnSave("AutoSave"),i.count>1&&this.ScreenObject.UpdateSequence(),b=0,this.ScreenObject.Preferences.ContainsKey("ExcludeHold")&&""!=this.ScreenObject.Preferences.ExcludeHold.toString()&&Object(o.j)(this.ScreenObject.Preferences.ExcludeHold)&&this.ScreenObject.GridDataColumns.Contains("HoldQuantity")&&(b=!n.e.IsEmpty(this.ScreenObject.GridData[s].HoldQuantity)&&parseFloat(this.ScreenObject.GridData[s].HoldQuantity)>0?parseFloat(this.ScreenObject.GridData[s].HoldQuantity):0),this.ScreenObject.Preferences.ContainsKey("ExcludeReserve")&&""!=this.ScreenObject.Preferences.ExcludeReserve.toString()&&Object(o.j)(this.ScreenObject.Preferences.ExcludeReserve)&&this.ScreenObject.GridDataColumns.Contains("ReserveQuantity")&&(b=!n.e.IsEmpty(this.ScreenObject.GridData[s].ReserveQuantity)&&parseFloat(this.ScreenObject.GridData[s].ReserveQuantity)>0?parseFloat(this.ScreenObject.GridData[s].ReserveQuantity):0),32==this.DocumentType){let e="",t=this.ScreenObject.ColumnSource.find(e=>e.ID==this.ScreenObject.Preferences.VarienceField);t&&(e=t.DisplayMember),""!=e&&this.ScreenObject.GridDataColumns.Contains(e)&&!n.e.IsEmpty(this.ScreenObject.GridData[s][e])&&(b=parseFloat(this.ScreenObject.GridData[s][e].toString().replace("-","")))}}if(0==b&&(!n.e.IsEmpty(this.ScreenObject.GridData[s].Quantity)&&parseFloat(this.ScreenObject.GridData[s].Quantity.toString())>0&&(b=parseFloat(this.ScreenObject.GridData[s].Quantity.toString())),this.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].FreeQTY)&&parseFloat(this.ScreenObject.GridData[s].FreeQTY.toString())>0&&(b=parseFloat(this.ScreenObject.GridData[s].FreeQTY.toString())),this.ScreenObject.GridDataColumns.Contains("UOMConversion")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].UOMConversion)&&(b*=parseFloat(this.ScreenObject.GridData[s].UOMConversion.toString()))),!l)if(n.e.IsEmpty(this.ScreenObject.GridData[s].ExtraXML)){if(32!=this.DocumentType||b>0)return this.DisplayMessage=a.a.GetResource("Doc_BatchQtyMissMatch")+" "+this.ScreenObject.GridData[s].DocSeqNo.toString(),!1}else{C.LoadXml(this.ScreenObject.GridData[s].ExtraXML);let e=C.SelectNodes("xml/Row");0==b&&(!n.e.IsEmpty(this.ScreenObject.GridData[s].Quantity)&&parseFloat(this.ScreenObject.GridData[s].Quantity)>0&&(b=parseFloat(this.ScreenObject.GridData[s].Quantity)),this.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].FreeQTY)&&parseFloat(this.ScreenObject.GridData[s].FreeQTY)>0&&(b=parseFloat(this.ScreenObject.GridData[s].FreeQTY)),this.ScreenObject.GridDataColumns.Contains("UOMConversion")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].UOMConversion)&&(b*=parseFloat(this.ScreenObject.GridData[s].UOMConversion)));for(let t=0;t<e.length;t++){if(null!=e[t].attributes.ProductID.value&&""!=e[t].attributes.ProductID.value&&!n.e.IsEmpty(this.ScreenObject.GridData[s].ProductID_Key)&&parseInt(e[t].attributes.ProductID.value)!=parseInt(this.ScreenObject.GridData[s].ProductID_Key))return this.DisplayMessage=a.a.GetResource("Doc_BatchQtyMissMatch")+" "+this.ScreenObject.GridData[s].DocSeqNo.toString(),!1;if(null!=e[t].attributes.Quantity.value&&""!=e[t].attributes.Quantity.value&&(S+=parseFloat(e[t].attributes.Quantity.value)),30==this.ScreenObject.DocumentType&&this.ScreenObject.GridDataColumns.Contains("VoucherType")&&"-1"==this.ScreenObject.GridData[s].VoucherType.toString()&&null!=e[t].attributes.Release&&null!=e[t].attributes.Release.value&&""!=e[t].attributes.Release.value)return this.DisplayMessage=a.a.GetResource("Doc_BatchQtyMissMatch")+" "+this.ScreenObject.GridData[s].DocSeqNo.toString(),!1}if(b.ToString("N"+$)!=S.ToString("N"+$))return this.DisplayMessage=a.a.GetResource("Doc_BatchQtyMissMatch")+" "+this.ScreenObject.GridData[s].DocSeqNo.toString(),!1}}if(("CheckoutPrint"==e.toString()||"CheckoutSave"==e.toString()||!t)&&null!=this.POSPayModes)if(1==V){this.POSPayModes.RedeemPoints=0,this.POSpayXml="";let t=[];if(this.POSPayModes.GridData.length>0){let e;for(let s=0;s<this.POSPayModes.GridData.length;s++){if(n.e.IsEmpty(this.POSPayModes.GridData[s].ColumnName))continue;"13"==this.POSPayModes.GridData[s].Type.toString()&&(this.POSPayModes.RedeemPoints=parseFloat(this.POSPayModes.GridData[s].Amount));let i=t.filter(e=>e.ColumnName==this.POSPayModes.GridData[s].ColumnName);0==i.length?(e={},e.Name=this.POSPayModes.GridData[s].Name.toString(),e.ColumnName=this.POSPayModes.GridData[s].ColumnName.toString(),e.Amount=this.POSPayModes.GridData[s].Amount.toString(),e.Description=n.e.StringValue(this.POSPayModes.GridData[s].Description),e.Details=this.POSPayModes.GridData[s].Details.toString(),e.Denomination=n.e.StringValue(this.POSPayModes.GridData[s].Denomination),t.push(e)):(e=i[0],e.Amount=parseFloat(e.Amount)+parseFloat(this.POSPayModes.GridData[s].Amount),e.Details=e.Details.toString()+this.POSPayModes.GridData[s].Details.toString(),e.Denomination=n.e.StringValue(e.Denomination)+n.e.StringValue(this.POSPayModes.GridData[s].Denomination))}n.e.IsEmpty(this.POSPayModes.Return)||!n.e.IsNum(this.POSPayModes.Return)||n.e.IsEmpty(this.POSPayModes.Returnfld)||(e={},e.Name=this.POSPayModes.ReturnLabel,e.ColumnName=this.POSPayModes.Returnfld,e.Amount=this.POSPayModes.Return.replace("-",""),this.POSpayXml='<XML Amount="'+e.Amount.toString()+'" DBColumnName="'+this.POSPayModes.Returnfld+'" ',this.POSpayXml+=' RegisterID="'+this.ScreenObject.RegisterNodeID+'" ',this.POSpayXml+=' ShiftID="'+this.ScreenObject.ShiftNodeID+'" ',this.POSpayXml+=' DocDate="'+this.DocumentDate.ToString("dd/MMM/yyyy")+'" ',this.POSpayXml+=' Type="12" />',e.Details=this.POSpayXml,t.push(e),this.POSpayXml="")}for(let e=0;e<t.length;e++){P+=t[e].ColumnName.toString()+"="+t[e].Amount.toString()+", ",P+="dcCalc"+t[e].ColumnName.toString().replace("dc","")+"="+t[e].Amount.toString()+", ",this.POSpayXml+=n.e.StringValue(t[e].Details),this.POSpayXml+=n.e.StringValue(t[e].Denomination);let s=new y.a,a=this.ScreenObject.Data.Tables[0].filter(s=>s.SysColumnName==t[e].ColumnName);if(s.Header=a[0].ResourceData.toString(),s.DisplayMember=a[0].SysColumnName,n.e.IsEmpty(a[0].PostingType)||(s.PostingType=parseInt(a[0].PostingType)),n.e.IsEmpty(a[0].DebitAccount)||(s.DebitAccount=parseInt(a[0].DebitAccount)),n.e.IsEmpty(a[0].CreditAccount)||(s.CreditAcount=parseInt(a[0].CreditAccount)),s.DefCreditAcount=s.CreditAcount,s.DefDebitAccount=s.DebitAccount,n.e.IsEmpty(a[0].CRSysColumnName)||(s.CrRefColName=a[0].CRSysColumnName.toString()),n.e.IsEmpty(a[0].CrRefColID)||(s.CrRefColID=parseInt(a[0].CrRefColID)),n.e.IsEmpty(a[0].CrRefID)||(s.CrRefID=parseInt(a[0].CrRefID)),n.e.IsEmpty(a[0].CRSection)||(s.CrRefSection=parseInt(a[0].CRSection)),n.e.IsEmpty(a[0].DRSysColumnName)||(s.DrRefColName=a[0].DRSysColumnName.toString()),n.e.IsEmpty(a[0].DrRefColID)||(s.DrRefColID=parseInt(a[0].DrRefColID)),n.e.IsEmpty(a[0].DrRefID)||(s.DrRefID=parseInt(a[0].DrRefID)),n.e.IsEmpty(a[0].DrSection)||(s.DrRefSection=parseInt(a[0].DrSection)),!(i||3!=s.PostingType&&4!=s.PostingType||n.e.IsEmpty(t[e].Amount)||0==parseFloat(t[e].Amount))){let i={DBAcc:0,CrACC:0,PostingXml:""};if(!this.FillAccountPosting(s,this.ScreenObject.GridData[0],t[e].Amount.toString(),1,1,i))return!1;T+=i.PostingXml,this.ScreenObject.FillBillWiseDt(this.BillWisedt,this.BillWisedtColumns,i.CrACC.toString(),t[e].Amount.toString(),!0,1,1,1,s.DecimalPoints),this.ScreenObject.FillBillWiseDt(this.BillWisedt,this.BillWisedtColumns,i.DBAcc.toString(),t[e].Amount.toString(),!1,1,1,1,s.DecimalPoints)}}this.ScreenObject.DocID>0&&(this.POSPayModes.PayModes.forEach(e=>{P.toString().Contains(e.DBColumnName)||(P+=e.DBColumnName+"=0, ",P+="dcCalc"+e.DBColumnName.replace("dc","")+"=0, ")}),n.e.IsEmpty(this.POSPayModes.Returnfld)||P.toString().Contains(this.POSPayModes.Returnfld)||(P+=this.POSPayModes.Returnfld+"=0, ",P+="dcCalc"+this.POSPayModes.Returnfld.replace("dc","")+"=0, ")),this.POSpayXml.length>0&&(this.POSpayXml="<PosPayModes>"+this.POSpayXml+"</PosPayModes>"),e="CheckoutPrint"==e.toString()?"SaveAndPrint":"Save"}else this.ScreenObject.DocID>0&&(this.POSPayModes.PayModes.forEach(e=>{P+=e.DBColumnName+"=0, ",P+="dcCalc"+e.DBColumnName.replace("dc","")+"=0, "}),n.e.IsEmpty(this.POSPayModes.Returnfld)||P.toString().Contains(this.POSPayModes.Returnfld)||(P+=this.POSPayModes.Returnfld+"=0, ",P+="dcCalc"+this.POSPayModes.Returnfld.replace("dc","")+"=0, "));let p,g,O=!1;for(let r=0;r<this.ScreenObject.ColumnSource.length;r++){if(p=this.ScreenObject.ColumnSource[r].DisplayMember,p.toLowerCase().Contains("exchangerate")||"AppRemarks"==p||"FreeQTY"==p||p.toLowerCase().Contains("currencyid")||this.ScreenObject.ColumnSource[r].CostCenterID>0&&p.endsWith("Code"))continue;g=p,"RefNo"==p&&(g="RefNO");let l=this.GetCurrencyID(s),h=this.GetExchRate(s);if(t&&this.ScreenObject.ColumnSource[r].Mandatory&&!n.e.IsEmpty(this.ScreenObject.GridData[s].Type)&&8!=parseInt(this.ScreenObject.GridData[s].Type)&&!c){if(0!=this.ScreenObject.ColumnSource[r].CostCenterID&&"SELECTIONBOX"!=this.ScreenObject.ColumnSource[r].DataType&&(n.e.IsEmpty(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[r].ValueMember])||parseInt(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[r].ValueMember])<1&&(3!=this.ScreenObject.ColumnSource[r].CostCenterID||"8"!=this.ScreenObject.GridData[s].Type.toString())))return this.DisplayMessage=a.a.GetResource("Doc_Select")+this.ScreenObject.ColumnSource[r].Header+" "+this.ScreenObject.GridData[s].DocSeqNo,!1;if("ComboBox"==this.ScreenObject.ColumnSource[r].DataType&&n.e.IsEmpty(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[r].ValueBinding]))return this.DisplayMessage=a.a.GetResource("Doc_Select")+this.ScreenObject.ColumnSource[r].Header+" "+this.ScreenObject.GridData[s].DocSeqNo.toString(),!1;if("PactComboBox"==this.ScreenObject.ColumnSource[r].DataType&&n.e.IsEmpty(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[r].ValueBinding+"_Key"]))return this.DisplayMessage=a.a.GetResource("Doc_Select")+this.ScreenObject.ColumnSource[r].Header+" "+this.ScreenObject.GridData[s].DocSeqNo.toString(),!1;if("LINK"==this.ScreenObject.ColumnSource[r].DataType&&p.toLowerCase().Contains("dcalpha")){if(null==this.ViewAttachments.AttachmentsList.find(e=>e.RowID==this.ScreenObject.GridData[s]&&e.ColID==p))return this.DisplayMessage=a.a.GetResource("Doc_Select")+this.ScreenObject.ColumnSource[r].Header+" "+this.ScreenObject.GridData[s].DocSeqNo.toString(),!1}else if("PactComboBox"!=this.ScreenObject.ColumnSource[r].DataType&&"ComboBox"!=this.ScreenObject.ColumnSource[r].DataType&&"LISTBOX"!=this.ScreenObject.ColumnSource[r].DataType&&(n.e.IsEmpty(this.ScreenObject.GridData[s][p])||"FLOAT"==this.ScreenObject.ColumnSource[r].DataType&&!n.e.IsEmpty(this.ScreenObject.GridData[s][p])&&0==parseFloat(this.ScreenObject.GridData[s][p])))return this.DisplayMessage=a.a.GetResource("Doc_Enter")+this.ScreenObject.ColumnSource[r].Header+" "+this.ScreenObject.GridData[s].DocSeqNo.toString(),!1}if(this.ScreenObject.IsPayrollDocument){if(t&&!this.ValidateDataonSave_col_dr(this.ScreenObject.ColumnSource[r],this.ScreenObject.GridData[s]))return!1}else if(t&&!n.e.IsEmpty(this.ScreenObject.GridData[s].Type)&&8!=parseInt(this.ScreenObject.GridData[s].Type)&&!this.ValidateDataonSave_col_dr(this.ScreenObject.ColumnSource[r],this.ScreenObject.GridData[s]))return!1;if("FillGUID"!=this.ScreenObject.ColumnSource[r].DistributeColName||!n.e.IsEmpty(this.ScreenObject.GridData[s].DocDetailsID)&&parseInt(this.ScreenObject.GridData[s].DocDetailsID)>0||(this.ScreenObject.GridData[s][p]=n.e.NewGuid()),this.ScreenObject.ColumnSource[r].IsColumnUserDefined){if(56671==this.ScreenObject.ColumnSource[r].linkData||p.toLowerCase().Contains("dcexchrt")||p.toLowerCase().Contains("dccurrid"))continue;if(p.toLowerCase().Contains("dcnum")){if(this.ScreenObject.Preferences.ContainsKey("JobRemainingQty")&&this.ScreenObject.GridDataColumns.Contains("RemQty")&&p.toLowerCase()==this.ScreenObject.Preferences.JobRemainingQty.toLowerCase())continue;if(a.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(o.j)(a.a.SessionManager.Preferences["Use Foreign Currency"]))if("-2"==this.ScreenObject.ColumnSource[r].DefaultValue)if(4==this.ScreenObject.ColumnSource[r].SectionID){let e=this.ScreenObject.FooterGridData.filter(e=>e.ColumnName==p);e.length>0&&(n.e.IsEmpty(e[0].dcCurrID_Key)||(l=parseInt(e[0].dcCurrID_Key),h=n.e.IsEmpty(e[0].dcExchRT)?1:parseFloat(e[0].dcExchRT)))}else n.e.IsEmpty(this.ScreenObject.GridData[s]["dcCurrID"+p.toLowerCase().replace("dcnum","")+"_Key"])||(l=parseInt(this.ScreenObject.GridData[s]["dcCurrID"+p.toLowerCase().replace("dcnum","")+"_Key"])),n.e.IsEmpty(this.ScreenObject.GridData[s]["dcExchRT"+p.toLowerCase().replace("dcnum","")])||(h=parseFloat(this.ScreenObject.GridData[s]["dcExchRT"+p.toLowerCase().replace("dcnum","")]));else n.e.Int(this.ScreenObject.ColumnSource[r].DefaultValue)>0&&this.ScreenObject.ColumnSource[r].CurrID>0&&(l=this.ScreenObject.ColumnSource[r].CurrID,h=this.ScreenObject.ColumnSource[r].ExhcgRt);let e=0;this.savebulk?n.e.IsEmpty(this.ScreenObject.GridData[s][p])||(P+=p+'="'+this.ScreenObject.GridData[s][p].toString()+'" ',e=0,e=n.e.Double(this.ScreenObject.GridData[s]["dcCalc"+p]),a.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(o.j)(a.a.SessionManager.Preferences["Use Foreign Currency"])&&(P+="dcCurrID"+p.toLowerCase().Replace("dcnum","")+'="'+l+'" ',P+="dcExchRT"+p.toLowerCase().Replace("dcnum","")+'="'+h+'" ',P+="dcCalcNumFC"+p.toLowerCase().Replace("dcnum","")+'="'+e+'" '),P+="dcCalc"+p.Replace("dc","")+'="'+e*h+'" '):(n.e.IsEmpty(this.ScreenObject.GridData[s][p])?P+=p+"=0, ":P+=p+"="+this.ScreenObject.GridData[s][p].toString()+", ",e=0,e=n.e.Double(this.ScreenObject.GridData[s]["dcCalc"+p]),a.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(o.j)(a.a.SessionManager.Preferences["Use Foreign Currency"])&&(P+="dcCurrID"+p.toLowerCase().Replace("dcnum","")+"="+l+", ",P+="dcExchRT"+p.toLowerCase().Replace("dcnum","")+"="+h+", ",P+="dcCalcNumFC"+p.toLowerCase().Replace("dcnum","")+"="+e+", "),P+="dcCalc"+p.Replace("dc","")+"="+e*h+", ")}else if("Name"==p||"Year"==p||p.toLowerCase().Contains("dcalpha")||"PactComboBox"==this.ScreenObject.ColumnSource[r].DataType&&this.ScreenObject.ColumnSource[r].ValueBinding.toLowerCase().Contains("dcalpha")){let e={sbText:A};this.GetRowValue(e,s,r),A=e.sbText,"DATE"==this.ScreenObject.ColumnSource[r].DataType&&n.e.hasprop(this.ScreenObject.GridData[s],this.ScreenObject.ColumnSource[r].DisplayMember+"_Key")&&""!=this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[r].DisplayMember+"_Key"].toString()&&this.ScreenObject.Preferences.ContainsKey("BUDGET_BudgetDateField")&&!n.e.IsEmpty(this.ScreenObject.Preferences.BUDGET_BudgetDateField)&&this.ScreenObject.ColumnSource[r].DisplayMember==this.ScreenObject.Preferences.BUDGET_BudgetDateField&&(j+=this.ScreenObject.ColumnSource[r].DisplayMember+'="'+new Date(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[r].DisplayMember+"_Key"].toString()).ToString("dd/MMM/yyyy")+'" '),"LISTBOX"==this.ScreenObject.ColumnSource[r].DataType&&0!=this.ScreenObject.ColumnSource[r].CostCenterID&&this.ScreenObject.Preferences.ContainsKey("BUDGET_BudgetAccountField")&&!n.e.IsEmpty(this.ScreenObject.Preferences.BUDGET_BudgetAccountField)&&this.ScreenObject.ColumnSource[r].DisplayMember==this.ScreenObject.Preferences.BUDGET_BudgetAccountField&&(j+=this.ScreenObject.ColumnSource[r].DisplayMember+'="'+this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[r].ValueMember].toString()+'" ')}else 0!=this.ScreenObject.ColumnSource[r].CostCenterID?5==this.ScreenObject.DocumentType&&1==D?this.ScreenObject.ColumnSource[r].DisplayMember.Contains("TO")&&!n.e.IsEmpty(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[r].ValueMember])&&parseInt(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[r].ValueMember])>0?M+=this.ScreenObject.ColumnSource[r].DisplayMember.replace("TO","")+"="+this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[r].ValueMember].toString()+", ":this.ScreenObject.ColumnSource[r].DisplayMember.Contains("TO")||!this.ScreenObject.ColumnSource.find(e=>e.DisplayMember=="TO"+this.ScreenObject.ColumnSource[r].DisplayMember)&&!n.e.IsEmpty(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[r].ValueMember])&&parseInt(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[r].ValueMember])>0&&(M+=this.ScreenObject.ColumnSource[r].DisplayMember+"="+this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[r].ValueMember].toString()+", "):5==this.ScreenObject.DocumentType&&0==D&&!this.ScreenObject.ColumnSource[r].DisplayMember.Contains("TO")&&!n.e.IsEmpty(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[r].ValueMember])&&parseInt(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[r].ValueMember])>0?M+=this.ScreenObject.ColumnSource[r].DisplayMember+"="+this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[r].ValueMember].toString()+", ":5!=this.ScreenObject.DocumentType&&(!n.e.IsEmpty(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[r].ValueMember])&&parseInt(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[r].ValueMember])>0?M+=this.savebulk?this.ScreenObject.ColumnSource[r].DisplayMember+'="'+this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[r].ValueMember].toString()+'" ':this.ScreenObject.ColumnSource[r].DisplayMember+"="+this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[r].ValueMember].toString()+", ":this.savebulk||(M+=this.ScreenObject.ColumnSource[r].DisplayMember+"=1, ")):this.savebulk||(A+=this.ScreenObject.ColumnSource[r].DisplayMember+"=N'"+u.d.GetValidTextXml(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[r].DisplayMember])+"', ")}else 3==this.ScreenObject.ColumnSource[r].CostCenterID?(O||(j+='ProductID="'+this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[r].ValueMember].toString()+'" '),O=!0):0!=this.ScreenObject.ColumnSource[r].CostCenterID?(!n.e.IsEmpty(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[r].ValueMember])&&parseInt(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[r].ValueMember])>0&&"CurrencyID"!=this.ScreenObject.ColumnSource[r].DisplayMember&&(j+=this.ScreenObject.ColumnSource[r].ValueMember.substr(0,this.ScreenObject.ColumnSource[r].ValueMember.length-4)+'="'+this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[r].ValueMember].toString()+'" '),"unit"==this.ScreenObject.ColumnSource[r].DisplayMember.toLowerCase()&&(this.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].FreeQTY)&&parseFloat(this.ScreenObject.GridData[s].FreeQTY)>0&&(this.ScreenObject.GridData[s].UOMConvertedQty=n.e.IsEmpty(this.ScreenObject.GridData[s].UOMConversion)?this.ScreenObject.GridData[s].FreeQTY.toString():parseFloat(this.ScreenObject.GridData[s].FreeQTY)*parseFloat(this.ScreenObject.GridData[s].UOMConversion)),j+='UOMConversion="'+this.ScreenObject.GridData[s].UOMConversion.toString()+'" ',5==this.ScreenObject.DocumentType&&1==D&&this.ScreenObject.GridDataColumns.Contains("RecievedQty")?n.e.IsEmpty(this.ScreenObject.GridData[s].RecievedQty)?j+='UOMConvertedQty="0" ':n.e.IsEmpty(this.ScreenObject.GridData[s].UOMConversion)?j+='UOMConvertedQty="'+this.ScreenObject.GridData[s].RecievedQty.toString()+'" ':j+='UOMConvertedQty="'+parseFloat(this.ScreenObject.GridData[s].UOMConversion)*parseFloat(this.ScreenObject.GridData[s].RecievedQty)+'" ':38==this.ScreenObject.DocumentType&&!n.e.IsEmpty(this.ScreenObject.GridData[s].Quantity)&&parseFloat(this.ScreenObject.GridData[s].Quantity)<0?j+='UOMConvertedQty="'+this.ScreenObject.GridData[s].UOMConvertedQty.toString().replace("-","")+'" ':j+='UOMConvertedQty="'+this.ScreenObject.GridData[s].UOMConvertedQty.toString()+'" ')):"DocDetailsID"==this.ScreenObject.ColumnSource[r].DisplayMember?5==this.ScreenObject.DocumentType&&1==D?(!n.e.IsEmpty(this.ScreenObject.GridData[s].TODocDetailsID)&&(parseInt(this.ScreenObject.GridData[s].TODocDetailsID)>0||parseInt(this.ScreenObject.GridData[s].TODocDetailsID)<-1e4)&&(te+="~"+this.ScreenObject.GridData[s].TODocDetailsID.toString()),n.e.IsEmpty(this.ScreenObject.GridData[s].TODocDetailsID)?j+=' DocDetailsID="0" ':j+=' DocDetailsID="'+this.ScreenObject.GridData[s].TODocDetailsID.toString()+'" '):(!n.e.IsEmpty(this.ScreenObject.GridData[s].DocDetailsID)&&(parseInt(this.ScreenObject.GridData[s].DocDetailsID)>0||parseInt(this.ScreenObject.GridData[s].DocDetailsID)<-1e4)&&(te+="~"+this.ScreenObject.GridData[s].DocDetailsID.toString()),null==this.ScreenObject.GridData[s].DocDetailsID&&(this.ScreenObject.GridData[s].DocDetailsID=0),j+=' DocDetailsID="'+this.ScreenObject.GridData[s].DocDetailsID+'" ',this.savebulk&&(M+=' DocDetailsID="'+this.ScreenObject.GridData[s].DocDetailsID+'" ',A+=' DocDetailsID="'+this.ScreenObject.GridData[s].DocDetailsID+'" ',P+=' DocDetailsID="'+this.ScreenObject.GridData[s].DocDetailsID+'" ')):"ComboBox"==this.ScreenObject.ColumnSource[r].DataType?j+=this.ScreenObject.ColumnSource[r].ValueBinding+'="'+u.d.GetValidXml(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[r].ValueBinding])+'" ':"quantity"==this.ScreenObject.ColumnSource[r].DisplayMember.toLowerCase()?5==this.ScreenObject.DocumentType&&1==D&&this.ScreenObject.GridDataColumns.Contains("RecievedQty")?n.e.IsEmpty(this.ScreenObject.GridData[s].RecievedQty)?j+=this.ScreenObject.ColumnSource[r].DisplayMember+'="0" ':j+=this.ScreenObject.ColumnSource[r].DisplayMember+'="'+u.d.GetValidXml(this.ScreenObject.GridData[s].RecievedQty)+'" ':!n.e.IsEmpty(this.ScreenObject.GridData[s].SchemeID)&&parseInt(this.ScreenObject.GridData[s].SchemeID)>0&&this.ScreenObject.GridDataColumns.Contains("FreeQTY")&&"Y"==this.ScreenObject.GridData[s].IsScheme.toString()?j+=this.ScreenObject.ColumnSource[r].DisplayMember+'="'+u.d.GetValidXml(this.ScreenObject.GridData[s].FreeQTY)+'" ':38==this.ScreenObject.DocumentType&&!n.e.IsEmpty(this.ScreenObject.GridData[s].Quantity)&&parseFloat(this.ScreenObject.GridData[s].Quantity)<0?(j+=this.ScreenObject.ColumnSource[r].DisplayMember+'="'+this.ScreenObject.GridData[s].Quantity.toString().replace("-","")+'" ',j+=' VoucherType="1" '):j+=this.ScreenObject.ColumnSource[r].DisplayMember+'="'+u.d.GetValidXml(this.ScreenObject.GridData[s].Quantity)+'" ':"DATE"==this.ScreenObject.ColumnSource[r].DataType?n.e.IsEmpty(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[r].DisplayMember+"_Key"])||(j+=this.ScreenObject.ColumnSource[r].DisplayMember+'="'+new Date(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[r].DisplayMember+"_Key"]).ToString("dd/MMM/yyyy")+'" '):"DocSeqNo"==this.ScreenObject.ColumnSource[r].DisplayMember?(this.ScreenObject.GridData[s].DocSeqNo=V,j+=this.ScreenObject.ColumnSource[r].DisplayMember+'="'+V+'" ',this.savebulk&&(A+=this.ScreenObject.ColumnSource[r].DisplayMember+'="'+V+'" ',P+=this.ScreenObject.ColumnSource[r].DisplayMember+'="'+V+'" ',M+=this.ScreenObject.ColumnSource[r].DisplayMember+'="'+V+'" ')):(38==this.ScreenObject.DocumentType&&!n.e.IsEmpty(this.ScreenObject.GridData[s].Quantity)&&parseFloat(this.ScreenObject.GridData[s].Quantity)<0&&"gross"==p.toLowerCase()?j+=g+'="'+this.ScreenObject.GridData[s][p].toString().replace("-","")+'" ':j+=g+'="'+u.d.GetValidXml(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[r].DisplayMember])+'" ',null!=e&&"SaveonHold"==e.toString()&&"quantity"==p.toLowerCase()&&(this.ScreenObject.ColumnSource.find(e=>"holdquantity"==e.DisplayMember.toLowerCase())||(j+='HoldQuantity="'+u.d.GetValidXml(this.ScreenObject.GridData[s][p])+'" ')));let d="";if("ComboBox"!=this.ScreenObject.ColumnSource[r].DataType&&this.ScreenObject.ColumnSource[r].PostingType>0&&(d=n.e.String(this.ScreenObject.GridData[s][p])),p.toLowerCase().Contains("dcnum")&&(d=n.e.String(this.ScreenObject.GridData[s]["dcCalc"+this.ScreenObject.ColumnSource[r].DisplayMember])),(5==this.DocumentType&&0==D&&2==this.ScreenObject.ColumnSource[r].Dependancy||5==this.DocumentType&&1==D&&3==this.ScreenObject.ColumnSource[r].Dependancy)&&(d=""),!this.ScreenObject.Preferences.ContainsKey("KitAccPosting")||"True"!=this.ScreenObject.Preferences.KitAccPosting||"8"!=n.e.String(this.ScreenObject.GridData[s].Type)&&"3"!=n.e.String(this.ScreenObject.GridData[s].Type)&&"11"!=n.e.String(this.ScreenObject.GridData[s].Type)&&"12"!=n.e.String(this.ScreenObject.GridData[s].Type)||(d=""),null==e||"SaveonHold"==e.toString()||i||3!=this.ScreenObject.ColumnSource[r].PostingType&&4!=this.ScreenObject.ColumnSource[r].PostingType||""==d||0==n.e.Double(d))4==this.ScreenObject.ColumnSource[r].SectionID&&(""!=this.ScreenObject.ColumnSource[r].Remarks||this.ScreenObject.ColumnSource[r].CreditAcount>0||this.ScreenObject.ColumnSource[r].DebitAccount>0)&&(n.e.IsEmpty(G)&&(G+="<XML>"),G+="<Row ",this.ScreenObject.ColumnSource[r].CreditAcount>0&&(G+=' CreditAcount="'+this.ScreenObject.ColumnSource[r].CreditAcount+'"'),this.ScreenObject.ColumnSource[r].DebitAccount>0&&(G+=' DebitAccount="'+this.ScreenObject.ColumnSource[r].DebitAccount+'"'),G+=' Columnname="'+this.ScreenObject.ColumnSource[r].DisplayMember+'"',G+=' Remarks="'+u.d.GetValidXml(this.ScreenObject.ColumnSource[r].Remarks)+'" />');else{let e={DBAcc:0,CrACC:0,PostingXml:""};if(!this.FillAccountPosting(this.ScreenObject.ColumnSource[r],this.ScreenObject.GridData[s],d,l,h,e,0,V))return!1;let t=e.DBAcc,i=e.CrACC;if(null!=ne||this.ScreenObject.ColumnSource[r].distDim>0){let a={CostXML:""};this.FillCostPosting(t,i,parseFloat(d),this.ScreenObject.GridData[s],ne,l,h,this.ScreenObject.ColumnSource[r],a)?se+=a.CostXML:T+=e.PostingXml,this.ScreenObject.FillBillWiseDt(this.BillWisedt,this.BillWisedtColumns,e.CrACC.toString(),d,!0,l,h,D,this.ScreenObject.ColumnSource[r].NoRoundOff?"6":this.ScreenObject.ColumnSource[r].DecimalPoints,V),this.ScreenObject.FillBillWiseDt(this.BillWisedt,this.BillWisedtColumns,e.DBAcc.toString(),d,!1,l,h,D,this.ScreenObject.ColumnSource[r].NoRoundOff?"6":this.ScreenObject.ColumnSource[r].DecimalPoints,V)}else!ae||re!=i&&re!=t||oe!=i&&oe!=t?!this.ScreenObject.Preferences.ContainsKey("DistributeCost")||"True"!=this.ScreenObject.Preferences.DistributeCost.toString()||re!=e.CrACC&&re!=e.DBAcc?(T+=e.PostingXml,this.ScreenObject.FillBillWiseDt(this.BillWisedt,this.BillWisedtColumns,e.CrACC.toString(),d,!0,l,h,D,this.ScreenObject.ColumnSource[r].NoRoundOff?"6":this.ScreenObject.ColumnSource[r].DecimalPoints,V),this.ScreenObject.FillBillWiseDt(this.BillWisedt,this.BillWisedtColumns,e.DBAcc.toString(),d,!1,l,h,D,this.ScreenObject.ColumnSource[r].NoRoundOff?"6":this.ScreenObject.ColumnSource[r].DecimalPoints,V)):re==e.CrACC?(0==this.ScreenObject.DocID&&(this.ScreenObject.DistributeCostXML+='<Row AccountID="'+e.DBAcc.toString()+'" Amount="'+d+'" />'),this.ScreenObject.FillBillWiseDt(this.BillWisedt,this.BillWisedtColumns,e.CrACC.toString(),d,!0,l,h,D,this.ScreenObject.ColumnSource[r].NoRoundOff?"6":this.ScreenObject.ColumnSource[r].DecimalPoints,V)):(0==this.ScreenObject.DocID&&(this.ScreenObject.DistributeCostXML+='<Row AccountID="'+e.CrACC.toString()+'" Amount="'+d+'" />'),this.ScreenObject.FillBillWiseDt(this.BillWisedt,this.BillWisedtColumns,e.DBAcc.toString(),d,!1,l,h,D,this.ScreenObject.ColumnSource[r].NoRoundOff?"6":this.ScreenObject.ColumnSource[r].DecimalPoints,V)):re==i?this.ScreenObject.FillBillWiseDt(this.BillWisedt,this.BillWisedtColumns,e.CrACC.toString(),d,!0,l,h,D,this.ScreenObject.ColumnSource[r].NoRoundOff?"6":this.ScreenObject.ColumnSource[r].DecimalPoints,V):this.ScreenObject.FillBillWiseDt(this.BillWisedt,this.BillWisedtColumns,e.DBAcc.toString(),d,!1,l,h,D,this.ScreenObject.ColumnSource[r].NoRoundOff?"6":this.ScreenObject.ColumnSource[r].DecimalPoints,V);4!=this.ScreenObject.ColumnSource[r].SectionID||""==this.ScreenObject.ColumnSource[r].Remarks&&this.ScreenObject.ColumnSource[r].CreditAcount!=e.CrACC&&this.ScreenObject.ColumnSource[r].DebitAccount!=e.DBAcc||(n.e.IsEmpty(G)&&(G+="<XML>"),G+="<Row ",this.ScreenObject.ColumnSource[r].CreditAcount==e.CrACC&&(G+=' CreditAcount="'+e.CrACC+'"'),this.ScreenObject.ColumnSource[r].DebitAccount==e.DBAcc&&(G+=' DebitAccount="'+e.DBAcc+'"'),G+=' Columnname="'+this.ScreenObject.ColumnSource[r].DisplayMember+'"',G+=' Remarks="'+u.d.GetValidXml(this.ScreenObject.ColumnSource[r].Remarks)+'" />')}if(2!=this.ScreenObject.ColumnSource[r].PostingType&&4!=this.ScreenObject.ColumnSource[r].PostingType||0==n.e.Double(d)||(B+=parseFloat(d)*h),3!=this.ScreenObject.ColumnSource[r].PostingType&&4!=this.ScreenObject.ColumnSource[r].PostingType||0==n.e.Double(d)||(_+=parseFloat(d)*h),this.ScreenObject.ColumnSource[r].distDim>0){let e=new n.f;this.ScreenObject.ColumnSource[r].distLineWise&&!n.e.IsEmpty(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[r].DisplayMember+"DistXML"])?e.LoadXml(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[r].DisplayMember+"DistXML"].toString()):n.e.IsEmpty(this.ScreenObject.ColumnSource[r].distxml)||e.LoadXml(this.ScreenObject.ColumnSource[r].distxml);let t=e.SelectNodes("XML/Rows");for(let s=0;s<t.length;s++)n.e.IsEmpty(t[s].attributes.Percent)||n.e.IsEmpty(t[s].attributes["DCCCNID"+(this.ScreenObject.ColumnSource[r].distDim-5e4)])||(E+='<DocExtraXML><Row  RefID="'+t[s].attributes["DCCCNID"+(this.ScreenObject.ColumnSource[r].distDim-5e4)].value+'" ',E+=' Label="'+this.ScreenObject.ColumnSource[r].DisplayMember,E+='" Qty="'+t[s].attributes.Percent.value,E+='"  Type="50"  ></Row></DocExtraXML>')}}this.ScreenObject.Preferences.ContainsKey("JobRemainingQty")&&this.ScreenObject.GridDataColumns.Contains("RemQty")&&(n.e.IsEmpty(this.ScreenObject.GridData[s].RemQty)?(P+="dcCalc"+this.ScreenObject.Preferences.JobRemainingQty.Replace("dc","")+"=0,",P+=this.ScreenObject.Preferences.JobRemainingQty+"=0,"):(P+="dcCalc"+this.ScreenObject.Preferences.JobRemainingQty.Replace("dc","")+"="+this.ScreenObject.GridData[s].RemQty.toString().Replace(",","")+", ",P+=this.ScreenObject.Preferences.JobRemainingQty+"="+this.ScreenObject.GridData[s].RemQty.toString().Replace(",","")+", ")),n.e.IsEmpty(this.ScreenObject.GridData[s].LinkedFieldName)||n.e.IsEmpty(this.ScreenObject.GridData[s].LinkedInvDocDetailsID)||!n.e.IsValidID(parseInt(this.ScreenObject.GridData[s].LinkedInvDocDetailsID))||0!=D||("quantity"==this.ScreenObject.GridData[s].LinkedFieldName.toString().toLowerCase()&&this.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].FreeQTY)&&parseFloat(this.ScreenObject.GridData[s].FreeQTY)>0?j+='LinkedFieldValue="'+this.ScreenObject.GridData[s].FreeQTY.toString()+'" ':j+='LinkedFieldValue="'+this.ScreenObject.GridData[s][this.ScreenObject.GridData[s].LinkedFieldName.toString()].toString()+'" '),null!=e&&"SaveonHold"==e.toString()||this.DonotUpdateInventory||!n.e.IsEmpty(this.ScreenObject.GridData[s].Type)&&(6==parseInt(this.ScreenObject.GridData[s].Type)||8==parseInt(this.ScreenObject.GridData[s].Type)||3==parseInt(this.ScreenObject.GridData[s].Type)||11==parseInt(this.ScreenObject.GridData[s].Type))||this.ScreenObject.Preferences.ContainsKey("StockBasedon")&&this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.Preferences.StockBasedon)&&"1"!=this.ScreenObject.GridData[s][this.ScreenObject.Preferences.StockBasedon].toString()||this.DonotUpdateSchemeQty&&this.ScreenObject.GridDataColumns.Contains("FreeQTY")&&n.e.Double(this.ScreenObject.GridData[s].FreeQTY)>0?j+=' IsQtyIgnored="1" ':this.ScreenObject.Preferences.ContainsKey("ConsBatch")&&"True"==this.ScreenObject.Preferences.ConsBatch&&"5"==this.ScreenObject.GridData[s].Type.toString()?j+=' IsQtyIgnored="1" BatchQtyIgnored="0" ':j+=' IsQtyIgnored="0" ',j+='AverageRate="'+n.e.String(this.ScreenObject.GridData[s].AVGRATE)+'" ',this.ScreenObject.GridDataColumns.Contains("ParentSeqNo")&&(j+='ParentSeqNo="'+this.ScreenObject.GridData[s].ParentSeqNo.toString()+'" '),38==this.ScreenObject.DocumentType&&!n.e.IsEmpty(this.ScreenObject.GridData[s].Quantity)&&parseFloat(this.ScreenObject.GridData[s].Quantity)<0&&(B*=-1),j+='StockValue="'+B.toString()+'" ',j+='Net="'+this.NetAmount.Replace(",","")+'" ',j+=null!=this.Currency&&null!=this.Currency.ExchangeRate.Text&&""!=this.Currency.ExchangeRate.Text?'StockValueFC="'+B/parseFloat(this.Currency.ExchangeRate.Text)+'" ':'StockValueFC="'+B+'" ';let I=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&56671==e.LinkData);if(I.length>0&&(B/=parseFloat(this.ScreenObject.GridData[s].UOMConvertedQty),a.a.SessionManager.Preferences.ContainsKey("DecimalsinAmount")&&""!=a.a.SessionManager.Preferences.DecimalsinAmount&&(B=parseFloat(B.ToString("N"+a.a.SessionManager.Preferences.DecimalsinAmount))),I[0].SysColumnName.toLowerCase().Contains("dcnum")?P+=this.savebulk?I[0].SysColumnName+'="'+B+'" dcCalc'+I[0].SysColumnName.replace("dc","")+'="'+B+'" ':I[0].SysColumnName+"="+B+",dcCalc"+I[0].SysColumnName.replace("dc","")+"="+B+", ":A+=this.savebulk?I[0].SysColumnName+'="'+B+'" ':I[0].SysColumnName+"='"+B+"', ",this.ScreenObject.GridDataColumns.Contains(I[0].SysColumnName)&&(this.ScreenObject.GridData[s][I[0].SysColumnName]=B),this.ScreenObject.GridDataColumns.Contains("dcCalc"+I[0].SysColumnName)&&(this.ScreenObject.GridData[s]["dcCalc"+I[0].SysColumnName]=B)),j+=null!=this.Currency&&null!=this.Currency.Currency.SelectedValue&&""!=this.Currency.Currency.SelectedValue?'CurrencyID="'+this.Currency.Currency.SelectedValue.toString()+'" ':'CurrencyID="'+this.GetCurrencyID(s)+'" ',j+=null!=this.Currency&&null!=this.Currency.ExchangeRate.Text&&""!=this.Currency.ExchangeRate.Text?'ExchangeRate="'+this.Currency.ExchangeRate.Text.toString()+'" ':'ExchangeRate="'+this.GetExchRate(s)+'" ',3!=this.ScreenObject.DocumentType&&8!=this.ScreenObject.DocumentType&&13!=this.ScreenObject.DocumentType||(3==this.ScreenObject.DocumentType?(j.toString().Contains("DebitAccount=")||this.ScreenObject.strStaticFields.Contains("DebitAccount=")||(j+='DebitAccount="'+a.a.SessionManager.ReservedOSAccount+'" '),j.toString().Contains("CreditAccount=")||this.ScreenObject.strStaticFields.Contains("CreditAccount=")||(j+=' CreditAccount="'+a.a.SessionManager.ReservedOSAccount+'" ')):13==this.ScreenObject.DocumentType?(j.toString().Contains("DebitAccount=")||this.ScreenObject.strStaticFields.Contains("DebitAccount=")||(j+='DebitAccount="'+a.a.SessionManager.ReservedESAccount+'" '),j.toString().Contains("CreditAccount=")||this.ScreenObject.strStaticFields.Contains("CreditAccount=")||(j+=' CreditAccount="'+a.a.SessionManager.ReservedESAccount+'" ')):8==this.ScreenObject.DocumentType&&(j.toString().Contains("DebitAccount=")||this.ScreenObject.strStaticFields.Contains("DebitAccount=")||(j+='DebitAccount="'+a.a.SessionManager.ReservedSSAccount+'" '),j.toString().Contains("CreditAccount=")||this.ScreenObject.strStaticFields.Contains("CreditAccount=")||(j+=' CreditAccount="'+a.a.SessionManager.ReservedSSAccount+'" '))),P+=this.ScreenObject.strnumericFields,this.savebulk?P+=" >":(P+='" >',n.e.IsEmpty(G)||(G+="</XML>",P+=G.toString())),P+="</Numeric>",A+=this.savebulk?this.ScreenObject.strTextFields+" ></Alpha>":this.ScreenObject.strTextFields+'" ></Alpha>',!a.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")||"True"!=a.a.SessionManager.Preferences.EnableDivisionWise.toString()||M.toString().Contains("dcCCNID1=")||this.ScreenObject.strCCFields.Contains("dcCCNID1=")||(this.savebulk?this.ScreenObject.DivisionID>0?M+=' dcCCNID1=" '+this.ScreenObject.DivisionID.toString()+'" ':a.a.SessionManager.DivisionID>0&&(M+=' dcCCNID1=" '+a.a.SessionManager.DivisionID.toString()+'" '):this.ScreenObject.DivisionID>0?M+=" dcCCNID1="+this.ScreenObject.DivisionID.toString()+", ":a.a.SessionManager.DivisionID>0&&(M+=" dcCCNID1="+a.a.SessionManager.DivisionID.toString()+", ")),!a.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")||"True"!=a.a.SessionManager.Preferences.EnableLocationWise.toString()||M.toString().Contains("dcCCNID2=")||this.ScreenObject.strCCFields.Contains("dcCCNID2=")||(this.savebulk?this.ScreenObject.DivisionID>0?M+=' dcCCNID2=" '+this.ScreenObject.LocationID.toString()+'" ':a.a.SessionManager.DivisionID>0&&(M+=' dcCCNID2=" '+a.a.SessionManager.LocationID.toString()+'" '):this.ScreenObject.LocationID>0?M+=" dcCCNID2="+this.ScreenObject.LocationID.toString()+", ":a.a.SessionManager.LocationID>0&&(M+=" dcCCNID2="+a.a.SessionManager.LocationID.toString()+", ")),this.savebulk||(this.ScreenObject.Preferences.ContainsKey("StageCCID")&&""!=this.ScreenObject.Preferences.StageCCID.toString()&&parseInt(this.ScreenObject.Preferences.StageCCID)>5e4&&!M.toString().Contains("dcCCNID"+(parseInt(this.ScreenObject.Preferences.StageCCID)-5e4)+"=")&&!this.ScreenObject.strCCFields.Contains("dcCCNID"+(parseInt(this.ScreenObject.Preferences.StageCCID)-5e4)+"=")&&this.ScreenObject.GridDataColumns.Contains("StageID")&&(n.e.IsEmpty(this.ScreenObject.GridData[s].StageID)||(M+=" dcCCNID"+(parseInt(this.ScreenObject.Preferences.StageCCID)-5e4)+"="+this.ScreenObject.GridData[s].StageID.toString()+", ")),this.ScreenObject.Preferences.ContainsKey("jobCCID")&&""!=this.ScreenObject.Preferences.jobCCID.toString()&&parseInt(this.ScreenObject.Preferences.jobCCID)>5e4&&!M.toString().Contains("dcCCNID"+(parseInt(this.ScreenObject.Preferences.jobCCID)-5e4)+"=")&&!this.ScreenObject.strCCFields.Contains("dcCCNID"+(parseInt(this.ScreenObject.Preferences.jobCCID)-5e4)+"=")&&this.ScreenObject.GridDataColumns.Contains("jobID")&&(n.e.IsEmpty(this.ScreenObject.GridData[s].jobID)||(M+=" dcCCNID"+(parseInt(this.ScreenObject.Preferences.jobCCID)-5e4)+"="+this.ScreenObject.GridData[s].jobID.toString()+", ")),this.ScreenObject.Preferences.ContainsKey("BomCCID")&&""!=this.ScreenObject.Preferences.BomCCID.toString()&&parseInt(this.ScreenObject.Preferences.BomCCID)>5e4&&!M.toString().Contains("dcCCNID"+(parseInt(this.ScreenObject.Preferences.BomCCID)-5e4)+"=")&&!this.ScreenObject.strCCFields.Contains("dcCCNID"+(parseInt(this.ScreenObject.Preferences.BomCCID)-5e4)+"=")&&this.ScreenObject.GridDataColumns.Contains("BOMID")&&(n.e.IsEmpty(this.ScreenObject.GridData[s].BOMID)||(M+=" dcCCNID"+(parseInt(this.ScreenObject.Preferences.BomCCID)-5e4)+"="+this.ScreenObject.GridData[s].BOMID.toString()+", "))),"JOB"==n.e.String(this.ScreenObject.GridData[s].LinkedFieldName)&&this.ScreenObject.GridDataColumns.Contains("NetJobQty")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].NetJobQty)&&n.e.Double(this.ScreenObject.GridData[s].NetJobQty)>0&&(this.ScreenObject.IsPurchase&&a.a.SessionManager.Preferences.ContainsKey("DoNotReceiveMoreThanJobQty")&&"true"==a.a.SessionManager.Preferences.DoNotReceiveMoreThanJobQty.toLowerCase()||!this.ScreenObject.IsPurchase&&a.a.SessionManager.Preferences.ContainsKey("DoNotIssueMoreThanJobQty")&&"true"==a.a.SessionManager.Preferences.DoNotIssueMoreThanJobQty.toLowerCase())&&(j+=' LinkedFieldValue="'+this.ScreenObject.GridData[s].NetJobQty.toString()+'" ',this.ScreenObject.Preferences.ContainsKey("StageCCID")&&""!=this.ScreenObject.Preferences.StageCCID.toString()&&parseInt(this.ScreenObject.Preferences.StageCCID)>5e4&&this.ScreenObject.Preferences.ContainsKey("jobCCID")&&""!=this.ScreenObject.Preferences.jobCCID.toString()&&parseInt(this.ScreenObject.Preferences.jobCCID)>5e4&&(j+=' LinkedFieldWhere="',j+=" and dcccnid"+(parseInt(this.ScreenObject.Preferences.StageCCID)-5e4)+"=",this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(parseInt(this.ScreenObject.Preferences.StageCCID)-5e4)+"_Key")?j+=this.ScreenObject.GridData[s]["dcCCNID"+(parseInt(this.ScreenObject.Preferences.StageCCID)-5e4)+"_Key"].toString():j+=n.e.String(this.ScreenObject.GridData[s].StageID),j+=" and dcccnid"+(parseInt(this.ScreenObject.Preferences.jobCCID)-5e4)+"=",j+=n.e.String(this.ScreenObject.GridData[s].jobID),j+='" ',j+=' JobWhere="',j+=" and StageNodeID=",this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(parseInt(this.ScreenObject.Preferences.StageCCID)-5e4)+"_Key")?j+=this.ScreenObject.GridData[s]["dcCCNID"+(parseInt(this.ScreenObject.Preferences.StageCCID)-5e4)+"_Key"].toString():j+=n.e.String(this.ScreenObject.GridData[s].StageID),j+=" and NodeID="+n.e.String(this.ScreenObject.GridData[s].jobID)+'" ')),Q){let e=J;for(let t=0;t<k.length;t++)e+="3"==k[t]?" and ProductID="+this.ScreenObject.GridData[s].ProductID_Key.toString():" and dcccnid"+(parseInt(k[t])-5e4)+"="+this.ScreenObject.GridData[s]["dcCCNID"+(parseInt(k[t])-5e4)+"_Key"].toString();j+=' BudQtyWhere="'+e+'" ',j+=' BudID="'+X+'" ',j+=' BudStartDate="'+w.ToString("dd/MMM/yyyy")+'" '}if(U){let e=Z;for(let t=0;t<K.length;t++)e+="3"==K[t]?" and ProductID="+this.ScreenObject.GridData[s].ProductID_Key.toString():" and dcccnid"+(parseInt(K[t])-5e4)+"="+this.ScreenObject.GridData[s]["dcCCNID"+(parseInt(K[t])-5e4)+"_Key"].toString();j+=' ValueBudWhere="'+e+'" ',j+=' ValueBudID="'+q+'" ',j+=' ValueBudStartDate="'+F.ToString("dd/MMM/yyyy")+'" '}if(this.IsLockDimsLineWise){let e={join:""};j+=' LockDims="'+this.GetLockQuery(this.ScreenObject.GridData[s],e)+'" ',""!=e.join&&(j+=' LockDimsjoin="'+e.join+'" ')}a.a.SessionManager.RegisterCCID>0&&this.ScreenObject.RegisterNodeID>0&&!M.toString().Contains("dcCCNID"+(a.a.SessionManager.RegisterCCID-5e4).toString()+"=")&&!this.ScreenObject.strCCFields.Contains("dcCCNID"+(a.a.SessionManager.RegisterCCID-5e4).toString()+"=")&&this.ScreenObject.RegisterNodeID>0&&!this.savebulk&&(M+=" dcCCNID"+(a.a.SessionManager.RegisterCCID-5e4).toString()+"="+this.ScreenObject.RegisterNodeID.toString()+", "),(38==this.DocumentType||39==this.DocumentType)&&this.ScreenObject.ShiftNodeID>0&&!this.savebulk&&a.a.SessionManager.Preferences.ContainsKey("PosShifts")&&""!=a.a.SessionManager.Preferences.PosShifts.toString()&&parseInt(a.a.SessionManager.Preferences.PosShifts)>5e4&&!M.toString().Contains("dcCCNID"+(parseInt(a.a.SessionManager.Preferences.PosShifts)-5e4)+"=")&&!this.ScreenObject.strCCFields.Contains("dcCCNID"+(parseInt(a.a.SessionManager.Preferences.PosShifts)-5e4)+"=")&&(M+=" dcCCNID"+(parseInt(a.a.SessionManager.Preferences.PosShifts)-5e4).toString()+"="+this.ScreenObject.ShiftNodeID.toString()+", "),this.savebulk||(T+="</AccountsXML>"),5==this.ScreenObject.DocumentType&&1==D?(M+=this.ScreenObject.strTOCCFields+'" ></CostCenters>',j+=' VoucherType="1" '):(M+=this.savebulk?this.ScreenObject.strCCFields+" ></CostCenters>":this.ScreenObject.strCCFields+'" ></CostCenters>',5==this.ScreenObject.DocumentType&&(j+=' VoucherType="-1" ')),this.LineWiseApproval&&(!n.e.IsEmpty(this.ScreenObject.GridData[s].DocDetailsID)&&parseInt(this.ScreenObject.GridData[s].DocDetailsID)>0&&("0"==n.e.String(this.ScreenObject.GridData[s].IsSelected)||"NoWorkFlow"==e.toString()||"NoWorkFlowReSave"==e.toString()||"NoWorkFlowprint"==e.toString()||this.ScreenObject.Preferences.ContainsKey("NoWorkflowPostedDocs")&&""!=this.ScreenObject.Preferences.NoWorkflowPostedDocs&&Object(o.j)(this.ScreenObject.Preferences.NoWorkflowPostedDocs)&&"369"==this.ScreenObject.GridData[s].StatusID.toString())?j+=' WorkFlowID="-1" ':"2"==n.e.String(this.ScreenObject.GridData[s].IsSelected)?j+=' WorkFlowID="-2" ':"0"!=n.e.String(this.ScreenObject.GridData[s].CanEdit)?j+=' WorkFlowID="'+this.GetWorkFlow(!1,this.ScreenObject.GridData[s])+'" ':j+=' WorkFlowID="-1" ',n.e.IsEmpty(this.ScreenObject.GridData[s].AppRemarks)||(j+=' AppRemarks="'+this.ScreenObject.GridData[s].AppRemarks.toString()+'" '));let f=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&50040==e.LinkData);if(f.length>0&&this.ScreenObject.GridDataColumns.Contains(f[0].SysColumnName)&&(j+=' MatIndentIDColumn="'+f[0].SysColumnName+'" ',this.ScreenObject.GridDataColumns.Contains("IndentID")?j+=' MatIndentID="'+this.ScreenObject.GridData[s].IndentID.toString()+'" ':n.e.IsEmpty(this.ScreenObject.GridData[s][f[0].SysColumnName])||(j+=' MatIndentID="'+this.ScreenObject.GridData[s][f[0].SysColumnName].toString()+'" ')),!n.e.IsEmpty(this.ScreenObject.GridData[s].SchemeID)&&parseInt(this.ScreenObject.GridData[s].SchemeID)>0&&(j+=' IsQtyFreeOffer="'+this.ScreenObject.GridData[s].SchemeID.toString()+'" ',"Y"==this.ScreenObject.GridData[s].IsScheme.toString())){let e=this.ScreenObject.GridData.filter(e=>e.MaxSchemeID==this.ScreenObject.GridData[s].MaxSchemeID&&"Y"!=e.IsScheme);if(e.length>0){let t="";e.forEach(e=>{t+=e.DocSeqNo.toString()+","}),t=t.substr(t.length-1,1),j+=' ParentSchemeID="'+t+'" '}}let L=n.e.String(this.ScreenObject.GridData[s].ExtraXML),R="";if("8"==n.e.String(this.ScreenObject.GridData[s].Type)||"3"==n.e.String(this.ScreenObject.GridData[s].Type)||"11"==n.e.String(this.ScreenObject.GridData[s].Type)||"12"==n.e.String(this.ScreenObject.GridData[s].Type)?R=L:this.ScreenObject.GridDataColumns.Contains("PromotionXML")&&(R=n.e.String(this.ScreenObject.GridData[s].PromotionXML)),""!=R){let r="";r+="<xml>";let c=new n.f;if(c.LoadXml(R),t&&!this.ValidateDataonSave_xml(c,s))return!1;let h,u=c.SelectNodes("xml/Row/xml"),S=u.length,m=0;if(this.ScreenObject.Data.Tables[15].length>0){this.ScreenObject.Data.Columns[15].Contains("PostingVal")||this.ScreenObject.Data.Columns[15].push("PostingVal");for(let e=0;e<this.ScreenObject.Data.Tables[15].length;e++)this.ScreenObject.Data.Tables[15][e].PostingVal=0}for(let b=0;b<u.length;b++){let C=u[b];if(m++,r+="<Row >"+c.getNodeXml(C).replace("/>","").replace('CCQuery="','CCQuery="'+this.ScreenObject.strCCFields).replace('texQuery="','texQuery="'+this.ScreenObject.strTextFields),null!=e&&"SaveonHold"==e.toString()||this.DonotUpdateInventory||null!=C.attributes.Type&&""!=C.attributes.Type.value&&6==parseInt(C.attributes.Type.value)?r+=' IsQtyIgnored="1" ':r+=' IsQtyIgnored="0" ',t&&!this.DonotUpdateInventory&&null!=C.attributes.Type&&""!=C.attributes.Type.value&&5==parseInt(C.attributes.Type.value)&&null!=C.attributes.Quantity&&""!=C.attributes.Quantity.value&&parseFloat(C.attributes.Quantity.value)>0&&(null==C.attributes.ExtraXML||""==C.attributes.ExtraXML.value&&!l))return this.DisplayMessage=a.a.GetResource("Doc_BatchQtyMissMatch")+" "+this.ScreenObject.GridData[s].DocSeqNo.toString(),!1;if(r+=null!=this.Currency&&null!=this.Currency.Currency.SelectedValue&&""!=this.Currency.Currency.SelectedValue?'CurrencyID="'+this.Currency.Currency.SelectedValue.toString()+'" ':'CurrencyID="1" ',r+=null!=this.Currency&&null!=this.Currency.ExchangeRate.Text&&""!=this.Currency.ExchangeRate.Text?'ExchangeRate="'+this.Currency.ExchangeRate.Text.toString()+'" ':'ExchangeRate="1" ',r+=this.ScreenObject.strStaticFields,r+='StockValue="##StkVal##" ',r+=" />",null!=e&&"SaveonHold"!=e.toString()&&!i&&this.ScreenObject.Preferences.ContainsKey("KitAccPosting")&&"True"==this.ScreenObject.Preferences.KitAccPosting){let e=new n.f;e.ReadXml(c.getNodeXml(C));let t=0;r+="<AccountsXML>";for(let i=0;i<this.ScreenObject.ColumnSource.length;i++){let a=this.GetCurrencyID(s),l=this.GetExchRate(s),c=this.ScreenObject.Data.Tables[15].filter(e=>e.CostCenterColIDField==this.ScreenObject.ColumnSource[i].ID),u="";if(c.length>0&&"No"==n.e.String(c[0].DistributOn)?1!=m||n.e.IsEmpty(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[i].DisplayMember])||(u=this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[i].DisplayMember].toString()):c.length>0&&!n.e.IsEmpty(c[0].DistributOn)&&("3"==n.e.String(this.ScreenObject.GridData[s].Type)||n.e.IsEmpty(c[0].IgnoreKit)||!Object(o.j)(c[0].IgnoreKit))?"Quantity"==n.e.String(c[0].DistributOn)&&null!=C.attributes.totQty&&""!=C.attributes.totQty.value&&parseFloat(C.attributes.totQty.value)>0&&null!=C.attributes.Quantity&&""!=C.attributes.Quantity.value&&parseFloat(C.attributes.Quantity.value)>0&&!n.e.IsEmpty(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[i].DisplayMember])?(h=S==m?parseFloat(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[i].DisplayMember])-parseFloat(c[0].PostingVal):parseFloat(C.attributes.Quantity.value)/parseFloat(C.attributes.totQty.value)*parseFloat(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[i].DisplayMember]),h=parseFloat(h.ToString("N"+this.ScreenObject.ColumnSource[i].DecimalPoints)),c[0].PostingVal=parseFloat(c[0].PostingVal)+h,u=h.toString()):"Gross"==n.e.String(c[0].DistributOn)&&null!=C.attributes.totgross&&""!=C.attributes.totgross.value&&parseFloat(C.attributes.totgross.value)>0&&null!=C.attributes.Gross&&""!=C.attributes.Gross.value&&parseFloat(C.attributes.Gross.value)>0&&!n.e.IsEmpty(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[i].DisplayMember])&&(h=S==m?parseFloat(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[i].DisplayMember])-parseFloat(c[0].PostingVal):parseFloat(C.attributes.Gross.value)/parseFloat(C.attributes.totgross.value)*parseFloat(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[i].DisplayMember]),h=parseFloat(h.ToString("N"+this.ScreenObject.ColumnSource[i].DecimalPoints)),c[0].PostingVal=parseFloat(c[0].PostingVal)+h,u=h.toString()):4==this.ScreenObject.ColumnSource[i].SectionID?null!=C.attributes.totgross&&""!=C.attributes.totgross.value&&parseFloat(C.attributes.totgross.value)>0&&null!=C.attributes.Gross&&""!=C.attributes.Gross.value&&parseFloat(C.attributes.Gross.value)>0&&!n.e.IsEmpty(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[i].DisplayMember])&&(u=(parseFloat(C.attributes.Gross.value)/parseFloat(C.attributes.totgross.value)*parseFloat(this.ScreenObject.GridData[s]["dcCalc"+this.ScreenObject.ColumnSource[i].DisplayMember])).toString()):("ComboBox"!=this.ScreenObject.ColumnSource[i].DataType&&this.ScreenObject.ColumnSource[i].PostingType>0&&C.attributes[this.ScreenObject.ColumnSource[i].DisplayMember]&&n.e.Double(C.attributes[this.ScreenObject.ColumnSource[i].DisplayMember].value)>0&&(u=C.attributes[this.ScreenObject.ColumnSource[i].DisplayMember].value),this.ScreenObject.ColumnSource[i].DisplayMember.toLowerCase().Contains("dcnum")&&null!=C.attributes["dcCalc"+this.ScreenObject.ColumnSource[i].DisplayMember]&&""!=C.attributes["dcCalc"+this.ScreenObject.ColumnSource[i].DisplayMember].value&&parseFloat(C.attributes["dcCalc"+this.ScreenObject.ColumnSource[i].DisplayMember].value)>0&&(u=C.attributes["dcCalc"+this.ScreenObject.ColumnSource[i].DisplayMember].value)),(3==this.ScreenObject.ColumnSource[i].PostingType||4==this.ScreenObject.ColumnSource[i].PostingType)&&0!=n.e.Double(u)){let t={DBAcc:0,CrACC:0,PostingXml:""};if(c.length>0&&"No"==n.e.String(c[0].DistributOn)){if(!this.FillAccountPosting(this.ScreenObject.ColumnSource[i],this.ScreenObject.GridData[s],u,a,l,t,0,V))return!1}else if(!this.FillAccountPosting(this.ScreenObject.ColumnSource[i],e.Tables[0][0],u,a,l,t,0,V))return!1;r+=t.PostingXml,this.ScreenObject.FillBillWiseDt(this.BillWisedt,this.BillWisedtColumns,t.CrACC.toString(),u,!0,a,l,D,this.ScreenObject.ColumnSource[i].NoRoundOff?"6":this.ScreenObject.ColumnSource[i].DecimalPoints,V),this.ScreenObject.FillBillWiseDt(this.BillWisedt,this.BillWisedtColumns,t.DBAcc.toString(),u,!1,a,l,D,this.ScreenObject.ColumnSource[i].NoRoundOff?"6":this.ScreenObject.ColumnSource[i].DecimalPoints,V)}2!=this.ScreenObject.ColumnSource[i].PostingType&&4!=this.ScreenObject.ColumnSource[i].PostingType||""==u||0==n.e.Double(u)||(t+=parseFloat(u)*l)}r+="</AccountsXML>",r=r.Replace("##StkVal##",t.toString())}else{let e=new n.f;e.ReadXml(e.getNodeXml(C));let t=0;for(let i=0;i<this.ScreenObject.ColumnSource.length;i++){this.GetCurrencyID(s);let e=this.GetExchRate(s);var d=this.ScreenObject.Data.Tables[15].filter(e=>e.CostCenterColIDField==this.ScreenObject.ColumnSource[i].ID);let a="";d.length>0&&"No"==n.e.String(d[0].DistributOn)?1!=m||n.e.IsEmpty(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[i].DisplayMember])||(a=this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[i].DisplayMember].toString().toString()):d.length>0&&!n.e.IsEmpty(d[0].DistributOn)&&("3"==this.ScreenObject.GridData[s].Type.toString()||n.e.IsEmpty(d[0].IgnoreKit)||!Object(o.j)(d[0].IgnoreKit.toString()))?"Quantity"==d[0].DistributOn.toString()&&!n.e.IsEmpty(C.attributes.totQty)&&!n.e.IsEmpty(C.attributes.totQty.value)&&parseFloat(C.attributes.totQty.value)>0&&null!=C.attributes.Quantity&&""!=C.attributes.Quantity.value&&parseFloat(C.attributes.Quantity.value)>0&&!n.e.IsEmpty(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[i].DisplayMember])?(h=S==m?parseFloat(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[i].DisplayMember].toString())-parseFloat(d[0].PostingVal.toString()):parseFloat(C.attributes.Quantity.value)/parseFloat(C.attributes.totQty.value)*parseFloat(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[i].DisplayMember].toString()),h=parseFloat(h.ToString("N"+this.ScreenObject.ColumnSource[i].DecimalPoints)),d[0].PostingVal=parseFloat(d[0].PostingVal.toString())+h,a=h.toString()):"Gross"==d[0].DistributOn.toString()&&null!=C.attributes.totgross&&""!=C.attributes.totgross.value&&parseFloat(C.attributes.totgross.value)>0&&null!=C.attributes.Gross&&""!=C.attributes.Gross.value&&parseFloat(C.attributes.Gross.value)>0&&!n.e.IsEmpty(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[i].DisplayMember])&&(h=S==m?parseFloat(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[i].DisplayMember].toString())-parseFloat(d[0].PostingVal.toString()):parseFloat(C.attributes.Gross.value)/parseFloat(C.attributes.totgross.value)*parseFloat(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[i].DisplayMember].toString()),h=parseFloat(h.ToString("N"+this.ScreenObject.ColumnSource[i].DecimalPoints)),d[0].PostingVal=parseFloat(d[0].PostingVal.toString())+h,a=h.toString()):4==this.ScreenObject.ColumnSource[i].SectionID?null!=C.attributes.totgross&&""!=C.attributes.totgross.value&&parseFloat(C.attributes.totgross.value)>0&&null!=C.attributes.Gross&&""!=C.attributes.Gross.value&&parseFloat(C.attributes.Gross.value)>0&&!n.e.IsEmpty(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[i].DisplayMember])&&(a=(parseFloat(C.attributes.Gross.value)/parseFloat(C.attributes.totgross.value)*parseFloat(this.ScreenObject.GridData[s][this.ScreenObject.ColumnSource[i].DisplayMember].toString())).toString()):("ComboBox"!=this.ScreenObject.ColumnSource[i].DataType&&this.ScreenObject.ColumnSource[i].PostingType>0&&null!=C.attributes[this.ScreenObject.ColumnSource[i].DisplayMember]&&""!=C.attributes[this.ScreenObject.ColumnSource[i].DisplayMember].value&&parseFloat(C.attributes[this.ScreenObject.ColumnSource[i].DisplayMember].value)>0&&(a=C.attributes[this.ScreenObject.ColumnSource[i].DisplayMember].value),this.ScreenObject.ColumnSource[i].DisplayMember.toLowerCase().Contains("dcnum")&&null!=C.attributes["dcCalc"+this.ScreenObject.ColumnSource[i].DisplayMember]&&""!=C.attributes["dcCalc"+this.ScreenObject.ColumnSource[i].DisplayMember].value&&parseFloat(C.attributes["dcCalc"+this.ScreenObject.ColumnSource[i].DisplayMember].value)>0&&(a=C.attributes["dcCalc"+this.ScreenObject.ColumnSource[i].DisplayMember].value)),(2==this.ScreenObject.ColumnSource[i].PostingType||4==this.ScreenObject.ColumnSource[i].PostingType)&&""!=a&&n.e.Double(a)>0&&0!=parseFloat(a)&&(t+=parseFloat(a)*e)}r=r.Replace("##StkVal##",t.toString())}r=r.Replace("##StkVal##","0"),r+="</Row>"}r+="</xml>","8"==n.e.String(this.ScreenObject.GridData[s].Type)||"3"==n.e.String(this.ScreenObject.GridData[s].Type)||"11"==n.e.String(this.ScreenObject.GridData[s].Type)||"12"==n.e.String(this.ScreenObject.GridData[s].Type)?(L=r,R=""):R=r}if(5==this.ScreenObject.DocumentType&&1==D&&this.ScreenObject.GridDataColumns.Contains("RecievedQtyXML")&&!this.DonotUpdateInventory&&2==n.e.Int(this.ScreenObject.GridData[s].Type)&&(L=n.e.String(this.ScreenObject.GridData[s].RecievedQtyXML)),this.savebulk&&!n.e.IsEmpty(L)&&"5"==n.e.String(this.ScreenObject.GridData[s].Type)){let e=new n.f;e.LoadXml(L);let t=e.SelectNodes("xml/Row");t.length>0&&(j+='BatchID="'+t[0].attributes.BatchID.value+'" ',j+='ReleaseQuantity="'+n.e.String(this.ScreenObject.GridData[s].UOMConvertedQty)+'" ')}if(l&&this.ScreenObject.Preferences.ContainsKey("BatchBasedon")&&this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.Preferences.BatchBasedon)&&(j+=' IgnoreBatches="1" '),j+=this.ScreenObject.strStaticFields+" ></Transactions>",this.savebulk)"2"!=this.ScreenObject.GridData[s].Type.toString()||n.e.IsEmpty(L)||(C.LoadXml(L),C.SelectNodes("xml/Row").forEach(e=>{let t=C.CreateAttribute("DocSeqNo");t.Value=V.toString(),e.attributes+=t}),N+=C.InnerXml),this.ScreenObject.GridDataColumns.Contains("DocExtraXML")&&""!=this.ScreenObject.GridData[s].DocExtraXML.toString()&&(C.LoadXml(this.ScreenObject.GridData[s].DocExtraXML.toString()),C.SelectNodes("DocExtraXML/Row").forEach(e=>{let t=C.CreateAttribute("DocSeqNo");t.Value=V.toString(),e.attributes+=t}),E+=C.InnerXml);else{if(T+=j+P+A+M+"<EXTRAXML>"+L+"</EXTRAXML>",""!=R?T+="<DynPromXML>"+R+"</DynPromXML>":this.ScreenObject.Preferences.ContainsKey("BudgetDoc")&&""!=this.ScreenObject.Preferences.BudgetDoc&&(T+=this.GetBudgetXml(this.ScreenObject.GridData[s])),this.ScreenObject.GridDataColumns.Contains("QtyXML")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].QtyXML)&&(T+=this.ScreenObject.GridData[s].QtyXML),this.ScreenObject.GridDataColumns.Contains("DocExtraXML")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].DocExtraXML)&&(T+=this.ScreenObject.GridData[s].DocExtraXML),E.length>0&&(T+=E.toString()),this.ScreenObject.GridDataColumns.Contains("PackXML")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].PackXML)&&(T+=this.ScreenObject.GridData[s].PackXML),this.ScreenObject.GridDataColumns.Contains("TestCaseXML")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].TestCaseXML)&&(T+=this.ScreenObject.GridData[s].TestCaseXML),45==this.DocumentType&&(T+="<ProjectPlanXML ",this.ScreenObject.GridDataColumns.Contains("Dependencies")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].Dependencies)&&(T+='Dependencies="'+this.ScreenObject.GridData[s].Dependencies+'" '),T+=">",this.ScreenObject.GridDataColumns.Contains("AssignXML")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].AssignXML)&&(T+=this.ScreenObject.GridData[s].AssignXML),T+="</ProjectPlanXML>"),null!=this.POSPayModes&&1==V){let e=n.e.Int(a.a.SessionManager.Preferences.LoyaltyOn);if(a.a.SessionManager.Preferences.ContainsKey("LoyaltyOn")&&e>5e4){let t=this.ScreenObject._CCFields.find(t=>t instanceof m.b&&t.CCID==e);e=null!=t&&t.SelectedValue>0?t.SelectedValue:0}else null!=this.ScreenObject.DebitAccount&&(e=this.ScreenObject.DebitAccount.SelectedValue);let t=this.ScreenObject.Data.Tables[0].filter(e=>79==e.LocalReference&&56569==e.LinkData);if(t.length>0&&t[0].SysColumnName.toLowerCase().Contains("dcnum")&&this.ScreenObject.GridDataColumns.Contains(t[0].SysColumnName)){if(0==e)return this.DisplayMessage+="select loyalty based on.",!1;let s=this.ScreenObject.GridData.Compute("sum",t[0].SysColumnName.toString());null!=s&&null!=s&&(T+='<DocExtraXML><Row  RefID="1"  Fld1="'+e+'" ',T+=' Qty="'+parseInt(s),T+='"  Type="5"  ></Row></DocExtraXML>')}else if(this.POSPayModes.points>0&&(this.GridNetTotal+this.FooterGridNetTotal)/this.POSPayModes.BillValue>=1){if(0==e)return this.DisplayMessage+="select loyalty based on.",!1;T+='<DocExtraXML><Row  RefID="1"  Fld1="'+e+'" ',T+=' Qty="'+(this.GridNetTotal+this.FooterGridNetTotal)/this.POSPayModes.BillValue*this.POSPayModes.points,T+='"  Type="5"  ></Row></DocExtraXML>'}if(this.POSPayModes.RedeemPoints>0){if(0==e)return this.DisplayMessage+="select loyalty based on.",!1;T+='<DocExtraXML><Row  RefID="1"  Fld1="'+e+'" ',T+=' Qty="-'+this.POSPayModes.RedeemPoints,T+='"  Type="5"  ></Row></DocExtraXML>'}}if(5==this.ScreenObject.DocumentType&&1==D&&this.ScreenObject.GridDataColumns.Contains("TOBinsXML")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].TOBinsXML)?T+=this.ScreenObject.GridData[s].TOBinsXML:this.ScreenObject.GridDataColumns.Contains("BinsXML")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].BinsXML)&&(T+=this.ScreenObject.GridData[s].BinsXML),this.ScreenObject.Preferences.ContainsKey("PostAsset")&&"true"==this.ScreenObject.Preferences.PostAsset.toLowerCase()){let e=0,t=!1;this.ScreenObject.Preferences.ContainsKey("AssetBasedOn")&&this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.Preferences.AssetBasedOn)?"0"==n.e.String(this.ScreenObject.GridData[s][this.ScreenObject.Preferences.AssetBasedOn])?e=0:"1"!=n.e.String(this.ScreenObject.GridData[s][this.ScreenObject.Preferences.AssetBasedOn])||n.e.IsEmpty(this.ScreenObject.GridData[s].Quantity)?"2"!=n.e.String(this.ScreenObject.GridData[s][this.ScreenObject.Preferences.AssetBasedOn])||n.e.IsEmpty(this.ScreenObject.GridData[s].Quantity)?"4"==n.e.String(this.ScreenObject.GridData[s][this.ScreenObject.Preferences.AssetBasedOn])?(t=!0,e=1):"3"==n.e.String(this.ScreenObject.GridData[s][this.ScreenObject.Preferences.AssetBasedOn])&&(e=parseFloat(this.ScreenObject.GridData[s].Quantity)):e=parseFloat(this.ScreenObject.GridData[s].Quantity):(t=!0,e=parseFloat(this.ScreenObject.GridData[s].Quantity)):n.e.IsEmpty(this.ScreenObject.GridData[s].Quantity)||(e=parseFloat(this.ScreenObject.GridData[s].Quantity)),e>0&&(T+=this.getAssetDeprXML(this.ScreenObject.GridData[s],t))}T+="</Row>"}D++}while(5==this.ScreenObject.DocumentType&&1==D)}if(0==V)return this.isAutoProduce&&null!=parent?(this.parent.AutoProduceXML="",!1):(this.DisplayMessage=a.a.GetResource("Doc_BlankData"),!1);if(this.DialogResult=!1,t)for(let e=0;e<this.BillWisedt.length;e++)if(this.BillWisedt[e].AccountID.toString()==re.toString()){if(this.ScreenObject.Preferences.ContainsKey("Dontsaveifpartybalancesgoes-ve")&&""!=this.ScreenObject.Preferences["Dontsaveifpartybalancesgoes-ve"]&&Object(o.j)(this.ScreenObject.Preferences["Dontsaveifpartybalancesgoes-ve"])&&this.CheckAccountBalance(re,parseFloat(this.BillWisedt[e].Amount),Object(o.j)(this.BillWisedt[e].IsCredit)))return this.DisplayMessage=a.a.GetResource("PartyBalnceNegative"),!1;if(!this.IgnoreOnSave.ContainsKey("ChequeReturn")&&(this.IgnoreOnSave.ACTION="ChequeReturn",this.ChequeReturn(re,null,"",parseFloat(this.BillWisedt[e].Amount),Object(o.j)(this.BillWisedt[e].IsCredit),parseInt(this.BillWisedt[e].CurrencyID),parseFloat(this.BillWisedt[e].ExchangeRate)),this.isChequeReturn))return!1;break}if(n.e.IsEmpty(se)){if((this.ScreenObject.Preferences.ContainsKey("DistributeCost")&&"True"==this.ScreenObject.Preferences.DistributeCost.toString()||ae)&&this.BillWisedt.length>0&&this.BillWisedt.filter(e=>e.AccountID==re).length>0){this.DialogResult=!1;let e=new v.ShowJVViewModel;e.ShowJVViewModel_2(this,re.toString(),ae?5:3);{if(ae&&(e.AccountID=oe,e.JVGrid.Columns[0].IsVisible=!1),t){if(a.a.page.ShowDialog(e,x.ShowJVComponent,{HideHeader:!0,Title:e.Title}),!this.DialogResult)return!1}else{let t=(ae?e.JVGrid.Table.filter(e=>e.AccountID_Key>0):e.JVGrid.Table).Compute("sum","Amount");if(null==t||parseFloat(t).ToString("N"+e.decimalpoints)!=e.TotAmt.ToString("N"+e.decimalpoints))return this.DisplayMessage="Amount not equal.",!1}let s=this.ScreenObject.ColumnSource.find(e=>null!=e.ValueMember&&"productid_key"==e.ValueMember.toLowerCase());if(!s||n.e.IsEmpty(s.DefaultValue)||n.e.Int(s.DefaultValue)<1)return this.DisplayMessage="Define default product",!1;T+=e.getxml(s.DefaultValue)}}}else T+=se;if(a.a.SessionManager.Preferences.ContainsKey("On")&&"true"==a.a.SessionManager.Preferences.On.toLowerCase()&&this.BillWisedt.length>0){let e;if(this.DialogResult=!1,this.IgnoreOnSave.ContainsKey("BillWisedt")&&(this.BillWisedt=this.IgnoreOnSave.BillWisedt),this.IgnoreOnSave.ContainsKey("BillWise")?(this.DialogResult=!0,e=this.IgnoreOnSave.BillWise):(e=new R,e.BillWiseViewModel_1(this,t)),!this.DialogResult){if(!t||this.ScreenObject.Preferences.ContainsKey("Alwaysnewreference")&&Object(o.j)(this.ScreenObject.Preferences.Alwaysnewreference)||this.ScreenObject.Preferences.ContainsKey("AdjustFifoBills")&&""!=this.ScreenObject.Preferences.AdjustFifoBills&&Object(o.j)(this.ScreenObject.Preferences.AdjustFifoBills)||this.ScreenObject.IsDocEdit&&a.a.SessionManager.IsActionAssigned(43,"Ignore Billwise on edit")){for(let t=0;t<e.Accounts.Items.length;t++){let s=e.Accounts.Items[t],i={Message:""};if(e.FillSelectedAccountDetails(s),0==this.DocID&&this.ScreenObject.Preferences.ContainsKey("AdjustFifoBills")&&""!=this.ScreenObject.Preferences.AdjustFifoBills&&Object(o.j)(this.ScreenObject.Preferences.AdjustFifoBills)&&(e._Fifo=!1,e.Fifo=!0),this.BillWisedtColumns.Contains("DocSeqNo")?this.BillWisedt.filter(e=>e.AccountID==s.Value.toString()&&e.DocSeqNo==s.Seq&&e.IsCredit==e.item.Status&&e.CurrencyID==s.CurrID)[0].XML=e.GetXml(!1,i):(this.BillWisedt.filter(e=>e.AccountID==s.Value.toString()&&e.IsCredit==s.Status&&e.CurrencyID==s.CurrID)[0].XML=e.GetXml(!1,i),null!=e.VatAdvanceXML&&e.VatAdvanceXML.length>0&&(this.BillWisedt.filter(e=>e.AccountID==s.Value.toString()&&e.IsCredit==s.Status&&e.CurrencyID==s.CurrID)[0].DocXML=e.VatAdvanceXML)),""!=i.Message)return this.DisplayMessage=i.Message,!1}this.DialogResult=!0}else this.IgnoreOnSave.ContainsKey("BillWise")?this.DialogResult=!0:(this.IgnoreOnSave.ACTION="BillWise",this.IgnoreOnSave.push("BillWise",e),a.a.page.ShowDialog(e,L.a,{ShowCenter:!0}));this.IgnoreOnSave.ContainsKey("BillWisedt")||this.IgnoreOnSave.push("BillWisedt",""),this.IgnoreOnSave.BillWisedt=this.BillWisedt}if(!this.DialogResult)return!1}this.BillWiseXML="";let le="",ce=0,he=null;for(let e=0;e<this.BillWisedt.length;e++)if(!n.e.IsEmpty(this.BillWisedt[e].XML)){if(this.ScreenObject.Preferences.ContainsKey("Enable Payment Terms")&&Object(o.j)(this.ScreenObject.Preferences["Enable Payment Terms"])){let t=new n.f;t.LoadXml("<BillWise> "+this.BillWisedt[e].XML.toString()+" </BillWise>");let s=t.SelectNodes("BillWise/Row");this.DialogResult=!1;for(let e=0;e<s.length;e++)null!=s[e].attributes.AccountID&&""!=s[e].attributes.AccountID.value&&parseInt(s[e].attributes.AccountID.value)==re&&(null!=s[e].attributes.AdjAmount&&""!=s[e].attributes.AdjAmount.value&&null!=s[e].attributes.IsNewReference&&"1"==s[e].attributes.IsNewReference.value&&(ce+=parseFloat(s[e].attributes.AdjAmount.value.replace("-","")),he=s[e]),this.DialogResult=!0);if(this.DialogResult&&this.ScreenObject.Preferences.ContainsKey("BillwisePosting")&&"2"==this.ScreenObject.Preferences.BillwisePosting)continue}n.e.IsEmpty(this.BillWiseXML)&&(this.BillWiseXML="<BillWise> "),this.BillWiseXML+=this.BillWisedt[e].XML.toString(),n.e.IsEmpty(this.BillWisedt[e].DocXML)||(le+=this.BillWisedt[e].DocXML.toString())}""!=this.BillWiseXML||n.e.IsEmpty(this.ArApBills)||(this.BillWiseXML="<BillWise>"),this.BillWiseXML+=this.ArApBills,n.e.IsEmpty(this.BillWiseXML)||this.BillWiseXML.Contains("</BillWise>")||(this.BillWiseXML+=" </BillWise>");let De="";if(this.ScreenObject.Preferences.ContainsKey("PrepaymentDoc")&&!n.e.IsEmpty(this.ScreenObject.Preferences.PrepaymentDoc)&&parseInt(this.ScreenObject.Preferences.PrepaymentDoc)>4e4){var S=this.BillWisedt.filter(e=>e.AccountID==oe);if(S.length>0){let e=new ue.a(this,!0);this.ScreenObject.IsDocEdit&&e.loadFromxml(this.ScreenObject.GetDescXml(),S[0].Amount.toString()),""!=S[0].Amount.toString()&&(e.Amount.Text=S[0].Amount.toString()),e.DebitAcc.Visible&&(e.DebitAcc.SelectedValue=oe),e.CredAcc.Visible&&(e.CredAcc.SelectedValue=oe),e.IsDataSaved=!1,a.a.page.ShowDialog(e,de.a).subscribe(()=>{if(!e.IsDataSaved)return!1;De=e.GenerateChequeNos(!0)})}}let Se=!1;if(this.DisplayMessage="",t&&this.BudgetValidation(T.toString()),null!=this.DisplayMessage&&this.DisplayMessage.length>0){if("true"!=a.a.SessionManager.Preferences.GBudgetUnapprove.toLowerCase()||" "==this.DisplayMessage)return!1;this.DisplayMessage="",Se=!0}if(this.ScreenObject.Preferences.ContainsKey("CopyPaymentTerms")&&re>0&&(ce>0||_>0)&&Object(o.j)(this.ScreenObject.Preferences.CopyPaymentTerms)&&(!this.ScreenObject.Preferences.ContainsKey("Enable Payment Terms")||!Object(o.j)(this.ScreenObject.Preferences["Enable Payment Terms"]))){let e=0,t=this.ScreenObject.GridData.filter(e=>null!=e.LinkedInvDocDetailsID&&e.LinkedInvDocDetailsID>0);if(t.length>0){e=parseInt(t[0].LinkedInvDocDetailsID);let s=this.ScreenObject.GetPaymentTerms(re,e);if(s.Tables.length>3&&s.Tables[3].length>0&&s.Columns[3].Contains("Percentage")){0==ce&&(ce=_);let e=new ge;e.PaymentTermsViewModel_2(this,ce,re,s,he),e.onSave("Save")}}}if(0==ce&&re>0&&i&&_>0&&this.ScreenObject.Preferences.ContainsKey("Enable Payment Terms")&&""!=this.ScreenObject.Preferences["Enable Payment Terms"]&&Object(o.j)(this.ScreenObject.Preferences["Enable Payment Terms"])&&(ce=_),ce>0&&re>0&&this.ScreenObject.Preferences.ContainsKey("Enable Payment Terms")&&""!=this.ScreenObject.Preferences["Enable Payment Terms"]&&Object(o.j)(this.ScreenObject.Preferences["Enable Payment Terms"])){let e=0;if(0==this.ScreenObject.DocID&&""==this.payTermXml){let t=this.ScreenObject.GridData.filter(e=>null!=e.LinkedInvDocDetailsID&&e.LinkedInvDocDetailsID>0);t.length>0&&(e=parseInt(t[0].LinkedInvDocDetailsID))}let s=this.ScreenObject.GetPaymentTerms(re,e),i=!0;if(this.ScreenObject.Preferences.ContainsKey("accountwisePaymentTerms")&&""!=this.ScreenObject.Preferences.accountwisePaymentTerms&&Object(o.j)(this.ScreenObject.Preferences.accountwisePaymentTerms)&&!a.a.SessionManager.IsActionAssigned(43,"Override Payment Terms")&&(null!=s&&0!=s.Tables.length&&0!=s.Tables[0].length&&s.Columns[0].Contains("PaymentTerms")&&!n.e.IsEmpty(s.Tables[0][0].PaymentTerms)&&parseInt(s.Tables[0][0].PaymentTerms)>0||(i=!1)),this.ScreenObject.IsDocEdit&&a.a.SessionManager.IsActionAssigned(43,"Ignore Payment terms on edit")&&(i=!1),i)if(t){if(!this.IgnoreOnSave.ContainsKey("PaymentTerms")){this.IgnoreOnSave.ACTION="PaymentTerms";let e=new ge;return e.PaymentTermsViewModel_2(this,ce,re,s,he),this.IgnoreOnSave.push("PaymentTerms",e),a.a.page.ShowDialog(e,Oe.a),!1}}else{let e=new ge;e.PaymentTermsViewModel_2(this,ce,re,s,he),e.onSave("Save")}}if(this.LCBillsXml="",re>0&&this.ScreenObject.Preferences.ContainsKey("EnableLC")&&""!=this.ScreenObject.Preferences.EnableLC&&Object(o.j)(this.ScreenObject.Preferences.EnableLC)){let e=this.ScreenObject.GetLCBills(re,!0,this.ScreenObject.VoucherNo,1,this.DocumentDate);if(null!=e&&e.Tables.length>0&&!e.Columns[0].Contains("ErrorMessage")&&e.Tables[0].length>0){let e=1,t=1;if(null!=this.Currency&&null!=this.Currency.Currency.SelectedValue&&""!=this.Currency.Currency.SelectedValue&&(e=parseInt(this.Currency.Currency.SelectedValue)),null!=this.Currency&&null!=this.Currency.ExchangeRate.Text&&""!=this.Currency.ExchangeRate.Text&&(t=parseFloat(this.Currency.ExchangeRate.Text)),""!=this.LCBillsXml){let e=new n.f;e.LoadXml(this.LCBillsXml);let t=e.SelectNodes("LCBillsXML/Row"),s=0;for(let i=0;i<t.length;i++)null!=t[i].attributes.AdjAmount&&""!=t[i].attributes.AdjAmount.value&&(s+=parseFloat(t[i].attributes.AdjAmount.value.replace("-","")));if(this.GridNetTotal+this.FooterGridNetTotal>s&&(this.DialogResult=!1,alert("Lc Amount is less than bill.\n Do you want to proceed?"),!this.DialogResult))return!1}}}if(this.IsAutoPost&&null!=parent||this.isSaveXml)return this.DisplayMessage="",this.savebulk?(j+="</DocXML>",P+="</NumXML>",A+="</TextXML>",M+="</CCXML>",T+="</AccXML>",N+="</EXTRAXML>",E+="</DocExtraXML>",this.parent.AutoPOstXML='<AutoPOstXML DocID="'+this.ScreenObject.DocID+'"  DocDetIDs="'+te+'" WOrkFlowID="'+this.GetWorkFlow(!1,null)+'" >'+T.toString()+j.toString()+P.toString()+M.toString()+N.toString()+A.toString()+"<BillXML>"+this.BillWiseXML+"</BillXML><ActXML "+this.getQuery()+"/>"):this.isSaveXml?this.AutoPOstXML='<AutoPOstXML  CCID="'+this.ScreenObject.CostCenterID+'"   DocID="'+this.ScreenObject.DocID+'"  DocDetIDs="'+te+'" WOrkFlowID="'+this.GetWorkFlow(!1,null)+'" ><DOCXML>'+T.toString()+"</DOCXML><BillXML>"+this.BillWiseXML+"</BillXML></AutoPOstXML>":(this.parent.AutoPOstXML='<AutoPOstXML DocID="'+this.ScreenObject.DocID+'"  DocDetIDs="'+te+'" WOrkFlowID="'+this.GetWorkFlow(!1,null)+'" ><DOCXML>'+T.toString()+"</DOCXML><BillXML>"+this.BillWiseXML+"</BillXML>",null!=this.AutoProduce&&""!=this.AutoProduceXML&&(this.parent.AutoPOstXML+=this.AutoProduceXML)),this.parent.AutoPOstXML+="</AutoPOstXML>",a.a.page.HideDialog(),!1;if(this.isAutoProduce&&null!=this.parent)return this.DisplayMessage="",this.parent.AutoProduceXML='<AutoProduceXML DocID="'+this.ScreenObject.DocID+'"  DocDetIDs="'+te+'" CostCenterID="'+this.CostCenterID+'" ><DOCXML>'+T.toString()+"</DOCXML><BillXML>"+this.BillWiseXML+"</BillXML></AutoProduceXML>",!1;n.e.IsEmpty(e)||(this.commandprarameter=e.toString());let me=0;if(this.LineWiseApproval||(me=this.GetWorkFlow(!1,null)),this.NotifWorkflowID=me,0==this.DocID&&this.ScreenObject.Preferences.ContainsKey("CreateActDoc")&&""!=this.ScreenObject.Preferences.CreateActDoc&&Object(o.j)(this.ScreenObject.Preferences.CreateActDoc)){if(null==this.ViewActivities?(this.ViewActivities=new Ue.b(this),this.Activities=new Xe.a(this,!1),this.ViewActivities.Activities=this.Activities):(this.Activities=new Xe.a(this,!1),this.ViewActivities.Activities=this.Activities),this.ScreenObject.Preferences.ContainsKey("ActSubject")&&!n.e.IsEmpty(this.ScreenObject.Preferences.ActSubject)){let e=this.ScreenObject._TextFields.find(e=>e instanceof b.c&&e.DBColumnName.toLowerCase()==this.ScreenObject.Preferences.ActSubject.toLowerCase());null!=e&&(this.Activities.Subject.Text=this.ScreenObject.GetcontrolValue(e))}if(this.ScreenObject.Preferences.ContainsKey("DocActDate")&&!n.e.IsEmpty(this.ScreenObject.Preferences.DocActDate)){let e=this.ScreenObject._TextFields.find(e=>e instanceof b.c&&e.DBColumnName.toLowerCase()==this.ScreenObject.Preferences.DocActDate.toLowerCase());if(null!=e){let t=this.ScreenObject.GetcontrolValue(e);n.e.isValidDate(t)&&(this.Activities.StartDate.Date=new Date(t))}}if(this.ScreenObject.Preferences.ContainsKey("DocActTime")&&!n.e.IsEmpty(this.ScreenObject.Preferences.DocActTime)){let e=this.ScreenObject._TextFields.find(e=>e instanceof b.c&&e.DBColumnName.toLowerCase()==this.ScreenObject.Preferences.DocActTime.toLowerCase());if(null!=e){let t=this.ScreenObject.GetcontrolValue(e);n.e.isValidDate("1/Jan/2020 "+t)&&(this.Activities.StartTime.SelectedValue=t)}}this.Activities.Status.SelectedValue="412",this.Activities.onSaveActivity("Save")}let be=[];if(this.savebulk)j+="</DocXML>",P+="</NumXML>",A+="</TextXML>",M+="</CCXML>",T+="</AccXML>",N+="</EXTRAXML>",E+="</DocExtraXML>",be.push(T),be.push(j),be.push(P),be.push(te),be.push(A),be.push(M),be.push(N),be.push(E),be.push(this.BillWiseXML),be.push(me.toString());else{if(be.push(T),be.push(this.BillWiseXML),be.push(this.payTermXml),be.push(te),be.push(this.LCBillsXml),35==this.ScreenObject.DocumentType?null!=this.ViewOrganizationViewModel&&be.push(this.ViewOrganizationViewModel.GetXML()):be.push(""),be.push(this.AutoPOstXML),be.push(this.POSpayXml),be.push(this.ChkRtnXml),be.push(Se.toString()),this.ScreenObject.Preferences.ContainsKey("SkipNegStock")&&"true"==this.ScreenObject.Preferences.SkipNegStock.toLowerCase()?be.push("false"):be.push(s.toString()),be.push(t.toString()),be.push(this.AutoProduceXML),be.push(le.length>0?"<AccountingDoc>"+le+"</AccountingDoc>":""),be.push(me.toString()),be.push(De),me>0&&this.ScreenObject.Preferences.ContainsKey("L1Remarks")&&"True"==this.ScreenObject.Preferences.L1Remarks&&("Save"==e.toString()||"SaveAndPrint"==e.toString())&&(a.a.page.ShowDialog(new W.a(this,2),H.a),n.e.IsEmpty(this.ReviseReason)||be.push(' L1Remarks="'+this.ReviseReason+'"')),(!Q&&""!=J||!U&&""!=Z)&&(I="",Q||""==J||(I=' BudQtyWhere="'+J+'"  BudID="'+X+'" BudStartDate="'+w.ToString("dd/MMM/yyyy")+'" '),U||""==Z||(I+=' ValueBudWhere="'+J+'"  ValueBudID="'+X+'" ValueBudStartDate="'+w.ToString("dd/MMM/yyyy")+'" '),be.push(I),I=""),l&&be.push(' IgnoreBatches="1"'),this.PoleDisplayMessage(3,null),this.PoleDisplaytimer.Enabled=!0,null!=this.strVacXml&&""!=this.strVacXml&&be[0].length>0){let e=this.ScreenObject._TextFields.find(e=>"dcalpha3"==e.DBColumnName.toLowerCase());if(e){let t=e.Date.AddDays(1).ToString("dd/MMM/yyyy");be[0]=be[0].replace("dcAlpha1=NULL","dcAlpha1=N'"+t+"'")}let t="";return this.strVacXml=this.strVacXml.replace("LAV",""),t+='<AVX><ApplyVacationXML DocID="0" DocDetIDs="" WorkFlowID="0" >',t+="<DOCXML>",this.strVacXml=this.strVacXml+t.toString(),this.strVacXml=this.strVacXml+be[0].toString(),this.strVacXml=this.strVacXml+"</DOCXML></ApplyVacationXML></AVX>",this.strVacXml=this.strVacXml.replace("\x11","<RowHead/>"),!0}if(!n.e.IsEmpty(this.strPMCXml)&&be[0].length>0){let e=new n.f;if(""!=a.a.SessionManager.FMExtraXml){e.LoadXml(a.a.SessionManager.FMExtraXml),this.iPMCActivity=this.iPMCActivity+1;let t=e.SelectNodes("xml/Row");for(let e=0;e<t.length;e++)if(""!=t[e].attributes.StartDate.Value){let s="";this.strPMCXml=this.strPMCXml.Replace("PRS",""),s+="<AVX>",s+='<PMCXML DocID="'+t[e].attributes.DocID.value.toString()+'" DocDetIDs="'+t[e].attributes.DocDetailsID.value.toString()+'" WorkFlowID="0" StartDate="'+new Date(t[e].attributes.StartDate.value).ToString("dd/MMM/yyyy")+'" DocSeqNo="'+this.iPMCActivity+'" >',s+="<DOCXML>",this.strPMCXml=this.strPMCXml+s.toString(),this.strPMCXml=this.strPMCXml+be[0].toString(),this.strPMCXml=this.strPMCXml+"</DOCXML></PMCXML>",s="",s+="<PMCACTIVITYXML>",s+="<DOCACTIVITYXML>#PMCACTIVITYXML#",this.strPMCXml=this.strPMCXml+s.toString(),this.strPMCXml=this.strPMCXml+"</DOCACTIVITYXML></PMCACTIVITYXML>",this.strPMCXml=this.strPMCXml+"</AVX>",this.strPMCXml=this.strPMCXml.Replace("\x11","<RowHead/>")}return null!=this.ViewActivities&&(this.strPMCXml=this.strPMCXml.Replace("#PMCACTIVITYXML#",this.ViewActivities.FMActivitiesXML(this.iPMCActivity-1))),!0}}if(null!=this.strADWxml&&""!=this.strADWxml&&be[0].length>0&&this.IsMPVParent){let e="";return this.strADWxml=this.strADWxml.replace("ADWxml",""),e+='<AttendanceDimensionwiseXML DocID="'+this.ScreenObject.DocID+'" DocDetIDs="'+te+'" WorkFlowID="'+this.GetWorkFlow(!1,null)+'" >',e+="<DOCXML>",this.strADWxml=this.strADWxml+e.toString(),this.strADWxml=this.strADWxml+be[0].toString(),this.strADWxml=this.strADWxml+"</DOCXML></AttendanceDimensionwiseXML>",this.strADWxml=this.strADWxml.replace("\x11","<RowHead/>"),this.DialogResult=!0,a.a.page.HideDialog(),!0}85==this.ScreenObject.DocumentType&&(this.sApprUpdate="")}console.log("SYNC_SAVE in "),this.InventorySave_DoWork(null,be),console.log("SYNC_SAVE out "),Logger.InfoLog("AddEditDocumentViewModel::Exiting OnSaveAccount")}catch(C){return a.a.SessionManager.IsWebApplication&&(this.DisplayMessage="Save Error"),Logger.ErrorLog("AddEditDocumentViewModel::"+C.stack,"SaveInventoryDocument",C.message),!1}return!0}FillAutoBatchesforDynamic(e){let t=!1,s=new re(this,this.ScreenObject.GridData[e],null);for(let i=0;i<s.GridData.length;i++)if("5"==s.GridData[i].Type.toString()&&n.e.IsEmpty(s.GridData[i].ExtraXML)){let r=0,l=0;if(this.ScreenObject.Preferences.ContainsKey("Donotuselocation")&&""!=this.ScreenObject.Preferences.Donotuselocation&&Object(o.j)(this.ScreenObject.Preferences.Donotuselocation)){let t=this.ScreenObject._CCFields.find(e=>"dcccnid2"==e.DBColumnName.toLowerCase());t&&t instanceof m.b&&t.SelectedValue>0?l=t.SelectedValue:n.e.IsEmpty(this.ScreenObject.GridData[e].dcCCNID2_Key)||(l=parseInt(this.ScreenObject.GridData[e].dcCCNID2_Key))}else l=this.ScreenObject.LocationID>0?this.ScreenObject.LocationID:a.a.SessionManager.LocationID;r=this.ScreenObject.DivisionID>0?this.ScreenObject.DivisionID:a.a.SessionManager.DivisionID;let c=n.e.Double(s.GridData[i].Quantity);if(c>0){t=!0;let e=new Te.a(this.ScreenObject.GridDataObj);e.BatchNumberViewModel_3(this,this.VoucherType,c,parseInt(s.GridData[i].ProductID_Key),s.GridData[i].ProductName.toString(),l,r,s.GridData[i],s.GridData),e.ChkFifo=!0,e.OnSave("AutoSave"),e.count>1&&this.ScreenObject.UpdateSequence()}}t&&s.OnButtonClick("OK")}AutoAdjustBOE(e){if(-1==this.VoucherType&&this.ScreenObject.Preferences.ContainsKey("AutoBOE")&&!n.e.IsEmpty(this.ScreenObject.Preferences.AutoBOE)&&Object(o.j)(this.ScreenObject.Preferences.AutoBOE)&&(this.ScreenObject.GridDataColumns.Contains("BOEAdjusted")||this.ScreenObject.GridDataColumns.push("BOEAdjusted")),0==e&&this.ScreenObject.GridDataColumns.Contains("BOEAdjusted"))for(let t=0;t<this.ScreenObject.GridData.length;t++)!this.ScreenObject.GridDataColumns.Contains("landingType")||"1"!=this.ScreenObject.GridData[e].landingType.toString()&&"2"!=this.ScreenObject.GridData[e].landingType.toString()||!n.e.IsEmpty(this.ScreenObject.GridData[e].DocDetailsID)&&0!=parseInt(this.ScreenObject.GridData[e].DocDetailsID)||(this.ScreenObject.GridData[t].DocExtraXML=null,this.ScreenObject.GridData[t].BinsXML=null),this.ScreenObject.GridData[t].BOEAdjusted="0";if((!this.ScreenObject.GridDataColumns.Contains("BOEAdjusted")||"1"!=this.ScreenObject.GridData[e].BOEAdjusted.toString())&&-1==this.VoucherType&&this.ScreenObject.Preferences.ContainsKey("AutoBOE")&&""!=this.ScreenObject.Preferences.AutoBOE.toString()&&Object(o.j)(this.ScreenObject.Preferences.AutoBOE)&&this.ScreenObject.GridDataColumns.Contains("landingType")&&("1"==this.ScreenObject.GridData[e].landingType.toString()||"2"==this.ScreenObject.GridData[e].landingType.toString())&&(n.e.IsEmpty(this.ScreenObject.GridData[e].DocDetailsID)||0==parseInt(this.ScreenObject.GridData[e].DocDetailsID))){let t=new le(this,2,this.ScreenObject.GridData[e]),s=t.LoadBoes("",this.ScreenObject.GridData[e]);t.FillBoeData(s);let i=0;n.e.IsEmpty(this.ScreenObject.GridData[e].UOMConvertedQty)||(i=parseFloat(this.ScreenObject.GridData[e].UOMConvertedQty));for(let a=0;a<t.GridData.length;a++)if(!n.e.IsEmpty(t.GridData[a].RefID)&&i>0){let s=n.e.Double(t.GridData[a].AvailQty);if(i>=s){if(t.GridData[a].Qty=s,this.ScreenObject.GridDataColumns.Contains("BinWise")&&"True"==this.ScreenObject.GridData[e].BinWise.toString()){let s=this.ScreenObject.GetinvBinDetails(t.GridData[a].RefID.toString(),this.ScreenObject.GridData[e].ProductID_Key.toString(),this.ScreenObject.GridData[e].LinkedInvDocDetailsID.toString());t.FillBins(s,0,t.GridData[a].RefID.toString())}i-=s}else{if(t.GridData[a].Qty=i,this.ScreenObject.GridDataColumns.Contains("BinWise")&&"True"==this.ScreenObject.GridData[e].BinWise.toString()){let s=this.ScreenObject.GetinvBinDetails(t.GridData[a].RefID.toString(),this.ScreenObject.GridData[e].ProductID_Key.toString(),this.ScreenObject.GridData[e].LinkedInvDocDetailsID.toString());t.FillBins(s,0,t.GridData[a].RefID.toString())}i=0}}t.SaveBoe(this.ScreenObject.GridData[e])}}GetBudgetXml(e){if(!this.ScreenObject.Preferences.ContainsKey("BudgetType")||""==this.ScreenObject.Preferences.BudgetType)return"";let t="";this.ScreenObject.Preferences.ContainsKey("BudgetAnnualAmount")&&this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.Preferences.BudgetAnnualAmount)&&(t=this.ScreenObject.Preferences.BudgetAnnualAmount);let s=12;"1"==this.ScreenObject.Preferences.BudgetType?s=6:"2"==this.ScreenObject.Preferences.BudgetType?s=3:"3"==this.ScreenObject.Preferences.BudgetType&&(s=1);let i="";i+='<DynPromXML BudgetDoc="'+this.ScreenObject.Preferences.BudgetDoc+'" >';let r=n.e.Double(e[t]),o=0,l=0;12==s?l=parseFloat((r/12).ToString("N"+a.a.SessionManager.Preferences.DecimalsinAmount)):(r=n.e.Double(e[this.ScreenObject.Preferences.BudgetField1]),l=parseFloat((r/s).ToString("N"+a.a.SessionManager.Preferences.DecimalsinAmount)));let c=this.DocumentDate;if(this.ScreenObject.GridDataColumns.Contains("BillDate_Key")&&!n.e.IsEmpty(e.BillDate_Key))c=new Date(e.BillDate_Key);else{let e=this.ScreenObject.HeaderFields.find(e=>e instanceof d.c&&"billdate"==e.DBColumnName.toLowerCase());null!=e&&e.Date&&(c=e.Date)}for(let h=1;h<=12;h++)if(h%s==0)if(1==s)r=n.e.Double(e[this.ScreenObject.Preferences["BudgetField"+h/s]]),l=parseFloat((r/s).ToString("N"+a.a.SessionManager.Preferences.DecimalsinAmount)),i+='<Row DocDate="'+c.AddMonths(h-1).ToString("dd/MMM/yyyy")+'" Amount="'+l+'" />';else{if(i+='<Row DocDate="'+c.AddMonths(h-1).ToString("dd/MMM/yyyy")+'" Amount="'+parseFloat((r-o).ToString("N"+a.a.SessionManager.Preferences.DecimalsinAmount))+'" />',12==h)continue;r=n.e.Double(e[this.ScreenObject.Preferences["BudgetField"+(h/s+1).toString()]]),l=parseFloat((r/s).ToString("N"+a.a.SessionManager.Preferences.DecimalsinAmount)),o=0}else i+='<Row DocDate="'+c.AddMonths(h-1).ToString("dd/MMM/yyyy")+'" Amount="'+l+'" />',o+=l;return i+="</DynPromXML>",i}CheckEmptyGrid(){let e=this.GetPrimaryColName();for(let s=0;s<this.ScreenObject.GridData.length;s++)if(!n.e.IsEmpty(this.ScreenObject.GridData[s][e]))return;let t=this.ScreenObject.ColumnSource.find(t=>null!=t.ValueMember&&t.ValueMember.toLowerCase()==e.toLowerCase());if(t&&""!=e&&!n.e.IsEmpty(t.DefaultValue)&&null!=t.DefaultValueText&&n.e.IsNum(t.DefaultValue)&&(parseInt(t.DefaultValue)>0||-100==parseInt(t.DefaultValue))){let s=t.DefaultValueText.split("\x11"),i=this.ScreenObject.GridData[this.GetEmptyRowPosition(this.ScreenObject.GridDataObj,e)];i.DocDetailsID=0,this.IsInventoryVoucher?(i.ProductID_Key=t.DefaultValue,this.ScreenObject.GridDataColumns.Contains("ProductCode")&&s.length>1&&(i.ProductCode=s[1]),this.ScreenObject.GridDataColumns.Contains("ProductName")&&s.length>0&&(i.ProductName=s[0]),this.AddProductData(i,!1,!1)):(i[e]=t.DefaultValue,this.ScreenObject.GridDataColumns.Contains("AccountCode")&&s.length>1&&(i.AccountCode=s[1]),this.ScreenObject.GridDataColumns.Contains("AccountName")&&s.length>0&&(i.AccountName=s[0]),this.FillDefaultValues(i)),this.CalculateTotals(i,!1)}}GetAssetValue(e,t,s){let i=e.Tables[1].filter(e=>e.SysColumnName==s);return i.length>0?this.ScreenObject.GetValueBYCOLID(i[0].BatchColID.toString(),t):e.Tables[0][0][s].toString()}getAssetDeprXML(e,t){let s=new tt.b(0),i=this.ScreenObject.GetAssetDetByProduct(parseInt(e.ProductID_Key.toString()));if(null!=i&&i.Tables.length>1&&i.Columns[0].Contains("IsDeprSchedule")&&i.Tables[0].length>0&&"1"==i.Tables[0][0].IsDeprSchedule.toString()){let r,o,l,c=0,h=0,u="0";c=n.e.Double(this.GetAssetValue(i,e,"PurchaseValue")),u=t?"0.1":this.GetAssetValue(i,e,"EstimateLife"),h=n.e.Double(this.GetAssetValue(i,e,"SalvageValue")),r=new Date(this.GetAssetValue(i,e,"DeprStartDate")),"2"==i.Tables[0][0].SalvageValueType.toString()&&(h=h*c/100);let d=0,D=0,S=0;try{let e=u.split(".");d=n.e.Int(e[0]),e.length>1&&(D=n.e.Int(e[1])),e.length>2&&(S=n.e.Int(e[2]))}catch(a){}t?(r=new Date(r.getFullYear(),r.getMonth(),1),o=r.AddMonths(D).AddDays(-1)):(o=r.AddYears(d),o=o.AddMonths(D),o=o.AddDays(S),o=o.AddDays(-1));let m=this.GetAssetValue(i,e,"DepreciationMethod"),b=this.GetAssetValue(i,e,"AveragingMethod"),C=this.GetAssetValue(i,e,"Period"),p=this.GetAssetValue(i,e,"DeprBookID");return s.GetScheduleData(c,d,D,0,null,0,h,m,C,0,b,r,o,null,p),l=s.ErrorMessage,s.GetXML().replace("XML","DeprXML")}return""}PickDbCr(e,t,s){let i=0;return s?null!=this.ScreenObject.CreditAccount?i=this.ScreenObject.CreditAccount.SelectedValue:n.e.Int(e.CreditAccount_Key)>0?i=parseInt(e.CreditAccount_Key):this.ScreenObject.GridDataColumns.Contains("CCQuery")&&n.e.Int(e.CreditAccount)>0?i=parseInt(e.CreditAccount):16!=this.ScreenObject.DocumentType&&17!=this.ScreenObject.DocumentType&&28!=this.ScreenObject.DocumentType&&29!=this.ScreenObject.DocumentType||(i=0!=n.e.Double(e.CreditAmount)&&n.e.Int(e.AccountID_Key)>0?parseInt(e.AccountID_Key):t):null!=this.ScreenObject.DebitAccount?i=this.ScreenObject.DebitAccount.SelectedValue:n.e.Int(e.DebitAccount_Key)>0?i=parseInt(e.DebitAccount_Key):this.ScreenObject.GridDataColumns.Contains("CCQuery")&&n.e.Int(e.DebitAccount)>0?i=parseInt(e.DebitAccount):16!=this.ScreenObject.DocumentType&&17!=this.ScreenObject.DocumentType&&28!=this.ScreenObject.DocumentType&&29!=this.ScreenObject.DocumentType||(i=0!=n.e.Double(e.DebitAmount)&&n.e.Int(e.AccountID_Key)>0?parseInt(e.AccountID_Key):t),i}FillCostPosting(e,t,s,i,r,o,l,c,h){let d=c.NoRoundOff?"6":c.DecimalPoints;h.CostXML="";let D="",S=!1,b=null;if(c.distDim>0)if(b=new n.f,c.distLineWise&&!n.e.IsEmpty(i[c.DisplayMember+"DistXML"]))b.ReadXml(i[c.DisplayMember+"DistXML"].toString());else{if(n.e.IsEmpty(c.distxml))return!1;b.ReadXml(c.distxml)}else{for(let s=0;s<r.length;s++){let a=r[s];if(parseInt(a)>5e4)if(this.ScreenObject.GridDataColumns.Contains("DCCCNID"+(parseInt(a)-5e4)+"_Key"))n.e.IsEmpty(i["DCCCNID"+(parseInt(a)-5e4)+"_Key"])||(D+=" and DCCCNID"+(parseInt(a)-5e4)+"="+i["DCCCNID"+(parseInt(a)-5e4)+"_Key"].toString());else{var p=this.ScreenObject._CCFields.find(e=>e instanceof m.b&&e.CCID==parseInt(a));p&&p.SelectedValue>0&&(D+=" and DCCCNID"+(parseInt(a)-5e4)+"="+p.SelectedValue.toString())}else 2==parseInt(a)?D+=" and AccountID in("+e+","+t+")":502==parseInt(a)&&(S=!0,D+=" and (db.AccountID is not null or Cr.AccountID is not null)")}b=this.ScreenObject.getProfileBasedon(e,t,S,D)}let y=!1;if(s<0&&(s*=-1,y=!0),null!=b&&b.Tables.length>0&&b.Tables[0].length>0&&(c.distDim>0||b.Columns[0].Contains("ProfileID"))){let r,D="",S=0;c.distDim>0?r.push[0]=c.distDim.toString():r=a.a.SessionManager.Preferences.DistributeCostDims.split(",");let p="";this.ScreenObject._CCFields.forEach(e=>{(e instanceof m.b&&e.SelectedValue>0&&!r.Contains(e.CCID.toString())||e instanceof C.a&&e.SelectedValue>0&&!r.Contains(e.CCID.toString()))&&(p+=e.DBColumnName+"="+e.SelectedValue+", ")});for(let e=0;e<this.ScreenObject.ColumnSource.length;e++)this.ScreenObject.ColumnSource[e].IsColumnUserDefined&&this.ScreenObject.ColumnSource[e].CostCenterID>5e4&&!r.Contains(this.ScreenObject.ColumnSource[e].CostCenterID.toString())&&this.ScreenObject.ColumnSource[e].DisplayMember.toLowerCase().startsWith("dcccnid")&&!n.e.IsEmpty(i[this.ScreenObject.ColumnSource[e].ValueMember])&&(p+=this.ScreenObject.ColumnSource[e].DisplayMember+"="+i[this.ScreenObject.ColumnSource[e].ValueMember].toString()+", ");let g=!1,O=this.ScreenObject._StaticFields.find(e=>"commonnarration"==e.DBColumnName.toLowerCase());for(let a=0;a<b.Tables[0].length;a++){let c=0;!n.e.IsEmpty(b.Tables[0][a].Percent)&&parseFloat(b.Tables[0][a].Percent.toString())>0?(c=parseFloat((s*parseFloat(b.Tables[0][a].Percent.toString())/100).ToString("N"+d)),g=!0):!n.e.IsEmpty(b.Tables[0][a].Amount)&&parseFloat(b.Tables[0][a].Amount.toString())>0&&(c=parseFloat(b.Tables[0][a].Amount.toString())),c>0&&(g&&a+1==b.Tables[0].length&&(c=parseFloat((s-S).ToString("N"+d))),S+=c,D+="\x11",D+='<Row><Transactions DocDetailsID="0" IsQtyIgnored="1" DocSeqNo="'+this.ScreenObject.GridData.length+'" ',D+='Quantity="" UOMConversion="1" UOMConvertedQty="1" Unit="1" Rate="'+c+'" ',D+=' CurrencyID="'+o+'" ExchangeRate="'+l+'" ',D+='Gross="'+c+'" StockValue="'+(c*l).ToString("N"+d).Replace(",","")+'" ',D+=' StockValueFC="'+c+'" ',D+=' DynamicInvDocDetailsID="-1" ProductID="'+i.ProductID_Key.toString()+'" ',y?(D+='  CreditAccount="'+e+'" ',D+='  DebitAccount="'+t.toString()+'" '):(D+='  CreditAccount="'+t+'" ',D+='  DebitAccount="'+e.toString()+'" '),null!=O&&null!=O&&(O instanceof u.d&&!n.e.IsEmpty(O.Text)||O instanceof u.c&&!n.e.IsEmpty(O.Text))&&(D+=' CommonNarration="'+u.d.GetValidXml(O.Text)+'" '),this.ScreenObject.GridDataColumns.Contains("LineNarration")&&(D+=' LineNarration="'+u.d.GetValidXml(i.LineNarration.toString())+'" '),D+=" ></Transactions>",D+="<AccountsXML><Accounts ",y?(D+='  CreditAccount="'+e+'" ',D+='  DebitAccount="'+t.toString()+'" ',D+='  IsNegative="1"'):(D+=' CreditAccount="'+t+'" ',D+='  DebitAccount="'+e.toString()+'" '),null!=O&&null!=O&&(O instanceof u.d&&!n.e.IsEmpty(O.Text)||O instanceof u.c&&!n.e.IsEmpty(O.Text))&&(D+=' CommonNarration="'+u.d.GetValidXml(O.Text)+'" '),this.ScreenObject.GridDataColumns.Contains("LineNarration")&&(D+=' LineNarration="'+u.d.GetValidXml(i.LineNarration.toString())+'" '),D+=' CurrencyID="'+o+'" ExchangeRate="'+l+'" ',D+='Amount="'+(c*l).ToString("N"+d).Replace(",","")+'" AmtFc="'+c+'" ></Accounts></AccountsXML>',D+="<EXTRAXML></EXTRAXML>",D+="<Numeric /><Alpha />",D+='<CostCenters Query="'+p.toString(),r.forEach(e=>{parseInt(e)>5e4&&b.Columns[0].Contains("DCCCNID"+(parseInt(e)-5e4))&&!n.e.IsEmpty(b.Tables[0][a]["DCCCNID"+(parseInt(e)-5e4)])&&(D+="DCCCNID"+(parseInt(e)-5e4)+"="+b.Tables[0][a]["DCCCNID"+(parseInt(e)-5e4)].toString()+",")}),D+='" ></CostCenters>',D+="</Row>")}return S=s-S,S>.01&&(D+="\x11",D+='<Row><Transactions DocDetailsID="0" IsQtyIgnored="1" DocSeqNo="'+this.ScreenObject.GridData.length+'" ',D+='Quantity="" UOMConversion="1" UOMConvertedQty="1" Unit="1" Rate="'+S+'" ',D+=' CurrencyID="'+o+'" ExchangeRate="'+l+'" ',D+='Gross="'+S+'" StockValue="'+(S*l).ToString("N"+d).Replace(",","")+'" ',D+=' StockValueFC="'+S+'" ',D+=' DynamicInvDocDetailsID="-1" ProductID="'+i.ProductID_Key.toString()+'" ',y?(D+='  CreditAccount="'+e+'" ',D+='  DebitAccount="'+t.toString()+'" '):(D+='  CreditAccount="'+t+'" ',D+='  DebitAccount="'+e.toString()+'" '),null!=O&&null!=O&&(O instanceof u.d&&!n.e.IsEmpty(O.Text)||O instanceof u.c&&!n.e.IsEmpty(O.Text))&&(D+=' CommonNarration="'+u.d.GetValidXml(O.Text)+'" '),this.ScreenObject.GridDataColumns.Contains("LineNarration")&&(D+=' LineNarration="'+u.d.GetValidXml(i.LineNarration.toString())+'" '),D+=" ></Transactions>",D+="<AccountsXML><Accounts ",y?(D+='  CreditAccount="'+e+'" ',D+='  DebitAccount="'+t.toString()+'" ',D+='  IsNegative="1"'):(D+=' CreditAccount="'+t+'" ',D+='  DebitAccount="'+e.toString()+'" '),null!=O&&null!=O&&(O instanceof u.d&&!n.e.IsEmpty(O.Text)||O instanceof u.c&&!n.e.IsEmpty(O.Text))&&(D+=' CommonNarration="'+u.d.GetValidXml(O.Text)+'" '),this.ScreenObject.GridDataColumns.Contains("LineNarration")&&(D+=' LineNarration="'+u.d.GetValidXml(i.LineNarration.toString())+'" '),D+=' CurrencyID="'+o+'" ExchangeRate="'+l+'" ',D+='Amount="'+(S*l).ToString("N"+d).Replace(",","")+'" AmtFc="'+S+'" ></Accounts></AccountsXML>',D+="<EXTRAXML></EXTRAXML>",D+="<Numeric /><Alpha />",D+='<CostCenters Query="'+p.toString(),D+='" ></CostCenters>',D+="</Row>"),h.CostXML=D.toString(),!0}return!1}FillAccountPosting(e,t,s,i,r,o,l=0,c=0){o.PostingXml="";let h="";h+="<Accounts ",o.DBAcc=0,o.CrACC=0;let d=!1;if(parseFloat(s)<0&&(d=!0),-98==e.DrRefColID||-99==e.DrRefColID){let s=0,i=0,r="";if(a.a.SessionManager.Preferences.ContainsKey("CrossDimension")&&""!=a.a.SessionManager.Preferences.CrossDimension.toString()&&(r="dcccnid"+(parseInt(a.a.SessionManager.Preferences.CrossDimension)-5e4)),this.ScreenObject.GridDataColumns.Contains(r+"_key")){if(n.e.IsEmpty(t[r+"_Key"])){let e=this.ScreenObject.ColumnSource.find(e=>e.DisplayMember==r);return this.DisplayMessage="Select ",e&&(this.DisplayMessage+=e.Header),this.DisplayMessage+=" at row:"+t.DocSeqNo.toString(),!1}s=parseInt(t[r+"_Key"])}else{let e=this.ScreenObject._CCFields.find(e=>e.DBColumnName.toLowerCase()==r);if(!(e&&e instanceof m.b))return this.DisplayMessage="Define Cross Dimension field to use Cross Dimension Debit or Credit.",!1;if(!(e.SelectedValue>0))return this.DisplayMessage="Select "+e.Label,!1;s=e.SelectedValue}if(r="to"+r,this.ScreenObject.GridDataColumns.Contains(r+"_key")){if(n.e.IsEmpty(t[r+"_Key"])){let e=this.ScreenObject.ColumnSource.find(e=>e.DisplayMember==r);return this.DisplayMessage="Select ",e&&(this.DisplayMessage+=e.Header),this.DisplayMessage+=" at row:"+t.DocSeqNo.toString(),!1}i=parseInt(t[r+"_Key"])}else{let e=this.ScreenObject._CCFields.find(e=>e.DBColumnName.toLowerCase()==r);if(!(e&&e instanceof m.b))return this.DisplayMessage="Define Cross Dimension field to use Cross Dimension Debit or Credit.",!1;if(!(e.SelectedValue>0))return this.DisplayMessage="Select "+e.Label,!1;i=e.SelectedValue}if(o.DBAcc=this.ScreenObject.GetAccountByRef(e.DrRefColID,s,i),0==o.DBAcc)return this.DisplayMessage="Cross dimension Accounts Not defined",!1}else if(56!=this.ScreenObject.DocumentType&&57!=this.ScreenObject.DocumentType||-3001!=e.DrRefColID&&-3002!=e.DrRefColID){if(0!=e.DrRefColID){if(e.DrRefColName&&3==e.DrRefSection&&(this.ScreenObject.GridDataColumns.Contains(e.DrRefColName+"_Key")||this.ScreenObject.GridDataColumns.Contains(e.DrRefColName)&&this.ScreenObject.GridDataColumns.Contains("CCQuery"))){if(this.ScreenObject.GridDataColumns.Contains("CCQuery")){if(n.e.IsEmpty(t[e.DrRefColName])){let s=this.ScreenObject.ColumnSource.find(t=>t.DisplayMember==e.DrRefColName);return this.DisplayMessage="Select ",s&&(this.DisplayMessage+=s.Header),this.DisplayMessage+=" at row:"+t.DocSeqNo.toString()+" for kit.",!1}o.DBAcc=this.ScreenObject.GetAccountByRef(e.DrRefID,e.DrRefColID,parseInt(t[e.DrRefColName]))}else{if(n.e.IsEmpty(t[e.DrRefColName+"_Key"])){let s=this.ScreenObject.ColumnSource.find(t=>t.DisplayMember==e.DrRefColName);return this.DisplayMessage="Select ",s&&(this.DisplayMessage+=s.Header),this.DisplayMessage+=" at row:"+t.DocSeqNo.toString(),!1}o.DBAcc=this.ScreenObject.GetAccountByRef(e.DrRefID,e.DrRefColID,parseInt(t[e.DrRefColName+"_Key"]))}if(0==o.DBAcc){let s=this.ScreenObject.ColumnSource.find(t=>null!=t.ValueMember&&t.ValueMember.toLowerCase()==e.DrRefColName.toLowerCase()+"_key");return this.DisplayMessage="Accounts Not defined for ",s&&(this.DisplayMessage+=s.Header,this.ScreenObject.GridDataColumns.Contains(s.DisplayMember)&&(this.DisplayMessage+=" :"+t[s.DisplayMember].toString())),this.DisplayMessage+=" at row:"+t.DocSeqNo.toString(),!1}}else if(1==e.DrRefSection||2==e.DrRefSection){if("debitaccount"==e.DrRefColName.toLowerCase()&&null!=this.ScreenObject.DebitAccount)o.DBAcc=this.ScreenObject.GetAccountByRef(e.DrRefID,e.DrRefColID,this.ScreenObject.DebitAccount.SelectedValue);else if("creditaccount"==e.DrRefColName.toLowerCase()&&null!=this.ScreenObject.CreditAccount)o.DBAcc=this.ScreenObject.GetAccountByRef(e.DrRefID,e.DrRefColID,this.ScreenObject.CreditAccount.SelectedValue);else{let t=this.ScreenObject._CCFields.find(t=>t.DBColumnName.toLowerCase()==e.DrRefColName.toLowerCase());if(t&&t instanceof m.b){if(!(t.SelectedValue>0))return this.DisplayMessage="Select "+t.Label,!1;if(o.DBAcc=this.ScreenObject.GetAccountByRef(e.DrRefID,e.DrRefColID,t.SelectedValue),0==o.DBAcc)return this.DisplayMessage="Accounts Not defined for "+t.Label+":"+t.Text,!1}}if(0==o.DBAcc)return"debitaccount"==e.DrRefColName.toLowerCase()&&null!=this.ScreenObject.DebitAccount?this.DisplayMessage="Accounts Not defined for "+this.ScreenObject.DebitAccount.Label+":"+this.ScreenObject.DebitAccount.Text:"creditaccount"==e.DrRefColName.toLowerCase()&&null!=this.ScreenObject.CreditAccount&&(this.DisplayMessage="Accounts Not defined for "+this.ScreenObject.CreditAccount.Label+":"+this.ScreenObject.CreditAccount.Text),!1}}else if(e.DebitAccount>0)o.DBAcc=e.DebitAccount;else if(o.DBAcc=this.PickDbCr(t,l,!(!d||1!=e.GridViewID)),0==o.DBAcc)return this.DisplayMessage="Select  DebitAccount",!1}else{let s=0,i=0,n=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());if(n&&(n instanceof m.b||n instanceof C.a)&&(n instanceof m.b&&n.SelectedValue>0||n instanceof C.a&&n.SelectedValue>0)&&(s=n.SelectedValue),56==this.ScreenObject.DocumentType)n=this.ScreenObject._CCFields.find(e=>"dcccnid52"==e.DBColumnName.toLowerCase()),n&&n instanceof m.b&&n.SelectedValue>0&&(i=n.SelectedValue);else if(57==this.ScreenObject.DocumentType){let e=this.ScreenObject.ColumnSource.find(e=>"dcccnid52"==e.DisplayMember.toLowerCase());e&&this.ScreenObject.GridDataColumns.Contains(e.DisplayMember+"_key")&&(i=parseInt(t[e.DisplayMember+"_Key"]))}let r=a.a.common.GetDataSet3("DOC008",s.toString(),i.toString());if(null!=r&&r.Tables[0].length>0&&(o.DBAcc=-3001==e.DrRefColID?parseInt(r.Tables[0][0].CreditAccountID):parseInt(r.Tables[0][0].DebitAccountID)),0==o.DBAcc)return this.DisplayMessage=-3001==e.DrRefColID?"Credit Account not defined for this Loan Type in Employee Master":"Debit Account not defined for this Loan Type in Employee Master",!1}if(-98==e.CrRefColID||-99==e.CrRefColID){let s=0,i=0,r="";if(a.a.SessionManager.Preferences.ContainsKey("CrossDimension")&&""!=a.a.SessionManager.Preferences.CrossDimension.toString()&&(r="dcCCNID"+(parseInt(a.a.SessionManager.Preferences.CrossDimension)-5e4)),this.ScreenObject.GridDataColumns.Contains(r+"_key")){if(n.e.IsEmpty(t[r+"_Key"])){let e=this.ScreenObject.ColumnSource.find(e=>e.DisplayMember==r);return this.DisplayMessage="Select ",e&&(this.DisplayMessage+=e.Header),this.DisplayMessage+=" at row:"+t.DocSeqNo.toString(),!1}s=parseInt(t[r+"_Key"])}else{let e=this.ScreenObject._CCFields.find(e=>e.DBColumnName.toLowerCase()==r);if(!(e&&e instanceof m.b))return this.DisplayMessage="Define Cross Dimension field to use Cross Dimension Debit or Credit.",!1;if(!(e.SelectedValue>0))return this.DisplayMessage="Select "+e.Label,!1;s=e.SelectedValue}if(r="to"+r,this.ScreenObject.GridDataColumns.Contains(r+"_key")){if(n.e.IsEmpty(t[r+"_Key"])){let e=this.ScreenObject.ColumnSource.find(e=>e.DisplayMember==r);return this.DisplayMessage="Select ",e&&(this.DisplayMessage+=e.Header),this.DisplayMessage+=" at row:"+t.DocSeqNo.toString(),!1}i=parseInt(t[r+"_Key"])}else{let e=this.ScreenObject._CCFields.find(e=>e.DBColumnName.toLowerCase()==r);if(!(e&&e instanceof m.b))return this.DisplayMessage="Define Cross Dimension field to use Cross Dimension Debit or Credit.",!1;if(!(e.SelectedValue>0))return this.DisplayMessage="Select "+e.Label,!1;i=e.SelectedValue}if(o.CrACC=this.ScreenObject.GetAccountByRef(e.CrRefColID,s,i),0==o.CrACC)return this.DisplayMessage="Cross dimension Accounts Not defined",!1}else if(56!=this.ScreenObject.DocumentType&&57!=this.ScreenObject.DocumentType||-3001!=e.CrRefColID&&-3002!=e.CrRefColID){if(0!=e.CrRefColID){if(""!=e.CrRefColName&&3==e.CrRefSection&&this.ScreenObject.GridDataColumns.Contains(e.CrRefColName+"_Key")||this.ScreenObject.GridDataColumns.Contains("CCQuery")&&this.ScreenObject.GridDataColumns.Contains(e.CrRefColName)){if(this.ScreenObject.GridDataColumns.Contains("CCQuery")){if(n.e.IsEmpty(t[e.CrRefColName])){let s=this.ScreenObject.ColumnSource.find(t=>t.DisplayMember==e.CrRefColName);return this.DisplayMessage="Select ",s&&(this.DisplayMessage+=s.Header),this.DisplayMessage+=" at row:"+t.DocSeqNo.toString()+" int kit.",!1}o.CrACC=this.ScreenObject.GetAccountByRef(e.CrRefID,e.CrRefColID,parseInt(t[e.CrRefColName]))}else{if(n.e.IsEmpty(t[e.CrRefColName+"_Key"])){let s=this.ScreenObject.ColumnSource.find(t=>t.DisplayMember==e.CrRefColName);return this.DisplayMessage="Select ",s&&(this.DisplayMessage+=s.Header),this.DisplayMessage+=" at row:"+t.DocSeqNo.toString(),!1}o.CrACC=this.ScreenObject.GetAccountByRef(e.CrRefID,e.CrRefColID,parseInt(t[e.CrRefColName+"_Key"]))}if(0==o.CrACC){let s=this.ScreenObject.ColumnSource.find(t=>null!=t.ValueMember&&t.ValueMember.toLowerCase()==e.CrRefColName.toLowerCase()+"_key");return this.DisplayMessage="Accounts Not defined for ",s&&(this.DisplayMessage+=s.Header,this.ScreenObject.GridDataColumns.Contains(s.DisplayMember)&&(this.DisplayMessage+=" :"+t[s.DisplayMember].toString())),this.DisplayMessage+=" at row:"+t.DocSeqNo.toString(),!1}}else if(1==e.CrRefSection||2==e.CrRefSection){if("debitaccount"==e.CrRefColName.toLowerCase()&&null!=this.ScreenObject.DebitAccount)o.CrACC=this.ScreenObject.GetAccountByRef(e.CrRefID,e.CrRefColID,this.ScreenObject.DebitAccount.SelectedValue);else if("creditaccount"==e.CrRefColName.toLowerCase()&&null!=this.ScreenObject.CreditAccount)o.CrACC=this.ScreenObject.GetAccountByRef(e.CrRefID,e.CrRefColID,this.ScreenObject.CreditAccount.SelectedValue);else{let t=this.ScreenObject._CCFields.find(t=>t.DBColumnName.toLowerCase()==e.CrRefColName.toLowerCase());if(t&&t instanceof m.b){if(!(t.SelectedValue>0))return this.DisplayMessage="Select "+t.Label,!1;if(o.CrACC=this.ScreenObject.GetAccountByRef(e.CrRefID,e.CrRefColID,t.SelectedValue),0==o.CrACC)return this.DisplayMessage="Accounts Not defined for "+t.Label+":"+t.Text,!1}}if(0==o.CrACC)return"debitaccount"==e.CrRefColName.toLowerCase()&&null!=this.ScreenObject.DebitAccount?this.DisplayMessage="Accounts Not defined for "+this.ScreenObject.DebitAccount.Label+":"+this.ScreenObject.DebitAccount.Text:"creditaccount"==e.CrRefColName.toLowerCase()&&null!=this.ScreenObject.CreditAccount&&(this.DisplayMessage="Accounts Not defined for "+this.ScreenObject.CreditAccount.Label+":"+this.ScreenObject.CreditAccount.Text),!1}}else if(e.CreditAcount>0)o.CrACC=e.CreditAcount;else if(o.CrACC=this.PickDbCr(t,l,!d||1!=e.GridViewID),0==o.CrACC)return this.DisplayMessage="Select  CreditAcount",!1}else{let s=0,i=0,n=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());if(n&&n instanceof m.b?n.SelectedValue>0&&(s=n.SelectedValue):n&&n instanceof C.a&&n.SelectedValue>0&&(s=n.SelectedValue),56==this.ScreenObject.DocumentType)n=this.ScreenObject._CCFields.find(e=>"dcccnid52"==e.DBColumnName.toLowerCase()),n&&n instanceof m.b&&n.SelectedValue>0&&(i=n.SelectedValue);else if(57==this.ScreenObject.DocumentType){let e=this.ScreenObject.ColumnSource.find(e=>"dcccnid52"==e.DisplayMember.toLowerCase());e&&this.ScreenObject.GridDataColumns.Contains(e.DisplayMember+"_key")&&(i=parseInt(t[e.DisplayMember+"_Key"]))}let r=a.a.common.GetDataSet3("DOC008",s.toString(),i.toString());if(r&&r.Tables[0].length>0&&(o.CrACC=-3001==e.CrRefColID?parseInt(r.Tables[0][0].CreditAccountID):parseInt(r.Tables[0][0].DebitAccountID)),0==o.CrACC)return this.DisplayMessage=-3001==e.DrRefColID?"Credit Account not defined for this Loan Type in Employee Master":"Debit Account not defined for this Loan Type in Employee Master",!1}if(o.DBAcc<=0&&o.CrACC<=0&&(16==this.ScreenObject.DocumentType||17==this.ScreenObject.DocumentType||28==this.ScreenObject.DocumentType||29==this.ScreenObject.DocumentType))return!0;if(30==this.ScreenObject.DocumentType&&this.ScreenObject.GridDataColumns.Contains("vouchertype")&&"1"==t.vouchertype.toString()){let e=o.DBAcc;o.DBAcc=o.CrACC,o.CrACC=e}h+=this.ScreenObject.GetAccountTransaction(o.DBAcc.toString(),o.CrACC.toString(),s,i,r,e.NoRoundOff?"6":e.DecimalPoints);let D=this.ScreenObject._StaticFields.find(e=>"commonnarration"==e.DBColumnName.toLowerCase());D&&(D instanceof u.d&&!n.e.IsEmpty(D.Text)||D instanceof u.c&&!n.e.IsEmpty(D.Text))&&(h+=' CommonNarration="'+u.d.GetValidXml(D.Text)+'" '),h+=' DocSeqNo="'+c+'" ',n.e.IsEmpty(t.LineNarration)||(h+=' LineNarration="'+u.d.GetValidXml(t.LineNarration)+'" ');let S=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&50403==e.LinkData);return S.length>0&&S[0].CostCenterColID.toString()==e.ID&&(h+=' IsExchangeGL="1" '),!this.ScreenObject.Preferences.ContainsKey("UseasCrossDimension")||"true"!=this.ScreenObject.Preferences.UseasCrossDimension.toLowerCase()||2!=e.Dependancy&&3!=e.Dependancy||(h+=' FromTo="'+e.Dependancy+'" '),h+=" ></Accounts>",o.PostingXml=h.toString(),!0}PostCrossDimDOc(){if(this.ScreenObject.Preferences.ContainsKey("CrossDimDocument")&&""!=this.ScreenObject.Preferences.CrossDimDocument&&parseInt(this.ScreenObject.Preferences.CrossDimDocument)>0){let i=new es(parseInt(this.ScreenObject.Preferences.CrossDimDocument),"",!0);{let r,o,l;i.OKCancelVisibility=!0;let c,h=0;if(a.a.SessionManager.Preferences.ContainsKey("CrossDimension")&&""!=a.a.SessionManager.Preferences.CrossDimension.toString()){r=parseInt(a.a.SessionManager.Preferences.CrossDimension.toString());var e=this.ScreenObject._CCFields.find(e=>e instanceof m.b&&e.CCID==r);if(null!=e&&e.SelectedValue>0&&(c=e.SelectedValue),this.ScreenObject.Preferences.ContainsKey("CrossDimField")){o=n.e.IntTryParse(this.ScreenObject.Preferences.CrossDimField),null!=(e=this.ScreenObject._TextFields.find(e=>e.DBColumnID==o))&&e instanceof m.b&&e.SelectedValue>0&&(h=e.SelectedValue);let u=this.ScreenObject.GetCrossDimLinkDetails(c,h,this.CostCenterID,i.CostCenterID,this.ScreenObject.DocID);if(0==u.Tables[0].length)return this.DisplayMessage="Map Accounts for Cross Dimension",this.MessageVisibility=!0,"0";if(!n.e.IsEmpty(u.Tables[0][0].docid)){i.ScreenObject.DocID=parseInt(u.Tables[0][0].docid.toString());let e=i.ScreenObject.GetEditDataByDOCID();null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&(i.ScreenObject.LoadEditData(e,!1),i.ScreenObject.VoucherNo=n.e.String(e.Tables[0][0].VoucherNo))}if(null!=(e=i.ScreenObject._CCFields.find(e=>e instanceof m.b&&e.CCID==r))&&e instanceof m.b&&e.SelectedValue>0&&(e.SelectedValue=h),this.LoadLinkFieldsData(u.Tables[1],i.ScreenObject._StaticFields),this.LoadLinkFieldsData(u.Tables[1],i.ScreenObject._TextFields),this.LoadLinkFieldsData(u.Tables[1],i.ScreenObject._numericFields),this.LoadLinkFieldsData(u.Tables[1],i.ScreenObject._CCFields),u.Tables[0].length>0&&(null!=i.ScreenObject.CreditAccount&&""!=u.Tables[0][0].CrAccount.toString()&&(i.ScreenObject.CreditAccount.SelectedValue=parseInt(u.Tables[0][0].CrAccount.toString())),null!=i.ScreenObject.DebitAccount&&""!=u.Tables[0][0].DrAccount.toString()&&(i.ScreenObject.DebitAccount.SelectedValue=parseInt(u.Tables[0][0].DrAccount.toString()))),i.ScreenObject.DocID>0){i.ScreenObject.GridDataColumns.Contains("IsChecked")||i.ScreenObject.GridDataColumns.push("IsChecked");for(let e=0;e<i.ScreenObject.GridData.length;e++)i.ScreenObject.GridData[e].IsChecked=0}for(let e=0;e<this.ScreenObject.GridData.length;e++){let r=null;if(i.ScreenObject.DocID>0&&!n.e.IsEmpty(this.ScreenObject.GridData[e].DocDetailsID)){var t=i.ScreenObject.GridData.filter(t=>t.LinkedInvDocDetailsID==this.ScreenObject.GridData[e].DocDetailsID.toString());t.length>0&&(r=t[0])}null==r&&(r=i.ScreenObject.GridData[this.GetEmptyRowPosition(i.ScreenObject.GridDataObj,"ProductID_Key")]),r.DocSeqNo=this.ScreenObject.GridData[e].DocSeqNo.toString(),u.Tables[0].length>0&&(i.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!n.e.IsEmpty(u.Tables[0][0].CrAccount)&&(r.CreditAccount_Key=parseInt(u.Tables[0][0].CrAccount.toString())),i.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!n.e.IsEmpty(u.Tables[0][0].DrAccount)&&(r.DebitAccount_Key=parseInt(u.Tables[0][0].DrAccount.toString()))),i.ScreenObject.GridDataColumns.Contains("IsChecked")&&(r.IsChecked=1);for(let t=0;t<i.ScreenObject.ColumnSource.length;t++){if("DocDetailsID"==i.ScreenObject.ColumnSource[t].DisplayMember||"RefNo"==i.ScreenObject.ColumnSource[t].DisplayMember||"LinkedFieldName"==i.ScreenObject.ColumnSource[t].DisplayMember)continue;"LINK"==i.ScreenObject.ColumnSource[t].DataType&&i.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase().Contains("dcalpha")&&(r[i.ScreenObject.ColumnSource[t].DisplayMember]="...");let s=null;if(s=3!=i.ScreenObject.ColumnSource[t].CostCenterID||i.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase().Contains("alpha")?u.Tables[1].filter(i.ScreenObject.ColumnSource[t].CostCenterID>0&&null!=i.ScreenObject.ColumnSource[t].ValueMember?e=>e.BASECOL==i.ScreenObject.ColumnSource[t].ValueMember.Replace("_Key",""):"ComboBox"==i.ScreenObject.ColumnSource[t].DataType||"PactComboBox"==i.ScreenObject.ColumnSource[t].DataType?e=>e.BASECOL==i.ScreenObject.ColumnSource[t].ValueBinding+"'":e=>e.BASECOL==i.ScreenObject.ColumnSource[t].DisplayMember+"'"):u.Tables[1].filter(e=>"ProductID"==e.BASECOL),s.length>0){let o=this.ScreenObject.GetValueBYCOLID(s[0].CostCenterColIDLinked.toString(),this.ScreenObject.GridData[e]);if(""==o)continue;if(0!=i.ScreenObject.ColumnSource[t].CostCenterID)if("SELECTIONBOX"==i.ScreenObject.ColumnSource[t].DataType)r[i.ScreenObject.ColumnSource[t].DisplayMember]=o;else{let e=0;n.e.IsEmpty(o)||(e=n.e.IntTryParse(o),r[i.ScreenObject.ColumnSource[t].ValueMember]=o,n.e.IsEmpty(r[i.ScreenObject.ColumnSource[t].DisplayMember])||(r[i.ScreenObject.ColumnSource[t].DisplayMember]=null))}else if("ComboBox"==i.ScreenObject.ColumnSource[t].DataType)r[i.ScreenObject.ColumnSource[t].ValueBinding]=o;else if("PactComboBox"==i.ScreenObject.ColumnSource[t].DataType)r[i.ScreenObject.ColumnSource[t].ValueBinding]=o,r[i.ScreenObject.ColumnSource[t].ValueBinding+"_Key"]=o;else if("DATE"==i.ScreenObject.ColumnSource[t].DataType){let e=new Date;!n.e.IsEmpty(o)&&n.e.isValidDate(o)&&(e=new Date(o),r[i.ScreenObject.ColumnSource[t].DisplayMember]=new Date(o).ToString(a.a.SessionManager.Preferences["Date Format"]),r[i.ScreenObject.ColumnSource[t].DisplayMember+"_Key"]=new Date(e))}else"DATETIME"==i.ScreenObject.ColumnSource[t].DataType||"TIME"==i.ScreenObject.ColumnSource[t].DataType?(new Date,!n.e.IsEmpty(o)&&n.e.isValidDate(o)&&(r[i.ScreenObject.ColumnSource[t].DisplayMember+"_Key"]=new Date(o),r[i.ScreenObject.ColumnSource[t].DisplayMember]=new Date(o).ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss tt"))):"TIME2"==i.ScreenObject.ColumnSource[t].DataType.toUpperCase()?(new Date,!n.e.IsEmpty(o)&&n.e.isValidDate(o)&&(r[i.ScreenObject.ColumnSource[t].DisplayMember+"_Key"]=new Date(o),r[i.ScreenObject.ColumnSource[t].DisplayMember]=new Date(o).ToString("HH:mm"))):"double"==i.ScreenObject.GridDataColumns[i.ScreenObject.ColumnSource[t].DisplayMember].DataType?n.e.IsEmpty(o)||(l=n.e.IntTryParse(o),r[i.ScreenObject.ColumnSource[t].DisplayMember]=l):r[i.ScreenObject.ColumnSource[t].DisplayMember]=o}}if(r.Type=this.ScreenObject.GridData[e].Type.toString(),"5"==r.Type.toString()&&!n.e.IsEmpty(this.ScreenObject.GridData[e].Extraxml)){let t=new n.f;t.LoadXml(this.ScreenObject.GridData[e].Extraxml.toString());var s=t.FirstChild.FirstChild.attributes.RefInvID;null!=s&&t.FirstChild.FirstChild.Attributes.Remove(s),null!=(s=t.FirstChild.FirstChild.attributes.Release)?s.value=t.FirstChild.FirstChild.attributes.Quantity.value:((s=t.CreateAttribute("Release")).value=t.FirstChild.FirstChild.attributes.Quantity.value,t.FirstChild.FirstChild.Attributes+=s),r.Extraxml=t.OuterXml}i.CalculateTotals(r,!1,"Quantity")}if(i.ScreenObject.DocID>0&&i.ScreenObject.GridDataColumns.Contains("IsChecked"))for(let e=0;e<i.ScreenObject.GridData.length;e++)"0"==i.ScreenObject.GridData[e].IsChecked.toString()&&(i.ScreenObject.GridDataObj.removeRowAt(e),e--);return i.parent=this,i.IsAutoPost=!0,i.SaveInventoryDocument("Save",!1),n.e.IsEmpty(i.DisplayMessage)?this.AutoPOstXML.Replace("AutoPOstXML","CrossDimXML"):(this.DisplayMessage=" Cross Dimension: "+i.DisplayMessage,this.MessageVisibility=!0,"0")}}}}return""}LoadLinkFieldsData(e,t){null!=e&&t.forEach(t=>{var s=e.filter(e=>e.BASECOL==t.DBColumnName);if(s.length>0){let e=this.ScreenObject.GetValueBYCOLID(s[0].CostCenterColIDLinked.toString(),null);this.ScreenObject.fillcontrolValue(t,e)}})}InventorySave_DoWork(e,t){if(this.DisplayMessage=a.a.GetResource("SavingDocumentPleasewait"),console.log("InventorySave_DoWork In"),t.length>4){this.RetValue=0;let e="<XML   ";if(null!=this.commandprarameter&&"SaveonHold"==this.commandprarameter?e+=' status="'+this.commandprarameter+'"':null!=this.commandprarameter&&"Revise"==this.commandprarameter?(e+=' IsRevision="1"',e+=' ReviseReason="'+this.ReviseReason+'"'):null==this.commandprarameter||"Approve"!=this.commandprarameter&&"ApproveandPrint"!=this.commandprarameter||(e+=' AppRejDate="'+this.AppRejDate.Date.ToString("dd/MMM/yyyy")+'"',e+=' Remarks="'+u.d.GetValidXml(this.Remarks.Text)+'"',this.IsLocked&&a.a.SessionManager.Preferences.ContainsKey("PostLockedDocs")&&Object(o.j)(a.a.SessionManager.Preferences.PostLockedDocs)&&(e+=' LockedPosting="1"')),!this.IsLockDimsLineWise&&null!=this.LockDims){let t={join:""};e+=' LockDims="'+this.GetLockQuery(null,t)+'" ',""!=t.join&&(e+=' LockDimsjoin="'+t.join+'" ')}if(this.GenratePrefix&&(e+=' GenratePrefix="1" '),e+=' SysInfo="'+a.a.SessionManager.GetSysInfo()+'" ',this.IsPOs&&Object(o.j)(t[11])&&(e+=' PosSessionID="'+this.PosSessionID+'"'),!this.savebulk&&t.length>10&&(e+=' CheckStock="'+t[10]+'" '),!this.savebulk&&t.length>16&&(e+=t[16]),!this.savebulk&&t.length>17&&(e+=t[17]),!this.savebulk&&t.length>18&&(e+=t[18]),(null!=this.commandprarameter&&("NoWorkFlow"==this.commandprarameter||"NoWorkFlowReSave"==this.commandprarameter||"NoWorkFlowprint"==this.commandprarameter)||this.ScreenObject.Preferences.ContainsKey("NoWorkflowPostedDocs")&&""!=this.ScreenObject.Preferences.NoWorkflowPostedDocs&&Object(o.j)(this.ScreenObject.Preferences.NoWorkflowPostedDocs)&&369==this.StatusID)&&(e+=' WorkFlow="NO"'),this.ScreenObject.IsDocEdit&&(e+=' Guid="'+n.e.String(this.ScreenObject.guid)+'"'),this.LineWiseApproval&&(e+=' LineWiseApproval="1"'),e+=' CCGuid="'+n.e.String(this.ScreenObject.CCguid)+'"',e+=' AP="'+a.a.SessionManager.GetAccessPoint()+'"',!this.savebulk&&t.length>9&&Object(o.j)(t[9])&&(e+=' SaveUnapproved="1"'),a.a.SessionManager.AccountingFromMonth>a.a.SessionManager.AccountingToMonth){let t="",s="";t=this.DocumentDate.iMonth()>a.a.SessionManager.AccountingFromMonth?"1/"+this.ScreenObject.GetMonthName(a.a.SessionManager.AccountingFromMonth,!1)+"/"+this.DocumentDate.getFullYear():"1/"+this.ScreenObject.GetMonthName(a.a.SessionManager.AccountingFromMonth,!1)+"/"+(this.DocumentDate.getFullYear()-1).toString(),s=this.DocumentDate.iMonth()<a.a.SessionManager.AccountingFromMonth?n.e.DaysInMonth(this.DocumentDate.getFullYear(),a.a.SessionManager.AccountingToMonth-1)+"/"+this.ScreenObject.GetMonthName(a.a.SessionManager.AccountingToMonth,!1)+"/"+this.DocumentDate.getFullYear():n.e.DaysInMonth(this.DocumentDate.getFullYear()+1,a.a.SessionManager.AccountingToMonth-1)+"/"+this.ScreenObject.GetMonthName(a.a.SessionManager.AccountingToMonth,!1)+"/"+(this.DocumentDate.getFullYear()+1).toString(),e+=' FinancialSartDate="'+t+'"',e+=' FinancialEndDate="'+s+'"'}else e+=' FinancialSartDate="1/'+this.ScreenObject.GetMonthName(a.a.SessionManager.AccountingFromMonth,!1)+"/"+this.DocumentDate.getFullYear()+'"',e+=' FinancialEndDate="'+n.e.DaysInMonth(this.DocumentDate.getFullYear(),a.a.SessionManager.AccountingToMonth-1)+"/"+this.ScreenObject.GetMonthName(a.a.SessionManager.AccountingToMonth,!1)+"/"+this.DocumentDate.getFullYear()+'"';if(t[3].length>1&&(e+=' DetailIds="'+t[3].substr(1)+'"'),this.ScreenObject.Preferences.ContainsKey("Enable Hold")&&Object(o.j)(this.ScreenObject.Preferences["Enable Hold"])){let t=this.ScreenObject.ColumnSource.find(e=>"HoldQuantity"==e.DisplayMember);t&&null!=t.Expression&&""!=t.Expression&&(e+=' HoldCheck="1"')}if(this.savebulk&&(e+=this.getQuery()),e+=" >",e+=null!=this.ViewActivities?this.ViewActivities.ActivitiesXML():"<ScheduleActivityXml></ScheduleActivityXml>",n.e.IsEmpty(this.ScreenObject.HistoryCCXML)||(e+="<History>"+this.ScreenObject.HistoryCCXML+"</History>"),this.ScreenObject.Preferences.ContainsKey("CrossDimDocument")&&!n.e.IsEmpty(this.ScreenObject.Preferences.CrossDimDocument)&&parseInt(this.ScreenObject.Preferences.CrossDimDocument)>0){let t=this.PostCrossDimDOc();if("0"==t)return;e+=t}if(32==this.ScreenObject.DocumentType){let t="",s=this.ScreenObject.ColumnSource.find(e=>e.ID==this.ScreenObject.Preferences.VarienceField);if(s&&(t=s.DisplayMember),this.ScreenObject.Preferences.ContainsKey("ShortageDOC")&&""!=this.ScreenObject.Preferences.ShortageDOC&&""!=t&&this.ScreenObject.GridDataColumns.Contains(t)){let s=new es(parseInt(this.ScreenObject.Preferences.ShortageDOC),"",!0);{let i;s.CheckStockDimensions(),s.ScreenObject.GridDataColumns.push("ParentSeqNo"),s.ScreenObject._CCFields.forEach(e=>{if(e instanceof m.b){let t=this.ScreenObject._CCFields.find(t=>t instanceof m.b&&t.CCID==e.CCID);t instanceof m.b&&(e.SelectedValue=t.SelectedValue)}});let a=0;for(let e=0;e<this.ScreenObject.GridData.length;e++)!n.e.IsEmpty(this.ScreenObject.GridData[e].ProductID_Key)&&!n.e.IsEmpty(this.ScreenObject.GridData[e][t])&&parseFloat(this.ScreenObject.GridData[e][t])<0&&(a++,i=s.ScreenObject.GridDataObj.NewRow(),s.ScreenObject.ColumnSource.forEach(t=>{if(t.CostCenterID>5e4)if(this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(t.CostCenterID-5e4)))n.e.IsEmpty(this.ScreenObject.GridData[e]["dcCCNID"+(t.CostCenterID-5e4)+"_Key"])||(i["dcCCNID"+(t.CostCenterID-5e4)+"_Key"]=this.ScreenObject.GridData[e]["dcCCNID"+(t.CostCenterID-5e4)+"_Key"].toString(),i["dcCCNID"+(t.CostCenterID-5e4)]=this.ScreenObject.GridData[e]["dcCCNID"+(t.CostCenterID-5e4)].toString());else{let e=this.ScreenObject._CCFields.find(e=>e instanceof m.b&&e.CCID==t.CostCenterID);e instanceof m.b&&(i["dcCCNID"+(t.CostCenterID-5e4)]=e.SelectedValue)}}),i.ProductID_Key=this.ScreenObject.GridData[e].ProductID_Key.toString(),i.QOH=this.ScreenObject.GridData[e].QOH.toString(),i.ParentSeqNo=this.ScreenObject.GridData[e].DocSeqNo.toString(),s.ScreenObject.GridDataColumns.Contains("ProductCode")&&(i.ProductCode=this.ScreenObject.GridData[e].ProductCode),s.ScreenObject.GridDataColumns.Contains("ProductName")&&(i.ProductName=this.ScreenObject.GridData[e].ProductName),i.Type=this.ScreenObject.GridData[e].Type,i.Unit=this.ScreenObject.GridData[e].Unit,i.Unit_Key=this.ScreenObject.GridData[e].Unit_Key,i.Rate=this.ScreenObject.GridData[e].Rate,this.ScreenObject.Preferences.ContainsKey("DontCalcQOH")&&!n.e.IsEmpty(this.ScreenObject.Preferences.DontCalcQOH)&&Object(o.j)(this.ScreenObject.Preferences.DontCalcQOH)||s.AddProductData(i,!1,!0),i.Quantity=this.ScreenObject.GridData[e][t].toString().replace("-",""),n.e.IsEmpty(i.UOMConversion)?(i.UOMConversion="1",i.UOMConvertedQty=i.Quantity):i.UOMConvertedQty=parseFloat(i.Quantity)*parseFloat(i.UOMConversion),n.e.IsEmpty(this.ScreenObject.GridData[e].Type)||5!=parseInt(this.ScreenObject.GridData[e].Type.toString())&&2!=parseInt(this.ScreenObject.GridData[e].Type.toString())||(i.ExtraXML=this.ScreenObject.GridData[e].ExtraXML),s.ScreenObject.GridData.push(i),s.CalculateTotals(i,!1,"",!1));if(a>0){if(s.parent=this,s.IsAutoPost=!0,s.savebulk=!0,s.SaveInventoryDocument("Save",!1),!n.e.IsEmpty(s.DisplayMessage))return void(this.DisplayMessage=" Shortage of stock"+s.DisplayMessage);e+=this.AutoPOstXML.replace("AutoPOstXML","ShortageXML"),this.AutoPOstXML=""}}}if(this.ScreenObject.Preferences.ContainsKey("ExcessDOC")&&""!=this.ScreenObject.Preferences.ExcessDOC&&""!=t&&this.ScreenObject.GridDataColumns.Contains(t)){let s=new es(parseInt(this.ScreenObject.Preferences.ExcessDOC),"",!0);{s.CheckStockDimensions(),s.ScreenObject._CCFields.forEach(e=>{if(e instanceof m.b){let t=this.ScreenObject._CCFields.find(t=>t instanceof m.b&&t.CCID==e.CCID);t instanceof m.b&&(e.SelectedValue=t.SelectedValue)}});let i,a=0;s.ScreenObject.GridDataColumns.push("ParentSeqNo");for(let e=0;e<this.ScreenObject.GridData.length;e++)!n.e.IsEmpty(this.ScreenObject.GridData[e].ProductID_Key)&&!n.e.IsEmpty(this.ScreenObject.GridData[e][t])&&parseFloat(this.ScreenObject.GridData[e][t])>0&&(a++,i=s.ScreenObject.GridDataObj.NewRow(),s.ScreenObject.ColumnSource.forEach(t=>{if(t.CostCenterID>5e4)if(this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(t.CostCenterID-5e4)))n.e.IsEmpty(this.ScreenObject.GridData[e]["dcCCNID"+(t.CostCenterID-5e4)+"_Key"])||(i["dcCCNID"+(t.CostCenterID-5e4)+"_Key"]=this.ScreenObject.GridData[e]["dcCCNID"+(t.CostCenterID-5e4)+"_Key"].toString(),i["dcCCNID"+(t.CostCenterID-5e4)]=this.ScreenObject.GridData[e]["dcCCNID"+(t.CostCenterID-5e4)].toString());else{let e=this.ScreenObject._CCFields.find(e=>e instanceof m.b&&e.CCID==t.CostCenterID);e instanceof m.b&&(i["dcCCNID"+(t.CostCenterID-5e4)]=e.SelectedValue)}}),i.ProductID_Key=this.ScreenObject.GridData[e].ProductID_Key.toString(),i.QOH=this.ScreenObject.GridData[e].QOH.toString(),i.ParentSeqNo=this.ScreenObject.GridData[e].DocSeqNo.toString(),s.ScreenObject.GridDataColumns.Contains("ProductCode")&&(i.ProductCode=this.ScreenObject.GridData[e].ProductCode),s.ScreenObject.GridDataColumns.Contains("ProductName")&&(i.ProductName=this.ScreenObject.GridData[e].ProductName),i.Type=this.ScreenObject.GridData[e].Type,i.Unit=this.ScreenObject.GridData[e].Unit,i.Unit_Key=this.ScreenObject.GridData[e].Unit_Key,i.Rate=this.ScreenObject.GridData[e].Rate,this.ScreenObject.Preferences.ContainsKey("DontCalcQOH")&&!n.e.IsEmpty(this.ScreenObject.Preferences.DontCalcQOH)&&Object(o.j)(this.ScreenObject.Preferences.DontCalcQOH)||s.AddProductData(i,!1,!0),i.Quantity=this.ScreenObject.GridData[e][t].toString(),n.e.IsEmpty(i.UOMConversion)?(i.UOMConversion="1",i.UOMConvertedQty=i.Quantity):i.UOMConvertedQty=parseFloat(i.Quantity)*parseFloat(i.UOMConversion),n.e.IsEmpty(this.ScreenObject.GridData[e].Type)||5!=parseInt(this.ScreenObject.GridData[e].Type.toString())&&2!=parseInt(this.ScreenObject.GridData[e].Type.toString())||(i.ExtraXML=this.ScreenObject.GridData[e].ExtraXML),s.ScreenObject.GridData.push(i),s.CalculateTotals(i,!1,"",!1));if(a>0){if(s.parent=this,s.IsAutoPost=!0,s.savebulk=!0,s.SaveInventoryDocument("Save",!1),!n.e.IsEmpty(s.DisplayMessage))return void(this.DisplayMessage=" Excess of stock"+s.DisplayMessage);e+=this.AutoPOstXML.Replace("AutoPOstXML","ExcessXML"),this.AutoPOstXML=""}}}}else if(73==this.ScreenObject.DocumentType){let t=new es(40072,"Apply Vacation",!1);t.strVacXml="LAV";for(let e=0;e<this.ScreenObject.GridData.length;e++)if(null!=this.ScreenObject.GridData[e].dcAlpha4&&null!=this.ScreenObject.GridData[e].dcAlpha1&&"Yes"==this.ScreenObject.GridData[e].dcAlpha4.toString()){let s=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());(s instanceof m.b&&s.SelectedValue>0||s instanceof C.a&&s.SelectedValue>0)&&(t.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase()).SelectedValue=s.SelectedValue),t.DimensionSelectedvalueData(),t.ScreenObject._StaticFields.find(e=>"commonnarration"==e.DBColumnName.toLowerCase()).Text="Leave Adjusted as Vacation",t.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase()).Date=new Date(this.ScreenObject.GridData[e].dcAlpha2_Key);let i=t.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase());null!=i&&i instanceof d.c&&!n.e.IsEmpty(i.Date)&&t.onDateChanged(i),t.ScreenObject._TextFields.find(e=>"dcalpha3"==e.DBColumnName.toLowerCase()).Date=new Date(this.ScreenObject.GridData[e].dcAlpha3_Key),i=t.ScreenObject._TextFields.find(e=>"dcalpha3"==e.DBColumnName.toLowerCase()),null!=i&&i instanceof d.c&&i.Date&&t.ApplyVacation(i),t.ButtonsEnabled=!0,t.SaveInventoryDocument_1("Save")}if(""!=t.strVacXml){if(t.strVacXml.Contains("LAV"))return void(this.DisplayMessage=t.strVacXml.toString().replace("LAV",""));e+=t.strVacXml.toString()}}else if(202==this.ScreenObject.DocumentType){let t=new es(40203,"Preventive Service Request",!1);t.strPMCXml="PRS",n.e.IsEmpty(this.ScreenObject.GridData[0].ExtraXML)||(a.a.SessionManager.FMExtraXml=this.ScreenObject.GridData[0].ExtraXML.toString()),t.ScreenObject.DocDate.Date=this.ScreenObject.DocDate.Date;for(let e=0;e<this.ScreenObject.GridData.length;e++)!n.e.IsEmpty(this.ScreenObject.GridData[e].dcCCNID154_Key)&&parseFloat(this.ScreenObject.GridData[e].dcCCNID154_Key.toString())>0&&(t.ScreenObject._CCFields.forEach(t=>{if(t instanceof m.b&&t.CCID>0&&this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(t.CCID-5e4))&&!n.e.IsEmpty(this.ScreenObject.GridData[e]["dcCCNID"+(t.CCID-5e4)+"_Key"])){let s=this.ScreenObject.ColumnSource.find(e=>e.DisplayMember==t.DBColumnName);t.SelectedValue=null!=s&&t instanceof m.b&&!n.e.IsEmpty(this.ScreenObject.GridData[e]["dcCCNID"+(t.CCID-5e4)+"_Key"])?parseInt(this.ScreenObject.GridData[e]["dcCCNID"+(t.CCID-5e4)+"_Key"].toString()):0}}),t.ScreenObject._TextFields.forEach(t=>{let s=this.ScreenObject.ColumnSource.find(e=>e.DisplayMember==t.DBColumnName);null==s||"text"!=s.DataType.toLowerCase().toString()&&"string"!=s.DataType.toLowerCase().toString()?null==s||"date"!=s.DataType.toLowerCase().toString()&&"datetime"!=s.DataType.toLowerCase().toString()||n.e.IsEmpty(this.ScreenObject.GridData[e][t.DBColumnName+"_Key"])||(t.Date=new Date(this.ScreenObject.GridData[e][t.DBColumnName+"_Key"].toString())):t instanceof u.d?t.Text="dcalpha1"==t.DBColumnName.toLowerCase().toString()?a.a.SessionManager.UserName:this.ScreenObject.GridData[e][t.DBColumnName].toString():t instanceof u.c&&(t.Text=this.ScreenObject.GridData[e][t.DBColumnName].toString())}),t.ButtonsEnabled=!0,t.SaveInventoryDocument("Save"));if(!n.e.IsEmpty(t.strPMCXml)){if(t.strPMCXml.Contains("PRS"))return this.DisplayMessage=t.strPMCXml.toString().Replace("PMC",""),void(this.MessageVisibility=!0);e+=t.strPMCXml.toString(),a.a.SessionManager.FMExtraXml="",this.iPMCActivity=0}}else if(56==this.ScreenObject.DocumentType){if(this.LoanGuaranteeVisible&&null!=this.dtLoanGuarantees&&this.dtLoanGuarantees.length>0){let t="";t+="<LoanGuaranteesXML>",t+="<Rows>";for(let e=0;e<this.dtLoanGuarantees.length;e++)t+='<Row EmpSeqNo="'+this.dtLoanGuarantees[e].GEmpSeqNo.toString(),t+='" />';t+="</Rows>",t+="</LoanGuaranteesXML>",e+=t.toString()}}else if(61==this.ScreenObject.DocumentType){if(null!=this.dtVacDefineDays&&this.dtVacDefineDays.length>0){let t="";t+="<VacManageDefineDays>",t+="<Rows>";for(let e=0;e<this.dtVacDefineDays.length;e++)t+='<Row SNo="'+this.dtVacDefineDays[e].SNo.toString()+'" FromMonth="'+this.dtVacDefineDays[e].FromMonth.toString()+'" ToMonth="'+this.dtVacDefineDays[e].ToMonth.toString()+'" DaysPerMonth="'+this.dtVacDefineDays[e].DaysPerMonth.toString()+'" ApplyToPrevMonths="'+this.dtVacDefineDays[e].ApplyToPrevMonths.toString(),t+='" />';t+="</Rows>",t+="</VacManageDefineDays>",e+=t}}else if(85==this.ScreenObject.DocumentType){if(this.sApprUpdate.length>0)if(this.ScreenObject.Preferences.ContainsKey("UpdateGradeandAppraisalData")&&"True"==this.ScreenObject.Preferences.UpdateGradeandAppraisalData){let t="0",a="0",r=new Date;var s=this.ScreenObject._CCFields.find(e=>"dcccnid53"==e.DBColumnName.toLowerCase());null!=s&&null!=s&&(s instanceof m.b||s instanceof C.a)&&(t=s.SelectedValue.toString()),null!=(s=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase()))&&null!=s&&(s instanceof m.b||s instanceof C.a)&&(a=s.SelectedValue.toString());var i=this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase());null!=i&&null!=i&&i instanceof d.c&&!n.e.IsEmpty(i.Date)&&(r=i.Date),e+='<PayrollBulkAppraisals Grade="'+t+'" EmpID="'+a+'" EffectFrom="'+r.ToString("dd/MMM/yyyy")+'" Query="'+u.d.GetValidXml(this.sApprUpdate)+'"></PayrollBulkAppraisals>'}else e+='<PayrollBulkAppraisals Query="'+u.d.GetValidXml(this.sApprUpdate)+'"></PayrollBulkAppraisals>'}else if(97==this.ScreenObject.DocumentType){if(this.ScreenObject.GridData.length>0){let t="",s=new Date,i=new Date,r=new Date,o=this.ScreenObject._TextFields.find(e=>"dcalpha33"==e.DBColumnName.toLowerCase());if(o&&o instanceof d.c&&o.Date){s=o.Date;let e={PayrollMonth:s,PayrollMonthStart:i,PayrollMonthEnd:r};n.e.SetPayrollDate(s,e),s=e.PayrollMonth,i=e.PayrollMonthStart,r=e.PayrollMonthEnd,t=r.ToString("dd MMM yyyy")}let l=a.a.common.GetDataSet("PAY050",this.DocID.toString()),c=null,h="";for(let e=0;e<this.ScreenObject.GridData.length;e++)if(!n.e.IsEmpty(this.ScreenObject.GridData[e].dcAlpha27)&&parseFloat(this.ScreenObject.GridData[e].dcAlpha27)>0){let s=parseFloat(this.ScreenObject.GridData[e].dcAlpha27),i=0,r=0,o=this.ScreenObject.GridData[e].dcCCNID51_Key.toString(),u="",d=!1,D=!1,S=this.ScreenObject.GridData[e].dcAlpha28.toString().split(";");if(null!=S&&S.length>0)for(let e=0;e<S.length;e++)if(null!=S[e]&&""!=S[e]&&s>0){if(d=!1,D=!1,u=l.Tables[0].filter(t=>t.ComponentName==S[e])[0].ComponentID.toString(),a.a.SessionManager.Preferences.ContainsKey("ConsiderLOPBasedOn")){let e=a.a.SessionManager.Preferences.ConsiderLOPBasedOn.split(",");if(null!=e&&e.length>0)for(let t=0;t<e.length;t++)if(null!=e[t]&&e[t]==u){D=!0;break}}if(null!=l.Tables[1]&&l.Tables[1].length>0&&null!=l.Tables[1][0].VacationComponentID&&null!=l.Tables[1][0].VacationComponentID&&l.Tables[1][0].VacationComponentID.toString()==u&&(d=!0),d);else{let e,d="",S="",m="";null!=a.a.SessionManager.dtDocDefAccs&&(e=a.a.SessionManager.dtDocDefAccs.filter(e=>40062==e.CostCenterID&&"ProductID"==e.SysColumnName),null!=e&&e.length>0&&!n.e.IsEmpty(e[0].UserDefaultValue)&&""!=e[0].UserDefaultValue.toString().trim()&&(m=e[0].UserDefaultValue.toString()),e=a.a.SessionManager.dtDocDefAccs.filter(e=>40062==e.CostCenterID&&"CreditAccount"==e.SysColumnName),null!=e&&e.length>0&&!n.e.IsEmpty(e[0].UserDefaultValue)&&""!=e[0].UserDefaultValue.toString().trim()&&(d=e[0].UserDefaultValue.toString()),e=a.a.SessionManager.dtDocDefAccs.filter(e=>40062==e.CostCenterID&&"DebitAccount"==e.SysColumnName),null!=e&&e.length>0&&!n.e.IsEmpty(e[0].UserDefaultValue)&&""!=e[0].UserDefaultValue.toString().trim()&&(S=e[0].UserDefaultValue.toString()));let b,C="0";null!=l.Tables[2]&&l.Tables[2].length>0&&(b=l.Tables[2].filter(e=>e.EmpSeqNo==o&&e.LeaveComponentID==u),null!=b&&b.length>0&&(C=b[0].DocID.toString()));let p=[];if(p.push(o),p.push(u),p.push(t),p.push(C),p.push(a.a.SessionManager.UserID),p.push(a.a.SessionManager.LanguageID),c=a.a.common.GetDataSet_SP(p,"spPAY_ExtGetAssignedLeaves").Tables[0],null!=c&&c.length>0){if(i=parseFloat(c[0].AvailableLeaves),!D&&i<=0)continue;h+='<LatesLeaves DocID="'+C+'" DocDetIDs="" WorkFlowID="0" >',h+="<DOCXML>",h+="<RowHead/>",h+="<Row>",h+='<Transactions DocSeqNo="1"  DocDetailsID="0" LinkedInvDocDetailsID="0" LinkedFieldName="" IsScheme="" ProductID="'+m+'" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1" Rate="0" Gross="" RefNO="" LineNarration="Remarks" IsQtyIgnored="1" AverageRate="0" StockValue="0" Net="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1.0" CommonNarration="POSTED FROM LATES PROCESSING DOCUMENT"  DebitAccount="'+S+'"  CreditAccount="'+d+'"  ></Transactions>',h+='<Numeric Query="" ></Numeric>',D?(h+="<Alpha Query=\"dcAlpha2=N'0', dcAlpha3=N'0', dcAlpha4=N'"+t+"', dcAlpha5=N'"+t+"', dcAlpha6=N'Both', dcAlpha8=N'-1', dcAlpha7=N'"+s+"', dcAlpha9=N'-1', dcAlpha10=N'0', dcAlpha14=N'0', dcAlpha16=N'LatesProcessing', \" ></Alpha>",h+='<CostCenters Query="dcCCNID52='+u+", dcCCNID51="+o+', " ></CostCenters>'):(s<=i?(r=s,s=0):(r=i,s-=i),h+="<Alpha Query=\"dcAlpha2=N'"+c[0].AssignedLeaves.toString()+"', dcAlpha3=N'"+c[0].AvailableLeaves.toString()+"', dcAlpha4=N'"+t+"', dcAlpha5=N'"+t+"', dcAlpha6=N'Both', dcAlpha8=N'100', dcAlpha7=N'"+r+"', dcAlpha9=N'"+c[0].MaxLeaves.toString()+"', dcAlpha10=N'0', dcAlpha14=N'"+c[0].ActualAvailableLeaves.toString()+"', dcAlpha16=N'LatesProcessing', \" ></Alpha>",h+='<CostCenters Query="dcCCNID52='+u+", dcCCNID51="+o+', " ></CostCenters>'),h+="</Row>",h+="</DOCXML>",h+="</LatesLeaves>"}}}}h.length>0&&(h="<LPL>"+h+"</LPL>",e+=h.toString())}}else if(72==this.ScreenObject.DocumentType&&null!=this.dtVacContract&&this.dtVacContract.length>0){let t="";t+="<VacContract>",t+="<Rows>";for(let e=0;e<this.dtVacContract.length;e++)t+='<Row SNo="'+this.dtVacContract[e].SNo.toString()+'" ContractNodeID="'+this.dtVacContract[e].ContractNodeID.toString()+'" ContractFrom="'+this.dtVacContract[e].ContractFrom.toString()+'" ContractTo="'+this.dtVacContract[e].ContractTo.toString()+'" CreditedDays="'+this.dtVacContract[e].CreditedDays.toString()+'" PrevTakenDays="'+this.dtVacContract[e].PrevTakenDays.toString()+'" BalanceDays="'+this.dtVacContract[e].BalanceDays.toString()+'" CanAvail="'+this.dtVacContract[e].CanAvail.toString(),t+='" />';t+="</Rows>",t+="</VacContract>",e+=t.toString()}let r=null!=this.ViewAttachments?this.ViewAttachments.GetXML():"";if(r+=this.ScreenObject.GetExtraAttachmentXML(),this.savebulk){alert("Bulk Save Pending"),e+="</XML>";let s=[];s.push(t[0]),s.push(t[1]),s.push(t[2]),s.push(t[4]),s.push(t[5]),s.push(t[6]),s.push(t[7]),s.push(t[8]);let i={stat:0,RetVal:0};this.DisplayMessage=this.ScreenObject.SaveBulkInvDoc(s,null!=this.ViewNotes?this.ViewNotes.GetXML():"",r,this.DocumentDate,t[8],null!=this.AssignAddress?this.AssignAddress.GetXML():"",e,i),this.StatusID=i.stat,this.RetValue=i.RetVal}else{if(e+=t[2],e+=t[4],e+=t[5],e+=t[6],e+=t[7],e+=t[8],e+=t[12],e+=t[13],e+=t[15],e+="</XML>",this.PrevDocID=this.ScreenObject.DocID,n.e.IsEmpty(this.APIAddressXML))if(null!=this.AssignAddress){if(this.APIAddressXML=this.AssignAddress.GetXML(),this.AssignAddress.PrimMandatory&&!this.APIAddressXML.Contains('TypeID="1"'))return void(this.DisplayMessage="Primary Address Mandatory");if(this.AssignAddress.BillsMandatory&&!this.APIAddressXML.Contains('TypeID="2"'))return void(this.DisplayMessage="Billing Address Mandatory");if(this.AssignAddress.ShipMandatory&&!this.APIAddressXML.Contains('TypeID="3"'))return void(this.DisplayMessage="Shipping Address Mandatory")}else this.APIAddressXML="";this.ScreenObject.SaveInventoryDocument(t[0],t[1],null!=this.ViewNotes?this.ViewNotes.GetXML():"",r,this.DocumentDate,t[14],this.APIAddressXML,e,t),this.APIAddressXML=""}if(72!=this.ScreenObject.DocumentType||this.ReevaluateFutureVac||369!=this.StatusID||this.ReevaluateFutureVacation(),67==this.DocumentType&&"PostingFromBiometric"==this.ScreenObject.ParentFlagName&&this.ScreenObject.Preferences.ContainsKey("SkipEmployeesWhoGetErrorsWhileSaving")&&!n.e.IsEmpty(this.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving)&&Object(o.j)(this.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving)&&this.sBioErrLogs.length>0&&(n.e.WriteErrorsToFile(this.sBioErrLogs,"BiometricDocPostErrors"),this.DisplayMessage="Posted with Erros. Check for the Logs @ BiometricDocPostErrors.txt in application folder ",this.MessageVisibility=!0),this.MessageVisibility=!0,this.IsFrmFS_LoanBal)return this.DialogResult=!0,void a.a.page.HideDialog()}}SaveInventoryDocument_CallBack(e){this.Save_Completed(),-407==this.RetValue&&Object(o.j)(e[11])&&alert(this.DisplayMessage)}ReevaluateFutureVacation(){let e="";var t=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());null!=t&&null!=t&&(t instanceof m.b||t instanceof C.a)&&(e=t.SelectedValue.toString());var s=this.ScreenObject._TextFields.find(e=>"dcalpha3"==e.DBColumnName.toLowerCase());if(null!=s&&s instanceof d.c&&""!=s.Date.toString()){let t=a.a.common.GetDataTable("PAY080",e+"~"+s.Date.ToString("dd/MMM/yyyy"));if(null!=t&&t.length>0){if(!(this.ScreenObject.DocID>0))return;{let e=a.a.common.ExecuteQuery_ReturnString("PAY081",this.ScreenObject.DocID.toString());if(e.Trim().length>0)return this.DisplayMessage="Error : "+e,void(this.MessageVisibility=!0)}for(let e=0;e<t.length;e++){let s=new es(40072,"Apply Vacation",!0);s.ReevaluateFutureVac=!0;let l={value:this._Ddate};s.ScreenObject.OnDocPrefixChanged("lostFocus",0,parseInt(t[e].DocID),l,!0),this._Ddate=l.value,s.DimensionSelectedvalueData();let c=[];c=s.ScreenObject.GridData.Copy();var i=s.ScreenObject._TextFields.find(e=>"dcAlpha2"==e.DBColumnName.toString());null!=i&&null!=i&&s.onDateChanged(i);var r=s.ScreenObject._TextFields.find(e=>"dcAlpha3"==e.DBColumnName.toString());null!=r&&null!=r&&s.onDateChanged(i);let h=0,d=0,D=0,S=0,m=0,b=0;var o=s.ScreenObject._TextFields.find(e=>"dcAlpha7"==e.DBColumnName.toString());null!=o&&null!=o&&o instanceof u.d&&(h=parseFloat(o.Text)),null!=(o=s.ScreenObject._TextFields.find(e=>"dcAlpha22"==e.DBColumnName.toString()))&&null!=o&&o instanceof u.d&&(d=parseFloat(o.Text)),null!=(o=s.ScreenObject._TextFields.find(e=>"dcAlpha12"==e.DBColumnName.toString()))&&null!=o&&o instanceof u.d&&(D=parseFloat(o.Text)),null!=(o=s.ScreenObject._TextFields.find(e=>"dcAlpha14"==e.DBColumnName.toString()))&&null!=o&&o instanceof u.d&&!n.e.IsEmpty(o.Text)&&(S=parseFloat(o.Text)),null!=(o=s.ScreenObject._TextFields.find(e=>"dcAlpha11"==e.DBColumnName.toString()))&&o instanceof u.d&&!n.e.IsEmpty(o.Text)&&(m=parseFloat(o.Text)),null!=(o=s.ScreenObject._TextFields.find(e=>"dcAlpha10"==e.DBColumnName.toString()))&&null!=o&&o instanceof u.d&&!n.e.IsEmpty(o.Text)&&(b=parseFloat(o.Text));let C=a.a.common.ExecuteQuery_ReturnString("PAY082",h+"~"+D+"~"+d+"~"+S+"~"+m+"~"+b+"~"+s.ScreenObject.DocID.toString());if(C.Trim().length>0)return this.DisplayMessage="Error : "+C,void(this.MessageVisibility=!0)}}}}getQuery(){let e="",t="",s="",i="",n="",r="",l="",c="",h="",u="";for(let d=0;d<this.ScreenObject.Data.Tables[0].length;d++){let e=this.ScreenObject.Data.Tables[0][d].SysColumnName.toLowerCase();e.startsWith("dcnum")?(t+=this.ScreenObject.Data.Tables[0][d].SysColumnName+",",a.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(o.j)(a.a.SessionManager.Preferences["Use Foreign Currency"])&&(t+="dcCurrID"+this.ScreenObject.Data.Tables[0][d].SysColumnName.replace("dcNum","")+",",t+="dcExchRT"+this.ScreenObject.Data.Tables[0][d].SysColumnName.replace("dcNum","")+",",t+="dcCalcNumFC"+this.ScreenObject.Data.Tables[0][d].SysColumnName.replace("dcNum","")+","),t+="dcCalc"+this.ScreenObject.Data.Tables[0][d].SysColumnName.replace("dc","")+",",n+="X.value('@"+this.ScreenObject.Data.Tables[0][d].SysColumnName+"','Float'),",a.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(o.j)(a.a.SessionManager.Preferences["Use Foreign Currency"])&&(n+="X.value('@dcCurrID"+this.ScreenObject.Data.Tables[0][d].SysColumnName.replace("dcNum","")+"','Float'),",n+="X.value('@dcExchRT"+this.ScreenObject.Data.Tables[0][d].SysColumnName.replace("dcNum","")+"','Float'),",n+="X.value('@dcCalcNumFC"+this.ScreenObject.Data.Tables[0][d].SysColumnName.replace("dcNum","")+"','Float'),"),n+="X.value('@dcCalc"+this.ScreenObject.Data.Tables[0][d].SysColumnName.replace("dc","")+"','Float'),",this.ScreenObject.DocID>0&&(c+=this.ScreenObject.Data.Tables[0][d].SysColumnName+"=",c+="X.value('@"+this.ScreenObject.Data.Tables[0][d].SysColumnName+"','Float'),",a.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(o.j)(a.a.SessionManager.Preferences["Use Foreign Currency"])&&(c+="dcCurrID"+this.ScreenObject.Data.Tables[0][d].SysColumnName.replace("dcNum","")+"=",c+="X.value('@dcCurrID"+this.ScreenObject.Data.Tables[0][d].SysColumnName.replace("dcNum","")+"','Float'),",c+="dcExchRT"+this.ScreenObject.Data.Tables[0][d].SysColumnName.replace("dcNum","")+"=",c+="X.value('@dcExchRT"+this.ScreenObject.Data.Tables[0][d].SysColumnName.replace("dcNum","")+"','Float'),",c+="dcCalcNumFC"+this.ScreenObject.Data.Tables[0][d].SysColumnName.replace("dcNum","")+"=",c+="X.value('@dcCalcNumFC"+this.ScreenObject.Data.Tables[0][d].SysColumnName.replace("dcNum","")+"','Float'),"),c+="dcCalc"+this.ScreenObject.Data.Tables[0][d].SysColumnName.replace("dc","")+"=",c+="X.value('@dcCalc"+this.ScreenObject.Data.Tables[0][d].SysColumnName.replace("dc","")+"','Float'),")):e.startsWith("dcalpha")?(i+=this.ScreenObject.Data.Tables[0][d].SysColumnName+",",l+="X.value('@"+this.ScreenObject.Data.Tables[0][d].SysColumnName+"','Nvarchar(max)'),",this.ScreenObject.DocID>0&&(u+=this.ScreenObject.Data.Tables[0][d].SysColumnName+"=",u+="X.value('@"+this.ScreenObject.Data.Tables[0][d].SysColumnName+"','Nvarchar(max)'),")):e.startsWith("dcCCNID")&&(s+=this.ScreenObject.Data.Tables[0][d].SysColumnName+",",r+="isnull(X.value('@"+this.ScreenObject.Data.Tables[0][d].SysColumnName.toString()+"','BIGINT'),1),",this.ScreenObject.DocID>0&&(h+=this.ScreenObject.Data.Tables[0][d].SysColumnName+"=",h+="isnull(X.value('@"+this.ScreenObject.Data.Tables[0][d].SysColumnName.toString()+"','BIGINT'),1),"))}return e+=' NumCols="'+t.toString()+'" ',e+=' TextCols="'+i.toString()+'" ',e+=' CCCols="'+s.toString()+'" ',e+=' NumSelCols="'+n.toString()+'" ',e+=' TextSelCols="'+l.toString()+'" ',e+=' CCSelCols="'+r.toString()+'" ',this.ScreenObject.DocID>0&&(e+=' NumUpdateCols="'+c.toString()+'" ',e+=' TextUpdateCols="'+u.toString()+'" ',e+=' CCUpdateCols="'+h.toString()+'" '),e}ConvertHoursToMinutes(e){let t=0,s=0,i=0;return i=n.e.Int(e.split(".")[0]),e.split(".").length>1&&(s=n.e.Int(e.split(".")[1])),t=60*i+s,t}AccountingSave_DoWork(e,t){if(this.DisplayMessage="Saving Document.Please wait...",this.ButtonsEnabled=!1,t.length>1){let e="<XML ";if(this.ScreenObject.Preferences.ContainsKey("UseAsLC")&&""!=this.ScreenObject.Preferences.UseAsLC&&Object(o.j)(this.ScreenObject.Preferences.UseAsLC)||this.ScreenObject.Preferences.ContainsKey("UseAsTR")&&""!=this.ScreenObject.Preferences.UseAsTR&&Object(o.j)(this.ScreenObject.Preferences.UseAsTR)?e+=null==this.commandprarameter||"Approve"!=this.commandprarameter&&"NoWorkFlow"!=this.commandprarameter?' LCStatus="open"':' LCStatus="approved"':null==this.commandprarameter||"Approve"!=this.commandprarameter&&"ApproveandPrint"!=this.commandprarameter||(e+=' AppRejDate="'+this.AppRejDate.Date.ToString("dd/MMM/yyyy")+'"',e+=' Remarks="'+u.d.GetValidXml(this.Remarks.Text)+'"',this.IsLocked&&a.a.SessionManager.Preferences.ContainsKey("PostLockedDocs")&&Object(o.j)(a.a.SessionManager.Preferences.PostLockedDocs)&&(e+=' LockedPosting="1"'),this.RecurDocsWithApproval.Visible&&(e+=' RecurDocsWithApproval="'+(n.e.IsEmpty(this.RecurDocsWithApproval.SelectedValue)?"1":this.RecurDocsWithApproval.SelectedValue)+'"')),(null!=this.commandprarameter&&("NoWorkFlow"==this.commandprarameter||"NoWorkFlowprint"==this.commandprarameter)||this.ScreenObject.Preferences.ContainsKey("NoWorkflowPostedDocs")&&""!=this.ScreenObject.Preferences.NoWorkflowPostedDocs&&Object(o.j)(this.ScreenObject.Preferences.NoWorkflowPostedDocs)&&369==this.StatusID)&&(e+=' WorkFlow="NO"'),this.GenratePrefix&&(e+=' GenratePrefix="1" '),e+=' SysInfo="'+a.a.SessionManager.GetSysInfo()+'" ',this.ScreenObject.Preferences.ContainsKey("CrossDimDocument")&&""!=this.ScreenObject.Preferences.CrossDimDocument&&n.e.IsNum(this.ScreenObject.Preferences.CrossDimDocument)&&parseInt(this.ScreenObject.Preferences.CrossDimDocument)>4e4&&(e+=' ChildWorkFlowID="'+this.GetWorkFlow(!0,null)+'"'),n.e.IsEmpty(this.ScreenObject.guid)||(e+=' Guid="'+n.e.String(this.ScreenObject.guid)+'"'),e+=' CCGuid="'+n.e.String(this.ScreenObject.CCguid)+'"',e+=' AP="'+a.a.SessionManager.GetAccessPoint()+'"',this.ScheduleID>0&&(e+=' ScheduleID="'+this.ScheduleID+'"'),Object(o.j)(t[1])&&(e+=' SaveUnapproved="1"'),!this.IsLockDimsLineWise&&null!=this.LockDims){let t={join:""};e+=' LockDims="'+this.GetLockQuery(null,t)+'" ',""!=t.join&&(e+=' LockDimsjoin="'+t.join+'" ')}95!=this.ScreenObject.RefCCId&&104!=this.ScreenObject.RefCCId||(e+=' IsRef="Yes"'),t.length>3&&(e+=t[3]),e+=" >",e+=this.ViewActivities?this.ViewActivities.ActivitiesXML():"<ScheduleActivityXml></ScheduleActivityXml>",n.e.IsEmpty(this.ScreenObject.HistoryCCXML)||(e+="<History>"+this.ScreenObject.HistoryCCXML+"</History>"),this.ScreenObject.GridDataColumns.Contains("FieldType")&&(e+=this.GetpaymentModes()),e+="</XML>";let s=null!=this.ViewAttachments?this.ViewAttachments.GetXML():"";s+=this.ScreenObject.GetExtraAttachmentXML(),this.RetValue=0,this.PrevDocID=this.ScreenObject.DocID;let i="";this.ScreenObject.SaveAccountingDocument(t[0],null!=this.ViewNotes?this.ViewNotes.GetXML():"",s,e,this.DocumentDate,t[2],this.IsReplaced).subscribe(e=>{this.RetValue=e.obj;let t=e;i=null!=t&&t.Tables.length>0&&t.Tables[t.Tables.length-1].length>0&&t.Columns[t.Tables.length-1].Contains("ErrorMessage")?t.Tables[t.Tables.length-1][0].ErrorMessage.toString():"Problem in processing your request,Please contact administrator.",this.RetValue>0&&(null!=t&&t.Tables.length>0&&t.Tables[t.Tables.length-1].length>0&&t.Columns[t.Tables.length-1].Contains("VoucherNo")&&(this.ScreenObject.VoucherNo=t.Tables[t.Tables.length-1][0].VoucherNo.toString()),this.ScreenObject.DocID=this.RetValue,this.ScreenObject.DraftID>0&&(a.a.document.DeleteDocumentDraft(this.ScreenObject.DraftID),this.ScreenObject.DraftID=0),this.Save_Completed()),this.DisplayMessage=i,this.MessageVisibility=!0,Logger.InfoLog("VoucherGenerator:: Exiting SaveDocument")},e=>{console.log(e),this.DisplayMessage="Error in save"})}}GetpaymentModes(){let e="";if(this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key"))for(let t=0;t<this.ScreenObject.GridData.length;t++)n.e.IsEmpty(this.ScreenObject.GridData[t].CreditAccount_Key)||(e+='<XML Type="'+this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName==this.ScreenObject.GridData[t].FieldType)[0].SectionID.toString()+'" Amount="'+this.ScreenObject.GridData[t].Amount.toString()+'"   DBColumnName="'+this.ScreenObject.GridData[t].FieldType.toString()+'" ',this.ScreenObject.GridDataColumns.Contains("ChequeNumber")&&(e+=' CardNo="'+this.ScreenObject.GridData[t].ChequeNumber.toString()+'" '),this.ScreenObject.GridDataColumns.Contains("ChequeBankName")&&(e+=' CardName="'+this.ScreenObject.GridData[t].ChequeBankName.toString()+'" '),this.ScreenObject.GridDataColumns.Contains("ChequeDate_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[t].ChequeDate_Key)&&(e+=' CardName="'+new Date(this.ScreenObject.GridData[t].ChequeDate_Key).ToString("dd/MMM/yyyy")+'" '),e+=' RegisterID="'+this.ScreenObject.RegisterNodeID+'" ShiftID="'+this.ScreenObject.ShiftNodeID+'" DocDate="'+this.DocumentDate.ToString("dd/MMM/yyyy")+'" />');return e.length>0&&(e="<PosPayModes>"+e+"</PosPayModes>"),e}GetpayModesNumericData(e){let t="";if(this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key"))for(let s=0;s<this.ScreenObject.GridData.length;s++)n.e.IsEmpty(this.ScreenObject.GridData[s].FieldType)||(e!=s||n.e.IsEmpty(this.ScreenObject.GridData[s].Amount)?t+=this.ScreenObject.GridData[s].FieldType.toString()+"=0,dcCalc"+this.ScreenObject.GridData[s].FieldType.toString().replace("dc","")+"=0,":t+=this.ScreenObject.GridData[s].FieldType.toString()+"="+this.ScreenObject.GridData[s].Amount.toString()+",dcCalc"+this.ScreenObject.GridData[s].FieldType.toString().replace("dc","")+"="+this.ScreenObject.GridData[s].Amount.toString()+",");return t}GetLockQuery(e,t){if(t.join="",!this.IsLockDimsLineWise&&null!=e)return"";if(this.IsLockDimsLineWise&&null==e)return"";let s=0,i="";return null!=this.LockDims&&this.LockDims.keys.length>0&&this.LockDims.keys.forEach(a=>{let r={Key:a,Value:this.LockDims[a]};if(s++,r.Value&&(t.join+=" left join "+this.ScreenObject.GetTableName(r.Key)+" CC"+s+" with(nolock) on C."+es.GetPrimarkyKey(r.Key,!0)+"=CC"+s+"."+es.GetPrimarkyKey(r.Key)+"\n                            left join "+this.ScreenObject.GetTableName(r.Key)+" CJ"+s+" with(nolock) on CJ"+s+".lft between CC"+s+".lft and CC"+s+".rgt"),r.Key>5e4)if(this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(r.Key-5e4))&&!n.e.IsEmpty(e["dcCCNID"+(r.Key-5e4)+"_Key"]))i+=" and ("+(r.Value?"CJ"+s+".NodeID":"c.ccnid"+(r.Key-5e4))+" ="+e["dcCCNID"+(r.Key-5e4)+"_Key"].toString()+" or c.ccnid"+(r.Key-5e4)+"=0)";else{let e=this.ScreenObject._CCFields.find(e=>e.DBColumnName.toLowerCase()=="dcCCNID"+(r.Key-5e4));i+=e&&e instanceof m.b&&e.SelectedValue>0?" and ("+(r.Value?"CJ"+s+".NodeID":"c.ccnid"+(r.Key-5e4))+" ="+e.SelectedValue.toString()+" or c.ccnid"+(r.Key-5e4)+"=0)":" and c.ccnid"+(r.Key-5e4)+"=0"}else if(2==r.Key){let t="0";this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&(t+=","+e.DebitAccount_Key.toString()),this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&(t+=","+e.CreditAccount_Key.toString()),this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&(t+=","+e.AccountID_Key.toString()),null!=this.ScreenObject.CreditAccount&&this.ScreenObject.CreditAccount.SelectedValue>0&&(t+=","+this.ScreenObject.CreditAccount.SelectedValue.toString()),null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.SelectedValue>0&&(t+=","+this.ScreenObject.DebitAccount.SelectedValue.toString()),i+=" and ("+(r.Value?"CJ"+s:"c")+".AccountID in("+t+") or c.AccountID=0)"}else 3==r.Key&&this.IsInventoryVoucher&&null!=e?i+=" and ("+(r.Value?"CJ"+s:"c")+".ProductID ="+e.ProductID_Key.toString()+" or c.ProductID=0)":400==r.Key&&(i+=" and DocumentID in("+this.CostCenterID.toString()+",1)")}),i.toString()}SetLockDims(){if("true"==a.a.SessionManager.Preferences.UseDimWiseLock.toLowerCase()&&""!=a.a.SessionManager.Preferences["DimensionWiseLockData Customize Screen"]&&"<XML></XML>"!=a.a.SessionManager.Preferences["DimensionWiseLockData Customize Screen"]){this.ScreenObject.LockWhere="";let e="",t="";this.LockDims=new r.c;let s=0,i=0,o=new n.f;o.LoadXml(a.a.SessionManager.Preferences["DimensionWiseLockData Customize Screen"]),o.SelectNodes("XML/Row").forEach(a=>{if(null!=a.attributes.ID&&!n.e.IsEmpty(a.attributes.ID.value)){i++;let n=!1;s=parseInt(a.attributes.ID.value),(s>5e4&&this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(s-5e4))||2==s&&(this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")||this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")||this.ScreenObject.GridDataColumns.Contains("AccountID_Key"))||3==s&&this.IsInventoryVoucher)&&(this.IsLockDimsLineWise=!0),this.ScreenObject.Data.Tables.length>2&&this.ScreenObject.Data.Tables[2].length>0&&this.ScreenObject.Data.Tables[2].filter(e=>3==e.DefType&&e.CostCenterID==s&&1==e.isgroupExists).length>0&&(n=!0),this.LockDims.push(s,n),n?(t+=" left join "+this.ScreenObject.GetTableName(s)+" CC"+i+" with(nolock) on C."+es.GetPrimarkyKey(s,!0)+"=CC"+i+"."+es.GetPrimarkyKey(s)+"\n                            left join "+this.ScreenObject.GetTableName(s)+" CJ"+i+" with(nolock) on CJ"+i+".lft between CC"+i+".lft and CC"+i+".rgt",s>5e4?e+=" and (b.dcCCNID"+(s-5e4)+"=CJ"+i+".NodeID or c.CCNID"+(s-5e4)+"=0)":3==s&&this.IsInventoryVoucher?e+=" and (a.ProductID=CJ"+i+".ProductID or c.ProductID=0)":2==s&&(e+=" and (a.DebitAccount=CJ"+i+".AccountID or a.CreditAccount=CJ"+i+".AccountID or c.AccountID=0)")):s>5e4?e+=" and (b.dcCCNID"+(s-5e4)+"=c.CCNID"+(s-5e4)+" or c.CCNID"+(s-5e4)+"=0)":3==s&&this.IsInventoryVoucher?e+=" and (a.ProductID=c.ProductID or c.ProductID=0)":2==s?e+=" and (a.DebitAccount=c.AccountID or a.CreditAccount=c.AccountID or c.AccountID=0)":400==s&&(e+=" and (a.CostCenterID=c.DocumentID or c.DocumentID=1)")}}),this.ScreenObject.LockWhere=""!=t?'<XML where="'+e+'" join="'+t+'"></XML>':e}}Save_Completed(){this.SaveComplete(this.SaveCallReq.Validate),this.SaveCallBackMethod&&setTimeout(()=>{this.SaveCallBackMethod.Call()},20)}ReSaveLinkedDocs(){let e=a.a.common.GetDataSet("DOC061",this.RetValue.toString());{let t=null;for(let s=0;s<e.Tables[0].length;s++){null!=t&&t.CostCenterID==parseInt(e.Tables[0][s].Costcenterid.toString())||(t=new es(parseInt(e.Tables[0][s].Costcenterid.toString()),"",!0)),t.ScreenObject.DocID=parseInt(e.Tables[0][s].docid.toString());let i=t.ScreenObject.GetEditDataByDOCID();null!=i&&i.Tables.length>0&&i.Tables[0].length>0&&i.Columns[0].Contains("DocPrefix")&&(null!=t.ScreenObject.DocPrefix.ComboBox&&null!=t.ScreenObject.DocPrefix.ComboBox.Items&&null==t.ScreenObject.DocPrefix.ComboBox.Items.find(e=>e.Value==i.Tables[0][0].DocPrefix.toString())&&t.ScreenObject.DocPrefix.ComboBox.Items.push(D.d.ComboBoxItems_2(i.Tables[0][0].DocPrefix.toString(),i.Tables[0][0].DocPrefix.toString())),null!=t.ScreenObject.DocPrefix.TextBox&&(t.ScreenObject.DocPrefix.TextBox.Text=i.Tables[0][0].DocNumber.toString())),t.ScreenObject.LoadEditData(i,!1),n.e.IsEmpty(i.Tables[0][0].DocDate)||(t.DocumentDate=new Date(i.Tables[0][0].DocDate)),n.e.IsEmpty(i.Tables[0][0].VoucherNo)||(t.ScreenObject.VoucherNo=i.Tables[0][0].VoucherNo.toString()),n.e.IsEmpty(i.Tables[0][0].GUID)||(t.ScreenObject.guid=i.Tables[0][0].GUID.toString()),i.Columns[0].Contains("RefNodeid")&&!n.e.IsEmpty(i.Tables[0][0].RefNodeid)&&(t.ScreenObject.RefNodeID=parseInt(i.Tables[0][0].RefNodeid.toString())),i.Columns[0].Contains("RefCCId")&&!n.e.IsEmpty(i.Tables[0][0].RefCCId)&&(t.ScreenObject.RefCCId=parseInt(i.Tables[0][0].RefCCId.toString())),i.Tables.length>1&&i.Tables[1].length>0&&(a.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==a.a.SessionManager.Preferences.EnableLocationWise.toString()&&!n.e.IsEmpty(i.Tables[1][0].dcCCNID2)&&(t.ScreenObject.LocationID=parseInt(i.Tables[1][0].dcCCNID2.toString())),a.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==a.a.SessionManager.Preferences.EnableDivisionWise.toString()&&!n.e.IsEmpty(i.Tables[1][0].dcCCNID1)&&(t.ScreenObject.DivisionID=parseInt(i.Tables[1][0].dcCCNID1.toString())));for(let e=0;e<t.ScreenObject.GridData.length;e++)n.e.IsEmpty(t.ScreenObject.GridData[e].ProductID_Key)||t.CalculateTotals(t.ScreenObject.GridData[e],!0);t.RetValue=0,t.SaveInventoryDocument("NoWorkFlowReSave",!1,!1,null,!1,!1)}}}SaveComplete(e){return Object(i.b)(this,void 0,void 0,(function*(){if(this.ButtonsEnabled=!0,this.RetValue>0||this.RetValue<-1e4){if(a.a.SessionManager.IsActionAssigned(this.CostCenterID,"API")&&this.GenerateAPIRequest(9),this.ScreenObject.IsDirty=!1,this.IsExpressionAvailable("ServerDate")){let e=a.a.common.GetDataSet("DOC001","");null!=e&&e.Tables.length>0&&!e.Columns[0].Contains("ErrorMessage")&&e.Tables[0].length>0&&null!=this.fldDict&&(this.fldDict.ServerDate.setFieldValue(e.Tables[0][0].dt.toString()),this.FooterDics.ServerDate.setFieldValue(e.Tables[0][0].dt.toString()))}if(this.SetVisibiltiFalse(),this.IsPOs||this.SetDefaultRightPanel(),null!=this.ChequeBook&&(this.ChequeBook.Items.Clear(),this.ChequeBook.SelectedValue=""),this.ScheduleID>0&&(c.a.UpdateScheduleEvents(this.ScheduleID,this.ScreenObject.IsInventory,this.ScreenObject.DocID),this.objGeneralDashboard&&this.objGeneralDashboard.RefreshData(),this.ScheduleID=0,this.RecurDocumentVoucherNo=""),this.ScreenObject.Preferences.ContainsKey("ReSaveLinkDoc")&&"True"==this.ScreenObject.Preferences.ReSaveLinkDoc&&this.ReSaveLinkedDocs(),this.ScreenObject.Preferences.ContainsKey("Open Cash Drawer")&&"True"==this.ScreenObject.Preferences["Open Cash Drawer"]&&this.ScreenObject.Data.Tables.length>18&&this.ScreenObject.Data.Tables[18].length>0){let e=this.ScreenObject.Data.Tables[18][0];if(this.ScreenObject.RegisterNodeID>0){let e=this.ScreenObject.Data.Tables[18].filter(e=>e.NodeID==this.ScreenObject.RegisterNodeID);if(!(e.length>0)||n.e.IsEmpty(e[0].CashDrawerName)||n.e.IsEmpty(e[0].CashDrawerCommand))return;this.OpenCashDrawer(e[0].CashDrawerName.toString(),e[0].CashDrawerCommand.toString())}else null!=e&&this.OpenCashDrawer(e.CashDrawerName.toString(),e.CashDrawerCommand.toString())}if("Approve"!=this.SaveCallReq.sender&&"ApproveandPrint"!=this.SaveCallReq.sender||a.a.SessionManager.RefreshNotification(),e&&369==this.StatusID&&this.ScreenObject.Preferences.ContainsKey("PostVoucherDocument")&&""!=this.ScreenObject.Preferences.PostVoucherDocument&&n.e.IsNum(this.ScreenObject.Preferences.PostVoucherDocument)&&parseInt(this.ScreenObject.Preferences.PostVoucherDocument)>4e4){let e=!0;if(this.ScreenObject.Preferences.ContainsKey("PostDocumentCondition")&&""!=this.ScreenObject.Preferences.PostDocumentCondition){e=!1;try{let t=a.a.eval.EvaluateExpression(this.ScreenObject.Preferences.PostDocumentCondition,this.fldDict).toString();null!=t&&"1"==t.toString()&&(e=!0)}catch(t){}}if(e){let e=0,t=0;1==this.ScreenObject.DocumentType||39==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||6==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||13==this.ScreenObject.DocumentType?null!=this.ScreenObject.CreditAccount&&this.ScreenObject.CreditAccount.SelectedValue>0&&(e=this.ScreenObject.CreditAccount.SelectedValue):11!=this.ScreenObject.DocumentType&&38!=this.ScreenObject.DocumentType&&5!=this.ScreenObject.DocumentType&&7!=this.ScreenObject.DocumentType&&9!=this.ScreenObject.DocumentType&&24!=this.ScreenObject.DocumentType&&33!=this.ScreenObject.DocumentType&&10!=this.ScreenObject.DocumentType&&8!=this.ScreenObject.DocumentType&&12!=this.ScreenObject.DocumentType||null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.SelectedValue>0&&(e=this.ScreenObject.DebitAccount.SelectedValue);let s=1,i=1,r=!1;null==this.Currency||n.e.IsEmpty(this.Currency.Currency.SelectedValue)||(s=parseInt(this.Currency.Currency.SelectedValue)),null==this.Currency||n.e.IsEmpty(this.Currency.ExchangeRate.Text)||(i=parseFloat(this.Currency.ExchangeRate.Text));for(let a=0;a<this.BillWisedt.length;a++)if(!n.e.IsEmpty(this.BillWisedt[a].AccountID)&&!n.e.IsEmpty(this.BillWisedt[a].Amount)&&parseInt(this.BillWisedt[a].AccountID)==e&&(t=parseFloat(this.BillWisedt[a].Amount),n.e.IsEmpty(this.BillWisedt[a].CurrencyID)||(s=parseInt(this.BillWisedt[a].CurrencyID)),n.e.IsEmpty(this.BillWisedt[a].ExchangeRate)||(i=parseFloat(this.BillWisedt[a].ExchangeRate)),!n.e.IsEmpty(this.BillWisedt[a].XML))){r=!0;let e=new n.f;e.LoadXml("<BillWise> "+this.BillWisedt[a].XML.toString()+"</BillWise> ");let s=e.SelectNodes("BillWise/Row"),i=0;for(let t=0;t<s.length;t++)""!=s[t].attributes.AmountFC.value&&"0"==s[t].attributes.IsNewReference.value&&(i+=parseFloat(s[t].attributes.AmountFC.value.replace("-","")));t-=i}if(t>0&&e>0){let n=new Ee.PostVoucherSaveViewModel(this,parseInt(this.ScreenObject.Preferences.PostVoucherDocument),t,e,s,i,r,!1);this.ScreenObject.Preferences.ContainsKey("DisplayBeforepost")&&""!=this.ScreenObject.Preferences.DisplayBeforepost&&Object(o.j)(this.ScreenObject.Preferences.DisplayBeforepost)?a.a.page.ShowDialog(n,Ne.PostVoucherSaveComponent):(n.OnButtonClick("OK"),this.DisplayMessage=this.DisplayMessage+"\n"+n.DisplayMessage)}}}this.ScreenObject.GridDataColumns.Contains("NextStageID")&&this.OpenNextStage();for(let e=0;e<this.Shortcuts.length;e++)this.Shortcuts[e]instanceof y.a&&6==this.Shortcuts[e].Mode&&this.ScreenObject.GridData.length>0&&this.ValidateData_Column(this.Shortcuts[e],this.ScreenObject.GridData[0],!0)?this.ScreenObject.GetExternalFuncData(this.Shortcuts[e].Mode,this.Shortcuts[e].SPName,this.Shortcuts[e].IPParams,this.Shortcuts[e].OPParams,this.ScreenObject.GridData[0],!0):this.Shortcuts[e]instanceof b.c&&6==this.Shortcuts[e].Mode&&this.ScreenObject.GetExternalFuncData(this.Shortcuts[e].Mode,this.Shortcuts[e].ToolTipFooterTitle,this.Shortcuts[e].ToolTipFooterDescription,this.Shortcuts[e].ToolTipDescription,null,!0);if(n.e.IsEmpty(this.ScreenObject.ExternalFuncErrorMessage)||(this.DisplayMessage=this.DisplayMessage+"\r\n "+this.ScreenObject.ExternalFuncErrorMessage),null!=this.SaveCallBack&&this.SaveCallBack.Call({CostCenterID:this.ScreenObject.CostCenterID,DocID:this.ScreenObject.DocID}),"SaveAndPrint"==this.commandprarameter||"ApproveandPrint"==this.commandprarameter||"NoWorkFlowprint"==this.commandprarameter){let e=yield this.PrintVoucher(!1,this.ScreenObject.DocID.toString(),!0,null);this.DisplayMessage=this.DisplayMessage+"\r\n "+e}if(!this.IgnoreOnSave.ContainsKey("PostVoucherSave"))if(this.ScreenObject.Preferences.ContainsKey("onSaveNextVoucher")&&Object(o.j)(this.ScreenObject.Preferences.onSaveNextVoucher)){let e=this.DisplayMessage;this.GetData("NEXT"),this.DisplayMessage=e}else if(this.ScreenObject.Preferences.ContainsKey("ShowCurrentPostedVoucher")&&Object(o.j)(this.ScreenObject.Preferences.ShowCurrentPostedVoucher)){let e=this.DisplayMessage,t={value:this._Ddate};this.ScreenObject.OnDocPrefixChanged("lostFocus",1,0,t,!0),this.DocumentDate=t.value,this.QuickInfoVisibility=!1,this.DQuickInfoVisibility=!1,this.DisplayMessage=e}else{if(this.IsPOs&&0==this.PrevDocID){let e=0;null!=this.ScreenObject.DocPrefix.ComboBox.SelectedItem&&""!=this.ScreenObject.DocPrefix.ComboBox.SelectedItem.Aliasname&&(e=parseInt(this.ScreenObject.DocPrefix.ComboBox.SelectedItem.Aliasname));let t=(parseInt(this.ScreenObject.DocPrefix.TextBox.Text)+1).toString();for(;t.length<e;)t="0"+t;this.ScreenObject.DocPrefix.TextBox.Text=t}else{let e={value:this._Ddate};this.ScreenObject.OnDocPrefixChanged(this.ScreenObject.Prefix,0,0,e,!1),this._Ddate=e.value,null!=this.AutoPostViewModel&&(e={value:this.AutoPostViewModel._Ddate},this.AutoPostViewModel.ScreenObject.OnDocPrefixChanged(this.AutoPostViewModel.ScreenObject.Prefix,0,0,e,!1),this.AutoPostViewModel._Ddate=e.value)}this.clear(2),("POSDocumentViewModel"==this.ClassName||a.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==a.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase())&&this.ScreenObject.FillListViews(!1)}this.PoleDisplayMessage(1,null)}else e&&"Problem in processing your request, Please contact administrator."==this.DisplayMessage&&confirm("Do you want to report issue?")&&a.a.page.ShowDialog(new st.SendEmailSMSViewModel(!0,-999,0,null),it.SendEmailSMSComponent);this.commandprarameter="",this.IgnoreOnSave.Clear()}))}OpenNextStage(){let e=0;for(let t=0;t<this.ScreenObject.GridData.length;t++)if(!n.e.IsEmpty(this.ScreenObject.GridData[t].NextStageID)){e++;break}if(e>0&&""!=this.ScreenObject.Preferences.Autopostdocument){let e=new es(parseInt(this.ScreenObject.Preferences.Autopostdocument),"",!0);{let t=[];for(let s=0;s<this.ScreenObject.GridData.length;s++)if(!n.e.IsEmpty(this.ScreenObject.GridData[s].NextStageID)&&!t.Contains(this.ScreenObject.GridData[s].NextStageID)){let i=e.ScreenObject.Link.LinkCombo.Items.find(e=>!n.e.IsEmpty(e.Parent)&&"158"==e.Parent);if(i){e.ScreenObject.Link.LinkCombo.SelectedValue=i.Value,e.OLinkSelectionChanged(i.Value);let a=this.ScreenObject.Link.DocumentList.Items.find(e=>e.IsChecked);if(a=e.ScreenObject.Link.DocumentList.Items.find(e=>e.Value==a.Value),null!=a){a.IsChecked=!0;let r=new Q.a(e,a.Name,parseInt(i.Value),parseInt(a.Value),!1),o=r.ds.Tables[3].sort((e,t)=>e.lft-t.lft);for(let e=0;e<o.length;e++)if(o[e].StageNodeID.toString()==this.ScreenObject.GridData[s].NextStageID.toString()&&o.length>e+1){if(r.ds.Tables[0].filter(t=>t.BOMID==o[e+1].BOMID&&t.StageID==o[e+1].StageID).length>0){(n.e.IsEmpty(r.Boms.SelectedValue)||r.Boms.SelectedValue!=o[e+1].BOMID.toString())&&(r.Boms.SelectedValue=o[e+1].BOMID.toString(),r.onBomChanged(r.Boms.SelectedValue)),r.Boms.SelectedItem=r.Boms.GetselectedItem(),(n.e.IsEmpty(r.Stages.SelectedValue)||r.Stages.SelectedValue!=o[e+1].StageID.toString())&&(r.Stages.SelectedValue=o[e+1].StageID.toString(),r.FillJobProducts()),r.Stages.SelectedItem=r.Stages.GetselectedItem();let i=r.GridData.filter(e=>e.ProductID_Key==this.ScreenObject.GridData[s].ProductID_Key);i.length>0&&(t.push(this.ScreenObject.GridData[s].NextStageID.toString()),n.e.IsNum(i[0].ActualQty)&&n.e.IsNum(this.ScreenObject.GridData[s].Quantity)&&(r.RemQTY.Text=(parseFloat(this.ScreenObject.GridData[s].Quantity)/parseFloat(i[0].ActualQty)).ToString("N"+r.decimalpoints),r.CalcRemQty(),r.GridData.forEach(e=>{n.e.IsEmpty(e.Select)||(e.Select=!0)}),r.OnSave("Add"),r.OnSave("OKNoClose")))}break}}}}t.length>0&&(e.OKCancelVisibility=!0,a.a.page.ShowDialog(e,B.AddEditDocumentComponent))}}}SetFocusForHeader(e){for(let t=0;t<e.length;t++){let s=e[t];if(s instanceof m.b){if(s.IsTabStop&&s.Visible)return s.SetFocus=!0,!0}else if(s instanceof C.a){if(s.IsTabStop&&s.Visible)return s.Code.Visible?s.Code.SetFocus=!0:s.Name.SetFocus=!0,!0}else if(s instanceof d.d){if(s.IsTabStop&&s.Visible)return s.SetFocus=!0,!0}else if(s instanceof d.c){if(s.IsTabStop&&s.Visible)return s.SetFocus=!0,!0}else if(s instanceof p.a){if(s.IsTabStop&&s.Visible)return s.TextBox.SetFocus=!0,!0}else if(s instanceof u.d&&s.IsTabStop&&s.Visible)return s.SetFocus=!0,!0}return!1}SetFocus(){if((38==this.DocumentType||39==this.DocumentType)&&null!=this.SKU&&this.SKU.Visible&&this.SKU.IsTabStop)return void(this.SKU.SetFocus=!0);if(this.SetFocusForHeader(this.ScreenObject.HeaderFields))return;if(this.ScreenObject.CustomTab.Pages.length>0&&this.SetFocusForHeader(this.ScreenObject.CustomTab.Pages[0].Fields))return;this.LineNo=1,this.SetFocusongrid=!0;let e=this.GetPrimaryColName();if(""!=e){let t=this.ScreenObject.ColumnSource.find(t=>!n.e.IsEmpty(t.ValueMember)&&t.IsVisible&&!t.DisableTab&&t.ValueMember.toLowerCase()==e.toLowerCase());t?this.ColumnNo=this.ScreenObject.ColumnSource.indexOf(t)+1:(t=this.ScreenObject.ColumnSource.find(e=>e.IsVisible&&!e.DisableTab),t&&(this.ColumnNo=this.ScreenObject.ColumnSource.indexOf(t)+1))}}ChequeReturn(e,t,s,i,n,r,l){let c=i;if(null!=t&&""!=s&&(c=parseFloat(t[s])),a.a.SessionManager.Preferences.ContainsKey("enableChequeReturnHistory")&&""!=a.a.SessionManager.Preferences.enableChequeReturnHistory&&Object(o.j)(a.a.SessionManager.Preferences.enableChequeReturnHistory)){let t=1,s=null;!this.IsInventoryVoucher&&this.SelectedRow&&(s=this.SelectedRow,t=parseInt(this.SelectedRow.DocSeqNo));let i=this.ScreenObject.GetChequeReturnDetails(e,n,this.ScreenObject.VoucherNo,t,s,this.DocumentDate);if(null!=i&&i.Tables.length>0&&!i.Columns[0].Contains("ErrorMessage")&&i.Tables[0].length>0){let t=new z(this,!this.IsInventoryVoucher&&this.SelectedRow?this.SelectedRow:null,this.ScreenObject.IsDocEdit?this.ScreenObject.VoucherNo:"",c,e,n,r,l,i);this.IgnoreOnSave.push("ChequeReturn",t),this.isChequeReturn=!0,a.a.page.ShowDialog(t,J.a,{HideClose:!0})}}}CheckDistCosts(e,t,s,i,r=!1){if(!(!n.e.IsEmpty(t.DocDetailsID)&&parseFloat(t.DocDetailsID.toString())>0||this.ScreenObject.GridDataColumns.Contains("IsDistributed")&&"1"==n.e.String(t.IsDistributed))&&a.a.SessionManager.Preferences.ContainsKey("DistributeCost")&&"True"==a.a.SessionManager.Preferences.DistributeCost&&a.a.SessionManager.Preferences.ContainsKey("CostBasedON")&&"True"==a.a.SessionManager.Preferences.CostBasedON&&a.a.SessionManager.Preferences.ContainsKey("CostBasedONDims")&&""!=a.a.SessionManager.Preferences.CostBasedONDims){var o=a.a.SessionManager.Preferences.CostBasedONDims.split(",");let r="",h=!1;for(let s=0;s<o.length;s++){let i=o[s];if(parseInt(i)>5e4)if(this.ScreenObject.GridDataColumns.Contains("DCCCNID"+(parseInt(i)-5e4)+"_Key"))n.e.IsEmpty(t["DCCCNID"+(parseInt(i)-5e4)+"_Key"])||(r+=" and DCCCNID"+(parseInt(i)-5e4)+"="+t["DCCCNID"+(parseInt(i)-5e4)+"_Key"].toString());else{var l=this.ScreenObject._CCFields.find(e=>e instanceof m.b&&e.CCID==parseInt(i));l&&l.SelectedValue>0&&(r+=" and DCCCNID"+(parseInt(i)-5e4)+"="+l.SelectedValue.toString())}else 2==parseInt(i)?r+=" and AccountID in("+e+",0)":502==parseInt(i)&&(h=!0,r+=" and (db.AccountID is not null or Cr.AccountID is not null)")}let u=this.ScreenObject.getProfileBasedon(e,0,h,r);if(null!=u&&u.Tables.length>0&&u.Columns[0].Contains("ProfileID")&&u.Tables[0].length>0){this.ScreenObject.GridDataColumns.Contains("IsDistributed")||this.ScreenObject.GridDataColumns.push("IsDistributed");let e=0,r=0,o=0;var c=a.a.SessionManager.Preferences.DistributeCostDims.split(",");for(let l=0;l<u.Tables[0].length;l++){if(l+1==u.Tables[0].length?r=parseFloat((s-o).ToString("N"+a.a.SessionManager.Preferences.DecimalsinAmount.toString())):!n.e.IsEmpty(u.Tables[0][l].Percent)&&parseFloat(u.Tables[0][l].Percent.toString())>0?r=parseFloat((s*parseFloat(u.Tables[0][l].Percent.toString())/100).ToString("N"+a.a.SessionManager.Preferences.DecimalsinAmount.toString())):!n.e.IsEmpty(u.Tables[0][l].Amount)&&parseFloat(u.Tables[0][l].Amount.toString())>0&&(r=parseFloat(u.Tables[0][l].Amount.toString())),a.a.SessionManager.Preferences.ContainsKey("ExclZerodist")&&"True"==a.a.SessionManager.Preferences.ExclZerodist&&0==r)continue;let h;if(e++,1==e)h=t;else{h=this.ScreenObject.GridDataObj.NewRow();for(let e=0;e<this.ScreenObject.GridDataColumns.length;e++)"docseqno"!=this.ScreenObject.GridDataColumns[e].toLowerCase()&&"docdetailsid"!=this.ScreenObject.GridDataColumns[e].toLowerCase()&&(h[e]=t[e]);this.ScreenObject.GridDataObj.insertRowAt(h,this.ScreenObject.GridData.indexOf(t)+1)}o+=r,h.IsDistributed=1,h[i]=r,c.forEach(e=>{parseInt(e)>5e4&&u.Columns[0].Contains("DCCCNID"+(parseInt(e)-5e4))&&""!=u.Tables[0][l]["DCCCNID"+(parseInt(e)-5e4)].toString()&&this.ScreenObject.GridDataColumns.Contains("DCCCNID"+(parseInt(e)-5e4)+"_Key")&&(h["DCCCNID"+(parseInt(e)-5e4)]=null,h["DCCCNID"+(parseInt(e)-5e4)+"_Key"]=u.Tables[0][l]["DCCCNID"+(parseInt(e)-5e4)].toString())}),this.CalculateTotals(h,!1)}this.ScreenObject.UpdateSequence(),this.RefreshGrid=!0}}}CheckIsBillWise(e,t,s,i,r,l,c,h="",u="",d=null){let D=0;"CreditAmount"!=s&&"DebitAmount"!=s&&"Amount"!=s&&""==u||n.e.IsEmpty(t[s])||(D=parseFloat(t[s]));let S="",m="";if(this.ScreenObject.Data.Tables[0].length>0){let e=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&50403==e.LinkData);e.length>0&&this.ScreenObject.GridDataColumns.Contains(e[0].SysColumnName)&&(S=e[0].SysColumnName,m=e[0].ResourceData.toString().Replace(" ",""))}for(let a=0;a<this.ScreenObject.ColumnSource.length;a++)!this.ScreenObject.ColumnSource[a].DisplayMember.toLowerCase().Contains("dcnum")||!this.ScreenObject.ColumnSource[a].IsColumnUserDefined||3!=this.ScreenObject.ColumnSource[a].PostingType&&4!=this.ScreenObject.ColumnSource[a].PostingType||!(r&&0==this.ScreenObject.ColumnSource[a].CreditAcount&&0==this.ScreenObject.ColumnSource[a].CrRefColID||!r&&0==this.ScreenObject.ColumnSource[a].DebitAccount&&0==this.ScreenObject.ColumnSource[a].DrRefColID)||n.e.IsEmpty(t["dcCalc"+this.ScreenObject.ColumnSource[a].DisplayMember])||S==this.ScreenObject.ColumnSource[a].DisplayMember||""!=m&&!n.e.IsEmpty(this.ScreenObject.ColumnSource[a].Formula)&&this.ScreenObject.ColumnSource[a].Formula.Contains(m)||(D+=parseFloat(t["dcCalc"+this.ScreenObject.ColumnSource[a].DisplayMember]));if(Logger.InfoLog("AddEditDocumentViewModel::Entering CheckIsBillWise"),a.a.SessionManager.Preferences.ContainsKey("On")&&"True"==a.a.SessionManager.Preferences.On&&e>0){if(0==i)D=0;else if(("CreditAmount"==s||"DebitAmount"==s||"Amount"==s)&&0==D)return;("CreditAmount"==s||"DebitAmount"==s||"Amount"==s)&&!this.IsInventoryVoucher&&D<0&&(r=!r,D*=-1),("CreditAmount"==s||"DebitAmount"==s)&&this.ScreenObject.Preferences.ContainsKey("Valueonbillwise")&&""!=this.ScreenObject.Preferences.Valueonbillwise&&Object(o.j)(this.ScreenObject.Preferences.Valueonbillwise)&&(r="CreditAmount"==s,D=0),this.DialogResult=!1;let S=new R;if(S.BillWiseViewModel_2(this,D,e,r,l,c,!0,u),this.DialogResult)this.CheckDistCosts(e,t,i,s,!1);else if(""!=h){var b=S.GridData.filter(e=>e.DocNo==h);if(b.length>0&&!n.e.IsEmpty(b[0].Due)){b[0].AmountPaidLC=b[0].Due;let e=0,s=0;n.e.IsEmpty(b[0].CurrID)||parseInt(b[0].CurrID.toString())!=l||""==b[0].ExchgRate.toString()||parseFloat(b[0].ExchgRate.toString())==c?s=parseFloat(b[0].AmountPaidLC.toString())/c:(s=parseFloat(b[0].AmountPaidLC.toString())/parseFloat(b[0].ExchgRate.toString()),e=parseFloat(b[0].AmountPaid.toString())*(parseFloat(b[0].ExchgRate.toString())-c)),S.AmtToAdjust.Text=s.ToString("N"+S.decimalpoints),S.NewReference.Text="0",b[0].AmountPaid=s.ToString("N"+S.decimalpoints),this.ScreenObject.GridDataColumns.Contains("Amount")&&(t.Amount=s.ToString("N"+S.decimalpoints)),this.Celleditend(t,"DocSeqNo",0),b[0].exchgl=e,S.PaidChange("AmountPaid",b[0],!1),S.OnSave("autosave")}}else n.e.IsEmpty(t.ExtraXML)&&this.ScreenObject.Preferences.ContainsKey("Billwise Fifo")&&Object(o.j)(this.ScreenObject.Preferences["Billwise Fifo"])?(S.Fifo=!0,S.OnSave("autosave")):a.a.page.ShowDialog(S,L.a,{ShowCenter:!0},()=>{d()})}Logger.InfoLog("AddEditDocumentViewModel::Exiting CheckIsBillWise")}CheckAccountBalance(e,t,s){if(!this.IsInventoryVoucher||a.a.SessionManager.Preferences.ContainsKey("DontSaveCahsBankBalanceNegative")&&""!=a.a.SessionManager.Preferences.DontSaveCahsBankBalanceNegative&&Object(o.j)(a.a.SessionManager.Preferences.DontSaveCahsBankBalanceNegative)){let i=this.ScreenObject.GetAccBalance(e,this.DocumentDate);if(!this.IsInventoryVoucher&&null!=i&&i.Tables.length>0&&i.Tables[0].length>0&&i.Columns[0].Contains("IsBillwise")&&!n.e.IsEmpty(i.Tables[0][0].IsBillwise)&&Object(o.j)(i.Tables[0][0].IsBillwise)&&(14==this.ScreenObject.DocumentType||15==this.ScreenObject.DocumentType||20==this.ScreenObject.DocumentType||23==this.ScreenObject.DocumentType||18==this.ScreenObject.DocumentType||19==this.ScreenObject.DocumentType||21==this.ScreenObject.DocumentType||22==this.ScreenObject.DocumentType))return this.DisplayMessage=14==this.ScreenObject.DocumentType||15==this.ScreenObject.DocumentType||20==this.ScreenObject.DocumentType||23==this.ScreenObject.DocumentType?"Can not select billwise account in payment Mode":"Can not select billwise account in reciept Mode",!0;if((this.IsInventoryVoucher||a.a.SessionManager.Preferences.ContainsKey("DontSaveCahsBankBalanceNegative")&&""!=a.a.SessionManager.Preferences.DontSaveCahsBankBalanceNegative&&Object(o.j)(a.a.SessionManager.Preferences.DontSaveCahsBankBalanceNegative))&&null!=i&&i.Tables.length>0&&i.Tables[0].length>0&&i.Columns[0].Contains("BalDocDate")&&!n.e.IsEmpty(i.Tables[0][0].BalDocDate)){let e=parseFloat(i.Tables[0][0].BalDocDate);if(this.IsInventoryVoucher){if(s?e+=t:e-=t,e<0)return!0}else if(e=-e,s?e-=t:e+=t,e=parseFloat(e.ToString("N"+a.a.SessionManager.Preferences.DecimalsinAmount)),e<0)return!(i.Columns[0].Contains("AccountTypeID")&&"1"!=i.Tables[0][0].AccountTypeID.toString()&&"2"!=i.Tables[0][0].AccountTypeID.toString()&&"10"!=i.Tables[0][0].AccountTypeID.toString()||a.a.SessionManager.IsActionAssigned(43,"OverrideNegativeBalance")&&confirm("Balance goes negative do you want to proceed?"))}}return!1}CheckCreditLimit(e,t,s){if(0===t)return!0;if(Logger.InfoLog("AddEditDocumentViewModel::Entering CheckCreditLimit"),s&&(a.a.SessionManager.Preferences.ContainsKey("Warn if balance exceeds Credit Limit")&&"True"==a.a.SessionManager.Preferences["Warn if balance exceeds Credit Limit"]||a.a.SessionManager.Preferences.ContainsKey("Warncreditdays")&&"True"==a.a.SessionManager.Preferences.Warncreditdays)){let s=0;if(a.a.SessionManager.Preferences.ContainsKey("DimWiseCreditDebit")&&""!=a.a.SessionManager.Preferences.DimWiseCreditDebit&&parseInt(a.a.SessionManager.Preferences.DimWiseCreditDebit)>0){let e=this.ScreenObject._CCFields.find(e=>e.DBColumnName.toLowerCase()=="dcccnid"+(parseInt(a.a.SessionManager.Preferences.DimWiseCreditDebit)-5e4));e&&e instanceof m.b&&e.SelectedValue>0&&(s=e.SelectedValue)}let i=this.ScreenObject.CheckCreditLimit(e,t,this.DocumentDate,s);if(a.a.SessionManager.Preferences.ContainsKey("Warn if balance exceeds Credit Limit")&&"True"==a.a.SessionManager.Preferences["Warn if balance exceeds Credit Limit"]&&null!=i&&i.Tables.length>0&&i.Tables[0].length>0&&"1"==i.Tables[0][0][i.Columns[0][0]].toString()){if(!a.a.SessionManager.IsActionAssigned(43,"OverrideCreditLimit"))return this.DisplayMessage="Balance exceeds Credit limit",!1;if(this.res="",!confirm("Credit limit exceeds do you want to proceed ? "))return!1}if(a.a.SessionManager.Preferences.ContainsKey("Warncreditdays")&&"True"==a.a.SessionManager.Preferences.Warncreditdays&&null!=i&&i.Tables.length>1&&i.Tables[1].length>0){if(!a.a.SessionManager.IsActionAssigned(43,"OverrideCreditDays"))return this.DisplayMessage="Credit Days Exceeds for "+i.Tables[1][0][i.Columns[1][0]].toString(),!1;if(this.res="",!confirm("Credit Days Exceeds for"+i.Tables[1][0][i.Columns[1][0]].toString()+".Do you want to proceed ? "))return!1}}else if(!s&&(a.a.SessionManager.Preferences.ContainsKey("Warn if balance exceeds debit Limit")&&"True"==a.a.SessionManager.Preferences["Warn if balance exceeds debit Limit"]||a.a.SessionManager.Preferences.ContainsKey("Warndebitdays")&&"True"==a.a.SessionManager.Preferences.Warndebitdays)){let s=0;if(a.a.SessionManager.Preferences.ContainsKey("DimWiseCreditDebit")&&""!=a.a.SessionManager.Preferences.DimWiseCreditDebit&&parseInt(a.a.SessionManager.Preferences.DimWiseCreditDebit)>0){let e=this.ScreenObject._CCFields.find(e=>e.DBColumnName.toLowerCase()=="dcccnid"+(parseInt(a.a.SessionManager.Preferences.DimWiseCreditDebit)-5e4));e&&e instanceof m.b&&e.SelectedValue>0&&(s=e.SelectedValue)}let i=this.ScreenObject.CheckCreditLimit(e,t,this.DocumentDate,s);if(a.a.SessionManager.Preferences.ContainsKey("Warn if balance exceeds debit Limit")&&"True"==a.a.SessionManager.Preferences["Warn if balance exceeds debit Limit"]&&null!=i&&i.Tables.length>0&&i.Tables[0].length>0&&"1"==i.Tables[0][0][i.Columns[0][0]].toString()){if(!a.a.SessionManager.IsActionAssigned(43,"OverrideCreditLimit"))return this.DisplayMessage="Balance exceeds Credit limit",!1;if(this.res="",!confirm("Credit limit exceeds do you want to proceed ? "))return!1}if(a.a.SessionManager.Preferences.ContainsKey("Warndebitdays")&&"True"==a.a.SessionManager.Preferences.Warndebitdays&&null!=i&&i.Tables.length>1&&i.Tables[1].length>0){if(!a.a.SessionManager.IsActionAssigned(43,"OverrideCreditDays"))return this.DisplayMessage="Credit Days Exceeds for "+i.Tables[1][0][i.Columns[1][0]].toString(),!1;if(this.res="",!confirm("Credit Days Exceeds for"+i.Tables[1][0][i.Columns[1][0]].toString()+".Do you want to proceed ? "))return!1}}return!0}LoadDOcument(){let e=0,t=0;a.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==a.a.SessionManager.Preferences.EnableDivisionWise.toString()&&(this.ScreenObject.DivisionID>0?t=this.ScreenObject.DivisionID:a.a.SessionManager.DivisionID>0&&(t=a.a.SessionManager.DivisionID)),a.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==a.a.SessionManager.Preferences.EnableLocationWise.toString()&&(this.ScreenObject.LocationID>0?e=this.ScreenObject.LocationID:a.a.SessionManager.LocationID>0&&(e=a.a.SessionManager.LocationID));let s=0;a.a.SessionManager.IsActionAssigned(43,"Dimension wise Documents")&&(a.a.SessionManager.Preferences.ContainsKey("DimensionwiseDocuments")&&n.e.IsNum(a.a.SessionManager.Preferences.DimensionwiseDocuments)&&(s=parseInt(a.a.SessionManager.Preferences.DimensionwiseDocuments)),s>5e4)&&0==this.ScreenObject.Data.Tables[0].filter(e=>e.ColumnCostCenterID==s).length&&(s=0);let i=new St;i.PreviousTextDialog_1(this.CostCenterID,this.IsInventoryVoucher,e,t,s,this.ScreenObject.Data.Tables[3][0].DocumentAbbr.toString()),a.a.page.ShowDialog(i,mt.a,{ShowCenter:!0,NoWidth:!0}).subscribe(()=>{if(n.e.IsValidID(i.DocID)){let e={value:this._Ddate};this.ScreenObject.OnDocPrefixChanged("lostFocus",0,i.DocID,e,!0),this._Ddate=e.value}})}GetData(e){if(Logger.InfoLog("AddEditDocumentViewModel::Entering GetData"),this.ConfirmDirtyRead()&&("Next"!=e.toString()||!(a.a.SessionManager.Preferences.ContainsKey("ConfirmonNext")&&"TRUE"==a.a.SessionManager.Preferences.ConfirmonNext.toUpperCase()||this.ScreenObject.Preferences.ContainsKey("ConfirmonNext")&&"TRUE"==this.ScreenObject.Preferences.ConfirmonNext.toUpperCase())||confirm("Do you want Next Document?"))&&("Previous"!=e.toString()||!(a.a.SessionManager.Preferences.ContainsKey("ConfirmonPrevious")&&"TRUE"==a.a.SessionManager.Preferences.ConfirmonPrevious.toUpperCase()||this.ScreenObject.Preferences.ContainsKey("ConfirmonPrevious")&&"TRUE"==this.ScreenObject.Preferences.ConfirmonPrevious.toUpperCase())||confirm("Do you want Previous Document?"))){if(this.MessageVisibility=!1,this.ReportDimension.SelectedValue=0,72==this.ScreenObject.DocumentType&&(this.isVacContractedit=!0,this.dtVacContract=null,this.ShowVacationCreditDaysDetail(0)),""!=this.ScreenObject.DocPrefix.TextBox.Text)try{let t=0;if(null!=this.ScreenObject.DocPrefix.ComboBox.SelectedItem&&""!=this.ScreenObject.DocPrefix.ComboBox.SelectedItem.Aliasname&&(t=parseInt(this.ScreenObject.DocPrefix.ComboBox.SelectedItem.Aliasname)),"LoadDocument"==e.toString())this.LoadDOcument();else if("NEXT"==e.toString().toUpperCase()){let e=(parseInt(this.ScreenObject.DocPrefix.TextBox.Text)+1).toString();for(;e.length<t;)e="0"+e;this.ScreenObject.DocPrefix.TextBox.Text=e;let s={value:this._Ddate};this.ScreenObject.OnDocPrefixChanged("lostFocus",2,0,s,!0),this._Ddate=s.value,this.QuickInfoVisibility=!1,this.DQuickInfoVisibility=!1}else if(parseInt(this.ScreenObject.DocPrefix.TextBox.Text)>1){let e=(parseInt(this.ScreenObject.DocPrefix.TextBox.Text)-1).toString();for(;e.length<t;)e="0"+e;this.ScreenObject.DocPrefix.TextBox.Text=e;let s={value:this._Ddate};this.ScreenObject.OnDocPrefixChanged("lostFocus",1,0,s,!0),this._Ddate=s.value,this.QuickInfoVisibility=!1,this.DQuickInfoVisibility=!1}if(72==this.ScreenObject.DocumentType){let e=0,t=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());(t&&t instanceof m.b&&t.SelectedValue>0||t&&t instanceof C.a&&t.SelectedValue>0)&&(e=t.SelectedValue),this.ShowVacationCreditDaysDetail(e),this.isVacContractedit=!1}this.ScreenObject.IsDocEdit||this.clear(4)}catch(t){this.DisplayMessage="Error Loading document try again",Logger.ErrorLog("Addeditdocumentviewmodel","OnDocPrefixChanged",t)}this.ScreenObject.Preferences.ContainsKey("HideBody")&&!n.e.IsEmpty(this.ScreenObject.Preferences.HideBody)&&Object(o.j)(this.ScreenObject.Preferences.HideBody.toString())&&(this.BodyVisible=!1),Logger.InfoLog("AddEditDocumentViewModel::Exiting GetData")}}SortGrid(e){let t=[];if(!e)for(let s=0;s<this.DtImport.length;s++)if(!n.e.IsEmpty(this.DtImport[s].FieldName)){let e={name:this.DtImport[s].FieldName,desc:!1};"Desc"!=n.e.String(this.DtImport[s].Order)&&"numdesc"!=n.e.String(this.DtImport[s].Order).toLowerCase()||(e.desc=!0),t.push(e)}if(e){if(!this.IsInventoryVoucher)return;if(this.ScreenObject.Preferences.ContainsKey("Sortbasedon")&&!n.e.IsEmpty(this.ScreenObject.Preferences.Sortbasedon)){let e=this.ScreenObject.ColumnSource.find(e=>e.ID==this.ScreenObject.Preferences.Sortbasedon);e&&!n.e.IsEmpty(e.ValueBinding)&&this.ScreenObject.GridDataColumns.Contains(e.ValueBinding)?t.push({name:e.ValueBinding,desc:!0}):e&&!n.e.IsEmpty(e.DisplayMember)&&this.ScreenObject.GridDataColumns.Contains(e.DisplayMember)&&t.push({name:e.DisplayMember,desc:!0})}else t.push({name:"ProductID_Key",desc:!0})}else{if(!(t.length>0))return;{let e="";this.IsInventoryVoucher?e="ProductID_key":this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")?e="CreditAccount_Key":this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")?e="DebitAccount_Key":this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&(e="AccountID_Key"),e.length>0&&(t.InsertAt("EmptySort",0),this.ScreenObject.GridData.map(t=>t.EmptySort=Object(f.isNullOrUndefined)(t[e])?1:0))}}console.log(t),this.ScreenObject.GridData.SortBy(t);for(let s=0;s<this.ScreenObject.GridData.length;s++)this.ScreenObject.GridData[s].DocSeqNo=s+1;this.ScreenObject.GridDataObj.refreshDataView()}LoadLinkData(e,t,s,i,l,c=null){if(1==e.Tables.length&&e.Columns[0].Contains("ErrorMessage"))return;let h,u=null;try{let p=new Date;if(this.ScreenObject.AttachDetach(!1),this.ScreenObject.Preferences.ContainsKey("SameserialNo")&&""!=this.ScreenObject.Preferences.SameserialNo&&Object(o.j)(this.ScreenObject.Preferences.SameserialNo)&&null==l&&e.Tables[0].length>0&&(this.ScreenObject.DocPrefix.TextBox.Text=e.Tables[0][0].DocNumber.toString()),null==l){var D=e.Tables[4].filter(e=>"DocDate"==e.BASECOL);D.length>0&&e.Tables[0].length>0&&(""!=D[0].LINKCOL.toString()&&e.Columns[0].Contains(D[0].LINKCOL.toString())&&n.e.isValidDate(e.Tables[0][0][D[0].LINKCOL.toString()])?(p=new Date(e.Tables[0][0][D[0].LINKCOL]),this.DocumentDate=n.e.diffparseDate(p.ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm a"))):""!=D[0].LINKCOL.toString()&&e.Columns[3].Contains(D[0].LINKCOL.toString())&&n.e.isValidDate(e.Tables[3][0][D[0].LINKCOL.toString()])&&(p=new Date(e.Tables[3][0][D[0].LINKCOL]),this.DocumentDate=n.e.diffparseDate(p.ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm a"))))}this.ScreenObject.LoadLinkFieldsData_3(e,l,t);let g=new r.c;null==l&&this.ScreenObject.Preferences.ContainsKey("DimensionWise")&&""!=this.ScreenObject.Preferences.DimensionWise&&this.ScreenObject.Preferences.DimensionWise.split(",").forEach(e=>{if(""!=e){let t=parseInt(e);if(3==t)for(let e=0;e<this.ScreenObject._TextFields.length;e++){let s=this.ScreenObject._TextFields[e];if(s instanceof m.b&&s.CCID==t){s.SelectedValue>0&&g.push(t,s.SelectedValue);break}}else if(t>5e4)for(let e=0;e<this.ScreenObject._CCFields.length;e++){let s=this.ScreenObject._CCFields[e];if(s instanceof m.b&&s.CCID==t){s.SelectedValue>0&&g.push(t,s.SelectedValue);break}}}});let O=0,I="",T=!1;this.ScreenObject.Preferences.ContainsKey("EnableSchemes")&&Object(o.j)(this.ScreenObject.Preferences.EnableSchemes)&&(T=Object(o.j)(this.ScreenObject.Preferences.EnableSchemes));let j,P=null;this.IsInventoryVoucher&&this.ScreenObject.Preferences.ContainsKey("CopyProductdata")&&""!=this.ScreenObject.Preferences.CopyProductdata&&Object(o.j)(this.ScreenObject.Preferences.CopyProductdata)&&(P=new r.a);let A=null;e.Columns[0].Contains("sno")&&(A=e.Tables[0].sort((e,t)=>e.sno-t.sno));for(let r=0;r<e.Tables[0].length&&(j=A&&null!=A?e.Tables[0].IndexOf(A[r]):r,!(this.ScreenObject.Preferences.ContainsKey("linkSingleline")&&""!=this.ScreenObject.Preferences.linkSingleline&&Object(o.j)(this.ScreenObject.Preferences.linkSingleline)&&j>0));r++){if(this.ScreenObject.Preferences.ContainsKey("LinkOnlyFreeQTY")&&Object(o.j)(this.ScreenObject.Preferences.LinkOnlyFreeQTY)&&e.Columns[0].Contains("IsQtyFreeOffer")&&n.e.Int(e.Tables[0][j].IsQtyFreeOffer)>0&&!(e.Columns[0].Contains("ParentSchemeID")&&n.e.Int(e.Tables[0][j].ParentSchemeID)>0))continue;let D=null;if(t&&t.length>0){let s=!1;for(let i=0;i<t.length;i++)if(parseInt(t[i].InvDocDetailsID)==parseInt(e.Tables[0][j].DocDetailsID)){D=t[i],s=!0;break}if(!s)continue}if(e.Columns[0].Contains("DynamicInvDocDetailsID")&&!n.e.IsEmpty(e.Tables[0][j].DynamicInvDocDetailsID)&&n.e.IsValidID(parseInt(e.Tables[0][j].DynamicInvDocDetailsID)))continue;for(let t=0;t<g.keys.length;t++){let s={Key:g.keys[t],Value:g.values[t]};if(3==s.Key){if(e.Columns[0].Contains("ProductColName")&&!n.e.IsEmpty(e.Tables[0][j].ProductColName)&&e.Columns[3].Contains(e.Tables[0][j].ProductColName.toString())&&!n.e.IsEmpty(e.Tables[3][j][e.Tables[0][j].ProductColName.toString()])&&n.e.IsNum(e.Tables[3][j][e.Tables[0][j].ProductColName.toString()])&&parseInt(e.Tables[3][j][e.Tables[0][j].ProductColName.toString()])!=s.Value)continue}else if(s.Key>5e4&&e.Columns[1].Contains("dcCCNID"+(s.Key-5e4).toString())&&!n.e.IsEmpty(e.Tables[1][j]["dcCCNID"+(s.Key-5e4).toString()])&&parseInt(e.Tables[1][j]["dcCCNID"+(s.Key-5e4).toString()])!=s.Value)continue}if(this.ScreenObject.Preferences.ContainsKey("ClubSameProds")&&""!=this.ScreenObject.Preferences.ClubSameProds&&Object(o.j)(this.ScreenObject.Preferences.ClubSameProds)&&!n.e.IsEmpty(e.Tables[0][j].ProductID)){let t=this.ScreenObject.GridData.filter(t=>t.ProductID_key==e.Tables[0][j].ProductID);if(t.length>0){n.e.IsEmpty(t[0].Quantity)||(t[0].defaultQuantity=t[0].Quantity=parseFloat(t[0].Quantity)+parseFloat(e.Tables[0][j].Quantity)),n.e.IsEmpty(t[0].UOMConversion)||n.e.IsEmpty(t[0].Quantity)?n.e.IsEmpty(t[0].Quantity)||(t[0].UOMConvertedQty=t[0].Quantity):t[0].UOMConvertedQty=parseFloat(t[0].Quantity)*parseFloat(t[0].UOMConversion),this.CalculateTotals(t[0],!1,"",!1);continue}}let b=null;h=this.ScreenObject.GridDataObj.NewRow(),this.FillDefaultValues(h);for(let t=0,s=0;t<this.ScreenObject.ColumnSource.length;t++,s++)"DocDetailsID"!=this.ScreenObject.ColumnSource[t].DisplayMember&&"RefNo"!=this.ScreenObject.ColumnSource[t].DisplayMember&&"LinkedFieldName"!=this.ScreenObject.ColumnSource[t].DisplayMember&&("LINK"==this.ScreenObject.ColumnSource[t].DataType&&this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase().Contains("dcalpha")&&(h[this.ScreenObject.ColumnSource[t].DisplayMember]="..."),this.ScreenObject.SetLinkValues(e,this.ScreenObject.ColumnSource[t],j,h,l,""));if(null==l&&this.ScreenObject.Preferences.ContainsKey("GrouptoFilterfield")&&"true"==this.ScreenObject.Preferences.GrouptoFilterfield.toLowerCase()&&this.ScreenObject.Preferences.ContainsKey("ProductFilterField")&&""!=this.ScreenObject.Preferences.ProductFilterField&&e.Columns[0].Contains("IsGroup")&&e.Columns[0].Contains("ParentID")){let t=this.ScreenObject.ColumnSource.find(e=>e.ID==this.ScreenObject.Preferences.ProductFilterField);t&&"LISTBOX"==t.DataType&&this.ScreenObject.GridDataColumns.Contains(t.ValueMember)&&(Object(o.j)(e.Tables[0][j].IsGroup)?(h.ProductID_Key=null,this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(h.ProductCode=null),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(h.ProductName=null),h[t.ValueMember]=e.Tables[0][j].ProductID.toString()):h[t.ValueMember]=e.Tables[0][j].ParentID.toString())}if(this.IsInventoryVoucher&&null==l&&e.Tables.length>15&&e.Tables[15].length>0){let t=e.Tables[15].filter(t=>t.DocDetailsID==e.Tables[0][j].DocDetailsID);if(t.length>1&&this.ScreenObject.Preferences.ContainsKey("PopulateMultiple")&&Object(o.j)(this.ScreenObject.Preferences.PopulateMultiple)){this.ScreenObject.GridDataColumns.Contains("Row_Background")||this.ScreenObject.GridDataColumns.push("Row_Background"),b=[];for(let e=0;e<t.length;e++)if(0==e)h.ProductID_Key=t[e].ProductID,this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(h.ProductCode=t[e].ProductCode),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(h.ProductName=t[e].ProductName),h.Row_Background="#c8D7D0";else{let s=this.ScreenObject.GridDataObj.NewRow();s.ProductID_Key=t[e].ProductID,this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(s.ProductCode=t[e].ProductCode),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(s.ProductName=t[e].ProductName),s.Row_Background="#c8D7D0",b.push(s)}}else t.length>0?(h.ProductID_Key=t[0].ProductID,this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(h.ProductCode=t[0].ProductCode),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(h.ProductName=t[0].ProductName),t.length>1&&(this.ScreenObject.GridDataColumns.Contains("Row_Background")||this.ScreenObject.GridDataColumns.push("Row_Background"),h.Row_Background="#c8D7D0")):(this.ScreenObject.GridDataColumns.Contains("Row_Background")||this.ScreenObject.GridDataColumns.push("Row_Background"),h.Row_Background="#c9c9c9",h.ProductID_Key=e.Tables[0][j].ProductID,this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(h.ProductCode=e.Tables[0][j].ProductCode),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(h.ProductName=e.Tables[0][j].ProductName))}if(i.length>0&&null!=D)for(let e=0;e<i.length;e++){let t=i[e];if(this.ScreenObject.GridDataColumns.Contains(t)){let e=this.ScreenObject.ColumnSource.find(e=>"Name"!=e.DisplayMember&&e.DisplayMember==t);e||(e=this.ScreenObject.ColumnSource.find(e=>"Name"==e.DisplayMember&&e.ValueBinding==t)),e&&(e.CostCenterID>0&&!Object(f.isUndefined)(D[e.ValueMember])&&!n.e.IsEmpty(D[e.ValueMember])?h[e.ValueMember]=D[e.ValueMember]:"DATE"!=e.DataType&&"DateTime"!=e.DataType&&"time"!=e.DataType.toLowerCase()||Object(f.isUndefined)(D[e.DisplayMember+"_Key"])||n.e.IsEmpty(D[e.DisplayMember+"_Key"])?"Name"!=e.DisplayMember||Object(f.isUndefined)(D[e.ValueBinding])||n.e.IsEmpty(D[e.ValueBinding])?n.e.IsEmpty(D[e.DisplayMember])||(h[e.DisplayMember]=D[e.DisplayMember].toString()):h[e.ValueBinding]=D[e.ValueBinding].toString():n.e.isValidDate(D[e.DisplayMember+"_Key"])&&("DateTime"==e.DataType?(h[e.DisplayMember]=new Date(D[e.DisplayMember]).ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm a"),h[e.DisplayMember+"_Key"]=new Date(D[e.DisplayMember+"_Key"])):"time"==e.DataType?(h[e.DisplayMember]=new Date(D[e.DisplayMember]).ToString("hh:mm:ss tt"),h[e.DisplayMember+"_Key"]=new Date(D[e.DisplayMember+"_Key"])):(h[e.DisplayMember]=D[e.DisplayMember].toString(),h[e.DisplayMember+"_Key"]=new Date(D[e.DisplayMember+"_Key"]))))}else{let e=this.ScreenObject._TextFields.find(e=>e.DBColumnName==t);null==e&&(e=this.ScreenObject._CCFields.find(e=>e.DBColumnName==t)),null==e&&(e=this.ScreenObject._StaticFields.find(e=>e.DBColumnName==t)),e&&(e instanceof d.c||e instanceof d.a?Object(f.isUndefined)(D[t+"_Key"])||this.ScreenObject.fillcontrolValue(e,D[t+"_Key"]):e instanceof m.b||e instanceof C.a?(n.e.IsEmpty(D[t+"_Key"])||this.ScreenObject.fillcontrolValue(e,D[t+"_Key"].toString()),this.ScreenObject.GetLinkReferenceData(e.DBColumnID,this.CostCenterID,e.SelectedValue,this.DocumentDate,e.DBColumnName,e.CCID,null)):n.e.IsEmpty(D[t])||this.ScreenObject.fillcontrolValue(e,D[t].toString()))}}if(this.IsInventoryVoucher){null==l&&!this.ScreenObject.RWFieldsExists.Contains("QOH")&&(this.ScreenObject.Preferences.ContainsKey("CheckStock")&&""!=this.ScreenObject.Preferences.CheckStock.toString()&&Object(o.j)(this.ScreenObject.Preferences.CheckStock)||this.ScreenObject.Preferences.ContainsKey("CheckFifoQOH")&&""!=this.ScreenObject.Preferences.CheckFifoQOH.toString()&&Object(o.j)(this.ScreenObject.Preferences.CheckFifoQOH)||this.ScreenObject.Preferences.ContainsKey("LinkPartial")&&""!=this.ScreenObject.Preferences.LinkPartial.toString()&&Object(o.j)(this.ScreenObject.Preferences.LinkPartial))&&this.ScreenObject.RWFieldsExists.push("QOH");let t=null;if(t=null!=P&&P.ContainsKey(parseInt(h.ProductID_Key.toString()))?this.GetProductValues(h,0,!0,null,!1,P[parseInt(h.ProductID_Key.toString())]):this.GetProductValues(h,0,!0),null==P||P.ContainsKey(parseInt(h.ProductID_Key.toString()))||P.push(parseInt(h.ProductID_Key.toString()),t),null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&!t.Columns[0].Contains("ErrorMessage")&&t.Columns[0].Contains("ProductTypeID")&&"8"!=e.Tables[0][j].ProductTypeID.toString()){if(e.Columns[0].Contains("FileGUID")&&(h.FileGUID=t.Tables[0][0].FileGUID.toString(),h.FileExtension=t.Tables[0][0].FileExtension.toString()),parseInt(h.ProductID_Key)!=this.ScreenObject.TempProductID){let s=0;if(h.QOH=t.Columns[0].Contains("QOH")&&!n.e.IsEmpty(t.Tables[0][0].QOH)?t.Tables[0][0].QOH.toString():0,n.e.IsEmpty(h.QOH)||(s=parseFloat(h.QOH)),null==l&&this.ScreenObject.Preferences.ContainsKey("CheckFifoQOH")&&""!=this.ScreenObject.Preferences.CheckFifoQOH.toString()&&Object(o.j)(this.ScreenObject.Preferences.CheckFifoQOH)&&e.Columns[0].Contains("Fifo")&&!n.e.IsEmpty(e.Tables[0][j].Fifo)&&(s-=parseFloat(e.Tables[0][j].Fifo)),null==l&&this.ScreenObject.Preferences.ContainsKey("CheckStock")&&""!=this.ScreenObject.Preferences.CheckStock.toString()&&Object(o.j)(this.ScreenObject.Preferences.CheckStock)&&!n.e.IsEmpty(e.Tables[0][j][e.Columns[0][0]])&&parseFloat(e.Tables[0][j][e.Columns[0][0]])>s)continue;if(null==l&&this.ScreenObject.Preferences.ContainsKey("LinkPartial")&&""!=this.ScreenObject.Preferences.LinkPartial.toString()&&Object(o.j)(this.ScreenObject.Preferences.LinkPartial)){if(!n.e.IsEmpty(e.Tables[0][j][e.Columns[0][0]])&&s<=0)continue;!n.e.IsEmpty(e.Tables[0][j][e.Columns[0][0]])&&s<parseFloat(e.Tables[0][j][e.Columns[0][0]])&&(e.Tables[0][j][e.Columns[0][0]]=s)}h.BalQOH=t.Columns[0].Contains("BalQOH")&&!n.e.IsEmpty(t.Tables[0][0].BalQOH)?t.Tables[0][0].BalQOH.toString():0,h.HOLDQTY=t.Columns[0].Contains("HOLDQTY")&&!n.e.IsEmpty(t.Tables[0][0].HOLDQTY)?t.Tables[0][0].HOLDQTY.toString():0,h.CommittedQty=t.Columns[0].Contains("CommittedQty")&&!n.e.IsEmpty(t.Tables[0][0].CommittedQty)?t.Tables[0][0].CommittedQty.toString():0,h.RESERVEQTY=t.Columns[0].Contains("RESERVEQTY")&&!n.e.IsEmpty(t.Tables[0][0].RESERVEQTY)?t.Tables[0][0].RESERVEQTY.toString():0,h.TotalReserve=t.Columns[0].Contains("TotalReserve")&&!n.e.IsEmpty(t.Tables[0][0].TotalReserve)?t.Tables[0][0].TotalReserve.toString():0}if(t.Tables.length>0&&t.Tables[0].length>0&&!t.Columns[0].Contains("ErrorMessage")&&!n.e.IsEmpty(t.Tables[0][0].DrAccount)&&parseInt(t.Tables[0][0].DrAccount)>0)if(this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key"))if(h.DebitAccount_Key=t.Tables[0][0].DrAccount.toString(),this.ScreenObject.GridDataColumns.Contains("DebitAccount"))h.DebitAccount=t.Tables[0][0].DrName.toString();else{let e=this.ScreenObject.ColumnSource.find(e=>null!=e.ValueMember&&"debitaccount_key"==e.ValueMember.toLowerCase());e&&(h[e.DisplayMember]=t.Tables[0][0].DrName.toString())}else null!=this.ScreenObject.DebitAccount&&(this.ScreenObject.DebitAccount.SelectedValue=parseInt(t.Tables[0][0].DrAccount),a.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==a.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(this.ScreenObject.DebitAccount.Name.SelectedValueText=t.Tables[0][0].DrName.toString()));if(t.Tables.length>0&&t.Tables[0].length>0&&!t.Columns[0].Contains("ErrorMessage")&&!n.e.IsEmpty(t.Tables[0][0].CrAccount)&&parseInt(t.Tables[0][0].CrAccount)>0)if(this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key"))if(h.CreditAccount_Key=t.Tables[0][0].CrAccount.toString(),this.ScreenObject.GridDataColumns.Contains("CreditAccount"))h.CreditAccount=t.Tables[0][0].CrName.toString();else{let e=this.ScreenObject.ColumnSource.find(e=>null!=e.ValueMember&&"creditaccount_key"==e.ValueMember.toLowerCase());e&&(h[e.DisplayMember]=t.Tables[0][0].CrName.toString())}else null!=this.ScreenObject.CreditAccount&&(this.ScreenObject.CreditAccount.SelectedValue=parseInt(t.Tables[0][0].CrAccount),a.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==a.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(this.ScreenObject.CreditAccount.Name.SelectedValueText=t.Tables[0][0].CrName.toString()));h.LASTPURCHASERATE=t.Columns[0].Contains("LastPurchaseRate")&&!n.e.IsEmpty(t.Tables[0][0].LastPurchaseRate)?t.Tables[0][0].LastPurchaseRate.toString():0,h.Subexists=t.Tables.length>8&&t.Tables[8].length>1&&!t.Columns[8].Contains("ErrorMessage")&&this.ScreenObject.Preferences.ContainsKey("EnableSubtitutes")&&""!=this.ScreenObject.Preferences.EnableSubtitutes.toString()&&Object(o.j)(this.ScreenObject.Preferences.EnableSubtitutes)?"1":"0";let s=null;t.Tables.length>3&&t.Tables[3].length>0&&(s=t.Tables[3][0]);let i,r=null;if(i=null!=l?l:e.Tables[4],r=i.filter(e=>"Rate"==e.BASECOL),r=null==l&&e.Columns[4].Contains("CostCenterIDLinked")&&e.Columns[0].Contains("CostCenterID")&&e.Tables[0].length>0?i.filter(t=>"Rate"==t.BASECOL&&t.CostCenterIDLinked==e.Tables[0][0].CostCenterID):i.filter(e=>"Rate"==e.BASECOL),0==r.length){let e=this.ScreenObject.ColumnSource.find(e=>"Rate"==e.DisplayMember),i="";if(null!=s)n.e.IsEmpty(e.Formula)||Object(f.isUndefined)(s[i])||(i=e.Formula),i=1==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||10==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||31==this.ScreenObject.DocumentType?"PurchaseRate":"SellingRate",""==i||n.e.IsEmpty(s[i])||(h.Rate=s[i].toString(),h.defaultRate=s[i].toString());else if(t.Tables.length>0&&t.Tables[0].length>0&&t.Columns[0].Contains("ProdBaseUOM")&&t.Tables[0][0].ProdBaseUOM.toString()!=t.Tables[0][0].uomid.toString()){let t=this.ScreenObject.GetPriceofUnit(h.ProductID_Key.toString(),this.DocumentDate,parseInt(h.Unit_Key),h);!n.e.IsEmpty(e.Formula)&&t.Columns[1].Contains(i)&&(i=e.Formula),i=1==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||10==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||31==this.ScreenObject.DocumentType?"PurchaseRate":"SellingRate";let s=0,a=0;t.Tables.length>0&&t.Tables[0].length>0&&!n.e.IsEmpty(t.Tables[0][0].Conversion)&&(s=parseFloat(t.Tables[0][0].Conversion)),t.Tables.length>1&&t.Tables[1].length>0&&t.Columns[1].Contains(i)&&!n.e.IsEmpty(t.Tables[1][0][i])&&(a=t.Columns[1].Contains("UOMID")?s*parseFloat(t.Tables[1][0][i]):parseFloat(t.Tables[1][0][i]),h.Rate=a.ToString("N"+e.DecimalPoints),h.defaultRate=a.ToString("N"+e.DecimalPoints))}else t.Tables.length>0&&t.Tables[0].length>0&&!t.Columns[0].Contains("ErrorMessage")&&(1==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||10==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||31==this.ScreenObject.DocumentType?n.e.IsEmpty(t.Tables[0][0].PurchaseRate)?h.Rate=0:(h.Rate=t.Tables[0][0].PurchaseRate.toString(),h.defaultRate=t.Tables[0][0].PurchaseRate.toString()):n.e.IsEmpty(t.Tables[0][0].SellingRate)||(h.Rate=t.Tables[0][0].SellingRate.toString(),h.defaultRate=t.Tables[0][0].SellingRate.toString()))}this.FillLinkRefereceProducts(h,t.Tables[0],s);let c=this.ScreenObject.ColumnSource.filter(e=>e.DisplayMember.Contains("dcNum")&&4!=e.SectionID);if(t.Tables.length>4)for(let a=0;a<c.length;a++){let s=c[a];if(r=null==l&&r.length>0&&!Object(f.isUndefined)(r[0].CostCenterIDLinked)&&e.Columns[0].Contains("CostCenterID")&&e.Tables[0].length>0?i.filter(t=>t.BASECOL==s.DisplayMember&&t.CostCenterIDLinked==e.Tables[0][0].CostCenterID):i.filter(e=>e.BASECOL==s.DisplayMember),0==r.length){let e=t.Tables[4].filter(e=>e.SysColumnName==s.DisplayMember);e.length>0&&(h[s.DisplayMember]=e[0].Value.toString(),h["default"+s.DisplayMember]=e[0].Value.toString())}}if(t.Tables.length>10&&t.Columns[10].Contains("BinId")&&t.Tables[10].length>0&&"0"!=t.Tables[10][0].BinId.toString()&&this.ScreenObject.Preferences.ContainsKey("BinsDimension")&&parseInt(this.ScreenObject.Preferences.BinsDimension)>5e4){let e=this.ScreenObject.ColumnSource.find(e=>e.CostCenterID==parseInt(this.ScreenObject.Preferences.BinsDimension));e&&this.ScreenObject.GridDataColumns.Contains(e.DisplayMember)&&(h[e.DisplayMember]=t.Tables[10][0].BinName.toString(),h[e.ValueMember]=t.Tables[10][0].BinId.toString())}}let s=this.ScreenObject.ColumnSource.filter(e=>null!=e.ValueMember&&"productid_key"==e.ValueMember.toString().toLowerCase());if(null!=s){let e,t=this.ScreenObject.Data.Tables[0],i=!1;if(this.ScreenObject.Preferences.ContainsKey("FillLocalRef")&&""!=this.ScreenObject.Preferences.FillLocalRef.toString()&&Object(o.j)(this.ScreenObject.Preferences.FillLocalRef)){let e=this.ScreenObject.Preferences.LocalRefflds.toString().split(",");this.ScreenObject.ColumnSource.forEach(t=>{3!=t.CostCenterID||this.ScreenObject.Preferences.LocalRefflds.toString().length>0&&!e.Contains(t.ID)?3!=t.CostCenterID&&e.Contains(t.ID)&&""!=t.ValueMember&&null!=h[t.ValueMember]&&!n.e.IsEmpty(h[t.ValueMember])&&this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&e.LocalReference==t.ID).length>0&&this.ScreenObject.GetLinkReferenceData(parseInt(t.ID),this.DocumentID,parseInt(h[t.ValueMember]),Date.Today(),"",t.CostCenterID,h,null,!1):""!=t.ValueMember&&null!=h[t.ValueMember]&&!n.e.IsEmpty(h[t.ValueMember])&&this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&(e.LocalReference==t.ID||79==e.LocalReference&&(26585==e.LinkData||53529==e.LinkData||53589==e.LinkData||53530==e.LinkData))).length>0&&this.ScreenObject.GetLinkReferenceData(parseInt(t.ID),this.DocumentID,parseInt(h[t.ValueMember]),Date.Today(),"",t.CostCenterID,h,null,!1)})}else s.forEach(s=>{s.CostCenterID>0&&!i&&(e=t.filter(e=>79==e.LocalReference&&(26585==e.LinkData||54306==e.LinkData||54307==e.LinkData||53529==e.LinkData||53589==e.LinkData||53530==e.LinkData)),e.length>0&&!n.e.IsEmpty(s.ValueMember)&&!n.e.IsEmpty(h[s.ValueMember])&&(i=!0,this.ScreenObject.GetLinkReferenceData(parseInt(s.ID),this.DocumentID,parseInt(h[s.ValueMember]),Date.Today(),"",s.CostCenterID,h,null,!1)))})}if(null==l){h[e.Tables[0][j][e.Columns[0][3]].toString()]=e.Tables[0][j][e.Columns[0][0]],h.defaultQuantity=h.Quantity,h.TolVal=e.Tables[0][j].ToleranceLimitsValue.toString(),h.TolPer=e.Tables[0][j].PercentValue.toString(),h.LinkedInvDocDetailsID=e.Tables[0][j].DocDetailsID.toString(),h.RefNo=e.Tables[0][j].VoucherNO.toString(),h.LinkedFieldName=e.Tables[0][j][e.Columns[0][3]].toString();let t=this.ScreenObject.Data.Tables[0].filter(e=>79==e.LocalReference&&53735==e.LinkData);if(t.length>0&&this.ScreenObject.GridDataColumns.Contains(t[0].SysColumnName)&&(h[t[0].SysColumnName]=e.Columns[0].Contains("Executed")?e.Tables[0][j].Executed.toString():parseFloat(e.Tables[0][j].Quantity)-parseFloat(e.Tables[0][j][e.Columns[0][0]])),e.Tables[0].length>0&&e.Columns[0].Contains("IsQtyFreeOffer")&&!n.e.IsEmpty(e.Tables[0][j].IsQtyFreeOffer)&&parseInt(e.Tables[0][j].IsQtyFreeOffer)>0&&this.ScreenObject.GridDataColumns.Contains("FreeQTY")){e.Columns[0].Contains("ParentSchemeID")&&!n.e.IsEmpty(e.Tables[0][j].ParentSchemeID)&&"0"!=e.Tables[0][j].ParentSchemeID.toString()&&this.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!n.e.IsEmpty(e.Tables[0][j].IsQtyFreeOffer)&&parseInt(e.Tables[0][j].IsQtyFreeOffer)>0&&(h.FreeQTY=e.Tables[0][j].Quantity,h.Quantity=0),h.SchemeID=e.Tables[0][j].IsQtyFreeOffer.toString();let t=this.ScreenObject.GridData.filter(t=>1!=t.SchemeID&&t.SchemeID==e.Tables[0][j].IsQtyFreeOffer);if(t.length>0)h.MaxSchemeID=t[0].MaxSchemeID;else{let e=0,t=this.ScreenObject.GridData.Compute("max","MaxSchemeID");null!=t&&(e=n.e.Int(t)),e++,h.MaxSchemeID=e}"1"==h.SchemeID.toString()?(h.IsScheme="Y",h.FreeQTY=h.quantity,h.quantity=0):h.IsScheme=e.Columns[0].Contains("ParentSchemeID")&&!n.e.IsEmpty(e.Tables[0][j].ParentSchemeID)&&"0"!=e.Tables[0][j].ParentSchemeID.toString()?"Y":"N"}}if(n.e.IsEmpty(h.Unit_Key)&&null!=t&&t.Tables.length>0&&t.Columns[0].Contains("uomid")&&!n.e.IsEmpty(t.Tables[0][0].uomid)?(h.Unit=t.Tables[0][0].UnitName.toString(),h.Unit_Key=t.Tables[0][0].uomid.toString(),t.Columns[0].Contains("UOMConversion")?(h.UOMConversion=t.Tables[0][j].UOMConversion.toString(),n.e.IsEmpty(t.Tables[0][j].UOMConversion)||n.e.IsEmpty(h.Quantity)?n.e.IsEmpty(h.Quantity)||(h.UOMConvertedQty=h.Quantity):h.UOMConvertedQty=parseFloat(h.Quantity)*parseFloat(t.Tables[0][j].UOMConversion)):(h.UOMConversion=1,n.e.IsEmpty(h.Quantity)||(h.UOMConvertedQty=h.Quantity))):e.Columns[0].Contains("UOMConversion")?(h.UOMConversion=e.Tables[0][j].UOMConversion.toString(),n.e.IsEmpty(e.Tables[0][j].UOMConversion)||n.e.IsEmpty(h.Quantity)?n.e.IsEmpty(h.Quantity)||(h.UOMConvertedQty=h.Quantity):h.UOMConvertedQty=parseFloat(h.Quantity)*parseFloat(e.Tables[0][j].UOMConversion)):(h.UOMConversion=1,n.e.IsEmpty(h.Quantity)||(h.UOMConvertedQty=h.Quantity)),e.Columns[0].Contains("ProductTypeID")&&(h.Type=null!=t&&t.Tables.length>0&&t.Columns[0].Contains("ProductTypeID")&&t.Tables[0].length>0?t.Tables[0][0].ProductTypeID.toString():e.Tables[0][j].ProductTypeID.toString(),null!=t&&t.Tables.length>0&&t.Columns[0].Contains("BinWise")&&t.Tables[0].length>0&&(h.BinWise=t.Tables[0][0].BinWise),this.ScreenObject.GridDataColumns.Contains("QtyType")&&e.Columns[0].Contains("QtyAdjustType")&&(h.QtyType=e.Tables[0][j].QtyAdjustType),this.ScreenObject.GridDataColumns.Contains("PackType")&&e.Columns[0].Contains("IsPacking")&&(h.PackType=e.Tables[0][j].IsPacking),this.ScreenObject.GridDataColumns.Contains("IsTestCase")&&t.Columns[0].Contains("TestCaseExists")&&(h.IsTestCase=t.Tables[0][0].TestCaseExists),this.ScreenObject.GridDataColumns.Contains("landingType")&&e.Columns[0].Contains("IsBillOfEntry")&&(h.landingType=e.Tables[0][j].IsBillOfEntry),this.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!n.e.IsEmpty(h.FreeQTY)&&parseFloat(h.FreeQTY)>0&&(h.UOMConvertedQty=n.e.IsEmpty(h.UOMConversion)?h.FreeQTY:parseFloat(h.FreeQTY)*parseFloat(h.UOMConversion))),null==l)if(n.e.IsEmpty(e.Tables[0][j].ProductTypeID)||8!=parseInt(e.Tables[0][j].ProductTypeID)&&3!=parseInt(e.Tables[0][j].ProductTypeID)&&11!=parseInt(e.Tables[0][j].ProductTypeID)&&12!=parseInt(e.Tables[0][j].ProductTypeID)){if(!n.e.IsEmpty(e.Tables[0][j].ProductTypeID)&&5==parseInt(e.Tables[0][j].ProductTypeID)&&e.Tables[5].length>0){let t=e.Tables[5].filter(t=>t.InvDocDetailsID==e.Tables[0][j].DocDetailsID||t.DynamicInvDocDetailsID==e.Tables[0][j].DocDetailsID);if(t.length>0&&(e.Columns[5].Contains("IsQtyIgnored")&&"1"==t[0].IsQtyIgnored.toString()||this.ScreenObject.Preferences.ContainsKey("CopyBatches")&&!n.e.IsEmpty(this.ScreenObject.Preferences.CopyBatches)&&Object(o.j)(this.ScreenObject.Preferences.CopyBatches)||this.ScreenObject.Preferences.ContainsKey("ConsBatch")&&"True"==this.ScreenObject.Preferences.ConsBatch)){let s="",i=0;s+="<xml>";for(let a=0;a<t.length;a++)s+="<Row ",s+=' BatchID="'+t[a].BatchID.toString()+'" ',s+=' ProductID="'+h.ProductID_Key.toString()+'" ',e.Columns[5].Contains("RefInvDocDetailsID")&&!n.e.IsEmpty(t[a].RefInvDocDetailsID)&&(s+=' RefInvID="'+t[a].RefInvDocDetailsID.toString()+'" '),this.ScreenObject.Preferences.ContainsKey("ConsBatch")&&"True"==this.ScreenObject.Preferences.ConsBatch&&(s+=' LinkedID="'+t[a].InvDocDetailsID.toString()+'" '),t.length>1?(s+=' Quantity="'+t[a].Quantity.toString()+'" ',s+=' Hold="0" ',s+=' Release="'+t[a].Quantity.toString()+'" ',i+=parseFloat(t[a].Quantity)):!n.e.IsEmpty(h.SchemeID)&&parseInt(h.SchemeID)>0&&"Y"==h.IsScheme.toString()&&this.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!n.e.IsEmpty(h.FreeQTY)?(s+=' Quantity="'+h.FreeQTY.toString()+'" ',s+=' Hold="0" ',s+=' Release="'+h.FreeQTY.toString()+'" '):(s+=' Quantity="'+h.Quantity.toString()+'" ',s+=' Hold="0" ',s+=' Release="'+h.Quantity.toString()+'" ',n.e.IsEmpty(h.UomConversion)||n.e.IsEmpty(h.Quantity)||(s+=' Quantity="'+(parseFloat(h.UomConversion.toString())*parseFloat(h.Quantity.toString())).toString()+'" ',s+=' Hold="0" ',s+=' Release="'+(parseFloat(h.UomConversion.toString())*parseFloat(h.Quantity.toString())).toString()+'" ')),s+=" ></Row>";s+="</xml>",h.ExtraXML=s,i>0&&(h.Quantity=i,h.UOMConvertedQty=h.Quantity.toString())}}else if(!n.e.IsEmpty(e.Tables[0][j].ProductTypeID)&&(2==parseInt(e.Tables[0][j].ProductTypeID)||10==parseInt(e.Tables[0][j].ProductTypeID))&&e.Tables.length>8&&e.Tables[8].length>0&&this.ScreenObject.Preferences.ContainsKey("CopySerialNos")&&""!=this.ScreenObject.Preferences.CopySerialNos.toString()&&Object(o.j)(this.ScreenObject.Preferences.CopySerialNos)){let t=e.Tables[8].filter(t=>t.InvDocDetailsID==e.Tables[0][j].DocDetailsID);if(t.length>0){let e="";e+="<xml>";let s=0;n.e.IsEmpty(h.Quantity)||(s=parseFloat(h.Quantity)),t.length<s&&(s=t.length);for(let i=0;i<s;i++)e+="<Row ",e+=' SerialProductID="0" ',e+=' SerialNumber="'+n.e.String(t[i].SerialNumber)+'" ',e+=' StockCode="'+n.e.String(t[i].StockCode)+'" ',e+=' Quantity="'+n.e.String(t[i].Quantity)+'" ',e+=' Narration="" ',1==this.VoucherType?(e+=' IsIssue="0" ',e+=' StatusID="157" ',e+=' RefInvDocDetailsID="0" ',e+=' IsAvailable="1" ',e+=' SerialGUID="'+n.e.NewGuid()+'" '):(e+=' IsIssue="1" ',e+=' StatusID="158" ',e+=' RefInvDocDetailsID="'+n.e.String(t[i].InvDocDetailsID)+'" ',e+=' IsAvailable="0" ',e+=' SerialGUID="'+n.e.String(t[i].SerialGUID)+'" '),e+=" ></Row>";e+="</xml>",h.ExtraXML=e}}}else{let s=null;11!=parseInt(e.Tables[0][j].ProductTypeID.toString())&&12!=parseInt(e.Tables[0][j].ProductTypeID.toString())||(s=t);let i=e.Tables[0].filter(t=>t.DynamicInvDocDetailsID==e.Tables[0][j].DocDetailsID);if(0==i.length)continue;{let a="";a+="<xml>";for(let s=0;s<i.length;s++){a+="<Row ><xml ";let r="",o="",c="",h=!1;for(let t=0;t<this.ScreenObject.ColumnSource.length;t++)if("DocDetailsID"!=this.ScreenObject.ColumnSource[t].DisplayMember&&"DocSeqNo"!=this.ScreenObject.ColumnSource[t].DisplayMember&&"LinkedInvDocDetailsID"!=this.ScreenObject.ColumnSource[t].DisplayMember&&"RefNo"!=this.ScreenObject.ColumnSource[t].DisplayMember&&"LinkedFieldName"!=this.ScreenObject.ColumnSource[t].DisplayMember&&this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase()!=e.Tables[0][j][Object.keys(e.Tables[0][j])[3]].toString().toLowerCase()){if(3==this.ScreenObject.ColumnSource[t].CostCenterID){if(h)continue;h=!0}r+=this.ScreenObject.SetDynamicsetLinkValues(e,this.ScreenObject.ColumnSource[t],e.Tables[0].indexOf(i[s]),l),this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase().Contains("dcccnid")&&(o+=this.ScreenObject.SetDynamicsetNumLinkValues(e,this.ScreenObject.ColumnSource[t],e.Tables[0].indexOf(i[s]),l)),this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase().Contains("dcnum")&&(c+=this.ScreenObject.SetDynamicsetNumLinkValues(e,this.ScreenObject.ColumnSource[t],e.Tables[0].indexOf(i[s]),l))}let u=1,d=0;if(u=n.e.Double(i[s].Quantity),0==u&&(u=1),n.e.IsEmpty(i[s].Unit)||(d=parseInt(i[s].Unit)),n.e.IsEmpty(i[s].ProductID)||(t=this.ScreenObject.GetProductTypeDetails(i[s].ProductID.toString(),this.DocumentDate,d,u,"0",e.Tables[1][e.Columns[1][e.Tables[0].indexOf(i[s])]],!0,null,!1,0,this.Currency)),null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&t.Columns[0].Contains("AvgRate")&&!n.e.IsEmpty(t.Tables[0][0].AvgRate)&&(r+=' AverageRate="'+t.Tables[0][0].AvgRate.toString()+'" '),t.Tables.length>0&&t.Tables[0].length>0&&!t.Columns[0].Contains("ErrorMessage")&&(t.Columns[0].Contains("QOH")&&!n.e.IsEmpty(t.Tables[0][0].QOH)&&(r+=' QOH="'+t.Tables[0][0].QOH.toString()+'" '),t.Columns[0].Contains("BalQOH")&&!n.e.IsEmpty(t.Tables[0][0].BalQOH)&&(r+=' BalQOH="'+t.Tables[0][0].BalQOH.toString()+'" '),t.Columns[0].Contains("HOLDQTY")&&!n.e.IsEmpty(t.Tables[0][0].HOLDQTY)&&(r+=' HOLDQTY="'+t.Tables[0][0].HOLDQTY.toString()+'" '),t.Columns[0].Contains("CommittedQty")&&!n.e.IsEmpty(t.Tables[0][0].CommittedQty)&&(r+=' CommittedQty="'+t.Tables[0][0].CommittedQty.toString()+'" '),t.Columns[0].Contains("RESERVEQTY")&&!n.e.IsEmpty(t.Tables[0][0].RESERVEQTY)&&(r+=' RESERVEQTY="'+t.Tables[0][0].RESERVEQTY.toString()+'" '),t.Columns[0].Contains("TotalReserve")&&!n.e.IsEmpty(t.Tables[0][0].TotalReserve)&&(r+=' TotalReserve="'+t.Tables[0][0].TotalReserve.toString()+'" '),t.Columns[0].Contains("LastPurchaseRate")&&!n.e.IsEmpty(t.Tables[0][0].LastPurchaseRate)&&(r+=' LASTPURCHASERATE="'+t.Tables[0][0].LastPurchaseRate.toString()+'" '),this.FillLinkRefereceProducts_2(r,t.Tables[0]),t.Tables.length>10&&t.Columns[10].Contains("BinId")&&t.Tables[10].length>0&&"0"!=t.Tables[10][0].BinId.toString()&&this.ScreenObject.Preferences.ContainsKey("BinsDimension")&&parseInt(this.ScreenObject.Preferences.BinsDimension)>5e4)){let e=this.ScreenObject.ColumnSource.find(e=>e.CostCenterID==parseInt(this.ScreenObject.Preferences.BinsDimension));e&&this.ScreenObject.GridDataColumns.Contains(e.DisplayMember)&&(r+=" "+e.DisplayMember+'="'+t.Tables[10][0].BinName.toString()+'" ',r+=" "+e.ValueMember+'="'+t.Tables[10][0].BinId.toString()+'" ')}r+=' DocDetailsID="0" ',null==l&&(r+=' LinkedInvDocDetailsID="'+i[s].DocDetailsID.toString()+'" ',r+=' LinkedFieldName="'+i[s][Object.keys(i[s])[3]].toString()+'" ',r+=' LinkedFieldValue="'+i[s][Object.keys(i[s])[0]].toString()+'" ',r+=' RefNo="'+i[s].VoucherNo.toString()+'" ',r+=" "+e.Tables[0][j][e.Columns[0][3]].toString()+'="'+i[s][0].toString()+'" ',e.Tables[0][j][e.Columns[0][3]].toString().toLowerCase().Contains("dcnum")&&(c+=e.Tables[0][j][e.Columns[0][3]].toString()+"="+i[s][Object.keys(i[s])[0]].toString()+",")),r+=' DocSeqNo="'+(s+1).toString()+'" ',a+=' CCQuery="'+o+'" ',a+=' NumQuery="'+c+'" ',e.Columns[0].Contains("ProductTypeID")&&(r+=' Type="'+i[s].ProductTypeID.toString()+'" ',"3"==e.Tables[0][j].ProductTypeID.toString()&&(n.e.IsEmpty(i[s].Quantity)||n.e.IsEmpty(e.Tables[0][j].Quantity)?r+=' defaultQuantity="'+i[s].Quantity.toString()+'" ':r+=' defaultQuantity="'+parseFloat(i[s].Quantity)/parseFloat(e.Tables[0][j].Quantity)+'" '),e.Columns[0].Contains("UOMConversion")?r+=' UOMConversion="'+i[s].UOMConversion.toString()+'" ':r+=' UOMConversion="1" ',!r.toString().toLowerCase().Contains("unit_key=")&&t.Tables.length>0&&t.Columns[0].Contains("uomid")&&!n.e.IsEmpty(t.Tables[0][0].uomid)&&(r+=' Unit_key="'+t.Tables[0][0].uomid.toString()+'" ')),a+=r.toString()+" /></Row>"}a+="</xml>",h.ExtraXML=a;let r=new re(this,h,s),o=0;for(let e=0;e<r.GridData.length;e++)n.e.IsEmpty(r.GridData[e].ProductID_Key)||(this.CalculateTotals(r.GridData[e],!1,"",!1),o++);r.OnButtonClick("AutoSave"),this.ScreenObject.Preferences.ContainsKey("SplitKit")&&"true"==this.ScreenObject.Preferences.SplitKit.toLowerCase()&&o>1&&(O=O+o-1)}}if(e.Tables.length>9&&e.Columns[9].Contains("InvDocDetailsID")&&this.ScreenObject.GridDataColumns.Contains("QtyType")&&e.Tables[9].length>0){let t="",s=e.Tables[9].filter(t=>t.InvDocDetailsID==e.Tables[0][j].DocDetailsID);s.length>0&&(t+="<QtyAdjustments>",s.forEach(s=>{t+="<Row ";for(let i=0;i<e.Tables[9].Columns.length;i++)e.Tables[9].Columns[i].Contains("Fld")&&!n.e.IsEmpty(s[e.Tables[9].Columns[i]])&&(t+=e.Tables[9].Columns[i]+'="'+s[e.Tables[9].Columns[i]].toString()+'" ');t+='Islinked="1"',t+=" ></Row>"}),t+="</QtyAdjustments>",h.QtyXML=t)}if(this.ScreenObject.Preferences.ContainsKey("CopyBins")&&"true"==this.ScreenObject.Preferences.CopyBins.toLowerCase()&&e.Tables.length>12&&e.Columns[12].Contains("BinID")&&this.ScreenObject.GridDataColumns.Contains("BinWise")&&"True"==h.BinWise.toString()&&e.Tables[12].length>0){let t="",s=e.Tables[12].filter(t=>t.InvDocDetailsID==e.Tables[0][j].DocDetailsID);s.length>0&&(t+="<BinsXML>",s.forEach(s=>{t+="<Row ",t+=' NodeID="'+s.BinID.toString()+'" ',t+=' Allocate="'+s.Quantity.toString()+'" ',t+=' Vol="'+e.Tables[0][j].Volume.toString()+'" ',t+=' Waist="'+e.Tables[0][j].Wastage.toString()+'" ',t+=" ></Row>"}),t+="</BinsXML>",h.BinsXML=t)}if(e.Tables.length>13&&e.Tables[13].length>0){let t="",s=e.Tables[13].filter(t=>1==t.Type&&t.InvDocDetailsID==e.Tables[0][j].DocDetailsID);this.ScreenObject.Preferences.ContainsKey("DonotCopyBOE")&&"true"==this.ScreenObject.Preferences.DonotCopyBOE.toLowerCase()?s.length>0&&this.ScreenObject.GridDataColumns.Contains("DocExtraXML")&&(this.ScreenObject.GridDataColumns.Contains("LinkedBoe")||this.ScreenObject.GridDataColumns.push("LinkedBoe"),h.LinkedBoe=s[0].RefID.toString()):s.length>0&&this.ScreenObject.GridDataColumns.Contains("DocExtraXML")&&(t+="<DocExtraXML>",s.forEach(e=>{t+="<Row ",t+=' RefID="'+e.RefID.toString()+'" ',t+=' Qty="'+e.Quantity.toString()+'" ',t+=' Type="'+e.Type.toString()+'" ',t+=" ></Row>",h.BOEID=e.RefID.toString()}),t+="</DocExtraXML>",h.DocExtraXML=t);let i=e.Tables[4].filter(e=>-5==e.CostCenterColIDLinked);if(i.length>0&&s.length>0&&this.ScreenObject.GridDataColumns.Contains(i[0].BASECOL.toString())&&(h[i[0].BASECOL.toString()]=s[0].RefID.toString()),s=e.Tables[13].filter(t=>2==t.Type&&t.InvDocDetailsID==e.Tables[0][j].DocDetailsID),s.length>0&&this.ScreenObject.GridDataColumns.Contains("PackXML")){null==this.DtPack&&(this.DtPack=[],this.DtPackColumns=[],this.DtPackColumns.push("ID"),this.DtPackColumns.push("Name"),this.DtPackColumns.push("Label"),this.DtPackColumns.push("cWeight"),this.DtPackColumns.push("cVolume"),this.DtPackColumns.push("Weight"),this.DtPackColumns.push("Volume"),this.DtPackColumns.push("Height"),this.DtPackColumns.push("length"),this.DtPackColumns.push("Width"),this.DtPackColumns.push("ActualWeight"),this.DtPackColumns.push("ActualVolume"),(this.ScreenObject.Preferences.ContainsKey("PackWiseProds")&&"true"==this.ScreenObject.Preferences.PackWiseProds.toLowerCase()||this.ScreenObject.Preferences.ContainsKey("LineWisePacking")&&"true"==this.ScreenObject.Preferences.LineWisePacking.toLowerCase())&&this.DtPackColumns.push("Data")),this.ScreenObject.GridDataColumns.Contains("Unq")||this.ScreenObject.GridDataColumns.push("Unq"),null==u&&(u=this.ScreenObject.GridData.Compute("max","Unq"),u=null!=u?parseInt(u)+1:0),h.Unq=u,u=parseInt(u)+1,t="",t+="<DocExtraXML>";for(let i=0;i<s.length;i++){let a=s[i];if(null!=c&&!c.Contains(a.label.toString()))continue;""!=I&&(I+=","),I+=a.RefID.toString(),t+="<Row ",t+=' RefID="'+a.RefID.toString()+'" ',t+=' Qty="'+a.Quantity.toString()+'" ',t+=' Type="'+a.Type.toString()+'" ',t+=' Label="'+a.label.toString()+'" ',t+=' Volume="'+e.Tables[0][j].Volume.toString()+'" ',t+=' Weight="'+e.Tables[0][j].Weight.toString()+'" ',n.e.IsEmpty(a.Fld1)||(t+=' Fld1="'+a.Fld1.toString()+'" '),n.e.IsEmpty(a.Fld2)||(t+=' Fld2="'+a.Fld2.toString()+'" '),n.e.IsEmpty(a.fld3)||(t+=' Fld3="'+a.fld3.toString()+'" '),n.e.IsEmpty(a.fld4)||(t+=' Fld4="'+a.fld4.toString()+'" '),n.e.IsEmpty(a.fld5)||(t+=' Fld5="'+a.fld5.toString()+'" '),t+=" ></Row>";let r,o=this.DtPack.filter(e=>e.Label==a.label);if(0==o.length?(r={},r.ID=a.RefID.toString(),r.Label=a.label.toString(),this.DtPack.push(r)):r=o[0],e.Columns[0].Contains("Volume")){let t=0;n.e.IsEmpty(e.Tables[0][j].Volume)||(t=parseFloat(e.Tables[0][j].Volume)*parseFloat(a.Quantity)),r.cVolume=n.e.IsEmpty(r.cVolume)?t:parseFloat(r.cVolume)+t,t=0,n.e.IsEmpty(e.Tables[0][j].Weight)||(t=parseFloat(e.Tables[0][j].Weight)*parseFloat(a.Quantity)),r.cWeight=n.e.IsEmpty(r.cWeight)?t:parseFloat(r.cWeight)+t}this.DtPackColumns.Contains("Data")&&(r.Data=n.e.IsEmpty(r.Data)?h.Unq.toString()+"~"+a.Quantity.toString():r.Data.toString()+","+h.Unq.toString()+"~"+a.Quantity.toString())}t+="</DocExtraXML>",h.PackXML=t}}}if(this.ScreenObject.Preferences.ContainsKey("BarcodeField")&&""!=this.ScreenObject.Preferences.BarcodeField.toString()&&e.Columns[0].Contains("ScannedBarcodes")){let t=this.ScreenObject.ColumnSource.find(e=>null!=e.ID&&e.ID==this.ScreenObject.Preferences.BarcodeField);t&&this.ScreenObject.GridDataColumns.Contains(t.DisplayMember)&&(h[t.DisplayMember]=e.Tables[0][j].ScannedBarcodes.toString())}if(a.a.SessionManager.Preferences.BudgetAccount.length>0&&a.a.SessionManager.Preferences.BudgetDimension.length>0){var S=this.ScreenObject.ColumnSource.find(e=>null!=e.ID&&e.CostCenterID==this.BudgetObj.iBudgetDimension);null!=S&&this.ScreenObject.GridDataColumns.Contains(S.ValueMember)&&(n.e.IsEmpty(h[S.ValueMember])||parseInt(n.e.String(h[S.ValueMember]))<=1)&&this.BudgetObj.AutoLoadBudgetDimension(h,null)}if(this.ScreenObject.GridDataObj.insertRowAt(h,s+O),null!=b)for(let t=0;t<b.length;t++,O++){for(let e=0;e<this.ScreenObject.GridDataColumns.length;e++)"ProductName"!=this.ScreenObject.GridDataColumns[e]&&"ProductID_Key"!=this.ScreenObject.GridDataColumns[e]&&"ProductCode"!=this.ScreenObject.GridDataColumns[e]&&"DocDetailsID"!=this.ScreenObject.GridDataColumns[e]&&"TODocDetailsID"!=this.ScreenObject.GridDataColumns[e]&&"Row_Background"!=this.ScreenObject.GridDataColumns[e]&&(b[t][e]=h[e]);this.ScreenObject.GridDataObj.insertRowAt(b[t],s+O);let i=this.GetProductValues(b[t],0,!0);if(i.Tables.length>0&&i.Tables[0].length>0&&!i.Columns[0].Contains("ErrorMessage")&&i.Columns[0].Contains("ProductTypeID")&&"8"!=e.Tables[0][j].ProductTypeID.toString()){e.Columns[0].Contains("FileGUID")&&(b[t].FileGUID=i.Tables[0][0].FileGUID.toString(),b[t].FileExtension=i.Tables[0][0].FileExtension.toString()),parseInt(h.ProductID_Key)!=this.ScreenObject.TempProductID&&(b[t].QOH=i.Columns[0].Contains("QOH")&&!n.e.IsEmpty(i.Tables[0][0].QOH)?i.Tables[0][0].QOH.toString():0,b[t].BalQOH=i.Columns[0].Contains("BalQOH")&&!n.e.IsEmpty(i.Tables[0][0].BalQOH)?i.Tables[0][0].BalQOH.toString():0,b[t].HOLDQTY=i.Columns[0].Contains("HOLDQTY")&&!n.e.IsEmpty(i.Tables[0][0].HOLDQTY)?i.Tables[0][0].HOLDQTY.toString():0,b[t].CommittedQty=i.Columns[0].Contains("CommittedQty")&&!n.e.IsEmpty(i.Tables[0][0].CommittedQty)?i.Tables[0][0].CommittedQty.toString():0,b[t].RESERVEQTY=i.Columns[0].Contains("RESERVEQTY")&&!n.e.IsEmpty(i.Tables[0][0].RESERVEQTY)?i.Tables[0][0].RESERVEQTY.toString():0,b[t].TotalReserve=i.Columns[0].Contains("TotalReserve")&&!n.e.IsEmpty(i.Tables[0][0].TotalReserve)?i.Tables[0][0].TotalReserve.toString():0),b[t].LASTPURCHASERATE=i.Columns[0].Contains("LastPurchaseRate")&&!n.e.IsEmpty(i.Tables[0][0].LastPurchaseRate)?i.Tables[0][0].LastPurchaseRate.toString():0,b[t].Subexists=i.Tables.length>8&&i.Tables[8].length>1&&!i.Columns[8].Contains("ErrorMessage")&&this.ScreenObject.Preferences.ContainsKey("EnableSubtitutes")&&""!=this.ScreenObject.Preferences.EnableSubtitutes.toString()&&Object(o.j)(this.ScreenObject.Preferences.EnableSubtitutes)?"1":"0";let s,a=null;if(i.Tables.length>3&&i.Tables[3].length>0&&(a=i.Tables[3][0]),s=null==l&&s.length>0&&!Object(f.isUndefined)(s[0].CostCenterIDLinked)&&e.Columns[0].Contains("CostCenterID")&&e.Tables[0].length>0?e.Tables[4].filter(t=>t.BASECOL=t.CostCenterIDLinked==e.Tables[0][0].CostCenterID):e.Tables[4].filter(e=>e.BASECOL="Rate"),0==s.length){let e=this.ScreenObject.ColumnSource.find(e=>"Rate"==e.DisplayMember),s="";if(null!=a)!n.e.IsEmpty(e.Formula)&&i.Columns[3].Contains(s)&&(s=e.Formula),s=1==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||10==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||31==this.ScreenObject.DocumentType?"PurchaseRate":"SellingRate",""==s||n.e.IsEmpty(a[s])||(b[t].Rate=a[s].toString(),b[t].defaultRate=a[s].toString());else if(i.Tables.length>0&&i.Tables[0].length>0&&i.Columns[0].Contains("ProdBaseUOM")&&i.Tables[0][0].ProdBaseUOM.toString()!=i.Tables[0][0].uomid.toString()){let i=this.ScreenObject.GetPriceofUnit(h.ProductID_Key.toString(),this.DocumentDate,parseInt(h.Unit_Key),h);!n.e.IsEmpty(e.Formula)&&i.Columns[1].Contains(s)&&(s=e.Formula),s=1==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||10==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||31==this.ScreenObject.DocumentType?"PurchaseRate":"SellingRate";let a=0,r=0;i.Tables.length>0&&i.Tables[0].length>0&&!n.e.IsEmpty(i.Tables[0][0].Conversion)&&(a=parseFloat(i.Tables[0][0].Conversion)),i.Tables.length>1&&i.Tables[1].length>0&&i.Columns[1].Contains(s)&&!n.e.IsEmpty(i.Tables[1][0][s])&&(r=i.Columns[1].Contains("UOMID")?a*parseFloat(i.Tables[1][0][s]):parseFloat(i.Tables[1][0][s]),b[t].Rate=r.ToString("N"+e.DecimalPoints),b[t].defaultRate=r.ToString("N"+e.DecimalPoints))}else i.Tables.length>0&&i.Tables[0].length>0&&!i.Columns[0].Contains("ErrorMessage")&&(1==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||10==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||31==this.ScreenObject.DocumentType?n.e.IsEmpty(i.Tables[0][0].PurchaseRate)?b[t].Rate=0:(b[t].Rate=i.Tables[0][0].PurchaseRate.toString(),b[t].defaultRate=i.Tables[0][0].PurchaseRate.toString()):n.e.IsEmpty(i.Tables[0][0].SellingRate)||(b[t].Rate=i.Tables[0][0].SellingRate.toString(),b[t].defaultRate=i.Tables[0][0].SellingRate.toString()))}this.FillLinkRefereceProducts(b[t],i.Tables[0],a);let r=this.ScreenObject.ColumnSource.filter(e=>e.DisplayMember.Contains("dcNum")&&4!=e.SectionID);if(i.Tables.length>4)for(let n=0;n<r.length;n++){let a=r[n];if(s=e.Tables[4].filter(e=>e.BASECOL==a.DisplayMember),null==l&&s.length>0&&!Object(f.isUndefined)(s[0].CostCenterIDLinked)&&e.Columns[0].Contains("CostCenterID")&&e.Tables[0].length>0&&(s=s.filter(t=>t.CostCenterIDLinked==e.Tables[0][0].CostCenterID)),0==s.length){let e=i.Tables[4].filter(e=>e.SysColumnName==a.DisplayMember);e.length>0&&(b[t][a.DisplayMember]=e[0].Value.toString(),b[t]["default"+a.DisplayMember]=e[0].Value.toString())}}}let a=this.ScreenObject.ColumnSource.filter(e=>null!=e.ValueMember&&"productid_key"==e.ValueMember.toString().toLowerCase());if(a.length>0){let e=this.ScreenObject.Data.Tables[0],s=!1;if(this.ScreenObject.Preferences.ContainsKey("FillLocalRef")&&""!=this.ScreenObject.Preferences.FillLocalRef.toString()&&Object(o.j)(this.ScreenObject.Preferences.FillLocalRef)){let i=a.length;a.forEach(a=>{i--,a.CostCenterID>0&&!s&&(e=this.ScreenObject.Data.Tables[0].filter(0==i?e=>null!=e.LocalReference&&(e.LocalReference==a.ID||79==e.LocalReference&&(26585==e.LinkData||54306==e.LinkData||54307==e.LinkData||53529==e.LinkData||53589==e.LinkData||53530==e.LinkData)):e=>null!=e.LocalReference&&e.LocalReference==a.ID),e.length>0&&!n.e.IsEmpty(a.ValueMember)&&!n.e.IsEmpty(b[t][a.ValueMember])&&(s=!0,this.ScreenObject.GetLinkReferenceData(parseInt(a.ID),this.DocumentID,parseInt(b[t][a.ValueMember]),Date.Today(),"",a.CostCenterID,b[t])))})}}if(e.Columns[0].Contains("ProductTypeID")&&(b[t].Type=null!=i&&i.Tables.length>0&&i.Columns[0].Contains("ProductTypeID")&&i.Tables[0].length>0?i.Tables[0][0].ProductTypeID.toString():e.Tables[0][j].ProductTypeID.toString(),null!=i&&i.Tables.length>0&&i.Columns[0].Contains("BinWise")&&i.Tables[0].length>0&&(b[t].BinWise=i.Tables[0][0].BinWise.toString()),this.ScreenObject.GridDataColumns.Contains("QtyType")&&e.Columns[0].Contains("QtyAdjustType")&&(b[t].QtyType=e.Tables[0][j].QtyAdjustType.toString()),this.ScreenObject.GridDataColumns.Contains("PackType")&&e.Columns[0].Contains("IsPacking")&&(b[t].PackType=e.Tables[0][j].IsPacking.toString()),this.ScreenObject.GridDataColumns.Contains("IsTestCase")&&i.Columns[0].Contains("TestCaseExists")&&(b[t].IsTestCase=i.Tables[0][0].TestCaseExists.toString()),this.ScreenObject.GridDataColumns.Contains("landingType")&&e.Columns[0].Contains("IsBillOfEntry")&&(b[t].landingType=e.Tables[0][j].IsBillOfEntry.toString()),this.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!n.e.IsEmpty(h.FreeQTY)&&parseFloat(h.FreeQTY)>0&&(b[t].UOMConvertedQty=n.e.IsEmpty(h.UOMConversion)?h.FreeQTY.toString():parseFloat(h.FreeQTY)*parseFloat(h.UOMConversion))),T&&!n.e.IsEmpty(b[t].ProductID_Key)&&parseInt(b[t].ProductID_Key)>0){let e=this.ScreenObject.GetSchemes(this.DocumentDate,b[t]);e.Tables.length>0&&e.Columns[0].Contains("SchemeID")&&(this.fillSchemevalues(e.Tables[0],e.Columns[0],b[t]),this.ApplySchemes(b[t]))}this.ScreenObject.GridDataColumns.Contains(e.Tables[0][j][e.Columns[0][3]].toString())?this.CalculateTotals(b[t],!1,e.Tables[0][j][e.Columns[0][3]].toString(),!1):this.CalculateTotals(b[t],!1,"",!1)}if(this.ScreenObject.Preferences.ContainsKey("ExpandStages")&&""!=this.ScreenObject.Preferences.ExpandStages.toString()&&Object(o.j)(this.ScreenObject.Preferences.ExpandStages)&&e.Tables.length>14&&e.Tables[14].length>0){let t=e.Tables[14].filter(t=>t.Nodeid==e.Tables[1][j]["Dcccnid"+(parseInt(a.a.SessionManager.Preferences.PaytermLinkDim)-5e4)]);if(t.length>0){for(let i=0;i<t.length;i++){let a;if(0==i)a=h;else{a=this.ScreenObject.GridDataObj.NewRow();for(let e=0;e<this.ScreenObject.GridDataColumns.length;e++)a[e]="DocDetailsID"==this.ScreenObject.GridDataColumns[e]||"TODocDetailsID"==this.ScreenObject.GridDataColumns[e]?0:h[e];this.ScreenObject.GridDataObj.insertRowAt(a,s+O+i)}let r=this.ScreenObject.Data.Tables[0].filter(e=>79==e.LocalReference&&5e4==e.LinkData);if(r.length>0&&this.ScreenObject.GridDataColumns.Contains(r[0].SysColumnName)&&(a[r[0].SysColumnName]=t[i].percentage.toString()),r=this.ScreenObject.Data.Tables[0].filter(e=>79==e.LocalReference&&50001==e.LinkData),r.length>0&&this.ScreenObject.GridDataColumns.Contains(r[0].SysColumnName)&&(a[r[0].SysColumnName]=t[i].Days.toString()),!n.e.IsEmpty(t[i].dimccid)&&!n.e.IsEmpty(t[i].dimNodeID)&&this.ScreenObject.GridDataColumns.Contains("Dcccnid"+(parseInt(t[i].dimccid)-5e4)+"_Key")&&(a["Dcccnid"+(parseInt(t[i].dimccid)-5e4)+"_Key"]=t[i].dimNodeID.toString(),this.ScreenObject.Preferences.ContainsKey("FillLocalRef")&&""!=this.ScreenObject.Preferences.FillLocalRef.toString()&&Object(o.j)(this.ScreenObject.Preferences.FillLocalRef)&&""!=this.ScreenObject.Preferences.LocalRefflds.toString())){let e=this.ScreenObject.Preferences.LocalRefflds.toString().split(","),s=this.ScreenObject.ColumnSource.find(e=>e.CostCenterID==parseInt(t[i].dimccid));e.Contains(s.ID)&&this.ScreenObject.GetLinkReferenceData(parseInt(s.ID),this.DocumentID,parseInt(h[s.ValueMember]),Date.Today(),"",s.CostCenterID,a,null,!1)}i>0&&(this.ScreenObject.GridDataColumns.Contains(e.Tables[0][j][e.Columns[0][3]].toString())?this.CalculateTotals(a,!1,e.Tables[0][j][e.Columns[0][3]].toString(),!1):this.CalculateTotals(a,!1,"",!1))}t.length>1&&(O=O+t.length-1)}}if(!n.e.IsEmpty(h.Type)&&5==parseInt(h.Type)&&(!n.e.IsEmpty(h.Quantity)&&parseFloat(h.Quantity)>0||this.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!n.e.IsEmpty(h.FreeQTY)&&parseFloat(h.FreeQTY)>0)&&(-1==this.VoucherType&&this.ScreenObject.Preferences.ContainsKey("AutoBatchesLinking")&&""!=this.ScreenObject.Preferences.AutoBatchesLinking.toString()&&Object(o.j)(this.ScreenObject.Preferences.AutoBatchesLinking)||!n.e.IsEmpty(e.Tables[0][j].BatchXML))){let t=0,s=0;if(this.ScreenObject.Preferences.ContainsKey("Donotuselocation")&&""!=this.ScreenObject.Preferences.Donotuselocation&&Object(o.j)(this.ScreenObject.Preferences.Donotuselocation)){let e=this.ScreenObject._CCFields.find(e=>"dcccnid2"==e.DBColumnName.toLowerCase());e&&e instanceof m.b&&e.SelectedValue>0?s=e.SelectedValue:null!=h&&this.ScreenObject.GridDataColumns.Contains("dcCCNID2_Key")&&!n.e.IsEmpty(h.dcCCNID2_Key)&&(s=parseInt(h.dcCCNID2_Key))}else s=this.ScreenObject.LocationID>0?this.ScreenObject.LocationID:a.a.SessionManager.LocationID;t=this.ScreenObject.DivisionID>0?this.ScreenObject.DivisionID:a.a.SessionManager.DivisionID;let i=0;!n.e.IsEmpty(h.Quantity)&&parseFloat(h.Quantity)>0?i=parseFloat(h.Quantity):this.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!n.e.IsEmpty(h.FreeQTY)&&parseFloat(h.FreeQTY)>0&&(i=parseFloat(h.FreeQTY)),this.ScreenObject.GridDataColumns.Contains("UOMConversion")&&!n.e.IsEmpty(h.UOMConversion)&&(i*=parseFloat(h.UOMConversion));let r=new Te.a(this.ScreenObject.GridDataObj);if(r.BatchNumberViewModel_3(this,this.VoucherType,i,parseInt(h.ProductID_Key),h.ProductName.toString(),s,t,h),e.Columns[0].Contains("BatchXML")&&!n.e.IsEmpty(e.Tables[0][j].BatchXML)){let t=new n.f;if(t.ReadXml("<XML>"+e.Tables[0][j].BatchXML.toString()+"</XML>"),t.Tables.length>0&&t.Columns[0].Contains("QTY")&&t.Tables[0].length>0)for(let e=0;e<t.Tables[0].length;e++){let s=null;t.Columns[0].Contains("BatchNo")&&!n.e.IsEmpty(t.Tables[0][e].BatchNo)?s=r.GridData.filter(s=>s.BATCHNUMBER==t.Tables[0][e].BatchNo.toString()):t.Columns[0].Contains("BatchCode")&&!n.e.IsEmpty(t.Tables[0][e].BatchCode)&&(s=r.GridData.filter(s=>s.BatchCode==t.Tables[0][e].BatchCode.toString())),null!=s&&s.length>0&&!n.e.IsEmpty(t.Tables[0][e].QTY)&&(r.GridDataColumns.Contains("QtyUom")?(s[0].QtyUom=n.e.IsEmpty(s[0].QtyUom)?t.Tables[0][e].QTY.toString():parseFloat(s[0].QtyUom.toString())+parseFloat(t.Tables[0][e].QTY.toString()),s[0].Quantity=this.ScreenObject.GridDataColumns.Contains("UOMConversion")&&!n.e.IsEmpty(h.UOMConversion)?parseFloat(s[0].QtyUom.toString())*parseFloat(h.UOMConversion.toString()):s[0].QtyUom):s[0].Quantity=n.e.IsEmpty(s[0].Quantity)?t.Tables[0][e].QTY.toString():parseFloat(s[0].Quantity.toString())+parseFloat(t.Tables[0][e].QTY.toString()))}}else r.ChkFifo=!0;r.OnSave("AutoSave"),r.count>1&&(O=O+r.count-1)}if(this.ScreenObject.Preferences.ContainsKey("AutoAdjustBinLinking")&&""!=this.ScreenObject.Preferences.AutoAdjustBinLinking.toString()&&Object(o.j)(this.ScreenObject.Preferences.AutoAdjustBinLinking)&&this.AddBins(h,!1,!1,null,!0),O++,null!=this.AutoPostViewModel&&e.Tables.length>16&&e.Tables[16].length>0){this.AutoPostViewModel.ScreenObject._CCFields.forEach(e=>{let t=this.ScreenObject._CCFields.find(t=>t.DBColumnName==e.DBColumnName);t&&e instanceof m.b&&t instanceof m.b&&(e.SelectedValue=t.SelectedValue,e.SelectedValueText=t.Text)}),this.AutoPostViewModel.ScreenObject._TextFields.forEach(e=>{e instanceof m.b&&3==e.CCID&&!n.e.IsEmpty(h.ProductID_Key)&&(e.SelectedValue=parseInt(h.ProductID_Key),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(e.SelectedValueText=h.ProductName.toString()))});let t=n.e.NewGuid();for(let a=0;a<e.Tables[16].length;a++){let s=this.AutoPostViewModel.ScreenObject.GridDataObj.NewRow();s.ProductID_Key=e.Tables[16][a].ProductID.toString(),s.defaultQuantity=e.Tables[16][a].Quantity.toString(),s.Quantity=parseFloat(h.Quantity)*parseFloat(e.Tables[16][a].Quantity),this.AutoPostViewModel.ScreenObject.GridDataColumns.Contains("Unit")&&(s.Unit=e.Tables[16][a].UnitName.toString()),this.AutoPostViewModel.ScreenObject.GridDataColumns.Contains("Unit_Key")&&(s.Unit_Key=e.Tables[16][a].Unit.toString()),this.AutoPostViewModel.ScreenObject.GridDataColumns.Contains("ProductCOde")&&(s.ProductCOde=e.Tables[16][a].ProductCOde.toString()),this.AutoPostViewModel.ScreenObject.GridDataColumns.Contains("ProductName")&&(s.ProductName=e.Tables[16][a].ProductName.toString()),s.RefSeqNo=t,this.AutoPostViewModel.ScreenObject.GridDataObj.insertRowAt(s,j),this.AutoPostViewModel.AddProductData(s,!1,!0,!0),this.AutoPostViewModel.CalculateTotals(s,!1,"",!1)}h.RefSeqNo=t;let s=this.AutoPostViewModel.ScreenObject.GridData.filter(e=>e.RefSeqNo=t),i=0;s.forEach(e=>{n.e.IsEmpty(e.Gross)||(i+=parseFloat(e.Gross))}),h.Rate=i/parseFloat(h.Quantity)}for(let e=0;e<this.Shortcuts.length;e++)this.Shortcuts[e]instanceof y.a&&5==this.Shortcuts[e].Mode&&this.ValidateData_Column(this.Shortcuts[e],h,!0)&&this.ScreenObject.GetExternalFuncData(this.Shortcuts[e].Mode,this.Shortcuts[e].SPName,this.Shortcuts[e].IPParams,this.Shortcuts[e].OPParams,h);if(T&&e.Columns[0].Contains("IsQtyFreeOffer")&&(n.e.IsEmpty(e.Tables[0][j].IsQtyFreeOffer)||!(parseInt(e.Tables[0][j].IsQtyFreeOffer)>0))){if(!n.e.IsEmpty(h.ProductID_Key)&&parseInt(h.ProductID_Key)>0){let e=this.ScreenObject.GetSchemes(this.DocumentDate,h);e.Tables.length>0&&e.Columns[0].Contains("SchemeID")&&this.fillSchemevalues(e.Tables[0],e.Columns[0],h)}this.ApplySchemes(h)}this.ScreenObject.GridDataColumns.Contains(e.Tables[0][j][e.Columns[0][3]].toString())?this.CalculateTotals(h,!1,e.Tables[0][j][e.Columns[0][3]].toString(),!1):this.CalculateTotals(h,!1,"",!1);for(let e=0;e<this.Shortcuts.length;e++)this.Shortcuts[e]instanceof y.a&&10==this.Shortcuts[e].Mode&&this.ValidateData_Column(this.Shortcuts[e],h,!0)&&this.ScreenObject.GetExternalFuncData(this.Shortcuts[e].Mode,this.Shortcuts[e].SPName,this.Shortcuts[e].IPParams,this.Shortcuts[e].OPParams,h);e.Columns[0].Contains("DocumentType")&&"5"==e.Tables[0][j].DocumentType.toString()&&r++}if(O>0&&!this.IsSelectAll&&this.ScreenObject.GridDataObj.removeRowAt(s+O),""!=I){let e=this.ScreenObject.GetPackDetails(I);null!=e&&e.Tables.length>0&&e.Columns[0].Contains("Name")&&e.Tables[0].length>0&&e.Tables[0].forEach(e=>{this.DtPack.filter(t=>t.ID==e.Nodeid).forEach(t=>{t.Name=e.Name,t.Volume=e.Volume,t.Weight=e.Weight,t.length=e.length,t.Width=e.width,t.Height=e.height})})}if(this.IsInventoryVoucher&&30==this.ScreenObject.DocumentType&&this.ScreenObject.Preferences.ContainsKey("UseasAssemble/DisAssembly")&&Object(o.j)(this.ScreenObject.Preferences["UseasAssemble/DisAssembly"])&&e.Tables.length>18&&e.Tables[18].length>0){let t=this.ScreenObject.GridData.filter(t=>t.ProductID_key==e.Tables[18][0].ParentProductID);if(t.length>0)for(this.ScreenObject.GridDataColumns.Contains("IsKit")||this.ScreenObject.GridDataColumns.push("IsKit"),t[0].IsKit=1,j=0;j<this.ScreenObject.GridData.length;j++)n.e.IsEmpty(this.ScreenObject.GridData[j].ProductID_Key)||(t=e.Tables[18].filter(e=>e.ProductID==this.ScreenObject.GridData[j].ProductID_Key),t.length>0&&(this.ScreenObject.GridData[j].IsKit=2,this.ScreenObject.GridData[j].DefaultQuantity=t[0].Quantity))}if(this.ScreenObject.Preferences.ContainsKey("FillLocalRef")&&""!=this.ScreenObject.Preferences.FillLocalRef.toString()&&Object(o.j)(this.ScreenObject.Preferences.FillLocalRef)&&""!=this.ScreenObject.Preferences.LocalRefflds.toString()){let e=this.ScreenObject.Preferences.LocalRefflds.toString().split(",");this.ScreenObject._CCFields.forEach(t=>{e.Contains(t.DBColumnID.toString())&&(this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&e.LocalReference==t.DBColumnID).length>0||this.ScreenObject.DefaultBasedOn.ContainsKey(t.CCID.toString()))&&this.ScreenObject.GetLinkReferenceData(t.DBColumnID,this.ScreenObject.CostCenterID,t.SelectedValue,this.DocumentDate,t.DBColumnName,t.CCID,null)}),this.ScreenObject._TextFields.forEach(t=>{t instanceof m.b&&e.Contains(t.DBColumnID.toString())&&this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&e.LocalReference==t.DBColumnID).length>0&&this.ScreenObject.GetLinkReferenceData(t.DBColumnID,this.ScreenObject.CostCenterID,t.SelectedValue,this.DocumentDate,t.DBColumnName,t.CCID,null)}),null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.SelectedValue>0&&e.Contains(this.ScreenObject.DebitAccount.DBColumnID.toString())&&this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&e.LocalReference==this.ScreenObject.DebitAccount.DBColumnID.toString()).length>0&&this.ScreenObject.GetLinkReferenceData(this.ScreenObject.DebitAccount.DBColumnID,this.ScreenObject.CostCenterID,this.ScreenObject.DebitAccount.SelectedValue,this.DocumentDate,this.ScreenObject.DebitAccount.DBColumnName,2,null),null!=this.ScreenObject.CreditAccount&&this.ScreenObject.CreditAccount.SelectedValue>0&&e.Contains(this.ScreenObject.CreditAccount.DBColumnID.toString())&&this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&e.LocalReference==this.ScreenObject.CreditAccount.DBColumnID.toString()).length>0&&this.ScreenObject.GetLinkReferenceData(this.ScreenObject.CreditAccount.DBColumnID,this.ScreenObject.CostCenterID,this.ScreenObject.CreditAccount.SelectedValue,this.DocumentDate,this.ScreenObject.CreditAccount.DBColumnName,2,null)}if(e.Tables.length>19&&e.Tables[19].length>0&&!n.e.IsEmpty(e.Tables[19][0][e.Columns[19][0]])){let t=this.ScreenObject.Data.Tables[0].filter(e=>79==e.LocalReference&&55478==e.LinkData);if(t.length>0){let s=e.Columns[19][0];if(this.ScreenObject.GridDataColumns.Contains(t[0].SysColumnName)&&this.ScreenObject.GridData.length>0)this.ScreenObject.GridData[0][t[0].SysColumnName]=e.Tables[19][0][s].toString();else{let i=this.ScreenObject._TextFields.find(e=>e.DBColumnID==t[0].CostCenterColID);i&&this.ScreenObject.fillcontrolValue(i,e.Tables[19][0][s].toString())}}}if(this.IsInventoryVoucher&&this.FooterVisible){let t=new n.f;if(e.Columns[2].Contains("Remarks")&&e.Tables[2].length>0&&!n.e.IsEmpty(e.Tables[2][0].Remarks)&&this.ScreenObject.Preferences.ContainsKey("CopyFooterDetails")&&""!=this.ScreenObject.Preferences.CopyFooterDetails&&Object(o.j)(this.ScreenObject.Preferences.CopyFooterDetails)&&t.LoadXml(e.Tables[2][0].Remarks),this.ScreenObject.FooterColumnSource[1].ReadOnly)for(j=0;j<this.ScreenObject.FooterGridData.length;j++){let s,i=null;s=null==l?e.Tables[4]:l,i=s.filter(e=>e.BASECOL==this.ScreenObject.FooterGridData[j].ColumnName);let a="";if(i.length>0&&!n.e.IsEmpty(i[0].LINKCOL)){a=i[0].LINKCOL.toString();let s="",r="";if(e.Tables.length>2&&e.Columns[2].Contains(a)&&(a.toLowerCase().Contains("dcnum")||a.toLowerCase().Contains("dccalcnum")||a.toLowerCase().Contains("dccurrid")||a.toLowerCase().Contains("dcexchrt"))){let t=null;e.Tables[2].length>0&&(t=e.Tables[2][0][a].toString()),null!=t&&(s=t.toString());let i=e.Tables[2].Compute("sum","dcCalc"+a.replace("dc",""));null!=i&&(r=i.toString())}if(!(""!=s&&n.e.IsNum(s)&&0!=parseFloat(s)||""!=r&&n.e.IsNum(r)&&0!=parseFloat(r)))continue;this.ScreenObject.FooterGridDataColumns.Contains("dcCurrID_Key")&&!n.e.IsEmpty(this.ScreenObject.FooterGridData[j].dcCurrID_Key)&&-3!=parseInt(this.ScreenObject.FooterGridData[j].dcCurrID_Key.toString())&&-1!=parseInt(this.ScreenObject.FooterGridData[j].dcCurrID_Key.toString())&&(a.toLowerCase().Contains("dcnum")&&e.Columns[2].Contains("dcCurrID"+a.toLowerCase().Replace("dcnum",""))&&!n.e.IsEmpty(e.Tables[2][0]["dcCurrID"+a.toLowerCase().Replace("dcnum","")])&&(this.ScreenObject.FooterGridData[j].dcCurrID_Key=e.Tables[2][0]["dcCurrID"+a.toLowerCase().Replace("dcnum","")].toString()),a.toLowerCase().Contains("dcnum")&&e.Columns[2].Contains("dcExchRT"+a.toLowerCase().Replace("dcnum",""))&&!n.e.IsEmpty(e.Tables[2][0]["dcExchRT"+a.toLowerCase().Replace("dcnum","")])&&(this.ScreenObject.FooterGridData[j].dcExchRT=e.Tables[2][0]["dcExchRT"+a.toLowerCase().Replace("dcnum","")].toString()),a.toLowerCase().Contains("dccalcnum")&&e.Columns[2].Contains("dcCurrID"+a.toLowerCase().Replace("dccalcnum",""))&&!n.e.IsEmpty(e.Tables[2][0]["dcCurrID"+a.toLowerCase().Replace("dccalcnum","")])&&(this.ScreenObject.FooterGridData[j].dcCurrID_Key=e.Tables[2][0]["dcCurrID"+a.toLowerCase().Replace("dccalcnum","")].toString()),a.toLowerCase().Contains("dccalcnum")&&e.Columns[2].Contains("dcExchRT"+a.toLowerCase().Replace("dccalcnum",""))&&!n.e.IsEmpty(e.Tables[2][0]["dcExchRT"+a.toLowerCase().Replace("dccalcnum","")])&&(this.ScreenObject.FooterGridData[j].dcExchRT=e.Tables[2][0]["dcExchRT"+a.toLowerCase().Replace("dccalcnum","")].toString())),""!=s&&n.e.IsNum(s)?(this.ScreenObject.FooterGridData[j].Amount=this.ScreenObject.Preferences.ContainsKey("ClubFooter")&&""!=this.ScreenObject.Preferences.ClubFooter&&Object(o.j)(this.ScreenObject.Preferences.ClubFooter)&&!n.e.IsEmpty(this.ScreenObject.FooterGridData[j].Amount)&&n.e.IsNum(this.ScreenObject.FooterGridData[j].Amount)?parseFloat(this.ScreenObject.FooterGridData[j].Amount)+parseFloat(s):s,this.FooterCellEditEnd("Amount",this.ScreenObject.FooterGridData[j])):""!=r&&n.e.IsNum(r)&&(this.ScreenObject.FooterGridData[j].CalcAmount=this.ScreenObject.Preferences.ContainsKey("ClubFooter")&&""!=this.ScreenObject.Preferences.ClubFooter&&Object(o.j)(this.ScreenObject.Preferences.ClubFooter)&&!n.e.IsEmpty(this.ScreenObject.FooterGridData[j].CalcAmount)&&n.e.IsNum(this.ScreenObject.FooterGridData[j].CalcAmount)?parseFloat(this.ScreenObject.FooterGridData[j].CalcAmount)+parseFloat(r):r,this.FooterCellEditEnd("CalcAmount",this.ScreenObject.FooterGridData[j]));let l=t.SelectNodes("XML/Row");for(let e=0;e<l.length;e++){let t=l[e];if(null!=t.attributes.Columnname&&t.attributes.Columnname.value.toLowerCase()==a.toLowerCase()){null!=t.attributes.DebitAccount&&""!=t.attributes.DebitAccount.value&&(this.ScreenObject.FooterGridData[j].DebitAccount=t.attributes.DebitAccount.value),null!=t.attributes.CreditAcount&&""!=t.attributes.CreditAcount.value&&(this.ScreenObject.FooterGridData[j].CreditAccount=t.attributes.CreditAcount.value),null!=t.attributes.Remarks&&""!=t.attributes.Remarks.value&&(this.ScreenObject.FooterGridData[j].Remarks=t.attributes.Remarks.value);break}}}}else{if(this.ScreenObject.FooterColumnSource[1].ComboData instanceof DataView){for(this.ScreenObject.FooterColumnSource[1].SetComboData(this.ScreenObject.FooterColumnSource[1].ComboDataTable),j=0;j<this.ScreenObject.FooterColumnSource[1].ComboData.length;j++){let s=null;s=null==l?e.Tables[4]:l;let i=s.filter(e=>e.BASECOL==this.ScreenObject.FooterColumnSource[1].ComboData[j].ColumnName),a="";if(i.length>0&&!n.e.IsEmpty(i[0].LINKCOL)){a=i[0].LINKCOL.toString();let s="",r="";if(e.Tables.length>2&&e.Columns[2].Contains(a)&&(a.toLowerCase().Contains("dcnum")||a.toLowerCase().Contains("dccalcnum")||a.toLowerCase().Contains("dccurrid")||a.toLowerCase().Contains("dcexchrt"))){let t=null;e.Tables[2].length>0&&(t=e.Tables[2][0][a].toString()),s=null!=t?t.toString():"0";let i=e.Tables[2].Compute("sum","dcCalc"+a.replace("dc",""));null!=i&&(r=i.toString())}if(!(""!=s&&n.e.IsNum(s)&&0!=parseFloat(s)||""!=r&&n.e.IsNum(r)&&0!=parseFloat(r)))continue;let l,c=this.ScreenObject.FooterGridData.filter(e=>e.ColumnName==this.ScreenObject.FooterColumnSource[1].ComboData[j].ColumnName);if(c.length>0)l=c[0],this.ScreenObject.FooterGridDataColumns.Contains("dcCurrID_Key")&&!n.e.IsEmpty(l.dcCurrID_Key)&&-3!=parseInt(l.dcCurrID_Key.toString())&&-1!=parseInt(l.dcCurrID_Key.toString())&&(a.toLowerCase().Contains("dcnum")&&e.Columns[2].Contains("dcCurrID"+a.toLowerCase().Replace("dcnum",""))&&!n.e.IsEmpty(e.Tables[2][0]["dcCurrID"+a.toLowerCase().Replace("dcnum","")])&&(l.dcCurrID_Key=e.Tables[2][0]["dcCurrID"+a.toLowerCase().Replace("dcnum","")].toString()),a.toLowerCase().Contains("dcnum")&&e.Columns[2].Contains("dcExchRT"+a.toLowerCase().Replace("dcnum",""))&&!n.e.IsEmpty(e.Tables[2][0]["dcExchRT"+a.toLowerCase().Replace("dcnum","")])&&(l.dcExchRT=e.Tables[2][0]["dcExchRT"+a.toLowerCase().Replace("dcnum","")].toString()),a.toLowerCase().Contains("dccalcnum")&&e.Columns[2].Contains("dcCurrID"+a.toLowerCase().Replace("dccalcnum",""))&&!n.e.IsEmpty(e.Tables[2][0]["dcCurrID"+a.toLowerCase().Replace("dccalcnum","")])&&(l.dcCurrID_Key=e.Tables[2][0]["dcCurrID"+a.toLowerCase().Replace("dccalcnum","")].toString()),a.toLowerCase().Contains("dccalcnum")&&e.Columns[2].Contains("dcExchRT"+a.toLowerCase().Replace("dccalcnum",""))&&!n.e.IsEmpty(e.Tables[2][0]["dcExchRT"+a.toLowerCase().Replace("dccalcnum","")])&&(l.dcExchRT=e.Tables[2][0]["dcExchRT"+a.toLowerCase().Replace("dccalcnum","")].toString())),""!=s?(c[0].Amount=this.ScreenObject.Preferences.ContainsKey("ClubFooter")&&Object(o.j)(this.ScreenObject.Preferences.ClubFooter)&&n.e.IsNum(c[0].Amount)?parseFloat(c[0].Amount)+parseFloat(s):s,this.FooterCellEditEnd("Amount",c[0])):""!=r&&(c[0].CalcAmount=this.ScreenObject.Preferences.ContainsKey("ClubFooter")&&Object(o.j)(this.ScreenObject.Preferences.ClubFooter)&&n.e.IsNum(c[0].CalcAmount)?parseFloat(c[0].CalcAmount)+parseFloat(r):r,this.FooterCellEditEnd("CalcAmount",c[0]));else{let t=this.GetEmptyRowPosition(this.ScreenObject.FooterGridDataObj,"ColumnName");t>-1?l=this.ScreenObject.FooterGridData[t]:(l=this.ScreenObject.FooterGridDataObj.NewRow(),this.ScreenObject.FooterGridData.push(l)),l.ColumnName=this.ScreenObject.FooterColumnSource[1].ComboData[j].ColumnName.toString(),this.FooterCellEditEnd("ColumnName",l),this.ScreenObject.FooterGridDataColumns.Contains("StyleHeightZero")&&(Object(o.j)(l.IsVisible)?l.StyleHeightZero=0:(l.StyleHeightZero=1,t>-1&&(l=this.ScreenObject.FooterGridDataObj.NewRow(),this.ScreenObject.FooterGridData.push(l),l.ColumnName=this.ScreenObject.FooterColumnSource[1].ComboData[j].ColumnName.toString(),this.FooterCellEditEnd("ColumnName",l),l.StyleHeightZero=1,this.ScreenObject.FooterGridDataObj.removeRowAt(t)))),""!=s?(this.ScreenObject.FooterGridDataColumns.Contains("dcCurrID_Key")&&!n.e.IsEmpty(l.dcCurrID_Key)&&-3!=parseInt(l.dcCurrID_Key.toString())&&-1!=parseInt(l.dcCurrID_Key.toString())&&(a.toLowerCase().Contains("dcnum")&&e.Columns[2].Contains("dcCurrID"+a.toLowerCase().Replace("dcnum",""))&&!n.e.IsEmpty(e.Tables[2][0]["dcCurrID"+a.toLowerCase().Replace("dcnum","")])&&(l.dcCurrID_Key=e.Tables[2][0]["dcCurrID"+a.toLowerCase().Replace("dcnum","")].toString()),a.toLowerCase().Contains("dcnum")&&e.Columns[2].Contains("dcExchRT"+a.toLowerCase().Replace("dcnum",""))&&!n.e.IsEmpty(e.Tables[2][0]["dcExchRT"+a.toLowerCase().Replace("dcnum","")])&&(l.dcExchRT=e.Tables[2][0]["dcExchRT"+a.toLowerCase().Replace("dcnum","")].toString()),a.toLowerCase().Contains("dccalcnum")&&e.Columns[2].Contains("dcCurrID"+a.toLowerCase().Replace("dccalcnum",""))&&!n.e.IsEmpty(e.Tables[2][0]["dcCurrID"+a.toLowerCase().Replace("dccalcnum","")])&&(l.dcCurrID_Key=e.Tables[2][0]["dcCurrID"+a.toLowerCase().Replace("dccalcnum","")].toString()),a.toLowerCase().Contains("dccalcnum")&&e.Columns[2].Contains("dcExchRT"+a.toLowerCase().Replace("dccalcnum",""))&&!n.e.IsEmpty(e.Tables[2][0]["dcExchRT"+a.toLowerCase().Replace("dccalcnum","")])&&(l.dcExchRT=e.Tables[2][0]["dcExchRT"+a.toLowerCase().Replace("dccalcnum","")].toString())),l.Amount=this.ScreenObject.Preferences.ContainsKey("ClubFooter")&&Object(o.j)(this.ScreenObject.Preferences.ClubFooter)&&n.e.IsNum(l.Amount)?parseFloat(l.Amount)+parseFloat(s):s,this.FooterCellEditEnd("Amount",l)):""!=r&&(l.CalcAmount=this.ScreenObject.Preferences.ContainsKey("ClubFooter")&&Object(o.j)(this.ScreenObject.Preferences.ClubFooter)&&n.e.Double(l.CalcAmount)?parseFloat(l.CalcAmount)+parseFloat(r):r,this.FooterCellEditEnd("CalcAmount",l))}let h=t.SelectNodes("XML/Row");for(let e=0;e<h.length;e++){let t=h[e];if(null!=t.attributes.Columnname&&t.attributes.Columnname.value.toLowerCase()==a.toLowerCase()){null!=t.attributes.DebitAccount&&""!=t.attributes.DebitAccount.value&&(l.DebitAccount=t.attributes.DebitAccount.value),null!=t.attributes.CreditAcount&&""!=t.attributes.CreditAcount.value&&(l.CreditAccount=t.attributes.CreditAcount.value),null!=t.attributes.Remarks&&""!=t.attributes.Remarks.value&&(l.Remarks=t.attributes.Remarks.value);break}}}}this.ScreenObject.FooterColumnSource[1].SetComboData(this.ScreenObject.FooterColumnSource[1].ComboDataTable.filter(e=>1==e.IsVisible))}this.GetEmptyRowPosition(this.ScreenObject.FooterGridDataObj,"ColumnName"),this.ScreenObject.UpdateSequenceFoot()}this.RefreshGridFooter=!0}if(e.Tables.length>10&&e.Tables[10].length>0&&this.ScreenObject.Preferences.ContainsKey("CopyAddresses")&&""!=this.ScreenObject.Preferences.CopyAddresses&&Object(o.j)(this.ScreenObject.Preferences.CopyAddresses)&&this.AddAddress(e),e.Tables.length>7&&e.Tables[7].length>0&&this.ScreenObject.Preferences.ContainsKey("LinkAttachments")&&""!=this.ScreenObject.Preferences.LinkAttachments&&Object(o.j)(this.ScreenObject.Preferences.LinkAttachments)){let t=null;if(e.Columns[7].Contains("DocID")){let s=[];for(j=0;j<e.Tables[0].length;j++)s.push(e.Tables[0][j].DocID);s.length>0&&(t=e.Tables[7].filter(e=>s.Contains(e.DocID)))}else t=e.Tables[7];if(null!=t&&t.length>0&&null!=this.ViewAttachments)for(let s=0;s<t.length;s++){let i=new G.AddAttachmentViewModel;i.AddAttachmentViewModel_2(this),i.ActualFileName=t[s].ActualFileName.toString(),i.FileExtension=t[s].FileExtension.toString(),i.FileDescription=t[s].FileDescription.toString(),i.FilePath=n.b.GetLogPath(t[s].GUID.toString()+"."+t[s].FileExtension.toString()),i.RelativeFileName=t[s].RelativeFileName.toString(),i.AllowInPrint=Object(o.j)(t[s].AllowInPrint),i.isfrmProduct=!0,i.ColID="",i.RowID=null,i.RefNo=e.Tables[0][0].VoucherNO.toString(),this.ViewAttachments.AttachmentsListObj.addRow(i)}}if(57==this.ScreenObject.DocumentType){let t=0;for(j=0;j<e.Tables[0].length;j++)n.e.IsEmpty(e.Tables[0][0][e.Columns[0][0]])||(t+=parseFloat(e.Tables[0][0][e.Columns[0][0]]));for(j=0;j<this.ScreenObject.GridData.length;j++)n.e.IsEmpty(this.ScreenObject.GridData[j].RefNo)||""!=n.e.String(this.ScreenObject.GridData[j].dcAlpha2)||this.ScreenObject.GridData[j].RefNo.toString()==e.Tables[0][0].VoucherNO.toString()&&(this.ScreenObject.GridData[j].dcAlpha2=t)}for(j=0;j<this.Shortcuts.length;j++)this.Shortcuts[j]instanceof b.c&&5==this.Shortcuts[j].Mode&&this.ValidateData(this.Shortcuts[j],!0)&&this.ScreenObject.GetExternalFuncData(this.Shortcuts[j].Mode,this.Shortcuts[j].ToolTipFooterTitle,this.Shortcuts[j].ToolTipFooterDescription,this.Shortcuts[j].ToolTipDescription,null);if(0==t.length&&e.Tables[0].length>0&&!this.IsSelectAll?(this.RefreshGrid=!0,this.ScreenObject.FillListViews(!1)):a.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==a.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&this.ScreenObject.FillListViews(!1),this.ScreenObject.SetDefaultValuesforCostCenters(2),null==l&&this.ScreenObject.Preferences.ContainsKey("SortbyProduct")&&"true"==this.ScreenObject.Preferences.SortbyProduct.toLowerCase()&&this.SortGrid(!0),e.Tables[0].length<500)if(s>100)for(j=s;j<this.ScreenObject.GridData.length;j++)n.e.IsEmpty(this.ScreenObject.GridData[j].ProductID_Key)||this.CalculateTotals(this.ScreenObject.GridData[j],!1,"",!1);else this.ScreenObject.GridData.forEach(e=>{n.e.IsEmpty(e.ProductID_Key)||this.CalculateTotals(e,!1,"",!1)});this.CalculateTotals(null,!1)}catch(p){Logger.ErrorLog("VoucherGenerator","LoadEditData",p.stack)}finally{this.ScreenObject.AttachDetach(!0)}}FillLinkRefereceProducts_2(e,t){this.FillDatarow_4(e,t,{LocalReference:79,LinkData:23819},"AvgRate"),this.FillDatarow_4(e,t,{LocalReference:79,LinkData:25398},"QOH"),this.FillDatarow_4(e,t,{LocalReference:79,LinkData:52638},"QOH"),this.FillDatarow_4(e,t,{LocalReference:79,LinkData:52637},"BalQOH"),this.FillDatarow_4(e,t,{LocalReference:79,LinkData:26421},"HOLDQTY"),this.FillDatarow_4(e,t,{LocalReference:79,LinkData:50454},"CommittedQty"),this.FillDatarow_4(e,t,{LocalReference:79,LinkData:26422},"RESERVEQTY"),this.FillDatarow_4(e,t,{LocalReference:79,LinkData:499943},"TotalReserve"),this.FillDatarow_4(e,t,{LocalReference:79,LinkData:23820},"LastPurchaseRate"),this.FillDatarow_4(e,t,{LocalReference:79,LinkData:24062},"PWLastPRate"),this.FillDatarow_4(e,t,{LocalReference:79,LinkData:50051},"LastPCost"),this.FillDatarow_4(e,t,{LocalReference:79,LinkData:23821},"PWLastPCost"),this.FillDatarow_4(e,t,{LocalReference:79,LinkData:50494},"UnitProductCode"),this.FillDatarow_4(e,t,{LocalReference:79,LinkData:50493},"VendorProductCode"),this.FillDatarow_4(e,t,{LinkData:22821},"SellingRate"),this.FillDatarow_4(e,t,{LinkData:22793},"SellingRateA"),this.FillDatarow_4(e,t,{LinkData:22794},"SellingRateB"),this.FillDatarow_4(e,t,{LinkData:22795},"SellingRateC"),this.FillDatarow_4(e,t,{LinkData:22796},"SellingRateD"),this.FillDatarow_4(e,t,{LinkData:22797},"SellingRateE"),this.FillDatarow_4(e,t,{LinkData:22798},"SellingRateF"),this.FillDatarow_4(e,t,{LinkData:22799},"SellingRateG"),this.FillDatarow_4(e,t,{LinkData:22820},"PurchaseRate"),this.FillDatarow_4(e,t,{LinkData:22786},"PurchaseRateA"),this.FillDatarow_4(e,t,{LinkData:22787},"PurchaseRateB"),this.FillDatarow_4(e,t,{LinkData:22788},"PurchaseRateC"),this.FillDatarow_4(e,t,{LinkData:22789},"PurchaseRateD"),this.FillDatarow_4(e,t,{LinkData:22790},"PurchaseRateE"),this.FillDatarow_4(e,t,{LinkData:22791},"PurchaseRateF"),this.FillDatarow_4(e,t,{LinkData:22792},"PurchaseRateG"),this.FillDatarow_4(e,t,{LinkData:277},"ReorderQty"),this.FillDatarow_4(e,t,{LinkData:276},"ReorderLevel")}FillDatarow_4(e,t,s,i){let a;if(a=this.ScreenObject.Data.Tables[0].filter(s.LocalReference?e=>e.LocalReference==s.LocalReference&&e.LinkData==s.LinkData:e=>null!=e.LocalReference&&e.LinkData==s.LinkData),a.length>0&&a.length>0&&this.ScreenObject.GridDataColumns.Contains(a[0].SysColumnName)&&!n.e.IsEmpty(t[0][i])){if(e.toString().Contains(a[0].SysColumnName+'="')){let t=e.toString().indexOf(a[0].SysColumnName+'="'),s=e.toString().indexOf('"',t+a[0].SysColumnName.length+2);e=e.Remove(t,s+1-t)}e+=" "+a[0].SysColumnName+'="'+t[0][i].toString()+'" '}}GetEmptyRowPosition(e,t){let s=-1,i=e.Table,a=e.Columns;for(let r=0;r<i.length;r++)if(""==n.e.String(i[r][t])){s=r;break}return-1==s&&(i.push({}),s=i.length-1,a.Contains("Sno")&&(i[s].Sno=i.length),a.Contains("DocSeqNo")&&(i[s].DocSeqNo=i.length)),s}FillLink(e,t,s,i){let a=this.ScreenObject.GetLinkDocDetails(e,t),r=0;for(let o=0;o<this.ScreenObject.GridData.length;o++)if(n.e.IsEmpty(this.ScreenObject.GridData[o].ProductID_Key)&&(!this.ScreenObject.GridDataColumns.Contains("RefNo")||n.e.IsEmpty(this.ScreenObject.GridData[o].RefNo))){r=o;break}for(let o=0;o<a.Tables[0].length;o++){let e=this.ScreenObject.GridData.filter(e=>e.LinkedInvDocDetailsID==a.Tables[0][o].DocDetailsID);if(e.length>0){let t=0;for(let s=0;s<e.length;s++)!n.e.IsEmpty(e[s][a.Tables[0][o][a.Columns[0][3]].toString()])&&n.e.IsNum(e[s][a.Tables[0][o][a.Columns[0][3]].toString()])&&(t+=parseFloat(e[s][a.Tables[0][o][a.Columns[0][3]]]));if(!(!n.e.IsEmpty(a.Tables[0][o][a.Columns[0][0]])&&n.e.IsNum(a.Tables[0][o][a.Columns[0][0]])&&parseFloat(a.Tables[0][o][a.Columns[0][0]])-t>0)){a.Tables[0].RemoveAt(o),a.Tables[1].RemoveAt(o),a.Tables[2].RemoveAt(o),a.Tables[3].RemoveAt(o),o--;continue}a.Tables[0][o][a.Columns[0][0]]=parseFloat(a.Tables[0][o][a.Columns[0][0]])-t}}if(null!=s&&s.length>0){for(let e=a.Tables[0].length-1;e>=0;e--)s.find(t=>t.InvDocDetailsID==a.Tables[0][e].DocDetailsID)||(a.Tables[0].RemoveAt(e),a.Tables[1].RemoveAt(e),a.Tables[2].RemoveAt(e),a.Tables[3].RemoveAt(e));if(e.Contains(","))for(let e=a.Tables[7].length-1;e>=0;e--)0==a.Tables[0].filter(t=>t.DocID==a.Tables[7][e].FeaturePK).length&&a.Tables[7].RemoveAt(e)}this.LoadLinkData(a,s,r,i,null)}onselectall(e){if(null!=this.ScreenObject.Link&&null!=this.ScreenObject.Link.LinkCombo&&null!=this.ScreenObject.Link.LinkCombo.SelectedValue&&""!=this.ScreenObject.Link.LinkCombo.SelectedValue&&null!=this.ScreenObject.Link.DocumentList){if(this.ScreenObject.Preferences.ContainsKey("SameserialNo")&&""!=this.ScreenObject.Preferences.SameserialNo&&Object(o.j)(this.ScreenObject.Preferences.SameserialNo))return void(this.DisplayMessage="Can not select all when same Serial No in linking");this.IsSelectAll=!0;for(let e=0;e<this.ScreenObject.Link.DocumentList.Items.length;e++)this.ScreenObject.Link.DocumentList.Items[e].IsChecked||(this.ScreenObject.Link.DocumentList.Items[e].IsChecked=!0,this.FillLinkDocument(this.ScreenObject.Link.DocumentList.Items[e]));this.IsSelectAll=!1}this.RefreshGrid=!0,this.CheckVendorWiseLinkingPref()}FillLinkDocument(e){if(null!=this.ScreenObject.Link.LinkCombo.SelectedValue&&""!=this.ScreenObject.Link.LinkCombo.SelectedValue)if(null!=this.ScreenObject.Link.LinkCombo.SelectedItem&&("158"==this.ScreenObject.Link.LinkCombo.SelectedItem.Parent||"76"==this.ScreenObject.Link.LinkCombo.SelectedItem.Parent)||this.ScreenObject.Preferences.ContainsKey("Selective")&&Object(o.j)(this.ScreenObject.Preferences.Selective)){let t=0,s=!1;null==this.ScreenObject.Link.LinkCombo.SelectedItem||"158"!=this.ScreenObject.Link.LinkCombo.SelectedItem.Parent&&"76"!=this.ScreenObject.Link.LinkCombo.SelectedItem.Parent||null==e.Value||""==e.Value||(t=parseInt(e.Value)),null!=this.ScreenObject.Link.LinkCombo.SelectedItem&&"76"==this.ScreenObject.Link.LinkCombo.SelectedItem.Parent&&(s=!0);let i=new Q.a(this,e.Name,parseInt(this.ScreenObject.Link.LinkCombo.SelectedValue),t,s);a.a.page.ShowDialog(i,K.a,{ShowCenter:!a.a.IsMobile});let r=0;for(let e=0;e<this.ScreenObject.GridData.length;e++)if(n.e.IsEmpty(this.ScreenObject.GridData[e].ProductID_Key)){r=e;break}this.LineNo=r>0?r:1,this.SetFocusongrid=!0}else this.FillLink(e.Name,parseInt(this.ScreenObject.Link.LinkCombo.SelectedValue),[],[])}OnLinkDocumentCheckedChanged(e){if(this.IsSelectAll)return;let t=e.item?e.item:e;if(Logger.InfoLog("AddEditDocumentViewModel::Entering OnLinkDocumentCheckedChanged"),t instanceof D.c){if(t.IsChecked){if((this.ScreenObject.Preferences.ContainsKey("SameserialNo")&&""!=this.ScreenObject.Preferences.SameserialNo&&Object(o.j)(this.ScreenObject.Preferences.SameserialNo)||this.ScreenObject.Preferences.ContainsKey("Linksingledoc")&&""!=this.ScreenObject.Preferences.Linksingledoc&&Object(o.j)(this.ScreenObject.Preferences.Linksingledoc))&&this.ScreenObject.GridData.filter(e=>e.LinkedInvDocDetailsID>0).length>0)return this.DisplayMessage=this.ScreenObject.Preferences.ContainsKey("SameserialNo")&&""!=this.ScreenObject.Preferences.SameserialNo&&Object(o.j)(this.ScreenObject.Preferences.SameserialNo)?"Can not select multiple when same Serial No in linking":"Can link only one document",this.IsSelectAll=!0,t.IsChecked=!1,void(this.IsSelectAll=!1);this.DisplayMessage="Linking data please wait.",this.FillLinkDocument(t),this.DisplayMessage="",this.ScreenObject.GridDataObj.refreshDataView()}else{let e=!1,s=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&55489==e.LinkData);if(s.length>0&&this.ScreenObject.GridDataColumns.Contains(s[0].SysColumnName)){let i=this.ScreenObject.GridData.filter(e=>e.RefNo=t.Name);for(let t=0;t<i.length;t++){let a=i[t];if(!n.e.IsEmpty(a[s[0].SysColumnName])&&!n.e.IsEmpty(a.DocDetailsID)&&parseInt(a.DocDetailsID)>0){e=!0;break}}}if(this.res="No",confirm("Do you want to unlink "+t.Name+"? (Y/N)"+(e?"\n Barcodes will also be removed.":""))&&(this.res="Yes"),"Yes"!=this.res)return this.IsSelectAll=!0,t.IsChecked=!0,void(this.IsSelectAll=!1);if(null==this.ScreenObject.Link.LinkCombo.SelectedItem||"158"!=this.ScreenObject.Link.LinkCombo.SelectedItem.Parent&&"76"!=this.ScreenObject.Link.LinkCombo.SelectedItem.Parent){if(this.ScreenObject.GridData.filter(e=>e.RefNo==t.Name).forEach(e=>{null!=this.AutoPostViewModel&&(this.AutoPostViewModel.ScreenObject.GridData.filter(t=>t.RefSeqNo==e.RefSeqNo).forEach(e=>{this.AutoPostViewModel.ScreenObject.GridDataObj.removeRow(e)}),this.AutoPostViewModel.CalculateTotals(null,!1)),this.CheckPackingWtVol(e),this.ScreenObject.GridDataObj.removeRow(e)}),this.ScreenObject.Preferences.ContainsKey("LinkAttachments")&&""!=this.ScreenObject.Preferences.LinkAttachments&&Object(o.j)(this.ScreenObject.Preferences.LinkAttachments)){let e=this.ViewAttachments.AttachmentsList.filter(e=>!n.e.IsEmpty(e.RefNo)&&e.RefNo==t.Name);e.length>0&&e.forEach(e=>{this.ViewAttachments.AttachmentsListObj.removeRow(e)})}}else this.ScreenObject.GridDataColumns.Contains("jobID")&&this.ScreenObject.GridData.filter(e=>e.jobID==t.Value).forEach(e=>{null!=this.AutoPostViewModel&&(this.AutoPostViewModel.ScreenObject.GridData.filter(t=>t.RefSeqNo==e.RefSeqNo).forEach(e=>{this.AutoPostViewModel.ScreenObject.GridDataObj.removeRow(e)}),this.AutoPostViewModel.CalculateTotals(null,!1)),this.ScreenObject.GridDataObj.removeRow(e)});this.CalculateTotals(null,!1)}this.ScreenObject.UpdateSequence(),this.CheckVendorWiseLinkingPref()}Logger.InfoLog("AddEditDocumentViewModel::Exiting OnLinkDocumentCheckedChanged")}CheckPackingWtVol(e){if(this.ScreenObject.GridDataColumns.Contains("PackXML")&&!n.e.IsEmpty(e.PackXML)){let t=new n.f;t.LoadXml(e.PackXML);let s=t.SelectNodes("DocExtraXML/Row");for(let e=0;e<s.length;e++)if(null!=s[e].attributes.Label&&!n.e.IsEmpty(s[e].attributes.Label.value)&&null!=s[e].attributes.RefID&&!n.e.IsEmpty(s[e].attributes.RefID.value)){let t=this.DtPack.filter(t=>t.Label==s[e].attributes.Label.value),i=0;t.length>0&&null!=s[e].attributes.Qty&&!n.e.IsEmpty(s[e].attributes.Qty.value)&&(n.e.IsNum(s[e].attributes.Weight.value)&&(i=parseFloat(s[e].attributes.Weight.value)*parseFloat(s[e].attributes.Qty.value),n.e.IsEmpty(t[0].cWeight)||(t[0].cWeight=parseFloat(t[0].cWeight)-i)),n.e.IsNum(s[e].attributes.Volume.value)&&(i=parseFloat(s[e].attributes.Volume.value)*parseFloat(s[e].attributes.Qty.value),n.e.IsEmpty(t[0].cVolume)||(t[0].cVolume=parseFloat(t[0].cVolume)-i)))}}}CheckVendorWiseLinkingPref(){this.ScreenObject.Preferences.ContainsKey("Debit Account")&&Object(o.j)(this.ScreenObject.Preferences["Debit Account"])&&null!=this.ScreenObject.DebitAccount?this.ScreenObject.DebitAccount.Enable=!(this.ScreenObject.DebitAccount.SelectedValue>0&&this.ScreenObject.GridData.filter(e=>e.LinkedInvDocDetailsID>0).length>0):null!=this.ScreenObject.DebitAccount&&(this.ScreenObject.DebitAccount.Enable=!0),this.ScreenObject.Preferences.ContainsKey("Credit Account")&&Object(o.j)(this.ScreenObject.Preferences["Credit Account"])&&null!=this.ScreenObject.CreditAccount?this.ScreenObject.CreditAccount.Enable=!(this.ScreenObject.CreditAccount.SelectedValue>0&&this.ScreenObject.GridData.filter(e=>e.LinkedInvDocDetailsID>0).length>0):null!=this.ScreenObject.CreditAccount&&(this.ScreenObject.CreditAccount.Enable=!0),this.ScreenObject.Preferences.ContainsKey("DimensionWise")&&""!=this.ScreenObject.Preferences.DimensionWise&&this.ScreenObject.Preferences.DimensionWise.split(",").forEach(e=>{if(""!=e){let t=parseInt(e);if(this.ScreenObject.Data.Tables[8].filter(e=>e.CCID==t).length>0)return;for(let e=0;e<this.ScreenObject._CCFields.length;e++){let s=this.ScreenObject._CCFields[e];if(s instanceof m.b&&s.CCID==t){s.Enable=!(s.SelectedValue>0&&this.ScreenObject.GridData.filter(e=>e.LinkedInvDocDetailsID>0).length>0);break}}}})}OLinkSelectionChanged(e){if(""!=this.ScreenObject.Link.LinkCombo.SelectedValue){let e;this.ScreenObject.Link.DocumentList.Visible=!0,this.ScreenObject.Link.VouchersList=null,e=this.ScreenObject.GetLinkDetails(parseInt(this.ScreenObject.Link.LinkCombo.SelectedValue),this.ScreenObject.DocDate.Date.ToString("dd/MMM/yyyy"),null!=this.ScreenObject.DueDate&&this.ScreenObject.DueDate.Date?this.ScreenObject.DueDate.Date.ToString("dd/MMM/yyyy"):""),e.Tables.length>0&&e.Columns[0].Contains("voucherno")&&(this.ScreenObject.Link.VouchersList=e.Tables[0],this.ScreenObject.FillPendingList(!0))}else this.ScreenObject.Link.DocumentList.Visible=!1}GetReserveAccount(){switch(this.ScreenObject.DocumentType){case 16:return a.a.SessionManager.ReservedOPAccount.toString();case 17:return a.a.SessionManager.ReservedJVAccount.toString();case 28:return a.a.SessionManager.ReservedCNAccount.toString();case 29:return a.a.SessionManager.ReservedDNAccount.toString()}return""}ValidateHeaderSave(){for(let e=0;e<this.ScreenObject._TextFields.length;e++){let t=this.ScreenObject._TextFields[e];if((t instanceof u.d||t instanceof D.e||t instanceof m.b||t instanceof m.a||t instanceof g.a||t instanceof d.c)&&!this.ValidateDataonSave_Ctrl(t))return!1}for(let e=0;e<this.ScreenObject.HeaderFields.length;e++){let t=this.ScreenObject.HeaderFields[e];if(t instanceof b.c&&!n.e.IsEmpty(t.Lbl)&&this.fldDict.ContainsKey(t.Lbl)&&!this.ValidateDataonSave_Ctrl(t))return!1}for(let e=0;e<this.ScreenObject._CCFields.length;e++){let t=this.ScreenObject._CCFields[e];if(this.fldDict.ContainsKey(t.Lbl)&&(t instanceof m.b||t instanceof C.a||t instanceof m.a)&&!this.ValidateDataonSave_Ctrl(t))return!1}return this.ValidateDataonSave()}GetCurrencyID(e){let t=1;return this.Currency&&!n.e.IsEmpty(this.Currency.Currency.SelectedValue)?t=parseInt(this.Currency.Currency.SelectedValue):this.ScreenObject.GridDataColumns.Contains("CurrencyID")&&!n.e.IsEmpty(this.ScreenObject.GridData[e].CurrencyID_Key)&&(t=parseInt(this.ScreenObject.GridData[e].CurrencyID_Key)),t}GetExchRate(e){let t=1;return this.Currency&&!n.e.IsEmpty(this.Currency.ExchangeRate.Text)?t=parseFloat(this.Currency.ExchangeRate.Text):this.ScreenObject.GridDataColumns.Contains("ExchangeRate")&&!n.e.IsEmpty(this.ScreenObject.GridData[e].ExchangeRate)&&(t=parseFloat(this.ScreenObject.GridData[e].ExchangeRate)),t}GetPrimaryColName(){return this.IsInventoryVoucher?"ProductID_Key":this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")?"CreditAccount_Key":this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")?"DebitAccount_Key":this.ScreenObject.GridDataColumns.Contains("AccountID_Key")?"AccountID_Key":""}MandaotryValidation(e,t){if(0!=this.ScreenObject.ColumnSource[t].CostCenterID&&(!n.e.IsEmpty(this.ScreenObject.ColumnSource[t].ValueMember)&&n.e.IsEmpty(this.ScreenObject.GridData[e][this.ScreenObject.ColumnSource[t].ValueMember])||parseInt(this.ScreenObject.GridData[e][this.ScreenObject.ColumnSource[t].ValueMember])<1))return this.DisplayMessage=a.a.GetResource("Doc_Select")+this.ScreenObject.ColumnSource[t].Header+" "+this.ScreenObject.GridData[e].DocSeqNo.toString(),!1;if("SELECTIONBOX"==this.ScreenObject.ColumnSource[t].DataType&&n.e.IsEmpty(this.ScreenObject.GridData[e][this.ScreenObject.ColumnSource[t].DisplayMember]))return this.DisplayMessage=a.a.GetResource("Doc_Select")+this.ScreenObject.ColumnSource[t].Header+" "+this.ScreenObject.GridData[e].DocSeqNo.toString(),!1;if("ComboBox"==this.ScreenObject.ColumnSource[t].DataType&&n.e.IsEmpty(this.ScreenObject.GridData[e][this.ScreenObject.ColumnSource[t].ValueBinding]))return this.DisplayMessage=a.a.GetResource("Doc_Select")+this.ScreenObject.ColumnSource[t].Header+" "+this.ScreenObject.GridData[e].DocSeqNo.toString(),!1;if("PactComboBox"==this.ScreenObject.ColumnSource[t].DataType&&n.e.IsEmpty(this.ScreenObject.GridData[e][this.ScreenObject.ColumnSource[t].ValueBinding+"_Key"]))return this.DisplayMessage=a.a.GetResource("Doc_Select")+this.ScreenObject.ColumnSource[t].Header+" "+this.ScreenObject.GridData[e].DocSeqNo.toString(),!1;if("LISTBOX"==this.ScreenObject.ColumnSource[t].DataType&&n.e.IsEmpty(this.ScreenObject.GridData[e][this.ScreenObject.ColumnSource[t].ValueMember]))return this.DisplayMessage=a.a.GetResource("Doc_Select")+this.ScreenObject.ColumnSource[t].Header+" "+this.ScreenObject.GridData[e].DocSeqNo.toString(),!1;if("debitamount"==this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase()||"creditamount"==this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase()){if(n.e.IsEmpty(this.ScreenObject.GridData[e].DebitAmount)&&n.e.IsEmpty(this.ScreenObject.GridData[e].CreditAmount)||!n.e.IsEmpty(this.ScreenObject.GridData[e].DebitAmount)&&0==parseFloat(this.ScreenObject.GridData[e].DebitAmount)&&!n.e.IsEmpty(this.ScreenObject.GridData[e].CreditAmount)&&0==parseFloat(this.ScreenObject.GridData[e].CreditAmount))return this.DisplayMessage=a.a.GetResource("Doc_Enter")+this.ScreenObject.ColumnSource[t].Header+" "+this.ScreenObject.GridData[e].DocSeqNo.toString(),!1}else if("LISTBOX"!=this.ScreenObject.ColumnSource[t].DataType&&"PactComboBox"!=this.ScreenObject.ColumnSource[t].DataType&&"ComboBox"!=this.ScreenObject.ColumnSource[t].DataType&&(n.e.IsEmpty(this.ScreenObject.GridData[e][this.ScreenObject.ColumnSource[t].DisplayMember])||"FLOAT"==this.ScreenObject.ColumnSource[t].DataType&&!n.e.IsEmpty(this.ScreenObject.GridData[e][this.ScreenObject.ColumnSource[t].DisplayMember])&&0==parseFloat(this.ScreenObject.GridData[e][this.ScreenObject.ColumnSource[t].DisplayMember])))return this.DisplayMessage=a.a.GetResource("Doc_Enter")+this.ScreenObject.ColumnSource[t].Header+" "+this.ScreenObject.GridData[e].DocSeqNo.toString(),!1;return!0}SaveAccountingDocument(e){this.IgnoreOnSave.Clear(),this.ButtonsEnabled&&(this.ScreenObject.DocID>0&&this.IsUserLock?this.DisplayMessage="Document is Locked":(this.ButtonsEnabled=!1,this.SaveAccountingDocument_Validate(e,!0)||(this.ButtonsEnabled=!0)))}SaveAccountingDocument_Validate(e,t){if(!(null==e||"Approve"==e.toString()||"ApproveandPrint"==e.toString()||"NoWorkFlow"==e.toString()||"NoWorkFlowprint"==e.toString()||this.ButtonRevise.Visible&&"Revise"==e.toString()||this.ButtonSave.Visible&&this.ButtonSave.Enable))return!1;if(this.ScreenObject.Preferences.ContainsKey("NoWorkflowPostedDocs")&&""!=this.ScreenObject.Preferences.NoWorkflowPostedDocs&&Object(o.j)(this.ScreenObject.Preferences.NoWorkflowPostedDocs)&&369==this.StatusID&&"Save"==e.toString()&&(e="NoWorkFlow"),0!=this.ScreenObject.RefNodeID&&429==this.StatusID)return this.DisplayMessage=a.a.GetResource("RefDocument"),!1;if(0!=this.ScreenObject.RefNodeID&&86!=this.ScreenObject.RefCCId&&73!=this.ScreenObject.RefCCId&&89!=this.ScreenObject.RefCCId&&!this.ScreenObject.IsRefLCTR&&!a.a.SessionManager.IsActionAssigned(43,"Edit Reference Documents"))return this.DisplayMessage=a.a.GetResource("RefDocument"),!1;if(this.ScreenObject.Preferences.ContainsKey("LineWisePDC")&&""!=this.ScreenObject.Preferences.LineWisePDC&&Object(o.j)(this.ScreenObject.Preferences.LineWisePDC)&&this.PDCSCleared)return this.DisplayMessage="One or more pdc converted document can not be edited",!1;if(t&&this.ScreenObject.Preferences.ContainsKey("MadatoryAttachments")&&""!=this.ScreenObject.Preferences.MadatoryAttachments&&Object(o.j)(this.ScreenObject.Preferences.MadatoryAttachments)&&(null==this.ViewAttachments||0==this.ViewAttachments.AttachmentsList.length))return this.DisplayMessage="No Attachments added.",!1;if(this.ScreenObject.IsBouncedorPdcPosted&&(!this.ScreenObject.Preferences.ContainsKey("LineWisePDC")||""==this.ScreenObject.Preferences.LineWisePDC||!Object(o.j)(this.ScreenObject.Preferences.LineWisePDC)))return this.DisplayMessage=this.ScreenObject.BouncedorPdcMessage,!1;if(439==this.StatusID)return this.DisplayMessage="Discounted PDC can not be changed",!1;Logger.InfoLog("AddEditDocumentViewModel::Entering SaveInventoryDocument");try{let s=!0;this.ScreenObject.Preferences.ContainsKey("DonotupdateAccounts")&&""!=this.ScreenObject.Preferences.DonotupdateAccounts&&(s=Object(o.j)(this.ScreenObject.Preferences.DonotupdateAccounts));let i=this.GetReserveAccount(),r=0,l=0,c=0,h=0,d=!1;if(this.FillHeaderDictionary(),t&&!this.ValidateHeaderSave())return!1;t&&this.FillCreatedByDate(e.toString());let D={message:""};if(this.ScreenObject.GenerateQuery(D,!1,this.DocumentDate,!0),""!=D.message)return this.DisplayMessage=D.message,!1;this.BodyVisible&&!this.ReadOnlyBody||this.CheckEmptyGrid();let S,b,C,p,y="",g="",O=0;y+="<DocumentXML",null!=e&&"Revise"==e&&(y+=' IsRevision="1"',y+=' ReviseReason="'+this.ReviseReason+'"'),y+=">";let I=this.GetPrimaryColName();for(let T=0;T<this.ScreenObject.GridData.length;T++){if(n.e.IsEmpty(this.ScreenObject.GridData[T][I])){if(t&&!this.ScreenObject.GridDataColumns.Contains("FieldType")){let e;for(let t=0;t<this.ScreenObject.ColumnSource.length;t++)if(e=this.ScreenObject.ColumnSource[t],e.IsVisible&&"DocSeqNo"!=e.DisplayMember&&(("INT"==e.DataType||"FLOAT"==e.DataType)&&0!=n.e.Double(this.ScreenObject.GridData[T][e.DisplayMember])||"LISTBOX"==e.DataType&&n.e.Int(this.ScreenObject.GridData[T][e.ValueMember])>0||("SELECTIONBOX"==e.DataType||"String"==e.DataType||"TextBlock"==e.DataType||"TEXT"==e.DataType)&&!n.e.IsEmpty(this.ScreenObject.GridData[T][e.DisplayMember])||("DATE"==e.DataType||"DATETIME"==e.DataType)&&!n.e.IsEmpty(this.ScreenObject.GridData[T][e.DisplayMember+"_Key"])))return this.DisplayMessage="Account not selected at row no."+this.ScreenObject.GridData[T].DocSeqNo.toString(),!1}continue}O++,g="",y+="<Row>",g+="<AccountsXML>",S="",b="",C="",p="",S+="<Transactions ",b+='<Numeric Query="',p+='<CostCenters Query="',C+='<Alpha Query="';for(let t=0;t<this.ScreenObject.ColumnSource.length;t++){let s=this.GetCurrencyID(T),c=this.GetExchRate(T);if(!(this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase().Contains("exchangerate")||this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase().Contains("currencyid")||this.ScreenObject.ColumnSource[t].CostCenterID>0&&this.ScreenObject.ColumnSource[t].DisplayMember.endsWith("Code"))){if(this.ScreenObject.ColumnSource[t].Mandatory&&!this.MandaotryValidation(T,t))return!1;if(!this.ValidateDataonSave_col_dr(this.ScreenObject.ColumnSource[t],this.ScreenObject.GridData[T]))return!1;if(this.ScreenObject.ColumnSource[t].IsColumnUserDefined){if(this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase().Contains("dccurrid")||this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase().Contains("dcexchrt"))continue;if(this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase().Contains("dcnum")){if(a.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(o.j)(a.a.SessionManager.Preferences["Use Foreign Currency"])){let e=!1,i=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&50403==e.LinkData);if(i.length>0&&this.ScreenObject.ColumnSource[t].DisplayMember==i[0].SysColumnName){let t=0,i=0;if(i=n.e.Int(a.a.SessionManager.Preferences.DimensionwiseCurrency),i>5e4&&(this.ScreenObject.Preferences.ContainsKey("UseasCrossDimension")&&"true"==this.ScreenObject.Preferences.UseasCrossDimension.toLowerCase()&&a.a.SessionManager.Preferences.ContainsKey("CrossDimension")&&""!=a.a.SessionManager.Preferences.CrossDimension.toString()&&n.e.IsNum(a.a.SessionManager.Preferences.CrossDimension)&&(t=parseInt(a.a.SessionManager.Preferences.CrossDimension)),t==i&&(e=!0,this.ScreenObject.Preferences.ContainsKey("CrossDimField")&&n.e.IsNum(this.ScreenObject.Preferences.CrossDimField)))){let e=this.ScreenObject._TextFields.find(e=>e.DBColumnID==parseInt(this.ScreenObject.Preferences.CrossDimField));e&&e instanceof m.b&&e.SelectedValue>0&&(s=this.ScreenObject.GetCurrency(e.SelectedValue,e.CCID),c=1)}}e||("-2"==this.ScreenObject.ColumnSource[t].DefaultValue?(n.e.IsEmpty(this.ScreenObject.GridData[T]["dcCurrID"+this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase().replace("dcnum","")+"_Key"])||(s=parseInt(this.ScreenObject.GridData[T]["dcCurrID"+this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase().replace("dcnum","")+"_Key"])),n.e.IsEmpty(this.ScreenObject.GridData[T]["dcExchRT"+this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase().replace("dcnum","")])||(c=parseFloat(this.ScreenObject.GridData[T]["dcExchRT"+this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase().replace("dcnum","")]))):n.e.Int(this.ScreenObject.ColumnSource[t].DefaultValue)>0&&this.ScreenObject.ColumnSource[t].CurrID>0&&(s=this.ScreenObject.ColumnSource[t].CurrID,c=this.ScreenObject.ColumnSource[t].ExhcgRt))}let e=0;n.e.IsEmpty(this.ScreenObject.GridData[T][this.ScreenObject.ColumnSource[t].DisplayMember])?b+=this.ScreenObject.ColumnSource[t].DisplayMember+"=0, ":b+=this.ScreenObject.ColumnSource[t].DisplayMember+"="+this.ScreenObject.GridData[T][this.ScreenObject.ColumnSource[t].DisplayMember].toString()+", ",e=n.e.Double(this.ScreenObject.GridData[T]["dcCalc"+this.ScreenObject.ColumnSource[t].DisplayMember]),a.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(o.j)(a.a.SessionManager.Preferences["Use Foreign Currency"])&&(b+="dcCurrID"+this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase().replace("dcnum","")+"="+s+", ",b+="dcExchRT"+this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase().replace("dcnum","")+"="+c+", ",b+="dcCalcNumFC"+this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase().replace("dcnum","")+"="+e+", "),b+="dcCalc"+this.ScreenObject.ColumnSource[t].DisplayMember.replace("dc","")+"="+e*c+", ";let h="";if(this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase().Contains("dcnum")&&!n.e.IsEmpty(this.ScreenObject.GridData[T]["dcCalc"+this.ScreenObject.ColumnSource[t].DisplayMember])&&(h=this.ScreenObject.GridData[T]["dcCalc"+this.ScreenObject.ColumnSource[t].DisplayMember].toString()),(3==this.ScreenObject.ColumnSource[t].PostingType||4==this.ScreenObject.ColumnSource[t].PostingType)&&""!=h&&n.e.IsNum(h)&&0!=parseFloat(h)){let e=0,a=0,n="",o={DBAcc:e,CrACC:a,PostingXml:n};if(!this.FillAccountPosting(this.ScreenObject.ColumnSource[t],this.ScreenObject.GridData[T],h,s,c,o,""!=i?parseInt(i):0))return!1;e=o.DBAcc,a=o.CrACC,n=o.PostingXml,16!=this.ScreenObject.DocumentType&&17!=this.ScreenObject.DocumentType&&28!=this.ScreenObject.DocumentType&&29!=this.ScreenObject.DocumentType||(a==parseInt(i)&&e>0?r+=parseFloat(h)*c:e==parseInt(i)&&a>0&&(l+=parseFloat(h)*c)),g+=n}}else if("Name"==this.ScreenObject.ColumnSource[t].DisplayMember||"Year"==this.ScreenObject.ColumnSource[t].DisplayMember||this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase().Contains("dcalpha")){let e={sbText:C};this.GetRowValue(e,T,t),C=e.sbText}else 0!=this.ScreenObject.ColumnSource[t].CostCenterID?!n.e.IsEmpty(this.ScreenObject.GridData[T][this.ScreenObject.ColumnSource[t].ValueMember])&&parseInt(this.ScreenObject.GridData[T][this.ScreenObject.ColumnSource[t].ValueMember])>0?"batchid"==this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase()?S+='BatchID="'+this.ScreenObject.GridData[T][this.ScreenObject.ColumnSource[t].ValueMember].toString()+'" ':p+=this.ScreenObject.ColumnSource[t].DisplayMember+"="+this.ScreenObject.GridData[T][this.ScreenObject.ColumnSource[t].ValueMember].toString()+", ":"batchid"==this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase()?S+='BatchID="1" ':p+=this.ScreenObject.ColumnSource[t].DisplayMember+"=1, ":C+=this.ScreenObject.ColumnSource[t].DisplayMember+"=N'"+u.d.GetValidTextXml(this.ScreenObject.GridData[T][this.ScreenObject.ColumnSource[t].DisplayMember].toString())+"', "}else if(16!=this.ScreenObject.DocumentType&&17!=this.ScreenObject.DocumentType&&28!=this.ScreenObject.DocumentType&&29!=this.ScreenObject.DocumentType||"AccountID_Key"!=this.ScreenObject.ColumnSource[t].ValueMember&&"DebitAmount"!=this.ScreenObject.ColumnSource[t].DisplayMember&&"CreditAmount"!=this.ScreenObject.ColumnSource[t].DisplayMember){if("DebitAccount_Key"==this.ScreenObject.ColumnSource[t].ValueMember||"CreditAccount_Key"==this.ScreenObject.ColumnSource[t].ValueMember)continue;if("SELECTIONBOX"==this.ScreenObject.ColumnSource[t].DataType)S+=this.ScreenObject.ColumnSource[t].DisplayMember+'="'+this.ScreenObject.GridData[T][this.ScreenObject.ColumnSource[t].DisplayMember].toString()+'" ';else if("Amount"==this.ScreenObject.ColumnSource[t].DisplayMember){let i="",a="";null!=this.ScreenObject.DebitAccount?i=this.ScreenObject.DebitAccount.SelectedValue.toString():this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[T].DebitAccount_Key)&&(i=this.ScreenObject.GridData[T].DebitAccount_Key.toString()),null!=this.ScreenObject.CreditAccount?a=this.ScreenObject.CreditAccount.SelectedValue.toString():this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[T].CreditAccount_Key)&&(a=this.ScreenObject.GridData[T].CreditAccount_Key.toString()),null!=e&&"Bounce"==e.toString()?S+=this.ScreenObject.GetAccountTransaction(a,i,this.ScreenObject.GridData[T][this.ScreenObject.ColumnSource[t].DisplayMember].toString(),s,c,this.ScreenObject.ColumnSource[t].DecimalPoints):S+=this.ScreenObject.GetAccountTransaction(i,a,this.ScreenObject.GridData[T][this.ScreenObject.ColumnSource[t].DisplayMember].toString(),s,c,this.ScreenObject.ColumnSource[t].DecimalPoints)}else 0!=this.ScreenObject.ColumnSource[t].CostCenterID?!n.e.IsEmpty(this.ScreenObject.GridData[T][this.ScreenObject.ColumnSource[t].ValueMember])&&parseInt(this.ScreenObject.GridData[T][this.ScreenObject.ColumnSource[t].ValueMember])>0&&(S+=this.ScreenObject.ColumnSource[t].DisplayMember+'="'+this.ScreenObject.GridData[T][this.ScreenObject.ColumnSource[t].ValueMember].toString()+'" '):"DATE"==this.ScreenObject.ColumnSource[t].DataType?n.e.IsEmpty(this.ScreenObject.GridData[T][this.ScreenObject.ColumnSource[t].DisplayMember+"_Key"])||(S+=this.ScreenObject.ColumnSource[t].DisplayMember+'="'+new Date(this.ScreenObject.GridData[T][this.ScreenObject.ColumnSource[t].DisplayMember+"_Key"]).ToString("dd/MMM/yyyy")+'" '):"datetime"==this.ScreenObject.ColumnSource[t].DataType.toLowerCase()||"time"==this.ScreenObject.ColumnSource[t].DataType.toLowerCase()?n.e.IsEmpty(this.ScreenObject.GridData[T][this.ScreenObject.ColumnSource[t].DisplayMember+"_Key"])||(S+=this.ScreenObject.ColumnSource[t].DisplayMember+'="'+new Date(this.ScreenObject.GridData[T][this.ScreenObject.ColumnSource[t].DisplayMember+"_Key"]).ToString("dd/MMM/yyyy hh:mm:ss a")+'" '):"ComboBox"==this.ScreenObject.ColumnSource[t].DataType?n.e.IsEmpty(this.ScreenObject.GridData[T][this.ScreenObject.ColumnSource[t].ValueBinding])||(S+=this.ScreenObject.ColumnSource[t].ValueBinding+'="'+this.ScreenObject.GridData[T][this.ScreenObject.ColumnSource[t].ValueBinding].toString()+'" '):"DocSeqNo"==this.ScreenObject.ColumnSource[t].DisplayMember?S+='DocSeqNo="'+O+'" ':null!=e&&"Bounce"==e.toString()?S+=this.ScreenObject.ColumnSource[t].DisplayMember+'="0" ':S+=this.ScreenObject.ColumnSource[t].DisplayMember+'="'+u.d.GetValidXml(this.ScreenObject.GridData[T][this.ScreenObject.ColumnSource[t].DisplayMember])+'" '}else{if("AccountID_Key"==this.ScreenObject.ColumnSource[t].ValueMember){if(n.e.IsEmpty(this.ScreenObject.GridData[T].AccountID_Key))return this.DisplayMessage=this.ScreenObject.DebitAccount.Label+"Required",!1;continue}n.e.IsEmpty(this.ScreenObject.GridData[T][this.ScreenObject.ColumnSource[t].DisplayMember])||"CreditAmount"!=this.ScreenObject.ColumnSource[t].DisplayMember||0==parseFloat(this.ScreenObject.GridData[T][this.ScreenObject.ColumnSource[t].DisplayMember])?n.e.IsEmpty(this.ScreenObject.GridData[T][this.ScreenObject.ColumnSource[t].DisplayMember])||"DebitAmount"!=this.ScreenObject.ColumnSource[t].DisplayMember||0==parseFloat(this.ScreenObject.GridData[T][this.ScreenObject.ColumnSource[t].DisplayMember])||(S+=this.ScreenObject.GetAccountTransaction(this.ScreenObject.GridData[T].AccountID_Key.toString(),i,this.ScreenObject.GridData[T][this.ScreenObject.ColumnSource[t].DisplayMember].toString(),s,c,this.ScreenObject.ColumnSource[t].DecimalPoints),r+=parseFloat(this.ScreenObject.GridData[T][this.ScreenObject.ColumnSource[t].DisplayMember])*c):(S+=this.ScreenObject.GetAccountTransaction(i,this.ScreenObject.GridData[T].AccountID_Key.toString(),this.ScreenObject.GridData[T][this.ScreenObject.ColumnSource[t].DisplayMember].toString(),s,c,this.ScreenObject.ColumnSource[t].DecimalPoints),l+=parseFloat(this.ScreenObject.GridData[T][this.ScreenObject.ColumnSource[t].DisplayMember])*c)}}}if(this.IsLockDimsLineWise){let e={join:""};S+=' LockDims="'+this.GetLockQuery(this.ScreenObject.GridData[T],e)+'" ',""!=e.join&&(S+=' LockDimsjoin="'+e.join+'" ')}if(null!=this.GetButton("Pre Payments")&&null!=this.pdcGCVM&&this.pdcGCVM.IsDataSaved&&1==O){if(!this.pdcGCVM.Validate(this.ScreenObject.GridData[T].Amount.toString()))return!1;S+=' Description="'+this.pdcGCVM.GetXML()+'" '}this.ScreenObject.GridDataColumns.Contains("oppdc")&&!n.e.IsEmpty(this.ScreenObject.GridData[T].oppdc)&&(S+=' PostPDC="1" '),this.ScreenObject.GridDataColumns.Contains("FieldType")&&(b+=this.GetpayModesNumericData(T)),S+=this.ScreenObject.strStaticFields+" ></Transactions>",b+=this.ScreenObject.strnumericFields+'" ></Numeric>',C+=this.ScreenObject.strTextFields+'" ></Alpha>',!a.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")||"True"!=a.a.SessionManager.Preferences.EnableDivisionWise.toString()||p.toString().Contains("dcCCNID1=")||this.ScreenObject.strCCFields.Contains("dcCCNID1=")||(this.ScreenObject.DivisionID>0?p+=" dcCCNID1="+this.ScreenObject.DivisionID.toString()+", ":a.a.SessionManager.DivisionID>0&&(p+=" dcCCNID1="+a.a.SessionManager.DivisionID.toString()+", ")),!a.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")||"True"!=a.a.SessionManager.Preferences.EnableLocationWise.toString()||p.toString().Contains("dcCCNID2=")||this.ScreenObject.strCCFields.Contains("dcCCNID2=")||(this.ScreenObject.LocationID>0?p+=" dcCCNID2="+this.ScreenObject.LocationID.toString()+", ":a.a.SessionManager.LocationID>0&&(p+=" dcCCNID2="+a.a.SessionManager.LocationID.toString()+", ")),a.a.SessionManager.Preferences.ContainsKey("Dimension List")&&a.a.SessionManager.RegisterCCID>0&&this.ScreenObject.RegisterNodeID>0&&!p.toString().Contains("dcCCNID"+(a.a.SessionManager.RegisterCCID-5e4).toString()+"=")&&!this.ScreenObject.strCCFields.Contains("dcCCNID"+(a.a.SessionManager.RegisterCCID-5e4).toString()+"=")&&this.ScreenObject.RegisterNodeID>0&&(p+=" dcCCNID"+(a.a.SessionManager.RegisterCCID-5e4).toString()+"="+this.ScreenObject.RegisterNodeID.toString()+", "),p+=this.ScreenObject.strCCFields+'" ></CostCenters>',g+="</AccountsXML>",c=0,h=0;let s=!1;if(this.ScreenObject.Preferences.ContainsKey("LineWisePDC")&&Object(o.j)(this.ScreenObject.Preferences.LineWisePDC)&&this.ScreenObject.GridDataColumns.Contains("RefStatusID")&&!n.e.IsEmpty(this.ScreenObject.GridData[T].RefStatusID)&&370!=parseInt(this.ScreenObject.GridData[T].RefStatusID)&&!n.e.IsEmpty(this.ScreenObject.GridData[T].DocDetailsID)&&parseInt(this.ScreenObject.GridData[T].DocDetailsID)>0&&(s=!0),a.a.SessionManager.Preferences.ContainsKey("On")&&"True"!=a.a.SessionManager.Preferences.On&&(s=!0),n.e.IsEmpty(this.ScreenObject.GridData[T].Type)||1!=Object(o.j)(this.ScreenObject.GridData[T].Type)||s)this.ScreenObject.GridData[T].ExtraXML="";else{let e="";if(this.ScreenObject.GridDataColumns.Contains("Amount")&&(e="Amount"),18==this.ScreenObject.DocumentType||19==this.ScreenObject.DocumentType||21==this.ScreenObject.DocumentType||22==this.ScreenObject.DocumentType?this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[T].CreditAccount_Key)&&(h=parseInt(this.ScreenObject.GridData[T].CreditAccount_Key),d=!0):14==this.ScreenObject.DocumentType||15==this.ScreenObject.DocumentType||20==this.ScreenObject.DocumentType||23==this.ScreenObject.DocumentType?this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[T].DebitAccount_Key)&&(h=parseInt(this.ScreenObject.GridData[T].DebitAccount_Key),d=!1):this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[T].AccountID_Key)&&(h=parseInt(this.ScreenObject.GridData[T].AccountID_Key),this.ScreenObject.GridDataColumns.Contains("CreditAmount")&&!n.e.IsEmpty(this.ScreenObject.GridData[T].CreditAmount)&&parseFloat(this.ScreenObject.GridData[T].CreditAmount)>0&&(d=!0,e="CreditAmount"),this.ScreenObject.GridDataColumns.Contains("DebitAmount")&&!n.e.IsEmpty(this.ScreenObject.GridData[T].DebitAmount)&&parseFloat(this.ScreenObject.GridData[T].DebitAmount)>0&&(e="DebitAmount",d=!1)),""!=e&&0!=n.e.Double(this.ScreenObject.GridData[T][e])){parseFloat(this.ScreenObject.GridData[T][e])<0&&(d=!d);let t=new n.f;n.e.IsEmpty(this.ScreenObject.GridData[T].ExtraXML)||t.LoadXml(this.ScreenObject.GridData[T].ExtraXML);let s=t.SelectNodes("/BillWise/Row"),i=0,r=!1;for(let e=0;e<s.length;e++){if(""==s[e].attributes.AccountID.value||""!=s[e].attributes.AccountID.value&&parseInt(s[e].attributes.AccountID.value)!=h)return this.DisplayMessage="Invalid BillWise Details at Row No."+this.ScreenObject.GridData[T].DocSeqNo.toString(),!1;""!=s[e].attributes.AdjAmount.value&&(i+=parseFloat(s[e].attributes.AdjAmount.value.replace("-",""))),s[e].attributes.AdjAmount.value.Contains("-")&&(r=!0)}if(s=t.SelectNodes("BillWise/Row/AccountsXML"),null!=s)for(let e=0;e<s.length;e++)null!=s[e].attributes.Amount&&""!=s[e].attributes.Amount.value&&(d&&null!=s[e].attributes.DebitAccount&&""!=s[e].attributes.DebitAccount.value&&parseInt(s[e].attributes.DebitAccount.value)==h||!d&&null!=s[e].attributes.CreditAccount&&""!=s[e].attributes.CreditAccount.value&&parseInt(s[e].attributes.CreditAccount.value)==h?i+=parseFloat(s[e].attributes.Amount.value.replace("-","")):i-=parseFloat(s[e].attributes.Amount.value.replace("-","")));t.LoadXml(g),s=t.SelectNodes("AccountsXML/Accounts");let o=this.GetExchRate(T);c=this.ScreenObject.Preferences.ContainsKey("DecimalsBillWise")&&""!=this.ScreenObject.Preferences.DecimalsBillWise&&n.e.Int(this.ScreenObject.Preferences.DecimalsBillWise)>0?parseFloat((parseFloat(this.ScreenObject.GridData[T][e].toString().replace("-",""))*o).ToString("N"+this.ScreenObject.Preferences.DecimalsBillWise)):a.a.SessionManager.Preferences.ContainsKey("DecimalsinAmount")?parseFloat((parseFloat(this.ScreenObject.GridData[T][e].toString().replace("-",""))*o).ToString("N"+a.a.SessionManager.Preferences.DecimalsinAmount)):parseFloat(this.ScreenObject.GridData[T][e].toString().replace("-",""))*o;for(let e=0;e<s.length;e++)null!=s[e].attributes.DebitAccount&&""!=s[e].attributes.DebitAccount.value&&parseInt(s[e].attributes.DebitAccount.value)==h&&null!=s[e].attributes.Amount&&""!=s[e].attributes.Amount.value?d?c-=parseFloat(s[e].attributes.Amount.value):c+=parseFloat(s[e].attributes.Amount.value):null!=s[e].attributes.CreditAccount&&""!=s[e].attributes.CreditAccount.value&&parseInt(s[e].attributes.CreditAccount.value)==h&&null!=s[e].attributes.Amount&&""!=s[e].attributes.Amount.value&&(d?c+=parseFloat(s[e].attributes.Amount.value):c-=parseFloat(s[e].attributes.Amount.value));if(!n.e.IsEmpty(this.ScreenObject.GridData[T][e])&&Math.abs(c-i)>.5)return this.DisplayMessage=a.a.GetResource("Doc_BillWiseMisMatch")+" "+this.ScreenObject.GridData[T].DocSeqNo.toString(),!1;if(d&&!r||!d&&r)return this.DisplayMessage=a.a.GetResource("Doc_BillWiseMisMatch")+" "+this.ScreenObject.GridData[T].DocSeqNo.toString(),!1}}if(18==this.ScreenObject.DocumentType||19==this.ScreenObject.DocumentType||21==this.ScreenObject.DocumentType||22==this.ScreenObject.DocumentType){if(null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.SelectedValue>0){if(this.CheckAccountBalance(this.ScreenObject.DebitAccount.SelectedValue,this.GridNetTotal,!1))return!1}else if(this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[T].DebitAccount_Key)){let e=new n.f;e.LoadXml(g);let t=e.SelectNodes("AccountsXML/Accounts");c=parseFloat(this.ScreenObject.GridData[T].Amount)*this.GetExchRate(T);for(let s=0;s<t.length;s++)null!=t[s].attributes.DebitAccount&&""!=t[s].attributes.DebitAccount.value&&parseInt(t[s].attributes.DebitAccount.value)==parseInt(this.ScreenObject.GridData[T].DebitAccount_Key)&&null!=t[s].attributes.Amount&&""!=t[s].attributes.Amount.value?c+=parseFloat(t[s].attributes.Amount.value):null!=t[s].attributes.CreditAccount&&""!=t[s].attributes.CreditAccount.value&&parseInt(t[s].attributes.CreditAccount.value)==parseInt(this.ScreenObject.GridData[T].DebitAccount_Key)&&null!=t[s].attributes.Amount&&""!=t[s].attributes.Amount.value&&(c-=parseFloat(t[s].attributes.Amount.value));if(this.CheckAccountBalance(parseInt(this.ScreenObject.GridData[T].DebitAccount_Key),c,!1))return null!=this.DisplayMessage&&""!=this.DisplayMessage||(this.DisplayMessage="Balance goes -ve for "+this.ScreenObject.GridData[T].CreditAccount.toString()+"at row no:"+this.ScreenObject.GridData[T].DocSeqNo.toString()),!1}}else if(14==this.ScreenObject.DocumentType||15==this.ScreenObject.DocumentType||20==this.ScreenObject.DocumentType||23==this.ScreenObject.DocumentType){if(null!=this.ScreenObject.CreditAccount&&this.ScreenObject.CreditAccount.SelectedValue>0){if(this.DisplayMessage="",this.CheckAccountBalance(this.ScreenObject.CreditAccount.SelectedValue,this.GridNetTotal,!0))return""==this.DisplayMessage&&(this.DisplayMessage="Balance goes -ve for ",this.DisplayMessage+=""!=this.ScreenObject.CreditAccount.Text?this.ScreenObject.CreditAccount.Text:"pament mode"),!1}else if(this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[T].CreditAccount_Key)){let e=new n.f;e.LoadXml(g);let t=e.SelectNodes("AccountsXML/Accounts");c=parseFloat(this.ScreenObject.GridData[T].Amount)*this.GetExchRate(T);for(let s=0;s<t.length;s++)null!=t[s].attributes.CreditAccount&&""!=t[s].attributes.CreditAccount.value&&parseInt(t[s].attributes.CreditAccount.value)==parseInt(this.ScreenObject.GridData[T].CreditAccount_Key)&&null!=t[s].attributes.Amount&&""!=t[s].attributes.Amount.value?c+=parseFloat(t[s].attributes.Amount.value):null!=t[s].attributes.DebitAccount&&""!=t[s].attributes.DebitAccount.value&&parseInt(t[s].attributes.DebitAccount.value)==parseInt(this.ScreenObject.GridData[T].CreditAccount_Key)&&null!=t[s].attributes.Amount&&""!=t[s].attributes.Amount.value&&(c-=parseFloat(t[s].attributes.Amount.value));if(this.CheckAccountBalance(parseInt(this.ScreenObject.GridData[T].CreditAccount_Key),c,!0))return null!=this.DisplayMessage&&""!=this.DisplayMessage||(this.DisplayMessage="Balance goes -ve for "+this.ScreenObject.GridData[T].CreditAccount.toString()+"at row no:"+this.ScreenObject.GridData[T].DocSeqNo.toString()),!1}}else if(a.a.SessionManager.Preferences.ContainsKey("DontSaveCahsBankBalanceNegative")&&""!=a.a.SessionManager.Preferences.DontSaveCahsBankBalanceNegative&&Object(o.j)(a.a.SessionManager.Preferences.DontSaveCahsBankBalanceNegative)&&this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[T].AccountID_Key))if(this.ScreenObject.GridDataColumns.Contains("DebitAmount")&&!n.e.IsEmpty(this.ScreenObject.GridData[T].DebitAmount)&&parseFloat(this.ScreenObject.GridData[T].DebitAmount)>0){if(this.CheckAccountBalance(parseInt(this.ScreenObject.GridData[T].AccountID_Key),parseFloat(this.ScreenObject.GridData[T].DebitAmount),!1))return null!=this.DisplayMessage&&""!=this.DisplayMessage||!this.ScreenObject.GridDataColumns.Contains("AccountName")?null!=this.DisplayMessage&&""!=this.DisplayMessage||!this.ScreenObject.GridDataColumns.Contains("Accountcode")||(this.DisplayMessage="Balance goes -ve for "+this.ScreenObject.GridData[T].Accountcode.toString()+"at row no:"+this.ScreenObject.GridData[T].DocSeqNo.toString()):this.DisplayMessage="Balance goes -ve for "+this.ScreenObject.GridData[T].AccountName.toString()+"at row no:"+this.ScreenObject.GridData[T].DocSeqNo.toString(),!1}else if(this.ScreenObject.GridDataColumns.Contains("CreditAmount")&&!n.e.IsEmpty(this.ScreenObject.GridData[T].CreditAmount)&&parseFloat(this.ScreenObject.GridData[T].CreditAmount)>0&&this.CheckAccountBalance(parseInt(this.ScreenObject.GridData[T].AccountID_Key),parseFloat(this.ScreenObject.GridData[T].CreditAmount),!0))return null!=this.DisplayMessage&&""!=this.DisplayMessage||!this.ScreenObject.GridDataColumns.Contains("AccountName")?null!=this.DisplayMessage&&""!=this.DisplayMessage||!this.ScreenObject.GridDataColumns.Contains("Accountcode")||(this.DisplayMessage="Balance goes -ve for "+this.ScreenObject.GridData[T].Accountcode.toString()+"at row no:"+this.ScreenObject.GridData[T].DocSeqNo.toString()):this.DisplayMessage="Balance goes -ve for "+this.ScreenObject.GridData[T].AccountName.toString()+"at row no:"+this.ScreenObject.GridData[T].DocSeqNo.toString(),!1;if(y+=g.toString(),null!=e&&"Bounce"==e.toString())18==this.ScreenObject.DocumentType&&this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[T].CreditAccount_Key)?this.IsAccBillWise(parseInt(this.ScreenObject.GridData[T].CreditAccount_Key))?y+=S.toString()+b.toString()+C.toString()+p.toString()+"<EXTRAXML>"+this.BillXMLBounce(this.ScreenObject.GridData[T].CreditAccount_Key.toString(),this.ScreenObject.GridData[T].Amount.toString(),!1)+"</EXTRAXML>":y+=S.toString()+b.toString()+C.toString()+p.toString()+"<EXTRAXML> </EXTRAXML>":15==this.ScreenObject.DocumentType&&this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[T].DebitAccount_Key)&&this.IsAccBillWise(parseInt(this.ScreenObject.GridData[T].DebitAccount_Key))?y+=S.toString()+b.toString()+C.toString()+p.toString()+"<EXTRAXML>"+this.BillXMLBounce(this.ScreenObject.GridData[T].DebitAccount_Key.toString(),this.ScreenObject.GridData[T].Amount.toString(),!0)+"</EXTRAXML>":y+=S.toString()+b.toString()+C.toString()+p.toString()+"<EXTRAXML> </EXTRAXML>";else if(y+=S.toString()+b.toString()+C.toString()+p.toString()+"<EXTRAXML>"+this.ScreenObject.GridData[T].ExtraXML.toString()+"</EXTRAXML>",n.e.IsEmpty(this.ScreenObject.GridData[T].DiscXML)||(y+=this.ScreenObject.GridData[T].DiscXML.toString()),n.e.IsEmpty(this.ScreenObject.GridData[T].ReturnXML)||(y+="<ReturnXML>"+this.ScreenObject.GridData[T].ReturnXML.toString()+"</ReturnXML>"),this.ScreenObject.GridDataColumns.Contains("DenominationsXML")&&!n.e.IsEmpty(this.ScreenObject.GridData[T].DenominationsXML)&&(y+="<PosPayModes>"+this.ScreenObject.GridData[T].DenominationsXML.toString()+"</PosPayModes>"),null!=this.GetButton("Pre Payments")&&this.pdcGCVM&&this.pdcGCVM.IsDataSaved&&1==O){if(this.ScreenObject.Preferences.ContainsKey("Prepaymentdate")&&"True"==this.ScreenObject.Preferences.Prepaymentdate&&this.pdcGCVM.CheqStartDate.Date<this.DocumentDate)return this.DisplayMessage="Pre Payments Start date can not be less than document date.",this.MessageVisibility=!0,!1;y+=this.pdcGCVM.GenerateChequeNos()}y+="</Row>"}if(y+="</DocumentXML>",0==O)return this.DisplayMessage=a.a.GetResource("Doc_BlankData"),!1;if(17==this.ScreenObject.DocumentType||28==this.ScreenObject.DocumentType||29==this.ScreenObject.DocumentType){let e=this.ScreenObject.ColumnSource.find(e=>"creditamount"==e.DisplayMember.toLowerCase());if(e&&!n.e.IsEmpty(e.DecimalPoints)){if(l.ToString("N"+e.DecimalPoints)!=r.ToString("N"+e.DecimalPoints))return this.DisplayMessage=a.a.GetResource("DebitCreditarenotEqual"),!1}else if(l!=r)return this.DisplayMessage=a.a.GetResource("DebitCreditarenotEqual"),!1}if(this.ScreenObject.IsRefLCTR){let e=this.ScreenObject.GridData.Compute("sum","Amount");if(null!=e&&parseFloat(e)>this.LCDueAmt)return this.DisplayMessage="Can not pay more than due",!1}let f=!1;if(this.DisplayMessage="",this.BudgetValidation(y.toString()),null!=this.DisplayMessage&&this.DisplayMessage.length>0){if("true"!=a.a.SessionManager.Preferences.GBudgetUnapprove.toLowerCase()||" "==this.DisplayMessage)return!1;this.DisplayMessage="",f=!0}if(this.IsAutoPost)return this.DisplayMessage="",this.AutoPOstXML=y.toString(),a.a.page.HideDialog(),!1;if(null!=e&&"Bounce"==e.toString()){if(this.ScreenObject.Data.Tables.length>3&&this.ScreenObject.Data.Tables[3].length>0){if(!(n.e.Double(this.ScreenObject.Data.Tables[3][0].Bounce)>0))return this.DisplayMessage=" Please set 'Bounce' for this Document ",!1;this.Bounce&&this.Bounce.TerminationDate&&this.Bounce.TerminationDate.Date&&(this.DocumentDate=this.Bounce.TerminationDate.Date),this.ScreenObject.PostAccountingDocument(y.toString(),this.ViewNotes?this.ViewNotes.GetXML():"",null!=this.ViewAttachments?this.ViewAttachments.GetXML():"",this.DocumentDate,this.GetWorkFlow(!1,null),this.ScreenObject.Data.Tables[3][0].Bounce.toString()).subscribe(e=>{this.DisplayMessage=e.Message,this.ScreenObject.DocID=e.RetValue,this.RetValue>0&&(this.ScreenObject.DocID=this.RetValue,this.ScreenObject.DraftID>0&&(a.a.document.DeleteDocumentDraft(this.ScreenObject.DraftID),this.ScreenObject.DraftID=0)),Logger.InfoLog("VoucherGenerator:: Exiting SaveDocument")},e=>{console.log(e),this.DisplayMessage="Error in save"}),this.ButtonSave.Visible=!1,this.ButtonsEnabled=!0}}else{let t=[];t.push(y),t.push(f.toString()),n.e.IsEmpty(e.toString())||(this.commandprarameter=e.toString());let s=this.GetWorkFlow(!1,null);if(t.push(s.toString()),s>0&&this.ScreenObject.Preferences.ContainsKey("L1Remarks")&&"True"==this.ScreenObject.Preferences.L1Remarks&&("Save"==e.toString()||"SaveAndPrint"==e.toString())&&(a.a.page.ShowDialog(new W.a(this,2),H.a),n.e.IsEmpty(this.ReviseReason)||t.push(' L1Remarks="'+this.ReviseReason+'"')),"ReSave"!=e.toString())return this.AccountingSave_DoWork(null,t),!0;this.AccountingSave_DoWork(null,t),this.SaveComplete(!1),Logger.InfoLog("AddEditDocumentViewModel::Exiting OnSaveAccount")}Logger.InfoLog("AddEditDocumentViewModel::Exiting SaveAccountingDocument")}catch(s){return this.DisplayMessage="Error in Save.",Logger.ErrorLog("AddEditDocumentViewModel:: SaveAccountingDocument"+s.stack),!1}return!0}IsAccBillWise(e){if(a.a.SessionManager.Preferences.ContainsKey("On")&&"True"==a.a.SessionManager.Preferences.On){let t=a.a.document.IsBillWiseAccount(e);if(null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&Object(o.j)(t.Tables[0][0].IsBillwise))return!0}return!1}BillXMLBounce(e,t,s){let i=1,a=1;null==this.Currency||n.e.IsEmpty(this.Currency.Currency.SelectedValue)||(i=parseInt(this.Currency.Currency.SelectedValue)),null==this.Currency||n.e.IsEmpty(this.Currency.ExchangeRate.Text)||(a=parseFloat(this.Currency.ExchangeRate.Text));let r="";return r+="<BillWise><Row ",r+='DocSeqNo="1" ',r+='AccountID="'+e+'" ',s?(r+='AmountFC="-'+t+'" ',r+='AdjAmount="-'+parseFloat(t)*a+'" '):(r+='AmountFC="'+t+'" ',r+='AdjAmount="'+parseFloat(t)*a+'" '),r+='AdjCurrID="'+i.toString()+'" ',r+='AdjExchRT="'+a.toString()+'" ',r+='IsNewReference="1" ',r+='Narration="" ',r+='IsDocPDC="0" ',r+=" ></Row></BillWise>",r}OnDocPrefixChanged(e){(null==this.ScreenObject||null==e||"lostFocus"!=e.toString()||this.ConfirmDirtyRead())&&(this.OnDocPrefixChanged_2(e,!1),null==this.ScreenObject||null==e||"lostFocus"!=e.toString()||this.ScreenObject.IsDocEdit?null==e||"lostFocus"==e.toString()||this.isFromDate||this.clear(3):this.clear(4))}OnDocPrefixChanged_2(e,t=!1){if(null!=this.ScreenObject){if(Logger.InfoLog("AddEditDocumentViewModel::Entering OnDocPrefixChanged"),null!=e)try{let s={value:this._Ddate};this.ScreenObject.OnDocPrefixChanged(e,0,0,s,t,this.isFromDate?this.ScheduleID:0),this._Ddate=s.value}catch(s){this.DisplayMessage="Error Loading document try again",Logger.ErrorLog("Addeditdocumentviewmodel","OnDocPrefixChanged",s.stack)}Logger.InfoLog("AddEditDocumentViewModel::Exiting OnDocPrefixChanged")}}OnGridSelectionChanged(e){let t=e.column.DgCol,s=t.DisplayMember;if("LISTBOX"==t.DataType&&(s=t.ValueMember),Logger.InfoLog("AddEditDocumentViewModel::Entering OnGridSelectionChanged"),"LISTBOX"==t.DataType&&2==t.CostCenterID)try{let t=0;if(this.ScreenObject.GridDataColumns.Contains(s)&&(n.e.IsEmpty(this.SelectedRow[s])||(t=parseInt(this.SelectedRow[s]))),2==this.ccid&&this.PrAccID==t||(this.t.Enabled=!1,this.ccid=2,this.PrAccID=t,this.t.Enabled=!0),!this.IsInventoryVoucher&&(this.ReportDimension.SelectedValue=t,this.ReportDimension.SelectedValue>0)){let t=a.a.SessionManager.ListViewDef.Tables[0].filter(e=>e.CostCenterID==this.ReportDimension.CCID&&e.ListViewTypeID==this.ReportDimension.TypeID);t.length>0&&("accountcode"==t[0].SysColumnName.toLowerCase()&&n.e.hasprop(e.item,"AccountCode")?this.ReportDimension.SelectedValueText=this.SelectedRow.AccountCode.toString():"accountname"==t[0].SysColumnName.toLowerCase()&&n.e.hasprop(e.item,"AccountName")&&(this.ReportDimension.SelectedValueText=this.SelectedRow.AccountName.toString()))}}catch(i){}else if("LISTBOX"==t.DataType&&3==t.CostCenterID)try{let t=0;if((this.ScreenObject.Preferences.ContainsKey("ShowProductImage")&&""!=this.ScreenObject.Preferences.ShowProductImage&&Object(o.j)(this.ScreenObject.Preferences.ShowProductImage)||this.ProductImageVisibility)&&this.ShowProductImage(e.item),this.ScreenObject.GridDataColumns.Contains(s)&&(n.e.IsEmpty(this.SelectedRow[s])||(t=parseInt(this.SelectedRow[s]))),3==this.ccid&&this.PrAccID==t||(this.t.Enabled=!1,this.ccid=3,this.PrAccID=t,this.t.Enabled=!0),this.IsInventoryVoucher&&(this.ReportDimension.SelectedValue=t,this.ReportDimension.SelectedValue>0)){let t=a.a.SessionManager.ListViewDef.Tables[0].filter(e=>e.CostCenterID==this.ReportDimension.CCID&&e.ListViewTypeID==this.ReportDimension.TypeID);t.length>0&&("productcode"==t[0].SysColumnName.toLowerCase()&&n.e.hasprop(e.item,"ProductCode")?this.ReportDimension.SelectedValueText=this.SelectedRow.ProductCode.toString():"productname"==t[0].SysColumnName.toLowerCase()&&n.e.hasprop(e.item,"ProductName")&&(this.ReportDimension.SelectedValueText=this.SelectedRow.ProductName.toString()))}}catch(r){}else if(null!=t&&"LISTBOX"==t.DataType&&t.CostCenterID>=50001)try{if(this.ScreenObject.Preferences.ContainsKey("QuickViewDimensions")&&""!=this.ScreenObject.Preferences.QuickViewDimensions&&this.ScreenObject.Preferences.QuickViewDimensions.toString().Contains(t.CostCenterID.toString())){let e=0;this.ScreenObject.GridDataColumns.Contains(s)&&(n.e.IsEmpty(this.SelectedRow[s])||(e=parseInt(this.SelectedRow[s]))),this.ccid==t.CostCenterID&&this.PrAccID==e||(this.t.Enabled=!1,this.ccid=t.CostCenterID,this.PrAccID=e,this.t.Enabled=!0)}}catch(l){}else null!=this.SelectedRow&&(this.IsInventoryVoucher&&!n.e.IsEmpty(this.SelectedRow.ProductID_Key)&&parseInt(this.SelectedRow.ProductID_Key)>0?this.ReportDimension.SelectedValue=parseInt(this.SelectedRow.ProductID_Key):!this.IsInventoryVoucher&&!n.e.IsEmpty(this.SelectedRow.DebitAccount_Key)&&parseInt(this.SelectedRow.DebitAccount_Key)>0?this.ReportDimension.SelectedValue=parseInt(this.SelectedRow.DebitAccount_Key):!this.IsInventoryVoucher&&!n.e.IsEmpty(this.SelectedRow.CreditAccount_Key)&&parseInt(this.SelectedRow.CreditAccount_Key)>0?this.ReportDimension.SelectedValue=parseInt(this.SelectedRow.CreditAccount_Key):!this.IsInventoryVoucher&&!n.e.IsEmpty(this.SelectedRow.AccountID_Key)&&parseInt(this.SelectedRow.AccountID_Key)>0&&(this.ReportDimension.SelectedValue=parseInt(this.SelectedRow.AccountID_Key)));Logger.InfoLog("AddEditDocumentViewModel::Exiting OnGridSelectionChanged")}t_Tick(){(2==this.ccid||3==this.ccid||this.ccid>=50001)&&this.PrAccID>0&&this.ShowQuickView(this.ccid,this.PrAccID,null!=this.SelectedRow?this.SelectedRow:null,null)}ShowQuickViewCallBack(e){this.ShowQuickView(e.CCID,e.NodeID,e.datarow,e.ctrl)}ShowQuickView(e,t,s,i){if(0==e&&null!=i)return this.ScreenObject._CCFields.forEach(e=>{e instanceof m.b&&(e.SelectedValue>0&&!n.e.IsEmpty(e.Text)?this.fldDict[e.Lbl].setFieldValue(e.Text):this.fldDict[e.Lbl].setFieldValue(""))}),this.ScreenObject._TextFields.forEach(e=>{this.fldDict.ContainsKey(e.Lbl)&&(e instanceof u.d?"FLOAT"==e.DataType?null!=e.Text&&""!=e.Text&&""==e.ValidateData()?this.fldDict[e.Lbl].setFieldValue(e.Text):this.fldDict[e.Lbl].setFieldValue(0):this.fldDict[e.Lbl].setFieldValue(e.Text):e instanceof D.e?this.fldDict[e.Lbl].setFieldValue(e.SelectedValue):e instanceof g.a?this.fldDict[e.Lbl].setFieldValue(e.Text):e instanceof m.b&&(e.SelectedValue>0&&!n.e.IsEmpty(e.Text)?this.fldDict[e.Lbl].setFieldValue(e.Text):this.fldDict[e.Lbl].setFieldValue("")))}),void this.ValidateData(i);let a=this.QuickInfoVisibility,r=this.DQuickInfoVisibility;if(this.t.Enabled=!1,t<=0)return this.SetVisibiltiFalse(),void(this.IsPOs?this.ProductSearchVisibility=!0:this.SetDefaultRightPanel());if(this.SetVisibiltiFalse(),this.IsPOs||this.SetDefaultRightPanel(),this.IgnoreQuickViews.Contains(e))return this.QuickInfoVisibility=!1,void(this.DQuickInfoVisibility=!1);let o=null;if(2==e)this.QuickInfoView||(this.QuickInfoView=new P.a),o=this.QuickInfoView.QuickViewScreenViewModel_3(e,t,this.CostCenterID,this.DocumentDate,0,"");else if(3==e){let i=0,a=this.ScreenObject.DocumentType;null!=this.ScreenObject.CreditAccount&&this.ScreenObject.CreditAccount.SelectedValue>0&&(1==this.DocumentType||2==a||10==a||26==a||27==a||3==a||4==a||25==a||13==a)?i=this.ScreenObject.CreditAccount.SelectedValue:null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.SelectedValue>0&&(11==this.DocumentType||6==a||7==a||8==a||9==a||12==a||24==a)&&(i=this.ScreenObject.DebitAccount.SelectedValue);let r="<XML>";this.ScreenObject._CCFields.forEach(e=>{e instanceof m.b&&e.DBColumnName.Contains("TO")&&5==a||e instanceof m.b&&e.SelectedValue>0&&(r+='<Row CostCenterID="'+e.CCID+'" NODEID="'+e.SelectedValue.toString()+'" />')}),null!=s&&this.ScreenObject.ColumnSource.forEach(e=>{e.CostCenterID>5e4&&this.ScreenObject.GridDataColumns.Contains(e.ValueMember)&&(n.e.IsEmpty(s[e.ValueMember])?n.e.IsEmpty(s[e.DisplayMember])||(r+='<Row CostCenterID="'+e.CostCenterID+'" NODEID="'+s[e.DisplayMember].toString()+'" />'):r+='<Row CostCenterID="'+e.CostCenterID+'" NODEID="'+s[e.ValueMember].toString()+'" />')}),(1==a||2==a||10==a||26==a||27==a||3==a||4==a||25==a||13==a)&&null!=this.ScreenObject.CreditAccount&&this.ScreenObject.CreditAccount.SelectedValue>0?r+='<Row CostCenterID="2" NODEID="'+this.ScreenObject.CreditAccount.SelectedValue.toString()+'" />':(11==a||6==a||7==a||8==a||9==a||12==a||24==a)&&null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.SelectedValue>0&&(r+='<Row CostCenterID="2" NODEID="'+this.ScreenObject.DebitAccount.SelectedValue.toString()+'" />'),r+="</XML>",this.QuickInfoView||(this.QuickInfoView=new P.a),o=this.QuickInfoView.QuickViewScreenViewModel_3(e,t,this.CostCenterID,this.DocumentDate,i,r.toString())}else e>=50001?(this.DQuickInfoView||(this.DQuickInfoView=new P.a),o=this.DQuickInfoView.QuickViewScreenViewModel_3(e,t,this.CostCenterID,this.DocumentDate,0,"")):(this.QuickInfoView||(this.QuickInfoView=new P.a),o=this.QuickInfoView.QuickViewScreenViewModel_3(e,t,e,this.DocumentDate,0,""));o&&o.then(()=>{e>=50001?(this.DQuickInfoVisibility=!this.DQuickInfoView.IsError,this.QuickInfoVisibility=a,this.DQuickInfoView.IsError&&this.IgnoreQuickViews.push(e)):(this.QuickInfoVisibility=!this.QuickInfoView.IsError,this.DQuickInfoVisibility=r,this.QuickInfoView.IsError&&this.IgnoreQuickViews.push(e))})}ShowProductImage(e){this.SetVisibiltiFalse(),this.ProductImageVisibility=!0,this.ScreenObject.GridDataColumns.Contains("FileGUID")&&this.ScreenObject.GridDataColumns.Contains("FileExtension")&&!n.e.IsEmpty(e.FileGUID)&&(e.guid=e.FileGUID,this.ProductPhoto=n.e.GetPath(e.FileGUID.toString()+"."+e.FileExtension.toString()))}BindDivisionorLocation(e){if(a.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==a.a.SessionManager.Preferences.EnableDivisionWise.toString()){let t=this.ScreenObject.ColumnSource.find(e=>50001==e.CostCenterID);t&&t.ReadOnly&&(this.ScreenObject.DivisionID>0?(e[t.DisplayMember+"_Key"]=this.ScreenObject.DivisionID,e[t.DisplayMember]=this.ScreenObject.DivisionName):a.a.SessionManager.DivisionID>0&&(e[t.DisplayMember+"_Key"]=a.a.SessionManager.DivisionID,e[t.DisplayMember]=a.a.SessionManager.DivisionName))}if(a.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==a.a.SessionManager.Preferences.EnableLocationWise.toString()){let t=this.ScreenObject.ColumnSource.find(e=>50002==e.CostCenterID);t&&t.ReadOnly&&(this.ScreenObject.LocationID>0?(e[t.DisplayMember+"_Key"]=this.ScreenObject.LocationID,e[t.DisplayMember]=this.ScreenObject.LocationName):a.a.SessionManager.LocationID>0&&(e[t.DisplayMember+"_Key"]=a.a.SessionManager.LocationID,e[t.DisplayMember]=a.a.SessionManager.LocationName))}}onFooterBeginEdit(e){let t=e.args,s=e.args.item,i=e.args.column,a=i.DgCol,r=i.className;!Object(o.j)(s.IsVisible)&&1==s.StyleHeightZero||this.IsInventoryVoucher&&"PactTextBoxEditor"==r&&("Amount"==a.DisplayMember||"CalcAmount"==a.DisplayMember)&&this.ScreenObject.GridDataColumns.Contains("ReadOnly")&&!n.e.IsEmpty(s.ReadOnly)&&Object(o.j)(s.ReadOnly)||this.IsInventoryVoucher&&"DataGridPactListBoxColumn"==r&&"dcCurrID"==a.DisplayMember&&this.ScreenObject.GridDataColumns.Contains("dcCurrID_Key")&&!n.e.IsEmpty(s.dcCurrID_Key)&&(-3==parseInt(s.dcCurrID_Key)||-1==parseInt(s.dcCurrID_Key))||this.IsInventoryVoucher&&"PactTextBoxEditor"==r&&"dcExchRT"==a.DisplayMember&&this.ScreenObject.GridDataColumns.Contains("dcCurrID_Key")&&!n.e.IsEmpty(s.dcCurrID_Key)&&(-3==parseInt(s.dcCurrID_Key)||-1==parseInt(s.dcCurrID_Key))?t.Cancel=!0:(this.FooterColumn="ColumnName"!=a.DisplayMember&&"ColumnName"!=a.ValueBinding||!this.ScreenObject.GridDataColumns.Contains("ColumnName")||n.e.IsEmpty(s.ColumnName)?"":s.ColumnName.toString(),"POSDocumentViewModel"==this.ClassName&&"PactTextBoxEditor"==r&&(this.NUmpadBindingPath=a.DisplayMember,this.NumPadText=n.e.IsEmpty(s[a.DisplayMember])?"":s[a.DisplayMember].toString()))}OnFooterCellEditEnding(e){if(!e.column)return;let t=e.item,s=e.column.DgCol,i=e.column.field;i="DataGridComboBoxColumn"==e.column.className||"DataGridPactComboBoxColumn"==e.column.className?s.ValueMember:s.DisplayMember,this.FooterCellEditEnd(i,t),"CalcAmount"!=i&&"Amount"!=i||this.ValidateFooterData(t)}FooterCellEditEnd(e,t){if("ColumnName"==e&&this.ScreenObject.FooterGridDataColumns.Contains("ColumnName")&&!n.e.IsEmpty(t.ColumnName)&&t.ColumnName.toString()!=this.FooterColumn){let e=this.ScreenObject.FooterDataBind.filter(e=>e.ColumnName==t.ColumnName.toString());if(e.length>0&&(t.Name=e[0].Name,t.PostingType=e[0].PostingType,t.IsCalculated=e[0].IsCalculated,t.Formula=e[0].Formula,t.Decimals=e[0].Decimals,t.DebitAccount=e[0].DebitAccount,t.DebitAccountName=e[0].DebitAccountName,t.CreditAccount=e[0].CreditAccount,t.CreditAccountName=e[0].CreditAccountName,t.BasedOnXml=e[0].BasedOnXml,t.Message=e[0].Message,t.Action=e[0].Action,t.Expression=e[0].Expression,t.ReadOnly=e[0].ReadOnly,t.IsVisible=e[0].IsVisible,t.DrRefColID=e[0].DrRefColID,t.CrRefColID=e[0].CrRefColID,t.dcCurrID=e[0].CurrencyName,t.dcCurrID_Key=e[0].Currency,null!=this.Currency)){let e=this.Currency.Currency.Getvalue(n.e.String(t.dcCurrID));""!=e&&(t.dcExchRT=this.ScreenObject.GetExchangeRate(parseInt(e),this.DocumentDate))}}this.ScreenObject.FooterGridDataColumns.Contains("dcCurrID_Key")&&!n.e.IsEmpty(t.ColumnName)&&"dcCurrID"==e&&!n.e.IsEmpty(t.dcCurrID_Key)&&parseInt(t.dcCurrID_Key)>0&&(t.dcExchRT=this.ScreenObject.GetExchangeRate(parseInt(t.dcCurrID_Key),this.DocumentDate)),this.CalculateFooter("CalcAmount"==e?this.ScreenObject.FooterGridData.indexOf(t):-1)}OnCellEditCommit(e){try{if(null==this.ScreenObject||!e.column)return;let t=e.item,s=e.column.DgCol;if("DataGridPactComboBoxColumn"==e.column.className&&62!=this.ScreenObject.DocumentType&&63!=this.ScreenObject.DocumentType&&!this.ScreenObject.IsPayrollDocument){if("ChequeBookNo"==s.DisplayMember&&!n.e.IsEmpty(t.ChequeBookNo)&&t.ChequeBookNo.toString()!=this.PrevValue&&this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!n.e.IsEmpty(t.CreditAccount_Key)){if(this.ScreenObject.Preferences.ContainsKey("AutoChequeonPost")&&"True"==this.ScreenObject.Preferences.AutoChequeonPost)return;let e=this.ScreenObject.ColumnSource.find(e=>null!=e.DisplayMember&&"ChequeNumber"==e.DisplayMember);e&&(t[e.DisplayMember]=a.a.document.GetChequeNumbers(parseInt(t.CreditAccount_Key),t.ChequeBookNo.toString()))}return void this.CalculateTotals(t,!1)}let i=e.column.field,r=0;"DataGridComboBoxColumn"!=e.column.className?(i=s.DisplayMember,"DataGridPactListBoxColumn"==e.column.className&&(r=s.CostCenterID)):"DataGridComboBoxColumn"==e.column.className&&(i=e.model.SelectedValueBinding,r=0),this.ScreenObject.GridDataColumns.Contains(i)&&!n.e.IsEmpty(t[i])&&this.FillDefaultProd(t,i),89!=this.DocumentType&&90!=this.DocumentType||("dcAlpha1"==i||"dcAlpha2"==i?n.e.IsEmpty(t.dcAlpha1)?(t.dcAlpha2=null,t.dcAlpha2_Key=null):n.e.IsEmpty(t.dcAlpha2)&&(t.dcAlpha2=(new Date).ToString("HH:mm"),t.dcAlpha2_Key=new Date):"dcAlpha3"!=i&&"dcAlpha4"!=i||(n.e.IsEmpty(t.dcAlpha3)?(t.dcAlpha4=null,t.dcAlpha4_Key=null):n.e.IsEmpty(t.dcAlpha4)&&(t.dcAlpha4=(new Date).ToString("HH:mm"),t.dcAlpha4_Key=new Date))),this.Celleditend(t,i,r),this.ScreenObject.GridDataObj.updateRow(t),this.PoleDisplayMessage(2,t),this.OnGridSelectionChanged(e)}catch(t){if("PactException"==t.message)throw new Error("PactException")}}CallfromgridObj(e){this.CalculateTotals(e,!1)}FillDefaultProd(e,t){if(this.IsInventoryVoucher&&n.e.IsEmpty(e.ProductID_Key)){let s=this.ScreenObject.ColumnSource.find(e=>null!=e.ValueMember&&"productid_key"==e.ValueMember.toLowerCase());if(s&&!n.e.IsEmpty(s.DefaultValue)&&!n.e.IsEmpty(s.DefaultValueText)&&n.e.IsNum(s.DefaultValue)){let i="";n.e.IsEmpty(t)||(i=n.e.String(e[t]));let a=s.DefaultValueText.split("\x11");e.ProductID_Key=s.DefaultValue,this.ScreenObject.GridDataColumns.Contains("ProductCode")&&a.length>1&&(e.ProductCode=a[1]),this.ScreenObject.GridDataColumns.Contains("ProductName")&&a.length>0&&(e.ProductName=a[0]),this.ProdID=0,this.AddProductData(e,!1,!1,!1,null,null),n.e.IsEmpty(t)||(e[t]=i)}}else if(!this.IsInventoryVoucher&&(this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&n.e.IsEmpty(e.DebitAccount_Key)||this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&n.e.IsEmpty(e.CreditAccount_Key)))if(this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")){let s=this.ScreenObject.ColumnSource.find(e=>null!=e.ValueMember&&"creditaccount_key"==e.ValueMember.toLowerCase());if(s&&!n.e.IsEmpty(s.DefaultValue)&&!n.e.IsEmpty(s.DefaultValueText)&&n.e.IsNum(s.DefaultValue)&&parseInt(s.DefaultValue)>0){let i="";n.e.IsEmpty(t)||(i=e[t].toString());let a=s.DefaultValueText.split("\x11");e.CreditAccount_Key=s.DefaultValue,this.ScreenObject.GridDataColumns.Contains("AccountCode")&&a.length>1&&(e.AccountCode=a[1]),this.ScreenObject.GridDataColumns.Contains("AccountName")&&a.length>0&&(e.AccountName=a[0]),n.e.IsEmpty(t)||(e[t]=i),this.FillDefaultValues(e),this.ScreenObject.GridDataObj.updateRow(e)}}else if(this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")){let s=this.ScreenObject.ColumnSource.find(e=>null!=e.ValueMember&&"debitaccount_key"==e.ValueMember.toLowerCase());if(s&&!n.e.IsEmpty(s.DefaultValue)&&!n.e.IsEmpty(s.DefaultValueText)&&n.e.IsNum(s.DefaultValue)&&parseInt(s.DefaultValue)>0){let i="";n.e.IsEmpty(t)||(i=e[t].toString());let a=s.DefaultValueText.split("\x11");e.DebitAccount_Key=s.DefaultValue,this.ScreenObject.GridDataColumns.Contains("AccountCode")&&a.length>1&&(e.AccountCode=a[1]),this.ScreenObject.GridDataColumns.Contains("AccountName")&&a.length>0&&(e.AccountName=a[0]),n.e.IsEmpty(t)||(e[t]=i),this.FillDefaultValues(e),this.ScreenObject.GridDataObj.updateRow(e)}}}FillDefaultValues(e){let t;for(let s=0;s<this.ScreenObject.ColumnSource.length;s++){const i=this.ScreenObject.ColumnSource[s];if(n.e.IsEmpty(i.ID))continue;let r=this.ScreenObject.Data.Tables[0].filter(e=>e.CostCenterColID==i.ID&&null!=e.LocalReference&&79==e.LocalReference&&53580==e.LinkData),o=this.ScreenObject.Data.Tables[0].filter(e=>e.CostCenterColID==i.ID&&null!=e.LocalReference&&79==e.LocalReference&&(55496==e.LinkData||55495==e.LinkData));if(i.CostCenterID>0&&3!=i.CostCenterID&&!n.e.IsEmpty(i.LocalRefDefaultValue)&&n.e.IsNum(i.LocalRefDefaultValue)&&!n.e.IsEmpty(i.ValueMember)&&!n.e.IsEmpty(i.LocalRefDefaultValueText))e[i.DisplayMember]=i.LocalRefDefaultValueText,e[i.ValueMember]=i.LocalRefDefaultValue,this.FillLinkRef(e,i);else if(i.CostCenterID>0&&3!=i.CostCenterID&&!n.e.IsEmpty(i.DefaultValue)&&!n.e.IsEmpty(i.ValueMember)&&n.e.IsEmpty(e[i.ValueMember])&&!n.e.IsEmpty(i.DefaultValueText)){if(n.e.IsNum(i.DefaultValue)){let t=i.DefaultValueText.split("\x11");t.length>1?e[i.DisplayMember]=t[1]:t.length>0&&(e[i.DisplayMember]=t[0]),e[i.ValueMember]=i.DefaultValue,this.FillLinkRef(e,i)}}else if(n.e.IsEmpty(i.DefaultValue)||n.e.IsEmpty(i.ValueBinding)||!i.ValueBinding.toLowerCase().Contains("dcalpha"))if(n.e.IsEmpty(i.DefaultValue)||n.e.IsEmpty(i.DisplayMember)||!i.DisplayMember.toLowerCase().Contains("dcalpha"))if(r.length>0){if(null!=this.fldDict&&n.e.isValidDate(this.fldDict.ServerDate.fieldResult)&&("DATE"==i.DataType||"DATETIME"==i.DataType||"TIME"==i.DataType))if(e[i.DisplayMember]="DATETIME"==i.DataType?new Date(this.fldDict.ServerDate.fieldResult).ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm a"):"TIME"==i.DataType?new Date(this.fldDict.ServerDate.fieldResult).ToString("hh:mm:ss tt"):new Date(this.fldDict.ServerDate.fieldResult).ToString(a.a.SessionManager.Preferences["Date Format"]),"TIME"==i.DataType){let t=new Date(this.fldDict.ServerDate.fieldResult);e[i.DisplayMember+"_Key"]=new Date(1900,1,1,t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds())}else e[i.DisplayMember+"_Key"]=new Date(this.fldDict.ServerDate.fieldResult)}else o.length>0&&("DATE"!=i.DataType&&"DATETIME"!=i.DataType&&"TIME"!=i.DataType||(e[i.DisplayMember]="DATETIME"==i.DataType?(new Date).ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm a"):"TIME"==i.DataType?(new Date).ToString("hh:mm:ss tt"):(new Date).ToString(a.a.SessionManager.Preferences["Date Format"]),e[i.DisplayMember+"_Key"]="TIME"==i.DataType?new Date(1900,1,1,(new Date).getHours(),(new Date).getMinutes(),(new Date).getSeconds(),(new Date).getMilliseconds()):new Date));else n.e.IsEmpty(e[i.DisplayMember])&&("DATETIME"==i.DataType.toUpperCase()?n.e.IsEmpty(i.DefaultValue)||"today"!=i.DefaultValue.toLowerCase()?n.e.isValidDate(i.DefaultValue)&&(e[i.DisplayMember]=t.ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss tt"),e[i.DisplayMember+"_Key"]=t):(e[i.DisplayMember]=(new Date).ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss tt"),e[i.DisplayMember+"_Key"]=new Date):"TIME"==i.DataType.toUpperCase()?n.e.IsEmpty(i.DefaultValue)||"today"!=i.DefaultValue.toLowerCase()?n.e.isValidDate(i.DefaultValue)&&(e[i.DisplayMember]=t.ToString("hh:mm:ss tt"),e[i.DisplayMember+"_Key"]=t):(e[i.DisplayMember]=(new Date).ToString("hh:mm:ss tt"),e[i.DisplayMember+"_Key"]=new Date):"TIME2"==i.DataType.toUpperCase()?n.e.IsEmpty(i.DefaultValue)||"today"!=i.DefaultValue.toLowerCase()?n.e.isValidDate(i.DefaultValue)&&(e[i.DisplayMember]=t.ToString("HH:mm"),e[i.DisplayMember+"_Key"]=t):(e[i.DisplayMember]=(new Date).ToString("HH:mm"),e[i.DisplayMember+"_Key"]=new Date):"DATE"==i.DataType.toUpperCase()?n.e.IsEmpty(i.DefaultValue)||"today"!=i.DefaultValue.toLowerCase()?n.e.isValidDate(i.DefaultValue)&&(e[i.DisplayMember]=t.ToString(a.a.SessionManager.Preferences["Date Format"]),e[i.DisplayMember+"_Key"]=t):(e[i.DisplayMember]=Date.Today().ToString(a.a.SessionManager.Preferences["Date Format"]),e[i.DisplayMember+"_Key"]=Date.Today()):e[i.DisplayMember]=i.DefaultValue);else n.e.IsEmpty(e[i.ValueBinding])&&(e[i.ValueBinding]=i.DefaultValue)}}FillLinkRef(e,t){this.ScreenObject.Data.Tables.length>0&&this.ScreenObject.Data.Tables[0].length>0&&null!=t&&t.CostCenterID>0&&this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&e.LocalReference==t.ID).length>0&&!n.e.IsEmpty(t.ValueMember)&&!n.e.IsEmpty(e[t.ValueMember])&&this.ScreenObject.GetLinkReferenceData(parseInt(t.ID),this.DocumentID,parseInt(e[t.ValueMember]),Date.Today(),"",t.CostCenterID,e)}IsWarehouseBinwise(e,t,s){s.DimensionID=0;let i=0;if(a.a.SessionManager.Preferences.ContainsKey("DimensionwiseBins")&&""!=a.a.SessionManager.Preferences.DimensionwiseBins.toString()&&(i=n.e.Int(a.a.SessionManager.Preferences.DimensionwiseBins),i>0)){if(i>5e4&&this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(i-5e4).toString()+"_Key"))return s.DimensionID=1,1==t&&this.ScreenObject.GridDataColumns.Contains("TOdcCCNID"+(i-5e4).toString()+"_Key")?!n.e.IsEmpty(this.ScreenObject.GridData[e]["TOdcCCNID"+(i-5e4).toString()+"_Key"])&&parseInt(this.ScreenObject.GridData[e]["TOdcCCNID"+(i-5e4).toString()+"_Key"])>0&&(s.DimensionID=parseInt(this.ScreenObject.GridData[e]["TOdcCCNID"+(i-5e4).toString()+"_Key"])):!n.e.IsEmpty(this.ScreenObject.GridData[e]["dcCCNID"+(i-5e4).toString()+"_Key"])&&parseInt(this.ScreenObject.GridData[e]["dcCCNID"+(i-5e4).toString()+"_Key"])>0&&(s.DimensionID=parseInt(this.ScreenObject.GridData[e]["dcCCNID"+(i-5e4).toString()+"_Key"])),this.ScreenObject.IsBinWise(i,s.DimensionID);if(1!=t){let e=this.ScreenObject._CCFields.find(e=>e instanceof m.b&&e.CCID==i);return e&&(s.DimensionID=e.SelectedValue),this.IsBinwise}if(null!=this.IsToBinwise){for(let e=0;e<this.ScreenObject._CCFields.length;e++){let t=this.ScreenObject._CCFields[e];if(t instanceof m.b&&t.CCID==i){if(t.DBColumnName.Contains("TO"))t.SelectedValue>0&&(s.DimensionID=t.SelectedValue);else{let e=this.ScreenObject._CCFields.find(e=>e.DBColumnName=="TO"+t.DBColumnName);e instanceof m.b?e.SelectedValue>0&&(s.DimensionID=e.SelectedValue):t.SelectedValue>0&&(s.DimensionID=t.SelectedValue)}return this.IsToBinwise}}return this.IsToBinwise}s.DimensionID=1;for(let e=0;e<this.ScreenObject._CCFields.length;e++){let t=this.ScreenObject._CCFields[e];if(t instanceof m.b&&t.CCID==i){if(t.DBColumnName.Contains("TO"))t.SelectedValue>0&&(s.DimensionID=t.SelectedValue);else{let e=this.ScreenObject._CCFields.find(e=>e.DBColumnName=="TO"+t.DBColumnName);e instanceof m.b?e.SelectedValue>0&&(s.DimensionID=e.SelectedValue):t.SelectedValue>0&&(s.DimensionID=t.SelectedValue)}return this.IsToBinwise=this.ScreenObject.IsBinWise(i,s.DimensionID),this.IsToBinwise}}}return!0}GetDimValue(e,t){let s=1,i=!1;for(let a=0;a<this.ScreenObject._CCFields.length;a++){let t=this.ScreenObject._CCFields[a];if(t instanceof m.b&&t.CCID==e){t.SelectedValue>0&&(s=t.SelectedValue),i=!0;break}}return i||null!=t&&e>5e4&&this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(e-5e4).toString()+"_Key")&&!n.e.IsEmpty(t["dcCCNID"+(e-5e4).toString()+"_Key"])&&parseInt(t["dcCCNID"+(e-5e4).toString()+"_Key"])>0&&(s=parseInt(t["dcCCNID"+(e-5e4).toString()+"_Key"])),s}GetBOEIDS(e){let t="";if(a.a.SessionManager.IsActionAssigned(43,"Show only BOE Bins if fifo")&&-1==this.VoucherType&&this.ScreenObject.GridDataColumns.Contains("landingType")&&"2"==n.e.String(e.landingType))if(n.e.IsEmpty(e.DocExtraXML))t+="0";else{let s=new n.f;s.LoadXml(e.DocExtraXML);let i=s.SelectNodes("DocExtraXML/Row");for(let e=0;e<i.length;e++)null==i[e].attributes.RefID||n.e.IsEmpty(i[e].attributes.RefID.value)||(""!=t&&(t+=","),t+=i[e].attributes.RefID.value)}else if(a.a.SessionManager.IsActionAssigned(43,"Show only BOE Bins")&&-1==this.VoucherType&&this.ScreenObject.GridDataColumns.Contains("landingType")&&("2"==n.e.String(e.landingType)||"1"==n.e.String(e.landingType)))if(n.e.IsEmpty(e.DocExtraXML))t+="0";else{let s=new n.f;s.LoadXml(e.DocExtraXML);let i=s.SelectNodes("DocExtraXML/Row");for(let e=0;e<i.length;e++)null==i[e].attributes.RefID||n.e.IsEmpty(i[e].attributes.RefID.value)||(""!=t&&(t+=","),t+=i[e].attributes.RefID.value)}return t}AddBins(e,t,s,i,r=!1){let l=null,c=null;if(null!=i&&(l=i.Tables[0],c=i.Columns[0]),a.a.page.DialogModel instanceof le)return;if(s&&this.ScreenObject.GridDataColumns.Contains("landingType")&&("1"==n.e.String(e.landingType)||"2"==n.e.String(e.landingType))){if(a.a.page.DialogModel instanceof oe.a)return;return void a.a.page.ShowDialog(new le(this,2),ce.a)}let h=0;if(this.ScreenObject.Preferences.ContainsKey("ExcludeHoldBins")&&""!=this.ScreenObject.Preferences.ExcludeHoldBins.toString()&&Object(o.j)(this.ScreenObject.Preferences.ExcludeHoldBins)&&(this.ScreenObject.GridDataColumns.Contains("ReserveQuantity")||this.ScreenObject.GridDataColumns.Contains("HoldQuantity"))){if(this.ScreenObject.GridDataColumns.Contains("ReserveQuantity")){let t=this.ScreenObject.ColumnSource.find(e=>"ReserveQuantity"==e.DisplayMember);t&&!n.e.IsEmpty(t.Formula)&&this.CalculateTotals(e,!1),!n.e.IsEmpty(e.ReserveQuantity)&&parseFloat(e.ReserveQuantity)>0&&(h=parseFloat(e.ReserveQuantity))}if(this.ScreenObject.GridDataColumns.Contains("HoldQuantity")){let t=this.ScreenObject.ColumnSource.find(e=>"HoldQuantity"==e.DisplayMember);t&&!n.e.IsEmpty(t.Formula)&&this.CalculateTotals(e,!1),!n.e.IsEmpty(e.HoldQuantity)&&parseFloat(e.HoldQuantity)>0&&(h=parseFloat(e.HoldQuantity))}}else(this.ScreenObject.Preferences.ContainsKey("ShowBins")&&""!=this.ScreenObject.Preferences.ShowBins&&Object(o.j)(this.ScreenObject.Preferences.ShowBins)||!this.DonotUpdateInventory)&&(h=!n.e.IsEmpty(e.SchemeID)&&parseInt(e.SchemeID)>0&&"Y"==e.IsScheme.toString()&&this.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!n.e.IsEmpty(e.FreeQTY)?parseFloat(e.FreeQTY):parseFloat(e.Quantity),this.ScreenObject.GridDataColumns.Contains("UOMConversion")&&!n.e.IsEmpty(e.UOMConversion)&&(h*=parseFloat(e.UOMConversion)));if(0!=h&&(30==this.ScreenObject.DocumentType&&(this.VoucherType=this.ScreenObject.GridDataColumns.Contains("VoucherType")&&!n.e.IsEmpty(e.VoucherType)?parseInt(e.VoucherType):0),0!=this.VoucherType&&h>0)){let s=0,i=0,o=0,u=0,d=0;if(a.a.SessionManager.Preferences.ContainsKey("DimensionwiseBins")&&""!=a.a.SessionManager.Preferences.DimensionwiseBins.toString()&&(i=n.e.Int(a.a.SessionManager.Preferences.DimensionwiseBins),i>0&&(s=this.GetDimValue(i,e))),this.ScreenObject.Preferences.ContainsKey("BinFilterDim")&&""!=this.ScreenObject.Preferences.BinFilterDim.toString()&&(u=n.e.Int(this.ScreenObject.Preferences.BinFilterDim),u>0&&(o=this.GetDimValue(u,e))),n.e.IsEmpty(e.DocDetailsID)||(d=parseInt(e.DocDetailsID)),!t&&i>5e4&&!this.ScreenObject.IsBinWise(i,s))5!=this.ScreenObject.DocumentType||this.ScreenObject.GridDataColumns.Contains("RecievedQty")||i>0&&this.AddToWarehouseBins(i,e,h,t);else{let d=0;-1!=this.VoucherType||n.e.IsEmpty(e.LinkedInvDocDetailsID)||(d=n.e.Int(e.LinkedInvDocDetailsID));let D=this.ScreenObject.GetProductwiseBins(parseInt(e.ProductID_Key),this.ScreenObject.DocID,this.VoucherType,this.DocumentDate,i,s,u,o,d,0,0,this.GetBOEIDS(e)),S=new oe.a(this,this.VoucherType,h,parseInt(e.ProductID_Key),e.ProductName.toString(),D,e);if(r)S.ChkFifo=!0,S.OnSave("AutoSave");else if(this.ScreenObject.Preferences.ContainsKey("AutoSelectBins")&&"true"==this.ScreenObject.Preferences.AutoSelectBins.toLowerCase()&&null!=D&&D.Tables.length>0&&1==D.Tables[0].length&&S.BinsGrid.Table.length>0)S.BinsGrid.Table[0].Allocate=h,S.celledtiend(S.BinsGrid.Table[0]),S.DisplayMessage="",S.OnSave("AutoSave"),""==S.DisplayMessage||t||a.a.page.ShowDialog(S,fe.a);else if(null!=l){for(let e=0;e<l.length;e++){let t;t=c.Contains("InvDocDetailsID")&&S.BinsGrid.TableColumns.Contains("InvID")?S.BinsGrid.Table.filter(t=>t.NodeID==l[e].BinID&&t.InvID==l[e].InvDocDetailsID):S.BinsGrid.Table.filter(t=>t.NodeID==l[e].BinID),t.length>0&&h>0&&(h>parseFloat(l[e].Quantity)?(t[0].Allocate=l[e].Quantity.toString(),S.celledtiend(S.BinsGrid.Table[0]),h-=parseFloat(l[e].Quantity)):(t[0].Allocate=h,S.celledtiend(S.BinsGrid.Table[0]),h=0))}S.OnSave("AutoSave")}else a.a.page.ShowDialog(S,fe.a)}}}AddToWarehouseBins(e,t,s,i){let r=1,o=!1,l=0,c=0,h=0;if(0==e&&(r=0),e>0){for(let t=0;t<this.ScreenObject._CCFields.length;t++){let s=this.ScreenObject._CCFields[t];if(s instanceof m.b&&s.CCID==e){if(s.DBColumnName.Contains("TO"))s.SelectedValue>0&&(r=s.SelectedValue);else{let e=this.ScreenObject._CCFields.find(e=>e.DBColumnName=="TO"+s.DBColumnName);e instanceof m.b?e.SelectedValue>0&&(r=e.SelectedValue):s.SelectedValue>0&&(r=s.SelectedValue)}o=!0;break}}o||null!=t&&e>5e4&&this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(e-5e4).toString()+"_Key")&&(this.ScreenObject.GridDataColumns.Contains("TOdcCCNID"+(e-5e4).toString()+"_Key")?!n.e.IsEmpty(t["TOdcCCNID"+(e-5e4).toString()+"_Key"])&&parseInt(t["TOdcCCNID"+(e-5e4).toString()+"_Key"])>0&&(r=parseInt(t["TOdcCCNID"+(e-5e4).toString()+"_Key"])):!n.e.IsEmpty(t["dcCCNID"+(e-5e4).toString()+"_Key"])&&parseInt(t["dcCCNID"+(e-5e4).toString()+"_Key"])>0&&(r=parseInt(t["dcCCNID"+(e-5e4).toString()+"_Key"])))}if(this.ScreenObject.Preferences.ContainsKey("BinFilterDim")&&""!=this.ScreenObject.Preferences.BinFilterDim.toString()&&(h=n.e.Int(this.ScreenObject.Preferences.BinFilterDim),h>0&&(c=this.GetDimValue(h,t))),!(e>5e4)||this.ScreenObject.IsBinWise(e,r)){n.e.IsEmpty(t.TODocDetailsID)||(l=parseInt(t.TODocDetailsID));let o=this.ScreenObject.GetProductwiseBins(parseInt(t.ProductID_Key),this.ScreenObject.DocID,1,this.DocumentDate,e,r,h,c,0,0,0,this.GetBOEIDS(t)),u=new oe.a(this,1,s,parseInt(t.ProductID_Key),t.ProductName.toString(),o,t);this.ScreenObject.Preferences.ContainsKey("AutoSelectBins")&&"true"==this.ScreenObject.Preferences.AutoSelectBins.toLowerCase()&&null!=o&&o.Tables.length>0&&1==o.Tables[0].length&&u.BinsGrid.Table.length>0?(u.BinsGrid.Table[0].Allocate=s,u.celledtiend(u.BinsGrid.Table[0]),u.DisplayMessage="",u.OnSave("AutoSave"),""==u.DisplayMessage||i||a.a.page.ShowDialog(u,fe.a)):a.a.page.ShowDialog(u,fe.a)}}fillbatches(e,t="",s=!1){if(this.ScreenObject.Preferences.ContainsKey("SameBatchtoall")&&"true"==this.ScreenObject.Preferences.SameBatchtoall.toLowerCase())return;if(this.ScreenObject.Preferences.ContainsKey("BatchBasedon")&&""!=this.ScreenObject.Preferences.BatchBasedon){if(this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.Preferences.BatchBasedon)&&"1"==e[this.ScreenObject.Preferences.BatchBasedon].toString())return;let t=this.ScreenObject._TextFields.find(e=>e instanceof u.d&&e.DBColumnName.toLowerCase()==this.ScreenObject.Preferences.BatchBasedon.toLowerCase());if(t&&"1"==t.Text)return}let i=this.VoucherType;38==this.ScreenObject.DocumentType&&!n.e.IsEmpty(e.Quantity)&&parseFloat(e.Quantity.toString())<0&&(i=1),30==this.ScreenObject.DocumentType&&(i=this.ScreenObject.GridDataColumns.Contains("VoucherType")&&!n.e.IsEmpty(e.VoucherType)?parseInt(e.VoucherType):0);let r="";if(32==this.DocumentType){i=0;let t=this.ScreenObject.ColumnSource.find(e=>e.ID==this.ScreenObject.Preferences.VarienceField);t&&(r=t.DisplayMember),""==r||n.e.IsEmpty(e[r])||(parseFloat(e[r])<0?i=-1:parseFloat(e[r])>0&&(i=1))}else 31==this.DocumentType&&""!=t&&(i=1,r=t);let l=null;if(-1==i){let t=0;if(n.e.IsEmpty(e.DocDetailsID)||(t=parseInt(e.DocDetailsID)),a.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise Batches")&&""!=a.a.SessionManager.Preferences["Maintain Dimensionwise Batches"].toString()){let t=0;if(n.e.Int(a.a.SessionManager.Preferences["Maintain Dimensionwise Batches"].toString())>0){t=parseInt(a.a.SessionManager.Preferences["Maintain Dimensionwise Batches"].toString());let s=this.ScreenObject._CCFields.find(e=>e instanceof m.b&&e.CCID==t);if(null!=s){if(s.SelectedValue<1)return this.DisplayMessage=a.a.GetResource("Select")+" "+s.Label,void(this.MessageVisibility=!0)}else if(this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(t-5e4).toString()+"_Key")&&""==e["dcCCNID"+(t-5e4).toString()+"_Key"].toString()){var c=this.ScreenObject.ColumnSource.find(e=>e.CostCenterID==t);if(null!=c)return this.DisplayMessage=a.a.GetResource("Select")+" "+c.Header,void(this.MessageVisibility=!0)}}}if(l=this.ScreenObject.GetProductwiseBatches(parseInt(e.ProductID_Key),t,i,e,0,!1),!(null!=l&&l.Tables.length>0))return void(this.DisplayMessage=a.a.GetResource("Batch_PrdNoBtch").toString());if(l.Tables.length>1&&l.Tables[1].length>0&&l.Columns[1].Contains("ErrorMessage"))return void(this.DisplayMessage=l.Tables[1][0].ErrorMessage.toString());if(!(l.Tables[0].length>0&&l.Columns[0].Contains("BalQty")))return void(this.DisplayMessage=a.a.GetResource("Batch_PrdNoBtch").toString())}let h=0,d=0;if(this.ScreenObject.Preferences.ContainsKey("Donotuselocation")&&""!=this.ScreenObject.Preferences.Donotuselocation&&Object(o.j)(this.ScreenObject.Preferences.Donotuselocation)){let t=this.ScreenObject._CCFields.find(e=>"dcccnid2"==e.DBColumnName.toLowerCase());t&&t instanceof m.b&&t.SelectedValue>0?d=t.SelectedValue:null==e||n.e.IsEmpty(e.dcCCNID2_Key)||(d=parseInt(e.dcCCNID2_Key))}else d=this.ScreenObject.LocationID>0?this.ScreenObject.LocationID:a.a.SessionManager.LocationID;if(h=this.ScreenObject.DivisionID>0?this.ScreenObject.DivisionID:a.a.SessionManager.DivisionID,0!=i){let c=0;if(c=""==r||n.e.IsEmpty(e[r])?!n.e.IsEmpty(e.SchemeID)&&parseInt(e.SchemeID)>0&&"Y"==e.IsScheme.toString()&&this.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!n.e.IsEmpty(e.FreeQTY)?parseFloat(e.FreeQTY):parseFloat(e.Quantity):parseFloat(e[r].toString().replace("-","")),n.e.IsEmpty(e.UOMConversion)||(c*=parseFloat(e.UOMConversion)),38==this.ScreenObject.DocumentType&&!n.e.IsEmpty(e.Quantity)&&parseFloat(e.Quantity.toString())<0&&(c*=-1),this.ScreenObject.Preferences.ContainsKey("ExcludeHold")&&!n.e.IsEmpty(this.ScreenObject.Preferences.ExcludeHold)&&Object(o.j)(this.ScreenObject.Preferences.ExcludeHold)&&this.ScreenObject.GridDataColumns.Contains("HoldQuantity")){let t=this.ScreenObject.ColumnSource.find(e=>"HoldQuantity"==e.DisplayMember);t&&!n.e.IsEmpty(t.Formula)&&this.CalculateTotals(e,!1),c=!n.e.IsEmpty(e.HoldQuantity)&&parseFloat(e.HoldQuantity)>0?parseFloat(e.HoldQuantity):0}if(this.ScreenObject.Preferences.ContainsKey("ExcludeReserve")&&""!=this.ScreenObject.Preferences.ExcludeReserve.toString()&&Object(o.j)(this.ScreenObject.Preferences.ExcludeReserve)&&this.ScreenObject.GridDataColumns.Contains("ReserveQuantity")){let t=this.ScreenObject.ColumnSource.find(e=>"ReserveQuantity"==e.DisplayMember);t&&!n.e.IsEmpty(t.Formula)&&this.CalculateTotals(e,!1),c=!n.e.IsEmpty(e.ReserveQuantity)&&parseFloat(e.ReserveQuantity)>0?parseFloat(e.ReserveQuantity):0}if(-1==i&&31!=this.DocumentType&&32!=this.DocumentType&&l.Tables[0].length>0&&l.Columns[0].Contains("BalQty")){var D=l.Tables[0].Compute("sum","BalQty");if(null!=D&&(D=parseFloat(D).ToString("N"+a.a.SessionManager.Preferences.DecimalsinQty),c=parseFloat(parseFloat(c).ToString("N"+a.a.SessionManager.Preferences.DecimalsinQty)),parseFloat(D)<c))return this.DisplayMessage="Allocated batch quantity is less than document quantity.",void(this.MessageVisibility=!0)}if(c>0||this.ScreenObject.Preferences.ContainsKey("QtyonBatch")&&""!=this.ScreenObject.Preferences.QtyonBatch&&Object(o.j)(this.ScreenObject.Preferences.QtyonBatch)){let n=new Te.a(this.ScreenObject.GridDataObj);n.BatchNumberViewModel_4(this,i,c,l,parseInt(e.ProductID_Key),e.ProductName.toString(),d,h,r,e),s?(n.AdjusFifo(!0),n.OnSave("AutoSave")):c>0&&this.ScreenObject.Preferences.ContainsKey("Autobatchifsingle")&&Object(o.j)(this.ScreenObject.Preferences.Autobatchifsingle)&&1==l.Tables[0].length&&""==t?(n.AdjusFifo(!0),n.OnSave("AutoSave"),n.count>1&&this.ScreenObject.UpdateSequence()):a.a.page.ShowDialog(n,je.a).subscribe(()=>{n.count>1&&this.ScreenObject.UpdateSequence()})}}}Celleditend(e,t,s,i=0){try{let c=t,h="";Logger.InfoLog("AddEditDocumentViewModel::Entering OnCellEditEnding");let D=1,S=1;if(this.Currency&&null!=this.Currency.Currency.SelectedValue&&""!=this.Currency.Currency.SelectedValue?D=parseInt(this.Currency.Currency.SelectedValue):this.ScreenObject.GridDataColumns.Contains("CurrencyID")&&!n.e.IsEmpty(e.CurrencyID_Key)&&(D=parseInt(e.CurrencyID_Key)),this.Currency&&!n.e.IsEmpty(this.Currency.ExchangeRate.Text)?S=parseFloat(this.Currency.ExchangeRate.Text):this.ScreenObject.GridDataColumns.Contains("ExchangeRate")&&!n.e.IsEmpty(e.ExchangeRate)&&(S=parseFloat(e.ExchangeRate)),this.ScreenObject.Preferences.ContainsKey("BudgetAnnualAmount")&&this.ScreenObject.Preferences.BudgetAnnualAmount==t){if("0"!=this.ScreenObject.Preferences.BudgetType){let s=12;"1"==this.ScreenObject.Preferences.BudgetType?s=2:"2"==this.ScreenObject.Preferences.BudgetType&&(s=4);let i=0,r=0;if(i=n.e.Double(e[t]),r=n.e.Double(this.PrevValue),i!=r){let t=0,n=parseFloat((i/s).ToString("N"+a.a.SessionManager.Preferences.DecimalsinAmount));for(let i=1;i<s;i++)e[this.ScreenObject.Preferences["BudgetField"+i]]=n,this.ScreenObject.Preferences["BudgetField"+i].startsWith("dcNum")&&(e["dcCalc"+this.ScreenObject.Preferences["BudgetField"+i]]=n),t+=n;e[this.ScreenObject.Preferences["BudgetField"+s]]=parseFloat((i-t).ToString("N"+a.a.SessionManager.Preferences.DecimalsinAmount)),this.ScreenObject.Preferences["BudgetField"+s].startsWith("dcNum")&&(e["dcCalc"+this.ScreenObject.Preferences["BudgetField"+s]]=n)}}return}let b=this.ScreenObject.ColumnSource.find(e=>e.DisplayMember==t);if(!b&&t&&(b=this.ScreenObject.ColumnSource.find(e=>"Name"==e.DisplayMember&&e.ValueBinding==t)),68!=this.ScreenObject.DocumentType&&70!=this.ScreenObject.DocumentType&&80!=this.ScreenObject.DocumentType&&67!=this.ScreenObject.DocumentType||(t&&t.endsWith("_Key")&&(t=t.replace("_Key",""),b=this.ScreenObject.ColumnSource.find(e=>e.ValueBinding==t)),70!=this.ScreenObject.DocumentType&&67!=this.ScreenObject.DocumentType||this.FillDefaultValues(e)),"ProductName"!=t&&"ProductCode"!=t||(t="ProductID"),"DueDate"!=t||31!=this.ScreenObject.DocumentType||n.e.IsEmpty(e.DueDate_Key)||this.GetProductValues(e,0),"Quantity"==t){if(!n.e.IsEmpty(e.Quantity)&&this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&this.ScreenObject.Preferences.ContainsKey("DuplicateProduct_IncrementQuantity")&&""!=this.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity&&Object(o.j)(this.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity)&&!n.e.IsEmpty(e.ProductID_Key)&&parseInt(e.ProductID_Key)!=this.ScreenObject.TempProductID&&(n.e.IsEmpty(e.LinkedInvDocDetailsID)||"0"==e.LinkedInvDocDetailsID.toString())&&this.AddProductQty(e,!0),n.e.IsEmpty(e.Quantity)||n.e.IsEmpty(e.UOMConversion)||!n.e.IsNum(e.UOMConversion)?n.e.IsEmpty(e.Quantity)||(e.UOMConvertedQty=e.Quantity):e.UOMConvertedQty=n.e.Double(e.UOMConversion)*parseFloat(e.Quantity),n.e.String(e.Quantity)!=this.PrevValue){if(this.GetProductValues(e,0,!1,null,!0),"3"==n.e.String(e.Type)){let t=new re(this,e,null);t.FooterGridData.length>0&&t.OnfooterQtyChanged(t.FooterGridData[0]),t.OnButtonClick("AutoSave")}if(!n.e.IsEmpty(e.LinkedInvDocDetailsID)&&"Quantity"==e.LinkedFieldName.toString()){let t=this.ScreenObject.ColumnSource.filter(e=>e.IsPartialLinking);if(t.length>0){let s=this.ScreenObject.GetDetailsByInvDetID(e.LinkedInvDocDetailsID.toString());t.forEach(t=>{this.ScreenObject.SetLinkValues(s,t,0,e,null,e.Quantity.toString())})}}}if(!n.e.IsEmpty(e.Quantity)&&parseFloat(e.Quantity)>0&&this.ScreenObject.GridDataColumns.Contains("FreeQTY")&&1==n.e.Int(e.SchemeID)&&(e.FreeQTY=0,e.IsScheme=null,e.MaxSchemeID=null,e.SchemeID=null),this.ScreenObject.Preferences.ContainsKey("SubstituteOnQty")&&this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.Preferences.SubstituteOnQty)&&!n.e.IsEmpty(e.ProductID_Key)&&!n.e.IsEmpty(e.Quantity)&&!n.e.IsEmpty(e[this.ScreenObject.Preferences.SubstituteOnQty])&&parseFloat(e.Quantity)>parseFloat(e[this.ScreenObject.Preferences.SubstituteOnQty])){let t=this.ScreenObject.GetSubtituteProducts(parseInt(e.ProductID_Key),this.DocumentDate,e.DocDetailsID.toString(),e);if(t.Tables.length>0&&!t.Columns[0].Contains("ErrorMessage")&&t.Tables[0].length>0){let s=new De.a(this,t.Tables[0],t.Columns[0],t.Tables[1],e.ProductName.toString(),e.ProductCode.toString(),e.ProductID_Key.toString());s.GridData.length>0&&a.a.page.ShowDialog(s,Se.a,{ShowCenter:!0})}}if(this.ScreenObject.Preferences.ContainsKey("UseQtyAdjustment")&&""!=this.ScreenObject.Preferences.UseQtyAdjustment&&Object(o.j)(this.ScreenObject.Preferences.UseQtyAdjustment)&&this.ScreenObject.GridDataColumns.Contains("QtyType")&&1==n.e.Int(e.QtyType)){let e=new le(this,1);a.a.page.ShowDialog(e,ce.a,{ShowCenter:!0})}}else if("FreeQTY"==t&&n.e.Double(e.FreeQTY)>0&&n.e.IsEmpty(e.IsScheme)){if(n.e.Double(e.Quantity)>0)return void(this.DisplayMessage="Can not enter both qty and free qty");{e.IsScheme="Y";let t=0,s=this.ScreenObject.GridData.Compute("max","MaxSchemeID");null!=s&&(t=n.e.Int(s)),t++,e.MaxSchemeID=t,e.SchemeID=1,n.e.Double(e.FreeQTY)>0&&(e.UOMConvertedQty=n.e.IsEmpty(e.UOMConversion)?e.FreeQTY.toString():parseFloat(e.FreeQTY)*parseFloat(e.UOMConversion))}}if(this.ScreenObject.Preferences.ContainsKey("QtyAdjustmentField")&&(this.ScreenObject.Preferences.QtyAdjustmentField==t||"Gross"==t&&"dcNum"==this.ScreenObject.Preferences.QtyAdjustmentField)&&a.a.page.ShowDialog(new le(this,1),ce.a,{ShowCenter:!0}),s>0){if(11==s)this.OnProductUnitChange(e);else if(12==s){let s=t;s=s.substr(8,s.length-8),this.ScreenObject.GridDataColumns.Contains(t+"_Key")&&!n.e.IsEmpty(e[t+"_Key"])&&("currencyid"==t.toLowerCase().toString()&&this.ScreenObject.GridDataColumns.Contains("ExchangeRate")?e.ExchangeRate=this.ScreenObject.GetExchangeRate(parseInt(e[t+"_Key"]),this.DocumentDate.OnlyDate()):this.ScreenObject.GridDataColumns.Contains("dcExchRT"+s)&&(e["dcExchRT"+s]=this.ScreenObject.GetExchangeRate(parseInt(e[t+"_Key"]),this.DocumentDate.OnlyDate())))}else if(2==s){if(b&&!n.e.IsEmpty(e[b.ValueMember])){if(!this.IsInventoryVoucher&&this.ScreenObject.IsDocEdit&&e[b.ValueMember].toString()!=this.PrevValue&&(e.Type=!!this.IsAccBillWise(parseInt(e[b.ValueMember]))||null),this.IsInventoryVoucher||this.ScreenObject.IsDocEdit||e[b.ValueMember].toString()==this.PrevValue||this.FillDefaultValues(e),(5==this.DocumentType||8==this.DocumentType||13==this.DocumentType)&&this.ScreenObject.Preferences.ContainsKey("BudgetFeild")&&!n.e.IsEmpty(this.ScreenObject.Preferences.BudgetFeild)&&e[b.ValueMember].toString()!=this.PrevValue){var r=this.ScreenObject._TextFields.find(e=>e.DBColumnName.toLowerCase()==this.ScreenObject.Preferences.BudgetFeild.toLowerCase());if(null!=r&&r.SelectedValue>0){let t=null,s=null;if(8==this.DocumentType||13==this.DocumentType?(b.ValueMember.toLowerCase().Contains("creditaccount")||b.ValueMember.toLowerCase().Contains("debitaccount"))&&(t=this.ScreenObject.FillBudgetDims(!0,r.SelectedValue,e,e[b.ValueMember].toString())):b.ValueMember.toLowerCase().Contains("creditaccount")?t=this.ScreenObject.FillBudgetDims(!1,r.SelectedValue,e,e[b.ValueMember].toString()):b.ValueMember.toLowerCase().Contains("debitaccount")&&(t=this.ScreenObject.FillBudgetDims(!0,r.SelectedValue,e,e[b.ValueMember].toString())),1==t.Tables[0].length&&(s=t.Tables[0][0]),null!=s)for(let i=0;i<Object.keys(s).length;i++)this.ScreenObject.GridDataColumns.Contains(Object.keys(s)[i])&&!n.e.IsEmpty(s[Object.keys(s)[i]])&&(e[Object.keys(s)[i]]=s[Object.keys(s)[i]].toString())}}this.ScreenObject.GridDataObj.updateRow(e)}}else this.IsInventoryVoucher&&s>5e4&&this.ScreenObject.PriceTaxcc.ContainsKey(s)&&this.ScreenObject.GridDataColumns.Contains(t+"_Key")&&n.e.String(e[t+"_Key"])!=this.PrevValue&&!n.e.IsEmpty(e.ProductID_Key)&&parseInt(e.ProductID_Key)>0?this.ReEvaluatePriceTax_3(e,s):38!=this.ScreenObject.DocumentType&&39!=this.ScreenObject.DocumentType||!a.a.SessionManager.Preferences.ContainsKey("POSItemCodeDimension")||a.a.SessionManager.Preferences.POSItemCodeDimension!=s.toString()||n.e.String(e[t+"_Key"])==this.PrevValue||!n.e.IsEmpty(e.ProductID_Key)&&parseInt(e.ProductID_Key)>0||this.AddProductData(e,!1,!1,!1,null,e[t].toString());if(this.ScreenObject.Preferences.ContainsKey("DimWiseAttachments")&&this.ScreenObject.Preferences.DimWiseAttachments==s.toString()&&b&&b.ValueMember&&!n.e.IsEmpty(e[b.ValueMember])&&parseInt(e[b.ValueMember])>0&&e[b.ValueMember].toString()!=this.PrevValue&&1==this.ScreenObject.GridData.find(t=>t[b.DisplayMember+"_Key"]==e[b.ValueMember]).length){let t=this.ScreenObject.GetFiles(s,parseInt(e[b.ValueMember]));t.Tables.length>0&&t.Tables[0].length>0&&this.DimWiseAttachment(t.Tables[0],e[b.DisplayMember].toString())}45==this.DocumentType&&null!=this.ProjDims&&this.ProjDims.Contains(s)&&this.FillWBS(!1)}if(45==this.DocumentType){if((t.startsWith("dcCCNID")||"dcalpha15"==t.toLowerCase()||"dcalpha16"==t.toLowerCase())&&("dcalpha15"==t.toLowerCase()&&Object.keys(e).Contains("dcAlpha15_Key")&&!n.e.IsEmpty(e.dcAlpha15_Key)&&(e.dcAlpha15=new Date(e.dcAlpha15_Key).ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm a")),"dcalpha16"==t.toLowerCase()&&Object.keys(e).Contains("dcAlpha16_Key")&&!n.e.IsEmpty(e.dcAlpha16_Key)&&(e.dcAlpha16=new Date(e.dcAlpha16_Key).ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm a")),"dcalpha22"==t.toLowerCase()&&Object.keys(e).Contains("dcAlpha22_Key")&&!n.e.IsEmpty(e.dcAlpha22_Key)&&(e.dcAlpha22=new Date(e.dcAlpha22_Key).ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm a")),"dcalpha23"==t.toLowerCase()&&Object.keys(e).Contains("dcAlpha23_Key")&&!n.e.IsEmpty(e.dcAlpha23_Key)&&(e.dcAlpha23=new Date(e.dcAlpha23_Key).ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm a")),null==this.dsProjWOffHol&&this.InitProjWOffsHolidays(),null!=this.dsProjWOffHol)){let s=!1;if(this.ScreenObject.Preferences.ContainsKey("ConsiderWeeklyOffsAndHolidays")&&!n.e.IsEmpty(this.ScreenObject.Preferences.ConsiderWeeklyOffsAndHolidays)&&(s=Object(o.j)(this.ScreenObject.Preferences.ConsiderWeeklyOffsAndHolidays)),this.ScreenObject.GridDataColumns.Contains("dcAlpha15_Key")&&!n.e.IsEmpty(e.dcAlpha15_Key)&&this.ScreenObject.GridDataColumns.Contains("dcAlpha16_Key")&&!n.e.IsEmpty(e.dcAlpha16_Key)&&e[t+"_Key"].toString()!=this.PrevValue){let t=0,i=0,a={odWHrs:t,odHrsPerDay:i},r=n.e.GetNoOfDays(this.dsProjWOffHol,new Date(e.dcAlpha15_Key),new Date(e.dcAlpha16_Key),s,e,this.DocumentDate,a);t=a.odWHrs,i=a.odHrsPerDay,e.dcAlpha17=r.toString(),e.dcAlpha30=i.ToString("0.00"),e.dcAlpha31=n.e.IsEmpty(e.dcAlpha30)?"0":t.ToString("0.00"),n.e.IsEmpty(e.dcAlpha30)||n.e.IsEmpty(e.dcAlpha31)||(e.dcAlpha32=parseFloat(e.dcAlpha30)>0?(parseFloat(e.dcAlpha31)/parseFloat(e.dcAlpha30)).ToString("0.00"):"0")}}(this.ScreenObject.GridDataColumns.Contains(t+"_Key")&&n.e.String(e[t+"_Key"])!=this.PrevValue&&!n.e.IsEmpty(e[t+"_Key"])&&("dcalpha15"==t.toLowerCase()||"dcalpha16"==t.toLowerCase())||"dcalpha18"==t.toLowerCase()||"dcalpha30"==t.toLowerCase()||"dcalpha31"==t.toLowerCase()||"dcalpha32"==t.toLowerCase()&&e[t].toString()!=this.PrevValue)&&this.FillWBS(!1)}if(this.NumFieldEditOptionValidation(b,e),this.ScreenObject.Data.Tables.length>0){let s=this.ScreenObject.Data.Tables[0];if(s.length>0&&b&&b.CostCenterID>0){if(3!=b.CostCenterID&&(s=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&e.LocalReference==b.ID),(s.length>0||a.a.SessionManager.Preferences.ContainsKey("LW CreditDebit")&&""!=a.a.SessionManager.Preferences["LW CreditDebit"]&&Object(o.j)(a.a.SessionManager.Preferences["LW CreditDebit"])&&50002==b.CostCenterID||a.a.SessionManager.Preferences.ContainsKey("DW CreditDebit")&&""!=a.a.SessionManager.Preferences["DW CreditDebit"]&&Object(o.j)(a.a.SessionManager.Preferences["DW CreditDebit"])&&50001==b.CostCenterID||a.a.SessionManager.Preferences.ContainsKey("DimWiseCreditDebit")&&""!=a.a.SessionManager.Preferences.DimWiseCreditDebit&&parseInt(a.a.SessionManager.Preferences.DimWiseCreditDebit)==b.CostCenterID||2==b.CostCenterID&&17==this.ScreenObject.DocumentType&&this.ScreenObject.Preferences.ContainsKey("Use Account-wise Currency")&&""!=this.ScreenObject.Preferences["Use Account-wise Currency"]&&Object(o.j)(this.ScreenObject.Preferences["Use Account-wise Currency"])&&!this.IsInventoryVoucher||2==b.CostCenterID&&(15==this.DocumentType||14==this.DocumentType)&&!this.IsInventoryVoucher&&"CreditAccount"==t||2==b.CostCenterID&&!this.IsInventoryVoucher&&this.ScreenObject.Preferences.ContainsKey("Account-wiseAttachments")&&""!=this.ScreenObject.Preferences["Account-wiseAttachments"]&&Object(o.j)(this.ScreenObject.Preferences["Account-wiseAttachments"])||b.Filter>0&&this.IsInventoryVoucher||this.ScreenObject.Preferences.ContainsKey("DefaultProfileID")&&""!=this.ScreenObject.Preferences.DefaultProfileID&&parseInt(this.ScreenObject.Preferences.DefaultProfileID)>0&&this.ScreenObject.DefaultBasedOn.ContainsKey(b.CostCenterID.toString()))&&b.ValueMember&&!n.e.IsEmpty(e[b.ValueMember])&&parseInt(e[b.ValueMember])>0&&e[b.ValueMember].toString()!=this.PrevValue&&this.ScreenObject.GetLinkReferenceData(parseInt(b.ID),this.DocumentID,parseInt(e[b.ValueMember]),Date.Today(),t,b.CostCenterID,e),2==b.CostCenterID)){let t=this.ScreenObject.ColumnSource.filter(e=>!n.e.IsEmpty(e.ValueMember)&&e.ValueMember.toLowerCase()==b.ValueMember.toLowerCase());t.length>1&&""!=b.ValueMember&&e[b.ValueMember]&&!n.e.IsEmpty(e[b.ValueMember])&&(t[0]==b?(s=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&e.LocalReference==t[t.length-1].ID),s.length>0&&this.ScreenObject.GetLinkReferenceData(parseInt(t[t.length-1].ID),this.DocumentID,parseInt(e[b.ValueMember]),Date.Today(),"",b.CostCenterID,e)):(s=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&e.LocalReference==t[0].ID),s.length>0&&this.ScreenObject.GetLinkReferenceData(parseInt(t[0].ID),this.DocumentID,parseInt(e[b.ValueMember]),Date.Today(),"",b.CostCenterID,e)))}if("ProductID"==t&&this.ScreenObject.Data.Tables.length>6&&this.ScreenObject.Data.Tables[6].length>0&&this.ScreenObject.Preferences.ContainsKey("Productwise")&&null!=this.ScreenObject.Preferences.Productwise&&Object(o.j)(this.ScreenObject.Preferences.Productwise)&&!n.e.IsEmpty(e.ProductID_Key)){let t=this.ScreenObject.GetProductLinkDetails(this.DocumentID,parseInt(e.ProductID_Key),this.ScreenObject.DocDate.Date.ToString("dd/MMM/yyyy"),this.ScreenObject.DueDate&&this.ScreenObject.DueDate.Date?this.ScreenObject.DueDate.Date.ToString("dd/MMM/yyyy"):"",e);if(null!=t&&t.Tables.length>0&&t.Tables[0].length>0)for(let e=0;e<t.Tables[0].length;e++){let s=this.ScreenObject.GridData.filter(s=>0==s.DocDetailsID&&s.LinkedInvDocDetailsID==t.Tables[0][e].DocDetailsID);if(s.length>0){let i=t.Columns[0][0],a=t.Columns[0][1],r=0;for(let o=0;o<s.length;o++)n.e.IsNum(s[o][t.Tables[0][e][a].toString()])&&(r+=parseFloat(s[o][t.Tables[0][e][a].toString()]));if(!(n.e.IsNum(t.Tables[0][e][i])&&parseFloat(t.Tables[0][e][i])-r>0)){t.Tables[0].RemoveAt(e),t.Tables[1].RemoveAt(e),t.Tables[2].RemoveAt(e),t.Tables[3].RemoveAt(e),e--;continue}t.Tables[0][e][i]=parseFloat(t.Tables[0][e][i])-r}}if(null!=t&&t.Tables.length>0&&t.Tables[0].length>0)return void a.a.page.ShowDialog(new ee(this,e.ProductID_Key.toString(),t,this.ScreenObject.GridData.indexOf(e)),te.a)}}}if(this.IsInventoryVoucher){if(!this.DonotUpdateInventory&&("Quantity"==t||"RecievedQty"==t||"FreeQTY"==t)&&""!=n.e.String(e.Type)&&2==parseInt(n.e.String(e.Type))&&(30==this.ScreenObject.DocumentType&&(this.VoucherType=this.ScreenObject.GridDataColumns.Contains("VoucherType")&&!n.e.IsEmpty(e.VoucherType)?parseInt(e.VoucherType):0),!n.e.IsEmpty(e[t])&&parseFloat(e[t])>0)){let s=new be(this,t,this.VoucherType,0,e);1==this.VoucherType&&null!=s.ds&&s.ds.Tables.length>3&&s.ds.Tables[3].length>0&&!n.e.IsEmpty(s.ds.Tables[3][0][0])?this.AutoSerialNumber(e,s):a.a.page.ShowDialog(s,Ce.a)}if(this.ScreenObject.Preferences.ContainsKey("EnableAssetSerialNo")&&"true"==this.ScreenObject.Preferences.EnableAssetSerialNo.toLowerCase()&&"Quantity"==t){let s=0;if(this.ScreenObject.Preferences.ContainsKey("AssetBasedOn")&&this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.Preferences.AssetBasedOn)?"0"==e[this.ScreenObject.Preferences.AssetBasedOn].toString()?s=0:"2"!=e[this.ScreenObject.Preferences.AssetBasedOn].toString()&&"1"!=e[this.ScreenObject.Preferences.AssetBasedOn].toString()||n.e.IsEmpty(e.Quantity)?"3"!=e[this.ScreenObject.Preferences.AssetBasedOn].toString()&&"4"!=e[this.ScreenObject.Preferences.AssetBasedOn].toString()||(s=1):s=parseFloat(e.Quantity):n.e.IsEmpty(e.Quantity)||(s=parseFloat(e.Quantity)),s>0){let i=new be(this,t,1,s,e);null!=i.ds&&i.ds.Tables.length>3&&i.ds.Tables[3].length>0&&!n.e.IsEmpty(i.ds.Tables[3][0][0])?this.AutoSerialNumber(e,i):a.a.page.ShowDialog(i,Ce.a)}}if(-1==this.VoucherType&&this.ScreenObject.Preferences.ContainsKey("AutoBatches")&&""!=this.ScreenObject.Preferences.AutoBatches.toString()&&Object(o.j)(this.ScreenObject.Preferences.AutoBatches)&&(i=1),1!=i&&(this.ScreenObject.Preferences.ContainsKey("ShowBatches")&&""!=this.ScreenObject.Preferences.ShowBatches&&Object(o.j)(this.ScreenObject.Preferences.ShowBatches)||!this.DonotUpdateInventory||32==this.DocumentType||this.ScreenObject.Preferences.ContainsKey("ExcludeReserve")&&""!=this.ScreenObject.Preferences.ExcludeReserve.toString()&&Object(o.j)(this.ScreenObject.Preferences.ExcludeReserve)&&this.ScreenObject.GridDataColumns.Contains("ReserveQuantity")||this.ScreenObject.Preferences.ContainsKey("ExcludeHold")&&""!=this.ScreenObject.Preferences.ExcludeHold.toString()&&Object(o.j)(this.ScreenObject.Preferences.ExcludeHold)&&this.ScreenObject.GridDataColumns.Contains("HoldQuantity")))if(32!=this.DocumentType||n.e.IsEmpty(e.Type)||5!=parseInt(n.e.String(e.Type)))"Quantity"==t&&!n.e.IsEmpty(e.Type)&&5==parseInt(e.Type)&&(!n.e.IsEmpty(e.Quantity)||this.ScreenObject.Preferences.ContainsKey("QtyonBatch")&&""!=this.ScreenObject.Preferences.QtyonBatch&&Object(o.j)(this.ScreenObject.Preferences.QtyonBatch))?this.fillbatches(e):"FreeQTY"!=t||n.e.IsEmpty(e.Type)||5!=parseInt(e.Type)||n.e.IsEmpty(e.FreeQTY)||this.fillbatches(e);else{let s="",i=this.ScreenObject.ColumnSource.find(e=>e.ID==this.ScreenObject.Preferences.VarienceField);i&&(s=i.DisplayMember),t==s&&this.fillbatches(e)}if("Quantity"!=t||!this.ScreenObject.GridDataColumns.Contains("landingType")||"1"!=n.e.String(e.landingType)&&"2"!=n.e.String(e.landingType)){if("Quantity"==t&&"2"!=n.e.String(e.Type)&&("5"!=n.e.String(e.Type)||this.ScreenObject.Preferences.ContainsKey("SameBatchtoall")&&"true"==this.ScreenObject.Preferences.SameBatchtoall.toLowerCase())&&"true"==n.e.LowerCase(e.BinWise)&&!n.e.IsEmpty(e.Quantity))this.AddBins(e,!1,!0,null);else if("RecievedQty"==t&&"2"!=n.e.String(e.Type)&&!n.e.IsEmpty(e.BinWise)&&"true"==n.e.LowerCase(e.BinWise)&&!n.e.IsEmpty(e.RecievedQty)){let t,s=0;a.a.SessionManager.Preferences.ContainsKey("DimensionwiseBins")&&""!=a.a.SessionManager.Preferences.DimensionwiseBins.toString()&&(s=n.e.Int(a.a.SessionManager.Preferences.DimensionwiseBins)),t=parseFloat(e.RecievedQty)>0?parseFloat(e.RecievedQty):0,this.ScreenObject.GridDataColumns.Contains("UOMConversion")&&!n.e.IsEmpty(e.UOMConversion)&&(t*=parseFloat(e.UOMConversion)),this.AddToWarehouseBins(s,e,t,!1)}}else 0==a.a.page.DialogCount&&a.a.page.ShowDialog(new le(this,2),ce.a,{ShowCenter:!0});if("ProductName"!=c&&"ProductCode"!=c||null==e.ProductID_Key||n.e.IsEmpty(e.ProductID_Key))if("ProductName"!=c&&"ProductCode"!=c||n.e.IsEmpty(e.ProductID_Key)){if(35==this.ScreenObject.DocumentType&&("dcAlpha13"==c||"dcAlpha14"==c)){let t=new Date,s=new Date;n.e.IsEmpty(e.dcAlpha13)||(t=new Date(e.dcAlpha13_Key)),n.e.IsEmpty(e.dcAlpha14)||(s=new Date(e.dcAlpha14_Key)),null!=t&&null!=s&&t.getFullYear()>1&&s.getFullYear()>1&&(e.dcAlpha15=this.DocumentDate>=t&&this.DocumentDate<=s?"Warranty":"Out of Warranty")}}else this.ScreenObject.Preferences.ContainsKey("Dontresetvaluesonproductchange")&&""!=this.ScreenObject.Preferences.Dontresetvaluesonproductchange&&Object(o.j)(this.ScreenObject.Preferences.Dontresetvaluesonproductchange)||this.ClearDatarow(e,!1);else{if(this.ScreenObject.Preferences.ContainsKey("Dontresetvaluesonproductchange")&&""!=this.ScreenObject.Preferences.Dontresetvaluesonproductchange&&Object(o.j)(this.ScreenObject.Preferences.Dontresetvaluesonproductchange)&&this.ProdID>0){if(this.ProdID!=parseInt(e.ProductID_Key)&&0!=parseInt(e.ProductID_Key)){let t=this.GetProductValues(e,0);if(null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&!t.Columns[0].Contains("ErrorMessage")&&(e.Type=t.Tables[0][0].ProductTypeID.toString(),this.ScreenObject.GridDataColumns.Contains("BinWise")&&t.Columns[0].Contains("BinWise")&&(e.BinWise=n.e.String(t.Tables[0][0].BinWise)),this.ScreenObject.GridDataColumns.Contains("QtyType")&&t.Columns[0].Contains("QtyAdjustType")&&(e.QtyType=n.e.String(t.Tables[0][0].QtyAdjustType)),this.ScreenObject.GridDataColumns.Contains("PackType")&&t.Columns[0].Contains("IsPacking")&&(e.PackType=n.e.String(t.Tables[0][0].IsPacking)),this.ScreenObject.GridDataColumns.Contains("IsTestCase")&&t.Columns[0].Contains("TestCaseExists")&&(e.IsTestCase=n.e.String(t.Tables[0][0].TestCaseExists)),this.ScreenObject.GridDataColumns.Contains("landingType")&&t.Columns[0].Contains("IsBillOfEntry")&&(e.landingType=n.e.String(t.Tables[0][0].IsBillOfEntry)),this.ScreenObject.GridDataColumns.Contains("SchemeProductID")&&(e.SchemeProductID=null),e.ExtraXML=null),this.ScreenObject.Preferences.ContainsKey("ResetFields")&&""!=this.ScreenObject.Preferences.ResetFields.toString()){let s=[],i=this.ScreenObject.Preferences.ResetFields.toString().split(",");for(let c=0;c<i.length;c++){s.push(i[c]),this.ScreenObject.GridDataColumns.Contains(i[c])&&(e[i[c]]=null),this.ScreenObject.GridDataColumns.Contains(i[c]+"_Key")&&(e[i[c]+"_Key"]=null);let r=!1;if("debitaccount"==i[c].toLowerCase()&&this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!n.e.IsEmpty(t.Tables[0][0].DrAccount)){if(n.e.String(e.DebitAccount_Key)!=t.Tables[0][0].DrAccount.toString()&&(r=!0),e.DebitAccount_Key=t.Tables[0][0].DrAccount.toString(),this.ScreenObject.GridDataColumns.Contains("DebitAccount")?e.DebitAccount=t.Tables[0][0].DrName.toString():null!=(l=this.ScreenObject.ColumnSource.find(e=>null!=e.ValueMember&&"debitaccount_key"==e.ValueMember.toLowerCase()))&&(e[l.DisplayMember]=t.Tables[0][0].DrName.toString()),r){var l=this.ScreenObject.ColumnSource.find(e=>null!=e.ValueMember&&"debitaccount_key"==e.ValueMember.toLowerCase());this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&e.LocalReference==l.ID).length>0&&this.ScreenObject.GetLinkReferenceData(parseInt(b.ID),this.DocumentID,parseInt(e[l.ValueMember]),new Date,"",l.CostCenterID,e),a.a.SessionManager.Preferences.BudgetAccount.length>0&&a.a.SessionManager.Preferences.BudgetDimension.length>0&&this.BudgetObj.AutoLoadBudgetDimension(e,null)}}else if("creditaccount"==i[c].toLowerCase()&&this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!n.e.IsEmpty(t.Tables[0][0].CrAccount))n.e.String(e.CreditAccount_Key)!=t.Tables[0][0].CrAccount.toString()&&(r=!0),e.CreditAccount_Key=t.Tables[0][0].CrAccount.toString(),this.ScreenObject.GridDataColumns.Contains("CreditAccount")?e.CreditAccount=t.Tables[0][0].CrName.toString():null!=(l=this.ScreenObject.ColumnSource.find(e=>null!=e.ValueMember&&"creditaccount_key"==e.ValueMember.toLowerCase()))&&(e[l.DisplayMember]=t.Tables[0][0].CrName.toString()),r&&(l=this.ScreenObject.ColumnSource.find(e=>null!=e.ValueMember&&"creditaccount_key"==e.ValueMember.toLowerCase()),this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&e.LocalReference==l.ID).length>0&&this.ScreenObject.GetLinkReferenceData(parseInt(b.ID),this.DocumentID,parseInt(e[l.ValueMember]),new Date,"",l.CostCenterID,e),a.a.SessionManager.Preferences.BudgetAccount.length>0&&a.a.SessionManager.Preferences.BudgetDimension.length>0&&this.BudgetObj.AutoLoadBudgetDimension(e,null));else{let s=t.Tables[4].filter(e=>e.SysColumnName=i[c]);s.length>0?(e[i[c]]=n.e.String(s[0].Value),e["default"+i[c]]=n.e.String(s[0].Value)):(s=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName==i[c]&&null!=e.LinkData&&e.LinkData>0),s.length>0?this.FillLinkRefereceProducts(e,t.Tables[0],t.Tables[3].length>0?t.Tables[3][0]:null,n.e.String(s[0].LinkData)):"Unit"==i[c]&&t.Tables.length>0&&t.Columns[0].Contains("uomid")&&!n.e.IsEmpty(t.Tables[0][0].uomid)?(e.Unit=n.e.String(t.Tables[0][0].UnitName),e.Unit_Key=n.e.String(t.Tables[0][0].uomid)):"Rate"==i[c]&&(t.Tables.length>3&&t.Tables[3].length>0?1==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||10==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||31==this.ScreenObject.DocumentType?n.e.IsEmpty(t.Tables[3][0].PurchaseRate)||(e.Rate=t.Tables[3][0].PurchaseRate):n.e.IsEmpty(t.Tables[3][0].SellingRate)||(e.Rate=t.Tables[3][0].SellingRate):t.Tables.length>0&&t.Tables[0].length>0&&(1==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||10==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||31==this.ScreenObject.DocumentType?n.e.IsEmpty(t.Tables[0][0].PurchaseRate)||(e.Rate=t.Tables[0][0].PurchaseRate):n.e.IsEmpty(t.Tables[0][0].SellingRate)||(e.Rate=t.Tables[0][0].SellingRate))))}}let r=this.ScreenObject.Data.Tables[0].filter(e=>s.Contains(e.SysColumnName)&&null!=e.LocalReference&&e.LocalReference==b.ID);r.length>0&&this.ScreenObject.GetLinkReferenceData(parseInt(b.ID),this.DocumentID,parseInt(e.ProductID_Key),Date.Today(),"",3,e,i,!1);let o=this.ScreenObject.ColumnSource.find(e=>!n.e.IsEmpty(e.ValueMember)&&e.ValueMember.toLowerCase()==b.ValueMember.toLowerCase()&&e.ID!=b.ID);o&&(r=this.ScreenObject.Data.Tables[0].filter(e=>s.Contains(e.SysColumnName)&&null!=e.LocalReference&&e.LocalReference==o.ID),r.length>0&&this.ScreenObject.GetLinkReferenceData(parseInt(o.ID),this.DocumentID,parseInt(e.ProductID_Key),Date.Today(),"",3,e,i,!1))}}}else if(this.AddProductData(e,!1,!1),this.ScreenObject.GridDataColumns.Contains("SchemeProductID")&&(e.SchemeProductID=null),null!=this.barcodeValues&&this.barcodeValues.length>0){if(this.barcodeValues.keys.forEach(t=>{let s={Key:t,Value:this.barcodeValues[t]};if(this.ScreenObject.GridDataColumns.Contains(s.Key))if(this.ScreenObject.GridDataColumns.Contains(s.Key+"_Key")){let t=this.ScreenObject.ColumnSource.find(e=>e.DisplayMember.toLowerCase()==s.Key.toLowerCase());if(t&&t.CostCenterID>0){let i=this.ScreenObject.GetCCListViewDataID(t.CostCenterID,t.TypeID,s.Value.toString());null!=i&&i.Tables.length>0&&i.Tables[0].length>0&&i.Columns[0].Contains("NodeID")&&!n.e.IsEmpty(i.Tables[0][0].NodeID)&&(e[s.Key+"_Key"]=i.Tables[0][0].NodeID.toString(),e[s.Key]=s.Value)}else if("DATE"==t.DataType||"DATETIME"==t.DataType){let i;n.e.isValidDate(s.Value)&&(i=new Date(s.Value),e[s.Key+"_Key"]=i,e[s.Key]=i.ToString("DATE"==t.DataType?a.a.SessionManager.Preferences["Date Format"]:a.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss tt"))}}else e[s.Key]=s.Value;else{let t=this.ScreenObject.ColumnSource.find(e=>!n.e.IsEmpty(e.ValueMember)&&e.ValueMember.toLowerCase()==s.Key.toLowerCase()+"_key");if(t&&t.CostCenterID>0){let i=this.ScreenObject.GetCCListViewDataID(t.CostCenterID,t.TypeID,s.Value.toString());null!=i&&i.Tables.length>0&&i.Tables[0].length>0&&i.Columns[0].Contains("NodeID")&&!n.e.IsEmpty(i.Tables[0][0].NodeID)&&(e[t.ValueMember]=i.Tables[0][0].NodeID.toString(),e[t.DisplayMember]=s.Value)}}}),this.barcodeValues.ContainsKey("INVID")&&this.ScreenObject.GridDataColumns.Contains("DocExtraXML")){e.DocExtraXML='<DocExtraXML><Row RefID="'+this.barcodeValues.INVID+'" Qty="'+e.Quantity.toString()+'" Type="1" ></Row></DocExtraXML>',e.BOEID=this.barcodeValues.INVID.toString();let t=this.ScreenObject.GetinvBinDetails(this.barcodeValues.INVID.toString(),e.ProductID_Key.toString(),e.LinkedInvDocDetailsID.toString());null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&this.AddBins(e,!1,!1,t)}if(-1==this.VoucherType&&"5"==n.e.String(e.Type)&&(this.barcodeValues.ContainsKey("Batch_Code")||this.barcodeValues.ContainsKey("Batch_No"))){let t=0,s=0;if(this.ScreenObject.Preferences.ContainsKey("Donotuselocation")&&""!=this.ScreenObject.Preferences.Donotuselocation&&Object(o.j)(this.ScreenObject.Preferences.Donotuselocation)){let t=this.ScreenObject._CCFields.find(e=>"dcccnid2"==e.DBColumnName.toLowerCase());t&&t instanceof m.b&&t.SelectedValue>0?s=t.SelectedValue:null==e||n.e.IsEmpty(e.dcCCNID2_Key)||(s=parseInt(e.dcCCNID2_Key))}else s=this.ScreenObject.LocationID>0?this.ScreenObject.LocationID:a.a.SessionManager.LocationID;t=this.ScreenObject.DivisionID>0?this.ScreenObject.DivisionID:a.a.SessionManager.DivisionID;let i=0;!n.e.IsEmpty(e.Quantity)&&parseFloat(e.Quantity)>0?i=parseFloat(e.Quantity):!n.e.IsEmpty(e.FreeQTY)&&parseFloat(e.FreeQTY)>0&&(i=parseFloat(e.FreeQTY)),n.e.IsEmpty(e.UOMConversion)||(i*=parseFloat(e.UOMConversion));let r=new Te.a(this.ScreenObject.GridDataObj);r.BatchNumberViewModel_3(this,this.VoucherType,i,parseInt(e.ProductID_Key),e.ProductName.toString(),s,t,e);for(let e=0;e<r.GridData.length;e++){if(this.barcodeValues.ContainsKey("Batch_Code")&&r.GridData[e].BatchCode.toString().toLowerCase()==this.barcodeValues.Batch_Code.toString().toLowerCase()){r.SelectQty(r.GridData[e]);break}if(this.barcodeValues.ContainsKey("Batch_No")&&r.GridData[e].BATCHNUMBER.toString().toLowerCase()==this.barcodeValues.Batch_No.toString().toLowerCase()){r.SelectQty(r.GridData[e]);break}}r.DisplayMessage="",r.OnSave("AutoSave"),""!=r.DisplayMessage&&a.a.page.ShowDialog(r,je.a)}this.barcodeValues.Clear()}if((!this.ScreenObject.Preferences.ContainsKey("SubonProdChange")||""==this.ScreenObject.Preferences.SubonProdChange.toString()||!Object(o.j)(this.ScreenObject.Preferences.SubonProdChange))&&(!this.ScreenObject.Preferences.ContainsKey("SubstituteOnQty")||""==this.ScreenObject.Preferences.SubstituteOnQty.toString()||!this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.Preferences.SubstituteOnQty))&&this.ScreenObject.Preferences.ContainsKey("EnableSubtitutes")&&""!=this.ScreenObject.Preferences.EnableSubtitutes.toString()&&Object(o.j)(this.ScreenObject.Preferences.EnableSubtitutes)&&!n.e.IsEmpty(e.ProductID_Key)&&parseInt(e.ProductID_Key)==this.ProdID&&("1"==n.e.String(e.Subexists)||this.ScreenObject.IsDocEdit)){let t=this.ScreenObject.GetSubtituteProducts(parseInt(e.ProductID_Key),this.DocumentDate,e.DocDetailsID.toString(),e);if(t.Tables.length>0&&!t.Columns[0].Contains("ErrorMessage")&&t.Tables[0].length>1){let s=new De.a(this,t.Tables[0],t.Columns[0],t.Tables[1],e.ProductName.toString(),e.ProductCode.toString(),e.ProductID_Key.toString());s.GridData.length>0&&a.a.page.ShowDialog(s,Se.a,{ShowCenter:!0})}}}Logger.InfoLog("AddEditDocumentViewModel::Entering OnCellEditEnding")}else"CreditAccount"!=t&&"DebitAccount"!=t&&"AccountCode"!=t&&"AccountName"!=t&&"AccountID"!=t&&"AccountID_Key"!=t||(b&&this.ScreenObject.GridDataColumns.Contains(b.ValueMember)&&!n.e.IsEmpty(e[b.ValueMember])&&this.RepeatRowData(e),this.BindDivisionorLocation(e),null==e[t]||n.e.IsEmpty(e[t])||(this.ScreenObject.ColumnSource.filter(e=>e.DisplayMember.Contains("dcNum")).forEach(t=>{this.ScreenObject.GridDataColumns.Contains("dcCurrID"+t.DisplayMember.replace("dcNum","").toString()+"_Key")&&(e["dcCurrID"+t.DisplayMember.replace("dcNum","").toString()+"_Key"]=t.DefaultValue),this.ScreenObject.GridDataColumns.Contains("dcExchRT"+t.DisplayMember.replace("dcNum","").toString())&&(e["dcExchRT"+t.DisplayMember.replace("dcNum","").toString()]=this.ScreenObject.GetExchangeRate(parseInt(t.DefaultValue),this.DocumentDate))}),this.ScreenObject.GridDataObj.updateRow(e)),"AccountCode"!=t&&"AccountName"!=t||(18!=this.ScreenObject.DocumentType&&19!=this.ScreenObject.DocumentType&&21!=this.ScreenObject.DocumentType&&22!=this.ScreenObject.DocumentType||n.e.IsEmpty(e.CreditAccount_Key)||this.ScreenObject.Preferences.ContainsKey("Valueonbillwise")&&""!=this.ScreenObject.Preferences.Valueonbillwise&&Object(o.j)(this.ScreenObject.Preferences.Valueonbillwise)&&this.CheckIsBillWise(parseInt(e.CreditAccount_Key.toString()),e,t,0,!0,D,S),14!=this.ScreenObject.DocumentType&&15!=this.ScreenObject.DocumentType&&20!=this.ScreenObject.DocumentType&&23!=this.ScreenObject.DocumentType||n.e.IsEmpty(e.DebitAccount_Key)||this.ScreenObject.Preferences.ContainsKey("Valueonbillwise")&&""!=this.ScreenObject.Preferences.Valueonbillwise&&Object(o.j)(this.ScreenObject.Preferences.Valueonbillwise)&&this.CheckIsBillWise(parseInt(e.DebitAccount_Key.toString()),e,t,0,!1,D,S)));if(2==b.CostCenterID&&a.a.SessionManager.Preferences.BudgetAccount.length>0&&a.a.SessionManager.Preferences.BudgetDimension.length>0&&e[b.ValueMember].toString()!=this.PrevValue&&this.BudgetObj.AutoLoadBudgetDimension(e,null),!this.IsInventoryVoucher&&this.ScreenObject.Preferences.ContainsKey("DbCrBills")&&"True"==n.e.String(this.ScreenObject.Preferences.DbCrBills)&&this.ScreenObject.Preferences.ContainsKey("NetAmountFld")&&this.ScreenObject.Preferences.NetAmountFld==t||this.CalculateTotals(e,!1,t),!this.IsInventoryVoucher){let s="";if(this.ScreenObject.Preferences.ContainsKey("DbCrBills")&&"True"==n.e.String(this.ScreenObject.Preferences.DbCrBills)&&this.ScreenObject.Preferences.ContainsKey("NetAmountFld")&&!n.e.IsEmpty(this.ScreenObject.Preferences.NetAmountFld)&&(s=this.ScreenObject.Preferences.NetAmountFld),""==s&&"Amount"==t||s==t){let i=!1;this.ScreenObject.Preferences.ContainsKey("Valueonbillwise")&&(i=Object(o.j)(this.ScreenObject.Preferences.Valueonbillwise)),null!=e[t]&&0!=parseFloat(e[t])&&(18==this.ScreenObject.DocumentType||19==this.ScreenObject.DocumentType||21==this.ScreenObject.DocumentType||22==this.ScreenObject.DocumentType?this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!n.e.IsEmpty(e.CreditAccount_Key)&&(n.e.IsEmpty(e[t])||i||this.CheckIsBillWise(parseInt(e.CreditAccount_Key),e,t,parseFloat(e[t]),!0,D,S,"",s,()=>{this.ChequeReturn(parseInt(e.CreditAccount_Key),e,t,parseFloat(e[t]),!0,D,S)})):14!=this.ScreenObject.DocumentType&&15!=this.ScreenObject.DocumentType&&20!=this.ScreenObject.DocumentType&&23!=this.ScreenObject.DocumentType||this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!n.e.IsEmpty(e.DebitAccount_Key)&&(n.e.IsEmpty(e[t])||i||this.CheckIsBillWise(parseInt(e.DebitAccount_Key),e,t,parseFloat(e[t]),!1,D,S,"",s,()=>{this.ChequeReturn(parseInt(e.DebitAccount_Key),e,t,parseFloat(e[t]),!1,D,S)})))}else"DebitAmount"==t?null==e[t]||0==parseFloat(e[t])||n.e.IsEmpty(e.AccountID_Key)||(n.e.IsEmpty(e[t])||(this.CheckIsBillWise(parseInt(e.AccountID_Key),e,t,parseFloat(e[t]),!1,D,S),this.ChequeReturn(parseInt(e.AccountID_Key),e,t,parseFloat(e[t]),!1,D,S)),this.ScreenObject.GridDataColumns.Contains("CreditAmount")&&(e.CreditAmount=0)):"CreditAmount"==t&&(null==e[t]||0==parseFloat(e[t])||n.e.IsEmpty(e.AccountID_Key)||(this.CheckIsBillWise(parseInt(e.AccountID_Key),e,t,parseFloat(e[t]),!0,D,S),this.ChequeReturn(parseInt(e.AccountID_Key),e,t,parseFloat(e[t]),!0,D,S),this.ScreenObject.GridDataColumns.Contains("DebitAmount")&&(e.DebitAmount=0)))}null!=b&&this.ValidateData_Column(b,e);let p=!1;if(this.ScreenObject.Preferences.ContainsKey("EnableSchemes")&&Object(o.j)(this.ScreenObject.Preferences.EnableSchemes)&&(p=Object(o.j)(this.ScreenObject.Preferences.EnableSchemes)),p){let s="GROSS";if(this.ScreenObject.Preferences.ContainsKey("SchemesNumericFields")&&""!=this.ScreenObject.Preferences.SchemesNumericFields&&"0"!=this.ScreenObject.Preferences.SchemesNumericFields){let e=this.ScreenObject.ColumnSource.find(e=>e.ID==this.ScreenObject.Preferences.SchemesNumericFields);e&&""!=e.DisplayMember&&(s=e.DisplayMember)}if("Quantity"==t||"ProductID"==t||t.toLowerCase()==s.toLowerCase()){if(!n.e.IsEmpty(e.ProductID_Key)&&parseInt(e.ProductID_Key)>0){let t=this.ScreenObject.GetSchemes(this.DocumentDate,e);t.Tables.length>0&&t.Columns[0].Contains("SchemeID")&&this.fillSchemevalues(t.Tables[0],t.Columns[0],e)}this.ApplySchemes(e)}}if(s>0)for(let t=0;t<this.ScreenObject.ColumnSource.length;t++)"ModSelect"!=this.ScreenObject.ColumnSource[t].DisplayMember&&"ModifierName"!=this.ScreenObject.ColumnSource[t].DisplayMember&&"LINK"==this.ScreenObject.ColumnSource[t].DataType&&!this.ScreenObject.ColumnSource[t].Dependantinuse&&this.ScreenObject.ColumnSource[t].Mandatory&&!n.e.IsEmpty(this.ScreenObject.ColumnSource[t].FilterCondition)&&this.ScreenObject.ColumnSource[t].FilterCondition.split(",").Contains(s.toString())&&this.RowAttachments(this.ScreenObject.ColumnSource[t].DisplayMember,!0,e);if(62==this.ScreenObject.DocumentType&&("dcccnid52"==t.toLowerCase()||"dcalpha4"==t.toLowerCase())||40058==this.ScreenObject.CostCenterID&&"dcccnid52"==t.toLowerCase()){let t,s;t=s=0;let i=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());(null!=i&&i instanceof m.b&&i.SelectedValue>0||null!=i&&i instanceof C.a&&i.SelectedValue>0)&&(t=i.SelectedValue);let a=this.ScreenObject.ColumnSource.find(e=>50052==e.CostCenterID);if(a&&a instanceof y.a&&null!=e[a.ValueMember]&&(s=parseInt(e[a.ValueMember])),t>0&&s>0){let i={IfFormulaExistsNoOfDays:!1};if(this.DisplayMessage=this.IsLeaveTypeValid(t,s,e,i),""!=this.DisplayMessage){if(40058==this.ScreenObject.CostCenterID&&(a=this.ScreenObject.ColumnSource.find(e=>"dcalpha1"==e.DisplayMember.toLowerCase()),a&&(e[a.DisplayMember]=0)),!i.IfFormulaExistsNoOfDays)return a=this.ScreenObject.ColumnSource.find(e=>"dcalpha2"==e.DisplayMember.toLowerCase()),a&&(e[a.DisplayMember]=0),a=this.ScreenObject.ColumnSource.find(e=>"dcalpha3"==e.DisplayMember.toLowerCase()),void(a&&(e[a.DisplayMember]=0))}else this.MessageVisibility=!1}this.ScreenObject.GridDataObj.updateRow(e)}if(40055==this.ScreenObject.CostCenterID&&"dcalpha1"==t.toLowerCase()&&null!=e.dcAlpha1||40057==this.ScreenObject.CostCenterID&&("dcalpha5"==t.toLowerCase()&&null!=e.dcAlpha5||"dcalpha4"==t.toLowerCase()&&null!=e.dcAlpha4)){if(this.DisplayMessage=this.IsDateValid(e,t),this.DisplayMessage)return void(e.Rate=-1);e.Rate=0,this.MessageVisibility=!1}if(40060==this.ScreenObject.CostCenterID&&60==this.ScreenObject.DocumentType){if(("dcAlpha3"==t||"dcAlpha4"==t)&&null!=e.dcAlpha3_Key&&null!=e.dcAlpha4_Key){if(e.dcAlpha3=new Date(e.dcAlpha3_Key).ToString(a.a.SessionManager.Preferences["Date Format"]),e.dcAlpha4=new Date(e.dcAlpha4_Key).ToString(a.a.SessionManager.Preferences["Date Format"]),"dcAlpha3"==t&&(new Date(e.dcAlpha3_Key)>new Date(e.dcAlpha4_Key)?(h="Fromdate should be less than or equal to Todate\r\n",e.dcNum6=2):e.dcNum6=0),"dcAlpha4"==t&&(new Date(e.dcAlpha4_Key)<new Date(e.dcAlpha3_Key)?(h="Todate should be greater than or equal to Fromdate\r\n",e.dcNum6=2):e.dcNum6=0),h)return void(this.DisplayMessage=h);this.DisplayMessage=""}if("dcAlpha4"==t&&null!=e.dcAlpha4_Key&&null!=e.dcAlpha5_Key){if(new Date(e.dcAlpha4_Key)>new Date(e.dcAlpha5_Key))return e.dcNum6=1,void(this.DisplayMessage="ToDate should be less than Leaveyear enddate ("+new Date(e.dcAlpha5_Key).ToString("dd-MMM-yyyy")+")");e.dcNum6=0,this.DisplayMessage="",this.MessageVisibility=!1}}if(62==this.ScreenObject.DocumentType){if(parseInt(e.DocDetailsID)>0&&2==parseInt(e.dcAlpha10)&&3==b.Mode&&("dcAlpha4"==t||"dcccnid52"==t.toLowerCase())){let s=0;s=parseInt(e.DocSeqNo);for(let i=0;i<this.dtData.length;i++)if(i==s-1&&parseInt(e.dcCCNID52_Key)==parseInt(this.dtData[i].dcCCNID52))return void("dcAlpha4"==t&&null!=e.dcAlpha4_Key&&new Date(e.dcAlpha4_Key)>new Date(e.dcAlpha5_Key)&&"Both"==n.e.String(e.dcAlpha6)&&(e.dcAlpha5=new Date(e.dcAlpha4_Key).AddDays(1),e.dcAlpha5_Key=new Date(e.dcAlpha4_Key).AddDays(1)))}if(("dcAlpha4"==t||"dcAlpha5"==t||"dcAlpha6"==t)&&null!=e.dcAlpha4_Key&&null!=e.dcAlpha5_Key){if(e.dcAlpha4=new Date(e.dcAlpha4_Key).ToString(a.a.SessionManager.Preferences["Date Format"]),e.dcAlpha5=new Date(e.dcAlpha5_Key).ToString(a.a.SessionManager.Preferences["Date Format"]),"dcAlpha4"==t&&(new Date(e.dcAlpha4_Key)>new Date(e.dcAlpha5_Key)&&"Both"==n.e.String(e.dcAlpha6)&&(e.dcAlpha5=new Date(e.dcAlpha4_Key).ToString(a.a.SessionManager.Preferences["Date Format"]),e.dcAlpha5_Key=new Date(e.dcAlpha4_Key)),new Date(e.dcAlpha5_Key)>=new Date(e.dcAlpha4_Key)&&"Both"==n.e.String(e.dcAlpha6))){let t=this.ScreenObject.ColumnSource.find(e=>"dcAlpha5"==e.DisplayMember);t&&!n.e.IsEmpty(t.Shortcut)&&"lostfocus"==t.Shortcut.toLowerCase()&&this.ValidateData_Column(t,e,!0)&&this.ScreenObject.GetExternalFuncData(t.Mode,t.SPName,t.IPParams,t.OPParams,e)}if("dcAlpha5"==t){let t,s;new Date(e.dcAlpha5_kKey)<new Date(e.dcAlpha4_Key)&&"Both"==n.e.String(e.dcAlpha6)&&(e.dcAlpha4=new Date(e.dcAlpha5_Key).ToString(a.a.SessionManager.Preferences["Date Format"]),e.dcAlpha4_Key=new Date(e.dcAlpha5_Key),h="Todate should be greater than or equal to Fromdate\r\n"),t=s=0;let i=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());(i instanceof m.b&&i.SelectedValue>0||i instanceof C.a&&i.SelectedValue>0)&&(t=i.SelectedValue);let r=this.ScreenObject.ColumnSource.find(e=>50052==e.CostCenterID);if(r&&r instanceof y.a&&null!=e[r.ValueMember]&&(s=parseInt(e[r.ValueMember])),t>0&&s>0){let i=n.e.GetPayrollStructureBasedonEmployee(t,new Date(e.dcAlpha4_Key)).Tables[0].filter(e=>4==e.Type&&e.ComponentID==s);if(null!=i&&i.length>0&&null!=i[0].LeaveOthFeatures&&null!=i[0].LeaveOthFeatures&&""!=i[0].LeaveOthFeatures.toString().trim()){let s=0,r=i[0].LeaveOthFeatures.toString().split(";");if(null!=r&&r.length>0)for(let i=0;i<r.length;i++){if(null!=r[i]&&r[i].startsWith("#ContLeaveS_")){let o=r[i].replace("#","").split("_");if(o.length>2){let i=parseInt(o[1]);if(new Date(e.dcAlpha5_Key).Date().Subtract(new Date(e.dcAlpha4_Key).Date()).TotalDays+1>=i){let i=1,r=0;do{r=0;let i=new Date(e.dcAlpha5_Key).Date();null==this.objPayDayCheck&&(this.objPayDayCheck=new at.a(this.ScreenObject)),this.objPayDayCheck.CheckIsHolidayDate(t.toString(),i.AddDays(1).ToString("dd/MMM/yyyy"),e),n.e.IsEmpty(e.PayrollType)||("WeeklyOff"==e.PayrollType.toString()&&"W"==n.e.String(o[2])||"Holiday"==e.PayrollType.toString()&&"H"==n.e.String(o[2])||("WeeklyOff"==e.PayrollType.toString()||"Holiday"==e.PayrollType.toString())&&"WH"==n.e.String(o[2]))&&(0==s?confirm("WeeklyOff/Holiday days will be considered, Are you sure want to Proceed.? ")?(e.dcAlpha5=i.AddDays(1).ToString(a.a.SessionManager.Preferences["Date Format"]),e.dcAlpha5_Key=new Date(i.AddDays(1)),r=1,s=1):(e.dcAlpha5=e.dcAlpha4,e.dcAlpha5_Key=e.dcAlpha4_Key):(e.dcAlpha5=i.AddDays(1).ToString(a.a.SessionManager.Preferences["Date Format"]),e.dcAlpha5_Key=new Date(i.AddDays(1)),r=1),this.ScreenObject.GridDataObj.updateRow(e))}while(i==r)}}}if(null!=r[i]&&r[i].startsWith("#ContLeaveP_")){let o=r[i].replace("#","").split("_");if(o.length>2){let i=parseInt(o[1]);if(new Date(e.dcAlpha5_Key).Date().Subtract(new Date(e.dcAlpha4_Key).Date()).TotalDays+1>=i){let i=1,r=0;do{r=0;let i=new Date(e.dcAlpha4_Key).Date();null==this.objPayDayCheck&&(this.objPayDayCheck=new at.a(this.ScreenObject)),this.objPayDayCheck.CheckIsHolidayDate(t.toString(),i.AddDays(-1).ToString("dd/MMM/yyyy"),e),n.e.IsEmpty(e.PayrollType)||("WeeklyOff"==e.PayrollType.toString()&&"W"==n.e.String(o[2])||"Holiday"==e.PayrollType.toString()&&"H"==n.e.String(o[2])||("WeeklyOff"==e.PayrollType.toString()||"Holiday"==e.PayrollType.toString())&&"WH"==n.e.String(o[2]))&&(0==s?confirm("WeeklyOff/Holiday days will be considered, Are you sure want to Proceed.? ")?(e.dcAlpha4=i.AddDays(-1).ToString(a.a.SessionManager.Preferences["Date Format"]),e.dcAlpha4_Key=i.AddDays(-1),r=1,s=1):(e.dcAlpha4=e.dcAlpha5,e.dcAlpha4_Key=e.dcAlpha5_Key):(e.dcAlpha4=i.AddDays(-1).ToString(a.a.SessionManager.Preferences["Date Format"]),e.dcAlpha4_Key=new Date(i.AddDays(-1)),r=1),this.ScreenObject.GridDataObj.updateRow(e))}while(i==r)}}}}}}}if(h)return void(this.DisplayMessage=h);this.DisplayMessage=""}if(this.ScreenObject.GridData.length>1&&!n.e.IsEmpty(this.ScreenObject.GridData[1].dcCCNID52_Key)){let t;t=parseInt(e[Object.keys(e)[1]])-1;for(let e=0;e<this.ScreenObject.GridData.length-1;e++){if(e!=t&&!n.e.IsEmpty(this.ScreenObject.GridData[e].dcAlpha4_Key)&&!n.e.IsEmpty(this.ScreenObject.GridData[t].dcAlpha5_Key)){if(new Date(this.ScreenObject.GridData[t].dcAlpha4_Key)>=new Date(this.ScreenObject.GridData[e].dcAlpha4_Key)&&new Date(this.ScreenObject.GridData[t].dcAlpha4_Key)<=new Date(this.ScreenObject.GridData[e].dcAlpha5_Key)||new Date(this.ScreenObject.GridData[e].dcAlpha4_Key)>=new Date(this.ScreenObject.GridData[t].dcAlpha4_Key)&&new Date(this.ScreenObject.GridData[e].dcAlpha4_Key)<=new Date(this.ScreenObject.GridData[t].dcAlpha5_Key))return this.DisplayMessage="FromDate already exist",void(this.ScreenObject.GridData[t].dcAlpha7=0);this.DisplayMessage=""}if(e!=t&&!n.e.IsEmpty(this.ScreenObject.GridData[e].dcAlpha5_Key)&&!n.e.IsEmpty(this.ScreenObject.GridData[t].dcAlpha4_Key)){if(e!=t&&new Date(this.ScreenObject.GridData[t].dcAlpha5_Key)>=new Date(this.ScreenObject.GridData[e].dcAlpha4_Key)&&new Date(this.ScreenObject.GridData[t].dcAlpha5_Key)<=new Date(this.ScreenObject.GridData[e].dcAlpha5_Key)||new Date(this.ScreenObject.GridData[e].dcAlpha5_Key)>=new Date(this.ScreenObject.GridData[t].dcAlpha4_Key)&&new Date(this.ScreenObject.GridData[e].dcAlpha5_Key)<=new Date(this.ScreenObject.GridData[t].dcAlpha5_Key))return this.DisplayMessage="ToDate already exist",void(this.ScreenObject.GridData[t].dcAlpha7=0);parseInt(this.ScreenObject.GridData[t].dcCCNID52_Key)==parseInt(this.ScreenObject.GridData[e].dcCCNID52_Key)&&parseFloat(this.ScreenObject.GridData[t].dcAlpha3)==parseFloat(this.ScreenObject.GridData[e].dcAlpha3)&&(this.ScreenObject.GridData[t].dcAlpha3=parseFloat(this.ScreenObject.GridData[t].dcAlpha3)-parseFloat(this.ScreenObject.GridData[e].dcAlpha7)),this.DisplayMessage=""}}}}if(63==this.ScreenObject.DocumentType){if(this.ScreenObject.GridDataObj.updateRow(e),parseInt(e.DocDetailsID)>0&&3==b.Mode&&("dcAlpha4"==t||"dcccnid52"==t.toLowerCase())){let s=0;s=parseInt(e.DocSeqNo);for(let i=0;i<this.dtData.length;i++)if(i==s-1&&parseInt(e.dcCCNID51_Key)==parseInt(this.dtData[i].dcCCNID51)&&parseInt(e.dcCCNID52_Key)==parseInt(this.dtData[i].dcCCNID52))return void("dcAlpha4"==t&&null!=e.dcAlpha4_Key&&new Date(e.dcAlpha4_Key)>new Date(e.dcAlpha5_Key)&&"Both"==n.e.String(e.dcAlpha6)&&(e.dcAlpha5=new Date(e.dcAlpha4_Key).AddDays(1),e.dcAlpha5_Key=new Date(e.dcAlpha4_Key).AddDays(1)))}if(("dcAlpha4"==t||"dcAlpha5"==t||"dcAlpha6"==t)&&null!=e.dcAlpha4_Key&&null!=e.dcAlpha5_Key){if(e.dcAlpha4=new Date(e.dcAlpha4_Key).ToString(a.a.SessionManager.Preferences["Date Format"]),e.dcAlpha4_Key=new Date(e.dcAlpha4_Key),e.dcAlpha5=new Date(e.dcAlpha5_Key).ToString(a.a.SessionManager.Preferences["Date Format"]),e.dcAlpha5_Key=new Date(e.dcAlpha5_Key),"dcAlpha4"==t&&(new Date(e.dcAlpha4_Key)>new Date(e.dcAlpha5_Key)&&"Both"==n.e.String(e.dcAlpha6)&&(e.dcAlpha5=new Date(e.dcAlpha4_Key).ToString(a.a.SessionManager.Preferences["Date Format"]),e.dcAlpha5_Key=new Date(e.dcAlpha4_Key)),new Date(e.dcAlpha5_Key)>=new Date(e.dcAlpha4_Key)&&"Both"==n.e.String(e.dcAlpha6))){let t=this.ScreenObject.ColumnSource.find(e=>"dcAlpha5"==e.DisplayMember);t&&!n.e.IsEmpty(t.Shortcut)&&"lostfocus"==t.Shortcut.toLowerCase()&&this.ValidateData_Column(t,e,!0)&&this.ScreenObject.GetExternalFuncData(t.Mode,t.SPName,t.IPParams,t.OPParams,e)}if("dcAlpha5"==t&&new Date(e.dcAlpha5_Key)<new Date(e.dcAlpha4_Key)&&"Both"==n.e.String(e.dcAlpha6)&&(e.dcAlpha4=new Date(e.dcAlpha5_Key).ToString(a.a.SessionManager.Preferences["Date Format"]),e.dcAlpha4_Key=new Date(e.dcAlpha5_Key),h="Todate should be greater than or equal to Fromdate\r\n"),h)return void(this.DisplayMessage=h);this.DisplayMessage=""}if(!n.e.IsEmpty(this.ScreenObject.GridData[1].dcCCNID51_Key)){let t;t=parseInt(e[Object.keys(e)[1]])-1;for(let e=0;e<this.ScreenObject.GridData.length-1;e++)if(!(n.e.IsEmpty(this.ScreenObject.GridData[e].dcCCNID51_Key)||n.e.IsEmpty(this.ScreenObject.GridData[e].dcCCNID52_Key)||n.e.IsEmpty(this.ScreenObject.GridData[e].dcAlpha4_Key)||n.e.IsEmpty(this.ScreenObject.GridData[e].dcAlpha5_Key)||n.e.IsEmpty(this.ScreenObject.GridData[t].dcAlpha4_Key)||n.e.IsEmpty(this.ScreenObject.GridData[t].dcAlpha5_Key))){if(e!=t&&parseInt(this.ScreenObject.GridData[e].dcCCNID51_Key)==parseInt(this.ScreenObject.GridData[t].dcCCNID51_Key)&&parseInt(this.ScreenObject.GridData[e].dcCCNID52_Key)==parseInt(this.ScreenObject.GridData[t].dcCCNID52_Key)&&!n.e.IsEmpty(this.ScreenObject.GridData[e].dcAlpha4_Key)&&!n.e.IsEmpty(this.ScreenObject.GridData[t].dcAlpha5_Key)){if(new Date(this.ScreenObject.GridData[t].dcAlpha4_Key)>=new Date(this.ScreenObject.GridData[e].dcAlpha4_Key)&&new Date(this.ScreenObject.GridData[t].dcAlpha4_Key)<=new Date(this.ScreenObject.GridData[e].dcAlpha5_Key)||new Date(this.ScreenObject.GridData[e].dcAlpha4_Key)>=new Date(this.ScreenObject.GridData[t].dcAlpha4_Key)&&new Date(this.ScreenObject.GridData[e].dcAlpha4_Key)<=new Date(this.ScreenObject.GridData[t].dcAlpha5_Key))return this.DisplayMessage="FromDate already exist",void(this.ScreenObject.GridData[t].dcAlpha7=0);this.DisplayMessage=""}if(e!=t&&parseInt(this.ScreenObject.GridData[e].dcCCNID51_Key)==parseInt(this.ScreenObject.GridData[t].dcCCNID51_Key)&&parseInt(this.ScreenObject.GridData[e].dcCCNID52_Key)==parseInt(this.ScreenObject.GridData[t].dcCCNID52_Key)&&!n.e.IsEmpty(this.ScreenObject.GridData[e].dcAlpha5_Key)&&!n.e.IsEmpty(this.ScreenObject.GridData[t].dcAlpha4_Key)){if(e!=t&&new Date(this.ScreenObject.GridData[t].dcAlpha5_Key)>=new Date(this.ScreenObject.GridData[e].dcAlpha4_Key)&&new Date(this.ScreenObject.GridData[t].dcAlpha5_Key)<=new Date(this.ScreenObject.GridData[e].dcAlpha5_Key)||new Date(this.ScreenObject.GridData[e].dcAlpha5_Key)>=new Date(this.ScreenObject.GridData[t].dcAlpha4_Key)&&new Date(this.ScreenObject.GridData[e].dcAlpha5_Key)<=new Date(this.ScreenObject.GridData[t].dcAlpha5_Key))return this.DisplayMessage="ToDate already exist",void(this.ScreenObject.GridData[t].dcAlpha7=0);parseInt(this.ScreenObject.GridData[t].dcCCNID51_Key)==parseInt(this.ScreenObject.GridData[e].dcCCNID51_Key)&&parseInt(this.ScreenObject.GridData[t].dcCCNID52_Key)==parseInt(this.ScreenObject.GridData[e].dcCCNID52_Key)&&parseFloat(this.ScreenObject.GridData[t].dcAlpha3)==parseFloat(this.ScreenObject.GridData[e].dcAlpha3)?this.ScreenObject.GridData[t].dcAlpha3=parseFloat(this.ScreenObject.GridData[t].dcAlpha3)-parseFloat(this.ScreenObject.GridData[e].dcNum1):parseInt(this.ScreenObject.GridData[t].dcCCNID51_Key)==parseInt(this.ScreenObject.GridData[e].dcCCNID51_Key)&&parseInt(this.ScreenObject.GridData[t].dcCCNID52_Key)==parseInt(this.ScreenObject.GridData[e].dcCCNID52_Key)&&parseFloat(this.ScreenObject.GridData[e].dcAlpha3)<parseFloat(this.ScreenObject.GridData[t].dcAlpha3)&&(this.ScreenObject.GridData[e].dcAlpha3=parseFloat(this.ScreenObject.GridData[t].dcAlpha3)-parseFloat(this.ScreenObject.GridData[e].dcNum1)),this.DisplayMessage=""}}this.ScreenObject.GridDataObj.updateRow(e)}}if(67==this.ScreenObject.DocumentType){if("dcCCNID51"==t||"dcCCNID51Code"==t){let e=this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase());if(e&&e instanceof d.c&&!e.Date)return void(this.DisplayMessage="Select the daily attendance date")}if("dcNum2"==t&&("WeeklyOff"!=e.PayrollType.toString()&&"Holiday"!=e.PayrollType.toString()||n.e.IsEmpty(e.dcNum2)||-1!=parseFloat(e.dcNum2)&&-2!=parseFloat(e.dcNum2)&&parseFloat(e.dcNum2)>0&&(e.dcNum2="0.00")),("dcCCNID51Code"==t||"dcCCNID51"==t)&&this.ScreenObject.GridDataColumns.Contains("dcCCNID51_Key")&&n.e.String(e.dcCCNID51_Key)==this.PrevValue)return;if("dcAlpha1"==t&&this.ScreenObject.GridDataColumns.Contains("dcAlpha1_Key")&&n.e.String(e.dcAlpha1_Key)==this.PrevValue)return;if("dcAlpha2"==t&&this.ScreenObject.GridDataColumns.Contains("dcAlpha2_Key")&&n.e.String(e.dcAlpha2_Key)==this.PrevValue)return;if("dcAlpha3"==t&&this.ScreenObject.GridDataColumns.Contains("dcAlpha3_Key")&&n.e.String(e.dcAlpha3_Key)==this.PrevValue)return;if("dcNum1"==t&&this.ScreenObject.GridDataColumns.Contains("dcNum1")&&n.e.String(e.dcNum1)==this.PrevValue)return;if(("dcCCNID73Code"==t||"dcCCNID73"==t)&&this.ScreenObject.GridDataColumns.Contains("dcCCNID73_Key")&&e.dcCCNID73_Key.toString()==this.PrevValue)return;this.DailyAttendanceCellEditEnd(e,t,b)}if(62==this.ScreenObject.DocumentType&&("dcCCNID52"==t||"dcAlpha5"==t)){if(this.ScreenObject.GridDataObj.updateRow(e),null!=e.dcAlpha3&&null!=e.dcAlpha9&&parseFloat(e.dcAlpha3)<=0&&(parseInt(e.dcAlpha9)>=0||-4==parseInt(e.dcAlpha9))&&(h="Please check the availability of leaves\r\n"),null!=e.dcAlpha7&&parseFloat(e.dcAlpha7)<=0&&(h="Dates already applied | Selected dates between Holidays/Weeklyoffs\r\n"),h)return void(this.DisplayMessage=h);this.DisplayMessage=""}if(40071==this.ScreenObject.CostCenterID&&("dcAlpha3"==t||"dcAlpha4"==t||"dcAlpha5"==t||"dcAlpha6"==t||"dcAlpha7"==t||"dcAlpha8"==t||"dcAlpha9"==t||"dcAlpha10"==t||"dcAlpha11"==t||"dcAlpha12"==t||"dcAlpha13"==t||"dcAlpha14"==t)){for(let e=0;e<this.ScreenObject.GridData.length-1;e++){let s=0;if(null!=this.ScreenObject.GridData[e][t]){for(let t=3;t<15;t++)null!=this.ScreenObject.GridData[e]["dcAlpha"+t]&&parseFloat(this.ScreenObject.GridData[e]["dcAlpha"+t])>0&&(s+=parseFloat(this.ScreenObject.GridData[e]["dcAlpha"+t]));this.ScreenObject.GridData[e].dcNum1=s}}this.ScreenObject.GridDataObj.updateRow(e),this.CalculateTotals(e,!1)}if(40072==this.ScreenObject.CostCenterID&&("dcNum1"==t||"dcNum2"==t||"dcNum3"==t)){let t=0,s=0,i=0,r=0;for(let e=0;e<this.ScreenObject.GridData.length;e++)n.e.IsEmpty(this.ScreenObject.GridData[e].dcAlpha21)||(2==parseFloat(this.ScreenObject.GridData[e].dcAlpha21)?(n.e.IsEmpty(this.ScreenObject.GridData[e].dcNum1)||(s+=parseFloat(this.ScreenObject.GridData[e].dcNum1)),n.e.IsEmpty(this.ScreenObject.GridData[e].dcNum2)||(s+=parseFloat(this.ScreenObject.GridData[e].dcNum2)),n.e.IsEmpty(this.ScreenObject.GridData[e].dcNum3)||(s+=parseFloat(this.ScreenObject.GridData[e].dcNum3))):2!=parseFloat(this.ScreenObject.GridData[e].dcAlpha21)&&(n.e.IsEmpty(this.ScreenObject.GridData[e].dcNum1)||(i+=parseFloat(this.ScreenObject.GridData[e].dcNum1))));let o=this.ScreenObject._TextFields.find(e=>"dcalpha5"==e.DBColumnName.toLowerCase());o instanceof u.d&&!n.e.IsEmpty(o.Text)&&(r=parseFloat(o.Text)),t=s+r-i,o=this.ScreenObject._TextFields.find(e=>"dcalpha6"==e.DBColumnName.toLowerCase()),o instanceof u.d&&(o.Text=t.ToString("N"+a.a.SessionManager.Preferences.DecimalsinAmount)),this.ScreenObject.GridDataObj.updateRow(e),this.CalculateTotals(e,!1),this.GridNetTotal=parseFloat(t.ToString("N"+a.a.SessionManager.Preferences.DecimalsinAmount)),this.RefreshNetAmount()}if(40076==this.ScreenObject.CostCenterID){let s=0,i=0,a=0,r=0;if("dcNum1"==t||"dcNum2"==t){null!=e.dcAlpha2&&(0!=parseInt(e.dcAlpha3)&&-2!=parseInt(e.dcAlpha3)||(null!=e.dcNum1&&(a=parseFloat(e.dcNum1)),null!=e.dcNum2&&(r=parseFloat(e.dcNum2)),e.dcNum3=a-r));for(let e=0;e<this.ScreenObject.GridData.length-1;e++)n.e.IsEmpty(this.ScreenObject.GridData[e].dcAlpha2)||(0==parseInt(this.ScreenObject.GridData[e].dcAlpha3)&&(a=0,r=0,n.e.IsEmpty(this.ScreenObject.GridData[e].dcNum1)||(a=parseFloat(this.ScreenObject.GridData[e].dcNum1)),n.e.IsEmpty(this.ScreenObject.GridData[e].dcNum2)||(r=parseFloat(this.ScreenObject.GridData[e].dcNum2)),s+=a,i+=r),-1==parseInt(this.ScreenObject.GridData[e].dcAlpha3)&&(this.ScreenObject.GridData[e].dcNum1=s,this.ScreenObject.GridData[e].dcNum2=i,this.ScreenObject.GridData[e].dcNum3=s-i))}this.ScreenObject.GridDataObj.updateRow(e)}if(74==this.ScreenObject.DocumentType&&("dcNum1"==t||"dcNum2"==t)){if(this.ScreenObject.GridDataObj.updateRow(e),h=this.GetITSlabValidation(0,e),h)return void(this.DisplayMessage=h);this.DisplayMessage=""}if(40080==this.ScreenObject.CostCenterID&&"dcAlpha3"==t&&null!=e.dcAlpha3_Key){let t=new Date;t=new Date(parseInt(new Date(e.dcAlpha3_Key).ToString("yyyy")),parseInt(new Date(e.dcAlpha3_Key).ToString("MM")),1),e.dcAlpha3=new Date(t).ToString(a.a.SessionManager.Preferences["Date Format"]),e.dcAlpha3_Key=new Date(t)}if(40085==this.ScreenObject.CostCenterID&&this.ScreenObject.GridDataObj.updateRow(e),58==this.ScreenObject.DocumentType&&"dcAlpha3"==t){if(null==e.dcCCNID52_Key)return;let t=0;if(t=parseFloat(e.dcAlpha1)-parseFloat(e.dcAlpha8),t<0&&(t=0),t>parseFloat(e.dcAlpha2)&&(t=parseFloat(e.dcAlpha2)),parseFloat(e.dcAlpha3)>t&&(h="You can not Encash more than ( "+t+" ) Days\r\n"),h)return void(this.DisplayMessage=h);this.DisplayMessage="",e.dcNum1=this.GetLeaveEncashAmount(parseFloat(e.dcAlpha3),parseInt(e.dcCCNID52_Key))}if(89==this.ScreenObject.DocumentType&&("dcAlpha1"==t||"dcAlpha2"==t||"dcAlpha3"==t||"dcAlpha4"==t)){let t=null,s=null,i=null,a=null,r=new Date,o=this.ScreenObject.ColumnSource.find(e=>"dcalpha1"==e.DisplayMember.toLowerCase());if(o&&!n.e.IsEmpty(e[o.DisplayMember+"_Key"])&&(t=new Date(e[o.DisplayMember+"_Key"])),o=this.ScreenObject.ColumnSource.find(e=>"dcalpha2"==e.DisplayMember.toLowerCase()),o&&!n.e.IsEmpty(e[o.DisplayMember+"_Key"])&&(r=new Date(e[o.DisplayMember+"_Key"]),s=new Date(t.getFullYear(),t.getMonth(),t.getDate(),r.getHours(),r.getMinutes(),r.getSeconds()),e[o.DisplayMember+"_Key"]=s),o=this.ScreenObject.ColumnSource.find(e=>"dcalpha3"==e.DisplayMember.toLowerCase()),o&&!n.e.IsEmpty(e[o.DisplayMember+"_Key"])&&(i=new Date(e[o.DisplayMember+"_Key"])),o=this.ScreenObject.ColumnSource.find(e=>"dcalpha4"==e.DisplayMember.toLowerCase()),o&&!n.e.IsEmpty(e[o.DisplayMember+"_Key"])&&(r=new Date(e[o.DisplayMember+"_Key"]),a=new Date(i.getFullYear(),i.getMonth(),i.getDate(),r.getHours(),r.getMinutes(),r.getSeconds()),e[o.DisplayMember+"_Key"]=a),null!=t&&null!=s&&null!=i&&null!=a){let n=this.ScreenObject.ColumnSource.find(e=>"dcalpha5"==e.DisplayMember.toLowerCase());null!=n&&(e[n.DisplayMember]=this.CalculateTotalTime(t,s,i,a))}else{let t=this.ScreenObject.ColumnSource.find(e=>"dcalpha5"==e.DisplayMember.toLowerCase());null!=t&&(e[t.DisplayMember]=null)}this.ScreenObject.GridDataObj.updateRow(e)}if(90==this.ScreenObject.DocumentType&&("dcAlpha1"==t||"dcAlpha2"==t||"dcAlpha3"==t||"dcAlpha4"==t)){let t=null,s=null,i=null,a=null,r=new Date,o=this.ScreenObject.ColumnSource.find(e=>"dcalpha1"==e.DisplayMember.toLowerCase());if(o&&!n.e.IsEmpty(e[o.DisplayMember+"_Key"])&&(t=new Date(e[o.DisplayMember+"_Key"])),o=this.ScreenObject.ColumnSource.find(e=>"dcalpha2"==e.DisplayMember.toLowerCase()),o&&!n.e.IsEmpty(e[o.DisplayMember+"_Key"])&&(r=new Date(e[o.DisplayMember+"_Key"]),s=new Date(t.getFullYear(),t.getMonth(),t.getDate(),r.getHours(),r.getMinutes(),r.getSeconds()),e[o.DisplayMember+"_Key"]=s),o=this.ScreenObject.ColumnSource.find(e=>"dcalpha3"==e.DisplayMember.toLowerCase()),o&&!n.e.IsEmpty(e[o.DisplayMember+"_Key"])&&(i=new Date(e[o.DisplayMember+"_Key"])),o=this.ScreenObject.ColumnSource.find(e=>"dcalpha4"==e.DisplayMember.toLowerCase()),o&&!n.e.IsEmpty(e[o.DisplayMember+"_Key"])&&(r=new Date(e[o.DisplayMember+"_Key"]),a=new Date(i.getFullYear(),i.getMonth(),i.getDate(),r.getHours(),r.getMinutes(),r.getSeconds()),e[o.DisplayMember+"_Key"]=a),this.ScreenObject.GridDataObj.updateRow(e),null!=t&&null!=s&&null!=i&&null!=a){let n=this.ScreenObject.ColumnSource.find(e=>"dcalpha5"==e.DisplayMember.toLowerCase());null!=n&&(e[n.DisplayMember]=this.CalculateTotalTime(t,s,i,a))}else{let t=this.ScreenObject.ColumnSource.find(e=>"dcalpha5"==e.DisplayMember.toLowerCase());null!=t&&(e[t.DisplayMember]=null)}this.ScreenObject.GridDataObj.updateRow(e)}if(94==this.DocumentType&&("dcalpha5"==t.toLowerCase()&&(Object(o.j)(e.dcAlpha5)||(e.dcAlpha7=0,this.ScreenObject.GridDataObj.updateRow(e))),"dcalpha7"==t.toLowerCase())){if(!Object(o.j)(e.dcAlpha5))return e.dcAlpha7=0,this.ScreenObject.GridDataObj.updateRow(e),void(this.DisplayMessage="First Consider the Document then adjust");if(n.e.Double(e.dcAlpha7)+parseFloat(e.dcAlpha6)>parseFloat(e.dcAlpha4))return void(this.DisplayMessage="SUM of Prev.Adj.Days and Cur.Adj.Days should be less than or equal to 'No of Days'")}if(b&&!n.e.IsEmpty(b.Shortcut)&&"lostfocus"==b.Shortcut.toLowerCase()&&this.ValidateData_Column(b,e,!0)&&this.ScreenObject.GetExternalFuncData(b.Mode,b.SPName,b.IPParams,b.OPParams,e),b&&!n.e.IsEmpty(b.Shortcut)&&"onchange"==b.Shortcut.toLowerCase()&&this.ValidateData_Column(b,e,!0)&&(this.ScreenObject.GridDataColumns.Contains(t+"_Key")&&!n.e.IsEmpty(e[t+"_Key"])&&e[t+"_Key"].toString()!=this.PrevValue||!this.ScreenObject.GridDataColumns.Contains(t+"_Key")&&!n.e.IsEmpty(e[t])&&e[t].toString()!=this.PrevValue)&&this.ScreenObject.GetExternalFuncData(b.Mode,b.SPName,b.IPParams,b.OPParams,e),65==this.DocumentType&&"dcAlpha3"==t&&null!=e.dcAlpha1_Key&&null!=e.dcAlpha2_Key&&null!=e.dcAlpha3_Key){if(e.dcAlpha1=new Date(e.dcAlpha1_Key).ToString(a.a.SessionManager.Preferences["Date Format"]),e.dcAlpha1_Key=new Date(e.dcAlpha1_Key),e.dcAlpha2=new Date(e.dcAlpha2_Key).ToString(a.a.SessionManager.Preferences["Date Format"]),e.dcAlpha2_Key=new Date(e.dcAlpha2_Key),e.dcAlpha3=new Date(e.dcAlpha3_Key).ToString(a.a.SessionManager.Preferences["Date Format"]),e.dcAlpha3_Key=new Date(e.dcAlpha3_Key),"dcAlpha3"==t&&(null!=e.dcAlpha4&&a.a.SessionManager.Preferences.ContainsKey("AllowRejoinonHolidayweeklyoff")&&Object(o.j)("False"==a.a.SessionManager.Preferences.AllowRejoinonHolidayweeklyoff)&&(1==parseInt(e.dcAlpha4)?h="Re-join date should not be Weekly Off\r\n":2==parseInt(e.dcAlpha4)&&(h="Re-join date should not be Holiday\r\n")),new Date(e.dcAlpha3_Key)<=new Date(e.dcAlpha1_Key)?(h+="Re-join date should be after the vacation FromDate\r\n",e.dcAlpha4=1):""==h&&(e.dcAlpha4=0)),""!=h)return void(this.DisplayMessage=h);this.DisplayMessage="",this.MessageVisibility=!1}if(40059==this.ScreenObject.CostCenterID&&59==this.ScreenObject.DocumentType&&(this.ScreenObject.GridDataObj.updateRow(e),"dcAlpha1"==t&&null!=e.dcAlpha1_Key&&null!=e.dcNum1)){if(parseFloat(e.dcNum1)<=0)return void(this.DisplayMessage="Selected date should be Weeklyoff or Holiday");this.DisplayMessage=""}if(63==this.ScreenObject.DocumentType&&("dcCCNID52"==t||"dcAlpha5"==t||"dcAlpha6"==t)){if(this.ScreenObject.GridDataObj.updateRow(e),null!=e.dcAlpha3&&null!=e.dcAlpha8&&parseFloat(e.dcAlpha3)<=0&&-1!=parseFloat(e.dcAlpha8)&&(h="Please check the availability of leaves\r\n"),null!=e.dcNum1&&null!=e.dcAlpha4_Key&&null!=e.dcAlpha5_Key&&parseFloat(e.dcNum1)<=0&&(h="Dates already applied | Selected dates between Holidays/Weeklyoffs\r\n"),""!=h)return void(this.DisplayMessage=h);this.DisplayMessage="",this.MessageVisibility=!1}if(null!=b){let e=this.ReportsList.find(e=>e.Formula==b.ID&&"lostfocus"==e.KeyTip.toLowerCase());e&&this.OnReportsLinkClick(e.DBColumnID)}Logger.InfoLog("AddEditDocumentViewModel::Exiting OnCellEditEnding")}catch(c){if("PactException"==c.message)throw new Error("PactException");this.DisplayMessage="Problem processing document try again",Logger.ErrorLog("Addeditdocumentviewmodel","cell edit ending",c.stack)}}InitProjWOffsHolidays(){this.dsProjWOffHol=[],this.dsProjWOffHol=a.a.common.GetDataSet("DOC066",this.DocumentDate.ToString("dd MMM yyyy"))}DailyAttendanceCellEditEnd(e,t,s){let i,r,o="",l="",c="",h="",u="",D="",S="",b=0,p="",y="1",g=this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase());if(g instanceof d.c)g.Date&&(p=g.Date.ToString("dd/MMM/yyyy"));else{let t=this.ScreenObject.ColumnSource.find(e=>"dcalpha1"==e.DisplayMember.toLowerCase());t&&!n.e.IsEmpty(e[t.DisplayMember+"_Key"])&&(p=new Date(e[t.DisplayMember+"_Key"]).ToString("dd/MMM/yyyy"))}if(g=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase()),g)(g instanceof m.b||g instanceof C.a)&&(y=g.SelectedValue.toString());else{let t=this.ScreenObject.ColumnSource.find(e=>"LISTBOX"==e.DataType.toUpperCase()&&"dcccnid51_key"==e.ValueMember.toLowerCase());t&&!n.e.IsEmpty(e[t.ValueMember])&&(y=e[t.ValueMember].toString())}if(""!=p&&parseInt(y)>1){if(("dcAlpha2"==t||"dcAlpha3"==t||"dcNum1"==t)&&null!=e.dcAlpha2_Key&&null!=e.dcAlpha3_Key){if(e.dcAlpha2=o=new Date(e.dcAlpha2_Key).ToString("HH:mm"),e.dcAlpha2_Key=new Date(e.dcAlpha2_Key).ToString("dd-MMM-yyyy HH:mm"),e.dcAlpha3=l=new Date(e.dcAlpha3_Key).ToString("HH:mm"),e.dcAlpha3_Key=new Date(e.dcAlpha3_Key).ToString("dd-MMM-yyyy HH:mm"),"dcNum1"==t){let t=new Date(e.dcAlpha3_Key).Subtract(new Date(e.dcAlpha2_Key));u=1==t.Minutes.toString().length?t.Hours+".0"+t.Minutes:t.Hours+"."+t.Minutes,S=parseFloat(e.dcNum1).ToTime("00.00"),r=new Date(Date.WithTime(S.toString().replace(".",":"))).Subtract(new Date(Date.WithTime(u.toString().replace(".",":")))),D=1==r.Minutes.toString().length?r.Hours+".0"+r.Minutes:r.Hours+"."+r.Minutes,b=this.ConvertHoursToMinutes(D),l=new Date(e.dcAlpha3_Key).AddMinutes(b).ToString("HH:mm"),e.dcAlpha3=new Date(Date.WithTime(l)).ToString("HH:mm"),h=new Date(e.dcAlpha3_Key).ToString("dd-MMM-yyyy")+" "+l,e.dcAlpha3_Key=new Date(h).ToString("dd-MMM-yyyy HH:mm"),o=new Date(e.dcAlpha2_Key).ToString("HH:mm"),e.dcAlpha2=new Date(Date.WithTime(o)).ToString("HH:mm"),c=new Date(e.dcAlpha2_Key).ToString("dd-MMM-yyyy")+" "+o,e.dcAlpha2_Key=new Date(c).ToString("dd-MMM-yyyy HH:mm")}let s=this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase());s?s instanceof d.c&&s.Date&&(new Date(Date.Today().ToString("dd-MMM-yyyy")+" "+o)>new Date(Date.Today().ToString("dd-MMM-yyyy")+" "+l)?(i=new Date(p),c=i.ToString("dd-MMM-yyyy")+" "+o,e.dcAlpha2_Key=new Date(c).ToString("dd-MMM-yyyy HH:mm"),h=i.AddDays(1).ToString("dd-MMM-yyyy")+" "+l,e.dcAlpha3_Key=new Date(h).ToString("dd-MMM-yyyy HH:mm")):(i=new Date(p),c=i.ToString("dd-MMM-yyyy")+" "+o,e.dcAlpha2_Key=new Date(c).ToString("dd-MMM-yyyy HH:mm"),h=i.ToString("dd-MMM-yyyy")+" "+l,e.dcAlpha3_Key=new Date(h).ToString("dd-MMM-yyyy HH:mm"))):null!=this.ScreenObject.ColumnSource.find(e=>"dcalpha1"==e.DisplayMember.toLowerCase())&&(new Date(Date.Today().ToString("dd-MMM-yyyy")+" "+o)>new Date(Date.Today().ToString("dd-MMM-yyyy")+" "+l)?(i=new Date(p),c=i.ToString("dd-MMM-yyyy")+" "+o,e.dcAlpha2_Key=new Date(c).ToString("dd-MMM-yyyy HH:mm"),h=i.AddDays(1).ToString("dd-MMM-yyyy")+" "+l,e.dcAlpha3_Key=new Date(h).ToString("dd-MMM-yyyy HH:mm")):(i=new Date(p),c=i.ToString("dd-MMM-yyyy")+" "+o,e.dcAlpha2_Key=new Date(c).ToString("dd-MMM-yyyy HH:mm"),h=i.ToString("dd-MMM-yyyy")+" "+l,e.dcAlpha3_Key=new Date(h).ToString("dd-MMM-yyyy HH:mm"))),s=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase()),s?s instanceof m.b&&s.SelectedValue>0&&(new Date(i.ToString("dd-MMM-yyyy")+" "+o)>new Date(i.ToString("dd-MMM-yyyy")+" "+l)?(i=new Date(p),c=i.ToString("dd-MMM-yyyy")+" "+o,e.dcAlpha2_Key=new Date(c).ToString("dd-MMM-yyyy HH:mm"),h=i.AddDays(1).ToString("dd-MMM-yyyy")+" "+l,e.dcAlpha3_Key=new Date(h).ToString("dd-MMM-yyyy HH:mm")):(i=new Date(p),c=i.ToString("dd-MMM-yyyy")+" "+o,e.dcAlpha2_Key=new Date(c).ToString("dd-MMM-yyyy HH:mm"),h=i.ToString("dd-MMM-yyyy")+" "+l,e.dcAlpha3_Key=new Date(h).ToString("dd-MMM-yyyy HH:mm"))):null!=this.ScreenObject.ColumnSource.find(e=>"dcccnid51"==e.DisplayMember.toLowerCase())&&(new Date(Date.Today().ToString("dd-MMM-yyyy")+" "+o)>new Date(Date.Today().ToString("dd-MMM-yyyy")+" "+l)?(i=new Date(p),c=i.ToString("dd-MMM-yyyy")+" "+o,e.dcAlpha2_Key=new Date(c).ToString("dd-MMM-yyyy HH:mm"),h=i.AddDays(1).ToString("dd-MMM-yyyy")+" "+l,e.dcAlpha3_Key=new Date(h).ToString("dd-MMM-yyyy HH:mm")):(i=new Date(p),c=i.ToString("dd-MMM-yyyy")+" "+o,e.dcAlpha2_Key=new Date(c).ToString("dd-MMM-yyyy HH:mm"),h=i.ToString("dd-MMM-yyyy")+" "+l,e.dcAlpha3_Key=new Date(h).ToString("dd-MMM-yyyy HH:mm")))}if("dcccnid51"!=t.toLowerCase()&&"dcccnid51code"!=t.toLowerCase()&&"dcalpha1"!=t.toLowerCase()||(this.CheckEmployeeShift(y,p,e),null==this.objPayDayCheck&&(this.objPayDayCheck=new at.a(this.ScreenObject)),this.objPayDayCheck.CheckIsHolidayDate(y,p,e,this.IsGetAllEmployees,this.dsAllEmployeeData)),a.a.SessionManager.Preferences.ContainsKey("GeneralTimingsBasedOn")&&""!=a.a.SessionManager.Preferences.GeneralTimingsBasedOn||"dcAlpha1"==t){let i=a.a.SessionManager.Preferences.GeneralTimingsBasedOn.split(",");if(null!=i&&i.length>0)for(let e=0;e<i.length;e++)if(null!=i[e]&&""!=i[e]){this.ScreenObject.Data.Tables[0].CaseSensitive=!1;let t=this.ScreenObject.Data.Tables[0].filter(t=>t.localreference>0&&t.SysColumnName.startsWith("dcCCNID")&&t.ColumnCostcenterID==i[e]);t.length>0&&!n.e.IsEmpty(t[0].LocalCCID)&&i.push(t[0].LocalCCID.toString())}(t.startsWith("dcCCNID")&&i.Contains(s.CostCenterID.toString())&&e[s.ValueMember].toString()!=this.PrevValue||"dcAlpha1"==t)&&this.FillGeneralTimings(y,p,e)}if(a.a.SessionManager.Preferences.ContainsKey("HoursDefChartBasedOn")&&""!=a.a.SessionManager.Preferences.HoursDefChartBasedOn&&t.startsWith("dcCCNID")||"dcAlpha1"==t||"dcAlpha2"==t||"dcAlpha3"==t||"dcNum1"==t||"dcNum4"==t||"dcNum5"==t||"dcnum7"==t.toLowerCase()||"dcnum9"==t.toLowerCase()||"dcnum11"==t.toLowerCase()||"dcnum13"==t.toLowerCase()){let i=a.a.SessionManager.Preferences.HoursDefChartBasedOn.split(",");if(null!=i&&i.length>0)for(let e=0;e<i.length;e++)if(null!=i[e]&&""!=i[e]){this.ScreenObject.Data.Tables[0].CaseSensitive=!1;let t=this.ScreenObject.Data.Tables[0].filter(t=>t.localreference>0&&t.SysColumnName.startsWith("dcCCNID")&&t.ColumnCostcenterID==i[e]);t.length>0&&!n.e.IsEmpty(t[0].LocalCCID)&&i.push(t[0].LocalCCID.toString())}(t.startsWith("dcCCNID")&&i.Contains(s.CostCenterID.toString())&&e[s.ValueMember].toString()!=this.PrevValue||"dcAlpha1"==t||"dcAlpha2"==t||"dcAlpha3"==t||"dcNum1"==t||"dcNum4"==t||"dcNum5"==t||"dcnum7"==t.toLowerCase()||"dcnum9"==t.toLowerCase()||"dcnum11"==t.toLowerCase()||"dcnum13"==t.toLowerCase())&&this.DistributeTotalHours(y,p,e,t)}}this.ScreenObject.GridDataObj.updateRow(e),this.ScreenObject.GridDataObj.refreshDatawithIDs()}AutoSerialNumber(e,t){if(0==this.ScreenObject.DocID||n.e.IsEmpty(e.ExtraXML))t.SerialNumber.Text=t.ds.Tables[3][0][t.ds.Columns[3][0]].toString(),t.Qty.Text=e.Quantity.toString(),t.DisplayMessage="",t.GridData.Clear(),t.OnSave("Add"),t.DisplayMessage.length>0?this.DisplayMessage=t.DisplayMessage:(t.OnSave("Save"),t.DisplayMessage.length>0&&(this.DisplayMessage=t.DisplayMessage));else{let s=new n.f;s.LoadXml(e.ExtraXML);let i=s.SelectNodes("xml/Row");if(parseInt(e.Quantity)>i.length)t.SerialNumber.Text=t.ds.Tables[3][0][t.ds.Columns[3][0]].toString(),t.Qty.Text=(parseInt(e.Quantity)-i.length).toString(),t.DisplayMessage="",t.OnSave("Add"),t.DisplayMessage.length>0?this.DisplayMessage=t.DisplayMessage:(t.OnSave("Save"),t.DisplayMessage.length>0&&(this.DisplayMessage=t.DisplayMessage));else if(parseInt(e.Quantity)<i.length&&t.GridData.length>0)for(let a=t.GridData.length-1;a>=parseInt(e.Quantity);a--)t.SelectedRow=t.GridData[t.GridData.indexOf(t.GridData[a])],t.OnRemove("Remove"),t.DisplayMessage.length>0&&(this.DisplayMessage=t.DisplayMessage)}}AddProductQty(e,t){let s=!1;this.ScreenObject.GridDataObj.updateRow(e);let i=this.ScreenObject.GridData;if(n.e.IsEmpty(e.ProductID_Key))return s;if(i=i.filter(t=>t.ProductID_Key==n.e.String(e.ProductID_Key)),n.e.IsEmpty(e.Unit_Key)||(i=i.filter(t=>t.Unit_Key==n.e.String(e.Unit_Key))),"5"==n.e.String(e.Type)){if(!n.e.IsEmpty(e.ExtraXML))return!1;i=i.filter(e=>null==e.ExtraXML)}console.log("Test:ClubProdBasedon-29813"),this.ScreenObject.Preferences.ContainsKey("ClubProdBasedon")&&""!=this.ScreenObject.Preferences.ClubProdBasedon&&this.ScreenObject.Preferences.ClubProdBasedon.split(",").forEach(t=>{this.ScreenObject.GridDataColumns.Contains(t)&&(i=i.filter(s=>s[t]==n.e.String(e[t])))});let a=i;if(a.length>1){let i=this.ScreenObject.GridData.indexOf(a[0]),r=this.ScreenObject.GridData.indexOf(a[1]),o=0,l=0;o=n.e.Double(a[0].Quantity),l=n.e.Double(a[1].Quantity),i>r?(a[1].Quantity=o+l,e=a[1],this.Setselectedrow(r),this.ScreenObject.GridDataObj.removeRow(a[0]),this.LineNo=r+1):(a[0].Quantity=o+l,e=a[0],this.Setselectedrow(i),this.ScreenObject.GridDataObj.removeRow(a[1]),this.LineNo=i+1);let c=this.ColumnNo,h=this.ScreenObject.ColumnSource.find(e=>!n.e.IsEmpty(e.DisplayMember)&&"quantity"==e.DisplayMember.toLowerCase());h&&(this.ColumnNo=this.ScreenObject.ColumnSource.indexOf(h)+1),t&&(this.SetFocusongrid=!0),this.ColumnNo=c,s=!0}return s}jvTotal(){if(17==this.ScreenObject.DocumentType||28==this.ScreenObject.DocumentType||29==this.ScreenObject.DocumentType){let e=0,t=0;for(let r=0;r<this.ScreenObject.GridData.length;r++){let s=1;a.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(o.j)(a.a.SessionManager.Preferences["Use Foreign Currency"])&&(this.Currency&&!n.e.IsEmpty(this.Currency.ExchangeRate.Text)?s=parseFloat(this.Currency.ExchangeRate.Text):this.ScreenObject.GridDataColumns.Contains("ExchangeRate")&&!n.e.IsEmpty(this.ScreenObject.GridData[r].ExchangeRate)&&(s=parseFloat(this.ScreenObject.GridData[r].ExchangeRate))),n.e.IsEmpty(this.ScreenObject.GridData[r].AccountID_Key)||(n.e.IsEmpty(this.ScreenObject.GridData[r].DebitAmount)||(t+=parseFloat(this.ScreenObject.GridData[r].DebitAmount)*s),n.e.IsEmpty(this.ScreenObject.GridData[r].CreditAmount)||(e+=parseFloat(this.ScreenObject.GridData[r].CreditAmount)*s))}let s=this.ScreenObject.ColumnSource.find(e=>null!=e.DisplayMember&&"debitamount"==e.DisplayMember.toLowerCase()),i=this.ScreenObject.ColumnSource.find(e=>null!=e.DisplayMember&&"creditamount"==e.DisplayMember.toLowerCase());if(null!=s&&null!=i&&e.ToString("N"+s.DecimalPoints)!=t.ToString("N"+i.DecimalPoints))if(t>e)if(1==i.ShowbodyTotal)i.footer=(e-t).ToString("N"+s.DecimalPoints);else{let r=1;a.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(o.j)(a.a.SessionManager.Preferences["Use Foreign Currency"])&&this.Currency&&!n.e.IsEmpty(this.Currency.ExchangeRate.Text)&&(r=parseFloat(this.Currency.ExchangeRate.Text)),i.footer=0!=r?((e-t)/r).ToString("N"+s.DecimalPoints):(e-t).ToString("N"+s.DecimalPoints)}else if(1==s.ShowbodyTotal)s.footer=(t-e).ToString("N"+i.DecimalPoints);else{let r=1;a.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(o.j)(a.a.SessionManager.Preferences["Use Foreign Currency"])&&this.Currency&&!n.e.IsEmpty(this.Currency.ExchangeRate.Text)&&(r=parseFloat(this.Currency.ExchangeRate.Text)),s.footer=0!=r?((t-e)/r).ToString("N"+i.DecimalPoints):(t-e).ToString("N"+i.DecimalPoints)}}}GetProductValues(e,t,s=!1,i=null,r=!1,o=null){let l=1;if(l=n.e.Double(e.Quantity),0==l&&(l=1),0!=t||!this.ScreenObject.GridDataColumns.Contains("Unit_Key")||n.e.IsEmpty(e.Unit_Key)||n.e.IsEmpty(e.ProductID_Key)||0!=this.ProdID&&this.ProdID!=parseInt(e.ProductID_Key)||(t=parseInt(e.Unit_Key)),0==t&&null!=this.barcodeValues&&this.barcodeValues.ContainsKey("Unit_Key")&&!n.e.IsEmpty(this.barcodeValues.Unit_Key)&&(t=parseInt(e.Unit_Key)),null!=o||""==n.e.String(e.ProductID_Key)&&null==i||(o=this.ScreenObject.GetProductTypeDetails(n.e.String(e.ProductID_Key),this.DocumentDate,t,l,n.e.String(e.DocDetailsID),e,s,i,!1,0,this.Currency,r)),o&&o.Tables.length>0&&o.Tables[0].length>0){if(!n.e.IsEmpty(i)&&!o.Columns[0].Contains("ErrorMessage")){if(e.ProductID_Key=o.Tables[0][0].ProductID,this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(e.ProductCode=o.Tables[0][0].ProductCode.toString()),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(e.ProductName=o.Tables[0][0].ProductName.toString()),a.a.SessionManager.Preferences.ContainsKey("POSItemCodeDimension")){let t=this.ScreenObject.ColumnSource.find(e=>e.CostCenterID.toString()==a.a.SessionManager.Preferences.POSItemCodeDimension);t&&this.ScreenObject.GridDataColumns.Contains(t.DisplayMember)&&(e[t.DisplayMember]=i,!n.e.IsEmpty(t.ValueMember)&&this.ScreenObject.GridDataColumns.Contains(t.ValueMember)&&o.Columns[0].Contains("stockID")&&!n.e.IsEmpty(o.Tables[0][0].stockID)&&(e[t.ValueMember]=o.Tables[0][0].stockID.toString()))}this.SalesManDimension.Visible&&this.ScreenObject.GridDataColumns.Contains("Dcccnid5")&&this.SalesManDimension.SelectedValue>0&&(e.Dcccnid5=this.SalesManDimension.Text,e.Dcccnid5_Key=this.SalesManDimension.SelectedValue),this.FillDefaultValues(e),this.RepeatRowData(e),this.BindDivisionorLocation(e),o.Tables.length>1&&o.Tables[1].length>0&&this.FillPromotions(o.Tables[1],this.ScreenObject.GridData.indexOf(e))}if(e.AVGRATE=o.Columns[0].Contains("AvgRate")&&!n.e.IsEmpty(o.Tables[0][0].AvgRate)?o.Tables[0][0].AvgRate.toString():0,parseInt(e.ProductID_Key)!=this.ScreenObject.TempProductID&&(e.QOH=n.e.IsEmpty(o.Tables[0][0].QOH)?0:o.Tables[0][0].QOH.toString(),e.BalQOH=n.e.IsEmpty(o.Tables[0][0].BalQOH)?0:o.Tables[0][0].BalQOH.toString(),e.HOLDQTY=n.e.IsEmpty(o.Tables[0][0].HOLDQTY)?0:o.Tables[0][0].HOLDQTY.toString(),e.CommittedQty=n.e.IsEmpty(o.Tables[0][0].CommittedQty)?0:o.Tables[0][0].CommittedQty.toString(),e.RESERVEQTY=n.e.IsEmpty(o.Tables[0][0].RESERVEQTY)?0:o.Tables[0][0].RESERVEQTY.toString(),e.TotalReserve=n.e.IsEmpty(o.Tables[0][0].TotalReserve)?0:o.Tables[0][0].TotalReserve.toString(),this.FillDatarow(e,o.Tables[0],null,{LocalReference:79,LinkData:23819},"AvgRate"),this.FillDatarow(e,o.Tables[0],null,{LocalReference:79,LinkData:25398},"QOH"),this.FillDatarow(e,o.Tables[0],null,{LocalReference:79,LinkData:52638},"QOH"),this.FillDatarow(e,o.Tables[0],null,{LocalReference:79,LinkData:52637},"BalQOH"),this.FillDatarow(e,o.Tables[0],null,{LocalReference:79,LinkData:26421},"HOLDQTY"),this.FillDatarow(e,o.Tables[0],null,{LocalReference:79,LinkData:50454},"CommittedQty"),this.FillDatarow(e,o.Tables[0],null,{LocalReference:79,LinkData:26422},"RESERVEQTY"),this.FillDatarow(e,o.Tables[0],null,{LocalReference:79,LinkData:499943},"TotalReserve")),o.Tables.length>3&&o.Tables[3].length>0&&(this.FillDatarowNN(e,o.Tables[3],null,{LinkData:55481},"WEF"),this.FillDatarowNN(e,o.Tables[3],null,{LinkData:55484},"TillDate"),this.FillDatarowNN(e,o.Tables[3],null,{LinkData:55486},"ProfileName")),o.Tables.length>4&&o.Tables[4].length>0&&(this.FillDatarowNN(e,o.Tables[4],null,{LinkData:55482},"WEF"),this.FillDatarowNN(e,o.Tables[4],null,{LinkData:55485},"TillDate"),this.FillDatarowNN(e,o.Tables[4],null,{LinkData:55487},"ProfileName")),31==this.ScreenObject.DocumentType){e.QOH=n.e.IsEmpty(o.Tables[0][0].QOH)?0:o.Tables[0][0].QOH.toString();let t="",s=this.ScreenObject.ColumnSource.find(e=>e.ID==this.ScreenObject.Preferences.QOHField);s&&(t=s.DisplayMember),""!=t&&(e[t]=e.QOH.toString())}}return o}FillProductValues(e){let t=this.GetProductValues(e,0);n.e.IsEmpty(e.Unit_Key)&&t.Tables.length>0&&t.Columns[0].Contains("uomid")&&!n.e.IsEmpty(t.Tables[0][0].uomid)&&(e.Unit=t.Tables[0][0].UnitName.toString(),e.Unit_Key=t.Tables[0][0].uomid.toString());let s=this.ScreenObject.ColumnSource.filter(e=>e.DisplayMember.Contains("dcNum")&&4!=e.SectionID);for(let a=0;a<s.length;a++){let i=s[a];if(!(i.linkData>0)&&t.Tables.length>4){let s=t.Tables[4].filter(e=>e.SysColumnName==i.DisplayMember);s.length>0&&(e[i.DisplayMember]=s[0].Value.toString(),e["default"+i.DisplayMember]=s[0].Value.toString())}}this.FillRates(t,e);let i=this.ScreenObject.Data.Tables[0];if(i.length>0){let t=this.ScreenObject.ColumnSource.find(e=>null!=e.ValueMember&&"productid_key"==e.ValueMember.toString().toLowerCase());if(t&&t.CostCenterID>0){i=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&(e.LocalReference==t.ID||79==e.LocalReference&&(26585==e.LinkData||54306==e.LinkData||54307==e.LinkData||53529==e.LinkData||53589==e.LinkData||53530==e.LinkData))),i.length>0&&t.ValueMember&&!n.e.IsEmpty(e[t.ValueMember])&&this.ScreenObject.GetLinkReferenceData(parseInt(t.ID),this.DocumentID,parseInt(e[t.ValueMember]),Date.Today(),"",t.CostCenterID,e,null,!1);let s=null;"ProductName"==t.DisplayMember?s=this.ScreenObject.ColumnSource.find(e=>"ProductCode"==e.DisplayMember):"ProductCode"==t.DisplayMember&&(s=this.ScreenObject.ColumnSource.find(e=>"ProductName"==e.DisplayMember)),s&&(i=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&e.LocalReference==s.ID),i.length>0&&s.ValueMember&&!n.e.IsEmpty(e[s.ValueMember])&&this.ScreenObject.GetLinkReferenceData(parseInt(s.ID),this.DocumentID,parseInt(e[s.ValueMember]),Date.Today(),"",s.CostCenterID,e,null,!1))}}t.Tables.length>0&&t.Tables[0].length>0&&!t.Columns[0].Contains("ErrorMessage")&&n.e.Int(t.Tables[0][0].DrAccount)>0&&this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&(e.DebitAccount_Key=t.Tables[0][0].DrAccount.toString(),this.ScreenObject.GridDataColumns.Contains("DebitAccount")&&(e.DebitAccount=t.Tables[0][0].DrName.toString())),t.Tables.length>0&&t.Tables[0].length>0&&!t.Columns[0].Contains("ErrorMessage")&&n.e.Int(t.Tables[0][0].CrAccount)>0&&this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&(e.CreditAccount_Key=t.Tables[0][0].CrAccount.toString(),this.ScreenObject.GridDataColumns.Contains("CreditAccount")&&(e.CreditAccount=t.Tables[0][0].CrName.toString())),this.CalculateTotals(e,!1)}ClearDatarow(e,t){if(a.a.IsMobile)this.ScreenObject.GridDataObj.removeRow(e);else{e.Type=0,this.ScreenObject.GridDataColumns.Contains("BinWise")&&(e.BinWise=null),this.ScreenObject.GridDataColumns.Contains("QtyType")&&(e.QtyType=null),e.LinkedInvDocDetailsID=0,e.LinkedFieldName="",e.RefNo="",e.UOMConversion=0,e.QOH=0,e.BalQOH=0,e.HOLDQTY=0,e.CommittedQty=0,e.RESERVEQTY=0,e.TotalReserve=0,e.LASTPURCHASERATE=0,e.UOMConvertedQty=0,e.Unit="",e.Unit_Key=0,e.ExtraXML=null,t?(e.Quantity=null,e.Rate=null,e.defaultRate=null):(e.Quantity=0,e.Rate=0,e.defaultRate=0);for(let s=0;s<this.ScreenObject.ColumnSource.length;s++){let i=this.ScreenObject.ColumnSource[s];if(4!=i.SectionID&&"FillGUID"!=i.DistributeColName){if(null!=i.DisplayMember&&i.DisplayMember.toLowerCase().Contains("dcnum")&&(t?(e[i.DisplayMember]=null,e["default"+i.DisplayMember]=null,e["dcCalc"+i.DisplayMember]=null):(e[i.DisplayMember]=0,e["default"+i.DisplayMember]=0,e["dcCalc"+i.DisplayMember]=0)),null!=i.DisplayMember&&i.DisplayMember.toLowerCase().Contains("alpha")){if(!t&&this.ScreenObject.Preferences.ContainsKey("ProductFilterField")&&""!=this.ScreenObject.Preferences.ProductFilterField&&i.ID==this.ScreenObject.Preferences.ProductFilterField)continue;e[i.DisplayMember]=null}t&&!n.e.IsEmpty(i.ValueMember)&&this.ScreenObject.GridDataColumns.Contains(i.ValueMember)&&(e[i.ValueMember]=null,e[i.DisplayMember]=null)}}}}RepeatRowData(e){let t=this.ScreenObject.GridData.indexOf(e);if(t>0)for(let s=0;s<this.ScreenObject.ColumnSource.length;s++)this.ScreenObject.ColumnSource[s].IsRepeat&&(this.ScreenObject.ColumnSource[s].CostCenterID>0&&this.ScreenObject.ColumnSource[s].CostCenterID!=this.CostCenterID?n.e.IsEmpty(e[this.ScreenObject.ColumnSource[s].ValueMember])&&(e[this.ScreenObject.ColumnSource[s].DisplayMember]=this.ScreenObject.GridData[t-1][this.ScreenObject.ColumnSource[s].DisplayMember],e[this.ScreenObject.ColumnSource[s].ValueMember]=this.ScreenObject.GridData[t-1][this.ScreenObject.ColumnSource[s].ValueMember],this.FillLinkRef(e,this.ScreenObject.ColumnSource[s])):this.ScreenObject.ColumnSource[s].DisplayMember.toLowerCase().Contains("dcnum")?n.e.IsEmpty(e[this.ScreenObject.ColumnSource[s].DisplayMember])&&(e[this.ScreenObject.ColumnSource[s].DisplayMember]=this.ScreenObject.GridData[t-1][this.ScreenObject.ColumnSource[s].DisplayMember]):"DATE"==this.ScreenObject.ColumnSource[s].DataType||"datetime"==this.ScreenObject.ColumnSource[s].DataType.toLocaleLowerCase()||"time"==this.ScreenObject.ColumnSource[s].DataType.toLocaleLowerCase()?n.e.IsEmpty(e[this.ScreenObject.ColumnSource[s].DisplayMember])&&(e[this.ScreenObject.ColumnSource[s].DisplayMember]=this.ScreenObject.GridData[t-1][this.ScreenObject.ColumnSource[s].DisplayMember],e[this.ScreenObject.ColumnSource[s].DisplayMember+"_Key"]=this.ScreenObject.GridData[t-1][this.ScreenObject.ColumnSource[s].DisplayMember+"_Key"]):"PactComboBox"==this.ScreenObject.ColumnSource[s].DataType||"ComboBox"==this.ScreenObject.ColumnSource[s].DataType?n.e.IsEmpty(e[this.ScreenObject.ColumnSource[s].ValueBinding])&&(e[this.ScreenObject.ColumnSource[s].ValueBinding]=this.ScreenObject.GridData[t-1][this.ScreenObject.ColumnSource[s].ValueBinding]):n.e.IsEmpty(e[this.ScreenObject.ColumnSource[s].DisplayMember])&&(e[this.ScreenObject.ColumnSource[s].DisplayMember]=this.ScreenObject.GridData[t-1][this.ScreenObject.ColumnSource[s].DisplayMember]))}CheckStockDimensions(){if(a.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&n.e.Int(a.a.SessionManager.Preferences["Maintain Dimensionwise stock"])>5e4){let e=this.ScreenObject._CCFields.find(e=>"dcccnid-50000"==e.DBColumnName.toLowerCase());if(!this.ScreenObject.GridDataColumns.Contains("dcCCNID-50000_Key")&&!e){let e=new m.b(0);if(e.CCID=0,e.TypeID=1,e.Label=this.ScreenObject.GetCostcenterName(0),e.DBColumnName="dcCCNID-50000",e.Mandatory=!0,this.ScreenObject.CustomTab.Pages.length>0)e.Row=this.ScreenObject.CustomTab.Pages[0].Fields.length/4,e.Column=this.ScreenObject.CustomTab.Pages[0].Fields.length%4,this.ScreenObject.CustomTab.Pages[0].Fields.push(e),this.ScreenObject._CCFields.push(e);else{e.Row=0,e.Column=0;let t=new T.b;t.Header="Extra fields",t.Name="Extra fields",this.ScreenObject.CustomTab.Pages.push(t),this.ScreenObject.CustomTab.Pages[0].Fields.push(e),this.ScreenObject.CustomTab.Visible=!0,this.ScreenObject.CustomTab.SelectedTab=this.ScreenObject.CustomTab.Pages[0],this.ScreenObject._CCFields.push(e)}}}if(a.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&Object(o.j)(a.a.SessionManager.Preferences.EnableLocationWise)&&Object(o.j)(a.a.SessionManager.Preferences.EnableLocationWise)&&a.a.SessionManager.Preferences.ContainsKey("Location Stock")&&Object(o.j)(a.a.SessionManager.Preferences["Location Stock"])&&Object(o.j)(a.a.SessionManager.Preferences["Location Stock"])&&!this.ScreenObject._CCFields.find(e=>"dcccnid2"==e.DBColumnName.toLowerCase())&&!this.ScreenObject.GridDataColumns.Contains("dcCCNID2_Key")){let e=new m.b(0);if(e.CCID=50002,e.TypeID=1,e.Label=a.a.SessionManager.Preferences.ContainsKey("LocationName")?a.a.SessionManager.Preferences.LocationName:"Location",e.DBColumnName="dcCCNID2",e.Mandatory=!0,this.ScreenObject.CustomTab.Pages.length>0)e.Row=this.ScreenObject.CustomTab.Pages[0].Fields.length/4,e.Column=this.ScreenObject.CustomTab.Pages[0].Fields.length%4,this.ScreenObject.CustomTab.Pages[0].Fields.push(e),this.ScreenObject._CCFields.push(e);else{e.Row=0,e.Column=0;let t=new T.b;t.Header="Extra fields",t.Name="Extra fields",this.ScreenObject.CustomTab.Pages.push(t),this.ScreenObject.CustomTab.Pages[0].Fields.push(e),this.ScreenObject.CustomTab.Visible=!0,this.ScreenObject.CustomTab.SelectedTab=this.ScreenObject.CustomTab.Pages[0],this.ScreenObject._CCFields.push(e)}}if(a.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&Object(o.j)(a.a.SessionManager.Preferences.EnableDivisionWise)&&Object(o.j)(a.a.SessionManager.Preferences.EnableDivisionWise)&&a.a.SessionManager.Preferences.ContainsKey("Division Stock")&&Object(o.j)(a.a.SessionManager.Preferences["Division Stock"])&&Object(o.j)(a.a.SessionManager.Preferences["Division Stock"])&&!this.ScreenObject._CCFields.find(e=>"dcccnid1"==e.DBColumnName.toLowerCase())&&!this.ScreenObject.GridDataColumns.Contains("dcCCNID1_Key")){let e=new m.b(0);if(e.CCID=50001,e.TypeID=1,e.Label=a.a.SessionManager.Preferences.ContainsKey("DivisionName")?a.a.SessionManager.Preferences.DivisionName:"Division",e.DBColumnName="dcCCNID1",e.Mandatory=!0,this.ScreenObject.CustomTab.Pages.length>0)e.Row=this.ScreenObject.CustomTab.Pages[0].Fields.length/4,e.Column=this.ScreenObject.CustomTab.Pages[0].Fields.length%4,this.ScreenObject.CustomTab.Pages[0].Fields.push(e),this.ScreenObject._CCFields.push(e);else{e.Row=0,e.Column=0;let t=new T.b;t.Header="Extra fields",t.Name="Extra fields",this.ScreenObject.CustomTab.Pages.push(t),this.ScreenObject.CustomTab.Pages[0].Fields.push(e),this.ScreenObject.CustomTab.Visible=!0,this.ScreenObject.CustomTab.SelectedTab=this.ScreenObject.CustomTab.Pages[0],this.ScreenObject._CCFields.push(e)}}}QtyReader(e){return e}AddProductData(e,t,s,i=!1,r=null,l=null,c=null){if(!n.e.IsEmpty(e.ProductID_Key)&&null==l&&this.ProdID==parseInt(e.ProductID_Key)&&0!=parseInt(e.ProductID_Key)){if(this.RepeatRowData(e),this.ScreenObject.Preferences.ContainsKey("IgnoreKitPopup")&&"True"==this.ScreenObject.Preferences.IgnoreKitPopup&&"3"==n.e.String(e.Type))return;if(!n.e.IsEmpty(e.Type)&&("8"==e.Type.toString()||"3"==e.Type.toString()||"11"==e.Type.toString()||"12"==e.Type.toString()))if("11"==e.Type.toString()||"12"==e.Type.toString()){let t=this.GetProductValues(e,0,!1,l);a.a.page.ShowDialog(new re(this,e,t),Ge.a)}else a.a.page.ShowDialog(new re(this,e,null),Ge.a);return}if(n.e.IsEmpty(e.ProductID_Key)||this.ProdID==parseInt(e.ProductID_Key)||this.ScreenObject.Preferences.ContainsKey("SnoBasedLinking")&&""!=this.ScreenObject.Preferences.SnoBasedLinking&&Object(o.j)(this.ScreenObject.Preferences.SnoBasedLinking)||(e.LinkedInvDocDetailsID=0,e.LinkedFieldName="",e.RefNo=""),n.e.IsEmpty(e.ProductID_Key)||this.ProdID==parseInt(e.ProductID_Key)||0==parseInt(e.ProductID_Key)||(e.ExtraXML=null,!(this.ProdID>0)||this.ScreenObject.Preferences.ContainsKey("Dontresetvaluesonproductchange")&&""!=this.ScreenObject.Preferences.Dontresetvaluesonproductchange&&Object(o.j)(this.ScreenObject.Preferences.Dontresetvaluesonproductchange))||this.ScreenObject.ColumnSource.filter(e=>e.DisplayMember.toLowerCase().Contains("dcalpha")).forEach(t=>{"FillGUID"!=t.DistributeColName&&(e[t.DisplayMember]=null)}),31!=this.ScreenObject.DocumentType&&32!=this.ScreenObject.DocumentType||null==c){if(!n.e.IsEmpty(e.ProductID_Key)&&e.ProductID_Key.toString()!=this.ScreenObject.TempProductID.toString()&&(this.ScreenObject.Preferences.ContainsKey("Alert Duplicate Product")&&""!=this.ScreenObject.Preferences["Alert Duplicate Product"].toString()&&Object(o.j)(this.ScreenObject.Preferences["Alert Duplicate Product"])||(31==this.ScreenObject.DocumentType||32==this.ScreenObject.DocumentType)&&!this.ScreenObject.GridDataColumns.Contains("BOEID")))for(let t=0;t<this.ScreenObject.GridData.length;t++)if(this.ScreenObject.GridData[t]!=e&&!n.e.IsEmpty(this.ScreenObject.GridData[t].ProductID_Key)&&this.ScreenObject.GridData[t].ProductID_Key.toString()==e.ProductID_Key.toString()&&("5"!=this.ScreenObject.GridData[t].Type.toString()||31!=this.ScreenObject.DocumentType&&32!=this.ScreenObject.DocumentType)){if(a.a.SessionManager.Preferences.ContainsKey("ShowProdCodeinErrMsg")&&Object(o.j)(a.a.SessionManager.Preferences.ShowProdCodeinErrMsg)?this.res=this.ScreenObject.GridData[t].ProductCode.toString()+"-"+this.ScreenObject.GridData[t].ProductName.toString():this.ScreenObject.GridDataColumns.Contains("ProductName")?this.res=this.ScreenObject.GridData[t].ProductName.toString():this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(this.res=this.ScreenObject.GridData[t].ProductCode.toString()),confirm("Product '"+this.res+"' Already exists at Row No:"+this.ScreenObject.GridData[t].DocSeqNo.toString()+".\nDo you want to continue?")&&31!=this.ScreenObject.DocumentType&&32!=this.ScreenObject.DocumentType)break;if(this.ProdID>0){e.ProductID_Key=this.ProdID;let t=a.a.document.GetCCValues(this.ProdID.toString(),3,2);return void(null!=t&&t.Tables.length>0&&t.Columns[0].Contains("name")&&(this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(e.ProductCode=t[0].Code.toString()),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(e.ProductName=t[0].name.toString())))}return this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(e.ProductCode=null),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(e.ProductName=null),this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&(e.ProductID_Key=null),this.LineNo=t+1,void(this.SetFocusongrid=!0)}}else{var h=this.ScreenObject.GridData.filter(t=>t[c.ValueMember]==n.e.String(e[c.ValueMember]));if(h.length>1)return a.a.SessionManager.Preferences.ContainsKey("ShowProdCodeinErrMsg")&&Object(o.j)(a.a.SessionManager.Preferences.ShowProdCodeinErrMsg)?this.res=e.ProductCode.toString()+"-"+e.ProductName.toString():this.ScreenObject.GridDataColumns.Contains("ProductName")?this.res=e.ProductName.toString():this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(this.res=e.ProductCode.toString()),this.DisplayMessage="Product '"+this.res+"' Already exists at Row No:"+h[0].DocSeqNo.toString(),void(this.SetFocusongrid=!0)}31==this.ScreenObject.DocumentType&&this.ScreenObject.GridDataColumns.Contains("DueDate")&&(e.DueDate=Date.Today().ToString(a.a.SessionManager.Preferences["Date Format"]),e.DueDate_Key=Date.Today()),n.e.IsEmpty(e.ProductID_Key)||(this.FillDefaultValues(e),this.RepeatRowData(e),this.BindDivisionorLocation(e));let u=this.GetProductValues(e,0,!1,l);if(null!=u&&u.Tables.length>4&&u.Tables[4].length>0){let e=u.Tables[4].filter(e=>-1==e.ColID);if(e.length>0)for(let t=0;t<e.length;t++)alert(e[t].Message.toString())}if(!n.e.IsEmpty(l)&&!n.e.IsEmpty(e.ProductID_Key))return;try{this.ScreenObject.GridDataColumns.Contains("ProductCode")&&n.e.IsEmpty(e.ProductCode)&&(e.ProductCode=u.Tables[0][0].ProductCode),this.ScreenObject.GridDataColumns.Contains("ProductName")&&n.e.IsEmpty(e.ProductName)&&(e.ProductName=u.Tables[0][0].ProductName),this.ScreenObject.GridDataColumns.Contains("IsWeightable")&&u.Columns[0].Contains("IsWeightable")&&(e.IsWeightable=u.Tables[0][0].IsWeightable)}catch(b){}if(i)e.Subexists="1";else if(null!=u&&u.Tables.length>8&&u.Tables[8].length>1&&!u.Columns[8].Contains("ErrorMessage")&&(!this.ScreenObject.Preferences.ContainsKey("SubstituteOnQty")||""==this.ScreenObject.Preferences.SubstituteOnQty.toString()||!this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.Preferences.SubstituteOnQty))&&this.ScreenObject.Preferences.ContainsKey("EnableSubtitutes")&&""!=this.ScreenObject.Preferences.EnableSubtitutes.toString()&&Object(o.j)(this.ScreenObject.Preferences.EnableSubtitutes))if(s||0!=a.a.page.DialogCount)e.Subexists="1";else{if(null!=e.ProductCode){let t=new De.a(this,u.Tables[8],u.Columns[8],u.Tables[9],e.ProductName.toString(),e.ProductCode.toString(),e.ProductID_Key.toString());t.GridData.length>0&&a.a.page.ShowDialog(t,Se.a,{ShowCenter:!0})}else{let t=new De.a(this,u.Tables[8],u.Columns[8],u.Tables[9],e.ProductName.toString(),"","");t.GridData.length>0&&a.a.page.ShowDialog(t,Se.a,{ShowCenter:!0})}if(this.ScreenObject.UpdateSequence(),this.SubDialogResult)return void this.ScreenObject.GridDataObj.updateRow(e);e.AVGRATE=u.Columns[0].Contains("AvgRate")&&!n.e.IsEmpty(u.Tables[0][0].AvgRate)?u.Tables[0][0].AvgRate.toString():0}else e.Subexists="0";if(this.ScreenObject.Preferences.ContainsKey("ProductWiseCreditDays")&&""!=this.ScreenObject.Preferences.ProductWiseCreditDays&&Object(o.j)(this.ScreenObject.Preferences.ProductWiseCreditDays)&&u.Tables.length>0&&u.Tables[0].length>0&&u.Columns[0].Contains("CreditDays")&&this.ScreenObject.GetDueDate_Table(u.Tables[0],this.DocumentDate,!1),u.Tables.length>0&&u.Tables[0].length>0&&!u.Columns[0].Contains("ErrorMessage")&&!n.e.IsEmpty(u.Tables[0][0].DrAccount)&&parseInt(u.Tables[0][0].DrAccount)>0){let t=!1;if(this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")){if(n.e.String(e.DebitAccount_Key)!=u.Tables[0][0].DrAccount.toString()&&(t=!0),e.DebitAccount_Key=u.Tables[0][0].DrAccount.toString(),this.ScreenObject.GridDataColumns.Contains("DebitAccount"))e.DebitAccount=u.Tables[0][0].DrName.toString();else{let t=this.ScreenObject.ColumnSource.find(e=>null!=e.ValueMember&&"debitaccount_key"==e.ValueMember.toLowerCase());t&&(e[t.DisplayMember]=u.Tables[0][0].DrName.toString())}if(t){let t=this.ScreenObject.ColumnSource.find(e=>null!=e.ValueMember&&"debitaccount_key"==e.ValueMember.toLowerCase());this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&e.LocalReference==t.ID).length>0&&this.ScreenObject.GetLinkReferenceData(parseInt(t.ID),this.DocumentID,parseInt(e[t.ValueMember]),Date.Today(),"",t.CostCenterID,e),a.a.SessionManager.Preferences.BudgetAccount.length>0&&a.a.SessionManager.Preferences.BudgetDimension.length>0&&this.BudgetObj.AutoLoadBudgetDimension(e,null)}}else null!=this.ScreenObject.DebitAccount&&(this.ScreenObject.DebitAccount.SelectedValue!=parseInt(u.Tables[0][0].DrAccount)&&(t=!0),this.ScreenObject.DebitAccount.SelectedValue=parseInt(u.Tables[0][0].DrAccount),a.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==a.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(this.ScreenObject.DebitAccount.Name.SelectedValueText=u.Tables[0][0].DrName.toString()),t&&a.a.SessionManager.Preferences.BudgetAccount.length>0&&a.a.SessionManager.Preferences.BudgetDimension.length>0&&this.BudgetObj.AutoLoadBudgetDimension(e,null))}if(u.Tables.length>0&&u.Tables[0].length>0&&!u.Columns[0].Contains("ErrorMessage")&&!n.e.IsEmpty(u.Tables[0][0].CrAccount)&&parseInt(u.Tables[0][0].CrAccount)>0){let t=!1;if(this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")){if(n.e.String(e.CreditAccount_Key)!=u.Tables[0][0].CrAccount.toString()&&(t=!0),e.CreditAccount_Key=u.Tables[0][0].CrAccount.toString(),this.ScreenObject.GridDataColumns.Contains("CreditAccount"))e.CreditAccount=u.Tables[0][0].CrName.toString();else{let t=this.ScreenObject.ColumnSource.find(e=>null!=e.ValueMember&&"creditaccount_key"==e.ValueMember.toLowerCase());t&&(e[t.DisplayMember]=u.Tables[0][0].CrName.toString())}if(t){let t=this.ScreenObject.ColumnSource.find(e=>null!=e.ValueMember&&"creditaccount_key"==e.ValueMember.toLowerCase());this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&e.LocalReference==t.ID).length>0&&this.ScreenObject.GetLinkReferenceData(parseInt(t.ID),this.DocumentID,parseInt(e[t.ValueMember]),Date.Today(),"",t.CostCenterID,e),a.a.SessionManager.Preferences.BudgetAccount.length>0&&a.a.SessionManager.Preferences.BudgetDimension.length>0&&this.BudgetObj.AutoLoadBudgetDimension(e,null)}}else null!=this.ScreenObject.CreditAccount&&(this.ScreenObject.CreditAccount.SelectedValue!=parseInt(u.Tables[0][0].CrAccount)&&(t=!0),this.ScreenObject.CreditAccount.SelectedValue=parseInt(u.Tables[0][0].CrAccount),a.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==a.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(this.ScreenObject.CreditAccount.Name.SelectedValueText=u.Tables[0][0].CrName.toString()),t&&a.a.SessionManager.Preferences.BudgetAccount.length>0&&a.a.SessionManager.Preferences.BudgetDimension.length>0&&this.BudgetObj.AutoLoadBudgetDimension(e,null))}if(u.Tables.length>0&&u.Tables[0].length>0&&!u.Columns[0].Contains("ErrorMessage")&&("8"==u.Tables[0][0].ProductTypeID.toString()||"3"==u.Tables[0][0].ProductTypeID.toString()||"11"==u.Tables[0][0].ProductTypeID.toString()||"12"==u.Tables[0][0].ProductTypeID.toString())){let t=this.ScreenObject.GridData.indexOf(e)+1;e.Type=u.Tables[0][0].ProductTypeID.toString(),this.ScreenObject.GridDataColumns.Contains("BinWise")&&u.Columns[0].Contains("BinWise")&&(e.BinWise=u.Tables[0][0].BinWise),this.ScreenObject.GridDataColumns.Contains("QtyType")&&u.Columns[0].Contains("QtyAdjustType")&&(e.QtyType=u.Tables[0][0].QtyAdjustType),this.ScreenObject.GridDataColumns.Contains("PackType")&&u.Columns[0].Contains("IsPacking")&&(e.PackType=u.Tables[0][0].IsPacking),this.ScreenObject.GridDataColumns.Contains("IsTestCase")&&u.Columns[0].Contains("TestCaseExists")&&(e.IsTestCase=u.Tables[0][0].TestCaseExists),this.ScreenObject.GridDataColumns.Contains("landingType")&&u.Columns[0].Contains("IsBillOfEntry")&&(e.landingType=u.Tables[0][0].IsBillOfEntry),u.Tables.length>3&&u.Tables[3].length>0?1==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||10==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||31==this.ScreenObject.DocumentType?null!=u.Tables[3][0].PurchaseRate&&(e.Rate=u.Tables[3][0].PurchaseRate):null!=u.Tables[3][0].SellingRate&&(e.Rate=u.Tables[3][0].SellingRate):u.Tables.length>0&&u.Tables[0].length>0&&(1==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||10==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||31==this.ScreenObject.DocumentType?n.e.IsEmpty(u.Tables[0][0].PurchaseRate)||(e.Rate=u.Tables[0][0].PurchaseRate):n.e.IsEmpty(u.Tables[0][0].SellingRate)||(e.Rate=u.Tables[0][0].SellingRate));let s=this.ScreenObject.ColumnSource.find(e=>"Quantity"==e.DisplayMember);if(e.Quantity=s&&""!=s.DefaultValue&&n.e.IsNum(s.DefaultValue)?s.DefaultValue:1,0==a.a.page.DialogCount&&t>0){if(this.res="No",u.Tables.length>0&&u.Columns[0].Contains("uomid")&&!n.e.IsEmpty(u.Tables[0][0].uomid)&&(e.Unit=u.Tables[0][0].UnitName.toString(),e.Unit_Key=u.Tables[0][0].uomid.toString()),this.ScreenObject.Preferences.ContainsKey("IgnoreKitPopup")&&"True"==this.ScreenObject.Preferences.IgnoreKitPopup&&"3"==u.Tables[0][0].ProductTypeID.toString()?new re(this,e,u).OnButtonClick("AutoSave"):a.a.page.ShowDialog(new re(this,e,u),Ge.a),"Yes"==this.res)return;if("No"==this.res&&""==e.ProductID_Key)return}}else if(!s){if((!this.ScreenObject.Preferences.ContainsKey("Dontresetvaluesonproductchange")||""==this.ScreenObject.Preferences.Dontresetvaluesonproductchange||!Object(o.j)(this.ScreenObject.Preferences.Dontresetvaluesonproductchange)||n.e.IsEmpty(e.Quantity))&&!(!n.e.IsEmpty(e.LinkedInvDocDetailsID)&&parseInt(e.LinkedInvDocDetailsID)>0&&this.ScreenObject.Preferences.ContainsKey("SnoBasedLinking")&&""!=this.ScreenObject.Preferences.SnoBasedLinking&&Object(o.j)(this.ScreenObject.Preferences.SnoBasedLinking)))if(n.e.IsEmpty(l)||"0"!=this.IsSales)if(this.ScreenObject.Preferences.ContainsKey("EnableWieghingPopupOnQty")&&""!=this.ScreenObject.Preferences.EnableWieghingPopupOnQty&&Object(o.j)(this.ScreenObject.Preferences.EnableWieghingPopupOnQty)&&"true"==e.IsWeightable.toString().toLowerCase()){let t=this.QtyReader("0");"0"==this.IsSales?(e.Quantity=n.e.IsEmpty(t)?0:-parseFloat(t),this.RowForegroundChange(e)):e.Quantity=n.e.IsEmpty(t)?0:parseFloat(t)}else{let t=this.ScreenObject.ColumnSource.find(e=>"Quantity"==e.DisplayMember),s=0;t&&""!=t.DefaultValue&&n.e.IsNum(t.DefaultValue)?(s=n.e.Double(t.DefaultValue),"0"==this.IsSales?(e.Quantity=-s,this.RowForegroundChange(e)):e.Quantity=s):"0"==this.IsSales?(e.Quantity=-1,this.RowForegroundChange(e)):e.Quantity=1}else e.Quantity=-1,this.RowForegroundChange(e);n.e.IsEmpty(e.Rate)||(e.Rate=0,e.defaultRate=0)}if(!n.e.IsEmpty(e.Quantity)&&this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&parseInt(e.ProductID_Key)!=this.ScreenObject.TempProductID&&this.ScreenObject.Preferences.ContainsKey("DuplicateProduct_IncrementQuantity")&&""!=this.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity&&Object(o.j)(this.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity)&&(this.ScreenObject.ColumnSource.find(e=>"quantity"==e.DisplayMember.toLowerCase()).ReadOnly||s)&&(u.Tables.length>0&&u.Columns[0].Contains("uomid")&&!n.e.IsEmpty(u.Tables[0][0].uomid)&&(e.Unit=u.Tables[0][0].UnitName.toString(),e.Unit_Key=u.Tables[0][0].uomid.toString()),e.Type=u.Tables[0][0].ProductTypeID.toString(),this.AddProductQty(e,!s)))return n.e.IsEmpty(e.Quantity)||n.e.IsEmpty(e.UOMConversion)||!n.e.IsNum(e.UOMConversion)?n.e.IsEmpty(e.Quantity)||(e.UOMConvertedQty=e.Quantity.toString()):e.UOMConvertedQty=n.e.Double(e.UOMConversion)*parseFloat(e.Quantity),void this.ScreenObject.GridDataObj.updateRow(e);if(u.Tables.length>0&&u.Tables[0].length>0&&!u.Columns[0].Contains("ErrorMessage")){if(e.Type=u.Tables[0][0].ProductTypeID.toString(),this.ScreenObject.GridDataColumns.Contains("QtyType")&&u.Columns[0].Contains("QtyAdjustType")&&(e.QtyType=u.Tables[0][0].QtyAdjustType),this.ScreenObject.GridDataColumns.Contains("PackType")&&u.Columns[0].Contains("IsPacking")&&(e.PackType=u.Tables[0][0].IsPacking),this.ScreenObject.GridDataColumns.Contains("IsTestCase")&&u.Columns[0].Contains("TestCaseExists")&&(e.IsTestCase=u.Tables[0][0].TestCaseExists),this.ScreenObject.GridDataColumns.Contains("landingType")&&u.Columns[0].Contains("IsBillOfEntry")&&(e.landingType=u.Tables[0][0].IsBillOfEntry),this.ScreenObject.GridDataColumns.Contains("BinWise")&&u.Columns[0].Contains("BinWise")&&(e.BinWise=u.Tables[0][0].BinWise),e.UOMConversion=u.Tables[0][0].Conversion,u.Columns[0].Contains("FileGUID")&&(e.FileGUID=n.e.String(u.Tables[0][0].FileGUID),e.FileExtension=n.e.String(u.Tables[0][0].FileExtension)),u.Columns[0].Contains("Barcode_Key")&&!n.e.IsEmpty(u.Tables[0][0].Barcode_Key)&&this.ScreenObject.Preferences.ContainsKey("BarcodeDimension")&&""!=this.ScreenObject.Preferences.BarcodeDimension&&parseInt(this.ScreenObject.Preferences.BarcodeDimension)>0){let t=this.ScreenObject.ColumnSource.find(e=>e.CostCenterID==parseInt(this.ScreenObject.Preferences.BarcodeDimension));t&&(e[t.ValueMember]=u.Tables[0][0].Barcode_Key,e[t.DisplayMember]=u.Tables[0][0].UnitProductCode,this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&e.LocalReference==t.ID).length>0&&this.ScreenObject.GetLinkReferenceData(parseInt(t.ID),this.DocumentID,parseInt(e[t.ValueMember]),Date.Today(),"",t.CostCenterID,e))}e.LASTPURCHASERATE=u.Columns[0].Contains("LastPurchaseRate")&&!n.e.IsEmpty(u.Tables[0][0].LastPurchaseRate)?u.Tables[0][0].LastPurchaseRate:0,n.e.IsEmpty(e.Quantity)||n.e.IsEmpty(u.Tables[0][0].Conversion)||!n.e.IsNum(u.Tables[0][0].Conversion)?n.e.IsEmpty(e.Quantity)||(e.UOMConvertedQty=e.Quantity):e.UOMConvertedQty=n.e.Double(u.Tables[0][0].Conversion)*parseFloat(e.Quantity),u.Tables.length>0&&u.Columns[0].Contains("uomid")&&!n.e.IsEmpty(u.Tables[0][0].uomid)&&(e.Unit=u.Tables[0][0].UnitName,e.Unit_Key=u.Tables[0][0].uomid)}let d=null;if(null!=e.Type&&"8"!=n.e.String(e.Type)&&"3"!=n.e.String(e.Type)){let t=this.ScreenObject.ColumnSource.find(e=>"Rate"==e.DisplayMember),s="";if(!n.e.IsEmpty(t.Formula)&&u.Columns[3].Contains(t.Formula)&&(s=t.Formula),u.Tables.length>3&&u.Tables[3].length>0){s=1==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||10==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||31==this.ScreenObject.DocumentType?"PurchaseRate":"SellingRate",d=u.Tables[3][0];let i=this.ScreenObject.GridData.indexOf(e)+1;u.Tables[3].length>1&&i>0&&(null==t.Formula||t.Formula.toLowerCase().Contains("avgrate")),n.e.IsEmpty(s)||n.e.IsEmpty(d[s])||(e.Rate=d[s],e.defaultRate=d[s])}else n.e.IsEmpty(r)?u.Tables.length>0&&u.Tables[0].length>0&&!u.Columns[0].Contains("ErrorMessage")&&(1==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||10==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||31==this.ScreenObject.DocumentType?n.e.IsEmpty(u.Tables[0][0].PurchaseRate)?e.Rate=0:(e.Rate=u.Tables[0][0].PurchaseRate,e.defaultRate=u.Tables[0][0].PurchaseRate):n.e.IsEmpty(u.Tables[0][0].SellingRate)||(e.Rate=u.Tables[0][0].SellingRate,e.defaultRate=u.Tables[0][0].SellingRate)):e.Rate=r}if(null!=u&&u.Tables.length>0&&u.Tables[0].length>0&&!u.Columns[0].Contains("ErrorMessage")&&this.FillLinkRefereceProducts(e,u.Tables[0],d),u.Tables.length>10&&u.Columns[10].Contains("BinId")&&u.Tables[10].length>0&&0!=u.Tables[10][0].BinId&&this.ScreenObject.Preferences.ContainsKey("BinsDimension")&&parseInt(this.ScreenObject.Preferences.BinsDimension)>5e4){let t=this.ScreenObject.ColumnSource.find(e=>e.CostCenterID==parseInt(this.ScreenObject.Preferences.BinsDimension));t&&this.ScreenObject.GridDataColumns.Contains(t.DisplayMember)&&(e[t.DisplayMember]=u.Tables[10][0].BinName.toString(),e[t.ValueMember]=u.Tables[10][0].BinId.toString())}if(this.ScreenObject.ColumnSource.filter(e=>e.DisplayMember.Contains("dcNum")&&4!=e.SectionID).forEach(t=>{if(!(t.linkData>0)&&("8"!=n.e.String(e.Type)&&"3"!=n.e.String(e.Type)&&(this.ScreenObject.Preferences.ContainsKey("Dontresetvaluesonproductchange")&&""!=this.ScreenObject.Preferences.Dontresetvaluesonproductchange&&Object(o.j)(this.ScreenObject.Preferences.Dontresetvaluesonproductchange)&&!n.e.IsEmpty(e.Quantity)||t.IsRepeat||(e[t.DisplayMember]=0,e["default"+t.DisplayMember]=0,e["dcCalc"+t.DisplayMember]=0)),u.Tables.length>4)){let s=u.Tables[4].filter(e=>e.SysColumnName==t.DisplayMember);s.length>0&&(e[t.DisplayMember]=s[0].Value.toString(),e["default"+t.DisplayMember]=s[0].Value.toString())}}),null!=u&&u.Tables.length>7&&u.Tables[7].length>0&&!u.Columns[7].Contains("ErrorMessage")&&this.ScreenObject.Preferences.ContainsKey("Enable Linked Products")&&""!=this.ScreenObject.Preferences["Enable Linked Products"]&&Object(o.j)(this.ScreenObject.Preferences["Enable Linked Products"])&&!t){let t=this.ScreenObject.GridData.indexOf(e)+1;t>0&&this.AddLinkProducts(u.Tables[7],t)}let D=!1,S=this.ScreenObject.ColumnSource.filter(e=>null!=e.ValueMember&&"productid_key"==e.ValueMember.toString().toLowerCase());S.forEach(t=>{this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&e.LocalReference==t.ID).length>0&&""!=t.ValueMember&&null!=e[t.ValueMember]&&!n.e.IsEmpty(e[t.ValueMember])&&(D=!0,this.ScreenObject.GetLinkReferenceData(parseInt(t.ID),this.DocumentID,parseInt(e[t.ValueMember]),Date.Today(),"",t.CostCenterID,e,null,!1))});let m=this.ScreenObject.Data.Tables[0].filter(e=>79==e.LocalReference&&(26585==e.LinkData||54306==e.LinkData||54307==e.LinkData||53529==e.LinkData||53589==e.LinkData||53530==e.LinkData));if(!D&&m.length>0&&S.length>0){let t=S[0];this.ScreenObject.GetLinkReferenceData(parseInt(t.ID),this.DocumentID,parseInt(e[t.ValueMember]),Date.Today(),"",t.CostCenterID,e,null,!1)}this.ScreenObject.Preferences.ContainsKey("BUDGET_BudgetAccountField")&&!n.e.IsEmpty(this.ScreenObject.Preferences.BUDGET_BudgetAccountField)&&this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.Preferences.BUDGET_BudgetAccountField+"_Key")&&!n.e.IsEmpty(e[this.ScreenObject.Preferences.BUDGET_BudgetAccountField+"_Key"])&&this.BudgetObj.AutoLoadBudgetDimension(e,null),null!=u&&u.Tables.length>0&&u.Tables[0].length>0&&!u.Columns[0].Contains("ErrorMessage")&&this.FillSalesPurchase(e,u.Tables[0],d),this.ScreenObject.Preferences.ContainsKey("DimWiseCurrency")&&"true"==this.ScreenObject.Preferences.DimWiseCurrency.toLowerCase()&&this.ScreenObject.Preferences.ContainsKey("CurrencyDim")&&"3"==this.ScreenObject.Preferences.CurrencyDim&&null!=u&&u.Tables.length>12&&u.Columns[12].Contains("Name")&&u.Tables[12].length>0&&(this.ScreenObject.GridDataColumns.Contains("CurrencyID")?(e.CurrencyID_Key=u.Tables[12][0].CurrencyID.toString(),e.CurrencyID=u.Tables[12][0].Name.toString(),this.ScreenObject.GridDataColumns.Contains("ExchangeRate")&&u.Tables.length>13&&u.Columns[13].Contains("Rate")&&u.Tables[13].length>0&&(e.ExchangeRate=u.Tables[13][0].Rate.toString())):this.Currency&&null!=this.Currency.Currency.SelectedValue&&""!=this.Currency.Currency.SelectedValue&&(this.Currency.Currency.SelectedValue=u.Tables[12][0].CurrencyID.toString(),u.Tables.length>13&&u.Columns[13].Contains("Rate")&&u.Tables[13].length>0&&(this.Currency.ExchangeRate.Text=u.Tables[13][0].Rate.toString())))}RowForegroundChange(e,t=!1){this.ScreenObject.GridDataColumns.Contains("Row_Foreground")||this.ScreenObject.GridDataColumns.push("Row_Foreground"),e.Row_Foreground=t?null:"#D30609",this.ScreenObject.GridDataObj.refreshDataView()}ValidateSchemes(){for(let e=0;e<this.ScreenObject.GridData.length;e++)if(!n.e.IsEmpty(this.ScreenObject.GridData[e].ProductID_Key)&&!n.e.IsEmpty(this.ScreenObject.GridData[e].SchemeID)&&parseInt(this.ScreenObject.GridData[e].ProductID_Key)>0&&parseInt(this.ScreenObject.GridData[e].SchemeID)>0&&"N"==this.ScreenObject.GridData[e].IsScheme.toString()){let t=this.ScreenObject.GetSchemes(this.DocumentDate,this.ScreenObject.GridData[e]);if(t.Tables.length>0&&t.Columns[0].Contains("SchemeID")){let s=t.Tables[0].filter(t=>t.SchemeID==this.ScreenObject.GridData[e].SchemeID);if(s.length>0){if(!n.e.IsEmpty(s[0].FromQty)&&!n.e.IsEmpty(this.ScreenObject.GridData[e].Quantity)&&!n.e.IsEmpty(s[0].ToQty)&&parseFloat(s[0].ToQty)!=parseFloat(s[0].FromQty)&&parseFloat(this.ScreenObject.GridData[e].Quantity)>=parseFloat(s[0].FromQty))continue;if(!n.e.IsEmpty(s[0].FromQty)&&!n.e.IsEmpty(this.ScreenObject.GridData[e].Quantity)&&!n.e.IsEmpty(s[0].ToQty)&&parseFloat(s[0].ToQty)==parseFloat(s[0].FromQty)&&parseFloat(this.ScreenObject.GridData[e].Quantity)>=parseFloat(s[0].FromQty))continue}this.fillSchemevalues(t.Tables[0],t.Columns[0],this.ScreenObject.GridData[e]),this.ApplySchemes(this.ScreenObject.GridData[e])}}return!0}fillSchemevalues(e,t,s){null!=this.DtTempSchemes?this.DtTempSchemes.Clear():(this.DtTempSchemes=[],this.DtTempSchemesColumns=[],this.DtTempSchemesColumns.push("SchemeProductID"),this.DtTempSchemesColumns.push("SchemeID"),this.DtTempSchemesColumns.push("ProfileName"),this.DtTempSchemesColumns.push("FromQty"),this.DtTempSchemesColumns.push("ToQty"),this.DtTempSchemesColumns.push("FromValue"),this.DtTempSchemesColumns.push("ToValue"),this.DtTempSchemesColumns.push("ProductID"),this.DtTempSchemesColumns.push("Quantity"),this.DtTempSchemesColumns.push("Value"),this.DtTempSchemesColumns.push("Percentage"),this.DtTempSchemesColumns.push("freeProductID"),this.DtTempSchemesColumns.push("ProductName"),this.DtTempSchemesColumns.push("ProductCode"),this.DtTempSchemesColumns.push("freeQuantity"),this.DtTempSchemesColumns.push("freeValue"),this.DtTempSchemesColumns.push("freePercentage"),this.DtTempSchemesColumns.push("ProductTypeID"),this.DtTempSchemesColumns.push("IsQtyPercent"),this.DtTempSchemesColumns.push("FreeQtyPercent"),this.DtTempSchemesColumns.push("FromDate"),this.DtTempSchemesColumns.push("ToDate"),null!=e&&t.Contains("Dim1")&&(this.DtTempSchemesColumns.push("Dim1"),this.DtTempSchemesColumns.push("Name")));for(let i=0;i<e.length;i++){let s={};s.SchemeProductID=e[i].SchemeProductID.toString(),s.SchemeID=e[i].SchemeID.toString(),s.FromQty=e[i].FromQty.toString(),s.ToQty=e[i].ToQty.toString(),s.ProfileName=e[i].ProfileName.toString(),s.FromValue=e[i].FromValue.toString(),s.ToValue=e[i].ToValue.toString(),s.ProductID=e[i].ProductID.toString(),s.Quantity=e[i].Quantity.toString(),s.Value=e[i].Value.toString(),s.Percentage=e[i].Percentage.toString(),s.IsQtyPercent=e[i].IsQtyPercent.toString(),s.FromDate=e[i].FromDate.toString(),s.ToDate=e[i].ToDate.toString(),n.e.IsEmpty(e[i].freeProductID)||(s.FreeQtyPercent=e[i].FreeQtyPercent.toString(),s.freeProductID=e[i].freeProductID.toString(),s.ProductName=e[i].ProductName.toString(),s.ProductCode=e[i].ProductCode.toString(),s.freeQuantity=e[i].freeQuantity.toString(),s.freeValue=e[i].freeValue.toString(),s.freePercentage=e[i].freePercentage.toString(),s.ProductTypeID=e[i].ProductTypeID.toString(),t.Contains("Dim1")&&this.DtTempSchemesColumns.Contains("Dim1")&&(s.Dim1=e[i].Dim1.toString(),s.Name=e[i].Name.toString())),this.DtTempSchemes.push(s)}}FillRowValues(e,t,s){let i={};if(i.SchemeProductID=t.SchemeProductID.toString(),i.SchemeID=t.SchemeID.toString(),i.FromQty=t.FromQty.toString(),i.ToQty=t.ToQty.toString(),i.ProfileName=t.ProfileName.toString(),i.FromValue=t.FromValue.toString(),i.ToValue=t.ToValue.toString(),i.ProductID=t.ProductID.toString(),i.Quantity=t.Quantity.toString(),i.Value=t.Value.toString(),i.Percentage=t.Percentage.toString(),i.IsQtyPercent=t.IsQtyPercent.toString(),i.ToDate=t.ToDate.toString(),i.FromDate=t.FromDate.toString(),!n.e.IsEmpty(t.freeProductID)){i.FreeQtyPercent=t.FreeQtyPercent.toString(),i.freeProductID=t.freeProductID.toString(),i.ProductName=t.ProductName.toString(),i.ProductCode=t.ProductCode.toString(),i.freeQuantity=t.freeQuantity.toString(),i.freeValue=t.freeValue.toString(),i.freePercentage=t.freePercentage.toString(),i.ProductTypeID=t.ProductTypeID.toString(),i.FreeProductName=t.ProductName.toString();var a=e.filter(e=>e.SchemeID==t.SchemeID.toString()&&(null==e.StyleHeightZero||1!=e.StyleHeightZero));a.length>0&&(a[0].FreeProductName=a[0].FreeProductName.toString()+","+t.ProductName.toString(),i.StyleHeightZero="1"),s.Contains("Dim1")&&(i.Dim1=t.Dim1.toString(),i.Name=t.Name.toString())}e.push(i)}ApplySchemes(e){let t=!1;if(this.ScreenObject.Preferences.ContainsKey("EnableSchemes")&&Object(o.j)(this.ScreenObject.Preferences.EnableSchemes)&&(t=Object(o.j)(this.ScreenObject.Preferences.EnableSchemes)),!t)return;let s=!1,i=[],r=[],l=[];{l.push("SchemeProductID"),l.push("SchemeID"),l.push("FromQty"),l.push("ToQty"),l.push("FromValue"),l.push("ToValue"),l.push("ProductID"),l.push("Quantity"),l.push("Value"),l.push("Percentage"),l.push("freeProductID"),l.push("ProductName"),l.push("FreeProductName"),l.push("StyleHeightZero"),l.push("ProductCode"),l.push("freeQuantity"),l.push("freeValue"),l.push("ProfileName"),l.push("freePercentage"),l.push("ProductTypeID"),l.push("IsQtyPercent"),l.push("FreeQtyPercent"),l.push("ToDate"),l.push("FromDate"),null!=this.DtTempSchemes&&this.DtTempSchemesColumns.Contains("Dim1")&&(l.push("Dim1"),l.push("Name"));let t="GROSS";if(this.ScreenObject.Preferences.ContainsKey("SchemesNumericFields")&&""!=this.ScreenObject.Preferences.SchemesNumericFields&&"0"!=this.ScreenObject.Preferences.SchemesNumericFields){let e=this.ScreenObject.ColumnSource.find(e=>e.ID==this.ScreenObject.Preferences.SchemesNumericFields);e&&""!=e.DisplayMember&&(t=e.DisplayMember)}if(!n.e.IsEmpty(e.ProductID_Key)&&null!=this.DtTempSchemes){let c=this.DtTempSchemes.filter(t=>t.ProductID==e.ProductID_Key);if(c.sort((e,t)=>e.FromQty<t.FromQty||e.FromQty==t.FromQty&&e.FromValue<t.FromValue?1:-1),c.length>0){let h=0,u=0,d=a.a.SessionManager.Preferences.LoyaltyBasedOn.toString().split(",");if(this.ScreenObject.Preferences.ContainsKey("PriceScheme")&&Object(o.j)(this.ScreenObject.Preferences.PriceScheme))n.e.IsEmpty(e.Quantity)||(h=parseFloat(e.Quantity)),n.e.IsEmpty(e[t])||(u=parseFloat(e[t]));else{i=this.ScreenObject.GridData.filter(t=>t.ProductID_Key==e.ProductID_Key&&(Object(f.isNullOrUndefined)(t.IsScheme)||"Y"!=t.IsScheme));let s=i.Compute("sum","Quantity");null!=s&&n.e.IsNum(s)&&(h=parseFloat(s)),s=i.Compute("sum",t),null!=s&&n.e.IsNum(s)&&(u=parseFloat(s))}for(let s=0;s<c.length;s++){let a=c[s];if(d.length>1&&(!this.ScreenObject.Preferences.ContainsKey("PriceScheme")||!Object(o.j)(this.ScreenObject.Preferences.PriceScheme))){i=this.ScreenObject.GridData.filter(e=>Object(f.isNullOrUndefined)(e.IsScheme)||"Y"!=e.IsScheme),d.Contains("-1")&&(i=i.filter(e=>e.SchemeProductID==a.SchemeProductID)),d.forEach(t=>{let s=this.ScreenObject.ColumnSource.find(e=>e.CostCenterID.toString()==t);s&&!n.e.IsEmpty(e[s.ValueMember])&&(i=i.filter(t=>t[s.ValueMember]==e[s.ValueMember]))});let s=i.Compute("sum","Quantity");null!=s&&n.e.IsNum(s)&&(h=parseFloat(s)),s=i.Compute("sum",t),null!=s&&n.e.IsNum(s)&&(u=parseFloat(s))}(!n.e.IsEmpty(a.FromQty)&&!n.e.IsEmpty(a.ToQty)&&parseFloat(a.FromQty)>0&&parseFloat(a.ToQty)!=parseFloat(a.FromQty)&&h>=parseFloat(a.FromQty)&&(0==parseFloat(a.ToQty)||h<=parseFloat(a.ToQty))||!n.e.IsEmpty(a.FromQty)&&!n.e.IsEmpty(a.ToQty)&&parseFloat(a.FromQty)>0&&parseFloat(a.ToQty)==parseFloat(a.FromQty)&&h>=parseFloat(a.FromQty)||!n.e.IsEmpty(a.FromValue)&&!n.e.IsEmpty(a.ToValue)&&parseFloat(a.FromValue)>0&&parseFloat(a.ToValue)!=parseFloat(a.FromValue)&&u>=parseFloat(a.FromValue)&&(0==parseFloat(a.ToValue)||u<=parseFloat(a.ToValue))||!n.e.IsEmpty(a.FromValue)&&!n.e.IsEmpty(a.ToValue)&&parseFloat(a.FromValue)>0&&parseFloat(a.ToValue)==parseFloat(a.FromValue)&&u>=parseFloat(a.FromValue))&&this.FillRowValues(r,a,l)}1==r.length?(s=!0,this.FillSchemeRows(e,r[0],t),d.Contains("-1")&&(e.SchemeProductID=r[0].SchemeProductID.toString()),!n.e.IsEmpty(r[0].Percentage)&&parseFloat(r[0].Percentage)>0&&!n.e.IsEmpty(r[0].IsQtyPercent)&&2==parseInt(r[0].IsQtyPercent)?this.CalculateTotals(e,!1):this.CalculateTotals(null,!1)):r.length>1||0==r.length&&d.Contains("-1")&&c.length>0&&(e.SchemeProductID=c[0].SchemeProductID.toString())}}}if(!s){let t="";if(i.length>0){let e=i.filter(e=>-1==e.SchemeID);if(this.ScreenObject.Preferences.ContainsKey("SchemesValueField")&&""!=this.ScreenObject.Preferences.SchemesValueField&&"0"!=this.ScreenObject.Preferences.SchemesValueField){let t=this.ScreenObject.ColumnSource.find(e=>e.ID==this.ScreenObject.Preferences.SchemesValueField);t&&""!=t.DisplayMember&&e.forEach(e=>{e[t.DisplayMember]="0",this.CalculateTotals(e,!1)})}}else if("-1"==n.e.String(e.SchemeID)&&this.ScreenObject.Preferences.ContainsKey("SchemesValueField")&&""!=this.ScreenObject.Preferences.SchemesValueField&&"0"!=this.ScreenObject.Preferences.SchemesValueField){let t=this.ScreenObject.ColumnSource.find(e=>e.ID==this.ScreenObject.Preferences.SchemesValueField);t&&""!=t.DisplayMember&&(e[t.DisplayMember]="0",this.CalculateTotals(e,!1))}let s=[];if(n.e.IsEmpty(e.ProductID_Key)){if(n.e.IsEmpty(e.MaxSchemeID))return;s=this.ScreenObject.GridData.filter(t=>t.MaxSchemeID==e.MaxSchemeID&&(Object(f.isNullOrUndefined)(t.IsScheme)||"Y"!=t.IsScheme))}else s=this.ScreenObject.GridData.filter(t=>t.ProductID_Key==e.ProductID_Key&&(Object(f.isNullOrUndefined)(t.IsScheme)||"Y"!=t.IsScheme));s.forEach(e=>{!n.e.IsEmpty(e.MaxSchemeID)&&parseInt(e.MaxSchemeID)>0&&(t+=e.MaxSchemeID.toString()+",",e.IsScheme=null,e.MaxSchemeID=null,e.SchemeID=null)}),t.length>1&&(t=t.Remove(t.length-1,1),this.ScreenObject.GridData.filter(e=>t.split(",").Contains(e.MaxSchemeID)&&"Y"==e.IsScheme).forEach(e=>{this.ScreenObject.GridDataObj.removeRow(e)}))}}Copyparentrow(e,t){for(let s=0;s<this.ScreenObject.GridDataColumns.length;s++)this.ScreenObject.GridDataColumns[s].toLowerCase().Contains("ccnid")&&this.ScreenObject.GridDataColumns[s].toLowerCase().Contains("alpha")&&(e[s]=t[s])}FillSchemeRows(e,t,s){let i=0;a.a.SessionManager.Preferences.ContainsKey("SchemeFreeProdDim")&&(i=n.e.Int(a.a.SessionManager.Preferences.SchemeFreeProdDim));let r=s;if(this.ScreenObject.Preferences.ContainsKey("SchemesValueField")&&""!=this.ScreenObject.Preferences.SchemesValueField&&"0"!=this.ScreenObject.Preferences.SchemesValueField){let e=this.ScreenObject.ColumnSource.find(e=>e.ID==this.ScreenObject.Preferences.SchemesValueField);e&&""!=e.DisplayMember&&(r=e.DisplayMember)}let l=0,c=0,h=a.a.SessionManager.Preferences.LoyaltyBasedOn.toString().split(","),u=null;if(this.ScreenObject.Preferences.ContainsKey("PriceScheme")&&Object(o.j)(this.ScreenObject.Preferences.PriceScheme))n.e.IsEmpty(e.Quantity)||(l=parseFloat(e.Quantity)),n.e.IsEmpty(e[s])||(c=parseFloat(e[s])),u=[];else{let i;h.length>1?(i=h.Contains("-1")?this.ScreenObject.GridData.filter(e=>(Object(f.isNullOrUndefined)(e.IsScheme)||"Y"!=e.IsScheme)&&e.SchemeProductID==t.SchemeProductID):this.ScreenObject.GridData.filter(e=>Object(f.isNullOrUndefined)(e.IsScheme)||"Y"!=e.IsScheme),h.forEach(t=>{let s=this.ScreenObject.ColumnSource.find(e=>e.CostCenterID.toString()==t);s&&!n.e.IsEmpty(e[s.ValueMember])&&(i=i.filter(t=>t[s.ValueMember]==e[s.ValueMember]))})):i=this.ScreenObject.GridData.filter(t=>t.ProductID_Key==e.ProductID_Key&&(Object(f.isNullOrUndefined)(t.IsScheme)||"Y"!=t.IsScheme));let a=i.Compute("sum","Quantity");null!=a&&(l=n.e.Double(a)),a=i.Compute("sum",s),null!=a&&(c=n.e.Double(a)),u=i}let d=!1,D="",S=0;if(u.forEach(e=>{!n.e.IsEmpty(e.MaxSchemeID)&&parseInt(e.MaxSchemeID)>0&&(D+=e.MaxSchemeID.toString()+",")}),D.length>1&&(D=D.Remove(D.length-1,1)),parseFloat(t.FromQty)>0){if(parseFloat(t.ToQty)!=parseFloat(t.FromQty))if(!n.e.IsEmpty(t.freeProductID)&&parseInt(t.freeProductID)>0){let a=this.ScreenObject.GridData.Compute("max","MaxSchemeID");null!=a&&(S=n.e.Int(a)),S++;let h=null,u=this.DtTempSchemes.filter(e=>e.SchemeID==t.SchemeID),m=null;""!=D&&(m=this.ScreenObject.GridData.filter(e=>D.split(",").Contains(e.MaxSchemeID)&&"Y"==e.IsScheme));for(let b=0;b<u.length;b++){if(d=!1,""!=D&&null!=m&&m.length>b?(h=m[b],S=parseInt(D.split(",")[0])):(h=this.ScreenObject.GridDataObj.NewRow(),h.IsScheme="Y",e.IsScheme="N",h.MaxSchemeID=S,e.MaxSchemeID=S,this.ScreenObject.GridDataObj.insertRowAt(h,this.ScreenObject.GridData.indexOf(e)+1),this.ScreenObject.UpdateSequence()),this.ScreenObject.Preferences.ContainsKey("schemecopydata")&&Object(o.j)(this.ScreenObject.Preferences.schemecopydata)&&this.Copyparentrow(h,e),h.ProductID_Key.toString()!=u[b].freeProductID.toString()&&(d=!0),h.ProductID_Key=u[b].freeProductID.toString(),this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(h.ProductCode=u[b].ProductCode.toString()),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(h.ProductName=u[b].ProductName.toString()),n.e.IsEmpty(u[b].freeQuantity)||(h.FreeQTY=parseFloat(u[b].freeQuantity)),i>5e4&&this.DtTempSchemesColumns.Contains("Dim1")&&!n.e.IsEmpty(u[b].Dim1)&&this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(i-5e4))&&(h["dcCCNID"+(i-5e4)]=u[b].Name.toString(),h["dcCCNID"+(i-5e4)+"_Key"]=u[b].Dim1.toString()),this.FillDatarowNN(h,null,t,{LocalReference:79,LinkData:53734},"ProfileName"),this.FillDatarowNN(h,null,t,{LocalReference:79,LinkData:55480},"FromDate"),this.FillDatarowNN(h,null,t,{LocalReference:79,LinkData:55483},"ToDate"),this.FillDatarowNN(h,null,t,{LocalReference:79,LinkData:55850},"FromQty"),this.FillDatarowNN(h,null,t,{LocalReference:79,LinkData:55851},"ToQty"),!n.e.IsEmpty(u[b].freeQuantity)&&parseFloat(u[b].freeQuantity)>0)h.FreeQTY=parseFloat(u[b].freeQuantity),h[r]=0;else if(!n.e.IsEmpty(t.freeValue)&&parseFloat(u[b].freeValue)>0)h[r]=-1*parseFloat(u[b].freeValue),h.FreeQTY=0;else if(!n.e.IsEmpty(u[b].freePercentage)&&parseFloat(u[b].freePercentage)>0)if(!n.e.IsEmpty(u[b].FreeQtyPercent)&&Object(o.j)(u[b].FreeQtyPercent)){let e=l/100*parseFloat(u[b].freePercentage);h.FreeQTY=e,h[r]=0}else if(!n.e.IsEmpty(e[s])){let e=c/100*parseFloat(u[b].freePercentage);h[r]=-1*e,h.FreeQTY=0}n.e.IsEmpty(u[b].ProductTypeID)||(h.Type=parseFloat(u[b].ProductTypeID)),d?this.FillProductValues(h):this.CalculateTotals(h,!1),h.SchemeID=u[b].SchemeID.toString(),!n.e.IsEmpty(h.FreeQTY)&&parseFloat(h.FreeQTY)>0&&(h.UOMConvertedQty=n.e.IsEmpty(h.UOMConversion)?h.FreeQTY.toString():parseFloat(h.FreeQTY)*parseFloat(h.UOMConversion))}if(null!=m)for(let e=u.length;e<m.length;e++)this.ScreenObject.GridDataObj.removeRow(m[e])}else{let i=null;if(""!=D&&this.ScreenObject.GridData.filter(e=>e.MaxSchemeID&&D.split(",").Contains(e.MaxSchemeID.toString())&&"Y"==e.IsScheme).length>0){let e=this.ScreenObject.GridData.filter(e=>e.MaxSchemeID&&D.split(",").Contains(e.MaxSchemeID.toString())&&"Y"==e.IsScheme);i=e[0],S=parseInt(e[0].MaxSchemeID);for(let t=1;t<e.length;t++)this.ScreenObject.GridDataObj.removeRow(e[t])}else if(n.e.IsEmpty(t.Percentage)||!(parseFloat(t.Percentage)>0)||n.e.IsEmpty(t.IsQtyPercent)||2!=parseInt(t.IsQtyPercent)){i=this.ScreenObject.GridDataObj.NewRow();let t=this.ScreenObject.GridData.Compute("max","MaxSchemeID");null!=t&&(S=n.e.Int(t)),S++,i.IsScheme="Y",e.IsScheme="N",i.MaxSchemeID=S,e.MaxSchemeID=S,this.ScreenObject.GridDataObj.insertRowAt(i,this.ScreenObject.GridData.indexOf(e)+1),this.ScreenObject.UpdateSequence()}if(this.ScreenObject.Preferences.ContainsKey("schemecopydata")&&Object(o.j)(this.ScreenObject.Preferences.schemecopydata)&&this.Copyparentrow(i,e),!n.e.IsEmpty(t.Percentage)&&parseFloat(t.Percentage)>0&&!n.e.IsEmpty(t.IsQtyPercent)&&2==parseInt(t.IsQtyPercent)||(i.ProductID_Key=e.ProductID_Key.toString(),this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(i.ProductCode=e.ProductCode.toString()),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(i.ProductName=e.ProductName.toString()),this.FillDatarowNN(i,null,t,{LocalReference:79,LinkData:53734},"ProfileName"),this.FillDatarowNN(i,null,t,{LocalReference:79,LinkData:55480},"FromDate"),this.FillDatarowNN(i,null,t,{LocalReference:79,LinkData:55483},"ToDate"),this.FillDatarowNN(i,null,t,{LocalReference:79,LinkData:55850},"FromQty"),this.FillDatarowNN(i,null,t,{LocalReference:79,LinkData:55851},"ToQty")),!n.e.IsEmpty(t.Quantity)&&parseFloat(t.Quantity)>0)i.FreeQTY=parseFloat(t.Quantity),i[r]=0;else if(!n.e.IsEmpty(t.Value)&&parseFloat(t.Value)>0)i[r]=-1*parseFloat(t.Value),i.FreeQTY=0;else if(!n.e.IsEmpty(t.Percentage)&&parseFloat(t.Percentage)>0)if(n.e.IsEmpty(t.IsQtyPercent)||2!=parseInt(t.IsQtyPercent))if(n.e.IsEmpty(t.IsQtyPercent)||1!=parseInt(t.IsQtyPercent)){if(!n.e.IsEmpty(e[s])){let e=c/100*parseFloat(t.Percentage);i[r]=-1*e,i.FreeQTY=0}}else{let e=l/100*parseFloat(t.Percentage);i.FreeQTY=e,i[r]=0}else e[r]=t.Percentage.toString(),e.SchemeID="-1",this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:53734},"ProfileName"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55480},"FromDate"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55483},"ToDate"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55850},"FromQty"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55851},"ToQty"),u.forEach(t=>{t!=e&&(t[r]=0)});!n.e.IsEmpty(t.Percentage)&&parseFloat(t.Percentage)>0&&!n.e.IsEmpty(t.IsQtyPercent)&&2==parseInt(t.IsQtyPercent)||(i.Type=n.e.String(e.Type),i.SchemeID=t.SchemeID.toString(),d?this.FillProductValues(i):this.CalculateTotals(i,!1),!n.e.IsEmpty(i.FreeQTY)&&parseFloat(i.FreeQTY)>0&&(i.UOMConvertedQty=n.e.IsEmpty(i.UOMConversion)?i.FreeQTY.toString():parseFloat(i.FreeQTY)*parseFloat(i.UOMConversion)))}else if(parseFloat(t.ToQty)==parseFloat(t.FromQty)){let a=0;if(!n.e.IsEmpty(t.freeProductID)&&parseInt(t.freeProductID)>0){let h=this.ScreenObject.GridData.Compute("max","MaxSchemeID");null!=h&&(S=n.e.Int(h)),S++;let u=null,m=this.DtTempSchemes.filter(e=>e.SchemeID==t.SchemeID),b=null;""!=D&&(b=this.ScreenObject.GridData.filter(e=>D.split(",").Contains(e.MaxSchemeID)&&"Y"==e.IsScheme));for(let C=0;C<m.length;C++){if(d=!1,""!=D&&null!=b&&b.length>C?(u=b[C],S=parseInt(D.split(",")[0])):(u=this.ScreenObject.GridDataObj.NewRow(),u.IsScheme="Y",e.IsScheme="N",u.MaxSchemeID=S,e.MaxSchemeID=S,this.ScreenObject.GridDataObj.insertRowAt(u,this.ScreenObject.GridData.indexOf(e)+1),this.ScreenObject.UpdateSequence()),this.ScreenObject.Preferences.ContainsKey("schemecopydata")&&Object(o.j)(this.ScreenObject.Preferences.schemecopydata)&&this.Copyparentrow(u,e),u.ProductID_Key.toString()!=m[C].freeProductID.toString()&&(d=!0),u.ProductID_Key=m[C].freeProductID.toString(),this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(u.ProductCode=m[C].ProductCode.toString()),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(u.ProductName=m[C].ProductName.toString()),n.e.IsEmpty(m[C].ProductTypeID)||(u.Type=parseFloat(m[C].ProductTypeID)),!n.e.IsEmpty(m[C].freeQuantity)&&parseFloat(m[C].freeQuantity)>0){a=parseFloat(m[C].freeQuantity);let e=l/parseFloat(m[C].FromQty);u.FreeQTY=Math.floor(e)*a,u[r]=0}else if(!n.e.IsEmpty(t.freeValue)&&parseFloat(m[C].freeValue)>0){a=parseFloat(m[C].freeValue);let e=l/parseFloat(m[C].FromQty);u[r]=Math.floor(e)*a*-1,u.FreeQTY=0}else if(!n.e.IsEmpty(m[C].freePercentage)&&parseFloat(m[C].freePercentage)>0)if(!n.e.IsEmpty(m[C].FreeQtyPercent)&&Object(o.j)(m[C].FreeQtyPercent)){a=parseFloat(m[C].freePercentage);let e=l/parseFloat(m[C].FromQty);e=l/100*Math.floor(e),u.FreeQTY=e*a,u[r]=0}else if(!n.e.IsEmpty(e[s])){a=parseFloat(m[C].freePercentage);let e=l/parseFloat(m[C].FromQty);e=c/100*Math.floor(e),u[r]=e*a*-1,u.FreeQTY=0}i>5e4&&this.DtTempSchemesColumns.Contains("Dim1")&&!n.e.IsEmpty(m[C].Dim1)&&this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(i-5e4))&&(u["dcCCNID"+(i-5e4)]=m[C].Name.toString(),u["dcCCNID"+(i-5e4)+"_Key"]=m[C].Dim1.toString()),this.FillDatarowNN(u,null,t,{LocalReference:79,LinkData:53734},"ProfileName"),this.FillDatarowNN(u,null,t,{LocalReference:79,LinkData:55480},"FromDate"),this.FillDatarowNN(u,null,t,{LocalReference:79,LinkData:55483},"ToDate"),this.FillDatarowNN(u,null,t,{LocalReference:79,LinkData:55850},"FromQty"),this.FillDatarowNN(u,null,t,{LocalReference:79,LinkData:55851},"ToQty"),u.SchemeID=m[C].SchemeID.toString(),d?this.FillProductValues(u):this.CalculateTotals(u,!1),!n.e.IsEmpty(u.FreeQTY)&&parseFloat(u.FreeQTY)>0&&(u.UOMConvertedQty=n.e.IsEmpty(u.UOMConversion)?u.FreeQTY.toString():parseFloat(u.FreeQTY)*parseFloat(u.UOMConversion))}if(null!=b)for(let e=m.length;e<b.length;e++)this.ScreenObject.GridDataObj.removeRow(b[e])}else{let i=null;if(""!=D&&this.ScreenObject.GridData.filter(e=>e.MaxSchemeID&&D.split(",").Contains(e.MaxSchemeID.toString())&&"Y"==e.IsScheme).length>0){let e=this.ScreenObject.GridData.filter(e=>e.MaxSchemeID&&D.split(",").Contains(e.MaxSchemeID.toString())&&"Y"==e.IsScheme);i=e[0],S=parseInt(e[0].MaxSchemeID);for(let t=1;t<e.length;t++)this.ScreenObject.GridDataObj.removeRow(e[t])}else if(n.e.IsEmpty(t.Percentage)||!(parseFloat(t.Percentage)>0)||n.e.IsEmpty(t.IsQtyPercent)||2!=parseInt(t.IsQtyPercent)){i=this.ScreenObject.GridDataObj.NewRow();let t=this.ScreenObject.GridData.Compute("max","MaxSchemeID");null!=t&&(S=n.e.Int(t)),S++,i.IsScheme="Y",e.IsScheme="N",i.MaxSchemeID=S,e.MaxSchemeID=S,this.ScreenObject.GridDataObj.insertRowAt(i,this.ScreenObject.GridData.indexOf(e)+1),this.ScreenObject.UpdateSequence()}if(this.ScreenObject.Preferences.ContainsKey("schemecopydata")&&Object(o.j)(this.ScreenObject.Preferences.schemecopydata)&&this.Copyparentrow(i,e),!n.e.IsEmpty(t.Percentage)&&parseFloat(t.Percentage)>0&&!n.e.IsEmpty(t.IsQtyPercent)&&2==parseInt(t.IsQtyPercent)||(n.e.String(i.ProductID_Key)!=e.ProductID_Key.toString()&&(d=!0),i.ProductID_Key=e.ProductID_Key.toString(),this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(i.ProductCode=e.ProductCode.toString()),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(i.ProductName=e.ProductName.toString()),i.Type=n.e.String(e.Type)),!n.e.IsEmpty(t.Quantity)&&parseFloat(t.Quantity)>0){a=parseFloat(t.Quantity);let e=l/parseFloat(t.FromQty);i.FreeQTY=Math.floor(e)*a}else if(!n.e.IsEmpty(t.Value)&&parseFloat(t.Value)>0){a=parseFloat(t.Value);let e=l/parseFloat(t.FromQty);i[r]=Math.floor(e)*a*-1,i.FreeQTY=0}else if(!n.e.IsEmpty(t.Percentage)&&parseFloat(t.Percentage)>0)if(n.e.IsEmpty(t.IsQtyPercent)||2!=parseInt(t.IsQtyPercent))if(n.e.IsEmpty(t.IsQtyPercent)||1!=parseInt(t.IsQtyPercent)){if(!n.e.IsEmpty(e[s])){a=parseFloat(t.Percentage);let e=l/parseFloat(t.FromQty);e=c/100*Math.floor(e),i[r]=e*a*-1,i.FreeQTY=0}}else{a=parseFloat(t.Percentage);let e=l/parseFloat(t.FromQty);e=l/100*Math.floor(e),i.FreeQTY=e*a,i[r]=0}else this.IsPOs?(a=l/parseFloat(t.FromQty),e[r]=Math.floor(a)*parseFloat(t.Percentage)):e[r]=t.Percentage.toString(),e.SchemeID="-1",this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:53734},"ProfileName"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55480},"FromDate"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55483},"ToDate"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55850},"FromQty"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55851},"ToQty"),u.forEach(t=>{t!=e&&(t[r]=0)});!n.e.IsEmpty(t.Percentage)&&parseFloat(t.Percentage)>0&&!n.e.IsEmpty(t.IsQtyPercent)&&2==parseInt(t.IsQtyPercent)||(this.FillDatarowNN(i,null,t,{LocalReference:79,LinkData:53734},"ProfileName"),this.FillDatarowNN(i,null,t,{LocalReference:79,LinkData:55480},"FromDate"),this.FillDatarowNN(i,null,t,{LocalReference:79,LinkData:55483},"ToDate"),this.FillDatarowNN(i,null,t,{LocalReference:79,LinkData:55850},"FromQty"),this.FillDatarowNN(i,null,t,{LocalReference:79,LinkData:55851},"ToQty"),i.SchemeID=t.SchemeID.toString(),d?this.FillProductValues(i):this.CalculateTotals(i,!1),!n.e.IsEmpty(i.FreeQTY)&&parseFloat(i.FreeQTY)>0&&(i.UOMConvertedQty=n.e.IsEmpty(i.UOMConversion)?i.FreeQTY.toString():parseFloat(i.FreeQTY)*parseFloat(i.UOMConversion)))}}}else if(parseFloat(t.FromValue)>0)if(parseFloat(t.ToValue)!=parseFloat(t.FromValue))if(!n.e.IsEmpty(t.freeProductID)&&parseInt(t.freeProductID)>0){let a=this.ScreenObject.GridData.Compute("max","MaxSchemeID");null!=a&&(S=n.e.Int(a)),S++;let l=null,h=this.DtTempSchemes.filter(e=>e.SchemeID==t.SchemeID),u=null;""!=D&&(u=this.ScreenObject.GridData.filter(e=>D.split(",").Contains(e.MaxSchemeID)&&"Y"==e.IsScheme));for(let m=0;m<h.length;m++){if(d=!1,""!=D&&null!=u&&u.length>m?(l=u[m],S=parseInt(D.split(",")[0])):(l=this.ScreenObject.GridDataObj.NewRow(),l.IsScheme="Y",e.IsScheme="N",l.MaxSchemeID=S,e.MaxSchemeID=S,this.ScreenObject.GridDataObj.insertRowAt(l,this.ScreenObject.GridData.indexOf(e)+1),this.ScreenObject.UpdateSequence()),this.ScreenObject.Preferences.ContainsKey("schemecopydata")&&Object(o.j)(this.ScreenObject.Preferences.schemecopydata)&&this.Copyparentrow(l,e),l.ProductID_Key.toString()!=h[m].freeProductID.toString()&&(d=!0),l.ProductID_Key=h[m].freeProductID.toString(),this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(l.ProductCode=h[m].ProductCode.toString()),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(l.ProductName=h[m].ProductName.toString()),n.e.IsEmpty(h[m].freeQuantity)||(l.FreeQTY=parseFloat(h[m].freeQuantity)),!n.e.IsEmpty(h[m].freeQuantity)&&parseFloat(h[m].freeQuantity)>0)l.FreeQTY=parseFloat(h[m].freeQuantity),l[r]=0;else if(!n.e.IsEmpty(t.freeValue)&&parseFloat(h[m].freeValue)>0)l[r]=-1*parseFloat(h[m].freeValue),l.FreeQTY=0;else if(!n.e.IsEmpty(h[m].freePercentage)&&parseFloat(h[m].freePercentage)>0&&!n.e.IsEmpty(e[s])){let e=c/100*parseFloat(h[m].freePercentage);l[r]=-1*e,l.FreeQTY=0}n.e.IsEmpty(h[m].ProductTypeID)||(l.Type=parseFloat(h[m].ProductTypeID)),i>5e4&&this.DtTempSchemesColumns.Contains("Dim1")&&!n.e.IsEmpty(h[m].Dim1)&&this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(i-5e4))&&(l["dcCCNID"+(i-5e4)]=h[m].Name.toString(),l["dcCCNID"+(i-5e4)+"_Key"]=h[m].Dim1.toString()),this.FillDatarowNN(l,null,t,{LocalReference:79,LinkData:53734},"ProfileName"),this.FillDatarowNN(l,null,t,{LocalReference:79,LinkData:55480},"FromDate"),this.FillDatarowNN(l,null,t,{LocalReference:79,LinkData:55483},"ToDate"),this.FillDatarowNN(l,null,t,{LocalReference:79,LinkData:55850},"FromValue"),this.FillDatarowNN(l,null,t,{LocalReference:79,LinkData:55851},"ToValue"),l.SchemeID=h[m].SchemeID.toString(),d?this.FillProductValues(l):this.CalculateTotals(l,!1)}if(null!=u)for(let e=h.length;e<u.length;e++)this.ScreenObject.GridDataObj.removeRow(u[e])}else{let i=null;if(""!=D&&this.ScreenObject.GridData.filter(e=>e.MaxSchemeID&&D.split(",").Contains(e.MaxSchemeID.toString())&&"Y"==e.IsScheme).length>0){let e=this.ScreenObject.GridData.filter(e=>e.MaxSchemeID&&D.split(",").Contains(e.MaxSchemeID.toString())&&"Y"==e.IsScheme);i=e[0],S=parseInt(e[0].MaxSchemeID);for(let t=1;t<e.length;t++)this.ScreenObject.GridDataObj.removeRow(e[t])}else if(n.e.IsEmpty(t.Percentage)||!(parseFloat(t.Percentage)>0)||n.e.IsEmpty(t.IsQtyPercent)||2!=parseInt(t.IsQtyPercent)){i=this.ScreenObject.GridDataObj.NewRow();let t=this.ScreenObject.GridData.Compute("max","MaxSchemeID");null!=t&&(S=n.e.Int(t)),S++,i.IsScheme="Y",e.IsScheme="N",i.MaxSchemeID=S,e.MaxSchemeID=S,this.ScreenObject.GridDataObj.insertRowAt(i,this.ScreenObject.GridData.indexOf(e)+1),this.ScreenObject.UpdateSequence()}if(this.ScreenObject.Preferences.ContainsKey("schemecopydata")&&Object(o.j)(this.ScreenObject.Preferences.schemecopydata)&&this.Copyparentrow(i,e),!n.e.IsEmpty(t.Percentage)&&parseFloat(t.Percentage)>0&&!n.e.IsEmpty(t.IsQtyPercent)&&2==parseInt(t.IsQtyPercent)||(n.e.String(i.ProductID_Key)!=e.ProductID_Key.toString()&&(d=!0),i.ProductID_Key=e.ProductID_Key.toString(),this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(i.ProductCode=e.ProductCode.toString()),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(i.ProductName=e.ProductName.toString()),n.e.IsEmpty(t.Quantity)||(i.FreeQTY=parseFloat(t.Quantity))),!n.e.IsEmpty(t.Quantity)&&parseFloat(t.Quantity)>0)i.FreeQTY=parseFloat(t.Quantity),i[r]=0;else if(!n.e.IsEmpty(t.Value)&&parseFloat(t.Value)>0)i[r]=-1*parseFloat(t.Value),i.FreeQTY=0;else if(!n.e.IsEmpty(t.Percentage)&&parseFloat(t.Percentage)>0)if(n.e.IsEmpty(t.IsQtyPercent)||2!=parseInt(t.IsQtyPercent)){if(!n.e.IsEmpty(e[s])){let e=c/100*parseFloat(t.Percentage);i[r]=-1*e,i.FreeQTY=0}}else e[r]=t.Percentage.toString(),e.SchemeID="-1",this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:53734},"ProfileName"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55480},"FromDate"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55483},"ToDate"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55850},"FromValue"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55851},"ToValue"),u.forEach(t=>{t!=e&&(t[r]=0)});!n.e.IsEmpty(t.Percentage)&&parseFloat(t.Percentage)>0&&!n.e.IsEmpty(t.IsQtyPercent)&&2==parseInt(t.IsQtyPercent)||(i.Type=n.e.String(e.Type),this.FillDatarowNN(i,null,t,{LocalReference:79,LinkData:53734},"ProfileName"),this.FillDatarowNN(i,null,t,{LocalReference:79,LinkData:55480},"FromDate"),this.FillDatarowNN(i,null,t,{LocalReference:79,LinkData:55483},"ToDate"),this.FillDatarowNN(i,null,t,{LocalReference:79,LinkData:55850},"FromValue"),this.FillDatarowNN(i,null,t,{LocalReference:79,LinkData:55851},"ToValue"),i.SchemeID=t.SchemeID.toString(),d?this.FillProductValues(i):this.CalculateTotals(i,!1))}else if(parseFloat(t.ToValue)==parseFloat(t.FromValue)){let a=0;if(!n.e.IsEmpty(t.freeProductID)&&parseInt(t.freeProductID)>0){let l=this.ScreenObject.GridData.Compute("max","MaxSchemeID");null!=l&&(S=n.e.Int(l)),S++;let h=null,u=this.DtTempSchemes.filter(e=>e.SchemeID==t.SchemeID),m=null;""!=D&&(m=this.ScreenObject.GridData.filter(e=>D.split(",").Contains(e.MaxSchemeID)&&"Y"==e.IsScheme));for(let b=0;b<u.length;b++){if(d=!1,""!=D&&null!=m&&m.length>b?(h=m[b],S=parseInt(D.split(",")[0])):(h=this.ScreenObject.GridDataObj.NewRow(),h.IsScheme="Y",e.IsScheme="N",h.MaxSchemeID=S,e.MaxSchemeID=S,this.ScreenObject.GridDataObj.insertRowAt(h,this.ScreenObject.GridData.indexOf(e)+1),this.ScreenObject.UpdateSequence()),this.ScreenObject.Preferences.ContainsKey("schemecopydata")&&Object(o.j)(this.ScreenObject.Preferences.schemecopydata)&&this.Copyparentrow(h,e),h.ProductID_Key.toString()!=u[b].freeProductID.toString()&&(d=!0),h.ProductID_Key=u[b].freeProductID.toString(),this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(h.ProductCode=u[b].ProductCode.toString()),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(h.ProductName=u[b].ProductName.toString()),n.e.IsEmpty(u[b].ProductTypeID)||(h.Type=parseFloat(u[b].ProductTypeID)),!n.e.IsEmpty(u[b].freeQuantity)&&parseFloat(u[b].freeQuantity)>0){a=parseFloat(u[b].freeQuantity);let e=c/parseFloat(u[b].FromValue);h.FreeQTY=Math.floor(e)*a,h[r]=0}else if(!n.e.IsEmpty(t.freeValue)&&parseFloat(u[b].freeValue)>0){a=parseFloat(u[b].freeValue);let e=c/parseFloat(u[b].FromValue);h[r]=Math.floor(e)*a*-1,h.FreeQTY=0}else if(!n.e.IsEmpty(u[b].freePercentage)&&parseFloat(u[b].freePercentage)>0&&!n.e.IsEmpty(e[s])){a=parseFloat(u[b].freePercentage);let e=c/parseFloat(u[b].FromValue);e=c/100*Math.floor(e),h[r]=e*a*-1,h.FreeQTY=0}i>5e4&&this.DtTempSchemesColumns.Contains("Dim1")&&!n.e.IsEmpty(u[b].Dim1)&&this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(i-5e4))&&(h["dcCCNID"+(i-5e4)]=u[b].Name.toString(),h["dcCCNID"+(i-5e4)+"_Key"]=u[b].Dim1.toString()),this.FillDatarowNN(h,null,t,{LocalReference:79,LinkData:53734},"ProfileName"),this.FillDatarowNN(h,null,t,{LocalReference:79,LinkData:55480},"FromDate"),this.FillDatarowNN(h,null,t,{LocalReference:79,LinkData:55483},"ToDate"),this.FillDatarowNN(h,null,t,{LocalReference:79,LinkData:55850},"FromValue"),this.FillDatarowNN(h,null,t,{LocalReference:79,LinkData:55851},"ToValue"),h.SchemeID=u[b].SchemeID.toString(),d?this.FillProductValues(h):this.CalculateTotals(h,!1)}if(null!=m)for(let e=u.length;e<m.length;e++)this.ScreenObject.GridDataObj.removeRow(m[e])}else{let i=null;if(""!=D&&this.ScreenObject.GridData.filter(t=>t.MaxSchemeID==e.MaxSchemeID&&"Y"==t.IsScheme).length>0){let e=this.ScreenObject.GridData.filter(e=>D.split(",").Contains(e.MaxSchemeID)&&"Y"==e.IsScheme);i=e[0],S=parseInt(e[0].MaxSchemeID);for(let t=1;t<e.length;t++)this.ScreenObject.GridDataObj.removeRow(e[t])}else if(n.e.IsEmpty(t.Percentage)||!(parseFloat(t.Percentage)>0)||n.e.IsEmpty(t.IsQtyPercent)||2!=parseInt(t.IsQtyPercent)){i=this.ScreenObject.GridDataObj.NewRow();let t=this.ScreenObject.GridData.Compute("max","MaxSchemeID");null!=t&&(S=n.e.Int(t)),S++,i.IsScheme="Y",e.IsScheme="N",i.MaxSchemeID=S,e.MaxSchemeID=S,this.ScreenObject.GridDataObj.insertRowAt(i,this.ScreenObject.GridData.indexOf(e)+1),this.ScreenObject.UpdateSequence()}if(this.ScreenObject.Preferences.ContainsKey("schemecopydata")&&Object(o.j)(this.ScreenObject.Preferences.schemecopydata)&&this.Copyparentrow(i,e),!n.e.IsEmpty(t.Percentage)&&parseFloat(t.Percentage)>0&&!n.e.IsEmpty(t.IsQtyPercent)&&2==parseInt(t.IsQtyPercent)||(n.e.String(i.ProductID_Key)!=e.ProductID_Key.toString()&&(d=!0),i.ProductID_Key=e.ProductID_Key.toString(),this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(i.ProductCode=e.ProductCode.toString()),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(i.ProductName=e.ProductName.toString()),i.Type=n.e.String(e.Type)),!n.e.IsEmpty(t.Quantity)&&parseFloat(t.Quantity)>0){a=parseFloat(t.Quantity);let e=c/parseFloat(t.FromValue);i.FreeQTY=Math.floor(e)*a}else if(!n.e.IsEmpty(t.Value)&&parseFloat(t.Value)>0){a=parseFloat(t.Value);let e=c/parseFloat(t.FromValue);i[r]=Math.floor(e)*a*-1,i.FreeQTY=0}else if(!n.e.IsEmpty(t.Percentage)&&parseFloat(t.Percentage)>0)if(n.e.IsEmpty(t.IsQtyPercent)||2!=parseInt(t.IsQtyPercent)){if(!n.e.IsEmpty(e[s])){a=parseFloat(t.Percentage);let e=c/parseFloat(t.FromValue);e=c/100*Math.floor(e),i[r]=e*a*-1,i.FreeQTY=0}}else this.IsPOs?(a=c/parseFloat(t.FromValue),e[r]=Math.floor(a)*parseFloat(t.Percentage)):e[r]=t.Percentage.toString(),e.SchemeID="-1",this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:53734},"ProfileName"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55480},"FromDate"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55483},"ToDate"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55850},"FromValue"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55851},"ToValue"),u.forEach(t=>{t!=e&&(t[r]=0)});!n.e.IsEmpty(t.Percentage)&&parseFloat(t.Percentage)>0&&!n.e.IsEmpty(t.IsQtyPercent)&&2==parseInt(t.IsQtyPercent)||(this.FillDatarowNN(i,null,t,{LocalReference:79,LinkData:53734},"ProfileName"),this.FillDatarowNN(i,null,t,{LocalReference:79,LinkData:55480},"FromDate"),this.FillDatarowNN(i,null,t,{LocalReference:79,LinkData:55483},"ToDate"),this.FillDatarowNN(i,null,t,{LocalReference:79,LinkData:55850},"FromValue"),this.FillDatarowNN(i,null,t,{LocalReference:79,LinkData:55851},"ToValue"),i.SchemeID=t.SchemeID.toString(),d?this.FillProductValues(i):this.CalculateTotals(i,!1))}}u.forEach(e=>{S>0&&(e.IsScheme="N",e.MaxSchemeID=S,e.SchemeID=t.SchemeID.toString()),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:53734},"ProfileName"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55480},"FromDate"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55483},"ToDate")})}AddLinkProducts(e,t){let s=t,i=0,r=this.ScreenObject.GridData.Compute("max","LinkID");null!=r&&(i=n.e.Int(r)),i++,this.ScreenObject.GridData[s-1].LinkID=i,this.ScreenObject.GridData[s-1].LinkType=0;let o=0;for(let a=0;a<e.length;a++)if(n.e.IsEmpty(e[a].LinkType)||2!=parseInt(e[a].LinkType))n.e.IsEmpty(e[a].LinkType)||1!=parseInt(e[a].LinkType)||o++;else{let t=this.ScreenObject.GridDataObj.NewRow();t.LinkID=i,t.ProductID_Key=e[a].ProductID.toString(),t.Quantity="1",this.ScreenObject.GridData.InsertAt(t,s),this.AddProductData(t,!0,!1),this.CalculateTotals(t,!1),t.LinkType=2,s++}o>0&&0==a.a.page.DialogCount&&a.a.page.ShowDialog(new qt(this,e,i,t),Jt.a,{ShowCenter:!0,HideClose:!0,Title:"Optinal Linked Products"}),this.ScreenObject.UpdateSequence()}FillDatarow(e,t,s,i,a,r=-1){let o;o=this.ScreenObject.Data.Tables[0].filter(i.LocalReference?e=>e.LocalReference==i.LocalReference&&e.LinkData==i.LinkData:e=>null!=e.LocalReference&&e.LinkData==i.LinkData),o.length>0&&this.ScreenObject.GridDataColumns.Contains(o[0].SysColumnName)&&(e[o[0].SysColumnName]=null==s||n.e.IsEmpty(s[a])||0==parseFloat(s[a])?t.length>0&&!n.e.IsEmpty(t[0][a])?t[0][a].toString():0:-1==r?s[a].toString():parseFloat(s[a])*r)}FillDatarowNN(e,t,s,i,r){let o;o=this.ScreenObject.Data.Tables[0].filter(i.LocalReference?e=>e.LocalReference==i.LocalReference&&e.LinkData==i.LinkData:e=>null!=e.LocalReference&&e.LinkData==i.LinkData),o.length>0&&this.ScreenObject.GridDataColumns.Contains(o[0].SysColumnName)&&("DATE"!=o[0].ColumnDataType.toString().toUpperCase()&&"DATE"!=o[0].UserColumnType.toString().toUpperCase()||!this.ScreenObject.GridDataColumns.Contains(o[0].SysColumnName+"_Key")?e[o[0].SysColumnName]=null==s||n.e.IsEmpty(s[r])?null==t||n.e.IsEmpty(t[0][r])?null:t[0][r].toString():s[r].toString():null!=s&&n.e.isValidDate(s[r])?(e[o[0].SysColumnName+"_Key"]=new Date(s[r]),e[o[0].SysColumnName]=new Date(s[r]).ToString(a.a.SessionManager.Preferences["Date Format"])):null!=t&&!n.e.IsEmpty(t[0][r])&&n.e.isValidDate(t[0][r])?(e[o[0].SysColumnName+"_Key"]=new Date(t[0][r]),e[o[0].SysColumnName]=new Date(t[0][r]).ToString(a.a.SessionManager.Preferences["Date Format"])):(e[o[0].SysColumnName]=null,e[o[0].SysColumnName+"_Key"]=null))}FillCreatedByDate(e){if(0==this.ScreenObject.Data.Tables.length)return;if(this.ScreenObject.IsDocEdit&&"Revise"==e){let e=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&55488==e.LinkData);if(!(e.length>0))return;if(this.ScreenObject.GridDataColumns.Contains(e[0].SysColumnName))for(let t=0;t<this.ScreenObject.GridData.length;t++)(this.IsInventoryVoucher&&!n.e.IsEmpty(this.ScreenObject.GridData[t].ProductID_Key)||!this.IsInventoryVoucher&&(this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[t].AccountID_Key)||this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[t].DebitAccount_Key)||this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[t].CreditAccount_Key)))&&("Date"==e[0].UserColumnType.toString()?(this.ScreenObject.GridData[t][e[0].SysColumnName]=(new Date).ToString(a.a.SessionManager.Preferences["Date Format"]),this.ScreenObject.GridData[t][e[0].SysColumnName+"_Key"]=new Date):"DateTime"==e[0].UserColumnType.toString()?(this.ScreenObject.GridData[t][e[0].SysColumnName]=(new Date).ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm a"),this.ScreenObject.GridData[t][e[0].SysColumnName+"_Key"]=new Date):"Time"==e[0].UserColumnType.toString()?(this.ScreenObject.GridData[t][e[0].SysColumnName]=(new Date).ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss tt"),this.ScreenObject.GridData[t][e[0].SysColumnName+"_Key"]=new Date):this.ScreenObject.GridData[t][e[0].SysColumnName]=(new Date).ToString(a.a.SessionManager.Preferences["Date Format"]));else{let t=this.ScreenObject._TextFields.find(t=>t.DBColumnName==e[0].SysColumnName);t&&(t instanceof u.d?t.Text=(new Date).ToString(a.a.SessionManager.Preferences["Date Format"]):t instanceof d.c&&(t.Date=new Date),t instanceof d.b&&(t.Date=new Date))}}let t=this.ScreenObject.Data.Tables[0];if(t.length>0)if(this.ScreenObject.IsDocEdit){if(t=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&49983==e.LinkData),t.length>0){if(this.ScreenObject.GridDataColumns.Contains(t[0].SysColumnName))for(let s=0;s<this.ScreenObject.GridData.length;s++)(this.IsInventoryVoucher&&!n.e.IsEmpty(this.ScreenObject.GridData[s].ProductID_Key)||!this.IsInventoryVoucher&&(this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].AccountID_Key)||this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].DebitAccount_Key)||this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].CreditAccount_Key)))&&(this.ScreenObject.GridData[s][t[0].SysColumnName]=a.a.SessionManager.UserName);let e=this.ScreenObject._TextFields.find(e=>e.DBColumnName==t[0].SysColumnName);e&&e instanceof u.d&&(e.Text=a.a.SessionManager.UserName)}if(t=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&49984==e.LinkData),t.length>0){let e=a.a.common.GetDataSet("DOC001","");if(null!=e&&e.Tables.length>0&&!e.Columns[0].Contains("ErrorMessage")&&e.Tables[0].length>0&&!n.e.IsEmpty(e.Tables[0][0].dt)){if(this.ScreenObject.GridDataColumns.Contains(t[0].SysColumnName))for(let i=0;i<this.ScreenObject.GridData.length;i++)if(this.IsInventoryVoucher&&!n.e.IsEmpty(this.ScreenObject.GridData[i].ProductID_Key))this.ScreenObject.GridData[i][t[0].SysColumnName]=a.a.SessionManager.UserName;else if(!this.IsInventoryVoucher&&(this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[i].AccountID_Key)||this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[i].DebitAccount_Key)||this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[i].CreditAccount_Key))){let s=e.Columns[0][0];"Date"==t[0].UserColumnType.toString()?(this.ScreenObject.GridData[i][t[0].SysColumnName]=new Date(e.Tables[0][0][s]).ToString(a.a.SessionManager.Preferences["Date Format"]),this.ScreenObject.GridData[i][t[0].SysColumnName+"_Key"]=new Date(e.Tables[0][0][s])):"DateTime"==t[0].UserColumnType.toString()?(this.ScreenObject.GridData[i][t[0].SysColumnName]=new Date(e.Tables[0][0][s]).ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm a"),this.ScreenObject.GridData[i][t[0].SysColumnName+"_Key"]=new Date(e.Tables[0][0][s])):"Time"==t[0].UserColumnType.toString()?(this.ScreenObject.GridData[i][t[0].SysColumnName]=new Date(e.Tables[0][0][s]).ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss tt"),this.ScreenObject.GridData[i][t[0].SysColumnName+"_Key"]=new Date(e.Tables[0][0][s])):this.ScreenObject.GridData[i][t[0].SysColumnName]=new Date(e.Tables[0][0][s]).ToString(a.a.SessionManager.Preferences["Date Format"])}let s=this.ScreenObject._TextFields.find(e=>e.DBColumnName==t[0].SysColumnName);if(s){let t=e.Columns[0][0];s instanceof u.d?s.Text=new Date(e.Tables[0][0][t]).ToString(a.a.SessionManager.Preferences["Date Format"]):s instanceof d.c&&(s.Date=new Date(e.Tables[0][0][t])),s instanceof d.b&&(s.Date=new Date(e.Tables[0][0][t]))}}}if(t=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalCCID&&-7==e.LocalCCID),t.length>0)for(let e=0;e<t.length;e++){if(this.ScreenObject.GridDataColumns.Contains(t[e].SysColumnName))for(let i=0;i<this.ScreenObject.GridData.length;i++)this.IsInventoryVoucher&&!n.e.IsEmpty(this.ScreenObject.GridData[i].ProductID_Key)?this.ScreenObject.Data.Tables.length>22&&null!=this.ScreenObject.Data.Tables[23]&&this.ScreenObject.Data.Tables[23].length>0&&("22898"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].UserName.toString():"22900"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].FirstName.toString():"22901"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].MiddleName.toString():"22902"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].LastName.toString():"22903"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Address1.toString():"22904"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Address2.toString():"22905"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Address3.toString():"22906"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].City.toString():"22907"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].State.toString():"22908"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Zip.toString():"22909"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Country.toString():"22910"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Phone1.toString():"22911"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Phone2.toString():"22912"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Fax.toString():"22913"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Email1.toString():"22914"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Email2.toString():"22915"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Website.toString():"22916"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Description.toString():"22917"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Role.toString():"53531"==t[e].LinkData.toString()&&(this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Status.toString())):!this.IsInventoryVoucher&&(this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[i].AccountID_Key)||this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[i].DebitAccount_Key)||this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[i].CreditAccount_Key))&&this.ScreenObject.Data.Tables.length>22&&null!=this.ScreenObject.Data.Tables[23]&&this.ScreenObject.Data.Tables[23].length>0&&("22898"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].UserName.toString():"22900"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].FirstName.toString():"22901"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].MiddleName.toString():"22902"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].LastName.toString():"22903"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Address1.toString():"22904"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Address2.toString():"22905"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Address3.toString():"22906"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].City.toString():"22907"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].State.toString():"22908"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Zip.toString():"22909"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Country.toString():"22910"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Phone1.toString():"22911"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Phone2.toString():"22912"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Fax.toString():"22913"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Email1.toString():"22914"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Email2.toString():"22915"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Website.toString():"22916"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Description.toString():"22917"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Role.toString():"53531"==t[e].LinkData.toString()&&(this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Status.toString()));let s=this.ScreenObject._TextFields.find(s=>s.DBColumnName==t[e].SysColumnName);s&&s instanceof u.d&&this.ScreenObject.Data.Tables.length>22&&null!=this.ScreenObject.Data.Tables[23]&&this.ScreenObject.Data.Tables[23].length>0&&("22898"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].UserName.toString():"22900"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].FirstName.toString():"22901"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].MiddleName.toString():"22902"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].LastName.toString():"22903"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].Address1.toString():"22904"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].Address2.toString():"22905"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].Address3.toString():"22906"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].City.toString():"22907"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].State.toString():"22908"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].Zip.toString():"22909"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].Country.toString():"22910"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].Phone1.toString():"22911"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].Phone2.toString():"22912"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].Fax.toString():"22913"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].Email1.toString():"22914"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].Email2.toString():"22915"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].Website.toString():"22916"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].Description.toString():"22917"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].Role.toString():"53531"==t[e].LinkData.toString()&&(s.Text=this.ScreenObject.Data.Tables[23][0].Status.toString()))}}else{if(t=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&24060==e.LinkData),t.length>0){if(this.ScreenObject.GridDataColumns.Contains(t[0].SysColumnName))for(let s=0;s<this.ScreenObject.GridData.length;s++)(this.IsInventoryVoucher&&!n.e.IsEmpty(this.ScreenObject.GridData[s].ProductID_Key)||!this.IsInventoryVoucher&&(this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].AccountID_Key)||this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].DebitAccount_Key)||this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].CreditAccount_Key)))&&(this.ScreenObject.GridData[s][t[0].SysColumnName]=a.a.SessionManager.UserName);let e=this.ScreenObject._TextFields.find(e=>e.DBColumnName==t[0].SysColumnName);e&&e instanceof u.d&&(e.Text=a.a.SessionManager.UserName)}if(t=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&24061==e.LinkData),t.length>0){let e=a.a.common.GetDataSet("DOC001","");if(null!=e&&e.Tables.length>0&&!e.Columns[0].Contains("ErrorMessage")&&e.Tables[0].length>0&&!n.e.IsEmpty(e.Tables[0][0].dt)){if(this.ScreenObject.GridDataColumns.Contains(t[0].SysColumnName))for(let i=0;i<this.ScreenObject.GridData.length;i++)if(this.IsInventoryVoucher&&!n.e.IsEmpty(this.ScreenObject.GridData[i].ProductID_Key))this.ScreenObject.GridData[i][t[0].SysColumnName]=a.a.SessionManager.UserName;else if(!this.IsInventoryVoucher&&(this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[i].AccountID_Key)||this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[i].DebitAccount_Key)||this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[i].CreditAccount_Key))){let s=e.Columns[0][0];"Date"==t[0].UserColumnType.toString()?(this.ScreenObject.GridData[i][t[0].SysColumnName]=new Date(e.Tables[0][0][s]).ToString(a.a.SessionManager.Preferences["Date Format"]),this.ScreenObject.GridData[i][t[0].SysColumnName+"_Key"]=new Date(e.Tables[0][0][s])):"DateTime"==t[0].UserColumnType.toString()?(this.ScreenObject.GridData[i][t[0].SysColumnName]=new Date(e.Tables[0][0][s]).ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm a"),this.ScreenObject.GridData[i][t[0].SysColumnName+"_Key"]=new Date(e.Tables[0][0][s])):"Time"==t[0].UserColumnType.toString()?(this.ScreenObject.GridData[i][t[0].SysColumnName]=new Date(e.Tables[0][0][s]).ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss tt"),this.ScreenObject.GridData[i][t[0].SysColumnName+"_Key"]=new Date(e.Tables[0][0][s])):this.ScreenObject.GridData[i][t[0].SysColumnName]=new Date(e.Tables[0][0][s]).ToString(a.a.SessionManager.Preferences["Date Format"])}let s=this.ScreenObject._TextFields.find(e=>e.DBColumnName==t[0].SysColumnName);if(s){let t=e.Columns[0][0];s instanceof u.d?s.Text=new Date(e.Tables[0][0][t]).ToString(a.a.SessionManager.Preferences["Date Format"]):s instanceof d.c&&(s.Date=new Date(e.Tables[0][0][t])),s instanceof d.b&&(s.Date=new Date(e.Tables[0][0][t]))}}}if(t=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalCCID&&7==e.LocalCCID),t.length>0)for(let e=0;e<t.length;e++){if(this.ScreenObject.GridDataColumns.Contains(t[e].SysColumnName))for(let i=0;i<this.ScreenObject.GridData.length;i++)this.IsInventoryVoucher&&!n.e.IsEmpty(this.ScreenObject.GridData[i].ProductID_Key)?this.ScreenObject.Data.Tables.length>22&&null!=this.ScreenObject.Data.Tables[23]&&this.ScreenObject.Data.Tables[23].length>0&&("22898"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].UserName.toString():"22900"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].FirstName.toString():"22901"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].MiddleName.toString():"22902"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].LastName.toString():"22903"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Address1.toString():"22904"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Address2.toString():"22905"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Address3.toString():"22906"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].City.toString():"22907"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].State.toString():"22908"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Zip.toString():"22909"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Country.toString():"22910"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Phone1.toString():"22911"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Phone2.toString():"22912"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Fax.toString():"22913"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Email1.toString():"22914"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Email2.toString():"22915"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Website.toString():"22916"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Description.toString():"22917"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Role.toString():"53531"==t[e].LinkData.toString()&&(this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Status.toString())):!this.IsInventoryVoucher&&(this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[i].AccountID_Key)||this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[i].DebitAccount_Key)||this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[i].CreditAccount_Key))&&this.ScreenObject.Data.Tables.length>22&&null!=this.ScreenObject.Data.Tables[23]&&this.ScreenObject.Data.Tables[23].length>0&&("22898"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].UserName.toString():"22900"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].FirstName.toString():"22901"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].MiddleName.toString():"22902"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].LastName.toString():"22903"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Address1.toString():"22904"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Address2.toString():"22905"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Address3.toString():"22906"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].City.toString():"22907"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].State.toString():"22908"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Zip.toString():"22909"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Country.toString():"22910"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Phone1.toString():"22911"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Phone2.toString():"22912"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Fax.toString():"22913"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Email1.toString():"22914"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Email2.toString():"22915"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Website.toString():"22916"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Description.toString():"22917"==t[e].LinkData.toString()?this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Role.toString():"53531"==t[e].LinkData.toString()&&(this.ScreenObject.GridData[i][t[e].SysColumnName]=this.ScreenObject.Data.Tables[23][0].Status.toString()));let s=this.ScreenObject._TextFields.find(s=>s.DBColumnName==t[e].SysColumnName);s&&s instanceof u.d&&this.ScreenObject.Data.Tables.length>22&&null!=this.ScreenObject.Data.Tables[23]&&this.ScreenObject.Data.Tables[23].length>0&&("22898"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].UserName.toString():"22900"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].FirstName.toString():"22901"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].MiddleName.toString():"22902"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].LastName.toString():"22903"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].Address1.toString():"22904"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].Address2.toString():"22905"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].Address3.toString():"22906"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].City.toString():"22907"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].State.toString():"22908"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].Zip.toString():"22909"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].Country.toString():"22910"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].Phone1.toString():"22911"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].Phone2.toString():"22912"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].Fax.toString():"22913"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].Email1.toString():"22914"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].Email2.toString():"22915"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].Website.toString():"22916"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].Description.toString():"22917"==t[e].LinkData.toString()?s.Text=this.ScreenObject.Data.Tables[23][0].Role.toString():"53531"==t[e].LinkData.toString()&&(s.Text=this.ScreenObject.Data.Tables[23][0].Status.toString()))}}}FillLinkRefereceProducts(e,t,s,i=""){n.e.IsEmpty(e.ProductID_Key)||parseInt(e.ProductID_Key)==this.ScreenObject.TempProductID||(""!=i&&"23819"!=i||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:23819},"AvgRate"),""!=i&&"25398"!=i||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:25398},"QOH"),""!=i&&"52638"!=i||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:52638},"QOH"),""!=i&&"49"!=i||this.FillDatarow(e,t,null,{LinkData:49},"Loc_QOH"),""!=i&&"50"!=i||this.FillDatarow(e,t,null,{LinkData:50},"Div_QOH"),""!=i&&"52637"!=i||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:52637},"BalQOH"),""!=i&&"26421"!=i||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:26421},"HOLDQTY"),""!=i&&"50454"!=i||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:50454},"CommittedQty"),""!=i&&"26422"!=i||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:26422},"RESERVEQTY"),""!=i&&"499943"!=i||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:499943},"TotalReserve")),""!=i&&"23820"!=i||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:23820},"LastPurchaseRate"),""!=i&&"55479"!=i||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:55479},"LPRStockNonStock"),""!=i&&"24062"!=i||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:24062},"PWLastPRate"),""!=i&&"50051"!=i||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:50051},"LastPCost"),""!=i&&"23821"!=i||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:23821},"PWLastPCost"),""!=i&&"50494"!=i||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:50494},"UnitProductCode"),""!=i&&"50493"!=i||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:50493},"VendorProductCode"),""!=i&&"53736"!=i||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:53736},"VendorQty"),""!=i&&"55490"!=i||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:55490},"AvgPrice"),""!=i&&"55491"!=i||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:55491},"dp"),""!=i&&"55492"!=i||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:55492},"rp"),this.FillSalesPurchase(e,t,s,-1,i),""!=i&&"277"!=i||this.FillDatarow(e,t,s,{LinkData:277},"ReorderQty"),""!=i&&"276"!=i||this.FillDatarow(e,t,s,{LinkData:276},"ReorderLevel")}FillSalesPurchase(e,t,s,i=-1,a=""){""!=a&&"22821"!=a||this.FillDatarow(e,t,s,{LinkData:22821},"SellingRate",i),""!=a&&"22793"!=a||this.FillDatarow(e,t,s,{LinkData:22793},"SellingRateA",i),""!=a&&"22794"!=a||this.FillDatarow(e,t,s,{LinkData:22794},"SellingRateB",i),""!=a&&"22795"!=a||this.FillDatarow(e,t,s,{LinkData:22795},"SellingRateC",i),""!=a&&"22796"!=a||this.FillDatarow(e,t,s,{LinkData:22796},"SellingRateD",i),""!=a&&"22797"!=a||this.FillDatarow(e,t,s,{LinkData:22797},"SellingRateE",i),""!=a&&"22798"!=a||this.FillDatarow(e,t,s,{LinkData:22798},"SellingRateF",i),""!=a&&"22799"!=a||this.FillDatarow(e,t,s,{LinkData:22799},"SellingRateG",i),""!=a&&"22820"!=a||this.FillDatarow(e,t,s,{LinkData:22820},"PurchaseRate",i),""!=a&&"22786"!=a||this.FillDatarow(e,t,s,{LinkData:22786},"PurchaseRateA",i),""!=a&&"22787"!=a||this.FillDatarow(e,t,s,{LinkData:22787},"PurchaseRateB",i),""!=a&&"22788"!=a||this.FillDatarow(e,t,s,{LinkData:22788},"PurchaseRateC",i),""!=a&&"22789"!=a||this.FillDatarow(e,t,s,{LinkData:22789},"PurchaseRateD",i),""!=a&&"22790"!=a||this.FillDatarow(e,t,s,{LinkData:22790},"PurchaseRateE",i),""!=a&&"22791"!=a||this.FillDatarow(e,t,s,{LinkData:22791},"PurchaseRateF",i),""!=a&&"22792"!=a||this.FillDatarow(e,t,s,{LinkData:22792},"PurchaseRateG",i)}FillRates(e,t){let s=null;if(e.Tables.length>3&&e.Tables[3].length>0){s=e.Tables[3][0];let i=this.ScreenObject.ColumnSource.find(e=>"Rate"==e.DisplayMember);n.e.IsEmpty(i.Formula)||!e.Columns[3].Contains(i.Formula)||n.e.IsEmpty(e.Tables[3][0][i.Formula])?1==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||10==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||31==this.ScreenObject.DocumentType?n.e.IsEmpty(e.Tables[3][0].PurchaseRate)||(t.Rate=e.Tables[3][0].PurchaseRate.toString(),t.defaultRate=e.Tables[3][0].PurchaseRate.toString()):n.e.IsEmpty(e.Tables[3][0].SellingRate)||(t.Rate=e.Tables[3][0].SellingRate.toString(),t.defaultRate=e.Tables[3][0].SellingRate.toString()):(t.Rate=e.Tables[3][0][i.Formula].toString(),t.defaultRate=e.Tables[3][0][i.Formula].toString())}if(this.FillLinkRefereceProducts(t,e.Tables[0],s),e.Tables.length>0&&e.Tables[0].length>0&&(t.UOMConversion=e.Tables[0][0].Conversion.toString(),n.e.IsEmpty(t.Quantity)||n.e.IsEmpty(e.Tables[0][0].Conversion)||!n.e.IsNum(e.Tables[0][0].Conversion)?n.e.IsEmpty(t.Quantity)||(t.UOMConvertedQty=t.Quantity.toString()):t.UOMConvertedQty=n.e.Double(e.Tables[0][0].Conversion)*parseFloat(t.Quantity)),e.Tables.length>10&&e.Columns[10].Contains("BinId")&&e.Tables[10].length>0&&e.Tables[10][0].BinId&&"0"!=e.Tables[10][0].BinId.toString()&&this.ScreenObject.Preferences.ContainsKey("BinsDimension")&&parseInt(this.ScreenObject.Preferences.BinsDimension)>5e4){let s=this.ScreenObject.ColumnSource.find(e=>e.CostCenterID==parseInt(this.ScreenObject.Preferences.BinsDimension));s&&this.ScreenObject.GridDataColumns.Contains(s.DisplayMember)&&(t[s.DisplayMember]=e.Tables[10][0].BinName.toString(),t[s.ValueMember]=e.Tables[10][0].BinId.toString())}}OnProductUnitChange(e){if(n.e.IsNum(e.Unit_Key)&&parseInt(e.Unit_Key)>0&&e.Unit_Key.toString()!=this.PrevValue){let t=this.ScreenObject.GetPriceofUnit(e.ProductID_Key.toString(),this.DocumentDate,parseInt(e.Unit_Key),e),s=0,i=0;if(t.Tables.length>0&&t.Tables[0].length>0){n.e.IsEmpty(t.Tables[0][0].Conversion)||(s=parseFloat(t.Tables[0][0].Conversion)),e.UOMConversion=s,n.e.IsEmpty(e.Quantity)||n.e.IsEmpty(t.Tables[0][0].Conversion)||!n.e.IsNum(t.Tables[0][0].Conversion)?n.e.IsEmpty(e.Quantity)||(e.UOMConvertedQty=e.Quantity.toString()):e.UOMConvertedQty=n.e.Double(t.Tables[0][0].Conversion)*parseFloat(e.Quantity);let i=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&50494==e.LinkData);if(i.length>0&&this.ScreenObject.GridDataColumns.Contains(i[0].SysColumnName)&&(n.e.IsEmpty(t.Columns[0].Contains("Barcode")&&t.Tables[0][0].Barcode)||(e[i[0].SysColumnName]=t.Tables[0][0].Barcode.toString())),t.Columns[0].Contains("Barcode_Key")&&!n.e.IsEmpty(t.Tables[0][0].Barcode_Key)&&this.ScreenObject.Preferences.ContainsKey("BarcodeDimension")&&""!=this.ScreenObject.Preferences.BarcodeDimension&&parseInt(this.ScreenObject.Preferences.BarcodeDimension)>0){let s=this.ScreenObject.ColumnSource.find(e=>e.CostCenterID==parseInt(this.ScreenObject.Preferences.BarcodeDimension));s&&(e[s.ValueMember]=t.Tables[0][0].Barcode_Key.toString(),e[s.DisplayMember]=t.Tables[0][0].Barcode.toString(),this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&e.LocalReference==s.ID).length>0&&this.ScreenObject.GetLinkReferenceData(parseInt(s.ID),this.DocumentID,parseInt(e[s.ValueMember]),Date.Today(),"",s.CostCenterID,e))}}if(t.Tables.length>1&&t.Tables[1].length>0&&t.Columns[1].Contains("PurchaseRate")){let a=this.ScreenObject.ColumnSource.find(e=>"Rate"==e.DisplayMember);n.e.IsEmpty(a.Formula)||!t.Columns[1].Contains(a.Formula)||n.e.IsEmpty(t.Tables[1][0][a.Formula])?1==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||10==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||31==this.ScreenObject.DocumentType?n.e.IsEmpty(t.Tables[1][0].PurchaseRate)||(i=t.Columns[1].Contains("UOMID")?s*parseFloat(t.Tables[1][0].PurchaseRate):parseFloat(t.Tables[1][0].PurchaseRate),e.Rate=i.ToString("N"+a.DecimalPoints),e.defaultRate=i.ToString("N"+a.DecimalPoints)):n.e.IsEmpty(t.Tables[1][0].SellingRate)||(i=t.Columns[1].Contains("UOMID")?s*parseFloat(t.Tables[1][0].SellingRate):parseFloat(t.Tables[1][0].SellingRate),e.Rate=i.ToString("N"+a.DecimalPoints),e.defaultRate=i.ToString("N"+a.DecimalPoints)):(i=t.Columns[1].Contains("UOMID")?s*parseFloat(t.Tables[1][0][a.Formula]):parseFloat(t.Tables[1][0][a.Formula]),e.Rate=i.ToString("N"+a.DecimalPoints),e.defaultRate=i.ToString("N"+a.DecimalPoints))}this.FillSalesPurchase(e,t.Tables[1],t.Tables[1][0],s)}}ValidateDataonSave_xml(e,t){try{for(let e=0;e<this.ScreenObject._TextFields.length;e++){let t=this.ScreenObject._TextFields[e];this.fldDict.ContainsKey(t.Lbl)&&(t instanceof u.d?"FLOAT"==t.DataType?null!=t.Text&&""!=t.Text&&""==t.ValidateData()?this.fldDict[t.Lbl].setFieldValue(t.Text):this.fldDict[t.Lbl].setFieldValue(0):this.fldDict[t.Lbl].setFieldValue(t.Text):t instanceof D.e?this.fldDict[t.Lbl].setFieldValue(t.SelectedValue):t instanceof g.a?this.fldDict[t.Lbl].setFieldValue(t.Text):t instanceof m.b&&(t.SelectedValue>0&&!n.e.IsEmpty(t.Text)?this.fldDict[t.Lbl].setFieldValue(t.Text):this.fldDict[t.Lbl].setFieldValue("")))}for(let s=0;s<this.ScreenObject.ColumnSource.length;s++){let i=this.ScreenObject.ColumnSource[s];if(null!=i.Expression&&""!=i.Expression){let s=e.SelectNodes("xml/Row/xml"),r=0;for(let e=0;e<s.length;e++){let l=s[e];r++;let c=this.ScreenObject.ColumnSource,h=1;if(a.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(o.j)(a.a.SessionManager.Preferences["Use Foreign Currency"])&&null!=this.Currency&&null!=this.Currency.ExchangeRate.Text&&""!=this.Currency.ExchangeRate.Text&&(h=parseFloat(this.Currency.ExchangeRate.Text)),this.fldDict.forEach(e=>{let t=c.filter(t=>t.lbl==this.fldDict[e.Key].getFieldName());t.length>0&&"ComboBox"!=t[0].DataType&&"PactComboBox"!=t[0].DataType&&l.attributes[t[0].DisplayMember]&&!n.e.IsEmpty(l.attributes[t[0].DisplayMember].value)?n.e.IsNum(l.attributes[t[0].DisplayMember].value)?this.fldDict[e.Key].setFieldValue(null!=t[0].DecimalPoints&&""!=t[0].DecimalPoints?parseFloat(l.attributes[t[0].DisplayMember].value).ToString("N"+t[0].DecimalPoints):l.attributes[t[0].DisplayMember].value):this.fldDict[e.Key].setFieldValue(l.attributes[t[0].DisplayMember].value):e.Key.toLowerCase().startsWith("calc")?(t=c.filter(t=>t.lbl==this.fldDict[e.Key.substr(4)].getFieldName()),t.length>0&&"ComboBox"!=t[0].DataType&&"PactComboBox"!=t[0].DataType&&null!=l.attributes["dcCalc"+t[0].DisplayMember.replace("dc","")]&&""!=l.attributes["dcCalc"+t[0].DisplayMember.replace("dc","")].value&&(n.e.IsNum(l.attributes["dcCalc"+t[0].DisplayMember.replace("dc","")].value)?this.fldDict[e.Key].setFieldValue(null!=t[0].DecimalPoints&&""!=t[0].DecimalPoints?parseFloat(l.attributes["dcCalc"+t[0].DisplayMember.replace("dc","")].value).ToString("N"+t[0].DecimalPoints):l.attributes["dcCalc"+t[0].DisplayMember.replace("dc","")].value):this.fldDict[e.Key].setFieldValue(l.attributes["dcCalc"+t[0].DisplayMember.replace("dc","")].value))):this.fldDict[e.Key].setFieldValue(0)}),this.IsInventoryVoucher&&(this.fldDict.RATE.setFieldValue(null!=l.attributes.Rate&&""!=l.attributes.Rate.value?l.attributes.Rate.value:0),this.fldDict.QTY.setFieldValue(null!=l.attributes.Quantity&&""!=l.attributes.Quantity.value?l.attributes.Quantity.value:0),this.fldDict.GROSS.setFieldValue(null!=l.attributes.Gross&&""!=l.attributes.Gross.value?l.attributes.Gross.value:0),this.fldDict.CONVQTY.setFieldValue(null!=l.attributes.UOMConvertedQty&&""!=l.attributes.UOMConvertedQty.value?l.attributes.UOMConvertedQty.value:0),this.fldDict.UOMCONVERSION.setFieldValue(null!=l.attributes.UOMConversion&&""!=l.attributes.UOMConversion.value?l.attributes.UOMConversion.value:0),this.fldDict.AVGRT.setFieldValue(null!=l.attributes.AVGRATE&&""!=l.attributes.AVGRATE.value?l.attributes.AVGRATE.value:0),this.fldDict.QOH.setFieldValue(null!=l.attributes.QOH&&""!=l.attributes.QOH.value?l.attributes.QOH.value:0),this.fldDict.BalQOH.setFieldValue(null!=l.attributes.BalQOH&&""!=l.attributes.BalQOH.value?l.attributes.BalQOH.value:0),this.fldDict.HOLDQTY.setFieldValue(null!=l.attributes.HOLDQTY&&""!=l.attributes.HOLDQTY.value?l.attributes.HOLDQTY.value:0),this.fldDict.CommittedQty.setFieldValue(null!=l.attributes.CommittedQty&&""!=l.attributes.CommittedQty.value?l.attributes.CommittedQty.value:0),this.fldDict.RESERVEQTY.setFieldValue(null!=l.attributes.RESERVEQTY&&""!=l.attributes.RESERVEQTY.value?l.attributes.RESERVEQTY.value:0),this.fldDict.TotalReserve.setFieldValue(null!=l.attributes.TotalReserve&&""!=l.attributes.TotalReserve.value?l.attributes.TotalReserve.value:0)),this.fldDict.EXCHRT.setFieldValue(h),"1"==a.a.eval.EvaluateExpression(i.Expression,this.fldDict).toString().toString()&&(1==i.Action||3==i.Action||4==i.Action)){let e=i.Message;if(e=i.Message.replace("[ROWNO]",null!=l.attributes.DocSeqNo&&""!=l.attributes.DocSeqNo.value?l.attributes.DocSeqNo.value:r.toString()),e=e.replace("[ProductCode]",null!=l.attributes.ProductCode&&""!=l.attributes.ProductCode.value?l.attributes.ProductCode.value:""),e+=" For Dynamic set at Row No:"+this.ScreenObject.GridData[t].DocSeqNo.toString(),alert(e),3==i.Action||4==i.Action)return!1}}}}}catch(s){if("Cannot set Visibility or call Show, ShowDialog, or WindowInteropHelper.EnsureHandle after a Window has closed."==s)return!1}return!0}ValidateDataonSave(){try{let e=this.GetColName();for(let t=0;t<this.ScreenObject.ColumnSource.length;t++)if(!(this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase().Contains("exchangerate")||"AppRemarks"==this.ScreenObject.ColumnSource[t].DisplayMember||"FreeQTY"==this.ScreenObject.ColumnSource[t].DisplayMember||this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase().Contains("currencyid")||this.ScreenObject.ColumnSource[t].CostCenterID>0&&"ProductCode"!=this.ScreenObject.ColumnSource[t].DisplayMember&&this.ScreenObject.ColumnSource[t].DisplayMember.endsWith("Code")||n.e.IsEmpty(this.ScreenObject.ColumnSource[t].Expression)||5!=this.ScreenObject.ColumnSource[t].Action)){let s="",i="";for(let r=0;r<this.ScreenObject.GridData.length;r++)n.e.IsEmpty(this.ScreenObject.GridData[r][e])||(this.FillDictionary(this.ScreenObject.GridData[r],!1),"1"==a.a.eval.EvaluateExpression(this.ScreenObject.ColumnSource[t].Expression,this.fldDict).toString().toString()&&(s+=this.ScreenObject.GridData[r].DocSeqNo.toString()+",",this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(i+=this.ScreenObject.GridData[r].ProductCode.toString())));if(s.length>1){let e=this.ScreenObject.ColumnSource[t].Message.replace("[ROWNO]",s.substr(0,s.length-1));if(e=e.replace("[ProductCode]",i),!confirm(e))return!1}}}catch(e){if(alert("SaveError"),"Cannot set Visibility or call Show, ShowDialog, or WindowInteropHelper.EnsureHandle after a Window has closed."==e.message)return!1}return!0}ValidateDataonSave_col_dr(e,t){try{if(null!=e.Expression&&""!=e.Expression){if(this.FillDictionary(t,!1),"1"==a.a.eval.EvaluateExpression(e.Expression,this.fldDict).toString().toString()&&(1==e.Action||3==e.Action||4==e.Action)){let s=e.Message.replace("[ROWNO]",t.DocSeqNo.toString());if(this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(s=s.replace("[ProductCode]",t.ProductCode.toString())),this.ScreenObject.Preferences.tempWarningMsg=a.a.SessionManager.IsWebApplication?s:null,alert(s),3==e.Action||4==e.Action)return!1}}else if(4!=e.EditOption||3!=e.Action&&4!=e.Action){if(5==e.EditOption&&(3==e.Action||4==e.Action)){let s=this.GetPrimaryColName(),i=null;for(let a=0;a<this.ScreenObject.GridData.length;a++)if(!n.e.IsEmpty(this.ScreenObject.GridData[a][s]))if(null==i)i=this.ScreenObject.GridData[a][e.DisplayMember].toString();else if(i!=this.ScreenObject.GridData[a][e.DisplayMember].toString()){let s=e.Message.replace("[ROWNO]",t.DocSeqNo.toString());return this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(s=s.replace("[ProductCode]",t.ProductCode.toString())),alert(s),!1}}}else{let s=this.GetPrimaryColName(),i=[];for(let a=0;a<this.ScreenObject.GridData.length;a++)if(!n.e.IsEmpty(this.ScreenObject.GridData[a][s])&&!n.e.IsEmpty(this.ScreenObject.GridData[a][e.DisplayMember])){if(i.Contains(this.ScreenObject.GridData[a][e.DisplayMember].toString())){let s=e.Message.replace("[ROWNO]",t.DocSeqNo.toString());return this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(s=s.replace("[ProductCode]",t.ProductCode.toString())),alert(s),!1}i.push(this.ScreenObject.GridData[a][e.DisplayMember].toString())}}}catch(s){if("Cannot set Visibility or call Show, ShowDialog, or WindowInteropHelper.EnsureHandle after a Window has closed."==s)return!1}return!0}ValidateDataonSave_Ctrl(e){try{if(null!=e.Expression&&""!=e.Expression){let t=a.a.eval.EvaluateExpression(e.Expression,this.fldDict).toString();if("1"!=t.toString()||1!=e.Action&&3!=e.Action&&4!=e.Action){if("1"==t.toString()&&5==e.Action&&!confirm(e.Message))return!1}else if(alert(e.Message),3==e.Action||4==e.Action)return!1}}catch(t){}return!0}ValidateDate(e){try{if(!n.e.IsEmpty(e.Expression)){this.FillDictionary(null,!1);let t=a.a.eval.EvaluateExpression(e.Expression,this.fldDict).toString();"1"!=n.e.String(t)||1!=e.Action&&3!=e.Action&&4!=e.Action||alert(e.Message)}}catch(t){}}NumFieldEditOptionValidation(e,t){if(e){if(1==e.EditOption&&this.ScreenObject.GridDataColumns.Contains("default"+e.DisplayMember)){if(!n.e.IsEmpty(t["default"+e.DisplayMember])&&!n.e.IsEmpty(t[e.DisplayMember])&&parseFloat(t["default"+e.DisplayMember])>parseFloat(t[e.DisplayMember]))throw alert("Can not decrease value less than "+t["default"+e.DisplayMember].toString()),new Error("PactException")}else if(2==e.EditOption&&this.ScreenObject.GridDataColumns.Contains("default"+e.DisplayMember)&&!n.e.IsEmpty(t["default"+e.DisplayMember])&&!n.e.IsEmpty(t[e.DisplayMember])&&parseFloat(t["default"+e.DisplayMember])<parseFloat(t[e.DisplayMember]))throw alert("Can not increase value greater than "+t["default"+e.DisplayMember].toString()),new Error("PactException");if("Quantity"==e.DisplayMember&&"Quantity"==n.e.String(t.LinkedFieldName)&&0==this.ScreenObject.DocID&&!n.e.IsEmpty(t.LinkedInvDocDetailsID)&&parseInt(t.LinkedInvDocDetailsID)>0&&(!this.ScreenObject.Preferences.ContainsKey("DisableQtyCheck")||!Object(o.j)(this.ScreenObject.Preferences.DisableQtyCheck))){let s=Object(o.j)(this.ScreenObject.Preferences.Enabletolerance);if(!n.e.IsEmpty(t["default"+e.DisplayMember])&&!n.e.IsEmpty(t[e.DisplayMember]))if(s&&n.e.Double(t.TolPer)>0){if(parseFloat(t["default"+e.DisplayMember])+parseFloat(t.TolPer)<parseFloat(t[e.DisplayMember]))throw alert("Can not enter more than source document quantity :"+(parseFloat(t["default"+e.DisplayMember])+parseFloat(t.TolPer))),new Error("PactException")}else if(s&&n.e.Double(t.TolVal)>0){if(parseFloat(t["default"+e.DisplayMember])+parseFloat(t.TolVal)<parseFloat(t[e.DisplayMember]))throw alert("Can not enter more than source document quantity :"+(parseFloat(t["default"+e.DisplayMember])+parseFloat(t.TolVal))),new Error("PactException")}else if(parseFloat(t["default"+e.DisplayMember])<parseFloat(t[e.DisplayMember]))throw alert("Can not enter more than source document quantity :"+t["default"+e.DisplayMember].toString()),new Error("PactException")}}}ValidateFooterDataonSave(e){try{if(this.ScreenObject.FooterGridDataColumns.Contains("Expression")&&this.ScreenObject.FooterGridDataColumns.Contains("Action")&&this.ScreenObject.FooterGridDataColumns.Contains("Message")&&!n.e.IsEmpty(e.Expression)){let t=this.FooterDics;if("1"==a.a.eval.EvaluateExpression(e.Expression.toString(),t).toString()&&("1"==e.Action.toString()||"3"==e.Action.toString()||"4"==e.Action.toString())&&(alert(e.Message.toString()),"3"==e.Action.toString()||"4"==e.Action.toString()))return!1}}catch(t){}return!0}ValidateFooterData(e){try{if(this.ScreenObject.FooterGridDataColumns.Contains("Expression")&&this.ScreenObject.FooterGridDataColumns.Contains("Action")&&this.ScreenObject.FooterGridDataColumns.Contains("Message")&&!n.e.IsEmpty(e.Expression)){let t=this.FooterDics,s=a.a.eval.EvaluateExpression(e.Expression.toString(),t);"1"!=n.e.String(s)||"2"!=n.e.String(e.Action)&&"4"!=n.e.String(e.Action)||(alert(e.Message),"4"==n.e.String(e.Action)&&(e.Amount=null,this.CalculateTotals(e,!1)))}}catch(t){}}ValidateData_Column(e,t,s=!1){try{if(s)return!!n.e.IsEmpty(e.ExternExpression)||"1"==a.a.eval.EvaluateExpression(e.ExternExpression,this.fldDict).toString().toString();if(this.IsInventoryVoucher&&!n.e.IsEmpty(t.ProductID_Key)&&"8"==n.e.String(t.Type))return!1;if(n.e.IsEmpty(e.Expression))if(4!=e.EditOption||2!=e.Action&&4!=e.Action){if(5==e.EditOption&&(2==e.Action||4==e.Action)){let s=this.GetPrimaryColName(),i=null;for(let a=0;a<this.ScreenObject.GridData.length;a++)if(!n.e.IsEmpty(this.ScreenObject.GridData[a][s]))if(null==i)i=this.ScreenObject.GridData[a][e.DisplayMember].toString();else if(i!=this.ScreenObject.GridData[a][e.DisplayMember].toString()){let s=e.Message.replace("[ROWNO]",t.DocSeqNo.toString());return this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(s=s.replace("[ProductCode]",t.ProductCode.toString())),alert(s),!1}}}else{let s=this.GetPrimaryColName(),i=[];for(let a=0;a<this.ScreenObject.GridData.length;a++)if(!n.e.IsEmpty(this.ScreenObject.GridData[a][s])&&!n.e.IsEmpty(this.ScreenObject.GridData[a][e.DisplayMember])){if(i.Contains(this.ScreenObject.GridData[a][e.DisplayMember].toString())){let s=e.Message.replace("[ROWNO]",t.DocSeqNo.toString());return this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(s=s.replace("[ProductCode]",t.ProductCode.toString())),alert(s),!1}i.push(this.ScreenObject.GridData[a][e.DisplayMember].toString())}}else if("1"==a.a.eval.EvaluateExpression(e.Expression,this.fldDict).toString().toString()&&(2==e.Action||4==e.Action)){let s=e.Message.replace("[ROWNO]",t.DocSeqNo.toString());if(this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(s=s.replace("[ProductCode]",t.ProductCode.toString())),alert(s),4==e.Action)throw this.CalculateTotals(t,!1),new Error("PactException")}}catch(i){if("PactException"==i.message)throw new Error("PactException")}return!1}ValidateDataCallBack(e){return this.ValidateData(e.sender,e.IsExternal)}ValidateData(e,t=!1){try{if(t)return!!n.e.IsEmpty(e.ExternExpression)||"1"==a.a.eval.EvaluateExpression(e.ExternExpression,this.fldDict).toString().toString();n.e.IsEmpty(e.Expression)||"1"!=a.a.eval.EvaluateExpression(e.Expression,this.fldDict).toString().toString()||2!=e.Action&&4!=e.Action||alert(e.Message)}catch(s){}return!1}Fill(e,t,s,i){let l="",c="",h=0;if(t<4){if(h=n.e.Int(a.a.SessionManager.Preferences["PMLevel"+t.toString()+"Dimension"]),!(a.a.SessionManager.Preferences.ContainsKey("PMLevel"+t.toString()+"Dimension")&&h>0&&this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(h-5e4)+"_Key")))return void this.Fill(e,t+1,s,i);for(l="dcCCNID"+(h-5e4)+"_Key",h=t+1;h<5;){if(4==h&&a.a.SessionManager.Preferences.ContainsKey("PMTaskDimension")&&""!=a.a.SessionManager.Preferences.PMTaskDimension&&"0"!=a.a.SessionManager.Preferences.PMTaskDimension){c="dcCCNID"+(parseInt(a.a.SessionManager.Preferences.PMTaskDimension)-5e4)+"_Key";break}if(a.a.SessionManager.Preferences.ContainsKey("PMLevel"+h.toString()+"Dimension")&&""!=a.a.SessionManager.Preferences["PMLevel"+h.toString()+"Dimension"]&&"0"!=a.a.SessionManager.Preferences["PMLevel"+h.toString()+"Dimension"]&&this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(parseInt(a.a.SessionManager.Preferences["PMLevel"+h.toString()+"Dimension"])-5e4)+"_Key")){c="dcCCNID"+(parseInt(a.a.SessionManager.Preferences["PMLevel"+h.toString()+"Dimension"])-5e4)+"_Key";break}h++}}else{if(4!=t)return;if(!a.a.SessionManager.Preferences.ContainsKey("PMTaskDimension")||!n.e.IsNum(a.a.SessionManager.Preferences.PMTaskDimension))return;h=parseInt(a.a.SessionManager.Preferences.PMTaskDimension),l="dcCCNID"+(h-5e4)+"_Key"}let u,d,D=new r.a,S=null,m=null,b=null,C=null,p=null,y=0,g=0,O=0,I=0,f=0,T=0,j=0;for(let a=0;a<e.length;a++)!n.e.IsEmpty(e[a].ProductID_Key)&&!n.e.IsEmpty(e[a][l])&&parseInt(e[a][l])>1?(4==t?y++:D.ContainsKey(e[a][l].toString())||D.push(e[a][l].toString(),D.length+1),i&&(!n.e.IsEmpty(e[a].DocDetailsID)&&parseInt(e[a].DocDetailsID)>0||(e[a].dcAlpha11=4==t?e[a].dcAlpha11.toString()+"."+y.toString():e[a].dcAlpha11.toString()+"."+D[e[a][l].toString()].toString())),n.e.isValidDate(e[a].dcAlpha15_Key)&&(!m||u<m)&&(m=new Date(e[a].dcAlpha15_Key)),n.e.isValidDate(e[a].dcAlpha16_Key)&&(!b||u>b)&&(b=new Date(e[a].dcAlpha16_Key)),n.e.isValidDate(e[a].dcAlpha22_Key)&&(!C||u<C)&&(C=u),n.e.isValidDate(e[a].dcAlpha23_Key)&&(!p||u>p)&&(p=u),d=n.e.Int(e[a].dcAlpha18),d>0&&(4!=t&&(""==c||""!=n.e.String(e[a][c])&&"1"!=n.e.String(e[a][c]))||(j+=d),e[a].dcAlpha14=null!=S&&n.e.IsNum(S.dcAlpha14)?n.e.Double(S.dcAlpha14)*d/100:d),4!=t&&(""==c||""!=n.e.String(e[a][c])&&"1"!=n.e.String(e[a][c]))||(g=n.e.Double(e[a].dcAlpha31),g>0&&(O+=g),g=n.e.Double(e[a].dcAlpha32),g>0&&(I+=g),g=n.e.Double(e[a].dcAlpha33),g>0&&(f+=g),g=n.e.Double(e[a].dcAlpha34),g>0&&(T+=g))):null!=S||n.e.IsEmpty(e[a].ProductID_Key)||(S=e[a]);if(j>100&&(this.DisplayMessage="Percentage exceeds 100"),null!=S){if(m&&(S.dcAlpha15=m.ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm tt"),S.dcAlpha15_Key=m),b&&(S.dcAlpha16=b.ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm tt"),S.dcAlpha16_Key=b),C&&(S.dcAlpha22=C.ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm tt"),S.dcAlpha22_Key=C),p&&(S.dcAlpha23=p.ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm tt"),S.dcAlpha23_Key=p),null!=this.dsProjWOffHol){let e=!1;if(this.ScreenObject.Preferences.ContainsKey("ConsiderWeeklyOffsAndHolidays")&&!n.e.IsEmpty(this.ScreenObject.Preferences.ConsiderWeeklyOffsAndHolidays)&&(e=Object(o.j)(this.ScreenObject.Preferences.ConsiderWeeklyOffsAndHolidays)),this.ScreenObject.GridDataColumns.Contains("dcAlpha15_Key")&&!n.e.IsEmpty(S.dcAlpha15_Key)&&this.ScreenObject.GridDataColumns.Contains("dcAlpha16_Key")&&!n.e.IsEmpty(S.dcAlpha16_Key)){let t=0,s=0,i={odWHrs:t,odHrsPerDay:s},a=n.e.GetNoOfDays(this.dsProjWOffHol,new Date(S.dcAlpha15_Key),new Date(S.dcAlpha16_Key),e,S,this.DocumentDate,i);t=i.odWHrs,s=i.odHrsPerDay,S.dcAlpha17=a.toString()}if(this.ScreenObject.GridDataColumns.Contains("dcAlpha22_Key")&&!n.e.IsEmpty(S.dcAlpha22_Key)&&this.ScreenObject.GridDataColumns.Contains("dcAlpha23_Key")&&!n.e.IsEmpty(S.dcAlpha23_Key)){let t=0,s=0,i={odWHrs:t,odHrsPerDay:s},a=n.e.GetNoOfDays(this.dsProjWOffHol,new Date(S.dcAlpha22_Key),new Date(S.dcAlpha23_Key),e,S,this.DocumentDate,i);t=i.odWHrs,s=i.odHrsPerDay,S.dcAlpha24=a.toString()}}S.dcAlpha31=O,S.dcAlpha32=I,S.dcAlpha33=f,S.dcAlpha34=T}for(let a=0;a<D.keys.length;a++)this.Fill(e.filter(e=>e[l]==D.keys[a]),t+1,s,i)}EditProjectDim(e){return Object(i.b)(this,void 0,void 0,(function*(){if(a.a.SessionManager.Preferences.ContainsKey("ProjectManagementDimension")&&""!=a.a.SessionManager.Preferences.ProjectManagementDimension&&"0"!=a.a.SessionManager.Preferences.ProjectManagementDimension&&!n.e.IsEmpty(e.DocDetailsID)&&parseInt(e.DocDetailsID)>0){let t=parseInt(a.a.SessionManager.Preferences.ProjectManagementDimension),i="dcCCNID"+(t-5e4),n=this.ScreenObject.GetProjectByINVID(e.DocDetailsID.toString(),i);const{AddEditCostcenterComponent:r}=yield s.e(0).then(s.bind(null,"Upsa")),{AddCostCenterViewModel:o}=yield Promise.all([s.e(4),s.e(6),s.e(8),s.e(11),s.e(54),s.e(71)]).then(s.bind(null,"2pkr"));let l=new o(t);l.AddCostCenterViewModel_1(n,t,0,"",!1),a.a.page.addNewTab({title:this.ScreenName,component:r,params:{obj:l}})}}))}GenerateDoc(e){if(!n.e.IsEmpty(e.DocDetailsID)&&parseInt(e.DocDetailsID)>0&&this.ScreenObject.Data.Tables.length>20){let e=this.ScreenObject.Data.Tables[20].filter(e=>e.CostCenterIDBase>4e4);if(1==e.length)this.GenerateDocfromProject(parseInt(e[0].CostCenterIDBase));else if(e.length>1){let t=new U.a;t.GoToLineViewModel_3(this,e,0),a.a.page.ShowDialog(t,X.a,{ShowCenter:!0,NoWidth:!0})}}}GenerateDocfromProject(e){let t=0,s=parseInt(a.a.SessionManager.Preferences.ProjectManagementDimension),i="dcCCNID"+(s-5e4),r=this.ScreenObject.GetProjectByINVID(this.SelectedRow.DocDetailsID.toString(),i),o=new es(e,"",!1,this);for(let a=0;a<o.ScreenObject._CCFields.length;a++){let e=o.ScreenObject._CCFields[a];if(e instanceof m.b)if(e.CCID==s)e.SelectedValue=r;else{t=e.CCID;let s=this.ScreenObject._CCFields.find(e=>e instanceof m.b&&e.CCID==t);s instanceof m.b&&s.SelectedValue>0?e.SelectedValue=s.SelectedValue:this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(t-5e4))&&!n.e.IsEmpty(this.SelectedRow["dcCCNID"+(t-5e4)+"_Key"])&&(e.SelectedValue=parseInt(this.SelectedRow["dcCCNID"+(t-5e4)+"_Key"]))}}if(a.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==a.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&o.ScreenObject.FillListViews(!1),33==o.DocumentType||34==o.DocumentType){if(null!=o.ScreenObject.Link){let e=o.ScreenObject.Link.LinkCombo.Items.find(e=>null!=e.Parent&&"158"==e.Parent);e&&(o.ScreenObject.Link.LinkCombo.SelectedValue=e.Value,o.OLinkSelectionChanged(null))}if(this.ScreenObject.Preferences.ContainsKey("jobCCID")&&""!=this.ScreenObject.Preferences.jobCCID.toString()&&parseInt(this.ScreenObject.Preferences.jobCCID)>5e4&&this.ScreenObject.Preferences.ContainsKey("StageCCID")&&""!=this.ScreenObject.Preferences.StageCCID.toString()&&parseInt(this.ScreenObject.Preferences.StageCCID)>5e4&&this.ScreenObject.Preferences.ContainsKey("BomCCID")&&""!=this.ScreenObject.Preferences.BomCCID.toString()&&parseInt(this.ScreenObject.Preferences.BomCCID)>5e4){let e=this.ScreenObject._CCFields.find(e=>e instanceof m.b&&e.CCID==parseInt(this.ScreenObject.Preferences.jobCCID)),t=0,s=0,a=0;if(i="dcCCNID"+(parseInt(this.ScreenObject.Preferences.StageCCID)-5e4)+"_Key",this.ScreenObject.GridDataColumns.Contains(i)&&!n.e.IsEmpty(this.SelectedRow[i])&&(a=parseInt(this.SelectedRow[i])),i="dcCCNID"+(parseInt(this.ScreenObject.Preferences.BomCCID)-5e4)+"_Key",this.ScreenObject.GridDataColumns.Contains(i)&&!n.e.IsEmpty(this.SelectedRow[i])&&(t=parseInt(this.SelectedRow[i])),e&&e.SelectedValue>0&&t>0&&a>0){let i=o.ScreenObject.Link.DocumentList.Items.find(t=>t.Value==e.SelectedValue.toString());if(i){i.IsChecked=!0;let r=new Q.a(o,e.Text,parseInt(o.ScreenObject.Link.LinkCombo.SelectedValue),e.SelectedValue,!1),l=r.ds.Tables[0].filter(e=>e.CCNodeID==t);l.length>0&&(t=parseInt(l[0].BomID)),(n.e.IsEmpty(r.Boms.SelectedValue)||r.Boms.SelectedValue!=t.toString())&&(r.Boms.SelectedValue=t.toString(),r.onBomChanged(r.Boms.SelectedValue)),r.Boms.SelectedItem=r.Boms.GetselectedItem(),l=r.ds.Tables[3].filter(e=>e.BOMID==t&&e.StageNodeID==a),l.length>0&&(s=parseInt(l[0].StageID)),(n.e.IsEmpty(r.Stages.SelectedValue)||r.Stages.SelectedValue!=s.toString())&&(r.Stages.SelectedValue=s.toString(),r.FillJobProducts()),r.Stages.SelectedItem=r.Stages.GetselectedItem(),r.GridData.forEach(e=>{n.e.IsEmpty(e.Select)||(e.Select=!0)}),r.OnSave("Add"),r.OnSave("OKNoClose")}}}}a.a.page.addNewTab({component:B.AddEditDocumentComponent,params:{obj:o}})}FillWBS(e){let t,s="";if(a.a.SessionManager.Preferences.ContainsKey("ProjectManagementDimension")&&n.e.IsNum(a.a.SessionManager.Preferences.ProjectManagementDimension)){t=parseInt(a.a.SessionManager.Preferences.ProjectManagementDimension);let e=this.ScreenObject._TextFields.find(e=>e instanceof m.b&&e.CCID==t);e&&e.SelectedValue>0&&(s=this.ScreenObject.GetDocNumberString("Code",t,e.SelectedValue))}for(let i=0;i<this.ScreenObject.GridData.length;i++)n.e.IsEmpty(this.ScreenObject.GridData[i].ProductID_Key)||!n.e.IsEmpty(this.ScreenObject.GridData[i].DocDetailsID)&&parseInt(this.ScreenObject.GridData[i].DocDetailsID)>0||(this.ScreenObject.GridData[i].dcAlpha11=s);for(this.Fill(this.ScreenObject.GridData,1,e,!0),t=1;t<4&&a.a.SessionManager.Preferences.ContainsKey("PMLevel"+t.toString()+"Dimension")&&!n.e.IsEmpty(a.a.SessionManager.Preferences["PMLevel"+t.toString()+"Dimension"])&&"0"!=a.a.SessionManager.Preferences["PMLevel"+t.toString()+"Dimension"]&&this.ScreenObject.GridDataColumns.Contains("dcccnid"+(parseInt(a.a.SessionManager.Preferences["PMLevel"+t.toString()+"Dimension"])-5e4)+"_Key");)this.Fill(this.ScreenObject.GridData,1,e,!1),t++}FillHeaderDictionary(){this.ScreenObject._CCFields.forEach(e=>{this.fldDict.ContainsKey(e.Lbl)&&(e instanceof m.b&&e.SelectedValue>0&&!n.e.IsEmpty(e.Text)||e instanceof C.a&&e.SelectedValue>0&&!n.e.IsEmpty(e.Text)?this.fldDict[e.Lbl].setFieldValue(e.Text):this.fldDict[e.Lbl].setFieldValue(""),this.FooterDics.ContainsKey(e.Lbl)&&this.FooterDics[e.Lbl].setFieldValue(this.fldDict[e.Lbl].fieldResult))}),this.ScreenObject.HeaderFields.forEach(e=>{e instanceof b.c&&!n.e.IsEmpty(e.Lbl)&&this.fldDict.ContainsKey(e.Lbl)&&(e instanceof u.d?"FLOAT"==e.DataType?null!=e.Text&&""!=e.Text&&""==e.ValidateData()?this.fldDict[e.Lbl].setFieldValue(e.Text):this.fldDict[e.Lbl].setFieldValue(0):this.fldDict[e.Lbl].setFieldValue(e.Text):e instanceof D.e?this.fldDict[e.Lbl].setFieldValue(e.SelectedValue):e instanceof g.a?this.fldDict[e.Lbl].setFieldValue(e.Text):e instanceof d.c&&e.Date?this.fldDict[e.Lbl].setFieldValue(e.Date):e instanceof m.b&&(e.SelectedValue>0&&!n.e.IsEmpty(e.Text)?this.fldDict[e.Lbl].setFieldValue(e.Text):this.fldDict[e.Lbl].setFieldValue("")),this.FooterDics.ContainsKey(e.Lbl)&&this.FooterDics[e.Lbl].setFieldValue(this.fldDict[e.Lbl].fieldResult))}),this.ScreenObject._TextFields.forEach(e=>{this.fldDict.ContainsKey(e.Lbl)&&(e instanceof u.d?"FLOAT"==e.DataType?null!=e.Text&&""!=e.Text&&""==e.ValidateData()?this.fldDict[e.Lbl].setFieldValue(e.Text):this.fldDict[e.Lbl].setFieldValue(0):this.fldDict[e.Lbl].setFieldValue(e.Text):e instanceof D.e?this.fldDict[e.Lbl].setFieldValue(e.SelectedValue):e instanceof g.a?this.fldDict[e.Lbl].setFieldValue(e.Text):e instanceof d.c&&e.Date||e instanceof d.b&&e.Date?this.fldDict[e.Lbl].setFieldValue(e.Date):e instanceof m.b&&(e.SelectedValue>0&&!n.e.IsEmpty(e.Text)?this.fldDict[e.Lbl].setFieldValue(e.Text):this.fldDict[e.Lbl].setFieldValue("")),this.FooterDics.ContainsKey(e.Lbl)&&this.FooterDics[e.Lbl].setFieldValue(this.fldDict[e.Lbl].fieldResult))}),null!=this.ScreenObject.DebitAccount&&this.fldDict.ContainsKey(this.ScreenObject.DebitAccount.Lbl)&&(this.ScreenObject.DebitAccount.SelectedValue>0&&this.ScreenObject.DebitAccount.Name.Visible&&!n.e.IsEmpty(this.ScreenObject.DebitAccount.Name.Text)?this.fldDict[this.ScreenObject.DebitAccount.Lbl].setFieldValue(this.ScreenObject.DebitAccount.Name.Text):this.ScreenObject.DebitAccount.SelectedValue>0&&this.ScreenObject.DebitAccount.Code.Visible&&!n.e.IsEmpty(this.ScreenObject.DebitAccount.Code.Text)?this.fldDict[this.ScreenObject.DebitAccount.Lbl].setFieldValue(this.ScreenObject.DebitAccount.Code.Text):this.fldDict[this.ScreenObject.DebitAccount.Lbl].setFieldValue("")),null!=this.ScreenObject.CreditAccount&&this.fldDict.ContainsKey(this.ScreenObject.CreditAccount.Lbl)&&(this.ScreenObject.CreditAccount.SelectedValue>0&&this.ScreenObject.CreditAccount.Name.Visible&&!n.e.IsEmpty(this.ScreenObject.CreditAccount.Name.Text)?this.fldDict[this.ScreenObject.CreditAccount.Lbl].setFieldValue(this.ScreenObject.CreditAccount.Name.Text):this.ScreenObject.CreditAccount.SelectedValue>0&&this.ScreenObject.CreditAccount.Code.Visible&&!n.e.IsEmpty(this.ScreenObject.CreditAccount.Code.Text)?this.fldDict[this.ScreenObject.CreditAccount.Lbl].setFieldValue(this.ScreenObject.CreditAccount.Code.Text):this.fldDict[this.ScreenObject.CreditAccount.Lbl].setFieldValue("")),this.fldDict.DOCDATE.setFieldValue(this.DocumentDate),null==this.ScreenObject.DocPrefix||null==this.ScreenObject.DocPrefix.ComboBox||n.e.IsEmpty(this.ScreenObject.DocPrefix.ComboBox.Text)?this.fldDict.DocPrefix.setFieldValue(""):this.fldDict.DocPrefix.setFieldValue(this.ScreenObject.DocPrefix.ComboBox.Text),this.fldDict.DUEDATE.setFieldValue(null!=this.ScreenObject.DueDate&&this.ScreenObject.DueDate.Date?this.ScreenObject.DueDate.Date:Date.Today());let e=this.ScreenObject._StaticFields.find(e=>"billdate"==e.DBColumnName.toLowerCase());this.fldDict.BILLDATE.setFieldValue(e&&e instanceof d.c&&e.Date?e.Date:Date.Today());let t=this.ScreenObject._StaticFields.find(e=>"chequematuritydate"==e.DBColumnName.toLowerCase());this.fldDict.MaturityDate.setFieldValue(t&&t instanceof d.c&&t.Date?t.Date:Date.Today()),this.FooterDics.ContainsKey("BILLDATE")&&this.FooterDics.BILLDATE.setFieldValue(this.fldDict.BILLDATE.fieldResult),this.FooterDics.ContainsKey("DUEDATE")&&this.FooterDics.DUEDATE.setFieldValue(this.fldDict.DUEDATE.fieldResult),this.FooterDics.ContainsKey("DOCDATE")&&this.FooterDics.DOCDATE.setFieldValue(this.fldDict.DOCDATE.fieldResult)}FillDictionary(e,t){let s=this.ScreenObject.ColumnSource,i=1;a.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(o.j)(a.a.SessionManager.Preferences["Use Foreign Currency"])&&(this.Currency&&null!=this.Currency.ExchangeRate.Text&&""!=this.Currency.ExchangeRate.Text?i=parseFloat(this.Currency.ExchangeRate.Text):null!=e&&this.ScreenObject.GridDataColumns.Contains("ExchangeRate")&&!n.e.IsEmpty(e.ExchangeRate)&&(i=parseFloat(e.ExchangeRate))),null!=e&&(this.fldDict.keys.forEach(a=>{let r={Key:a,Value:this.fldDict[a]};if("ServerDate"==r.Key)return;let o=s.filter(e=>e.lbl==this.fldDict[r.Key].getFieldName());if(o.length>0&&"ComboBox"==o[0].DataType&&null!=e[o[0].ValueBinding]&&!n.e.IsEmpty(e[o[0].ValueBinding]))this.fldDict[r.Key].setFieldValue(e[o[0].ValueBinding]);else if(o.length>0&&"PactComboBox"==o[0].DataType&&null!=e[o[0].ValueBinding+"_Key"]&&!n.e.IsEmpty(e[o[0].ValueBinding+"_Key"]))this.fldDict[r.Key].setFieldValue(e[o[0].ValueBinding+"_Key"]);else if(o.length>0&&("DATE"==o[0].DataType||"DATETIME"==o[0].DataType||"TIME"==o[0].DataType)&&null!=e[o[0].DisplayMember+"_Key"]&&!n.e.IsEmpty(e[o[0].DisplayMember+"_Key"]))this.fldDict[r.Key].setFieldValue(e[o[0].DisplayMember+"_Key"]);else if(o.length>0&&"LISTBOX"==o[0].DataType&&!n.e.IsEmpty(e[o[0].DisplayMember]))this.fldDict[r.Key].setFieldValue(e[o[0].DisplayMember].toString());else if(o.length>0&&"ComboBox"!=o[0].DataType&&"DATE"!=o[0].DataType&&"LISTBOX"!=o[0].DataType&&"DATETIME"!=o[0].DataType&&"TIME"!=o[0].DataType&&"PactComboBox"!=o[0].DataType&&!n.e.IsEmpty(e[o[0].DisplayMember]))n.e.IsNum(e[o[0].DisplayMember])?n.e.IsEmpty(o[0].DecimalPoints)?this.fldDict[r.Key].setFieldValue(e[o[0].DisplayMember]):this.fldDict[r.Key].setFieldValue(parseFloat(e[o[0].DisplayMember]).ToString("N"+o[0].DecimalPoints)):this.fldDict[r.Key].setFieldValue(e[o[0].DisplayMember]);else if(r.Key.endsWith("EXRT"))if(o=s.filter(e=>e.lbl==this.fldDict[r.Key.replace("EXRT","")].getFieldName()),o.length>0)if("-1"==o[0].DefaultValue)this.fldDict[r.Key].setFieldValue(i);else if("-2"==o[0].DefaultValue)this.ScreenObject.GridDataColumns.Contains(o[0].DisplayMember.replace("dcNum","dcExchRT"))&&!n.e.IsEmpty(e[o[0].DisplayMember.replace("dcNum","dcExchRT")])?this.fldDict[r.Key].setFieldValue(e[o[0].DisplayMember.replace("dcNum","dcExchRT")].toString()):this.fldDict[r.Key].setFieldValue(1);else{let e=n.e.Double(o[0].DefaultValue);this.fldDict[r.Key].setFieldValue(e>0&&o[0].CurrID>0?o[0].ExhcgRt:1)}else this.fldDict[r.Key].setFieldValue(1);else r.Key.toLowerCase().startsWith("calc")&&!r.Key.toLowerCase().startsWith("calculate")?(o=s.filter(e=>e.lbl==this.fldDict[r.Key.substr(4)].getFieldName()),o.length>0&&"ComboBox"!=o[0].DataType&&"PactComboBox"!=o[0].DataType&&!n.e.IsEmpty(e[o[0].DisplayMember])?n.e.IsNum(e["dcCalc"+o[0].DisplayMember])?n.e.IsEmpty(o[0].DecimalPoints)?this.fldDict[r.Key].setFieldValue(e["dcCalc"+o[0].DisplayMember]):this.fldDict[r.Key].setFieldValue(parseFloat(e["dcCalc"+o[0].DisplayMember]).ToString("N"+o[0].DecimalPoints)):this.fldDict[r.Key].setFieldValue(e["dcCalc"+o[0].DisplayMember]):this.fldDict[r.Key].setFieldValue(0)):this.fldDict[r.Key].setFieldValue(o.length>0&&("STRING"==o[0].DataType||"TEXT"==o[0].DataType||"LISTBOX"==o[0].DataType||"LINK"==o[0].DataType)?"":"NET"==r.Key?this.NetAmount:0);t&&o&&o.length>0&&null!=o[0].Formula&&o[0].Formula.Contains("AVGRATE")&&this.fldDict[r.Key].setFieldValue(0)}),this.IsInventoryVoucher&&(n.e.IsEmpty(e.Rate)?this.fldDict.RATE.setFieldValue(0):this.fldDict.RATE.setFieldValue(e.Rate),n.e.IsEmpty(e.Quantity)?this.fldDict.QTY.setFieldValue(0):this.fldDict.QTY.setFieldValue(e.Quantity),n.e.IsEmpty(e.FreeQTY)?this.fldDict.FreeQTY.setFieldValue(0):this.fldDict.FreeQTY.setFieldValue(e.FreeQTY),n.e.IsEmpty(e.Gross)?this.fldDict.GROSS.setFieldValue(0):this.fldDict.GROSS.setFieldValue(e.Gross),n.e.IsEmpty(e.UOMConvertedQty)?this.fldDict.CONVQTY.setFieldValue(0):this.fldDict.CONVQTY.setFieldValue(e.UOMConvertedQty),n.e.IsEmpty(e.UOMConversion)?this.fldDict.UOMCONVERSION.setFieldValue(1):this.fldDict.UOMCONVERSION.setFieldValue(e.UOMConversion),n.e.IsEmpty(e.LASTPURCHASERATE)?this.fldDict.LSTPRCHSRT.setFieldValue(0):this.fldDict.LSTPRCHSRT.setFieldValue(e.LASTPURCHASERATE),n.e.IsEmpty(e.AVGRATE)?this.fldDict.AVGRT.setFieldValue(0):this.fldDict.AVGRT.setFieldValue(e.AVGRATE),n.e.IsEmpty(e.SRate)?this.fldDict.SRate.setFieldValue(0):this.fldDict.SRate.setFieldValue(e.SRate),n.e.IsEmpty(e.RRate)?this.fldDict.RRate.setFieldValue(0):this.fldDict.RRate.setFieldValue(e.RRate),n.e.IsEmpty(e.MRate)?this.fldDict.MRate.setFieldValue(0):this.fldDict.MRate.setFieldValue(e.MRate),n.e.IsEmpty(e.QOH)?this.fldDict.QOH.setFieldValue(0):this.fldDict.QOH.setFieldValue(e.QOH),n.e.IsEmpty(e.BalQOH)?this.fldDict.BalQOH.setFieldValue(0):this.fldDict.BalQOH.setFieldValue(e.BalQOH),n.e.IsEmpty(e.HOLDQTY)?this.fldDict.HOLDQTY.setFieldValue(0):this.fldDict.HOLDQTY.setFieldValue(e.HOLDQTY),n.e.IsEmpty(e.CommittedQty)?this.fldDict.CommittedQty.setFieldValue(0):this.fldDict.CommittedQty.setFieldValue(e.CommittedQty),n.e.IsEmpty(e.RESERVEQTY)?this.fldDict.RESERVEQTY.setFieldValue(0):this.fldDict.RESERVEQTY.setFieldValue(e.RESERVEQTY),n.e.IsEmpty(e.TotalReserve)?this.fldDict.TotalReserve.setFieldValue(0):this.fldDict.TotalReserve.setFieldValue(e.TotalReserve))),this.FillHeaderDictionary(),this.fldDict.EXCHRT.setFieldValue(i),this.FooterDics.ContainsKey("EXCHRT")&&this.FooterDics.EXCHRT.setFieldValue(this.fldDict.EXCHRT.fieldResult)}DontChVlue(e,t,s){if("Gross"==t.DisplayMember&&!n.e.IsEmpty(e[t.DisplayMember])&&!n.e.IsEmpty(t.DecimalPoints)){var i=(parseFloat(e[t.DisplayMember].toString())-s).toString().split(".");if(i.length>0&&0==parseFloat(i[0])&&i.length>1&&i[1].length>parseInt(t.DecimalPoints)&&0==parseFloat(i[1].substr(0,parseInt(t.DecimalPoints))))return!0}return!1}CalculateTotals(e,t,s="",i=!0){{if(null==this.ScreenObject.GridData||null!=e&&this.IsInventoryVoucher&&n.e.IsEmpty(e.ProductID_Key))return;null!=e&&!this.IsInventoryVoucher&&this.ScreenObject.GridDataColumns.Contains("Denomination")&&(e.Denomination="Denominations");let l=1,c=1;a.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(o.j)(a.a.SessionManager.Preferences["Use Foreign Currency"])&&(this.Currency&&null!=this.Currency.ExchangeRate.Text&&""!=this.Currency.ExchangeRate.Text?(l=parseFloat(this.Currency.ExchangeRate.Text),n.e.IsEmpty(this.Currency.Currency.SelectedValue)||(c=parseInt(this.Currency.Currency.SelectedValue))):null!=e&&this.ScreenObject.GridDataColumns.Contains("ExchangeRate")&&!n.e.IsEmpty(e.ExchangeRate)&&(l=parseFloat(e.ExchangeRate),this.ScreenObject.GridDataColumns.Contains("CurrencyID_Key")&&!n.e.IsEmpty(e.CurrencyID_Key)&&(c=parseInt(e.CurrencyID_Key)))),this.GridNetTotal=0;let h=this.ScreenObject.ColumnSource;this.FillDictionary(e,t);let u,d=0,D=0,S=0,m=this.fldDict;if(""!=s&&null!=e){let t;if(t=h.find(e=>e.DisplayMember==s),!t||n.e.IsEmpty(t.DecimalPoints)||n.e.IsEmpty(e[s])||"FLOAT"!=t.DataType||(t.NoRoundOff||(e[t.DisplayMember]=parseFloat(e[s]).ToString("N"+t.DecimalPoints)),this.fldDict[t.lbl].setFieldValue(e[s].toString()),"Gross"==t.DisplayMember?this.fldDict.GROSS.setFieldValue(e.Gross):"Quantity"==t.DisplayMember?this.fldDict.QTY.setFieldValue(n.e.String(e.Quantity)):"Rate"==t.DisplayMember&&this.fldDict.RATE.setFieldValue(n.e.String(e.Rate))),t=null,t=h.find(e=>!n.e.IsEmpty(e.FilterCondition)&&!n.e.IsEmpty(e.DisplayMember)&&e.DisplayMember.toLowerCase().Contains("dcnum")&&e.FilterCondition.toLowerCase()==s.toLowerCase()),t)s=t.DisplayMember;else{if("productid"==s.toLowerCase())s="Gross";else if("gross"==s.toLowerCase())s="Rate";else if("rate"==s.toLowerCase()||"quantity"==s.toLowerCase()||"unit"==s.toLowerCase()){if("Quantity"==s){this.fldDict.QTY.setFieldValue(n.e.String(e.Quantity));let t=1;n.e.IsNum(e.UOMConversion)&&(t=parseFloat(e.UOMConversion)),n.e.IsEmpty(e.Quantity)||(e.UOMConvertedQty=t*parseFloat(e.Quantity))}s="Gross"}t=h.find(e=>e.DisplayMember==s),t&&!n.e.IsEmpty(t.FilterCondition)&&(t=h.find(e=>!n.e.IsEmpty(e.DisplayMember)&&e.DisplayMember.toLowerCase()==t.FilterCondition.toLowerCase()))}!t||n.e.IsEmpty(t.Formula)||4==t.SectionID||"8"==n.e.String(e.Type)&&t.UseBarcode?t&&t.DisplayMember.Contains("dcNum")&&this.fldDict["Calc"+t.lbl].setFieldValue(e[t.DisplayMember]):(u=a.a.eval.EvaluateExpression(t.Formula,m),null!=u&&"Infinity"!=u.toString()&&"-Infinity"!=u.toString()&&"NaN"!=u.toString()&&n.e.IsNum(u)&&(0==t.IsCalculated&&t.IsColumnUserDefined&&t.DisplayMember.toLowerCase().Contains("dcnum")?null!=u&&n.e.IsNum(u)&&(t.NoRoundOff?e["dcCalc"+t.DisplayMember]=parseFloat(u).ToString("N6"):null!=t.DecimalPoints&&""!=t.DecimalPoints?e["dcCalc"+t.DisplayMember]=parseFloat(u).ToString("N"+t.DecimalPoints):null!=u&&(e["dcCalc"+t.DisplayMember]=u)):this.DontChVlue(e,t,parseFloat(u.toString()))||(t.NoRoundOff?e[t.DisplayMember]=parseFloat(u).ToString("N6"):n.e.IsEmpty(t.DecimalPoints)?null!=u&&(e[t.DisplayMember]=u.toString()):e[t.DisplayMember]=parseFloat(u).ToString("N"+t.DecimalPoints)),"Gross"==t.DisplayMember?this.fldDict.GROSS.setFieldValue(e.Gross):"Quantity"==t.DisplayMember?(this.fldDict.QTY.setFieldValue(n.e.String(e.Quantity)),n.e.IsEmpty(e.UOMConversion)||n.e.IsEmpty(e.Quantity)||(e.UOMConvertedQty=parseFloat(e.Quantity)*parseFloat(e.UOMConversion))):"FreeQTY"==t.DisplayMember?(this.fldDict.FreeQTY.setFieldValue(e.FreeQTY),!n.e.IsEmpty(e.FreeQTY)&&parseFloat(e.FreeQTY)>0&&(e.UOMConvertedQty=n.e.IsEmpty(e.UOMConversion)?e.FreeQTY.toString():parseFloat(e.FreeQTY)*parseFloat(e.UOMConversion))):"Rate"==t.DisplayMember?this.fldDict.RATE.setFieldValue(e.Rate):1==t.IsCalculated?(this.fldDict[t.lbl].setFieldValue(e[t.DisplayMember]),t.DisplayMember.Contains("dcNum")&&this.fldDict["Calc"+t.lbl].setFieldValue(e[t.DisplayMember])):t.DisplayMember.Contains("dcNum")&&this.fldDict["Calc"+t.lbl].setFieldValue(e["dcCalc"+t.DisplayMember])))}for(let t=0;t<h.length;t++){if(null!=e)if(n.e.IsEmpty(h[t].Formula)||4==h[t].SectionID||"8"==n.e.String(e.Type)&&h[t].UseBarcode)h[t].DisplayMember.Contains("dcNum")&&(4!=h[t].SectionID||n.e.IsEmpty(h[t].Formula))?null!=e[h[t].DisplayMember]&&(e["dcCalc"+h[t].DisplayMember]=e[h[t].DisplayMember],this.fldDict["Calc"+h[t].lbl].setFieldValue(e[h[t].DisplayMember])):"LINK"==h[t].DataType&&h[t].DisplayMember.toLowerCase().Contains("dcalpha")&&(e[h[t].DisplayMember]="...");else{try{if(1==h[t].IsCalculated||!h[t].IsColumnUserDefined&&"DueDate"!=h[t].DisplayMember)u=a.a.eval.EvaluateExpression(h[t].Formula,m),null!=u&&"Infinity"!=u.toString()&&"-Infinity"!=u.toString()&&"NaN"!=u.toString()&&n.e.IsNum(u)&&(this.DontChVlue(e,h[t],parseFloat(u.toString()))||(h[t].NoRoundOff?e[h[t].DisplayMember]=parseFloat(u).ToString("N6"):n.e.IsEmpty(h[t].DecimalPoints)?null!=u&&(e[h[t].DisplayMember]=u.toString()):e[h[t].DisplayMember]=parseFloat(u).ToString("N"+h[t].DecimalPoints))),h[t].DisplayMember.Contains("dcNum")&&(e["dcCalc"+h[t].DisplayMember]=e[h[t].DisplayMember]);else if(h[t].DisplayMember.Contains("dcNum"))u=a.a.eval.EvaluateExpression(h[t].Formula,m),null!=u&&"Infinity"!=u.toString()&&"-Infinity"!=u.toString()&&"NaN"!=u.toString()&&n.e.IsNum(u)&&(h[t].NoRoundOff?e["dcCalc"+h[t].DisplayMember]=parseFloat(u).ToString("N6"):n.e.IsEmpty(h[t].DecimalPoints)?null!=u&&(e["dcCalc"+h[t].DisplayMember]=u.toString()):e["dcCalc"+h[t].DisplayMember]=parseFloat(u).ToString("N"+h[t].DecimalPoints));else if((h[t].DisplayMember.toLowerCase().Contains("dcalpha")||"DueDate"==h[t].DisplayMember)&&(u=a.a.eval.EvaluateExpression(h[t].Formula,m).toString(),null!=u&&"Infinity"!=u.toString()&&"-Infinity"!=u.toString()&&"NaN"!=u.toString()))if("DATE"==h[t].DataType||"DATETIME"==h[t].DataType||"TIME"==h[t].DataType){let s;n.e.isValidDate(u)&&(e[h[t].DisplayMember]="DATETIME"==h[t].DataType?new Date(u).ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm a"):"TIME"==h[t].DataType?new Date(u).ToString("hh:mm:ss tt"):new Date(u).ToString(a.a.SessionManager.Preferences["Date Format"]),"TIME"==h[t].DataType?(s=new Date(u),e[h[t].DisplayMember+"_Key"]=new Date(1900,1,1,s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds())):e[h[t].DisplayMember+"_Key"]=new Date(u),this.fldDict[h[t].lbl].setFieldValue(u.toString()))}else"FLOAT"==h[t].DataType?n.e.IsNum(u)?(e[h[t].DisplayMember]=u.toString(),this.fldDict[h[t].lbl].setFieldValue(u)):(e[h[t].DisplayMember]=0,this.fldDict[h[t].lbl].setFieldValue(0)):(e[h[t].DisplayMember]=u.toString(),this.fldDict[h[t].lbl].setFieldValue(u.toString()))}catch(r){console.log("i"+t+" "+h[t].Formula),this.DisplayMessage="Problem evaluating formula,try again",Logger.ErrorLog("Addeditdocumentviewmodel","Formua evaluation calculate totals",r)}"Gross"!=h[t].DisplayMember||n.e.IsEmpty(e.Gross)?"FreeQTY"!=h[t].DisplayMember||n.e.IsEmpty(e.FreeQTY)?"Quantity"==h[t].DisplayMember?n.e.IsEmpty(e.Quantity)||(this.fldDict.QTY.setFieldValue(n.e.String(e.Quantity)),n.e.IsEmpty(e.UOMConversion)||(e.UOMConvertedQty=parseFloat(e.Quantity)*parseFloat(e.UOMConversion))):"Rate"!=h[t].DisplayMember||n.e.IsEmpty(e.Rate)?1==h[t].IsCalculated?(n.e.IsEmpty(e[h[t].DisplayMember])||this.fldDict[h[t].lbl].setFieldValue(e[h[t].DisplayMember]),h[t].DisplayMember.Contains("dcNum")&&!n.e.IsEmpty(e[h[t].DisplayMember])&&this.fldDict["Calc"+h[t].lbl].setFieldValue(e[h[t].DisplayMember])):h[t].DisplayMember.Contains("dcNum")&&this.fldDict["Calc"+h[t].lbl].setFieldValue(e["dcCalc"+h[t].DisplayMember]):this.fldDict.RATE.setFieldValue(e.Rate):this.fldDict.FreeQTY.setFieldValue(e.FreeQTY):this.fldDict.GROSS.setFieldValue(e.Gross),h[t].DisplayMember.Contains("dcNum")&&n.e.IsEmpty(e[h[t].DisplayMember])&&this.fldDict[h[t].lbl].setFieldValue(0),h[t].DisplayMember.Contains("dcNum")&&n.e.IsEmpty(e["dcCalc"+h[t].DisplayMember])&&this.fldDict["Calc"+h[t].lbl].setFieldValue(0),this.ScreenObject.GridDataObj.updateRow(e)}if(i){let e=n.e.GetEmptyDate();if(d=0,S=0,D=0,h[t].DisplayMember.Contains("dcAlpha")||"FLOAT"!=h[t].DataType.toUpperCase()||4==h[t].SectionID){if(h[t].DisplayMember.Contains("dcAlpha")&&"FLOAT"==h[t].DataType.toUpperCase()&&4!=h[t].SectionID){d=0;for(let e=0;e<this.ScreenObject.GridData.length;e++)n.e.IsEmpty(this.ScreenObject.GridData[e][h[t].DisplayMember])||(d+=parseFloat(this.ScreenObject.GridData[e][h[t].DisplayMember]));S=d,1==h[t].ShowbodyTotal&&(h[t].footer=n.e.IsEmpty(h[t].DecimalPoints)?S.toString():S.ToString("N"+h[t].DecimalPoints))}}else{let s=0,i=0,r=0,c=0;for(let u=0;u<this.ScreenObject.GridData.length;u++){let m=l;if(a.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(o.j)(a.a.SessionManager.Preferences["Use Foreign Currency"])&&this.ScreenObject.GridDataColumns.Contains("ExchangeRate")&&!n.e.IsEmpty(this.ScreenObject.GridData[u].ExchangeRate)&&(m=parseFloat(this.ScreenObject.GridData[u].ExchangeRate)),h[t].DisplayMember.toLowerCase().Contains("dcnum")&&(!n.e.IsEmpty(this.ScreenObject.GridData[u][h[t].DisplayMember])&&parseFloat(this.ScreenObject.GridData[u][h[t].DisplayMember])>s&&(s=parseFloat(this.ScreenObject.GridData[u][h[t].DisplayMember])),!n.e.IsEmpty(this.ScreenObject.GridData[u][h[t].DisplayMember])&&(parseFloat(this.ScreenObject.GridData[u][h[t].DisplayMember])<i||0==i)&&(i=parseFloat(this.ScreenObject.GridData[u][h[t].DisplayMember])),!n.e.IsEmpty(this.ScreenObject.GridData[u]["dcCalc"+h[t].DisplayMember])&&parseFloat(this.ScreenObject.GridData[u]["dcCalc"+h[t].DisplayMember])>r&&(r=parseFloat(this.ScreenObject.GridData[u]["dcCalc"+h[t].DisplayMember])),!n.e.IsEmpty(this.ScreenObject.GridData[u]["dcCalc"+h[t].DisplayMember])&&(parseFloat(this.ScreenObject.GridData[u]["dcCalc"+h[t].DisplayMember])<c||0==c)&&(c=parseFloat(this.ScreenObject.GridData[u]["dcCalc"+h[t].DisplayMember])),"-2"==h[t].DefaultValue&&(m=this.ScreenObject.GridDataColumns.Contains(h[t].DisplayMember.toLowerCase().replace("dcnum","dcExchRT"))&&!n.e.IsEmpty(this.ScreenObject.GridData[u][h[t].DisplayMember.toLowerCase().replace("dcnum","dcExchRT")])?parseFloat(this.ScreenObject.GridData[u][h[t].DisplayMember.toLowerCase().replace("dcnum","dcExchRT")]):1),n.e.Double(h[t].DefaultValue)>0&&(m=h[t].CurrID>0?h[t].ExhcgRt:1)),"Quantity"==h[t].DisplayMember)n.e.IsEmpty(this.ScreenObject.GridData[u].UOMConvertedQty)||n.e.IsEmpty(this.ScreenObject.GridData[u].Quantity)||0==parseFloat(this.ScreenObject.GridData[u].Quantity)||(d+=parseFloat(this.ScreenObject.GridData[u].UOMConvertedQty),S=d);else if(1!=h[t].IsCalculated&&h[t].IsColumnUserDefined)h[t].DisplayMember.Contains("dcNum")&&(n.e.IsEmpty(this.ScreenObject.GridData[u]["dcCalc"+h[t].DisplayMember])||(S+=parseFloat(this.ScreenObject.GridData[u]["dcCalc"+h[t].DisplayMember]),D+=parseFloat(this.ScreenObject.GridData[u]["dcCalc"+h[t].DisplayMember])*m),n.e.IsEmpty(this.ScreenObject.GridData[u][h[t].DisplayMember])||(d+=parseFloat(this.ScreenObject.GridData[u][h[t].DisplayMember])));else if(!n.e.IsEmpty(this.ScreenObject.GridData[u][h[t].DisplayMember]))if(67!=this.DocumentType||"dcNum1"!=h[t].DisplayMember&&"dcNum2"!=h[t].DisplayMember&&"dcNum4"!=h[t].DisplayMember&&"dcNum5"!=h[t].DisplayMember&&"dcNum7"!=h[t].DisplayMember&&"dcNum9"!=h[t].DisplayMember&&"dcNum11"!=h[t].DisplayMember&&"dcNum13"!=h[t].DisplayMember)d+=parseFloat(this.ScreenObject.GridData[u][h[t].DisplayMember]),D+=parseFloat(this.ScreenObject.GridData[u][h[t].DisplayMember])*m,S=d;else if(this.drcc1=this.ScreenObject.Data.Tables[0].filter(e=>e.CostCenterColID==h[t].ID),null!=this.drcc1&&this.drcc1.length>0)if(n.e.IsEmpty(this.drcc1[0].UserColumnType))d+=parseFloat(this.ScreenObject.GridData[u][h[t].DisplayMember]),D+=parseFloat(this.ScreenObject.GridData[u][h[t].DisplayMember])*m,S=d;else if(parseFloat(this.ScreenObject.GridData[u][h[t].DisplayMember])>0){let s=parseFloat(this.ScreenObject.GridData[u][h[t].DisplayMember]).ToTime("00.00").split(".");e=e.AddHours(parseFloat(s[0])),s.length>1&&(1==s[1].length&&(s[1]=s[1]+"0"),e=e.AddMinutes(parseFloat(s[1])));let i=e.getMinutes().toString();1==i.length&&(i="0"+i),d=parseFloat(24*(e.getDate()-1)+e.getHours()+"."+i),D=S=d}}if(1!=h[t].IsCalculated&&h[t].IsColumnUserDefined){if(0!=h[t].ShowbodyTotal)if(n.e.IsEmpty(h[t].DecimalPoints))if(1==h[t].ShowbodyTotal)h[t].footer=D.toString();else{let e=1;a.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(o.j)(a.a.SessionManager.Preferences["Use Foreign Currency"])&&this.Currency&&!n.e.IsEmpty(this.Currency.ExchangeRate.Text)&&(e=parseFloat(this.Currency.ExchangeRate.Text)),h[t].footer=0!=e?(D/e).toString():D.toString()}else if(1==h[t].ShowbodyTotal)h[t].footer=D.ToString("N"+h[t].DecimalPoints);else{let e=1;a.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(o.j)(a.a.SessionManager.Preferences["Use Foreign Currency"])&&this.Currency&&!n.e.IsEmpty(this.Currency.ExchangeRate.Text)&&(e=parseFloat(this.Currency.ExchangeRate.Text)),h[t].footer=0!=e?(D/e).ToString("N"+h[t].DecimalPoints):D.ToString("N"+h[t].DecimalPoints)}3==h[t].PostingType||4==h[t].PostingType?this.IsInventoryVoucher?1==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||6==this.ScreenObject.DocumentType||39==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||8==this.ScreenObject.DocumentType||31==this.ScreenObject.DocumentType?0==h[t].CrRefColID&&0==h[t].CreditAcount&&(this.GridNetTotal+=D):0==h[t].DrRefColID&&0==h[t].DebitAccount&&(this.GridNetTotal+=D):this.GridNetTotal+=D:this.IsInventoryVoucher||"Amount"!=h[t].DisplayMember&&"CreditAmount"!=h[t].DisplayMember||(this.GridNetTotal+=D)}else{if(0!=h[t].ShowbodyTotal)if("Quantity"==h[t].DisplayMember||"Rate"==h[t].DisplayMember)h[t].footer=n.e.IsEmpty(h[t].DecimalPoints)?d.toString():d.ToString("N"+h[t].DecimalPoints);else if(n.e.IsEmpty(h[t].DecimalPoints))if(1==h[t].ShowbodyTotal)h[t].footer=D.toString();else{let e=1;a.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(o.j)(a.a.SessionManager.Preferences["Use Foreign Currency"])&&this.Currency&&!n.e.IsEmpty(this.Currency.ExchangeRate.Text)&&(e=parseFloat(this.Currency.ExchangeRate.Text)),h[t].footer=0!=e?(D/e).toString():D.toString()}else if(1==h[t].ShowbodyTotal)h[t].footer=D.ToString("N"+h[t].DecimalPoints);else{let e=1;a.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(o.j)(a.a.SessionManager.Preferences["Use Foreign Currency"])&&this.Currency&&!n.e.IsEmpty(this.Currency.ExchangeRate.Text)&&(e=parseFloat(this.Currency.ExchangeRate.Text)),h[t].footer=0!=e?(D/e).ToString("N"+h[t].DecimalPoints):D.ToString("N"+h[t].DecimalPoints)}3==h[t].PostingType||4==h[t].PostingType?this.IsInventoryVoucher?1==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||6==this.ScreenObject.DocumentType||39==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||8==this.ScreenObject.DocumentType||31==this.ScreenObject.DocumentType?0==h[t].CrRefColID&&0==h[t].CreditAcount&&(this.GridNetTotal+=D):0==h[t].DrRefColID&&0==h[t].DebitAccount&&(this.GridNetTotal+=D):this.GridNetTotal+=D:this.IsInventoryVoucher||"Amount"!=h[t].DisplayMember&&"CreditAmount"!=h[t].DisplayMember||(this.GridNetTotal+=D)}this.fldDict.ContainsKey("Max"+h[t].lbl)&&this.fldDict["Max"+h[t].lbl].setFieldValue(s),this.fldDict.ContainsKey("MaxCalc"+h[t].lbl)&&this.fldDict["MaxCalc"+h[t].lbl].setFieldValue(r),this.fldDict.ContainsKey("Min"+h[t].lbl)&&this.fldDict["Min"+h[t].lbl].setFieldValue(i),this.fldDict.ContainsKey("MinCalc"+h[t].lbl)&&this.fldDict["MinCalc"+h[t].lbl].setFieldValue(c),this.FooterDics.ContainsKey("Max"+h[t].lbl)&&this.FooterDics["Max"+h[t].lbl].setFieldValue(s),this.FooterDics.ContainsKey("MaxCalc"+h[t].lbl)&&this.FooterDics["MaxCalc"+h[t].lbl].setFieldValue(r),this.FooterDics.ContainsKey("Min"+h[t].lbl)&&this.FooterDics["Min"+h[t].lbl].setFieldValue(i),this.FooterDics.ContainsKey("MinCalc"+h[t].lbl)&&this.FooterDics["MinCalc"+h[t].lbl].setFieldValue(c)}h[t].IsColumnUserDefined&&this.FooterDics.ContainsKey(h[t].lbl)?(this.FooterDics[h[t].lbl].setFieldValue(d),h[t].DisplayMember.Contains("dcNum")&&this.FooterDics.ContainsKey("Calc"+h[t].lbl)&&this.FooterDics["Calc"+h[t].lbl].setFieldValue(S)):"Gross"==h[t].DisplayMember&&this.FooterDics.ContainsKey("GROSS")?this.FooterDics.GROSS.setFieldValue(d):"Quantity"==h[t].DisplayMember&&this.FooterDics.ContainsKey("QTY")?this.FooterDics.QTY.setFieldValue(d):"FreeQTY"==h[t].DisplayMember&&this.FooterDics.ContainsKey("FreeQTY")?this.FooterDics.FreeQTY.setFieldValue(d):"Rate"==h[t].DisplayMember&&this.FooterDics.ContainsKey("RATE")?this.FooterDics.RATE.setFieldValue(d):this.FooterDics.ContainsKey(h[t].DisplayMember)&&this.FooterDics[h[t].DisplayMember].setFieldValue(d)}}i&&(this.ScreenObject.GridDataColumns.Contains("IsKit")&&null!=e&&"2"==e.IsKit.toString()&&this.CalcOpRate(),this.CalculateFooter(-1),this.RefreshNetAmount(),this.jvTotal(),this.UpdateFooter=!0)}this.ScreenObject.GridDataObj.UpdateFooter()}GetLineWiseValue(e){let t=0;for(let s=0;s<this.ScreenObject.GridData.length;s++)if(!n.e.IsEmpty(this.ScreenObject.GridData[s].ProductID_Key)){this.FillDictionary(this.ScreenObject.GridData[s],!1);let i=a.a.eval.EvaluateExpression(e,this.fldDict);!n.e.IsEmpty(i)&&"Infinity"!=i.toString()&&"-Infinity"!=i.toString()&&"NaN"!=i.toString()&&n.e.IsNum(i)&&(t+=parseFloat(i))}return t}CalculateFooter(e){if(this.IsInventoryVoucher)try{let t=this.FooterDics;if(null!=this.ScreenObject.FooterGridData&&this.ScreenObject.FooterGridData.length>0){let s="";for(let e=0;e<this.ScreenObject.FooterGridData.length;e++)s=n.e.String(this.ScreenObject.FooterGridData[e].Name).Replace(" ",""),this.FooterDics.ContainsKey(s)&&(n.e.IsEmpty(this.ScreenObject.FooterGridData[e].Amount)?this.FooterDics[s].setFieldValue(0):this.FooterDics[s].setFieldValue(this.ScreenObject.FooterGridData[e].Amount)),this.FooterDics.ContainsKey("Calc"+s)&&(n.e.IsEmpty(this.ScreenObject.FooterGridData[e].CalcAmount)?this.FooterDics["Calc"+s].setFieldValue(0):this.FooterDics["Calc"+s].setFieldValue(this.ScreenObject.FooterGridData[e].CalcAmount));this.FooterGridNetTotal=0;for(let i=0;i<this.ScreenObject.FooterGridData.length;i++){s=n.e.String(this.ScreenObject.FooterGridData[i].Name).Replace(" ","");let r=1;if(a.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(o.j)(a.a.SessionManager.Preferences["Use Foreign Currency"])){null!=this.Currency&&null!=this.Currency.ExchangeRate.Text&&""!=this.Currency.ExchangeRate.Text&&(r=parseFloat(this.Currency.ExchangeRate.Text));let e=this.ScreenObject.ColumnSource.find(e=>null!=e.DisplayMember&&e.DisplayMember==this.ScreenObject.FooterGridData[i].ColumnName);e&&("-2"==e.DefaultValue&&(r=n.e.IsEmpty(this.ScreenObject.FooterGridData[i].dcCurrID_Key)||n.e.IsEmpty(this.ScreenObject.FooterGridData[i].dcExchRT)?1:parseFloat(this.ScreenObject.FooterGridData[i].dcExchRT)),n.e.Double(e.DefaultValue)>0&&(r=e.CurrID>0?e.ExhcgRt:1))}if(n.e.IsEmpty(this.ScreenObject.FooterGridData[i].Formula))this.ScreenObject.FooterGridData[i].CalcAmount=this.ScreenObject.FooterGridData[i].Amount;else{let r=[];if(!n.e.IsEmpty(this.ScreenObject.FooterGridData[i].BasedOnXML)){let e=new n.f;e.LoadXml(this.ScreenObject.FooterGridData[i].BasedOnXML);let t=e.SelectNodes("Xml/Row");for(let s=0;s<t.length;s++){let e=t[s];if(null!=e.attributes.ColumnName&&!n.e.IsEmpty(e.attributes.ColumnName.value)&&null!=e.attributes.Formula&&!n.e.IsEmpty(e.attributes.Formula.value)){let t=this.ScreenObject.ColumnSource.find(t=>t.ID==e.attributes.ColumnName.value);if(t){r.push(t);let s=this.GetLineWiseValue(e.attributes.Formula.value);"Gross"==t.DisplayMember?this.FooterDics.GROSS.setFieldValue(s):"Quantity"==t.DisplayMember?this.FooterDics.QTY.setFieldValue(s):"Rate"==t.DisplayMember?this.FooterDics.RATE.setFieldValue(s):this.FooterDics.ContainsKey(t.lbl)&&this.FooterDics[t.lbl].setFieldValue(s)}}}}if("2"==this.ScreenObject.FooterGridData[i].IsCalculated){let e=this.GetLineWiseValue(this.ScreenObject.FooterGridData[i].Formula.toString());this.ScreenObject.FooterGridData[i].Amount=parseFloat(e.toString()).ToString("N"+this.ScreenObject.FooterGridData[i].Decimals.toString()),this.ScreenObject.FooterGridData[i].CalcAmount=this.ScreenObject.FooterGridData[i].Amount}else if("1"==this.ScreenObject.FooterGridData[i].IsCalculated){let e=a.a.eval.EvaluateExpression(this.ScreenObject.FooterGridData[i].Formula.toString(),t);this.ScreenObject.FooterGridData[i].Amount=null!=e&&!n.e.IsEmpty(e)&&"Infinity"!=e.toString()&&"-Infinity"!=e.toString()&&"NaN"!=e.toString()&&n.e.IsNum(e)?parseFloat(e.toString()).ToString("N"+this.ScreenObject.FooterGridData[i].Decimals.toString()):0,this.ScreenObject.FooterGridData[i].CalcAmount=this.ScreenObject.FooterGridData[i].Amount}else if(e==i&&this.ScreenObject.FooterGridData[i].Formula.toString().Contains("%")){let e,r;this.FooterDics[s].setFieldValue(1),e=n.e.Double(a.a.eval.EvaluateExpression(this.ScreenObject.FooterGridData[i].Formula.toString(),t).toString()),r=n.e.Double(this.ScreenObject.FooterGridData[i].CalcAmount),0!=e&&(e=r/e),this.ScreenObject.FooterGridData[i].Amount=parseFloat(e.toString()).ToString("N"+this.ScreenObject.FooterGridData[i].Decimals.toString())}else{let e=a.a.eval.EvaluateExpression(this.ScreenObject.FooterGridData[i].Formula.toString(),t);this.ScreenObject.FooterGridData[i].CalcAmount=null!=e&&!n.e.IsEmpty(e)&&"Infinity"!=e.toString()&&"-Infinity"!=e.toString()&&"NaN"!=e.toString()&&n.e.IsNum(e)?parseFloat(e.toString()).ToString("N"+this.ScreenObject.FooterGridData[i].Decimals.toString()):0}r.length>0&&r.forEach(e=>{let t=0;for(let s=0;s<this.ScreenObject.GridData.length;s++)n.e.IsEmpty(this.ScreenObject.GridData[s].ProductID_Key)||!n.e.IsEmpty(this.ScreenObject.GridData[s][e.DisplayMember])&&n.e.IsNum(this.ScreenObject.GridData[s][e.DisplayMember])&&(t+=parseFloat(this.ScreenObject.GridData[s][e.DisplayMember]));"Gross"==e.DisplayMember?this.FooterDics.GROSS.setFieldValue(t):"Quantity"==e.DisplayMember?this.FooterDics.QTY.setFieldValue(t):"Rate"==e.DisplayMember?this.FooterDics.RATE.setFieldValue(t):this.FooterDics.ContainsKey(e.lbl)&&this.FooterDics[e.lbl].setFieldValue(t)})}this.FooterDics.ContainsKey(s)&&(n.e.IsEmpty(this.ScreenObject.FooterGridData[i].Amount)?this.FooterDics[s].setFieldValue(0):this.FooterDics[s].setFieldValue(this.ScreenObject.FooterGridData[i].Amount.toString())),this.FooterDics.ContainsKey("Calc"+s)&&(n.e.IsEmpty(this.ScreenObject.FooterGridData[i].CalcAmount)?this.FooterDics["Calc"+s].setFieldValue(0):this.FooterDics["Calc"+s].setFieldValue(this.ScreenObject.FooterGridData[i].CalcAmount.toString())),this.FooterDics.ContainsKey(s+"EXRT")&&this.FooterDics[s+"EXRT"].setFieldValue(r),null==this.ScreenObject.FooterGridData[i].CalcAmount||n.e.IsEmpty(this.ScreenObject.FooterGridData[i].CalcAmount)||null==this.ScreenObject.FooterGridData[i].PostingType||n.e.IsEmpty(this.ScreenObject.FooterGridData[i].PostingType)||3!=parseInt(this.ScreenObject.FooterGridData[i].PostingType)&&4!=parseInt(this.ScreenObject.FooterGridData[i].PostingType)||(this.FooterGridNetTotal+=parseFloat(this.ScreenObject.FooterGridData[i].CalcAmount)*r),this.ScreenObject.FooterGridDataObj.updateRow(this.ScreenObject.FooterGridData[i])}}if(null!=this.ScreenObject.DocPrefix&&!n.e.IsNullOrWhiteSpace(this.ScreenObject.DocPrefix.Formula)){this.GridNetTotal=0,this.FooterGridNetTotal=0;let e=a.a.eval.EvaluateExpression(this.ScreenObject.DocPrefix.Formula,t);n.e.IsNum(e)&&(this.FooterGridNetTotal=parseFloat(e))}this.RefreshNetAmount(),this.CalcTextFields()}catch(t){this.DisplayMessage="Problem processing document try again",Logger.ErrorLog("Addeditdocumentviewmodel","footer calculation",t.stack)}else this.CalcTextFields()}CalcTextFields(){try{let e=this.FooterDics;if(this.ScreenObject._TextFields.forEach(t=>{let s,i=this.ScreenObject.Data.Tables[0].filter(e=>e.CostCenterColID==t.DBColumnID&&null!=e.LocalReference&&79==e.LocalReference&&53580==e.LinkData);if(i.length>0&&null!=this.fldDict&&n.e.isValidDate(this.fldDict.ServerDate.fieldResult)&&(s=new Date(this.fldDict.ServerDate.fieldResult),t instanceof d.b||t instanceof d.c?t.Date=s:t instanceof u.d&&(t.Text=s.ToString(a.a.SessionManager.Preferences["Date Format"]))),i=this.ScreenObject.Data.Tables[0].filter(e=>e.CostCenterColI==t.DBColumnID&&null!=e.LocalReference&&79==e.LocalReference&&(55496==e.LinkData||55495==e.LinkData)),i.length>0&&(s=new Date,t instanceof d.b||t instanceof d.c?(t.Date=s,this.FooterDics.ContainsKey(t.Lbl)&&t.Date&&this.FooterDics[t.Lbl].setFieldValue(t.Date)):t instanceof u.d&&(t.Text=s.ToString(a.a.SessionManager.Preferences["Date Format"]),this.FooterDics.ContainsKey(t.Lbl)&&this.FooterDics[t.Lbl].setFieldValue(t.Text))),!n.e.IsEmpty(t.Formula)){let s=a.a.eval.EvaluateExpression(t.Formula,e);t instanceof u.d&&"FLOAT"==t.DataType?(t.Text=n.e.IsNum(s)?n.e.IsEmpty(t.DecimalPoints)?parseFloat(s).ToString("N"+a.a.SessionManager.Preferences.DecimalsinExtraFields):parseFloat(s).ToString("N"+t.DecimalPoints):"0",this.FooterDics.ContainsKey(t.Lbl)&&this.FooterDics[t.Lbl].setFieldValue(t.Text)):t instanceof u.d?(t.Text=null!=s?s.toString():"",this.FooterDics.ContainsKey(t.Lbl)&&this.FooterDics[t.Lbl].setFieldValue(t.Text)):t instanceof d.c&&(t.Date=null!=s&&n.e.isValidDate(s)?new Date(s):null,this.FooterDics.ContainsKey(t.Lbl)&&t.Date&&this.FooterDics[t.Lbl].setFieldValue(t.Date))}if(57==this.ScreenObject.DocumentType&&"dcalpha3"==t.DBColumnName.toLowerCase()){let e=this.ColumnSource.find(e=>e.DisplayMember.toLowerCase().Contains("dcnum3"));null!=e&&(t.Text=this.FooterDics[e.lbl].fieldResult.fieldResult.toString())}}),null!=this.ScreenObject.DueDate&&!n.e.IsEmpty(this.ScreenObject.DueDate.Formula)){let t=a.a.eval.EvaluateExpression(this.ScreenObject.DueDate.Formula,e);null!=t&&n.e.isValidDate(t)&&(this.ScreenObject.DueDate.Date=new Date(t)),this.FooterDics.ContainsKey("DUEDATE")&&this.ScreenObject.DueDate.Date&&this.FooterDics.DUEDATE.setFieldValue(this.ScreenObject.DueDate.Date)}if(!this.IsInventoryVoucher&&null!=this.ScreenObject.DocPrefix&&!n.e.IsEmpty(this.ScreenObject.DocPrefix.Formula)&&""!=this.ScreenObject.DocPrefix.Formula.trim()){this.GridNetTotal=0,this.FooterGridNetTotal=0;let t=a.a.eval.EvaluateExpression(this.ScreenObject.DocPrefix.Formula,e);n.e.IsNum(t)&&(this.FooterGridNetTotal=parseFloat(t)),this.RefreshNetAmount()}}catch(e){this.DisplayMessage="Problem processing document try again",Logger.ErrorLog("Addeditdocumentviewmodel","footer calculation",e.stack)}}FillCreatedByDate_ds(e){if(!(0==this.ScreenObject.Data.Tables.length||null==e||0==e.Tables.length||e.Tables.length>0&&0==e.Tables[0].length)&&this.ScreenObject.Data.Tables[0].length>0){let t=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&24060==e.LinkData);if(t.length>0&&e.Columns[0].Contains("CreatedBy")){if(this.ScreenObject.GridDataColumns.Contains(t[0].SysColumnName))for(let i=0;i<this.ScreenObject.GridData.length;i++)(this.IsInventoryVoucher&&!n.e.IsEmpty(this.ScreenObject.GridData[i].ProductID_Key)||!this.IsInventoryVoucher&&(this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[i].AccountID_Key)||this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[i].DebitAccount_Key)||this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[i].CreditAccount_Key)))&&(this.ScreenObject.GridData[i][t[0].SysColumnName]=e.Tables[0][0].CreatedBy.toString());let s=this.ScreenObject._TextFields.find(e=>e.DBColumnName==t[0].SysColumnName);s&&s instanceof u.d&&e.Columns[0].Contains("CreatedBy")&&(s.Text=e.Tables[0][0].CreatedBy.toString())}if(t=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&24061==e.LinkData),t.length>0){if(this.ScreenObject.GridDataColumns.Contains(t[0].SysColumnName)&&e.Columns[0].Contains("CreatedDate"))for(let i=0;i<this.ScreenObject.GridData.length;i++)(this.IsInventoryVoucher&&!n.e.IsEmpty(this.ScreenObject.GridData[i].ProductID_Key)||!this.IsInventoryVoucher&&(this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[i].AccountID_Key)||this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[i].DebitAccount_Key)||this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[i].CreditAccount_Key)))&&("Date"==t[0].UserColumnType.toString()?(this.ScreenObject.GridData[i][t[0].SysColumnName]=new Date(e.Tables[0][0].CreatedDate).ToString(a.a.SessionManager.Preferences["Date Format"]),this.ScreenObject.GridData[i][t[0].SysColumnName+"_Key"]=new Date(e.Tables[0][0].CreatedDate)):"DateTime"==t[0].UserColumnType.toString()?(this.ScreenObject.GridData[i][t[0].SysColumnName]=new Date(e.Tables[0][0].CreatedDate).ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm a"),this.ScreenObject.GridData[i][t[0].SysColumnName+"_Key"]=new Date(e.Tables[0][0].CreatedDate)):"Time"==t[0].UserColumnType.toString()?(this.ScreenObject.GridData[i][t[0].SysColumnName]=new Date(e.Tables[0][0].CreatedDate).ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss tt"),this.ScreenObject.GridData[i][t[0].SysColumnName+"_Key"]=new Date(e.Tables[0][0].CreatedDate)):this.ScreenObject.GridData[i][t[0].SysColumnName]=new Date(e.Tables[0][0].CreatedDate).ToString(a.a.SessionManager.Preferences["Date Format"]));let s=this.ScreenObject._TextFields.find(e=>e.DBColumnName==t[0].SysColumnName);s&&e.Columns[0].Contains("CreatedDate")&&(s instanceof u.d?s.Text=new Date(e.Tables[0][0].CreatedDate).ToString(a.a.SessionManager.Preferences["Date Format"]):s instanceof d.c&&(s.Date=new Date(e.Tables[0][0].CreatedDate)),s instanceof d.b&&(s.Date=new Date(e.Tables[0][0].CreatedDate)))}}}AddAddress(e){if(null!=this.AssignAddress&&e.Tables.length>11&&e.Tables[11].length>0){let t,s;this.AssignAddress.IsEditing=!0,null!=this.ScreenObject.DebitAccount&&(s=e.Tables[11].filter(e=>3==e.AddressTypeID&&e.FEATUREPK==this.ScreenObject.DebitAccount.SelectedValue),t=e.Tables[10].filter(e=>3==e.AddressTypeID),this.AssignAddress.ShipTo.push(D.d.ComboBoxItems_2("","")),s.forEach(e=>{this.AssignAddress.ShipTo.push(D.d.ComboBoxItems_2(e.AddressName.toString(),e.AddressID.toString())),t.length>0&&t[0].addressid.toString()==e.AddressID.toString()&&(this.AssignAddress.SelectedShipTo=e.AddressID.toString(),this.AssignAddress.SAddressName.Text=n.e.String(e.ContactPerson),this.AssignAddress.SAddress1.Text=n.e.String(e.Address1)+" "+n.e.String(e.Address2)+" "+n.e.String(e.Address3),this.AssignAddress.SAddressCity.Text=n.e.String(e.City)+" "+n.e.String(e.State)+" "+n.e.String(e.Zip),this.AssignAddress.SPhone1.Text=n.e.String(e.Phone1),this.AssignAddress.ShipToVisibility=!0)})),this.ScreenObject.IsPurchase?null!=this.ScreenObject.CreditAccount&&(s=e.Tables[11].filter(e=>e.AddressTypeID=e.FEATUREPK==this.ScreenObject.CreditAccount.SelectedValue),t=e.Tables[10].filter(e=>2==e.AddressTypeID),this.AssignAddress.BillTo.push(D.d.ComboBoxItems_2("","")),s.forEach(e=>{this.AssignAddress.BillTo.push(D.d.ComboBoxItems_2(e.AddressName.toString(),e.AddressID.toString())),t.length>0&&t[0].addressid.toString()==e.AddressID.toString()&&(this.AssignAddress.SelectedBillTo=e.AddressID.toString(),this.AssignAddress.AddressName.Text=n.e.String(e.ContactPerson),this.AssignAddress.Address1.Text=n.e.String(e.Address1)+" "+n.e.String(e.Address2)+" "+n.e.String(e.Address3),this.AssignAddress.Phone1.Text=n.e.String(e.Phone1),this.AssignAddress.AddressCity.Text=n.e.String(e.City)+" "+n.e.String(e.State)+" "+n.e.String(e.Zip),this.AssignAddress.BillToVisibility=!0)}),s=e.Tables[11].filter(e=>1==e.AddressTypeID&&e.FEATUREPK==this.ScreenObject.CreditAccount.SelectedValue),t=e.Tables[10].filter(e=>1==e.AddressTypeID),this.AssignAddress.AddressTo.push(D.d.ComboBoxItems_2("","")),s.forEach(e=>{this.AssignAddress.AddressTo.push(D.d.ComboBoxItems_2(e.AddressName.toString(),e.AddressID.toString())),t.length>0&&t[0].addressid.toString()==e.AddressID.toString()&&(this.AssignAddress.SelectedAddressTo=e.AddressID.toString(),this.AssignAddress.AddressToName.Text=n.e.String(e.ContactPerson),this.AssignAddress.AddressTo1.Text=n.e.String(e.Address1)+" "+n.e.String(e.Address2)+" "+n.e.String(e.Address3),this.AssignAddress.PhoneTo1.Text=n.e.String(e.Phone1),this.AssignAddress.AddressToCity.Text=n.e.String(e.City)+" "+n.e.String(e.State)+" "+n.e.String(e.Zip),this.AssignAddress.AddressToVisbility=!0)}),s=e.Tables[11].filter(e=>3==e.AddressTypeID&&e.FEATUREPK==this.ScreenObject.CreditAccount.SelectedValue),t=e.Tables[10].filter(e=>3==e.AddressTypeID),this.AssignAddress.ShipTo.push(D.d.ComboBoxItems_2("","")),s.forEach(e=>{this.AssignAddress.ShipTo.push(D.d.ComboBoxItems_2(e.AddressName.toString(),e.AddressID.toString())),t.length>0&&t[0].AddressID.toString()==e.AddressID.toString()&&(this.AssignAddress.SelectedShipTo=e.AddressID.toString(),this.AssignAddress.SAddressName.Text=e.ContactPerson.toString(),this.AssignAddress.SAddress1.Text=e.Address1.toString()+" "+e.Address2.toString()+" "+e.Address3.toString(),this.AssignAddress.SAddressCity.Text=e.City.toString()+" "+e.State.toString()+" "+e.Zip.toString(),this.AssignAddress.SPhone1.Text=e.Phone1.toString(),this.AssignAddress.ShipToVisibility=!0)})):null!=this.ScreenObject.DebitAccount&&(s=e.Tables[11].filter(e=>2==e.AddressTypeID&&e.FEATUREPK==this.ScreenObject.DebitAccount.SelectedValue),t=e.Tables[10].filter(e=>2==e.AddressTypeID),this.AssignAddress.BillTo.push(D.d.ComboBoxItems_2("","")),s.forEach(e=>{this.AssignAddress.BillTo.push(D.d.ComboBoxItems_2(e.AddressName.toString(),e.AddressID.toString())),t.length>0&&t[0].addressid.toString()==e.AddressID.toString()&&(this.AssignAddress.SelectedBillTo=e.AddressID.toString(),this.AssignAddress.AddressName.Text=n.e.String(e.ContactPerson),this.AssignAddress.Address1.Text=n.e.String(e.Address1)+" "+n.e.String(e.Address2)+" "+n.e.String(e.Address3),this.AssignAddress.Phone1.Text=n.e.String(e.Phone1),this.AssignAddress.AddressCity.Text=n.e.String(e.City)+" "+n.e.String(e.State)+" "+n.e.String(e.Zip),this.AssignAddress.BillToVisibility=!0)}),s=e.Tables[11].filter(e=>e.AddressTypeID=e.FEATUREPK==this.ScreenObject.DebitAccount.SelectedValue),t=e.Tables[10].filter(e=>1==e.AddressTypeID),this.AssignAddress.AddressTo.push(D.d.ComboBoxItems_2("","")),s.forEach(e=>{this.AssignAddress.AddressTo.push(D.d.ComboBoxItems_2(e.AddressName.toString(),e.AddressID.toString())),t.length>0&&t[0].addressid.toString()==e.AddressID.toString()&&(this.AssignAddress.SelectedAddressTo=e.AddressID.toString(),this.AssignAddress.AddressToName.Text=n.e.String(e.ContactPerson),this.AssignAddress.AddressTo1.Text=n.e.String(e.Address1)+" "+n.e.String(e.Address2)+" "+n.e.String(e.Address3),this.AssignAddress.PhoneTo1.Text=n.e.String(e.Phone1),this.AssignAddress.AddressToCity.Text=n.e.String(e.City)+" "+n.e.String(e.State)+" "+n.e.String(e.Zip),this.AssignAddress.AddressToVisbility=!0)})),this.AssignAddress.IsEditing=!1}}CheckViewOnLoad(){try{let e=this.ScreenObject.Data.Tables[10].filter(e=>6==e.Mode);e.forEach(e=>{n.e.IsEmpty(e.Expression)||n.e.IsEmpty(e.ActionOptionID)||"1"==a.a.eval.EvaluateExpression(e.Expression.toString(),this.FooterDics).toString().toString()&&("4"==e.ActionOptionID.toString()&&(this.ScreenObject.DocID=0,this.ScreenObject.VoucherNo="",this.clear(1)),alert(e.FailureMessage.toString()))}),e=this.ScreenObject.Data.Tables[10].filter(null!=this.ScreenObject.Link&&"[Open]"!=this.ScreenObject.Link.LinkStatus?369==this.StatusID?e=>-2==e.CostCenterColID&&(2==e.Mode||3==e.Mode||4==e.Mode||5==e.Mode):e=>-2==e.CostCenterColID&&(2==e.Mode||3==e.Mode||5==e.Mode):369==this.StatusID?e=>-2==e.CostCenterColID&&(2==e.Mode||3==e.Mode||4==e.Mode):e=>-2==e.CostCenterColID&&(2==e.Mode||3==e.Mode)),e.length>0?(this.BodyVisible=Object(o.j)(e[0].IsVisible),this.ReadOnlyBody=!Object(o.j)(e[0].IsEditable)):(this.BodyVisible=!0,this.ReadOnlyBody=!1,this.ReadOnlyBody=!(!this.ScreenObject.Preferences.ContainsKey("Lock Body")||""==this.ScreenObject.Preferences["Lock Body"]||!Object(o.j)(this.ScreenObject.Preferences["Lock Body"]))),this.IsInventoryVoucher&&null!=this.AssignAddress&&(this.AssignAddress.BillsVisibe=!!this.ScreenObject.Preferences.ContainsKey("BillingAddress")&&Object(o.j)(this.ScreenObject.Preferences.BillingAddress),this.AssignAddress.ShipVisibe=!!this.ScreenObject.Preferences.ContainsKey("ShippingAddress")&&Object(o.j)(this.ScreenObject.Preferences.ShippingAddress),this.AssignAddress.PrimVisibe=!!this.ScreenObject.Preferences.ContainsKey("PrimaryAddress")&&Object(o.j)(this.ScreenObject.Preferences.PrimaryAddress),e=this.ScreenObject.Data.Tables[10].length>0?this.ScreenObject.Data.Tables[10].filter(e=>-6==e.CostCenterColID&&(2==e.Mode||3==e.Mode)):[],this.AssignAddress.PrimVisibe&&e.length>0?(this.AssignAddress.PrimVisibe=Object(o.j)(e[0].IsVisible),this.AssignAddress.PrimMandatory=Object(o.j)(e[0].IsMandatory)):this.AssignAddress.PrimMandatory=!1,e=this.ScreenObject.Data.Tables[10].length>0?this.ScreenObject.Data.Tables[10].filter(e=>-7==e.CostCenterColID&&(2==e.Mode||3==e.Mode)):[],this.AssignAddress.BillsVisibe&&e.length>0?(this.AssignAddress.BillsVisibe=Object(o.j)(e[0].IsVisible),this.AssignAddress.BillsMandatory=Object(o.j)(e[0].IsMandatory)):this.AssignAddress.BillsMandatory=!1,e=this.ScreenObject.Data.Tables[10].length>0?this.ScreenObject.Data.Tables[10].filter(e=>-8==e.CostCenterColID&&(2==e.Mode||3==e.Mode)):[],this.AssignAddress.ShipVisibe&&e.length>0?(this.AssignAddress.ShipVisibe=Object(o.j)(e[0].IsVisible),this.AssignAddress.ShipMandatory=Object(o.j)(e[0].IsMandatory)):this.AssignAddress.ShipMandatory=!1)}catch(e){}}Addguid(){if(this.ScreenObject.GridDataColumns.Contains("StyleHeightZero")?this.ScreenObject.GridDataColumns.push("tempcol"):this.ScreenObject.GridDataColumns.push("StyleHeightZero"),this.ScreenObject.Preferences.ContainsKey("DbCrBills")&&"True"==n.e.String(this.ScreenObject.Preferences.DbCrBills)){let t="";this.ScreenObject.Preferences.ContainsKey("DbCrBills")&&"True"==this.ScreenObject.Preferences.DbCrBills.toString()&&this.ScreenObject.Preferences.ContainsKey("NetAmountFld")&&""!=this.ScreenObject.Preferences.NetAmountFld&&(t=this.ScreenObject.Preferences.NetAmountFld),this.ScreenObject.GridDataColumns.Contains("guidCol")||this.ScreenObject.GridDataColumns.push("guidCol");let s="";s=18==this.ScreenObject.DocumentType||19==this.ScreenObject.DocumentType||21==this.ScreenObject.DocumentType||22==this.ScreenObject.DocumentType?"CreditAccount_Key":14==this.ScreenObject.DocumentType||15==this.ScreenObject.DocumentType||20==this.ScreenObject.DocumentType||23==this.ScreenObject.DocumentType?"DebitAccount_Key":"AccountID_Key";for(let i=0;i<this.ScreenObject.GridData.length;i++)if(!n.e.IsEmpty(this.ScreenObject.GridData[i].Amount)&&parseFloat(this.ScreenObject.GridData[i].Amount.toString())>0){var e=this.ScreenObject.GridData.filter(e=>e[s]==n.e.String(this.ScreenObject.GridData[i][s])&&e.Amount<0&&null==e.guidCol);e.length>0&&(this.ScreenObject.GridData[i].guidCol=n.e.NewGuid(),e[0].guidCol=this.ScreenObject.GridData[i].guidCol.toString(),""!=t&&(e[0].StyleHeightZero=1))}}this.ScreenObject.UpdateSequence(),this.ScreenObject.GridDataColumns.Contains("tempcol")&&this.ScreenObject.GridDataColumns.Remove("tempcol")}LoadEditCallBack(e){let t,s=this.GetButton("Submit"),i=this.GetButton("History");if(this.WfID=0,this.WorkFlowDocLevel=0,this.IsLocked=!1,this.IsReplaced=0,this.LCDueAmt=0,s.Visible=!1,this.ChkRtnXml="",this.DisplayMessage="",this.MessageVisibility=!1,this.IsUserLock=!1,this.ArApBills="",null!=this.pdcGCVM&&(this.pdcGCVM=new ue.a(this)),this.ScreenObject.Preferences.ContainsKey("DbCrBills")&&"True"==n.e.String(this.ScreenObject.Preferences.DbCrBills)&&this.Addguid(),!this.IsInventoryVoucher&&16!=this.DocumentType&&e.Columns[0].Contains("Description")&&e.Tables[0].length>0&&!n.e.IsEmpty(e.Tables[0][0].Description)&&this.pdcGCVM.loadFromxml(e.Tables[0][0].Description.toString(),this.ScreenObject.GridData[0].Amount.toString()),56==this.ScreenObject.DocumentType&&this.LoanGuaranteeVisible){this.dtLoanGuarantees=null;let e=a.a.common.GetDataSet("PAY051",this.DocID.toString()).Tables[0];if(null!=e&&e.length>0){let t;this.dtLoanGuarantees=[];for(let s=0;s<e.length;s++)t={},t.GEmpSeqNo=e[s].GEmpSeqNo.toString(),this.dtLoanGuarantees.push(t)}}if(61==this.ScreenObject.DocumentType){this.dtVacDefineDays=null;let e=a.a.common.GetDataSet("PAY052",this.DocID.toString()).Tables[0];if(null!=e&&e.length>0){let t;this.dtVacDefineDays=[];for(let s=0;s<e.length;s++)t={},t.SNo=e[s].SNo.toString(),t.FromMonth=e[s].FromMonth.toString(),t.ToMonth=e[s].ToMonth.toString(),t.DaysPerMonth=e[s].DaysPerMonth.toString(),t.ApplyToPrevMonths=e[s].ApplyToPrevMonths.toString(),this.dtVacDefineDays.push(t)}}62==this.ScreenObject.DocumentType&&(this.dtData=e.Tables[1]),this.FillCreatedByDate_ds(e),null!=this.Currency&&null!=this.Currency.Currency&&null!=this.Currency.Currency.SelectedValue&&(this.lastCurr=this.Currency.Currency.SelectedValue),this.ButtonApprove.Visible=!1,null!=this.ViewNotes&&this.ViewNotes.NotesListObj.Clear(),null!=this.DtPack&&this.DtPack.Clear(),null!=this.ViewAttachments&&this.ViewAttachments.AttachmentsListObj.Clear(),null!=this.grdLinkTab&&(this.grdLinkTab.Clear(),this.grdLinkTab.loadGrid(this.ScreenObject.VoucherNo),this.grdLinkTab.linkTabs.Pages.map(e=>e.IsAccordionOpen=this.ScreenObject.Preferences.ContainsKey("OpenAllSection")&&"True"==this.ScreenObject.Preferences.OpenAllSection)),null!=this.ViewActivities&&this.ViewActivities.ActivityGridDataObj.Clear(),null!=this.Activities&&this.Activities.ClearFields(),null!=this.AssignAddress&&(this.AssignAddress.AddressTo.Clear(),this.AssignAddress.BillTo.Clear(),this.AssignAddress.ShipTo.Clear()),null!=this.ViewOrganizationViewModel&&this.ViewOrganizationViewModel.OrganizationData.Clear(),this.ScreenObject.IsForecast&&this.ScreenObject.GridDataObj.RefreshColumns(),this.StatusID=parseInt(e.Tables[0][0].StatusID),e.Columns[0].Contains("WorkFlowLevel")&&null!=e.Tables[0][0].WorkFlowLevel&&372!=this.StatusID&&(this.WorkFlowDocLevel=parseInt(e.Tables[0][0].WorkFlowLevel)),null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&e.Columns[0].Contains("DocNumber")&&e.Tables[0][0].DocNumber.toString()!=this.ScreenObject.DocPrefix.TextBox.Text&&(this.ScreenObject.DocPrefix.TextBox.Text=e.Tables[0][0].DocNumber.toString()),null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&e.Columns[0].Contains("DocDate")&&!n.e.IsEmpty(e.Tables[0][0].DocDate)&&(this._Ddate=new Date(e.Tables[0][0].DocDate),this.ScreenObject.DocDate.Date=this.DocumentDate,38!=this.ScreenObject.DocumentType&&this.ScreenObject.SetView(this.ScreenObject.DocDate,this.StatusID));let r=this.GetButton("GST");null!=r&&(this.IsInventoryVoucher&&369==this.StatusID?a.a.SessionManager.HideUnathorizedAccess?r.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"GST"):r.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"GST"):r.Visible=!1);let l=this.GetButton("API");null!=l&&(369==this.StatusID?a.a.SessionManager.HideUnathorizedAccess?l.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"API"):l.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"API"):l.Visible=!1);let c=this.GetButton("Generate");if(this.IsInventoryVoucher){null!=c&&(c.Visible=!(e.Columns[0].Contains("LinkStatusID")&&0==e.Tables[0].filter(e=>445!=e.LinkStatusID).length||369!=this.StatusID&&(372!=this.StatusID||!this.ScreenObject.Preferences.ContainsKey("LinkUnposted")||""==this.ScreenObject.Preferences.LinkUnposted||!Object(o.j)(this.ScreenObject.Preferences.LinkUnposted))));let t,s=this.GetButton("Advance");if(369==this.StatusID&&null!=s?s.Visible=!0:null!=s&&(s.Visible=!1),this.IsEdit&&null!=this.ScreenObject.Link&&null!=this.ScreenObject.Link.LinkCombo&&null!=this.ScreenObject.Link.LinkCombo.SelectedValue&&""!=this.ScreenObject.Link.LinkCombo.SelectedValue&&parseInt(this.ScreenObject.Link.LinkCombo.SelectedValue)>0&&(this.IsEdit=!1,this.OLinkSelectionChanged("")),e.Tables.length>0&&e.Columns[0].Contains("IsQtyIgnored")&&e.Tables[0].length>0&&!n.e.IsEmpty(this.donotupInv))for(let i=0;i<e.Tables[0].length;i++)if("6"!=e.Tables[0][i].ProductTypeID.toString()&&"8"!=e.Tables[0][i].ProductTypeID.toString()&&"3"!=e.Tables[0][i].ProductTypeID.toString()){n.e.IsEmpty(e.Tables[0][i].IsQtyIgnored)||(this.donotupInv.IsChecked=Object(o.j)(e.Tables[0][i].IsQtyIgnored));break}if(this.linkStatusRemarks=e.Tables.length>0&&e.Columns[0].Contains("LinkStatusRemarks")&&e.Tables[0].length>0&&!n.e.IsEmpty(e.Tables[0][0].LinkStatusRemarks)?e.Tables[0][0].LinkStatusRemarks.toString():"",null!=this.ViewNotes&&e.Tables.length>7&&this.ViewNotes.LoadNotes(e.Tables[7]),null!=this.ViewAttachments&&e.Tables.length>8&&this.ViewAttachments.LoadAttachments(e.Tables[8],e.Tables[0]),e.Tables.length>9&&(null!=this.ViewActivities?(this.ViewActivities.NodeID=this.DocID,this.ViewActivities.LoadActivityData(e.Tables[9])):e.Tables[9].length>0&&(this.ViewActivities.NodeID=this.DocID,this.NodeID=this.DocID,this.ViewActivities.CloseVisible=!0,this.ViewActivities.LoadActivityData(e.Tables[9]))),this.AddAddress(e),this.ScreenObject.Data.Tables[0].length>0&&this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&(t=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&50455==e.LinkData),t.length>0&&this.ScreenObject.GridDataColumns.Contains(t[0].SysColumnName)&&this.ScreenObject.GridData.forEach(e=>{n.e.IsEmpty(e.ProductID_Key)||this.CalculateTotals(e,!1)})),e.Tables.length>15&&e.Columns[15].Contains("Amount")){let t="";if(e.Tables[15].length>0){t+="<Paymentterms>";for(let s=0;s<e.Tables[15].length;s++)n.e.IsEmpty(e.Tables[15][s].Amount)||(t+="<Row ",t+=' Percentage="'+e.Tables[15][s].Percentage.toString()+'" ',t+=' BasedOn="'+e.Tables[15][s].BasedOn.toString()+'" ',t+=' Period="'+e.Tables[15][s].Period.toString()+'" ',n.e.IsEmpty(e.Tables[15][s].BaseDate)||(t+=' BaseDate="'+new Date(e.Tables[15][s].BaseDate).ToString("dd/MMM/yyyy")+'" '),e.Columns[15].Contains("ProfileID")&&!n.e.IsEmpty(e.Tables[15][s].ProfileID)&&(t+=' ProfileId="'+e.Tables[15][s].ProfileID.toString()+'" ',t+=' ProfileName="'+n.e.String(e.Tables[15][s].ProfileName)+'" '),n.e.IsEmpty(e.Tables[15][s].DimCCID)||(t+=' DimCCID="'+e.Tables[15][s].DimCCID.toString()+'" '),n.e.IsEmpty(e.Tables[15][s].DimNodeID)||(t+=' DimNodeID="'+e.Tables[15][s].DimNodeID.toString()+'" '),t+=' Accountid="'+e.Tables[15][s].AccountID.toString()+'" ',t+=' Amount="'+e.Tables[15][s].Amount.toString()+'" ',n.e.IsEmpty(e.Columns[15].Contains("AmountFC")&&e.Tables[15][s].AmountFC)||(t+=' AmountFC="'+e.Tables[15][s].AmountFC.toString()+'" '),t+=' Days="'+e.Tables[15][s].days.toString()+'" ',n.e.IsEmpty(e.Tables[15][s].DueDate)||(t+=' DueDate="'+new Date(e.Tables[15][s].DueDate).ToString("dd/MMM/yyyy")+'" '),t+=' Remarks="'+u.d.GetValidXml(e.Tables[15][s].Remarts)+'" ',t+=" /> ");t+="</Paymentterms>",this.payTermXml=t}}if(null!=e&&e.Tables.length>27&&e.Tables[27].length>0&&e.Columns[27].Contains("Refdocno")){let t="";for(let s=0;s<e.Tables[27].length;s++)t+='<NonAccRows  RefDocNo="'+e.Tables[27][s].Refdocno.toString()+'" Amount="',t+=e.Tables[27][s].Amount.toString()+'" ',38!=this.DocumentType&&(t+='AccountID="'+e.Tables[27][s].AccountID.toString()+'" '),t+=" />";this.ArApBills=t}if(e.Tables.length>23&&e.Tables[23].length>0&&e.Columns[23].Contains("AdjAmount")){let t="";t+="<ChkRtnXML>";for(let s=0;s<e.Tables[23].length;s++)n.e.IsEmpty(e.Tables[23][s].AdjAmount)||(t+="<Row ",t+='DocSeqNo="1" ',t+=' AccountID="'+e.Tables[23][s].AccountID.toString()+'" ',t+='IsNewReference="0" ',t+=' RefDocNo="'+e.Tables[23][s].RefDocNo.toString()+'" ',t+=' RefDocSeqNo="'+e.Tables[23][s].RefDocSeqNo.toString()+'" ',n.e.IsEmpty(e.Tables[23][s].RefDocDate)||(t+=' RefDocDate="'+new Date(e.Tables[23][s].RefDocDate).ToString("dd/MMM/yyyy")+'" '),t+=' AdjAmount="'+e.Tables[23][s].AdjAmount.toString()+'" ',t+=' Amount="'+e.Tables[23][s].AmountFC.toString()+'" ',t+=' AdjCurrID="'+e.Tables[23][s].AdjCurrID.toString()+'" ',t+=' AdjExchRT="'+e.Tables[23][s].AdjExchRT.toString()+'" ',n.e.IsEmpty(e.Tables[23][s].RefDocDueDate)||(t+=' RefDocDueDate="'+new Date(e.Tables[23][s].RefDocDueDate).ToString("dd/MMM/yyyy")+'" '),t+=' Narration="'+e.Tables[23][s].Narration.toString()+'" ',t+=" /> ");t+="</ChkRtnXML>",this.ChkRtnXml=t}if(null!=this.POSPayModes&&this.IsPOs&&e.Tables.length>16&&e.Columns[16].Contains("Amount")){this.POSPayModes.clear();for(let t=0;t<e.Tables[16].length;t++){let s=this.POSPayModes.PayModes.find(s=>s.DBColumnName==e.Tables[16][t].DBColumnName.toString());if(s){let i;t<this.POSPayModes.GridData.length?i=this.POSPayModes.GridData[t]:(i=this.POSPayModes.GridDataObj.NewRow(),this.POSPayModes.GridData.push(i)),i.Name=s.Label,i.Amount=e.Tables[16][t].Amount.toString(),i.ColumnName=s.DBColumnName,i.Type=s.SectionID;let a="";if(a+='<XML Amount="'+e.Tables[16][t].Amount.toString()+'" ',a+=' DBColumnName="'+s.DBColumnName+'" ',a+=' Type="'+s.SectionID+'" ',a+=' RegisterID="'+this.ScreenObject.RegisterNodeID+'" ',a+=' ShiftID="'+this.ScreenObject.ShiftNodeID+'" ',a+=' DocDate="'+this.DocumentDate.ToString("dd/MMM/yyyy")+'" ',"5"==s.SectionID&&this.ScreenObject.Preferences.ContainsKey("CashForeignCurrency")&&Object(o.j)(this.ScreenObject.Preferences.CashForeignCurrency)){if(!n.e.IsEmpty(e.Tables[16][t].Currency)){a+=' Currency="'+e.Tables[16][t].Currency.toString()+'" ';let s=this.POSPayModes.Currency.Currency.Items.find(s=>s.Value==e.Tables[16][t].Currency.toString());s&&(i.Description=e.Tables[16][t].AmountFC.toString()+" "+s.Name+"@"+e.Tables[16][t].ExchangeRate.toString())}n.e.IsEmpty(e.Tables[16][t].ExchangeRate)||(a+=' ExchangeRate="'+e.Tables[16][t].ExchangeRate.toString()+'" '),n.e.IsEmpty(e.Tables[16][t].AmountFC)||(a+=' FCAmt="'+e.Tables[16][t].AmountFC.toString()+'" ')}if("6"==s.SectionID||"7"==s.SectionID)i.Description=e.Tables[16][t].CardNo.toString(),a+=' CardNo="'+u.d.GetValidXml(e.Tables[16][t].CardNo)+'" ',a+=' CardName="'+u.d.GetValidXml(e.Tables[16][t].CardName)+'" ',n.e.IsEmpty(e.Tables[16][t].ExpDate)||(a+=' ExpDate="'+new Date(e.Tables[16][t].ExpDate).ToString("dd/MMM/yyyy")+'" '),"6"==s.SectionID&&(a+=' ApprovalCode="'+u.d.GetValidXml(e.Tables[16][t].ApprovalCode)+'" ',n.e.IsEmpty(e.Tables[16][t].BankName)||(a+=' BankName="'+e.Tables[16][t].BankName.toString()+'" '),n.e.IsEmpty(e.Tables[16][t].CardType)||(a+=' CardType="'+e.Tables[16][t].CardType.toString()+'" '));else if("5"==s.SectionID||"8"==s.SectionID){let t="",a=null;a=e.Tables[17].filter("5"==s.SectionID?e=>-10!=e.CurrencyID:e=>-10==e.CurrencyID);for(let e=0;e<a.length;e++)t+='<XML IsDenom="1" ',n.e.IsEmpty(a[e].Notes)||n.e.IsEmpty(a[e].NotesTender)||(t+=' CurrencyID="'+a[e].CurrencyID.toString()+'" Notes="'+a[e].Notes.toString()+'"  NotesTender="',t+=a[e].NotesTender.toString()+'"  Change="'),n.e.IsEmpty(a[e].Change)||n.e.IsEmpty(a[e].ChangeTender)?t+='0" ChangeTender="0" />':t+=a[e].Change.toString()+'" ChangeTender="'+a[e].ChangeTender.toString()+'" />';i.Denomination=t.toString()}else"9"!=s.SectionID&&"10"!=s.SectionID||(i.Description=e.Tables[16][t].CardNo.toString(),a+=' CardNo="'+u.d.GetValidXml(e.Tables[16][t].CardNo)+'" ',"9"==s.SectionID&&(a+=' VoucherNodeID="'+e.Tables[16][t].VoucherNodeID.toString()+'" '));a+=" />",i.Details=a}else"12"==e.Tables[16][t].Type.toString()&&e.Tables[16][t].DBColumnName.toString().toLowerCase()==this.POSPayModes.Returnfld.toLowerCase()&&(this.POSPayModes.Return=""==this.POSPayModes.ReturnDecimalPoints||n.e.IsEmpty(e.Tables[16][t].Amount)?""!=this.POSPayModes.ReturnDecimalPoints?(0).ToString("N"+this.POSPayModes.ReturnDecimalPoints):e.Tables[16][t].Amount.toString():parseFloat(e.Tables[16][t].Amount).ToString("N"+this.POSPayModes.ReturnDecimalPoints))}}if(30==this.ScreenObject.DocumentType&&this.ScreenObject.Preferences.ContainsKey("UseasAssemble/DisAssembly")&&Object(o.j)(this.ScreenObject.Preferences["UseasAssemble/DisAssembly"])&&e.Tables.length>20&&e.Tables[20].length>0){let t=this.ScreenObject.GridData.filter(t=>t.ProductID_key==e.Tables[20][0].ParentProductID);if(t.length>0){this.ScreenObject.GridDataColumns.Contains("IsKit")||this.ScreenObject.GridDataColumns.push("IsKit"),t[0].IsKit=1;for(let s=0;s<this.ScreenObject.GridData.length;s++)n.e.IsEmpty(this.ScreenObject.GridData[s].ProductID_Key)||(t=e.Tables[20].filter(e=>e.ProductID==this.ScreenObject.GridData[s].ProductID_Key),t.length>0&&(this.ScreenObject.GridData[s].IsKit=2,this.ScreenObject.GridData[s].DefaultQuantity=t[0].Quantity))}}if(35==this.ScreenObject.DocumentType&&null!=this.ViewOrganizationViewModel&&null!=e&&e.Tables.length>17&&e.Tables[17].length>0&&this.ViewOrganizationViewModel.LoadData(e.Tables[17]),null!=e&&e.Tables.length>18&&e.Tables[18].length>0&&e.Columns[18].Contains("DocID")&&!n.e.IsEmpty(e.Tables[18][0].DocID)){if(this.AutoPostDocID=null!=this.AutoPostViewModel&&this.AutoPostViewModel.CostCenterID.toString()==e.Tables[18][0].costcenterid.toString()?parseInt(e.Tables[18][0].DocID):e.Tables[18].length>1&&null!=this.AutoPostViewModel&&this.AutoPostViewModel.CostCenterID.toString()==e.Tables[18][1].costcenterid.toString()?parseInt(e.Tables[18][1].DocID):0,this.AutoProduceDocID=null!=this.AutoProduce&&this.AutoProduce.CostCenterID.toString()==e.Tables[18][0].costcenterid.toString()?parseInt(e.Tables[18][0].DocID):e.Tables[18].length>1&&null!=this.AutoProduce&&this.AutoProduce.CostCenterID.toString()==e.Tables[18][1].costcenterid.toString()?parseInt(e.Tables[18][1].DocID):0,null!=this.AutoPostViewModel)if(this.AutoPostDocID>0){this.AutoPostViewModel.ScreenObject.DocID=this.AutoPostDocID;let t=this.AutoPostViewModel.ScreenObject.GetEditDataByDOCID();if(null!=e&&this.AutoPostViewModel.ScreenObject.IsDocEdit&&t.Tables.length>0&&t.Tables[0].length>0){if(this.AutoPostViewModel.ScreenObject.LoadEditData(t,!1),this.ScreenObject.Preferences.ContainsKey("Autopostdocument")&&""!=this.ScreenObject.Preferences.Autopostdocument&&"0"!=this.ScreenObject.Preferences.Autopostdocument){let e=this.AutoPostViewModel.ScreenObject._TextFields.find(e=>e.DBColumnName.toLowerCase()==this.ScreenObject.Preferences.FPQty.toLowerCase());if(e&&e instanceof u.d){let t=n.e.NewGuid().toString(),s=0;n.e.IsNum(e.Text)&&(s=parseFloat(e.Text));for(let e=0;e<this.AutoPostViewModel.ScreenObject.GridData.length;e++)n.e.IsEmpty(this.AutoPostViewModel.ScreenObject.GridData[e].ProductID_Key)||n.e.IsEmpty(this.AutoPostViewModel.ScreenObject.GridData[e].Quantity)||(this.AutoPostViewModel.ScreenObject.GridData[e].RefSeqNo=t,this.AutoPostViewModel.ScreenObject.GridData[e].defaultQuantity=parseFloat(this.AutoPostViewModel.ScreenObject.GridData[e].Quantity)/s);this.ScreenObject.GridData.length>0&&(this.ScreenObject.GridData[0].RefSeqNo=t)}}this.AutoPostViewModel.RefreshGrid=!0}}else this.AutoPostViewModel.ScreenObject.GridData.Clear();if(null!=this.AutoProduce)if(this.AutoProduce.ScreenObject.DocID=this.AutoProduceDocID,this.AutoProduceDocID>0){let t=this.AutoProduce.ScreenObject.GetEditDataByDOCID();null!=e&&this.AutoProduce.ScreenObject.IsDocEdit&&t.Tables.length>0&&t.Tables[0].length>0&&this.AutoProduce.ScreenObject.LoadEditData(t,!1)}else this.AutoProduce.ScreenObject.GridData.Clear()}else this.AutoPostDocID=0,null!=this.AutoPostViewModel&&this.AutoPostViewModel.ScreenObject.GridData.Clear(),this.AutoProduceDocID=0,null!=this.AutoProduce&&this.AutoProduce.ScreenObject.GridData.Clear();if(null!=this.DtTempSchemes&&this.DtTempSchemes.Clear(),null!=e&&e.Tables.length>26&&e.Tables[26].length>0&&e.Columns[26].Contains("InvDocDetailsID")){let t=e.Tables[26].filter(e=>2==e.Type),s=0;if(t.length>0){null==this.DtPack&&(this.DtPack=[],this.DtPackColumns.push("ID"),this.DtPackColumns.push("Name"),this.DtPackColumns.push("Label"),this.DtPackColumns.push("cWeight"),this.DtPackColumns.push("cVolume"),this.DtPackColumns.push("Weight"),this.DtPackColumns.push("Volume"),this.DtPackColumns.push("Height"),this.DtPackColumns.push("length"),this.DtPackColumns.push("Width"),this.DtPackColumns.push("ActualWeight"),this.DtPackColumns.push("ActualVolume"),(this.ScreenObject.Preferences.ContainsKey("PackWiseProds")&&"true"==this.ScreenObject.Preferences.PackWiseProds.toLowerCase()||this.ScreenObject.Preferences.ContainsKey("LineWisePacking")&&"true"==this.ScreenObject.Preferences.LineWisePacking.toLowerCase())&&this.DtPackColumns.push("Data"));let i="";for(let r=0;r<t.length;r++){let a=t[r];""!=i&&(i+=","),i+=a.RefID.toString();let o,l=this.DtPack.filter(e=>e.Label==a.label.toString());if(0==l.length?(o={},o.ID=a.RefID.toString(),o.Label=a.label.toString(),n.e.IsEmpty(a.Fld1)||(o.length=a.Fld1),n.e.IsEmpty(a.Fld2)||(o.Width=a.Fld2),n.e.IsEmpty(a.Fld3)||(o.Height=a.Fld3),n.e.IsEmpty(a.Fld4)||(o.ActualWeight=a.Fld4),n.e.IsEmpty(a.Fld5)||(o.ActualVolume=a.Fld5),this.DtPack.push(o)):o=l[0],this.DtPackColumns.Contains("Data")&&(o.Data=n.e.IsEmpty(o.Data)?a.Unq.toString()+"~"+a.Quantity.toString():o.Data.toString()+","+a.Unq.toString()+"~"+a.Quantity.toString()),e.Columns[0].Contains("Volume")){let t=e.Tables[0].filter(e=>e.DocDetailsID==a.InvDocDetailsID);s=0,n.e.IsEmpty(t[0].Volume)||n.e.IsEmpty(a.Quantity)||(s=parseFloat(t[0].Volume)*parseFloat(a.Quantity)),o.cVolume=n.e.IsEmpty(o.cVolume)?s:parseFloat(o.cVolume)+s,s=0,n.e.IsEmpty(t[0].Weight)||n.e.IsEmpty(a.Quantity)||(s=parseFloat(t[0].Weight)*parseFloat(a.Quantity)),o.cWeight=n.e.IsEmpty(o.cWeight)?s:parseFloat(o.cWeight)+s}}let a=this.ScreenObject.GetPackDetails(i);null!=a&&a.Tables.length>0&&a.Columns[0].Contains("Name")&&a.Tables[0].length>0&&a.Tables[0].forEach(e=>{this.DtPack.filter(t=>t.ID==e.Nodeid).forEach(t=>{t.Name=e.Name})})}}}else{let t=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&55845==e.LinkData);if(t.length>0){let s;if(this.ScreenObject.GridDataColumns.Contains(t[0].SysColumnName))for(let i=0;i<e.Tables[0].length;i++)s=n.e.isValidDate(e.Tables[0][i].ClearanceDate)?new Date(e.Tables[0][i].ClearanceDate):void 0,this.ScreenObject.GridData[i].DocDetailsID==e.Tables[0][i].DocDetailsID&&null!=s&&s.getFullYear()>2e3&&(this.ScreenObject.GridData[i][t[0].SysColumnName]=s.ToString(a.a.SessionManager.Preferences["Date Format"]),this.ScreenObject.GridDataColumns.Contains(t[0].SysColumnName+"_Key")&&(this.ScreenObject.GridData[i][t[0].SysColumnName+"_Key"]=s));else{let i=this.ScreenObject._TextFields.find(e=>e.DBColumnID==parseInt(t[0].CostCenterColID));i&&n.e.isValidDate(e.Tables[0][0].ClearanceDate)&&(s=new Date(e.Tables[0][0].ClearanceDate),s.getFullYear()>2e3&&(i instanceof u.d?i.Text=s.ToString(a.a.SessionManager.Preferences["Date Format"]):i instanceof d.c&&(i.Date=s)))}}if(t=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&55846==e.LinkData),t.length>0)if(this.ScreenObject.GridDataColumns.Contains(t[0].SysColumnName))for(let s=0;s<e.Tables[0].length;s++)this.ScreenObject.GridData[s].DocDetailsID==e.Tables[0][s].DocDetailsID&&("0"==e.Tables[0][s].BRS_Status.toString()?this.ScreenObject.GridData[s][t[0].SysColumnName]=a.a.GetResource("Reports_Outstanding"):"1"==e.Tables[0][s].BRS_Status.toString()&&(this.ScreenObject.GridData[s][t[0].SysColumnName]=a.a.GetResource("Reports_Cleared")));else{let s=this.ScreenObject._TextFields.find(e=>e.DBColumnID==parseInt(t[0].CostCenterColID));s&&s instanceof u.d&&("0"==e.Tables[0][0].BRS_Status.toString()?s.Text=a.a.GetResource("Reports_Outstanding"):"1"==e.Tables[0][0].BRS_Status.toString()&&(s.Text=a.a.GetResource("Reports_Cleared")))}this.IsReplaced=0,429==this.StatusID&&e.Tables[0].length>0&&e.Columns[0].Contains("IsReplce")&&n.e.IsNum(e.Tables[0][0].IsReplce)&&(this.IsReplaced=parseInt(e.Tables[0][0].IsReplce));let i=this.GetButton("Redeposit");if(0==this.IsReplaced&&null!=i&&e.Tables.length>6&&e.Tables[6].length>0&&e.Columns[6].Contains("CanRedeposit")&&e.Tables[6][0].CanRedeposit&&Object(o.j)(e.Tables[6][0].CanRedeposit)?i.Visible=!0:null!=i&&(i.Visible=!1),null!=this.ViewNotes&&e.Tables.length>7&&this.ViewNotes.LoadNotes(e.Tables[7]),null!=this.ViewAttachments&&e.Tables.length>8&&this.ViewAttachments.LoadAttachments(e.Tables[8],e.Tables[0]),e.Tables.length>9&&(null!=this.ViewActivities?(this.ViewActivities.LoadActivityData(e.Tables[9]),this.ViewActivities.NodeID=this.DocID):e.Tables[9].length>0&&(this.ViewActivities.NodeID=this.DocID,this.NodeID=this.DocID,this.Activities.AssignVisiblity=!1,this.ViewActivities.CloseVisible=!0,this.ViewActivities.LoadActivityData(e.Tables[9]))),this.ScreenObject.Preferences.ContainsKey("UseAsLC")&&!n.e.IsEmpty(this.ScreenObject.Preferences.UseAsLC)&&Object(o.j)(this.ScreenObject.Preferences.UseAsLC)||this.ScreenObject.Preferences.ContainsKey("UseAsTR")&&!n.e.IsEmpty(this.ScreenObject.Preferences.UseAsTR)&&Object(o.j)(this.ScreenObject.Preferences.UseAsTR)){var h=this.GetButton("Close");null!=h&&(h.Visible=!1),null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&e.Columns[0].Contains("StatusID")&&!n.e.IsEmpty(e.Tables[0][0].StatusID)&&(443==parseInt(e.Tables[0][0].StatusID.toString())?(null!=h&&(h.Visible=!1),this.ButtonApprove.Visible=!0):(null!=h&&(h.Visible=!0),this.ButtonApprove.Visible=!1,a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit")&&(s.Visible=!0),this.ButtonSaveandPrint.Enable=!1,this.ButtonSaveandBarcode.Enable=!1,this.ButtonSave.Enable=!1))}}if(e.Tables[0].length>0&&e.Columns[0].Contains("WorkflowID")&&!n.e.IsEmpty(e.Tables[0][0].WorkflowID)&&parseInt(e.Tables[0][0].WorkflowID)>0?(i.Visible=!0,this.WfID=parseInt(e.Tables[0][0].WorkflowID)):i.Visible=!1,e.Tables.length>6&&e.Tables[6].length>0&&e.Columns[6].Contains("CanEdit")&&!n.e.IsEmpty(e.Tables[6][0].CanEdit)&&!Object(o.j)(e.Tables[6][0].CanEdit)?369==this.StatusID&&(this.ScreenObject.Preferences.ContainsKey("NoWorkflowPostedDocs")&&""!=this.ScreenObject.Preferences.NoWorkflowPostedDocs&&Object(o.j)(this.ScreenObject.Preferences.NoWorkflowPostedDocs)||"true"==a.a.SessionManager.Preferences.EditApprovedDocuments.toLowerCase()||a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Posted Docs"))?(this.ButtonSaveandPrint.Enable=!0,this.ButtonSaveandBarcode.Enable=!0,this.ButtonSave.Enable=!0,this.WorkFlowDocLevel=0):441==this.StatusID&&a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Approved Docs")?(this.ButtonSaveandPrint.Enable=!1,this.ButtonSaveandBarcode.Enable=!1,this.ButtonSave.Enable=!1,this.WorkFlowDocLevel=0,s.Visible=!0):(this.ButtonSaveandPrint.Enable=!1,this.ButtonSaveandBarcode.Enable=!1,this.ButtonSave.Enable=!1):this.ScreenObject.Preferences.ContainsKey("UseAsLC")&&""!=this.ScreenObject.Preferences.UseAsLC&&Object(o.j)(this.ScreenObject.Preferences.UseAsLC)||this.ScreenObject.Preferences.ContainsKey("UseAsTR")&&""!=this.ScreenObject.Preferences.UseAsTR&&Object(o.j)(this.ScreenObject.Preferences.UseAsTR)||(e.Tables.length>6&&e.Tables[6].length>0&&e.Columns[6].Contains("canapprove")&&Object(o.j)(e.Tables[6][0].canapprove)?(this.ButtonApprove.Visible=!0,this.ButtonSave.Enable=!1):a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit")&&(this.ButtonApprove.Visible=!1,this.ButtonSave.Enable=!0),this.ButtonSaveandPrint.Enable=!0,this.ButtonSaveandBarcode.Enable=!0),!this.ButtonApprove.Visible&&e.Tables.length>6&&e.Tables[6].length>0&&e.Columns[6].Contains("WType")&&(e.Tables.length>6&&e.Tables[6].length>0&&e.Columns[6].Contains("userlevel")&&null!=e.Tables[6][0].userlevel&&e.Tables[6][0].Wlevel==e.Tables[6][0].userlevel&&369!=this.StatusID?(this.ButtonSave.Enable=!1,this.ButtonSaveandPrint.Enable=!1,this.ButtonSaveandBarcode.Enable=!1,a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit")&&(s.Visible=!0)):2==e.Tables[6][0].WType&&e.Tables.length>6&&e.Tables[6].length>0&&e.Columns[6].Contains("userlevel")&&(n.e.IsEmpty(e.Tables[6][0].userlevel)||!n.e.IsEmpty(e.Tables[6][0].Wlevel)&&parseInt(e.Tables[6][0].Wlevel)<parseInt(e.Tables[6][0].userlevel))&&369!=this.StatusID?(this.ButtonSave.Enable=!1,this.ButtonSaveandPrint.Enable=!1,this.ButtonSaveandBarcode.Enable=!1,a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit")&&n.e.IsEmpty(e.Tables[6][0].userlevel)&&(s.Visible=!0)):1==e.Tables[6][0].WType&&e.Tables.length>6&&e.Tables[6].length>0&&e.Columns[6].Contains("userlevel")&&null!=e.Tables[6][0].userlevel&&369!=this.StatusID&&(this.ButtonSave.Enable=!1,this.ButtonSaveandPrint.Enable=!1,this.ButtonSaveandBarcode.Enable=!1,a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit")&&(s.Visible=!0))),!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Printed Documents")&&e.Tables.length>6&&e.Tables[6].length>0&&e.Columns[6].Contains("IsPrinted")&&null!=e.Tables[6][0].IsPrinted&&Object(o.j)(e.Tables[6][0].IsPrinted)&&(this.ButtonSave.Enable=!1,this.ButtonSaveandBarcode.Enable=!1,this.ButtonSaveandPrint.Enable=!1),this.ButtonSuspend.Visible=!1,this.ButtonSuspend.Mandatory&&!this.IsPOs&&a.a.SessionManager.IsActionAssigned(43,"Modify Link Status")&&(this.ButtonSuspend.Visible=!0),this.IsPOs){let e=this.GetButton("Pay");null!=e&&(e.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"))}if(376!=this.StatusID&&this.ScreenObject.Preferences.ContainsKey("EnableRevision")&&""!=this.ScreenObject.Preferences.EnableRevision&&Object(o.j)(this.ScreenObject.Preferences.EnableRevision)?a.a.SessionManager.HideUnathorizedAccess?this.ButtonRevise.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Revise"):(this.ButtonRevise.Visible=!0,this.ButtonRevise.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Revise")):this.ButtonRevise.Visible=!1,371==this.StatusID&&this.ButtonSave.Enable||372==this.StatusID||438==this.StatusID?(372==this.StatusID?(this.ButtonSave.Enable=!1,this.ButtonApprove.Visible=!1,this.OnRejectEdit&&(!this.OnRejectEdit||n.e.IsEmpty(e.Tables[6][0].userlevel)||n.e.IsEmpty(e.Tables[6][0].Wlevel)||parseInt(e.Tables[6][0].Wlevel)-1!=parseInt(e.Tables[6][0].userlevel))||(a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit")||a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Rejected Documents"))&&(this.ButtonSave.Visible=!0,this.ButtonSave.Enable=!0,a.a.SessionManager.HideUnathorizedAccess?(this.ButtonSaveandPrint.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save&Print"),this.ButtonSaveandPrint.Enable=!0):this.ButtonSaveandPrint.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save&Print"),this.HideButtons("Save&Barcode"))):(a.a.SessionManager.HideUnathorizedAccess?(this.ButtonSave.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"),this.ButtonSave.Enable=!0):this.ButtonSave.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"),a.a.SessionManager.HideUnathorizedAccess?(this.ButtonSaveandPrint.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save&Print"),this.ButtonSaveandPrint.Enable=!0):this.ButtonSaveandPrint.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save&Print"),this.HideButtons("Save&Barcode")),this.HideButtons("BarcodePrint")):this.ButtonSave.Enable&&376!=this.StatusID&&(a.a.SessionManager.HideUnathorizedAccess?(this.ButtonSave.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"),this.ButtonSave.Enable=!0):this.ButtonSave.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"),a.a.SessionManager.HideUnathorizedAccess?(this.ButtonSaveandPrint.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save&Print"),this.ButtonSaveandPrint.Enable=!0):this.ButtonSaveandPrint.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save&Print"),this.HideButtons("Save&Barcode"),this.HideButtons("BarcodePrint"),376!=this.StatusID&&this.ScreenObject.Preferences.ContainsKey("EnableRevision")&&""!=this.ScreenObject.Preferences.EnableRevision&&Object(o.j)(this.ScreenObject.Preferences.EnableRevision)?a.a.SessionManager.HideUnathorizedAccess?this.ButtonRevise.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Revise"):(this.ButtonRevise.Visible=!0,this.ButtonRevise.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Revise")):this.ButtonRevise.Visible=!1),this.ButtonApprove.Visible&&(a.a.SessionManager.IsRptManagerUser||(a.a.SessionManager.HideUnathorizedAccess?this.ButtonApprove.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Approve"):this.ButtonApprove.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Approve")),a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit")&&(s.Visible=!0)),this.ScreenObject.Preferences.ContainsKey("enebleSaveonhold")&&"True"==this.ScreenObject.Preferences.enebleSaveonhold){let e=this.GetButton("Save");null!=e&&(438==this.StatusID?(e.Enable=this.ButtonSave.Enable,e.Visible=this.ButtonSave.Visible):e.Visible=!1)}if(25==this.ScreenObject.DocumentType&&(t=this.GetButton("Enquiries"),t.Visible=!(null==c||!c.Visible)||!(!this.ScreenObject.Preferences.ContainsKey("DisableGenerate")||"True"!=this.ScreenObject.Preferences.DisableGenerate||369!=this.StatusID)),31!=this.ScreenObject.DocumentType&&32!=this.ScreenObject.DocumentType&&63!=this.ScreenObject.DocumentType||(t=this.GetButton("Stock Posting"),null!=t&&(t.Visible=!1),null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&e.Columns[0].Contains("StatusID")&&!n.e.IsEmpty(e.Tables[0][0].StatusID)&&(443==parseInt(e.Tables[0][0].StatusID)?t.Visible=!0:369==parseInt(e.Tables[0][0].StatusID)&&(this.ButtonSave.Enable=!1,this.ButtonSaveandBarcode.Enable=!1,this.ButtonSaveandPrint.Enable=!1))),this.ScreenObject.Preferences.ContainsKey("batchpaymentreport")&&!n.e.IsEmpty(this.ScreenObject.Preferences.batchpaymentreport)&&"0"!=this.ScreenObject.Preferences.batchpaymentreport&&15==this.ScreenObject.DocumentType&&377==parseInt(e.Tables[0][0].StatusID.toString())&&(this.ButtonSave.Enable=!1,this.ButtonSaveandBarcode.Enable=!1,this.ButtonSaveandPrint.Enable=!1),t=this.GetButton("Bounce"),15!=this.ScreenObject.DocumentType&&18!=this.ScreenObject.DocumentType||(t.Visible=!0),18!=this.ScreenObject.DocumentType&&15!=this.ScreenObject.DocumentType||429!=this.StatusID||(t.Visible=!1,this.ButtonSave.Visible=!1,this.ButtonRevise.Visible=!1),this.ScreenObject.SetDefaultValuesforCostCenters(2),this.SetSaveVisibility(),this.CalculateTotals(null,!1),this.RefreshGrid=!0,this.RefreshGridFooter=!0,this.DQuickInfoVisibility=!1,this.QuickInfoVisibility=!1,this.ApproveVisibility=!1,this.VoucherDefVisibility=!1,14==this.ScreenObject.DocumentType||19==this.ScreenObject.DocumentType){this.DocStatus="";for(let s=0;s<e.Tables[0].length;s++)if(e.Tables[0][s].StatusID.toString()!=this.StatusID.toString()&&"[Partial]"!=this.DocStatus){this.DocStatus="[Partial]";break}let t=this.ScreenObject.ColumnSource.find(e=>"StatusID"==e.DisplayMember);t&&(t.IsVisible="[Partial]"==this.DocStatus)}if((this.ScreenObject.Preferences.ContainsKey("UseAsLC")&&""!=this.ScreenObject.Preferences.UseAsLC&&Object(o.j)(this.ScreenObject.Preferences.UseAsLC)||this.ScreenObject.Preferences.ContainsKey("UseAsTR")&&""!=this.ScreenObject.Preferences.UseAsTR&&Object(o.j)(this.ScreenObject.Preferences.UseAsTR))&&369==this.StatusID)this.DocStatus=a.a.GetResource("Status_Approved");else if(429==this.StatusID&&this.IsReplaced>0&&"[Partial]"!=this.DocStatus)1==this.IsReplaced?this.DocStatus="["+a.a.GetResource("Replaced")+"]":2==this.IsReplaced?this.DocStatus="["+a.a.GetResource("ReplacedPartial")+"]":e.Tables.length>6&&e.Columns[6].Contains("Status")&&e.Tables[6].length>0&&(this.DocStatus="Hold"==n.e.String(e.Tables[6][0].Status).Replace("-","_").Replace(" ","")?"["+a.a.GetResource("Status_Hold")+"]":"["+a.a.GetResource(e.Tables[6][0].Status.toString().Replace("-","_").Replace(" ",""))+"]");else if(e.Tables.length>6&&e.Columns[6].Contains("Status")&&e.Tables[6].length>0){this.ScreenObject.IsDocEdit&&("[Partial]"!=this.DocStatus||14!=this.ScreenObject.DocumentType&&19!=this.ScreenObject.DocumentType)&&(this.DocStatus="Hold"==n.e.String(e.Tables[6][0].Status).Replace("-","_").Replace(" ","")?"["+a.a.GetResource("Status_Hold")+"]":"["+a.a.GetResource(e.Tables[6][0].Status.toString().Replace("-","_").Replace(" ",""))+"]");let t=!1;if(this.ScreenObject.Preferences.ContainsKey("PostAsset")&&"true"==this.ScreenObject.Preferences.PostAsset.toLowerCase()&&(t=!0),this.ScreenObject.Preferences.ContainsKey("DimTransferSrc")&&parseInt(this.ScreenObject.Preferences.DimTransferSrc)>0&&(t=!0),5!=this.DocumentType&&8!=this.DocumentType&&13!=this.DocumentType||!this.ScreenObject.Preferences.ContainsKey("IsBudgetDocument")||"true"!=this.ScreenObject.Preferences.IsBudgetDocument.toLowerCase()&&"1"!=this.ScreenObject.Preferences.IsBudgetDocument||(t=!0),this.LineWiseApproval){let i=!1;for(let t=0;t<e.Tables[0].length;t++)if(t>0&&!n.e.IsEmpty(e.Tables[0][t].WorkFlowID)&&!n.e.IsEmpty(e.Tables[0][t-1].WorkFlowID)&&e.Tables[0][t].WorkFlowID.toString()!=e.Tables[0][t-1].WorkFlowID.toString()&&(i=!0),t>0&&n.e.String(e.Tables[0][t].canapprove)!=n.e.String(e.Tables[0][t-1].canapprove)&&(i=!0),n.e.String(e.Tables[0][t].StatusID)!=this.StatusID.toString()&&"[Partial]"!=this.DocStatus){this.DocStatus="[Partial]";break}if("[Partial]"!=this.DocStatus&&(369==this.StatusID&&t||this.ScreenObject.Preferences.ContainsKey("batchpaymentDoc")&&!n.e.IsEmpty(this.ScreenObject.Preferences.batchpaymentDoc)&&parseInt(this.ScreenObject.Preferences.batchpaymentDoc.toString())>4e4&&377==this.StatusID))this.ButtonSave.Enable=!1,this.ButtonSaveandBarcode.Enable=!1,this.ButtonSaveandPrint.Enable=!1,this.ButtonRevise.Enable=!1,this.ButtonSuspend.Enable=!1;else if("[Partial]"==this.DocStatus||i){let i=!1,r=!1,o=!1;for(let s=0;s<e.Tables[0].length;s++)this.IsInventoryVoucher&&null!=c&&!c.Visible&&"369"==e.Tables[0][s].StatusID.toString()&&(c.Visible=!0),"369"==e.Tables[0][s].StatusID.toString()&&t&&(e.Tables[0][s].CanEdit="0"),e.Columns[0].Contains("CanApprove")&&"1"==e.Tables[0][s].CanApprove.toString()?r=!0:e.Columns[0].Contains("CanEdit")&&"1"==e.Tables[0][s].CanEdit.toString()&&("372"==e.Tables[0][s].StatusID.toString()&&!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Rejected Documents")&&!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit")||"372"!=e.Tables[0][s].StatusID.toString()&&!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit")?e.Tables[0][s].CanEdit="0":i=!0),"372"==e.Tables[0][s].StatusID.toString()&&e.Columns[0].Contains("CanEdit")&&"1"==e.Tables[0][s].CanEdit.toString()&&(o=!0);r&&a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Approve")?(e.Tables.length>6&&e.Tables[6].length>0&&e.Columns[6].Contains("WType")&&"2"!=e.Tables[6][0].WType.toString()&&(s.Visible=!!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit")),this.ButtonApprove.Visible=!0,this.ButtonSave.Enable=!1):o&&(a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Rejected Documents")||a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"))&&e.Tables.length>6&&e.Tables[6].length>0&&e.Columns[6].Contains("userlevel")&&!n.e.IsEmpty(e.Tables[6][0].userlevel)?(s.Visible=!1,this.ButtonApprove.Visible=!1,this.ButtonSave.Enable=!0,this.ButtonSave.Visible=!0):i&&a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit")?e.Tables.length>6&&e.Tables[6].length>0&&e.Columns[6].Contains("userlevel")&&!n.e.IsEmpty(e.Tables[6][0].userlevel)&&e.Tables[6][0].Wlevel.toString()==e.Tables[6][0].userlevel.toString()?(this.ButtonSave.Enable=!1,this.ButtonSaveandPrint.Enable=!1,this.ButtonSaveandBarcode.Enable=!1,s.Visible=!0):e.Tables.length>6&&e.Tables[6].length>0&&e.Columns[6].Contains("WType")&&"2"==e.Tables[6][0].WType.toString()&&(!e.Columns[6].Contains("userlevel")||!n.e.IsEmpty(e.Tables[6][0].userlevel))||a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Posted Docs")||a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Approved Docs")?(s.Visible=!1,this.ButtonApprove.Visible=!1,this.ButtonSave.Enable=!0):(s.Visible=!0,this.ButtonApprove.Visible=!1,this.ButtonSave.Enable=!1):(s.Visible=!1,this.ButtonApprove.Visible=!1,this.ButtonSave.Enable=!1)}}else(369==this.StatusID&&t||this.ScreenObject.Preferences.ContainsKey("batchpaymentDoc")&&!n.e.IsEmpty(this.ScreenObject.Preferences.batchpaymentDoc)&&parseInt(this.ScreenObject.Preferences.batchpaymentDoc.toString())>4e4&&377==this.StatusID)&&(this.ButtonSave.Enable=!1,this.ButtonSaveandBarcode.Enable=!1,this.ButtonSaveandPrint.Enable=!1,this.ButtonRevise.Enable=!1,this.ButtonSuspend.Enable=!1)}if(this.IsInventoryVoucher&&e.Tables.length>19&&e.Tables[19].length>0&&e.Columns[19].Contains("ExecutedQty")&&this.ScreenObject.Preferences.ContainsKey("ShowLinkStatus")&&""!=this.ScreenObject.Preferences.ShowLinkStatus&&Object(o.j)(this.ScreenObject.Preferences.ShowLinkStatus)){let t="";if(e.Columns[0].Contains("LinkStatusID")&&0==e.Tables[0].filter(e=>445!=e.LinkStatusID).length)t="Close";else{t="Open";let s=0,i=null;if(i=5==this.DocumentType&&e.Columns[19].Contains("VoucherType")?e.Tables[19].filter(e=>-1==e.VoucherType).Compute("sum","ExecutedQty"):e.Tables[19].Compute("sum","ExecutedQty"),null!=i&&i.toString().length>0&&(s=parseFloat(i)),0==s)t="Open";else{let s;s=5==this.DocumentType&&e.Columns[19].Contains("VoucherType")?e.Tables[19].filter(e=>-1==e.VoucherType&&e.Quantity>e.ExecutedQty):e.Tables[19].filter(e=>e.Quantity>e.ExecutedQty),t=s.length>0?"Pending":"Executed"}}null!=this.ScreenObject.Link?this.ScreenObject.Link.LinkStatus="["+t+"]":(this.ScreenObject.linkstat=t,this.DocStatus+="("+a.a.GetResource(t.Replace("-","_").Replace(" ",""))+")")}if(this.ScreenObject.CheckViewForUser(this.StatusID),this.UpdateFooter=!0,this.ButtonSuspendDoc.Visible&&this.ButtonSuspendDoc.Enable||(a.a.SessionManager.HideUnathorizedAccess?this.ButtonSuspendDoc.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Suspend"):this.ButtonSuspendDoc.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Suspend")),e.Tables.length>6&&e.Tables[6].length>0&&e.Columns[6].Contains("IsLock")&&!n.e.IsEmpty(e.Tables[6][0].IsLock)&&Object(o.j)(e.Tables[6][0].IsLock)&&!a.a.SessionManager.IsActionAssigned(43,"Override Lock")?(this.ButtonSave.Enable=!1,this.ButtonSaveandBarcode.Enable=!1,this.ButtonSaveandPrint.Enable=!1,this.ButtonRevise.Enable=!1,this.ButtonSuspend.Enable=!1,this.ButtonDelete.Visible=!1,this.ButtonSuspend.Visible=!1,this.ButtonSuspendDoc.Visible=!1,s.Visible=!1,this.IsLocked=!0,this.ButtonApprove.Visible&&(a.a.SessionManager.IsActionAssigned(43,"Approve Locked Documents")||a.a.SessionManager.Preferences.ContainsKey("PostLockedDocs")&&Object(o.j)(a.a.SessionManager.Preferences.PostLockedDocs)||a.a.SessionManager.Preferences.ContainsKey("DocDateasPostedDate")&&Object(o.j)(a.a.SessionManager.Preferences.DocDateasPostedDate))||(this.ButtonApprove.Enable=!1)):null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&e.Columns[0].Contains("StatusID")&&!n.e.IsEmpty(e.Tables[0][0].StatusID)&&376==parseInt(e.Tables[0][0].StatusID)?(this.ButtonSaveandPrint.Enable=!1,this.ButtonSaveandBarcode.Enable=!1,this.ButtonApprove.Visible=!1,this.ButtonDelete.Visible=!1,this.ButtonSuspendDoc.Visible=!1,a.a.SessionManager.HideUnathorizedAccess?(this.ButtonSave.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Post Cancelled Documents"),this.ButtonSave.Enable=!0):this.ButtonSave.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Post Cancelled Documents")):i.Visible&&"true"==a.a.SessionManager.Preferences["Override Workflow"].toLowerCase()&&"1"==a.a.SessionManager.UserID?(this.ButtonDelete.Visible=!0,this.ButtonSuspendDoc.Visible=!0,this.ButtonRevise.Visible=!0,this.ButtonSave.Visible=!0,this.ButtonDelete.Enable=!0,this.ButtonSuspendDoc.Enable=!0,this.ButtonRevise.Enable=!0,this.ButtonSave.Enable=!0):i.Visible&&!(this.ButtonApprove.Enable&&this.ButtonApprove.Visible||this.ButtonSave.Enable&&this.ButtonSave.Visible)?e.Tables.length>6&&e.Tables[6].length>0&&e.Columns[6].Contains("userlevel")&&!n.e.IsEmpty(e.Tables[6][0].userlevel)&&e.Columns[6].Contains("Wlevel")&&n.e.String(e.Tables[6][0].Wlevel)==n.e.String(e.Tables[6][0].userlevel)&&s.Visible?this.ButtonDelete.Visible&&this.ButtonDelete.Enable||(this.ButtonDelete.Visible=!0,this.ButtonDelete.Enable=!0,this.ButtonSuspendDoc.Visible=!0,this.ButtonSuspendDoc.Enable=!0,a.a.SessionManager.HideUnathorizedAccess?this.ButtonDelete.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"):this.ButtonDelete.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),a.a.SessionManager.HideUnathorizedAccess?this.ButtonSuspendDoc.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Suspend"):this.ButtonSuspendDoc.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Suspend")):(this.ButtonDelete.Enable=!1,this.ButtonSuspendDoc.Enable=!1,this.ButtonRevise.Visible&&372==this.StatusID||(this.ButtonRevise.Visible=!1)):this.ButtonDelete.Visible&&this.ButtonDelete.Enable||(this.ButtonDelete.Visible=!0,this.ButtonDelete.Enable=!0,this.ButtonSuspendDoc.Visible=!0,this.ButtonSuspendDoc.Enable=!0,a.a.SessionManager.HideUnathorizedAccess?this.ButtonDelete.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"):this.ButtonDelete.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),a.a.SessionManager.HideUnathorizedAccess?this.ButtonSuspendDoc.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Suspend"):this.ButtonSuspendDoc.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Suspend")),!(i.Visible&&a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Suspend")&&a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Withdraw"))||this.ButtonSuspendDoc.Visible&&this.ButtonSuspendDoc.Enable||376==this.StatusID||(this.ButtonSuspendDoc.Visible=this.ButtonSuspendDoc.Enable=!0),a.a.SessionManager.HideUnathorizedAccess?i.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"History"):i.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"History"),a.a.SessionManager.Preferences.ContainsKey("LockEditMode")&&Object(o.j)(a.a.SessionManager.Preferences.LockEditMode)){let t=this.GetButton("Lock");this.ButtonSave.Visible&&this.ButtonSave.Enable&&e.Tables.length>6&&e.Tables[6].length>0&&null==e.Tables[6][0].LockedBY?(t.Visible=!0,t.Label="Lock",t.Mandatory=!0):e.Tables.length>6&&e.Tables[6].length>0&&null!=e.Tables[6][0].LockedBY&&(e.Tables[6][0].LockedBY.toString()==a.a.SessionManager.UserName?(t.Visible=!0,t.Mandatory=!1,t.Label="Unlock"):(this.IsUserLock=!0,this.DocStatus+="(LockedBy "+e.Tables[6][0].LockedBY.toString()+")"))}if(a.a.SessionManager.IsOffline&&this.ScreenObject.DocID<0&&(e.Tables.length>6&&e.Tables[6].length>0&&e.Columns[6].Contains("OffLineStatus")&&"1"==e.Tables[6][0].OffLineStatus.toString()?(t=this.GetButton("Pay"),null!=t&&(t.Visible=!1),this.ButtonSave.Visible=this.ButtonDelete.Visible=s.Visible=this.ButtonRevise.Visible=this.ButtonSaveandPrint.Visible=!1):a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit")&&!this.ButtonSave.Visible&&(this.ButtonSave.Visible=!0,t=this.GetButton("Pay"),null!=t&&(t.Visible=!0),this.ButtonSuspendDoc.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Suspend"),this.ButtonDelete.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),this.ScreenObject.Preferences.ContainsKey("EnableRevision")&&""!=this.ScreenObject.Preferences.EnableRevision&&Object(o.j)(this.ScreenObject.Preferences.EnableRevision)&&(this.ButtonRevise.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Revise")))),this.ScreenObject.Preferences.ContainsKey("ShowPackStat")&&Object(o.j)(this.ScreenObject.Preferences.ShowPackStat))if(e.Tables[26].filter(e=>2==e.Type).length>0){let t=!1;for(let s=0;s<this.ScreenObject.GridData.length;s++)if(!n.e.IsEmpty(this.ScreenObject.GridData[s].DocDetailsID)){let i=e.Tables[26].filter(e=>2==e.Type&&e.InvDocDetailsID==this.ScreenObject.GridData[s].DocDetailsID).Compute("sum","Quantity");if(null==i||i.toString()!=this.ScreenObject.GridData[s].Quantity.toString()){t=!0;break}}this.DocStatus+=t?"(Partially packed)":"(Packed)"}else this.DocStatus+="(To be packed)";this.WFDocLevelList.Clear();let S=null,p=null;if(this.IsInventoryVoucher&&e.Tables.length>25?(S=e.Tables[25],p=e.Tables[24]):!this.IsInventoryVoucher&&e.Tables.length>15&&(S=e.Tables[15],p=e.Tables[14]),null!=S&&S.length>0&&!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"HideWorkflowLevels")){let t,s=0;n.e.IsEmpty(e.Tables[0][0].WorkFlowLevel)||(s=parseInt(e.Tables[0][0].WorkFlowLevel)),p.length>0&&(t=parseInt(p[p.length-1].StatusID)),console.log("WF"),console.log(S);let i=p.length>0?parseInt(p[0].WorkFlowLevel)-1:0;for(let e=0;e<S.length;e++){let t=new Ie.a(parseInt(S[0].WID),parseInt(S[e].levelID),S[e].LevelName.toString(),this.CostCenterID,this.ScreenObject.DocID,this.ScreenObject.DocDate.Date);e==i&&(t.IsPending=!0,t.Label="C"),0==e&&(t.LeftLineBrush=""),e==S.length-1&&(t.RightLineBrush=""),this.WFDocLevelList.push(t)}for(let e=p.length-1;e>=0;e--){let t=parseInt(p[e].WorkFlowLevel);if(t<=s&&t<=this.WFDocLevelList.length&&!this.WFDocLevelList[t-1].IsSet){this.WFDocLevelList[t-1].IsSet=!0,this.WFDocLevelList[t-1].ModifiedBy=p[e].Status.toString()+" By "+p[e].CreatedBy.toString(),p[e].FirstName.toString().length>0&&(this.WFDocLevelList[t-1].ModifiedBy+="("+p[e].FirstName.toString()+")");let s=new Date(p[e].Date);this.WFDocLevelList[t-1].ModifiedBy+=" On "+s.ToString(a.a.SessionManager.Preferences["Date Format"]);let i=parseInt(p[e].StatusID);372==i?this.WFDocLevelList[t-1].IsRejected=!0:441==i?this.WFDocLevelList[t-1].IsApproved=!0:369!=i&&370!=i||(this.WFDocLevelList[t-1].IsPending=!0,this.WFDocLevelList[t-1].Label=" P"),this.WFDocLevelList[t-1].BgColor=es.getStatusColor(i)}}}if(this.CheckViewOnLoad(),69!=this.ScreenObject.DocumentType&&86!=this.ScreenObject.DocumentType&&91!=this.ScreenObject.DocumentType&&98!=this.ScreenObject.DocumentType||(this.BodyVisible=!1),71==this.ScreenObject.DocumentType){let e=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());if(e){let t=0;(e instanceof m.b||e instanceof C.a)&&(t=e.SelectedValue),t>0&&(this.dsData=this.ScreenObject.GetEmployeePayrollInfo(t,1,this.ScreenObject.DocDate.Date,0),this.dsData.Tables.length>0&&this.dsData.Tables[0].length>0&&this.SetNoofMonths(this.dsData))}}if(369==this.StatusID&&(62==this.ScreenObject.DocumentType||40063==this.ScreenObject.CostCenterID||40059==this.ScreenObject.CostCenterID||58==this.ScreenObject.DocumentType||67==this.ScreenObject.DocumentType||72==this.ScreenObject.DocumentType||97==this.ScreenObject.DocumentType)){let e=this.ScreenObject.GetPayrollProcessed(0,this.DocID);e.Tables.length>0&&e.Tables[0].length>0&&(this.ButtonSave.Visible=!1,this.ButtonDelete.Visible=!1,this.ButtonSuspendDoc.Visible=!1,62==this.ScreenObject.DocumentType||40063==this.ScreenObject.CostCenterID?a.a.SessionManager.Preferences.ContainsKey("AllowLeavesifPayrollProcessedorLocked")&&Object(o.j)("False"==a.a.SessionManager.Preferences.AllowLeavesifPayrollProcessedorLocked)?this.DocStatus+=" (Payroll Processed)":this.ButtonSave.Visible=!0:67==this.ScreenObject.DocumentType?a.a.SessionManager.Preferences.ContainsKey("AllowDailyPayrollEntryforPostedMonths")&&Object(o.j)("False"==a.a.SessionManager.Preferences.AllowDailyPayrollEntryforPostedMonths)?this.DocStatus+=" (Payroll Processed)":(this.ButtonSave.Visible=!0,this.ButtonDelete.Visible=!0,this.ButtonSuspendDoc.Visible=!0):72==this.ScreenObject.DocumentType?a.a.SessionManager.Preferences.ContainsKey("AllowVacationifPayrollProcessedorLocked")&&Object(o.j)("False"==a.a.SessionManager.Preferences.AllowVacationifPayrollProcessedorLocked)?this.DocStatus+=" (Payroll Processed)":(this.ButtonSave.Visible=!0,this.ButtonDelete.Visible=!0):this.DocStatus+=" (Payroll Processed)")}if(68==this.ScreenObject.DocumentType){let e=(new Date).OnlyDate(),t=(new Date).OnlyDate(),s="0",i=null;for(let r=0;r<this.ScreenObject.GridData.length;r++)if(this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[r].ProductID_Key)){i=this.ScreenObject.GridData[r];let n=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase());if(null!=n&&null!=n)e=new Date(n.Date.getFullYear(),n.Date.iMonth(),1);else{let t=this.ScreenObject.ColumnSource.find(e=>"dcalpha2"==e.DisplayMember.toLowerCase());null!=t&&null!=i[t.DisplayMember+"_Key"]&&null!=i[t.DisplayMember+"_Key"]&&""!=i[t.DisplayMember+"_Key"].toString()&&(e=new Date(i[t.DisplayMember+"_Key"]))}if(n=this.ScreenObject._TextFields.find(e=>"dcalpha4"==e.DBColumnName.toLowerCase()),null!=n)t=new Date(n.Date.getFullYear(),n.Date.iMonth(),1);else{let e=this.ScreenObject.ColumnSource.find(e=>"dcalpha4"==e.DisplayMember.toLowerCase());null!=e&&null!=i[e.DisplayMember+"_Key"]&&null!=i[e.DisplayMember+"_Key"]&&""!=i[e.DisplayMember+"_Key"].toString()&&(t=new Date(i[e.DisplayMember+"_Key"]))}if(n=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase()),null!=n)(n instanceof m.b||n instanceof C.a)&&(s=n.SelectedValue.toString());else{let e=this.ScreenObject.ColumnSource.find(e=>"LISTBOX"==e.DataType.toUpperCase()&&"dcccnid51_key"==e.ValueMember.toLowerCase());null!=e&&null!=i[e.ValueMember]&&null!=i[e.ValueMember]&&""!=i[e.ValueMember].toString()&&(s=i[e.ValueMember].toString())}let o=a.a.common.GetDataTable("PAY090",s.toString()+"~"+e+"~"+t),l=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase());null!=l&&(l.IsReadOnly=!1),null!=o&&o.length>0&&(null!=l&&(l.IsReadOnly=!0),this.ReadOnlyBody=!0)}}if(72==this.ScreenObject.DocumentType){let e=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());if(e){let t="0";(e instanceof m.b||e instanceof C.a)&&(t=e.SelectedValue.toString()),parseInt(t)>0&&this.ShowVacationCreditDaysDetail(parseInt(t))}let t=this.ScreenObject._TextFields.find(e=>"dcalpha6"==e.DBColumnName.toLowerCase());t instanceof u.d&&""!=t.Text&&(this.GridNetTotal=parseFloat(t.Text),this.RefreshNetAmount())}if(77==this.ScreenObject.DocumentType&&this.FillPayrollLockUnlockDetails(!0),56==this.ScreenObject.DocumentType){if(this.dsData=this.ScreenObject.CheckLoanRepayAmountDetails(this.DocID),this.dsData.Tables.length>0&&this.dsData.Tables[0].length>0){let t=this.GetButton("Distribute");null!=t&&(t.Visible=!(parseFloat(this.dsData.Tables[0][0][e.Columns[0][0]])>0))}this.EmployeewiseDocumentView(40056,this.strEmpIsMgr,"True")}if(81==this.ScreenObject.DocumentType||this.IsNewAssignLeave){this.dtData=null;let t=this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase());t&&t instanceof D.e&&!n.e.IsEmpty(t.SelectedValue)&&(this.IsNewAssignLeave?this.LoadGradeDataNew(1,new Date,t.SelectedValue.toString(),e):this.LoadGradeData(1,new Date,t.SelectedValue.toString()))}if(67==this.ScreenObject.DocumentType&&this.ScreenObject.IsDocEdit){this.ScreenObject.GridDataColumns.Contains("Row_Background")||this.ScreenObject.GridDataColumns.push("Row_Background");let e=Date.Today().ToString("dd/MMM/yyyy"),t="1",s=!1;for(let i=0;i<this.ScreenObject.GridData.length;i++)if(null!=this.ScreenObject.GridData[i].ProductID_Key&&null!=this.ScreenObject.GridData[i].ProductID_Key&&!n.e.IsEmpty(this.ScreenObject.GridData[i].ProductID_Key)){let a=this.ScreenObject.GridData[i],r=this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase());if(r instanceof d.c)e=r.Date.ToString("dd/MMM/yyyy");else{let t=this.ScreenObject.ColumnSource.find(e=>"dcalpha1"==e.DisplayMember.toLowerCase());t&&null!=a[t.DisplayMember+"_Key"]&&null!=a[t.DisplayMember+"_Key"]&&!n.e.IsEmpty(a[t.DisplayMember+"_Key"])&&(e=new Date(a[t.DisplayMember+"_Key"]).ToString("dd/MMM/yyyy"),s=!0)}if(r=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase()),r)(r instanceof m.b||r instanceof C.a)&&(t=r.SelectedValue.toString());else{let e=this.ScreenObject.ColumnSource.find(e=>"LISTBOX"==e.DataType.toUpperCase()&&"dcccnid51_key"==e.ValueMember.toLowerCase());e&&null!=a[e.ValueMember]&&null!=a[e.ValueMember]&&!n.e.IsEmpty(a[e.ValueMember])&&(t=a[e.ValueMember].toString())}s&&(null==this.objPayDayCheck&&(this.objPayDayCheck=new at.a(this.ScreenObject)),this.objPayDayCheck.CheckIsHolidayDate(t,e,a))}}if(89==this.ScreenObject.DocumentType||90==this.ScreenObject.DocumentType){let e=null,t=null,s=null,i=null,a=new Date;this.ScreenObject.GridData.forEach(r=>{let o=this.ScreenObject.ColumnSource.find(e=>"dcalpha1"==e.DisplayMember.toLowerCase());o&&!n.e.IsEmpty(r[o.DisplayMember+"_Key"])&&(e=new Date(r[o.DisplayMember+"_Key"])),o=this.ScreenObject.ColumnSource.find(e=>"dcalpha2"==e.DisplayMember.toLowerCase()),o&&!n.e.IsEmpty(r[o.DisplayMember+"_Key"])&&(a=new Date(r[o.DisplayMember+"_Key"]),t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),a.getHours(),a.getMinutes(),a.getSeconds()),r[o.DisplayMember+"_Key"]=t),o=this.ScreenObject.ColumnSource.find(e=>"dcalpha3"==e.DisplayMember.toLowerCase()),o&&!n.e.IsEmpty(r[o.DisplayMember+"_Key"])&&(s=new Date(r[o.DisplayMember+"_Key"])),o=this.ScreenObject.ColumnSource.find(e=>"dcalpha4"==e.DisplayMember.toLowerCase()),o&&!n.e.IsEmpty(r[o.DisplayMember+"_Key"])&&(a=new Date(r[o.DisplayMember+"_Key"]),i=new Date(s.getFullYear(),s.getMonth(),s.getDate(),a.getHours(),a.getMinutes(),a.getSeconds()),r[o.DisplayMember+"_Key"]=i),this.ScreenObject.GridDataObj.updateRow(r)});let r=this.ScreenObject._TextFields.find(e=>"dcalpha26"==e.DBColumnName.toLowerCase());r&&(r.Date=null),r=this.ScreenObject._TextFields.find(e=>"dcalpha27"==e.DBColumnName.toLowerCase()),r&&(r.Date=null)}if(92==this.ScreenObject.DocumentType&&this.LoadEditShiftAssign(e),73==this.ScreenObject.DocumentType)t=this.GetButton("Post"),null!=t&&(t.Visible=!1),t=this.GetButton("SaveAndPrint"),null!=t&&(t.Visible=!1);else if(89==this.ScreenObject.DocumentType||90==this.ScreenObject.DocumentType){let e=this.ScreenObject._TextFields.find(e=>"dcalpha32"==e.DBColumnName.toLowerCase());e instanceof D.e&&(null!=e.SelectedValue&&"Manual"==e.SelectedValue?(this.ScreenObject._TextFields.forEach(e=>{"dcalpha26"==e.DBColumnName.toLowerCase()?e.IsReadOnly=!0:"dcalpha27"==e.DBColumnName.toLowerCase()&&(e.Enable=!1)}),this.SetButtonVisibility("Save",!0),this.SetButtonVisibility("SaveAndPrint",!0),this.SetButtonVisibility("Check-in",!1),this.SetButtonVisibility("Check-out",!1)):(this.ScreenObject._TextFields.forEach(e=>{"dcalpha26"==e.DBColumnName.toLowerCase()?e.IsReadOnly=!1:"dcalpha27"==e.DBColumnName.toLowerCase()&&(e.Enable=!0)}),this.SetButtonVisibility("Save",!1),this.SetButtonVisibility("SaveAndPrint",!1),this.SetButtonVisibility("Check-in",!0),this.SetButtonVisibility("Check-out",!0)))}else if(97==this.ScreenObject.DocumentType){let e=this.ScreenObject._TextFields.find(e=>"dcAlpha16"==e.DBColumnName.toString());e instanceof d.c&&(this.dtPayMon=e.Date.Date())}else if(62==this.ScreenObject.DocumentType){this.ReadOnlyBody=!1;let e=this.ScreenObject._TextFields.find(e=>"dcalpha16"==e.DBColumnName.toLowerCase());e&&e instanceof u.d&&null!=e.Text&&"LatesProcessing"==e.Text&&(this.ReadOnlyBody=!0)}else if(100==this.ScreenObject.DocumentType){let e,t=["#017EFA","#21bf74","#FFAA2E","#293978","#33a9b6","#ff3333"];this.ScreenObject.GridData.forEach(s=>{s.SchemeID&&(s.ParentSchemeID=s.SchemeID,s.MaxSchemeID=s.SchemeID,e==n.e.Int(s.SchemeID)?(s.drEdit="N",s.drDelete="N",s.IsScheme="Y"):s.IsScheme="N",e=n.e.Int(s.SchemeID),s.MCColorID=t[e%t.length])}),this.ScreenObject.GridDataObj.MobileAddLine&&this.ScreenObject.GridDataObj.MobileAddLine.RefreshWidgetData()}null!=s&&(t=this.GetButton("Submitprint"),s.Visible&&a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Print")&&null!=t?t.Visible=!0:null!=t&&(t.Visible=!1));for(let a=0;a<this.Shortcuts.length;a++)this.Shortcuts[a]instanceof y.a&&15==this.Shortcuts[a].Mode&&this.ScreenObject.GridData.length>0&&this.ValidateData_Column(this.Shortcuts[a],this.ScreenObject.GridData[0],!0)?this.ScreenObject.GetExternalFuncData(this.Shortcuts[a].Mode,this.Shortcuts[a].SPName,this.Shortcuts[a].IPParams,this.Shortcuts[a].OPParams,this.ScreenObject.GridData[0],!0):this.Shortcuts[a]instanceof b.c&&15==this.Shortcuts[a].Mode&&this.ScreenObject.GetExternalFuncData(this.Shortcuts[a].Mode,this.Shortcuts[a].ToolTipFooterTitle,this.Shortcuts[a].ToolTipFooterDescription,this.Shortcuts[a].ToolTipDescription,null,!0);if(this.ScreenObject.Preferences.ContainsKey("HideBody")&&!n.e.IsEmpty(this.ScreenObject.Preferences.HideBody)&&Object(o.j)(this.ScreenObject.Preferences.HideBody.toString())&&(this.BodyVisible=!1),40045==this.CostCenterID&&this.ScreenObject.GridDataColumns.Contains("dcAlpha15_Key"))for(let a=0;a<this.ScreenObject.GridData.length;a++)n.e.IsEmpty(this.ScreenObject.GridData[a].dcAlpha15_Key)||this.Celleditend(this.ScreenObject.GridData[a],"dcAlpha15",40045);Logger.InfoLog("AddEditDocumentViewModel::Exiting LoadEditCallBack")}ClearCallBack(e){"Clear"==e||alert(e)}OnDeleteCallBack(){let e=0,t="";if(this.IsSuspend){let s=!1;this.ScreenObject.Preferences.ContainsKey("SuspendAllDocs")&&"True"==this.ScreenObject.Preferences.SuspendAllDocs&&confirm("Do you want to suspend linked documents?")&&(s=!0);let i=this.ScreenObject.SuspentDocument(s,"");t=i.Message,e=i.RetValue}else{let s=this.ScreenObject.DeleteDocument();t=s.Message,e=s.RetValue}72!=this.ScreenObject.DocumentType||this.ReevaluateFutureVac||1!=e||this.ReevaluateFutureVacation(),this.ScreenObject.CheckViewForUser(0),this.clear(e),this.DisplayMessage=t}setDefaultCurrency(){null!=this.Currency&&(!n.e.IsEmpty(this.Currency.DefaultValue)&&parseInt(this.Currency.DefaultValue)>0?this.Currency.Currency.SelectedValue!=this.Currency.DefaultValue&&(this.Currency.Currency.SelectedValue=this.Currency.DefaultValue,this.Currency.ExchangeRate.Text=this.ScreenObject.GetExchangeRate(parseInt(this.Currency.Currency.SelectedValue),this.DocumentDate).toString()):(this.Currency.Currency.SelectedValue="1",this.Currency.ExchangeRate.Text="1"))}ClearLeaveData(){this.ScreenObject.GridDataObj.Clear();let e=this.ScreenObject.GridDataObj.NewRow();e.DocSeqNo=1,e.DocDetailsID=0,this.ScreenObject.GridDataObj.Table.push(e),this.ScreenObject.GridDataObj.refreshDataView(),this.leaveTab.Fields.forEach(e=>{e instanceof m.b?e.OnPactListBoxValueChanged=new b.b:e instanceof d.a||e instanceof d.c?e.SelectedDateChanged=new b.b:e instanceof D.e?e.SelectionChangedCommand=new b.b:e instanceof u.d&&(e.TextChangedCommand=new b.b)}),this.leaveTab.Fields.forEach(e=>{e instanceof m.b?(e.SelectedValue=0,e.SelectedValueText=""):e instanceof d.a||e instanceof d.c?(e.Date=null,e.Text=""):e instanceof D.e?(e.Text="",e.SelectedValue=""):e instanceof u.d&&(e.Text="")}),this.prepareLineItemsToForm()}clear(e){if(1==e||2==e||3==e||4==e||5==e){if(4!=e){let t=this.DocumentDate,s={value:this._Ddate};this.ScreenObject.Clear(s,e),this._Ddate=s.value,t!=this.DocumentDate&&(2==e?this.CheckDateInDocNumber(!1,!1):1==e&&this.CheckDateInDocNumber(!1)),3==e&&this.ChangeDateIfDateExists(this.ScreenObject.DocPrefix.ComboBox.SelectedValue)}if(this.setDefaultCurrency(),null!=this.pdcGCVM&&(this.pdcGCVM=new ue.a(this)),14==this.ScreenObject.DocumentType||19==this.ScreenObject.DocumentType){let e=this.ScreenObject.ColumnSource.find(e=>"StatusID"==e.DisplayMember);e&&(e.IsVisible="[Partial]"==this.DocStatus)}let t=this.ScreenObject.Data.Tables[10].length>0?this.ScreenObject.Data.Tables[10].filter(e=>-2==e.CostCenterColID&&(1==e.Mode||3==e.Mode)):[];if(t.length>0?(this.BodyVisible=Object(o.j)(t[0].IsVisible),this.ReadOnlyBody=!Object(o.j)(t[0].IsEditable)):(this.BodyVisible=!0,this.ReadOnlyBody=!1,this.ReadOnlyBody=!(!this.ScreenObject.Preferences.ContainsKey("Lock Body")||""==this.ScreenObject.Preferences["Lock Body"]||!Object(o.j)(this.ScreenObject.Preferences["Lock Body"]))),this.IsInventoryVoucher&&null!=this.AssignAddress&&(this.AssignAddress.BillsVisibe=!!this.ScreenObject.Preferences.ContainsKey("BillingAddress")&&Object(o.j)(this.ScreenObject.Preferences.BillingAddress),this.AssignAddress.ShipVisibe=!!this.ScreenObject.Preferences.ContainsKey("ShippingAddress")&&Object(o.j)(this.ScreenObject.Preferences.ShippingAddress),this.AssignAddress.PrimVisibe=!!this.ScreenObject.Preferences.ContainsKey("PrimaryAddress")&&Object(o.j)(this.ScreenObject.Preferences.PrimaryAddress),t=this.ScreenObject.Data.Tables[10].length>0?this.ScreenObject.Data.Tables[10].filter(e=>-6==e.CostCenterColID&&(1==e.Mode||3==e.Mode)):[],this.AssignAddress.PrimVisibe&&t.length>0?(this.AssignAddress.PrimVisibe=Object(o.j)(t[0].IsVisible),this.AssignAddress.PrimMandatory=Object(o.j)(t[0].IsMandatory)):this.AssignAddress.PrimMandatory=!1,t=this.ScreenObject.Data.Tables[10].length>0?this.ScreenObject.Data.Tables[10].filter(e=>-7==e.CostCenterColID&&(1==e.Mode||3==e.Mode)):[],this.AssignAddress.BillsVisibe&&t.length>0?(this.AssignAddress.BillsVisibe=Object(o.j)(t[0].IsVisible),this.AssignAddress.BillsMandatory=Object(o.j)(t[0].IsMandatory)):this.AssignAddress.BillsMandatory=!1,t=this.ScreenObject.Data.Tables[10].length>0?this.ScreenObject.Data.Tables[10].filter(e=>-8==e.CostCenterColID&&(1==e.Mode||3==e.Mode)):[],this.AssignAddress.ShipVisibe&&t.length>0?(this.AssignAddress.ShipVisibe=Object(o.j)(t[0].IsVisible),this.AssignAddress.ShipMandatory=Object(o.j)(t[0].IsMandatory)):this.AssignAddress.ShipMandatory=!1),this.WfID=0,this.WorkFlowDocLevel=0,this.WFDocLevelList.Clear(),this.StatusID=0,this.payTermXml="",this.LCBillsXml="",this.ChkRtnXml="",this.ArApBills="",this.IsUserLock=!1,this.IsLocked=!1,null!=this.CaseList&&this.CaseList.Clear(),null!=this.DtTempSchemes&&this.DtTempSchemes.Clear(),null!=this.DtPack&&this.DtPack.Clear(),null!=this.AssignAddress&&(this.AssignAddress.AddressTo.Clear(),this.AssignAddress.BillTo.Clear(),this.AssignAddress.ShipTo.Clear()),null!=this.ChequeBook&&(this.ChequeBook.Items.Clear(),this.ChequeBook.SelectedValue=""),null!=this.ViewNotes&&this.ViewNotes.NotesListObj.Clear(),null!=this.AutoPostViewModel){let t={value:this.AutoPostViewModel._Ddate};this.AutoPostViewModel.ScreenObject.Clear(t,e),this.AutoPostViewModel._Ddate=t.value,null!=this.AutoPostViewModel.AutoProduce&&(t={value:this.AutoPostViewModel.AutoProduce._Ddate},this.AutoPostViewModel.AutoProduce.ScreenObject.Clear(t,e),this.AutoPostViewModel.AutoProduce._Ddate=t.value)}if(null!=this.AutoProduce){let t={value:this.AutoProduce._Ddate};this.AutoProduce.ScreenObject.Clear(t,e),this.AutoProduce._Ddate=t.value}if(this.ScreenObject.IsDirty=!1,null!=this.donotupInv&&(this.donotupInv.IsChecked=this.DonotUpdateInventory),null!=this.ViewAttachments&&this.ViewAttachments.AttachmentsListObj.Clear(),null!=this.grdLinkTab&&this.grdLinkTab.Clear(),null!=this.ViewActivities&&(this.ViewActivities.ActivityGridDataObj.Clear(),this.ViewActivities.NodeID=0),null!=this.Activities&&this.Activities.ClearFields(),null!=this.POSPayModes&&this.POSPayModes.clear(),null!=this.ViewOrganizationViewModel&&this.ViewOrganizationViewModel.OrganizationData.Clear(),this.IsExpressionAvailable("ServerDate")){let e=a.a.common.GetDataSet("DOC001","");if(null!=e&&e.Tables.length>0&&!e.Columns[0].Contains("ErrorMessage")&&e.Tables[0].length>0&&""!=e.Tables[0][0].dt&&null!=this.fldDict)if(a.a.SessionManager.IsWebApplication){let t=new Date(e.Tables[0][0].dt);this.fldDict.ServerDate.setFieldValue(t.ToString("MMM/dd/yyyy")),this.FooterDics.ServerDate.setFieldValue(t.ToString("MMM/dd/yyyy"))}else this.fldDict.ServerDate.setFieldValue(e.Tables[0][0].dt),this.FooterDics.ServerDate.setFieldValue(e.Tables[0][0].dt)}null!=this.ScreenObject.Link&&(this.ScreenObject.Link.LinkStatus="[Open]"),this.ScreenObject.IsForecast&&(this.ScreenObject.ForecastObj.Clear(),this.ScreenObject.GridDataObj.RefreshColumns()),this.AutoPostDocID=0,this.IsReplaced=0,this.AutoProduceDocID=0,this.LCDueAmt=0,this.DocStatus="POSDocumentViewModel"==this.ClassName?"":"["+a.a.GetResource("Doc_Draft")+"]",this.GridNetTotal=0,this.FooterGridNetTotal=0,this.Title=this.ScreenName,this.RefreshNetAmount();let s=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&55500==e.LinkData);if(s.length>0){let e=this.ScreenObject._TextFields.find(e=>e.DBColumnID==s[0].CostCenterColID);e&&e instanceof u.d&&(e.Text="0")}if(this.FillExchangeRates(),this.UpdateFooter=!0,this.AppRejDate.Date=new Date,this.Remarks.Text="",this.ReviseReason="",this.DocHistoryVisibility&&this.DocHistory.Clear(),4!=e&&this.SetFocus(),this.SetNewDocButtonVisibility(),this.SetSaveVisibility(),this.ConsolidateLeaveMonth(),this.dtLoanGuarantees=null,this.dsProjWOffHol=null,this.PrevVacFrom=new Date,this.PrevVacTo=new Date,62==this.ScreenObject.DocumentType&&this.ClearLeaveData(),1==e&&(94!=this.ScreenObject.DocumentType&&99!=this.ScreenObject.DocumentType||this.ScreenObject.GridDataObj.Clear(),71==this.ScreenObject.DocumentType&&(this.PostSalaryDocResetColumns(),this.FillEarnDeductDetails(0,parseInt(new Date(this.ScreenObject.DocDate.Date).ToString("yyyy")))),72==this.ScreenObject.DocumentType)){let e=this.ScreenObject._TextFields.find(e=>"dcalpha15"==e.DBColumnName.toLowerCase());e instanceof D.e&&!n.e.IsEmpty(e.SelectedValue)&&(e.IsReadOnly=!1),e=this.ScreenObject._TextFields.find(e=>"dcalpha16"==e.DBColumnName.toLowerCase()),e instanceof D.e&&!n.e.IsEmpty(e.SelectedValue)&&(e.IsReadOnly=!1),e=this.ScreenObject._TextFields.find(e=>"dcalpha13"==e.DBColumnName.toLowerCase()),e instanceof D.e&&(e.SelectedValue="No",e.IsReadOnly=!1),e=this.ScreenObject._TextFields.find(e=>"dcalpha16"==e.DBColumnName.toLowerCase()),e instanceof D.e&&(e.SelectedValue="No",e.IsReadOnly=!1),e=this.ScreenObject._TextFields.find(e=>"dcalpha4"==e.DBColumnName.toLowerCase()),e instanceof u.d&&(e.IsReadOnly=!0),e=this.ScreenObject._TextFields.find(e=>"dcalpha14"==e.DBColumnName.toLowerCase()),e instanceof u.d&&(e.IsReadOnly=!0),e=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase()),e instanceof d.c&&(e.IsReadOnly=!1),e=this.ScreenObject._TextFields.find(e=>"dcalpha3"==e.DBColumnName.toLowerCase()),e instanceof d.c&&(e.IsReadOnly=!1),e=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase()),(e instanceof m.b||e instanceof C.a)&&(e.IsReadOnly=!1),this.FillEarningsDeductions(0,this.ScreenObject.DocDate.Date),this.ShowVacationCreditDaysDetail(0)}if(72==this.ScreenObject.DocumentType&&this.ShowVacationCreditDaysDetail(0),75==this.ScreenObject.DocumentType&&this.FillGratuitySettingsExpDetails(),76==this.ScreenObject.DocumentType&&this.FillForm12BALookupDetails(),77==this.ScreenObject.DocumentType&&this.FillPayrollLockUnlockDetails(!1),72==this.ScreenObject.DocumentType&&null!=this.oVac&&(this.oVac=null),68==this.ScreenObject.DocumentType){let e=this.ScreenObject._TextFields.find(e=>"dcAlpha2"==e.DBColumnName.toString());null!=e&&(e.Date=new Date(a.a.SessionManager.PayrollMonth),e.CustomFormat="MMM/yyyy"),e=this.ScreenObject._TextFields.find(e=>"dcAlpha4"==e.DBColumnName.toString()),null!=e&&(e.Date=new Date(a.a.SessionManager.PayrollMonth),e.CustomFormat="MMM/yyyy")}if(86==this.ScreenObject.DocumentType){let e=this.ScreenObject._TextFields.find(e=>"dcAlpha2"==e.DBColumnName.toString());e instanceof d.b&&(e.CustomFormat="HH:mm",e.Date=new Date),e=this.ScreenObject._TextFields.find(e=>"dcAlpha3"==e.DBColumnName.toString()),e instanceof d.b&&(e.CustomFormat="HH:mm",e.Date=new Date);let t=this.ScreenObject._TextFields.find(e=>"dcAlpha3"==e.DBColumnName.toString());t&&this.onDateChanged(t)}if(85==this.ScreenObject.DocumentType){let e=this.ScreenObject._TextFields.find(e=>"dcAlpha1"==e.DBColumnName.toString());e instanceof d.c&&(e.CustomFormat="MMM/yyyy",e.Date=new Date((new Date).getFullYear(),(new Date).getMonth(),1)),e=this.ScreenObject._TextFields.find(e=>"dcAlpha2"==e.DBColumnName.toString()),e instanceof d.c&&(e.CustomFormat="MMM/yyyy",e.Date=new Date((new Date).getFullYear(),(new Date).getMonth(),1)),e=this.ScreenObject._TextFields.find(e=>"dcAlpha4"==e.DBColumnName.toString()),e instanceof d.c&&(e.CustomFormat="MMM/yyyy",e.Date=new Date((new Date).getFullYear(),(new Date).getMonth(),1))}if(56==this.ScreenObject.DocumentType&&this.EmployeewiseDocumentView(40056,this.strEmpIsMgr,"False"),81==this.ScreenObject.DocumentType){this.ScreenObject._TextFields.forEach(e=>{e instanceof D.e&&"dcalpha1"==e.DBColumnName.toLowerCase()&&e.SelectionChangedCommand.Subscribe(this,"LeavesBasedon"),e instanceof D.e&&"dcalpha2"==e.DBColumnName.toLowerCase()&&(e.IsReadOnly=!1)});let e=this.ScreenObject._CCFields.find(e=>"dcccnid2"==e.DBColumnName.toLowerCase());e&&e instanceof m.b&&(e.Enable=!0),this.dtData=null;let t=this.ScreenObject.ColumnSource.find(e=>50051==e.CostCenterID);t&&t instanceof y.a&&(t.IsVisible=!1)}if(67==this.ScreenObject.DocumentType){let e=a.a.common.GetDataSet("PAY033",this.ScreenObject.CostCenterID.toString());null!=e&&0==e.Tables[0].length&&(this.ReadOnlyBody=!0)}if(97==this.ScreenObject.DocumentType){this.ScreenObject.GridDataObj.Clear(),this.dtPayMon=new Date,this.dtPayMonStart=new Date,this.dtPayMonEnd=new Date;let e=this.ScreenObject._TextFields.find(e=>"dcAlpha16"==e.DBColumnName.toString());null!=e&&(e.CustomFormat="01/MMM/yyyy",e.Date=new Date(a.a.SessionManager.PayrollMonth)),e=this.ScreenObject._TextFields.find(e=>"dcAlpha33"==e.DBColumnName.toString()),null!=e&&(e.CustomFormat="01/MMM/yyyy",e.Date=new Date(a.a.SessionManager.PayrollMonth))}this.intRecCount=0,null!=this.objPayDayCheck&&(this.objPayDayCheck.dsWOffData={Tables:[]},this.objPayDayCheck.dsHMData={Tables:[]},this.objPayDayCheck.dtEmpData=null),this.dsSaved={Tables:[]},this.dsHrsDef={Tables:[]},this.dtEData=null,this.dtVacDefineDays=null,this.dtVacContract=null,this.IsLatesProcessTimingsUpdated=!1}this.ScreenObject.Preferences.ContainsKey("HideBody")&&!n.e.IsEmpty(this.ScreenObject.Preferences.HideBody)&&Object(o.j)(this.ScreenObject.Preferences.HideBody.toString())&&(this.BodyVisible=!1)}SetNewDocButtonVisibility(){let e=this.GetButton("Submit");null!=e&&(e.Visible=!1),e=this.GetButton("Submitprint"),null!=e&&(e.Visible=!1),e=this.GetButton("Generate"),null!=e&&(e.Visible=!1),e=this.GetButton("GST"),null!=e&&(e.Visible=!1),e=this.GetButton("API"),null!=e&&(e.Visible=!1),e=this.GetButton("Redeposit"),null!=e&&(e.Visible=!1),e=this.GetButton("Stock Posting"),null!=e&&(e.Visible=!1),e=this.GetButton("Enquiries"),null!=e&&(e.Visible=!1),e=this.GetButton("Bounce"),null!=e&&(e.Visible=!1),e=this.GetButton("Advance"),null!=e&&(e.Visible=!1),e=this.GetButton("PriceChart"),null!=e&&(e.Visible=!1),e=this.GetButton("Pay"),null!=e&&(e.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Create")),e=this.GetButton("Save"),null!=e&&(e.Visible=!0),e=this.GetButton("Convert"),null!=e&&(e.Visible=!1),e=this.GetButton("Close"),null!=e&&(e.Visible=!1),this.ApproveVisibility=!1,this.ButtonRevise.Visible=!1,this.ButtonApprove.Visible=!1,this.ButtonSuspend.Visible=!1,this.ButtonCloseVisibility=!1,this.CaseVisibility=!1,56==this.ScreenObject.DocumentType&&0==this.DocID&&(this.DistributeInstallmentsVisible=!0),92==this.ScreenObject.DocumentType&&(e=this.GetButton("Fill Dates"),null!=e&&(e.Visible=0==this.DocID)),this.ButtonSave.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Create"),this.ButtonSave.Enable=!!a.a.SessionManager.HideUnathorizedAccess||a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Create"),this.ButtonDelete.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),this.ButtonDelete.Enable=!!a.a.SessionManager.HideUnathorizedAccess||a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),this.ButtonSaveandPrint.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save&Print"),this.ButtonSaveandPrint.Enable=!!a.a.SessionManager.HideUnathorizedAccess||a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save&Print"),this.HideButtons("Save&Barcode"),this.HideButtons("BarcodePrint"),(this.IsMPVParent||this.IsFrmFS_LoanBal)&&(this.OKCancelVisibility=!0,this.ButtonCloseVisibility=!0,this.IsFrmFS_LoanBal&&(this.DisableRightPanel=!0))}DimWiseAttachment(e,t){e.length>0&&n.e.Int(e[0].FeatureID)>5e4&&this.ScreenObject.Preferences.ContainsKey("AutoDimWiseAttachments")&&Object(o.j)(this.ScreenObject.Preferences.AutoDimWiseAttachments)&&Object(o.j)(this.ScreenObject.Preferences.AutoDimWiseAttachments)}ReferenceCallBack(e){let t=e.ReferenceTable,s=e.DBColumnName,i=e.ccid,r=e.dr;if("LinkAll"==s){this.ScreenObject.GridDataObj.Clear(),this.ScreenObject.UpdateSequence();let e="";for(let t=0;t<this.ScreenObject.Link.DocumentList.Items.length;t++)""!=e&&(e+="','"),e+=this.ScreenObject.Link.DocumentList.Items[t].Name;""!=e&&this.FillLink(e,parseInt(this.ScreenObject.Link.LinkCombo.SelectedValue),[],[]),this.ScreenObject.UpdateSequence()}else if("ReCalculate"==s)this.onExchangeRateChanged(""),this.CalculateTotals(null,!1);else if("ReEvaluate"==s)null!=r?this.ReEvaluatePriceTax_3(r,i):this.ReEvaluatePriceTax(i);else if("Dimension"==s)this.DimensionSelectedvalueData();else if("Formula"==s){if(null==this.fldDict)return;this.ScreenObject._TextFields.forEach(e=>{this.fldDict.ContainsKey(e.Lbl)&&(e instanceof u.d?"FLOAT"==e.DataType?null!=e.Text&&""!=e.Text&&""==e.ValidateData()?this.fldDict[e.Lbl].setFieldValue(e.Text):this.fldDict[e.Lbl].setFieldValue(0):this.fldDict[e.Lbl].setFieldValue(e.Text):e instanceof D.e?this.fldDict[e.Lbl].setFieldValue(e.SelectedValue):e instanceof g.a?this.fldDict[e.Lbl].setFieldValue(e.Text):e instanceof d.c&&e.Date?this.fldDict[e.Lbl].setFieldValue(e.Date):e instanceof m.b&&(e.SelectedValue>0&&!n.e.IsEmpty(e.Text)?this.fldDict[e.Lbl].setFieldValue(e.Text):this.fldDict[e.Lbl].setFieldValue("")))}),this.fldDict.DOCDATE.setFieldValue(this.DocumentDate),this.fldDict.DUEDATE.setFieldValue(this.ScreenObject.DueDate&&this.ScreenObject.DueDate.Date?this.ScreenObject.DueDate.Date:Date.Today());let e=this.ScreenObject._StaticFields.find(e=>"billdate"==e.DBColumnName.toLowerCase());this.fldDict.BILLDATE.setFieldValue(e&&e instanceof d.c&&e.Date?e.Date:Date.Today());let t=a.a.eval.EvaluateExpression(this.ScreenObject.DueDate.Formula,this.fldDict);null!=t&&n.e.isValidDate(t)&&(this.ScreenObject.DueDate.Date=new Date(t))}else if(s.Contains("Attachments")&&null!=this.ViewAttachments)s=s.substr(s.indexOf("~")+1),this.DimWiseAttachment(t,s);else if(null!=r)this.ProdID=0,this.AddProductData(r,!1,!1),this.ApplySchemes(r);else if(null!=this.AssignAddress&&t.length>0){let e;this.ScreenObject.IsPurchase&&"creditaccount"==s.toLowerCase()?(this.AssignAddress.AddressTo.Clear(),this.AssignAddress.BillTo.Clear(),this.AssignAddress.ShipTo.Clear(),this.AssignAddress.AddressTo.push(D.d.ComboBoxItems_2("","")),this.AssignAddress.BillTo.push(D.d.ComboBoxItems_2("","")),this.AssignAddress.ShipTo.push(D.d.ComboBoxItems_2("","")),this.AssignAddress.AddressToName.Text="",this.AssignAddress.AddressTo1.Text="",this.AssignAddress.PhoneTo1.Text="",this.AssignAddress.AddressName.Text="",this.AssignAddress.Address1.Text="",this.AssignAddress.Phone1.Text="",this.AssignAddress.SAddressName.Text="",this.AssignAddress.SAddress1.Text="",this.AssignAddress.SPhone1.Text="",e=t.filter(e=>1==e.AddressTypeID),e.forEach(e=>{this.AssignAddress.AddressTo.push(D.d.ComboBoxItems_2(e.AddressName.toString(),e.AddressID.toString())),Object.keys(t[0]).Contains("IsDefault")&&Object(o.j)(e.IsDefault)&&(this.AssignAddress.SelectedAddressTo=n.e.String(e.AddressID),this.AssignAddress.AddressToName.Text=n.e.String(e.ContactPerson),this.AssignAddress.AddressTo1.Text=n.e.String(e.Address1)+" "+n.e.String(e.Address2)+" "+n.e.String(e.Address3),this.AssignAddress.PhoneTo1.Text=n.e.String(e.Phone1),this.AssignAddress.AddressToCity.Text=n.e.String(e.City)+" "+n.e.String(e.State)+" "+n.e.String(e.Zip),this.AssignAddress.AddressToVisbility=!0)}),e=t.filter(e=>2==e.AddressTypeID),e.forEach(e=>{this.AssignAddress.BillTo.push(D.d.ComboBoxItems_2(e.AddressName.toString(),e.AddressID.toString())),Object.keys(t[0]).Contains("IsDefault")&&Object(o.j)(e.IsDefault)&&(this.AssignAddress.SelectedAddressTo=n.e.String(e.AddressID),this.AssignAddress.AddressToName.Text=n.e.String(e.ContactPerson),this.AssignAddress.AddressTo1.Text=n.e.String(e.Address1)+" "+n.e.String(e.Address2)+" "+n.e.String(e.Address3),this.AssignAddress.PhoneTo1.Text=n.e.String(e.Phone1),this.AssignAddress.AddressToCity.Text=n.e.String(e.City)+" "+n.e.String(e.State)+" "+n.e.String(e.Zip),this.AssignAddress.AddressToVisbility=!0)}),e=t.filter(e=>3==e.AddressTypeID),e.forEach(e=>{this.AssignAddress.ShipTo.push(D.d.ComboBoxItems_2(e.AddressName.toString(),e.AddressID.toString())),Object.keys(t[0]).Contains("IsDefault")&&Object(o.j)(e.IsDefault)&&(this.AssignAddress.SelectedAddressTo=n.e.String(e.AddressID),this.AssignAddress.AddressToName.Text=n.e.String(e.ContactPerson),this.AssignAddress.AddressTo1.Text=n.e.String(e.Address1)+" "+n.e.String(e.Address2)+" "+n.e.String(e.Address3),this.AssignAddress.PhoneTo1.Text=n.e.String(e.Phone1),this.AssignAddress.AddressToCity.Text=n.e.String(e.City)+" "+n.e.String(e.State)+" "+n.e.String(e.Zip),this.AssignAddress.AddressToVisbility=!0)})):"debitaccount"==s.toLowerCase()&&(this.AssignAddress.ShipTo.Clear(),this.AssignAddress.ShipTo.push(D.d.ComboBoxItems_2("","")),this.AssignAddress.SAddressName.Text="",this.AssignAddress.SAddress1.Text="",this.AssignAddress.SPhone1.Text="",e=t.filter(e=>3==e.AddressTypeID),e.forEach(e=>{this.AssignAddress.ShipTo.push(D.d.ComboBoxItems_2(e.AddressName.toString(),e.AddressID.toString())),Object.keys(t[0]).Contains("IsDefault")&&Object(o.j)(e.IsDefault)&&(this.AssignAddress.SelectedAddressTo=n.e.String(e.AddressID),this.AssignAddress.AddressToName.Text=n.e.String(e.ContactPerson),this.AssignAddress.AddressTo1.Text=n.e.String(e.Address1)+" "+n.e.String(e.Address2)+" "+n.e.String(e.Address3),this.AssignAddress.PhoneTo1.Text=n.e.String(e.Phone1),this.AssignAddress.AddressToCity.Text=n.e.String(e.City)+" "+n.e.String(e.State)+" "+n.e.String(e.Zip),this.AssignAddress.AddressToVisbility=!0)}),this.ScreenObject.IsPurchase||(this.AssignAddress.AddressTo.Clear(),this.AssignAddress.BillTo.Clear(),this.AssignAddress.AddressTo.push(D.d.ComboBoxItems_2("","")),this.AssignAddress.BillTo.push(D.d.ComboBoxItems_2("","")),this.AssignAddress.AddressToName.Text="",this.AssignAddress.AddressTo1.Text="",this.AssignAddress.PhoneTo1.Text="",this.AssignAddress.AddressName.Text="",this.AssignAddress.Address1.Text="",this.AssignAddress.Phone1.Text="",e=t.filter(e=>1==e.AddressTypeID),e.forEach(e=>{this.AssignAddress.AddressTo.push(D.d.ComboBoxItems_2(e.AddressName.toString(),e.AddressID.toString())),Object.keys(t[0]).Contains("IsDefault")&&Object(o.j)(e.IsDefault)&&(this.AssignAddress.SelectedAddressTo=n.e.String(e.AddressID),this.AssignAddress.AddressToName.Text=n.e.String(e.ContactPerson),this.AssignAddress.AddressTo1.Text=n.e.String(e.Address1)+" "+n.e.String(e.Address2)+" "+n.e.String(e.Address3),this.AssignAddress.PhoneTo1.Text=n.e.String(e.Phone1),this.AssignAddress.AddressToCity.Text=n.e.String(e.City)+" "+n.e.String(e.State)+" "+n.e.String(e.Zip),this.AssignAddress.AddressToVisbility=!0)}),e=t.filter(e=>2==e.AddressTypeID),e.forEach(e=>{this.AssignAddress.BillTo.push(D.d.ComboBoxItems_2(e.AddressName.toString(),e.AddressID.toString())),Object.keys(t[0]).Contains("IsDefault")&&Object(o.j)(e.IsDefault)&&(this.AssignAddress.SelectedAddressTo=n.e.String(e.AddressID),this.AssignAddress.AddressToName.Text=n.e.String(e.ContactPerson),this.AssignAddress.AddressTo1.Text=n.e.String(e.Address1)+" "+n.e.String(e.Address2)+" "+n.e.String(e.Address3),this.AssignAddress.PhoneTo1.Text=n.e.String(e.Phone1),this.AssignAddress.AddressToCity.Text=n.e.String(e.City)+" "+n.e.String(e.State)+" "+n.e.String(e.Zip),this.AssignAddress.AddressToVisbility=!0)})))}}GetDraftXML(e){let t,s,i={LastRowNo:0,strXML:""};for(i.LastRowNo=this.ScreenObject.GridData.length-1;i.LastRowNo>=0;i.LastRowNo--){for(t=2;t<this.ScreenObject.GridDataColumns.length&&!(n.e.String(this.ScreenObject.GridData[i.LastRowNo][this.ScreenObject.GridDataColumns[t]]).length>0);t++);if(t!=this.ScreenObject.GridDataColumns.length)break}if(-1==i.LastRowNo&&e)return"";let a,r="";for(r+="<XML>",r+="<Header>",this.ScreenObject.HeaderFields.forEach(e=>{e instanceof u.d||e instanceof u.c?(r+="<"+e.DBColumnName+">",r+=u.d.GetValidXml(e.Text),r+="</"+e.DBColumnName+">"):e instanceof d.c?e.Date&&(r+="<"+e.DBColumnName+">",r+=e.Date.ToString("dd MMM yyyy"),r+="</"+e.DBColumnName+">"):e instanceof d.a?(r+="<"+e.DBColumnName+">",r+=e.Date.ToString("dd MMM yyyy"),r+="</"+e.DBColumnName+">"):e instanceof m.b?(r+="<"+e.DBColumnName+">",r+=e.SelectedValue,r+="</"+e.DBColumnName+">"):e instanceof p.a?(r+="<"+e.DBColumnName+"_COMBO>",r+=e.ComboBox.SelectedValue,r+="</"+e.DBColumnName+"_COMBO>"):e instanceof C.a&&(r+="<"+e.DBColumnName+">",r+=e.SelectedValue,r+="</"+e.DBColumnName+">")}),this.ScreenObject._CCFields.forEach(e=>{(e instanceof m.b||e instanceof C.a)&&(r+="<"+e.DBColumnName+">",r+=e.SelectedValue,r+="</"+e.DBColumnName+">")}),this.ScreenObject._TextFields.forEach(e=>{if(e instanceof u.d){let t=e;r+="<"+t.DBColumnName+">",r+=u.d.GetValidXml(t.Text),r+="</"+t.DBColumnName+">"}else if(e instanceof u.c){let t=e;r+="<"+t.DBColumnName+">",r+=u.d.GetValidXml(t.Text),r+="</"+t.DBColumnName+">"}else if(e instanceof d.c){let t=e;t.Date&&(r+="<"+t.DBColumnName+">",r+=t.Date.ToString("dd MMM yyyy"),r+="</"+t.DBColumnName+">")}else if(e instanceof d.a){let t=e;null!=t.Date&&null!=t.Date||(t.Date=(new Date).OnlyDate()),r+="<"+t.DBColumnName+">",r+=t.Date.ToString("dd MMM yyyy"),r+="</"+t.DBColumnName+">"}else e instanceof m.b||e instanceof D.e?(r+="<"+e.DBColumnName+">",r+=e.SelectedValue,r+="</"+e.DBColumnName+">"):e instanceof g.a&&(r+="<"+e.DBColumnName+">",r+=e.Text,r+="</"+e.DBColumnName+">")}),r+="</Header>",r+="<DataTable>",s=0;s<=i.LastRowNo;s++){let e=this.ScreenObject.GridData[s];for(r+="<Row>",t=0;t<this.ScreenObject.GridDataColumns.length;t++)a=e[this.ScreenObject.GridDataColumns[t]],n.e.IsEmpty(a)||(r+="<"+this.ScreenObject.GridDataColumns[t]+">",r+=u.d.GetValidXml(a),r+="</"+this.ScreenObject.GridDataColumns[t]+">");r+="</Row>"}return r+="</DataTable>",r+="<FooterTable>",this.ScreenObject.FooterGridData.forEach(e=>{r+="<Row>",r+="<ColumnName>",r+=n.e.String(e.ColumnName),r+="</ColumnName>",r+="<Amount>",r+=n.e.String(e.Amount),r+="</Amount>",r+="<CalcAmount>",r+=n.e.String(e.CalcAmount),r+="</CalcAmount>",r+="<dcCurrID>",r+=n.e.String(e.dcCurrID),r+="</dcCurrID>",r+="<dcCurrID_Key>",r+=n.e.String(e.dcCurrID_Key),r+="</dcCurrID_Key>",r+="<dcExchrt>",r+=n.e.String(e.dcExchrt),r+="</dcExchrt>",r+="</Row>"}),r+="</FooterTable>",r+="</XML>",i.strXML=r,i}PoleDisplaytimer_Elapsed(){this.PoleDisplayMessage(1,null),this.PoleDisplaytimer.Enabled=!1}timerDraft_Elapsed(){null!=this.ScreenObject&&this.ScreenObject.IsDocEdit||a.a.SessionManager.Preferences.ContainsKey("AutoDocumentDraft")&&!Object(o.j)(a.a.SessionManager.Preferences.AutoDocumentDraft)||a.a.page.isActiveTab(this)&&this.SaveDraft(!0,!0)}SaveDraft(e,t){try{let s;if(s=this.GetDraftXML(e),e&&0==s.strXML.length)return;let i=[];i.push(this.ScreenObject.DraftID),i.push(this.ScreenObject.CostCenterID),i.push(0),i.push(s.strXML),i.push(t?1:2),i.push(this.HoldDocName.Text),i.push(t?this.DocumentDate:this.HoldDocDate.Date),i.push(s.LastRowNo),i.push(this.NetAmount),i.push(this.ScreenObject.RegisterNodeID),this.ScreenObject.SetDocumentDraft(i).subscribe(e=>{e.RetValue>0&&(this.ScreenObject.DraftID=e.RetValue),this.ScreenObject.DraftID>0?t?this.DisplayMessage+="Draft Saved At "+(new Date).ToString("hh:mm a"):(this.clear(1),this.ScreenObject.DraftID=0,this.DisplayMessage+="Document Hold Succesfully",a.a.page.HideDialog(),this.HoldDocName.Text=""):this.DisplayMessage=e.Message},e=>{console.log(e)})}catch(s){}}LoadDraftXML(e,t=!1){let s,i;if(0==e.DataXML.toString().length)return;let r,l,c,h=new n.f;h.LoadXml(e.DataXML),this.ScreenObject.DraftID=parseInt(e.DraftID),n.e.IsEmpty(e.DocName)||(this.HoldDocName.Text=e.DocName.toString()),r=h.SelectSingleNode("XML/Header"),this.ScreenObject.HeaderFields.forEach(e=>{if(e instanceof u.d){let t=e;l=h.getDateByNodeName(r,e.DBColumnName),null!=l&&(t.Text=l)}else if(e instanceof u.c)l=h.getDateByNodeName(r,e.DBColumnName);else if(e instanceof d.c){let t=e;l=h.getDateByNodeName(r,e.DBColumnName),null!=l&&(t.Date=new Date(l))}else if(e instanceof d.a){let t=e;l=h.getDateByNodeName(r,e.DBColumnName),null!=l&&(t.Date=new Date(l)),"DocDate"==t.DBColumnName&&(this.DocumentDate=t.Date)}else if(e instanceof m.b){let t=e;l=h.getDateByNodeName(r,e.DBColumnName),null!=l&&(t.OnPactListBoxValueChanged.UnSubscribe(),t.SelectedValue=parseInt(l),t.OnPactListBoxValueChanged.Subscribe(this.ScreenObject,"OnGetReference"))}else if(e instanceof p.a){let t=e;l=h.getDateByNodeName(r,e.DBColumnName+"_COMBO"),null!=l&&(t.ComboBox.SelectedValue=l)}else if(e instanceof C.a){let t=e;l=h.getDateByNodeName(r,e.DBColumnName),null!=l&&(t.SelectionCallBack.UnSubscribe(),t.SelectedValue=parseInt(l),t.SelectionCallBack.Subscribe(this.ScreenObject,"OnGetReference"))}}),this.ScreenObject._CCFields.forEach(e=>{(e instanceof m.b||e instanceof C.a)&&(l=h.getDateByNodeName(r,e.DBColumnName),null!=l&&e instanceof m.b?(e.OnPactListBoxValueChanged.UnSubscribe(),e.SelectedValue=parseInt(l),e.OnPactListBoxValueChanged.Subscribe(this.ScreenObject,"OnGetReference"),(50001!=e.CCID||e.DBColumnName.startsWith("TO")||!t||!a.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")||"True"!=a.a.SessionManager.Preferences.EnableDivisionWise.toString()||this.ScreenObject.Preferences.ContainsKey("Donotusedivision")&&""!=this.ScreenObject.Preferences.Donotusedivision&&Object(o.j)(this.ScreenObject.Preferences.Donotusedivision))&&(50002!=e.CCID||e.DBColumnName.startsWith("TO")||!t||!a.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")||"True"!=a.a.SessionManager.Preferences.EnableLocationWise.toString()||this.ScreenObject.Preferences.ContainsKey("Donotuselocation")&&""!=this.ScreenObject.Preferences.Donotuselocation&&Object(o.j)(this.ScreenObject.Preferences.Donotuselocation))||(this.ScreenObject.DivisionID=e.SelectedValue)):null!=l&&e instanceof C.a&&(e.Name.OnPactListBoxValueChanged.UnSubscribe(),e.SelectedValue=parseInt(l),e.Name.OnPactListBoxValueChanged.Subscribe(this.ScreenObject,"OnGetReference"),(50001!=e.CCID||e.DBColumnName.startsWith("TO")||!t||!a.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")||"True"!=a.a.SessionManager.Preferences.EnableDivisionWise.toString()||this.ScreenObject.Preferences.ContainsKey("Donotusedivision")&&""!=this.ScreenObject.Preferences.Donotusedivision&&Object(o.j)(this.ScreenObject.Preferences.Donotusedivision))&&(50002!=e.CCID||e.DBColumnName.startsWith("TO")||!t||!a.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")||"True"!=a.a.SessionManager.Preferences.EnableLocationWise.toString()||this.ScreenObject.Preferences.ContainsKey("Donotuselocation")&&""!=this.ScreenObject.Preferences.Donotuselocation&&Object(o.j)(this.ScreenObject.Preferences.Donotuselocation))||(this.ScreenObject.DivisionID=e.SelectedValue)))}),this.ScreenObject._TextFields.forEach(e=>{l=h.getDateByNodeName(r,e.DBColumnName),null!=l&&this.ScreenObject.fillcontrolValue(e,l)});let D=h.SelectNodes("XML/DataTable/Row");for(i=0;i<D.length;i++){this.ScreenObject.GridData.length-1<=i&&this.ScreenObject.GridDataObj.addEmptyRow();let e=this.ScreenObject.GridData[i];for(e.DocSeqNo=i+1,s=1;s<this.ScreenObject.GridDataColumns.length;s++)if(c=this.ScreenObject.GridDataColumns[s],l=h.getDateByNodeName(D[i],c),!Object(f.isNullOrUndefined)(l))if(this.ScreenObject.GridDataObj.DataTypes.Date.Contains(c))n.e.isValidDate(l)&&(e[c]=new Date(l));else if(""==l&&(this.ScreenObject.GridDataObj.DataTypes.Double.Contains(c)||this.ScreenObject.GridDataObj.DataTypes.Int.Contains(c)));else try{e[c]=l}catch(S){}this.CalculateTotals(e,!1),this.ScreenObject.GridDataObj.updateRow(e)}for(D=h.SelectNodes("XML/FooterTable/Row"),i=0;i<D.length;i++){this.ScreenObject.FooterGridData.length-1<=i&&this.ScreenObject.FooterGridDataObj.addEmptyRow();let e=this.ScreenObject.FooterGridData[i];l=h.getDateByNodeName(D[i],"ColumnName"),Object(f.isNullOrUndefined)(l)||(D[i].ColumnName=l),this.FooterCellEditEnd("ColumnName",e),l=h.getDateByNodeName(D[i],"Amount"),Object(f.isNullOrUndefined)(l)||(D[i].Amount=l),l=h.getDateByNodeName(D[i],"CalcAmount"),Object(f.isNullOrUndefined)(l)||(D[i].CalcAmount=l),l=h.getDateByNodeName(D[i],"dcCurrID"),Object(f.isNullOrUndefined)(l)||(D[i].dcCurrID=l),l=h.getDateByNodeName(D[i],"dcCurrID_Key"),Object(f.isNullOrUndefined)(l)||(D[i].dcCurrID_Key=l),l=h.getDateByNodeName(D[i],"dcExchRT"),Object(f.isNullOrUndefined)(l)||(D[i].dcExchRT=l)}a.a.SessionManager.Preferences.ContainsKey("DraftServerDate")&&"true"==a.a.SessionManager.Preferences.DraftServerDate.toLowerCase()&&null!=this.fldDict&&n.e.isValidDate(this.fldDict.ServerDate.fieldResult)&&(this.DocumentDate=new Date(this.fldDict.ServerDate)),a.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==a.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&this.ScreenObject.FillListViews(!1),this.CalculateTotals(null,!1)}OpenCashDrawer(e,t){if(this.ScreenObject.Preferences.ContainsKey("Select Port")&&"True"==this.ScreenObject.Preferences["Select Port"])try{Logger.InfoLog("Message :"+t+"   to Port NO:"+e)}catch(s){Logger.ErrorLog("Cash Drawer :: "+s.Message)}}get BudgetObj(){return null==this._BudgetObj&&(this._BudgetObj=new $e(this)),this._BudgetObj}BudgetValidation(e){if(null!=this.ScreenObject.Data.Tables[5]&&this.ScreenObject.Data.Columns[5].length>0){if(!this.ScreenObject.Preferences.ContainsKey("Check Budget")||"False"==this.ScreenObject.Preferences["Check Budget"]||"False"==a.a.SessionManager.Preferences["Use Budget"]||0==this.ScreenObject.Data.Tables[5].filter(e=>0==e.QtyBudget).length||a.a.SessionManager.LicenseSettings.ContainsKey("Budget")&&"FALSE"==a.a.SessionManager.LicenseSettings.Budget.toUpperCase())return;this.BudgetObj.BudgetValidation(e)}}ValidateBudget(e,t){return!this.ScreenObject.Preferences.ContainsKey("Check Budget")||"False"==this.ScreenObject.Preferences["Check Budget"]||"False"==a.a.SessionManager.Preferences["Use Budget"]||a.a.SessionManager.LicenseSettings.ContainsKey("Budget")&&"FALSE"==a.a.SessionManager.LicenseSettings.Budget.toUpperCase()?(t.dim=null,t.BudID=0,t.BudStartDate=new Date,""):this.BudgetObj.ValidateBudget(e,t)}SetVisibiltiFalse(){this.ImportVisiblity=!1,this.ProductImageVisibility=!1}Dependencies(){if(null==this.SelectedRow)return;this.SetVisibiltiFalse(),this.DependencyVisibility=!0,this.RightTabSelectedIndex=0,this.DependantText=n.e.StringValue(this.SelectedRow.dcAlpha11);let e=n.e.StringValue(this.SelectedRow.Dependencies).toString().split(",");this.Dependflds.Items.Clear();for(let t=0;t<this.ScreenObject.GridData.length;t++)if(!n.e.IsEmpty(this.ScreenObject.GridData[t].ProductID_Key)){if(this.ScreenObject.GridData[t]==this.SelectedRow)continue;e.Contains(this.ScreenObject.GridData[t].dcAlpha11.toString())?this.Dependflds.Items.push(D.c.CheckedListBoxItem_6(this.ScreenObject.GridData[t].dcAlpha11.toString(),this.ScreenObject.GridData[t].dcAlpha11.toString(),!0,0)):this.Dependflds.Items.push(D.c.CheckedListBoxItem_6(this.ScreenObject.GridData[t].dcAlpha11.toString(),this.ScreenObject.GridData[t].dcAlpha11.toString(),!1,0))}}AssignUsers(){if(null==this.SelectedRow)return;this.SetVisibiltiFalse(),this.AssignVisibility=!0,this.RightTabSelectedIndex=0,null==this.AssignFields&&(this.AssignFields=new jt(0,"",this)),a.a.page.ShowDialog(this.AssignFields,Ot.a,{HideClose:!1,ShowCenter:!0,Title:a.a.GetResource("Assign")}),this.AssignFields.ReportName=n.e.StringValue(this.SelectedRow.dcAlpha11);let e="",t="",s="";if(!n.e.IsEmpty(this.SelectedRow.AssignXML)){let i=new n.f;i.LoadXml(this.SelectedRow.AssignXML),i.DocumentElement.children.length>0&&(null==i.DocumentElement.children[0].attributes.Groups||n.e.IsEmpty(i.DocumentElement.children[0].attributes.Groups.value)||(e=i.DocumentElement.children[0].attributes.Groups.value),null==i.DocumentElement.children[0].attributes.Roles||n.e.IsEmpty(i.DocumentElement.children[0].attributes.Roles.value)||(s=i.DocumentElement.children[0].attributes.Roles.value),null==i.DocumentElement.children[0].attributes.Users||n.e.IsEmpty(i.DocumentElement.children[0].attributes.Users.value)||(t=i.DocumentElement.children[0].attributes.Users.value))}this.AssignFields.SetSelectedItems_2(this.AssignFields.Groups,e),this.AssignFields.SetSelectedItems_2(this.AssignFields.Roles,s),this.AssignFields.SetSelectedItems_2(this.AssignFields.Users,t)}PoleDisplayMessage(e,t){try{let s="";if(this.ScreenObject.Data.Tables.length>18&&this.ScreenObject.Data.Tables[18].length>0){let i=this.ScreenObject.Data.Tables[18][0];if(this.ScreenObject.RegisterNodeID>0){let e=this.ScreenObject.Data.Tables[18].filter(e=>e.NodeID==this.ScreenObject.RegisterNodeID);if(!(e.length>0))return;i=e[0]}let a=new n.f,r=null;if(1!=e||n.e.IsEmpty(i.IdleMessageXML)?2!=e||n.e.IsEmpty(i.ProductScanXML)?3!=e||n.e.IsEmpty(i.BillPayXML)?4!=e||n.e.IsEmpty(i.OnExitXML)||(a.LoadXml(i.OnExitXML),r=a.SelectNodes("ExitXML/Rows")):(a.LoadXml(i.BillPayXML),r=a.SelectNodes("BillPay/Rows")):(a.LoadXml(i.ProductScanXML),r=a.SelectNodes("ProductScan/Rows")):(a.LoadXml(i.IdleMessageXML),r=a.SelectNodes("IdleMessage/Rows")),null!=r&&r.length>0){let e=0,a=0;n.e.IsEmpty(i.NoOfLines)||(a=parseInt(i.NoOfLines)),n.e.IsEmpty(i.CharactersPerLine)||(e=parseInt(i.CharactersPerLine));let o=1;for(let i=0;i<r.length;i++){if(null!=r[i].attributes.LineNo&&""!=r[i].attributes.LineNo.value&&parseInt(r[i].attributes.LineNo.value)>a)continue;let n="";if(null!=r[i].attributes.FieldID&&"-1"==r[i].attributes.FieldID.value)null!=r[i].attributes.Data&&(n=r[i].attributes.Data.value);else if(null!=r[i].attributes.FieldID&&"-2"==r[i].attributes.FieldID.value)n=this.NetAmount;else if(null!=r[i].attributes.FieldID&&""!=r[i].attributes.FieldID.value){let e=this.ScreenObject.ColumnSource.find(e=>e.ID==r[i].attributes.FieldID.value);n=null!=t&&e?"FLOAT"==e.DataType&&null!=r[i].attributes.Decimal&&""!=r[i].attributes.Decimal.value?parseFloat(t[e.DisplayMember]).ToString("N"+r[i].attributes.Decimal.value):t[e.DisplayMember].toString():this.GetHeaderData(r[i].attributes.FieldID.value)}let l=0;null!=r[i].attributes.NoOfCharacters&&""!=r[i].attributes.NoOfCharacters.value&&(l=parseInt(r[i].attributes.NoOfCharacters.value));let c="";if(n.length<l)for(let e=l-n.length;e>0;e--)c+=" ";else n=n.substr(0,l);if(null!=r[i].attributes.Align&&"Left"==r[i].attributes.Align.value?c=c.Insert(0,n):c+=n,n=c.toString(),null!=r[i].attributes.StartPosition&&""!=r[i].attributes.StartPosition.value&&parseInt(r[i].attributes.StartPosition.value)>1){c="";for(let e=1;e<parseInt(r[i].attributes.StartPosition.value);e++)c+=" ";n=c.toString()+n}if(null!=r[i].attributes.LineNo&&""!=r[i].attributes.LineNo.value&&parseInt(r[i].attributes.LineNo.value)<o)for(let t=o;t<parseInt(r[i].attributes.LineNo.value);t++){c="";for(let t=l;t<e;t++)c+=" ";l=0,s+=c.toString()}l+=n.length,o=parseInt(r[i].attributes.LineNo.value),s+=n}this.OpenCashDrawer(i.PortName.toString(),s)}}}catch(s){}}GetHeaderData(e){let t=n.e.Int(e);if(t>0){let s=this.ScreenObject._StaticFields.find(e=>e.DBColumnID==t);if(s||(s=this.ScreenObject._TextFields.find(e=>e.DBColumnID==t)),s||(s=this.ScreenObject._CCFields.find(e=>e.DBColumnID==t)),!s){let i=this.ScreenObject.Data.Tables[0].filter(e=>e.CostCenterColID==t);i.length>0&&(e=i[0].SysColumnName,null==s&&null!=this.ScreenObject.DocDate&&"DocDate"==e&&(s=this.ScreenObject.DocDate),null==s&&null!=this.ScreenObject.DocPrefix&&"VoucheNo"==e&&(s=this.ScreenObject.DocPrefix),null==s&&null!=this.ScreenObject.DueDate&&"DueDate"==e&&(s=this.ScreenObject.DueDate),null==s&&null!=this.ScreenObject.BillNo&&"BillNo"==e&&(s=this.ScreenObject.BillNo))}if(s)return this.GetFldName(s)}return""}GetFldName(e){return e instanceof m.b&&e.SelectedValue>0&&null!=e.Text||e instanceof u.d&&null!=e.Text||e instanceof D.e&&null!=e.Text?e.Text:e instanceof p.a&&null!=e.ComboBox&&null!=e.TextBox&&null!=e.TextBox.Text&&null!=e.ComboBox.Text?e.ComboBox.Text+e.TextBox.Text:e instanceof d.a&&null!=e.Date?e.Date.ToString(a.a.SessionManager.Preferences["Date Format"]):""}GetMatchedIndex(e,t){let s,i=0;for(let a=0;a<this.ScreenObject.Data.Tables[19].length;a++){let t=e,r=!0,o=this.ScreenObject.Data.Tables[19][a].DefinitionXML.toString(),l=this.ScreenObject.Data.Tables[19][a].BarcodeXml.toString();if(""!=l){s=new n.f,s.LoadXml(l);let e=s.SelectSingleNodeText("BarCodeBody/IsFixedBarcodeLength");if(null!=e&&"true"==e.toLowerCase()&&(e=s.SelectSingleNodeText("BarCodeBody/FixedBarcodeChar"),null!=e&&""!=e.trim())){let i=e[0];if(e=s.SelectSingleNodeText("BarCodeBody/IsFixedBarcodePrefix"),null!=e&&"true"==e.trim())for(let e=0;e<t.length&&t[e]==i;e++)t=t.Remove(0,1),e--;else for(let e=t.length-1;e>=0&&t[e]==i;e--)t=t.Remove(t.length-1,1)}if(e=s.SelectSingleNodeText("BarCodeBody/IsExclude"),null!=e&&"true"==e.toLowerCase()){let i;if(e=s.SelectSingleNodeText("BarCodeBody/ExcludeChar"),null!=e&&""!=e.trim()?i=e[0]:(e=s.SelectSingleNodeText("BarCodeBody/FixedBarcodeChar"),i=null!=e&&""!=e.trim()?e[0]:" "),e=s.SelectSingleNode("BarCodeBody/IsExcludePrefix"),null!=e&&"true"==e.trim())for(let e=0;e<t.length&&t[e]==i;e++)t=t.Remove(0,1),e--;else for(let e=t.length-1;e>=0&&t[e]==i;e--)t=t.Remove(t.length-1,1)}e=s.SelectSingleNodeText("BarCodeBody/IncludeChecksum"),null!=e&&"true"==e.toLowerCase()&&(t=t.Remove(t.length-1,1))}if(""!=o){s=new n.f,s.LoadXml(o);let e=s.SelectNodes("Definition/Field");for(let s=0;s<e.length;s++){let i="",a="",o="",l="",c=0,h=0;if(i=n.f.SelectSingleNodeText(e[s],"DataSource"),a=n.f.SelectSingleNodeText(e[s],"SysColumn"),o=n.f.SelectSingleNodeText(e[s],"Delimiter"),l=n.f.SelectSingleNodeText(e[s],"Width"),l.length>0&&n.e.IsNum(l)&&(c=parseInt(l)),l=n.f.SelectSingleNodeText(e[s],"Decimals"),l.length>0&&n.e.IsNum(l)&&(h=parseInt(l)),l="",-1==c&&""!=o){let e=t.indexOf(o);e>0&&e<t.length?(l=t.substr(0,e),t=t.Remove(0,e)):r=!1}else-1!=c?t.length>=c?(l=t.substr(0,c),t=t.Remove(0,c)):r=!1:-1==c&&s==e.length-1&&(l=t,t="");""!=o&&t.length>o.length?t=t.Remove(0,o.length):""!=t&&(r=!1)}}if(r){i=a;break}}return i}ReadBarcode(e,t,s,i,o,l){if(l.PID=0,null!=s&&n.e.IsEmpty(s.Text))return!1;let c=0;this.ScreenObject.Data.Tables[19].length>1&&(c=this.GetMatchedIndex(null!=s?s.Text:o,i),e=this.ScreenObject.Data.Tables[19][c].DefinitionXML.toString(),t=this.ScreenObject.Data.Tables[19][c].BarcodeXml.toString());let h=!1,u=0;do{let d="";d=null!=s?s.Text:o,this.barcodeValues=new r.a;let D="";if(""!=e||""!=t){let s;if(""!=t){s=new n.f,s.LoadXml(t);let e=s.SelectSingleNodeText("BarCodeBody/IsFixedBarcodeLength");if(null!=e&&"true"==e.toLowerCase()&&(e=s.SelectSingleNodeText("BarCodeBody/FixedBarcodeChar"),null!=e&&""!=e.trim())){let t=e[0];if(e=s.SelectSingleNodeText("BarCodeBody/IsFixedBarcodePrefix"),null!=e&&"true"==e.trim())for(let e=0;e<d.length&&d[e]==t;e++)d=d.Remove(0,1),e--;else for(let e=d.length-1;e>=0&&d[e]==t;e--)d=d.Remove(d.length-1,1)}if(e=s.SelectSingleNodeText("BarCodeBody/IsExclude"),null!=e&&"true"==e.toLowerCase()){let t;if(e=s.SelectSingleNodeText("BarCodeBody/ExcludeChar"),null!=e&&""!=e.trim()?t=e[0]:(e=s.SelectSingleNodeText("BarCodeBody/FixedBarcodeChar"),t=null!=e&&""!=e.trim()?e[0]:" "),e=s.SelectSingleNodeText("BarCodeBody/IsExcludePrefix"),null!=e&&"true"==e.trim())for(let e=0;e<d.length&&d[e]==t;e++)d=d.Remove(0,1),e--;else for(let e=d.length-1;e>=0&&d[e]==t;e--)d=d.Remove(d.length-1,1)}e=s.SelectSingleNodeText("BarCodeBody/IncludeChecksum"),null!=e&&"true"==e.toLowerCase()&&(d=d.Remove(d.length-1,1))}if(""!=e){s=new n.f,s.LoadXml(e);let t=s.SelectNodes("Definition/Field");for(let e=0;e<t.length;e++){let s="",a="",r="",o="",l="",c=0,h=0;if(s=n.f.SelectSingleNodeText(t[e],"DataSource"),a=n.f.SelectSingleNodeText(t[e],"SysColumn"),r=n.f.SelectSingleNodeText(t[e],"Delimiter"),o=n.f.SelectSingleNodeText(t[e],"Width"),("Batch_MfgDate"==a||"Batch_ExpDate"==a)&&o.length>0&&(l=o,c=l.length),o.length>0&&n.e.IsNum(o)&&(c=parseInt(o)),o=n.f.SelectSingleNodeText(t[e],"Decimals"),o.length>0&&n.e.IsNum(o)&&(h=parseInt(o)),o="",-1==c&&""!=r){let e=d.indexOf(r);e>0&&e<d.length&&(o=d.substr(0,e),d=d.Remove(0,e))}else-1!=c&&d.length>=c?(o=d.substr(0,c),d=d.Remove(0,c)):-1==c&&e==t.length-1&&(o=d);if(""!=r&&d.length>r.length&&(d=d.Remove(0,r.length)),"Product"==s&&""!=o)""==D&&(D+="<XML>"),D+='<Row CostcenterID="3"',D+=' syscolname="'+a+'"',D+=' value="'+o+'" />';else if(s.startsWith("CC")&&""!=o){let e=5e4;e+=parseInt(s.replace("CC","")),""==D&&(D+="<XML>"),D+='<Row CostcenterID="'+e+'"',D+=' syscolname="'+a+'"',D+=' value="'+o+'" />'}else if("Document"==s&&"INVID"==a&&""!=o)""==D&&(D+="<XML>"),D+='<Row CostcenterID="400"',D+=' syscolname="Inv_docDetailsID"',D+=' value="'+o+'" />',this.barcodeValues.push(a,o);else if("Document"==s&&""!=o)if(""!=l){let e=0,t=0,s="";s=l.startsWith("YYYY")?this.ScreenObject.GetMonthName(parseInt(o.substr(4,2)),!1):l.startsWith("MM")?this.ScreenObject.GetMonthName(parseInt(o.substr(0,2)),!1):this.ScreenObject.GetMonthName(parseInt(o.substr(2,2)),!1),e=l.startsWith("YYYY")?parseInt(o.substr(6,2)):l.startsWith("DD")?parseInt(o.substr(0,2)):parseInt(o.substr(2,2)),t=l.startsWith("YYYY")?parseInt(o.substr(0,4)):l.Contains("YYYY")?parseInt(o.substr(4,4)):parseInt(o.substr(4,2)),this.barcodeValues.push(a,e.toString()+"/"+s+"/"+t.toString())}else this.ScreenObject.GridDataColumns.Contains(a)?this.ScreenObject.GridDataObj.DataTypes.Double.Contains(a)?(h>0&&(o=o.Insert(o.length-h,".")),n.e.IsNum(o)&&(null!=i&&(i[a]=o),this.barcodeValues.push(a,o))):this.ScreenObject.GridDataObj.DataTypes.Int.Contains(a)?n.e.IsNum(o)&&(null!=i&&(i[a]=o),this.barcodeValues.push(a,o)):(null!=i&&(i[a]=o),this.barcodeValues.push(a,o)):h>0?(o=o.Insert(o.length-h,"."),this.barcodeValues.push(a,o)):this.barcodeValues.push(a,o);else"Document"!=s||null==i||"Batch_No"!=a&&"Batch_Code"!=a||""==o||this.barcodeValues.push(a,o)}}else D+="<XML>",D+='<Row CostcenterID="3"',D+=' syscolname="ProductCode"',D+=' value="'+d+'" />'}let S=null;if(""!=D&&(D+="</XML>",S=a.a.document.GetCCValues_xml(D)),null!=S&&S.Tables.length>0&&S.Columns[0].Contains("CostCenterID")){if(S.Tables.length>1&&S.Tables[1].length>0)for(let e=0;e<S.Tables[1].length;e++){let t=this.ScreenObject.GridData.filter(t=>t.BOEID==S.Tables[1][e].InvDocDetailsID);if(!(t.length>0))return this.DisplayMessage="Select Product in FIFO Order",!1;if(!n.e.IsEmpty(t[0].UOMConvertedQty)&&parseFloat(t[0].UOMConvertedQty)<parseFloat(S.Tables[1][e].Qty))return this.DisplayMessage="Select Product in FIFO Order",!1}for(let e=0;e<S.Tables[0].length;e++){let t=this.ScreenObject.ColumnSource.find(t=>t.CostCenterID==parseInt(S.Tables[0][e].CostCenterID));if(t)if(null!=i){if(i[t.DisplayMember]=S.Tables[0][e].Name.toString(),i[t.ValueMember]=S.Tables[0][e].NODEID.toString(),3==t.CostCenterID){if(S.Columns[0].Contains("VenderID")){if(S.Columns[0].Contains("barcodeid")&&!n.e.IsEmpty(S.Tables[0][e].barcodeid)&&parseInt(S.Tables[0][e].barcodeid)>0&&this.ScreenObject.Preferences.ContainsKey("BarcodeDimension")&&""!=this.ScreenObject.Preferences.BarcodeDimension&&parseInt(this.ScreenObject.Preferences.BarcodeDimension)>0){let t=this.ScreenObject.ColumnSource.find(e=>e.CostCenterID==parseInt(this.ScreenObject.Preferences.BarcodeDimension));t&&!this.barcodeValues.ContainsKey(t.ValueMember)&&(this.barcodeValues.push(t.ValueMember,S.Tables[0][e].barcodeid.toString()),this.barcodeValues.push(t.DisplayMember,S.Tables[0][e].ECode.toString()))}if(S.Columns[0].Contains("UnitID")&&n.e.Int(S.Tables[0][e].UnitID)>0&&!this.barcodeValues.ContainsKey("Unit_Key"))this.barcodeValues.push("Unit_Key",S.Tables[0][e].UnitID.toString()),this.barcodeValues.push("Unit",S.Tables[0][e].UnitName.toString()),i.Unit_Key=S.Tables[0][e].UnitID.toString(),i.Unit=S.Tables[0][e].UnitName.toString();else if(S.Columns[0].Contains("AccountCode")&&!n.e.IsEmpty(S.Tables[0][e].VenderID)&&parseInt(S.Tables[0][e].VenderID)>0){let t=this.ScreenObject.Data.Tables[0];t.length>0&&(t=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&53412==e.LinkData),t.length>0&&!this.barcodeValues.ContainsKey(t[0].SysColumnName)&&(i[t[0].SysColumnName]=S.Tables[0][e].AccountCode.toString(),this.barcodeValues.push(t[0].SysColumnName,S.Tables[0][e].AccountCode.toString())),t=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&53413==e.LinkData),t.length>0&&!this.barcodeValues.ContainsKey(t[0].SysColumnName)&&(i[t[0].SysColumnName]=S.Tables[0][e].AccountName.toString(),this.barcodeValues.push(t[0].SysColumnName,S.Tables[0][e].AccountName.toString())),t=this.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&50493==e.LinkData),t.length>0&&!this.barcodeValues.ContainsKey(t[0].SysColumnName)&&S.Columns[0].Contains("ECode")&&(i[t[0].SysColumnName]=S.Tables[0][e].ECode.toString(),this.barcodeValues.push(t[0].SysColumnName,S.Tables[0][e].ECode.toString())))}}null!=s&&(s.Text=S.Tables[0][e].Code.toString(),s.SelectedValue=S.Tables[0][e].NODEID.toString()),this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(i.ProductCode=S.Tables[0][e].Code.toString()),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(i.ProductName=S.Tables[0][e].Name.toString()),this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&(i.ProductID_Key=S.Tables[0][e].NODEID.toString()),!n.e.IsEmpty(S.Tables[0][e].NODEID)&&parseInt(S.Tables[0][e].NODEID)>0&&(h=!0)}}else this.barcodeValues.ContainsKey(t.ValueMember)||this.barcodeValues.push(t.ValueMember,S.Tables[0][e].NODEID.toString())}for(let e=0;e<S.Tables[0].length;e++)3==parseInt(S.Tables[0][e].CostCenterID)&&!n.e.IsEmpty(S.Tables[0][e].NODEID)&&parseInt(S.Tables[0][e].NODEID)>0&&(l.PID=parseInt(S.Tables[0][e].NODEID),h=!0)}h||(u++,this.ScreenObject.Data.Tables[19].length>u&&(c++,c>=this.ScreenObject.Data.Tables[19].length&&(c=0),e=this.ScreenObject.Data.Tables[19][c].DefinitionXML.toString(),t=this.ScreenObject.Data.Tables[19][c].BarcodeXml.toString()))}while(!h&&this.ScreenObject.Data.Tables[19].length>u);return h||null==i||(this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(i.ProductCode=null),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(i.ProductName=null),this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&(i.ProductID_Key=null)),h}Export(e,t,o,l=-1,c=!1){return Object(i.b)(this,void 0,void 0,(function*(){if(376==this.StatusID)return void(this.DisplayMessage="Documents is cancelled");if(371==this.StatusID&&this.DoNotPrintUnApprovedDocuments)return void(this.DisplayMessage="Un-Approved documents not allowed to export");if(371==this.StatusID&&!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Print/Export Un-Approved"))return void(this.DisplayMessage="Un-Approved documents not allowed to export");if(441==this.StatusID&&!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Print/Export Approved"))return void(this.DisplayMessage="Approved documents not allowed to export");if(372==this.StatusID&&!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Print/Export Rejected"))return void(this.DisplayMessage="Rejected documents not allowed to export");let i=null;const{VoucherExportExcel:l}=yield Promise.resolve().then(s.bind(null,"5FTv")),{VPTDialogViewModel:h}=yield Promise.resolve().then(s.bind(null,"ia84")),{VPTDialogComponent:u}=yield Promise.resolve().then(s.bind(null,"SW+i"));let d=l.GetLocationPrintLayouts(this.DocumentID,0,e,4);{null!=d&&0!=d.Tables[0].length||(this.DisplayMessage=a.a.GetResource("Err_PrintLayoutNotDefined")),this.sDSCUserName="",this.bDSExists=!1,this.oDSImg=null;let s=new h(d.Tables[0],!c,!1);a.a.page.ShowDialog(s,u,{ShowCenter:!0,NoWidth:!0}).subscribe(()=>{if(s.IsOkClicked&&(i=s.SelectedRow,this.sDSCUserName=s.sDSCUserName),null!=i){let l=new r.a;l.push("SaveFileName",this.ScreenObject.VoucherNo),l.push("ContinuousExportClubOtherDocs",o?"1":"0");let h=[e.toString()];o||n.e.IsEmpty(t)||(h.AddRange(t.split(",")),t=null),l.push("OtherDocNos",t);let u=s.IsExcelChecked?"EXCEL":"PDF";h.forEach(e=>{a.a.report.ExportVPT(this.CostCenterID,e,parseInt(i.DocPrintLayoutID),u,this.IsInventoryVoucher,l).subscribe(t=>{console.log(t),c?(a.a.SessionManager.printTab(t.FileName),n.e.IsEmpty(t.Message)&&!n.e.IsEmpty(t.FileName)&&(this.DisplayMessage="Error in Print")):(a.a.SessionManager.Download(t.FileName,"abcd"+e),n.e.IsEmpty(t.Message)&&!n.e.IsEmpty(t.FileName)&&(this.DisplayMessage="Exported Successfully"))},e=>{console.log(e)})})}})}}))}importWorker_DoWork(e,t){this.FailedRecourdList.Clear();let s,i=null,l=null;i=new r.a;for(let r=0;r<this.DtImport.length-1;r++){let e=this.DtImport[r];if(!n.e.IsEmpty(e.FeatureFieldName)&&"0"!=n.e.StringValue(e.FeatureFieldName)){var c=this.ScreenObject.ColumnSource.find(t=>t.ID==e.FeatureFieldName.toString());if(null==c&&(c=this.ScreenObject.ColumnSource.find(t=>"-"+t.ID==e.FeatureFieldName.toString())),null==c||"LISTBOX"!=c.DataType||n.e.IsEmpty(i.ContainsKey(c.CostCenterID))){if(null!=c&&"LINK"==c.DataType&&"refno"==c.DisplayMember.toLowerCase()&&!i.ContainsKey(400)&&i.ContainsKey(3)){let e="",t="";for(let i=1;i<this.ExcelTable.length;i++)""!=e&&(e+=","),e+="'"+this.ExcelTable[i][0]+"'";for(let a=0;a<i[3].length;a++)""!=t&&(t+=","),t+=i[3][a].ID.toString();let s=this.ScreenObject.GetLinkDefDetails(this.CostCenterID,0,e,t);null!=s&&s.Tables.length>0&&i.push(400,s.Tables[0]),null!=s&&s.Tables.length>1&&i.push(43,s.Tables[1])}}else{let t=!1;(c.DisplayMember.toLowerCase().Contains("code")||a.a.SessionManager.Preferences.ContainsKey("POSItemCodeDimension")&&this.IsInventoryVoucher&&c.CostCenterID.toString()==a.a.SessionManager.Preferences.POSItemCodeDimension)&&(t=!0);let r=this.ScreenObject.GetUniqueDimension(c.CostCenterID,t);if(r>5e4){let o=0;var h=this.ScreenObject.ColumnSource.find(e=>e.CostCenterID==r);if(null==h||n.e.IsEmpty(h.ID)){var u=this.ScreenObject._CCFields.find(e=>e instanceof m.b&&e.CCID==r);null!=u&&(o=u.DBColumnID)}else o=parseInt(h.ID);if(!(o>0))return this.DisplayMessage="Define Unique dimension column",void(this.MessageVisibility=!0);{let n=this.DtImport.filter(e=>e.FeatureFieldName=="'"+o+"'");if(n.length>0){if(!i.ContainsKey(r)){let e="";this.ExcelTable.Columns.Contains("IMPORT_STATUS")||this.ExcelTable.Columns.push("IMPORT_STATUS"),this.ExcelTable.Columns.Contains("xIMP_STATUSx")||this.ExcelTable.Columns.push("xIMP_STATUSx"),this.ExcelTable.Columns.Contains("IMPORT_MESSAGE")||this.ExcelTable.Columns.push("IMPORT_MESSAGE");for(let s=1;s<this.ExcelTable.length;s++)""!=e&&(e+=","),e+="'"+this.ExcelTable[s][n[0][0].toString()].toString().Trim().Replace("'","''")+"'";let t=a.a.document.GetCCValues(e,r,0);i.push(r,t)}this.ExcelTable.Columns.Contains("UniqDim")||this.ExcelTable.Columns.push("UniqDim");let o="";for(let a=1;a<this.ExcelTable.length;a++)s=i[r].filter(e=>e.Name==this.ExcelTable[a][n[0][0].toString()].toString().Trim().Replace("'","''")),s.length>0&&(""!=o&&(o+=" or "),3==c.CostCenterID?o+=" ("+(t?"ProductCode":"ProductName")+"='"+this.ExcelTable[a][e[0].toString()].toString().Trim().Replace("'","''")+"' and ccnid"+(r-5e4)+"="+s[0].ID.toString()+")":2==c.CostCenterID?o+=" ("+(t?"AccountCode":"AccountName")+"='"+this.ExcelTable[a][e[0].toString()].toString().Trim().Replace("'","''")+"' and ccnid"+(r-5e4)+"="+s[0].ID.toString()+")":c.CostCenterID>5e4&&(o+=" ("+(t?"Code":"Name")+"='"+this.ExcelTable[a][e[0].toString()].toString().Trim().Replace("'","''")+"' and ccnid"+(r-5e4)+"="+s[0].ID.toString()+")"),this.ExcelTable[a].UniqDim=s[0].ID.toString());if(""!=o){let e=a.a.document.GetCCValues_string(o,c.CostCenterID,"ccnid"+(r-5e4));i.push(c.CostCenterID,e)}}}}else{let e="";for(let t=1;t<this.ExcelTable.length;t++)""!=e&&(e+=","),e+="'"+this.ExcelTable[t][0].toString().Trim().Replace("'","''")+"'";if("CreditAccount_Key"==c.ValueMember||"DebitAccount_Key"==c.ValueMember){let t;if(t=this.ScreenObject.ColumnSource.find("CreditAccount_Key"==c.ValueMember?e=>!n.e.IsEmpty(e.ValueMember)&&"DebitAccount_Key"==e.ValueMember:e=>!n.e.IsEmpty(e.ValueMember)&&"CreditAccount_Key"==e.ValueMember),null!=t){let s=this.DtImport.filter(e=>e.FeatureFieldName==t.ID);if(s.length>0)for(let t=0;t<this.ExcelTable.length;t++)""!=e&&(e+=","),e+="'"+this.ExcelTable[t][s[0][0].toString()].toString().Trim().Replace("'","''")+"'"}}let s=a.a.document.GetCCValues(e,c.CostCenterID,t?1:0,"CreditAccount_Key"==c.ValueMember||"DebitAccount_Key"==c.ValueMember?" and IsGroup=0 ":"");i.push(c.CostCenterID,s)}}}}let d=null,D=0;for(let a=0;a<this.ScreenObject.GridData.length;a++)if(this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&""==n.e.String(this.ScreenObject.GridData[a].ProductID_Key)||this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&""==n.e.String(this.ScreenObject.GridData[a].DebitAccount_Key)||this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&""==n.e.String(this.ScreenObject.GridData[a].CreditAccount_Key)){D=a;break}let S=this.ScreenObject.Data.Tables[0].filter(e=>"ProductID"==e.SysColumnName),p=!1;this.ScreenObject.Preferences.ContainsKey("EnableSchemes")&&Object(o.j)(this.ScreenObject.Preferences.EnableSchemes)&&(p=Object(o.j)(this.ScreenObject.Preferences.EnableSchemes));let y=5;y=n.e.IntTryParse(this.ImportChunkSize),y<1&&(y=5);let g=!0;for(let r=1;r<this.ExcelTable.length;r++){d=null,r%y==0&&(this.DisplayMessage="Importing   "+(r+1).toString()+" of "+this.ExcelTable.length,this.ExcelTable.Columns.Contains("IMPORT_STATUS")&&(this.ExcelTable[r].xIMP_STATUSx="PASS",this.ExcelTable[r].IMPORT_MESSAGE=""));for(let e=0;e<this.DtImport.length-1;e++){let t=this.DtImport[e];if(n.e.IsEmpty(t.FeatureFieldName)||"0"==n.e.String(t.FeatureFieldName))continue;let o=null;if("100"==t.FeatureFieldName.toString()&&this.ImportIsUpdate&&null==d?(l=this.ScreenObject.GridData.filter(e=>e.DocSeqNo==this.ExcelTable[r][0].toString().Trim().Replace("'","''")+"'"),l.length>0&&(d=l[0])):o=this.ScreenObject.ColumnSource.find(e=>e.ID==t.FeatureFieldName.toString()),null==o&&(o=this.ScreenObject.ColumnSource.find(e=>"-"+e.ID==t.FeatureFieldName.toString())),null!=o)if(67==this.ScreenObject.DocumentType&&null==d&&(d=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridDataObj.insertRowAt(d,D),D++,S.length>0&&""!=n.e.StringValue(S[0].UserDefaultValue)&&(d.ProductID_Key=S[0].UserDefaultValue)),81==this.ScreenObject.DocumentType&&null==d&&(g&&(this.ScreenObject.GridDataObj.Clear(),g=!1),d=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridDataObj.insertRowAt(d,D),D++,S.length>0&&""!=n.e.StringValue(S[0].UserDefaultValue)&&(d.ProductID_Key=S[0].UserDefaultValue)),89!=this.ScreenObject.DocumentType&&90!=this.ScreenObject.DocumentType&&68!=this.ScreenObject.DocumentType&&79!=this.ScreenObject.DocumentType||null==d&&(d=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridDataObj.insertRowAt(d,D),D++,S.length>0&&""!=n.e.StringValue(S[0].UserDefaultValue)&&(d.ProductID_Key=S[0].UserDefaultValue)),"LISTBOX"==o.DataType&&!n.e.IsEmpty(i.ContainsKey(o.CostCenterID))&&i.ContainsKey(o.CostCenterID)){if(s=o.DisplayMember.toLowerCase().Contains("code")||a.a.SessionManager.Preferences.ContainsKey("POSItemCodeDimension")&&this.IsInventoryVoucher&&o.CostCenterID.toString()==a.a.SessionManager.Preferences.POSItemCodeDimension?i[o.CostCenterID].Tables[0].filter(e=>e.Code.toLowerCase()==this.ExcelTable[r][0].toLowerCase().toString().Trim().Replace("'","''")):i[o.CostCenterID].Tables[0].filter(e=>e.name.toLowerCase()==this.ExcelTable[r][0].toLowerCase().toString().Trim().Replace("'","''")),i[o.CostCenterID].Tables[0].Contains("dim")&&(s=s.filter(e=>e.dim.toLowerCase()==this.ExcelTable[r].UniqDim.toLowerCase())),11==o.CostCenterID&&i[o.CostCenterID].Tables[0].Contains("ProductID")&&null!=d&&!n.e.IsEmpty(d.ProductID_Key)&&(s=s.filter(e=>e.ProductID.toLowerCase()==d.ProductID_Key.toLowerCase())),0==s.length&&50051==o.CostCenterID&&(s=i[o.CostCenterID].Tables[0].filter(e=>e.name.toLowerCase()==this.ExcelTable[r][0].toLowerCase().toString().Trim().Replace("'","''"))),0==s.length&&11==o.CostCenterID&&i[o.CostCenterID].Contains("ProductID")&&null!=d&&""!=d.ProductID_Key.toString()&&(s=i[o.CostCenterID].Tables[0].filter(e=>e.name.toLowerCase()==this.ExcelTable[r][0].toLowerCase().toString().Trim().Replace("'","''"))),null!=s)if(null==d){if(this.IsInventoryVoucher&&3==o.CostCenterID)if(s.length>0)this.ImportIsUpdate?(l=this.ScreenObject.GridData.filter(e=>e.ProductID_Key==s[0].ID.toString()),l.length>0&&(d=l[0])):(d=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridDataObj.insertRowAt(d,D),D++,d.ProductID_Key=s[0].ID,this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(d.ProductCode=s[0].Code),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(d.ProductName=s[0].Name),this.ProdID=0,this.AddProductData(d,!1,!0));else{let e,s=this.ScreenObject.ColumnSource.find(e=>null!=e.ValueMember&&"productid_key"==e.ValueMember.toLowerCase());if(null!=s&&null!=s.DefaultValue&&""!=s.DefaultValue&&null!=s.DefaultValueText&&n.e.IntTryParse(s.DefaultValue)>0){e=n.e.IntTryParse(s.DefaultValue),d=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridDataObj.insertRowAt(d,D),D++;let t=s.DefaultValueText.split("\x11");d.ProductID_Key=s.DefaultValue,this.ScreenObject.GridDataColumns.Contains("ProductCode")&&t.length>1&&(d.ProductCode=t[1]),this.ScreenObject.GridDataColumns.Contains("ProductName")&&t.length>0&&(d.ProductName=t[0]),this.ProdID=0,this.AddProductData(d,!1,!0)}else{if(o.DisplayMember.toLowerCase().Contains("code")){let e=new ts;e.Name=" Product Code: "+this.ExcelTable[r][t[0].toString()].toString(),e.Message="Not Found",this.FailedRecourdList.push(e)}this.ExcelTable.Columns.Contains("IMPORT_STATUS")&&(this.ExcelTable[r].xIMP_STATUSx="FAIL",this.ExcelTable[r].IMPORT_MESSAGE=this.ExcelTable[r][t[0].toString()].toString()+" Not Found")}}else 2==o.CostCenterID&&!this.IsInventoryVoucher&&s.length>0?this.ImportIsUpdate?(l=this.ScreenObject.GridData.filter(e=>e.ProductID_Key==s[0].ID.toString()),l.length>0&&(d=l[0])):(d=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridDataObj.insertRowAt(d,D),D++,d[o.ValueMember]=s[0].ID,o.DisplayMember.toLowerCase().Contains("code")&&this.ScreenObject.GridDataColumns.Contains(o.DisplayMember)?d[o.DisplayMember]=s[0].Code:this.ScreenObject.GridDataColumns.Contains(o.DisplayMember)&&(d[o.DisplayMember]=s[0].Name)):a.a.SessionManager.Preferences.ContainsKey("POSItemCodeDimension")&&this.IsInventoryVoucher&&o.CostCenterID.toString()==a.a.SessionManager.Preferences.POSItemCodeDimension?s.length>0?(d=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridDataObj.insertRowAt(d,D),D++,d[o.ValueMember]=s[0].ID,d[o.DisplayMember]=s[0].Code,this.ScreenObject.Preferences.ContainsKey("OnScan")&&""!=this.ScreenObject.Preferences.OnScan.toLowerCase()?this.GetProductByExternFunc(d[o.DisplayMember].toString(),d,D):this.ScreenObject.Preferences.ContainsKey("PickStockRate")&&"true"==this.ScreenObject.Preferences.PickStockRate.toLowerCase()?(this.GetProductByStockCode(d[o.DisplayMember].toString(),d,D),""!=d.ProductID_Key.toString()&&this.FillScan(d,D)):this.AddProductData(d,!1,!1,!1,null,d[o.DisplayMember].toString())):this.ExcelTable.Columns.Contains("IMPORT_STATUS")&&(this.ExcelTable[r].xIMP_STATUSx="FAIL",this.ExcelTable[r].IMPORT_MESSAGE=this.ExcelTable[r][t[0].toString()].toString()+" Not Found"):this.IsInventoryVoucher&&50051==o.CostCenterID&&(s.length>0?this.ImportIsUpdate?(l=this.ScreenObject.GridData.filter(e=>e.col.DisplayMember+"_Key"==s[0].ID.toString()),l.length>0&&(d=l[0])):(d=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridDataObj.insertRowAt(d,D),D++,S.length>0&&""!=n.e.StringValue(S[0].UserDefaultValue)&&(d.ProductID_Key=S[0].UserDefaultValue),d[o.ValueMember]=s[0].ID,o.DisplayMember.toLowerCase().Contains("code")&&this.ScreenObject.GridDataColumns.Contains(o.DisplayMember)?(d[o.DisplayMember]=s[0].Code,d[o.DisplayMember.toLowerCase().Replace("code","")]=s[0].Name):this.ScreenObject.GridDataColumns.Contains(o.DisplayMember)&&(d[o.DisplayMember]=s[0].Name)):this.ExcelTable.Columns.Contains("IMPORT_STATUS")&&(this.ExcelTable[r].xIMP_STATUSx="FAIL",this.ExcelTable[r].IMPORT_MESSAGE=this.ExcelTable[r][t[0].toString()].toString()+" Not Found"));67!=this.ScreenObject.DocumentType&&79!=this.ScreenObject.DocumentType||this.Celleditend(d,o.DisplayMember,0),2!=o.CostCenterID||this.IsInventoryVoucher||0!=s.length||this.ExcelTable.Columns.Contains("IMPORT_STATUS")&&(this.ExcelTable[r].xIMP_STATUSx="FAIL",this.ExcelTable[r].IMPORT_MESSAGE=this.ExcelTable[r][t[0].toString()].toString()+" Not Found")}else null!=d&&3!=o.CostCenterID&&(s.length>0?(d[o.ValueMember]=s[0].ID,this.ScreenObject.GridDataColumns.Contains(o.DisplayMember)&&(o.DisplayMember.endsWith("Code")?(d[o.DisplayMember]=s[0].Code,d.Table.Columns.Contains(o.DisplayMember.Replace("Code",""))&&(d[o.DisplayMember.Replace("Code","")]=s[0].Name)):d[o.DisplayMember]=s[0].Name)):this.ExcelTable.Columns.Contains("IMPORT_STATUS")&&(this.ExcelTable[r].xIMP_STATUSx="FAIL",this.ExcelTable[r].IMPORT_MESSAGE=this.ExcelTable[r][t[0].toString()].toString()+" Not Found"),11==this.CostCenterID&&this.OnProductUnitChange(d),67!=this.ScreenObject.DocumentType&&63!=this.ScreenObject.DocumentType&&79!=this.ScreenObject.DocumentType||this.Celleditend(d,o.DisplayMember,0))}else if(null!=d&&null!=o&&"LINK"==o.DataType&&"refno"==o.DisplayMember.toLowerCase()&&i.Contains(400)&&i.Contains(43))s=i[400].filter(e=>e.VoucherNo=="'"+this.ExcelTable[r][0].toString().Trim()+"'"&&e.ProductID==d.ProductID_Key.toString()),s.length>0&&(d[o.DisplayMember]=this.ExcelTable[r][0].toString().Trim(),d.LinkedInvDocDetailsID=s[0].InvDocDetailsID.toString(),s=i[43].filter(e=>e.CostCenterIDLinked==s[0].CostCenterID.toString()),s.length>0&&(d.LinkedFieldName=s[0].SysColumnName.toString()));else if(null!=d&&null!=o&&"LINK"==o.DataType&&o.DisplayMember.Contains("dcAlpha"));else if(null==d||"FLOAT"!=o.DataType.toUpperCase()&&"INT"!=o.DataType.toUpperCase())if(null==d||"textblock"!=o.DataType.toLowerCase()&&"text"!=o.DataType.toLowerCase()&&"FLOAT"!=o.DataType.toUpperCase()&&"INT"!=o.DataType.toUpperCase())if(null==d||"date"!=o.DataType.toLowerCase()&&"datetime"!=o.DataType.toLowerCase()&&"time"!=o.DataType.toLowerCase()&&"time2"!=o.DataType.toLowerCase()){if(null!=d&&"combobox"==o.DataType.toLowerCase()){if(68==this.ScreenObject.DocumentType&&(this.ExcelTable[r][0].toString().Trim().toLowerCase().Contains("earning")||this.ExcelTable[r][t.FieldName.toString()].toString().Trim().toLowerCase().Contains("deduction")))this.ExcelTable[r][t.FieldName.toString()].toString().Trim().toLowerCase().Contains("earning")&&(d[o.ValueBinding]=2),this.ExcelTable[r][t.FieldName.toString()].toString().Trim().toLowerCase().Contains("deduction")&&(d[o.ValueBinding]=3);else{d[o.ValueBinding]=this.ExcelTable[r][0].toString().Trim();let e=this.ScreenObject.ColumnSource.filter(e=>"dcCCNID52"==e.DisplayMember);null!=e&&!n.e.IsEmpty(e.Shortcut)&&"lostfocus"==e.Shortcut.toLowerCase()&&this.ValidateData_Column(e,d,!0)&&this.ScreenObject.GetExternalFuncData(e.Mode,e.SPName,e.IPParams,e.OPParams,d)}63==this.ScreenObject.DocumentType&&this.Celleditend(d,o.ValueBinding,0)}else if(null!=d&&"pactcombobox"==o.DataType.toLowerCase()&&68==this.ScreenObject.DocumentType){let e=o.ComboDataTable.filter(e=>e.NAME==this.ExcelTable[r][0].toString().Trim());null!=e&&e.length>0&&(d[o.ValueBinding]=e[0].NODEID,d[o.ValueBinding+"_Key"]=e[0].NAME)}}else{let e;n.e.isValidDate(new Date(this.ExcelTable[r][0].toString()))&&(e=new Date(this.ExcelTable[r][0].toString()),"date"==o.DataType.toLowerCase()?(d[o.DisplayMember]=e.ToString(a.a.SessionManager.Preferences["Date Format"]),d[o.DisplayMember+"_Key"]=e,60!=this.ScreenObject.DocumentType&&63!=this.ScreenObject.DocumentType||this.Celleditend(d,o.DisplayMember,0)):"datetime"==o.DataType.toLowerCase()?(d[o.DisplayMember]=e.ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss tt"),d[o.DisplayMember+"_Key"]=e):"time"==o.DataType.toLowerCase()?(d[o.DisplayMember]=e.ToString("hh:mm:ss tt"),d[o.DisplayMember+"_Key"]=e):"time2"==o.DataType.toLowerCase()&&(d[o.DisplayMember]=e.ToString("HH:mm"),d[o.DisplayMember+"_Key"]=e.ToString("dd-MMM-yyyy HH:mm"),67==this.ScreenObject.DocumentType&&this.Celleditend(d,o.DisplayMember,0)))}else d[o.DisplayMember]=this.ExcelTable[r][0].toString().Trim(),67==this.ScreenObject.DocumentType&&this.Celleditend(d,o.DisplayMember,0);else n.e.DoubleTryParse(this.ExcelTable[r][t[0].toString()].toString().Trim())>0&&(d[o.DisplayMember]=this.ExcelTable[r][t[0].toString()].toString().Trim()),67==this.ScreenObject.DocumentType&&this.Celleditend(d,o.DisplayMember,0);else if(0==r){let e=this.ScreenObject._TextFields.find(e=>e.DBColumnID.toString()==t.FeatureFieldName.toString());if(null==e&&(e=this.ScreenObject._CCFields.find(e=>e.DBColumnID.toString()==t.FeatureFieldName.toString()),null==e&&(e=this.ScreenObject._CCFields.find(e=>"-"+e.DBColumnID.toString()==t.FeatureFieldName.toString()))),null==e&&(e=this.ScreenObject._StaticFields.find(e=>e.DBColumnID.toString()==t.FeatureFieldName.toString())),null!=e)if(e instanceof b.c&&"docdate"==e.DBColumnName.toLowerCase()&&""!=this.ExcelTable[r][0].toString())this.DocumentDate=new Date(this.ExcelTable[r][0].toString());else if(e instanceof m.b){let t=a.a.document.GetCCValues("'"+this.ExcelTable[r][0].toString().Trim().Replace("'","''")+"'",e.CCID,0);null!=t&&t.length>0&&t.Columns.Contains("ID")&&this.ScreenObject.fillcontrolValue(e,t[0].ID.toString())}else if(e instanceof C.a){let t=a.a.document.GetCCValues("'"+this.ExcelTable[r][0].toString().Trim().Replace("'","''")+"'",e.CCID,0);null!=t&&t.length>0&&t.Columns.Contains("ID")&&this.ScreenObject.fillcontrolValue(e,t[0].ID.toString(),!1,t)}else e instanceof b.c&&this.ScreenObject.fillcontrolValue(e,this.ExcelTable[r][0].toString())}else if("-500"==t[1].toString()&&null!=d&&"5"==d.Type.toString()&&""!=this.ExcelTable[r][0].toString()){let e=0,s=0;s=this.ScreenObject.LocationID>0?this.ScreenObject.LocationID:a.a.SessionManager.LocationID,e=this.ScreenObject.DivisionID>0?this.ScreenObject.DivisionID:a.a.SessionManager.DivisionID;let i=new Te.a(this.ScreenObject.GridDataObj);i.BatchNumberViewModel_4(this,this.VoucherType,parseFloat(d.Quantity.toString()),null,parseInt(d.ProductID_Key.toString()),d.ProductName.toString(),s,e,"");{let e;-1==this.VoucherType?(e=i.GridData.filter(e=>e.BATCHNUMBER==this.ExcelTable[r][t[0].toString()].toString()),e.length>0&&(e[0].Quantity=""!=e[0].BalQty.toString()&&parseFloat(e[0].BalQty.toString())>parseFloat(d.Quantity.toString())?d.Quantity.toString():e[0].BalQty)):(e=i.dsBatch.Tables[0].filter(e=>e.BATCHNUMBER==this.ExcelTable[r][t[0].toString()].toString()),e.length>0&&(i.GridData[0].BatchID=e[0].BatchID.toString(),i.OnBatchSelected(i.GridData[0],parseInt(e[0].BatchID.toString())),i.GridData[0].Quantity=d.Quantity.toString())),e.length>0&&i.OnSave("AutoSave")}}}if(null!=d&&(this.IsInventoryVoucher?this.CalculateTotals(d,!1,"Quantity"):this.CalculateTotals(d,!1),p)){if(""!=d.ProductID_Key.toString()&&parseInt(d.ProductID_Key.toString())>0){let e=this.ScreenObject.GetSchemes(this.DocumentDate,d);e.Tables.length>0&&e.Columns[0].Contains("SchemeID")&&this.fillSchemevalues(this.DtTempSchemes,e.Tables[0],d)}this.ApplySchemes(d)}}if(63==this.ScreenObject.DocumentType){let e=0;for(let t=0;t<this.ScreenObject.GridData.length-1;t++)if(t>=1&&(e=t-1),null!=this.ScreenObject.GridData[t].dcCCNID51_Key&&null!=this.ScreenObject.GridData[t].dcCCNID52_Key&&null!=this.ScreenObject.GridData[t].dcCCNID51_Key&&null!=this.ScreenObject.GridData[t].dcCCNID52_Key&&null!=this.ScreenObject.GridData[t].dcAlpha4_Key&&null!=this.ScreenObject.GridData[t].dcAlpha5_Key&&null!=this.ScreenObject.GridData[e].dcAlpha4_Key&&null!=this.ScreenObject.GridData[e].dcAlpha5_Key){if(t!=e&&parseInt(this.ScreenObject.GridData[t].dcCCNID51_Key)==parseInt(this.ScreenObject.GridData[e].dcCCNID51_Key)&&parseInt(this.ScreenObject.GridData[t].dcCCNID52_Key)==parseInt(this.ScreenObject.GridData[e].dcCCNID52_Key)&&null!=this.ScreenObject.GridData[t].dcAlpha4_Key&&null!=this.ScreenObject.GridData[e].dcAlpha4_Key&&null!=this.ScreenObject.GridData[e].dcAlpha5_Key&&(new Date(this.ScreenObject.GridData[e].dcAlpha4_Key)>=new Date(this.ScreenObject.GridData[t].dcAlpha4_Key)&&new Date(this.ScreenObject.GridData[e].dcAlpha4_Key)<=new Date(this.ScreenObject.GridData[t].dcAlpha5_Key)||new Date(this.ScreenObject.GridData[t].dcAlpha4_Key)>=new Date(this.ScreenObject.GridData[e].dcAlpha4_Key)&&new Date(this.ScreenObject.GridData[t].dcAlpha4_Key)<=new Date(this.ScreenObject.GridData[e].dcAlpha5_Key))){this.DisplayMessage="FromDate already exist",this.ScreenObject.GridData[e].dcAlpha7=0;break}if(t!=e&&parseInt(this.ScreenObject.GridData[t].dcCCNID51_Key)==parseInt(this.ScreenObject.GridData[e].dcCCNID51_Key)&&parseInt(this.ScreenObject.GridData[t].dcCCNID52_Key)==parseInt(this.ScreenObject.GridData[e].dcCCNID52_Key)&&null!=this.ScreenObject.GridData[t].dcAlpha5_Key&&null!=this.ScreenObject.GridData[e].dcAlpha5_Key&&null!=this.ScreenObject.GridData[e].dcAlpha4_Key){if(t!=e&&new Date(this.ScreenObject.GridData[e].dcAlpha5_Key)>=new Date(this.ScreenObject.GridData[t].dcAlpha4_Key)&&new Date(this.ScreenObject.GridData[e].dcAlpha5_Key)<=new Date(this.ScreenObject.GridData[t].dcAlpha5_Key)||new Date(this.ScreenObject.GridData[t].dcAlpha5_Key)>=new Date(this.ScreenObject.GridData[e].dcAlpha4_Key)&&new Date(this.ScreenObject.GridData[t].dcAlpha5_Key)<=new Date(this.ScreenObject.GridData[e].dcAlpha5_Key)){this.DisplayMessage="ToDate already exist",this.ScreenObject.GridData[e].dcAlpha7=0;break}parseInt(this.ScreenObject.GridData[e].dcCCNID51_Key)==parseInt(this.ScreenObject.GridData[t].dcCCNID51_Key)&&parseInt(this.ScreenObject.GridData[e].dcCCNID52_Key)==parseInt(this.ScreenObject.GridData[t].dcCCNID52_Key)&&parseFloat(this.ScreenObject.GridData[e].dcAlpha3)==parseFloat(this.ScreenObject.GridData[t].dcAlpha3)?parseFloat(this.ScreenObject.GridData[e].dcAlpha3)>=parseFloat(this.ScreenObject.GridData[t].dcAlpha3)?this.ScreenObject.GridData[t].dcAlpha3=parseFloat(this.ScreenObject.GridData[e].dcAlpha3)-parseFloat(this.ScreenObject.GridData[t].dcNum1):parseFloat(this.ScreenObject.GridData[e].dcAlpha3)<parseFloat(this.ScreenObject.GridData[t].dcAlpha3)&&(this.ScreenObject.GridData[t].dcAlpha3=parseFloat(this.ScreenObject.GridData[t].dcNum1)-parseFloat(this.ScreenObject.GridData[e].dcAlpha3)):parseInt(this.ScreenObject.GridData[e].dcCCNID51_Key)==parseInt(this.ScreenObject.GridData[t].dcCCNID51_Key)&&parseInt(this.ScreenObject.GridData[e].dcCCNID52_Key)==parseInt(this.ScreenObject.GridData[t].dcCCNID52_Key)&&parseFloat(this.ScreenObject.GridData[e].dcAlpha3)<parseFloat(this.ScreenObject.GridData[t].dcAlpha3)&&(this.ScreenObject.GridData[t].dcAlpha3=parseFloat(this.ScreenObject.GridData[t].dcAlpha3)-parseFloat(this.ScreenObject.GridData[e].dcNum1))}}}this.DisplayMessage="",this.ScreenObject.UpdateSequence(),this.ListVisbility=this.FailedRecourdList.length>0;try{this.UpdateExcelSheet()}catch(O){}}UpdateExcelSheet(){}GetLeaveEncashAmount(e,t){let s,i,r=0,o=null,l=new ct.b;if(null!=this.dsData||this.DimensionSelectedvalueData(),o=this.dsData,o.Tables[1].length>0){l.sEmpSeqNo=o.Tables[0][0].NodeID.toString();let c={PayrollMonth:l.PayrollMonth,PayrollMonthStart:l.PayrollMonthStart,PayrollMonthEnd:l.PayrollMonthEnd};n.e.SetPayrollDate(this.ScreenObject.DocDate.Date,c),l.PayrollMonth=c.PayrollMonth,l.PayrollMonthStart=c.PayrollMonthStart,l.PayrollMonthEnd=c.PayrollMonthEnd,l.arrLstCPFields[6].Clear(),l.Intialize(),l.othMPField.BasicMonthly=parseFloat(o.Tables[2][0].BasicMonthly),l.ExecuteAllFormulas();let h=new ct.a;s=o.Tables[1].filter(e=>e.ComponentID==t),s.length>0&&(h.ComponentName="EncashFormula",h.Formula=s[0].EncashFormula.toString(),l.arrLstCPFields[6].push(h)),i=new O.c("EncashDays",""),l.fldDict.push("EncashDays",i),l.fldDict.EncashDays.setFieldValue(e);let u=l.fldDict;n.e.IsEmpty(l.arrLstCPFields[6][0].Formula)||(r=parseFloat(a.a.eval.EvaluateExpression(l.arrLstCPFields[6][0].Formula.toString(),u)))}return r}FillEarnDeductDetails(e,t){Logger.InfoLog("AddEditDocumentViewModel::Entering FillEarningsandDeductions");try{let s=[],i=this.ScreenObject._TextFields.find(e=>"dcAlpha1"==e.DBColumnName.toString());if(0==e){if(i){let e;e=new Date(parseInt(new Date(a.a.SessionManager.FinancialYearStartDate).ToString("yyyy")),a.a.SessionManager.AccountingFromMonth-1,1),i.Date=new Date(e),i.CustomFormat="yyyy",this.SetMonthNames(e.getFullYear())}}else this.SetMonthNames(t);let r=this.ScreenObject.GetPayrollComponents(2,1,0,i?new Date(i.Date):this.ScreenObject.DocDate.Date);if(r.Tables.length>0){r.Tables[0].sort((e,t)=>e.ParentID-t.ParentID);let e=this.ScreenObject.ColumnSource.find(e=>"dcAlpha2"==e.ValueBinding);if(e&&r.Tables[0].length>0){for(let e=0;e<=r.Tables[0].length-1;e++)s.push(D.d.ComboBoxItems_2(r.Tables[0][e].NAME.toString(),r.Tables[0][e].NODEID.toString()));e.DisplayMember="Name",e.ValueMember="Value",e.ComboData=s}}let o=null,l=0;if(r.Tables.length>0&&r.Tables[0].length>0){o=null,this.ScreenObject.GridDataObj.Clear();let e=this.ScreenObject.Data.Tables[0].filter(e=>"ProductID"==e.SysColumnName);for(let t=0;t<r.Tables[0].length;t++)o=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridData.InsertAt(o,l),l++,e.length>0&&!n.e.IsEmpty(e[0].UserDefaultValue)&&(o.ProductID_Key=e[0].UserDefaultValue),o.dcAlpha2=r.Tables[0][t].NODEID,o.dcAlpha15=2==parseInt(r.Tables[0][t].ParentID)?"Earnings":"Deductions";r.Tables[0].length>0&&this.ScreenObject.GridDataObj.refreshDataView()}}catch(s){this.DisplayMessage="Load Error",Logger.ErrorLog("AddEditDocumentViewModel:: FillEarningsandDeductions"+s.stack)}}SetMonthNames(e){Logger.InfoLog("AddEditDocumentViewModel::Entering SetMonthNames");try{let t,s=0,i=0,n=0,r=0,o=0,l=0;o=e,t=o.toString(),o=parseInt(t.substr(2,2)),l=o+1,s=a.a.SessionManager.AccountingFromMonth,r=s;let c=this.ScreenObject.ColumnSource.find(e=>"dcalpha3"==e.DisplayMember.toLowerCase());for(let e=2;e<14;e++)if(12==i){n=i+2-e;for(let t=1;t<=n;t++)c=this.ScreenObject.ColumnSource.find(e=>e.DisplayMember.toLowerCase()=="dcalpha"+(t+2).toString()),c&&(c.Header=this.ScreenObject.GetMonthName(t,!1)+"-"+l.toString(),c.DisplayMember="dcAlpha"+(t+2).toString()),e+=1}else c=this.ScreenObject.ColumnSource.find(t=>t.DisplayMember.toLowerCase()=="dcalpha"+(e+r).toString()),c&&(i=s+(e-2),c.Header=this.ScreenObject.GetMonthName(i,!1)+"-"+o.toString(),c.DisplayMember="dcAlpha"+(e+r).toString());this.ScreenObject.GridDataObj.RefreshColumns()}catch(t){this.DisplayMessage="Load Month Names Error",Logger.ErrorLog("AddEditDocumentViewModel:: SetMonthNames"+t.stack)}}PostSalaryDocResetColumns(){let e=this.ScreenObject.ColumnSource.find(e=>"dcalpha1"==e.DisplayMember.toLowerCase());for(let t=1;t<13;t++)e=this.ScreenObject.ColumnSource.find(e=>e.DisplayMember.toLowerCase()=="dcalpha"+(t+2).toString()),e&&(e.IsVisible=!0);this.ScreenObject.GridDataObj.RefreshColumns()}SetNoofMonths(e){Logger.InfoLog("AddEditDocumentViewModel::Entering SetNoofMonths");try{if(parseInt(e.Tables[0][0].NoOfMonths)>0){let t=0;t=parseInt(e.Tables[0][0].NoOfMonths);let s=this.ScreenObject.ColumnSource.find(e=>"dcalpha1"==e.DisplayMember.toLowerCase());if(1==a.a.SessionManager.AccountingFromMonth){t+=1;for(let e=t;e<13;e++)s=this.ScreenObject.ColumnSource.find(t=>t.DisplayMember.toLowerCase()=="dcalpha"+(e+2).toString()),s&&(s.IsVisible=!1)}else{t+=2,this.ScreenObject.ColumnSource.forEach(e=>{for(let t=1;t<13;t++)null!=e.DisplayMember&&""!=e.DisplayMember&&e.DisplayMember.toLowerCase()=="dcalpha"+(t+2).toString()&&(e.IsVisible=!1)});for(let e=2;e<t;e++)s=this.ScreenObject.ColumnSource.find(t=>t.DisplayMember.toLowerCase()=="dcalpha"+(a.a.SessionManager.AccountingFromMonth+e).toString()),s&&(s.IsVisible=!0)}this.ScreenObject.GridDataObj.RefreshColumns()}}catch(t){this.DisplayMessage="Load NoofMonths Error",Logger.ErrorLog("AddEditDocumentViewModel:: SetNoofMonths"+t.stack)}}static GetPrimarkyKey(e,t=!1){return 2==e?"AccountID":3==e?"ProductID":t?"CCNID"+(e-5e4):"NodeID"}HideButtons(e){"BarcodePrint"==e?this.ButtonBarcode.Enable=a.a.SessionManager.LicenseSettings.ContainsKey("Barcode")&&"FALSE"==a.a.SessionManager.LicenseSettings.Barcode.toUpperCase()?this.ButtonBarcode.Visible=!1:a.a.SessionManager.HideUnathorizedAccess?this.ButtonBarcode.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"BarcodePrint"):a.a.SessionManager.IsActionAssigned(this.CostCenterID,"BarcodePrint"):"Save&Barcode"==e&&(this.ButtonSaveandBarcode.Enable=a.a.SessionManager.LicenseSettings.ContainsKey("Barcode")&&"FALSE"==a.a.SessionManager.LicenseSettings.Barcode.toUpperCase()?this.ButtonSaveandBarcode.Visible=!1:a.a.SessionManager.HideUnathorizedAccess?this.ButtonSaveandBarcode.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save&Barcode"):a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save&Barcode"))}PrintVoucher(e,t,s,i,o=-1,l=null,c=!1,h="",u=null){let d=this;d.DisplayMessage="";let D=d.CostCenterID,S=d.IsInventoryVoucher;if(!n.e.IsEmpty(i)){let e=new n.f;e.LoadXml(i),null!=e.DocumentElement.attributes.CostCenterID&&(D=parseInt(e.DocumentElement.attributes.CostCenterID.value)),null!=e.DocumentElement.attributes.IsInventoryVoucher&&(S="1"==e.DocumentElement.attributes.IsInventoryVoucher.value)}if(!n.e.IsEmpty(t)&&"0"!=t){if(s){if(376==d.StatusID)return"Documents is cancelled";if(371==d.StatusID&&d.DoNotPrintUnApprovedDocuments&&!e)return"Un-Approved Documents not allowed to print";if(d.LineWiseApproval){let t=!1,s=!1,i=!1;if(d.GRIDTABLE.forEach(e=>{if(null!=e.DocDetailsID&&parseInt(e.DocDetailsID)>0)switch(e.StatusID.toString()){case"371":t=!0;break;case"372":s=!0;break;case"441":i=!0}}),t&&d.DoNotPrintUnApprovedDocuments&&!e&&!a.a.SessionManager.IsActionAssigned(d.CostCenterID,"Print/Export Un-Approved"))return"Un-Approved documents not allowed to print";if(i&&!e&&!a.a.SessionManager.IsActionAssigned(d.CostCenterID,"Print/Export Approved"))return"Approved documents not allowed to print";if(s&&!e&&!a.a.SessionManager.IsActionAssigned(d.CostCenterID,"Print/Export Rejected"))return"Rejected documents not allowed to print"}else{if(371==d.StatusID&&!e&&!a.a.SessionManager.IsActionAssigned(d.CostCenterID,"Print/Export Un-Approved"))return"Un-Approved documents not allowed to print";if(441==d.StatusID&&!e&&!a.a.SessionManager.IsActionAssigned(d.CostCenterID,"Print/Export Approved"))return"Approved documents not allowed to print";if(372==d.StatusID&&!e&&!a.a.SessionManager.IsActionAssigned(d.CostCenterID,"Print/Export Rejected"))return"Rejected documents not allowed to print"}}let o=0,c=new r.a;t.Contains(",")||(o=n.e.Int(t));let h=null,S=_e.VoucherExportExcel.GetLocationPrintLayouts(D,0,o);if(this.IsExportPrint)h=l;else{if(0!=d.CashDrwerPrintID)for(let t=S.Tables[0].length-1;t>=0;t--)parseInt(S.Tables[0][t].DocPrintLayoutID)!=d.CashDrwerPrintID&&S.Tables[0].RemoveAt(t);if(null==S||0==S.Tables[0].length)return a.a.GetResource("Err_PrintLayoutNotDefined");let e=!1;if(1==S.Tables[0].length&&S.Columns[0].Contains("Copies")&&null!=S.Tables[0][0].Copies&&0==d.CashDrwerPrintID&&parseInt(S.Tables[0][0].Copies)>0&&(e=!0),this.iLayCnt=S.Tables[0].length,this.ScreenObject.Preferences.ContainsKey("AskForVoucherPrintFormat")&&"TRUE"!=this.ScreenObject.Preferences.AskForVoucherPrintFormat.toUpperCase())h=S.Tables[0][0];else if(S.Tables[0].length>1||e){this.bDSExists=!1,this.sDSCUserName="",this.oDSImg=null;let e=new ke.VPTDialogViewModel(S.Tables[0]),t=o>0?o:this.DocID;a.a.page.ShowDialog(e,Ke.VPTDialogComponent,{ShowCenter:!0},()=>{if(e.IsOkClicked&&(this.sDSCUserName=e.sDSCUserName,h=e.SelectedRow),null!=h){let s=e.IsExcelChecked?"EXCEL":"PDF";a.a.report.ExportVPT(D,t,parseInt(h.DocPrintLayoutID),s,this.IsInventoryVoucher,c,i).subscribe(e=>{u&&(u.DisplayMessage=""),console.log(e),a.a.SessionManager.printTab(e.FileName),n.e.IsEmpty(e.Message)&&!n.e.IsEmpty(e.FileName)&&(this.DisplayMessage="Printed Sucessfully")},e=>{u&&(u.DisplayMessage="Error in Preview"),console.log(e)})}})}else h=S.Tables[0][0]}this.dsTotLayouts=S,this.drSelPrintLayout=h,null!=h&&a.a.report.ExportVPT(this.CostCenterID,t,parseInt(h.DocPrintLayoutID),"PDF",this.IsInventoryVoucher,c,i).subscribe(e=>{u&&(u.DisplayMessage=""),console.log(e),a.a.SessionManager.Download(e.FileName,"abcd"),a.a.SessionManager.printTab(e.FileName),n.e.IsEmpty(e.Message)&&!n.e.IsEmpty(e.FileName)&&(this.DisplayMessage="printed Successfully")},e=>{u&&(u.DisplayMessage="Error in Preview"),console.log(e)})}return""}GenerateAPIRequest(e){try{a.a.document.GetDocumentMapFieldsDetail(this.CostCenterID,e)}catch(t){Logger.ErrorLog("GenerateAPIRequest::EXCEPTION GenerateAPIRequest()"+t.StackTrace+" "+t.Message)}}APICallRequest(e,t,s,i){}GetEInv(e){}static GetTotalMonthsFrom(e,t){let s=e.Date()>t.Date()?t.Date():e.Date(),i=e>t.Date()?e.Date():t.Date(),a=1;for(;s.AddMonths(a)<=i;)a++;return a}SaveShiftAssign(){for(let a=0;a<this.ScreenObject.GridData.length;a++)if(!n.e.IsEmpty(this.ScreenObject.GridData[a].ProductID_Key))for(let e=0;e<this.ScreenObject.ColumnSource.length;e++)if(this.ScreenObject.ColumnSource[e].Mandatory&&!this.MandaotryValidation(a,e))return!1;let e=0;this.LineWiseApproval||(e=this.GetWorkFlow(!1,null));let t=0,s=[];s.push(this.ScreenObject.CostCenterID),s.push(this.ScreenObject.DocID),s.push(this.ScreenObject.DocPrefix.ComboBox.Text),s.push(this.ScreenObject.DocPrefix.TextBox.Text),s.push(this.ScreenObject.DocDate.Date),s.push(this.ScreenObject.DocDate.Date),s.push(""),s.push(this.GetShiftAssignDocumentXML()),s.push(""),s.push(""),s.push(""),s.push(""),s.push("false"),a.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==a.a.SessionManager.Preferences.EnableLocationWise.toString()?s.push(a.a.SessionManager.LocationID>0?a.a.SessionManager.LocationID:1):s.push(0),a.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==a.a.SessionManager.Preferences.EnableDivisionWise.toString()?s.push(a.a.SessionManager.DivisionID>0?a.a.SessionManager.DivisionID:1):s.push(0),s.push(e),s.push(a.a.SessionManager.RoleID),s.push(""),s.push(0),s.push(0),s.push(a.a.SessionManager.CompanyGUID),s.push(a.a.SessionManager.UserName),s.push(a.a.SessionManager.UserID),s.push(a.a.SessionManager.LanguageID),s.push(a.a.SessionManager.IsOffline);let i="";return a.a.document.SetTempInvDocument(s).subscribe(e=>{t=e.obj;let s=e;if(i=null!=s&&s.Tables.length>0&&s.Tables[s.Tables.length-1].length>0&&s.Columns[s.Tables.length-1].Contains("ErrorMessage")?s.Tables[s.Tables.length-1][0].ErrorMessage.toString():"Problem in processing your request,Please contact administrator.",t>0){null!=s&&s.Tables.length>0&&s.Tables[s.Tables.length-1].length>0&&s.Columns[s.Tables.length-1].Contains("VoucherNo")&&(this.ScreenObject.VoucherNo=s.Tables[s.Tables.length-1][0].VoucherNo.toString());let e={value:this._Ddate};this.ScreenObject.OnDocPrefixChanged(this.ScreenObject.Prefix,0,0,e,!1),this._Ddate=e.value,this.clear(2),this.commandprarameter=""}else null!=s&&s.Tables.length>0&&s.Tables[s.Tables.length-1].length>0&&s.Columns[s.Tables.length-1].Contains("ServerMessage")&&(t="-407"==s.Tables[s.Tables.length-1][0].ServerMessage.toString()?-407:-12345);this.DisplayMessage=i,this.MessageVisibility=!0}),!1}GetShiftAssignDocumentXML(){let e="";a.a.SessionManager.Preferences.ContainsKey("ShiftAssignBasedOn")&&(e=a.a.SessionManager.Preferences.ShiftAssignBasedOn);let t,s="",i="",r="",o="",l="",c="";null!=a.a.SessionManager.dtDocDefAccs&&(t=a.a.SessionManager.dtDocDefAccs.filter(e=>40092==e.CostCenterID&&"CreditAccount"==e.SysColumnName),null!=t&&t.length>0&&!n.e.IsEmpty(t[0].UserDefaultValue)&&""!=t[0].UserDefaultValue.toString().Trim()&&(l=t[0].UserDefaultValue.toString()),t=a.a.SessionManager.dtDocDefAccs.filter(e=>40092==e.CostCenterID&&"DebitAccount"==e.SysColumnName),null!=t&&t.length>0&&!n.e.IsEmpty(t[0].UserDefaultValue)&&""!=t[0].UserDefaultValue.toString().Trim()&&(c=t[0].UserDefaultValue.toString())),i+='" ProductID="'+this.ScreenObject.GridData[0].ProductID_Key.toString()+'" Quantity="0" Unit="1" UOMConversion="1" UOMConvertedQty="0" Rate="0" Gross="0" IsQtyIgnored="1" AverageRate="0" StockValue="0" StockValueFC="0" RefNO="" BillDate="'+this.ScreenObject.DocDate.Date.ToString("dd/MMM/yyyy")+'" CurrencyID="1" ExchangeRate="1" DebitAccount="'+c+'" CreditAccount="'+l;var h=this.ScreenObject.HeaderFields.find(e=>"CommonNarration"==e.DBColumnName);h&&(i+='" CommonNarration="'+n.e.EncodeXML(this.ScreenObject.GetcontrolValue(h)));let u="DayWise";var d=this.ScreenObject._TextFields.find(e=>"dcalpha4"==e.DBColumnName.toLowerCase());d&&(u=d.SelectedValue);for(let a=0;a<this.ScreenObject.GridData.length;a++)if("DayWise"==u){let t=!0,l="";for(let c=this.iDtColFrom;c<=this.iDtColUpto;c++){t=!0;let h=e.split(",");if(null!=h&&h.length>0)for(let e=0;e<h.length;e++)null!=h[e]&&null!=h[e]&&""!=h[e]&&(l="-2"==h[e]?"dcCCNID51_Key":"dcCCNID"+(parseInt(h[e])-5e4)+"_Key",n.e.IsEmpty(this.ScreenObject.GridData[a][l])&&(t=!1));if(this.ScreenObject.GridDataColumns[c].endsWith("_Key")&&t){s+="\x11",s+="<Row>",s+="<AccountsXML></AccountsXML>",s+='<Transactions DocSeqNo="'+(a+1)+'" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="'+this.ScreenObject.GridData[a].LineNarration.toString(),o="",s+=o.length>0?'" DocDetailsID="'+o:'" DocDetailsID="',s+=i.toString()+'" ></Transactions>',s+='<Numeric Query="',s+='" ></Numeric>',r="",s+='<Alpha Query="',s+=" dcAlpha3='"+new Date(this.ScreenObject.GridDataColumns[c].Replace("_Key","")).ToString("dd/MMM/yyyy")+"',";let e="";if(this.ScreenObject.CustomTab.Pages.length>0)for(let t=0;t<this.ScreenObject.CustomTab.Pages.length;t++)for(let s=0;s<this.ScreenObject.CustomTab.Pages[t].Fields.length;s++)this.ScreenObject.CustomTab.Pages[t].Fields[s]instanceof b.c&&this.ScreenObject.CustomTab.Pages[t].Fields[s].DBColumnName.startsWith("dcAlpha")&&"DCALPHA3"!=this.ScreenObject.CustomTab.Pages[t].Fields[s].DBColumnName.toUpperCase()&&(e=this.ScreenObject.GetcontrolValue(this.ScreenObject.CustomTab.Pages[t].Fields[s]),r+=" "+this.ScreenObject.CustomTab.Pages[t].Fields[s].DBColumnName+"='"+n.e.EncodeXML(e)+"',");for(let t=0;t<this.ScreenObject.ColumnSource.length;t++)this.ScreenObject.ColumnSource[t].DisplayMember.startsWith("dcAlpha")&&"DCALPHA3"!=this.ScreenObject.ColumnSource[t].DisplayMember.toUpperCase()&&("DCALPHA5"==this.ScreenObject.ColumnSource[t].DisplayMember.toUpperCase()||"DCALPHA6"==this.ScreenObject.ColumnSource[t].DisplayMember.toUpperCase()?r+=" "+this.ScreenObject.ColumnSource[t].DisplayMember+"='"+new Date(this.ScreenObject.GridDataColumns[c].Replace("_Key","")).ToString("dd/MMM/yyyy")+"',":null!=this.ScreenObject.GridData[a][this.ScreenObject.ColumnSource[t].DisplayMember]&&null!=this.ScreenObject.GridData[a][this.ScreenObject.ColumnSource[t].DisplayMember]&&(r+=" "+this.ScreenObject.ColumnSource[t].DisplayMember+"='"+n.e.EncodeXML(this.ScreenObject.GridData[a][this.ScreenObject.ColumnSource[t].DisplayMember].toString())+"',"));if(s+=r,s+='" ></Alpha>',r="",s+='<CostCenters Query="',s+=" dcCCNID51="+this.ScreenObject.GridData[a].dcCCNID51_Key.toString()+",",s+=" dcCCNID73="+this.ScreenObject.GridData[a][c].toString()+",",this.ScreenObject.CustomTab.Pages.length>0)for(let t=0;t<this.ScreenObject.CustomTab.Pages.length;t++)for(let e=0;e<this.ScreenObject.CustomTab.Pages[t].Fields.length;e++)this.ScreenObject.CustomTab.Pages[t].Fields[e].DBColumnName.startsWith("dcCCNID")&&(r+=" "+this.ScreenObject.CustomTab.Pages[t].Fields[e].DBColumnName+"="+this.ScreenObject.CustomTab.Pages[t].Fields[e].SelectedValue+",");for(let t=0;t<this.ScreenObject.ColumnSource.length;t++)!this.ScreenObject.ColumnSource[t].DisplayMember.startsWith("dcCCNID")||this.ScreenObject.ColumnSource[t].DisplayMember.startsWith("dcCCNID51")||this.ScreenObject.ColumnSource[t].DisplayMember.startsWith("dcCCNID73")||n.e.IsEmpty(this.ScreenObject.GridData[a][this.ScreenObject.ColumnSource[t].DisplayMember+"_Key"])||(r+=" "+this.ScreenObject.ColumnSource[t].DisplayMember+"='"+this.ScreenObject.GridData[a][this.ScreenObject.ColumnSource[t].DisplayMember+"_Key"].toString()+"',");s+=r,s+='" ></CostCenters>',s+="<EXTRAXML></EXTRAXML>",s+="</Row>"}}}else{let t=!0,l="",c=e.split(",");if(null!=c&&c.length>0)for(let e=0;e<c.length;e++)null!=c[e]&&null!=c[e]&&""!=c[e]&&(l="-2"==c[e]?"dcCCNID51_Key":"dcCCNID"+(parseInt(c[e])-5e4)+"_Key",n.e.IsEmpty(this.ScreenObject.GridData[a][l])&&(t=!1));if(t){s+="\x11",s+="<Row>",s+="<AccountsXML></AccountsXML>",s+='<Transactions DocSeqNo="'+(a+1)+'" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="'+n.e.String(this.ScreenObject.GridData[a].LineNarration),o="",s+=o.length>0?'" DocDetailsID="'+o:'" DocDetailsID="',s+=i.toString()+'" ></Transactions>',s+='<Numeric Query="',s+='" ></Numeric>',r="",s+='<Alpha Query="';let e="";if(this.ScreenObject.CustomTab.Pages.length>0)for(let t=0;t<this.ScreenObject.CustomTab.Pages.length;t++)for(let s=0;s<this.ScreenObject.CustomTab.Pages[t].Fields.length;s++)this.ScreenObject.CustomTab.Pages[t].Fields[s]instanceof b.c&&this.ScreenObject.CustomTab.Pages[t].Fields[s].DBColumnName.startsWith("dcAlpha")&&"DCALPHA1"!=this.ScreenObject.CustomTab.Pages[t].Fields[s].DBColumnName.toUpperCase()&&"DCALPHA2"!=this.ScreenObject.CustomTab.Pages[t].Fields[s].DBColumnName.toUpperCase()&&"DCALPHA3"!=this.ScreenObject.CustomTab.Pages[t].Fields[s].DBColumnName.toUpperCase()&&(e=this.ScreenObject.GetcontrolValue(this.ScreenObject.CustomTab.Pages[t].Fields[s]),r+=" "+this.ScreenObject.CustomTab.Pages[t].Fields[s].DBColumnName+"='"+n.e.EncodeXML(e)+"',");for(let t=0;t<this.ScreenObject.ColumnSource.length;t++)this.ScreenObject.ColumnSource[t].DisplayMember.startsWith("dcAlpha")&&"DCALPHA1"!=this.ScreenObject.ColumnSource[t].DisplayMember.toUpperCase()&&"DCALPHA2"!=this.ScreenObject.ColumnSource[t].DisplayMember.toUpperCase()&&"DCALPHA3"!=this.ScreenObject.ColumnSource[t].DisplayMember.toUpperCase()&&null!=this.ScreenObject.GridData[a][this.ScreenObject.ColumnSource[t].DisplayMember]&&null!=this.ScreenObject.GridData[a][this.ScreenObject.ColumnSource[t].DisplayMember]&&(r+="DATE"==this.ScreenObject.ColumnSource[t].DataType?" "+this.ScreenObject.ColumnSource[t].DisplayMember+"='"+new Date(this.ScreenObject.GridData[a][this.ScreenObject.ColumnSource[t].DisplayMember+"_Key"].toString()).ToString("dd/MMM/yyyy")+"',":" "+this.ScreenObject.ColumnSource[t].DisplayMember+"='"+n.e.EncodeXML(this.ScreenObject.GridData[a][this.ScreenObject.ColumnSource[t].DisplayMember].toString())+"',");if(s+=r,s+='" ></Alpha>',r="",s+='<CostCenters Query="',s+=" dcCCNID51="+this.ScreenObject.GridData[a].dcCCNID51_Key.toString()+",",s+=" dcCCNID73="+this.ScreenObject.GridData[a].dcCCNID73_Key.toString()+",",this.ScreenObject.CustomTab.Pages.length>0)for(let t=0;t<this.ScreenObject.CustomTab.Pages.length;t++)for(let e=0;e<this.ScreenObject.CustomTab.Pages[t].Fields.length;e++)this.ScreenObject.CustomTab.Pages[t].Fields[e]instanceof m.b&&this.ScreenObject.CustomTab.Pages[t].Fields[e].DBColumnName.startsWith("dcCCNID")&&"DCCCNID51"!=this.ScreenObject.CustomTab.Pages[t].Fields[e].DBColumnName.toUpperCase()&&"DCCCNID73"!=this.ScreenObject.CustomTab.Pages[t].Fields[e].DBColumnName.toUpperCase()&&(r+=" "+this.ScreenObject.CustomTab.Pages[t].Fields[e].DBColumnName+"="+this.ScreenObject.CustomTab.Pages[t].Fields[e].SelectedValue+",");for(let t=0;t<this.ScreenObject.ColumnSource.length;t++)!this.ScreenObject.ColumnSource[t].DisplayMember.startsWith("dcCCNID")||this.ScreenObject.ColumnSource[t].DisplayMember.startsWith("dcCCNID51")||this.ScreenObject.ColumnSource[t].DisplayMember.startsWith("dcCCNID73")||n.e.IsEmpty(this.ScreenObject.GridData[a][this.ScreenObject.ColumnSource[t].DisplayMember+"_Key"])||(r+=" "+this.ScreenObject.ColumnSource[t].DisplayMember+"='"+this.ScreenObject.GridData[a][this.ScreenObject.ColumnSource[t].DisplayMember+"_Key"].toString()+"',");s+=r,s+='" ></CostCenters>',s+="<EXTRAXML></EXTRAXML>",s+="</Row>"}}return s.toString()}LoadEditShiftAssign(e){let t="";a.a.SessionManager.Preferences.ContainsKey("ShiftAssignBasedOn")&&(t=a.a.SessionManager.Preferences.ShiftAssignBasedOn);let s=t.split(","),i="",r="DayWise";var o=this.ScreenObject._TextFields.find(e=>"dcalpha4"==e.DBColumnName.toLowerCase());if(o instanceof D.e&&(r=o.SelectedValue),o.IsReadOnly=!0,"DayWise"==r){this.FillDates_Click();let t,r=e.Tables[3].ToTable(!0,["dcAlpha3"]),o=0,l=null,c=0;for(let h=0;h<e.Tables[1].length;h+=r.length,c++){if(this.ScreenObject.GridData.length-1<=c&&this.ScreenObject.GridDataObj.addEmptyRow(),null!=s&&null!=s&&s.length>0){for(let t=0;t<s.length;t++)null!=s[t]&&""!=s[t]&&(i="-2"==s[t]?"dcCCNID51_Key":"dcCCNID"+(parseInt(s[t])-5e4)+"_Key",this.ScreenObject.GridData[c][i]=e.Tables[1][h][i.Replace("_Key","")]);this.FillDefaultProd(this.ScreenObject.GridData[c],i.Replace("_Key","")),this.Celleditend(this.ScreenObject.GridData[c],i.Replace("_Key",""),this.ScreenObject.GridDataColumns.indexOf(i.Replace("_Key","")))}for(let s=0;s<r.length;s++)o=parseInt(e.Tables[1][h+s].InvDocDetailsID),t=r[s].dcAlpha3.toString().Replace("/","-"),this.GetDgvColumnIndex(t),l=e.Tables[3].filter(e=>e.InvDocDetailsID==o),null!=l&&l.length>0&&new Date(t)==new Date(l[0].dcAlpha3)&&(l=e.Tables[1].filter(e=>e.InvDocDetailsID==o),null!=l&&l.length>0&&(this.ScreenObject.GridData[c][t+"_Key"]=l[0].dcCCNID73,this.ScreenObject.GridDataObj.updateRow(this.ScreenObject.GridData[c])));for(let t=0;t<this.ScreenObject.ColumnSource.length;t++)this.ScreenObject.ColumnSource[t].DisplayMember.startsWith("dcAlpha")?"dcalpha5"!=this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase()&&"dcalpha6"!=this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase()&&("DATE"==this.ScreenObject.ColumnSource[t].DataType.toUpperCase()?n.e.IsEmpty(e.Tables[3][h][this.ScreenObject.ColumnSource[t].DisplayMember])||(this.ScreenObject.GridData[c][this.ScreenObject.ColumnSource[t].DisplayMember]=new Date(e.Tables[3][h][this.ScreenObject.ColumnSource[t].DisplayMember]).ToString(a.a.SessionManager.Preferences["Date Format"]),this.ScreenObject.GridData[c][this.ScreenObject.ColumnSource[t].DisplayMember+"_key"]=new Date(e.Tables[3][h][this.ScreenObject.ColumnSource[t].DisplayMember])):this.ScreenObject.GridData[c][this.ScreenObject.ColumnSource[t].DisplayMember]=e.Tables[3][h][this.ScreenObject.ColumnSource[t].DisplayMember]):!this.ScreenObject.ColumnSource[t].DisplayMember.startsWith("dcCCNID")||this.ScreenObject.ColumnSource[t].DisplayMember.startsWith("dcCCNID51")||this.ScreenObject.ColumnSource[t].DisplayMember.startsWith("dcCCNID73")?"LINENARRATION"==this.ScreenObject.ColumnSource[t].DisplayMember.toUpperCase()&&e.Columns[0].Contains(this.ScreenObject.ColumnSource[t].DisplayMember)&&(this.ScreenObject.GridData[c][this.ScreenObject.ColumnSource[t].DisplayMember]=e.Tables[0][h][this.ScreenObject.ColumnSource[t].DisplayMember]):this.ScreenObject.GridData[c][this.ScreenObject.ColumnSource[t].DisplayMember+"_Key"]=e.Tables[1][h][this.ScreenObject.ColumnSource[t].DisplayMember]}}else{this.ConsolidateLeaveMonth();for(let t=0;t<e.Tables[1].length;t++){if(this.ScreenObject.GridData.length-1<=t&&this.ScreenObject.GridDataObj.addEmptyRow(),null!=s&&null!=s&&s.length>0)for(let a=0;a<s.length;a++)null!=s[a]&&""!=s[a]&&(i="-2"==s[a]?"dcCCNID51_Key":"dcCCNID"+(parseInt(s[a])-5e4)+"_Key",this.ScreenObject.GridData[t][i]=e.Tables[1][t][i.Replace("_Key","")]);for(let s=0;s<this.ScreenObject.ColumnSource.length;s++)if(this.ScreenObject.ColumnSource[s].DisplayMember.startsWith("dcAlpha"))"DATE"==this.ScreenObject.ColumnSource[s].DataType.toUpperCase()?n.e.IsEmpty(e.Tables[3][t][this.ScreenObject.ColumnSource[s].DisplayMember])||(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[s].DisplayMember]=new Date(e.Tables[3][t][this.ScreenObject.ColumnSource[s].DisplayMember]).ToString(a.a.SessionManager.Preferences["Date Format"]),this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[s].DisplayMember+"_key"]=new Date(e.Tables[3][t][this.ScreenObject.ColumnSource[s].DisplayMember])):this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[s].DisplayMember]=e.Tables[3][t][this.ScreenObject.ColumnSource[s].DisplayMember];else if(this.ScreenObject.ColumnSource[s].DisplayMember.startsWith("dcCCNID")&&!this.ScreenObject.ColumnSource[s].DisplayMember.startsWith("dcCCNID51"))this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[s].DisplayMember+"_Key"]=e.Tables[1][t][this.ScreenObject.ColumnSource[s].DisplayMember];else if("LINENARRATION"==this.ScreenObject.ColumnSource[s].DisplayMember.toUpperCase())e.Columns[0].Contains(this.ScreenObject.ColumnSource[s].DisplayMember)&&(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[s].DisplayMember]=e.Tables[0][t][this.ScreenObject.ColumnSource[s].DisplayMember]);else if("PRODUCTCODE"==this.ScreenObject.ColumnSource[s].DisplayMember.toUpperCase()){this.ScreenObject.GridData[t].ProductID_key=this.ScreenObject.ColumnSource[s].DefaultValue;let e=this.ScreenObject.ColumnSource[s].DefaultValueText.split("\x11");this.ScreenObject.GridDataColumns.Contains("ProductCode")&&e.length>1&&(this.ScreenObject.GridData[t].ProductCode=e[1]),this.ScreenObject.GridDataColumns.Contains("ProductName")&&e.length>0&&(this.ScreenObject.GridData[t].ProductName=e[0])}}}this.ScreenObject.UpdateSequence(),this.RefreshGrid=!0}GetDgvColumnIndex(e){let t;for(t=0;t<this.ScreenObject.ColumnSource.length;t++)if(this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase()==e.toLowerCase())return t;return t}LoadShiftAssignRotationData(){if(null!=this.dtShiftAssRot&&this.dtShiftAssRot.length>0){let e=this.ScreenObject._TextFields.find(e=>"dcalpha4"==e.DBColumnName.toLowerCase());null!=e&&(e.SelectedValue="PeriodWise",e.IsReadOnly=!0);let t="";a.a.SessionManager.Preferences.ContainsKey("ShiftAssignBasedOn")&&(t=a.a.SessionManager.Preferences.ShiftAssignBasedOn);let s=t.split(","),i="";if(null!=s&&null!=s&&s.length>0)for(let a=0;a<s.length;a++)null!=s[a]&&""!=s[a]&&(i="-2"==s[a]?"dcCCNID51_Key":"dcCCNID"+(parseInt(s[a])-5e4)+"_Key");let r=null;if(this.ScreenObject.GridDataColumns.Contains(i)){this.ScreenObject.GridData.Clear();let e=this.ScreenObject.Data.Tables[0].filter(e=>"ProductID"==e.SysColumnName);for(let t=0;t<this.dtShiftAssRot.length;t++)r=this.ScreenObject.GridDataObj.NewRow(),e.length>0&&""!=n.e.String(e[0].UserDefaultValue)&&(r.ProductID_Key=e[0].UserDefaultValue),r[i]=this.dtShiftAssRot[t].Employee_Key,r[i.Replace("_Key","")]=this.dtShiftAssRot[t].Employee,r.dcAlpha5_Key=new Date(this.dtShiftAssRot[t].From),r.dcAlpha5=new Date(this.dtShiftAssRot[t].From).ToString(a.a.SessionManager.Preferences["Date Format"]),r.dcAlpha6_Key=new Date(this.dtShiftAssRot[t].To),r.dcAlpha6=new Date(this.dtShiftAssRot[t].To).ToString(a.a.SessionManager.Preferences["Date Format"]),r.dcCCNID73_Key=this.dtShiftAssRot[t].Shift_Key,r.dcCCNID73=this.dtShiftAssRot[t].Shift,this.ScreenObject.GridDataObj.addRow(r);this.RefreshGrid=!this.RefreshGrid}}}CalculateTotalTimeAvailed(e,t,s){t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),t.getHours(),t.getMinutes(),t.getSeconds()),s=new Date(e.getFullYear(),e.getMonth(),e.getDate(),s.getHours(),s.getMinutes(),s.getSeconds());let i=t.Subtract(s);return i.Hours<0&&(i=i.add(nt.TimeSpan.FromDays(1))),i.Hours.PrefixZero(2)+"."+i.Minutes.PrefixZero(2)}CalculateTotalTime(e,t,s,i){if(t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),t.getHours(),t.getMinutes(),t.getSeconds()),(i=new Date(s.getFullYear(),s.getMonth(),s.getDate(),i.getHours(),i.getMinutes(),i.getSeconds()))<t)return"00.00";let a=i.Subtract(t);return a.Hours<0&&(a=a.add(nt.TimeSpan.FromDays(1))),(24*a.Days+a.Hours).PrefixZero(2)+"."+a.Minutes.PrefixZero(2)}ApplyVacationFrom(e){if(this.dsVacationdays=null,e.Date&&e.SelectedDateChanged.IsSubscribed){let r=0,l=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());if((null!=l&&null!=l&&l instanceof m.b&&l.SelectedValue>0||null!=l&&l instanceof C.a&&l.SelectedValue>0)&&(r=l.SelectedValue),r>0&&(this.dsData=this.ScreenObject.GetVacationDetails(r,new Date(this.ScreenObject.DocDate.Date),new Date(e.Date)),this.dsData.Tables.length>0)){if(this.ScreenObject._TextFields.forEach(e=>{e.DBColumnName.startsWith("dcalpha")&&parseInt(e.DBColumnName.Replace("dcalpha",""))<=50&&(e instanceof u.d&&e.DBColumnName.toLowerCase().Contains("dcalpha")&&(e.Text=""),e instanceof u.d&&"dcalpha14"==e.DBColumnName.toLowerCase()&&(e.IsReadOnly=!0))}),this.DisplayMessage=this.ApplyVacationValidationMsg(this.dsData),""!=this.DisplayMessage.toString())return void(this.MessageVisibility=!0);if(this.dsData.Tables[3].length>0){let e=[];this.ScreenObject.GridDataObj.Clear();var t=this.ScreenObject.ColumnSource.find(e=>"dcAlpha21"==e.ValueBinding);if(null!=t&&null!=t){for(let t=0;t<=this.dsData.Tables[3].length-1;t++)e.push(D.d.ComboBoxItems_2(this.dsData.Tables[3][t].NAME.toString(),this.dsData.Tables[3][t].NODEID.toString()));t.DisplayMember="Name",t.ValueMember="Value",t.ComboData=e}}if(this.dsData.Tables[4].length>0){let e=[],t=null,i=null,a=0;var s=this.ScreenObject.ColumnSource.find(e=>"dcAlpha20"==e.ValueBinding);if(null!=s&&null!=s){for(let t=0;t<=this.dsData.Tables[4].length-1;t++)e.push(D.d.ComboBoxItems_2(this.dsData.Tables[4][t].NAME.toString(),this.dsData.Tables[4][t].NODEID.toString()));s.DisplayMember="Name",s.ValueMember="Value",s.ComboData=e}t=null;let r=this.ScreenObject.Data.Tables[0].filter(e=>"ProductID"==e.SysColumnName);for(let s=0;s<this.dsData.Tables[4].length;s++)t=this.ScreenObject.GridDataObj.NewRow(),r.length>0&&""!=n.e.String(r[0].UserDefaultValue)&&(t.ProductID_Key=r[0].UserDefaultValue),t.dcAlpha20=this.dsData.Tables[4][s].NODEID,i=this.dsData.Tables[4].filter(e=>e.NODEID==parseInt(t.dcAlpha20)),t.dcAlpha21=i[0].PARENTID,this.ScreenObject.GridDataObj.insertRowAt(t,a),a++}if(this.dsData.Tables[5].length>0){let e=(new Date).OnlyDate(),t=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase());null!=t&&null!=t&&t instanceof d.c&&!n.e.IsEmpty(t.Date)&&(e=t.Date);let s=a.a.common.GetDataTable("PAY083",r.toString()+"~"+e.ToString("dd/MMM/yyyy")),l=null,c=0;null!=s&&s.length>0&&new Date(s[0].REJOINDATE)<=new Date(s[0].TODATE)&&(l=this.ScreenObject.GetVacationDays(new Date(s[0].FROMDATE),new Date(s[0].REJOINDATE).AddDays(-1),r,parseInt(s[0].DOCID),parseFloat(s[0].OpeningBalance),0),null!=l&&l.Tables.length>0&&(c=parseFloat(l.Tables[1][0].REMAININGDAYS))),null!=(i=this.ScreenObject._TextFields.find(e=>"dcalpha22"==e.DBColumnName.toLowerCase()))&&i instanceof u.d&&(i.Text=parseFloat(this.dsData.Tables[5][0].OPVACATIONDAYS)<0&&a.a.SessionManager.Preferences.ContainsKey("DonotshownegitiveOPvacationdays")&&Object(o.j)("True"==a.a.SessionManager.Preferences.DonotshownegitiveOPvacationdays)?(0).ToTime("00.00"):c>0?c.ToString("0.00"):parseFloat(this.dsData.Tables[5][0].OPVACATIONDAYS).ToTime("00.00")),null!=(i=this.ScreenObject._TextFields.find(e=>"dcalpha5"==e.DBColumnName.toLowerCase()))&&i instanceof u.d&&(i.Text=parseFloat(this.dsData.Tables[5][0].OPVACATIONSALARY).ToTime("00.00")),null!=(i=this.ScreenObject._TextFields.find(e=>"dcalpha4"==e.DBColumnName.toLowerCase()))&&i instanceof u.d&&(i.IsReadOnly=!0)}}var i;(i=this.ScreenObject._TextFields.find(e=>"dcalpha3"==e.DBColumnName.toLowerCase()))instanceof d.c&&i.Date&&this.ApplyVacation(i)}}ApplyVacation(e){if(this.dsVacationdays=null,e.Date&&e.SelectedDateChanged.IsSubscribed){let e=new Date,s=new Date,i=0,o=0,l=0,c=0;var t=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase());if(t instanceof d.c&&t.Date&&(e=t.Date),((t=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase()))instanceof m.b&&t.SelectedValue>0||t instanceof C.a&&t.SelectedValue>0)&&(i=t.SelectedValue),0==i)return;if((t=this.ScreenObject._TextFields.find(e=>"dcalpha3"==e.DBColumnName.toLowerCase()))instanceof d.c&&t.Date&&(s=t.Date,i>0&&this.FillEarningsDeductions(i,new Date(s))),new Date(e)>new Date(s))return this.DisplayMessage="Todate should be greater than Fromdate",void(this.MessageVisibility=!0);(t=this.ScreenObject._TextFields.find(e=>"dcalpha22"==e.DBColumnName.toLowerCase()))instanceof u.d&&!n.e.IsEmpty(t.Text)&&(o=parseFloat(t.Text)),(t=this.ScreenObject._TextFields.find(e=>"dcalpha5"==e.DBColumnName.toLowerCase()))instanceof u.d&&!n.e.IsEmpty(t.Text)&&(c=parseFloat(t.Text));let h=0;this.dsVacationdays=this.ScreenObject.GetVacationDays(e,s,i,this.DocID,o,0);let D,S=a.a.common.GetDataTable("PAY074",i.toString()),b="";if(null!=S&&S.length>0&&(b=S[0].ConsiderVacationdayforExcessVacationDays+""),b.length>0&&"No"==b&&null!=this.dsVacationdays&&this.dsVacationdays.Tables.length>0&&this.dsVacationdays.Tables[1].length>0&&this.dsVacationdays.Columns[1].Contains("ExcessDays")&&parseFloat(this.dsVacationdays.Tables[1][0].ExcessDays)>0){let t,a=s.AddDays(-1),n=parseFloat(this.dsVacationdays.Tables[1][0].VacationDays),r=0;for(;e<=a;){if(t=this.ScreenObject.GetVacationDays(e,a,i,this.DocID,o,0),null!=t&&t.Tables.length>0&&t.Tables[1].length>0&&0==parseFloat(t.Tables[1][0].ExcessDays)){r=parseFloat(t.Tables[1][0].VacationDays);break}a=a.AddDays(-1)}h=n-r}if(this.dsVacationdays=this.ScreenObject.GetVacationDays(e,s,i,this.DocID,o,h),this.dsVacationdays.Tables.length>0){if(this.dsVacationdays.Tables[0].length>0&&!n.e.IsEmpty(this.dsVacationdays.Tables[0][0].ProbationPeriodMessage))return this.DisplayMessage=this.dsVacationdays.Tables[0][0].ProbationPeriodMessage.toString(),void(this.MessageVisibility=!0);if(!(this.dsVacationdays.Tables[1].length>0&&n.e.IsEmpty(this.dsVacationdays.Tables[1][0].VacationDaysMessage)))return this.dsVacationdays.Tables[1].length>0&&(this.DisplayMessage=this.dsVacationdays.Tables[1][0].VacationDaysMessage.toString()),void(this.MessageVisibility=!0);(t=this.ScreenObject._TextFields.find(e=>"dcalpha4"==e.DBColumnName.toLowerCase()))instanceof u.d&&(t.Text=parseFloat(this.dsVacationdays.Tables[1][0].VacationDays).ToTime("00.00")),(t=this.ScreenObject._TextFields.find(e=>"dcalpha8"==e.DBColumnName.toLowerCase()))instanceof u.d&&(t.Text=parseFloat(this.dsVacationdays.Tables[1][0].AppliedDays).ToTime("00.00")),(t=this.ScreenObject._TextFields.find(e=>"dcalpha9"==e.DBColumnName.toLowerCase()))instanceof u.d&&(t.Text=parseFloat(this.dsVacationdays.Tables[1][0].ApprovedDays).ToTime("00.00")),(t=this.ScreenObject._TextFields.find(e=>"dcalpha10"==e.DBColumnName.toLowerCase()))instanceof u.d&&(parseFloat(this.dsVacationdays.Tables[1][0].PaidDays)<0?(t.Text="0.00",l=0):(t.Text=parseFloat(this.dsVacationdays.Tables[1][0].PaidDays).ToTime("0.00"),l=parseFloat(this.dsVacationdays.Tables[1][0].PaidDays))),(t=this.ScreenObject._TextFields.find(e=>"dcalpha7"==e.DBColumnName.toLowerCase()))instanceof u.d&&(t.Text=parseFloat(this.dsVacationdays.Tables[1][0].CreditedDays).ToTime("00.00")),(t=this.ScreenObject._TextFields.find(e=>"dcalpha11"==e.DBColumnName.toLowerCase()))instanceof u.d&&(t.Text=parseFloat(this.dsVacationdays.Tables[1][0].ExcessDays).ToTime("00.00")),(t=this.ScreenObject._TextFields.find(e=>"dcalpha12"==e.DBColumnName.toLowerCase()))instanceof u.d&&(t.Text=parseFloat(this.dsVacationdays.Tables[1][0].RemainingDays).ToTime("00.00")),null!=(t=this.ScreenObject._TextFields.find(e=>"dcalpha26"==e.DBColumnName.toLowerCase()))&&t instanceof u.d&&(t.Text=parseFloat(this.dsVacationdays.Tables[1][0].FSEncashDays).ToTime("00.00"))}if(this.LEDict=new r.a,this.oVac=new ct.b,this.oVac.iDocID=this.ScreenObject.DocID,this.oVac.GetVacationAmountDetails(this.dsVacationdays),this.oVac.arrLstVacAmountFields.length>0){let e=null,s=0;e=null;let i=0,r=0,o=0;this.ScreenObject.GridDataObj.Clear();let h=this.ScreenObject.Data.Tables[0].filter(e=>"ProductID"==e.SysColumnName);for(let t=0;t<this.oVac.arrLstVacAmountFields.length;t++)e=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridDataObj.insertRowAt(e,s),s++,h.length>0&&!n.e.IsEmpty(h[0].UserDefaultValue)&&(e.ProductID_Key=h[0].UserDefaultValue),e.dcAlpha20=this.oVac.arrLstVacAmountFields[t].ComponentID,e.dcAlpha21=this.oVac.arrLstVacAmountFields[t].TypeId,2==parseFloat(this.oVac.arrLstVacAmountFields[t].TypeId)?parseFloat(this.oVac.arrLstVacAmountFields[t].Percentage)>0?(D=new O.c(this.oVac.arrLstVacAmountFields[t].ComponentName,""),this.LEDict.push(this.oVac.arrLstVacAmountFields[t].ComponentName,D),this.LEDict[this.oVac.arrLstVacAmountFields[t].ComponentName].setFieldValue(this.oVac.arrLstVacAmountFields[t].PercActualAmount),e.dcNum1=l*parseFloat(a.a.eval.EvaluateExpression(this.oVac.arrLstVacAmountFields[t].Formula,this.LEDict))):e.dcNum1=parseFloat(this.oVac.arrLstVacAmountFields[t].Percentage)<0?parseFloat(this.oVac.arrLstVacAmountFields[t].ActualAmount):0:e.dcNum1=parseFloat(this.oVac.arrLstVacAmountFields[t].ActualAmount),e.dcAlpha23=parseFloat(this.oVac.arrLstVacAmountFields[t].Percentage),null!=e.dcAlpha21&&(2==parseFloat(e.dcAlpha21)?(null==e.dcNum1||isNaN(e.dcNum1)||(r+=parseFloat(e.dcNum1)),null==e.dcNum2||isNaN(e.dcNum2)||(r+=parseFloat(e.dcNum2)),null==e.dcNum3||isNaN(e.dcNum3)||(r+=parseFloat(e.dcNum3))):2!=parseFloat(e.dcAlpha21)&&null!=e.dcNum1&&(o+=parseFloat(e.dcNum1))),this.CalculateTotals(e,!1);i=r+c-o,(t=this.ScreenObject._TextFields.find(e=>"dcalpha6"==e.DBColumnName.toLowerCase()))instanceof u.d&&(t.Text=i.ToString("N"+a.a.SessionManager.Preferences.DecimalsinAmount)),this.GridNetTotal=parseFloat(i.ToString("N"+a.a.SessionManager.Preferences.DecimalsinAmount)),this.RefreshNetAmount()}if(this.ShowVacationCreditDaysDetail(i,h),!this.isVacContractedit&&a.a.SessionManager.Preferences.ContainsKey("VacationBasedOnContract")&&parseInt(a.a.SessionManager.Preferences.VacationBasedOnContract)>0){let e=a.a.common.GetDataTable("PAY089",i.toString()+"~"+parseInt(a.a.SessionManager.Preferences.VacationBasedOnContract));null!=e&&e.length>0&&this.ApplyVacationContract()}}}ApplyVacationIsEncash(e){this.dsVacationdays=null;let t=new Date,s=new Date,i=0,l=0,c=0,h=0,S=0,b=0,p="",y="";var g=this.ScreenObject._TextFields.find(e=>"dcalpha16"==e.DBColumnName.toLowerCase());if(g instanceof D.e&&!n.e.IsEmpty(g.SelectedValue)){if(null==g.SelectionChangedCommand&&!a.a.SessionManager.IsWebApplication)return;p=g.SelectedValue.toString()}var I=this.ScreenObject._TextFields.find(e=>"dcalpha14"==e.DBColumnName.toLowerCase());if((g=this.ScreenObject._TextFields.find(e=>"dcalpha13"==e.DBColumnName.toLowerCase()))instanceof D.e&&!n.e.IsEmpty(g.SelectedValue)){if(null==g.SelectionChangedCommand&&n.e.IsEmpty(I.Text)&&"Yes"!=p&&!a.a.SessionManager.IsWebApplication)return;y=g.SelectedValue.toString()}if(((g=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase()))instanceof m.b&&g.SelectedValue>0||g instanceof C.a&&g.SelectedValue>0)&&(i=g.SelectedValue),0==i)return;if((g=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase()))instanceof d.c&&g.Date&&(t=g.Date),(g=this.ScreenObject._TextFields.find(e=>"dcalpha3"==e.DBColumnName.toLowerCase()))instanceof d.c&&g.Date&&(s=g.Date),this.CalculateTotals(null,!1),(g=this.ScreenObject._TextFields.find(e=>"dcalpha15"==e.DBColumnName.toLowerCase()))instanceof D.e&&(g.SelectedValue="No",g.IsReadOnly=!0),(g=this.ScreenObject._TextFields.find(e=>"dcalpha22"==e.DBColumnName.toLowerCase()))instanceof u.d&&!n.e.IsEmpty(g.Text)&&(l=parseFloat(g.Text)),(g=this.ScreenObject._TextFields.find(e=>"dcalpha5"==e.DBColumnName.toLowerCase()))instanceof u.d&&!n.e.IsEmpty(g.Text)&&(b=parseFloat(g.Text)),(g=this.ScreenObject._TextFields.find(e=>"dcalpha10"==e.DBColumnName.toLowerCase()))instanceof u.d&&!n.e.IsEmpty(g.Text)&&(c=parseFloat(g.Text)),(g=this.ScreenObject._TextFields.find(e=>"dcalpha7"==e.DBColumnName.toLowerCase()))instanceof u.d&&!n.e.IsEmpty(g.Text)&&(h=parseFloat(g.Text)),"Yes"==p||"Yes"==y){if("Yes"==p?((g=this.ScreenObject._TextFields.find(e=>"dcalpha13"==e.DBColumnName.toLowerCase()))instanceof D.e&&(g.SelectedValue="Yes",g.IsReadOnly=!0),(g=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase()))instanceof d.c&&g.Date&&(t=g.Date,g.IsReadOnly=!0),(g=this.ScreenObject._TextFields.find(e=>"dcalpha3"==e.DBColumnName.toLowerCase()))instanceof d.c&&g.Date&&(g.Date=t,s=g.Date,g.IsReadOnly=!0),(g=this.ScreenObject._TextFields.find(e=>"dcalpha4"==e.DBColumnName.toLowerCase()))instanceof u.d&&(g.Text=(0).toString()),(g=this.ScreenObject._TextFields.find(e=>"dcalpha8"==e.DBColumnName.toLowerCase()))instanceof u.d&&(g.Text=(0).toString()),(g=this.ScreenObject._TextFields.find(e=>"dcalpha9"==e.DBColumnName.toLowerCase()))instanceof u.d&&(g.Text=(0).toString()),(g=this.ScreenObject._TextFields.find(e=>"dcalpha10"==e.DBColumnName.toLowerCase()))instanceof u.d&&(g.Text=(0).toString(),c=parseFloat(g.Text.toString())),(g=this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase()))instanceof d.c&&0==c&&(g.Date=t.AddDays(1))):"No"==p&&"Yes"==y&&null==e&&!n.e.IsEmpty(I.Text)&&parseFloat(I.Text.toString())>0&&(g=this.ScreenObject._TextFields.find(e=>"dcalpha13"==e.DBColumnName.toLowerCase()))instanceof D.e&&(g.SelectedValue="No",g.IsReadOnly=!1,I.IsReadOnly=!0,I.Text="0",y="No"),"Yes"==y&&null==e&&(I.Text="0",I.IsReadOnly=!1),(g=this.ScreenObject._TextFields.find(e=>"dcalpha14"==e.DBColumnName.toLowerCase()))instanceof u.d){var f=this.ScreenObject._TextFields.find(e=>"dcalpha12"==e.DBColumnName.toLowerCase());if(null!=e&&"lostfoucs"==e.toString()){if(g instanceof u.d&&!n.e.IsEmpty(g.Text)&&(S=parseFloat(g.Text)),f instanceof u.d&&!n.e.IsEmpty(f.Text)&&(f.Text=(h+l-c-S).toString()),f instanceof u.d){if(parseFloat((h+l-c).toString())<parseFloat(g.Text))return this.DisplayMessage="Encash days should be less than or equal to remaining days",void(this.MessageVisibility=!0);this.DisplayMessage="",this.MessageVisibility=!1,S=parseFloat(g.Text)}}else"No"==p&&null==e?(g.Text="0",S=0,f.Text=(l+h-c).toString()):(g.IsReadOnly=!1,g.Text=(l+h).toString(),S=l+h,f.Text="0")}}else I.IsReadOnly=!0,I.Text="0",(g=this.ScreenObject._TextFields.find(e=>"dcalpha22"==e.DBColumnName.toLowerCase()))instanceof u.d&&!n.e.IsEmpty(g.Text)&&(l=parseFloat(g.Text)),(g=this.ScreenObject._TextFields.find(e=>"dcalpha7"==e.DBColumnName.toLowerCase()))instanceof u.d&&!n.e.IsEmpty(g.Text)&&(h=parseFloat(g.Text)),(g=this.ScreenObject._TextFields.find(e=>"dcalpha10"==e.DBColumnName.toLowerCase()))instanceof u.d&&!n.e.IsEmpty(g.Text)&&(c=parseFloat(g.Text)),(f=this.ScreenObject._TextFields.find(e=>"dcalpha12"==e.DBColumnName.toLowerCase()))instanceof u.d&&!n.e.IsEmpty(f.Text)&&(f.Text=(h+l-c).toString());let T;this.LEDict=new r.a,this.dsVacationdays=this.ScreenObject.GetVacationDays(t,s,i,this.DocID,l,0),this.oVac=new ct.b,this.oVac.iDocID=this.ScreenObject.DocID,this.oVac.GetVacationAmountDetails(this.dsVacationdays);let j=a.a.common.GetDataTable("PAY075",i.toString()+"~"+t.ToString("dd/MMM/yyyy")),P=!1,A="";if(null!=j&&j.length>0&&(A=j[0].EncashFormula.toString()),a.a.SessionManager.Preferences.ContainsKey("CalcVacEncAmtBsdOnCustPayEncFormula")&&(P=Object(o.j)(a.a.SessionManager.Preferences.CalcVacEncAmtBsdOnCustPayEncFormula)),null!=this.oVac&&this.oVac.arrLstVacAmountFields.length>0){let e=null,s=0;e=null;let r=0,o=0,l=0,h=0;this.ScreenObject.GridDataObj.Clear();let d=this.ScreenObject.Data.Tables[0].filter(e=>"ProductID"==e.SysColumnName);for(let u=0;u<this.oVac.arrLstVacAmountFields.length;u++){if(e=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridDataObj.insertRowAt(e,s),s++,d.length>0&&!n.e.IsEmpty(d[0].UserDefaultValue)&&(e.ProductID_Key=d[0].UserDefaultValue),e.dcAlpha20=this.oVac.arrLstVacAmountFields[u].ComponentID,e.dcAlpha21=this.oVac.arrLstVacAmountFields[u].TypeId,2==parseFloat(this.oVac.arrLstVacAmountFields[u].TypeId))if(parseFloat(this.oVac.arrLstVacAmountFields[u].Percentage)>0){T=new O.c(this.oVac.arrLstVacAmountFields[u].ComponentName.toString(),""),this.LEDict.push(this.oVac.arrLstVacAmountFields[u].ComponentName.toString(),T),this.LEDict[this.oVac.arrLstVacAmountFields[u].ComponentName.toString()].setFieldValue(this.oVac.arrLstVacAmountFields[u].PercActualAmount.toString());let s=this.LEDict;"EMPLOYEE_BASIC"==this.oVac.arrLstVacAmountFields[u].ComponentName.toString()&&"Yes"==p?(e.dcNum1=0,P?(this.ScreenObject.GridData[0].dcNum2=0,A=A.Replace("EncashDays",S.toString()),A.length>0&&(this.ScreenObject.GridData[0].dcNum2=this.ReturnFormulaValue(i,t,A)),h=parseFloat(this.ScreenObject.GridData[0].dcNum2)):e.dcNum2=S*parseFloat(a.a.eval.EvaluateExpression(this.oVac.arrLstVacAmountFields[u].Formula.toString(),s))):(P?(this.ScreenObject.GridData[0].dcNum2=0,A=A.Replace("EncashDays",S.toString()),A.length>0&&(this.ScreenObject.GridData[0].dcNum2=this.ReturnFormulaValue(i,t,A)),h=parseFloat(this.ScreenObject.GridData[0].dcNum2)):e.dcNum2=S*parseFloat(a.a.eval.EvaluateExpression(this.oVac.arrLstVacAmountFields[u].Formula.toString(),s)),e.dcNum1=c*parseFloat(a.a.eval.EvaluateExpression(this.oVac.arrLstVacAmountFields[u].Formula.toString(),s)))}else parseFloat(this.oVac.arrLstVacAmountFields[u].Percentage)<0&&(e.dcNum2=0,e.dcNum1=parseFloat(this.oVac.arrLstVacAmountFields[u].ActualAmount));e.dcAlpha23=parseFloat(this.oVac.arrLstVacAmountFields[u].Percentage),null!=e.dcAlpha21&&(2==parseFloat(e.dcAlpha21)?(null!=e.dcNum1&&(o+=parseFloat(e.dcNum1)),null!=e.dcNum2&&(o+=parseFloat(e.dcNum2)),null!=e.dcNum3&&(o+=parseFloat(e.dcNum3))):2!=parseFloat(e.dcAlpha21)&&null!=e.dcNum1&&(l+=parseFloat(e.dcNum1))),this.CalculateTotals(e,!1)}o+=h,r=o+b-l,(g=this.ScreenObject._TextFields.find(e=>"dcalpha6"==e.DBColumnName.toLowerCase()))instanceof u.d&&(g.Text=r.ToString("N"+a.a.SessionManager.Preferences.DecimalsinAmount)),this.GridNetTotal=parseFloat(r.ToString("N"+a.a.SessionManager.Preferences.DecimalsinAmount)),this.RefreshNetAmount()}}ReturnFormulaValue(e,t,s){let i="0",a=new ct.b;a.sEmpSeqNo=e.toString();let r={PayrollMonth:a.PayrollMonth,PayrollMonthStart:a.PayrollMonthStart,PayrollMonthEnd:a.PayrollMonthEnd};n.e.SetPayrollDate(t.Date(),r),a.PayrollMonth=r.PayrollMonth,a.PayrollMonthStart=r.PayrollMonthStart,a.PayrollMonthEnd=r.PayrollMonthEnd,a.arrLstCPFields[6].Clear();let o=new ct.a;return o.ComponentName="RetFormulaValue",o.SNo=0,o.Formula=s,a.arrLstCPFields[6].push(o),a.Intialize(),a.ExecuteAllFormulas(),i=a.arrLstCPFields[6][0].dEarned,i}ApplyVacationIsTextEncash(e){this.ApplyVacationIsEncash("lostfoucs")}ApplyVacationExcessdays(e){let t="";var s=this.ScreenObject._TextFields.find(e=>"dcalpha15"==e.DBColumnName.toLowerCase());if(s instanceof D.e&&!n.e.IsEmpty(s.SelectedValue)){if(null==s.SelectionChangedCommand&&!a.a.SessionManager.IsWebApplication)return;t=s.SelectedValue.toString()}if("Yes"==t){this.CalculateTotals(null,!1);let e,t=new Date,i=new Date,o=0,l=0,c=0,h=0,S=0;if((s=this.ScreenObject._TextFields.find(e=>"dcalpha16"==e.DBColumnName.toLowerCase()))instanceof D.e&&(s.SelectedValue="No",s.IsReadOnly=!0),(s=this.ScreenObject._TextFields.find(e=>"dcalpha14"==e.DBColumnName.toLowerCase()))instanceof u.d&&(s.Text="",s.IsReadOnly=!0),(s=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase()))instanceof d.c&&!n.e.IsEmpty(s.Date)&&(t=s.Date),(s=this.ScreenObject._TextFields.find(e=>"dcalpha3"==e.DBColumnName.toLowerCase()))instanceof d.c&&!n.e.IsEmpty(s.Date)&&(i=s.Date),((s=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase()))instanceof m.b&&s.SelectedValue>0||s instanceof C.a&&s.SelectedValue>0)&&(o=s.SelectedValue),0==o)return;if((s=this.ScreenObject._TextFields.find(e=>"dcalpha22"==e.DBColumnName.toLowerCase()))instanceof u.d&&!n.e.IsEmpty(s.Text)&&(l=parseFloat(s.Text)),(s=this.ScreenObject._TextFields.find(e=>"dcalpha5"==e.DBColumnName.toLowerCase()))instanceof u.d&&!n.e.IsEmpty(s.Text)&&(S=parseFloat(s.Text)),(s=this.ScreenObject._TextFields.find(e=>"dcalpha10"==e.DBColumnName.toLowerCase()))instanceof u.d&&(c=parseFloat(s.Text)),(s=this.ScreenObject._TextFields.find(e=>"dcalpha11"==e.DBColumnName.toLowerCase()))instanceof u.d&&(h=parseFloat(s.Text)),h<=0)return this.DisplayMessage="No Excess days available",void(this.MessageVisibility=!0);if(this.LEDict=new r.a,this.oVac.arrLstVacAmountFields.length>0){let t=null,i=0;t=null;let r=0,o=0,l=0;this.ScreenObject.GridDataObj.Clear();let d=this.ScreenObject.Data.Tables[0].filter(e=>"ProductID"==e.SysColumnName);for(let s=0;s<this.oVac.arrLstVacAmountFields.length;s++){if(t=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridDataObj.insertRowAt(t,i),i++,d.length>0&&!n.e.IsEmpty(d[0].UserDefaultValue)&&(t.ProductID_Key=d[0].UserDefaultValue),t.dcAlpha20=this.oVac.arrLstVacAmountFields[s].ComponentID,t.dcAlpha21=this.oVac.arrLstVacAmountFields[s].TypeId,2==parseFloat(this.oVac.arrLstVacAmountFields[s].TypeId)&&parseFloat(this.oVac.arrLstVacAmountFields[s].Percentage)>0){e=new O.c(this.oVac.arrLstVacAmountFields[s].ComponentName.toString(),""),this.LEDict.push(this.oVac.arrLstVacAmountFields[s].ComponentName.toString(),e),this.LEDict[this.oVac.arrLstVacAmountFields[s].ComponentName.toString()].setFieldValue(this.oVac.arrLstVacAmountFields[s].PercActualAmount.toString());let i=this.LEDict;"EMPLOYEE_BASIC"==this.oVac.arrLstVacAmountFields[s].ComponentName.toString()?(t.dcNum2=0,t.dcNum1=c*parseFloat(a.a.eval.EvaluateExpression(this.oVac.arrLstVacAmountFields[s].Formula.toString(),i)),t.dcNum3=h*parseFloat(a.a.eval.EvaluateExpression(this.oVac.arrLstVacAmountFields[s].Formula.toString(),i)),t.dcAlpha23=-4):(t.dcNum2=0,t.dcNum3=h*parseFloat(a.a.eval.EvaluateExpression(this.oVac.arrLstVacAmountFields[s].Formula.toString(),i)),t.dcNum1=c*parseFloat(a.a.eval.EvaluateExpression(this.oVac.arrLstVacAmountFields[s].Formula.toString(),i)))}else 2==parseFloat(this.oVac.arrLstVacAmountFields[s].TypeId)&&parseFloat(this.oVac.arrLstVacAmountFields[s].Percentage)<0&&(t.dcNum2=0,t.dcNum1=parseFloat(this.oVac.arrLstVacAmountFields[s].ActualAmount));t.dcAlpha23=parseFloat(this.oVac.arrLstVacAmountFields[s].Percentage),null!=t.dcAlpha21&&(2==parseFloat(t.dcAlpha21)?(null!=t.dcNum1&&(o+=parseFloat(t.dcNum1)),null!=t.dcNum2&&(o+=parseFloat(t.dcNum2)),null!=t.dcNum3&&(o+=parseFloat(t.dcNum3))):2!=parseFloat(t.dcAlpha21)&&null!=t.dcNum1&&(l+=parseFloat(t.dcNum1))),this.CalculateTotals(t,!1)}r=o+S-l,(s=this.ScreenObject._TextFields.find(e=>"dcalpha6"==e.DBColumnName.toLowerCase()))instanceof u.d&&(s.Text=r.ToString("N"+a.a.SessionManager.Preferences.DecimalsinAmount)),this.GridNetTotal=parseFloat(r.ToString("N"+a.a.SessionManager.Preferences.DecimalsinAmount)),this.RefreshNetAmount()}}}ApplyVacationContract(){let e="1",t=new Date,s=new Date,i=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());null!=i&&(i instanceof m.b||i instanceof C.a)&&(e=i.SelectedValue.toString());let a=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase());if(null!=a&&a instanceof d.c&&!n.e.IsEmpty(a.Date)&&(t=a.Date),a=this.ScreenObject._TextFields.find(e=>"dcalpha3"==e.DBColumnName.toLowerCase()),null!=a&&a instanceof d.c&&!n.e.IsEmpty(a.Date)&&(s=a.Date),a=this.ScreenObject._TextFields.find(e=>"dcalpha22"==e.DBColumnName.toLowerCase()),null!=a&&a instanceof u.d&&!n.e.IsEmpty(a.Text)&&parseFloat(a.Text),a=this.ScreenObject._TextFields.find(e=>"dcalpha5"==e.DBColumnName.toLowerCase()),null!=a&&a instanceof u.d&&!n.e.IsEmpty(a.Text)&&parseFloat(a.Text),parseInt(e)>1&&(this.PrevVacFrom!=t||this.PrevVacTo!=s)){let e=0;a=this.ScreenObject._TextFields.find(e=>"dcalpha4"==e.DBColumnName.toLowerCase()),null!=a&&a instanceof u.d&&(e=parseFloat(a.Text)),this.PrevVacFrom=t,this.PrevVacTo=s}}GetAllEmployees(e,t,s){try{let r=null,o=null,l="",c="",h=0,u={value:this._Ddate};this.ScreenObject.OnDocPrefixChanged(this.ScreenObject.Prefix,0,0,u,!1),this._Ddate=u.value;var i=this.ScreenObject._TextFields.find(e=>"dcalpha14"==e.DBColumnName.toLowerCase());if(i instanceof D.e&&!n.e.IsEmpty(i.SelectedValue)&&(l="TreeView"==i.SelectedValue.toString()?"lft":i.SelectedValue.toString()),this.clear(1),this._Ddate=e,this.QuickInfoVisibility=!1,this.DQuickInfoVisibility=!1,this.ScreenObject.DocID=0,this.StatusID=0,this.WorkFlowDocLevel=0,this.ScreenObject.VoucherNo="",this.ScreenObject.guid="",this.DocStatus="["+a.a.GetResource("Doc_Draft")+"]",this.ScreenObject.DocPrefix.TextBox.Text=parseInt(this.ScreenObject.DocPrefix.TextBox.Text).toString(),this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase()).Date=e,r=s.toString().toLowerCase().Contains("nodeid")?this.ScreenObject.GetAllEmployeesList(e,t,0,0,s):this.ScreenObject.GetAllEmployeesList(e,t,0,0,""),r.Tables.length>0&&r.Tables[0].length>0){let t=r.Tables[0];t.sort((e,t)=>e[l]-t[l]),i instanceof D.e&&null!=i.SelectedItem&&(i.SelectedItem.Name=l),o=null,this.ScreenObject.GridDataObj.Clear();let s=this.ScreenObject.Data.Tables[0].filter(e=>"ProductID"==e.SysColumnName);this.dsAllEmployeeData=null;for(let e=0;e<t.length;e++)c.length>0&&(c+=","),c+=t[e].EMPNODE.toString();this.dsAllEmployeeData=a.a.common.GetDataSet("PAY091",c),this.IsGetAllEmployees=!0,null==this.objPayDayCheck&&(this.objPayDayCheck=new at.a(this.ScreenObject));for(let i=0;i<t.length;i++)o=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridDataObj.insertRowAt(o,h),h++,s.length>0&&!n.e.IsEmpty(s[0].UserDefaultValue)&&(o.ProductID_Key=s[0].UserDefaultValue),this.ScreenObject.GridDataColumns.Contains("dcCCNID51Code")&&(o.dcCCNID51Code=t[i].EMPCODE),o.dcCCNID51_Key=t[i].EMPNODE,o.dcCCNID51=t[i].EMPNAME,o.dcAlpha10=1,o.dcAlpha11=1,o.dcAlpha13=1,this.FillDefaultProd(o,"dcCCNID51"),this.Celleditend(o,"dcCCNID51",0),this.ScreenObject.GridDataColumns.Contains("dcAlpha2")&&this.ScreenObject.GridDataColumns.Contains("dcAlpha3")&&this.FillGeneralTimings(t[i].EMPNODE.toString(),new Date(e).ToString("dd/MMM/yyyy"),o),this.ScreenObject.GridDataColumns.Contains("dcAlpha4")&&this.DistributeTotalHours(t[i].EMPNODE.toString(),new Date(e).ToString("dd/MMM/yyyy"),o,""),this.IsDocValid=!1,this.ScreenObject.GridDataObj.updateRow(o),this.CalculateTotals(o,!1);this.IsGetAllEmployees=!1,this.dsAllEmployeeData=null}}catch(r){this.DisplayMessage="Load Error",Logger.ErrorLog("AddEditDocumentViewModel:: GetAllEmployees"+r.stack)}}FillDates_Click(){if(67==this.ScreenObject.DocumentType){let t="1";var e=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());if(e&&(e instanceof m.b||e instanceof C.a)&&(t=e.SelectedValue.toString()),parseInt(t)<=1)return this.DisplayMessage="Select any Employee",void(this.MessageVisibility=!0);if(this.ScreenObject.ColumnSource.find(e=>"dcalpha1"==e.DisplayMember.toLowerCase())){this.ScreenObject.GridDataObj.Clear();let e,t=a.a.SessionManager.PayrollMonthStart,s=a.a.SessionManager.PayrollMonthEnd,i=0;for(;t<=s;)this.ScreenObject.GridData.length-1<=i&&(e=this.ScreenObject.GridDataObj.NewRow(),e.DocSeqNo=this.ScreenObject.GridData.length+1,e.DocDetailsID=0,this.ScreenObject.GridDataObj.addRow(e)),this.ScreenObject.GridData[i].dcAlpha1=t.ToString(a.a.SessionManager.Preferences["Date Format"]),this.ScreenObject.GridData[i].dcAlpha1_Key=t,this.FillDefaultProd(this.ScreenObject.GridData[i],"dcAlpha1"),this.Celleditend(this.ScreenObject.GridData[i],"dcAlpha1",0),t=t.AddDays(1),i+=1}}else if(92==this.ScreenObject.DocumentType){let e,s;if(e=this.ScreenObject.CustomTab.Pages[0].Fields.find(e=>e instanceof d.c&&"dcAlpha1"==e.DBColumnName),s=this.ScreenObject.CustomTab.Pages[0].Fields.find(e=>e instanceof d.c&&"dcAlpha2"==e.DBColumnName),!e.Date||!s.Date)return this.DisplayMessage="Please select dates",void(this.MessageVisibility=!0);if(e.Date>s.Date)return this.DisplayMessage="Please select ToDate greater than FromDate",void(this.MessageVisibility=!0);var t=this.GetButton("Fill Dates");this.ScreenObject.DocID>0?(null!=t&&(t.Visible=!1),e.Enable=s.Enable=!1):(null!=t&&(t.Visible=!0),e.Enable=s.Enable=!0);for(let t=this.ScreenObject.ColumnSource.length-1;t>=0;t--)null!=this.ScreenObject.ColumnSource[t].DrRefColName&&""!=this.ScreenObject.ColumnSource[t].DrRefColName&&"Date"==this.ScreenObject.ColumnSource[t].DrRefColName&&(this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.ColumnSource[t].DisplayMember)&&this.ScreenObject.GridDataColumns.Remove(this.ScreenObject.ColumnSource[t].DisplayMember),this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.ColumnSource[t].DisplayMember+"_Key")&&this.ScreenObject.GridDataColumns.Remove(this.ScreenObject.ColumnSource[t].DisplayMember+"_Key"),this.ScreenObject.ColumnSource.RemoveAt(t));let i=-1,n=[];for(let t=0;t<this.ScreenObject.ColumnSource.length;t++)"LineNarration"==this.ScreenObject.ColumnSource[t].DisplayMember&&(i=t,this.ScreenObject.ColumnSource[t].Width=150),null!=this.ScreenObject.ColumnSource[t].DrRefColName&&""!=this.ScreenObject.ColumnSource[t].DrRefColName||"Date"==this.ScreenObject.ColumnSource[t].DrRefColName||n.push(this.ScreenObject.ColumnSource[t]);i<0&&(i=n.length),this.iDgColFrom=i,this.iDtColFrom=this.ScreenObject.GridDataColumns.length;let r=e.Date,o=null,l=a.a.common.GetDataTable("PAY001","");for(;r<=s.Date;)o=new y.a,o.Header=r.ToString("dd'-'MMM'-'yyyy")+"\n ("+r.DayOfWeek.toString()+")",o.DisplayMember=r.ToString("dd'-'MMM'-'yyyy"),o.ID=l[0].CostCenterColID.toString(),o.DrRefColName="Date",o.DataType="LISTBOX",o.CostCenterID=50073,o.Mandatory=!0,o.TypeID=1,o.Width=90,this.ScreenObject.GridDataColumns.Contains(o.DisplayMember)||this.ScreenObject.GridDataColumns.push(o.DisplayMember),this.ScreenObject.GridDataColumns.Contains(o.DisplayMember+"_Key")||this.ScreenObject.GridDataColumns.push(o.DisplayMember+"_Key"),n.Insert(i,o),r=r.AddDays(1),i++;this.iDgColUpto=i,this.iDtColUpto=this.ScreenObject.GridDataColumns.length-1,this.ScreenObject.ColumnSource=n,this.ScreenObject.GridDataObj.RefreshColumns()}}FillGeneralTimings_Click(){let e="",t="1";var s=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());if(s&&(s instanceof m.b||s instanceof C.a)&&(t=s.SelectedValue.toString()),parseInt(t)<=1)this.DisplayMessage="Select any Employee";else if(this.ScreenObject.ColumnSource.find(e=>"dcalpha1"==e.DisplayMember.toLowerCase()))for(let i=0;i<this.ScreenObject.GridData.length;i++)n.e.IsEmpty(this.ScreenObject.GridData[i].dcAlpha1)||n.e.IsEmpty(this.ScreenObject.GridData[i].dcAlpha1_Key)||(e=new Date(this.ScreenObject.GridData[i].dcAlpha1_Key).ToString("dd/MMM/yyyy"),this.ScreenObject.GridDataColumns.Contains("dcAlpha2")&&this.ScreenObject.GridDataColumns.Contains("dcAlpha3")&&this.FillGeneralTimings(t,e,this.ScreenObject.GridData[i]),this.ScreenObject.GridDataColumns.Contains("dcAlpha4")&&this.DistributeTotalHours(t,e,this.ScreenObject.GridData[i],""))}GetPreviousDay(e){try{let s=new Date;this.strValidationMessage="";let i="",r=0,o={value:this._Ddate};if(this.ScreenObject.OnDocPrefixChanged(this.ScreenObject.Prefix,0,0,o,!1),this._Ddate=o.value,this.ScreenObject.Clear(o,1),this._Ddate=o.value,null==this.ScreenObject.DocPrefix.ComboBox.SelectedItem||n.e.IsEmpty(this.ScreenObject.DocPrefix.ComboBox.SelectedItem.Aliasname)||(r=parseInt(this.ScreenObject.DocPrefix.ComboBox.SelectedItem.Aliasname)),parseInt(this.ScreenObject.DocPrefix.TextBox.Text)>1){let o=(parseInt(this.ScreenObject.DocPrefix.TextBox.Text)-1).toString();for(;o.length<r;)o="0"+o;if(this.ScreenObject.DocPrefix.TextBox.Text=o,s=e.AddDays(this.intRecCount>0?-(this.intRecCount+1):-1),this.intRecCount=this.intRecCount+1,this.dsData=this.ScreenObject.GetEmployeePayrollInfo(0,4,s,0),!(null!=this.dsData&&this.dsData.Tables[0].length>0))return this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase()).Date=e,this.DisplayMessage="No Records exist with date '"+s.ToString(a.a.SessionManager.Preferences["Date Format"])+"'",void(this.MessageVisibility=!0);{let s={value:this._Ddate};this.ScreenObject.OnDocPrefixChanged("lostFocus",0,parseInt(this.dsData.Tables[0][0][0]),s,!0),this._Ddate=s.value,this._Ddate=Date.Today(),this.QuickInfoVisibility=!1,this.DQuickInfoVisibility=!1,this.ScreenObject.DocID=0,this.StatusID=0,this.WorkFlowDocLevel=0,this.WfID=0,this.WFDocLevelList.Clear(),this.ScreenObject.VoucherNo="",this.ScreenObject.guid="",this.DocStatus="["+a.a.GetResource("Doc_Draft")+"]",this.ScreenObject.DocPrefix.TextBox.Text=(parseInt(o)+1).toString(),this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase()).Date=e;for(let a=0;a<this.ScreenObject.GridData.length;a++)if(parseInt(this.ScreenObject.GridData[a].DocDetailsID)>0){this.IsDocValid=!1,this.ScreenObject.GridData[a].DocDetailsID=0,this.ScreenObject.GridData[a].dcAlpha2_Key=new Date(e.ToString("dd/MMM/yyyy")+" "+this.ScreenObject.GridData[a].dcAlpha2).ToString("dd/MMM/yyyy HH:mm"),this.ScreenObject.GridData[a].dcAlpha3_Key=new Date(this.ScreenObject.GridData[a].dcAlpha3_Key).ToString("dd/MMM/yyyy")==e.ToString("dd/MMM/yyyy")?new Date(e.AddDays(1).ToString("dd/MMM/yyyy")+" "+this.ScreenObject.GridData[a].dcAlpha3).ToString("dd/MMM/yyyy HH:mm"):new Date(e.ToString("dd/MMM/yyyy")+" "+this.ScreenObject.GridData[a].dcAlpha3).ToString("dd/MMM/yyyy HH:mm");var t=this.ScreenObject.ColumnSource.find(e=>"dcCCNID51"==e.DisplayMember);if(t&&!n.e.IsEmpty(t.Shortcut)&&"lostfocus"==t.Shortcut.toLowerCase()&&this.ValidateData_Column(t,this.ScreenObject.GridData[a],!0)&&this.ScreenObject.GetExternalFuncData(t.Mode,t.SPName,t.IPParams,t.OPParams,this.ScreenObject.GridData[a]),null!=this.ScreenObject.GridData[a].dcAlpha3_Key&&null!=this.ScreenObject.GridData[a].dcAlpha2_Key){let e=new Date(this.ScreenObject.GridData[a].dcAlpha3_Key).Subtract(new Date(this.ScreenObject.GridData[a].dcAlpha2_Key));i=e.Hours+"."+e.Minutes,this.ScreenObject.GridData[a].dcNum1=parseFloat(i)}(t=this.ScreenObject.ColumnSource.find(e=>"dcNum1"==e.DisplayMember))&&!n.e.IsEmpty(t.Shortcut)&&"lostfocus"==t.Shortcut.toLowerCase()&&this.ValidateData_Column(t,this.ScreenObject.GridData[a],!0)&&this.ScreenObject.GetExternalFuncData(t.Mode,t.SPName,t.IPParams,t.OPParams,this.ScreenObject.GridData[a])}}}}catch(s){this.DisplayMessage="Load Error",Logger.ErrorLog("AddEditDocumentViewModel:: GetPreviousDay"+s.stack)}}CheckEmployeeShift(e,t,s){if(!this.ScreenObject.GridDataColumns.Contains("dcCCNID73"))return;let i="",n="",r="";a.a.SessionManager.Preferences.ContainsKey("ShiftAssignBasedOn")&&(r=a.a.SessionManager.Preferences.ShiftAssignBasedOn);let o=null;if(this.IsGetAllEmployees){if(null!=this.dsAllEmployeeData&&this.dsAllEmployeeData.Tables.length>2)if("-2"==r){i=" dcCCNID51 IN("+e+",1) ",n="dcCCNID51";let s=this.dsAllEmployeeData.Tables[2];s=s.filter(s=>s.FromDate<=new Date(t).ToString("dd/MMM/yyyy")&&s.ToDate>=new Date(t).ToString("dd/MMM/yyyy")&&s.dcCCNID51==e),s=s.sort((e,t)=>e.FromDate>t.FromDate||e.FromDate==t.FromDate&&e[n]>t[n]?1:-1),s=s.sort((e,t)=>t.DocID-e.DocID),null!=s&&s.length>0&&(o=s)}else{let s=[];s.push(t),s.push(" AND EmpSeqNo="+e),s.push(0),s.push(a.a.SessionManager.RoleID),s.push(a.a.SessionManager.UserID),s.push(a.a.SessionManager.LanguageID);let l=a.a.common.GetDataSet_SP(s,"spPAY_GetEmpMasterCCDetails").Tables[0];if(null!=l&&l.length>0){let e="",s=r.split(",");if(null!=s&&s.length>0){let a=this.dsAllEmployeeData.Tables[2];for(let r=0;r<s.length;r++)null!=s[r]&&""!=s[r]&&(e="-2"==s[r]?"CCNID51":"CCNID"+(parseInt(s[r])-5e4),n.length>0&&(n+=","),n+="dc"+e,i.length>0&&(i+=" AND "),i+="dc"+e+"="+l[0][e],a=a.filter(s=>s.FromDate<=new Date(t).ToString("dd/MMM/yyyy")&&s.ToDate>=new Date(t).ToString("dd/MMM/yyyy")&&s["dc"+e]==l[0][e]));a=a.sort((e,t)=>e.FromDate-t.FromDate),null!=a&&a.length>0&&(o=a)}}}}else o=a.a.common.GetDataSet3("PAY005",e,t).Tables[0];null!=o&&o.length>0?(s.dcCCNID73_Key=o[0].dcCCNID73,s.dcCCNID73=o[0].Name):(s.dcCCNID73_Key=1,s.dcCCNID73=""),this.ScreenObject.GridDataObj.updateRow(s),this.RefreshGrid=!this.RefreshGrid,99!=this.ScreenObject.DocumentType&&97!=this.ScreenObject.DocumentType&&this.Celleditend(s,"dcCCNID73",0)}FillGeneralTimings(e,t,s){if(a.a.SessionManager.Preferences.ContainsKey("GeneralTimingsBasedOn")&&""!=a.a.SessionManager.Preferences.GeneralTimingsBasedOn){let r=a.a.SessionManager.Preferences.GeneralTimingsBasedOn.split(",");if(null!=r&&r.length>0){let o="",l="";for(let e=0;e<r.length;e++)null!=r[e]&&""!=r[e]&&(l="dcCCNID"+(parseInt(r[e])-5e4),n.e.IsEmpty(s[l+"_Key"])?o+=" AND "+l+"=1":o+=" AND ( "+l+"="+s[l+"_Key"].toString()+" OR "+l+"=1 )");if(o.length>0){let n=[];n.push(t),n.push(e),n.push(o),n.push(a.a.SessionManager.UserID),n.push(a.a.SessionManager.LanguageID);let r=a.a.common.GetDataSet_SP(n,"spPAY_ExtGetTimings").Tables[0];if(r.length>0){let a=new Date(t),n=new Date(t).AddDays(1);var i=this.ScreenObject.ColumnSource.find(e=>"dcalpha2"==e.DisplayMember.toLowerCase());i&&(s[i.DisplayMember]=new Date(r[0].STARTTIME).ToString("HH:mm"),s[i.DisplayMember+"_Key"]=new Date(a).AddHours(new Date(r[0].STARTTIME).getHours()).AddMinutes(new Date(r[0].STARTTIME).getMinutes()).ToString("dd/MMM/yyyy HH:mm")),(i=this.ScreenObject.ColumnSource.find(e=>"dcalpha3"==e.DisplayMember.toLowerCase()))&&(s[i.DisplayMember]=new Date(r[0].ENDTIME).ToString("HH:mm"),s[i.DisplayMember+"_Key"]=new Date(r[0].ENDTIME)<new Date(r[0].STARTTIME)?new Date(n).AddHours(new Date(r[0].ENDTIME).getHours()).AddMinutes(new Date(r[0].ENDTIME).getMinutes()).ToString("dd/MMM/yyyy HH:mm"):new Date(a).AddHours(new Date(r[0].ENDTIME).getHours()).AddMinutes(new Date(r[0].ENDTIME).getMinutes()).ToString("dd/MMM/yyyy HH:mm")),s.dcAlpha5=r[0].VALIDDAY,this.DistributeTotalHours(e,t,s,""),this.ScreenObject.GridDataObj.updateRow(s)}}}}}DistributeTotalHours(e,t,s,i){try{let h=!1;null==this.dtEData&&(this.dtEData=a.a.common.GetDataTable("PAY002",""));let u=this.dtEData.filter(t=>t.NodeID==e);null!=u&&u.length>0&&(n.e.IsEmpty(u[0].IsAllowOT)||(h="Yes"==u[0].IsAllowOT.toString()));let d=0,D=1,S=0,m=0,b=0,C=0,p=0;if(n.e.IsEmpty(s.dcAlpha3_Key)||n.e.IsEmpty(s.dcAlpha2_Key))s.dcNum1="0.00";else{let e=new Date(s.dcAlpha3_Key).Subtract(new Date(s.dcAlpha2_Key));s.dcNum1=e.Hours>0||e.Minutes>0?1==e.Minutes.toString().length?e.Hours+".0"+e.Minutes:e.Hours+"."+e.Minutes:"0.00"}var r=this.ScreenObject.ColumnSource.find(e=>"FLOAT"==e.DataType.toUpperCase()&&"dcnum1"==e.DisplayMember.toLowerCase());if(null==r||n.e.IsEmpty(s[r.DisplayMember])||(d=parseFloat(s[r.DisplayMember])),a.a.SessionManager.Preferences.ContainsKey("DonotallowAttendancebasedon")&&""!=a.a.SessionManager.Preferences.DonotallowAttendancebasedon&&a.a.SessionManager.Preferences.ContainsKey("DonotallowAttendancebasedonid")&&""!=a.a.SessionManager.Preferences.DonotallowAttendancebasedonid){var o=this.ScreenObject.ColumnSource.find(e=>"LISTBOX"==e.DataType.toUpperCase()&&e.ValueMember.toLowerCase()=="dcccnid"+(parseInt(a.a.SessionManager.Preferences.DonotallowAttendancebasedon)-5e4)+"_key");null==o||null==o||n.e.IsEmpty(s[o.ValueMember])||s[o.ValueMember].toString()!=a.a.SessionManager.Preferences.DonotallowAttendancebasedonid||(this.ScreenObject.GridDataColumns.Contains("dcAlpha2")&&(s.dcAlpha2=new Date(t).ToString("HH:mm"),s.dcAlpha2_Key=new Date(t).ToString("dd/MMM/yyyy HH:mm")),this.ScreenObject.GridDataColumns.Contains("dcAlpha3")&&(s.dcAlpha3=new Date(t).ToString("HH:mm"),s.dcAlpha3_Key=new Date(t).ToString("dd/MMM/yyyy HH:mm")),d=0,this.ScreenObject.GridDataColumns.Contains("dcNum1")&&(s.dcNum1="0.00"))}null==this.objPayDayCheck&&(this.objPayDayCheck=new at.a(this.ScreenObject)),this.objPayDayCheck.CheckIsHolidayDate(e,t,s,this.IsGetAllEmployees,this.dsAllEmployeeData);let y=this.GetHoursDefChart(t,s);if(null!=y&&y.length>0){let r,o=null,u=null,g=n.e.GetEmptyDate(),O=n.e.GetEmptyDate(),I=n.e.GetEmptyDate(),f=n.e.GetEmptyDate(),T=n.e.GetEmptyDate(),j=n.e.GetEmptyDate(),P=d.ToTime("00.00").split("."),A=n.e.GetEmptyDate().AddHours(parseFloat(P[0])).AddMinutes(parseFloat(P[1]));S=m=b=C=p=0;var l=this.ScreenObject.ColumnSource.find(e=>"dcccnid73"==e.DisplayMember.toLowerCase());if(null==l||null==l||n.e.IsEmpty(s.dcCCNID73_Key)||(D=parseInt(s.dcCCNID73_Key),null!=this.dtPayShifts&&this.dtPayShifts.length>0&&(r=this.dtPayShifts.filter(e=>e.NodeID==D),null!=r&&r.length>0&&(S=parseInt(r[0].MinOT1),m=parseInt(r[0].MinOT2),b=parseInt(r[0].MinOT3),C=parseInt(r[0].MinOT4),p=parseInt(r[0].MinOT5)))),"WeeklyOff"==s.PayrollType.toString()||"Holiday"==s.PayrollType.toString())if("WeeklyOff"==s.PayrollType.toString()){if((c=this.ScreenObject.ColumnSource.find(e=>"FLOAT"==e.DataType.toUpperCase()&&"dcnum2"==e.DisplayMember.toLowerCase()))&&this.ScreenObject.GridDataColumns.Contains("dcNum2")&&(n.e.IsEmpty(s.dcNum2)||-1==parseFloat(s.dcNum2)||(s.dcNum2=(0).ToTime("00.00"))),null!=(c=this.ScreenObject.ColumnSource.find(e=>"FLOAT"==e.DataType.toUpperCase()&&"dcnum4"==e.DisplayMember.toLowerCase()))&&null!=c&&this.ScreenObject.GridDataColumns.Contains("dcNum4"))if("dcnum4"!=i.toLowerCase()&&"dcnum5"!=i.toLowerCase()&&"dcnum7"!=i.toLowerCase()&&"dcnum9"!=i.toLowerCase()&&"dcnum11"!=i.toLowerCase()&&"dcnum13"!=i.toLowerCase()||!a.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=a.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)if("dcnum4"==i.toLowerCase()&&a.a.SessionManager.Preferences.ContainsKey("BreakHoursImpactToOTS")&&"True"==a.a.SessionManager.Preferences.BreakHoursImpactToOTS){if(A.getHours()>0||A.getMinutes()>0){let e=parseFloat(s.dcNum4).ToTime("00.00").split(".");g=new Date(1,1,1,0).AddHours(parseFloat(e[0])).AddMinutes(parseFloat(e[1])),s.dcNum4=g.ToString("HH.mm"),A=A.AddHours(-g.getHours()).AddMinutes(-g.getMinutes())}}else s.dcNum4=(0).ToTime("00.00"),(A.getHours()>0||A.getMinutes()>0)&&(g=this.GetMaxAvilableHrs(e,t,y,"dcNum4"),A<g&&(g=A),s.dcNum4=g.ToString("HH.mm"),A=A.AddHours(-g.getHours()).AddMinutes(-g.getMinutes()));else{let e=parseFloat(s.dcNum4).ToTime("00.00").split(".");if(g=new Date(1,1,1,0).AddHours(parseFloat(e[0])).AddMinutes(parseFloat(e[1])),a.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==a.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)T=T.AddHours(g.getHours()).AddMinutes(g.getMinutes());else{let e=parseFloat(s.dcNum1).ToTime("00.00").split(".");O=(new Date).AddHours(parseFloat(e[0])).AddMinutes(parseFloat(e[1])),j=O.AddHours(-g.getHours()).AddMinutes(-g.getMinutes())}}if(h){if(null!=(c=this.ScreenObject.ColumnSource.find(e=>"FLOAT"==e.DataType.toUpperCase()&&"dcnum5"==e.DisplayMember.toLowerCase()))&&null!=c&&this.ScreenObject.GridDataColumns.Contains("dcNum5"))if("dcnum4"!=i.toLowerCase()&&"dcnum5"!=i.toLowerCase()&&"dcnum7"!=i.toLowerCase()&&"dcnum9"!=i.toLowerCase()&&"dcnum11"!=i.toLowerCase()&&"dcnum13"!=i.toLowerCase()||!a.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=a.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)s.dcNum5=(0).ToTime("00.00"),60*A.getHours()+A.getMinutes()>=S&&(A.getHours()>0||A.getMinutes()>0)&&(o=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName==c.DisplayMember),null!=o&&o.length>0&&(u=this.dtOTTypes.filter(e=>e.CostCenterColID==o[0].LinkData.toString()),null!=u&&u.length>0&&("PayWeeklyOffOT"!=u[0].SysColumnName.toString()&&"PayHolidayOT"!=u[0].SysColumnName.toString()&&"PayEveryDayOT"!=u[0].SysColumnName.toString()||(g=this.GetMaxAvilableHrs(e,t,y,"dcNum5"),A<g&&(g=A),s.dcNum5=g.ToString("HH.mm"),A=A.AddHours(-g.getHours()).AddMinutes(-g.getMinutes())))));else{let i=parseFloat(s.dcNum5).ToTime("00.00").split(".");if(g=new Date(1,1,1,0).AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1])),a.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==a.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)T=T.AddHours(g.getHours()).AddMinutes(g.getMinutes());else if(o=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName=="'"+c.DisplayMember+"'"),null!=o&&o.length>0&&(u=this.dtOTTypes.filter(e=>e.CostCenterColID==o[0].LinkData.toString()),null!=u&&u.length>0&&("PayWeeklyOffOT"==u[0].SysColumnName.toString()||"PayHolidayOT"==u[0].SysColumnName.toString()||"PayEveryDayOT"==u[0].SysColumnName.toString()))){let i=parseFloat(s.dcNum1).ToTime("00.00").split(".");O=(new Date).AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1]));let a=parseFloat(s.dcNum5).ToTime("00.00").split(".");f=(new Date).AddHours(parseFloat(a[0])).AddMinutes(parseFloat(a[1])),I=this.GetMaxAvilableHrs(e,t,y,"dcNum5"),I=I.AddHours(f.getHours()).AddMinutes(f.getMinutes()),j<I&&(I=j),s.dcNum5=I.ToString("HH.mm"),j=j.AddHours(-I.getHours()).AddMinutes(-I.getMinutes())}}if(null!=(c=this.ScreenObject.ColumnSource.find(e=>"FLOAT"==e.DataType.toUpperCase()&&"dcnum7"==e.DisplayMember.toLowerCase()))&&null!=c&&this.ScreenObject.GridDataColumns.Contains("dcNum7"))if("dcnum4"!=i.toLowerCase()&&"dcnum5"!=i.toLowerCase()&&"dcnum7"!=i.toLowerCase()&&"dcnum9"!=i.toLowerCase()&&"dcnum11"!=i.toLowerCase()&&"dcnum13"!=i.toLowerCase()||!a.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=a.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)s.dcNum7=(0).ToTime("00.00"),60*A.getHours()+A.getMinutes()>=m&&(A.getHours()>0||A.getMinutes()>0)&&(o=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName==c.DisplayMember),null!=o&&o.length>0&&(u=this.dtOTTypes.filter(e=>e.CostCenterColID==o[0].LinkData.toString()),null!=u&&u.length>0&&("PayWeeklyOffOT"!=u[0].SysColumnName.toString()&&"PayHolidayOT"!=u[0].SysColumnName.toString()&&"PayEveryDayOT"!=u[0].SysColumnName.toString()||(g=this.GetMaxAvilableHrs(e,t,y,"dcNum7"),A<g&&(g=A),s.dcNum7=g.ToString("HH.mm"),A=A.AddHours(-g.getHours()).AddMinutes(-g.getMinutes())))));else{let i=parseFloat(s.dcNum7).ToTime("00.00").split(".");if(g=new Date(1,1,1,0).AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1])),a.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==a.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)T=T.AddHours(g.getHours()).AddMinutes(g.getMinutes());else if(o=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName==c.DisplayMember),null!=o&&o.length>0&&(u=this.dtOTTypes.filter(e=>e.CostCenterColID==n.e.String(o[0].LinkData)),null!=u&&u.length>0&&("PayWeeklyOffOT"==u[0].SysColumnName.toString()||"PayHolidayOT"==u[0].SysColumnName.toString()||"PayEveryDayOT"==u[0].SysColumnName.toString()))){let i=parseFloat(s.dcNum1).ToTime("00.00").split(".");O=(new Date).AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1]));let a=parseFloat(s.dcNum7).ToTime("00.00").split(".");f=(new Date).AddHours(parseFloat(a[0])).AddMinutes(parseFloat(a[1])),I=this.GetMaxAvilableHrs(e,t,y,"dcNum7"),I=I.AddHours(f.getHours()).AddMinutes(f.getMinutes()),j<I&&(I=j),s.dcNum7=I.ToString("HH.mm"),j=j.AddHours(-I.getHours()).AddMinutes(-I.getMinutes())}}if(null!=(c=this.ScreenObject.ColumnSource.find(e=>"FLOAT"==e.DataType.toUpperCase()&&"dcnum9"==e.DisplayMember.toLowerCase()))&&null!=c&&this.ScreenObject.GridDataColumns.Contains("dcNum9"))if("dcnum4"!=i.toLowerCase()&&"dcnum5"!=i.toLowerCase()&&"dcnum7"!=i.toLowerCase()&&"dcnum9"!=i.toLowerCase()&&"dcnum11"!=i.toLowerCase()&&"dcnum13"!=i.toLowerCase()||!a.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=a.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)s.dcNum9=(0).ToTime("00.00"),60*A.getHours()+A.getMinutes()>=b&&(A.getHours()>0||A.getMinutes()>0)&&(o=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName==c.DisplayMember),null!=o&&o.length>0&&(u=this.dtOTTypes.filter(e=>e.CostCenterColID==o[0].LinkData.toString()),null!=u&&u.length>0&&("PayWeeklyOffOT"!=u[0].SysColumnName.toString()&&"PayHolidayOT"!=u[0].SysColumnName.toString()&&"PayEveryDayOT"!=u[0].SysColumnName.toString()||(g=this.GetMaxAvilableHrs(e,t,y,"dcNum9"),A<g&&(g=A),s.dcNum9=g.ToString("HH.mm"),A=A.AddHours(-g.getHours()).AddMinutes(-g.getMinutes())))));else{let i=parseFloat(s.dcNum9).ToTime("00.00").split(".");if(g=new Date(1,1,1,0).AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1])),a.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==a.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)T=T.AddHours(g.getHours()).AddMinutes(g.getMinutes());else if(o=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName=="'"+c.DisplayMember+"'"),null!=o&&o.length>0&&(u=this.dtOTTypes.filter(e=>e.CostCenterColID==n.e.String(o[0].LinkData)),null!=u&&u.length>0&&("PayWeeklyOffOT"==u[0].SysColumnName.toString()||"PayHolidayOT"==u[0].SysColumnName.toString()||"PayEveryDayOT"==u[0].SysColumnName.toString()))){let i=parseFloat(s.dcNum1).ToTime("00.00").split(".");O=(new Date).AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1]));let a=parseFloat(s.dcNum9).ToTime("00.00").split(".");f=(new Date).AddHours(parseFloat(a[0])).AddMinutes(parseFloat(a[1])),I=this.GetMaxAvilableHrs(e,t,y,"dcNum9"),I=I.AddHours(f.getHours()).AddMinutes(f.getMinutes()),j<I&&(I=j),s.dcNum9=I.ToString("HH.mm"),j=j.AddHours(-I.getHours()).AddMinutes(-I.getMinutes())}}if(null!=(c=this.ScreenObject.ColumnSource.find(e=>"FLOAT"==e.DataType.toUpperCase()&&"dcnum11"==e.DisplayMember.toLowerCase()))&&null!=c&&this.ScreenObject.GridDataColumns.Contains("dcNum11"))if("dcnum4"!=i.toLowerCase()&&"dcnum5"!=i.toLowerCase()&&"dcnum7"!=i.toLowerCase()&&"dcnum9"!=i.toLowerCase()&&"dcnum11"!=i.toLowerCase()&&"dcnum13"!=i.toLowerCase()||!a.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=a.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)s.dcNum11=(0).ToTime("00.00"),60*A.getHours()+A.getMinutes()>=C&&(A.getHours()>0||A.getMinutes()>0)&&(o=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName==c.DisplayMember),null!=o&&o.length>0&&(u=this.dtOTTypes.filter(e=>e.CostCenterColID==o[0].LinkData.toString()),null!=u&&u.length>0&&("PayWeeklyOffOT"!=u[0].SysColumnName.toString()&&"PayHolidayOT"!=u[0].SysColumnName.toString()&&"PayEveryDayOT"!=u[0].SysColumnName.toString()||(g=this.GetMaxAvilableHrs(e,t,y,"dcNum11"),A<g&&(g=A),s.dcNum11=g.ToString("HH.mm"),A=A.AddHours(-g.getHours()).AddMinutes(-g.getMinutes())))));else{let i=parseFloat(s.dcNum11).ToTime("00.00").split(".");if(g=new Date(1,1,1,0).AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1])),a.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==a.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)T=T.AddHours(g.getHours()).AddMinutes(g.getMinutes());else if(o=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName=="'"+c.DisplayMember+"'"),null!=o&&o.length>0&&(u=this.dtOTTypes.filter(e=>e.CostCenterColID==n.e.String(o[0].LinkData)),null!=u&&u.length>0&&("PayWeeklyOffOT"==u[0].SysColumnName.toString()||"PayHolidayOT"==u[0].SysColumnName.toString()||"PayEveryDayOT"==u[0].SysColumnName.toString()))){let i=parseFloat(s.dcNum1).ToTime("00.00").split(".");O=(new Date).AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1]));let a=parseFloat(s.dcNum11).ToTime("00.00").split(".");f=(new Date).AddHours(parseFloat(a[0])).AddMinutes(parseFloat(a[1])),I=this.GetMaxAvilableHrs(e,t,y,"dcNum11"),I=I.AddHours(f.getHours()).AddMinutes(f.getMinutes()),j<I&&(I=j),s.dcNum11=I.ToString("HH.mm"),j=j.AddHours(-I.getHours()).AddMinutes(-I.getMinutes())}}if(null!=(c=this.ScreenObject.ColumnSource.find(e=>"FLOAT"==e.DataType.toUpperCase()&&"dcnum13"==e.DisplayMember.toLowerCase()))&&null!=c&&this.ScreenObject.GridDataColumns.Contains("dcNum13"))if("dcnum4"!=i.toLowerCase()&&"dcnum5"!=i.toLowerCase()&&"dcnum7"!=i.toLowerCase()&&"dcnum9"!=i.toLowerCase()&&"dcnum11"!=i.toLowerCase()&&"dcnum13"!=i.toLowerCase()||!a.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=a.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)s.dcNum13=(0).ToTime("00.00"),60*A.getHours()+A.getMinutes()>=p&&(A.getHours()>0||A.getMinutes()>0)&&(o=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName==c.DisplayMember),null!=o&&o.length>0&&(u=this.dtOTTypes.filter(e=>e.CostCenterColID==o[0].LinkData),null!=u&&u.length>0&&("PayWeeklyOffOT"!=u[0].SysColumnName.toString()&&"PayHolidayOT"!=u[0].SysColumnName.toString()&&"PayEveryDayOT"!=u[0].SysColumnName.toString()||(g=this.GetMaxAvilableHrs(e,t,y,"dcNum13"),A<g&&(g=A),s.dcNum13=g.ToString("HH.mm"),A=A.AddHours(-g.getHours()).AddMinutes(-g.getMinutes())))));else{let i=parseFloat(s.dcNum13).ToTime("00.00").split(".");if(g=new Date(1,1,1,0).AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1])),a.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==a.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)T=T.AddHours(g.getHours()).AddMinutes(g.getMinutes());else if(o=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName=="'"+c.DisplayMember+"'"),null!=o&&o.length>0&&(u=this.dtOTTypes.filter(e=>e.CostCenterColID==n.e.String(o[0].LinkData)),null!=u&&u.length>0&&("PayWeeklyOffOT"==u[0].SysColumnName.toString()||"PayHolidayOT"==u[0].SysColumnName.toString()||"PayEveryDayOT"==u[0].SysColumnName.toString()))){let i=parseFloat(s.dcNum1).ToTime("00.00").split(".");O=(new Date).AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1]));let a=parseFloat(s.dcNum13).ToTime("00.00").split(".");f=(new Date).AddHours(parseFloat(a[0])).AddMinutes(parseFloat(a[1])),I=this.GetMaxAvilableHrs(e,t,y,"dcNum13"),I=I.AddHours(f.getHours()).AddMinutes(f.getMinutes()),j<I&&(I=j),s.dcNum13=I.ToString("HH.mm"),j=j.AddHours(-I.getHours()).AddMinutes(-I.getMinutes())}}}else s.dcNum5=(0).ToTime("00.00"),s.dcNum7=(0).ToTime("00.00"),s.dcNum9=(0).ToTime("00.00"),s.dcNum11=(0).ToTime("00.00"),s.dcNum13=(0).ToTime("00.00");"dcnum4"!=i.toLowerCase()&&"dcnum5"!=i.toLowerCase()&&"dcnum7"!=i.toLowerCase()&&"dcnum9"!=i.toLowerCase()&&"dcnum11"!=i.toLowerCase()&&"dcnum13"!=i.toLowerCase()||!a.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=a.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence||a.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==a.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry&&(s.dcNum1=T.ToString("HH.mm"))}else{if(null!=(c=this.ScreenObject.ColumnSource.find(e=>"FLOAT"==e.DataType.toUpperCase()&&"dcnum2"==e.DisplayMember.toLowerCase()))&&null!=c&&this.ScreenObject.GridDataColumns.Contains("dcNum2")&&(n.e.IsEmpty(s.dcNum2)||-2==parseFloat(s.dcNum2)||(s.dcNum2=(0).ToTime("00.00"))),null!=(c=this.ScreenObject.ColumnSource.find(e=>"FLOAT"==e.DataType.toUpperCase()&&"dcnum4"==e.DisplayMember.toLowerCase()))&&null!=c&&this.ScreenObject.GridDataColumns.Contains("dcNum4"))if("dcnum4"!=i.toLowerCase()&&"dcnum5"!=i.toLowerCase()&&"dcnum7"!=i.toLowerCase()&&"dcnum9"!=i.toLowerCase()&&"dcnum11"!=i.toLowerCase()&&"dcnum13"!=i.toLowerCase()||!a.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=a.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)if("dcnum4"==i.toLowerCase()&&a.a.SessionManager.Preferences.ContainsKey("BreakHoursImpactToOTS")&&"True"==a.a.SessionManager.Preferences.BreakHoursImpactToOTS){if(A.getHours()>0||A.getMinutes()>0){let e=parseFloat(s.dcNum4).ToTime("00.00").split(".");g=new Date(1,1,1,0).AddHours(parseFloat(e[0])).AddMinutes(parseFloat(e[1])),s.dcNum4=g.ToString("HH.mm"),A=A.AddHours(-g.getHours()).AddMinutes(-g.getMinutes())}}else s.dcNum4=(0).ToTime("00.00"),(A.getHours()>0||A.getMinutes()>0)&&(g=this.GetMaxAvilableHrs(e,t,y,"dcNum4"),A<g&&(g=A),s.dcNum4=g.ToString("HH.mm"),A=A.AddHours(-g.getHours()).AddMinutes(-g.getMinutes()));else{let e=parseFloat(s.dcNum4).ToTime("00.00").split(".");if(g=new Date(1,1,1,0).AddHours(parseFloat(e[0])).AddMinutes(parseFloat(e[1])),a.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==a.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)T=T.AddHours(g.getHours()).AddMinutes(g.getMinutes());else{let e=parseFloat(s.dcNum1).ToTime("00.00").split(".");O=(new Date).AddHours(parseFloat(e[0])).AddMinutes(parseFloat(e[1])),j=O.AddHours(-g.getHours()).AddMinutes(-g.getMinutes())}}if(h){if(null!=(c=this.ScreenObject.ColumnSource.find(e=>"FLOAT"==e.DataType.toUpperCase()&&"dcnum5"==e.DisplayMember.toLowerCase()))&&null!=c&&this.ScreenObject.GridDataColumns.Contains("dcNum5"))if("dcnum4"!=i.toLowerCase()&&"dcnum5"!=i.toLowerCase()&&"dcnum7"!=i.toLowerCase()&&"dcnum9"!=i.toLowerCase()&&"dcnum11"!=i.toLowerCase()&&"dcnum13"!=i.toLowerCase()||!a.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=a.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)s.dcNum5=(0).ToTime("00.00"),60*A.getHours()+A.getMinutes()>=S&&(A.getHours()>0||A.getMinutes()>0)&&(o=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName==c.DisplayMember),null!=o&&o.length>0&&(u=this.dtOTTypes.filter(e=>e.CostCenterColID==o[0].LinkData.toString()),null!=u&&u.length>0&&("PayHolidayMastOT"!=u[0].SysColumnName.toString()&&"PayHolidayOT"!=u[0].SysColumnName.toString()&&"PayEveryDayOT"!=u[0].SysColumnName.toString()||(g=this.GetMaxAvilableHrs(e,t,y,"dcNum5"),A<g&&(g=A),s.dcNum5=g.ToString("HH.mm"),A=A.AddHours(-g.getHours()).AddMinutes(-g.getMinutes())))));else{let i=parseFloat(s.dcNum5).ToTime("00.00").split(".");if(g=new Date(1,1,1,0).AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1])),a.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==a.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)T=T.AddHours(g.getHours()).AddMinutes(g.getMinutes());else if(o=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName=="'"+c.DisplayMember+"'"),null!=o&&o.length>0&&(u=this.dtOTTypes.filter(e=>e.CostCenterColID==n.e.String(o[0].LinkData)),null!=u&&u.length>0&&("PayHolidayMastOT"==u[0].SysColumnName.toString()||"PayHolidayOT"==u[0].SysColumnName.toString()||"PayEveryDayOT"==u[0].SysColumnName.toString()))){let i=parseFloat(s.dcNum1).ToTime("00.00").split(".");O=(new Date).AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1]));let a=parseFloat(s.dcNum5).ToTime("00.00").split(".");f=(new Date).AddHours(parseFloat(a[0])).AddMinutes(parseFloat(a[1])),I=this.GetMaxAvilableHrs(e,t,y,"dcNum5"),I=I.AddHours(f.getHours()).AddMinutes(f.getMinutes()),j<I&&(I=j),s.dcNum5=I.ToString("HH.mm"),j=j.AddHours(-I.getHours()).AddMinutes(-I.getMinutes())}}if(null!=(c=this.ScreenObject.ColumnSource.find(e=>"FLOAT"==e.DataType.toUpperCase()&&"dcnum7"==e.DisplayMember.toLowerCase()))&&null!=c&&this.ScreenObject.GridDataColumns.Contains("dcNum7"))if("dcnum4"!=i.toLowerCase()&&"dcnum5"!=i.toLowerCase()&&"dcnum7"!=i.toLowerCase()&&"dcnum9"!=i.toLowerCase()&&"dcnum11"!=i.toLowerCase()&&"dcnum13"!=i.toLowerCase()||!a.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=a.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)s.dcNum7=(0).ToTime("00.00"),60*A.getHours()+A.getMinutes()>=m&&(A.getHours()>0||A.getMinutes()>0)&&(o=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName==c.DisplayMember),null!=o&&o.length>0&&(u=this.dtOTTypes.filter(e=>e.CostCenterColID==o[0].LinkData.toString()),null!=u&&u.length>0&&("PayHolidayMastOT"!=u[0].SysColumnName.toString()&&"PayHolidayOT"!=u[0].SysColumnName.toString()&&"PayEveryDayOT"!=u[0].SysColumnName.toString()||(g=this.GetMaxAvilableHrs(e,t,y,"dcNum7"),A<g&&(g=A),s.dcNum7=g.ToString("HH.mm"),A=A.AddHours(-g.getHours()).AddMinutes(-g.getMinutes())))));else{let i=parseFloat(s.dcNum7).ToTime("00.00").split(".");if(g=new Date(1,1,1,0).AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1])),a.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==a.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)T=T.AddHours(g.getHours()).AddMinutes(g.getMinutes());else if(o=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName=="'"+c.DisplayMember+"'"),null!=o&&o.length>0&&(u=this.dtOTTypes.filter(e=>e.CostCenterColID==n.e.String(o[0].LinkData)),null!=u&&u.length>0&&("PayHolidayMastOT"==u[0].SysColumnName.toString()||"PayHolidayOT"==u[0].SysColumnName.toString()||"PayEveryDayOT"==u[0].SysColumnName.toString()))){let i=parseFloat(s.dcNum1).ToTime("00.00").split(".");O=(new Date).AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1]));let a=parseFloat(s.dcNum7).ToTime("00.00").split(".");f=(new Date).AddHours(parseFloat(a[0])).AddMinutes(parseFloat(a[1])),I=this.GetMaxAvilableHrs(e,t,y,"dcNum7"),I=I.AddHours(f.getHours()).AddMinutes(f.getMinutes()),j<I&&(I=j),s.dcNum7=I.ToString("HH.mm"),j=j.AddHours(-I.getHours()).AddMinutes(-I.getMinutes())}}if(null!=(c=this.ScreenObject.ColumnSource.find(e=>"FLOAT"==e.DataType.toUpperCase()&&"dcnum9"==e.DisplayMember.toLowerCase()))&&null!=c&&this.ScreenObject.GridDataColumns.Contains("dcNum9"))if("dcnum4"!=i.toLowerCase()&&"dcnum5"!=i.toLowerCase()&&"dcnum7"!=i.toLowerCase()&&"dcnum9"!=i.toLowerCase()&&"dcnum11"!=i.toLowerCase()&&"dcnum13"!=i.toLowerCase()||!a.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=a.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)s.dcNum9=(0).ToTime("00.00"),60*A.getHours()+A.getMinutes()>=b&&(A.getHours()>0||A.getMinutes()>0)&&(o=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName==c.DisplayMember),null!=o&&o.length>0&&(u=this.dtOTTypes.filter(e=>e.CostCenterColID==o[0].LinkData.toString()),null!=u&&u.length>0&&("PayHolidayMastOT"!=u[0].SysColumnName.toString()&&"PayHolidayOT"!=u[0].SysColumnName.toString()&&"PayEveryDayOT"!=u[0].SysColumnName.toString()||(g=this.GetMaxAvilableHrs(e,t,y,"dcNum9"),A<g&&(g=A),s.dcNum9=g.ToString("HH.mm"),A=A.AddHours(-g.getHours()).AddMinutes(-g.getMinutes())))));else{let i=parseFloat(s.dcNum9).ToTime("00.00").split(".");if(g=new Date(1,1,1,0).AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1])),a.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==a.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)T=T.AddHours(g.getHours()).AddMinutes(g.getMinutes());else if(o=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName=="'"+c.DisplayMember+"'"),null!=o&&o.length>0&&(u=this.dtOTTypes.filter(e=>e.CostCenterColID==n.e.String(o[0].LinkData)),null!=u&&u.length>0&&("PayHolidayMastOT"==u[0].SysColumnName.toString()||"PayHolidayOT"==u[0].SysColumnName.toString()||"PayEveryDayOT"==u[0].SysColumnName.toString()))){let i=parseFloat(s.dcNum1).ToTime("00.00").split(".");O=(new Date).AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1]));let a=parseFloat(s.dcNum9).ToTime("00.00").split(".");f=(new Date).AddHours(parseFloat(a[0])).AddMinutes(parseFloat(a[1])),I=this.GetMaxAvilableHrs(e,t,y,"dcNum9"),I=I.AddHours(f.getHours()).AddMinutes(f.getMinutes()),j<I&&(I=j),s.dcNum9=I.ToString("HH.mm"),j=j.AddHours(-I.getHours()).AddMinutes(-I.getMinutes())}}if(null!=(c=this.ScreenObject.ColumnSource.find(e=>"FLOAT"==e.DataType.toUpperCase()&&"dcnum11"==e.DisplayMember.toLowerCase()))&&null!=c&&this.ScreenObject.GridDataColumns.Contains("dcNum11"))if("dcnum4"!=i.toLowerCase()&&"dcnum5"!=i.toLowerCase()&&"dcnum7"!=i.toLowerCase()&&"dcnum9"!=i.toLowerCase()&&"dcnum11"!=i.toLowerCase()&&"dcnum13"!=i.toLowerCase()||!a.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=a.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)s.dcNum11=(0).ToTime("00.00"),60*A.getHours()+A.getMinutes()>=C&&(A.getHours()>0||A.getMinutes()>0)&&(o=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName==c.DisplayMember),null!=o&&o.length>0&&(u=this.dtOTTypes.filter(e=>e.CostCenterColID==o[0].LinkData.toString()),null!=u&&u.length>0&&("PayHolidayMastOT"!=u[0].SysColumnName.toString()&&"PayHolidayOT"!=u[0].SysColumnName.toString()&&"PayEveryDayOT"!=u[0].SysColumnName.toString()||(g=this.GetMaxAvilableHrs(e,t,y,"dcNum11"),A<g&&(g=A),s.dcNum11=g.ToString("HH.mm"),A=A.AddHours(-g.getHours()).AddMinutes(-g.getMinutes())))));else{let i=parseFloat(s.dcNum11).ToTime("00.00").split(".");if(g=new Date(1,1,1,0).AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1])),a.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==a.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)T=T.AddHours(g.getHours()).AddMinutes(g.getMinutes());else if(o=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName=="'"+c.DisplayMember+"'"),null!=o&&o.length>0&&(u=this.dtOTTypes.filter(e=>e.CostCenterColID==n.e.String(o[0].LinkData)),null!=u&&u.length>0&&("PayHolidayMastOT"==u[0].SysColumnName.toString()||"PayHolidayOT"==u[0].SysColumnName.toString()||"PayEveryDayOT"==u[0].SysColumnName.toString()))){let i=parseFloat(s.dcNum1).ToTime("00.00").split(".");O=(new Date).AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1]));let a=parseFloat(s.dcNum11).ToTime("00.00").split(".");f=(new Date).AddHours(parseFloat(a[0])).AddMinutes(parseFloat(a[1])),I=this.GetMaxAvilableHrs(e,t,y,"dcNum11"),I=I.AddHours(f.getHours()).AddMinutes(f.getMinutes()),j<I&&(I=j),s.dcNum11=I.ToString("HH.mm"),j=j.AddHours(-I.getHours()).AddMinutes(-I.getMinutes())}}if(null!=(c=this.ScreenObject.ColumnSource.find(e=>"FLOAT"==e.DataType.toUpperCase()&&"dcnum13"==e.DisplayMember.toLowerCase()))&&null!=c&&this.ScreenObject.GridDataColumns.Contains("dcNum13"))if("dcnum4"!=i.toLowerCase()&&"dcnum5"!=i.toLowerCase()&&"dcnum7"!=i.toLowerCase()&&"dcnum9"!=i.toLowerCase()&&"dcnum11"!=i.toLowerCase()&&"dcnum13"!=i.toLowerCase()||!a.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=a.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)s.dcNum13=(0).ToTime("00.00"),60*A.getHours()+A.getMinutes()>=p&&(A.getHours()>0||A.getMinutes()>0)&&(o=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName==c.DisplayMember),null!=o&&o.length>0&&(u=this.dtOTTypes.filter(e=>e.CostCenterColID==o[0].LinkData.toString()),null!=u&&u.length>0&&("PayHolidayMastOT"!=u[0].SysColumnName.toString()&&"PayHolidayOT"!=u[0].SysColumnName.toString()&&"PayEveryDayOT"!=u[0].SysColumnName.toString()||(g=this.GetMaxAvilableHrs(e,t,y,"dcNum13"),A<g&&(g=A),s.dcNum13=g.ToString("HH.mm"),A=A.AddHours(-g.getHours()).AddMinutes(-g.getMinutes())))));else{let i=parseFloat(s.dcNum13).ToTime("00.00").split(".");if(g=new Date(1,1,1,0).AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1])),a.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==a.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)T=T.AddHours(g.getHours()).AddMinutes(g.getMinutes());else if(o=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName=="'"+c.DisplayMember+"'"),null!=o&&o.length>0&&(u=this.dtOTTypes.filter(e=>e.CostCenterColID==n.e.String(o[0].LinkData)),null!=u&&u.length>0&&("PayHolidayMastOT"==u[0].SysColumnName.toString()||"PayHolidayOT"==u[0].SysColumnName.toString()||"PayEveryDayOT"==u[0].SysColumnName.toString()))){let i=parseFloat(s.dcNum1).ToTime("00.00").split(".");O=(new Date).AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1]));let a=parseFloat(s.dcNum13).ToTime("00.00").split(".");f=(new Date).AddHours(parseFloat(a[0])).AddMinutes(parseFloat(a[1])),I=this.GetMaxAvilableHrs(e,t,y,"dcNum13"),I=I.AddHours(f.getHours()).AddMinutes(f.getMinutes()),j<I&&(I=j),s.dcNum13=I.ToString("HH.mm"),j=j.AddHours(-I.getHours()).AddMinutes(-I.getMinutes())}}}else s.dcNum5=(0).ToTime("00.00"),s.dcNum7=(0).ToTime("00.00"),s.dcNum9=(0).ToTime("00.00"),s.dcNum11=(0).ToTime("00.00"),s.dcNum13=(0).ToTime("00.00");"dcnum4"!=i.toLowerCase()&&"dcnum5"!=i.toLowerCase()&&"dcnum7"!=i.toLowerCase()&&"dcnum9"!=i.toLowerCase()&&"dcnum11"!=i.toLowerCase()&&"dcnum13"!=i.toLowerCase()||!a.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=a.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence||a.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==a.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry&&(s.dcNum1=T.ToString("HH.mm"))}else{var c;if(null!=(c=this.ScreenObject.ColumnSource.find(e=>"FLOAT"==e.DataType.toUpperCase()&&"dcnum2"==e.DisplayMember.toLowerCase()))&&null!=c&&this.ScreenObject.GridDataColumns.Contains("dcNum2")&&(s.dcNum2=(0).ToTime("00.00"),(A.getHours()>0||A.getMinutes()>0)&&(g=this.GetMaxAvilableHrs(e,t,y,"dcNum2"),A<g&&(g=A),s.dcNum2=g.ToString("HH.mm"),A=A.AddHours(-g.getHours()).AddMinutes(-g.getMinutes()),T=T.AddHours(g.getHours()).AddMinutes(g.getMinutes()))),null!=(c=this.ScreenObject.ColumnSource.find(e=>"FLOAT"==e.DataType.toUpperCase()&&"dcnum4"==e.DisplayMember.toLowerCase()))&&null!=c&&this.ScreenObject.GridDataColumns.Contains("dcNum4"))if("dcnum4"!=i.toLowerCase()&&"dcnum5"!=i.toLowerCase()&&"dcnum7"!=i.toLowerCase()&&"dcnum9"!=i.toLowerCase()&&"dcnum11"!=i.toLowerCase()&&"dcnum13"!=i.toLowerCase()||!a.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=a.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)if("dcnum4"==i.toLowerCase()&&a.a.SessionManager.Preferences.ContainsKey("BreakHoursImpactToOTS")&&"True"==a.a.SessionManager.Preferences.BreakHoursImpactToOTS){if(A.getHours()>0||A.getMinutes()>0){let e=parseFloat(s.dcNum4).ToTime("00.00").split(".");g=new Date(1,1,1,0).AddHours(parseFloat(e[0])).AddMinutes(parseFloat(e[1])),s.dcNum4=g.ToString("HH.mm"),A=A.AddHours(-g.getHours()).AddMinutes(-g.getMinutes())}}else s.dcNum4=(0).ToTime("00.00"),(A.getHours()>0||A.getMinutes()>0)&&(g=this.GetMaxAvilableHrs(e,t,y,"dcNum4"),A<g&&(g=A),s.dcNum4=g.ToString("HH.mm"),A=A.AddHours(-g.getHours()).AddMinutes(-g.getMinutes()));else{let i=parseFloat(s.dcNum4).ToTime("00.00").split(".");if(g=new Date(1,1,1,0).AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1])),a.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==a.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)T=T.AddHours(g.getHours()).AddMinutes(g.getMinutes());else{let i=parseFloat(s.dcNum1).ToTime("00.00").split(".");O=(new Date).AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1]));let a=parseFloat(s.dcNum2).ToTime("00.00").split(".");f=(new Date).AddHours(parseFloat(a[0])).AddMinutes(parseFloat(a[1])),I=this.GetMaxAvilableHrs(e,t,y,"dcNum2"),I=I.AddHours(f.getHours()).AddMinutes(f.getMinutes()),j=O.AddHours(-g.getHours()).AddMinutes(-g.getMinutes()),j<I&&(I=j),s.dcNum2=I.ToString("HH.mm"),j=j.AddHours(-I.getHours()).AddMinutes(-I.getMinutes())}}if(h){if(null!=(c=this.ScreenObject.ColumnSource.find(e=>"FLOAT"==e.DataType.toUpperCase()&&"dcnum5"==e.DisplayMember.toLowerCase()))&&null!=c&&this.ScreenObject.GridDataColumns.Contains("dcNum5"))if("dcnum4"!=i.toLowerCase()&&"dcnum5"!=i.toLowerCase()&&"dcnum7"!=i.toLowerCase()&&"dcnum9"!=i.toLowerCase()&&"dcnum11"!=i.toLowerCase()&&"dcnum13"!=i.toLowerCase()||!a.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=a.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)s.dcNum5=(0).ToTime("00.00"),60*A.getHours()+A.getMinutes()>=S&&(A.getHours()>0||A.getMinutes()>0)&&(o=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName==c.DisplayMember),null!=o&&o.length>0&&(u=this.dtOTTypes.filter(e=>e.CostCenterColID==o[0].LinkData.toString()),null!=u&&u.length>0&&("PayNormalOT"!=u[0].SysColumnName.toString()&&"PayEveryDayOT"!=u[0].SysColumnName.toString()||(g=this.GetMaxAvilableHrs(e,t,y,"dcNum5"),A<g&&(g=A),s.dcNum5=g.ToString("HH.mm"),A=A.AddHours(-g.getHours()).AddMinutes(-g.getMinutes())))));else{let i=parseFloat(s.dcNum5).ToTime("00.00").split(".");if(g=new Date(1,1,1,0).AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1])),a.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==a.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)T=T.AddHours(g.getHours()).AddMinutes(g.getMinutes());else if(o=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName=="'"+c.DisplayMember+"'"),null!=o&&o.length>0&&(u=this.dtOTTypes.filter(e=>e.CostCenterColID==n.e.String(o[0].LinkData)),null!=u&&u.length>0&&("PayNormalOT"==u[0].SysColumnName.toString()||"PayEveryDayOT"==u[0].SysColumnName.toString()))){let i=parseFloat(s.dcNum1).ToTime("00.00").split(".");O=(new Date).AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1]));let a=parseFloat(s.dcNum5).ToTime("00.00").split(".");f=(new Date).AddHours(parseFloat(a[0])).AddMinutes(parseFloat(a[1])),I=this.GetMaxAvilableHrs(e,t,y,"dcNum5"),I=I.AddHours(f.getHours()).AddMinutes(f.getMinutes()),j<I&&(I=j),s.dcNum5=I.ToString("HH.mm"),j=j.AddHours(-I.getHours()).AddMinutes(-I.getMinutes())}}if(null!=(c=this.ScreenObject.ColumnSource.find(e=>"FLOAT"==e.DataType.toUpperCase()&&"dcnum7"==e.DisplayMember.toLowerCase()))&&null!=c&&this.ScreenObject.GridDataColumns.Contains("dcNum7"))if("dcnum4"!=i.toLowerCase()&&"dcnum5"!=i.toLowerCase()&&"dcnum7"!=i.toLowerCase()&&"dcnum9"!=i.toLowerCase()&&"dcnum11"!=i.toLowerCase()&&"dcnum13"!=i.toLowerCase()||!a.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=a.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)s.dcNum7=(0).ToTime("00.00"),60*A.getHours()+A.getMinutes()>=m&&(A.getHours()>0||A.getMinutes()>0)&&(o=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName==c.DisplayMember),null!=o&&o.length>0&&(u=this.dtOTTypes.filter(e=>e.CostCenterColID==o[0].LinkData.toString()),null!=u&&u.length>0&&("PayNormalOT"!=u[0].SysColumnName.toString()&&"PayEveryDayOT"!=u[0].SysColumnName.toString()||(g=this.GetMaxAvilableHrs(e,t,y,"dcNum7"),A<g&&(g=A),s.dcNum7=g.ToString("HH.mm"),A=A.AddHours(-g.getHours()).AddMinutes(-g.getMinutes())))));else{let i=parseFloat(s.dcNum7).ToTime("00.00").split(".");if(g=new Date(1,1,1,0).AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1])),a.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==a.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)T=T.AddHours(g.getHours()).AddMinutes(g.getMinutes());else if(o=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName=="'"+c.DisplayMember+"'"),null!=o&&o.length>0&&(u=this.dtOTTypes.filter(e=>e.CostCenterColID==n.e.String(o[0].LinkData)),null!=u&&u.length>0&&("PayNormalOT"==u[0].SysColumnName.toString()||"PayEveryDayOT"==u[0].SysColumnName.toString()))){let i=parseFloat(s.dcNum1).ToTime("00.00").split(".");O=(new Date).AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1]));let a=parseFloat(s.dcNum7).ToTime("00.00").split(".");f=(new Date).AddHours(parseFloat(a[0])).AddMinutes(parseFloat(a[1])),I=this.GetMaxAvilableHrs(e,t,y,"dcNum7"),I=I.AddHours(f.getHours()).AddMinutes(f.getMinutes()),j<I&&(I=j),s.dcNum7=I.ToString("HH.mm"),j=j.AddHours(-I.getHours()).AddMinutes(-I.getMinutes())}}if(null!=(c=this.ScreenObject.ColumnSource.find(e=>"FLOAT"==e.DataType.toUpperCase()&&"dcnum9"==e.DisplayMember.toLowerCase()))&&null!=c&&this.ScreenObject.GridDataColumns.Contains("dcNum9"))if("dcnum4"!=i.toLowerCase()&&"dcnum5"!=i.toLowerCase()&&"dcnum7"!=i.toLowerCase()&&"dcnum9"!=i.toLowerCase()&&"dcnum11"!=i.toLowerCase()&&"dcnum13"!=i.toLowerCase()||!a.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=a.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)s.dcNum9=(0).ToTime("00.00"),60*A.getHours()+A.getMinutes()>=b&&(A.getHours()>0||A.getMinutes()>0)&&(o=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName==c.DisplayMember),null!=o&&o.length>0&&(u=this.dtOTTypes.filter(e=>e.CostCenterColID==o[0].LinkData.toString()),null!=u&&u.length>0&&("PayNormalOT"!=u[0].SysColumnName.toString()&&"PayEveryDayOT"!=u[0].SysColumnName.toString()||(g=this.GetMaxAvilableHrs(e,t,y,"dcNum9"),A<g&&(g=A),s.dcNum9=g.ToString("HH.mm"),A=A.AddHours(-g.getHours()).AddMinutes(-g.getMinutes())))));else{let i=parseFloat(s.dcNum9).ToTime("00.00").split(".");if(g=new Date(1,1,1,0).AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1])),a.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==a.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)T=T.AddHours(g.getHours()).AddMinutes(g.getMinutes());else if(o=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName=="'"+c.DisplayMember+"'"),null!=o&&o.length>0&&(u=this.dtOTTypes.filter(e=>e.CostCenterColID==n.e.String(o[0].LinkData)),null!=u&&u.length>0&&("PayNormalOT"==u[0].SysColumnName.toString()||"PayEveryDayOT"==u[0].SysColumnName.toString()))){let i=parseFloat(s.dcNum1).ToTime("00.00").split(".");O=(new Date).AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1]));let a=parseFloat(s.dcNum9).ToTime("00.00").split(".");f=(new Date).AddHours(parseFloat(a[0])).AddMinutes(parseFloat(a[1])),I=this.GetMaxAvilableHrs(e,t,y,"dcNum9"),I=I.AddHours(f.getHours()).AddMinutes(f.getMinutes()),j<I&&(I=j),s.dcNum9=I.ToString("HH.mm"),j=j.AddHours(-I.getHours()).AddMinutes(-I.getMinutes())}}if(null!=(c=this.ScreenObject.ColumnSource.find(e=>"FLOAT"==e.DataType.toUpperCase()&&"dcnum11"==e.DisplayMember.toLowerCase()))&&null!=c&&this.ScreenObject.GridDataColumns.Contains("dcNum11"))if("dcnum4"!=i.toLowerCase()&&"dcnum5"!=i.toLowerCase()&&"dcnum7"!=i.toLowerCase()&&"dcnum9"!=i.toLowerCase()&&"dcnum11"!=i.toLowerCase()&&"dcnum13"!=i.toLowerCase()||!a.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=a.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)s.dcNum11=(0).ToTime("00.00"),60*A.getHours()+A.getMinutes()>=C&&(A.getHours()>0||A.getMinutes()>0)&&(o=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName==c.DisplayMember),null!=o&&o.length>0&&(u=this.dtOTTypes.filter(e=>e.CostCenterColID==o[0].LinkData.toString()),null!=u&&u.length>0&&("PayNormalOT"!=u[0].SysColumnName.toString()&&"PayEveryDayOT"!=u[0].SysColumnName.toString()||(g=this.GetMaxAvilableHrs(e,t,y,"dcNum11"),A<g&&(g=A),s.dcNum11=g.ToString("HH.mm"),A=A.AddHours(-g.getHours()).AddMinutes(-g.getMinutes())))));else{let i=parseFloat(s.dcNum11).ToTime("00.00").split(".");if(g=new Date(1,1,1,0).AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1])),a.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==a.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)T=T.AddHours(g.getHours()).AddMinutes(g.getMinutes());else if(o=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName=="'"+c.DisplayMember+"'"),null!=o&&o.length>0&&(u=this.dtOTTypes.filter(e=>e.CostCenterColID==n.e.String(o[0].LinkData)),null!=u&&u.length>0&&("PayNormalOT"==u[0].SysColumnName.toString()||"PayEveryDayOT"==u[0].SysColumnName.toString()))){let i=parseFloat(s.dcNum1).ToTime("00.00").split(".");O=(new Date).AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1]));let a=parseFloat(s.dcNum11).ToTime("00.00").split(".");f=(new Date).AddHours(parseFloat(a[0])).AddMinutes(parseFloat(a[1])),I=this.GetMaxAvilableHrs(e,t,y,"dcNum11"),I=I.AddHours(f.getHours()).AddMinutes(f.getMinutes()),j<I&&(I=j),s.dcNum11=I.ToString("HH.mm"),j=j.AddHours(-I.getHours()).AddMinutes(-I.getMinutes())}}if(null!=(c=this.ScreenObject.ColumnSource.find(e=>"FLOAT"==e.DataType.toUpperCase()&&"dcnum13"==e.DisplayMember.toLowerCase()))&&null!=c&&this.ScreenObject.GridDataColumns.Contains("dcNum13"))if("dcnum4"!=i.toLowerCase()&&"dcnum5"!=i.toLowerCase()&&"dcnum7"!=i.toLowerCase()&&"dcnum9"!=i.toLowerCase()&&"dcnum11"!=i.toLowerCase()&&"dcnum13"!=i.toLowerCase()||!a.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=a.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)s.dcNum13=(0).ToTime("00.00"),60*A.getHours()+A.getMinutes()>=p&&(A.getHours()>0||A.getMinutes()>0)&&(o=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName==c.DisplayMember),null!=o&&o.length>0&&(u=this.dtOTTypes.filter(e=>e.CostCenterColID==o[0].LinkData.toString()),null!=u&&u.length>0&&("PayNormalOT"!=u[0].SysColumnName.toString()&&"PayEveryDayOT"!=u[0].SysColumnName.toString()||(g=this.GetMaxAvilableHrs(e,t,y,"dcNum13"),A<g&&(g=A),s.dcNum13=g.ToString("HH.mm"),A=A.AddHours(-g.getHours()).AddMinutes(-g.getMinutes())))));else{let i=parseFloat(s.dcNum13).ToTime("00.00").split(".");if(g=new Date(1,1,1,0).AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1])),a.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==a.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)T=T.AddHours(g.getHours()).AddMinutes(g.getMinutes());else if(o=this.ScreenObject.Data.Tables[0].filter(e=>e.SysColumnName=="'"+c.DisplayMember+"'"),null!=o&&o.length>0&&(u=this.dtOTTypes.filter(e=>e.CostCenterColID==n.e.String(o[0].LinkData)),null!=u&&u.length>0&&("PayNormalOT"==u[0].SysColumnName.toString()||"PayEveryDayOT"==u[0].SysColumnName.toString()))){let i=parseFloat(s.dcNum1).ToTime("00.00").split(".");O=(new Date).AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1]));let a=parseFloat(s.dcNum13).ToTime("00.00").split(".");f=(new Date).AddHours(parseFloat(a[0])).AddMinutes(parseFloat(a[1])),I=this.GetMaxAvilableHrs(e,t,y,"dcNum13"),I=I.AddHours(f.getHours()).AddMinutes(f.getMinutes()),j<I&&(I=j),s.dcNum13=I.ToString("HH.mm"),j=j.AddHours(-I.getHours()).AddMinutes(-I.getMinutes())}}}else this.ScreenObject.GridDataColumns.Contains("dcNum5")&&(s.dcNum5=(0).ToTime("00.00")),this.ScreenObject.GridDataColumns.Contains("dcNum7")&&(s.dcNum7=(0).ToTime("00.00")),this.ScreenObject.GridDataColumns.Contains("dcNum9")&&(s.dcNum9=(0).ToTime("00.00")),this.ScreenObject.GridDataColumns.Contains("dcNum11")&&(s.dcNum11=(0).ToTime("00.00")),this.ScreenObject.GridDataColumns.Contains("dcNum13")&&(s.dcNum13=(0).ToTime("00.00"));"dcnum4"!=i.toLowerCase()&&"dcnum5"!=i.toLowerCase()&&"dcnum7"!=i.toLowerCase()&&"dcnum9"!=i.toLowerCase()&&"dcnum11"!=i.toLowerCase()&&"dcnum13"!=i.toLowerCase()||!a.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=a.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence||a.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==a.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry&&(s.dcNum1=T.ToString("HH.mm"))}}else this.ScreenObject.GridDataColumns.Contains("dcNum2")&&(s.dcNum2=(0).ToTime("00.00")),this.ScreenObject.GridDataColumns.Contains("dcNum4")&&(s.dcNum4=(0).ToTime("00.00")),this.ScreenObject.GridDataColumns.Contains("dcNum5")&&(s.dcNum5=(0).ToTime("00.00")),this.ScreenObject.GridDataColumns.Contains("dcNum7")&&(s.dcNum7=(0).ToTime("00.00")),this.ScreenObject.GridDataColumns.Contains("dcNum9")&&(s.dcNum9=(0).ToTime("00.00")),this.ScreenObject.GridDataColumns.Contains("dcNum11")&&(s.dcNum11=(0).ToTime("00.00")),this.ScreenObject.GridDataColumns.Contains("dcNum13")&&(s.dcNum13=(0).ToTime("00.00"));if(a.a.SessionManager.Preferences.ContainsKey("UseDailyAttRates")){let e=0,t=0;n.e.IsEmpty(s.dcNum2)||n.e.IsEmpty(s.dcNum3)||(e=this.ConvertHoursToMinutes(s.dcNum2.toString())*(parseFloat(s.dcNum3)/60));for(let i=5;i<15;i++)t=0,null!=s["dcNum"+i]&&parseFloat(s["dcNum"+i])>0&&null!=s["dcNum"+i]&&null!=s["dcNum"+i]&&""!=s["dcNum"+i].toString()&&null!=s["dcNum"+(i+1)]&&null!=s["dcNum"+(i+1)]&&""!=s["dcNum"+(i+1)].toString()&&(t=this.ConvertHoursToMinutes(s["dcNum"+i].toString())*(parseFloat(s["dcNum"+(i+1)])/60),e+=t),i+=1;s.dcNum15=e.ToString("0.00")}}catch(h){Logger.ErrorLog("AddEditDocumentsPayroll:: DistributeTotalHours() : "+h.stack)}}GetHoursDefChart(e,t){let s=null;if(a.a.SessionManager.Preferences.ContainsKey("HoursDefChartBasedOn")&&""!=a.a.SessionManager.Preferences.HoursDefChartBasedOn){let i=a.a.SessionManager.Preferences.HoursDefChartBasedOn.split(",");if(null!=i&&i.length>0){let r=" 1=1 ",o="";for(let e=0;e<i.length;e++)null!=i[e]&&""!=i[e]&&(o="dcCCNID"+(parseInt(i[e])-5e4),n.e.IsEmpty(t[o+"_Key"])?r+=" AND "+o+"=1":r+=" AND ( "+o+"="+t[o+"_Key"].toString()+" OR "+o+"=1 )");if(r.length>0){let t=new Date(e).ToString("ddMMMyyyy")+"_"+r.Replace(" ",""),i=!1;null!=this.dsHrsDefDict&&this.dsHrsDefDict.length>0&&this.dsHrsDefDict.ContainsKey(t)&&(i=!0),i?s=this.dsHrsDefDict[t]:(s=a.a.common.GetDataSet3("PAY004",e,r).Tables[0],this.dsHrsDefDict.push(t,s))}}}return s}GetTotalEnteredHours(e,t,s,i){let r;i.dtdblOld=Date.Today();let o="";if(i.VoucherNo="",this.ScreenObject.GridData.length>0){let h=Date.Today().ToString("dd/MMM/yyyy"),u="1",d=null;for(let a=0;a<this.ScreenObject.GridData.length;a++)if(this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[a].ProductID_Key)){d=this.ScreenObject.GridData[a];var l,c=this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase());c?h=c.Date.ToString("dd/MMM/yyyy"):(l=this.ScreenObject.ColumnSource.find(e=>"dcalpha1"==e.DisplayMember.toLowerCase()))&&!n.e.IsEmpty(d[l.DisplayMember+"_Key"])&&(h=new Date(d[l.DisplayMember+"_Key"]).ToString("dd/MMM/yyyy")),(c=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase()))?(c instanceof m.b||c instanceof C.a)&&(u=c.SelectedValue.toString()):(l=this.ScreenObject.ColumnSource.find(e=>"LISTBOX"==e.DataType.toUpperCase()&&"dcccnid51_key"==e.ValueMember.toLowerCase()))&&!n.e.IsEmpty(d[l.ValueMember])&&(u=d[l.ValueMember].toString()),e==u&&t==h&&(n.e.IsEmpty(d[s])||("dcnum2"==s.toLowerCase()?-1!=parseFloat(d[s])&&-2!=parseFloat(d[s])&&(r=parseFloat(d[s]).ToTime("00.00").split("."),i.dtdblOld=i.dtdblOld.AddHours(parseFloat(r[0])).AddMinutes(parseFloat(r[1]))):(r=parseFloat(d[s]).ToTime("00.00").split("."),i.dtdblOld=i.dtdblOld.AddHours(parseFloat(r[0])).AddMinutes(parseFloat(r[1]))),o.length>0&&(o+=","),o+=d.DocSeqNo.toString()))}i.sVoucherNo=" @SeqNo - "+o;let D=null;if(new Date(t).ToString("ddMMMyyyy"),D=a.a.common.GetDataSet3("PAY003",t,e,this.ScreenObject.IsDocEdit?this.ScreenObject.DocID.toString():"0").Tables[0],null!=D&&D.length>0){o="";for(let e=0;e<D.length;e++)n.e.IsEmpty(D[e][s])||("dcnum2"==s.toLowerCase()?-1!=parseFloat(D[e][s])&&-2!=parseFloat(D[s])&&(r=parseFloat(D[e][s]).ToTime("00.00").split("."),i.dtdblOld=i.dtdblOld.AddHours(parseFloat(r[0])).AddMinutes(parseFloat(r[1]))):(r=parseFloat(D[e][s]).ToTime("00.00").split("."),i.dtdblOld=i.dtdblOld.AddHours(parseFloat(r[0])).AddMinutes(parseFloat(r[1]))),i.sVoucherNo+=" @VoucherNo - "+D[e].VoucherNo.toString()+" @SeqNo - "+D[e].DocSeqNo.toString())}}return i.dtdblOld}GetMaxAvilableHrs(e,t,s,i){let a,n=new Date(1,1,1,0),r=new Date(1,1,1,0),o="",l={dtdblOld:r,sVoucherNo:o};return this.GetTotalEnteredHours(e,t,i,l),r=l.dtdblOld,o=l.sVoucherNo,"dcNum1"==i?(a=parseFloat(s[0].MaxHrsPerDay).ToTime("00.00").split("."),n=n.AddHours(parseFloat(a[0])).AddMinutes(parseFloat(a[1])),n=n.AddHours(-r.getHours()).AddMinutes(-r.getMinutes())):"dcNum2"==i?(a=parseFloat(s[0].NormalHrs).ToTime("00.00").split("."),n=n.AddHours(parseFloat(a[0])).AddMinutes(parseFloat(a[1])),n=n.AddHours(-r.getHours()).AddMinutes(-r.getMinutes())):"dcNum4"==i?(a=parseFloat(s[0].BreakHrs).ToTime("00.00").split("."),n=n.AddHours(parseFloat(a[0])).AddMinutes(parseFloat(a[1])),n=n.AddHours(-r.getHours()).AddMinutes(-r.getMinutes())):"dcNum5"==i?(a=parseFloat(s[0].OT1).ToTime("00.00").split("."),n=n.AddHours(parseFloat(a[0])).AddMinutes(parseFloat(a[1])),n=n.AddHours(-r.getHours()).AddMinutes(-r.getMinutes())):"dcNum7"==i?(a=parseFloat(s[0].OT2).ToTime("00.00").split("."),n=n.AddHours(parseFloat(a[0])).AddMinutes(parseFloat(a[1])),n=n.AddHours(-r.getHours()).AddMinutes(-r.getMinutes())):"dcNum9"==i?(a=parseFloat(s[0].OT3).ToTime("00.00").split("."),n=n.AddHours(parseFloat(a[0])).AddMinutes(parseFloat(a[1])),n=n.AddHours(-r.getHours()).AddMinutes(-r.getMinutes())):"dcNum11"==i?(a=parseFloat(s[0].OT4).ToTime("00.00").split("."),n=n.AddHours(parseFloat(a[0])).AddMinutes(parseFloat(a[1])),n=n.AddHours(-r.getHours()).AddMinutes(-r.getMinutes())):"dcNum13"==i&&(a=parseFloat(s[0].OT5).ToTime("00.00").split("."),n=n.AddHours(parseFloat(a[0])).AddMinutes(parseFloat(a[1])),n=n.AddHours(-r.getHours()).AddMinutes(-r.getMinutes())),n}GetDuplicateTimingsOfEmployeeTimeSheet(e,t,s,i){let r,o,l="",c=Date.Today().ToString("dd/MMM/yyyy"),h="1";for(let a=0;a<this.ScreenObject.GridData.length;a++)if(a!=s&&this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[a].ProductID_Key)){c="",h="1",o=this.ScreenObject.GridData[a];var u=this.ScreenObject.ColumnSource.find(e=>"dcalpha1"==e.DisplayMember.toLowerCase());u&&!n.e.IsEmpty(o[u.DisplayMember+"_Key"])&&(c=new Date(o[u.DisplayMember+"_Key"]).ToString("dd/MMM/yyyy"));var d=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());if(d?(d instanceof m.b||d instanceof C.a)&&(h=d.SelectedValue.toString()):(u=this.ScreenObject.ColumnSource.find(e=>"LISTBOX"==e.DataType.toUpperCase()&&"dcccnid51_key"==e.ValueMember.toLowerCase()))&&!n.e.IsEmpty(o[u.ValueMember])&&(h=o[u.ValueMember].toString()),t==h&&e==c){if(this.ScreenObject.GridDataColumns.Contains("dcAlpha2_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].dcAlpha2_Key)&&(r=new Date(this.ScreenObject.GridData[s].dcAlpha2_Key),!n.e.IsEmpty(this.ScreenObject.GridData[a].dcAlpha2_Key)&&!n.e.IsEmpty(this.ScreenObject.GridData[a].dcAlpha4_Key)&&r>=new Date(this.ScreenObject.GridData[a].dcAlpha2_Key)&&r<new Date(this.ScreenObject.GridData[a].dcAlpha4_Key))){l=(a+1).toString();break}if(this.ScreenObject.GridDataColumns.Contains("dcAlpha4_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].dcAlpha4_Key)&&(r=new Date(this.ScreenObject.GridData[s].dcAlpha4_Key),!n.e.IsEmpty(this.ScreenObject.GridData[a].dcAlpha2_Key)&&!n.e.IsEmpty(this.ScreenObject.GridData[a].dcAlpha4_Key)&&r>new Date(this.ScreenObject.GridData[a].dcAlpha2_Key)&&r<new Date(this.ScreenObject.GridData[a].dcAlpha4_Key))){l=(a+1).toString();break}if(this.ScreenObject.GridDataColumns.Contains("dcAlpha2_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[a].dcAlpha2_Key)&&(r=new Date(this.ScreenObject.GridData[a].dcAlpha2_Key),!n.e.IsEmpty(this.ScreenObject.GridData[s].dcAlpha2_Key)&&!n.e.IsEmpty(this.ScreenObject.GridData[s].dcAlpha4_Key)&&r>=new Date(this.ScreenObject.GridData[s].dcAlpha2_Key)&&r<new Date(this.ScreenObject.GridData[s].dcAlpha4_Key))){l=(a+1).toString();break}if(this.ScreenObject.GridDataColumns.Contains("dcAlpha4_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[a].dcAlpha4_Key)&&(r=new Date(this.ScreenObject.GridData[a].dcAlpha4_Key),!n.e.IsEmpty(this.ScreenObject.GridData[s].dcAlpha2_Key)&&!n.e.IsEmpty(this.ScreenObject.GridData[s].dcAlpha4_Key)&&r>new Date(this.ScreenObject.GridData[s].dcAlpha2_Key)&&r<new Date(this.ScreenObject.GridData[s].dcAlpha4_Key))){l=(a+1).toString();break}}}if(this.ScreenObject.GridDataColumns.Contains("dcAlpha2_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].dcAlpha2_Key)&&this.ScreenObject.GridDataColumns.Contains("dcAlpha4_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].dcAlpha4_Key)){let e="d.tDocumentType="+i+" and a.StatusID=369 AND ISDATE(d.dcAlpha1)=1 AND ISDATE(d.dcAlpha2)=1 AND ISDATE(d.dcAlpha3)=1 AND ISDATE(d.dcAlpha4)=1 AND a.DOCID<>"+this.ScreenObject.DocID+" AND b.dcCCNID51="+t+" \nAND (\n( CONVERT(DATETIME,d.dcAlpha2) >= CONVERT(DATETIME,'"+new Date(this.ScreenObject.GridData[s].dcAlpha2_Key).ToString("dd/MMM/yyyy HH:mm:ss")+"') AND CONVERT(DATETIME,d.dcAlpha2) < CONVERT(DATETIME,'"+new Date(this.ScreenObject.GridData[s].dcAlpha4_Key).ToString("dd/MMM/yyyy HH:mm:ss")+"') ) OR\n( CONVERT(DATETIME,d.dcAlpha4) > CONVERT(DATETIME,'"+new Date(this.ScreenObject.GridData[s].dcAlpha2_Key).ToString("dd/MMM/yyyy HH:mm:ss")+"') AND CONVERT(DATETIME,d.dcAlpha4) < CONVERT(DATETIME,'"+new Date(this.ScreenObject.GridData[s].dcAlpha4_Key).ToString("dd/MMM/yyyy HH:mm:ss")+"') ) OR\n( CONVERT(DATETIME,'"+new Date(this.ScreenObject.GridData[s].dcAlpha2_Key).ToString("dd/MMM/yyyy HH:mm:ss")+"') >= CONVERT(DATETIME,d.dcAlpha2) AND CONVERT(DATETIME,'"+new Date(this.ScreenObject.GridData[s].dcAlpha2_Key).ToString("dd/MMM/yyyy HH:mm:ss")+"') < CONVERT(DATETIME,d.dcAlpha4)) OR\n( CONVERT(DATETIME,'"+new Date(this.ScreenObject.GridData[s].dcAlpha4_Key).ToString("dd/MMM/yyyy HH:mm:ss")+"') > CONVERT(DATETIME,d.dcAlpha2) AND CONVERT(DATETIME,'"+new Date(this.ScreenObject.GridData[s].dcAlpha4_Key).ToString("dd/MMM/yyyy HH:mm:ss")+"') < CONVERT(DATETIME,d.dcAlpha4))\n)",n=a.a.common.GetDataSet("PAY006",JSON.stringify(e));null!=n&&n.length>0&&(l=n[0].VoucherNo.toString())}return l}GetDuplicateTimingsOfEmployee(e,t,s){let i,r,o="",l=Date.Today().ToString("dd/MMM/yyyy"),c="1";for(let a=0;a<this.ScreenObject.GridData.length;a++)if(a!=s&&this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[a].ProductID_Key)){l="",c="1",r=this.ScreenObject.GridData[a];var h,u=this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase());if(u?l=u.Date.ToString("dd/MMM/yyyy"):(h=this.ScreenObject.ColumnSource.find(e=>"dcalpha1"==e.DisplayMember.toLowerCase()))&&!n.e.IsEmpty(r[h.DisplayMember+"_Key"])&&(l=new Date(r[h.DisplayMember+"_Key"]).ToString("dd/MMM/yyyy")),(u=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase()))?(u instanceof m.b||u instanceof C.a)&&(c=u.SelectedValue.toString()):(h=this.ScreenObject.ColumnSource.find(e=>"LISTBOX"==e.DataType.toUpperCase()&&"dcccnid51_key"==e.ValueMember.toLowerCase()))&&!n.e.IsEmpty(r[h.ValueMember])&&(c=r[h.ValueMember].toString()),t==c&&e==l){if(this.ScreenObject.GridDataColumns.Contains("dcAlpha2_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].dcAlpha2_Key)&&(i=new Date(this.ScreenObject.GridData[s].dcAlpha2_Key),!n.e.IsEmpty(this.ScreenObject.GridData[a].dcAlpha2_Key)&&!n.e.IsEmpty(this.ScreenObject.GridData[a].dcAlpha3_Key)&&i>=new Date(this.ScreenObject.GridData[a].dcAlpha2_Key)&&i<new Date(this.ScreenObject.GridData[a].dcAlpha3_Key))){o=(a+1).toString();break}if(this.ScreenObject.GridDataColumns.Contains("dcAlpha3_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[s].dcAlpha3_Key)&&(i=new Date(this.ScreenObject.GridData[s].dcAlpha3_Key),!n.e.IsEmpty(this.ScreenObject.GridData[a].dcAlpha2_Key)&&!n.e.IsEmpty(this.ScreenObject.GridData[a].dcAlpha3_Key)&&i>new Date(this.ScreenObject.GridData[a].dcAlpha2_Key)&&i<new Date(this.ScreenObject.GridData[a].dcAlpha3_Key))){o=(a+1).toString();break}if(this.ScreenObject.GridDataColumns.Contains("dcAlpha2_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[a].dcAlpha2_Key)&&(i=new Date(this.ScreenObject.GridData[a].dcAlpha2_Key),!n.e.IsEmpty(this.ScreenObject.GridData[s].dcAlpha2_Key)&&!n.e.IsEmpty(this.ScreenObject.GridData[s].dcAlpha3_Key)&&i>=new Date(this.ScreenObject.GridData[s].dcAlpha2_Key)&&i<new Date(this.ScreenObject.GridData[s].dcAlpha3_Key))){o=(a+1).toString();break}if(this.ScreenObject.GridDataColumns.Contains("dcAlpha3_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[a].dcAlpha3_Key)&&(i=new Date(this.ScreenObject.GridData[a].dcAlpha3_Key),!n.e.IsEmpty(this.ScreenObject.GridData[s].dcAlpha2_Key)&&!n.e.IsEmpty(this.ScreenObject.GridData[s].dcAlpha3_Key)&&i>new Date(this.ScreenObject.GridData[s].dcAlpha2_Key)&&i<new Date(this.ScreenObject.GridData[s].dcAlpha3_Key))){o=(a+1).toString();break}}}let d="d.ta.DocumentType=67 and a.StatusID=369\nAND ISDATE(d.dcAlpha1)=1 AND ISDATE(d.dcAlpha2)=1 AND ISDATE(d.dcAlpha3)=1  \nAND a.DOCID<>"+this.ScreenObject.DocID+" AND b.dcCCNID51="+t+" \n--AND CONVERT(DATETIME,d.dcAlpha1)=CONVERT(DATETIME,'"+e+"') \nAND (\n( CONVERT(DATETIME,d.dcAlpha2) >= CONVERT(DATETIME,'"+new Date(this.ScreenObject.GridData[s].dcAlpha2_Key).ToString("dd/MMM/yyyy HH:mm:ss")+"') AND CONVERT(DATETIME,d.dcAlpha2) < CONVERT(DATETIME,'"+new Date(this.ScreenObject.GridData[s].dcAlpha3_Key).ToString("dd/MMM/yyyy HH:mm:ss")+"') ) OR\n( CONVERT(DATETIME,d.dcAlpha3) > CONVERT(DATETIME,'"+new Date(this.ScreenObject.GridData[s].dcAlpha2_Key).ToString("dd/MMM/yyyy HH:mm:ss")+"') AND CONVERT(DATETIME,d.dcAlpha3) < CONVERT(DATETIME,'"+new Date(this.ScreenObject.GridData[s].dcAlpha3_Key).ToString("dd/MMM/yyyy HH:mm:ss")+"') ) OR\n( CONVERT(DATETIME,'"+new Date(this.ScreenObject.GridData[s].dcAlpha2_Key).ToString("dd/MMM/yyyy HH:mm:ss")+"') >= CONVERT(DATETIME,d.dcAlpha2) AND CONVERT(DATETIME,'"+new Date(this.ScreenObject.GridData[s].dcAlpha2_Key).ToString("dd/MMM/yyyy HH:mm:ss")+"') < CONVERT(DATETIME,d.dcAlpha3)) OR\n( CONVERT(DATETIME,'"+new Date(this.ScreenObject.GridData[s].dcAlpha3_Key).ToString("dd/MMM/yyyy HH:mm:ss")+"') > CONVERT(DATETIME,d.dcAlpha2) AND CONVERT(DATETIME,'"+new Date(this.ScreenObject.GridData[s].dcAlpha3_Key).ToString("dd/MMM/yyyy HH:mm:ss")+"') < CONVERT(DATETIME,d.dcAlpha3))\n) ",D=a.a.common.GetDataSet("PAY007",JSON.stringify(d)).Tables[0];return null!=D&&D.length>0&&(o=D[0].VoucherNo.toString()),o}LoadDailyAttendanceDocuments(){this.ScreenObject.GridDataObj.Clear();let e="",t=n.e.GetEmptyDate(),s=n.e.GetEmptyDate(),i=n.e.GetEmptyDate(),r=n.e.GetEmptyDate();var l=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());if((null!=l&&null!=l&&l instanceof m.b||null!=l&&null!=l&&l instanceof C.a)&&(e=l.SelectedValue.toString()),""==e||0==parseInt(e))return this.DisplayMessage="Select any Employee",void(this.MessageVisibility=!0);var c=this.ScreenObject._TextFields.find(e=>"dcalpha10"==e.DBColumnName.toLowerCase());null!=c&&null!=c&&c instanceof d.c&&(n.e.IsEmpty(c.Date)||(t=new Date(c.Date)));var h=this.ScreenObject._TextFields.find(e=>"dcalpha11"==e.DBColumnName.toLowerCase());if(null!=h&&null!=h&&h instanceof d.c&&(n.e.IsEmpty(h.Date)||(s=new Date(h.Date))),1==t.getFullYear()||1==s.getFullYear())return this.DisplayMessage="Enter From / To Date.",void(this.MessageVisibility=!0);i=t,r=s;let u=this.CheckIsLateCheckInOrEarlyCheckOut(e),D="";if(null!=u&&u.length>0)for(let a=0;a<u.length;a++)D.length>0&&(D+=","),D+=u[a].sInvDocIDs;let S=this.ScreenObject.Data.Tables[0].filter(e=>"dcAlpha12"==e.SysColumnName);if(D.length>0){let i=a.a.common.GetDataTable("DOC056",e+"~"+t.ToString("dd/MMM/yyyy")+"~"+s.ToString("dd/MMM/yyyy")+"~"+D);if(null!=i&&i.length>0){let e=null,t=0;this.ScreenObject.Data.Tables[0].filter(e=>"ProductID"==e.SysColumnName);for(let s=0;s<i.length;s++){e=this.ScreenObject.GridDataObj.NewRow(),t++,e.dcAlpha1=i[s].VoucherNo,e.dcAlpha2=i[s].DocSeqNo,e.dcAlpha3=new Date(i[s].DailyAttDate).ToString(a.a.SessionManager.Preferences["Date Format"]),e.dcAlpha3_Key=new Date(i[s].DailyAttDate),e.dcAlpha4=new Date(i[s].StartTime).ToString("HH:mm"),e.dcAlpha4_Key=new Date(i[s].StartTime),e.dcAlpha5=new Date(i[s].EndTime).ToString("HH:mm"),e.dcAlpha5_Key=new Date(i[s].EndTime),e.dcCCNID73=i[s].ShiftName,e.dcCCNID73_Key=i[s].ShiftSeqNo,e.dcAlpha6=new Date(i[s].ShiftStartTime).ToString("HH:mm"),e.dcAlpha7=new Date(i[s].ShiftEndTime).ToString("HH:mm"),this.ScreenObject.Preferences.ContainsKey("SetUpdatedStartEndTimeToShiftTime")&&""!=this.ScreenObject.Preferences.SetUpdatedStartEndTimeToShiftTime&&Object(o.j)(this.ScreenObject.Preferences.SetUpdatedStartEndTimeToShiftTime)?(e.dcAlpha8=new Date(i[s].ShiftStartTime).ToString("HH:mm"),e.dcAlpha8_Key=new Date(i[s].ShiftStartTime),e.dcAlpha9=new Date(i[s].ShiftEndTime).ToString("HH:mm"),e.dcAlpha9_Key=new Date(i[s].ShiftEndTime)):(e.dcAlpha8=new Date(i[s].StartTime).ToString("HH:mm"),e.dcAlpha8_Key=new Date(i[s].StartTime),e.dcAlpha9=new Date(i[s].EndTime).ToString("HH:mm"),e.dcAlpha9_Key=new Date(i[s].EndTime)),null!=S&&S.length>0&&(e.dcAlpha12=S[0].UserDefaultValue);let n=u.filter(e=>e.sInvDocIDs==i[s].InvDocDetailsID);if(null!=n&&n.length>0){let t="";for(let e=0;e<n.length;e++)t.length>0&&(t+=","),t+=n[e].LateType.toString();e.dcAlpha13=t}this.FillDefaultProd(e,"dcAlpha1"),this.Celleditend(e,"dcAlpha1",0),this.ScreenObject.GridDataObj.addRow(e)}this.RefreshGrid=!this.RefreshGrid}}let b,p=a.a.common.GetDataTable("DOC060",e+"~"+i.ToString("dd MMM yyyy")+"~"+r.ToString("dd MMM yyyy")),y="";y+="  AND EmpSeqNo IN ("+e+")";let g=[];g.push(s.ToString("dd MMM yyyy")),g.push(y),g.push(0),g.push(a.a.SessionManager.RoleID),g.push(a.a.SessionManager.UserID),g.push(a.a.SessionManager.LanguageID);let O,I=a.a.common.GetDataSet_SP(g,"spPAY_GetEmpMasterCCDetails"),f=null;if(null!=I&&I.Tables.length>0){O=I.Tables[0];for(let e=0;e<I.Columns.length;e++){const t=I.Columns[e];t.Contains("CCNID")&&!t.Contains("Name")&&O.forEach(e=>{e["dc"+t+"_Key"]=e[t]})}O.forEach(e=>{e.dcCCNID51_Key=e.EmpSeqNo}),f=O.filter(t=>t.EmpSeqNo==e)}for(;i<=r;){if(null!=p&&p.length>0&&(b=p.filter(e=>e.FromDate>=i.ToString("dd MMM yyyy")&&e.ToDate<=i.ToString("dd MMM yyyy")||e.FromDate<=e.dtTempF.ToString("dd MMM yyyy")&&e.ToDate>=i.ToString("dd MMM yyyy")),null!=b&&b.length>0)){i=i.AddDays(1);continue}if(null!=f&&f.length>0&&(this.CheckEmployeeShift(e,i.ToString("dd MMM yyyy"),f[0]),null==this.objPayDayCheck&&(this.objPayDayCheck=new at.a(this.ScreenObject)),f[0].PayrollType="",this.objPayDayCheck.CheckIsHolidayDate(e,i.ToString("dd MMM yyyy"),f[0]),!n.e.IsEmpty(f[0].PayrollType))){i=i.AddDays(1);continue}let t=null,s=this.ScreenObject.GridData.length+1;t=this.ScreenObject.GridDataObj.NewRow(),s++,t.dcAlpha1="",t.dcAlpha2="",t.dcAlpha3=i.ToString(a.a.SessionManager.Preferences["Date Format"]),t.dcAlpha3_Key=i.ToString("dd MMM yyyy"),t.dcAlpha4="00:00",t.dcAlpha5="00:00",t.dcCCNID73="",t.dcCCNID73_Key=1,t.dcAlpha6="00:00",t.dcAlpha7="00:00",t.dcAlpha8="00:00",t.dcAlpha8_Key="00:00",t.dcAlpha9="00:00",t.dcAlpha9_Key="00:00",t.dcAlpha13="Absent",null!=S&&S.length>0&&(t.dcAlpha12=S[0].UserDefaultValue),this.FillDefaultProd(t,"dcAlpha1"),this.Celleditend(t,"dcAlpha1",0),i=i.AddDays(1),this.ScreenObject.GridDataObj.addRow(t)}this.RefreshGrid=!this.RefreshGrid}GetLOPLeaveDocuments(e,t,s){return a.a.common.GetDataSet3("PAY008",e.toString(),t.toString(),s.ToString("dd/MMM/yyyy"))}FillEarningsDeductions(e,t){try{let l=[],c=[],h=this.ScreenObject.GetPayrollComponents(3,1,e,new Date(t));if(h.Tables.length>0){var s=this.ScreenObject.ColumnSource.find(e=>"dcAlpha20"==e.ValueBinding);if(s&&h.Tables[1].length>0){for(let e=0;e<=h.Tables[1].length-1;e++)l.push(D.d.ComboBoxItems_2(h.Tables[1][e].NAME.toString(),h.Tables[1][e].NODEID.toString()));s.DisplayMember="Name",s.ValueMember="Value",s.ComboData=l}var i=this.ScreenObject.ColumnSource.find(e=>"dcAlpha21"==e.ValueBinding);if(i&&h.Tables[0].length>0){for(let e=0;e<=h.Tables[0].length-1;e++)c.push(D.d.ComboBoxItems_2(h.Tables[0][e].NAME.toString(),h.Tables[0][e].NODEID.toString()));i.DisplayMember="Name",i.ValueMember="Value",i.ComboData=c}}let u=null,d=0,S=null;if(h.Tables.length>0&&h.Tables[1].length>0){u=null,this.ScreenObject.GridDataObj.Clear();let e=this.ScreenObject.Data.Tables[0].filter(e=>"ProductID"==e.SysColumnName);for(let t=0;t<h.Tables[1].length;t++)u=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridDataObj.insertRowAt(u,d),d++,e.length>0&&!n.e.IsEmpty(e[0].UserDefaultValue)&&(u.ProductID_Key=e[0].UserDefaultValue),u.dcAlpha20=h.Tables[1][t].NODEID,S=h.Tables[1].filter(e=>e.NODEID==parseInt(u.dcAlpha20)),u.dcAlpha21=S[0].PARENTID;this.ScreenObject.GridDataObj.refreshDataView(),this.RefreshGrid=!0}var r;a.a.SessionManager.Preferences.ContainsKey("DonotConsiderVacationdaysasLeave")&&Object(o.j)("True"==a.a.SessionManager.Preferences.DonotConsiderVacationdaysasLeave)?(r=this.ScreenObject._TextFields.find(e=>"dcalpha17"==e.DBColumnName.toLowerCase()))instanceof D.e&&!n.e.IsEmpty(r.SelectedValue)&&(r.SelectedValue="Yes"):(r=this.ScreenObject._TextFields.find(e=>"dcalpha17"==e.DBColumnName.toLowerCase()))instanceof D.e&&!n.e.IsEmpty(r.SelectedValue)&&(r.SelectedValue="No")}catch(l){this.DisplayMessage="Load Error",Logger.ErrorLog("AddEditDocumentViewModel:: FillEarningsDeductions"+l.stack)}}FillVacationManagementComponents(){Logger.InfoLog("AddEditDocumentViewModel::Entering FillVacationManagementComponents");try{let t=[],s=this.ScreenObject.GetPayrollComponents(4,1,0,this.DocumentDate);if(s.Tables.length>0){var e=this.ScreenObject.ColumnSource.find(e=>"dcAlpha17"==e.ValueBinding);if(e&&s.Tables[0].length>0){for(let e=0;e<=s.Tables[0].length-1;e++)t.push(D.d.ComboBoxItems_2(s.Tables[0][e].NAME.toString(),s.Tables[0][e].NODEID.toString()));e.DisplayMember="Name",e.ValueMember="Value",e.ComboData=t}}}catch(t){this.DisplayMessage="Load Error",Logger.ErrorLog("AddEditDocumentViewModel:: FillVacationManagementComponents"+t.stack)}}FillForm12BALookupDetails(){Logger.InfoLog("AddEditDocumentViewModel::Entering FillForm12BALookupDetails");try{let t=[],s=null,i=0,a=0,r=this.ScreenObject.GetPayrollComponents(5,0,0,this.DocumentDate);if(r.Tables.length>0&&r.Tables[0].length>0){a=r.Tables[0].length,a+=1;let o=r.Tables[0].NewRow();o.NAME="Total Value of Perquisites",o.NODEID=a,r.Tables[0].Rows.push(o),a+=1,o=r.Tables[0].NewRow(),o.NAME="Total Value of Profits in lieu of salary as per section 17(3)",o.NODEID=a,r.Tables[0].Rows.push(o);var e=this.ScreenObject.ColumnSource.find(e=>"dcAlpha2"==e.ValueBinding);if(e){for(let e=0;e<=r.Tables[0].length-1;e++)t.push(D.d.ComboBoxItems_2(r.Tables[0][e].NAME.toString(),r.Tables[0][e].NODEID.toString()));e.DisplayMember="Name",e.ValueMember="Value",e.ComboData=t}s=null,this.ScreenObject.GridDataObj.Clear();let l=this.ScreenObject.Data.Tables[0].filter(e=>"ProductID"==e.SysColumnName);for(let e=0;e<r.Tables[0].length;e++)s=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridDataObj.insertRowAt(s,i),i++,l.length>0&&!n.e.IsEmpty(l[0].UserDefaultValue)&&(s.ProductID_Key=l[0].UserDefaultValue),s.dcAlpha2=r.Tables[0][e].NODEID,s.dcAlpha3="Total Value of Perquisites"==r.Tables[0][e].NAME.toString()?-1:"Total Value of Profits in lieu of salary as per section 17(3)"==r.Tables[0][e].NAME.toString()?-2:0;this.ScreenObject.GridDataObj.refreshDataView()}this.ScreenObject.GridDataObj.CanUserAddRows=!1,this.ScreenObject.GridDataObj.CanUserDeleteRows=!1}catch(t){this.DisplayMessage="Load Error",Logger.ErrorLog("AddEditDocumentViewModel:: FillForm12BALookupDetails"+t.stack)}}GetITSlabValidation(e,t=null){let s="",i=null;0==e?i=t.Table.Copy():1==e&&(i=this.ScreenObject.GridData.Copy()),i.sort((e,t)=>t.dcAlpha8-e.dcAlpha8);for(let a=1;a<i.length-1;a++)if(null!=i[a].dcAlpha8&&null!=i[a].dcNum1&&null!=i[a].dcNum2){if(i[a].dcAlpha8.toString()==i[a-1].dcAlpha8.toString()&&parseFloat(i[a].dcNum1)<=parseFloat(i[a-1].dcNum2)){s="From Slab should be greater than To Slab for gender '"+i[a].dcAlpha8.toString()+"'\r\n";break}if(i[a].dcAlpha8.toString()==i[a].dcAlpha8.toString()&&parseFloat(i[a].dcNum2)<=parseFloat(i[a].dcNum1)){s="To Slab should be greater than From Slab for gender '"+i[a].dcAlpha8.toString()+"'\r\n";break}}return s}FillGratuitySettingsExpDetails(){Logger.InfoLog("AddEditDocumentViewModel::Entering FillGratuitySettingsExpDetails");try{let t=[],s=[],i=null,a=0,r=this.ScreenObject.GetPayrollComponents(6,0,0,this.DocumentDate);if(r.Tables.length>0&&r.Tables[0].length>0){var e=this.ScreenObject.ColumnSource.find(e=>"dcAlpha5"==e.ValueBinding);if(e){for(let e=0;e<=r.Tables[0].length-1;e++)t.push(D.d.ComboBoxItems_2(r.Tables[0][e].NAME.toString(),r.Tables[0][e].NODEID.toString()));e.DisplayMember="Name",e.ValueMember="Value",e.ComboData=t}if(e=this.ScreenObject.ColumnSource.find(e=>"dcAlpha9"==e.ValueBinding)){for(let e=0;e<=r.Tables[0].length-1;e++)s.push(D.d.ComboBoxItems_2(r.Tables[0][e].NAME.toString(),r.Tables[0][e].NODEID.toString()));e.DisplayMember="Name",e.ValueMember="Value",e.ComboData=s}i=null,this.ScreenObject.GridDataObj.Clear();let o=this.ScreenObject.Data.Tables[0].filter(e=>"ProductID"==e.SysColumnName);for(let e=0;e<r.Tables[0].length;e++)i=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridDataObj.insertRowAt(i,a),a++,o.length>0&&!n.e.IsEmpty(o[0].UserDefaultValue)&&(i.ProductID_Key=o[0].UserDefaultValue),i.dcAlpha5=r.Tables[0][e].NODEID,i.dcAlpha6=0,i.dcAlpha9=r.Tables[0][e].NODEID,i.dcAlpha10=0;this.ScreenObject.GridDataObj.refreshDataView()}this.ScreenObject.GridDataObj.CanUserAddRows=!1,this.ScreenObject.GridDataObj.CanUserDeleteRows=!1}catch(t){this.DisplayMessage="Load Error",Logger.ErrorLog("AddEditDocumentViewModel:: FillGratuitySettingsExpDetails"+t.stack)}}FillTdsMonthlyandQuarterlyDetails(e,t,s,i){try{let e=null,t=0,r=new Date(i,a.a.SessionManager.AccountingFromMonth-1,1),o=this.ScreenObject.GetTDSMonthlyandQuarterlyDetails(s,i,r);if(o.Tables.length>0&&o.Tables[0].length>0){e=null,this.ScreenObject.GridDataObj.Clear();let s=this.ScreenObject.Data.Tables[0].filter(e=>"ProductID"==e.SysColumnName);for(let i=0;i<o.Tables[0].length;i++)e=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridDataObj.insertRowAt(e,t),t++,s.length>0&&!n.e.IsEmpty(s[0].UserDefaultValue)&&(e.ProductID_Key=s[0].UserDefaultValue),e.dcAlpha2=o.Tables[0][i].TDSTYPE,parseInt(o.Tables[0][i].QUARTERNO)>0?(e.dcAlpha3=new Date(o.Tables[0][i].PayrollDate).ToString("MMM'-'yyyy"),e.dcNum5=parseFloat(o.Tables[0][i].AMOUNT),e.dcNum6=0):(e.dcAlpha3=o.Tables[0][i].MONTHTEXT,e.dcNum6=parseFloat(o.Tables[0][i].AMOUNT),e.dcNum5=0),e.dcAlpha10=o.Tables[0][i].QUARTERNO,e.dcNum1=parseFloat(o.Tables[0][i].TDS),e.dcNum2=parseFloat(o.Tables[0][i].SURCHARGE),e.dcNum3=parseFloat(o.Tables[0][i].EDUCATIONCESS),e.dcNum4=parseFloat(o.Tables[0][i].SECANDHIGHEDUCESS)}}catch(r){this.DisplayMessage="Load Error",Logger.ErrorLog("AddEditDocumentViewModel:: FillTdsMonthlyandQuarterlyDetails"+r.stack)}}FilterEmployees(){let e="";try{Logger.InfoLog("AddEditDocumentViewModel::Entering FilterEmployees()"),e=69==this.DocumentType?" ( a.StatusID=250) ":" ( a.StatusID=250 AND DATEDIFF(DAY,GETDATE(),ISNULL(CONVERT(DATETIME,a.DORelieve),'01-Jan-9000'))>=0) ",a.a.SessionManager.LocationID>0&&a.a.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&a.a.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(e=e+" AND a.NodeID IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+a.a.SessionManager.LocationID+")"),67==this.DocumentType&&(n.e.IsEmpty(a.a.SessionManager.sWHEmpFilteredEmpSeqNos)||(e+=" AND ( a.NodeID IN ("+a.a.SessionManager.sWHEmpFilteredEmpSeqNos+"))")),Logger.InfoLog("AddEditDocumentViewModel::Exiting FilterEmployees()")}catch(t){Logger.ErrorLog("AddEditDocumentViewModel::EXCEPTION FilterEmployees()"+t.stack)}return e}FilterLeaveTypes(e){let t="";try{0==e?(t=" ( a.ParentID=5 and Convert(Varchar,a.NodeId)  NOT IN (Select Isnull(TD.dcAlpha1,'0') From Com_DocTextData TD with(nolock),Inv_DocDetails ID with(nolock) Where ID.InvDocDetailsID=TD.InvDocDetailsID And ID.CostCenterID=40061)) ",a.a.SessionManager.IsEmpUser&&(t+=" AND (a.NodeID in (Select ComponentID from Com_CC50054  with(nolock) where  GradeID=1 AND Type=4 and ShowInESS='Yes' And Convert(Datetime,Payrolldate)=(Select Max(Convert(Datetime,Payrolldate)) from Com_CC50054 with(nolock) WHERE GradeID=1)))")):1==e?t=" ( a.ParentID=5 and a.NodeId  NOT IN (Select Isnull(CC.dcCCnid52,'0') From Com_DocCCData CC with(nolock),Inv_DocDetails ID with(nolock) Where ID.InvDocDetailsID=CC.InvDocDetailsID And ID.CostCenterID IN(40060,40081))) ":2==e?t=" 1=1\n                AND\n                (\n                a.NodeID IN(Select ComponentID FROM COM_CC50054 \n                WHERE GradeID=1 AND TYPE=4 \n                AND PayrollDate=(SELECT MAX(PayrollDate) FROM COM_CC50054 )\n                AND LeaveOthFeatures LIKE '%#REJOIN#%' )\n                OR a.NodeID IN(Select DISTINCT CONVERT(INT,Isnull(TD.dcAlpha1,'0')) From Com_DocTextData TD with(nolock),Inv_DocDetails ID with(nolock) \n                Where TD.tCostCenterID=40061 AND ISNUMERIC(TD.dcAlpha1)=1 AND ID.InvDocDetailsID=TD.InvDocDetailsID )\n                )":3==e&&(t=a.a.SessionManager.Preferences.ContainsKey("ConsiderLOPBasedOn")&&""!=a.a.SessionManager.Preferences.ConsiderLOPBasedOn.toString()?" 1=1 AND ( a.NodeID IN("+a.a.SessionManager.Preferences.ConsiderLOPBasedOn.toString()+") )":" 1<>1 ")}catch(s){Logger.ErrorLog("AddEditDocumentViewModel::EXCEPTION FilterLeaveTypes()"+s.stack)}return t}PopupEmployeesFilter(e,t=""){if(null!=this.srcDocument&&("Biometric"==this.srcDocument.toString()||"PostAttTimeSheet"==this.srcDocument.toString()))return"";let s=e.split("~")[1];e=e.split("~")[0],this.strWhere="",this.sFilter="",this.sNodes="";try{67==this.ScreenObject.DocumentType&&a.a.SessionManager.Preferences.ContainsKey("DailyAttendanceFilter")&&parseInt(a.a.SessionManager.Preferences.DailyAttendanceFilter)>0?(null==this.oEmpFilter?this.oEmpFilter=new xt.a("",0,5):(this.oEmpFilter.CostCenterFilters.length>0?this.oEmpFilter.CostCenters.SelectedValue=this.oEmpFilter.CostCenterFilters[0].CostCenterID.toString():(this.oEmpFilter.Filter=5,this.oEmpFilter.InitControls()),this.oEmpFilter.CostCenters.Enable=!0),a.a.page.ShowDialog(this.oEmpFilter,_t.a,{ShowCenter:!0,HideHeader:!0}).subscribe(()=>{this.empFilterTemp(),this.PopupEmpFilterCallBack(t,e)})):85==this.ScreenObject.DocumentType?(null==this.oEmpFilter?this.oEmpFilter=new xt.a("",0,85):(this.oEmpFilter.CostCenterFilters.length>0?this.oEmpFilter.CostCenters.SelectedValue=this.oEmpFilter.CostCenterFilters[0].CostCenterID.toString():(this.oEmpFilter.Filter=85,this.oEmpFilter.InitControls()),this.oEmpFilter.CostCenters.Enable=!0),a.a.page.ShowDialog(this.oEmpFilter,_t.a,{ShowCenter:!0,HideHeader:!0}).subscribe(()=>{this.empFilterTemp(),this.PopupEmpFilterCallBack(t,e)})):null==this.oEmpFilter?this.oEmpFilter=new xt.a("",0,81==this.ScreenObject.DocumentType&&"GradeWise"==e.toString()?6:7):(81!=this.ScreenObject.DocumentType||"GradeWise"!=e.toString()&&"GradeWiseCopy"!=e.toString()?81==this.ScreenObject.DocumentType&&"EmployeeWise"==e.toString()&&(this.oEmpFilter.Filter=7):this.oEmpFilter.Filter=6,this.oEmpFilter.InitControls()),81==this.ScreenObject.DocumentType&&(this.oEmpFilter.CostCenters.Enable=!1,"GradeWiseCopy"!=e.toString()&&a.a.page.ShowDialog(this.oEmpFilter,_t.a,{ShowCenter:!0,HideHeader:!0}).subscribe(()=>{this.empFilterTemp(),this.PopupEmpFilterCallBack(t,e+"~"+s)})),Logger.InfoLog("AddEditDocumentViewModel::Exiting PopupEmployeesFilter()")}catch(i){Logger.ErrorLog("AddEditDocumentViewModel::EXCEPTION PopupEmployeesFilter()"+i.stack)}return this.strWhere}empFilterTemp(){if(this.DialogResult=this.oEmpFilter.IsCompleted,this.oEmpFilter.IsCompleted)if(this.oEmpFilter.CostCenterFilters.length>0){let e=1,t="",s="",i="";for(let a=0;a<this.oEmpFilter.CostCenterFilters.length;a++){let n=this.oEmpFilter.CostCenterFilters[a];if(n.CostCenterID>5e4&&(e=2,t="NodeID",s=50051==n.CostCenterID?"EmpSeqNo":"CCNID"+(n.CostCenterID-5e4)),n.SelectedNodes.length>0){if(1==n.SelectedNodes.length)i+=" AND ",i+=s+"="+n.SelectedNodes[0].Id;else if(!n.SelectedNodes.find(t=>t.Id==e&&t.IsGroup))if(i+=" AND ",yt.IPrefetchFilter.IsGroupTree(n)){let e="";for(let t=0;t<n.SelectedNodes.length;t++)null!=n.SelectedNodes[t].Parent&&n.SelectedNodes[t].Parent.IsSelected||(e.length>0&&(e+=","),e+=n.SelectedNodes[t].Id);0==e.length&&(e+=-12912),i+=s+" IN ",i+=" (select T."+t+" GTID from "+es.GetTagTableName(n.CostCenterID)+" T with(nolock),"+es.GetTagTableName(n.CostCenterID)+" GTP with(nolock) where T.lft BETWEEN GTP.lft AND GTP.rgt AND GTP."+t+" IN (",i+=e.toString()+")  group by T."+t+")"}else{i+=s+" IN (";for(let e=0;e<n.SelectedNodes.length;e++)e>0&&(i+=","),i+=n.SelectedNodes[e].Id;i+=")"}}else n.DeleteButtonVisibility||(i+=" AND ",i+=s+"=-12912")}this.sFilter=i.toString(),this.sFilter+=" AND ( CONVERT(DATETIME,EMP.DOJ) <='"+a.a.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")+"' AND CONVERT(DATETIME,EMP.DORelieve) >='"+a.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"' ) ",a.a.SessionManager.Preferences.ContainsKey("NPDontAllowPayrollProcessing")&&"True"==a.a.SessionManager.Preferences.NPDontAllowPayrollProcessing&&(this.sFilter+=" AND EmpSeqNo NOT IN ( Select NodeID From COM_CC50051 WITH(NOLOCK) Where ResignStatus='Posted' AND DateDiff(day,ISNULL(CONVERT(DATETIME,DORelieve),'01-Jan-9000'),'"+a.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')<=0 AND DateDiff(day,CONVERT(DATETIME,CONVERT(DATETIME,('01-'+CONVERT(NVARCHAR(3),DATENAME(MONTH,ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000')))+'-'+CONVERT(NVARCHAR,YEAR(ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000'))))) ),'"+a.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')>=0 )"),a.a.SessionManager.LocationID>0&&a.a.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&a.a.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+a.a.SessionManager.LocationID+")"),n.e.IsEmpty(a.a.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sFilter+="  AND EmpSeqNo IN ("+a.a.SessionManager.sWHEmpFilteredEmpSeqNos+")");let r=[];if(r.push(a.a.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")),r.push(this.sFilter),r.push(0),r.push(a.a.SessionManager.RoleID),r.push(a.a.SessionManager.UserID),r.push(a.a.SessionManager.LanguageID),this.dsData=a.a.common.GetDataSet_SP(r,"spPAY_GetEmpMasterCCDetails"),this.dsData.Tables.length>0)if(this.dsData.Tables[0].length>0){for(let e=0;e<this.dsData.Tables[0].length;e++)this.sNodes=this.sNodes+this.dsData.Tables[0][e].EmpSeqNo.toString()+",";""!=this.sNodes&&(this.sNodes=this.sNodes.substr(0,this.sNodes.length-1),this.strWhere=" ( a.NodeId IN ("+this.sNodes+"))")}else this.strWhere=" ( a.NodeId = 0)"}else 81==this.ScreenObject.DocumentType?this.strWhere="":this.oEmpFilter.Filter>0&&(this.strWhere=this.FilterEmployees())}DailyAttendanceFilterTemp(){this.strEmpFilter=this.strWhere;let e=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());if(e&&e instanceof m.b)e.CustomWhere=this.strEmpFilter;else if(e&&e instanceof C.a)e.Code.CustomWhere=e.Name.CustomWhere=this.strEmpFilter;else if(e=this.ScreenObject._TextFields.find(e=>"dcalpha5"==e.DBColumnName.toLowerCase()),e&&e instanceof m.b&&50051==e.CCID)e.CustomWhere=this.strEmpFilter;else if(e&&e instanceof C.a&&50051==e.CCID)e.Name.CustomWhere=e.Code.CustomWhere=this.strEmpFilter;else{let e=this.ScreenObject.ColumnSource.find(e=>50051==e.CostCenterID&&"dcCCNID51"==e.DisplayMember);e&&e instanceof y.a&&(e.FilterCondition=this.strEmpFilter),this.ScreenObject.GridDataColumns.Contains("dcCCNID51Code")&&(e=this.ScreenObject.ColumnSource.find(e=>"dcccnid51code"==e.DisplayMember.toLowerCase()),e&&e instanceof y.a&&(e.FilterCondition=this.strEmpFilter))}this.ScreenObject.ColumnSource.sort((e,t)=>e.DisplayIndex-t.DisplayIndex),this.ScreenObject.GridDataObj.RefreshColumns()}LoadGradeDataTemp(e,t){let s,i=t.split("~")[0],r=new Date(t.split("~")[1]);s=[];let o,l=[],c=[],h=this.ScreenObject.ColumnSource.find(e=>50051==e.CostCenterID),u=this.ScreenObject.ColumnSource.find(e=>50053==e.CostCenterID);if(0==e.trim().length&&(e=" 1=1 "),a.a.SessionManager.LocationID>0&&a.a.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&a.a.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(e+=" AND a.NodeID IN ( Select 1 as NodeID UNION ALL Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+a.a.SessionManager.LocationID+")"),n.e.IsEmpty(a.a.SessionManager.sWHEmpFilteredEmpSeqNos)||(e+=" AND ( a.NodeID IN ("+a.a.SessionManager.sWHEmpFilteredEmpSeqNos+"))"),c.push("GradeWise"),c.push(e),c.push(new Date(r.ToString("dd/MMM/yyyy"))),c.push(a.a.SessionManager.UserID),c.push(a.a.SessionManager.LanguageID),o=a.a.empService.GetAssignLeaves(c),null!=o&&o.Tables.length>0&&o.Tables[0].length>0&&!o.Columns[0].Contains("ErrorMessage")){let e=o.Tables[0];for(let t=0;t<this.ScreenObject._CCFields.length;t++){let s=this.ScreenObject._CCFields[t];if(s instanceof m.b&&50002==s.CCID&&s.SelectedValue>0){l=o.Tables[0],e=l.filter(e=>0==e.Location||e.Location==s.SelectedValue);break}}if(s=e,"GradeWise"==i?(h&&h instanceof y.a&&(h.IsVisible=!1),u&&u instanceof y.a&&(u.IsVisible=!0),s=e.filter(e=>1!=e.dcCCNID51_Key),s.sort((e,t)=>e.dcCCNID51_Key>t.dcCCNID51_Key||e.dcCCNID51_Key==t.dcCCNID51_Key&&e.dcCCNID52_Key>t.dcCCNID52_Key?1:-1),this.dtData=s.Copy(),s=e.filter(e=>1==e.dcCCNID51_Key),s.sort((e,t)=>e.dcCCNID53_Key>t.dcCCNID53_Key||e.dcCCNID53_Key==t.dcCCNID53_Key&&e.dcCCNID52_Key>t.dcCCNID52_Key?1:-1),s=s.Copy()):"EmployeeWise"==i&&(h&&h instanceof y.a&&(h.IsVisible=!0),u&&u instanceof y.a&&(u.IsVisible=!1),s=e.filter(e=>1==e.dcCCNID51_Key),s.sort((e,t)=>e.dcCCNID53_Key>t.dcCCNID53_Key||e.dcCCNID53_Key==t.dcCCNID53_Key&&e.dcCCNID52_Key>t.dcCCNID52_Key?1:-1),this.dtData=s.Copy(),s=e.filter(e=>1!=e.dcCCNID51_Key),s.sort((e,t)=>e.dcCCNID51_Key>t.dcCCNID51_Key||e.dcCCNID51_Key==t.dcCCNID51_Key&&e.dcCCNID52_Key>t.dcCCNID52_Key?1:-1),s=s.Copy()),this.ScreenObject.GridDataObj.Clear(),this.ScreenObject.GridDataObj.ClearFilters(),s.length>0)for(let t=0;t<s.length;t++){let e=this.ScreenObject.GridDataObj.NewRow();this.ScreenObject.GridData.InsertAt(e,t),e.ProductID_Key=parseInt(a.a.SessionManager.Preferences.PayrollProduct),e.dcCCNID51_Key=s[t].dcCCNID51_Key.toString(),e.dcCCNID52_Key=s[t].dcCCNID52_Key.toString(),e.dcCCNID53_Key=s[t].dcCCNID53_Key.toString(),e.dcNum3=0}else for(let t=0;t<12;t++){let e=this.ScreenObject.GridDataObj.NewRow();e.DocSeqNo=this.ScreenObject.GridData.length+1,e.DocDetailsID=0,this.ScreenObject.GridData.push(e)}Logger.InfoLog("AssignLeavesViewModel::End Binding Grade data to grid")}this.ScreenObject.GridDataObj.refreshDataView(),this.ScreenObject.UpdateSequence(),this.RefreshGrid=!0,this.ScreenObject.GridDataObj.RefreshColumns()}PopupEmpFilterCallBack(e,t){if("DailyAttendanceFilter"==e)this.DailyAttendanceFilterTemp();else if("SetNewDocFields"==e){let e=this.strEmpFilter=this.strWhere;n.e.IsEmpty(e)&&(e=this.FilterEmployees()),this.SetNewDocFieldsTemp(e)}else if("LoadGradeData"==e){let e=this.strEmpFilter=this.strWhere;this.LoadGradeDataTemp(e,t)}}static GetTagTableName(e){return 2==e?"ACC_Accounts":3==e?"INV_Product":7==e?"ADM_Users":50001==e?"COM_Division":50002==e?"COM_Location":50003==e?"COM_Branch":50004==e?"COM_Department":50005==e?"COM_Salesman":50006==e?"COM_Category":50007==e?"COM_Area":50008==e?"COM_Teritory":"COM_CC"+e}IsLeaveTypeValid(e,t,s,i){i.IfFormulaExistsNoOfDays=!1;let r="";this.strValidationMessage="";try{let o,l=null;if(l=this.ScreenObject.GetEmployeePayrollInfo(e,0,this.DocumentDate,0),l.Tables.length>0&&l.Tables[1].length>0){if(o=l.Tables[1].filter(e=>4==e.Type&&e.LeaveOthFeatures.Contains("%#REJOIN#%")),o.length>0)for(let t=0;t<o.length;t++){let s=a.a.common.GetDataSet3("PAY010",e.toString(),o[t].ComponentID.toString()).Tables[0];if(null!=s&&s.length>0)return this.strValidationMessage="Please enter Rejoining date of this Employee to the Leave Type : "+o[t].ComponentName.toString(),this.strValidationMessage}if(62==this.DocumentType){let c=new ct.b;c.sEmpSeqNo=e.toString();let h={PayrollMonth:c.PayrollMonth,PayrollMonthStart:c.PayrollMonthStart,PayrollMonthEnd:c.PayrollMonthEnd};n.e.SetPayrollDate(this.DocumentDate,h),c.PayrollMonth=h.PayrollMonth,c.PayrollMonthStart=h.PayrollMonthStart,c.PayrollMonthEnd=h.PayrollMonthEnd,c.arrLstCPFields[6].Clear(),l.Tables[2].filter(e=>4==e.Type&&""!=n.e.String(e.formula)&&e.ComponentID==t);let u=new ct.a;if(o.length>0){for(let s=0;s<o.length;s++)u.ComponentName=o[s].LeaveErrorMessage.toString(),u.SNo=parseInt(o[s].SNo.toString()),u.Formula=o[s].Formula.toString(),c.arrLstCPFields[6].push(u);c.Intialize(),c.ExecuteAllFormulas();let e=this.DocumentDate;c.fldDict.ContainsKey("LeaveFromDate")&&(n.e.IsEmpty(s.dcAlpha4_Key)?c.fldDict.LeaveFromDate.setFieldValue(this.DocumentDate):(c.fldDict.LeaveFromDate.setFieldValue(new Date(s.dcAlpha4_Key)),e=new Date(s.dcAlpha4_Key))),c.fldDict.ContainsKey("LeaveNoOfDays")&&(n.e.IsEmpty(s.dcAlpha7)?c.fldDict.LeaveNoOfDays.setFieldValue(0):c.fldDict.LeaveNoOfDays.setFieldValue(s.dcAlpha7.toString()));let t=c.fldDict;for(let s=0;s<c.arrLstCPFields[6].length;s++){for(let t=0;t<c.arrLstCPFields[5].length;t++)if(null!=c.arrLstCPFields[6][s].Formula&&c.arrLstCPFields[6][s].Formula.Contains(c.arrLstCPFields[5][t].ComponentName+"_Bal")&&c.fldDict.ContainsKey(c.arrLstCPFields[5][t].ComponentName+"_Bal")){let s=a.a.common.GetDataSet3("PAY044",c.sEmpSeqNo.toString(),c.arrLstCPFields[5][t].ComponentID,e.ToString("dd/MMM/yyyy"));null!=s&&s.length>0&&c.fldDict[c.arrLstCPFields[5][t].ComponentName+"_Bal"].setFieldValue(s[0].AvailableLeaves.toString())}null!=c.arrLstCPFields[6][s].Formula&&(c.arrLstCPFields[6][s].Formula.Contains("LeaveFromDate")||c.arrLstCPFields[6][s].Formula.Contains("LeaveNoOfDays"))&&(i.IfFormulaExistsNoOfDays=!0),r=n.e.String(c.eval.EvaluateExpression(c.arrLstCPFields[6][s].Formula.toString(),t)),"0"==r&&(this.strValidationMessage=c.arrLstCPFields[6][s].ComponentName.toString());break}}else this.strValidationMessage=""}}else this.strValidationMessage="Please check the payroll structure";Logger.InfoLog("AddEditDocumentViewModel::Exiting IsLeaveTypeValid()")}catch(o){Logger.ErrorLog("AddEditDocumentViewModel::EXCEPTION IsLeaveTypeValid()"+o.stack)}return this.strValidationMessage}IsDateValid(e,t){try{Logger.InfoLog("AddEditDocumentViewModel::Entering IsDateValid()");let a=null,r=0,o=Date.Today();this.strValidationMessage="";var s=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());s&&s instanceof m.b||s&&s instanceof C.a||(s=this.ScreenObject._TextFields.find(e=>"dcalpha5"==e.DBColumnName.toLowerCase()))&&s instanceof m.b&&50051==s.CCID||s&&s instanceof C.a&&50051==s.CCID?r=s.SelectedValue:(i=this.ScreenObject.ColumnSource.find(e=>50051==e.CostCenterID))instanceof y.a&&!n.e.IsEmpty(e[i.ValueMember])&&(r=parseInt(e[i.ValueMember]));let l="";var i;40055!=this.ScreenObject.CostCenterID||"dcalpha1"!=t.toLowerCase()||n.e.IsEmpty(e.dcAlpha1)?40056==this.ScreenObject.CostCenterID?l="dcalpha5":40057!=this.ScreenObject.CostCenterID||"dcalpha5"!=t.toLowerCase()||n.e.IsEmpty(e.dcAlpha5)?40057!=this.ScreenObject.CostCenterID||"dcalpha4"!=t.toLowerCase()||n.e.IsEmpty(e.dcAlpha4)?40069==this.ScreenObject.CostCenterID&&(l=t.toLowerCase()):l="dcalpha4":l="dcalpha5":l="dcalpha1",(s=this.ScreenObject._TextFields.find(e=>e.DBColumnName.toLowerCase()==l))instanceof d.c?o=new Date(s.Date):(i=this.ScreenObject.ColumnSource.find(e=>e.DisplayMember.toLowerCase()==l))instanceof y.a&&(o=new Date(e[i.DisplayMember+"_key"])),a=this.ScreenObject.GetEmployeePayrollInfo(r,3,o,0),a.Tables.length>0&&a.Tables[0].length>0&&(this.strValidationMessage=n.e.String(a.Tables[0][0][0])),Logger.InfoLog("AddEditDocumentViewModel::Exiting IsDateValid()")}catch(a){Logger.ErrorLog("AddEditDocumentViewModel::EXCEPTION IsDateValid()"+a.stack)}return this.strValidationMessage}IsDocumentLocked(e,t,s){try{let s=0,r=Date.Today();this.strValidationMessage="";var i=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());if(i&&i instanceof m.b)s=i.SelectedValue;else if(i&&i instanceof C.a)s=i.SelectedValue;else if((i=this.ScreenObject._TextFields.find(e=>"dcalpha5"==e.DBColumnName.toLowerCase()))&&i instanceof m.b&&50051==i.CCID)s=i.SelectedValue;else if(i&&i instanceof C.a&&50051==i.CCID)s=i.SelectedValue;else{var a;null!=(a=this.ScreenObject.ColumnSource.find(e=>50051==e.CostCenterID))&&a instanceof y.a&&(s=parseInt(e[a.ValueMember]))}if((i=this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase()))instanceof d.c?r=new Date(i.Date):null!=(a=this.ScreenObject.ColumnSource.find(e=>"dcalpha1"==e.DisplayMember.toLowerCase()))&&a instanceof y.a&&(r=n.e.IsEmpty(e[a.DisplayMember+"_key"])?Date.Today():new Date(e[a.DisplayMember+"_key"])),this.dsData=this.ScreenObject.GetEmpDimensionDetails(s,t,r),this.dsData.Tables.length>0&&this.dsData.Tables[0].length>0){this.strValidationMessage="Payroll Month Locked",e.dcAlpha2=e.dcAlpha2_Key=e.dcAlpha3=e.dcAlpha3_Key="";for(let t=1;t<16;t++)e["dcNum"+t]=0;this.ScreenObject.GridDataObj.updateRow(e)}Logger.InfoLog("AddEditDocumentViewModel::Exiting IsDocumentLocked()")}catch(r){Logger.ErrorLog("AddEditDocumentViewModel::EXCEPTION IsDocumentLocked()"+r.stack)}return this.strValidationMessage}OnYearSelected(e){try{Logger.InfoLog("AddEditDocumentViewModel::Entering OnYearSelected()");var t=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase());if(null!=t&&t instanceof D.e&&!n.e.IsEmpty(t.SelectedValue)&&(this.LoadLeaveyearDates(parseInt(t.SelectedValue)),null!=(t=this.ScreenObject._TextFields.find(e=>"dcalpha3"==e.DBColumnName.toLowerCase()))&&t instanceof d.c&&t.Date)){var s=this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase());null!=s&&s instanceof D.e&&!n.e.IsEmpty(s.SelectedValue)&&(this.IsNewAssignLeave?this.LoadGradeDataNew(0,new Date(t.Date),s.SelectedValue.toString(),null):this.LoadGradeData(0,new Date(t.Date),s.SelectedValue.toString()))}Logger.InfoLog("AddEditDocumentViewModel::Exiting OnYearSelected()")}catch(i){Logger.ErrorLog("AddEditDocumentViewModel::EXCEPTION OnYearSelected()"+i.stack)}}LeavesBasedon(e){let t="";var s=this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase());if(null!=s&&s instanceof D.e&&!n.e.IsEmpty(s.SelectedValue)&&(t=s.SelectedValue),!n.e.IsEmpty(t)){var i=this.ScreenObject._TextFields.find(e=>"dcalpha3"==e.DBColumnName.toLowerCase());null!=i&&i instanceof d.c&&i.Date?this.IsNewAssignLeave?this.LoadGradeDataNew(this.DocID>0?1:0,new Date(i.Date),t,null):this.LoadGradeData(this.DocID>0?1:0,new Date(i.Date),t):this.IsNewAssignLeave?this.LoadGradeDataNew(this.DocID>0?1:0,new Date,t,null):this.LoadGradeData(this.DocID>0?1:0,new Date,t)}}FillComponent(e){for(let a=this.ScreenObject.ColumnSource.length-1;a>=0;a--)null==this.ScreenObject.ColumnSource[a].DisplayMember||""==this.ScreenObject.ColumnSource[a].DisplayMember||"dcCCNID52"!=this.ScreenObject.ColumnSource[a].DisplayMember&&"LeaveComp"!=this.ScreenObject.ColumnSource[a].DrRefColName||("dcCCNID52"==this.ScreenObject.ColumnSource[a].DisplayMember?(this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.ColumnSource[a].DisplayMember)&&this.ScreenObject.GridDataColumns.Remove(this.ScreenObject.ColumnSource[a].DisplayMember),this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.ColumnSource[a].DisplayMember+"_Key")&&this.ScreenObject.GridDataColumns.Remove(this.ScreenObject.ColumnSource[a].DisplayMember+"_Key")):this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.ColumnSource[a].DisplayMember)&&this.ScreenObject.GridDataColumns.Remove(this.ScreenObject.ColumnSource[a].DisplayMember),this.ScreenObject.ColumnSource.RemoveAt(a));let t=-1,s=[];for(let a=0;a<this.ScreenObject.ColumnSource.length;a++)"LineNarration"==this.ScreenObject.ColumnSource[a].DisplayMember&&(t=a,this.ScreenObject.ColumnSource[a].Width=150),null!=this.ScreenObject.ColumnSource[a].DrRefColName&&""!=this.ScreenObject.ColumnSource[a].DrRefColName||"LeaveComp"==this.ScreenObject.ColumnSource[a].DrRefColName||s.push(this.ScreenObject.ColumnSource[a]);t<0&&(t=s.length);let i=null;for(let a=0;a<e.length;a++)i=new y.a,i.Header=e[a].Name.toString(),i.DisplayMember="dcNum"+e[a].SNo.toString(),i.ID=e[a].SNo.toString(),i.DrRefColName="LeaveComp",i.DataType="FLOAT",i.IsCalculated=1,i.IsColumnUserDefined=!0,i.Width=90,this.ScreenObject.GridDataColumns.Contains(i.DisplayMember)||this.ScreenObject.GridDataColumns.push(i.DisplayMember),this.ScreenObject.GridDataColumns.Contains("dcCalc"+i.DisplayMember)||this.ScreenObject.GridDataColumns.push("dcCalc"+i.DisplayMember),this.ScreenObject.GridDataColumns.Contains("default"+i.DisplayMember)||this.ScreenObject.GridDataColumns.push("default"+i.DisplayMember),s.Insert(t,i),t++;this.ScreenObject.ColumnSource=s}LoadGradeDataNew(e,t,s,i){let r,o="";if(0==e||2==e){r=[];let e=[];if(this.dtData=null,null==this.ScreenObject)return;if(this.DocID>0)return;if(""==s.toString())return;Logger.InfoLog("AssignLeavesViewModel::Start Loading Grade data");let i=[];this.dsData=[];let l=this.ScreenObject.ColumnSource.find(e=>50051==e.CostCenterID),c=this.ScreenObject.ColumnSource.find(e=>50053==e.CostCenterID);if(a.a.SessionManager.Preferences.ContainsKey("AssignLeavesFilter")&&"True"==a.a.SessionManager.Preferences.AssignLeavesFilter.toString()&&(o=this.PopupEmployeesFilter(s)),0==o.Trim().length&&(o=" 1=1 "),a.a.SessionManager.LocationID>0&&a.a.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&a.a.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(o+=" AND a.NodeID IN ( Select 1 as NodeID UNION ALL Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+a.a.SessionManager.LocationID+")"),n.e.IsEmpty(a.a.SessionManager.sWHEmpFilteredEmpSeqNos)||(o+=" AND ( a.NodeID IN ("+a.a.SessionManager.sWHEmpFilteredEmpSeqNos+"))"),i.push("GradeWise"),i.push(o),i.push(new Date(t.ToString("dd/MMM/yyyy"))),i.push(a.a.SessionManager.UserID),i.push(a.a.SessionManager.LanguageID),this.dsData=a.a.empService.GetAssignLeaves(i),Logger.InfoLog("AssignLeavesViewModel::End Loading Grade data"),null!=this.dsData&&this.dsData.Tables.length>0&&this.dsData.Tables[0].length>0&&!this.dsData.Columns[0].Contains("ErrorMessage")){Logger.InfoLog("AssignLeavesViewModel::Start Binding data to grid");let t=this.dsData.Tables[0];for(let s=0;s<this.ScreenObject._CCFields.length;s++){let i=this.ScreenObject._CCFields[s];if(i instanceof m.b&&50002==i.CCID&&i.SelectedValue>0){e=this.dsData.Tables[0],t=e.filter(e=>0==e.Location||e.Location==i.SelectedValue);break}}if(r=t,"GradeWise"==s?(null!=l&&l instanceof y.a&&(l.IsVisible=!1),null!=c&&c instanceof y.a&&(c.IsVisible=!0),r=t.filter(e=>1!=e.dcCCNID51_Key),r.sort((e,t)=>e.dcCCNID51_Key-t.dcCCNID51_Key),this.dtData=r.Copy(),r=t.filter(e=>1==e.dcCCNID51_Key),r.sort((e,t)=>e.dcCCNID53_Key-t.dcCCNID53_Key),r=r.ToTable(!0,["dcCCNID51_Key","dcCCNID53_Key"])):"EmployeeWise"==s&&(null!=l&&l instanceof y.a&&(l.IsVisible=!0),null!=c&&c instanceof y.a&&(c.IsVisible=!1),r=t.filter(e=>1==e.dcCCNID51_Key),r.sort((e,t)=>e.dcCCNID53_Key-t.dcCCNID53_Key),this.dtData=r.ToTable(),r=t.filter(e=>1!=e.dcCCNID51_Key),r.sort((e,t)=>e.dcCCNID51_Key-t.dcCCNID51_Key),r=r.ToTable(!0,["dcCCNID51_Key","dcCCNID53_Key"])),this.ScreenObject.GridDataObj.Clear(),this.ScreenObject.GridDataObj.ClearFilters(),r.length>0)for(let e=0;e<r.length;e++){let t=this.ScreenObject.GridDataObj.NewRow();this.ScreenObject.GridDataObj.insertRowAt(t,e),t.ProductID_Key=parseInt(a.a.SessionManager.Preferences.PayrollProduct),t.dcCCNID51_Key=r[e].dcCCNID51_Key.toString(),t.dcCCNID53_Key=r[e].dcCCNID53_Key.toString();for(let e=0;e<this.ScreenObject.ColumnSource.length;e++)null!=this.ScreenObject.ColumnSource[e].DrRefColName&&""!=this.ScreenObject.ColumnSource[e].DrRefColName&&this.ScreenObject.ColumnSource[e].DrRefColName.startsWith("LeaveComp")&&(t[this.ScreenObject.ColumnSource[e].DisplayMember]="0.0");this.ScreenObject.GridDataObj.updateRow(t)}else for(let e=0;e<12;e++){let e=this.ScreenObject.GridDataObj.NewRow();e.DocSeqNo=this.ScreenObject.GridData.length+1,e.DocDetailsID=0,this.ScreenObject.GridDataObj.addRow(e)}Logger.InfoLog("AssignLeavesViewModel::End Binding Grade data to grid")}this.ScreenObject.UpdateSequence(),this.RefreshGrid=!0}else if(1==e){if(""==s.toString())return;let e=[];var l=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase());null!=l&&l instanceof D.e&&(l.IsReadOnly=!0),null!=(l=this.ScreenObject._CCFields.find(e=>"dcccnid2"==e.DBColumnName.toLowerCase()))&&l instanceof m.b&&(l.Enable=!1);var c=this.ScreenObject.ColumnSource.find(e=>50051==e.CostCenterID),h=this.ScreenObject.ColumnSource.find(e=>50053==e.CostCenterID);null!=c&&c instanceof y.a&&("EmployeeWise"==s?(c.IsVisible=!0,h.IsVisible=!1):(h.IsVisible=!0,c.IsVisible=!1)),e=this.ScreenObject.GridData,null!=this.dtData&&this.dtData.length>0&&e.AddRange(this.dtData),"GradeWise"==s?(e=this.ScreenObject.GridData.filter(e=>1!=e.dcCCNID51_Key),this.dtData=e.Copy(),e=this.ScreenObject.GridData.filter(e=>1==e.dcCCNID51_Key),e=e.Copy()):"EmployeeWise"==s&&(e=this.ScreenObject.GridData.filter(e=>1==e.dcCCNID51_Key),this.dtData=e.Copy(),e=this.ScreenObject.GridData.filter(e=>1!=e.dcCCNID51_Key),e=e.Copy()),e.length>0&&(this.ScreenObject.GridDataObj.Clear(),this.ScreenObject.GridDataObj.ClearFilters(),this.ScreenObject.GridData.AddRange(e)),this.ScreenObject.UpdateSequence(),this.RefreshGrid=!0}let u=[];for(let a=0;a<this.ScreenObject.ColumnSource.length;a++)u.push(this.ScreenObject.ColumnSource[a]);this.ScreenObject.ColumnSource=u}CheckDocumentValidations(e){e="";let t=0,s=0;try{if(97==this.ScreenObject.DocumentType){var i=this.ScreenObject._TextFields.find(e=>"dcAlpha16"==e.DBColumnName.toString());if(i&&i.Date.OnlyDate()!=this.dtPayMon.OnlyDate())return"Payroll Month value changed, Filter and Process again.";if(this.IsLatesProcessTimingsUpdated)return"Timings are updated, Filter and Process again.";let t="",s="";for(let e=0;e<this.ScreenObject.GridData.length&&!n.e.IsEmpty(this.ScreenObject.GridData[e].dcCCNID51_Key);e++)t.length>0&&(t+=","),t+=this.ScreenObject.GridData[e].dcCCNID51_Key.toString();if(""==t.Trim())return"No Employees found to Process.";let r=a.a.common.GetDataSet3("PAY011",this.DocID.toString(),t,i.Date.ToString("dd/MMM/yyyy")).Tables[0];if(null!=r&&r.length>0){t=s="";for(let e=0;e<r.length;e++)t+=r[e].EmpCode.toString()+",",s.Contains(r[e].VoucherNo.toString()+",")||(s+=r[e].VoucherNo.toString()+",");return e+"Lates are already Processed to the Employee Codes : "+t.Trim(",")+" in the Following Documents "+s.Trim(",")}if(null!=this.ScreenObject._TextFields.find(e=>"dcAlpha33"==e.DBColumnName.toString()))for(let a=0;a<this.ScreenObject.GridData.length;a++)if(!n.e.IsEmpty(this.ScreenObject.GridData[a].dcCCNID51_Key)&&this.CheckIsPayrollProcessed(new Date(i.Date).ToString("dd/MMM/yyyy"),this.ScreenObject.GridData[a].dcCCNID51_Key.toString()))return e+"Cannot save the record, Payroll processed for the Employee - "+this.ScreenObject.GridData[a].dcCCNID51Code.toString()}else if(96==this.ScreenObject.DocumentType){let e=0;if(this.ScreenObject.GridData.length>0)for(let s=0;s<this.ScreenObject.GridData.length;s++)if(!n.e.IsEmpty(this.ScreenObject.GridData[s].dcAlpha2)){e++;break}if(0==e)return"Enter atleast one row.";let t=a.a.common.GetDataSet("PAY012","").Tables[0];for(let s=0;s<this.ScreenObject.GridData.length;s++){if(!n.e.IsEmpty(this.ScreenObject.GridData[s].dcAlpha2)&&!n.e.IsEmpty(this.ScreenObject.GridData[s].dcNum1)&&!n.e.IsEmpty(this.ScreenObject.GridData[s].dcAlpha5)&&"Leaves"==this.ScreenObject.GridData[s].dcAlpha5.toString()){if((r=this.ScreenObject._TextFields.find(e=>"dcalpha6"==e.DBColumnName.toLowerCase()))instanceof u.d&&""==r.Text.Trim())return"Enter Leave Types Deduction Order @ Header";{let e,s=r.Text.Trim(),i=s.split(";");if(s.length>0&&0==t.length)return"No Leave Types found. Define Leave Types at Customize Payroll";if(null!=i&&i.length>0)for(let a=0;a<i.length;a++)if(null!=i[a]&&""!=i[a].Trim()&&(e=t.filter(e=>e.ComponentName==i[a].Trim()),null==e||0==e.length))return"Leave Type : "+i[a].Trim()+" not found. Check @ Leave Types Deduction Order"}}if(n.e.Int(this.ScreenObject.GridData[s].dcNum3)>0&&!n.e.IsEmpty(this.ScreenObject.GridData[s].dcAlpha9)&&"Leaves"==this.ScreenObject.GridData[s].dcAlpha9.toString()){var r;if((r=this.ScreenObject._TextFields.find(e=>"dcalpha6"==e.DBColumnName.toLowerCase()))&&r instanceof u.d&&""==r.Text.Trim())return"Enter Leave Types Deduction Order @ Header";{let e,s=r.Text.Trim(),i=s.split(";");if(s.length>0&&0==t.length)return"No Leave Types found. Define Leave Types at Customize Payroll";if(null!=i&&i.length>0)for(let a=0;a<i.length;a++)if(null!=i[a]&&""!=i[a].Trim()&&(e=t.filter(e=>e.ComponentName==i[a].Trim()),null==e||0==e.length))return"Leave Type : "+i[a].Trim()+" not found. Check @ Leave Types Deduction Order"}}}if(this.DocID>0){let e=a.a.common.GetDataSet("PAY013",this.DocID.toString()).Tables[0];if(null!=e&&e.length>0)return"Cannot save the record,Lates processed in Document @"+e[0].VoucherNo.toString()}}else if(94==this.ScreenObject.DocumentType){let e="0",t="";if((T=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase()))&&(T instanceof m.b||T instanceof C.a)&&(e=T.SelectedValue.toString()),"0"==e)return"Select any Employee";if((T=this.ScreenObject._CCFields.find(e=>"dcccnid52"==e.DBColumnName.toLowerCase()))&&(T instanceof m.b||T instanceof C.a)&&(t=T.SelectedValue.toString()),"0"==t)return"Select any Leave Type";let s=0;if(this.ScreenObject.GridData.length>0)for(let i=0;i<this.ScreenObject.GridData.length;i++)n.e.IsEmpty(this.ScreenObject.GridData[i].dcAlpha1)||s++;if(0==this.ScreenObject.GridData.length||0==s)return"No LOP Leave documents found.";s=0;for(let i=0;i<this.ScreenObject.GridData.length;i++)n.e.IsEmpty(this.ScreenObject.GridData[i].dcAlpha1)||Object(o.j)(this.ScreenObject.GridData[i].dcAlpha5)&&s++;if(0==s)return"Consider atleast one LOP Leave document to Post";for(let i=0;i<this.ScreenObject.GridData.length;i++)if(!n.e.IsEmpty(this.ScreenObject.GridData[i].dcAlpha1)&&Object(o.j)(this.ScreenObject.GridData[i].dcAlpha5)&&n.e.IsEmptySpace(this.ScreenObject.GridData[i].dcAlpha7))return"Enter 'Current Adjustment Days' at Row No. "+(i+1).toString();for(let i=0;i<this.ScreenObject.GridData.length;i++)if(!n.e.IsEmpty(this.ScreenObject.GridData[i].dcAlpha1)&&Object(o.j)(this.ScreenObject.GridData[i].dcAlpha5)&&!n.e.IsEmpty(this.ScreenObject.GridData[i].dcAlpha7)&&(parseFloat(this.ScreenObject.GridData[i].dcAlpha7)<=0||parseFloat(this.ScreenObject.GridData[i].dcAlpha7)>parseFloat(this.ScreenObject.GridData[i].dcAlpha4)))return"''Current Adjustment Days' should be Grater than '0' and less than or equal to 'No. of days'";if(this.dsData=this.GetLOPLeaveDocuments(parseInt(e),parseInt(t),this.DocumentDate),null!=this.dsData&&this.dsData.Tables.length>0){if(this.dsData.Tables[0].length>0&&this.dsData.Columns[0].Contains("ErrorMessage"))return this.dsData.Tables[0][0].ErrorMessage.toString();if(this.dsData.Tables[0].length>0){let e="",t=0,s=0;for(let i=0;i<this.ScreenObject.GridData.length;i++)if(this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[i].ProductID_Key)){e=this.ScreenObject.GridData[i].dcAlpha1.toString(),t=parseFloat(this.ScreenObject.GridData[i].dcAlpha4);let a=n.e.DTComputeSUM(this.dsData.Tables[1].filter(t=>t.LOPLeaveDocVoucherNo==e&&t.DocID!=this.DocID),"CurAdjDays",!1);if(s=n.e.Double(this.ScreenObject.GridData[i].dcAlpha7),a+s>t)return"You can not adjust more than "+(t-a)+" days, previously adjusted in other documents"}}}}else if(60==this.ScreenObject.DocumentType){for(let e=0;e<this.ScreenObject.GridData.length;e++)null!=this.ScreenObject.GridData[e].dcCCNID51_Key&&(t+=parseInt(this.ScreenObject.GridData[e].dcNum6));t>0&&(e="Please check the dates")}else if(69==this.ScreenObject.DocumentType){let e="0",t="",s=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());s&&(s instanceof m.b||s instanceof C.a)&&(e=s.SelectedValue.toString());let i=a.a.common.GetDataSet3("PAY014",this.DocID.toString(),e.toString()).Tables[0];if(null!=i&&i.length>0)return this.DisplayMessage="Employee Resignation document already exists, Check Document @ "+i[0].VoucherNo.toString(),this.MessageVisibility=!0,this.DisplayMessage;if(this.ScreenObject.Preferences.ContainsKey("AllowResignationifEmployeeonLeaveorVacation")&&"False"==this.ScreenObject.Preferences.AllowResignationifEmployeeonLeaveorVacation)for(let r=0;r<this.ScreenObject.GridData.length;r++)if(t="",e="1",s=this.ScreenObject._TextFields.find(e=>"dcalpha4"==e.DBColumnName.toLowerCase()),null!=s&&(t=s.Date.ToString("dd/MMM/yyyy")),s=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase()),null!=s&&(s instanceof m.b||s instanceof C.a)&&(e=s.SelectedValue.toString()),""!=t&&parseInt(e)>1){let s=a.a.common.GetDataSet3("PAY084",e,t).Tables[0];if(null!=s&&s.length>0&&""!=n.e.String(s[0].LeaveMessage))return this.DisplayMessage=s[0].LeaveMessage.toString(),this.MessageVisibility=!0,this.DisplayMessage}}else if(89==this.ScreenObject.DocumentType){let e,t=null,s=null,i=null,r=null,o="0",l="";if((T=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase()))&&(T instanceof m.b||T instanceof C.a)&&(o=T.SelectedValue.toString()),parseInt(o)>1){let e=this.dtPayEmps.filter(e=>e.NodeID==o);if(null!=e&&e.length>0){let t=n.e.String(e[0].CheckInOutDevice);if(""==t)return"Employee Cannot checkIn/CheckOut from Desktop";{let e=!1;if(t.split(",").forEach(t=>{"Desktop"==t&&(e=!0)}),!e)return"Employee Cannot checkIn/CheckOut from Desktop"}}}if((f=this.ScreenObject.ColumnSource.find(e=>"dcalpha1"==e.DisplayMember.toLowerCase()))&&!n.e.IsEmpty(this.ScreenObject.GridData[0][f.DisplayMember+"_Key"])&&(t=new Date(this.ScreenObject.GridData[0][f.DisplayMember+"_Key"])),(f=this.ScreenObject.ColumnSource.find(e=>"dcalpha2"==e.DisplayMember.toLowerCase()))&&!n.e.IsEmpty(this.ScreenObject.GridData[0][f.DisplayMember+"_Key"])&&(s=new Date(this.ScreenObject.GridData[0][f.DisplayMember+"_Key"])),(f=this.ScreenObject.ColumnSource.find(e=>"dcalpha3"==e.DisplayMember.toLowerCase()))&&!n.e.IsEmpty(this.ScreenObject.GridData[0][f.DisplayMember+"_Key"])&&(i=new Date(this.ScreenObject.GridData[0][f.DisplayMember+"_Key"])),(f=this.ScreenObject.ColumnSource.find(e=>"dcalpha4"==e.DisplayMember.toLowerCase()))&&!n.e.IsEmpty(this.ScreenObject.GridData[0][f.DisplayMember+"_Key"])&&(r=new Date(this.ScreenObject.GridData[0][f.DisplayMember+"_Key"])),null==t&&null==i)return"Select atleast one Check-in/out Date.";if(t&&i&&(t=new Date(t.getFullYear(),t.getMonth(),t.getDate(),s.getHours(),s.getMinutes(),s.getSeconds()),i=new Date(i.getFullYear(),i.getMonth(),i.getDate(),r.getHours(),r.getMinutes(),r.getSeconds()),i<t))return"Check-in date should be less then or equal to Check-out date";if(parseInt(o)>1&&null!=t){let e=a.a.common.GetDataSet3("PAY015",o,t.ToString("dd MMM yyyy"),this.DocID.toString()).Tables[0];if(null!=e&&e.length>0)return"Employee Attendance already exists on Voucher No : "+e[0].VoucherNo.toString()}for(let a=0;a<this.ScreenObject.GridData.length;a++)if(this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[a].ProductID_Key)&&(l="",o="1",e=this.ScreenObject.GridData[a],(f=this.ScreenObject.ColumnSource.find(e=>"dcalpha1"==e.DisplayMember.toLowerCase()))&&!n.e.IsEmpty(e[f.DisplayMember+"_Key"])&&(l=new Date(e[f.DisplayMember+"_Key"]).ToString("dd/MMM/yyyy")),(T=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase()))?(T instanceof m.b||T instanceof C.a)&&(o=T.SelectedValue.toString()):(f=this.ScreenObject.ColumnSource.find(e=>"LISTBOX"==e.DataType.toUpperCase()&&"dcccnid51_key"==e.ValueMember.toLowerCase()))&&!n.e.IsEmpty(e[f.ValueMember])&&(o=e[f.ValueMember].toString()),""!=l&&parseInt(o)>1)){this.drcc1=this.dtPayEmps.filter(e=>e.NodeID==o);let e=this.GetDuplicateTimingsOfEmployeeTimeSheet(l,o,a,this.ScreenObject.DocumentType);if(""!=e){try{parseInt(e),this.DisplayMessage="Employee has already worked on these timings, can't allow same timings. Check Timings of the Employee - "+this.drcc1[0].Code.toString()+" @ Row No - "+parseInt(e)}catch(G){this.DisplayMessage="Employee has already worked on these timings, can't allow same timings. Check Timings of the Employee - "+this.drcc1[0].Code.toString()+" @ Voucher No - "+e}return this.MessageVisibility=!0,this.DisplayMessage}}}else if(90==this.ScreenObject.DocumentType){let e=null,t=null,s=null,i=null,r="0",o="";if((T=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase()))&&(T instanceof m.b||T instanceof C.a)&&(r=T.SelectedValue.toString()),(f=this.ScreenObject.ColumnSource.find(e=>"dcalpha1"==e.DisplayMember.toLowerCase()))&&!n.e.IsEmpty(this.ScreenObject.GridData[0][f.DisplayMember+"_Key"])&&(e=new Date(this.ScreenObject.GridData[0][f.DisplayMember+"_Key"])),(f=this.ScreenObject.ColumnSource.find(e=>"dcalpha2"==e.DisplayMember.toLowerCase()))&&!n.e.IsEmpty(this.ScreenObject.GridData[0][f.DisplayMember+"_Key"])&&(t=new Date(this.ScreenObject.GridData[0][f.DisplayMember+"_Key"])),(f=this.ScreenObject.ColumnSource.find(e=>"dcalpha3"==e.DisplayMember.toLowerCase()))&&!n.e.IsEmpty(this.ScreenObject.GridData[0][f.DisplayMember+"_Key"])&&(s=new Date(this.ScreenObject.GridData[0][f.DisplayMember+"_Key"])),(f=this.ScreenObject.ColumnSource.find(e=>"dcalpha4"==e.DisplayMember.toLowerCase()))&&!n.e.IsEmpty(this.ScreenObject.GridData[0][f.DisplayMember+"_Key"])&&(i=new Date(this.ScreenObject.GridData[0][f.DisplayMember+"_Key"])),null==e&&null==s)return"Select atleast one Check-in/out Date.";if(e&&s&&(e=new Date(e.getFullYear(),e.getMonth(),e.getDate(),t.getHours(),t.getMinutes(),t.getSeconds()),s=new Date(s.getFullYear(),s.getMonth(),s.getDate(),i.getHours(),i.getMinutes(),i.getSeconds()),s<e))return"Check-in date should be less then or equal to Check-out date";if(a.a.SessionManager.Preferences.ContainsKey("AllowMultipleTimeSheetsOnSameDay")&&"FALSE"==a.a.SessionManager.Preferences.AllowMultipleTimeSheetsOnSameDay.toString().toUpperCase()&&parseInt(r)>1&&null!=e){let t=a.a.common.GetDataSet3("PAY016",r,e.ToString("dd MMM yyyy"),this.DocID.toString()).Tables[0];if(null!=t&&t.length>0)return"Employee Time Sheet already exists on Voucher No : "+t[0].VoucherNo.toString()}if(a.a.SessionManager.Preferences.ContainsKey("AllowOverlapTimeInTimeSheet")&&"FALSE"==a.a.SessionManager.Preferences.AllowOverlapTimeInTimeSheet.toString().toUpperCase()){let e;for(let t=0;t<this.ScreenObject.GridData.length;t++)if(this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[t].ProductID_Key)&&(o="",r="1",e=this.ScreenObject.GridData[t],(f=this.ScreenObject.ColumnSource.find(e=>"dcalpha1"==e.DisplayMember.toLowerCase()))&&!n.e.IsEmpty(e[f.DisplayMember+"_Key"])&&(o=new Date(e[f.DisplayMember+"_Key"]).ToString("dd/MMM/yyyy")),(T=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase()))?(T instanceof m.b||T instanceof C.a)&&(r=T.SelectedValue.toString()):(f=this.ScreenObject.ColumnSource.find(e=>"LISTBOX"==e.DataType.toUpperCase()&&"dcccnid51_key"==e.ValueMember.toLowerCase()))&&!n.e.IsEmpty(e[f.ValueMember])&&(r=e[f.ValueMember].toString()),""!=o&&parseInt(r)>1)){this.drcc1=this.dtPayEmps.filter(e=>e.NodeID==r);let e=this.GetDuplicateTimingsOfEmployeeTimeSheet(o,r,t,this.ScreenObject.DocumentType);if(""!=e){try{parseInt(e),this.DisplayMessage="Employee has already worked on these timings, can't allow same timings. Check Timings of the Employee - "+this.drcc1[0].Code.toString()+" @ Row No - "+parseInt(e)}catch(N){this.DisplayMessage="Employee has already worked on these timings, can't allow same timings. Check Timings of the Employee - "+this.drcc1[0].Code.toString()+" @ Voucher No - "+e}return this.MessageVisibility=!0,this.DisplayMessage}}}}else if(79==this.ScreenObject.DocumentType){let e="0",t="";if((T=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase()))&&(T instanceof m.b||T instanceof C.a)&&(e=T.SelectedValue.toString()),(T=this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase()))&&(t=T.Date.ToString("dd/MMM/yyyy")),""!=t&&parseInt(e)>1){let s=a.a.common.GetDataSet3("PAY017",this.DocID.toString(),e,t);if(null!=s&&s.length>0)return"Attendance Dimension Wise already exists on Voucher No : "+s[0].VoucherNo.toString()}}else if(58==this.ScreenObject.DocumentType){let s=0;for(let a=0;a<this.ScreenObject.GridData.length;a++)if(null!=this.ScreenObject.GridData[a].dcCCNID52_Key){if(s++,n.e.Double(this.ScreenObject.GridData[a].dcAlpha3)<=0){e="Enter Valid Applied Days ";break}if(t=parseInt(this.ScreenObject.GridData[a].dcAlpha5),-1==t){e="Applied days should be less than or equal to available days";break}if(-2==t){e="Total applied days should be less than or equal to max encash days";break}}if(0==s)return"Encash atleast one Leave Type";let i="";(T=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase()))&&(T instanceof m.b||T instanceof C.a)&&(i=T.SelectedValue.toString());var l=this.ScreenObject._TextFields.find(e=>"dcalpha9"==e.DBColumnName.toLowerCase());if(null!=l&&l instanceof D.e&&!n.e.IsEmpty(l.SelectedValue)&&"Yes"==l.SelectedValue.toString()&&null!=(l=this.ScreenObject._TextFields.find(e=>"dcalpha10"==e.DBColumnName.toLowerCase()))&&l instanceof d.c&&l.Date&&n.e.Int(i)>0&&this.CheckIsPayrollProcessed(new Date(l.Date).ToString("dd/MMM/yyyy"),i))return e+"Cannot save the record, Payroll processed for the selected month"}else if(59==this.ScreenObject.DocumentType){if(a.a.SessionManager.Preferences.ContainsKey("CompensatoryLeaveType")&&""==a.a.SessionManager.Preferences.CompensatoryLeaveType.toString())e="Please set the compensatory leave type preference";else for(let s=0;s<this.ScreenObject.GridData.length;s++)if(null!=this.ScreenObject.GridData[s].dcCCNID51_Key){if(null!=this.ScreenObject.GridData[s].dcAlpha1_Key&&new Date(this.DocumentDate)>new Date(this.ScreenObject.GridData[s].dcAlpha1_Key)&&this.ScreenObject.Preferences.ContainsKey("IgnoreDocumentDateValidation")&&!Object(o.j)(this.ScreenObject.Preferences.IgnoreDocumentDateValidation)){e="Document Date should be less than or equal to Selected Date";break}if(t=parseInt(this.ScreenObject.GridData[s].dcNum1),0==t){e="Selected date should be Weeklyoff or Holiday";break}}}else if(62==this.ScreenObject.DocumentType){let t="",i=a.a.common.GetDataSet("PAY019","").Tables[0];for(let r=0;r<this.ScreenObject.GridData.length;r++){if((T=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase()))?(T instanceof m.b||T instanceof C.a)&&(t=T.SelectedValue.toString()):(f=this.ScreenObject.ColumnSource.find(e=>"LISTBOX"==e.DataType.toUpperCase()&&"dcccnid51_key"==e.ValueMember.toLowerCase()))&&!n.e.IsEmpty(this.ScreenObject.GridData[r][f.ValueMember])&&(t=this.ScreenObject.GridData[r][f.ValueMember].toString()),null!=i&&i.length>0&&!n.e.IsEmpty(t)&&parseInt(t)>0&&null!=this.ScreenObject.GridData[r].dcAlpha4_Key){let e=i.filter(e=>e.NodeId==t);if(null!=e&&e.length>0&&new Date(e[0].DateOfJoining.toString())>new Date(this.ScreenObject.GridData[r].dcAlpha4_Key.toString()))return this.DisplayMessage="Please Check The Employee Dependency With date Of joining ",this.MessageVisibility=!0,this.DisplayMessage}if(this.ScreenObject.Preferences.ContainsKey("DonotallowLeaveduringNoticePeriod")&&""!=this.ScreenObject.Preferences.DonotallowLeaveduringNoticePeriod&&Object(o.j)(this.ScreenObject.Preferences.DonotallowLeaveduringNoticePeriod)&&!n.e.IsEmpty(this.ScreenObject.GridData[r].dcAlpha5_key)){let s=a.a.report.GetDataTable("AEDDALeave",t,new Date(this.ScreenObject.GridData[r].dcAlpha5_key).ToString("dd/MMM/yyyy"));if(null!=s&&s.length>0){e+="Employee is on Notice Period,Cannot Apply Leave";break}}if(a.a.SessionManager.Preferences.ContainsKey("DonotAllowLeaveIfAttendencePosted")&&Object(o.j)("True"==a.a.SessionManager.Preferences.DonotAllowLeaveIfAttendencePosted)&&null!=this.ScreenObject.GridData[r].dcAlpha4_Key&&null!=this.ScreenObject.GridData[r].dcAlpha5_Key){let s=a.a.common.GetDataSet3("PAY018",t,new Date(this.ScreenObject.GridData[r].dcAlpha4_Key).ToString("dd/MMM/yyyy"),new Date(this.ScreenObject.GridData[r].dcAlpha5_Key).ToString("dd/MMM/yyyy"));if(null!=s&&s.length>0){e="Daily Attendence Already Posted";break}}if(null!=this.ScreenObject.GridData[r].dcCCNID52_Key){let i={IfFormulaExistsNoOfDays:!1};if(""!=(e=this.IsLeaveTypeValid(parseInt(t),parseInt(this.ScreenObject.GridData[r].dcCCNID52_Key),this.ScreenObject.GridData[r],i)))break;let l=a.a.common.GetDataSet3("PAY009",t,new Date(this.ScreenObject.GridData[r].dcAlpha4_Key.toString()).ToString("dd/MMM/yyyy")).Tables[0];if(null!=l&&l.length>0){e="Please enter Rejoining date of this Employee to the Last Vacation";break}if(null!=this.ScreenObject.GridData[r].dcAlpha4_Key&&new Date(this.DocumentDate)>new Date(this.ScreenObject.GridData[r].dcAlpha4_Key)&&this.ScreenObject.Preferences.ContainsKey("IgnoreDocumentDateValidation")&&!Object(o.j)(this.ScreenObject.Preferences.IgnoreDocumentDateValidation)){e="Document Date should be less than or equal to From Date";break}if(null!=this.ScreenObject.GridData[r].dcAlpha7&&(s=parseFloat(this.ScreenObject.GridData[r].dcAlpha7),s<=0)){e="Dates already applied | Selected dates between holidays or weeklyoffs dates";break}if(null!=this.ScreenObject.GridData[r].dcAlpha9&&(parseInt(this.ScreenObject.GridData[r].dcAlpha9)>=0||-4==parseInt(this.ScreenObject.GridData[r].dcAlpha9))){if(null!=this.ScreenObject.GridData[r].dcAlpha3&&(s=parseFloat(this.ScreenObject.GridData[r].dcAlpha3),s<=0)){e="Please check the Payroll structure/Available leaves for the selected month";break}if(null!=this.ScreenObject.GridData[r].dcAlpha3&&null!=this.ScreenObject.GridData[r].dcAlpha7&&null!=this.ScreenObject.GridData[r].dcAlpha9&&-4!=parseInt(this.ScreenObject.GridData[r].dcAlpha9)&&parseFloat(this.ScreenObject.GridData[r].dcAlpha7)>parseFloat(this.ScreenObject.GridData[r].dcAlpha3)){e="Cannot apply leaves more than Available leaves";break}}if(n.e.IsEmpty(this.ScreenObject.GridData[r].dcAlpha6)||"1"==n.e.String(this.ScreenObject.GridData[r].dcAlpha6)||"2"==n.e.String(this.ScreenObject.GridData[r].dcAlpha6)||"3"==n.e.String(this.ScreenObject.GridData[r].dcAlpha6)){e="Please select the session type";break}if(a.a.SessionManager.Preferences.ContainsKey("AllowLeavesifPayrollProcessedorLocked")&&Object(o.j)("False"==a.a.SessionManager.Preferences.AllowLeavesifPayrollProcessedorLocked)&&null!=this.ScreenObject.GridData[r].dcAlpha4_key&&null!=this.ScreenObject.GridData[r].dcAlpha5_key&&""!=(e=this.IsDocLocked(t,new Date(this.ScreenObject.GridData[r].dcAlpha4_key),new Date(this.ScreenObject.GridData[r].dcAlpha5_key),this.ScreenObject.DocumentType)))break}}}else if(65==this.ScreenObject.DocumentType){for(let s=0;s<this.ScreenObject.GridData.length;s++)if(null!=this.ScreenObject.GridData[s].dcAlpha1){if(n.e.IsEmpty(this.ScreenObject.GridData[s].dcAlpha3_Key)){e="Please enter the Re-join date";break}if(new Date(this.DocumentDate)>new Date(this.ScreenObject.GridData[s].dcAlpha3_Key)&&this.ScreenObject.Preferences.ContainsKey("IgnoreDocumentDateValidation")&&!Object(o.j)(this.ScreenObject.Preferences.IgnoreDocumentDateValidation)){e="Document Date should be less than or equal to Re-join date";break}if(t=parseInt(this.ScreenObject.GridData[s].dcAlpha4),t>0){e="Please check the Re-join date";break}}}else if(68==this.ScreenObject.DocumentType||69==this.ScreenObject.DocumentType||70==this.ScreenObject.DocumentType||80==this.ScreenObject.DocumentType){var c=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());if(null!=c&&(c instanceof m.b&&n.e.IsEmpty(c.Text)||c instanceof C.a&&n.e.IsEmpty(c.Text))&&(e="Please select the employee"),69==this.ScreenObject.DocumentType){var h=this.ScreenObject._TextFields.find(e=>"dcalpha4"==e.DBColumnName.toLowerCase());h instanceof d.c&&h.Date&&new Date(this.DocumentDate)>new Date(h.Date)&&this.ScreenObject.Preferences.ContainsKey("IgnoreDocumentDateValidation")&&!Object(o.j)(this.ScreenObject.Preferences.IgnoreDocumentDateValidation)&&(e+=" Document Date should be less than or equal to Release Date");for(let t=0;t<this.ScreenObject._TextFields.length;t++){let s=this.ScreenObject._TextFields[t];if(s instanceof d.c&&s.DBColumnName.toLowerCase().Contains("dcalpha")&&s.Date){e+=this.IsDateValid(null,s.DBColumnName);break}}}else if(70==this.ScreenObject.DocumentType)for(let t=0;t<this.ScreenObject.GridData.length;t++){if(null!=this.ScreenObject.GridData[t].dcAlpha4_Key&&null!=this.ScreenObject.GridData[t].dcAlpha5_Key&&new Date(this.ScreenObject.GridData[t].dcAlpha5_Key)<new Date(this.ScreenObject.GridData[t].dcAlpha4_Key)){e="Expected completed date should be greater than start date";break}if(null!=this.ScreenObject.GridData[t].dcAlpha4_Key&&null!=this.ScreenObject.GridData[t].dcAlpha6_Key&&new Date(this.ScreenObject.GridData[t].dcAlpha6_Key)<new Date(this.ScreenObject.GridData[t].dcAlpha4_Key)){e="Completed date should be greater than start date";break}if(null!=this.ScreenObject.GridData[t].dcAlpha5_Key&&null!=this.ScreenObject.GridData[t].dcAlpha6_Key&&new Date(this.ScreenObject.GridData[t].dcAlpha6_Key)<new Date(this.ScreenObject.GridData[t].dcAlpha5_Key)){e="Completed date should be greater than Expected completed date";break}if(null!=this.ScreenObject.GridData[t].dcAlpha4_Key&&new Date(this.DocumentDate)>new Date(this.ScreenObject.GridData[t].dcAlpha4_Key)&&this.ScreenObject.Preferences.ContainsKey("IgnoreDocumentDateValidation")&&!Object(o.j)(this.ScreenObject.Preferences.IgnoreDocumentDateValidation)){e="Document Date should be less than or equal to Start Date";break}}else if(68==this.ScreenObject.DocumentType){let t=(new Date).OnlyDate(),s=(new Date).OnlyDate(),i="";for(let r=0;r<this.ScreenObject.GridData.length;r++)if(this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&null!=this.ScreenObject.GridData[r].ProductID_Key&&null!=this.ScreenObject.GridData[r].ProductID_Key&&""!=this.ScreenObject.GridData[r].ProductID_Key.toString()){let o=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());if(null!=o)(o instanceof m.b||o instanceof C.a)&&(i=o.SelectedValue.toString());else{let e=this.ScreenObject.ColumnSource.find(e=>"LISTBOX"==e.DataType.toUpperCase()&&"dcccnid51_key"==e.ValueMember.toLowerCase());null==e||n.e.IsEmpty(this.ScreenObject.GridData[r][e.ValueMember])||(i=this.ScreenObject.GridData[r][e.ValueMember].toString())}let l=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase());null!=l&&l instanceof d.c&&!n.e.IsEmpty(l.Date)&&(t=l.Date),l=this.ScreenObject._TextFields.find(e=>"dcalpha4"==e.DBColumnName.toLowerCase()),null!=l&&l instanceof d.c&&!n.e.IsEmpty(l.Date)&&(s=new Date(l.Date.getFullYear(),l.Date.iMonth(),1));let c=a.a.common.GetDataTable("PAY092",i+"~"+s.AddMonths(1));if(null!=c&&c.length>0){e="Cannot save the record, Payroll processed for the selected month";break}if(""!=(e=this.IsDocLocked(i,s.AddMonths(1),s.AddMonths(1),this.ScreenObject.DocumentType)))break}}else if(80==this.ScreenObject.DocumentType){let t=(new Date).OnlyDate(),s=(new Date).OnlyDate(),i="",a=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());null!=a&&(a instanceof m.b||a instanceof C.a)&&(i=a.SelectedValue.toString());let r=this.ScreenObject._TextFields.find(e=>"dcalpha3"==e.DBColumnName.toLowerCase());null!=r&&r instanceof d.c&&!n.e.IsEmpty(r.Date)&&(t=r.Date),s=t,e=this.IsDocLocked(i,t,s,this.ScreenObject.DocumentType)}}else if(72==this.ScreenObject.DocumentType){let t=new Date,s=new Date,i="",r=a.a.common.GetDataSet("PAY019","").Tables[0];if((T=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase()))&&(T instanceof m.b||T instanceof C.a)&&(i=T.SelectedValue.toString()),null!=r&&r.length>0&&!n.e.IsEmpty(i)&&parseInt(i)>0&&(S=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase()))){let e=r.filter(e=>e.NodeId==i);if(null!=e&&e.length>0&&new Date(e[0].DateOfJoining.toString())>new Date(S.Date))return this.DisplayMessage="Please Check The Employee Dependency With date Of joining ",this.MessageVisibility=!0,this.DisplayMessage}let l,c=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());if(null!=c&&c instanceof m.b&&c.SelectedValue>0&&0==this.DocID){var S=this.ScreenObject._TextFields.find(e=>"dcalpha3"==e.DBColumnName.toLowerCase()),b=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase());if(null!=S&&S instanceof d.c&&""!=n.e.String(S.Date)&&null!=b&&b instanceof d.c&&""!=b.Date.toString()){let s=this.ScreenObject.GetVacationDetails(c.SelectedValue,new Date(S.Date),new Date(b.Date));s.Tables.length>0&&(e=this.ApplyVacationValidationMsg(s)),a.a.SessionManager.Preferences.ContainsKey("DonotAllowVacationDuringProbationPeriod")&&"True"==a.a.SessionManager.Preferences.DonotAllowVacationDuringProbationPeriod.toString()&&new Date(t)<=new Date(s.Tables[6][0].ConfirmationDate)&&(e+=" Employee is in probation period, cannot apply the vacation\r\n")}}else if(null!=c&&c instanceof C.a&&c.SelectedValue>0&&0==this.DocID&&(S=this.ScreenObject._TextFields.find(e=>"dcalpha3"==e.DBColumnName.toLowerCase()),b=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase()),null!=S&&S instanceof d.c&&""!=n.e.String(S.Date)&&null!=b&&b instanceof d.c&&""!=n.e.String(b.Date))){let s=this.ScreenObject.GetVacationDetails(c.SelectedValue,new Date(S.Date),new Date(b.Date));s.Tables.length>0&&(e=this.ApplyVacationValidationMsg(s)),a.a.SessionManager.Preferences.ContainsKey("DonotAllowVacationDuringProbationPeriod")&&"True"==a.a.SessionManager.Preferences.DonotAllowVacationDuringProbationPeriod.toString()&&new Date(t)<=new Date(s.Tables[6][0].ConfirmationDate)&&(e+=" Employee is in probation period, cannot apply the vacation\r\n")}if(c=this.ScreenObject._TextFields.find(e=>"dcalpha16"==e.DBColumnName.toLowerCase()),null!=c&&c instanceof D.e&&!n.e.IsEmpty(c.SelectedValue)&&"Yes"==c.SelectedValue&&this.ScreenObject._TextFields.find(e=>"dcalpha14"==e.DBColumnName.toLowerCase())instanceof u.d){let t=0,s=0,i=0,a=this.ScreenObject._TextFields.find(e=>"dcalpha22"==e.DBColumnName.toLowerCase());a instanceof u.d&&!n.e.IsEmpty(a.Text)&&(t=parseFloat(a.Text)),a=this.ScreenObject._TextFields.find(e=>"dcalpha10"==e.DBColumnName.toLowerCase()),a instanceof u.d&&!n.e.IsEmpty(a.Text)&&(i=parseFloat(a.Text)),a=this.ScreenObject._TextFields.find(e=>"dcalpha7"==e.DBColumnName.toLowerCase()),a instanceof u.d&&!n.e.IsEmpty(a.Text)&&(s=parseFloat(a.Text)),t+s-i<parseFloat(a.Text)&&(e+="Encash days should be less than or equal to remaining days\r\n")}if(c=this.ScreenObject._TextFields.find(e=>"dcalpha16"==e.DBColumnName.toLowerCase()),null!=c&&c instanceof D.e&&!n.e.IsEmpty(c.SelectedValue)&&"Yes"!=c.SelectedValue.toString()&&(c=this.ScreenObject._TextFields.find(e=>"dcalpha4"==e.DBColumnName.toLowerCase()),null!=c&&c instanceof u.d&&(""==c.Text.toString()||"0.00"==c.Text.toString())&&(e+="Please check the vacation days\r\n")),c=this.ScreenObject._TextFields.find(e=>"dcalpha18"==e.DBColumnName.toLowerCase()),null!=c&&c instanceof d.c&&c.Date&&new Date(c.Date)<new Date(this.DocumentDate)&&(e+="Exit rentry date should be greater than doc date\r\n"),c=this.ScreenObject._TextFields.find(e=>"dcalpha19"==e.DBColumnName.toLowerCase()),null!=c&&c instanceof d.c&&c.Date&&new Date(c.Date)<new Date(this.DocumentDate)&&(e+="Approved date should be greater than doc date\r\n"),c=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase()),null!=c&&c instanceof d.c&&c.Date&&(t=c.Date),c=this.ScreenObject._TextFields.find(e=>"dcalpha3"==e.DBColumnName.toLowerCase()),null!=c&&c instanceof d.c&&c.Date&&(s=c.Date),new Date(t)>new Date(s)&&(e+="Todate should be greater than Fromdate\r\n"),new Date(this.DocumentDate)>new Date(t)&&this.ScreenObject.Preferences.ContainsKey("IgnoreDocumentDateValidation")&&!Object(o.j)(this.ScreenObject.Preferences.IgnoreDocumentDateValidation)&&(e+="Document Date should be less than or equal to From Date"),""!=e)return e;a.a.SessionManager.Preferences.ContainsKey("AllowVacationifPayrollProcessedorLocked")&&Object(o.j)("False"==a.a.SessionManager.Preferences.AllowVacationifPayrollProcessedorLocked)&&(e=this.IsDocLocked(i,t,s,this.ScreenObject.DocumentType));let h=a.a.common.GetDataSet("PAY020","").Tables[0];if(null!=h&&h.length>0)for(let n=0;n<h.length;n++)l=a.a.common.GetDataSet3("PAY021",i,h[n].ComponentID.toString()).Tables[0],null!=l&&l.length>0&&(e+="Please enter Rejoining date of this Employee to the Leave Type : "+h[n].ComponentName.toString());if(c=this.ScreenObject._TextFields.find(e=>"dcalpha24"==e.DBColumnName.toLowerCase()),null!=c&&c instanceof D.e&&!n.e.IsEmpty(c.SelectedValue)&&"Yes"==c.SelectedValue.toString()&&(c=this.ScreenObject._TextFields.find(e=>"dcalpha25"==e.DBColumnName.toLowerCase()),null!=c&&c instanceof d.c&&c.Date&&n.e.Int(i)>0&&this.CheckIsPayrollProcessed(new Date(c.Date).ToString("dd/MMM/yyyy"),i)&&(e+="Cannot save the record, Payroll processed for the selected month")),!n.e.IsEmpty(i)&&parseInt(i)>0){let n=new Date(t.getFullYear(),t.getMonth(),1),r=a.a.report.GetDataTable("AEDVACLeave",i,n.ToString("dd/MMM/yyyy"));if(null!=r&&r.length>0){let t=a.a.report.GetDataTable("AEDVACLeave01",i,s.ToString("dd MMM yyyy"));if(null!=t&&t.length>0)return e+"Employee is on Notice Period,Cannot Apply Vacation"}}if(a.a.SessionManager.Preferences.ContainsKey("VacationBasedOnContract")&&parseInt(a.a.SessionManager.Preferences.VacationBasedOnContract)>0){let t=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase());if(null!=t&&t instanceof d.c&&n.e.IsEmpty(t.Date)){let s=a.a.common.GetDataTable("DOC058",i+"~"+t.Date.ToString("dd/MMM/yyyy")+"~"+this.ScreenObject.DocID);null!=s&&s.length>0&&(e+="Employee has Already applied Vacation in future Date")}}}else if(73==this.ScreenObject.DocumentType){let e=0;if(this.ScreenObject.GridData.length>0)for(let t=0;t<this.ScreenObject.GridData.length;t++)null!=this.ScreenObject.GridData[t].dcAlpha4&&null!=this.ScreenObject.GridData[t].dcAlpha4&&"YES"==this.ScreenObject.GridData[t].dcAlpha4.toString().toUpperCase()&&e++;if(1!=e)return"Select only one document to adjust."}else if(74==this.ScreenObject.DocumentType)e=this.GetITSlabValidation(1,null);else if(57==this.ScreenObject.DocumentType){0==this.ScreenObject.Link.VouchersList.length&&(e+="No loan link document available for the loan repayment");for(let t=0;t<this.ScreenObject.GridData.length;t++)if(null!=this.ScreenObject.GridData[t].Rate&&parseInt(this.ScreenObject.GridData[t].Rate)<0){e+="Please check the date for Paid On / Month ";break}}else if(55==this.ScreenObject.DocumentType){for(let t=0;t<this.ScreenObject.GridData.length;t++){if(null!=this.ScreenObject.GridData[t].Rate&&parseInt(this.ScreenObject.GridData[t].Rate)<0){e="Please check the deduction month";break}if(null!=this.ScreenObject.GridData[t].dcCCnid51_Key&&null==this.ScreenObject.GridData[t].dcAlpha1_Key){e="Please enter the deduction month";break}if(null!=this.ScreenObject.GridData[t].dcNum1&&null!=this.ScreenObject.GridData[t].dcNum2){if(parseFloat(this.ScreenObject.GridData[t].dcNum2)>parseFloat(this.ScreenObject.GridData[t].dcNum1)){e="Opening balance amount should be less than loan amount";break}if(null!=this.ScreenObject.GridData[t].dcNum3){if(0==parseFloat(this.ScreenObject.GridData[t].dcNum3)){e="Please enter the installment amount";break}if(parseFloat(this.ScreenObject.GridData[t].dcNum3)>parseFloat(this.ScreenObject.GridData[t].dcNum1)){e="Installment amount should be less than loan amount";break}if(parseFloat(this.ScreenObject.GridData[t].dcNum3)>parseFloat(this.ScreenObject.GridData[t].dcNum2)){e="Installment amount should be less than opening balance amount";break}}}}if(this.DocID>0){let t=this.ScreenObject.CheckLoanRepayAmountDetails(this.DocID);t.Tables.length>0&&t.Tables[0].length>0&&parseFloat(t.Tables[0][0][0])>0&&(e="Can't update the linked document")}}else if(56==this.ScreenObject.DocumentType){if(!a.a.SessionManager.IsWebApplication){var p=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());(p&&p instanceof m.b&&n.e.IsEmpty(p.Text)||p&&p instanceof C.a&&n.e.IsEmpty(p.Text))&&(e="Please select the employee\r\n"),(p=this.ScreenObject._CCFields.find(e=>"dcccnid52"==e.DBColumnName.toLowerCase()))&&p instanceof m.b&&n.e.IsEmpty(p.Text)&&(e+="Please select the loan type\r\n"),(p=this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase()))&&p instanceof u.d&&(""==p.Text.toString()||"0"==p.Text.toString())&&(e+="Please enter the loan amount\r\n"),e+=this.IsDateValid(null,"")}let t="0";if((T=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase()))&&(T instanceof m.b||T instanceof C.a)&&(t=T.SelectedValue.toString()),"0"==t&&(e="Select any Employee"),a.a.SessionManager.Preferences.ContainsKey("DonotAllowApplyLoanDuringProbationPeriod")&&Object(o.j)(a.a.SessionManager.Preferences.DonotAllowApplyLoanDuringProbationPeriod)){let s=a.a.common.GetDataSet3("PAY022",this.ScreenObject.DocDate.Date.ToString("dd/MMM/yyyy"),t).Tables[0];null!=s&&s.length>0&&null!=s[0].Valid&&null!=s[0].Valid&&"1"==s[0].Valid.toString()&&(e+=" Employee is in probation period, can not apply the Loan")}}else if(66==this.ScreenObject.DocumentType){let t=24;for(let s=0;s<this.ScreenObject.GridData.length&&n.e.IsEmpty(e);s++){for(let i=1;i<=12;i++)if(6==i&&(i=8),null!=this.ScreenObject.GridData[s]["dcAlpha"+i]&&parseFloat(this.ScreenObject.GridData[s]["dcAlpha"+i])>0&&parseFloat(this.ScreenObject.GridData[s]["dcAlpha"+i])>t){e="Hours should be less than or equal to 24 hours at row no : "+this.ScreenObject.GridData[s].DocSeqNo.toString()+"\r\n";break}if(null!=this.ScreenObject.GridData[s].dcAlpha3&&null!=this.ScreenObject.GridData[s].dcAlpha4&&parseFloat(this.ScreenObject.GridData[s].dcAlpha3)>=parseFloat(this.ScreenObject.GridData[s].dcAlpha4)){e=e+"Minimum hours half day should be less than minimum hours full day at row no : "+this.ScreenObject.GridData[s].DocSeqNo.toString()+"\r\n";break}if(null!=this.ScreenObject.GridData[s].dcAlpha4&&null!=this.ScreenObject.GridData[s].dcAlpha5&&parseFloat(this.ScreenObject.GridData[s].dcAlpha4)>=parseFloat(this.ScreenObject.GridData[s].dcAlpha5)){e=e+"Minimum hours full day should be less than maximum hours per day at row no : "+this.ScreenObject.GridData[s].DocSeqNo.toString()+"\r\n";break}if(null!=this.ScreenObject.GridData[s].dcAlpha6_Key&&new Date(this.DocumentDate)>new Date(this.ScreenObject.GridData[s].dcAlpha6_Key)&&this.ScreenObject.Preferences.ContainsKey("IgnoreDocumentDateValidation")&&!Object(o.j)(this.ScreenObject.Preferences.IgnoreDocumentDateValidation)){e="Document Date should be less than or equal to WEF Date";break}}}else if(52==this.ScreenObject.DocumentType){var y=this.ScreenObject._TextFields.find(e=>"dcalpha3"==e.DBColumnName.toLowerCase());null!=y&&y instanceof d.c&&y.Date&&new Date(this.DocumentDate)>y.Date.OnlyDate()&&this.ScreenObject.Preferences.ContainsKey("IgnoreDocumentDateValidation")&&!Object(o.j)(this.ScreenObject.Preferences.IgnoreDocumentDateValidation)&&(e="Document Date should be less than or equal to WEF Date")}else if(53==this.ScreenObject.DocumentType)null==this.ScreenObject.DueDate.Date?e="Please enter the  "+this.ScreenObject.DueDate.Label+"\r\n":new Date(this.DocumentDate)>new Date(this.ScreenObject.DueDate.Date)&&this.ScreenObject.Preferences.ContainsKey("IgnoreDocumentDateValidation")&&!Object(o.j)(this.ScreenObject.Preferences.IgnoreDocumentDateValidation)&&(e="Document Date should be less than or equal to W.E.F Date");else if(63==this.ScreenObject.DocumentType){let t=new Date;var g=this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase());if(!(null!=g&&g instanceof d.c&&g.Date))return this.DisplayMessage="Please select the payroll month",this.MessageVisibility=!0,this.DisplayMessage;t=g.Date;for(let i=0;i<this.ScreenObject.GridData.length;i++)if(null!=this.ScreenObject.GridData[i].dcCCNID51_Key&&null!=this.ScreenObject.GridData[i].dcCCNID52_Key){if(null!=this.ScreenObject.GridData[i].dcAlpha4_Key&&new Date(this.DocumentDate)>new Date(this.ScreenObject.GridData[i].dcAlpha4_Key)&&this.ScreenObject.Preferences.ContainsKey("IgnoreDocumentDateValidation")&&!Object(o.j)(this.ScreenObject.Preferences.IgnoreDocumentDateValidation)){e="Document Date should be less than or equal to From Date";break}if(null!=this.ScreenObject.GridData[i].dcAlpha7&&(s=parseFloat(this.ScreenObject.GridData[i].dcAlpha7),s<=0)){e="Dates already applied | Selected dates between holidays or weeklyoffs dates";break}if(null!=this.ScreenObject.GridData[i].dcAlpha8&&(parseInt(this.ScreenObject.GridData[i].dcAlpha8)>=0||-4==parseInt(this.ScreenObject.GridData[i].dcAlpha8))){if(null!=this.ScreenObject.GridData[i].dcAlpha3&&(s=parseFloat(this.ScreenObject.GridData[i].dcAlpha3),s<=0)){e="Please check the Payroll structure/Available leaves for the selected month";break}if(null!=this.ScreenObject.GridData[i].dcNum1&&null!=this.ScreenObject.GridData[i].dcAlpha7&&parseFloat(this.ScreenObject.GridData[i].dcNum1)>parseFloat(this.ScreenObject.GridData[i].dcAlpha3)){e="Cannot apply leaves more than Available leaves";break}}if(!n.e.IsEmpty(this.ScreenObject.GridData[i].dcAlpha6)||"1"==n.e.String(this.ScreenObject.GridData[i].dcAlpha6)||"2"==n.e.String(this.ScreenObject.GridData[i].dcAlpha6)||"3"==n.e.String(this.ScreenObject.GridData[i].dcAlpha6)){e="Please select the session type";break}if(null!=this.ScreenObject.GridData[i].dcAlpha4_Key&&null!=this.ScreenObject.GridData[i].dcAlpha5_Key){if(new Date(this.ScreenObject.GridData[i].dcAlpha4_Key).ToString("MMM/yyyy")!=new Date(t).ToString("MMM/yyyy")){e="From date should be from payroll month";break}if(new Date(this.ScreenObject.GridData[i].dcAlpha5_Key).ToString("MMM/yyyy")!=new Date(t).ToString("MMM/yyyy")){e="To date should be from payroll month";break}}}}if(62==this.ScreenObject.DocumentType&&this.ScreenObject.GridData.length>0){let e,t="",s=0,i=0,r=0,o=0,l=this.ScreenObject.GridData.filter(e=>!n.e.IsEmpty(e.dcCCNID52)),c=[];for(let a=0;a<l.length;a++){let e=c.find(e=>e.LQLeaveType==l[a].dcCCNID52);if(e)e.LQTotNoofDays=n.e.Double(e.LQTotNoofDays)+n.e.Double(l[a].dcAlpha7);else{let e={LQLeaveType:l[a].dcCCNID52,LQTotNoofDays:n.e.Double(l[a].dcAlpha7),LQAssignedDays:n.e.Double(l[a].dcAlpha2),LQAvlblDays:n.e.Double(l[a].dcAlpha3),LQAtATime:n.e.Double(l[a].dcAlpha8),LQMaxLeaves:n.e.Double(l[a].dcAlpha9)};c.push(e)}}for(let h=0;h<c.length;h++){let l=c[h];if(s=i=r=0,o=Math.abs(parseFloat(l.LQAtATime)),l.LQAtATime<0?l.LQTotNoofDays<o&&(t=t+"Apply minimum "+o+" days for this Leave Type\r\n"):l.LQTotNoofDays>o&&(t=t+"Can't Apply leaves more than AtATime leaves("+l.LQAtATime+") for leave type '"+l.LQLeaveType+"'\r\n"),l.LQTotNoofDays<=0&&(t=t+"Please check the NoOfDays for leave type '"+l.LQLeaveType+"'\r\n"),l.LQMaxLeaves>=0)l.LQTotNoofDays>l.LQAvlblDays&&(t=t+"Can't Apply leaves more than available leaves("+l.LQAvlblDays+") for leave type '"+l.LQLeaveType+"'\r\n");else if(-3==l.LQMaxLeaves){if((O=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase()))&&(O instanceof m.b&&!n.e.IsEmpty(O.Text)||O instanceof C.a&&!n.e.IsEmpty(O.Text))){let s="";(O instanceof m.b||O instanceof C.a)&&(s=s+" AND CC.dccCNID51= "+O.SelectedValue),e=this.ScreenObject.GridData.filter(e=>e.dccCNID52==l.LQLeaveType.toString()&&e.dcAlpha9==l.LQMaxLeaves),e.length>0&&(s=s+" AND CC.dccCNID52= "+parseInt(e[0].dccCNID52_Key));let i=a.a.common.GetDataSet3("PAY023",this.DocID.toString(),s);null!=i&&i.Tables[0].length>0&&parseInt(i.Tables[0][0][0])>0&&(t+="Can't apply morethan once in your Service for this Leave type")}}else if(-4==l.LQMaxLeaves&&(e=this.ScreenObject.GridData.filter(e=>e.dccCNID52==l.LQLeaveType.toString()&&e.dcAlpha9==l.LQMaxLeaves),e.length>0)){let o=new Date(parseInt(new Date(e[0].dcAlpha4_Key).ToString("yyyy")),parseInt(a.a.SessionManager.Preferences.LeaveYear.toString()),1),c=o.AddMonths(12).AddDays(-1);var O;if((O=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase()))&&(O instanceof m.b&&!n.e.IsEmpty(O.Text)||O instanceof C.a&&!n.e.IsEmpty(O.Text))){let h=[];h.push(o.ToString("dd/MMM/yyyy")),h.push(c.ToString("dd/MMM/yyyy")),(O instanceof m.b||O instanceof C.a)&&h.push(O.SelectedValue),h.push(parseInt(e[0].dccCNID52_Key)),h.push("Both"),h.push(a.a.SessionManager.UserID),h.push(a.a.SessionManager.LanguageID);let u=a.a.common.GetDataSet_SP(h,"spPAY_ExtGetAvlblNoofDays");if(null!=u&&u.Tables.length>0&&u.Tables[0].length>0){if(n.e.IsEmpty(u.Tables[0][0].LeavesTaken)||(s=parseFloat(u.Tables[0][0].LeavesTaken)),this.DocID>0){let t="";(O instanceof m.b||O instanceof C.a)&&(t=t+" AND CC.dccCNID51= "+O.SelectedValue),e.length>0&&(t=t+" AND CC.dccCNID52= "+parseInt(e[0].dccCNID52_Key));let s=a.a.common.GetDataSet3("PAY024",this.DocID.toString(),t);null!=s&&s.Tables[0].length>0&&parseInt(s.Tables[0][0][0])>0&&(r=parseFloat(s.Tables[0][0].NoofDays))}s-=r,i=s+parseFloat(l.LQTotNoofDays)}i>l.LQAssignedDays&&(t=t+"Can't Apply leaves more than Assigned leaves("+l.LQAssignedDays+") for leave type '"+l.LQLeaveType+"'\r\n")}}}if(""!=t)return this.DisplayMessage=t,this.MessageVisibility=!0,t}if(56==this.ScreenObject.DocumentType&&"No"!=this.strEmpIsMgr.toString()){var I=this.ScreenObject._TextFields.filter(e=>e instanceof u.d).find(e=>"dcalpha4"==e.DBColumnName.toLowerCase());if(I){if(0==parseFloat(I.Text))return this.DisplayMessage="Please Distribute Installments. No of Installments should be Grater Than 0",this.MessageVisibility=!0,this.DisplayMessage;if(this.ScreenObject.GridData.length>0){let t,s,i,a,n="";t=s=i=a=0;let r=new Date,o=new Date,l="0";if((T=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase()))&&(T instanceof m.b||T instanceof C.a)&&(l=T.SelectedValue.toString()),(I=this.ScreenObject._TextFields.filter(e=>e instanceof d.c).find(e=>"dcalpha5"==e.DBColumnName.toLowerCase()))&&(r=new Date(I.Date)),this.ScreenObject.GridDataColumns.Contains("dcAlpha6_Key")&&this.ScreenObject.GridData.length>0&&null!=this.ScreenObject.GridData[0].dcAlpha6_Key&&null!=this.ScreenObject.GridData[0].dcAlpha6_Key&&""!=this.ScreenObject.GridData[0].dcAlpha6_Key.toString().Trim()&&(o=new Date(this.ScreenObject.GridData[0].dcAlpha6_Key)),r.getMonth()!=o.getMonth()||r.getFullYear()!=o.getFullYear())return n="Distribute Installments, Deduction Month should be same in Header and Line wise. \r\n",this.DisplayMessage=n,this.MessageVisibility=!0,n;if((I=this.ScreenObject._TextFields.filter(e=>e instanceof u.d).find(e=>"dcalpha1"==e.DBColumnName.toLowerCase()))&&(t=parseFloat(I.Text)),(I=this.ScreenObject._TextFields.filter(e=>e instanceof u.d).find(e=>"dcalpha2"==e.DBColumnName.toLowerCase()))&&(s=parseFloat(I.Text)),(I=this.ScreenObject._TextFields.filter(e=>e instanceof u.d).find(e=>"dcalpha3"==e.DBColumnName.toLowerCase()))&&(a=parseFloat(I.Text)),s>t)return n="Approved loan amount should be less than or equal to Loan Amount\r\n",this.DisplayMessage=n,this.MessageVisibility=!0,n;if(parseFloat(this.ScreenObject.GridData.Compute("sum","dcNum2"))!=parseFloat(s.ToString("N2")))return n+="Total Installment(s) amount should be equal to Approved Amount\r\n",this.DisplayMessage=n,this.MessageVisibility=!0,n;if(a>s)return n+="Installment amount should be less than or equal to approved amount\r\n",this.DisplayMessage=n,this.MessageVisibility=!0,n;for(let c=0;c<this.ScreenObject.GridData.length;c++)if(null!=this.ScreenObject.GridData[c].dcAlpha6_Key&&null!=this.ScreenObject.GridData[c].dcAlpha6_Key&&""!=this.ScreenObject.GridData[c].dcAlpha6_Key.toString().Trim()){if(""!=(e=this.IsDocLocked(l,new Date(this.ScreenObject.GridData[c].dcAlpha6_Key),new Date(this.ScreenObject.GridData[c].dcAlpha6_Key),this.ScreenObject.DocumentType)))break;if(this.DocID>0){if(this.dsData=this.ScreenObject.CheckLoanRepayAmountDetails(this.DocID),0==this.dsData.Tables[1].filter(e=>e.LinkedInvDocDetailsID==parseInt(this.ScreenObject.GridData[c].DocDetailsID)).length&&this.CheckIsPayrollProcessed(new Date(this.ScreenObject.GridData[c].dcAlpha6_Key).ToString("dd/MMM/yyyy"),l)){n=n+"Payroll already processed for the Month : "+new Date(this.ScreenObject.GridData[c].dcAlpha6_Key).ToString("MMM/yyyy")+" to this Employee \r\n";break}}else if(this.CheckIsPayrollProcessed(new Date(this.ScreenObject.GridData[c].dcAlpha6_Key).ToString("dd/MMM/yyyy"),l)){n=n+"Payroll already processed for the Month : "+new Date(this.ScreenObject.GridData[c].dcAlpha6_Key).ToString("MMM/yyyy")+" to this Employee \r\n";break}}if(this.DocID>0){let e=this.ScreenObject.CheckLoanRepayAmountDetails(this.DocID);e.Tables.length>0&&e.Tables[0].length>0&&(i=parseFloat(e.Tables[0][0][0]),i>0&&s<i&&(n+="Can't change the approved loan amount of linked document\r\n"))}if(""!=n)return this.DisplayMessage=n,this.MessageVisibility=!0,n}}}if(58==this.ScreenObject.DocumentType&&this.ScreenObject.GridData.length>0){let e="",t=this.ScreenObject.GridData.filter(e=>!n.e.IsEmpty(e.dcCCNID52)),s=[];for(let i=0;i<t.length;i++){let e=s.find(e=>e.LQLeaveType==t[i].dcCCNID52);if(e)e.LQTotAppliedDays=n.e.Double(e.LQTotAppliedDays)+n.e.Double(t[i].dcAlpha3);else{let e={LQLeaveType:t[i].dcCCNID52,LQTotAppliedDays:n.e.Double(t[i].dcAlpha3),LQAvlblDays:n.e.Double(t[i].dcAlpha1),LQMaxEncash:n.e.Double(t[i].dcAlpha2),LQAppliedDays:n.e.Double(t[i].dcAlpha5),LQThresholdLimit:n.e.Double(t[i].dcAdcAlpha8lpha9)};s.push(e)}}for(let i=0;i<s.length;i++){let t=s[i];t.LQAppliedDays<0&&(e=e+"Please check the applied days for leave type '"+t.LQLeaveType+"'\r\n");let a=0;a=t.LQAvlblDays-t.LQThresholdLimit,a<0&&(a=0),a>t.LQMaxEncash&&(a=t.LQMaxEncash),t.LQTotAppliedDays>a&&(e=e+"You can not Encash more than ( "+a+" ) Days for leave type '"+t.LQLeaveType+"'\r\n")}if(""!=e)return this.DisplayMessage=e,this.MessageVisibility=!0,e}if(67==this.ScreenObject.DocumentType){let t="",s="1",i=null;for(let r=0;r<this.ScreenObject.GridData.length;r++)if(this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&null!=this.ScreenObject.GridData[r].ProductID_Key&&null!=this.ScreenObject.GridData[r].ProductID_Key&&""!=this.ScreenObject.GridData[r].ProductID_Key.toString()){t="",s="1",i=this.ScreenObject.GridData[r];let l=this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase());var f;if(null!=l?t=l.Date.ToString("dd/MMM/yyyy"):null==(f=this.ScreenObject.ColumnSource.find(e=>"dcalpha1"==e.DisplayMember.toLowerCase()))||n.e.IsEmpty(i[f.DisplayMember+"_Key"])||(t=new Date(i[f.DisplayMember+"_Key"]).ToString("dd/MMM/yyyy")),l=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase()),null!=l?(l instanceof m.b||l instanceof C.a)&&(s=l.SelectedValue.toString()):null!=(f=this.ScreenObject.ColumnSource.find(e=>"LISTBOX"==e.DataType.toUpperCase()&&"dcccnid51_key"==e.ValueMember.toLowerCase()))&&null!=i[f.ValueMember]&&null!=i[f.ValueMember]&&""!=i[f.ValueMember].toString()&&(s=i[f.ValueMember].toString()),""!=t&&parseInt(s)>1){if(""!=(e=this.IsDocLocked(s,new Date(t),new Date(t),this.ScreenObject.DocumentType))){if("PostingFromBiometric"==this.ScreenObject.ParentFlagName&&this.ScreenObject.Preferences.ContainsKey("SkipEmployeesWhoGetErrorsWhileSaving")&&!n.e.IsEmpty(this.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving)&&Object(o.j)(this.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving)){this.sBioErrLogs+="\r\n "+e+"\r\n ",this.ScreenObject.GridDataObj.removeRowAt(r),r--;continue}if(this.isDAValidate){this.sDAErrLogs+="\r\n "+e+"\r\n ",e="";continue}break}let l,c=null;if(c=this.GetHoursDefChart(t,i),null!=c&&c.length>0){let e,i,a=Date.Today(),n=Date.Today();this.drcc1=this.dtPayEmps.filter(e=>e.NodeID==s);let l="",h={dtdblOld:n,sVoucherNo:l};if(this.GetTotalEnteredHours(s,t,"dcNum1",h),n=h.dtdblOld,l=h.sVoucherNo,this.sHrs=parseFloat(c[0].MaxHrsPerDay).ToTime("00.00").split("."),a=a.AddHours(parseFloat(this.sHrs[0])).AddMinutes(parseFloat(this.sHrs[1])),e=new nt.TimeSpan(a.ToNumber()),i=new nt.TimeSpan(n.ToNumber()),i.TotalHours>e.TotalHours){if("PostingFromBiometric"==this.ScreenObject.ParentFlagName&&this.ScreenObject.Preferences.ContainsKey("SkipEmployeesWhoGetErrorsWhileSaving")&&""!=this.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving&&Object(o.j)(this.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving)){this.sBioErrLogs+="\r\n 'Total Hours' per day Exceeded for an Employee - "+this.drcc1[0].Code.toString()+l+"\r\n ",this.ScreenObject.GridDataObj.removeRowAt(r),r--;continue}if(this.isDAValidate){this.sDAErrLogs+="\r\n 'Total Hours' per day Exceeded for an Employee - "+this.drcc1[0].Code.toString()+l+"\r\n ";continue}return this.DisplayMessage="'Total Hours' per day Exceeded for an Employee - "+this.drcc1[0].Code.toString()+l,this.MessageVisibility=!0,this.DisplayMessage}if(a=Date.Today(),h={dtdblOld:n,sVoucherNo:l},this.GetTotalEnteredHours(s,t,"dcNum2",h),n=h.dtdblOld,l=h.sVoucherNo,this.sHrs=parseFloat(c[0].NormalHrs).ToTime("00.00").split("."),a=a.AddHours(parseFloat(this.sHrs[0])).AddMinutes(parseFloat(this.sHrs[1])),e=new nt.TimeSpan(a.valueOf()),i=new nt.TimeSpan(n.valueOf()),parseFloat(i.TotalHours)>parseFloat(e.TotalHours)){if("PostingFromBiometric"==this.ScreenObject.ParentFlagName&&this.ScreenObject.Preferences.ContainsKey("SkipEmployeesWhoGetErrorsWhileSaving")&&""!=this.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving&&Object(o.j)(this.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving)){this.sBioErrLogs+="\r\n 'Normal Working Hours' Exceeded for an Employee - "+this.drcc1[0].Code.toString()+l+"\r\n ",this.ScreenObject.GridDataObj.removeRowAt(r),r--;continue}if(this.isDAValidate){this.sDAErrLogs+="\r\n 'Normal Working Hours' Exceeded for an Employee - "+this.drcc1[0].Code.toString()+l+"\r\n ";continue}return Logger.DebugLog("Entered into the TRUE Block"),this.DisplayMessage="'Normal Working Hours' Exceeded for an Employee - "+this.drcc1[0].Code.toString()+l,this.MessageVisibility=!0,this.DisplayMessage}if(Logger.DebugLog("Entered into the FLASE Block"),a=Date.Today(),h={dtdblOld:n,sVoucherNo:l},this.GetTotalEnteredHours(s,t,"dcNum4",h),n=h.dtdblOld,l=h.sVoucherNo,this.sHrs=parseFloat(c[0].BreakHrs).ToTime("00.00").split("."),a=a.AddHours(parseFloat(this.sHrs[0])).AddMinutes(parseFloat(this.sHrs[1])),e=new nt.TimeSpan(a.ToNumber()),i=new nt.TimeSpan(n.ToNumber()),i.TotalHours>e.TotalHours){if("PostingFromBiometric"==this.ScreenObject.ParentFlagName&&this.ScreenObject.Preferences.ContainsKey("SkipEmployeesWhoGetErrorsWhileSaving")&&""!=this.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving&&Object(o.j)(this.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving)){this.sBioErrLogs+="\r\n 'Break Hours' Exceeded for an Employee - "+this.drcc1[0].Code.toString()+l+"\r\n ",this.ScreenObject.GridDataObj.removeRowAt(r),r--;continue}if(this.isDAValidate){this.sDAErrLogs+="\r\n 'Break Hours' Exceeded for an Employee - "+this.drcc1[0].Code.toString()+l+"\r\n ";continue}return this.DisplayMessage="'Break Hours' Exceeded for an Employee - "+this.drcc1[0].Code.toString()+l,this.MessageVisibility=!0,this.DisplayMessage}if(a=Date.Today(),h={dtdblOld:n,sVoucherNo:l},this.GetTotalEnteredHours(s,t,"dcNum5",h),n=h.dtdblOld,l=h.sVoucherNo,this.sHrs=parseFloat(c[0].OT1).ToTime("00.00").split("."),a=a.AddHours(parseFloat(this.sHrs[0])).AddMinutes(parseFloat(this.sHrs[1])),e=new nt.TimeSpan(a.ToNumber()),i=new nt.TimeSpan(n.ToNumber()),i.TotalHours>e.TotalHours){if(this.drcc2=this.ScreenObject.Data.Tables[0].filter(e=>"dcNum5"==e.SysColumnName),"PostingFromBiometric"==this.ScreenObject.ParentFlagName&&this.ScreenObject.Preferences.ContainsKey("SkipEmployeesWhoGetErrorsWhileSaving")&&""!=this.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving&&Object(o.j)(this.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving)){this.sBioErrLogs+="\r\n '"+this.drcc2[0].UserColumnName.toString()+"' Hours Exceeded for an Employee - "+this.drcc1[0].Code.toString()+l+"\r\n ",this.ScreenObject.GridDataObj.removeRowAt(r),r--;continue}if(this.isDAValidate){this.sDAErrLogs+="\r\n '"+this.drcc2[0].UserColumnName.toString()+"' Hours Exceeded for an Employee - "+this.drcc1[0].Code.toString()+l+"\r\n ";continue}return this.DisplayMessage="'"+this.drcc2[0].UserColumnName.toString()+"' Hours Exceeded for an Employee - "+this.drcc1[0].Code.toString()+l,this.MessageVisibility=!0,this.DisplayMessage}if(a=Date.Today(),h={dtdblOld:n,sVoucherNo:l},this.GetTotalEnteredHours(s,t,"dcNum7",h),n=h.dtdblOld,l=h.sVoucherNo,this.sHrs=parseFloat(c[0].OT2).ToTime("00.00").split("."),a=a.AddHours(parseFloat(this.sHrs[0])).AddMinutes(parseFloat(this.sHrs[1])),e=new nt.TimeSpan(a.ToNumber()),i=new nt.TimeSpan(n.ToNumber()),i.TotalHours>e.TotalHours){if(this.drcc2=this.ScreenObject.Data.Tables[0].filter(e=>"dcNum7"==e.SysColumnName),"PostingFromBiometric"==this.ScreenObject.ParentFlagName&&this.ScreenObject.Preferences.ContainsKey("SkipEmployeesWhoGetErrorsWhileSaving")&&""!=this.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving&&Object(o.j)(this.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving)){this.sBioErrLogs+="\r\n '"+this.drcc2[0].UserColumnName.toString()+"' Hours Exceeded for an Employee - "+this.drcc1[0].Code.toString()+l+"\r\n ",this.ScreenObject.GridDataObj.removeRowAt(r),r--;continue}if(this.isDAValidate){this.sDAErrLogs+="\r\n '"+this.drcc2[0].UserColumnName.toString()+"' Hours Exceeded for an Employee - "+this.drcc1[0].Code.toString()+l+"\r\n ";continue}return this.DisplayMessage="'"+this.drcc2[0].UserColumnName.toString()+"' Hours Exceeded for an Employee - "+this.drcc1[0].Code.toString()+l,this.MessageVisibility=!0,this.DisplayMessage}if(a=Date.Today(),h={dtdblOld:n,sVoucherNo:l},this.GetTotalEnteredHours(s,t,"dcNum9",h),n=h.dtdblOld,l=h.sVoucherNo,this.sHrs=parseFloat(c[0].OT3).ToTime("00.00").split("."),a=a.AddHours(parseFloat(this.sHrs[0])).AddMinutes(parseFloat(this.sHrs[1])),e=new nt.TimeSpan(a.ToNumber()),i=new nt.TimeSpan(n.ToNumber()),i.TotalHours>e.TotalHours){if(this.drcc2=this.ScreenObject.Data.Tables[0].filter(e=>"dcNum9"==e.SysColumnName),"PostingFromBiometric"==this.ScreenObject.ParentFlagName&&this.ScreenObject.Preferences.ContainsKey("SkipEmployeesWhoGetErrorsWhileSaving")&&""!=this.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving&&Object(o.j)(this.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving)){this.sBioErrLogs+="\r\n '"+this.drcc2[0].UserColumnName.toString()+"' Hours Exceeded for an Employee - "+this.drcc1[0].Code.toString()+l+"\r\n ",this.ScreenObject.GridDataObj.removeRowAt(r),r--;continue}if(this.isDAValidate){this.sDAErrLogs+="\r\n '"+this.drcc2[0].UserColumnName.toString()+"' Hours Exceeded for an Employee - "+this.drcc1[0].Code.toString()+l+"\r\n ";continue}return this.DisplayMessage="'"+this.drcc2[0].UserColumnName.toString()+"' Hours Exceeded for an Employee - "+this.drcc1[0].Code.toString()+l,this.MessageVisibility=!0,this.DisplayMessage}if(a=Date.Today(),h={dtdblOld:n,sVoucherNo:l},this.GetTotalEnteredHours(s,t,"dcNum11",h),n=h.dtdblOld,l=h.sVoucherNo,this.sHrs=parseFloat(c[0].OT4).ToTime("00.00").split("."),a=a.AddHours(parseFloat(this.sHrs[0])).AddMinutes(parseFloat(this.sHrs[1])),e=new nt.TimeSpan(a.ToNumber()),i=new nt.TimeSpan(n.ToNumber()),i.TotalHours>e.TotalHours){if(this.drcc2=this.ScreenObject.Data.Tables[0].filter(e=>"dcNum11"==e.SysColumnName),"PostingFromBiometric"==this.ScreenObject.ParentFlagName&&this.ScreenObject.Preferences.ContainsKey("SkipEmployeesWhoGetErrorsWhileSaving")&&""!=this.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving&&Object(o.j)(this.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving)){this.sBioErrLogs+="\r\n '"+this.drcc2[0].UserColumnName.toString()+"' Hours Exceeded for an Employee - "+this.drcc1[0].Code.toString()+l+"\r\n ",this.ScreenObject.GridDataObj.removeRowAt(r),r--;continue}if(this.isDAValidate){this.sDAErrLogs+="\r\n '"+this.drcc2[0].UserColumnName.toString()+"' Hours Exceeded for an Employee - "+this.drcc1[0].Code.toString()+l+"\r\n ";continue}return this.DisplayMessage="'"+this.drcc2[0].UserColumnName.toString()+"' Hours Exceeded for an Employee - "+this.drcc1[0].Code.toString()+l,this.MessageVisibility=!0,this.DisplayMessage}if(a=Date.Today(),h={dtdblOld:n,sVoucherNo:l},this.GetTotalEnteredHours(s,t,"dcNum13",h),n=h.dtdblOld,l=h.sVoucherNo,this.sHrs=parseFloat(c[0].OT5).ToTime("00.00").split("."),a=a.AddHours(parseFloat(this.sHrs[0])).AddMinutes(parseFloat(this.sHrs[1])),e=new nt.TimeSpan(a.ToNumber()),i=new nt.TimeSpan(n.ToNumber()),i.TotalHours>e.TotalHours){if(this.drcc2=this.ScreenObject.Data.Tables[0].filter(e=>"dcNum13"==e.SysColumnName),"PostingFromBiometric"==this.ScreenObject.ParentFlagName&&this.ScreenObject.Preferences.ContainsKey("SkipEmployeesWhoGetErrorsWhileSaving")&&""!=this.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving&&Object(o.j)(this.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving)){this.sBioErrLogs+="\r\n '"+this.drcc2[0].UserColumnName.toString()+"' Hours Exceeded for an Employee - "+this.drcc1[0].Code.toString()+l+"\r\n ",this.ScreenObject.GridDataObj.removeRowAt(r),r--;continue}if(this.isDAValidate){this.sDAErrLogs+="\r\n '"+this.drcc2[0].UserColumnName.toString()+"' Hours Exceeded for an Employee - "+this.drcc1[0].Code.toString()+l+"\r\n ";continue}return this.DisplayMessage="'"+this.drcc2[0].UserColumnName.toString()+"' Hours Exceeded for an Employee - "+this.drcc1[0].Code.toString()+l,this.MessageVisibility=!0,this.DisplayMessage}}if(""!=t&&parseInt(s)>1&&null!=this.dtPayEmps&&this.dtPayEmps.length>0&&(l=this.dtPayEmps.filter(e=>e.NodeId==s&&e.DOJ>new Date(t.toString())),null!=l&&l.length>0&&new Date(l[0].DOJ.toString())>new Date(t.toString()))){if("PostingFromBiometric"==this.ScreenObject.ParentFlagName&&this.ScreenObject.Preferences.ContainsKey("SkipEmployeesWhoGetErrorsWhileSaving")&&""!=this.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving&&Object(o.j)(this.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving)){this.sBioErrLogs+="\r\n Please Check The Employee Dependency With date Of joining "+l[0].Code.toString()+"\r\n ",this.ScreenObject.GridDataObj.removeRowAt(r),r--;continue}if(this.isDAValidate){this.sDAErrLogs+="\r\n Please Check The Employee Dependency With date Of joining "+l[0].Code.toString()+"\r\n ";continue}return this.DisplayMessage="Please Check The Employee Dependency With date Of joining "+l[0].Code.toString(),this.MessageVisibility=!0,this.DisplayMessage}let h=new Date(t),u=new Date(t).AddDays(1);n.e.IsEmpty(this.ScreenObject.GridData[r].dcalpha2)||n.e.IsEmpty(this.ScreenObject.GridData[r].dcalpha2_Key)||n.e.IsEmpty(this.ScreenObject.GridData[r].dcalpha3)||n.e.IsEmpty(this.ScreenObject.GridData[r].dcalpha3_Key)||new Date(t).ToString("dd/MMM/yyyy")!=new Date(this.ScreenObject.GridData[r].dcAlpha2_Key).ToString("dd/MMM/yyyy")&&(this.ScreenObject.GridData[r].dcAlpha2_Key=new Date(t).AddHours(new Date(this.ScreenObject.GridData[r].dcAlpha2_Key).getHours()).AddMinutes(new Date(this.ScreenObject.GridData[r].dcAlpha2_Key).getMinutes()).ToString("dd/MMM/yyyy HH:mm"),this.ScreenObject.GridData[r].dcAlpha3_Key=new Date(this.ScreenObject.GridData[r].dcalpha2)>new Date(this.ScreenObject.GridData[r].dcalpha3)?new Date(u).AddHours(new Date(this.ScreenObject.GridData[r].dcAlpha3_Key).getHours()).AddMinutes(new Date(this.ScreenObject.GridData[r].dcAlpha3_Key).getMinutes()).ToString("dd/MMM/yyyy HH:mm"):new Date(h).AddHours(new Date(this.ScreenObject.GridData[r].dcAlpha3_Key).getHours()).AddMinutes(new Date(this.ScreenObject.GridData[r].dcAlpha3_Key).getMinutes()).ToString("dd/MMM/yyyy HH:mm"));let d=this.ScreenObject.ColumnSource.find(e=>"dcalpha2"==e.DisplayMember.toLowerCase()),D=this.ScreenObject.ColumnSource.find(e=>"dcalpha3"==e.DisplayMember.toLowerCase());if(null!=d&&d.IsVisible&&null!=D&&D.IsVisible){this.drcc1=this.dtPayEmps.filter(e=>e.NodeID==s);let i=this.GetDuplicateTimingsOfEmployee(t,s,r);if(""!=i){try{parseInt(i),e="Employee has already worked on these timings, can't allow same timings. Check Timings of the Employee - "+this.drcc1[0].Code.toString()+" @ Row No - "+parseInt(i)}catch(E){e="Employee has already worked on these timings, can't allow same timings. Check Timings of the Employee - "+this.drcc1[0].Code.toString()+" @ Voucher No - "+i}if("PostingFromBiometric"==this.ScreenObject.ParentFlagName&&this.ScreenObject.Preferences.ContainsKey("SkipEmployeesWhoGetErrorsWhileSaving")&&""!=this.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving&&Object(o.j)(this.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving)){this.sBioErrLogs+="\r\n "+e+"\r\n ",e="",this.ScreenObject.GridDataObj.removeRowAt(r),r--;continue}if(this.isDAValidate){this.sDAErrLogs+="\r\n "+e+"\r\n ",e="";continue}break}}if(a.a.SessionManager.Preferences.ContainsKey("AllowDailyPayrollEntryforEmpOnleave")&&Object(o.j)("False"==a.a.SessionManager.Preferences.AllowDailyPayrollEntryforEmpOnleave)){this.drcc1=this.dtPayEmps.filter(e=>e.NodeID==s);let e=a.a.common.GetDataSet3("PAY025",s,t).Tables[0];if(null!=e&&e.length>0&&""!=n.e.String(e[0].LeaveMessage)){if("PostingFromBiometric"==this.ScreenObject.ParentFlagName&&this.ScreenObject.Preferences.ContainsKey("SkipEmployeesWhoGetErrorsWhileSaving")&&""!=this.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving&&Object(o.j)(this.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving)){this.sBioErrLogs+="\r\n "+e[0].LeaveMessage.toString()+" Check for the Employee - "+this.drcc1[0].Code.toString()+"\r\n ",this.ScreenObject.GridDataObj.removeRowAt(r),r--;continue}if(this.isDAValidate){this.sDAErrLogs+="\r\n "+e[0].LeaveMessage.toString()+" Check for the Employee - "+this.drcc1[0].Code.toString()+"\r\n ";continue}return this.DisplayMessage=e[0].LeaveMessage.toString()+" Check for the Employee - "+this.drcc1[0].Code.toString()+" @ Row No - "+(r+1),this.MessageVisibility=!0,this.DisplayMessage}}this.drcc1=this.dtPayEmps.filter(e=>e.NodeID==s);let S=a.a.common.GetDataSet3("PAY026",s,t).Tables[0];if(null!=S&&S.length>0){if("PostingFromBiometric"==this.ScreenObject.ParentFlagName&&this.ScreenObject.Preferences.ContainsKey("SkipEmployeesWhoGetErrorsWhileSaving")&&""!=this.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving&&Object(o.j)(this.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving)){this.sBioErrLogs+="\r\n Lates Processed For Employee - "+this.drcc1[0].Code.toString()+" @ Voucher No - "+S[0].VoucherNo+"\r\n ",this.ScreenObject.GridDataObj.removeRowAt(r),r--;continue}if(this.isDAValidate){this.sDAErrLogs+="\r\n Lates Processed For Employee - "+this.drcc1[0].Code.toString()+" @ Voucher No - "+S[0].VoucherNo+"\r\n ";continue}return this.DisplayMessage="Lates Processed For Employee - "+this.drcc1[0].Code.toString()+"@ Row No - "+(r+1)+" @ Voucher No - "+S[0].VoucherNo,this.MessageVisibility=!0,this.DisplayMessage}}}}if(92==this.ScreenObject.DocumentType){let e="DayWise";var T;(T=this.ScreenObject._TextFields.find(e=>"dcalpha4"==e.DBColumnName.toLowerCase()))instanceof D.e&&(e=T.SelectedValue);let t,s,i,r=null;if("DayWise"==e){let e=0;for(let t=0;t<this.ScreenObject.ColumnSource.length;t++)if(null!=this.ScreenObject.ColumnSource[t].DrRefColName&&""!=this.ScreenObject.ColumnSource[t].DrRefColName&&"Date"==this.ScreenObject.ColumnSource[t].DrRefColName){e++;break}if(0==e)return"No dates found. Assign atlest for one day.";{let e,t;if(e=this.ScreenObject.CustomTab.Pages[0].Fields.find(e=>e instanceof d.c&&"dcAlpha1"==e.DBColumnName),t=this.ScreenObject.CustomTab.Pages[0].Fields.find(e=>e instanceof d.c&&"dcAlpha2"==e.DBColumnName),new Date(this.ScreenObject.GridDataColumns[this.iDtColFrom].Replace("_Key","")).OnlyDate()!=e.Date)return this.DisplayMessage="Dates should be in between From Date and To Date",this.MessageVisibility=!0,this.DisplayMessage;if(new Date(this.ScreenObject.GridDataColumns[this.iDtColUpto].Replace("_Key","")).Date()!=t.Date)return this.DisplayMessage="Dates should be in between From Date and To Date",this.MessageVisibility=!0,this.DisplayMessage;if(this.ScreenObject.GridData.length>0){let t="",s="";for(let i=0;i<this.ScreenObject.GridData.length;i++)if(!n.e.IsEmpty(this.ScreenObject.GridData[i].dcCCNID51_Key)&&(t=this.ScreenObject.GridData[i].dcCCNID51_Key.toString(),r=a.a.common.GetDataSet("PAY027",t).Tables[0],null!=r&&r.length>0&&e.Date<new Date(r[0].DateOfJoining).Date))return this.DisplayMessage="From Date should be Grater than or Equal to the Date of Joining of the Employee : "+this.ScreenObject.GridData[i].dcCCNID51Code.toString(),this.MessageVisibility=!0,this.DisplayMessage;for(let e=0;e<this.ScreenObject.GridData.length;e++)if(!n.e.IsEmpty(this.ScreenObject.GridData[e].dcCCNID51_Key)){t=this.ScreenObject.GridData[e].dcCCNID51_Key.toString();for(let s=0;s<this.ScreenObject.GridData.length;s++)if(e!=s&&n.e.String(this.ScreenObject.GridData[s].dcCCNID51_Key)==t)return this.DisplayMessage="Shifts already asssigned for the Employee : "+this.ScreenObject.GridData[e].dcCCNID51Code.toString()+", check at Row : "+(s+1),this.MessageVisibility=!0,this.DisplayMessage}if(this.ScreenObject.Preferences.ContainsKey("AllowMultipleShiftAssignonsameday")&&!n.e.IsEmpty(this.ScreenObject.Preferences.AllowMultipleShiftAssignonsameday)&&"False"==this.ScreenObject.Preferences.AllowMultipleShiftAssignonsameday)for(let e=0;e<this.ScreenObject.GridData.length;e++)for(let i=this.iDtColFrom;i<=this.iDtColUpto;i++)if(this.ScreenObject.GridDataColumns[i].endsWith("_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[e].dcCCNID51_Key)&&(t=this.ScreenObject.GridData[e].dcCCNID51_Key.toString(),s=this.ScreenObject.GridDataColumns[i].Replace("_Key",""),r=a.a.common.GetDataSet3("PAY028",t,new Date(s).ToString("dd/MMM/yyyy"),this.ScreenObject.DocID.toString()).Tables[0],null!=r&&r.length>0))return this.DisplayMessage="Shifts already asssigned for the Employee : "+this.ScreenObject.GridData[e].dcCCNID51Code.toString()+", Dated : "+s+", check at Voucher No : "+r[0].VoucherNo.toString(),this.MessageVisibility=!0,this.DisplayMessage}}}else if(this.ScreenObject.GridDataColumns.Contains("dcCCNID51_Key")){let e=0;for(let t=0;t<this.ScreenObject.GridData.length;t++)if(!n.e.IsEmpty(this.ScreenObject.GridData[t].dcCCNID51_Key)){e++;break}if(0==e)return"No dates found. Assign atlest for one day.";let o="",l="",c="";r=a.a.common.GetDataTable("PAY097",this.ScreenObject.DocID.toString());for(let a=0;a<this.ScreenObject.GridData.length;a++)if(!n.e.IsEmpty(this.ScreenObject.GridData[a].dcCCNID51_Key)){if(t=null,s=null,i=null,o=this.ScreenObject.GridData[a].dcCCNID51_Key.toString(),l=new Date(this.ScreenObject.GridData[a].dcAlpha5_Key).ToString("dd MMM yyyy"),c=new Date(this.ScreenObject.GridData[a].dcAlpha6_Key).ToString("dd MMM yyyy"),new Date(l).Date>new Date(c).Date)return"AssignFrom Date should be lessthan or equal to AssignUpto Date @ Row No. "+(a+1).toString();if(t=this.dtPayEmps.filter(e=>e.NodeId==o),null!=t&&t.length>0&&parseInt(o)>1&&new Date(l).Date<new Date(t[0].DOJ).Date)return this.DisplayMessage="AssignFrom Date should be Grater than or Equal to the Date of Joining of the Employee : "+this.ScreenObject.GridData[a].dcCCNID51.toString()+" @ Row No. "+(a+1).toString(),this.DisplayMessage;if(i=this.ScreenObject.GridData.filter(e=>e.dcCCNID51_Key==o&&e.DocSeqNo!=a+1&&(e.dcAlpha5_Key<=l&&e.dcAlpha6_Key>=l||e.dcAlpha5_Key<=c&&e.dcAlpha6_Key>=c||e.dcAlpha5_Key>=l&&e.dcAlpha6_Key<=c)),null!=i&&i.length>0)return this.DisplayMessage="Shifts already asssigned for the Employee : "+this.ScreenObject.GridData[a].dcccnid51.toString()+", check at Row : "+i[0].DocSeqNo,this.MessageVisibility=!0,this.DisplayMessage;if(this.ScreenObject.Preferences.ContainsKey("AllowMultipleShiftAssignonsameday")&&!n.e.IsEmpty(this.ScreenObject.Preferences.AllowMultipleShiftAssignonsameday)&&"False"==this.ScreenObject.Preferences.AllowMultipleShiftAssignonsameday&&null!=r&&r.length>0&&(s=r.filter(e=>e.dcCCNID51==o&&(e.dcAlpha5<=l&&e.dcAlpha6>=l||e.dcAlpha5<=c&&e.dcAlpha6>=c||e.dcAlpha5>=l&&e.dcAlpha6<=c)),null!=s&&s.length>0))return this.DisplayMessage="Shifts already asssigned for the Employee : "+this.ScreenObject.GridData[a].dcccnid51.toString()+",  @ Row No. : "+(a+1)+", check at Voucher No : "+s[0].VoucherNo.toString(),this.MessageVisibility=!0,this.DisplayMessage}}}if(98==this.ScreenObject.DocumentType){var j=this.ScreenObject._TextFields.find(e=>"DCALPHA1"==e.DBColumnName.toUpperCase());if(j instanceof m.b&&j.SelectedValue>0){var P=this.ScreenObject._CCFields.find(e=>"DCCCNID51"==e.DBColumnName.toUpperCase());if(P instanceof m.b&&j.SelectedValue==P.SelectedValue)return"Delegator and Delegatee should not be same."}var A=this.ScreenObject._TextFields.find(e=>"DCALPHA3"==e.DBColumnName.toUpperCase());if(A instanceof D.e&&null!=A.SelectedValue&&"Temporary"==A.SelectedValue){if((M=this.ScreenObject._TextFields.find(e=>"DCALPHA4"==e.DBColumnName.toUpperCase()))instanceof d.c&&!M.Date)return"'Period From' and 'Period Upto' is Mandatory when the Type is 'Temporary'";if((M=this.ScreenObject._TextFields.find(e=>"DCALPHA5"==e.DBColumnName.toUpperCase()))instanceof d.c&&!M.Date)return"'Period From' and 'Period Upto' is Mandatory when the Type is 'Temporary'"}else{var M;if(null!=(M=this.ScreenObject._TextFields.find(e=>"DCALPHA4"==e.DBColumnName.toUpperCase()))&&M instanceof d.c&&!M.Date)return"'Period From' is Mandatory when the Type is 'Permanent'";if(!confirm("Do you want to update the Delegatee at Employee Level.?"))return"Cancelled by the User."}}if(75==this.ScreenObject.DocumentType){let e=a.a.common.GetDataSet("PAY067",this.ScreenObject.DocID.toString()).Tables[0];if(null!=e&&e.length>0)return this.DisplayMessage="Final Settlement Already Posted For This Grade",this.MessageVisibility=!0,this.DisplayMessage}if(77==this.ScreenObject.DocumentType){let e=0,t="",s="",i=a.a.common.GetDataSet("PAY068","");if(null!=i&&i.Tables.length>0&&null!=i.Tables[0]&&i.Tables[0].length>0){for(let a=0;a<i.Tables[0].length;a++){t=i.Tables[0][a].SysColumnName.toString();let n=this.ScreenObject._CCFields.find(e=>e.DBColumnName.toLowerCase()==t.toLowerCase());null!=n&&null!=n&&(n instanceof m.b||n instanceof C.a)&&(e=n.SelectedValue),s+=" AND "+t+"="+e}let n=a.a.common.GetDataSet3("PAY069",JSON.stringify(s),this.DocID.toString(),"").Tables[0];if(null!=n&&n.length>0)return this.DisplayMessage="Data Already Available for this Dimensions on Document No. - "+n[0].VoucherNo,this.MessageVisibility=!0,this.DisplayMessage}}if(99==this.ScreenObject.DocumentType){let t="",s="1",i=null;for(let e=0;e<this.ScreenObject.GridData.length;e++){if(this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[e].ProductID_Key)){t="",s="1",i=this.ScreenObject.GridData[e];let a=this.ScreenObject._TextFields.find(e=>"dcAlpha3"==e.DBColumnName.toLowerCase());if(null!=a)t=a.Date.ToString("dd/MMM/yyyy");else{let e=this.ScreenObject.ColumnSource.find(e=>"dcalpha3"==e.DisplayMember.toLowerCase());null==e||n.e.IsEmpty(i[e.DisplayMember+"_Key"])||(t=new Date(i[e.DisplayMember+"_Key"]).ToString("dd/MMM/yyyy"))}if(a=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase()),null!=a)(a instanceof m.b||a instanceof C.a)&&(s=a.SelectedValue.toString());else{let e=this.ScreenObject.ColumnSource.find(e=>"LISTBOX"==e.DataType.toUpperCase()&&"dcccnid51_key"==e.ValueMember.toLowerCase());null==e||n.e.IsEmpty(i[e.ValueMember])||(s=i[e.ValueMember].toString())}if(""!=t&&parseInt(s)>1){let s=new Date(t),i=new Date(t).AddDays(1);null!=this.ScreenObject.GridData[e].dcAlpha8&&null!=this.ScreenObject.GridData[e].dcAlpha8&&""!=this.ScreenObject.GridData[e].dcAlpha8.toString()&&null!=this.ScreenObject.GridData[e].dcAlpha8_Key&&null!=this.ScreenObject.GridData[e].dcAlpha8_Key&&""!=this.ScreenObject.GridData[e].dcAlpha8_Key.toString()&&null!=this.ScreenObject.GridData[e].dcAlpha9&&null!=this.ScreenObject.GridData[e].dcAlpha9&&""!=this.ScreenObject.GridData[e].dcAlpha9.toString()&&null!=this.ScreenObject.GridData[e].dcAlpha9_Key&&null!=this.ScreenObject.GridData[e].dcAlpha9_Key&&""!=this.ScreenObject.GridData[e].dcAlpha9_Key.toString()&&(this.ScreenObject.GridData[e].dcAlpha8_Key=new Date(t).AddHours(new Date(this.ScreenObject.GridData[e].dcAlpha8_Key).getHours()).AddMinutes(new Date(this.ScreenObject.GridData[e].dcAlpha8_Key).getMinutes()).ToString("dd/MMM/yyyy HH:mm"),this.ScreenObject.GridData[e].dcAlpha9_Key=new Date(this.ScreenObject.GridData[e].dcAlpha8)>new Date(this.ScreenObject.GridData[e].dcAlpha9)?new Date(i).AddHours(new Date(this.ScreenObject.GridData[e].dcAlpha9_Key).getHours()).AddMinutes(new Date(this.ScreenObject.GridData[e].dcAlpha9_Key).getMinutes()).ToString("dd/MMM/yyyy HH:mm"):new Date(s).AddHours(new Date(this.ScreenObject.GridData[e].dcAlpha9_Key).getHours()).AddMinutes(new Date(this.ScreenObject.GridData[e].dcAlpha9_Key).getMinutes()).ToString("dd/MMM/yyyy HH:mm"))}}this.ScreenObject.GridDataObj.updateRow(this.ScreenObject.GridData[e])}if(a.a.SessionManager.Preferences.ContainsKey("MaxAllowedMinToRegularizeDocument")&&!n.e.IsEmpty(a.a.SessionManager.Preferences.MaxAllowedMinToRegularizeDocument)){let t=this.ValidateMaxAllowedAbsenseMinutes(s);t.length>0&&(e=t)}}Logger.InfoLog("AddEditDocumentViewModel::Exiting CheckDocumentValidationsOnSave")}catch(w){e="Problem processing your request please contact administrator",Logger.ErrorLog("AddEditDocumentViewModel:: CheckDocumentValidationsOnSave"+w.stack)}return e}ValidateMaxAllowedAbsenseMinutes(e){let t="";if(this.ScreenObject.GridData.length>0){let s,i,r,l,c,h=new Array,u=this.ScreenObject.GridData.Compute("min","dcAlpha3_Key"),d=this.ScreenObject.GridData.Compute("max","dcAlpha3_Key"),D=new Date,S=new Date;null!=u&&(D=new Date(u)),null!=d&&(S=new Date(d));let m={dtPM:r,dtFrom:s,dtTo:i};n.e.SetPayrollDate(D.Date(),m),r=m.dtPM,s=m.dtFrom,i=m.dtTo,h.push(r),m={dtPM:r,dtFrom:s,dtTo:i},n.e.SetPayrollDate(S.Date(),m),r=m.dtPM,s=m.dtFrom,i=m.dtTo,h.Contains(r)||h.push(r);let b,C=a.a.common.GetDataSet3("PAY093",s.Date.ToString("dd MMM yyyy")+"~"+i.Date.ToString("dd MMM yyyy"),this.ScreenObject.DocID+"~"+e,a.a.SessionManager.Preferences.MaxAllowedMinToRegularizeDocument),p=C.Tables[0],y=0,g=0,O=new Date,I=this.ScreenObject._TextFields.find(e=>"DCALPHA10"==e.DBColumnName.toUpperCase());null!=I&&(O=I.Date);let f=[];f.push(O.Date().ToString("dd MMM yyyy")),f.push(" AND EmpSeqNo="+e),f.push(0),f.push(a.a.SessionManager.RoleID),f.push(a.a.SessionManager.UserID),f.push(a.a.SessionManager.LanguageID);let T=a.a.common.GetDataSet_SP(f,"spPAY_GetEmpMasterCCDetails"),j=0,P="",A="";if(null!=C.Tables[1]&&C.Tables[1].length>0)for(let t=0;t<C.Tables[1].length;t++){P=C.Tables[1][t].SysColumnName.toString();let s=T.Tables[0].filter(t=>t.EmpSeqNo==e);null!=s&&s.length>0&&(j=parseInt(s[0]["CCNID"+P.Replace("dcCCNID","")])),A.length>0&&(A+=" AND "),A+=P+"="+j}let M=a.a.common.GetDataTable("PAY094",a.a.SessionManager.Preferences.MaxAllowedMinToRegularizeDocument+"~"+A);if(M.length>0&&(g=parseFloat(M[0].MaxMinutes)),g>0){let e=0,s=h[0];for(;h.length>e&&s<=h[e];){y=0;let i={dtPM:r,dtPMS:l,dtPME:c};if(n.e.SetPayrollDate(s.Date(),i),r=i.dtPM,l=i.dtPMS,c=i.dtPME,null!=p&&p.length>0&&(b=p.filter(e=>e.DADate>=l.ToString("dd MMM yyyy")&&e.DADate<=c.ToString("dd MMM yyyy")),null!=b&&b.length>0))for(let e=0;e<b.length;e++)if(n.e.IsEmpty(b[e].AdjChkInMins)||(y+=parseFloat(b[e].AdjChkInMins)),n.e.IsEmpty(b[e].AdjChkOutMins)||(y+=parseFloat(b[e].AdjChkOutMins)),y>g)return t="Maximum Allowed Absense minutes exceeded for the Payroll Month : "+r.ToString("MMM, yyyy"),t;if(y>g)return t="Maximum Allowed Absense minutes exceeded for the Payroll Month : "+r.ToString("MMM, yyyy"),t;if(b=this.ScreenObject.GridData.filter(e=>e.dcAlpha3_Key>=l.ToString("dd MMM yyyy")&&e.dcAlpha3_Key<=c.ToString("dd MMM yyyy")&&"True"==e.dcAlpha12),null!=b&&b.length>0){let e=0,s=0;for(let i=0;i<b.length;i++)if(Object(o.j)(b[i].dcAlpha12)&&(e=new Date(b[i].dcAlpha4_Key).Subtract(new Date(b[i].dcAlpha8_Key)).TotalMinutes,s=new Date(b[i].dcAlpha9_Key).Subtract(new Date(b[i].dcAlpha5_Key)).TotalMinutes,y+=e,y+=s,y>g))return t="Maximum Allowed Absense minutes exceeded for the Payroll Month : "+r.ToString("MMM, yyyy"),t;if(y>g)return t="Maximum Allowed Absense minutes exceeded for the Payroll Month : "+r.ToString("MMM, yyyy"),t}e++,s=s.AddMonths(1)}}}return t}CheckIsPayrollProcessed(e,t){let s=a.a.common.GetDataSet3("PAY030",t,e).Tables[0];return null!=s&&s.length>0}FillPostPastSalEarningDeductionDtls(e){e&&(null!=e.SelectedDateChanged||a.a.SessionManager.IsWebApplication)&&(this.FillEarnDeductDetails(1,parseInt(new Date(e.Date).ToString("yyyy"))),this.DimensionSelectedvalueData())}dtpBulkApprEffectFrom_SelectedDateChanged(e){if(null!=e.Date&&e.SelectedDateChanged.IsSubscribed&&e.Date){let s=e.Date;e.Date=new Date(s.getFullYear(),s.getMonth(),1);var t=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase());null!=t&&t instanceof d.c&&(t.Date=e.Date)}}FillComponentsBasedOnGradeSlabs(e,t){if(a.a.SessionManager.Preferences.ContainsKey("ConsiderGradeWiseSalarySlabs")&&"True"==a.a.SessionManager.Preferences.ConsiderGradeWiseSalarySlabs){let s="0",i=this.ScreenObject._CCFields.find(e=>"dcccnid53"==e.DBColumnName.toLowerCase());null!=i&&(i instanceof m.b||i instanceof C.a)&&(s=i.SelectedValue.toString());let r=a.a.common.GetDataTable("DOC054",s+"~"+e);if(null!=r&&r.length>0){if(n.e.IsEmpty(r[0].ComponentID)||!(parseInt(r[0].ComponentID)>0))return this.DisplayMessage="Employee Already has same Grade,Please Change the Grade  ",void(this.MessageVisibility=!0);{let s=null,i=0;this.ScreenObject.GridDataObj.Clear();let a=this.ScreenObject.Data.Tables[0].filter(e=>"ProductID"==e.SysColumnName);for(let o=0;o<r.length;o++)if(this.ValidateGradeWiseSalarySlabsApplicableFormula(r[o],e)){s=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridDataObj.insertRowAt(s,i),i++,a.length>0&&!n.e.IsEmpty(a[0].UserDefaultValue)&&(s.ProductID_Key=a[0].UserDefaultValue),s.dcCCNID52_Key=r[o].ComponentID,s.dcCCNID52=r[o].ComponentName;let e=0,l=0;e=n.e.Double(r[o].MinAmount),l=n.e.Double(r[o].MaxAmount),s.dcNum1="PickMin"==t?e.toString():l.toString()}}}}}ValidateGradeWiseSalarySlabsApplicableFormula(e,t){if(null!=e&&null!=e.ApplicableFormula&&null!=e.ApplicableFormula&&""!=e.ApplicableFormula.toString().Trim()){let i=new ct.b;i.sEmpSeqNo=t.toString();let a={PayrollMonth:i.PayrollMonth,PayrollMonthStart:i.PayrollMonthStart,PayrollMonthEnd:i.PayrollMonthEnd};n.e.SetPayrollDate(new Date,a),i.PayrollMonth=a.PayrollMonth,i.PayrollMonthStart=a.PayrollMonthStart,i.PayrollMonthEnd=a.PayrollMonthEnd,i.arrLstCPFields[6].Clear();let r=new ct.a;r.ComponentName="GrdWiseSalSlabsFormula",r.SNo=1,r.Formula=e.ApplicableFormula.toString(),r.dEarned=r.dActual="0",i.arrLstCPFields[6].push(r),i.Intialize(),i.othMPField.BasicMonthly=0,i.othMPField.TotalLeaves=0,i.othMPField.DaysAttended=i.othMPField.TotalDays;let o=new Date;var s=this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase());if(null!=s&&null!=s&&s instanceof d.c&&(o=s.Date),i.isValidBulkAppraisal=!0,i.EffectFrom=o,i.ExecuteAllFormulas(),"GrdWiseSalSlabsFormula"==i.arrLstCPFields[6][0].ComponentName)return 0!=parseFloat(i.arrLstCPFields[6][0].dEarned)}return!0}BulkAppraisalsInsert(){let e=this.ScreenObject.GridData;if(null!=e&&e.length>0){let s=null,i=0,r=0,o=0,l=0,c=!1,h="",D="",S=Date.Today(),b=Date.Today(),p=Date.Today(),y=!1;if(null!=!n.e.IsEmpty(e[0].dcCCNID51_Key)&&(y=!0),y){let m,C=e.ToTable(!0,"dcCCNID51_Key");if(null!=C&&C.length>0)for(let y=0;y<C.length;y++)if(!n.e.IsEmpty(C[y].dcCCNID51_Key)&&(i=parseInt(C[y].dcCCNID51_Key),m=e.filter(e=>e.dcCCNID51_Key==i),null!=m&&m.length>0)){let e=this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase());if(null!=e&&null!=e&&e instanceof d.c)S=e.Date;else{let e=this.ScreenObject.ColumnSource.find(e=>"dcalpha1"==e.DisplayMember.toLowerCase());null==e||null==e||n.e.IsEmpty(m[0][e.DisplayMember+"_Key"])||(S=new Date(m[0][e.DisplayMember+"_Key"]))}if(e=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase()),null!=e&&null!=e&&e instanceof d.c)b=e.Date;else{let e=this.ScreenObject.ColumnSource.find(e=>"dcalpha2"==e.DisplayMember.toLowerCase());null==e||null==e||n.e.IsEmpty(m[0][e.DisplayMember+"_Key"])||(b=new Date(m[0][e.DisplayMember+"_Key"]))}if(e=this.ScreenObject._TextFields.find(e=>"dcalpha4"==e.DBColumnName.toLowerCase()),null!=e&&null!=e&&e instanceof d.c)p=e.Date;else{var t=this.ScreenObject.ColumnSource.find(e=>"dcalpha4"==e.DisplayMember.toLowerCase());null==t||null==t||n.e.String(m[0][t.DisplayMember+"_Key"])||(p=new Date(m[0][t.DisplayMember+"_Key"]))}e=this.ScreenObject._TextFields.find(e=>"dcalpha6"==e.DBColumnName.toLowerCase()),null!=e&&null!=e&&e instanceof u.d&&!n.e.String(e.Text)&&(D=e.Text),e=this.ScreenObject._TextFields.find(e=>"dcalpha7"==e.DBColumnName.toLowerCase()),null!=e&&null!=e&&e instanceof u.d&&!n.e.String(e.Text)&&(h=e.Text);let C=a.a.common.GetDataSet3("PAY031",i.toString(),S.ToString("dd/MMM/yyyy")).Tables[0];o=null!=C&&C.length>0?parseInt(C[0].SeqNo):0,s=new Mt.a(null,i,new Date,o),s.isFromBulkAppraisals=!0,s.EffectFrom.Date=S,s.ActAppraisalFrom.Date=b,s.NextAppraisal.Date=p,s.Remarks.Text=h,s.Reason.Text=D;for(let t=0;t<m.length;t++){r=parseInt(m[t].dcCCNID52_Key),l=parseFloat(m[t].dcNum1),c=!1;for(let e=0;e<s.dgvEarnings.Table.length;e++)if(s.dgvEarnings.Table[e].EarComponentID.toString()==r.toString()){s.dgvEarnings.Table[e].EarValue=l,c=!0;break}if(!c)for(let e=0;e<s.dgvDeductions.Table.length;e++)if(s.dgvDeductions.Table[e].DedComponentID.toString()==r.toString()){s.dgvDeductions.Table[e].DedValue=l;break}}if(s.ExecuteFormulas(),s.OnButtonClick("Save"),null!=s.DisplayMessage&&s.DisplayMessage.length>0)return this.DisplayMessage=s.DisplayMessage,!1;this.sApprUpdate+=s.strUpdate}}else{let t=this.ScreenObject._CCFields.find(e=>"dcCCNID51"==e.DBColumnName);if(null!=t){if(null==t.SelectedValue||""==n.e.String(t.SelectedValue))return this.DisplayMessage="Select Employee",!1;i=t.SelectedValue}let y="0";if(this.ScreenObject.Preferences.ContainsKey("UpdateGradeandAppraisalData")&&"True"==this.ScreenObject.Preferences.UpdateGradeandAppraisalData){let e=this.ScreenObject._CCFields.find(e=>"dcccnid53"==e.DBColumnName.toLowerCase());null!=e&&(e instanceof m.b||e instanceof C.a)&&(y=e.SelectedValue.toString())}let g=this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase());null!=g&&null!=g&&g instanceof d.c&&(S=g.Date),g=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase()),null!=g&&null!=g&&g instanceof d.c&&(b=g.Date),g=this.ScreenObject._TextFields.find(e=>"dcalpha4"==e.DBColumnName.toLowerCase()),null!=g&&null!=g&&g instanceof d.c&&(p=g.Date),g=this.ScreenObject._TextFields.find(e=>"dcalpha6"==e.DBColumnName.toLowerCase()),null!=g&&null!=g&&g instanceof u.d&&!n.e.IsEmpty(g.Text)&&(D=g.Text),g=this.ScreenObject._TextFields.find(e=>"dcalpha7"==e.DBColumnName.toLowerCase()),null!=g&&null!=g&&g instanceof u.d&&!n.e.IsEmpty(g.Text)&&(h=g.Text);let O=a.a.common.GetDataSet3("PAY031",i.toString(),S.ToString("dd/MMM/yyyy")).Tables[0];o=null!=O&&O.length>0?parseInt(O[0].SeqNo):0,s=new Mt.a(null,i,new Date,o),s.isFromBulkAppraisals=!0,s.EffectFrom.Date=S,s.ActAppraisalFrom.Date=b,s.NextAppraisal.Date=p,s.Remarks.Text=h,s.Reason.Text=D,s.sBulkAppraisalGrade=y;for(let i=0;i<e.length;i++)if(!n.e.IsEmpty(e[i].dcCCNID52_Key)){r=parseInt(e[i].dcCCNID52_Key),l=parseFloat(e[i].dcNum1),c=!1;for(let e=0;e<s.dgvEarnings.Table.length;e++)if(s.dgvEarnings.Table[e].EarComponentID.toString()==r.toString()){s.dgvEarnings.Table[e].EarValue=l,c=!0;break}if(!c)for(let e=0;e<s.dgvDeductions.Table.length;e++)if(s.dgvDeductions.Table[e].DedComponentID.toString()==r.toString()){s.dgvDeductions.Table[e].DedValue=l;break}}if(s.ExecuteFormulas(),s.OnButtonClick("Save"),null!=s.DisplayMessage&&s.DisplayMessage.length>0)return this.DisplayMessage=s.DisplayMessage,!1;this.sApprUpdate+=s.strUpdate}if((null==this.DisplayMessage||0==this.DisplayMessage.length)&&this.sApprUpdate.length>0)return!0}return!1}ShowVacationCreditDaysDetail(e,t=0){if(this.ScreenObject.Preferences.ContainsKey("ShowVacationCreditDaysDetail")&&!n.e.IsEmpty(this.ScreenObject.Preferences.ShowVacationCreditDaysDetail)&&Object(o.j)(this.ScreenObject.Preferences.ShowVacationCreditDaysDetail)&&(this.SetVisibiltiFalse(),this.VacCrDaysVisibility=!0),0==e)return;let s=new Date,i=new Date,r=0;var l=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase());l instanceof d.c&&l.Date&&(s=l.Date),(l=this.ScreenObject._TextFields.find(e=>"dcalpha3"==e.DBColumnName.toLowerCase()))instanceof d.c&&l.Date&&(i=l.Date),(l=this.ScreenObject._TextFields.find(e=>"dcalpha22"==e.DBColumnName.toLowerCase()))instanceof u.d&&!n.e.IsEmpty(l.Text)&&(r=parseFloat(l.Text)),a.a.SessionManager.Preferences.ContainsKey("CalcVacDaysuptolastmonth")&&Object(o.j)(a.a.SessionManager.Preferences.CalcVacDaysuptolastmonth)&&(s=s.AddDays(-(s.getDate()-1)));let c=this.ScreenObject.GetVacationDays(s,i,e,this.DocID,r,0);if(0==this.VacCrDaysScreen.length&&null!=c&&c.Tables.length>0){if(this.ScreenObject.Preferences.ContainsKey("ShowVacationCreditDaysDetail")&&!n.e.IsEmpty(this.ScreenObject.Preferences.ShowVacationCreditDaysDetail)&&Object(o.j)(this.ScreenObject.Preferences.ShowVacationCreditDaysDetail)){let t=new kt(e,c.Tables[5]);this.VacCrDaysScreen.push(t)}}else if(null!=c&&c.Tables.length>0&&this.ScreenObject.Preferences.ContainsKey("ShowVacationCreditDaysDetail")&&!n.e.IsEmpty(this.ScreenObject.Preferences.ShowVacationCreditDaysDetail)&&Object(o.j)(this.ScreenObject.Preferences.ShowVacationCreditDaysDetail)){const t=this.VacCrDaysScreen[0];t.dgv.Clear(),t.BindGrid(e,c.Tables[5])}}PayrollMonthTypeOfField_SelectedDateChanged(e){if(e instanceof d.c&&e.Date){let t=e.Date;e.Date=new Date(t.getFullYear(),t.getMonth(),1)}}EmpFilter_Click(e){if(this.sEmpFilter="",this.DialogResult=this.objEmpFilter.IsCompleted,this.objEmpFilter.IsCompleted){if(this.objEmpFilter.CostCenterFilters.length>0){let e=1,t="",s="",i="";for(let a=0;a<this.objEmpFilter.CostCenterFilters.length;a++){let n=this.objEmpFilter.CostCenterFilters[a];n.CostCenterID>5e4&&(e=2,t="NodeID",s=50051==n.CostCenterID?"EmpSeqNo":"CCNID"+(n.CostCenterID-5e4)),n.SelectedNodes.length>0?1==n.SelectedNodes.length?(i+=" AND ",i+=s+"="+n.SelectedNodes[0].Id):n.SelectedNodes.find(t=>t.Id==e&&t.IsGroup)||(i+=" AND "):n.DeleteButtonVisibility||(i+=" AND ",i+=s+"=-12912")}this.sEmpFilter=i.toString()}return this.FilterPayEmployees(e)}return Logger.InfoLog("AddEditDocumentsPayroll::Exiting EmpFilter_Click()"),""}FilterPayEmployees(e){let t="";try{a.a.SessionManager.LocationID>0&&a.a.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&a.a.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sEmpFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+a.a.SessionManager.LocationID+")"),n.e.IsEmpty(a.a.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sEmpFilter+="  AND EmpSeqNo IN ("+a.a.SessionManager.sWHEmpFilteredEmpSeqNos+")");let s=[];s.push(e.ToString("dd MMM yyyy")),s.push(this.sEmpFilter),s.push(0),s.push(a.a.SessionManager.RoleID),s.push(a.a.SessionManager.UserID),s.push(a.a.SessionManager.LanguageID);let i=a.a.common.GetDataSet_SP(s,"spPAY_GetEmpMasterCCDetails");if(null!=i&&i.Tables.length>0&&i.Tables[0].length>0){for(let e=0;e<i.Tables[0].length;e++)t.Trim().length>0&&(t+=","),t+=i.Tables[0][e].EmpSeqNo.toString();return t.length>0?t:(this.DisplayMessage="No data found for the selected Criteria.",this.MessageVisibility=!0,"")}return Logger.InfoLog("AddEditDocumentsPayroll::Exiting FilterPayEmployees()"),""}catch(s){return Logger.ErrorLog("AddEditDocumentsPayroll::EXCEPTION FilterPayEmployees()"+s.stack),""}}DoLateConsiderations(e){if(a.a.SessionManager.Preferences.ContainsKey("ConsiderLatesConfig")&&"True"==a.a.SessionManager.Preferences.ConsiderLatesConfig&&a.a.SessionManager.Preferences.ContainsKey("LatesConfigBasedOn")&&""!=a.a.SessionManager.Preferences.LatesConfigBasedOn.toString().Trim()){let s=!1,i=a.a.SessionManager.Preferences.LatesConfigBasedOn;"50073"==i&&(s=!0);let o=i.split(","),l=e.split(",");if(l.length>0&&o.length>0){var t=this.ScreenObject._TextFields.find(e=>"dcalpha16"==e.DBColumnName.toLowerCase());if(t instanceof d.c&&!t.Date)return this.DisplayMessage="Select Payroll Month",this.MessageVisibility=!0,void(t.SetFocus=!0);let i=new Date(t.Date.getFullYear(),t.Date.getMonth(),1),c={PayrollMonth:this.dtPayMon,PayrollMonthStart:this.dtPayMonStart,PayrollMonthEnd:this.dtPayMonEnd,LatesMonth:this.dtLatesMonth,LatesMonthStart:this.dtLatesMonthStart,LatesMonthEnd:this.dtLatesMonthEnd};n.e.SetPayrollDate(i,c),this.dtPayMon=c.PayrollMonth,this.dtPayMonStart=c.PayrollMonthStart,this.dtPayMonEnd=c.PayrollMonthEnd,this.dtLatesMonth=c.LatesMonth,this.dtLatesMonthStart=c.LatesMonthStart,this.dtLatesMonthEnd=c.LatesMonthEnd;let h=a.a.common.GetDataSet3("PAY032",e,this.dtLatesMonth.ToString("dd/MMM/yyyy"),this.dtLatesMonthStart.ToString("dd/MMM/yyyy")+","+this.dtLatesMonthEnd.ToString("dd/MMM/yyyy")),u=[];u.push(a.a.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")),u.push(" a.IsGroup=0 AND a.NodeID IN("+e+")"),u.push("");let D,S=a.a.common.GetDataSet_SP(u,"spPAY_GetEmpDimensionsAsOnDate").Tables[0],m=a.a.common.GetDataTable("PAY095",e+"~"+this.dtLatesMonthStart.ToString("dd MMM yyyy")+"~"+this.dtLatesMonthEnd.ToString("dd MMM yyyy")),b=a.a.common.GetDataTable("PAY096",""),C=0,p=this.ScreenObject.Data.Tables[0].filter(e=>"ProductID"==e.SysColumnName);p.length>0&&!n.e.IsEmpty(p[0].UserDefaultValue)&&(C=parseInt(p[0].UserDefaultValue));let y,g,O,I,f,T,j="",P="",A="",M=new Date,G=new Date,N=new Date,E=new Date,w=new Date,F=0,V=0,L=0,R=0,B=0,v=null,x=null;for(let e=0;e<l.length;e++){if(D=new r.a,null!=h&&h.Tables.length>0&&h.Tables[1].length>0)for(let e=0;e<h.Tables[1].length;e++)D.ContainsKey(h.Tables[1][e].DISTDeviation.toString()+"_NDMT")||(D.push(h.Tables[1][e].DISTDeviation.toString()+"_NDMT",0),D.push(h.Tables[1][e].DISTDeviation.toString()+"_FENDMT",0),D.push(h.Tables[1][e].DISTDeviation.toString()+"_IsNDMTDone",0));if(A=l[e],I=S.filter(e=>e.EmpSeqNo==A),null!=I&&I.length>0){let e;if(R=0,o.filter(e=>e.length>1).length>0){if(g=this.DoLate_Filter(h.Tables[1],I[0]).filter(e=>e.WEF<=this.dtLatesMonthEnd.Date()),g.sort((e,t)=>e.WEF<t.WEF?1:e.WEF>t.WEF?-1:0),s||g.length>0&&(B=parseInt(g[0].DocID),g=h.Tables[1].filter(e=>e.DocID==B),g.length>0&&(e=g,g=e,j=g[0].IncludeRExclude.toString())),y=h.Tables[0](e=>e.EmpSeqNo==A),y.sort((e,t)=>e.DailyAttDate>t.DailyAttDate||e.DailyAttDate==t.DailyAttDate&&e.StartTime>t.StartTime?1:-1),y.length>0){v=[],v=y.ToTable(!0,["DailyAttDate"]);for(let t=0;t<v.length;t++){if(M=new Date(v[t].DailyAttDate),O=h.Tables[0](e=>e.EmpSeqNo==A&&e.DailyAttDate==M.OnlyDate()),O.sort((e,t)=>e.DailyAttDate>t.DailyAttDate||e.DailyAttDate==t.DailyAttDate&&e.StartTime>t.StartTime?1:-1),O.length>0){if(s){if(g=h.Tables[1],g=g.filter(e=>e.dcCCNID73==O[0].ShiftSeqNo&&e.WEF<=this.dtLatesMonthEnd.ToString("dd/MMM/yyyy")),g.sort((e,t)=>e.WEF<t.WEF?1:e.WEF>t.WEF?-1:0),!(g.length>0))continue;B=parseInt(g[0].DocID),g=g.filter(e=>e.DocID==B),g.length>0&&(e=g,g=e,j=g[0].IncludeRExclude.toString())}if(P=O[0].DADayType.toString(),""!=P){if("WeeklyOff"==P&&("ExcludeBoth"==j||"ExcludeWeeklyOffs"==j))continue;if("Holiday"==P&&("ExcludeBoth"==j||"ExcludeHolidays"==j))continue}}let i=!1,r=0;for(let t=0;t<O.length;t++){if(x=null,i=!1,0==t&&(g=this.DoLate_Filter(e,I[0]).filter(e=>"Check-in is late By"==e.DeviationWhen),g.sort((e,t)=>e.DevHours<t.DevHours?1:-1),g.length>0))for(let e=0;e<g.length;e++)if(("Flexible"!=O[t].ShiftType.toString()||"NO"!=O[t].ConsiderStartandEndTimelimits.toString().toUpperCase())&&(G=new Date(g[e].DevHours),N=new Date(O[t].StartTime),(new Date(O[t].StartTime)==new Date(O[t].EndTime)||new Date(O[t].StartTime)>new Date(O[t].DADateShiftEndTime)&&new Date(O[t].EndTime)>new Date(O[t].DADateShiftEndTime))&&new Date(O[t].EndTime)>new Date(O[t].DADateShiftEndTime)&&(N=new Date(O[t].DADateShiftEndTime)),E=new Date(O[t].DADateShiftStartTime),w=new Date(O[t].DADateShiftStartTime).AddHours(G.getHours()).AddMinutes(G.getMinutes()),N>w)){F=N.Subtract(E).TotalMinutes,r=F,x=this.ScreenObject.GridDataObj.NewRow(),x.DocSeqNo=this.ScreenObject.GridData.length+1,x.ProductID_Key=C,x.LinkedInvDocDetailsID=g[e].InvDocDetailsID,x.dcCCNID51_Key=A,x.dcCCNID51Code=I[0].EmpCode.toString(),x.dcCCNID51=I[0].EmpName.toString(),x.dcAlpha1=O[t].VoucherNo,x.dcAlpha2=O[t].DocSeqNo,x.dcAlpha3=M.ToString(a.a.SessionManager.Preferences["Date Format"]),x.dcAlpha3_Key=M,x.dcAlpha4=new Date(O[t].StartTime).ToString("HH:mm"),x.dcAlpha5=new Date(O[t].EndTime).ToString("HH:mm"),x.dcCCNID73_Key=O[t].ShiftSeqNo.toString(),x.dcCCNID73=O[t].ShiftName.toString(),x.dcAlpha6=new Date(O[t].ShiftStartTime).ToString("HH:mm"),x.dcAlpha7=new Date(O[t].ShiftEndTime).ToString("HH:mm"),x.dcAlpha8=F,x.dcAlpha15="",0==D[g[e].DISTDeviation.toString()+"_IsNDMTDone"]?(R=parseInt(D[g[e].DISTDeviation.toString()+"_NDMT"]),D[g[e].DISTDeviation.toString()+"_NDMT"]=R+1,parseInt(D[g[e].DISTDeviation.toString()+"_NDMT"])>parseInt(g[e].NDMT)&&(null!=x.dcAlpha15&&null!=x.dcAlpha15&&x.dcAlpha15.toString().length>0?x.dcAlpha15+=";Deduct - "+g[e].NDMTNoOfHoursOrDays+" - "+g[e].NDMTDeduct:x.dcAlpha15="Deduct - "+g[e].NDMTNoOfHoursOrDays+" - "+g[e].NDMTDeduct,"Leaves"==g[e].NDMTDeduct.toString()&&null!=g[e].LeaveTypesDeductionOrder&&null!=g[e].LeaveTypesDeductionOrder&&(x.dcAlpha28=g[e].LeaveTypesDeductionOrder),D[g[e].DISTDeviation.toString()+"_NDMT"]=0,D[g[e].DISTDeviation.toString()+"_IsNDMTDone"]=1)):(R=parseInt(D[g[e].DISTDeviation.toString()+"_FENDMT"]),D[g[e].DISTDeviation.toString()+"_FENDMT"]=R+1,parseInt(D[g[e].DISTDeviation.toString()+"_FENDMT"])>parseInt(g[e].FENDMT)&&(null!=x.dcAlpha15&&null!=x.dcAlpha15&&x.dcAlpha15.toString().length>0?x.dcAlpha15+=";Deduct - "+g[e].FENDMTNoOfHoursOrDays+" - "+g[e].FENDMTDeduct:x.dcAlpha15="Deduct - "+g[e].FENDMTNoOfHoursOrDays+" - "+g[e].FENDMTDeduct,"Leaves"==g[e].FENDMTDeduct.toString()&&null!=g[e].LeaveTypesDeductionOrder&&null!=g[e].LeaveTypesDeductionOrder&&(x.dcAlpha28=g[e].LeaveTypesDeductionOrder),D[g[e].DISTDeviation.toString()+"_FENDMT"]=0)),this.ScreenObject.GridDataObj.addRow(x),i=!0;break}if(t==O.length-1&&(g=this.DoLate_Filter(e,I[0]).filter(e=>"Check-out is early By"==e.DeviationWhen),g.sort((e,t)=>e.DevHours<t.DevHours?1:-1),g.length>0))for(let e=0;e<g.length;e++)if(("Flexible"!=O[t].ShiftType.toString()||"NO"!=O[t].ConsiderStartandEndTimelimits.toString().toUpperCase())&&(G=new Date(g[e].DevHours),N=new Date(O[t].EndTime),(new Date(O[t].StartTime)==new Date(O[t].EndTime)||new Date(O[t].StartTime)<new Date(O[t].DADateShiftStartTime)&&new Date(O[t].EndTime)<new Date(O[t].DADateShiftStartTime))&&new Date(O[t].StartTime)<new Date(O[t].DADateShiftStartTime)&&(N=new Date(O[t].DADateShiftStartTime)),E=new Date(O[t].DADateShiftEndTime),w=new Date(O[t].DADateShiftEndTime).AddHours(-G.getHours()).AddMinutes(-G.getMinutes()),N<w)){F=E.Subtract(N).TotalMinutes,r+=F,T=this.ScreenObject.GridData.filter(e=>e.dcCCNID51_Key==A&&e.dcAlpha3_Key==M.Date()),null!=T&&T.length>0?(x=T[0],i=!0):(x=this.ScreenObject.GridDataObj.NewRow(),x.DocSeqNo=this.ScreenObject.GridData.length+1,x.ProductID_Key=C,x.LinkedInvDocDetailsID=g[e].InvDocDetailsID,x.dcCCNID51_Key=A,x.dcCCNID51Code=I[0].EmpCode.toString(),x.dcCCNID51=I[0].EmpName.toString(),x.dcAlpha1=O[t].VoucherNo,x.dcAlpha2=O[t].DocSeqNo,x.dcAlpha3=M.ToString(a.a.SessionManager.Preferences["Date Format"]),x.dcAlpha3_Key=M,x.dcAlpha4=new Date(O[t].StartTime).ToString("HH:mm"),x.dcAlpha5=new Date(O[t].EndTime).ToString("HH:mm"),x.dcCCNID73_Key=O[t].ShiftSeqNo.toString(),x.dcCCNID73=O[t].ShiftName.toString(),x.dcAlpha6=new Date(O[t].ShiftStartTime).ToString("HH:mm"),x.dcAlpha7=new Date(O[t].ShiftEndTime).ToString("HH:mm")),x.dcAlpha9=F,x.dcAlpha15="",0==D[g[e].DISTDeviation.toString()+"_IsNDMTDone"]?(R=parseInt(D[g[e].DISTDeviation.toString()+"_NDMT"]),D[g[e].DISTDeviation.toString()+"_NDMT"]=R+1,parseInt(D[g[e].DISTDeviation.toString()+"_NDMT"])>parseInt(g[e].NDMT)&&(null!=x.dcAlpha15&&null!=x.dcAlpha15&&x.dcAlpha15.toString().length>0?x.dcAlpha15+=";Deduct - "+g[e].NDMTNoOfHoursOrDays+" - "+g[e].NDMTDeduct:x.dcAlpha15="Deduct - "+g[e].NDMTNoOfHoursOrDays+" - "+g[e].NDMTDeduct,"Leaves"==g[e].NDMTDeduct.toString()&&null!=g[e].LeaveTypesDeductionOrder&&null!=g[e].LeaveTypesDeductionOrder&&(x.dcAlpha28=g[e].LeaveTypesDeductionOrder),D[g[e].DISTDeviation.toString()+"_NDMT"]=0,D[g[e].DISTDeviation.toString()+"_IsNDMTDone"]=1)):(R=parseInt(D[g[e].DISTDeviation.toString()+"_FENDMT"]),D[g[e].DISTDeviation.toString()+"_FENDMT"]=R+1,parseInt(D[g[e].DISTDeviation.toString()+"_FENDMT"])>parseInt(g[e].FENDMT)&&(null!=x.dcAlpha15&&null!=x.dcAlpha15&&x.dcAlpha15.toString().length>0?x.dcAlpha15+=";Deduct - "+g[e].FENDMTNoOfHoursOrDays+" - "+g[e].FENDMTDeduct:x.dcAlpha15="Deduct - "+g[e].FENDMTNoOfHoursOrDays+" - "+g[e].FENDMTDeduct,"Leaves"==g[e].FENDMTDeduct.toString()&&null!=g[e].LeaveTypesDeductionOrder&&null!=g[e].LeaveTypesDeductionOrder&&(x.dcAlpha28=g[e].LeaveTypesDeductionOrder),D[g[e].DISTDeviation.toString()+"_FENDMT"]=0)),i||null==x||this.ScreenObject.GridDataObj.addRow(x),i=!0;break}if(O.length>1&&(g=this.DoLate_Filter(e,I[0]).filter(e=>e.DeviationWhen=="Break"+(t+1)+" hours is more by"),g.sort((e,t)=>e.DevHours<t.DevHours?1:-1),g.length>0))for(let e=0;e<g.length;e++)if(("Flexible"!=O[t].ShiftType.toString()||"NO"!=O[t].ConsiderStartandEndTimelimits.toString().toUpperCase())&&(G=new Date(g[e].DevHours),N=new Date(O[t].EndTime),O.length>t+1&&(E=new Date(O[t+1].StartTime),V=E.Subtract(N).TotalMinutes,f=parseFloat(O[t]["Break"+(t+1)+"Mins"]),L=f+60*G.getHours()+G.getMinutes(),V>L))){F=V-f,T=this.ScreenObject.GridData.filter(e=>e.dcCCNID51_Key==A&&e.dcAlpha3_Key==M.Date()),null!=T&&T.length>0?(x=T[0],i=!0):(x=this.ScreenObject.GridDataObj.NewRow(),x.DocSeqNo=this.ScreenObject.GridData.length+1,x.ProductID_Key=C,x.LinkedInvDocDetailsID=g[e].InvDocDetailsID,x.dcCCNID51_Key=A,x.dcCCNID51Code=I[0].EmpCode.toString(),x.dcCCNID51=I[0].EmpName.toString(),x.dcAlpha1=O[t].VoucherNo,x.dcAlpha2=O[t].DocSeqNo,x.dcAlpha3=M.ToString(a.a.SessionManager.Preferences["Date Format"]),x.dcAlpha3_Key=M,x.dcAlpha4=new Date(O[t].StartTime).ToString("HH:mm"),x.dcAlpha5=new Date(O[t].EndTime).ToString("HH:mm"),x.dcCCNID73_Key=O[t].ShiftSeqNo.toString(),x.dcCCNID73=O[t].ShiftName.toString(),x.dcAlpha6=new Date(O[t].ShiftStartTime).ToString("HH:mm"),x.dcAlpha7=new Date(O[t].ShiftEndTime).ToString("HH:mm")),x["dcAlpha"+(9+t+1)]=F,x.dcAlpha15="",0==D[g[e].DISTDeviation.toString()+"_IsNDMTDone"]?(R=parseInt(D[g[e].DISTDeviation.toString()+"_NDMT"]),D[g[e].DISTDeviation.toString()+"_NDMT"]=R+1,parseInt(D[g[e].DISTDeviation.toString()+"_NDMT"])>parseInt(g[e].NDMT)&&(null!=x.dcAlpha15&&null!=x.dcAlpha15&&x.dcAlpha15.toString().length>0?x.dcAlpha15+=";Deduct - "+g[e].NDMTNoOfHoursOrDays+" - "+g[e].NDMTDeduct:x.dcAlpha15="Deduct - "+g[e].NDMTNoOfHoursOrDays+" - "+g[e].NDMTDeduct,"Leaves"==g[e].NDMTDeduct.toString()&&null!=g[e].LeaveTypesDeductionOrder&&null!=g[e].LeaveTypesDeductionOrder&&(x.dcAlpha28=g[e].LeaveTypesDeductionOrder),D[g[e].DISTDeviation.toString()+"_NDMT"]=0,D[g[e].DISTDeviation.toString()+"_IsNDMTDone"]=1)):(R=parseInt(D[g[e].DISTDeviation.toString()+"_FENDMT"]),D[g[e].DISTDeviation.toString()+"_FENDMT"]=R+1,parseInt(D[g[e].DISTDeviation.toString()+"_FENDMT"])>parseInt(g[e].FENDMT)&&(null!=x.dcAlpha15&&null!=x.dcAlpha15&&x.dcAlpha15.toString().length>0?x.dcAlpha15+=";Deduct - "+g[e].FENDMTNoOfHoursOrDays+" - "+g[e].FENDMTDeduct:x.dcAlpha15="Deduct - "+g[e].FENDMTNoOfHoursOrDays+" - "+g[e].FENDMTDeduct,"Leaves"==g[e].FENDMTDeduct.toString()&&null!=g[e].LeaveTypesDeductionOrder&&null!=g[e].LeaveTypesDeductionOrder&&(x.dcAlpha28=g[e].LeaveTypesDeductionOrder),D[g[e].DISTDeviation.toString()+"_FENDMT"]=0)),i||null==x||this.ScreenObject.GridDataObj.addRow(x),i=!0;break}i||null==x||this.ScreenObject.GridDataObj.addRow(x),i=!0}if(O.length>0&&(g=this.DoLate_Filter(e,I[0]).filter(e=>"Working hours is less by"==e.DeviationWhen),g.sort((e,t)=>e.DevHours<t.DevHours?1:-1),g.length>0))for(let e=0;e<g.length;e++){let t=g[e].DeviationHours.toString().substr(0,5).Replace(":",".").split("."),s=60*parseInt(t[0])+parseInt(t[1]),o=this.CalculateTotalHoursBasedOnStartEndTime(O).split("."),l=60*parseInt(o[0])+parseInt(o[1]);if(l<s){if(F=s-l,F-=r,F<=0)continue;x=this.ScreenObject.GridDataObj.NewRow(),x.DocSeqNo=this.ScreenObject.GridData.length+1,x.ProductID_Key=C,x.LinkedInvDocDetailsID=g[e].InvDocDetailsID,x.dcCCNID51_Key=A,x.dcCCNID51Code=I[0].EmpCode.toString(),x.dcCCNID51=I[0].EmpName.toString(),x.dcAlpha1=O[0].VoucherNo,x.dcAlpha2=O[0].DocSeqNo,x.dcAlpha3=M.ToString(a.a.SessionManager.Preferences["Date Format"]),x.dcAlpha3_Key=M,x.dcAlpha4=new Date(O[0].StartTime).ToString("HH:mm"),x.dcAlpha5=new Date(O[0].EndTime).ToString("HH:mm"),x.dcCCNID73_Key=O[0].ShiftSeqNo.toString(),x.dcCCNID73=O[0].ShiftName.toString(),x.dcAlpha6=new Date(O[0].ShiftStartTime).ToString("HH:mm"),x.dcAlpha7=new Date(O[0].ShiftEndTime).ToString("HH:mm"),x.dcAlpha29=F,x.dcAlpha15="",0==D[g[e].DISTDeviation.toString()+"_IsNDMTDone"]?(R=parseInt(D[g[e].DISTDeviation.toString()+"_NDMT"]),D[g[e].DISTDeviation.toString()+"_NDMT"]=R+1,parseInt(D[g[e].DISTDeviation.toString()+"_NDMT"])>parseInt(g[e].NDMT)&&(!n.e.IsEmpty(x.dcAlpha15)&&n.e.String(x.dcAlpha15).length>0?x.dcAlpha15+=";Deduct - "+g[e].NDMTNoOfHoursOrDays+" - "+g[e].NDMTDeduct:x.dcAlpha15="Deduct - "+g[e].NDMTNoOfHoursOrDays+" - "+g[e].NDMTDeduct,"Leaves"==g[e].NDMTDeduct.toString()&&null!=g[e].LeaveTypesDeductionOrder&&null!=g[e].LeaveTypesDeductionOrder&&(x.dcAlpha28=g[e].LeaveTypesDeductionOrder),D[g[e].DISTDeviation.toString()+"_NDMT"]=0,D[g[e].DISTDeviation.toString()+"_IsNDMTDone"]=1)):(R=parseInt(D[g[e].DISTDeviation.toString()+"_FENDMT"]),D[g[e].DISTDeviation.toString()+"_FENDMT"]=R+1,parseInt(D[g[e].DISTDeviation.toString()+"_FENDMT"])>parseInt(g[e].FENDMT)&&(!n.e.IsEmpty(x.dcAlpha15)&&n.e.String(x.dcAlpha15).length>0?x.dcAlpha15+=";Deduct - "+g[e].FENDMTNoOfHoursOrDays+" - "+g[e].FENDMTDeduct:x.dcAlpha15="Deduct - "+g[e].FENDMTNoOfHoursOrDays+" - "+g[e].FENDMTDeduct,"Leaves"==g[e].FENDMTDeduct.toString()&&null!=g[e].LeaveTypesDeductionOrder&&null!=g[e].LeaveTypesDeductionOrder&&(x.dcAlpha28=g[e].LeaveTypesDeductionOrder),D[g[e].DISTDeviation.toString()+"_FENDMT"]=0)),this.ScreenObject.GridDataObj.addRow(x),i=!0;break}}}}if(g=this.DoLate_Filter(e,I[0]).filter(e=>"Yes"==e.ConsiderAbsentDays),g.length>0){let e,t,s=new Date,i=new Date,r=new Date,o=new Date,l=null,c=0,h=S;if(h=h.filter(e=>e.EmpSeqNo==A),null!=h&&h.length>0){t=h;for(let e=0;e<Object.keys(h[0]).length;e++){const s=Object.keys(h[0])[e];Object.keys(s).Contains("CCNID")&&!Object.keys(s).Contains("Name")&&t.forEach(e=>{e["dc"+s+"_Key"]=e[s]})}t.forEach(e=>{e.dcCCNID51_Key=e.EmpSeqNo}),l=t.filter(e=>e.EmpSeqNo==A)}for(s=this.dtLatesMonthStart,i=this.dtLatesMonthEnd;s<=i;){if(null!=m&&m.length>0&&(e=m.filter(e=>e.EmpSeqNo==A&&(e.FromDate>=s.ToString("dd MMM yyyy")&&e.ToDate<=e.dtTempF.ToString("dd MMM yyyy")||e.FromDate<=s.ToString("dd MMM yyyy")&&e.ToDate>=s.ToString("dd MMM yyyy"))),null!=e&&e.length>0)){s=s.AddDays(1);continue}if(null!=l&&l.length>0&&(this.CheckEmployeeShift(A,s.ToString("dd MMM yyyy"),l[0]),null==this.objPayDayCheck&&(this.objPayDayCheck=new at.a(this.ScreenObject)),l[0].PayrollType="",this.objPayDayCheck.CheckIsHolidayDate(A,s.ToString("dd MMM yyyy"),l[0]),!n.e.IsEmpty(l[0].PayrollType))){s=s.AddDays(1);continue}let t=b.filter(e=>e.NodeID==l[0].dcCCNID73_Key);r=s.AddHours(new Date(t[0].ShiftStartTime).getHours()).AddMinutes(new Date(t[0].ShiftStartTime).getMinutes()),o=s.AddHours(new Date(t[0].ShiftEndTime).getHours()).AddMinutes(new Date(t[0].ShiftEndTime).getMinutes()),c=o.Subtract(r).TotalMinutes,x=null,x=this.ScreenObject.GridDataObj.NewRow(),x.DocSeqNo=this.ScreenObject.GridData.length+1,x.ProductID_Key=C,x.LinkedInvDocDetailsID="0",x.dcCCNID51_Key=A,x.dcCCNID51Code=I[0].EmpCode.toString(),x.dcCCNID51=I[0].EmpName.toString(),x.dcAlpha1="",x.dcAlpha2="",x.dcAlpha3=s.ToString(a.a.SessionManager.Preferences["Date Format"]),x.dcAlpha3_Key=s,x.dcAlpha4="00:00",x.dcAlpha5="00:00",x.dcCCNID73_Key=l[0].dcCCNID73_Key,null!=t&&(x.dcCCNID73=t[0].NAME.toString(),x.dcAlpha6=new Date(t[0].ShiftStartTime).ToString("HH:mm"),x.dcAlpha7=new Date(t[0].ShiftEndTime).ToString("HH:mm")),x.dcAlpha31=c,this.ScreenObject.GridDataObj.addRow(x),s=s.AddDays(1)}this.RefreshGrid=!this.RefreshGrid}}}let t=this.ScreenObject.GridData.filter(e=>e.dcCCNID51_Key==A);if(t.length>0){let e=t.filter(e=>e.dcCCNID51_Key==A&&""!=n.e.String(e.dcAlpha15));this.ScreenObject.GridData[this.ScreenObject.GridData.length-1].dcAlpha19=n.e.DTComputeSUM(e,"dcAlpha8",!1),this.ScreenObject.GridData[this.ScreenObject.GridData.length-1].dcAlpha20=n.e.DTComputeSUM(e,"dcAlpha9",!1),this.ScreenObject.GridData[this.ScreenObject.GridData.length-1].dcAlpha21=n.e.DTComputeSUM(e,"dcAlpha10",!1),this.ScreenObject.GridData[this.ScreenObject.GridData.length-1].dcAlpha22=n.e.DTComputeSUM(e,"dcAlpha11",!1),this.ScreenObject.GridData[this.ScreenObject.GridData.length-1].dcAlpha23=n.e.DTComputeSUM(e,"dcAlpha12",!1),this.ScreenObject.GridData[this.ScreenObject.GridData.length-1].dcAlpha24=n.e.DTComputeSUM(e,"dcAlpha13",!1),this.ScreenObject.GridData[this.ScreenObject.GridData.length-1].dcAlpha25=n.e.DTComputeSUM(e,"dcAlpha14",!1),e=t.filter(e=>e.dcCCNID51_Key==A),this.ScreenObject.GridData[this.ScreenObject.GridData.length-1].dcAlpha32=n.e.DTComputeSUM(e,"dcAlpha31",!1);let s=0,i=0,a="";for(let r=0;r<t.length;r++)if(!n.e.IsEmpty(t[r].dcAlpha15)){let e=t[r].dcAlpha15.toString().split(";");if(null!=e&&e.length>0)for(let n=0;n<e.length;n++)null!=e[n]&&""!=e[n]&&(e[n].endsWith("Hours")?s+=parseFloat(e[n].Replace("Deduct - ","").Replace(" - Hours","")):e[n].endsWith("Leaves")&&(i+=parseFloat(e[n].Replace("Deduct - ","").Replace(" - Leaves","")),a=t[r].dcAlpha28.toString()))}this.ScreenObject.GridData[this.ScreenObject.GridData.length-1].dcAlpha26=s,this.ScreenObject.GridData[this.ScreenObject.GridData.length-1].dcAlpha27=i,this.ScreenObject.GridData[this.ScreenObject.GridData.length-1].dcAlpha28=a}}}}}DoLate_Filter(e,t){let s=a.a.SessionManager.Preferences.LatesConfigBasedOn.split(",");for(let i=0;i<s.length;i++)if(!n.e.IsEmpty(s[i])){let a="CCNID"+(parseInt(s[i])-5e4);e=Object.keys(t[0]).Contains(a)&&!n.e.IsEmpty(t[0][a])?e.filter(e=>e["dc"+a]==t[a]||1==e["dc"+a]):e.filter(e=>1==e["dc"+a])}return e}CalculateTotalHoursBasedOnStartEndTime(e){let t=0,s="00.00",i="";for(let a=0;a<e.length;a++){let r=new Date(e[a].DailyAttDate),o=r.AddHours(new Date(e[a].StartTime).getHours()).AddMinutes(new Date(e[a].StartTime).getMinutes()),l=r.AddHours(new Date(e[a].EndTime).getHours()).AddMinutes(new Date(e[a].EndTime).getMinutes());l<o&&(l=l.AddDays(1)),i=this.CalculateTotalTime(o,o,l,l),t=n.e.SUMHoursAndMinutes(s,i),s=t.ToString("00.00")}return t.ToString("00.00")}CheckIsLateCheckInOrEarlyCheckOut(e){let t,s=[];if(a.a.SessionManager.Preferences.ContainsKey("ConsiderLatesConfig")&&"True"==a.a.SessionManager.Preferences.ConsiderLatesConfig&&a.a.SessionManager.Preferences.ContainsKey("LatesConfigBasedOn")&&""!=a.a.SessionManager.Preferences.LatesConfigBasedOn.toString().Trim()){let i=!1,o=a.a.SessionManager.Preferences.LatesConfigBasedOn;"50073"==o&&(i=!0);let l=o.split(","),c=e.split(",");if(c.length>0&&l.length>0){let o=this.ScreenObject._TextFields.find(e=>"dcalpha10"==e.DBColumnName.toLowerCase());if(null!=o&&o instanceof d.c&&""==o.Date.toString())return this.DisplayMessage="Select From Date",this.MessageVisibility=!0,o.SetFocus=!0,s;let h=this.ScreenObject._TextFields.find(e=>"dcalpha11"==e.DBColumnName.toLowerCase());if(null!=h&&h instanceof d.c&&""==h.Date.toString())return this.DisplayMessage="Select To Date",this.MessageVisibility=!0,h.SetFocus=!0,s;let u=h.Date,D=a.a.common.GetDataSet3("PAY077",e,o.Date.ToString("dd/MMM/yyyy"),u.ToString("dd/MMM/yyyy")),S=[];S.push(a.a.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")),S.push(" a.IsGroup=0 AND a.NodeID IN("+e+")"),S.push("");let m,b=a.a.common.GetDataSet_SP(S,"spPAY_GetEmpDimensionsAsOnDate").Tables[0],C=0,p=this.ScreenObject.Data.Tables[0].filter(e=>"ProductID"==e.SysColumnName);p.length>0&&""!=n.e.String(p[0].UserDefaultValue)&&(C=parseInt(p[0].UserDefaultValue));let y,g,O="",I="",f="",T=[],j=[],P=[],A=new Date,M=new Date,G=new Date,N=new Date,E=new Date,w=0,F=0,V=0,L=0,R=null;for(let e=0;e<c.length;e++){if(m=new r.a,null!=D&&D.Tables.length>0&&D.Tables[1].length>0)for(let e=0;e<D.Tables[1].length;e++)m.ContainsKey(D.Tables[1][e].DISTDeviation.toString()+"_NDMT")||(m.push(D.Tables[1][e].DISTDeviation.toString()+"_NDMT",0),m.push(D.Tables[1][e].DISTDeviation.toString()+"_FENDMT",0),m.push(D.Tables[1][e].DISTDeviation.toString()+"_IsNDMTDone",0));let a;if(f=c[e],y=b.filter(e=>e.EmpSeqNo==f),null!=y&&y.length>0&&l.filter(e=>e.length>1).length>0&&(j=this.DoLate_Filter(D.Tables[1],y[0]).filter(e=>e.WEF<=this.dtPayMonEnd.Date()),j.sort((e,t)=>e.WEF<t.WEF?1:e.WEF>t.WEF?-1:0),i||j.length>0&&(L=parseInt(j[0].DocID),j=D.Tables[1].filter(e=>e.DocID==L),j.length>0&&(a=j,j=a,O=j[0].IncludeRExclude.toString())),T=D.Tables[0](e=>e.EmpSeqNo==f),T.sort((e,t)=>e.DailyAttDate>t.DailyAttDate||e.DailyAttDate==t.DailyAttDate&&e.StartTime>t.StartTime?1:-1),T.length>0)){R=[],R=T.ToTable(!0,"DailyAttDate");for(let e=0;e<R.length;e++){if(A=new Date(R[e].DailyAttDate),P=D.Tables[0](e=>e.EmpSeqNo==f&&e.DailyAttDate==A.OnlyDate()),P.sort((e,t)=>e.DailyAttDate>t.DailyAttDate||e.DailyAttDate==t.DailyAttDate&&e.StartTime>t.StartTime?1:-1),P.length>0){if(i){if(j=D.Tables[1],j=j.filter(e=>e.dcCCNID73==P[0].ShiftSeqNo&&e.WEF<=this.dtPayMonEnd.ToString("dd/MMM/yyyy")),j.sort((e,t)=>e.WEF<t.WEF?1:e.WEF>t.WEF?-1:0),!(j.length>0))continue;L=parseInt(j[0].DocID),j=j.filter(e=>e.DocID==L),j.length>0&&(a=j,j=a,O=j[0].IncludeRExclude.toString())}if(I=P[0].DADayType.toString(),""!=I){if("WeeklyOff"==I&&("ExcludeBoth"==O||"ExcludeWeeklyOffs"==O))continue;if("Holiday"==I&&("ExcludeBoth"==O||"ExcludeHolidays"==O))continue}}for(let e=0;e<P.length;e++){if(0==e&&(j=this.DoLate_Filter(a,y[0]).filter(e=>"Check-in is late By"==e.DeviationWhen),j.sort((e,t)=>e.DevHours<t.DevHours?1:-1),j.length>0))for(let i=0;i<j.length;i++)"Flexible"==P[e].ShiftType.toString()&&"NO"==P[e].ConsiderStartandEndTimelimits.toString().toUpperCase()||(M=new Date(j[i].DevHours),G=new Date(P[e].StartTime),N=new Date(P[e].DADateShiftStartTime),E=new Date(P[e].DADateShiftStartTime).AddHours(M.getHours()).AddMinutes(M.getMinutes()),G>E&&(w=G.Subtract(N).TotalMinutes,t={},t.sInvDocIDs=P[e].InvDocDetailsID.toString(),t.LateType="Check-In Late",s.push(t)));if(e==P.length-1&&(j=this.DoLate_Filter(a,y[0]).filter(e=>"Check-out is early By"==e.DeviationWhen),j.sort((e,t)=>e.DevHours<t.DevHours?1:-1),j.length>0))for(let i=0;i<j.length;i++)"Flexible"==P[e].ShiftType.toString()&&"NO"==P[e].ConsiderStartandEndTimelimits.toString().toUpperCase()||(M=new Date(j[i].DevHours),G=new Date(P[e].EndTime),N=new Date(P[e].DADateShiftEndTime),E=new Date(P[e].DADateShiftEndTime).AddHours(-M.getHours).AddMinutes(-M.getMinutes()),G<E&&(w=N.Subtract(G).TotalMinutes,t={},t.sInvDocIDs=P[e].InvDocDetailsID.toString(),t.LateType="Check-Out Early",s.push(t)));if(P.length>1&&(j=this.DoLate_Filter(a,y[0]).filter(t=>t.DeviationWhen=="Break"+(e+1)+" hours is more by"),j.sort((e,t)=>e.DevHours<t.DevHours?1:-1),j.length>0))for(let i=0;i<j.length;i++)"Flexible"==P[e].ShiftType.toString()&&"NO"==P[e].ConsiderStartandEndTimelimits.toString().toUpperCase()||(M=new Date(j[i].DevHours),G=new Date(P[e].EndTime),P.length>e+1&&(N=new Date(P[e+1].StartTime),F=N.Subtract(G).TotalMinutes,g=parseFloat(P[e]["Break"+(e+1)+"Mins"]),V=g+60*M.getHours()+M.getMinutes(),F>V&&(w=F-g,t={},t.sInvDocIDs=P[e].InvDocDetailsID.toString(),t.LateType="Break Late",s.push(t))))}if(P.length>0&&(j=this.DoLate_Filter(a,y[0]).filter(e=>"Working hours is less by"==e.DeviationWhen),j.sort((e,t)=>e.DevHours<t.DevHours?1:-1),j.length>0))for(let e=0;e<j.length;e++){let i=j[e].DeviationHours.toString().substr(0,5).Replace(":",".").split("."),a=60*parseInt(i[0])+parseInt(i[1]),n=this.CalculateTotalHoursBasedOnStartEndTime(P).split("."),r=60*parseInt(n[0])+parseInt(n[1]);r<a&&(w=a-r,t={},t.sInvDocIDs=P[0].InvDocDetailsID.toString(),t.LateType="Less Working Hours",s.push(t))}}}}}}return s}IsDocLocked(e,t,s,i){this.strValidationMessage="";let r=[];r.push(t.ToString("dd MMM yyyy")),r.push(this.sEmpFilter),r.push(0),r.push(a.a.SessionManager.RoleID),r.push(a.a.SessionManager.UserID),r.push(a.a.SessionManager.LanguageID);let o=a.a.common.GetDataSet_SP(r,"spPAY_GetEmpMasterCCDetails");if(null!=o&&o.Tables.length>0&&o.Tables[0].length>0){let r=0,l="",c="",h=a.a.common.GetDataSet("PAY085","");if(null!=h&&h.Tables.length>0&&null!=h.Tables[0]&&h.Tables[0].length>0){let u=a.a.common.GetDataSet3("PAY086",t.ToString("dd/MMM/yyyy"),s.ToString("dd/MMM/yyyy"));if(null!=u&&u.Tables.length>0&&null!=u.Tables[0]&&u.Tables[0].length>0&&c.length>0){let t=u.Tables[0];for(let s=0;s<h.Tables[0].length;s++){l=h.Tables[0][s].SysColumnName.toString();let i=o.Tables[0].filter(t=>t.EmpSeqNo==e);null!=i&&i.length>0&&(r=parseInt(i[0]["CCNID"+l.Replace("dcCCNID","")])),t=t.filter(e=>e[l]==r)}if(null!=t&&t.length>0)for(let e=0;e<t.length;e++)n.e.IsEmpty(t[e].MPLockStatus)||"Locked"!=t[e].MPLockStatus.toString()?""==this.strValidationMessage&&67==i&&(n.e.IsEmpty(t[e].DALockStatus)||"Locked"!=t[e].DALockStatus.toString()||(this.strValidationMessage="Daily Attendance Locked")):this.strValidationMessage="Payroll Locked"}}}return this.strValidationMessage}DocLock(e){let t=(new Date).OnlyDate(),s=(new Date).OnlyDate(),i="",r="";if(68==e)for(let a=0;a<this.ScreenObject.GridData.length;a++){let r=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());if(null!=r)(r instanceof m.b||r instanceof C.a)&&(i=r.SelectedValue.toString());else{let e=this.ScreenObject.ColumnSource.find(e=>"LISTBOX"==e.DataType.toUpperCase()&&"dcccnid51_key"==e.ValueMember.toLowerCase());null==e||n.e.IsEmpty(this.ScreenObject.GridData[a][e.ValueMember])||(i=this.ScreenObject.GridData[a][e.ValueMember].toString())}let o=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase());if(null!=o&&o instanceof d.c&&!n.e.IsEmpty(o.Date)&&(t=o.Date),o=this.ScreenObject._TextFields.find(e=>"dcalpha4"==e.DBColumnName.toLowerCase()),null!=o&&o instanceof d.c&&!n.e.IsEmpty(o.Date)&&(s=o.Date),this.strValidationMessage=this.IsDocLocked(i,t,s,e),""!=this.strValidationMessage)break}else if(67==this.ScreenObject.DocumentType){for(let t=0;t<this.ScreenObject.GridData.length;t++)if(this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!n.e.IsEmpty(this.ScreenObject.GridData[t].ProductID_Key)){r="",i="";let s=this.ScreenObject.GridData[t];var l=this.ScreenObject._TextFields.find(e=>"dcalpha1"==e.DBColumnName.toLowerCase());if(null!=l)r=l.Date.ToString("dd/MMM/yyyy");else{var c=this.ScreenObject.ColumnSource.find(e=>"dcalpha1"==e.DisplayMember.toLowerCase());null==c||n.e.IsEmpty(s[c.DisplayMember+"_Key"])||(r=new Date(s[c.DisplayMember+"_Key"]).ToString("dd/MMM/yyyy"))}if(null!=(l=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase())))(l instanceof m.b||l instanceof C.a)&&(i=l.SelectedValue.toString());else{let e=this.ScreenObject.ColumnSource.find(e=>"LISTBOX"==e.DataType.toUpperCase()&&"dcccnid51_key"==e.ValueMember.toLowerCase());null==e||n.e.IsEmpty(s[e.ValueMember])||(i=s[e.ValueMember].toString())}if(""!=r&&parseInt(i)>1&&(this.strValidationMessage=this.IsDocLocked(i,new Date(r),new Date(r),e),""!=this.strValidationMessage))break}}else if(80==this.ScreenObject.DocumentType){let a=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());null!=a&&(a instanceof m.b||a instanceof C.a)&&(i=a.SelectedValue.toString());let n=this.ScreenObject._TextFields.find(e=>"dcalpha3"==e.DBColumnName.toLowerCase());null!=n&&n instanceof d.c&&""!=n.Date.toString()&&(t=n.Date),s=t,this.strValidationMessage=this.IsDocLocked(i,t,s,e)}else if(62==this.ScreenObject.DocumentType){if(a.a.SessionManager.Preferences.ContainsKey("AllowLeavesifPayrollProcessedorLocked")&&Object(o.j)("False"==a.a.SessionManager.Preferences.AllowLeavesifPayrollProcessedorLocked))for(let t=0;t<this.ScreenObject.GridData.length;t++){let s=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());if(null!=s)(s instanceof m.b||s instanceof C.a)&&(i=s.SelectedValue.toString());else{let e=this.ScreenObject.ColumnSource.find(e=>"LISTBOX"==e.DataType.toUpperCase()&&"dcccnid51_key"==e.ValueMember.toLowerCase());null==e||n.e.IsEmpty(this.ScreenObject.GridData[t][e.ValueMember])||(i=this.ScreenObject.GridData[t][e.ValueMember].toString())}if(!n.e.IsEmpty(this.ScreenObject.GridData[t].dcAlpha4_key)&&!n.e.IsEmpty(this.ScreenObject.GridData[t].dcAlpha5_key)&&(this.strValidationMessage=this.IsDocLocked(i,new Date(this.ScreenObject.GridData[t].dcAlpha4_key),new Date(this.ScreenObject.GridData[t].dcAlpha5_key),e),""!=this.strValidationMessage))break}}else if(72==this.ScreenObject.DocumentType){if(a.a.SessionManager.Preferences.ContainsKey("AllowVacationifPayrollProcessedorLocked")&&Object(o.j)("False"==a.a.SessionManager.Preferences.AllowVacationifPayrollProcessedorLocked)){let a=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());null!=a&&(a instanceof m.b||a instanceof C.a)&&(i=a.SelectedValue.toString());let r=this.ScreenObject._TextFields.find(e=>"dcalpha2"==e.DBColumnName.toLowerCase());null!=r&&r instanceof d.c&&!n.e.IsEmpty(r.Date)&&(t=r.Date),r=this.ScreenObject._TextFields.find(e=>"dcalpha3"==e.DBColumnName.toLowerCase()),null!=r&&r instanceof d.c&&!n.e.IsEmpty(r.Date)&&(s=r.Date),this.strValidationMessage=this.IsDocLocked(i,t,s,e)}}else if(56==this.ScreenObject.DocumentType)for(let a=0;a<this.ScreenObject.GridData.length;a++){let t=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());if(null!=t&&(t instanceof m.b||t instanceof C.a)&&(i=t.SelectedValue.toString()),!n.e.IsEmpty(this.ScreenObject.GridData[a].dcAlpha6_Key)&&(this.strValidationMessage=this.IsDocLocked(i,new Date(this.ScreenObject.GridData[a].dcAlpha6_Key),new Date(this.ScreenObject.GridData[a].dcAlpha6_Key),e),""!=this.strValidationMessage))break}return this.strValidationMessage}OpenFile(e){if(1!==e.target.files.length)throw new Error("Cannot use multiple files");const t=new FileReader,s=e.target.files[0];t.onload=s=>{const i=me.read(t.result,{type:"binary"});this.ExcelData=me.utils.sheet_to_json(i.Sheets[i.SheetNames[0]],{header:1}),this.ExcelTable=this.ExcelData;try{this.ActualFileName=e.target.value,this.DtImport.Clear();for(let e=0;e<this.ExcelData[0].length;e++){let t=this.DtImportObj.NewRow();this.DtImportObj.addRow(t),t.FieldName=this.ExcelData[0][e],this.DtImportObj.updateRow(t)}if(console.log(this.DtImport),console.log("DTImport"),!n.e.IsEmpty(this.ImportCols[1].DefaultValueText)){let e=new n.f;e.LoadXml(this.ImportCols[1].DefaultValueText),null!=e&&e.DocumentElement.children[0].childNodes.forEach(e=>{for(let t=0;t<this.DtImport.length;t++)(t+1).toString()==e[0].value.toString()&&(this.DtImport[t].FeatureFieldName=e[2].value.toString())})}}catch(a){return void(this.DisplayMessage=a.Message)}},t.readAsBinaryString(s)}prepareLineItemsToForm(){this.leaveTab.Enable=!1,this.leaveTab.Visible=!1,this.displayLineItems=!0,40062==this.CostCenterID&&(this.displayAgGrid=!1,this.BodyVisible=!1,this.displayLineItems=!1,a.a.IsMobile&&(this.BodyVisible=!1),this.ScreenObject.GridDataObj.refreshUI(),this.leaveTab=new T.b,this.leaveTab.Enable=!0,this.leaveTab.Visible=!0,this.leaveTab.Header="Details",this.leaveTab.Name="Details",this.leaveTab.Fields=this.ScreenObject.LineItemFields,this.assignedLeaves=this.leaveTab.Fields.filter(e=>"dcAlpha2"==e.DBColumnName)[0],this.availableLeaves=this.leaveTab.Fields.filter(e=>"dcAlpha3"==e.DBColumnName)[0],this.noOfDays=this.leaveTab.Fields.filter(e=>"dcAlpha7"==e.DBColumnName)[0],this.fromDate=this.leaveTab.Fields.filter(e=>"dcAlpha4"==e.DBColumnName)[0],this.toDate=this.leaveTab.Fields.filter(e=>"dcAlpha5"==e.DBColumnName)[0],this.session=this.leaveTab.Fields.filter(e=>"dcAlpha6"==e.DBColumnName)[0],this.session.Text="",this.session.SelectedValue="",this.leaveTab.Fields.forEach(e=>{e instanceof m.b?e.OnPactListBoxValueChanged.Subscribe(this,"onLineItemsChange"):e instanceof d.a||e instanceof d.c?e.SelectedDateChanged.Subscribe(this,"onLineItemsChange"):e instanceof D.e?e.SelectionChangedCommand.Subscribe(this,"onLineItemsChange"):e instanceof u.d&&e.TextChangedCommand.Subscribe(this,"onLineItemsChange")}))}refresh(e){return!1}onLineItemsChange(e,t){var s=null!=t;e instanceof u.d&&null!=t&&(s=!1);var i=e;if(!s){if(t=this.ScreenObject.GridData[0],e instanceof m.b){if(null==i.SelectedItem)return;t[e.DBColumnName]=i.SelectedItem.Name,t[e.DBColumnName+"_Key"]=i.SelectedItem.NodeID}else if(e instanceof d.a||e instanceof d.c){if(null==i.Date)return;t[e.DBColumnName]=i.Date.ToString(a.a.SessionManager.Preferences["Date Format"]),t[e.DBColumnName+"_Key"]=i.Date}else if(e instanceof D.e)t[e.DBColumnName]=i._SelectedValue;else if(e instanceof u.d)return void(t[e.DBColumnName]=i.Text);this.ScreenObject.GridDataObj.updateRow(this.ScreenObject.GridData[0])}e instanceof u.d||(this.ScreenObject.GridDataColumns.Contains(e.DBColumnName)&&!n.e.IsEmpty(t[e.DBColumnName])&&this.FillDefaultProd(t,e.DBColumnName),this.Celleditend(t,e.DBColumnName,null!=e.CCID?e.CCID:0),this.ScreenObject.GridDataObj.updateRow(t),this.PoleDisplayMessage(2,t),s||this.onPrepareDatesGrid()),this.onBindLeaveAssignDetails()}onBindLeaveAssignDetails(){let e=this.ScreenObject.GridData[this.ScreenObject.GridData.length-1];if(null==e.dcAlpha3&&null==e.dcAlpha2&&null!=this.ScreenObject.GridData[this.ScreenObject.GridData.length-2]&&(e=this.ScreenObject.GridData[this.ScreenObject.GridData.length-2]),null!=e){this.assignedLeaves.Text=e.dcAlpha2,this.availableLeaves.Text=e.dcAlpha3;var t=!1;this.leaveTab.Fields.forEach(e=>{e instanceof m.b?e.OnPactListBoxValueChanged=new b.b:e instanceof d.a||e instanceof d.c?e.SelectedDateChanged=new b.b:e instanceof D.e?e.SelectionChangedCommand=new b.b:e instanceof u.d&&(e.TextChangedCommand=new b.b)}),this.leaveTab.Fields.forEach(s=>{s instanceof u.d||s instanceof u.c||s instanceof g.a?s.Text=n.e.String(e[s.DBColumnName]):s instanceof D.e?s.SelectedValue=n.e.String(e[s.DBColumnName]):s instanceof d.c?("dcAlpha4"!=s.DBColumnName&&"dcAlpha5"!=s.DBColumnName||null!=s.Date||(t=!0),null!=e[s.DBColumnName+"_Key"]?(s.Date=new Date(e[s.DBColumnName+"_Key"].ToString("MM-dd-yyyy")),e[s.DBColumnName+"_Key"]=s.Date):s.Date=null):s instanceof d.b?s.Date=null!=e[s.DBColumnName+"_Key"]?new Date(e[s.DBColumnName+"_Key"].ToString("MM-dd-yyyy")):null:s instanceof d.a&&("dcAlpha4"!=s.DBColumnName&&"dcAlpha5"!=s.DBColumnName||null!=s.Date||(t=!0),null!=e[s.DBColumnName+"_Key"]&&(s.Date=new Date(e[s.DBColumnName+"_Key"].ToString("MM-dd-yyyy"))))}),setTimeout(()=>{this.leaveTab.Fields.forEach(e=>{e instanceof m.b?e.OnPactListBoxValueChanged.Subscribe(this,"onLineItemsChange"):e instanceof d.a||e instanceof d.c?e.SelectedDateChanged.Subscribe(this,"onLineItemsChange"):e instanceof D.e?e.SelectionChangedCommand.Subscribe(this,"onLineItemsChange"):e instanceof u.d&&e.TextChangedCommand.Subscribe(this,"onLineItemsChange")})},70),t&&this.onLineItemsChange(this.toDate,null)}let s=this.ScreenObject.GridData.reduce((e,t)=>e+(null!=t.dcAlpha7?parseFloat(t.dcAlpha7):0),0);this.noOfDays.Text=isNaN(s)?0:s}onPrepareDatesGrid(){if(null==this.fromDate.Date||null==this.toDate.Date)return;if("Both"==this.session._SelectedValue||null==this.session._SelectedValue||""==this.session._SelectedValue)return a.a.IsMobile||(this.BodyVisible=!1),this.displayAgGrid=!1,void this.ScreenObject.GridDataObj.Table.forEach(e=>{null!=e.dcAlpha1&&(e.dcAlpha6="Both",this.Celleditend(e,"Name",0),this.ScreenObject.GridDataObj.updateRow(e),this.PoleDisplayMessage(2,e))});this.displayAgGrid=!0,a.a.IsMobile||(this.BodyVisible=!0);let e=0,t=this.ScreenObject._CCFields.find(e=>"dcccnid51"==e.DBColumnName.toLowerCase());(t&&t instanceof m.b&&t.SelectedValue>0||t&&t instanceof C.a&&t.SelectedValue>0)&&(e=t.SelectedValue);let s=a.a.mcommon.GetAttendanceDetails(this.fromDate.Date.ToString("dd/MMM/yyyy"),this.toDate.Date.ToString("dd/MMM/yyyy"),e);this.LeaveData=[];for(let a=0;a<s.length;a++){let e=s[a];this.LeaveData.push({Date:e.AttDate,Type:e.AttendanceType,Morning:!1,Afternoon:!1,Full:!0})}var i=Object.assign({},this.ScreenObject.GridDataObj.Table[0]);this.ScreenObject.GridDataObj.Clear(),this.LeaveData.forEach(e=>{if("Weekly Off"==e.Type||"Holidays"==e.Type||"OnLeave"==e.Type)return;let t=Object.assign({},i),s=new Date(e.Date.split("/")[1]+"/"+e.Date.split("/")[0]+"/"+e.Date.split("/")[2]),n=s.ToString(a.a.SessionManager.Preferences["Date Format"]);e.FDate=n,0==this.ScreenObject.GridDataObj.Table.filter(e=>e.dcAlpha4==n).length&&(t.DocSeqNo=this.ScreenObject.GridDataObj.Table.length+1,t.SNo=this.ScreenObject.GridDataObj.Table.length+1,t.id=t.SNo,t.dcAlpha4=n,t.dcAlpha4_Key=s,t.dcAlpha5=n,t.dcAlpha5_Key=s,t.dcAlpha6="Both",this.ScreenObject.GridDataObj.addRow(t),this.Celleditend(t,"Name",0),this.ScreenObject.GridDataObj.updateRow(t),this.PoleDisplayMessage(2,t))}),this.OnSesionGridDataChanged.Call(),this.ScreenObject.GridDataObj.refreshDataView()}onEditLeaveData(e,t){if(this.leaveTab.Fields.forEach(e=>{e instanceof m.b?e.OnPactListBoxValueChanged=new b.b:e instanceof d.a||e instanceof d.c?e.SelectedDateChanged=new b.b:e instanceof D.e?e.SelectionChangedCommand=new b.b:e instanceof u.d&&(e.TextChangedCommand=new b.b)}),this.ScreenObject.LoadFieldsData(e.Tables[1],this.ScreenObject.LineItemFields,t,e.Columns[1]),this.ScreenObject.LoadFieldsData(e.Tables[3],this.ScreenObject.LineItemFields,t,e.Columns[3]),null!=this.toDate){let t=e.Tables[3][e.Tables[3].length-1].dcAlpha4;n.e.isValidDate(t)&&(this.toDate.Date=new Date(t))}this.onPrepareDatesGrid(),setTimeout(()=>{let t=!0;e.Tables[3].forEach(e=>{"Both"!=e.dcAlpha6&&(t=!1);let s=this.LeaveData.filter(t=>t.Date==e.dcAlpha4);0!=s.length&&("Session1"==e.dcAlpha6?(s[0].Full=!1,s[0].Morning=!0,s[0].Afternoon=!1):"Session2"==e.dcAlpha6?(s[0].Full=!1,s[0].Morning=!1,s[0].Afternoon=!0):(s[0].Full=!0,s[0].Morning=!1,s[0].Afternoon=!1))}),t?(this.displayAgGrid=!1,this.BodyVisible=!1):(this.displayAgGrid=!0,this.BodyVisible=!0),this.OnSesionGridDataChanged.Call(),this.onBindLeaveAssignDetails(),this.leaveTab.Fields.forEach(e=>{e instanceof m.b?e.OnPactListBoxValueChanged.Subscribe(this,"onLineItemsChange"):e instanceof d.a||e instanceof d.c?e.SelectedDateChanged.Subscribe(this,"onLineItemsChange"):e instanceof D.e?e.SelectionChangedCommand.Subscribe(this,"onLineItemsChange"):e instanceof u.d&&e.TextChangedCommand.Subscribe(this,"onLineItemsChange")})},40)}EmpAccessibility(e,t,s,i){let r=[],o="",l=0,c="",h="",u="",d="",D="",S=null;console.log("EmpAccessibility Inside");try{if(r.push(a.a.SessionManager.CompanyIndex),r.push(a.a.SessionManager.iEmployee),S=a.a.empService.ExecuteQuery_SP(r,"spPAY_GetGeoLocation"),n.e.IsEmpty(S)||!(S.Tables.length>0))return i.Flag="404",i.Msg="No records found please contact your system administrator!",console.log(i.Msg),!0;{if(!(S.Tables[0].length>0&&S.Tables[1].length>0))return i.Flag="404",i.Msg="No records found please contact your system administrator!",console.log(i.Msg),!1;if(c=n.e.String(S.Tables[0][0].Latitude),h=n.e.String(S.Tables[0][0].Longitude),D=n.e.String(S.Tables[1][0].CheckInOutDevice),o=n.e.String(S.Tables[1][0].AccessAnyWhere),l=parseInt(S.Tables[1][0].CheckInOutMobileRange||250),u=n.e.String(S.Tables[1][0].AttSetType),d=n.e.String(S.Tables[1][0].AttSetDimNodes),"True"==o)return i.Flag="200",i.Msg="Allowed",!0;let e;if("Company"==u)return e=n.e.haversineDistance({latitude:t,longitude:s},{latitude:c,longitude:h}),console.log("ApiRangeValue KM  "+e),e*=1e3,console.log("ApiRangeValue Meter only  "+e),console.log("strCatSetType  "+u),l>0&&e<=l?(i.Flag="200",i.Msg=" Allowed",console.log(i.Msg),!0):(i.Flag="404",i.Msg=" Not Allow for this location to check-in/check-out, out of range",console.log(i.Msg),!1);if("Dimension"==u){if(console.log("strCatSetType"+u),!(d.length>0))return i.Flag="500",i.Msg=" No location is assigned",console.log(i.Msg),!1;{let a=d.split(",");if(a.length>0){let r=!1;for(let o=0;o<a.length;o++){const c=a[o];let h,u;if(S.Tables[0].length>0){let a=S.Tables[0].find(e=>e.NodeID==c);if(u=n.e.IsEmpty(a.Longitude)?0:a.Longitude,h=n.e.IsEmpty(a.Latitude)?0:a.Latitude,console.log("CurrUserLat"+t+"CurrUserLong"+s),console.log("strNodeLat"+h+"strNodeLon"+u),e=n.e.haversineDistance({latitude:t,longitude:s},{latitude:h,longitude:u}),console.log("ApiRangeValue KM"+e+"index"+o),e*=1e3,console.log("ApiRangeValue Meter"+e+"index"+o),l>0&&e<=l)return i.Flag="200",i.Msg=" Allowed",void(r=!0)}}return r?(i.Flag="200",i.Msg=" Allowed",!0):(i.Flag="404",i.Msg=" You are not allowed to check-in/check-out, out of range from this location",console.log(i.Msg),!1)}}}}}catch(m){console.log("catch (error) "+m),console.log("Excetion EmpAccessibility"+m)}return!1}}Yt=new WeakMap;class ts{constructor(){this.Name="",this.Message=""}}},"3WaB":function(e,t,s){"use strict";s.d(t,"a",(function(){return d}));var i=s("mrSG"),a=s("Do2H"),n=s("Lp6j"),r=s("eQJW"),o=s("4HhE"),l=s("n56n"),c=s("NkMH"),h=s("ScVY"),u=s("Huqd");class d extends h.b{constructor(e){super(),this.ButtonClick=new o.b,this.Groups=[],this.Parent=null,this.wid="50",this.ht="50",this.tWhere="",Logger.InfoLog("TouchScreenViewModel:: Entering TouchScreenViewModel"),this.Parent=e,this.ButtonClick.Subscribe(this,"OnButtonClick"),this.Groups=[];let t=null;if(this.Parent.ScreenObject.Data.Columns[11].Contains("CCID")&&this.Parent.ScreenObject.Data.Tables[11].length>0){n.e.IsEmpty(this.Parent.ScreenObject.Data.Tables[11][0].ButtonHeight)||(this.ht=this.Parent.ScreenObject.Data.Tables[11][0].ButtonHeight.toString()),n.e.IsEmpty(this.Parent.ScreenObject.Data.Tables[11][0].ButtonWidth)||(this.wid=this.Parent.ScreenObject.Data.Tables[11][0].ButtonWidth.toString());for(let e=0;e<this.Parent.ScreenObject.Data.Tables[11].length-1;e++)"3"==this.Parent.ScreenObject.Data.Tables[11][e].CCID.toString()?t=this.Parent.ScreenObject.Data.Tables[11][e]:n.e.IsEmpty(this.Parent.ScreenObject.Data.Tables[11][e].CCID)||(this.Groups.push(new l.b),this.Groups[e].CCID=parseInt(this.Parent.ScreenObject.Data.Tables[11][e].CCID.toString()),""!=this.Parent.ScreenObject.Data.Tables[11][e].Map.toString()&&(this.Groups[e].Dependancy=parseInt(this.Parent.ScreenObject.Data.Tables[11][e].Map.toString())),n.e.IsEmpty(this.Parent.ScreenObject.Data.Tables[11][e].ParentCCID)||(this.Groups[e].DBColumnID=parseInt(this.Parent.ScreenObject.Data.Tables[11][e].ParentCCID.toString())),this.Groups[e].Label=this.Parent.ScreenObject.Data.Tables[11][e].Name.toString()+" >>",this.Groups[e].Expression=this.Parent.ScreenObject.Data.Tables[11][e].Filter,this.Groups[e].Expression=n.e.IsEmpty(this.Groups[e].Expression)?"":this.GetExpression(this.Groups[e].Expression),n.e.IsEmpty(this.Parent.ScreenObject.Data.Tables[11][e].ColumnInUse)||(this.Groups[e].Dependantinuse=Object(r.j)(this.Parent.ScreenObject.Data.Tables[11][e].ColumnInUse.toString())),this.Groups[e].SelectionChangedCommand.Subscribe(this,"OnButtonClick"),this.Groups[e].Visible=!1)}let s=new l.b;s.CCID=3,s.Visible=!1,s.Label="Products",this.Groups.length>0&&(s.DBColumnID=this.Groups[this.Groups.length-1].CCID),null==t&&""!=this.Parent.ScreenObject.Data.Tables[11][this.Parent.ScreenObject.Data.Tables[11].length-1].ColumnInUse.toString()?s.Dependantinuse=Object(r.j)(this.Parent.ScreenObject.Data.Tables[11][this.Parent.ScreenObject.Data.Tables[11].length-1].ColumnInUse):null!=t&&""!=this.Parent.ScreenObject.Data.Tables[11][this.Parent.ScreenObject.Data.Tables[11].length-2].ColumnInUse.toString()&&(s.Dependantinuse=Object(r.j)(this.Parent.ScreenObject.Data.Tables[11][this.Parent.ScreenObject.Data.Tables[11].length-2].ColumnInUse)),s.Expression=null==t||n.e.IsEmpty(t.Filter).toString()?"":this.GetExpression(t.Filter.toString()),this.Groups.push(s),n.e.IsEmpty(this.Parent.ScreenObject.Data.Tables[11][this.Parent.ScreenObject.Data.Tables[11].length-1].Filter).toString()||(this.tWhere=" and "+this.Parent.ScreenObject.Data.Tables[11][this.Parent.ScreenObject.Data.Tables[11].length-1].Filter.toString(),this.tWhere=this.GetExpression(this.tWhere)),this.Groups.length>0&&this.FillButtons(this.Groups[0]),Logger.InfoLog("TouchScreenViewModel:: Entering TouchScreenViewModel")}get IsNewPOS(){return null!=this.Parent&&"POSDocumentViewModel"==this.Parent.ClassName}get SearchText(){return this._SearchText}set SearchText(e){e!=this._SearchText&&(this._SearchText=e,this.Search())}GetExpression(e){for(let t=0;t<this.Parent.ScreenObject._CCFields.length;t++)this.Parent.ScreenObject._CCFields[t]instanceof l.b&&e.Contains("@dim"+(this.Parent.ScreenObject._CCFields[t].CCID-5e4))?this.Parent.ScreenObject._CCFields[t].SelectedValue>0&&(e=e.Replace("@dim"+(this.Parent.ScreenObject._CCFields[t].CCID-5e4),this.Parent.ScreenObject._CCFields[t].SelectedValue.toString())):this.Parent.ScreenObject._CCFields[t]instanceof u.a&&e.Contains("@dim"+(this.Parent.ScreenObject._CCFields[t].CCID-5e4))&&this.Parent.ScreenObject._CCFields[t].SelectedValue>0&&(e=e.Replace("@dim"+(this.Parent.ScreenObject._CCFields[t].CCID-5e4),this.Parent.ScreenObject._CCFields[t].SelectedValue.toString()));return e.Contains("@dim2")&&this.Parent.ScreenObject.LocationID>0&&(e=e.Replace("@dim2",this.Parent.ScreenObject.LocationID.toString())),e.Contains("@dim1")&&this.Parent.ScreenObject.DivisionID>0&&(e=e.Replace("@dim1",this.Parent.ScreenObject.DivisionID.toString())),e.Contains("@REGISTER")&&this.Parent.ScreenObject.RegisterNodeID>0&&(e=e.Replace("@REGISTER",this.Parent.ScreenObject.RegisterNodeID.toString())),e}Search(){if(n.e.IsEmpty(this.SearchText))this.ButtonsData.forEach(e=>e.IsTabStop=!0);else{var e=this.ButtonsData.filter(e=>e.Label.toLowerCase().Contains(this.SearchText.toLowerCase())||!n.e.IsEmpty(e.ToolTipDescription)&&e.ToolTipDescription.toLowerCase().Contains(this.SearchText.toLowerCase()));this.ButtonsData.forEach(t=>t.IsTabStop=e.Contains(t))}}FillButtons(e){e.Visible=!0,e.SelectedValue=0,e.Text="";let t="",s="";3==e.CCID?(t=" p.IsGroup=0 ",this.Groups.indexOf(e)>0&&this.Groups[this.Groups.indexOf(e)-1].DBColumnID<0&&(t=t+" AND p.ParentID="+e.FeatureID)):e.CCID<0?(t=" p.Depth="+-e.CCID,this.Groups.indexOf(e)>0&&(t=t+" AND p.ParentID="+e.FeatureID)):t=" a.IsGroup=0 ",n.e.IsEmpty(e.Expression)||(t+=" and "+e.Expression);var i=this.Groups.find(t=>t.CCID==e.DBColumnID);null!=i&&i.SelectedValue>0&&(e.Dependantinuse?t+=50006==e.DBColumnID?" and CategoryID="+i.SelectedValue.toString():50004==e.DBColumnID?" and DepartmentID="+i.SelectedValue.toString():" and ccnid"+(e.DBColumnID-5e4)+"="+i.SelectedValue.toString():5==e.Dependancy&&e.CCID>0&&(s="JOIN "+this.Parent.ScreenObject.GetTableName(e.CCID)+" CMJ WITH(NOLOCK) ON a.lft between  CMJ.lft and CMJ.rgt \n                                 JOIN COM_CostCenterCostCenterMap CM WITH(NOLOCK) on CM.CostCenterID="+e.CCID+" and CM.ParentCostCenterID="+i.CCID+" and CM.ParentNodeID="+i.SelectedValue.toString()+' and CMJ.NodeID=CM.NodeID ";\n                    else if (grp.Dependancy > 0 && grp.CCID > 0 && !(this.Groups.indexOf(grp) > 0 && (this.Groups[this.Groups.indexOf(grp) - 1].DBColumnID < 0 || this.Groups[this.Groups.indexOf(grp) - 1].CCID < 0)))\n                        join = " JOIN COM_CostCenterCostCenterMap CM WITH(NOLOCK) on CM.ParentCostCenterID='+e.CCID+" and "+(3==e.CCID?"p.ProductID":"a.NodeID")+"=CM.ParentNodeID \n                                 JOIN "+this.Parent.ScreenObject.GetTableName(i.CCID)+" CMJ WITH(NOLOCK) ON CM.CostCenterID= "+i.CCID+"   and CM.NodeID=CMJ.NodeID \n                                 JOIN "+this.Parent.ScreenObject.GetTableName(i.CCID)+" CMJG WITH(NOLOCK) ON CMJG.lft between  CMJ.lft and CMJ.rgt and CMJG.NodeID="+i.SelectedValue));let o=this.Parent.ScreenObject.GetCCData(e.CCID,t,s,this.tWhere);if(null!=o&&!o.Columns.Contains("ErrorMessage")){let t="",s=[];for(let i=0;i<o.length;i++){let l=new c.a;l.FeatureID=parseInt(o[i].ID.toString()),l.DBColumnID=e.CCID<0&&o.Columns.Contains("IsGroup")&&!Object(r.j)(o[i].IsGroup.toString())?3:e.CCID,l.ClickCommand.Subscribe(this,"OnButtonClick"),l.Width=this.wid,l.SectionID=this.ht,l.Mandatory=!1,l.Visible=!1,l.IsTabStop=!0,l.Dependantinuse=!1,3==l.DBColumnID?(t+=l.FeatureID+",","true"==a.a.SessionManager.Preferences.POSShowProductCode.toLowerCase()?("true"==a.a.SessionManager.Preferences.POSShowProductName.toLowerCase()&&(l.ToolTipDescription=o[i].name.toString(),l.Mandatory=!0),l.Label="true"==a.a.SessionManager.Preferences.POSShowStockCodes.toLowerCase()&&o.Columns.Contains("StkCode")?o[i].StkCode.toString():o[i].Code.toString()):"true"==a.a.SessionManager.Preferences.POSShowProductName.toLowerCase()&&(l.Label=o[i].name.toString()),"true"!=a.a.SessionManager.Preferences.POSShowProductImage.toLowerCase()&&"true"!=a.a.SessionManager.Preferences.POSShowDimImage.toLowerCase()||!o.Columns.Contains("FileName")||(l.Visible=!0,l.ToolTipFooterDescription=n.e.IsEmpty(o[i].FileName)?a.a.SessionManager.IsWebApplication?"NO Image Available.png":"/PACT.VIEW;component/Images/NO Image Available.png":a.a.SessionManager.IsWebApplication?o[i].FileName.toString():n.e.GetPath(o[i].FileName.toString())),""!=a.a.SessionManager.Preferences.POSSellingRate.toLowerCase()&&o.Columns.Contains("MRP")&&(l.Dependantinuse=!0,l.KeyTip=o[i].MRP.toString()),o.Columns.Contains("StkCode")&&(l.ToolTipFooterTitle=o[i].StkCode.toString(),l.ToolTipTitle=o[i].NodeID.toString())):(l.Label=o[i].name.toString(),l.DBColumnID<0?"true"==a.a.SessionManager.Preferences.POSShowProductImage.toLowerCase()&&o.Columns.Contains("FileName")&&(l.Visible=!0,l.ToolTipFooterDescription=n.e.IsEmpty(o[i].FileName)?a.a.SessionManager.IsWebApplication?"NO Image Available.png":"/PACT.VIEW;component/Images/NO Image Available.png":a.a.SessionManager.IsWebApplication?o[i].FileName.toString():n.e.GetPath(o[i].FileName.toString())):"true"==a.a.SessionManager.Preferences.POSShowDimImage.toLowerCase()&&o.Columns.Contains("FileName")&&(l.Visible=!0,l.ToolTipFooterDescription=n.e.IsEmpty(o[i].FileName)?a.a.SessionManager.IsWebApplication?"NO Image Available.png":"/PACT.VIEW;component/Images/NO Image Available.png":a.a.SessionManager.IsWebApplication?o[i].FileName.toString():n.e.GetPath(o[i].FileName.toString()))),s.push(l)}if(t.length>2&&"PriceChart"==a.a.SessionManager.Preferences.POSSellingRate){t=t.substr(0,t.length-1);let e=this.Parent.ScreenObject.GetProductPrices(t,this.Parent.DocumentDate);null!=e&&e.Columns[0].Contains("ProductID")&&s.forEach(t=>{var s=e.Tables[0].filter(e=>e.ProductID==t.FeatureID).sort((e,t)=>e.RowID-t.RowID);s.length>0&&(t.Dependantinuse=!0,t.KeyTip=s[0].SellingRate.toString())})}this.ButtonsData=s}}OnButtonClick(e){return Object(i.b)(this,void 0,void 0,(function*(){if(yield Promise.all([s.e(2),s.e(1),s.e(3),s.e(5),s.e(4),s.e(6),s.e(7),s.e(10),s.e(9),s.e(12),s.e(11),s.e(13),s.e(19),s.e(15),s.e(21),s.e(20),s.e(16),s.e(14),s.e(18),s.e(17),s.e(22),s.e(148)]).then(s.bind(null,"1Cra")),yield s.e(196).then(s.bind(null,"7Uhj")),e instanceof c.a){let s=e;if(3==s.DBColumnID){let e=this.Parent.GetEmptyRowPosition(this.Parent.ScreenObject.GridDataObj,"ProductID_Key"),l=this.Parent.ScreenObject.GridData[e];if(l.ProductID_Key=s.FeatureID,n.e.IsEmpty(s.ToolTipTitle))this.Parent.AddProductData(l,!1,!0,!1,null,"");else{this.Parent.ScreenObject.Preferences.ContainsKey("OnScan")&&""!=this.Parent.ScreenObject.Preferences.OnScan.toLowerCase()?this.Parent.GetProductByExternFunc(s.ToolTipFooterTitle,l,e):this.Parent.ScreenObject.Preferences.ContainsKey("PickStockRate")&&"true"==this.Parent.ScreenObject.Preferences.PickStockRate.toLowerCase()?this.Parent.GetProductByStockCode(s.ToolTipFooterTitle,l,e):this.Parent.AddProductData(l,!1,!0,!1,null,s.ToolTipFooterTitle);var t=this.Parent.ScreenObject.ColumnSource.find(e=>e.CostCenterID.toString()==a.a.SessionManager.Preferences.POSItemCodeDimension);null!=t&&this.Parent.ScreenObject.GridDataObj.Columns.Contains(t.DisplayMember)&&(l[t.DisplayMember]=s.ToolTipFooterTitle,l[t.ValueMember]=s.ToolTipTitle)}if(""!=l.ProductID_Key.toString()){var i=this.Parent.ScreenObject.ColumnSource.find(e=>!n.e.IsEmpty(e.ValueMember)&&"productid_key"==e.ValueMember.toLowerCase()&&!n.e.IsEmpty(e.Shortcut)&&"lostfocus"==e.Shortcut.toLowerCase());null!=i&&this.Parent.ValidateData(i,!0)&&this.Parent.ScreenObject.GetExternalFuncData(i.Mode,i.SPName,i.IPParams,i.OPParams,l),this.Parent.PoleDisplayMessage(2,l)}null!=this.Parent.NumericPADView&&null!=this.Parent.NumericPADView.txt&&""!=this.Parent.NumericPADView.txt.Text&&"0"!=this.Parent.NumericPADView.txt.Text&&(n.e.hasprop(l,"Quantity")&&("0"==this.Parent.IsSales?(l.Quantity=-n.e.DoubleTryParse(this.Parent.NumericPADView.txt.Text),this.Parent.RowForegroundChange(l)):l.Quantity=n.e.DoubleTryParse(this.Parent.NumericPADView.txt.Text)),this.Parent.NumericPADView.txt.Text="0",this.Parent.NumericPADView.DisplayMember=""),n.e.IsEmpty(l.Quantity)&&("0"==this.Parent.IsSales?(l.Quantity=-1,this.Parent.RowForegroundChange(l)):l.Quantity=1),this.Parent.CalculateTotals(l,!1);let c=!1;if(c=this.Parent.ScreenObject.Preferences.EnableSchemes,this.Parent.ScreenObject.Preferences.ContainsKey("EnableSchemes")&&this.Parent.ScreenObject.Preferences.EnableSchemes&&(c=Object(r.j)(this.Parent.ScreenObject.Preferences.EnableSchemes)),c){let e="GROSS";if(this.Parent.ScreenObject.Preferences.ContainsKey("SchemesNumericFields")&&""!=this.Parent.ScreenObject.Preferences.SchemesNumericFields&&"0"!=this.Parent.ScreenObject.Preferences.SchemesNumericFields){var o=this.Parent.ScreenObject.ColumnSource.find(e=>e.ID==this.Parent.ScreenObject.Preferences.SchemesNumericFields);null!=o&&""!=o.DisplayMember&&(e=o.DisplayMember)}if(""!=l.ProductID_Key.toString()&&parseInt(l.ProductID_Key.toString())>0){let e=this.Parent.ScreenObject.GetSchemes(this.Parent.DocumentDate,l);e.Tables.Count>0&&e.Tables[0].Columns.Contains("SchemeID")&&this.Parent.fillSchemevalues(this.Parent.DtTempSchemes,e.Tables[0],l)}this.Parent.ApplySchemes(l)}this.Parent.Celleditend(l,"Quantity",0),null!=this.Parent.NumericPADView&&(this.Parent.NumericPADView.txt.Text="0",this.Parent.NumericPADView.DisplayMember="")}else{var h=this.Groups.find(e=>e.CCID==s.DBColumnID);h.SelectedValue=s.FeatureID,h.Text=s.Label;let e=this.Groups.indexOf(h);s.DBColumnID<0&&(this.Groups[e+1].Label=s.Label,this.Groups[e+1].FeatureID=s.FeatureID),this.Groups.length>e+1&&this.FillButtons(this.Groups[e+1])}}else if(e instanceof l.b){this.FillButtons(e);let t=!0;for(let s=0;s<this.Groups.length;s++)this.Groups[s].Visible=t,this.Groups[s]==e&&(t=!1)}}))}Refresh(){if(this.Groups.length>0){this.FillButtons(this.Groups[0]);for(let e=1;e<this.Groups.length;e++)this.Groups[e].Visible=!1}}}},"9UOb":function(e,t,s){"use strict";s.r(t),s.d(t,"PostVoucherSaveViewModel",(function(){return S}));var i=s("mrSG"),a=s("Do2H"),n=s("Lp6j"),r=s("eQJW"),o=s("ScVY"),l=s("keYA"),c=s("EQd/"),h=s("JIg3"),u=s("n56n"),d=s("/GLD"),D=s("4HhE");class S extends o.b{constructor(e,t,s,i,o,S,m,b){if(super(),this.ExpanderVisibility=!1,this.Denom=null,this.PDCS=null,this.ChequeNo=new c.d(0),this.Shift=new c.d(0),this.DocDate=new c.d(0),this.ChequeDate=new h.c(0),this.Amount=new c.d(0),this.Narration=new c.d(0),this.PaymentMode=new u.b(0),this.Account=new u.b(0),this.NumericPADView=null,this.PdcVisible=!1,this.TouchVisibility=!1,this.VoucherAmt=0,this.ExhgRate=0,this.PDC=0,this.DocumentType=0,this.CostCenterID=0,this.AccountID=0,this.CurrID=0,this.IsBillwise=!1,this.IsOpening=!1,this.Tempretval=0,this.PaymentMode.CCID=2,this.PaymentMode.TypeID=15,this.Account.CCID=2,this.Account.TypeID=2,e.ScreenObject.Preferences.ContainsKey("PostPdcDoc")&&n.e.Int(e.ScreenObject.Preferences.PostPdcDoc)>4e4?(this.CostCenterID=n.e.Int(e.ScreenObject.Preferences.PostPdcDoc),this.PdcVisible=!0,this.PDCS=new l.a(e),this.PDCS.ButtonVisibility=!1):this.PdcVisible=!1,this.CurrID=o,this.CostCenterID=t,this.ExhgRate=S,this.IsBillwise=m,this.VoucherAmt=s,this.IsOpening=b,this.AccountID=i,this.Amount.DataType="FLOAT",this.oparent=e,this.Amount.Mandatory=!0,this.Amount.Text=this.PdcVisible&&this.PDCS.PDCAmount>0?(s-this.PDCS.PDCAmount).toString():s.toString(),this.PaymentMode.Mandatory=!0,this.Amount.Label=a.a.GetResource("DocumentDesigner_Amount"),this.IsOpening){if(this.DocDate.Visible=!0,this.DocDate.Label="Date",this.DocDate.Text=e.DocumentDate.ToString(a.a.SessionManager.Preferences["Date Format"]),n.e.IsEmpty(a.a.SessionManager.Preferences.PosShifts)||"0"==a.a.SessionManager.Preferences.PosShifts?this.Shift.Visible=!1:(this.Shift.Visible=!0,this.Shift.Label="Shift",this.Shift.Text=e.ScreenObject.GetDocNumberString("Name",parseInt(a.a.SessionManager.Preferences.PosShifts),e.ScreenObject.ShiftNodeID)),this.oparent.ScreenObject.Preferences.ContainsKey("GetOpCash")&&"True"==this.oparent.ScreenObject.Preferences.GetOpCash){this.Amount.IsReadOnly=!0;let e=null;for(let t=0;t<this.oparent.Shortcuts.length;t++)if(this.oparent.Shortcuts[t]instanceof D.c&&17==this.oparent.Shortcuts[t].Mode){e=this.oparent.ScreenObject.GetExtData(this.oparent.Shortcuts[t].ToolTipFooterDescription,null,this.oparent.Shortcuts[t].ToolTipFooterTitle);break}this.Amount.Text=null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&!n.e.IsEmpty(e.Tables[0][0][e.Columns[0][0]])?e.Tables[0][0][e.Columns[0][0]].toString():this.oparent.ScreenObject.getPrevCash(this.oparent.DocumentDate)}}else this.DocDate.Visible=!1,this.Shift.Visible=!1;this.oparent.FooterTouchVisible&&(this.TouchVisibility=this.oparent.FooterTouchVisible),this.ChequeDate.Visible=this.ChequeNo.Visible=this.Narration.Visible=!1,this.VoucherAmt>0?(this.Account.Visible=!1,e.ScreenObject.Preferences.ContainsKey("ChequeNODate")&&"true"==e.ScreenObject.Preferences.ChequeNODate.toLowerCase()&&(this.ChequeDate.Visible=this.ChequeNo.Visible=!0)):(e.ScreenObject.Preferences.ContainsKey("MandatoryDenom")&&Object(r.j)(e.ScreenObject.Preferences.MandatoryDenom)&&(this.Amount.Enable=!1),this.ExpanderVisibility=!(e.ScreenObject.Preferences.ContainsKey("ShowDenom")&&!Object(r.j)(e.ScreenObject.Preferences.ShowDenom)&&e.ScreenObject.Preferences.ContainsKey("MandatoryDenom")&&!Object(r.j)(e.ScreenObject.Preferences.MandatoryDenom)),this.Denom=new d.AddDenominationViewModel(this)),this.Account.Label="Account";let C=e.ScreenObject.GetScreenInfo(t);if(null!=C&&C.Tables.length>3&&C.Tables[3].length>0){this.DocumentType=parseInt(C.Tables[3][0].DocumentType),this.DocName=C.Tables[3][0].DocumentName.toString(),this.Title=this.DocName;let t=null,s=null;if(14==this.DocumentType||15==this.DocumentType||23==this.DocumentType?t=C.Tables[0].filter(e=>"CreditAccount"==e.SysColumnName):18!=this.DocumentType&&19!=this.DocumentType&&22!=this.DocumentType||(t=C.Tables[0].filter(e=>"DebitAccount"==e.SysColumnName)),null!=t&&t.length>0&&(this.PaymentMode.Label=t[0].ResourceData.toString(),this.PaymentMode.TypeID=parseInt(t[0].ColumnCCListViewTypeID),0==this.VoucherAmt&&(n.e.IsEmpty(t[0].IsVisible)||(this.PaymentMode.Visible=Object(r.j)(t[0].IsVisible)),n.e.IsEmpty(t[0].IsEditable)||(this.PaymentMode.IsReadOnly=!Object(r.j)(t[0].IsEditable))),0==this.oparent.ScreenObject.PostVoucherDocID||0==this.VoucherAmt)&&(s=C.Tables[0].filter(e=>"Amount"==e.SysColumnName),14==this.DocumentType||15==this.DocumentType||23==this.DocumentType?n.e.Int(s[0].CrRefColID)>0&&(p=this.oparent.ScreenObject._CCFields.find(e=>e.DBColumnName.toLowerCase()==s[0].CRSysColumnName.toString().toLowerCase()))instanceof u.b&&p.SelectedValue>0&&(this.PaymentMode.SelectedValue=this.oparent.ScreenObject.GetAccountByRef(parseInt(s[0].CrRefID),parseInt(s[0].CrRefColID),p.SelectedValue)):18!=this.DocumentType&&19!=this.DocumentType&&22!=this.DocumentType||n.e.Int(s[0].DrRefColID)>0&&(p=this.oparent.ScreenObject._CCFields.find(e=>e.DBColumnName.toLowerCase()==s[0].DRSysColumnName.toString().toLowerCase()))instanceof u.b&&p.SelectedValue>0&&(this.PaymentMode.SelectedValue=this.oparent.ScreenObject.GetAccountByRef(parseInt(s[0].DrRefID),parseInt(s[0].DrRefColID),p.SelectedValue)),0!=this.PaymentMode.SelectedValue||n.e.IsEmpty(t[0].UserDefaultValue)||(this.PaymentMode.SelectedValue=parseInt(t[0].UserDefaultValue))),t=C.Tables[0].filter(e=>"CommonNarration"==e.SysColumnName),null!=t&&t.length>0&&(this.Narration.Label=t[0].ResourceData.toString(),n.e.IsEmpty(t[0].IsVisible)||(this.Narration.Visible=Object(r.j)(t[0].IsVisible)),"1"==n.e.String(t[0].IsMandatory)&&(this.Narration.Mandatory=!0),n.e.IsEmpty(t[0].IsEditable)||(this.Narration.IsReadOnly=!Object(r.j)(t[0].IsEditable))),this.ChequeNo.Visible&&(t=C.Tables[0].filter(e=>"ChequeNumber"==e.SysColumnName),null!=t&&t.length>0&&(this.ChequeNo.Label=t[0].ResourceData.toString(),n.e.IsEmpty(t[0].IsVisible)||(this.ChequeNo.Visible=Object(r.j)(t[0].IsVisible)),"1"==n.e.String(t[0].IsMandatory)&&(this.ChequeNo.Mandatory=!0),n.e.IsEmpty(t[0].IsEditable)||(this.ChequeNo.IsReadOnly=!Object(r.j)(t[0].IsEditable)))),this.ChequeDate.Visible&&(t=C.Tables[0].filter(e=>"ChequeDate"==e.SysColumnName),null!=t&&t.length>0&&(this.ChequeDate.Label=t[0].ResourceData.toString(),n.e.IsEmpty(t[0].IsVisible)||(this.ChequeDate.Visible=Object(r.j)(t[0].IsVisible)),"1"==n.e.String(t[0].IsMandatory)&&(this.ChequeDate.Mandatory=!0),n.e.IsEmpty(t[0].IsEditable)||(this.ChequeDate.IsReadOnly=!Object(r.j)(t[0].IsEditable))),this.ChequeNo.Visible||this.ChequeDate.Visible)){let t=e.ScreenObject.GetChequeDetails();null!=t&&t.Tables.length>0&&t.Tables[0].length>0?(this.ChequeDate.Date=n.e.IsEmpty(t.Tables[0][0].CD)?null:new Date(t.Tables[0][0].CD),this.ChequeNo.Text=t.Tables[0][0].ChequeNumber.toString()):this.ChequeDate.Date=null}if(0==this.VoucherAmt&&(14==this.DocumentType||15==this.DocumentType||23==this.DocumentType?t=C.Tables[0].filter(e=>"DebitAccount"==e.SysColumnName):18!=this.DocumentType&&19!=this.DocumentType&&22!=this.DocumentType||(t=C.Tables[0].filter(e=>"CreditAccount"==e.SysColumnName)),null!=t&&t.length>0&&(this.Account.Label=t[0].ResourceData.toString(),this.Account.TypeID=parseInt(t[0].ColumnCCListViewTypeID),n.e.IsEmpty(t[0].IsVisible)||(this.Account.Visible=Object(r.j)(t[0].IsVisible)),n.e.IsEmpty(t[0].IsEditable)||(this.Account.IsReadOnly=!Object(r.j)(t[0].IsEditable)),0==this.Account.SelectedValue))){if(s=C.Tables[0].filter(e=>"Amount"==e.SysColumnName),18==this.DocumentType||19==this.DocumentType||22==this.DocumentType)n.e.Int(s[0].CrRefColID)>0&&(p=this.oparent.ScreenObject._CCFields.find(e=>e.DBColumnName.toLowerCase()==s[0].CRSysColumnName.toString().toLowerCase()))instanceof u.b&&p.SelectedValue>0&&(this.Account.SelectedValue=this.oparent.ScreenObject.GetAccountByRef(parseInt(s[0].CrRefID),parseInt(s[0].CrRefColID),p.SelectedValue));else if(14==this.DocumentType||15==this.DocumentType||23==this.DocumentType){var p;n.e.Int(s[0].DrRefColID)>0&&(p=this.oparent.ScreenObject._CCFields.find(e=>e.DBColumnName.toLowerCase()==s[0].DRSysColumnName.toString().toLowerCase()))instanceof u.b&&p.SelectedValue>0&&(this.Account.SelectedValue=this.oparent.ScreenObject.GetAccountByRef(parseInt(s[0].DrRefID),parseInt(s[0].DrRefColID),p.SelectedValue))}0!=this.Account.SelectedValue||n.e.IsEmpty(t[0].UserDefaultValue)||(this.Account.SelectedValue=parseInt(t[0].UserDefaultValue))}}this.VoucherAmt>0&&(14==this.DocumentType||15==this.DocumentType||23==this.DocumentType)&&n.e.IsValidID(this.oparent.ScreenObject.PostVoucherDocID)&&this.oparent.ScreenObject.PostVoucherCreditAccount>0?this.PaymentMode.SelectedValue=this.oparent.ScreenObject.PostVoucherCreditAccount:this.VoucherAmt>0&&(18==this.DocumentType||19==this.DocumentType||22==this.DocumentType)&&n.e.IsValidID(this.oparent.ScreenObject.PostVoucherDocID)&&this.oparent.ScreenObject.PostVoucherDebitAccount>0&&(this.PaymentMode.SelectedValue=this.oparent.ScreenObject.PostVoucherDebitAccount),this.PaymentMode.DefaultValue=this.PaymentMode.SelectedValue.toString(),this.Account.DefaultValue=this.Account.SelectedValue.toString(),Logger.InfoLog("PostVoucherSaveViewModel:: Entering PostVoucherSaveViewModel")}ValidateChequeDetails(e){let t=this.oparent.ScreenObject.GetAccBalance(this.PaymentMode.SelectedValue,this.oparent.DocumentDate);if(null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&t.Columns[0].Contains("IsBillwise")&&Object(r.j)(t.Tables[0][0].IsBillwise))return this.DisplayMessage="Can not select billwise account in "+(e?"reciept":"payment")+" Mode",this.MessageVisibility=!0,!1;if((this.ChequeDate.Mandatory||this.ChequeNo.Mandatory)&&null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&t.Columns[0].Contains("AccountTypeID")&&("2"==n.e.String(t.Tables[0][0].AccountTypeID)||"3"==n.e.String(t.Tables[0][0].AccountTypeID))){if(this.ChequeDate.Mandatory&&!this.ChequeDate.Date)return this.DisplayMessage=a.a.GetResource("Select")+" "+this.ChequeDate.Label,this.MessageVisibility=!0,!1;if(this.ChequeNo.Mandatory&&n.e.IsEmpty(this.ChequeNo.Text))return this.DisplayMessage=a.a.GetResource("Enter")+" "+this.ChequeNo.Label,this.MessageVisibility=!0,!1}return!0}OnButtonClick(e){if("Cancel"==e){if(this.PdcVisible){if(this.PDCS.PDCAmount+this.oparent.ScreenObject.PostVoucherAmount>this.VoucherAmt)return this.DisplayMessage=14==this.DocumentType||15==this.DocumentType||23==this.DocumentType?"Save reciept as amount is less than reciept made earlier":"Save payment as amount is less than payment made earlier",void(this.MessageVisibility=!0)}else if(this.oparent.ScreenObject.PostVoucherAmount>this.VoucherAmt)return this.DisplayMessage=14==this.DocumentType||15==this.DocumentType||23==this.DocumentType?"Save reciept as amount is less than reciept made earlier":"Save payment as amount is less than payment made earlier",void(this.MessageVisibility=!0);this.IsOpening&&(this.oparent.DialogResult=!1),a.a.page.HideDialog()}else if("LostFocus"==e)this.PdcVisible&&n.e.IsNum(this.Amount.Text)&&(this.PDCS.Amount.Text=(this.VoucherAmt-n.e.Double(this.Amount.Text)).toString());else if("OK"==e||"OKPrint"==e){let s=this.PaymentMode.GetValidationError("SelectedValue");if(""!=s)return this.DisplayMessage=s,void(this.MessageVisibility=!0);if(s=this.Amount.GetValidationError("Text"),""!=s)return this.DisplayMessage=s,void(this.MessageVisibility=!0);if(this.PdcVisible){if(parseFloat(this.Amount.Text)+this.PDCS.CalcPDCAmt()>this.VoucherAmt)return this.DisplayMessage=a.a.GetResource("PostVoucherAmtValidation")+this.VoucherAmt.toString(),void(this.MessageVisibility=!0)}else if(this.VoucherAmt>0&&parseFloat(this.Amount.Text)>this.VoucherAmt)return this.DisplayMessage=a.a.GetResource("PostVoucherAmtValidation")+this.VoucherAmt.toString(),void(this.MessageVisibility=!0);if(0==this.VoucherAmt&&(this.Account.Mandatory=!0,s=this.Account.GetValidationError("SelectedValue"),""!=s))return this.DisplayMessage=s,void(this.MessageVisibility=!0);if(0!=parseFloat(this.Amount.Text)){let s="";if(s+="<DocumentXML><Row><Transactions  ",s+=' DocDetailsID="'+this.oparent.ScreenObject.PostVoucherDocDetailsID+'"  DocSeqNo="1" Amount="'+parseFloat(this.Amount.Text)*this.ExhgRate+'" ',s+=' AmtFc="'+parseFloat(this.Amount.Text)+'" ',s+=' CurrencyID="'+this.CurrID+'" ',s+=' ExchangeRate="'+this.ExhgRate+'" ',null!=this.Narration&&null!=this.Narration.Text&&""!=this.Narration.Text&&(s+=' CommonNarration="'+c.d.GetValidXml(this.Narration.Text)+'" '),this.ChequeDate.Visible&&this.ChequeDate.Date&&(s+=' ChequeDate="'+this.ChequeDate.Date.ToString("dd/MMM/yyyy")+'" '),this.ChequeNo.Visible&&!n.e.IsEmpty(this.ChequeNo.Text)&&(s+=' ChequeNumber="'+this.ChequeNo.Text+'" '),14==this.DocumentType||15==this.DocumentType||23==this.DocumentType){if(!this.ValidateChequeDetails(!1))return;s+='CreditAccount="'+this.PaymentMode.SelectedValue+'" ',s+=0==this.VoucherAmt&&this.Account.SelectedValue>0?'DebitAccount="'+this.Account.SelectedValue+'" ':'DebitAccount="'+this.AccountID+'" '}else if(18==this.DocumentType||19==this.DocumentType||22==this.DocumentType){if(!this.ValidateChequeDetails(!0))return;s+='DebitAccount="'+this.PaymentMode.SelectedValue+'" ',s+=0==this.VoucherAmt&&this.Account.SelectedValue>0?'CreditAccount="'+this.Account.SelectedValue+'" ':'CreditAccount="'+this.AccountID+'" '}if(s+="></Transactions> ",0==this.VoucherAmt){let e=this.oparent.ScreenObject.GenerateQueryfromList(this.oparent.ScreenObject._CCFields,!0,{message:""},!1,!1);a.a.SessionManager.RegisterCCID>0&&this.oparent.ScreenObject.RegisterNodeID>0&&!e.toString().Contains("dcCCNID"+(a.a.SessionManager.RegisterCCID-5e4).toString()+"=")&&(e+=" dcCCNID"+(a.a.SessionManager.RegisterCCID-5e4).toString()+"="+this.oparent.ScreenObject.RegisterNodeID.toString()+", "),this.oparent.ScreenObject.ShiftNodeID>0&&a.a.SessionManager.Preferences.ContainsKey("PosShifts")&&""!=a.a.SessionManager.Preferences.PosShifts.toString()&&parseInt(a.a.SessionManager.Preferences.PosShifts)>5e4&&!e.toString().Contains("dcCCNID"+(parseInt(a.a.SessionManager.Preferences.PosShifts)-5e4)+"=")&&(e+=" dcCCNID"+(parseInt(a.a.SessionManager.Preferences.PosShifts)-5e4).toString()+"="+this.oparent.ScreenObject.ShiftNodeID.toString()+", "),s+=' <Numeric /> <Alpha /> <CostCenters  Query="'+e+'"  /> '}else s+=' <Numeric /> <Alpha /> <CostCenters  Query="'+this.oparent.ScreenObject.GenerateQueryfromList(this.oparent.ScreenObject._CCFields,!0,{message:""},!1,!1)+'"  /> ';if(s+="<EXTRAXML> ",this.VoucherAmt>0&&this.IsBillwise&&a.a.SessionManager.Preferences.ContainsKey("On")&&"True"==a.a.SessionManager.Preferences.On&&""!=this.Amount.Text){0==this.ExhgRate&&(this.ExhgRate=1),s+='<BillWise> <Row DocSeqNo="1" AccountID="'+this.AccountID.toString(),14==this.DocumentType||15==this.DocumentType||23==this.DocumentType?s+='" AmountFC="'+parseFloat(this.Amount.Text)+'" AdjAmount="'+parseFloat(this.Amount.Text)*this.ExhgRate+'"':18!=this.DocumentType&&19!=this.DocumentType&&22!=this.DocumentType||(s+='" AmountFC="-'+parseFloat(this.Amount.Text)+'" AdjAmount="-'+parseFloat(this.Amount.Text)*this.ExhgRate+'"'),s+=' AdjCurrID="'+this.CurrID+'" ',s+='AdjExchRT="'+this.ExhgRate+'" ',s+='Narration="" ',s+='IsDocPDC="0" ';var t=this.oparent.GetButton("Advance");null!=t&&t.Visible?s+='IsNewReference="1" ':(s+='IsNewReference="0" ',s+='RefDocNo="'+this.oparent.ScreenObject.VoucherNo+'" ',s+='RefDocSeqNo="1" ',s+='RefDocDate="'+this.oparent.DocumentDate.ToString("dd/MMM/yyyy")+'" ',null!=this.oparent.ScreenObject.DueDate&&this.oparent.ScreenObject.DueDate.Date&&(s+='RefDocDueDate="'+this.oparent.ScreenObject.DueDate.Date.ToString("dd/MMM/yyyy")+'" ')),s+=" ></Row>",null!=t&&t.Visible&&(s+='<NonAccRows RefDocNo="'+this.oparent.ScreenObject.VoucherNo+'" Amount="'+parseFloat(this.Amount.Text)*this.ExhgRate+'" ></NonAccRows>'),s+="</BillWise>"}s+="</EXTRAXML> ",0==this.VoucherAmt&&null!=this.Denom&&(s+="<PosPayModes>"+this.Denom.GetXML()+"</PosPayModes>"),s+=" </Row>",s+="</DocumentXML> ";let r=0,o=300;0!=this.VoucherAmt||this.IsOpening||(o=0);let l='<XML SysInfo="'+a.a.SessionManager.GetSysInfo()+'" GenratePrefix="1" ';null!=this.oparent&&this.oparent.IsPOs&&(l+=' PosSessionID="'+this.oparent.PosSessionID+'"'),l+=' AP="'+a.a.SessionManager.GetAccessPoint()+'"',l+=" />",this.oparent.ScreenObject.SaveAccountingDocument_2(this.CostCenterID,this.oparent.ScreenObject.PostVoucherDocID,this.oparent.ScreenObject.PostVouceherDocPrefix,this.oparent.ScreenObject.PostVoucherDocnumber,s.toString(),this.oparent.DocumentDate,0,o,this.oparent.ScreenObject.DocID,l,this.GetPDCSML()).subscribe(t=>Object(i.b)(this,void 0,void 0,(function*(){if(this.DisplayMessage=t.Message,r=t.RetValue,a.a.SessionManager.IsValidNode(r)){if(this.Tempretval=r,"OKPrint"==e){let e='<XML CostCenterID="'+this.CostCenterID+'" IsInventoryVoucher="0" />',t=yield this.oparent.PrintVoucher(!1,this.Tempretval.toString(),!1,e);this.DisplayMessage=this.DisplayMessage+"\r\n "+t}this.VoucherAmt>0||this.IsOpening?a.a.page.HideDialog():(this.Amount.Text="0",this.Account.SelectedValue=n.e.IsEmpty(this.Account.DefaultValue)?0:parseInt(this.Account.DefaultValue),this.PaymentMode.SelectedValue=n.e.IsEmpty(this.PaymentMode.DefaultValue)?0:parseInt(this.PaymentMode.DefaultValue))}})),e=>{console.log(e),this.DisplayMessage="Error in save"})}else if(this.PdcVisible&&this.PDCS.CalcPDCAmt()>0){let e='<XML SysInfo="'+a.a.SessionManager.GetSysInfo()+'" AP="'+a.a.SessionManager.GetAccessPoint()+'"  GenratePrefix="1" />',t=0;this.oparent.ScreenObject.SaveAccountingDocument_2(0,0,"","","",this.oparent.DocumentDate,0,300,this.oparent.ScreenObject.DocID,e,this.GetPDCSML()).subscribe(e=>{this.DisplayMessage=e.Message,t=e.RetValue,t>0&&(this.Tempretval=t,a.a.page.HideDialog())},e=>{console.log(e),this.DisplayMessage="Error in save"})}else if(0==parseFloat(this.Amount.Text)&&n.e.IsValidID(this.oparent.ScreenObject.PostVoucherDocID)){let e,t=this.oparent.ScreenObject.DeleteDocumentByDocID(this.CostCenterID,this.oparent.ScreenObject.PostVoucherDocID,!0);this.DisplayMessage=t.Message,e=t.RetValue,e>0&&a.a.page.HideDialog(),this.Tempretval=e}else 0==parseFloat(this.Amount.Text)&&this.IsOpening&&a.a.page.HideDialog()}}GetPDCSML(){if(!this.PdcVisible)return"";let e="";for(let t=0;t<this.PDCS.GrBody.Table.length;t++)n.e.IsEmpty(this.PDCS.GrBody.Table[t].Amount)||(e+=" <PDCRow ",n.e.IsEmpty(this.PDCS.GrBody.Table[t].DocID)||(e+=' DOcid="'+this.PDCS.GrBody.Table[t].DocID.toString()+'" '),n.e.IsEmpty(this.PDCS.GrBody.Table[t].StatusID)||(e+=' StatusID="'+this.PDCS.GrBody.Table[t].StatusID.toString()+'" '),e+=">",e+="<DocumentXML><Row><Transactions  ",e+=' DocDetailsID="0"  DocSeqNo="1" Amount="'+parseFloat(this.PDCS.GrBody.Table[t].Amount)*this.ExhgRate+'" ',e+=' AmtFc="'+parseFloat(this.PDCS.GrBody.Table[t].Amount)+'" ',e+=' CurrencyID="'+this.CurrID+'" ',e+=' ExchangeRate="'+this.ExhgRate+'" ',n.e.IsEmpty(this.PDCS.GrBody.Table[t].ChequeDate_Key)||(e+=' ChequeDate="'+new Date(this.PDCS.GrBody.Table[t].ChequeDate_Key).ToString("dd/MMM/yyyy")+'"  ChequeMaturityDate="'+new Date(this.PDCS.GrBody.Table[t].ChequeDate_Key).ToString("dd/MMM/yyyy")+'" '),n.e.IsEmpty(this.PDCS.GrBody.Table[t].ChequeNumber)||(e+=' ChequeNumber="'+this.PDCS.GrBody.Table[t].ChequeNumber.toString()+'" '),n.e.IsEmpty(this.PDCS.GrBody.Table[t].ChequeBankName)||(e+=' ChequeBankName="'+this.PDCS.GrBody.Table[t].ChequeBankName.toString()+'" '),this.PDCS.GrBody.TableColumns.Contains("CreditAccount_Key")?(e+='CreditAccount="'+this.PDCS.GrBody.Table[t].CreditAccount_Key.toString()+'" ',e+='DebitAccount="'+this.AccountID+'" '):this.PDCS.GrBody.TableColumns.Contains("DebitAccount_Key")&&(e+='DebitAccount="'+this.PDCS.GrBody.Table[t].DebitAccount_Key.toString()+'" ',e+='CreditAccount="'+this.AccountID+'" '),e+="></Transactions> ",e+=' <Numeric /> <Alpha /> <CostCenters  Query="'+this.oparent.ScreenObject.GenerateQueryfromList(this.oparent.ScreenObject._CCFields,!0,{message:""},!1,!1)+'"  /> ',e+="<EXTRAXML> ",this.IsBillwise&&a.a.SessionManager.Preferences.ContainsKey("On")&&"True"==a.a.SessionManager.Preferences.On&&(0==this.ExhgRate&&(this.ExhgRate=1),e+='<BillWise> <Row DocSeqNo="1" AccountID="'+this.AccountID.toString(),this.PDCS.GrBody.TableColumns.Contains("CreditAccount_Key")?e+='" AmountFC="'+parseFloat(this.PDCS.GrBody.Table[t].Amount)+'" AdjAmount="'+parseFloat(this.PDCS.GrBody.Table[t].Amount)*this.ExhgRate+'"':e+='" AmountFC="-'+parseFloat(this.PDCS.GrBody.Table[t].Amount)+'" AdjAmount="-'+parseFloat(this.PDCS.GrBody.Table[t].Amount)*this.ExhgRate+'"',e+=' AdjCurrID="'+this.CurrID+'" ',e+='AdjExchRT="'+this.ExhgRate+'" ',e+='Narration="" ',e+='IsDocPDC="1" ',e+='IsNewReference="0" ',e+='RefDocNo="'+this.oparent.ScreenObject.VoucherNo+'" ',e+='RefDocSeqNo="1" ',e+='RefDocDate="'+this.oparent.DocumentDate.ToString("dd/MMM/yyyy")+'" ',null!=this.oparent.ScreenObject.DueDate&&this.oparent.ScreenObject.DueDate.Date&&(e+='RefDocDueDate="'+this.oparent.ScreenObject.DueDate.Date.ToString("dd/MMM/yyyy")+'" '),e+=" ></Row>",e+="</BillWise>"),e+="</EXTRAXML> ",e+=" </Row>",e+="</DocumentXML> ",e+=" </PDCRow>");return e.length>0&&(e='<PDCXML PDCDocument="'+this.oparent.ScreenObject.Preferences.PostPdcDoc+'">'+e+"</PDCXML> "),e}}},"I/F0":function(e,t,s){"use strict";s.r(t),s.d(t,"POSPayModesViewModel",(function(){return p}));var i=s("mrSG"),a=s("8B8H"),n=s("4HhE"),r=s("ockk"),o=s("ScVY"),l=s("0/4Q"),c=s("n56n"),h=s("EQd/"),u=s("Jnyl"),d=s("JIg3"),D=s("/GLD"),S=s("NkMH"),m=s("Do2H"),b=s("eQJW"),C=s("Lp6j");class p extends o.b{constructor(e){super(),this.ButtonClick=new n.b,this.AddDenomClick=new n.b,this.SubDenomClick=new n.b,this.DenomChange=new n.b,this.celleditend=new n.b,this.BeginEdit=new n.b,this.GridDataObj=new a.a,this.ExpiryMonth=new l.e,this.ExpiryYear=new l.e,this.BankName=new c.b,this.CardType=new c.b,this.ExpDate=new d.c,this._SelectedRow=!1,this.DenomButtons=[],this.TouchVisibility=!1,this.PayModes=[],this.Parent=null,this.Returnfld="",this.denominationxml="",this.ReturnDecimalPoints="",this.NOdeid=0,this.BillValue=0,this.points=0,this.AvailablePoints=0,this.RedeemPoints=0,this.IsinTextchanged=!1,this.Title="Pay",Logger.InfoLog("POSPayModesViewModel:: Entering POSPayModesViewModel"),this.Parent=e,this.TouchVisibility=this.Parent.FooterTouchVisible,this.BeginEdit.Subscribe(this,"OnBeginedit"),this.ButtonClick.Subscribe(this,"OnButtonClick"),this.celleditend.Subscribe(this,"oncelleditend"),this.SubDenomClick.Subscribe(this,"OnSubDenomClick"),this.AddDenomClick.Subscribe(this,"OnAddDenomClick"),this.DenomChange.Subscribe(this,"OnDenomChange");for(let i=1;i<13;i++)this.ExpiryMonth.Items.push(l.d.ComboBoxItems_2(this.Parent.ScreenObject.GetMonthName(i,!1),i.toString()));for(let i=2010;i<2050;i++)this.ExpiryYear.Items.push(l.d.ComboBoxItems_1(i.toString()));this.ExpiryMonth.Visible=!1,this.ExpiryYear.Visible=!1,this.ExpDate.Visible=!1,this.CardNo=new h.d,this.CardNo.TextChangedCommand.Subscribe(this,"OnCardKeyDown"),this.CardNo.Visible=!1,this.VoucherNo=new h.d,this.VoucherNo.Visible=!1,this.VoucherNo.Label="Voucher No.",this.VoucherNo.TextChangedCommand.Subscribe(this,"OnVoucherNoChanged"),m.a.SessionManager.Preferences.ContainsKey("Posbankname")&&""!=m.a.SessionManager.Preferences.Posbankname&&parseInt(m.a.SessionManager.Preferences.Posbankname)>0?(this.BankName.Enable=!0,this.BankName.CCID=parseInt(m.a.SessionManager.Preferences.Posbankname),this.BankName.TypeID=1):this.BankName.Enable=!1,m.a.SessionManager.Preferences.ContainsKey("PosCardType")&&""!=m.a.SessionManager.Preferences.PosCardType&&parseInt(m.a.SessionManager.Preferences.PosCardType)>0?(this.CardType.Enable=!0,this.CardType.CCID=parseInt(m.a.SessionManager.Preferences.PosCardType),this.CardType.TypeID=1):this.CardType.Enable=!1,this.CardType.Visible=!1,this.BankName.Visible=!1,this.CardType.Label="Card Type",this.BankName.Label="Bank Name",this.Amount=new h.d,this.Amount.DataType="FLOAT",this.Amount.Label=m.a.GetResource("DocumentDesigner_Amount"),this.AvailAmount=new h.d,this.AvailAmount.DataType="FLOAT",this.AvailAmount.Label="Available Amount",this.AvailAmount.IsReadOnly=!0,this.CardName=new h.d,this.CardName.Visible=!1,this.ApprovalCode=new h.d,this.ApprovalCode.Label="Approval Code",this.ApprovalCode.Visible=!1,this.Parent.ScreenObject.Preferences.ContainsKey("CashForeignCurrency")&&Object(b.j)(this.Parent.ScreenObject.Preferences.CashForeignCurrency)&&(this.Currency=new u.b,this.Currency.Label=m.a.GetResource("Reports_Currency"),this.Currency.ExchangeRate.Label="Exchange",this.Currency.Currency.Label="FC Amount",this.Parent.ScreenObject.Data.Tables[14].forEach(e=>{this.Currency.Currency.Items.push(l.d.ComboBoxItems_2(e.Name.toString(),e.CurrencyID.toString()))}),this.Currency.Currency.SelectionChangedCommand.Subscribe(this,"OnCurrencyChanged","Curr"),this.Currency.ExchangeRate.LostFocusCommand.Subscribe(this,"OnCurrencyChanged")),this.InitGrid(),this.PayModes=[];let t="";e.ScreenObject.Data.Columns[1].Contains("PaymentModes")&&e.ScreenObject.Data.Tables[1].length>0&&(t=C.e.StringValue(e.ScreenObject.Data.Tables[1][0].PaymentModes));let s=this.Parent.ScreenObject.Data.Tables[0].filter(e=>e.SectionID>4,"SectionID");if(s.length>0)for(let i=0;i<s.length;i++){const e=s[i];if(!e.SysColumnName.toString().toLowerCase().Contains("currid")&&!e.SysColumnName.toString().toLowerCase().Contains("exchrt")&&(""==t||t.split(",").Contains(e.SectionID.toString())))if("12"==e.SectionID.toString())this.ReturnLabel=e.ResourceData.toString(),this.Returnfld=e.SysColumnName.toString(),C.e.hasprop(e,"Decimal")&&""!=e.Decimal.toString()&&parseFloat(e.Decimal.toString())>=0?this.ReturnDecimalPoints=e.Decimal.toString():m.a.SessionManager.Preferences.ContainsKey("DecimalsinExtraFields")&&""!=m.a.SessionManager.Preferences.DecimalsinExtraFields&&(this.ReturnDecimalPoints=m.a.SessionManager.Preferences.DecimalsinExtraFields),""!=this.ReturnDecimalPoints&&(this.Return=0+this.ReturnDecimalPoints);else{let t=new S.a;t.Label=e.ResourceData.toString(),t.DBColumnName=e.SysColumnName.toString(),t.ClickCommand.Subscribe(this,"onClick_1"),t.Row=this.PayModes.length,t.SectionID=e.SectionID.toString(),t.Mandatory=Object(b.j)(e.IsMandatory),""!=e.IsVisible.toString()&&(t.Visible=Object(b.j)(e.IsVisible)),this.PayModes.push(t),1==this.PayModes.filter(e=>e.Visible).length?this.onClick(t.DBColumnName,!1):t.Enable=!1}}this.Parent.ScreenObject.Preferences.ContainsKey("ShowDenom")&&Object(b.j)(this.Parent.ScreenObject.Preferences.ShowDenom)&&0==this.DenomButtons.length&&this.AddDenominations("1"),Logger.InfoLog("POSPayModesViewModel:: Entering POSPayModesViewModel")}get GridData(){return this.GridDataObj.Table}get angularGrid(){return this.GridDataObj.angularGrid}get POSBalanceAmount(){return null!=this.Parent?this.Parent.POSBalanceAmount:""}get NetAmount(){return null!=this.Parent?this.Parent.NetAmount:""}get SelectedRow(){return this.GridDataObj.SelectedItem}set SelectedRow(e){e!=this._SelectedRow&&(this.GridDataObj.SelectedItem=e,this.Fillvalue())}get GridRowHeight(){return null!=this.Parent?this.Parent.GridRowHeight:25}GridData_RowDeleted(e,t){let s=0,i="2";this.Parent.ScreenObject.Preferences.ContainsKey("DecimalsNetAmount")&&""!=this.Parent.ScreenObject.Preferences.DecimalsNetAmount&&(i=this.Parent.ScreenObject.Preferences.DecimalsNetAmount);for(let a=0;a<this.GridData.length;a++)C.e.IsEmpty(this.GridData[a].ColumnName)||C.e.IsEmpty(this.GridData[a].Amount)||(s+=parseFloat(this.GridData[a].Amount.toString()));this.Return=""!=this.ReturnDecimalPoints?(0).ToString("N"+this.ReturnDecimalPoints):"0",this.Parent.Bal=parseFloat((this.Parent.GridNetTotal+this.Parent.FooterGridNetTotal-s).ToString("N"+i)),this.Parent.Bal<0&&(this.Parent.Bal=0),this.Amount.Text=parseFloat(this.POSBalanceAmount)>0?this.POSBalanceAmount:"",s>parseFloat((this.Parent.GridNetTotal+this.Parent.FooterGridNetTotal).ToString("N"+i))&&(this.Return=""!=this.ReturnDecimalPoints?(this.Parent.GridNetTotal+this.Parent.FooterGridNetTotal-s).ToString("N"+this.ReturnDecimalPoints).Replace("-",""):(this.Parent.GridNetTotal+this.Parent.FooterGridNetTotal-s).toString().Replace("-",""))}OnCurrencyChanged(e){if(this.IsinTextchanged)return;let t="2";if(this.Parent.ScreenObject.Preferences.ContainsKey("DecimalsNetAmount")&&""!=this.Parent.ScreenObject.Preferences.DecimalsNetAmount&&(t=this.Parent.ScreenObject.Preferences.DecimalsNetAmount),"exch"==e.toString()){let e;this.IsinTextchanged=!0,e=C.e.DoubleTryParse(this.Currency.ExchangeRate.Text),C.e.DoubleTryParse(this.Currency.ExchangeRate.Text)||(e=1),this.Amount.Text=(parseFloat(this.FcAmt)*e).ToString("N"+t),this.IsinTextchanged=!1}else if("Curr"==e.toString()){if(null==this.Parent.ScreenObject||null!=this.lastCurr&&null!=this.Currency.Currency.SelectedValue&&this.Currency.Currency.SelectedValue==this.lastCurr)return;let e;this.IsinTextchanged=!0,this.lastCurr=this.Currency.Currency.SelectedValue,this.Currency.ExchangeRate.Text=null!=this.Currency.Currency.SelectedValue&&""!=this.Currency.Currency.SelectedValue?this.Parent.ScreenObject.GetExchangeRate(parseInt(this.Currency.Currency.SelectedValue),this.Parent.DocumentDate).toString():"1",e=C.e.DoubleTryParse(this.Currency.ExchangeRate.Text),C.e.DoubleTryParse(this.Amount.Text)&&(C.e.DoubleTryParse(this.Currency.ExchangeRate.Text)||(e=1),this.FcAmt=(parseFloat(this.Amount.Text)/e).ToString("N"+t)),this.Parent.ScreenObject.Preferences.ContainsKey("ShowDenom")&&Object(b.j)(this.Parent.ScreenObject.Preferences.ShowDenom)&&this.AddDenominations(this.Currency.Currency.SelectedValue),this.IsinTextchanged=!1}else if("FCAmount"==e.toString()){let e;this.IsinTextchanged=!0,e=C.e.DoubleTryParse(this.Currency.ExchangeRate.Text),C.e.DoubleTryParse(this.Currency.ExchangeRate.Text)||(e=1),this.Amount.Text=(parseFloat(this.FcAmt)*e).ToString("N"+t),this.IsinTextchanged=!1}else if("AmtChanged"==e.toString()){let e;this.IsinTextchanged=!0,e=C.e.DoubleTryParse(this.Currency.ExchangeRate.Text),C.e.DoubleTryParse(this.Amount.Text)&&(C.e.DoubleTryParse(this.Currency.ExchangeRate.Text)||(e=1),this.FcAmt=(parseFloat(this.Amount.Text)/e).ToString("N"+t)),this.IsinTextchanged=!1}}OnDenomChange(e){let t=e;if(null!=t){let e;e=C.e.IntTryParse(t.Length),C.e.IntTryParse(t.Length)||(t.Length="0"),this.GetTotal()}}OnAddDenomClick(e){let t=e;if(null!=t){let e;C.e.IntTryParse(t.Length)||0==C.e.IntTryParse(t.Length)?(e=C.e.IntTryParse(t.Length),t.Length=(e+1).toString()):t.Length="0",this.GetTotal()}}GetDenominationXML(){let e="";for(let t=0;t<this.DenomButtons.length;t++){let s,i;C.e.DoubleTryParse(this.DenomButtons[t].Label)&&C.e.DoubleTryParse(this.DenomButtons[t].Length)&&s>0&&i>0&&(i=C.e.DoubleTryParse(this.DenomButtons[t].Label),s=C.e.DoubleTryParse(this.DenomButtons[t].Length),e+='<XML IsDenom="1" ',e+=this.IsCashFC?' CurrencyID="'+this.Currency.Currency.SelectedValue+'"':' CurrencyID="1"',e+=' Notes="'+this.DenomButtons[t].Label+'"  NotesTender="',e+=this.DenomButtons[t].Length+'"  Change="0" ChangeTender="0" />')}return e.toString()}AddDenominations(e){this.DenomButtons.Clear();let t=this.Parent.ScreenObject.GetDenominations(e);for(let s=0;s<t.Tables[0].length;s++){let e=new S.a;e.Label=t.Tables[0][s].Notes.toString(),e.Length="0",e.ToolTipFooterDescription=C.e.GetPath(t.Tables[0][s].GUID.toString()+"."+t.Tables[0][s].FileExtension.toString()),e.Width="165",e.DBColumnID=14+s,e.SectionID="114",this.DenomButtons.push(e)}}GetTotal(){let e=0;for(let s=0;s<this.DenomButtons.length;s++){let t,i;C.e.DoubleTryParse(this.DenomButtons[s].Label)&&C.e.DoubleTryParse(this.DenomButtons[s].Length)&&(i=C.e.DoubleTryParse(this.DenomButtons[s].Label),t=C.e.DoubleTryParse(this.DenomButtons[s].Length),e+=t*i)}let t="2";this.Parent.ScreenObject.Preferences.ContainsKey("DecimalsNetAmount")&&""!=this.Parent.ScreenObject.Preferences.DecimalsNetAmount&&(t=this.Parent.ScreenObject.Preferences.DecimalsNetAmount),this.IsCashFC?this.FcAmt=e.ToString("N"+t):this.Amount.Text=e.ToString("N"+t)}OnSubDenomClick(e){let t=e;if(null!=t){let e;C.e.IntTryParse(t.Length)||0==C.e.IntTryParse(t.Length)?(e=C.e.IntTryParse(t.Length),t.Length=e-1<0?"0":(e-1).toString()):t.Length="0",this.GetTotal()}}onClick_1(e){this.onClick(e.toString(),!1)}onClick(e,t){if(this.Selectedbtn=this.PayModes.find(t=>t.DBColumnName==e),t||null==this.SelectedRow||(this.SelectedRow=null),this.Amount.Text=parseFloat(this.POSBalanceAmount)>0?this.POSBalanceAmount:"",this.CardName.Text="",this.ExpDate.Date=null,this.CardNo.Text="",this.denominationxml="",this.NOdeid=0,null!=this.Denom&&this.Denom.GrdDenomination.Table.Clear(),this.ApprovalCode.Text="",this.ExpiryYear.SelectedValue="",this.ExpiryMonth.SelectedValue="",this.AvailAmount.Text="",this.AvailAmount.Visible=!1,this.VoucherNo.Visible=!1,this.BankName.Visible=!1,this.CardType.Visible=!1,this.Amount.Enable=!0,this.IsCash=!1,this.IsCashFC=!1,null!=this.Selectedbtn)switch(this.PayModes.forEach(e=>{e.Enable=e==this.Selectedbtn}),this.Selectedbtn.SectionID){case"8":case"5":case"11":this.ExpDate.Visible=!1,this.CardNo.Visible=!1,this.CardName.Visible=!1,this.ApprovalCode.Visible=!1,"5"==this.Selectedbtn.SectionID?(this.Parent.ScreenObject.Preferences.ContainsKey("ShowDenom")&&Object(b.j)(this.Parent.ScreenObject.Preferences.ShowDenom)&&(this.IsCash=!0,this.Parent.ScreenObject.Preferences.ContainsKey("MandatoryDenom")&&Object(b.j)(this.Parent.ScreenObject.Preferences.MandatoryDenom)&&(this.Amount.Enable=!1)),this.Parent.ScreenObject.Preferences.ContainsKey("CashForeignCurrency")&&Object(b.j)(this.Parent.ScreenObject.Preferences.CashForeignCurrency)&&(this.IsCashFC=!0),t||this.IsCashFC&&(this.IsinTextchanged=!0,this.Currency.Currency.SelectedValue="1",this.lastCurr!=this.Currency.Currency.SelectedValue&&this.AddDenominations(this.Currency.Currency.SelectedValue),this.lastCurr=this.Currency.Currency.SelectedValue,this.Currency.ExchangeRate.Text="1",this.FcAmt=this.Amount.Text,this.IsinTextchanged=!1)):"8"!=this.Selectedbtn.SectionID||t||(this.Denom=new D.AddDenominationViewModel(this)),this.ExpiryMonth.Visible=!1,this.ExpiryYear.Visible=!1;break;case"6":this.ExpDate.Visible=!1,this.ExpiryMonth.Visible=!0,this.ExpiryYear.Visible=!0,this.CardNo.Visible=!0,this.CardName.Visible=!0,this.ApprovalCode.Visible=!0,this.ExpDate.Label="Expiry",this.ExpiryMonth.Label="Expiry",this.CardNo.Label="Card No.",this.CardName.Label="Card Holder Name",this.BankName.Enable&&(this.BankName.Visible=!0),this.CardType.Enable&&(this.CardType.Visible=!0);break;case"7":this.ExpDate.Visible=!0,this.ExpiryMonth.Visible=!1,this.ExpiryYear.Visible=!1,this.ApprovalCode.Visible=!1,this.CardNo.Visible=!0,this.CardName.Visible=!0,this.ExpDate.Label="Cheque Date",this.CardNo.Label="Cheque No.",this.CardName.Label="Cheque Bank Name";break;case"9":this.ExpDate.Visible=!1,38==this.Parent.ScreenObject.DocumentType?(this.VoucherNo.Visible=!0,this.AvailAmount.Visible=!0,this.AvailAmount.Label="Available Amount"):(this.VoucherNo.Visible=!1,this.AvailAmount.Visible=!1),this.CardNo.Visible=!1,this.CardName.Visible=!1,this.ApprovalCode.Visible=!1,this.ExpiryMonth.Visible=!1,this.ExpiryYear.Visible=!1;break;case"10":this.ExpDate.Visible=!1,this.CardNo.Visible=!0,this.CardName.Visible=!1,this.ApprovalCode.Visible=!1,this.ExpiryMonth.Visible=!1,this.ExpiryYear.Visible=!1,this.CardNo.Label="Card No.";break;case"13":this.ExpDate.Visible=!1,this.AvailAmount.Visible=!0,this.AvailAmount.Label="Available Points",this.AvailAmount.Text=this.AvailablePoints.toString(),this.VoucherNo.Visible=!1,this.CardNo.Visible=!1,this.CardName.Visible=!1,this.ApprovalCode.Visible=!1,this.ExpiryMonth.Visible=!1,this.ExpiryYear.Visible=!1}}clear(){this.Amount.Text="",this.CardName.Text="",this.ExpDate.Date=null,this.CardNo.Text="",this.VoucherNo.Text="",this.ApprovalCode.Text="",this.denominationxml="",this.BankName.Enable&&(this.BankName.SelectedValue=0),this.CardType.Enable&&(this.CardType.SelectedValue=0),this.Return=""!=this.ReturnDecimalPoints?(0).ToString("N"+this.ReturnDecimalPoints):"0",this.NOdeid=0,null!=this.Denom&&this.Denom.GrdDenomination.Table.Clear(),this.ExpiryYear.SelectedValue="",this.ExpiryMonth.SelectedValue="",this.GridData.Clear();for(let e=0;e<5;e++)this.GridData.push({})}InitGrid(){this.GridDataObj=new a.a,this.GridDataObj.Table=[],this.GridDataObj.CanUserDeleteRows=!0,this.GridDataObj.RowDeleted.Subscribe(this,"GridData_RowDeleted"),this.GridDataObj.TableColumns.push("Name"),this.GridDataObj.TableColumns.push("ColumnName"),this.GridDataObj.TableColumns.push("Amount"),this.GridDataObj.DataTypes.Double.push("Amount"),this.GridDataObj.TableColumns.push("Description"),this.GridDataObj.TableColumns.push("Details"),this.GridDataObj.TableColumns.push("Denomination"),this.GridDataObj.TableColumns.push("Type"),this.ColumnSource=[];let e=new r.a;e.Header="Mode",e.DisplayMember="Name",e.Width=150,e.ReadOnly=!0,this.ColumnSource.push(e),e=new r.a,e.Header="Amount",e.DisplayMember="Amount",e.DataType="FLOAT",e.Width=120,e.ReadOnly=!0,this.ColumnSource.push(e),e=new r.a,e.Header="Description",e.DisplayMember="Description",e.Width=450,e.ReadOnly=!0,this.ColumnSource.push(e),this.GridDataObj.Columns=this.ColumnSource,this.clear(),this.Width="760"}OnBeginedit(e){return Object(i.b)(this,void 0,void 0,(function*(){const{ShowJVViewModel:t}=yield Promise.all([s.e(13),s.e(15),s.e(160)]).then(s.bind(null,"Z9XZ")),{ShowJVComponent:i}=yield Promise.resolve().then(s.bind(null,"HNy5"));let a,n=e.args.item,r=e.args.column.DgCol,o=C.e.IsEmpty(r.ValueBinding)?r.DisplayMember:r.ValueBinding;"PactTextBoxEditor"==e.args.column.className&&"Description"==o&&"1"==n.Type.toString()&&(a=new t),a.ShowJVViewModel_1(this.Parent,e.Row.Item.Row.ColumnName.toString(),2),m.a.page.ShowDialog(a,i,{ShowCenter:!0}),e.Cancel=!0}))}oncelleditend(e){let t;t=e.column.field,"DataGridComboBoxColumn"!=e.column.className&&("Amount"!=t&&"CalcAmount"!=t||this.calculate())}calculate(){this.GridDataObj.refreshDataView()}exists(e){for(let t=0;t<this.GridData.length;t++)if(this.GridData[t].Name.toString()==e)return t;return-1}OnButtonClick(e){if(null!=e&&"Cancel"==e.toString());else if(null!=e&&"AmtChanged"==e.toString())this.IsCashFC&&this.OnCurrencyChanged(e);else if(null!=e&&"Denomination"==e.toString())this.Denom=new D.AddDenominationViewModel(this);else if(null!=e&&"OK"==e.toString()){if(null!=this.Selectedbtn&&!C.e.IsEmpty(this.Amount.Text)){if(this.DisplayMessage="",this.DisplayMessage=this.Amount.ValidateData(),""!=this.DisplayMessage)return void(this.MessageVisibility=!0);if(this.Selectedbtn.Mandatory){if(this.CardNo.Visible&&""==this.CardNo.Text)return this.DisplayMessage=this.CardNo.Label+" is Mandatory",void(this.MessageVisibility=!0);if(this.CardName.Visible&&""==this.CardName.Text)return this.DisplayMessage=this.CardName.Label+" is Mandatory",void(this.MessageVisibility=!0);if(this.ExpDate.Visible&&!this.ExpDate.Date)return this.DisplayMessage=this.ExpDate.Label+" is Mandatory",void(this.MessageVisibility=!0);if(this.ExpiryMonth.Visible&&C.e.IsEmpty(this.ExpiryMonth.SelectedValue))return this.DisplayMessage=this.ExpiryMonth.Label+" Month is Mandatory",void(this.MessageVisibility=!0);if(this.ExpiryYear.Visible&&C.e.IsEmpty(this.ExpiryYear.SelectedValue))return this.DisplayMessage=this.ExpiryMonth.Label+" Year is Mandatory",void(this.MessageVisibility=!0);if(this.ApprovalCode.Visible&&""==this.ApprovalCode.Text)return this.DisplayMessage=this.ApprovalCode.Label+" is Mandatory",void(this.MessageVisibility=!0)}if("9"==this.Selectedbtn.SectionID&&38==this.Parent.ScreenObject.DocumentType){if(!(this.NOdeid>0))return this.DisplayMessage="Enter Valid Voucher No",void(this.MessageVisibility=!0);if(!C.e.DoubleTryParse(this.AvailAmount.Text)||parseFloat(this.Amount.Text)>parseFloat(this.AvailAmount.Text))return this.DisplayMessage="Amount should be less than available",void(this.MessageVisibility=!0)}let e=0,t=null;if(null!=this.SelectedRow&&"1"!=this.SelectedRow.Type.toString()?""!=this.Amount.Text&&C.e.DoubleTryParse(this.Amount.Text)&&0==parseFloat(this.Amount.Text)?this.GridData.Remove(this.SelectedRow):t=this.SelectedRow:t=this.GridData[this.Parent.GetEmptyRowPosition(this.GridDataObj,"ColumnName")],"13"==this.Selectedbtn.SectionID&&38==this.Parent.ScreenObject.DocumentType){if(!C.e.DoubleTryParse(this.AvailAmount.Text)||parseFloat(this.Amount.Text)>parseFloat(this.AvailAmount.Text))return this.DisplayMessage="Amount should be less than available points",void(this.MessageVisibility=!0);for(let e=0;e<this.GridData.length;e++)if(this.GridData[e]!=t&&this.GridData[e].Type.toString()==this.Selectedbtn.SectionID)return this.DisplayMessage="Edit row no."+(e+1).toString()+" to redeem points.",void(this.MessageVisibility=!0)}e=0;for(let i=0;i<this.GridData.length;i++)this.GridData[i]==t||C.e.IsEmpty(this.GridData[i].ColumnName)||C.e.IsEmpty(this.GridData[i].Amount)||(e+=parseFloat(this.GridData[i].Amount.toString()));let s="2";if(this.Parent.ScreenObject.Preferences.ContainsKey("DecimalsNetAmount")&&""!=this.Parent.ScreenObject.Preferences.DecimalsNetAmount&&(s=this.Parent.ScreenObject.Preferences.DecimalsNetAmount),parseFloat((e+parseFloat(this.Amount.Text)).ToString("N"+s))>parseFloat((this.Parent.GridNetTotal+this.Parent.FooterGridNetTotal).ToString("N"+s))){if("5"!=this.Selectedbtn.SectionID||38!=this.Parent.ScreenObject.DocumentType)return this.DisplayMessage="Can not pay more than balance",void(this.MessageVisibility=!0);for(let e=0;e<this.GridData.length;e++)if(this.GridData[e]!=t&&this.GridData[e].Type.toString()==this.Selectedbtn.SectionID)return this.DisplayMessage="Edit row no."+(e+1).toString()+" to pay cash.",void(this.MessageVisibility=!0);if(""==this.Returnfld)return this.DisplayMessage="Define Cash Return Field to pay more than balance",void(this.MessageVisibility=!0);this.Return=""!=this.ReturnDecimalPoints?(this.Parent.GridNetTotal+this.Parent.FooterGridNetTotal-e-parseFloat(this.Amount.Text)).ToString("N"+this.ReturnDecimalPoints).Replace("-",""):(this.Parent.GridNetTotal+this.Parent.FooterGridNetTotal-e-parseFloat(this.Amount.Text)).toString().Replace("-","")}else"5"==this.Selectedbtn.SectionID&&38==this.Parent.ScreenObject.DocumentType&&C.e.DoubleTryParse(this.Return)&&parseFloat(this.Return)>0&&(this.Return=""!=this.ReturnDecimalPoints?(0).ToString("N"+this.ReturnDecimalPoints):"0");if(this.Parent.Bal=parseFloat((this.Parent.GridNetTotal+this.Parent.FooterGridNetTotal-e-parseFloat(this.Amount.Text)).ToString("N"+s)),this.Parent.Bal<0&&(this.Parent.Bal=0),null!=t){t.Name=this.Selectedbtn.Label,t.Amount=this.Amount.Text,t.ColumnName=this.Selectedbtn.DBColumnName,t.Type=this.Selectedbtn.SectionID;let e="";if(e+='<XML Amount="'+this.Amount.Text.Replace(",","")+'" ',e+=' DBColumnName="'+this.Selectedbtn.DBColumnName+'" ',e+=' RegisterID="'+this.Parent.ScreenObject.RegisterNodeID+'" ',e+=' ShiftID="'+this.Parent.ScreenObject.ShiftNodeID+'" ',e+=' DocDate="'+this.Parent.DocumentDate.ToString("dd/MMM/yyyy")+'" ',e+=' Type="'+this.Selectedbtn.SectionID+'" ',this.IsCashFC&&!C.e.IsEmpty(this.Currency.Currency.SelectedValue)&&(e+=' Currency="'+this.Currency.Currency.SelectedValue+'" ',e+=' ExchangeRate="'+this.Currency.ExchangeRate.Text+'" ',e+=' FCAmt="'+this.FcAmt.Replace(",","")+'" ',t.Description=this.FcAmt+" "+this.Currency.Currency.GetText()+"@"+this.Currency.ExchangeRate.Text),"5"==this.Selectedbtn.SectionID)t.Denomination=this.GetDenominationXML();else if("8"==this.Selectedbtn.SectionID)t.Denomination=this.Denom.GetXML();else if("6"==this.Selectedbtn.SectionID||"7"==this.Selectedbtn.SectionID)t.Description=this.CardNo.Text,e+=' CardNo="'+h.d.GetValidXml(this.CardNo.Text)+'" ',e+=' CardName="'+h.d.GetValidXml(this.CardName.Text)+'" ',"6"==this.Selectedbtn.SectionID?(C.e.IsEmpty(this.ExpiryYear.SelectedValue)||C.e.IsEmpty(this.ExpiryMonth.SelectedValue)||(e+=' ExpDate="'+new Date("1/"+this.ExpiryMonth.GetText()+"/"+this.ExpiryYear.SelectedValue).ToString("dd/MMM/yyyy")+'" '),e+=' ApprovalCode="'+h.d.GetValidXml(this.ApprovalCode.Text)+'" ',this.CardType.Enable&&this.CardType.Visible&&this.CardType.SelectedValue>0&&(e+=' CardType="'+this.CardType.SelectedValue+'" '),this.BankName.Enable&&this.BankName.Visible&&this.BankName.SelectedValue>0&&(e+=' BankName="'+this.BankName.SelectedValue+'" ')):this.ExpDate.Date&&(e+=' ExpDate="'+this.ExpDate.Date.ToString("dd/MMM/yyyy")+'" ');else if("9"==this.Selectedbtn.SectionID&&38==this.Parent.ScreenObject.DocumentType){if(!(this.NOdeid>0))return this.DisplayMessage="Enter Valid Voucher No",void(this.MessageVisibility=!0);if(!C.e.DoubleTryParse(this.AvailAmount.Text)||parseFloat(this.Amount.Text)>parseFloat(this.AvailAmount.Text))return this.DisplayMessage="Amount should be less than available",void(this.MessageVisibility=!0);t.Description=this.VoucherNo.Text,e+=' CardNo="'+this.VoucherNo.Text+'" ',e+=' VoucherNodeID="'+this.NOdeid+'" '}else"10"==this.Selectedbtn.SectionID&&(t.Description=this.CardNo.Text,e+=' CardNo="'+h.d.GetValidXml(this.CardNo.Text)+'" ');e+=" />",t.Details=e.toString(),this.GridDataObj.updateRow(t)}for(let i=0;i<this.DenomButtons.length;i++)this.DenomButtons[i].Length="0";this.Amount.Text=parseFloat(this.POSBalanceAmount)>0?this.POSBalanceAmount:"",this.CardName.Text="",this.ExpDate.Date=null,this.CardNo.Text="",this.denominationxml="",this.VoucherNo.Text="",this.AvailAmount.Text="",this.IsCashFC&&(this.IsinTextchanged=!0,this.Currency.Currency.SelectedValue="1",this.lastCurr!=this.Currency.Currency.SelectedValue&&this.AddDenominations(this.Currency.Currency.SelectedValue),this.lastCurr=this.Currency.Currency.SelectedValue,this.Currency.ExchangeRate.Text="1",this.FcAmt=this.Amount.Text,this.IsinTextchanged=!1),this.NOdeid=0,null!=this.Denom&&null!=this.Denom.GrdDenomination&&null!=this.Denom.GrdDenomination.Table&&this.Denom.GrdDenomination.Table.length>0&&this.Denom.GrdDenomination.Table.forEach(e=>{this.Denom.GrdDenomination.TableColumns.Contains("Notestender")&&(e.Notestender=null),this.Denom.GrdDenomination.TableColumns.Contains("ChangeTender")&&(e.ChangeTender=null)}),this.ApprovalCode.Text="",this.ExpiryYear.SelectedValue="",this.ExpiryMonth.SelectedValue=""}}else if(null==e||"CheckoutSave"!=e.toString()&&"CheckoutPrint"!=e.toString())if(null!=e&&"CheckoutPrint"==e.toString()){if(this.Parent.ScreenObject.Preferences.ContainsKey("DecimalsNetAmount")&&""!=this.Parent.ScreenObject.Preferences.DecimalsNetAmount){if(0!=parseFloat(this.Parent.Bal.ToString("N"+this.Parent.ScreenObject.Preferences.DecimalsNetAmount)))return this.DisplayMessage="Pay Balance to check out",void(this.MessageVisibility=!0)}else if(0!=this.Parent.Bal)return this.DisplayMessage="Pay Balance to check out",void(this.MessageVisibility=!0);m.a.page.HideDialog(),this.Parent.SaveInventoryDocument("CheckoutPrint")}else null!=e&&"Close"==e.toString()&&(m.a.page.HideDialog(),this.Parent.IsPOs&&null!=this.Parent.SKU&&this.Parent.SKU.Visible&&this.Parent.SKU.IsTabStop&&(this.Parent.SKU.SetFocus=!0));else{if(!this.Parent.ScreenObject.Preferences.ContainsKey("UseAsOrder")||"True"!=this.Parent.ScreenObject.Preferences.UseAsOrder){if(this.Parent.ScreenObject.Preferences.ContainsKey("DecimalsNetAmount")&&""!=this.Parent.ScreenObject.Preferences.DecimalsNetAmount){if(0!=parseFloat(this.Parent.Bal.ToString("N"+this.Parent.ScreenObject.Preferences.DecimalsNetAmount)))return this.DisplayMessage="Pay Balance to check out",void(this.MessageVisibility=!0)}else if(0!=this.Parent.Bal)return this.DisplayMessage="Pay Balance to check out",void(this.MessageVisibility=!0);let e=0,t=0;if(e=C.e.DoubleTryParse(this.Return),!C.e.StringIsNullOrEmpty(this.Return)&&e>0){e=0;for(let s=0;s<this.GridData.length;s++)"5"==this.GridData[s].Type.toString()&&""!=this.GridData[s].ColumnName.toString()&&""!=this.GridData[s].Amount.toString()?e+=parseInt(this.GridData[s].Amount.toString()):"5"!=this.GridData[s].Type.toString()&&""!=this.GridData[s].ColumnName.toString()&&""!=this.GridData[s].Amount.toString()&&(t+=parseInt(this.GridData[s].Amount.toString()));if(t>0&&parseInt(this.Return)>e)return this.DisplayMessage="Return cannot be more than cash",void(this.MessageVisibility=!0)}}m.a.page.HideDialog(),this.Parent.SaveInventoryDocument_1(e.toString())}}OnVoucherNoChanged(e){null!=this.VoucherNo&&e instanceof KeyboardEvent&&e.keyCode==b.g.ENTER&&this.GetVoucher()}GetVoucher(){let e=0;if(this.NOdeid=0,this.AvailAmount.Text="",!C.e.IsEmpty(this.VoucherNo.Text)&&m.a.SessionManager.Preferences.ContainsKey("PosCoupons")&&C.e.IntTryParse(m.a.SessionManager.Preferences.PosCoupons)&&parseInt(m.a.SessionManager.Preferences.PosCoupons)>5e4){e=parseInt(m.a.SessionManager.Preferences.PosCoupons);let t=this.Parent.ScreenObject.GetPosVoucherDetails(this.VoucherNo.Text,e,this.NOdeid);this.NOdeid>0?(null!=t&&t.Tables.length>0&&t.Columns[0].Contains("BAL")&&t.Tables[0].length>0&&C.e.DoubleTryParse(t.Tables[0][0].BAL.toString())&&(this.AvailAmount.Text=t.Tables[0][0].bal.toString()),this.MessageVisibility=!1):(this.NOdeid=0,null!=t&&t.Tables.length>0&&t.Tables[t.Tables.length-1].length>0&&t.Columns[t.Columns.length-1].Contains("ErrorMessage")&&(this.DisplayMessage=t.Tables[t.Tables.length-1][0].ErrorMessage.toString()),this.MessageVisibility=!0)}}FillDenomination(){let e=new C.f;e.LoadXml("<PosPayModes>"+this.denominationxml+"</PosPayModes>");let t=e.SelectNodes("PosPayModes/XML");this.DenomButtons.forEach(e=>{e.Length="0"}),t.forEach(e=>{if(null!=e.attributes.Notes&&""!=e.attributes.Notes.value&&0!=parseInt(e.attributes.Notes.value)&&null!=e.attributes.NotesTender&&""!=e.attributes.NotesTender.value&&parseInt(e.attributes.NotesTender.value)>0){var t=this.DenomButtons.filter(t=>t.Label==e.attributes.Notes.value);null!=t&&(t[0].Length=e.attributes.NotesTender.value)}})}Fillvalue(){if(null!=this.SelectedRow&&!C.e.IsEmpty(this.SelectedRow.Details.toString())){let e=new C.f;e.LoadXml(this.SelectedRow.Details.toString());let t=e.SelectSingleNode("XML");null!=t&&null!=t.attributes.DBColumnName&&""!=t.attributes.DBColumnName.value&&(this.onClick(t.attributes.DBColumnName.value,!0),null!=this.Selectedbtn&&(this.denominationxml=this.SelectedRow.Denomination.toString(),"8"==this.Selectedbtn.SectionID?this.Denom=new D.AddDenominationViewModel(this):"5"==this.Selectedbtn.SectionID&&this.FillDenomination(),null!=t.attributes.Amount&&""!=t.attributes.Amount.value&&(this.Amount.Text=t.attributes.Amount.value),null!=t.attributes.CardNo&&""!=t.attributes.CardNo.value&&(null!=this.Selectedbtn&&"9"==this.Selectedbtn.SectionID?this.VoucherNo.Text=t.attributes.CardNo.value:this.CardNo.Text=t.attributes.CardNo.value),null!=t.attributes.CardName&&""!=t.attributes.CardName.value&&(this.CardName.Text=t.attributes.CardName.value),null!=t.attributes.ApprovalCode&&""!=t.attributes.ApprovalCode.value&&(this.ApprovalCode.Text=t.attributes.ApprovalCode.value),null!=t.attributes.CardType&&""!=t.attributes.CardType.value&&(this.CardType.SelectedValue=parseInt(t.attributes.CardType.value)),null!=t.attributes.BankName&&""!=t.attributes.BankName.value&&(this.BankName.SelectedValue=parseInt(t.attributes.BankName.value)),null!=t.attributes.VoucherNodeID&&""!=t.attributes.VoucherNodeID.Value&&(this.NOdeid=parseInt(t.attributes.VoucherNodeID.value)),null!=t.attributes.ExpDate&&""!=t.attributes.ExpDate.value&&"7"==this.Selectedbtn.SectionID&&(this.ExpDate.Date=new Date(t.attributes.ExpDate.value)),this.IsCashFC&&(this.IsinTextchanged=!0,this.FcAmt=null!=t.attributes.FCAmt&&""!=t.attributes.FCAmt.value?t.attributes.FCAmt.value:this.Amount.Text,this.Currency.ExchangeRate.Text=null!=t.attributes.ExchangeRate&&""!=t.attributes.ExchangeRate.value?t.attributes.ExchangeRate.value:"1",this.Currency.Currency.SelectedValue=null!=t.attributes.Currency&&""!=t.attributes.Currency.value?t.attributes.Currency.value:"1",this.lastCurr!=this.Currency.Currency.SelectedValue&&this.AddDenominations(this.Currency.Currency.SelectedValue),this.lastCurr=this.Currency.Currency.SelectedValue,this.IsinTextchanged=!1)))}}OnCardKeyDown(e){if(e instanceof KeyboardEvent&&e.keyCode==b.g.ENTER){let e,s=this.CardNo.Text,i=s.indexOf("%B");if(s.length>0&&i>=0&&"?"==s[s.length-1]&&(i+=2,e=s.indexOf("^",i),e>0)){if(this.CardNo.Text=s.substr(i,e-i),i=e+1,e=s.indexOf("^",i),e>0){let t=s.substr(i,e-i).split("/");this.CardName.Text=t[0].Trim(),t.length>1&&(this.CardName.Text+=" "+t[1].Trim())}if(i=e+1,i+4<s.length)try{this.ExpiryMonth.SelectedValue=parseInt(s.substr(i+2,2)).toString(),this.ExpiryYear.SelectedValue="20"+parseInt(s.substr(i,2)).ToString("00")}catch(t){}}}}}},JoYt:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var i=s("3Pt+"),a=s("fXoL");let n=(()=>{class e{constructor(){this.form=new i.j({})}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=a.Nb({type:e,selectors:[["app-register"]],inputs:{obj:"obj"},decls:24,vars:8,consts:[[1,"master-screen",2,"padding-bottom","4px","width","400px"],[1,"PACTHeaderFields","dialogSubBody"],[1,"documentgrid","row","form-row",2,"width","100%"],[2,"width","100%",3,"obj","group"],[1,"Pactdailogfooter"],[1,"primary-btn-wicon",3,"click"],[1,"secondary-btn-wicon",3,"click"]],template:function(e,t){1&e&&(a.Zb(0,"div",0),a.Wc(1,"\n    "),a.Zb(2,"div",1),a.Wc(3,"\n        \n      "),a.Zb(4,"div",2),a.Wc(5,"\n        "),a.Ub(6,"app-PactGridView",3),a.Wc(7,"  \n      "),a.Yb(),a.Wc(8,"\n      \n    "),a.Yb(),a.Wc(9,"\n    "),a.Zb(10,"div",4),a.Wc(11,"\n      "),a.Zb(12,"div"),a.Wc(13,"\n        "),a.Zb(14,"button",5),a.hc("click",(function(){return t.obj.onSave("OK")})),a.Wc(15),a.mc(16,"translate"),a.Yb(),a.Wc(17,"\n        "),a.Zb(18,"button",6),a.hc("click",(function(){return t.obj.onSave("Cancel")})),a.Wc(19),a.mc(20,"translate"),a.Yb(),a.Wc(21,"\n      "),a.Yb(),a.Wc(22,"\n  "),a.Yb(),a.Wc(23,"\n"),a.Yb()),2&e&&(a.Db(6),a.tc("obj",t.obj.SelectedRegisterObj)("group",t.form),a.Db(9),a.Xc(a.nc(16,4,"Ok")),a.Db(4),a.Xc(a.nc(20,6,"Close")))},encapsulation:2}),e})()},d36O:function(e,t,s){"use strict";s.r(t),s.d(t,"DocumentFlowChartViewModel",(function(){return u}));var i=s("Do2H"),a=s("Lp6j"),n=s("ScVY"),r=s("vTM8"),o=s("0/4Q"),l=s("PDNK"),c=s("EQd/"),h=s("CUWK");class u extends n.b{constructor(e,t,s=0,n=!0){super(),this.dtDocs=null,this.dtDocsDetail=null,this.RootNodes=[],this.lstDocNodes=new r.a,this.DocsFlowData=[],this.DocsArrowData=[],this.DocsArrowDataTemp=[],this.lstRibbonDocs=new r.c,this._DocNumber="",this.VoucherNoObj=new c.d,this.IsInv=!0,this.IsDialog=!1,this.Width=null,this.Height=null,this.MaxNodeHeight=0,this.arrLevelMax=[],this.ActualNodeHeight=80,this.NodePaddingTop=30,this.NodePaddingLeft=60,this.ActualNodeWidth=140,this.IsLinkFlowCall=!1,this.HideValue=!1,this.HideQty=!1,this.HideDocDate=!1,this.Width="800",this.Height="600",this.VoucherNoObj.SetFocus=!0,this.VoucherNoObj.Label=i.a.GetResource("DFCVoucherNo"),this.ShowData=new l.b,this.ShowData.GroupName="ShowData",this.ShowData.Items.push(new l.a("Summary",0,"ShowData")),this.ShowData.Items.push(new l.a("Detail",1,"ShowData")),this.ShowData.Items[0].Label=i.a.GetResource("DFCSummary"),this.ShowData.Items[0].Group=this.ShowData,this.ShowData.Items[1].Group=this.ShowData,this.ShowData.Items[1].Label=i.a.GetResource("DFCDetail"),i.a.SessionManager.PersonalSettings.ContainsKey("DocumentFlowShowData")&&"1"==i.a.SessionManager.PersonalSettings.DocumentFlowShowData?this.ShowData.Items[1].IsChecked=!0:this.ShowData.Items[0].IsChecked=!0,this.ShowData.Items[0].CheckedChangedCommand.Subscribe(this,"OnNameCheckedChanged"),this.ShowData.Items[1].CheckedChangedCommand.Subscribe(this,"OnNameCheckedChanged"),this.HideValue=i.a.SessionManager.IsActionAssigned(131,"Hide Value"),this.HideQty=i.a.SessionManager.IsActionAssigned(131,"Hide Qty"),this.HideDocDate=i.a.SessionManager.IsActionAssigned(131,"Hide DocDate"),this.Title="Link Map",this.IsDialog=e,this.VoucherNo=t,this.IsInv=n,this.DocumentType=new o.e(0),this.DocumentType.Label=i.a.GetResource("Document Type"),this.DocPrefix=new o.e(0),this.DocPrefix.Label=i.a.GetResource("DocPrefix"),this.DocumentType.SelectionChangedCommand.Subscribe(this,"OnDocumentChange"),this.DocPrefix.SelectionChangedCommand.Subscribe(this,"OnDocPrefix");let h=i.a.report.GetReportData(3,parseInt(i.a.SessionManager.UserID),null);this.DocumentType.Items.push(o.d.ComboBoxItems_2("","0")),null!=h&&(h.Tables[0].forEach(e=>{this.DocumentType.Items.push(o.d.ComboBoxItems_3(e[h.Columns[0][1]].toString(),e[h.Columns[0][0]].toString(),e.DocumentAbbr.toString()))}),s>0&&(this.DocumentType.SelectedValue=s.toString())),a.e.IsEmpty(t)||this.ConstructTree()}get DocNumber(){return this._DocNumber}set DocNumber(e){e!=this._DocNumber&&(this._DocNumber=e,this.UpdateVoucherNo())}get VoucherNo(){return this.VoucherNoObj.Text}set VoucherNo(e){this.VoucherNoObj.Text=e}get NodeHeight(){return this.ActualNodeHeight+this.NodePaddingTop}get NodeWidth(){return this.ActualNodeWidth+this.NodePaddingLeft}OnNameCheckedChanged(e){a.e.SetPersonalize("DocumentFlowShowData",this.ShowData.Items[1].IsChecked?"1":"0"),this.OnButtonClick("Submit")}OnDocumentChange(e){!a.e.IsEmpty(this.DocumentType.SelectedValue)&&parseInt(this.DocumentType.SelectedValue)>0&&(this.DocPrefix.Items.Clear(),i.a.common.GetDataSet("DOC048",this.DocumentType.SelectedValue).Tables[0].forEach(e=>{this.DocPrefix.Items.push(o.d.ComboBoxItems_3(e.CodePrefix.toString(),e.CodePrefix.toString(),e.CurrentCodeNumber.toString()))}),this.DocNumber=""),this.UpdateVoucherNo()}OnDocPrefix(e){this.DocNumber=null==this.DocPrefix.SelectedItem||a.e.IsEmpty(this.DocPrefix.SelectedItem.Parent)?"":this.DocPrefix.SelectedItem.Parent,this.UpdateVoucherNo()}UpdateVoucherNo(){let e="";!a.e.IsEmpty(this.DocumentType.SelectedValue)&&parseInt(this.DocumentType.SelectedValue)>0&&(e=this.DocumentType.SelectedItem.Parent+"-",a.e.IsEmpty(this.DocPrefix.SelectedValue)||(e+=this.DocPrefix.SelectedValue),a.e.IsEmpty(this.DocNumber)||(e+=this.DocNumber)),this.VoucherNo=e}OnButtonClick(e){if(this.DisplayMessage="","Submit"==e){if(a.e.IsEmpty(this.VoucherNo))return void(this.DisplayMessage="Enter Voucher No");this.ActualNodeWidth=140,this.ConstructTree()}else if("LinkFlow"==e){if(null==this.DocumentType.SelectedValue)return void(this.DisplayMessage="Select Document Type");this.ConstructTree(!0)}else"Close"==e&&i.a.page.HideDialog()}OnDocumentClick(e){if(this.DisplayMessage="",!a.e.IsEmpty(e)){i.a.page.ShowLoading=!0;let t=i.a.report.GetDocumentDetailsByVoucherNo(e);if(a.e.Int(t.obj)>0){let e;e=t.Tables[0].length>0?t.Tables[0][0]:t.Tables[1][0],h.RibbonExtViewModel.LoadDocument(e),this.IsDialog&&i.a.page.HideDialog()}else this.DisplayMessage="Document not found";i.a.page.ShowLoading=!1}}OnDocumentDefClick(e){}ConstructTree(e=!1){let t;if(this.DocsArrowData.Clear(),this.DocsArrowDataTemp.Clear(),this.arrLevelMax.Clear(),this.lstDocNodes.Clear(),this.RootNodes.Clear(),this.lstRibbonDocs.Clear(),this.IsLinkFlowCall=e,e)i.a.SessionManager.MenuTabs.forEach(e=>{e.Groups.forEach(e=>{for(let t=0;t<e.Items.length;t++){let s=e.Items[t];s.FeatureID>4e4&&s.FeatureID<5e4&&!this.lstRibbonDocs.keys.Contains(s.FeatureID)&&this.lstRibbonDocs.push(s.FeatureID,s)}})}),this.TempDVNode=new Array,t=i.a.report.GetDocsLinkTree(this.DocumentType.SelectedValue,this.ShowData.Items[0].IsChecked?1:0,this.IsInv);else{let e;this.TempVNode=[],e=this.VoucherNo.startsWith("LINEID:")?this.VoucherNo.split("~"):[this.VoucherNo],t=i.a.report.GetDocsLinkTree(e[0],this.ShowData.Items[0].IsChecked?1:0,this.IsInv),e.length>1&&(this.VoucherNo=e[1]),t.Tables.length>2&&t.Columns[2].Contains("BWDocNo")&&t.Tables[2].forEach(e=>{let s={CostCenterID:0};s.VoucherNo=e.BWDocNo,s.ParentVoucherNo=e.ParentVoucherNo,s.DocDate=e.DocDate,t.Tables[0].push(s)})}if(0==t.Tables.length)return;this.dtDocs=t.Tables[0],this.dtDocsDetail=t.Tables[1];let s=t.Tables[0].filter(e=>null==e.ParentVoucherNo||"-1"==e.ParentVoucherNo||""==e.ParentVoucherNo);var a;this.arrLevelMax.push(0),t.Columns[0].Contains("DocDate"),s.forEach(e=>{let t=this.GetNode(e,0);t&&(this.RootNodes.push(t),this.AddChildren(t))}),this.lstDocNodes.length>0&&(e?(a=this.lstDocNodes.values.find(e=>e.CostCenterID==parseInt(this.DocumentType.SelectedValue)))&&(a.ForeColor="Red"):(a=this.lstDocNodes.values.find(e=>e.DocNo.toString().toLowerCase()==this.VoucherNo.toLowerCase()))&&(a.ForeColor="Red")),this.arrLevelMax[0]=this.RootNodes.length,this.MaxNodeHeight=Math.max(...this.arrLevelMax)*this.NodeHeight,this.RootNodes.forEach(e=>{e.Top=this.MaxNodeHeight/(this.arrLevelMax[0]+1)-this.NodeHeight;let t=this.MaxNodeHeight/this.arrLevelMax[e.Level];e.Top=t*(e.LevelIndex+1)-((t-this.ActualNodeHeight)/2+this.ActualNodeHeight),e.Margin="0,"+e.Top.toString()+",0,0",this.AssignMargin(e)});let n=[];e?this.TempDVNode.forEach(e=>{n.push(e)}):this.TempVNode.forEach(e=>{n.push(e)}),this.DocsFlowData=n;let r=[];r.AddRange(this.DocsArrowData),this.DocsArrowDataTemp.push(r)}GetNode(e,t){if(this.lstDocNodes.ContainsKey(e.VoucherNo.toString()))return null;let s=new D;if(s.DocNo=e.VoucherNo.toString(),s.CostCenterID=parseInt(e.CostCenterID),this.IsLinkFlowCall)s=new S,s.DocNo=e.VoucherNo.toString(),s.CostCenterID=parseInt(e.CostCenterID),this.lstRibbonDocs.keys.Contains(s.CostCenterID)?s.SmallImage=this.lstRibbonDocs[s.CostCenterID].SmallImage:(s.BtnBorderColor="Gray",s.IsEnable=!1);else{s=new D,s.DocNo=e.VoucherNo.toString(),s.CostCenterID=parseInt(e.CostCenterID),this.HideDocDate||null==e.DocDate||(s.DocDate=new Date(e.DocDate).ToString(i.a.SessionManager.Preferences["Date Format"]));let t=this.dtDocsDetail.filter(e=>e.VoucherNo==s.DocNo);t.length>0&&(this.HideQty||null==t[0].Qty||(s.Qty=parseFloat(t[0].Qty).ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty)),this.HideValue||null==t[0].Value||(s.Value=parseFloat(t[0].Value).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount)))}return this.lstDocNodes.push(e.VoucherNo.toString(),s),this.ActualNodeWidth/e.VoucherNo.toString().length<7&&(this.ActualNodeWidth=3+7*e.VoucherNo.toString().length),s.Width=this.ActualNodeWidth,s.Height=this.ActualNodeHeight,s.Level=t,this.arrLevelMax.length<=s.Level&&this.arrLevelMax.push(0),s.LevelIndex=this.arrLevelMax[s.Level],this.arrLevelMax[s.Level]++,this.IsLinkFlowCall?this.TempDVNode.push(s):this.TempVNode.push(s),s}AddChildren(e){this.dtDocs.filter(t=>t.ParentVoucherNo==e.DocNo).forEach(t=>{let s=t.VoucherNo.toString();if(this.lstDocNodes.ContainsKey(s))e.Children.find(e=>e.DocNo==s)||e.Children.push(this.lstDocNodes[s]);else{let s=this.GetNode(t,e.Level+1);null!=s&&(e.Children.push(s),this.AddChildren(s))}})}AssignMargin(e){for(let t=0;t<e.Children.length;t++){let s=e.Children[t];if(!s.IsRead){s.IsRead=!0,s.Left=s.Level*this.NodeWidth;let e=this.MaxNodeHeight/this.arrLevelMax[s.Level];s.Top=e*(s.LevelIndex+1)-((e-this.ActualNodeHeight)/2+this.ActualNodeHeight),s.Margin=s.Left+","+s.Top.toString()+",0,0",this.AssignMargin(s)}if(!this.DocsArrowData.find(t=>t.FromDocNo==e.DocNo&&t.ToDocNo==s.DocNo)){let t=new m;t.FromDocNo=e.DocNo,t.ToDocNo=s.DocNo,t.X1=e.Left,e.Left<s.Left&&(t.X1+=this.ActualNodeWidth),t.Y1=e.Top+this.ActualNodeHeight/2,t.X2=s.Left,s.Left<e.Left&&(t.X2+=this.ActualNodeWidth),t.Y2=s.Top+this.ActualNodeHeight/2,this.IsLinkFlowCall?null!=this.DocumentType.SelectedValue&&e.CostCenterID==parseInt(this.DocumentType.SelectedValue)&&(t.Stroke="Red"):a.e.LowerCase(e.DocNo)!=a.e.LowerCase(this.VoucherNo)&&a.e.LowerCase(s.DocNo)!=a.e.LowerCase(this.VoucherNo)||(t.Stroke="Red"),this.DocsArrowData.push(t)}}}}class d extends n.b{constructor(){super(...arguments),this.CostCenterID=0,this.Level=0,this.Order=0,this.Parent=null,this.Children=[],this.Top=0,this.Left=0,this.LevelIndex=0,this.IsRead=!1,this.Margin="0px 0px 0px 0px",this.ForeColor="Black",this.Width=0,this.Height=0}}class D extends d{get DocDateLbl(){return a.e.IsEmpty(this.DocDate)?"":"DocDate :"}get QtyLbl(){return a.e.IsEmpty(this.Qty)?"":"Qty :"}get ValueLbl(){return a.e.IsEmpty(this.Value)?"":"Value :"}get ToolTip(){return""!=this.QtyLbl?"Doc No: "+this.DocNo+"\r\nQty: "+this.Qty+"\r\nValue: "+this.Value:"Doc No: "+this.DocNo}}class S extends d{constructor(){super(),this.IsEnable=!1,this.IsEnable=!0,this.BtnBorderColor="Orange"}}class m{constructor(){this.X1=0,this.X2=0,this.Y1=0,this.Y2=0,this.Stroke="#000"}}},kBEi:function(e,t,s){"use strict";s.d(t,"a",(function(){return O}));var i=s("fXoL"),a=s("sYmb");function n(e,t){if(1&e&&(i.Xb(0),i.Wc(1,"\n                    "),i.Wc(2,"\n                    "),i.Zb(3,"span",29),i.hc("click",(function(){const e=t.$implicit;return e.ClickCommand.Call(e.DBColumnName)})),i.Wc(4),i.Yb(),i.Wc(5,"\n                  "),i.Wb()),2&e){const e=t.$implicit,s=i.lc();i.Db(3),i.Sc("background-color",s.obj.Selectedbtn==e?"#666666":"#eeeeee"),i.Kb("list_selected",s.obj.Selectedbtn==e),i.uc("title",e.Label),i.Db(1),i.Yc("\n                    ",e.Label,"")}}function r(e,t){if(1&e&&(i.Zb(0,"div",30),i.Wc(1,"\n                    "),i.Vb(2,31),i.Wc(3,"\n                  "),i.Yb()),2&e){const e=i.lc();i.Db(2),i.tc("obj",e.obj.VoucherNo)("group",e.form)}}function o(e,t){if(1&e&&(i.Zb(0,"div",32),i.Wc(1,"\n                    "),i.Vb(2,31),i.Wc(3,"\n                  "),i.Yb()),2&e){const e=i.lc();i.Db(2),i.tc("obj",e.obj.AvailAmount)("group",e.form)}}function l(e,t){if(1&e&&(i.Zb(0,"div",33),i.Wc(1,"\n                    "),i.Vb(2,31),i.Wc(3,"\n                  "),i.Yb()),2&e){const e=i.lc();i.Db(2),i.tc("obj",e.obj.Currency)("group",e.form)}}function c(e,t){if(1&e&&(i.Zb(0,"div",33),i.Wc(1,"\n                    "),i.Vb(2,31),i.Wc(3,"\n                  "),i.Yb()),2&e){const e=i.lc();i.Db(2),i.tc("obj",e.obj.Currency.ExchangeRate)("group",e.form)}}function h(e,t){if(1&e){const e=i.ac();i.Zb(0,"div",33),i.Wc(1,"\n                    "),i.Zb(2,"label",34),i.Wc(3),i.Yb(),i.Wc(4,"\n                    "),i.Zb(5,"input",18),i.hc("keydown",(function(){return i.Ic(e),i.lc().obj.Currency.ExchangeRate.LostFocusCommand.Call("FCAmount")}))("ngModelChange",(function(t){return i.Ic(e),i.lc().obj.FcAmt=t})),i.Yb(),i.Wc(6,"\n                  "),i.Yb()}if(2&e){const e=i.lc();i.Db(3),i.Xc(e.obj.Currency.Label),i.Db(2),i.tc("ngModel",e.obj.FcAmt)}}function u(e,t){if(1&e){const e=i.ac();i.Xb(0),i.Wc(1,"\n                        "),i.Zb(2,"div",36),i.Wc(3,"\n                            "),i.Zb(4,"span",37),i.hc("click",(function(){i.Ic(e);const s=t.$implicit;return i.lc(2).obj.OnSubDenomClick(s)})),i.Wc(5,"\n                                "),i.Ub(6,"i",38),i.Yb(),i.Wc(7,"\n                                "),i.Zb(8,"input",39),i.hc("keydown",(function(){i.Ic(e);const s=t.$implicit;return i.lc(2).obj.OnDenomChange(s)}))("ngModelChange",(function(s){return i.Ic(e),t.$implicit.Length=s})),i.Yb(),i.Wc(9,"\n                                "),i.Zb(10,"span",37),i.hc("click",(function(){i.Ic(e);const s=t.$implicit;return i.lc(2).obj.OnAddDenomClick(s)})),i.Wc(11,"\n                                "),i.Ub(12,"i",40),i.Wc(13,"\n                               "),i.Yb(),i.Wc(14,"\n                        "),i.Yb(),i.Wc(15,"\n                    "),i.Wb()}if(2&e){const e=t.$implicit;i.Db(2),i.Sc("height",e.SectionID,"px"),i.Db(6),i.tc("ngModel",e.Length)}}function d(e,t){if(1&e&&(i.Zb(0,"div",35),i.Wc(1,"\n                    "),i.Uc(2,u,16,3,"ng-container",11),i.Wc(3,"\n                  "),i.Yb()),2&e){const e=i.lc();i.Db(2),i.tc("ngForOf",e.obj.DenomButtons)}}function D(e,t){if(1&e&&(i.Zb(0,"div",32),i.Wc(1,"\n                    "),i.Vb(2,31),i.Wc(3,"\n                  "),i.Yb()),2&e){const e=i.lc();i.Db(2),i.tc("obj",e.obj.CardNo)("group",e.form)}}function S(e,t){if(1&e&&(i.Zb(0,"div",32),i.Wc(1,"\n                    "),i.Vb(2,31),i.Wc(3,"\n                  "),i.Yb()),2&e){const e=i.lc();i.Db(2),i.tc("obj",e.obj.ApprovalCode)("group",e.form)}}function m(e,t){if(1&e&&(i.Zb(0,"div",33),i.Wc(1,"\n                        "),i.Vb(2,31),i.Wc(3,"\n                      "),i.Yb()),2&e){const e=i.lc();i.Db(2),i.tc("obj",e.obj.ExpiryMonth)("group",e.form)}}function b(e,t){if(1&e&&(i.Zb(0,"div",33),i.Wc(1,"\n                        "),i.Vb(2,31),i.Wc(3,"\n                      "),i.Yb()),2&e){const e=i.lc();i.Db(2),i.tc("obj",e.obj.ExpiryYear)("group",e.form)}}function C(e,t){if(1&e&&(i.Zb(0,"div",33),i.Wc(1,"\n                        "),i.Vb(2,31),i.Wc(3,"\n                      "),i.Yb()),2&e){const e=i.lc();i.Db(2),i.tc("obj",e.obj.ExpDate)("group",e.form)}}function p(e,t){if(1&e&&(i.Zb(0,"div",41),i.Wc(1,"\n                        "),i.Vb(2,31),i.Wc(3,"\n                      "),i.Yb()),2&e){const e=i.lc();i.Db(2),i.tc("obj",e.obj.CardName)("group",e.form)}}function y(e,t){if(1&e&&(i.Zb(0,"div",42),i.Wc(1,"\n                        "),i.Vb(2,31),i.Wc(3,"\n                      "),i.Yb()),2&e){const e=i.lc();i.Db(2),i.tc("obj",e.obj.BankName)("group",e.form)}}function g(e,t){if(1&e&&(i.Zb(0,"div",42),i.Wc(1,"\n                        "),i.Vb(2,31),i.Wc(3,"\n                      "),i.Yb()),2&e){const e=i.lc();i.Db(2),i.tc("obj",e.obj.CardType)("group",e.form)}}let O=(()=>{class e{constructor(e,t=null){this.translate=e,this.elementRef=t,this.height=300}ngOnInit(){this.obj.GridDataObj.Height=200,this.height=.8*window.innerHeight-50}get element(){return this.elementRef.nativeElement}ngAfterViewInit(){this.element.getElementsByClassName("master-screen")}}return e.\u0275fac=function(t){return new(t||e)(i.Tb(a.e),i.Tb(i.l))},e.\u0275cmp=i.Nb({type:e,selectors:[["app-pospay-modes"]],decls:127,vars:43,consts:[[2,"padding-bottom","4px","min-height","300px"],[2,"padding","6px","text-align","right"],[1,"primary-btn-wicon",3,"click"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-rectangle-xmark"],[2,"padding","5px","height","calc(100% - 40px)"],[2,"margin-bottom","8px","height","200px"],[2,"width","100%",3,"obj"],[2,"margin","0 10px 0 2px","display","flex","height","calc(100% - 250px)"],["GrdPaymodes",""],[2,"width","200px","display","flex","overflow","auto","max-height","400px","flex-direction","column"],[4,"ngFor","ngForOf"],[1,"splitter",2,"width","1px","border-left","1px solid #ccc"],[2,"margin-left","5px","width","calc(100% - 200px)","max-height","400px","overflow","auto"],["class","form-group PACTControl",4,"ngIf"],["class","form-group col-xl-12  col-md-12 col-sm-12 col-xs-12 PACTControl",4,"ngIf"],[1,"Control_flex",2,"width","100%","display","flex","justify-content","space-between"],[1,"input_cntrl_label",2,"padding","5px"],[1,"input_cntrl",3,"ngModel","keydown","ngModelChange"],["title","Add",1,"secondary-btn-wicon",2,"width","38px","margin-left","5px",3,"click"],[1,"fa-light","fa-plus-circle"],["class","PACTControl col-xl-4",4,"ngIf"],["style","max-height: 300px;overflow: auto;","class","row PayModes_buttons",4,"ngIf"],["class","form-group col-xl-4  col-md-4 col-sm-4 col-xs-4 PACTControl",4,"ngIf"],["class","form-group col-xl-6  col-md-6 col-sm-6 col-xs-6 PACTControl",4,"ngIf"],[2,"vertical-align","bottom","display","flex","justify-content","space-between","border-top","1px solid #ccc"],[2,"display","flex","flex-direction","column"],[1,"input_cntrl_label","MetroHeading2",2,"text-align","left","margin-left","8px","vertical-align","top"],[1,"MetroHeading1",2,"text-align","left","margin-left","8px","vertical-align","top"],[1,"rbtn","rbtnGray",2,"width","180px","padding","5px 0","height","36px","font-weight","500","display","flex","justify-content","center","align-items","center","margin","2px 0",3,"title","click"],[1,"form-group","PACTControl"],["FieldDirective","",3,"obj","group"],[1,"form-group","col-xl-12","col-md-12","col-sm-12","col-xs-12","PACTControl"],[1,"PACTControl","col-xl-4"],[1,"input_cntrl_label"],[1,"row","PayModes_buttons",2,"max-height","300px","overflow","auto"],[1,"col-xl-4","col-md-4","col-sm-12","col-xs-12",2,"display","flex","background-color","white","vertical-align","bottom","text-align","center","justify-content","center","align-items","center"],["title","Add",1,"secondary-btn-wicon",2,"font-size","18px","opacity","0.80","color","black",3,"click"],[1,"fa-light","fa-caret-circle-left"],[1,"input_cntrl",2,"max-width","40px","max-height","22px","text-align","center",3,"ngModel","keydown","ngModelChange"],[1,"fa-light","fa-caret-circle-right"],[1,"form-group","col-xl-4","col-md-4","col-sm-4","col-xs-4","PACTControl"],[1,"form-group","col-xl-6","col-md-6","col-sm-6","col-xs-6","PACTControl"]],template:function(e,t){1&e&&(i.Zb(0,"div",0),i.Wc(1,"\n    "),i.Zb(2,"div",1),i.Wc(3,"\n        "),i.Zb(4,"button",2),i.hc("click",(function(){return t.obj.OnButtonClick("CheckoutSave")})),i.Wc(5),i.mc(6,"translate"),i.Yb(),i.Wc(7,"\n        "),i.Zb(8,"button",3),i.hc("click",(function(){return t.obj.OnButtonClick("CheckoutPrint")})),i.Wc(9),i.mc(10,"translate"),i.Yb(),i.Wc(11,"\n        "),i.Zb(12,"button",3),i.hc("click",(function(){return t.obj.OnButtonClick("Close")})),i.Ub(13,"i",4),i.Wc(14),i.mc(15,"translate"),i.Yb(),i.Wc(16,"\n    "),i.Yb(),i.Wc(17,"\n    "),i.Zb(18,"div",5),i.Wc(19,"\n        "),i.Zb(20,"div",6),i.Wc(21,"\n            "),i.Ub(22,"app-PactGridView",7),i.Wc(23," \n        "),i.Yb(),i.Wc(24,"\n        "),i.Zb(25,"div",8,9),i.Wc(27,"\n            "),i.Zb(28,"div",10),i.Wc(29,"\n                "),i.Uc(30,n,6,6,"ng-container",11),i.Wc(31,"\n            "),i.Yb(),i.Wc(32,"\n            "),i.Zb(33,"div",12),i.Wc(34,"\n            "),i.Yb(),i.Wc(35,"\n            "),i.Zb(36,"div",13),i.Wc(37,"\n                  "),i.Uc(38,r,4,2,"div",14),i.Wc(39,"\n                  "),i.Uc(40,o,4,2,"div",15),i.Wc(41,"\n                  "),i.Zb(42,"div",16),i.Wc(43,"\n                    "),i.Zb(44,"label",17),i.Wc(45),i.Yb(),i.Wc(46,"\n                    "),i.Zb(47,"input",18),i.hc("keydown",(function(){return t.obj.OnButtonClick("AmtChanged")}))("ngModelChange",(function(e){return t.obj.Amount.Text=e})),i.Yb(),i.Wc(48,"\n                    "),i.Zb(49,"span",19),i.hc("click",(function(){return t.obj.OnButtonClick("OK")})),i.Wc(50,"\n                        "),i.Ub(51,"i",20),i.Wc(52,"Add"),i.Yb(),i.Wc(53,"\n                  "),i.Yb(),i.Wc(54,"\n                  "),i.Zb(55,"div",16),i.Wc(56,"\n                  "),i.Uc(57,l,4,2,"div",21),i.Wc(58,"\n                  "),i.Uc(59,c,4,2,"div",21),i.Wc(60,"\n                  "),i.Uc(61,h,7,2,"div",21),i.Wc(62,"\n                  "),i.Yb(),i.Wc(63,"\n\n                  "),i.Uc(64,d,4,1,"div",22),i.Wc(65,"\n\n                  "),i.Uc(66,D,4,2,"div",15),i.Wc(67,"\n                  "),i.Uc(68,S,4,2,"div",15),i.Wc(69,"\n                   \n                    "),i.Zb(70,"div",16),i.Wc(71,"\n                    "),i.Uc(72,m,4,2,"div",21),i.Wc(73,"\n                      "),i.Uc(74,b,4,2,"div",21),i.Wc(75,"\n                      "),i.Uc(76,C,4,2,"div",21),i.Wc(77,"\n                      "),i.Uc(78,p,4,2,"div",23),i.Wc(79,"\n                  "),i.Yb(),i.Wc(80,"\n                  "),i.Zb(81,"div",16),i.Wc(82,"\n                    "),i.Uc(83,y,4,2,"div",24),i.Wc(84,"\n                      "),i.Uc(85,g,4,2,"div",24),i.Wc(86,"\n                  "),i.Yb(),i.Wc(87,"\n                \n                  "),i.Wc(88,"\n            "),i.Yb(),i.Wc(89,"\n        "),i.Yb(),i.Wc(90,"\n        "),i.Zb(91,"div",25),i.Wc(92,"\n\n            "),i.Zb(93,"div",26),i.Wc(94,"\n                "),i.Zb(95,"label",27),i.Wc(96),i.mc(97,"translate"),i.Yb(),i.Wc(98,"\n                "),i.Zb(99,"span",28),i.Wc(100),i.Yb(),i.Wc(101,"\n            "),i.Yb(),i.Wc(102,"\n            "),i.Zb(103,"div",26),i.Wc(104,"\n                "),i.Zb(105,"label",27),i.Wc(106),i.mc(107,"translate"),i.Yb(),i.Wc(108,"\n                "),i.Zb(109,"span",28),i.Wc(110),i.Yb(),i.Wc(111,"\n            "),i.Yb(),i.Wc(112,"\n            "),i.Zb(113,"div",26),i.Wc(114,"\n                "),i.Zb(115,"label",27),i.Wc(116),i.mc(117,"translate"),i.Yb(),i.Wc(118,"\n                "),i.Zb(119,"span",28),i.Wc(120),i.Yb(),i.Wc(121,"\n            "),i.Yb(),i.Wc(122,"\n\n        "),i.Yb(),i.Wc(123,"\n    "),i.Yb(),i.Wc(124,"\n     "),i.Wc(125,"\n"),i.Yb(),i.Wc(126,"\n\n")),2&e&&(i.Sc("height",t.height,"px")("width",t.obj.Width,"px"),i.Db(5),i.Xc(i.nc(6,31,"Save")),i.Db(4),i.Xc(i.nc(10,33,"SaveAndPrint")),i.Db(5),i.Xc(i.nc(15,35,"Cancel")),i.Db(8),i.tc("obj",t.obj.GridDataObj),i.Db(8),i.tc("ngForOf",t.obj.PayModes),i.Db(8),i.tc("ngIf",t.obj.VoucherNo.Visible),i.Db(2),i.tc("ngIf",t.obj.AvailAmount.Visible),i.Db(5),i.Xc(t.obj.Amount.Label),i.Db(2),i.tc("ngModel",t.obj.Amount.Text),i.Db(10),i.tc("ngIf",null!=t.obj.Currency&&t.obj.Currency.Visible),i.Db(2),i.tc("ngIf",null!=t.obj.Currency&&t.obj.Currency.ExchangeRate.Visible),i.Db(2),i.tc("ngIf",null!=t.obj.Currency),i.Db(3),i.tc("ngIf",t.obj.IsCash),i.Db(2),i.tc("ngIf",t.obj.CardNo.Visible),i.Db(2),i.tc("ngIf",t.obj.ApprovalCode.Visible),i.Db(4),i.tc("ngIf",t.obj.ExpiryMonth.Visible),i.Db(2),i.tc("ngIf",t.obj.ExpiryYear.Visible),i.Db(2),i.tc("ngIf",t.obj.ExpDate.Visible),i.Db(2),i.tc("ngIf",t.obj.CardName.Visible),i.Db(5),i.tc("ngIf",t.obj.BankName.Visible),i.Db(2),i.tc("ngIf",t.obj.CardType.Visible),i.Db(11),i.Xc(i.nc(97,37,"DocumentNet")),i.Db(4),i.Xc(t.obj.NetAmount),i.Db(6),i.Xc(i.nc(107,39,"Balance")),i.Db(4),i.Xc(t.obj.POSBalanceAmount),i.Db(6),i.Xc(i.nc(117,41,"ReturnLabel")),i.Db(4),i.Xc(t.obj.Return))},encapsulation:2}),e})()},keYA:function(e,t,s){"use strict";s.d(t,"a",(function(){return C}));var i=s("Do2H"),a=s("Lp6j"),n=s("eQJW"),r=s("ScVY"),o=s("0/4Q"),l=s("JIg3"),c=s("jgdN"),h=s("EQd/"),u=s("n56n"),d=s("NkMH"),D=s("8B8H"),S=s("ockk"),m=s("Z9XZ"),b=s("HNy5");class C extends r.b{constructor(e,t=!1){super(),this.ButtonVisibility=!0,this.AdjustBillsVisible=!1,this.Repeat=new o.e(0),this.CheqStartDate=new l.a(0),this.CheqEndDate=new l.a(0),this.PayeeBank=new c.a(0),this.Amount=new h.d(0),this.ChequeBankName=new h.d(0),this.NoofCheques=new h.d(0),this.FirstChequeNo=new h.d(0),this.SelectedValueChanged=!1,this._selectedvalue=0,this.DebitAcc=new u.b(0),this.AdjustBills=!0,this.GenerateButton=new d.a,this.CredAcc=new u.b(0),this.PDCAmount=0,this.IsDataSaved=!1,this.GenChqVis=!1,this.IsPrepayment=!1,this.Dedimals="2",this.HeaderFields=[],this.PrevValue="",this.ClassName="pdcGenerateChequeViewModel";var s=e.GetButton("Generate Cheques");if(null!=s&&(this.GenChqVis=s.Visible),this.IsPrepayment=t,this.IsDataSaved=!1,this.oparent=e,this.Amount.DataType="FLOAT",this.NoofCheques.DataType="FLOAT",this.NoofCheques.TextChangedCommand.Subscribe(this,"OnSave","TextChanged"),this.CheqStartDate.SelectedDateChanged.Subscribe(this,"OnSave","SelectedDateChanged"),this.CheqStartDate.DBColumnName="CheqStartDate",this.CheqEndDate.DBColumnName="CheqEndDate",this.GrBody=new D.a,this.GrBody.Width="600",this.GrBody.OnCellEditEnding.Subscribe(this,"OnGridCellEditEnding"),this.GrBody.OnBeginEdit.Subscribe(this,"Grid_BeginEdit"),this.GenerateButton.Visible=!1,19==e.ScreenObject.DocumentType)e.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")?(r=e.ScreenObject.ColumnSource.find(e=>null!=e.ValueMember&&"creditaccount_key"==e.ValueMember.toLowerCase()))&&(this.CredAcc.Label=r.Header):this.CredAcc.Label="Account Name",e.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")?(r=e.ScreenObject.ColumnSource.find(e=>null!=e.ValueMember&&"debitaccount_key"==e.ValueMember.toLowerCase()))&&(this.DebitAcc.Label=r.Header):this.DebitAcc.Label=null!=e.ScreenObject.DebitAccount?e.ScreenObject.DebitAccount.Label:"Reciept Mode";else if(14==e.ScreenObject.DocumentType){var r;e.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")?(r=e.ScreenObject.ColumnSource.find(e=>null!=e.ValueMember&&"debitaccount_key"==e.ValueMember.toLowerCase()))&&(this.CredAcc.Label=r.Header):this.CredAcc.Label="Account Name",e.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")?(r=e.ScreenObject.ColumnSource.find(e=>null!=e.ValueMember&&"creditaccount_key"==e.ValueMember.toLowerCase()))&&(this.DebitAcc.Label=r.Header):this.DebitAcc.Label=null!=e.ScreenObject.CreditAccount?e.ScreenObject.CreditAccount.Label:"Reciept Mode"}else{this.GrBody.Table=[],this.GrBody.Columns=[];let s=new S.a;s.Header="#",s.DisplayMember="DocSeqNo",s.lbl="DocSeqNo",s.DataType="TextBlock",s.ReadOnly=!0,s.Width=45,s.ID="0",s.DisableTab=!0,this.GrBody.Columns.push(s),this.GrBody.TableColumns.push("DocSeqNo");let n=0;!e.ScreenObject.Preferences.ContainsKey("PrepaymentDoc")||!t&&e.IsInventoryVoucher?e.ScreenObject.Preferences.ContainsKey("PostPdcDoc")&&(n=parseInt(e.ScreenObject.Preferences.PostPdcDoc)):n=a.e.IsEmpty(e.ScreenObject.Preferences.PrepaymentDoc)?0:parseInt(e.ScreenObject.Preferences.PrepaymentDoc);let r=e.ScreenObject.GetScreenInfo(n);if(null!=r&&r.Tables.length>0&&!r.Columns[0].Contains("ErrorMessage")&&r.Tables[0].length>0){let n=parseInt(r.Tables[0][0].DocumentType),o=null;if(o=r.Tables[0].filter(e=>"CreditAccount"==e.SysColumnName),o.length>0&&(this.CredAcc.Label=o[0].ResourceData.toString(),e.IsInventoryVoucher&&14==n&&(1==e.DocumentType||2==e.DocumentType||4==e.DocumentType)||(!e.IsInventoryVoucher||t)&&"3"==o[0].SectionID.toString()?(e.IsInventoryVoucher&&!this.IsPrepayment||(this.CredAcc.Visible=!1),this.GrBody.TableColumns.push("CreditAccount"),this.GrBody.TableColumns.push("CreditAccount_Key"),s=new S.a,s.Header=o[0].ResourceData.toString(),s.CostCenterID=parseInt(o[0].ColumnCostCenterID),s.TypeID=parseInt(o[0].ColumnCCListViewTypeID),s.DisplayMember="CreditAccount",s.ValueMember="CreditAccount_Key",s.DataType="LISTBOX",s.Width=parseInt(o[0].UIWidth),this.GrBody.Columns.push(s)):e.IsInventoryVoucher&&!t&&(this.CredAcc.Visible=!1)),o=r.Tables[0].filter(e=>"DebitAccount"==e.SysColumnName),null!=o&&o.length>0&&(this.DebitAcc.Label=o[0].ResourceData.toString(),e.IsInventoryVoucher&&19==n&&(11==e.DocumentType||7==e.DocumentType||12==e.DocumentType||38==e.DocumentType)||(!e.IsInventoryVoucher||t)&&"3"==o[0].SectionID.toString()?(e.IsInventoryVoucher&&!this.IsPrepayment||(this.DebitAcc.Visible=!1),this.GrBody.TableColumns.push("DebitAccount"),this.GrBody.TableColumns.push("DebitAccount_Key"),s=new S.a,s.Header=o[0].ResourceData.toString(),s.CostCenterID=parseInt(o[0].ColumnCostCenterID),s.TypeID=parseInt(o[0].ColumnCCListViewTypeID),s.DisplayMember="DebitAccount",s.ValueMember="DebitAccount_Key",s.DataType="LISTBOX",s.Width=parseInt(o[0].UIWidth),this.GrBody.Columns.push(s)):e.IsInventoryVoucher&&!t&&(this.DebitAcc.Visible=!1)),!e.IsInventoryVoucher&&t){if(this.GrBody.CanUserAddRows=!0,this.GrBody.CanUserDeleteRows=!0,o=r.Tables[0].filter(e=>3==e.SectionID&&e.SysColumnName.toLowerCase().startsWith("dcccnid")),o.length>0)for(let e=0;e<o.length;e++)this.GrBody.TableColumns.push(o[e].SysColumnName.toString()),this.GrBody.TableColumns.push(o[e].SysColumnName.toString()+"_Key"),s=new S.a,s.Header=o[e].ResourceData.toString(),s.CostCenterID=parseInt(o[e].ColumnCostCenterID),s.TypeID=parseInt(o[e].ColumnCCListViewTypeID),s.DisplayMember=o[e].SysColumnName.toString(),s.ValueMember=o[e].SysColumnName.toString()+"_Key",s.DataType="LISTBOX",s.Width=parseInt(o[e].UIWidth),this.GrBody.Columns.push(s);s=new S.a,s.Header="Percentage",s.DisplayMember="Percentage",s.DataType="FLOAT",this.GrBody.Columns.push(s),s.Width=80,s.IsCalculated=1,s.ShowTotal=!0,this.GrBody.TableColumns.push("Percentage"),s=new S.a,s.Header="Amount",s.DisplayMember="Amount",s.DataType="FLOAT",o=r.Tables[0].filter(e=>"Amount"==e.SysColumnName),o.length>0&&a.e.DoubleTryParse(o[0].Decimal)>=0?this.Dedimals=o[0].Decimal.toString():i.a.SessionManager.Preferences.ContainsKey("DecimalsinAmount")&&""!=i.a.SessionManager.Preferences.DecimalsinAmount&&(this.Dedimals=i.a.SessionManager.Preferences.DecimalsinAmount),s.DecimalPoints=this.Dedimals,this.GrBody.Columns.push(s),s.Width=80,s.IsCalculated=1,s.ShowTotal=!0,this.GrBody.TableColumns.push("Amount"),this.GrBody.TableColumns.push("Detailsxml")}else s=new S.a,s.Header="Amount",s.DisplayMember="Amount",s.DataType="FLOAT",o=r.Tables[0].filter(e=>"Amount"==e.SysColumnName),o.length>0&&a.e.DoubleTryParse(o[0].Decimal)>=0?this.Dedimals=o[0].Decimal.toString():i.a.SessionManager.Preferences.ContainsKey("DecimalsinAmount")&&""!=i.a.SessionManager.Preferences.DecimalsinAmount&&(this.Dedimals=i.a.SessionManager.Preferences.DecimalsinAmount),s.DecimalPoints=this.Dedimals,this.GrBody.Columns.push(s),s.Width=80,this.GrBody.TableColumns.push("Amount"),s=new S.a,s.Header="Cheque No",s.DisplayMember="ChequeNumber",this.GrBody.Columns.push(s),s.Width=100,this.GrBody.TableColumns.push("ChequeNumber"),s=new S.a,s.Header="Cheque Date",s.DisplayMember="ChequeDate",s.DataType="DATE",this.GrBody.Columns.push(s),s.Width=120,this.GrBody.TableColumns.push("ChequeDate"),this.GrBody.TableColumns.push("ChequeDate_Key"),this.GrBody.TableColumns.push("ChequeBankName"),this.GrBody.TableColumns.push("DocID"),this.GrBody.TableColumns.push("DocDetailsID"),this.GrBody.TableColumns.push("StatusID")}else this.DebitAcc.Label="Debit account",this.CredAcc.Label="Credit account",(22==e.ScreenObject.DocumentType||18==e.ScreenObject.DocumentType)&&e.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&e.ScreenObject.GridData.length>0&&!a.e.StringIsNullOrEmpty(e.ScreenObject.GridData[0].CreditAccount_Key)?this.DebitAcc.SelectedValue=parseInt(e.ScreenObject.GridData[0].CreditAccount_Key):e.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&e.ScreenObject.GridData.length>0&&!a.e.StringIsNullOrEmpty(e.ScreenObject.GridData[0].DebitAccount_Key)&&(this.CredAcc.SelectedValue=parseInt(e.ScreenObject.GridData[0].DebitAccount_Key));if(!this.oparent.IsInventoryVoucher&&e.ScreenObject.GridData.length>0&&!a.e.StringIsNullOrEmpty(e.ScreenObject.GridData[0].Amount)&&(this.Amount.Text=e.ScreenObject.GridData[0].Amount.toString(),this.Amount.Enable=!1),this.oparent.IsInventoryVoucher&&!t){let e=r.Tables[7].filter(e=>"BankNameDropDown"==e.PrefName);e.length>0&&"True"==e[0].PrefValue.toString()?(this.PayeeBank.Visible=!0,this.PayeeBank.Label="Bank Name",this.PayeeBank.CostCenterID=n,this.PayeeBank.DBColumnName="chequebankname",this.ChequeBankName.Visible=!1):(this.PayeeBank.Visible=!1,this.ChequeBankName.Visible=!0)}}if(e.IsInventoryVoucher||(e.ScreenObject.Preferences.ContainsKey("BankNameDropDown")&&""!=e.ScreenObject.Preferences.BankNameDropDown&&Object(n.j)(e.ScreenObject.Preferences.BankNameDropDown)?(this.PayeeBank.Visible=!0,this.PayeeBank.Label="Bank Name",this.PayeeBank.CostCenterID=e.ScreenObject.CostCenterID,this.PayeeBank.DBColumnName="chequebankname",this.ChequeBankName.Visible=!1):(this.PayeeBank.Visible=!1,this.ChequeBankName.Visible=!0)),e.IsInventoryVoucher&&!t){this.GrBody.CanUserAddRows=!0,this.GrBody.CanUserDeleteRows=!0,this.AdjustBillsVisible=!1,this.Repeat.Items.push(o.d.ComboBoxItems_2("Monthly","1")),this.Repeat.Items.push(o.d.ComboBoxItems_2("Quaterly","3")),this.Repeat.Items.push(o.d.ComboBoxItems_2("Half yearly","6")),this.Repeat.Label="Repeat",this.CheqStartDate.Label=i.a.GetResource("Ren_CntrctCheStartD"),this.CheqEndDate.Label=i.a.GetResource("EndDate"),this.GrBody.Row=3,this.CheqStartDate.Row=0,this.CheqStartDate.Column=2,this.Repeat.Row=2,this.Repeat.Column=0,this.DebitAcc.Row=0,this.DebitAcc.Visible?this.DebitAcc.Column=0:this.CredAcc.Column=0,this.CredAcc.Row=0,this.Amount.Row=0,this.Amount.Column=1,this.GenerateButton.Visible=!0,this.GenerateButton.Row=2,this.GenerateButton.Column=1,this.GrBody.Visible=!0,this.CheqEndDate.Visible=!1,this.NoofCheques.Label=i.a.GetResource("Ren_CntrctNoCheque"),this.DisplayName=i.a.GetResource("Ren_CntrctCheqNo"),this.btnSavetext=i.a.GetResource("SerialNo_Generate");let e=this.oparent.ScreenObject.GetPDCInstallmentDetails();for(let t=0;t<e.Tables[0].length;t++){let s=this.GrBody.NewRow();this.PDCAmount+=parseFloat(e.Tables[0][t].Amount),s.DocSeqNo=(t+1).toString(),s.Amount=e.Tables[0][t].Amount.toString(),s.ChequeNumber=e.Tables[0][t].chequenumber.toString(),s.StatusID=e.Tables[0][t].Statusid.toString(),s.DocDetailsID=e.Tables[0][t].Accdocdetailsid.toString(),s.DocID=e.Tables[0][t].docid.toString(),s.ChequeBankName=e.Tables[0][t].ChequeBankName.toString(),a.e.StringIsNullOrEmpty(e.Tables[0][t].chequedate)||(s.ChequeDate_Key=new Date(e.Tables[0][t].chequedate),s.ChequeDate=new Date(e.Tables[0][t].chequedate).ToString(i.a.SessionManager.Preferences["Date Format"])),a.e.StringIsNullOrEmpty(e.Tables[0][t].BankAccountID)?this.GrBody.TableColumns.Contains("DebitAccount_Key")?s.DebitAccount_Key=e.Tables[0][t].DebitAccount.toString():s.CreditAccount_Key=e.Tables[0][t].CreditAccount.toString():this.GrBody.TableColumns.Contains("DebitAccount_Key")?s.DebitAccount_Key=e.Tables[0][t].BankAccountID.toString():s.CreditAccount_Key=e.Tables[0][t].BankAccountID.toString(),this.GrBody.addRow(s)}this.Amount.Text=this.PDCAmount.toString(),this.GrBody.RefreshGrid=!0}else this.GenChqVis?(this.Repeat.Items.push(o.d.ComboBoxItems_2("Monthly","1")),this.Repeat.Items.push(o.d.ComboBoxItems_2("Quaterly","3")),this.Repeat.Items.push(o.d.ComboBoxItems_2("Half yearly","6")),this.Repeat.Label="Repeat",this.CheqStartDate.Label=i.a.GetResource("Ren_CntrctCheStartD"),this.CheqEndDate.Label=i.a.GetResource("EndDate"),this.AdjustBillsVisible=!0,this.GrBody.Row=2,this.CheqStartDate.Row=2,this.CheqStartDate.Column=0,this.Repeat.Row=2,this.Repeat.Column=1,this.DebitAcc.Row=0,this.DebitAcc.Column=0,this.CredAcc.Row=0,this.CredAcc.Column=1,this.Amount.Row=0,this.Amount.Column=2,this.GrBody.Visible=!1,this.CheqEndDate.Visible=!1,this.NoofCheques.Label=i.a.GetResource("Ren_CntrctNoCheque"),this.DisplayName=i.a.GetResource("Ren_CntrctCheqNo"),this.btnSavetext=i.a.GetResource("SerialNo_Generate")):(this.Repeat.Label="Rent based on",this.Repeat.Items.push(o.d.ComboBoxItems_2("Monthly","1")),this.Repeat.Items.push(o.d.ComboBoxItems_2("Daily","2")),this.PayeeBank.Visible=!1,this.ChequeBankName.Visible=!1,this.FirstChequeNo.Visible=!1,this.AdjustBillsVisible=!1,this.NoofCheques.Label="No. of Months",this.CheqStartDate.Label="Start Date",this.CheqEndDate.Label="End Date",this.DisplayName="Pre payments",this.btnSavetext="OK",this.CheqStartDate.Row=1,this.CheqStartDate.Column=1,this.CheqEndDate.Row=1,this.CheqEndDate.Column=2,this.Repeat.Row=0,this.Repeat.Column=2,this.GrBody.Row=3,this.DebitAcc.Visible?this.DebitAcc.Column=0:this.CredAcc.Column=0,this.DebitAcc.Row=0,this.CredAcc.Row=0,this.Amount.Row=0,this.Amount.Column=1);if(this.NoofCheques.Row=1,this.NoofCheques.Column=0,this.FirstChequeNo.Row=1,this.FirstChequeNo.Column=1,this.PayeeBank.Row=1,this.PayeeBank.Column=2,this.ChequeBankName.Row=1,this.ChequeBankName.Column=2,this.Amount.Label="Amount",this.CredAcc.TypeID=this.DebitAcc.TypeID=100,this.CredAcc.CCID=this.DebitAcc.CCID=2,this.HeaderFields.push(this.DebitAcc),this.HeaderFields.push(this.CredAcc),this.HeaderFields.push(this.Amount),this.HeaderFields.push(this.NoofCheques),this.HeaderFields.push(this.CheqEndDate),this.HeaderFields.push(this.FirstChequeNo),this.HeaderFields.push(this.PayeeBank),this.HeaderFields.push(this.ChequeBankName),this.HeaderFields.push(this.CheqStartDate),this.HeaderFields.push(this.Repeat),this.HeaderFields.sort((e,t)=>e.Column-t.Column),this.HeaderFields.sort((e,t)=>e.Row-t.Row),this.Title=this.DisplayName,this.GrBody.Visible)for(let i=0;i<50;i++){this.GrBody.addEmptyRow();let e=this.GrBody.NewRow();e.DocSeqNo=(i+1).toString(),this.GrBody.addRow(e)}this.Repeat.SelectedValue="1"}get SelectedValue(){return this._selectedvalue}set SelectedValue(e){this._selectedvalue!=e&&(this._selectedvalue=e,this.SelectedValueChanged=!this.SelectedValueChanged)}loadFromxml(e,t){if(a.e.IsEmpty(e))return;let s=new a.f;s.LoadXml(e);let i=s.SelectNodes("XML");if(i.length>0){this.IsDataSaved=!0,null==i[0].attributes.BasedOn||a.e.IsEmpty(i[0].attributes.BasedOn.value)||(this.Repeat.SelectedValue=i[0].attributes.BasedOn.value),null==i[0].attributes.StartDate||a.e.IsEmpty(i[0].attributes.StartDate.value)||(this.CheqStartDate.Date=new Date(i[0].attributes.StartDate.value)),null==i[0].attributes.EndDate||a.e.IsEmpty(i[0].attributes.EndDate.value)||(this.CheqEndDate.Date=new Date(i[0].attributes.EndDate.value)),null==i[0].attributes.Months||a.e.IsEmpty(i[0].attributes.Months.value)||(this.NoofCheques.Text=i[0].attributes.Months.value),""!=t&&(this.Amount.Text=t),i=s.SelectNodes("XML/Rows"),this.GrBody.Clear();for(let e=0;e<i.length;e++){let t=this.GrBody.NewRow();t.DocSeqNo=(e+1).toString(),null==i[e].attributes.DebitAcc||a.e.IsEmpty(i[e].attributes.DebitAcc.value)||(this.DebitAcc.Visible?this.DebitAcc.SelectedValue=parseInt(i[e].attributes.DebitAcc.value):this.GrBody.TableColumns.Contains("DebitAccount_Key")&&(t.DebitAccount_Key=i[e].attributes.DebitAcc.value)),null==i[e].attributes.CredAcc||a.e.IsEmpty(i[e].attributes.CredAcc.value)||(this.CredAcc.Visible?this.CredAcc.SelectedValue=parseInt(i[e].attributes.CredAcc.value):this.GrBody.TableColumns.Contains("CreditAccount_Key")&&(t.CreditAccount_Key=i[e].attributes.CredAcc.value)),null==i[e].attributes.Amount||a.e.IsEmpty(i[e].attributes.Amount.value)||this.GrBody.TableColumns.Contains("Percentage")&&this.GrBody.TableColumns.Contains("Amount")&&(t.Percentage=i[e].attributes.Amount.value,t.Amount=""==t.Percentage.toString()||a.e.IsEmpty(this.Amount.Text)?0:a.e.Round(parseFloat(this.Amount.Text)*parseFloat(t.Percentage.toString())/100,parseInt(this.Dedimals)));for(let s=1;s<this.GrBody.Columns.length;s++)this.GrBody.Columns[s].DisplayMember.toLowerCase().Contains("dcccnid")&&null!=i[e].Attributes[this.GrBody.Columns[s].DisplayMember]&&!a.e.IsEmpty(i[e].Attributes[this.GrBody.Columns[s].DisplayMember].value)&&(t[this.GrBody.Columns[s].ValueMember]=i[e].attributes[this.GrBody.Columns[s].DisplayMember].value);""!=i[e].InnerXml&&(t.Detailsxml="<XML>"+i[e].InnerXml+"</XML>"),this.GrBody.addRow(t)}this.GrBody.RefreshGrid=!0,this.GrBody.UpdateTotals();for(let e=0;e<50;e++){this.GrBody.addEmptyRow();let t=this.GrBody.NewRow();t.DocSeqNo=(e+1).toString(),this.GrBody.addRow(t)}}}Grid_BeginEdit(e,t,s){return"Percentage"!=t&&"Amount"!=t||(this.PrevValue=e[t].toString()),!1}OnGridCellEditEnding(e,t,s){if(this.GrBody.TableColumns.Contains("Percentage")){if("Percentage"==t){if(e[t].toString()==this.PrevValue)return;e.Amount=a.e.StringIsNullOrEmpty(e.Percentage)?0:a.e.Round(parseFloat(this.Amount.Text)*parseFloat(e.Percentage)/100,parseInt(this.Dedimals)),this.GrBody.UpdateTotals()}"Amount"==t&&(e.Percentage=a.e.StringIsNullOrEmpty(e.Amount)?0:a.e.Round(parseFloat(e.Amount)*(100/parseFloat(this.Amount.Text)),2),this.GrBody.UpdateTotals())}}Validate(e){return a.e.StringIsNullOrEmpty(this.Amount.Text)||parseFloat(this.Amount.Text).ToString("N0")==parseFloat(e).ToString("N0")?this.DebitAcc.Visible&&0==this.DebitAcc.SelectedValue?(this.oparent.DisplayMessage="Select "+this.DebitAcc.Label+" in Prepayments.",this.oparent.MessageVisibility=!0,!1):!this.CredAcc.Visible||0!=this.CredAcc.SelectedValue||(this.oparent.DisplayMessage="Select "+this.CredAcc.Label+" in Prepayments.",this.oparent.MessageVisibility=!0,!1):(this.oparent.DisplayMessage="Amount not equal in Prepayments.",this.oparent.MessageVisibility=!0,!1)}GetXML1(){let e="";e+="&lt;XML",a.e.StringIsNullOrEmpty(this.NoofCheques.Text)||(e+=" Months='"+this.NoofCheques.Text+"' "),a.e.StringIsNullOrEmpty(this.Repeat.SelectedValue)||(e+=" BasedOn='"+this.Repeat.SelectedValue+"' "),e+=" StartDate='"+this.CheqStartDate.Date.ToString("dd/MMM/yyyy")+"' ",e+=" EndDate='"+this.CheqEndDate.Date.ToString("dd/MMM/yyyy")+"' >";for(let t=0;t<this.GrBody.Table.length;t++)if(a.e.DoubleTryParse(this.GrBody.Table[t].Percentage)>0){e+="&lt;Rows ",this.DebitAcc.Visible?e+=" DebitAcc='"+this.DebitAcc.SelectedValue+"' ":this.GrBody.TableColumns.Contains("DebitAccount_Key")&&!a.e.StringIsNullOrEmpty(this.GrBody.Table[t].DebitAccount_Key)&&(e+=" DebitAcc='"+this.GrBody.Table[t].DebitAccount_Key.toString()+"' "),this.CredAcc.Visible?e+=" CredAcc='"+this.CredAcc.SelectedValue+"' ":this.GrBody.TableColumns.Contains("CreditAccount_Key")&&!a.e.StringIsNullOrEmpty(this.GrBody.Table[t].CreditAccount_Key)&&(e+=" CredAcc='"+this.GrBody.Table[t].CreditAccount_Key.toString()+"' ");for(let s=1;s<this.GrBody.Columns.length;s++)this.GrBody.Columns[s].DisplayMember.toLowerCase().Contains("dcccnid")&&!a.e.StringIsNullOrEmpty(this.GrBody.Table[t][this.GrBody.Columns[s].ValueMember])&&(e+=this.GrBody.Columns[s].DisplayMember+"='"+this.GrBody.Table[t][this.GrBody.Columns[s].ValueMember].toString()+"' ");if(e+=" Amount='"+this.GrBody.Table[t].Percentage.toString()+"'  >",!a.e.StringIsNullOrEmpty(this.GrBody.Table[t].Detailsxml)){let s=new a.f;if(s.ReadXml(this.GrBody.Table[t].Detailsxml),s.Tables.length>0&&s.Columns[0].Contains("Amount")&&s.Tables[0].length>0)for(let t=0;t<s.Tables[0].length;t++)e+="&lt;DetRow  Amount='"+s.Tables[0][t].Amount.toString()+"' Date='",e+=new Date(s.Tables[0][t].Date).ToString("dd/MMM/yyyy")+"' />"}e+="&lt;/Rows>"}return e+="&lt;/XML>",e.toString()}GetXML(e=!1){let t="";t+=e?"<XML":"&lt;XML",a.e.IsEmpty(this.NoofCheques.Text)||(t+=" Months='"+this.NoofCheques.Text+"' "),a.e.IsEmpty(this.Repeat.SelectedValue)||(t+=" BasedOn='"+this.Repeat.SelectedValue+"' "),t+=" StartDate='"+this.CheqStartDate.Date.ToString("dd/MMM/yyyy")+"' ",t+=" EndDate='"+this.CheqEndDate.Date.ToString("dd/MMM/yyyy")+"' >";for(let s=0;s<this.GrBody.Table.length;s++)if(!a.e.IsEmpty(this.GrBody.Table[s].Percentage)&&parseFloat(this.GrBody.Table[s].Percentage.toString())>0){t+=e?"<Rows ":"&lt;Rows ",this.DebitAcc.Visible?t+=" DebitAcc='"+this.DebitAcc.SelectedValue+"' ":this.GrBody.TableColumns.Contains("DebitAccount_Key")&&!a.e.IsEmpty(this.GrBody.Table[s].DebitAccount_Key)&&(t+=" DebitAcc='"+this.GrBody.Table[s].DebitAccount_Key.toString()+"' "),this.CredAcc.Visible?t+=" CredAcc='"+this.CredAcc.SelectedValue+"' ":this.GrBody.TableColumns.Contains("CreditAccount_Key")&&!a.e.IsEmpty(this.GrBody.Table[s].CreditAccount_Key)&&(t+=" CredAcc='"+this.GrBody.Table[s].CreditAccount_Key.toString()+"' ");for(let e=1;e<this.GrBody.Columns.length;e++)this.GrBody.Columns[e].DisplayMember.toLowerCase().Contains("dcccnid")&&!a.e.IsEmpty(this.GrBody.Table[s][this.GrBody.Columns[e].ValueMember])&&(t+=this.GrBody.Columns[e].DisplayMember+"='"+this.GrBody.Table[s][this.GrBody.Columns[e].ValueMember].toString()+"' ");if(t+=" Amount='"+this.GrBody.Table[s].Percentage.toString()+"'  >",!a.e.IsEmpty(this.GrBody.Table[s].Detailsxml)){let i=[];if(i.ReadXml(this.GrBody.Table[s].Detailsxml.toString()),i.Tables.length>0&&i.Columns[0].Contains("Amount")&&i.Tables[0].length>0)for(let s=0;s<i.Tables[0].length;s++)t+=e?"<DetRow ":"&lt;DetRow ",t+=" Amount='"+i.Tables[0][s].Amount.toString()+"' Date='",t+=new Date(i.Tables[0][s].Date.toString()).ToString("dd/MMM/yyyy")+"' />"}t+=e?"</Rows>":"&lt;/Rows>"}return t+=e?"</XML>":"&lt;/XML>",t.toString()}OnSave(e){if("Cancel"==e)i.a.page.HideDialog();else if("TextChanged"!=e||this.GenChqVis){if("Distribute"!=e||this.oparent.IsInventoryVoucher||this.GenChqVis)if("SelectedDateChanged"!=e||this.GenChqVis){if("Gnenerate"==e){if(a.e.StringIsNullOrEmpty(this.NoofCheques.Text))return this.DisplayMessage="Please enter "+this.NoofCheques.Label,void(this.MessageVisibility=!0);if(!a.e.IsNum(this.NoofCheques.Text))return this.DisplayMessage="Invalid "+this.NoofCheques.Label,void(this.MessageVisibility=!0);if(parseInt(this.NoofCheques.Text)<=0)return this.DisplayMessage="Please enter "+this.NoofCheques.Label+" greater than zero",void(this.MessageVisibility=!0);if(a.e.StringIsNullOrEmpty(this.Amount.Text))return this.DisplayMessage="Please enter "+this.Amount.Label,void(this.MessageVisibility=!0);if(!a.e.IsNum(this.Amount.Text))return this.DisplayMessage="Invalid "+this.Amount.Label,void(this.MessageVisibility=!0);if(parseFloat(this.Amount.Text)<=0)return this.DisplayMessage="Please enter "+this.Amount.Label+" greater than zero",void(this.MessageVisibility=!0);if(null==this.FirstChequeNo.Text||""==this.FirstChequeNo.Text.trim())return this.DisplayMessage="Please enter First Cheque No",void(this.MessageVisibility=!0);if(!a.e.IsNum(this.FirstChequeNo.Text))return this.DisplayMessage="Invalid First Cheque No",void(this.MessageVisibility=!0);if(null!=this.FirstChequeNo.Text&&parseInt(this.FirstChequeNo.Text)<=0)return this.DisplayMessage="Please enter First Cheque No greater than zero",void(this.MessageVisibility=!0);if(this.DebitAcc.Visible&&0==this.DebitAcc.SelectedValue)return this.DisplayMessage="Select "+this.DebitAcc.Label,void(this.MessageVisibility=!0);if(this.CredAcc.Visible&&0==this.CredAcc.SelectedValue)return this.DisplayMessage="Select "+this.CredAcc.Label,void(this.MessageVisibility=!0);this.GenerateChequeNos()}else if("OK"==e){if(null==this.NoofCheques.Text||""==this.NoofCheques.Text.trim())return this.DisplayMessage="Please enter "+this.NoofCheques.Label,void(this.MessageVisibility=!0);if(!a.e.IsNum(this.NoofCheques.Text))return this.DisplayMessage="Invalid "+this.NoofCheques.Label,void(this.MessageVisibility=!0);if(null!=this.NoofCheques.Text&&parseInt(this.NoofCheques.Text)<=0)return this.DisplayMessage="Please enter "+this.NoofCheques.Label+" greater than zero",void(this.MessageVisibility=!0);if(this.GenChqVis){if(null==this.FirstChequeNo.Text||""==this.FirstChequeNo.Text.trim())return this.DisplayMessage="Please enter First Cheque No",void(this.MessageVisibility=!0);if(!a.e.IsNum(this.FirstChequeNo.Text))return this.DisplayMessage="Invalid First Cheque No",void(this.MessageVisibility=!0);if(null!=this.FirstChequeNo.Text&&parseInt(this.FirstChequeNo.Text)<=0)return this.DisplayMessage="Please enter First Cheque No greater than zero",void(this.MessageVisibility=!0)}else{if(this.oparent.ScreenObject.Preferences.ContainsKey("Prepaymentdate")&&"True"==this.oparent.ScreenObject.Preferences.Prepaymentdate&&this.CheqStartDate.Date<this.oparent.DocumentDate)return this.DisplayMessage="Start date can not be less than document date.",void(this.MessageVisibility=!0);if(this.DebitAcc.Visible&&0==this.DebitAcc.SelectedValue)return this.DisplayMessage="Select "+this.DebitAcc.Label,void(this.MessageVisibility=!0);if(this.CredAcc.Visible&&0==this.CredAcc.SelectedValue)return this.DisplayMessage="Select "+this.CredAcc.Label,void(this.MessageVisibility=!0);let e=0,s=0;for(let i=0;i<this.GrBody.Table.length;i++)if(a.e.DoubleTryParse(this.GrBody.Table[i].Percentage)>0){if(this.GrBody.TableColumns.Contains("DebitAccount_Key")&&a.e.StringIsNullOrEmpty(this.GrBody.Table[i].DebitAccount_Key)){var t=this.GrBody.Columns.find(e=>"DebitAccount"==e.DisplayMember);return this.DisplayMessage=t?"Select "+t.Header+"at row no."+(i+1):"Select Accountat row no."+(i+1),void(this.MessageVisibility=!0)}if(this.GrBody.TableColumns.Contains("CreditAccount_Key")&&a.e.StringIsNullOrEmpty(this.GrBody.Table[i].CreditAccount_Key))return t=this.GrBody.Columns.find(e=>"CreditAccount"==e.DisplayMember),this.DisplayMessage=t?"Select "+t.Header+"at row no."+(i+1):"Select Accountat row no."+(i+1),void(this.MessageVisibility=!0);e+=parseFloat(this.GrBody.Table[i].Percentage),""!=this.GrBody.Table[i].Amount.toString()&&(s+=parseInt(this.GrBody.Table[i].Amount.toString()))}if(e=parseFloat(e.ToString("N2")),s.ToString("N2")!=a.e.DoubleTryParse(this.Amount.Text).ToString("N2"))return this.DisplayMessage="Amount not equal.",void(this.MessageVisibility=!0)}this.IsDataSaved=!0,this.GenChqVis&&this.GenerateChequeNos(),i.a.page.HideDialog()}}else a.e.IsNum(this.NoofCheques.Text)&&parseInt(this.NoofCheques.Text)>0&&(this.CheqEndDate.Date=this.CheqStartDate.Date.AddMonths(parseInt(this.NoofCheques.Text)).AddDays(-1));else if(a.e.DoubleTryParse(this.GrBody.SelectedItem.Amount)>0){let e=new m.ShowJVViewModel;e.ShowJVViewModel_1(this,3),i.a.page.ShowDialog(e,b.ShowJVComponent)}}else a.e.IsNum(this.NoofCheques.Text)&&parseInt(this.NoofCheques.Text)>0&&(this.CheqEndDate.Date=this.CheqStartDate.Date.AddMonths(parseInt(this.NoofCheques.Text)).AddDays(-1))}CalcPDCAmt(){let e=0;for(let t=0;t<this.GrBody.Table.length;t++)a.e.StringIsNullOrEmpty(this.GrBody.Table[t].Amount)||(e+=parseFloat(this.GrBody.Table[t].Amount));return e}GenerateChequeNos(e=!1){let t="";this.oparent.SetFocusongrid=!0;let s="";this.oparent.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")||this.oparent.IsInventoryVoucher&&this.GrBody.TableColumns.Contains("CreditAccount_Key")?s="CreditAccount_Key":(this.oparent.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")||this.oparent.IsInventoryVoucher&&this.GrBody.TableColumns.Contains("DebitAccount_Key"))&&(s="DebitAccount_Key");let r=this.CheqStartDate.Date;this.oparent.IsInventoryVoucher||this.oparent.GetEmptyRowPosition(this.oparent.ScreenObject.GridDataObj,s);let o=1,l=0;null!=this.Repeat.SelectedValue&&""!=this.Repeat.SelectedValue&&parseInt(this.Repeat.SelectedValue)>0&&(o=parseInt(this.Repeat.SelectedValue));let c=!1,h={},u="",d="";if(this.oparent.IsInventoryVoucher&&!this.IsPrepayment){this.DebitAcc.Visible&&this.DebitAcc.SelectedValue>0?d=this.DebitAcc.Text:this.CredAcc.Visible&&this.CredAcc.SelectedValue>0&&(d=this.CredAcc.Text);for(let e=0;e<this.GrBody.Table.length;e++)""!=a.e.StringValue(this.GrBody.Table[e].StatusID)&&"370"!=this.GrBody.Table[e].StatusID.toString()||(this.GrBody.Table.Remove(this.GrBody.Table[e]),e--)}else if(!this.IsPrepayment&&i.a.SessionManager.Preferences.ContainsKey("On")&&"True"==i.a.SessionManager.Preferences.On&&this.CredAcc.SelectedValue>0){let e=this.oparent.ScreenObject.IsBillWiseAccount(this.CredAcc.SelectedValue);null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&(c=!!Object(n.j)(e.Tables[0][0].IsBillwise),u=e.Tables[0][0].AccountCode.toString(),d=e.Tables[0][0].AccountName.toString(),c&&this.AdjustBills&&(h=this.oparent.ScreenObject.GetBillWiseDetails(this.CredAcc.SelectedValue,"",!0,"",0,null,this.oparent.DocumentDate)))}let D=0;if(this.oparent.IsInventoryVoucher&&!this.IsPrepayment||this.GenChqVis){l=parseFloat(this.Amount.Text)/parseFloat(this.NoofCheques.Text),this.oparent.IsInventoryVoucher&&(l=a.e.Round(l,parseInt(this.Dedimals)));let e=0;for(D=0;D<parseInt(this.NoofCheques.Text);D++)D>0&&(r=this.CheqStartDate.Date.AddMonths(o*D)),D==parseInt(this.NoofCheques.Text)-1&&(l=a.e.Round(parseFloat(this.Amount.Text)-e,parseInt(this.Dedimals))),e+=l,this.AddRows(d,u,l,D,0,r,c,h)}else{let s=2;var S=this.oparent.ScreenObject.ColumnSource.find(e=>"amount"==e.DisplayMember.toLowerCase());S&&""!=S.DecimalPoints&&(s=parseInt(S.DecimalPoints)),t+="<PrePaymentXML>";let i=0,n=0,o=parseFloat(this.Amount.Text)/(this.CheqEndDate.Date.Subtract(this.CheqStartDate.Date).Days+1);for("1"==this.Repeat.SelectedValue&&(n=this.CalculateMonths()>0?a.e.Round(parseFloat(this.Amount.Text)/this.CalculateMonths(),s):parseFloat(this.Amount.Text));r<=this.CheqEndDate.Date;){if(l=0==D?r.getMonth()==this.CheqEndDate.Date.getMonth()&&r.getFullYear()==this.CheqEndDate.Date.getFullYear()?parseFloat(this.Amount.Text):1==r.getDate()?"1"==this.Repeat.SelectedValue?n:a.e.Round(o*r.DaysInMonth(),s):a.e.Round(o*(r.DaysInMonth()-r.getDate()+1),s):r.AddMonths(1)>this.CheqEndDate.Date?parseFloat(this.Amount.Text)-i:"1"==this.Repeat.SelectedValue?n:a.e.Round(o*r.DaysInMonth(),s),i+=l,this.GenChqVis)this.AddRows(d,u,l,D,0,r,c,h);else{t+="<Row Date='"+r.ToString("dd/MMM/yyyy")+"' >";for(let e=0;e<this.GrBody.Table.length;e++)if(a.e.DoubleTryParse(this.GrBody.Table[e].Percentage)>0){let i=a.e.Double(this.GrBody.Table[e].Amount.toString())*(100/a.e.Double(this.Amount.Text));t+="<data ",this.DebitAcc.Visible?t+=" DebitAcc='"+this.DebitAcc.SelectedValue+"' ":this.GrBody.TableColumns.Contains("DebitAccount_Key")&&!a.e.StringIsNullOrEmpty(this.GrBody.Table[e].DebitAccount_Key)&&(t+=" DebitAcc='"+this.GrBody.Table[e].DebitAccount_Key.toString()+"' "),this.CredAcc.Visible?t+=" CredAcc='"+this.CredAcc.SelectedValue+"' ":this.GrBody.TableColumns.Contains("CreditAccount_Key")&&!a.e.StringIsNullOrEmpty(this.GrBody.Table[e].CreditAccount_Key)&&(t+=" CredAcc='"+this.GrBody.Table[e].CreditAccount_Key.toString()+"' "),t+=" Query='";for(let s=1;s<this.GrBody.Columns.length;s++)this.GrBody.Columns[s].DisplayMember.toLowerCase().Contains("dcccnid")&&!a.e.StringIsNullOrEmpty(this.GrBody.Table[e][this.GrBody.Columns[s].ValueMember])&&(t+=this.GrBody.Columns[s].DisplayMember+"="+this.GrBody.Table[e][this.GrBody.Columns[s].ValueMember].toString()+", ");if(t+="' ",a.e.StringIsNullOrEmpty(this.GrBody.Table[e].Detailsxml))t+=" Amount='"+a.e.Round(l*i/100,s)+"'  />";else{let n=new a.f;n.ReadXml(this.GrBody.Table[e].Detailsxml),n.Tables.length>0&&n.Columns[0].Contains("Amount")&&n.Tables[0].length>D&&!a.e.StringIsNullOrEmpty(n.Tables[0][D].Amount)?t+=" Amount='"+n.Tables[0][D].Amount.toString()+"'  />":t+=" Amount='"+a.e.Round(l*i/100,s)+"'  />"}}t+="</Row>"}r=0==D?r.AddDays(r.DaysInMonth()-r.getDate()+1):r.AddMonths(1),D++}e&&(t+=this.GetXML(!0)),t+="</PrePaymentXML>"}return t.toString()}CalculateMonths(){try{let e=0,t=0,s=this.CheqStartDate.Date;for(;this.CheqEndDate.Date>s;)0==e&&0==t?1==s.getDate()?(e++,s=s.AddMonths(1)):(t=s.DaysInMonth()-s.getDate()+1,s=s.AddDays(t)):(s=s.AddMonths(1),s>this.CheqEndDate.Date?s.AddMonths(-1).DaysInMonth()==this.CheqEndDate.Date.getDate()?e++:t+=this.CheqEndDate.Date.getDate():e++);return t>0&&(this.CheqStartDate.Date.iMonth()==this.CheqEndDate.Date.iMonth()||this.CheqStartDate.Date.getDate()==this.CheqEndDate.Date.getDate()+1?t==this.CheqStartDate.Date.DaysInMonth()||t==this.CheqEndDate.Date.DaysInMonth()?e++:e+=t/(new Date).DaysInMonth():1==this.CheqStartDate.Date.getDate()?t==this.CheqEndDate.Date.DaysInMonth()?e++:e+=t/this.CheqEndDate.Date.DaysInMonth():this.CheqEndDate.Date.getDate()==this.CheqEndDate.Date.DaysInMonth()?e+=t/this.CheqStartDate.Date.DaysInMonth():e+=t/30),e}catch(e){return 0}}AddRows(e,t,s,n,r,o,l,c){let h=(parseInt(this.FirstChequeNo.Text)+n).toString();if(this.FirstChequeNo.Text.length-h.length>0){let e=this.FirstChequeNo.Text.length-h.length,t="";for(let s=0;s<e;s++)t+="0";h=t+h}let u=null,d=null;this.oparent.IsInventoryVoucher?(d=this.GrBody.TableColumns,u=this.GrBody.NewRow()):(d=this.oparent.ScreenObject.GridDataColumns,u=this.oparent.ScreenObject.GridDataObj.NewRow()),this.oparent.IsInventoryVoucher?this.GrBody.TableColumns.Contains("DebitAccount_Key")&&this.DebitAcc.Visible?(u.DebitAccount_Key=this.DebitAcc.SelectedValue,this.GrBody.TableColumns.Contains("DebitAccount")&&(u.DebitAccount=this.DebitAcc.Text)):this.GrBody.TableColumns.Contains("CreditAccount_Key")&&this.CredAcc.Visible&&(u.CreditAccount_Key=this.CredAcc.SelectedValue,this.GrBody.TableColumns.Contains("CreditAccount")&&(u.CreditAccount=this.CredAcc.Text)):19==this.oparent.ScreenObject.DocumentType?(u.CreditAccount_Key=this.CredAcc.SelectedValue,this.oparent.ScreenObject.GridDataColumns.Contains("CreditAccount")?u.CreditAccount=e:this.oparent.ScreenObject.GridDataColumns.Contains("AccountName")&&(u.AccountName=e),this.oparent.ScreenObject.GridDataColumns.Contains("AccountCode")&&(u.AccountCode=t),this.oparent.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")?(u.DebitAccount_Key=this.DebitAcc.SelectedValue,this.oparent.ScreenObject.GridDataColumns.Contains("DebitAccount")&&(u.DebitAccount=this.DebitAcc.Text)):null!=this.oparent.ScreenObject.DebitAccount&&(this.oparent.ScreenObject.DebitAccount.SelectedValue=this.DebitAcc.SelectedValue)):14==this.oparent.ScreenObject.DocumentType&&(u.DebitAccount_Key=this.CredAcc.SelectedValue,this.oparent.ScreenObject.GridDataColumns.Contains("DebitAccount")?u.DebitAccount=e:this.oparent.ScreenObject.GridDataColumns.Contains("AccountName")&&(u.AccountName=e),this.oparent.ScreenObject.GridDataColumns.Contains("AccountCode")&&(u.AccountCode=t),this.oparent.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")?(u.CreditAccount_Key=this.DebitAcc.SelectedValue,this.oparent.ScreenObject.GridDataColumns.Contains("CreditAccount")&&(u.CreditAccount=this.DebitAcc.Text)):null!=this.oparent.ScreenObject.CreditAccount&&(this.oparent.ScreenObject.CreditAccount.SelectedValue=this.DebitAcc.SelectedValue)),u.ChequeBankName=this.PayeeBank.Visible?this.PayeeBank.Text:this.ChequeBankName.Text,u.ChequeNumber=h,u.Amount=s,d.Contains("ChequeDate")&&(u.ChequeDate=o.ToString(i.a.SessionManager.Preferences["Date Format"]),u.ChequeDate_Key=o),d.Contains("ChequeMaturityDate")&&(u.ChequeMaturityDate=o.ToString(i.a.SessionManager.Preferences["Date Format"]),u.ChequeMaturityDate_Key=o),u.Table.Rows.InsertAt(u,r+n),this.oparent.ScreenObject.UpdateSequence(),d.Contains("Type")&&(u.Type=l);let D="";19==this.oparent.ScreenObject.DocumentType?D="CreditAccount_Key":14==this.oparent.ScreenObject.DocumentType&&(D="DebitAccount_Key");var S=this.oparent.ScreenObject.ColumnSource.filter(e=>null!=e.ValueMember&&e.ValueMember.toLowerCase()==D.toLowerCase());if(S.length>0){let e;for(let t=0;t<S.length;t++){let s=S[t];e=this.oparent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&e.LocalReference==s.ID),e.length>0&&!a.e.StringIsNullOrEmpty(s.ValueMember)&&!a.e.StringIsNullOrEmpty(u[s.ValueMember])&&(0==n?this.oparent.ScreenObject.GetLinkReferenceData(parseInt(s.ID),this.oparent.DocumentID,parseInt(u[s.ValueMember]),Date.Today(),"",s.CostCenterID,u):e.forEach(e=>{var t=this.oparent.ScreenObject.ColumnSource.find(t=>t.ID==e.CostCenterColID);t&&(null!=t.DisplayMember&&d.Contains(t.DisplayMember)&&(u[t.DisplayMember]=u.Table.Rows[r][t.DisplayMember]),null!=t.ValueMember&&d.Contains(t.ValueMember)&&(u[t.ValueMember]=u.Table.Rows[r][t.ValueMember]),null!=t.ValueBinding&&d.Contains(t.ValueBinding)&&(u[t.ValueBinding]=u.Table.Rows[r][t.ValueBinding]))}))}}l&&this.AdjustBills&&this.FlllXml(c,s,u)}FlllXml(e,t,s){let n="";a.e.IntTryParse(this.oparent.ScreenObject.Preferences.DecimalsBillWise)>0?n=this.oparent.ScreenObject.Preferences.DecimalsBillWise:i.a.SessionManager.Preferences.ContainsKey("DecimalsinAmount")&&(n=i.a.SessionManager.Preferences.DecimalsinAmount);let r="";r+="<BillWise> ";for(let i=0;i<e.Tables[0].length&&!(t<=0);i++){let n=0;if(a.e.StringIsNullOrEmpty(e.Tables[0][i].Amount)||(n=parseFloat(e.Tables[0][i].Amount)),a.e.StringIsNullOrEmpty(e.Tables[0][i].Paid)||(n-=parseFloat(e.Tables[0][i].Paid)),n>0){let o=0;t>n?(o=n,t-=n,e.Tables[0][i].Paid=e.Tables[0][i].Amount):(o=t,e.Tables[0][i].Paid=parseFloat(e.Tables[0][i].Paid)+t,t=0),e.Columns[0].Contains("ExchgRate")&&null!=e.Tables[0][i].ExchgRate&&!a.e.StringIsNullOrEmpty(e.Tables[0][i].ExchgRate)&&"0"==e.Tables[0][i].ExchgRate.toString()&&(e.Tables[0][i].ExchgRate="1"),r+="<Row ",r+='DocSeqNo="'+s.DocSeqNo.toString()+'" ',r+='AccountID="'+this.CredAcc.SelectedValue.toString()+'" ',19==this.oparent.ScreenObject.DocumentType?(r+='AmountFC="-'+o+'" ',r+='AdjAmount="-'+o+'" ',r+='AdjExchRT="1" '):(r+='AmountFC="'+o+'" ',r+='AdjAmount="'+o+'" ',r+='AdjExchRT="1" '),r+='AdjCurrID="1" ',r+='IsNewReference="0" ',r+='RefDocNo="'+e.Tables[0][i].DocNo.toString()+'" ',r+='RefStatusID="'+e.Tables[0][i].StatusID.toString()+'" ',r+='RefDocSeqNo="'+e.Tables[0][i].DocSeqNo.toString()+'" ',a.e.StringIsNullOrEmpty(e.Tables[0][i].DocDate)||(r+='RefDocDate="'+new Date(e.Tables[0][i].DocDate).ToString("dd/MMM/yyyy")+'" '),a.e.StringIsNullOrEmpty(e.Tables[0][i].DocDueDate)||(r+='RefDocDueDate="'+new Date(e.Tables[0][i].DocDueDate).ToString("dd/MMM/yyyy")+'" '),r+='Narration="" ',r+='IsDocPDC="0" >',r+=" </Row>"}}if(t>0){let e;r+="<Row ",r+='DocSeqNo="'+s.DocSeqNo.toString()+'" ',r+='AccountID="'+this.CredAcc.SelectedValue.toString()+'" ',e=""!=n?t.ToString("N"+n):t.toString(),19==this.oparent.ScreenObject.DocumentType?(r+='AmountFC="-'+e+'" ',r+='AdjAmount="-'+e+'" '):(r+='AmountFC="'+e+'" ',r+='AdjAmount="'+e+'" '),r+='AdjCurrID="1" ',r+='AdjExchRT="1" ',r+='IsNewReference="1" ',r+='Narration="" ',r+='IsDocPDC="0" ',r+=" ></Row>"}r+=" </BillWise>",s.ExtraXML=r.toString()}}},sDFv:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var i=s("ouML"),a=s("Do2H"),n=s("vgHJ");class r{constructor(e,t,s,i,a,n){this.LeftVisible=!0,this.RightVisible=!0,this.IsApproved=!1,this.IsPending=!1,this.IsRejected=!1,this.IsSet=!1,this.BgColor="#fff",this.LeftLineBrush="#707070",this.RightLineBrush="#707070",this.LevelID=0,this.WID=0,this.ccid=0,this.DOcId=0,this.ClassName="WFLevelDoc",this.LevelID=t,this.WID=e,this.LevelName=s,this.ccid=i,this.DOcId=a,this.ccDate=n}OnButtonClick(e){if("Level"==e){let e=new i.DocumentDraftsViewModel(this,4);a.a.page.ShowDialog(e,n.DocumentDraftsComponent)}}}},utDZ:function(e,t,s){"use strict";s.d(t,"a",(function(){return u}));var i=s("mrSG"),a=s("ScVY"),n=s("ockk"),r=s("NkMH"),o=s("4HhE"),l=s("Do2H"),c=s("eQJW"),h=s("8B8H");class u extends a.b{constructor(e){super(),this.ColumnSpan="4",this.OrganizationDataObj=new h.a,this.Module="CRM",this.Visible=!0,this.cmnItem_Click=new o.b,this.AddOrganization=new o.b,this.res="",Logger.InfoLog("ViewDemoKitViewModel::Entering ViewDemoKitViewModel");try{this.ClassName="ViewOrganizationViewModel",this.Parent=e,this.CostCenterID=e.CostCenterID,this.cmnItem_Click.Subscribe(this,"OnCmnItem_Click"),this.AddOrganization.Subscribe(this,"OnAddOrganization");let s,i=l.a.crmService.GetFeedbackDetails(120),a=[];if(a=i.Tables[0],this.OrganizationDataObj.Table=[],this.OrganizationDataObj.TableColumns.push("Customer"),this.OrganizationDataObj.TableColumns.push("CustomerID"),this.OrganizationDataObj.TableColumns.push("ContactID"),this.OrganizationDataObj.TableColumns.push("ContactName"),this.OrganizationDataObj.TableColumns.push("JobTitle"),this.OrganizationDataObj.TableColumns.push("Department"),this.OrganizationDataObj.TableColumns.push("Salutation"),this.OrganizationDataObj.TableColumns.push("SalutationID"),73!=e.CostCenterID&&35!=e.DocumentType){this.OrganizationDataObj.TableColumns.push("CytomedDivision"),this.OrganizationDataObj.TableColumns.push("CytomedDivision_Key"),this.OrganizationDataObj.TableColumns.push("Territory"),this.OrganizationDataObj.TableColumns.push("Territory_Key"),this.OrganizationDataObj.TableColumns.push("City"),this.OrganizationDataObj.TableColumns.push("City_Key"),this.OrganizationDataObj.TableColumns.push("Country"),this.OrganizationDataObj.TableColumns.push("Country_Key");for(let e=1;e<=50;e++)this.OrganizationDataObj.TableColumns.push("Alpha"+e);for(let e=1;e<=50;e++)this.OrganizationDataObj.TableColumns.push("CCNID"+e),this.OrganizationDataObj.TableColumns.push("CCNID"+e+"_Key")}else this.OrganizationDataObj.TableColumns.push("MiddleName"),this.OrganizationDataObj.TableColumns.push("LastName"),this.OrganizationDataObj.TableColumns.push("Phone1"),this.OrganizationDataObj.TableColumns.push("Email1"),this.OrganizationDataObj.TableColumns.push("Phone2"),this.OrganizationDataObj.TableColumns.push("Email2"),this.OrganizationDataObj.TableColumns.push("Company"),this.OrganizationDataObj.TableColumns.push("Fax");if(this.OrganizationDataObj.Columns=[],s=new n.a,s.Header=l.a.GetResource("Customer"),s.DisplayMember="Customer",s.DataType="TEXTBOX",s.Width=150,s.IsVisible=73!=e.CostCenterID&&35!=e.DocumentType,s.ReadOnly=!0,this.ColumnSource.push(s),s=new n.a,s.Header=l.a.GetResource("ContactName"),s.DisplayMember="ContactName",s.DataType="TEXTBOX",s.Width=150,s.IsVisible=!0,s.ReadOnly=!0,this.ColumnSource.push(s),s=new n.a,s.Header=l.a.GetResource("JobTitle"),s.DisplayMember="JobTitle",s.DataType="TEXTBOX",s.Width=150,s.IsVisible=!0,s.ReadOnly=!0,this.ColumnSource.push(s),s=new n.a,s.Header=l.a.GetResource("Department"),s.DisplayMember="Department",s.DataType="TEXTBOX",s.Width=150,s.IsVisible=!0,s.ReadOnly=!0,this.ColumnSource.push(s),s=new n.a,s.Header=l.a.GetResource("Salutation"),s.DisplayMember="Salutation",s.DataType="TEXTBOX",s.Width=150,s.IsVisible=!0,s.ReadOnly=!0,this.ColumnSource.push(s),73!=e.CostCenterID&&35!=e.DocumentType){s=new n.a,s.Header=l.a.GetResource("CytomedDivision"),s.DisplayMember="CytomedDivision",s.DataType="TEXTBOX",s.Width=150,s.IsVisible=!0,s.ReadOnly=!0,this.ColumnSource.push(s),s=new n.a,s.Header=l.a.GetResource("Country"),s.DisplayMember="Country",s.DataType="TEXTBOX",s.Width=150,s.IsVisible=!0,s.ReadOnly=!0,this.ColumnSource.push(s),s=new n.a,s.Header=l.a.GetResource("City"),s.DisplayMember="City",s.DataType="TEXTBOX",s.Width=150,s.IsVisible=!0,s.ReadOnly=!0,this.ColumnSource.push(s),s=new n.a,s.Header=l.a.GetResource("Territory"),s.DisplayMember="Territory",s.DataType="TEXTBOX",s.Width=150,s.IsVisible=!0,s.ReadOnly=!0,this.ColumnSource.push(s);for(let e=0;e<a.length;e++)"True"==a.Rows[e].IsVisible.toString()&&a.Rows[e].SysColumnName.toString().Contains("Alpha")&&(s=new n.a,s.Header=a.Rows[e].UserColumnName.toString(),s.DisplayMember=a.Rows[e].SysColumnName.toString(),s.DataType="TEXTBOX",s.Width=150,s.IsVisible=!0,s.ReadOnly=!0,this.ColumnSource.push(s)),"True"==a.Rows[e].IsVisible.toString()&&a.Rows[e].SysColumnName.toString().Contains("CCNID")&&(s=new n.a,s.Header=a.Rows[e].UserColumnName.toString(),s.DisplayMember=a.Rows[e].SysColumnName.toString(),s.CostCenterID=parseInt(a.Rows[e].COLUMNCOSTCENTERID.toString()),s.TypeID=1,s.DataType="LISTBOX",s.DisplayMember=a.Rows[e].SysColumnName.toString(),s.ValueMember=a.Rows[e].SysColumnName.toString()+"_Key",s.Width=170,s.IsVisible=!0,s.ReadOnly=!0,this.ColumnSource.push(s))}else s=new n.a,s.Header="MiddleName",s.DisplayMember="MiddleName",s.DataType="TEXTBOX",s.Width=150,s.IsVisible=!0,s.ReadOnly=!0,this.ColumnSource.push(s),s=new n.a,s.Header="LastName",s.DisplayMember="LastName",s.DataType="TEXTBOX",s.Width=150,s.IsVisible=!0,s.ReadOnly=!0,this.ColumnSource.push(s);if(73!=e.CostCenterID&&35!=e.DocumentType&&null!=i&&i.Tables.length>7&&i.Columns[7].Contains("GRIDORDER")&&i.Tables[7].length>0){this.ColumnSource.forEach(e=>{if(null!=e){let t=i.Tables[7];t.RowFilter="SYSCOLUMNNAME=='"+e.DisplayMember+"'",t.length>0&&(e.DisplayIndex=null!=t[0].GRIDORDER&&""!=t[0].GRIDORDER.toString()?parseInt(t[0].GRIDORDER)-1:e.DisplayIndex,e.IsVisible=null!=t[0].Visible&&""!=t[0].Visible.toString()?Object(c.j)(t[0].Visible):e.IsVisible,e.Width=null!=t[0].Width&&""!=t[0].Width.toString()?parseInt(t[0].Width):e.Width)}});try{this.ColumnSource.sort((e,t)=>e.DisplayIndex-t.DisplayIndex).forEach(e=>{this.ColumnSource.push(e)})}catch(t){Logger.ErrorLog("ViewDemoKitViewModel:: ViewDemoKitViewModel"+t.stack)}}this.ButtonCustomize=new r.a,l.a.SessionManager.HideUnathorizedAccess&&(this.ButtonCustomize.Visible=l.a.SessionManager.IsActionAssigned(88,"Customize_Organizer"))}catch(t){Logger.ErrorLog("ViewDemoKitViewModel:: ViewDemoKitViewModel"+t.stack)}Logger.InfoLog("ViewDemoKitViewModel::Exiting ViewDemoKitViewModel")}get OrganizationData(){return this.OrganizationDataObj.Table}get angularGrid(){return this.OrganizationDataObj.angularGrid}get ColumnSource(){return this.OrganizationDataObj.Columns}ViewOrganizationViewModel_1(){}OnAddOrganization(e){return Object(i.b)(this,void 0,void 0,(function*(){if(null==e&&(e=""),null!=e)if("Search"==e.toString()){const{SearchContactComponent:e}=yield s.e(0).then(s.bind(null,"r9vo")),{SearchContactViewModel:t}=yield s.e(110).then(s.bind(null,"86Y6"));let i=new t(this);l.a.page.ShowDialog(i,e,{ShowCenter:!0,HideHeader:!0})}else e.toString();if((73==this.Parent.CostCenterID||35==this.Parent.DocumentType)&&null!=this.Parent){const{CasesContactComponent:e}=yield s.e(0).then(s.bind(null,"7Mi5")),{CasesContactViewModel:t}=yield Promise.resolve().then(s.bind(null,"+ryo"));this.Parent.CasesContactVisibility=!0;let i=new t(this,null);l.a.page.ShowDialog(i,e,{ShowCenter:!0,HideHeader:!1})}}))}OnCmnItem_Click(e){switch(Logger.InfoLog("ViewDemoKitViewModel::Entering OnCmnItem_Click"),e){case"Customize":break;case"EDIT":if((73==this.Parent.CostCenterID||35==this.Parent.DocumentType)&&null!=this.SelectedRow){null!=this.Parent.CasesContactViewModel&&(this.Parent.CasesContactViewModel.CasesContactVisibility=!0);let e=this.SelectedRow;""!=e.CustomerID.toString()&&(this.Parent.CasesContactViewModel.Contact.Text="",this.Parent.CasesContactViewModel.FirstName.Text=e.ContactName.toString(),this.Parent.CasesContactViewModel.MiddleName.Text=e.MiddleName.toString(),this.Parent.CasesContactViewModel.LastName.Text=e.LastName.toString(),this.Parent.CasesContactViewModel.JobTitle.Text=e.JobTitle.toString(),this.Parent.CasesContactViewModel.Dept.Text=e.Department.toString(),this.Parent.CasesContactViewModel.Salutation.SelectedValue=e.SalutationID.toString(),this.Parent.CasesContactViewModel.Company.Text=e.Company.toString(),this.Parent.CasesContactViewModel.Phone1.Text=e.Phone1.toString(),this.Parent.CasesContactViewModel.Email1.Text=e.Email1.toString(),this.Parent.CasesContactViewModel.Phone2.Text=e.Phone2.toString(),this.Parent.CasesContactViewModel.Email2.Text=e.Email2.toString(),this.Parent.CasesContactViewModel.Fax.Text=e.Fax.toString())}break;case"DELETE":if(null!=this.SelectedRow){if(""!=this.SelectedRow.ContactID.toString()){var t=this.lstContacts.find(e=>e.toString()==this.SelectedRow.ContactID.toString());null!=t&&this.lstContacts.Remove(t)}this.OrganizationDataObj.removeRowAt(this.SelectedRow)}}Logger.InfoLog("ViewDemoKitViewModel::Exiting OnCmnItem_Click")}OnMessageCallBack(){this.res="Yes"}onCanCmnItem_Click(e){return!0}GetXML(){Logger.InfoLog("ViewDemoKitViewModel::Entering GetXML");try{let e="";e+="<XML>";for(let t=0;t<this.OrganizationData.length;t++)if(""!=this.OrganizationData[t].Customer.toString()||""!=this.OrganizationData[t].CustomerID.toString()){if(e+="<Row ",e+=' Rowno="'+t+'"',e+=' Customer="'+this.GetValidXml(this.OrganizationData[t].Customer.toString())+'"',e+=' CustomerID="'+this.OrganizationData[t].CustomerID+'"',e+=' ContactID="'+this.OrganizationData[t].ContactID+'"',e+=' ContactName="'+this.GetValidXml(this.OrganizationData[t].ContactName.toString())+'"',e+=' JobTitle="'+this.GetValidXml(this.OrganizationData[t].JobTitle.toString())+'"',e+=' Department="'+this.GetValidXml(this.OrganizationData[t].Department.toString())+'"',e+=' SalutationID="'+this.GetValidXml(this.OrganizationData[t].SalutationID.toString())+'"',73!=this.Parent.CostCenterID&&35!=this.Parent.DocumentType){e+=' Country="'+this.GetValidXml(this.OrganizationData[t].Country_Key.toString())+'"',e+=' City="'+this.GetValidXml(this.OrganizationData[t].City_Key.toString())+'"',e+=' CytomedDivision="'+this.GetValidXml(this.OrganizationData[t].CytomedDivision_Key.toString())+'"',e+=' Territory="'+this.GetValidXml(this.OrganizationData[t].Territory_Key.toString())+'"';for(let s=1;s<=50;s++)e+=" Alpha"+s+'="'+this.GetValidXml(this.OrganizationData[t]["Alpha"+s].toString())+'"';for(let s=1;s<=50;s++)null!=this.OrganizationData[t]["CCNID"+s+"_Key"]&&""!=this.OrganizationData[t]["CCNID"+s+"_Key"].toString()?e+=" CCNID"+s+'="'+this.OrganizationData[t]["CCNID"+s+"_Key"].toString()+'"':e+=" CCNID"+s+'="1"'}else e+=' Company="'+this.GetValidXml(this.OrganizationData[t].Company.toString())+'"',e+=' Phone1="'+this.GetValidXml(this.OrganizationData[t].Phone1.toString())+'"',e+=' Email1="'+this.GetValidXml(this.OrganizationData[t].Email1.toString())+'"',e+=' Phone2="'+this.GetValidXml(this.OrganizationData[t].Phone2.toString())+'"',e+=' Email2="'+this.GetValidXml(this.OrganizationData[t].Email2.toString())+'"',e+=' Fax="'+this.GetValidXml(this.OrganizationData[t].Fax.toString())+'"',e+=' FirstName="'+this.GetValidXml(this.OrganizationData[t].ContactName.toString())+'"',e+=' LastName="'+this.GetValidXml(this.OrganizationData[t].LastName.toString())+'"',e+=' MiddleName="'+this.GetValidXml(this.OrganizationData[t].MiddleName.toString())+'"',"0"==this.OrganizationData[t].ContactID.toString()?e+=' Action="NEW"':e+=' Action="MODIFY"';e+="></Row>  "}return e+="</XML>",35==this.Parent.DocumentType?e.toString().Replace("XML","ContactXML"):e.toString()}catch(e){return""}Logger.InfoLog("ViewDemoKitDataViewModel::Exiting GetXML")}GetValidXml(e){return(e=(e=(e=e.Replace("&","&amp;")).Replace("'","&apos;&apos;")).Replace('"',"&quot;")).Replace("<","&lt;")}GetValidXmlReserve(e){return(e=(e=(e=e.Replace("&amp;","&")).Replace("''","'")).Replace("&quot;",'"')).Replace("&lt;","<")}LoadData(e){try{for(let t=0;t<e.length;t++){let s=this.OrganizationDataObj.NewRow();if(this.lstContacts.push(null!=e[t].ContactID&&""!=e[t].ContactID.toString()?parseInt(e.Rows[t].ContactID.toString()):0),s.ContactID=e[t].ContactID.toString(),s.ContactName=e[t].ContactName.toString(),s.JobTitle=e[t].JobTitle.toString(),s.Department=e[t].Department.toString(),s.CustomerID=e[t].CustomerID.toString(),s.Customer=e[t].Customer.toString(),s.Salutation=e[t].SalutationName.toString(),s.SalutationID=e[t].Salutation.toString(),73!=this.Parent.CostCenterID&&35!=this.Parent.DocumentType){s.Country=e[t].Co.toString(),s.City=e[t].Ci.toString(),s.CytomedDivision=e[t].D.toString(),s.Territory=e[t].T.toString(),s.Country_Key=e[t].Country.toString(),s.City_Key=e[t].City.toString(),s.CytomedDivision_Key=e[t].CytomedDivision.toString(),s.Territory_Key=e[t].Territory.toString();for(let i=1;i<=50;i++)s["Alpha"+i]=this.GetValidXmlReserve(e[t]["Alpha"+i].toString());for(let i=1;i<=50;i++)"1"!=e[t]["CCNID"+i].toString()&&(s["CCNID"+i]=this.GetValidXmlReserve(e.Rows[t]["NAME"+i].toString()),s["CCNID"+i+"_Key"]=e[t]["CCNID"+i].toString())}else s.Salutation=e[t].Salutation.toString(),s.SalutationID=e[t].SalutationID.toString(),s.MiddleName=e[t].MiddleName.toString(),s.LastName=e[t].LastName.toString(),s.Company=e[t].Company.toString(),s.Email1=e[t].Email1.toString(),s.Email2=e[t].Email2.toString(),s.Phone1=e[t].Phone1.toString(),s.Phone2=e[t].Phone2.toString(),s.Fax=e[t].Fax.toString();this.OrganizationDataObj.addRows(s)}}catch(t){}}}},ybar:function(e,t,s){"use strict";s.d(t,"a",(function(){return l}));var i=s("Do2H"),a=s("Lp6j"),n=s("ScVY"),r=s("ZDA+"),o=s("6z9j");class l extends n.b{constructor(){super(...arguments),this.WhereString="",this.PickerType="",this.TreeVisibility=!1}Refresh(){null!=this.tree&&this.tree.length>0&&(this.tree[0].RefreshData=!0)}GetSeqNosList(){if(null==this.SelectedNodes)return"";let e="";return this.SelectedNodes.forEach(t=>{e+=t.Id+","}),e.length>0?e=e.Remove(e.length-1,1):e+=0,e.toString()}SearchPickerViewModel_2(e,t){this.SearchPickerViewModel(e,t,"","","")}SearchPickerViewModel_3(e,t,s){this.SearchPickerViewModel(e,t,s,"","")}SearchPickerViewModel_4(e,t,s,i){this.SearchPickerViewModel(e,t,s,i,"")}SearchPickerViewModel(e,t,s,n,l){if(this.PickerType=t,this.ViewModel=e,"PRODUCTS"==t)this.TreeCCID=3,this.TreeID=20;else if("ACCOUNTS"==t)this.TreeCCID=2,this.TreeID=126;else if("CUSTOMERS"==t)this.TreeCCID=51,this.TreeID=141;else if("PACKAGE"==t)this.TreeCCID=62,this.TreeID=160;else if("REPORTS"==t)this.TreeCCID=200,this.TreeID=267;else if("DOCUMENTS"==t)this.TreeCCID=300,this.TreeID=410;else if("units"==t)this.TreeCCID=93,this.TreeID=262;else if("COSTCENTER"==t){this.TreeCCID=parseInt(s),s=n;let e=i.a.common.GetCostCenterGridViewList(this.TreeCCID,!1),t=e.Tables[0];if(t=t.filter(e=>0==e.IsUserDefined),t.length>0)this.TreeID=parseInt(t[0].GridViewID);else{if(!(e.Tables[0].length>0))return void i.a.page.HideDialog();this.TreeID=parseInt(e.Tables[0][0].GridViewID)}}else if(t.startsWith("PRODUCTGROUPS")){this.TreeCCID=3;let e=t.split("~");this.TreeID=parseInt(e[1]),s="A.IsGroup=1"}let c=[];if(""!=l){let e=l.split(",");for(let t=0;t<e.length;t++){let s;if(s=a.e.IntTryParse(e[t]),s){let s=new r.a;s.Id=parseInt(e[t]),c.push(s)}}}this.tree=[];let h=new o.a;h.TreeViewModel_6(this.TreeCCID,this,this.TreeID,s,c,""),h.HeaderVisiblity=!1,h.ViewsVisible=!1,this.tree.push(h),this.ViewModel=this.ViewModel,this.MessageVisibility=!1}CommandController(e){null!=e&&"MouseDoubleClick"==e.toString()&&null!=this.SelectedNode&&(this.SelectedNode.IsGroup||(null==this.SelectedNodes?this.SelectedNodes=[]:this.SelectedNodes.Clear(),this.SelectedNodes.push(this.SelectedNode),i.a.page.HideDialog(),this.ViewModel.ParentCallBack(this)))}OnOkClick(e){i.a.page.HideDialog(),this.ViewModel.ParentCallBack(this)}OnCancelClick(e){i.a.page.HideDialog()}}}}]);
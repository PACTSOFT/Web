(window.webpackJsonp=window.webpackJsonp||[]).push([[165],{"An9+":function(e,t,a){"use strict";a.r(t),a.d(t,"GradeWiseSlabsViewModel",(function(){return u}));var i=a("Do2H"),l=a("Lp6j"),s=a("ScVY"),o=a("8B8H"),n=a("n56n"),d=a("JIg3"),r=a("ockk"),g=a("0/4Q"),h=a("EQd/");class u extends s.b{constructor(e){super(),this.DialogResult=!1,this.plvGrade=new n.b(0),this.dtpWEF=new d.a(0),Logger.InfoLog("GradeWiseSlabsViewModel::Entering GradeWiseSlabsViewModel()"),this.DisplayMessage="",this.plvGrade.SetTimeToZero(),this.plvGrade.OnPactListBoxValueChanged.Subscribe(this,"plvGrade_SelectedValueChanged"),this.dtpWEF.CustomFormat="MMM/yyyy",this.dtpWEF.Date=i.a.SessionManager.PayrollMonth,this.dtpWEF.Label="With Effect From",this.plvGrade.Label="Grade",this.plvGrade.TypeID=1,this.plvGrade.CCID=50053,this.LoadGrid(),e>0&&(this.plvGrade.SelectedValue=e,this.plvGrade_SelectedValueChanged(this.plvGrade)),Logger.InfoLog("GradeWiseSlabsViewModel::Exiting GradeWiseSlabsViewModel()")}plvGrade_SelectedValueChanged(e){try{if(Logger.InfoLog("GradeWiseSlabsViewModel::Entering plvGrade_SelectedValueChanged()"),this.DisplayMessage="",this.plvGrade.SelectedValue>0){let e=this.plvGrade.SelectedValue;try{let t=i.a.empService.GetQueryData(0,"EGS001",e,"","");if(this.dgv.Clear(),null!=t&&t.length>0){let e;this.dtpWEF.Date=new Date(t[0].WEF.toString());for(let a=0;a<t.length;a++)e=this.dgv.NewRow(),e.ComponentName_Key=t[a].ComponentID,e.ComponentName=t[a].ComponentName,e.MinAmount=t[a].MinAmount,e.MaxAmount=t[a].MaxAmount,e.ApplicableFormula=t[a].ApplicableFormula,e.AlertType=t[a].AlertType,this.dgv.addRow(e);this.RefreshSno()}else this.dgv.addRow(this.dgv.NewRow())}catch(t){return this.DisplayMessage=t.Message,this.MessageVisibility=!0,void Logger.ErrorLog("GradeWiseSlabsViewModel::EXCEPTION plvGrade_SelectedValueChanged()"+t.Message)}}Logger.InfoLog("GradeWiseSlabsViewModel::Exiting plvGrade_SelectedValueChanged()")}catch(t){Logger.ErrorLog("GradeWiseSlabsViewModel::EXCEPTION plvGrade_SelectedValueChanged()"+t.stack)}}LoadGrid(){Logger.InfoLog("GradeWiseSlabsViewModel::Entering LoadGrid()"),this.dgv=new o.a,this.dgv.CanUserAddRows=!0,this.dgv.CanUserSortColumns=!1,this.dgv.Columns=[],this.dgv.Width="700";let e,t=new r.a;t.Header="#",t.DisplayMember="sno",t.ID="sno",t.Width=40,t.ReadOnly=!0,t.TextAlign="Center",this.dgv.Columns.push(t),t=new r.a,t.Header="Component Name",t.DisplayMember="ComponentName",t.DataType="LISTBOX",t.CostCenterID=50052,t.FilterCondition="",t.TypeID=10,t.Width=150,this.dgv.Columns.push(t),t=new r.a,t.Header="Min. Amount",t.DisplayMember="MinAmount",t.ID="MinAmount",t.Width=90,t.ReadOnly=!1,t.DataType="FLOAT",t.DefaultValue="0",this.dgv.Columns.push(t),t=new r.a,t.Header="Max. Amount",t.DisplayMember="MaxAmount",t.ID="MaxAmount",t.Width=90,t.ReadOnly=!1,t.DataType="FLOAT",t.DefaultValue="0",this.dgv.Columns.push(t),t=new r.a,t.Header="Applicable Formula",t.DisplayMember="ApplicableFormula",t.DataType="TextBlock",t.Width=200,this.dgv.Columns.push(t),t=new r.a,t.Header="Alert Type",t.ValueBinding="AlertType",t.DataType="ComboBox",t.DisplayMember="Name",t.ValueMember="Value",t.Width=100,e=new Array,e.push(g.d.ComboBoxItems_2("Stop","Stop")),e.push(g.d.ComboBoxItems_2("Warn","Warn")),t.ComboData=e,t.DefaultValue="Stop",this.dgv.Columns.push(t),this.dgv.Table=[],this.dgv.TableNewRow.Subscribe(this,"dgv_RowAdded"),this.dgv.RowDeleted.Subscribe(this,"dgv_RowDeleted"),this.dgv.TableColumns.push("sno"),this.dgv.TableColumns.push("ComponentName"),this.dgv.TableColumns.push("ComponentName_Key"),this.dgv.TableColumns.push("MinAmount"),this.dgv.TableColumns.push("MaxAmount"),this.dgv.TableColumns.push("ApplicableFormula"),this.dgv.TableColumns.push("AlertType"),this.dgv.Clear(),this.dgv.addRow(this.dgv.NewRow()),this.RefreshSno(),Logger.InfoLog("GradeWiseSlabsViewModel::Exiting LoadGrid()")}dgv_RowAdded(e){this.RefreshSno()}dgv_RowDeleted(e){this.RefreshSno()}RefreshSno(){if(!this.dgv.TableColumns.Contains("sno"))return;let e=1;this.dgv.Table.forEach(t=>{t.sno=e,e++,this.dgv.updateRow(t)})}Button_Click(e){Logger.InfoLog("GradeWiseSlabsViewModel::Entering Button_Click"),"OK"==e.toString()?this.Save_Click():"Clear"==e.toString()?(this.plvGrade.SelectedValue=0,this.Clear_Click()):"Cancel"==e.toString()&&i.a.page.HideDialog(),Logger.InfoLog("GradeWiseSlabsViewModel::Exiting Button_Click")}Clear_Click(){this.dtpWEF.Date=new Date((new Date).getFullYear(),(new Date).getMonth(),1),this.dgv.Clear(),this.dgv.addRow(this.dgv.NewRow())}Save_Click(){if(Logger.InfoLog("GradeWiseSlabsViewModel::Entering Save_Click"),this.ValidateSave())try{this.dgv.commitEdit();let e="";for(let t=0;t<this.dgv.Table.length;t++)l.e.IsEmpty(this.dgv.Table[t].ComponentName_Key)||(e+='<Row SNo="'+t+'1"',e+=' ComponentID="'+this.dgv.Table[t].ComponentName_Key.toString()+'"',e+=' MinAmount="'+l.e.String(this.dgv.Table[t].MinAmount)+'"',e+=' MaxAmount="'+l.e.String(this.dgv.Table[t].MaxAmount)+'"',e+=' AlertType="'+l.e.String(this.dgv.Table[t].AlertType)+'"',l.e.IsEmpty(this.dgv.Table[t].ApplicableFormula)?e+=' ApplicableFormula=""':e+=' ApplicableFormula="'+h.d.GetValidXml(this.dgv.Table[t].ApplicableFormula.toString())+'"',e+="/>");if(e.length>0){e="<Rows> "+e+"</Rows>";let t=[];t.push(this.plvGrade.SelectedValue),t.push(new Date(this.dtpWEF.Date.getFullYear(),this.dtpWEF.Date.getMonth(),1)),t.push(e.toString()),t.push(i.a.SessionManager.UserName);let a=i.a.empService.ExecuteQueryPost_SP(t,"spPAY_SetGradeWiseSalarySlabs");parseInt(a.Tables[0][0][Object.keys(a.Tables[0][0])[0]])>0&&(this.DisplayMessage="Record Saved Successfully.",this.MessageVisibility=!0,this.Clear_Click())}}catch(e){return Logger.ErrorLog("GradeWiseSlabsViewModel::EXCEPTION Save_Click()"+e.stack),this.DisplayMessage=e.Message,void(this.MessageVisibility=!0)}Logger.InfoLog("GradeWiseSlabsViewModel::Exiting Save_Click")}ValidateSave(){if(0==this.plvGrade.SelectedValue)return this.DisplayMessage="Select any Grade",this.plvGrade.SetFocus=!0,this.MessageVisibility=!0,!1;let e=0;if(this.dgv.Table.length>0){for(let e=0;e<this.dgv.Table.length;e++)if(null!=this.dgv.Table[e].ComponentName_Key&&null!=this.dgv.Table[e].ComponentName_Key){if(null==this.dgv.Table[e].MinAmount||null==this.dgv.Table[e].MinAmount)return this.DisplayMessage="Enter Min. Amount at Row No : "+(e+1),this.MessageVisibility=!0,!1;if(null==this.dgv.Table[e].MaxAmount||null==this.dgv.Table[e].MaxAmount)return this.DisplayMessage="Enter Max. Amount at Row No : "+(e+1),this.MessageVisibility=!0,!1;if(null==this.dgv.Table[e].AlertType||null==this.dgv.Table[e].AlertType)return this.DisplayMessage="Select any Alert Type at Row No : "+(e+1),this.MessageVisibility=!0,!1}for(let t=0;t<this.dgv.Table.length;t++)null!=this.dgv.Table[t].ComponentName_Key&&null!=this.dgv.Table[t].ComponentName_Key&&""!=this.dgv.Table[t].ComponentName_Key.toString().Trim()&&null!=this.dgv.Table[t].MinAmount&&null!=this.dgv.Table[t].MinAmount&&""!=this.dgv.Table[t].MinAmount.toString().Trim()&&null!=this.dgv.Table[t].MaxAmount&&null!=this.dgv.Table[t].MaxAmount&&""!=this.dgv.Table[t].MaxAmount.toString().Trim()&&null!=this.dgv.Table[t].AlertType&&null!=this.dgv.Table[t].AlertType&&""!=this.dgv.Table[t].AlertType.toString().Trim()&&e++;if(0==e)return this.DisplayMessage="Enter atleast one detail",this.MessageVisibility=!0,!1}return!0}}}}]);
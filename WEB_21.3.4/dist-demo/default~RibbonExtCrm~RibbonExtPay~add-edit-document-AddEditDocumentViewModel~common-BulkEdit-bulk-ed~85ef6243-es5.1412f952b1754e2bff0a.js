function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var a=0;a<e.length;a++){var s=e[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function _createClass(t,e,a){return e&&_defineProperties(t.prototype,e),a&&_defineProperties(t,a),t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _createSuper(t){var e=_isNativeReflectConstruct();return function(){var a,s=_getPrototypeOf(t);if(e){var i=_getPrototypeOf(this).constructor;a=Reflect.construct(s,arguments,i)}else a=s.apply(this,arguments);return _possibleConstructorReturn(this,a)}}function _possibleConstructorReturn(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}(window.webpackJsonp=window.webpackJsonp||[]).push([[20,215,216],{BJEe:function(t,e,a){"use strict";a.d(e,"a",(function(){return m}));var s=a("Do2H"),i=a("Lp6j"),l=a("eQJW"),n=a("MRsC"),r=a("8B8H"),o=a("ockk"),d=a("uMy8"),h=a("vTM8"),c=a("0/4Q"),u=a("ScVY"),D=a("n56n"),p=a("EQd/"),g=a("JIg3"),m=function(t){_inherits(a,t);var e=_createSuper(a);function a(t,l,n,r){var o;_classCallCheck(this,a),(o=e.call(this)).Title="",o.EmployeeList=new D.b(0),o.BasicMonthly=new p.d(0),o.NextAppraisal=new g.a(0),o.NetSalary=new p.d(0),o.EffectFrom=new g.a(0),o.ActAppraisalFrom=new g.a(0),o.Reason=new p.d(0),o.Remarks=new p.d(0),o.AppraisalType=new c.e(0),o.NodeID=0,o.EditSeqNo=0,o.dsData=null,o.dtDOConfirm=new Date,o.sEmpCode="",o.sEmpName="",o.dtNextAppraisalDate=null,o.sFilter="",o.sDecimalsAmount="N"+s.a.SessionManager.Preferences.DecimalsinAmount,o.isFromBulkAppraisals=!1,o.sBulkAppraisalGrade="0",o.dsMPDocView=null,o.fldDict=new h.a,o.dServiceDays=0,o.dvDependentInfo=null,o.dvApprisal=null,o.webtotEarnings=0,o.webtotDeductions=0,o.dsPayStructure=null,o.dtGrSalSalbs=null,o.oEvalPayFormulas=null,o.strUpdate="",Logger.InfoLog("AddEditAppraisalViewModel::Entering AddEditAppraisalViewModel"),null!=t&&(o.Parent=t,o.Parent.Opacity=.3),o.BasicMonthly.LostFocusCommand.Subscribe(_assertThisInitialized(o),"BasicMonthly_LostFocus"),o.EffectFrom.SelectedDateChanged.Subscribe(_assertThisInitialized(o),"EffectFrom_DateChanged"),o.ActAppraisalFrom.SelectedDateChanged.Subscribe(_assertThisInitialized(o),"ActAppraisalFrom_DateChanged"),o.NextAppraisal.SelectedDateChanged.Subscribe(_assertThisInitialized(o),"NextAppraisal_DateChanged"),o.NodeID=l,o.EditSeqNo=r,o.EmployeeList.CCID=50051,o.EmployeeList.TypeID=1,o.EmployeeList.SelectedValue=l,o.EmployeeList.Enable=!1,o.EmployeeList.Label="Employee",o.BasicMonthly.Text="0.00",o.BasicMonthly.Label="Basic",o.NetSalary.Text="0.00",null!=n&&(o.EffectFrom.Date=n),o.ActAppraisalFrom.Date=o.EffectFrom.Date,o.dtNextAppraisalDate=n,o.dsData=s.a.empService.GetQueryData(o.NodeID,"APP001",s.a.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy"),"","");var d=s.a.empService.LoadStructure_1(s.a.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy"),o.sFilter);null!=d&&d.Tables.length>0&&(o.dvCCData=d.Tables[0]);var u=s.a.empService.GetQueryData(0,"dvDimsData","","","");return null!=u&&null!=u&&(o.dvDimsData=u),null!=o.dsData&&o.dsData.Tables.length>0&&(o.dsData.Tables[0].length>0&&(o.sEmpCode=o.dsData.Tables[0][0].Code.toString(),o.sEmpName=o.dsData.Tables[0][0].Name.toString(),o.dtDateOfJoining=new Date(o.dsData.Tables[0][0].DateOfJoining),o.dtDOConfirm=new Date(o.dsData.Tables[0][0].CDOC),o.dServiceDays=i.e.GetDateDifference(o.EffectFrom.Date,o.dtDateOfJoining)+1,null!=n&&(o.NextAppraisal.Date=n.Value)),o.dsData.Tables[1].length>0&&(o.drc=o.dsData.Tables[1].filter((function(t){return"dcAlpha1"==t.SysColumnName})),null!=o.drc&&o.drc.length>0&&(o.EffectFrom.Label=o.drc[0].ResourceData.toString()),o.drc=o.dsData.Tables[1].filter((function(t){return"dcAlpha2"==t.SysColumnName})),null!=o.drc&&o.drc.length>0&&(o.ActAppraisalFrom.Label=o.drc[0].ResourceData.toString()),o.drc=o.dsData.Tables[1].filter((function(t){return"dcAlpha3"==t.SysColumnName})),null!=o.drc&&o.drc.length>0&&(o.Title=o.drc[0].ResourceData.toString()),o.drc=o.dsData.Tables[1].filter((function(t){return"dcAlpha4"==t.SysColumnName})),null!=o.drc&&o.drc.length>0&&(o.NextAppraisal.Label=o.drc[0].ResourceData.toString()),o.drc=o.dsData.Tables[1].filter((function(t){return"dcAlpha5"==t.SysColumnName})),null!=o.drc&&o.drc.length>0&&(o.AppraisalType.Label=o.drc[0].ResourceData.toString()),o.drc=o.dsData.Tables[1].filter((function(t){return"dcAlpha6"==t.SysColumnName})),null!=o.drc&&o.drc.length>0&&(o.Reason.Label=o.drc[0].ResourceData.toString()),o.drc=o.dsData.Tables[1].filter((function(t){return"dcAlpha7"==t.SysColumnName})),null!=o.drc&&o.drc.length>0&&(o.Remarks.Label=o.drc[0].ResourceData.toString())),c.e.FillComboWithDefaultOption_3(o.dsData.Tables[3],o.AppraisalType,!0),o.AppraisalType.Visible=!(!s.a.SessionManager.Preferences.ContainsKey("ShowApprslTypeLookUpFldsInApprPopup")||"True"!=s.a.SessionManager.Preferences.ShowApprslTypeLookUpFldsInApprPopup)),o.LoadGrids(),o.CheckViewForUser(0),Logger.InfoLog("AddEditAppraisalViewModel::Exiting AddEditAppraisalViewModel"),o}return _createClass(a,[{key:"SetDateToFirst",value:function(t){t.Date=new Date(t.Date.Year,t.Date.Month,1)}},{key:"CheckViewForUser",value:function(t){var e=this;if(this.dsMPDocView=s.a.common.GetScreenInfo(50051),null!=this.dsMPDocView&&this.dsMPDocView.Tables.length>3&&this.dsMPDocView.Tables[this.dsMPDocView.Tables.length-2].length>0){for(var a,i=function(t){null!=e.dgvEarnings.Table[t].EarSNo&&null!=e.dgvEarnings.Table[t].EarSNo&&""!=e.dgvEarnings.Table[t].EarSNo.toString()&&(null!=(a=e.dsMPDocView.Tables[e.dsMPDocView.Tables.length-2].filter((function(a){return a.CostCenterColID==3e6+parseInt(e.dgvEarnings.Table[t].EarComponentID)})))&&a.length>0&&(e.dgvEarnings.Table[t].IsVisible="FALSE"==a[0].IsVisible.toString().toUpperCase()?"False":"True","FALSE"==a[0].IsEditable.toString().toUpperCase()&&(e.dgvEarnings.Table[t].Earnings_GRAY="1",e.dgvEarnings.Table[t].EarValue_GRAY="1")))},n=0;n<this.dgvEarnings.Table.length;n++)i(n);for(var r=function(t){null!=e.dgvDeductions.Table[t].DedSNo&&null!=e.dgvDeductions.Table[t].DedSNo&&""!=e.dgvDeductions.Table[t].DedSNo.toString()&&(null!=(a=e.dsMPDocView.Tables[e.dsMPDocView.Tables.length-2].filter((function(a){return a.CostCenterColID==3e6+parseInt(e.dgvDeductions.Table[t].DedComponentID)})))&&a.length>0&&(e.dgvDeductions.Table[t].IsVisible="FALSE"==a[0].IsVisible.toString().toUpperCase()?"False":"True","FALSE"==a[0].IsEditable.toString().toUpperCase()&&(e.dgvDeductions.Table[t].Deductions_GRAY="1",e.dgvDeductions.Table[t].DedValue_GRAY="1")))},o=0;o<this.dgvDeductions.Table.length;o++)r(o);if(0==this.dgvEarnings.Table.filter((function(t){return"False"!=t.IsVisible})).length){var d=this.dgvEarnings.NewRow();this.dgvEarnings.addRow(d)}if(0==this.dgvDeductions.Table.filter((function(t){return"False"!=t.IsVisible})).length){var h=this.dgvDeductions.NewRow();this.dgvDeductions.addRow(h)}this.drc=this.dsMPDocView.Tables[this.dsMPDocView.Tables.length-2].filter((function(t){return"CEffectFrom"==t.SysColumnName})),null!=this.drc&&this.drc.length>0&&(this.EffectFrom.Visible=Object(l.j)(this.drc[0].IsVisible.toString())),this.drc=this.dsMPDocView.Tables[this.dsMPDocView.Tables.length-2].filter((function(t){return"CApplyFrom"==t.SysColumnName})),null!=this.drc&&this.drc.length>0&&(this.ActAppraisalFrom.Visible=Object(l.j)(this.drc[0].IsVisible.toString())),this.drc=this.dsMPDocView.Tables[this.dsMPDocView.Tables.length-2].filter((function(t){return"NextAppraisalDate"==t.SysColumnName})),null!=this.drc&&this.drc.length>0&&(this.NextAppraisal.Visible=Object(l.j)(this.drc[0].IsVisible.toString())),this.drc=this.dsMPDocView.Tables[this.dsMPDocView.Tables.length-2].filter((function(t){return"BasicMonthly"==t.SysColumnName})),null!=this.drc&&this.drc.length>0&&(this.BasicMonthly.Visible=Object(l.j)(this.drc[0].IsVisible.toString())),this.drc=this.dsMPDocView.Tables[this.dsMPDocView.Tables.length-2].filter((function(t){return"NetSalary"==t.SysColumnName})),null!=this.drc&&this.drc.length>0&&(this.NetSalary.Visible=Object(l.j)(this.drc[0].IsVisible.toString())),this.drc=this.dsMPDocView.Tables[this.dsMPDocView.Tables.length-2].filter((function(t){return"Reason"==t.SysColumnName})),null!=this.drc&&this.drc.length>0&&(this.Reason.Visible=Object(l.j)(this.drc[0].IsVisible.toString())),this.drc=this.dsMPDocView.Tables[this.dsMPDocView.Tables.length-2].filter((function(t){return"Remarks"==t.SysColumnName})),null!=this.drc&&this.drc.length>0&&(this.Remarks.Visible=Object(l.j)(this.drc[0].IsVisible.toString()));var c=this.dsMPDocView.Tables[this.dsMPDocView.Tables.length-2];c.RowFilter=" CostCenterColID=3100005 ",null!=c&&c.length>0&&(this.dgvEarnings.Visible=Object(l.j)(c[0].IsVisible.toString())),c.RowFilter=" CostCenterColID=3100015 ",null!=c&&c.length>0&&(this.dgvDeductions.Visible=Object(l.j)(c[0].IsVisible.toString()))}this.NetSalary.Label=this.dgvDeductions.Visible?"Net Salary":"Gross Salary"}},{key:"EffectFrom_DateChanged",value:function(t){null!=this.dtDateOfJoining&&this.dtDateOfJoining.getFullYear()==this.EffectFrom.Date.getFullYear()&&this.dtDateOfJoining.getMonth()==this.EffectFrom.Date.getMonth()?(this.EffectFrom.Date=this.dtDateOfJoining,this.ActAppraisalFrom.Date=this.EffectFrom.Date):(this.EffectFrom.Date=new Date(this.EffectFrom.Date.getFullYear(),this.EffectFrom.Date.getMonth(),1),this.ActAppraisalFrom.Date=this.EffectFrom.Date)}},{key:"ActAppraisalFrom_DateChanged",value:function(t){this.ActAppraisalFrom.Date=null!=this.dtDateOfJoining&&this.dtDateOfJoining.getFullYear()==this.ActAppraisalFrom.Date.getFullYear()&&this.dtDateOfJoining.getMonth()==this.ActAppraisalFrom.Date.getMonth()?this.dtDateOfJoining:new Date(this.ActAppraisalFrom.Date.getFullYear(),this.ActAppraisalFrom.Date.getMonth(),1)}},{key:"NextAppraisal_DateChanged",value:function(t){this.NextAppraisal.Date=new Date(this.NextAppraisal.Date.getFullYear(),this.NextAppraisal.Date.getMonth(),1)}},{key:"BasicMonthly_LostFocus",value:function(t){try{var e=parseFloat(this.BasicMonthly.Text.Trim());this.BasicMonthly.Text=e.ToString("0.00")}catch(a){this.BasicMonthly.Text="0.00"}this.ExecuteFormulas()}},{key:"ExecuteFormulas",value:function(){var t,e=this;t="Actual Days"==s.a.SessionManager.Preferences.EmpMasterPayDays?s.a.SessionManager.PayrollMonthEnd.Subtract(s.a.SessionManager.PayrollMonthStart).Days+1:parseInt(s.a.SessionManager.Preferences.EmpMasterPayDays);var a,l=0,n=0,r=(0).ToString(this.sDecimalsAmount),o=new Date(i.e.IsEmpty(this.dsData.Tables[0][0].CDOJ)?new Date("01-Jan-9000"):new Date(this.dsData.Tables[0][0].CDOJ));this.dServiceDays=i.e.GetDateDifference(new Date,o)+1,this.fldDict=new h.a,a=new d.c("Basic",""),this.fldDict.push("Basic",a),this.fldDict.Basic.setFieldValue(this.BasicMonthly.Text),a=new d.c("ServiceDays",""),this.fldDict.push("ServiceDays",a),this.fldDict.ServiceDays.setFieldValue(this.dServiceDays),a=new d.c("WeeklyOffs",""),this.fldDict.push("WeeklyOffs",a),this.fldDict.WeeklyOffs.setFieldValue(0),a=new d.c("LeavesTaken",""),this.fldDict.push("LeavesTaken",a),this.fldDict.LeavesTaken.setFieldValue(0),a=new d.c("VacDaysTaken",""),this.fldDict.push("VacDaysTaken",a),this.fldDict.VacDaysTaken.setFieldValue(0),a=new d.c("VacDays",""),this.fldDict.push("VacDays",a),this.fldDict.VacDays.setFieldValue(0),a=new d.c("VacAmount",""),this.fldDict.push("VacAmount",a),this.fldDict.VacAmount.setFieldValue(0),a=new d.c("VacEncashDays",""),this.fldDict.push("VacEncashDays",a),this.fldDict.VacEncashDays.setFieldValue(0),a=new d.c("VacEncashAmount",""),this.fldDict.push("VacEncashAmount",a),this.fldDict.VacEncashAmount.setFieldValue(0),a=new d.c("VacExcessDays",""),this.fldDict.push("VacExcessDays",a),this.fldDict.VacExcessDays.setFieldValue(0),a=new d.c("VacExcessAmount",""),this.fldDict.push("VacExcessAmount",a),this.fldDict.VacExcessAmount.setFieldValue(0),a=new d.c("VacNetAmount",""),this.fldDict.push("VacNetAmount",a),this.fldDict.VacNetAmount.setFieldValue(0),a=new d.c("TotalDays",""),this.fldDict.push("TotalDays",a),this.fldDict.TotalDays.setFieldValue(t),a=new d.c("DaysAttended",""),this.fldDict.push("DaysAttended",a),this.fldDict.DaysAttended.setFieldValue(t),a=new d.c("UnpaidDays",""),this.fldDict.push("UnpaidDays",a),(this.Parent.ClassName="AddEditEmpMasterViewModel")?this.fldDict.UnpaidDays.setFieldValue(this.Parent.GetUnpaidDays()):this.fldDict.UnpaidDays.setFieldValue(0),a=new d.c("LOPDays",""),this.fldDict.push("LOPDays",a),this.fldDict.LOPDays.setFieldValue(0),a=new d.c("Holidays",""),this.fldDict.push("Holidays",a),this.fldDict.Holidays.setFieldValue(0),a=new d.c("AdjDays",""),this.fldDict.push("AdjDays",a),this.fldDict.AdjDays.setFieldValue(0),a=new d.c("EmpType",""),this.fldDict.push("EmpType",a),this.fldDict.EmpType.setFieldValue(this.dsData.Tables[0][0].sEmpType.toString()),a=new d.c("Gender",""),this.fldDict.push("Gender",a),this.fldDict.Gender.setFieldValue(this.dsData.Tables[0][0].sGender.toString()),a=new d.c("MaritalStatus",""),this.fldDict.push("MaritalStatus",a),this.fldDict.MaritalStatus.setFieldValue(this.dsData.Tables[0][0].sMaritalStatus.toString()),a=new d.c("Nationality",""),this.fldDict.push("Nationality",a),this.fldDict.Nationality.setFieldValue(this.dsData.Tables[0][0].sNationality.toString()),a=new d.c("Religion",""),this.fldDict.push("Religion",a),this.fldDict.Religion.setFieldValue(this.dsData.Tables[0][0].sReligion.toString()),a=new d.c("ChildrenCount",""),this.fldDict.push("ChildrenCount",a),this.dvDependentInfo=this.dsData.Tables[2],null!=this.dvDependentInfo?(this.dvDependentInfo.RowFilter="EmpSeqNo="+this.NodeID+" AND Relation='Children'",this.fldDict.ChildrenCount.setFieldValue(this.dvDependentInfo.length)):this.fldDict.ChildrenCount.setFieldValue(0),a=new d.c("ChildrenDays",""),this.fldDict.push("ChildrenDays",a);var c=0;if(this.dvDependentInfo.RowFilter="EmpSeqNo="+this.NodeID+" AND Relation='Children'",this.dvDependentInfo.length>0)for(var u=this.dvDependentInfo,D=0;D<u.length;D++)if(new Date(u[D].ChildDOB)>=s.a.SessionManager.PayrollMonthStart&&new Date(u[D].ChildDOB)<=s.a.SessionManager.PayrollMonthEnd)c+=i.e.GetDateDifference(s.a.SessionManager.PayrollMonthEnd,new Date(u[D].ChildDOB))+1;else{var p=0,g=0,m=0,f={iY:p,iM:g,iD:m};i.e.GetYearsMonthsDays(new Date(u[D].ChildDOB),s.a.SessionManager.PayrollMonthEnd,f),g=f.iM,m=f.iD,18==(p=f.iY)&&0==g?c+=s.a.SessionManager.PayrollMonthEnd.Subtract(s.a.SessionManager.PayrollMonthStart).Days+1-m:p<18&&(c+=s.a.SessionManager.PayrollMonthEnd.Subtract(s.a.SessionManager.PayrollMonthStart).Days+1)}this.fldDict.ChildrenDays.setFieldValue(c),a=new d.c("PayrollMonthNo",""),this.fldDict.push("PayrollMonthNo",a),this.fldDict.PayrollMonthNo.setFieldValue(s.a.SessionManager.PayrollMonth.iMonth()),a=new d.c("PayrollYearNo",""),this.fldDict.push("PayrollYearNo",a),this.fldDict.PayrollYearNo.setFieldValue(s.a.SessionManager.PayrollMonth.getFullYear()),a=new d.c("DOJMonth",""),this.fldDict.push("DOJMonth",a),this.fldDict.DOJMonth.setFieldValue(o.iMonth()),a=new d.c("DOJYear",""),this.fldDict.push("DOJYear",a),this.fldDict.DOJYear.setFieldValue(o.getFullYear()),a=new d.c("DORMonth",""),this.fldDict.push("DORMonth",a),null!=this.dsData&&this.dsData.Tables.length>0&&this.dsData.Tables[0].length>0&&!i.e.IsEmpty(this.dsData.Tables[0][0].CDORelieve)?this.fldDict.DORMonth.setFieldValue(new Date(this.dsData.Tables[0][0].CDORelieve).iMonth()):this.fldDict.DORMonth.setFieldValue(1),a=new d.c("DORYear",""),this.fldDict.push("DORYear",a),null!=this.dsData&&this.dsData.Tables.length>0&&this.dsData.Tables[0].length>0&&!i.e.IsEmpty(this.dsData.Tables[0][0].CDORelieve)?this.fldDict.DORYear.setFieldValue(new Date(this.dsData.Tables[0][0].CDORelieve).getFullYear()):this.fldDict.DORYear.setFieldValue(2200),a=new d.c("EmpConfirmationDate",""),this.fldDict.push("EmpConfirmationDate",a),this.fldDict.EmpConfirmationDate.setFieldValue(this.dtDOConfirm.Date),a=new d.c("LeaveFromDate",""),this.fldDict.push("LeaveFromDate",a),this.fldDict.LeaveFromDate.setFieldValue(new Date),a=new d.c("LeaveNoOfDays",""),this.fldDict.push("LeaveNoOfDays",a),this.fldDict.LeaveNoOfDays.setFieldValue(0),a=new d.c("EmpVacationDays",""),this.fldDict.push("EmpVacationDays",a),this.fldDict.EmpVacationDays.setFieldValue(this.dsData.Tables[0][0].VacDaysPerMonth.toString()),a=new d.c("AppraisalMonthNo",""),this.fldDict.push("AppraisalMonthNo",a),this.dvApprisal=this.dsData.Tables[4],this.dvApprisal=this.dvApprisal.filter((function(t){return t.EmpSeqNo==e.NodeID&&t.CEffectFrom<=e.EffectFrom.Date.ToString("dd/MMM/yyyy")})),this.dvApprisal.sort((function(t,e){return e.CEffectFrom-t.CEffectFrom})),null!=this.dvApprisal&&this.dvApprisal.length>1?0==this.EditSeqNo||new Date(this.dvApprisal[0].CEffectFrom)!=this.EffectFrom.Date?this.fldDict.AppraisalMonthNo.setFieldValue(this.EffectFrom.Date.iMonth()):this.fldDict.AppraisalMonthNo.setFieldValue(new Date(this.dvApprisal[0].CEffectFrom).iMonth()):this.dvApprisal.length>0&&new Date(this.dvApprisal[0].CEffectFrom)!=this.EffectFrom.Date?this.fldDict.AppraisalMonthNo.setFieldValue(this.EffectFrom.Date.iMonth()):this.fldDict.AppraisalMonthNo.setFieldValue(0),a=new d.c("VacDaysPayYes",""),this.fldDict.push("VacDaysPayYes",a),this.fldDict.VacDaysPayYes.setFieldValue(0),a=new d.c("VacDaysPayNo",""),this.fldDict.push("VacDaysPayNo",a),this.fldDict.VacDaysPayNo.setFieldValue(0),this.dvApprisal=this.dsData.Tables[4],this.dvApprisal=this.dvApprisal.filter((function(t){return t.EmpSeqNo==e.NodeID&&t.CEffectFrom<=e.EffectFrom.Date.ToString("dd/MMM/yyyy")}));var F=null,S=0;if(null!=this.dsPayStructure&&(F=this.dsPayStructure.Tables[0].DefaultView),null!=this.dvApprisal&&this.dvApprisal.length>0&&(this.dvApprisal.sort((function(t,e){return e.CEffectFrom-t.CEffectFrom})),null!=this.dvApprisal&&this.dvApprisal.length>1&&(null!=(F=F.filter((function(t){return 1==t.Type&&"Yes"==t.Applicable})))&&F.length>0)))for(var y=0;y<F.length;y++)i.e.IsEmpty(s.a.SessionManager.Preferences.GosiComponent)||s.a.SessionManager.Preferences.GosiComponent!=F[y].ComponentID.toString()||(S=new Date(this.dvApprisal[0].CEffectFrom)!=this.EffectFrom.Date?parseFloat(this.dvApprisal[0]["Earning"+parseInt(F[y].SNo)]):parseFloat(this.dvApprisal[1]["Earning"+parseInt(F[y].SNo)]));a=new d.c("PreviousGosiValue",""),this.fldDict.push("PreviousGosiValue",a),this.fldDict.PreviousGosiValue.setFieldValue(S),a=new d.c("TotCheckInLateMins",""),this.fldDict.push("TotCheckInLateMins",a),this.fldDict.TotCheckInLateMins.setFieldValue(0),a=new d.c("TotCheckOutEarlyMins",""),this.fldDict.push("TotCheckOutEarlyMins",a),this.fldDict.TotCheckOutEarlyMins.setFieldValue(0),a=new d.c("TotBreak1MoreMins",""),this.fldDict.push("TotBreak1MoreMins",a),this.fldDict.TotBreak1MoreMins.setFieldValue(0),a=new d.c("TotBreak2MoreMins",""),this.fldDict.push("TotBreak2MoreMins",a),this.fldDict.TotBreak2MoreMins.setFieldValue(0),a=new d.c("TotBreak3MoreMins",""),this.fldDict.push("TotBreak3MoreMins",a),this.fldDict.TotBreak3MoreMins.setFieldValue(0),a=new d.c("TotBreak4MoreMins",""),this.fldDict.push("TotBreak4MoreMins",a),this.fldDict.TotBreak4MoreMins.setFieldValue(0),a=new d.c("TotBreak5MoreMins",""),this.fldDict.push("TotBreak5MoreMins",a),this.fldDict.TotBreak5MoreMins.setFieldValue(0),a=new d.c("TotLateHrsToDeduct",""),this.fldDict.push("TotLateHrsToDeduct",a),this.fldDict.TotLateHrsToDeduct.setFieldValue(0),a=new d.c("TotLateLeavesToDeduct",""),this.fldDict.push("TotLateLeavesToDeduct",a),this.fldDict.TotLateLeavesToDeduct.setFieldValue(0),a=new d.c("TotWorkingMinsLessBy",""),this.fldDict.push("TotWorkingMinsLessBy",a),this.fldDict.TotWorkingMinsLessBy.setFieldValue(0),a=new d.c("TotAbsentMinsLessBy",""),this.fldDict.push("TotAbsentMinsLessBy",a),this.fldDict.TotAbsentMinsLessBy.setFieldValue(0),this.dvCCData.RowFilter="EmpSeqNo="+this.NodeID;var P="",C="";if(a=new d.c("RptManagerCode",""),this.fldDict.push("RptManagerCode",a),a=new d.c("RptManagerName",""),this.fldDict.push("RptManagerName",a),this.dvCCData.length>0&&!i.e.IsEmpty(this.dvCCData[0].RptManager)){var v=this.dvDimsData.filter((function(t){return"RptManager"==t.SysColName&&t.NodeID==e.dvCCData[0].RptManager.toString()}));v.length>0&&(P=v[0].Code.toString(),C=v[0].Name.toString())}if(this.fldDict.RptManagerCode.setFieldValue(P),this.fldDict.RptManagerName.setFieldValue(C),this.dvCCData.length>0)for(var T=function(t){var s=Object.keys(e.dvCCData[0])[t];if(!s.Contains("CCNID"))return"continue";var i=e.dvDimsData.filter((function(t){return t.SysColName==s}));i.length>0&&(a=new d.c(i[0].UserColumnName.toString()+"Code",""),e.fldDict.push(i[0].UserColumnName.toString()+"Code",a),a=new d.c(i[0].UserColumnName.toString()+"Name",""),e.fldDict.push(i[0].UserColumnName.toString()+"Name",a),i=e.dvDimsData.filter((function(t){return t.SysColName==s&&t.NodeID==e.dvCCData[0][s].toString()})),e.fldDict[i[0].UserColumnName.toString()+"Code"].setFieldValue(i[0].Code.toString()),e.fldDict[i[0].UserColumnName.toString()+"Name"].setFieldValue(i[0].Name.toString()))},E=0;E<Object.keys(this.dvCCData[0]).length;E++)T(E);for(var M=0;M<this.dgvEarnings.Table.length;M++)i.e.IsEmpty(this.dgvEarnings.Table[M].EarSNo)||(a=new d.c(this.dgvEarnings.Table[M].Earnings.toString(),""),this.fldDict.push(this.dgvEarnings.Table[M].Earnings.toString(),a),this.fldDict[this.dgvEarnings.Table[M].Earnings.toString()].setFieldValue(this.dgvEarnings.Table[M].EarValue.toString()),a=new d.c("Calc"+this.dgvEarnings.Table[M].Earnings.toString(),""),this.fldDict.push("Calc"+this.dgvEarnings.Table[M].Earnings.toString(),a),this.fldDict["Calc"+this.dgvEarnings.Table[M].Earnings.toString()].setFieldValue(this.dgvEarnings.Table[M].EarValue.toString()),a=new d.c("Arr_"+this.dgvEarnings.Table[M].Earnings.toString(),""),this.fldDict.push("Arr_"+this.dgvEarnings.Table[M].Earnings.toString(),a),this.fldDict["Arr_"+this.dgvEarnings.Table[M].Earnings.toString()].setFieldValue(0),a=new d.c("Adj_"+this.dgvEarnings.Table[M].Earnings.toString(),""),this.fldDict.push("Adj_"+this.dgvEarnings.Table[M].Earnings.toString(),a),this.fldDict["Adj_"+this.dgvEarnings.Table[M].Earnings.toString()].setFieldValue(0));for(var A=0;A<this.dgvDeductions.Table.length;A++)i.e.IsEmpty(this.dgvDeductions.Table[A].DedSNo)||(a=new d.c(this.dgvDeductions.Table[A].Deductions.toString(),""),this.fldDict.push(this.dgvDeductions.Table[A].Deductions.toString(),a),this.fldDict[this.dgvDeductions.Table[A].Deductions.toString()].setFieldValue(this.dgvDeductions.Table[A].DedValue.toString()),a=new d.c("Calc"+this.dgvDeductions.Table[A].Deductions.toString(),""),this.fldDict.push("Calc"+this.dgvDeductions.Table[A].Deductions.toString(),a),this.fldDict["Calc"+this.dgvDeductions.Table[A].Deductions.toString()].setFieldValue(this.dgvDeductions.Table[A].DedValue.toString()),a=new d.c("Arr_"+this.dgvDeductions.Table[A].Deductions.toString(),""),this.fldDict.push("Arr_"+this.dgvDeductions.Table[A].Deductions.toString(),a),this.fldDict["Arr_"+this.dgvDeductions.Table[A].Deductions.toString()].setFieldValue(0),a=new d.c("Adj_"+this.dgvDeductions.Table[A].Deductions.toString(),""),this.fldDict.push("Adj_"+this.dgvDeductions.Table[A].Deductions.toString(),a),this.fldDict["Adj_"+this.dgvDeductions.Table[A].Deductions.toString()].setFieldValue(0));for(var b=this.fldDict,N=0;N<this.dgvEarnings.Table.length;N++)if(null!=this.dgvEarnings.Table[N].EarSNo&&null!=this.dgvEarnings.Table[N].EarSNo&&""!=this.dgvEarnings.Table[N].EarSNo.toString()){if(null!=this.dgvEarnings.Table[N].EarFormula&&null!=this.dgvEarnings.Table[N].EarFormula&&""!=this.dgvEarnings.Table[N].EarFormula.toString())try{r=parseFloat(s.a.eval.EvaluateExpression(this.dgvEarnings.Table[N].EarFormula.toString(),b)).ToString(this.sDecimalsAmount),this.dgvEarnings.Table[N].EarValue=this.RoundOffValue(parseFloat(r),parseFloat(this.dgvEarnings.Table[N].EarROff)),this.fldDict[this.dgvEarnings.Table[N].Earnings.toString()].setFieldValue(this.dgvEarnings.Table[N].EarValue.toString()),this.fldDict["Calc"+this.dgvEarnings.Table[N].Earnings.toString()].setFieldValue(this.dgvEarnings.Table[N].EarValue.toString())}catch(V){}i.e.IsEmpty(this.dgvEarnings.Table[N].EarAddToNet)||"Net"!=this.dgvEarnings.Table[N].EarAddToNet.toString()&&"NetAndTax"!=this.dgvEarnings.Table[N].EarAddToNet.toString()||(l+=parseFloat(this.dgvEarnings.Table[N].EarValue))}for(var L=0;L<this.dgvDeductions.Table.length;L++)if(!i.e.IsEmpty(this.dgvDeductions.Table[L].DedSNo)){if(!i.e.IsEmpty(this.dgvDeductions.Table[L].DedFormula))try{r=s.a.eval.EvaluateExpression(this.dgvDeductions.Table[L].DedFormula.toString(),b).toString(),r=parseFloat(r).ToString(this.sDecimalsAmount),"ESI"==this.dgvDeductions.Table[L].Deductions.toString().toUpperCase()?r=Math.ceil(parseFloat(r)).ToString(this.sDecimalsAmount):"PT"==this.dgvDeductions.Table[L].Deductions.toString().toUpperCase()&&function(){var t=r.Replace(",","");r=(0).ToString(e.sDecimalsAmount);var a=e.dsPayStructure.Tables[0];if(a.length>0){var l=new Date(a[0].PayrollMonth),n=new Date,o=new Date,d=new Date,h={PayrollMonth:n,PayrollMonthStart:o,PayrollMonthEnd:d};i.e.SetPayrollDate(l,h),n=h.PayrollMonth,o=h.PayrollMonthStart,d=h.PayrollMonthEnd;var c=s.a.empService.GetQueryData(e.NodeID,"APP009",n.ToString("dd/MMM/yyyy"),n.ToString("dd/MMM/yyyy"),n.ToString("dd/MMM/yyyy"));if(null!=c&&c.Tables.length>0){var u="1";c.Tables[0].length>0?u=c.Tables[0][0].PTDimension.toString():c.Tables[1].length>0&&(u=c.Tables[1][0].PTDimension.toString());var D=c.Tables[2];if(c.Tables[0].length>0||c.Tables[1].length>0){var p=c.Tables[2];if(null!=(p=p.filter((function(t){return t.NodeID==u&&""!=t.Formula})))&&p.length>0&&!i.e.IsEmpty(p[0].Formula)){var g=e.fldDict;r=parseFloat(s.a.eval.EvaluateExpression(p[0].Formula.toString(),g)).toString()}else(D=D.filter((function(e){return e.NodeID==u&&e.FromSlab<=t&&e.ToSlab>=t}))).length>0&&(r=i.e.String(D[0].Amount))}}}}(),this.dgvDeductions.Table[L].DedValue=this.RoundOffValue(parseFloat(r),parseFloat(this.dgvDeductions.Table[L].DedROff)),this.fldDict[this.dgvDeductions.Table[L].Deductions.toString()].setFieldValue(this.dgvDeductions.Table[L].DedValue.toString()),this.fldDict["Calc"+this.dgvDeductions.Table[L].Deductions.toString()].setFieldValue(this.dgvDeductions.Table[L].DedValue.toString())}catch(I){}null==this.dgvDeductions.Table[L].DedAddToNet||null==this.dgvDeductions.Table[L].DedAddToNet||""==this.dgvDeductions.Table[L].DedAddToNet.toString()||"Net"!=this.dgvDeductions.Table[L].DedAddToNet.toString()&&"NetAndTax"!=this.dgvDeductions.Table[L].DedAddToNet.toString()||(n+=parseFloat(this.dgvDeductions.Table[L].DedValue))}this.dgvEarnings.Columns[2].footer=l.ToString("0.00"),this.dgvDeductions.Columns[2].footer=n.ToString("0.00"),this.dgvEarnings.UpdateFooter(),this.dgvDeductions.UpdateFooter(),this.dgvEarnings.refreshDataView(),this.dgvDeductions.refreshDataView(),this.NetSalary.Text=(l-n).ToString("0.00"),this.webtotEarnings=l,this.webtotDeductions=n}},{key:"RoundOffValue",value:function(t,e){if(e>0&&t>0){var a,s=!1;(a=t%e)>0&&(e/a<=2&&(s=!0),t-=a,s&&(t+=e))}return t.ToString(this.sDecimalsAmount).Replace(",","")}},{key:"LoadGrids",value:function(){var t=this;Logger.InfoLog("AddEditAppraisalViewModel::Entering LoadGrids()"),this.dgvEarnings=new r.a,this.dgvEarnings.BeginEdit.Subscribe(this,"dgvEarnings_BeginEdit"),this.dgvEarnings.OnCellEditEnding.Subscribe(this,"dgvEarnings_EndEdit"),this.dgvEarnings.Columns=[],this.dgvEarnings.Height=200,this.dgvEarnings.Width="";var e,a=new o.a;if(a.Header="#",a.DisplayMember="SlNo",a.ID="SlNo",a.Width=45,a.ReadOnly=!0,this.dgvEarnings.Columns.push(a),(a=new o.a).Header="Earnings",a.DisplayMember="Earnings",a.ID="Earnings",a.Width=150,a.ReadOnly=!0,this.dgvEarnings.Columns.push(a),(a=new o.a).Header="Value",a.DisplayMember="EarValue",a.ID="EarValue",a.Width=100,a.ReadOnly=!1,a.DataType="FLOAT",a.ShowTotal=!0,a.IsCalculated=1,a.DecimalPoints="2",this.dgvEarnings.Columns.push(a),this.dgvDeductions=new r.a,this.dgvDeductions.BeginEdit.Subscribe(this,"dgvDeductions_BeginEdit"),this.dgvDeductions.OnCellEditEnding.Subscribe(this,"dgvDeductions_EndEdit"),this.dgvDeductions.Columns=[],this.dgvDeductions.Height=200,this.dgvDeductions.Width="",(a=new o.a).Header="#",a.DisplayMember="SlNo",a.ID="SlNo",a.Width=45,a.ReadOnly=!0,this.dgvDeductions.Columns.push(a),(a=new o.a).Header="Deductions",a.DisplayMember="Deductions",a.ID="Deductions",a.Width=150,a.ReadOnly=!0,this.dgvDeductions.Columns.push(a),(a=new o.a).Header="Value",a.DisplayMember="DedValue",a.ID="DedValue",a.Width=100,a.ReadOnly=!1,a.DataType="FLOAT",a.ShowTotal=!0,a.IsCalculated=1,a.DecimalPoints="2",this.dgvDeductions.Columns.push(a),this.dsPayStructure=s.a.empService.GetQueryData(this.NodeID,"APP008","","",""),this.dgvEarnings.Clear(),this.dgvEarnings.TableColumns.push("SlNo"),this.dgvEarnings.TableColumns.push("Earnings"),this.dgvEarnings.TableColumns.push("EarValue"),this.dgvEarnings.TableColumns.push("EarAddToNet"),this.dgvEarnings.TableColumns.push("EarFType"),this.dgvEarnings.TableColumns.push("Earnings_GRAY"),this.dgvEarnings.TableColumns.push("EarValue_GRAY"),this.dgvEarnings.TableColumns.push("EarSNo"),this.dgvEarnings.TableColumns.push("EarFormula"),this.dgvEarnings.TableColumns.push("EarROff"),this.dgvEarnings.TableColumns.push("EarComponentID"),this.dgvEarnings.TableColumns.push("IsVisible"),this.dgvDeductions.TableColumns.push("SlNo"),this.dgvDeductions.TableColumns.push("Deductions"),this.dgvDeductions.TableColumns.push("DedValue"),this.dgvDeductions.TableColumns.push("DedAddToNet"),this.dgvDeductions.TableColumns.push("DedFType"),this.dgvDeductions.TableColumns.push("Deductions_GRAY"),this.dgvDeductions.TableColumns.push("DedValue_GRAY"),this.dgvDeductions.TableColumns.push("DedSNo"),this.dgvDeductions.TableColumns.push("DedFormula"),this.dgvDeductions.TableColumns.push("DedROff"),this.dgvDeductions.TableColumns.push("DedComponentID"),this.dgvDeductions.TableColumns.push("IsVisible"),this.dgvEarnings.Clear(),this.dgvDeductions.Clear(),this.EditSeqNo>0){null!=(e=this.dsPayStructure.Tables[1].filter((function(e){return e.SeqNo==t.EditSeqNo}))[0])&&null!=e&&(this.BasicMonthly.Text=parseFloat(e.BasicMonthly).ToString("0.00"),this.EffectFrom.Date=new Date(e.ApraisalDate),this.ActAppraisalFrom.Date=new Date(e.CApplyFrom),this.Reason.Text=i.e.String(e.Reason),this.Remarks.Text=i.e.String(e.Remarks),this.AppraisalType.SelectedValue=i.e.String(e.AppraisalType));var l=s.a.empService.GetQueryData(this.NodeID,"APP002","","","");if(null!=l&&l.length>0)if(0==l.length)null!=this.dtNextAppraisalDate&&(this.NextAppraisal.Date=this.dtNextAppraisalDate);else if(i.e.String(l[l.length-1].SeqNo)==this.EditSeqNo.toString())null!=this.dtNextAppraisalDate&&(this.NextAppraisal.Date=this.dtNextAppraisalDate);else{var n=l.filter((function(e){return e.CApplyFrom>"'"+t.ActAppraisalFrom.Date.ToString("dd/MMM/yyyy")+"'"}));null!=n&&n.length>0&&(this.NextAppraisal.Date=new Date(n[0].CApplyFrom))}}else null!=(e=this.dsPayStructure.Tables[1][0])&&(this.BasicMonthly.Text=parseFloat(e.BasicMonthly).ToString("0.00")),this.NextAppraisal.Date=new Date;if(null!=this.dsPayStructure&&this.dsPayStructure.Tables.length>0&&this.dsPayStructure.Tables[0].length>0&&null!=e){var d,h,c=this.dsPayStructure.Tables[0];h=c.filter((function(t){return 1==t.Type&&"Yes"==t.Applicable&&"OverTime"!=t.FieldType}));for(var u=0;u<h.length;u++)(i.e.IsEmpty(h[u].Behaviour)||"Accruals"!=h[u].Behaviour.toString()&&"Accruals-AccumulateForPreviousYears"!=h[u].Behaviour.toString())&&((d=this.dgvEarnings.NewRow()).SlNo=(u+1).toString(),d.Earnings=i.e.String(h[u].ComponentName),d.EarComponentID=i.e.String(h[u].ComponentID),d.EarSNo=i.e.String(h[u].SNo),d.EarFormula=i.e.String(h[u].Formula),d.EarROff=i.e.String(h[u].ROff),d.EarValue=parseFloat(e["Earning"+d.EarSNo]).ToString("0.00"),d.EarAddToNet=i.e.String(h[u].AddToNet),d.EarFType=i.e.String(h[u].FieldType),"EmployeeMaster"!=i.e.String(d.EarFType)&&(d.Earnings_GRAY="1",d.EarValue_GRAY="1"),this.dgvEarnings.addRow(d));h=c.filter((function(t){return 2==t.Type&&"Yes"==t.Applicable&&"NetSalary"!=t.FieldType&&"OverTime"!=t.FieldType}));for(var D=0;D<h.length;D++)(d=this.dgvDeductions.NewRow()).SlNo=(D+1).toString(),d.Deductions=i.e.String(h[D].ComponentName),d.DedComponentID=i.e.String(h[D].ComponentID),d.DedSNo=i.e.String(h[D].SNo),d.DedFormula=i.e.String(h[D].Formula),d.DedROff=i.e.String(h[D].ROff),d.DedValue=parseFloat(e["Deduction"+d.DedSNo]).ToString("0.00"),d.DedAddToNet=i.e.String(h[D].AddToNet),d.DedFType=i.e.String(h[D].FieldType),"EmployeeMaster"!=i.e.String(d.DedFType)&&(d.Deductions_GRAY="1",d.DedValue_GRAY="1"),this.dgvDeductions.addRow(d)}this.BasicMonthly_LostFocus(this.BasicMonthly),Logger.InfoLog("AddEditAppraisalViewModel::Exiting LoadGrids()")}},{key:"GetDtGrSalSalbs",value:function(){this.dtGrSalSalbs=s.a.empService.GetQueryData(this.NodeID,"APP007","","","")}},{key:"dgvEarnings_EndEdit",value:function(t,e,a){if("EarValue"==e){if(""==t[e].toString().Trim()&&(t[e]="0.00"),s.a.SessionManager.Preferences.ContainsKey("ConsiderGradeWiseSalarySlabs")&&"True"==s.a.SessionManager.Preferences.ConsiderGradeWiseSalarySlabs&&(null==this.dtGrSalSalbs&&this.GetDtGrSalSalbs(),null!=this.dtGrSalSalbs&&this.dtGrSalSalbs.length>0)){var l=null;if(null!=(l=this.dtGrSalSalbs.filter("EarValue"==e?function(e){return e.ComponentID==t.EarComponentID.toString()}:function(e){return e.ComponentID==t.DedComponentID.toString()}))&&l.length>0&&this.ValidateGradeWiseSalarySlabsApplicableFormula(l[0])){var n,r,o;n=i.e.Double(t[e]),r=i.e.Double(l[0].MinAmount),o=i.e.Double(l[0].MaxAmount),n>=r&&n<=o||("Stop"==l[0].AlertType.toString()?(alert('"'+l[0].ComponentName.toString()+'" Amount should be in between '+r+"  and  "+o),t[e]=(0).ToString(this.sDecimalsAmount)):confirm('"'+l[0].ComponentName.toString()+'" Amount should be in between '+r+"  and  "+o+"\r\nDo you want to proceed.?")||(t[e]=(0).ToString(this.sDecimalsAmount)))}}this.ExecuteFormulas()}}},{key:"ValidateGradeWiseSalarySlabsApplicableFormula",value:function(t){if(null!=t&&null!=t.ApplicableFormula&&null!=t.ApplicableFormula&&""!=t.ApplicableFormula.toString().Trim()){this.oEvalPayFormulas=new n.b,this.oEvalPayFormulas.sEmpSeqNo=this.NodeID.toString();var e={PayrollMonth:this.oEvalPayFormulas.PayrollMonth,PayrollMonthStart:this.oEvalPayFormulas.PayrollMonthStart,PayrollMonthEnd:this.oEvalPayFormulas.PayrollMonthEnd};if(i.e.SetPayrollDate(new Date,e),this.oEvalPayFormulas.PayrollMonth=e.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=e.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=e.PayrollMonthEnd,this.oEvalPayFormulas.arrLstCPFields[6].Clear(),this.oCPF=new n.a,this.oCPF.ComponentName="GrdWiseSalSlabsFormula",this.oCPF.SNo=1,this.oCPF.Formula=t.ApplicableFormula.toString(),this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),this.oEvalPayFormulas.Intialize(),this.oEvalPayFormulas.othMPField.BasicMonthly=""==this.BasicMonthly.Text?0:parseFloat(this.BasicMonthly.Text),this.oEvalPayFormulas.othMPField.TotalLeaves=0,this.oEvalPayFormulas.othMPField.DaysAttended=this.oEvalPayFormulas.othMPField.TotalDays,this.oEvalPayFormulas.ExecuteAllFormulas(),"GrdWiseSalSlabsFormula"==this.oEvalPayFormulas.arrLstCPFields[6][0].ComponentName)return 0!=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][0].dEarned)}return!0}},{key:"dgvDeductions_EndEdit",value:function(t,e,a){if("DedValue"==e){if(""==t[e].toString().Trim()&&(t[e]="0.00"),s.a.SessionManager.Preferences.ContainsKey("ConsiderGradeWiseSalarySlabs")&&"True"==s.a.SessionManager.Preferences.ConsiderGradeWiseSalarySlabs&&(null==this.dtGrSalSalbs&&this.GetDtGrSalSalbs(),null!=this.dtGrSalSalbs&&this.dtGrSalSalbs.length>0)){var l=null;if(null!=(l=this.dtGrSalSalbs.filter("EarValue"==e?function(e){return e.ComponentID==t.EarComponentID.toString()}:function(e){return e.ComponentID==t.DedComponentID.toString()}))&&l.length>0&&this.ValidateGradeWiseSalarySlabsApplicableFormula(l[0])){var n,r,o;n=i.e.Double(t[e]),r=i.e.Double(l[0].MinAmount),o=i.e.Double(l[0].MaxAmount),n>=r&&n<=o||("Stop"==l[0].AlertType.toString()?(alert('"'+l[0].ComponentName.toString()+'" Amount should be in between '+r+"  and  "+o),t[e]=(0).ToString(this.sDecimalsAmount)):confirm('"'+l[0].ComponentName.toString()+'" Amount should be in between '+r+"  and  "+o+"\r\nDo you want to proceed.?")||(t[e]=(0).ToString(this.sDecimalsAmount)))}}this.ExecuteFormulas()}}},{key:"dgvEarnings_BeginEdit",value:function(t,e,a){return"EarValue"==t.args.column.field&&"1"==i.e.String(t.args.item.EarValue_GRAY)?(t.args.Cancel=!0,!0):(t.args.Cancel=!1,!1)}},{key:"dgvDeductions_BeginEdit",value:function(t,e,a){return"DedValue"==t.args.column.field&&"1"==i.e.String(t.args.item.DedValue_GRAY)?(t.args.Cancel=!0,!0):(t.args.Cancel=!1,!1)}},{key:"OnButtonClick",value:function(t){var e=this;if("Save"==t.toString()){if(null!=this.dtDateOfJoining&&(this.EffectFrom.Date<this.dtDateOfJoining||this.ActAppraisalFrom.Date<this.dtDateOfJoining)){var a=s.a.empService.GetQueryData(this.NodeID,"APP010",this.EditSeqNo,this.EffectFrom.Date.ToString("dd/MMM/yyyy"),"").Table[0];if(!(null!=a&&a.length>0))return this.DisplayMessage="EffectFrom and ApplyFrom should be Grater than or Equal to the Date of Joining.",void(this.MessageVisibility=!0);this.EffectFrom.Date=this.dtDateOfJoining,this.ActAppraisalFrom.Date=this.EffectFrom.Date}var l=s.a.empService.GetQueryData(this.NodeID,"APP011","","","");if(null!=l&&l.length>0&&parseInt(l[0].SeqNo)==this.EditSeqNo&&null!=this.dtDateOfJoining&&(this.EffectFrom.Date!=this.dtDateOfJoining||this.ActAppraisalFrom.Date!=this.dtDateOfJoining))return this.DisplayMessage="EffectFrom and ApplyFrom should be Equal to the Date of Joining.",void(this.MessageVisibility=!0);var n,r=s.a.empService.GetQueryData(this.NodeID,"APP003",this.EditSeqNo,this.EffectFrom.Date.ToString("dd/MMM/yyyy"),"").Table[0];if(null!=r&&r.length>0)return this.DisplayMessage="Appraisals already defined for this Month, Can't allow More than once.",void(this.MessageVisibility=!0);if("False"==s.a.SessionManager.Preferences.AllowAppraisalIfProcessed)if(this.EditSeqNo>0){if(s.a.empService.GetQueryData(this.NodeID,"APP004",this.EditSeqNo,"",""),null!=n&&n.Tables.length>0&&n.Tables[0].length>0)return this.DisplayMessage="Appraisal can not be processed. Because already processed payrolls exists.",void(this.MessageVisibility=!0)}else if(null!=(n=s.a.empService.GetQueryData(this.NodeID,"APP005",this.EffectFrom.Date,"",""))&&n.Tables.length>0&&n.Tables[0].length>0)return this.DisplayMessage="Appraisal can not be processed. Because already processed payrolls exists.",void(this.MessageVisibility=!0);if(s.a.SessionManager.Preferences.ContainsKey("ConsiderGradeWiseSalarySlabs")&&"True"==s.a.SessionManager.Preferences.ConsiderGradeWiseSalarySlabs&&(this.dtGrSalSalbs=s.a.empService.GetQueryData(this.NodeID,"APP006",this.isFromBulkAppraisals,this.sBulkAppraisalGrade,""),null!=this.dtGrSalSalbs&&this.dtGrSalSalbs.length>0)){for(var o="",d=!1,h=null,c=function(t){if(!i.e.IsEmpty(e.dgvEarnings.Table[t].EarFType)&&"EmployeeMaster"==e.dgvEarnings.Table[t].EarFType.toString()&&(null!=(h=e.dtGrSalSalbs.filter((function(a){return a.ComponentID==e.dgvEarnings.Table[t].EarComponentID.toString()})))&&h.length>0&&e.ValidateGradeWiseSalarySlabsApplicableFormula(h[0]))){var a,s,l;a=i.e.Double(e.dgvEarnings.Table[t].EarValue),s=i.e.Double(h[0].MinAmount),l=i.e.Double(h[0].MaxAmount),a>=s&&a<=l||("Stop"==h[0].AlertType.toString()?(d=!0,o+='\r\n"'+h[0].ComponentName.toString()+'" Amount should be in between '+s+"  and  "+l):o+='\r\n"'+h[0].ComponentName.toString()+'" Amount should be in between '+s+"  and  "+l)}},u=0;u<this.dgvEarnings.Table.length;u++)c(u);for(var D=function(t){if(!i.e.IsEmpty(e.dgvDeductions.Table[t].DedFType)&&"EmployeeMaster"==e.dgvDeductions.Table[t].DedFType.toString()&&(null!=(h=e.dtGrSalSalbs.filter((function(a){return a.ComponentID==e.dgvDeductions.Table[t].DedComponentID.toString()})))&&h.length>0&&e.ValidateGradeWiseSalarySlabsApplicableFormula(h[0]))){var a,s,l;a=i.e.Double(e.dgvDeductions.Table[t].DedValue),s=i.e.Double(h[0].MinAmount),l=i.e.Double(h[0].MaxAmount),a>=s&&a<=l||("Stop"==h[0].AlertType.toString()?(d=!0,o+='\r\n"'+h[0].ComponentName.toString()+'" Amount should be in between '+s+"  and  "+l):o+='\r\n"'+h[0].ComponentName.toString()+'" Amount should be in between '+s+"  and  "+l)}},p=0;p<this.dgvDeductions.Table.length;p++)D(p);if(o.length>0){if(d)return this.isFromBulkAppraisals&&(o="Emp.Code : "+this.sEmpCode+"-"+o,this.DisplayMessage=o),void alert(o);if(this.isFromBulkAppraisals&&(o="Emp.Code : "+this.sEmpCode+"-"+o),!confirm(o+"\r\nDo you want to proceed.?"))return void(this.isFromBulkAppraisals&&(this.DisplayMessage=o))}}if(this.strUpdate="",this.strUpdate=this.GetPayStructure(),this.isFromBulkAppraisals)return void(this.strUpdate="  "+this.strUpdate+"  ");var g=[];g.push(this.NodeID),g.push(this.EditSeqNo),g.push(this.EffectFrom.Date.ToString("dd/MMM/yyyy")),g.push(this.strUpdate),g.push(1),g.push(s.a.SessionManager.UserID),g.push(s.a.SessionManager.LanguageID),s.a.empService.ExecuteQuery_SP(g,"spPAY_ExecuteQuery"),null!=this.Parent&&(this.Parent.ClearScreen(),this.Parent.Opacity=1,this.Parent.DialogResult=!0)}else"Cancel"==t.toString()&&null!=this.Parent&&(this.Parent.Opacity=1,this.Parent.DialogResult=!1);s.a.page.HideDialog()}},{key:"GetPayStructure",value:function(){var t="";if(0==this.EditSeqNo){var e="";t+="INSERT INTO PAY_EmpPay(EmployeeID,EffectFrom,ApplyFrom,NetSalary,BasicMonthly,Remarks,Reason,CreatedBy,CreatedDate,ModifiedDate,AppraisalType",e+="VALUES("+this.NodeID+",CONVERT(INT,CONVERT(DATETIME,'"+this.EffectFrom.Date.ToString("dd/MMM/yyyy")+"')),CONVERT(INT,CONVERT(DATETIME, '"+this.ActAppraisalFrom.Date.ToString("dd/MMM/yyyy")+"')),",e+=this.NetSalary.Text,e+=","+this.BasicMonthly.Text,e+=",'"+this.Remarks.Text+"'",e+=",'"+this.Reason.Text+"'",e+=",'"+s.a.SessionManager.UserName+"'",e+=",CONVERT(FLOAT,GETDATE())",e+=",CONVERT(FLOAT,GETDATE())",e+=null==this.AppraisalType.SelectedValue||""==this.AppraisalType.SelectedValue?",0":","+this.AppraisalType.SelectedValue;for(var a=0;a<this.dgvEarnings.Table.length;a++)i.e.IsEmpty(this.dgvEarnings.Table[a].EarSNo)||i.e.IsEmpty(this.dgvEarnings.Table[a].EarValue)||""==this.dgvEarnings.Table[a].EarValue.toString().Trim()||(t+=",Earning"+this.dgvEarnings.Table[a].EarSNo.toString(),e+=","+this.dgvEarnings.Table[a].EarValue.toString());for(var l=0;l<this.dgvDeductions.Table.length;l++)i.e.IsEmpty(this.dgvDeductions.Table[l].DedSNo)||i.e.IsEmpty(this.dgvDeductions.Table[l].DedValue)||""==this.dgvDeductions.Table[l].DedValue.toString().Trim()||(t+=",Deduction"+this.dgvDeductions.Table[l].DedSNo.toString(),e+=","+this.dgvDeductions.Table[l].DedValue.toString());return t+=")"+e.toString()+")",(t+=" UPDATE COM_CC50051 SET NextAppraisalDate=CONVERT(INT,CONVERT(DATETIME, '"+this.NextAppraisal.Date.ToString("dd/MMM/yyyy")+"')) WHERE NodeID="+this.NodeID).toString()}t+="UPDATE PAY_EmpPay SET EffectFrom=CONVERT(INT,CONVERT(DATETIME, '"+this.EffectFrom.Date.ToString("dd/MMM/yyyy")+"')),ApplyFrom=CONVERT(INT,CONVERT(DATETIME, '"+this.ActAppraisalFrom.Date.ToString("dd/MMM/yyyy")+"')),NetSalary="+this.NetSalary.Text+",BasicMonthly="+this.BasicMonthly.Text+",Remarks='"+this.Remarks.Text+"',Reason='"+this.Reason.Text+"',ModifiedBy='"+s.a.SessionManager.UserName+"',ModifiedDate=CONVERT(FLOAT,GETDATE())",i.e.IsEmpty(this.AppraisalType.SelectedValue)?t+=",AppraisalType="+this.AppraisalType.SelectedValue:t+=",AppraisalType=0";for(var n=0;n<this.dgvEarnings.Table.length;n++)i.e.IsEmpty(this.dgvEarnings.Table[n].EarSNo)||i.e.IsEmpty(this.dgvEarnings.Table[n].EarValue)||""==this.dgvEarnings.Table[n].EarValue.toString().Trim()||(t+=",Earning"+this.dgvEarnings.Table[n].EarSNo.toString()+"="+this.dgvEarnings.Table[n].EarValue.toString());for(var r=0;r<this.dgvDeductions.Table.length;r++)i.e.IsEmpty(this.dgvDeductions.Table[r].DedSNo)||""==this.dgvDeductions.Table[r].DedSNo.toString()||i.e.IsEmpty(this.dgvDeductions.Table[r].DedValue)||""==this.dgvDeductions.Table[r].DedValue.toString().Trim()||(t+=",Deduction"+this.dgvDeductions.Table[r].DedSNo.toString()+"="+this.dgvDeductions.Table[r].DedValue.toString());return(t+=" WHERE SeqNo="+this.EditSeqNo).toString()}},{key:"angularGrid",get:function(){return this.dgvEarnings.angularGrid}},{key:"angularGrid1",get:function(){return this.dgvDeductions.angularGrid}}]),a}(u.b)},MRsC:function(t,e,a){"use strict";a.d(e,"a",(function(){return o})),a.d(e,"c",(function(){return d})),a.d(e,"d",(function(){return h})),a.d(e,"b",(function(){return u}));var s=a("Do2H"),i=a("Lp6j"),l=a("vTM8"),n=a("uMy8"),r=a("n56n"),o=function t(){_classCallCheck(this,t),this.ComponentID=0,this.TaxMap=0,this.DrAccount=0,this.CrAccount=0,this.Type=0,this.SNo=0,this.IsEditable=1,this.IsReadOnly=0,this.IsVisible=1,this.Decimals=0,this.ComponentName="",this.Formula="",this.AddToNet="",this.FieldType="",this.Applicable="",this.Behaviour="",this.Expression="",this.CarryForward="",this.IncludeRExclude="",this.Message="",this.Action="",this.CalculateArrears="",this.CalculateAdjustments="",this.MaxOTHrs=0,this.ROff=0,this.Percentage=0,this.MaxLeaves=0,this.AtATime=0,this.MaxCarryForwardDays=0,this.MaxEncashDays=0,this.dOTDailyValue=0,this.dActual="0",this.dEarned="0",this.dArrear="0",this.dAdjusted="0",this.LoanSlNo="",this.LoanDocNo="",this.LoanInvDocDetailsID="",this.LoanApprovedAmt="",this.LoanInstNo="",this.LoanActInstNo="",this.LoanActInstAmt="",this.LoanInstAmt="",this.LoanBalAmt="",this.LoanPayStatus="",this.LoanNodeNo="",this.LeaveTotOPBal="",this.LeaveMonOPBal="",this.ActLeaveTaken="",this.LeaveTaken="",this.LeaveNetBal="",this.ExtraFieldSNo="",this.ExtraFieldDataType="",this.ExtraFieldUserColumnType="",this.ExtraFieldName="",this.ExtraFieldCaption="",this.ExtraFieldValue="",this.sEarDedType="0",this.IsAccrualType=!1,this.isArrCalculated=!1},d=function t(){_classCallCheck(this,t),this.GradeID=1,this.EmpGradeID=1,this.CurrencyID=1,this.DocID=0,this.StatusID=0,this.VacationComponentID=-1,this.EmpSeqNo="",this.EmpCode="",this.EmpName="",this.DocNo="",this.DocStatus="",this.sErrorMessage="",this.totOTHours="0.00",this.sRemarks="",this.sResignType="",this.sEmpWorkingCountry="",this.sArrCalcMonthPaydays="",this.sArrsCalcMonths="",this.DaysAttended=0,this.PaidLeaves=0,this.TotalLeaves=0,this.WeeklyOffs=0,this.Holidays=0,this.LOPDays=0,this.UnpaidDays=0,this.PaidDays=0,this.TotalDays=0,this.MonthDays=0,this.dServiceDays=0,this.dServiceYears=0,this.dblLeavesLOP=0,this.dblTotVacDays=0,this.dblTotMVacDays=0,this.dblTotVacAmount=0,this.dblTotVacEncashDays=0,this.dblTotVacEncashAmount=0,this.dblTotVacExcessDays=0,this.dblTotVacExcessAmount=0,this.dblTotVacNetAmount=0,this.GratuityAmount=0,this.NetSalary=0,this.dPTApplicableAmt=0,this.BasicMonthly=0,this.dblGrossSalary=0,this.totEarnings=0,this.totEarArrears=0,this.totEarAdjustments=0,this.totOTAmount=0,this.totDeductions=0,this.totDedArrears=0,this.totDedAdjustments=0,this.totActEarnings=0,this.totActDeductions=0,this.totLoans=0,this.totOPBalLeaves=0,this.totLeavesTaken=0,this.totNetBalLeaves=0,this.totAccrualsAct=0,this.totAccrualsEar=0,this.totAccrualsArr=0,this.totAccrualsAdj=0,this.dVacDaysUptoLastMonth=0,this.dGosi=0,this.PTIndex=-1,this.WID=0,this.iExtLoansCnt=0,this.DateOfJoining=i.e.GetEmptyDate(),this.DateOfRelieve=i.e.GetEmptyDate(),this.AppraisalMonth=i.e.GetEmptyDate(),this.IsAlreadyProcessed=!1,this.IsAllowOT=!1,this.IsFinalSettlement=!1},h=function t(){_classCallCheck(this,t),this.EmpSeqNo=0,this.AppliedDays=0,this.NotAttendedDays=0,this.Salary=0,this.Encash=0,this.LOP=0,this.Deductions=0,this.Loans=0,this.OpSalary=0,this.NetSalary=0,this.LOPDays=0,this.EncashDays=0,this.ClosingBalance=0,this.PaidDays=0,this.CreditDays=0,this.ExcessDays=0,this.IsEncashDays=!1,this.PayExcessDaysboolean=!1,this.IsEncashVacationboolean=!1,this.IsLeaveboolean=!1,this.ActRejoinDate=""},c=function t(){_classCallCheck(this,t),this.ID=0,this.SNo=0,this.EmpNode=0,this.TypeId=0,this.ComponentID=0,this.EnCash=0,this.ExcessdaysSalary=0,this.SName="",this.TypeName="",this.ComponentName="",this.Formula="",this.Percentage="",this.Amount="",this.ActualAmount="",this.PercActualAmount=""},u=function(){function t(){_classCallCheck(this,t),this.fldDict=new l.a,this.arrLstCPFields=Array(),this.sEmpSeqNo="0",this.dtAsonDate=new Date,this.dAdjDays=0,this.dsAllEmpsData=null,this.oVacAmountField=null,this.iDocID=0,this.lstAccrAccumulateSNos=new Array,this.isValidGWSlabs=!1,this.isValidBulkAppraisal=!1,this.sEmpType="",this.sGender="",this.sMaritalStatus="",this.sNationality="",this.sReligion="",this.oCPField=null,this.lstHolidays=new Array,this.sFilter="",this.dGosi=0,this.dtHolidayDef=null,this.arrLstOthMPFields=new Array,this.arrLstCPFields=Array(7),this.arrLstCPFields[0]=Array(),this.arrLstCPFields[1]=Array(),this.arrLstCPFields[2]=Array(),this.arrLstCPFields[3]=Array(),this.arrLstCPFields[4]=Array(),this.arrLstCPFields[5]=Array(),this.arrLstCPFields[6]=Array(),this.othMPField=new d,this.arrLstOthMPFields.push(this.othMPField)}return _createClass(t,[{key:"Intialize",value:function(){this.LoadStructure()}},{key:"LoadStructure",value:function(){var t=this;if(""!=this.sEmpSeqNo&&parseInt(this.sEmpSeqNo)>0){this.LeaveYearStartmonth=new Date(this.PayrollMonthStart.getFullYear(),parseInt(s.a.SessionManager.Preferences.LeaveYear.toString()),1),this.LeaveYearEndmonth=this.LeaveYearStartmonth.AddMonths(12).AddDays(-1),this.dsAllEmpsData=s.a.empService.LoadStructure(this.sEmpSeqNo,this.PayrollMonth.ToString("dd/MMM/yyyy"),this.PayrollMonthStart.ToString("dd/MMM/yyyy"),this.PayrollMonthEnd.ToString("dd/MMM/yyyy"));var e=s.a.empService.LoadStructure_1(this.PayrollMonthEnd.ToString("dd/MMM/yyyy"),this.sFilter);null!=e&&e.Tables.length>0&&(this.dvCCData=e.Tables[0]);var a=s.a.empService.GetQueryData(0,"dvDimsData","","","");null!=a&&null!=a&&(this.dvDimsData=a),null!=this.dsAllEmpsData&&this.dsAllEmpsData.Tables.length>0&&this.dsAllEmpsData.Tables[0].length>0&&function(){t.dvAllEmpsData=t.dsAllEmpsData.Tables[0],t.dvStructure=t.othMPField.IsFinalSettlement?t.dsAllEmpsData.Tables[37]:t.dsAllEmpsData.Tables[1],t.dvEmpPay=t.dsAllEmpsData.Tables[2],t.dvEmpPay.length>0&&(t.othMPField.BasicMonthly=i.e.StringIsNullOrEmpty(t.dvEmpPay[0].BasicMonthly)?0:parseFloat(t.dvEmpPay[0].BasicMonthly)),t.dvEmpGrades=t.dsAllEmpsData.Tables[12],t.dvEmpGrades=t.dvEmpGrades.filter((function(e){return e.EmpSeqNo==t.sEmpSeqNo})),t.dvPTDimension=t.dsAllEmpsData.Tables[13],t.dvPTDimension=t.dvPTDimension.filter((function(e){return e.EmpSeqNo==t.sEmpSeqNo})),t.dvAssLeaves=t.dsAllEmpsData.Tables[8],t.dvAssLeaves=t.dvAssLeaves.filter((function(e){return e.EmpSeqNo==t.sEmpSeqNo})),t.dvWOffDef=t.dsAllEmpsData.Tables[4];var e,a=s.a.SessionManager.Preferences.WeeklyOffsDefBasedOn.split(","),l=" 1=1 ",n="";if(e=t.dvWOffDef,null!=a&&a.length>0)for(var r=0;r<a.length;r++)null!=a[r]&&""!=a[r]&&(n="CCNID"+(parseInt(a[r])-5e4),t.dvCCData=t.dvCCData.filter((function(e){return e.EmpSeqNo==t.sEmpSeqNo})),null!=t.dvCCData&&t.dvCCData.length>0&&(n.Contains("CCNID51")?(l+=" AND ( "+n+"="+t.dvCCData[0].EmpSeqNo+" OR "+n+"= 1)",e=e.filter((function(e){return e[n]==t.dvCCData[0].EmpSeqNo||1==e[n]}))):(l+=" AND ( "+n+"="+t.dvCCData[0][n]+" OR "+n+"= 1)",e=e.filter((function(e){return e[n]==t.dvCCData[0][n]||1==e[n]})))));" 1=1 "!=l&&(t.dvWOffDef=e),t.dvHolidayDef=t.dsAllEmpsData.Tables[5];var d=t.dvHolidayDef;if(a=s.a.SessionManager.Preferences.HolidaysBasedOn.split(","),l=" 1=1 ",n="",null!=a&&a.length>0)for(var h=0;h<a.length;h++)null!=a[h]&&""!=a[h]&&(n="CCNID"+(parseInt(a[h])-5e4),t.dvCCData=t.dvCCData.filter((function(e){return e.EmpSeqNo==t.sEmpSeqNo})),null!=t.dvCCData&&t.dvCCData.length>0&&(n.Contains("CCNID51")?(l+=" AND ( "+n+"="+t.dvCCData[0].EmpSeqNo+" OR "+n+"= 1)",d=d.filter((function(e){return e[n]==t.dvCCData[0].EmpSeqNo||1==e[n]}))):(l+=" AND ( "+n+"="+t.dvCCData[0][n]+" OR "+n+"= 1)",d=d.filter((function(e){return e[n]==t.dvCCData[0][n]||1==e[n]})))));if(" 1=1 "!=l&&(t.dvHolidayDef=d),t.dvDependentInfo=t.dsAllEmpsData.Tables[23],t.dvDependentInfo=t.dvDependentInfo.filter((function(e){return e.EmpSeqNo==t.sEmpSeqNo})),t.dvLatesProc=t.dsAllEmpsData.Tables[31],t.dvLatesProc=t.dvLatesProc.filter((function(e){return e.EmpSeqNo==t.sEmpSeqNo})),t.dvApprisal=t.dsAllEmpsData.Tables[34],t.dvApprisal=t.dvApprisal.filter((function(e){return e.EmpSeqNo==t.sEmpSeqNo})),t.dvApprisal.length>0&&(t.AppraisalMonth=new Date(t.dvApprisal[0].CEffectFrom)),t.dvAllApprisal=t.dsAllEmpsData.Tables[35],t.dvAllApprisal=t.dvAllApprisal.filter((function(e){return e.EmpSeqNo==t.sEmpSeqNo})),null!=t.dvAllApprisal&&t.dvAllApprisal.length>0&&(t.dvAllApprisal=t.dvAllApprisal.filter((function(e){return e.CEffectFrom<=t.PayrollMonthEnd.ToString("dd MMM yyyy")})),null!=t.dvAllApprisal&&t.dvAllApprisal.length>1&&(t.dvAllApprisal.sort((function(t,e){return e.CEffectFrom-t.CEffectFrom})),t.dvStructure=t.dvStructure.filter((function(e){return 1==e.Type&&"Yes"==e.Applicable&&e.GradeID==t.othMPField.GradeID})),null!=t.dvStructure&&t.dvStructure.length>0)))for(var c=0;c<t.dvStructure.length;c++)i.e.IsEmpty(s.a.SessionManager.Preferences.GosiComponent)||s.a.SessionManager.Preferences.GosiComponent!=t.dvStructure[c].ComponentID.toString()||(t.dGosi=parseFloat(t.dvAllApprisal[1]["Earning"+parseInt(t.dvStructure[c].SNo)]));var u=0,D=0,p=0;t.lstAccrAccumulateSNos=new Array;var g,m,f,F=0,S=0,y=0,P=0,C=0;if(t.othMPField.dPTApplicableAmt=t.othMPField.dblGrossSalary=0,"Actual Days"==s.a.SessionManager.Preferences.PayDays){var v=i.e.GetDateDifference(t.PayrollMonthEnd,t.PayrollMonthStart);u=parseInt(v.toString())+1}else u=parseInt(s.a.SessionManager.Preferences.PayDays);if(t.othMPField.MonthDays=u,t.othMPField.DateOfJoining=new Date(t.dvAllEmpsData[0].CDOJ),t.othMPField.DateOfRelieve=null==t.dvAllEmpsData[0].CDORelieve||null==t.dvAllEmpsData[0].CDORelieve?new Date("01-Jan-9000"):new Date(t.dvAllEmpsData[0].CDORelieve),t.othMPField.dServiceDays=i.e.GetDateDifference(t.dtAsonDate,t.othMPField.DateOfJoining)+1,t.othMPField.IsAllowOT=null!=t.dvAllEmpsData[0].IsAllowOT&&null!=t.dvAllEmpsData[0].IsAllowOT&&"No"!=t.dvAllEmpsData[0].IsAllowOT.toString(),t.othMPField.GradeID="True"==s.a.SessionManager.Preferences.GradeWiseMonthlyPayroll.toString()&&null!=t.dvEmpGrades&&t.dvEmpGrades.length>0?parseInt(t.dvEmpGrades[0].GradeID):1,t.dvStructure=t.dvStructure.filter((function(e){return e.GradeID==t.othMPField.GradeID})),g=t.dvStructure,t.dvStructure=t.dvStructure.filter((function(e){return 1==e.Type&&"Yes"==e.Applicable&&"OverTime"!=e.FieldType&&e.GradeID==t.othMPField.GradeID})),null!=t.dvStructure&&t.dvStructure.length>0)for(var T=0;T<t.dvStructure.length;T++)t.oCPField=new o,t.oCPField.SNo=parseInt(t.dvStructure[T].SNo),t.oCPField.ComponentID=parseInt(t.dvStructure[T].ComponentID),t.oCPField.ComponentName=t.dvStructure[T].ComponentName.toString(),t.oCPField.Formula=t.dvStructure[T].Formula.toString(),t.oCPField.AddToNet=t.dvStructure[T].AddToNet.toString(),t.oCPField.FieldType=t.dvStructure[T].FieldType.toString(),t.oCPField.ROff=parseFloat(t.dvStructure[T].ROff),t.oCPField.Behaviour=i.e.IsEmpty(t.dvStructure[T].Behaviour)?"":t.dvStructure[T].Behaviour.toString(),"Accruals"!=t.oCPField.Behaviour&&"Accruals-AccumulateForPreviousYears"!=t.oCPField.Behaviour||(t.oCPField.IsAccrualType=!0,"Accruals-AccumulateForPreviousYears"==t.oCPField.Behaviour&&t.lstAccrAccumulateSNos.push(t.oCPField.SNo)),"EmployeeMaster"==t.oCPField.FieldType?(t.oCPField.dActual=t.dvEmpPay.length>0?parseFloat(t.dvEmpPay[0]["Earning"+t.oCPField.SNo]).ToString(s.a.SessionManager.sPayrollDecimals):s.a.SessionManager.Round(0,s.a.SessionManager.sPayrollDecimals),t.oCPField.dEarned=t.oCPField.dActual):(t.oCPField.dActual=s.a.SessionManager.Round(0,s.a.SessionManager.sPayrollDecimals),t.oCPField.dEarned=s.a.SessionManager.Round(0,s.a.SessionManager.sPayrollDecimals)),t.oCPField.dArrear=s.a.SessionManager.Round(0,s.a.SessionManager.sPayrollDecimals),t.oCPField.dAdjusted=s.a.SessionManager.Round(0,s.a.SessionManager.sPayrollDecimals),t.arrLstCPFields[0].push(t.oCPField);if(t.dvStructure=g,t.dvStructure=t.dvStructure.filter((function(e){return 1==e.Type&&"Yes"==e.Applicable&&"OverTime"==e.FieldType&&e.GradeID==t.othMPField.GradeID})),null!=t.dvStructure&&t.dvStructure.length>0)for(var E=0;E<t.dvStructure.length;E++){if(t.oCPField=new o,t.oCPField.SNo=parseInt(t.dvStructure[E].SNo),t.oCPField.ComponentID=parseInt(t.dvStructure[E].ComponentID),t.oCPField.ComponentName=t.dvStructure[E].ComponentName.toString(),t.oCPField.Formula=t.dvStructure[E].Formula.toString(),t.oCPField.AddToNet=t.dvStructure[E].AddToNet.toString(),t.oCPField.FieldType=t.dvStructure[E].FieldType.toString(),t.oCPField.ROff=parseFloat(t.dvStructure[E].ROff),t.othMPField.IsAllowOT)if("True"==s.a.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll){var M=i.e.DTComputeSUM(t.dsAllEmpsData.Tables[14].filter((function(e){return e.EmpSeqNo==+t.sEmpSeqNo})),"OT"+(E+1),!0);t.oCPField.dActual=M.ToString(s.a.SessionManager.sPayrollDecimals2)}else t.oCPField.dActual=s.a.SessionManager.Round(0,s.a.SessionManager.sPayrollDecimals2),t.oCPField.dEarned=s.a.SessionManager.Round(0,s.a.SessionManager.sPayrollDecimals);else t.oCPField.dActual=s.a.SessionManager.Round(0,s.a.SessionManager.sPayrollDecimals2),t.oCPField.dEarned=s.a.SessionManager.Round(0,s.a.SessionManager.sPayrollDecimals);t.oCPField.dArrear=s.a.SessionManager.Round(0,s.a.SessionManager.sPayrollDecimals),t.oCPField.dAdjusted=s.a.SessionManager.Round(0,s.a.SessionManager.sPayrollDecimals),t.arrLstCPFields[1].push(t.oCPField)}if(t.dvStructure=g,t.dvStructure=t.dvStructure.filter((function(e){return 2==e.Type&&"Yes"==e.Applicable&&"OverTime"!=e.FieldType&&e.GradeID==t.othMPField.GradeID})),null!=t.dvStructure&&t.dvStructure.length>0)for(var A=0;A<t.dvStructure.length;A++)t.oCPField=new o,t.oCPField.SNo=parseInt(t.dvStructure[A].SNo),t.oCPField.ComponentID=parseInt(t.dvStructure[A].ComponentID),t.oCPField.ComponentName=t.dvStructure[A].ComponentName.toString(),t.oCPField.Formula=t.dvStructure[A].Formula.toString(),t.oCPField.AddToNet=t.dvStructure[A].AddToNet.toString(),t.oCPField.FieldType=t.dvStructure[A].FieldType.toString(),t.oCPField.ROff=parseFloat(t.dvStructure[A].ROff),"PT"==t.oCPField.ComponentName&&(t.othMPField.PTIndex=A),"EmployeeMaster"==t.oCPField.FieldType?(t.oCPField.dActual=s.a.SessionManager.Round(t.dvEmpPay.length>0?parseFloat(t.dvEmpPay[0]["Deduction"+t.oCPField.SNo]):0,s.a.SessionManager.sPayrollDecimals),t.oCPField.dEarned=t.oCPField.dActual):(t.oCPField.dActual=s.a.SessionManager.Round(0,s.a.SessionManager.sPayrollDecimals),t.oCPField.dEarned=s.a.SessionManager.Round(0,s.a.SessionManager.sPayrollDecimals)),t.oCPField.dArrear=s.a.SessionManager.Round(0,s.a.SessionManager.sPayrollDecimals),t.oCPField.dAdjusted=s.a.SessionManager.Round(0,s.a.SessionManager.sPayrollDecimals),t.arrLstCPFields[2].push(t.oCPField);if(t.dvStructure=g,t.dvStructure=t.dvStructure.filter((function(e){return 2==e.Type&&"Yes"==e.Applicable&&"OverTime"==e.FieldType&&e.GradeID==t.othMPField.GradeID})),null!=t.dvStructure&&t.dvStructure.length>0)for(var b=0;b<t.dvStructure.length;b++)t.oCPField=new o,t.oCPField.SNo=parseInt(t.dvStructure[b].SNo),t.oCPField.ComponentID=parseInt(t.dvStructure[b].ComponentID),t.oCPField.ComponentName=t.dvStructure[b].ComponentName.toString(),t.oCPField.Formula=t.dvStructure[b].Formula.toString(),t.oCPField.AddToNet=t.dvStructure[b].AddToNet.toString(),t.oCPField.FieldType=t.dvStructure[b].FieldType.toString(),t.oCPField.ROff=parseFloat(t.dvStructure[b].ROff),t.oCPField.dActual=s.a.SessionManager.Round(0,s.a.SessionManager.sPayrollDecimals2),t.oCPField.dEarned=s.a.SessionManager.Round(0,s.a.SessionManager.sPayrollDecimals),t.oCPField.dArrear=s.a.SessionManager.Round(0,s.a.SessionManager.sPayrollDecimals),t.oCPField.dAdjusted=s.a.SessionManager.Round(0,s.a.SessionManager.sPayrollDecimals),t.arrLstCPFields[3].push(t.oCPField);t.othMPField.iExtLoansCnt=0;var N,L=0,V=0,I=0;if(t.dvStructure=g,t.dvStructure=t.dvStructure.filter((function(e){return 3==e.Type&&e.GradeID==t.othMPField.GradeID})),null!=t.dvStructure&&null!=t.dvStructure&&t.dvStructure.length>0)for(var w=0,O=0;O<t.dvStructure.length;O++)t.oCPField=new o,t.oCPField.SNo=parseInt(t.dvStructure[O].SNo),t.oCPField.ComponentID=parseInt(t.dvStructure[O].ComponentID),t.oCPField.ComponentName=t.dvStructure[O].ComponentName.toString(),t.oCPField.Formula=t.dvStructure[O].Formula,t.oCPField.AddToNet=t.dvStructure[O].AddToNet,t.oCPField.FieldType=t.dvStructure[O].FieldType,t.oCPField.ROff=null==t.dvStructure[O].ROff||null==t.dvStructure[O].ROff||""==t.dvStructure[O].ROff.toString()?0:parseFloat(t.dvStructure[O].ROff),t.oCPField.IsEditable=0,t.oCPField.IsReadOnly=1,t.oCPField.IsVisible=1,null!=(N=t.dsAllEmpsData.Tables[10].filter((function(e){return e.EmpSeqNo==t.sEmpSeqNo&&e.LoanCompID==t.oCPField.ComponentID&&e.InstBalance>0&&e.DeductionMonth<=t.PayrollMonth.ToString("dd/MMM/yyyy")})))&&null!=N&&N.length>0?function(){w++,V=I=0,t.oCPField.LoanSlNo=w.toString(),t.oCPField.LoanDocNo=N[0].DocNo.toString(),t.oCPField.LoanInvDocDetailsID=N[0].InvDocDetailsID.toString(),t.oCPField.LoanApprovedAmt=N[0].ApprovedAmt.toString();var e="";1==N.length?(t.oCPField.LoanInstNo=N[0].InstallmentNo.toString()+"/"+N[0].NoOfInstallments.toString(),t.oCPField.LoanActInstNo=N[0].InstallmentNo.toString(),e=N[0].InstallmentNo.toString()):(t.oCPField.LoanInstNo=N[N.length-1].InstallmentNo.toString()+"/"+N[0].NoOfInstallments.toString(),t.oCPField.LoanActInstNo=N[N.length-1].InstallmentNo.toString(),e=N[N.length-1].InstallmentNo.toString());var a=t.dsAllEmpsData.Tables[10].filter((function(a){return a.EmpSeqNo==t.sEmpSeqNo&&a.LoanCompID==t.oCPField.ComponentID&&a.InstallmentNo<=e})).Compute("sum","Paid");null!=a&&null!=a&&(V=parseFloat(a)),L=parseFloat(t.oCPField.LoanApprovedAmt)-V,null!=(a=t.dsAllEmpsData.Tables[10].filter((function(a){return a.EmpSeqNo==t.sEmpSeqNo&&a.LoanCompID==t.oCPField.ComponentID&&a.InstallmentNo<=e})).Compute("sum","InstBalance"))&&null!=a&&(I=parseFloat(a)),t.oCPField.LoanActInstAmt=I.toString(),t.oCPField.LoanInstAmt=I.ToString(s.a.SessionManager.sPayrollDecimals),t.oCPField.LoanBalAmt=L.ToString(s.a.SessionManager.sPayrollDecimals),t.oCPField.LoanPayStatus="0",t.oCPField.dActual=parseFloat(t.oCPField.LoanActInstAmt).ToString(s.a.SessionManager.sPayrollDecimals),t.oCPField.dEarned=parseFloat(t.oCPField.LoanInstAmt).ToString(s.a.SessionManager.sPayrollDecimals),t.othMPField.iExtLoansCnt++}():(t.oCPField.IsVisible=0,t.oCPField.dActual=s.a.SessionManager.Round(0,s.a.SessionManager.sPayrollDecimals),t.oCPField.dEarned=s.a.SessionManager.Round(0,s.a.SessionManager.sPayrollDecimals)),t.oCPField.dArrear=s.a.SessionManager.Round(0,s.a.SessionManager.sPayrollDecimals),t.oCPField.dAdjusted=s.a.SessionManager.Round(0,s.a.SessionManager.sPayrollDecimals),t.arrLstCPFields[4].push(t.oCPField);if(t.dvStructure=g,t.dvStructure=t.dvStructure.filter((function(e){return 4==e.Type&&e.GradeID==+t.othMPField.GradeID})),null!=t.dvStructure&&t.dvStructure.length>0)for(var R=0,k=0,G=0,x=0,B=0;B<t.dvStructure.length;B++){t.oCPField=new o,t.oCPField.SNo=parseInt(t.dvStructure[B].SNo),t.oCPField.ComponentID=parseInt(t.dvStructure[B].ComponentID),t.oCPField.ComponentName=t.dvStructure[B].ComponentName.toString(),t.oCPField.Formula=t.dvStructure[B].Formula,t.oCPField.AddToNet=t.dvStructure[B].AddToNet,t.oCPField.FieldType=t.dvStructure[B].FieldType,t.oCPField.ROff=null==t.dvStructure[B].ROff||null==t.dvStructure[B].ROff||""==t.dvStructure[B].ROff.toString()?0:parseFloat(t.dvStructure[B].ROff),t.oCPField.Percentage=parseFloat(t.dvStructure[B].Percentage),t.dvAssLeaves.RowFilter="EmpSeqNo="+t.sEmpSeqNo+" AND LeaveType='"+t.oCPField.ComponentName+"'",t.dvAssLeaves.length>0&&(R=parseFloat(t.dvAssLeaves[0].Total));var _={dTaken:G,dAvail:x};new Date(t.PayrollMonthStart)<=new Date(t.LeaveYearEndmonth)&&new Date(t.PayrollMonthStart)!=new Date(t.LeaveYearStartmonth)&&(t.GetLeavesTaken(t.LeaveYearStartmonth.ToString("dd/MMM/yyyy"),t.PayrollMonthStart.AddDays(-1).ToString("dd/MMM/yyyy"),t.oCPField.ComponentID.toString(),_),G=_.dTaken,x=_.dAvail),_={dTaken:k,dAvail:x},t.GetLeavesTaken(t.PayrollMonthStart.ToString("dd/MMM/yyyy"),t.PayrollMonthEnd.ToString("dd/MMM/yyyy"),t.oCPField.ComponentID.toString(),_),k=_.dTaken,x=_.dAvail,-1!=t.oCPField.MaxLeaves?(t.oCPField.LeaveTotOPBal=(R-G).ToString(s.a.SessionManager.sPayrollDecimals2),t.oCPField.LeaveMonOPBal=x.ToString(s.a.SessionManager.sPayrollDecimals2),t.oCPField.LeaveTaken=k.ToString(s.a.SessionManager.sPayrollDecimals2),t.oCPField.LeaveNetBal=(R-G-k).ToString(s.a.SessionManager.sPayrollDecimals2)):(t.oCPField.LeaveTotOPBal=(0).ToString(s.a.SessionManager.sPayrollDecimals2),t.oCPField.LeaveMonOPBal=(0).ToString(s.a.SessionManager.sPayrollDecimals2),t.oCPField.LeaveTaken=k.ToString(s.a.SessionManager.sPayrollDecimals2),t.oCPField.LeaveNetBal=(0).ToString(s.a.SessionManager.sPayrollDecimals2)),P+=parseFloat(t.oCPField.LeaveTaken),t.oCPField.dActual=(0).ToString(s.a.SessionManager.sPayrollDecimals2),t.oCPField.dEarned=(0).ToString(s.a.SessionManager.sPayrollDecimals2),t.oCPField.dArrear=(0).ToString(s.a.SessionManager.sPayrollDecimals2),t.oCPField.dAdjusted=(0).ToString(s.a.SessionManager.sPayrollDecimals2),parseFloat(t.oCPField.LeaveTaken)>0&&t.oCPField.Percentage>0&&(C+=parseFloat(t.oCPField.LeaveTaken)*t.oCPField.Percentage/100),t.arrLstCPFields[5].push(t.oCPField)}if(t.lstHolidays.Clear(),null!=t.dtHolidayDef&&t.dtHolidayDef.length>0)for(var W=0;W<t.dtHolidayDef.length;W++)t.lstHolidays.push(new Date(t.dtHolidayDef[W].HolidayDate));y+=t.GetUnpaidDays();var Y=t.othMPField.DateOfJoining>t.PayrollMonthStart?t.othMPField.DateOfJoining:t.PayrollMonthStart,j=t.othMPField.DateOfRelieve<t.PayrollMonthEnd?t.othMPField.DateOfRelieve:t.PayrollMonthEnd;if(D=-1,p=-1,t.dvWOffDef.length>0)F=t.CalculateWeeklyOffsFromDef();else{var U="",q="";switch(U="NONE"!=t.dvAllEmpsData[0].WeeklyOff1.toString().toUpperCase()?t.dvAllEmpsData[0].WeeklyOff1.toString():s.a.SessionManager.Preferences.WeeklyOff1.toString(),"NONE"!=t.dvAllEmpsData[0].WeeklyOff2.toString().toUpperCase()?t.dvAllEmpsData[0].WeeklyOff2.toString().toUpperCase()!=U.toUpperCase()&&(q=t.dvAllEmpsData[0].WeeklyOff2.toString()):q=s.a.SessionManager.Preferences.WeeklyOff2.toString(),U){case"Sunday":D=0;break;case"Monday":D=1;break;case"Tuesday":D=2;break;case"Wednesday":D=3;break;case"Thursday":D=4;break;case"Friday":D=5;break;case"Saturday":D=6}switch(q){case"Sunday":p=0;break;case"Monday":p=1;break;case"Tuesday":p=2;break;case"Wednesday":p=3;break;case"Thursday":p=4;break;case"Friday":p=5;break;case"Saturday":p=6}if(-1!=D){var H=Y;for(parseInt(H.getDay().toString())<D?H=H.AddDays(D-parseInt(H.getDay().toString())):parseInt(H.getDay().toString())>D&&(H=H.AddDays(7-(parseInt(H.getDay().toString())-D)));H<=j;)t.lstHolidays.Contains(H)||F++,H=H.AddDays(7)}if(-1!=p&&D!=p){var J=Y;for(parseInt(J.getDay().toString())<p?J=J.AddDays(p-parseInt(J.getDay().toString())):parseInt(J.getDay().toString())>p&&(J=J.AddDays(7-(parseInt(J.getDay().toString())-p)));J<=j;)t.lstHolidays.Contains(J)||F++,J=J.AddDays(7)}}for(var Q=0;Q<t.lstHolidays.length;Q++)t.lstHolidays[Q]>=t.othMPField.DateOfJoining&&t.lstHolidays[Q]<=t.othMPField.DateOfRelieve&&S++;m=u-((f=F+S)+P+y),t.othMPField.DaysAttended=f,t.othMPField.TotalLeaves=P,t.othMPField.PaidLeaves=C,t.othMPField.WeeklyOffs=F,t.othMPField.Holidays=S,t.othMPField.LOPDays=m,t.othMPField.UnpaidDays=y,t.othMPField.TotalDays=f+P+m+y,t.othMPField.PaidDays=f+C}()}}},{key:"ExecuteAllFormulas",value:function(){var t=this;try{if(Logger.InfoLog("CommonMonthlyPayroll::Entering ExecuteAllFormulas()"),this.othMPField.dblGrossSalary=0,this.ExecuteFormulas(!0),this.ExecuteFormulas(!1),this.ExecuteFormulas(!1),this.ExecuteFormulas(!0),this.ExecuteFormulas(!1),this.ExecuteFormulas(!1),this.othMPField.dblGrossSalary=this.othMPField.totEarnings,this.othMPField.PTIndex>=0){var e=this.dsAllEmpsData.Tables[3];if(this.dvPTDimension.length>0){var a=this.dsAllEmpsData.Tables[3];if(null!=(a=a.filter((function(e){return e.NodeID==i.e.String(t.dvPTDimension[0].PTDimension)&&""!=e.Formula})))&&a.length>0&&!i.e.IsEmpty(a[0].Formula)){var l=this.fldDict,n=parseFloat(s.a.eval.EvaluateExpression(a[0].Formula.toString(),l));this.arrLstCPFields[2][this.othMPField.PTIndex].dEarned=n.ToString(s.a.SessionManager.sPayrollDecimals),this.arrLstCPFields[2][this.othMPField.PTIndex].dActual=n.ToString(s.a.SessionManager.sPayrollDecimals)}else(e=e.filter((function(e){return e.NodeID==i.e.String(t.dvPTDimension[0].PTDimension)&&e.FromSlab<=t.othMPField.dPTApplicableAmt&&e.ToSlab>=t.othMPField.dPTApplicableAmt}))).length>0?(this.arrLstCPFields[2][this.othMPField.PTIndex].dEarned=parseFloat(e[0].Amount).ToString(s.a.SessionManager.sPayrollDecimals),this.arrLstCPFields[2][this.othMPField.PTIndex].dActual=parseFloat(e[0].Amount).ToString(s.a.SessionManager.sPayrollDecimals)):(this.arrLstCPFields[2][this.othMPField.PTIndex].dEarned=s.a.SessionManager.Round(0,s.a.SessionManager.sPayrollDecimals),this.arrLstCPFields[2][this.othMPField.PTIndex].dActual=s.a.SessionManager.Round(0,s.a.SessionManager.sPayrollDecimals))}}this.othMPField.totEarnings=this.othMPField.totDeductions=this.othMPField.totActEarnings=0,this.othMPField.totActDeductions=this.othMPField.totLoans=this.othMPField.totOPBalLeaves=0,this.othMPField.totLeavesTaken=this.othMPField.totNetBalLeaves=0,this.othMPField.totEarArrears=this.othMPField.totDedArrears=0,this.othMPField.totEarAdjustments=this.othMPField.totDedAdjustments=0,this.othMPField.totOTAmount=0;for(var r=0;r<this.arrLstCPFields[0].length;r++)""!=this.arrLstCPFields[0][r].SNo.toString()&&(null==this.arrLstCPFields[0][r].AddToNet||""==this.arrLstCPFields[0][r].AddToNet||"Net"!=this.arrLstCPFields[0][r].AddToNet&&"NetAndTax"!=this.arrLstCPFields[0][r].AddToNet||(this.othMPField.totActEarnings+=parseFloat(this.arrLstCPFields[0][r].dActual),this.othMPField.totEarnings+=parseFloat(this.arrLstCPFields[0][r].dEarned),this.othMPField.totEarArrears+=parseFloat(this.arrLstCPFields[0][r].dArrear),this.othMPField.totEarAdjustments+=parseFloat(this.arrLstCPFields[0][r].dAdjusted)));for(var o,d=new Date(1,1,1,0,0,0),h=0;h<this.arrLstCPFields[1].length;h++)""!=this.arrLstCPFields[1][h].SNo.toString()&&(null==this.arrLstCPFields[1][h].AddToNet||""==this.arrLstCPFields[1][h].AddToNet||"Net"!=this.arrLstCPFields[1][h].AddToNet&&"NetAndTax"!=this.arrLstCPFields[1][h].AddToNet||(o=this.arrLstCPFields[1][h].dActual.toString().split("."),d=d.AddHours(parseFloat(o[0])),o.length>1&&(1==o[1].length&&(o[1]=o[1]+"0"),d=d.AddMinutes(parseFloat(o[1]))),this.othMPField.totOTAmount+=parseFloat(this.arrLstCPFields[1][h].dEarned)));var c=d.getMinutes().toString();1==c.length&&(c="0"+c),this.othMPField.totOTHours=d.getHours()+"."+c;for(var u=0;u<this.arrLstCPFields[2].length;u++)""!=this.arrLstCPFields[2][u].SNo.toString()&&(null==this.arrLstCPFields[2][u].AddToNet||""==this.arrLstCPFields[2][u].AddToNet||"Net"!=this.arrLstCPFields[2][u].AddToNet&&"NetAndTax"!=this.arrLstCPFields[2][u].AddToNet||(this.othMPField.totActDeductions+=parseFloat(this.arrLstCPFields[2][u].dActual),this.othMPField.totDeductions+=parseFloat(this.arrLstCPFields[2][u].dEarned),this.othMPField.totDedArrears+=parseFloat(this.arrLstCPFields[2][u].dArrear),this.othMPField.totDedAdjustments+=parseFloat(this.arrLstCPFields[2][u].dAdjusted)));for(var D=0;D<this.arrLstCPFields[4].length;D++)""!=this.arrLstCPFields[4][D].SNo.toString()&&1==this.arrLstCPFields[4][D].IsVisible&&null!=this.arrLstCPFields[4][D].LoanInstAmt&&""!=this.arrLstCPFields[4][D].LoanInstAmt.toString()&&parseFloat(this.arrLstCPFields[4][D].LoanInstAmt)>0&&(this.othMPField.totLoans+=parseFloat(this.arrLstCPFields[4][D].LoanInstAmt));for(var p=0;p<this.arrLstCPFields[5].length;p++)""!=this.arrLstCPFields[5][p].SNo.toString()&&(null!=this.arrLstCPFields[5][p].LeaveTotOPBal&&""!=this.arrLstCPFields[5][p].LeaveTotOPBal.toString()&&(this.othMPField.totOPBalLeaves+=parseFloat(this.arrLstCPFields[5][p].LeaveTotOPBal)),null!=this.arrLstCPFields[5][p].LeaveTaken&&""!=this.arrLstCPFields[5][p].LeaveTaken.toString()&&(this.othMPField.totLeavesTaken+=parseFloat(this.arrLstCPFields[5][p].LeaveTaken)),null!=this.arrLstCPFields[5][p].LeaveNetBal&&""!=this.arrLstCPFields[5][p].LeaveNetBal.toString()&&(this.othMPField.totNetBalLeaves+=parseFloat(this.arrLstCPFields[5][p].LeaveNetBal)));this.othMPField.NetSalary=parseFloat(i.e.GetAmountsBasedOnPref(this.othMPField.totEarnings+this.othMPField.totEarArrears+this.othMPField.totEarAdjustments+this.othMPField.totOTAmount-(this.othMPField.totDeductions+this.othMPField.totDedArrears+this.othMPField.totDedAdjustments+this.othMPField.totLoans),s.a.SessionManager.sPayrollDecimals.replace("N",""))),Logger.InfoLog("CommonMonthlyPayroll::Exiting ExecuteAllFormulas()")}catch(g){Logger.ErrorLog("CommonMonthlyPayroll::EXCEPTION ExecuteAllFormulas()"+g.stack)}}},{key:"ExecuteFormulas",value:function(t){var e=this;try{Logger.InfoLog("CommonMonthlyPayroll::Entering ExecuteFormulas()"),this.fldDict=new l.a;var a,o="0";this.othMPField.totEarnings=this.othMPField.totDeductions=this.othMPField.totActEarnings=0,this.othMPField.totActDeductions=this.othMPField.totLoans=this.othMPField.totOPBalLeaves=0,this.othMPField.totLeavesTaken=this.othMPField.totNetBalLeaves=0,this.othMPField.totEarArrears=this.othMPField.totDedArrears=0,this.othMPField.totEarAdjustments=this.othMPField.totDedAdjustments=0,this.othMPField.totOTAmount=0,a=new n.c("Basic",""),this.fldDict.push("Basic",a),this.fldDict.Basic.setFieldValue(this.othMPField.BasicMonthly),a=new n.c("Gross",""),this.fldDict.push("Gross",a),this.fldDict.Gross.setFieldValue(this.othMPField.dblGrossSalary),a=new n.c("ServiceDays",""),this.fldDict.push("ServiceDays",a),this.fldDict.ServiceDays.setFieldValue(this.othMPField.dServiceDays),a=new n.c("ServiceYears",""),this.fldDict.push("ServiceYears",a),this.fldDict.ServiceYears.setFieldValue(this.othMPField.dServiceYears),a=new n.c("ResignType",""),this.fldDict.push("ResignType",a),this.fldDict.ResignType.setFieldValue(this.othMPField.sResignType),a=new n.c("GratuityAmount",""),this.fldDict.push("GratuityAmount",a),this.fldDict.GratuityAmount.setFieldValue(this.othMPField.GratuityAmount),a=new n.c("WeeklyOffs",""),this.fldDict.push("WeeklyOffs",a),this.fldDict.WeeklyOffs.setFieldValue(this.othMPField.WeeklyOffs),a=new n.c("LeavesTaken",""),this.fldDict.push("LeavesTaken",a),this.fldDict.LeavesTaken.setFieldValue(this.othMPField.TotalLeaves),a=new n.c("VacDaysTaken",""),this.fldDict.push("VacDaysTaken",a),this.fldDict.VacDaysTaken.setFieldValue(this.othMPField.dblTotVacDays),a=new n.c("VacDays",""),this.fldDict.push("VacDays",a),this.fldDict.VacDays.setFieldValue(this.othMPField.dblTotMVacDays),a=new n.c("VacAmount",""),this.fldDict.push("VacAmount",a),this.fldDict.VacAmount.setFieldValue(this.othMPField.dblTotVacAmount),a=new n.c("VacEncashDays",""),this.fldDict.push("VacEncashDays",a),this.fldDict.VacEncashDays.setFieldValue(this.othMPField.dblTotVacEncashDays),a=new n.c("VacEncashAmount",""),this.fldDict.push("VacEncashAmount",a),this.fldDict.VacEncashAmount.setFieldValue(this.othMPField.dblTotVacEncashAmount),a=new n.c("VacExcessDays",""),this.fldDict.push("VacExcessDays",a),this.fldDict.VacExcessDays.setFieldValue(this.othMPField.dblTotVacExcessDays),a=new n.c("VacExcessAmount",""),this.fldDict.push("VacExcessAmount",a),this.fldDict.VacExcessAmount.setFieldValue(this.othMPField.dblTotVacExcessAmount),a=new n.c("VacNetAmount",""),this.fldDict.push("VacNetAmount",a),this.fldDict.VacNetAmount.setFieldValue(this.othMPField.dblTotVacNetAmount),a=new n.c("TotalDays",""),this.fldDict.push("TotalDays",a),this.fldDict.TotalDays.setFieldValue(this.othMPField.TotalDays),a=new n.c("DaysAttended",""),this.fldDict.push("DaysAttended",a),this.fldDict.DaysAttended.setFieldValue(t?this.othMPField.TotalDays:this.othMPField.DaysAttended+this.othMPField.TotalLeaves),a=new n.c("UnpaidDays",""),this.fldDict.push("UnpaidDays",a),this.fldDict.UnpaidDays.setFieldValue(this.othMPField.UnpaidDays),a=new n.c("LOPDays",""),this.fldDict.push("LOPDays",a),this.fldDict.LOPDays.setFieldValue(this.othMPField.LOPDays),a=new n.c("Holidays",""),this.fldDict.push("Holidays",a),this.fldDict.Holidays.setFieldValue(this.othMPField.Holidays),a=new n.c("AdjDays",""),this.fldDict.push("AdjDays",a),this.fldDict.AdjDays.setFieldValue(this.dAdjDays),a=new n.c("EmpType",""),this.fldDict.push("EmpType",a),this.fldDict.EmpType.setFieldValue(this.dvAllEmpsData[0].sEmpType.toString()),a=new n.c("Gender",""),this.fldDict.push("Gender",a),this.fldDict.Gender.setFieldValue(this.dvAllEmpsData[0].sGender.toString()),a=new n.c("MaritalStatus",""),this.fldDict.push("MaritalStatus",a),this.fldDict.MaritalStatus.setFieldValue(this.dvAllEmpsData[0].sMaritalStatus.toString()),a=new n.c("Nationality",""),this.fldDict.push("Nationality",a),this.fldDict.Nationality.setFieldValue(this.dvAllEmpsData[0].sNationality.toString()),a=new n.c("Religion",""),this.fldDict.push("Religion",a),this.fldDict.Religion.setFieldValue(this.dvAllEmpsData[0].sReligion.toString()),this.isValidGWSlabs&&(this.fldDict.EmpType.setFieldValue(this.sEmpType),this.fldDict.Gender.setFieldValue(this.sGender),this.fldDict.MaritalStatus.setFieldValue(this.sMaritalStatus),this.fldDict.Nationality.setFieldValue(this.sNationality),this.fldDict.Religion.setFieldValue(this.sReligion)),a=new n.c("ChildrenCount",""),this.fldDict.push("ChildrenCount",a),null!=this.dvDependentInfo?(this.dvDependentInfo.RowFilter="EmpSeqNo="+this.sEmpSeqNo+" AND Relation='Children'",this.fldDict.ChildrenCount.setFieldValue(this.dvDependentInfo.length)):this.fldDict.ChildrenCount.setFieldValue(0),a=new n.c("ChildrenDays",""),this.fldDict.push("ChildrenDays",a);var d=0;if(null!=this.dvDependentInfo&&null!=this.dvDependentInfo&&(this.dvDependentInfo=this.dvDependentInfo.filter((function(t){return t.EmpSeqNo=e.sEmpSeqNo&&"Children"==t.Relation}))),null!=this.dvDependentInfo&&this.dvDependentInfo.length>0)for(var h=this.dvDependentInfo,c=0;c<h.length;c++)if(new Date(h.Rows[c].ChildDOB)>=this.PayrollMonthStart&&new Date(h.Rows[c].ChildDOB)<=this.PayrollMonthEnd)d+=i.e.GetDateDifference(this.PayrollMonthEnd,new Date(h.Rows[c].ChildDOB))+1;else{var u=0,D=0,p=0,g={iY:u,iM:D,iD:p};i.e.GetYearsMonthsDays(new Date(h.Rows[c].ChildDOB),this.PayrollMonthEnd,g),D=g.iM,p=g.iD,18==(u=g.iY)&&0==D?d+=i.e.GetDateDifference(this.PayrollMonthEnd,this.PayrollMonthStart)+1-p:u<18&&(d+=i.e.GetDateDifference(this.PayrollMonthEnd,this.PayrollMonthStart)+1)}this.fldDict.ChildrenDays.setFieldValue(d),a=new n.c("PayrollMonthNo",""),this.fldDict.push("PayrollMonthNo",a),this.fldDict.PayrollMonthNo.setFieldValue(this.PayrollMonth.iMonth()),a=new n.c("PayrollYearNo",""),this.fldDict.push("PayrollYearNo",a),this.fldDict.PayrollYearNo.setFieldValue(this.PayrollMonth.getFullYear()),a=new n.c("DOJMonth",""),this.fldDict.push("DOJMonth",a),this.fldDict.DOJMonth.setFieldValue(new Date(this.dvAllEmpsData[0].CDOJ).iMonth()),a=new n.c("DOJYear",""),this.fldDict.push("DOJYear",a),this.fldDict.DOJYear.setFieldValue(new Date(this.dvAllEmpsData[0].CDOJ).getFullYear()),a=new n.c("DORMonth",""),this.fldDict.push("DORMonth",a),i.e.IsEmpty(this.dvAllEmpsData[0].CDORelieve)?this.fldDict.DORMonth.setFieldValue(1):this.fldDict.DORMonth.setFieldValue(new Date(this.dvAllEmpsData[0].CDORelieve).iMonth()),a=new n.c("DORYear",""),this.fldDict.push("DORYear",a),i.e.IsEmpty(this.dvAllEmpsData[0].CDORelieve)?this.fldDict.DORYear.setFieldValue(2200):this.fldDict.DORYear.setFieldValue(new Date(this.dvAllEmpsData[0].CDORelieve).getFullYear()),a=new n.c("EmpConfirmationDate",""),this.fldDict.Add("EmpConfirmationDate",a);var m=new Date;i.e.isValidDate(this.dvAllEmpsData[0].CDOC)&&(m=new Date(this.dvAllEmpsData[0].CDOC)),this.fldDict.EmpConfirmationDate.setFieldValue(m),a=new n.c("LeaveFromDate",""),this.fldDict.Add("LeaveFromDate",a),this.fldDict.LeaveFromDate.setFieldValue(new Date),a=new n.c("LeaveNoOfDays",""),this.fldDict.Add("LeaveNoOfDays",a),this.fldDict.LeaveNoOfDays.setFieldValue(0),a=new n.c("EmpVacationDays",""),this.fldDict.Add("EmpVacationDays",a),this.fldDict.EmpVacationDays.setFieldValue(this.dvAllEmpsData[0].VacDaysPerMonth),a=new n.c("AppraisalMonthNo",""),this.fldDict.push("AppraisalMonthNo",a),this.fldDict.AppraisalMonthNo.setFieldValue(this.dvApprisal.length>0?this.AppraisalMonth.iMonth():0),this.isValidBulkAppraisal&&this.fldDict.AppraisalMonthNo.setFieldValue(this.EffectFrom.iMonth()),a=new n.c("VacDaysPayYes",""),this.fldDict.push("VacDaysPayYes",a),this.fldDict.VacDaysPayYes.setFieldValue(0),a=new n.c("VacDaysPayNo",""),this.fldDict.push("VacDaysPayNo",a),this.fldDict.VacDaysPayNo.setFieldValue(0),a=new n.c("PreviousGosiValue",""),this.fldDict.push("PreviousGosiValue",a),this.fldDict.PreviousGosiValue.setFieldValue(this.dGosi);var f=0,F=0,S=0,y=0,P=0,C=0,v=0,T=0,E=0,M=0,A=0;null!=this.dvLatesProc&&(this.dvLatesProc=this.dvLatesProc.filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),this.dvLatesProc.length>0&&(f=parseFloat(this.dvLatesProc[0].TotCheckInLateMins),F=parseFloat(this.dvLatesProc[0].TotCheckOutEarlyMins),S=parseFloat(this.dvLatesProc[0].TotBreak1MoreMins),y=parseFloat(this.dvLatesProc[0].TotBreak2MoreMins),P=parseFloat(this.dvLatesProc[0].TotBreak3MoreMins),C=parseFloat(this.dvLatesProc[0].TotBreak4MoreMins),v=parseFloat(this.dvLatesProc[0].TotBreak5MoreMins),T=parseFloat(this.dvLatesProc[0].TotLateHrsToDeduct),E=parseFloat(this.dvLatesProc[0].TotLateLeavesToDeduct),M=parseFloat(this.dvLatesProc[0].TotWorkingMinsLessBy),A=parseFloat(this.dvLatesProc[0].TotAbsentMinsLessBy))),a=new n.c("TotCheckInLateMins",""),this.fldDict.push("TotCheckInLateMins",a),this.fldDict.TotCheckInLateMins.setFieldValue(f),a=new n.c("TotCheckOutEarlyMins",""),this.fldDict.push("TotCheckOutEarlyMins",a),this.fldDict.TotCheckOutEarlyMins.setFieldValue(F),a=new n.c("TotBreak1MoreMins",""),this.fldDict.push("TotBreak1MoreMins",a),this.fldDict.TotBreak1MoreMins.setFieldValue(S),a=new n.c("TotBreak2MoreMins",""),this.fldDict.push("TotBreak2MoreMins",a),this.fldDict.TotBreak2MoreMins.setFieldValue(y),a=new n.c("TotBreak3MoreMins",""),this.fldDict.push("TotBreak3MoreMins",a),this.fldDict.TotBreak3MoreMins.setFieldValue(P),a=new n.c("TotBreak4MoreMins",""),this.fldDict.push("TotBreak4MoreMins",a),this.fldDict.TotBreak4MoreMins.setFieldValue(C),a=new n.c("TotBreak5MoreMins",""),this.fldDict.push("TotBreak5MoreMins",a),this.fldDict.TotBreak5MoreMins.setFieldValue(v),a=new n.c("TotLateHrsToDeduct",""),this.fldDict.push("TotLateHrsToDeduct",a),this.fldDict.TotLateHrsToDeduct.setFieldValue(T),a=new n.c("TotLateLeavesToDeduct",""),this.fldDict.push("TotLateLeavesToDeduct",a),this.fldDict.TotLateLeavesToDeduct.setFieldValue(E),a=new n.c("TotWorkingMinsLessBy",""),this.fldDict.push("TotWorkingMinsLessBy",a),this.fldDict.TotWorkingMinsLessBy.setFieldValue(M),a=new n.c("TotAbsentMinsLessBy",""),this.fldDict.push("TotAbsentMinsLessBy",a),this.fldDict.TotAbsentMinsLessBy.setFieldValue(A),this.dvCCData=this.dvCCData.filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo}));var b="",N="";if(a=new n.c("RptManagerCode",""),this.fldDict.push("RptManagerCode",a),a=new n.c("RptManagerName",""),this.fldDict.push("RptManagerName",a),this.dvCCData.length>0&&!i.e.IsEmpty(this.dvCCData[0].RptManager)){var L=this.dvDimsData.filter((function(t){return"RptManager"==t.SysColName&&t.NodeID==e.dvCCData[0].RptManager.toString()}));L.length>0&&(b=L[0].Code.toString(),N=L[0].Name.toString())}if(this.fldDict.RptManagerCode.setFieldValue(b),this.fldDict.RptManagerName.setFieldValue(N),this.dvCCData.length>0)for(var V=function(t){var s=Object.keys(e.dvCCData[0])[t];if(!s.Contains("CCNID"))return"continue";var i=e.dvDimsData.filter((function(t){return t.SysColName==s}));if(i.length>0){var l=i[0].UserColumnName.toString();if(a=new n.c(i[0].UserColumnName.toString()+"Code",""),e.fldDict.push(i[0].UserColumnName.toString()+"Code",a),a=new n.c(i[0].UserColumnName.toString()+"Name",""),e.fldDict.push(i[0].UserColumnName.toString()+"Name",a),(i=e.dvDimsData.filter((function(t){return t.SysColName==s&&t.NodeID==e.dvCCData[0][s].toString()}))).length>0?(e.fldDict[i[0].UserColumnName.toString()+"Code"].setFieldValue(i[0].Code.toString()),e.fldDict[i[0].UserColumnName.toString()+"Name"].setFieldValue(i[0].Name.toString())):(e.fldDict[l+"Code"].setFieldValue(""),e.fldDict[l+"Name"].setFieldValue("")),e.isValidGWSlabs){var o=e.Parent.ScreenObject.GetCustomField(s);if(null!=o&&null!=o){var d="";(o instanceof r.b||o instanceof r.a)&&(d=o.SelectedValue.toString()),"0"==d&&(d="1"),(i=e.dvDimsData.filter((function(t){return t.SysColName==s&&t.NodeID==d}))).length>0?(e.fldDict[i[0].UserColumnName.toString()+"Code"].setFieldValue(i[0].Code.toString()),e.fldDict[i[0].UserColumnName.toString()+"Name"].setFieldValue(i[0].Name.toString())):(e.fldDict[l+"Code"].setFieldValue(""),e.fldDict[l+"Name"].setFieldValue(""))}}}},I=0;I<Object.keys(this.dvCCData[0]).length;I++)V(I);for(var w=0;w<this.arrLstCPFields[0].length;w++)i.e.IsEmpty(this.arrLstCPFields[0][w].SNo)||(a=new n.c(this.arrLstCPFields[0][w].ComponentName,""),this.fldDict.push(this.arrLstCPFields[0][w].ComponentName,a),this.fldDict[this.arrLstCPFields[0][w].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[0][w].dActual).ToString(s.a.SessionManager.sPayrollDecimals)),a=new n.c("Calc"+this.arrLstCPFields[0][w].ComponentName,""),this.fldDict.push("Calc"+this.arrLstCPFields[0][w].ComponentName,a),this.fldDict["Calc"+this.arrLstCPFields[0][w].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[0][w].dEarned).ToString(s.a.SessionManager.sPayrollDecimals)),a=new n.c("Arr_"+this.arrLstCPFields[0][w].ComponentName,""),this.fldDict.push("Arr_"+this.arrLstCPFields[0][w].ComponentName,a),this.fldDict["Arr_"+this.arrLstCPFields[0][w].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[0][w].dArrear).ToString(s.a.SessionManager.sPayrollDecimals)),a=new n.c("Adj_"+this.arrLstCPFields[0][w].ComponentName,""),this.fldDict.push("Adj_"+this.arrLstCPFields[0][w].ComponentName,a),this.fldDict["Adj_"+this.arrLstCPFields[0][w].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[0][w].dAdjusted).ToString(s.a.SessionManager.sPayrollDecimals)));for(var O=0;O<this.arrLstCPFields[1].length;O++)i.e.IsEmpty(this.arrLstCPFields[1][O].SNo)||(a=new n.c(this.arrLstCPFields[1][O].ComponentName,""),this.fldDict.push(this.arrLstCPFields[1][O].ComponentName,a),this.fldDict[this.arrLstCPFields[1][O].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[1][O].dActual).ToString(s.a.SessionManager.sPayrollDecimals2)),a=new n.c("Calc"+this.arrLstCPFields[1][O].ComponentName,""),this.fldDict.push("Calc"+this.arrLstCPFields[1][O].ComponentName,a),this.fldDict["Calc"+this.arrLstCPFields[1][O].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[1][O].dEarned).ToString(s.a.SessionManager.sPayrollDecimals)),a=new n.c("Arr_"+this.arrLstCPFields[1][O].ComponentName,""),this.fldDict.push("Arr_"+this.arrLstCPFields[1][O].ComponentName,a),this.fldDict["Arr_"+this.arrLstCPFields[1][O].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[1][O].dArrear).ToString(s.a.SessionManager.sPayrollDecimals)),a=new n.c("Adj_"+this.arrLstCPFields[1][O].ComponentName,""),this.fldDict.push("Adj_"+this.arrLstCPFields[1][O].ComponentName,a),this.fldDict["Adj_"+this.arrLstCPFields[1][O].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[1][O].dAdjusted).ToString(s.a.SessionManager.sPayrollDecimals)));for(var R=0;R<this.arrLstCPFields[2].length;R++)""!=this.arrLstCPFields[2][R].SNo.toString()&&(a=new n.c(this.arrLstCPFields[2][R].ComponentName,""),this.fldDict.push(this.arrLstCPFields[2][R].ComponentName,a),this.fldDict[this.arrLstCPFields[2][R].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[2][R].dActual).ToString(s.a.SessionManager.sPayrollDecimals)),a=new n.c("Calc"+this.arrLstCPFields[2][R].ComponentName,""),this.fldDict.push("Calc"+this.arrLstCPFields[2][R].ComponentName,a),this.fldDict["Calc"+this.arrLstCPFields[2][R].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[2][R].dEarned).ToString(s.a.SessionManager.sPayrollDecimals)),a=new n.c("Arr_"+this.arrLstCPFields[2][R].ComponentName,""),this.fldDict.push("Arr_"+this.arrLstCPFields[2][R].ComponentName,a),this.fldDict["Arr_"+this.arrLstCPFields[2][R].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[2][R].dArrear).ToString(s.a.SessionManager.sPayrollDecimals)),a=new n.c("Adj_"+this.arrLstCPFields[2][R].ComponentName,""),this.fldDict.push("Adj_"+this.arrLstCPFields[2][R].ComponentName,a),this.fldDict["Adj_"+this.arrLstCPFields[2][R].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[2][R].dAdjusted).ToString(s.a.SessionManager.sPayrollDecimals)));for(var k=0;k<this.arrLstCPFields[4].length;k++)""!=this.arrLstCPFields[4][k].SNo.toString()&&(a=new n.c(this.arrLstCPFields[4][k].ComponentName,""),this.fldDict.push(this.arrLstCPFields[4][k].ComponentName,a),a=new n.c(this.arrLstCPFields[4][k].ComponentName+"BalAmt",""),this.fldDict.push(this.arrLstCPFields[4][k].ComponentName+"BalAmt",a)),1==this.arrLstCPFields[4][k].IsVisible&&null!=this.arrLstCPFields[4][k].LoanInstAmt&&""!=this.arrLstCPFields[4][k].LoanInstAmt.toString()&&parseFloat(this.arrLstCPFields[4][k].LoanInstAmt)>0?(this.fldDict[this.arrLstCPFields[4][k].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[4][k].LoanInstAmt).ToString(s.a.SessionManager.sPayrollDecimals)),this.fldDict[this.arrLstCPFields[4][k].ComponentName+"BalAmt"].setFieldValue(parseFloat(this.arrLstCPFields[4][k].LoanBalAmt).ToString(s.a.SessionManager.sPayrollDecimals))):(this.fldDict[this.arrLstCPFields[4][k].ComponentName].setFieldValue(0),this.fldDict[this.arrLstCPFields[4][k].ComponentName+"BalAmt"].setFieldValue(0));for(var G=0;G<this.arrLstCPFields[5].length;G++)""!=this.arrLstCPFields[5][G].SNo.toString()&&(a=new n.c(this.arrLstCPFields[5][G].ComponentName,""),this.fldDict.push(this.arrLstCPFields[5][G].ComponentName,a),this.fldDict[this.arrLstCPFields[5][G].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[5][G].LeaveTaken).ToString(s.a.SessionManager.sPayrollDecimals2)),a=new n.c(this.arrLstCPFields[5][G].ComponentName+"_Bal",""),this.fldDict.push(this.arrLstCPFields[5][G].ComponentName+"_Bal",a),this.fldDict[this.arrLstCPFields[5][G].ComponentName+"_Bal"].setFieldValue(parseFloat(this.arrLstCPFields[5][G].LeaveTotOPBal).ToString(s.a.SessionManager.sPayrollDecimals2)));for(var x=0;x<this.arrLstCPFields[6].length;x++)""!=this.arrLstCPFields[6][x].SNo.toString()&&(a=new n.c(this.arrLstCPFields[6][x].ComponentName,""),this.fldDict.push(this.arrLstCPFields[6][x].ComponentName,a),this.fldDict[this.arrLstCPFields[6][x].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[6][x].dEarned).ToString(s.a.SessionManager.sPayrollDecimals)));for(var B=this.fldDict,_=0;_<this.arrLstCPFields[0].length;_++)""!=this.arrLstCPFields[0][_].SNo.toString()&&null!=this.arrLstCPFields[0][_].Formula&&""!=this.arrLstCPFields[0][_].Formula&&(this.arrLstCPFields[0][_].dEarned=parseFloat(s.a.eval.EvaluateExpression(this.arrLstCPFields[0][_].Formula,B)).ToString(s.a.SessionManager.sPayrollDecimals).Replace(",",""),this.fldDict["Calc"+this.arrLstCPFields[0][_].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[0][_].dEarned).ToString(s.a.SessionManager.sPayrollDecimals)),t&&"Formula"==this.arrLstCPFields[0][_].FieldType&&(this.arrLstCPFields[0][_].dActual=this.arrLstCPFields[0][_].dEarned.Replace(",",""),this.fldDict[this.arrLstCPFields[0][_].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[0][_].dActual).ToString(s.a.SessionManager.sPayrollDecimals))));for(var W=0;W<this.arrLstCPFields[1].length;W++)""!=this.arrLstCPFields[1][W].SNo.toString()&&null!=this.arrLstCPFields[1][W].Formula&&""!=this.arrLstCPFields[1][W].Formula&&(this.arrLstCPFields[1][W].dEarned=parseFloat(s.a.eval.EvaluateExpression(this.arrLstCPFields[1][W].Formula,B)).ToString(s.a.SessionManager.sPayrollDecimals).Replace(",",""),this.fldDict["Calc"+this.arrLstCPFields[1][W].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[1][W].dEarned).ToString(s.a.SessionManager.sPayrollDecimals)));for(var Y=0;Y<this.arrLstCPFields[2].length;Y++)""!=this.arrLstCPFields[2][Y].SNo.toString()&&null!=this.arrLstCPFields[2][Y].Formula&&""!=this.arrLstCPFields[2][Y].Formula&&("ESI"==this.arrLstCPFields[2][Y].ComponentName?this.arrLstCPFields[2][Y].dEarned=Math.ceil(parseFloat(s.a.eval.EvaluateExpression(this.arrLstCPFields[2][Y].Formula,B))).ToString(s.a.SessionManager.sPayrollDecimals).Replace(",",""):(o=parseFloat(s.a.eval.EvaluateExpression(this.arrLstCPFields[2][Y].Formula,B)).ToString(s.a.SessionManager.sPayrollDecimals),"PT"==this.arrLstCPFields[2][Y].ComponentName?(this.othMPField.dPTApplicableAmt=parseFloat(o),this.arrLstCPFields[2][Y].dEarned=s.a.SessionManager.Round(0,s.a.SessionManager.sPayrollDecimals)):this.arrLstCPFields[2][Y].dEarned=parseFloat(o).ToString(s.a.SessionManager.sPayrollDecimals).Replace(",",""),this.fldDict["Calc"+this.arrLstCPFields[2][Y].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[2][Y].dEarned).ToString(s.a.SessionManager.sPayrollDecimals))),t&&"Formula"==this.arrLstCPFields[2][Y].FieldType&&(this.arrLstCPFields[2][Y].dActual="PT"==this.arrLstCPFields[2][Y].ComponentName?s.a.SessionManager.Round(0,s.a.SessionManager.sPayrollDecimals):this.arrLstCPFields[2][Y].dEarned.Replace(",",""),this.fldDict[this.arrLstCPFields[2][Y].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[2][Y].dActual).ToString(s.a.SessionManager.sPayrollDecimals))));for(var j=0;j<this.arrLstCPFields[6].length;j++)""!=this.arrLstCPFields[6][j].SNo.toString()&&null!=this.arrLstCPFields[6][j].Formula&&""!=this.arrLstCPFields[6][j].Formula&&(this.arrLstCPFields[6][j].dEarned=parseFloat(s.a.eval.EvaluateExpression(this.arrLstCPFields[6][j].Formula,B)).ToString(s.a.SessionManager.sPayrollDecimals).Replace(",",""),this.fldDict[this.arrLstCPFields[6][j].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[6][j].dEarned).ToString(s.a.SessionManager.sPayrollDecimals)));Logger.InfoLog("CommonMonthlyPayroll::Exiting ExecuteFormulas()")}catch(U){Logger.ErrorLog("CommonMonthlyPayroll::EXCEPTION ExecuteFormulas()"+U.stack)}}},{key:"CalculateWeeklyOffsFromDef",value:function(){Logger.InfoLog("CommonMonthlyPayroll::Entering CalculateWeeklyOffsFromDef()");var t=0;try{if(null!=this.dvWOffDef&&this.dvWOffDef.length>0)for(var e,a=1,s=this.othMPField.DateOfRelieve<this.PayrollMonthEnd?this.othMPField.DateOfRelieve:this.PayrollMonthEnd,l=this.othMPField.DateOfJoining>this.PayrollMonthStart?this.othMPField.DateOfJoining:this.PayrollMonthStart;l<=s;){for(e=l.AddDays(6);l<=e&&l<=s;){if(i.e.StringIsNullOrEmpty(this.dvWOffDef[0]["Week"+a.toString()+"_W1"].toString())||l.getDay().toString().toLowerCase()!=this.dvWOffDef[0]["Week"+a.toString()+"_W1"].toString().toLowerCase()){if(!i.e.StringIsNullOrEmpty(this.dvWOffDef[0]["Week"+a.toString()+"_W2"].toString())&&l.getDay().toString().toLowerCase()==this.dvWOffDef[0]["Week"+a.toString()+"_W2"].toString().toLowerCase()){if(this.lstHolidays.Contains(l)){l=l.AddDays(1);continue}t++}}else{if(this.lstHolidays.Contains(l)){l=l.AddDays(1);continue}t++}l=l.AddDays(1)}a++}Logger.InfoLog("CommonMonthlyPayroll::Exiting CalculateWeeklyOffsFromDef()")}catch(n){Logger.ErrorLog("CommonMonthlyPayroll::EXCEPTION CalculateWeeklyOffsFromDef()"+n.stack)}return t}},{key:"GetLeavesTaken",value:function(t,e,a,i){Logger.InfoLog("CommonMonthlyPayroll::Entering GetLeavesTaken()"),i.dTaken=i.dAvail=0;var l=s.a.empService.GetLeavesTaken(this.sEmpSeqNo,t,e,a);null!=l&&l.Tables.length>0&&l.Tables[0].length>0&&(null!=l.Tables[0][0].LeavesTaken&&null!=l.Tables[0][0].LeavesTaken&&""!=l.Tables[0][0].LeavesTaken.toString()&&(i.dTaken=parseFloat(l.Tables[0][0].LeavesTaken)),null!=l.Tables[0][0].AvailableLeaves&&null!=l.Tables[0][0].AvailableLeaves&&""!=l.Tables[0][0].AvailableLeaves.toString()&&(i.dAvail=parseFloat(l.Tables[0][0].AvailableLeaves))),Logger.InfoLog("CommonMonthlyPayroll::Exiting GetLeavesTaken()")}},{key:"GetUnpaidDays",value:function(){var t,e,a=0,l=0;if(this.othMPField.DateOfJoining.getDate(),this.PayrollMonth.DaysInMonth(),this.othMPField.DateOfJoining>this.PayrollMonthStart)if("Actual Days"!=s.a.SessionManager.Preferences.PayDays){var n=parseInt(s.a.SessionManager.Preferences.PayDays);for(t=this.PayrollMonthStart,e=this.othMPField.DateOfJoining;t<e;)t.getDate()!=t.DaysInMonth()?(t.getDate()>n||a++,t=t.AddDays(1)):(a+=n-t.getDate()+1,t=t.AddDays(1));if(this.othMPField.DateOfRelieve<this.PayrollMonthEnd)for(t=this.othMPField.DateOfRelieve.AddDays(1),e=this.PayrollMonthEnd;t<=e&&!(s.a.SessionManager.Preferences.ContainsKey("ConsiderUnpaidDaysBasedOnPayDays")&&"TRUE"==s.a.SessionManager.Preferences.ConsiderUnpaidDaysBasedOnPayDays.toString().toUpperCase()&&(l=i.e.GetDateDifference(t,this.PayrollMonthStart)+1,l>n));)t.getDate()!=t.DaysInMonth()?(t.getDate()>n||a++,t=t.AddDays(1)):(a+=n-t.getDate()+1,t=t.AddDays(1))}else a+=i.e.GetDateDifference(this.othMPField.DateOfJoining,this.PayrollMonthStart),this.othMPField.DateOfRelieve<this.PayrollMonthEnd&&(a+=i.e.GetDateDifference(this.PayrollMonthEnd,this.othMPField.DateOfRelieve));else if(this.othMPField.DateOfRelieve<this.PayrollMonthEnd)if("Actual Days"!=s.a.SessionManager.Preferences.PayDays){var r=parseInt(s.a.SessionManager.Preferences.PayDays);for(t=this.othMPField.DateOfRelieve.AddDays(1),e=this.PayrollMonthEnd;t<=e&&!(s.a.SessionManager.Preferences.ContainsKey("ConsiderUnpaidDaysBasedOnPayDays")&&"TRUE"==s.a.SessionManager.Preferences.ConsiderUnpaidDaysBasedOnPayDays.toString().toUpperCase()&&(l=i.e.GetDateDifference(t,this.PayrollMonthStart)+1,l>r));)t.getDate()!=t.DaysInMonth()?(t.getDate()>r||a++,t=t.AddDays(1)):(a+=r-t.getDate()+1,t=t.AddDays(1))}else a+=i.e.GetDateDifference(this.PayrollMonthEnd,this.othMPField.DateOfRelieve);return a}},{key:"GetVacationAmountDetails",value:function(t){var e;Logger.InfoLog("CommonMonthlyPayroll::Entering GetVacationAmountDetails()"),this.arrLstVacAmountFields=new Array;var a,i=0,l=0;if(null!=t&&null!=t&&t.Tables.length>0&&t.Tables[2].length>0&&(this.dvStructure=t.Tables[2],this.dvEmpPay=t.Tables[3],e=t.Tables[4],null!=this.dvStructure&&this.dvStructure.length>0))for(var n=0;n<this.dvStructure.length;n++){if(this.oVacAmountField=new c,this.oVacAmountField.ID=parseInt(this.dvStructure[n].ID),this.oVacAmountField.SNo=parseInt(this.dvStructure[n].SNO),this.oVacAmountField.TypeId=parseInt(this.dvStructure[n].TYPEID),2==this.oVacAmountField.TypeId?(this.oVacAmountField.SName="Earning"+this.oVacAmountField.SNo,this.oVacAmountField.TypeName="Earnings"):3==this.oVacAmountField.TypeId?(this.oVacAmountField.SName="",this.oVacAmountField.TypeName="Deductions"):4==this.oVacAmountField.TypeId&&(this.oVacAmountField.SName="",this.oVacAmountField.TypeName="Loans"),this.oVacAmountField.EmpNode=parseInt(this.dvStructure[n].EMPNODE),this.oVacAmountField.ComponentID=parseInt(this.dvStructure[n].COMPONENTID),this.oVacAmountField.ComponentName=this.dvStructure[n].COMPONENTNAME.toString(),this.oVacAmountField.Percentage=parseFloat(this.dvStructure[n].PERCENTAGE).ToString(s.a.SessionManager.sPayrollDecimals),this.oVacAmountField.EnCash=parseInt(this.dvStructure[n].ENCASH),this.oVacAmountField.ExcessdaysSalary=parseInt(this.dvStructure[n].EXCESSDAYSSALARY),this.oVacAmountField.Formula=this.dvStructure[n].FORMULA.toString().replace("Field",this.dvStructure[n].COMPONENTNAME.toString()),this.oVacAmountField.ActualAmount="EMPLOYEE_BASIC"==this.oVacAmountField.ComponentName&&2==this.oVacAmountField.TypeId?parseFloat(this.dvEmpPay[0].BasicMonthly).ToString(s.a.SessionManager.sPayrollDecimals):"EMPLOYEE_BASIC"!=this.oVacAmountField.ComponentName.toString()&&2==this.oVacAmountField.TypeId?parseFloat(this.dvEmpPay[0]["Earning"+this.oVacAmountField.SNo]).ToString(s.a.SessionManager.sPayrollDecimals):s.a.SessionManager.Round(0,s.a.SessionManager.sPayrollDecimals),this.oVacAmountField.PercActualAmount=parseFloat(this.oVacAmountField.ActualAmount)>0&&parseFloat(this.oVacAmountField.Percentage)>0?(parseFloat(this.oVacAmountField.ActualAmount)*parseFloat(this.oVacAmountField.Percentage)/100).ToString(s.a.SessionManager.sPayrollDecimals):s.a.SessionManager.Round(0,s.a.SessionManager.sPayrollDecimals),i=l=0,-1==parseFloat(this.oVacAmountField.Percentage)){var r=s.a.empService.GetQueryData(1,"AllowencesData",this.iDocID,this.oVacAmountField.ComponentID,this.oVacAmountField.EmpNode);a&&r.length>0&&(l=parseFloat(r[0][Object.keys(a[0])[0]])),(a=s.a.empService.GetQueryData(1,"AllowencesData1",this.oVacAmountField.SNo.toString(),this.oVacAmountField.EmpNode,""))&&a.length>0&&(i=parseFloat(a[0][Object.keys(a[0])[0]])),this.oVacAmountField.ActualAmount=(i-l).ToString(s.a.SessionManager.sPayrollDecimals)}else-3==parseFloat(this.oVacAmountField.Percentage)&&((a=s.a.empService.GetQueryData(1,"AllowencesData2",this.oVacAmountField.SNo.toString(),this.oVacAmountField.EmpNode,""))&&a.length>0&&(i=parseFloat(a[0][Object.keys(a[0])[0]])),this.oVacAmountField.ActualAmount=i.ToString(s.a.SessionManager.sPayrollDecimals));4==this.oVacAmountField.TypeId?(e.RowFilter="",null!=e&&e.length>0&&(e.RowFilter="LoanTypeID="+this.oVacAmountField.ComponentID,e.length>0&&(this.oVacAmountField.Amount=parseFloat(e[0].LoanAmount).ToString(s.a.SessionManager.sPayrollDecimals),this.oVacAmountField.ActualAmount=parseFloat(e[0].LoanAmount).ToString(s.a.SessionManager.sPayrollDecimals)))):this.oVacAmountField.Amount=s.a.SessionManager.Round(0,s.a.SessionManager.sPayrollDecimals),this.arrLstVacAmountFields.push(this.oVacAmountField)}Logger.InfoLog("CommonMonthlyPayroll::Exiting GetVacationAmountDetails()")}}]),t}()},"SW+i":function(t,e,a){"use strict";a.r(e),a.d(e,"VPTDialogComponent",(function(){return d}));var s=a("Do2H"),i=a("fXoL"),l=a("sYmb");function n(t,e){if(1&t){var a=i.ac();i.Zb(0,"div",15),i.Wc(1,"\n                "),i.Zb(2,"input",12),i.hc("change",(function(){i.Ic(a);var t=i.lc(2);return t.obj.IsExcelChecked=!t.obj.IsExcelChecked})),i.Yb(),i.Wc(3,"\n                "),i.Zb(4,"label",13),i.Wc(5),i.mc(6,"translate"),i.Yb(),i.Wc(7,"\n            "),i.Yb()}if(2&t){var s=i.lc(2);i.Db(2),i.tc("checked",s.obj.IsExcelChecked)("value",s.obj.IsExcelChecked),i.Db(3),i.Xc(i.nc(6,3,"Cbo_Excel"))}}function r(t,e){if(1&t){var a=i.ac();i.Zb(0,"div",9),i.Wc(1,"\n            "),i.Zb(2,"label",10),i.Wc(3),i.mc(4,"translate"),i.Yb(),i.Wc(5,"\n            "),i.Zb(6,"div",11),i.Wc(7,"\n                "),i.Zb(8,"input",12),i.hc("change",(function(){i.Ic(a);var t=i.lc();return t.obj.IsPDFChecked=!t.obj.IsPDFChecked})),i.Yb(),i.Wc(9,"\n                "),i.Zb(10,"label",13),i.Wc(11),i.mc(12,"translate"),i.Yb(),i.Wc(13,"\n            "),i.Yb(),i.Wc(14,"\n            "),i.Uc(15,n,8,5,"div",14),i.Wc(16,"\n        "),i.Yb()}if(2&t){var s=i.lc();i.Db(3),i.Xc(i.nc(4,5,"Format_Format")),i.Db(5),i.tc("checked",s.obj.IsPDFChecked)("value",s.obj.IsPDFChecked),i.Db(3),i.Xc(i.nc(12,7,"Cbo_PDF")),i.Db(4),i.tc("ngIf",s.obj.IsExcelVisible)}}function o(t,e){if(1&t&&(i.Zb(0,"div",16),i.Wc(1,"\n            "),i.Vb(2,17),i.Wc(3,"\n        "),i.Yb()),2&t){var a=i.lc();i.Db(2),i.tc("obj",a.obj.Layouts)("group",a.form)}}var d=function(){var t=function(){function t(e){_classCallCheck(this,t),this.translate=e}return _createClass(t,[{key:"ngOnInit",value:function(){}},{key:"IsMobile",get:function(){return s.a.IsMobile}}]),t}();return t.\u0275fac=function(e){return new(e||t)(i.Tb(l.e))},t.\u0275cmp=i.Nb({type:t,selectors:[["app-vptdialog"]],inputs:{obj:"obj"},decls:27,vars:10,consts:[[1,"master-screen",2,"padding-bottom","4px!important"],[1,"PACTHeaderFields","dialogSubBody"],["class","form-group row form-row col-xl-12 col-md-12 col-sm-12 col-xs-12 PACTControl","style","flex-direction: row;",4,"ngIf"],["class","form-group row form-row col-xl-12 col-md-12 col-sm-12 col-xs-12 PACTControl",4,"ngIf"],[1,"Pactdailogfooter"],[1,"primary-btn-wicon",3,"click"],[1,"fa-light","fa-circle-check"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-rectangle-xmark"],[1,"form-group","row","form-row","col-xl-12","col-md-12","col-sm-12","col-xs-12","PACTControl",2,"flex-direction","row"],[1,"input_cntrl_label",2,"width","90px"],[1,"divRadio",2,"margin-right","10px","width","60px"],["type","radio","name","FORMAT",2,"height","20px !important",3,"checked","value","change"],[1,"input_cntrl_label",2,"padding","3px"],["class","divRadio","style"," width: 80px;",4,"ngIf"],[1,"divRadio",2,"width","80px"],[1,"form-group","row","form-row","col-xl-12","col-md-12","col-sm-12","col-xs-12","PACTControl"],["FieldDirective","",3,"obj","group"]],template:function(t,e){1&t&&(i.Zb(0,"div",0),i.Wc(1,"\n    "),i.Zb(2,"div",1),i.Wc(3,"\n        "),i.Wc(4,"\n        "),i.Uc(5,r,17,9,"div",2),i.Wc(6,"\n        "),i.Uc(7,o,4,2,"div",3),i.Wc(8,"\n    "),i.Yb(),i.Wc(9,"\n    "),i.Zb(10,"div",4),i.Wc(11,"\n      "),i.Zb(12,"div"),i.Wc(13,"\n        "),i.Zb(14,"button",5),i.hc("click",(function(){return e.obj.OnButtonClick("OK")})),i.Ub(15,"i",6),i.Wc(16),i.mc(17,"translate"),i.Yb(),i.Wc(18,"\n        "),i.Zb(19,"button",7),i.hc("click",(function(){return e.obj.OnButtonClick("Cancel")})),i.Ub(20,"i",8),i.Wc(21),i.mc(22,"translate"),i.Yb(),i.Wc(23,"\n      "),i.Yb(),i.Wc(24,"\n  "),i.Yb(),i.Wc(25,"\n"),i.Yb(),i.Wc(26,"\n")),2&t&&(i.Sc("width",e.IsMobile?"100%":"485px"),i.Db(5),i.tc("ngIf",e.obj.stkFormat),i.Db(2),i.tc("ngIf",e.obj.Layouts.Visible),i.Db(9),i.Xc(i.nc(17,6,"Com_OK")),i.Db(5),i.Xc(i.nc(22,8,"Cancel")))},encapsulation:2}),t}()},ia84:function(t,e,a){"use strict";a.r(e),a.d(e,"PactQueryListBoxData",(function(){return o})),a.d(e,"VPTDialogViewModel",(function(){return d}));var s=a("Do2H"),i=a("Lp6j"),l=a("ScVY"),n=a("0/4Q"),r=a("MCLT"),o=function(t){_inherits(a,t);var e=_createSuper(a);function a(t){return _classCallCheck(this,a),e.call(this,t)}return a}(a("n56n").b),d=function(t){_inherits(a,t);var e=_createSuper(a);function a(t){var i,l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];_classCallCheck(this,a),(i=e.call(this)).IsOkClicked=!1,i.SelectedRow=null,i.iQty=0,i.Qty="1",i.stkFormat=!1,i.IsFromProductMast=!1,i._IsExcelChecked=!1,i.sDSCUserName="",i.IsExport=!1,i.DSCUserNameVisibility=!1,i.IsExcelVisible=!1,i._IsPDFChecked=!0,i.ShowAuditPrints=!1,i._AuditPrintsLabel="",i.IsExcelVisible=!0,i.dtLayouts=t,i.IsFromProductMast=o,i.IsExport=l,l?(i.lblTitle=s.a.GetResource("lbl_Export"),i.stkFormat=!0,s.a.SessionManager.PersonalSettings.ContainsKey("VPTExportType")&&("Excel"==s.a.SessionManager.PersonalSettings.VPTExportType?i.IsExcelChecked=!0:i.IsPDFChecked=!0)):(i.lblTitle=s.a.GetResource("Print"),i.stkFormat=!1),i.Title=i.lblTitle,i.Layouts=new n.e,i.Uom=new n.e,i.Uom.Visible=!1,i.Layouts.LblWidth="90",i.Layouts.Label=s.a.GetResource("VPDesigner_Title");var d=t[0],h=t.sort((function(t,e){return t.Name>e.Name?1:-1}));return i.strPKID=Object(r.isUndefined)(t[0].BarcodeLayoutID)?"DocPrintLayoutID":"BarcodeLayoutID",h.forEach((function(t){Object(r.isNullOrUndefined)(t.Copies)?i.Layouts.Items.push(n.d.ComboBoxItems_3(t.Name.toString(),t[i.strPKID].toString(),"")):i.Layouts.Items.push(n.d.ComboBoxItems_3(t.Name.toString(),t[i.strPKID].toString(),"Copies Printed :  "+t.Copies.toString()))})),i.Layouts.Items.length>0&&(i.Layouts.SelectedValue=d[i.strPKID].toString()),i.Layouts.SelectionChangedCommand.Subscribe(_assertThisInitialized(i),"OnLayoutChanged"),i.OnLayoutChanged(null),i}return _createClass(a,[{key:"OnButtonClick",value:function(t){var e=this;if("Cancel"==t)this.IsOkClicked=!1,s.a.page.HideDialog();else if("OK"==t&&null!=this.Layouts.SelectedValue){var a=this.dtLayouts.filter((function(t){return t[e.strPKID]==e.Layouts.SelectedValue}));a.length>0&&(this.IsOkClicked=!0,this.iQty=this.IsFromProductMast?i.e.Int(this.Qty):0,this.SelectedRow=a[0],s.a.page.HideDialog())}}},{key:"OnLayoutChanged",value:function(t){if(null!=this.Layouts.SelectedValue){var e=this.Layouts.GetselectedItem();this.AuditPrintsLabel=e.Parent,this.LoadDSCUserNames()}}},{key:"LoadDSCUserNames",value:function(){}},{key:"RefreshCertificates",value:function(){}},{key:"IsExcelChecked",get:function(){return this._IsExcelChecked},set:function(t){t!=this._IsExcelChecked&&(this._IsExcelChecked=t,t&&(i.e.SetPersonalize("VPTExportType","Excel"),this._IsPDFChecked=!1,this.LoadDSCUserNames()))}},{key:"IsPDFChecked",get:function(){return this._IsPDFChecked},set:function(t){t!=this._IsPDFChecked&&(this._IsPDFChecked=t,t&&(i.e.SetPersonalize("VPTExportType","PDF"),this._IsExcelChecked=!1,this.LoadDSCUserNames()))}},{key:"AuditPrintsLabel",get:function(){return this._AuditPrintsLabel},set:function(t){t!=this._AuditPrintsLabel&&(this.Title=this.lblTitle+t,this._AuditPrintsLabel=t,this.ShowAuditPrints=!i.e.IsEmpty(t))}}]),a}(l.b)}}]);
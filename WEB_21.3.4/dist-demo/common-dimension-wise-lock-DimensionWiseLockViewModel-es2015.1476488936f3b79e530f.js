(window.webpackJsonp=window.webpackJsonp||[]).push([[117],{kRD8:function(e,i,s){"use strict";s.r(i),s.d(i,"DimensionWiseLockViewModel",(function(){return d}));var t=s("Do2H"),n=s("Lp6j"),o=s("lUlH"),a=s("8B8H"),r=s("0/4Q"),l=s("ockk"),D=s("ScVY");class d extends D.b{constructor(){super(),this.DateText="",this.DisplayName="",this.UpdateVisible=!1,this.Filter=0,this.Locations="",this.SortOn="",this.FilterOn="",this.Status="0",this.DocumentPicked="",this.FromDate=new Date,this.ToDate=new Date,this.strSelect="",this.strJoin="",this.dt=[],this.RetVal=0,this.lstBasicColumns=[],this.ScreenObject=new o.a(130,0),Logger.InfoLog("DimensionWiseLockViewModel:: Inside onLoad  "),this.DisplayName=t.a.GetResource("DimensionWiseLock"),this.DimensionLockGrid=new a.a,this.DimensionLockGrid.IsReadOnly=!0,this.DimensionLockGrid.Width="",this.DimensionLockGrid.OnLinkClick.Subscribe(this,"OnGridLinkClick"),this.DimensionLockGrid.Columns=[],this.DimensionLockGrid.SearchVisible=!0,this.DimensionLockGrid.SearchColStartIndex=1,this.EntryGrid=new a.a,this.EntryGrid.Width="",this.EntryGrid.OnLinkClick.Subscribe(this,"OnEntryGridLinkClick"),this.EntryGrid.OnBeginEdit.Subscribe(this,"OnEntryGridBeginEdit"),this.EntryGrid.CanUserDeleteRows=!0,this.EntryGrid.Columns=[],this.UpdateVisible=t.a.SessionManager.IsActionAssigned(130,"Edit"),this.InitControls(),this.LoadData(),Logger.InfoLog("DimensionWiseLockViewModel:: Exiting onLoad  ")}InitControls(){Logger.InfoLog("DimensionWiseLockViewModel:: Inside InitColumns");let e,i=t.a.common.SetDimensionWiseLockData(1,"");this.ds=i,this.RetVal=i.obj,this.DimensionLockGrid.TableColumns.push("NodeID"),this.DimensionLockGrid.TableColumns.push("Sno"),this.DimensionLockGrid.TableColumns.push("Action"),this.DimensionLockGrid.TableColumns.push("Delete"),this.DimensionLockGrid.TableColumns.push("FromDate"),this.DimensionLockGrid.TableColumns.push("FromDate_Key"),this.DimensionLockGrid.TableColumns.push("ToDate"),this.DimensionLockGrid.TableColumns.push("ToDate_Key"),this.DimensionLockGrid.TableColumns.push("DocumentID"),this.DimensionLockGrid.TableColumns.push("isEnable");let s=new Array,o=new Array;if(t.a.SessionManager.Preferences.ContainsKey("DimensionWiseLockData Screen Widths")&&""!=t.a.SessionManager.Preferences["DimensionWiseLockData Screen Widths"]){let i=new n.f;i.LoadXml(t.a.SessionManager.Preferences["DimensionWiseLockData Screen Widths"]),i.DocumentElement.childNodes.forEach(i=>{e=new l.a,e.Header=i.attributes.Header.value,e.DisplayMember=i.attributes.Name.value,e.DisplayIndex=parseInt(i.attributes.index.value),e.Width=parseInt(i.attributes.WIDTH.value),s.push(e)})}e=new l.a,e.Header=t.a.GetResource("DocumentDesigner_Sno"),e.DisplayMember="Sno",e.ReadOnly=!0,e.IsFrozen=!0,e.Width=45;var a=s.find(i=>i.DisplayMember==e.DisplayMember);null!=a&&null!=a?(e.DisplayIndex=a.DisplayIndex,e.Width=a.Width):s.length>0&&(e.IsVisible=!1),o.push(e),e=new l.a,e.Header=t.a.GetResource("Service_Action"),e.DisplayMember="Action",e.DataType="LINK",e.ReadOnly=!0,e.IsFrozen=!0,e.Width=50,null!=(a=s.find(i=>i.DisplayMember==e.DisplayMember))&&null!=a?(e.DisplayIndex=a.DisplayIndex,e.Width=a.Width):s.length>0&&(e.IsVisible=!1),o.push(e),e=new l.a,e.Header=t.a.GetResource("Delete"),e.DisplayMember="Delete",e.ID="Delete",e.DataType="LINK",e.IsVisible=!1,e.ReadOnly=!0,e.IsFrozen=!0,e.Width=50,null!=(a=s.find(i=>i.DisplayMember==e.DisplayMember))&&null!=a?(e.DisplayIndex=a.DisplayIndex,e.Width=a.Width):s.length>0&&(e.IsVisible=!1),o.push(e),e=new l.a,e.Header=t.a.GetResource("Vehicle_Enable"),e.ValueBinding="isEnable",e.DisplayMember="Name",e.ValueMember="Value",e.ReadOnly=!1,e.DataType="ComboBox",e.Width=50;let D=new Array;D.push(r.d.ComboBoxItems_2(t.a.GetResource("Com_Yes"),"True")),D.push(r.d.ComboBoxItems_2(t.a.GetResource("Com_No"),"False")),e.ComboData=D,null!=(a=s.find(i=>i.DisplayMember==e.ValueBinding))&&null!=a?(e.DisplayIndex=a.DisplayIndex,e.Width=a.Width):s.length>0&&(e.IsVisible=!1),o.push(e),e=new l.a,e.Header=t.a.GetResource("FromDate"),e.DisplayMember="FromDate",e.ReadOnly=!1,e.DataType="DATE",e.Width=80,null!=(a=s.find(i=>i.DisplayMember==e.DisplayMember))&&null!=a?(e.DisplayIndex=a.DisplayIndex,e.Width=a.Width):s.length>0&&(e.IsVisible=!1),o.push(e),e=new l.a,e.Header=t.a.GetResource("ToDate"),e.DisplayMember="ToDate",e.ReadOnly=!1,e.DataType="DATE",e.Width=80,null!=(a=s.find(i=>i.DisplayMember==e.DisplayMember))&&null!=a?(e.DisplayIndex=a.DisplayIndex,e.Width=a.Width):s.length>0&&(e.IsVisible=!1),o.push(e),e=new l.a,e.Header=t.a.GetResource("Doc_Document"),e.DisplayMember="Name",e.ValueMember="Value",e.ValueBinding="DocumentID",e.DataType="ComboBox";let d=new Array;if(d.push(r.d.ComboBoxItems_2("","1")),null!=this.ds&&this.ds.Tables.length>1)for(let t=0;t<this.ds.Tables[1].length;t++)d.push(r.d.ComboBoxItems_2(this.ds.Tables[1][t].DocumentName.toString(),this.ds.Tables[1][t].CostCenterID.toString()));e.ComboData=d,e.Width=80,null!=(a=s.find(i=>i.DisplayMember==e.ValueBinding))&&null!=a?(e.DisplayIndex=a.DisplayIndex,e.Width=a.Width):s.length>0&&(e.IsVisible=!1),o.push(e);let m=new n.f;m.LoadXml(t.a.SessionManager.Preferences["DimensionWiseLockData Customize Screen"]),m.DocumentElement.childNodes.forEach(i=>{"DIM"==i.attributes.Type.value?(e=new l.a,e.Header=i.attributes.Header.value,e.DisplayMember="DIM"+i.attributes.ID.value,e.ValueMember="DIM"+i.attributes.ID.value+"_Key",e.CostCenterID=parseInt(i.attributes.ID.value),e.ReadOnly=!1,e.Width=100,e.DataType="LISTBOX",e.TypeID=1,null!=(a=s.find(i=>i.DisplayMember==e.DisplayMember))&&null!=a?(e.DisplayIndex=a.DisplayIndex,e.Width=a.Width):s.length>0&&(e.IsVisible=!1),o.push(e),this.DimensionLockGrid.TableColumns.push("DIM"+i.attributes.ID.value),this.DimensionLockGrid.TableColumns.push("DIM"+i.attributes.ID.value+"_Key")):"2"!=i.attributes.ID.value&&"3"!=i.attributes.ID.value||(e=new l.a,e.Header=i.attributes.Header.value,e.DisplayMember=i.attributes.Header.value+"ID",e.ValueMember=i.attributes.Header.value+"ID_Key",e.CostCenterID=parseInt(i.attributes.ID.value),2==parseInt(i.attributes.ID.value)?e.TypeID=105:3==parseInt(i.attributes.ID.value)&&(e.TypeID=10),e.DataType="LISTBOX",e.ReadOnly=!1,e.Width=150,null!=(a=s.find(i=>i.DisplayMember==e.DisplayMember))&&null!=a?(e.DisplayIndex=a.DisplayIndex,e.Width=a.Width):s.length>0&&(e.IsVisible=!1),o.push(e),this.DimensionLockGrid.TableColumns.push(i.attributes.Header.value+"ID"),this.DimensionLockGrid.TableColumns.push(i.attributes.Header.value+"ID_Key"))}),o.sort((e,i)=>e.DisplayIndex-i.DisplayIndex).forEach(e=>{this.lstBasicColumns.push(e)});for(let t=0;t<20;t++){let e=this.DimensionLockGrid.NewRow();this.DimensionLockGrid.addRow(e)}Logger.InfoLog("DimensionWiseLockViewModel:: Exiting InitColumns")}LoadData(){if(this.AddColumns(),null!=this.ds&&this.ds.Tables.length>0)for(let e=0;e<this.ds.Tables[0].length;e++)this.DimensionLockGrid.Table.length-1<=e&&(this.DimensionLockGrid.addEmptyRow(),this.DimensionLockGrid.addEmptyRow(),this.DimensionLockGrid.addEmptyRow()),this.DimensionLockGrid.Table[e].NodeID=this.ds.Tables[0][e].NodeID,this.DimensionLockGrid.Table[e].Sno=(e+1).toString(),this.DimensionLockGrid.Table[e].Action="Edit",this.DimensionLockGrid.Table[e].Delete="Delete",this.DimensionLockGrid.Table[e].isEnable=this.ds.Tables[0][e].isEnable,n.e.IsEmpty(this.ds.Tables[0][e].FromDate)||(this.DimensionLockGrid.Table[e].FromDate=!t.a.SessionManager.Preferences.ContainsKey("Date Format")||n.e.IsEmpty(t.a.SessionManager.Preferences["Date Format"])||n.e.IsEmpty(this.ds.Tables[0][e].FromDate)?new Date(this.ds.Tables[0][e].FromDate_Key.toString()).ToString("dd/MMM/yyyy"):new Date(this.ds.Tables[0][e].FromDate_Key.toString()).ToString(t.a.SessionManager.Preferences["Date Format"]),this.DimensionLockGrid.Table[e].FromDate_Key=this.ds.Tables[0][e].FromDate_Key),n.e.IsEmpty(this.ds.Tables[0][e].ToDate)||(this.DimensionLockGrid.Table[e].ToDate=!t.a.SessionManager.Preferences.ContainsKey("Date Format")||n.e.IsEmpty(t.a.SessionManager.Preferences["Date Format"])||n.e.IsEmpty(this.ds.Tables[0][e].ToDate)?new Date(this.ds.Tables[0][e].ToDate_Key.toString()).ToString("dd/MMM/yyyy"):new Date(this.ds.Tables[0][e].ToDate_Key.toString()).ToString(t.a.SessionManager.Preferences["Date Format"]),this.DimensionLockGrid.Table[e].ToDate_Key=this.ds.Tables[0][e].ToDate_Key),"1"!=n.e.String(this.ds.Tables[0][e].DocumentID)&&(this.DimensionLockGrid.Table[e].DocumentID=this.ds.Tables[0][e].DocumentID.toString()),this.DimensionLockGrid.Columns.forEach(i=>{2==i.CostCenterID?"1"!=this.ds.Tables[0][e].AccountID.toString()&&(this.DimensionLockGrid.Table[e].AccountID_Key=this.ds.Tables[0][e].AccountID.toString()):3==i.CostCenterID?"1"!=this.ds.Tables[0][e].ProductID.toString()&&(this.DimensionLockGrid.Table[e].ProductID_Key=this.ds.Tables[0][e].ProductID.toString()):i.CostCenterID>5e4&&"1"!=this.ds.Tables[0][e]["CCNID"+(i.CostCenterID-5e4)].toString()&&(this.DimensionLockGrid.Table[e]["DIM"+i.CostCenterID.toString()+"_Key"]=this.ds.Tables[0][e]["CCNID"+(i.CostCenterID-5e4)].toString())});this.DimensionLockGrid.RefreshGrid=!this.DimensionLockGrid.RefreshGrid}AddColumns(){let e=[];for(let s=0;s<this.lstBasicColumns.length;s++)e.push(this.lstBasicColumns[s]);let i=[];e.forEach(e=>{let s=new l.a;s.ID=e.ID,s.Header=e.Header,s.DisplayMember=e.DisplayMember,s.ValueMember=e.ValueMember,s.ValueBinding=e.ValueBinding,s.ComboData=e.ComboData,s.ReadOnly=e.ReadOnly,s.DataType=e.DataType,s.CostCenterID=e.CostCenterID,s.Width=e.Width,s.DecimalPoints=e.DecimalPoints,s.TypeID=e.TypeID,s.ShowRootDimension=!0,s.IsVisible=e.IsVisible,i.push(s),this.UpdateVisible&&"Delete"!=e.DisplayMember&&"Action"!=e.DisplayMember&&"Sno"!=e.DisplayMember?s.ReadOnly=!1:s.ReadOnly||(s.ReadOnly=!0),"Delete"==s.ID&&(s.IsVisible=!0)}),this.DimensionLockGrid.Columns=i,this.EntryGrid.Columns=e,this.ClearEntryGrid()}EntryGrid_RowDeleted(e,i){let s=this.EntryGrid.NewRow();s.Action="Submit",this.EntryGrid.addRow(s),this.EntryGrid.SelectedIndex=this.EntryGrid.Table.indexOf(s)}ButtonSave(e){if(Logger.InfoLog("DimensionWiseLockViewModel:: Inside ButtonSave sender ="+e.toString()),"Customize"==e);else if("Update"==e){let e="";e+="<DimensionWiseLockXML>";let i=this.DimensionLockGrid.Table;for(let o=0;o<i.length;o++)n.e.IsEmpty(i[o].FromDate_Key)||n.e.IsEmpty(i[o].ToDate_Key)||(e+="<Rows ",e+='NodeID="'+n.e.String(i[o].NodeID)+'" ',this.DimensionLockGrid.TableColumns.Contains("isEnable")&&!n.e.IsEmpty(i[o].isEnable)?e+='isEnable="'+n.e.String(i[o].isEnable)+'" ':e+='isEnable="1" ',this.DimensionLockGrid.TableColumns.Contains("FromDate_Key")&&!n.e.IsEmpty(i[o].FromDate_Key)?e+='FromDate="'+new Date(i[o].FromDate_Key).ToString("dd/MMM/yyyy")+'" ':e+='FromDate="'+this.FromDate.ToString("dd/MMM/yyyy")+'" ',this.DimensionLockGrid.TableColumns.Contains("ToDate_Key")&&!n.e.IsEmpty(i[o].ToDate_Key)?e+='ToDate="'+new Date(i[o].ToDate_Key).ToString("dd/MMM/yyyy")+'" ':e+='ToDate="'+this.ToDate.ToString("dd/MMM/yyyy")+'" ',this.DimensionLockGrid.TableColumns.Contains("DocumentID")&&!n.e.IsEmpty(i[o].DocumentID)?e+=' DocumentID="'+n.e.String(i[o].DocumentID)+'" ':e+=' DocumentID="1" ',this.DimensionLockGrid.Columns.forEach(s=>{if(s.CostCenterID>0)if(s.CostCenterID>5e4){if("1"!=t.a.SessionManager.UserID&&(50001==s.CostCenterID||50002==s.CostCenterID)&&t.a.SessionManager.Preferences.ContainsKey("Dimension List")&&!n.e.IsEmpty(t.a.SessionManager.Preferences["Dimension List"])&&t.a.SessionManager.Preferences["Dimension List"].toString().Contains(s.CostCenterID.toString())&&""==i[o][s.DisplayMember+"_Key"].toString())return this.DisplayMessage="Please select "+s.Header,void(this.MessageVisibility=!0);n.e.IsEmpty(i[o][s.DisplayMember+"_Key"])||(e+=" CCNID"+(s.CostCenterID-5e4)+'="'+i[o][s.DisplayMember+"_Key"].toString()+'" ')}else 2!=s.CostCenterID||n.e.IsEmpty(i[o][s.DisplayMember+"_Key"])?3!=s.CostCenterID||n.e.IsEmpty(i[o][s.DisplayMember+"_Key"])||(e+=' ProductID="'+i[o][s.DisplayMember+"_Key"].toString()+'" '):e+=' AccountID="'+i[o][s.DisplayMember+"_Key"].toString()+'" '}),e+="/>");e+="</DimensionWiseLockXML>";let s=t.a.common.SetDimensionWiseLockData(2,e.toString());this.ds=s,this.RetVal=s.obj,null!=this.ds&&this.ds.Tables.length>0&&this.ds.Tables[this.ds.Tables.length-1].length>0&&this.ds.Columns[this.ds.Columns.length-1].Contains("ErrorMessage")&&(this.DisplayMessage=this.ds.Tables[this.ds.Tables.length-1][0].ErrorMessage.toString()),this.MessageVisibility=!0}Logger.InfoLog("DimensionWiseLockViewModel:: exiting ButtonSave sender ="+e.toString())}OnEntryGridLinkClick(e,i,s){if(this.DisplayMessage="","Action"==i){let i=parseInt(this.EntryGrid.Table[0].Sno),s=parseInt(this.EntryGrid.Table[0].NodeID),o="";if(o+="<DimensionWiseLockXML>",n.e.IsEmpty(e.FromDate_Key)||n.e.IsEmpty(e.ToDate_Key)||(o+="<Rows ",s>0&&(o+='NodeID="'+s+'" '),this.DimensionLockGrid.TableColumns.Contains("isEnable")&&!n.e.IsEmpty(e.isEnable)?o+='isEnable="'+e.isEnable.toString()+'" ':o+='isEnable="1" ',this.DimensionLockGrid.TableColumns.Contains("FromDate_Key")&&!n.e.IsEmpty(e.FromDate_Key)?o+='FromDate="'+new Date(e.FromDate_Key).ToString("dd/MMM/yyyy")+'" ':o+='FromDate="'+this.FromDate.ToString("dd/MMM/yyyy")+'" ',this.DimensionLockGrid.TableColumns.Contains("ToDate_Key")&&!n.e.IsEmpty(e.ToDate_Key)?o+='ToDate="'+new Date(e.ToDate_Key).ToString("dd/MMM/yyyy")+'" ':o+='ToDate="'+this.ToDate.ToString("dd/MMM/yyyy")+'" ',this.DimensionLockGrid.TableColumns.Contains("DocumentID")&&!n.e.IsEmpty(e.DocumentID)?o+=' DocumentID="'+e.DocumentID.toString()+'" ':o+=' DocumentID="1" ',this.DimensionLockGrid.Columns.forEach(i=>{if(i.CostCenterID>0)if(i.CostCenterID>5e4){if("1"!=t.a.SessionManager.UserID&&(50001==i.CostCenterID||50002==i.CostCenterID)&&t.a.SessionManager.Preferences.ContainsKey("Dimension List")&&!n.e.IsEmpty(t.a.SessionManager.Preferences["Dimension List"])&&t.a.SessionManager.Preferences["Dimension List"].toString().Contains(i.CostCenterID.toString())&&""==e[i.DisplayMember+"_Key"].toString())return this.DisplayMessage="Please select "+i.Header,void(this.MessageVisibility=!0);n.e.IsEmpty(e[i.DisplayMember+"_Key"])||(o+=" CCNID"+(i.CostCenterID-5e4)+'="'+e[i.DisplayMember+"_Key"].toString()+'" ')}else 2!=i.CostCenterID||n.e.IsEmpty(e[i.DisplayMember+"_Key"])?3!=i.CostCenterID||n.e.IsEmpty(e[i.DisplayMember+"_Key"])||(o+=' ProductID="'+e[i.DisplayMember+"_Key"].toString()+'" '):o+=' AccountID="'+e[i.DisplayMember+"_Key"].toString()+'" '}),o+="/>"),o+="</DimensionWiseLockXML>",s>0){let e=t.a.common.SetDimensionWiseLockData(2,o.toString());this.ds=e,this.RetVal=e.obj}else{let e=t.a.common.SetDimensionWiseLockData(0,o.toString());this.ds=e,this.RetVal=e.obj}if(this.DisplayMessage=this.ds.Tables[0][0][this.ds.Columns[0][0]].toString(),this.MessageVisibility=!0,this.RetVal>0){let s=null,t=0;if(0==i){for(let e=0;e<this.DimensionLockGrid.Table.length;e++)if(""==n.e.String(this.DimensionLockGrid.Table[e].Sno)){s=this.DimensionLockGrid.Table[e],t=e+1;break}}else for(let i=0;i<this.DimensionLockGrid.Table.length;i++)if(this.DimensionLockGrid.Table[i].Sno.toString()==e.Sno.toString()){s=this.DimensionLockGrid.Table[i];break}null==s&&(s=this.DimensionLockGrid.NewRow(),this.DimensionLockGrid.addRow(s),t=this.DimensionLockGrid.Table.length);for(let i=0;i<Object.keys(e).length;i++)"id"!=Object.keys(e)[i]&&(s[Object.keys(e)[i]]=e[Object.keys(e)[i]]);0==i&&(s.NodeID=this.RetVal,s.Sno=t),s.Action="Edit",s.Delete="Delete",this.DimensionLockGrid.updateRow(s),this.ClearEntryGrid()}}}OnEntryGridBeginEdit(e,i,s){return!1}OnGridLinkClick(e,i,s){if(this.DisplayMessage="","Action"==i){for(let i=0;i<Object.keys(e).length;i++)"id"!=Object.keys(e)[i]&&(this.EntryGrid.Table[0][Object.keys(e)[i]]=e[Object.keys(e)[i]]);this.EntryGrid.Table[0].Action="Submit",this.EntryGrid.updateRow(this.EntryGrid.Table[0])}else"Delete"==i&&confirm(t.a.GetResource("DeleteMessage"))&&this.OnDeleteCallBack()}ClearEntryGrid(){this.EntryGrid.Clear();let e=this.EntryGrid.NewRow();e.Sno="0",e.NodeID="0",e.Action="Submit",this.EntryGrid.SelectedIndex=0,this.EntryGrid.addRow(e)}OnDeleteCallBack(){let e=this.DimensionLockGrid.SelectedItem;try{this.DisplayMessage="";let i=t.a.common.SetDimensionWiseLockData(3,e.NodeID.toString());if(this.ds=i,this.RetVal=i.obj,this.RetVal>0){this.DimensionLockGrid.Table.Remove(e),this.DisplayMessage=this.ds.Tables[0][0][this.ds.Columns[0][0]].toString(),this.MessageVisibility=!0;for(let e=0;e<this.DimensionLockGrid.Table.length;e++)this.DimensionLockGrid.updateRow(this.DimensionLockGrid.Table[e])}}catch(i){Logger.ErrorLog("DimensionWiseLockWiewModel: OnDeleteCallBack', message="+i.Message)}}}}}]);
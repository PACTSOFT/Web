(window.webpackJsonp=window.webpackJsonp||[]).push([[74],{AfpE:function(e,t,i){"use strict";i.r(t),i.d(t,"RegularizationOfAttendanceViewModel",(function(){return r}));var s=i("ScVY"),a=i("4HhE"),n=i("JIg3"),h=i("EQd/"),o=i("Lp6j"),l=i("Do2H"),u=i("zUnb");class r extends s.b{constructor(){super(),this.ButtonClick=new a.b,this.SelectedEmpID=0,this.dtDay=new Date,this.dtpCheckInDate=new n.c(0),this.dtpCheckInTime=new n.b,this.dtpCheckOutDate=new n.c(0),this.dtpCheckOutTime=new n.b,this.txtRemarks=new h.d(0),this.DocID=0}RegularizationOfAttendanceViewModel(e){Logger.InfoLog("RegularizationOfAttendanceViewModel::Entering RegularizationOfAttendanceViewModel()"),this.DisplayMessage="",this.SelectedEmpID=parseInt(e[1]),this.dtDay=new Date(e[2]),this.ButtonClick.Subscribe(this,"Button_Click"),this.dtpCheckInDate.CustomFormat=l.a.SessionManager.Preferences["Date Format"],this.dtpCheckOutDate.CustomFormat=l.a.SessionManager.Preferences["Date Format"],this.lblTotalTime="00.00",this.dtpCheckInTime.CustomFormat="HH:mm",this.dtpCheckInTime.ShowTimePicker=!0,this.dtpCheckOutTime.CustomFormat="HH:mm",this.dtpCheckOutTime.ShowTimePicker=!0,this.dtpCheckInDate.SelectedDateChanged.Subscribe(this,"onDateChanged"),this.dtpCheckInTime.SelectedDateChanged.Subscribe(this,"onDateChanged"),this.dtpCheckOutDate.SelectedDateChanged.Subscribe(this,"onDateChanged"),this.dtpCheckOutTime.SelectedDateChanged.Subscribe(this,"onDateChanged");let t=l.a.common.GetDataTable("RegAtt003",this.SelectedEmpID.toString()+"~"+this.dtDay.ToString("dd MMM yyyy"));null!=t&&t.length>0&&(this.DocID=parseInt(t[0].DocID),this.lblDocNo=t[0].VoucherNo.toString(),this.lblDocDate=new Date(t[0].VoucherDate).ToString(l.a.SessionManager.Preferences["Date Format"]),this.lblEmpCode=t[0].EmpCode.toString(),this.lblEmpName=t[0].EmpName.toString(),this.dtpCheckInDate.Date=o.e.IsEmpty(t[0].CheckInDate)?null:new Date(t[0].CheckInDate),this.dtpCheckInTime.Date=o.e.IsEmpty(t[0].CheckInTime)?null:new Date(t[0].CheckInTime),this.dtpCheckOutDate.Date=o.e.IsEmpty(t[0].CheckOutDate)?null:new Date(t[0].CheckOutDate),this.dtpCheckOutTime.Date=o.e.IsEmpty(t[0].CheckOutTime)?null:new Date(t[0].CheckOutTime)),Logger.InfoLog("RegularizationOfAttendanceViewModel::Exiting RegularizationOfAttendanceViewModel()")}onDateChanged(e){if(null!=e){let e=null,t=null,i=null,s=null,a=new Date;e=new Date(this.dtpCheckInDate.Date),a=new Date(this.dtpCheckInTime.Date),t=new Date(e.getFullYear(),e.getMonth(),e.getDay(),a.getHours(),a.getMinutes(),a.getSeconds()),this.dtpCheckInTime.Date=t,i=new Date(this.dtpCheckOutDate.Date),a=new Date(this.dtpCheckOutTime.Date),s=new Date(i.getFullYear(),i.getMonth(),i.getDay(),a.getHours(),a.getMinutes(),a.getSeconds()),this.dtpCheckOutTime.Date=s,this.lblTotalTime=null!=e&&null!=t&&null!=i&&null!=s?this.CalculateTotalTime(e,t,i,s):"00.00"}}Button_Click(e){if(Logger.InfoLog("RegularizationOfAttendanceViewModel::Entering Button_Click"),"OK"==e.toString()){if(!this.ValidateScreen())return;if(!confirm("Are you sure want to proceed.?"))return;let e=l.a.common.ExecuteQuery_ReturnString("RegAtt002",this.dtpCheckInDate.Date.ToString("dd/MMM/yyyy")+"~"+this.dtpCheckInTime.Date.ToString("dd/MMM/yyyy HH:mm")+"~"+this.dtpCheckOutDate.Date.ToString("dd/MMM/yyyy")+"~"+this.dtpCheckOutTime.Date.ToString("dd/MMM/yyyy HH:mm")+"~"+this.lblTotalTime+"~"+this.DocID+"~"+this.lblDocNo+"~"+this.txtRemarks.Text);if(e.Trim().length>0)return this.DisplayMessage="Error : "+e,void(this.MessageVisibility=!0);{let e=l.a.common.GetDataTable("RegAtt004",this.DocID.toString());null!=e&&e.length>0&&parseInt(e[0].WorkFlowID)>0&&l.a.common.ExecuteQuery_ReturnString("RegAtt005",this.DocID.toString())}this.DialogResult=!0}else"Cancel"==e.toString()&&(this.DialogResult=!1);l.a.page.HideDialog(),Logger.InfoLog("RegularizationOfAttendanceViewModel::Exiting Button_Click")}CalculateTotalTime(e,t,i,s){if(t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),t.getHours(),t.getMinutes(),t.getSeconds()),(s=new Date(i.getFullYear(),i.getMonth(),i.getDate(),s.getHours(),s.getMinutes(),s.getSeconds()))<t)return"00.00";let a=s.Subtract(t);return a.Hours<0&&(a=a.add(u.TimeSpan.FromDays(1))),(24*a.Days+a.Hours).PrefixZero(2)+"."+a.Minutes.PrefixZero(2)}SaveStatus(e,t,i,s=!0){let a=null,n="";a=this.SetDocStatus(e,t,i,(new Date).Date(),this.txtRemarks.Text,!0,""),null!=a&&a.Tables.length>0&&a.Tables[0].length>0&&a.Columns[0].Contains("status")&&(n+="Document Status - ["+a.Tables[0][0].status.toString()+"] \r\n"),null!=a&&a.Tables.length>0&&a.Tables[a.Tables.length-1].length>0&&a.Columns[a.Columns.length-1].Contains("ErrorMessage")&&(n+=a.Tables[a.Tables.length-1][0].ErrorMessage.toString()),this.DisplayMessage=n,this.MessageVisibility=!0}SetDocStatus(e,t,i,s,a,n,h){Logger.InfoLog("VoucherGenerator:: Inside SetDocStatus");let o=[];o.push(e),o.push(null!=a?a:""),o.push(s.ToString("dd/MMM/yyyy")),o.push(!0),o.push(this.DocID),o.push(40089),o.push(t),o.push(i),o.push(n),o.push(h),o.push(l.a.SessionManager.CompanyGUID),o.push(l.a.SessionManager.UserName),o.push(l.a.SessionManager.UserID),o.push(l.a.SessionManager.RoleID),o.push(l.a.SessionManager.LanguageID);let u=l.a.document.SetDocStatus(o);return Logger.InfoLog("VoucherGenerator:: Exiting SetDocStatus"),u}ValidateScreen(){if(null==this.dtpCheckInDate.Date||o.e.IsEmpty(this.dtpCheckInDate.Date))return this.DisplayMessage="Select Check-in Date",this.dtpCheckInDate.SetFocus=!0,this.MessageVisibility=!0,!1;if(null==this.dtpCheckInTime.Date||o.e.IsEmpty(this.dtpCheckInTime.Date))return this.DisplayMessage="Select Check-in Time",this.dtpCheckInTime.SetFocus=!0,this.MessageVisibility=!0,!1;if(null==this.dtpCheckOutDate.Date||o.e.IsEmpty(this.dtpCheckOutDate.Date))return this.DisplayMessage="Select Check-out Date",this.dtpCheckOutDate.SetFocus=!0,this.MessageVisibility=!0,!1;if(null==this.dtpCheckOutTime.Date||o.e.IsEmpty(this.dtpCheckOutTime.Date))return this.DisplayMessage="Select Check-out Time",this.dtpCheckOutTime.SetFocus=!0,this.MessageVisibility=!0,!1;if(parseFloat(this.lblTotalTime)>24)return this.DisplayMessage="Total time can not exceed 24 Hours",this.dtpCheckOutTime.SetFocus=!0,this.MessageVisibility=!0,!1;let e=l.a.common.GetDataTable("RegAtt006","");if(null!=e&&e.length>0&&"True"==o.e.String(e[0].PrefValue)&&this.txtRemarks.Text.length<=0)return this.DisplayMessage="Remarks Mandatory",this.txtRemarks.SetFocus=!0,this.MessageVisibility=!0,!1;let t=l.a.common.GetDataTable("RegAtt001",this.SelectedEmpID.toString()+"~"+this.dtpCheckInDate.Date.ToString("dd/MMM/yyyy")+"~"+this.DocID);return!(null!=t&&t.length>0&&(this.DisplayMessage="Data already existed on the Selected Date for the Employee @ Voucher No. : "+t.Rows[0].VoucherNo,this.dtpCheckInDate.SetFocus=!0,this.MessageVisibility=!0,1))}}}}]);
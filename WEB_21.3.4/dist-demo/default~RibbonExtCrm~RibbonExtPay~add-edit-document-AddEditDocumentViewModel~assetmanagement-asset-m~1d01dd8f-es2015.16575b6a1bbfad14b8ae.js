(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{hAwP:function(t,e,s){"use strict";s.d(e,"a",(function(){return h})),s.d(e,"b",(function(){return o}));var a=s("Do2H"),l=s("Lp6j"),r=s("eQJW"),i=s("NM0h");class h{constructor(){this.IsPercentage=!1,this.Value=0,this.CurrentValue=0,this.ColID="",this.AssetChangeID=0,this.IsDispose=!1}}class o{constructor(t){this.YearlyDpr=0,this.MonthlyDpr=0,this.dblDayDpr=0,this.CallFromAssetSave=!1,this.iCVCount=0,this.ErrorMessage="",this.dtDepr=null,this.NewEsitmateLife="",this.NewEsitmateEndDate=Date.Today(),this.PrevDeprValue=0,this.dsAsset=null,this._DDBRate=0,this.AssetID=t,this.strDecimals="N"+a.a.SessionManager.Preferences.DecimalsinAmount}GetScheduleData(t,e,s,o,n,D,d,g,c,u,p,S,A,M,F="",T=0){let m=1,y=0,b=0,f=0,C=0,Y=[];this.ErrorMessage="";let w=!1,V=!1;this.dsAsset=null;let I=0;if(this.EndDate=A,this._DDBRate=u,this.PrevDeprValue=D,this.ScheduleTable=[],this.ScheduleTableColumns=[],this.ScheduleTableColumns.push("Period"),this.ScheduleTableColumns.push("From"),this.ScheduleTableColumns.push("To"),this.ScheduleTableColumns.push("Depr Amt"),this.ScheduleTableColumns.push("Accm Depr"),this.ScheduleTableColumns.push("Net Value"),this.ScheduleTableColumns.push("ActualDeprAmt"),this.ScheduleTableColumns.push("ScheduleID"),this.ScheduleTableColumns.push("DocID"),t<=0)return;if(this.AssetID>0){if(this.dsAsset=i.a.GetAssetDeprSchDetails(this.AssetID),this.dtDepr=this.dsAsset.Tables[1],!this.CallFromAssetSave){c=this.dsAsset.Tables[0][0].Period.toString();let t,a,i=this.NewEsitmateLife.length>0?this.NewEsitmateLife:this.dsAsset.Tables[0][0].EstimateLife.toString();a=i.indexOf("."),t=l.e.Int(-1!=a?i.substr(0,a):i),e=t;let h=i.split(".");h.length>1&&(s=l.e.Int(h[1])),h.length>2&&(o=l.e.Int(h[2])),null!=this.dsAsset.Tables[0][0].OriginalDeprStartDate&&(n=new Date(this.dsAsset.Tables[0][0].OriginalDeprStartDate)),Object(r.j)(this.dsAsset.Tables[0][0].IncludeSalvageInDepr)||(d="1"==this.dsAsset.Tables[0][0].SalvageValueType.toString()?parseFloat(this.dsAsset.Tables[0][0].SalvageValue):parseFloat(this.dsAsset.Tables[0][0].SalvageValue)*parseFloat(this.dsAsset.Tables[0][0].DeprStartValue)/100),this.PrevDeprValue=parseFloat(this.dsAsset.Tables[0][0].PreviousDepreciation),g=this.dsAsset.Tables[0][0].DepreciationMethod.toString(),p=this.dsAsset.Tables[0][0].AveragingMethod.toString(),this.NewEsitmateLife.length>0?(S=M.Date,A=this.NewEsitmateEndDate.AddDays(-1)):(S=new Date(this.dsAsset.Tables[0][0].DeprStartDate),A=new Date(this.dsAsset.Tables[0][0].DeprEndDate).AddDays(-1)),this.EndDate=A}"3"==p&&null==M&&1!=S.getDate()&&(V=!0,S.getDate()<=15?(S=S.AddDays(1-S.getDate()),A=A.AddDays(-A.getDate())):(S=S.AddDays(S.DaysInMonth()-S.getDate()+1),A=A.AddDays(A.DaysInMonth()-A.getDate())),this.EndDate=A);let D=null,u=this.dsAsset.Tables[2].filter(t=>25==t.ChangeType);if(u.sort((t,e)=>e.Date-t.Date),u.length>0&&(D=new Date(u[0].Date),D>=M.Date&&null!=M))return void(this.ErrorMessage="Date should be greater than previous estimation chang date("+D.ToString(a.a.SessionManager.Preferences["Date Format"])+").");let F=this.dsAsset.Tables[2].filter(t=>0==t.ChangeType||5==t.ChangeType);for(let t=0;t<F.length;t++){let e=F[t],s=new Date(e.Date);if(this.NewEsitmateLife.length>0||D&&D>s)continue;let a=new h;Y.push(a),a.Date=s,a.Value+=parseFloat(e.ChangeValue),a.AssetChangeID=parseInt(e.AssetChangeID),5==parseInt(e.ChangeType)&&(a.IsDispose=!0)}if(null!=M){if(M.Date>this.EndDate)return void(this.ErrorMessage="Date should be less than end date.");if(M.Date<S)return void(this.ErrorMessage="Date should be greater than put to use.");let t=this.dsAsset.Tables[1].filter(t=>null!=t.DocID&&(new Date(t.FromDate)>=M.Date||new Date(t.FromDate)<=M.Date&&new Date(t.ToDate)>M.Date));if(t.length>0)return void(this.ErrorMessage="Depreciation posting exists for selected date.");let e=new Date(M.Date.getFullYear(),M.Date.getMonth(),M.Date.getDate());if(t=this.dsAsset.Tables[1].filter(t=>null==t.DocID&&new Date(t.ToDate)<e),t.length>0)return void(this.ErrorMessage="Clear Pending Depreciation Postings.");0==this.NewEsitmateLife.length&&Y.push(M)}if(this.dsAsset.Tables[1].length>0){w=!0;let e,s=0;e=null==this.dsAsset.Tables[0][0].DeprStartValue?parseFloat(this.dsAsset.Tables[0][0].PurchaseValue):parseFloat(this.dsAsset.Tables[0][0].DeprStartValue);let a=!1;for(let l=0;l<this.dsAsset.Tables[1].length;l++){let r=this.dsAsset.Tables[1][l];if(0!=this.NewEsitmateLife.length&&null==r.DocID){if(a)continue;let e=0;t=parseFloat(r.NetValue)+parseFloat(r.DeprAmt),new Date(r.FromDate)!=M.Date&&(M.Date.Subtract(new Date(r.FromDate)),e=parseFloat(r.DeprAmt)*M.Date.Subtract(new Date(r.FromDate)).Days/new Date(r.ToDate).Subtract(new Date(r.FromDate)).Days,e=parseFloat(e.ToString(this.strDecimals)),t-=e,this.ScheduleTableAdd(m,new Date(r.FromDate),M.Date.AddDays(-1),e,s+e,t,e),m++),I=s+e,a=!0}else{let t={};this.ScheduleTable.push(t),t.Period=m,t.From=new Date(r.FromDate),t.To=new Date(r.ToDate),0!=this.NewEsitmateLife.length?(t.ActualDeprAmt=parseFloat(r.DeprAmt),t["Depr Amt"]=parseFloat(r.DeprAmt),s+=parseFloat(r.DeprAmt),t["Accm Depr"]=s,t["Net Value"]=r.NetValue):(t.ActualDeprAmt=parseFloat(r.ActualDeprAmt),t["Depr Amt"]=parseFloat(r.ActualDeprAmt),s+=parseFloat(r.ActualDeprAmt),t["Accm Depr"]=s,t["Net Value"]=e-s),t.ScheduleID=parseFloat(r.ScheduleID),t.DocID=r.DocID,m++}}}}if("4"==g)g="WDV";else if("5"==g){if(g="WDV_IT_India",p="FP",!l.e.IsEmpty(F)&&parseInt(F)>0){let t=a.a.report.DataSet("RPT022","select BasedOnValue from ACC_DeprBook with(nolock) where DeprBookID="+F);u=parseFloat(t.Tables[0][0].BasedOnValue)}}else g="SLN";let E=p;if("1"==p?p="CD":"3"==p?(1==S.getDate()||V||(S.getDate()<=15?(S=S.AddDays(1-S.getDate()),A=A.AddDays(-A.getDate())):(S=S.AddDays(S.DaysInMonth()-S.getDate()+1),A=A.AddDays(A.DaysInMonth()-A.getDate())),this.EndDate=A),p="FP"):p="FP",c="1"==c?"M":"3"==c?"Q":"4"==c?"H":"Y",!w||0!=this.NewEsitmateLife.length){if(o>0&&0==this.NewEsitmateLife.length&&"1"!=E&&(null==n||!n))return void(this.ErrorMessage="Select Original Put To Use.");if("WDV_IT_India"==g)this.YearlyDpr=null!=M?t*u/100:(t+this.PrevDeprValue)*u/100;else if(this.PrevDeprValue>0&&o>0&&"CD"!=p){let e,s;null!=M?(e=t,s=S):(e=t+this.PrevDeprValue,s=n);let a=0,l=n.getDate();for(let t=s;t<A.AddDays(1);)a++,t=t.AddMonths(1),l>=29&&t.getDate()<l&&l<=t.DaysInMonth()&&(t=new Date(t.getFullYear(),t.getMonth(),l));this.YearlyDpr=this.CalcDeprPerYear(e,0,a,d,g)}else this.YearlyDpr=this.CalcDeprPerYear(t,e,s,d,g);this.YearlyDpr=parseFloat(this.YearlyDpr.ToString(this.strDecimals)),this.MonthlyDpr=parseFloat((this.YearlyDpr/12).ToString(this.strDecimals)),this.dblDayDpr=0,"CD"==p&&(this.dblDayDpr=this.CalcDeprPerDay(t,d,g,S,A));let r,i,h=0,D=S.DaysInMonth()-S.getDate()+1,T=12-S.iMonth();if(1!=a.a.SessionManager.AccountingFromMonth&&(T=a.a.SessionManager.AccountingFromMonth<=S.iMonth()?15-S.iMonth():3-S.iMonth()),"SLN"==g){if("M"==c){1!=S.getDate()?(i=S.iMonth()<12?new Date(S.getFullYear(),S.getMonth()+1,1):new Date(S.getFullYear()+1,0,1),i.AddDays(-1)>A?i=A:(h="CD"==p?D*this.dblDayDpr:S.AddDays(D).Subtract(S).TotalDays/S.DaysInMonth()*this.MonthlyDpr,h=parseFloat(h.ToString(this.strDecimals)),this.ScheduleTableAdd(m,S,S.AddDays(D-1),h,h+I,t-h),m++)):i=new Date(S.getFullYear(),S.getMonth(),1);let e=0,s=0;for(let l=i;l.AddMonths(1)<=A;l=l.AddMonths(1))s="CD"==p?parseFloat((i.DaysInMonth()*this.dblDayDpr).ToString(this.strDecimals)):this.MonthlyDpr,h=parseFloat((h+s).ToString(this.strDecimals)),e=parseFloat((0+t-h).ToString(this.strDecimals)),this.ScheduleTableAdd(m,i,i.AddMonths(1).AddDays(-1),s,h+I,e),m++,i=i.AddMonths(1);i=new Date(A.getFullYear(),A.getMonth(),1);let a=parseFloat((0+t-d-h).ToString(this.strDecimals));e=parseFloat((0+t-(h+a)).ToString(this.strDecimals)),a>0&&this.ScheduleTableAdd(m,i,A,a,h+a+I,e)}else if("Y"==c){i=1!=a.a.SessionManager.AccountingFromMonth&&S.iMonth()<a.a.SessionManager.AccountingFromMonth?new Date(S.getFullYear(),a.a.SessionManager.AccountingFromMonth-1,1):new Date(S.getFullYear()+1,a.a.SessionManager.AccountingFromMonth-1,1),i.AddDays(-1)>A?i=A:("CD"==p?h=parseFloat((i.Subtract(S).Days*this.dblDayDpr).ToString(this.strDecimals)):1!=S.getDate()?(h=S.AddDays(D).Subtract(S).TotalDays/S.DaysInMonth()*this.MonthlyDpr,h=parseFloat((h+T/12*this.YearlyDpr).ToString(this.strDecimals))):h=parseFloat(((T+1)/12*this.YearlyDpr).ToString(this.strDecimals)),this.ScheduleTableAdd(m,S,i.AddDays(-1),h,h+I,t-h),m++);let e=0,s=0;for(let a=i;a<A.AddYears(-1);a=a.AddYears(1))s="CD"==p?parseFloat((i.AddYears(1).Subtract(i).Days*this.dblDayDpr).ToString(this.strDecimals)):this.YearlyDpr,h=parseFloat((h+s).ToString(this.strDecimals)),e=parseFloat((t-h).ToString(this.strDecimals)),this.ScheduleTableAdd(m,i,i.AddYears(1).AddDays(-1),s,h+I,e),m++,i=i.AddYears(1);i=new Date(A.getFullYear(),a.a.SessionManager.AccountingFromMonth-1,1),1!=a.a.SessionManager.AccountingFromMonth&&i>A&&(i=i.AddYears(-1));let l=parseFloat((t-d-h).ToString(this.strDecimals));e=parseFloat((t-(h+l)).ToString(this.strDecimals)),l>0&&this.ScheduleTableAdd(m,i,A,l,h+l+I,e)}else if("Q"==c){let e=[],s=new Date(S.getFullYear(),a.a.SessionManager.AccountingFromMonth-1,1);s>S&&(s=s.AddYears(-1));let l=1,r=0,o=0;for(;s.AddMonths(3)<=S;)l++,s=s.AddMonths(3);for(e.push(S);s.AddMonths(3)<=A;)l++,5==l&&(l=1),s=s.AddMonths(3),e.push(s);if(1!=S.getDate()&&(i=new Date(S.getFullYear(),S.getMonth(),1).AddMonths(1),i.AddDays(-1)>A?i=A:(h="CD"==p?parseFloat((D*this.dblDayDpr).ToString(this.strDecimals)):S.AddDays(D).Subtract(S).TotalDays/S.DaysInMonth()*this.MonthlyDpr,h=parseFloat(h.ToString(this.strDecimals)),e[0]=i)),e.length>1){if(e[0]==e[1])this.ScheduleTableAdd(m,S,S.AddDays(D-1),h,h+I,t-h);else{let s=1!=S.getDate()?D:0;s+=e[1].Subtract(e[0]).Days,"CD"==p?o=parseFloat((e[1].Subtract(e[0]).Days*this.dblDayDpr).ToString(this.strDecimals)):(l=e[1].Subtract(e[0]).Days/28,o=this.MonthlyDpr*l),h=parseFloat((h+o).ToString(this.strDecimals)),this.ScheduleTableAdd(m,S,S.AddDays(s-1),h,h+I,t-h)}e.RemoveAt(0)}for(let a=0;a<e.length-1;a++)o="CD"==p?parseFloat((e[a+1].Subtract(e[a]).Days*this.dblDayDpr).ToString(this.strDecimals)):3*this.MonthlyDpr,h=parseFloat((h+o).ToString(this.strDecimals)),r=parseFloat((t-h).ToString(this.strDecimals)),this.ScheduleTableAdd(m,e[a],e[a+1].AddDays(-1),o,h+I,r);let n=parseFloat((t-d-h).ToString(this.strDecimals));r=parseFloat((t-(h+n)).ToString(this.strDecimals)),n>0&&this.ScheduleTableAdd(m,e[e.length-1],A,n,h+n+I,r)}else if("H"==c){let e=[],s=new Date(S.getFullYear(),a.a.SessionManager.AccountingFromMonth-1,1);s>S&&(s=s.AddYears(-1));let l=1,r=0,o=0;for(;s.AddMonths(6)<=S;)l++,s=s.AddMonths(6);for(e.push(S);s.AddMonths(6)<=A;)l++,3==l&&(l=1),s=s.AddMonths(6),e.push(s);if(1!=S.getDate()&&(i=new Date(S.getFullYear(),S.getMonth(),1).AddMonths(1),1==e.length?i=A:(h="CD"==p?parseFloat((D*this.dblDayDpr).ToString(this.strDecimals)):S.AddDays(D).Subtract(S).TotalDays/S.DaysInMonth()*this.MonthlyDpr,h=parseFloat(h.ToString(this.strDecimals)),e[0]=i)),e.length>1){if(e[0]==e[1])this.ScheduleTableAdd(m,S,S.AddDays(D-1),h,h+I,t-h);else{let s=1!=S.getDate()?D:0;s+=e[1].Subtract(e[0]).Days,"CD"==p?o=parseFloat((e[1].Subtract(e[0]).Days*this.dblDayDpr).ToString(this.strDecimals)):(l=e[1].Subtract(e[0]).Days/28,o=this.MonthlyDpr*l),h=parseFloat((h+o).ToString(this.strDecimals)),this.ScheduleTableAdd(m,S,S.AddDays(s-1),h,h+I,t-h)}e.RemoveAt(0)}for(let a=0;a<e.length-1;a++)o="CD"==p?parseFloat((e[a+1].Subtract(e[a]).Days*this.dblDayDpr).ToString(this.strDecimals)):6*this.MonthlyDpr,h=parseFloat((h+o).ToString(this.strDecimals)),r=parseFloat((t-h).ToString(this.strDecimals)),this.ScheduleTableAdd(m,e[a],e[a+1].AddDays(-1),o,h+I,r);let n=parseFloat((t-d-h).ToString(this.strDecimals));r=parseFloat((t-(h+n)).ToString(this.strDecimals)),n>0&&this.ScheduleTableAdd(m,e[e.length-1],A,n,h+n+I,r)}}else if("WDV"==g){let s=t,r=0;if(!l.e.StringIsNullOrEmpty(F)&&parseInt(F)>0){let t=a.a.common.GetDataSet("DEPSCHE001",F);u=parseFloat(t.Tables[0][0].BasedOnValue),this._DDBRate=u}if(D="CD"==p?S.DaysInMonth()-S.getDate()+1:S.DaysInMonth(),this.dblDayDpr=this.CalcDeprePerDay(t,this._DDBRate,g,S,A,e),"M"==c){1!=S.getDate()?(i=S.iMonth()<12?new Date(S.getFullYear(),S.getMonth()+1,1):new Date(S.getFullYear()+1,1,1),i.AddDays(-1)>A?i=A:(h="CD"==p?D*this.dblDayDpr:parseFloat((D*this.dblDayDpr).ToString(this.strDecimals)),h=parseFloat((h+r).ToString(this.strDecimals)),s=parseFloat((t-h).ToString(this.strDecimals)),t=s,this.ScheduleTableAdd(m,i,i.AddMonths(1).AddDays(-1),r,h+I,s),m++,y++)):i=new Date(S.getFullYear(),S.getMonth(),1);for(let o=i;o.AddMonths(1)<=A;o=o.AddMonths(1))h=0,r=parseFloat((i.DaysInMonth()*this.dblDayDpr).ToString(this.strDecimals)),h=parseFloat((h+r).ToString(this.strDecimals)),s=parseFloat((t-h).ToString(this.strDecimals)),t=parseFloat(s.ToString(this.strDecimals)),this.ScheduleTableAdd(m,i,i.AddMonths(1).AddDays(-1),r,h+I,s),m++,i.getMonth()==a.a.SessionManager.AccountingFromMonth&&y>0&&(y=12),y++,12==y&&(C=s*this._DDBRate/100,this.dblDayDpr=this.CalcDeprePerDay(t,C,g,i,A,e),y=0,C=0),i=i.AddMonths(1);i=new Date(A.getFullYear(),A.getMonth(),1);let l=0;l=parseFloat((i.DaysInMonth()*this.dblDayDpr).ToString(this.strDecimals)),s=parseFloat((t-h).ToString(this.strDecimals)),l>0&&this.ScheduleTableAdd(m,i,A,l,l,s)}else if("Y"==c){i=1!=a.a.SessionManager.AccountingFromMonth&&S.iMonth()<a.a.SessionManager.AccountingFromMonth?new Date(S.getFullYear(),a.a.SessionManager.AccountingFromMonth-1,1):new Date(S.getFullYear()+1,a.a.SessionManager.AccountingFromMonth-1,1),i.AddDays(-1)>A?i=A:("CD"==p?h=parseFloat((i.Subtract(S).Days*s*this.dblDayDpr).ToString(this.strDecimals)):1!=S.getDate()?(h=S.AddDays(D).Subtract(S).TotalDays/S.DaysInMonth()*s*this.MonthlyDpr,h=parseFloat((h+T/12*s*this.YearlyDpr).ToString(this.strDecimals))):h=parseFloat(((T+1)/12*s*this.YearlyDpr).ToString(this.strDecimals)),s-=h,this.ScheduleTableAdd(m,S,i.AddDays(-1),h,h+I,s),m++);for(let t=i;t<A.AddYears(-1);t=t.AddYears(1))r="CD"==p?parseFloat((i.AddYears(1).Subtract(i).Days*s*this.dblDayDpr).ToString(this.strDecimals)):parseFloat((s*this.YearlyDpr).ToString(this.strDecimals)),h=parseFloat((h+r).ToString(this.strDecimals)),s=parseFloat((s-r).ToString(this.strDecimals)),this.ScheduleTableAdd(m,i,i.AddYears(1).AddDays(-1),r,h+I,s),m++,i=i.AddYears(1);i=new Date(A.getFullYear(),a.a.SessionManager.AccountingFromMonth-1,1),1!=a.a.SessionManager.AccountingFromMonth&&i>A&&(i=i.AddYears(-1));let e=parseFloat((t-d-h).ToString(this.strDecimals));s=parseFloat((t-(h+e)).ToString(this.strDecimals)),e>0&&this.ScheduleTableAdd(m,i,A,e,h+e+I,s)}else if("Q"==c){let l=new Array,o=new Date(S.getFullYear(),a.a.SessionManager.AccountingFromMonth-1,1);o>S.Date()&&(o=o.AddYears(-1));let n=1;for(;o.AddMonths(3)<=S;)n++,o=o.AddMonths(3);for(l.push(S);o.AddMonths(3)<=A;)n++,5==n&&(n=1),o=o.AddMonths(3),l.push(o);if(1!=S.getDate()&&(i=new Date(S.getFullYear(),S.getMonth(),1).AddMonths(1),i.AddDays(-1)>A?i=A:(h=D*this.dblDayDpr,l[0]=i)),l.length>1){if(b++,l[0]==l[1])s=parseFloat((t-h).ToString(this.strDecimals)),t=s,this.ScheduleTableAdd(m,S,S.AddDays(D-1),h,h+I,s);else{let e=1!=S.getDate()?D:0;e+=l[1].Subtract(l[0]).Days,r=parseFloat((l[1].Subtract(l[0]).Days*this.dblDayDpr).ToString(this.strDecimals)),h=parseFloat((h+r).ToString(this.strDecimals)),s=parseFloat((t-h).ToString(this.strDecimals)),t=s,this.ScheduleTableAdd(m,S,S.AddDays(e-1),h,h+I,s)}l.RemoveAt(0)}for(let a=0;a<l.length-1;a++)h=0,r=parseFloat((l[a+1].Subtract(l[a]).Days*this.dblDayDpr).ToString(this.strDecimals)),h=parseFloat((h+r).ToString(this.strDecimals)),s=parseFloat((t-h).ToString(this.strDecimals)),t=s,this.ScheduleTableAdd(m,l[a],l[a+1].AddDays(-1),r,h+I,s),b++,4==b&&(C=s*this._DDBRate/100,this.dblDayDpr=this.CalcDeprePerDay(t,C,g,l[a+1].Date,A,e),b=0,C=0);let d=A.Subtract(l[l.length-1]).TotalDays;d+=1;let c=parseFloat((d*this.dblDayDpr).ToString(this.strDecimals));s=parseFloat((t-h).ToString(this.strDecimals)),c>0&&this.ScheduleTableAdd(m,l[l.length-1],A,c,c,s)}else if("H"==c){let l=new Array,o=new Date(S.getFullYear(),a.a.SessionManager.AccountingFromMonth-1,1);o>S.Date()&&(o=o.AddYears(-1));let n=1;for(;o.AddMonths(6)<=S;)n++,o=o.AddMonths(6);for(l.push(S);o.AddMonths(6)<=A;)n++,3==n&&(n=1),o=o.AddMonths(6),l.push(o);if(1!=S.getDate()&&(i=new Date(S.getFullYear(),S.getMonth(),1).AddMonths(1),1==l.length?i=A:(h=D*this.dblDayDpr,l[0]=i)),l.length>1){if(f++,l[0]==l[1])s=parseFloat((t-h).ToString(this.strDecimals)),t=s,this.ScheduleTableAdd(m,S,S.AddDays(D-1),h,h+I,s);else{let e=1!=S.getDate()?D:0;e+=l[1].Subtract(l[0]).Days,r=parseFloat((l[1].Subtract(l[0]).Days*this.dblDayDpr).ToString(this.strDecimals)),h=parseFloat((h+r).ToString(this.strDecimals)),s=parseFloat((t-h).ToString(this.strDecimals)),t=s,this.ScheduleTableAdd(m,S,S.AddDays(e-1),h,h+I,s)}l.RemoveAt(0)}for(let a=0;a<l.length-1;a++)h=0,r=parseFloat((l[a+1].Subtract(l[a]).Days*this.dblDayDpr).ToString(this.strDecimals)),h=parseFloat((h+r).ToString(this.strDecimals)),s=parseFloat((t-h).ToString(this.strDecimals)),t=s,this.ScheduleTableAdd(m,l[a],l[a+1].AddDays(-1),r,h+I,s),f++,2==f&&(C=s*this._DDBRate/100,this.dblDayDpr=this.CalcDeprePerDay(t,C,g,l[a+1].Date,A,e),f=0,C=0);let d=A.Subtract(l[l.length-1]).TotalDays;d+=1;let c=parseFloat((d*this.dblDayDpr).ToString(this.strDecimals));s=parseFloat((t-h).ToString(this.strDecimals)),c>0&&this.ScheduleTableAdd(m,l[l.length-1],A,c,c,s)}}else if("WDV_IT_India"==g){let e=t,s=0;for(i=new Date(S.getFullYear(),S.getMonth(),1).AddMonths(1),i=1!=a.a.SessionManager.AccountingFromMonth&&S.iMonth()<a.a.SessionManager.AccountingFromMonth?new Date(S.getFullYear(),a.a.SessionManager.AccountingFromMonth-1,1):new Date(S.getFullYear()+1,a.a.SessionManager.AccountingFromMonth-1,1),i.AddDays(-1)>A?i=A:(h=T<=5?parseFloat((e*u*.5/100).ToString(this.strDecimals)):parseFloat((e*u/100).ToString(this.strDecimals)),e-=h,this.ScheduleTableAdd(m,S,i.AddDays(-1),h,h+I,e),m++);e>=.1;)s=parseFloat((e*u/100).ToString(this.strDecimals)),h=parseFloat((h+s).ToString(this.strDecimals)),e=parseFloat((e-s).ToString(this.strDecimals)),this.ScheduleTableAdd(m,i,i.AddYears(1).AddDays(-1),s,h+I,e),m++,i=i.AddYears(1)}else if("DDB"==g&&"Y"==c){i=new Date(S.getFullYear()+1,1,1),r=t*u,h=(T+1)/12*r;let e=t-h;this.ScheduleTableAdd(m,S,i,h,h,e),i=new Date(S.getFullYear()+1,1,1),m++;for(let s=S;s<A.AddYears(-1);s=s.AddYears(1))r=.4*e,r>t-d-h&&(r=t-d-h),h+=r,e=t-h,this.ScheduleTableAdd(m,i,i.AddYears(1).AddDays(-1),r,h,e),m++,i=i.AddYears(1);if(1==S.getDate()&&1==S.iMonth());else{i=new Date(A.getFullYear(),0,1);let s=0;s=1==S.getDate()?A.iMonth():A.iMonth()-1,r=.4*e;let a=s/12*r,l=!1;a>t-d-h&&(a=t-d-h,l=!0),h+=a,(0!=a||l)&&this.ScheduleTableAdd(m,i,A,a,h,t-h)}}else if("DDB"==g&&"M"==c){let e=0;r=t*u,this.MonthlyDpr=r/12,1!=S.getDate()?(h=S.AddDays(D).Subtract(S).TotalDays/S.DaysInMonth()*this.MonthlyDpr,e=t-h,this.ScheduleTableAdd(m,S,S.AddDays(D-1),h,h,e),m++,i=S.iMonth()<12?new Date(S.getFullYear(),S.getMonth()+1,1):new Date(S.getFullYear()+1,0,1)):i=new Date(S.getFullYear(),S.getMonth(),1),A.getDate();for(let s=i;s<A.AddMonths(-1);s=s.AddMonths(1))m>1&&1==s.getDate()&&1==s.iMonth()&&(r=.4*e,this.MonthlyDpr=r/12),this.MonthlyDpr>t-d-h&&(this.MonthlyDpr=t-d-h),h+=this.MonthlyDpr,e=t-h,this.ScheduleTableAdd(m,i,i.AddMonths(1).AddDays(-1),this.MonthlyDpr,h,e),m++,i=i.AddMonths(1);if(1!=S.getDate()){i=new Date(A.getFullYear(),A.getMonth(),1);let e=A.DaysInMonth();this.ScheduleTableAdd(m,i,i.AddDays(A.getDate()-1),A.getDate()/e*this.MonthlyDpr,h+A.getDate()/e*this.MonthlyDpr,t-(h+A.getDate()/e*this.MonthlyDpr)),m++}else i=new Date(A.getFullYear(),A.getMonth(),1),this.ScheduleTableAdd(m,i,i.AddMonths(1).AddDays(-1),this.MonthlyDpr,h+this.MonthlyDpr,t-(h+this.MonthlyDpr)),m++}this.ScheduleTable.forEach(t=>{t.ActualDeprAmt=t["Depr Amt"]})}if(this.iCVCount=0,this.ScheduleTableColumns.push("CV"),this.ScheduleTableColumns.push("CVTotal"),Y.forEach(t=>{t.ColID="CV"+this.iCVCount,this.ScheduleTableColumns.Contains(t.ColID)&&this.ScheduleTableColumns.Remove(t.ColID),this.ScheduleTableColumns.push(t.ColID),this.iCVCount++,this.SetChangeValueData(t,g,c,p,t.Date)}),Y.length>0&&this.ScheduleTable.length>0){let t=0,e=0,s=0,a=0;this.ScheduleTable.forEach(l=>{e+=null!=l.CVTotal?parseFloat(l.CVTotal):0,t=null!=l.CV?parseFloat(l.CV):0,l["Depr Amt"]=parseFloat((parseFloat(l["Depr Amt"])+t).ToString(this.strDecimals)),a+=parseFloat(l["Depr Amt"]),l["Accm Depr"]=parseFloat(a.ToString(this.strDecimals)),s+=t,l["Net Value"]=parseFloat((parseFloat(l["Net Value"])+(e-s)).ToString(this.strDecimals))})}}ScheduleTableAdd(t,e,s,a,l,r,i=0){let h={};this.ScheduleTable.push(h),h.Period=t,h.From=e,h.To=s,h["Depr Amt"]=a,h["Accm Depr"]=l,h["Net Value"]=r,h.ActualDeprAmt=i}SetChangeValueData(t,e,s,l,r){let i=t.Value,h=0,o=0,n=r;for(;n<=this.EndDate;)o++,n=n.AddMonths(1);h=Math.floor(o/12),o%=12,this.dblDayDpr=0,this.dblDayDpr=this.CalcDeprPerDay(i,0,e,r,this.EndDate),this.YearlyDpr=this.CalcDeprPerYear(i,h,o,0,e),this.MonthlyDpr=parseFloat((this.YearlyDpr/12).ToString(this.strDecimals));let D,d=0,g=r.DaysInMonth()-r.getDate()+1,c=12-r.iMonth();1!=a.a.SessionManager.AccountingFromMonth&&(c=a.a.SessionManager.AccountingFromMonth<=r.iMonth()?15-r.iMonth():3-r.iMonth());let u=this.ScheduleTable.filter(t=>t.From<=r&&t.To>r);if(u.length>0){let e=t.IsDispose?-t.Value:t.Value;u[0].CVTotal=null==u[0].CVTotal?e:parseFloat(u[0].CVTotal)+e}if("SLN"==e){if("M"==s){1!=r.getDate()?(d="CD"==l?g*this.dblDayDpr:r.AddDays(g).Subtract(r).TotalDays/r.DaysInMonth()*this.MonthlyDpr,d=parseFloat(d.ToString(this.strDecimals)),this.SetCV(t,r,d),D=r.iMonth()<12?new Date(r.getFullYear(),r.getMonth()+1,1):new Date(r.getFullYear()+1,0,1)):D=new Date(r.getFullYear(),r.getMonth(),1);let e=0;for(let a=r;a<this.EndDate.AddMonths(-1);a=a.AddMonths(1))e="CD"==l?parseFloat((D.DaysInMonth()*this.dblDayDpr).ToString(this.strDecimals)):this.MonthlyDpr,this.SetCV(t,D,e),d+=e,D=D.AddMonths(1);D=new Date(this.EndDate.getFullYear(),this.EndDate.getMonth(),1);let s=parseFloat((i-d).ToString(this.strDecimals));this.SetCV(t,D,s)}else if("Y"==s){let e;D=1!=a.a.SessionManager.AccountingFromMonth&&r.iMonth()<a.a.SessionManager.AccountingFromMonth?new Date(r.getFullYear(),a.a.SessionManager.AccountingFromMonth-1,1):new Date(r.getFullYear()+1,a.a.SessionManager.AccountingFromMonth-1,1),D.AddDays(-1)>this.EndDate?D=this.EndDate:(D=new Date(r.getFullYear()+1,0,1),"CD"==l?d=parseFloat((D.Subtract(r).Days*this.dblDayDpr).ToString(this.strDecimals)):1!=r.getDate()?(d=r.AddDays(g).Subtract(r).TotalDays/r.DaysInMonth()*this.MonthlyDpr,d=parseFloat((d+c/12*this.YearlyDpr).ToString(this.strDecimals))):d=parseFloat(((c+1)/12*this.YearlyDpr).ToString(this.strDecimals))),this.SetCV(t,r,d),D=1!=a.a.SessionManager.AccountingFromMonth&&r.iMonth()<a.a.SessionManager.AccountingFromMonth?new Date(r.getFullYear(),a.a.SessionManager.AccountingFromMonth-1,1):new Date(r.getFullYear()+1,a.a.SessionManager.AccountingFromMonth-1,1);for(let s=r;s<this.EndDate.AddYears(-1);s=s.AddYears(1))e="CD"==l?parseFloat((D.AddYears(1).Subtract(D).Days*this.dblDayDpr).ToString(this.strDecimals)):this.YearlyDpr,d=parseFloat((d+e).ToString(this.strDecimals)),this.SetCV(t,D,e),D=D.AddYears(1);if(1==r.getDate()&&1==r.iMonth());else{D=new Date(this.EndDate.getFullYear(),1,1);let e=parseFloat((i-d).ToString(this.strDecimals));e>0&&this.SetCV(t,D,e)}}else if("Q"==s){let e=[],s=new Date(r.getFullYear(),a.a.SessionManager.AccountingFromMonth-1,1);s>r&&(s=s.AddYears(-1));let h,o=1;for(;s.AddMonths(3)<=r;)o++,s=s.AddMonths(3);for(e.push(r);s.AddMonths(3)<=this.EndDate;)o++,5==o&&(o=1),s=s.AddMonths(3),e.push(s);if(1!=r.getDate()&&(D=new Date(r.getFullYear(),r.getMonth(),1).AddMonths(1),d="CD"==l?parseFloat((g*this.dblDayDpr).ToString(this.strDecimals)):r.AddDays(g).Subtract(r).TotalDays/r.DaysInMonth()*this.MonthlyDpr,d=parseFloat(d.ToString(this.strDecimals)),e[0]=D),e.length>1){if(e[0]==e[1])this.SetCV(t,r,d);else{let s=1!=r.getDate()?g:0;s+=e[1].Subtract(e[0]).Days,"CD"==l?h=parseFloat((e[1].Subtract(e[0]).Days*this.dblDayDpr).ToString(this.strDecimals)):(o=e[1].Subtract(e[0]).Days/28,h=this.MonthlyDpr*o),d=parseFloat((d+h).ToString(this.strDecimals)),this.SetCV(t,r,d)}e.RemoveAt(0)}for(let a=0;a<e.length-1;a++)h="CD"==l?parseFloat((e[a+1].Subtract(e[a]).Days*this.dblDayDpr).ToString(this.strDecimals)):3*this.MonthlyDpr,d=parseFloat((d+h).ToString(this.strDecimals)),this.SetCV(t,e[a],d);if(e[e.length-1]<=this.EndDate){let s=parseFloat((i-d).ToString(this.strDecimals));this.SetCV(t,e[e.length-1],s)}}else if("H"==s){let e=[],s=new Date(r.getFullYear(),a.a.SessionManager.AccountingFromMonth-1,1);s>r&&(s=s.AddYears(-1));let h,o=1;for(;s.AddMonths(6)<=r;)o++,s=s.AddMonths(6);for(e.push(r);s.AddMonths(6)<=this.EndDate;)o++,3==o&&(o=1),s=s.AddMonths(6),e.push(s);if(1!=r.getDate()&&(D=new Date(r.getFullYear(),r.getMonth(),1).AddMonths(1),d="CD"==l?parseFloat((g*this.dblDayDpr).ToString(this.strDecimals)):r.AddDays(g).Subtract(r).TotalDays/r.DaysInMonth()*this.MonthlyDpr,d=parseFloat(d.ToString(this.strDecimals)),e[0]=D),e.length>1){if(e[0]==e[1])this.SetCV(t,r,d);else{let s=1!=r.getDate()?g:0;s+=e[1].Subtract(e[0]).Days,"CD"==l?h=parseFloat((e[1].Subtract(e[0]).Days*this.dblDayDpr).ToString(this.strDecimals)):(o=e[1].Subtract(e[0]).Days/28,h=this.MonthlyDpr*o),d=parseFloat((d+h).ToString(this.strDecimals)),this.SetCV(t,r,d)}e.RemoveAt(0)}for(let a=0;a<e.length-1;a++)h="CD"==l?parseFloat((e[a+1].Subtract(e[a]).Days*this.dblDayDpr).ToString(this.strDecimals)):6*this.MonthlyDpr,d=parseFloat((d+h).ToString(this.strDecimals)),this.SetCV(t,e[a],d);if(e[e.length-1]<=this.EndDate){let s=parseFloat((i-d).ToString(this.strDecimals));this.SetCV(t,e[e.length-1],s)}}}else if("WDV_IT_India"==e){let e=i,s=0;{for(D=1!=a.a.SessionManager.AccountingFromMonth&&r.iMonth()<a.a.SessionManager.AccountingFromMonth?new Date(r.getFullYear(),a.a.SessionManager.AccountingFromMonth-1,1):new Date(r.getFullYear()+1,a.a.SessionManager.AccountingFromMonth-1,1),D.AddDays(-1)>this.EndDate?D=this.EndDate:(d=c<=5?parseFloat((e*this._DDBRate*.5/100).ToString(this.strDecimals)):parseFloat((e*this._DDBRate/100).ToString(this.strDecimals)),e-=d,this.SetCV(t,r,d));e>=.1;)s=parseFloat((e*this._DDBRate/100).ToString(this.strDecimals)),d=parseFloat((d+s).ToString(this.strDecimals)),e=parseFloat((e-s).ToString(this.strDecimals)),this.SetCV(t,D,s),D=D.AddYears(1);let l=parseFloat((i-d).ToString(this.strDecimals));l>0&&this.SetCV(t,D,l)}}}SetCV(t,e,s){let a=this.ScheduleTable.filter(t=>t.From<=e&&t.To>e);a.length>0&&(t.IsDispose&&(s=-s),a[0][t.ColID]=null==a[0][t.ColID]?s:parseFloat(a[0][t.ColID])+s,a[0].CV=null==a[0].CV?s:parseFloat(a[0].CV)+s)}CalcDeprPerYear(t,e,s,a,l){return"SLN"==l?0==e&&0==s?t:s>0?(t-a)/(12*e+s)*12:(t-a)/e:"WDV"==l?0==e&&0==s?1:s>0?12*(1-Math.pow(a/t,1/(12*e+s))):1-Math.pow(a/t,1/e):t}CalcDeprPerDay(t,e,s,a,l){let r=l.Subtract(a).Days+1;return"SLN"==s?r<=0?NaN:(t-e)/r:"WDV"==s?r<=0?NaN:1-Math.pow(e/t,1/r):NaN}CalcDeprePerDay(t,e,s,a,l,r){l.Subtract(a);let i=365,h=(a.AddYears(r),a.DaysInMonth());return a.IsLeapYear()&&(i=366),"WDV"==s?h<=0?Number.NaN:e/i:Number.NaN}GetXML(){let t="";if(this.ScheduleTable.length>0){for(let t=0;t<this.ScheduleTable.length;t++)t>0&&parseFloat(l.e.String(this.ScheduleTable[t-1]["Net Value"]))<0&&parseFloat(l.e.String(this.ScheduleTable[t]["Net Value"]))<0&&(this.ScheduleTable.RemoveAt(t),t--);let e=0;t+="<XML> ",this.ScheduleTable.forEach(s=>{t+="<Row ",null!=s.ScheduleID&&(t+=' ScheduleID="'+s.ScheduleID.toString()+'"'),t+=' period="'+s.Period.toString()+'"',t+=' From="'+new Date(s.From).ToString("dd/MMM/yyyy")+'"',t+=' To="'+new Date(s.To).ToString("dd/MMM/yyyy")+'"',parseFloat(s["Depr Amt"])<0?t+=' DepAmt="0"':t+=' DepAmt="'+s["Depr Amt"].toString()+'"',parseFloat(s["Net Value"])<0&&(s["Net Value"]=0,e>0&&(s["Accm Depr"]=(parseFloat(this.ScheduleTable[e-1]["Accm Depr"])+parseFloat(this.ScheduleTable[e-1]["Net Value"])).ToString(this.strDecimals))),t+=' NetValue="'+s["Net Value"].toString()+'"',t+=' AccDep="'+s["Accm Depr"].toString()+'"',t+=' ActDepAmt="'+s.ActualDeprAmt.toString()+'"',t+=" />",e++}),t+=" </XML>"}return t.toString()}static CalculateEstimateLife(t,e){let s="",a=0,l=0,r=0,i=new Date(t.getFullYear(),t.getMonth(),t.getDate());for(;i.AddYears(1)<=e;)a++,i=i.AddYears(1);for(;i.AddMonths(1)<=e;)l++,i=i.AddMonths(1);return r=e.Subtract(i).Days,s=a.toString(),(l>0||r>0)&&(s+="."+l,r>0&&(s+="."+r)),s}}}}]);
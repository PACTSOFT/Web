(window.webpackJsonp=window.webpackJsonp||[]).push([[116],{k7Da:function(e,t,a){"use strict";a.r(t),a.d(t,"DeletedRecords",(function(){return y})),a.d(t,"AddCurrencyViewModel",(function(){return S}));var i=a("Do2H"),s=a("Lp6j"),n=a("4HhE"),r=a("ockk"),h=a("NkMH"),l=a("n56n"),o=a("0/4Q"),c=a("ScVY"),u=a("4ADR"),D=a("8B8H"),g=a("/GLD"),b=a("JIg3");class C extends c.b{constructor(e){super(),this.SaveNote=new n.b,this.Enable=!1,this.NoteID=0,this.NoteText="",this.CurrencyTypes=[],this.Index=0,this.ClassName="AddExchViewModel",Logger.InfoLog("AddExchViewModel::Entering AddExchViewModel with Parent="+e),this.Parent=e,this.CurrencyTypes=[],this.SaveNote.Subscribe(this,"OnSaveExchRate","onCanSaveOnSaveExchRate"),this.ExchDate=new b.a(0),this.ExchDate.Date=Date.Today(),this.ExchDate.Label="Date",this.ExchDate.DBColumnName="ExchDate",Logger.InfoLog("AddExchViewModel::Exiting AddExchViewModel")}OnSaveExchRate(e){if(null!=e&&"Cancel"==e.toString());else{if(Logger.InfoLog("AddExchViewModel::Entering OnSaveExchRate"),null==this.SelectedItem)return void alert("Please set Daily exchange rate for this currency");if(0==this.ExchRate.Trim().length||null==this.SelectedItem.Name||""==this.SelectedItem.Name)return;if(!this.Parent.ViewExhangeRates.ExchList.Contains(this)){let e=0;for(let a=0;a<this.Parent.ViewExhangeRates.ExchList.length;a++)if(!s.e.IsEmpty(this.Parent.ViewExhangeRates.ExchList[a].SelectedItem)&&!s.e.IsEmpty(this.Parent.ViewExhangeRates.ExchList[a].ExchDate)&&this.Parent.ViewExhangeRates.ExchList[a].SelectedItem.Name==this.SelectedItem.Name&&this.Parent.ViewExhangeRates.ExchList[a].ExchDate.Date==this.ExchDate.Date&&(e++,this.Index=a,!confirm("Exchange rate already exists for this date, do you want to overwrite?")))return;if(0==e){this.Parent.ViewExhangeRates.ExchList.push(this),this.Parent.ViewExhangeRates.ExchListDataTable.addEmptyRow();let e=this.Parent.ViewExhangeRates.ExchListDataTable.Table.length-1;this.Parent.ViewExhangeRates.ExchListDataTable.Table[e].Sno=e+1,this.Parent.ViewExhangeRates.ExchListDataTable.Table[e].SelectedCurrencyType=this.SelectedCurrencyType,this.Parent.ViewExhangeRates.ExchListDataTable.Table[e].Name=this.SelectedItem.Name,this.Parent.ViewExhangeRates.ExchListDataTable.Table[e].Text=this.ExchDate.Date,this.Parent.ViewExhangeRates.ExchListDataTable.Table[e].ExchDate=this.ExchDate.Date.ToString(i.a.SessionManager.Preferences["Date Format"]),this.Parent.ViewExhangeRates.ExchListDataTable.Table[e].ExchRate=this.ExchRate,this.Parent.ViewExhangeRates.ExchListDataTable.updateRow(this.Parent.ViewExhangeRates.ExchListDataTable.Table[e])}let t=this.Parent.Exch.SelectedCurrencyType;this.Parent.OnAddExchangeRate(),this.Parent.Exch.SelectedCurrencyType=t,Logger.InfoLog("AddExchViewModel::Exiting OnSaveExchRate")}}}onCanSaveOnSaveExchRate(e){return!0}OnDeleteCallBack(){this.Parent.ViewExhangeRates.ExchList.RemoveAt(this.Index),this.Parent.ViewExhangeRates.ExchList.push(this),this.Parent.ViewExhangeRates.ExchListDataTable.Table.RemoveAt(this.Index),this.Parent.ViewExhangeRates.ExchListDataTable.addEmptyRow();let e=this.Parent.ViewExhangeRates.ExchListDataTable.Table.length-1;this.Parent.ViewExhangeRates.ExchListDataTable.Table[e].SelectedCurrencyType=this.SelectedCurrencyType,this.Parent.ViewExhangeRates.ExchListDataTable.Table[e].Name=this.SelectedItem.Name,this.Parent.ViewExhangeRates.ExchListDataTable.Table[e].Text=new Date(this.ExchDate.Date),this.Parent.ViewExhangeRates.ExchListDataTable.Table[e].ExchDate=new Date(this.ExchDate.Date).ToString(i.a.SessionManager.Preferences["Date Format"]),this.Parent.ViewExhangeRates.ExchListDataTable.Table[e].ExchRate=this.ExchRate}}var d=a("EQd/");class m extends c.b{constructor(e){let t;super(),this.ColumnSpan="4",this.SelectionChangedCommandAssign=new n.b,this.Currency=[],this.FromDate=new b.a(0),this.Todate=new b.a(0),this.contextVisible=!0,this.ShowNewExchange=new n.b,this.ButtonClick=new n.b,this.ExchListDataTable=new D.a,this.ExchList=[],this.ColumnSource=new Array,this.DeletedNotes=[],this.ButtonAdd=new h.a,this.ButtonUpdate=new h.a,this.ButtonDelete=new h.a,this.Module="ACC",this.cmnItem_Click=new n.b,this.ClassName="ViewExchangeRateViewModel",Logger.InfoLog("ViewExchangeRateViewModel::Entering ViewExchangeRateViewModel with Parent="+e),this.Parent=e,this.FromDate.Label=i.a.GetResource("Calender_FromDate"),this.Todate.Label=i.a.GetResource("Calender_ToDate"),this.SelectionChangedCommandAssign.Subscribe(this,"onSelectionChangedAssign"),this.Currency=[],this.ButtonUpdate.Visible||this.ButtonDelete.Visible||(this.contextVisible=!1),this.cmnItem_Click.Subscribe(this,"OnCmnItem_Click","onCanCmnItem_Click"),this.ShowNewExchange.Subscribe(this,"OnShowNewExchange"),this.ButtonClick.Subscribe(this,"OnButtonClick"),this.ExchListDataTable.Table=[],this.ExchListDataTable.TableColumns.push("Sno"),this.ExchListDataTable.TableColumns.push("SelectedCurrencyType"),this.ExchListDataTable.TableColumns.push("Name"),this.ExchListDataTable.TableColumns.push("Text"),this.ExchListDataTable.DataTypes.Date.push("Text"),this.ExchListDataTable.TableColumns.push("ExchDate"),this.ExchListDataTable.TableColumns.push("ExchRate"),t=new r.a,t.Header=i.a.GetResource("Currency_CurrencyName"),t.DisplayMember="Name",t.DataType="TextBlock",t.ReadOnly=!0,t.Width=250,this.ColumnSource.push(t),t=new r.a,t.Header=i.a.GetResource("Exch_Date"),t.DisplayMember="ExchDate",t.ReadOnly=!0,t.DataType="TextBlock",t.Width=250,this.ColumnSource.push(t),t=new r.a,t.Header=i.a.GetResource("Currency_ExchangeRate"),t.DisplayMember="ExchRate",t.DataType="TextBlock",t.Width=250,t.ReadOnly=!0,this.ColumnSource.push(t),this.ExchListDataTable.Columns=this.ColumnSource,this.ExchListDataTable.ContextMenuClickSubject.subscribe(e=>{this.OnCmnItem_Click(e.item.Tag)}),this.ExchListDataTable.ContextMenu.Items=[];let a=new r.b;a.Header="EDIT",a.Tag="EDIT",a.Visibility=!0,this.ExchListDataTable.ContextMenu.Items.push(a),a=new r.b,a.Header="DELETE",a.Tag="DELETE",a.Visibility=!0,this.ExchListDataTable.ContextMenu.Items.push(a),Logger.InfoLog("ViewExchangeRateViewModel::Exiting ViewExchangeRateViewModel ")}get angularGrid(){return this.ExchListDataTable.angularGrid}onSelectionChangedAssign(e){for(let t=0;t<this.ExchList.length;t++)this.ExchListDataTable.addEmptyRow(),this.ExchListDataTable.Table[t].SelectedCurrencyType=this.ExchList[t].SelectedCurrencyType,this.ExchListDataTable.Table[t].Name=this.ExchList[t].SelectedItem.Name,this.ExchListDataTable.Table[t].Text=this.ExchList[t].ExchDate.Date,this.ExchListDataTable.Table[t].ExchDate=this.ExchList[t].ExchDate.Date.ToString(i.a.SessionManager.Preferences["Date Format"]),this.ExchListDataTable.Table[t].ExchRate=this.ExchList[t].ExchRate}OnCmnItem_Click(e){Logger.InfoLog("ViewExchangeRateViewModel::Entering OnCmnItem_Click with Command="+e),this.SelectedNote=null;let t=this.angularGrid.slickGrid.getSelectedRows();if(t.length>0){switch(this.SelectedNote=this.ExchListDataTable.Table[t[0]],e){case"EDIT":null!=this.SelectedNote&&(this.Parent.ExchangeVisibility=!0,this.Parent.Exch.SelectedCurrencyType=this.SelectedNote[this.ExchListDataTable.TableColumns[1]],s.e.isValidDate(this.SelectedNote[this.ExchListDataTable.TableColumns[3]])&&(this.Parent.Exch.ExchDate.Date=new Date(this.SelectedNote[this.ExchListDataTable.TableColumns[3]])),this.Parent.Exch.ExchRate=this.SelectedNote[this.ExchListDataTable.TableColumns[5]]);break;case"DELETE":null!=this.SelectedNote&&(this.ExchListDataTable.removeRow(this.SelectedNote),this.angularGrid.gridService.deleteItem(this.SelectedNote))}Logger.InfoLog("ViewExchangeRateViewModel::Exiting OnCmnItem_Click")}}onCanCmnItem_Click(e){return!0}GetXML(){Logger.InfoLog("ViewExchangeRateViewModel::Entering GetXML");let e="";for(let t=0;t<this.ExchList.length;t++)null!=this.ExchList[t].SelectedItem&&(e+='<Row Action="NEW"',e+=' CurrencyID="'+this.ExchList[t].SelectedCurrencyType+'"',e+=' Currency="'+d.d.GetValidXml(this.ExchList[t].SelectedItem.Name)+'"',e+=' ExchDate="'+new Date(d.d.GetValidXml(this.ExchList[t].ExchDate.Date.toString())).ToString("dd/MMM/yyyy")+'"',e+=' ExchRate="'+d.d.GetValidXml(this.ExchList[t].ExchRate)+'"',e+="/>");for(let t=0;t<this.DeletedNotes.length;t++)e+='<Row Action="DELETE"',e+=' CurrencyID="'+this.DeletedNotes[t].SelectedCurrencyType+'"/>';return e.length>0&&(e="<ExchXML>"+e+"</ExchXML>"),Logger.InfoLog("ViewExchangeRateViewModel::Exiting GetXML which returns XML="+e),e.Replace("&","&amp;"),e.toString()}OnShowNewExchange(e){Logger.InfoLog("ViewExhangeRateViewModel::Entering OnShowNewExchange");try{this.ButtonAdd.Enable&&this.ButtonAdd.Visible&&(this.Parent.Exch=new C(this.Parent),this.Parent.ExchangeVisibility=!0,this.Parent.OnShowExchangeRate()),Logger.InfoLog("ViewExhangeRateViewModel::Exiting OnShowNewExchange")}catch(t){Logger.ErrorLog("AddProductViewModel:: OnShowNewExchange"+t.stack)}}OnButtonClick(e){"Refresh"==e&&(this.ExchListDataTable.Table=this.Parent.DataTable.length>this.Parent.SelectedNode?this.ExchListDataTable.Table.filter(e=>e.SelectedCurrencyType==this.Parent.DataTable[this.Parent.SelectedNode].CurrencyID.toString()&&e.Text>=this.FromDate.Date&&e.Text<=this.Todate.Date):[])}Animate(){}LoadExchRates(e){Logger.InfoLog("ViewExchangeRateViewModel::Entering LoadExchRates with TableData="+e),this.ExchListDataTable.Clear(),this.ExchList.Clear();for(let a=0;a<e.length;a++){if("0"==s.e.StringValue(e[a].ED))continue;let n=new C(this.Parent);var t=this.Parent.Exch.CurrencyTypes.find(t=>t.Name==e[a].Name.toString());null!=t&&(n.SelectedItem=t),n.NoteID=a+1,n.SelectedCurrencyType=e[a].CurrencyID.toString(),n.ExchDate.Date=new Date(e[a].ExchangeDate.toString().split(" ")[0]),n.ExchDate.Text=new Date(e[a].ExchangeDate).ToString(i.a.SessionManager.Preferences["Date Format"]),n.ExchRate=e[a].ExchangeRate.toString(),this.ExchList.push(n);let r=this.ExchListDataTable.NewRow();r.Sno=a+1,r.SelectedCurrencyType=e[a].CurrencyID.toString(),r.Name=e[a].Name.toString(),r.Text=new Date(e[a].ExchangeDate),r.ExchDate=new Date(e[a].ExchangeDate).ToString(i.a.SessionManager.Preferences["Date Format"]),r.ExchRate=e[a].ExchangeRate.toString(),this.ExchListDataTable.addRow(r)}Logger.InfoLog("ViewExchangeRateViewModel::Exiting LoadExchRates")}OnDeleteCallBack(){null!=this.SelectedNote&&null!=this.SelectedNote[0]&&""!=this.SelectedNote[0].toString()&&parseInt(this.SelectedNote[0].toString())>0&&(this.id=parseInt(this.SelectedNote[0].toString()),this.DeletedNotes.push(this.ExchList[this.id-1])),this.ExchList.length>=this.id&&(this.ExchList.RemoveAt(this.id-1),this.ExchListDataTable.Table.RemoveAt(this.id-1))}}var T=a("VxiT");class y{constructor(e){this.iSeqno=0,this.iSeqno=e}}class S extends c.b{constructor(){super(),this.CustomTab=new u.a,this.TabIndex=new u.b,this.SelectedItem=new n.b,this.lstDeletedRecords=[],this.CurrencyTypes=[],this.Currency=[],this.CurrencyCombo=new o.e,this.Dim=new l.b(0),this._GUID="",this.DataTableObj=new D.a,this.ButtonAdd=new h.a,this.ButtonUpdate=new h.a,this.ButtonDelete=new h.a,this._NumericColumnSource=[],this.DynamicCommand=new n.b,this.SaveCurrency=new n.b,this.RowDelete=new n.b,this.cmnItem_Click=new n.b,this.ExTable=[],this.CurrLookup=null,this.Module="ACC",this.SNO=1,this.PACTControlData=[],this.ClassName="AddCurrencyViewModel",this.lblExchangeRate=i.a.GetResource("Currency_ExchangeRate"),this.lblDecimals=i.a.GetResource("Currency_Decimals"),this.lblIsBaseCurrency=i.a.GetResource("Currency_IsBaseCurrency"),this.lblTitle=i.a.GetResource("Currency_Title"),this.lblHeader=i.a.GetResource("Currency_GroupHeader"),Logger.InfoLog("AddCurrencyViewModel::Entering AddCurrencyViewModel"),this.DataTableObj.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.DataTableObj.BeginEdit.Subscribe(this,"onBeginEdit"),this.SelectedItem.Subscribe(this,"OnSelectedItem"),this.ViewExhangeRates=new m(this),this.Exch=new C(this),i.a.SessionManager.HideUnathorizedAccess?this.ButtonAdd.Visible=i.a.SessionManager.IsActionAssigned(12,"Create"):this.ButtonAdd.Enable=i.a.SessionManager.IsActionAssigned(12,"Create"),i.a.SessionManager.HideUnathorizedAccess?this.ButtonUpdate.Visible=i.a.SessionManager.IsActionAssigned(12,"Update"):this.ButtonUpdate.Enable=i.a.SessionManager.IsActionAssigned(12,"Update"),i.a.SessionManager.HideUnathorizedAccess?this.ButtonDelete.Visible=i.a.SessionManager.IsActionAssigned(12,"Delete"):this.ButtonDelete.Enable=i.a.SessionManager.IsActionAssigned(12,"Delete"),this._ScreenID="12",this.PactScreenID="12",this.worker_DoWork(null,null),this.worker_RunWorkerCompleted(null,null),this.BuildGridData(),this.BindCurrencies(1),this.MessageVisibility=!1,this.DisplayMessage="Currency",this._ScreenID="12",this.PactScreenID="12",this.DataTableObj.TableNewRow.Subscribe(this,"onAddRow"),this.DataTableObj.RowDeleted.Subscribe(this,"onDeleteRow"),this.cmnItem_Click.Subscribe(this,"OnCmnItem_Click"),this.SaveCurrency.Subscribe(this,"OnSaveCurrency, onCanSaveCurrency"),this.AddTabDetails(),this.CurrencyTypes=this.Exch.CurrencyTypes,this.Currency=this.ViewExhangeRates.Currency,this.ExchangeVisibility=!0,this.DataTable.length>0&&""!=this.DataTable[0].CurrencyID.toString()&&(this.SelectedNode=0,this.ViewExhangeRates.SelectedCurrencyText=this.DataTable[0].Name.toString(),this.ViewExhangeRates.ExchListDataTable.Table=this.ViewExhangeRates.ExchListDataTable.Table.filter(e=>e.SelectedCurrencyType==this.DataTable[0].CurrencyID.toString()&&e.Text>=this.ViewExhangeRates.FromDate.Date.ToString("dd MMM yyyy")&&e.Text<=this.ViewExhangeRates.Todate.Date.ToString("dd MMM yyyy")));let e=0;e=s.e.IntTryParse(i.a.SessionManager.Preferences.DimensionwiseCurrency),e>5e4?(this.Dim.Visible=!0,this.Dim.CCID=e,this.Dim.TypeID=1,this.Dim.OnPactListBoxValueChanged.Subscribe(this,"OnvalueChanged")):this.Dim.Visible=!1,this.CurrencyCombo.SelectionChangedCommand.Subscribe(this,"OnCurrencyComboChange"),Logger.InfoLog("AddCurrencyViewModel::Exiting AddCurrencyViewModel")}OnCmnItem_Click(e){Logger.InfoLog("AddCurrencyViewModel::Entering OnCmnItem_Click"),this.DataTable.length<1&&(this.DisplayMessage=i.a.GetResource("Cur_NO"),this.MessageVisibility=!0);let t=null,a=this.angularGrid.slickGrid.getSelectedRows();if(a.length>0){if(t=this.DataTable[a[0]],this.SelectedNode<this.DataTable.length)switch(e){case"DELETE":this.DataTableObj.removeRow(t),this.angularGrid.gridService.deleteItem(t)}Logger.InfoLog("AddCurrencyViewModel::Exiting OnCmnItem_Click")}}onCanCmnItem_Click(e){return!0}get SelectedNode(){return this._SelectedNode}set SelectedNode(e){e!=this._SelectedNode&&(this._SelectedNode=e,this.ViewExhangeRates.SelectedCurrencyText=this._SelectedNode>=0&&this.DataTable.length>this._SelectedNode?this.DataTable[this._SelectedNode].Name.toString():"")}get CurrencyName(){return this._CurrencyName}set CurrencyName(e){e!=this._CurrencyName&&(this.CurrencyCombo.SelectedValue=e,this._CurrencyName=e)}get angularGrid(){return this.DataTableObj.angularGrid}get DataTable(){return this.DataTableObj.Table}get DataTableColumns(){return this.DataTableObj.TableColumns}get NumericColumnSource(){return this._NumericColumnSource}get NumericdDt(){return this._NumericdDt}OnCurrencyComboChange(e){if(null!=this.CurrLookup)if(s.e.IsEmpty(e))this.Symbol="",this.Change="";else{let t=this.CurrLookup.filter(t=>t.Name==e.SelectedValue);t.length>0?(this.Symbol=t[0].Code.toString(),this.Change=t[0].Change.toString()):(this.Symbol="",this.Change="")}}OnvalueChanged(e){this.DisplayMessage="",this.MessageVisibility=!1,this.Dim.SelectedValue>0?this.BindCurrencies(this.Dim.SelectedValue):(this.DataTableObj.Clear(),this._CurrencyID=0,this.BaseCurr=0,this.CurrencyName="",this.Symbol="",this.Change="",this.ExTable.Rows.Clear())}AddCurrencyDetails(){this.ViewExhangeRates.Currency.Clear(),this.ViewExhangeRates.Currency.push(o.d.ComboBoxItems_2("All","-100")),this.Exch.CurrencyTypes.Clear();for(let e=0;e<this.DataTable.length;e++)null!=this.DataTable[e].IsDailyRates&&""!=this.DataTable[e].IsDailyRates.toString()&&"true"==this.DataTable[e].IsDailyRates.toString().toLowerCase()&&(this.Exch.CurrencyTypes.push(o.d.ComboBoxItems_2(this.DataTable[e].Name.toString(),this.DataTable[e].CurrencyID.toString())),this.ViewExhangeRates.Currency.push(o.d.ComboBoxItems_2(this.DataTable[e].Name.toString(),this.DataTable[e].CurrencyID.toString())))}OnSelectedItem(e){try{if("DataGridComboBoxColumn"==e.column.className)return;if(null!=e.item){let t=e.item;this.Exch.SelectedCurrencyType=t.CurrencyID.toString(),s.e.IsEmpty(t.CurrencyID)||(this.ViewExhangeRates.ExchListDataTable.Table=this.ViewExhangeRates.ExchListDataTable.Table.filter(e=>e.SelectedCurrencyType==parseInt(t.CurrencyID)&&e.Text>=this.ViewExhangeRates.FromDate.Date.ToString("dd MMM yyyy")&&e.Text<=this.ViewExhangeRates.Todate.Date.ToString("dd MMM yyyy")))}}catch(t){}}OnCellEditEnding(e){let t=e.item;if(null!=t&&"StatusID"==e.column.field)null!=t.IsDailyRates&&""!=t.IsDailyRates.toString()&&"true"==t.IsDailyRates.toString().toLowerCase()&&(0==this.Exch.CurrencyTypes.filter(e=>e.Name==t.Name.toString()).length&&(""!=t.CurrencyID.toString()?(this.Exch.CurrencyTypes=[],this.Exch.CurrencyTypes.push(o.d.ComboBoxItems_2(t.Name.toString(),t.CurrencyID.toString())),this.Exch.SelectedCurrencyType=t.CurrencyID.toString(),this.Exch.SelectedItem=this.Exch.CurrencyTypes.find(e=>e.Value==t.CurrencyID)):(t.CurrencyID=0==this.Exch.CurrencyTypes.length?-1:parseInt(2)-1,this.Exch.CurrencyTypes=[],this.Exch.CurrencyTypes.push(o.d.ComboBoxItems_2(t.Name.toString(),t.CurrencyID.toString())),this.Exch.SelectedCurrencyType=t.CurrencyID.toString(),this.Exch.SelectedItem=this.Exch.CurrencyTypes.find(e=>e.Value==t.CurrencyID))),0==this.ViewExhangeRates.Currency.filter(e=>e.Name==t.Name.toString()).length&&this.ViewExhangeRates.Currency.push(o.d.ComboBoxItems_2(t.Name.toString(),t.CurrencyID.toString())));else if(null!=t&&"Symbol"==e.column.field){let e=0;for(let a=0;a<this.DataTable.length;a++)s.e.IsEmpty(this.DataTable[a].Name)||this.DataTable[a].Name.toString().toLowerCase()==t.Name.toString().toLowerCase()&&e++;if(e>1&&(this.DisplayMessage="Duplicate Currency Name",t.Name=""),""!=t.Name.toString()){t.IsDailyRates="False",t.StatusID="True";let e=this.DataTable.Compute("max","CurrencyID");null!=e&&null!=e&&(t.CurrencyID=parseInt(e)+1)}else t.IsDailyRates="",t.StatusID="";if(this.CurrencyCombo.Visible)if(""!=s.e.String(t.Name)){let e=this.CurrLookup.filter(e=>e.Name==t.Name.toString());e.length>0?(t.Symbol=s.e.String(e[0].Code),t.Change=s.e.String(e[0].Change)):(t.Symbol="",t.Change="")}else t.Symbol="",t.Change="";this.DataTableObj.updateRow(t)}else if(null!=t&&"Change"==e.column.field){let e=0;for(let a=0;a<this.DataTable.length;a++)s.e.IsEmpty(this.DataTable[a].Symbol)||this.DataTable[a].Symbol.toString().toLowerCase()==t.Symbol.toString().toLowerCase()&&e++;e>1&&(this.DisplayMessage="Duplicate Currency Symbol",t.Symbol="")}else if(null!=t&&"Decimals"==e.column.field){let e=0;e=s.e.DoubleTryParse(t.ExchangeRate.toString()),e<=0&&(this.DisplayMessage="Invalid Exchange Rate")}else if(null!=t&&"IsDailyRates"==e.column.field){let e=0;e=s.e.DoubleTryParse(t.Decimals.toString()),e<=0&&(this.DisplayMessage="Invalid Decimals"),""!=t.CurrencyID.toString()&&(this.Exch.CurrencyTypes=[],this.Exch.CurrencyTypes.push(o.d.ComboBoxItems_2(t.Name.toString(),t.CurrencyID.toString())),this.Exch.SelectedCurrencyType=t.CurrencyID.toString(),this.Exch.SelectedItem=this.Exch.CurrencyTypes.find(e=>e.Value==t.CurrencyID))}}onBeginEdit(e){let t=this.DataTableObj.Table.indexOf(e.args.item);if(t=-1==t||1==this.DataTableObj.Table.length||0==this.DataTableObj.Table.length||this.DataTableObj.Table.length-t<=1?1:0,this.DataTableObj.CanUserAddRows)for(let a=0;a<t;a++){let e=this.DataTableObj.NewRow();this.DataTableObj.addRow(e)}}AddTabDetails(){let e;e=new u.b,e.Name="Exchange Rate",e.Header=i.a.GetResource("Currency_ExchangeRate"),this.CustomTab.Pages.push(e),this.CustomTab.SelectedTab=e,this.CustomTab.Pages[0].Fields.push(this.ViewExhangeRates),e=new u.b,e.Name="Denomination",e.Header=e.Header=i.a.GetResource("Denomination"),this.CustomTab.Pages.push(e);let t=new g.AddDenominationViewModel(this);this.CustomTab.Pages[1].Fields.push(t)}BuildGridData(){this._NumericColumnSource=[];let e=new r.a;e.Header=i.a.GetResource("UOM_Sno"),e.DisplayMember="SNO",e.DataType="TextBlock",e.ReadOnly=!0,e.Width=50,e.IsFrozen=!0,this.NumericColumnSource.push(e),e=new r.a,e.Header=i.a.GetResource("Currency_GridName"),e.DisplayMember="Name",null==this.CurrLookup?e.DataType="TextBlock":(e.ValueBinding="Name",e.DataType="ComboBox",e.DisplayMember="Name",e.ValueMember="Name",e.ComboData=this.CurrLookup),e.Width=200,this.NumericColumnSource.push(e),e=new r.a,e.Header=i.a.GetResource("Currency_GridSymbol"),e.DisplayMember="Symbol",e.DataType="TextBlock",e.ReadOnly=null!=this.CurrLookup,e.Width=80,e.IsFrozen=!0,this.NumericColumnSource.push(e),e=new r.a,e.Header=i.a.GetResource("Currency_GridChange"),e.DisplayMember="Change",e.DataType="TextBlock",e.ReadOnly=null!=this.CurrLookup,e.Width=150,e.IsFrozen=!0,this.NumericColumnSource.push(e),e=new r.a,e.Header=i.a.GetResource("Currency_GridExchangeRate"),e.DisplayMember="ExchangeRate",e.DataType="FLOAT",e.Width=100,e.IsFrozen=!0,this.NumericColumnSource.push(e),e=new r.a,e.Header=i.a.GetResource("Currency_GridDecimals"),e.DisplayMember="Decimals",e.DataType="TextBlock",e.Width=100,e.IsFrozen=!0,this.NumericColumnSource.push(e),e=new r.a,e.Header=i.a.GetResource("Reports_LblDaily"),e.ValueBinding="IsDailyRates",e.DataType="ComboBox",e.DisplayMember="Name",e.ValueMember="Value",e.Width=100;let t=[];t.push(o.d.ComboBoxItems_2(i.a.GetResource("Vehicle_Yes"),"True")),t.push(o.d.ComboBoxItems_2(i.a.GetResource("Vehicle_No"),"False")),e.ComboData=t,this.NumericColumnSource.push(e),e=new r.a,e.Header=i.a.GetResource("Document_Status"),e.ValueBinding="StatusID",e.DataType="ComboBox",e.DisplayMember="Name",e.ValueMember="Value",e.Width=100;let a=[];a.push(o.d.ComboBoxItems_2(i.a.GetResource("RevenUReport_Active"),"True")),a.push(o.d.ComboBoxItems_2(i.a.GetResource("Attributes_Inactive"),"False")),e.ComboData=a,this.NumericColumnSource.push(e),e=new r.a,e.Header="IsDivide",e.ValueBinding="IsDivide",e.DataType="ComboBox",e.DisplayMember="Name",e.ValueMember="Value",e.Width=100,a=[],a.push(o.d.ComboBoxItems_2("Yes","True")),a.push(o.d.ComboBoxItems_2("No","False")),e.ComboData=a,e.IsVisible=!(!i.a.SessionManager.Preferences.ContainsKey("DivideCurrency")||"true"!=i.a.SessionManager.Preferences.DivideCurrency.toLowerCase()),this.NumericColumnSource.push(e),this.DataTableObj.Table=[],this.DataTableObj.CanUserAddRows=!0,this.DataTableColumns.push("CurrencyID"),this.DataTableColumns.push("SNO"),this.DataTableColumns.push("Name"),this.DataTableColumns.push("Symbol"),this.DataTableColumns.push("Change"),this.DataTableColumns.push("ExchangeRate"),this.DataTableObj.DataTypes.Double.push("ExchangeRate"),this.DataTableColumns.push("Decimals"),this.DataTableColumns.push("IsDailyRates"),this.DataTableColumns.push("StatusID"),this.DataTableColumns.push("GUID"),this.DataTableColumns.push("IsDivide"),this.DataTableObj.Columns=this.NumericColumnSource,this.DataTableObj.ContextMenuClickSubject.subscribe(e=>{this.OnCmnItem_Click(e.item.Tag)}),this.DataTableObj.ContextMenu.Items=[];let s=new r.b;s.Header="DELETE",s.Tag="DELETE",s.Visibility=!0,this.DataTableObj.ContextMenu.Items.push(s)}onAddRow(e,t){this.UpdateSequence(),t.Row.SNO=this.SNO}onDeleteRow(e,t){this.UpdateSequence()}UpdateSequence(){this.SNO=1,this.DataTableObj.Table.forEach(e=>{e.SNO=this.SNO++})}GetCurrencyXMl(){let e="";if(null!=this.DataTable&&this.DataTable.length>0){e+="<XML>";for(let t=0;t<this.DataTable.length;t++)s.e.IsEmpty(this.DataTable[t].Name)||s.e.IsEmpty(this.DataTable[t].ExchangeRate)||(s.e.IsEmpty(this.DataTable[t][this.DataTableColumns[0]])?e+="<Row CurrencyID='0' Name='"+this.DataTable[t][this.DataTableColumns[2]].toString()+"' Symbol='"+this.DataTable[t][this.DataTableColumns[3]].toString()+"' Change='"+this.DataTable[t][this.DataTableColumns[4]].toString()+"' ExchangeRate='"+this.DataTable[t][this.DataTableColumns[5]].toString()+"' Decimals='"+this.DataTable[t][this.DataTableColumns[6]].toString()+"' Daily='"+this.DataTable[t][this.DataTableColumns[7]].toString()+"'  StatusID='"+this.DataTable[t][this.DataTableColumns[8]].toString()+"' IsDivide='"+this.DataTable[t].IsDivide.toString()+"' GUID='"+this.DataTable[t].GUID.toString()+"' Action='Insert'/>":parseInt(this.DataTable[t][this.DataTableColumns[0]])>0?parseInt(this.DataTable[t][this.DataTableColumns[0]])==this.BaseCurr?(e+="<Row CurrencyID='"+this.DataTable[t][this.DataTableColumns[0]].toString()+"' Name='"+this.DataTable[t][this.DataTableColumns[2]].toString()+"' Symbol='"+this.DataTable[t][this.DataTableColumns[3]].toString()+"' Change='"+this.DataTable[t][this.DataTableColumns[4]].toString()+"' ExchangeRate='"+this.DataTable[t][this.DataTableColumns[5]].toString()+"' Decimals='"+this.DataTable[t][this.DataTableColumns[6]].toString()+"' Daily='"+this.DataTable[t][this.DataTableColumns[7]].toString()+"'  StatusID='"+this.DataTable[t][this.DataTableColumns[8]].toString()+"' IsDivide='"+this.DataTable[t].IsDivide.toString()+"'  GUID='"+this.DataTable[t].GUID.toString()+"'   Action='Update'/>",e+="<Row CurrencyID='"+this._CurrencyID+"' Name='"+this.CurrencyName+"' Symbol='"+Symbol+"' Change='"+this.Change+"' ExchangeRate='1'   Action='Update'/>"):e+="<Row CurrencyID='"+this.DataTable[t][this.DataTableColumns[0]].toString()+"' Name='"+this.DataTable[t][this.DataTableColumns[2]].toString()+"' Symbol='"+this.DataTable[t][this.DataTableColumns[3]].toString()+"' Change='"+this.DataTable[t][this.DataTableColumns[4]].toString()+"' ExchangeRate='"+this.DataTable[t][this.DataTableColumns[5]].toString()+"' Decimals='"+this.DataTable[t][this.DataTableColumns[6]].toString()+"' Daily='"+this.DataTable[t][this.DataTableColumns[7]].toString()+"'  StatusID='"+this.DataTable[t][this.DataTableColumns[8]].toString()+"'  IsDivide='"+this.DataTable[t].IsDivide.toString()+"' GUID='"+this.DataTable[t].GUID.toString()+"'   Action='Update'/>":parseInt(this.DataTable[t][0])<=0&&(e+="<Row CurrencyID='0' Name='"+this.DataTable[t][this.DataTableColumns[2]].toString()+"' Symbol='"+this.DataTable[t][this.DataTableColumns[3]].toString()+"' Change='"+this.DataTable[t][this.DataTableColumns[4]].toString()+"' ExchangeRate='"+this.DataTable[t][this.DataTableColumns[5]].toString()+"' Decimals='"+this.DataTable[t][this.DataTableColumns[6]].toString()+"' Daily='"+this.DataTable[t][this.DataTableColumns[7]].toString()+"'  StatusID='"+this.DataTable[t][this.DataTableColumns[8]].toString()+"' IsDivide='"+this.DataTable[t].IsDivide.toString()+"' GUID='"+this.DataTable[t].GUID.toString()+"' Action='Insert'/>"));this.BaseCurr==this._CurrencyID&&(e+="<Row CurrencyID='"+this._CurrencyID+"' Name='"+this.CurrencyName+"' Symbol='"+this.Symbol+"' Change='"+this.Change+"' ExchangeRate='1'  GUID='"+this._GUID+"'   Action='Update'/>")}else e+="<XML>";for(let t=0;t<this.lstDeletedRecords.length;t++)e+='<Row Action="Delete"',e+=' CurrencyID="'+this.lstDeletedRecords[t].iSeqno+'"/>';return e+="</XML>",e=e.Replace("&","&amp;"),e.toString()}BindCurrencies(e){let t=[];t.push(0),t.push(e),t.push(i.a.SessionManager.UserID),t.push(i.a.SessionManager.LanguageID);let a=i.a.admin.GetCurrencies(t);if(null!=a&&a.Tables.length>0&&a.Tables[0].length>0&&(this._CurrencyID=parseInt(a.Tables[0][0].CurrencyID),this.BaseCurr=this._CurrencyID,this.CurrencyName=a.Tables[0][0].Name.toString(),this.Symbol=s.e.String(a.Tables[0][0].Symbol),this.Change=s.e.String(a.Tables[0][0].Change),this._GUID=s.e.String(a.Tables[0][0].GUID)),null!=a&&a.Tables.length>1&&(this.DataTableObj.Table=a.Tables[1]),a.Tables.length>2&&(this.ExTable=a.Tables[2]),a.Tables.length>3&&!a.Columns[3].Contains("NoDimCurrency")&&a.Tables[3].length>0){if(this.Dim.Label=a.Tables[3][0].Name.toString(),this.Dim.SelectedValue=e,""!=a.Tables[3][0].CurrencyID.toString()&&parseInt(a.Tables[3][0].CurrencyID.toString())!=this.BaseCurr){let e=this.DataTable.filter(e=>e.CurrencyID==a.Tables[3][0].CurrencyID.toString());e.length>0&&(this._CurrencyID=parseInt(e[0].CurrencyID.toString()),this.CurrencyName=e[0].Name.toString(),Symbol=e[0].Symbol.toString(),this.Change=e[0].Change.toString(),e[0].CurrencyID=this.BaseCurr,e[0].Change=a.Tables[0][0].Change.toString(),e[0].Name=a.Tables[0][0].Name.toString(),e[0].Symbol=a.Tables[0][0].Symbol.toString())}for(let e=0;e<this.DataTable.length;e++){let t=a.Tables[2].filter(t=>0==t.D&&t.CurrencyID==this.DataTable[e].CurrencyID.toString());this.DataTable[e].ExchangeRate=t.length>0?t[0].ExchangeRate.toString():0}}this.AddCurrencyDetails(),this.ViewExhangeRates.LoadExchRates(this.ExTable),this.DataTableObj.addEmptyRow(),this.DataTable[a.Tables[1].length-1].SNO=a.Tables[1].length}Validate(){if(this.Dim.Visible&&0==this.Dim.SelectedValue)return this.DisplayMessage=" select "+this.Dim.Label,this.MessageVisibility=!0,!1;if(null==this.CurrencyName.Trim()||""==this.CurrencyName.Trim())return this.DisplayMessage=" Please Enter Base Currency",this.MessageVisibility=!0,!1;if(null==this.Symbol.Trim()||""==this.Symbol.Trim())return this.DisplayMessage=" Please Enter Base Symbol",this.MessageVisibility=!0,!1;if(null==this.Change.Trim()||""==this.Change.Trim())return this.DisplayMessage=" Please Enter Base Currency Change",this.MessageVisibility=!0,!1;for(let e=0;e<this.DataTable.length;e++)if(!s.e.IsEmpty(this.DataTable[e].Name)||!s.e.IsEmpty(this.DataTable[e].Symbol)||!s.e.IsEmpty(this.DataTable[e].ExchangeRate)){if(s.e.IsEmpty(this.DataTable[e].Name))return this.DisplayMessage=i.a.GetResource("Curr_Name")+(e+1).toString(),this.MessageVisibility=!0,!1;if(s.e.IsEmpty(this.DataTable[e].Symbol))return this.DisplayMessage=i.a.GetResource("Curr_Symbol")+(e+1).toString(),this.MessageVisibility=!0,!1;if(s.e.IsEmpty(this.DataTable[e].Change))return this.DisplayMessage=i.a.GetResource("Curr_Change")+(e+1).toString(),this.MessageVisibility=!0,!1;if(s.e.IsEmpty(this.DataTable[e].ExchangeRate)||parseFloat(this.DataTable[e].ExchangeRate)<=0)return this.DisplayMessage=i.a.GetResource("Curr_Exch")+(e+1).toString(),this.MessageVisibility=!0,!1;if(s.e.IsEmpty(this.DataTable[e].Decimals)||parseFloat(this.DataTable[e].Decimals)<=0)return this.DisplayMessage=i.a.GetResource("Curr_Decimals")+(e+1).toString(),this.MessageVisibility=!0,!1}return!0}OnSaveCurrency(e){this.MessageVisibility=!1,Logger.InfoLog("AddCurrencyViewModel::Entering OnSaveCurrency");try{if(this.Validate()){let e,t=[];if(this.BaseCurr!=this._CurrencyID){t.push(this.BaseCurr);let e=this.DataTable.filter(e=>e.CurrencyID==this.BaseCurr.toString());if(!(e.length>0))return this.DisplayMessage="Base currency deleted.please refresh data",void(this.MessageVisibility=!0);t.push(e[0].Name.toString()),t.push(e[0].Symbol.toString()),t.push(e[0].Change.toString())}else t.push(this._CurrencyID),t.push(this.CurrencyName),t.push(this.Symbol),t.push(this.Change);t.push(this.GetCurrencyXMl()),t.push(this.ViewExhangeRates.GetXML()),t.push(this.Dim.Visible?this.Dim.SelectedValue:1),t.push(i.a.SessionManager.CompanyGUID),t.push(this._GUID),t.push(i.a.SessionManager.UserName),t.push(i.a.SessionManager.RoleID),t.push(i.a.SessionManager.LanguageID);let a=i.a.admin.SetCurrencies(t);this.MessageVisibility=!0,e=a.Message;let s=a.ret;this.DisplayMessage=e,s>0&&this.BindCurrencies(this.Dim.Visible?this.Dim.SelectedValue:1),Logger.InfoLog("AddCurrencyViewModel::Entering OnSaveCurrency")}}catch(t){Logger.ErrorLog("AddCurrencyViewModel:: OnSaveCurrency"+t.stack)}}onCanSaveCurrency(e){return!0}UpdateUIIndicators(e){this.PACTControlData=e,this.DisplayName="Currency"}CallBackBuildControls(e){}worker_DoWork(e,t){Logger.InfoLog("AddCurrencyViewModel::Entering worker_DoWork"),this._ScreenData=this.BuildControls(),Logger.InfoLog("AddCurrencyViewModel::BuildControls Success"),this.CurrencyNameEnabled=!0,this.SymbolEnabled=!0,this.ChangeEnabled=!0,this.ApplyResources(this._ScreenData.Tables[0]),this.CurrencyCombo.Visible=!1;for(let a=0;a<this._ScreenData.Tables.length;a++)if(this._ScreenData.Columns[a].Contains("CurrLookupID")){this.CurrLookup=this._ScreenData.Tables[a],this.CurrencyCombo.Visible=!0,this.CurrencyCombo.Label=i.a.GetResource("Currency_BaseCurrency"),this.CurrLookup.forEach(e=>{this.CurrencyCombo.Items.push(o.d.ComboBoxItems_2(e.Name,e.Name))});break}}worker_RunWorkerCompleted(e,t){this.DisplayName=i.a.GetResource("Currency_ScreenName")}BuildControls(){Logger.InfoLog("AddCurrencyViewModel::Entering BuildControls");try{return(new T.a).GetControls(this._ScreenID,i.a.SessionManager.CompanyIndex)}catch(e){return Logger.ErrorLog("AddCurrencyViewModel:: BuildControls"+e.stack),null}}ApplyFieldSecurity(e){Logger.InfoLog("AddCurrencyViewModel::Entering ApplyFieldSecurity");let t=e;t=t.filter(e=>172==e.ColID),this.CurrencyNameEnabled=t.length>0,t=t.filter(e=>173==e.ColID),this.SymbolEnabled=t.length>0,t=t.filer(e=>174==e.ColID),this.ChangeEnabled=t.length>0,Logger.InfoLog("AddCurrencyViewModel::Exiting ApplyFieldSecurity")}ApplyResources(e){Logger.InfoLog("AddCurrencyViewModel::Entering ApplyResources");let t=e;t=t.filter(e=>172==e.CostCenterColID),this.lblCurrencyName=t.length>0?t[0].ResourceData.toString():"",t=t.filter(e=>173==e.CostCenterColID),this.lblSymbol=t.length>0?t[0].ResourceData.toString():"",t.RowFilter="CostCenterColID=174",this.lblChange=t.length>0?t[0].ResourceData.toString():"",Logger.InfoLog("AddCurrencyViewModel::Exiting ApplyResources")}OnShowExchangeRate(){this.AddCurrencyDetails()}OnAddExchangeRate(){this.Exch=new C(this),this.AddCurrencyDetails()}OnDeleteCallBack(){let e=0;for(let t=0;t<this.DataTable.length;t++)if(e=parseInt(this.DataTable[t].SNO),this.SelectedNode==e-1&&!s.e.IsEmpty(this.DataTable[t][0])){this.lstDeletedRecords.push(new y(parseInt(this.DataTable[t][0])));break}this.SelectedNode<this.DataTable.length&&this.DataTableObj.Table.RemoveAt(this.SelectedNode),this.UpdateSequence()}}}}]);
function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var s=t[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var o,s=_getPrototypeOf(e);if(t){var l=_getPrototypeOf(this).constructor;o=Reflect.construct(s,arguments,l)}else o=s.apply(this,arguments);return _possibleConstructorReturn(this,o)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[82],{"Pi/L":function(e,t,o){"use strict";o.r(t),o.d(t,"INV_Ageing",(function(){return D}));var s=o("Do2H"),l=o("Lp6j"),i=o("vTM8"),a=o("eQJW"),n=o("1xwR"),r=o("mvPR"),h=o("dH+5"),d=o("Zgxw"),u=o("MCLT"),c=o("8iaB"),D=function(e){_inherits(o,e);var t=_createSuper(o);function o(e){var s;return _classCallCheck(this,o),(s=t.call(this,e)).k=0,s.drMain=null,s.colSlabIndex=-1,s.colSpanBF=-1,s.colSubTotalStartIndex=0,s.colQOHIndex=-1,s.colMonthIndex=-1,s.CntMonths=0,s.Slabs=new Array,s.iSlabs=new Array,s.dblQty=0,s.dblValue=0,s.dblAvgRate=0,s.ShowLevelTree=!1,s.IsConsolidated=!1,s.BatchConsolidated=!1,s.ShowYearWise=!1,s.ShowMonthWise=!1,s.LevelNo=0,s.DefValuation=0,s.ForeignCurrencyID=0,s.CurrencyType=0,s.strProductID=null,s.AgeingDimWhere="",s.SortTransactionsBy="",s.SlabQty=null,s.SlabValue=null,s.SlabPercent=null,s.MonthFromDate=null,s.FilterData="",s.HideBinQty=!1,s.IsBinDetail=!1,s.iLoop=0,s.lstPCRates=new Array,s.TagID=0,s.IsPCodeLink=!1,s.IsPNameLink=!1,s.ShowDetailReport=!1,s.TempRTVisible=!1,s.strExcludeStockTransfer="",s.lstTotal=null,s.lstParents=new Array,s.dbl=0,s.dblS0=0,s.dblS1=0,s.dblS2=0,s.dblS3=0,s.dblS4=0,s.dblIssue=0,s.dtProducts=null,s}return _createClass(o,[{key:"LoadReport",value:function(){var e=this;if(this.GrdRow=-1,this.colSubTotalStartIndex=-1,this.AggTotal=l.e.NumArray(this.oColumns.length,2),this.lstTotal=new Array,this.ViewModel.Preferences.ContainsKey("Slabs")){var t=new l.f;t.LoadXml("<XML>"+this.ViewModel.Preferences.Slabs+"</XML>"),this.Slabs.Clear(),this.iSlabs.Clear(),t.DocumentElement.childNodes.forEach((function(t){e.iSlabs.push(parseInt(t.innerHTML)),e.Slabs.push(e.ViewModel.oReportDialog.ToDate.Date.AddDays(e.iSlabs[e.iSlabs.length-1]))}))}for(var o=0;o<this.ViewModel.ColumnSource.length;o++)if("FLOAT"==this.ViewModel.ColumnSource[o].ColumnType){this.colSpanBF=o;break}if(this.ViewModel.lstGroup.length>0)for(this.k=0;this.k<this.ViewModel.ColumnSource.length;this.k++)if(this.ViewModel.lstGroup[0].TotalCols.ContainsKey(this.ViewModel.ColumnSource[this.k].ID)){this.colSubTotalStartIndex=this.k;break}for(var a=this.ViewModel.ColumnSource.length-1;a>=0;a--)"Expired"==this.ViewModel.ColumnSource[a].ID||"Balance"==this.ViewModel.ColumnSource[a].ID?this.colSlabIndex=a:"QOH"==this.ViewModel.ColumnSource[a].ID&&(this.colQOHIndex=a);this.FilterData=this.ViewModel.Preferences.ContainsKey("Filter")?this.ViewModel.Preferences.Filter:"";for(var n=new Array,r=0;r<this.ViewModel.ColumnSource.length;r++)n.push(this.ViewModel.ColumnSource[r]);if(82==this.ViewModel.StaticReportType){if(this.ViewModel.Preferences.ContainsKey("MonthWiseMonths")){var d=new l.f;d.LoadXml("<XML>"+this.ViewModel.Preferences.MonthWiseMonths+"</XML>");var u=l.f.SelectSingleNode(d.DocumentElement,"IsChecked");if(null!=u&&"1"==u.innerHTML&&(this.ShowMonthWise=!0,u=l.f.SelectSingleNode(d.DocumentElement,"Text"),this.CntMonths=l.e.Int(u.innerHTML),this.CntMonths<=0&&(this.ShowMonthWise=!1),this.ShowMonthWise)){this.iSlabs.Clear(),this.Slabs.Clear();for(var c=this.ViewModel.oReportDialog.ToDate.Date,D=0;D<this.CntMonths;D++)this.iSlabs.push(1),c=new Date(c.getFullYear(),c.getMonth(),1).AddMonths(1).AddDays(-1),this.Slabs.push(c),c=c.AddDays(1)}}}else if(83==this.ViewModel.StaticReportType)this.SlabPercent=n.find((function(e){return"SlabPercent"==e.ID})),this.SlabPercent&&n.Remove(this.SlabPercent);else if(84==this.ViewModel.StaticReportType){if(this.ViewModel.Preferences.ContainsKey("ShowYearWise")){var I=new l.f;I.LoadXml("<XML>"+this.ViewModel.Preferences.ShowYearWise+"</XML>");var p=l.f.SelectSingleNode(I.DocumentElement,"IsChecked");if(null!=p&&"1"==p.innerHTML&&(this.ShowYearWise=!0,p=l.f.SelectSingleNode(I.DocumentElement,"Text"),this.CntMonths=l.e.Int(p.innerHTML),this.CntMonths<=0&&(this.ShowYearWise=!1),this.ShowYearWise)){this.iSlabs.Clear(),this.Slabs.Clear();var C=new Date((new Date).getFullYear(),s.a.SessionManager.AccountingFromMonth-1,1);C>Date.Today()&&(C=C.AddYears(-1));for(var M=0;M<this.CntMonths;M++)this.iSlabs.push(1),this.Slabs.push(C),C=C.AddYears(-1)}}for(var T=n.length-1;T>=0;T--)"SlabQty"==n[T].ID?(this.SlabQty=n[T],n.RemoveAt(T),this.ViewModel.GrpReportTotal.TotalCols.ContainsKey("SlabQty")&&this.ViewModel.GrpReportTotal.TotalCols.Remove("SlabQty"),this.ViewModel.lstGroup.length>0&&this.ViewModel.lstGroup[0].TotalCols.ContainsKey("SlabQty")&&this.ViewModel.lstGroup[0].TotalCols.Remove("SlabQty")):"SlabValue"==n[T].ID&&(this.SlabValue=n[T],n.RemoveAt(T),this.ViewModel.GrpReportTotal.TotalCols.ContainsKey("SlabValue")&&this.ViewModel.GrpReportTotal.TotalCols.Remove("SlabValue"),this.ViewModel.lstGroup.length>0&&this.ViewModel.lstGroup[0].TotalCols.ContainsKey("SlabValue")&&this.ViewModel.lstGroup[0].TotalCols.Remove("SlabValue"))}if(null==this.SlabQty&&null==this.SlabValue){for(var S=this.ViewModel.ColumnSource.length-1;S>=0;S--){if("BalQty"==this.ViewModel.ColumnSource[S].ID){this.SlabQty=this.ViewModel.ColumnSource[S];break}if(83==this.ViewModel.StaticReportType&&"Quantity"==this.ViewModel.ColumnSource[S].ID){this.SlabQty=this.ViewModel.ColumnSource[S];break}if("Months"==this.ViewModel.ColumnSource[S].ID){this.colMonthIndex=S;break}}null==this.SlabQty&&(this.SlabQty=this.ViewModel.ColumnSource[this.ViewModel.ColumnSource.length-1])}if(82==this.ViewModel.StaticReportType)for(var w=function(t){e.ViewModel.GrpReportTotal.TotalCols.Remove("S"+t),e.ViewModel.lstGroup.forEach((function(e){e.TotalCols.ContainsKey("S"+t)&&e.TotalCols.Remove("S"+t)}))},V=0;V<30&&this.ViewModel.GrpReportTotal.TotalCols.ContainsKey("S"+V);V++)w(V);if(this.Slabs.length>0)for(var f=function(t,o){var s,l;if(84==e.ViewModel.StaticReportType)null!=e.SlabQty&&(l=e.SlabQty.Clone(),e.ShowYearWise?(l.ID="S"+t,l.HeaderText=t==e.Slabs.length?"< "+e.Slabs[t-1].ToString("MMM yyyy"):1==e.Slabs[t].iMonth()?e.Slabs[t].ToString("yyyy"):e.Slabs[t].ToString("yyyy")+"-"+e.Slabs[t].AddYears(1).ToString("yy")):(l.ID="S"+o,l.HeaderText=0==o?"1-"+e.iSlabs[o]:o==e.Slabs.length?">"+e.iSlabs[e.iSlabs.length-1]:e.iSlabs[o-1]+1+"-"+e.iSlabs[o]),e.ShowYearWise||(o<e.iSlabs.length&&0==e.iSlabs[o]||o==e.iSlabs.length&&0==e.iSlabs[e.iSlabs.length-1])&&(l.HeaderAppearance.IsVisible=!1),n.push(l),e.ViewModel.IsTotalColsAdded||(e.ViewModel.lstGroup.forEach((function(e){e.TotalCols.push(l.ID,n.length-1)})),e.ViewModel.GrpReportTotal.TotalCols.push(l.ID,n.length-1))),null!=e.SlabValue&&(s=e.SlabValue.Clone(),null==e.SlabQty?e.ShowYearWise?(s.ID="SV"+t,s.HeaderText=t==e.Slabs.length?"< "+e.Slabs[t-1].ToString("MMM yyyy"):1==e.Slabs[t].iMonth()?e.Slabs[t].ToString("yyyy"):e.Slabs[t].ToString("yyyy")+"-"+e.Slabs[t].AddYears(1).ToString("yy")):(s.ID="SV"+o,s.HeaderText=0==o?"1-"+e.iSlabs[o]+" Value":o==e.Slabs.length?">"+e.iSlabs[e.iSlabs.length-1]+" Value":e.iSlabs[o-1]+1+"-"+e.iSlabs[o]+" Value"):(s.ID=e.ShowYearWise?"SV"+t:"SV"+o,s.HeaderText="Value"),e.ShowYearWise||(o<e.iSlabs.length&&0==e.iSlabs[o]||o==e.iSlabs.length&&0==e.iSlabs[e.iSlabs.length-1])&&(s.HeaderAppearance.IsVisible=!1),n.push(s),e.ViewModel.IsTotalColsAdded||(e.ViewModel.lstGroup.forEach((function(e){e.TotalCols.push(s.ID,n.length-1)})),e.ViewModel.GrpReportTotal.TotalCols.push(s.ID,n.length-1)));else if(82==e.ViewModel.StaticReportType){var i=e.ViewModel.ColumnSource.find((function(e){return"Quantity"==e.ID}));i||(i=e.ViewModel.ColumnSource.find((function(e){return"Expired"==e.ID}))),i||(i=e.ViewModel.ColumnSource[e.ViewModel.ColumnSource.length-1]),(i=i.Clone()).DataAppearance.IsVisible=!0,i.ID="S"+o,i.HeaderText=e.ShowMonthWise?o==e.Slabs.length?">"+e.Slabs[o-1].ToString("MMM yyyy"):e.Slabs[o].ToString("MMM yyyy"):0==o?"1-"+e.iSlabs[o]:o==e.Slabs.length?">"+e.iSlabs[e.iSlabs.length-1]:e.iSlabs[o-1]+1+"-"+e.iSlabs[o],("Expired"==e.FilterData||o<e.iSlabs.length&&0==e.iSlabs[o]||o==e.iSlabs.length&&(0==e.iSlabs[e.iSlabs.length-1]||"SelectedSlabActive"==e.FilterData))&&(i.HeaderAppearance.IsVisible=!1),n.Insert(e.colSlabIndex+o+1,i),e.ViewModel.GrpReportTotal.TotalCols.push(i.ID,e.colSlabIndex+o+1),e.ViewModel.GrpReportTotal.TotalCols.Slab=n.length-1,e.ViewModel.lstGroup.forEach((function(t){t.TotalCols.push(i.ID,e.colSlabIndex+o+1),t.TotalCols.Slab=n.length-1}))}else{var a=null!=e.SlabQty?e.SlabQty.Clone():e.ViewModel.ColumnSource[e.ViewModel.ColumnSource.length-1].Clone();a.ID="S"+o,a.HeaderText=0==o?"1-"+e.iSlabs[o]:o==e.Slabs.length?">"+e.iSlabs[e.iSlabs.length-1]:e.iSlabs[o-1]+1+"-"+e.iSlabs[o],(o<e.iSlabs.length&&0==e.iSlabs[o]||o==e.iSlabs.length&&0==e.iSlabs[e.iSlabs.length-1])&&(a.HeaderAppearance.IsVisible=!1);var r=e.colSlabIndex+o+1;if(null!=e.SlabPercent&&(r=e.colSlabIndex+2*o+1),n.Insert(r,a),e.ViewModel.IsTotalColsAdded||(e.ViewModel.GrpReportTotal.TotalCols.push(a.ID,r),e.ViewModel.GrpReportTotal.TotalCols.Slab=n.length-1,e.ViewModel.lstGroup.forEach((function(e){e.TotalCols.push(a.ID,r),e.TotalCols.Slab=n.length-1}))),null!=e.SlabPercent){var h=e.SlabPercent.Clone();h.ID="P"+o,h.HeaderText="%",h.HeaderAppearance.IsVisible=a.HeaderAppearance.IsVisible,r++,n.Insert(r,h)}}},R=0,y=this.Slabs.length;R<=this.Slabs.length;R++,y--)f(y,R);if(82==this.ViewModel.StaticReportType&&this.ViewModel.GrpReportTotal.TotalCols.ContainsKey("Slab")&&(this.ViewModel.GrpReportTotal.TotalCols.Remove("Slab"),this.ViewModel.lstGroup.forEach((function(e){e.TotalCols.Remove("Slab")}))),(114==this.ViewModel.StaticReportType||115==this.ViewModel.StaticReportType)&&(this.CntMonths=0,-1!=this.colMonthIndex)){this.ViewModel.TotalCols.Clear(),this.ViewModel.GrpReportTotal.TotalCols.Clear(),114!=this.ViewModel.StaticReportType&&115!=this.ViewModel.StaticReportType||(this.ViewModel.AddTotalColumnsToGroup(this.ViewModel.GrpReportTotal,this.ViewModel.ReportDoc.SelectSingleNode("PactRevenURpts/PactRevenURptDef/ReportTotal/Columns")),this.ViewModel.TotalCols.Contains("Months")&&this.ViewModel.TotalCols.Remove("Months"),this.ViewModel.GrpReportTotal.TotalCols.ContainsKey("Months")&&this.ViewModel.GrpReportTotal.TotalCols.Remove("Months"),this.ViewModel.lstGroup.forEach((function(t){t.TotalCols.Clear(),e.ViewModel.AddTotalColumnsToGroup(t,e.ViewModel.ReportDoc.SelectSingleNode("PactRevenURpts/PactRevenURptDef/ReportTotal/Columns")),t.TotalCols.ContainsKey("Months")&&t.TotalCols.Remove("Months")})));var g=new Date(this.ViewModel.FromDatePicker.Date.getFullYear(),this.ViewModel.FromDatePicker.Date.getMonth(),1);if(this.MonthFromDate=g,114==this.ViewModel.StaticReportType){var v=0;if(this.ViewModel.Preferences.ContainsKey("ShowMonths")&&((v=l.e.Int(this.ViewModel.Preferences.ShowMonths))>0&&(g=(g=new Date(this.ViewModel.ToDatePicker.Date.getFullYear(),this.ViewModel.ToDatePicker.Date.getMonth(),1)).AddMonths(1-v),g=new Date(g.getFullYear(),g.getMonth(),1),this.MonthFromDate=g)),0==v&&this.ViewModel.DontApplyDateFilter&&this.ViewModel.Preferences.ContainsKey("SalesDocs")&&this.ViewModel.Preferences.SalesDocs.length>0){var P="SELECT convert(datetime,min(DocDate)) FromDate FROM INV_DocDetails A WITH(NOLOCK) \n        WHERE A.CostCenterID IN("+this.ViewModel.Preferences.SalesDocs+") AND DocDate<=CONVERT(INT,CONVERT(DATETIME,'"+this.ViewModel.ToDatePicker.Date.ToString("dd MMM yyyy")+"')) AND A.StatusID<>438",b=s.a.report.ReportDataTable("RPT022",this.ViewModel.IsReportDB,P);null!=b&&b.length>0&&b.Columns.Contains("FromDate")&&(this.MonthFromDate=new Date(b.Rows[0].FromDate),this.MonthFromDate=new Date(this.MonthFromDate.getFullYear(),this.MonthFromDate.getMonth(),1),this.ViewModel.ToDatePicker.Date.getFullYear()-this.MonthFromDate.getFullYear()>15?this.MonthFromDate=g:g=this.MonthFromDate)}}else 115==this.ViewModel.StaticReportType&&(this.ViewModel.ColumnSource[this.colMonthIndex].HeaderAppearance.IsVisible=!1);var N=this.ViewModel.ToDatePicker.Date;if("DESC"==this.ViewModel.ColumnSource[this.colMonthIndex].DataFormat.Sort)for(var m=function(){var t=e.ViewModel.ColumnSource[e.colMonthIndex].Clone();t.HeaderAppearance.IsVisible=!0,t.ID="M"+e.CntMonths,t.HeaderText=g.ToString("MMM yyyy"),n.Insert(e.colMonthIndex+1,t),g=g.AddMonths(1),e.ViewModel.TotalCols.push(t.ID),e.ViewModel.GrpReportTotal.TotalCols.push(t.ID,e.colMonthIndex+e.CntMonths),e.ViewModel.lstGroup.forEach((function(o){o.TotalCols.push(t.ID,e.colMonthIndex+e.CntMonths)})),e.CntMonths++};g<=N;)m();else for(var O=function(){var t=e.ViewModel.ColumnSource[e.colMonthIndex].Clone();t.HeaderAppearance.IsVisible=!0,t.ID="M"+e.CntMonths,t.HeaderText=g.ToString("MMM yyyy"),n.Insert(e.colMonthIndex+e.CntMonths+1,t),g=g.AddMonths(1),e.ViewModel.TotalCols.push(t.ID),e.ViewModel.GrpReportTotal.TotalCols.push(t.ID,e.colMonthIndex+e.CntMonths),e.ViewModel.lstGroup.forEach((function(o){o.TotalCols.push(t.ID,e.colMonthIndex+e.CntMonths)})),e.CntMonths++};g<=N;)O();if(this.ViewModel.Preferences.ContainsKey("ShowMonths"))if(l.e.Int(this.ViewModel.Preferences.ShowMonths)>0){var A=this.ViewModel.ColumnSource[this.colMonthIndex].Clone();A.HeaderAppearance.IsVisible=!0,A.ID="Months",n.Insert(this.colMonthIndex+this.CntMonths+1,A),this.ViewModel.TotalCols.push(A.ID),this.ViewModel.GrpReportTotal.TotalCols.push(A.ID,this.colMonthIndex+this.CntMonths),this.ViewModel.lstGroup.forEach((function(t){t.TotalCols.push(A.ID,e.colMonthIndex+e.CntMonths)})),n.RemoveAt(this.colMonthIndex)}}this.AggTotal=l.e.NumArray(n.length,2),this.ViewModel.ReportColumns=n,this.oColumns=this.ViewModel.ReportColumns,this.ViewModel.IsTotalColsAdded=!0,this.ViewModel.totals=l.e.NumArray(this.oColumns.length,this.ViewModel.lstGroup.length+1);try{if(this.LevelNo=0,this.ShowLevelTree=!1,this.ViewModel.Preferences.ContainsKey("ShowLevel")){var L=new l.f;L.LoadXml("<XML>"+this.ViewModel.Preferences.ShowLevel+"</XML>");var B=l.f.SelectSingleNode(L.DocumentElement,"IsChecked");null!=B&&"1"==B.innerHTML&&(this.ShowLevelTree=!0,B=l.f.SelectSingleNode(L.DocumentElement,"Text"),this.LevelNo=parseInt(B.innerHTML))}var E;if(this.ChunkSize=this.ViewModel.Preferences.ContainsKey("ChunkSize")?parseInt(this.ViewModel.Preferences.ChunkSize):1,this.DefValuation=0,this.ViewModel.Preferences.ContainsKey("ValuationMethod")&&(this.DefValuation=l.e.Int(this.ViewModel.Preferences.ValuationMethod)),this.UnPostedDocsInclude=!(!this.ViewModel.Preferences.ContainsKey("IncludeUnPostedDocs")||"1"!=this.ViewModel.Preferences.IncludeUnPostedDocs),this.IsConsolidated=!(!this.ViewModel.Preferences.ContainsKey("ConsolidatedBatches")||"1"!=this.ViewModel.Preferences.ConsolidatedBatches),this.IsBinDetail=!(!this.ViewModel.Preferences.ContainsKey("BinDetail")||"1"!=this.ViewModel.Preferences.BinDetail),this.SortTransactionsBy=this.ViewModel.Preferences.ContainsKey("SortTransactionsBy")?this.ViewModel.Preferences.SortTransactionsBy:"",this.BatchConsolidated=!1,82==this.ViewModel.StaticReportType||83==this.ViewModel.StaticReportType){var k=s.a.report.DataSet("RPT022","SELECT [Value] FROM COM_CostCenterPreferences WITH(NOLOCK) WHERE CostCenterID=16 AND Name='ConsolidatedBatches'");null!=k&&k.Tables[0].length>0&&"TRUE"==k.Tables[0][0].Value.toString().toUpperCase()&&(this.BatchConsolidated=!0)}if(this.CurrencyType=0,this.ForeignCurrencyID=0,this.ViewModel.Preferences.ContainsKey("ForeignCurrency")){var F=new l.f;F.LoadXml("<XML>"+this.ViewModel.Preferences.ForeignCurrency+"</XML>");var G=l.f.SelectSingleNode(F.DocumentElement,"IsChecked");null!=G&&"1"==G.innerHTML&&(this.ForeignCurrencyID=parseInt(l.f.SelectSingleNode(F.DocumentElement,"Value").innerHTML))}else if(this.ViewModel.Preferences.ContainsKey("Currency")){var Q=new l.f;Q.LoadXml("<XML>"+this.ViewModel.Preferences.Currency+"</XML>"),this.CurrencyType=parseInt(l.f.SelectSingleNode(Q.DocumentElement,"Type").innerHTML),1==this.CurrencyType?(l.e.IsEmpty(s.a.SessionManager.Preferences.DimensionwiseCurrency)||0==parseInt(s.a.SessionManager.Preferences.DimensionwiseCurrency))&&(this.CurrencyType=0):2==this.CurrencyType&&(this.ForeignCurrencyID=parseInt(l.f.SelectSingleNode(Q.DocumentElement,"Value").innerHTML))}E=this.GetQuery(),s.a.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,E).then((function(t){e.dsMain=t,e.dv=e.dvTable=e.dsMain.Tables[0];var o=e.ViewModel.BaseReportColumns.find((function(e){return 181==e.CDGDO.FieldValue}));o&&"2"==o.FormulaEvaluateAtEnd.SelectedValue&&(e.HideBinQty=!0);var a=null!=o?o.ID:null,n=null,r=null,d=null;if(82==e.ViewModel.StaticReportType){var u=function(){var t,o;e.dvIssue=e.dvIssueTable=e.dsMain.Tables[1],e.dvIssueColumns=e.dsMain.Columns[1];for(var s=function(s){if(e.ViewModel.process.CancellationPending)return l=s,{v:{v:void(e.ViewModel.processArgs.Cancel=!0)}};o=e.dsMain.Tables[0][s],e.dblQty=parseFloat(o.Quantity),e.dvIssueColumns.Contains("BinInfo")&&(r=null,n=e.FillBinArrays(o[a].toString()));var i=t;t="BatchID="+o.BatchID.toString(),e.BatchConsolidated||(t+=" AND RefInvDocDetailsID="+e.dv[s].InvDocDetailsID.toString()),e.IsBinDetail&&(t+=" AND BinNodeID="+e.dv[s].BinNodeID.toString()),i!=t&&(e.dvIssue=e.dvIssueTable.filter((function(e){return e.BatchID==o.BatchID})),e.BatchConsolidated||(e.dvIssue=e.dvIssue.filter((function(t){return t.RefInvDocDetailsID==e.dv[s].InvDocDetailsID}))),e.IsBinDetail&&(e.dvIssue=e.dvIssue.filter((function(t){return t.BinNodeID==e.dv[s].BinNodeID}))));for(var h=0;h<e.dvIssue.length;h++){var d=e.dvIssue[h];if(null!=n&&null!=(r=e.FillBinArrays(d.BinInfo.toString())))for(var u=0;u<n.length;u++){var c={Key:n.keys[u],Value:n.values[u]};c.Value>0&&r.ContainsKey(c.Key)&&r[c.Key]>0&&(c.Value>r[c.Key]?(n[c.Key]=c.Value-r[c.Key],r[c.Key]=0):(r[c.Key]=r[c.Key]-c.Value,n[c.Key]=0))}if(e.dbl=parseFloat(d.Quantity),e.dblQty=e.dblQty-e.dbl,!(e.dblQty>=0)){o.Quantity=0,d.Quantity=-e.dblQty,e.dblQty=0,null!=r&&(d.BinInfo=e.GetBinInfo(r));break}d.Quantity=0,o.Quantity=e.dblQty,o.Value=e.dblQty*parseFloat(e.dv[s].Rate),null!=r&&(d.BinInfo="")}0!=e.dblQty?null!=n&&(o[a]=e.GetBinInfo(n)):(e.dsMain.Tables[0].RemoveAt(s),s--),l=s},l=0;l<e.dsMain.Tables[0].length;l++){var h=s(l);if("object"==typeof h)return h.v}if(e.Slabs.length>0){var u=[];"Expired"==e.FilterData?u=e.dsMain.Tables[0].filter((function(t){return+t.ExpDate>=+e.ViewModel.oReportDialog.ToDate.Date})):"Active"==e.FilterData?u=e.dsMain.Tables[0].filter((function(t){return+t.ExpDate<e.ViewModel.oReportDialog.ToDate.Date})):"SelectedSlabActive"==e.FilterData&&(u=e.dsMain.Tables[0].filter((function(t){return+t.ExpDate<e.ViewModel.oReportDialog.ToDate.Date||t.ExpDate>e.Slabs[e.Slabs.length-1]}))),u.forEach((function(t){e.dsMain.Tables[0].Remove(t)}))}if(e.IsConsolidated){e.dv.SortBy(["ProductName","BatchNumber"]);var c=0,D=null,I=null,p=null,M=null;for(e.k=e.dv.length-1;e.k>=0;e.k--)D=e.dv[e.k].ProductName.toString(),I=e.dv[e.k].BatchNumber.toString(),D==p&&I==M?(null!=a&&(null!=(d=e.FillBinArrays(e.dv[e.k][a].toString()))&&(null==n&&(n=new i.a),d.keys.forEach((function(e){var t={Key:e,Value:d[e]};n.ContainsKey(t.Key)?n[t.Key]+=t.Value:n.push(t.Key,t.Value)})),e.dv[e.k+1][a]=e.GetBinInfo(n))),e.dblQty+=parseFloat(e.dv[e.k].Quantity),c+=parseFloat(e.dv[e.k].Quantity)*parseFloat(e.dv[e.k].Rate),e.dv[e.k+1].Quantity=e.dblQty,e.dv[e.k+1].Value=c,e.dv[e.k+1].Rate=c/e.dblQty,e.dvTable.Remove(e.dv[e.k])):(e.dblQty=parseFloat(e.dv[e.k].Quantity),c=parseFloat(e.dv[e.k].Quantity)*parseFloat(e.dv[e.k].Rate),e.dv[e.k].Rate=c/e.dblQty,null!=a&&(n=e.FillBinArrays(e.dv[e.k][a].toString()))),p=D,M=I}(C=e.ViewModel.ColumnSourceALL.find((function(e){return"Quantity"==e.ID})))&&(C.Formula=""),(C=e.ViewModel.ColumnSourceALL.find((function(e){return"Value"==e.ID})))&&(C.Formula=""),(C=e.ViewModel.ColumnSourceALL.find((function(e){return"Expired"==e.ID})))&&(C.Formula=""),e.ViewModel.ReportData=e.dvTable,e.ViewModel.ReportDataColumns=e.dsMain.Columns[0],e.ViewModel.ConstructFormulaFields(!0),e.AddProductWiseBatchWiseAgeing(),e.ViewModel.process_RunWorkerCompleted()}();if("object"==typeof u)return u.v}else if(83==e.ViewModel.StaticReportType){var c,D=function(){var t;(c=e.ViewModel.BaseReportColumns.find((function(e){return 181==e.CDGDO.FieldValue})))&&"2"==c.FormulaEvaluateAtEnd.SelectedValue&&(e.HideBinQty=!0),e.dvIssue=e.dvIssueTable=e.dsMain.Tables[1],e.dvIssueColumns=e.dsMain.Columns[1],e.dsMain.Columns[0].push("Value"),e.dsMain.Columns[0].push("Expired"),e.dsMain.Columns[0].push("S0"),e.dsMain.Columns[0].push("S1"),e.dsMain.Columns[0].push("S2"),e.dsMain.Columns[0].push("S3"),e.dsMain.Columns[0].push("S4"),null!=e.SlabPercent&&(e.dsMain.Columns[0].push("P0"),e.dsMain.Columns[0].push("P1"),e.dsMain.Columns[0].push("P2"),e.dsMain.Columns[0].push("P3"),e.dsMain.Columns[0].push("P4"));for(var o=0;o<e.dsMain.Tables[0].length;o++){if(e.ViewModel.process.CancellationPending)return{v:void(e.ViewModel.processArgs.Cancel=!0)};t=e.dsMain.Tables[0][o],e.dblQty=parseFloat(t.Quantity),e.dvIssueColumns.Contains("BinInfo")&&(r=null,n=e.FillBinArrays(t[a].toString())),"BatchID="+t.BatchID.toString(),e.BatchConsolidated||" AND RefInvDocDetailsID="+t.InvDocDetailsID.toString(),e.dvIssue=e.dvIssueTable.filter(e.BatchConsolidated?function(e){return e.BatchID==t.BatchID}:function(e){return e.BatchID==t.BatchID&&e.RefInvDocDetailsID==t.InvDocDetailsID});for(var s=0;s<e.dvIssue.length;s++){var l=e.dvIssue[s];if(null!=n&&null!=(r=e.FillBinArrays(l.BinInfo.toString())))for(var h=0;h<n.length;h++){var d={Key:n.keys[h],Value:n.values[h]};d.Value>0&&r.ContainsKey(d.Key)&&r[d.Key]>0&&(d.Value>r[d.Key]?(n[d.Key]=d.Value-r[d.Key],r[d.Key]=0):(r[d.Key]=r[d.Key]-d.Value,n[d.Key]=0))}if(e.dbl=parseFloat(l.Quantity),e.dblQty=e.dblQty-e.dbl,!(e.dblQty>=0)){t.Quantity=0,l.Quantity=-e.dblQty,e.dblQty=0,null!=r&&(l.BinInfo=e.GetBinInfo(r));break}l.Quantity=0,t.Quantity=e.dblQty,null!=r&&(l.BinInfo="")}t.Value=null!=t.Rate?e.dblQty*parseFloat(t.Rate):0,0!=e.dblQty?null!=n&&(t[a]=e.GetBinInfo(n)):(e.dsMain.Tables[0].RemoveAt(o),o--)}var u=new i.a;u.push("-1","Expired"),u.push("0","S0"),u.push("1","S1"),u.push("2","S2"),u.push("3","S3"),u.push("4","S4");var D,I,p="",C=0;for(e.k=0;e.k<e.dv.length;e.k++){if(e.ViewModel.process.CancellationPending)return{v:void(e.ViewModel.processArgs.Cancel=!0)};e.dblQty=parseFloat(e.dv[e.k].Quantity),D=u[e.dv[e.k].ID.toString()],p==e.dv[e.k].ProductID.toString()?(e.dv[C][D]=null==e.dv[C][D]?e.dblQty:parseFloat(e.dv[C][D])+e.dblQty,e.dv[C].Quantity=null==e.dv[C].Quantity?e.dv[e.k].Quantity:parseFloat(e.dv[C].Quantity)+parseFloat(e.dv[e.k].Quantity),e.dv[C].Value=parseFloat(e.dv[C].Value)+parseFloat(e.dv[e.k].Value),e.dvTable.Remove(e.dv[e.k]),e.k--):(C=e.k,p=e.dv[e.k].ProductID.toString(),e.dv[e.k][D]=e.dblQty)}if(null!=e.SlabPercent)for(e.k=0;e.k<e.dv.length;e.k++)if(I=0,null!=e.dv[e.k].Quantity&&(I=parseFloat(e.dv[e.k].Quantity)),null!=e.dv[e.k].Expired&&(I-=parseFloat(e.dv[e.k].Expired)),0!=I)for(var M=0;M<=e.Slabs.length;M++)null!=e.dv[e.k]["S"+M]&&(e.dbl=parseFloat(e.dv[e.k]["S"+M]),e.dbl=100*e.dbl/I,e.dv[e.k]["P"+M]=e.dbl);e.addProductWiseExpiryAgeing(),e.ViewModel.process_RunWorkerCompleted()}();if("object"==typeof D)return D.v}else if(84==e.ViewModel.StaticReportType){var I="";if(e.ViewModel.BaseReportColumns.filter((function(e){return 33==e.ID.length})).forEach((function(t){40==t.CDGDO.ParentCostCenterID&&(I.length>0&&(I+=","),I+=t.CDGDO.Column,e.lstPCRates.push(t.ID))})),e.dblS=new Array(e.iSlabs.length+1).fill(0),e.dsMain.Columns[0].push("BalQty"),e.dsMain.Columns[0].push("BalValue"),e.dsMain.Columns[0].push("AvgRate"),null!=e.SlabValue){e.ViewModel.RefreshPostFilters();for(var p=0;p<=e.iSlabs.length;p++)e.dsMain.Columns[0].push("SV"+p)}e.lstParents.Clear(),e.lstTotal.Clear(),e.lstParents.push(e.NewReportRow()),e.lstTotal.push(new Array(e.oColumns.length).fill(0)),e.al=[],e.al.push(""),e.al.push(0),e.al.push(""),e.al.push(e.ViewModel.oReportDialog.StockDimensionID),e.ViewModel.oReportDialog.Locations.Visible&&null!=e.ViewModel.oReportDialog.LocationWhere?l.e.IsEmpty(e.ViewModel.oReportDialog.LocationWhere)?e.al.push(-1):e.al.push(e.ViewModel.oReportDialog.LocationWhere):e.al.push(null),e.al.push(e.AgeingDimWhere),e.al.push(e.strExcludeStockTransfer),e.al.push(e.ViewModel.oReportDialog.ToDate.Date),e.al.push(e.UnPostedDocsInclude),e.al.push(e.DefValuation),e.al.push(0),e.al.push(0),e.al.push(I),e.al.push(I.length>0?e.GetPriceFilter():""),e.al.push(e.CurrencyType),e.al.push(e.ForeignCurrencyID),e.al.push(e.SortTransactionsBy),e.al.push(s.a.SessionManager.UserID),e.al.push(s.a.SessionManager.LanguageID),e.iLoop=0,e.ProductWiseAgeingCallBack()}else if(88==e.ViewModel.StaticReportType)e.AddProductWiseSubstitues(""),e.ViewModel.process_RunWorkerCompleted();else if(114==e.ViewModel.StaticReportType){e.TagID=0;var C,M="",T="",S="";if((C=e.ViewModel.ReportColumns.filter((function(e){return"TAG"==e.ID}))).length>0){var w=e.ViewModel.BaseReportColumns.filter((function(e){return"TAG"==e.ID}));e.TagID=w[0].CDGDO.ColumnCostCenterID,e.TagID>5e4?M="Code"==w[0].CDGDO.Column?e.GetTagWiseQuery(e.TagID,"Code","Code"):e.GetTagWiseQuery(e.TagID,"Name","Name"):e.TagID=0}e.ViewModel.oReportDialog.Locations.Visible&&null!=e.ViewModel.oReportDialog.LocationWhere&&(T=l.e.IsEmpty(e.ViewModel.oReportDialog.LocationWhere)?" AND dcCCNID"+(e.ViewModel.oReportDialog.Locations.DBColumnID-5e4)+" IN (-1)":" AND dcCCNID"+(e.ViewModel.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+e.ViewModel.oReportDialog.LocationWhere+")",("TRUE"==s.a.SessionManager.Preferences["Division AverageRate"].toUpperCase()&&50001==e.ViewModel.oReportDialog.Locations.DBColumnID||"TRUE"==s.a.SessionManager.Preferences["Location AverageRate"].toUpperCase()&&50002==e.ViewModel.oReportDialog.Locations.DBColumnID||s.a.SessionManager.Preferences["Maintain Dimensionwise AverageRate"]==e.ViewModel.oReportDialog.Locations.DBColumnID.toString())&&(S=T));var V,f=null;e.ViewModel.Preferences.ContainsKey("DontApplyLocationFilter")&&"1"==e.ViewModel.Preferences.DontApplyLocationFilter&&(f=[50002]),T+=e.GetDimensionFilter("DCC.dcCCNID",f),V=e.ViewModel.SelectTag.Replace("@CCWHERE@",T.length>0?" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON A.InvDocDetailsID=DCC.InvDocDetailsID "+T:""),e.iLoop=0,e.al=[],e.al.push(""),e.al.push(e.ViewModel.Preferences.ExpectedQTY1),e.al.push(e.ViewModel.Preferences.ExpectedQTY2),e.al.push(e.ViewModel.Preferences.ExpectedQTY3),e.al.push(e.ViewModel.Preferences.CommitedQTY1),e.al.push(e.ViewModel.Preferences.CommitedQTY2),e.al.push(e.ViewModel.Preferences.CommitedQTY3),e.ViewModel.Preferences.ContainsKey("SalesDocs")?e.al.push(e.ViewModel.Preferences.SalesDocs):e.al.push("");var R=e.ViewModel.BaseReportColumns.find((function(e){return"Months"==e.ID}));e.al.push(R&&23824==R.CDGDO.FieldValue?"Gross":"UOMConvertedQty"),e.al.push(e.ViewModel.FromDatePicker.Date),e.al.push(e.ViewModel.ToDatePicker.Date),e.al.push(null!=e.MonthFromDate?e.MonthFromDate:e.ViewModel.FromDatePicker.Date),e.al.push(e.ViewModel.DontApplyDateFilter),e.al.push(e.TagID),e.al.push(M),e.al.push(T),e.al.push(V),e.al.push(e.ViewModel.FromTag),e.al.push(S),e.al.push(s.a.SessionManager.UserID),e.al.push(s.a.SessionManager.LanguageID),e.IsPCodeLink=null!=e.oColumns.find((function(e){return"ProductCode"==e.ID&&(e.LinkType==h.a.Dimension||e.LinkType==h.a.DimensionNode)})),e.IsPNameLink=null!=e.oColumns.find((function(e){return"ProductName"==e.ID&&(e.LinkType==h.a.Dimension||e.LinkType==h.a.DimensionNode)})),e.ShowDetailReport=!(!e.ViewModel.Preferences.ContainsKey("ShowDetailReport")||"1"!=e.ViewModel.Preferences.ShowDetailReport),e.TempRTVisible=e.ViewModel.GrpReportTotal.SubTotalAppearance.IsVisible,e.ItemMasterCallBack()}else if(115==e.ViewModel.StaticReportType){var y="";e.ViewModel.oReportDialog.Locations.Visible&&null!=e.ViewModel.oReportDialog.LocationWhere&&(y=l.e.IsEmpty(e.ViewModel.oReportDialog.LocationWhere)?" AND dcCCNID"+(e.ViewModel.oReportDialog.Locations.DBColumnID-5e4)+" IN (-1)":" AND dcCCNID"+(e.ViewModel.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+e.ViewModel.oReportDialog.LocationWhere+")"),y+=e.GetDimensionFilter("DCC.dcCCNID"),e.al=[],e.al.push(""),e.al.push(e.ViewModel.Preferences.ExpectedQTY1),e.al.push(e.ViewModel.Preferences.ExpectedQTY2),e.al.push(e.ViewModel.Preferences.ExpectedQTY3),e.al.push(e.ViewModel.Preferences.CommitedQTY1),e.al.push(e.ViewModel.Preferences.CommitedQTY2),e.al.push(e.ViewModel.Preferences.CommitedQTY3),e.ViewModel.Preferences.ContainsKey("SalesDocs")?e.al.push(e.ViewModel.Preferences.SalesDocs):e.al.push(""),e.al.push(e.ViewModel.FromDatePicker.Date),e.al.push(e.ViewModel.ToDatePicker.Date),e.al.push(y),e.al.push(s.a.SessionManager.UserID),e.al.push(s.a.SessionManager.LanguageID),e.ExtraColumns=new Array,e.oColumns.forEach((function(t){33==t.ID.length&&e.dsMain.Columns[0].Contains(t.ID)&&e.ExtraColumns.push(t)})),e.iLoop=0,e.SalesAnalysisCallBack()}}))}catch(W){return void Logger.ErrorLog("INV_Ageing::Error LoadReport ",W)}}},{key:"ProductWiseAgeingCallBack",value:function(){var e=this;if(this.iLoop>=this.dsMain.Tables[0].length)this.ProductWiseAgeingCallBack_Complete();else if(this.ViewModel.process.CancellationPending)this.ViewModel.processArgs.Cancel=!0;else{var t;this.sbChunks="";for(var o=this.iLoop;o<this.dsMain.Tables[0].length&&o-this.iLoop<this.ChunkSize;o++)this.ShowLevelTree&&Object(a.j)(this.dsMain.Tables[0][o].IsGroup)||(this.sbChunks.length>0&&(this.sbChunks+=","),this.sbChunks+=this.dsMain.Tables[0][o].ProductID.toString());this.al[0]=this.sbChunks.toString(),s.a.report.GetStockValuation(this.al,this.ViewModel.IsReportDB).then((function(o){e.ds=o,t=e.ds.Tables[0];for(var s=e.iLoop;s<e.dsMain.Tables[0].length&&s-e.iLoop<e.ChunkSize;s++){if(e.drMain=e.dsMain.Tables[0][s],e.strProductID=e.drMain.ProductID.toString(),(t=e.ds.Tables[0].filter((function(t){return t.ProductID==e.strProductID}))).length>0?(e.drMain.BalValue=t[0].BalValue,e.drMain.AvgRate=t[0].AvgRate):e.drMain.AvgRate=0,e.lstPCRates.length>0&&!Object(u.isUndefined)(t.PCxml)){e.lstPCRates.forEach((function(t){e.dsMain.Columns[0].Contains(t)||e.dsMain.Columns[0].push(t)}));for(var l=t[0].PCxml.toString().split(","),i=0;i<e.lstPCRates.length&&i<l.length;i++)e.drMain[e.lstPCRates[i]]=l[i]}e.ViewModel.lstGroup.length>0&&e.ViewModel.AddGroupRows(e.dsMain.Tables[0],s),e.addProductWiseAgeingRow()}e.ViewModel.refreshDataView(),e.iLoop+=e.ChunkSize,e.ProductWiseAgeingCallBack()}),(function(t){e.ProductWiseAgeingCallBack_Complete()}))}}},{key:"ProductWiseAgeingCallBack_Complete",value:function(){this.ShowLevelTree&&this.UpdateTreeTotals(0),this.ViewModel.CheckAndAddTotals(this.dsMain.Tables[0]),this.ViewModel.process_RunWorkerCompleted()}},{key:"ItemMasterCallBack",value:function(){var e=this;if(this.iLoop>=this.dsMain.Tables[0].length)this.ItemMasterCallBack_Complete();else if(this.ViewModel.process.CancellationPending)this.ViewModel.processArgs.Cancel=!0;else{var t,o,l,i=this.ChunkSize,a=null,n=null,r=null,d=null;this.ChunkSize=this.ViewModel.ReportViewType==h.e.Query?0==this.iLoop?1:i:this.ShowDetailReport?i:1,this.sbChunks="";for(var u=this.iLoop;u<this.dsMain.Tables[0].length&&u-this.iLoop<this.ChunkSize;u++)this.sbChunks.length>0&&(this.sbChunks+=","),this.sbChunks+=this.dsMain.Tables[0][u][this.dsMain.Columns[0][0]].toString();this.al[0]=this.sbChunks.toString(),s.a.report.GetItemMaster(this.al,this.ViewModel.IsReportDB).then((function(s){e.ds=s;for(var i=1;i<e.ds.Columns[1].length;i++)e.ds.Columns[0].push(e.ds.Columns[1][i]);(e.IsPCodeLink||e.IsPNameLink)&&(e.IsPCodeLink&&e.ds.Columns[0].push("ProductCode_ID"),e.IsPNameLink&&e.ds.Columns[0].push("ProductName_ID"),e.ds.Tables[0].forEach((function(t){e.IsPCodeLink&&(t.ProductCode_ID=t.ProductID),e.IsPNameLink&&(t.ProductName_ID=t.ProductID)}))),e.dv=e.dvTable=e.ds.Tables[0],t=o=e.ds.Tables[1],l=e.ds.Columns[1],e.dvIssue=e.dvIssueTable=e.ds.Tables[2],n=d=e.ds.Tables[3],e.TagID>0&&(a=r=e.ds.Tables[0]),e.DataSetCollection.push(e.ds);for(var h=0;h<=e.CntMonths;h++)e.ds.Columns[0].push("M"+h);e.ds.Columns[0].push("MonthsTotal"),e.ds.Columns[0].push("AvgMovement"),e.ds.Columns[0].push("Months");for(var u=e.iLoop;u<e.dsMain.Tables[0].length&&u-e.iLoop<e.ChunkSize;u++)if(e.drMain=e.dsMain.Tables[0][u],e.strProductID=e.drMain[e.dsMain.Columns[0][0]].toString(),e.dv=e.dvTable.filter((function(t){return t.ProductID==e.strProductID})),0,e.dv.length>0){if(e.TagID>0)!function(){var t=e.dv[0];e.dvIssue=e.dvIssueTable.filter((function(t){return t.ProductID==e.strProductID})),e.dvIssue.forEach((function(o){var s;0==(a=r.filter((function(t){return t.ProductID==e.strProductID&&t.TagID==o.TagID}))).length&&(0==(a=r.filter((function(t){return t.ProductID==e.strProductID&&0==t.TagID}))).length?((s=e.ds.Tables[0].NewRow()).ProductID=t.ProductID.toString(),s.ProductCode=t.ProductCode.toString(),s.ProductName=t.ProductName.toString(),s.TagID=o.TagID.toString(),e.ds.Tables[0].InsertAt(s,e.ds.Tables[0].indexOf(e.dv[e.dv.length-1]))):(s=a[0]).TagID=o.TagID.toString(),a=r.filter((function(t){return t.ProductID==e.strProductID&&t.TagID==o.TagID})));-1!=e.colMonthIndex&&(a[0]["M"+o.Mn.toString()]=o.Qty,null!=o.Qty&&(a[0].Months=null==a[0].Months?parseFloat(o.Qty):parseFloat(a[0].Months)+parseFloat(o.Qty)))})),e.dv.forEach((function(t){(n=d.filter((function(o){return o.ProductID==e.strProductID&&o.TagID==t.TagID}))).length>0&&(t.MonthsTotal=n[0].Qty,t.AvgMovement=parseFloat(n[0].Qty)/(e.CntMonths+1))}))}();else{var c=0;e.dvIssue=e.dvIssueTable.filter((function(t){return t.ProductID==e.strProductID})),n=d.filter((function(t){return t.ProductID==e.strProductID})),-1!=e.colMonthIndex&&e.dvIssue.forEach((function(t){e.dv[0]["M"+t.Mn.toString()]=t.Qty,null!=t.Qty&&(c+=parseFloat(t.Qty))})),n.length>0&&(e.dv[0].MonthsTotal=n[0].Qty,e.dv[0].AvgMovement=parseFloat(n[0].Qty)/(e.CntMonths+1)),e.dv[0].Months=c}(t=o.filter((function(t){return t.ProductID==e.strProductID}))).length>0&&e.dv.forEach((function(e){for(var o=1;o<l.length;o++)e[l[o]]=t[0][l[o]]}))}e.ViewModel.ReportData=e.ds.Tables[0],e.ViewModel.ReportDataColumns=e.ds.Columns[0],e.ViewModel.ConstructFormulaFields(!0),e.dv=e.dvTable,e.ViewModel.RenderData(e.dv,e.ds.Columns[0]),e.iLoop+e.ChunkSize<e.dsMain.Tables[0].length&&(e.ViewModel.GrpReportTotal.SubTotalAppearance.IsVisible=!1,e.ViewModel.CheckAndAddTotals(e.dv),e.ViewModel.GrpReportTotal.SubTotalAppearance.IsVisible=e.TempRTVisible),e.ViewModel.refreshDataView(),e.iLoop+=e.ChunkSize,e.ItemMasterCallBack()}))}}},{key:"ItemMasterCallBack_Complete",value:function(){this.ViewModel.CheckAndAddTotals(this.dv),this.ViewModel.process_RunWorkerCompleted()}},{key:"SalesAnalysisCallBack",value:function(){var e=this;if(this.iLoop>=this.dsMain.Tables[0].length)this.SalesAnalysisCallBack_Complete();else if(this.ViewModel.process.CancellationPending)this.ViewModel.processArgs.Cancel=!0;else{this.sbChunks="";for(var t=this.iLoop;t<this.dsMain.Tables[0].length&&t-this.iLoop<this.ChunkSize;t++)this.sbChunks.length>0&&(this.sbChunks+=","),this.sbChunks+=this.dsMain.Tables[0][t][this.dsMain.Columns[0][0]].toString();this.al[0]=this.sbChunks.toString(),s.a.report.GetSalesAnalasys(this.al,this.ViewModel.IsReportDB).then((function(t){e.ds=t,e.dv=e.dvTable=e.ds.Tables[0],e.dvIssue=e.dvIssueTable=e.ds.Tables[1],e.dvIssueColumns=e.ds.Columns[1],e.DataSetCollection.push(e.ds);for(var o=0;o<=e.CntMonths;o++)e.ds.Columns[0].push("M"+o);var s;e.ds.Columns[0].push("AvgMovement"),e.ds.Columns[0].push("MonthsTotal"),e.ExtraColumns.forEach((function(t){e.ds.Columns[0].Contains(t.ID)||e.ds.Columns[0].push(t.ID)}));for(var l=e.iLoop;l<e.dsMain.Tables[0].length&&l-e.iLoop<e.ChunkSize;l++)e.drMain=e.dsMain.Tables[0][l],e.strProductID=e.drMain[e.dsMain.Columns[0][0]].toString(),e.dv=e.dvTable.filter((function(t){return t.ProductID==e.strProductID})),s=0,e.dv.length>0&&(e.dvIssue=e.dvIssueTable.filter((function(t){return t.ProductID==e.strProductID})),e.dvIssue.forEach((function(t){e.dv[0]["M"+t.Mn.toString()]=t.Qty,s+=parseFloat(t.Qty)})),e.dv[0].MonthsTotal=s,e.dv[0].AvgMovement=s/e.CntMonths,e.ExtraColumns.forEach((function(t){e.dv[0][t.ID]=e.drMain[t.ID].toString()})));e.ViewModel.ReportData=e.ds.Tables[0],e.ViewModel.ReportDataColumns=e.ds.Columns[0],e.ViewModel.ConstructFormulaFields(!0),e.dv=e.dvTable,e.ViewModel.RenderData(e.dv,e.ds.Columns[0]),e.ViewModel.refreshDataView(),e.iLoop+=e.ChunkSize,e.SalesAnalysisCallBack()}))}}},{key:"SalesAnalysisCallBack_Complete",value:function(){this.ViewModel.ReportData=null,this.ViewModel.GrpReportTotal.SubTotalAppearance.IsVisible&&this.ViewModel.AddSubtotals_RT(this.ViewModel.GrpReportTotal,0),this.ViewModel.process_RunWorkerCompleted()}},{key:"FillBinArrays",value:function(e){var t;if(e.length>0){var o=e.split(",");t=new i.a;for(var s=0;s<o.length;s++){var l=o[s].indexOf("-"),a=parseFloat(o[s].substr(l+1));o[s]=o[s].substr(0,l+1).TrimStart(" "),t.ContainsKey(o[s])?t[o[s]]+=a:t.push(o[s],a)}}else t=null;return t}},{key:"GetBinInfo",value:function(e){var t=this,o="";return null!=e&&e.keys.forEach((function(s){var l={Key:s,Value:e[s]};l.Value>0&&(o.length>0&&(o+=", "),o+=t.HideBinQty?l.Key.TrimEnd("-"):l.Key+l.Value)})),o}},{key:"LoadReportWithPostFilters",value:function(e){if(this.GrdRow=-1,this.AggTotal=l.e.NumArray(this.oColumns.length,2),this.ViewModel.ClearRows(),this.ViewModel.totals=l.e.NumArray(this.oColumns.length,this.ViewModel.lstGroup.length+1),this.dv=c.a.FilterData(this.dvTable,this.ViewModel.PostDataFetchFilterFields),null!=this.lstTotal&&(this.lstTotal.Clear(),this.lstParents.Clear(),this.lstParents.push(this.NewReportRow()),this.lstTotal.push(new Array(this.oColumns.length).fill(0))),82==this.ViewModel.StaticReportType)this.AddProductWiseBatchWiseAgeing();else if(83==this.ViewModel.StaticReportType)this.addProductWiseExpiryAgeing();else if(84==this.ViewModel.StaticReportType)this.addProductWiseAgeing();else if(88==this.ViewModel.StaticReportType)this.AddProductWiseSubstitues(e);else if(114==this.ViewModel.StaticReportType){this.ViewModel.Preferences.ContainsKey("ShowDetailReport");for(var t=this.ViewModel.GrpReportTotal.SubTotalAppearance.IsVisible,o=0,s=0;o<this.dsMain.Tables[0].length;o+=this.ChunkSize,s++)this.ds=this.DataSetCollection[s],this.dv=this.ds.Tables[0],this.ViewModel.ReportData=this.ds.Tables[0],this.dv=c.a.FilterData(this.dv,this.ViewModel.PostDataFetchFilterFields),this.ViewModel.RenderData(this.dv),o+this.ChunkSize<this.dsMain.Tables[0].length&&(this.ViewModel.GrpReportTotal.SubTotalAppearance.IsVisible=!1,this.ViewModel.CheckAndAddTotals(this.dv),this.ViewModel.GrpReportTotal.SubTotalAppearance.IsVisible=t);this.ViewModel.CheckAndAddTotals(this.dv)}else if(115==this.ViewModel.StaticReportType){for(var i=0,a=0;i<this.dsMain.Tables[0].length;i+=this.ChunkSize,a++)this.ds=this.DataSetCollection[a],this.dv=this.ds.Tables[0],this.ViewModel.ReportData=this.ds.Tables[0],this.dv=c.a.FilterData(this.dv,this.ViewModel.PostDataFetchFilterFields),this.ViewModel.RenderData(this.dv);this.ViewModel.CheckAndAddTotals(this.dv)}this.ViewModel.refreshDataView()}},{key:"GetQuery",value:function(){var e="",t="",s="",i=this.ViewModel.oReportDialog.GetSeqNosListWithRoots();this.ViewModel.oReportDialog.IsZeroSelected||this.ViewModel.oReportDialog.IsOneSelected||(this.ViewModel.oReportDialog.IsGroupExists?(s=" AND P.ProductID=GTP.GTID",t=i.Contains(",")?",(select T.ProductID GTID from INV_Product T with(nolock),INV_Product GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.ProductID IN ("+i+") group by T.ProductID) AS GTP ":",(select T.ProductID GTID from INV_Product T with(nolock),INV_Product GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.ProductID="+i+" group by T.ProductID) AS GTP "):s=i.Contains(",")?" AND P.ProductID IN ("+i+")":" AND P.ProductID="+i);var a=this.ViewModel.GetCostCenterFilter(113,"D.StatusID");if(0==a.length&&(a=" and D.StatusID=369"),82==this.ViewModel.StaticReportType){var n="",r="",u="",c="D.UOMConvertedQty";this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(u=l.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID"+(this.ViewModel.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),((r+=u+=this.GetDimensionFilter("DCC.dcCCNID")).length>0||this.ViewModel.FromTag.Contains("DCC.dcCCNID"))&&(n=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON D.InvDocDetailsID=DCC.InvDocDetailsID "+this.ViewModel.FromTag),s=s.Replace("P.ProductID","B.ProductID"),e+="DECLARE @AsOn FLOAT\nSET @AsOn=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",this.ViewModel.GroupFromTag.Contains("BIN.NodeID")?(this.IsBinDetail=!0,c="isnull(BD.Quantity*D.UOMConversion,D.UOMConvertedQty)",this.ViewModel.SelectTag+=",isnull(BIN.NodeID,0) BinNodeID"):this.IsBinDetail=!1,e+="\nSELECT 'Code :'+P.ProductCode+'    Name :'+P.ProductName ProductName,B.BatchNumber,B.BatchID,D.InvDocDetailsID,CONVERT(DATETIME,B.ExpiryDate) ExpDate,CONVERT(DATETIME,B.MfgDate) MfgDate,"+c+" Quantity,D.Rate,"+c+"*D.Rate Value\n"+this.ViewModel.SelectTag+this.ViewModel.GroupSelectTag+"\nFROM INV_DocDetails D WITH(NOLOCK)\nINNER JOIN INV_Batches B  WITH(NOLOCK) ON B.BatchID=D.BatchID\nINNER JOIN INV_Product P WITH(NOLOCK) ON B.ProductID=P.ProductID"+n+this.ViewModel.GroupFromTag+t,e+=" WHERE D.BatchID>1 and D.VoucherType=1 AND D.IsQtyIgnored=0 AND D.DocDate<=@AsOn and B.ExpiryDate is not null"+a,s.length>0&&(e+=s),e+=r,e+=this.IsBinDetail?" Order By P.ProductName,D.DocDate,BatchNumber,BinNodeID,D.Rate,B.MfgDate":" Order By P.ProductName,D.DocDate,BatchNumber,D.Rate,B.MfgDate",this.IsBinDetail&&(n+="  left join INV_BinDetails BD with(nolock) on BD.InvDocDetailsID=D.InvDocDetailsID"),this.BatchConsolidated?(e+="\nSELECT B.BatchID,SUM("+c+") Quantity",this.IsBinDetail&&(e+=",isnull(BD.BinID,0) BinNodeID"),e+="\nFROM INV_DocDetails D WITH(NOLOCK)\nINNER JOIN INV_Batches B  WITH(NOLOCK) ON B.BatchID=D.BatchID\nINNER JOIN INV_Product P WITH(NOLOCK) ON B.ProductID=P.ProductID"+n+t,e+=" WHERE D.BatchID>1 and D.VoucherType=-1 AND D.IsQtyIgnored=0 AND D.DocDate<=@AsOn AND (D.RefInvDocDetailsID=0 OR D.RefInvDocDetailsID IS NULL) "+s,e+=r+a,e+=" GROUP BY B.BatchID",this.IsBinDetail&&(e+=",BD.BinID")):(e+="\nSELECT D.InvDocDetailsID,D.RefInvDocDetailsID, B.BatchID,"+c+" Quantity",this.IsBinDetail?e+=",isnull(BD.BinID,0) BinNodeID":this.ViewModel.ReportParams.ContainsKey("BinInfo")&&this.ViewModel.ReportParams.BinInfo.length>0&&(e+=","+this.ViewModel.ReportParams.BinInfo+" BinInfo"),e+="\nFROM INV_DocDetails D WITH(NOLOCK)\nINNER JOIN INV_Batches B  WITH(NOLOCK) ON B.BatchID=D.BatchID\nINNER JOIN [INV_Product] P WITH(NOLOCK) ON B.ProductID=P.ProductID"+n+t,e+=" WHERE D.BatchID>1 and D.VoucherType=-1 AND D.IsQtyIgnored=0 AND D.DocDate<=@AsOn AND D.RefInvDocDetailsID>0 "+s,e+=r+a)}else if(83==this.ViewModel.StaticReportType){var D="";this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(D=l.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID"+(this.ViewModel.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),(D+=this.GetDimensionFilter("DCC.dcCCNID")).length>0&&(D=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON D.InvDocDetailsID=DCC.InvDocDetailsID "+D);var I=this.BatchConsolidated?"":"D.InvDocDetailsID,";this.ViewModel.ReportParams.ContainsKey("BinInfo"),e+="declare @AsOn FLOAT\ndeclare @Tbl As Table(ID INT,FromDate FLOAT,ToDate FLOAT)\nset @AsOn=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",e+="\nINSERT INTO @Tbl VALUES(-1,0,@AsOn-1)\nINSERT INTO @Tbl VALUES(0,@AsOn,@AsOn+"+(this.iSlabs[0]-1)+")\nINSERT INTO @Tbl VALUES(1,@AsOn+"+this.iSlabs[0]+",@AsOn+"+(this.iSlabs[1]-1)+")\nINSERT INTO @Tbl VALUES(2,@AsOn+"+this.iSlabs[1]+",@AsOn+"+(this.iSlabs[2]-1)+")\nINSERT INTO @Tbl VALUES(3,@AsOn+"+this.iSlabs[2]+",@AsOn+"+(this.iSlabs[3]-1)+")\nINSERT INTO @Tbl VALUES(4,@AsOn+"+this.iSlabs[3]+",123456)\n",e+="SELECT "+I+"T.ID,D.ProductID,B.BatchID,P.ProductCode,P.ProductName,SUM(D.UOMConvertedQty) Quantity,MAX(D.Rate) Rate\n"+this.ViewModel.GroupSelectTag+"\nFROM INV_DocDetails D WITH(NOLOCK) "+D+"\nINNER JOIN INV_Batches B WITH(NOLOCK) ON B.BatchID=D.BatchID\nINNER JOIN @Tbl T ON B.ExpiryDate BETWEEN T.FromDate AND T.ToDate\n",e+=this.ShowLevelTree?" RIGHT JOIN INV_Product P WITH(NOLOCK) ON P.ProductID=D.ProductID":" INNER JOIN INV_Product P WITH(NOLOCK) ON P.ProductID=D.ProductID",e+=this.ViewModel.FromTag+this.ViewModel.GroupFromTag,e+=t,e+="\nWHERE D.BatchID>1 and (D.VoucherType=1 and D.IsQtyIgnored=0) AND D.DocDate<=@AsOn and B.ExpiryDate is not null",e+=a,this.ShowLevelTree?e+=" AND P.ProductID<>1 AND (D.Quantity IS NOT NULL OR P.IsGroup=1)"+s:s.length>0&&(e+=s),e+="\nGROUP BY "+I+"D.ProductID,B.BatchID,P.ProductCode,P.ProductName,T.ID,D.DocDate,D.Rate\nORDER BY P.ProductName,D.ProductID,B.BatchID,D.DocDate,T.ID,Rate",this.BatchConsolidated?(e+="\nSELECT B.BatchID,SUM(D.UOMConvertedQty) Quantity\nFROM INV_DocDetails D WITH(NOLOCK)"+D+"\nINNER JOIN INV_Batches B  WITH(NOLOCK) ON B.BatchID=D.BatchID\nINNER JOIN INV_Product P WITH(NOLOCK) ON B.ProductID=P.ProductID"+t,e+=" WHERE D.BatchID>1 and D.VoucherType=-1 AND D.IsQtyIgnored=0 AND D.DocDate<=@AsOn AND (D.RefInvDocDetailsID=0 OR D.RefInvDocDetailsID IS NULL) ",e+=a,e+=s,e+=" GROUP BY B.BatchID"):this.ViewModel.ReportParams.ContainsKey("BinInfo")&&this.ViewModel.ReportParams.BinInfo.length>0?(e+="\nSELECT D.RefInvDocDetailsID,B.BatchID,D.UOMConvertedQty Quantity,"+this.ViewModel.ReportParams.BinInfo+" BinInfo\nFROM INV_DocDetails D WITH(NOLOCK)"+D+"\nINNER JOIN INV_Batches B  WITH(NOLOCK) ON B.BatchID=D.BatchID\nINNER JOIN INV_Product P WITH(NOLOCK) ON B.ProductID=P.ProductID"+t,e+=" WHERE D.BatchID>1 and D.VoucherType=-1 AND D.IsQtyIgnored=0 AND D.DocDate<=@AsOn AND D.RefInvDocDetailsID>0 ",e+=a,e+=s):(e+="\nSELECT D.RefInvDocDetailsID,B.BatchID,SUM(D.UOMConvertedQty) Quantity\nFROM INV_DocDetails D WITH(NOLOCK)"+D+"\nINNER JOIN INV_Batches B  WITH(NOLOCK) ON B.BatchID=D.BatchID\nINNER JOIN INV_Product P WITH(NOLOCK) ON B.ProductID=P.ProductID"+t,e+=" WHERE D.BatchID>1 and D.VoucherType=-1 AND D.IsQtyIgnored=0 AND D.DocDate<=@AsOn AND D.RefInvDocDetailsID>0 ",e+=a,e+=s,e+=" GROUP BY D.RefInvDocDetailsID,B.BatchID")}else if(84==this.ViewModel.StaticReportType){var p="",C=!1,M=!1,T=!1;this.ViewModel.Preferences.ContainsKey("DisplayStock")&&(this.ViewModel.Preferences.DisplayStock.Contains("Zero")&&(T=!0),this.ViewModel.Preferences.DisplayStock.Contains("Positive")&&(C=!0),this.ViewModel.Preferences.DisplayStock.Contains("Negative")&&(M=!0),C||M||T||(C=M=T=!0));var S=0,w="",V="",f="",R="",y="",g="";this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(g=l.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID"+(this.ViewModel.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),g+=this.GetDimensionFilter("DCC.dcCCNID"),1==this.ViewModel.ReportGroups.length&&this.ViewModel.ReportGroups[0].CDGDO.ColumnCostCenterID>5e4&&(V=",DCC.dcCCNID"+((S=this.ViewModel.ReportGroups[0].CDGDO.ColumnCostCenterID)-5e4)+" TAGID",f=",DCC.dcCCNID"+(S-5e4),R=",TAGID",w=o.GetTagTableName(S),y=",TG.Name AS "+this.ViewModel.ReportGroups[0].ID,"TG.Name,",w=" INNER JOIN "+o.GetTagTableName(S)+" TG WITH(NOLOCK) ON TG.NodeID=TBL.TagID"),S>0&&(this.ShowLevelTree=!1),this.AgeingDimWhere=g,(S>0||g.length>0)&&(g=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON D.InvDocDetailsID=DCC.InvDocDetailsID "+g),this.ForeignCurrencyID>0&&(p+=" AND D.CurrencyID="+this.ForeignCurrencyID),p+=a,this.strExcludeStockTransfer=d.a.GetExcludeStockTransfer(this.ViewModel),p+=this.strExcludeStockTransfer,this.ViewModel.Preferences.ContainsKey("ExcludeOtherTransferInSales")&&this.ViewModel.Preferences.ExcludeOtherTransferInSales.length>0&&(p+=" AND D.CostCenterID NOT IN ("+this.ViewModel.Preferences.ExcludeOtherTransferInSales+")"),null!=this.ViewModel.ColumnSource.find((function(e){return"SerialNumbers"==e.ID&&e.HeaderAppearance.IsVisible}))&&(this.ViewModel.SelectTag+=",STUFF(\n(select ', '+S.SerialNumber from INV_SerialStockProduct S with(nolock)\ninner join Inv_DocDetails D with(nolock) on D.InvDocDetailsID=S.InvDocDetailsID\nwhere S.IsAvailable=1 and D.ProductID=P.ProductID FOR XML PATH('')),1,1,'') SerialNumbers"),e+="DECLARE @AsOn FLOAT\nSET @AsOn=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy"),e+="')) \nSELECT P.ProductCode,P.ProductName"+y+",P.ProductID"+this.ViewModel.SelectTag;for(var v=0;v<=this.iSlabs.length;v++)e+=",S"+v;if(e+=",Issue",this.ShowLevelTree&&(e+=",P.IsGroup,P.Depth"),this.ShowYearWise){e+=" FROM ( SELECT ProductID"+R;for(var P=0;P<=this.iSlabs.length;P++)e+=",SUM(S"+P+") S"+P;e+=",SUM(Issue) Issue FROM (";for(var b=0;b<=this.iSlabs.length;b++){b>0&&(e+="\nUNION ALL "),e+="\nSELECT D.ProductID"+V;for(var N=0;N<=this.iSlabs.length;N++)e+=b==N?",SUM(D.UOMConvertedQty) S"+N:",0 S"+N;e+=",0 Issue",e+="\nFROM INV_DocDetails D WITH(NOLOCK) "+g+"\nWHERE D.VoucherType=1 and D.IsQtyIgnored=0 AND ",e+=0==b?"(D.DocDate<=@AsOn AND D.DocDate>=convert(float,convert(datetime,'"+this.Slabs[b].ToString("dd MMM yyyy")+"')))":b==this.iSlabs.length?"D.DocDate<convert(float,convert(datetime,'"+this.Slabs[b-1].ToString("dd MMM yyyy")+"'))":"(D.DocDate<convert(float,convert(datetime,'"+this.Slabs[b-1].ToString("dd MMM yyyy")+"')) AND D.DocDate>=convert(float,convert(datetime,'"+this.Slabs[b].ToString("dd MMM yyyy")+"')))",e+=p,e+=" GROUP BY D.ProductID"+f}e+="\nUNION ALL\nSELECT D.ProductID"+V;for(var m=0;m<=this.iSlabs.length;m++)e+=",0 S"+m;e+=",SUM(D.UOMConvertedQty) Issue\nFROM INV_DocDetails D WITH(NOLOCK) "+g+"\nWHERE D.VoucherType=-1 and D.IsQtyIgnored=0 AND D.DocDate<=@AsOn"+p+"\nGROUP BY D.ProductID"+f+"\n\n) AS TBL2\nGROUP BY  ProductID"+R+") AS TBL"}else{var O=this.iSlabs[0],A="";e+=" FROM ( SELECT ProductID"+R;for(var L=0;L<=this.iSlabs.length;L++)e+=",SUM(S"+L+") S"+L,A+="SLAB S"+L+",";e+=",SUM(Issue) Issue FROM (\n\nSELECT D.ProductID"+V+","+A.Replace("SLAB S0,","SUM(D.UOMConvertedQty) S0,").Replace("SLAB","0")+"0 Issue\nFROM INV_DocDetails D WITH(NOLOCK) "+g+"\nWHERE D.VoucherType=1 and D.IsQtyIgnored=0 AND (D.DocDate<=@AsOn AND D.DocDate>@AsOn-"+this.iSlabs[0]+")"+p+"\nGROUP BY D.ProductID"+f;for(var B=1;B<this.iSlabs.length;B++)this.iSlabs[B]>this.iSlabs[B-1]&&(O=this.iSlabs[B],e+="\nUNION\nSELECT D.ProductID"+V+","+A.Replace("SLAB S"+B+",","SUM(D.UOMConvertedQty) S"+B+",").Replace("SLAB","0"),e+="0 Issue\nFROM INV_DocDetails D WITH(NOLOCK) "+g+"\nWHERE D.VoucherType=1 and D.IsQtyIgnored=0 AND (D.DocDate<=@AsOn-"+this.iSlabs[B-1]+" AND D.DocDate>@AsOn-"+this.iSlabs[B]+")"+p+"\nGROUP BY D.ProductID"+f);e+="\nUNION\nSELECT D.ProductID"+V+","+A.Replace("SLAB S"+this.iSlabs.length+",","SUM(D.UOMConvertedQty) S"+this.iSlabs.length+",").Replace("SLAB","0")+"0 Issue\nFROM INV_DocDetails D WITH(NOLOCK) "+g+"\nWHERE D.VoucherType=1 and D.IsQtyIgnored=0 AND (D.DocDate<=@AsOn-"+O+")"+p+"\nGROUP BY D.ProductID"+f+"\nUNION\nSELECT D.ProductID"+V+","+A.Replace("SLAB","0")+"SUM(D.UOMConvertedQty) Issue\nFROM INV_DocDetails D WITH(NOLOCK) "+g+"\nWHERE D.VoucherType=-1 and D.IsQtyIgnored=0 AND D.DocDate<=@AsOn"+p+"\nGROUP BY D.ProductID"+f+"\n\n) AS TBL2\nGROUP BY  ProductID"+R+") AS TBL"}var E="";if(!C||!M||!T){for(var k="S0",F=1;F<=this.iSlabs.length;F++)k+="+S"+F;C&&(E="("+k+"-Issue)>0"),M&&(E.length>0&&(E+=" OR "),E+="("+k+"-Issue)<0"),T&&(E.length>0&&(E+=" OR "),E+="("+k+"-Issue)=0")}this.ShowLevelTree?(e+=" RIGHT JOIN INV_Product P WITH(NOLOCK) ON P.ProductID=TBL.ProductID"+this.ViewModel.FromTag+t,e+=" WHERE P.ProductID<>1 AND P.ProductTypeID!=6 AND P.ProductTypeId!=10 AND ",e+="((TBL.S0 IS NOT NULL",E.length>0&&(e+=" AND ("+E+")"),e+=")",e+="OR P.IsGroup=1)",e+=s,l.e.IsEmpty(this.ViewModel.RowFiltersWhere)||(e+=" AND "+this.ViewModel.RowFiltersWhere),e+=" ORDER BY P.lft"):(e+=" INNER JOIN INV_Product P WITH(NOLOCK) ON P.ProductID=TBL.ProductID"+w+this.ViewModel.FromTag+t,e+=" WHERE P.ProductTypeID!=6 AND P.ProductTypeId!=10 and P.IsGroup=0"+s,E.length>0&&(e+=" AND ("+E+")"),l.e.IsEmpty(this.ViewModel.RowFiltersWhere)||(e+=" AND "+this.ViewModel.RowFiltersWhere))}else 88==this.ViewModel.StaticReportType?(e+="SELECT MS.[ProductID],S.[ProductID] SProductID,P.ProductCode SCode,P.ProductName SName,ISNULL((SELECT SUM(INV.UOMConvertedQty*INV.VoucherType) QOH FROM INV_DocDetails INV WITH(NOLOCK)\nWHERE INV.ProductID=S.ProductID),0) QOH\nFROM [INV_ProductSubstitutes] MS WITH(NOLOCK)\nLEFT JOIN [INV_ProductSubstitutes] S WITH(NOLOCK) ON MS.[SubstituteGroupID]=S.[SubstituteGroupID] --AND MS.[ProductID]<>S.[ProductID]\nINNER JOIN INV_Product P WITH(NOLOCK) ON P.[ProductID]=S.[ProductID]"+t,s.length>0&&(e+=" WHERE 1=1 "+(s=s.Replace("P.ProductID","MS.ProductID"))),e+=" GROUP BY  MS.[ProductID],S.[ProductID],P.ProductCode,P.ProductName",e+="\nSELECT MS.[ProductID],MS.[SubstituteGroupName] FROM [INV_ProductSubstitutes] MS WITH(NOLOCK)"+t,s.length>0&&(e+=" WHERE 1=1"+s),e+=" group by MS.[ProductID],MS.[SubstituteGroupName]"):114==this.ViewModel.StaticReportType?this.ViewModel.ReportViewType!=h.e.Query||i.Contains(",")||"1"==i?this.ViewModel.Preferences.ContainsKey("ShowDetailReport")&&"1"==this.ViewModel.Preferences.ShowDetailReport?(e+="SELECT P.ProductID,P.ProductName FROM INV_Product P WITH(NOLOCK)"+t,e+=" WHERE P.IsGroup=0"+s,e+=" Order By P.lft"):(this.LevelNo=6,this.ViewModel.Preferences.ContainsKey("Level")&&l.e.IsNum(this.ViewModel.Preferences.Level)&&(this.LevelNo=l.e.Int(this.ViewModel.Preferences.Level)),e+="SELECT P.ProductID,P.ProductName FROM INV_Product P WITH(NOLOCK)"+t,e+=" WHERE P.IsGroup=1 AND P.Depth<="+this.LevelNo+s,e+=" Order By P.ProductName"):this.ViewModel.Preferences.ContainsKey("ShowDetailReport")&&"1"==this.ViewModel.Preferences.ShowDetailReport?e+="select ProductID,ProductName,lft from INV_Product WITH(NOLOCK) where productid="+i+" OR (IsGroup=0 and lft>(select lft from inv_product WITH(NOLOCK) where productid="+i+") and rgt<(select rgt from inv_product WITH(NOLOCK) where productid="+i+")) order by lft":e+="select ProductID,ProductName from INV_Product WITH(NOLOCK) where productid="+i:115==this.ViewModel.StaticReportType&&(e+="SELECT P.ProductID,P.ProductName,P.ValuationID "+this.ViewModel.SelectTag+" FROM INV_Product P WITH(NOLOCK)"+t,e+=this.ViewModel.FromTag,e+=" WHERE P.IsGroup=0 "+s,e+=" Order By P.ProductName");return e.toString()}},{key:"AddReportTotals",value:function(){this.UpdateTreeTotals(0),this.row=this.NewReportRow_2(r.f.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance),this.ViewModel.GrpReportTotal.Height>0&&(this.row.Height=this.ViewModel.GrpReportTotal.Height),this.row.LevelNo=0;var e=-1;for(this.k=0;this.k<this.ViewModel.ColumnSource.length;this.k++)this.ViewModel.GrpReportTotal.TotalCols.ContainsKey(this.oColumns[this.k].ID)&&(-1==e&&(e=this.k),this.row.Cells[this.k].CellAppearance.Alignment="Right",this.ViewModel.SetCellValue(this.lstTotal[0][this.k].toString(),this.oColumns[this.k].DataFormat,this.oColumns[this.k].ColumnType,this.row.Cells[this.k]));for(this.k=this.ViewModel.ColumnSource.length;this.k<this.oColumns.length;this.k++)-1==e&&(e=this.k),this.row.Cells[this.k].CellAppearance.Alignment="Right",this.ViewModel.SetCellValue(this.lstTotal[0][this.k].toString(),this.oColumns[this.k].DataFormat,this.oColumns[this.k].ColumnType,this.row.Cells[this.k]);this.row.Cells[0].Text=s.a.GetResource("Reports_ReportTotal"),e>0&&(this.GrdRow++,this.row.Cells[0].ColSpan=e,this.ViewModel.addRow(this.row))}},{key:"addProductWiseAgeingRow",value:function(){if(this.oRow=this.NewReportRow(),this.oRow.Height=this.ViewModel.RowHeight,this.ShowLevelTree&&(this.oRow.LevelNo=parseInt(this.drMain.Depth)-1,this.oRow.Cells[1].IsNormal=!1,this.oRow.IsGroup=Object(a.j)(this.drMain.IsGroup),this.oRow.Cells[1].level=this.oRow.LevelNo,this.UpdateTreeTotals(this.oRow.LevelNo),this.lstParents.length>0&&(this.oRow.Parent=this.lstParents[this.lstParents.length-1]),Object(a.j)(this.drMain.IsGroup))){this.lstParents.push(this.oRow),this.lstTotal.push(new Array(this.oColumns.length).fill(0)),this.oRow.Type=r.f.BalanceBF;for(var e=0;e<this.oRow.Cells.length;e++)this.oRow.Cells[e].IsNormal=!1,this.oRow.Cells[e].CellAppearance=this.oColumns[e].DataAppearance.Clone(),this.oRow.Cells[e].CellAppearance.ForeColor=this.BalanceBFAppearance.ForeColor}if(!this.oRow.IsGroup){this.dbl=0;for(var t=0;t<=this.iSlabs.length;t++)this.dblS[t]=parseFloat(this.drMain["S"+t]),this.dbl+=this.dblS[t];this.dblIssue=parseFloat(this.drMain.Issue),this.dbl=this.dbl-this.dblIssue,this.drMain.BalQty=this.dbl;for(var o=this.iSlabs.length;o>=0;o--){if(this.dbl=parseFloat(this.drMain["S"+o]),this.dblIssue=this.dblIssue-this.dbl,!(this.dblIssue>=0)){this.drMain["S"+o]=-this.dblIssue;break}0==o&&this.dblIssue>0?this.drMain.S0=-this.dblIssue:this.drMain["S"+o]=0}if(null!=this.SlabValue){this.dblAvgRate=parseFloat(this.drMain.AvgRate);for(var s=0;s<=this.iSlabs.length;s++)this.drMain["SV"+s]=this.dblAvgRate*parseFloat(this.drMain["S"+s])}}this.oRow.NodeID=parseInt(this.drMain.ProductID);for(var i=0;i<this.oColumns.length;i++)this.CellValue=null,Object(u.isUndefined)(this.drMain[this.oColumns[i].ID])||(this.CellValue=this.drMain[this.oColumns[i].ID]),null!=this.CellValue&&(this.ViewModel.SetCellValue(this.CellValue,this.oColumns[i].DataFormat,this.oColumns[i].ColumnType,this.oRow.Cells[i]),l.e.IsNum(this.CellValue)&&(this.dbl=l.e.Double(this.CellValue),this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][i]+=this.dbl),this.ViewModel.totals[i][this.ViewModel.lstGroup.length]+=this.dbl));this.oRow.LevelNo<=this.LevelNo&&(this.oRow.IsGroup||this.ViewModel.ApplyKPI(this.oRow),this.GrdRow++,this.ViewModel.addRow(this.oRow))}},{key:"addProductWiseAgeing",value:function(){var e;for(this.lstParents.Clear(),this.lstTotal.Clear(),this.lstParents.push(this.NewReportRow()),this.lstTotal.push(new Array(this.oColumns.length).fill(0)),this.k=0;this.k<this.dv.length;this.k++){if(this.oRow=this.NewReportRow(),this.oRow.Height=this.ViewModel.RowHeight,this.ShowLevelTree&&(this.oRow.LevelNo=parseInt(this.dv[this.k].Depth)-1,this.oRow.Cells[1].IsNormal=!1,this.oRow.IsGroup=Object(a.j)(this.dv[this.k].IsGroup),this.oRow.Cells[1].level=this.oRow.LevelNo,this.UpdateTreeTotals(this.oRow.LevelNo),Object(a.j)(this.dv[this.k].IsGroup))){this.lstParents.push(this.oRow),this.lstTotal.push(new Array(this.oColumns.length).fill(0)),this.oRow.Type=r.f.BalanceBF;for(var t=0;t<this.oRow.Cells.length;t++)this.oRow.Cells[t].IsNormal=!1,this.oRow.Cells[t].CellAppearance=this.oColumns[t].DataAppearance.Clone(),this.oRow.Cells[t].CellAppearance.ForeColor=this.BalanceBFAppearance.ForeColor}if(this.oRow.IsGroup||!(parseFloat(this.dv[this.k].BalQty)<0)){this.oRow.NodeID=parseInt(this.dv[this.k].ProductID);for(var o=0;o<this.oColumns.length;o++)this.CellValue=null,Object(u.isUndefined)(this.dv[this.k][this.oColumns[o].ID])||(this.CellValue=this.dv[this.k][this.oColumns[o].ID]),null!=this.CellValue&&(this.ViewModel.SetCellValue(this.CellValue,this.oColumns[o].DataFormat,this.oColumns[o].ColumnType,this.oRow.Cells[o]),l.e.IsNum(this.CellValue)&&(e=l.e.Double(this.CellValue),this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][o]+=e),this.ViewModel.totals[o][this.ViewModel.lstGroup.length]+=e));this.oRow.LevelNo<=this.LevelNo&&(this.oRow.IsGroup||this.ViewModel.ApplyKPI(this.oRow),this.GrdRow++,this.ViewModel.addRow(this.oRow))}}this.ShowLevelTree&&this.UpdateTreeTotals(0),this.ViewModel.CheckAndAddTotals(this.dv)}},{key:"addProductWiseExpiryAgeing",value:function(){var e;for(this.lstParents.Clear(),this.lstTotal.Clear(),this.lstParents.push(this.NewReportRow()),this.lstTotal.push(new Array(this.oColumns.length).fill(0)),this.k=0;this.k<this.dv.length;this.k++){if(this.ViewModel.process.CancellationPending)return void(this.ViewModel.processArgs.Cancel=!0);if(this.oRow=this.NewReportRow(),this.oRow.Height=this.ViewModel.RowHeight,this.ShowLevelTree&&(this.oRow.LevelNo=parseInt(this.dv[this.k].Depth)-1,this.oRow.Cells[1].IsNormal=!1,this.oRow.IsGroup=Object(a.j)(this.dv[this.k].IsGroup),this.oRow.Cells[1].level=this.oRow.LevelNo,this.UpdateTreeTotals(this.oRow.LevelNo),Object(a.j)(this.dv[this.k].IsGroup))){this.lstParents.push(this.oRow),this.lstTotal.push(new Array(this.oColumns.length).fill(0)),this.oRow.Type=r.f.BalanceBF;for(var t=0;t<this.oRow.Cells.length;t++)this.oRow.Cells[t].IsNormal=!1,this.oRow.Cells[t].CellAppearance=this.oColumns[t].DataAppearance.Clone(),this.oRow.Cells[t].CellAppearance.ForeColor=this.BalanceBFAppearance.ForeColor}this.oRow.NodeID=parseInt(this.dv[this.k].ProductID);for(var o=0;o<this.oColumns.length;o++)this.CellValue=null,Object(u.isUndefined)(this.dv[this.k][this.oColumns[o].ID])||(this.CellValue=this.dv[this.k][this.oColumns[o].ID]),null!=this.CellValue&&(this.ViewModel.SetCellValue(this.CellValue,this.oColumns[o].DataFormat,this.oColumns[o].ColumnType,this.oRow.Cells[o]),l.e.IsNum(this.CellValue)&&(e=l.e.Double(this.CellValue),this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][o]+=e)));this.oRow.LevelNo<=this.LevelNo&&(this.oRow.IsGroup||this.ViewModel.ApplyKPI(this.oRow),this.GrdRow++,this.ViewModel.addRow(this.oRow))}if(null!=this.SlabPercent&&(this.dblQty=0,this.ViewModel.GrpReportTotal.TotalCols.ContainsKey("Quantity")&&(this.dblQty=this.lstTotal[0][this.ViewModel.GrpReportTotal.TotalCols.Quantity]),this.ViewModel.GrpReportTotal.TotalCols.ContainsKey("Expired")&&(this.dblQty=this.dblQty-this.lstTotal[0][this.ViewModel.GrpReportTotal.TotalCols.Expired]),0!=this.dblQty))for(var s=0;s<=this.Slabs.length;s++)this.ViewModel.GrpReportTotal.TotalCols.ContainsKey("S"+s)&&(e=100*(e=this.lstTotal[0][this.ViewModel.GrpReportTotal.TotalCols["S"+s]])/this.dblQty,this.lstTotal[0][this.ViewModel.GrpReportTotal.TotalCols["S"+s]+1]=e);this.AddReportTotals()}},{key:"UpdateTreeTotals",value:function(e){for(var t=this.lstTotal.length-1;t>e;t--){if(t>0)for(var o=0;o<this.lstTotal[t].length;o++)this.lstTotal[t-1][o]+=this.lstTotal[t][o];for(var s=0;s<this.oColumns.length;s++)"FLOAT"==this.oColumns[s].ColumnType&&this.ViewModel.SetCellValue(this.lstTotal[t][s],this.oColumns[s].DataFormat,"FLOAT",this.lstParents[t].Cells[s]);if(e<=this.LevelNo){var l=this.ViewModel.Data.indexOf(this.lstParents[t]);l>=0&&(this.ViewModel.Data.Remove(this.lstParents[t]),this.ViewModel.Data.Insert(l,this.lstParents[t]))}this.lstParents.RemoveAt(t),this.lstTotal.RemoveAt(t)}}},{key:"AddProductWiseBatchWiseAgeing",value:function(){var e,t,o;for(this.k=0;this.k<this.dv.length;this.k++){this.oRow=this.NewReportRow(),this.oRow.LevelNo=this.ViewModel.lstGroup.length,this.ViewModel.AddGroupRows(this.dv,this.k),this.dv[this.k].Expired=null;for(var s=0;s<=this.Slabs.length;s++)this.dv[this.k]["S"+s]=null;if(null==this.dv[this.k].ExpDate&&(this.dv[this.k].ExpDate=this.ViewModel.oReportDialog.ToDate.Date),(o=new Date(this.dv[this.k].ExpDate))<this.ViewModel.oReportDialog.ToDate.Date)this.dv[this.k].Expired=this.dv[this.k].Quantity;else{for(e=0;e<this.Slabs.length&&!(o<this.Slabs[e]);e++);e>=0?this.dv[this.k]["S"+e]=this.dv[this.k].Quantity:this.dv[this.k].S0=this.dv[this.k].Quantity}for(var i=0;i<this.oColumns.length;i++)this.CellValue=null,Object(u.isUndefined)(this.dv[this.k][this.oColumns[i].ID])||(this.CellValue=this.dv[this.k][this.oColumns[i].ID]),null!=this.CellValue&&(this.ViewModel.SetCellValue(this.CellValue,this.oColumns[i].DataFormat,this.oColumns[i].ColumnType,this.oRow.Cells[i]),l.e.IsNum(this.CellValue)&&(t=l.e.Double(this.CellValue),this.ViewModel.totals[i][this.ViewModel.lstGroup.length]+=t));this.ViewModel.ApplyKPI(this.oRow),this.ViewModel.addRow(this.oRow)}this.ViewModel.CheckAndAddTotals(this.dv)}},{key:"AddProductWiseSubstitues",value:function(e){var t=this,o=0;if(null==this.dtProducts){var s,i=this.dsMain.Tables[1];this.dtProducts=this.dv.ToTable(!0,["ProductID"]),this.dtProducts.forEach((function(e){t.dv=t.dvTable.filter((function(t){return t.SProductID==e.ProductID})),t.dv.length>0&&(e.QOH=t.dv[0].QOH,(i=t.dsMain.Tables[1].filter((function(t){return t.ProductID==e.ProductID}))).length>0?(s="",i.forEach((function(e){s.length>0&&(s+=", "),s+=e.SubstituteGroupName.toString()})),e.Product=t.dv[0].SName.toString()+" ("+s+")"):e.Product=t.dv[0].SName)}))}var a=this.dtProducts.Copy();a.SortBy(["Product"]),this.dv.SortBy(["SName"]),l.e.IsEmpty(e)||(e=" and "+e);for(var n=0;n<a.length;n++){if(this.ViewModel.process.CancellationPending)return void(this.ViewModel.processArgs.Cancel=!0);for(this.oRow=this.NewReportRow_2(r.f.Group,this.ViewModel.lstGroup[0].GroupAppearance),this.ViewModel.lstGroup[0].Height>0&&(this.oRow.Height=this.ViewModel.lstGroup[0].Height),this.oRow.Cells[0].Text=a[n].Product.toString(),-1!=this.colQOHIndex?(this.oRow.Cells[0].ColSpan=this.colQOHIndex,this.ViewModel.SetCellValue(a[n].QOH.toString(),this.oColumns[this.colQOHIndex].DataFormat,this.oColumns[this.colQOHIndex].ColumnType,this.oRow.Cells[this.colQOHIndex]),this.oRow.Cells[this.colQOHIndex].CellAppearance.Alignment="Right"):this.oRow.Cells[0].ColSpan=this.dv.length,this.ViewModel.addRow(this.oRow),o=parseInt(a[n].ProductID),this.dv=this.dvTable.filter((function(e){return e.ProductID==o})),this.k=0;this.k<this.dv.length;this.k++)if(parseInt(this.dv[this.k].SProductID)!=o){this.oRow=this.NewReportRow();for(var h=0;h<this.oColumns.length;h++)this.CellValue=null,Object(u.isUndefined)(this.dv[this.k][this.oColumns[h].ID])||(this.CellValue=this.dv[this.k][this.oColumns[h].ID]),null!=this.CellValue&&this.ViewModel.SetCellValue(this.CellValue,this.oColumns[h].DataFormat,this.oColumns[h].ColumnType,this.oRow.Cells[h]);this.ViewModel.ApplyKPI(this.oRow),this.ViewModel.addRow(this.oRow)}}}}]),o}(n.b)}}]);
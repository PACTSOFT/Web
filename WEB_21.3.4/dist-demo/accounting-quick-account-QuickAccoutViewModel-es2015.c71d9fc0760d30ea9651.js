(window.webpackJsonp=window.webpackJsonp||[]).push([[87],{VYMu:function(t,e,s){"use strict";s.r(e),s.d(e,"QuickAccoutViewModel",(function(){return C})),s.d(e,"ControlAccountDialog",(function(){return p}));var o=s("VxiT"),i=s("0/4Q"),c=s("NkMH"),n=s("Do2H"),a=s("eQJW"),u=s("REyf"),h=s("mQEZ"),l=s("Lp6j"),r=s("ScVY"),b=s("sW9y"),d=s("PDNK"),S=s("4k0m"),A=s("++IR");class C extends r.b{constructor(t,e,s,i,u,h){if(super(),this.ScreenObject=new o.a,this.DefaultValuation=1,this.AccountCode=null,this.AccountName=null,this.Status=null,this.NodeID=0,this.ParentId=0,this.GParentID=0,this.Parent=null,this.obj={},this.Height="",this.AccountType=null,this.Group=null,this._AccountID=0,this._Parent=0,this.RetValue=0,this.IsControlAccounts=!1,this.iAccountType=0,this.ControlType=0,this.ButtonSave=new c.a,n.a.SessionManager.Preferences.ContainsKey("IsControlAccounts")&&"TRUE"==n.a.SessionManager.Preferences.IsControlAccounts.toUpperCase()&&(this.IsControlAccounts=!0,0==h&&(h=1)),this.AccountID=t,this.obj.IsGroup=i,this.obj.AccountID=this.AccountID,this.ParentId=s,this.ControlType=h,this.ScreenObject.LoadQuickScreen(this,2,i),this.OnLoad(),this.dtTypes=this.ScreenObject.Data.Tables[4],h>0&&(2==h?u=7:3==h&&(u=6)),this.iAccountType=u,null!=this.AccountType&&(this.AccountType.SelectedValue=u.toString()),0==this.obj.AccountID&&(null!=this.Group&&(this.Group.SelectedValue=this.ParentId,this.Group.DefaultValue=this.Group.SelectedValue.toString()),0!=e&&(this.obj.SelectedNodeID=e)),this.FillAccountTypes(this.AccountType,u,0==s||1==s?1:-1),null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>8&&this.ScreenObject.Data.Columns[8].Contains("IsParentCodeInherited")&&this.ScreenObject.Data.Tables[8].length>0){this.ScreenObject.InitAutoCode(this.ScreenObject.Data.Tables[8],i);var l=this.ScreenObject.StaticFields.find(t=>26721==t.DBColumnID);if(l&&(l.Visible=!(!i||!this.ScreenObject.IsAutoCode)),null!=this.AccountName){let t=this.ScreenObject.Data.Tables[5].filter(t=>"CapsLock"==t.Name);t.length>0&&Object(a.j)(t[0].Value)&&(this.AccountName.IsAllCaps=!0),t=this.ScreenObject.Data.Tables[5].filter(t=>"CapsToFirstLetter"==t.Name),t.length>0&&Object(a.j)(t[0].Value)&&(this.AccountName.IsFirstLetterCaps=!0)}}if(0!=this.obj.AccountID?(this.LoadEditData(),null!=this.Group&&(this.Group.Enable=!1)):(null!=this.Group&&(this.Group.SelectedValue=this.ParentId),this.obj.GUID=""),this.DisplayName=this.ScreenName,this.obj.SelectedNodeID=e,0==this.AccountID&&(this.AutoGenerateCode(),this.LoadParentData()),this.Title=n.a.GetResource(i?0!=this.AccountID?"Account_EditGroup":"Account_AddGroup":0!=this.AccountID?"Account_EditAccount":"Account_AddAccount"),this.DisplayName=this.Title,n.a.SessionManager.IsActionAssigned(2,"DefaultInActive")){let t=this.ScreenObject.GetQuickCombo(242);null!=t&&(t.DefaultValue="34",0==this.AccountID&&(t.SelectedValue="34"))}}get AccountID(){return this._AccountID}set AccountID(t){this._AccountID=t,this.obj.AccountID=t}FillAccountTypes(t,e,s){if(0==e&&(e=1),null!=t){let o=t.SelectedValue;if(t.Items.Clear(),this.IsControlAccounts){let s=[];1==this.ControlType?s=this.dtTypes.filter(t=>6==t.AccountTypeID||7==t.AccountTypeID):2==this.ControlType?(e=7,t.DefaultValue="7",s=this.dtTypes.filter(t=>7!=t.AccountTypeID)):3==this.ControlType&&(e=6,t.DefaultValue="6",s=this.dtTypes.filter(t=>6!=t.AccountTypeID)),s.forEach(t=>{this.dtTypes.Remove(t)})}this.dtTypes.forEach(o=>{let c=parseInt(o.AccountTypeID);1!=s&&(4!=e&&8!=e&&11!=e&&5!=e&&9!=e&&12!=e||4!=c&&8!=c&&11!=c&&5!=c&&9!=c&&12!=c)&&(1!=e&&2!=e&&7!=e&&10!=e&&13!=e&&15!=e&&3!=e&&6!=e&&14!=e&&16!=e||1!=c&&2!=c&&7!=c&&10!=c&&13!=c&&15!=e&&3!=c&&6!=c&&14!=c&&16!=e)||t.Items.push(i.d.ComboBoxItems_2(o.ResourceData,o.AccountTypeID))}),t.SelectedValue=0!=e?e.toString():o}else this.iAccountType=e;this.OnAccountTypeSelectionChanged(null)}OnLoad(){if(this.ButtonSave=new c.a,0==this.AccountID?n.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=n.a.SessionManager.IsActionAssigned(2,"Create"):this.ButtonSave.Enable=n.a.SessionManager.IsActionAssigned(2,"Create"):(this.ScreenObject.IsEdit=!0,n.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=n.a.SessionManager.IsActionAssigned(2,"Update"):this.ButtonSave.Enable=n.a.SessionManager.IsActionAssigned(2,"Update")),this.QuickAssign=new b.a,this.QuickAssign.QuickAssignGrid_1(2,this.ScreenObject.Data,this.obj.IsGroup),this.AccountCode=this.ScreenObject.GetQuickCode(238),this.AccountName=this.ScreenObject.GetQuickText(239),null!=this.AccountName&&this.AccountName.LostFocusCommand.Subscribe(this,"OnNameLostFocus"),this.Status=this.ScreenObject.GetQuickCombo(242),null!=this.Status&&(this.ScreenObject.Data.Tables[3].forEach(t=>{this.Status.Items.push(i.d.ComboBoxItems_2(t.Status.toString(),t.StatusID.toString()))}),this.ScreenObject.Data.Tables[3].length>0&&(this.Status.SelectedValue=this.ScreenObject.Data.Tables[3][0].StatusID.toString())),this.AccountType=this.ScreenObject.GetQuickCombo(241),null!=this.AccountType&&(this.ScreenObject.Data.Tables[4].forEach(t=>{this.AccountType.Items.push(i.d.ComboBoxItems_2(t.ResourceData.toString(),t.AccountTypeID.toString()))}),this.AccountType.SelectionChangedCommand.Subscribe(this,"OnAccountTypeSelectionChanged"),this.ControlType>1&&(this.AccountType.Enable=!1),this.OnAccountTypeSelectionChanged(null)),this.Group=this.ScreenObject.GetQuickField(247),null!=this.Group){if(this.IsControlAccounts)this.SetControlWhere(this.Group,this.ControlType);else if(this.ScreenObject.Data.Tables[4].length<14){let t="";this.ScreenObject.Data.Tables[4].forEach(e=>{t.length>0&&(t+=","),t+=e[Object.keys(e)[0]].toString()}),this.Group.CustomWhere="(A.AccountID=1 or A.AccountTypeID IN ("+t+"))"}this.Group.SelectionChangedCommand.Subscribe(this,"OnGroupSelectionChanged")}this.oCombo=this.ScreenObject.GetQuickCombo(252),null!=this.oCombo&&(this.oCombo.Items.push(i.d.ComboBoxItems_2(n.a.GetResource("Com_Yes"),"1")),this.oCombo.Items.push(i.d.ComboBoxItems_2(n.a.GetResource("Com_No"),"0")),this.obj.IsBillwise=Object(a.j)(n.a.SessionManager.Preferences.On),this.oCombo.SelectedValue=this.obj.IsBillwise?"1":"0"),this.oCombo=this.ScreenObject.GetQuickCombo(7082),null!=this.oCombo&&this.ScreenObject.Data.Tables[6].forEach(t=>{this.oCombo.Items.push(i.d.ComboBoxItems_2(t.Name.toString(),t.CurrencyID.toString()))}),this.oCombo=this.ScreenObject.GetQuickCombo(50393),null!=this.oCombo&&(this.oCombo.Items.push(i.d.ComboBoxItems_2("","")),this.ScreenObject.Data.Tables[7].forEach(t=>{this.oCombo.Items.push(i.d.ComboBoxItems_2(t.ProfileName.toString(),t.ProfileID.toString()))})),this.oCombo=this.ScreenObject.GetQuickCombo(890),null!=this.oCombo&&(this.oCombo.Items.push(i.d.ComboBoxItems_2("Normal","0")),this.oCombo.Items.push(i.d.ComboBoxItems_2("Daily","1")),this.oCombo.Items.push(i.d.ComboBoxItems_2("Monthly","2")))}SetControlWhere(t,e){let s="";1==e?s="#COATEE#":2==e?s="#DEBTORTEE#":3==e&&(s="#CREDITORTEE#"),t.CustomWhere=l.e.StringIsNullOrEmpty(t.CustomWhere)?s:"("+t.CustomWhere+") and "+s}AutoGenerateCode(){0==this.NodeID&&null!=this.AccountCode&&(this.obj.SelectedNodeID=null!=this.Group?this.Group.SelectedValue:this.ParentId,this.ScreenObject.SetAutoCode(this.AccountCode,this.obj.IsGroup,this.obj.SelectedNodeID,this.ScreenObject.Data.Tables[8]))}OnGroupSelectionChanged(t){this.Group.SelectedValue>0&&this.Group.SelectedValue.toString()!=this.Group.DefaultValue&&(this.Group.DefaultValue=this.Group.SelectedValue.toString(),this.FillAccountTypes(this.AccountType,n.a.accounting.GetAccountType(this.Group.SelectedValue),this.Group.SelectedValue),this.AutoGenerateCode(),this.LoadParentData())}OnAccountTypeSelectionChanged(t){null!=this.AccountType&&this.ScreenObject.SetViewByType(this.AccountType.SelectedValue,this.obj.IsGroup)}LoadEditData(){let t=n.a.accounting.GetAccountDetails(this.obj.AccountID);Object.assign(this.obj,t.obj),this.AccountID=this.obj.AccountID,this.QuickAssign.LoadGrid(this.obj.AccountID,t.Tables[12]),null!=this.AccountCode&&(this.AccountCode.Text=this.obj.AccountCode,(this.ScreenObject.InheritParentCode||this.ScreenObject.IsAutoCode)&&(this.AccountCode.Enable=parseInt(t.Tables[0][0].Depth)<=1&&!this.ScreenObject.IsRootAutoCode)),this.ScreenObject.FillControls(t.Tables[0][0],t.Tables[1][0],t.Tables[5].length>0?t.Tables[5][0]:null,null,t.Tables[17],t.Tables[4]),this.ScreenObject.CanApprove(t.Tables[0][0],t.Tables[13][0],this.ButtonSave),t.Tables[5].length>0&&this.ScreenObject.LoadCustomFieldsCCData(t.Tables[5],t.Tables[17]),n.a.SessionManager.IsOffline&&this.AccountID>0&&(this.ButtonSave.Visible=!1),null!=this.ScreenObject.StatusAssignGrid&&this.ScreenObject.StatusAssignGrid.Load(t.Tables[18]),null!=this.Group&&(this.Group.SelectedValue=parseInt(t.Tables[0][0].ParentID),this.Group.DefaultValue=this.Group.SelectedValue.toString()),this.ControlType>1&&((null!=this.AccountType&&2==this.ControlType&&"7"!=this.AccountType.SelectedValue||3==this.ControlType&&"6"!=this.AccountType.SelectedValue)&&(this.ButtonSave.Visible=!1),null!=this.AccountType&&(this.AccountType.Enable=!1)),null!=this.AccountType&&this.ScreenObject.SetViewByType(this.AccountType.SelectedValue,this.obj.IsGroup)}OnSaveAccount(t){if("Details"==t)n.a.page.ShowLoading=!0,setTimeout(()=>{n.a.page.HideDialog(),null!=this.AccountType&&(this.iAccountType=parseInt(this.AccountType.SelectedValue));let t=new h.AddEditAccountViewModel(this.obj.AccountID,this.obj.SelectedNodeID,this.ParentId,this.iAccountType.toString(),this.obj.IsGroup,this.ControlType),e={obj:t};null!=this.AccountName&&(t.AccountName.Text=this.AccountName.Text),null!=this.AccountCode&&(t.AccountCode.Text=this.AccountCode.Text,t.AccountCode.PrefixCode=this.AccountCode.PrefixCode),t.OnGroupSelectionChanged("Group"),t.ScreenObject.CopyQuickToDetail(this.ScreenObject.StaticFields,[null!=this.AccountCode?this.AccountCode.DBColumnID:0,null!=this.AccountName?this.AccountName.DBColumnID:0]),t.OnGroupSelectionChanged("Type"),n.a.page.addNewTab({title:"Account Edit",component:u.AddEditAccountComponent,params:e})},50);else if("ShowApprove"==t){let t=new S.a(2,this.AccountID,this.ScreenObject,this);n.a.page.ShowDialog(t,A.a,{ShowCenter:!0,Title:n.a.GetResource("ApproveReject")})}else try{this.SaveMethod(t)}catch(e){n.a.SessionManager.Logger.ErrorLog("QuickAddAccountScreenViewModel:: OnSaveAccount"+e.stack)}}SaveMethod(t){if(this.DisplayMessage=this.ScreenObject.ValidateData(),!(this.DisplayMessage.length>0))if(null==this.Group||!this.IsControlAccounts||0!=this.Group.SelectedValue&&1!=this.Group.SelectedValue||(2==this.ControlType?(this.ParentId=parseInt(n.a.SessionManager.Preferences.DebtorsControlGroup),this.Group.SelectedValue=this.ParentId):3==this.ControlType&&(this.ParentId=parseInt(n.a.SessionManager.Preferences.CreditorsControlGroup),this.Group.SelectedValue=this.ParentId)),0==this.obj.AccountID){if(null!=this.AccountCode&&(this.obj.AccountCode=this.AccountCode.Text),null!=this.AccountName&&(this.obj.AccountName=this.AccountName.Text),this.obj.AliasName=this.ScreenObject.GetTextComboValue_string(240,this.obj.AccountName),this.obj.AccountTypeID=null==this.AccountType||l.e.StringIsNullOrEmpty(this.AccountType.SelectedValue)?this.iAccountType:parseInt(this.AccountType.SelectedValue),this.obj.StatusID=n.a.SessionManager.IsActionAssigned(2,"DefaultInActive")?this.ScreenObject.GetTextComboValue_int(242,34):this.ScreenObject.GetTextComboValue_int(242,33),this.obj.CreditDays=this.ScreenObject.GetTextComboValue_int(248,0),this.obj.CreditLimit=this.ScreenObject.GetTextComboValue_double(249,0),this.obj.DebitDays=this.ScreenObject.GetTextComboValue_int(7081,0),this.obj.Debitlimit=this.ScreenObject.GetTextComboValue_double(7080,0),this.obj.IsGroup||0!=this.obj.AccountID||(this.obj.IsBillwise=6==this.obj.AccountTypeID||7==this.obj.AccountTypeID,this.obj.SelectedNodeID=null!=this.Group?this.Group.SelectedValue:this.ParentId,null!=this.AccountType&&(this.AccountType.SelectedValue=this.obj.AccountTypeID.toString())),this.oCombo=this.ScreenObject.GetQuickCombo(252),null!=this.oCombo&&(this.obj.IsBillwise="1"==this.oCombo.SelectedValue),null!=this.AccountCode){let t={StrCode:this.obj.AccountCode,CodePrefix:this.obj.CodePrefix,CodeNumber:this.obj.CodeNumber};if(this.DisplayMessage=this.ScreenObject.SetAutoCodeParams_3(this.AccountCode,this.obj.SelectedNodeID,this.ScreenObject.Data.Tables[8],t),this.obj.AccountCode=t.StrCode,this.obj.CodePrefix=t.CodePrefix,this.obj.CodeNumber=t.CodeNumber,this.DisplayMessage.length>0)return}this.obj.IsGroup||(this.obj.PurchaseAccount=this.ScreenObject.GetPactListValue(250,2),this.obj.SalesAccount=this.ScreenObject.GetPactListValue(251,3),this.obj.COGSAccount=this.ScreenObject.GetPactListValue(23845,4),this.obj.ClosingStkAccount=this.ScreenObject.GetPactListValue(23846,5),this.obj.PDCReceivableAccount=this.ScreenObject.GetPactListValue(26581,0),this.obj.PDCPayableAccount=this.ScreenObject.GetPactListValue(26582,0),this.obj.PaymentTerms=this.ScreenObject.GetTextComboValue_int(50393,0),this.obj.LetterofCredit=this.ScreenObject.GetTextComboValue_double(53357,0),this.obj.TrustReceipt=this.ScreenObject.GetTextComboValue_double(53358,0),this.obj.TrustReceiptAccount=this.ScreenObject.GetPactListValue(53526,0),this.obj.MarginAccount=this.ScreenObject.GetPactListValue(53527,0),this.obj.Currency=this.ScreenObject.GetTextComboValue_int(7082,1)),this.obj.TB=0,this.obj.PL=0,this.obj.BS=0,this.obj.PLT=0,this.obj.CustomFieldsQuery=this.ScreenObject.GetQuickExtraFieldsQuery(),this.obj.CustomCostCenterFieldsQuery=this.ScreenObject.GetQuickExtraCCFieldsQuery(),this.obj.HistoryXML=this.ScreenObject.HistoryCCXML,this.obj.StatusXML=null!=this.ScreenObject.StatusAssignGrid?this.ScreenObject.StatusAssignGrid.GetXML():"",this.obj.ContactsXML="",this.obj.NotesXML="",this.obj.AttachmetsXML=this.ScreenObject.GetExtraAttachmentXML(),this.obj.AddressXML="",this.obj.IsCode=!1;let t={};if(this.DisplayMessage=this.QuickAssign.GetXML(t),this.obj.CCMapXML=t.strXML,!l.e.StringIsNullOrEmpty(this.DisplayMessage))return;if(!this.ScreenObject.ValidateDataonSave())return;let s={Message:""};if(!this.obj.IsGroup&&!this.ScreenObject.ValidateGSTRules(this.obj.AccountTypeID,s))return this.DisplayMessage=s.Message,void(this.MessageVisibility=!0);var e=this.ScreenObject.StaticFields.find(t=>26721==t.DBColumnID);this.obj.GroupSeqNoLength=e&&this.obj.IsGroup?parseInt(e.Text):0,this.obj.WID=this.ScreenObject.CheckWorkFlow(),n.a.accounting.SaveAccount(this.obj,"SaveAccount").subscribe(t=>{this.SaveCallBack(t)},t=>{console.log("Quick Account Save : "+JSON.stringify(t))})}else{let t=this.ScreenObject.GetStaticFieldsQuery();null!=this.AccountCode&&(this.obj.AccountCode=this.AccountCode.Text),null!=this.AccountName&&(this.obj.AccountName=this.AccountName.Text),this.obj.StaticFieldsQuery=t,this.obj.CustomFieldsQuery=this.ScreenObject.GetQuickExtraFieldsQuery(),this.obj.CustomCostCenterFieldsQuery=this.ScreenObject.GetQuickExtraCCFieldsQuery(),this.obj.HistoryXML=this.ScreenObject.HistoryCCXML,this.obj.StatusXML=null!=this.ScreenObject.StatusAssignGrid?this.ScreenObject.StatusAssignGrid.GetXML():"";let e={};if(this.DisplayMessage=this.QuickAssign.GetXML(e),this.obj.CCMapXML=e.strXML,!l.e.StringIsNullOrEmpty(this.DisplayMessage))return;if(!this.ScreenObject.ValidateDataonSave())return;let s={Message:""};if(!this.obj.IsGroup&&!this.ScreenObject.ValidateGSTRules(this.obj.AccountTypeID,s))return this.DisplayMessage=s.Message,void(this.MessageVisibility=!0);this.obj.WID=this.ScreenObject.CheckWorkFlow(),n.a.accounting.SaveAccount(this.obj,"SaveAccountQuick").subscribe(t=>{this.SaveCallBack(t)},t=>{alert(JSON.stringify(t)),console.log("Quick Account Save : "+JSON.stringify(t))})}}SaveCallBack(t){t.Message&&(this.DisplayMessage=t.Message,this.RetValue=t.RetValue,(this.RetValue>0||this.RetValue<-1e4)&&(this.AccountID=0,this.QuickAssign.Clear(),this.ScreenObject.Clear(),this.Title=n.a.GetResource(this.obj.IsGroup?"Account_AddGroup":"Account_AddAccount"),this.AccountCode&&(this.AccountCode.Text=""),this.Group&&(this.Group.SelectedValue=this.ParentId),this.AutoGenerateCode(),this.LoadParentData()),this.Parent&&(this.Parent.obj.SelectedNode&&(this.Parent.obj.SetFocusNodeID=this.Parent.obj.SelectedNode.Id),this.Parent.Refresh()))}OnNameLostFocus(t){if(!l.e.StringIsNullOrEmpty(this.AccountName.Text)){let t=this.iAccountType;null!=this.AccountType&&(t=this.AccountType.Visible&&this.AccountType.Enable?parseInt(this.AccountType.SelectedValue):0==this.AccountID?parseInt(this.AccountType.DefaultValue):this.obj.AccountTypeID)}this.ScreenObject.onTextBoxLostFocus(t)}LoadParentData(){if(this.ScreenObject.dsParentData=null,0!=this.NodeID||0==this.ParentId||this.obj.IsGroup)return;let t=this.ScreenObject.Data.Tables[5].filter(t=>"Copygroupdatatonode"==t.Name);0!=t.Length&&""!=t[0].Value.toString()&&Object(a.j)(t[0].Value)&&(this.ScreenObject.dsParentData=n.a.accounting.GetCopyAccountDetails(this.ParentId),0!=this.ScreenObject.dsParentData.Tables[0].length?this.ScreenObject.FillParentData(this.ScreenObject.dsParentData.Tables[0][0],this.ScreenObject.dsParentData.Tables[1][0],this.ScreenObject.dsParentData.Tables[5][0],["AccountCode","AccountName","AccountGroup","IsGroup"]):this.ScreenObject.dsParentData=null)}}class p{constructor(){this.IsCOA=!1,this.IsCustomer=!1,this.IsVendor=!1,this.ControlType=0,this.ControlAccounts=new d.b,this.ControlAccounts.Items.push(new d.a("Chart of Account",1,"ctrlAccount")),this.ControlAccounts.Items.push(new d.a("Accounts Receivable",2,"ctrlAccount")),this.ControlAccounts.Items.push(new d.a("Accounts Payable",3,"ctrlAccount")),n.a.SessionManager.IsActionAssigned(2,"Read")||(this.ControlAccounts.Items[0].Visible=!1),n.a.SessionManager.IsActionAssigned(2,"Accounts Receivable")||(this.ControlAccounts.Items[1].Visible=!1),n.a.SessionManager.IsActionAssigned(2,"Accounts Payable")||(this.ControlAccounts.Items[2].Visible=!1),this.ControlAccounts.Items[0].Label="Chart of Account",this.ControlAccounts.Items[1].Label="Accounts Receivable",this.ControlAccounts.Items[2].Label="Accounts Payable";var t=this.ControlAccounts.Items.filter(t=>1==t.Visible);if(1==t.length&&(this.ControlType=t[0].FeatureID),n.a.SessionManager.PersonalSettings.ContainsKey("ControlAccountType")){let t=parseInt(n.a.SessionManager.PersonalSettings.ControlAccountType);t>0&&this.ControlAccounts.Items[t-1].Visible&&(this.ControlAccounts.Items[t-1].IsChecked=!0)}}OnButtonClick(t){"OK"==t?(this.ControlAccounts.Items[0].IsChecked?this.ControlType=1:this.ControlAccounts.Items[1].IsChecked?this.ControlType=2:this.ControlAccounts.Items[2].IsChecked&&(this.ControlType=3),this.ControlType>0&&l.e.SetPersonalize("ControlAccountType",this.ControlType.toString()),n.a.page.HideDialog()):(this.ControlType=0,n.a.page.HideDialog())}}}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{mQEZ:function(t,e,s){"use strict";s.r(e),s.d(e,"AddEditAccountViewModel",(function(){return x}));var i=s("mrSG"),o=s("ScVY"),a=s("EQd/"),n=s("0/4Q"),h=s("VxiT"),l=s("n56n"),c=s("NkMH"),r=s("bgvB"),u=s("MCLT"),d=s("4ADR"),b=s("INyF"),C=s("BCIC"),p=s("ZKrh"),m=s("Lp6j"),D=s("eQJW"),S=s("Do2H"),A=s("THE7"),g=s("vVAv"),I=s("RJs6"),T=s("OvA8");class y{constructor(t,e,s){this.FinalReportsFields=[],this.oCombo=null}FinalReportsViewModel_1(){}FinalReportsViewModel(t){this.oCombo=new n.e(0),this.oCombo.Label=S.a.GetResource("FR_TB"),this.oCombo.DBColumnName="-1",this.oCombo.Row=0,this.oCombo.Column=0,this.oCombo.Width="250",this.oCombo.ColumnSpan=2,this.FillCombo(this.oCombo),this.FinalReportsFields.push(this.oCombo),this.oCombo=new n.e(0),this.oCombo.Label=S.a.GetResource("FR_BS"),this.oCombo.DBColumnName="-2",this.oCombo.ColumnSpan=2,this.oCombo.Row=0,this.oCombo.Column=2,this.FillCombo(this.oCombo),this.FinalReportsFields.push(this.oCombo),this.oCombo=new n.e(0),this.oCombo.Label=S.a.GetResource("FR_PL"),this.oCombo.DBColumnName="-3",this.oCombo.ColumnSpan=2,this.oCombo.Row=1,this.oCombo.Column=0,this.FillCombo(this.oCombo),this.FinalReportsFields.push(this.oCombo),this.oCombo=new n.e(0),this.oCombo.Label=S.a.GetResource("FR_PLT"),this.oCombo.DBColumnName="-4",this.oCombo.ColumnSpan=2,this.oCombo.Row=1,this.oCombo.Column=2,this.FillCombo(this.oCombo),this.FinalReportsFields.push(this.oCombo)}FillCombo(t){t.Items.push(n.d.ComboBoxItems_2("Detailed","0")),t.Items.push(n.d.ComboBoxItems_2("Summary","1")),"-1"==t.DBColumnName&&t.Items.push(n.d.ComboBoxItems_2("Summary(Net Balance)","2")),t.SelectedValue=t.Items[0].Value}LoadData(t){null!=t[0].TB_INT.toString()&&""!=t[0].TB_INT.toString()&&(this.oCombo=this.FinalReportsFields[0],this.oCombo.SelectedValue=parseInt(t[0].TB_INT).toString()),null!=t[0].BS.toString()&&""!=t[0].BS.toString()&&(this.oCombo=this.FinalReportsFields[1],this.oCombo.SelectedValue=Object(D.j)(t[0].BS.toString())?"1":"0"),null!=t[0].PL.toString()&&""!=t[0].PL.toString()&&(this.oCombo=this.FinalReportsFields[2],this.oCombo.SelectedValue=Object(D.j)(t[0].PL.toString())?"1":"0"),null!=t[0].PLT.toString()&&""!=t[0].PLT.toString()&&(this.oCombo=this.FinalReportsFields[3],this.oCombo.SelectedValue=Object(D.j)(t[0].PLT.toString())?"1":"0")}}var V=s("knKa"),j=s("4HhE"),P=s("wJuo"),M=s("x68t"),w=s("NXvD"),L=s("ddhY"),R=s("iqoD"),f=s("++IR"),F=s("4k0m"),N=s("V7Sd"),O=s("xnJf");class x extends o.b{constructor(t,e,s,i,o,c){if(super(),this.CostCenterID=2,this.RetValue=0,this.ParentFeatureID=0,this.PNodeID=0,this.NextPrevID=0,this.DialogResult=!1,this.CCMapVisibility=!1,this.PrintVisible=!1,this.ViewCCMapping=null,this.LocDivWiseCreditDebit=null,this.rptccid=0,this.RptTemplate=null,this.CCMap=null,this.FileID=0,this.IsPhotoDelete=!1,this.IsPhotoChanged=!1,this.IsAttachmentMandatory=!1,this.DetailsVisibility=!1,this.IsImageSaved=!1,this.ActualFileName="",this.AccountPhoto=null,this.PhotoTextVisibility=!1,this.ContactVisibility=!1,this.FinalReportsVisibility=!1,this.PrimaryVisibility=!1,this.PbtnVisible=!1,this.ContactExpanded=!1,this.AttachmentExpanded=!1,this.NoteExpanded=!1,this.ChequeDiscount=!1,this.NoteVisibility=!1,this.NextPreviousVisibility=!0,this.AttachmentVisibility=!1,this.AddressVisibility=!1,this.Parent=null,this.obj={},this.ScreenObject=new h.a,this.ParentId=0,this.AccountImage=new r.b,this.AccountName=a.d.PactTextBoxData_1(239),this.AccountCode=a.a.PactCodeData_1(238),this.AliasName=a.d.PactTextBoxData_1(240),this.AccountType=n.e.PactComboBoxData1(241),this.Status=n.e.PactComboBoxData1(242),this.Group=l.b.PactListBoxData_1(247),this.PurchaseAccount=new l.a(250),this.TrustReceiptAccount=l.b.PactListBoxData_1(53526),this.MarginAccount=l.b.PactListBoxData_1(53527),this.SalesAccount=new l.a(251),this.COGSAccount=new l.a(23845),this.ClosingStockAccount=new l.a(23846),this.PDCPayableAccount=l.b.PactListBoxData_1(26582),this.PDCReceivableAccount=l.b.PactListBoxData_1(26581),this.IsDrCr=n.e.PactComboBoxData4(-2,!1),this.BillWise=n.e.PactComboBoxData1(252),this.Currency=l.b.PactListBoxData_1(7082),this.drpDebitDays=n.e.PactComboBoxData1(555297),this.DistCost=new n.e(243),this.drpCreditDays=n.e.PactComboBoxData1(555296),this.PaymentTerms=n.e.PactComboBoxData1(50393),this.GLClubTranBy=n.e.PactComboBoxData1(890),this.LetterofCredit=a.d.PactTextBoxData_1(53357),this.TrustReceipt=a.d.PactTextBoxData_1(53358),this._AccountID=0,this.CreditLimit=a.d.PactTextBoxData_1(249),this.CreditDays=a.d.PactTextBoxData_1(248),this.DebitLimit=a.d.PactTextBoxData_1(7080),this.DebitDays=a.d.PactTextBoxData_1(7081),this.TabWidth=0,this.AddressTypes=null,this.Address1="",this.Address2="",this.Address3="",this.City="",this.TabSelectedIndex=0,this.State="",this.Country="",this.Pin="",this.Phone1="",this.Phone2="",this.Fax="",this.Email1="",this.Email2="",this.URL="",this.dtTypes=null,this.guid="",this.FileExtension="",this.ControlType=0,this.IsControlAccounts=!1,this.ButtonEnable=!0,this.oFinalTab=null,this.ds=null,this.ChequeFields=[],this.ClassName="AddEditAccountViewModel",this.ScreenObject.ExculdeStaticFieldIds=[555296,555297,-2],this.AccountImage.RowSpan=3,this.AccountImage.Row=0,this.AccountImage.Column=3,this.obj.IsGroup=o,!Object(u.isUndefined)(S.a.SessionManager.Preferences.IsControlAccounts)&&"TRUE"==S.a.SessionManager.Preferences.IsControlAccounts.toUpperCase()&&(this.IsControlAccounts=!0,0==c&&(c=1,0!=t))){let e=S.a.common.GetDataTable("ACC001",t.toString());if(e.length>0){let t=parseInt(e[0].AccountTypeID);7==t?c=2:6==t&&(c=3)}}this.ControlType=c,this.AccountType.SelectionChangedCommand.Subscribe(this,"OnGroupSelectionChanged"),this.Group.SelectionChangedCommand.Subscribe(this,"OnGroupSelectionChanged"),this.Load(t,e,s,i)}get AccountID(){return this._AccountID}set AccountID(t){this._AccountID=t,this.obj.AccountID=t}onTabSelectionChanged(t){}OnComboChange(t){console.log(t)}OnPListChange(t){console.log("OnPListChange event from Add edit Account"),console.log(t)}LoadParentData(){if(0!=this.AccountID||0==this.ParentId||this.obj.IsGroup)return;let t=this.ScreenObject.Data.Tables[5].filter(t=>"Copygroupdatatonode"==t.Name);if(0==t.length||""==t[0].Value.toString()||!Object(D.j)(t[0].Value))return;let e=S.a.accounting.GetCopyAccountDetails(this.ParentId);if(0!=e.Tables[0].length&&(this.ScreenObject.FillParentData(e.Tables[0][0],e.Tables[1][0],e.Tables[5][0],["AccountCode","AccountName","AccountGroup","IsGroup"]),t=this.ScreenObject.Data.Tables[5].filter(t=>"CopyGroupTabs"==t.Name),t.length>0&&""!=t[0].Value.toString())){let s=t[0].Value.toString().split(";");if(null!=s&&s.length>0)for(let i=0;i<s.length;i++)if(t=this.ScreenObject.Data.Tables[this.ScreenObject.Data.Tables.length-1].filter(t=>t.CCTabID==s[i]),t.length>0&&""!=t[0].CCTabName.toString())switch(t[0].CCTabName.toString()){case"Notes":e.Tables[3].length>0&&this.ViewNotes.LoadNotes(e.Tables[3]);break;case"Attachments":e.Tables[4].length>0&&this.ViewAttachments.LoadAttachments(e.Tables[4]);break;case"Assign":let s=Array.from(new Set(this.ScreenObject.Data.Tables[this.ScreenObject.Data.Tables.length-1].map(t=>t.QuickViewCCID)));m.e.StringIsNullOrEmpty(s)&&(s=["0"]);let i=e.Tables[9].filter((function(t){return!s.includes(t.CostCenterId.toString())}));i.length>0&&this.ViewCCMapping.LoadData(i,e.Columns[9]),this.ViewCCMapping.TempData=[];break;case"Contacts":e.Tables[2].length>0&&(e.Tables[2].forEach(t=>{t.ContactID=0}),this.ViewContacts.LoadContacts(e.Tables[2],e.Columns[2]));break;case"Address":e.Tables[7].length>0&&(e.Tables[7].forEach(t=>{t.AddressID=0}),this.ViewAddress.LoadContacts(e.Tables[7]));break;case"Credit & Debit":null!=e&&e.Tables.length>11&&e.Tables[11].length>0&&(e.Tables[11].Columns.ID.Expression="0",this.LocDivWiseCreditDebit.LoadXML(e.Tables[11]));break;case"Final Reports":this.FinalReportsViewModel.LoadData(e.Tables[0]);break;case"Report Template":null!=e&&e.Tables.length>14&&null!=this.RptTemplate&&(this.RptTemplate.tempTable=e.Tables[14],e.Tables[15].Columns.TemplateNodeID.Expression="0",this.RptTemplate.LoadXML(e.Tables[15]));break;default:parseInt(t[0].QuickViewCCID.toString())}}}Load(t,e,s,i){if(this.ButtonSave=new c.a,this.ButtonCustomize=new c.a,this.ButtonQuery=new c.a,this.ButtonEIDRead=new c.a,this.AccountID=t,0==this.AccountID?S.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=S.a.SessionManager.IsActionAssigned(2,"Create"):this.ButtonSave.Enable=S.a.SessionManager.IsActionAssigned(2,"Create"):(this.ScreenObject.IsEdit=!0,S.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=S.a.SessionManager.IsActionAssigned(2,"Update"):this.ButtonSave.Enable=S.a.SessionManager.IsActionAssigned(2,"Update")),S.a.SessionManager.HideUnathorizedAccess?this.ButtonCustomize.Visible=S.a.SessionManager.IsActionAssigned(2,"Customize"):this.ButtonCustomize.Enable=S.a.SessionManager.IsActionAssigned(2,"Customize"),S.a.SessionManager.HideUnathorizedAccess?this.ButtonQuery.Visible=S.a.SessionManager.IsActionAssigned(2,"Query"):this.ButtonQuery.Enable=S.a.SessionManager.IsActionAssigned(2,"Query"),S.a.SessionManager.HideUnathorizedAccess?this.ButtonEIDRead.Visible=S.a.SessionManager.IsActionAssigned(2,"EIDRead"):this.ButtonEIDRead.Enable=S.a.SessionManager.IsActionAssigned(2,"EIDRead"),S.a.SessionManager.Preferences.ContainsKey("ACCEIDMapping")&&""!=S.a.SessionManager.Preferences.ACCEIDMapping.toString()||(this.ButtonEIDRead.Visible=!1),this.CostCenterID=2,0!=this.AccountID&&(this.PrintVisible=!0),this.obj.AccountID=this.AccountID,this.RefreshTitle(),this.ViewContacts=new A.a(this),this.ViewNotes=new I.a(this,S.a.SessionManager,S.a.admin),this.FinalReportsViewModel=new y(this,S.a.SessionManager,S.a.admin),this.FinalReportsViewModel.FinalReportsViewModel(!0),this.StatusAssignGrid=new w.a,this.Status.LblClick=new j.b,this.Status.LblClick.Subscribe(this,"OnSaveAccount","ShowStatusAssignGrid"),""!=S.a.SessionManager.Preferences["Report Template Dimension"]&&"0"!=S.a.SessionManager.Preferences["Report Template Dimension"].toString()&&(this.rptccid=parseInt(S.a.SessionManager.Preferences["Report Template Dimension"].toString())),this.rptccid>0&&(this.RptTemplate=new C.a(this,this.rptccid)),this.ViewAttachments=new T.ViewAttachmentViewModel(this,S.a.SessionManager,S.a.admin),this.ViewAddress=new b.a(this),this.Address=new R.a,this.Address.AddAddressViewModel_2(this),this.ViewCCMapping=new g.a(this),this.ViewCCMapping.ViewCCMappingViewModel_1(this,2,this.AccountID),this.DropFile=new j.b,this.DropFile.Subscribe(this,"OnDropPhoto"),this.IsPhotoChanged=!1,this.PhotoTextVisibility=!0,this.AccountPhoto="",this.ActualFileName="",this.OnLoad(i),null!=this.Group)if(this.IsControlAccounts)this.SetControlWhere(this.Group,this.ControlType);else if(this.dtTypes.length<14){let t="";this.dtTypes.forEach(e=>{t.length>0&&(t+=","),t+=e.AccountTypeID.toString()}),this.Group.CustomWhere="(A.AccountID=1 or A.AccountTypeID IN ("+t+"))"}m.e.StringIsNullOrEmpty(this.AccountType.SelectedValue)||2!=parseInt(this.AccountType.SelectedValue)&&3!=parseInt(this.AccountType.SelectedValue)?(this.TrustReceiptAccount.Visible=!1,this.MarginAccount.Visible=!1):(this.TrustReceiptAccount.Visible=!0,this.MarginAccount.Visible=!0),this.CreditDays.drp=this.drpCreditDays,this.DebitDays.drp=this.drpDebitDays,0==this.DistCost.Items.length&&(this.DistCost.Items.push(n.d.ComboBoxItems_2("NO","0")),this.DistCost.Items.push(n.d.ComboBoxItems_2("YES","1"))),0==this.drpCreditDays.Items.length&&0==this.drpDebitDays.Items.length&&(this.drpCreditDays.Items.push(n.d.ComboBoxItems_2("Due Date","0")),this.drpCreditDays.Items.push(n.d.ComboBoxItems_2("First Day of Month","1")),this.drpCreditDays.Items.push(n.d.ComboBoxItems_2("Last Day of Month","2")),this.drpCreditDays.Items.push(n.d.ComboBoxItems_2("BillingCycle","3")),this.drpCreditDays.Items.push(n.d.ComboBoxItems_2("Due date as First Day of Month","4")),this.drpCreditDays.Items.push(n.d.ComboBoxItems_2("Due date as Last Day of Month","5")),this.drpCreditDays.Items.push(n.d.ComboBoxItems_2("Doc date as First Day of Month","6")),this.drpCreditDays.Items.push(n.d.ComboBoxItems_2("Doc date as Last Day of Month","7")),this.drpDebitDays.Items.push(n.d.ComboBoxItems_2("Due Date","0")),this.drpDebitDays.Items.push(n.d.ComboBoxItems_2("First Day of Month","1")),this.drpDebitDays.Items.push(n.d.ComboBoxItems_2("Last Day of Month","2")),this.drpDebitDays.Items.push(n.d.ComboBoxItems_2("BillingCycle","3")),this.drpDebitDays.Items.push(n.d.ComboBoxItems_2("Due date as First Day of Month","4")),this.drpDebitDays.Items.push(n.d.ComboBoxItems_2("Due date as Last Day of Month","5")),this.drpDebitDays.Items.push(n.d.ComboBoxItems_2("Doc date as First Day of Month","6")),this.drpDebitDays.Items.push(n.d.ComboBoxItems_2("Doc date as Last Day of Month","7"))),0==this.obj.AccountID&&(this.drpCreditDays.SelectedValue="0",this.drpDebitDays.SelectedValue="0",this.DistCost.SelectedValue="0",s>0&&(this.ParentId=s,this.Group.SelectedValue=s),0!=e&&(this.obj.SelectedNodeID=e,this.Group.SelectedValue=e),this.AutoGenerateCode()),this.AccountName.LostFocusCommand.Subscribe(this,"OnNameLostFocus"),this.Group.SelectionChangedCommand.Subscribe(this,"OnGroupSelectionChanged"),this.onGetData=this.GetRecords,S.a.SessionManager.IsActionAssigned(2,"DefaultInActive")&&(this.Status.DefaultValue="34",0==this.AccountID&&(this.Status.SelectedValue="34")),this.ContactVisibility=!1,this.MessageVisibility=!1,this.DetailsVisibility=!1,this.AddressVisibility=!1,this.DisplayName=this.Title}SetControlWhere(t,e){let s="";1==e?s="#COATEE#":2==e?s="#DEBTORTEE#":3==e&&(s="#CREDITORTEE#"),t.CustomWhere=m.e.StringIsNullOrEmpty(t.CustomWhere)?s:"("+t.CustomWhere+") and "+s}GetRecords(t){this.ButtonSave.Enable||(this.ButtonSave.Enable=!0);let e=0,s=!1;this.ControlType=null==this.ControlType?0:this.ControlType,"NEXT"==t.toUpperCase()?s=!0:"PREVIOUS"==t.toUpperCase()&&(s=!1),null!=this.ViewCCMapping&&this.ViewCCMapping.Clear();let i=S.a.common.GetNextPreviousRecords(2,this.NextPrevID,s,this.ControlType,this.obj.IsGroup?1:0);null!=i&&i.Tables.length>0&&i.Tables[0].length>0&&(e=parseInt(i.Tables[0][0].AccountID),e>0&&(this.NextPrevID=e,this.obj.AccountID=e,this.obj.IsGroup=Object(D.j)(i.Tables[0][0].IsGroup),this.RefreshTitle(),this.LoadEditData(),this.PNodeID=e,this.RefreshControls(),this.obj.IsGroup?0==this.ScreenObject.CustomTab.Pages.filter(t=>982==t.DBColumnID).length&&(0==this.oFinalTab.Fields.length&&this.oFinalTab.Fields.push(y),this.ScreenObject.CustomTab.Pages.push(this.oFinalTab)):this.ScreenObject.CustomTab.Pages.filter(t=>982==t.DBColumnID).length>0&&this.ScreenObject.CustomTab.Pages.Remove(this.oFinalTab)))}RefreshControls(){this.NoteVisibility?this.ViewNotes.OnShowNewNote(null):this.AttachmentVisibility?this.ViewAttachments.OnShowNewAttachment(null):this.ContactVisibility?(this.Contact=null,this.ViewContacts.OnShowNewContact(null)):this.AddressVisibility?(this.Address=null,this.ViewAddress.OnShowNewAddress(null)):this.CCMapVisibility&&this.ViewCCMapping.OnShowCC(null)}AutoGenerateCode(){0==this.AccountID&&(this.obj.SelectedNodeID=this.Group.SelectedValue>0?this.Group.SelectedValue:this.ParentId,this.ScreenObject.SetAutoCode(this.AccountCode,this.obj.IsGroup,this.obj.SelectedNodeID,this.ScreenObject.Data.Tables[8]))}onSave(){Logger.InfoLog("AddProductViewModel::Entering onSavecc"),Logger.InfoLog("AddProductViewModel::Entering onSavecc")}AssignRowColumns(){let t;t=this.ScreenObject.CustomFields.length;for(let e=0;e<t;e++)this.ScreenObject.CustomFields[e].Row=e/4,this.ScreenObject.CustomFields[e].Column=e%4}OnLoad(t){this.BillWise.Items.push(n.d.ComboBoxItems_2(S.a.GetResource("Com_Yes"),"1")),this.BillWise.Items.push(n.d.ComboBoxItems_2(S.a.GetResource("Com_No"),"0")),this.IsDrCr.Items.push(n.d.ComboBoxItems_2(S.a.GetResource("Com_Yes"),"1")),this.IsDrCr.Items.push(n.d.ComboBoxItems_2(S.a.GetResource("Com_No"),"0")),this.ScreenObject.LoadScreen_1(this,2,this.obj.IsGroup),this.ScreenObject.CustomTab.OnTabChange.Subscribe(this,"onTabSelectionChanged"),this.LocDivWiseCreditDebit=new p.a(this),this.ScreenObject.CustomTab.Pages.forEach(t=>{"Contacts"==t.Name&&(this.PrimaryContact=new V.a,this.PrimaryContact.QuickAddContactViewModel_2(this),this.PrimaryContact.IsPrimaryContact=!0,this.PrimaryContact.Visiblebtns=!1,this.PrimaryContact.Countryvisible=!0,this.PrimaryVisibility=!0)});let e=this.ScreenObject.Data.Tables[5].filter(t=>"CapsLock"==t.Name);if(e.length>0&&Object(D.j)(e[0].Value)&&(this.AccountName.IsAllCaps=!0),e=this.ScreenObject.Data.Tables[5].filter(t=>"CapsToFirstLetter"==t.Name),e.length>0&&Object(D.j)(e[0].Value)&&(this.AccountName.IsFirstLetterCaps=!0),e=this.ScreenObject.Data.Tables[5].filter(t=>"AttachmentMandatory"==t.Name),e.length>0&&Object(D.j)(e[0].Value)&&(this.IsAttachmentMandatory=!0),e=this.ScreenObject.Data.Tables[5].filter(t=>"AttachementThumbnail"==t.Name),e.length>0&&Object(D.j)(e[0].Value)&&(this.ViewAttachments.GridView=!0),(2==this.ControlType||3==this.ControlType)&&"TRUE"==S.a.SessionManager.Preferences.IsControlAccounts.toUpperCase()){this.IsDrCr.Enable=!0,this.IsDrCr.Visible=!0,this.IsDrCr.Label="Show in Both Types";let t=this.ScreenObject.Data.Tables[0].filter(t=>null==t.SectionID&&1==t.IsVisible).Compute("max","RowNo");if(null!=t){var s=this.ScreenObject.Data.Tables[0].filter(e=>null==e.SectionID&&1==e.IsVisible&&e.RowNo==t).Compute("max","ColumnNo");null!=s&&(parseInt(s)>=3?(t=parseInt(t)+1,s="0"):s=parseInt(s)+1),this.IsDrCr.Column=s.toString(),this.IsDrCr.Row=t.toString()}}this.obj.IsBillwise=Object(D.j)(S.a.SessionManager.Preferences.On.toString()),this.BillWise.SelectedValue=this.obj.IsBillwise?"1":"0",this.AssignRowColumns(),null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>8&&this.ScreenObject.Data.Tables[8].length>0&&this.ScreenObject.Data.Columns[8].Contains("IsParentCodeInherited")&&this.ScreenObject.InitAutoCode(this.ScreenObject.Data.Tables[8],this.obj.IsGroup),S.a.SessionManager.Preferences["Intermediate PDC"]&&Object(D.j)(S.a.SessionManager.Preferences["Intermediate PDC"])?(this.PDCReceivableAccount.Visible=!0,this.PDCPayableAccount.Visible=!0):(this.PDCReceivableAccount.Visible=!1,this.PDCPayableAccount.Visible=!1),0==this.AccountID?(this.ScreenObject.SetView(this.PDCPayableAccount,!1),this.ScreenObject.SetView(this.PDCReceivableAccount,!1)):(this.ScreenObject.SetView(this.PDCPayableAccount,!0),this.ScreenObject.SetView(this.PDCReceivableAccount,!0)),this.ChequeDiscount=!1;let i=null,o=null;o=l.b.PactListBoxData_1(0),o.Label=S.a.GetResource("CD_PDCAC"),o.DBColumnName="-1",o.ColumnSpan=2,o.Row=0,o.Column=0,o.CCID=2,o.TypeID=2,o.ColumnSpan=2,o.DataType="",this.ChequeFields.push(o),i=new a.d,i.Label=S.a.GetResource("CD_IR"),i.DBColumnName="-1",i.ColumnSpan=2,i.Row=0,i.Column=2,i.Text="0",i.DataType="FLOAT",this.ChequeFields.push(i),i=new a.d,i.Label=S.a.GetResource("CD_CR"),i.DBColumnName="-1",i.Row=1,i.Column=0,i.Text="0",i.ColumnSpan=2,i.DataType="FLOAT",this.ChequeFields.push(i),i=new a.d,i.Label=S.a.GetResource("CD_CDL"),i.DBColumnName="-1",i.Row=1,i.Column=2,i.Text="0",i.ColumnSpan=2,i.DataType="FLOAT",this.ChequeFields.push(i),this.ScreenObject.CustomTab.Pages.forEach(t=>{if("General"==t.Name)for(let e=0;e<t.Fields.length;e++){let s=t.Fields[e];switch(s.DBColumnName){case"GLClubTranBy":this.ScreenObject.StaticFields.includes(this.GLClubTranBy)&&this.ScreenObject.StaticFields.Remove(this.GLClubTranBy),this.GLClubTranBy=s}}else"DistributeCost"==t.Name&&t.Fields.forEach(t=>{t instanceof n.e&&"DistCost"==t.DBColumnName&&(this.DistCost=t)})}),this.GLClubTranBy.Items.push(n.d.ComboBoxItems_2("Normal","0")),this.GLClubTranBy.Items.push(n.d.ComboBoxItems_2("Daily","1")),this.GLClubTranBy.Items.push(n.d.ComboBoxItems_2("Monthly","2"));for(let a=this.ScreenObject.CustomTab.Pages.length-1;a>=0;a--){let t=this.ScreenObject.CustomTab.Pages[a];switch(t.Name){case"Address":t.Fields.push(this.ViewAddress);break;case"Contacts":t.Fields.push(this.ViewContacts);break;case"Notes":t.Fields.push(this.ViewNotes);break;case"Credit & Debit":t.Fields.push(this.LocDivWiseCreditDebit),t.Visible=!!(S.a.SessionManager.Preferences.ContainsKey("LW CreditDebit")&&""!=S.a.SessionManager.Preferences["LW CreditDebit"]&&Object(D.j)(S.a.SessionManager.Preferences["LW CreditDebit"])||S.a.SessionManager.Preferences.ContainsKey("DW CreditDebit")&&""!=S.a.SessionManager.Preferences["DW CreditDebit"]&&Object(D.j)(S.a.SessionManager.Preferences["DW CreditDebit"])||S.a.SessionManager.Preferences.ContainsKey("DimWiseCreditDebit")&&""!=S.a.SessionManager.Preferences.DimWiseCreditDebit&&parseInt(S.a.SessionManager.Preferences.DimWiseCreditDebit)>0);break;case"Attachments":t.Fields.push(this.ViewAttachments);break;case"Cheque Discount":this.ScreenObject.CustomTab.Pages.Remove(t);break;case"Final Reports":this.obj.IsGroup?this.FinalReportsViewModel.FinalReportsFields.forEach(e=>{t.Fields.push(e)}):this.ScreenObject.CustomTab.Pages.Remove(t);break;case"Assign":t.Fields.push(this.ViewCCMapping);break;case"Report Template":this.rptccid>0&&null!=this.RptTemplate?t.Fields.push(this.RptTemplate):this.ScreenObject.CustomTab.Pages.Remove(t)}}this.dtTypes=this.ScreenObject.Data.Tables[4],this.ControlType>0&&(2==this.ControlType?t="7":3==this.ControlType&&(t="6")),this.ScreenObject.Data.Tables[3].forEach(t=>{this.Status.Items.push(n.d.ComboBoxItems_2(t.Status.toString(),t.StatusID.toString()))}),this.ScreenObject.Data.Tables[7].length>0&&(this.PaymentTerms.Items.push(n.d.ComboBoxItems_2("","")),this.ScreenObject.Data.Tables[7].forEach(t=>{this.PaymentTerms.Items.push(n.d.ComboBoxItems_2(t.ProfileName.toString(),t.ProfileID.toString()))})),this.AddressTypes=[],this.AddressTypes.push(n.d.ComboBoxItems_2(S.a.GetResource("Address_Permanent"),"1")),this.AddressTypes.push(n.d.ComboBoxItems_2(S.a.GetResource("Address_Temporary"),"2")),this.SelectedAddressType="1",1==this.ParentId||""==t?this.FillAccountTypes(this.AccountType,""==t?13:parseInt(t),1):this.FillAccountTypes(this.AccountType,parseInt(t),-1),this.ControlType>1&&(this.AccountType.Enable=!1),0!=this.obj.AccountID?this.LoadEditData():(this.obj.GUID="",this.NextPreviousVisibility=!1),console.log(this.ScreenObject.CustomTab)}LoadChequeDiscountTab(){for(let t=this.ScreenObject.CustomTab.Pages.length-1;t>=0;t--){let e=this.ScreenObject.CustomTab.Pages[t];if(300==e.DBColumnID){this.ScreenObject.CustomTab.Pages.Remove(e);break}}if("3"==this.AccountType.SelectedValue||"2"==this.AccountType.SelectedValue){let t=new d.b;t.Name="Cheque Discount",t.Header=S.a.GetResource("Tab_ChequeDiscount"),t.DBColumnID=300,this.ScreenObject.CustomTab.Pages.push(t);for(let e=0;e<this.ChequeFields.length;e++)t.Fields.push(this.ChequeFields[e]);this.ChequeDiscount=!0,this.ClearChequeFields()}}ClearChequeFields(){let t=null,e=null;for(let s=0;s<this.ChequeFields.length;s++)this.ChequeFields[s]instanceof a.d&&(t=this.ChequeFields[s],t.Text="0"),this.ChequeFields[s]instanceof l.b&&(e=this.ChequeFields[s],e.SelectedValue=0)}worker_RunWorkerCompleted(t,e){this.DisplayName=this.Title}LoadEditData(){if(this.ds=S.a.accounting.GetAccountDetails(this.obj.AccountID),Object.assign(this.obj,this.ds.obj),null!=this.LocDivWiseCreditDebit&&this.LocDivWiseCreditDebit.Clear(),this.AccountID=this.obj.AccountID,this.NextPrevID=this.AccountID,this.AccountPhoto="",this.ActualFileName="",this.AccountCode.Text=this.ds.Tables[0][0].AccountCode,(this.ScreenObject.InheritParentCode||this.ScreenObject.IsAutoCode)&&(this.AccountCode.Enable=parseInt(this.ds.Tables[0][0].Depth)<=1&&!this.ScreenObject.IsRootAutoCode),this.AccountName.Text=this.ds.Tables[0][0].AccountName,this.AliasName.Text=this.obj.AliasName,this.Status.SelectedValue=this.obj.StatusID.toString(),this.Group.SelectedValue=this.obj.ParentID,this.Group.DefaultValue=this.Group.SelectedValue.toString(),this.AccountType.SelectedValue=this.obj.AccountTypeID.toString(),this.PurchaseAccount.SelectedValue=this.obj.PurchaseAccount,this.TrustReceiptAccount.SelectedValue=this.obj.TrustReceiptAccount,this.MarginAccount.SelectedValue=this.obj.MarginAccount,this.CreditDays.Text=this.obj.CreditDays.toString(),this.CreditLimit.Text=this.obj.CreditLimit.toString(),this.DebitDays.Text=this.obj.DebitDays.toString(),this.DebitLimit.Text=this.obj.Debitlimit.toString(),this.Currency.SelectedValue=this.obj.Currency,this.SalesAccount.SelectedValue=this.obj.SalesAccount,this.COGSAccount.SelectedValue=this.obj.COGSAccount,this.ClosingStockAccount.SelectedValue=this.obj.ClosingStkAccount,this.PDCPayableAccount.SelectedValue=this.obj.PDCPayableAccount,this.PDCReceivableAccount.SelectedValue=this.obj.PDCReceivableAccount,this.BillWise.SelectedValue=this.obj.IsBillwise?"1":"0",this.IsDrCr.SelectedValue=this.obj.IsDrCr?"1":"0",this.PaymentTerms.SelectedValue=this.obj.PaymentTerms.toString(),this.LetterofCredit.Text=this.obj.LetterofCredit.toString(),this.TrustReceipt.Text=this.obj.TrustReceipt.toString(),this.Group.Enable=!1,this.drpCreditDays.SelectedValue=this.obj.CreditDaysOpt.toString(),this.drpDebitDays.SelectedValue=this.obj.DebitDaysOpt.toString(),this.DistCost.SelectedValue=this.obj.DistCost.toString(),this.GLClubTranBy.SelectedValue=this.obj.GLClubTranBy.toString(),this.FinalReportsViewModel.LoadData(this.ds.Tables[0]),this.LoadChequeDiscountTab(),"3"==this.AccountType.SelectedValue||"2"==this.AccountType.SelectedValue){let t=null,e=null;this.ds.Columns[0].Contains("PDCDiscountAccount")&&null!=this.ds.Tables[0][0].PDCDiscountAccount.toString()&&""!=this.ds.Tables[0][0].PDCDiscountAccount.toString()&&(e=this.ChequeFields[0],e.SelectedValue=parseInt(this.ds.Tables[0][0].PDCDiscountAccount)),this.ds.Columns[0].Contains("InterestRate")&&null!=this.ds.Tables[0][0].InterestRate.toString()&&""!=this.ds.Tables[0][0].InterestRate.toString()&&(t=this.ChequeFields[1],t.Text=this.ds.Tables[0][0].InterestRate.toString()),this.ds.Columns[0].Contains("CommissionRate")&&null!=this.ds.Tables[0][0].CommissionRate.toString()&&""!=this.ds.Tables[0][0].CommissionRate.toString()&&(t=this.ChequeFields[2],t.Text=this.ds.Tables[0][0].CommissionRate.toString()),this.ds.Columns[0].Contains("CheckDiscountLimit")&&null!=this.ds.Tables[0][0].CheckDiscountLimit.toString()&&""!=this.ds.Tables[0][0].CheckDiscountLimit.toString()&&(t=this.ChequeFields[3],t.Text=this.ds.Tables[0][0].CheckDiscountLimit.toString())}this.ScreenObject.LoadCustomFieldsData(this.ds.Tables[1]),null!=this.PrimaryContact&&this.PrimaryContact.LoadContacts(this.ds.Tables[8]),this.ScreenObject.LoadCustomFieldsCCData(this.ds.Tables[5],this.ds.Tables[17]),this.ViewContacts.LoadContacts(this.ds.Tables[2],this.ds.Columns[2]),this.ViewNotes.LoadNotes(this.ds.Tables[3]),this.ViewAttachments.LoadAttachments(this.ds.Tables[4]),this.ViewAddress.LoadContacts(this.ds.Tables[7]),this.ViewCCMapping.LoadData(this.ds.Tables[9],this.ds.Columns[9]),this.StatusAssignGrid.Load(this.ds.Tables[18]),null!=this.ds&&this.ds.Tables.length>11&&this.ds.Tables[11].length>0&&this.LocDivWiseCreditDebit.LoadXML(this.ds.Tables[11]),null!=this.ds&&this.ds.Tables.length>14&&this.RptTemplate&&(this.RptTemplate.tempTable=this.ds.Tables[14],this.RptTemplate.LoadXML(this.ds.Tables[15])),this.ScreenObject.CanApprove(this.ds.Tables[0][0],this.ds.Tables[13][0],this.ButtonSave);let t=this.ds.Tables[4].filter(t=>1==t.IsProductImage&&1==t.IsDefaultImage);S.a.SessionManager.IsOffline&&this.AccountID>0&&(this.ButtonSave.Visible=!1),this.ControlType>1&&((2==this.ControlType&&"7"!=this.AccountType.SelectedValue||3==this.ControlType&&"6"!=this.AccountType.SelectedValue)&&(this.ButtonSave.Visible=!1),null!=this.AccountType&&(this.AccountType.Enable=!1)),this.ScreenObject.SetViewByType(this.AccountType.SelectedValue,this.obj.IsGroup),t.length>0?(this.PhotoTextVisibility=!1,this.FileID=parseInt(t[0].FileID),this.AccountPhoto=m.e.GetPath(t[0].GUID.toString()+"."+t[0].FileExtension.toString()),this.ActualFileName=t[0].ActualFileName.toString()):(this.FileID=0,this.PhotoTextVisibility=!0),Logger.InfoLog("AddEditAccountScreenViewModel::Exiting LoadEditData")}OnDropPhoto(t){let e=m.e.CheckImageSize(t[0].name,t[0].size);if(""!=e)return void alert(e);let s=t[0],i=t[0].name.split("."),o=t[0].name;i.length>1&&(i=i[i.length-1]);let a=new FormData;a.append("ImageUpload",s),a.append("FileUpload",s),a.append("UserName",S.a.SessionManager.UserID);const n=new FileReader;n.onload=t=>{const e=new Image;if("pdf"==i||"txt"==i||"doc"==i||"csv"==i||"docx"==i||"doc"==i||"xls"==i||"xlsx"==i)return this.DisplayMessage=S.a.GetResource("File_NoPhoto"),void(this.MessageVisibility=!0);e.src=t.target.result,e.onload=e=>{m.e.IsEmpty(t.target.result)||setTimeout(()=>{S.a.common.UploadAttachments(a).subscribe(t=>{"AddEditAccountViewModel"==this.ClassName&&(this.AccountPhoto=m.e.GetPath(t),this.ActualFileName=o,this.FileExtension=i,this.IsPhotoChanged=!0,this.PhotoTextVisibility=!1,this.DisplayMessage="",this.MessageVisibility=!1)},t=>{console.log("Error : "+JSON.stringify(t))})},100)}},n.readAsDataURL(s)}OnSaveAccount(t){return Object(i.b)(this,void 0,void 0,(function*(){if(this.DisplayMessage="","Read"==t.toString()||"ReadEID"==t.toString()){const{AddAttachmentViewModel:t}=yield Promise.resolve().then(s.bind(null,"xnJf"));let e="",i="",o="";m.e.IsEmpty(e)||(this.AccountPhoto=e,this.IsPhotoChanged=!0,this.PhotoTextVisibility=!1);for(let s=0;s<this.ViewAttachments.AttachmentsList.length;s++)"EIDSignature.jpg"==this.ViewAttachments.AttachmentsList[s].ActualFileName&&(this.ViewAttachments.SelectedAttachment=this.ViewAttachments.AttachmentsList[s],this.ViewAttachments.OnCmnItem_Click("DELETE"));if(!m.e.IsEmpty(i)){let e=new t;e.AddAttachmentViewModel_2(this),e.AliasFileName=i,e.RelativeFileName=i,e.FileDescription="Signature",e.ActualFileName="EIDSignature.jpg",e.FilePath=i,e.FileExtension="jpg",e.AttachmentID=0,e._Flg=!0,this.ViewAttachments.AttachmentsList.push(e)}m.e.IsEmpty(o)||(this.DisplayMessage=o,this.MessageVisibility=!0)}else if("Print"==t.toString())this.DisplayMessage="Please Wait Printing Data...",S.a.report.ExportPDF_Masters(2,this.AccountID.toString(),0,"PDF").subscribe(t=>{console.log(t),S.a.SessionManager.Download(t.FileName,"Print"),m.e.IsEmpty(t.Message)&&!m.e.IsEmpty(t.FileName)&&(this.DisplayMessage="Exported Successfully")},t=>{console.log(t)});else if("PrintPreview"==t.toString())this.DisplayMessage="Please Wait  Preview Data...",S.a.report.ExportPDF_Masters(2,this.AccountID.toString(),0,"PDF").subscribe(t=>{console.log(t),S.a.SessionManager.Download(t.FileName,"Preview"),m.e.IsEmpty(t.Message)&&!m.e.IsEmpty(t.FileName)&&(this.DisplayMessage="Exported Successfully")},t=>{console.log(t)});else if("Contact"==t.toString());else if("Query"==t.toString()){const{ReportViewModel:t}=yield Promise.all([s.e(2),s.e(1),s.e(3),s.e(5),s.e(4),s.e(6),s.e(7),s.e(10),s.e(9),s.e(8),s.e(12),s.e(11),s.e(13),s.e(19),s.e(15),s.e(21),s.e(20),s.e(16),s.e(14),s.e(18),s.e(17),s.e(22),s.e(23),s.e(24),s.e(25),s.e(28),s.e(30),s.e(29),s.e(32),s.e(31),s.e(27),s.e(26),s.e(35),s.e(37),s.e(38),s.e(36),s.e(33),s.e(34),s.e(39),s.e(40),s.e(41),s.e(212)]).then(s.bind(null,"ThYU")),{ReportViewComponent:e}=yield Promise.all([s.e(32),s.e(37)]).then(s.bind(null,"YU11"));let i=new t;i.ReportViewModel_Query(this.CostCenterID,this.AccountID,this.ScreenName,0,null),S.a.page.addNewTab({component:e,params:{obj:i}})}else if("ShowApprove"==t.toString()){let t=new F.a(2,this.AccountID,this.ScreenObject,this);S.a.page.ShowDialog(t,f.a,{ShowCenter:!0,Title:S.a.GetResource("ApproveReject")})}else if("DeletePhoto"==t.toString());else if("PopUp"==t.toString());else if("UploadPhoto"==t.toString()){let t=new P.a;t.PopupAttachmentsViewModel_1(2,this.AccountID,this),S.a.page.ShowDialog(t,M.a,{ShowCenter:!0,Title:"Add Images"})}else if("ShowStatusAssignGrid"==t.toString())this.StatusAssignGrid.IsShown=!0,S.a.page.ShowDialog(this.StatusAssignGrid,L.a,{ShowCenter:!0,Title:S.a.GetResource("Assign")});else try{let t=this.ScreenObject.ValidateData();if(!m.e.IsEmpty(t))return void(this.DisplayMessage=t);if(this.IsAttachmentMandatory&&null!=this.ViewAttachments){let t=0;if(this.ViewAttachments.AttachmentsList.length>0&&this.ViewAttachments.AttachmentsList.forEach(e=>{e.IsProductImage||t++}),0==t)return this.DisplayMessage="Attachment is mandatory",void(this.MessageVisibility=!0)}if(null==this.Group||!this.IsControlAccounts||0!=this.Group.SelectedValue&&1!=this.Group.SelectedValue||(2==this.ControlType?(this.ParentId=parseInt(S.a.SessionManager.Preferences.DebtorsControlGroup),this.Group.SelectedValue=this.ParentId):3==this.ControlType&&(this.ParentId=parseInt(S.a.SessionManager.Preferences.CreditorsControlGroup),this.Group.SelectedValue=this.ParentId)),0!=this.Group.SelectedValue&&(this.obj.SelectedNodeID=this.Group.SelectedValue),0==this.obj.AccountID){let t={StrCode:this.obj.AccountCode,CodePrefix:this.obj.CodePrefix,CodeNumber:this.obj.CodeNumber};if(this.DisplayMessage=this.ScreenObject.SetAutoCodeParams_3(this.AccountCode,this.obj.SelectedNodeID,this.ScreenObject.Data.Tables[8],t),this.obj.AccountCode=t.StrCode,this.obj.CodePrefix=t.CodePrefix,this.obj.CodeNumber=t.CodeNumber,this.DisplayMessage.length>0)return}else this.obj.AccountCode=this.AccountCode.Text;if(this.AccountName.Enable&&(this.obj.AccountName=this.AccountName.Text.trim()),this.AliasName.Enable&&(this.obj.AliasName=this.AliasName.Text?this.AliasName.Text:this.AccountName.Text),this.AccountType.Enable&&this.AccountType.SelectedValue&&(this.obj.AccountTypeID=parseInt(this.AccountType.SelectedValue)),this.Status.Enable&&this.Status.SelectedValue&&(this.obj.StatusID=parseInt(this.Status.SelectedValue)),this.CreditDays.Enable&&null!=this.CreditDays.Text&&""!=this.CreditDays.Text&&(this.obj.CreditDays=parseInt(this.CreditDays.Text)),this.CreditLimit.Enable&&null!=this.CreditLimit.Text&&""!=this.CreditLimit.Text&&(this.obj.CreditLimit=parseInt(this.CreditLimit.Text)),this.BillWise.Enable&&(this.obj.IsBillwise="1"==this.BillWise.SelectedValue),this.IsDrCr.Visible&&(this.obj.IsDrCr="1"==this.IsDrCr.SelectedValue),this.obj.PurchaseAccount=this.PurchaseAccount.SelectedValue,this.obj.TrustReceiptAccount=this.TrustReceiptAccount.SelectedValue,this.obj.MarginAccount=this.MarginAccount.SelectedValue,this.obj.SalesAccount=this.SalesAccount.SelectedValue,this.obj.COGSAccount=this.COGSAccount.SelectedValue,this.obj.PDCPayableAccount=this.PDCPayableAccount.SelectedValue,this.obj.PDCReceivableAccount=this.PDCReceivableAccount.SelectedValue,this.obj.PaymentTerms=null!=this.PaymentTerms.SelectedValue&&""!=this.PaymentTerms.SelectedValue?parseInt(this.PaymentTerms.SelectedValue):0,this.obj.LetterofCredit=this.LetterofCredit.Enable&&null!=this.LetterofCredit.Text&&""!=this.LetterofCredit.Text?parseInt(this.LetterofCredit.Text):0,this.obj.TrustReceipt=this.TrustReceipt.Enable&&null!=this.TrustReceipt.Text&&""!=this.TrustReceipt.Text?parseInt(this.TrustReceipt.Text):0,this.obj.ClosingStkAccount=this.ClosingStockAccount.SelectedValue,""!=this.DistCost.SelectedValue&&(this.obj.DistCost=parseInt(this.DistCost.SelectedValue)),this.DebitDays.Enable&&null!=this.DebitDays.Text&&""!=this.DebitDays.Text&&(this.obj.DebitDays=parseInt(this.DebitDays.Text)),""!=this.drpDebitDays.SelectedValue&&(this.obj.DebitDaysOpt=parseInt(this.drpDebitDays.SelectedValue)),this.DebitLimit.Enable&&null!=this.DebitLimit.Text&&""!=this.DebitLimit.Text&&(this.obj.Debitlimit=parseInt(this.DebitLimit.Text)),""!=this.drpCreditDays.SelectedValue&&(this.obj.CreditDaysOpt=parseInt(this.drpCreditDays.SelectedValue)),this.Currency.Enable&&(this.obj.Currency=this.Currency.SelectedValue),""!=this.GLClubTranBy.SelectedValue&&(this.obj.GLClubTranBy=parseInt(this.GLClubTranBy.SelectedValue)),this.AccountName.Visible&&this.AccountName.Enable?this.AccountName.Enable&&""!=this.AccountName.Text&&null!=this.AccountName.Text&&(this.obj.AccountName=this.AccountName.Text.trim()):this.obj.AccountName=this.AccountCode.Text,this.AliasName.Visible&&this.AliasName.Enable?this.AliasName.Enable&&(this.obj.AliasName=this.AliasName.Text?this.AliasName.Text:this.AccountName.Text.trim()):this.obj.AliasName=this.AliasName.Text?this.AliasName.Text:this.AccountName.Text.trim(),m.e.StringIsNullOrEmpty(this.Group.DefaultValue)||this.Group.Visible||(this.obj.SelectedNodeID=parseInt(this.Group.DefaultValue)),0==this.AccountID&&(m.e.StringIsNullOrEmpty(this.AccountType.DefaultValue)||this.AccountType.Visible&&this.AccountType.Enable||(this.obj.AccountTypeID=parseInt(this.AccountType.DefaultValue))),0==this.AccountID&&(m.e.StringIsNullOrEmpty(this.Status.DefaultValue)||this.Status.Visible&&this.Status.Enable||(this.obj.StatusID=parseInt(this.Status.DefaultValue))),this.CreditDays.Visible&&this.CreditDays.Enable||(this.obj.CreditDays=0),this.CreditLimit.Visible&&this.CreditLimit.Enable||(this.obj.CreditLimit=0),this.BillWise.Visible&&this.BillWise.Enable||(this.obj.IsBillwise="1"==this.BillWise.SelectedValue),m.e.StringIsNullOrEmpty(this.PurchaseAccount.DefaultValue)||this.PurchaseAccount.Visible&&this.PurchaseAccount.Enable||(this.obj.PurchaseAccount=parseInt(this.PurchaseAccount.DefaultValue)),m.e.StringIsNullOrEmpty(this.TrustReceiptAccount.DefaultValue)||this.TrustReceiptAccount.Visible&&this.TrustReceiptAccount.Enable||(this.obj.TrustReceiptAccount=parseInt(this.TrustReceiptAccount.DefaultValue)),m.e.StringIsNullOrEmpty(this.MarginAccount.DefaultValue)||this.MarginAccount.Visible&&this.MarginAccount.Enable||(this.obj.MarginAccount=parseInt(this.MarginAccount.DefaultValue)),m.e.StringIsNullOrEmpty(this.SalesAccount.DefaultValue)||this.SalesAccount.Visible&&this.SalesAccount.Enable||(this.obj.SalesAccount=parseInt(this.SalesAccount.DefaultValue)),m.e.StringIsNullOrEmpty(this.COGSAccount.DefaultValue)||this.COGSAccount.Visible&&this.COGSAccount.Enable||(this.obj.COGSAccount=parseInt(this.COGSAccount.DefaultValue)),m.e.StringIsNullOrEmpty(this.ClosingStockAccount.DefaultValue)||this.ClosingStockAccount.Visible&&this.ClosingStockAccount.Enable||(this.obj.ClosingStkAccount=parseInt(this.ClosingStockAccount.DefaultValue)),m.e.StringIsNullOrEmpty(this.PDCReceivableAccount.DefaultValue)||this.PDCReceivableAccount.Visible&&this.PDCReceivableAccount.Enable||(this.obj.PDCReceivableAccount=parseInt(this.PDCReceivableAccount.DefaultValue)),m.e.StringIsNullOrEmpty(this.PDCPayableAccount.DefaultValue)||this.PDCPayableAccount.Visible&&this.PDCPayableAccount.Enable||(this.obj.PDCPayableAccount=parseInt(this.PDCPayableAccount.DefaultValue)),this.GLClubTranBy.Visible&&this.GLClubTranBy.Enable||(this.obj.GLClubTranBy=parseInt(this.GLClubTranBy.SelectedValue)),this.DebitDays.Visible&&this.DebitDays.Enable||(this.obj.DebitDays=0),this.DebitDays.Visible&&this.DebitDays.Enable||(this.obj.DebitDaysOpt=0),this.DebitLimit.Visible&&this.DebitLimit.Enable||(this.obj.Debitlimit=0),this.CreditDays.Visible&&this.CreditDays.Enable||(this.obj.CreditDaysOpt=0),this.Currency.Visible&&this.Currency.Enable||(this.obj.Currency=this.Currency.SelectedValue),this.obj.CustomFieldsQuery=this.ScreenObject.GetCustomFieldsQuery(),this.obj.CustomCostCenterFieldsQuery=this.ScreenObject.GetCustomCostCenterFieldsQuery(),this.obj.HistoryXML=this.ScreenObject.HistoryCCXML,this.obj.StatusXML=this.StatusAssignGrid.GetXML(),null!=this.PrimaryContact&&(this.obj.PrimaryContactQuery=this.PrimaryContact.GetXML()),this.obj.NotesXML=this.ViewNotes.GetXML(),this.obj.ContactsXML=this.ViewContacts.GetXML(),this.obj.AddressXML=this.ViewAddress.GetXML(),null!=this.RptTemplate){if(this.obj.AccReportTemplateXML=this.RptTemplate.GridXML(),""==this.obj.AccReportTemplateXML&&""!=this.DisplayMessage)return}else this.obj.AccReportTemplateXML="";if("3"==this.AccountType.SelectedValue||"2"==this.AccountType.SelectedValue){let t=null,e=null;null!=this.ChequeFields&&this.ChequeFields[0]instanceof l.b&&(e=this.ChequeFields[0],this.obj.PDCDiscountAccount=e.SelectedValue),null!=this.ChequeFields&&this.ChequeFields[1]instanceof a.d&&(t=this.ChequeFields[1],this.obj.InterestRate=parseInt(t.Text)),null!=this.ChequeFields&&this.ChequeFields[2]instanceof a.d&&(t=this.ChequeFields[2],this.obj.CommissionRate=parseInt(t.Text)),null!=this.ChequeFields&&this.ChequeFields[3]instanceof a.d&&(t=this.ChequeFields[3],this.obj.CheckDiscountlimit=parseInt(t.Text))}let s={};if(this.DisplayMessage=this.ViewCCMapping.GetXML(s),this.obj.CCMapXML=s.strXML,!m.e.StringIsNullOrEmpty(this.DisplayMessage))return;let i={Message:""};if(!this.obj.IsGroup&&!this.ScreenObject.ValidateGSTRules(this.obj.AccountTypeID,i))return this.DisplayMessage=i.Message,void(this.MessageVisibility=!0);if(!this.ScreenObject.ValidateDataonSave())return;if(this.obj.CreditDebit=this.LocDivWiseCreditDebit.GridXML(),this.obj.IsGroup){let t=null;this.FinalReportsViewModel.FinalReportsFields[0]instanceof n.e&&(t=this.FinalReportsViewModel.FinalReportsFields[0],this.obj.TB=parseInt(t.SelectedValue)),this.FinalReportsViewModel.FinalReportsFields[1]instanceof n.e&&(t=this.FinalReportsViewModel.FinalReportsFields[1],this.obj.BS=parseInt(t.SelectedValue)),this.FinalReportsViewModel.FinalReportsFields[2]instanceof n.e&&(t=this.FinalReportsViewModel.FinalReportsFields[2],this.obj.PL=parseInt(t.SelectedValue)),this.FinalReportsViewModel.FinalReportsFields[3]instanceof n.e&&(t=this.FinalReportsViewModel.FinalReportsFields[3],this.obj.PLT=parseInt(t.SelectedValue))}else this.obj.TB=0,this.obj.PL=0,this.obj.BS=0,this.obj.PLT=0;try{this.obj.AttachmetsXML=this.ViewAttachments.GetXML(),this.obj.AttachmetsXML+=this.ScreenObject.GetExtraAttachmentXML();let t="";this.IsPhotoChanged&&!m.e.StringIsNullOrEmpty(this.AccountPhoto)?(t+=0==this.FileID?'<Row Action="NEW"':'<Row Action="MODIFY"',S.a.SessionManager.IsWebApplication&&(t+=' AttachmentID="'+this.FileID+'"',t+=' FilePath="'+this.AccountPhoto+'"',t+=' ActualFileName="'+this.ActualFileName+'"',t+=' RelativeFileName="'+this.AccountPhoto+'"',t+=' FileExtension="'+this.AccountPhoto.substring(this.AccountPhoto.lastIndexOf("/")+1).split(".")[1]+'"',t+=' FileDescription=""',t+=' IsProductImage="1"',t+=' IsDefaultImage="1"',t+=' GUID="'+this.AccountPhoto.substring(this.AccountPhoto.lastIndexOf("/")+1).split(".")[0]+'"',t+="/>")):this.IsPhotoDelete&&this.FileID>0&&(t+='<Row Action="DELETE"',t+=' AttachmentID="'+this.FileID+'"/>'),t.length>0&&(t="<AttachmentsXML>"+t,t+="</AttachmentsXML>",this.obj.AttachmetsXML=this.obj.AttachmetsXML+t.toString())}catch(e){return void(this.DisplayMessage=S.a.GetResource("Upload_Path_notExists"))}this.obj.IsCode=!1,this.obj.WID=this.ScreenObject.CheckWorkFlow(),S.a.accounting.SaveAccount(this.obj,"SaveAccount").subscribe(t=>{if(this.DisplayMessage=t.Message,this.RetValue=t.RetValue,this.RetValue>0||this.RetValue<-1e4){S.a.page.tabs.forEach(t=>{t.instance instanceof N.TreeViewPageComponent&&t.instance.obj&&2==t.instance.CostCenterID&&(t.instance.obj.SetFocusNodeID=t.instance.obj.SelectedNode.Id,t.instance.Refresh())}),this.AccountPhoto="",this.ActualFileName="",this.PhotoTextVisibility=!0;let t=this.Group.SelectedValue;this.ScreenObject.Clear(),this.Group.SelectedValue=t,this.ParentId>0&&(this.Group.SelectedValue=this.ParentId,this.AccountType.SelectedValue=this.obj.AccountTypeID.toString()),null!=this.LocDivWiseCreditDebit&&this.LocDivWiseCreditDebit.Clear(),this.IsPhotoDelete=!1,this.ViewContacts.ContactsListObj.Clear(),this.ViewAddress.ContactsListObj.Clear(),this.ViewNotes.NotesListObj.Clear(),this.ViewAttachments.AttachmentsListObj.Clear(),this.ViewCCMapping.Clear(),this.ViewContacts.DeletedContacts.Clear(),this.ClearChequeFields(),this.ViewAddress.DeletedAddress.Clear(),this.ViewNotes.DeletedNotes.Clear(),this.ViewAttachments.AttachmentsListObj.Clear(),this.ViewAttachments.DeletedAttachments.Clear(),this.StatusAssignGrid.Clear(),this.AttachmentVisibility=!1,this.CCMapVisibility=!1,this.RptTemplate&&this.RptTemplate.Clear(),this.AccountID=0,this.obj.AccountID=0,this.PrintVisible=!1,this.AutoGenerateCode(),this.RefreshTitle(),this.AccountName.SetFocus=!0,this.BillWise.SelectedValue="1",0!=this.obj.AccountID&&(this.ButtonSave.Enable=!1,this.AccountCode.Text=""),"2"==this.AccountType.SelectedValue||"3"==this.AccountType.SelectedValue?(this.MarginAccount.Visible=!0,this.TrustReceiptAccount.Visible=!0):(this.MarginAccount.Visible=!1,this.TrustReceiptAccount.Visible=!1),null!=this.PrimaryContact&&this.PrimaryContact.ClearFields()}this.Parent&&this.Parent.Refresh();let e=this.ScreenObject.Data.Tables[5].filter(t=>"ShowCurrentSavedData"==t.Name);e.length>0&&""!=m.e.String(e[0].Value)&&Object(D.j)(e[0].Value)&&(this.obj.AccountID=this.RetValue,this.RefreshTitle(),this.LoadEditData()),this.MessageVisibility=!0},t=>{console.log("Quick Account Save : "+JSON.stringify(t))})}catch(e){S.a.SessionManager.Logger.ErrorLog("AddEditAccountScreenViewModel:: OnSaveAccount"+e.stack)}}))}OnAddAttachment(){Logger.InfoLog("AddProductViewModel::Entering AddAttachment"),this.Attachment=new O.AddAttachmentViewModel,this.Attachment.AddAttachmentViewModel_2(this),Logger.InfoLog("AddProductViewModel::Entering AddAttachment")}OnGroupSelectionChanged(t){t==this.Group||"Group"==t?this.Group.SelectedValue>0&&(this.Group.DefaultValue=this.Group.SelectedValue.toString(),this.FillAccountTypes(this.AccountType,S.a.accounting.GetAccountType(this.Group.SelectedValue),this.Group.SelectedValue),this.AutoGenerateCode(),this.LoadParentData()):t==this.AccountType&&(0==this.AccountID&&(this.BillWise.SelectedValue=null==this.AccountType.SelectedValue||""==this.AccountType.SelectedValue||6!=parseInt(this.AccountType.SelectedValue)&&7!=parseInt(this.AccountType.SelectedValue)?"0":"1"),"2"==this.AccountType.SelectedValue||"3"==this.AccountType.SelectedValue?(this.TrustReceiptAccount.Visible=!0,this.MarginAccount.Visible=!0):(this.TrustReceiptAccount.Visible=!1,this.MarginAccount.Visible=!1),this.LoadChequeDiscountTab(),this.ScreenObject.SetViewByType(this.AccountType.SelectedValue,this.obj.IsGroup))}FillAccountTypes(t,e,s){let i=t.SelectedValue;if(t.Items=[],this.IsControlAccounts){let s=[];1==this.ControlType?s=this.dtTypes.filter(t=>6==t.AccountTypeID||7==t.AccountTypeID):2==this.ControlType?(e=7,t.DefaultValue="7",s=this.dtTypes.filter(t=>7!=t.AccountTypeID)):3==this.ControlType&&(e=6,t.DefaultValue="6",s=this.dtTypes.filter(t=>6!=t.AccountTypeID)),s.forEach(t=>{this.dtTypes.Remove(t)})}this.dtTypes.forEach(i=>{let o=parseInt(i.AccountTypeID);1!=s&&(4!=e&&8!=e&&11!=e&&5!=e&&9!=e&&12!=e||4!=o&&8!=o&&11!=o&&5!=o&&9!=o&&12!=o)&&(1!=e&&2!=e&&7!=e&&10!=e&&13!=e&&15!=e&&3!=e&&6!=e&&14!=e&&16!=e||1!=o&&2!=o&&7!=o&&10!=o&&13!=o&&15!=e&&3!=o&&6!=o&&14!=o&&16!=e)||t.Items.push(n.d.ComboBoxItems_2(i.ResourceData,i.AccountTypeID))}),t.SelectedValue=0!=e?e.toString():i,this.ScreenObject.SetViewByType(this.AccountType.SelectedValue,this.obj.IsGroup)}RefreshTitle(){this.obj.IsGroup?(this.Title=S.a.GetResource(0==this.obj.AccountID?"Account_AddGroup":"Account_EditGroup"),S.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=S.a.SessionManager.IsActionAssigned(2,"Create Group"):this.ButtonSave.Enable=S.a.SessionManager.IsActionAssigned(2,"Create Group")):0==this.obj.AccountID?(this.Title=S.a.GetResource("Account_AddAccount"),S.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=S.a.SessionManager.IsActionAssigned(2,"Create"):this.ButtonSave.Enable=S.a.SessionManager.IsActionAssigned(2,"Create")):(this.Title=S.a.GetResource("Account_EditAccount"),S.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=S.a.SessionManager.IsActionAssigned(2,"Update"):this.ButtonSave.Enable=S.a.SessionManager.IsActionAssigned(2,"Update"))}OnNameLostFocus(t){if(!m.e.StringIsNullOrEmpty(this.AccountName.Text)){let t;t=this.AccountType.Visible&&this.AccountType.Enable?parseInt(this.AccountType.SelectedValue):0==this.AccountID?parseInt(this.AccountType.DefaultValue):this.obj.AccountTypeID,this.DisplayMessage=S.a.accounting.CheckDuplicateName(2,this.AccountID,this.AccountName.Text.TrimStart(""),t,this.obj.IsGroup)}this.ScreenObject.onTextBoxLostFocus(t)}CreateUser(){let t=0;S.a.SessionManager.LicenseSettings.ContainsKey("EFeature12")&&(t=S.a.SessionManager.LicenseSettings.EFeature12);let e=0;S.a.SessionManager.LicenseSettings.ContainsKey("EFeature13")&&(e=S.a.SessionManager.LicenseSettings.EFeature13);let s=[];s.push(parseInt(this.ViewContacts.ContactsListObj.SelectedItem.ContactID)),s.push(t),s.push(e),s.push(S.a.SessionManager.CompanyGUID),s.push("guid"),s.push(S.a.SessionManager.UserName),s.push(S.a.SessionManager.UserID),s.push(S.a.SessionManager.RoleID),s.push(S.a.SessionManager.LanguageID),s.push(S.a.SessionManager.CompanyIndex);let i=S.a.admin.CreateUserFromContact(s);return i.obj>0?(this.ViewContacts.ContactsListObj.SelectedItem.ContactID=i.obj,this.ViewContacts.OnRowChange(),this.DisplayMessage="User Saved Successfully",!0):(null!=i&&i.Tables.length>0&&i.Columns[i.Columns.length-1].Contains("ErrorMessage")&&(this.DisplayMessage=i.Tables[i.Tables.length-1][0].ErrorMessage.toString()),!1)}}}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[138],{"5h7L":function(e,t,i){"use strict";i.d(t,"a",(function(){return D}));var s=i("3Pt+"),a=i("eQJW"),r=i("Do2H"),o=i("fVK4"),l=i("Lp6j"),n=i("fXoL"),h=i("jhN1"),u=i("gqLd");let D=(()=>{class e extends o.a{constructor(e){super(e),this.form=new s.j({}),this.gridid=r.a.slick.gridid}ngOnInit(){this.obj.RefreshGridColumns.Subscribe(this,"setColumnDefinitions"),this.setColumnDefinitions(),this.setGridOptions(),r.a.page.ActiveTab&&(r.a.page.ActiveTab.grids||(r.a.page.ActiveTab.grids=[]),r.a.page.ActiveTab.grids.push(this.obj))}setColumnDefinitions(){let e=[];for(let t=0;t<this.obj.ReportColumns.length;t++){const i=this.obj.ReportColumns[t];let s={};s.id=i.ID,s.name=i.HeaderText,s.DataContext=this.obj.ReportColumns[t],s.type=a.e.string,s.filterable=!1,s.sortable=!1,s.formatter=this.cellFormatter,i.HeaderAppearance.IsVisible?s.width=parseInt(i.width):(s.width=0,s.maxWidth=0,s.minWidth=0,s.name="",s.selectable=!1,s.cssClass="display-none",s.headerCssClass="display-none"),s.headerCssClass+=" Column_"+t,s.Index=t,e.push(s)}this.columnDefinitions=e}setGridOptions(){this.gridOptions={autoResize:{containerId:"report-container",sidePadding:0},enableAutoResize:!0,multiSelect:!0,frozenColumn:void 0,enableAutoSizeColumns:!1,enableExport:!1,enableFiltering:!0,showHeaderRow:!1,enableCheckboxSelector:!1,enableRowSelection:!0,enableCellNavigation:!0,colspanCallback:this.setColSpan,checkboxSelector:{hideInColumnTitleRow:!0,hideInFilterHeaderRow:!0,hideSelectAllCheckbox:!1},rowSelectionOptions:{selectActiveRow:!0},dataView:{syncGridSelection:!0},enableRowMoveManager:!1,rowMoveManager:{singleRowMove:!0,disableRowSelection:!0,cancelEditOnDrag:!0},enableTranslate:!0,i18n:r.a.translate,headerRowHeight:2,rowHeight:26,topPanelHeight:5,presets:{}}}angularGridReady(e){this.obj.angularGrid=e,this.gridObj=e.slickGrid,e.slickGrid.onKeyDown.subscribe((e,t)=>{this.Grd_PreviewKeyDown("",e,t)})}refreshUI(){this.obj.angularGrid&&this.obj.angularGrid.resizerService.resizeGrid()}Grd_PreviewKeyDown(e,t,i){if(t.ctrlKey&&67==t.which&&!l.e.IsEmpty(this.gridObj.getActiveCell())){let e=this.gridObj.getActiveCell();l.e.IsEmpty(this.obj.SelectedRow)||l.e.IsEmpty(e.cell)||(l.e.copyToClipboard(this.obj.SelectedRow.Cells[e.cell].Text.toString()),t.preventDefault())}}handleSelectedRowsChanged1(e,t){Array.isArray(t.rows)&&this.obj.angularGrid&&t.rows.map(e=>{this.obj.SelectedRow=this.obj.angularGrid.slickGrid.getDataItem(e)})}onCellClicked(e,t){var i,s;try{if(this.obj.DataClick.IsSubscribed&&("A"==(null===(i=e.target)||void 0===i?void 0:i.nodeName)||"a"==(null===(s=e.target)||void 0===s?void 0:s.nodeName))){let i=e.target.innerText;if(e.target.attributes.tag&&e.target.attributes.tag.value&&(i=e.target.attributes.tag.value),i.length>0){let e=t.grid.getColumns()[t.cell],s=this.obj.angularGrid.slickGrid.getDataItem(t.row);this.obj.angularGrid.slickGrid.setSelectedRows([t.row]),this.obj.SelectedIndex=t.row,this.obj.SelectedItem=s,this.obj.DataClick.Call({Column:e.DataContext,ColumnIndex:t.cell,Row:s,Content:i})}}}catch(a){}}onDblClick(e,t){if(this.obj.RowDblClick.IsSubscribed){let e=this.obj.angularGrid.slickGrid.getDataItem(t.row);this.obj.RowDblClick.Call(e,t.cell)}}}return e.\u0275fac=function(t){return new(t||e)(n.Tb(h.b))},e.\u0275cmp=n.Nb({type:e,selectors:[["app-report-grid"]],inputs:{obj:"obj"},features:[n.Ab],decls:5,vars:6,consts:[[1,"PactReportGrid","Pactpagetree"],["GridStyles","",3,"gridId","isreport","gridobj","columnDefinitions","gridOptions","dataset","onAngularGridCreated","sgOnSelectedRowsChanged","sgOnClick","sgOnDblClick"]],template:function(e,t){1&e&&(n.Zb(0,"div",0),n.Wc(1,"\n    "),n.Zb(2,"angular-slickgrid",1),n.hc("onAngularGridCreated",(function(e){return t.angularGridReady(e)}))("sgOnSelectedRowsChanged",(function(e){return t.handleSelectedRowsChanged1(e.detail.eventData,e.detail.args)}))("sgOnClick",(function(e){return t.onCellClicked(e.detail.eventData,e.detail.args)}))("sgOnDblClick",(function(e){return t.onDblClick(e.detail.eventData,e.detail.args)})),n.Wc(3,"\n    "),n.Yb(),n.Wc(4,"\n"),n.Yb()),2&e&&(n.Db(2),n.vc("gridId","slkSubRPT_",t.gridid,""),n.tc("isreport",!0)("gridobj",t.obj)("columnDefinitions",t.columnDefinitions)("gridOptions",t.gridOptions)("dataset",t.obj.Data))},directives:[a.a,u.a],encapsulation:2}),e})()},EArz:function(e,t,i){"use strict";i.r(t),i.d(t,"DBViewViewModel",(function(){return te})),i.d(t,"DBPanel",(function(){return ie})),i.d(t,"DBReportFilterViewModel",(function(){return se}));var s=i("mrSG"),a=i("Do2H"),r=i("Lp6j"),o=i("ScVY"),l=i("8iaB"),n=i("6z9j"),h=i("XPEG"),u=i("w8Sz"),D=i("USNh"),c=i("4HhE"),d=i("0/4Q"),p=i("ThYU"),C=i("eQJW"),T=i("dH+5"),m=i("z64C"),y=i("Agar"),I=i("vTM8"),g=i("uMy8"),S=i("Huqd"),F=i("1xwR"),b=i("APT5"),A=i("0loF"),f=i("4lLs");class M{constructor(){this.IsGroupsExists=!1}}class R extends o.b{constructor(){super(),this.Chart=null,this.LoadingVisibility=!0,this._WidgetVisibility=!0,this._CalendarVisibility=!1,this.ForeColor="#FFFFFF",this.SubFieldsBgColor="#008000",this.SubFieldsBgColorArr=["#017EFF","#FF9700","#3498FB","#0093A4","#9972B5","#FF4040","#2BADCE","#E69500"],this.WidgetID=0,this.TypeID=0,this.Decimals=2,this.strAccounts="",this.Groups="",this.PrevData=0,this.IncludeOpening=!1,this.IsGroupsExists=!1,this.IncludePDC=!1,this.ShowPositive=!1,this.IsAccDoc=!1,this.IsExecutedDocs=!1,this.IsGeneralDocs=!1,this.IsBWDocs=!1,this.IsDurationDifference=!1,this.IsDifferenceView=!1,this.IsFieldsDifference=!1,this.CurrencyType=0,this.ForeignCurrencyID=0,this.Slabs=new Array,this.dicExecutedQuery=new I.a,this.dicUserWiseDims=new I.a,this.dicFilters=new I.c,this.dicLookupFilters=new I.c,this.HeaderValuePostfix="",this.IsLink=!1,this.CallStatusID="",this.eval=new g.b,this.fldDict=new I.a,this.ClassName="WidgetViewModel"}get WidgetVisibility(){return this._WidgetVisibility}set WidgetVisibility(e){this._WidgetVisibility!=e&&(this.CalendarVisibility=!1,this._WidgetVisibility=e)}get CalendarVisibility(){return this._CalendarVisibility}set CalendarVisibility(e){this._CalendarVisibility!=e&&(this.WidgetVisibility=!1,this._CalendarVisibility=e)}WidgetViewModel_1(e,t,i){if(this.WidgetID=t,this.Header=new w,this.SubFields=[],this.SubFieldsText=[],this.SubFieldsBgColor=this.SubFieldsBgColorArr[Math.abs(t)%8],0==i.length)return;let s=new r.f;s.LoadXml(i),this.DBWidgetFilter=r.f.SelectSingleNode(s.DocumentElement,"TreeFilters"),this.InitWidget(),this.ForeColor=e.HeaderForeColor,this.BackgroundColor=e.BodyBackColor,i.split("!")[0].split(","),this.IsDurationDifference=null!=s.DocumentElement.attributes.IsDurationDifference&&"1"==s.DocumentElement.attributes.IsDurationDifference.value,this.IsFieldsDifference=null!=s.DocumentElement.attributes.IsFieldsDifference&&"1"==s.DocumentElement.attributes.IsFieldsDifference.value,this.IsFieldsDifference&&(this.IsDurationDifference=!0),this.IsDurationDifference&&(this.Header.ShowArrow=!0),(this.IsDurationDifference||this.IsFieldsDifference||104==this.TypeID||105==this.TypeID||106==this.TypeID||107==this.TypeID)&&(this.IsDifferenceView=!0),this.Header.LabelType=s.DocumentElement.attributes.HF.value;let a=r.f.SelectSingleNode(s.DocumentElement,"HFForm");if(null!=a&&(this.Header.Formula=a.innerHTML),this.Header.Label=e.Header,this.Header.ForeColor=this.ForeColor,this.Header.txtLbl=new N,this.IsDurationDifference&&!this.IsFieldsDifference){this.DurationLinks=[],this.Header.LabelType="";let e=r.f.SelectNodes(s.DocumentElement,"DF");for(let i=0;i<e.length;i++){let t=new N;t.Row=e[i].attributes.Duration.value,t.Text=e[i].attributes.Caption.value,this.DurationLinks.push(t)}let t=["CurMon","PrevMn"];this.DurationLinks.length>0&&(t=this.SetDurationFilter(this.DurationLinks[0],!1));for(let i=0;i<t.length;i++){let e=new w;e.LabelType=t[i],e.Label=0==i?"Current":"Previous",e.Row=i.ToString(),e.ForeColor=this.ForeColor,e.SetSubFields(),this.SubFields.push(e),this.SubFieldsText.push(e.txtLbl),this.SubFieldsText.push(e.txtValue),this.SubFieldsText.push(e.txtSep),this.SubFieldsText.push(e.txtPercent)}}else 11==this.TypeID||12==this.TypeID||13==this.TypeID||14==this.TypeID||15==this.TypeID||18==this.TypeID||19==this.TypeID||20==this.TypeID||102==this.TypeID?(r.e.IsEmpty(this.Header.LabelType)&&(this.Header.LabelType="YrToDate"),11!=this.TypeID&&12!=this.TypeID&&13!=this.TypeID&&18!=this.TypeID&&19!=this.TypeID&&20!=this.TypeID||(this.Header.Visible=!1)):26!=this.TypeID&&27!=this.TypeID||(this.CalendarVisibility=!0,this.WidgetCalendar=new L(this));if(11!=this.TypeID){let e=r.f.SelectNodes(s.DocumentElement,"SF");for(let t=0;t<e.length;t++){let i=new w;i.LabelType=e[t].attributes.Field.value,i.Label=e[t].attributes.Caption.value,null!=e[t].attributes.Perc&&"1"==e[t].attributes.Perc.value&&(i.ShowPercentage=!0),a=r.f.SelectSingleNode(e[t],"Form"),null!=a&&(i.Formula=a.innerHTML),i.Row=t.toString(),i.ForeColor=this.ForeColor,i.SetSubFields(),16==this.TypeID?i.StatusID=s.DocumentElement.attributes.StatusFilter.value:17==this.TypeID&&(i.StatusID=i.LabelType,i.LabelType=s.DocumentElement.attributes.StatusFilter.value),103==this.TypeID&&(i.txtPercent.Visible=!1),this.SubFields.push(i),this.SubFieldsText.push(i.txtLbl),this.SubFieldsText.push(i.txtSep),this.SubFieldsText.push(i.txtValue),this.SubFieldsText.push(i.txtPercent)}17==this.TypeID?(this.Header.StatusID=this.Header.LabelType,this.Header.LabelType=s.DocumentElement.attributes.StatusFilter.value):16==this.TypeID&&(this.Header.StatusID=s.DocumentElement.attributes.StatusFilter.value)}16!=this.TypeID&&17!=this.TypeID||(this.IsGeneralDocs=!0,("21"==this.Header.StatusID||"22"==this.Header.StatusID||"23"==this.Header.StatusID||this.SubFields.find(e=>"21"==e.StatusID||"22"==e.StatusID||"23"==e.StatusID))&&(this.SubFields.find(e=>"21"!=e.StatusID&&"22"!=e.StatusID&&"23"!=e.StatusID&&"0"!=e.StatusID)||(this.IsGeneralDocs=!1),this.IsExecutedDocs=!0),"31"!=this.Header.StatusID&&"32"!=this.Header.StatusID&&"33"!=this.Header.StatusID&&null==this.SubFields.find(e=>"31"==e.StatusID||"32"==e.StatusID||"33"==e.StatusID)||(null==this.SubFields.find(e=>"21"!=e.StatusID&&"22"!=e.StatusID&&"23"!=e.StatusID&&"0"!=e.StatusID)&&(this.IsGeneralDocs=!1),this.IsBWDocs=!0)),this.fldDict.push("value",new g.c("value",0)),this.fldDict.push("Value",new g.c("Value",0)),this.fldDict.push("VALUE",new g.c("VALUE",0)),this.eval.ThrowException=!1,this.eval.SetKeyWords("REPORT")}WidgetViewModel_2(e,t,i){this.Chart=e,this.WidgetID=t,this.DBWidgetFilter=i,this.Header=new w,this.InitWidget(),17==this.TypeID&&(this.Header.StatusID=this.Header.LabelType),this.Header.LabelType="CHART",this.Header.Label="",14!=this.TypeID&&15!=this.TypeID&&19!=this.TypeID&&20!=this.TypeID&&102!=this.TypeID||(e.ToDate.Date=new Date)}InitWidget(){let e,t,i=new r.f,s=a.a.report.Widgets(1,this.WidgetID,"",0,1,!1,null,null);if(this.TypeID=parseInt(s.Tables[0][0].WType),this.TypeID>=21&&this.TypeID<=100&&(this.Decimals=0),16!=this.TypeID&&17!=this.TypeID||(this.IsLink=!0),null!=this.DBWidgetFilter?this.LoadTreeFilters(this.DBWidgetFilter):(t=r.e.String(s.Tables[0][0].AccountsXML),t.length>0&&(i.LoadXml(t),this.LoadTreeFilters(i.DocumentElement))),t=r.e.String(s.Tables[0][0].OptionsXML),t.length>0){if(i.LoadXml(t),e=r.f.SelectSingleNode(i.DocumentElement,"Opening"),null!=e&&"1"==e.innerHTML&&(this.IncludeOpening=!0),e=r.f.SelectSingleNode(i.DocumentElement,"PDC"),null!=e&&"1"==e.innerHTML&&(this.IncludePDC=!0),e=r.f.SelectSingleNode(i.DocumentElement,"ShowPositive"),null!=e&&"1"==e.innerHTML&&(this.ShowPositive=!0),e=r.f.SelectSingleNode(i.DocumentElement,"IsAccDoc"),null!=e&&"1"==e.innerHTML&&(this.IsAccDoc=!0),e=r.f.SelectSingleNode(i.DocumentElement,"UserWiseDims"),null!=e&&e.innerHTML.length>0){let t=e.innerHTML.split(",");for(let e=0;e<t.length;e++){let i,s=a.a.report.IsGroupNode(parseInt(t[e]),0),o=a.a.report.GetDataTable("RPT041",s.TableName,a.a.SessionManager.UserID,t[e]);i="",o.forEach(e=>{i.length>0&&(i+=","),i+=r.e.String(e.NodeID)}),0==i.length&&(i="-12345"),this.dicUserWiseDims.push(t[e],i)}}e=r.f.SelectSingleNode(i.DocumentElement,"CurrencyType"),null!=e&&(this.CurrencyType=parseInt(e.innerHTML),1==this.CurrencyType?(r.e.IsEmpty(a.a.SessionManager.Preferences.DimensionwiseCurrency)||0==parseInt(a.a.SessionManager.Preferences.DimensionwiseCurrency))&&(this.CurrencyType=0):2==this.CurrencyType&&(e=r.f.SelectSingleNode(i.DocumentElement,"FCCurrency"),this.ForeignCurrencyID=parseInt(e.innerHTML)))}return 14!=this.TypeID&&15!=this.TypeID&&102!=this.TypeID||(t=s.Tables[1][0].DefaultPreferences.toString(),i.LoadXml(t),e=r.f.SelectSingleNode(i.DocumentElement,"Slabs"),e.childNodes.forEach(e=>{parseInt(e.innerHTML)>0&&this.Slabs.push(parseInt(e.innerHTML))})),s}LoadTreeFilters(e){let t,i,s=!1,a=R.DefaultTreeCCID(this.TypeID.toString());for(let o=0;o<e.children.length;o++){let l=e.children[o];if(t="",s=!1,i=r.f.SelectSingleNode(l,"Groups"),null!=i&&(s=!0,t=i.innerHTML),i=r.f.SelectSingleNode(l,"Nodes"),null!=i&&(t.length>0&&(t+=","),t+=i.innerHTML),l.attributes.CC.value==a.toString())this.strAccounts=t,this.IsGroupsExists=s;else{let e=new M;e.Nodes=t,e.IsGroupsExists=s,"44"==l.attributes.CC.value?this.dicLookupFilters.push(parseInt(l.attributes.LookupTypeID.value),e):this.dicFilters.push(parseInt(l.attributes.CC.value),e)}}}SetDurationFilter(e,t=!0){this.DurationLinks.map(e=>e.IsLink=!1),e.IsLink=!0;let i=["CurMon","PrevMn"];if("Year"==e.Row?(i[0]="YrToDate",i[1]="LastYr"):"Quarter"==e.Row?(i[0]="QtrToDate",i[1]="PrevQtr"):"Week"==e.Row?(i[0]="WeekToDate",i[1]="PrevWeek"):"Day"==e.Row&&(i[0]="Today",i[1]="Yesterday"),!t)return i;this.SubFields[0].LabelType=i[0],this.SubFields[1].LabelType=i[1],this.Refresh()}SetValue(e,t=0){if(r.e.IsEmpty(e.LabelType))return null;let i=null;if(19==this.TypeID||20==this.TypeID)i=this.SetQueryBatchExpiryAgeing(e);else if(this.TypeID>=21&&this.TypeID<=100)i=this.SetQueryHRM(e);else{let t=null;if(t=14==this.TypeID||15==this.TypeID||102==this.TypeID||104==this.TypeID||105==this.TypeID||106==this.TypeID||107==this.TypeID?this.SetQueryAgeing(e):16==this.TypeID||17==this.TypeID?this.SetQueryDocumentStatus(e):103==this.TypeID?this.SetQueryDocumentLastInfo(e):this.SetQuery(e),null==t)return null;i=a.a.report.DataSetAsyn("RPT022",t)}return i?i.then(i=>{let s=this.SetValueCallBack(e,i);null!=this.Chart&&this.Chart.WidgetCallBack(t,s),this.LoadingVisibility=!1},e=>{this.LoadingVisibility=!1,Logger.ErrorLog("widget error",e),null!=this.Chart&&this.Chart.WidgetCallBack(t,null)}):void 0}SetValueCallBack(e,t){if(104==this.TypeID||105==this.TypeID||106==this.TypeID||107==this.TypeID){let i=0;if(t.Tables[0].forEach(e=>{i+=parseFloat(e.Balance)}),t.Tables[0].push({ID:3,Balance:i}),e.Value="",0==t.Tables[0].length)return null;if(!r.e.StringIsNullOrEmpty(e.LabelType)){let i=t.Tables[0].filter(t=>t.ID==parseInt(e.LabelType));i.length>0&&(e.dbl=parseFloat(i[0].Balance),e.Value=this.GetNumberFormatted(e.dbl,2,e))}this.SubFields.forEach(e=>{if(r.e.StringIsNullOrEmpty(e.LabelType))return;let i=t.Tables[0].filter(t=>t.ID==parseInt(e.LabelType));e.dbl=i.length>0?parseFloat(i[0].Balance):0,e.txtValue.Text=this.GetNumberFormatted(e.dbl,2,e)})}if(null!=this.Chart){if(5==this.TypeID||6==this.TypeID){let e,i,s=[];if(t.Tables[0].length>0)for(let o=t.Tables[0].length-1;o>=0;o--)if(i=s.filter(e=>e.AccountID==t.Tables[0][o].AccountID),e=parseFloat(t.Tables[0][o].Balance),i.length>0)i[0].Balance=parseFloat(i[0].Balance)+e;else{let i={};i.AccountID=t.Tables[0][o].AccountID,i.Balance=e,s.push(i)}else s=[];if(this.IncludeOpening){if(6==this.TypeID)for(let e=t.Tables[1].length-1;e>=0;e--)t.Tables[1][e].OpBalance=-parseFloat(t.Tables[1][e].OpBalance);for(let o=t.Tables[1].length-1;o>=0;o--)if(i=s.filter(e=>e.AccountID==t.Tables[1][o].AccountID),e=parseFloat(t.Tables[1][o].OpBalance),i.length>0)i[0].Balance=parseFloat(i[0].Balance)+e;else{let i={};i.AccountID=t.Tables[1][o].AccountID,i.Balance=e,s.push(i)}for(let e=t.Tables[1].length-1;e>=0;e--)parseFloat(s.filter(i=>i.AccountID==t.Tables[1][e].AccountID.toString())[0].Balance)<0&&t.Tables[1].RemoveAt(e);let a=t.Tables[1].Compute("sum","OpBalance");null==a&&(a=0),t.Tables[1].Clear();let r={};r.OpBalance=parseFloat(a),t.Tables[1].push(r)}for(let o=t.Tables[0].length-1;o>=0;o--)parseFloat(s.filter(e=>e.AccountID==t.Tables[0][o].AccountID)[0].Balance)<0&&t.Tables[0].RemoveAt(o);e=0;let a=null,r=null;if("YrWise"==this.Groups)for(let o=0;o<t.Tables[0].length;o++)a!=t.Tables[0][o].Yr.toString()?(e=parseFloat(t.Tables[0][o].Balance),a=t.Tables[0][o].Yr.toString()):(e+=parseFloat(t.Tables[0][o].Balance),t.Tables[0].RemoveAt(o),o--,t.Tables[0][o].Balance=e);else for(let o=0;o<t.Tables[0].length;o++)a!=t.Tables[0][o].Yr.toString()||r!=t.Tables[0][o].Mn.toString()?(e=parseFloat(t.Tables[0][o].Balance),a=t.Tables[0][o].Yr.toString(),r=t.Tables[0][o].Mn.toString()):(e+=parseFloat(t.Tables[0][o].Balance),t.Tables[0].RemoveAt(o),o--,t.Tables[0][o].Balance=e)}e.dbl=0,this.IncludeOpening&&(e.dbl=parseFloat(t.Tables[1][0].OpBalance)),this.ShowPositive&&(e.dbl=-e.dbl,t.Tables[0].forEach(e=>{e.Balance=-parseFloat(e.Balance)}))}else if(16==this.TypeID||17==this.TypeID)this.SetDocStatusCount(e,t),e.Value=this.GetNumberFormatted(e.dbl,0,e);else if(66==this.TypeID){let t=new Date((new Date).getFullYear(),a.a.SessionManager.AccountingFromMonth,1),i=new Date(a.a.SessionManager.AccountingFromMonth>1?(new Date).getFullYear()+1:(new Date).getFullYear(),a.a.SessionManager.AccountingToMonth,1);i=i.AddMonths(1).AddDays(-1),e.Value=t.ToString("MMM yyyy")+" - "+i.ToString("MMM yyyy")}else 67==this.TypeID?(e.breakSpaces=!0,e.Value="Assigned     Used        Balance\r\n",e.Value+=t.Tables[0].length>0?t.Tables[0][0].Assigned.toString()+"                 "+t.Tables[0][0].Deducted.toString()+"                 "+t.Tables[0][0].Balance.toString():"0                   0                 0"):103==this.TypeID||104==this.TypeID||105==this.TypeID||106==this.TypeID||107==this.TypeID||(t.Columns[0].Contains("Balance")&&r.e.StringValue(t.ColumnsTypes[0][t.Columns[0].indexOf("Balance")]).toLowerCase().Contains("string")?t.Tables[0].length>0&&(r.e.IsEmpty(t.Tables[0][0].Balance)||(e.Value=t.Tables[0][0].Balance.toString())):(e.dbl=t.Tables[0].length>0?parseFloat(t.Tables[0][0].Balance):0,this.ShowPositive&&(e.dbl=-e.dbl),e.Value=this.GetNumberFormatted(e.dbl,this.Decimals,e)));if(null==this.Chart){if(17==this.TypeID)this.Header.IsLink=this.IsLink,this.SubFields.forEach(e=>{this.SetDocStatusCount(e,t),e.txtValue.IsLink=this.IsLink,e.txtValue.Text=this.GetNumberFormatted(e.dbl,0,e),e.ShowPercentage&&(e.txtPercent.Text=0!=e.dbl?"  ["+(100*this.Header.dbl/e.dbl).Commas("N0")+"%]":"  ["+(0).Commas("N0")+"%]")});else if(103==this.TypeID){if(e.Value="",0==t.Tables[0].length)return null;if(!r.e.StringIsNullOrEmpty(e.LabelType)&&t.Columns[0].Contains(e.LabelType))if("Amount"==e.LabelType){let i=r.e.Double(t.Tables[0][0][e.LabelType]);e.Value=this.GetNumberFormatted(i,2,e)}else e.Value="DocDate"==e.LabelType?new Date(t.Tables[0][0][e.LabelType]).ToString(a.a.SessionManager.Preferences["Date Format"]):r.e.String(t.Tables[0][0][e.LabelType]);this.SubFields.forEach(e=>{if(!r.e.StringIsNullOrEmpty(e.LabelType)&&t.Columns[0].Contains(e.LabelType))if("Amount"==e.LabelType){let i=r.e.Double(t.Tables[0][0][e.LabelType]);e.txtValue.Text=this.GetNumberFormatted(i,2,e)}else e.txtValue.Text="DocDate"==e.LabelType?new Date(t.Tables[0][0][e.LabelType]).ToString(a.a.SessionManager.Preferences["Date Format"]):r.e.String(t.Tables[0][0][e.LabelType])})}else if(11==this.TypeID||12==this.TypeID||13==this.TypeID||14==this.TypeID||15==this.TypeID||18==this.TypeID||19==this.TypeID||20==this.TypeID||102==this.TypeID){if(this.SubFields.Clear(),this.SubFieldsText.Clear(),e.Value="0.00",0==t.Tables[0].length)return null;14!=this.TypeID&&15!=this.TypeID&&102!=this.TypeID||(e.dbl=t.Tables[0].length>0?parseFloat(t.Tables[0].Compute("sum","Balance")):0,this.ShowPositive&&(e.dbl=-e.dbl),e.Value=this.GetNumberFormatted(e.dbl,2,e));for(let e=0;e<t.Tables[0].length;e++){let i=new w;i.Row=e.toString(),i.ForeColor=this.ForeColor,i.SetSubFields(),i.txtLbl.Text=t.Tables[0][e][t.Columns[0][0]].toString();let s=parseFloat(t.Tables[0][e].Balance);this.ShowPositive&&(s=-s),i.dbl=s,i.txtValue.Text=this.GetNumberFormatted(s,2,i),11!=this.TypeID&&12!=this.TypeID&&13!=this.TypeID&&18!=this.TypeID||(i.txtPercent.Visible=!1),this.SubFields.push(i),this.SubFieldsText.push(i.txtLbl),this.SubFieldsText.push(i.txtValue),this.SubFieldsText.push(i.txtSep)}}17==this.TypeID||14==this.TypeID||15==this.TypeID||102==this.TypeID?this.SubFields.forEach(e=>{this.Header.Value&&this.Header.Value.length>0?(0!=e.dbl?(e.txtPercent.Percentage=0==this.Header.dbl||e.dbl>this.Header.dbl?100:100*e.dbl/this.Header.dbl,e.txtPercent.Percentage<0&&(e.txtPercent.Percentage=0)):e.txtPercent.Percentage=0,e.txtPercent.Text=0!=e.txtPercent.Percentage&&Math.abs(e.txtPercent.Percentage)<1?"  ["+e.txtPercent.Percentage.Commas("N1")+"%]":"  ["+e.txtPercent.Percentage.Commas("N0")+"%]"):e.txtPercent.Visible=!1}):this.SubFields.find(t=>t==e)&&(this.Header.Value&&this.Header.Value.length>0?(0!=e.dbl?(e.txtPercent.Percentage=0==this.Header.dbl||e.dbl>this.Header.dbl?100:100*e.dbl/this.Header.dbl,e.txtPercent.Percentage<0&&(e.txtPercent.Percentage=0)):e.txtPercent.Percentage=0,e.txtPercent.Text=0!=e.txtPercent.Percentage&&Math.abs(e.txtPercent.Percentage)<1?"  ["+e.txtPercent.Percentage.Commas("N1")+"%]":"  ["+e.txtPercent.Percentage.Commas("N0")+"%]"):e.txtPercent.Visible=!1)}return e.IsDataReady=!0,this.IsDurationDifference&&2==this.SubFields.length&&!this.SubFields.find(e=>!e.IsDataReady)&&(this.Header.dbl=this.SubFields[0].dbl-this.SubFields[1].dbl,this.Header.Value=this.GetNumberFormatted(this.Header.dbl,this.Decimals,this.Header)),t.Tables[0]}SetQuery(e){let t,i=!1,s="",a="",r="",o="",l="",n="",h="";null!=this.Chart&&11!=this.TypeID&&12!=this.TypeID&&13!=this.TypeID&&18!=this.TypeID&&(i=!0),s=this.IncludeOpening&&null==this.Chart?" and D.DocDate<=@To":" and D.DocDate between @Fr and @To";let u=this.GetDateVariable(e);n="D.DocDate<@Fr";let D=" AND (D.StatusID=369 or D.StatusID=429)",c="(D.StatusID=370 OR D.StatusID=439 OR D.StatusID=452)";this.IncludePDC?(l=this.IncludeOpening&&!i?" AND ("+c+" OR (D.DocumentType<>14 AND D.DocumentType<>19"+D+"))":" AND D.DocumentType<>16 AND ("+c+" OR (D.DocumentType<>14 AND D.DocumentType<>19"+D+"))",n+=" AND ("+c+" OR (D.DocumentType<>14 AND D.DocumentType<>19"+D+"))"):(l=this.IncludeOpening&&!i?" AND D.DocumentType NOT IN (14,19)"+D:" AND D.DocumentType NOT IN (16,14,19)"+D,n+=" AND D.DocumentType<>14 AND D.DocumentType<>19"+D);let d=this.GetDimensionWhere("DCC.dcCCNID");(d.length>0||this.Groups.startsWith("DIM_"))&&(r=" join COM_DocCCDATA DCC with(nolock) on DCC.AccDocDetailsID=D.AccDocDetailsID",o=" join COM_DocCCDATA DCC with(nolock) on DCC.InvDocDetailsID=D.InvDocDetailsID"),this.ForeignCurrencyID>0?(t="AmountFC",a=" AND D.CurrencyID="+this.ForeignCurrencyID):(t=1==this.CurrencyType?"AmountBC":"Amount",a="");let p="",C="",T="",m="",y="";if(5==this.TypeID||6==this.TypeID||11==this.TypeID||12==this.TypeID||18==this.TypeID?(C="A.AccountID,",T+="A.AccountID,"):13==this.TypeID&&(C="INV.ProductID,",T+="INV.ProductID,"),"YrWise"==this.Groups?(C+="year(convert(datetime,D.DocDate)) Yr,",T+="year(convert(datetime,D.DocDate)),",m+="Yr,"):"MnWise"==this.Groups||"QtrWise"==this.Groups?(C+="year(convert(datetime,D.DocDate)) Yr,month(convert(datetime,D.DocDate)) Mn,",T+="year(convert(datetime,D.DocDate)),month(convert(datetime,D.DocDate)),",m+="Yr,Mn,"):this.Groups.startsWith("DIM_")&&(C+="DIM.Name,",T+="DIM.Name,",m+="Name,",r+=" join "+F.b.GetTagTableName(parseInt(this.Groups.substr(4)))+" DIM with(nolock) on DIM.NodeID=DCC.dcCCNID"+(parseInt(this.Groups.substr(4))-5e4),o+=" join "+F.b.GetTagTableName(parseInt(this.Groups.substr(4)))+" DIM with(nolock) on DIM.NodeID=DCC.dcCCNID"+(parseInt(this.Groups.substr(4))-5e4)),T.length>0&&(T=" GROUP BY "+T.Trim(",")),11==this.TypeID||12==this.TypeID||13==this.TypeID)this.strAccounts.length>0?(this.IsGroupsExists?(y=" join ACC_Accounts GT on A2.lft BETWEEN GT.lft AND GT.rgt",p=this.strAccounts.Contains(",")?"GT.AccountID IN ("+this.strAccounts+")":"GT.AccountID="+this.strAccounts):p=this.strAccounts.Contains(",")?"A2.AccountID IN ("+this.strAccounts+")":"A2.AccountID="+this.strAccounts,11==this.TypeID||13==this.TypeID?p+=" and A.AccountTypeID=7":12==this.TypeID&&(p+=" and A.AccountTypeID=6")):11==this.TypeID||13==this.TypeID?p="A.AccountTypeID=7 and (A2.AccountTypeID=4 or A2.AccountTypeID=11)":12==this.TypeID&&(p="A.AccountTypeID=6 and (A2.AccountTypeID=5 or A2.AccountTypeID=14)"),r+=" join ACC_Accounts A2 with(nolock) on D.XXA2XX=A2.AccountID",o+=" join ACC_Accounts A2 with(nolock) on D.XXA2XX=A2.AccountID",13==this.TypeID&&(r+=" join INV_DocDetails INV with(nolock) on D.InvDocDetailsID=INV.InvDocDetailsID",o+=" join INV_DocDetails INV with(nolock) on D.InvDocDetailsID=INV.InvDocDetailsID");else if(this.strAccounts.length>0)this.IsGroupsExists?(y=" join ACC_Accounts GT on A.lft BETWEEN GT.lft AND GT.rgt",p=this.strAccounts.Contains(",")?"GT.AccountID IN ("+this.strAccounts+")":"GT.AccountID="+this.strAccounts):p=this.strAccounts.Contains(",")?"A.AccountID IN ("+this.strAccounts+")":"A.AccountID="+this.strAccounts;else if(101==this.TypeID)p="A.AccountTypeID=4";else if(2==this.TypeID)p="A.AccountTypeID=5";else if(3==this.TypeID||18==this.TypeID)p="(A.AccountTypeID=9 or A.AccountTypeID=12)";else if(4==this.TypeID)p="(A.AccountTypeID=8 or A.AccountTypeID=11)";else if(5==this.TypeID||6==this.TypeID)p="(A.AccountTypeID=6 or A.AccountTypeID=7)";else if(7==this.TypeID)p="(A.AccountTypeID=1 or A.AccountTypeID=10)";else if(8==this.TypeID)p="(A.AccountTypeID=2 or A.AccountTypeID=3)";else if(9==this.TypeID||10==this.TypeID)return null;return h+=u+"\r\n",5==this.TypeID||6==this.TypeID?(h+=m.length>0?"select "+m+"AccountID,isnull(sum(Balance),0) Balance from(":"select "+m+"isnull(sum(Balance),0) Balance from(",h+=5==this.TypeID?"select "+m+"AccountID,sum(Dr)-sum(Cr) Balance from(":"select "+m+"AccountID,sum(Cr)-sum(Dr) Balance from("):h+=11==this.TypeID||18==this.TypeID?"select top 5 A.AccountName,isnull(sum(Dr)-sum(Cr),0) Balance from(":12==this.TypeID?"select top 5 A.AccountName,isnull(sum(Cr)-sum(Dr),0) Balance from(":13==this.TypeID?"select top 5 P.ProductName,isnull(sum(Dr)-sum(Cr),0) Balance from(":"select "+m+"sum(Dr)-sum(Cr) Balance from(",h+="\nselect "+C+"sum("+t+") Dr,0 Cr from Acc_DocDetails D with(nolock)"+r.Replace("XXA2XX","CreditAccount")+"\njoin ACC_Accounts A with(nolock) on D.DebitAccount=A.AccountID"+y+"\nwhere "+p+s+d+l+a,h+=T,h+="\nunion all\nselect "+C+"0 Dr,sum("+t+") Cr from Acc_DocDetails D with(nolock)"+r.Replace("XXA2XX","DebitAccount")+"\njoin ACC_Accounts A with(nolock) on D.CreditAccount=A.AccountID"+y+"\nwhere "+p+s+d+l+a,h+=T,d.length>0&&(h+="\nunion all\nselect "+C+"sum("+t+") Dr,0 Cr from Acc_DocDetails D with(nolock)"+o.Replace("XXA2XX","CreditAccount")+"\njoin ACC_Accounts A with(nolock) on D.DebitAccount=A.AccountID"+y+"\nwhere "+p+s+d+a+" AND D.StatusID=369",h+=T,h+="\nunion all\nselect "+C+"0 Dr,sum("+t+") Cr from Acc_DocDetails D with(nolock)"+o.Replace("XXA2XX","DebitAccount")+"\njoin ACC_Accounts A with(nolock) on D.CreditAccount=A.AccountID"+y+"\nwhere "+p+s+d+a+" AND D.StatusID=369",h+=T),5!=this.TypeID&&6!=this.TypeID||(h+=")AS T group by AccountID",m.length>0?(h+=","+m.Trim(","),m+="AccountID,"):h+=5==this.TypeID?" having sum(Dr)-sum(Cr)>0":" having sum(Dr)-sum(Cr)<0"),h+=")AS T",11==this.TypeID||12==this.TypeID||18==this.TypeID?(h+=" join ACC_Accounts A with(nolock) on T.AccountID=A.AccountID",h+=" GROUP BY A.AccountName",h+=" ORDER BY Balance DESC"):13==this.TypeID?(h+=" join INV_Product P with(nolock) on T.ProductID=P.ProductID",h+=" GROUP BY P.ProductName",h+=" ORDER BY Balance DESC"):m.length>0&&(h+=" GROUP BY "+m.Trim(","),h+=" ORDER BY "+m.Trim(",")),this.IncludeOpening&&i&&(5==this.TypeID||6==this.TypeID?(C="A.AccountID,",T=" GROUP BY A.AccountID",m="AccountID,"):C=T=m="",h+="\n--OPENING\nselect "+m+"sum(Dr)-sum(Cr) OpBalance from(",h+="\nselect "+C+"sum("+t+") Dr,0 Cr from Acc_DocDetails D with(nolock)"+r.Replace("XXA2XX","CreditAccount")+"\njoin ACC_Accounts A with(nolock) on D.DebitAccount=A.AccountID"+y+"\nwhere "+p+d+a+" and ((D.DocumentType=16"+D+") OR ("+n+"))"+T,h+="\nunion all\nselect "+C+"0 Dr,sum("+t+") Cr from Acc_DocDetails D with(nolock)"+r.Replace("XXA2XX","DebitAccount")+"\njoin ACC_Accounts A with(nolock) on D.CreditAccount=A.AccountID"+y+"\nwhere "+p+d+a+" and ((D.DocumentType=16"+D+") OR ("+n+"))"+T,d.length>0&&(h+="\nunion all\nselect "+C+"sum("+t+") Dr,0 Cr from Acc_DocDetails D with(nolock)"+o.Replace("XXA2XX","CreditAccount")+"\njoin ACC_Accounts A with(nolock) on D.DebitAccount=A.AccountID"+y+"\nwhere "+p+d+a+" and D.DocDate<@Fr AND D.StatusID=369"+T,h+="\nunion all\nselect "+C+"0 Dr,sum("+t+") Cr from Acc_DocDetails D with(nolock)"+o.Replace("XXA2XX","DebitAccount")+"\njoin ACC_Accounts A with(nolock) on D.CreditAccount=A.AccountID"+y+"\nwhere "+p+d+a+" and D.DocDate<@Fr AND D.StatusID=369"+T),h+=")AS T",m.length>0&&(h+=" group by "+m.TrimEnd(","),h+=" order by "+m.TrimEnd(","))),h.toString()}SetQueryAgeing(e){let t,i="",s="",a="",r="",o=new Date;i="declare @Fr float,@To float",null!=this.Chart?(i+=" set @Fr=convert(float,convert(datetime,'"+this.Chart.FromDate.Date.ToString("dd MMM yyyy")+"'))",i+=" set @To=convert(float,convert(datetime,'"+this.Chart.ToDate.Date.ToString("dd MMM yyyy")+"'))"):i+=" set @Fr=0 set @To=convert(float,convert(datetime,'"+o.ToString("dd MMM yyyy")+"'))";let l=" AND (B.StatusID=369 or B.StatusID=429)";a=this.IncludePDC?" AND ((B.StatusID=370 OR B.StatusID=439 OR B.StatusID=452) OR (B.DocType<>14 AND B.DocType<>19"+l+"))":" AND B.DocType NOT IN (14,19)"+l;let n=this.GetDimensionWhere("B.dcCCNID");this.ForeignCurrencyID>0?(t="AmountFC",s=" AND B.AdjCurrID="+this.ForeignCurrencyID):(t=1==this.CurrencyType?"AmountBC":"AdjAmount",s="");let h="",u="";if(this.strAccounts.length>0?this.IsGroupsExists?(u=" JOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID join ACC_Accounts GT on A.lft BETWEEN GT.lft AND GT.rgt",h=this.strAccounts.Contains(",")?" and GT.AccountID IN ("+this.strAccounts+")":" and GT.AccountID="+this.strAccounts):h=this.strAccounts.Contains(",")?" and B.AccountID IN ("+this.strAccounts+")":" and B.AccountID="+this.strAccounts:(u=" JOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID",h=" and (A.AccountTypeID=6 or A.AccountTypeID=7)"),r+=i+"\r\n",r+="declare @TblAccs as Table(AccID bigint) ",104!=this.TypeID&&105!=this.TypeID&&106!=this.TypeID&&107!=this.TypeID){r+=" declare @Tbl As Table(ID INT,Slab nvarchar(15),FromDate FLOAT,ToDate FLOAT)";for(let e=0;e<=this.Slabs.length;e++)r+=e==this.Slabs.length?" INSERT INTO @Tbl VALUES("+e+",'>"+this.Slabs[this.Slabs.length-1]+"',1,@To-"+this.Slabs[this.Slabs.length-1]+")":0==e?" INSERT INTO @Tbl VALUES("+e+",'0-"+(this.Slabs[e]-1)+"',@To-"+(this.Slabs[e]-1)+",@To)":" INSERT INTO @Tbl VALUES("+e+",'"+this.Slabs[e-1]+"-"+(this.Slabs[e]-1)+"',@To-"+(this.Slabs[e]-1)+",@To-"+this.Slabs[e-1]+")"}let D="";return D=15==this.TypeID||105==this.TypeID||106==this.TypeID?"<0":14==this.TypeID||104==this.TypeID||107==this.TypeID?">0":"!=0",104==this.TypeID||105==this.TypeID||106==this.TypeID||107==this.TypeID?(r+="\nselect DueStatus ID,"+(105==this.TypeID||106==this.TypeID?"-":"")+"isnull(sum(Balance),0) Balance from\n(\nSELECT case when isnull(DocDueDate,DocDate)<@To then 2 else 1 end DueStatus\n,"+t+"+ISNULL((SELECT SUM(CB."+t+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@To"+a.Replace("B.","CB.")+"),0) Balance\nFROM COM_Billwise B with(nolock)\nJOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID\nWHERE B.IsNewReference=1 AND B.DocDate<=@To",104==this.TypeID||106==this.TypeID?r+=" and A.AccountTypeID=7":105!=this.TypeID&&107!=this.TypeID||(r+=" and A.AccountTypeID=6"),r+=a,r+=n,r+=s,r+="\n) AS T\nwhere Balance"+D+"\ngroup by DueStatus"):(r+="\n            insert into @TblAccs\n            select AccountID from (\n            SELECT B.AccountID\n            ,"+t+"+ISNULL((SELECT SUM(CB."+t+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@To"+a.Replace("B.","CB.")+"),0) Balance\n            FROM COM_Billwise B with(nolock)"+u+"\n            WHERE B.IsNewReference=1 AND B.DocDate<=@To",r+=a+h,r+=n,r+=s,r+="\n            ) as T\n            group by AccountID\n            having sum(Balance)"+D+" and abs(sum(Balance))>0.01",r+="\n    select S.Slab,"+(15==this.TypeID?"-":"")+"isnull(sum(Balance),0) Balance from\n    (\n    SELECT T.ID\n    ,"+t+"+ISNULL((SELECT SUM(CB."+t+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@To"+a.Replace("B.","CB.")+"),0) Balance\n    FROM COM_Billwise B with(nolock)\n    join @TblAccs TA on TA.AccID=B.AccountID\n    join @Tbl T on B.DocDate BETWEEN T.FromDate AND T.ToDate\n    WHERE B.IsNewReference=1 AND B.DocDate<=@To",r+=a,r+=n,r+=s,r+="\n    ) AS T\n    right join @Tbl S on S.ID=T.ID\n    where Balance"+D+"\n    group by S.ID,S.Slab\n    order by S.ID"),r.toString()}SetQueryDocumentStatus(e){let t,i="",s="",r="";i="AsOnDate"==e.LabelType?" and D.DocDate<=@To":" and D.DocDate between @Fr and @To";let o=this.GetDateVariable(e),l=this.GetDimensionWhere("DCC.dcCCNID");l.length>0&&(s=this.IsAccDoc?" join COM_DocCCDATA DCC with(nolock) on DCC.AccDocDetailsID=D.AccDocDetailsID":" join COM_DocCCDATA DCC with(nolock) on DCC.InvDocDetailsID=D.InvDocDetailsID"),2!=a.a.SessionManager.RoleType&&3!=a.a.SessionManager.RoleType||(l+=" and (D.DebitAccount="+a.a.SessionManager.ESSID+" or D.CreditAccount="+a.a.SessionManager.ESSID+")"),t=this.IsAccDoc?"ACC_DocDetails":"INV_DocDetails";let n="",h="",u="",D="";if("YrWise"==this.Groups?(h+="year(convert(datetime,D.DocDate)) Yr,",u+="year(convert(datetime,D.DocDate)),",D+="Yr,"):"MnWise"!=this.Groups&&"QtrWise"!=this.Groups||(h+="year(convert(datetime,D.DocDate)) Yr,month(convert(datetime,D.DocDate)) Mn,",u+="year(convert(datetime,D.DocDate)),month(convert(datetime,D.DocDate)),",D+="Yr,Mn,"),u.length>0&&(u=" GROUP BY "+u.Trim(",")),n=this.strAccounts.length>0?this.strAccounts.Contains(",")?"D.CostCenterID in ("+this.strAccounts+")":"D.CostCenterID="+this.strAccounts:"1=1",16==this.TypeID&&"0"!=e.StatusID&&"21"!=e.StatusID&&"22"!=e.StatusID&&"23"!=e.StatusID&&"31"!=e.StatusID&&"32"!=e.StatusID&&"33"!=e.StatusID&&(n+=" and D.StatusID="+e.StatusID),r+=o+"\r\n",this.IsGeneralDocs?("376"==this.Header.StatusID||this.SubFields.find(e=>"376"==e.StatusID)||(l+=" and D.StatusID!=376"),r+="select T.StatusID,count(*) Balance\nfrom\n(\nselect DocID,VoucherNo,case when count(*)>1 then -1 else max(StatusID) end StatusID\nfrom\n(\nselect "+h+"DocID,VoucherNo,StatusID\nfrom "+t+" D with(nolock)"+s+"\nwhere "+n+i+l+"\ngroup by DocID,VoucherNo,StatusID\n) AS T\ngroup by DocID,VoucherNo\n) AS T\ngroup by T.StatusID"):r+=" select 0 NOQUERY where 1!=1",!this.IsAccDoc&&this.IsExecutedDocs&&this.strAccounts.length>0){let e=this.strAccounts.split(",");r+="\nselect StatusID,count(*) Balance from(\nselect DocID,case when sum(Quantity)<=sum(ExeQty) then 22 when sum(ExeQty)>0 and sum(Quantity)>sum(ExeQty) then 23 else 21 end StatusID\nfrom(\r\n";for(let t=0;t<e.length;t++){let o=!0;if(!this.dicExecutedQuery.ContainsKey(e[t])){let i=a.a.report.GetExecutedQtyQuery(0,e[t],null,null,o,!1);i=0==i.length?"0":i.Replace("INV.","D.").Replace("inv.","D."),this.dicExecutedQuery.push(e[t],i)}t>0&&(r+="\r\nunion all\r\n"),this.dicExecutedQuery[e[t]].Contains("NUM")&&!s.Contains("COM_DocNumData")&&(s+=this.IsAccDoc?" join COM_DocNumData NUM with(nolock) on NUM.AccDocDetailsID=D.AccDocDetailsID":" join COM_DocNumData NUM with(nolock) on NUM.InvDocdetailsID=D.InvDocdetailsID"),r+="SELECT D.DocID,D.Quantity,"+this.dicExecutedQuery[e[t]]+" ExeQty\nFROM INV_DocDetails D with(nolock)"+s+"\nWHERE D.CostCenterID="+e[t]+" and D.StatusID!=376"+i+l}r+=") AS T\ngroup by DocID\n) as T\ngroup by StatusID"}else r+=" select 0 NOQUERY where 1!=1";return this.IsBWDocs&&(r+="\n            select StatusID, count(*) Balance from(\n                select case when PaidAmt = 0 then 31 when BillAmt > PaidAmt then 32  else 33 end StatusID from(\n                    select VoucherNo\n                    , (SELECT ISNULL(SUM(abs(AdjAmount)), 0) FROM COM_Billwise CB WITH(NOLOCK) WHERE CB.DocNo = D.VoucherNo) BillAmt\n                , (SELECT ISNULL(SUM(abs(AdjAmount)), 0) FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference = 0 AND(CB.RefDocNo = D.VoucherNo OR CB.DocNo = D.VoucherNo)) PaidAmt\n            from "+t+" D with (nolock) "+s+"\n            where "+n+i+l+" and StatusID = 369\n            group by VoucherNo) AS T\n) AS T\n            group by StatusID"),r.toString()}SetQueryDocumentStatusDetails(e,t){let i,s="",r="",o="";s="AsOnDate"==e.LabelType?" and D.DocDate<=@To":" and D.DocDate between @Fr and @To";let l=this.GetDateVariable(e),n=this.GetDimensionWhere("DCC.dcCCNID");n.length>0&&(r=this.IsAccDoc?" join COM_DocCCDATA DCC with(nolock) on DCC.AccDocDetailsID=D.AccDocDetailsID":" join COM_DocCCDATA DCC with(nolock) on DCC.InvDocDetailsID=D.InvDocDetailsID"),i=this.IsAccDoc?"ACC_DocDetails":"INV_DocDetails";let h="",u="",D="",c="";if("YrWise"==this.Groups?(u+="year(convert(datetime,D.DocDate)) Yr,",D+="year(convert(datetime,D.DocDate)),",c+="Yr,"):"MnWise"!=this.Groups&&"QtrWise"!=this.Groups||(u+="year(convert(datetime,D.DocDate)) Yr,month(convert(datetime,D.DocDate)) Mn,",D+="year(convert(datetime,D.DocDate)),month(convert(datetime,D.DocDate)),",c+="Yr,Mn,"),D.length>0&&(D=" GROUP BY "+D.Trim(",")),h=this.strAccounts.length>0?this.strAccounts.Contains(",")?"D.CostCenterID in ("+this.strAccounts+")":"D.CostCenterID="+this.strAccounts:"1=1","0"!=t&&"21"!=t&&"22"!=t&&"23"!=t&&"31"!=t&&"32"!=t&&"33"!=t&&(h+=" and D.StatusID="+t),o+=l+"\r\n","21"!=t&&"22"!=t&&"23"!=t)"376"==this.Header.StatusID||this.SubFields.find(e=>"376"==e.StatusID)||(n+=" and D.StatusID!=376"),o+="\nselect convert(datetime,D.DocDate) DocDate,D.VoucherNo"+(this.IsAccDoc?"":",sum(D.Quantity) Quantity")+"\nfrom "+i+" D with(nolock)"+r+"\nwhere "+h+s+n+"\ngroup by DocDate,VoucherNo\n";else if(!this.IsAccDoc&&this.IsExecutedDocs&&this.strAccounts.length>0){let e=this.strAccounts.split(",");o+="\nselect Convert(DateTime,DocDate) DocDate,VoucherNo,sum(Quantity) Quantity,sum(ExeQty) ExeQty,case when sum(Quantity)<=sum(ExeQty) then 22 when sum(ExeQty)>0 and sum(Quantity)>sum(ExeQty) then 23 else 21 end StatusID\nfrom(\r\n";for(let t=0;t<e.length;t++){let i=!0;if(!this.dicExecutedQuery.ContainsKey(e[t])){let s=a.a.report.GetExecutedQtyQuery(0,e[t],null,null,i,!1);s=0==s.length?"0":s.Replace("INV.","D.").Replace("inv.","D."),this.dicExecutedQuery.push(e[t],s)}t>0&&(o+="\r\nunion all\r\n"),this.dicExecutedQuery[e[t]].Contains("NUM")&&!r.Contains("COM_DocNumData")&&(r+=this.IsAccDoc?" join COM_DocNumData NUM with(nolock) on NUM.AccDocDetailsID=D.AccDocDetailsID":" join COM_DocNumData NUM with(nolock) on NUM.InvDocdetailsID=D.InvDocdetailsID"),o+="SELECT D.DocDate,D.VoucherNo,D.Quantity,"+this.dicExecutedQuery[e[t]]+" ExeQty\nFROM INV_DocDetails D with(nolock)"+r+"\nWHERE D.CostCenterID="+e[t]+" and D.StatusID!=376"+s+n}o+="\n) AS T\ngroup by DocDate,VoucherNo","21"==t?o+=" having sum(ExeQty)=0":"22"==t?o+=" having sum(Quantity)<=sum(ExeQty)":"23"==t&&(o+=" having sum(ExeQty)>0 and sum(Quantity)>sum(ExeQty)")}return o.toString()}SetQueryDocumentLastInfo(e){let t,i="",s="",r=this.GetDimensionWhere("DCC.dcCCNID");r.length>0&&(i=this.IsAccDoc?" join COM_DocCCDATA DCC with(nolock) on DCC.AccDocDetailsID=D.AccDocDetailsID":" join COM_DocCCDATA DCC with(nolock) on DCC.InvDocDetailsID=D.InvDocDetailsID"),2!=a.a.SessionManager.RoleType&&3!=a.a.SessionManager.RoleType||(r+=" and (D.DebitAccount="+a.a.SessionManager.ESSID+" or D.CreditAccount="+a.a.SessionManager.ESSID+")"),t=this.IsAccDoc?"ACC_DocDetails":"INV_DocDetails";let o,l="";return l=this.strAccounts.length>0?this.strAccounts.Contains(",")?"D.CostCenterID in ("+this.strAccounts+")":"D.CostCenterID="+this.strAccounts:"1=1",o=this.IsAccDoc?",sum(D.Amount)/2 Amount":",sum(D.StockValue) Amount",s="\n        declare @Vno nvarchar(max)\n        select top 1 @Vno=VoucherNo\n        from "+t+" D with (nolock) "+i+"\n        where "+l+r+"\n        order by D.Docdate desc, D.CreatedDate desc\n\n        select max(VoucherNo) VoucherNo, Convert(datetime, max(DocDate)) DocDate"+o+"\n        from "+t+" D with (nolock) "+i+"\n        where VoucherNo =@Vno",s.toString()}SetQueryBatchExpiryAgeing(e){let t=new Date;null!=this.Chart&&(t=this.Chart.ToDate.Date);let i=this.GetDimensionWhere("DCC.dcCCNID"),s=[];return s.push(t),s.push(19==this.TypeID?1:0),s.push(i),s.push(a.a.SessionManager.LanguageID),a.a.report.BatchAgeing(s)}SetQueryHRM(e){let t=this.GetDateVariable(e),i="";i=this.GetDimensionWhere(22==this.TypeID||23==this.TypeID||24==this.TypeID?"DCC.CCNID":"DCC.dcCCNID"),this.dicLookupFilters.ContainsKey(108)&&(this.dicLookupFilters[108].Nodes.Contains(",")?i+=" and E.Nationality in ("+this.dicLookupFilters[108].Nodes+")":i+=" and E.Nationality="+this.dicLookupFilters[108].Nodes),this.dicLookupFilters.ContainsKey(123)&&(this.dicLookupFilters[123].Nodes.Contains(",")?i+=" and E.Gender in ("+this.dicLookupFilters[123].Nodes+")":i+=" and E.Gender="+this.dicLookupFilters[123].Nodes);let s=[];return s.push(this.TypeID),s.push(this.Groups),s.push(t),s.push(i),s.push(a.a.SessionManager.LanguageID),a.a.report.GetWidgetHRM(s)}GetDateVariable(e){let t="";t="declare @Fr float,@To float,@EMPID bigint",this.HeaderValuePostfix="";let i=new Date,s=new Date((new Date).getFullYear(),a.a.SessionManager.AccountingFromMonth-1,1);if(s>new Date&&(s=s.AddYears(-1)),null!=this.Chart)this.PrevData>0?(t+=" set @Fr=convert(float,convert(datetime,'"+this.Chart.FromDate.Date.AddYears(-this.PrevData).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+this.Chart.ToDate.Date.ToString("dd MMM yyyy")+"'))"):(t+=" set @Fr=convert(float,convert(datetime,'"+this.Chart.FromDate.Date.ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+this.Chart.ToDate.Date.ToString("dd MMM yyyy")+"'))");else if("Today"==e.LabelType)this.HeaderValuePostfix="Today",t+=" set @Fr=convert(float,convert(datetime,'"+i.ToString("dd MMM yyyy")+"')) set @To=@Fr";else if("Yesterday"==e.LabelType)this.HeaderValuePostfix="YSTD",t+=" set @Fr=convert(float,convert(datetime,'"+i.AddDays(-1).ToString("dd MMM yyyy")+"')) set @To=@Fr";else if("AsOnDate"==e.LabelType)this.HeaderValuePostfix="AOD",t+=" set @Fr=0 set @To=convert(float,convert(datetime,'"+i.ToString("dd MMM yyyy")+"'))";else if("MnToDate"==e.LabelType)this.HeaderValuePostfix="MTD",t+=" set @Fr=convert(float,convert(datetime,'"+new Date(i.getFullYear(),i.getMonth(),1).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+i.ToString("dd MMM yyyy")+"'))";else if("QtrToDate"==e.LabelType){this.HeaderValuePostfix="QTD";let e=(i.iMonth()-1)/3+1;i=new Date(i.getFullYear(),3*(e-1),1),t+=" set @Fr=convert(float,convert(datetime,'"+i.ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+(new Date).ToString("dd MMM yyyy")+"'))"}else if("YrToDate"==e.LabelType)this.HeaderValuePostfix="YTD",t+=" set @Fr=convert(float,convert(datetime,'"+s.ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+i.ToString("dd MMM yyyy")+"'))";else if("CurMon"==e.LabelType)this.HeaderValuePostfix="CM",i=new Date(i.getFullYear(),i.getMonth(),1),t+=" set @Fr=convert(float,convert(datetime,'"+i.ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+i.AddMonths(1).AddDays(-1).ToString("dd MMM yyyy")+"'))";else if("CurMonToDate"==e.LabelType)this.HeaderValuePostfix="CMTD",i=new Date(i.getFullYear(),i.getMonth(),1),t+=" set @Fr=convert(float,convert(datetime,'"+i.ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+Date.Today().ToString("dd MMM yyyy")+"'))";else if("PrevMn"==e.LabelType)this.HeaderValuePostfix="PM",i=new Date(i.getFullYear(),i.getMonth(),1),t+=" set @Fr=convert(float,convert(datetime,'"+i.AddMonths(-1).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+i.AddDays(-1).ToString("dd MMM yyyy")+"'))";else if("PrevMnToDate"==e.LabelType)this.HeaderValuePostfix="PMTD",t+=" set @To=convert(float,convert(datetime,'"+i.AddMonths(-1).ToString("dd MMM yyyy")+"'))",i=new Date(i.getFullYear(),i.getMonth(),1),t+=" set @Fr=convert(float,convert(datetime,'"+i.AddMonths(-1).ToString("dd MMM yyyy")+"'))";else if("PrevQtr"==e.LabelType){this.HeaderValuePostfix="PQ";let e=(i.iMonth()-1)/3+1;i=new Date(i.getFullYear(),3*(e-1),1),t+=" set @Fr=convert(float,convert(datetime,'"+i.AddMonths(-3).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+i.AddDays(-1).ToString("dd MMM yyyy")+"'))"}else if("PrevQtrToDate"==e.LabelType){this.HeaderValuePostfix="PQTD";let e=(i.iMonth()-1)/3+1;i=new Date(i.getFullYear(),3*(e-1),1),t+=" set @Fr=convert(float,convert(datetime,'"+i.AddMonths(-3).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+(new Date).AddMonths(-3).ToString("dd MMM yyyy")+"'))"}else if("LastYr"==e.LabelType)this.HeaderValuePostfix="LY",t+=" set @Fr=convert(float,convert(datetime,'"+s.AddYears(-1).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+s.AddDays(-1).ToString("dd MMM yyyy")+"'))";else if("LastYrToDate"==e.LabelType)this.HeaderValuePostfix="LYTD",i=new Date(i.getFullYear()-1,0,1),t+=" set @Fr=convert(float,convert(datetime,'"+s.AddYears(-1).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+(new Date).AddYears(-1).ToString("dd MMM yyyy")+"'))";else if("LastYrMn"==e.LabelType)this.HeaderValuePostfix="LYM",i=new Date(i.getFullYear()-1,i.getMonth(),1),t+=" set @Fr=convert(float,convert(datetime,'"+i.ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+i.AddMonths(1).AddDays(-1).ToString("dd MMM yyyy")+"'))";else if("LastYrMnToDate"==e.LabelType)this.HeaderValuePostfix="LYMTD",i=new Date(i.getFullYear()-1,i.getMonth(),1),t+=" set @Fr=convert(float,convert(datetime,'"+i.ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+(new Date).AddYears(-1).ToString("dd MMM yyyy")+"'))";else if("LastYrQtr"==e.LabelType){this.HeaderValuePostfix="LYQ";let e=(i.iMonth()-1)/3+1;i=new Date(i.getFullYear()-1,3*(e-1),1),t+=" set @Fr=convert(float,convert(datetime,'"+i.ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+i.AddMonths(3).AddDays(-1).ToString("dd MMM yyyy")+"'))"}else if("LastYrQtrToDate"==e.LabelType){this.HeaderValuePostfix="LYQTD";let e=(i.iMonth()-1)/3+1;i=new Date(i.getFullYear()-1,3*(e-1),1),t+=" set @Fr=convert(float,convert(datetime,'"+i.ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+(new Date).AddYears(-1).ToString("dd MMM yyyy")+"'))"}else if("WeekToDate"==e.LabelType){this.HeaderValuePostfix="WTD";let e=i.getDate()-i.getDay();i.setDate(e+1),t+=" set @Fr=convert(float,convert(datetime,'"+i.ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+Date.Today().ToString("dd MMM yyyy")+"'))"}else if("PrevWeek"==e.LabelType){this.HeaderValuePostfix="LWTD";let e=i.getDate()-i.getDay();i.setDate(e+1),t+=" set @Fr=convert(float,convert(datetime,'"+i.AddDays(-7).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+i.AddDays(-1).ToString("dd MMM yyyy")+"'))"}return t+=" set @EMPID="+a.a.SessionManager.iEmployee,t}GetDimensionWhere(e){let t="";return"True"==a.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==a.a.SessionManager.Preferences["LW Reports"]&&(a.a.SessionManager.LocationID>0?t=" and "+e+"2="+a.a.SessionManager.LocationID:"1"!=a.a.SessionManager.RoleID&&a.a.SessionManager.LocationWhere.length>0&&(t=" and "+e+"2 in ("+a.a.SessionManager.LocationWhere+")")),this.dicUserWiseDims.keys.forEach(i=>{let s={Key:i,Value:this.dicUserWiseDims[i]};s.Value.Contains(",")?t+=" and "+e+(parseInt(s.Key)-5e4)+" in ("+s.Value+")":t+=" and "+e+(parseInt(s.Key)-5e4)+"="+s.Value}),this.dicFilters.keys.forEach(i=>{let s={Key:i,Value:this.dicFilters[i]};s.Key>5e4&&(s.Value.Nodes.Contains(",")?t+=" and "+e+(s.Key-5e4)+" in ("+s.Value.Nodes+")":t+=" and "+e+(s.Key-5e4)+"="+s.Value.Nodes)}),t}SetDocStatusCount(e,t){let i,s=t.Tables[0];if("21"==e.StatusID||"22"==e.StatusID||"23"==e.StatusID?s=t.Tables[1]:"31"==e.StatusID||"32"==e.StatusID||"33"==e.StatusID?s=t.Tables[2]:"0"==e.StatusID&&t.Columns[0].Contains("NOQUERY")&&(s=t.Tables[1]),"0"==e.StatusID){let t=s.filter(e=>376!=e.StatusID).Compute("sum","Balance");e.dbl=null!=t?parseFloat(t):0}else i=s.filter(t=>t.StatusID==e.StatusID),e.dbl=i.length>0?parseFloat(i[0].Balance):0}Refresh(){this.LoadingVisibility=!0;try{if(26==this.TypeID||27==this.TypeID)return void this.WidgetCalendar.Refresh();let e=this.SetValue(this.Header);this.Header.Visible&&null!=this.Header.txtLbl&&this.HeaderValuePostfix.length>0&&(this.Header.txtLbl.Text=" ["+this.HeaderValuePostfix+"]"),11!=this.TypeID&&12!=this.TypeID&&13!=this.TypeID&&14!=this.TypeID&&15!=this.TypeID&&17!=this.TypeID&&18!=this.TypeID&&19!=this.TypeID&&20!=this.TypeID&&102!=this.TypeID&&103!=this.TypeID&&104!=this.TypeID&&105!=this.TypeID&&106!=this.TypeID&&107!=this.TypeID&&(null==e&&(e=new Promise((e,t)=>{e("hi")})),e.then(()=>{this.SubFields.map(e=>0==e.IsDataReady),this.SubFields.forEach(e=>{this.SetValue(e)})},e=>{this.LoadingVisibility=!1}))}catch(e){this.LoadingVisibility=!1,Logger.ErrorLog("Widget Refresh: ",e)}}OnValueClick(e){let t=null!=e?e.WzLbl.StatusID:this.Header.StatusID,i=this.SetQueryDocumentStatusDetails(this.Header,t);if(null==i)return;let s=a.a.report.DataSet("RPT022",i);this.CallStatusID=t;let r=new b.AccountDrillDownViewModel(null,this);r.Title=null!=e?e.WzLbl.txtLbl.Text:this.Header.Label,r.LoadWidgetData(s),a.a.page.ShowDialog(r,A.a,{ShowCenter:!0})}static DefaultTreeCCID(e){let t=0;return t="16"==e||"17"==e||"103"==e?300:"21"==e||"22"==e||"23"==e||"24"==e||"25"==e||"26"==e||"27"==e?50002:2,t}GetNumberFormatted(e,t,i){let s="";if(r.e.IsEmptySpace(i.Formula)){let i="";i=t>0?"N"+t.toString():"N0",s=e.Commas(i)}else{let r=this.fldDict;this.fldDict.value.setFieldValue(e),this.fldDict.Value.setFieldValue(e),this.fldDict.VALUE.setFieldValue(e);try{s=this.eval.EvaluateExpression(i.Formula,r).toString()}catch(a){let i="";i=t>0?"N"+t.toString():"N0",s="#"+e.Commas(i)}}return s}OnNumberClick(e){if(17==this.TypeID||16==this.TypeID){let t="",i=this.GetDateFilterXML(e);if(i.length>0&&(t="<XML>"+i+"</XML>"),0==this.strAccounts.length)return void alert("No Documents Selected For Widget");let s=r.e.Int(e.StatusID),a=this.strAccounts.split(",");21==s||22==s||23==s?(21==s?s=-1:22==s?s=-2:23==s&&(s=-3),f.a.LoadDocumentLandingPage(a[0],a[0],s,"",{DocsList:this.strAccounts,ReportFilterXML:t},!0)):f.a.LoadDocumentLandingPage(a[0],a[0],s>0?" and INV.StatusID="+s:"","",{DocsList:this.strAccounts,ReportFilterXML:t},!0)}}GetDateFilterXML(e){let t="",i=new Date,s=new Date((new Date).getFullYear(),a.a.SessionManager.AccountingFromMonth-1,1);if(s>new Date&&(s=s.AddYears(-1)),null!=this.Chart)t=this.PrevData>0?"<Row ColID='FROMDATE' Value='"+this.Chart.FromDate.Date.AddYears(-this.PrevData).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+this.Chart.ToDate.Date.ToString("dd MMM yyyy")+"'/>":"<Row ColID='FROMDATE' Value='"+this.Chart.FromDate.Date.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+this.Chart.ToDate.Date.ToString("dd MMM yyyy")+"'/>";else if("Today"==e.LabelType)t="<Row ColID='FROMDATE' Value='"+i.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+i.ToString("dd MMM yyyy")+"'/>";else if("Yesterday"==e.LabelType)t="<Row ColID='FROMDATE' Value='"+i.AddDays(-1).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+i.AddDays(-1).ToString("dd MMM yyyy")+"'/>";else if("AsOnDate"==e.LabelType)t="<Row ColID='ASONDATE' Value='"+i.ToString("dd MMM yyyy")+"'/>";else if("MnToDate"==e.LabelType)t="<Row ColID='FROMDATE' Value='"+new Date(i.getFullYear(),i.getMonth(),1).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+i.ToString("dd MMM yyyy")+"'/>";else if("QtrToDate"==e.LabelType){let e=(i.iMonth()-1)/3+1;i=new Date(i.getFullYear(),3*(e-1),1),t="<Row ColID='FROMDATE' Value='"+i.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+(new Date).ToString("dd MMM yyyy")+"'/>"}else if("YrToDate"==e.LabelType)t="<Row ColID='FROMDATE' Value='"+s.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+i.ToString("dd MMM yyyy")+"'/>";else if("CurMon"==e.LabelType)i.iMonth(),i=new Date(i.getFullYear(),i.getMonth(),1),t="<Row ColID='FROMDATE' Value='"+i.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+i.AddMonths(1).AddDays(-1).ToString("dd MMM yyyy")+"'/>";else if("CurMonToDate"==e.LabelType)i=new Date(i.getFullYear(),i.getMonth(),1),t="<Row ColID='FROMDATE' Value='"+i.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+Date.Today().ToString("dd MMM yyyy")+"'/>";else if("PrevMn"==e.LabelType)i=new Date(i.getFullYear(),i.getMonth(),1),t="<Row ColID='FROMDATE' Value='"+i.AddMonths(-1).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+i.AddDays(-1).ToString("dd MMM yyyy")+"'/>";else if("PrevMnToDate"==e.LabelType)t="<Row ColID='TODATE' Value='"+i.AddMonths(-1).ToString("dd MMM yyyy")+"'/>",i=new Date(i.getFullYear(),i.getMonth(),1),t+="<Row ColID='FROMDATE' Value='"+i.AddMonths(-1).ToString("dd MMM yyyy")+"'/>";else if("PrevQtr"==e.LabelType){let e=(i.iMonth()-1)/3+1;i=new Date(i.getFullYear(),3*(e-1),1),t="<Row ColID='FROMDATE' Value='"+i.AddMonths(-3).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+i.AddDays(-1).ToString("dd MMM yyyy")+"'/>"}else if("PrevQtrToDate"==e.LabelType){let e=(i.iMonth()-1)/3+1;i=new Date(i.getFullYear(),3*(e-1),1),t="<Row ColID='FROMDATE' Value='"+i.AddMonths(-3).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+(new Date).AddMonths(-3).ToString("dd MMM yyyy")+"'/>"}else if("LastYr"==e.LabelType)t="<Row ColID='FROMDATE' Value='"+s.AddYears(-1).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+s.AddDays(-1).ToString("dd MMM yyyy")+"'/>";else if("LastYrToDate"==e.LabelType)i=new Date(i.getFullYear()-1,0,1),t="<Row ColID='FROMDATE' Value='"+s.AddYears(-1).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+(new Date).AddYears(-1).ToString("dd MMM yyyy")+"'/>";else if("LastYrMn"==e.LabelType)i=new Date(i.getFullYear()-1,i.getMonth(),1),t="<Row ColID='FROMDATE' Value='"+i.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+i.AddMonths(1).AddDays(-1).ToString("dd MMM yyyy")+"'/>";else if("LastYrMnToDate"==e.LabelType)i=new Date(i.getFullYear()-1,i.getMonth(),1),t="<Row ColID='FROMDATE' Value='"+i.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+(new Date).AddYears(-1).ToString("dd MMM yyyy")+"'/>";else if("LastYrQtr"==e.LabelType){let e=(i.iMonth()-1)/3+1;i=new Date(i.getFullYear()-1,3*(e-1),1),t="<Row ColID='FROMDATE' Value='"+i.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+i.AddMonths(3).AddDays(-1).ToString("dd MMM yyyy")+"'/>"}else if("LastYrQtrToDate"==e.LabelType){let e=(i.iMonth()-1)/3+1;i=new Date(i.getFullYear()-1,3*(e-1),1),t="<Row ColID='FROMDATE' Value='"+i.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+(new Date).AddYears(-1).ToString("dd MMM yyyy")+"'/>"}else if("WeekToDate"==e.LabelType){this.HeaderValuePostfix="WTD";let e=i.getDate()-i.getDay();i.setDate(e+1),t="<Row ColID='FROMDATE' Value='"+i.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+Date.Today().ToString("dd MMM yyyy")+"'/>"}else if("PrevWeek"==e.LabelType){this.HeaderValuePostfix="LWTD";let e=i.getDate()-i.getDay();i.setDate(e+1),t="<Row ColID='FROMDATE' Value='"+i.AddDays(-7).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+i.AddDays(-1).ToString("dd MMM yyyy")+"'/>"}return t}}class w{constructor(){this.dbl=0,this.IsDataReady=!1,this.breakSpaces=!1,this.Visible=!0,this.FontSize=12,this.FontFamily="Calibri",this.IsLink=!1,this.ShowPercentage=!1,this.ShowArrow=!1,this.txtSep=new N,this.txtValue=new N,this.txtPercent=new N}SetSubFields(){this.txtLbl=new N,this.txtLbl.Text=this.Label,this.txtLbl.Row=this.Row,this.txtLbl.Column="0",this.txtLbl.ForeColor=this.ForeColor,this.txtLbl.Align="Left",this.txtSep.Text=" : ",this.txtSep.Row=this.Row,this.txtSep.Column="1",this.txtSep.ForeColor=this.ForeColor,this.txtValue.Text="",this.txtValue.Row=this.Row,this.txtValue.Column="2",this.txtValue.ForeColor=this.ForeColor,this.txtValue.Align="Right",this.txtValue.WzLbl=this,this.txtPercent.Text="",this.txtPercent.Row=this.Row,this.txtPercent.Column="3",this.txtPercent.ForeColor=this.ForeColor}}class N{constructor(){this.Percentage=0,this.FontSize=12,this.IsLink=!1,this.FontFamily="Calibri",this.Visible=!0,this.WzLbl=null}}class L extends o.b{constructor(e){super(),this.Chart=null,this.RefreshCalender=null,this.DisplayStartDate=new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate()),this.EmployeeList=new S.a(0),this.dsData=null,this.SelectedEmpID=0,this.widget=e,this.HeaderLabels=[],this.EmployeeList.Code.TypeID=4,this.EmployeeList.Name.TypeID=1,this.EmployeeList.Code.Visible=this.EmployeeList.Name.Visible=!1,this.EmployeeList.Code.Column=0,this.EmployeeList.Name.Column=1,this.EmployeeList.Code.Visible=!0,this.EmployeeList.Name.Visible=!0,this.EmployeeList.Code.CCID=this.EmployeeList.Name.CCID=50051,this.EmployeeList.SelectionCallBack.Subscribe(this,"OnEmployeeChanged"),this.EmployeeList.t.Interval=200;let t=a.a.report.GetDataTable("RPT042",a.a.SessionManager.UserName);if(null!=t&&t.length>0&&(this.EmployeeList.SelectedValue=parseInt(t[0].NodeID)),26==e.TypeID){this.bgPresent="rgb(34, 177, 76)",this.bgSinglePunch="rgb(70, 230, 198)",this.bgAbsent="rgb(242, 97, 85)",this.bgHoliday="rgb(231, 204, 97)",this.bgWeeklyOff="rgb(180, 146, 99)";let e=new w;e.LabelType="Present",e.Label="Present",e.Value="0",e.ForeColor="#22B14C",this.HeaderLabels.push(e),e=new w,e.LabelType="SinglePunch",e.Label="Single Punch",e.Value="0",e.ForeColor="#46E6C6",this.HeaderLabels.push(e),e=new w,e.LabelType="Absent",e.Label="Absent",e.Value="0",e.ForeColor="#F26155",this.HeaderLabels.push(e),e=new w,e.LabelType="Holidays",e.Label="Holidays",e.Value="0",e.ForeColor="#E7CC61",this.HeaderLabels.push(e),e=new w,e.LabelType="WeeklyOff",e.Label="Weekly Off",e.Value="0",e.ForeColor="#B49263",this.HeaderLabels.push(e)}else if(27==e.TypeID){let e=new w;e.LabelType="TotalHours",e.Label="Total Hours",e.Value="0",e.ForeColor="Orange",this.HeaderLabels.push(e),e=new w,e.LabelType="UtilizedHours",e.Label="Utilized Hours",e.Value="0",e.ForeColor="Green",this.HeaderLabels.push(e),e=new w,e.LabelType="Un-Utilized Hours",e.Label="Un-Utilized Hours",e.Value="0",e.ForeColor="Red",this.HeaderLabels.push(e)}this.DisplayStartDate=new Date((new Date).getFullYear(),(new Date).getMonth(),1)}OnButtonClick(e){"PreviousMonth"==e.toString()?(this.DisplayStartDate=this.DisplayStartDate.AddMonths(-1),this.Refresh()):"NextMonth"==e.toString()&&(this.DisplayStartDate=this.DisplayStartDate.AddMonths(1),this.Refresh())}OnEmployeeChanged(e){this.Refresh()}Refresh(){return Object(s.b)(this,void 0,void 0,(function*(){this.SelectedEmpID=this.EmployeeList.Code.SelectedValue,this.dsData=yield this.SetQueryHRM(),null!=this.RefreshCalender&&this.RefreshCalender.Call(),this.widget.LoadingVisibility=!1}))}SetQueryHRM(){let e="";e="declare @Fr float,@To float,@EMPID bigint",e+=" set @Fr=convert(float,convert(datetime,'"+this.DisplayStartDate.ToString("dd MMM yyyy")+"'))",e+=" set @To=convert(float,convert(datetime,'"+this.DisplayStartDate.AddMonths(1).AddDays(1).ToString("dd MMM yyyy")+"'))",e+=" set @EMPID="+this.EmployeeList.SelectedValue;let t=this.widget.GetDimensionWhere("TDCC.dcCCNID"),i="";if(a.a.SessionManager.Preferences.ContainsKey("HolidaysBasedOn")&&""!=a.a.SessionManager.Preferences.HolidaysBasedOn){let e=a.a.SessionManager.Preferences.HolidaysBasedOn.split(",");for(let t=0;t<e.length;t++)""!=e[t]&&(parseInt(e[t]),i+=" AND EDCC.CCNID"+(parseInt(e[t])-5e4)+"=TDCC.dcCCNID"+(parseInt(e[t])-5e4))}let s=[];return s.push(this.widget.TypeID),s.push(i),s.push(e),s.push(t),s.push(a.a.SessionManager.LanguageID),a.a.report.GetWidgetHRM(s)}}var x=i("mvPR"),V=i("JIg3"),v=i("GYN/"),E=i("wlFP");class B{constructor(){this.Decimals=0,this.Divider=1}}let P=(()=>{class e extends o.b{constructor(){super(),this.PrintExportCallBack=new c.b,this.LoadingVisibility=!0,this.TabularDataObj=new v.a,this.ShowGrid=!1,this.ShowGridOn=!1,this.ShowPoint=0,this.IsWidgetChart=!1,this.ShowWidgetFilter=!1,this.FromDate=new V.a(0),this.ToDate=new V.a(0),this.GrossTotalAppearance=new x.a,this.GrossTotalAppearance_Data=new x.a,this.RefreshAMChart=new c.b,this.IsStackChart=!1,this.objFormat=new x.b,this.HeaderAppearance=new x.a,this.NumberDataAppearance=new x.a,this.dtStack=null,this.lstDrillFilter=new Array,this.WidgetCallsComplated=0,this.CurrentLevel=0,this.DrillBackVisible=!1,this.Is3D=new E.a,this.ChartDataColumns=[],this._ChartData=e.EmptyChartData,this.ClassName="RevenUChartViewModel",this.Chart=[],this.ChartTypes=new d.e,this.ChartDimColumns=new d.e}get TabularColumns(){return this.TabularDataObj.ReportColumns}RevenUChartViewModel_1(e,t,i){if(this.Parent=e,this.Report=t,this.drChartDefn=i,this.Chart=[],this.ChartTypes=new d.e(0),this.ChartTypes.Label="Chart Type",this.ChartTypes.LblWidth="80",this.ChartTypes.SelectionChangedCommand.Subscribe(this,"OnChartTypeChanged"),this.ChartTypes.Items.push(d.d.ComboBoxItems_2(a.a.GetResource("ChartType_Area"),"6")),this.ChartTypes.Items.push(d.d.ComboBoxItems_2(a.a.GetResource("ChartType_Bar"),"2")),this.ChartTypes.Items.push(d.d.ComboBoxItems_2(a.a.GetResource("ChartType_Bubble"),"7")),this.ChartTypes.Items.push(d.d.ComboBoxItems_2(a.a.GetResource("ChartType_Candlestick"),"8")),this.ChartTypes.Items.push(d.d.ComboBoxItems_2(a.a.GetResource("ChartType_Column"),"3")),this.ChartTypes.Items.push(d.d.ComboBoxItems_2(a.a.GetResource("ChartType_Cube"),"9")),this.ChartTypes.Items.push(d.d.ComboBoxItems_2(a.a.GetResource("ChartType_Curve"),"10")),this.ChartTypes.Items.push(d.d.ComboBoxItems_2(a.a.GetResource("ChartType_CurveArea"),"11")),this.ChartTypes.Items.push(d.d.ComboBoxItems_2(a.a.GetResource("ChartType_Doughnut"),"5")),this.ChartTypes.Items.push(d.d.ComboBoxItems_2(a.a.GetResource("ChartType_Funnel"),"12")),this.ChartTypes.Items.push(d.d.ComboBoxItems_2(a.a.GetResource("ChartType_Line"),"4")),this.ChartTypes.Items.push(d.d.ComboBoxItems_2(a.a.GetResource("ChartType_Pie"),"1")),this.ChartTypes.Items.push(d.d.ComboBoxItems_2(a.a.GetResource("ChartType_Polar"),"15")),this.ChartTypes.Items.push(d.d.ComboBoxItems_2(a.a.GetResource("ChartType_Pyramid"),"16")),this.ChartTypes.Items.push(d.d.ComboBoxItems_2(a.a.GetResource("ChartType_Radar"),"17")),this.ChartTypes.Items.push(d.d.ComboBoxItems_2(a.a.GetResource("ChartType_TreeMap"),"21")),this.ChartTypes.Items.push(d.d.ComboBoxItems_2(a.a.GetResource("ChartType_Scatter"),"18")),this.ChartTypes.Items.push(d.d.ComboBoxItems_2(a.a.GetResource("ChartType_Step"),"19")),this.ChartTypes.Items.push(d.d.ComboBoxItems_2(a.a.GetResource("ChartType_Surface"),"20")),this.ChartTypes.SelectedValue=i.GraphType.toString(),this.Is3D.Label="3D",this.Is3D.CheckedChangedCommand.Subscribe(this,"OnChartTypeChanged"),null!=e.xOptions&&null!=r.f.SelectSingleNode(e.xOptions.DocumentElement,"IsStackChart")&&(this.IsStackChart=!0),null==t){null==e.Parent.dsWidgetNames&&(e.Parent.dsWidgetNames=a.a.report.Widgets(3,0,"",0,1,!1,null,null)),this.FromDate.Label=a.a.GetResource("Reports_LblFromDate"),this.ToDate.Label=a.a.GetResource("Reports_LblToDate");let t=new Date(Date.Today().getFullYear(),a.a.SessionManager.AccountingFromMonth-1,1);t>Date.Today()&&(t=t.AddYears(-1)),this.FromDate.Date=t,this.ToDate.Date=t.AddYears(1).AddDays(-1)}this.ShowGrid=Object(C.j)(i.ShowGrid),this.NumSeriesColor=r.e.StringIsNullOrEmpty(i.NumSeriesColor)?null:i.NumSeriesColor.toString().split(","),null!=i.ShowPoint&&(this.ShowPoint=parseInt(i.ShowPoint)),this.TextFields=i.TextField.toString().split(","),this.NumericFields=i.NumericField.toString().split(","),this.NumFormula=new Array(this.NumericFields.length),this.ChartWidgetFilters=new Array(this.NumericFields.length),this.arrNumFormat=new Array(this.NumericFields.length);let s=null;null!=e.xOptions&&(s=r.f.SelectNodes(e.xOptions.DocumentElement,"Chart/Num"));for(let a=0;a<this.NumFormula.length;a++)if(this.NumFormula[a]="",null!=s&&a<s.length){this.ChartWidgetFilters[a]=r.f.SelectSingleNode(s[a],"WidgetFilter/TreeFilters");let e=r.f.SelectSingleNode(s[a],"Formula");if(null!=e&&(this.NumFormula[a]=e.innerHTML,e.innerHTML.length>0)){let e=[],t=new g.a;if(t.SetKeyWords("REPORT"),t.ParseFormula(this.NumFormula[a],e),10==e.length){let t=new B;t.FormatText=e[8].tokenValue.toString().split("~")[0],t.FormatKey=e[6].tokenValue.toString().split("~")[0],t.Decimals=parseInt(e[4].tokenValue),"K"==t.FormatKey?t.Divider=1e3:"L"==t.FormatKey?t.Divider=1e5:"M"==t.FormatKey?t.Divider=1e6:"C"==t.FormatKey?t.Divider=1e7:"B"==t.FormatKey&&(t.Divider=1e9),this.arrNumFormat[a]=t}}}if(this.ChartDimColumns=new d.e(0),this.ChartDimColumns.LblWidth="0",this.TextFieldsColumnSource=new Array(this.TextFields.length),this.NumericFieldsColumnSource=new Array(this.NumericFields.length),null!=t){this.IsWidgetChart=!1,this.ChartName=!e.ShowHeader||r.e.StringIsNullOrEmpty(e.Header)?t.DisplayName:"",this.FilterName=t.FilterText.toString();for(let e=0;e<this.TextFields.length;e++)this.TextFieldsColumnSource[e]=t.ColumnSource.find(t=>t.ID==this.TextFields[e]);for(let e=0;e<this.NumericFields.length;e++)this.NumericFieldsColumnSource[e]=t.ColumnSource.find(t=>t.ID==this.NumericFields[e]),e<this.NumFormula.length&&(this.NumericFieldsColumnSource[e].DataFormat.NumberFormat=this.NumFormula[e]);let i=!1,s=t.ReportColumns.length;for(let e=0;e<s;e++){let s=t.ReportColumns[e];if(s.HeaderAppearance.IsVisible&&"FLOAT"!=s.ColumnType&&"INT"!=s.ColumnType&&(this.ChartDimColumns.Items.push(d.d.ComboBoxItems_2(s.HeaderText,s.ID)),!i&&"DATE"==s.ColumnType&&r.e.IsEmpty(s.Formula))){i=!0;let a=s.Clone();a.ID=s.ID+"_Yr",a.HeaderText="Year-Wise",a.ColumnType="",a.Formula='DATENAME("yyyy",'+s.ID+")",this.ChartDimColumns.Items.push(d.d.ComboBoxItems_2(a.HeaderText,a.ID)),t.ReportColumns.push(a),t.ColumnSourceALL.push(a),a=s.Clone(),a.ID=s.ID+"_Mn",a.HeaderText="Month-Wise",a.ColumnType="",a.Formula='DATENAME("MMM-yy",'+s.ID+")",this.ChartDimColumns.Items.push(d.d.ComboBoxItems_2(a.HeaderText,a.ID)),t.ReportColumns.push(a),t.ColumnSourceALL.push(a),a=s.Clone(),a.ID=s.ID+"_Qtr",a.HeaderText="Quarter-Wise",a.ColumnType="",a.Formula='DATENAME("QUARTERLY",'+s.ID+")",this.ChartDimColumns.Items.push(d.d.ComboBoxItems_2(a.HeaderText,a.ID)),t.ReportColumns.push(a),t.ColumnSourceALL.push(a),e+=3}}t.Chart=this}else{this.IsWidgetChart=!0;let t=new T.b;"YrWise"==this.TextFields[0]?(t.HeaderText="Year",this.FromDate.Date=this.FromDate.Date.AddYears(-e.PrevDataFilter)):"MnWise"==this.TextFields[0]?(t.HeaderText="Month",this.FromDate.Date=this.FromDate.Date.AddMonths(-e.PrevDataFilter)):"QtrWise"==this.TextFields[0]?(t.HeaderText="Quarter",this.FromDate.Date=this.FromDate.Date.AddMonths(3*-e.PrevDataFilter)):this.TextFields[0].startsWith("DIM_")&&(t.HeaderText="Name");let i=this.NumericFields.length>0?parseInt(this.NumericFields[0]):0;if(e.PrevData>0&&this.NumericFields.length>0){this.NumericFields=new Array(e.PrevData+1);for(let t=0;t<=e.PrevData;t++)this.NumericFields[t]=1==a.a.SessionManager.AccountingFromMonth?this.FromDate.Date.AddYears(-t).getFullYear().toString():this.FromDate.Date.AddYears(-t).getFullYear().toString()+"-"+((this.FromDate.Date.AddYears(-t).getFullYear()+1)%100).toString();this.Widgets=new Array(1)}else this.Widgets=new Array(this.NumericFields.length);t.ID=this.TextFields[0],this.TextFieldsColumnSource=[],this.TextFieldsColumnSource.push(t),this.NumericFieldsColumnSource=new Array(this.NumericFields.length);for(let s=0;s<this.NumericFields.length;s++){let r=new T.b;if(e.PrevData>0)r.ID=this.NumericFields[s],r.HeaderText=this.NumericFields[s];else{r.ID="NUM_"+s;let t=e.Parent.dsWidgetNames.Tables[0].filter(e=>e.ID==this.NumericFields[s]);r.HeaderText=t.length>0?11==i||12==i||13==i||14==i||15==i||20==i?"Value":19==i?"Quantity":t[0].Name.toString():"WID-"+this.NumericFields[s]}if(r.ColumnType="FLOAT",r.DataFormat=new x.b,r.width=110,r.DataFormat.DecimalsPoints=2,r.DataFormat.Commas="Millions"==a.a.SessionManager.Preferences.Commas?1:2,this.NumericFieldsColumnSource[s]=r,s<this.NumFormula.length&&(this.NumericFieldsColumnSource[s].DataFormat.NumberFormat=this.NumFormula[s]),e.PrevData>0&&s>0){this.NumericFieldsColumnSource[s].DataFormat.NumberFormat=this.NumericFieldsColumnSource[s-1].DataFormat.NumberFormat;continue}let o=new R;o.WidgetViewModel_2(this,e.PrevData>0?i:parseInt(this.NumericFields[s]),this.ChartWidgetFilters[s]),11==o.TypeID||12==o.TypeID||18==o.TypeID?(t.width=160,this.TextFields[0]=t.ID="AccountName",t.HeaderText="Account Name"):13==o.TypeID?(t.width=160,this.TextFields[0]=t.ID="ProductName",t.HeaderText="Product Name"):14!=o.TypeID&&15!=o.TypeID&&19!=o.TypeID&&20!=o.TypeID||(this.TextFields[0]=t.ID="Slab",t.HeaderText="Slab"),o.PrevData=e.PrevData,o.Groups=t.ID,this.Widgets[s]=o}}this.ChartDimColumns.Items.length>0&&(this.ChartDimColumns.SelectedValue=this.TextFields[0],this.ChartDimColumns.SelectionChangedCommand.Subscribe(this,"OnChartDimColumnsChange")),(this.ChartDimColumns.Items.length<=1||this.IsStackChart)&&(this.ChartDimColumns.Visible=!1),this.ShowGrid&&this.InitGrid()}InitGrid(){let e=new x.a;this.HeaderAppearance.Alignment="Center",this.HeaderAppearance.FontFamilyName="Arial",this.HeaderAppearance.FontSize=12,this.HeaderAppearance.IsBold=!0,this.HeaderAppearance.BackColor="White",this.HeaderAppearance.ForeColor="Black",e.Alignment="Left",e.FontFamilyName="Arial",e.FontSize=12,e.BackColor="White",e.ForeColor="Black",this.NumberDataAppearance.Alignment="Right",this.NumberDataAppearance.FontFamilyName="Arial",this.NumberDataAppearance.FontSize=12,this.NumberDataAppearance.BackColor="White",this.NumberDataAppearance.ForeColor="Black",this.GrossTotalAppearance.IsBold=!0,this.GrossTotalAppearance.ForeColor="#FF000000",this.GrossTotalAppearance.BackColor="White",this.GrossTotalAppearance.FontFamilyName="Arial",this.GrossTotalAppearance_Data.IsBold=!0,this.GrossTotalAppearance_Data.ForeColor="#FF000000",this.GrossTotalAppearance_Data.BackColor="White",this.GrossTotalAppearance_Data.FontFamilyName="Arial",this.GrossTotalAppearance_Data.Alignment="Right",this.objFormat.DecimalsPoints=parseInt(a.a.SessionManager.Preferences.DecimalsinAmount),"Millions"==a.a.SessionManager.Preferences.Commas?this.objFormat.Commas=1:"Lakhs"==a.a.SessionManager.Preferences.Commas&&(this.objFormat.Commas=2),this.objFormat.DateType=a.a.SessionManager.Preferences["Date Format"];let t=new T.b;t.gridLines=3,t.ID=this.TextFieldsColumnSource[0].ID,t.FieldName=this.TextFieldsColumnSource[0].ID,t.HeaderText=this.TextFieldsColumnSource[0].HeaderText,t.HeaderAppearance=this.HeaderAppearance,t.DataAppearance=e,t.HeaderHeight=22,t.width=.8*this.TextFieldsColumnSource[0].width,t.DataFormat=this.objFormat,t.ColumnType="STRING",this.TabularColumns.push(t),this.IsStackChart||this.NumericFieldsColumnSource.forEach(e=>{t=new T.b,t.gridLines=3,t.ID=e.ID,t.FieldName=e.ID,t.HeaderText=e.HeaderText,t.HeaderAppearance=this.HeaderAppearance,t.DataAppearance=this.NumberDataAppearance,t.HeaderHeight=22,t.width=.8*e.width,t.DataFormat=this.objFormat,t.ColumnType="FLOAT",this.TabularColumns.push(t)})}OnButtonClick(e){if("DrillBack"==e){if(0==this.CurrentLevel)return;this.CurrentLevel--,this.lstDrillFilter.RemoveAt(this.lstDrillFilter.length-1),0==this.CurrentLevel&&(this.DrillBackVisible=!1),this.RefreshChart()}else if("WidgetFilterOK"==e){if(this.Parent.PrevData>0&&this.FromDate.Date.getFullYear()!=this.ToDate.Date.getFullYear())return void(this.DisplayMessage="Select From Date and To Date of same year");this.ShowWidgetFilter=!1,this.RefreshChart()}else"WidgetFilterCancel"==e?(this.ShowWidgetFilter=!1,this.RefreshChart()):"ShowGridOn"==e&&(this.ShowGridOn=!this.ShowGridOn)}LoadChartData(){let e,t,i;this.ShowGrid&&this.TabularDataObj.Clear();let s=null,a=new I.b;this.dtStack=null,0!=this.Report.lstGroup.filter(e=>"Summary"==e.DisplayMode).length&&null!=this.Report.ReportSummaryData?(e=t=this.Report.ReportSummaryData,"".length>0&&(e=t=this.Report.ReportSummaryData),i=e.ToTable(!0,[this.TextFields[this.CurrentLevel]])):(e=t=this.Report.ReportData,"".length>0&&(e=t=this.Report.ReportSummaryData),i=e.ToTable(!0,[this.TextFields[this.CurrentLevel]])),null!=this.TabularColumns&&this.TabularColumns.length>0&&this.TabularColumns[0].HeaderText!=this.TextFieldsColumnSource[this.CurrentLevel].HeaderText&&(this.TabularColumns[0].HeaderText=this.TextFieldsColumnSource[this.CurrentLevel].HeaderText,this.TabularDataObj.RefreshColumns());let o=[],l=[];if(l.push(this.TextFieldsColumnSource[this.CurrentLevel].HeaderText),this.IsStackChart){this.dtStack_C0=this.TextFields[1],this.dtStack=e.ToTable(!0,[this.dtStack_C0]);for(let e=this.TabularColumns.length-1;e>0;e--)this.TabularColumns.RemoveAt(e);for(let e=0;e<this.dtStack.length;e++)if(l.push(r.e.String(this.dtStack[e][this.dtStack_C0])),null!=this.TabularColumns){let t=new T.b;t.gridLines=3,t.ID=t.FieldName=t.HeaderText=r.e.String(this.dtStack[e][this.dtStack_C0]),t.HeaderAppearance=this.HeaderAppearance,t.DataAppearance=this.NumberDataAppearance,t.HeaderHeight=22,t.width=.8*this.NumericFieldsColumnSource[0].width,t.DataFormat=this.objFormat,t.ColumnType="FLOAT",this.TabularColumns.push(t)}null!=this.TabularColumns&&this.TabularDataObj.RefreshColumns()}else for(let r=0;r<this.NumericFields.length;r++)l.push(this.NumericFieldsColumnSource[r].HeaderText);let n=0,h=this.IsStackChart?new Array(this.dtStack.length).fill(0):new Array(this.NumericFieldsColumnSource.length).fill(0);this.IsStackChart&&(this.CurrentLevel=0);for(let D=0;D<i.length;D++){let u=i[D];e=t.filter(this.IsStackChart?e=>e[this.TextFields[0]]==u[this.TextFields[0]]:e=>e[this.TextFields[this.CurrentLevel]]==u[this.TextFields[this.CurrentLevel]]);let c=new x.c,d=new x.c;p.ReportViewModel.SetCellValue(u[this.TextFields[this.CurrentLevel]],this.TextFieldsColumnSource[this.CurrentLevel].DataFormat,this.TextFieldsColumnSource[this.CurrentLevel].ColumnType,-1,c);let C={};if(C[this.TextFieldsColumnSource[this.CurrentLevel].HeaderText]=c.Text,this.ShowGrid&&(s=new x.d(this.TabularColumns.length),s.Height=22,s.Cells[0]=c),this.IsStackChart){let t=e.filter(e=>!0);for(let i=0;i<this.dtStack.length;i++){e=t.filter(e=>e[this.TextFields[1]]==this.dtStack[i][this.dtStack_C0].toString());let a=0;e.forEach(e=>{!r.e.IsEmpty(e[this.NumericFields[0]])&&e[this.NumericFields[0]].toString().length>0&&(a+=parseFloat(e[this.NumericFields[0]]))}),h[i]+=a,l.Contains(this.dtStack[i][this.dtStack_C0].toString())&&(C[this.dtStack[i][this.dtStack_C0].toString()]=a),0==i&&p.ReportViewModel.SetCellValue(a,this.NumericFieldsColumnSource[0].DataFormat,this.NumericFieldsColumnSource[0].ColumnType,-1,d),this.ShowGrid&&p.ReportViewModel.SetCellValue(a,this.NumericFieldsColumnSource[0].DataFormat,this.NumericFieldsColumnSource[0].ColumnType,-1,s.Cells[i+1])}}else for(let t=0;t<this.NumericFields.length;t++){let i=0;e.forEach(e=>{!r.e.IsEmpty(e[this.NumericFields[t]])&&e[this.NumericFields[t]].toString().length>0&&(i+=parseFloat(e[this.NumericFields[t]]))}),h[t]+=i,C[this.NumericFieldsColumnSource[t].HeaderText]=i,0==t&&p.ReportViewModel.SetCellValue(i,this.NumericFieldsColumnSource[0].DataFormat,this.NumericFieldsColumnSource[0].ColumnType,-1,d),this.ShowGrid&&p.ReportViewModel.SetCellValue(i,this.NumericFieldsColumnSource[t].DataFormat,this.NumericFieldsColumnSource[t].ColumnType,-1,s.Cells[t+1])}if(o.push(C),n++,this.ShowGrid&&(this.Report.IsDefaultSortColumnExists||this.TabularDataObj.addRow(s),a.push(C,s)),!this.Report.IsDefaultSortColumnExists&&this.Report.TopRecords>=0&&n==this.Report.TopRecords)break}if(this.Report.IsDefaultSortColumnExists){var u=this.NumericFieldsColumnSource.find(e=>e.ID==this.Report.Preferences.DefaultSortColumn);if(u?o.sort("DESC"==this.Report.Preferences.DefaultSortOrder?(e,t)=>e[u.HeaderText]<t[u.HeaderText]?1:-1:(e,t)=>e[u.HeaderText]>t[u.HeaderText]?1:-1):Logger.DebugLog('Default Sort Column "'+this.Report.Preferences.DefaultSortColumn+'" can not be applied to chart'),this.ShowGrid&&this.TabularDataObj.Clear(),h[0]=0,this.Report.TopRecords>0)for(n=o.length-1;n>=this.Report.TopRecords;n--)o.Remove(o[n]);if(this.ShowGrid){let e;o.forEach(t=>{null!=t[this.NumericFieldsColumnSource[0].HeaderText]&&(e=r.e.Double(t[this.NumericFieldsColumnSource[0].HeaderText]),h[0]+=e),this.TabularDataObj.addRow(a.GetValue(t))})}}if(this.ChartData=o,this.ChartDataColumns=l,this.RefreshAMChart.Call(),0==this.ChartData.length&&this.ChartData.push({}),this.ShowGrid){if(s=new x.d(this.TabularColumns.length),s.Height=24,s.Cells[0].IsNormal=!1,s.Cells[0].CellAppearance=this.GrossTotalAppearance,s.Cells[0].Text="Total",this.IsStackChart)for(let e=1;e<this.TabularColumns.length;e++)s.Cells[e].IsNormal=!1,s.Cells[e].CellAppearance=this.GrossTotalAppearance_Data,this.Report.SetCellValue(h[e-1],this.NumericFieldsColumnSource[0].DataFormat,this.NumericFieldsColumnSource[0].ColumnType,s.Cells[e]);else for(let e=0;e<this.NumericFields.length;e++)s.Cells[e+1].IsNormal=!1,s.Cells[e+1].CellAppearance=this.GrossTotalAppearance_Data,this.Report.SetCellValue(h[e],this.NumericFieldsColumnSource[e].DataFormat,this.NumericFieldsColumnSource[e].ColumnType,s.Cells[e+1]);this.TabularDataObj.addRow(s)}}LoadChartDataByRows(){this.ShowGrid&&this.TabularDataObj.Clear();var e=this.Report.Data.filter(e=>e.Visible&&(e.Type==x.f.Detail||e.Type==x.f.BalanceBF||e.Type==x.f.GrossTotal)),t=parseInt(e.Compute("max","LevelNo")),i=e.filter(e=>e.LevelNo==t);let s=new Array(this.TextFields.length).fill(0);for(let D=0;D<this.TextFields.length;D++){if(null==(r=this.Report.ReportColumns.find(e=>e.ID==this.TextFields[D])))return void Logger.ErrorLog("TextFields["+D+"] not found");s[D]=this.Report.ReportColumns.indexOf(r)}let a=new Array(this.NumericFields.length).fill(0);for(let D=0;D<this.NumericFields.length;D++){var r;if(null==(r=this.Report.ReportColumns.find(e=>e.ID==this.NumericFields[D])))return void Logger.ErrorLog("NumericFields["+D+"] not found");a[D]=this.Report.ReportColumns.indexOf(r)}let o=[],l=[];l.push(this.TextFieldsColumnSource[0].HeaderText);for(let D=0;D<this.NumericFields.length;D++)l.push(this.NumericFieldsColumnSource[D].HeaderText);let n=0,h=0;for(let D=0;D<i.length;D++){let e=i[D],t=0;null!=e.Cells[a[0]].Value&&(t=parseFloat(e.Cells[a[0]].Value)),h+=t;let r=new x.c,l=new x.c;p.ReportViewModel.SetCellValue(e.Cells[s[0]].Value,this.TextFieldsColumnSource[0].DataFormat,this.TextFieldsColumnSource[0].ColumnType,-1,r),p.ReportViewModel.SetCellValue(t,this.NumericFieldsColumnSource[0].DataFormat,this.NumericFieldsColumnSource[0].ColumnType,-1,l);let c={};c[this.TextFieldsColumnSource[0].HeaderText]=r.Text;for(let i=0;i<this.NumericFields.length;i++)try{null!=e.Cells[a[i]].Value&&(c[this.NumericFieldsColumnSource[i].HeaderText]=e.Cells[a[i]].Value)}catch(u){}if(o.push(c),n++,this.ShowGrid){let e=new x.d(this.TabularColumns.length);e.Height=22,e.Cells[0]=r,e.Cells[1]=l,this.Report.IsDefaultSortColumnExists||this.TabularDataObj.addRow(e)}if(!this.Report.IsDefaultSortColumnExists&&this.Report.TopRecords>=0&&n==this.Report.TopRecords)break}if(this.ChartData=o,this.ChartDataColumns=l,this.RefreshAMChart.Call(),this.ShowGrid){let e=new x.d(this.TabularColumns.length);e.Height=24,e.Cells[0].IsNormal=!1,e.Cells[0].CellAppearance=this.GrossTotalAppearance,e.Cells[0].Text="Total",e.Cells[1].IsNormal=!1,e.Cells[1].CellAppearance=this.GrossTotalAppearance_Data,this.Report.SetCellValue(h,this.TabularColumns[1].DataFormat,this.TabularColumns[1].ColumnType,e.Cells[1]),this.TabularDataObj.addRow(e)}}LoadChartDataForWidget(){if(this.ShowGrid&&this.TabularDataObj.Clear(),this.ChartData=null,this.Parent.PrevData>0){let e=new Date(this.FromDate.Date.getFullYear(),a.a.SessionManager.AccountingFromMonth-1,1);if(e>this.FromDate.Date&&(e=e.AddYears(-1)),this.ToDate.Date>e.AddYears(1).AddDays(-1))return;if("YrWise"==this.TextFields[0]||0==this.NumericFields.length)return;for(let t=0;t<=this.Parent.PrevData;t++)this.NumericFields[t]=1==a.a.SessionManager.AccountingFromMonth?this.FromDate.Date.AddYears(-t).getFullYear().toString():this.FromDate.Date.AddYears(-t).getFullYear().toString()+"-"+((this.FromDate.Date.AddYears(-t).getFullYear()+1)%100).toString(),this.NumericFieldsColumnSource[t].ID=this.NumericFields[t],this.NumericFieldsColumnSource[t].HeaderText=this.NumericFields[t],this.TabularColumns[t+1].HeaderText=this.NumericFields[t];this.TabularColumns[0].HeaderText=this.TextFieldsColumnSource[this.CurrentLevel].HeaderText,this.TabularDataObj.RefreshColumns()}this.WidgetCallsComplated=0,this.widgetds=new Array(this.Widgets.length);for(let e=0;e<this.Widgets.length;e++)this.widgetds[e]=this.Widgets[e].SetValue(this.Widgets[e].Header,e)}WidgetCallBack(e,t){this.widgetds[e]=t,this.WidgetCallsComplated++,this.WidgetCallsComplated==this.Widgets.length&&this.LoadChartDataForWidgetCallBack(this.widgetds)}LoadChartDataForWidgetCallBack(e){this.LoadingVisibility=!1;let t,i,s,r=null,o=[],l=[];l.push(this.TextFieldsColumnSource[this.CurrentLevel].HeaderText);for(let a=0;a<this.NumericFields.length;a++)l.push(this.NumericFieldsColumnSource[a].HeaderText);if("MnWise"==this.TextFields[0])for(l.push("Mn"),l.push("Yr"),s=new Date(this.FromDate.Date.getFullYear(),this.FromDate.Date.getMonth(),1);s<=this.ToDate.Date;)t={},t.Mn=s.getMonth(),t.Yr=s.getFullYear(),t[this.TextFieldsColumnSource[this.CurrentLevel].HeaderText]=this.FromDate.Date.getFullYear()==this.ToDate.Date.getFullYear()||this.Parent.PrevData>0?s.ToString("MMM"):s.ToString("MMM-yy"),o.push(t),s=s.AddMonths(1);else if("QtrWise"==this.TextFields[0]){l.push("Mn"),l.push("Yr");let e=new Date(this.FromDate.Date.getFullYear(),a.a.SessionManager.AccountingFromMonth-1,1);e>this.FromDate.Date&&(e=e.AddYears(-1));let i="",s=1,r=e.getFullYear();for(;e.AddMonths(3)<=this.FromDate.Date;)s++,r=e.getFullYear(),e=e.AddMonths(3);for(0==this.Parent.PrevData&&(i=1==a.a.SessionManager.AccountingFromMonth?e.getFullYear().toString():e.iMonth()>=a.a.SessionManager.AccountingFromMonth?e.getFullYear().toString()+"-"+((e.getFullYear()+1)%100).toString():(e.getFullYear()-1).toString()+"-"+(e.getFullYear()%100).toString(),i=" "+i),t={},t.Mn=e.getMonth(),t.Yr=e.getFullYear(),t[this.TextFieldsColumnSource[this.CurrentLevel].HeaderText]="Q"+s+i,o.push(t);e.AddMonths(3)<=this.ToDate.Date;)s++,5==s&&(s=1),e=e.AddMonths(3),0==this.Parent.PrevData&&(i=1==a.a.SessionManager.AccountingFromMonth?e.getFullYear().toString():e.iMonth()>=a.a.SessionManager.AccountingFromMonth?e.getFullYear().toString()+"-"+((e.getFullYear()+1)%100).toString():(e.getFullYear()-1).toString()+"-"+(e.getFullYear()%100).toString(),i=" "+i),t={},t.Mn=e.getMonth(),t.Yr=e.getFullYear(),t[this.TextFieldsColumnSource[this.CurrentLevel].HeaderText]="Q"+s+i,o.push(t)}else if("YrWise"==this.TextFields[0])for(l.push("Yr"),s=new Date(this.FromDate.Date.getFullYear(),this.FromDate.Date.getMonth(),1);s<=this.ToDate.Date;)t={},t.Yr=s.getFullYear(),t[this.TextFieldsColumnSource[this.CurrentLevel].HeaderText]=s.getFullYear(),o.push(t),s=s.AddYears(1);else this.TextFields[0].startsWith("DIM_");if(11==this.Widgets[0].TypeID||12==this.Widgets[0].TypeID||13==this.Widgets[0].TypeID||14==this.Widgets[0].TypeID||15==this.Widgets[0].TypeID||18==this.Widgets[0].TypeID||19==this.Widgets[0].TypeID||20==this.Widgets[0].TypeID){let i;e[0].length>0&&(i=Object.keys(e[0][0])[0]),e[0].forEach(e=>{t={},t[l[0]]=e[i].toString(),t[l[1]]=parseFloat(e.Balance),o.push(t)})}else{let s=0;if(this.Parent.PrevData>0){let r;if(s=this.Widgets[0].Header.dbl,e[0].Rows.forEach(e=>{"MnWise"==this.TextFields[0]?i=o.filter(t=>t.Mn==e.Mn):"QtrWise"==this.TextFields[0]&&(i=o.filter(t=>t.Mn<=e.Mn&&t.Mn+3>=e.Mn)),r=1!=a.a.SessionManager.AccountingFromMonth?parseInt(e.Mn)>=a.a.SessionManager.AccountingFromMonth?e.Yr.toString()+"-"+((parseInt(e.Yr)+1)%100).toString():(parseInt(e.Yr)-1).toString()+"-"+(parseInt(e.Yr)%100).toString():e.Yr.toString(),this.Widgets[0].IncludeOpening?s+=parseFloat(e.Balance):i.length>0&&(s=null!=i[0][r]?parseFloat(e.Balance)+parseFloat(i[0][r]):parseFloat(e.Balance)),i.length>0&&(i[0][r]=s)}),this.Widgets[0].IncludeOpening)for(let e=0;e<o.length;e++){t=o[e];for(let i=this.NumericFields.length-1;i>=0;i--)null==t[this.NumericFields[i]]&&(t[this.NumericFields[i]]=0==e?i==this.NumericFields.length-1?s:o[o.length-1][this.NumericFields[i+1]]:o[e-1][this.NumericFields[i]])}}else for(let a=0;a<this.Widgets.length;a++)if(s=this.Widgets[a].Header.dbl,e[a].forEach(e=>{"MnWise"==this.TextFields[0]?i=o.filter(t=>t.Yr==e.Yr&&t.Mn==e.Mn):"QtrWise"==this.TextFields[0]?i=o.filter(t=>t.Yr==e.Yr&&t.Mn<=e.Mn&&t.Mn+3>=e.Mn):"YrWise"==this.TextFields[0]?i=o.filter(t=>t.Yr==e.Yr):this.TextFields[0].startsWith("DIM_")&&(i=o.filter(t=>t.Name==e.Name.toString())),0==i.length&&this.TextFields[0].startsWith("DIM_")&&(t={},t.Name=e.Name.toString(),o.push(t),i=[],i.push(t)),this.Widgets[a].IncludeOpening?s+=parseFloat(e.Balance):i.length>0&&(s=null!=i[0][this.NumericFieldsColumnSource[a].HeaderText]?parseFloat(e.Balance)+parseFloat(i[0][this.NumericFieldsColumnSource[a].HeaderText]):parseFloat(e.Balance)),i.length>0&&(i[0][this.NumericFieldsColumnSource[a].HeaderText]=s)}),this.Widgets[a].IncludeOpening)for(let e=0;e<o.length;e++)t=o[e],null==t[this.NumericFieldsColumnSource[a].HeaderText]&&(t[this.NumericFieldsColumnSource[a].HeaderText]=0==e?s:o[e-1][this.NumericFieldsColumnSource[a].HeaderText])}o.forEach(e=>{for(let t=0;t<this.NumericFields.length;t++)e[l[t+1]]||(e[l[t+1]]=0)}),l.Contains("Mn")&&l.Remove("Mn"),l.Contains("Yr")&&l.Remove("Yr"),null!=this.TabularColumns&&this.TabularColumns.length>0&&this.TabularColumns[0].HeaderText!=this.TextFieldsColumnSource[this.CurrentLevel].HeaderText&&(this.TabularColumns[0].HeaderText=this.TextFieldsColumnSource[this.CurrentLevel].HeaderText,this.TabularDataObj.RefreshColumns());let n=new Array(this.NumericFieldsColumnSource.length).fill(0);if(this.ShowGrid){o.forEach(e=>{let t=new x.c;new x.c,p.ReportViewModel.SetCellValue(e[l[0]],this.TextFieldsColumnSource[this.CurrentLevel].DataFormat,this.TextFieldsColumnSource[this.CurrentLevel].ColumnType,-1,t),r=new x.d(this.TabularColumns.length),r.Height=22,r.Cells[0]=t;for(let i=0;i<this.NumericFields.length;i++)this.Parent.PrevData>0?this.Widgets[0].IncludeOpening?n[i]=parseFloat(e[l[i+1]]):n[i]+=parseFloat(e[l[i+1]]):this.Widgets[i].IncludeOpening?n[i]=parseFloat(e[l[i+1]]):n[i]+=parseFloat(e[l[i+1]]),p.ReportViewModel.SetCellValue(e[l[i+1]],this.NumericFieldsColumnSource[i].DataFormat,this.NumericFieldsColumnSource[i].ColumnType,-1,r.Cells[i+1]);this.TabularDataObj.addRow(r)}),r=new x.d(this.TabularColumns.length),r.Height=24,r.Cells[0].IsNormal=!1,r.Cells[0].CellAppearance=this.GrossTotalAppearance,r.Cells[0].Text="Total";for(let e=0;e<this.NumericFields.length;e++)r.Cells[e+1].IsNormal=!1,r.Cells[e+1].CellAppearance=this.GrossTotalAppearance_Data,p.ReportViewModel.SetCellValue(n[e],this.NumericFieldsColumnSource[e].DataFormat,this.NumericFieldsColumnSource[e].ColumnType,-1,r.Cells[e+1]);this.TabularDataObj.addRow(r)}this.ChartData=o,this.ChartDataColumns=l,this.RefreshAMChart.Call(),0==this.ChartData.length&&this.ChartData.push({})}OnChartTypeChanged(e){r.e.IsEmpty(this.ChartTypes.SelectedValue)||-1==r.e.Int(this.ChartTypes.SelectedValue)||this.RefreshAMChart.Call()}OnChartDimColumnsChange(e){this.TextFields[0]=this.ChartDimColumns.SelectedValue,this.TextFieldsColumnSource[0]=this.Report.ColumnSource.find(e=>e.ID==this.TextFields[0]),this.RefreshChart()}RefreshChart(){this.IsWidgetChart?(this.LoadingVisibility=!0,this.LoadChartDataForWidget()):(null!=this.Report.ReportData?(this.LoadChartData(),this.Report.ReportViewType=T.e.DashBoard):this.Report.StaticReportType>0&&(this.LoadChartDataByRows(),this.Report.ReportViewType=T.e.DashBoard),this.Report.FilterText.forEach(e=>{null!=e.Text&&(this.ChartName=this.ChartName+" - "+e.Label+" : "+e.Text)})),this.TabularDataObj.Width=0,this.ShowGrid&&this.TabularDataObj.ReportColumns.forEach(e=>{e.HeaderAppearance.IsVisible&&(this.TabularDataObj.Width+=e.width)})}static RevenUChartViewModel(){e.EmptyChartData.push({Name:"",Value:0})}get ChartData(){return this._ChartData}set ChartData(e){null!=e&&null!=this.arrNumFormat.find(e=>null!=e)&&e.forEach(e=>{if(this.IsStackChart)for(let t=0;t<this.dtStack.length;t++)null!=this.arrNumFormat[0]&&this.arrNumFormat[0].Divider>1&&(e[this.dtStack[t][this.dtStack_C0].toString()]=parseFloat(e[this.dtStack[t][this.dtStack_C0].toString()])/this.arrNumFormat[0].Divider);else for(let t=0;t<this.NumericFieldsColumnSource.length;t++)null!=this.arrNumFormat[t]&&this.arrNumFormat[t].Divider>1&&(e[this.NumericFieldsColumnSource[t].HeaderText]=parseFloat(e[this.NumericFieldsColumnSource[t].HeaderText])/this.arrNumFormat[t].Divider)}),e!=this._ChartData&&(this._ChartData=e)}DrillDownChartFX(e){if(this.IsStackChart)return;if(this.CurrentLevel+1>=this.TextFields.length)return;this.CurrentLevel++,this.DrillBackVisible=!0;let t=this.ChartData[e][this.TextFieldsColumnSource[this.CurrentLevel-1].HeaderText].toString(),i=!1;0!=this.Report.lstGroup.filter(e=>"Summary"==e.DisplayMode).length&&null!=this.Report.ReportSummaryData?this.Report.ReportSummaryDataColumns.Contains(this.TextFields[this.CurrentLevel-1])&&"date"==this.Report.ColumnSourceALL.find(e=>e.ID==this.TextFields[this.CurrentLevel-1]).ColumnType.toLowerCase()&&(i=!0):this.Report.ReportDataColumns.Contains(this.TextFields[this.CurrentLevel-1])&&"date"==this.Report.ColumnSourceALL.find(e=>e.ID==this.TextFields[this.CurrentLevel-1]).ColumnType.toLowerCase()&&(i=!0),this.lstDrillFilter.push(i?"["+this.TextFields[this.CurrentLevel-1]+"]= convert('"+this.ChartData[e][this.TextFields[this.CurrentLevel-1]+"_DATE"]+"',System.DateTime)":"["+this.TextFields[this.CurrentLevel-1]+"]= '"+t+"'"),this.RefreshChart()}}return e.EmptyChartData=[],e})();var H=i("OQq8"),O=i("YU11"),k=i("CUWK"),W=i("vSGu");class G extends o.b{constructor(e){super(),this.StaticFields=new Array,this.DocsArrowData=new Array,this.FavouriteID=0,this.BgColor="#f9f9f9",this.ClassName="DashFavoritesViewModel",this.DisplayName=a.a.GetResource("Favorite"),this.Column1="0.25*",this.Column2="0.25*",this.Column3="0.25*",this.Column4="0.25*",this.Title=this.DisplayName,this.FavouriteID=e,a.a.admin.GetFavorite("VIEW",e,!0).subscribe(e=>{this.ds=e,this.onLoad()},e=>{}),Logger.InfoLog("DashFavoritesViewModel::Leaving DashFavoritesViewModel")}onClick(e){let t=new m.a;if(e instanceof H.a){let i=e;if("1"==i.isReport.toString())if("0"==i.Featureactiontypeid)a.a.page.ShowLoading=!1,alert("Report Not Assigned.");else{let e=new p.ReportViewModel;e.ReportViewModel_1(parseInt(i.DBColumnName)),0==e.ReturnType&&a.a.page.addNewTab({component:O.ReportViewComponent,params:{obj:e}})}else{t.FeatureActionID=parseInt(i.DBColumnName),t.ScreenName=i.ScreenName,t.FeatureID=i.FeatureID,50==t.FeatureID?t.FeatureActionTypeID=parseInt(i.Featureactiontypeid):"31"!=i.Featureactiontypeid&&"30"!=i.Featureactiontypeid||(t.FeatureActionTypeID=parseInt(i.Featureactiontypeid)),i.FeatureID>5e4?(t.ScreenType=7,t.FeatureActionTypeID="31"!=i.Featureactiontypeid&&"30"!=i.Featureactiontypeid?2:parseInt(i.Featureactiontypeid)):i.FeatureID>4e4&&(t.ISDoctype=i.DBColumnID);let e={};k.RibbonExtViewModel.OncmdLoadPage(t,e).then(i=>{if(!e.component)return;let s;"FeatureActionID"==e.basedon?s=a.a.page.tabs.find(i=>i.instance instanceof e.component&&i.instance.FeatureActionID==t.FeatureActionID):"CostCenterID"==e.basedon?s=a.a.page.tabs.find(i=>i.instance instanceof e.component&&i.instance.CostCenterID==t.FeatureID):"Unique"==e.basedon&&(s=a.a.page.tabs.find(t=>t.instance instanceof e.component)),s?(a.a.page.tabs.map(e=>e.active=!1),s.active=!0):(e.title=t.ScreenName,a.a.page.addNewTab(e))})}}else for(let i=0;i<this.StaticFields.length;i++)if(this.oText=this.StaticFields[i],this.oText.DBColumnName==e.toString()){if("1"==this.oText.isReport.toString())(new p.ReportViewModel).ReportViewModel_1(parseInt(this.oText.DBColumnName));else{let e;t.FeatureActionID=parseInt(this.oText.DBColumnName),t.ScreenName=this.oText.ScreenName,t.FeatureID=this.oText.FeatureID,"31"!=this.oText.Featureactiontypeid&&"30"!=this.oText.Featureactiontypeid||(t.FeatureActionTypeID=parseInt(this.oText.Featureactiontypeid)),this.oText.FeatureID>5e4&&(t.ScreenType=7,t.FeatureActionTypeID="31"!=this.oText.Featureactiontypeid&&"30"!=this.oText.Featureactiontypeid?2:parseInt(this.oText.Featureactiontypeid)),k.RibbonExtViewModel.OncmdLoadPage(t,e)}break}}onLoad(){Logger.InfoLog("DashFavoritesViewModel::Entering onLoad");let e,t=-1;try{if(null!=this.ds&&this.ds.Tables[0].length>0&&this.ds.Tables.length>1&&this.ds.Tables[1].length>0&&(t=parseInt(this.ds.Tables[1][0].MaxRows)),null!=this.ds&&this.ds.Tables.length>2&&this.ds.Tables[2].length>0&&r.e.String(this.ds.Tables[2][0].OptionsXML).length>0){let e=new r.f;e.LoadXml(this.ds.Tables[2][0].OptionsXML.toString()),this.BgColor=r.e.rgbColor(r.f.SelectSingleNodeText(e.DocumentElement,"BgColor")),"#FFFFFF"==this.BgColor&&(this.BgColor="#f9f9f9")}for(let i=0;i<=t;i++)for(let t=0;t<4;t++)e=this.ds.Tables[0].filter(e=>e.RowNo==i&&e.ColumnNo==t),e.length>0&&(this.oText=new H.a,this.oText.Label=r.e.String(e[0].DisplayName),this.oText.DBColumnName=e[0].FeatureactionID.toString(),this.oText.SmallImage="/assets/images/menu/"+r.e.String(e[0].ImagePath).replace("/","''"),this.oText.Row=i,this.oText.Column=t,this.oText.ClickCommand.Subscribe(this,"onClick"),this.oText.ScreenName=r.e.String(e[0].ScreenName),this.oText.ShortcutKey=r.e.String(e[0].ShortCutKey),r.e.IsEmpty(e[0].FeatureID)||(this.oText.FeatureID=parseInt(e[0].FeatureID)),this.oText.KeyTip=r.e.String(e[0].ButtonKeyTip),this.oText.isReport=r.e.String(e[0].isReport),this.oText.Featureactiontypeid=r.e.String(e[0].FeatureActionTypeID),this.oText.Data=r.e.String(e[0].Link),this.oText.WebIcon=W.FavoritesViewModel.GetIcon(this.oText),r.e.IsEmpty([0].DocumentType)||(this.oText.DBColumnID=parseInt(e[0].DocumentType)),this.StaticFields.push(this.oText));if(this.StaticFields.length>0){let e=this.StaticFields.Compute("max","Column"),t=0;t=r.e.Int(e),t>=0&&t<4&&(this.Column1=(100/(t+1)).ToString("N2")+"%",this.Column2=t<1?"0.0*":this.Column1,this.Column3=t<2?"0.0*":this.Column1,this.Column4=t<3?"0.0*":this.Column1),this.StaticFields.filter(e=>!r.e.IsEmpty(e.Data)).forEach(e=>{e.Data.split(",").forEach(t=>{var i=this.StaticFields.find(e=>e.FeatureID==parseInt(t));if(i){let t=new Y;t.Source=e,t.Destination=i,this.DocsArrowData.push(t)}})})}}catch(i){Logger.ErrorLog("DashFavoritesViewModel::onLoad",i)}Logger.InfoLog("DashFavoritesViewModel::Leaving onLoad")}}class Y{constructor(){this.X1=0,this.X2=0,this.Y1=0,this.Y2=0,this.Stroke="Gray"}}var _=i("AyOk"),j=i("ouML"),Q=i("Wh9R"),U=i("7SrT"),X=i("HwyT");class K extends o.b{constructor(e){super(),this.TypeID=0,this.UnApprovedDocumentsVisible=!1,this.DocumentDraftsVisible=!1,this.PDCDocumentsVisible=!1,this.NotifEventsVisible=!1,this.DepreciationPostingVisible=!1,this.RejectedDocumentsVisible=!1,this.DocsToApproveGridVisible=!1,this.CalendarVisible=!1,this.ClassName="DashAddOnsViewModel",this.TypeID=e,1==e?(this.UnApprovedDocumentsVisible=!0,this.UnApprovedDocuments=new _.UnAppDocumentsViewModel,this.UnApprovedDocuments.DocumentsGrid.Height=void 0):2==e?(this.DocumentDraftsVisible=!0,this.DocumentDrafts=new j.DocumentDraftsViewModel(this,1),setTimeout(()=>{this.DocumentDrafts.FillGrid()},500),this.DocumentDrafts.Grid.Height=void 0):3==e?(this.PDCDocumentsVisible=!0,this.PDCDocuments=new Q.DashBoardNotifViewModel(4),this.PDCDocuments.Grid.Height=void 0):4==e?(this.NotifEventsVisible=!0,this.NotifEvents=new Q.DashBoardNotifViewModel(2),this.NotifEvents.Grid.Height=void 0):5==e?(this.DepreciationPostingVisible=!0,this.DepreciationPosting=new U.PostDepreciationViewModel("",!0,!1)):7==e?(this.DocsToApproveGridVisible=!0,this.DocsToApprove=new X.a):8==e&&this.LoadCalendar()}LoadCalendar(){return Object(s.b)(this,void 0,void 0,(function*(){const{RCalenderViewModel:e}=yield Promise.resolve().then(i.bind(null,"m+Ff"));this.Calendar=new e,this.Calendar._RCalenderViewModel(!1),this.CalendarVisible=!0}))}Refresh(){1==this.TypeID?this.UnApprovedDocuments.OnLoad():2==this.TypeID?this.DocumentDrafts.FillGrid():3==this.TypeID?this.PDCDocuments.InitColumns():4==this.TypeID?this.NotifEvents.RefreshData():5==this.TypeID?this.DepreciationPosting.OnButtonClick("RefreshDepr"):7==this.TypeID&&this.DocsToApprove.LoadDocsToApproveGrid(-1)}refreshUI(){1==this.TypeID?this.UnApprovedDocuments.DocumentsGrid.refreshUI():2==this.TypeID?this.DocumentDrafts.Grid.refreshUI():3==this.TypeID?this.PDCDocuments.Grid.refreshUI():4==this.TypeID?this.NotifEvents.Grid.refreshUI():5==this.TypeID&&this.DepreciationPosting.OnButtonClick("RefreshDepr")}}class z extends o.b{constructor(e,t){super(),this.Rows=0,this.Columns=0,this.LoadingVisibility=!1,this.ClassName="KPIViewViewModel",this.Report=e,e.Chart=this,this.KPILabels=[];let i=e.Reportds.Tables[0][0].DashKPIXML.toString(),s=new r.f;s.LoadXml(i),this.Rows=parseInt(s.DocumentElement.attributes.Rows.value),this.Columns=parseInt(s.DocumentElement.attributes.Cols.value);for(let o=0;o<s.DocumentElement.children.length;o++){let t=s.DocumentElement.children[o];for(let i=0;i<t.childNodes.length;i++){let s=t.childNodes[i];if(null!=s.attributes.Empty)continue;let l=new q;l.Row=o,l.Column=i,l.RowSpan=null!=s.attributes.rs?s.attributes.rs.value:"1",l.ColumnSpan=null!=s.attributes.cs?s.attributes.cs.value:"1",l.ShowCaption=null==s.attributes.caption,l.ShowCaption||(l.Row1Height="0");let n=r.f.SelectSingleNode(s,"ID");if(null!=n){var a=e.ReportColumns.find(e=>e.ID==n.innerHTML);a&&(l.DBColumnName=a.ID,l.Field=a,l.FieldIndex=e.ReportColumns.indexOf(a),l.ShowCaption&&(l.Header.Label=a.HeaderText,l.Header.FontSize=a.HeaderAppearance.FontSize,l.Header.ForeColor=a.HeaderAppearance.ForeColor,l.Header.BackColor=a.HeaderAppearance.BackColor,l.Header.FontFamily=a.HeaderAppearance.FontFamilyName,l.Header.Align=a.HeaderAppearance.Alignment.toString(),l.Header.VAlign="Center"),l.Data.FontSize=a.DataAppearance.FontSize,l.Data.ForeColor=a.DataAppearance.ForeColor,l.Data.BackColor=a.DataAppearance.BackColor,l.Data.FontFamily=a.DataAppearance.FontFamilyName,l.Data.Align=a.DataAppearance.Alignment.toString(),l.Data.VAlign="Center")}this.KPILabels.push(l)}}}LoadChartData(){let e;e=this.Report.lstGroup.find(e=>"Summary"==e.DisplayMode)&&null!=this.Report.ReportSummaryData?this.Report.ReportSummaryData:this.Report.ReportData;let t=this.Report.AddSubtotals_RT(this.Report.GrpReportTotal,0);for(let i=0;i<this.Report.ReportColumns.length;i++)t.Cells[i].CellAppearance=this.Report.ReportColumns[i].DataAppearance.Clone();this.Report.ApplyKPI(t);for(let i=0;i<this.KPILabels.length;i++){let e=this.KPILabels[i];null!=e.Field&&(e.ImagePath=null,-1!=e.FieldIndex&&e.FieldIndex<t.Cells.length&&(e.Data.Label=t.Cells[e.FieldIndex].Text,e.Data.ForeColor=t.Cells[e.FieldIndex].CellAppearance.ForeColor,e.ImagePath="pack://application:,,,/"+t.Cells[e.FieldIndex].CellAppearance.ImagePath))}}RefreshChart(){null!=this.Report.ReportData&&(this.LoadChartData(),this.Report.ReportViewType=T.e.DashBoard)}}class q extends c.c{constructor(){super(),this.FieldIndex=-1,this.Field=null,this.ShowCaption=!1,this.ShowImage=!1,this.Header=new J,this.Data=new J,this.Row1Height="0.4*",this.Row2Height="0.6*"}}class J extends c.c{constructor(){super(...arguments),this.FontSize=12,this.FontFamily="Calibri",this.Field=null}}var $=i("NipM"),Z=i("7JXL"),ee=i("lG8W");class te extends o.b{constructor(){super(),this.InitUI=!1,this.IsDashClick=!1,this.IsAllDashBoardsLoaded=!1,this.AllDashBoards=[],this.DashResize=null,this.ShowList=!1,this._ShowReportFilter=!1,this.BackColor="White",this.Rows=0,this.Columns=0,this.IsRowHeightExists=!1,this.ds=null,this.dsWidgetNames=null,this.disname="",this.DashBoardID=0,this.dicPromises=new I.c}get ShowReportFilter(){return this._ShowReportFilter}set ShowReportFilter(e){this._ShowReportFilter=e,e&&this.ReportFilter.RefreshCostCenterItems()}DBViewViewModel_1(e){this.DashBoardID=e,this.DisplayName=a.a.GetResource("Loading"),this.DBList=new Array,this.InitDashboard(e)}InitDashboard(e){this.DashBoardID=e,a.a.report.GetDashBoard(1,e,!0).then(e=>{this.ds=e,this.disname=this.ds.Tables[0][0].DashBoardName.toString();let t=this.ds.Tables[0][0].DashBoardType.toString().split("*");this.Rows=parseInt(t[0]),this.Columns=parseInt(t[1]),this.RowHeight=new Array(this.Rows).fill(0),this.RowHeightXML="",this.DBListTemp=new Array(this.Rows),this.DBListTemp.Clear(),this.DBList.forEach(e=>{e.timer&&(e.timer.Enabled=!1)}),this.DBList.Clear(),this.dicPromises.Clear();for(let i=0;i<this.ds.Tables[0].length;i++){let e=new ie;e.DBPanel_1(this,this.ds.Tables[0][i]),this.DBList.push(e),this.DBListTemp[parseInt(e.Row)]||(this.DBListTemp[parseInt(e.Row)]=[]),this.DBListTemp[parseInt(e.Row)].push(e),1!=e.TypeID&&2!=e.TypeID&&5!=e.TypeID||this.dicPromises.push(i,a.a.report.GetReport(0,e.ReportID,!0))}if(!r.e.StringIsNullOrEmpty(this.RowHeightXML)){if(this.RowHeightXML.Contains(",")){let e=this.RowHeightXML.split(",");for(let t=0;t<this.Rows;t++)this.RowHeight[t]=t<e.length?parseInt(e[t]):0}else if(parseInt(this.RowHeightXML)>0)for(let e=0;e<this.Rows;e++)this.RowHeight[e]=parseInt(this.RowHeightXML);this.RowHeight.forEach(e=>{e>0&&(this.IsRowHeightExists=!0)})}return Promise.all(this.dicPromises.values).then(e=>{for(let t=0;t<this.dicPromises.keys.length;t++)this.ds.Tables[0][this.dicPromises.keys[t]].ReportDefn=e[t];this.IsDashClick&&null!=this.DashResize&&(this.DashResize.Call(!0),this.DashResize.Call(!1)),setTimeout(()=>{let e=1;this.DBList.forEach(t=>{t.Visible&&(setTimeout(()=>{t.DBPanel_1_Async()},50*e),e++)}),this.worker_RunWorkerCompleted(null,null)},20)})})}worker_RunWorkerCompleted(e,t){this.DisplayName=this.disname}getStyles(){let e={};return a.a.IsMobile?e={gridTemplateColumns:"1fr",gridTemplateRows:`repeat(${this.Rows},${100/this.Rows}%)`}:(e={gridTemplateColumns:`repeat(${this.Columns},${100/this.Columns}%)`,gridTemplateRows:`repeat(${this.Rows},${100/this.Rows}%)`},this.IsRowHeightExists&&(e.gridTemplateRows=""+this.RowHeight.map(e=>e>0?e+"px":"1fr").join(" "))),e}getBackground(e){if(a.a.IsMobile)return{background:e.BodyBackColor}}getDBpanelStyles(e){if(a.a.IsMobile){let t={};return t={margin:"5px 5px 5px 0"},this.RowHeight[e.Row]>0&&e.Visible?t.height=e.RowSpan*this.RowHeight[e.Row]+"px":e.Visible?6!=e.TypeID&&(t.height=`calc(${100/this.Rows}%)`,t.minHeight=`calc(${100/this.Rows}%)`):(t.margin="0",t.height="0",t.display="none"),1237!=e.dr.NodeID&&1234!=e.dr.NodeID&&1238!=e.dr.NodeID||(t.height="auto"),t}return{margin:"5px 5px 5px 0",gridColumnStart:""+(parseInt(e.Column)+1),gridColumnEnd:"span "+e.ColumnSpan,gridRowStart:""+(parseInt(e.Row)+1),gridRowEnd:"span "+e.RowSpan}}LoadDashList(){this.IsAllDashBoardsLoaded=!0,this.ShowList=!0;let e=a.a.report.GetDashBoard(2,0),t=null;e.Tables[0].forEach(e=>{if(t!=e.GroupName.toString()){t=e.GroupName.toString();let i=new y.a;i.Label=t,i.SectionID="1",this.AllDashBoards.push(i)}let i=new m.a;i.FeatureActionTypeID=parseInt(e.DashBoardID),i.AppPath=i.FeatureActionTypeID==this.DashBoardID?"#FFE8A6":"#F9F9F9",i.Label=e.DashBoardName.toString(),this.AllDashBoards.push(i)})}OnDashBoardClick(e){this.IsDashClick=!0;var t=this.AllDashBoards.find(e=>e instanceof m.a&&"#FFE8A6"==e.AppPath);t&&(t.AppPath="#F9F9F9"),e.AppPath="#FFE8A6",this.InitDashboard(e.FeatureActionTypeID)}OnButtonClick(e){"ShowList"==e?(this.ShowList=!this.ShowList,r.e.SetPersonalize("ShowDBList",this.ShowList?"1":"0"),this.IsAllDashBoardsLoaded||this.LoadDashList()):"DashboardFilter"==e&&(null==this.ReportFilter&&(this.ReportFilter=new se(this)),this.ShowReportFilter=!0)}ApplyDBFilters(){setTimeout(()=>{this.filterworker_DoWork(null,null)},50)}filterworker_DoWork(e,t){this.DBList.forEach(e=>{2==e.TypeID&&null!=e.Chart?e.Chart.IsWidgetChart?e.Chart.OnButtonClick("WidgetFilterOK"):e.Chart.Report.OnButtonClick("OK_CLICK"):5==e.TypeID&&null!=e.KPI&&e.KPI.Report.OnButtonClick("OK_CLICK")})}}class ie{constructor(){this.TypeID=0,this.AddOnID=0,this.Parent=null,this.Visible=!1,this.AutoRefresh=!1,this.Filter=!1,this.RefreshRate=0,this.TopRecords=0,this.timer=null,this.Row="0",this.Column="0",this.ColumnSpan="1",this.RowSpan="1",this.ShowBorder=!1,this.ShowUILoad=!0,this.ExportVisible=!1,this.PrintVisible=!0,this.RefreshVisibility=!0,this.RegenerateVisibility=!0,this.FilterVisibility=!1,this.GetAllDataVisibility=!0,this.ButtonColor="#111111",this.ButtonOpacity=1,this.HeaderForeColor="#00A9DA",this.HeaderBackColor="#FFFF00",this.BodyBackColor="#FFFFFF",this.PointsColor="#777777",this.ShowHeader=!0,this.ScreenTemp=[],this.PrevData=0,this.PrevDataFilter=0,this.IsMaximize=!1,this.IsWidgetChart=!1,this.xOptions=null,this.EmpWidgetTypeID=0,this.ShowLoading=!0}get IsReportWidget(){return 1==this.TypeID&&!r.e.IsEmpty(this.Report)&&(276==this.Report.ReportID||304==this.Report.ReportID||305==this.Report.ReportID||310==this.Report.ReportID||307==this.Report.ReportID||306==this.Report.ReportID||308==this.Report.ReportID)||6==this.TypeID&&(72==this.EmpWidgetTypeID||26==this.EmpWidgetTypeID||60==this.EmpWidgetTypeID)||2==this.TypeID&&101==this.EmpWidgetTypeID}get ReportFilterText(){return null!=this.Report?this.Report:null!=this.Chart?this.Chart.Report:null!=this.KPI?this.KPI.Report:null}DBPanel_1(e,t){this.dr=t,this.Parent=e,this.AutoRefresh=Object(C.j)(t.AutoRefresh),this.AutoRefresh&&(this.RefreshRate=parseFloat(t.RefreshRate),this.RefreshRate<=0&&(this.AutoRefresh=!1)),null!=t.Filter&&(this.Filter=Object(C.j)(t.Filter)),this.Header=t.ReportName.toString(),this.TopRecords=parseInt(t.TopRecords),this.TypeID=null!=t.TypeID?parseInt(t.TypeID):1,this.Row=t.RowNo.toString(),this.Column=t.ColNo.toString(),this.RowSpan=t.RowSpan.toString(),this.ColumnSpan=t.ColSpan.toString(),this.ShowBorder=!0;let i=r.e.String(t.Options);if(i.length>0&&i.startsWith("<Options>")){let t;this.xOptions=new r.f,this.xOptions.LoadXml(i),this.HeaderBackColor=r.e.rgbColor(r.f.SelectSingleNodeText(this.xOptions.DocumentElement,"HeaderBackClr")),this.HeaderForeColor=r.e.rgbColor(r.f.SelectSingleNodeText(this.xOptions.DocumentElement,"HeaderForeClr")),this.ButtonColor="#FFFFFF00"==this.HeaderBackColor||"#FFFFFF"==this.HeaderBackColor||"White"==this.HeaderBackColor?"#111111":this.HeaderForeColor,t=r.e.rgbColor(r.f.SelectSingleNode(this.xOptions.DocumentElement,"BodyBackClr")),null!=t&&"#FFFFFF00"!=t.innerHTML&&(this.BodyBackColor=r.e.rgbColor(t.innerHTML)),t=r.f.SelectSingleNode(this.xOptions.DocumentElement,"HideHeader"),this.ShowHeader=null==t||"1"!=t.innerHTML,t=r.f.SelectSingleNode(this.xOptions.DocumentElement,"WIDGETCHART"),null!=t&&(this.IsWidgetChart=!0,t=r.f.SelectSingleNode(this.xOptions.DocumentElement,"WidgetChartPrevious"),null!=t&&(this.PrevData=parseInt(t.innerHTML)),t=r.f.SelectSingleNode(this.xOptions.DocumentElement,"WidgetChartPreviousFilter"),null!=t&&(this.PrevDataFilter=parseInt(t.innerHTML))),t=r.f.SelectSingleNode(this.xOptions.DocumentElement,"BackColor"),null!=t&&""!=t.innerHTML&&(e.BackColor=r.e.rgbColor(t.innerHTML),"#FFFFFF"!=e.BackColor&&"#FFFFFF00"!=e.BackColor&&(this.ShowBorder=!1)),t=r.f.SelectSingleNode(this.xOptions.DocumentElement,"RowHeight"),null!=t&&(e.RowHeightXML=t.innerHTML),t=r.e.rgbColor(r.f.SelectSingleNode(this.xOptions.DocumentElement,"PointsColor")),this.PointsColor=null!=t?t.innerHTML:"#777777"}else{let t=i.split("~");t.length>1&&(this.HeaderBackColor=r.e.rgbColor(t[0]),this.HeaderForeColor=r.e.rgbColor(t[1]),this.ButtonColor="#FFFFFF00"==this.HeaderBackColor||"#FFFFFF"==this.HeaderBackColor||"White"==this.HeaderBackColor?"#111111":t[1],t.length>2&&"#00FFFFFF"!=t[2]&&(this.BodyBackColor=r.e.rgbColor(t[2])),this.ShowHeader=!(t.length>3&&"1"==t[3]),t.length>4&&"WIDGETCHART"==t[4]&&(this.IsWidgetChart=!0,t.length>5&&""!=t[5]&&(this.PrevData=parseInt(t[5]))),t.length>6&&""!=t[6]&&(e.BackColor=r.e.rgbColor(t[6]),"#FFFFFF"!=e.BackColor&&"#FFFFFF00"!=e.BackColor&&(this.ShowBorder=!1)),t.length>7&&""!=t[7]&&(this.PointsColor=r.e.rgbColor(t[7])))}this.PrevRow=this.Row,this.PrevColumn=this.Column,this.PrevRowSpan=this.RowSpan,this.PrevColumnSpan=this.ColumnSpan,this.Screen=[],this.ReportID=parseInt(t.ReportID),0==this.TypeID?this.Visible=!1:2==this.TypeID&&this.IsWidgetChart?this.Visible=!0:this.ReportID>0?(this.Visible=!0,this.PrintVisible=!1,this.ExportVisible=!1):this.Visible=!1}DBPanel_1_Async(){return Object(s.b)(this,void 0,void 0,(function*(){if(2==this.TypeID&&this.IsWidgetChart)this.Visible=!0,this.PrintVisible=!0,this.ExportVisible=!0,this.Chart=new P,this.Chart.RevenUChartViewModel_1(this,null,this.dr),this.ScreenTemp.push(this.Chart),"My Salary"==this.Chart.drChartDefn.ReportName&&(this.EmpWidgetTypeID=101);else if(this.ReportID>0)if(this.Visible=!0,this.PrintVisible=!1,this.ExportVisible=!1,1==this.TypeID)this.Report=new p.ReportViewModel,207==this.ReportID||307==this.ReportID||306==this.ReportID||308==this.ReportID||276==this.ReportID||310==this.ReportID?(this.EmpWidgetTypeID=this.ReportID,this.Report.ReportViewModel_2(this.ReportID,T.e.DashBoard,this.dr.ReportDefn,this,null,a.a.SessionManager.iEmployee)):this.Report.ReportViewModel_2(this.ReportID,T.e.DashBoard,this.dr.ReportDefn,this,null),this.Report.SearchVisibility=this.Filter,this.ScreenTemp.push(this.Report),this.FilterVisibility=!0,this.PrintVisible=!0,this.ExportVisible=!0,this.PrintVisible=a.a.SessionManager.HideUnathorizedAccess?this.Report.ButtonPrint.Visible:this.Report.ButtonPrint.Enable,this.ExportVisible=a.a.SessionManager.HideUnathorizedAccess?this.Report.ButtonExport.Visible:this.Report.ButtonExport.Enable;else if(2==this.TypeID){let e=new p.ReportViewModel;e.ReportViewModel_2(this.ReportID,T.e.LoadDataOnly,this.dr.ReportDefn,this,null),this.Chart=new P,this.Chart.RevenUChartViewModel_1(this,e,this.dr),this.ScreenTemp.push(this.Chart),this.PrintVisible=!0,this.ExportVisible=!0}else if(5==this.TypeID){let e=new p.ReportViewModel;e.ReportViewModel_2(this.ReportID,T.e.LoadDataOnly,this.dr.ReportDefn,this,null),this.KPI=new z(e,this.dr),this.ScreenTemp.push(this.KPI)}else if(6==this.TypeID)if(72==this.ReportID){this.EmpWidgetTypeID=this.ReportID,this.QuickViewDetails=new ee.a;let e=this.QuickViewDetails.QuickViewScreenViewModel_2(50051,a.a.SessionManager.iEmployee,-1);e&&e.then(()=>{this.ScreenTemp.push(this.QuickViewDetails)})}else this.EmpWidgetTypeID=this.ReportID,this.Widget=new R,this.Widget.WidgetViewModel_1(this,this.ReportID,this.dr.WidgetXML.toString()),this.ScreenTemp.push(this.Widget);else if(3==this.TypeID)this.RefreshVisibility=!1,this.RegenerateVisibility=!1,this.GetAllDataVisibility=!1,this.AddOnID=this.ReportID,this.AddOnID>0&&(this.RefreshVisibility=!0,this.AddOn=new K(this.AddOnID),this.ScreenTemp.push(this.AddOn));else if(4==this.TypeID){this.RefreshVisibility=!1,this.RegenerateVisibility=!1,this.GetAllDataVisibility=!1;let e=new G(this.ReportID);this.BodyBackColor=e.BgColor,this.ScreenTemp.push(e)}else 7==this.TypeID&&(this.RefreshVisibility=!1,this.RegenerateVisibility=!1,this.GetAllDataVisibility=!1,this.ReportID>0&&this.ScreenTemp.push(new $.BulkEditViewModel(this.ReportID,this)));2==this.TypeID&&null!=this.Chart?this.Chart.IsWidgetChart?this.Chart.RefreshChart():this.Chart.Report.Refresh():5==this.TypeID&&null!=this.KPI?this.KPI.Report.Refresh():6==this.TypeID&&null!=this.Widget&&this.Widget.Refresh(),this.ShowLoading=!1,this.AutoRefresh&&this.Visible&&(this.timer=new r.d,this.timer.Interval=this.RefreshRate<1?1e4*this.RefreshRate:60*this.RefreshRate*1e3,this.timer.Elapsed(this,"timer_Elapsed"),this.timer.Enabled=!0)}))}OnButtonClick(e){"Regenerate"==e?1==this.TypeID?this.Report.OnButtonClick("Regenerate"):2==this.TypeID?this.Chart.IsWidgetChart?this.Chart.ShowWidgetFilter=!0:this.Chart.Report.OnButtonClick("Regenerate"):3==this.TypeID||5==this.TypeID&&this.KPI.Report.OnButtonClick("Regenerate"):"Refresh"==e?1==this.TypeID?this.Report.Refresh():2==this.TypeID?this.Chart.IsWidgetChart?this.Chart.RefreshChart():this.Chart.Report.Refresh():3==this.TypeID?this.AddOn.Refresh():5==this.TypeID&&this.KPI.Report.Refresh():"GetAllData"==e?1==this.TypeID?(this.Report.TopRecords=0,this.Report.Refresh()):2==this.TypeID?this.Chart.IsWidgetChart?this.Chart.RefreshChart():(this.Chart.Report.TopRecords=0,this.Chart.Report.Refresh()):3==this.TypeID||5==this.TypeID&&(this.KPI.Report.TopRecords=0,this.KPI.Report.Refresh()):"Filter"==e?1==this.TypeID&&(this.Report.ShowExport=!1,this.Report.ShowReportFilter?(this.Report.ShowReportFilter=!1,this.Report.ShowRightPanel=!1):(this.Report.ShowReportFilter=!0,this.Report.ShowRightPanel=!0)):"Maximize"==e&&(this.IsMaximize=!this.IsMaximize,setTimeout(()=>{null!=this.Chart?this.Chart.TabularDataObj.refreshUI():null!=this.AddOn?this.AddOn.refreshUI():7==this.TypeID?this.ScreenTemp.length>0&&this.ScreenTemp[0]instanceof $.BulkEditViewModel&&this.ScreenTemp[0].EditGrid.refreshUI():1==this.TypeID&&"ReportViewModel"==this.ScreenTemp[0].ClassName&&this.ScreenTemp[0].angularGrid.resizerService.resizeGrid()},50))}timer_Elapsed(e,t){this.timer.Enabled=!1,a.a.page.isActiveTab(this.Parent)&&(1==this.TypeID?this.Report.LoadingVisibility||this.Report.process.IsBusy||this.Report.Refresh(!1):2==this.TypeID?this.Chart.Report.Refresh():3==this.TypeID?this.AddOn.Refresh():5==this.TypeID?this.KPI.Report.Refresh():6==this.TypeID&&this.Widget.Refresh()),this.timer.Enabled=!0}}class se extends l.a{constructor(e){super(),this.Parent=e,this.tree=[],this.CostCenterFilters=[],this.CostCenters=new d.e(0),this.CostCenters.Label=a.a.GetResource("Reports_SelectCostCenter"),this.CostCenters.LblWidth="140",this.CostCenters.SelectionChangedCommand.Subscribe(this,"OnCostCenterChange");let t=new h.a;t.IsReportViewScreen=!0,this.DateField=new u.a(t),this.DateField.ID="DateField";let i=new D.a;this.DateField.Caption.Text="Date",this.DateField.CDGDO=i,this.DateField.CDGDO.DataType="DATE",this.DateField.Condition.SelectedValue="Between",this.DateField.Condition.SetSelectedItem(this.DateField.Condition.SelectedValue),this.DateField.OnConditionSelectionChanged(this.DateField.Condition.SelectedValue),this.DateField.Member.Visible=!1,this.DateField.DeleteVisible=!1}RefreshCostCenterItems(){this.CostCenters.CrFilter!=this.Parent.DashBoardID&&(this.CostCenters.Items.Clear(),this.CostCenters.SelectedIndex=-1,this.CostCenterFilters.Clear(),null!=this.tree&&this.tree.Clear()),this.CostCenters.CrFilter=this.Parent.DashBoardID,this.Parent.DBList.forEach(e=>{1==e.TypeID&&null!=e.Report?null!=e.Report.oReportDialog?this.FillCostCenterItems(e.Report.oReportDialog.CostCenters):null!=e.Report.Filter&&this.FillCostCenterItems(e.Report.Filter.CostCenters):2==e.TypeID&&null!=e.Chart&&(e.Chart.IsWidgetChart||(null!=e.Chart.Report.oReportDialog?this.FillCostCenterItems(e.Chart.Report.oReportDialog.CostCenters):null!=e.Chart.Report.Filter&&this.FillCostCenterItems(e.Chart.Report.Filter.CostCenters)))})}FillCostCenterItems(e){e.Items.forEach(e=>{this.CostCenters.Items.find(t=>t.Value==e.Value&&t.Parent==e.Parent)||this.CostCenters.Items.push(e)})}OnButtonClick(e){"FilterCancel"==e?this.Parent.ShowReportFilter=!1:"FilterOK"==e&&(this.Parent.DBList.forEach(e=>{1==e.TypeID&&null!=e.Report?(e.Report.FromDatePicker.Date=this.DateField.FromDatePicker.Date,e.Report.ToDatePicker.Date=this.DateField.ToDatePicker.Date,this.SetCCFilters(e.Report.oReportDialog?e.Report.oReportDialog:e.Report.Filter),e.Report.OnButtonClick("OK_CLICK")):2==e.TypeID&&null!=e.Chart?e.Chart.IsWidgetChart?(e.Chart.FromDate.Date=this.DateField.FromDatePicker.Date,e.Chart.ToDate.Date=this.DateField.ToDatePicker.Date):(e.Chart.Report.FromDatePicker.Date=this.DateField.FromDatePicker.Date,e.Chart.Report.ToDatePicker.Date=this.DateField.ToDatePicker.Date,this.SetCCFilters(e.Chart.Report.oReportDialog?e.Chart.Report.oReportDialog:e.Chart.Report.Filter)):5==e.TypeID&&null!=e.KPI&&(e.KPI.Report.FromDatePicker.Date=this.DateField.FromDatePicker.Date,e.KPI.Report.ToDatePicker.Date=this.DateField.ToDatePicker.Date,this.SetCCFilters(e.KPI.Report.oReportDialog?e.KPI.Report.oReportDialog:e.KPI.Report.Filter))}),this.Parent.ShowReportFilter=!1,this.Parent.ApplyDBFilters())}SetCCFilters(e){this.CostCenterFilters.forEach(t=>{if(t.SelectedNodes.length>0&&e.CostCenters.Items.find(e=>parseInt(e.Value)==t.CostCenterID)){let i=e.CostCenterFilters.find(e=>e.CostCenterID==t.CostCenterID);null!=i?(i.SelectedNodes=t.SelectedNodes,i.SelectedNodesTag=t.SelectedNodesTag):(i=new Z.a(t.CostCenterID,t.LookupTypeID>0?t.LookupTypeID.toString():"",t.CostCenter,e),i.SelectedNodes=t.SelectedNodes,i.SelectedNodesTag=t.SelectedNodesTag,e.CostCenterFilters.push(i)),"StaticReportFilterViewModel"==e.ClassName&&e.TreeCCID==t.CostCenterID&&(e.DefaultTreeSelectedNodes=i.SelectedNodes)}})}OnCostCenterChange(e){if(!r.e.IsEmpty(this.CostCenters.SelectedValue)&&(0==this.tree.length||this.tree[0].CostCenterID!=parseInt(this.CostCenters.SelectedValue))){let e=0;null==this.CostCenters.SelectedItem||r.e.IsEmpty(this.CostCenters.SelectedItem.Parent)||(e=r.e.Int(this.CostCenters.SelectedItem.Parent)),this.LoadCostCenterTree(parseInt(this.CostCenters.SelectedValue),e,0,null)}}LoadCostCenterTree(e,t,i,s){this.tree.Clear();let o,l="";if(50002==e&&"True"==a.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==a.a.SessionManager.Preferences["LW Reports"]&&(l=r.e.IsEmpty(a.a.SessionManager.LocationWhere)?"NodeID IN (-1234)":"NodeID IN ("+a.a.SessionManager.LocationWhere+")"),null==s)for(let a=0;a<this.CostCenterFilters.length;a++){let i=this.CostCenterFilters[a];if(i.CostCenterID==e&&i.LookupTypeID==t){s=i.SelectedNodes;break}}44==e&&t>0&&(l="A.LookupType="+t),o=new n.a,null==s?o.TreeViewModel_5(e,this,i,l,""):o.TreeViewModel_6(e,this,i,l,s,""),o.LookupTypeID=t,o.HeaderVisiblity=!1,o.OnNodeSelected||(o.OnNodeSelected=new c.b,o.OnNodeSelected.Subscribe(this,"OnNodeSelected")),this.tree.push(o)}}}}]);
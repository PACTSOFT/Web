function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var a,n=_getPrototypeOf(e);if(t){var i=_getPrototypeOf(this).constructor;a=Reflect.construct(n,arguments,i)}else a=n.apply(this,arguments);return _possibleConstructorReturn(this,a)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{"6l4u":function(e,t,a){"use strict";a.d(t,"a",(function(){return D}));var n=a("Do2H"),i=a("Lp6j"),s=a("ScVY"),r=a("ockk"),o=a("EQd/"),l=a("0/4Q"),c=a("8B8H"),d=a("n56n"),u=a("ouML"),h=a("vgHJ"),D=function(e){_inherits(a,e);var t=_createSuper(a);function a(e,s,r,u,h,D,m){var b,S,C,y,p;if(_classCallCheck(this,a),(b=t.call(this)).FilterDim=new d.b,b.ImportVisiblity=!1,b.Width=700,b.Height=700,b.IsTransfer=!1,b.Scan=new o.d,b.batchNo=new o.d,b.NoofBins=new o.d,b.ProductName=new o.d,b.ProductCode=new o.d,b.WareHouse=new o.d,b.FromTO=new l.e,b.SortCols=new l.e,b.SortOrder=new l.e,b._ChkFifo=!1,b.DocId=0,b.DocDetailsId=0,b.ProductID=0,b.Div=0,b.Loc=0,b.ProdName="",b.Qty=0,b.InvQty=0,b.Tot=0,b.vol=0,b.Waist=0,b.dttemp=null,b.drSel=null,b.Parent=null,b.ParentDOc=null,b.dsBins=null,b.VoucherType=0,b.cnt=0,b.DimensionID=0,b.dimccid=0,b.batchid=0,b.dsBins=D,b.ProductID=u,b.ProdName=h,b.Qty=r,n.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=n.a.SessionManager.Preferences.DecimalsinQty){var g=b.Qty.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty);b.Qty=parseFloat(g)}b.Scan.Label="Scan",b.Scan.TextChangedCommand.Subscribe(_assertThisInitialized(b),"OnScan"),b.VoucherType=s,b.Parent=e,b.QtyAddMessage=i.e.Format(n.a.GetResource("Bins_AddMessage"),(0).ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty),b.Qty.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty),b.ProdName.toString()),b.Title="Bins";return b.IsTransfer=!1,b.FromTO.Visible=!1,b.WareHouse.Visible=!1,b.ProductCode.Visible=!1,b.ProductName.Visible=!1,b.batchNo.Visible=!1,b.NoofBins.Visible=!1,b.NoofBins.Label="No. Of Bins",b.SortCols.Items.push(l.d.ComboBoxItems_2("Bin No","Name")),b.SortCols.Items.push(l.d.ComboBoxItems_2("Available","Available")),b.SortCols.SelectedValue="Name",b.SortOrder.Items.push(l.d.ComboBoxItems_2("Ascending","Asc")),b.SortOrder.Items.push(l.d.ComboBoxItems_2("Descinding","Desc")),b.SortOrder.SelectedValue="Asc",b.BinsGrid=new c.a,b.BinsGrid.SearchVisible=!0,"AddEditDocumentViewModel"==(null===(S=b.Parent)||void 0===S?void 0:S.ClassName)?b.ParentDOc=b.Parent:"BatchNumberViewModel"==(null===(C=b.Parent)||void 0===C?void 0:C.ClassName)&&"AddEditDocumentViewModel"==(null===(y=b.Parent.Parent)||void 0===y?void 0:y.ClassName)&&(b.ParentDOc=b.Parent.Parent),null!=b.ParentDOc&&(b.ParentDOc.ScreenObject.Preferences.ContainsKey("BinFilterinPopup")&&"true"==b.ParentDOc.ScreenObject.Preferences.BinFilterinPopup.toLowerCase()&&b.ParentDOc.ScreenObject.Preferences.ContainsKey("BinFilterDim")&&""!=b.ParentDOc.ScreenObject.Preferences.BinFilterDim.toString()?(b.dimccid=i.e.Int(b.ParentDOc.ScreenObject.Preferences.BinFilterDim),b.dimccid>5e4?(b.FilterDim.CCID=b.dimccid,b.FilterDim.TypeID=1,b.FilterDim.Label=b.ParentDOc.ScreenObject.GetCostcenterName(b.FilterDim.CCID)):b.FilterDim.Visible=!1):b.FilterDim.Visible=!1,5!=b.ParentDOc.ScreenObject.DocumentType||b.ParentDOc.ScreenObject.GridDataColumns.Contains("RecievedQty")||(b.WareHouse.Visible=!0,b.FromTO.Visible=!0,b.FromTO.SelectionChangedCommand.Subscribe(_assertThisInitialized(b),"OnTypeChanged"),b.WareHouse.Label="WareHouse",b.FromTO.Label="Type",1==b.VoucherType?(b.FromTO.Items.push(l.d.ComboBoxItems_2("To","1")),b.FromTO.SelectedValue="1"):(b.FromTO.Items.push(l.d.ComboBoxItems_2("From","-1")),b.ParentDOc.IsToBinwise=null,b.ParentDOc.IsWarehouseBinwise(b.ParentDOc.ScreenObject.SelectedGridRowIndex,1,{DimensionID:0})&&b.FromTO.Items.push(l.d.ComboBoxItems_2("To","1")),b.FromTO.SelectedValue="AddEditDocumentViewModel"==(null===(p=b.Parent)||void 0===p?void 0:p.ClassName)&&!i.e.IsEmpty(m.BinsXML)&&i.e.String(m.TOBinsXML)?"1":"-1"),b.IsTransfer=!0),null!=m&&(b.drSel=m),null!=b.drSel&&(i.e.IsEmpty(b.drSel.DocDetailsID)||(b.DocDetailsId=parseInt(b.drSel.DocDetailsID)),i.e.IsEmpty(b.drSel.ProductName)||(b.ProductName.Visible=!0,b.ProductName.Label="Product Name",b.ProductName.Text=b.drSel.ProductName.toString()),i.e.IsEmpty(b.drSel.ProductCode)||(b.ProductCode.Visible=!0,b.ProductCode.Label="Product Code",b.ProductCode.Text=b.drSel.ProductCode.toString())),b.DocId=b.ParentDOc.ScreenObject.DocID,b.docdate=b.ParentDOc.DocumentDate),b.Refresh(!1),_possibleConstructorReturn(b)}return _createClass(a,[{key:"Refresh",value:function(e){var t,a,s=this;if(5==this.ParentDOc.ScreenObject.DocumentType&&(this.FromTO.Visible&&1==this.FromTO.Items.length&&"1"==this.FromTO.SelectedValue||1==this.VoucherType)){null!=this.drSel&&!i.e.IsEmpty(this.drSel.ToDocDetailsID)&&i.e.IsNum(this.drSel.ToDocDetailsID)&&(this.DocDetailsId=parseInt(this.drSel.ToDocDetailsID.toString()));var r=0,o=0;if(null!=this.ParentDOc&&n.a.SessionManager.Preferences.ContainsKey("DimensionwiseBins")&&!i.e.IsEmpty(n.a.SessionManager.Preferences.DimensionwiseBins)){var l=!1;if((r=i.e.IntTryParse(n.a.SessionManager.Preferences.DimensionwiseBins))>0){this.DimensionID=1;for(var c=function(e){var t=s.ParentDOc.ScreenObject._CCFields[e];if(t instanceof d.b&&t.CCID==r)return t.DBColumnName.Contains("TO")?t.SelectedValue>0&&(s.DimensionID=t.SelectedValue,s.WareHouse.Visible&&(s.WareHouse.Label=t.Label,s.WareHouse.Text=t.Text)):null!=(h=s.ParentDOc.ScreenObject._CCFields.find((function(e){return e.DBColumnName=="TO"+t.DBColumnName})))&&h instanceof d.b?(h.SelectedValue>0&&(s.DimensionID=h.SelectedValue),s.WareHouse.Visible&&(s.WareHouse.Label=h.Label,s.WareHouse.Text=h.Text)):(t.SelectedValue>0&&(s.DimensionID=t.SelectedValue),s.WareHouse.Visible&&(s.WareHouse.Label=t.Label,s.WareHouse.Text=t.Text)),l=!0,"break"},u=0;u<this.ParentDOc.ScreenObject._CCFields.length;u++){var h;if("break"===c(u))break}l||null!=this.drSel&&r>5e4&&this.Parent.ScreenObject.GridDataColumns.Contains("dcCCNID"+(r-5e4).toString()+"_Key")&&(this.Parent.ScreenObject.GridDataColumns.Contains("TOdcCCNID"+(r-5e4).toString()+"_Key")?i.e.IntTryParse(this.drSel["TOdcCCNID"+(r-5e4).toString()+"_Key"])>0&&(this.DimensionID=parseInt(this.drSel["TOdcCCNID"+(r-5e4).toString()+"_Key"].toString()),this.WareHouse.Visible&&(null!=(g=this.ParentDOc.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember.toLowerCase()=="todcccnid"+(r-5e4).toString()})))&&(this.WareHouse.Label=g.Header),this.WareHouse.Text=this.drSel["todcCCNID"+(r-5e4).toString()].toString())):i.e.IntTryParse(this.drSel["dcCCNID"+(r-5e4).toString()+"_Key"])>0&&(this.DimensionID=parseInt(this.drSel["dcCCNID"+(r-5e4).toString()+"_Key"].toString()),this.WareHouse.Visible&&(null!=(g=this.ParentDOc.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember.toLowerCase()=="dcccnid"+(r-5e4).toString()})))&&(this.WareHouse.Label=g.Header),this.WareHouse.Text=this.drSel["dcCCNID"+(r-5e4).toString()].toString())))}}this.ParentDOc.ScreenObject.Preferences.ContainsKey("BinFilterDim")&&!i.e.IsEmpty(this.ParentDOc.ScreenObject.Preferences.BinFilterDim)&&(this.dimccid=i.e.IntTryParse(this.ParentDOc.ScreenObject.Preferences.BinFilterDim),this.dimccid>0&&(o=this.ParentDOc.GetDimValue(this.dimccid,this.ParentDOc.SelectedRow)));var D=0;null==this.ParentDOc||null==this.drSel||-1!=this.VoucherType||i.e.IsEmpty(this.drSel.LinkedInvDocDetailsID)||(D=i.e.IntTryParse(this.drSel.LinkedInvDocDetailsID)),(null==this.dsBins||e)&&(this.dsBins=this.ParentDOc.ScreenObject.GetProductwiseBins(this.ProductID,this.DocId,this.VoucherType,this.docdate,r,this.DimensionID,this.dimccid,this.FilterDim.Visible?this.FilterDim.SelectedValue:o,D,this.batchid,0,this.ParentDOc.GetBOEIDS(this.ParentDOc.SelectedRow))),this.LoadFields(e)}else if(5==this.ParentDOc.ScreenObject.DocumentType&&this.FromTO.Visible&&2==this.FromTO.Items.length&&"1"==this.FromTO.SelectedValue)this.OnTypeChanged(null);else{var m=0,b=0,S=0;if(this.dimccid=0,null!=this.ParentDOc&&n.a.SessionManager.Preferences.ContainsKey("DimensionwiseBins")&&!i.e.IsEmpty(n.a.SessionManager.Preferences.DimensionwiseBins)){var C=!1;if((m=i.e.IntTryParse(n.a.SessionManager.Preferences.DimensionwiseBins.toString()))>0){this.DimensionID=1;for(var y=0;y<this.ParentDOc.ScreenObject._CCFields.length;y++){var p=this.ParentDOc.ScreenObject._CCFields[y];if(p instanceof d.b&&p.CCID==m){this.DimensionID=p.SelectedValue,this.WareHouse.Visible&&(this.WareHouse.Label=p.Label,this.WareHouse.Text=p.Text),C=!0;break}}var g;!C&&null!=this.drSel&&m>5e4&&this.Parent.ScreenObject.GridDataColumns.Contains("dcCCNID"+(m-5e4).toString()+"_Key")&&!i.e.IsEmpty(this.drSel["dcCCNID"+(m-5e4).toString()+"_Key"])&&(this.WareHouse.Visible&&(null!=(g=this.ParentDOc.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember.toLowerCase()=="dcccnid"+(m-5e4).toString()})))&&(this.WareHouse.Label=g.Header),this.WareHouse.Text=this.drSel["dcCCNID"+(m-5e4).toString()].toString()),this.DimensionID=parseInt(this.drSel["dcCCNID"+(m-5e4).toString()+"_Key"].toString()))}}"BatchNumberViewModel"==(null===(t=this.Parent)||void 0===t?void 0:t.ClassName)&&null!=this.Parent.SelectedRow&&this.Parent.SelectedRow.TableColumns.Contains("BATCHNUMBER")&&(this.batchNo.Visible=!0,this.batchNo.Label="Batch No.",this.batchNo.Text=this.Parent.SelectedRow.BATCHNUMBER.toString()),-1==this.VoucherType&&"BatchNumberViewModel"==(null===(a=this.Parent)||void 0===a?void 0:a.ClassName)&&null!=this.Parent.SelectedRow&&(this.batchid=parseInt(this.Parent.SelectedRow.batchid.toString()),Object.keys(this.Parent.SelectedRow).Contains("VoucherNo")&&(S=parseInt(this.Parent.SelectedRow.RefInvID.toString()))),this.ParentDOc.ScreenObject.Preferences.ContainsKey("BinFilterDim")&&!i.e.IsEmpty(this.ParentDOc.ScreenObject.Preferences.BinFilterDim)&&(this.dimccid=i.e.IntTryParse(this.ParentDOc.ScreenObject.Preferences.BinFilterDim),this.dimccid>0&&(b=this.ParentDOc.GetDimValue(this.dimccid,this.ParentDOc.SelectedRow)));var f=0;null==this.ParentDOc||null==this.drSel||-1!=this.VoucherType||i.e.IsEmpty(this.drSel.LinkedInvDocDetailsID)||(f=i.e.IntTryParse(this.drSel.LinkedInvDocDetailsID)),(null==this.dsBins||e)&&(this.dsBins=this.ParentDOc.ScreenObject.GetProductwiseBins(this.ProductID,this.DocId,this.VoucherType,this.docdate,m,this.DimensionID,this.dimccid,this.FilterDim.Visible?this.FilterDim.SelectedValue:b,f,this.batchid,S,this.ParentDOc.GetBOEIDS(this.ParentDOc.SelectedRow))),this.LoadFields(e)}1==this.VoucherType&&this.ParentDOc.ScreenObject.Preferences.ContainsKey("NoOfBins")&&i.e.IntTryParse(this.ParentDOc.ScreenObject.Preferences.NoOfBins)>0&&this.cnt>0&&(this.NoofBins.Visible=!0,this.NoofBins.Text=this.cnt.toString())}},{key:"OnScan",value:function(e,t){var a=this;if(!i.e.IsEmpty(this.Scan.Text)&&"13"==t.keyCode){var n=this.BinsGrid.Table.filter((function(e){return e.Name=a.Scan.Text}));0==n.length&&(n=this.BinsGrid.Table.filter((function(e){return e.Code==a.Scan.Text}))),n.length>0&&(n[0].Allocate=i.e.IsEmpty(n[0].Allocate)?1:parseFloat(n[0].Allocate)+1,this.celledtiend(n[0]),this.Scan.Text="",event.preventDefault())}}},{key:"OnTypeChanged",value:function(e){var t,a=this,s=0,r=0,o=0;if(this.dimccid=0,"-1"==this.FromTO.SelectedValue){if(this.VoucherType=-1,null==this.drSel||null==this.drSel.DocDetailsID||i.e.IsEmpty(this.drSel.DocDetailsID)||(this.DocDetailsId=parseInt(this.drSel.DocDetailsID)),null!=this.ParentDOc&&n.a.SessionManager.Preferences.ContainsKey("DimensionwiseBins")&&""!=n.a.SessionManager.Preferences.DimensionwiseBins.toString()){var l=!1;if((s=i.e.IntTryParse(n.a.SessionManager.Preferences.DimensionwiseBins))>0){this.DimensionID=1;for(var c=0;c<this.ParentDOc.ScreenObject._CCFields.length;c++){var u=this.ParentDOc.ScreenObject._CCFields[c];if(u instanceof d.b&&u.CCID==s){this.DimensionID=u.SelectedValue,this.WareHouse.Visible&&(this.WareHouse.Label=u.Label,this.WareHouse.Text=u.Text),l=!0;break}}!l&&this.drSel&&s>5e4&&this.Parent.ScreenObject.GridDataColumns.Contains("dcCCNID"+(s-5e4).toString()+"_Key")&&!i.e.IsEmpty(this.drSel["dcCCNID"+(s-5e4).toString()+"_Key"])&&(this.WareHouse.Visible&&((S=this.ParentDOc.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember.toLowerCase()=="dcccnid"+(s-5e4).toString()})))&&(this.WareHouse.Label=S.Header),this.WareHouse.Text=this.drSel["dcCCNID"+(s-5e4).toString()].toString()),this.DimensionID=parseInt(this.drSel["dcCCNID"+(s-5e4).toString()+"_Key"]))}}-1==this.VoucherType&&"BatchNumberViewModel"==(null===(t=this.Parent)||void 0===t?void 0:t.ClassName)&&null!=this.Parent.SelectedRow&&(this.batchid=parseInt(this.Parent.SelectedRow.batchid),this.Parent.SelectedRow.Row.TableColumns.Contains("VoucherNo")&&(r=parseInt(this.Parent.SelectedRow.RefInvID)))}else if(this.VoucherType=1,null!=this.drSel&&i.e.IsNum(this.drSel.ToDocDetailsID)&&(this.DocDetailsId=parseInt(this.drSel.ToDocDetailsID)),null!=this.ParentDOc&&n.a.SessionManager.Preferences.ContainsKey("DimensionwiseBins")&&""!=n.a.SessionManager.Preferences.DimensionwiseBins.toString()){var h=!1;if((s=i.e.IntTryParse(n.a.SessionManager.Preferences.DimensionwiseBins))>0){this.DimensionID=1;for(var D=function(e){var t=a.ParentDOc.ScreenObject._CCFields[e];if(t instanceof d.b&&t.CCID==s)return t.DBColumnName.Contains("TO")?t.SelectedValue>0&&(a.DimensionID=t.SelectedValue,a.WareHouse.Visible&&(a.WareHouse.Label=t.Label,a.WareHouse.Text=t.Text)):(b=a.ParentDOc.ScreenObject._CCFields.find((function(e){return e.DBColumnName=="TO"+t.DBColumnName})))instanceof d.b?(b.SelectedValue>0&&(a.DimensionID=b.SelectedValue),a.WareHouse.Visible&&(a.WareHouse.Label=b.Label,a.WareHouse.Text=b.Text)):(t.SelectedValue>0&&(a.DimensionID=t.SelectedValue),a.WareHouse.Visible&&(a.WareHouse.Label=t.Label,a.WareHouse.Text=t.Text)),h=!0,"break"},m=0;m<this.ParentDOc.ScreenObject._CCFields.length;m++){var b;if("break"===D(m))break}if(!h&&this.drSel&&s>5e4&&this.Parent.ScreenObject.GridDataColumns.Contains("dcCCNID"+(s-5e4).toString()+"_Key"))if(this.Parent.ScreenObject.GridDataColumns.Contains("TOdcCCNID"+(s-5e4).toString()+"_Key"))i.e.IntTryParse(this.drSel["TOdcCCNID"+(s-5e4).toString()+"_Key"])>0&&(this.DimensionID=parseInt(this.drSel["TOdcCCNID"+(s-5e4).toString()+"_Key"]),this.WareHouse.Visible&&((S=this.ParentDOc.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember.toLowerCase()=="todcccnid"+(s-5e4).toString()})))&&(this.WareHouse.Label=S.Header),this.WareHouse.Text=this.drSel["todcCCNID"+(s-5e4).toString()].toString()));else if(i.e.IntTryParse(this.drSel["dcCCNID"+(s-5e4).toString()+"_Key"])>0){var S;this.DimensionID=parseInt(this.drSel["dcCCNID"+(s-5e4).toString()+"_Key"]),this.WareHouse.Visible&&((S=this.ParentDOc.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember.toLowerCase()=="dcccnid"+(s-5e4).toString()})))&&(this.WareHouse.Label=S.Header),this.WareHouse.Text=this.drSel["dcCCNID"+(s-5e4).toString()].toString())}}}this.ParentDOc.ScreenObject.Preferences.ContainsKey("BinFilterDim")&&""!=this.ParentDOc.ScreenObject.Preferences.BinFilterDim.toString()&&(this.dimccid=i.e.IntTryParse(this.ParentDOc.ScreenObject.Preferences.BinFilterDim),this.dimccid>0&&(o=this.ParentDOc.GetDimValue(this.dimccid,this.ParentDOc.SelectedRow)));var C=0;null==this.ParentDOc||null==this.drSel||-1!=this.VoucherType||i.e.IsEmpty(this.drSel.LinkedInvDocDetailsID)||(C=i.e.IntTryParse(this.drSel.LinkedInvDocDetailsID)),this.dsBins=this.ParentDOc.ScreenObject.GetProductwiseBins(this.ProductID,this.DocId,this.VoucherType,this.docdate,s,this.DimensionID,this.dimccid,this.FilterDim.Visible?this.FilterDim.SelectedValue:o,C,this.batchid,r,this.ParentDOc.GetBOEIDS(this.ParentDOc.SelectedRow)),this.LoadFields(!1),1==this.VoucherType&&this.ParentDOc.ScreenObject.Preferences.ContainsKey("NoOfBins")&&i.e.Int(this.ParentDOc.ScreenObject.Preferences.NoOfBins)>0?(this.NoofBins.Visible=!0,this.NoofBins.Text=this.cnt.toString()):this.NoofBins.Visible=!1}},{key:"LoadFields",value:function(e){var t,a,s,o,c=this,d=[],u=[],h=[];if(h.push("Serialno"),h.push("NodeID"),h.push("Name"),h.push("Code"),h.push("Capacity"),h.push("BalQty"),h.push("Used"),h.push("Available"),h.push("Allocate"),this.ParentDOc.ScreenObject.Preferences.ContainsKey("bincapacityonVolume")&&"true"==this.ParentDOc.ScreenObject.Preferences.bincapacityonVolume.toLowerCase()&&1==this.VoucherType&&h.push("AvailQty"),this.ParentDOc.ScreenObject.Preferences.ContainsKey("ConsolidatedBins")&&"false"==this.ParentDOc.ScreenObject.Preferences.ConsolidatedBins.toLowerCase()&&h.push("Remarks"),this.BinsGrid.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.BinsGrid.OnBeginEdit.Subscribe(this,"OnBeginEdit"),this.BinsGrid.Width="630",null!=this.dsBins&&0!=this.dsBins.Tables.length){this.dsBins.Columns[0].Contains("Vol")&&this.dsBins.Tables[0].length>0&&i.e.IsNum(this.dsBins.Tables[0][0].Vol)&&(this.vol=parseFloat(this.dsBins.Tables[0][0].Vol)),this.dsBins.Columns[0].Contains("waist")&&this.dsBins.Tables[0].length>0&&i.e.IsNum(this.dsBins.Tables[0][0].waist)&&(this.Waist=parseFloat(this.dsBins.Tables[0][0].waist));var D=new r.a;D.Header="Sno",D.DisplayMember="Serialno",D.DataType="TextBlock",D.ReadOnly=!0,D.Width=50,D.DisableTab=!0,d.push(D),(D=new r.a).Header="Bin No",D.DisplayMember="Name",D.ReadOnly=!0,D.Width=150,D.DisableTab=!0,D.DataType="LINK",D.DisableTab=!0,D.Click.Subscribe(this,"onBinClick"),d.push(D),(this.ParentDOc.ScreenObject.Preferences.ContainsKey("ProductWiseBins")&&"true"==this.ParentDOc.ScreenObject.Preferences.ProductWiseBins.toLowerCase()||this.ParentDOc.ScreenObject.Preferences.ContainsKey("bincapacityonVolume")&&"true"==this.ParentDOc.ScreenObject.Preferences.bincapacityonVolume.toLowerCase())&&((D=new r.a).Header="Capacity",this.ParentDOc.ScreenObject.Preferences.ContainsKey("bincapacityonVolume")&&"true"==this.ParentDOc.ScreenObject.Preferences.bincapacityonVolume.toLowerCase()&&(1==this.VoucherType?D.Header="Volume":D.IsVisible=!1),D.DisplayMember="Capacity",D.DataType="FLOAT",D.ReadOnly=!0,D.Width=100,D.DisableTab=!0,d.push(D)),1==this.VoucherType&&((D=new r.a).Header="Used",D.DisplayMember="Used",D.DataType="FLOAT",D.ReadOnly=!0,D.Width=100,D.DisableTab=!0,d.push(D)),this.ParentDOc.ScreenObject.Preferences.ContainsKey("Waistage")&&"true"==this.ParentDOc.ScreenObject.Preferences.Waistage.toLowerCase()&&1==this.VoucherType&&((D=new r.a).Header="Wastage",D.DisplayMember="Waistage",D.ReadOnly=!0,D.DataType="FLOAT",D.Width=100,D.DisableTab=!0,d.push(D),h.push("Waistage")),(this.ParentDOc.ScreenObject.Preferences.ContainsKey("ProductWiseBins")&&"true"==this.ParentDOc.ScreenObject.Preferences.ProductWiseBins.toLowerCase()||this.ParentDOc.ScreenObject.Preferences.ContainsKey("bincapacityonVolume")&&"true"==this.ParentDOc.ScreenObject.Preferences.bincapacityonVolume.toLowerCase()||-1==this.VoucherType)&&((D=new r.a).Header="Available",D.DisplayMember="Available",D.ReadOnly=!0,D.DataType="FLOAT",D.Width=100,D.DisableTab=!0,d.push(D)),this.ParentDOc.ScreenObject.Preferences.ContainsKey("bincapacityonVolume")&&"true"==this.ParentDOc.ScreenObject.Preferences.bincapacityonVolume.toLowerCase()&&1==this.VoucherType&&((D=new r.a).Header="Qty Available",D.DisplayMember="AvailQty",D.ReadOnly=!0,D.DataType="FLOAT",D.Width=100,D.DisableTab=!0,d.push(D),this.BinsGrid.Width="730",this.Width=780),(D=new r.a).Header="Allocate",D.DisplayMember="Allocate",D.DataType="FLOAT",D.Width=100,d.push(D),h.Contains("Remarks")&&(-1==this.VoucherType&&((D=new r.a).Header="Doc No",D.DisplayMember="DocNo",D.Width=100,D.DisableTab=!0,D.ReadOnly=!0,d.push(D),h.push("DocNo"),h.push("InvID")),(D=new r.a).Header="Remarks",D.DisplayMember="Remarks",D.Width=100,D.DisableTab=!0,-1==this.VoucherType&&(D.ReadOnly=!0),d.push(D));for(var m="",b=new i.f,S=0;S<this.ParentDOc.ScreenObject.GridData.length;S++)if(this.ParentDOc.ScreenObject.GridData[S]!=this.drSel&&i.e.String(this.ParentDOc.ScreenObject.GridData[S].ProductId_Key)==i.e.String(this.drSel.ProductId_Key)){if(!(1!=this.VoucherType||this.ParentDOc.ScreenObject.Preferences.ContainsKey("ProductWiseBins")&&"true"==this.ParentDOc.ScreenObject.Preferences.ProductWiseBins.toLowerCase()||this.ParentDOc.ScreenObject.Preferences.ContainsKey("bincapacityonVolume")&&"true"==this.ParentDOc.ScreenObject.Preferences.bincapacityonVolume.toLowerCase()))continue;if(-1==this.VoucherType&&this.batchid>0&&"5"==i.e.String(this.ParentDOc.ScreenObject.GridData[S].Type)&&!i.e.IsEmpty(this.ParentDOc.ScreenObject.GridData[S].ExtraXML)){var C=new i.f;C.LoadXml(this.ParentDOc.ScreenObject.GridData[S].ExtraXML);var y=C.SelectNodes("xml/Row");if(y.length>0&&null!=y[0].attributes.BatchID.value&&y[0].attributes.BatchID.value!=this.batchid.toString())continue}m+=i.e.String(5==this.ParentDOc.ScreenObject.DocumentType&&1==this.VoucherType?this.ParentDOc.ScreenObject.GridData[S].TOBinsXML:this.ParentDOc.ScreenObject.GridData[S].BinsXML)}if("BatchNumberViewModel"==(null===(t=this.Parent)||void 0===t?void 0:t.ClassName))for(var p=0;p<this.Parent.GridData.length;p++)if(this.Parent.GridData[p]!=this.Parent.SelectedRow){if(!(1!=this.VoucherType||this.ParentDOc.ScreenObject.Preferences.ContainsKey("ProductWiseBins")&&"true"==this.ParentDOc.ScreenObject.Preferences.ProductWiseBins.toLowerCase()||this.ParentDOc.ScreenObject.Preferences.ContainsKey("bincapacityonVolume")&&"true"==this.ParentDOc.ScreenObject.Preferences.bincapacityonVolume.toLowerCase()))continue;if(-1==this.VoucherType)continue;m+=5==this.ParentDOc.ScreenObject.DocumentType&&1==this.VoucherType?this.Parent.GridData[p].TOBinsXML.toString():this.Parent.GridData[p].BinsXML.toString()}""!=m&&(m="<BinsXML>"+(m=m.replace("<BinsXML>","").replace("</BinsXML>",""))+"</BinsXML>",b.ReadXml(m));for(var g=function(t){var a=c.BinsGrid.NewRow();if(a.Serialno=(t+1).toString(),a.NodeID=c.dsBins.Tables[0][t].NodeID.toString(),a.Name=c.dsBins.Tables[0][t].Name.toString(),a.Code=c.dsBins.Tables[0][t].Code.toString(),a.Capacity=c.ParentDOc.ScreenObject.Preferences.ContainsKey("bincapacityonVolume")&&"true"==c.ParentDOc.ScreenObject.Preferences.bincapacityonVolume.toLowerCase()&&c.dsBins.Columns[0].Contains("ccAlpha50")?i.e.StringValue(c.dsBins.Tables[0][t].ccAlpha50):i.e.StringValue(c.dsBins.Tables[0][t].Capacity),-1==c.VoucherType&&h.Contains("Remarks")&&c.dsBins.Columns[0].Contains("remarks")&&(a.Remarks=i.e.String(c.dsBins.Tables[0][t].remarks),null!=c.dsBins.Tables[0][t].invdocdetailsid&&(a.InvID=c.dsBins.Tables[0][t].invdocdetailsid),a.DocNo=c.dsBins.Tables[0][t].Voucherno.toString()),b.Tables.length>0){var n,s=0,r=0;n=-1==c.VoucherType&&h.Contains("InvID")&&b.Columns[0].Contains("RefID")&&!i.e.IsEmpty(a.InvID)?b.Tables[0].filter((function(e){return e.NodeID==c.dsBins.Tables[0][t].NodeID&&e.RefID==a.InvID})):b.Tables[0].filter((function(e){return e.NodeID==c.dsBins.Tables[0][t].NodeID})),1==c.VoucherType&&c.ParentDOc.ScreenObject.Preferences.ContainsKey("bincapacityonVolume")&&"true"==c.ParentDOc.ScreenObject.Preferences.bincapacityonVolume.toLowerCase()?n.forEach((function(e){!b.Columns[0].Contains("Vol")||i.e.IsEmpty(e.Allocate)||i.e.IsEmpty(e.Vol)||(s+=parseFloat(e.Allocate)*parseFloat(e.Vol)),!b.Columns[0].Contains("Waist")||i.e.IsEmpty(e.Allocate)||i.e.IsEmpty(e.Waist)||(r+=parseFloat(e.Allocate)*parseFloat(e.Waist))})):n.forEach((function(e){i.e.IsEmpty(e.Allocate)||(s+=parseFloat(e.Allocate))})),1==c.VoucherType?(s>0&&!i.e.IsEmpty(c.dsBins.Tables[0][t].BalQty)&&(c.dsBins.Tables[0][t].BalQty=parseFloat(c.dsBins.Tables[0][t].BalQty)+s),r>0&&c.dsBins.Columns[0].Contains("Waistage")&&!i.e.IsEmpty(c.dsBins.Tables[0][t].Waistage)&&(c.dsBins.Tables[0][t].Waistage=parseFloat(c.dsBins.Tables[0][t].Waistage)+r)):-1==c.VoucherType&&s>0&&!i.e.IsEmpty(c.dsBins.Tables[0][t].BalQty)&&(c.dsBins.Tables[0][t].BalQty=parseFloat(c.dsBins.Tables[0][t].BalQty)-s)}if(a.BalQty=c.dsBins.Tables[0][t].BalQty.toString(),i.e.IsEmpty(c.dsBins.Tables[0][t].BalQty)||(-1==c.VoucherType?a.Available=c.dsBins.Tables[0][t].BalQty.toString():a.Used=c.dsBins.Tables[0][t].BalQty.toString(),h.Contains("Waistage")&&c.dsBins.Columns[0].Contains("Waistage")&&(a.Waistage=c.dsBins.Tables[0][t].Waistage.toString()),1==c.VoucherType&&i.e.IsNum(a.Capacity)&&(c.ParentDOc.ScreenObject.Preferences.ContainsKey("ProductWiseBins")&&"true"==c.ParentDOc.ScreenObject.Preferences.ProductWiseBins.toLowerCase()||c.ParentDOc.ScreenObject.Preferences.ContainsKey("bincapacityonVolume")&&"true"==c.ParentDOc.ScreenObject.Preferences.bincapacityonVolume.toLowerCase())&&(o=parseFloat(a.Capacity)-parseFloat(c.dsBins.Tables[0][t].BalQty),c.dsBins.Columns[0].Contains("Waistage")&&(o-=parseFloat(c.dsBins.Tables[0][t].Waistage)),a.Available=o>0?o:0),h.Contains("AvailQty")&&!i.e.IsEmpty(a.Available)&&c.vol>0&&(a.AvailQty=Math.trunc(parseFloat(a.Available)/c.vol))),c.FilterDim.Visible&&e&&null!=c.dttemp){var l=null;null!=(l=c.dsBins.Columns[0].Contains("invdocdetailsid")&&!i.e.IsEmpty(c.dsBins.Tables[0][t].invdocdetailsid)?c.dttemp.filter((function(e){return e.NodeID==a.NodeID.toString()&&e.InvID==c.dsBins.Tables[0][t].invdocdetailsid.toString()})):c.dttemp.filter((function(e){return e.NodeID==a.NodeID.toString()})))&&l.length>0&&!i.e.IsEmpty(l[0].Allocate)&&(a.Allocate=l[0].Allocate.toString())}u.push(a)},f=0;f<this.dsBins.Tables[0].length;f++)g(f);for(var I=u.length;I<15;I++)u.push();if(!e){this.FilterDim.Visible&&this.AddColumns();var T=new i.f;if("AddEditDocumentViewModel"==(null===(a=this.Parent)||void 0===a?void 0:a.ClassName)&&null!=this.drSel){if(5==this.ParentDOc.ScreenObject.DocumentType&&1==this.VoucherType){if(!i.e.IsEmpty(this.drSel.TOBinsXML)){T.LoadXml(this.drSel.TOBinsXML);for(var P=T.SelectNodes("BinsXML/Row"),O=0;O<P.length;O++){this.FilterDim.Visible&&this.AddRow(P[O]);for(var B=0;B<u.length;B++){var G=u[B];if(G.NodeID.toString()==P[O].attributes.NodeID.value.toString()){G.Allocate=P[O].attributes.Allocate.value.toString(),1==this.VoucherType&&h.Contains("Remarks")&&null!=P[O].attributes.Remarks&&!i.e.IsEmpty(P[O].attributes.Remarks.value)&&(G.Remarks=P[O].attributes.Remarks.value);break}}}}}else if(!i.e.IsEmpty(this.drSel.BinsXML)){T.LoadXml(this.drSel.BinsXML);for(var N=T.SelectNodes("BinsXML/Row"),v=0;v<N.length;v++){this.FilterDim.Visible&&this.AddRow(N[v]);for(var M=0;M<u.length;M++){var j=u[M];if(j.NodeID.toString()==N[v].attributes.NodeID.value.toString()&&(!h.Contains("InvID")||null!=N[v].attributes.RefID&&!i.e.IsEmpty(N[v].attributes.RefID.value)&&j.InvID.toString()==N[v].attributes.RefID.value)){j.Allocate=N[v].attributes.Allocate.value.toString(),1==this.VoucherType&&h.Contains("Remarks")&&null!=N[v].attributes.Remarks&&!i.e.IsEmpty(N[v].attributes.Remarks.value)&&(j.Remarks=N[v].attributes.Remarks.value);break}}}}}else if("BatchNumberViewModel"==(null===(s=this.Parent)||void 0===s?void 0:s.ClassName)&&null!=this.Parent.SelectedRow)if(5==this.ParentDOc.ScreenObject.DocumentType&&1==this.VoucherType){if(!i.e.IsEmpty(this.Parent.SelectedRow.TOBinsXML)){T.LoadXml(this.Parent.SelectedRow.TOBinsXML);for(var V=T.SelectNodes("BinsXML/Row"),A=0;A<V.length;A++){this.FilterDim.Visible&&this.AddRow(V[A]);for(var R=0;R<u.length;R++){var w=u[R];if(w.NodeID.toString()==V[A].attributes.NodeID.value){w.Allocate=V[A].attributes.Allocate.value.toString();break}}}}}else if(!i.e.IsEmpty(this.Parent.SelectedRow.BinsXML)){T.LoadXml(this.Parent.SelectedRow.BinsXML);for(var E=T.SelectNodes("BinsXML/Row"),Q=0;Q<E.length;Q++){this.FilterDim.Visible&&this.AddRow(E[Q]);for(var L=0;L<u.length;L++){var F=u[L];if(F.NodeID.toString()==E[Q].attributes.NodeID.value){F.Allocate=E[Q].attributes.Allocate.value.toString();break}}}}}this.BinsGrid.Columns=d,this.BinsGrid.Table=u,this.BinsGrid.TableColumns=h,this.BinsGrid.SearchVisible=!0,this.BinsGrid.SearchText.SetFocus=!0,this.BinsGrid.SearchColStartIndex=1,this.BinsGrid.AddSearchCols(),this.CalcTotal(),this.ImportCols=[],this.DtImport=[],this.DtImportColumns=[],(D=new r.a).DisplayMember="FieldName",D.Header=n.a.GetResource("Import_FieldName"),D.DataType="TextBlock",D.Width=100,D.ReadOnly=!0,this.ImportCols.push(D),this.DtImportColumns.push("FieldName"),(D=new r.a).DisplayMember="Name",D.ValueMember="Value",D.ValueBinding="FeatureFieldName",D.Header=n.a.GetResource("Import_FeatureFieldName"),D.DataType="ComboBox",D.Width=120;var _=[];_.push(l.d.ComboBoxItems_2("","")),_.push(l.d.ComboBoxItems_2("Bin No","Bin")),_.push(l.d.ComboBoxItems_2("Product Name","Product")),_.push(l.d.ComboBoxItems_2("Allocate","Qty")),D.ComboData=_,this.ImportCols.push(D),this.DtImportColumns.push("FeatureFieldName")}}},{key:"AddRow",value:function(e){var t={};null==e.attributes.NodeID||i.e.IsEmpty(e.attributes.NodeID.value)||(t.NodeID=e.attributes.NodeID.Value),null==e.attributes.Allocate||i.e.IsEmpty(e.attributes.Allocate.value)||(t.Allocate=e.attributes.Allocate.Value),null==e.attributes.Remarks||i.e.IsEmpty(e.attributes.Remarks.value)||(t.Remarks=e.attributes.Remarks.Value),null==e.attributes.RefID||i.e.IsEmpty(e.attributes.RefID.value)||(t.InvID=e.attributes.RefID.Value),this.dttemp.push(t)}},{key:"onBinClick",value:function(e){if(null!=this.BinsGrid.SelectedItem&&!i.e.IsEmpty(this.BinsGrid.SelectedItem.NodeID)){var t=new u.DocumentDraftsViewModel(this,5),a=this.ParentDOc.ScreenObject.GetProductsinBin(this.BinsGrid.SelectedItem.NodeID.toString());if(null!=a&&a.Tables.length>0&&a.Columns[0].Contains("ProductCode")){t.ColSource=[],t.Table=[],t.TableColumns=[];var s=new r.a;s.DisplayMember="ProductCode",s.Header=n.a.GetResource("ProductCode"),s.DataType="TextBlock",s.Width=200,s.ReadOnly=!0,s.TextAlign="left",t.ColSource.push(s),t.TableColumns.push("ProductCode"),(s=new r.a).DisplayMember="ProductName",s.Header=n.a.GetResource("ProductName"),s.DataType="TextBlock",s.Width=200,s.ReadOnly=!0,t.ColSource.push(s),t.TableColumns.push("ProductName"),(s=new r.a).DisplayMember="Quantity",s.Header=n.a.GetResource("Quantity"),s.DataType="FLOAT",s.Width=70,s.ReadOnly=!0,t.ColSource.push(s),t.TableColumns.push("Quantity"),t.DisplayName="Bins Info ["+this.BinsGrid.SelectedItem.Name.toString()+"]",t.PopupWidth=490;for(var o=0;o<a.Tables[0].length;o++){var l=t.Grid.NewRow();l.ProductCode=a.Tables[0][o].ProductCode.toString(),l.ProductName=a.Tables[0][o].ProductName.toString(),l.Quantity=a.Tables[0][o].Qty.toString(),t.Grid.addRow(l)}n.a.page.ShowDialog(t,h.DocumentDraftsComponent)}}}},{key:"OnBeginEdit",value:function(e,t,a){if("Allocate"==t){if(n.a.SessionManager.IsActionAssigned(43,"Mandatory Scan Bin"))return!0;this.SelectQty(e)}return!1}},{key:"SelectQty",value:function(e){var t=i.e.DoubleTryParse(e.Allocate);if(i.e.IsEmpty(e.Allocate)||0==t){for(var a=0,n=new Array,s=0;s<this.BinsGrid.Table.length;s++)i.e.IsEmpty(this.BinsGrid.Table[s].Allocate)||i.e.IsEmpty(this.BinsGrid.Table[s].NodeID)||(n.push(this.BinsGrid.Table[s].NodeID.toString()),a+=parseFloat(this.BinsGrid.Table[s].Allocate));if(null!=this.dttemp)for(var r=0;r<this.dttemp.length;r++)i.e.IsEmpty(this.dttemp[r].NodeID)||n.Contains(this.dttemp[r].NodeID.toString())||(a+=parseFloat(this.dttemp[r].Allocate));(a=this.Qty-a)>0&&(-1==this.VoucherType||this.ParentDOc.ScreenObject.Preferences.ContainsKey("ProductWiseBins")&&"true"==this.ParentDOc.ScreenObject.Preferences.ProductWiseBins.toLowerCase()&&(!this.ParentDOc.ScreenObject.Preferences.ContainsKey("bincapacityonVolume")||"true"!=this.ParentDOc.ScreenObject.Preferences.bincapacityonVolume.toLowerCase())?i.e.IsEmpty(e.Available)||(e.Allocate=a>parseFloat(e.Available)?e.Available:a):e.Allocate=a)}}},{key:"OnCellEditEnding",value:function(e){"DataGridComboBoxColumn"!=e.column.className&&"Allocate"==e.column.field&&this.celledtiend(e.item)}},{key:"celledtiend",value:function(e){var t=!1;(-1==this.VoucherType||this.ParentDOc.ScreenObject.Preferences.ContainsKey("DonotExceedCapacity")&&"true"==this.ParentDOc.ScreenObject.Preferences.DonotExceedCapacity.toLowerCase()&&1==this.VoucherType&&(this.ParentDOc.ScreenObject.Preferences.ContainsKey("ProductWiseBins")&&"true"==this.ParentDOc.ScreenObject.Preferences.ProductWiseBins.toLowerCase()||this.ParentDOc.ScreenObject.Preferences.ContainsKey("bincapacityonVolume")&&"true"==this.ParentDOc.ScreenObject.Preferences.bincapacityonVolume.toLowerCase()))&&(t=!0),!t||i.e.IsEmpty(e.Available)||i.e.IsEmpty(e.Allocate)||(1==this.VoucherType&&this.ParentDOc.ScreenObject.Preferences.ContainsKey("bincapacityonVolume")&&"true"==this.ParentDOc.ScreenObject.Preferences.bincapacityonVolume.toLowerCase()?!i.e.IsEmpty(e.AvailQty)&&parseFloat(e.AvailQty)<parseFloat(e.Allocate)&&(e.Allocate=e.AvailQty.toString(),this.DisplayMessage="Can not enter more than "+e.AvailQty.toString(),this.MessageVisibility=!0,this.BinsGrid.updateRow(e)):parseFloat(e.Available)<parseFloat(e.Allocate)&&(e.Allocate=e.Available,this.DisplayMessage="Can not enter more than "+e.Available.toString(),this.MessageVisibility=!0,this.BinsGrid.updateRow(e))),this.CalcTotal()}},{key:"CalcTotal",value:function(){this.InvQty=0;for(var e=new Array,t=0;t<this.BinsGrid.Table.length;t++)i.e.IsEmpty(this.BinsGrid.Table[t].Allocate)||i.e.IsEmpty(this.BinsGrid.Table[t].NodeID)||(e.push(this.BinsGrid.Table[t].NodeID.toString()),this.InvQty+=parseFloat(this.BinsGrid.Table[t].Allocate));if(null!=this.dttemp)for(var a=0;a<this.dttemp.length;a++)i.e.IsEmpty(this.dttemp[a].NodeID)||e.Contains(this.dttemp[a].NodeID.toString())||(this.InvQty+=parseFloat(this.dttemp[a].Allocate));this.QtyAddMessage=i.e.Format(n.a.GetResource("Bins_AddMessage"),this.InvQty.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty),this.Qty.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty),this.ProdName.toString())}},{key:"AddColumns",value:function(){this.dttemp=[]}},{key:"OnSave",value:function(e){var t,a,s,r,o,l,c,d,u=this;if("Cancel"==e.toString())n.a.page.HideDialog();else if("Refresh"==e.toString())i.e.IntTryParse(this.NoofBins.Text);else if("Load"==e.toString()){null==this.dttemp&&this.AddColumns();for(var h=function(e){var t;!i.e.IsEmpty(u.BinsGrid.Table[e].NodeID)&&!i.e.IsEmpty(u.BinsGrid.Table[e].Allocate)&&parseFloat(u.BinsGrid.Table[e].Allocate.toString())>0&&((m=u.dttemp.filter((function(t){return t.NodeID==u.BinsGrid.Table[e].NodeID.toString()}))).length>0?t=m[0]:(t=u.dttemp.NewRow(),u.dttemp.push(t)),t.NodeID=u.BinsGrid.Table[e].NodeID.toString(),t.Allocate=u.BinsGrid.Table[e].Allocate.toString(),1==u.VoucherType&&u.BinsGrid.TableColumns.Contains("Remarks")?t.Remarks=u.BinsGrid.Table[e].Remarks.toString():-1==u.VoucherType&&u.BinsGrid.TableColumns.Contains("InvID")&&(t.InvID=u.BinsGrid.Table[e].InvID.toString()))},D=0;D<this.BinsGrid.Table.length;D++){var m;h(D)}this.Refresh(!0)}else if("Sort"==e.toString()){this.BinsGrid.TableColumns.Contains("EmptySort")||this.BinsGrid.TableColumns.push("EmptySort"),i.e.IsEmpty(this.SortCols.SelectedValue)||("EmptySort,",this.SortCols.SelectedValue,i.e.IsEmpty(this.SortOrder.SelectedValue)||" "+this.SortOrder.SelectedValue)}else if("ImportVisiblity"==e.toString())this.Width=this.BinsGrid.TableColumns.Contains("AvailQty")?1030:950,this.ImportVisiblity=!0;else if("CancelImport"==e.toString())this.ImportVisiblity=!1,this.Width=this.BinsGrid.TableColumns.Contains("AvailQty")?780:700;else if("Import"==e.toString())this.ImportData();else if("Open"==e.toString());else if("openfile"==e.toString());else if("Save"==e.toString()||"AutoSave"==e.toString()||"OK"==e.toString()){for(var b=0,S=new Array,C=0;C<this.BinsGrid.Table.length;C++)i.e.IsEmpty(this.BinsGrid.Table[C].NodeID)||i.e.IsNum(this.BinsGrid.Table[C].Allocate)&&(S.push(this.BinsGrid.Table[C].NodeID.toString()),b+=parseFloat(this.BinsGrid.Table[C].Allocate));if(null!=this.dttemp)for(var y=0;y<this.dttemp.length;y++)i.e.IsEmpty(this.dttemp[y].NodeID)||S.Contains(this.dttemp[y].NodeID.toString())||(b+=parseFloat(this.dttemp[y].Allocate));if(n.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=n.a.SessionManager.Preferences.DecimalsinQty){var p=b.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty);b=parseFloat(p)}if(this.ParentDOc.ScreenObject.GridDataColumns.Contains("BinStatus")){if(b>this.Qty)return this.DisplayMessage="Can not adjust more than product qty.",void(this.MessageVisibility=!0)}else if(b!=this.Qty)return this.DisplayMessage="Qty not equal",void(this.MessageVisibility=!0);var g="",f="";f+="<BinsXML>";for(var I=0;I<this.BinsGrid.Table.length;I++)!i.e.IsEmpty(this.BinsGrid.Table[I].NodeID)&&!i.e.IsEmpty(this.BinsGrid.Table[I].Allocate)&&parseFloat(this.BinsGrid.Table[I].Allocate)>0&&(f+="<Row ",f+=' NodeID="'+this.BinsGrid.Table[I].NodeID.toString()+'" ',f+=' Allocate="'+this.BinsGrid.Table[I].Allocate.toString()+'" ',this.DimensionID>0&&(f+=' Warehouse="'+this.DimensionID+'" '),1==this.VoucherType&&(f+=' Vol="'+this.vol+'" ',f+=' Waist="'+this.Waist+'" '),1==this.VoucherType&&this.BinsGrid.TableColumns.Contains("Remarks")?f+=' Remarks="'+i.e.String(this.BinsGrid.Table[I].Remarks)+'" ':-1==this.VoucherType&&this.BinsGrid.TableColumns.Contains("InvID")&&(f+=' RefID="'+this.BinsGrid.Table[I].InvID.toString()+'" '),f+=" ></Row>",""!=g&&(g=", "),g+=this.BinsGrid.Table[I].Name.toString());if(null!=this.dttemp)for(var T=0;T<this.dttemp.length;T++)i.e.IsEmpty(this.dttemp[T].NodeID)||S.Contains(this.dttemp[T].NodeID.toString())||(f+="<Row ",f+=' NodeID="'+this.dttemp[T].NodeID.toString()+'" ',f+=' Allocate="'+this.dttemp[T].Allocate.toString()+'" ',this.DimensionID>0&&(f+=' Warehouse="'+this.DimensionID+'" '),1==this.VoucherType&&(f+=' Vol="'+this.vol+'" ',f+=' Waist="'+this.Waist+'" '),1==this.VoucherType&&this.BinsGrid.TableColumns.Contains("Remarks")?f+=' Remarks="'+this.dttemp[T].Remarks.toString()+'" ':-1==this.VoucherType&&this.BinsGrid.TableColumns.Contains("InvID")&&(f+=' RefID="'+this.dttemp[T].InvID.toString()+'" '),f+=" ></Row>");if(f+="</BinsXML>",5==this.ParentDOc.ScreenObject.DocumentType&&1==this.VoucherType)"AddEditDocumentViewModel"==(null===(t=this.Parent)||void 0===t?void 0:t.ClassName)?this.drSel.TOBinsXML=f:"BatchNumberViewModel"==(null===(a=this.Parent)||void 0===a?void 0:a.ClassName)&&null!=this.Parent.SelectedRow&&(this.Parent.SelectedRow.TOBinsXML=f);else if("AddEditDocumentViewModel"==(null===(s=this.Parent)||void 0===s?void 0:s.ClassName)){this.drSel.BinsXML=f,this.ParentDOc.ScreenObject.GridDataColumns.Contains("BinStatus")&&(0==b?(this.drSel.BinStatus="UnAdjusted",this.drSel.BinStatus_COLOR="RED"):b==this.Qty?(this.drSel.BinStatus="Adjusted",this.drSel.BinStatus_COLOR="GREEN"):(this.drSel.BinStatus="Partial",this.drSel.BinStatus_COLOR="ORANGE"));var P=this.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&55494==e.LinkData}));P.length>0&&this.Parent.ScreenObject.GridDataColumns.Contains(P[0].SysColumnName.toString())&&(this.drSel[P[0].SysColumnName.toString()]=g)}else"BatchNumberViewModel"==(null===(r=this.Parent)||void 0===r?void 0:r.ClassName)&&null!=this.Parent.SelectedRow&&(this.Parent.SelectedRow.BinsXML=f,this.Parent.SelectedRow.strBins=g);if("AutoSave"!=e.toString()&&"OK"!=e.toString()){if(5==this.ParentDOc.ScreenObject.DocumentType&&this.FromTO.Items.length>1){var O="";if(1==this.VoucherType?"AddEditDocumentViewModel"==(null===(o=this.Parent)||void 0===o?void 0:o.ClassName)?O=this.drSel.BinsXML.toString():"BatchNumberViewModel"==(null===(l=this.Parent)||void 0===l?void 0:l.ClassName)&&null!=this.Parent.SelectedRow&&(O=this.Parent.SelectedRow.BinsXML.toString()):-1==this.VoucherType&&("AddEditDocumentViewModel"==(null===(c=this.Parent)||void 0===c?void 0:c.ClassName)?O=this.drSel.TOBinsXML.toString():"BatchNumberViewModel"==(null===(d=this.Parent)||void 0===d?void 0:d.ClassName)&&null!=this.Parent.SelectedRow&&(O=this.Parent.SelectedRow.TOBinsXML.toString())),b=0,""!=O){var B=new i.f;B.LoadXml(O);for(var G=B.SelectNodes("BinsXML/Row"),N=0;N<G.length;N++)null!=G[N].attributes.Allocate&&i.e.IsNum(G[N].attributes.Allocate.value)&&(b+=parseFloat(G[N].attributes.Allocate.value))}if(n.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=n.a.SessionManager.Preferences.DecimalsinQty){var v=b.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty);b=parseFloat(v)}if(b!=this.Qty)return this.DisplayMessage=1==this.VoucherType?"Select from bins":"Select to bins",void(this.MessageVisibility=!0)}n.a.page.HideDialog()}}}},{key:"AutoAdjust",value:function(){var e=this;if(this.ChkFifo)this.BinsGrid.Table.forEach((function(t){i.e.IsEmpty(t.NodeID)||(e.SelectQty(t),e.celledtiend(t),e.BinsGrid.updateRow(t))}));else for(var t=0;t<this.BinsGrid.Table.length;t++)i.e.IsEmpty(this.BinsGrid.Table[t].NodeID)||(this.BinsGrid.Table[t].Allocate=0,this.BinsGrid.updateRow(this.BinsGrid.Table[t]));this.CalcTotal()}},{key:"ImportData",value:function(){for(var e=this,t=function(t){for(var a=0,n="",s=0;s<e.DtImport.length;s++){var r=e.DtImport[s];i.e.String(r[1])||"0"==i.e.String(r[1])||("Qty"==r[1].toString()&&(a=0,i.e.IsNum(e.ExcelTable[t][r[0].toString()])&&(a=parseFloat(e.ExcelTable[t][r[0].toString()]))),"Bin"==r[1].toString()&&(n=e.ExcelTable[t][r[0].toString()].toString()),"Product"!=r[1].toString()||e.ExcelTable[t][r[0].toString()].toString())}if(""!=n&&a>0){var o=e.BinsGrid.Table.filter((function(e){return e.Name=n}));o.length>0&&(o[0].Allocate=a,e.celledtiend(o[0]))}},a=0;a<this.ExcelTable.length;a++)t(a)}},{key:"ChkFifo",get:function(){return this._ChkFifo},set:function(e){e!=this._ChkFifo&&(this._ChkFifo=e,this.AutoAdjust())}}]),a}(s.b)},"7eIC":function(e,t,a){"use strict";a.d(t,"a",(function(){return D}));var n=a("Do2H"),i=a("Lp6j"),s=a("eQJW"),r=a("ScVY"),o=a("6z9j"),l=a("NkMH"),c=a("gqOg"),d=a("WJZp"),u=a("ZDA+"),h=a("EQd/"),D=function(e){_inherits(a,e);var t=_createSuper(a);function a(){var e;return _classCallCheck(this,a),(e=t.call(this)).ClearSelectedNodes=!1,e._SelectAll=!1,e.ScanText=new h.d(0),e.ButtonSearch=new l.a,e.PendingList=!1,e.ScanText.Visible=!1,e.ClassName="SearchDocumentViewModel",e}return _createClass(a,[{key:"selectRecords",value:function(e){var t=this;this.tree[0].Rows.forEach((function(a){t.tree[0].SelectNode_1(a,e)})),this.tree[0].RefreshSelectionText(),this.tree[0].treecomp.gridObj.invalidate()}},{key:"GetSeqNosList",value:function(){if(null==this.SelectedNodes)return"";var e="";return this.SelectedNodes.forEach((function(t){e+=t.Id+","})),e.length>0?e=e.Remove(e.length-1,1):e+="0",e}},{key:"SearchDocumentViewModel_3",value:function(e,t){this.JVParent=e,this.ButtonSearch.Enable=!0,this.tree=[];var a=new o.a;this.Where="  a.StatusID =(Select StatusID from Com_status with(nolock) where status='Active' and costcenterid="+t+")";for(var n=new Array,s=0;s<e.JVGrid.Table.length;s++)if(!i.e.IsEmpty(e.JVGrid.Table[s].DimID_Key)){var r=new u.a;r.Id=parseInt(e.JVGrid.Table[s].DimID_Key.toString()),n.push(r)}a.TreeViewModel_7(t,this,this.Where,n),a.HeaderVisiblity=!1,a.ViewsVisible=!1,this.tree.push(a)}},{key:"SearchDocumentViewModel_1",value:function(e,t,a,i,s,r,l,c,d,u){this.Parent=e,this.ButtonSearch.Enable=!0,this.docdate=i,this.duedate=s,this.Loc=r,this.div=l,this.Where=c,this.selectedDocs=d,this.LinkDefID=t,this.PendingList=u,this.tree=[];var h=new o.a;e.ScreenObject.Preferences.ContainsKey("jobCCID")&&""!=e.ScreenObject.Preferences.jobCCID.toString()&&parseInt(e.ScreenObject.Preferences.jobCCID.toString())>5e4&&"158"==a?(c="  a.Isgroup=0 and a.StatusID =(Select StatusID from Com_status with(nolock) where status='Active' and costcenterid="+e.ScreenObject.Preferences.jobCCID.toString()+")",h.TreeViewModel(parseInt(e.ScreenObject.Preferences.jobCCID.toString()),this,0,c,i,s,r,l,t,d)):h.TreeViewModel(parseInt(a),this,this.PendingList&&parseInt(this.Parent.ScreenObject.Data.Tables[6].filter((function(e){return e.CostCenterIDLinked==a}))[0].ViewID.toString())>0?parseInt(this.Parent.ScreenObject.Data.Tables[6].filter((function(e){return e.CostCenterIDLinked==a}))[0].ViewID.toString()):278,c,i,s,r,l,t,d),h.HeaderVisiblity=!1,h.ViewsVisible=!1,this.tree.push(h),this.Title=n.a.GetResource("Search"),e.ScreenObject.Preferences.ContainsKey("PendingListScan")&&"True"==e.ScreenObject.Preferences.PendingListScan.toString()&&(this.ScanText.Visible=!0,this.ScanText.SetFocus=!0,this.ScanText.TextChangedCommand.Subscribe(this,"onScanKeyDown"))}},{key:"onScanKeyDown",value:function(e,t){if("13"==t.keyCode){for(var a=0;a<this.tree[0].AllNodes.length;a++)if(this.tree[0].AllNodes[a].Text[0].toLowerCase()==this.ScanText.Text.toLowerCase()){this.tree[0].SelectSearchNode(this.tree[0].AllNodes[a]),this.tree[0].SelectNode_1(this.tree[0].AllNodes[a],!0),i.e.PlaySound("beep-02.wav"),this.ScanText.Text="";break}""!=this.ScanText.Text&&i.e.PlaySound("beep-01.wav")}}},{key:"Refresh",value:function(){null!=this.tree&&this.tree.length>0&&(this.tree[0].RefreshData=!0)}},{key:"OnSearch",value:function(e){if("OK"==e.toString())this.SelectDcument();else if("Cancel"==e.toString())null!=this.Parent&&(this.Parent.DialogResult=!1),n.a.page.HideDialog();else if("SearchProd"==e.toString()){this.ButtonSearch.Enable=!1,this.tree.Clear();var t=new o.a;t.TreeViewModel(40011,this,280,this.Where,this.docdate,this.duedate,this.Loc,this.div,this.LinkDefID,this.selectedDocs),t.HeaderVisiblity=!1,t.ViewsVisible=!1,this.tree.push(t)}}},{key:"FillBoms",value:function(){var e="";if(null!=this.SelectedNodes&&this.SelectedNodes.length>1)for(var t=0;t<this.SelectedNodes.length;t++)""!=e&&(e+=","),e+=this.SelectedNodes[t].Id}},{key:"CommandController",value:function(e){this.SelectDcument()}},{key:"Addrows",value:function(){var e=this;if(null!=this.SelectedNodes&&this.SelectedNodes.length>1)for(var t=function(t){if(!e.SelectedNodes[t].IsGroup&&0==e.JVParent.JVGrid.Table.filter((function(a){return a.DimID_Key==e.SelectedNodes[t].Id})).length){var a=e.JVParent.parent.GetEmptyRowPosition(e.JVParent.JVGrid,"DimID_Key");e.JVParent.JVGrid.Table[a].DimID=e.SelectedNodes[t].Text[1],e.JVParent.JVGrid.Table[a].DimID_Key=e.SelectedNodes[t].Id,e.JVParent.JVGrid.updateRow(e.JVParent.JVGrid.Table[a])}},a=0;a<this.SelectedNodes.length;a++)t(a);else if(null!=this.SelectedNode&&!this.SelectedNode.IsGroup&&0==this.JVParent.JVGrid.Table.filter((function(t){return t.DimID_Key==e.SelectedNode.Id})).length){var n=this.JVParent.parent.GetEmptyRowPosition(this.JVParent.JVGrid,"DimID_Key");this.JVParent.JVGrid.Table[n].DimID=this.SelectedNode.Text[1],this.JVParent.JVGrid.Table[n].DimID_Key=this.SelectedNode.Id,this.JVParent.JVGrid.updateRow(this.JVParent.JVGrid.Table[n])}}},{key:"SelectDcument",value:function(){var e=this;if(n.a.page.HideDialog(),null==this.JVParent)if(null==this.MOParent){if(null!=this.SelectedNodes&&this.SelectedNodes.length>1&&this.Parent.ScreenObject.Preferences.ContainsKey("Selective")&&Object(s.j)(this.Parent.ScreenObject.Preferences.Selective)){for(var t="",a=0;a<this.SelectedNodes.length;a++)for(var i=function(n){parseInt(e.Parent.ScreenObject.Link.DocumentList.Items[n].Value)==e.SelectedNodes[a].Id&&(e.Parent.ScreenObject.Link.DocumentList.Items[n].IsChecked&&e.Parent.ScreenObject.GridData.filter((function(t){return t.RefNo==e.Parent.ScreenObject.Link.DocumentList.Items[n].Name})).length>0||(e.Parent.IsSelectAll=!0,e.Parent.ScreenObject.Link.DocumentList.Items[n].IsChecked=!0,t+=e.Parent.ScreenObject.Link.DocumentList.Items[n].Name,a+1<e.SelectedNodes.length&&(t+="','")),e.Parent.IsSelectAll=!1)},r=0;r<this.Parent.ScreenObject.Link.DocumentList.Items.length;r++)i(r);n.a.page.ShowDialog(new c.a(this.Parent,t,parseInt(this.Parent.ScreenObject.Link.LinkCombo.SelectedValue),0,!1),d.a)}else if(null!=this.SelectedNodes&&this.SelectedNodes.length>0)this.SelectedNodes.forEach((function(t){for(var a=0;a<e.Parent.ScreenObject.Link.DocumentList.Items.length;a++)parseInt(e.Parent.ScreenObject.Link.DocumentList.Items[a].Value)==t.Id&&(e.Parent.ScreenObject.Link.DocumentList.Items[a].IsChecked||(e.Parent.IsSelectAll=!0,e.Parent.ScreenObject.Link.DocumentList.Items[a].IsChecked=!0),e.Parent.IsSelectAll=!1,e.Parent.OnLinkDocumentCheckedChanged(e.Parent.ScreenObject.Link.DocumentList.Items[a]))}));else if(null!=this.SelectedNode)for(var o=0;o<this.Parent.ScreenObject.Link.DocumentList.Items.length;o++)parseInt(this.Parent.ScreenObject.Link.DocumentList.Items[o].Value)==this.SelectedNode.Id&&(this.Parent.ScreenObject.Link.DocumentList.Items[o].IsChecked||(this.Parent.IsSelectAll=!0,this.Parent.ScreenObject.Link.DocumentList.Items[o].IsChecked=!0),this.Parent.IsSelectAll=!1,this.Parent.OnLinkDocumentCheckedChanged(this.Parent.ScreenObject.Link.DocumentList.Items[o]));this.Parent.DialogResult=!0}else this.FillBoms();else this.Addrows()}},{key:"SelectAll",get:function(){return this._SelectAll},set:function(e){e!=this._SelectAll&&(this._SelectAll=e,this.selectRecords(e))}}]),a}(r.b)},"Ls/t":function(e,t,a){"use strict";a.d(t,"a",(function(){return y}));var n=a("Do2H"),i=a("Lp6j"),s=a("eQJW"),r=a("ScVY"),o=a("EQd/"),l=a("VxiT"),c=a("4HhE"),d=a("ockk"),u=a("n56n"),h=a("JIg3"),D=a("8B8H"),m=a("6l4u"),b=a("Dc+n"),S=a("0/4Q"),C=a("jgdN"),y=function(e){_inherits(a,e);var t=_createSuper(a);function a(e){var n;return _classCallCheck(this,a),(n=t.call(this)).DocId=0,n.DocDetailsId=0,n.HoldRelease=!1,n.ConsolidatedBatches=!1,n.AutoGenerateBatches=!1,n.IsBatchSeqNoExists=!1,n.OnlyMonthYear=!1,n.ProdName="",n.BatchQty=0,n.ShelfLife=0,n.UomConversion=1,n.VarFldName="",n.StaticFields=null,n._SortBatchGrid=!1,n._ChkFifo=!1,n.Width=500,n.BatchScanning=new o.d(0),n._ChkFifoAll=!1,n.FifoVisibility=!1,n.FifoAllVisibility=!1,n.ProdVisibility=!1,n.IsQuickAdd=!1,n.Div=0,n.Loc=0,n.NextSeq=0,n.Seqlen=0,n.InvQty=0,n.Tot=0,n.drSelObj=null,n.xBatchDef=null,n.BNO="",n.dsBatch=null,n.ControlGen=null,n.VoucherType=0,n.ExpanderVisibility=!1,n.SaveVisibility=!0,n.SaveAsVisibility=!0,n.SaveAddVisibility=!0,n.SaveAddMultipleVisibility=!0,n.AddBatchExp="",n.BatchNumber=new o.d(0),n.BatchNo=new o.d(0),n.Isexp=!1,n.BatchCode=new o.a(27184),n.BatMRate=new o.d(0),n.BatRRate=new o.d(0),n.BatSRate=new o.d(0),n.FromDate=null,n.RetestDate=null,n.ExpDate=null,n.SerialNumber=new o.d(0),n.Qty=new o.d(0),n.SearchVisibility=!1,n.AddVisiblility=!1,n.GridDataObj=new D.a,n.dtmap=null,n.count=0,n.objBatch={BatchID:0,IsGroup:!1,CodePrefix:null,CodeNumber:0},n.ClassName="BatchNumberViewModel",n.GridDataObj.Columns=[],n.drSelObj=e,n}return _createClass(a,[{key:"BatchNumberViewModel_1",value:function(e){this.IsQuickAdd=e,this.VoucherType=1,this.docdate=Date.Today(),this.LoadFields()}},{key:"BatchNumberViewModel_2",value:function(e,t,a,n,i,s,r){this.Div=r,this.Loc=s,this.BillNO=i,this.docdate=n,this.VoucherType=t,this.Parent=e,this.batches=a,this.ProdVisibility=!0,this.SelectedProd=a[0].ProductID.toString(),this.LoadFields()}},{key:"BatchNumberViewModel_3",value:function(e,t,a,s,r,o,l,c){var d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;if(this.Parent=e,this.drSel=c,this.drSelTable=null!=d&&d.length>0?d:e.ScreenObject.GridData,this.Div=l,this.Loc=o,this.ProductID=s,this.ProdName=r,this.BatchQty=a,n.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=n.a.SessionManager.Preferences.DecimalsinQty){var u=this.BatchQty.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty);this.BatchQty=parseFloat(u)}this.VoucherType=t,this.QtyAddMessage=i.e.Format(n.a.GetResource("BatchNo_AddMessage"),(0).ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty),this.BatchQty.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty),this.ProdName.toString()),this.LoadFields()}},{key:"BatchNumberViewModel_4",value:function(e,t,a,s,r,o,l,c,d){var u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,h=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null;if(this.VarFldName=d,this.Div=c,null!=u?this.drSel=u:"AddEditDocumentViewModel"==e.ClassName&&null!=e.SelectedRow&&(this.drSel=e.SelectedRow),this.drSelTable=null!=h&&h.length>0?h:e.ScreenObject.GridData,this.dsBatch=s,this.Loc=l,this.ProductID=r,this.ProdName=o,this.BatchQty=a,n.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=n.a.SessionManager.Preferences.DecimalsinQty){var D=this.BatchQty.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty);this.BatchQty=parseFloat(D)}this.VoucherType=t,this.Parent=e,this.QtyAddMessage=i.e.Format(n.a.GetResource("BatchNo_AddMessage"),(0).ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty),this.BatchQty.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty),this.ProdName.toString()),this.LoadFields()}},{key:"LoadStaticFields",value:function(){var e=this;if(this.StaticFields=[],null!=this.dsBatch&&this.dsBatch.Tables.length>5){if(this.ControlGen=new l.a,this.ControlGen.Data=this.dsBatch,this.dsBatch.Tables[5].forEach((function(t){e.ControlGen.GenerateFields(t,e.StaticFields)})),this.ControlGen.StaticFields=this.StaticFields,this.ControlGen.CostCenterID=16,this.dsBatch.Tables.length>7&&this.dsBatch.Columns[7].Contains("CostCenterColID"))for(var t=function(t){var a=e.StaticFields.find((function(a){return a.DBColumnID==parseInt(e.dsBatch.Tables[7][t].CostCenterColID.toString())}));null!=a&&(1!=parseInt(e.dsBatch.Tables[7][t].Hide.toString())&&2!=parseInt(e.dsBatch.Tables[7][t].Hide.toString())||(a.Visible=!1),1!=parseInt(e.dsBatch.Tables[7][t].Mandatory.toString())&&2!=parseInt(e.dsBatch.Tables[7][t].Mandatory.toString())||(a.Mandatory=!0))},a=0;a<this.dsBatch.Tables[7].length;a++)t(a);if(this.dsBatch.Tables.length>6&&this.dsBatch.Columns[6].Contains("IsParentCodeInherited")&&this.dsBatch.Tables[6].length>0&&this.ControlGen.InitAutoCode(this.dsBatch.Tables[6],this.objBatch.IsGroup),this.StaticFields.forEach((function(t){t instanceof o.a?e.BatchCode=t:"MfgDate"==t.DBColumnName&&t instanceof h.c?t.SelectedDateChanged.Subscribe(e,"OnDateChanged"):t instanceof o.d&&"BatchNumber"==t.DBColumnName&&(e.BatchNo=t),t instanceof h.c&&("MfgDate"==t.DBColumnName?e.FromDate=t:"ExpiryDate"==t.DBColumnName?e.ExpDate=t:"RetestDate"==t.DBColumnName&&(e.RetestDate=t),e.OnlyMonthYear&&(t.CustomFormat="MMM/yyyy"))})),this.ControlGen.IsAutoCode&&(this.objBatch.BatchGroup=1,this.ControlGen.SetAutoCode(this.BatchCode,this.objBatch.IsGroup,this.objBatch.BatchGroup,this.dsBatch.Tables[6])),("AddEditDocumentViewModel"==this.Parent.ClassName||"POSDocumentViewModel"==this.Parent.ClassName)&&this.Parent.ScreenObject.Preferences.ContainsKey("AutoBatchNo")&&"true"==this.Parent.ScreenObject.Preferences.AutoBatchNo.toLowerCase()&&null!=this.BatchNo){for(var n=this.NextSeq.toString();n.length<this.Seqlen;)n="0"+n;this.BatchNo.Text=this.BNO.replace("#SEQ#",n),this.BatchNo.Enable=!1,this.Isexp=!0,this.txtqty=new o.d(0),this.txtqty.Label="Qty",this.txtqty.DBColumnName="QTY",this.txtqty.Mandatory=!0,this.txtqty.DataType="FLOAT",this.StaticFields.push(this.txtqty),this.txtqty.Text=this.Parent.ScreenObject.Preferences.ContainsKey("AutoPopulateBatchQty")&&"true"==this.Parent.ScreenObject.Preferences.AutoPopulateBatchQty.toLowerCase()?this.BatchQty.toString():""}for(var i=0,s=0,r=0;r<this.StaticFields.length;r++)this.StaticFields[r].Row=i,this.StaticFields[r].Column=s,1==s?(i+=1,s=0):s+=1}}},{key:"OnDateChanged",value:function(e){if(e instanceof h.c&&e.Date&&this.ShelfLife>0){var t=this.StaticFields.find((function(e){return"ExpiryDate"==e.DBColumnName}));if(null!=t&&t instanceof h.c)if(this.OnlyMonthYear){var a=e.Date.AddDays(this.ShelfLife);a.getDate()!=a.DaysInMonth()&&(a=new Date(a.getFullYear(),a.getMonth(),a.DaysInMonth())),t.Date=a}else t.Date=e.Date.AddDays(this.ShelfLife)}}},{key:"LoadFields",value:function(){var e=this;this.BatchScanning.Visible=!("AddEditDocumentViewModel"!=this.Parent.ClassName&&"POSDocumentViewModel"!=this.Parent.ClassName||-1!=this.VoucherType||!this.Parent.ScreenObject.Preferences.ContainsKey("ScanBatches")||""==this.Parent.ScreenObject.Preferences.ScanBatches.toString()||!Object(s.j)(this.Parent.ScreenObject.Preferences.ScanBatches)),this.BatchScanning.Width="200",this.BatchScanning.Label="Scan Batch",this.BatchScanning.TextChangedCommand.Subscribe(this,"OnKeyDown"),this.BatchScanning.DBColumnName="SKU",this.BatchScanning.Visible&&(this.BatchScanning.SetFocus=!0);var t,a=0;if("AddEditDocumentViewModel"==this.Parent.ClassName||"POSDocumentViewModel"==this.Parent.ClassName?(null!=this.drSel&&(i.e.IsEmpty(this.drSel.DocDetailsID)||(this.DocDetailsId=parseInt(this.drSel.DocDetailsID)),0==this.DocDetailsId&&(6==this.Parent.ScreenObject.DocumentType||39==this.Parent.ScreenObject.DocumentType)&&i.e.Int(this.drSel.LinkedInvDocDetailsID)>0&&(this.DocDetailsId=parseInt(this.drSel.LinkedInvDocDetailsID)),i.e.IsEmpty(this.drSel.UOMConversion)||(this.UomConversion=parseFloat(this.drSel.UOMConversion))),this.DocId=this.Parent.ScreenObject.DocID,this.docdate=this.Parent.DocumentDate,a=this.Parent.CostCenterID):"LinkDocument"==this.Parent.ClassName&&(this.DocId=this.Parent.Parent.ScreenObject.DocID,this.docdate=this.Parent.Parent.DocumentDate,a=this.Parent.Parent.CostCenterID),null==this.dsBatch){var r=-1,o=-1,l=0,c=!1;if(("AddEditDocumentViewModel"==this.Parent.ClassName||"POSDocumentViewModel"==this.Parent.ClassName)&&n.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise Batches")&&""!=n.a.SessionManager.Preferences["Maintain Dimensionwise Batches"].toString()&&(l=i.e.Int(n.a.SessionManager.Preferences["Maintain Dimensionwise Batches"]))>0){for(var h=0;h<this.Parent.ScreenObject._CCFields.length;h++){var D=this.Parent.ScreenObject._CCFields[h];if(D instanceof u.b&&D.CCID==l){r=D.SelectedValue,c=!0;break}}c||null!=this.drSel&&l>5e4&&this.drSelObj.TableColumns.Contains("dcCCNID"+(l-5e4).toString()+"_Key")&&!i.e.IsEmpty(this.drSel["dcCCNID"+(l-5e4).toString()+"_Key"])&&(r=parseInt(this.drSel["dcCCNID"+(l-5e4).toString()+"_Key"]))}if(("AddEditDocumentViewModel"==this.Parent.ClassName||"POSDocumentViewModel"==this.Parent.ClassName)&&this.Parent.ScreenObject.Preferences.ContainsKey("BatchFilterDim")&&(c=!1,(l=i.e.Int(this.Parent.ScreenObject.Preferences.BatchFilterDim))>0)){for(var m=0;m<this.Parent.ScreenObject._CCFields.length;m++){var b=this.Parent.ScreenObject._CCFields[m];if(b instanceof u.b&&b.CCID==l){o=b.SelectedValue>0?b.SelectedValue:1,c=!0;break}}c||null!=this.drSel&&l>5e4&&this.drSelObj.TableColumns.Contains("dcCCNID"+(l-5e4).toString()+"_Key")&&(c=!0,o=i.e.IsEmpty(this.drSel["dcCCNID"+(l-5e4).toString()+"_Key"])?1:parseInt(this.drSel["dcCCNID"+(l-5e4).toString()+"_Key"]))}if(this.dsBatch=(new p).GetProductwiseBatches(this.ProductID,this.DocDetailsId,this.DocId,this.VoucherType,this.docdate,this.Div,this.Loc,a,r,o),this.dsBatch.Tables.length>1&&this.dsBatch.Tables[1].length>0&&this.dsBatch.Columns[1].Contains("ErrorMessage"))return void("AddEditDocumentViewModel"!=this.Parent.ClassName&&"POSDocumentViewModel"!=this.Parent.ClassName||(this.Parent.DisplayMessage=this.dsBatch.Tables[1][0].ErrorMessage.toString()));if(this.dsBatch.Tables[0].length>0&&this.dsBatch.Columns[0].Contains("ErrorMessage"))return void("AddEditDocumentViewModel"!=this.Parent.ClassName&&"POSDocumentViewModel"!=this.Parent.ClassName||(this.Parent.DisplayMessage=n.a.GetResource("Batch_PrdNoBtch").toString()))}if(this.dsBatch.Tables.length>2&&this.dsBatch.Columns[2].Contains("Name")){var S=this.dsBatch.Tables[2].filter((function(e){return"HoldandReleaseQTY"==e.Name}));S.length>0&&(this.HoldRelease=Object(s.j)(S[0].Value)),(S=this.dsBatch.Tables[2].filter((function(e){return"ConsolidatedBatches"==e.Name}))).length>0&&(this.ConsolidatedBatches=Object(s.j)(S[0].Value)),(S=this.dsBatch.Tables[2].filter((function(e){return"AutoGenerateBatches"==e.Name}))).length>0&&(this.AutoGenerateBatches=Object(s.j)(S[0].Value)),(S=this.dsBatch.Tables[2].filter((function(e){return"OnlyMonthYear"==e.Name}))).length>0&&(this.OnlyMonthYear=Object(s.j)(S[0].Value)),(S=this.dsBatch.Tables[2].filter((function(e){return"SortBatchGrid"==e.Name}))).length>0&&(this.SortBatchGrid=Object(s.j)(S[0].Value))}if(this.dsBatch.Tables.length>2&&this.dsBatch.Columns[2].Contains("ShelfLife")&&this.dsBatch.Tables[2].length>0&&!i.e.IsEmpty(this.dsBatch.Tables[2][0].ShelfLife)&&(this.ShelfLife=parseFloat(this.dsBatch.Tables[2][0].ShelfLife.toString())),1==this.VoucherType&&this.LoadStaticFields(),this.dsBatch.Tables.length>6&&this.dsBatch.Tables[6].length>0){var C=this.dsBatch.Tables[6].filter((function(e){return 1==e.IsName}));if(C.length>0){if(!i.e.IsEmpty(C[0].PrefixContent))try{this.GetBatchNo(C[0].PrefixContent.toString())}catch(x){Logger.ErrorLog("error reading PrefixContent xml")}this.dsBatch.Tables[6].Remove(C[0])}}this.dtmap=[],this.dtmapColumns=[],this.dtmapColumns.push("BaseCol"),this.dtmapColumns.push("BatchCol"),this.GridDataColumns.push("Sno"),this.GridDataColumns.push("BatchCode"),this.GridDataColumns.push("BATCHNUMBER"),this.GridDataColumns.push("RefInvID");for(var y=0;y<this.dsBatch.Tables[4].length;y++)this.GridDataColumns.Contains(this.dsBatch.Tables[4][y].Name.toString())||("SRate"==this.dsBatch.Tables[4][y].Name.toString()||"MRate"==this.dsBatch.Tables[4][y].Name.toString()||"RRate"==this.dsBatch.Tables[4][y].Name.toString()||"Release"==this.dsBatch.Tables[4][y].Name.toString()||"Hold"==this.dsBatch.Tables[4][y].Name.toString()||"BalQty"==this.dsBatch.Tables[4][y].Name.toString()||"QtyUom"==this.dsBatch.Tables[4][y].Name.toString()||"Quantity"==this.dsBatch.Tables[4][y].Name.toString()?this.GridDataColumns.push(this.dsBatch.Tables[4][y].Name):this.dsBatch.Tables[4][y].Name.toString().toLowerCase().Contains("ccnid")?(this.GridDataColumns.push(this.dsBatch.Tables[4][y].Name),this.GridDataColumns.push(this.dsBatch.Tables[4][y].Name.toString()+"_Key")):this.GridDataColumns.push(this.dsBatch.Tables[4][y].Name));if(this.GridDataColumns.Contains("BalQty")||this.GridDataColumns.push("BalQty"),this.GridDataColumns.Contains("ExpDate")||this.GridDataColumns.push("ExpDate"),this.GridDataColumns.Contains("MfgDate")||this.GridDataColumns.push("MfgDate"),this.GridDataColumns.Contains("Quantity")||this.GridDataColumns.push("Quantity"),this.GridDataColumns.Contains("SRate")||this.GridDataColumns.push("SRate"),this.GridDataColumns.Contains("MRate")||this.GridDataColumns.push("MRate"),this.GridDataColumns.Contains("RRate")||this.GridDataColumns.push("RRate"),this.GridDataColumns.Contains("Hold")||this.GridDataColumns.push("Hold"),this.GridDataColumns.Contains("Release")||this.GridDataColumns.push("Release"),"AddEditDocumentViewModel"==this.Parent.ClassName&&this.Parent.ScreenObject.Preferences.ContainsKey("ConsBatch")&&"True"==this.Parent.ScreenObject.Preferences.ConsBatch&&(this.GridDataColumns.push("DetID"),this.GridDataColumns.push("LinkedID")),this.FifoVisibility=-1==this.VoucherType&&!this.BatchScanning.Visible,this.FifoAllVisibility="IWODetailsViewModel"==this.Parent.ClassName,this.BatMRate.DataType="FLOAT",this.BatRRate.DataType="FLOAT",this.BatSRate.DataType="FLOAT",this.BatchNo.Mandatory=!0,this.Qty.DataType="FLOAT",this.GridDataObj.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.GridDataObj.BeginEdit.Subscribe(this,"OnBeginEdit"),this.Qty.Visible=!0,this.AddVisiblility=!0,this.SearchVisibility=!1,this.Title=n.a.GetResource("BatchlNo_Title"),this.IsQuickAdd?(this.Title="Add Batch",this.ExpanderVisibility=!0,this.Isexp=!0,this.SaveVisibility=!1,this.SaveAsVisibility=!1,this.SaveAddVisibility=!1):1!=this.VoucherType||!("AddEditDocumentViewModel"!=this.Parent.ClassName&&"POSDocumentViewModel"!=this.Parent.ClassName||6!=this.Parent.ScreenObject.DocumentType&&39!=this.Parent.ScreenObject.DocumentType)&&i.e.Int(this.drSel.LinkedInvDocDetailsID)>0?this.ExpanderVisibility=!1:(this.ExpanderVisibility=!0,this.SaveVisibility=n.a.SessionManager.IsActionAssigned(43,"EnableBatchSave"),this.SaveAsVisibility=n.a.SessionManager.IsActionAssigned(43,"EnableBatchSaveAs"),this.SaveAddVisibility=n.a.SessionManager.IsActionAssigned(43,"EnableBatchSaveAdd")),this.SaveAddMultipleVisibility=!(!this.SaveAddVisibility||!this.GridDataColumns.Contains("DetID")),this.dtmap.Clear(),this.dsBatch.Tables.length>3)for(var g=0;g<this.dsBatch.Tables[3].length;g++){var f={};f.BatchCol=this.dsBatch.Tables[3][g].BatchCol.toString(),f.BaseCol=this.dsBatch.Tables[3][g].BaseCol.toString(),this.dtmap.push(f),this.GridDataColumns.Contains(this.dsBatch.Tables[3][g].BatchCol.toString())||(this.GridDataColumns.push(this.dsBatch.Tables[3][g].BatchCol.toString()),this.dsBatch.Tables[3][g].BatchCol.toString().toLowerCase().Contains("ccnid")&&this.GridDataColumns.push(this.dsBatch.Tables[3][g].BatchCol.toString()+"_Key"))}if((t=new d.a).Header="#",t.DisplayMember="Sno",t.DataType="TextBlock",t.ReadOnly=!0,t.Width=50,t.DisableTab=!0,this.ColumnSource.push(t),n.a.SessionManager.IsActionAssigned(43,"EditBatchDetails")&&((t=new d.a).Header="Edit",t.DisplayMember="Edit",t.ReadOnly=!0,t.DataType="LINK",t.DisableTab=!0,t.Click.Subscribe(this,"onEditClick"),t.Width=100,this.ColumnSource.push(t),this.GridDataColumns.push("Edit")),null!=this.drSel&&"True"==this.drSel.BinWise.toString()){var I=0,T=0,P=!1;if(n.a.SessionManager.Preferences.ContainsKey("DimensionwiseBins")&&""!=n.a.SessionManager.Preferences.DimensionwiseBins.toString()&&(T=i.e.Int(n.a.SessionManager.Preferences.DimensionwiseBins))>0){I=1;for(var O=0;O<this.Parent.ScreenObject._CCFields.length;O++){var B=this.Parent.ScreenObject._CCFields[O];if(B instanceof u.b&&B.CCID==T){B.SelectedValue>0&&(I=B.SelectedValue),P=!0;break}}P||null!=this.SelectedRow&&T>5e4&&this.drSelObj.TableColumns.Contains("dcCCNID"+(T-5e4).toString()+"_Key")&&i.e.Int(this.drSel["dcCCNID"+(T-5e4).toString()+"_Key"])>0&&(I=parseInt(this.drSel["dcCCNID"+(T-5e4).toString()+"_Key"]))}if(T>5e4&&!this.Parent.ScreenObject.IsBinWise(T,I)){if(5==this.Parent.ScreenObject.DocumentType&&T>0){I=1;for(var G=function(t){var a=e.Parent.ScreenObject._CCFields[t];if(a instanceof u.b&&a.CCID==T)return a.DBColumnName.Contains("TO")?a.SelectedValue>0&&(I=a.SelectedValue):(v=e.Parent.ScreenObject._CCFields.find((function(e){return e.DBColumnName=="TO"+a.DBColumnName})))?v.SelectedValue>0&&(I=v.SelectedValue):a.SelectedValue>0&&(I=a.SelectedValue),P=!0,"break"},N=0;N<this.Parent.ScreenObject._CCFields.length;N++){var v;if("break"===G(N))break}P||null!=this.SelectedRow&&T>5e4&&this.drSelObj.TableColumns.Contains("dcCCNID"+(T-5e4).toString()+"_Key")&&(this.drSelObj.TableColumns.Contains("TOdcCCNID"+(T-5e4).toString()+"_Key")?i.e.Int(this.drSel["TOdcCCNID"+(T-5e4).toString()+"_Key"])>0&&(I=parseInt(this.drSel["TOdcCCNID"+(T-5e4).toString()+"_Key"])):i.e.Int(this.drSel["dcCCNID"+(T-5e4).toString()+"_Key"])>0&&(I=parseInt(this.drSel["dcCCNID"+(T-5e4).toString()+"_Key"]))),T>5e4&&!this.Parent.ScreenObject.IsBinWise(T,I)||((t=new d.a).Header="Bins",t.DisplayMember="Bins",t.ReadOnly=!0,t.DataType="LINK",t.DisableTab=!0,t.Click.Subscribe(this,"onBinCLick"),t.Width=100,this.ColumnSource.push(t),this.GridDataColumns.push("Bins"),this.GridDataColumns.push("BinsXML"),this.GridDataColumns.push("strBins"),5==this.Parent.ScreenObject.DocumentType&&this.GridDataColumns.push("TOBinsXML"))}}else(t=new d.a).Header="Bins",t.DisplayMember="Bins",t.ReadOnly=!0,t.DataType="LINK",t.DisableTab=!0,t.Click.Subscribe(this,"onBinCLick"),t.Width=100,this.ColumnSource.push(t),this.GridDataColumns.push("Bins"),this.GridDataColumns.push("BinsXML"),this.GridDataColumns.push("strBins"),5==this.Parent.ScreenObject.DocumentType&&this.GridDataColumns.push("TOBinsXML")}(t=new d.a).Header=n.a.GetResource("Batch_BatchNo"),this.dvCombo=this.dsBatch.Tables[0],this.dvComboTable=this.dsBatch.Tables[0],this.dvComboColumns=this.dsBatch.Columns[0],t.ComboData=this.dsBatch.Tables[0],t.DisplayMember="BATCHNUMBER",t.ValueMember="BatchID",t.ValueBinding="BatchID",t.DataType="ComboBox",t.Width=150,-1!=this.VoucherType&&("AddEditDocumentViewModel"!=this.Parent.ClassName&&"POSDocumentViewModel"!=this.Parent.ClassName||6!=this.Parent.ScreenObject.DocumentType&&39!=this.Parent.ScreenObject.DocumentType||i.e.IsEmpty(this.drSel.LinkedInvDocDetailsID)||!(parseInt(this.drSel.LinkedInvDocDetailsID)>0))||(t.ReadOnly=!0),this.GridDataColumns.Contains("BatchID")||this.GridDataColumns.push("BatchID"),this.ColumnSource.push(t),this.ConsolidatedBatches||-1!=this.VoucherType||((t=new d.a).Header="Voucher No",t.DisplayMember="VoucherNo",t.DataType="TextBlock",t.ReadOnly=!0,t.Width=100,t.DisableTab=!0,this.ColumnSource.push(t),this.GridDataColumns.push("VoucherNo"),(t=new d.a).Header="Doc Date",t.DisplayMember="DocDate",t.DataType="TextBlock",t.ReadOnly=!0,t.Width=100,t.DisableTab=!0,this.ColumnSource.push(t),this.GridDataColumns.push("DocDate"));var M=0;if(this.dsBatch.Tables.length>0){for(var j=0;j<this.dsBatch.Tables[4].length;j++)if("BatchNumber"!=this.dsBatch.Tables[4][j].Name.toString())(t=new d.a).Header=this.dsBatch.Tables[4][j].UserColumnName.toString(),t.DisplayMember=this.dsBatch.Tables[4][j].Name.toString(),t.DataType=this.dsBatch.Tables[4][j].UserColumnType.toString(),i.e.IsEmpty(this.dsBatch.Tables[4][j].ColumnWidth)||(t.Width=parseInt(this.dsBatch.Tables[4][j].ColumnWidth)),t.ReadOnly=!0,"Hold"!=t.DisplayMember.toString()&&"Release"!=t.DisplayMember.toString()||(t.IsVisible=1==this.VoucherType&&this.HoldRelease),"BalQty"==t.DisplayMember.toString()&&-1==this.VoucherType?t.IsVisible=!0:"BalQty"==t.DisplayMember.toString()&&1==this.VoucherType&&(t.IsVisible=!1),"Quantity"==t.DisplayMember.toString()||"QOH"==t.DisplayMember.toString()||"Release"==t.DisplayMember.toString()||"Hold"==t.DisplayMember.toString()||"BalQty"==t.DisplayMember.toString()||"QtyUom"==t.DisplayMember.toString()?(n.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=n.a.SessionManager.Preferences.DecimalsinQty&&(t.DecimalPoints=n.a.SessionManager.Preferences.DecimalsinQty),"BalQty"==t.DisplayMember.toString()||this.BatchScanning.Visible||(t.ReadOnly=!1),t.DataType="FLOAT","QtyUom"==t.DisplayMember.toString()&&(t.ReadOnly=!1)):!this.OnlyMonthYear||"ExpDate"!=t.DisplayMember&&"MfgDate"!=t.DisplayMember||(t.FixedDateFormat="MMM/yyyy"),this.ColumnSource.push(t);else{var V=this.ColumnSource.find((function(e){return null!=e.ValueBinding&&"BatchID"==e.ValueBinding}));V&&(V.Header=this.dsBatch.Tables[4][j].UserColumnName.toString(),i.e.IsEmpty(this.dsBatch.Tables[4][j].ColumnWidth)||(V.Width=parseInt(this.dsBatch.Tables[4][j].ColumnWidth)))}if(-1==this.VoucherType)for(var A=0;A<this.dsBatch.Tables[0].length;A++){var R=this.GridDataObj.NewRow();R.Sno=A+1,this.GridDataColumns.Contains("Edit")&&(R.Edit="Edit"),this.GridDataColumns.Contains("Bins")&&(R.Bins="Bins"),this.ConsolidatedBatches||(R.RefInvID=this.dsBatch.Tables[0][A].InvDocDetailsID.toString(),this.dsBatch.Columns[0].Contains("VoucherNo")&&(R.VoucherNo=this.dsBatch.Tables[0][A].VoucherNo.toString()),this.dsBatch.Columns[0].Contains("DocDate")&&!i.e.IsEmpty(this.dsBatch.Tables[0][A].DocDate)&&(R.DocDate=new Date(this.dsBatch.Tables[0][A].DocDate).ToString(n.a.SessionManager.Preferences["Date Format"]))),R.BatchID=this.dsBatch.Tables[0][A].BatchID.toString(),this.dsBatch.Columns[0].Contains("BatchCode")&&(R.BatchCode=this.dsBatch.Tables[0][A].BatchCode.toString()),this.dsBatch.Columns[0].Contains("BATCHNUMBER")&&(R.BATCHNUMBER=this.dsBatch.Tables[0][A].BATCHNUMBER.toString()),i.e.isValidDate(this.dsBatch.Tables[0][A].MfgDate)&&(R.MfgDate=this.OnlyMonthYear?new Date(this.dsBatch.Tables[0][A].MfgDate).ToString("MMM/yyyy"):new Date(this.dsBatch.Tables[0][A].MfgDate).ToString(n.a.SessionManager.Preferences["Date Format"])),i.e.isValidDate(this.dsBatch.Tables[0][A].ExpiryDate)&&(R.ExpDate=this.OnlyMonthYear?new Date(this.dsBatch.Tables[0][A].ExpiryDate).ToString("MMM/yyyy"):new Date(this.dsBatch.Tables[0][A].ExpiryDate).ToString(n.a.SessionManager.Preferences["Date Format"])),this.GridDataColumns.Contains("BalQty")&&(R.BalQty=this.dsBatch.Columns[0].Contains("BalQty")&&i.e.IsNum(this.dsBatch.Tables[0][A].BalQty)?parseFloat(this.dsBatch.Tables[0][A].BalQty).ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty):0),this.dsBatch.Columns[0].Contains("BillNo")&&this.GridDataColumns.Contains("BillNo")&&(R.BillNo=this.dsBatch.Tables[0][A].BillNo.toString()),this.dsBatch.Columns[0].Contains("BillDate")&&this.GridDataColumns.Contains("BillDate")&&i.e.isValidDate(this.dsBatch.Tables[0][A].BillDate)&&(R.BillDate=new Date(this.dsBatch.Tables[0][A].BillDate).ToString(n.a.SessionManager.Preferences["Date Format"])),i.e.IsNum(this.dsBatch.Tables[0][A].MRATE)&&(R.MRate=this.dsBatch.Tables[0][A].MRATE.toString()),i.e.IsNum(this.dsBatch.Tables[0][A].RRATE)&&(R.RRate=this.dsBatch.Tables[0][A].RRATE.toString()),i.e.IsNum(this.dsBatch.Tables[0][A].SRATE)&&(R.SRate=this.dsBatch.Tables[0][A].SRATE.toString());for(var w=0;w<this.dtmap.length;w++)this.dtmap[w].BatchCol.toString().toLowerCase().Contains("ccnid")&&this.dtmap[w].BaseCol.toString().toLowerCase().Contains("ccnid")&&this.GridDataColumns.Contains(this.dtmap[w].BatchCol.toString()+"_Key")&&!i.e.IsEmpty(this.dsBatch.Tables[0][A][this.dtmap[w].BatchCol.toString()])?(R[this.dtmap[w].BatchCol.toString()]=this.dsBatch.Tables[0][A][this.dtmap[w].BatchCol.toString()+"_Key"].toString(),R[this.dtmap[w].BatchCol.toString()+"_Key"]=this.dsBatch.Tables[0][A][this.dtmap[w].BatchCol.toString()].toString()):this.dsBatch.Columns[0].Contains(this.dtmap[w].BatchCol.toString())&&this.GridDataColumns.Contains(this.dtmap[w].BatchCol.toString())&&this.dsBatch.Columns[0].Contains(this.dtmap[w].BatchCol.toString())&&(R[this.dtmap[w].BatchCol.toString()]=this.dsBatch.Tables[0][A][this.dtmap[w].BatchCol.toString()].toString());if(null!=this.dsBatch.Tables[4]&&this.dsBatch.Tables[4].length>0)for(var E=0;E<this.dsBatch.Tables[4].length;E++)if(!i.e.IsEmpty(this.dsBatch.Tables[4][E].CostcenterColID)&&parseInt(this.dsBatch.Tables[4][E].CostcenterColID)<53692&&parseInt(this.dsBatch.Tables[4][E].CostcenterColID)>1572){var Q=this.dsBatch.Tables[4][E].Name.toString();this.dsBatch.Tables[4][E].Name.toString().toLowerCase().Contains("ccnid")?(this.dsBatch.Columns[0].Contains(Q+"_Key")&&(R[this.dsBatch.Tables[4][E].Name.toString()]=this.dsBatch.Tables[0][A][Q+"_Key"].toString()),this.GridDataColumns.Contains(Q+"_Key")&&(R[Q+"_Key"]=this.dsBatch.Tables[0][A][Q].toString())):""!=Q&&"retestdate"==Q.toLowerCase()&&this.dsBatch.Columns[0].Contains(Q)?i.e.isValidDate(this.dsBatch.Tables[0][A][Q])&&(R[this.dsBatch.Tables[4][E].Name.toString()]=new Date(this.dsBatch.Tables[0][A][Q]).ToString(n.a.SessionManager.Preferences["Date Format"])):""!=Q&&this.dsBatch.Columns[0].Contains(Q)&&"MfgDate"!=Q&&"ExpiryDate"!=Q&&(R[this.dsBatch.Tables[4][E].Name.toString()]=this.dsBatch.Tables[0][A][Q].toString())}else if(!i.e.IsEmpty(this.dsBatch.Tables[4][E].CostcenterColID)&&(parseInt(this.dsBatch.Tables[4][E].CostcenterColID)<1251&&parseInt(this.dsBatch.Tables[4][E].CostcenterColID)>1100||53732==parseInt(this.dsBatch.Tables[4][E].CostcenterColID))&&this.dsBatch.Columns[0].Contains(this.dsBatch.Tables[4][E].Name.toString()))R[this.dsBatch.Tables[4][E].Name.toString()]=this.dsBatch.Tables[0][A][this.dsBatch.Tables[4][E].Name.toString()].toString();else if(!i.e.IsEmpty(this.dsBatch.Tables[4][E].CostcenterColID)&&parseInt(this.dsBatch.Tables[4][E].CostcenterColID)<1311&&parseInt(this.dsBatch.Tables[4][E].CostcenterColID)>1260&&this.dsBatch.Columns[0].Contains(this.dsBatch.Tables[4][E].Name.toString())){var L=this.dsBatch.Tables[4][E].Name.toString();this.dsBatch.Columns[0].Contains(L+"_Key")&&(R[this.dsBatch.Tables[4][E].Name.toString()]=this.dsBatch.Tables[0][A][L+"_Key"].toString()),this.GridDataColumns.Contains(L+"_Key")&&(R[L+"_Key"]=this.dsBatch.Tables[0][A][L].toString())}this.GridDataObj.addRow(R)}}var F=new i.f;if("AddEditDocumentViewModel"!=this.Parent.ClassName&&"POSDocumentViewModel"!=this.Parent.ClassName||null==this.drSel||(i.e.IsEmpty(this.drSel.ExtraXML)?this.QtyAddMessage=i.e.Format(n.a.GetResource("BatchNo_AddMessage"),(0).ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty),this.BatchQty.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty),this.ProdName.toString()):function(){var t=0;F.LoadXml(e.drSel.ExtraXML);for(var a=F.SelectNodes("xml/Row"),s=function(s){var r=void 0;if(r=!1,1==e.VoucherType){for(var o=0;o<e.GridData.length;o++)if(e.GridData[o].BatchID.toString()==a[s].attributes.BatchID.value){r=!0;break}var l,c;l=0;for(var d=0;d<e.GridData.length;d++)if(e.GridData[d].BatchID.toString()==a[s].attributes.BatchID.value){l=d,r=!0;break}if(r?c=e.GridData[l]:(c=e.GridDataObj.NewRow(),e.GridDataObj.addRow(c)),e.GridDataColumns.Contains("Edit")&&(c.Edit="Edit"),e.GridDataColumns.Contains("Bins")&&(c.Bins="Bins"),e.GridDataColumns.Contains("DetID")&&null!=a[s].attributes.DocDetailsID&&""!=a[s].attributes.DocDetailsID.value&&(c.DetID=a[s].attributes.DocDetailsID.value),e.GridDataColumns.Contains("LinkedID")&&null!=a[s].attributes.LinkedID&&""!=a[s].attributes.LinkedID.value&&(c.LinkedID=a[s].attributes.LinkedID.value),c.BatchID=a[s].attributes.BatchID.value,i.e.IsNum(a[s].attributes.Quantity.value)&&(M=parseFloat(a[s].attributes.Quantity.value),c.Quantity=a[s].attributes.Quantity.value,e.GridDataColumns.Contains("QtyUom")&&(c.QtyUom=M/e.UomConversion),t+=M),1==e.VoucherType&&null!=a[s].attributes.Hold&&i.e.IsNum(a[s].attributes.Hold.value)&&e.GridDataObj.TableColumns.Contains("Hold")?c.Hold=a[s].attributes.Hold.value:e.GridDataObj.TableColumns.Contains("Hold")&&(c.Hold=0),1==e.VoucherType&&null!=a[s].attributes.Release&&i.e.IsNum(a[s].attributes.Release.value)&&e.GridDataObj.TableColumns.Contains("Release")&&(c.Release=a[s].attributes.Release.value),e.dvCombo=e.dvComboTable.filter((function(e){return e.BatchID==a[s].attributes.BatchID.value})),e.dvCombo.length>0){i.e.isValidDate(e.dvCombo[0].MfgDate)&&(c.MfgDate=e.OnlyMonthYear?new Date(e.dvCombo[0].MfgDate).ToString("MMM/yyyy"):new Date(e.dvCombo[0].MfgDate).ToString(n.a.SessionManager.Preferences["Date Format"])),i.e.isValidDate(e.dvCombo[0].ExpiryDate)&&(c.ExpDate=e.OnlyMonthYear?new Date(e.dvCombo[0].ExpiryDate).ToString("MMM/yyyy"):new Date(e.dvCombo[0].ExpiryDate).ToString(n.a.SessionManager.Preferences["Date Format"])),i.e.IsNum(e.dvCombo[0].MRATE)&&(c.MRate=e.dvCombo[0].MRATE.toString()),i.e.IsNum(e.dvCombo[0].RRATE)&&(c.RRate=e.dvCombo[0].RRATE.toString()),i.e.IsNum(e.dvCombo[0].SRATE)&&(c.SRate=e.dvCombo[0].SRATE.toString());for(var u=0;u<e.dtmap.length;u++)e.dvComboColumns.Contains(e.dtmap[u].BatchCol.toString())&&e.GridDataColumns.Contains(e.dtmap[u].BatchCol.toString())&&(c[e.dtmap[u].BatchCol.toString()]=e.dvCombo[0][e.dtmap[u].BatchCol.toString()].toString());if(null!=e.dsBatch.Tables[4]&&e.dsBatch.Tables[4].length>0)for(var h=0;h<e.dsBatch.Tables[4].length;h++)if(!i.e.IsEmpty(e.dsBatch.Tables[4][h].CostcenterColID)&&parseInt(e.dsBatch.Tables[4][h].CostcenterColID)<53692&&parseInt(e.dsBatch.Tables[4][h].CostcenterColID)>1572){var D=e.dsBatch.Tables[4][h].Name.toString();e.dsBatch.Tables[4][h].Name.toString().toLowerCase().Contains("ccnid")?(e.dvComboColumns.Contains(D+"_Key")&&(c[e.dsBatch.Tables[4][h].Name.toString()]=e.dvCombo[0][D+"_Key"].toString()),e.GridDataColumns.Contains(D+"_Key")&&(c[D+"_Key"]=e.dvCombo[0][D].toString())):""!=D&&"retestdate"==D.toLowerCase()&&e.dvComboColumns.Contains(D)?i.e.isValidDate(e.dvCombo[0][D])&&(c[e.dsBatch.Tables[4][h].Name.toString()]=new Date(e.dvCombo[0][D]).ToString(n.a.SessionManager.Preferences["Date Format"])):""!=D&&e.dvComboColumns.Contains(D)&&"MfgDate"!=D&&"ExpiryDate"!=D&&(c[e.dsBatch.Tables[4][h].Name.toString()]=e.dvCombo[0][D].toString())}}if(null!=e.drSel&&"True"==e.drSel.BinWise.toString()){if(e.GridDataColumns.Contains("BinsXML")){c.BinsXML=e.drSel.BinsXML.toString();var m=e.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&55494==e.LinkData}));m.length>0&&e.drSelObj.TableColumns.Contains(m[0].SysColumnName.toString())&&(c.strBins=e.drSel[m[0].SysColumnName.toString()].toString())}e.GridDataColumns.Contains("TOBinsXML")&&(c.TOBinsXML=e.drSel.TOBinsXML.toString())}e.dvCombo=e.dvComboTable}else{var b=e.GridData.filter((function(e){return e.BatchID==a[s].attributes.BatchID.value}));if(e.ConsolidatedBatches||null==a[s].attributes.RefInvID||i.e.IsEmpty(a[s].attributes.RefInvID.value)||(b=e.GridData.filter((function(e){return e.RefInvID==a[s].attributes.RefInvID.value}))),b.length>0){e.GridDataColumns.Contains("Edit")&&(b[0].Edit="Edit"),e.GridDataColumns.Contains("Bins")&&(b[0].Bins="Bins"),e.GridDataColumns.Contains("DetID")&&null!=a[s].attributes.DocDetailsID&&""!=a[s].attributes.DocDetailsID.value&&(b[0].DetID=a[s].attributes.DocDetailsID.value),e.GridDataColumns.Contains("LinkedID")&&null!=a[s].attributes.LinkedID&&""!=a[s].attributes.LinkedID.value&&(b[0].LinkedID=a[s].attributes.LinkedID.value),M=0;var S=i.e.Double(a[s].attributes.Quantity.value);if(t+=S,b[0].Quantity=S,e.GridDataColumns.Contains("QtyUom")&&(b[0].QtyUom=S/e.UomConversion),null!=e.drSel&&"True"==e.drSel.BinWise.toString()){if(e.GridDataColumns.Contains("BinsXML")){b[0].BinsXML=e.drSel.BinsXML.toString();var C=e.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&55494==e.LinkData}));C.length>0&&e.drSelObj.TableColumns.Contains(C[0].SysColumnName.toString())&&(b[0].strBins=e.drSel[C[0].SysColumnName.toString()].toString())}e.GridDataColumns.Contains("TOBinsXML")&&(b[0].TOBinsXML=e.drSel.TOBinsXML.toString())}}}},r=0;r<a.length;r++)s(r);e.QtyAddMessage=i.e.Format(n.a.GetResource("BatchNo_AddMessage"),t.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty),e.BatchQty.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty),e.ProdName.toString())}()),this.GridDataObj.SearchVisible=!0,this.FillEmptyRows(),this.BatchNo.Enable=!0,1==this.VoucherType){if(this.AutoGenerateBatches){this.BatchNo.Enable=!1;var _=0;("AddEditDocumentViewModel"==this.Parent.ClassName||"POSDocumentViewModel"==this.Parent.ClassName&&null!=this.Parent.SelectedRow)&&(_=this.Parent.CostCenterID);var k=(new p).GetBatchDefn(_);k.length>0&&k[0].Filter.toString().length>0&&(this.xBatchDef=new i.f,this.xBatchDef.LoadXml(k[0].Filter))}else"AddEditDocumentViewModel"==this.Parent.ClassName&&this.Parent.ScreenObject.Preferences.ContainsKey("AutoBatchNo")&&"true"==this.Parent.ScreenObject.Preferences.AutoBatchNo.toLowerCase()&&(this.BatchNo.Enable=!1);this.ResetBatchNo(0)}-1==this.VoucherType&&this.SetBalQty()}},{key:"GetBatchNo",value:function(e){var t=this;this.BNO="";var a=0;if(this.Parent.ScreenObject.Preferences.ContainsKey("AutoBatchNo")&&"true"==this.Parent.ScreenObject.Preferences.AutoBatchNo.toLowerCase()){var n=new i.f;n.LoadXml(e);for(var s=n.SelectNodes("XML/Row"),r=function(e){var n=s[e];a=null!=n.attributes.Length?i.e.Int(n.attributes.Length.value):0,null!=n.attributes.CCCID&&!i.e.IsEmpty(n.attributes.CCCID.value)&&"53730"==n.attributes.CCCID.value&&t.drSelObj.TableColumns.Contains("ProductName")?null!=n.attributes.Length&&i.e.IsNum(n.attributes.Length.value)&&-1!=a&&t.drSel.ProductName.toString().length>a?t.BNO+=t.drSel.ProductName.toString().substr(0,a):t.BNO+=t.drSel.ProductName.toString():null!=n.attributes.CCCID&&!i.e.IsEmpty(n.attributes.CCCID.value)&&"53731"==n.attributes.CCCID.value&&t.drSelObj.TableColumns.Contains("ProductCode")?null!=n.attributes.Length&&i.e.IsNum(n.attributes.Length.value)&&-1!=a&&t.drSel.ProductCode.toString().length>a?t.BNO+=t.drSel.ProductCode.toString().substr(0,a):t.BNO+=t.drSel.ProductCode.toString():null!=n.attributes.Name&&!i.e.IsEmpty(n.attributes.Name.value)&&n.attributes.Name.value.toLowerCase().Contains("ccnid")?(l=t.StaticFields.find((function(e){return e.DBColumnName.toLowerCase()==n.attributes.Name.value.toLowerCase()})),t.drSelObj.TableColumns.Contains("dc"+n.attributes.Name.value)&&!i.e.IsEmpty(t.drSel["dc"+n.attributes.Name.value])?(null!=n.attributes.Length&&i.e.IsNum(n.attributes.Length.value)&&-1!=a&&t.drSel["dc"+n.attributes.Name.value].toString().length>a?t.BNO+=t.drSel["dc"+n.attributes.Name.value].toString().substr(0,a):t.BNO+=t.drSel["dc"+n.attributes.Name.value].toString(),l&&!i.e.IsEmpty(t.drSel["dc"+n.attributes.Name.value+"_key"])&&(l.DefaultValue=t.drSel["dc"+n.attributes.Name.value+"_key"].toString(),l.SelectedValue=parseInt(t.drSel["dc"+n.attributes.Name.value+"_key"]),l.Enable=!1)):(c=t.Parent.ScreenObject._CCFields.find((function(e){return e.DBColumnName.toLowerCase()=="dc"+n.attributes.Name.value.toLowerCase()})))&&c.SelectedValue>0&&!i.e.IsEmpty(c.Text)&&(null!=n.attributes.Length&&i.e.IsNum(n.attributes.Length.value)&&-1!=a&&c.Text.length>a?t.BNO+=c.Text.substr(0,a):t.BNO+=c.Text,l&&(l.DefaultValue=c.SelectedValue.toString(),l.SelectedValue=c.SelectedValue,l.Enable=!1))):null==n.attributes.Name||i.e.IsEmpty(n.attributes.Name.value)||"SEQUENCE_NO"!=n.attributes.Name.value||(t.NextSeq=t.Parent.ScreenObject.getBatchSeq(t.BNO),t.BNO+="#SEQ#",null==n.attributes.Length||i.e.IsEmpty(n.attributes.Length.value)||(t.Seqlen=i.e.Int(n.attributes.Length.value))),null==n.attributes.Delimiter||i.e.IsEmpty(n.attributes.Delimiter.value)||(t.BNO+=n.attributes.Delimiter.value)},o=0;o<s.length;o++){var l,c;r(o)}}return this.BNO}},{key:"OnKeyDown",value:function(e,t){if(this.BatchScanning.Visible&&"13"==t.keyCode){var a=this.Parent.ScreenObject.ColumnSource.find((function(e){return null!=e.DisplayMember&&"ProductCode"==e.DisplayMember}));if(a&&a.UseBarcode){var s,r=this.BatchScanning.Text;if(""!=a.BarcodeProp){(s=new i.f).LoadXml(a.BarcodeProp);var o=s.SelectSingleNode("BarCodeBody/IsFixedBarcodeLength");if(null!=o&&"true"==o.InnerText.toLowerCase()&&(null!=(o=s.SelectSingleNode("BarCodeBody/FixedBarcodeChar"))&&""!=o.InnerText.Trim())){var l=o.InnerText[0];if(null!=(o=s.SelectSingleNode("BarCodeBody/IsFixedBarcodePrefix"))&&"true"==o.InnerText.Trim())for(var c=0;c<r.length&&r[c]==l;c++)r=r.Remove(0,1),c--;else for(var d=r.length-1;d>=0&&r[d]==l;d--)r=r.substr(0,r.length-1)}null!=(o=s.SelectSingleNode("BarCodeBody/IncludeChecksum"))&&"true"==o.InnerText.toLowerCase()&&(r=r.substr(0,r.length-1))}if(""!=a.BarcodeDef){var u="";(s=new i.f).LoadXml(a.BarcodeDef);for(var h=s.SelectNodes("Definition/Field"),D=0;D<h.length;D++){var m="",b="",S="",C="",y=0;if(null!=h[D].SelectSingleNode("DataSource")&&(m=h[D].SelectSingleNode("DataSource").InnerText),null!=h[D].SelectSingleNode("SysColumn")&&(b=h[D].SelectSingleNode("SysColumn").InnerText),null!=h[D].SelectSingleNode("Delimiter")&&(S=h[D].SelectSingleNode("Delimiter").InnerText),null!=h[D].SelectSingleNode("Width")&&i.e.IsNum(h[D].SelectSingleNode("Width").InnerText)&&(y=parseInt(h[D].SelectSingleNode("Width").InnerText)),null!=h[D].SelectSingleNode("Decimals")&&i.e.IsNum(h[D].SelectSingleNode("Decimals").InnerText)&&parseInt(h[D].SelectSingleNode("Decimals").InnerText),-1==y&&""!=S){var p=r.indexOf(S);p>0&&p<r.length&&(C=r.substr(0,p),r=r.Remove(0,p))}else-1!=y&&r.length>=y?(C=r.substr(0,y),r=r.Remove(0,y)):-1==y&&D==h.length-1&&(C=r);""!=S&&r.length>S.length&&(r=r.Remove(0,S.length)),"Document"==m&&"Batch_No"==b?u=C:"Document"==m&&"Quantity"==b&&(i.e.IsNum(C)?i.e.Double(C):1)}if(""!=u){var g=this.dsBatch.Tables[0].filter((function(e){return e.BATCHNUMBER==u}));if(g.length>0){var f=this.GridData.filter((function(e){return e.BatchID==g[0].BatchID}));if(f.length>0){if(i.e.IsEmpty(f[0].Quantity))f[0].Quantity="1";else{if(i.e.IsEmpty(f[0].BalQty)||!(parseFloat(f[0].Quantity)<parseFloat(f[0].BalQty)))return void(this.DisplayMessage="Can not enter more than "+f[0].BalQty.toString());f[0].Quantity=parseFloat(f[0].Quantity)+1}return this.GridDataColumns.Contains("QtyUom")&&(f[0].QtyUom=i.e.IsEmpty(f[0].Quantity)?0:parseFloat(f[0].Quantity)/this.UomConversion),this.BatchScanning.Text="",event.preventDefault(),void(this.QtyAddMessage=i.e.Format(n.a.GetResource("BatchNo_AddMessage"),this.InvQty.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty),this.BatchQty.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty),this.ProdName.toString()))}}}}}event.preventDefault()}}},{key:"onBinCLick",value:function(e){var t,a=this;if(("AddEditDocumentViewModel"==this.Parent.ClassName||"POSDocumentViewModel"==this.Parent.ClassName)&&this.SelectedRow&&!i.e.IsEmpty(this.SelectedRow.BatchID)&&i.e.Double(this.SelectedRow.Quantity)>0){t=parseFloat(this.SelectedRow.Quantity);var s=0,r=0,o=0,l=0,c=0,d=0;if(n.a.SessionManager.Preferences.ContainsKey("DimensionwiseBins")&&""!=n.a.SessionManager.Preferences.DimensionwiseBins.toString()){var h=!1;if((r=i.e.Int(n.a.SessionManager.Preferences.DimensionwiseBins))>0){s=1;for(var D=0;D<this.Parent.ScreenObject._CCFields.length;D++){var S=this.Parent.ScreenObject._CCFields[D];if(S instanceof u.b&&S.CCID==r){S.SelectedValue>0&&(s=S.SelectedValue),h=!0;break}}h||null!=this.drSel&&r>5e4&&this.drSelObj.TableColumns.Contains("dcCCNID"+(r-5e4).toString()+"_Key")&&i.e.Int(this.drSel["dcCCNID"+(r-5e4).toString()+"_Key"])>0&&(s=parseInt(this.drSel["dcCCNID"+(r-5e4).toString()+"_Key"]))}}if(-1==this.VoucherType&&null!=this.SelectedRow&&(o=parseInt(this.SelectedRow.batchid),this.GridDataColumns.Contains("VoucherNo")&&(l=parseInt(this.SelectedRow.RefInvID))),this.Parent.ScreenObject.Preferences.ContainsKey("BinFilterDim")&&""!=this.Parent.ScreenObject.Preferences.BinFilterDim.toString()&&((d=i.e.Int(this.Parent.ScreenObject.Preferences.BinFilterDim))>0&&(c=this.Parent.GetDimValue(d,this.Parent.SelectedRow))),r>5e4&&!this.Parent.ScreenObject.IsBinWise(r,s)){if(5==this.Parent.ScreenObject.DocumentType&&!this.Parent.ScreenObject.GridDataColumns.Contains("RecievedQty")&&r>0){var C=!1;s=1;for(var y=function(e){var t=a.Parent.ScreenObject._CCFields[e];if(t instanceof u.b&&t.CCID==r)return t.DBColumnName.Contains("TO")?t.SelectedValue>0&&(s=t.SelectedValue):(g=a.Parent.ScreenObject._CCFields.find((function(e){return e.DBColumnName=="TO"+t.DBColumnName})))instanceof u.b?g.SelectedValue>0&&(s=g.SelectedValue):t.SelectedValue>0&&(s=t.SelectedValue),C=!0,"break"},p=0;p<this.Parent.ScreenObject._CCFields.length;p++){var g;if("break"===y(p))break}if(C||null!=this.drSel&&r>5e4&&this.drSelObj.TableColumns.Contains("dcCCNID"+(r-5e4).toString()+"_Key")&&(this.drSelObj.TableColumns.Contains("TOdcCCNID"+(r-5e4).toString()+"_Key")?i.e.Int(this.drSel["TOdcCCNID"+(r-5e4).toString()+"_Key"])>0&&(s=parseInt(this.drSel["TOdcCCNID"+(r-5e4).toString()+"_Key"])):i.e.Int(this.drSel["dcCCNID"+(r-5e4).toString()+"_Key"])>0&&(s=parseInt(this.drSel["dcCCNID"+(r-5e4).toString()+"_Key"]))),!(r>5e4)||this.Parent.ScreenObject.IsBinWise(r,s)){i.e.IsEmpty(this.drSel.TODocDetailsID)||(this.DocDetailsId=parseInt(this.drSel.TODocDetailsID));var f=this.Parent.ScreenObject.GetProductwiseBins(parseInt(this.drSel.ProductID_Key),this.Parent.ScreenObject.DocID,1,this.Parent.DocumentDate,r,s,d,c,0,0,0,this.Parent.GetBOEIDS(this.drSel)),I=new m.a(this,1,t,parseInt(this.drSel.ProductID_Key),this.drSel.ProductName.toString(),f,this.drSel);this.Parent.ScreenObject.Preferences.ContainsKey("AutoSelectBins")&&"true"==this.Parent.ScreenObject.Preferences.AutoSelectBins.toLowerCase()&&null!=f&&f.Tables.length>0&&1==f.Tables[0].length&&I.BinsGrid.Table.length>0?(I.BinsGrid.Table[0].Allocate=t,I.celledtiend(I.BinsGrid.Table[0]),I.DisplayMessage="",I.OnSave("AutoSave"),""!=I.DisplayMessage&&n.a.page.ShowDialog(I,b.a)):n.a.page.ShowDialog(I,b.a)}}}else{var T=0;-1!=this.VoucherType||i.e.IsEmpty(this.drSel.LinkedInvDocDetailsID)||(T=i.e.Int(this.drSel.LinkedInvDocDetailsID));var P=this.Parent.ScreenObject.GetProductwiseBins(this.ProductID,this.DocId,this.VoucherType,this.docdate,r,s,d,c,T,o,l,this.Parent.GetBOEIDS(this.drSel)),O=new m.a(this,this.VoucherType,t,this.ProductID,this.ProdName,P,this.drSel);"Auto"==e&&this.Parent.ScreenObject.Preferences.ContainsKey("AutoSelectBins")&&"true"==this.Parent.ScreenObject.Preferences.AutoSelectBins.toLowerCase()&&null!=P&&P.Tables.length>0&&1==P.Tables[0].length&&O.BinsGrid.Table.length>0?(O.BinsGrid.Table[0].Allocate=t,O.celledtiend(O.BinsGrid.Table[0]),O.DisplayMessage="",O.OnSave("AutoSave")):n.a.page.ShowDialog(O,b.a)}}}},{key:"onEditClick",value:function(e){if(("AddEditDocumentViewModel"==this.Parent.ClassName||"POSDocumentViewModel"==this.Parent.ClassName)&&null!=this.SelectedRow&&!i.e.IsEmpty(this.SelectedRow.BatchID)){this.ExpanderVisibility=!0,this.Isexp=!0,null==this.StaticFields&&this.LoadStaticFields();var t=this.Parent.ScreenObject.GetBatchDetails(this.SelectedRow.BatchID.toString());if(t.Tables.length>0&&t.Tables[0].length>0){this.FromDate&&!i.e.IsEmpty(t.Tables[0][0].MfgDate)&&(this.FromDate.Date=new Date(t.Tables[0][0].MfgDate)),this.ExpDate&&!i.e.IsEmpty(t.Tables[0][0].ExpiryDate)&&(this.ExpDate.Date=new Date(t.Tables[0][0].ExpiryDate)),this.objBatch.BatchID=parseInt(t.Tables[0][0].BatchID),this.BatchNo.Text=t.Tables[0][0].BatchNumber.toString(),this.BatMRate.Text=t.Tables[0][0].MRPRate.toString(),this.BatSRate.Text=t.Tables[0][0].StockistRate.toString(),this.BatRRate.Text=t.Tables[0][0].RetailRate.toString(),this.objBatch.GUID=t.Tables[0][0].GUID.toString(),this.RetestDate&&!i.e.IsEmpty(t.Tables[0][0].RetestDate)&&(this.RetestDate.Date=new Date(t.Tables[0][0].RetestDate));for(var a=0;a<this.StaticFields.length;a++){var n=this.StaticFields[a];n instanceof c.c&&null!=n.DBColumnName&&(t.Columns[0].Contains(n.DBColumnName)?n instanceof o.d?n.Text=t.Tables[0][0][n.DBColumnName].toString():n instanceof S.e?n.SelectedValue=t.Tables[0][0][n.DBColumnName].toString():n instanceof o.c?n.Text=t.Tables[0][0][n.DBColumnName].toString():n instanceof h.b||n instanceof h.c||n instanceof h.a?i.e.isValidDate(t.Tables[0][0][n.DBColumnName])&&(n.Date=new Date(t.Tables[0][0][n.DBColumnName])):n instanceof C.a?n.Text=t.Tables[0][0][n.DBColumnName].toString():n instanceof u.b?i.e.IsNum(t.Tables[0][0][n.DBColumnName])&&(n.SelectedValue=parseInt(t.Tables[0][0][n.DBColumnName])):n instanceof o.a&&(n.Text=t.Tables[0][0].BatchCode.toString(),i.e.IsEmpty(t.Tables[0][0].CodePrefix)||(n.SuffixCode=t.Tables[0][0].CodePrefix.toString()),i.e.IsEmpty(t.Tables[0][0].CodeNumber)||(n.PrefixCode=t.Tables[0][0].CodeNumber.toString())):t.Columns[5].Contains(n.DBColumnName)&&i.e.IsNum(t.Tables[5][0][n.DBColumnName])&&(n.SelectedValue=parseInt(t.Tables[5][0][n.DBColumnName])))}}}}},{key:"SetBalQty",value:function(){var e=this;if(("AddEditDocumentViewModel"==this.Parent.ClassName||"POSDocumentViewModel"==this.Parent.ClassName)&&null!=this.drSel&&!i.e.IsEmpty(this.drSel.ProductID_Key)){var t;if(t=30==this.Parent.ScreenObject.DocumentType&&this.Parent.ScreenObject.GridDataColumns.Contains("VoucherType")&&!i.e.IsEmpty(this.drSel.VoucherType)?this.Parent.ScreenObject.GridData.filter((function(t){return t.ProductID_Key==e.drSel.ProductID_Key&&t.VoucherType==e.drSel.VoucherType})):this.Parent.ScreenObject.GridData.filter((function(t){return t.ProductID_Key==e.drSel.ProductID_Key})),n.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise Batches")&&!i.e.IsEmpty(n.a.SessionManager.Preferences["Maintain Dimensionwise Batches"])){var a;(a=i.e.Int(n.a.SessionManager.Preferences["Maintain Dimensionwise Batches"].toString()))>0&&null!=this.drSel&&a>5e4&&!i.e.IsEmpty(this.drSel["dcCCNID"+(a-5e4).toString()+"_Key"])&&(t=t.filter((function(t){return t["dcCCNID"+(a-5e4).toString()+"_Key"]==e.drSel["dcCCNID"+(a-5e4).toString()+"_Key"].toString()})))}if(t.length>0){var s=[];if(t.forEach((function(t){if(!i.e.IsEmpty(t.ExtraXML)&&e.drSel!=t){var a=new i.f;if(a.ReadXml(t.ExtraXML),a.Tables.length>0&&a.Tables[0].length>0&&a.Columns[0].Contains("BatchID")&&a.Columns[0].Contains("Quantity"))for(var n=0;n<a.Tables[0].length;n++){var r={};r.BatchID=a.Tables[0][n].BatchID.toString(),r.Qty=a.Tables[0][n].Quantity.toString(),a.Columns[0].Contains("RefInvID")&&!i.e.IsEmpty(a.Tables[0][n].RefInvID)&&(r.RefINvID=a.Tables[0][n].RefInvID.toString()),s.push(r)}}})),s.length>0)for(var r=function(a){if(i.e.Int(e.GridData[a].BatchID)>0&&(t=s.filter(e.ConsolidatedBatches?function(t){return t.BatchID==e.GridData[a].BatchID}:function(t){return t.BatchID==e.GridData[a].BatchID&&t.RefINvID==e.GridData[a].RefInvID})).length>0){var r=0,o=0,l=(r=i.e.Double(e.GridData[a].BalQty)).toString();n.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=n.a.SessionManager.Preferences.DecimalsinQty&&(l=r.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty)),r=parseFloat(l),t.forEach((function(e){i.e.IsEmpty(e.Qty)||(o+=parseFloat(e.Qty))})),r-=o,e.GridData[a].BalQty=n.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=n.a.SessionManager.Preferences.DecimalsinQty?r.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty):r}},o=0;o<this.GridData.length;o++)r(o)}}}},{key:"OnComboCellEditEnding",value:function(e){if("BatchID"==e.column.field){var t=i.e.Int(e.item.BatchID);t>0&&this.OnBatchSelected(e.item,t)}}},{key:"OnBatchSelected",value:function(e,t){if(this.dvCombo=this.dvComboTable.filter((function(e){return e.BatchID==t})),null!=this.dvCombo&&this.dvCombo.length>0){this.GridDataColumns.Contains("Edit")&&(e.Edit="Edit"),this.GridDataColumns.Contains("Bins")&&(e.Bins="Bins"),this.dvComboColumns.Contains("BatchCode")&&(e.BatchCode=this.dvCombo[0].BatchCode.toString()),e.BATCHNUMBER=this.dvCombo[0].BATCHNUMBER.toString(),e.MfgDate=i.e.isValidDate(this.dvCombo[0].MfgDate)?this.OnlyMonthYear?new Date(this.dvCombo[0].MfgDate).ToString("MMM/yyyy"):new Date(this.dvCombo[0].MfgDate).ToString(n.a.SessionManager.Preferences["Date Format"]):"",e.ExpDate=i.e.isValidDate(this.dvCombo[0].ExpiryDate)?this.OnlyMonthYear?new Date(this.dvCombo[0].ExpiryDate).ToString("MMM/yyyy"):new Date(this.dvCombo[0].ExpiryDate).ToString(n.a.SessionManager.Preferences["Date Format"]):"",e.MRate=i.e.IsEmpty(this.dvCombo[0].MRATE)?"":this.dvCombo[0].MRATE.toString(),e.RRate=i.e.IsEmpty(this.dvCombo[0].RRATE)?"":this.dvCombo[0].RRATE.toString(),i.e.IsEmpty(this.dvCombo[0].SRATE)||(e.SRate=this.dvCombo[0].SRATE.toString());for(var a=0;a<this.dtmap.length;a++)this.dtmap[a].BatchCol.toString().toLowerCase().Contains("ccnid")&&this.dtmap[a].BaseCol.toString().toLowerCase().Contains("ccnid")&&this.GridDataColumns.Contains(this.dtmap[a].BatchCol.toString()+"_Key")&&this.dvComboColumns.Contains(this.dtmap[a].BatchCol.toString())&&!i.e.IsEmpty(this.dvCombo[0][this.dtmap[a].BatchCol.toString()])?(e[this.dtmap[a].BatchCol.toString()]=this.dvCombo[0][this.dtmap[a].BatchCol.toString()+"_Key"].toString(),e[this.dtmap[a].BatchCol.toString()+"_Key"]=this.dvCombo[0][this.dtmap[a].BatchCol.toString()].toString()):this.dvComboColumns.Contains(this.dtmap[a].BatchCol.toString())&&this.GridDataColumns.Contains(this.dtmap[a].BatchCol.toString())&&(e[this.dtmap[a].BatchCol.toString()]=this.dvCombo[0][this.dtmap[a].BatchCol.toString()].toString());if(null!=this.dsBatch.Tables[4]&&this.dsBatch.Tables[4].length>0)for(var s=0;s<this.dsBatch.Tables[4].length;s++)if(!i.e.IsEmpty(this.dsBatch.Tables[4][s].CostcenterColID)&&parseInt(this.dsBatch.Tables[4][s].CostcenterColID)<53692&&parseInt(this.dsBatch.Tables[4][s].CostcenterColID)>1572){var r=this.dsBatch.Tables[4][s].Name.toString();this.dsBatch.Tables[4][s].Name.toString().toLowerCase().Contains("ccnid")?(this.dvComboColumns.Contains(r+"_Key")&&(e[this.dsBatch.Tables[4][s].Name.toString()]=this.dvCombo[0][r+"_Key"].toString()),this.GridDataColumns.Contains(r+"_Key")&&(e[r+"_Key"]=this.dvCombo[0][r].toString())):""!=r&&"retestdate"==r.toLowerCase()&&this.dvComboColumns.Contains(r)?i.e.isValidDate(this.dvCombo[0][r])?e[this.dsBatch.Tables[4][s].Name.toString()]=new Date(this.dvCombo[0][r]).ToString(n.a.SessionManager.Preferences["Date Format"]):e[this.dsBatch.Tables[4][s].Name.toString()]="":""!=r&&this.dvComboColumns.Contains(r)&&"MfgDate"!=r&&"ExpiryDate"!=r&&(e[this.dsBatch.Tables[4][s].Name.toString()]=this.dvCombo[0][r].toString())}this.GridDataObj.updateRow(e)}}},{key:"OnBeginEdit",value:function(e){var t=e.args;"Quantity"==t.column.field&&this.SelectQty(t.item)}},{key:"SelectQty",value:function(e){var t=i.e.Double(e.Quantity);if(i.e.IsEmpty(e.Quantity)||0==t){var a=0,n=this.GridData.Compute("sum","Quantity");null!=n&&(a=i.e.Double(n)),a=this.BatchQty-a,-1==this.VoucherType&&a>0&&(i.e.IsEmpty(e.BalQty)||(e.Quantity=a>parseFloat(e.BalQty)?e.BalQty:a,this.GridDataColumns.Contains("QtyUom")&&(e.QtyUom=i.e.IsEmpty(e.Quantity)?0:parseFloat(e.Quantity)/this.UomConversion)))}}},{key:"OnCellEditEnding",value:function(e){if("BatchID"==e.column.field){var t=i.e.Int(e.item.BatchID);t>0&&this.OnBatchSelected(e.item,t)}else{var a=e.item;if("DataGridComboBoxColumn"==e.column.className)return;var r=e.column.field;if("QtyUom"==r&&(a.Quantity=i.e.IsEmpty(a.QtyUom)?0:parseFloat(a.QtyUom)*this.UomConversion,r="Quantity"),"Quantity"==r){if(-1==this.VoucherType&&!i.e.IsEmpty(a.BalQty)&&!i.e.IsEmpty(a.Quantity)){var o=!1;("AddEditDocumentViewModel"==this.Parent.ClassName||"POSDocumentViewModel"==this.Parent.ClassName)&&this.Parent.ScreenObject.Preferences.ContainsKey("AllowNegativebatches")&&Object(s.j)(this.Parent.ScreenObject.Preferences.AllowNegativebatches)&&(o="AddEditDocumentViewModel"!=this.Parent.ClassName&&"POSDocumentViewModel"!=this.Parent.ClassName||!this.Parent.ScreenObject.Preferences.ContainsKey("DontAllowNegative")||!Object(s.j)(this.Parent.ScreenObject.Preferences.DontAllowNegative)),31==this.Parent.DocumentType&&(o=!0),!o&&parseFloat(a.BalQty)<parseFloat(a.Quantity)&&(a.Quantity=a.BalQty,this.DisplayMessage="Can not enter more than "+a.BalQty.toString())}this.GridDataColumns.Contains("Release")?i.e.IsEmpty(a.Quantity)||(i.e.IsEmpty(a.Release)||i.e.IsEmpty(a.Hold)||!i.e.IsEmpty(a.Hold)&&0==parseFloat(a.Hold))&&(a.Release=a.Quantity.toString(),a.Hold=0):(i.e.IsEmpty(a.Quantity)||!i.e.IsEmpty(a.Quantity)&&0==parseFloat(a.Quantity))&&(this.GridDataColumns.Contains("Release")&&(a.Release=""),this.GridDataColumns.Contains("Hold")&&(a.Hold="")),this.GridDataColumns.Contains("QtyUom")&&(a.QtyUom=i.e.IsEmpty(a.Quantity)?0:parseFloat(a.Quantity)/this.UomConversion),this.InvQty=0;for(var l=0;l<this.GridData.length;l++)i.e.IsEmpty(this.GridData[l].Quantity)||i.e.IsEmpty(this.GridData[l].BatchID)||(this.InvQty+=parseFloat(this.GridData[l].Quantity));this.Parent.ScreenObject.Preferences.ContainsKey("AutoPopulateBatchQty")&&"true"==this.Parent.ScreenObject.Preferences.AutoPopulateBatchQty.toLowerCase()&&null!=this.txtqty&&(this.txtqty.Text=(this.BatchQty-this.InvQty).toString()),this.GridDataColumns.Contains("BinsXML")&&this.Parent.ScreenObject.Preferences.ContainsKey("AutoSelectBins")&&"true"==this.Parent.ScreenObject.Preferences.AutoSelectBins.toLowerCase()&&this.onBinCLick("Auto")}if(1==this.VoucherType&&this.HoldRelease&&!i.e.IsEmpty(a.Release)&&"Release"==r&&(i.e.IsEmpty(a.Hold)&&(a.Hold=0),this.Tot=parseFloat(a.Hold)+parseFloat(a.Release),this.Tot!=parseFloat(a.Quantity)))return void(this.DisplayMessage=n.a.GetResource("Batch_QtySum").toString());this.GridDataObj.updateRow(a),this.QtyAddMessage=i.e.Format(n.a.GetResource("BatchNo_AddMessage"),this.InvQty.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty),this.BatchQty.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty),this.ProdName.toString()),Logger.InfoLog("OnCellEditEnding:: Exiting OnCellEditEnding")}}},{key:"FillEmptyRows",value:function(){if(null!=this.GridData&&this.GridDataColumns.Contains("Sno")){for(var e=0;e<this.GridData.length;e++)this.GridData[e].Sno=e+1;for(var t=this.GridData.length;t<8;t++){var a=this.GridDataObj.NewRow();a.Sno=t+1,this.GridDataObj.addRow(a)}}}},{key:"GridData_RowDeleted",value:function(e){var t=1;this.GridData.forEach((function(e){"DELETED"!=e.RowState.toString().toUpperCase()&&(e.Sno=t++)})),this.QtyAddMessage=i.e.Format(n.a.GetResource("BatchNo_AddMessage"),(t-1).ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty),this.BatchQty.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty),this.ProdName.toString())}},{key:"Validate",value:function(){if(null!=this.FromDate&&null!=this.ExpDate&&this.FromDate.Date>this.ExpDate.Date)return this.DisplayMessage="Expiry Date cannot be less than Manufacturing Date",!0;var e=this.BatMRate.ValidateData();return i.e.IsEmpty(e)?(e=this.BatRRate.ValidateData(),i.e.IsEmpty(e)?(e=this.BatSRate.ValidateData(),i.e.IsEmpty(e)?(e=this.BatchNo.ValidateData(),!i.e.IsEmpty(e)&&(this.DisplayMessage=e+" BatchNo",!0)):(this.DisplayMessage=e+" SRate",!0)):(this.DisplayMessage=e+" RRate",!0)):(this.DisplayMessage=e+" MRate ",!0)}},{key:"AddRow",value:function(e){var t=this.Parent.GetEmptyRowPosition(this.GridDataObj,"BatchID");this.GridData[t].BatchID=e,this.OnBatchSelected(this.GridData[t],e),this.GridData[t].Quantity=null==this.txtqty||i.e.IsEmpty(this.txtqty.Text)||""!=this.txtqty.ValidateData()?1:this.txtqty.Text,this.GridDataColumns.Contains("QtyUom")&&(this.GridData[t].QtyUom=i.e.IsEmpty(this.GridData[t].Quantity)?0:parseFloat(this.GridData[t].Quantity)/this.UomConversion),this.GridDataObj.updateRow(this.GridData[t])}},{key:"OnSave",value:function(e){var t=this;if(this.GridDataObj.commitEdit(),"Fifo"==e.toString())this.ChkFifo=!this.ChkFifo;else if("Fifoall"==e.toString())this.ChkFifoAll=!this.ChkFifoAll;else if("AddBatch"==e.toString()||"SaveAddBatch"==e.toString()||"SaveAddMultiple"==e.toString()||"SaveAsBatch"==e.toString()||this.IsQuickAdd&&"Save"==e.toString()){var a="";if(0==this.objBatch.BatchID&&null!=this.txtqty&&""!=this.txtqty.ValidateData())return void(this.DisplayMessage=this.txtqty.ValidateData());if(0==this.objBatch.BatchID&&null!=this.txtqty&&"SaveAddBatch"==e.toString()&&0==parseFloat(this.txtqty.Text))return void(this.DisplayMessage="Enter Qty.");for(var r=0;r<this.StaticFields.length;r++){var l=this.StaticFields[r],d="";if(l instanceof c.c&&null!=l.DBColumnName&&!l.IsColumnUserDefined)if(l instanceof o.d)if(d=l.Text,i.e.IsEmpty(d)&&(d=""),"BatchNumber"==l.DBColumnName&&""!=d)this.BatchNo.Text=d.replace("'","''");else{if("BatchNumber"==l.DBColumnName&&""==d)return void(this.DisplayMessage="Enter Batch No");"MRPRate"==l.DBColumnName?this.BatMRate.Text=d.toString():"StockistRate"==l.DBColumnName?this.BatSRate.Text=d.toString():"RetailRate"==l.DBColumnName?this.BatRRate.Text=d.toString():l!=this.txtqty&&(a+=l.DBColumnName+"=N'"+d.replace("'","''")+"',")}else if(l instanceof h.c){if(l.Mandatory&&!l.Date)return void(this.DisplayMessage="select "+l.Label)}else l instanceof u.b?null==l.DBColumnName||l.DBColumnName.toLowerCase().Contains("ccnid")||(a+=l.DBColumnName+"='"+l.SelectedValue+"',"):l instanceof o.c?(d=l.Text,i.e.IsEmpty(d)&&(d=""),a+=l.DBColumnName+"=N'"+d.replace("&","&am;").replace("'","''")+"',"):l instanceof S.e&&(d=l.SelectedValue,i.e.IsEmpty(d)&&(d=""),a+=l.DBColumnName+"='"+d.replace("&","&am;").replace("'","''")+"',")}if(!this.Validate())try{var D,m=function(){var s;s=t.objBatch.BatchID;var r=[];if(0==t.objBatch.BatchID&&null!=t.ControlGen){var o={StrCode:t.objBatch.BatchCode,CodePrefix:t.objBatch.CodePrefix,CodeNumber:t.objBatch.CodeNumber};if(t.DisplayMessage=t.ControlGen.SetAutoCodeParams_3(t.BatchCode,t.objBatch.BatchGroup,t.dsBatch.Tables[6],o),t.objBatch.BatchCode=o.StrCode,t.objBatch.CodePrefix=o.CodePrefix,t.objBatch.CodeNumber=o.CodeNumber,t.DisplayMessage.length>0)return{v:void 0}}else t.objBatch.BatchCode=t.BatchCode.PrefixVisibility||t.BatchCode.SuffixVisibility?t.BatchCode.PrefixCode+t.BatchCode.Text+t.BatchCode.SuffixCode:t.BatchCode.Text;r.push(t.BatchNo.Text.toString()),r.push(null!=t.FromDate&&t.FromDate.Date?t.FromDate.Date.ToString("dd/MMM/yyyy"):"1/JAN/1900"),null!=t.ExpDate&&t.ExpDate.Date?(t.OnlyMonthYear&&t.ExpDate.Date.getDate()!=t.ExpDate.Date.DaysInMonth()&&(t.ExpDate.Date=new Date(t.ExpDate.Date.getFullYear(),t.ExpDate.Date.getMonth(),t.ExpDate.Date.DaysInMonth())),r.push(t.ExpDate.Date.ToString("dd/MMM/yyyy"))):r.push("1/JAN/1900"),null==t.BatMRate.Text||""==t.BatMRate.Text.Trim()?r.push(0):r.push(t.BatMRate.Text),null==t.BatRRate.Text||""==t.BatRRate.Text.Trim()?r.push(0):r.push(t.BatRRate.Text),null==t.BatSRate.Text||""==t.BatSRate.Text.Trim()?r.push(0):r.push(t.BatSRate.Text),r.push(t.ProductID),r.push(null!=t.RetestDate&&t.RetestDate.Date?t.RetestDate.Date.ToString("dd/MMM/yyyy"):"1/JAN/1900"),r.push(0),t.objBatch.StaticFieldsQuery=a.toString(),t.objBatch.CustomFieldsQuery=t.GetCustomFieldsQuery(),t.objBatch.CustomCostCenterFieldsQuery=t.GetCustomCostCenterFieldsQuery(),"SaveAsBatch"==e.toString()&&(t.objBatch.BatchID=0);var l,c=null;if("SaveAddMultiple"==e.toString()?(r.push(t.BatchQty/parseFloat(t.txtqty.Text)),r.push(t.BNO),r.push(t.NextSeq),r.push(t.Seqlen),c=p.QuickAddBatchMultple(t.objBatch,r,t.IsBatchSeqNoExists),console.log(c),(l={}).RetValue=c.obj):l=p.QuickAddBatch(t.objBatch,r,t.IsBatchSeqNoExists),t.DisplayMessage=l.Message,l.RetValue>0){if(t.IsQuickAdd)return{v:(t.DocId=l.RetValue,void n.a.page.HideDialog())};var d=0;"AddEditDocumentViewModel"!=t.Parent.ClassName&&"POSDocumentViewModel"!=t.Parent.ClassName||(d=t.Parent.CostCenterID);var h=-1,m=-1,b=0,S=!1;if(("AddEditDocumentViewModel"==t.Parent.ClassName||"POSDocumentViewModel"==t.Parent.ClassName)&&n.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise Batches")&&""!=n.a.SessionManager.Preferences["Maintain Dimensionwise Batches"].toString()&&(b=i.e.Int(n.a.SessionManager.Preferences["Maintain Dimensionwise Batches"]))>0){for(var C=0;C<t.Parent.ScreenObject._CCFields.length;C++){var y=t.Parent.ScreenObject._CCFields[C];if(y instanceof u.b&&y.CCID==b){h=y.SelectedValue,S=!0;break}}S||null!=t.drSel&&b>5e4&&t.drSelObj.TableColumns.Contains("dcCCNID"+(b-5e4).toString()+"_Key")&&!i.e.IsEmpty(t.drSel["dcCCNID"+(b-5e4).toString()+"_Key"])&&(h=parseInt(t.drSel["dcCCNID"+(b-5e4).toString()+"_Key"]))}if(("AddEditDocumentViewModel"==t.Parent.ClassName||"POSDocumentViewModel"==t.Parent.ClassName)&&t.Parent.ScreenObject.Preferences.ContainsKey("BatchFilterDim")&&(S=!1,(b=i.e.Int(t.Parent.ScreenObject.Preferences.BatchFilterDim))>0)){for(var g=0;g<t.Parent.ScreenObject._CCFields.length;g++){var f=t.Parent.ScreenObject._CCFields[g];if(f instanceof u.b&&f.CCID==b){m=f.SelectedValue>0?f.SelectedValue:1,S=!0;break}}S||null!=t.drSel&&b>5e4&&t.drSelObj.TableColumns.Contains("dcCCNID"+(b-5e4).toString()+"_Key")&&(S=!0,m=i.e.IsEmpty(t.drSel["dcCCNID"+(b-5e4).toString()+"_Key"])?1:parseInt(t.drSel["dcCCNID"+(b-5e4).toString()+"_Key"]))}var I=(new p).GetProductwiseBatches(t.ProductID,t.DocDetailsId,t.DocId,t.VoucherType,t.docdate,t.Div,t.Loc,d,h,m);if(I.Tables.length>1)if((D=t.ColumnSource.find((function(e){return null!=e.ValueBinding&&"BatchID"==e.ValueBinding})))&&(D.ComboData=I.Tables[0]),t.dvCombo=I.Tables[0],t.dvComboTable=I.Tables[0],t.dvComboColumns=I.Columns[0],s>0)t.GridData.filter((function(e){return e.BatchID==l.RetValue})).forEach((function(e){t.OnBatchSelected(e,l.RetValue),t.GridDataObj.updateRow(e)}));else if("SaveAddMultiple"!=e.toString()||null==c||c.Tables[c.Tables.length-1].Columns.Contains("ErrorMessage")){if("SaveAddBatch"==e.toString()&&I.Tables[0].filter((function(e){return e.BatchID==l.RetValue})).length>0){t.AddRow(l.RetValue),t.InvQty=0;var T=t.GridData.Compute("sum","Quantity");null!=T&&(t.InvQty=i.e.Double(T)),t.InvQty=t.BatchQty-t.InvQty,t.QtyAddMessage=i.e.Format(n.a.GetResource("BatchNo_AddMessage"),t.InvQty.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty),t.BatchQty.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty),t.ProdName.toString())}}else!function(){for(var e=c.Tables.length-1,a=function(a){var n=c.Columns[e][0];I.Tables[0].filter((function(t){return t.BatchID==c.Tables[e][a][n]})).length>0&&t.AddRow(parseInt(c.Tables[e][a][n]))},s=0;s<c.Tables[e].length;s++)a(s);t.InvQty=0;var r=t.GridData.Compute("sum","Quantity");null!=r&&(t.InvQty=i.e.Double(r)),t.InvQty=t.BatchQty-t.InvQty,t.QtyAddMessage=i.e.Format(n.a.GetResource("BatchNo_AddMessage"),t.InvQty.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty),t.BatchQty.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty),t.ProdName.toString())}();if(t.dtmap.Clear(),I.Tables.length>3)for(var P=0;P<I.Tables[3].length;P++){var O={};O.BatchCol=I.Tables[3][P].BatchCol.toString(),O.BaseCol=I.Tables[3][P].BaseCol.toString(),t.dtmap.push(O)}t.GridDataObj.RefreshGrid=!t.GridDataObj.RefreshGrid,t.ResetBatchNo(s),t.objBatch.GUID="",t.objBatch.BatchID=0,t.BatMRate.Text="",t.BatRRate.Text="",t.BatSRate.Text="",t.GridDataObj.gridObj&&t.GridDataObj.gridObj.invalidate()}}();if("object"==typeof m)return m.v}catch(x){Logger.InfoLog("BatchNumberViewModel:: OnSave"+x.stack)}}else if("Save"==e.toString()||"AutoSave"==e.toString()||"AutoSaveScan"==e.toString()){if("IWODetailsViewModel"==this.Parent.ClassName)return void this.SaveWO();var b="",C="",y="";if(n.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=n.a.SessionManager.Preferences.DecimalsinQty){var g=this.InvQty.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty);this.InvQty=parseFloat(g)}var f=!1;if(this.Parent.ScreenObject.Preferences.ContainsKey("QtyonBatch")&&""!=this.Parent.ScreenObject.Preferences.QtyonBatch&&Object(s.j)(this.Parent.ScreenObject.Preferences.QtyonBatch)&&(f=!0),this.InvQty>this.BatchQty&&!f)return void(this.DisplayMessage=n.a.GetResource("Batch_QtyMisMatch"));if(1==this.VoucherType&&this.HoldRelease)for(var I=0;I<this.GridData.length;I++)if(!i.e.IsEmpty(this.GridData[I].BatchID)&&!i.e.IsEmpty(this.GridData[I].Release)&&!i.e.IsEmpty(this.GridData[I].Quantity)&&parseFloat(this.GridData[I].Hold)+parseFloat(this.GridData[I].Release)!=parseFloat(this.GridData[I].Quantity))return void(this.DisplayMessage=n.a.GetResource("Batch_QtySumRow").toString()+I+1);for(var T=0,P=0;P<this.GridData.length;P++)if(!i.e.IsEmpty(this.GridData[P].BatchID)&&i.e.IsNum(this.GridData[P].Quantity)){if(T+=parseFloat(this.GridData[P].Quantity),this.GridDataColumns.Contains("QOH")&&i.e.IsNum(this.GridData[P].QOH)&&parseFloat(this.GridData[P].Quantity)>parseFloat(this.GridData[P].QOH))return void(this.DisplayMessage="Can not enter more than "+this.GridData[P].QOH.toString()+" ,at row no:"+this.GridData[P].Sno.toString());var O=!1;if("AddEditDocumentViewModel"!=this.Parent.ClassName&&"POSDocumentViewModel"!=this.Parent.ClassName||this.Parent.DonotUpdateInventory||(O=!0),("AddEditDocumentViewModel"==this.Parent.ClassName||"POSDocumentViewModel"==this.Parent.ClassName)&&this.Parent.ScreenObject.Preferences.ContainsKey("ExcludeHoldBins")&&""!=this.Parent.ScreenObject.Preferences.ExcludeHoldBins.toString()&&Object(s.j)(this.Parent.ScreenObject.Preferences.ExcludeHoldBins)&&(this.Parent.ScreenObject.GridDataColumns.Contains("ReserveQuantity")||this.Parent.ScreenObject.GridDataColumns.Contains("HoldQuantity"))&&(O=!0),this.GridDataColumns.Contains("BinsXML")&&O&&parseFloat(this.GridData[P].Quantity)>0&&this.Parent.ScreenObject.GridDataColumns.Contains("BinWise")&&"True"==this.drSel.BinWise.toString()&&this.Parent.IsWarehouseBinwise(this.Parent.ScreenObject.SelectedGridRowIndex,0,{DimensionID:0})){var B=!1;if((this.Parent.ScreenObject.GridDataColumns.Contains("BinStatus")||this.Parent.ScreenObject.Preferences.ContainsKey("AutoSelectBins")&&"true"==this.Parent.ScreenObject.Preferences.AutoSelectBins.toLowerCase())&&(B=!0),!this.Parent.ScreenObject.Preferences.ContainsKey("AutoAdjustBins")||i.e.IsEmpty(this.Parent.ScreenObject.Preferences.AutoAdjustBins)||!Object(s.j)(this.Parent.ScreenObject.Preferences.AutoAdjustBins)||""!=i.e.String(this.drSel.DocDetailsID)&&0!=parseInt(i.e.String(this.drSel.DocDetailsID))||(B=!0),i.e.IsEmpty(this.GridData[P].BinsXML)&&!B)return void(this.DisplayMessage=n.a.GetResource("Doc_BinsMissMatch")+" "+this.GridData[P].Sno.toString());var G=0;if(""!=this.GridData[P].BinsXML.toString()){var N=new i.f;N.LoadXml(this.GridData[P].BinsXML);for(var v=N.SelectNodes("BinsXML/Row"),M=0;M<v.length;M++)null!=v[M].attributes.Allocate.value&&""!=v[M].attributes.Allocate.value&&(G+=parseFloat(v[M].attributes.Allocate.value))}if(G!=parseFloat(this.GridData[P].Quantity)&&!B)return void(this.DisplayMessage=n.a.GetResource("Doc_BinsMissMatch")+" "+this.GridData[P].Sno.toString())}if(this.GridDataColumns.Contains("ToBinsXML")&&O&&parseFloat(this.GridData[P].Quantity)>0&&!this.Parent.ScreenObject.GridDataColumns.Contains("RecievedQty")&&this.Parent.ScreenObject.GridDataColumns.Contains("BinWise")&&"True"==this.drSel.BinWise.toString()&&this.Parent.IsWarehouseBinwise(this.Parent.ScreenObject.SelectedGridRowIndex,1,{DimensionID:0})){if(i.e.IsEmpty(this.GridData[P].ToBinsXML)&&!this.Parent.ScreenObject.GridDataColumns.Contains("BinStatus"))return void(this.DisplayMessage=n.a.GetResource("Doc_BinsMissMatch")+" "+this.GridData[P].Sno.toString());var j=0;if(""!=this.GridData[P].BinsXML.toString()){var V=new i.f;V.LoadXml(this.GridData[P].BinsXML);for(var A=V.SelectNodes("BinsXML/Row"),R=0;R<A.length;R++)null!=A[R].attributes.Allocate.value&&""!=A[R].attributes.Allocate.value&&(j+=parseFloat(A[R].attributes.Allocate.value))}if(j!=parseFloat(this.GridData[P].Quantity)&&!this.Parent.ScreenObject.GridDataColumns.Contains("BinStatus"))return void(this.DisplayMessage=n.a.GetResource("Doc_BinsMissMatch")+" "+this.GridData[P].Sno.toString())}}if(n.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=n.a.SessionManager.Preferences.DecimalsinQty){var w=T.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty);T=parseFloat(w)}if(T!=this.BatchQty&&!f)return void(this.DisplayMessage="Qty not equal");var E="";this.count=0;var Q=!1;this.Parent.ScreenObject.Preferences.ContainsKey("ConsBatch")&&"True"==this.Parent.ScreenObject.Preferences.ConsBatch&&(Q=!0);for(var L=0,F=function(a){if(!i.e.IsEmpty(t.GridData[a].BatchID)&&i.e.Double(t.GridData[a].Quantity)>0&&(t.count++,"AddEditDocumentViewModel"==t.Parent.ClassName||"POSDocumentViewModel"==t.Parent.ClassName)){var s=0;if(null!=t.drSel&&(s=t.drSelObj.Table.indexOf(t.drSel)),t.dvCombo=t.dvComboTable.filter((function(e){return e.BatchID==t.GridData[a].BatchID})),t.dvCombo.length>0&&(b=t.dvCombo[0].BATCHNUMBER.toString()),t.dvCombo=t.dvComboTable,i.e.IsEmpty(t.GridData[a].MfgDate)||(C=t.GridData[a].MfgDate.toString()),i.e.IsEmpty(t.GridData[a].ExpDate)||(y=t.GridData[a].ExpDate.toString()),Q&&1!=t.count||(E="",E+="<xml>"),E+="<Row ",E+=' ProductID="'+t.ProductID.toString()+'" ',E+=' BatchID="'+t.GridData[a].BatchID.toString()+'" ',E+=' Quantity="'+t.GridData[a].Quantity.toString()+'" ',"AddEditDocumentViewModel"==t.Parent.ClassName&&""!=t.VarFldName&&31==t.Parent.DocumentType||32==t.Parent.DocumentType?E+=' Hold="0" Release="'+t.GridData[a].Quantity.toString()+'" ':1==t.VoucherType?t.HoldRelease?(E+=' Hold="'+t.GridData[a].Hold.toString()+'" ',E+=' Release="'+t.GridData[a].Release.toString()+'" '):(E+=' Hold="0" ',E+=' Release="'+t.GridData[a].Quantity.toString()+'" '):-1!=t.VoucherType||t.ConsolidatedBatches||(E+=' RefInvID="'+t.GridData[a].RefInvID.toString()+'" '),Q&&(i.e.IsEmpty(t.GridData[a].DetID)?E+=' DocDetailsID="0" ':E+=' DocDetailsID="'+t.GridData[a].DetID.toString()+'" ',i.e.IsEmpty(t.GridData[a].LinkedID)?E+=' LinkedID="0" ':E+=' LinkedID="'+t.GridData[a].LinkedID.toString()+'" ',E+=' Seq="'+t.count+'" '),E+=" ></Row>",!Q){if(E+="</xml>",t.count>1){"AutoSaveScan"==e.toString()&&!i.e.IsEmpty(t.GridData[L].BalQty)&&!i.e.IsEmpty(t.GridData[L].Quantity)&&parseFloat(t.GridData[L].BalQty.toString())<=parseFloat(t.GridData[L].Quantity.toString())&&(t.Parent.ScreenObject.GridDataColumns.Contains("IsFullBatchScanned")||t.Parent.ScreenObject.GridDataColumns.push("IsFullBatchScanned"),t.drSelTable[s].IsFullBatchScanned="1"),s=s+t.count-1;for(var r=t.drSelObj.NewRow(),o=0;o<t.drSelObj.TableColumns.length;o++){var l=t.drSelObj.TableColumns[o];"IsFullBatchScanned"!=l&&(r[l]="DocDetailsID"==l||"TODocDetailsID"==l?0:t.drSel[l])}t.drSelObj.insertRowAt(r,s)}if(L=a,""!=t.VarFldName&&31==t.Parent.DocumentType||32==t.Parent.DocumentType){t.drSelObj.Table[s][t.VarFldName]=parseFloat(t.GridData[a].Quantity),t.drSelObj.Table[s].QOH=t.Parent.ScreenObject.GetBatchWiseQOH(t.ProductID.toString(),t.GridData[a].BatchID.toString(),t.drSelObj.Table[s]);var c=t.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&25398==e.LinkData}));c.length>0&&t.drSelObj.TableColumns.Contains(c[0].SysColumnName.toString())&&(t.drSelObj.Table[s][c[0].SysColumnName.toString()]=t.drSelObj.Table[s].QOH)}else i.e.Int(t.drSelObj.Table[s].SchemeID)>0&&"Y"==t.drSelObj.Table[s].IsScheme.toString()?(t.drSelObj.Table[s].FreeQTY=i.e.IsEmpty(t.drSelObj.Table[s].UOMConversion)?t.GridData[a].Quantity.toString():parseFloat(t.GridData[a].Quantity)/parseFloat(t.drSelObj.Table[s].UOMConversion),i.e.IsEmpty(t.drSelObj.Table[s].UOMConversion)||i.e.IsEmpty(t.drSelObj.Table[s].Quantity)||(t.drSelObj.Table[s].UOMConvertedQty=parseFloat(t.drSelObj.Table[s].Quantity)*parseFloat(t.drSelObj.Table[s].UOMConversion))):(t.drSelObj.Table[s].Quantity=i.e.IsEmpty(t.drSelObj.Table[s].UOMConversion)?t.GridData[a].Quantity.toString():parseFloat(t.GridData[a].Quantity)/parseFloat(t.drSelObj.Table[s].UOMConversion),i.e.IsEmpty(t.drSelObj.Table[s].UOMConversion)||i.e.IsEmpty(t.drSelObj.Table[s].Quantity)||(t.drSelObj.Table[s].UOMConvertedQty=parseFloat(t.drSelObj.Table[s].Quantity)*parseFloat(t.drSelObj.Table[s].UOMConversion)),38==t.Parent.DocumentType&&1==t.VoucherType&&(i.e.IsEmpty(t.drSelTable[s].UOMConvertedQty)||(t.drSelTable[s].UOMConvertedQty=-1*parseFloat(t.drSelTable[s].UOMConvertedQty)),i.e.IsEmpty(t.drSelTable[s].Quantity)||(t.drSelTable[s].Quantity=-1*parseFloat(t.drSelTable[s].Quantity))));if(t.drSelObj.Table[s].ExtraXML=E.toString(),t.GridDataColumns.Contains("BinsXML")&&("AddEditDocumentViewModel"==t.Parent.ClassName||"POSDocumentViewModel"==t.Parent.ClassName)&&t.drSelObj.TableColumns.Contains("BinWise")&&"True"==t.drSelObj.Table[s].BinWise.toString()){t.drSelObj.Table[s].BinsXML=t.GridData[a].BinsXML.toString();var d=t.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&55494==e.LinkData}));d.length>0&&t.drSelObj.TableColumns.Contains(d[0].SysColumnName.toString())&&(t.drSelObj.Table[s][d[0].SysColumnName.toString()]=t.GridData[a].strBins.toString())}var u;5==t.Parent.ScreenObject.DocumentType&&t.GridDataColumns.Contains("TOBinsXML")&&(t.drSelObj.Table[s].TOBinsXML=t.GridData[a].TOBinsXML.toString()),t.drSelObj.Table[s].MRate=t.GridData[a].MRate.toString(),t.drSelObj.Table[s].RRate=t.GridData[a].RRate.toString(),t.drSelObj.Table[s].SRate=t.GridData[a].SRate.toString();for(var h=function(e){if(t.drSelObj.TableColumns.Contains(t.dtmap[e].BaseCol.toString())&&t.GridDataColumns.Contains(t.dtmap[e].BatchCol.toString())&&!i.e.IsEmpty(t.GridData[a][t.dtmap[e].BatchCol.toString()]))if(t.drSelObj.DataTypes.Double.Contains(t.dtmap[e].BaseCol.toString()))i.e.IsNum(t.GridData[a][t.dtmap[e].BatchCol.toString()])&&(t.drSelObj.Table[s][t.dtmap[e].BaseCol.toString()]=t.GridData[a][t.dtmap[e].BatchCol.toString()].toString());else if(t.drSelObj.TableColumns.Contains(t.dtmap[e].BaseCol.toString()+"_key")&&t.drSelObj.DataTypes.Date.Contains(t.dtmap[e].BaseCol.toString()+"_key")){if(i.e.isValidDate(t.GridData[a][t.dtmap[e].BatchCol.toString()])){var r=new Date(t.GridData[a][t.dtmap[e].BatchCol.toString()]);t.drSelObj.Table[s][t.dtmap[e].BaseCol.toString()+"_key"]=r,t.drSelObj.Table[s][t.dtmap[e]["B=aseCol"].toString()]=r.ToString(n.a.SessionManager.Preferences["Date Format"])}}else t.drSelObj.DataTypes.Date.Contains(t.dtmap[e].BaseCol.toString())?i.e.isValidDate(t.GridData[a][t.dtmap[e].BatchCol.toString()])&&(t.drSelObj.Table[s][t.dtmap[e].BaseCol.toString()]=t.GridData[a][t.dtmap[e].BatchCol.toString()].toString()):t.dtmap[e].BaseCol.toString().toLowerCase().Contains("dcccnid")&&t.dtmap[e].BatchCol.toString().toLowerCase().Contains("ccnid")&&!i.e.IsEmpty(t.GridData[a][t.dtmap[e].BatchCol.toString()+"_Key"])?(t.drSelObj.Table[s][t.dtmap[e].BaseCol.toString()]=t.GridData[a][t.dtmap[e].BatchCol.toString()].toString(),t.drSelObj.Table[s][t.dtmap[e].BaseCol.toString()+"_Key"]=t.GridData[a][t.dtmap[e].BatchCol.toString()+"_Key"].toString(),(k=t.Parent.ScreenObject.ColumnSource.find((function(a){return!i.e.IsEmpty(a.ValueMember)&&a.ValueMember.toLowerCase()==t.dtmap[e].BaseCol.toString().toLowerCase()+"_key"})))&&((u=t.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&e.LocalReference==k.ID}))).length>0&&t.Parent.ScreenObject.GetLinkReferenceData(parseInt(k.ID),t.Parent.DocumentID,parseInt(t.drSelObj.Table[s][k.ValueMember]),Date.Today(),t.dtmap[e].BatchCol.toString(),k.CostCenterID,t.drSelObj.Table[s]))):t.drSelObj.Table[s][t.dtmap[e].BaseCol.toString()]=t.GridData[a][t.dtmap[e].BatchCol.toString()].toString()},D=0;D<t.dtmap.length;D++)h(D);(u=t.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&-100==e.LinkData}))).length>0&&t.drSelObj.TableColumns.Contains(u[0].SysColumnName.toString())&&(t.drSelObj.Table[s][u[0].SysColumnName.toString()]=b),(u=t.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&-101==e.LinkData}))).length>0&&t.drSelObj.TableColumns.Contains(u[0].SysColumnName.toString())&&(t.drSelObj.Table[s][u[0].SysColumnName.toString()]=C,t.drSelObj.TableColumns.Contains(u[0].SysColumnName.toString()+"_Key")&&t.drSelObj.DataTypes.Int.Contains(u[0].SysColumnName.toString()+"_Key")&&(t.dvCombo=t.dvComboTable.filter((function(e){return e.BatchID==t.GridData[a].BatchID})),null!=t.dvCombo&&t.dvCombo.length>0&&!i.e.IsEmpty(t.dvCombo[0].MfgDate)&&(t.drSelObj.Table[s][u[0].SysColumnName.toString()+"_Key"]=t.dvCombo[0].MfgDate.toString()))),(u=t.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&-102==e.LinkData}))).length>0&&t.drSelObj.TableColumns.Contains(u[0].SysColumnName.toString())&&(t.drSelObj.Table[s][u[0].SysColumnName.toString()]=y,t.drSelObj.TableColumns.Contains(u[0].SysColumnName.toString()+"_Key")&&t.drSelObj.DataTypes.Int.Contains(u[0].SysColumnName.toString()+"_Key")&&(t.dvCombo=t.dvComboTable.filter((function(e){return e.BatchID==t.GridData[a].BatchID})),null!=t.dvCombo&&t.dvCombo.length>0&&!i.e.IsEmpty(t.dvCombo[0].ExpiryDate)&&(t.drSelObj.Table[s][u[0].SysColumnName.toString()+"_Key"]=t.dvCombo[0].ExpiryDate.toString()))),(u=t.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&53737==e.LinkData}))).length>0&&t.drSelObj.TableColumns.Contains(u[0].SysColumnName.toString())&&(t.drSelObj.Table[s][u[0].SysColumnName.toString()]=t.GridData[a].MRate.toString()),(u=t.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&53738==e.LinkData}))).length>0&&t.drSelObj.TableColumns.Contains(u[0].SysColumnName.toString())&&(t.drSelObj.Table[s][u[0].SysColumnName.toString()]=t.GridData[a].RRate.toString()),(u=t.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&53739==e.LinkData}))).length>0&&t.drSelObj.TableColumns.Contains(u[0].SysColumnName.toString())&&(t.drSelObj.Table[s][u[0].SysColumnName.toString()]=t.GridData[a].SRate.toString()),t.Parent.CalculateTotals(t.drSelObj.Table[s],!1,"Quantity"),t.drSelObj.updateRow(t.drSelObj.Table[s])}}},_=0;_<this.GridData.length;_++){var k;F(_)}Q&&(E+="</xml>",this.drSel.ExtraXML=E.toString()),"AutoSave"!=e.toString()&&n.a.page.HideDialog()}else"Cancel"==e.toString()&&("AddEditDocumentViewModel"!=this.Parent.ClassName&&"POSDocumentViewModel"!=this.Parent.ClassName||(this.Parent.DialogResult=!1),n.a.page.HideDialog())}},{key:"GetCustomFieldsQuery",value:function(){for(var e,t="",a=0;a<=this.StaticFields.length;a++){var n=this.StaticFields[a];n instanceof c.c&&null!=n.DBColumnName&&n.DBColumnName.toLowerCase().Contains("alpha")&&(n instanceof o.d?(e=n.Text,i.e.IsEmpty(e)&&(e="",null),t+=n.DBColumnName+"=N'"+e.replace("'","''")+"',"):n instanceof o.c?(e=n.Text,i.e.IsEmpty(e)&&(e="",null),t+=n.DBColumnName+"=N'"+e.replace("&","&am;").replace("'","''")+"',"):n instanceof S.e?(e=n.SelectedValue,i.e.IsEmpty(e)&&(e=""),t+=n.DBColumnName+"='"+e.replace("&","&am;").replace("'","''")+"',"):n instanceof h.c?(e=n.Date?n.Date.ToString("dd/MMM/yyyy"):"",i.e.IsEmpty(e)&&(e=""),t+=n.DBColumnName+"='"+e+"',"):n instanceof h.a?(e=n.Date.ToString("dd/MMM/yyyy"),i.e.IsEmpty(e)&&(e=""),t+=n.DBColumnName+"='"+e+"',"):n instanceof C.a?(e=n.Text,i.e.IsEmpty(e)&&(e=""),t+=n.DBColumnName+"='"+e+"',"):n instanceof u.b&&(t+=n.DBColumnName+"='"+n.SelectedValue+"',"))}return t.toString()}},{key:"GetCustomCostCenterFieldsQuery",value:function(){for(var e="",t=[],a=0;a<this.StaticFields.length;a++){var s=this.StaticFields[a];if(s instanceof u.b&&(null!=s.DBColumnName&&s.DBColumnName.toLowerCase().Contains("ccnid")||null!=s.DBColumnName&&("accountid"==s.DBColumnName.toLowerCase()||"productid"==s.DBColumnName.toLowerCase()))){var r=s;0!=r.SelectedValue&&(e+=r.DBColumnName+"='"+r.SelectedValue+"',",t.push(r.CCID))}}if("AddEditDocumentViewModel"==this.Parent.ClassName||"POSDocumentViewModel"==this.Parent.ClassName){var o=0,l=!1;if(n.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise Batches")&&""!=n.a.SessionManager.Preferences["Maintain Dimensionwise Batches"].toString()&&((o=i.e.Int(n.a.SessionManager.Preferences["Maintain Dimensionwise Batches"]))>0&&!t.Contains(o))){for(var c=0;c<this.Parent.ScreenObject._CCFields.length;c++){var d=this.Parent.ScreenObject._CCFields[c];if(d instanceof u.b&&d.CCID==o){e+="CCNID"+(o-5e4)+"='"+d.SelectedValue+"',",t.push(o),l=!0;break}}l||null!=this.drSel&&o>5e4&&this.drSelObj.TableColumns.Contains("dcCCNID"+(o-5e4).toString()+"_Key")&&!i.e.IsEmpty(this.drSel["dcCCNID"+(o-5e4).toString()+"_Key"])&&(e+="CCNID"+(o-5e4)+"='"+this.drSel["dcCCNID"+(o-5e4).toString()+"_Key"].toString()+"',",t.push(o))}if(this.Parent.ScreenObject.Preferences.ContainsKey("BatchFilterDim")&&(l=!1,(o=i.e.Int(this.Parent.ScreenObject.Preferences.BatchFilterDim))>0&&!t.Contains(o)&&!e.toString().Contains("CCNID"+(o-5e4)+"="))){for(var h=0;h<this.Parent.ScreenObject._CCFields.length;h++){var D=this.Parent.ScreenObject._CCFields[h];if(D instanceof u.b&&D.CCID==o){D.SelectedValue>0&&(e+="CCNID"+(o-5e4)+"='"+D.SelectedValue+"',",t.push(o)),l=!0;break}}l||null!=this.drSel&&o>5e4&&this.drSelObj.TableColumns.Contains("dcCCNID"+(o-5e4).toString()+"_Key")&&!i.e.IsEmpty(this.drSel["dcCCNID"+(o-5e4).toString()+"_Key"])&&(e+="CCNID"+(o-5e4)+"='"+this.drSel["dcCCNID"+(o-5e4).toString()+"_Key"].toString()+"',",t.push(o))}!e.toString().Contains("CCNID2=")&&!t.Contains(50002)&&this.Loc>0&&(e+="CCNID2='"+this.Loc+"',"),!e.toString().Contains("CCNID1=")&&!t.Contains(50001)&&this.Div>0&&(e+="CCNID1='"+this.Div+"',")}return e.toString()}},{key:"FillBatchtoDt",value:function(e){var t=this.batches.filter((function(t){return t.ProductID==e}));if(t.length>0){var a=0,n="";n+="<xml>";for(var s=0;s<this.GridData.length;s++)!i.e.IsEmpty(this.GridData[s].BatchID)&&i.e.Double(this.GridData[s].Quantity)>0&&(a++,n+="<Row ",n+=' BatchID="'+this.GridData[s].BatchID.toString()+'" ',n+=' Quantity="'+this.GridData[s].Quantity.toString()+'" ',this.ConsolidatedBatches||(n+=' RefInvID="'+this.GridData[s].RefInvID.toString()+'" '),n+=' Hold="0" ',n+=' Release="0" ',n+=" ></Row>");n+="</xml>",a>0&&(t[0].Batch=n.toString())}}},{key:"SaveWO",value:function(){var e=this;if(null!=this.SelectedProd&&""!=this.SelectedProd&&this.FillBatchtoDt(parseInt(this.SelectedProd)),this.CheckAll()){this.Parent.dtbatches=this.batches,this.Parent.DialogResult=!0;for(var t,a="",s=0,r=0,l=function(t){var n=0,l=0;if(!i.e.IsEmpty(e.Parent.MaterialGridData[t].ProductName_Key)&&i.e.Double(e.Parent.MaterialGridData[t].QTY)>0){s=0,r=0;var c=e.batches.filter((function(a){return a.ProductID==e.Parent.MaterialGridData[t].ProductName_Key})),d=new i.f,h=null;c.length>0&&!i.e.IsEmpty(c[0].Batch)&&(d.LoadXml(c[0].Batch),h=d.SelectNodes("xml/Row"),s=h.length);do{r++,(l=null!=h&&h.length>r-1?parseFloat(h[r-1].attributes.Quantity.value):parseFloat(e.Parent.MaterialGridData[t].QTY))>0&&function(){var s=0;i.e.IsNum(e.Parent.MaterialGridData[t].Wastage)&&(s=l*parseFloat(e.Parent.MaterialGridData[t].Wastage)/100),e.Parent.Parent.deductWaisatge?l-=s:e.Parent.Parent.AddWaistage&&(l+=s),a+="\x11",a+="<Row><Transactions ",a+=' DocDetailsID="0" ',a+=' ProductID="'+e.Parent.MaterialGridData[t].ProductName_Key+'" ',a+=' Quantity="'+l+'" ',i.e.Double(e.Parent.MaterialGridData[t].UnitPrice),a+=' Rate="'+e.Parent.MaterialGridData[t].UnitPrice+'" ',a+=' Unit="'+e.Parent.MaterialGridData[t].UOMID+'" ',i.e.IsEmpty(e.Parent.MaterialGridData[t].UnitPrice)?(a+=' Gross="0" ',a+=' StockValue="0" '):(n=parseFloat(e.Parent.MaterialGridData[t].UnitPrice)*l,a+=' Gross="'+n+'" ',a+=' StockValue="'+n+'" '),a+='AverageRate="'+e.Parent.MaterialGridData[t].AvgRate.toString()+'" ',a+=' IsQtyIgnored="0" ';for(var r=e.Parent.Parent.objMO.GetLinkReferenceData(e.Parent.Parent.IssProdCOlID,e.Parent.Parent.IssCCID,parseInt(e.Parent.MaterialGridData[t].ProductName_Key),e.Parent.ActionDate.Date,e.Parent.Parent.IssDr),c=" ",d=" ",D=0;D<r.Tables[0].Columns.length;D++)r.Tables[0].Columns[D].toLowerCase().Contains("dcalpha")&&(c+=r.Tables[0].Columns[D]+"=N'"+o.d.GetValidTextXml(r.Tables[0][0][r.Tables[0].Columns[D]].toString())+"', "),r.Tables[0].Columns[D].toUpperCase().Contains("CCNID")&&!i.e.IsEmpty(r.Tables[0][0][r.Tables[0].Columns[D]])&&i.e.IsDigit(r.Tables[0].Columns[D].ToCharArray().Last())&&(d+=r.Tables[0].Columns[D]+"="+r.Tables[0][0][r.Tables[0].Columns[D]].toString()+", ");if(e.Parent.Location.SelectedValue>0&&!d.Contains("dcCCNID2=")&&(d+=" dcCCNID2="+e.Parent.Location.toString()+", "),e.Parent.Parent.ScreenObject.CustomTab.Pages.forEach((function(e){e.Fields.forEach((function(e){e instanceof u.b&&null!=e.DBColumnName&&0!=e.SelectedValue&&e.DBColumnName.toLowerCase().Contains("ccnid")&&!d.toLowerCase().Contains("dc"+e.DBColumnName.toLowerCase()+"=")&&(d+="dc"+e.DBColumnName+" ="+e.SelectedValue.toString()+", ")}))})),a+=' DocSeqNo="'+(t*e.count).toString()+'" ',a+="/> <Numeric /> <Alpha "+c+' /> <CostCenters Query="'+d+'" />',null!=h&&h.length>e.count-1&&(a+="<EXTRAXML><xml>"+h[e.count-1].OuterXml+"</xml></EXTRAXML>"),null!=e.Parent.Parent.IssProdCol){var m=e.Parent.GetAccountsXML(parseInt(e.Parent.MaterialGridData[t].ProductName_Key),n.toString(),e.Parent.Parent.IssProdCol,e.Parent.Parent.IssDr,e.Parent.Parent.IssCr);""!=m&&(a+="<AccountsXML>"+m+"</AccountsXML>")}a+=" </Row>"}()}while(r<s)}},c=0;c<this.Parent.MaterialGridData.length;c++)l(c);(t=this.Parent.IssueWo(a.toString(),this.BillNO))>0&&(this.Parent.SetWos(t),this.Parent.this.Parent.OnSave("NoValidation"),this.Parent.LoadBomDetails(this.Parent.Parent.SelectedWO),n.a.page.HideDialog())}}},{key:"CheckAll",value:function(){for(var e=0;e<this.batches.length;e++){if(i.e.IsEmpty(this.batches[e].Batch))return this.DisplayMessage="Batches not defined for "+this.batches[e].ProductName.toString(),!1;var t=new i.f;t.LoadXml(this.batches[e].Batch);for(var a=t.SelectNodes("xml/Row"),s=0,r=0,o=0;o<a.length;o++)s+=r=i.e.Double(a[o].attributes.Quantity.value);if(r=i.e.Double(this.batches[e].QTY),n.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=n.a.SessionManager.Preferences.DecimalsinQty){var l=r.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty);if(r=parseFloat(l),l=s.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty),r!=(s=parseFloat(l)))return this.DisplayMessage="Qty not equal for "+this.batches[e].ProductName.toString(),!1}else if(r!=s)return this.DisplayMessage="Qty not equal for "+this.batches[e].ProductName.toString(),!1}return!0}},{key:"ProdSelected",value:function(){var e=this,t=null!=this.SelectedProd?this.batches.filter((function(t){return t.ProductID==e.SelectedProd})):[];if(t.length>0){if(this.GridData.Clear(),this.BatchQty=parseFloat(t[0].QTY),n.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=n.a.SessionManager.Preferences.DecimalsinQty){var a=this.BatchQty.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty);this.BatchQty=parseFloat(a)}this.ProdName=t[0].ProductName.toString(),this.ProductID=parseInt(this.SelectedProd);var s=0;"AddEditDocumentViewModel"!=this.Parent.ClassName&&"POSDocumentViewModel"!=this.Parent.ClassName||(s=this.Parent.CostCenterID);var r=(new p).GetProductwiseBatches(this.ProductID,this.DocDetailsId,this.DocId,this.VoucherType,this.docdate,this.Div,this.Loc,s,-1,-1);if(r.Tables.length>1&&null!=this.ColumnSource&&this.ColumnSource.length>1&&(this.ColumnSource[1].ComboData=r.Tables[0],this.dvCombo=r.Tables[0],this.dvComboTable=r.Tables[0],this.dvComboColumns=r.Columns[0]),this.RefreshGrid=!this.RefreshGrid,r.Tables.length>0&&!r.Columns[0].Contains("ErrorMessage")&&null!=this.ColumnSource&&this.ColumnSource.length>1)for(var o=0;o<r.Tables[0].length;o++){var l=this.GridDataObj.NewRow();l.Sno=o+1,this.ConsolidatedBatches||(l.RefInvID=r.Tables[0][o].InvDocDetailsID.toString()),l.BatchID=r.Tables[0][o].BatchID.toString(),i.e.isValidDate(r.Tables[0][o].MfgDate)&&(l.MfgDate=new Date(r.Tables[0][o].MfgDate).ToString(n.a.SessionManager.Preferences["Date Format"])),i.e.isValidDate(r.Tables[0][o].ExpiryDate)&&(l.ExpDate=new Date(r.Tables[0][o].ExpiryDate).ToString(n.a.SessionManager.Preferences["Date Format"])),i.e.Double(r.Tables[0][o].BalQty)&&(l.BalQty=r.Tables[0][o].BalQty.toString()),i.e.Double(r.Tables[0][o].MRate)&&(l.MRate=r.Tables[0][o].MRate.toString()),i.e.Double(r.Tables[0][o].RRate)&&(l.RRate=r.Tables[0][o].RRate.toString()),i.e.Double(r.Tables[0][o].SRate)&&(l.SRate=r.Tables[0][o].SRate.toString()),this.GridDataObj.addRow(l)}this.InvQty=0,i.e.IsEmpty(t[0].Batch)||function(){var a=new i.f;a.LoadXml(t[0].Batch);for(var n=a.SelectNodes("xml/Row"),s=function(t){var a=e.GridData.filter((function(e){return e.BatchID==n[t].attributes.BatchID.value}));if(e.ConsolidatedBatches||""==n[t].attributes.RefInvID.value||(a=e.GridData.filter((function(e){return e.RefInvID==n[t].attributes.RefInvID.value}))),a.length>0){0;var s=i.e.Double(n[t].attributes.Quantity.value);a[0].Quantity=s,e.GridDataColumns.Contains("QtyUom")&&(a[0].QtyUom=i.e.IsEmpty(a[0].Quantity)?0:parseFloat(a[0].Quantity)/e.UomConversion),e.InvQty+=s}},r=0;r<n.length;r++)s(r)}(),this.QtyAddMessage=i.e.Format(n.a.GetResource("BatchNo_AddMessage"),this.InvQty.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty),this.BatchQty.toString(),this.ProdName.toString()),this.FillEmptyRows()}else this.QtyAddMessage=""}},{key:"AdjusFifo",value:function(e){var t=this.BatchQty;if(e){for(var a=0;a<this.GridData.length;a++)if(!i.e.IsEmpty(this.GridData[a].BatchID)){var s=i.e.Double(this.GridData[a].BalQty),r=s.toString();this.GridDataColumns.Contains("QOH")&&null!=this.GridData[a].QOH&&parseFloat(this.GridData[a].QOH.toString())&&s>void 0&&(s=void 0),n.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=n.a.SessionManager.Preferences.DecimalsinQty&&(r=s.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty)),t>=(s=parseFloat(r))?(this.GridData[a].Quantity=s,this.GridDataColumns.Contains("BinsXML")&&this.Parent.ScreenObject.Preferences.ContainsKey("AutoSelectBins")&&"true"==this.Parent.ScreenObject.Preferences.AutoSelectBins.toLowerCase()&&(this.Setselectedrow(a),this.onBinCLick("Auto")),t-=s):(this.GridData[a].Quantity=t,this.GridDataColumns.Contains("BinsXML")&&this.Parent.ScreenObject.Preferences.ContainsKey("AutoSelectBins")&&"true"==this.Parent.ScreenObject.Preferences.AutoSelectBins.toLowerCase()&&(this.Setselectedrow(a),this.onBinCLick("Auto")),t=0),this.GridDataColumns.Contains("QtyUom")&&(this.GridData[a].QtyUom=i.e.IsEmpty(this.GridData[a].Quantity)?0:parseFloat(this.GridData[a].Quantity)/this.UomConversion)}}else for(var o=0;o<this.GridData.length;o++)i.e.IsEmpty(this.GridData[o].BatchID)||(this.GridData[o].Quantity=0),this.GridDataColumns.Contains("QtyUom")&&(this.GridData[o].QtyUom=0);this.GridDataObj.gridObj&&this.GridDataObj.gridObj.invalidate(),t=this.BatchQty-t,this.QtyAddMessage=i.e.Format(n.a.GetResource("BatchNo_AddMessage"),t.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty),this.BatchQty.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty),this.ProdName.toString())}},{key:"Setselectedrow",value:function(e){this.GridDataObj.SelectedItem=this.GridData[e]}},{key:"AdjusFifoAll",value:function(){if(null!=this.batches){for(var e=this.SelectedProd,t=0;t<this.batches.length;t++)this.SelectedProd=this.batches[t].ProductID.toString(),this.AdjusFifo(this.ChkFifoAll);this.SelectedProd=e}}},{key:"ResetBatchNo",value:function(e){var t,n=this;if(null!=this.StaticFields)for(var s=0;s<this.StaticFields.length;s++){var r=this.StaticFields[s];r instanceof c.c&&(r instanceof o.d?r.Text=""!=r.DefaultValue?r.DefaultValue:"":r instanceof S.e?r.SelectedValue="":r instanceof o.c?r.Text="":r instanceof h.b?r.Date=null:r instanceof h.c?("SYSDATE"==r.DefaultValue&&i.e.isValidDate(this.Parent.fldDict.ServerDate.fieldResult)?r.Date=new Date(this.Parent.fldDict.ServerDate.fieldResult):"TODAY"==r.DefaultValue?r.Date=Date.Today():"DOCDATE"!=r.DefaultValue||"AddEditDocumentViewModel"!=this.Parent.ClassName&&"POSDocumentViewModel"!=this.Parent.ClassName?"ExpiryDate"==r.DBColumnName&&this.ShelfLife>0||(r.Date=null):r.Date=this.Parent.DocumentDate,"MfgDate"==r.DBColumnName&&this.OnDateChanged(r)):r instanceof h.a?(r.Date="SYSDATE"==r.DefaultValue&&i.e.isValidDate(this.Parent.fldDict.ServerDate.fieldResult)?new Date(this.Parent.fldDict.ServerDate.fieldResult):"DOCDATE"!=r.DefaultValue||"AddEditDocumentViewModel"!=this.Parent.ClassName&&"POSDocumentViewModel"!=this.Parent.ClassName?Date.Today():this.Parent.DocumentDate,"MfgDate"==r.DBColumnName&&this.OnDateChanged(r)):r instanceof C.a?r.Text="":r instanceof u.b?r.SelectedValue=!i.e.IsEmpty(r.DefaultValue)&&i.e.IsNum(r.DefaultValue)?parseInt(r.DefaultValue):0:r instanceof o.a&&(r.Text="",r.SuffixCode="",r.PrefixCode="",null!=this.ControlGen&&this.ControlGen.IsAutoCode&&null!=this.BatchCode&&(this.objBatch.BatchGroup=1,this.ControlGen.SetAutoCode(this.BatchCode,this.objBatch.IsGroup,this.objBatch.BatchGroup,this.dsBatch.Tables[6]))))}if(this.BatchNo.Text="",null!=this.txtqty){0==e&&this.NextSeq++;for(var l=this.NextSeq.toString();l.length<this.Seqlen;)l="0"+l;if(this.BatchNo.Text=this.BNO.replace("#SEQ#",l),this.Parent.ScreenObject.Preferences.ContainsKey("AutoPopulateBatchQty")&&"true"==this.Parent.ScreenObject.Preferences.AutoPopulateBatchQty.toLowerCase()){var d=0,D=this.GridData.Compute("sum","Quantity");null!=D&&(d=i.e.Double(D)),d=this.BatchQty-d,this.txtqty.Text=d.toString()}else this.txtqty.Text=""}(this.IsBatchSeqNoExists=!1,this.AutoGenerateBatches)&&function(){var e,s,r,l="";if(null!=n.xBatchDef){var c=null,d=null;"AddEditDocumentViewModel"!=n.Parent.ClassName&&"POSDocumentViewModel"!=n.Parent.ClassName&&"POSDocumentViewModel"!=n.Parent.ClassName||null!=(d=n.Parent).SelectedRow&&(c=d.SelectedRow);for(var u=0;u<n.xBatchDef.DocumentElement.children.length;u++){var D=n.xBatchDef.DocumentElement.children[u];if("SEQUENCE_NO"==(e=D.attributes.Name.value.toUpperCase()))if(n.IsBatchSeqNoExists=!0,s=(new p).GetNextBatchSeqNo(),(r=i.e.Int(D.attributes.ColumnWidth.value))>0){for(var m=r-s.toString().length;m>0;m--)l+="0";l+=s}else l+=s.toString();else if("CUSTOM_TEXT"==e)l+=D.attributes.ColumnWidth.value;else if("DOCDATE"==e)l+=a.GetDateString(n.docdate,D.attributes.ColumnWidth.value);else if(null!=c&&d.ScreenObject.GridDataObj.TableColumns.Contains(e)){var b=c[e].toString();l+=(r=i.e.Int(D.attributes.ColumnWidth.value))>0&&r<b.length?b.substr(0,r):b}else if(null!=d&&((t=d.ScreenObject._TextFields.find((function(t){return t.DBColumnName.toLowerCase()==e.toLowerCase()})))||(t=d.ScreenObject._StaticFields.find((function(t){return t.DBColumnName.toLowerCase()==e.toLowerCase()}))),t))if("DATE"==D.attributes.Type.value.toUpperCase()){if(t instanceof h.c){var S=t.Date;null!=S&&(l+=a.GetDateString(S,D.attributes.ColumnWidth.value))}}else{r=i.e.Int(D.attributes.ColumnWidth.value);var C="";t instanceof o.d&&(C=t.Text),null!=C&&(l+=r>0&&r<C.length?C.substr(0,r):C)}l+=D.attributes.Delimiter.value}}0==l.length&&(n.IsBatchSeqNoExists=!0,l=(new p).GetNextBatchSeqNo().toString()),n.BatchNo.Text=l}()}},{key:"SelectedProd",get:function(){return this._SelectedProd},set:function(e){e!=this._SelectedProd&&(null!=this._SelectedProd&&""!=this._SelectedProd&&this.FillBatchtoDt(parseInt(this._SelectedProd)),this._SelectedProd=e,this.ProdSelected())}},{key:"SortBatchGrid",get:function(){return this._SortBatchGrid},set:function(e){!0===e&&(this.GridDataObj.RefreshGrid=!0,this.GridDataObj.RefreshGridView()),this._SortBatchGrid=e}},{key:"ChkFifo",get:function(){return this._ChkFifo},set:function(e){e!=this._ChkFifo&&(this._ChkFifo=e,this.AdjusFifo(e))}},{key:"ChkFifoAll",get:function(){return this._ChkFifoAll},set:function(e){e!=this._ChkFifoAll&&(this._ChkFifoAll=e,this.AdjusFifoAll())}},{key:"ScreenObject",get:function(){return this.ControlGen},set:function(e){this.ControlGen=e}},{key:"RefreshGrid",set:function(e){}},{key:"CanRemove",get:function(){return null!=this.SelectedRow}},{key:"GridData",get:function(){return this.GridDataObj.Table}},{key:"GridDataColumns",get:function(){return this.GridDataObj.TableColumns}},{key:"ColumnSource",get:function(){return this.GridDataObj.Columns}},{key:"SelectedRow",get:function(){return this.GridDataObj.SelectedItem},set:function(e){this.GridDataObj.SelectedItem=e}}],[{key:"GetDateString",value:function(e,t){return"Y"==t?e.getFullYear().toString().substr(3):"YY"==t?e.getFullYear().toString().substr(2):"YYYY"==t?e.getFullYear().toString():"Name"==t?e.ToString("MMMM"):"MMM"==t?e.ToString("MMM"):"MM"==t?e.getMonth().PrefixZero(2):"DD"==t?e.getDate().PrefixZero(2):""}}]),a}(r.b),p=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"GetBatchDefn",value:function(e){return n.a.common.GetDataSet("INV001",e.toString()).Tables[0]}},{key:"GetNextBatchSeqNo",value:function(){return n.a.common.GetDataSet("INV002","").Tables[0][0].SeqNo}},{key:"GetProductwiseBatches",value:function(e,t,a,i,r,o,l,c,d,u){var h=[];return h.push(e),h.push(t),h.push(a),h.push(i),h.push(r.ToString("dd/MMM/yyyy")),n.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&Object(s.j)(n.a.SessionManager.Preferences.EnableDivisionWise)&&n.a.SessionManager.Preferences.ContainsKey("DW Batches")&&Object(s.j)(n.a.SessionManager.Preferences["DW Batches"])?h.push(o):h.push(0),n.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&Object(s.j)(n.a.SessionManager.Preferences.EnableLocationWise)&&n.a.SessionManager.Preferences.ContainsKey("LW Batches")&&Object(s.j)(n.a.SessionManager.Preferences["LW Batches"])?h.push(l):h.push(0),h.push(c),h.push(d),h.push(u),h.push(n.a.SessionManager.UserID),h.push(n.a.SessionManager.RoleID),h.push(n.a.SessionManager.LangID),n.a.document.GetTempBatches(h)}}],[{key:"QuickAddBatch",value:function(e,t,a){var s=[];return s.push(e.BatchID),s.push(a),s.AddRange(t),s.push(e.IsGroup),s.push(e.StaticFieldsQuery),s.push(e.CustomFieldsQuery),s.push(e.CustomCostCenterFieldsQuery),s.push(i.e.String(e.BatchCode)),s.push(i.e.String(e.CodePrefix)),s.push(e.CodeNumber),s.push(n.a.SessionManager.CompanyGUID),null==e.GUID&&(e.GUID=""),s.push(e.GUID),s.push(n.a.SessionManager.UserName),s.push(n.a.SessionManager.UserID),s.push(n.a.SessionManager.RoleID),s.push(n.a.SessionManager.LanguageID),n.a.inventory.SetQuickBatch(s)}},{key:"QuickAddBatchMultple",value:function(e,t,a){var s=[];return s.push(e.BatchID),s.push(a),s.AddRange(t),s.push(e.IsGroup),s.push(e.StaticFieldsQuery),s.push(e.CustomFieldsQuery),s.push(e.CustomCostCenterFieldsQuery),s.push(i.e.String(e.BatchCode)),s.push(i.e.String(e.CodePrefix)),s.push(e.CodeNumber),s.push(n.a.SessionManager.CompanyGUID),null==e.GUID&&(e.GUID=""),s.push(e.GUID),s.push(n.a.SessionManager.UserName),s.push(n.a.SessionManager.UserID),s.push(n.a.SessionManager.RoleID),s.push(n.a.SessionManager.LanguageID),n.a.inventory.SetQuickBatchMumtiple(s)}}]),e}()},Z9XZ:function(e,t,a){"use strict";a.r(t),a.d(t,"ShowJVViewModel",(function(){return S}));var n=a("Do2H"),i=a("Lp6j"),s=a("eQJW"),r=a("ScVY"),o=a("EQd/"),l=a("8B8H"),c=a("ockk"),d=a("0/4Q"),u=a("n56n"),h=a("Huqd"),D=a("HNy5"),m=a("7eIC"),b=a("R1nY"),S=function(e){_inherits(a,e);var t=_createSuper(a);function a(){var e;return _classCallCheck(this,a),(e=t.call(this)).AddVisible=!1,e.IsPopup=!0,e.MapVisible=!1,e.okVisible=!1,e.Amount=new o.d(0),e.AccountName=new o.d(0),e.JVGrid=new l.a,e.colname="",e.decimalpoints="2",e.StrCC="",e.AccountID=0,e.parent=null,e.Type=0,e.currencyid=1,e.TotAmt=0,e.exchrate=1,e.Mdeci=2,e.Name=new o.d(0),e.Profile=new d.e(0),e.Amount.Visible=!1,e.AccountName.Visible=!1,e}return _createClass(a,[{key:"ShowJVViewModel_1",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.parent=e,this.Type=a,"pdcGenerateChequeViewModel"==this.parent.ClassName&&(this.Title="Distribute"),this.JVGrid.Columns=[],this.JVGrid.Table=[],this.JVGrid.Height=200,this.JVGrid.Width="500",4==a?this.InitQtyAdjGrid():"pdcGenerateChequeViewModel"==this.parent.ClassName?this.FillGenerateCheques():this.FillGridCols(t,e)}},{key:"PrefGrid",value:function(){this.JVGrid.Height=200,this.JVGrid.Width="800",this.okVisible=!0,this.JVGrid.TableColumns.push("Sno"),this.JVGrid.TableColumns.push("CostCenterId"),this.JVGrid.TableColumns.push("NodeName"),this.JVGrid.TableColumns.push("NodeID"),this.JVGrid.TableColumns.push("Imagefilepath"),this.JVGrid.TableColumns.push("ImageFile"),this.JVGrid.TableColumns.push("ActualFileName"),this.JVGrid.TableColumns.push("FilePath"),this.JVGrid.TableColumns.push("IsModified"),this.JVGrid.TableColumns.push("FileExtension"),this.JVGrid.TableColumns.push("DisplayText"),this.JVGrid.TableColumns.push("GUID"),this.JVGrid.TableColumns.push("RemImg"),this.JVGrid.CanUserDeleteRows=!0,this.JVGrid.CanUserAddRows=!0,this.JVGrid.OnLinkClick.Subscribe(this,"OnGridLinkClick"),this.JVGrid.BeginEdit.Subscribe(this,"BeginningEditEvent");var e=new c.a;e.Header="Sno",e.Width=50,e.DisplayMember="Sno",e.ReadOnly=!0,this.JVGrid.Columns.push(e),(e=new c.a).Header="Dimension",e.ValueBinding="CostCenterId",e.DataType="ComboBox",e.DisplayMember="Name",e.ValueMember="Value",e.Width=100,e.ComboData=[],this.JVGrid.Columns.push(e),(e=new c.a).Header="Data",e.DataType="LISTBOX",e.DisplayMember="NodeName",e.ValueMember="NodeID",e.TypeID=1,e.Width=150,this.JVGrid.Columns.push(e),(e=new c.a).Header="Text",e.Width=100,e.DisplayMember="DisplayText",this.JVGrid.Columns.push(e),(e=new c.a).Header=n.a.GetResource("Image"),e.DisplayMember="Imagefilepath",e.DataType="IMAGE_BUTTON",e.Width=60,e.ReadOnly=!0,this.JVGrid.Columns.push(e),(e=new c.a).Header=n.a.GetResource("Com_Attachments_FileName"),e.DisplayMember="ActualFileName",e.DataType="LINK",e.Width=130,e.ReadOnly=!0,this.JVGrid.Columns.push(e),(e=new c.a).Header=n.a.GetResource("Select_Image"),e.DisplayMember="ImageFile",e.DataType="LINK",e.Width=100,e.ReadOnly=!0,this.JVGrid.Columns.push(e),(e=new c.a).Header="Remove",e.DisplayMember="RemImg",e.DataType="LINK",e.Width=100,e.ReadOnly=!0,this.JVGrid.Columns.push(e)}},{key:"BeginningEditEvent",value:function(e){}},{key:"OnGridLinkClick",value:function(e,t,a){}},{key:"onClick",value:function(e){}},{key:"OpenImage",value:function(e){}},{key:"FillGenerateCheques",value:function(){this.JVGrid.OnCellEditEnding.Subscribe(this,"OnGridCellEditEnding"),this.okVisible=!0;var e=new c.a;e.Width=150,e.DisplayMember="Date",e.Header="Date",e.ReadOnly=!0,this.JVGrid.Columns.push(e),(e=new c.a).Width=200,e.DataType="FLOAT",e.DisplayMember="Amount",e.Header="Amount",this.JVGrid.Columns.push(e),this.JVGrid.TableColumns.push("Amount"),this.JVGrid.TableColumns.push("Date_Key"),this.JVGrid.TableColumns.push("Date"),(e=this.parent.parent.ScreenObject.ColumnSource.find((function(e){return"amount"==e.DisplayMember.toLowerCase()})))&&""!=e.DecimalPoints&&(this.Mdeci=parseInt(e.DecimalPoints));var t=this.parent.GrBody.SelectedItem,a=this.parent.CheqStartDate.Date,s=new i.f;""!=t.Detailsxml.toString()&&s.ReadXml(t.Detailsxml);var r=0;null!=this.parent.Repeat.SelectedValue&&""!=this.parent.Repeat.SelectedValue&&parseInt(this.parent.Repeat.SelectedValue)>0&&parseInt(this.parent.Repeat.SelectedValue);var o=0,l=0,d=parseFloat(this.parent.Amount.Text)/(this.parent.CheqEndDate.Date.Subtract(this.parent.CheqStartDate.Date).Days+1);"1"==this.parent.Repeat.SelectedValue&&(l=this.parent.CalculateMonths()>0?i.e.Round(parseFloat(this.parent.Amount.Text)/this.parent.CalculateMonths(),this.Mdeci):parseFloat(this.parent.Amount.Text));for(var u=0,h=0;a<=this.parent.CheqEndDate.Date;){o+=r=0==u?a.getMonth()==this.parent.CheqEndDate.Date.Month&&a.getFullYear()==this.parent.CheqEndDate.Date.Year?parseFloat(this.Amount.Text):1==a.getDate()?"1"==this.parent.Repeat.SelectedValue?l:i.e.Round(d*a.DaysInMonth(),this.Mdeci):i.e.Round(d*(a.DaysInMonth()-a.getDate()+1),this.Mdeci):a.AddMonths(1)>this.parent.CheqEndDate.Date?parseFloat(this.parent.Amount.Text)-o:"1"==this.parent.Repeat.SelectedValue?l:i.e.Round(d*a.DaysInMonth(),this.Mdeci);var D=this.JVGrid.NewRow();D.Date=a.ToString(n.a.SessionManager.Preferences["Date Format"]),D.Date_Key=a,D.Amount=s.Tables.length>0&&s.Columns[0].Contains("Amount")&&s.Tables[0].length>u?s.Tables[0][u].Amount.toString():i.e.Round(r*parseFloat(t.Percentage.toString())/100,this.Mdeci),a=0==u?a.AddDays(a.DaysInMonth()-a.getDate()+1):a.AddMonths(1),this.JVGrid.Table.push(D),""!=D.Amount.toString()&&(h+=parseFloat(D.Amount.toString())),u++}this.JVGrid.Columns[1].footer=h.ToString("N"+this.Mdeci),this.JVGrid.UpdateFooter()}},{key:"FillGridCols",value:function(e,t){}},{key:"ShowJVViewModel_2",value:function(e,t,a){this.okVisible=!0,e.ScreenObject.Preferences.ContainsKey("DecimalsBillWise")&&""!=e.ScreenObject.Preferences.DecimalsBillWise&&i.e.IntTryParse(e.ScreenObject.Preferences.DecimalsBillWise)>0?this.decimalpoints=e.ScreenObject.Preferences.DecimalsBillWise:n.a.SessionManager.Preferences.ContainsKey("DecimalsinAmount")&&(this.decimalpoints=n.a.SessionManager.Preferences.DecimalsinAmount),this.parent=e,this.Type=a,this.colname=t,7==this.Type?this.InitDistGrid(e):1==this.Type||2==this.Type?this.InitArAPGrid(e):this.InitPostingGrid(e),5==a&&this.FillProfiles()}},{key:"ShowJVViewModel_4",value:function(){this.IsPopup=!1,this.okVisible=!0,this.MapVisible=!0,n.a.SessionManager.Preferences.ContainsKey("DecimalsinAmount")&&(this.decimalpoints=n.a.SessionManager.Preferences.DecimalsinAmount),this.InitPostingGrid(null),this.FillProfiles(),this.JVGrid.SearchVisible=!0,this.JVGrid.AddSearchCols(),this.DisplayName=this.Title}},{key:"ShowJVViewModel_5",value:function(e){this.Type=e,this.IsPopup=!1,this.okVisible=!0,this.Profile.Visible=!1,this.Name.Visible=!1,n.a.SessionManager.Preferences.ContainsKey("DecimalsinAmount")&&(this.decimalpoints=n.a.SessionManager.Preferences.DecimalsinAmount),this.InitMapGrid(),this.JVGrid.SearchVisible=!0,this.JVGrid.AddSearchCols(),this.DisplayName=this.Title}},{key:"FillProfiles",value:function(){var e=this;this.Profile.Visible=!0,this.Name.Visible=5!=this.Type,this.Profile.Items.Clear();var t=n.a.admin.GetAndDeleteDistCosts(0,1);5!=this.Type&&this.Profile.Items.push(d.d.ComboBoxItems_2("New","-1")),null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&t.Tables[0].forEach((function(t){0==e.Profile.Items.filter((function(e){return e.Value==t.ProfileID.toString()})).length&&e.Profile.Items.push(d.d.ComboBoxItems_2(t.ProfileName.toString(),t.ProfileID.toString()))}))}},{key:"InitQtyAdjGrid",value:function(){this.JVGrid.CanUserAddRows=!1,this.JVGrid.CanUserDeleteRows=!1,this.JVGrid.CanUserResizeColumns=!0}},{key:"InitMapGrid",value:function(){var e,t=this;this.Title="Map Distribute Cost",this.JVGrid.Columns=[],this.JVGrid.Table=[],this.JVGrid.Height=150,this.JVGrid.CanUserAddRows=!0,this.JVGrid.OnCellEditEnding.Subscribe(this,"OnGridCellEditEnding");var a=n.a.admin.GetfeatureNames(n.a.SessionManager.Preferences.CostBasedONDims);if(n.a.SessionManager.Preferences.CostBasedONDims.split(","),null!=a&&a.Tables.length>0&&a.Columns[0].Contains("Name")&&a.Tables[0].length>0)for(var s=0;s<a.Tables[0].length;s++){e=new c.a;var r=parseInt(a.Tables[0][s].FeatureID);e.Header=a.Tables[0][s].Name.toString(),e.Width=150,e.DataType="LISTBOX",e.CostCenterID=r,e.TypeID=1,r>5e4?(r-=5e4,e.DisplayMember="DCCCNID"+r):2==r?e.DisplayMember="AccountID":502==r&&(e.DisplayMember="AccountTypeID"),e.ValueMember=e.DisplayMember+"_Key",this.JVGrid.Columns.push(e),this.JVGrid.TableColumns.push(e.DisplayMember),this.JVGrid.TableColumns.push(e.ValueMember)}(e=new c.a).Header="Profile",e.ValueBinding="ProfileID",e.DataType="ComboBox",e.DisplayMember="Name",e.ValueMember="Value",e.Width=100;var o=[],l=n.a.admin.GetAndDeleteDistCosts(0,1);null!=l&&l.Tables.length>0&&l.Tables[0].length>0&&l.Tables[0].forEach((function(e){0==t.Profile.Items.filter((function(t){return t.Value==e.ProfileID.toString()})).length&&o.push(d.d.ComboBoxItems_2(e.ProfileName.toString(),e.ProfileID.toString()))})),e.ComboData=o,this.JVGrid.Columns.push(e),this.JVGrid.TableColumns.push("ProfileID"),this.JVGrid.TableColumns.push("CostID");var u=n.a.admin.GetAndDeleteDistCosts(0,2);if(null!=u&&u.Tables.length>0&&u.Tables[0].length>0){for(var h=function(e){var a=t.JVGrid.NewRow();a.ProfileID=u.Tables[0][e].ProfileID,a.CostID=u.Tables[0][e].CostID,t.JVGrid.Columns.forEach((function(t){!t.DisplayMember.startsWith("DCCCNID")&&"AccountTypeID"!=t.DisplayMember&&"AccountID"!=t.DisplayMember||!u.Columns[0].Contains(t.DisplayMember)||i.e.IsEmpty(u.Tables[0][e][t.DisplayMember])||(a[t.ValueMember]=u.Tables[0][e][t.DisplayMember])})),t.JVGrid.addRow(a)},D=0;D<u.Tables[0].length;D++)h(D);this.JVGrid.RefreshGrid=!0}for(var m=this.JVGrid.Table.length;m<10;m++){var b=this.JVGrid.NewRow();this.JVGrid.addRow(b)}}},{key:"InitPostingGrid",value:function(e){var t,a=this;if(this.Title="Distribute Cost",this.JVGrid.Columns=[],this.JVGrid.Table=[],this.JVGrid.Height=150,null!=e&&(this.JVGrid.Width="700"),this.JVGrid.CanUserAddRows=!0,this.JVGrid.CellEditEnding.Subscribe(this,"OnGridCellEditEnding"),null!=e){if(e.IsInventoryVoucher){var s=e.BillWisedt.find((function(e){return e.AccountID==a.colname}));i.e.IsEmpty(s[0].Amount)||(this.TotAmt=parseFloat(s[0].Amount.toString())),i.e.IsEmpty(s[0].CurrencyID)||(this.currencyid=parseInt(s[0].CurrencyID.toString())),i.e.IsEmpty(s[0].ExchangeRate)||(this.exchrate=parseFloat(s[0].ExchangeRate.toString())),this.Amount.Text=this.TotAmt.toString(),null!=e.ScreenObject.CreditAccount&&e.ScreenObject.CreditAccount.SelectedValue==parseInt(this.colname)?this.AccountName.Text=e.ScreenObject.CreditAccount.Name.Text:null!=e.ScreenObject.DebitAccount&&e.ScreenObject.DebitAccount.SelectedValue==parseInt(this.colname)&&(this.AccountName.Text=e.ScreenObject.DebitAccount.Name.Text)}this.AccountName.Visible=!0,this.Amount.Visible=!0,this.AccountName.Label="Account",this.Amount.Label+="Amount";var r=new c.a;r.Header="Account",r.Width=250,r.DisplayMember="AccountID",r.ValueMember="AccountID_Key",r.DataType="LISTBOX",r.CostCenterID=2,r.TypeID=2,this.JVGrid.Columns.push(r),(r=new c.a).DataType="FLOAT",r.Header="Amount",r.Width=100,r.DisplayMember="Amount",r.DecimalPoints=this.decimalpoints,r.ShowTotal=!0,r.IsCalculated=1,this.JVGrid.Columns.push(r)}this.JVGrid.TableColumns.push("AccountID"),this.JVGrid.TableColumns.push("AccountID_Key"),this.JVGrid.TableColumns.push("Amount");var o=null,l=null;if(3==this.Type&&null!=e&&e.ScreenObject.Preferences.ContainsKey("DistributeCostDims")&&""!=e.ScreenObject.Preferences.DistributeCostDims?(o=e.ScreenObject.GetCCNames(e.ScreenObject.Preferences.DistributeCostDims),l=e.ScreenObject.Preferences.DistributeCostDims.Split(",")):n.a.SessionManager.Preferences.ContainsKey("DistributeCostDims")&&""!=n.a.SessionManager.Preferences.DistributeCostDims&&(o=n.a.admin.GetfeatureNames(n.a.SessionManager.Preferences.DistributeCostDims),l=n.a.SessionManager.Preferences.DistributeCostDims.Split(",")),null!=o&&o.Tables.length>0&&o.Columns[0].Contains("Name")&&o.Tables[0].length>0)for(var d=0;d<o.Tables[0].length;d++){t=new c.a;var D=parseInt(o.Tables[0][d].FeatureID.toString());t.Header=o.Tables[0][d].Name.toString(),t.Width=150,t.DataType="LISTBOX",t.CostCenterID=D,t.TypeID=1,D-=5e4,t.DisplayMember="DCCCNID"+D,t.ValueMember=t.DisplayMember+"_Key",this.JVGrid.Columns.push(t),this.JVGrid.TableColumns.push(t.DisplayMember),this.JVGrid.TableColumns.push(t.ValueMember)}if(null!=e){var m="";if(e.ScreenObject._CCFields.forEach((function(e){(e instanceof u.b&&e.SelectedValue>0&&!l.Contains(e.CCID.toString())||e instanceof h.a&&e.SelectedValue>0&&!l.Contains(e.CCID.toString()))&&(m+=e.DBColumnName+"="+e.SelectedValue+", ")})),this.StrCC=m.toString(),""==this.StrCC&&(this.StrCC=e.ScreenObject.strCCFields),e.ScreenObject.DocID>0&&!i.e.IsEmpty(e.ScreenObject.DistributeCostXML)){var b=new i.f;if(b.ReadXml("<XML>"+e.ScreenObject.DistributeCostXML+"</XML>"),b.Tables.length>0&&b.Tables[0].length>0&&b.Columns[0].Contains("Amount")){for(var S=0;S<b.Tables[0].length;S++){var C=this.JVGrid.NewRow();C.Amount=b.Tables[0][S].Amount.toString(),C.AccountID_Key=b.Tables[0][S].AccountID.toString();for(var y=2;y<this.JVGrid.Columns.length;y++)b.Columns[0].Contains("cc"+this.JVGrid.Columns[y].CostCenterID.toString())&&!i.e.IsEmpty(b.Tables[0][S]["cc"+this.JVGrid.Columns[y].CostCenterID])&&(C[this.JVGrid.Columns[y].ValueMember]=b.Tables[0][S]["cc"+this.JVGrid.Columns[y].CostCenterID].toString());this.JVGrid.Table.push(C)}this.JVGrid.RefreshGrid=!0,this.JVGrid.UpdateTotals()}}else 0==e.ScreenObject.DocID&&i.e.IsEmpty(e.ScreenObject.DistributeCostXML)}else(t=new c.a).DataType="FLOAT",t.Header="Amount",t.Width=100,t.DisplayMember="Amount",t.DecimalPoints=this.decimalpoints,t.ShowTotal=!0,t.IsCalculated=1,this.JVGrid.Columns.push(t),(t=new c.a).DataType="FLOAT",t.Header="Percent",t.Width=100,t.DisplayMember="Percent",t.DecimalPoints=this.decimalpoints,t.ShowTotal=!0,t.IsCalculated=1,this.JVGrid.Columns.push(t),this.JVGrid.TableColumns.push("Percent");for(var p=this.JVGrid.Table.length;p<10;p++)this.JVGrid.Table.push({})}},{key:"InitDistGrid",value:function(e){var t=this;this.Title="Distribute Cost",this.JVGrid.Columns=[],this.JVGrid.Table=[],this.JVGrid.Height=150,this.JVGrid.Width="700",this.JVGrid.CanUserAddRows=!0,this.JVGrid.OnCellEditEnding.Subscribe(this,"OnGridCellEditEnding"),this.AddVisible=!0;var a,n=e.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember==t.colname}));this.Profile.Visible=!1,null!=e&&((a=new c.a).Header="Distribute",a.Width=250,a.DisplayMember="DimID",a.ValueMember="DimID_Key",a.DataType="LISTBOX",a.CostCenterID=n.distDim,a.TypeID=1,this.JVGrid.Columns.push(a),(a=new c.a).DataType="FLOAT",a.Header="Percentage",a.Width=100,a.DisplayMember="Amount",a.DecimalPoints=this.decimalpoints,a.ShowTotal=!0,n.distequally&&(a.IsVisible=!1),this.JVGrid.Columns.push(a)),this.JVGrid.TableColumns.push("DimID"),this.JVGrid.TableColumns.push("DimID_Key"),this.JVGrid.TableColumns.push("Amount");var s=new i.f;n.distLineWise&&!i.e.IsEmpty(this.parent.SelectedRow[n.DisplayMember+"DistXML"])?s.LoadXml(this.parent.SelectedRow[n.DisplayMember+"DistXML"].toString()):i.e.IsEmpty(n.distxml)||s.LoadXml(n.distxml);for(var r=s.SelectNodes("XML/Rows"),o=0;o<r.length;o++)if(null!=r[o].attributes["DCCCNID"+(this.JVGrid.Columns[0].CostCenterID-5e4)]){var l=this.parent.GetEmptyRowPosition(this.JVGrid,"DimID_Key");this.JVGrid.Table[l].DimID_Key=parseInt(r[o].attributes["DCCCNID"+(this.JVGrid.Columns[0].CostCenterID-5e4)].value),n.distequally||null==r[o].attributes.Percent||(this.JVGrid.Table[l].Amount=r[o].attributes.Percent.value)}r.length>0&&(this.JVGrid.RefreshGrid=!0);for(var d=this.JVGrid.Table.length;d<10;d++){var u=this.JVGrid.NewRow();this.JVGrid.addRow(u)}}},{key:"InitArAPGrid",value:function(e){var t=this;this.Title=38==e.DocumentType?"Advances":"Down Payments",this.JVGrid.Columns=[],this.JVGrid.Table=[],this.JVGrid.Height=150,this.JVGrid.Width="500",this.Profile.Visible=!1;var a=new c.a;a.Header="Doc No.",a.ReadOnly=!0,a.Width=150,a.DisplayMember="DocNo",this.JVGrid.Columns.push(a),(a=new c.a).DataType="FLOAT",a.Header="Total",a.ReadOnly=!0,a.Width=100,a.DisplayMember="Total",a.DecimalPoints=this.decimalpoints,this.JVGrid.Columns.push(a),(a=new c.a).DataType="FLOAT",a.Header="Balance",a.ReadOnly=!0,a.Width=100,a.DisplayMember="Balance",a.DecimalPoints=this.decimalpoints,this.JVGrid.Columns.push(a),(a=new c.a).DataType="FLOAT",a.Header="Amount",a.Width=100,a.DisplayMember="Amount",a.DecimalPoints=this.decimalpoints,this.JVGrid.Columns.push(a),this.JVGrid.TableColumns.push("DocNo"),this.JVGrid.TableColumns.push("Total"),this.JVGrid.TableColumns.push("Balance"),this.JVGrid.TableColumns.push("Amount"),this.JVGrid.CellEditEnding.Subscribe(this,"OnGridCellEditEnding"),this.JVGrid.BeginEdit.Subscribe(this,"onBeginEdit"),11==e.DocumentType&&null!=e.ScreenObject.DebitAccount&&e.ScreenObject.DebitAccount.SelectedValue>0?this.AccountID=e.ScreenObject.DebitAccount.SelectedValue:1==e.DocumentType&&null!=e.ScreenObject.CreditAccount&&e.ScreenObject.CreditAccount.SelectedValue>0&&(this.AccountID=e.ScreenObject.CreditAccount.SelectedValue);var n=e.ScreenObject.GetArApDetails(this.AccountID,e.DocumentDate,1==this.Type);if(null!=n&&n.Tables.length>0&&n.Columns[0].Contains("DocNo")&&n.Tables[0].length>0){var s=new i.f;""!=e.ArApBills&&s.ReadXml("<bills>"+e.ArApBills+"</bills>");for(var r=function(a){var i=t.JVGrid.NewRow();i.DocNo=n.Tables[0][a].DocNo.toString(),i.Total=n.Tables[0][a].Amount.toString(),i.Balance=n.Tables[0][a].Bal.toString(),null!=s&&s.Tables.length>0&&s.Columns[0].Contains("RefDocNo")&&s.Tables[0].length>0?(l=s.Tables[0].filter((function(e){return e.RefDocNo==i.DocNo.toString()}))).length>0&&(38==e.DocumentType||l[0].AccountID.toString()==t.AccountID.toString())&&(i.Amount=l[0].Amount.toString()):n.Tables.length>1&&n.Columns[1].Contains("DocNo")&&n.Tables[1].length>0&&(l=n.Tables[1].filter((function(e){return e.DocNo==i.DocNo.toString()}))).length>0&&(i.Amount=i.Balance.toString()),t.JVGrid.addRow(i)},o=0;o<n.Tables[0].length;o++){var l;r(o)}}}},{key:"onBeginEdit",value:function(e,t,a){if("Amount"==t){var n=i.e.Double(e.Amount);""!=e.Amount.toString()&&0!=n||(e.Amount=e.Balance)}return!1}},{key:"OnGridCellEditEnding",value:function(e,t,a){var n;if("pdcGenerateChequeViewModel"!=(null===(n=this.parent)||void 0===n?void 0:n.ClassName))3!=this.Type?"Amount"==t&&this.JVGrid.TableColumns.Contains("Balance")&&parseFloat(e.Amount)>parseFloat(e.Balance)&&(e.Amount=parseFloat(e.Balance),this.JVGrid.updateRow(e)):this.JVGrid.UpdateTotals();else{for(var s=0,r=0;r<this.JVGrid.Table.length;r++)i.e.IsEmpty(this.JVGrid.Table[r].Amount)||(s+=parseFloat(this.JVGrid.Table[r].Amount.toString()));this.JVGrid.Columns[1].footer=s.ToString("N"+this.Mdeci)}}},{key:"ShowJVViewModel_3",value:function(e){for(var t="",a=0;a<e.length;a++)0==a?t=e[a].CurrencyID.toString():t!=e[a].CurrencyID.toString()&&(t="FC"),e[a].CRAmtFC=parseFloat(e[a].CRAmt.toString())*parseFloat(e[a].ExchangeRate.toString()),e[a].DBAmtFC=parseFloat(e[a].DBAmt.toString())*parseFloat(e[a].ExchangeRate.toString());this.Profile.Visible=!1,this.Title=n.a.GetResource("Inventory_JournalVoucher"),this.JVGrid.Columns=[],this.JVGrid.Table=e,this.JVGrid.Height=200,this.JVGrid.Width="700",this.JVGrid.Table.sort((function(e,t){return e.DBAmt-t.DBAmt}));var i=new c.a;i.Header="Account Code",i.ReadOnly=!0,i.Width=200,i.DisplayMember="AccountCode",this.JVGrid.Columns.push(i),(i=new c.a).Header="Account Name",i.ReadOnly=!0,i.Width=250,i.DisplayMember="AccountID",this.JVGrid.Columns.push(i),(i=new c.a).DataType="FLOAT",i.Header="Debit",i.ReadOnly=!0,i.Width=100,i.DisplayMember="FC"==t?"DBAmtFC":"DBAmt",i.footer=e.Compute("sum","DBAmtFC"),i.ShowTotal=!0,this.JVGrid.Columns.push(i),(i=new c.a).DataType="FLOAT",i.Header="Credit",i.ReadOnly=!0,i.Width=100,i.DisplayMember="FC"==t?"CRAmtFC":"CRAmt",i.footer=e.Compute("sum","CRAmtFC").toString(),i.ShowTotal=!0,this.JVGrid.Columns.push(i)}},{key:"OnProfileSelection",value:function(){if("-1"==this.Profile.SelectedValue)this.Name.Enable=!0,this.Name.Text="",this.JVGrid.Clear();else if(null!=this.Profile.SelectedValue){this.Name.Enable=!1;var e=n.a.admin.GetAndDeleteDistCosts(parseInt(this.Profile.SelectedValue),0);this.Name.Text=this.Profile.GetText(),this.JVGrid.Clear(),null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&this.fillpostinggrid(e)}for(var t=0;t<10;t++){var a=this.JVGrid.NewRow();this.JVGrid.addRow(a)}}},{key:"fillpostinggrid",value:function(e){var t=this;this.JVGrid.Clear();for(var a=function(a){var n=t.JVGrid.NewRow();5==t.Type?i.e.Double(e.Tables[0][a].Percent)>0?n.Amount=t.TotAmt*parseFloat(e.Tables[0][a].Percent)/100:i.e.Double(e.Tables[0][a].Amount)>0&&(n.Amount=e.Tables[0][a].Amount):(n.Amount=e.Tables[0][a].Amount,n.Percent=e.Tables[0][a].Percent),t.JVGrid.Columns.forEach((function(t){t.DisplayMember.startsWith("DCCCNID")&&e.Columns[0].Contains(t.DisplayMember)&&!i.e.IsEmpty(e.Tables[0][a][t.DisplayMember])&&(n[t.ValueMember]=e.Tables[0][a][t.DisplayMember])})),t.JVGrid.addRow(n)},n=0;n<e.Tables[0].length;n++)a(n);this.JVGrid.RefreshGrid=!0;for(var s=0;s<10;s++){var r=this.JVGrid.NewRow();this.JVGrid.addRow(r)}}},{key:"OnSave",value:function(e){var t,r,l=this;if("AddRows"==e.toString()){var c=new m.a;return c.SearchDocumentViewModel_3(this,this.JVGrid.Columns[0].CostCenterID),void n.a.page.ShowDialog(c,b.a,{HideHeader:!0})}if("OK"==e.toString()){if((null===(t=this.JVGrid.angularGrid)||void 0===t?void 0:t.slickGrid)&&(null===(r=this.JVGrid.angularGrid)||void 0===r?void 0:r.slickGrid.getActiveCellNode())&&this.JVGrid.angularGrid.slickGrid.getEditorLock().commitCurrentEdit(),null==parent){if(6==this.Type)!function(){for(var e="",t="",a="",s="",r=0,o=function(n){i.e.IsEmpty(l.JVGrid.Table[n].ProfileID)||(e+='<Row ProfileID="'+l.JVGrid.Table[n].ProfileID.toString()+'" ',i.e.IsEmpty(l.JVGrid.Table[n].CostID)?e+=' CostID="0" ':e+=' CostID="'+l.JVGrid.Table[n].CostID.toString()+'" ',l.JVGrid.Columns.forEach((function(o){o.DisplayMember.startsWith("DCCCNID")?(0==r&&(t+=o.DisplayMember+",",a+="X.value('@"+o.DisplayMember+"','BIGINT'),",s+=","+o.DisplayMember+"=X.value('@"+o.DisplayMember+"','BIGINT')"),i.e.IsEmpty(l.JVGrid.Table[n][o.ValueMember])||(e+=o.DisplayMember+'="'+l.JVGrid.Table[n][o.ValueMember].toString()+'" ')):("AccountTypeID"!=o.DisplayMember||i.e.IsEmpty(l.JVGrid.Table[n][o.ValueMember]))&&("AccountID"!=o.DisplayMember||i.e.IsEmpty(l.JVGrid.Table[n][o.ValueMember]))||(e+=o.DisplayMember+'="'+l.JVGrid.Table[n][o.ValueMember].toString()+'" ')})),r++,e+="/>")},c=0;c<l.JVGrid.Table.length;c++)o(c);e.length>0&&(e="<XML>"+e,e+="</XML>",n.a.admin.SaveDistCosts(2,0,s,e.toString(),t,a).subscribe((function(e){l.DisplayMessage=e.Message}),(function(e){console.log(e),l.DisplayMessage="Error in save"})))}();else{var d=function(){if(i.e.IsEmpty(l.Name.Text))return{v:(l.DisplayMessage="Enter profile name.",void(l.MessageVisibility=!0))};for(var e="",t="",a="",s=0,r=function(n){(""!=l.JVGrid.Table[n].Amount.toString()&&parseFloat(l.JVGrid.Table[n].Amount.toString())>0||""!=l.JVGrid.Table[n].Percent.toString()&&parseFloat(l.JVGrid.Table[n].Percent.toString())>0)&&(e+='<Row Amount="'+l.JVGrid.Table[n].Amount.toString()+'" ',e+='Percent="'+l.JVGrid.Table[n].Percent.toString()+'" ',l.JVGrid.Columns.forEach((function(r){r.DisplayMember.startsWith("DCCCNID")&&(0==s&&(t+=r.DisplayMember+",",a+="X.value('@"+r.DisplayMember+"','BIGINT'),"),i.e.IsEmpty(l.JVGrid.Table[n][r.ValueMember])||(e+=r.DisplayMember+'="'+l.JVGrid.Table[n][r.ValueMember].toString()+'" '))})),s++,e+="/>")},o=0;o<l.JVGrid.Table.length;o++)r(o);e.length>0&&(e="<XML>"+e,e+="</XML>",n.a.admin.SaveDistCosts(1,parseInt(l.Profile.SelectedValue),l.Name.Text,e.toString(),t,a).subscribe((function(e){l.DisplayMessage=e.Message,parseInt(e.RetValue)>0&&(l.FillProfiles(),l.JVGrid.Clear())}),(function(e){console.log(e),l.DisplayMessage="Error in save"})))}();if("object"==typeof d)return d.v}return}if("AddEditDocumentViewModel"==this.parent.ClassName)if(7==this.Type){for(var u=0,h=0;h<this.JVGrid.Table.length;h++)i.e.IsEmpty(this.JVGrid.Table[h].DimID_Key)||u++;if(!(u>0))return this.DisplayMessage="Select "+this.JVGrid.Columns[0].Header,void(this.MessageVisibility=!0);var S=this.parent.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember==l.colname})),C="";u=100/u;var y="",p=[];y+="<XML>";for(var g=0;g<this.JVGrid.Table.length;g++)if(!i.e.IsEmpty(this.JVGrid.Table[g].DimID_Key)){if(p.Contains(parseInt(this.JVGrid.Table[g].DimID_Key.toString())))return this.DisplayMessage="Duplicate "+this.JVGrid.Columns[0].Header+" :"+this.JVGrid.Table[g].DimID.toString(),void(this.MessageVisibility=!0);y+="<Rows  DCCCNID"+(this.JVGrid.Columns[0].CostCenterID-5e4)+'="'+this.JVGrid.Table[g].DimID_Key.toString(),this.JVGrid.Columns[1].IsVisible&&!i.e.IsEmpty(this.JVGrid.Table[g].Amount)?y+='" Percent="'+this.JVGrid.Table[g].Amount.toString()+'" />':y+='" Percent="'+u+'" />',i.e.IsEmpty(S.DefaultValueText)||(C+=this.JVGrid.Table[g].DimID.toString()+", ")}if(y+="</XML>",S.distLineWise?this.parent.SelectedRow[S.DisplayMember+"DistXML"]=y.toString():S.distxml=y.toString(),!i.e.IsEmpty(S.DefaultValueText))if(C.length>2&&(C=C.substr(0,C.length-2)),this.parent.ScreenObject.GridDataColumns.Contains(S.DefaultValueText))this.parent.SelectedRow[S.DefaultValueText]=C;else{var f=this.parent.ScreenObject._TextFields.find((function(e){return e.DBColumnName.toLowerCase()==S.DefaultValueText.toLowerCase()}));(null!=f&&f instanceof o.d||null!=f&&f instanceof o.c)&&(f.Text=C)}}else if(3==this.Type||5==this.Type){var I;if(null==(I=3==this.Type?this.JVGrid.Table.filter((function(e){return e.AccountID_Key>0})).Compute("sum","Amount"):this.JVGrid.Table.Compute("sum","Amount"))||parseFloat(I).ToString("N"+this.decimalpoints)!=this.TotAmt.ToString("N"+this.decimalpoints))return void(this.DisplayMessage="Amount not equal.");this.parent.DialogResult=!0}else{for(var T="",P=0,O=0;O<this.JVGrid.Table.length;O++)!i.e.IsEmpty(this.JVGrid.Table[O].Amount)&&parseFloat(this.JVGrid.Table[O].Amount.toString())>0&&(P+=parseFloat(this.JVGrid.Table[O].Amount.toString()),T+='<NonAccRows  RefDocNo="'+this.JVGrid.Table[O].DocNo.toString()+'" Amount="',T+=this.JVGrid.Table[O].Amount.toString()+'" ',38!=this.parent.DocumentType&&(T+=' AccountID="'+this.AccountID+'" '),T+="      />");if(38!=this.parent.DocumentType){if((G=this.parent.ScreenObject.FooterGridData.find((function(e){return e.ColumnName==l.colname}))).length>0)G[0].Amount=P,G[0].ReadOnly="True";else{var B=this.parent.ScreenObject.FooterGridDataObj.NewRow();(G=this.parent.ScreenObject.FooterColumnSource[1].ComboData.filter((function(e){return e.ColumnName==l.colname}))).length>0&&(B.Sno=this.parent.ScreenObject.FooterGridData.length+1,B.Name=i.e.String(G[0].Name),B.ColumnName=i.e.String(G[0].ColumnName),B.PostingType=i.e.String(G[0].PostingType),B.IsCalculated=i.e.String(G[0].IsCalculated),B.CrRefColName=i.e.String(G[0].CrRefColName),B.CrRefColID=i.e.String(G[0].CrRefColID),B.CrRefID=i.e.String(G[0].CrRefID),B.CrRefSection=i.e.String(G[0].CrRefSection),B.DrRefColName=i.e.String(G[0].DrRefColName),B.DrRefColID=i.e.String(G[0].DrRefColID),B.DrRefID=i.e.String(G[0].DrRefID),B.DrRefSection=i.e.String(G[0].DrRefSection),B.DebitAccount=i.e.String(G[0].DebitAccount),B.CreditAccount=i.e.String(G[0].CreditAccount),B.Formula=i.e.String(G[0].Formula),B.dcCurrID_Key=i.e.String(G[0].Currency),B.dcCurrID=i.e.String(G[0].CurrencyName),B.ReadOnly="True",B.IsVisible=i.e.String(G[0].IsVisible),B.BasedOnXML=i.e.String(G[0].BasedOnXML),B.Amount=P,this.parent.ScreenObject.FooterGridDataObj.TableColumns.Contains("StyleHeightZero")&&(B.StyleHeightZero=Object(s.j)(B.IsVisible.toString())?0:1),this.parent.ScreenObject.FooterGridDataObj.addRow(B))}this.parent.CalculateFooter(-1)}else{var G,N=this.parent.POSPayModes.GridData;if((G=N.filter((function(e){return e.ColumnName==l.colname}))).length>0){G[0].Amount=P,this.parent.POSPayModes.GridDataObj.updateRow(G[0]),P=0;for(var v=0;v<N.length;v++)i.e.IsEmpty(N[v].ColumnName)||i.e.IsEmpty(N[v].Amount)||(P+=parseFloat(N[v].Amount.toString()));var M="2";this.parent.ScreenObject.Preferences.ContainsKey("DecimalsNetAmount")&&""!=this.parent.ScreenObject.Preferences.DecimalsNetAmount&&(M=this.parent.ScreenObject.Preferences.DecimalsNetAmount),this.parent.Bal=parseFloat((this.parent.GridNetTotal+this.parent.FooterGridNetTotal-P).ToString("N"+M)),this.parent.Bal<0&&(this.parent.Bal=0)}}this.parent.ArApBills=T.toString()}else if("pdcGenerateChequeViewModel"==this.parent.ClassName){for(var j=0,V=0;V<this.JVGrid.Table.length;V++)i.e.IsEmpty(this.JVGrid.Table[V].Amount)||(j+=parseFloat(this.JVGrid.Table[V].Amount.toString()));if(parseFloat(this.parent.GrBody.SelectedItem.Amount.toString()).ToString("N0")!=j.ToString("N0"))return void(this.DisplayMessage="Amount MisMatch.");for(var A="",R=0;R<this.JVGrid.Table.length;R++)i.e.IsEmpty(this.JVGrid.Table[R].Date_Key)||"0"==this.JVGrid.Table[R].Amount.toString()||i.e.IsEmpty(this.JVGrid.Table[R].Amount)||(A+="<Row  Amount='"+this.JVGrid.Table[R].Amount.toString()+"' Date='",A+=this.JVGrid.Table[R].Date_Key.toString()+"' />");A.length>0?(A="<XML>"+A+"</XML>",this.parent.GrBody.SelectedItem.Detailsxml=A.toString()):this.parent.GrBody.SelectedItem.Detailsxml=null}}else{if("Map"==e.toString()){var w=new a;w.ShowJVViewModel_5(6);var E={component:D.ShowJVComponent};return E.params.obj=w,void n.a.page.addNewTab(E)}if("SelectionChange"==e.toString())return void this.OnProfileSelection();if("Delete"==e.toString()){if("-1"==this.Profile.SelectedValue)this.DisplayMessage="Cannot Delete New";else{var Q=n.a.admin.GetAndDeleteDistCosts(parseInt(this.Profile.SelectedValue),3);null!=Q&&Q.Tables.length>0&&Q.Tables[0].length>0&&(this.DisplayMessage=Q.Tables[0][0].ErrorMessage.toString(),"Deleted Successfully"==this.DisplayMessage&&(this.Name.Text="",this.JVGrid.Clear(),this.FillProfiles()))}return}if(null!=this.parent&&i.e.IsType(this.parent,"AddEditDocumentViewModel")&&4!=this.Type){var L="";if("Order"==this.JVGrid.Columns[0].Header)for(var F=this.JVGrid.Table.sort((function(e,t){return e.DocField>t.DocField?1:-1})),_=0;_<F.length;_++)i.e.IsEmpty(F[_].ReportCol)||"0"==F[_].ReportCol.toString()||(L+=F[_].ReportCol.toString()+",");else{for(var k=0;k<this.JVGrid.Table.length;k++)i.e.IsEmpty(this.JVGrid.Table[k].ReportCol)||"0"==this.JVGrid.Table[k].ReportCol.toString()||(L+="<Row  ColID='"+this.JVGrid.Table[k].ColID.toString()+"' SysColName='",L+=this.JVGrid.Table[k].SysColName.toString()+"'  ReportCol='"+this.JVGrid.Table[k].ReportCol.toString()+"' />");L.length>0&&(L="<XML>"+L+"</XML>")}}}n.a.page.HideDialog()}},{key:"getxml",value:function(e){for(var t=this,a=this.parent.BillWisedt.filter((function(e){return e.AccountID==t.colname})),n="",r=0,o=0;o<this.JVGrid.Table.length;o++)if(i.e.Double(this.JVGrid.Table[o].Amount)>0&&(5==this.Type||i.e.Int(this.JVGrid.Table[o].AccountID_Key)>0)){r=parseFloat(this.JVGrid.Table[o].Amount),n+="\x11",n+='<Row><Transactions DocDetailsID="0" IsQtyIgnored="1" DocSeqNo="'+this.parent.ScreenObject.GridData.length+'" ',n+='Quantity="" UOMConversion="1" UOMConvertedQty="1" Unit="1" Rate="'+r+'" ',n+=' CurrencyID="'+this.currencyid+'" ExchangeRate="'+this.exchrate+'" ',n+='Gross="'+r+'" StockValue="'+(r*this.exchrate).ToString("N"+this.decimalpoints).Replace(",","")+'" ',n+=' StockValueFC="'+r+'" ',n+=' DynamicInvDocDetailsID="-1" ProductID="'+e+'" ',Object(s.j)(a[0].IsCredit.toString())?(n+='  CreditAccount="'+this.colname+'" ',n+=5==this.Type?'  DebitAccount="'+this.AccountID.toString()+'" ':'  DebitAccount="'+this.JVGrid.Table[o].AccountID_Key.toString()+'" ',n+=" ></Transactions>",n+="<AccountsXML><Accounts ",n+=' CreditAccount="'+this.colname+'" ',n+=5==this.Type?'  DebitAccount="'+this.AccountID.toString()+'" ':' DebitAccount="'+this.JVGrid.Table[o].AccountID_Key.toString()+'" ',this.parent.ScreenObject.FillBillWiseDt(this.parent.BillWisedt,5==this.Type?this.AccountID.toString():this.JVGrid.Table[o].AccountID_Key.toString(),r.toString(),!1,this.currencyid,this.exchrate,0,this.decimalpoints,1)):(n+=' DebitAccount="'+this.colname+'" ',n+=5==this.Type?'  CreditAccount="'+this.AccountID.toString()+'" ':' CreditAccount="'+this.JVGrid.Table[o].AccountID_Key.toString()+'" ',n+=" ></Transactions>",n+="<AccountsXML><Accounts ",n+=' DebitAccount="'+this.colname+'" ',n+=5==this.Type?'  CreditAccount="'+this.AccountID.toString()+'" ':' CreditAccount="'+this.JVGrid.Table[o].AccountID_Key.toString()+'" ',this.parent.ScreenObject.FillBillWiseDt(this.parent.BillWisedt,5==this.Type?this.AccountID.toString():this.JVGrid.Table[o].AccountID_Key.toString(),r.toString(),!0,this.currencyid,this.exchrate,0,this.decimalpoints,1)),n+=' CurrencyID="'+this.currencyid+'" ExchangeRate="'+this.exchrate+'" ',n+='Amount="'+(r*this.exchrate).ToString("N"+this.decimalpoints).Replace(",","")+'" AmtFc="'+r+'" ></Accounts></AccountsXML>',n+="<EXTRAXML></EXTRAXML>",n+="<Numeric /><Alpha />",n+='<CostCenters Query="'+this.StrCC;for(var l=2;l<this.JVGrid.Columns.length;l++)i.e.IsEmpty(this.JVGrid.Table[o][this.JVGrid.Columns[l].ValueMember])||(n+=this.JVGrid.Columns[l].DisplayMember+"="+this.JVGrid.Table[o][this.JVGrid.Columns[l].ValueMember].toString()+",");n+='" ></CostCenters>',n+="</Row>"}return n.toString()}},{key:"Refresh",get:function(){return!0}}]),a}(r.b)},gqOg:function(e,t,a){"use strict";a.d(t,"a",(function(){return S}));var n=a("Do2H"),i=a("Lp6j"),s=a("eQJW"),r=a("ScVY"),o=a("EQd/"),l=a("8B8H"),c=a("0/4Q"),d=a("ockk"),u=a("MCLT"),h=a("n56n"),D=a("4HhE"),m=a("Ls/t"),b=a("vTM8"),S=function(e){_inherits(a,e);var t=_createSuper(a);function a(e,i,s,r,u){var h;_classCallCheck(this,a),(h=t.call(this)).lblVouchNO=null,h.VoucherNo=null,h.ScanText=new o.d(0),h.GridObj=new l.a,h.DynamicColumnSource=[],h.AddedGridObj=new l.a,h.IsJob=!1,h.AddGridVisbility=!1,h.Parent=null,h.RemaingQuantity=0,h.ds=null,h.JobNodeID=0,h.IsBom=!1,h.packs=null,h.Scannedpacks=null,h.batchqty=new b.a,h.ClassName="LinkDocument",h.Title=n.a.GetResource("LinkTitle"),h.GridObj.Columns=[],h.GridObj.Table=[],h.GridObj.SearchVisible=!0,h.GridObj.SelectAll.Visible=!0,h.AddedGridObj.Columns=[],h.AddedGridObj.Table=[],h.IsBom=u,h.Parent=e,h.JobNodeID=r;var D=h.Parent.ScreenObject.ColumnSource.find((function(e){return null!=e.DisplayMember&&"quantity"==e.DisplayMember.toLowerCase()}));h.decimalpoints=D&&""!=D.DecimalPoints?D.DecimalPoints:n.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=n.a.SessionManager.Preferences.DecimalsinQty?n.a.SessionManager.Preferences.DecimalsinQty:"2";var m=h.Parent.ScreenObject.Data.Tables[7];null!=h.Parent.ScreenObject&&null!=h.Parent.ScreenObject.Data&&h.Parent.ScreenObject.Data.Tables.length>6&&(m=h.Parent.ScreenObject.Data.Tables[7].filter((function(e){return"GroupCheckBox"==e.PrefValueType}))),h.GridObj.CellEditEnding.Subscribe(_assertThisInitialized(h),"OnCellEditEnding"),h.GridObj.BeginEdit.Subscribe(_assertThisInitialized(h),"OnBeginEdit"),h.GridObj.OnPreviewKeyDown.Subscribe(_assertThisInitialized(h),"OnKeyDown"),h.VoucherNo=i,h.GridObj.TableColumns.push("TobeUsed"),h.GridObj.TableColumns.push("ProductType"),h.GridObj.TableColumns.push("BatchNo"),h.GridObj.TableColumns.push("BatchCode"),h.GridObj.TableColumns.push("DocSeqNo"),h.GridObj.TableColumns.push("Select"),h.GridObj.TableColumns.push("DocDetailsID"),h.GridObj.TableColumns.push("ProductName"),h.GridObj.TableColumns.push("ProductCode"),h.GridObj.TableColumns.push("ProductID_Key"),h.GridObj.TableColumns.push("linkFieldName");var S=new d.a;return S.Header="#",S.DisplayMember="DocSeqNo",S.DataType="TextBlock",S.ReadOnly=!0,S.Width=25,S.DisableTab=!0,h.ColumnSource.push(S),(S=new d.a).Header="\u221a",S.DisplayMember="Select",S.DataType="CheckBox",S.Width=25,h.ColumnSource.push(S),h.JobNodeID>0?(h.IsJob=!0,h.AddGridVisbility=!0,h.Boms=new c.e(0),h.Stages=new c.e(0),h.QTY=new o.d(0),h.RemQTY=new o.d(0),h.IO=new c.e(0),36==h.Parent.ScreenObject.DocumentType||37==h.Parent.ScreenObject.DocumentType?(h.RemQTY.Visible=!1,h.QTY.Visible=!1,h.IO.Visible=!1):h.Parent.ScreenObject.IsPurchase?(h.RemQTY.Visible=!1,h.QTY.Visible=!1,h.IO.Visible=!0,h.IO.Items.push(c.d.ComboBoxItems_2("Output","Output")),h.IO.Items.push(c.d.ComboBoxItems_2("Input","Input")),h.IO.SelectedValue=h.IO.Items[0].Value,h.IO.SelectionChangedCommand.Subscribe(_assertThisInitialized(h),"onIoChanged")):(h.QTY.Visible=!0,h.IO.Visible=!1,h.QTY.Enable=!1),h.IO.Label="Input/Output",h.QTY.Label="Quantity",h.RemQTY.Label="Remaining Qty",h.QTY.DataType="FLOAT",h.Boms.Label="Boms",h.Stages.Label="Stages",h.Boms.SelectionChangedCommand.Subscribe(_assertThisInitialized(h),"onBomChanged"),h.Stages.SelectionChangedCommand.Subscribe(_assertThisInitialized(h),"onStageChanged"),n.a.SessionManager.IsActionAssigned(43,"Donot Allow to change Yield Qty")&&(h.RemQTY.Enable=!1),h.FillJobDetails()):(h.lblVouchNO=n.a.GetResource("VoucherNo"),h.ds=e.ScreenObject.GetLinkDocDetails(h.VoucherNo,s),h.Title+=" - "+h.VoucherNo,h.VoucherNo.Contains("','")&&(h.lblVouchNO="",h.VoucherNo="",(S=new d.a).Header="Voucher No",S.DisplayMember="VoucherNo",S.DataType="TextBlock",S.Width=100,S.ReadOnly=!0,h.ColumnSource.InsertAt(S,2),h.GridObj.TableColumns.Contains("VoucherNo")||h.GridObj.TableColumns.push("VoucherNo")),h.FillLinkDocDetails(m)),h.RefreshGrid=!0,h}return _createClass(a,[{key:"OnKeyDown",value:function(e,t){"F6"==t.key&&(t.preventDefault(),this.onCopy(e))}},{key:"onCopy",value:function(e){if(!e.column.DgCol.IsReadOnly){"DataGridPactListBoxColumn"!=e.column.className&&this.GridObj.commitEdit();var t;if(t=e.column.field,confirm("Do you want to override all?\nNo to copy blank."))for(var a=confirm("Do you want to override all?"),n=0;n<this.GridData.length;n++)if("DataGridPactListBoxColumn"==e.column.className&&this.GridObj.commitEdit(),0!=a||i.e.IsEmpty(this.GridData[n][t])||this.GridObj.DataTypes.Double.Contains(t)||i.e.IsEmpty(this.GridData[n][t])||0!=parseFloat(this.GridData[n][t]))if(this.GridData[n][t]=e.Item.Row[t].toString(),"DataGridDateTimeColumn"==e.column.className&&this.GridObj.TableColumns.Contains(t+"_key"))this.GridData[n][t+"_key"]=e.Item.Row[t+"_key"].toString();else if("DataGridPactListBoxColumn"==e.column.className){var s=this.ColumnSource.find((function(e){return e.DisplayMember==t}));s&&(this.GridData[n][s.ValueMember]=e.Item.Row[s.ValueMember].toString())}}}},{key:"onScanKeyDown",value:function(e,t){"13"==t.keyCode&&(this.GridObj.TableColumns.Contains("ScanProduct")?this.onScan(this.ScanText.Text,null):this.onScanPack(this.ScanText.Text))}},{key:"onScanPack",value:function(e){var t=this;if(this.DisplayMessage="",null==this.packs&&this.Parent.DtPack&&this.Parent.DtPack.length>0){this.packs=[];for(var a=0;a<this.Parent.DtPack.length;a++)i.e.IsEmpty(this.Parent.DtPack[a].Label)||this.packs.push(this.Parent.DtPack[a].Label.toString())}var n=e.split("/");if(n.length>1){var s=function(){if(null!=t.packs&&t.packs.Contains(n[1]))return{v:(i.e.PlaySound("beep-03.wav"),void(t.DisplayMessage="Already Scanned"))};var e=t.Parent.ScreenObject.GetPackInfo(n[1],n[0]),a=!1;if(null!=e&&e.Tables.length>0&&e.Columns[0].Contains("InvDocDetailsID")&&e.Tables[0].length>0)for(var s=function(n){var s=t.GridData.filter((function(t){return t.DocDetailsID==e.Tables[0][n].InvDocDetailsID}));s.length>0&&(s[0].Select=!0,a=!0,s[0].TobeUsed=!i.e.IsEmpty(s[0].TobeUsed)&&isFinite(s[0].TobeUsed)?parseFloat(s[0].TobeUsed)+parseFloat(e.Tables[0][n].Quantity):e.Tables[0][n].Quantity,t.ValidateQty(s[0]))},r=0;r<e.Tables[0].length;r++)s(r);a?(i.e.PlaySound("beep-01.wav"),null==t.packs&&(t.packs=[]),null==t.Scannedpacks&&(t.Scannedpacks=[]),t.packs.push(n[1]),t.RemovePack(n[1]),t.Scannedpacks.push(n[1]),t.ScanText.Text=""):i.e.PlaySound("beep-02.wav")}();if("object"==typeof s)return s.v}}},{key:"onScan",value:function(e,t){var a=this;this.DisplayMessage="";var n=this.Parent.ScreenObject.ColumnSource.find((function(e){return null!=e.DisplayMember&&"ProductCode"==e.DisplayMember}));if(n&&n.UseBarcode){var r={PID:0};if(!this.Parent.ReadBarcode(n.BarcodeDef,n.BarcodeProp,null,null,e,r)){if(null!=this.Parent.barcodeValues&&1==this.Parent.barcodeValues.length){var o=this.ds.Tables[4].filter((function(e){return e.BASECOL==a.Parent.barcodeValues.ElementAt(0).Key}));if(o.length>0&&this.ds.Columns[3].Contains(o[0].LINKCOL.toString())&&((o=this.ds.Tables[3].filter((function(e){return e[o[0].LINKCOL]==a.Parent.barcodeValues.ElementAt(0).Value}))).length>0&&(o=this.GridData.filter((function(e){return e.DocDetailsID==o[0].InvDocDetailsID.toString()}))).length>0))return""==i.e.String(o[0].TobeUsed)||!i.e.IsEmpty(o[0].Balance)&&!i.e.IsEmpty(o[0].TobeUsed)&&parseFloat(o[0].Balance.toString())>parseFloat(o[0].TobeUsed.toString())?(o[0].TobeUsed=i.e.IsEmpty(o[0].TobeUsed)?1:parseFloat(o[0].TobeUsed.toString())+1,o[0].ScanProduct=this.ScanText.Text,o[0].ScannedBarcodes=i.e.IsEmpty(o[0].ScannedBarcodes)?o[0].ScanProduct.toString():o[0].ScannedBarcodes.toString()+","+o[0].ScanProduct.toString(),o[0].Select=!0,o[0].ScanProduct="",i.e.PlaySound("beep-02.wav"),void(this.ScanText.Text="")):(i.e.PlaySound("beep-01.wav"),this.DisplayMessage="Item already scanned",void(this.MessageVisibility=!0))}return this.ScanText.Text="",this.DisplayMessage="Item not found",void i.e.PlaySound("beep-01.wav")}if(null==t){var l,c,d;if(this.Parent.ScreenObject.Preferences.ContainsKey("CopyBatches")&&!i.e.IsEmpty(this.Parent.ScreenObject.Preferences.CopyBatches)&&Object(s.j)(this.Parent.ScreenObject.Preferences.CopyBatches)&&(null!=this.Parent.barcodeValues&&this.Parent.barcodeValues.ContainsKey("Batch_No")&&this.GridObj.TableColumns.Contains("BatchNo")?l=this.Parent.barcodeValues.Batch_No:null!=this.Parent.barcodeValues&&this.Parent.barcodeValues.ContainsKey("Batch_Code")&&this.GridObj.TableColumns.Contains("BatchCode")&&(c=this.Parent.barcodeValues.Batch_Code)),null!=this.Parent.barcodeValues&&this.Parent.barcodeValues.ContainsKey("INVID")&&this.ds.Tables.length>13&&this.ds.Tables[13].length>0){var h=this.ds.Tables[13].filter((function(e){return 1==e.Type&&e.RefID==a.Parent.barcodeValues.INVID}));h.length>0&&!i.e.IsEmpty(h[0].InvDocDetailsID)&&(d=h[0].InvDocDetailsID)}var D=this.GridData.filter((function(e){return e.ProductID_Key==r.PID&&(Object(u.isUndefined)(l)||e.BatchNo==l)&&(Object(u.isUndefined)(c)||e.BatchCode==c)&&(Object(u.isUndefined)(d)||e.DocDetailsID==d)}));if(D.length>0){for(var b=0;b<D.length;b++){var S=D[b];if(i.e.IsEmpty(S.TobeUsed)||!i.e.IsEmpty(S.Balance)&&!i.e.IsEmpty(S.TobeUsed)&&parseFloat(S.Balance)>parseFloat(S.TobeUsed)){t=S;break}}if(null==t)return i.e.PlaySound("beep-01.wav"),void(this.DisplayMessage="Item already scanned");t.ScanProduct=this.ScanText.Text,this.ScanText.Text=""}}if(null!=t&&r.PID==parseInt(t.ProductID_Key)){var C;if(C=null!=this.Parent.barcodeValues&&this.Parent.barcodeValues.ContainsKey("Quantity")&&!i.e.IsEmpty(this.Parent.barcodeValues.Quantity)&&isFinite(this.Parent.barcodeValues.Quantity)?parseFloat(this.Parent.barcodeValues.Quantity):1,!this.Parent.ScreenObject.Preferences.ContainsKey("CopyBatches")||""==this.Parent.ScreenObject.Preferences.CopyBatches.toString()||!Object(s.j)(this.Parent.ScreenObject.Preferences.CopyBatches))if(null!=this.Parent.barcodeValues&&this.Parent.barcodeValues.ContainsKey("Batch_No")){var y=C;this.batchqty.ContainsKey(this.Parent.barcodeValues.Batch_No)&&(y+=this.batchqty[this.Parent.barcodeValues.Batch_No]);var p=new m.a(this.Parent.ScreenObject.GridDataObj);if(p.BatchNumberViewModel_3(this.Parent,-1,y,r.PID,"",this.Parent.ScreenObject.LocationID,this.Parent.ScreenObject.DivisionID,null),p.GridDataColumns.Contains("QtyUom")){var g=this.ds.Tables[0].filter((function(e){return e.DocDetailsID==t.DocDetailsID.toString()}));g.length>0&&!i.e.IsEmpty(g[0].UomConversion)&&(y*=parseFloat(g[0].UomConversion.toString()))}var f=p.GridData.filter((function(e){return e.BATCHNUMBER==a.Parent.barcodeValues.Batch_No}));if(!(f.length>0&&!i.e.IsEmpty(f[0].BalQty)&&parseFloat(f[0].BalQty)>=y))return this.DisplayMessage=f.length>0?"batch qty not available":"batch does not exists",this.MessageVisibility=!0,t.ScanProduct=null,void i.e.PlaySound("beep-01.wav");this.GridObj.TableColumns.Contains("BatchXML")||this.GridObj.TableColumns.push("BatchXML"),this.batchqty.ContainsKey(this.Parent.barcodeValues.Batch_No)?this.batchqty[this.Parent.barcodeValues.Batch_No]+=C:this.batchqty.push(this.Parent.barcodeValues.Batch_No,C),t.BatchXML=i.e.StringValue(t.BatchXML)+" <Row BatchNo='"+this.Parent.barcodeValues.Batch_No+"' QTY='"+C+"' />"}else if(null!=this.Parent.barcodeValues&&this.Parent.barcodeValues.ContainsKey("Batch_Code")){var I=C;this.batchqty.ContainsKey(this.Parent.barcodeValues.Batch_Code)&&(I+=this.batchqty[this.Parent.barcodeValues.Batch_Code]);var T=new m.a(this.Parent.ScreenObject.GridDataObj);T.BatchNumberViewModel_3(this.Parent,-1,I,r.PID,"",this.Parent.ScreenObject.LocationID,this.Parent.ScreenObject.DivisionID,null);var P=T.GridData.filter((function(e){return e.BATCHNUMBER==a.Parent.barcodeValues.Batch_Code}));if(!(P.length>0&&""!=P[0].BalQty.toString()&&parseFloat(P[0].BalQty.toString())>=I))return this.DisplayMessage=P.length>0?"batch qty not available":"batch does not exists",this.MessageVisibility=!0,t.ScanProduct=null,void i.e.PlaySound("beep-01.wav");this.GridObj.TableColumns.Contains("BatchXML")||this.GridObj.TableColumns.push("BatchXML"),this.batchqty.ContainsKey(this.Parent.barcodeValues.Batch_No)?this.batchqty[this.Parent.barcodeValues.Batch_No]+=C:this.batchqty.push(this.Parent.barcodeValues.Batch_No,C),t.BatchXML=t.BatchXML.toString()+" <Row BatchCode='"+this.Parent.barcodeValues.Batch_Code+"' QTY='"+C+"' />"}(i.e.IsEmpty(t.TobeUsed)||!i.e.IsEmpty(t.Balance)&&!i.e.IsEmpty(t.TobeUsed)&&parseFloat(t.Balance)>parseFloat(t.TobeUsed))&&(t.TobeUsed=i.e.IsEmpty(t.TobeUsed)?C:parseFloat(t.TobeUsed)+C,t.ScannedBarcodes=i.e.IsEmpty(t.ScannedBarcodes)?t.ScanProduct.toString():t.ScannedBarcodes+","+t.ScanProduct.toString(),t.Select=!0,t.ScanProduct="",i.e.PlaySound("beep-02.wav"),this.GridObj.updateRow(t))}}}},{key:"onIoChanged",value:function(e){this.FillJobProducts()}},{key:"onBomChanged",value:function(e){var t=this;if(!i.e.IsEmpty(this.Boms.SelectedValue))if(this.Stages.Items.Clear(),this.ds.Tables.length>3&&this.ds.Columns[3].Contains("BOMID")&&this.ds.Tables[3].length>0){var a=this.ds.Tables[3].filter((function(e){return e.BOMID==t.Boms.SelectedValue}));if(a.length>0){for(var r=function(e){var r=a[e];if(0==t.Stages.Items.filter((function(e){return null!=e.Value&&e.Value==r.StageID})).length){var o=t.ds.Tables[0].filter((function(e){return e.BOMID==t.Boms.SelectedValue&&e.StageID==r.StageID}));if(0==o.length&&n.a.SessionManager.Preferences.ContainsKey("ShowOnlySelectedStages")&&""!=n.a.SessionManager.Preferences.ShowOnlySelectedStages&&Object(s.j)(n.a.SessionManager.Preferences.ShowOnlySelectedStages))return"continue";var l=0;do{var d=c.d.ComboBoxItems_2(r.Name.toString(),r.StageID.toString());t.ds.Columns[0].Contains("DimName")&&(o.length>1||o.length>l&&!i.e.IsEmpty(o[l].DimID)&&parseInt(o[l].DimID)>1)&&(d.Name+=" "+o[l].DimName.toString(),d.Aliasname=o[l].DimID.toString()),t.Stages.Items.push(d),l++}while(l<o.length)}},o=0;o<a.length;o++)r(o);1==this.Stages.Items.length&&(this.Stages.SelectedValue=this.Stages.Items[0].Value,this.FillJobProducts())}else this.FillJobProducts()}else this.FillJobProducts()}},{key:"FillJobProducts",value:function(){var e=this;this.GridObj.SelectAll.IsChecked=!1,this.GridData.Clear(),null!=this.Boms.SelectedValue&&""!=this.Boms.SelectedValue&&this.ds.Tables.length>1&&this.ds.Columns[1].Contains("BOMID")&&this.ds.Tables[1].length>0&&function(){var t,a;if(null!=e.Stages.SelectedValue&&""!=e.Stages.SelectedValue&&"0"!=e.Stages.SelectedValue&&(t=e.Stages.SelectedValue,null==e.Stages.SelectedItem||i.e.IsEmpty(e.Stages.SelectedItem.Aliasname)||(a=e.Stages.SelectedItem.Aliasname)),36==e.Parent.ScreenObject.DocumentType){var n=e.ds.Tables[1].filter((function(n){return n.BOMID==e.Boms.SelectedValue&&(Object(u.isUndefined)(t)||n.StageID==t)&&(Object(u.isUndefined)(a)||n.DimID==a)}));if(n.length>0)for(var r=function(t){var a=n[t],s=e.GridObj.NewRow();if(s.DocSeqNo=e.GridData.length+1,s.Select=!1,s.DocDetailsID="0",!i.e.IsEmpty(a.StageID)&&e.ds.Tables.length>3&&e.ds.Columns[3].Contains("BOMID")){var r=e.ds.Tables[3].filter((function(t){return t.BOMID==e.Boms.SelectedValue&&t.StageID==a.StageID}));r.length>0&&(s.StageID=r[0].StageID,s.StageNodeID=r[0].StageNodeID,s.StageName=r[0].Name)}s.Machine=a.ResourceName.toString(),s.MachineID=a.ResourceID.toString(),e.ds.Columns[1].Contains("CrAccountID")&&(s.CrAccountID=a.CrAccountID.toString()),e.ds.Columns[1].Contains("CrAccount")&&(s.CrAccount=a.CrAccount.toString()),e.ds.Columns[1].Contains("DrAccountID")&&(s.DrAccountID=a.DrAccountID.toString()),e.ds.Columns[1].Contains("DrAccount")&&(s.DrAccount=a.DrAccount.toString()),e.GridObj.TableColumns.Contains("MachineDim1")&&!i.e.IsEmpty(a.MachineDim1)&&(s.MachineDim1=a.MachineDim1.toString()),e.GridObj.TableColumns.Contains("MachineDim2")&&!i.e.IsEmpty(a.MachineDim2)&&(s.MachineDim2=a.MachineDim2.toString()),s.TotalHrs=a.Hours.toString(),s.Used=a.Used.toString(),s.Balance=i.e.IsEmpty(s.Used)||i.e.IsEmpty(s.TotalHrs)?a.Value:parseFloat(s.TotalHrs)-parseFloat(s.Used),s.Hrs=s.Balance,s.Cost=a.Value,i.e.IsEmpty(s.Cost)||i.e.IsEmpty(s.Hrs)||(s.Value=parseFloat(s.Cost)*parseFloat(s.Hrs)),e.GridObj.addRow(s)},o=0;o<n.length;o++)r(o)}else if(37==e.Parent.ScreenObject.DocumentType){var l=e.ds.Tables[1].filter((function(n){return n.BOMID==e.Boms.SelectedValue&&(Object(u.isUndefined)(t)||n.StageID==t)&&(Object(u.isUndefined)(a)||n.DimID==a)}));if(l.length>0)for(var c=function(t){var a=l[t],n=e.GridObj.NewRow();if(n.DocSeqNo=e.GridData.length+1,n.Select=!1,n.DocDetailsID="0",!i.e.IsEmpty(a.StageID)&&e.ds.Tables.length>3&&e.ds.Columns[3].Contains("BOMID")){var s=e.ds.Tables[3].filter((function(t){return t.BOMID==e.Boms.SelectedValue&&t.StageID==a.StageID}));s.length>0&&(n.StageID=s[0].StageID,n.StageNodeID=s[0].StageNodeID,n.StageName=s[0].Name)}n.Name=a.Name.toString(),n.Credit=a.CRAccountName.toString(),n.CreditAccountID=a.CreditAccountID.toString(),n.DebitAccountID=a.DebitAccountID.toString(),n.Debit=a.DRAccountName.toString(),n.Amt=a.Value.toString(),n.Used=a.Used.toString(),n.Balance=i.e.IsEmpty(n.Used)||i.e.IsEmpty(n.Amt)?a.Value:parseFloat(n.Amt)-parseFloat(n.Used),n.Value=n.Balance,e.GridObj.addRow(n)},d=0;d<l.length;d++)c(d)}else{var h,D=0;h=e.Parent.ScreenObject.IsPurchase&&"Output"==e.IO.SelectedValue?2:1;var m=e.ds.Tables[1].filter((function(n){return n.BOMID==e.Boms.SelectedValue&&(Object(u.isUndefined)(t)||n.StageID==t)&&(Object(u.isUndefined)(a)||n.DimID==a)&&n.ProductUse==h}));if(m.length>0){for(var b=function(n){var r=m[n],o=e.GridObj.NewRow();if(o.DocSeqNo=e.GridData.length+1,o.Select=!1,o.DocDetailsID="0",o.ProductType=r.ProductTypeID,o.AutoStage=r.AutoStage,e.ds.Columns[1].Contains("RemainingQty")&&!i.e.IsEmpty(r.RemainingQty)&&parseFloat(r.RemainingQty)>0&&(D=parseFloat(r.RemainingQty)),e.Parent.ScreenObject.IsPurchase){o.ActualQty=r.Quantity,o.OPQTY=r.Quantity;var l=e.ds.Tables[0].filter((function(t){return t.BOMID==e.Boms.SelectedValue&&(Object(u.isUndefined)(a)||t.DimID==a)}));o.BatchSize=l.length>0&&e.ds.Columns[0].Contains("FPQty")&&!i.e.IsEmpty(l[0].FPQty)?l[0].FPQty:0}else{o.IPQTY=r.Quantity;var c=e.ds.Tables[1].filter((function(n){return n.BOMID==e.Boms.SelectedValue&&(Object(u.isUndefined)(t)||n.StageID==t)&&(Object(u.isUndefined)(a)||n.DimID==a)&&2==n.ProductUse})),d=e.ds.Tables[1].filter((function(t){return t.BOMID==e.Boms.SelectedValue}));o.BatchSize=d.length>0&&e.ds.Columns[0].Contains("FPQty")&&!i.e.IsEmpty(d[0].FPQty)?d[0].FPQty:0,o.OPQTY=c.length>0&&!i.e.IsEmpty(c[0].Quantity)?c[0].Quantity:0,d=e.ds.Tables[0].filter((function(n){return n.BOMID==e.Boms.SelectedValue&&(Object(u.isUndefined)(t)||n.StageID==t)&&(Object(u.isUndefined)(a)||n.DimID==a)})),o.ActualQty=d.length>0&&e.ds.Columns[0].Contains("IsBom")&&!i.e.IsEmpty(d[0].IsBom)&&Object(s.j)(d[0].IsBom)||e.ds.Tables.length>2&&e.ds.Tables[2].length>0&&e.ds.Columns[2].Contains("ccAlpha41")&&"BOM"==e.ds.Tables[2][0].ccAlpha41?r.Quantity:c.length>0&&!i.e.IsEmpty(c[0].Quantity)&&1!=parseFloat(c[0].Quantity)&&!i.e.IsEmpty(r.Quantity)?parseFloat(r.Quantity)/parseFloat(c[0].Quantity):r.Quantity}if(!i.e.IsEmpty(r.StageID)&&e.ds.Tables.length>3&&e.ds.Columns[3].Contains("BOMID")){var h=e.ds.Tables[3].filter((function(t){return t.BOMID==e.Boms.SelectedValue&&t.StageID==r.StageID}));h.length>0&&(o.StageID=h[0].StageID,o.StageNodeID=h[0].StageNodeID,o.StageName=h[0].Name)}if(o.UnitPrice=r.UnitPrice,i.e.IsEmpty(r.QOH)||(o.QOH=parseFloat(r.QOH).ToString("N"+e.decimalpoints)),o.Used=i.e.IsEmpty(r.Conversion)||i.e.IsEmpty(r.Used)||1==parseFloat(r.Conversion)?r.Used:parseFloat(r.Used)/parseFloat(r.Conversion),o.Wastage=r.Wastage,o.ProductName=r.ProductName,o.ProductCode=r.ProductCode,o.ProductID_Key=r.ProductID,o.Remarks=r.Remarks,o.UOMID_Key=r.UOMID,o.UOMID=r.UnitName,o.BaseConversion=r.Conversion,e.Parent.ScreenObject.IsPurchase)if("Output"==e.IO.SelectedValue){var b=e.ds.Tables[0].filter((function(n){return n.BOMID==e.Boms.SelectedValue&&n.ProductID==r.ProductID&&(Object(u.isUndefined)(t)||n.StageID==t)&&(Object(u.isUndefined)(a)||n.DimID==a)}));b.length>0?(o.Qty=b[0].Qty,e.ds.Columns[0].Contains("IsBom")&&!i.e.IsEmpty(b[0].IsBom)&&!e.IsBom&&Object(s.j)(b[0].IsBom)&&(o.Qty=parseFloat(o.Qty)*parseFloat(r.Quantity))):e.ds.Tables.length>2&&e.ds.Tables[2].length>0&&e.ds.Columns[2].Contains("ccAlpha50")&&(o.Qty=e.ds.Tables[2][0].ccAlpha50,e.ds.Columns[2].Contains("ccAlpha41")&&"BOM"==e.ds.Tables[2][0].ccAlpha41&&(o.Qty=parseFloat(o.Qty)*parseFloat(r.Quantity)));var S=i.e.DoubleTryParse(o.Used),C=i.e.DoubleTryParse(o.Qty);0!=C&&S>0?(S=C-S,o.Balance=S>0?S.ToString("N"+e.decimalpoints):0):o.Balance=o.Qty,o.Value=o.Balance}else{e.ds.Columns[1].Contains("Issued")&&(o.Qty=r.Issued.toString());var y=i.e.DoubleTryParse(o.Used),p=i.e.DoubleTryParse(o.Qty);0!=p&&y>0?(y=p-y,o.Balance=y>0?y.ToString("N"+e.decimalpoints):0):o.Balance=o.Qty,o.Value="0"}e.GridObj.addRow(o)},S=0;S<m.length;S++)b(S);if(!e.Parent.ScreenObject.IsPurchase){if((m=e.ds.Tables[0].filter((function(n){return n.BOMID==e.Boms.SelectedValue&&(Object(u.isUndefined)(t)||n.StageID==t)&&(Object(u.isUndefined)(a)||n.DimID==a)}))).length>0?e.QTY.Text=m[0].Qty:e.ds.Tables.length>2&&e.ds.Tables[2].length>0&&e.ds.Columns[2].Contains("ccAlpha50")&&(e.QTY.Text=e.ds.Tables[2][0].ccAlpha50.toString()),D>0){if(i.e.IsNum(e.QTY.Text)){var C=parseFloat(e.QTY.Text)-D;e.RemQTY.Text=C>0?C.ToString("N"+e.decimalpoints):"0"}}else{var y=0,p=0;e.GridData.length>0&&i.e.DoubleTryParse(e.GridData[0].Used)>0&&i.e.DoubleTryParse(e.QTY.Text)>0?(i.e.IsNum(e.GridData[0].ActualQty)&&(y=parseFloat(e.GridData[0].ActualQty)*parseFloat(e.QTY.Text)),0!=(p=i.e.DoubleTryParse(e.GridData[0].Wastage))&&(p=y*p/100),y+=p,0!=(p=i.e.DoubleTryParse(e.GridData[0].Used))&&(p/=parseFloat(y.ToString("N"+e.decimalpoints))),p=parseFloat(e.QTY.Text)-parseFloat(e.QTY.Text)*p,e.RemQTY.Text=p>0?p.ToString("N"+e.decimalpoints):"0"):e.RemQTY.Text=e.QTY.Text}e.CalcQty()}}}}()}},{key:"CalcRemQty",value:function(){if(i.e.IsNum(this.RemQTY.Text)){this.RemaingQuantity=parseFloat(this.RemQTY.Text);for(var e=0;e<this.GridData.length;e++)i.e.IsNum(this.GridData[e].ActualQty)&&(this.GridData[e].Value=parseFloat(this.GridData[e].ActualQty)*this.RemaingQuantity)}}},{key:"CalcQty",value:function(){var e;if(i.e.IsNum(this.QTY.Text)){this.RemaingQuantity=i.e.DoubleTryParse(this.QTY.Text);for(var t=0;t<this.GridData.length;t++){var a=0;i.e.IsNum(this.GridData[t].ActualQty)&&(a=parseFloat(this.GridData[t].ActualQty),this.GridData[t].Qty=(a*this.RemaingQuantity).ToString("N"+this.decimalpoints),a*=this.RemaingQuantity),0!=(e=i.e.DoubleTryParse(this.GridData[t].Wastage))&&(e=a*e/100),a+=e,this.GridData[t].Net=a.ToString("N"+this.decimalpoints),i.e.IsNum(this.GridData[t].Used)?(e=a-(e=parseFloat(this.GridData[t].Used)),this.GridData[t].Balance=e>0?e.ToString("N"+this.decimalpoints):0):this.GridData[t].Balance=this.GridData[t].Net,this.GridData[t].Value=this.GridData[t].Balance}}}},{key:"onStageChanged",value:function(e){this.FillJobProducts()}},{key:"FillJobDetails",value:function(){var e,t,a=this,r=i.e.IntTryParse(n.a.SessionManager.Preferences["Maintain Dimensionwise stock"]),o="";if(r>0&&(e=this.Parent.ScreenObject._CCFields.find((function(e){return e.DBColumnName.toLowerCase()=="dcccnid"+(r-5e4)})))&&e instanceof h.b&&e.SelectedValue>0&&(o+=" dcCCNID"+(r-5e4)+"="+e.SelectedValue+" and "),n.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==n.a.SessionManager.Preferences.EnableLocationWise&&n.a.SessionManager.Preferences.ContainsKey("Location Stock")&&Object(s.j)(n.a.SessionManager.Preferences["Location Stock"])&&((e=this.Parent.ScreenObject._CCFields.find((function(e){return"dcccnid2"==e.DBColumnName.toLowerCase()})))&&e instanceof h.b?e.SelectedValue>0&&(o+=" dcCCNID2="+e.SelectedValue+" and "):this.Parent.ScreenObject.LocationID>0?o+=" dcCCNID2="+this.Parent.ScreenObject.LocationID+" and ":n.a.SessionManager.LocationID>0&&(o+=" dcCCNID2="+n.a.SessionManager.LocationID+" and ")),!1,n.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"true"==n.a.SessionManager.Preferences.EnableDivisionWise.toLowerCase()&&n.a.SessionManager.Preferences.ContainsKey("Division Stock")&&Object(s.j)(n.a.SessionManager.Preferences["Division Stock"])&&((e=this.Parent.ScreenObject._CCFields.find((function(e){return"dcccnid1"==e.DBColumnName.toLowerCase()})))&&e instanceof h.b?e.SelectedValue>0&&(o+=" dcCCNID1="+e.SelectedValue+" and "):this.Parent.ScreenObject.DivisionID>0?o+=" dcCCNID1="+this.Parent.ScreenObject.DivisionID+" and ":n.a.SessionManager.DivisionID>0&&(o+=" dcCCNID1="+n.a.SessionManager.DivisionID+" and ")),this.ds=this.Parent.ScreenObject.GetjobDetails(this.JobNodeID,o,this.Parent.DocumentDate,this.IsBom),null!=this.ds&&this.ds.Tables.length>0&&!this.ds.Columns[0].Contains("ErrorMessage")&&this.ds.Tables[0].length>0){if(36==this.Parent.ScreenObject.DocumentType){(t=new d.a).Header=n.a.GetResource("Machine"),t.DisplayMember="Machine",t.Width=120,t.ReadOnly=!0,this.ColumnSource.push(t),(t=new d.a).Header="Total Hrs",t.DisplayMember="TotalHrs",t.DataType="FLOAT",t.Width=54,t.ReadOnly=!0,t.IsVisible=!0,this.ColumnSource.push(t),(t=new d.a).Header="Used",t.DisplayMember="Used",t.DataType="FLOAT",t.Width=54,t.ReadOnly=!0,t.IsVisible=!0,this.ColumnSource.push(t),(t=new d.a).Header="Balance",t.DisplayMember="Balance",t.DataType="FLOAT",t.Width=54,t.ReadOnly=!0,t.IsVisible=!0,this.ColumnSource.push(t),(t=new d.a).Header="value",t.DisplayMember="Hrs",t.DataType="FLOAT",t.Width=54,t.IsVisible=!0,this.ColumnSource.push(t),(t=new d.a).Header="Cost/Hr",t.DisplayMember="Cost",t.DataType="FLOAT",t.Width=70,t.ReadOnly=!0,t.IsVisible=!0,n.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=n.a.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=n.a.SessionManager.Preferences.DecimalsinRate),this.ColumnSource.push(t),this.GridObj.TableColumns.push("Machine"),this.GridObj.TableColumns.push("MachineID"),this.GridObj.TableColumns.push("Hrs"),this.GridObj.TableColumns.push("Value"),this.GridObj.TableColumns.push("Cost"),this.GridObj.TableColumns.push("Balance"),this.GridObj.TableColumns.push("Used"),this.GridObj.TableColumns.push("TotalHrs"),this.GridObj.TableColumns.push("CrAccountID"),this.GridObj.TableColumns.push("CrAccount"),this.GridObj.TableColumns.push("DrAccountID"),this.GridObj.TableColumns.push("DrAccount");var l=this.Parent.ScreenObject.getmachinePref();if(null!=l&&l.Tables.length>0&&l.Columns[0].Contains("Name"))for(var u=0;u<l.Tables[0].length;u++)!i.e.IsEmpty(l.Tables[0][u].Value)&&i.e.Int(l.Tables[0][u].Value)>0&&(this.AddedGridObj.TableColumns.push(l.Tables[0][u].Name.toString()),this.GridObj.TableColumns.push(l.Tables[0][u].Name.toString()),this.Parent.ScreenObject.Preferences.ContainsKey(l.Tables[0][u].Name.toString())||this.Parent.ScreenObject.Preferences.push(l.Tables[0][u].Name.toString(),l.Tables[0][u].Value.toString()));(t=new d.a).Header=n.a.GetResource("Machine"),t.DisplayMember="Machine",t.Width=120,this.AddedColumnSource.push(t),(t=new d.a).Header=n.a.GetResource("HRS"),t.DisplayMember="Hrs",t.DataType="FLOAT",t.Width=54,t.IsVisible=!0,this.AddedColumnSource.push(t),(t=new d.a).Header="Cost/Hr",t.DisplayMember="Cost",t.DataType="FLOAT",t.Width=70,t.IsVisible=!0,n.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=n.a.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=n.a.SessionManager.Preferences.DecimalsinRate),this.AddedColumnSource.push(t),(t=new d.a).Header="Value",t.DisplayMember="Value",t.DataType="FLOAT",t.Width=70,t.IsVisible=!0,n.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=n.a.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=n.a.SessionManager.Preferences.DecimalsinRate),this.AddedColumnSource.push(t),this.AddedGridObj.TableColumns.push("Machine"),this.AddedGridObj.TableColumns.push("MachineID"),this.AddedGridObj.TableColumns.push("Hrs"),this.AddedGridObj.TableColumns.push("Value"),this.AddedGridObj.TableColumns.push("Cost"),this.AddedGridObj.TableColumns.push("CrAccountID"),this.AddedGridObj.TableColumns.push("CrAccount"),this.AddedGridObj.TableColumns.push("DrAccountID"),this.AddedGridObj.TableColumns.push("DrAccount")}else 37==this.Parent.ScreenObject.DocumentType?((t=new d.a).Header="Name",t.DisplayMember="Name",t.DataType="TextBlock",t.Width=140,this.ColumnSource.push(t),(t=new d.a).Header="Debit",t.DisplayMember="Debit",t.Width=155,t.IsVisible=!0,this.ColumnSource.push(t),(t=new d.a).Header="Credit",t.DisplayMember="Credit",t.Width=155,t.IsVisible=!0,this.ColumnSource.push(t),(t=new d.a).Header="Total Amount",t.DisplayMember="Amt",t.DataType="FLOAT",t.Width=85,t.IsVisible=!0,n.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=n.a.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=n.a.SessionManager.Preferences.DecimalsinRate),this.ColumnSource.push(t),(t=new d.a).Header="Used",t.DisplayMember="Used",t.DataType="FLOAT",t.Width=85,t.IsVisible=!0,n.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=n.a.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=n.a.SessionManager.Preferences.DecimalsinRate),this.ColumnSource.push(t),(t=new d.a).Header="Balance",t.DisplayMember="Balance",t.DataType="FLOAT",t.Width=85,t.IsVisible=!0,n.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=n.a.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=n.a.SessionManager.Preferences.DecimalsinRate),this.ColumnSource.push(t),(t=new d.a).Header=n.a.GetResource("Value"),t.DisplayMember="Value",t.DataType="FLOAT",t.Width=85,t.IsVisible=!0,n.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=n.a.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=n.a.SessionManager.Preferences.DecimalsinRate),this.ColumnSource.push(t),this.GridObj.TableColumns.push("Name"),this.GridObj.TableColumns.push("Credit"),this.GridObj.TableColumns.push("CreditAccountID"),this.GridObj.TableColumns.push("DebitAccountID"),this.GridObj.TableColumns.push("Debit"),this.GridObj.TableColumns.push("Value"),this.GridObj.TableColumns.push("Amt"),this.GridObj.TableColumns.push("Used"),this.GridObj.TableColumns.push("Balance"),(t=new d.a).Header="Name",t.DisplayMember="Name",t.DataType="TextBlock",t.Width=140,this.AddedColumnSource.push(t),(t=new d.a).Header="Debit",t.DisplayMember="Debit",t.Width=155,t.IsVisible=!0,this.AddedColumnSource.push(t),(t=new d.a).Header="Credit",t.DisplayMember="Credit",t.Width=155,t.IsVisible=!0,this.AddedColumnSource.push(t),(t=new d.a).Header=n.a.GetResource("Value"),t.DisplayMember="Value",t.DataType="FLOAT",t.Width=85,t.IsVisible=!0,n.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=n.a.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=n.a.SessionManager.Preferences.DecimalsinRate),this.AddedColumnSource.push(t),this.AddedGridObj.TableColumns.push("Name"),this.AddedGridObj.TableColumns.push("Credit"),this.AddedGridObj.TableColumns.push("CreditAccountID"),this.AddedGridObj.TableColumns.push("DebitAccountID"),this.AddedGridObj.TableColumns.push("Debit"),this.AddedGridObj.TableColumns.push("Value")):((t=new d.a).Header="Product Code",t.DisplayMember="ProductCode",t.DataType="TextBlock",t.Width=100,t.ReadOnly=!0,this.ColumnSource.push(t),(t=new d.a).Header="Product Name",t.DisplayMember="ProductName",t.DataType="TextBlock",t.Width=180,t.ReadOnly=!0,this.ColumnSource.push(t),(t=new d.a).Header="QOH",t.DisplayMember="QOH",t.DataType="TextBlock",t.Width=80,t.ReadOnly=!0,this.ColumnSource.push(t),(t=new d.a).Header="Qty",t.DisplayMember="Qty",t.DataType="TextBlock",t.Width=80,t.ReadOnly=!0,this.ColumnSource.push(t),this.Parent.ScreenObject.IsPurchase||((t=new d.a).Header="Wastage",t.DisplayMember="Wastage",t.DataType="TextBlock",t.Width=70,t.ReadOnly=!0,this.ColumnSource.push(t),(t=new d.a).Header="Net Qty",t.DisplayMember="Net",t.DataType="TextBlock",t.Width=80,t.ReadOnly=!0,this.ColumnSource.push(t)),(t=new d.a).Header=this.Parent.ScreenObject.IsPurchase?"Recieved":"Issued",t.DisplayMember="Used",t.DataType="TextBlock",t.Width=80,t.ReadOnly=!0,this.ColumnSource.push(t),(t=new d.a).Header="Balance",t.DisplayMember="Balance",t.DataType="TextBlock",t.Width=80,t.ReadOnly=!0,this.ColumnSource.push(t),(t=new d.a).Header=this.Parent.ScreenObject.IsPurchase?"Yield/Recieve Qty":"Yield/Issue Qty",t.DisplayMember="Value",t.DataType="TextBlock",t.Width=80,n.a.SessionManager.IsActionAssigned(43,"Donot Allow to change Yield Qty")&&(t.ReadOnly=!0),this.ColumnSource.push(t),(t=new d.a).Header="Units",t.Width=80,t.DisplayMember="UOMID",t.ValueMember="UOMID_Key",t.DataType="LISTBOX",t.CostCenterID=11,t.TypeID=1,this.Parent.ScreenObject.IsPurchase?n.a.SessionManager.IsActionAssigned(43,"Donot Allow to change Yield Qty")&&(t.ReadOnly=!0):t.ReadOnly=!0,this.ColumnSource.push(t),this.GridObj.TableColumns.push("UnitPrice"),this.GridObj.TableColumns.push("ActualQty"),this.GridObj.TableColumns.push("Wastage"),this.GridObj.TableColumns.push("Qty"),this.GridObj.TableColumns.push("Net"),this.GridObj.TableColumns.push("Balance"),this.GridObj.TableColumns.push("Used"),this.GridObj.TableColumns.push("QOH"),this.GridObj.TableColumns.push("Value"),this.GridObj.TableColumns.push("UOMID"),this.GridObj.TableColumns.push("UOMID_Key"),this.GridObj.TableColumns.push("BaseConversion"),this.GridObj.TableColumns.push("AutoStage"),this.GridObj.TableColumns.push("Remarks"),this.AddedGridObj.TableColumns.push("Qty"),this.AddedGridObj.TableColumns.push("ProductName"),this.AddedGridObj.TableColumns.push("ProductCode"),this.AddedGridObj.TableColumns.push("ProductID_Key"),this.AddedGridObj.TableColumns.push("IsOutput"),this.AddedGridObj.TableColumns.push("ProductType"),this.AddedGridObj.TableColumns.push("UOMID"),this.AddedGridObj.TableColumns.push("UOMID_Key"),this.AddedGridObj.TableColumns.push("Net"),this.AddedGridObj.TableColumns.push("AutoStage"),this.AddedGridObj.TableColumns.push("UnitPrice"),this.AddedGridObj.TableColumns.push("Remarks"),(t=new d.a).Header="Bom",t.DisplayMember="BomName",t.DataType="TextBlock",t.Width=100,t.ReadOnly=!0,this.AddedColumnSource.push(t),this.ds.Tables.length>2&&this.ds.Tables[2].length>0&&!i.e.IsEmpty(this.ds.Tables[2][0].StageCCID)&&parseInt(this.ds.Tables[2][0].StageCCID)>0&&((t=new d.a).Header="Stage",t.DisplayMember="StageName",t.DataType="TextBlock",t.Width=60,t.ReadOnly=!0,this.AddedColumnSource.push(t)),(t=new d.a).Header="Product Code",t.DisplayMember="ProductCode",t.DataType="TextBlock",t.Width=100,t.ReadOnly=!0,this.AddedColumnSource.push(t),(t=new d.a).Header="Product Name",t.DisplayMember="ProductName",t.DataType="TextBlock",t.Width=180,t.ReadOnly=!0,this.AddedColumnSource.push(t),(t=new d.a).Header="Qty",t.DisplayMember="Qty",t.DataType="TextBlock",t.Width=50,t.ReadOnly=!0,this.AddedColumnSource.push(t),(t=new d.a).Header="Units",t.DisplayMember="UOMID",t.DataType="TextBlock",t.Width=80,t.ReadOnly=!0,this.AddedColumnSource.push(t),!this.Parent.ScreenObject.IsPurchase&&this.Parent.ScreenObject.Preferences.ContainsKey("JobRemainingQty")&&this.AddedGridObj.TableColumns.push("RemainingQty"));this.GridObj.TableColumns.push("StageNodeID"),this.GridObj.TableColumns.push("StageName"),this.GridObj.TableColumns.push("StageID"),this.GridObj.TableColumns.push("IPQTY"),this.GridObj.TableColumns.push("OPQTY"),this.GridObj.TableColumns.push("BatchSize"),this.AddedGridObj.TableColumns.push("StageNodeID"),this.AddedGridObj.TableColumns.push("StageID"),this.AddedGridObj.TableColumns.push("BomID"),this.AddedGridObj.TableColumns.push("BomNodeID"),this.AddedGridObj.TableColumns.push("StageName"),this.AddedGridObj.TableColumns.push("BomName"),this.AddedGridObj.TableColumns.push("IPQTY"),this.AddedGridObj.TableColumns.push("OPQTY"),this.AddedGridObj.TableColumns.push("BatchSize"),this.AddedGridObj.TableColumns.push("RemQty"),this.AddedGridObj.TableColumns.push("ActualQty");for(var D=function(e){0==a.Boms.Items.filter((function(t){return null!=t.Value&&t.Value==a.ds.Tables[0][e].BOMID})).length&&a.Boms.Items.push(c.d.ComboBoxItems_4(a.ds.Tables[0][e].BomName.toString(),a.ds.Tables[0][e].BOMID,a.ds.Tables[0][e].CCID,a.ds.Tables[0][e].CCNodeID))},m=0;m<this.ds.Tables[0].length;m++)D(m);1==this.Boms.Items.length&&(this.Boms.SelectedValue=this.Boms.Items[0].Value,this.onBomChanged(""))}}},{key:"FillLinkDocDetails",value:function(e){var t,a=this,r=[],o=[],l=e;if(this.Parent.ScreenObject.Preferences.ContainsKey("StaticLinkingColumns")&&""!=this.Parent.ScreenObject.Preferences.StaticLinkingColumns){var c=new i.f;c.LoadXml(this.Parent.ScreenObject.Preferences.StaticLinkingColumns);for(var u=0;u<c.DocumentElement.children.length;u++){var h=c.DocumentElement.children[u],D=new d.a;D.Header=h.attributes.Header.value,D.DisplayMember=h.attributes.Name.value,D.DisplayIndex=parseInt(h.attributes.index.value),D.Width=parseInt(h.attributes.WIDTH.value),r.push(D)}}if(this.ColumnSource.forEach((function(e){o.push(e)})),["ProductCode","ProductName"].forEach((function(n){var i=a.Parent.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember==n}));if(i){(t=new d.a).Header=i.Header,t.DisplayMember=i.DisplayMember,t.DataType=i.DataType,t.Width=i.Width,t.ValueMember=i.ValueMember,t.CostCenterID=i.CostCenterID,t.TypeID=i.TypeID,t.ReadOnly=!0,null!=e&&l.length>0&&"ProductCode"==i.DisplayMember&&(e=l.filter((function(e){return"GroupCheckBox"==e.PrefValueType&&"ProductCode"==e.PrefName})),a.JobNodeID>0?t.IsVisible=!0:e.length>0&&(t.IsVisible=Object(s.j)(e[0].PrefValue))),null!=e&&l.length>0&&"ProductName"==i.DisplayMember&&(e=l.filter((function(e){return"GroupCheckBox"==e.PrefValueType&&"ProductName"==e.PrefName})),a.JobNodeID>0?t.IsVisible=!0:e.length>0&&(t.IsVisible=Object(s.j)(e[0].PrefValue)));var c=r.find((function(e){return e.DisplayMember==t.DisplayMember}));c&&(t.DisplayIndex=c.DisplayIndex,t.Width=c.Width),o.Contains(t)||o.push(t)}})),null!=this.ds&&this.ds.Tables.length>5&&this.ds.Tables[5].length>0&&(this.ds.Columns[5].Contains("IsQtyIgnored")&&"1"==this.ds.Tables[5][0].IsQtyIgnored.toString()||this.Parent.ScreenObject.Preferences.ContainsKey("CopyBatches")&&!i.e.IsEmpty(this.Parent.ScreenObject.Preferences.CopyBatches)&&Object(s.j)(this.Parent.ScreenObject.Preferences.CopyBatches))&&((t=new d.a).Header="Batch",t.DisplayMember="BatchNo",t.DataType="TextBlock",t.Width=100,t.ReadOnly=!0,o.push(t)),null!=this.ds&&this.ds.Tables.length>0&&!this.ds.Columns[0].Contains("ErrorMessage")&&this.ds.Tables[0].length>0){var m;this.GridObj.TableColumns.Contains(this.ds.Tables[0][0][this.ds.Columns[0][1]].toString())||(this.GridObj.TableColumns.push(this.ds.Tables[0][0][this.ds.Columns[0][1]].toString()),(t=new d.a).Header=this.ds.Tables[0][0][this.ds.Columns[0][2]].toString(),t.DisplayMember=this.ds.Tables[0][0][this.ds.Columns[0][1]].toString(),t.DataType="FLOAT",t.Width=100,t.ReadOnly=!0,null!=e&&l.length>0&&(e=l.filter((function(e){return"GroupCheckBox"==e.PrefValueType&&"Qty"==e.PrefName}))).length>0&&(t.IsVisible=Object(s.j)(e[0].PrefValue)),(m=r.find((function(e){return"Qty"==e.DisplayMember})))&&(t.DisplayIndex=m.DisplayIndex,t.Width=m.Width),o.Contains(t)||o.push(t)),this.GridObj.TableColumns.push("Executed"),null!=e&&l.length>0&&(e=l.filter((function(e){return"GroupCheckBox"==e.PrefValueType&&"QOH"==e.PrefName}))).length>0&&Object(s.j)(e[0].PrefValue)&&(this.GridObj.TableColumns.push("QOH"),(t=new d.a).Header="QOH",t.DisplayMember="QOH",t.DataType="FLOAT",t.Width=100,t.ReadOnly=!0,(m=r.find((function(e){return e.DisplayMember==t.DisplayMember})))&&(t.DisplayIndex=m.DisplayIndex,t.Width=m.Width),o.push(t)),(t=new d.a).Header=n.a.GetResource("Doc_Executed")+" "+this.ds.Tables[0][0][this.ds.Columns[0][2]].toString(),t.DisplayMember="Executed",t.DataType="FLOAT",t.Width=100,t.ReadOnly=!0,null!=e&&l.length>0&&(e=l.filter((function(e){return"GroupCheckBox"==e.PrefValueType&&"ExecutedQty"==e.PrefName}))).length>0&&(t.IsVisible=Object(s.j)(e[0].PrefValue));var b=r.find((function(e){return"ExecutedQty"==e.DisplayMember}));b&&(t.DisplayIndex=b.DisplayIndex,t.Width=b.Width),o.Contains(t)||o.push(t),this.GridObj.TableColumns.push("Balance"),(t=new d.a).Header=n.a.GetResource("Doc_Balance")+" "+this.ds.Tables[0][0][this.ds.Columns[0][2]].toString(),t.DisplayMember="Balance",t.DataType="FLOAT",t.Width=100,t.ReadOnly=!0,null!=e&&l.length>0&&(e=l.filter((function(e){return"GroupCheckBox"==e.PrefValueType&&"BalanceQty"==e.PrefName}))).length>0&&(t.IsVisible=Object(s.j)(e[0].PrefValue)),(b=r.find((function(e){return"BalanceQty"==e.DisplayMember})))&&(t.DisplayIndex=b.DisplayIndex,t.Width=b.Width),o.Contains(t)||o.push(t),(t=new d.a).Header=this.Parent.ScreenObject.Preferences.ContainsKey("LinkHeaderText")&&!i.e.IsEmpty(this.Parent.ScreenObject.Preferences.LinkHeaderText)?this.Parent.ScreenObject.Preferences.LinkHeaderText:n.a.GetResource("Doc_LinkQty"),t.DisplayMember="TobeUsed",t.DataType="FLOAT",t.Width=100,null!=e&&l.length>0&&(e=l.filter((function(e){return"GroupCheckBox"==e.PrefValueType&&"LinkValue"==e.PrefName}))).length>0&&(t.IsVisible=Object(s.j)(e[0].PrefValue)),(b=r.find((function(e){return"LinkValue"==e.DisplayMember})))&&(t.DisplayIndex=b.DisplayIndex,t.Width=b.Width),o.Contains(t)||o.push(t),this.ds.Tables.length>6&&!this.ds.Columns[6].Contains("ErrorMessage")&&(this.GenerateColumns(o,r),this.ColumnSource=[],o.sort((function(e,t){return e.DisplayIndex-t.DisplayIndex})).forEach((function(e){a.ColumnSource.push(e)}))),this.AssignValues()}if(this.Parent.ScreenObject.Preferences.ContainsKey("MandatoryScanning")&&""!=this.Parent.ScreenObject.Preferences.MandatoryScanning.toString()&&Object(s.j)(this.Parent.ScreenObject.Preferences.MandatoryScanning)||this.Parent.ScreenObject.Preferences.ContainsKey("EnableScanning")&&""!=this.Parent.ScreenObject.Preferences.EnableScanning.toString()&&Object(s.j)(this.Parent.ScreenObject.Preferences.EnableScanning)){this.ScanText.Visible=!0,this.ScanText.SetFocus=!0,this.GridObj.TableColumns.push("ScanProduct"),this.GridObj.TableColumns.push("ScannedBarcodes"),(t=new d.a).Header="Scan Product",t.DisplayMember="ScanProduct",t.DataType="TextBlock",t.Width=100,t.ReadOnly=!1,this.ColumnSource.push(t),this.Parent.ScreenObject.Preferences.ContainsKey("MandatoryScanning")&&""!=this.Parent.ScreenObject.Preferences.MandatoryScanning.toString()&&Object(s.j)(this.Parent.ScreenObject.Preferences.MandatoryScanning)&&(C=this.ColumnSource.find((function(e){return null!=e.DisplayMember&&"TobeUsed"==e.DisplayMember})))&&(C.ReadOnly=!0);for(var S=0;S<this.GridData.length;S++)i.e.IsEmpty(this.GridData[S].ProductID_Key)||(this.GridData[S].TobeUsed=null)}else this.ScanText.Visible=!1;if(this.Parent.ScreenObject.Preferences.ContainsKey("ScanPack")&&""!=this.Parent.ScreenObject.Preferences.ScanPack.toString()&&Object(s.j)(this.Parent.ScreenObject.Preferences.ScanPack)){var C;this.ScanText.Visible=!0,(C=this.ColumnSource.find((function(e){return null!=e.DisplayMember&&"TobeUsed"==e.DisplayMember})))&&(C.ReadOnly=!0);for(var y=0;y<this.GridData.length;y++)i.e.IsEmpty(this.GridData[y].ProductID_Key)||(this.GridData[y].TobeUsed=null);this.AddGridVisbility=!0,(t=new d.a).Header="#",t.DisplayMember="Sno",t.DataType="TextBlock",t.Width=25,t.ReadOnly=!0,this.AddedColumnSource.push(t),(t=new d.a).Header="Pending Packs",t.DisplayMember="PackName",t.DataType="TextBlock",t.Width=100,t.ReadOnly=!0,this.AddedColumnSource.push(t),(t=new d.a).Header="Label",t.DisplayMember="Packs",t.DataType="TextBlock",t.Width=100,t.ReadOnly=!0,this.AddedColumnSource.push(t),this.AddedGridObj.TableColumns.push("Sno"),this.AddedGridObj.TableColumns.push("Packs"),this.AddedGridObj.TableColumns.push("RefID"),this.AddedGridObj.TableColumns.push("PackName"),this.FillPacks()}this.ScanText.Label="Scan"}},{key:"sort",value:function(){var e=this;this.Parent.ScreenObject.Preferences.ContainsKey("linksortcols")&&""!=this.Parent.ScreenObject.Preferences.linksortcols&&(this.Parent.ScreenObject.Preferences.linksortcols.split(",").forEach((function(t){var a=t.Replace(" ASC","").Replace(" DESC","");if(a.startsWith("sort_")){var n=a.Replace("sort_","");if(e.GridObj.TableColumns.Contains(n)){e.GridObj.TableColumns.push("tempcolname");for(var s=0;s<e.GridData.length;s++)!i.e.IsEmpty(e.GridData[s][n])&&i.e.Double(e.GridData[s][n])>0&&(e.GridData[s][a]=parseFloat(e.GridData[s][n].toString()))}else e.GridObj.TableColumns.push(n)}else e.GridObj.TableColumns.Contains(a)||e.GridObj.TableColumns.push(a)})),this.RefreshSno())}},{key:"RemovePack",value:function(e){var t=this.AddGridData.filter((function(t){return t.Packs==e}));if(t.length>0){this.AddGridData.Remove(t[0]);for(var a=1,n=0;n<this.AddGridData.length;n++)this.AddGridData[n].Sno=a.toString(),a++}}},{key:"FillPacks",value:function(){var e,t=this,a=this.Parent.ScreenObject.GetScannedPacks(this.VoucherNo);if(null!=a&&a.Tables.length>0&&a.Columns[0].Contains("label"))for(var s=0;s<a.Tables[0].length;s++)null==this.packs&&(this.packs=[]),this.packs.Contains(a.Tables[0][s].label.toString())||this.packs.push(a.Tables[0][s].label.toString());if(null!=this.Parent.DtPack&&this.Parent.DtPack.length>0){null==this.packs&&(this.packs=[]);for(var r=0;r<this.Parent.DtPack.length;r++)i.e.IsEmpty(this.Parent.DtPack[r].Label)||this.packs.push(this.Parent.DtPack[r].Label.toString())}null==this.packs&&(this.packs=[]);for(var o="",l=function(a){(e=t.ds.Tables[13].filter((function(e){return 2==e.Type&&e.InvDocDetailsID==t.GridData[a].DocDetailsID}))).length>0&&e.forEach((function(e){if(!t.packs.Contains(e.Label.toString())&&0==t.AddGridData.filter((function(t){return t.Packs==e.Label.toString()})).length){var a=t.AddedGridObj.NewRow();a.Sno=t.AddGridData.length+1,a.Packs=e.Label.toString(),a.RefID=e.RefID.toString(),o.Contains(","+e.RefID.toString()+",")||(o+=e.RefID.toString()+","),t.AddedGridObj.addRow(a)}}))},c=0;c<this.GridData.length;c++)l(c);if(""!=o&&n.a.SessionManager.Preferences.ContainsKey("PackDimension")){var d=this.Parent.ScreenObject.GetdimensionNames(n.a.SessionManager.Preferences.PackDimension,o.substr(0,o.length-1));if(null!=d&&d.Tables.length>0&&!this.ds.Columns[0].Contains("ErrorMessage"))for(var u=function(e){var a=d.Tables[0].filter((function(a){return a.NodeID==t.AddGridData[e].RefID}));a.length>0&&(t.AddGridData[e].PackName=a[0][d.Columns[0][1]].toString())},h=0;h<this.AddGridData.length;h++)u(h)}}},{key:"AssignValues",value:function(){var e=this,t=0,a=this.Parent.ScreenObject.Preferences.DimensionWise;null!=a&&null!=a&&""!==a||(t=0),t=isNaN(a)?0:parseInt(a);var r=1;if(t>0)if(3==t)for(var o=0;o<this.Parent.ScreenObject._TextFields.length;o++){var l=this.Parent.ScreenObject._TextFields[o];if(l instanceof h.b&&l.CCID==t){l.SelectedValue>0&&(r=l.SelectedValue);break}}else if(t>5e4)for(var c=0;c<this.Parent.ScreenObject._CCFields.length;c++){var d=this.Parent.ScreenObject._CCFields[c];if(d instanceof h.b&&d.CCID==t){d.SelectedValue>0&&(r=d.SelectedValue);break}}this.ds.Columns[0].push("Executed");var u="",D="2";n.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=n.a.SessionManager.Preferences.DecimalsinQty&&(D=n.a.SessionManager.Preferences.DecimalsinQty);var m=this.ds.Columns[0][1];if(this.ds.Tables[0].length>0&&!i.e.IsEmpty(this.ds.Tables[0][0][m])&&this.Parent.ScreenObject.GridDataColumns.Contains(this.ds.Tables[0][0][m])){var b=this.Parent.ScreenObject.ColumnSource.find((function(t){return t.DisplayMember.toLowerCase()==e.ds.Tables[0][0][m].toLowerCase()}));b&&""!=b.DecimalPoints&&(D=b.DecimalPoints)}for(var S,C=function(a){if(!i.e.IsEmpty(e.ds.Tables[0][a].DynamicInvDocDetailsID)&&i.e.IsValidID(parseInt(e.ds.Tables[0][a].DynamicInvDocDetailsID)))return y=a,"continue";if(e.Parent.ScreenObject.Preferences.ContainsKey("LinkOnlyFreeQTY")&&Object(s.j)(e.Parent.ScreenObject.Preferences.LinkOnlyFreeQTY)&&e.ds.Columns[0].Contains("IsQtyFreeOffer")&&i.e.DoubleTryParse(e.ds.Tables[0][a].IsQtyFreeOffer)>0&&!(e.ds.Columns[0].Contains("ParentSchemeID")&&i.e.IntTryParse(e.ds.Tables[0][a].ParentSchemeID)>0))return y=a,"continue";if(3==t){if(e.ds.Columns[0].Contains("ProductColName")&&!i.e.IsEmpty(e.ds.Tables[0][a].ProductColName)&&e.ds.Columns[3].Contains(e.ds.Tables[0][a].ProductColName.toString())&&!i.e.IsEmpty(e.ds.Tables[3][a][e.ds.Tables[0][a].ProductColName.toString()])&&i.e.IsNum(e.ds.Tables[3][a][e.ds.Tables[0][a].ProductColName.toString()])&&parseInt(e.ds.Tables[3][a][e.ds.Tables[0][a].ProductColName])!=r)return e.ds.Tables[0].RemoveAt(a),e.ds.Tables[1].RemoveAt(a),e.ds.Tables[2].RemoveAt(a),e.ds.Tables[3].RemoveAt(a),a--,y=a,"continue"}else if(t>0&&e.ds.Columns[1].Contains("dcCCNID"+(t-5e4))&&!i.e.IsEmpty(e.ds.Tables[1][a]["dcCCNID"+(t-5e4)])&&parseInt(e.ds.Tables[1][a]["dcCCNID"+(t-5e4)])!=r)return e.ds.Tables[0].RemoveAt(a),e.ds.Tables[1].RemoveAt(a),e.ds.Tables[2].RemoveAt(a),e.ds.Tables[3].RemoveAt(a),a--,y=a,"continue";if(!i.e.IsEmpty(e.ds.Tables[0][a].ProductID)&&0==parseInt(e.ds.Tables[0][a].ProductID)&&0==e.ds.Tables[0].filter((function(t){return t.DynamicInvDocDetailsID==e.ds.Tables[0][a].DocDetailsID})).length)return e.ds.Tables[0].RemoveAt(a),e.ds.Tables[1].RemoveAt(a),e.ds.Tables[2].RemoveAt(a),e.ds.Tables[3].RemoveAt(a),a--,y=a,"continue";var o=0,l=e.GridObj.NewRow();if(l.DocSeqNo=e.GridData.length+1,l.Select=!1,l.DocDetailsID=e.ds.Tables[0][a].DocDetailsID,l.ProductType=e.ds.Tables[0][a].ProductTypeID,"5"==l.ProductType.toString()&&e.ds.Tables.length>5&&e.ds.Columns[5].Contains("InvDocDetailsID")){var c=e.ds.Tables[5].filter((function(t){return t.InvDocDetailsID==l.DocDetailsID||t.DynamicInvDocDetailsID==e.ds.Tables[0][a].DocDetailsID}));if(c.length>0&&(l.BatchNo=c[0].BatchNumber.toString(),l.BatchCode=c[0].BatchCode.toString()),c.length>1){for(var d=0;d<c.length;d++)o+=parseFloat(c[d].Quantity);e.ds.Tables[0][a][0]=o}}if(l.ProductName=e.ds.Tables[0][a].ProductName.toString(),l.ProductCode=e.ds.Tables[0][a].ProductCode.toString(),l.ProductID_Key=e.ds.Tables[0][a].ProductID.toString(),l.linkFieldName=e.ds.Tables[0][a][e.ds.Columns[0][1]].toString(),e.GridObj.TableColumns.Contains("VoucherNo")&&(l.VoucherNo=e.ds.Tables[0][a].VoucherNo.toString()),u.length>0&&(u+=","),u+=e.ds.Tables[0][a].ProductID.toString(),o>0)l.Balance=o.ToString("N"+D),l.TobeUsed=o.ToString("N"+D),l.Executed=(0).ToString("N"+D),l[e.ds.Tables[0][a][e.ds.Columns[0][1]].toString()]=o.ToString("N"+D);else{var h=e.ds.Columns[0][3],m=e.Parent.ScreenObject.GridData.filter((function(t){return t.LinkedInvDocDetailsID==e.ds.Tables[0][a].DocDetailsID}));if(m.length>0&&e.Parent.ScreenObject.GridDataColumns.Contains(e.ds.Tables[0][a][h].toString())){for(var b=0,S=0;S<m.length;S++)i.e.IsNum(m[S][e.ds.Tables[0][a][h]])&&(b+=parseFloat(m[S][e.ds.Tables[0][a][h].toString()]));var C=e.ds.Columns[0][0];if(!(i.e.IsNum(e.ds.Tables[0][a][C])&&parseFloat(e.ds.Tables[0][a][C])-b>0))return e.ds.Tables[0].RemoveAt(a),e.ds.Tables[1].RemoveAt(a),e.ds.Tables[2].RemoveAt(a),e.ds.Tables[3].RemoveAt(a),a--,y=a,"continue";l.Balance=parseFloat(parseFloat(e.ds.Tables[0][a][C]).ToString("N"+D))-b,l.TobeUsed=parseFloat(parseFloat(e.ds.Tables[0][a][C]).ToString("N"+D))-b;var g=e.ds.Columns[0][1];e.ds.Columns[0].Contains(e.ds.Tables[0][a][g].toString())?l[e.ds.Tables[0][a][g].toString()]=e.ds.Tables[0][a][e.ds.Tables[0][a][g].toString()].toString():e.ds.Columns[2].Contains(e.ds.Tables[0][a][g].toString())&&(l[e.ds.Tables[0][a][g].toString()]=e.ds.Tables[2][a][e.ds.Tables[0][a][g].toString()].toString()),e.Parent.ScreenObject.Preferences.ContainsKey("Checkpackedqty")&&"true"==e.Parent.ScreenObject.Preferences.Checkpackedqty.toLowerCase()&&"true"==e.ds.Tables[0][a].IsPacking.toString().toLowerCase()?(null!=(p=e.ds.Tables[13].filter((function(t){return 2==t.Type&&t.InvDocDetailsID==e.ds.Tables[0][a].DocDetailsID})).Compute("sum","Quantity"))&&null!=p||(p=0),l.Executed=(parseFloat(p)-parseFloat(l.Balance)).ToString("N"+D),e.ds.Tables[0][a].Executed=l.Executed):i.e.IsEmpty(l.Balance)||i.e.IsEmpty(l[e.ds.Tables[0][a][g]])||(l.Executed=parseFloat(parseFloat(l[e.ds.Tables[0][a][g].toString()]).ToString("N"+D))-parseFloat(l.Balance),e.ds.Tables[0][a].Executed=l.Executed)}else{var f=e.ds.Columns[0][0],I=e.ds.Columns[0][1];l.Balance=parseFloat(e.ds.Tables[0][a][f]).ToString("N"+D),l.TobeUsed=parseFloat(e.ds.Tables[0][a][f]).ToString("N"+D),e.ds.Columns[0].Contains(e.ds.Tables[0][a][I].toString())?l[e.ds.Tables[0][a][I].toString()]=e.ds.Tables[0][a][e.ds.Tables[0][a][I].toString()].toString():e.ds.Columns[2].Contains(e.ds.Tables[0][a][I].toString())&&(l[e.ds.Tables[0][a][I].toString()]=e.ds.Tables[2][a][e.ds.Tables[0][a][I].toString()].toString()),e.Parent.ScreenObject.Preferences.ContainsKey("Checkpackedqty")&&"true"==e.Parent.ScreenObject.Preferences.Checkpackedqty.toLowerCase()&&"true"==e.ds.Tables[0][a].IsPacking.toString().toLowerCase()?(null!=(p=e.ds.Tables[13].filter((function(t){return 2==t.Type&&t.InvDocDetailsID==e.ds.Tables[0][a].DocDetailsID})).Compute("sum","Quantity"))&&null!=p||(p=0),l.Executed=(parseFloat(p)-parseFloat(l.Balance)).ToString("N"+D),e.ds.Tables[0][a].Executed=l.Executed):i.e.IsEmpty(l.Balance)||i.e.IsEmpty(l[e.ds.Tables[0][a][I]])||(l.Executed=(parseFloat(l[e.ds.Tables[0][a][I].toString()])-parseFloat(l.Balance)).ToString("N"+D),e.ds.Tables[0][a].Executed=l.Executed)}}for(var T=0;T<e.DynamicColumnSource.length;T++)if(4!=e.DynamicColumnSource[T].SectionID&&"LinkedInvDocDetailsID"!=e.DynamicColumnSource[T].DisplayMember&&"RefNo"!=e.DynamicColumnSource[T].DisplayMember&&"LinkedFieldName"!=e.DynamicColumnSource[T].DisplayMember&&!e.DynamicColumnSource[T].DisplayMember.toLowerCase().Contains("dccurrid")&&!e.DynamicColumnSource[T].DisplayMember.toLowerCase().Contains("dcexchrt"))if(e.DynamicColumnSource[T].IsColumnUserDefined)if("SELECTIONBOX"==e.DynamicColumnSource[T].DataType)e.ds.Columns[3].Contains(e.DynamicColumnSource[T].DisplayMember)&&(l[e.DynamicColumnSource[T].DisplayMember]=e.ds.Tables[3][a][e.DynamicColumnSource[T].DisplayMember]);else if(null!=e.DynamicColumnSource[T].CostCenterID&&e.DynamicColumnSource[T].CostCenterID>0)e.DynamicColumnSource[T].DisplayMember.Contains("TO")?e.ds.Columns[1].Contains(e.DynamicColumnSource[T].DisplayMember.replace("TO",""))&&e.ds.Tables[1].length>a+1&&e.ds.Columns[1].Contains(e.DynamicColumnSource[T].DisplayMember.replace("TO",""))&&(l[e.DynamicColumnSource[T].DisplayMember+"_Key"]=e.ds.Tables[1][a+1][e.DynamicColumnSource[T].DisplayMember.replace("TO","")]):e.ds.Columns[1].Contains(e.DynamicColumnSource[T].DisplayMember)?l[e.DynamicColumnSource[T].DisplayMember+"_Key"]=e.ds.Tables[1][a][e.DynamicColumnSource[T].DisplayMember]:e.DynamicColumnSource[T].DisplayMember.toLowerCase().Contains("alpha")&&e.ds.Tables[3].length>0&&!i.e.IsEmpty(e.ds.Tables[3][a][e.DynamicColumnSource[T].DisplayMember])&&(l[e.DynamicColumnSource[T].DisplayMember+"_Key"]=e.ds.Tables[3][a][e.DynamicColumnSource[T].DisplayMember]);else if(e.DynamicColumnSource[T].DisplayMember.toLowerCase().Contains("dcnum")&&e.ds.Columns[2].Contains(e.DynamicColumnSource[T].DisplayMember))l[e.DynamicColumnSource[T].DisplayMember]=e.ds.Tables[2][a][e.DynamicColumnSource[T].DisplayMember];else if("DATE"==e.DynamicColumnSource[T].DataType){if(e.ds.Columns[3].Contains(e.DynamicColumnSource[T].DisplayMember)&&!i.e.IsEmpty(e.ds.Tables[3][a][e.DynamicColumnSource[T].DisplayMember])){var P="dd/MMM/yyyy";n.a.SessionManager.Preferences.ContainsKey("Date Format")&&""!=n.a.SessionManager.Preferences["Date Format"]&&(P=n.a.SessionManager.Preferences["Date Format"]),l[e.DynamicColumnSource[T].DisplayMember]=new Date(e.ds.Tables[3][a][e.DynamicColumnSource[T].DisplayMember]).ToString(P),l[e.DynamicColumnSource[T].DisplayMember+"_Key"]=new Date(e.ds.Tables[3][a][e.DynamicColumnSource[T].DisplayMember])}}else"ComboBox"==e.DynamicColumnSource[T].DataType?e.ds.Columns[3].Contains(e.DynamicColumnSource[T].ValueBinding)&&(l[e.DynamicColumnSource[T].ValueBinding]=e.ds.Tables[3][a][e.DynamicColumnSource[T].ValueBinding]):e.ds.Columns[3].Contains(e.DynamicColumnSource[T].DisplayMember)&&(l[e.DynamicColumnSource[T].DisplayMember]=e.ds.Tables[3][a][e.DynamicColumnSource[T].DisplayMember]);else if("AccountID_Key"==e.DynamicColumnSource[T].ValueMember||"DebitAmount"==e.DynamicColumnSource[T].DisplayMember||"CreditAmount"==e.DynamicColumnSource[T].DisplayMember){if("AccountID_Key"==e.DynamicColumnSource[T].ValueMember)continue}else if(null!=e.DynamicColumnSource[T].ValueMember&&e.ds.Columns[0].Contains(e.DynamicColumnSource[T].ValueMember.replace("_Key",""))&&("DebitAccount_Key"==e.DynamicColumnSource[T].ValueMember||"CreditAccount_Key"==e.DynamicColumnSource[T].ValueMember)||"Amount"==e.DynamicColumnSource[T].DisplayMember)null!=e.DynamicColumnSource[T].ValueMember&&"DebitAccount_Key"==e.DynamicColumnSource[T].ValueMember&&(l.DebitAccount_KEY=e.ds.Tables[0][a].DebitAccount),null!=e.DynamicColumnSource[T].ValueMember&&"CreditAccount_Key"==e.DynamicColumnSource[T].ValueMember&&(l.CreditAccount_KEY=e.ds.Tables[0][a].CreditAccount),"Amount"==e.DynamicColumnSource[T].DisplayMember&&(l.Amount=n.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(s.j)(n.a.SessionManager.Preferences["Use Foreign Currency"])&&e.ds.Columns[0].Contains("amountfc")?"-"+e.ds.Tables[0][a].amountfc:"-"+e.ds.Tables[0][a].Amount);else if(3==e.DynamicColumnSource[T].CostCenterID&&e.ds.Columns[0].Contains("ProductID"))l[e.DynamicColumnSource[T].ValueMember]=e.ds.Tables[0][a].ProductID;else if("DocSeqNo"!=e.DynamicColumnSource[T].DisplayMember)if("DATE"==e.DynamicColumnSource[T].DataType){if(e.ds.Columns[0].Contains(e.DynamicColumnSource[T].DisplayMember)&&!i.e.IsEmpty(e.ds.Tables[0][a][e.DynamicColumnSource[T].DisplayMember])){var O="dd/MMM/yyyy";n.a.SessionManager.Preferences.ContainsKey("Date Format")&&""!=n.a.SessionManager.Preferences["Date Format"]&&(O=n.a.SessionManager.Preferences["Date Format"]),l[e.DynamicColumnSource[T].DisplayMember]=new Date(e.ds.Tables[0][a][e.DynamicColumnSource[T].DisplayMember]).ToString(O),e.GridObj.TableColumns.Contains(e.DynamicColumnSource[T].DisplayMember+"_Key")&&(l[e.DynamicColumnSource[T].DisplayMember+"_Key"]=new Date(e.ds.Tables[0][a][e.DynamicColumnSource[T].DisplayMember]))}}else if("gross"==e.DynamicColumnSource[T].DisplayMember.toLowerCase()){if(e.ds.Columns[0].Contains(e.DynamicColumnSource[T].DisplayMember)){var B=e.ds.Columns[0][0];"quantity"!=e.ds.Tables[0][a][e.ds.Columns[0][1]].toString().toLowerCase()||i.e.IsEmpty(e.ds.Tables[0][a].quantity)||i.e.IsEmpty(e.ds.Tables[0][a][B])||parseFloat(e.ds.Tables[0][a][B])==parseFloat(e.ds.Tables[0][a].quantity)?l[e.DynamicColumnSource[T].DisplayMember]=e.ds.Tables[0][a][e.DynamicColumnSource[T].DisplayMember]:i.e.IsEmpty(e.ds.Tables[0][a].Rate)||(l[e.DynamicColumnSource[T].DisplayMember]=parseFloat(e.ds.Tables[0][a].Rate)*parseFloat(e.ds.Tables[0][a][B]))}}else"Amount"==e.DynamicColumnSource[T].DisplayMember?e.ds.Columns[0].Contains("Amount")&&(l.Amount=e.ds.Tables[0][a].Amount):"LISTBOX"==e.DynamicColumnSource[T].DataType.toUpperCase()?e.ds.Columns[0].Contains(e.DynamicColumnSource[T].DisplayMember)&&(l[e.DynamicColumnSource[T].ValueMember]=e.ds.Tables[0][a][e.DynamicColumnSource[T].DisplayMember]):e.ds.Columns[0].Contains(e.DynamicColumnSource[T].DisplayMember)&&e.GridObj.TableColumns.Contains(e.DynamicColumnSource[T].DisplayMember)&&(l[e.DynamicColumnSource[T].DisplayMember]=e.ds.Tables[0][a][e.DynamicColumnSource[T].DisplayMember]);e.GridObj.addRow(l),e.ds.Columns[0].Contains("DocumentType")&&"5"==e.ds.Tables[0][a].DocumentType.toString()&&a++,y=a},y=0;y<this.ds.Tables[0].length;y++){var p;C(y)}u.length>0&&this.GridObj.TableColumns.Contains("QOH")&&null!=(S=e.Parent.ScreenObject.GetProductQtyOnHand(u,e.Parent.DocumentDate))&&S.Tables.length>0&&S.Columns[0].Contains("ProductID")&&function(){for(var t=0,a=function(a){var n=e.GridData.filter((function(e){return e.ProductID_Key==S.Tables[0][a].ProductID}));n.length>1?n.forEach((function(e){t=i.e.DoubleTryParse(S.Tables[0][a].QOH),e.QOH=t.ToString("N"+D)})):n.length>0&&(t=i.e.DoubleTryParse(S.Tables[0][a].QOH),n[0].QOH=t.ToString("N"+D))},n=0;n<S.Tables[0].length;n++)a(n)}(),this.RefreshGrid=!0}},{key:"GenerateColumns",value:function(e,t){var a,r=this,o=0,l=this.ds.Tables[6];l.sort((function(e,t){return e.SectionID-t.SectionID})),l.sort((function(e,t){return e.SectionSeqNumber-t.SectionSeqNumber}));for(var u=0;u<l.length;u++){(a=new d.a).Header=l[u].UserColumnName,a.DisplayMember=l[u].SysColumnName,a.DataType=l[u].ColumnDataType,a.Width=100,a.ValueMember="LISTBOX"==a.DataType?l[u].SysColumnName.toString()+"_Key":l[u].SysColumnName.toString(),i.e.IsEmpty(l[u].IsColumnUserDefined)||(a.IsColumnUserDefined=Object(s.j)(l[u].IsColumnUserDefined)),null==l[u].ColumnCostCenterID||i.e.IsEmpty(l[u].ColumnCostCenterID)||(a.CostCenterID=parseInt(l[u].ColumnCostCenterID)),a.ReadOnly=!0;var h,D=t.find((function(e){return e.DisplayMember==a.DisplayMember}));if(D?(a.DisplayIndex=D.DisplayIndex,a.Width=D.Width):a.DisplayIndex=100,0==e.filter((function(e){return e.ValueMember==a.ValueMember&&"LISTBOX"==e.DataType||e.DisplayMember==a.DisplayMember&&"LISTBOX"!=e.DataType})).length)!function(){var t=l[u];if(!r.GridObj.TableColumns.Contains(a.DisplayMember))switch(r.DynamicColumnSource.push(a),"grossfc"==a.DisplayMember.toLowerCase()&&(o=r.ColumnSource.length),o>0&&"rate"==a.DisplayMember.toLowerCase()?e.InsertAt(a,o):e.push(a),t.ColumnDataType.toString().toUpperCase()){case"BIGINT":r.GridObj.TableColumns.push(t.SysColumnName),a.ShowTotal=!1;break;case"INT":r.GridObj.TableColumns.push(t.SysColumnName),a.ShowTotal=!0;break;case"FLOAT":r.GridObj.TableColumns.push(t.SysColumnName),t.SysColumnName.toString().toLowerCase().Contains("dcnum")?(a.DefaultValue=t.UserDefaultValue.toString(),r.GridObj.TableColumns.push("dcCalc"+t.SysColumnName),(h=r.Parent.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember==t.SysColumnName})))?a.DecimalPoints=h.DecimalPoints:n.a.SessionManager.Preferences.ContainsKey("DecimalsinExtraFields")&&""!=n.a.SessionManager.Preferences.DecimalsinExtraFields&&(a.DecimalPoints=n.a.SessionManager.Preferences.DecimalsinExtraFields)):t.SysColumnName.toString().toLowerCase().Contains("dcexchrt")||("Quantity"==t.SysColumnName.toString()?(r.GridObj.TableColumns.push("Linked"+t.SysColumnName.toString()),n.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=n.a.SessionManager.Preferences.DecimalsinQty&&(a.DecimalPoints=n.a.SessionManager.Preferences.DecimalsinQty)):"Gross"==t.SysColumnName.toString()||"grossfc"==t.SysColumnName.toString().toLowerCase()||"Rate"==t.SysColumnName.toString()?("Gross"==t.SysColumnName.toString()&&r.GridObj.TableColumns.push("Linked"+t.SysColumnName.toString()),n.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=n.a.SessionManager.Preferences.DecimalsinRate&&(a.DecimalPoints=n.a.SessionManager.Preferences.DecimalsinRate)):"Amount"!=t.SysColumnName.toString()&&"DebitAmount"!=t.SysColumnName.toString()&&"CreditAmount"!=t.SysColumnName.toString()||!n.a.SessionManager.Preferences.ContainsKey("DecimalsinAmount")||""==n.a.SessionManager.Preferences.DecimalsinAmount||(a.DecimalPoints=n.a.SessionManager.Preferences.DecimalsinAmount)),t.SysColumnName.toString().toLowerCase().Contains("dcexchrt")||"exchangerate"==t.SysColumnName.toString().toLowerCase()||(a.ShowTotal=!0);break;case"LISTBOX":a.ValueMember=t.SysColumnName.toString()+"_Key","unit"==t.SysColumnName.toString().toLowerCase()?(r.GridObj.TableColumns.push(t.SysColumnName.toString()),r.GridObj.TableColumns.push(t.SysColumnName.toString()+"_Key"),r.GridObj.TableColumns.push("UOMConversion"),r.GridObj.TableColumns.push("UOMConvertedQty")):"productid"==t.SysColumnName.toString().toLowerCase()?(a.ValueMember="ProductID_Key",a.DisplayMember=t.UserColumnName.toString().Replace(" ",""),r.GridObj.TableColumns.Contains(a.DisplayMember)||r.GridObj.TableColumns.push(a.DisplayMember),r.GridObj.TableColumns.Contains(a.ValueMember)||r.GridObj.TableColumns.push(a.ValueMember)):"accountid"==t.SysColumnName.toString().toLowerCase()||"debitaccount"==t.SysColumnName.toString().toLowerCase()||"creditaccount"==t.SysColumnName.toString().toLowerCase()?(a.DisplayMember=t.UserColumnName.toString().Replace(" ",""),r.GridObj.TableColumns.push(a.DisplayMember),r.GridObj.TableColumns.Contains(a.ValueMember)||r.GridObj.TableColumns.push(a.ValueMember)):(r.GridObj.TableColumns.push(t.SysColumnName.toString()),r.GridObj.TableColumns.push(t.SysColumnName.toString()+"_Key")),a.CostCenterID=parseInt(t.ColumnCostCenterID),a.TypeID=parseInt(t.ColumnCCListViewTypeID),"ProductID_Key"!=a.ValueMember&&"AccountID"!=a.DisplayMember&&"CreditAccount"!=a.DisplayMember&&"DebitAccount"!=a.DisplayMember||(a.FilterCondition=t.UserProbableValues.toString()),n.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==n.a.SessionManager.Preferences.EnableDivisionWise.toString()&&50001==a.CostCenterID&&(a.ReadOnly=!0),n.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==n.a.SessionManager.Preferences.EnableLocationWise.toString()&&50002==a.CostCenterID&&(a.ReadOnly=!0);break;case"TEXT":case"STRING":if(r.GridObj.TableColumns.push(t.SysColumnName.toString()),a.IsColumnUserDefined)if("Date"==t.UserColumnType.toString())a.DataType="DATE",r.GridObj.TableColumns.push(t.SysColumnName.toString()+"_Key");else if("Numeric"==t.UserColumnType.toString())a.DataType="FLOAT";else if("LISTBOX"==t.UserColumnType.toString())a.DataType="LISTBOX",a.ValueMember=t.SysColumnName.toString()+"_Key",r.GridObj.TableColumns.push(t.SysColumnName.toString()+"_Key"),a.CostCenterID=parseInt(t.ColumnCostCenterID),a.TypeID=parseInt(t.ColumnCCListViewTypeID);else if("Combobox"==t.UserColumnType.toString()){a.ValueBinding=t.SysColumnName.toString(),a.DataType="ComboBox",a.DisplayMember="Name",a.ValueMember="Value";var i=[],s=t.UserProbableValues.toString().Trim();if(s.length>0)for(var d=s.split(";"),D=0;D<d.length;D++)i.push(c.d.ComboBoxItems_2(d[D],d[D]));a.ComboData=i}break;case"DATE":a.DataType="DATE",r.GridObj.TableColumns.push(t.SysColumnName.toString()),r.GridObj.TableColumns.push(t.SysColumnName.toString()+"_Key");break;case"":a.DataType="TextBlock",r.GridObj.TableColumns.push(t.SysColumnName.toString())}}()}}},{key:"OnBeginEdit",value:function(e){var t=e.args;if("DataGridPactListBoxColumn"==t.column.className){var a=t.column.DgCol,n=t.item;if(11==a.CostCenterID){var i="";this.GridObj.TableColumns.Contains("ProductID_Key")&&(i=n.ProductID_Key.toString());var s=" (BaseID IN ";s+=" (SELECT     BaseID ",s=(s+=" FROM          COM_UOM AS COM_UOM_1 with(nolock) ")+" WHERE      (UOMID =(select UOMID from inv_product with(nolock) where productid="+i+") ))) ",""==i&&(s=" (BaseID IN ",s+=" (SELECT     BaseID ",s+=" FROM          COM_UOM AS COM_UOM_1 with(nolock) ",s+=" WHERE      (UOMID =-1 ))) "),a.FilterCondition=s}}}},{key:"ValidateQty",value:function(e){var t;this.GridObj.TableColumns.Contains("Gross")&&(this.GridObj.TableColumns.Contains("Rate")?i.e.IsEmpty(e.TobeUsed)||i.e.IsEmpty(e.Rate)||(e.Gross=parseFloat(e.TobeUsed)*parseFloat(e.Rate)):(t=this.ds.Tables[0].filter((function(t){return t.DocDetailsID==e.DocDetailsID}))).length>0&&(i.e.IsEmpty(e.TobeUsed)||i.e.IsEmpty(t[0].Rate)||(e.Gross=parseFloat(e.TobeUsed)*parseFloat(t[0].Rate))),(t=this.ds.Tables[0].filter((function(t){return t.DocDetailsID==e.DocDetailsID}))).length>0&&this.ds.Columns[0].Contains("ExchangeRate")&&!i.e.IsEmpty(t[0].ExchangeRate)&&(e.Gross=parseFloat(e.Gross)*parseFloat(t[0].ExchangeRate)),this.GridObj.updateRow(e));if(this.GridObj.TableColumns.Contains("GrossFc")){if(this.GridObj.TableColumns.Contains("Rate"))i.e.IsEmpty(e.TobeUsed)||i.e.IsEmpty(e.Rate)||(e.GrossFc=parseFloat(e.TobeUsed)*parseFloat(e.Rate));else{var a=this.ds.Tables[0].filter((function(t){return t.DocDetailsID==e.DocDetailsID}));a.length>0&&(i.e.IsEmpty(e.TobeUsed)||i.e.IsEmpty(a[0].Rate)||(e.GrossFc=parseFloat(e.TobeUsed)*parseFloat(a[0].Rate)))}this.GridObj.updateRow(e)}}},{key:"OnCellEditEnding",value:function(e){var t=e.item,a=e.column.field;if("ScanProduct"==a&&!i.e.IsEmpty(t.ScanProduct)&&!i.e.IsEmpty(t.ProductID_Key))throw this.onScan(t.ScanProduct.toString(),t),new Error("PactException");if("TobeUsed"==a&&"quantity"==t.linkFieldName.toString().toLowerCase())this.ValidateQty(t);else if("UOMID"!=a||i.e.IsEmpty(t.UOMID_Key)){if(this.JobNodeID>0&&"Value"==a&&!i.e.IsEmpty(t.Value)){if(this.Parent.ScreenObject.IsPurchase&&null!=this.IO.SelectedValue&&"Output"==this.IO.SelectedValue&&n.a.SessionManager.Preferences.ContainsKey("DoNotReceiveMoreThanJobQty")&&"true"==n.a.SessionManager.Preferences.DoNotReceiveMoreThanJobQty.toLowerCase()&&i.e.IsNum(t.Qty)&&i.e.IsNum(t.Used)&&i.e.IsNum(t.Value)&&parseFloat(t.Value)+parseFloat(t.Used)>parseFloat(t.Qty))return void(this.DisplayMessage="Can not Receive more Job Qty");if(this.Parent.ScreenObject.IsPurchase&&null!=this.IO.SelectedValue&&"Output"==this.IO.SelectedValue&&this.Parent.ScreenObject.Preferences.ContainsKey("DoNotReceiveMoreThanJobQty")&&"true"==this.Parent.ScreenObject.Preferences.DoNotReceiveMoreThanJobQty.toLowerCase()){if(i.e.IsNum(t.Qty)&&i.e.IsNum(t.Used)&&i.e.IsNum(t.Value)&&parseFloat(t.Value)+parseFloat(t.Used)>parseFloat(t.Qty))return t.Value=parseFloat(t.Qty)-parseFloat(t.Used),void(this.DisplayMessage="Can not Receive more Job Qty")}else if(!this.Parent.ScreenObject.IsPurchase&&n.a.SessionManager.Preferences.ContainsKey("DoNotIssueMoreThanJobQty")&&"true"==n.a.SessionManager.Preferences.DoNotIssueMoreThanJobQty.toLowerCase()&&i.e.IsNum(t.Net)&&i.e.IsNum(t.Used)&&i.e.IsNum(t.Value)&&parseFloat(t.Value)+parseFloat(t.Used)>parseFloat(t.Net))return t.Value=parseFloat(t.Net)-parseFloat(t.Used),void(this.DisplayMessage="Can not Issue more Job Qty")}}else{var s=this.Parent.ScreenObject.GetConversion(t.UOMID_Key.toString());if(s>0){var r=0;i.e.IsNum(t.Qty)&&(r=parseFloat(t.Qty),t.Qty=(r*parseFloat(t.BaseConversion)/s).ToString("N"+this.decimalpoints)),i.e.IsNum(t.Used)&&(r=parseFloat(t.Used),t.Used=(r*parseFloat(t.BaseConversion)/s).ToString("N"+this.decimalpoints)),i.e.IsNum(t.Balance)&&(r=parseFloat(t.Balance),t.Balance.toString()==t.Value.toString()?(t.Balance=(r*parseFloat(t.BaseConversion)/s).ToString("N"+this.decimalpoints),t.Value=t.Balance):t.Balance=(r*parseFloat(t.BaseConversion)/s).ToString("N"+this.decimalpoints)),t.BaseConversion=s,this.GridObj.updateRow(t)}}}},{key:"OnClick",value:function(e){}},{key:"AddtempProd",value:function(e){var t=this.Parent.ScreenObject.ColumnSource.find((function(e){return null!=e.ValueMember&&"productid_key"==e.ValueMember.toLowerCase()}));if(t&&null!=t.DefaultValue&&""!=t.DefaultValue&&null!=t.DefaultValueText&&i.e.IntTryParse(t.DefaultValue)>0){var a=t.DefaultValueText.split("\x11");e.ProductID_Key=t.DefaultValue,this.Parent.ScreenObject.GridDataColumns.Contains("ProductCode")&&a.length>1&&(e.ProductCode=a[1]),this.Parent.ScreenObject.GridDataColumns.Contains("ProductName")&&a.length>0&&(e.ProductName=a[0]),this.Parent.AddProductData(e,!1,!1)}}},{key:"SelectAllBoms",value:function(){var e=this;this.Boms.Items.forEach((function(t){e.Boms.SelectedValue=t.Value,e.SelectAllStages()}))}},{key:"SelectAllStages",value:function(){var e=this;this.Stages.Items.forEach((function(t){e.Stages.SelectedValue=t.Value,e.GridData.forEach((function(e){i.e.IsEmpty(e.Select)||(e.Select=!0)})),e.OnSave("Add")}))}},{key:"RefreshSno",value:function(){var e=this,t=1;this.GridObj.Table.forEach((function(a){a.DocSeqNo=t,e.GridObj.updateRow(a),t++}))}},{key:"OnSave",value:function(e){var t=this;if("qtychanged"==e.toString())this.CalcQty();else if("RemQTY"==e.toString())this.CalcRemQty();else if("Sort"==e.toString());else if("AllBoms"==e.toString())this.SelectAllBoms();else if("AllStages"==e.toString())this.SelectAllStages();else if("Add"==e.toString()){for(var a=0,r=function(e){if(!i.e.IsEmpty(t.GridData[e].Select)&&Object(s.j)(t.GridData[e].Select)){a++,t.GridData[e].Select=!1;var r=t.AddedGridObj.NewRow();if(r.StageNodeID=t.GridData[e].StageNodeID,r.StageID=t.GridData[e].StageID,r.BomID=t.Boms.SelectedValue,r.BomNodeID=t.Boms.SelectedItem.Aliasname,r.StageName=t.GridData[e].StageName,r.BomName=t.Boms.GetText(),1==a&&t.AddedGridObj.TableColumns.Contains("RemainingQty")&&!i.e.IsEmpty(t.RemQTY.Text)&&(r.RemainingQty=t.RemQTY.Text),null==t.Stages.SelectedItem||i.e.IsEmpty(t.Stages.SelectedItem.Aliasname)||(t.AddedGridObj.TableColumns.Contains("DimID")||t.AddedGridObj.TableColumns.push("DimID"),r.DimID=t.Stages.SelectedItem.Aliasname),r.BatchSize=t.GridData[e].BatchSize,r.OPQTY=t.GridData[e].OPQTY,r.IPQTY=t.GridData[e].IPQTY,36==t.Parent.ScreenObject.DocumentType)r.Cost=t.GridData[e].Cost,r.Hrs=t.GridData[e].Hrs,r.MachineID=t.GridData[e].MachineID,r.Machine=t.GridData[e].Machine,r.CrAccountID=t.GridData[e].CrAccountID,r.CrAccount=t.GridData[e].CrAccount,r.DrAccountID=t.GridData[e].DrAccountID,r.DrAccount=t.GridData[e].DrAccount,i.e.IsEmpty(r.Cost)||i.e.IsEmpty(r.Hrs)||(r.Value=parseFloat(r.Cost)*parseFloat(r.Hrs)),t.GridObj.TableColumns.Contains("MachineDim1")&&!i.e.IsEmpty(t.GridData[e].MachineDim1)&&(r.MachineDim1=t.GridData[e].MachineDim1.toString()),t.GridObj.TableColumns.Contains("MachineDim2")&&!i.e.IsEmpty(t.GridData[e].MachineDim2)&&(r.MachineDim2=t.GridData[e].MachineDim2.toString());else if(37==t.Parent.ScreenObject.DocumentType)r.Name=t.GridData[e].Name.toString(),r.Credit=t.GridData[e].Credit.toString(),r.CreditAccountID=t.GridData[e].CreditAccountID,r.DebitAccountID=t.GridData[e].DebitAccountID,r.Debit=t.GridData[e].Debit,r.Value=t.GridData[e].Value;else if(r.Qty=t.GridData[e].Value,r.ActualQty=t.GridData[e].Qty,r.ProductName=t.GridData[e].ProductName.toString(),r.ProductCode=t.GridData[e].ProductCode.toString(),r.ProductID_Key=t.GridData[e].ProductID_Key,r.ProductType=t.GridData[e].ProductType,r.UOMID=t.GridData[e].UOMID,r.UOMID_Key=t.GridData[e].UOMID_Key,r.AutoStage=t.GridData[e].AutoStage,r.UnitPrice=t.GridData[e].UnitPrice,r.Remarks=i.e.StringValue(t.GridData[e].Remarks),t.Parent.ScreenObject.IsPurchase&&null!=t.IO.SelectedValue&&"Output"==t.IO.SelectedValue?r.IsOutput="1":t.Parent.ScreenObject.IsPurchase||i.e.IsEmpty(t.RemQTY.Text)||(r.RemQty=t.RemQTY.Text),t.Parent.ScreenObject.IsPurchase&&null!=t.IO.SelectedValue&&"Output"==t.IO.SelectedValue&&(n.a.SessionManager.Preferences.ContainsKey("DoNotReceiveMoreThanJobQty")&&"true"==n.a.SessionManager.Preferences.DoNotReceiveMoreThanJobQty.toLowerCase()||t.Parent.ScreenObject.Preferences.ContainsKey("DoNotReceiveMoreThanJobQty")&&"true"==t.Parent.ScreenObject.Preferences.DoNotReceiveMoreThanJobQty.toLowerCase())){if(i.e.IsNum(t.GridData[e].Qty)&&i.e.IsNum(t.GridData[e].BaseConversion)&&(r.Net=parseFloat(t.GridData[e].Qty)*parseFloat(t.GridData[e].BaseConversion)),i.e.IsNum(t.GridData[e].Qty)&&i.e.IsNum(t.GridData[e].Used)&&i.e.IsNum(t.GridData[e].Value)&&parseFloat(t.GridData[e].Value)+parseFloat(t.GridData[e].Used)>parseFloat(t.GridData[e].Qty))return{v:void(t.DisplayMessage="Can not Receive more Job Qty at Row:"+(e+1))}}else if(!t.Parent.ScreenObject.IsPurchase&&n.a.SessionManager.Preferences.ContainsKey("DoNotIssueMoreThanJobQty")&&"true"==n.a.SessionManager.Preferences.DoNotIssueMoreThanJobQty.toLowerCase()){var o=0,l=0,c=1;i.e.IsNum(t.GridData[e].BaseConversion)&&(c=parseFloat(t.GridData[e].BaseConversion)),i.e.IsNum(t.GridData[e].Net)&&(o=parseFloat(t.GridData[e].Net)),i.e.IsNum(t.GridData[e].Used)&&(o-=parseFloat(t.GridData[e].Used)),o*=c,i.e.IsNum(t.GridData[e].Value)&&(l=parseFloat(t.GridData[e].Value)),l*=c;for(var d=t.AddGridData.filter((function(a){return a.ProductID_Key==t.GridData[e].ProductID_Key&&a.StageID==t.GridData[e].StageID&&a.BomID==t.Boms.SelectedValue})),u=0;u<d.length;u++)i.e.IsNum(d[u].Qty)&&(l+=parseFloat(d[u].Qty)*c);if(0==t.Parent.ScreenObject.DocID&&null!=(d=t.Parent.ScreenObject.GridDataColumns.Contains("jobID")&&t.Parent.ScreenObject.GridDataColumns.Contains("StageID")&&t.Parent.ScreenObject.GridDataColumns.Contains("BOMID")?t.Parent.ScreenObject.GridData.filter((function(a){return a.ProductID_Key==t.GridData[e].ProductID_Key&&a.jobID==t.JobNodeID&&a.StageID==t.GridData[e].StageNodeID&&a.BOMID==t.Boms.SelectedItem.Aliasname})):t.Parent.ScreenObject.GridDataColumns.Contains("jobID")&&t.Parent.ScreenObject.GridDataColumns.Contains("StageID")?t.Parent.ScreenObject.GridData.filter((function(a){return a.ProductID_Key==t.GridData[e].ProductID_Key&&a.jobID==t.JobNodeID&&a.StageID==t.GridData[e].StageNodeID})):null))for(var h=0;h<d.length;h++)i.e.IsNum(d[h].UOMConvertedQty)&&(l+=parseFloat(d[h].UOMConvertedQty));if((l=parseFloat(l.ToString("N"+t.decimalpoints)))>(o=parseFloat(o.ToString("N"+t.decimalpoints))))return{v:void(t.DisplayMessage="Can not Issue more Job Qty at Row:"+(e+1))}}t.AddedGridObj.addRow(r),t.GridObj.updateRow(t.GridData[e])}},o=0;o<this.GridData.length;o++){var l=r(o);if("object"==typeof l)return l.v}this.GridObj.SelectAll.IsChecked=!1}else if("OK"==e.toString()||"OKNoClose"==e.toString()){if(this.JobNodeID>0){var c,b,S,C,y,p=function(){if(0==t.AddGridData.length)return{v:void(t.DisplayMessage="Please add atleast one row")};for(var e=0,a=0;a<t.Parent.ScreenObject.GridData.length;a++)if(i.e.IsEmpty(t.Parent.ScreenObject.GridData[a].ProductID_Key)){e=a;break}var r=0,o=0,l=0,p=0,g=0;t.Parent.ScreenObject.Preferences.ContainsKey("JobUnqCCID")&&(g=parseInt(t.Parent.ScreenObject.Preferences.JobUnqCCID)),t.Boms.Items.length>0&&!i.e.IsEmpty(t.Boms.Items[0].Parent)&&"0"!=t.Boms.Items[0].Parent&&i.e.IsNum(t.Boms.Items[0].Parent)?(p=parseInt(t.Boms.Items[0].Parent),t.Parent.ScreenObject.Preferences.ContainsKey("BomCCID")?t.Parent.ScreenObject.Preferences.BomCCID=p:t.Parent.ScreenObject.Preferences.push("BomCCID",p.toString())):p=0,t.ds.Tables.length>2&&t.ds.Tables[2].length>0&&(t.ds.Columns[2].Contains("jobCCID")&&(r=parseInt(t.ds.Tables[2][0].jobCCID)),t.Parent.ScreenObject.Preferences.ContainsKey("jobCCID")?t.Parent.ScreenObject.Preferences.jobCCID=r.toString():t.Parent.ScreenObject.Preferences.push("jobCCID",r.toString()),i.e.IsEmpty(t.ds.Tables[2][0].StageCCID)||(o=parseInt(t.ds.Tables[2][0].StageCCID),t.Parent.ScreenObject.Preferences.ContainsKey("StageCCID")?t.Parent.ScreenObject.Preferences.StageCCID=o.toString():t.Parent.ScreenObject.Preferences.push("StageCCID",o.toString())),i.e.IsEmpty(t.ds.Tables[2][0].MachineCCID)||(l=parseInt(t.ds.Tables[2][0].MachineCCID),t.Parent.ScreenObject.Preferences.ContainsKey("MachineCCID")?t.Parent.ScreenObject.Preferences.MachineCCID=l.toString():t.Parent.ScreenObject.Preferences.push("MachineCCID",l.toString())));for(var f=[],I=function(a){var D,I=void 0,T=0,P=t.Parent.ScreenObject.GridDataObj.NewRow();if(t.Parent.ScreenObject.GridDataObj.insertRowAt(P,e),t.Parent.ScreenObject.GridDataColumns.Contains("dcccnid"+(r-5e4)+"_Key")?(P["dcccnid"+(r-5e4)+"_Key"]=t.JobNodeID,P["dcccnid"+(r-5e4)]=t.VoucherNo):(C=t.Parent.ScreenObject._CCFields.find((function(e){return e instanceof h.b&&e.CCID==r})))instanceof h.b&&(C.SelectedValue=t.JobNodeID,n.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==n.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(C.SelectedValueText=t.VoucherNo)),t.AddedGridObj.TableColumns.Contains("DimID")&&!i.e.IsEmpty(t.AddGridData[a].DimID)&&g>0)if(t.Parent.ScreenObject.GridDataColumns.Contains("JobUnqID")||t.Parent.ScreenObject.GridDataColumns.push("JobUnqID"),P.JobUnqID=t.AddGridData[a].DimID.toString(),t.Parent.ScreenObject.GridDataColumns.Contains("dcccnid"+(g-5e4)+"_Key")){if(P["dcccnid"+(g-5e4)+"_Key"]=t.AddGridData[a].DimID,t.ds.Columns[0].Contains("DimName")){var O=t.ds.Tables[0].filter((function(e){return e.DimID==t.AddGridData[a].DimID}));O.length>0&&(P["dcccnid"+(g-5e4)]=O[0].DimName)}}else if((C=t.Parent.ScreenObject._CCFields.find((function(e){return e instanceof h.b&&e.CCID==g})))instanceof h.b&&(C.SelectedValue=parseInt(t.AddGridData[a].DimID),n.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==n.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&t.ds.Columns[0].Contains("DimName"))){var B=t.ds.Tables[0].filter((function(e){return e.DimID==t.AddGridData[a].DimID}));B.length>0&&(C.SelectedValueText=B[0].DimName.toString())}if(i.e.IsEmpty(t.AddGridData[a].BomNodeID)||(t.Parent.ScreenObject.GridDataColumns.Contains("dcccnid"+(p-5e4)+"_Key")?(P["dcccnid"+(p-5e4)+"_Key"]=t.AddGridData[a].BomNodeID,P["dcccnid"+(p-5e4)]=t.AddGridData[a].BomName.toString()):(C=t.Parent.ScreenObject._CCFields.find((function(e){return e instanceof h.b&&e.CCID==p})))instanceof h.b&&(C.SelectedValue=parseInt(t.AddGridData[a].BomNodeID),n.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==n.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(C.SelectedValueText=t.AddGridData[a].BomName)),t.Parent.ScreenObject.GridDataColumns.Contains("BOMID")||t.Parent.ScreenObject.GridDataColumns.push("BOMID"),P.BOMID=t.AddGridData[a].BomNodeID),t.Parent.ScreenObject.GridDataColumns.Contains("jobID")||t.Parent.ScreenObject.GridDataColumns.push("jobID"),P.jobID=t.JobNodeID,o>0&&!i.e.IsEmpty(t.AddGridData[a].StageNodeID)&&(t.Parent.ScreenObject.GridDataColumns.Contains("dcccnid"+(o-5e4)+"_Key")?(P["dcccnid"+(o-5e4)+"_Key"]=t.AddGridData[a].StageNodeID,P["dcccnid"+(o-5e4)]=t.AddGridData[a].StageName.toString()):((y=t.Parent.ScreenObject._CCFields.find((function(e){return e instanceof h.b&&e.CCID==o})))instanceof h.b&&(y.SelectedValue=parseInt(t.AddGridData[a].StageNodeID),n.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==n.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(y.SelectedValueText=t.AddGridData[a].StageName.toString())),t.Parent.ScreenObject.GridDataColumns.Contains("StageID")||t.Parent.ScreenObject.GridDataColumns.push("StageID"),P.StageID=t.AddGridData[a].StageNodeID)),36==t.Parent.ScreenObject.DocumentType){t.AddtempProd(P),t.Parent.ScreenObject.GridDataColumns.Contains("dcNum3")&&(P.dcNum3=t.AddGridData[a].Value),t.Parent.ScreenObject.GridDataColumns.Contains("dcNum1")&&(P.dcNum1=t.AddGridData[a].Cost),t.Parent.ScreenObject.GridDataColumns.Contains("dcNum2")&&(P.dcNum2=t.AddGridData[a].Hrs),t.Parent.ScreenObject.GridDataColumns.Contains("dcccnid"+(l-5e4)+"_Key")&&(P["dcccnid"+(l-5e4)+"_Key"]=t.AddGridData[a].MachineID,P["dcccnid"+(l-5e4)]=t.AddGridData[a].Machine.toString()),t.Parent.ScreenObject.GridDataColumns.Contains("CreditAccount")&&(i.e.IsEmpty(t.GridData[a].CrAccountID)?(c=t.Parent.ScreenObject.ColumnSource.find((function(e){return null!=e.ValueMember&&"creditaccount_key"==e.ValueMember.toLowerCase()})))&&!i.e.IsEmpty(c.DefaultValue)&&(P.CreditAccount_Key=c.DefaultValue,P.CreditAccount=c.DefaultValueText):(P.CreditAccount=t.AddGridData[a].CrAccount.toString(),P.CreditAccount_Key=t.AddGridData[a].CrAccountID)),t.Parent.ScreenObject.GridDataColumns.Contains("DebitAccount")&&(i.e.IsEmpty(t.GridData[a].DrAccountID)?(c=t.Parent.ScreenObject.ColumnSource.find((function(e){return null!=e.ValueMember&&"debitaccount_key"==e.ValueMember.toLowerCase()})))&&!i.e.IsEmpty(c.DefaultValue)&&(P.DebitAccount_Key=c.DefaultValue,P.DebitAccount=c.DefaultValueText):(P.DebitAccount_Key=t.AddGridData[a].DrAccountID.toString(),P.DebitAccount=t.AddGridData[a].DrAccount));t.GridObj.TableColumns.Contains("MachineDim1")&&""!=t.AddGridData[a].MachineDim1.toString()&&t.Parent.ScreenObject.Preferences.ContainsKey("MachineDim1")&&i.e.Int(t.Parent.ScreenObject.Preferences.MachineDim1)>0&&(t.Parent.ScreenObject.GridDataColumns.Contains("dcccnid-50000")?P["dcccnid-50000_Key"]=t.AddGridData[a].MachineDim1.toString():null!=(b=t.Parent.ScreenObject._CCFields.find((function(e){return"dcccnid-50000"==e.DBColumnName.toLowerCase()})))&&null!=b&&b instanceof h.b&&(b.SelectedValue=parseInt(t.AddGridData[a].MachineDim1.toString()))),t.GridObj.TableColumns.Contains("MachineDim2")&&""!=t.AddGridData[a].MachineDim2.toString()&&t.Parent.ScreenObject.Preferences.ContainsKey("MachineDim2")&&i.e.Int(t.Parent.ScreenObject.Preferences.MachineDim2)>0&&(t.Parent.ScreenObject.GridDataColumns.Contains("dcccnid-50000")?P["dcccnid-50000_Key"]=t.AddGridData[a].MachineDim1.toString():null!=(b=t.Parent.ScreenObject._CCFields.find((function(e){return"dcccnid-50000"==e.DBColumnName.toLowerCase()})))&&null!=b&&b instanceof h.b&&(b.SelectedValue=parseInt(t.AddGridData[a].MachineDim2.toString())))}else 37==t.Parent.ScreenObject.DocumentType?(t.AddtempProd(P),t.Parent.ScreenObject.GridDataColumns.Contains("LineNarration")&&(P.LineNarration=t.AddGridData[a].Name.toString()),t.Parent.ScreenObject.GridDataColumns.Contains("CreditAccount")&&(P.CreditAccount=t.AddGridData[a].Credit.toString(),P.CreditAccount_Key=t.AddGridData[a].CreditAccountID),t.Parent.ScreenObject.GridDataColumns.Contains("DebitAccount")&&(P.DebitAccount_Key=t.AddGridData[a].DebitAccountID,P.DebitAccount=t.AddGridData[a].Debit.toString()),t.Parent.ScreenObject.GridDataColumns.Contains("dcNum1")&&(P.dcNum1=t.AddGridData[a].Value)):(P.ProductID_Key=t.AddGridData[a].ProductID_Key,t.Parent.ScreenObject.GridDataColumns.Contains("ProductName")&&(P.ProductName=t.AddGridData[a].ProductName.toString()),t.Parent.ScreenObject.GridDataColumns.Contains("ProductCode")&&(P.ProductCode=t.AddGridData[a].ProductCode.toString()),t.Parent.ScreenObject.GridDataColumns.Contains("Unit")&&(P.Unit=t.AddGridData[a].UOMID.toString()),t.Parent.ScreenObject.GridDataColumns.Contains("Unit_Key")&&(P.Unit_Key=t.AddGridData[a].UOMID_Key),t.Parent.ScreenObject.GridDataColumns.Contains("NetJobQty")||t.Parent.ScreenObject.GridDataColumns.push("NetJobQty"),P.NetJobQty=t.AddGridData[a].Net,i.e.IsEmpty(t.AddGridData[a].Qty)?P.Quantity=1:null!=t.Parent.AutoPostViewModel&&t.Parent.ScreenObject.Preferences.ContainsKey("ExpFPQTY")&&t.Parent.ScreenObject.GridDataColumns.Contains(t.Parent.ScreenObject.Preferences.ExpFPQTY)?P[t.Parent.ScreenObject.Preferences.ExpFPQTY]=t.AddGridData[a].Qty:P.Quantity=t.AddGridData[a].Qty,P.Type=t.AddGridData[a].ProductType,t.Parent.AddProductData(P,!1,!0),!i.e.IsEmpty(t.AddGridData[a].Qty)&&null!=t.Parent.AutoPostViewModel&&t.Parent.ScreenObject.Preferences.ContainsKey("ExpFPQTY")&&t.Parent.ScreenObject.GridDataColumns.Contains(t.Parent.ScreenObject.Preferences.ExpFPQTY)&&(P[t.Parent.ScreenObject.Preferences.ExpFPQTY]=t.AddGridData[a].Qty),t.AddedGridObj.TableColumns.Contains("RemainingQty")&&(t.Parent.ScreenObject.GridDataColumns.Contains("RemQty")||t.Parent.ScreenObject.GridDataColumns.push("RemQty"),P.RemQty=t.AddGridData[a].RemainingQty));if(t.Parent.ScreenObject.GridDataColumns.Contains("RefNo")&&(P.RefNo=t.VoucherNo),t.Parent.ScreenObject.GridDataColumns.Contains("dcccnid"+(r-5e4)+"_Key")?(P["dcccnid"+(r-5e4)+"_Key"]=t.JobNodeID,P["dcccnid"+(r-5e4)]=t.VoucherNo,(S=t.Parent.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember.toLowerCase()=="dcccnid"+(r-5e4)})))&&((I=t.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&e.LocalReference==S.ID}))).length>0&&t.Parent.ScreenObject.GetLinkReferenceData(parseInt(S.ID),t.Parent.DocumentID,parseInt(P[S.ValueMember]),Date.Today(),"",S.CostCenterID,P))):(C=t.Parent.ScreenObject._CCFields.find((function(e){return e instanceof h.b&&e.CCID==r})))instanceof h.b&&(C.SelectedValue=t.JobNodeID,n.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==n.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(C.SelectedValueText=t.VoucherNo)),i.e.IsEmpty(t.AddGridData[a].BomNodeID)||(t.Parent.ScreenObject.GridDataColumns.Contains("dcccnid"+(p-5e4)+"_Key")?(P["dcccnid"+(p-5e4)+"_Key"]=t.AddGridData[a].BomNodeID,P["dcccnid"+(p-5e4)]=t.AddGridData[a].BomName.toString(),(S=t.Parent.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember.toLowerCase()=="dcccnid"+(p-5e4)})))&&((I=t.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&e.LocalReference==S.ID}))).length>0&&t.Parent.ScreenObject.GetLinkReferenceData(parseInt(S.ID),t.Parent.DocumentID,parseInt(P[S.ValueMember]),Date.Today(),"",S.CostCenterID,P))):(C=t.Parent.ScreenObject._CCFields.find((function(e){return e instanceof h.b&&e.CCID==p})))instanceof h.b&&(C.SelectedValue=parseInt(t.AddGridData[a].BomNodeID),n.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==n.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(C.SelectedValueText=t.AddGridData[a].BomName.toString())),t.Parent.ScreenObject.GridDataColumns.Contains("BOMID")||t.Parent.ScreenObject.GridDataColumns.push("BOMID"),P.BOMID=t.AddGridData[a].BomNodeID),(I=t.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&55252==e.LinkData}))).length>0&&t.Parent.ScreenObject.GridDataColumns.Contains(I[0].SysColumnName)&&(P[I[0].SysColumnName]=t.AddGridData[a].IPQTY),(I=t.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&54209==e.LinkData}))).length>0&&t.Parent.ScreenObject.GridDataColumns.Contains(I[0].SysColumnName)&&!i.e.IsEmpty(t.AddGridData[a].UnitPrice)&&(P[I[0].SysColumnName]=t.AddGridData[a].UnitPrice),(I=t.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&55253==e.LinkData}))).length>0&&t.Parent.ScreenObject.GridDataColumns.Contains(I[0].SysColumnName)&&(P[I[0].SysColumnName]=t.AddGridData[a].OPQTY),(I=t.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&55254==e.LinkData}))).length>0&&t.Parent.ScreenObject.GridDataColumns.Contains(I[0].SysColumnName)&&(P[I[0].SysColumnName]=t.AddGridData[a].BatchSize),I=t.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&55474==e.LinkData})),t.AddedGridObj.TableColumns.Contains("Remarks")&&I.length>0&&t.Parent.ScreenObject.GridDataColumns.Contains(I[0].SysColumnName)&&(P[I[0].SysColumnName]=t.AddGridData[a].Remarks),(I=t.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&55259==e.LinkData}))).length>0&&t.Parent.ScreenObject.GridDataColumns.Contains(I[0].SysColumnName)&&!i.e.IsEmpty(t.AddGridData[a].Qty)&&(P[I[0].SysColumnName]=t.AddGridData[a].Qty.toString()),t.Parent.ScreenObject.GridDataColumns.Contains("jobID")||t.Parent.ScreenObject.GridDataColumns.push("jobID"),P.jobID=t.JobNodeID,o>0&&!i.e.IsEmpty(t.AddGridData[a].StageNodeID)&&(t.Parent.ScreenObject.GridDataColumns.Contains("dcccnid"+(o-5e4)+"_Key")?(P["dcccnid"+(o-5e4)+"_Key"]=t.AddGridData[a].StageNodeID,P["dcccnid"+(o-5e4)]=t.AddGridData[a].StageName.toString()):((y=t.Parent.ScreenObject._CCFields.find((function(e){return e instanceof h.b&&e.CCID==o})))instanceof h.b&&(y.SelectedValue=parseInt(t.AddGridData[a].StageNodeID),n.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==n.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(y.SelectedValueText=t.AddGridData[a].StageName.toString())),t.Parent.ScreenObject.GridDataColumns.Contains("StageID")||t.Parent.ScreenObject.GridDataColumns.push("StageID"),P.StageID=t.AddGridData[a].StageNodeID)),i.e.IsNum(P.UOMConversion)&&i.e.IsNum(P.Quantity)&&(P.UOMConvertedQty=parseFloat(P.UOMConversion)*parseFloat(P.Quantity)),P.LinkedFieldName=t.IsBom?"BOM":"JOB",!i.e.IsEmpty(P.Type)&&5==parseInt(P.Type)&&!i.e.IsEmpty(P.Quantity)&&parseFloat(P.Quantity)>0)if(-1==t.Parent.VoucherType&&t.Parent.ScreenObject.Preferences.ContainsKey("AutoBatches")&&""!=t.Parent.ScreenObject.Preferences.AutoBatches.toString()&&Object(s.j)(t.Parent.ScreenObject.Preferences.AutoBatches)){var G,N;N=t.Parent.ScreenObject.LocationID>0?t.Parent.ScreenObject.LocationID:n.a.SessionManager.LocationID,G=t.Parent.ScreenObject.DivisionID>0?t.Parent.ScreenObject.DivisionID:n.a.SessionManager.DivisionID;var v=i.e.DoubleTryParse(P.Quantity);i.e.IsNum(P.UOMConversion)&&(v*=parseFloat(P.UOMConversion));var M=new m.a(t.Parent.ScreenObject.GridDataObj);M.BatchNumberViewModel_3(t.Parent,t.Parent.VoucherType,v,parseInt(P.ProductID_Key),P.ProductName.toString(),N,G,P),M.ChkFifo=!0,M.OnSave("Save"),M.count>1&&(e=e+M.count-1)}else if(1==t.Parent.VoucherType)if("1"!=t.AddGridData[a].IsOutput.toString()||t.Parent.ScreenObject.Preferences.ContainsKey("AutoBatchNoinReciept")&&"True"!=t.Parent.ScreenObject.Preferences.AutoBatchNoinReciept.toString()){var j;if(t.ds.Tables.length>4&&t.ds.Tables[4].length>0&&t.ds.Columns[4].Contains("BatchID"))if((j=t.ds.Tables[4].filter(o>0?function(e){return e.ProductID==P.ProductID_Key&&e.StageID==t.AddGridData[a].StageNodeID}:function(e){return e.ProductID==P.ProductID_Key})).length>0){var V=0;i.e.Double(P.Quantity)>0&&(V=parseFloat(P.Quantity)),i.e.IsEmpty(P.UOMConversion)||(V*=parseFloat(P.UOMConversion));var A="";A+="<xml>",A+="<Row ",A+=' BatchID="'+j[0].BatchID.toString()+'" ',A+=' ProductID="'+P.ProductID_Key.toString()+'" ',A+=' Quantity="'+V.toString()+'" ',A+=' Hold="0" ',A+=' Release="'+V.toString()+'" ',A+=" ></Row>",A+="</xml>",P.ExtraXML=A.toString()}}else{var R=t.VoucherNo,w={BatchID:0},E=t.Parent.ScreenObject.GetBatch(t.VoucherNo,P.ProductID_Key.toString(),w);if(t.Parent.ScreenObject.Preferences.ContainsKey("CreateNewBatchNo")&&"True"==t.Parent.ScreenObject.Preferences.CreateNewBatchNo.toString()&&(w.BatchID=0,E.Tables.length>3&&E.Tables[3].length>0)){var Q=E.Tables[3].filter((function(e){return 1==e.IsName}));if(Q.length>0&&!i.e.IsEmpty(Q[0].PrefixContent))try{R=t.GetBatchNo(Q[0].PrefixContent.toString(),P)}catch(fe){Logger.ErrorLog("error reading PrefixContent xml")}}if(w.BatchID<=0){var L,F,_,k,x=Date.Today(),K=Date.Today(),J="",U="";if(L=t.ds.Tables.length>2&&t.ds.Tables[2].length>0&&t.ds.Columns[2].Contains("ccAlpha45")&&i.e.isValidDate(t.ds.Tables[2][0].ccAlpha45)?new Date(t.ds.Tables[2][0].ccAlpha45):null,x=t.ds.Tables.length>2&&t.ds.Tables[2].length>0&&t.ds.Columns[2].Contains("ccAlpha47")&&i.e.isValidDate(t.ds.Tables[2][0].ccAlpha47)?new Date(t.ds.Tables[2][0].ccAlpha47):t.Parent.DocumentDate,K=t.ds.Tables.length>2&&t.ds.Tables[2].length>0&&t.ds.Columns[2].Contains("ccAlpha46")&&i.e.isValidDate(t.ds.Tables[2][0].ccAlpha46)?new Date(t.ds.Tables[2][0].ccAlpha46):E.Tables.length>2&&E.Columns[2].Contains("ShelfLife")&&E.Tables[2].length>0&&!i.e.IsEmpty(E.Tables[2][0].ShelfLife)?x.AddDays(parseInt(E.Tables[2][0].ShelfLife)):Date.Today(),F=t.ds.Tables.length>2&&t.ds.Tables[2].length>0&&t.ds.Columns[2].Contains("ccAlpha44")&&i.e.IsNum(t.ds.Tables[2][0].ccAlpha44)?parseFloat(t.ds.Tables[2][0].ccAlpha44):0,_=t.ds.Tables.length>2&&t.ds.Tables[2].length>0&&t.ds.Columns[2].Contains("ccAlpha43")&&i.e.IsNum(t.ds.Tables[2][0].ccAlpha43)?parseFloat(t.ds.Tables[2][0].ccAlpha43):0,k=t.ds.Tables.length>2&&t.ds.Tables[2].length>0&&t.ds.Columns[2].Contains("ccAlpha42")&&i.e.IsNum(t.ds.Tables[2][0].ccAlpha42)?parseFloat(t.ds.Tables[2][0].ccAlpha42):0,t.ds.Tables.length>2&&t.ds.Tables[2].length>0&&t.ds.Columns[2].Contains("ccAlpha40")&&i.e.IsNum(t.ds.Tables[2][0].ccAlpha40)&&(J=" PreExpiryDays = "+parseInt(t.ds.Tables[2][0].ccAlpha40)+","),i.e.IsType(t.Parent,"AddEditDocumentViewModel")){var W=0,H=!1;if(n.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise Batches")&&""!=n.a.SessionManager.Preferences["Maintain Dimensionwise Batches"].toString()&&(W=i.e.IntTryParse(n.a.SessionManager.Preferences["Maintain Dimensionwise Batches"]))>0){for(var X=0;X<t.Parent.ScreenObject._CCFields.length;X++){var q=t.Parent.ScreenObject._CCFields[X];if(q instanceof h.b&&q.CCID==W){U="CCNID"+(W-5e4)+"='"+q.SelectedValue+"',",H=!0;break}}H||null!=P&&W>5e4&&!i.e.IsEmpty(P["dcCCNID"+(W-5e4)+"_Key"])&&(U=U+"CCNID"+(W-5e4)+"='"+P["dcCCNID"+(W-5e4)+"_Key"].toString()+"',")}if(t.Parent.ScreenObject.Preferences.ContainsKey("BatchFilterDim")&&(H=!1,(W=i.e.IntTryParse(t.Parent.ScreenObject.Preferences.BatchFilterDim))>0&&!U.Contains("CCNID"+(W-5e4)+"="))){for(var Y=0;Y<t.Parent.ScreenObject._CCFields.length;Y++){var z=t.Parent.ScreenObject._CCFields[Y];if(z instanceof h.b&&z.CCID==W){z.SelectedValue>0&&(U=U+"CCNID"+(W-5e4)+"='"+z.SelectedValue+"',"),H=!0;break}}H||W>5e4&&t.Parent.ScreenObject.GridDataColumns.Contains("dcCCNID"+(W-5e4)+"_Key")&&(H=!0,i.e.IsEmpty(P["dcCCNID"+(W-5e4)+"_Key"])||(U=U+"CCNID"+(W-5e4)+"='"+P["dcCCNID"+(W-5e4)+"_Key"].toString()+"',"))}}w.BatchID=t.Parent.ScreenObject.SaveBatch(R,x,K,L,F,_,k,P.ProductID_Key,J,U)}if(w.BatchID>0){var Z=0;!i.e.IsEmpty(P.Quantity)&&parseFloat(P.Quantity)>0&&(Z=parseFloat(P.Quantity)),i.e.IsEmpty(P.UOMConversion)||(Z*=parseFloat(P.UOMConversion));var $="";$+="<xml>",$+="<Row ",$+=' BatchID="'+w.BatchID+'" ',$+=' ProductID="'+P.ProductID_Key.toString()+'" ',$+=' Quantity="'+Z.toString()+'" ',$+=' Hold="0" ',$+=' Release="'+Z.toString()+'" ',$+=" ></Row>",$+="</xml>",P.ExtraXML=$.toString()}}if(t.Parent.ScreenObject.GridDataColumns.Contains("NextStageID")&&(P.NextStageID=t.AddGridData[a].StageNodeID.toString()),36!=t.Parent.ScreenObject.DocumentType&&37!=t.Parent.ScreenObject.DocumentType&&!f.Contains(t.AddGridData[a].StageID.toString())&&null!=t.Parent.AutoPostViewModel)if(f.push(t.AddGridData[a].StageID.toString()),t.Parent.ScreenObject.IsPurchase){var ee,te;o>0&&(ee=t.AddGridData[a].StageID),g>0&&t.AddedGridObj.TableColumns.Contains("DimID")&&(te=t.AddGridData[a].DimID);var ae=t.ds.Tables[1].filter((function(e){return 2==e.ProductUse&&e.bomID==t.AddGridData[a].BomID&&e.ProductID==P.ProductID_Key&&(Object(u.isUndefined)(ee)||e.StageID==ee)&&(Object(u.isUndefined)(te)||e.DimID==te)}));if(ae.length>0&&!i.e.IsEmpty(ae[0].Quantity)){var ne=parseFloat(ae[0].Quantity);if(ee=void 0,te=void 0,o>0&&(ee=ae[0].StageID.toString()),g>0&&t.AddedGridObj.TableColumns.Contains("DimID")&&(te=t.AddGridData[a].DimID.toString()),(ae=t.ds.Tables[1].filter((function(e){return 1==e.ProductUse&&e.bomID==t.AddGridData[a].BomID&&(Object(u.isUndefined)(ee)||e.StageID==ee)&&(Object(u.isUndefined)(te)||e.DimID==te)}))).length>0){t.Parent.AutoPostViewModel.ScreenObject._CCFields.forEach((function(e){var a=t.Parent.ScreenObject._CCFields.find((function(t){return t.DBColumnName==e.DBColumnName}));a&&e instanceof h.b&&a instanceof h.b&&(e.SelectedValue=a.SelectedValue,e.SelectedValueText=a.Text)})),t.Parent.AutoPostViewModel.ScreenObject.Preferences.ContainsKey("jobCCID")?t.Parent.AutoPostViewModel.ScreenObject.Preferences.jobCCID=r.toString():t.Parent.AutoPostViewModel.ScreenObject.Preferences.push("jobCCID",r.toString()),i.e.IsEmpty(t.ds.Tables[2][0].StageCCID)||(t.Parent.AutoPostViewModel.ScreenObject.Preferences.ContainsKey("StageCCID")?t.Parent.AutoPostViewModel.ScreenObject.Preferences.StageCCID=o.toString():t.Parent.AutoPostViewModel.ScreenObject.Preferences.push("StageCCID",o.toString())),p>0&&(t.Parent.AutoPostViewModel.ScreenObject.Preferences.ContainsKey("BomCCID")?t.Parent.AutoPostViewModel.ScreenObject.Preferences.BomCCID=p.toString():t.Parent.AutoPostViewModel.ScreenObject.Preferences.push("BomCCID",p.toString()));for(var ie=0,se=0;se<t.Parent.AutoPostViewModel.ScreenObject.GridData.length;se++)if(i.e.IsEmpty(t.Parent.AutoPostViewModel.ScreenObject.GridData[se].ProductID_Key)){ie=se;break}for(var re=i.e.NewGuid(),oe=0;oe<ae.length;oe++,ie++)if(!i.e.IsEmpty(ae[oe].Quantity)){var le=t.Parent.AutoPostViewModel.ScreenObject.GridDataObj.NewRow();if(t.Parent.AutoPostViewModel.ScreenObject.GridData.InsertAt(le,ie),t.AddedGridObj.TableColumns.Contains("DimID")&&!i.e.IsEmpty(t.AddGridData[a].DimID)&&g>0)if(t.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("JobUnqID")||t.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.push("JobUnqID"),le.JobUnqID=t.AddGridData[a].DimID.toString(),t.Parent.ScreenObject.GridDataColumns.Contains("dcccnid"+(g-5e4)+"_Key")){if(le["dcccnid"+(g-5e4)+"_Key"]=t.AddGridData[a].DimID.toString(),t.ds.Columns[0].Contains("DimName")){var ce=t.ds.Tables[0].filter((function(e){return e.DimID==t.AddGridData[a].DimID}));ce.length>0&&(le["dcccnid"+(g-5e4)]=ce[0].DimName)}}else if(0==oe&&(C=t.Parent.ScreenObject._CCFields.find((function(e){return e instanceof h.b&&e.CCID==g})))instanceof h.b&&(C.SelectedValue=parseInt(t.AddGridData[a].DimID),n.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==n.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&t.ds.Columns[0].Contains("DimName"))){var de=t.ds.Tables[0].filter((function(e){return e.DimID==t.AddGridData[a].DimID}));de.length>0&&(C.SelectedValueText=de[0].DimName.toString())}if(le.ProductID_Key=ae[oe].ProductID.toString(),t.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("ProductName")&&(le.ProductName=ae[oe].ProductName.toString()),t.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("ProductCode")&&(le.ProductCode=ae[oe].ProductCode.toString()),t.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("Unit")&&(le.Unit=ae[oe].UnitName.toString()),t.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("Unit_Key")&&(le.Unit_Key=ae[oe].UOMID.toString()),le.defaultQuantity=parseFloat(ae[oe].Quantity)/ne,le.Quantity=parseFloat(le.defaultQuantity)*parseFloat(t.AddGridData[a].Qty),i.e.IsEmpty(le.Quantity)||(I=t.Parent.AutoPostViewModel.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&55259==e.LinkData}))).length>0&&t.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains(I[0].SysColumnName.toString())&&(le[I[0].SysColumnName.toString()]=le.Quantity.toString()),le.Type=ae[oe].ProductTypeID,t.Parent.AutoPostViewModel.AddProductData(le,!1,!0),t.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("RefNo")&&(le.RefNo=t.VoucherNo),t.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("dcccnid"+(r-5e4)+"_Key")?(le["dcccnid"+(r-5e4)+"_Key"]=t.JobNodeID,le["dcccnid"+(r-5e4)]=t.VoucherNo):(C=t.Parent.AutoPostViewModel.ScreenObject._CCFields.find((function(e){return e instanceof h.b&&e.CCID==r})))instanceof h.b&&(C.SelectedValue=t.JobNodeID,n.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==n.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(C.SelectedValueText=t.VoucherNo)),t.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("jobID")||t.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.push("jobID"),le.jobID=t.JobNodeID,o>0&&!i.e.IsEmpty(t.AddGridData[a].StageNodeID)&&(t.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("dcccnid"+(o-5e4)+"_Key")?(le["dcccnid"+(o-5e4)+"_Key"]=t.AddGridData[a].StageNodeID.toString(),le["dcccnid"+(o-5e4)]=t.AddGridData[a].StageName.toString(),t.CallReference_3(t.Parent.AutoPostViewModel,o,le)):(0==oe&&(y=t.Parent.AutoPostViewModel.ScreenObject._CCFields.find((function(e){return e instanceof h.b&&e.CCID==o})))instanceof h.b&&(y.SelectedValue=parseInt(t.AddGridData[a].StageNodeID),n.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==n.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(y.SelectedValueText=t.AddGridData[a].StageName.toString()),t.CallReference_2(t.Parent.AutoPostViewModel,y)),t.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("StageID")||t.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.push("StageID"),le.StageID=t.AddGridData[a].StageNodeID)),p>0&&!i.e.IsEmpty(t.AddGridData[a].BomNodeID)&&(t.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("dcccnid"+(p-5e4)+"_Key")?(le["dcccnid"+(p-5e4)+"_Key"]=t.AddGridData[a].BomNodeID.toString(),le["dcccnid"+(p-5e4)]=t.AddGridData[a].BomName.toString(),t.CallReference_3(t.Parent.AutoPostViewModel,p,le)):(0==oe&&(y=t.Parent.AutoPostViewModel.ScreenObject._CCFields.find((function(e){return e instanceof h.b&&e.CCID==p})))instanceof h.b&&(y.SelectedValue=parseInt(t.AddGridData[a].BomNodeID),n.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==n.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(y.SelectedValueText=t.AddGridData[a].BomName.toString()),t.CallReference_2(t.Parent.AutoPostViewModel,y)),t.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("BOMID")||t.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.push("BOMID"),le.BOMID=t.AddGridData[a].BomNodeID)),i.e.IsNum(le.UOMConversion)&&(le.UOMConvertedQty=parseFloat(le.UOMConversion)*parseFloat(le.Quantity)),t.Parent.AutoPostViewModel.CalculateTotals(le,!1),le.LinkedFieldName=t.IsBom?"BOM":"JOB",i.e.IsEmpty(le.Gross)||(T+=parseFloat(le.Gross)),le.RefSeqNo=re,!i.e.IsEmpty(ae[oe].AutoStage)&&null!=t.Parent.AutoPostViewModel.AutoProduce){var ue;ue=g>0&&t.AddedGridObj.TableColumns.Contains("DimID")?t.AutoProduce(t.Parent.AutoPostViewModel.AutoProduce,ae[oe],r,p,o,g,t.AddGridData[a].DimID.toString(),parseFloat(le.Quantity)):t.AutoProduce(t.Parent.AutoPostViewModel.AutoProduce,ae[oe],r,p,o,0,"",parseFloat(le.Quantity)),le.AutoRefSeqNo=ue}}if(t.Parent.ScreenObject.Preferences.ContainsKey("CalcOpRate")&&""!=t.Parent.ScreenObject.Preferences.CalcOpRate.toString()&&Object(s.j)(t.Parent.ScreenObject.Preferences.CalcOpRate))if(t.Parent.ScreenObject.Preferences.ContainsKey("QtyBasedCost")&&""!=t.Parent.ScreenObject.Preferences.QtyBasedCost.toString()&&Object(s.j)(t.Parent.ScreenObject.Preferences.QtyBasedCost)){var he=0;i.e.IsNum(t.AddGridData[a].ActualQty)&&(he=T/parseFloat(t.AddGridData[a].ActualQty)),P.Rate=he}else P.Rate=(t.Parent.ScreenObject.Preferences.ContainsKey("ExpFPQTY")&&t.Parent.ScreenObject.GridDataColumns.Contains(t.Parent.ScreenObject.Preferences.ExpFPQTY)&&t.Parent.ScreenObject.Preferences.ExpFPQTY.toLowerCase(),T/parseFloat(t.AddGridData[a].Qty));P.RefSeqNo=re}}}else!function(){var e,l;o>0&&(e=t.AddGridData[a].StageID),g>0&&t.AddedGridObj.TableColumns.Contains("DimID")&&(l=t.AddGridData[a].DimID);var c=t.ds.Tables[0].filter((function(n){return n.BOMID==t.AddGridData[a].BomID&&(Object(u.isUndefined)(e)||n.StageID==e)&&(Object(u.isUndefined)(l)||n.DimID==l)}));if(c.length>0){t.Parent.AutoPostViewModel.ScreenObject._CCFields.forEach((function(e){var a=t.Parent.ScreenObject._CCFields.find((function(t){return t.DBColumnName==e.DBColumnName}));a&&e instanceof h.b&&a instanceof h.b&&(e.SelectedValue=a.SelectedValue,e.SelectedValueText=a.Text)})),t.Parent.AutoPostViewModel.ScreenObject.Preferences.ContainsKey("jobCCID")?t.Parent.AutoPostViewModel.ScreenObject.Preferences.jobCCID=r.toString():t.Parent.AutoPostViewModel.ScreenObject.Preferences.push("jobCCID",r.toString()),i.e.IsEmpty(t.ds.Tables[2][0].StageCCID)||(t.Parent.AutoPostViewModel.ScreenObject.Preferences.ContainsKey("StageCCID")?t.Parent.AutoPostViewModel.ScreenObject.Preferences.StageCCID=o.toString():t.Parent.AutoPostViewModel.ScreenObject.Preferences.push("StageCCID",o.toString()));for(var d=0,D=0;D<t.Parent.AutoPostViewModel.ScreenObject.GridData.length;D++)if(i.e.IsEmpty(t.Parent.AutoPostViewModel.ScreenObject.GridData[D].ProductID_Key)){d=D;break}for(var m=i.e.NewGuid(),b=function(D){e=void 0,l=void 0,o>0&&(e=t.AddGridData[a].StageID),g>0&&t.AddedGridObj.TableColumns.Contains("DimID")&&(l=t.AddGridData[a].DimID);var b=t.ds.Tables[1].filter((function(n){return n.BOMID==t.AddGridData[a].BomID&&n.ProductID==c[D].ProductID&&(Object(u.isUndefined)(e)||n.StageID==e)&&(Object(u.isUndefined)(l)||n.DimID==l)}));if(b.length>0){var S=t.Parent.AutoPostViewModel.ScreenObject.GridDataObj.NewRow();t.Parent.AutoPostViewModel.ScreenObject.GridData.InsertAt(S,d),S.ProductID_Key=b[0].ProductID.toString(),t.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("ProductName")&&(S.ProductName=b[0].ProductName.toString()),t.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("ProductCode")&&(S.ProductCode=b[0].ProductCode.toString()),t.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("Unit")&&(S.Unit=b[0].UnitName.toString()),t.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("Unit_Key")&&(S.Unit_Key=b[0].UOMID.toString()),S.Quantity=t.ds.Columns[0].Contains("IsBom")&&!i.e.IsEmpty(c[0].IsBom)&&!t.IsBom&&Object(s.j)(c[0].IsBom)?parseFloat(b[0].Quantity)*parseFloat(t.AddGridData[a].RemQty):t.AddGridData[a].RemQty.toString(),S.Type=b[0].ProductTypeID,t.Parent.AutoPostViewModel.AddProductData(S,!1,!0),t.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("RefNo")&&(S.RefNo=t.VoucherNo),t.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("dcccnid"+(r-5e4)+"_Key")?(S["dcccnid"+(r-5e4)+"_Key"]=t.JobNodeID,S["dcccnid"+(r-5e4)]=t.VoucherNo):(C=t.Parent.AutoPostViewModel.ScreenObject._CCFields.find((function(e){return e instanceof h.b&&e.CCID==r})))instanceof h.b&&(C.SelectedValue=t.JobNodeID,n.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==n.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(C.SelectedValueText=t.VoucherNo)),t.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("jobID")||t.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.push("jobID"),S.jobID=t.JobNodeID,o>0&&!i.e.IsEmpty(t.AddGridData[a].StageNodeID)&&(t.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("dcccnid"+(o-5e4)+"_Key")?(S["dcccnid"+(o-5e4)+"_Key"]=t.AddGridData[a].StageNodeID.toString(),S["dcccnid"+(o-5e4)]=t.AddGridData[a].StageName.toString()):((y=t.Parent.AutoPostViewModel.ScreenObject._CCFields.find((function(e){return e instanceof h.b&&e.CCID==o})))instanceof h.b&&(y.SelectedValue=parseInt(t.AddGridData[a].StageNodeID),n.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==n.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(y.SelectedValueText=t.AddGridData[a].StageName.toString())),t.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("StageID")||t.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.push("StageID"),S.StageID=t.AddGridData[a].StageNodeID)),i.e.IsNum(S.UOMConversion)&&(S.UOMConvertedQty=parseFloat(S.UOMConversion)*parseFloat(S.Quantity)),t.Parent.AutoPostViewModel.CalculateTotals(S,!1),S.LinkedFieldName=t.IsBom?"BOM":"JOB",S.RefSeqNo=m}},S=0;S<c.length;S++)b(S)}}();t.AddedGridObj.TableColumns.Contains("AutoStage")&&!i.e.IsEmpty(t.AddGridData[a].AutoStage)&&null!=t.Parent.AutoProduce&&(D=g>0&&t.AddedGridObj.TableColumns.Contains("DimID")?t.AutoProduce(t.Parent.AutoProduce,t.AddGridData[a],r,p,o,g,t.AddGridData[a].DimID.toString(),parseFloat(t.AddGridData[a].Qty)):t.AutoProduce(t.Parent.AutoProduce,t.AddGridData[a],r,p,o,0,"",parseFloat(t.AddGridData[a].Qty)),P.AutoRefSeqNo=D);if(36!=t.Parent.ScreenObject.DocumentType&&37!=t.Parent.ScreenObject.DocumentType&&t.Parent.ScreenObject.IsPurchase&&!i.e.IsEmpty(t.AddGridData[a].Qty)&&t.Parent.ScreenObject.Preferences.ContainsKey("CalcOpRate")&&""!=t.Parent.ScreenObject.Preferences.CalcOpRate.toString()&&Object(s.j)(t.Parent.ScreenObject.Preferences.CalcOpRate))if(t.ds.Tables.length>6){var De=t.ds.Tables[5].filter((function(e){return e.ProductID==P.ProductID_Key&&e.bomID==t.AddGridData[a].BomID}));if(!i.e.IsEmpty(t.AddGridData[a].DimID)&&g>0&&t.ds.Columns[5].Contains("DimID")&&(De=De.filter((function(e){return e.DimID==t.AddGridData[a].DimID}))),De.length>0)if(t.Parent.ScreenObject.Preferences.ContainsKey("QtyBasedCost")&&""!=t.Parent.ScreenObject.Preferences.QtyBasedCost.toString()&&Object(s.j)(t.Parent.ScreenObject.Preferences.QtyBasedCost)){var me=0;i.e.IsEmpty(t.AddGridData[a].ActualQty)||(me=(parseFloat(De[0].AMT)+T)/parseFloat(t.AddGridData[a].ActualQty)),P.Rate=me}else i.e.IsEmpty(De[0].AMT)||(P.Rate=(parseFloat(De[0].AMT)+T)/parseFloat(t.AddGridData[a].Qty));else if(De=t.ds.Tables[6].filter((function(e){return e.StageID==t.AddGridData[a].StageID&&e.bomID==t.AddGridData[a].BomID})),!i.e.IsEmpty(t.AddGridData[a].DimID)&&g>0&&t.ds.Columns[6].Contains("DimID")&&(De=De.filter((function(e){return e.DimID==t.AddGridData[a].DimID}))),De.length>0&&!i.e.IsEmpty(De[0].AMT))if(t.Parent.ScreenObject.Preferences.ContainsKey("QtyBasedCost")&&""!=t.Parent.ScreenObject.Preferences.QtyBasedCost.toString()&&Object(s.j)(t.Parent.ScreenObject.Preferences.QtyBasedCost)){var be=0;i.e.IsEmpty(t.AddGridData[a].ActualQty)||(be=(parseFloat(De[0].AMT)+T)/parseFloat(t.AddGridData[a].ActualQty)),P.Rate=be}else P.Rate=(parseFloat(De[0].AMT)+T)/parseFloat(t.AddGridData[a].Qty)}else{var Se=t.Parent.ScreenObject.GetjobExpenses(t.JobNodeID.toString(),t.AddGridData[a].BomNodeID.toString()),Ce=Se.Tables[0].filter((function(e){return e.ProductID==P.ProductID_Key&&e.bomID==t.AddGridData[a].BomNodeID}));if(!i.e.IsEmpty(t.AddGridData[a].DimID)&&g>0&&t.ds.Columns[5].Contains("DimID")&&(Ce=Ce.filter((function(e){return e.DimID==t.AddGridData[a].DimID}))),Ce.length>0)if(t.Parent.ScreenObject.Preferences.ContainsKey("QtyBasedCost")&&""!=t.Parent.ScreenObject.Preferences.QtyBasedCost.toString()&&Object(s.j)(t.Parent.ScreenObject.Preferences.QtyBasedCost)){var ye=0;i.e.IsEmpty(Ce[0].AMT)||i.e.IsEmpty(t.AddGridData[a].ActualQty)||(ye=(parseFloat(Ce[0].AMT)+T)/parseFloat(t.AddGridData[a].ActualQty)),P.Rate=ye}else i.e.IsEmpty(Ce[0].AMT)||(P.Rate=parseFloat(Ce[0].AMT)/parseFloat(t.AddGridData[a].Qty));else if(Ce=Se.Tables[1].filter((function(e){return e.StageID==t.AddGridData[a].StageNodeID&&e.bomID==t.AddGridData[a].BomNodeID})),!i.e.IsEmpty(t.AddGridData[a].DimID)&&g>0&&Se.Columns[1].Contains("DimID")&&(Ce=Ce.filter((function(e){return e.DimID==t.AddGridData[a].DimID}))),Ce.length>0&&!i.e.IsEmpty(Ce[0].AMT))if(t.Parent.ScreenObject.Preferences.ContainsKey("QtyBasedCost")&&""!=t.Parent.ScreenObject.Preferences.QtyBasedCost.toString()&&Object(s.j)(t.Parent.ScreenObject.Preferences.QtyBasedCost)){var pe=0;i.e.IsEmpty(t.AddGridData[a].ActualQty)||(pe=(parseFloat(Ce[0].AMT)+T)/parseFloat(t.AddGridData[a].ActualQty)),P.Rate=pe}else P.Rate=(parseFloat(Ce[0].AMT.toString())+T)/parseFloat(t.AddGridData[a].Qty.toString())}for(var ge=0;ge<t.Parent.Shortcuts.length;ge++)t.Parent.Shortcuts[ge]instanceof d.a&&5==t.Parent.Shortcuts[ge].Mode&&t.Parent.ValidateData_Column(t.Parent.Shortcuts[ge],P,!0)&&t.Parent.ScreenObject.GetExternalFuncData(t.Parent.Shortcuts[ge].Mode,t.Parent.Shortcuts[ge].SPName,t.Parent.Shortcuts[ge].IPParams,t.Parent.Shortcuts[ge].OPParams,P);t.Parent.CalculateTotals(P,!1)},T=0;T<t.AddGridData.length;T++,e++)I(T);t.Parent.ScreenObject.UpdateSequence(),t.Parent.RefreshGrid=!t.Parent.RefreshGrid;for(var P=0;P<t.Parent.Shortcuts.length;P++)t.Parent.Shortcuts[P]instanceof D.c&&5==t.Parent.Shortcuts[P].Mode&&t.Parent.ValidateData(t.Parent.Shortcuts[P],!0)&&t.Parent.ScreenObject.GetExternalFuncData(t.Parent.Shortcuts[P].Mode,t.Parent.Shortcuts[P].ToolTipFooterTitle,t.Parent.Shortcuts[P].ToolTipFooterDescription,t.Parent.Shortcuts[P].ToolTipDescription,null)}();if("object"==typeof p)return p.v}else{for(var g=0,f=0;f<this.GridData.length;f++)if(Object(s.j)(this.GridData[f].Select)&&!i.e.IsEmpty(this.GridData[f].TobeUsed)&&"0"!=this.GridData[f].TobeUsed.toString()){g++;break}if(0==g)return void(this.DisplayMessage="Please select products");var I=!1;this.ds.Columns[0].Contains("DocumentType")&&this.ds.Tables[0].length>0&&"5"==this.ds.Tables[0][0].DocumentType.toString()&&(I=!0),this.GridObj.TableColumns.Contains("BatchXML")&&this.ds.Columns[0].push("BatchXML");for(var T=function(e){var a=t.ds.Tables[0].filter((function(a){return a.DocDetailsID==t.GridData[e].DocDetailsID}));if(a.length>0)if(parseFloat(t.GridData[e].Balance),Object(s.j)(t.GridData[e].Select)&&!i.e.IsEmpty(t.GridData[e].TobeUsed)&&"0"!=t.GridData[e].TobeUsed.toString())t.GridObj.TableColumns.Contains("BatchXML")&&!i.e.IsEmpty(t.GridData[e].BatchXML)&&(a[0].BatchXML=t.GridData[e].BatchXML.toString()),g++,i.e.String(a[0][t.ds.Columns[0][0]])!=t.GridData[e].TobeUsed.toString()&&"3"==a[0].ProductTypeID.toString()&&function(){for(var n=t.ds.Tables[0].filter((function(a){return a.DynamicInvDocDetailsID==t.GridData[e].DocDetailsID})),i=function(i){if(n[i][1].toString().toLowerCase().Contains("dcnum")){var s=t.ds.Tables[2].filter((function(e){return e.InvDocDetailsID==n[i].DocDetailsID.toString()})),r=t.ds.Tables[2].filter((function(a){return a.InvDocDetailsID==t.GridData[e].DocDetailsID.toString()}));r.length>0&&s.length>0&&(n[i][t.ds.Columns[0][0]]=parseFloat(s[0][n[i][t.ds.Columns[0][1]].toString()].toString())/parseFloat(r[0][n[i][t.ds.Columns[0][1]].toString()].toString())*parseFloat(t.GridData[e].TobeUsed.toString()))}else n[i][t.ds.Columns[0][0]]=parseFloat(n[i].Quantity.toString())/parseFloat(a[0].Quantity.toString())*parseFloat(t.GridData[e].TobeUsed.toString())},s=0;s<n.length;s++)i(s)}(),a[0][t.ds.Columns[0][0]]=t.GridData[e].TobeUsed.toString(),t.GridObj.TableColumns.Contains("ScannedBarcodes")&&!i.e.IsEmpty(t.GridData[e].ScannedBarcodes)&&(t.ds.Columns[0].Contains("ScannedBarcodes")||t.ds.Columns[0].push("ScannedBarcodes"),a[0].ScannedBarcodes=t.GridData[e].ScannedBarcodes.toString());else{for(var n,r=t.ds.Tables[0].filter((function(a){return a.DynamicInvDocDetailsID==t.GridData[e].DocDetailsID})),o=0;o<r.length;o++)n=t.ds.Tables[0].indexOf(r[o]),t.ds.Tables[1].RemoveAt(n),t.ds.Tables[2].RemoveAt(n),t.ds.Tables[3].RemoveAt(n),t.ds.Tables[0].RemoveAt(n);var l=a[0].DocSeqNo;n=t.ds.Tables[0].indexOf(a[0]),t.ds.Tables[0].RemoveAt(n),t.ds.Tables[1].RemoveAt(n),t.ds.Tables[2].RemoveAt(n),t.ds.Tables[3].RemoveAt(n),r=t.ds.Tables[7].filter((function(e){return e.RowSeqNo==l}));for(var c=0;c<r.length;c++)n=t.ds.Tables[7].indexOf(r[c]),t.ds.Tables[7].RemoveAt(n);I&&((a=t.ds.Tables[0].filter((function(e){return e.DocSeqNo==l}))).length>0&&(n=t.ds.Tables[0].indexOf(a[0]),t.ds.Tables[0].RemoveAt(n),t.ds.Tables[1].RemoveAt(n),t.ds.Tables[2].RemoveAt(n),t.ds.Tables[3].RemoveAt(n)))}},P=0;P<this.GridData.length;P++)T(P);if(0==g)return void(this.DisplayMessage="Please select products");for(var O=0,B=0;B<this.Parent.ScreenObject.GridData.length;B++)if(i.e.IsEmpty(this.Parent.ScreenObject.GridData[B].ProductID_Key)&&i.e.IsEmpty(this.Parent.ScreenObject.GridData[B].LinkedInvDocDetailsID)){O=B;break}this.Parent.LoadLinkData(this.ds,[],O,[],null,this.Scannedpacks)}"OK"==e.toString()&&n.a.page.HideDialog()}else if("Cancel"==e.toString()){var G;if(0==this.JobNodeID)!function(){t.Parent.IsSelectAll=!0;for(var e="",a=0;a<t.ds.Tables[0].length;a++)e!=t.ds.Tables[0][a].VoucherNO.toString()&&(e=t.ds.Tables[0][a].VoucherNO.toString(),null!=(G=t.Parent.ScreenObject.Link.DocumentList.Items.find((function(t){return t.Name.toLowerCase()==e.toLowerCase()})))&&(G.IsChecked=!1));t.Parent.IsSelectAll=!1}();this.Parent.DialogResult=!1,n.a.page.HideDialog(),this.Parent.IsFirstCallSelective&&(n.a.page.removeActiveTab(),this.Parent.IsFirstCallSelective=!1)}}},{key:"chngeRowPOstion",value:function(e){var t=this,a=0,n=!1;e.Columns[0].Contains("DocumentType")&&e.Tables[0].length>0&&"5"==e.Tables[0][0].DocumentType.toString()&&(n=!0);for(var i=function(i){var s=e.Tables[0].filter((function(e){return e.DocDetailsID==t.GridData[i].DocDetailsID.toString()}));s.length>0&&(s[0].sno=a++,n&&((s=e.Tables[0].filter((function(e){return e.DocSeqNo==s[0].DocSeqNo.toString()}))).length>0&&(s[0].sno=a)))},s=0;s<this.GridData.length;s++)i(s)}},{key:"GetBatchNo",value:function(e,t){var a=this,n="",s=0,r=new i.f;r.LoadXml(e);for(var o=r.SelectNodes("XML/Row"),l=function(e){var r=o[e];if(null!=r.attributes.CCCID&&!i.e.IsEmpty(r.attributes.CCCID.value)&&"53730"==r.attributes.CCCID.value&&t.Table.Columns.Contains("ProductName"))s=i.e.Int(r.attributes.Length.value),null!=r.attributes.Length&&!i.e.IsEmpty(r.attributes.Length.value)&&i.e.IsNum(r.attributes.Length.value)&&-1!=s&&i.e.String(t.ProductName).length>s?n+=t.ProductName.toString().substr(0,s):n+=i.e.String(t.ProductName);else if(null!=r.attributes.CCCID&&!i.e.IsEmpty(r.attributes.CCCID.value)&&"53731"==r.attributes.CCCID.value&&t.Table.Columns.Contains("ProductCode"))s=i.e.Int(r.attributes.Length.value),null!=r.attributes.Length&&!i.e.IsEmpty(r.attributes.Length.value)&&i.e.IsNum(r.attributes.Length.value)&&-1!=s&&t.ProductCode.toString().length>s?n+=t.ProductCode.toString().substr(0,s):n+=t.ProductCode.toString();else if(null!=r.attributes.Name&&!i.e.IsEmpty(r.attributes.Name.value)&&r.attributes.Name.value.toLowerCase().Contains("ccnid"))t.Table.Columns.Contains("dc"+r.attributes.Name.value)&&""!=t["dc"+r.attributes.Name.value].toString()?(s=i.e.Int(r.attributes.Length.value),null!=r.attributes.Length&&!i.e.IsEmpty(r.attributes.Length.value)&&i.e.IsNum(r.attributes.Length.value)&&-1!=s&&t["dc"+r.attributes.Name.value].toString().length>s?n+=t["dc"+r.attributes.Name.value].toString().substr(0,s):n+=t["dc"+r.attributes.Name.value].toString()):(d=a.Parent.ScreenObject._CCFields.find((function(e){return e.DBColumnName.toLowerCase()=="dc"+r.attributes.Name.value.toLowerCase()})))&&d.SelectedValue>0&&!i.e.IsEmpty(d.Text)&&(s=i.e.Int(r.attributes.Length.value),null==r.attributes.CCCID||i.e.IsEmpty(r.attributes.CCCID.value)?null!=r.attributes.Length&&!i.e.IsEmpty(r.attributes.Length.value)&&i.e.IsNum(r.attributes.Length.value)&&-1!=s&&d.Text.length>s?n+=d.Text.substr(0,s):n+=d.Text:null!=r.attributes.Length&&!i.e.IsEmpty(r.attributes.Length.value)&&i.e.IsNum(r.attributes.Length.value)&&-1!=s&&d.Text.length>s?n+=a.Parent.ScreenObject.GetCodeNameString(d.CCID,d.SelectedValue,r.attributes.CCCID.value).substr(0,s):n+=a.Parent.ScreenObject.GetCodeNameString(d.CCID,d.SelectedValue,r.attributes.CCCID.value));else if(null!=r.attributes.Name&&!i.e.IsEmpty(r.attributes.Name.value)&&"SEQUENCE_NO"==r.attributes.Name.value){var l=0,c=a.Parent.ScreenObject.getBatchSeq(n);n+="#SEQ#",c++,null==r.attributes.Length||i.e.IsEmpty(r.attributes.Length.value)||(l=i.e.Int(r.attributes.Length.value));for(var u=c.toString();u.length<l;)u="0"+u;n=n.Replace("#SEQ#",u)}null==r.attributes.Delimiter||i.e.IsEmpty(r.attributes.Delimiter.value)||(n+=r.attributes.Delimiter.value)},c=0;c<o.length;c++){var d;l(c)}return n}},{key:"CallReference_3",value:function(e,t,a){var n=e.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember.toLowerCase()=="dcccnid"+(t-5e4)}));n&&e.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&e.LocalReference==n.ID})).length>0&&e.ScreenObject.GetLinkReferenceData(parseInt(n.ID),e.DocumentID,parseInt(a[n.ValueMember]),Date.Today(),"",n.CostCenterID,a)}},{key:"CallReference_2",value:function(e,t){e.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&e.LocalReference==t.DBColumnID})).length>0&&e.ScreenObject.GetLinkReferenceData(t.DBColumnID,e.DocumentID,t.SelectedValue,Date.Today(),"",t.CCID,null)}},{key:"AutoProduce",value:function(e,t,a,s,r,o,l,c){var d,u,D=this,m=i.e.NewGuid(),b="",S=this.ds.Tables[3].filter((function(e){return e.BOMID==t.BomID&&e.StageNodeID==t.AutoStage}));if(S.length>0&&(b=i.e.String(S[0].StageID)),d=i.e.IsEmpty(t.ProductID_Key)?i.e.String(t.ProductID):t.ProductID_Key.toString(),(u=this.ds.Tables[1].filter(o>0?function(e){return 2==e.ProductUse&&e.BOMID==t.BomID&&e.StageID==b&&e.ProductID==d&&e.DimID==l}:function(e){return 2==e.ProductUse&&e.BOMID==t.BomID&&e.StageID==b&&e.ProductID==d})).length>0&&!i.e.IsEmpty(u[0].Quantity)){var C=parseFloat(u[0].Quantity);if((u=this.ds.Tables[1].filter(o>0?function(e){return 1==e.ProductUse&&e.BOMID==u[0].BomID&&e.StageID==u[0].StageID&&e.ProductID==d&&e.DimID==l}:function(e){return 1==e.ProductUse&&e.BOMID==u[0].BomID&&e.StageID==u[0].StageID&&e.ProductID==d})).length>0){e.ScreenObject._CCFields.forEach((function(e){var t=D.Parent.ScreenObject._CCFields.find((function(t){return t.DBColumnName==e.DBColumnName}));t&&e instanceof h.b&&t instanceof h.b&&(e.SelectedValue=t.SelectedValue,e.SelectedValueText=t.Text)})),e.ScreenObject.Preferences.ContainsKey("jobCCID")?e.ScreenObject.Preferences.jobCCID=a.toString():e.ScreenObject.Preferences.push("jobCCID",a.toString()),i.e.IsEmpty(this.ds.Tables[2][0].StageCCID)||(e.ScreenObject.Preferences.ContainsKey("StageCCID")?e.ScreenObject.Preferences.StageCCID=r.toString():e.ScreenObject.Preferences.push("StageCCID",r.toString()));for(var y=0,p=0;p<e.ScreenObject.GridData.length;p++)if(i.e.IsEmpty(e.ScreenObject.GridData[p].ProductID_Key)){y=p;break}if(!e.ScreenObject.GridDataObj.TableColumns.Contains("dcccnid"+(r-5e4)+"_Key")){var g=e.ScreenObject._CCFields.find((function(e){return e instanceof h.b&&e.CCID==r}));g instanceof h.b&&(g.SelectedValue=parseInt(t.AutoStage))}e.ScreenObject.GridDataObj.TableColumns.Contains("dcccnid"+(a-5e4)+"_Key")||(O=e.ScreenObject._CCFields.find((function(e){return e instanceof h.b&&e.CCID==a})))instanceof h.b&&(O.SelectedValue=this.JobNodeID,n.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==n.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(O.SelectedValueText=this.VoucherNo));for(var f=function(d){if(!i.e.IsEmpty(u[d].Quantity)){var b=e.ScreenObject.GridDataObj.NewRow();if(e.ScreenObject.GridData.InsertAt(b,y),!i.e.IsEmpty(l)&&o>0)if(e.ScreenObject.GridDataObj.TableColumns.Contains("JobUnqID")||e.ScreenObject.GridDataObj.TableColumns.push("JobUnqID"),b.JobUnqID=l,e.ScreenObject.GridDataObj.TableColumns.Contains("dcccnid"+(o-5e4)+"_Key")){if(b["dcccnid"+(o-5e4)+"_Key"]=l,D.ds.Columns[0].Contains("DimName")){var S=D.ds.Tables[0].filter((function(e){return e.DimID==l}));S.length>0&&(b["dcccnid"+(o-5e4)]=S[0].DimName)}D.CallReference_3(e,o,b)}else if(0==d&&(O=e.ScreenObject._CCFields.find((function(e){return e instanceof h.b&&e.CCID==o})))instanceof h.b&&(O.SelectedValue=parseInt(l),n.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==n.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&D.ds.Columns[0].Contains("DimName"))){var p=D.ds.Tables[0].filter((function(e){return e.DimID==l}));p.length>0&&(O.SelectedValueText=p[0].DimName.toString())}if(D.ds.Columns[1].Contains("CCNodeID")&&!i.e.IsEmpty(u[d].CCNodeID)&&s>0)if(e.ScreenObject.GridDataObj.TableColumns.Contains("BOMID")||e.ScreenObject.GridDataObj.TableColumns.push("BOMID"),b.BOMID=u[d].CCNodeID.toString(),e.ScreenObject.GridDataObj.TableColumns.Contains("dcccnid"+(s-5e4)+"_Key")){if(b["dcccnid"+(s-5e4)+"_Key"]=u[d].CCNodeID.toString(),D.ds.Columns[0].Contains("BomName")){var g=D.ds.Tables[0].filter((function(e){return e.CCNodeID==u[d].CCNodeID}));g.length>0&&(b["dcccnid"+(s-5e4)]=g[0].BomName)}D.CallReference_3(e,s,b)}else if(0==d&&(O=e.ScreenObject._CCFields.find((function(e){return e instanceof h.b&&e.CCID==s})))instanceof h.b&&(O.SelectedValue=parseInt(u[d].CCNodeID),D.CallReference_2(e,O),n.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==n.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&D.ds.Columns[0].Contains("BomName"))){var f=D.ds.Tables[0].filter((function(e){return e.CCNodeID==u[d].CCNodeID}));f.length>0&&(O.SelectedValueText=f[0].BomName.toString())}e.ScreenObject.GridDataObj.TableColumns.Contains("VoucherType")&&(b.VoucherType="-1"),b.ProductID_Key=u[d].ProductID,e.ScreenObject.GridDataObj.TableColumns.Contains("ProductName")&&(b.ProductName=u[d].ProductName.toString()),e.ScreenObject.GridDataObj.TableColumns.Contains("ProductCode")&&(b.ProductCode=u[d].ProductCode.toString()),e.ScreenObject.GridDataObj.TableColumns.Contains("Unit")&&(b.Unit=u[d].UnitName.toString()),e.ScreenObject.GridDataObj.TableColumns.Contains("Unit_Key")&&(b.Unit_Key=u[d].UOMID),b.defaultQuantity=parseFloat(u[d].Quantity)/C,b.Quantity=parseFloat(b.defaultQuantity)*c,i.e.IsEmpty(b.Quantity)||(B=e.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&55259==e.LinkData}))).length>0&&e.ScreenObject.GridDataObj.TableColumns.Contains(B[0].SysColumnName.toString())&&(b[B[0].SysColumnName]=b.Quantity),b.Type=u[d].ProductTypeID,e.AddProductData(b,!1,!0),e.ScreenObject.GridDataObj.TableColumns.Contains("RefNo")&&(b.RefNo=D.VoucherNo),e.ScreenObject.GridDataObj.TableColumns.Contains("dcccnid"+(a-5e4)+"_Key")&&(b["dcccnid"+(a-5e4)+"_Key"]=D.JobNodeID,b["dcccnid"+(a-5e4)]=D.VoucherNo),e.ScreenObject.GridDataObj.TableColumns.Contains("jobID")||e.ScreenObject.GridDataObj.TableColumns.push("jobID"),b.jobID=D.JobNodeID,r>0&&!i.e.IsEmpty(t.AutoStage)&&(e.ScreenObject.GridDataObj.TableColumns.Contains("dcccnid"+(r-5e4)+"_Key")&&(b["dcccnid"+(r-5e4)+"_Key"]=t.AutoStage),e.ScreenObject.GridDataObj.TableColumns.Contains("StageID")||e.ScreenObject.GridDataObj.TableColumns.push("StageID"),b.StageID=t.AutoStage),i.e.IsNum(b.UOMConversion)&&(b.UOMConvertedQty=parseFloat(b.UOMConversion)*parseFloat(b.Quantity)),e.CalculateTotals(b,!1),b.LinkedFieldName=D.IsBom?"BOM":"JOB",i.e.IsEmpty(b.Gross)||parseFloat(b.Gross),b.AutoRefSeqNo=m}},I=0;I<u.length;I++,y++)f(I);if(e.ScreenObject.GridDataObj.TableColumns.Contains("VoucherType")){u=this.ds.Tables[1].filter(o>0?function(e){return e.ProductUse=e.BOMID==u[0].BOMID&&e.StageID==u[0].StageID&&e.DimID==l}:function(e){return e.ProductUse=e.BOMID==u[0].BOMID&&e.StageID==u[0].StageID});for(var T=function(b){var S=e.ScreenObject.GridDataObj.NewRow();if(e.ScreenObject.GridData.InsertAt(S,y),!i.e.IsEmpty(l)&&o>0)if(e.ScreenObject.GridDataObj.TableColumns.Contains("JobUnqID")||e.ScreenObject.GridDataObj.TableColumns.push("JobUnqID"),S.JobUnqID=l,e.ScreenObject.GridDataObj.TableColumns.Contains("dcccnid"+(o-5e4)+"_Key")){if(S["dcccnid"+(o-5e4)+"_Key"]=l,D.ds.Columns[0].Contains("DimName")){var p=D.ds.Tables[0].filter((function(e){return e.DimID==l}));p.length>0&&(S["dcccnid"+(o-5e4)]=p[0].DimName)}}else if(0==b&&(O=e.ScreenObject._CCFields.find((function(e){return e instanceof h.b&&e.CCID==o})))instanceof h.b&&(O.SelectedValue=parseInt(l),n.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==n.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&D.ds.Columns[0].Contains("DimName"))){var g=D.ds.Tables[0].filter((function(e){return e.DimID==l}));g.length>0&&(O.SelectedValueText=g[0].DimName.toString())}if(D.ds.Columns[1].Contains("CCNodeID")&&!i.e.IsEmpty(u[b].CCNodeID)&&s>0)if(e.ScreenObject.GridDataObj.TableColumns.Contains("BOMID")||e.ScreenObject.GridDataObj.TableColumns.push("BOMID"),S.BOMID=u[b].CCNodeID,e.ScreenObject.GridDataObj.TableColumns.Contains("dcccnid"+(s-5e4)+"_Key")){if(S["dcccnid"+(s-5e4)+"_Key"]=u[b].CCNodeID,D.ds.Columns[0].Contains("BomName")){var f=D.ds.Tables[0].filter((function(e){return e.CCNodeID==u[b].CCNodeID}));f.length>0&&(S["dcccnid"+(s-5e4)]=f[0].BomName)}D.CallReference_3(e,s,S)}else if(0==b&&(O=e.ScreenObject._CCFields.find((function(e){return e instanceof h.b&&e.CCID==s})))instanceof h.b&&(O.SelectedValue=parseInt(u[b].CCNodeID),D.CallReference_2(e,O),n.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==n.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&D.ds.Columns[0].Contains("BomName"))){var I=D.ds.Tables[0].filter((function(e){return e.CCNodeID==u[b].CCNodeID}));I.length>0&&(O.SelectedValueText=I[0].BomName.toString())}S.VoucherType="1",S.ProductID_Key=u[b].ProductID,e.ScreenObject.GridDataObj.TableColumns.Contains("ProductName")&&(S.ProductName=u[b].ProductName.toString()),e.ScreenObject.GridDataObj.TableColumns.Contains("ProductCode")&&(S.ProductCode=u[b].ProductCode.toString()),e.ScreenObject.GridDataObj.TableColumns.Contains("Unit")&&(S.Unit=u[b].UnitName.toString()),e.ScreenObject.GridDataObj.TableColumns.Contains("Unit_Key")&&(S.Unit_Key=u[b].UOMID),d==u[b].ProductID?(S.defaultQuantity=c,S.Quantity=c):(S.defaultQuantity=c/C,S.Quantity=parseFloat(S.defaultQuantity)*parseFloat(u[b].Quantity)),i.e.IsEmpty(S.Quantity)||(B=e.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&55259==e.LinkData}))).length>0&&e.ScreenObject.GridDataObj.TableColumns.Contains(B[0].SysColumnName)&&(S[B[0].SysColumnName]=S.Quantity),S.Type=u[b].ProductTypeID,e.AddProductData(S,!1,!0),e.ScreenObject.GridDataObj.TableColumns.Contains("RefNo")&&(S.RefNo=D.VoucherNo),e.ScreenObject.GridDataObj.TableColumns.Contains("dcccnid"+(a-5e4)+"_Key")&&(S["dcccnid"+(a-5e4)+"_Key"]=D.JobNodeID,S["dcccnid"+(a-5e4)]=D.VoucherNo),e.ScreenObject.GridDataObj.TableColumns.Contains("jobID")||e.ScreenObject.GridDataObj.TableColumns.push("jobID"),S.jobID=D.JobNodeID,r>0&&!i.e.IsEmpty(t.AutoStage)&&(e.ScreenObject.GridDataObj.TableColumns.Contains("dcccnid"+(r-5e4)+"_Key")&&(S["dcccnid"+(r-5e4)+"_Key"]=t.AutoStage.toString()),e.ScreenObject.GridDataObj.TableColumns.Contains("StageID")||e.ScreenObject.GridDataObj.TableColumns.push("StageID"),S.StageID=t.AutoStage),i.e.IsNum(S.UOMConversion)&&(S.UOMConvertedQty=parseFloat(S.UOMConversion)*parseFloat(S.Quantity)),e.CalculateTotals(S,!1),S.LinkedFieldName=D.IsBom?"BOM":"JOB",S.AutoRefSeqNo=m},P=0;P<u.length;P++,y++){var O,B;T(P)}}}}return m}},{key:"RefreshGrid",set:function(e){}},{key:"ColumnSource",get:function(){return this.GridObj.Columns},set:function(e){this.GridObj.Columns=e}},{key:"GridData",get:function(){return this.GridObj.Table},set:function(e){this.GridObj.Table=e}},{key:"SelectedRow",get:function(){return this.GridObj.SelectedItem},set:function(e){this.GridObj.SelectedItem=e}},{key:"AddedColumnSource",get:function(){return this.AddedGridObj.Columns},set:function(e){this.AddedGridObj.Columns=e}},{key:"AddGridData",get:function(){return this.AddedGridObj.Table},set:function(e){this.AddedGridObj.Table=e}}]),a}(r.b)}}]);
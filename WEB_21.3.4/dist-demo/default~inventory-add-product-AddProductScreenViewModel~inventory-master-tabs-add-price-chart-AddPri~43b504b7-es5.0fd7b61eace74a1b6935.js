function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,s){return t&&_defineProperties(e.prototype,t),s&&_defineProperties(e,s),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var s,i=_getPrototypeOf(e);if(t){var a=_getPrototypeOf(this).constructor;s=Reflect.construct(i,arguments,a)}else s=i.apply(this,arguments);return _possibleConstructorReturn(this,s)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{J5xz:function(e,t,s){"use strict";s.r(t),s.d(t,"AddTaxChartNewViewModel",(function(){return T}));var i=s("8B8H"),a=s("ockk"),n=s("0/4Q"),r=s("Do2H"),o=s("Lp6j"),l=s("eQJW"),u=s("EQd/"),h=s("JIg3"),c=s("ZDA+"),d=s("8iaB"),C=s("7JXL"),D=s("XFVb"),m=s("6z9j"),g=s("/G+I"),f=s("4HhE"),T=function(e){_inherits(s,e);var t=_createSuper(s);function s(){var e;return _classCallCheck(this,s),(e=t.call(this)).Module="INV",e.ClassName="AddTaxChartNewViewModel",e.Visible=!0,e.contextVisible=!0,e.ProfileID=0,e.SelectedNodeID=0,e.Mode="",e.DeletedIDs=new Array,e.oChart=new D.a,e.DisplayName="",e.FilterVisibility=!1,e.IsEdit=!1,e._IsEditFilter=!1,e._GenerateVisibility=!0,e.ColumnSpan="",e.TreeViewModel=null,e.PriceChartAtProduct=!1,e.RightPanelVisibility=!0,e.MessageVisibility=!1,e.Title="",e.DisplayMessage="",e.CopyVisible=!1,e.Name=new u.d(0),e.Documents=new n.e(0),e.Columns=new n.e(0),e.Price=new u.d(0),e.WEF=new h.a(0),e.TillDate=new h.c(0),e.MultipleDocs=!1,e.StatusID=1,e.CreatedBy=0,e.HasAccess=!1,e.dtDocFields=[],e.dblPrice=0,e.stkValue="",e.stkCC=null,e.stkID=null,e.stkName=null,e.dbQuery="",e.sbQuery="",e.CCUpdate="",e.lstTemp=new Array,e.lstTempCC=new Array,e.SelectedDocument="",e.SelectedColumn="",e.SelectedColumnName="",e}return _createClass(s,[{key:"AddTaxChartNewViewModel",value:function(e,t){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.ProfileID=t,this.Mode=e,this.SelectedNodeID=s,this.TillDate.Date=null,this.SetTitle(),this.MessageVisibility=!1,this.DisplayMessage="",this.Documents.SelectionChangedCommand.Subscribe(this,"OnDocumentChange"),this.tree=[],this.CostCenters=new n.e(0),this.CostCenterFilters=[],this.CostCenters.SelectionChangedCommand.Subscribe(this,"OnCostCenterChange"),this.InitControls(),this.Clear(),this.FilterVisibility=!0}},{key:"InitControls",value:function(){var e=this;this.Name.Label=r.a.GetResource("Com_Contacts_Name"),this.WEF.Label=r.a.GetResource("Service_WEF"),this.TillDate.Label=r.a.GetResource("TillDate"),this.Price.Label=r.a.GetResource("Value"),this.Documents.Label=r.a.GetResource("Doc_LinkDocument"),this.Columns.Label=r.a.GetResource("Import_Column"),this.CostCenters.Label=r.a.GetResource("CostCenter_CostCenterslist"),this.MultipleDocuments=new n.b,this.MultipleDocuments.Label="Documents";var t=r.a.inventory.GetTaxChart(0,this.ProfileID,"");if("EDIT"==this.Mode){this.Name.Text=t.Tables[2][0].ProfileName.toString(),this.StatusID=parseInt(t.Tables[2][0].StatusID),t.Tables.length>4&&t.Tables[4].length>0&&(this.CreatedBy=parseInt(t.Tables[4][0].UserID),this.HasAccess=Object(l.j)(t.Tables[4][0].HasAccess));for(var s=function(s){var i=n.d.ComboBoxItems_2(t.Tables[0][s].NAME.toString(),t.Tables[0][s].ID.toString());if(e.CostCenters.Items.push(n.d.ComboBoxItems_2(t.Tables[0][s].NAME.toString(),t.Tables[0][s].ID.toString())),t.Tables[3].filter((function(e){return e.CostCenterID==i.Value})).length>0){i.Aliasname="BOLD";var a=new C.a(parseInt(i.Value),"",i.Name,e);a.SelectedNodes=[],e.CostCenterFilters.push(a)}},o=0;o<t.Tables[0].length;o++)s(o)}else if("SEARCH"==this.Mode)for(var u=function(s){e.CostCenters.Items.push(n.d.ComboBoxItems_2(t.Tables[0][s].NAME.toString(),t.Tables[0][s].ID.toString())),t.Tables[3].filter((function(e){return e.CostCenterID==t.Tables[0][s].ID.toString()})).length>0&&(e.CostCenters.Items[e.CostCenters.Items.length-1].Aliasname="BOLD")},h=0;h<t.Tables[0].length;h++)u(h);else for(var c=0;c<t.Tables[0].length;c++)this.CostCenters.Items.push(n.d.ComboBoxItems_2(t.Tables[0][c].NAME.toString(),t.Tables[0][c].ID.toString()));this.CostCenters.SelectedValue="2",this.OnCostCenterChange(null);for(var d=0;d<t.Tables[1].length;d++)this.Documents.Items.push(n.d.ComboBoxItems_2(t.Tables[1][d].NAME.toString(),t.Tables[1][d].ID.toString())),this.MultipleDocuments.Items.push(n.c.CheckedListBoxItem_3(t.Tables[1][d].NAME.toString(),t.Tables[1][d].ID.toString()));this.Documents.Items.length>0&&(this.Documents.SelectedValue="40011",this.OnDocumentChange("")),this.TaxGrid=new i.a,this.TaxGrid.OnLinkClick.Subscribe(this,"OnGridLinkClick"),this.TaxGrid.OnPreviewKeyDown.Subscribe(this,"OnPreviewKeyDown"),this.TaxGrid.TableColumns.push("sno"),this.TaxGrid.TableColumns.push("select"),this.TaxGrid.TableColumns.push("Document_Key"),this.TaxGrid.TableColumns.push("Column"),this.TaxGrid.TableColumns.push("Column_Key"),this.TaxGrid.TableColumns.push("Combination"),this.TaxGrid.TableColumns.push("Price"),this.TaxGrid.TableColumns.push("wef"),this.TaxGrid.TableColumns.push("wef_Key"),this.TaxGrid.TableColumns.push("tillDate"),this.TaxGrid.TableColumns.push("tillDate_Key"),this.TaxGrid.TableColumns.push("CC"),this.TaxGrid.TableColumns.push("CCID"),this.TaxGrid.TableColumns.push("Query"),this.TaxGrid.TableColumns.push("Action"),this.TaxGrid.TableColumns.push("CCTaxID"),this.TaxGrid.TableColumns.push("ProfileName"),this.TaxGrid.TableColumns.push("Message"),this.TaxGrid.Table=[];var D=[],m=new a.a;m.Header=r.a.GetResource("Service_Sno"),m.DisplayMember="sno",m.ReadOnly=!0,m.IsFrozen=!0,m.Width=45,D.push(m),this.CopyVisible&&((m=new a.a).Header="",m.DisplayMember="select",m.DataType="CheckBox",m.IsFrozen=!0,m.Width=30,D.push(m)),this.PriceChartAtProduct||((m=new a.a).Header=r.a.GetResource("Service_Action"),m.DisplayMember="Action",m.DataType="LINK",m.ReadOnly=!0,m.IsFrozen=!0,m.Width=60,D.push(m)),"SEARCH"==this.Mode&&((m=new a.a).Header="ProfileName",m.DisplayMember="ProfileName",m.ReadOnly=!0,m.Width=120,m.IsFrozen=!0,D.push(m));var g=[];t.Tables[1].forEach((function(e){var t={};t.CostCenter=e.NAME.toString(),t.CostCenterID=e.ID.toString(),g.push(t)})),(m=new a.a).Header="Document",m.DataType="ComboBox",m.DisplayMember="CostCenter",m.ValueMember="CostCenterID",m.ValueBinding="Document_Key",m.Width=180,m.IsFrozen=!0,m.ComboData=g,D.push(m),(m=new a.a).Header="Column",m.DataType="PactComboBox",m.DisplayMember="Column",m.ValueMember="ColumnID",m.ValueBinding="Column",m.FilterCondition="Document_Key={0}",m.FilterColumn="Document_Key",m.Width=90,m.IsFrozen=!0,m.ComboData=this.dtDocFields,D.push(m),(m=new a.a).Header=r.a.GetResource("Price"),m.DisplayMember="Price",m.DataType="FLOAT",m.DecimalPoints=r.a.SessionManager.Preferences.DecimalsinAmount,m.Width=100,D.push(m),(m=new a.a).Header=r.a.GetResource("Service_WEF"),m.DisplayMember="wef",m.DataType="DATE",m.Width=115,D.push(m),(m=new a.a).Header=r.a.GetResource("TillDate"),m.DisplayMember="tillDate",m.DataType="DATE",m.Width=115,D.push(m),(m=new a.a).Header=r.a.GetResource("Service_Combination"),m.DisplayMember="Combination",m.ReadOnly=!0,m.DefaultValue="Select",m.Width=260,D.push(m),(m=new a.a).Header=r.a.GetResource("DocumentDesigner_Message"),m.DisplayMember="Message",m.Width=150,D.push(m),this.TaxGrid.SelectAll.Visible=!0,this.TaxGrid.SearchVisible=!0,this.TaxGrid.SortVisible=!0,this.TaxGrid.SearchColStartIndex="SEARCH"==this.Mode?2:3,this.TaxGrid.Columns=D,this.TaxGrid.CellEditEnding.Subscribe(this,"OnGridCellEditEnding")}},{key:"OnPreviewKeyDown",value:function(e,t){var s="";if(e.grid.getCellEditor()&&e.grid.getCellEditor().args.column.name&&(s=e.grid.getCellEditor().args.column.name),"F6"==t.Key){if(!confirm(" Do you want to override all.? "))return!0;for(var i=this.TaxGrid.Table,a=0;a<i.length;a++)i[a][s]=e[s].toString(),this.TaxGrid.TableColumns.Contains(s+"_Key")&&(i[a][s+"_Key"]=e[s+"_Key"].toString()),this.TaxGrid.updateRow(i[a]);return!0}return!1}},{key:"SetTitle",value:function(){var e="";"ADD"==this.Mode?e="Add Tax Chart":"EDIT"==this.Mode?(e="Edit Tax Chart",this.IsEdit=!0,this.IsEditFilter=!0,this.CopyVisible=!0):"SEARCH"==this.Mode?(e="Search Tax Chart",this.GenerateVisibility=!1,this.CopyVisible=!1):"PRODUCT_SEARCH"==this.Mode&&(this.GenerateVisibility=!1,this.CopyVisible=!1,this.Mode="SEARCH",this.Title="",this.PriceChartAtProduct=!0,this.Name.Visible=!1),this.Title=e,this.DisplayName=e}},{key:"OnButtonClick",value:function(e){var t=this;if("FilterCancel"==e)this.FilterVisibility=!1;else if("ShowFilter"==e)this.FilterVisibility=!0;else if("Generate"==e)"EDIT"==this.Mode?this.IsEditFilter?this.LoadEditData():this.GenerateClick():"SEARCH"==this.Mode?this.LoadEditData():this.GenerateClick();else if("Load"==e)s.LoadDimensionNodes(this,this.ProfileID);else if("Save"==e)this.SaveClick();else if("CLEAR"==e)this.Clear();else if("Copy"==e){var i=this.TaxGrid.Table.filter((function(e){return 1==e.select})),a=this.TaxGrid.Table.length,n=null;i.forEach((function(e){e.select=!1;for(var s=t.TaxGrid.NewRow(),i=0;i<t.TaxGrid.TableColumns.length;i++)s[t.TaxGrid.TableColumns[i]]=e[t.TaxGrid.TableColumns[i]];s.wef=(new Date).Date().ToString(r.a.SessionManager.Preferences["Date Format"]),s.wef_key=(new Date).Date(),s.select=!1,s.CCTaxID=null,s.sno=t.TaxGrid.Table.length+1,null==n&&(n=s),t.TaxGrid.addRow(s)})),i.length>0?(this.DisplayMessage="Duplicate rows added at end",this.TaxGrid.SelectedItem=this.TaxGrid.Table[a]):this.DisplayMessage="Please select row to copy"}}},{key:"LoadEditData",value:function(){var e=1,t="",s="",i="";this.CostCenterFilters.forEach((function(a){if(2==a.CostCenterID?(t="AccountID",s="T.AccountID"):3==a.CostCenterID?(t="ProductID",s="T.ProductID"):a.CostCenterID>5e4&&(e=2,t="NodeID",s="T.CCNID"+(a.CostCenterID-5e4)),a.SelectedNodes.length>0){if(1==a.SelectedNodes.length)i+=" AND ",i+=s+"="+a.SelectedNodes[0].Id;else if(null==a.SelectedNodes.find((function(t){return t.Id==e&&t.IsGroup})))if(i+=" AND ",g.IPrefetchFilter.IsGroupTree(a)){for(var n="",r=0;r<a.SelectedNodes.length;r++)null!=a.SelectedNodes[r].Parent&&a.SelectedNodes[r].Parent.IsSelected||(n.length>0&&(n+=","),n+=a.SelectedNodes[r].Id);0==n.length&&(n+=-12912),i+=s+" IN ",i+=" (select T."+t+" GTID from "+o.e.GetTagTableName(a.CostCenterID)+" T with(nolock),"+o.e.GetTagTableName(a.CostCenterID)+" GTP with(nolock) where T.lft BETWEEN GTP.lft AND GTP.rgt AND GTP."+t+" IN ( "+n.toString()+")  group by T."+t+")"}else{i+=s+" IN (";for(var l=0;l<a.SelectedNodes.length;l++)l>0&&(i+=","),i+=a.SelectedNodes[l].Id;i+=")"}}else a.DeleteButtonVisibility||(i+=" AND ",i+=s+"=-12912")})),this.LoadProfileData(-1,0,(new Date).Date(),"",i.toString()),this.FilterVisibility=!1}},{key:"OnGridLinkClick",value:function(e,t,s){"Action"==t&&(null!=e.CCTaxID&&parseInt(e.CCTaxID)>0&&!this.DeletedIDs.Contains(parseInt(e.CCTaxID))&&this.DeletedIDs.push(parseInt(e.CCTaxID)),this.TaxGrid.removeRow(e),this.TaxGrid.RefreshSno())}},{key:"OnGridCellEditEnding",value:function(e,t,s){if("Document_Key"==e.column.field)try{if(e.args.item.Document_Key.toString().length>0&&this.LoadDocumentFields(parseInt(e.args.item.Document_Key)),e.args.item.Column.toString().length>0&&0==this.dtDocFields.filter((function(t){return t.Document_Key==e.args.item.Document_Key.toString()&&t.ColumnID==e.args.item.Column.toString()})).length){var i=this.dtDocFields.filter((function(t){return t.Document_Key==e.args.item.Document_Key.toString()&&t.Column==e.args.item.Column_Key.toString()}));i.length>0?e.args.item.Column=i[0].ColumnID:(e.args.item.Column=null,e.args.item.Column_Key=null),this.TaxGrid.updateRow(e.args.item)}}catch(a){}}},{key:"onCopy",value:function(e){"DataGridPactListBoxColumn"==e.column.className&&e.grid.getEditorLock().commitCurrentEdit();var t;if(e.column.field,"Price"==(t=e.column.field)||"wef"==t||"tillDate"==t||"Message"==t)for(var s=confirm("Do you want to override all?\nNo to copy blank."),i=0;i<this.TaxGrid.Table.length;i++)if("DataGridPactListBoxColumn"==e.column.className&&e.grid.getEditorLock().commitCurrentEdit(),""!=this.TaxGrid.Table[i].Document_Key.toString()){if(0==s&&!o.e.IsEmpty(this.TaxGrid.Table[i][t])&&0==parseFloat(this.TaxGrid.Table[i][t].toString()))continue;if(this.TaxGrid.Table[i][t]=e.item[t].toString(),"DataGridDateTimeColumn"==e.column.className||"DataGridDateColumn"==e.column.className&&this.TaxGrid.TableColumns.Contains(t+"_key"))this.TaxGrid.Table[i][t+"_key"]=e.item[t+"_key"].toString();else if("DataGridPactListBoxColumn"==e.column.className){var a=this.TaxGrid.Columns.find((function(e){return e.DisplayMember==t}));null!=a&&(this.TaxGrid.Table[i][a.ValueMember]=e.item[a.ValueMember].toString())}}}},{key:"ChangeColumns",value:function(){var e=this;this.Columns.Items.Clear(),this.MultipleDocs?(this.LoadDocumentFields(401),this.dtDocFields.filter((function(e){return 401==e.Document_Key})).forEach((function(t){e.Columns.Items.push(n.d.ComboBoxItems_2(t.Column.toString(),t.ColumnID.toString()))}))):(this.LoadDocumentFields(parseInt(this.Documents.SelectedValue)),this.dtDocFields.filter((function(t){return t.Document_Key==e.Documents.SelectedValue})).forEach((function(t){e.Columns.Items.push(n.d.ComboBoxItems_2(t.Column.toString(),t.ColumnID.toString()))}))),this.Columns.Items.length>0&&(this.Columns.SelectedItem=this.Columns.Items[0],this.Columns.SelectedValue=this.Columns.Items[0].Value)}},{key:"LoadDocumentFields",value:function(e){var t=this;if(0==this.dtDocFields.filter((function(t){return t.Document_Key==e})).length){r.a.inventory.GetTaxChart(1,e,"").Tables[0].forEach((function(s){var i={};i.Document_Key=e,i.Column=s.ColumnName,i.ColumnID=parseInt(s.ID),i.Index=parseInt(s.Index),t.dtDocFields.push(i)}));var s={};s.Document_Key=e,s.Column="Message",s.ColumnID=-1,s.Index=-1,this.dtDocFields.push(s)}}},{key:"SaveClick",value:function(){if("SEARCH"!=this.Mode&&o.e.IsEmpty(this.Name.Text))this.DisplayMessage="Select "+this.Name.Label;else if(!(this.ProfileID>0&&1!=this.StatusID)||parseInt(r.a.SessionManager.UserID)==this.CreatedBy&&this.HasAccess){var e=this.TaxGrid.Table.filter((function(e){return null==e.Column||""==e.Column}));if(e.length>0){var t=this.TaxGrid.Table.indexOf(e[0]);return t>=0&&t<this.TaxGrid.Table.length&&(this.TaxGrid.SelectedItem=this.TaxGrid.Table[t]),void(this.DisplayMessage="Please select document field")}for(var s="",i=0;i<this.TaxGrid.Table.length;i++){var a=this.TaxGrid.Table[i];if(s+="<Row ",null!=a.CCTaxID&&(s+=' CCTaxID="'+o.e.String(a.CCTaxID)+'"'),s+=' DocID="'+o.e.String(a.Document_Key)+'"',s+=' ColID="'+o.e.String(a.Column)+'"',s+=o.e.String(a.Query),0==o.e.Double(a.Price)&&"-1"!=o.e.String(a.Column))return void(this.DisplayMessage="Price instanceof Zero at row "+a.sno.toString());if(s+=' Price="'+a.Price+'"',!o.e.IsEmpty(a.wef_key)&&o.e.isValidDate(a.wef_key)?s+=' WEF="'+new Date(a.wef_key).ToString("dd/MMM/yyyy")+'"':s+=' WEF="'+this.WEF.Date.ToString("dd/MMM/yyyy")+'"',!o.e.IsEmpty(a.tillDate_key)&&o.e.isValidDate(a.tillDate_key)&&(s+=' TillDate="'+new Date(a.tillDate_key).ToString("dd/MMM/yyyy")+'"'),"-1"==o.e.String(a.Column)){if(""==o.e.String(a.Message))return void(this.DisplayMessage="Enter Message at row "+a.sno.toString());s+=' Message="'+a.Message+'"'}else s+=' Message=""';s+="/>"}var n="";if(this.DeletedIDs.length>0&&(n+="<XML>",this.DeletedIDs.forEach((function(e){n+='<Row  ID="'+e+'" />'})),n+="</XML>"),s.length>0||n.length>0){s="<XML>"+s+"</XML>";var l,u=this.oChart.SetTaxChartNew(this.ProfileID,this.Name.Text,this.SelectedNodeID,!1,s.toString(),n.toString(),!1);l=u.Message,u.RetValue>0&&("EDIT"==this.Mode||(null!=this.TreeViewModel&&this.TreeViewModel.Refresh(),this.Name.Text=""),this.Clear()),this.DisplayMessage=l}}else this.DisplayMessage="In-Active profiles can not be modified"}},{key:"Clear",value:function(){this.TaxGrid.Clear(),this.DeletedIDs.Clear()}},{key:"OnDocumentChange",value:function(e){this.ChangeColumns()}},{key:"GenerateClick",value:function(){var e=this;if(this.dblPrice=0,this.DisplayMessage="",o.e.IsEmpty(this.Price.Text)){if("-1"!=this.Columns.SelectedValue)return void(this.DisplayMessage="Enter "+this.Price.Label)}else try{if(this.dblPrice=o.e.Double(this.Price.Text),0==this.dblPrice&&"-1"!=this.Columns.SelectedValue)return void(this.DisplayMessage="Invalid "+this.Price.Label)}catch(c){}var t,s=new Array;if(this.MultipleDocs){if(0==this.MultipleDocuments.Items.filter((function(e){return e.IsChecked})).length)return void(this.DisplayMessage="Select Documents");for(var i=function(t){var i=e.MultipleDocuments.Items.filter((function(e){return e.IsChecked}))[t];if(s.push(i.Value),e.LoadDocumentFields(parseInt(i.Value)),0==e.dtDocFields.filter((function(t){return t.Document_Key==i.Value&&t.Index==e.Columns.SelectedValue})).length)return{v:void(e.DisplayMessage=e.Columns.GetselectedItem().Name+" not exists in document - "+i.Name)}},a=0;a<this.MultipleDocuments.Items.filter((function(e){return e.IsChecked})).length;a++){var n=i(a);if("object"==typeof n)return n.v}}else{if(null==this.Documents.SelectedItem)return void(this.DisplayMessage="Select "+this.Documents.Label);if(null==this.Columns.SelectedItem)return void(this.DisplayMessage="Select "+this.Columns.Label)}this.lstTemp.Clear(),this.lstTempCC.Clear();for(var r=this.CostCenterFilters.sort((function(e,t){return e.CostCenterID-t.CostCenterID})),l=0;l<r.length;l++){var u=r[l];if(u.HideFilter.IsChecked){if(0==(t=u.SelectedNodes.filter((function(e){return!e.IsGroup}))).length)return void(this.DisplayMessage="Please Select "+u.CostCenter)}else{t=new Array;for(var h=0;h<u.SelectedNodes.length;h++)null!=u.SelectedNodes[h].Parent&&u.SelectedNodes[h].Parent.IsSelected||t.push(u.SelectedNodes[h]);if(0==t.length)return void(this.DisplayMessage="Please Select "+u.CostCenter)}this.lstTemp.push(t),this.lstTempCC.push(u.CostCenterID)}this.MultipleDocs?s.forEach((function(t){e.SelectedDocument=t;var s=e.dtDocFields.filter((function(s){return s.Document_Key==t&&s.Index==e.Columns.SelectedValue}));s.length>0&&(e.SelectedColumn=s[0].ColumnID.toString(),e.SelectedColumnName=s[0].Column.toString(),e.GenerateForDocument())})):(this.SelectedDocument=this.Documents.SelectedItem.Value,this.SelectedColumn=this.Columns.SelectedItem.Value,this.SelectedColumnName=this.Columns.SelectedItem.Name,this.GenerateForDocument()),this.FilterVisibility=!1}},{key:"GenerateForDocument",value:function(){var e=this.lstTemp.length;if(this.stkCC=new Array(e),this.stkID=new Array(e),this.stkName=new Array(e),this.lstTemp.length>0)this.CallRecursive(0);else{var t=this.TaxGrid.NewRow();t.sno="1",t.Document_Key=this.SelectedDocument,this.LoadDocumentFields(parseInt(t.Document_Key)),t.Column_Key=this.SelectedColumnName,t.Column=this.SelectedColumn,t.Price="-1"==this.SelectedColumn?0:this.dblPrice,t.wef=this.WEF.Date.ToString(r.a.SessionManager.Preferences["Date Format"]),t.wef_key=this.WEF.Date,null!=this.TillDate.Date&&(t.tillDate=this.TillDate.Date.ToString(r.a.SessionManager.Preferences["Date Format"]),t.tillDate_key=this.TillDate.Date),t.Action=r.a.GetResource("Delete"),this.TaxGrid.addRow(t)}}},{key:"CallRecursive",value:function(e){for(var t=this,s=0;s<this.lstTemp[e].length;s++)if(this.stkName[e]=this.lstTemp[e][s].Text.length>1?this.lstTemp[e][s].Text[1]:this.lstTemp[e][s].Text[0],this.stkCC[e]=this.lstTempCC[e],this.stkID[e]=this.lstTemp[e][s].Id,e==this.lstTemp.length-1){var i=this.TaxGrid.NewRow();for(this.sbQuery="",this.dbQuery="",this.CCUpdate="",this.j=0;this.j<this.stkCC.length;this.j++)3==this.stkCC[this.j]?(this.sbQuery+=' ProductID="'+this.stkID[this.j]+'"',this.dbQuery+=" ProductID='"+this.stkID[this.j]+"' and "):2==this.stkCC[this.j]?(this.sbQuery+=' AccountID="'+this.stkID[this.j]+'"',this.dbQuery+=" AccountID='"+this.stkID[this.j]+"' and "):(this.CCUpdate+=",CCNID"+(parseInt(this.stkCC[this.j])-5e4)+"="+this.stkID[this.j],this.dbQuery+=" CCNID"+(parseInt(this.stkCC[this.j])-5e4)+"='"+this.stkID[this.j]+"' AND");if(this.CCUpdate.length>0&&(this.sbQuery+=' CCUpdate="'+this.CCUpdate+'"'),i.Query=this.sbQuery.toString(),this.TaxGrid.Table.filter((function(e){return e.Query==t.sbQuery.toString()&&e.Document_Key==t.Documents.SelectedItem.Value&&e.Column==t.Columns.SelectedItem.Value&&e.wef_Key==t.WEF.Date.ToString("dd/MMM/yyyy")})).length>0)return this.DisplayMessage="Data already exists with same combination on wef date",void(this.MessageVisibility=!0);if(this.dbQuery.length>0){var a=r.a.common.GetDataSet3("PTC004",this.dbQuery,this.Documents.SelectedItem.Value+"~"+this.Columns.SelectedItem.Value,this.WEF.Date.ToString("dd/MMM/yyyy"));if(null!=a&&a.Tables.length>0&&a.Tables[0].length>0)return this.DisplayMessage="Data already exists with same combination on wef date",void(this.MessageVisibility=!0);this.TaxGrid.addRow(i)}else this.TaxGrid.addRow(i);for(i[0]=this.TaxGrid.Table.length,i.Document_Key=this.SelectedDocument,this.LoadDocumentFields(parseInt(i.Document_Key)),i.Column_Key=this.SelectedColumnName,i.Column=this.SelectedColumn,i.Price=this.dblPrice,i.wef=this.WEF.Date.ToString(r.a.SessionManager.Preferences["Date Format"]),i.wef_key=this.WEF.Date,this.TillDate.Date&&(i.tillDate=this.TillDate.Date.ToString(r.a.SessionManager.Preferences["Date Format"]),i.tillDate_key=this.TillDate.Date),i.Action=r.a.GetResource("Delete"),this.stkValue="",this.j=0;this.j<this.stkName.length;this.j++)this.stkValue.length>0&&(this.stkValue+="::"),this.stkValue+=this.stkName[this.j];i.Combination=this.stkValue}else this.CallRecursive(e+1)}},{key:"LoadProfileData",value:function(e,t,s,i,a){var n,o=this,l=r.a.inventory.GetTaxChart(2,this.ProfileID,a),u=this.TaxGrid.Table;this.DeletedIDs.Clear();var h,c,d=1,C=0;l.Tables[0].forEach((function(a){for((n={}).sno=d,n.select=!1,1==d&&(o.Documents.SelectedValue=a.DocID.toString()),n.Document_Key=a.DocID,o.LoadDocumentFields(parseInt(n.Document_Key)),n.Column_Key=a.Col,n.Column=a.ColID,n.Price=a.Value,C=parseFloat(n.Price),1==e?(C+=t,n.Price=C):2==e?(C=parseFloat(n.Price),C+=C*t/100,n.Price=C.ToString(r.a.SessionManager.Preferences.DecimalsinAmount)):3==e?((C-=t)<0&&(C=0),n.Price=C):4==e&&(C=parseFloat(n.Price),(C-=C*t/100)<0&&(C=0),n.Price=C.ToString(r.a.SessionManager.Preferences.DecimalsinAmount)),"SEARCH"==o.Mode&&(n.ProfileName=a.ProfileName.toString()),-1==e?(n.wef=new Date(a.WEF_DATE).ToString(r.a.SessionManager.Preferences["Date Format"]),n.wef_Key=a.WEF_DATE,n.CCTaxID=a.CCTaxID,null!=a.Till_Date&&(n.tillDate=new Date(a.Till_Date).ToString(r.a.SessionManager.Preferences["Date Format"]),n.tillDate_Key=a.Till_Date)):(n.wef=s.ToString(r.a.SessionManager.Preferences["Date Format"]),n.wef_Key=s,""!=i&&(n.tillDate=new Date(i).ToString(r.a.SessionManager.Preferences["Date Format"]),n.tillDate_Key=new Date(i))),n.Message=a.Message,n.Action="Delete",o.sbQuery="",c="",parseInt(a.AccountID)>0&&(o.sbQuery+=' AccountID="'+a.AccountID+'"',c+=a.AccountName.toString()),parseInt(a.ProductID)>0&&(o.sbQuery+=' ProductID="'+a.ProductID+'"',c+=a.ProductName.toString()),h=1;h<=200;h++)Object.keys(a).Contains("CC"+h)&&Object.keys(a).Contains("CCNID"+h)&&parseInt(a["CCNID"+h])>0&&(c.length>0&&(c+="::"),c+=a["CC"+h].toString());n.Query=o.sbQuery.toString(),n.Combination=c,u.push(n),d++})),this.TaxGrid.Table=u}},{key:"OnCostCenterChange",value:function(e){if(!o.e.IsEmpty(this.CostCenters.SelectedValue)&&(0==this.tree.length||this.tree[0].CostCenterID!=parseInt(this.CostCenters.SelectedValue))){var t=0;null==this.CostCenters.SelectedItem||o.e.IsEmpty(this.CostCenters.SelectedItem.Parent)||(t=o.e.Int(this.CostCenters.SelectedItem.Parent)),this.LoadCostCenterTree(parseInt(this.CostCenters.SelectedValue),t,0,null)}}},{key:"LoadCostCenterTree",value:function(e,t,s,i){this.tree.Clear();var a="";50002==e&&"True"==r.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==r.a.SessionManager.Preferences["LW Reports"]&&(a=o.e.IsEmpty(r.a.SessionManager.LocationWhere)?"A.NodeID IN (-1234)":"A.NodeID IN ("+r.a.SessionManager.LocationWhere+")");var n=new m.a;if(null==i)for(var l=0;l<this.CostCenterFilters.length;l++){var u=this.CostCenterFilters[l];if(u.CostCenterID==e&&u.LookupTypeID==t){i=u.SelectedNodes;break}}null==i?n.TreeViewModel_5(e,this,s,a,""):n.TreeViewModel_6(e,this,s,a,i,""),n.LookupTypeID=t,n.HeaderVisiblity=!1,n.OnNodeSelected||(n.OnNodeSelected=new f.b,n.OnNodeSelected.Subscribe(this,"OnNodeSelected")),this.tree.push(n)}},{key:"IsEditFilter",get:function(){return this._IsEditFilter},set:function(e){e!=this._IsEditFilter&&(e&&(this.GenerateVisibility=!1),this._IsEditFilter=e)}},{key:"GenerateVisibility",get:function(){return this._GenerateVisibility},set:function(e){e!=this._GenerateVisibility&&(e&&(this.IsEditFilter=!1),this._GenerateVisibility=e)}}],[{key:"LoadDimensionNodes",value:function(e,t){for(var i=r.a.inventory.GetTaxChart(8,t,e instanceof s?"2":"1"),a=function(t){var s=parseInt(i.Tables[0][t].CostCenterID);null==(o=e.CostCenterFilters.find((function(e){return e.CostCenterID==s})))&&((o=new C.a(s,"",i.Tables[0][t].Name.toString(),e)).SelectedNodes=[],e.CostCenterFilters.push(o)),null==o.SelectedNodes?o.SelectedNodes=[]:o.SelectedNodes.Clear();for(var a="",n=0;n<i.Tables[t+1].length;n++){var r=i.Tables[t+1][n],u=new c.a;if(u.Id=parseInt(r.PK),u.Text.push(r.Name.toString()),u.IsSelected=!0,u.IsGroup=Object(l.j)(r.IsGroup),o.SelectedNodesTag=u.Text[0],o.SelectedNodes.push(u),a.length<146&&(a.length>0&&(a+=", "),(a+=r.Name.toString()).length>140)){a+=" . . .";break}}o.SelectedNodesTag=a,e.tree[0].CostCenterID==o.CostCenterID&&(e.tree[0].RefreshData=!0)},n=0;n<i.Tables[0].length;n++){var o;a(n)}}}]),s}(d.a)},XFVb:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var i=s("Do2H"),a=s("Lp6j"),n=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"GetPriceChart",value:function(e,t,s){try{return i.a.inventory.GetPriceChart(e,t,s)}catch(a){return Logger.ErrorLog("PriceChart:: GetPriceChart"+a.stack),null}}},{key:"GetShcemesScreenDetails",value:function(e,t){try{var s=[];return s.push(e),s.push(t),s.push(i.a.SessionManager.UserID),void s.push(i.a.SessionManager.LanguageID)}catch(a){return Logger.ErrorLog("PriceChart:: GetPriceChartScreenDetails"+a.stack),null}}},{key:"GetProductsUOM",value:function(e){try{var t=[];return t.push(e),t.push(i.a.SessionManager.UserID),t.push(i.a.SessionManager.LanguageID),i.a.inventory.GetProductsUOM(t)}catch(s){return Logger.ErrorLog("PriceChart:: GetProductUOM"+s.stack),null}}},{key:"GetTaxChart",value:function(e,t,s){var a=[];a.push(e),a.push(t),a.push(s),a.push(i.a.SessionManager.UserID),a.push(i.a.SessionManager.LanguageID)}},{key:"SetPriceChartNew",value:function(e,t,s,n,r,o,l,u){var h=0,c=null,d={RetValue:h,Message:""};if(0==e&&i.a.SessionManager.LicenseSettings.ContainsKey("PriceCharts")){var C=i.a.common.GetDataSet("PTC001","");if((h=parseInt(C.Tables[0][0][Object.keys(C.Tables[0][0])[0]]))>a.e.Int(i.a.SessionManager.LicenseSettings.PriceCharts))return h=0,d.Message="Your License Does not Support",d.RetValue=0,d}return(c=[]).push(e),c.push(t),c.push(s),c.push(n),c.push(r),c.push(o),c.push(l),c.push(u),c.push(i.a.SessionManager.CompanyGUID),c.push(i.a.SessionManager.UserName),c.push(i.a.SessionManager.RoleID),c.push(i.a.SessionManager.LanguageID),i.a.inventory.SetPriceChartNew(c)}},{key:"SetTaxChartNew",value:function(e,t,s,n,r,o,l){var u=0,h=null,c={RetValue:u,Message:""};if(0==e&&i.a.SessionManager.LicenseSettings.ContainsKey("TaxCharts")&&((h=[]).push("SELECT ISNULL(COUNT(*),0) FROM COM_CCTaxesDefn WITH(NOLOCK) WHERE IsGroup=0 AND ProfileID>0"),h.push(i.a.SessionManager.UserID),h.push(i.a.SessionManager.LanguageID),u>a.e.Int(i.a.SessionManager.LicenseSettings.TaxCharts)))return u=0,c.Message="Your License Does not Support",c.RetValue=0,c;return(h=[]).push(e),h.push(t),h.push(s),h.push(n),h.push(r),h.push(o),h.push(l),h.push(i.a.SessionManager.CompanyGUID),h.push(i.a.SessionManager.UserName),h.push(i.a.SessionManager.RoleID),h.push(i.a.SessionManager.LanguageID),i.a.inventory.SetTaxChartNew(h)}},{key:"DeletePriceChartNew",value:function(e){var t=[];t.push(5),t.push(e),t.push(""),t.push(i.a.SessionManager.UserID),t.push(i.a.SessionManager.LanguageID)}},{key:"DeleteScheme",value:function(e){try{var t=[];return t.push(5),t.push(e),t.push(i.a.SessionManager.UserID),t.push(i.a.SessionManager.LanguageID),Logger.InfoLog("PriceChart:: Success: DBH.GetShcemesScreenDetails "+(0).toString()),""}catch(s){return Logger.ErrorLog("PriceChart:: DeleteScheme"+s.stack),""}}},{key:"DeleteTaxChartNew",value:function(e){var t=[];t.push(5),t.push(e),t.push(""),t.push(i.a.SessionManager.UserID),t.push(i.a.SessionManager.LanguageID)}},{key:"GetProductLocationNames",value:function(e,t){try{return i.a.inventory.GetProductLocationNames(e,t)}catch(s){return Logger.ErrorLog("PriceChart:: GetProductLocationNames"+s.stack),null}}},{key:"GetTagData",value:function(e){try{return i.a.inventory.GetTagData(e).Tables[0]}catch(t){return Logger.ErrorLog("PriceChart:: GetTagData"+t.stack),null}}},{key:"GetPriceChartLatestData",value:function(e){try{var t=[];return t.push(e),t.push(i.a.SessionManager.UserID),t.push(i.a.SessionManager.LanguageID),i.a.inventory.GetPriceChartLatestData(t)}catch(s){return Logger.ErrorLog("PriceChart:: GetLatestPriceChartData"+s.stack),null}}}]),e}()}}]);
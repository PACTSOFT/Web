(window.webpackJsonp=window.webpackJsonp||[]).push([[168],{qXLx:function(t,e,s){"use strict";s.r(e),s.d(e,"AddEditBatchViewModel",(function(){return y}));var i=s("Do2H"),a=s("Lp6j"),h=s("VxiT"),r=s("NkMH"),o=s("EQd/"),n=s("0/4Q"),l=s("JIg3"),c=s("n56n"),d=s("RJs6"),b=s("OvA8"),S=s("THE7"),u=s("ScVY"),D=s("eQJW");class y extends u.b{constructor(t,e,s){super(),this.ColumnSpan="4",this.CostCenterID=0,this.objBatch=null,this.ScreenObject=new h.a,this.BtnCustomize=new r.a,this.DisplayName="",this.MessageVisibility=!1,this.DisplayMessage="",this.DetailsVisibility=!1,this.ContactVisibility=!1,this.ContactExpanded=!1,this.NoteVisibility=!1,this.AttachmentVisibility=!1,this.ScreenName="",this.BatchNumber=new o.d(1558),this.BatchCode=new o.a(27184),this.Status=new n.e(1552),this.Group=new n.e(1557),this.MfgDateFormat=new o.d(1562),this.MfgDate=new l.c(1563),this.ExpiryDateFormat=new o.d(1564),this.ExpiryDate=new l.c(1565),this.RetestDate=new l.c(53584),this.MRPRate=new o.d(1566),this.MRPCurrID=new c.b(1567),this.MRPExchRT=new o.d(1568),this.RetailRate=new o.d(1569),this.RRCurrID=new c.b(1570),this.RRExchRT=new o.d(1571),this.StockistRate=new o.d(1572),this.SRCurrID=new c.b(1573),this.SRExchRT=new o.d(1574),this.ProductID=new c.b(1575),this.VendorAccountID=new c.b(1581),this.AlertDays=new o.d(1582),this.PreExpiryDays=new o.d(1584),this.parent=0,this.AddressTypes=[],this.SelectedAddressType="",this.Address1="",this.Address2="",this.Address3="",this.City="",this.State="",this.Country="",this.Pin="",this.Phone1="",this.Phone2="",this.Fax="",this.Email1="",this.Email2="",this.PrimaryContact="",this.URL="",this.BatchID=0,this.OnlyMonthYear=!1,Logger.InfoLog("AddEditBatchViewModel::Entering AddEditBatchViewModel With _Name="+t+"ID"+e),this.ScreenName=t,this.Title=this.ScreenName,this.objBatch={},this.objBatch.BatchID=e,this.BatchID=e,this.CostCenterID=16,parent=s,this.ViewContacts=new S.a(this),this.ViewNotes=new d.a(this,i.a.SessionManager,i.a.admin),this.ViewAttachments=new b.ViewAttachmentViewModel(this,i.a.SessionManager,i.a.admin),this.OnLoad(),null!=this.MfgDate&&this.MfgDate.SelectedDateChanged.Subscribe(this,"OnDateChanged"),this.DisplayName=this.ScreenName,this.AutoGenerateCode(),this.ContactVisibility=!1,Logger.InfoLog("AddEditBatchViewModel::Exiting AddEditBatchViewModel")}onTabSelectionChanged(t){null!=this.ScreenObject.CustomTab.SelectedTab&&("Notes"==this.ScreenObject.CustomTab.SelectedTab.Name?(this.AttachmentVisibility=!1,this.ContactVisibility=!1,this.ViewNotes=new d.a(this,i.a.SessionManager,i.a.admin)):"Attachments"==this.ScreenObject.CustomTab.SelectedTab.Name?(this.ViewAttachments.OnShowNewAttachment(null),this.NoteVisibility=!1,this.ContactVisibility=!1):"Contacts"==this.ScreenObject.CustomTab.SelectedTab.Name?(this.NoteVisibility=!1,this.AttachmentVisibility=!1,this.ViewContacts.OnShowNewContact(null)):(this.NoteVisibility=!1,this.AttachmentVisibility=!1,this.ContactVisibility=!1))}OnDateChanged(t){if(this.MfgDate.Date&&null!=this.ProductID&&this.ProductID.SelectedValue>0){let t=this.ScreenObject.GetProductShelfLife(this.ProductID.SelectedValue.toString());null!=this.ExpiryDate&&t>0&&(this.ExpiryDate.Date=this.MfgDate.Date.AddDays(t))}}OnLoad(){this.DisplayName=i.a.GetResource("Loading"),this.ScreenObject.LoadScreen_2(this,16),"INT"!=this.MRPRate.DataType&&"FLOAT"!=this.MRPRate.DataType||(this.MRPRate.Align="Right",this.MRPRate.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinExtraFields.toString()),"INT"!=this.StockistRate.DataType&&"FLOAT"!=this.StockistRate.DataType||(this.StockistRate.Align="Right",this.MRPRate.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinExtraFields.toString()),"INT"!=this.RetailRate.DataType&&"FLOAT"!=this.RetailRate.DataType||(this.RetailRate.Align="Right",this.MRPRate.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinExtraFields.toString()),null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>9&&this.ScreenObject.Data.Columns[9].Contains("IsParentCodeInherited")&&this.ScreenObject.Data.Tables[9].length>0&&this.ScreenObject.InitAutoCode(this.ScreenObject.Data.Tables[9],this.objBatch.IsGroup);let t=this.ScreenObject.Data.Tables[5].filter(t=>"OnlyMonthYear"==t.Name);t.length>0&&(this.OnlyMonthYear=Object(D.j)(t[0].Value)),this.OnlyMonthYear&&(this.RetestDate.CustomFormat=this.MfgDate.CustomFormat=this.ExpiryDate.CustomFormat="MMM/yyyy"),this.ScreenObject.Data.Tables[3].forEach(t=>{this.Status.Items.push(n.d.ComboBoxItems_2(t[Object.keys(t)[1]].toString(),t[Object.keys(t)[0]].toString()))}),this.ScreenObject.Data.Tables[3].length>0&&(this.Status.SelectedValue=this.ScreenObject.Data.Tables[3][0][Object.keys(this.ScreenObject.Data.Tables[3][0])[0]].toString()),this.ScreenObject.Data.Tables[4].forEach(t=>{this.Group.Items.push(n.d.ComboBoxItems_2(t[Object.keys(t)[1]].toString(),t[Object.keys(t)[0]].toString()))}),0!=this.objBatch.BatchID?this.FillControls():(this.objBatch.GUID="",this.Group.SelectedValue=parent.toString()),Logger.InfoLog("AddEditBatchViewModel::Exiting worker_DoWork"),this.AddressTypes=[],this.AddressTypes.push(n.d.ComboBoxItems_2(i.a.GetResource("Address_Permanent"),"1")),this.AddressTypes.push(n.d.ComboBoxItems_2(i.a.GetResource("Address_Temporary"),"2")),this.SelectedAddressType="1",this.AssignRowColumns();for(let e=this.ScreenObject.CustomTab.Pages.length-1;e>=0;e--){let t=this.ScreenObject.CustomTab.Pages[e];switch(t.Name){case"Notes":t.Fields.push(this.ViewNotes);break;case"Contacts":t.Fields.push(this.ViewContacts);break;case"Attachments":t.Fields.push(this.ViewAttachments)}}}SetLastDay(t){t.Date.getDate()!=t.Date.DaysInMonth()&&(t.Date=new Date(t.Date.getFullYear(),t.Date.getMonth(),t.Date.DaysInMonth()))}OnSaveBatch(t){Logger.InfoLog("AddEditBatchViewModel::Entering OnSaveBatch");try{let t=this.ScreenObject.ValidateData();if(t.length>0)return this.MessageVisibility=!0,void(this.DisplayMessage=t);if(0==this.objBatch.BatchID){let t={StrCode:this.objBatch.BatchCode,CodePrefix:this.objBatch.CodePrefix,CodeNumber:this.objBatch.CodeNumber};if(this.DisplayMessage=this.ScreenObject.SetAutoCodeParams_3(this.BatchCode,this.objBatch.BatchGroup,this.ScreenObject.Data.Tables[9],t),this.objBatch.BatchCode=t.StrCode,this.objBatch.CodePrefix=t.CodePrefix,this.objBatch.CodeNumber=t.CodeNumber,this.DisplayMessage.length>0)return}else this.objBatch.BatchCode=this.BatchCode.Text;this.objBatch.BatchNumber=this.BatchNumber.Text,this.objBatch.MfgDateFormat=this.MfgDateFormat.Text,this.MfgDate.Date?(this.OnlyMonthYear&&this.SetLastDay(this.MfgDate),this.objBatch.MfgDate=this.MfgDate.Date.ToString("dd/MMM/yyyy")):this.objBatch.MfgDate="1/JAN/1900",this.objBatch.ExpiryDateFormat=this.ExpiryDateFormat.Text,this.ExpiryDate.Date?(this.OnlyMonthYear&&this.SetLastDay(this.ExpiryDate),this.objBatch.ExpiryDate=this.ExpiryDate.Date.ToString("dd/MMM/yyyy")):this.objBatch.ExpiryDate="1/JAN/1900",this.objBatch.BatchStatus=parseInt(this.Status.SelectedValue),this.objBatch.MRPRate=""!=this.MRPRate.Text?parseFloat(this.MRPRate.Text):0,this.objBatch.MRPCurrID=""!=this.MRPCurrID.SelectedValue.toString()?this.MRPCurrID.SelectedValue:0,this.objBatch.MRPExchRT=""!=this.MRPExchRT.Text?parseFloat(this.MRPExchRT.Text):0,this.objBatch.RetailRate=""!=this.RetailRate.Text?parseFloat(this.RetailRate.Text):0,this.objBatch.RRCurrID=""!=this.RRCurrID.SelectedValue.toString()?this.RRCurrID.SelectedValue:0,this.objBatch.RRExchRT=""!=this.RRExchRT.Text?parseFloat(this.RRExchRT.Text):0,this.objBatch.StockistRate=""!=this.StockistRate.Text?parseFloat(this.StockistRate.Text):0,this.objBatch.SRCurrID=""!=this.SRCurrID.SelectedValue.toString()?this.SRCurrID.SelectedValue:0,this.objBatch.SRExchRT=""!=this.SRExchRT.Text?parseFloat(this.SRExchRT.Text):0,this.objBatch.ProductID=""!=this.ProductID.SelectedValue.toString()&&"0"!=this.ProductID.SelectedValue.toString()?this.ProductID.SelectedValue:0,this.objBatch.VendorAccountID=""!=this.VendorAccountID.SelectedValue.toString()&&"0"!=this.VendorAccountID.SelectedValue.toString()?this.VendorAccountID.SelectedValue:0,this.objBatch.AlertDays=""!=this.AlertDays.Text?parseInt(this.AlertDays.Text):0,this.objBatch.PreExpiryDays=""!=this.PreExpiryDays.Text?parseInt(this.PreExpiryDays.Text):0,this.objBatch.BatchGroup=""!=this.Group.SelectedValue?parseInt(this.Group.SelectedValue):0;let e="";this.RetestDate.Date?(this.OnlyMonthYear&&this.SetLastDay(this.RetestDate),e=this.RetestDate.Date.ToString("dd/MMM/yyyy")):e="1/JAN/1900",this.objBatch.CustomFieldsQuery=this.ScreenObject.GetCustomFieldsQuery(),this.objBatch.CustomCostCenterFieldsQuery=this.ScreenObject.GetCustomCostCenterFieldsQuery(),this.objBatch.CustomFieldCCMapXML=this.ScreenObject.GetCustomFieldCCMapXML(),this.objBatch.ContactsXML=this.ViewContacts.GetXML(),this.objBatch.NotesXML=this.ViewNotes.GetXML(),this.objBatch.AttachmetsXML=this.ViewAttachments.GetXML(),null!=this.SelectedAddressType&&(this.objBatch.SelectedAddressType=this.SelectedAddressType),null!=this.PrimaryContact&&(this.objBatch.PrimaryContact=this.PrimaryContact),null!=this.Address1&&(this.objBatch.Address1=this.Address1),null!=this.Address2&&(this.objBatch.Address2=this.Address2),null!=this.Address3&&(this.objBatch.Address3=this.Address3),null!=this.City&&(this.objBatch.City=this.City),null!=this.State&&(this.objBatch.State=this.State),null!=this.Pin&&(this.objBatch.Pin=this.Pin),null!=this.Country&&(this.objBatch.lengthry=this.Country),null!=this.Phone1&&(this.objBatch.Phone1=this.Phone1),null!=this.Phone2&&(this.objBatch.Phone2=this.Phone2),null!=this.Fax&&(this.objBatch.Fax=this.Fax),null!=this.Email1&&(this.objBatch.Email1=this.Email1),null!=this.objBatch&&(this.objBatch.Email2=this.Email2),null!=URL&&(this.objBatch.URL=URL);let s=0;i.a.inventory.AddBatch(this.objBatch,"AddBatch",e).subscribe(t=>{this.MessageVisibility=!0,this.DisplayMessage=t.Message,s=t.RetValue,s>0&&(this.ScreenObject.Clear(),this.ViewContacts.ContactsListObj.Clear(),this.ViewNotes.NotesListObj.Clear(),this.ViewAttachments.AttachmentsListObj.Clear(),this.PrimaryContact="",this.Address1="",this.Address2="",this.Address3="",this.City="",this.State="",this.Pin="",this.Country="",this.Phone1="",this.Phone2="",this.Fax="",this.Email1="",this.Email2="",this.URL="",this.BatchID>0&&(this.BatchCode.Text="")),Logger.InfoLog("AddEditBatchViewModel::Exiting OnSaveBatch")},t=>{console.log("AddEditBatchViewModel Save : "+JSON.stringify(t))})}catch(e){Logger.InfoLog("AddEditBatchViewModel::Exception OnSaveBatch:"+e.stack)}}onCanSaveBatch(t){return!0}FillControls(){let t=i.a.inventory.GetBatchDetails(this.BatchID);if(Object.assign(this.objBatch,t.obj),t.Tables.length>0&&t.Tables[0].length>0){if(a.e.StringIsNullOrEmpty(t.Tables[0][0].BatchCode)||(this.BatchCode.Text=t.Tables[0][0].BatchCode.toString()),(this.ScreenObject.InheritParentCode||this.ScreenObject.IsAutoCode)&&(this.BatchCode.Enable=!1),a.e.StringIsNullOrEmpty(t.Tables[0][0].BatchNumber)||(this.BatchNumber.Text=t.Tables[0][0].BatchNumber.toString()),a.e.StringIsNullOrEmpty(t.Tables[0][0].StatusID)||(this.Status.SelectedValue=t.Tables[0][0].StatusID.toString()),a.e.StringIsNullOrEmpty(t.Tables[0][0].ParentID)||(this.Group.SelectedValue=t.Tables[0][0].ParentID.toString()),a.e.StringIsNullOrEmpty(t.Tables[0][0].MfgDateFormat)||(this.MfgDateFormat.Text=t.Tables[0][0].MfgDateFormat.toString()),a.e.StringIsNullOrEmpty(t.Tables[0][0].MfgDate)||(this.MfgDate.Text=t.Tables[0][0].MfgDate.toString()),a.e.StringIsNullOrEmpty(t.Tables[0][0].MfgDate)||(this.MfgDate.Date=new Date(t.Tables[0][0].MfgDate)),a.e.StringIsNullOrEmpty(t.Tables[0][0].ExpiryDateFormat)||(this.ExpiryDateFormat.Text=t.Tables[0][0].ExpiryDateFormat.toString()),a.e.StringIsNullOrEmpty(t.Tables[0][0].ExpiryDate)||(this.ExpiryDate.Text=t.Tables[0][0].ExpiryDate.toString()),a.e.StringIsNullOrEmpty(t.Tables[0][0].ExpiryDate)||(this.ExpiryDate.Date=new Date(t.Tables[0][0].ExpiryDate)),a.e.StringIsNullOrEmpty(t.Tables[0][0].RetestDate)||(this.RetestDate.CustomFormat=i.a.SessionManager.Preferences["Date Format"].toString(),this.RetestDate.Text=new Date(t.Tables[0][0].RetestDate).ToString(i.a.SessionManager.Preferences["Date Format"]),this.RetestDate.Date=new Date(t.Tables[0][0].RetestDate)),a.e.StringIsNullOrEmpty(t.Tables[0][0].MRPRate)||(this.MRPRate.Text=t.Tables[0][0].MRPRate.toString()),a.e.StringIsNullOrEmpty(t.Tables[0][0].MRPCurrID)||(this.MRPCurrID.SelectedValue=parseInt(t.Tables[0][0].MRPCurrID)),a.e.StringIsNullOrEmpty(t.Tables[0][0].MRPExchRT)||(this.MRPExchRT.Text=t.Tables[0][0].MRPExchRT.toString()),a.e.StringIsNullOrEmpty(t.Tables[0][0].RetailRate)||(this.RetailRate.Text=t.Tables[0][0].RetailRate.toString()),a.e.StringIsNullOrEmpty(t.Tables[0][0].RRCurrID)||(this.RRCurrID.SelectedValue=parseInt(t.Tables[0][0].RRCurrID)),a.e.StringIsNullOrEmpty(t.Tables[0][0].RRExchRT)||(this.RRExchRT.Text=t.Tables[0][0].RRExchRT.toString()),a.e.StringIsNullOrEmpty(t.Tables[0][0].StockistRate)||(this.StockistRate.Text=t.Tables[0][0].StockistRate.toString()),a.e.StringIsNullOrEmpty(t.Tables[0][0].SRCurrID)||(this.SRCurrID.SelectedValue=parseInt(t.Tables[0][0].SRCurrID)),a.e.StringIsNullOrEmpty(t.Tables[0][0].SRExchRT)||(this.SRExchRT.Text=t.Tables[0][0].SRExchRT.toString()),a.e.StringIsNullOrEmpty(t.Tables[0][0].ProductID)||(this.ProductID.SelectedValue=parseInt(t.Tables[0][0].ProductID)),a.e.StringIsNullOrEmpty(t.Tables[0][0].VendorAccountID)||(this.VendorAccountID.SelectedValue=parseInt(t.Tables[0][0].VendorAccountID)),a.e.StringIsNullOrEmpty(t.Tables[0][0].AlertDays)||(this.AlertDays.Text=t.Tables[0][0].AlertDays.toString()),a.e.StringIsNullOrEmpty(t.Tables[0][0].PreExpiryDays)||(this.PreExpiryDays.Text=t.Tables[0][0].PreExpiryDays.toString()),t.Tables[2].length>0){let e=t.Tables[2];a.e.IsEmpty(e[0].AddressTypeID)||(this.SelectedAddressType=e[0].AddressTypeID.toString()),a.e.IsEmpty(e[0].ContactName)||(this.PrimaryContact=e[0].ContactName.toString()),a.e.IsEmpty(e[0].Address1)||(this.Address1=e[0].Address1.toString()),a.e.IsEmpty(e[0].Address2)||(this.Address2=e[0].Address2.toString()),a.e.IsEmpty(e[0].Address3)||(this.Address3=e[0].Address3.toString()),a.e.IsEmpty(e[0].City)||(this.City=e[0].City.toString()),a.e.IsEmpty(e[0].State)||(this.State=e[0].State.toString()),a.e.IsEmpty(e[0].Zip)||(this.Pin=e[0].Zip.toString()),a.e.IsEmpty(e[0].Country)||(this.Country=e[0].Country.toString()),a.e.IsEmpty(e[0].Phone1)||(this.Phone1=e[0].Phone1.toString()),a.e.IsEmpty(e[0].Phone2)||(this.Phone2=e[0].Phone2.toString()),a.e.IsEmpty(e[0].Email1)||(this.Email1=e[0].Email1.toString()),a.e.IsEmpty(e[0].Email2)||(this.Email2=e[0].Email2.toString()),a.e.IsEmpty(e[0].Fax)||(this.Fax=e[0].Fax.toString()),a.e.IsEmpty(e[0].URL)||(this.URL=e[0].URL.toString())}this.ScreenObject.LoadCustomFieldsData(t.Tables[0]),this.ScreenObject.LoadCustomFieldsCCData(t.Tables[5]),this.ViewContacts.LoadContacts(t.Tables[2],t.Columns[2]),this.ViewNotes.LoadNotes(t.Tables[3]),this.ViewAttachments.LoadAttachments(t.Tables[4])}}BuildControls(){Logger.InfoLog("AddEditBatchViewModel::Entering BuildControls");try{return(new h.a).GetControls(this.CostCenterID.toString(),i.a.SessionManager.CompanyIndex)}catch(t){return Logger.ErrorLog("AddEditBatchViewModel:: BuildControls"+t.stack),null}}AutoGenerateCode(){0==this.BatchID&&(this.objBatch.BatchGroup=""!=this.Group.SelectedValue?parseInt(this.Group.SelectedValue)>0?parseInt(this.Group.SelectedValue):0:1,this.ScreenObject.SetAutoCode(this.BatchCode,this.objBatch.IsGroup,this.objBatch.BatchGroup,this.ScreenObject.Data.Tables[9]))}load(){}AssignRowColumns(){let t;t=this.ScreenObject.CustomFields.length;for(let e=0;e<t;e++);}}}}]);
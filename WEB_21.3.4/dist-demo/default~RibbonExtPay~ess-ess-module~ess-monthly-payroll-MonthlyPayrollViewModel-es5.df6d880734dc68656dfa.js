function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var a,s=_getPrototypeOf(e);if(t){var r=_getPrototypeOf(this).constructor;a=Reflect.construct(s,arguments,r)}else a=s.apply(this,arguments);return _possibleConstructorReturn(this,a)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{"+0zN":function(e,t,a){"use strict";a.r(t),a.d(t,"MonthlyPayrollViewModel",(function(){return _}));var s=a("mrSG"),r=a("Do2H"),o=a("Lp6j"),i=a("eQJW"),n=a("ScVY"),l=a("4ADR"),d=a("EQd/"),c=a("Huqd"),h=a("8B8H"),u=a("sDFv"),g=a("JIg3"),D=a("jgdN"),y=a("n56n"),P=a("0/4Q"),C=a("ockk"),m=a("VxiT"),p=a("Jnyl"),M=a("FruK"),S=a("4HhE"),f=a("s7Y5"),E=a("/G+I"),F=a("BUEH"),T=a("PGQ+"),A=function(e){_inherits(a,e);var t=_createSuper(a);function a(e){var s;_classCallCheck(this,a),(s=t.call(this)).DialogResult=!1,s.dtAdjData=[],s.SelectedEmpID=0,s.dtProcessed=[],s.strSelectedMonths="",Logger.InfoLog("AdjustmentsViewModel::Entering AdjustmentsViewModel()"),s.DisplayMessage="",s.Parent=e[0],s.Parent.Opacity=.3,s.SelectedEmpID=parseInt(e[1]),s.dtDOJ=new Date(e[2]),s.dtAdjData=e[3],s.LoadGrid(),s.dgv.Clear(),s.dtProcessed=r.a.empService.GetQueryData(s.SelectedEmpID,"ADJ001","","","");var o,i=r.a.SessionManager.PayrollMonth.AddMonths(-1),n=new Date(s.dtDOJ.getFullYear(),s.dtDOJ.getMonth(),1),l=s.dtDOJ.DaysInMonth();for(s.drc=s.dtProcessed.filter((function(e){return e.PayrollMonth&&new Date(e.PayrollMonth).ToString("dd/MMM/yyyy")==n.ToString("dd/MMM/yyyy")})),null!=s.drc&&0!=s.drc.length||((o={}).EmpSeqNo=s.SelectedEmpID,o.PayrollMonth=n,o.TotalDays=l,o.DaysWorked=s.dtDOJ.getDate()-1,o.Leaves=0,o.AdjDays=0,s.dtProcessed.push(o));i>=n;)s.drc=s.dtProcessed.filter((function(e){return e.PayrollMonth&&new Date(e.PayrollMonth).ToString("dd/MMM/yyyy")==i.ToString("dd/MMM/yyyy")})),null!=s.drc&&s.drc.length>0&&((o=s.dgv.NewRow()).Select=!1,o.PayrollMonth=i.ToString("dd/MMM/yyyy"),s.dgv.addRow(o)),i=i.AddMonths(-1);if(null!=s.dtAdjData&&s.dtAdjData.length>0)for(var d=function(e){s.drc=s.dtAdjData.filter((function(t){return t.AdjMonth==s.dgv.Table[e].PayrollMonth.toString()})),null!=s.drc&&s.drc.length>0&&(s.dgv.Table[e].Select=!0,s.dgv.Table[e].Days=s.drc[0].Days.toString(),s.dgv.Table[e].Remarks=s.drc[0].Remarks.toString(),s.dgv.updateRow(s.dgv.Table[e]))},c=0;c<s.dgv.Table.length;c++)d(c);return Logger.InfoLog("AdjustmentsViewModel::Exiting AdjustmentsViewModel()"),s}return _createClass(a,[{key:"LoadGrid",value:function(){Logger.InfoLog("AdjustmentsViewModel::Entering LoadGrid()"),this.dgv=new h.a,this.dgv.Columns=[],this.dgv.Width="";var e=new C.a;e.Header="Select",e.DisplayMember="Select",e.ID="Select",e.Width=60,e.DataType="CheckBox",e.ReadOnly=!1,this.dgv.Columns.push(e),(e=new C.a).Header="Payroll Month",e.DisplayMember="PayrollMonth",e.ID="PayrollMonth",e.Width=120,e.ReadOnly=!0,e.TextAlign="Center",this.dgv.Columns.push(e),(e=new C.a).Header="Days",e.DisplayMember="Days",e.ID="Days",e.Width=80,e.ReadOnly=!1,e.DataType="FLOAT",this.dgv.Columns.push(e),(e=new C.a).Header="Remarks",e.DisplayMember="Remarks",e.ID="Remarks",e.Width=200,e.ReadOnly=!1,this.dgv.Columns.push(e),this.dgv.Clear(),this.dgv.TableColumns.push("Select"),this.dgv.TableColumns.push("PayrollMonth"),this.dgv.TableColumns.push("Days"),this.dgv.TableColumns.push("Remarks"),Logger.InfoLog("AdjustmentsViewModel::Exiting LoadGrid()")}},{key:"Button_Click",value:function(e){if(Logger.InfoLog("AdjustmentsViewModel::Entering Button_Click"),"OK"==e.toString()){var t;this.dtAdjData.Clear();for(var a=0,s=0;s<this.dgv.Table.length;s++)Object(i.j)(this.dgv.Table[s].Select)&&!o.e.IsEmpty(this.dgv.Table[s].Days)&&""!=this.dgv.Table[s].Days.toString().Trim()&&((t=this.dtAdjData.NewRow()).PayrollMonth=r.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),t.AdjMonth=this.dgv.Table[s].PayrollMonth.toString(),t.Days=this.dgv.Table[s].Days.toString(),t.Remarks=o.e.IsEmpty(this.dgv.Table[s].Remarks)?"":this.dgv.Table[s].Remarks.toString(),this.dtAdjData.push(t),a++);if(0==a)return this.DisplayMessage="Select atleast one Month to adjust",void(this.MessageVisibility=!0);var n=0;if(null!=this.dtAdjData&&this.dtAdjData.length>0)for(var l=0;l<this.dtAdjData.length;l++)for(var d=0;d<this.dtProcessed.length;d++)if(new Date(this.dtAdjData[l].AdjMonth)==new Date(this.dtProcessed[d].PayrollMonth)&&new Date(this.dtAdjData[l].PayrollMonth)!=r.a.SessionManager.PayrollMonth){if((n=parseFloat(this.dtProcessed[d].AdjDays))+parseFloat(this.dtProcessed[d].DaysWorked)+parseFloat(this.dtProcessed[d].Leaves)+parseFloat(this.dtAdjData[l].Days)>parseFloat(this.dtProcessed[d].TotalDays))return this.DisplayMessage="Days Exceeded for the Payroll Month - "+this.dtAdjData[l].AdjMonth+",\r\nCan not be more than "+(parseFloat(this.dtProcessed[d].TotalDays)-(parseFloat(this.dtProcessed[d].DaysWorked)+parseFloat(this.dtProcessed[d].Leaves)+n)),void(this.MessageVisibility=!0);break}null!=this.Parent&&(this.Parent.Opacity=1,this.Parent.DialogResult=!0),this.DialogResult=!0}else"Cancel"==e.toString()&&(null!=this.Parent&&(this.Parent.Opacity=1,this.Parent.DialogResult=!1),this.DialogResult=!1);r.a.page.HideDialog(),Logger.InfoLog("AdjustmentsViewModel::Exiting Button_Click")}}]),a}(n.b),L=a("FZke"),v=function(e){_inherits(a,e);var t=_createSuper(a);function a(e){var s;_classCallCheck(this,a),(s=t.call(this)).DialogResult=!1,s.dtDSData=[],s.TdtDSData=null,s.SelectedEmpID=0,s.strSelectedMonths="",Logger.InfoLog("DuesSelectionViewModel::Entering DuesSelectionViewModel()"),s.DisplayMessage="",s.Parent=e[0],s.Parent.Opacity=.3,s.SelectedEmpID=parseInt(e[1]),s.dtPayrollMonth=new Date(e[2]),s.dtDSData=e[3],s.LoadGrid(),s.dgv.Clear();var i=r.a.empService.GetQueryData(s.SelectedEmpID,"DUE001","","","");if(null!=i&&i.Tables[0].length>0)for(var n=!1,l=function(e,t){n=!1,"FieldType='"+i.Tables[0][e].FieldType.toString()+"' AND ComponentID='"+i.Tables[0][e].ComponentID.toString()+"' AND DuesPaidMonth='"+new Date(i.Tables[0][e].PayrollMonth).ToString("dd/MMM/yyyy")+"' ",s.drc=i.Tables[1].filter((function(t){return t.FieldType==i.Tables[0][e].FieldType.toString()&&t.ComponentID==i.Tables[0][e].ComponentID.toString()&&t.vDuesPaidMonth==new Date(i.Tables[0][e].PayrollMonth).ToString("dd/MMM/yyyy")})),null!=s.drc&&s.drc.length>0?new Date(s.drc[0].PayrollMonth)==s.dtPayrollMonth&&(n=!0):n=!0,n&&(s.drw=s.dgv.NewRow(),s.drw.SlNo=(t+1).toString(),s.drw.FieldType=i.Tables[0][e].sFieldType.toString(),s.drw.ComponentName=i.Tables[0][e].ComponentName.toString(),s.drw.PayrollMonth=new Date(i.Tables[0][e].PayrollMonth).ToString("dd/MMM/yyyy"),s.drw.Amount=i.Tables[0][e].Amount.toString(),s.drw.Select=!1,s.drw.ComponentID=i.Tables[0][e].ComponentID.toString(),s.dgv.addRow(s.drw),t++),c=t},d=0,c=0;d<i.Tables[0].length;d++)l(d,c);if(null!=s.dtDSData&&s.dtDSData.length>0)for(var h=function(e){s.drc=s.dtDSData.filter((function(t){return t.FieldType==o.e.String(s.dgv.Table[e].FieldType)&&t.ComponentID==o.e.String(s.dgv.Table[e].ComponentID)&&t.PayrollMonth==o.e.String(s.dgv.Table[e].PayrollMonth)})),null!=s.drc&&s.drc.length>0&&(s.dgv.Table[e].Select=!0)},u=0;u<s.dgv.Table.length;u++)h(u);return Logger.InfoLog("DuesSelectionViewModel::Exiting DuesSelectionViewModel()"),s}return _createClass(a,[{key:"LoadGrid",value:function(){Logger.InfoLog("DuesSelectionViewModel::Entering LoadGrid()"),this.dgv=new h.a,this.dgv.Columns=[],this.dgv.Width="";var e=new C.a;e.Header="#",e.DisplayMember="SlNo",e.ID="SlNo",e.Width=40,e.ReadOnly=!0,e.TextAlign="Center",this.dgv.Columns.push(e),(e=new C.a).Header="Field Type",e.DisplayMember="FieldType",e.ID="FieldType",e.Width=85,e.ReadOnly=!0,e.TextAlign="Left",this.dgv.Columns.push(e),(e=new C.a).Header="Component Name",e.DisplayMember="ComponentName",e.ID="ComponentName",e.Width=150,e.ReadOnly=!0,e.TextAlign="Left",this.dgv.Columns.push(e),(e=new C.a).Header="Payroll Month",e.DisplayMember="PayrollMonth",e.ID="PayrollMonth",e.Width=95,e.ReadOnly=!0,e.TextAlign="Center",this.dgv.Columns.push(e),(e=new C.a).Header="Amount",e.DisplayMember="Amount",e.ID="Amount",e.Width=80,e.ReadOnly=!0,e.DataType="FLOAT",this.dgv.Columns.push(e),(e=new C.a).Header="Select",e.DisplayMember="Select",e.ID="Select",e.Width=50,e.DataType="CheckBox",e.ReadOnly=!1,this.dgv.Columns.push(e),this.dgv.Clear(),this.dgv.TableColumns.push("SlNo"),this.dgv.TableColumns.push("FieldType"),this.dgv.TableColumns.push("ComponentName"),this.dgv.TableColumns.push("PayrollMonth"),this.dgv.TableColumns.push("Amount"),this.dgv.TableColumns.push("Select"),this.dgv.TableColumns.push("ComponentID"),this.dgv.Clear(),Logger.InfoLog("DuesSelectionViewModel::Exiting LoadGrid()")}},{key:"Button_Click",value:function(e){if(Logger.InfoLog("DuesSelectionViewModel::Entering Button_Click"),"OK"==e.toString()){this.dtDSData.Clear();for(var t=0,a=0;a<this.dgv.Table.length;a++)!o.e.IsEmpty(this.dgv.Table[a].Select)&&Object(i.j)(this.dgv.Table[a].Select)&&(this.drw={},this.drw.FieldType=this.dgv.Table[a].FieldType.toString(),this.drw.ComponentID=this.dgv.Table[a].ComponentID.toString(),this.drw.PayrollMonth=new Date(this.dgv.Table[a].PayrollMonth).ToString("dd/MMM/yyyy"),this.drw.Amount=this.dgv.Table[a].Amount.toString(),this.dtDSData.push(this.drw),t++);if(0==t)return this.DisplayMessage="Select atleast one allowance",void(this.MessageVisibility=!0);null!=this.Parent&&(this.Parent.Opacity=1,this.Parent.DialogResult=!0),this.DialogResult=!0}else"Cancel"==e.toString()&&(null!=this.Parent&&(this.Parent.Opacity=1,this.Parent.DialogResult=!1),this.DialogResult=!1);r.a.page.HideDialog(),Logger.InfoLog("DuesSelectionViewModel::Exiting Button_Click")}}]),a}(n.b),I=function(e){_inherits(a,e);var t=_createSuper(a);function a(e){var s;_classCallCheck(this,a),(s=t.call(this)).ChklstPayrollMonths=[],s.DialogResult=!1,s.dtArrData=[],s.SelectedEmpID=0,s.strSelectedMonths="",Logger.InfoLog("ArrearsViewModel::Entering ArrearsViewModel()"),s.DisplayMessage="",s.Parent=e[0],s.Parent.Opacity=.3,s.SelectedEmpID=parseInt(e[1]),s.dtArrData=e[2],s.ChklstPayrollMonths.Clear();var o=r.a.empService.GetQueryData(s.SelectedEmpID,"ARE001",r.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),"","");if(null!=o&&o.Tables[0].length>0){var i=new Date(o.Tables[0][0].DtApplyFrom.toString()),n=new Date(o.Tables[0][0].DtEffectFrom.toString()),l=o.Tables[1][0].ArrCalcMonths.toString();if(n>i&&r.a.SessionManager.PayrollMonth>=n){s.ChklstPayrollMonths.Clear();for(var d=i;d<n;)l.Contains(d.ToString("dd/MMM/yyyy"))||s.ChklstPayrollMonths.push(new P.c(d.ToString("dd/MMM/yyyy"))),d=d.AddMonths(1)}}else s.DisplayMessage="Appraisals are not found for this Employee",s.MessageVisibility=!0;if(null!=s.dtArrData&&s.dtArrData.length>0)for(var c=0;c<s.dtArrData.length;c++)for(var h=0;h<s.ChklstPayrollMonths.length;h++)if(new Date(s.dtArrData[c].PayrollMonth)==new Date(s.ChklstPayrollMonths[h].Name)){s.ChklstPayrollMonths[h].IsChecked=!0;break}return Logger.InfoLog("ArrearsViewModel::Exiting ArrearsViewModel()"),s}return _createClass(a,[{key:"Button_Click",value:function(e){if(Logger.InfoLog("ArrearsViewModel::Entering Button_Click"),"OK"==e.toString()){var t;this.dtArrData.Clear();for(var a=0;a<this.ChklstPayrollMonths.length;a++)this.ChklstPayrollMonths[a].IsChecked&&(this.strSelectedMonths+=this.ChklstPayrollMonths[a].Name+";",(t={}).PayrollMonth=this.ChklstPayrollMonths[a].Name,this.dtArrData.push(t));if(!(this.strSelectedMonths.length>0))return this.DisplayMessage="Select atleast one Payroll Month",void(this.MessageVisibility=!0);this.strSelectedMonths=this.strSelectedMonths.Remove(this.strSelectedMonths.length-1,1),null!=this.Parent&&(this.Parent.Opacity=1,this.Parent.DialogResult=!0),this.DialogResult=!0}else"Cancel"==e.toString()&&(null!=this.Parent&&(this.Parent.Opacity=1,this.Parent.DialogResult=!1),this.DialogResult=!1);r.a.page.HideDialog(),Logger.InfoLog("ArrearsViewModel::Exiting Button_Click")}}]),a}(n.b),b=a("dc+d"),N=a("4k0m"),O=a("++IR"),V=a("PDNK"),w=a("NkMH"),R=function(e){_inherits(a,e);var t=_createSuper(a);function a(e){var s;return _classCallCheck(this,a),(s=t.call(this)).DialogResult=!1,s.txtPartialRExcessAmt=new d.d(0),s.rdbInstAmt=new V.a,s.rdbPartialRExcessAmt=new V.a,s.rdbPostpone=new V.a,s.rdbExempt=new V.a,s.btnExcessPay=new w.a,s.Amount=0,s.InstAmt=0,s.BalAmount=0,s.ApprovedAmt=0,s.LoanPayType=0,s.iLoanType=0,s.EmpSeqNo=0,s.sLoanType="",s.DocNo="",s.sDecimalsAmount="N"+r.a.SessionManager.Preferences.DecimalsinAmount,Logger.InfoLog("ChangeLoanViewModel::Entering ChangeLoanViewModel"),s.DisplayMessage="",s.Parent=e[0],s.Parent.Opacity=.3,s.LoanPayType=parseInt(e[1]),s.Amount=parseFloat(e[2]),s.InstAmt=parseFloat(e[3]),s.BalAmount=parseFloat(e[4]),s.EmpSeqNo=parseInt(e[5]),s.iLoanType=parseInt(e[6]),s.sLoanType=e[7].toString(),s.DocNo=e[8].toString(),s.rdbInstAmt.CheckedChangedCommand.Subscribe(_assertThisInitialized(s),"rdbPartialRExcessAmt_CheckedChanged"),s.rdbPartialRExcessAmt.CheckedChangedCommand.Subscribe(_assertThisInitialized(s),"rdbPartialRExcessAmt_CheckedChanged"),s.rdbPostpone.CheckedChangedCommand.Subscribe(_assertThisInitialized(s),"rdbPartialRExcessAmt_CheckedChanged"),s.rdbExempt.CheckedChangedCommand.Subscribe(_assertThisInitialized(s),"rdbPartialRExcessAmt_CheckedChanged"),s.rdbInstAmt.IsChecked=!0,s.txtPartialRExcessAmt.Visible=!1,s.txtPartialRExcessAmt.Text=s.Amount.ToString(s.sDecimalsAmount),s.btnExcessPay.Visible=!1,0==s.LoanPayType?s.rdbInstAmt.IsChecked=!0:1==s.LoanPayType?(s.txtPartialRExcessAmt.Visible=!0,s.rdbPartialRExcessAmt.IsChecked=!0):2==s.LoanPayType?s.rdbPostpone.IsChecked=!0:3==s.LoanPayType&&(s.rdbExempt.IsChecked=!0),Logger.InfoLog("ChangeLoanViewModel::Exiting ChangeLoanViewModel"),s}return _createClass(a,[{key:"rdbPartialRExcessAmt_CheckedChanged",value:function(e){Logger.InfoLog("ChangeLoanViewModel::Entering rdbPartialRExcessAmt_CheckedChanged"),this.rdbPartialRExcessAmt.IsChecked?this.txtPartialRExcessAmt.Visible=!0:(this.txtPartialRExcessAmt.Visible=!1,this.btnExcessPay.Visible=!1),Logger.InfoLog("ChangeLoanViewModel::Exiting rdbPartialRExcessAmt_CheckedChanged")}},{key:"Button_Click",value:function(e){if(Logger.InfoLog("ChangeLoanViewModel::Entering Button_Click"),"OK"==e.toString()){if(this.Amount=0,this.rdbInstAmt.IsChecked)this.LoanPayType=0;else if(this.rdbPartialRExcessAmt.IsChecked)try{if(this.LoanPayType=1,this.Amount=parseFloat(this.txtPartialRExcessAmt.Text),this.Amount>this.BalAmount)return this.DisplayMessage="Amount should be less than or equal to Balance Amount : "+this.BalAmount,this.MessageVisibility=!0,void(this.txtPartialRExcessAmt.SetFocus=!0)}catch(t){return this.DisplayMessage="Enter valid Amount",this.MessageVisibility=!0,void(this.txtPartialRExcessAmt.SetFocus=!0)}else this.rdbPostpone.IsChecked?this.LoanPayType=2:this.rdbExempt.IsChecked&&(this.LoanPayType=3);null!=this.Parent&&(this.Parent.Opacity=1,this.Parent.DialogResult=!0),this.DialogResult=!0}else"Cancel"==e.toString()&&(null!=this.Parent&&(this.Parent.Opacity=1,this.Parent.DialogResult=!1),this.DialogResult=!1);r.a.page.HideDialog(),Logger.InfoLog("ChangeLoanViewModel::Exiting Button_Click")}}]),a}(n.b),x=a("6sKv"),k=a("Saj9"),W=a("V+gx"),j=a("CUWK"),B=a("MCKn"),_=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,a){var s,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";_classCallCheck(this,n),(s=t.call(this)).Opacity=1,s.DialogResult=!1,s.DisplayName="",s.DispMessage="",s.MsgVisibility=!1,s.Title="",s.StatusColor="#FF736F6F",s.DocStatus="",s.sPayrollMonth="",s.CustomTab=new l.a,s.NetSalary=new d.d(0),s.EmployeeList=new c.a(0),s.Remarks=new d.d(0),s.HeaderFields=[],s.SelectedTabIndex=0,s.SubmitVisiblility=!1,s.ApproveVisibility=!1,s.PostVisiblility=!0,s.UnPostVisiblility=!0,s.CustomizeVisiblility=!0,s.WorksheetVisible=!1,s.btnCloseVisible=!1,s.IsArrearsEnabled=!0,s.IsAdjustmentsEnabled=!0,s.WFDocLevelList=[],s.CostCenterID=0,s.SelectedEmpID=0,s.objMonPay={},s.dsDocDesig=[],s.dtWorkSheet=null,s.dtArrAdjDetails=null,s.sCrAccount="0",s.sDrAccount="0",s.DocID=0,s.CurrencyID=1,s.DocNo="",s.VoucherNo="",s.drc=[],s.iRow=0,s.iCol=-1,s.IsFrom="",s.sProcessType="",s.strCustomEmpFilter="",s.StatusID=0,s.objDSVM=null,s.dtDSData=null,s.dtAdjData=null,s.objAdjVM=null,s.dtPrevData=null,s.strWorkSheetXML="",s.dtArrData=null,s.sArrsCalcMonths="",s.sArrCalcMonthPaydays="0",s.sAdjsCalcMonths="",s.sAdjCalcMonthPaydays="",s.strArrearsDays="",s.dFS_NetSal=0,s.dFS_DaysAttended=0,s.dFS_LOPDays=0,s.savestatusvalue=-1,s.sBasicMonthly="0",s.DefProdID=0,s.iStaticTabCnt=4,s.iAccruCnt=0,s.iEarCnt=0,s.strWhere="",s.sbDimWhere="";try{Logger.InfoLog("MonthlyPayrollViewModel::Entering AddEditEmpMasterViewModel()"),s.ClassName="MonthlyPayrollViewModel",s.CostCenterID=40054,s.DisplayName=r.a.GetResource(e.Replace(" ","")),s.Title=r.a.GetResource(e.Replace(" ","")),s.DocStatus="[UnPosted]",s.sPayrollMonth=" / ["+r.a.SessionManager.PayrollMonth.ToString("MMM-yyyy")+"]",s.sProcessType=a,s.SelectedTabIndex=0,s.EmployeeList.Code.TypeID=4,s.EmployeeList.Name.TypeID=1,s.EmployeeList.Code.Visible=s.EmployeeList.Name.Visible=!1,s.EmployeeList.Code.Column=0,s.EmployeeList.Name.Column=1,s.EmployeeList.Code.Visible=!0,s.EmployeeList.Name.Visible=!0,s.EmployeeList.Code.CCID=s.EmployeeList.Name.CCID=50051,s.EmployeeList.Code.Visible&&(s.EmployeeList.Code.CCID=50051,s.EmployeeList.Code.TypeID=4),s.EmployeeList.Name.Visible&&(s.EmployeeList.Name.CCID=50051,s.EmployeeList.Name.TypeID=1),"UnProcessed"!=s.sProcessType&&"NoticePay"!=s.sProcessType&&""==o&&(s.strCustomEmpFilter=s.PopupEmployeesFilter()),s.costructor_sub1(o),Logger.InfoLog("MonthlyPayrollViewModel::Exiting MonthlyPayrollViewModel()")}catch(i){Logger.ErrorLog("MonthlyPayrollViewModel::EXCEPTION MonthlyPayrollViewModel()\r\n"+i.Message+"\r\n"+i.stack)}return s}return _createClass(n,[{key:"costructor_sub1",value:function(e){this.NetSalary.IsReadOnly=!0,this.NetSalary.Label=r.a.GetResource("NetSalary"),this.NetSalary.Align="right",this.Remarks.Label=r.a.GetResource("Remarks"),this.EmployeeList.Name.Label=r.a.GetResource("EmployeeName"),this.EmployeeList.Code.Label=r.a.GetResource("EmployeeCode"),this.EmployeeList.SelectionCallBack.Subscribe(this,"EmployeeList_LostFocus"),this.WorksheetVisible=!0,this.PostVisiblility=r.a.SessionManager.IsActionAssigned(this.CostCenterID,"Create"),this.UnPostVisiblility=r.a.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),this.CustomizeVisiblility=r.a.SessionManager.IsActionAssigned(this.CostCenterID,"Customize"),this.AddGrids(),this.BuildControls(this.CostCenterID),this.ClearControls(),this.CheckViewForUser(0),""!=e&&this.LoadEditVoucher(e)}},{key:"setStatusColor",value:function(){this.StatusColor=this.DocStatus.startsWith("["+r.a.GetResource("Doc_Draft")+"]")||this.DocStatus.startsWith("[UnPosted]")?r.a.SessionManager.Preferences.DraftColor:this.DocStatus.startsWith("[Partial]")?r.a.SessionManager.Preferences.partialColor:null!=this.oCMP?369==this.oCMP.arrLstOthMPFields[0].StatusID?r.a.SessionManager.Preferences.PostedColor:370==this.oCMP.arrLstOthMPFields[0].StatusID?r.a.SessionManager.Preferences.PDCColor:371==this.oCMP.arrLstOthMPFields[0].StatusID?r.a.SessionManager.Preferences.UnApprovedColor:372==this.oCMP.arrLstOthMPFields[0].StatusID?r.a.SessionManager.Preferences.RejectedColor:376==this.oCMP.arrLstOthMPFields[0].StatusID?r.a.SessionManager.Preferences.CancelledColor:429==this.oCMP.arrLstOthMPFields[0].StatusID?r.a.SessionManager.Preferences.BouncedColor:441==this.oCMP.arrLstOthMPFields[0].StatusID?r.a.SessionManager.Preferences.ApprovedColor:"#FF736F6F":"#FF736F6F"}},{key:"LoadEditVoucher",value:function(e){var t=r.a.empService.GetQueryData("MPL001",e,"","","");if(null!=t&&t.length>0){o.e.SetPayrollMonth(new Date(t[0].PayrollMonth),r.a.SessionManager),this.sPayrollMonth=" / ["+r.a.SessionManager.PayrollMonth.ToString("MMM-yyyy")+"]",this.SelectedEmpID=0;var a=parseInt(t[0].EmpSeqNo);this.EmployeeList.Code.SelectedValue=this.EmployeeList.Name.SelectedValue=a,this.EmployeeList.Code.Text=t[0].EmpCode.toString(),this.EmployeeList.Name.Text=t[0].EmpName.toString(),this.EmployeeList_LostFocus(this.EmployeeList)}}},{key:"InitSelectedEmployee",value:function(){"UnProcessed"!=this.sProcessType&&"NoticePay"!=this.sProcessType||(this.EmployeeList.Code.CustomWhere=this.EmployeeList.Name.CustomWhere="a.NodeID="+this.SelectedEmpID,this.EmployeeList_LostFocus(this.EmployeeList),this.EmployeeList.Enable=!1,this.btnCloseVisible=!0)}},{key:"sPayrollMonth_MouseDoubleClick",value:function(e){var t=this;e.stopImmediatePropagation();var a=new k.SetPayrollDateViewModel;r.a.page.ShowDialog(a,W.SetPayrollDateComponent,{ShowCenter:!0,Title:r.a.GetResource("Pay_SetPayrollDate")}).subscribe((function(){if(a.DialogResult){t.btnClear_Click();var e=" 1=1 ";null!=t.sbDimWhere&&t.sbDimWhere.toString().length>0&&(e+=t.sbDimWhere.toString()),e+=" AND "+t.FilterEmployees(),t.EmployeeList.Code.CustomWhere=t.EmployeeList.Name.CustomWhere=e}}))}},{key:"CheckViewForUser",value:function(e){var t=this;if(null!=this.dsDocDesig&&this.dsDocDesig.Tables.length>6&&this.dsDocDesig.Tables[6].length>0){if(this.HeaderFields.forEach((function(a){t.SetView(a,e,"")})),this.CustomTab.Pages.length>this.iStaticTabCnt)for(var a=this.iStaticTabCnt;a<this.CustomTab.Pages.length;a++)this.CustomTab.Pages[a].Fields.forEach((function(a){t.SetView(a,e,"")}));for(var s=0;s<this.dgvDays.Table.length;s++)this.SetView(this.dgvDays.Table[s],e,"Days");if(0==this.dgvDays.Table.filter((function(e){return"False"!=e.IsVisible})).length){var r=this.dgvDays.NewRow();this.dgvDays.addRow(r)}this.SetView("COLUMNSVISIBILITY",e,"");for(var i=0;i<this.dgvEarnings.Table.length;i++)o.e.IsEmpty(this.dgvEarnings.Table[i].EarSNo)||this.SetView(this.dgvEarnings.Table[i],e,"Earnings");for(var n=0;n<this.dgvEarOTs.Table.length;n++)o.e.IsEmpty(this.dgvEarOTs.Table[n].EarSNo)||this.SetView(this.dgvEarOTs.Table[n],e,"Earnings_OTs");for(var l=0;l<this.dgvDeductions.Table.length;l++)o.e.IsEmpty(this.dgvDeductions.Table[l].DedSNo)||this.SetView(this.dgvDeductions.Table[l],e,"Deductions");for(var d=0;d<this.dgvLoans.Table.length;d++)o.e.IsEmpty(this.dgvLoans.Table[d].LoanSNo)||this.SetView(this.dgvLoans.Table[d],e,"Loans");for(var c=0;c<this.dgvLeaves.Table.length;c++)o.e.IsEmpty(this.dgvLeaves.Table[c].LeaveSNo)||this.SetView(this.dgvLeaves.Table[c],e,"Leaves")}}},{key:"SetView",value:function(e,t,a){var s=this.dsDocDesig.Tables[6],n=this.dsDocDesig.Tables[0],l=s;this.DocID>0?(s=s.filter((function(e){return 2==e.Mode||3==e.Mode})),369==t&&(s=s.filter((function(e){return 2==e.Mode||3==e.Mode||4==e.Mode})))):s=s.filter((function(e){return 1==e.Mode||3==e.Mode})),e instanceof S.c?s=s.filter((function(t){return t.SysColumnName=="'"+e.DBColumnName+"'"})):e instanceof C.a?s="combobox"==e.DataType.toLowerCase()?s.filter((function(t){return t.SysColumnName=="'"+e.ValueBinding+"'"})):s.filter(3==e.CostCenterID||2==e.CostCenterID?function(t){return t.CostcenterColid==e.ID}:function(t){return t.SysColumnName=="'"+e.DisplayMember+"'"}):"COLUMNSVISIBILITY"==e.toString()&&(null!=(s=(s=l).filter((function(e){return 2000001==e.CostCenterColID})))&&s.length>0&&(this.dgvEarnings.Columns[2].IsVisible=Object(i.j)(s[0].IsVisible.toString())),null!=(s=(s=l).filter((function(e){return 2000002==e.CostCenterColID})))&&s.length>0&&(this.dgvEarnings.Columns[3].IsVisible=Object(i.j)(s[0].IsVisible.toString())),null!=(s=(s=l).filter((function(e){return 2000003==e.CostCenterColID})))&&s.length>0&&(this.dgvEarnings.Columns[4].IsVisible=Object(i.j)(s[0].IsVisible.toString())),null!=(s=(s=l).filter((function(e){return 2000004==e.CostCenterColID})))&&s.length>0&&(this.dgvEarnings.Columns[5].IsVisible=Object(i.j)(s[0].IsVisible.toString())),null!=(s=(s=l).filter((function(e){return 2000005==e.CostCenterColID})))&&s.length>0&&(this.dgvEarnings.Visible=Object(i.j)(s[0].IsVisible.toString())),null!=(s=(s=l).filter((function(e){return 2000006==e.CostCenterColID})))&&s.length>0&&(this.dgvEarOTs.Visible=Object(i.j)(s[0].IsVisible.toString())),null!=(s=(s=l).filter((function(e){return 2000007==e.CostCenterColID})))&&s.length>0&&(this.dgvDays.Visible=Object(i.j)(s[0].IsVisible.toString())),null!=(s=(s=l).filter((function(e){return 2000011==e.CostCenterColID})))&&s.length>0&&(this.dgvDeductions.Columns[2].IsVisible=Object(i.j)(s[0].IsVisible.toString())),null!=(s=(s=l).filter((function(e){return 2000012==e.CostCenterColID})))&&s.length>0&&(this.dgvDeductions.Columns[3].IsVisible=Object(i.j)(s[0].IsVisible.toString())),null!=(s=(s=l).filter((function(e){return 2000013==e.CostCenterColID})))&&s.length>0&&(this.dgvDeductions.Columns[4].IsVisible=Object(i.j)(s[0].IsVisible.toString())),null!=(s=(s=l).filter((function(e){return 2000014==e.CostCenterColID})))&&s.length>0&&(this.dgvDeductions.Columns[5].IsVisible=Object(i.j)(s[0].IsVisible.toString())),null!=(s=(s=l).filter((function(e){return 2000015==e.CostCenterColID})))&&s.length>0&&(this.dgvDeductions.Visible=Object(i.j)(s[0].IsVisible.toString())),null!=(s=(s=l).filter((function(e){return 2000021==e.CostCenterColID})))&&s.length>0&&(this.dgvLoans.Columns[2].IsVisible=Object(i.j)(s[0].IsVisible.toString())),null!=(s=(s=l).filter((function(e){return 2000022==e.CostCenterColID})))&&s.length>0&&(this.dgvLoans.Columns[3].IsVisible=Object(i.j)(s[0].IsVisible.toString())),null!=(s=(s=l).filter((function(e){return 2000023==e.CostCenterColID})))&&s.length>0&&(this.dgvLoans.Columns[4].IsVisible=Object(i.j)(s[0].IsVisible.toString())),null!=(s=(s=l).filter((function(e){return 2000024==e.CostCenterColID})))&&s.length>0&&(this.dgvLoans.Columns[5].IsVisible=Object(i.j)(s[0].IsVisible.toString())),null!=(s=(s=l).filter((function(e){return 2000025==e.CostCenterColID})))&&s.length>0&&(this.dgvLoans.Visible=Object(i.j)(s[0].IsVisible.toString())),null!=(s=(s=l).filter((function(e){return 2000031==e.CostCenterColID})))&&s.length>0&&(this.dgvLeaves.Columns[2].IsVisible=Object(i.j)(s[0].IsVisible.toString())),null!=(s=(s=l).filter((function(e){return 2000032==e.CostCenterColID})))&&s.length>0&&(this.dgvLeaves.Columns[3].IsVisible=Object(i.j)(s[0].IsVisible.toString())),null!=(s=(s=l).filter((function(e){return 2000033==e.CostCenterColID})))&&s.length>0&&(this.dgvLeaves.Columns[4].IsVisible=Object(i.j)(s[0].IsVisible.toString())),null!=(s=(s=l).filter((function(e){return 2000034==e.CostCenterColID})))&&s.length>0&&(this.dgvLeaves.Visible=Object(i.j)(s[0].IsVisible.toString()))),s.length>0?(e instanceof S.c?e.Visible=Object(i.j)(s[0].IsVisible.toString()):e instanceof C.a&&(e.IsVisible=Object(i.j)(s[0].IsVisible.toString())),o.e.IsEmpty(s[0].IsMandatory)||(e instanceof S.c?(e.Mandatory=Object(i.j)(s[0].IsMandatory),e instanceof c.a&&(e.Name.Mandatory=e.Mandatory)):e instanceof C.a&&(e.Mandatory=Object(i.j)(s[0].IsMandatory))),e instanceof S.c?(e.IsReadOnly=!Object(i.j)(s[0].IsEditable.toString()),e instanceof c.a&&(e.Code.IsReadOnly=e.Name.IsReadOnly=e.IsReadOnly)):e instanceof C.a&&(e.ReadOnly=!Object(i.j)(s[0].IsEditable.toString())),(e instanceof S.c||e instanceof C.a)&&(e.Expression=s[0].Expression.toString()),(e instanceof S.c||e instanceof C.a)&&(e.Message=s[0].FailureMessage.toString()),o.e.IsEmpty(s[0].ActionOptionID)?(e instanceof S.c||e instanceof C.a)&&(e.Action=0):(e instanceof S.c||e instanceof C.a)&&(e.Action=parseInt(s[0].ActionOptionID.toString())),o.e.IsEmpty(s[0].NumFieldEditOptionID)?e instanceof C.a&&(e.EditOption=0):e instanceof C.a&&(e.EditOption=parseInt(s[0].NumFieldEditOptionID.toString()))):(e instanceof S.c?n=n.filter((function(t){return t.SysColumnName=="'"+e.DBColumnName+"'"})):e instanceof C.a&&(n="combobox"==e.DataType.toLowerCase()?n.filter((function(t){return t.SysColumnName=="'"+e.ValueBinding+"'"})):n.filter(3==e.CostCenterID||2==e.CostCenterID?function(t){return t.CostcenterColid==e.ID}:function(t){return t.SysColumnName=="'"+e.DisplayMember+"'"})),n.length>0&&(e instanceof S.c?(e.IsReadOnly=!Object(i.j)(n[0].IsEditable.toString()),e instanceof c.a&&(e.Code.IsReadOnly=e.Name.IsReadOnly=e.IsReadOnly)):e instanceof C.a&&(r.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==r.a.SessionManager.Preferences.EnableDivisionWise.toString()&&50001==e.CostCenterID||r.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==r.a.SessionManager.Preferences.EnableLocationWise.toString()&&50002==e.CostCenterID||(e.ReadOnly=!Object(i.j)(n[0].IsEditable.toString()))),o.e.IsEmpty(n[0].IsMandatory)||(e instanceof S.c?(e.Mandatory=Object(i.j)(n[0].IsMandatory),e instanceof c.a&&(e.Name.Mandatory=e.Mandatory)):e instanceof C.a&&(e.Mandatory=Object(i.j)(n[0].IsMandatory))),e instanceof S.c&&!o.e.IsEmpty(n[0].IsVisible)?e.Visible=Object(i.j)(n[0].IsVisible.toString()):e instanceof C.a&&(e.IsVisible=Object(i.j)(n[0].IsVisible.toString()))),e instanceof C.a&&(e.EditOption=0),(e instanceof S.c||e instanceof C.a)&&(e.Expression=""),(e instanceof S.c||e instanceof C.a)&&(e.Message=""),(e instanceof S.c||e instanceof C.a)&&(e.Action=0))}},{key:"Button_Click",value:function(e){try{Logger.InfoLog("MonthlyPayrollViewModel::Entering OnButtonClick()"),"Post"==e.toString()?this.btnPost_Click():"Clear"==e.toString()?this.btnClear_Click():"UnPost"==e.toString()?this.btnUnPost_Click():"Submit"==e.toString()?this.btnSubmit_Click():"Approve"==e.toString()?this.btnApprove_Click():"Arrears"==e.toString()?this.btnArrears_Click():"Adjustments"==e.toString()?this.btnAdjustments_Click():"Dues"==e.toString()?this.btnDues_Click():"Customize"==e.toString()||("Worksheet"==e.toString()?this.btnWorksheet_Click():"EmployeeFilter"==e.toString()?this.btnEmployeeFilter_Click():"Close"==e.toString()?"UnProcessed"!=this.sProcessType&&"NoticePay"!=this.sProcessType||(this.DialogResult=!1,r.a.page.HideDialog()):"DocHistory"==e.toString()?this.btnDocHistory_Click():"History"==e.toString()&&this.btnHistory_Click()),Logger.InfoLog("MonthlyPayrollViewModel::Exiting OnButtonClick()")}catch(t){Logger.ErrorLog("MonthlyPayrollViewModel::EXCEPTION OnButtonClick()\r\n"+t.Message+"\r\n"+t.stack)}}},{key:"btnHistory_Click",value:function(){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,s,o,i,n,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.oCMP||!this.oCMP.arrLstOthMPFields[0].IsAlreadyProcessed){e.next=20;break}return e.prev=1,Logger.InfoLog("MonthlyPayrollViewModel::Entering btnDocHistory_Click()"),(t=[]).push(this),t.push(101),t.push(this.CostCenterID),t.push(parseInt(this.oCMP.arrLstOthMPFields[0].drcPayProcessed[0].DocID)),e.next=7,a.e(0).then(a.bind(null,"Wpdd"));case 7:return s=e.sent,o=s.PayrollCommonPopUpComponent,e.next=11,a.e(166).then(a.bind(null,"oCNg"));case 11:i=e.sent,n=i.PayrollCommonPopUpViewModel,l=new n(t),r.a.page.ShowDialog(l,o,{ShowCenter:!0,Title:l.Title}),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(1),Logger.ErrorLog("MonthlyPayrollViewModel::EXCEPTION btnDocHistory_Click()\r\n"+e.t0.Message+"\r\n"+e.t0.stack);case 20:case"end":return e.stop()}}),e,this,[[1,17]])})))}},{key:"btnDocHistory_Click",value:function(){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,s,o,i,n,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.oCMP||!this.oCMP.arrLstOthMPFields[0].IsAlreadyProcessed){e.next=20;break}return e.prev=1,Logger.InfoLog("MonthlyPayrollViewModel::Entering btnDocHistory_Click()"),(t=[]).push(this),t.push(100),t.push(this.CostCenterID),t.push(parseInt(this.oCMP.arrLstOthMPFields[0].drcPayProcessed[0].DocID)),e.next=7,a.e(0).then(a.bind(null,"Wpdd"));case 7:return s=e.sent,o=s.PayrollCommonPopUpComponent,e.next=11,a.e(166).then(a.bind(null,"oCNg"));case 11:i=e.sent,n=i.PayrollCommonPopUpViewModel,l=new n(t),r.a.page.ShowDialog(l,o,{ShowCenter:!0,Title:l.Title}),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(1),Logger.ErrorLog("MonthlyPayrollViewModel::EXCEPTION btnDocHistory_Click()\r\n"+e.t0.Message+"\r\n"+e.t0.stack);case 20:case"end":return e.stop()}}),e,this,[[1,17]])})))}},{key:"GetDuesViewModel",value:function(){var e=[];e.push(this),e.push(this.SelectedEmpID),e.push(r.a.SessionManager.PayrollMonth),e.push(this.dtDSData),this.objDSVM=new v(e)}},{key:"Set_MP_Dues",value:function(){var e=this;this.oCMP.arrLstOthMPFields[0].totEarArrears=0,this.oCMP.arrLstOthMPFields[0].totDedArrears=0,this.dtDSData=this.objDSVM.dtDSData,null!=this.dtDSData&&this.dtDSData.length>0&&function(){var t=e.dtDSData;if(t.length>0){for(var a=function(a){t[a].Amount=e.dtDSData.filter((function(e){return e.FieldType==t[a].FieldType&&e.ComponentID==t[a].ComponentID})).Compute("sum","Amount")},s=0;s<t.length;s++)a(s);for(var o=0;o<t.length;o++)if("Earning"==t[o].FieldType.toString()){for(var i=0;i<e.oCMP.arrLstCPFields[0][0].length;i++)if(e.oCMP.arrLstCPFields[0][0][i].ComponentID==parseInt(t[o].ComponentID)){e.oCMP.arrLstCPFields[0][0][i].dArrear=parseFloat(t[o].Amount).ToString(r.a.SessionManager.sPayrollDecimals),null==e.oCMP.arrLstCPFields[0][0][i].AddToNet||""==e.oCMP.arrLstCPFields[0][0][i].AddToNet||"Net"!=e.oCMP.arrLstCPFields[0][0][i].AddToNet&&"NetAndTax"!=e.oCMP.arrLstCPFields[0][0][i].AddToNet||(e.oCMP.arrLstOthMPFields[0].totEarArrears+=parseFloat(e.oCMP.arrLstCPFields[0][0][i].dArrear));break}}else for(var n=0;n<e.oCMP.arrLstCPFields[0][2].length;n++)if(e.oCMP.arrLstCPFields[0][2][n].ComponentID==parseInt(t[o].ComponentID)){e.oCMP.arrLstCPFields[0][2][n].dArrear=parseFloat(t[o].Amount).ToString(r.a.SessionManager.sPayrollDecimals),null==e.oCMP.arrLstCPFields[0][2][n].AddToNet||""==e.oCMP.arrLstCPFields[0][2][n].AddToNet||"Net"!=e.oCMP.arrLstCPFields[0][2][n].AddToNet&&"NetAndTax"!=e.oCMP.arrLstCPFields[0][2][n].AddToNet||(e.oCMP.arrLstOthMPFields[0].totDedArrears+=parseFloat(e.oCMP.arrLstCPFields[0][2][n].dArrear));break}e.oCMP.iEmpIndex=0,e.oCMP.ExecuteAllFormulas(),e.oCMP.CalculateNet(),e.FillProcessedData()}}()}},{key:"btnDues_Click",value:function(){var e=this;if(0!=this.SelectedEmpID)try{Logger.InfoLog("MonthlyPayrollViewModel::Entering btnDues_Click()");var t=[];t.push(this),t.push(this.SelectedEmpID),t.push(r.a.SessionManager.PayrollMonth),t.push(this.dtDSData),this.objDSVM=new v(t),r.a.page.ShowDialog(this.objDSVM,L.a,{ShowCenter:!0,Title:"Dues Selection"}).subscribe((function(){e.objDSVM.DialogResult&&e.Set_MP_Dues()}))}catch(a){Logger.ErrorLog("MonthlyPayrollViewModel::EXCEPTION btnDues_Click()\r\n"+a.Message+"\r\n"+a.stack)}else this.DisplayMessage=r.a.GetResource("SelectAnyEmployee"),this.MessageVisibility=!0,this.EmployeeList.SetFocus=!0}},{key:"GetAdjustmentsViewModel",value:function(){var e=[];e.push(this),e.push(this.SelectedEmpID),e.push(this.oCMP.arrLstOthMPFields[0].DateOfJoining),e.push(this.dtAdjData),this.objAdjVM=new A(e)}},{key:"SaveAdjustment",value:function(){this.dtAdjData=this.objAdjVM.dtAdjData.Copy();var e=r.a.SessionManager.PayrollMonth;this.CalculateAdjustments(),this.oCMP.CalculateNet(),this.FillProcessedData(),o.e.SetPayrollMonth(e,r.a.SessionManager)}},{key:"btnAdjustments_Click",value:function(){var e=this;if(0!=this.SelectedEmpID)try{Logger.InfoLog("MonthlyPayrollViewModel::Entering btnAdjustments_Click()"),this.GetAdjustmentsViewModel(),r.a.page.ShowDialog(this.objAdjVM,L.a,{ShowCenter:!0,Title:"Adjustments"}).subscribe((function(){if(e.objAdjVM.DialogResult){if(e.SaveAdjustment(),e.sAdjCalcMonthPaydays="",e.sAdjsCalcMonths="",null!=e.dtAdjData&&e.dtAdjData.length>0){for(var t=0;t<e.dtAdjData.length;t++)e.sAdjCalcMonthPaydays=e.sAdjCalcMonthPaydays+o.e.String(e.dtAdjData[t].Days)+";",e.sAdjsCalcMonths=e.sAdjsCalcMonths+o.e.String(e.dtAdjData[t].AdjMonth)+";";e.sAdjCalcMonthPaydays.length>0&&(e.sAdjCalcMonthPaydays=e.sAdjCalcMonthPaydays.Remove(e.sAdjCalcMonthPaydays.length-1,1)),e.sAdjsCalcMonths.length>0&&(e.sAdjsCalcMonths=e.sAdjsCalcMonths.Remove(e.sAdjsCalcMonths.length-1,1))}r.a.SessionManager.ModsTemp.split("~").Contains("13")}})),Logger.InfoLog("MonthlyPayrollViewModel::Exiting btnAdjustments_Click()")}catch(t){Logger.ErrorLog("MonthlyPayrollViewModel::EXCEPTION btnAdjustments_Click()\r\n"+t.Message+"\r\n"+t.stack)}else this.DisplayMessage=r.a.GetResource("SelectAnyEmployee"),this.MessageVisibility=!0,this.EmployeeList.SetFocus=!0}},{key:"OldCalculateAdjustments",value:function(){if(this.dtAdjData.length>0){for(var e=0;e<this.oCMP.arrLstCPFields[0][0].length;e++)this.oCMP.arrLstCPFields[0][0][e].dAdjusted="0";for(var t=0;t<this.oCMP.arrLstCPFields[0][2].length;t++)this.oCMP.arrLstCPFields[0][2][t].dAdjusted="0";this.oCMP.arrLstOthMPFields[0].totEarAdjustments=0,this.oCMP.arrLstOthMPFields[0].totDedAdjustments=0;for(var a=r.a.empService.GetQueryData(this.SelectedEmpID,"MPL005","","",""),s="",i=0;i<this.objAdjVM.dtAdjData.length;i++){var n=new Date(this.objAdjVM.dtAdjData[i].AdjMonth);s="'"+n.ToString("dd/MMM/yyyy")+"' >= ApplyFrom AND '"+n.ToString("dd/MMM/yyyy")+"' <=EffectFrom",this.drc=a.Select(s),null!=this.drc&&this.drc.length>0?(n=new Date(this.drc[0].EffectFrom),o.e.SetPayrollMonth(n,r.a.SessionManager)):o.e.SetPayrollMonth(n,r.a.SessionManager);var l,d=parseFloat(this.objAdjVM.dtAdjData[i].Days);l="Actual Days"!=r.a.SessionManager.Preferences.PayDays?parseInt(r.a.SessionManager.Preferences.PayDays):n.DaysInMonth();var c=new T.a;if(c.oParent=this,c.sSelectedEmpSeqNos=this.SelectedEmpID.toString(),c.PayrollMonth=r.a.SessionManager.PayrollMonth,c.PayrollMonthStart=r.a.SessionManager.PayrollMonthStart,c.PayrollMonthEnd=r.a.SessionManager.PayrollMonthEnd,c.IsAdjustments=!0,c.dAdjDays=d,c.ProcessPayroll(),c.IsCompleted){c.arrLstOthMPFields[0].TotalDays=l,c.arrLstOthMPFields[0].TotalLeaves=0,c.SetDaysAttended(0,"Days Attended",Math.abs(d));for(var h=0,u=0;u<this.oCMP.arrLstCPFields[0][0].length;u++)if(o.e.IsEmpty(this.oCMP.arrLstCPFields[0][0][u].CalculateAdjustments)||"No"!=this.oCMP.arrLstCPFields[0][0][u].CalculateAdjustments)for(var g=0;g<c.arrLstCPFields[0][0].length;g++)if(this.oCMP.arrLstCPFields[0][0][u].SNo==c.arrLstCPFields[0][0][g].SNo){this.oCMP.arrLstCPFields[0][0][u].SNo,h=d<0?-1*parseFloat(c.arrLstCPFields[0][0][g].dEarned):parseFloat(c.arrLstCPFields[0][0][g].dEarned),this.oCMP.arrLstCPFields[0][0][u].dAdjusted=(parseFloat(this.oCMP.arrLstCPFields[0][0][u].dAdjusted)+h).ToString(r.a.SessionManager.sPayrollDecimals),null==this.oCMP.arrLstCPFields[0][0][u].AddToNet||""==this.oCMP.arrLstCPFields[0][0][u].AddToNet||"Net"!=this.oCMP.arrLstCPFields[0][0][u].AddToNet&&"NetAndTax"!=this.oCMP.arrLstCPFields[0][0][u].AddToNet||(this.oCMP.arrLstOthMPFields[0].totEarAdjustments+=h);break}for(var D=0;D<this.oCMP.arrLstCPFields[0][2].length;D++)if(o.e.IsEmpty(this.oCMP.arrLstCPFields[0][2][D].CalculateAdjustments)||"No"!=this.oCMP.arrLstCPFields[0][2][D].CalculateAdjustments)for(var y=0;y<c.arrLstCPFields[0][2].length;y++)if(this.oCMP.arrLstCPFields[0][2][D].SNo==c.arrLstCPFields[0][2][y].SNo){this.oCMP.arrLstCPFields[0][2][D].SNo,h=d<0?-1*parseFloat(c.arrLstCPFields[0][2][y].dEarned):parseFloat(c.arrLstCPFields[0][2][y].dEarned),this.oCMP.arrLstCPFields[0][2][D].dAdjusted=(parseFloat(this.oCMP.arrLstCPFields[0][2][D].dAdjusted)+h).ToString(r.a.SessionManager.sPayrollDecimals),null==this.oCMP.arrLstCPFields[0][2][D].AddToNet||""==this.oCMP.arrLstCPFields[0][2][D].AddToNet||"Net"!=this.oCMP.arrLstCPFields[0][2][D].AddToNet&&"NetAndTax"!=this.oCMP.arrLstCPFields[0][2][D].AddToNet||(this.oCMP.arrLstOthMPFields[0].totDedAdjustments+=h);break}this.oCMP.iEmpIndex=0,this.oCMP.ExecuteAllFormulas(),this.oCMP.CalculateNet(),this.FillProcessedData()}}}}},{key:"CalculateAdjustments",value:function(){var e=this;this.dtAdjData.length>0&&function(){for(var t,a,s,n="",l=0;l<e.objAdjVM.dtAdjData.length;l++)n.length>0&&(n+=","),n+="'"+new Date(e.objAdjVM.dtAdjData[l].AdjMonth).ToString("dd MMM yyyy")+"'";for(var d=r.a.empService.GetQueryData(e.SelectedEmpID,"MPL010",n,"",""),c=0;c<e.oCMP.arrLstCPFields[0][0].length;c++)e.oCMP.arrLstCPFields[0][0][c].dAdjusted="0";for(var h=0;h<e.oCMP.arrLstCPFields[0][2].length;h++)e.oCMP.arrLstCPFields[0][2][h].dAdjusted="0";e.oCMP.arrLstOthMPFields[0].totEarAdjustments=0,e.oCMP.arrLstOthMPFields[0].totDedAdjustments=0;for(var u=r.a.empService.GetQueryData(0,"MPL014","","",""),g=r.a.empService.GetQueryData(e.SelectedEmpID,"MPL005","","",""),D=r.a.empService.GetQueryData(e.SelectedEmpID,"MPL011",r.a.SessionManager.PayrollMonth.ToString("dd MMM yyyy"),"",""),y=function(n){var l=new Date(e.objAdjVM.dtAdjData[n].AdjMonth),c=l,h=null;if(null!=(t=d.filter((function(e){return e.PayrollMonth==l.ToString("dd MMM yyyy")&&11==e.VoucherType})))&&t.length>0){var y=u.filter((function(e){return e.GradeID==t[0].dcCCNID53&&e.CPayrollDate<=c.ToString("dd MMM yyyy")})).Compute("max","CPayrollDate");h=u.filter((function(e){return e.GradeID==t[0].dcCCNID53&&e.CPayrollDate==o.e.String(y)}))}if("'"+l.ToString("dd/MMM/yyyy")+"' >= ApplyFrom AND '"+l.ToString("dd/MMM/yyyy")+"' <=EffectFrom",e.drc=g.filter((function(e){return e.dPayMonth.ToString("dd/MMM/yyyy")>=e.ApplyFrom&&l.ToString("dd/MMM/yyyy")<=e.EffectFrom})),e.drc=e.drc.sort((function(e,t){return e.EffectFrom-t.EffectFrom})),a=D.Tables[0].filter((function(e){return e.ArrearsCalcMonths==new Date(l)})),s=D.Tables[1].filter((function(e){return 1==e.DType&&e.ArrAdjMonth==new Date(l)})),null!=e.drc&&e.drc.length>0){var P=!1;if(e.sArrsCalcMonths.length>0){var C=e.sArrsCalcMonths.split(";");if(C.length>0)for(var m=0;m<C.length;m++)new Date(C[m]).ToString("dd MMM yyyy")==c.ToString("dd MMM yyyy")&&(P=!0)}null!=a&&a.length>0||P?(l=new Date(e.drc[0].EffectFrom),o.e.SetPayrollMonth(l)):o.e.SetPayrollMonth(l)}else o.e.SetPayrollMonth(l);var p=parseFloat(e.objAdjVM.dtAdjData[n].Days);"Actual Days"!=r.a.SessionManager.Preferences.PayDays?parseInt(r.a.SessionManager.Preferences.PayDays):l.DaysInMonth();var M=new T.a;if(M.oParent=e,M.sSelectedEmpSeqNos=e.SelectedEmpID.toString(),M.PayrollMonth=r.a.SessionManager.PayrollMonth,M.PayrollMonthStart=r.a.SessionManager.PayrollMonthStart,M.PayrollMonthEnd=r.a.SessionManager.PayrollMonthEnd,M.IsAdjustments=!0,M.dAdjDays=p,M.drcArrStructure=h,M.ArrGradeID=parseInt(t[0].dcCCNID53),M.ProcessPayroll(),M.IsCompleted){M.arrLstOthMPFields[0].TotalDays=parseFloat(t[0].TotalDays),M.arrLstOthMPFields[0].MonthDays=parseFloat(t[0].TotalDays),M.arrLstOthMPFields[0].PaidLeaves=parseFloat(t[0].dcAlpha24),M.arrLstOthMPFields[0].TotalLeaves=parseFloat(t[0].LeavesTaken),M.arrLstOthMPFields[0].WeeklyOffs=parseFloat(t[0].WOffs),M.arrLstOthMPFields[0].Holidays=parseFloat(t[0].Holidays);var S=parseFloat(t[0].DaysWorked.toString())+p;M.SetDaysAttended(0,"Days Attended",S);var f,E=0,F=-1,A=0,L=0,v=0;t=d.filter((function(e){return e.PayrollMonth==l.ToString("dd MMM yyyy")&&11==e.VoucherType}));for(var I=0;I<e.oCMP.arrLstCPFields[0][0].length;I++)if(o.e.IsEmpty(e.oCMP.arrLstCPFields[0][0][I].CalculateAdjustments)||"No"!=e.oCMP.arrLstCPFields[0][0][I].CalculateAdjustments)for(var b=0;b<M.arrLstCPFields[0][0].length;b++)if(e.oCMP.arrLstCPFields[0][0][I].SNo==M.arrLstCPFields[0][0][b].SNo){if(A=0,L=0,v=0,F=e.oCMP.arrLstCPFields[0][0][I].SNo,o.e.IsEmpty(t[0]["dcCalcNum"+F])||(A=parseFloat(t[0]["dcCalcNum"+F])),null!=e.oCMP.arrLstCPFields[0][0][I].ArrData&&e.oCMP.arrLstCPFields[0][0][I].ArrData.length>0&&(f=[],e.oCMP.arrLstCPFields[0][0][I].ArrData=e.oCMP.arrLstCPFields[0][0][I].ArrData.TrimEnd(","),null!=(f=e.oCMP.arrLstCPFields[0][0][I].ArrData.split(";"))&&f.length>0))for(var N=0;N<f.length;N+=2)new Date(f[N]).ToString("dd MMM yyyy")==c.ToString("dd MMM yyyy")&&(L=parseFloat(f[N+1]));null!=s&&s.length>0&&null!=s[0]["Earning"+F]&&null!=s[0]["Earning"+F]&&""!=s[0]["Earning"+F]&&(v=parseFloat(s[0]["Earning"+F])),E=r.a.SessionManager.Preferences.ContainsKey("DonotconsiderArrearwhilecalculatingAdjustmentofPF")&&Object(i.j)("True"==r.a.SessionManager.Preferences.DonotconsiderArrearwhilecalculatingAdjustmentofPF)&&"PFE"==M.arrLstCPFields[0][0][b].ComponentName?parseFloat(M.arrLstCPFields[0][0][b].dEarned)-A:parseFloat(M.arrLstCPFields[0][0][b].dEarned)-A-L-v,e.oCMP.arrLstCPFields[0][0][I].AdjData+=c.ToString("dd MMM yyyy")+","+E+",",e.oCMP.arrLstCPFields[0][0][I].dAdjusted=(parseFloat(e.oCMP.arrLstCPFields[0][0][I].dAdjusted)+E).ToString(r.a.SessionManager.sPayrollDecimals),o.e.IsEmpty(e.oCMP.arrLstCPFields[0][0][I].AddToNet)||"Net"!=e.oCMP.arrLstCPFields[0][0][I].AddToNet&&"NetAndTax"!=e.oCMP.arrLstCPFields[0][0][I].AddToNet||(e.oCMP.arrLstOthMPFields[0].totEarAdjustments+=E);break}t=d.filter((function(e){return e.PayrollMonth==c.ToString("dd MMM yyyy")&&12==e.VoucherType}));for(var O=0;O<e.oCMP.arrLstCPFields[0][2].length;O++)if(o.e.IsEmpty(e.oCMP.arrLstCPFields[0][2][O].CalculateAdjustments)||"No"!=e.oCMP.arrLstCPFields[0][2][O].CalculateAdjustments)for(var V=0;V<M.arrLstCPFields[0][2].length;V++)if(e.oCMP.arrLstCPFields[0][2][O].SNo==M.arrLstCPFields[0][2][V].SNo){if(A=0,L=0,v=0,F=e.oCMP.arrLstCPFields[0][2][O].SNo,o.e.IsEmpty(t[0]["dcCalcNum"+F])||(A=parseFloat(t[0]["dcCalcNum"+F])),null!=e.oCMP.arrLstCPFields[0][2][O].ArrData&&e.oCMP.arrLstCPFields[0][2][O].ArrData.length>0&&(f=[],e.oCMP.arrLstCPFields[0][2][O].ArrData=e.oCMP.arrLstCPFields[0][2][O].ArrData.TrimEnd(","),null!=(f=e.oCMP.arrLstCPFields[0][2][O].ArrData.split(";"))&&f.length>0))for(var w=0;w<f.length;w+=2)new Date(f[w]).ToString("dd MMM yyyy")==c.ToString("dd MMM yyyy")&&(L=parseFloat(f[w+1]));null!=s&&s.length>0&&null!=s[0]["Deduction"+F]&&null!=s[0]["Deduction"+F]&&""!=s[0]["Deduction"+F]&&(v=parseFloat(s[0]["Deduction"+F])),E=r.a.SessionManager.Preferences.ContainsKey("DonotconsiderArrearwhilecalculatingAdjustmentofPF")&&Object(i.j)("True"==r.a.SessionManager.Preferences.DonotconsiderArrearwhilecalculatingAdjustmentofPF)&&"PF"==M.arrLstCPFields[0][2][V].ComponentName?parseFloat(M.arrLstCPFields[0][2][V].dEarned)-A:parseFloat(M.arrLstCPFields[0][2][V].dEarned)-A-L-v,e.oCMP.arrLstCPFields[0][2][O].AdjData+=c.ToString("dd MMM yyyy")+","+E+",",e.oCMP.arrLstCPFields[0][2][O].dAdjusted=(parseFloat(e.oCMP.arrLstCPFields[0][2][O].dAdjusted)+E).ToString(r.a.SessionManager.sPayrollDecimals),o.e.IsEmpty(e.oCMP.arrLstCPFields[0][2][O].AddToNet)||"Net"!=e.oCMP.arrLstCPFields[0][2][O].AddToNet&&"NetAndTax"!=e.oCMP.arrLstCPFields[0][2][O].AddToNet||(e.oCMP.arrLstOthMPFields[0].totDedAdjustments+=E);break}e.oCMP.iEmpIndex=0,e.oCMP.ExecuteAllFormulas(),e.oCMP.CalculateNet(),e.FillProcessedData()}},P=0;P<e.objAdjVM.dtAdjData.length;P++)y(P)}()}},{key:"btnWorksheet_Click",value:function(){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,s,n,l,d,c,h,u,g,D,y=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Logger.InfoLog("MonthlyPayrollViewModel::Entering btnWorksheet_Click()"),0!=this.SelectedEmpID){e.next=2;break}return e.abrupt("return",(this.DisplayMessage=r.a.GetResource("SelectAnyEmployee"),this.MessageVisibility=!0,void(this.EmployeeList.SetFocus=!0)));case 2:if(!(this.oCMP.arrLstOthMPFields[0].sErrorMessage.length>0)){e.next=4;break}return e.abrupt("return",(this.DisplayMessage=this.oCMP.arrLstOthMPFields[0].sErrorMessage,void(this.MessageVisibility=!0)));case 4:return t=null,s=[],n=new Date,s.push(0),s.push(this.SelectedEmpID),s.push(r.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")),s.push(r.a.SessionManager.UserID),s.push(r.a.SessionManager.LanguageID),l=r.a.empService.ExecuteQuery_SP(s,"spPAY_PayrollWorksheetData"),e.next=9,Promise.resolve().then(a.bind(null,"1Cra"));case 9:return d=e.sent,c=d.AddEditDocumentViewModel,e.next=13,Promise.resolve().then(a.bind(null,"MCKn"));case 13:h=e.sent,u=h.AddEditDocumentComponent,null!=l&&l.Tables.length>0&&l.Tables[0].length>0?(t=new c(40079,"Attendance Dimension Wise",!0),g={value:n},t.ScreenObject.OnDocPrefixChanged("lostFocus",0,parseInt(l.Tables[0][0].DocID),g,!1),n=g.value):((t=new c(40079,"Attendance Dimension Wise",!1)).ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})).SelectedValue=this.SelectedEmpID,t.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})).Code.CodeText=this.EmployeeList.Code.Text,t.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})).Name.CodeText=this.EmployeeList.Name.Text,t.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()})).Date=r.a.SessionManager.PayrollMonth),t.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})).IsReadOnly=!0,t.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()})).IsReadOnly=!0,t.IsMPVParent=!0,t.ButtonCloseVisibility=!0,t.OKCancelVisibility=!0,t.ScreenObject.HeaderFields.forEach((function(e){e.IsReadOnly=!0,e.Enable=!1})),t.ScreenObject._CCFields.forEach((function(e){e.IsReadOnly=!0,e.Enable=!1})),t.ScreenObject._TextFields.forEach((function(e){e.IsReadOnly=!0,e.Enable=!1})),r.a.SessionManager.Preferences.ContainsKey("ShowAbsentColumn")&&Object(i.j)("False"==r.a.SessionManager.Preferences.ShowAbsentColumn)&&null!=(D=t.ScreenObject.ColumnSource.find((function(e){return"dcAlpha3"==e.DisplayMember})))&&(D.IsVisible=!1),t.strADWxml="ADWxml",t.FillGridData(this.dtWorkSheet),r.a.page.ShowDialog(t,u,{ShowCenter:!0,Title:t.Title}).subscribe((function(){if(t.DialogResult&&(y.strWorkSheetXML=t.strADWxml,r.a.SessionManager.Preferences.ContainsKey("OverwriteDaysOT")&&Object(i.j)("True"==r.a.SessionManager.Preferences.OverwriteDaysOT))){y.dtWorkSheet=t.ScreenObject.GridData,r.a.SessionManager.Preferences.ContainsKey("AddWeeklyoffs")&&Object(i.j)("True"==r.a.SessionManager.Preferences.AddWeeklyoffs)?(y.dgvDays.Table[1].Days=y.dtComputeSUM(y.dtWorkSheet,"dcAlpha2").toString(),y.oCMP.arrLstOthMPFields[0].DaysAttended=y.dtComputeSUM(y.dtWorkSheet,"dcAlpha2")):(y.dgvDays.Table[1].Days=y.dtComputeSUM(y.dtWorkSheet,"dcAlpha2")+parseFloat(y.dgvDays.Table[4].Days.toString())+parseFloat(y.dgvDays.Table[5].Days.toString()),y.oCMP.arrLstOthMPFields[0].DaysAttended=y.dtComputeSUM(y.dtWorkSheet,"dcAlpha2")+parseFloat(y.dgvDays.Table[4].Days)+parseFloat(y.dgvDays.Table[5].Days.toString()));var e=r.a.empService.GetQueryData(0,"MPL006","","","");if(null!=e&&e.length>0)for(var a=0;a<y.dgvEarOTs.Table.length;a++)if(!o.e.IsEmpty(y.dgvEarOTs.Table[a].EarSNo))for(var s=0;s<e.length;s++)if(parseInt(y.dgvEarOTs.Table[a].EarSNo)==parseInt(e[s].OTSNo)){y.dgvEarOTs.Table[a].Hours=y.dtComputeSUM(y.dtWorkSheet,e[s].SysColumnName.toString()).ToString("0.00"),y.oCMP.ReEvaluateData(0,1,parseInt(y.dgvEarOTs.Table[a].EarSNo),y.dgvEarOTs.Table[a].Hours.toString());break}y.dgvDays_EndEdit(y.dgvDays.Table[1],"Days",1)}})),Logger.InfoLog("MonthlyPayrollViewModel::Exiting btnWorksheet_Click()");case 18:case"end":return e.stop()}}),e,this)})))}},{key:"btnEmployeeFilter_Click",value:function(){this.EmployeeList.Code.CustomWhere=this.EmployeeList.Name.CustomWhere=this.PopupEmployeesFilter()}},{key:"dtComputeSUM",value:function(e,t){for(var a=0,s=0;s<e.length;s++)o.e.IsEmpty(e[s][t])||(a+=parseFloat(e[s][t].toString()));return a}},{key:"btnCustomize_Click",value:function(){}},{key:"btnArrears_Click",value:function(){var e=this;if(0!=this.SelectedEmpID)try{Logger.InfoLog("MonthlyPayrollViewModel::Entering btnArrears_Click()");var t=[];t.push(this),t.push(this.SelectedEmpID),t.push(this.dtArrData),this.objArrVM=new I(t),r.a.page.ShowDialog(this.objArrVM,b.a,{ShowCenter:!0,Title:"Arrears"}).subscribe((function(){e.objArrVM.DialogResult&&(e.dtArrData=e.objArrVM.dtArrData,e.objArrVM.strSelectedMonths.length>0)&&function(){e.sArrCalcMonthPaydays="";var t="'"+e.objArrVM.strSelectedMonths.Replace(";","','")+"'",a=r.a.empService.GetQueryData(e.SelectedEmpID,"ARE002",JSON.stringify(t),"","");if(null!=a&&a.length>0){e.drc=a.filter((function(e){return 11==e.VoucherType}));for(var s=0;s<e.drc.length;s++)e.sArrCalcMonthPaydays=e.sArrCalcMonthPaydays+e.drc[s].PaidDays.toString()+";";e.sArrCalcMonthPaydays.length>0&&(e.sArrCalcMonthPaydays=e.sArrCalcMonthPaydays.substr(0,e.sArrCalcMonthPaydays.length-1))}e.sArrsCalcMonths=e.objArrVM.strSelectedMonths;var i=e.objArrVM.strSelectedMonths.split(";");if(i.length>0){for(var n=0;n<e.oCMP.arrLstCPFields[0][0].length;n++)e.oCMP.arrLstCPFields[0][0][n].dArrear="0";for(var l=0;l<e.oCMP.arrLstCPFields[0][2].length;l++)e.oCMP.arrLstCPFields[0][2][l].dArrear="0";e.oCMP.arrLstOthMPFields[0].totEarArrears=0,e.oCMP.arrLstOthMPFields[0].totDedArrears=0;for(var d,c,h,u=r.a.empService.GetQueryData(0,"ARE003","","",""),g=r.a.empService.GetQueryData(e.SelectedEmpID,"ARE004",r.a.SessionManager.PayrollMonth.ToString("dd MMM yyyy"),"",""),D=0,y=0,P=function(t){if(null!=i[t]&&""!=i[t]&&(e.drc=a.filter((function(e){return e.PayrollMonth==i[t]})),e.drc.length>0)){var s=u.filter((function(a){return a.GradeID==e.drc[0].dcCCNID53&&a.CPayrollDate<=i[t]})).Compute("max","CPayrollDate"),n=u.filter((function(t){return t.GradeID==e.drc[0].dcCCNID53&&t.CPayrollDate==s.toString()})),l=new T.a;if(l.oParent=e,l.sSelectedEmpSeqNos=e.SelectedEmpID.toString(),l.PayrollMonth=r.a.SessionManager.PayrollMonth,l.PayrollMonthStart=r.a.SessionManager.PayrollMonthStart,l.PayrollMonthEnd=r.a.SessionManager.PayrollMonthEnd,l.drcArrStructure=n,l.IsArrearclick=!0,l.ArrGradeID=parseInt(e.drc[0].dcCCNID53),l.ProcessPayroll(),l.IsCompleted){l.arrLstOthMPFields[0].TotalDays=parseFloat(e.drc[0].TotalDays),l.arrLstOthMPFields[0].MonthDays=parseFloat(e.drc[0].TotalDays),l.arrLstOthMPFields[0].PaidLeaves=parseFloat(e.drc[0].dcAlpha24),l.arrLstOthMPFields[0].TotalLeaves=parseFloat(e.drc[0].LeavesTaken),l.arrLstOthMPFields[0].WeeklyOffs=parseFloat(e.drc[0].WOffs),l.arrLstOthMPFields[0].Holidays=parseFloat(e.drc[0].Holidays);var P=parseFloat(e.drc[0].TotalDays.toString())-parseFloat(e.drc[0].LOPDays.toString())-parseFloat(e.drc[0].LeavesTaken.toString())-parseFloat(e.drc[0].UnpaidDays.toString());if(null!=(d=g.Tables[0].filter((function(e){return e.AdjMonth==new Date(i[t])})))&&d.length>0&&(P+=parseFloat(d[0].Days)),c=g.Tables[1].filter((function(e){return 2==e.DType&&e.ArrAdjMonth==new Date(i[t])})),e.dtAdjData.length>0)for(var C=0;C<e.dtAdjData.length;C++)new Date(e.dtAdjData[C].AdjMonth).ToString("dd MMM yyyy")==new Date(i[t]).ToString("dd MMM yyyy")&&parseFloat(e.dtAdjData[C].Days)>0&&(P+=parseFloat(e.dtAdjData[C].Days));l.SetDaysAttended(0,"Days Attended",P);var m=0,p=-1,M=0;e.drc=a.filter((function(e){return e.PayrollMonth==i[t]&&11==e.VoucherType}));for(var S=0;S<e.oCMP.arrLstCPFields[0][0].length;S++)if(o.e.IsEmpty(e.oCMP.arrLstCPFields[0][0][S].CalculateArrears)||"No"!=e.oCMP.arrLstCPFields[0][0][S].CalculateArrears)for(var f=0;f<l.arrLstCPFields[0][0].length;f++)if(e.oCMP.arrLstCPFields[0][0][S].SNo==l.arrLstCPFields[0][0][f].SNo){if(M=0,D=0,y=0,p=e.oCMP.arrLstCPFields[0][0][S].SNo,o.e.IsEmpty(e.drc[0]["dcCalcNum"+p])||(M=parseFloat(e.drc[0]["dcCalcNum"+p])),null!=e.oCMP.arrLstCPFields[0][0][S].AdjData&&e.oCMP.arrLstCPFields[0][0][S].AdjData.length>0&&(h=[],e.oCMP.arrLstCPFields[0][0][S].AdjData=e.oCMP.arrLstCPFields[0][0][S].AdjData.TrimEnd(","),null!=(h=e.oCMP.arrLstCPFields[0][0][S].AdjData.split(";"))&&h.length>0))for(var E=0;E<h.length;E+=2)new Date(h[E]).ToString("dd MMM yyyy")==new Date(i[t]).ToString("dd MMM yyyy")&&(D=parseFloat(h[E+1]));null!=c&&c.length>0&&null!=c[0]["Earning"+p]&&null!=c[0]["Earning"+p]&&""!=c[0]["Earning"+p].toString()&&(y=parseFloat(c[0]["Earning"+p])),m=parseFloat(l.arrLstCPFields[0][0][f].dEarned)-M-D-y,e.oCMP.arrLstCPFields[0][0][S].ArrData+=i[t]+","+m+",",e.oCMP.arrLstCPFields[0][0][S].dArrear=(parseFloat(e.oCMP.arrLstCPFields[0][0][S].dArrear)+m).ToString(r.a.SessionManager.sPayrollDecimals),e.oCMP.arrLstCPFields[0][0][S].isArrCalculated=!0,null==e.oCMP.arrLstCPFields[0][0][S].AddToNet||""==e.oCMP.arrLstCPFields[0][0][S].AddToNet||"Net"!=e.oCMP.arrLstCPFields[0][0][S].AddToNet&&"NetAndTax"!=e.oCMP.arrLstCPFields[0][0][S].AddToNet||(e.oCMP.arrLstOthMPFields[0].totEarArrears+=m);break}e.drc=a.filter((function(e){return e.PayrollMonth==i[t]&&12==e.VoucherType}));for(var F=0;F<e.oCMP.arrLstCPFields[0][2].length;F++)if(o.e.IsEmpty(e.oCMP.arrLstCPFields[0][2][F].CalculateArrears)||"No"!=e.oCMP.arrLstCPFields[0][2][F].CalculateArrears)for(var A=0;A<l.arrLstCPFields[0][2].length;A++)if(e.oCMP.arrLstCPFields[0][2][F].SNo==l.arrLstCPFields[0][2][A].SNo){if(M=0,D=0,y=0,p=e.oCMP.arrLstCPFields[0][2][F].SNo,o.e.IsEmpty(e.drc[0]["dcCalcNum"+p])||(M=parseFloat(e.drc[0]["dcCalcNum"+p])),null!=e.oCMP.arrLstCPFields[0][2][F].AdjData&&e.oCMP.arrLstCPFields[0][2][F].AdjData.length>0&&(h=[],e.oCMP.arrLstCPFields[0][2][F].AdjData=e.oCMP.arrLstCPFields[0][2][F].AdjData.TrimEnd(","),null!=(h=e.oCMP.arrLstCPFields[0][2][F].AdjData.split(";"))&&h.length>0))for(var L=0;L<h.length;L+=2)new Date(h[L]).ToString("dd MMM yyyy")==new Date(i[t]).ToString("dd MMM yyyy")&&(D=parseFloat(h[L+1]));null!=c&&c.length>0&&null!=c[0]["Deduction"+p]&&null!=c[0]["Deduction"+p]&&""!=c[0]["Deduction"+p].toString()&&(y=parseFloat(c[0]["Deduction"+p])),m=parseFloat(l.arrLstCPFields[0][2][A].dEarned)-M-D-y,e.oCMP.arrLstCPFields[0][2][F].dArrear=(parseFloat(e.oCMP.arrLstCPFields[0][2][F].dArrear)+m).ToString(r.a.SessionManager.sPayrollDecimals),e.oCMP.arrLstCPFields[0][2][F].isArrCalculated=!0,null==e.oCMP.arrLstCPFields[0][2][F].AddToNet||""==e.oCMP.arrLstCPFields[0][2][F].AddToNet||"Net"!=e.oCMP.arrLstCPFields[0][2][F].AddToNet&&"NetAndTax"!=e.oCMP.arrLstCPFields[0][2][F].AddToNet||(e.oCMP.arrLstOthMPFields[0].totDedArrears+=m);break}}l.IsArrearclick=!1}},C=0;C<i.length;C++)P(C);e.oCMP.iEmpIndex=0,e.oCMP.ExecuteAllFormulas(),e.oCMP.CalculateNet(),e.FillProcessedData()}}()})),Logger.InfoLog("MonthlyPayrollViewModel::Exiting btnArrears_Click()")}catch(a){Logger.ErrorLog("MonthlyPayrollViewModel::EXCEPTION btnArrears_Click()\r\n"+a.Message+"\r\n"+a.stack)}else this.DisplayMessage=r.a.GetResource("SelectAnyEmployee"),this.MessageVisibility=!0,this.EmployeeList.SetFocus=!0}},{key:"btnSubmit_Click",value:function(){}},{key:"btnApprove_Click",value:function(){var e=new N.a(40054,this.DocID,null,this);r.a.page.ShowDialog(e,O.a,{ShowCenter:!0,Title:r.a.GetResource("ApproveReject")})}},{key:"btnUnPost_Click",value:function(){if(this.SelectedEmpID>0&&this.DocID>0){var e=[];e.push(this.CostCenterID),e.push(this.DocID),e.push(1);var t=r.a.document.DeleteSelectedRows(e,0);this.DisplayMessage=t.Message,this.savestatusvalue=t.RetValue,this.MessageVisibility=!0}this.btnClear_Click()}},{key:"btnClear_Click",value:function(){this.ClearControls(),this.EmployeeList.SelectedValue=0,this.SelectedEmpID=0,this.WFDocLevelList.Clear(),this.ApproveVisibility=!1}},{key:"btnPost_Click",value:function(){var e=this;try{if(Logger.InfoLog("MonthlyPayrollViewModel::Entering btnPost_Click()"),this.ValidatePosting()){var t=0,a=[];a.push(this.CostCenterID),a.push(this.DocID),a.push(r.a.SessionManager.PayrollMonth.ToString("MMM'/'yyyy")+"-"),a.push(this.DocNo),a.push((new Date).ToString("dd/MMM/yyyy")),a.push(r.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")),a.push(""),a.push(this.GetDocumentXML()),a.push(""),a.push(""),a.push(""),a.push(this.GetActivityXML()),a.push("false"),r.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==r.a.SessionManager.Preferences.EnableLocationWise.toString()?a.push(r.a.SessionManager.LocationID>0?r.a.SessionManager.LocationID:1):a.push(0),r.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==r.a.SessionManager.Preferences.EnableDivisionWise.toString()?a.push(r.a.SessionManager.DivisionID>0?r.a.SessionManager.DivisionID:1):a.push(0),a.push(this.oCMP.arrLstOthMPFields[0].WID),a.push(r.a.SessionManager.RoleID),a.push(""),a.push(0),a.push(0),a.push(r.a.SessionManager.CompanyGUID),a.push(r.a.SessionManager.UserName),a.push(r.a.SessionManager.UserID),a.push(r.a.SessionManager.LanguageID),a.push(r.a.SessionManager.IsOffline);var s="";r.a.document.SetTempInvDocument(a).subscribe((function(a){t=a.obj;var o=a;e.savestatusvalue=t,s=null!=o&&o.Tables.length>0&&o.Tables[o.Tables.length-1].length>0&&o.Columns[o.Tables.length-1].Contains("ErrorMessage")?o.Tables[o.Tables.length-1][0].ErrorMessage.toString():"Problem in processing your request,Please contact administrator.",t>0?(null!=o&&o.Tables.length>0&&o.Tables[o.Tables.length-1].length>0&&o.Columns[o.Tables.length-1].Contains("VoucherNo")&&(e.VoucherNo=o.Tables[o.Tables.length-1][0].VoucherNo.toString()),"UnProcessed"!=e.sProcessType&&"NoticePay"!=e.sProcessType||(e.dFS_NetSal=parseFloat(e.NetSalary.Text),e.dFS_DaysAttended=parseFloat(e.dgvDays.Table[1][2].toString()),e.dFS_LOPDays=parseFloat(e.dgvDays.Table[6][2].toString()),e.DialogResult=!0,r.a.page.HideDialog()),e.btnClear_Click()):null!=o&&o.Tables.length>0&&o.Tables[o.Tables.length-1].length>0&&o.Columns[o.Tables.length-1].Contains("ServerMessage")&&(t="-407"==o.Tables[o.Tables.length-1][0].ServerMessage.toString()?-407:-12345),e.DisplayMessage=s,e.MessageVisibility=!0}))}Logger.InfoLog("MonthlyPayrollViewModel::Exiting btnPost_Click()")}catch(o){Logger.ErrorLog("MonthlyPayrollViewModel::EXCEPTION btnPost_Click()\r\n"+o.Message+"\r\n"+o.stack)}}},{key:"SetDocStatus",value:function(e,t,a,s,o,i,n){Logger.InfoLog("MonthyPayrolViewModel:: Inside SetDocStatus");var l=[];l.push(e),l.push(null!=o?o:""),l.push(s.ToString("dd/MMM/yyyy")),l.push(!0),l.push(this.DocID),l.push(this.CostCenterID),l.push(t),l.push(a),l.push(i),l.push(n),l.push(r.a.SessionManager.CompanyGUID),l.push(r.a.SessionManager.UserName),l.push(r.a.SessionManager.UserID),l.push(r.a.SessionManager.RoleID),l.push(r.a.SessionManager.LanguageID);var d=r.a.document.SetDocStatus(l);return Logger.InfoLog("MonthyPayrolViewModel:: Exiting SetDocStatus"),d}},{key:"GetActivityXML",value:function(){var e,t=this,a="",s="",i="";if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[0].drcPayProcessed.length>0)for(var n=0;n<this.oCMP.arrLstOthMPFields[0].drcPayProcessed.length;n++)a+="~"+this.oCMP.arrLstOthMPFields[0].drcPayProcessed[n].InvDocDetailsID.toString();var l="";if(l+=this.oCMP.arrLstOthMPFields[0].IsAlreadyProcessed?a.length>0?'<XML DetailIds="'+a+'" AppRejDate="'+(new Date).ToString("dd/MMM/yyyy")+'" >':'<XML AppRejDate="'+(new Date).ToString("dd/MMM/yyyy")+'" >':a.length>0?'<XML DetailIds="'+a+'" >':"<XML >",this.dgvLoans.Table.length>0&&null!=this.dgvLoans.Tag&&parseInt(this.dgvLoans.Tag)>0&&function(){var a,n,d,c,h,u,g="0";if(s=i="",null!=t.oCMP.arrLstOthMPFields[0].drcLoanRepay&&t.oCMP.arrLstOthMPFields[0].drcLoanRepay.length>0&&(g=t.oCMP.arrLstOthMPFields[0].drcLoanRepay[0].DocID.toString()),l+='<LoanRepaymentXML DocID="'+g+'" DocDetIDs="" WorkFlowID="0" >',l+="<DOCXML>",t.dgvLoans.Table.length>0){var D=0;null!=r.a.SessionManager.dtDocDefAccs&&(null!=(e=r.a.SessionManager.dtDocDefAccs.filter((function(e){return 40057==e.CostCenterID&&"CreditAccount"==e.SysColumnName})))&&e.length>0&&null!=e[0].UserDefaultValue&&""!=e[0].UserDefaultValue.toString().Trim()&&(s=e[0].UserDefaultValue.toString()),null!=(e=r.a.SessionManager.dtDocDefAccs.filter((function(e){return 40057==e.CostCenterID&&"DebitAccount"==e.SysColumnName})))&&e.length>0&&null!=e[0].UserDefaultValue&&""!=e[0].UserDefaultValue.toString().Trim()&&(i=e[0].UserDefaultValue.toString()));for(var y=0;y<t.dgvLoans.Table.length;y++)o.e.IsEmpty(t.dgvLoans.Table[y].LoanSNo)||"1"!=t.dgvLoans.Table[y].IsVisible.toString()||o.e.IsEmpty(t.dgvLoans.Table[y].InstAmt)||function(){a=t.dgvLoans.Table[y].LoanDocNo.toString(),d=t.dgvLoans.Table[y].ActInstNo.toString(),h=3==parseInt(t.dgvLoans.Table[y].PayStatus)?t.dgvLoans.Table[y].ActInstAmt.toString().Replace(",",""):t.dgvLoans.Table[y].InstAmt.toString().Replace(",","");var e=parseInt(d);t.oCMP.arrLstOthMPFields[0].IsAlreadyProcessed?(t.drc=t.oCMP.arrLstOthMPFields[0].dsAllEmpsData.Tables[11].filter((function(e){return e.EmpSeqNo==t.SelectedEmpID&&e.RefNo==a&&e.dcAlpha5==r.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")})),null!=t.drc&&t.drc.length>0&&(e=parseInt(t.drc[0].dcNum1))):(t.drc=r.a.SessionManager.Preferences.ContainsKey("ShowLoanBalRespDedMonthWhilePayProc")&&"True"==r.a.SessionManager.Preferences.ShowLoanBalRespDedMonthWhilePayProc?t.oCMP.arrLstOthMPFields[0].dsAllEmpsData.Tables[10].filter((function(s){return s.EmpSeqNo==t.SelectedEmpID&&s.DocNo==a&&s.InstallmentNo==e&&s.InstallmentNo==e})):t.oCMP.arrLstOthMPFields[0].dsAllEmpsData.Tables[10].filter((function(s){return s.EmpSeqNo==t.SelectedEmpID&&s.DocNo==a&&s.InstBalance>0&&s.InstallmentNo<e&&s.InstallmentNo<e})),null!=t.drc&&t.drc.length>0&&(e=parseInt(t.drc[0].InstallmentNo)));var o=parseFloat(h),g=0,P=0;do{if(D++,null==(u=t.oCMP.arrLstOthMPFields[0].dsAllEmpsData.Tables[10].filter((function(s){return s.EmpSeqNo==t.SelectedEmpID&&s.DocNo==a&&s.InstallmentNo==e})))||0==u.length)break;n=u[0].InvDocDetailsID.toString(),c=u[0].InstallmentAmt.toString().Replace(",",""),g=o>parseFloat(parseFloat(u[0].InstBalance).ToString(r.a.SessionManager.sPayrollDecimals))?parseFloat(parseFloat(u[0].InstBalance).ToString(r.a.SessionManager.sPayrollDecimals)):o,l+="<RowHead/>",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="'+D+'"  DocDetailsID="0" LinkedInvDocDetailsID="'+n+'" LinkedFieldName="dcNum3" LineNarration="',l+='" ProductID="'+t.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1',l+='" Rate="0" Gross="0" RefNO="'+a+'" LinkedFieldValue="'+g+'" IsQtyIgnored="1" AverageRate="0',l+='" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+i+'"  CreditAccount="'+s+'"  ></Transaction>',l+='<Numeric Query="dcNum1='+e+", dcCalcNum1="+e+", dcNum2="+c.Replace(",","")+", dcCalcNum2="+c.Replace(",","")+", dcNum3="+g.toString().Replace(",","")+", dcCalcNum3="+g.toString().Replace(",","")+', " ></Numeric>',l+="<Alpha Query=\"dcAlpha1=N'"+t.dgvLoans.Table[y].ApprovedAmt.toString()+"',dcAlpha2=N'"+(parseFloat(t.dgvLoans.Table[y].BalAmt)-P)+"', dcAlpha3=N'"+h+"', dcAlpha4=N'"+new Date(u[0].DeductionMonth).ToString("dd/MMM/yyyy")+"', dcAlpha5=N'"+r.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"',dcAlpha6=N'1',dcAlpha7=N'"+t.dgvLoans.Table[y].PayStatus.toString()+"', \" ></Alpha>",l+='<CostCenters Query="dcCCNID51='+t.SelectedEmpID+", dcCCNID52="+t.dgvLoans.Table[y].ComponentID.toString()+', " ></CostCenters>',l+="<EXTRAXML></EXTRAXML>",l+="</Row>",P+=g,o-=g,e++,u[0].Flag=1}while(o>0);e=1;do{if(D++,null==(u=t.oCMP.arrLstOthMPFields[0].dsAllEmpsData.Tables[10].filter((function(s){return s.EmpSeqNo==t.SelectedEmpID&&s.DocNo==a&&s.InstallmentNo==e&&0==s.Flag&&s.InstBalance>0})))||0==u.length)break;n=u[0].InvDocDetailsID.toString(),c=u[0].InstallmentAmt.toString().Replace(",",""),g=o>parseFloat(parseFloat(u[0].InstBalance).ToString(r.a.SessionManager.sPayrollDecimals))?parseFloat(parseFloat(u[0].InstBalance).ToString(r.a.SessionManager.sPayrollDecimals)):o,l+="<RowHead/>",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="'+D+'"  DocDetailsID="0" LinkedInvDocDetailsID="'+n+'" LinkedFieldName="dcNum3" LineNarration="',l+='" ProductID="'+t.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1',l+='" Rate="0" Gross="0" RefNO="'+a+'" LinkedFieldValue="'+g+'" IsQtyIgnored="1" AverageRate="0',l+='" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+i+'"  CreditAccount="'+s+'"  ></Transaction>',l+='<Numeric Query="dcNum1='+e+", dcCalcNum1="+e+", dcNum2="+c.Replace(",","")+", dcCalcNum2="+c.Replace(",","")+", dcNum3="+g.toString().Replace(",","")+", dcCalcNum3="+g.toString().Replace(",","")+', " ></Numeric>',l+="<Alpha Query=\"dcAlpha1=N'"+t.dgvLoans.Table[y].ApprovedAmt.toString()+"',dcAlpha2=N'"+(parseFloat(t.dgvLoans.Table[y].BalAmt)-P)+"', dcAlpha3=N'"+h+"', dcAlpha4=N'"+new Date(u[0].DeductionMonth).ToString("dd/MMM/yyyy")+"', dcAlpha5=N'"+r.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"',dcAlpha6=N'1',dcAlpha7=N'"+t.dgvLoans.Table[y].PayStatus.toString()+"', \" ></Alpha>",l+='<CostCenters Query="dcCCNID51='+t.SelectedEmpID+", dcCCNID52="+t.dgvLoans.Table[y].ComponentID.toString()+', " ></CostCenters>',l+="<EXTRAXML></EXTRAXML>",l+="</Row>",P+=g,o-=g,e++,u[0].Flag=1}while(o>0)}()}l+="</DOCXML>",l+="<BillXML></BillXML></LoanRepaymentXML>"}(),this.sArrsCalcMonths.length>0){var d=this.sArrsCalcMonths.split(";"),c=this.sArrCalcMonthPaydays.split(";");if(d.length>0){l+="<ArrearsXML>",l+="<Rows>";for(var h=0;h<d.length;h++)l+='<Row PayrollMonth="'+r.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),l+='" EmpSeqNo="'+this.SelectedEmpID,l+='" ArrearsCalcMonths="'+new Date(d[h]).ToString("dd/MMM/yyyy"),l+='" ArrCalcMonthPayDays="'+c[h].toString(),l+='" ArrearsCalcDays="',l+='" />';l+="</Rows>",l+="</ArrearsXML>"}}if(this.dtAdjData.length>0){l+="<AdjustmentsXML>",l+="<Rows>";for(var u=0;u<this.dtAdjData.length;u++)l+='<Row PayrollMonth="'+r.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),l+='" EmpSeqNo="'+this.SelectedEmpID,l+='" AdjMonth="'+this.dtAdjData[u].AdjMonth.toString(),l+='" Days="'+this.dtAdjData[u].Days.toString(),l+='" Remarks="'+this.dtAdjData[u].Remarks.toStri,l+='" />';l+="</Rows>",l+="</AdjustmentsXML >"}if(null!=this.dtDSData&&this.dtDSData.length>0){var g=-1;l+="<DuesXML>",l+="<Rows>";for(var D=0;D<this.dtDSData.length;D++)g="Earning"==this.dtDSData[D].FieldType.toString()?2:3,l+='<Row FieldType="'+g,l+='" EmpSeqNo="'+this.SelectedEmpID,l+='" PayrollMonth="'+r.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),l+='" ComponentID="'+this.dtDSData[D].ComponentID.toString(),l+='" DuesPaidMonth="'+this.dtDSData[D].PayrollMonth.toString(),l+='" Amount="'+this.dtDSData[D].Amount.toString(),l+='" />';l+="</Rows>",l+="</DuesXML>"}if(this.oCMP.arrLstOthMPFields[0].drcLoanCrNetSalLessZero.length>0&&(l+='<DelLoanXML DocID="'+this.oCMP.arrLstOthMPFields[0].drcLoanCrNetSalLessZero[0].DocID.toString()+'" > </DelLoanXML>'),s=i="",parseFloat(this.NetSalary.Text)<0&&"True"==r.a.SessionManager.Preferences.CreateLoanIfNetSalLessThanZero&&parseInt(r.a.SessionManager.Preferences.CreateLoanType)>0&&(null!=r.a.SessionManager.dtDocDefAccs&&(null!=(e=r.a.SessionManager.dtDocDefAccs.filter((function(e){return 40056==e.CostCenterID&&"CreditAccount"==e.SysColumnName})))&&e.length>0&&null!=e[0].UserDefaultValue&&""!=e[0].UserDefaultValue.toString().Trim()&&(s=e[0].UserDefaultValue.toString()),null!=(e=r.a.SessionManager.dtDocDefAccs.filter((function(e){return 40056==e.CostCenterID&&"DebitAccount"==e.SysColumnName})))&&e.length>0&&null!=e[0].UserDefaultValue&&""!=e[0].UserDefaultValue.toString().Trim()&&(i=e[0].UserDefaultValue.toString())),l+='<CreateLoanXML DocID="" DocDetIDs="" WorkFlowID="0" >',l+="<DOCXML>",l+="<RowHead/>",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="1"  DocDetailsID="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="" CommonNarration="LOAN CREATED FROM MONTHLY PAYROLL WHEN NET SALARY LESS THAN 0',l+='" ProductID="'+this.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1',l+='" Rate="0" Gross="0" RefNO="0" IsQtyIgnored="1" AverageRate="0',l+='" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+i+'"  CreditAccount="'+s+'"  ></Transaction>',l+='<Numeric Query="dcNum1=1, dcCalcNum1=1, dcNum2='+Math.abs(parseFloat(this.NetSalary.Text))+", dcCalcNum2="+Math.abs(parseFloat(this.NetSalary.Text))+', " ></Numeric>',l+="<Alpha Query=\"dcAlpha6=N'"+r.a.SessionManager.PayrollMonth.AddMonths(1).ToString("dd/MMM/yyyy")+"',dcAlpha1=N'"+Math.abs(parseFloat(this.NetSalary.Text))+"', dcAlpha2=N'"+Math.abs(parseFloat(this.NetSalary.Text))+"', dcAlpha4=N'1', dcAlpha3=N'"+Math.abs(parseFloat(this.NetSalary.Text))+"',dcAlpha5=N'"+r.a.SessionManager.PayrollMonth.AddMonths(1).ToString("dd/MMM/yyyy")+"',dcAlpha7=N'"+r.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"', \" ></Alpha>",l+='<CostCenters Query="dcCCNID51='+this.SelectedEmpID+", dcCCNID52="+r.a.SessionManager.Preferences.CreateLoanType+', " ></CostCenters>',l+="<EXTRAXML></EXTRAXML>",l+="</Row>",l+="</DOCXML>",l+="<BillXML></BillXML></CreateLoanXML>"),null!=this.strWorkSheetXML&&this.strWorkSheetXML.length>0&&(l+=this.strWorkSheetXML),this.oCMP.arrLstCPFields[0][0].length>0&&this.dtArrData.length>0){var y="";y+="    DELETE FROM PAY_EmpMonthlyArrAdjDetails WHERE EmpSeqNo="+this.SelectedEmpID+" AND DType=1 AND PayrollMonth='"+r.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"'";for(var P=0;P<this.dtArrData.length;P++){var C="",m="";y+="  INSERT INTO PAY_EmpMonthlyArrAdjDetails(EmpSeqNo,PayrollMonth,ArrAdjMonth,DType",C+="VALUES("+this.SelectedEmpID+",'"+r.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"','"+this.dtArrData[P].PayrollMonth.toString()+"',1";for(var p=0;p<this.oCMP.arrLstCPFields[0][0].length;p++){var M="";if(null!=this.oCMP.arrLstCPFields[0][0][p].ArrData&&this.oCMP.arrLstCPFields[0][0][p].ArrData.length>0){var S;if(this.oCMP.arrLstCPFields[0][0][p].ArrData=this.oCMP.arrLstCPFields[0][0][p].ArrData.TrimEnd(","),null!=(S=this.oCMP.arrLstCPFields[0][0][p].ArrData.split(";"))&&S.length>0)for(var f=0;f<S.length;f+=2)new Date(S[f]).ToString("dd MMM yyyy")==new Date(this.dtArrData[P].PayrollMonth).ToString("dd MMM yyyy")&&(M=S[f+1])}m+=",Earning"+this.oCMP.arrLstCPFields[0][0][p].SNo,C+=null!=M&&""!=M?","+M:",0"}for(var E=0;E<this.oCMP.arrLstCPFields[0][2].length;E++){var F="";if(null!=this.oCMP.arrLstCPFields[0][2][E].ArrData&&this.oCMP.arrLstCPFields[0][2][E].ArrData.length>0){var T;if(this.oCMP.arrLstCPFields[0][2][E].ArrData=this.oCMP.arrLstCPFields[0][2][E].ArrData.TrimEnd(","),null!=(T=this.oCMP.arrLstCPFields[0][2][E].ArrData.split(";"))&&T.length>0)for(var A=0;A<T.length;A+=2)new Date(T[A]).ToString("dd MMM yyyy")==new Date(this.dtArrData[P].PayrollMonth).ToString("dd MMM yyyy")&&(F=T[A+1])}m+=",Deduction"+this.oCMP.arrLstCPFields[0][2][E].SNo,C+=null!=F&&""!=F?","+F:",0"}y+=m+")",y+=C+")"}l+='<ArrearsDetailXML Query="'+y+'"></ArrearsDetailXML>'}if(this.dtAdjData.length>0){var L="";L+="    DELETE FROM PAY_EmpMonthlyArrAdjDetails WHERE EmpSeqNo="+this.SelectedEmpID+" AND DType=2 AND PayrollMonth='"+r.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"'";for(var v=0;v<this.dtAdjData.length;v++){var I="",b="";L+="  INSERT INTO PAY_EmpMonthlyArrAdjDetails(EmpSeqNo,PayrollMonth,ArrAdjMonth,DType",I+="VALUES("+this.SelectedEmpID+",'"+r.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"','"+this.dtAdjData[v].AdjMonth.toString()+"',2";for(var N=0;N<this.oCMP.arrLstCPFields[0][0].length;N++){var O="";if(null!=this.oCMP.arrLstCPFields[0][0][N].AdjData&&this.oCMP.arrLstCPFields[0][0][N].AdjData.length>0){var V;if(this.oCMP.arrLstCPFields[0][0][N].AdjData=this.oCMP.arrLstCPFields[0][0][N].AdjData.TrimEnd(","),null!=(V=this.oCMP.arrLstCPFields[0][0][N].AdjData.split(";"))&&V.length>0)for(var w=0;w<V.length;w+=2)new Date(V[w]).ToString("dd MMM yyyy")==new Date(this.dtAdjData[v].AdjMonth).ToString("dd MMM yyyy")&&(O=V[w+1])}b+=",Earning"+this.oCMP.arrLstCPFields[0][0][N].SNo,I+=null!=O&&""!=O?","+O:",0"}for(var R=0;R<this.oCMP.arrLstCPFields[0][2].length;R++){var x="";if(null!=this.oCMP.arrLstCPFields[0][2][R].AdjData&&this.oCMP.arrLstCPFields[0][2][R].AdjData.length>0){var k;if(this.oCMP.arrLstCPFields[0][2][R].AdjData=this.oCMP.arrLstCPFields[0][2][R].AdjData.TrimEnd(","),null!=(k=this.oCMP.arrLstCPFields[0][2][R].AdjData.split(";"))&&k.length>0)for(var W=0;W<k.length;W+=2)new Date(k[W]).ToString("dd MMM yyyy")==new Date(this.dtAdjData[v].AdjMonth).ToString("dd MMM yyyy")&&(x=k[W+1])}b+=",Deduction"+this.oCMP.arrLstCPFields[0][2][R].SNo,I+=null!=x&&""!=x?","+x:",0"}L+=b+")",L+=I+")"}l+='<AdjustmentsDetailXML Query="'+L+'"></AdjustmentsDetailXML>'}return(l+="</XML>").toString()}},{key:"GetDocumentXML",value:function(){var e,t,a=this,s="",i="",n="",l="",d="",c="",h="",u=new Array,g=" dcAlpha1='"+parseFloat(this.sBasicMonthly)+"',dcAlpha3='"+parseFloat(this.NetSalary.Text)+"',dcAlpha4='"+this.dgvDays.Table[0].Days.toString()+"',dcAlpha5='"+this.dgvDays.Table[1].Days.toString()+"',dcAlpha6='"+this.dgvDays.Table[3].Days.toString()+"',dcAlpha7='"+this.dgvDays.Table[4].Days.toString()+"',dcAlpha8='"+this.dgvDays.Table[5].Days.toString()+"',dcAlpha9='"+this.dgvDays.Table[6].Days.toString()+"',dcAlpha10='"+this.dgvDays.Table[7].Days.toString()+"', dcAlpha11='"+(parseFloat(this.dgvEarnings.Columns[3].footer)+parseFloat(this.dgvEarOTs.Columns[2].footer))+"',dcAlpha12='"+parseFloat(this.dgvDeductions.Columns[3].footer+parseFloat(this.dgvLoans.Columns[4].footer))+"',dcAlpha13='0' ";if(null!=this.HeaderFields&&this.HeaderFields.length>0)for(var D=0;D<this.HeaderFields.length;D++)"dcAlpha14"==this.HeaderFields[D].DBColumnName.toString()&&(h=this.GetControlValue(this.HeaderFields[D]));if(r.a.SessionManager.Preferences.ContainsKey("ShowPaymentModeselectionWhilePayrollProcessing")&&"True"==r.a.SessionManager.Preferences.ShowPaymentModeselectionWhilePayrollProcessing&&"Default"!=h?(g+=",dcAlpha14='"+h+"'",g+="Bank Transfer"==h?",dcAlpha15='"+this.oCMP.arrLstOthMPFields[0].drcAllEmpsData[0].iBank.toString()+"',dcAlpha16='"+this.oCMP.arrLstOthMPFields[0].drcAllEmpsData[0].BankAccNo.toString()+"'":",dcAlpha15='',dcAlpha16=''"):(g+=",dcAlpha14='"+this.oCMP.arrLstOthMPFields[0].drcAllEmpsData[0].PaymentMode.toString()+"'","Bank Transfer"==this.oCMP.arrLstOthMPFields[0].drcAllEmpsData[0].PaymentMode.toString()?g+=",dcAlpha15='"+this.oCMP.arrLstOthMPFields[0].drcAllEmpsData[0].iBank.toString()+"',dcAlpha16='"+this.oCMP.arrLstOthMPFields[0].drcAllEmpsData[0].BankAccNo.toString()+"'":g+=",dcAlpha15='',dcAlpha16=''"),g+=",dcAlpha17='"+r.a.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")+"',dcAlpha18='"+r.a.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")+"',  dcAlpha19='"+parseFloat(this.dgvEarOTs.Columns[1].footer)+"',dcAlpha20='"+parseFloat(this.dgvEarOTs.Columns[2].footer)+"',    dcAlpha21='"+this.sArrsCalcMonths+"',dcAlpha22='"+this.sArrCalcMonthPaydays+"' ",g+=",dcAlpha23='"+this.sProcessType+"' ",g+=",dcAlpha24='"+this.dgvDays.Table[2].Days.toString()+"' ",g+=",dcAlpha25='"+parseFloat(this.dgvEarnings.Columns[2].footer)+"' ",g+=",dcAlpha26='"+parseFloat(this.dgvEarnings.Columns[4].footer)+"' ",g+=",dcAlpha27='"+parseFloat(this.dgvEarnings.Columns[5].footer)+"' ",g+=",dcAlpha28='"+parseFloat(this.dgvDeductions.Columns[2].footer)+"' ",g+=",dcAlpha29='"+parseFloat(this.dgvDeductions.Columns[4].footer)+"' ",g+=",dcAlpha30='"+parseFloat(this.dgvDeductions.Columns[5].footer)+"' ",g+=",dcAlpha31='"+parseFloat(this.dgvLoans.Columns[4].footer)+"' ",g+=",dcAlpha32='"+this.sAdjsCalcMonths+"',dcAlpha33='"+this.sAdjCalcMonthPaydays+"' ",r.a.SessionManager.Preferences.ContainsKey("ShowPaymentModeselectionWhilePayrollProcessing")&&"True"==r.a.SessionManager.Preferences.ShowPaymentModeselectionWhilePayrollProcessing&&"Default"!=h?g+="Bank Transfer"==h?",dcAlpha34='"+this.oCMP.arrLstOthMPFields[0].drcAllEmpsData[0].IBANNo.toString()+"'":",dcAlpha34=''":"Bank Transfer"==this.oCMP.arrLstOthMPFields[0].drcAllEmpsData[0].PaymentMode.toString()?g+=",dcAlpha34='"+this.oCMP.arrLstOthMPFields[0].drcAllEmpsData[0].IBANNo.toString()+"'":g+=",dcAlpha34=''",n+='<Alpha Query="',n+=g,null!=this.HeaderFields&&this.HeaderFields.length>0)for(var y=0;y<this.HeaderFields.length;y++)if(this.HeaderFields[y].DBColumnName.startsWith("dcAlpha")){if("dcAlpha14"==this.HeaderFields[y].DBColumnName.toString())continue;d+=" "+this.HeaderFields[y].DBColumnName+"='"+o.e.EncodeXML(this.GetControlValue(this.HeaderFields[y]))+"',"}if(this.CustomTab.Pages.length>this.iStaticTabCnt)for(var P=this.iStaticTabCnt;P<this.CustomTab.Pages.length;P++)for(var C=0;C<this.CustomTab.Pages[P].Fields.length;C++)this.CustomTab.Pages[P].Fields[C].DBColumnName.startsWith("dcAlpha")&&(d+=" "+this.CustomTab.Pages[P].Fields[C].DBColumnName+"='"+o.e.EncodeXML(this.GetControlValue(this.CustomTab.Pages[P].Fields[C]))+"',");n+=",",d.length>0&&(n+=d),n+='" ></Alpha>',d="",l+='<CostCenters Query="',d+=" dcCCNID51="+this.SelectedEmpID+",",d+=" dcCCNID53="+this.oCMP.arrLstOthMPFields[0].GradeID+",",""==o.e.String(this.oCMP.arrLstOthMPFields[0].drcAllEmpsData[0].iBank)||"0"==o.e.String(this.oCMP.arrLstOthMPFields[0].drcAllEmpsData[0].iBank)||"Cash"==o.e.String(this.oCMP.arrLstOthMPFields[0].drcAllEmpsData[0].PaymentMode)?d+=" dcCCNID68=1,":d+=" dcCCNID68="+this.oCMP.arrLstOthMPFields[0].drcAllEmpsData[0].iBank.toString()+",",u.push("dcCCNID51"),u.push("dcCCNID53"),u.push("dcCCNID68");var m="",p="";if(null!=this.oCMP.arrLstOthMPFields[0].drcAsOnDim&&this.oCMP.arrLstOthMPFields[0].drcAsOnDim.length>0)for(var M=0;M<Object.keys(this.oCMP.arrLstOthMPFields[0].dvAsOnDim[0]).length;M++)m=Object.keys(this.oCMP.arrLstOthMPFields[0].dvAsOnDim[0])[M].toString(),p=this.oCMP.arrLstOthMPFields[0].dvAsOnDim[0][m].toString(),m.Contains("CCNID")&&"CCNID51"!=m&&"CCNID53"!=m&&"CCNID68"!=m&&(d+=" dc"+m+"="+p+",",u.Contains("dc"+m)||u.push("dc"+m));if(null!=this.HeaderFields&&this.HeaderFields.length>0)for(var S=0;S<this.HeaderFields.length;S++)this.HeaderFields[S].DBColumnName.startsWith("dcCCNID")&&(u.Contains(this.HeaderFields[S].DBColumnName)||(d+=" "+this.HeaderFields[S].DBColumnName+"="+this.HeaderFields[S].SelectedValue+","));if(this.CustomTab.Pages.length>this.iStaticTabCnt)for(var f=this.iStaticTabCnt;f<this.CustomTab.Pages.length;f++)for(var E=0;E<this.CustomTab.Pages[f].Fields.length;E++)this.CustomTab.Pages[f].Fields[E].DBColumnName.startsWith("dcCCNID")&&(u.Contains(this.CustomTab.Pages[f].Fields[E].DBColumnName)||(d+=" "+this.CustomTab.Pages[f].Fields[E].DBColumnName+"="+this.CustomTab.Pages[f].Fields[E].SelectedValue+","));if(d.length>0&&(l+=d),l+='" ></CostCenters>',i+='" ProductID="'+this.DefProdID+'" Quantity="0',i+='" Unit="1" UOMConversion="1" UOMConvertedQty="0',i+='" Rate="0" Gross="0" IsQtyIgnored="1" AverageRate="0',i+='" StockValue="0" StockValueFC="0" RefNO="',i+='" BillDate="'+r.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),i+='" CurrencyID="'+this.CurrencyID+'" ExchangeRate="1',i+='" DebitAccount="'+this.sDrAccount+'" CreditAccount="'+this.sCrAccount,i+='" CommonNarration="'+o.e.EncodeXML(this.Remarks.Text),this.dgvEarnings.Table.length>0&&!o.e.IsEmpty(this.dgvEarnings.Table[0].EarSNo)){if(s+="\x11",s+="<Row>",s+="<AccountsXML></AccountsXML>",s+='<Transactions DocSeqNo="1" VoucherType="11',s+='" LinkedInvDocDetailsID="0" LinkedFieldName="',s+='" LineNarration="Earnings',c="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[0].drcPayProcessed.length>0&&(null!=(e=this.oCMP.arrLstOthMPFields[0].dsAllEmpsData.Tables[6].filter((function(e){return e.EmpSeqNo==a.oCMP.arrLstOthMPFields[0].EmpSeqNo&&11==e.VoucherType})))&&e.length>0&&(c=e[0].InvDocDetailsID.toString())),s+=c.length>0?'" DocDetailsID="'+c:'" DocDetailsID="',s+=i.toString()+'" ></Transactions>',t="",d="",s+='<Numeric Query="',this.dgvEarnings.Table.length>0){for(var F=0;F<this.dgvEarnings.Table.length;F++)o.e.IsEmpty(this.dgvEarnings.Table[F].EarSNo)||(d+=" dcNum"+this.dgvEarnings.Table[F].EarSNo.toString()+"="+parseFloat(this.dgvEarnings.Table[F].Actual).toString().Replace(",","")+",",d+=" dcCalcNum"+this.dgvEarnings.Table[F].EarSNo.toString()+"="+parseFloat(this.dgvEarnings.Table[F].Earned).toString().Replace(",","")+",",d+=" dcExchRT"+this.dgvEarnings.Table[F].EarSNo.toString()+"="+parseFloat(this.dgvEarnings.Table[F].Arrears).toString().Replace(",","")+",",d+=" dcCalcNumFC"+this.dgvEarnings.Table[F].EarSNo.toString()+"="+parseFloat(this.dgvEarnings.Table[F].Adjustments).toString().Replace(",","")+",");if(this.iAccruCnt>0)for(var T=0;T<this.dgvAccruals.Table.length;T++)o.e.IsEmpty(this.dgvAccruals.Table[T].EarSNo)||(d+=" dcNum"+this.dgvAccruals.Table[T].EarSNo.toString()+"="+parseFloat(this.dgvAccruals.Table[T].Actual).toString().Replace(",","")+",",d+=" dcCalcNum"+this.dgvAccruals.Table[T].EarSNo.toString()+"="+parseFloat(this.dgvAccruals.Table[T].Earned).toString().Replace(",","")+",",d+=" dcExchRT"+this.dgvAccruals.Table[T].EarSNo.toString()+"="+parseFloat(this.dgvAccruals.Table[T].Arrears).toString().Replace(",","")+",",d+=" dcCalcNumFC"+this.dgvAccruals.Table[T].EarSNo.toString()+"="+parseFloat(this.dgvAccruals.Table[T].Adjustments).toString().Replace(",","")+",");var A="",L="";if(r.a.SessionManager.Preferences.ContainsKey("ShowEarngDeductionTypeLookUpFldsInMnthlyPayroll")&&"True"==r.a.SessionManager.Preferences.ShowEarngDeductionTypeLookUpFldsInMnthlyPayroll){for(var v=0;v<this.dgvEarnings.Table.length;v++)A="",r.a.SessionManager.Preferences.ContainsKey("ShowEarngDeductionTypeLookUpFldsInMnthlyPayroll")&&"True"==r.a.SessionManager.Preferences.ShowEarngDeductionTypeLookUpFldsInMnthlyPayroll&&!o.e.IsEmpty(this.dgvEarnings.Table[v].EarDedTypeID)&&"0"!=this.dgvEarnings.Table[v].EarDedTypeID.toString()&&(A+="<EarDedType>"+this.dgvEarnings.Table[v].EarDedTypeID.toString()+"</EarDedType>"),A.length>0&&(L+='<Component ComponentID="'+this.dgvEarnings.Table[v].ComponentID.toString()+'" >'+A+"</Component>");L.length>0&&(t+="<XML>"+L+"</XML>")}}if(this.dgvEarOTs.Table.length>0)for(var I=0;I<this.dgvEarOTs.Table.length;I++)o.e.IsEmpty(this.dgvEarOTs.Table[I].EarSNo)||(d+=" dcNum"+this.dgvEarOTs.Table[I].EarSNo.toString()+"="+parseFloat(this.dgvEarOTs.Table[I].Hours).toString().Replace(",","")+",",d+=" dcCalcNum"+this.dgvEarOTs.Table[I].EarSNo.toString()+"="+parseFloat(this.dgvEarOTs.Table[I].Amount).toString().Replace(",","")+",");d.length>0&&(s+=d),s+='" >',t.length>0&&(s+=t.toString()),s+="</Numeric>",s+=n.toString(),s+=l.toString(),s+="<EXTRAXML></EXTRAXML>",s+="</Row>"}if(this.dgvDeductions.Table.length>0&&!o.e.IsEmpty(this.dgvDeductions.Table[0].DedSNo)){if(s+="\x11",s+="<Row>",s+="<AccountsXML></AccountsXML>",s+='<Transactions DocSeqNo="2" VoucherType="12',s+='" LinkedInvDocDetailsID="0" LinkedFieldName="',s+='" LineNarration="Deductions',c="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[0].drcPayProcessed.length>0&&(null!=(e=this.oCMP.arrLstOthMPFields[0].dsAllEmpsData.Tables[6].filter((function(e){return e.EmpSeqNo==a.oCMP.arrLstOthMPFields[0].EmpSeqNo&&12==e.VoucherType})))&&e.length>0&&(c=e[0].InvDocDetailsID.toString())),s+=c.length>0?'" DocDetailsID="'+c:'" DocDetailsID="',s+=i.toString()+'" ></Transactions>',t="",d="",s+='<Numeric Query="',this.dgvDeductions.Table.length>0){for(var b=0;b<this.dgvDeductions.Table.length;b++)o.e.IsEmpty(this.dgvDeductions.Table[b].DedSNo)||(d+=" dcNum"+this.dgvDeductions.Table[b].DedSNo.toString()+"="+parseFloat(this.dgvDeductions.Table[b].Actual).toString().Replace(",","")+",",d+=" dcCalcNum"+this.dgvDeductions.Table[b].DedSNo.toString()+"="+parseFloat(this.dgvDeductions.Table[b].Deducted).toString().Replace(",","")+",",d+=" dcExchRT"+this.dgvDeductions.Table[b].DedSNo.toString()+"="+parseFloat(this.dgvDeductions.Table[b].Arrears).toString().Replace(",","")+",",d+=" dcCalcNumFC"+this.dgvDeductions.Table[b].DedSNo.toString()+"="+parseFloat(this.dgvDeductions.Table[b].Adjustments).toString().Replace(",","")+",");var N="",O="";if(r.a.SessionManager.Preferences.ContainsKey("ShowEarngDeductionTypeLookUpFldsInMnthlyPayroll")&&"True"==r.a.SessionManager.Preferences.ShowEarngDeductionTypeLookUpFldsInMnthlyPayroll){for(var V=0;V<this.dgvDeductions.Table.length;V++)N="",r.a.SessionManager.Preferences.ContainsKey("ShowEarngDeductionTypeLookUpFldsInMnthlyPayroll")&&"True"==r.a.SessionManager.Preferences.ShowEarngDeductionTypeLookUpFldsInMnthlyPayroll&&!o.e.IsEmpty(this.dgvDeductions.Table[V].EarDedTypeID)&&"0"!=this.dgvDeductions.Table[V].EarDedTypeID.toString()&&(N+="<EarDedType>"+this.dgvDeductions.Table[V].EarDedTypeID.toString()+"</EarDedType>"),N.length>0&&(O+='<Component ComponentID="'+this.dgvDeductions.Table[V].ComponentID.toString()+'" >'+N+"</Component>");O.length>0&&(t+="<XML>"+O+"</XML>")}}d.length>0&&(s+=d),s+='" >',t.length>0&&(s+=t.toString()),s+="</Numeric>",s+=n.toString(),s+=l.toString(),s+="<EXTRAXML></EXTRAXML>",s+="</Row>"}if(this.dgvLoans.Table.length>0&&null!=this.dgvLoans.Tag&&parseInt(this.dgvLoans.Tag)>0){if(s+="\x11",s+="<Row>",s+="<AccountsXML></AccountsXML>",s+='<Transactions DocSeqNo="3" VoucherType="13',s+='" LinkedInvDocDetailsID="0" LinkedFieldName="',s+='" LineNarration="Loans',c="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[0].drcPayProcessed.length>0&&(null!=(e=this.oCMP.arrLstOthMPFields[0].dsAllEmpsData.Tables[6].filter((function(e){return e.EmpSeqNo==a.oCMP.arrLstOthMPFields[0].EmpSeqNo&&13==e.VoucherType})))&&e.length>0&&(c=e[0].InvDocDetailsID.toString())),s+=c.length>0?'" DocDetailsID="'+c:'" DocDetailsID="',s+=i.toString()+'" ></Transactions>',d="",s+='<Numeric Query="',this.dgvLoans.Table.length>0)for(var w=0;w<this.dgvLoans.Table.length;w++)o.e.IsEmpty(this.dgvLoans.Table[w].LoanSNo)||"1"!=this.dgvLoans.Table[w].IsVisible.toString()||(d+=" dcNum"+this.dgvLoans.Table[w].LoanSNo.toString()+"="+parseFloat(this.dgvLoans.Table[w].ActInstAmt).toString().Replace(",","")+",",d+=" dcCalcNum"+this.dgvLoans.Table[w].LoanSNo.toString()+"="+parseFloat(this.dgvLoans.Table[w].InstAmt).toString().Replace(",","")+",",d+=" dcExchRT"+this.dgvLoans.Table[w].LoanSNo.toString()+"="+parseFloat(this.dgvLoans.Table[w].BalAmt).toString().Replace(",","")+",",d+=" dcCalcNumFC"+this.dgvLoans.Table[w].LoanSNo.toString()+"="+parseFloat(this.dgvLoans.Table[w].PayStatus)+",");d.length>0&&(s+=d),s+='" ></Numeric>',s+=n.toString(),s+=l.toString(),s+="<EXTRAXML></EXTRAXML>",s+="</Row>"}if(this.dgvLeaves.Table.length>0&&!o.e.IsEmpty(this.dgvLeaves.Table[0].LeaveSNo)){if(s+="\x11",s+="<Row>",s+="<AccountsXML></AccountsXML>",s+='<Transactions DocSeqNo="4" VoucherType="14',s+='" LinkedInvDocDetailsID="0" LinkedFieldName="',s+='" LineNarration="Leaves',c="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[0].drcPayProcessed.length>0&&(null!=(e=this.oCMP.arrLstOthMPFields[0].dsAllEmpsData.Tables[6].filter((function(e){return e.EmpSeqNo==a.oCMP.arrLstOthMPFields[0].EmpSeqNo&&14==e.VoucherType})))&&e.length>0&&(c=e[0].InvDocDetailsID.toString())),s+=c.length>0?'" DocDetailsID="'+c:'" DocDetailsID="',s+=i.toString()+'" ></Transactions>',d="",s+='<Numeric Query="',this.dgvLeaves.Table.length>0)for(var R=0;R<this.dgvLeaves.Table.length;R++)o.e.IsEmpty(this.dgvLeaves.Table[R].LeaveSNo)||(d+=" dcNum"+this.dgvLeaves.Table[R].LeaveSNo.toString()+"="+parseFloat(this.dgvLeaves.Table[R].TotOPBal).toString().Replace(",","")+",",d+=" dcCalcNum"+this.dgvLeaves.Table[R].LeaveSNo.toString()+"="+parseFloat(this.dgvLeaves.Table[R].LeavesTaken).toString().Replace(",","")+",",d+=" dcExchRT"+this.dgvLeaves.Table[R].LeaveSNo.toString()+"="+parseFloat(this.dgvLeaves.Table[R].MonOPBal).toString().Replace(",","")+",",d+=" dcCalcNumFC"+this.dgvLeaves.Table[R].LeaveSNo.toString()+"="+parseFloat(this.dgvLeaves.Table[R].NetBal).toString().Replace(",","")+",");d.length>0&&(s+=d),s+='" ></Numeric>',s+=n.toString(),s+=l.toString(),s+="<EXTRAXML></EXTRAXML>",s+="</Row>"}return s.toString()}},{key:"FillControlValue",value:function(e,t){e instanceof d.d||e instanceof d.c||e instanceof D.a?e.Text=t:e instanceof P.e?e.SelectedValue=t:e instanceof g.c||e instanceof g.b||e instanceof g.a?""!=t&&o.e.isValidDate(t)&&(e.Date=new Date(t)):e instanceof y.b?""!=t&&o.e.Int(t)>0&&(e.PreviousSelectedValue=parseInt(t),e.SelectedValue=parseInt(t)):e instanceof c.a&&""!=t&&o.e.Int(t)>0&&(e.PrevSelValu=parseInt(t),e.SelectedValue=parseInt(t))}},{key:"GetControlValue",value:function(e){if(e instanceof d.d)return e.Text;if(e instanceof d.c)return e.Text;if(e instanceof D.a)return e.Text;if(e instanceof P.e)return e.SelectedValue;if(e instanceof g.c){if(e.Date)return e.Date.ToString("dd/MMM/yyyy")}else if(e instanceof g.b){if(e.Date)return e.Date.ToString("dd/MMM/yyyy hh:mm a")}else{if(e instanceof g.a)return e.Date.ToString("dd/MMM/yyyy");if(e instanceof y.b){if(e.SelectedValue>0)return e.SelectedValue.toString()}else if(e instanceof c.a&&e.SelectedValue>0)return e.SelectedValue.toString()}return""}},{key:"ValidatePosting",value:function(){try{if(Logger.InfoLog("MonthlyPayrollViewModel::Entering IsValidated()"),null!=r.a.SessionManager.Preferences.PayrollProduct&&""!=r.a.SessionManager.Preferences.PayrollProduct&&(this.DefProdID=parseInt(r.a.SessionManager.Preferences.PayrollProduct)),0==this.DefProdID)return this.DisplayMessage="Select any Default Payroll Product at Global Preferences",this.MessageVisibility=!0,!1;if(0==this.SelectedEmpID)return this.DisplayMessage=r.a.GetResource("SelectAnyEmployee"),this.MessageVisibility=!0,this.EmployeeList.SetFocus=!0,!1;if(this.oCMP.arrLstOthMPFields[0].sErrorMessage.length>0)return this.DisplayMessage=this.oCMP.arrLstOthMPFields[0].sErrorMessage,this.MessageVisibility=!0,this.dgvDays.SelectedIndex=1,!1;if(this.oCMP.arrLstOthMPFields[0].LOPDays<0)return this.DisplayMessage="Days mismatch : Month days and Total days.",this.MessageVisibility=!0,this.dgvDays.SelectedIndex=1,!1;if(this.oCMP.arrLstOthMPFields[0].dblLeavesLOP>0&&this.oCMP.arrLstOthMPFields[0].LOPDays<this.oCMP.arrLstOthMPFields[0].dblLeavesLOP)return this.DisplayMessage="Employee Should have atleast "+this.oCMP.arrLstOthMPFields[0].dblLeavesLOP+" LOP Days",this.MessageVisibility=!0,this.dgvDays.SelectedIndex=1,!1;if(this.oCMP.arrLstOthMPFields[0].NetSalary<0&&("False"==r.a.SessionManager.Preferences.CreateLoanIfNetSalLessThanZero||0==parseInt(r.a.SessionManager.Preferences.CreateLoanType)))return this.DisplayMessage="Net Amount should be greater than or equal to zero.",this.MessageVisibility=!0,this.dgvDays.SelectedIndex=1,!1;var e="";if(null!=this.HeaderFields&&this.HeaderFields.length>0)for(var t=0;t<this.HeaderFields.length;t++){var a={Message:e};if(this.ValidateControl(this.HeaderFields[t],a),e=a.Message,!o.e.IsEmpty(e))return this.DisplayMessage=e,this.MessageVisibility=!0,!1}if(this.CustomTab.Pages.length>this.iStaticTabCnt)for(var s=this.iStaticTabCnt;s<this.CustomTab.Pages.length;s++)for(var n=0;n<this.CustomTab.Pages[s].Fields.length;n++){var l={Message:e};if(this.ValidateControl(this.CustomTab.Pages[s].Fields[n],l),e=l.Message,!o.e.IsEmpty(e))return this.DisplayMessage=e,this.MessageVisibility=!0,!1}if(null!=this.dtWorkSheet)if(r.a.SessionManager.Preferences.ContainsKey("AddWeeklyoffs")&&Object(i.j)("True"==r.a.SessionManager.Preferences.AddWeeklyoffs)){if(parseFloat(this.dgvDays.Table[1][2].toString())!=this.dtComputeSUM(this.dtWorkSheet,"dcAlpha2")&&r.a.SessionManager.Preferences.ContainsKey("SaveDaysAttendedExceed")&&Object(i.j)("False"==r.a.SessionManager.Preferences.SaveDaysAttendedExceed))return this.DisplayMessage="' Days Attended ' does not match in work sheet entry",this.MessageVisibility=!0,!1}else if(parseFloat(this.dgvDays.Table[1][2].toString())!=this.dtComputeSUM(this.dtWorkSheet,"dcAlpha2")+parseFloat(this.dgvDays.Table[4][2].toString())+parseFloat(this.dgvDays.Table[5][2].toString())&&r.a.SessionManager.Preferences.ContainsKey("SaveDaysAttendedExceed")&&Object(i.j)("False"==r.a.SessionManager.Preferences.SaveDaysAttendedExceed))return this.DisplayMessage="' Days Attended ' does not match in work sheet entry",this.MessageVisibility=!0,!1;return this.DisplayMessage="",Logger.InfoLog("MonthlyPayrollViewModel::Exiting IsValidated()"),!0}catch(d){return Logger.ErrorLog("MonthlyPayrollViewModel::EXCEPTION IsValidated()\r\n"+d.Message+"\r\n"+d.stack),!1}}},{key:"BuildControls",value:function(e){var t=this;try{!function(){Logger.InfoLog("MonthlyPayrollViewModel::Entering BuildControls()"),t.dsDocDesig=(new m.a).GetScreenInfo(t.CostCenterID),r.a.SessionManager.Preferences.ContainsKey("ShowPaymentModeselectionWhilePayrollProcessing")&&"True"==r.a.SessionManager.Preferences.ShowPaymentModeselectionWhilePayrollProcessing&&t.dsDocDesig.Tables[0].forEach((function(e){"dcAlpha14"==o.e.String(e.SysColumnName)&&(e.SectionName="H")})),t.GenerateCustomFields("true~2~H","SectionSeqNumber",t.HeaderFields,e);var a=t.dsDocDesig.Tables[0];a=a.filter((function(e){return 1==e.IsColumnUserDefined&&3==e.SectionID}));for(var s=function(e){if(null==t.CustomTab.Pages.find((function(t){return t.Name==o.e.String(a[e].SectionName)}))){var s=new l.b;s.Name=a[e].SectionName.toString(),s.Header=a[e].SectionName.toString(),t.CustomTab.Pages.push(s)}},i=0;i<a.length;i++)s(i);if(t.CustomTab.Pages.length>t.iStaticTabCnt)for(var n=t.iStaticTabCnt;n<t.CustomTab.Pages.length;n++)t.GenerateCustomFields("true~3~"+t.CustomTab.Pages[n].Name,"SectionSeqNumber",t.CustomTab.Pages[n].Fields,e,n);t.CustomTab.SelectedTab=t.CustomTab.Pages[0],Logger.InfoLog("MonthlyPayrollViewModel::Exiting BuildControls()")}()}catch(a){Logger.ErrorLog("MonthlyPayrollViewModel::EXCEPTION BuildControls()\r\n"+a.Message+"\r\n"+a.stack)}}},{key:"GenerateCustomFields",value:function(e,t,a,s){var o=this,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;Logger.InfoLog("MonthlyPayrollViewModel:: Inside GenerateCustomFields");var l=this.dsDocDesig.Tables[0];(l=l.filter((function(t){return t.IsColumnUserDefined==Object(i.j)(e.split("~")[0])&&t.SectionID==parseInt(e.split("~")[1])&&t.SectionName==e.split("~")[2]}))).sort((function(e,t){return e.SectionSeqNumber-t.SectionSeqNumber})),this.iRow=0,this.iCol=-1,l.forEach((function(e){switch(e.UserColumnType.toString().toUpperCase()){case"FLOAT":case"NUMERIC":case"TEXT":o.oText=new d.d(parseInt(e.CostCenterColID)),o.SetProperties_Custom(e,o.oText),a.push(o.oText);break;case"TEXTAREA":o.oTextArea=new d.c(parseInt(e.CostCenterColID)),o.SetProperties_Custom(e,o.oTextArea),a.push(o.oTextArea);break;case"DATE":o.oDate=new g.c(parseInt(e.CostCenterColID)),o.SetProperties_Custom(e,o.oDate),a.push(o.oDate);break;case"TIME":o.oTime=new g.b(parseInt(e.CostCenterColID)),o.oTime.ShowTimePicker=!0,o.oTime.CustomFormat="hh:mm:ss tt",o.SetProperties_Custom(e,o.oTime),a.push(o.oTime);break;case"COMBOBOX":o.oCombo=new P.e(parseInt(e.CostCenterColID));var t=e.UserProbableValues.toString().Trim();if(t.length>0){for(var i=t.split(";"),n=0;n<i.length;n++)o.oCombo.Items.push(P.d.ComboBoxItems_2(i[n].Replace("''","'"),i[n].Replace("''","'")));o.oCombo.SelectedValue=o.oCombo.Items[0].Value}o.SetProperties_Custom(e,o.oCombo),a.push(o.oCombo);break;case"SELECTIONBOX":o.oPactSelectionCombo=new D.a(parseInt(e.CostCenterColID)),o.oPactSelectionCombo.CostCenterID=s,o.SetProperties_Custom(e,o.oPactSelectionCombo),a.push(o.oPactSelectionCombo);break;case"LISTBOX":o.oPactCombo=new y.b(parseInt(e.CostCenterColID)),o.oPactCombo.CCID=parseInt(e.ColumnCostCenterID),o.oPactCombo.TypeID=0==e.ColumnCCListViewTypeID.toString().Trim().length?1:parseInt(e.ColumnCCListViewTypeID),o.oPactCombo.OnPactListBoxValueChanged.Subscribe(o,"OnGetReference"),o.SetProperties_Custom(e,o.oPactCombo),a.push(o.oPactCombo);break;case"COMBOTEXT":var l=new p.a(parseInt(e.CostCenterColID));o.SetProperties_Custom(e,l),a.push(l);break;case"COMBOTEXTVALUE":var c=new p.b;"30416"==e.CostCenterColID.toString()?(c.Currency.Items.push(P.d.ComboBoxItems_2(r.a.GetResource("Pay_Yearly"),"Yearly")),c.Currency.Items.push(P.d.ComboBoxItems_2(r.a.GetResource("Pay_Monthly"),"Monthly")),c.Currency.SelectedValue="Yearly",c.ExchangeRate.Text="0"):(c.Currency.Items.push(P.d.ComboBoxItems_2(r.a.GetResource("AssetManagement_Value"),"1")),c.Currency.Items.push(P.d.ComboBoxItems_2(r.a.GetResource("AssetManagement_Percentage"),"2")),c.Currency.SelectedValue="1"),o.SetProperties_Custom(e,c),a.push(c);break;case"LINK":var h=new M.a(parseInt(e.CostCenterColID));h.LinkCombo.Items.push(P.d.ComboBoxItems_2("A","1")),o.SetProperties_Custom(e,h),a.push(h);break;case"TEXTCOMBOBOX":var u=new d.f(parseInt(e.CostCenterColID)),C=e.UserProbableValues.toString().Trim();if(C.length>0){for(var m=C.split(";"),S=0;S<m.length;S++)o.oCombo.Items.push(P.d.ComboBoxItems_2(m[S],m[S]));o.oCombo.SelectedValue=o.oCombo.Items[0].Value}o.SetProperties_Custom(e,u),a.push(u)}})),"H"==e.split("~")[2]?this.HeaderFields=a:this.CustomTab.Pages[n].Fields=a}},{key:"OnGetReference",value:function(e){e instanceof y.b&&this.GetLinkReferenceData(e.DBColumnID,this.CostCenterID,e.SelectedValue)}},{key:"SetProperties_Custom",value:function(e,t){try{Logger.InfoLog("MonthlyPayrollViewModel::Entering SetProperties_Custom()"),t.Label=e.ResourceData.toString();var a=o.e.IsEmpty(e.IsMandatory)?0:parseInt(e.IsMandatory);if(t.Mandatory=!1,1==a&&(t.Mandatory=!0),t.Visible=Object(i.j)(e.IsVisible),t.DataType=e.ColumnDataType.toString().toUpperCase(),t.DefaultValue=e.UserDefaultValue.toString(),t.DBColumnName=e.SysColumnName.toString(),t.SectionID=e.SectionID.toString(),o.e.IsEmpty(e.SysTableName)||(t.SysTableName=e.SysTableName.toString()),"2"==o.e.String(e.SectionID)?(1==this.iCol?(this.iRow++,this.iCol=0):this.iCol++,o.e.IsEmpty(e.RowNo)||(t.Row=this.iRow),o.e.IsEmpty(e.ColumnNo)||(t.Column=this.iCol)):(3==this.iCol?(this.iRow++,this.iCol=0):this.iCol++,o.e.IsEmpty(e.RowNo)||(t.Row=this.iRow),o.e.IsEmpty(e.ColumnNo)||(t.Column=this.iCol)),o.e.IsEmpty(e.ISEDITABLE)||(t.Enable=Object(i.j)(e.ISEDITABLE)),!o.e.IsEmpty(e.TextFormat)&&t instanceof d.d){var s;2==(s=o.e.Int(e.TextFormat))?t.IsAllCaps=!0:3==s&&(t.IsFirstLetterCaps=!0)}if((t instanceof d.d||t instanceof d.f)&&("INT"!=t.DataType&&"FLOAT"!=t.DataType||(t.Align="Right")),t instanceof y.b&&null!=this.dsDocDesig&&this.dsDocDesig.Tables.length>0&&this.dsDocDesig.Columns[0].Contains("dependanton")&&!o.e.IsEmpty(e.dependanton)&&"0"!=e.dependanton.toString()){var r=null;parseInt(e.dependanton.toString())>5e4&&parseInt(e.dependanton.toString())<50050?null!=(r=this.dsDocDesig.Tables[0].filter((function(t){return t.ColumnCostCenterID==e.dependanton.toString()})))&&r.length>0&&(t.DependantOn=r[0].SysColumnName.toString()):2==parseInt(e.dependanton.toString())?t.DependantOn="AccountID":3==parseInt(e.dependanton.toString())?t.DependantOn="ProductID":83==parseInt(e.dependanton.toString())&&(t.DependantOn="CustomerID"),this.dsDocDesig.Columns[0].Contains("dependancy")&&!o.e.IsEmpty(e.dependancy)&&(t.Dependancy=parseInt(e.dependancy.toString())),this.dsDocDesig.Columns[0].Contains("filterinuse")&&!o.e.IsEmpty(e.filterinuse)&&(t.Dependantinuse=Object(i.j)(e.filterinuse.toString()))}this.SetProperty_DefaultValue(t),Logger.InfoLog("MonthlyPayrollViewModel::Exiting SetProperties_Custom()")}catch(n){Logger.ErrorLog("MonthlyPayrollViewModel::EXCEPTION SetProperties_Custom()\r\n"+n.Message+"\r\n"+n.stack)}}},{key:"SetProperty_DefaultValue",value:function(e){try{if(Logger.InfoLog("MonthlyPayrollViewModel::Entering SetProperty_DefaultValue()"),e instanceof d.d)e.Text=e.DefaultValue;else if(e instanceof d.a)e.Text=e.DefaultValue;else if(e instanceof d.b)e.Password=e.DefaultValue;else if(e instanceof d.c)e.Text=e.DefaultValue;else if(e instanceof d.f)e.Text=e.DefaultValue;else if(e instanceof P.e)this.oCombo=e,this.oCombo.SelectedValue=o.e.IsEmpty(e.DefaultValue)?this.oCombo.Items.length>0?this.oCombo.Items[0].Value:"":e.DefaultValue;else if(e instanceof y.b)this.oPactCombo=e,50001==this.oPactCombo.CCID&&r.a.SessionManager.DivisionID>0?(e.DefaultValue=r.a.SessionManager.DivisionID.toString(),this.oPactCombo.SelectedValue=r.a.SessionManager.DivisionID):50002==this.oPactCombo.CCID&&r.a.SessionManager.LocationID>0?(e.DefaultValue=r.a.SessionManager.LocationID.toString(),this.oPactCombo.SelectedValue=r.a.SessionManager.LocationID):o.e.IsEmpty(e.DefaultValue)?this.oPactCombo.SelectedValue=0:""!=e.DefaultValue.Trim()&&(this.oPactCombo.SelectedValue=parseInt(e.DefaultValue));else if(e instanceof y.a)this.oHistory=e,this.oHistory.Clear(),50001==this.oHistory.CCID&&r.a.SessionManager.DivisionID>0?(e.DefaultValue=r.a.SessionManager.DivisionID.toString(),this.oHistory.SetValue_2(r.a.SessionManager.DivisionID,r.a.SessionManager.DivisionName)):50002==this.oHistory.CCID&&r.a.SessionManager.LocationID>0?(e.DefaultValue=r.a.SessionManager.LocationID.toString(),this.oHistory.SetValue_2(r.a.SessionManager.LocationID,r.a.SessionManager.LocationName)):o.e.IsEmpty(e.DefaultValue)?this.oHistory.SetValue(0):""!=e.DefaultValue.Trim()&&this.oHistory.SetValue(parseInt(e.DefaultValue));else if(e instanceof g.c)e.Date=o.e.IsEmpty(e.DefaultValue)||"today"!=e.DefaultValue.toLowerCase()?!o.e.IsEmpty(e.DefaultValue)&&o.e.isValidDate(e.DefaultValue)?new Date(e.DefaultValue):null:new Date;else if(e instanceof g.b){var t=new Date;!o.e.IsEmpty(e.DefaultValue)&&o.e.isValidDate(e.DefaultValue)?(t=new Date(e.DefaultValue),e.Date=new Date(1900,1,1,t.getHours(),t.getMonth(),t.getSeconds(),t.getMilliseconds())):e.Date=new Date(1900,1,1,t.getHours(),t.getMonth(),t.getSeconds(),t.getMilliseconds())}else e instanceof g.a?e.Date=!o.e.IsEmpty(e.DefaultValue)&&o.e.isValidDate(e.DefaultValue)?new Date(e.DefaultValue):new Date:e instanceof D.a?e.Text=e.DefaultValue:e instanceof p.b?"VacDaysPerMonth"!=e.DBColumnName&&(e.ExchangeRate.Text=e.DefaultValue,e.Currency.SelectedValue="1"):e instanceof d.f&&(e.Text=e.DefaultValue,e.Items.length>0&&(e.SelectedValue=e.Items[0].Value));Logger.InfoLog("MonthlyPayrollViewModel::Exiting SetProperty_DefaultValue()")}catch(a){Logger.ErrorLog("MonthlyPayrollViewModel::EXCEPTION SetProperty_DefaultValue()\r\n"+a.Message+"\r\n"+a.stack)}}},{key:"FilterEmployees",value:function(){var e="";try{Logger.InfoLog("MonthlyPayrollViewModel::Entering FilterEmployees()"),e=" ( a.StatusID=250 AND ISNULL(CONVERT(DATETIME,a.DORelieve),'01-Jan-9000')>='"+r.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"' AND CONVERT(DATETIME,a.DOJ)<='"+r.a.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")+"' ) ","True"==r.a.SessionManager.Preferences.NPDontAllowPayrollProcessing&&(e+=" AND a.NodeID NOT IN ( Select NodeID From COM_CC50051 WITH(NOLOCK) ",e+="     Where ResignStatus='Posted' AND DateDiff(day,ISNULL(CONVERT(DATETIME,DORelieve),'01-Jan-9000'),'"+r.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')<=0",e+="     AND DateDiff(day,CONVERT(DATETIME,CONVERT(DATETIME,('01-'+CONVERT(NVARCHAR(3),DATENAME(MONTH,ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000')))+'-'+CONVERT(NVARCHAR,YEAR(ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000'))))) ),'"+r.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')>=0 )"),"True"==r.a.SessionManager.Preferences.DontConsiderEmpsForPayroll&&parseInt(r.a.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)>0&&(e+=" AND NOT ( MONTH(CONVERT(DATETIME,a.DOJ))="+r.a.SessionManager.PayrollMonth.getMonth()+" AND YEAR(CONVERT(DATETIME,a.DOJ))="+r.a.SessionManager.PayrollMonth.getFullYear()+" AND DAY(CONVERT(DATETIME,a.DOJ))>="+parseInt(r.a.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)+" ) "),r.a.SessionManager.LocationID>0&&r.a.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&r.a.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(e=e+" AND a.NodeID IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+r.a.SessionManager.LocationID+")"),o.e.IsEmpty(r.a.SessionManager.sWHEmpFilteredEmpSeqNos)||(e+="  AND a.NodeID IN ("+r.a.SessionManager.sWHEmpFilteredEmpSeqNos+")"),Logger.InfoLog("MonthlyPayrollViewModel::Exiting FilterEmployees()")}catch(t){Logger.ErrorLog("MonthlyPayrollViewModel::EXCEPTION FilterEmployees()\r\n"+t.Message+"\r\n"+t.stack)}return e}},{key:"OnPreviewKeyDown",value:function(e,t){return!1}},{key:"AddGrids",value:function(){try{Logger.InfoLog("MonthlyPayrollViewModel::Entering LoadGrids()");var e,t=new C.a;this.dgvDays=new h.a,this.dgvDays.BeginEdit.Subscribe(this,"dgvDays_BeginEdit"),this.dgvDays.CellEditEnding.Subscribe(this,"dgvDays_EndEdit"),this.dgvDays.Columns=[],this.dgvDays.Width="",this.dgvDays.Height=220,this.dgvDays.AllowReorderColumns=!1,this.dgvDays.CanUserResizeColumns=!1,this.dgvDays.CanUserSortColumns=!1,(t=new C.a).Header=r.a.GetResource("Particulars"),t.DisplayMember="Particulars",t.ID="Particulars",t.Width=110,t.ReadOnly=!0,this.dgvDays.Columns.push(t),(t=new C.a).Header=r.a.GetResource("Days"),t.DisplayMember="Days",t.ID="Days",t.Width=50,t.ReadOnly=!1,t.DataType="FLOAT",t.ShowTotal=!0,t.IsCalculated=1,t.DecimalPoints="1",this.dgvDays.Columns.push(t),this.dgvDays.Clear(),this.dgvDays.TableColumns.push("ColumnName"),this.dgvDays.TableColumns.push("Particulars"),this.dgvDays.TableColumns.push("Days"),this.dgvDays.TableColumns.push("IsEditable"),this.dgvDays.TableColumns.push("IsVisible"),(e=this.dgvDays.NewRow()).ColumnName="dcAlpha4",e.Particulars="Month Days",e.Days="0.0",e.IsEditable="0",this.dgvDays.addRow(e),(e=this.dgvDays.NewRow()).ColumnName="dcAlpha5",e.Particulars="Days Attended",e.Days="0.0",e.IsEditable="1",this.dgvDays.addRow(e),(e=this.dgvDays.NewRow()).ColumnName="dcAlpha24",e.Particulars="Paid Leaves",e.Days="0.0",e.IsEditable="0",this.dgvDays.addRow(e),(e=this.dgvDays.NewRow()).ColumnName="dcAlpha6",e.Particulars="Total Leaves",e.Days="0.0",e.IsEditable="0",this.dgvDays.addRow(e),(e=this.dgvDays.NewRow()).ColumnName="dcAlpha7",e.Particulars="Weekly Offs",e.Days="0.0",e.IsEditable="0",this.dgvDays.addRow(e),(e=this.dgvDays.NewRow()).ColumnName="dcAlpha8",e.Particulars="Holidays",e.Days="0.0",e.IsEditable="0",this.dgvDays.addRow(e),(e=this.dgvDays.NewRow()).ColumnName="dcAlpha9",e.Particulars="Absent(LOP)",e.Days="0.0",e.IsEditable="1",this.dgvDays.addRow(e),(e=this.dgvDays.NewRow()).ColumnName="dcAlpha10",e.Particulars="Unpaid Days",e.Days="0.0",e.IsEditable="0",this.dgvDays.addRow(e),this.dgvDays.Columns[1].footer="0.0",this.dgvDays.UpdateFooter(),this.dgvEarOTs=new h.a,this.dgvEarOTs.BeginEdit.Subscribe(this,"dgvEarOTs_BeginEdit"),this.dgvEarOTs.CellEditEnding.Subscribe(this,"dgvEarOTs_EndEdit"),this.dgvEarOTs.Columns=[],this.dgvEarOTs.Width="",this.dgvEarOTs.Height=220,this.dgvEarOTs.AllowReorderColumns=!1,this.dgvEarOTs.CanUserResizeColumns=!1,this.dgvEarOTs.CanUserSortColumns=!1,(t=new C.a).Header=r.a.GetResource("OT"),t.DisplayMember="OT",t.ID="OT",t.Width=60,t.ReadOnly=!0,this.dgvEarOTs.Columns.push(t),(t=new C.a).Header=r.a.GetResource("Hours"),t.DisplayMember="Hours",t.ID="Hours",t.Width=50,t.ReadOnly=!1,t.DataType="FLOAT",t.ShowTotal=!0,t.IsCalculated=1,t.DecimalPoints="2",this.dgvEarOTs.Columns.push(t),(t=new C.a).Header=r.a.GetResource("PayAmount"),t.DisplayMember="Amount",t.ID="Amount",t.Width=70,t.ReadOnly=!0,t.DataType="FLOAT",t.ShowTotal=!0,t.IsCalculated=1,t.DecimalPoints=r.a.SessionManager.Preferences.DecimalsinAmount,this.dgvEarOTs.Columns.push(t),this.dgvEarOTs.Clear(),this.dgvEarOTs.TableColumns.push("OT"),this.dgvEarOTs.TableColumns.push("Hours"),this.dgvEarOTs.TableColumns.push("Amount"),this.dgvEarOTs.TableColumns.push("EarAddToNet"),this.dgvEarOTs.TableColumns.push("EarFType"),this.dgvEarOTs.TableColumns.push("EarSNo"),this.dgvEarOTs.TableColumns.push("EarFormula"),this.dgvEarOTs.TableColumns.push("IsEditable"),this.dgvEarOTs.TableColumns.push("ComponentID"),this.dgvEarOTs.TableColumns.push("IsVisible");for(var a=0;a<5;a++)e=this.dgvEarOTs.NewRow(),this.dgvEarOTs.addRow(e);this.dgvEarOTs.Columns[1].footer=(0).ToString(r.a.SessionManager.sPayrollDecimals2),this.dgvEarOTs.Columns[2].footer=(0).ToString(r.a.SessionManager.sPayrollDecimals),this.dgvEarOTs.UpdateFooter(),this.dgvDedNetSal=new h.a,this.dgvDedNetSal.Visible=!1,this.dgvDedNetSal.Columns=[],this.dgvDedNetSal.Width="",this.dgvDedNetSal.Height=220,this.dgvDedNetSal.AllowReorderColumns=!1,this.dgvDedNetSal.CanUserResizeColumns=!1,this.dgvDedNetSal.CanUserSortColumns=!1,(t=new C.a).Header=r.a.GetResource("Particulars"),t.DisplayMember="Particulars",t.ID="Particulars",t.Width=120,t.ReadOnly=!0,this.dgvDedNetSal.Columns.push(t),(t=new C.a).Header=r.a.GetResource("PayAmount"),t.DisplayMember="Amount",t.ID="Amount",t.Width=50,t.ReadOnly=!1,t.DataType="FLOAT",t.ShowTotal=!0,t.IsCalculated=1,t.DecimalPoints="2",this.dgvDedNetSal.Columns.push(t),this.dgvDedNetSal.Clear(),this.dgvDedNetSal.TableColumns.push("Particulars"),this.dgvDedNetSal.TableColumns.push("Amount");var s,o=this.dgvDedNetSal.NewRow();this.dgvDedNetSal.addRow(o),this.dgvEarnings=new h.a,this.dgvEarnings.BeginEdit.Subscribe(this,"dgvEarnings_BeginEdit"),this.dgvEarnings.CellEditEnding.Subscribe(this,"dgvEarnings_EndEdit"),this.dgvEarnings.Columns=[],this.dgvEarnings.Width="",this.dgvEarnings.Height=300,this.dgvEarnings.AllowReorderColumns=!1,this.dgvEarnings.CanUserResizeColumns=!1,this.dgvEarnings.CanUserSortColumns=!1,(t=new C.a).Header="#",t.DisplayMember="SlNo",t.ID="SlNo",t.Width=45,t.ReadOnly=!0,this.dgvEarnings.Columns.push(t),(t=new C.a).Header=r.a.GetResource("Earnings"),t.DisplayMember="Earnings",t.ID="Earnings",t.Width=150,t.ReadOnly=!0,this.dgvEarnings.Columns.push(t),(t=new C.a).Header=r.a.GetResource("Actual"),t.DisplayMember="Actual",t.ID="Actual",t.Width=100,t.ReadOnly=!1,t.DataType="FLOAT",t.ShowTotal=!0,t.IsCalculated=1,t.DecimalPoints=r.a.SessionManager.Preferences.DecimalsinAmount,this.dgvEarnings.Columns.push(t),(t=new C.a).Header=r.a.GetResource("Earned"),t.DisplayMember="Earned",t.ID="Earned",t.Width=100,t.ReadOnly=!1,t.DataType="FLOAT",t.ShowTotal=!0,t.IsCalculated=1,t.DecimalPoints=r.a.SessionManager.Preferences.DecimalsinAmount,this.dgvEarnings.Columns.push(t),(t=new C.a).Header=r.a.GetResource("Arrears"),t.DisplayMember="Arrears",t.ID="Arrears",t.Width=100,t.ReadOnly=!0,t.DataType="FLOAT",t.ShowTotal=!0,t.IsCalculated=1,t.DecimalPoints=r.a.SessionManager.Preferences.DecimalsinAmount,this.dgvEarnings.Columns.push(t),(t=new C.a).Header=r.a.GetResource("Adjustments"),t.DisplayMember="Adjustments",t.ID="Adjustments",t.Width=100,t.ReadOnly=!0,t.DataType="FLOAT",t.ShowTotal=!0,t.IsCalculated=1,t.DecimalPoints=r.a.SessionManager.Preferences.DecimalsinAmount,this.dgvEarnings.Columns.push(t),(t=new C.a).CostCenterID=44,t.TypeID=120,t.DataType="LISTBOX",t.DisplayMember="EarDedType",t.ValueMember="EarDedTypeID",t.Header="Earning Type",t.Width=100,t.IsVisible=!(!r.a.SessionManager.Preferences.ContainsKey("ShowEarngDeductionTypeLookUpFldsInMnthlyPayroll")||"True"!=r.a.SessionManager.Preferences.ShowEarngDeductionTypeLookUpFldsInMnthlyPayroll),this.dgvEarnings.Columns.push(t),this.dgvEarnings.Clear(),this.dgvEarnings.TableColumns.push("SlNo"),this.dgvEarnings.TableColumns.push("Earnings"),this.dgvEarnings.TableColumns.push("Actual"),this.dgvEarnings.TableColumns.push("Earned"),this.dgvEarnings.TableColumns.push("Arrears"),this.dgvEarnings.TableColumns.push("Adjustments"),this.dgvEarnings.TableColumns.push("EarAddToNet"),this.dgvEarnings.TableColumns.push("EarFType"),this.dgvEarnings.TableColumns.push("EarSNo"),this.dgvEarnings.TableColumns.push("EarFormula"),this.dgvEarnings.TableColumns.push("IsEditable"),this.dgvEarnings.TableColumns.push("Actual_GRAY"),this.dgvEarnings.TableColumns.push("Earned_GRAY"),this.dgvEarnings.TableColumns.push("Arrears_GRAY"),this.dgvEarnings.TableColumns.push("Adjustments_GRAY"),this.dgvEarnings.TableColumns.push("ComponentID"),this.dgvEarnings.TableColumns.push("IsVisible"),this.dgvEarnings.TableColumns.push("EarDedType"),this.dgvEarnings.TableColumns.push("EarDedTypeID"),this.dgvEarnings.TableColumns.push("IndexValue");for(var i=0;i<20;i++)(e=this.dgvEarnings.NewRow()).SlNo=(i+1).toString(),this.dgvEarnings.addRow(e);this.dgvEarnings.Columns[2].footer=(0).ToString(r.a.SessionManager.sPayrollDecimals),this.dgvEarnings.Columns[3].footer=(0).ToString(r.a.SessionManager.sPayrollDecimals),this.dgvEarnings.Columns[4].footer=(0).ToString(r.a.SessionManager.sPayrollDecimals),this.dgvEarnings.Columns[5].footer=(0).ToString(r.a.SessionManager.sPayrollDecimals),this.dgvEarnings.UpdateFooter(),this.dgvDeductions=new h.a,this.dgvDeductions.BeginEdit.Subscribe(this,"dgvDeductions_BeginEdit"),this.dgvDeductions.CellEditEnding.Subscribe(this,"dgvDeductions_EndEdit"),this.dgvDeductions.Columns=[],this.dgvDeductions.Width="",this.dgvDeductions.Height=300,this.dgvDeductions.AllowReorderColumns=!1,this.dgvDeductions.CanUserResizeColumns=!1,this.dgvDeductions.CanUserSortColumns=!1,(t=new C.a).Header="#",t.DisplayMember="SlNo",t.ID="SlNo",t.Width=45,t.ReadOnly=!0,this.dgvDeductions.Columns.push(t),(t=new C.a).Header=r.a.GetResource("Deductions"),t.DisplayMember="Deductions",t.ID="Deductions",t.Width=150,t.ReadOnly=!0,this.dgvDeductions.Columns.push(t),(t=new C.a).Header=r.a.GetResource("Actual"),t.DisplayMember="Actual",t.ID="Actual",t.Width=100,t.ReadOnly=!1,t.DataType="FLOAT",t.ShowTotal=!0,t.IsCalculated=1,t.DecimalPoints=r.a.SessionManager.Preferences.DecimalsinAmount,this.dgvDeductions.Columns.push(t),(t=new C.a).Header=r.a.GetResource("Deducted"),t.DisplayMember="Deducted",t.ID="Deducted",t.Width=100,t.ReadOnly=!1,t.DataType="FLOAT",t.ShowTotal=!0,t.IsCalculated=1,t.DecimalPoints=r.a.SessionManager.Preferences.DecimalsinAmount,this.dgvDeductions.Columns.push(t),(t=new C.a).Header=r.a.GetResource("Arrears"),t.DisplayMember="Arrears",t.ID="Arrears",t.Width=100,t.ReadOnly=!0,t.DataType="FLOAT",t.ShowTotal=!0,t.IsCalculated=1,t.DecimalPoints=r.a.SessionManager.Preferences.DecimalsinAmount,this.dgvDeductions.Columns.push(t),(t=new C.a).Header=r.a.GetResource("Adjustments"),t.DisplayMember="Adjustments",t.ID="Adjustments",t.Width=100,t.ReadOnly=!0,t.DataType="FLOAT",t.ShowTotal=!0,t.IsCalculated=1,t.DecimalPoints=r.a.SessionManager.Preferences.DecimalsinAmount,this.dgvDeductions.Columns.push(t),(t=new C.a).CostCenterID=44,t.TypeID=121,t.DataType="LISTBOX",t.DisplayMember="EarDedType",t.ValueMember="EarDedTypeID",t.Header="Deduction Type",t.Width=100,t.IsVisible=!(!r.a.SessionManager.Preferences.ContainsKey("ShowEarngDeductionTypeLookUpFldsInMnthlyPayroll")||"True"!=r.a.SessionManager.Preferences.ShowEarngDeductionTypeLookUpFldsInMnthlyPayroll),this.dgvDeductions.Columns.push(t),this.dgvDeductions.Clear(),this.dgvDeductions.TableColumns.push("SlNo"),this.dgvDeductions.TableColumns.push("Deductions"),this.dgvDeductions.TableColumns.push("Actual"),this.dgvDeductions.TableColumns.push("Deducted"),this.dgvDeductions.TableColumns.push("Arrears"),this.dgvDeductions.TableColumns.push("Adjustments"),this.dgvDeductions.TableColumns.push("DedAddToNet"),this.dgvDeductions.TableColumns.push("DedFType"),this.dgvDeductions.TableColumns.push("DedSNo"),this.dgvDeductions.TableColumns.push("DedFormula"),this.dgvDeductions.TableColumns.push("IsEditable"),this.dgvDeductions.TableColumns.push("Actual_GRAY"),this.dgvDeductions.TableColumns.push("Deducted_GRAY"),this.dgvDeductions.TableColumns.push("Arrears_GRAY"),this.dgvDeductions.TableColumns.push("Adjustments_GRAY"),this.dgvDeductions.TableColumns.push("ComponentID"),this.dgvDeductions.TableColumns.push("IsVisible"),this.dgvDeductions.TableColumns.push("EarDedType"),this.dgvDeductions.TableColumns.push("EarDedTypeID"),this.dgvDeductions.TableColumns.push("IndexValue");for(var n=0;n<20;n++)(e=this.dgvDeductions.NewRow()).SlNo=(n+1).toString(),this.dgvDeductions.addRow(e);this.dgvDeductions.Columns[2].footer=(0).ToString(r.a.SessionManager.sPayrollDecimals),this.dgvDeductions.Columns[3].footer=(0).ToString(r.a.SessionManager.sPayrollDecimals),this.dgvDeductions.Columns[4].footer=(0).ToString(r.a.SessionManager.sPayrollDecimals),this.dgvDeductions.Columns[5].footer=(0).ToString(r.a.SessionManager.sPayrollDecimals),this.dgvDeductions.UpdateFooter(),this.dgvLoans=new h.a,this.dgvLoans.DoubleClick.Subscribe(this,"dgvLoans_CellDoubleClick"),this.dgvLoans.Columns=[],this.dgvLoans.Width="700px",this.dgvLoans.Height=300,this.dgvLoans.AllowReorderColumns=!1,this.dgvLoans.CanUserResizeColumns=!1,this.dgvLoans.CanUserSortColumns=!1,(t=new C.a).Header="#",t.DisplayMember="SlNo",t.ID="SlNo",t.Width=45,t.ReadOnly=!0,this.dgvLoans.Columns.push(t),(t=new C.a).Header=r.a.GetResource("Loans"),t.DisplayMember="Loans",t.ID="Loans",t.Width=150,t.ReadOnly=!0,this.dgvLoans.Columns.push(t),(t=new C.a).Header=r.a.GetResource("LoanDocNo"),t.DisplayMember="LoanDocNo",t.ID="LoanDocNo",t.Width=100,t.DataType="LINK",t.Click.Subscribe(this,"onLoanClick"),t.ReadOnly=!0,this.dgvLoans.Columns.push(t),(t=new C.a).Header=r.a.GetResource("BalanceAmount"),t.DisplayMember="BalAmt",t.ID="BalAmt",t.Width=120,t.ReadOnly=!0,t.DataType="FLOAT",t.DecimalPoints=r.a.SessionManager.Preferences.DecimalsinAmount,this.dgvLoans.Columns.push(t),(t=new C.a).Header=r.a.GetResource("InstallmentAmount"),t.DisplayMember="InstAmt",t.ID="InstAmt",t.Width=150,t.ReadOnly=!0,t.DataType="FLOAT",t.ShowTotal=!0,t.IsCalculated=1,t.DecimalPoints=r.a.SessionManager.Preferences.DecimalsinAmount,this.dgvLoans.Columns.push(t),(t=new C.a).Header=r.a.GetResource("InstallmentNo"),t.DisplayMember="InstNo",t.ID="InstNo",t.Width=100,t.ReadOnly=!0,this.dgvLoans.Columns.push(t),this.dgvLoans.Clear(),this.dgvLoans.TableColumns.push("SlNo"),this.dgvLoans.TableColumns.push("Loans"),this.dgvLoans.TableColumns.push("LoanDocNo"),this.dgvLoans.TableColumns.push("BalAmt"),this.dgvLoans.TableColumns.push("InstAmt"),this.dgvLoans.TableColumns.push("InstNo"),this.dgvLoans.TableColumns.push("LoanSNo"),this.dgvLoans.TableColumns.push("ApprovedAmt"),this.dgvLoans.TableColumns.push("ActInstNo"),this.dgvLoans.TableColumns.push("PayStatus"),this.dgvLoans.TableColumns.push("ActInstAmt"),this.dgvLoans.TableColumns.push("InvDocDetailsID"),this.dgvLoans.TableColumns.push("IsEditable"),this.dgvLoans.TableColumns.push("ComponentID"),this.dgvLoans.TableColumns.push("IsVisible"),this.dgvLoans.TableColumns.push("NodeNo"),this.dgvLoans.TableColumns.push("IndexValue"),this.dgvLoans.Columns[4].footer=(0).ToString(r.a.SessionManager.sPayrollDecimals),this.dgvLoans.UpdateFooter(),this.dgvLeaves=new h.a,this.dgvLeaves.Columns=[],this.dgvLeaves.Width="",this.dgvLeaves.Height=300,this.dgvLeaves.AllowReorderColumns=!1,this.dgvLeaves.CanUserResizeColumns=!1,this.dgvLeaves.CanUserSortColumns=!1,(t=new C.a).Header="#",t.DisplayMember="SlNo",t.ID="SlNo",t.Width=45,t.ReadOnly=!0,this.dgvLeaves.Columns.push(t),(t=new C.a).Header=r.a.GetResource("Pay_Leaves"),t.DisplayMember="Leaves",t.ID="Leaves",t.Width=150,t.ReadOnly=!0,this.dgvLeaves.Columns.push(t),(t=new C.a).Header=r.a.GetResource("OpeningBalance"),t.DisplayMember="TotOPBal",t.ID="TotOPBal",t.Width=120,t.ReadOnly=!0,t.DataType="FLOAT",t.ShowTotal=!0,t.IsCalculated=1,t.DecimalPoints="2",this.dgvLeaves.Columns.push(t),(t=new C.a).Header=r.a.GetResource("TakeninthisMonth"),t.DisplayMember="LeavesTaken",t.ID="LeavesTaken",t.Width=150,t.ReadOnly=!0,t.DataType="FLOAT",t.ShowTotal=!0,t.IsCalculated=1,t.DecimalPoints="2",this.dgvLeaves.Columns.push(t),(t=new C.a).Header=r.a.GetResource("NetBalance"),t.DisplayMember="NetBal",t.ID="NetBal",t.Width=100,t.ReadOnly=!0,t.DataType="FLOAT",t.ShowTotal=!0,t.IsCalculated=1,t.DecimalPoints="2",this.dgvLeaves.Columns.push(t),this.dgvLeaves.Clear(),this.dgvLeaves.TableColumns.push("SlNo"),this.dgvLeaves.TableColumns.push("Leaves"),this.dgvLeaves.TableColumns.push("TotOPBal"),this.dgvLeaves.TableColumns.push("MonOPBal"),this.dgvLeaves.TableColumns.push("LeavesTaken"),this.dgvLeaves.TableColumns.push("NetBal"),this.dgvLeaves.TableColumns.push("LeaveSNo"),this.dgvLeaves.TableColumns.push("IsEditable"),this.dgvLeaves.TableColumns.push("ComponentID"),this.dgvLeaves.TableColumns.push("IsVisible"),this.dgvLeaves.TableColumns.push("IndexValue"),this.dgvLeaves.Columns[2].footer=(0).ToString("0.00"),this.dgvLeaves.Columns[3].footer=(0).ToString("0.00"),this.dgvLeaves.Columns[4].footer=(0).ToString("0.00"),this.dgvLeaves.UpdateFooter(),this.dgvAccruals=new h.a,this.dgvAccruals.OnBeginEdit.Subscribe(this,"dgvAccruals_BeginEdit"),this.dgvAccruals.OnCellEditEnding.Subscribe(this,"dgvAccruals_EndEdit"),this.dgvAccruals.Columns=[],this.dgvAccruals.Width="",this.dgvAccruals.Height=300,this.dgvAccruals.AllowReorderColumns=!1,this.dgvAccruals.CanUserResizeColumns=!1,this.dgvAccruals.CanUserSortColumns=!1,(t=new C.a).Header="#",t.DisplayMember="SlNo",t.ID="SlNo",t.Width=45,t.ReadOnly=!0,this.dgvAccruals.Columns.push(t),(t=new C.a).Header="Accrual Type",t.DisplayMember="Earnings",t.ID="Earnings",t.Width=150,t.ReadOnly=!0,this.dgvAccruals.Columns.push(t),(t=new C.a).Header=r.a.GetResource("Actual"),t.DisplayMember="Actual",t.ID="Actual",t.Width=100,t.ReadOnly=!1,t.DataType="FLOAT",t.ShowTotal=!0,t.IsCalculated=1,t.DecimalPoints=r.a.SessionManager.Preferences.DecimalsinAmount,this.dgvAccruals.Columns.push(t),(t=new C.a).Header=r.a.GetResource("Earned"),t.DisplayMember="Earned",t.ID="Earned",t.Width=100,t.ReadOnly=!1,t.DataType="FLOAT",t.ShowTotal=!0,t.IsCalculated=1,t.DecimalPoints=r.a.SessionManager.Preferences.DecimalsinAmount,this.dgvAccruals.Columns.push(t),(t=new C.a).Header=r.a.GetResource("Arrears"),t.DisplayMember="Arrears",t.ID="Arrears",t.Width=100,t.ReadOnly=!0,t.DataType="FLOAT",t.ShowTotal=!0,t.IsCalculated=1,t.DecimalPoints=r.a.SessionManager.Preferences.DecimalsinAmount,this.dgvAccruals.Columns.push(t),(t=new C.a).Header=r.a.GetResource("Adjustments"),t.DisplayMember="Adjustments",t.ID="Adjustments",t.Width=100,t.ReadOnly=!0,t.DataType="FLOAT",t.ShowTotal=!0,t.IsCalculated=1,t.DecimalPoints=r.a.SessionManager.Preferences.DecimalsinAmount,this.dgvAccruals.Columns.push(t),(t=new C.a).CostCenterID=44,t.TypeID=120,t.DataType="LISTBOX",t.DisplayMember="EarDedType",t.ValueMember="EarDedTypeID",t.Header="Earning Type",t.Width=100,t.IsVisible=!(!r.a.SessionManager.Preferences.ContainsKey("ShowEarngDeductionTypeLookUpFldsInMnthlyPayroll")||"True"!=r.a.SessionManager.Preferences.ShowEarngDeductionTypeLookUpFldsInMnthlyPayroll),this.dgvAccruals.Columns.push(t),this.dgvAccruals.Table=[],this.dgvAccruals.TableColumns.push("SlNo"),this.dgvAccruals.TableColumns.push("Earnings"),this.dgvAccruals.TableColumns.push("Actual"),this.dgvAccruals.TableColumns.push("Earned"),this.dgvAccruals.TableColumns.push("Arrears"),this.dgvAccruals.TableColumns.push("Adjustments"),this.dgvAccruals.TableColumns.push("EarAddToNet"),this.dgvAccruals.TableColumns.push("EarFType"),this.dgvAccruals.TableColumns.push("EarSNo"),this.dgvAccruals.TableColumns.push("EarFormula"),this.dgvAccruals.TableColumns.push("IsEditable"),this.dgvAccruals.TableColumns.push("Actual_GRAY"),this.dgvAccruals.TableColumns.push("Earned_GRAY"),this.dgvAccruals.TableColumns.push("Arrears_GRAY"),this.dgvAccruals.TableColumns.push("Adjustments_GRAY"),this.dgvAccruals.TableColumns.push("ComponentID"),this.dgvAccruals.TableColumns.push("IsVisible"),this.dgvAccruals.TableColumns.push("EarDedType"),this.dgvAccruals.TableColumns.push("EarDedTypeID"),this.dgvAccruals.TableColumns.push("IndexValue");for(var d=0;d<20;d++)(e=this.dgvAccruals.NewRow()).SlNo=(d+1).toString(),this.dgvAccruals.addRow(e);this.dgvDays.OnPreviewKeyDown.Subscribe(this,"OnPreviewKeyDown"),this.dgvEarnings.OnPreviewKeyDown.Subscribe(this,"OnPreviewKeyDown"),this.dgvEarOTs.OnPreviewKeyDown.Subscribe(this,"OnPreviewKeyDown"),this.dgvDeductions.OnPreviewKeyDown.Subscribe(this,"OnPreviewKeyDown"),this.dgvLoans.OnPreviewKeyDown.Subscribe(this,"OnPreviewKeyDown"),this.dgvLeaves.OnPreviewKeyDown.Subscribe(this,"OnPreviewKeyDown"),(s=new l.b).Name="General",s.Header=r.a.GetResource("General"),this.CustomTab.Pages.push(s),this.dgvEarnings.Row=0,this.dgvEarnings.Column=0,this.dgvEarnings.ColumnSpan=2,this.CustomTab.Pages[0].Fields.push(this.dgvEarnings),this.dgvDeductions.Row=0,this.dgvDeductions.Column=2,this.dgvDeductions.ColumnSpan=2,this.CustomTab.Pages[0].Fields.push(this.dgvDeductions),(s=new l.b).Name="Loans",s.Header=r.a.GetResource("Loans"),this.CustomTab.Pages.push(s),this.dgvLoans.Row=0,this.dgvLoans.Column=0,this.dgvLoans.ColumnSpan=2,this.CustomTab.Pages[1].Fields.push(this.dgvLoans),(s=new l.b).Name="Leaves",s.Header=r.a.GetResource("Pay_Leaves"),this.CustomTab.Pages.push(s),this.dgvLeaves.Row=0,this.dgvLeaves.Column=0,this.dgvLeaves.ColumnSpan=2,this.CustomTab.Pages[2].Fields.push(this.dgvLeaves),(s=new l.b).Name="Accruals",s.Header=r.a.GetResource("Accruals"),s.Visible=!1,this.CustomTab.Pages.push(s),this.dgvAccruals.Row=0,this.dgvAccruals.Column=0,this.dgvAccruals.ColumnSpan=2,this.CustomTab.Pages[3].Fields.push(this.dgvAccruals),Logger.InfoLog("MonthlyPayrollViewModel::Exiting LoadGrids()")}catch(c){Logger.ErrorLog("MonthlyPayrollViewModel::EXCEPTION LoadGrids()\r\n"+c.Message+"\r\n"+c.stack)}}},{key:"dgvLoans_CellDoubleClick",value:function(e,t,a){var s=this;if(null!=e&&!o.e.IsEmpty(e.LoanDocNo)){var i=[];i.push(this),i.push(parseInt(e.PayStatus)),i.push(parseFloat(e.InstAmt)),i.push(parseFloat(e.ActInstAmt)),i.push(parseFloat(e.BalAmt)),i.push(this.SelectedEmpID),i.push(parseInt(e.LoanSNo)),i.push(e.Loans.toString()),i.push(e.LoanDocNo.toString());var n=new R(i);r.a.page.ShowDialog(n,x.a,{ShowCenter:!0,Title:"Change Loan Payment"}).subscribe((function(){n.DialogResult&&(e.PayStatus=n.LoanPayType,0==n.LoanPayType?e.InstAmt=parseFloat(e.ActInstAmt).ToString(r.a.SessionManager.sPayrollDecimals):1==n.LoanPayType?e.InstAmt=n.Amount.ToString(r.a.SessionManager.sPayrollDecimals):(2==n.LoanPayType||3==n.LoanPayType)&&(e.InstAmt=0),s.dgvLoans.updateRow(e),s.objCPField=s.oCMP.arrLstCPFields[0][4].find((function(t){return t.SNo==parseInt(e.LoanSNo)})),s.objCPField.LoanPayStatus=e.PayStatus.toString(),s.objCPField.LoanInstAmt=e.InstAmt.toString(),s.objCPField.dEarned=e.InstAmt.toString(),s.oCMP.iEmpIndex=0,s.oCMP.ExecuteAllFormulas(),s.FillProcessedData())}))}}},{key:"EmployeeList_LostFocus",value:function(e){var t=this;if("UnProcessed"==this.sProcessType||"NoticePay"==this.sProcessType||this.SelectedEmpID!=this.EmployeeList.Code.SelectedValue)try{if(Logger.InfoLog("MonthlyPayrollViewModel::Entering EmployeeList_SelectedValueChanged()"),this.DisplayMessage="",this.ClearControls(),this.SelectedEmpID=this.EmployeeList.Code.SelectedValue,this.SelectedEmpID>0){this.DisplayMessage="Loading data, Please wait....",this.MessageVisibility=!0,this.MsgVisibility=!0,this.GetLinkReferenceData(32316,40054,this.SelectedEmpID),this.drc=this.dsDocDesig.Tables[0].filter((function(e){return"CreditAccount"==e.SysColumnName})),null!=this.drc&&this.drc.length>0&&null!=this.drc[0].UserDefaultValue&&""!=this.drc[0].UserDefaultValue.toString().Trim()&&(this.sCrAccount=this.drc[0].UserDefaultValue.toString()),this.drc=this.dsDocDesig.Tables[0].filter((function(e){return"DebitAccount"==e.SysColumnName})),null!=this.drc&&this.drc.length>0&&null!=this.drc[0].UserDefaultValue&&""!=this.drc[0].UserDefaultValue.toString().Trim()&&(this.sDrAccount=this.drc[0].UserDefaultValue.toString());try{if(this.oCMP=new T.a,this.oCMP.oParent=this,this.oCMP.sSelectedEmpSeqNos=this.SelectedEmpID.toString(),this.oCMP.PayrollMonth=r.a.SessionManager.PayrollMonth,this.oCMP.PayrollMonthStart=r.a.SessionManager.PayrollMonthStart,this.oCMP.PayrollMonthEnd=r.a.SessionManager.PayrollMonthEnd,this.oCMP.ProcessPayroll(),this.oCMP.IsCompleted){if(this.oCMP.arrLstOthMPFields[0].sErrorMessage.length>0)return this.DisplayMessage=this.oCMP.arrLstOthMPFields[0].sErrorMessage.Replace("NumFields",""),this.MsgVisibility=!1,void(this.MessageVisibility=!0);var a;if(null==this.dtArrData&&(this.dtArrData=[]),this.dtArrData=[],this.sArrCalcMonthPaydays="",this.sArrsCalcMonths="",null!=this.oCMP.arrLstOthMPFields[0].drcArrears&&this.oCMP.arrLstOthMPFields[0].drcArrears.length>0)for(var s=0;s<this.oCMP.arrLstOthMPFields[0].drcArrears.length;s++)this.sArrCalcMonthPaydays.length>0&&(this.sArrCalcMonthPaydays+=";"),this.sArrCalcMonthPaydays+=this.oCMP.arrLstOthMPFields[0].drcArrears[s].ArrCalcMonthPayDays,this.sArrsCalcMonths.length>0&&(this.sArrsCalcMonths+=";"),this.sArrsCalcMonths+=new Date(this.oCMP.arrLstOthMPFields[0].drcArrears[s].ArrearsCalcMonths).ToString("dd/MMM/yyyy"),(a={}).PayrollMonth=new Date(this.oCMP.arrLstOthMPFields[0].drcArrears[s].ArrearsCalcMonths).ToString("dd/MMM/yyyy"),this.dtArrData.push(a);if(null!=this.dtArrData&&this.dtArrData.length>0)for(var i=r.a.empService.GetQueryData(this.SelectedEmpID,"MPL012","","",""),n=function(e){var a=new Date(t.dtArrData[e].PayrollMonth);if(null!=i&&i.length>0){var s=i.filter((function(e){return e.ArrAdjMonth==a}));if(null!=s&&s.length>0){for(var r=0;r<t.oCMP.arrLstCPFields[0][0].length;r++)null!=s[0]["Earning"+t.oCMP.arrLstCPFields[0][0][r].SNo]&&null!=s[0]["Earning"+t.oCMP.arrLstCPFields[0][0][r].SNo]&&""!=s[0]["Earning"+t.oCMP.arrLstCPFields[0][0][r].SNo].toString()&&(t.oCMP.arrLstCPFields[0][0][r].ArrData+=a.ToString("dd MMM yyyy")+","+parseFloat(s[0]["Earning"+t.oCMP.arrLstCPFields[0][0][r].SNo])+",");for(var o=0;o<t.oCMP.arrLstCPFields[0][2].length;o++)null!=s[0]["Deduction"+t.oCMP.arrLstCPFields[0][2][o].SNo]&&null!=s[0]["Deduction"+t.oCMP.arrLstCPFields[0][2][o].SNo]&&""!=s[0]["Deduction"+t.oCMP.arrLstCPFields[0][2][o].SNo].toString()&&(t.oCMP.arrLstCPFields[0][2][o].ArrData+=a.ToString("dd MMM yyyy")+","+parseFloat(s[0]["Deduction"+t.oCMP.arrLstCPFields[0][2][o].SNo])+",")}}},l=0;l<this.dtArrData.length;l++)n(l);if(null==this.dtAdjData&&(this.dtAdjData=[]),this.dtAdjData=[],this.sAdjCalcMonthPaydays="",this.sAdjsCalcMonths="",this.oCMP.arrLstOthMPFields[0].drcAdjustments.length>0)for(var d=0;d<this.oCMP.arrLstOthMPFields[0].drcAdjustments.length;d++)this.sAdjCalcMonthPaydays.length>0&&(this.sAdjCalcMonthPaydays+=";"),this.sAdjCalcMonthPaydays+=this.oCMP.arrLstOthMPFields[0].drcAdjustments[d].Days,this.sAdjsCalcMonths.length>0&&(this.sAdjsCalcMonths+=";"),this.sAdjsCalcMonths+=new Date(this.oCMP.arrLstOthMPFields[0].drcAdjustments[d].AdjMonth).ToString("dd/MMM/yyyy"),(a={}).PayrollMonth=new Date(this.oCMP.arrLstOthMPFields[0].drcAdjustments[d].PayrollMonth).ToString("dd/MMM/yyyy"),a.AdjMonth=new Date(this.oCMP.arrLstOthMPFields[0].drcAdjustments[d].AdjMonth).ToString("dd/MMM/yyyy"),a.Days=this.oCMP.arrLstOthMPFields[0].drcAdjustments[d].Days.toString(),a.Remarks=this.oCMP.arrLstOthMPFields[0].drcAdjustments[d].Remarks.toString(),this.dtAdjData.push(a);if(null!=this.dtAdjData&&this.dtAdjData.length>0)for(var c=r.a.empService.GetQueryData(this.SelectedEmpID,"MPL013","","",""),h=function(e){var a=new Date(t.dtAdjData.Rows[e].AdjMonth);if(null!=c&&c.length>0){var s=c.filter((function(e){return e.ArrAdjMonth==a}));if(null!=s&&s.length>0){for(var r=0;r<t.oCMP.arrLstCPFields[0][0].length;r++)null!=s[0]["Earning"+t.oCMP.arrLstCPFields[0][0][r].SNo]&&null!=s[0]["Earning"+t.oCMP.arrLstCPFields[0][0][r].SNo]&&""!=s[0]["Earning"+t.oCMP.arrLstCPFields[0][0][r].SNo].toString()&&(t.oCMP.arrLstCPFields[0][0][r].AdjData+=a.ToString("dd MMM yyyy")+","+parseFloat(s[0]["Earning"+t.oCMP.arrLstCPFields[0][0][r].SNo])+",");for(var o=0;o<t.oCMP.arrLstCPFields[0][2].length;o++)null!=s[0]["Deduction"+t.oCMP.arrLstCPFields[0][2][o].SNo]&&null!=s[0]["Deduction"+t.oCMP.arrLstCPFields[0][2][o].SNo]&&""!=s[0]["Deduction"+t.oCMP.arrLstCPFields[0][2][o].SNo].toString()&&(t.oCMP.arrLstCPFields[0][2][o].AdjData+=a.ToString("dd MMM yyyy")+","+parseFloat(s[0]["Deduction"+t.oCMP.arrLstCPFields[0][2][o].SNo])+",")}}},g=0;g<this.dtAdjData.length;g++)h(g);if(null==this.dtDSData&&(this.dtDSData=[]),this.dtDSData=[],this.oCMP.arrLstOthMPFields[0].drcDues.length>0)for(var D=0;D<this.oCMP.arrLstOthMPFields[0].drcDues.length;D++)(a={}).FieldType="2"==o.e.String(this.oCMP.arrLstOthMPFields[0].drcDues[D].FieldType)?"Earning":"Deduction",a.ComponentID=this.oCMP.arrLstOthMPFields[0].drcDues[D].ComponentID.toString(),a.PayrollMonth=new Date(this.oCMP.arrLstOthMPFields[0].drcDues[D].DuesPaidMonth).ToString("dd/MMM/yyyy"),a.Amount=parseFloat(this.oCMP.arrLstOthMPFields[0].drcDues[D].Amount),this.dtDSData.push(a);this.CalculateAccruals(),this.FillProcessedData(),this.MsgVisibility=!1,this.ApproveVisibility=!1;var y=[],P="";if(this.oCMP.arrLstOthMPFields[0].IsAlreadyProcessed?!o.e.IsEmpty(this.oCMP.arrLstOthMPFields[0].drcPayProcessed[0].WorkFlowID)&&parseInt(this.oCMP.arrLstOthMPFields[0].drcPayProcessed[0].WorkFlowID)>0&&(P=this.oCMP.arrLstOthMPFields[0].drcPayProcessed[0].INVDocDetailsID.toString()+",54,'"+r.a.SessionManager.UserName+"',40054,"+this.oCMP.arrLstOthMPFields[0].drcPayProcessed[0].WorkFlowID.toString()+","+this.oCMP.arrLstOthMPFields[0].drcPayProcessed[0].WorkFlowLevel.toString()+","+this.oCMP.arrLstOthMPFields[0].drcPayProcessed[0].StatusID.toString()+","+this.oCMP.arrLstOthMPFields[0].drcPayProcessed[0].CreatedDate.toString()+","+r.a.SessionManager.UserID+","+r.a.SessionManager.RoleID,null!=(y=r.a.empService.GetQueryData(0,"MPL002",JSON.stringify(P),"",""))&&y.length>0&&(null!=y[0].CanApprove&&null!=y[0].CanApprove&&"TRUE"==y[0].CanApprove.toString().toUpperCase()?(this.ApproveVisibility=!0,this.PostVisiblility=!1):this.PostVisiblility=!(!r.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Posted Docs")&&!r.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Approved Docs")))):this.PostVisiblility=r.a.SessionManager.IsActionAssigned(this.CostCenterID,"Create"),this.oCMP.arrLstOthMPFields[0].IsAlreadyProcessed){if(this.DocStatus=this.oCMP.arrLstOthMPFields[0].DocStatus,this.DocID=this.oCMP.arrLstOthMPFields[0].DocID,this.DocNo=this.oCMP.arrLstOthMPFields[0].DocNo,null!=this.HeaderFields&&this.HeaderFields.length>0)for(var C=0;C<this.HeaderFields.length;C++)(this.HeaderFields[C].DBColumnName.startsWith("dcAlpha")||this.HeaderFields[C].DBColumnName.startsWith("dcCCNID"))&&this.FillControlValue(this.HeaderFields[C],o.e.String(this.oCMP.arrLstOthMPFields[0].drcPayProcessed[0][this.HeaderFields[C].DBColumnName]));if(this.CustomTab.Pages.length>this.iStaticTabCnt)for(var m=this.iStaticTabCnt;m<this.CustomTab.Pages.length;m++)for(var p=0;p<this.CustomTab.Pages[m].Fields.length;p++)(this.CustomTab.Pages[m].Fields[p].DBColumnName.startsWith("dcAlpha")||this.CustomTab.Pages[m].Fields[p].DBColumnName.startsWith("dcCCNID"))&&this.FillControlValue(this.CustomTab.Pages[m].Fields[p],this.oCMP.arrLstOthMPFields[0].drcPayProcessed[0][this.CustomTab.Pages[m].Fields[p].DBColumnName].toString());var M=r.a.empService.GetQueryData(this.CostCenterID,"MPL003",this.DocID,"","");this.WFDocLevelList.Clear();var S=null,f=null;if(S=M.Tables[1],f=M.Tables[0],null!=S&&S.length>0&&!r.a.SessionManager.IsActionAssigned(this.CostCenterID,"HideWorkflowLevels")){var E=parseInt(this.oCMP.arrLstOthMPFields[0].drcPayProcessed[0].WorkFlowLevel.toString());f.length>0&&parseInt(f[f.length-1].StatusID);for(var F=f.length>0?parseInt(f[0].WorkFlowLevel)-1:0,A=0;A<S.length;A++){var L=new u.a(parseInt(S[0].WID),parseInt(S[A].LEVELID),S[A].LEVELNAME.toString(),this.CostCenterID,this.DocID,r.a.SessionManager.PayrollMonth);A==F&&(L.IsPending=!0,L.Label="C"),0==A&&(L.LeftLineBrush="#FFFFFFFF"),A==S.length-1&&(L.RightLineBrush="#FFFFFFFF"),this.WFDocLevelList.push(L)}for(var v=f.length-1;v>=0;v--){var I=parseInt(f[v].WorkFlowLevel);if(I<=E&&I<=this.WFDocLevelList.length&&!this.WFDocLevelList[I-1].IsSet){this.WFDocLevelList[I-1].IsSet=!0,this.WFDocLevelList[I-1].ModifiedBy=f[v].Status.toString()+" By "+f[v].CreatedBy.toString(),f[v].FirstName.toString().length>0&&(this.WFDocLevelList[I-1].ModifiedBy+="("+f[v].FirstName.toString()+")");var b=new Date(f[v].Date);this.WFDocLevelList[I-1].ModifiedBy+=" On "+b.ToString(r.a.SessionManager.Preferences["Date Format"]);var N=parseInt(f[v].StatusID);372==N?this.WFDocLevelList[I-1].IsRejected=!0:441==N?this.WFDocLevelList[I-1].IsApproved=!0:369==N&&(this.WFDocLevelList[I-1].IsPending=!0,this.WFDocLevelList[I-1].Label=" P")}}}}else this.DocStatus="[UnPosted]",this.DocID=0,this.DocNo=""}}catch(O){this.MsgVisibility=!1,Logger.ErrorLog("MonthlyPayrollViewModel::EXCEPTION EmployeeList_SelectedValueChanged()\r\n"+O.Message+"\r\n"+O.stack)}}Logger.InfoLog("MonthlyPayrollViewModel::Exiting EmployeeList_SelectedValueChanged()")}catch(O){this.MsgVisibility=!1,Logger.ErrorLog("MonthlyPayrollViewModel::EXCEPTION EmployeeList_SelectedValueChanged()\r\n"+O.Message+"\r\n"+O.stack)}}},{key:"CalculateAccruals",value:function(){if(new Date(this.oCMP.arrLstOthMPFields[0].dsAllEmpsData.Tables[2][0].cEffectFrom).getFullYear()==r.a.SessionManager.PayrollMonth.getFullYear()&&new Date(this.oCMP.arrLstOthMPFields[0].dsAllEmpsData.Tables[2][0].cEffectFrom).iMonth()==r.a.SessionManager.PayrollMonth.iMonth()&&this.oCMP.lstAccrAccumulateSNos.length>0){for(var e="",t=0,a=0,s=0,o=0,i=0,n=0,l=0,d=0,c=0,h=-1,u=0;u<this.oCMP.lstAccrAccumulateSNos.length;u++)e.length>0&&(e+=","),e+="ISNULL(dcNum"+this.oCMP.lstAccrAccumulateSNos[u]+",0) as dcNum"+this.oCMP.lstAccrAccumulateSNos[u]+",ISNULL(dcCalcNum"+this.oCMP.lstAccrAccumulateSNos[u]+",0) as dcCalcNum"+this.oCMP.lstAccrAccumulateSNos[u]+",ISNULL(dcCalcNumFC"+this.oCMP.lstAccrAccumulateSNos[u]+",0) as dcCalcNumFC"+this.oCMP.lstAccrAccumulateSNos[u];var g=r.a.empService.GetQueryData(0,"MPL008",JSON.stringify(e),new Date(r.a.SessionManager.PayrollMonth).ToString("dd MMM yyyy"),this.SelectedEmpID.toString());if(null!=g&&g.length>0){for(var D=0,y=0;y<this.oCMP.arrLstCPFields[0][0].length;y++)if(this.oCMP.arrLstCPFields[0][0][y].IsAccrualType&&-9e3==this.oCMP.arrLstCPFields[0][0][y].MaxOTHrs){D=parseFloat(this.oCMP.arrLstCPFields[0][0][y].dActual);break}for(var P=0;P<this.oCMP.arrLstCPFields[0][0].length;P++)if(a=0,s=0,this.oCMP.arrLstCPFields[0][0][P].IsAccrualType&&"Accruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[0][0][P].Behaviour)if(h=this.oCMP.arrLstCPFields[0][0][P].SNo,t=parseFloat(this.oCMP.arrLstCPFields[0][0][P].dActual),-9001==this.oCMP.arrLstCPFields[0][0][P].MaxOTHrs)l=this.oCMP.arrLstOthMPFields[0].dVacDaysUptoLastMonth,n=parseFloat(g[g.length-1]["dcNum"+h]),c=parseFloat((t-n).ToString(r.a.SessionManager.sPayrollDecimals)),d=parseFloat((c/D).ToString(r.a.SessionManager.sPayrollDecimals)),this.oCMP.arrLstCPFields[0][0][P].dAdjusted=(l*d).ToString(r.a.SessionManager.sPayrollDecimals);else{for(var C=0;C<g.length;C++)i=parseFloat(g[C].TotalDays),o=parseFloat(g[C].DaysAttended)+parseFloat(g[C].PaidLeaves)+parseFloat(g[C].LOPDays),n=parseFloat(g[C]["dcCalcNum"+h]),l=parseFloat(g[C]["dcCalcNumFC"+h]),d=parseFloat((o/i*t).ToString(r.a.SessionManager.sPayrollDecimals)),c=parseFloat((d-n).ToString(r.a.SessionManager.sPayrollDecimals)),a+=parseFloat(c.ToString(r.a.SessionManager.sPayrollDecimals)),s+=l;this.oCMP.arrLstCPFields[0][0][P].dAdjusted=(a-s).ToString(r.a.SessionManager.sPayrollDecimals)}}}}},{key:"FillProcessedData",value:function(){var e,t=this;if(this.dgvEarnings.Clear(),this.dgvAccruals.Clear(),this.Remarks.Text=this.oCMP.arrLstOthMPFields[0].sRemarks,this.oCMP.arrLstCPFields[0][0].length>0){for(var a=0;a<this.oCMP.arrLstCPFields[0][0].length;a++)this.oCMP.arrLstCPFields[0][0][a].IsAccrualType?(this.iAccruCnt++,(e=this.dgvAccruals.NewRow()).SlNo=this.iAccruCnt.toString()):(this.iEarCnt++,(e=this.dgvEarnings.NewRow()).SlNo=this.iEarCnt.toString()),e.Earnings=this.oCMP.arrLstCPFields[0][0][a].ComponentName,e.ComponentID=this.oCMP.arrLstCPFields[0][0][a].ComponentID,e.EarSNo=this.oCMP.arrLstCPFields[0][0][a].SNo,e.Actual=this.oCMP.arrLstCPFields[0][0][a].dActual,e.Earned=this.oCMP.arrLstCPFields[0][0][a].dEarned,e.Arrears=this.oCMP.arrLstCPFields[0][0][a].dArrear,e.Adjustments=this.oCMP.arrLstCPFields[0][0][a].dAdjusted,e.EarDedTypeID=this.oCMP.arrLstCPFields[0][0][a].sEarDedType,e.IsEditable=this.oCMP.arrLstCPFields[0][0][a].IsEditable,e.IsVisible=this.oCMP.arrLstCPFields[0][0][a].IsVisible,e.Actual_GRAY=this.oCMP.arrLstCPFields[0][0][a].IsReadOnly,e.Earned_GRAY=this.oCMP.arrLstCPFields[0][0][a].IsReadOnly,e.Arrears_GRAY=this.oCMP.arrLstCPFields[0][0][a].IsReadOnly,e.Adjustments_GRAY=this.oCMP.arrLstCPFields[0][0][a].IsReadOnly,e.IndexValue=-1,this.oCMP.arrLstCPFields[0][0][a].IsAccrualType?this.dgvAccruals.addRow(e):this.dgvEarnings.addRow(e);this.dgvEarnings.RefreshGrid=!0,this.dgvAccruals.RefreshGrid=!0}if(this.iAccruCnt>0&&(this.CustomTab.Pages[3].Visible=!0),this.dgvEarOTs.Clear(),this.oCMP.arrLstCPFields[0][1].length>0)for(var s=0;s<this.oCMP.arrLstCPFields[0][1].length;s++)(e=this.dgvEarOTs.NewRow()).OT=this.oCMP.arrLstCPFields[0][1][s].ComponentName,e.ComponentID=this.oCMP.arrLstCPFields[0][1][s].ComponentID,e.EarSNo=this.oCMP.arrLstCPFields[0][1][s].SNo,e.Hours=this.oCMP.arrLstCPFields[0][1][s].dActual,e.Amount=this.oCMP.arrLstCPFields[0][1][s].dEarned,e.IsEditable=this.oCMP.arrLstCPFields[0][1][s].IsEditable,e.IsVisible=this.oCMP.arrLstCPFields[0][1][s].IsVisible,this.dgvEarOTs.addRow(e);if(this.dgvDeductions.Clear(),this.oCMP.arrLstCPFields[0][2].length>0){for(var i=0;i<this.oCMP.arrLstCPFields[0][2].length;i++)(e=this.dgvDeductions.NewRow()).SlNo=(i+1).toString(),e.Deductions=this.oCMP.arrLstCPFields[0][2][i].ComponentName,e.ComponentID=this.oCMP.arrLstCPFields[0][2][i].ComponentID,e.DedSNo=this.oCMP.arrLstCPFields[0][2][i].SNo,e.Actual=this.oCMP.arrLstCPFields[0][2][i].dActual,e.Deducted=this.oCMP.arrLstCPFields[0][2][i].dEarned,e.Arrears=this.oCMP.arrLstCPFields[0][2][i].dArrear,e.Adjustments=this.oCMP.arrLstCPFields[0][2][i].dAdjusted,e.EarDedTypeID=this.oCMP.arrLstCPFields[0][2][i].sEarDedType,e.IsEditable=this.oCMP.arrLstCPFields[0][2][i].IsEditable,e.IsVisible=this.oCMP.arrLstCPFields[0][2][i].IsVisible,e.Actual_GRAY=this.oCMP.arrLstCPFields[0][2][i].IsReadOnly,e.Deducted_GRAY=this.oCMP.arrLstCPFields[0][2][i].IsReadOnly,e.Arrears_GRAY=this.oCMP.arrLstCPFields[0][2][i].IsReadOnly,e.Adjustments_GRAY=this.oCMP.arrLstCPFields[0][2][i].IsReadOnly,this.dgvDeductions.addRow(e);this.dgvDeductions.RefreshGrid=!0}if(this.dgvDedNetSal.Clear(),this.oCMP.arrLstOthMPFields[0].iExtLoansCnt=0,this.dgvLoans.Clear(),this.oCMP.arrLstCPFields[0][4].length>0)for(var n=0;n<this.oCMP.arrLstCPFields[0][4].length;n++)null!=this.oCMP.arrLstCPFields[0][4][n].LoanDocNo&&""!=this.oCMP.arrLstCPFields[0][4][n].LoanDocNo.Trim()&&((e=this.dgvLoans.NewRow()).SlNo=(n+1).toString(),e.Loans=this.oCMP.arrLstCPFields[0][4][n].ComponentName,e.ComponentID=this.oCMP.arrLstCPFields[0][4][n].ComponentID,e.LoanSNo=this.oCMP.arrLstCPFields[0][4][n].SNo,e.LoanDocNo=this.oCMP.arrLstCPFields[0][4][n].LoanDocNo,e.ApprovedAmt=this.oCMP.arrLstCPFields[0][4][n].LoanApprovedAmt,e.BalAmt=this.oCMP.arrLstCPFields[0][4][n].LoanBalAmt,e.ActInstAmt=this.oCMP.arrLstCPFields[0][4][n].LoanActInstAmt,e.InstAmt=this.oCMP.arrLstCPFields[0][4][n].LoanInstAmt,e.InstNo=this.oCMP.arrLstCPFields[0][4][n].LoanInstNo,e.ActInstNo=this.oCMP.arrLstCPFields[0][4][n].LoanActInstNo,e.PayStatus=this.oCMP.arrLstCPFields[0][4][n].LoanPayStatus,e.IsEditable=this.oCMP.arrLstCPFields[0][4][n].IsEditable,e.IsVisible=this.oCMP.arrLstCPFields[0][4][n].IsVisible,e.NodeNo=this.oCMP.arrLstCPFields[0][4][n].LoanNodeNo,this.dgvLoans.addRow(e),this.oCMP.arrLstOthMPFields[0].iExtLoansCnt++);if(this.dgvLoans.Tag=this.oCMP.arrLstOthMPFields[0].iExtLoansCnt,this.dgvLeaves.Clear(),this.oCMP.arrLstCPFields[0][5].length>0)for(var l=0;l<this.oCMP.arrLstCPFields[0][5].length;l++)(e=this.dgvLeaves.NewRow()).SlNo=(l+1).toString(),e.Leaves=this.oCMP.arrLstCPFields[0][5][l].ComponentName,e.ComponentID=this.oCMP.arrLstCPFields[0][5][l].ComponentID,e.LeaveSNo=this.oCMP.arrLstCPFields[0][5][l].SNo,e.TotOPBal=this.oCMP.arrLstCPFields[0][5][l].LeaveTotOPBal,e.MonOPBal=this.oCMP.arrLstCPFields[0][5][l].LeaveMonOPBal,e.LeavesTaken=this.oCMP.arrLstCPFields[0][5][l].LeaveTaken,e.NetBal=this.oCMP.arrLstCPFields[0][5][l].LeaveNetBal,e.IsEditable=this.oCMP.arrLstCPFields[0][5][l].IsEditable,e.IsVisible=this.oCMP.arrLstCPFields[0][5][l].IsVisible,this.dgvLeaves.addRow(e);if(0==this.dgvEarnings.Table.length){var d=this.dgvEarnings.NewRow();this.dgvEarnings.addRow(d)}if(0==this.dgvAccruals.Table.length){var c=this.dgvAccruals.NewRow();this.dgvAccruals.addRow(c)}if(0==this.dgvEarOTs.Table.length){var h=this.dgvEarOTs.NewRow();this.dgvEarOTs.addRow(h)}if(0==this.dgvDeductions.Table.length){var u=this.dgvDeductions.NewRow();this.dgvDeductions.addRow(u)}if(0==this.dgvDedNetSal.Table.length){var g=this.dgvDedNetSal.NewRow();this.dgvDedNetSal.addRow(g)}if(0==this.dgvLeaves.Table.length){var D=this.dgvLeaves.NewRow();this.dgvLeaves.addRow(D)}if(0==this.dgvLoans.Table.length){var y=this.dgvLoans.NewRow();this.dgvLoans.addRow(y)}this.dgvDays.Table[1].Days=this.oCMP.arrLstOthMPFields[0].DaysAttended.ToString("0.0"),this.dgvDays.Table[2].Days=this.oCMP.arrLstOthMPFields[0].PaidLeaves.ToString("0.0"),this.dgvDays.Table[3].Days=this.oCMP.arrLstOthMPFields[0].TotalLeaves.ToString("0.0"),this.dgvDays.Table[4].Days=this.oCMP.arrLstOthMPFields[0].WeeklyOffs.ToString("0.0"),this.dgvDays.Table[5].Days=this.oCMP.arrLstOthMPFields[0].Holidays.ToString("0.0"),this.dgvDays.Table[6].Days=this.oCMP.arrLstOthMPFields[0].LOPDays.ToString("0.0"),this.dgvDays.Table[7].Days=this.oCMP.arrLstOthMPFields[0].UnpaidDays.ToString("0.0"),this.dgvDays.Columns[1].footer=this.oCMP.arrLstOthMPFields[0].TotalDays.ToString("0.0"),this.dgvDays.UpdateFooter();for(var P=0;P<this.dgvDays.Table.length;P++)this.dgvDays.updateRow(this.dgvDays.Table[P]);this.dgvEarnings.Columns[2].footer=this.oCMP.arrLstOthMPFields[0].totActEarnings.ToString(r.a.SessionManager.sPayrollDecimals),this.dgvEarnings.Columns[3].footer=this.oCMP.arrLstOthMPFields[0].totEarnings.ToString(r.a.SessionManager.sPayrollDecimals),this.dgvEarnings.Columns[4].footer=this.oCMP.arrLstOthMPFields[0].totEarArrears.ToString(r.a.SessionManager.sPayrollDecimals),this.dgvEarnings.Columns[5].footer=this.oCMP.arrLstOthMPFields[0].totEarAdjustments.ToString(r.a.SessionManager.sPayrollDecimals),this.dgvEarOTs.Columns[1].footer=parseFloat(this.oCMP.arrLstOthMPFields[0].totOTHours).ToString(r.a.SessionManager.sPayrollDecimals2),this.dgvEarOTs.Columns[2].footer=this.oCMP.arrLstOthMPFields[0].totOTAmount.ToString(r.a.SessionManager.sPayrollDecimals),this.dgvDeductions.Columns[2].footer=this.oCMP.arrLstOthMPFields[0].totActDeductions.ToString(r.a.SessionManager.sPayrollDecimals),this.dgvDeductions.Columns[3].footer=this.oCMP.arrLstOthMPFields[0].totDeductions.ToString(r.a.SessionManager.sPayrollDecimals),this.dgvDeductions.Columns[4].footer=this.oCMP.arrLstOthMPFields[0].totDedArrears.ToString(r.a.SessionManager.sPayrollDecimals),this.dgvDeductions.Columns[5].footer=this.oCMP.arrLstOthMPFields[0].totDedAdjustments.ToString(r.a.SessionManager.sPayrollDecimals),this.dgvLoans.Columns[4].footer=this.oCMP.arrLstOthMPFields[0].totLoans.ToString(r.a.SessionManager.sPayrollDecimals),this.dgvLeaves.Columns[2].footer=this.oCMP.arrLstOthMPFields[0].totOPBalLeaves.ToString("0.00"),this.dgvLeaves.Columns[3].footer=this.oCMP.arrLstOthMPFields[0].totLeavesTaken.ToString("0.00"),this.dgvLeaves.Columns[4].footer=this.oCMP.arrLstOthMPFields[0].totNetBalLeaves.ToString("0.00"),this.dgvEarnings.UpdateFooter(),this.dgvEarOTs.UpdateFooter(),this.dgvDeductions.UpdateFooter(),this.dgvLoans.UpdateFooter(),this.dgvLeaves.UpdateFooter(),this.sBasicMonthly=this.oCMP.arrLstOthMPFields[0].BasicMonthly.ToString(r.a.SessionManager.sPayrollDecimals),this.NetSalary.Text=this.oCMP.arrLstOthMPFields[0].NetSalary.ToString(r.a.SessionManager.sPayrollDecimals),this.CheckViewForUser(0),0==this.dgvEarnings.Table.filter((function(e){return"False"!=e.IsVisible})).length&&this.dgvEarnings.addRow(this.dgvEarnings.NewRow()),0==this.dgvAccruals.Table.filter((function(e){return"False"!=e.IsVisible})).length&&this.dgvAccruals.addRow(this.dgvAccruals.NewRow()),0==this.dgvEarOTs.Table.filter((function(e){return"False"!=e.IsVisible})).length&&this.dgvEarOTs.addRow(this.dgvEarOTs.NewRow()),0==this.dgvDeductions.Table.filter((function(e){return"False"!=e.IsVisible})).length&&this.dgvDeductions.addRow(this.dgvDeductions.NewRow()),0==this.dgvLoans.Table.filter((function(e){return"False"!=e.IsVisible})).length&&this.dgvLoans.addRow(this.dgvLoans.NewRow()),0==this.dgvLeaves.Table.filter((function(e){return"False"!=e.IsVisible})).length&&this.dgvLeaves.addRow(this.dgvLeaves.NewRow()),this.dgvDays.Table.length<10&&this.dgvDays.AddExtraEmptyRows(5);var C=r.a.empService.GetQueryData(r.a.SessionManager.RoleID,"MPL009","","","");if(null!=C&&C.length>0){var m=new o.f;if(m.ReadXml(o.e.String(C[0].ValueXml)),null!=m&&m.Tables.length>0&&m.Tables[0].length>0){for(var p=[],M=[],S=[],f=[],E=[],F=function(e){null!=(p=m.Tables[0].filter((function(a){return a.Name==t.dgvEarnings.Table[e].Earnings})))&&p.length>0?t.dgvEarnings.Table[e].IndexValue=parseInt(p[0].Index):null!=(p=m.Tables[0].filter((function(a){return a.ID==t.dgvEarnings.Table[e].ComponentID})))&&p.length>0?t.dgvEarnings.Table[e].IndexValue=parseInt(p[0].Index):(p=m.Tables[0].filter((function(a){return a.ID=="-"+t.dgvEarnings.Table[e].ComponentID})),t.dgvEarnings.Table[e].IndexValue=null!=p&&p.length>0?parseInt(p[0].Index):e)},T=0;T<this.dgvEarnings.Table.length;T++)F(T);for(var A=function(e){null!=(M=m.Tables[0].filter((function(a){return a.Name==t.dgvDeductions.Table[e].Deductions})))&&M.length>0?t.dgvDeductions.Table[e].IndexValue=parseInt(M[0].Index):null!=(M=m.Tables[0].filter((function(a){return a.ID==t.dgvDeductions.Table[e].ComponentID})))&&M.length>0?t.dgvDeductions.Table[e].IndexValue=parseInt(M[0].Index):(M=m.Tables[0].filter((function(a){return a.ID=="-"+t.dgvDeductions.Table[e].ComponentID})),t.dgvDeductions.Table[e].IndexValue=null!=M&&M.length>0?parseInt(M[0].Index):e)},L=0;L<this.dgvDeductions.Table.length;L++)A(L);for(var v=function(e){null!=(S=m.Tables[0].filter((function(a){return a.Name==t.dgvLoans.Table[e].Loans})))&&S.length>0?t.dgvLoans.Table[e].IndexValue=parseInt(S[0].Index):null!=(S=m.Tables[0].filter((function(a){return a.ID==t.dgvLoans.Table[e].ComponentID})))&&S.length>0?t.dgvLoans.Table[e].IndexValue=parseInt(S[0].Index):(S=m.Tables[0].filter((function(a){return a.ID=="-"+t.dgvLoans.Table[e].ComponentID})),t.dgvLoans.Table[e].IndexValue=null!=S&&S.length>0?parseInt(S[0].Index):e)},I=0;I<this.dgvLoans.Table.length;I++)v(I);for(var b=function(e){null!=(f=m.Tables[0].filter((function(a){return a.Name==t.dgvLeaves.Table[e].Leaves})))&&f.length>0?t.dgvLeaves.Table[e].IndexValue=parseInt(f[0].Index):null!=(f=m.Tables[0].filter((function(a){return a.ID==t.dgvLeaves.Table[e].ComponentID+"'"})))&&f.length>0?t.dgvLeaves.Table[e].IndexValue=parseInt(f[0].Index):(f=m.Tables[0].filter((function(a){return a.ID=="-"+t.dgvLeaves.Table[e].ComponentID})),t.dgvLeaves.Table[e].IndexValue=null!=f&&f.length>0?parseInt(f[0].Index):e)},N=0;N<this.dgvLeaves.Table.length;N++)b(N);for(var O=function(e){null!=(E=m.Tables[0].filter((function(a){return a.Name=t.dgvAccruals.Table[e].Earnings})))&&E.length>0?t.dgvAccruals.Table[e].IndexValue=parseInt(E[0].Index):null!=(E=m.Tables[0].filter((function(a){return a.ID==t.dgvAccruals.Table[e].ComponentID})))&&E.length>0?t.dgvAccruals.Table[e].IndexValue=parseInt(E[0].Index):(E=m.Tables[0].filter((function(a){return a.ID=="-"+t.dgvAccruals.Table[e].ComponentID})),t.dgvAccruals.Table[e].IndexValue=null!=E&&E.length>0?parseInt(E[0].Index):e)},V=0;V<this.dgvAccruals.Table.length;V++)O(V)}var w=this.dgvEarnings.Table;w.sort((function(e,t){return e.IndexValue-t.IndexValue})),this.dgvEarnings.Table=w;var R=this.dgvDeductions.Table;R.sort((function(e,t){return e.IndexValue-t.IndexValue})),this.dgvDeductions.Table=R;var x=this.dgvLoans.Table;x.sort((function(e,t){return e.IndexValue-t.IndexValue})),this.dgvLoans.Table=x;var k=this.dgvLeaves.Table;k.sort((function(e,t){return e.IndexValue-t.IndexValue})),this.dgvLeaves.Table=k;var W=this.dgvAccruals.Table;W.sort((function(e,t){return e.IndexValue-t.IndexValue})),this.dgvAccruals.Table=W}this.dgvEarOTs.AddExtraEmptyRows(10),this.dgvEarnings.AddExtraEmptyRows(20),this.dgvAccruals.AddExtraEmptyRows(20),this.dgvDeductions.AddExtraEmptyRows(20),this.dgvLoans.AddExtraEmptyRows(20),this.dgvLeaves.AddExtraEmptyRows(20)}},{key:"GetLinkReferenceData",value:function(e,t,a){var s=this;try{Logger.InfoLog("MonthlyPayrollViewModel:: Entering GetLinkReferenceData()"),a>0&&function(){var o=[];o.push(e),o.push(t),o.push(a),o.push((new Date).ToString("dd/MMM/yyyy")),o.push(0),o.push("<XML></XML>"),o.push(0),o.push(r.a.SessionManager.LanguageID);var i=r.a.empService.GetLinkReferenceDataMontlyPayroll(o);if(null!=i&&i.Tables.length>0&&i.Tables[0].length>0&&i.Columns[0].length>0&&(s.HeaderFields.forEach((function(e){for(var t=0;t<i.Columns[0].length;t++)s.FillLocalReference(i,e)})),s.CustomTab.Pages.length>s.iStaticTabCnt))for(var n=s.iStaticTabCnt;n<s.CustomTab.Pages.length;n++)s.CustomTab.Pages[n].Fields.forEach((function(e){s.FillLocalReference(i,e)}))}(),Logger.InfoLog("MonthlyPayrollViewModel:: Exiting GetLinkReferenceData()")}catch(o){Logger.ErrorLog("MonthlyPayrollViewModel::EXCEPTION GetLinkReferenceData()\r\n"+o.Message+"\r\n"+o.stack)}}},{key:"FillLocalReference",value:function(e,t){try{Logger.InfoLog("MonthlyPayrollViewModel::Entering FillLocalReference()");for(var a=0;a<e.Columns[0].length;a++)if(t instanceof S.c&&!o.e.IsEmpty(t.DBColumnName)&&e.Columns[0].Contains(t.DBColumnName))if(t instanceof d.d)t.Text=o.e.String(e.Tables[0][0][t.DBColumnName]);else if(t instanceof P.e)t.SelectedValue=o.e.String(e.Tables[0][0][t.DBColumnName]);else if(t instanceof d.c)t.Text=o.e.String(e.Tables[0][0][t.DBColumnName]);else if(t instanceof g.b)!o.e.IsEmpty(e.Tables[0][0][t.DBColumnName])&&o.e.isValidDate(e.Tables[0][0][t.DBColumnName].toString())&&(t.Date=new Date(e.Tables[0][0][t.DBColumnName].toString()));else if(t instanceof g.c)!o.e.IsEmpty(e.Tables[0][0][t.DBColumnName])&&o.e.isValidDate(e.Tables[0][0][t.DBColumnName].toString())&&(t.Date=new Date(e.Tables[0][0][t.DBColumnName].toString()));else if(t instanceof g.a)!o.e.IsEmpty(e.Tables[0][0][t.DBColumnName])&&o.e.isValidDate(e.Tables[0][0][t.DBColumnName].toString())&&(t.Date=new Date(e.Tables[0][0][t.DBColumnName].toString()));else if(t instanceof D.a)t.Text=o.e.String(e.Tables[0][0][t.DBColumnName]);else if(t instanceof y.b){var s;s=o.e.Int(e.Tables[0][0][t.DBColumnName]),!o.e.IsEmpty(e.Tables[0][0][t.DBColumnName])&&s>0&&(t.SelectedValue=parseInt(o.e.String(e.Tables[0][0][t.DBColumnName])))}Logger.InfoLog("MonthlyPayrollViewModel::Exiting FillLocalReference()")}catch(r){Logger.ErrorLog("MonthlyPayrollViewModel::EXCEPTION FillLocalReference()\r\n"+r.Message+"\r\n"+r.stack)}}},{key:"CalculateTotalDays",value:function(){var e=0;e+=parseFloat(this.dgvDays.Table[1].Days),e+=parseFloat(this.dgvDays.Table[3].Days),e+=parseFloat(this.dgvDays.Table[6].Days),e+=parseFloat(this.dgvDays.Table[7].Days),this.dgvDays.Columns[1].footer=e.ToString("0.0"),this.dgvDays.UpdateFooter()}},{key:"dgvDeductions_BeginEdit",value:function(e,t,a){if("Actual"==(t=e.args.column.field)||"Deducted"==t||"EarDedType"==t){if("Actual"!=t&&"Deducted"!=t)return e.args.Cancel=!1,!1;if("1"==o.e.String(e.args.item.IsEditable))return e.args.Cancel=!1,!1}return e.args.Cancel=!0,!0}},{key:"dgvDeductions_EndEdit",value:function(e,t,a){var s=e.item;"Actual"!=(t=e.column.field)&&"Deducted"!=t||null==this.oCMP||(""==o.e.String(s[t]).Trim()&&(s[t]=(0).ToString(r.a.SessionManager.sPayrollDecimals)),this.dgvDeductionsEndEdit(parseInt(s.DedSNo),s[t].toString()))}},{key:"dgvEarnings_BeginEdit",value:function(e,t,a){if("Actual"==(t=e.args.column.field)||"Earned"==t||"EarDedType"==t){if("Actual"!=t&&"Earned"!=t)return e.args.Cancel=!1,!1;if("1"==o.e.String(e.args.item.IsEditable))return e.args.Cancel=!1,!1}return e.args.Cancel=!0,!0}},{key:"dgvEarningsEndEdit",value:function(e,t){this.oCMP.ReEvaluateData(0,0,e,t),this.FillProcessedData()}},{key:"dgvDeductionsEndEdit",value:function(e,t){this.oCMP.ReEvaluateData(0,2,e,t),this.FillProcessedData()}},{key:"dgvEarnings_EndEdit",value:function(e,t,a){var s=e.item;"Actual"!=(t=e.column.field)&&"Earned"!=t||null==this.oCMP||(""==o.e.String(s[t]).Trim()&&(s[t]=(0).ToString(r.a.SessionManager.sPayrollDecimals)),this.dgvEarningsEndEdit(parseInt(s.EarSNo),s[t].toString()))}},{key:"dgvAccruals_BeginEdit",value:function(e,t,a){if("Actual"==(t=e.args.column.field)||"Earned"==t||"EarDedType"==t){if("Actual"!=t&&"Earned"!=t)return e.args.Cancel=!1,!1;if("1"==o.e.String(e.args.item.IsEditable))return e.args.Cancel=!1,!1}return e.args.Cancel=!0,!0}},{key:"dgvAccruals_EndEdit",value:function(e,t,a){var s=e.item;"Actual"!=(t=e.column.field)&&"Earned"!=t||null==this.oCMP||(""==o.e.String(s[t]).Trim()&&(s[t]=(0).ToString(r.a.SessionManager.sPayrollDecimals)),this.dgvAccrualsEndEdit(parseInt(s.EarSNo),s[t].toString()))}},{key:"dgvAccrualsEndEdit",value:function(e,t){this.oCMP.ReEvaluateData(0,0,e,t),this.FillProcessedData()}},{key:"dgvEarOTs_BeginEdit",value:function(e,t,a){return"Hours"==e.args.column.field&&null!=this.oCMP&&this.oCMP.arrLstOthMPFields[0].IsAllowOT&&"1"==o.e.String(e.args.item.IsEditable)?(e.args.Cancel=!1,!1):(e.args.Cancel=!0,!0)}},{key:"dgvEarOTs_EndEdit",value:function(e,t,a){var s=e.item;"Hours"==(t=e.column.field)&&null!=this.oCMP&&(""==o.e.String(s[t]).toString().Trim()&&(s[t]=(0).ToString(r.a.SessionManager.sPayrollDecimals2)),this.oCMP.ReEvaluateData(0,1,parseInt(s.EarSNo),s[t].toString()),this.FillProcessedData())}},{key:"dgvDays_BeginEdit",value:function(e,t,a){return"Days"==e.args.column.field&&"1"==o.e.String(e.args.item.IsEditable)?(e.args.Cancel=!1,!1):(e.args.Cancel=!0,!0)}},{key:"Web_dgvDays_EndEdit",value:function(e,t){"Days Attended"==e?(this.oCMP.SetDaysAttended(0,"Days Attended",parseFloat(t)),this.DisplayMessage=this.oCMP.arrLstOthMPFields[0].LOPDays<0?r.a.GetResource("EnterValidDaysAttended"):this.oCMP.arrLstOthMPFields[0].dblLeavesLOP>0&&this.oCMP.arrLstOthMPFields[0].LOPDays<this.oCMP.arrLstOthMPFields[0].dblLeavesLOP?"Employee Should have atleast "+this.oCMP.arrLstOthMPFields[0].dblLeavesLOP+" LOP Days":"",this.dgvDays.Table[6].Days=this.oCMP.arrLstOthMPFields[0].LOPDays.ToString("0.0")):"Absent(LOP)"==e&&this.oCMP.SetDaysAttended(0,"LOP",parseFloat(t)),this.FillProcessedData()}},{key:"dgvDays_EndEdit",value:function(e,t,a){try{t=e.column.field;var s=e.item;Logger.InfoLog("MonthlyPayrollViewModel::Entering dgvDays_EndEdit()"),"Days"==t&&null!=this.oCMP&&(""==o.e.String(s[t]).Trim()&&(s[t]="0.0"),"Days Attended"==s.Particulars.toString()?(this.oCMP.SetDaysAttended(0,"Days Attended",parseFloat(s[t])),this.oCMP.arrLstOthMPFields[0].LOPDays<0?(this.DisplayMessage=r.a.GetResource("EnterValidDaysAttended"),this.MessageVisibility=!0):this.oCMP.arrLstOthMPFields[0].dblLeavesLOP>0&&this.oCMP.arrLstOthMPFields[0].LOPDays<this.oCMP.arrLstOthMPFields[0].dblLeavesLOP?(this.DisplayMessage="Employee Should have atleast "+this.oCMP.arrLstOthMPFields[0].dblLeavesLOP+" LOP Days",this.MessageVisibility=!0):this.DisplayMessage="",this.dgvDays.Table[6].Days=this.oCMP.arrLstOthMPFields[0].LOPDays.ToString("0.0")):"Absent(LOP)"==o.e.String(s.Particulars)&&this.oCMP.SetDaysAttended(0,"LOP",parseFloat(s[t])),this.FillProcessedData()),Logger.InfoLog("MonthlyPayrollViewModel::Exiting dgvDays_EndEdit()")}catch(i){Logger.ErrorLog("MonthlyPayrollViewModel::EXCEPTION dgvDays_EndEdit()\r\n"+i.Message+"\r\n"+i.stack)}}},{key:"ClearControls",value:function(){var e=this;try{Logger.InfoLog("MonthlyPayrollViewModel::Entering ClearControls()"),this.objMonPay={},this.sBasicMonthly=(0).ToString(r.a.SessionManager.sPayrollDecimals),this.NetSalary.Text=(0).ToString(r.a.SessionManager.sPayrollDecimals),this.Remarks.Text="",this.sPayrollMonth=" / ["+r.a.SessionManager.PayrollMonth.ToString("MMM-yyyy")+"]",this.dgvDays.Table[0].Days="Actual Days"==r.a.SessionManager.Preferences.PayDays?"True"==r.a.SessionManager.Preferences.SetPayrollMonthToEndDateMonth?r.a.SessionManager.PayrollMonth.DaysInMonth().ToString("0.0"):(r.a.SessionManager.PayrollMonthEnd.Subtract(r.a.SessionManager.PayrollMonthStart).Days+1).ToString("0.0"):parseFloat(r.a.SessionManager.Preferences.PayDays).ToString("0.0"),this.dgvDays.Table[1].Days="0.0",this.dgvDays.Table[2].Days="0.0",this.dgvDays.Table[3].Days="0.0",this.dgvDays.Table[4].Days="0.0",this.dgvDays.Table[5].Days="0.0",this.dgvDays.Table[6].Days="0.0",this.dgvDays.Table[7].Days="0.0",this.dgvDays.Columns[1].footer="0.0",this.dgvDays.UpdateFooter();for(var t=0;t<this.dgvDays.Table.length;t++)this.dgvDays.updateRow(this.dgvDays.Table[t]);this.dgvEarOTs.Clear();var a=this.dgvEarOTs.NewRow();if(this.dgvEarOTs.addRow(a),this.dgvEarOTs.Columns[1].footer=(0).ToString(r.a.SessionManager.sPayrollDecimals2),this.dgvEarOTs.Columns[2].footer=(0).ToString(r.a.SessionManager.sPayrollDecimals),this.dgvEarOTs.UpdateFooter(),this.dgvEarnings.Clear(),a=this.dgvEarnings.NewRow(),this.dgvEarnings.addRow(a),this.dgvEarnings.Columns[2].footer=(0).ToString(r.a.SessionManager.sPayrollDecimals),this.dgvEarnings.Columns[3].footer=(0).ToString(r.a.SessionManager.sPayrollDecimals),this.dgvEarnings.Columns[4].footer=(0).ToString(r.a.SessionManager.sPayrollDecimals),this.dgvEarnings.Columns[5].footer=(0).ToString(r.a.SessionManager.sPayrollDecimals),this.dgvEarnings.UpdateFooter(),this.dgvAccruals.Clear(),this.dgvAccruals.NewRow(),this.dgvDeductions.Clear(),a=this.dgvDeductions.NewRow(),this.dgvDeductions.addRow(a),this.dgvDeductions.Columns[2].footer=(0).ToString(r.a.SessionManager.sPayrollDecimals),this.dgvDeductions.Columns[3].footer=(0).ToString(r.a.SessionManager.sPayrollDecimals),this.dgvDeductions.Columns[4].footer=(0).ToString(r.a.SessionManager.sPayrollDecimals),this.dgvDeductions.Columns[5].footer=(0).ToString(r.a.SessionManager.sPayrollDecimals),this.dgvDeductions.UpdateFooter(),this.dgvLoans.Clear(),a=this.dgvLoans.NewRow(),this.dgvLoans.addRow(a),this.dgvLoans.Columns[4].footer=(0).ToString(r.a.SessionManager.sPayrollDecimals),this.dgvLoans.UpdateFooter(),this.dgvLeaves.Clear(),a=this.dgvLeaves.NewRow(),this.dgvLeaves.addRow(a),this.dgvLeaves.Columns[2].footer=(0).ToString("0.00"),this.dgvLeaves.Columns[3].footer=(0).ToString("0.00"),this.dgvLeaves.Columns[4].footer=(0).ToString("0.00"),this.dgvLeaves.UpdateFooter(),this.dgvDays.Table.length<10&&this.dgvDays.AddExtraEmptyRows(5),this.dgvEarOTs.AddExtraEmptyRows(10),this.dgvEarnings.AddExtraEmptyRows(20),this.dgvAccruals.AddExtraEmptyRows(20),this.dgvDeductions.AddExtraEmptyRows(20),this.dgvLoans.AddExtraEmptyRows(20),this.dgvLeaves.AddExtraEmptyRows(20),this.HeaderFields.forEach((function(t){e.SetProperty_DefaultValue(t)})),this.CustomTab.Pages.length>this.iStaticTabCnt)for(var s=this.iStaticTabCnt;s<this.CustomTab.Pages.length;s++)this.CustomTab.Pages[s].Fields.forEach((function(t){e.SetProperty_DefaultValue(t)}));this.DocID=0,this.DocNo="",this.DocStatus="[UnPosted]",this.DisplayMessage="",this.oCMP=null,this.objArrVM=null,this.dtArrData=null,this.sArrsCalcMonths="",this.sArrCalcMonthPaydays="",this.strArrearsDays="",this.strWorkSheetXML="",this.dtWorkSheet=null,this.dtAdjData=null,this.dtDSData=null,this.IsArrearsEnabled=!0,this.IsAdjustmentsEnabled=!0,this.ApproveVisibility=!1,Logger.InfoLog("MonthlyPayrollViewModel::Exiting ClearControls()")}catch(o){Logger.ErrorLog("MonthlyPayrollViewModel::EXCEPTION SetProperties_Custom()\r\n"+o.Message+"\r\n"+o.stack)}}},{key:"PopupEmployeesFilter",value:function(){var e=this;try{return Logger.InfoLog("MonthlyPayrollViewModel::Entering PopupEmployeesFilter()"),r.a.SessionManager.Preferences.ContainsKey("MonthlyPayrollFilter")&&parseInt(r.a.SessionManager.Preferences.MonthlyPayrollFilter)>0?null==this.oEmpFilter?this.oEmpFilter=new f.a("",0,1):(this.oEmpFilter.CostCenterFilters.length>0?this.oEmpFilter.CostCenters.SelectedValue=this.oEmpFilter.CostCenterFilters[0].CostCenterID.toString():(this.oEmpFilter.Filter=1,this.oEmpFilter.InitControls()),this.oEmpFilter.CostCenters.Enable=!0):null==this.oEmpFilter?this.oEmpFilter=new f.a("",0,0):(this.oEmpFilter.Filter=0,this.oEmpFilter.InitControls()),this.oEmpFilter.Filter>0?r.a.page.ShowDialog(this.oEmpFilter,F.a,{ShowCenter:!0,HideHeader:!0}).subscribe((function(){e.empFilterTemp(),e.strCustomEmpFilter=e.strWhere,""==e.strCustomEmpFilter.toString()&&(e.strCustomEmpFilter=e.FilterEmployees()),e.EmployeeList.Code.CustomWhere=e.EmployeeList.Name.CustomWhere=e.strCustomEmpFilter})):this.empFilterTemp(),this.strWhere}catch(t){Logger.ErrorLog("MonthlyPayrollViewModel::EXCEPTION PopupEmployeesFilter()\r\n"+t.Message+"\r\n"+t.stack)}}},{key:"EmpTreeFilterCallBack",value:function(){this.empFilterTemp()}},{key:"empFilterTemp",value:function(){var e=this,t="",a="";if(this.DialogResult=this.oEmpFilter.IsCompleted,this.oEmpFilter.IsCompleted)if(this.oEmpFilter.CostCenterFilters.length>0){var s=1,i="",n="";this.sbDimWhere="",this.oEmpFilter.CostCenterFilters.forEach((function(t){if(t.CostCenterID>5e4&&(s=2,i="NodeID",n=50051==t.CostCenterID?"EmpSeqNo":"CCNID"+(t.CostCenterID-5e4)),t.SelectedNodes.length>0){if(1==t.SelectedNodes.length)e.sbDimWhere+=" AND ",e.sbDimWhere+=n+"="+t.SelectedNodes[0].Id;else if(null==t.SelectedNodes.find((function(e){return e.Id==s&&e.IsGroup})))if(e.sbDimWhere+=" AND ",E.IPrefetchFilter.IsGroupTree(t)){for(var a="",r=0;r<t.SelectedNodes.length;r++)null!=t.SelectedNodes[r].Parent&&t.SelectedNodes[r].Parent.IsSelected||(a.length>0&&(a+=","),a+=t.SelectedNodes[r].Id);0==a.length&&(a+=-12912),e.sbDimWhere+=n+" IN ",e.sbDimWhere+=" (select T."+i+" GTID from ",e.sbDimWhere+=e.GetTagTableName(t.CostCenterID)+" T with(nolock),",e.sbDimWhere+=e.GetTagTableName(t.CostCenterID)+" GTP with(nolock) where T.lft BETWEEN GTP.lft AND GTP.rgt AND GTP."+i+" IN ",e.sbDimWhere+=a.toString()+")  group by T."+i+")"}else{e.sbDimWhere+=n+" IN (";for(var o=0;o<t.SelectedNodes.length;o++)o>0&&(e.sbDimWhere+=","),e.sbDimWhere+=t.SelectedNodes[o].Id;e.sbDimWhere+=")"}}else t.DeleteButtonVisibility||(e.sbDimWhere+=" AND ",e.sbDimWhere+=n+"=-12912")})),t=this.sbDimWhere.toString(),t+=" AND ( CONVERT(DATETIME,EMP.DOJ) <='"+r.a.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")+"' AND CONVERT(DATETIME,EMP.DORelieve) >='"+r.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"' ) ","True"==r.a.SessionManager.Preferences.NPDontAllowPayrollProcessing&&(t+=" AND EmpSeqNo NOT IN ( Select NodeID From COM_CC50051 WITH(NOLOCK) ",t+=" Where ResignStatus = 'Posted' AND DateDiff(day, ISNULL(CONVERT(DATETIME, DORelieve), '01-Jan-9000'), '"+r.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"') <= 0 ",t+=" AND DateDiff(day, CONVERT(DATETIME, CONVERT(DATETIME, ('01-' + CONVERT(NVARCHAR(3), DATENAME(MONTH, ISNULL(CONVERT(DATETIME, DOResign), '01-Jan-9000'))) + '-' + CONVERT(NVARCHAR, YEAR(ISNULL(CONVERT(DATETIME, DOResign), '01-Jan-9000')))))), '"+r.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"') >= 0 ) "),"True"==r.a.SessionManager.Preferences.DontConsiderEmpsForPayroll&&parseInt(r.a.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)>0&&(t+=" AND NOT ( MONTH(CONVERT(DATETIME,EMP.DOJ))="+r.a.SessionManager.PayrollMonth.getMonth()+" AND YEAR(CONVERT(DATETIME,EMP.DOJ))="+r.a.SessionManager.PayrollMonth.getFullYear()+" AND DAY(CONVERT(DATETIME,EMP.DOJ))>="+parseInt(r.a.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)+" ) "),r.a.SessionManager.LocationID>0&&r.a.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&r.a.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(t+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+r.a.SessionManager.LocationID+")"),o.e.IsEmpty(r.a.SessionManager.sWHEmpFilteredEmpSeqNos)||(t+="  AND EmpSeqNo IN ("+r.a.SessionManager.sWHEmpFilteredEmpSeqNos+")");var l=[];l.push(r.a.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")),l.push(t),l.push(0),l.push(r.a.SessionManager.RoleID),l.push(r.a.SessionManager.UserID),l.push(r.a.SessionManager.LanguageID);var d=r.a.empService.ExecuteQuery_SP(l,"spPAY_GetEmpMasterCCDetails");if(d.Tables.length>0)if(d.Tables[0].length>0){for(var c=0;c<d.Tables[0].length;c++)a=a+d.Tables[0][c].EmpSeqNo.toString()+",";o.e.IsEmpty(a)||(a=a.substr(0,a.length-1),this.strWhere=" ( a.NodeId IN ("+a+"))")}else this.strWhere=" ( a.NodeId = 0)"}else this.oEmpFilter.Filter>0&&(this.strWhere=this.FilterEmployees())}},{key:"GetTagTableName",value:function(e){return 2==e?"ACC_Accounts":3==e?"INV_Product":7==e?"ADM_Users":50001==e?"COM_Division":50002==e?"COM_Location":50003==e?"COM_Branch":50004==e?"COM_Department":50005==e?"COM_Salesman":50006==e?"COM_Category":50007==e?"COM_Area":50008==e?"COM_Teritory":"COM_CC"+e}},{key:"onLoanClick",value:function(e){var t=this,a=new Date;j.RibbonExtViewModel.GetDocumentObject(40056,"",!1,"Payroll").then((function(e){var s={value:a};e.ScreenObject.OnDocPrefixChanged("lostFocus",0,parseInt(t.dgvLoans.Table[t.dgvLoans.SelectedIndex].NodeNo),s,!1),a=s.value,r.a.page.addNewTab({component:B.AddEditDocumentComponent,params:{obj:e}})}))}},{key:"ValidateControl",value:function(e,t){if(t.Message="",e instanceof d.d&&(t.Message=e.ValidateData()),e instanceof D.a)t.Message=e.GetValidationError("Text");else if(e instanceof d.c)t.Message=e.ValidateData();else if(e instanceof P.e)t.Message=e.GetValidationError("SelectedValue");else if(e instanceof g.c)t.Message=e.ValidateData();else if(e instanceof g.b)t.Message=e.ValidateData();else if(e instanceof g.a)t.Message=e.ValidateData();else if(e instanceof y.b){if(t.Message=e.GetValidationError("SelectedValue"),e.Visible&&!o.e.IsEmpty(e.Text)&&0==e.SelectedValue)return t.Message=r.a.GetResource("Invalid")+" "+e.Label.toString(),""}else if(e instanceof c.a&&e.CCID>2){if(e.CCID==r.a.SessionManager.RegisterCCID&&(e.Mandatory=!0),t.Message=e.GetValidationError("SelectedValue"),e.Visible&&!o.e.IsEmpty(e.Text)&&0==e.SelectedValue)return t.Message=r.a.GetResource("Invalid")+" "+e.Label.toString(),"";if(50051==e.CCID&&e.Mandatory&&0==e.SelectedValue)return t.Message=r.a.GetResource("Invalid")+" "+e.Label.toString(),""}return o.e.IsEmpty(t.Message),""}}]),n}(n.b)},"6sKv":function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var s=a("3Pt+"),r=a("fXoL"),o=a("q8k3"),i=a("ofXK"),n=a("sYmb");function l(e,t){if(1&e&&(r.Zb(0,"div",5),r.Wc(1,"\n                "),r.Vb(2,4),r.Wc(3,"\n            "),r.Yb()),2&e){var a=r.lc();r.Db(2),r.tc("obj",a.obj.txtPartialRExcessAmt)("group",a.form)}}function d(e,t){if(1&e&&(r.Zb(0,"div",5),r.Wc(1,"\n                "),r.Vb(2,4),r.Wc(3,"\n            "),r.Yb()),2&e){var a=r.lc();r.Db(2),r.tc("obj",a.obj.btnExcessPay)("group",a.form)}}var c=function(){var e=function(){function e(){_classCallCheck(this,e),this.form=new s.j({})}return _createClass(e,[{key:"ngOnInit",value:function(){}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=r.Nb({type:e,selectors:[["app-change-loan"]],inputs:{obj:"obj"},decls:56,vars:16,consts:[[1,"master-screen",2,"padding-bottom","4px","width","200px"],[1,"PACTHeaderFields","dialogSubBody"],[1,"row"],[1,"form-group","row","form-row","col-xl-12","col-md-12","col-sm-12","col-xs-12","PACTControl"],["FieldDirective","",3,"obj","group"],[1,"form-group","row","form-row","col-xl-6","col-md-6","col-sm-12","col-xs-12","PACTControl"],["class","form-group row form-row col-xl-6 col-md-6 col-sm-12 col-xs-12 PACTControl",4,"ngIf"],[1,"Pactdailogfooter"],[1,"primary-btn-wicon",3,"click"],[1,"secondary-btn-wicon",3,"click"]],template:function(e,t){1&e&&(r.Zb(0,"div",0),r.Wc(1,"\n    "),r.Zb(2,"div",1),r.Wc(3,"\n        \n        "),r.Zb(4,"div",2),r.Wc(5,"\n            "),r.Zb(6,"div",3),r.Wc(7,"\n                "),r.Vb(8,4),r.Wc(9,"\n            "),r.Yb(),r.Wc(10,"\n            \n        "),r.Yb(),r.Wc(11,"\n        "),r.Zb(12,"div",2),r.Wc(13,"\n            "),r.Zb(14,"div",5),r.Wc(15,"\n                "),r.Vb(16,4),r.Wc(17,"\n            "),r.Yb(),r.Wc(18,"\n            "),r.Uc(19,l,4,2,"div",6),r.Wc(20,"\n        "),r.Yb(),r.Wc(21,"\n        "),r.Zb(22,"div",2),r.Wc(23,"\n            "),r.Zb(24,"div",5),r.Wc(25,"\n                "),r.Vb(26,4),r.Wc(27,"\n            "),r.Yb(),r.Wc(28,"\n            "),r.Uc(29,d,4,2,"div",6),r.Wc(30,"\n            \n        "),r.Yb(),r.Wc(31,"\n        "),r.Zb(32,"div",2),r.Wc(33,"\n            "),r.Zb(34,"div",3),r.Wc(35,"\n                "),r.Vb(36,4),r.Wc(37,"\n            "),r.Yb(),r.Wc(38,"\n            \n        "),r.Yb(),r.Wc(39,"\n      \n    "),r.Yb(),r.Wc(40,"\n    "),r.Zb(41,"div",7),r.Wc(42,"\n      "),r.Zb(43,"div"),r.Wc(44,"\n        "),r.Zb(45,"button",8),r.hc("click",(function(){return t.obj.Button_Click("OK")})),r.Wc(46),r.mc(47,"translate"),r.Yb(),r.Wc(48,"\n        "),r.Zb(49,"button",9),r.hc("click",(function(){return t.obj.Button_Click("Cancel")})),r.Wc(50),r.mc(51,"translate"),r.Yb(),r.Wc(52,"\n      "),r.Yb(),r.Wc(53,"\n  "),r.Yb(),r.Wc(54,"\n"),r.Yb(),r.Wc(55,"\n")),2&e&&(r.Db(8),r.tc("obj",t.obj.rdbInstAmt)("group",t.form),r.Db(8),r.tc("obj",t.obj.rdbPartialRExcessAmt)("group",t.form),r.Db(3),r.tc("ngIf",t.obj.txtPartialRExcessAmt.Visible),r.Db(7),r.tc("obj",t.obj.rdbPostpone)("group",t.form),r.Db(3),r.tc("ngIf",t.obj.btnExcessPay.Visible),r.Db(7),r.tc("obj",t.obj.rdbExempt)("group",t.form),r.Db(10),r.Xc(r.nc(47,12,"Ok")),r.Db(4),r.Xc(r.nc(51,14,"Close")))},directives:[o.a,i.t],pipes:[n.d],encapsulation:2}),e}()},FZke:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var s=a("3Pt+"),r=a("fXoL"),o=a("sT9C"),i=a("sYmb"),n=function(){var e=function(){function e(){_classCallCheck(this,e),this.form=new s.j({})}return _createClass(e,[{key:"ngOnInit",value:function(){}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=r.Nb({type:e,selectors:[["app-adjustments"]],inputs:{obj:"obj"},decls:25,vars:8,consts:[[1,"master-screen",2,"padding-bottom","4px","width","900px"],[1,"PACTHeaderFields","dialogSubBody"],[1,"documentgrid","row","form-row",2,"width","100%"],[2,"width","100%",3,"obj","group"],[1,"Pactdailogfooter"],[1,"primary-btn-wicon",3,"click"],[1,"secondary-btn-wicon",3,"click"]],template:function(e,t){1&e&&(r.Zb(0,"div",0),r.Wc(1,"\n    "),r.Zb(2,"div",1),r.Wc(3,"\n        \n      "),r.Zb(4,"div",2),r.Wc(5,"\n        "),r.Ub(6,"app-PactGridView",3),r.Wc(7,"  \n      "),r.Yb(),r.Wc(8,"\n      \n    "),r.Yb(),r.Wc(9,"\n    "),r.Zb(10,"div",4),r.Wc(11,"\n      "),r.Zb(12,"div"),r.Wc(13,"\n        "),r.Zb(14,"button",5),r.hc("click",(function(){return t.obj.Button_Click("OK")})),r.Wc(15),r.mc(16,"translate"),r.Yb(),r.Wc(17,"\n        "),r.Zb(18,"button",6),r.hc("click",(function(){return t.obj.Button_Click("Cancel")})),r.Wc(19),r.mc(20,"translate"),r.Yb(),r.Wc(21,"\n      "),r.Yb(),r.Wc(22,"\n  "),r.Yb(),r.Wc(23,"\n"),r.Yb(),r.Wc(24,"\n")),2&e&&(r.Db(6),r.tc("obj",t.obj.dgv)("group",t.form),r.Db(9),r.Xc(r.nc(16,4,"Ok")),r.Db(4),r.Xc(r.nc(20,6,"Close")))},directives:[o.a],pipes:[i.d],encapsulation:2}),e}()},"PGQ+":function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var s=a("Do2H"),r=a("Lp6j"),o=a("MRsC"),i=a("VxiT"),n=a("uMy8"),l=a("vTM8"),d=function(){function e(){_classCallCheck(this,e),this.sSelectedEmpSeqNos="",this.sDisplayMessage="",this.sFilter="",this.sEmpSeqNo="",this.dsAllEmpsData=[],this.dtPayrollData=[],this.IsArrears=!1,this.IsAdjustments=!1,this.dAdjDays=0,this.dWklyoff=0,this.dHdays=0,this.dblMWeekOffs=0,this.dblMHolidays=0,this.oCPField=null,this.dtHolidayDef=null,this.lstHolidays=new Array,this.lstVacations=new Array,this.lstAccrAccumulateSNos=new Array,this.lstWeekoff=new Array,this.IsCompleted=!1,this.IsPostFullAttendance=!1,this.IsPostBasedOnDailyAttendance=!1,this.IsPostBasedOnAttDimWise=!1,this.IncludeOTHours=!1,this.IsArrearclick=!1,this.ArrGradeID=1,this.iEmpIndex=0,this.VacationFieldSNo=0,this.dblVacationDays=0,this.dblVacationDaysEncash=0,this.dVacDays=0,this.dVacPayYes=0,this.dVacPayNo=0,this.ExcludeWeeklyOff=!1,this.ExcludeHolidays=!1,this.dblLeavesLOP=0,this.dsEarDedExtra=null,this.fldDict=new l.a,Logger.InfoLog("CommonMonthlyPayroll::Entering CommonMonthlyPayroll()"),Logger.InfoLog("CommonMonthlyPayroll::Exiting CommonMonthlyPayroll()")}return _createClass(e,[{key:"ProcessPayroll",value:function(){var e=this;if(this.sSelectedEmpSeqNos.length>0){this.LeaveYearStartmonth=new Date(parseInt(this.PayrollMonthStart.ToString("yyyy")),parseInt(s.a.SessionManager.Preferences.LeaveYear.toString()),1),this.LeaveYearEndmonth=this.LeaveYearStartmonth.AddMonths(12).AddDays(-1);var t=[];t.push(this.sSelectedEmpSeqNos),t.push(this.PayrollMonth.ToString("dd/MMM/yyyy")),t.push(this.PayrollMonthStart.ToString("dd/MMM/yyyy")),t.push(this.PayrollMonthEnd.ToString("dd/MMM/yyyy")),t.push(s.a.SessionManager.UserID),t.push(s.a.SessionManager.RoleID),t.push(s.a.SessionManager.LanguageID),this.dsAllEmpsData=s.a.empService.ExecuteQuery_SP(t,"spPAY_GetEmpPayrollDetailsMultiple");var a=[];if(a.push(s.a.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")),a.push(this.sFilter),a.push(0),a.push(s.a.SessionManager.RoleID),a.push(s.a.SessionManager.UserID),a.push(s.a.SessionManager.LanguageID),this.dsData=s.a.empService.ExecuteQuery_SP(a,"spPAY_GetEmpMasterCCDetails"),this.dsData1=s.a.empService.GetQueryData(0,"MPL004","","",""),this.dsData2=s.a.empService.GetQueryData(0,"MPL007","","",""),this.dsDocDesig=(new i.a).GetScreenInfo(40054),null!=this.dsAllEmpsData&&this.dsAllEmpsData.Tables.length>0&&this.dsAllEmpsData.Tables[0].length>0){var n=this.sSelectedEmpSeqNos.split(",");if(n.length>0)for(this.arrLstOthMPFields=new Array,this.arrLstCPFields=r.e.Array(n.length,7),this.iEmpIndex=0;this.iEmpIndex<n.length;this.iEmpIndex++){if(null!=n[this.iEmpIndex]&&""!=n[this.iEmpIndex].Trim()){var l=function(){e.arrLstCPFields[e.iEmpIndex][0]=new Array,e.arrLstCPFields[e.iEmpIndex][1]=new Array,e.arrLstCPFields[e.iEmpIndex][2]=new Array,e.arrLstCPFields[e.iEmpIndex][3]=new Array,e.arrLstCPFields[e.iEmpIndex][4]=new Array,e.arrLstCPFields[e.iEmpIndex][5]=new Array,e.arrLstCPFields[e.iEmpIndex][6]=new Array,e.othMPField=new o.c,e.arrLstOthMPFields.push(e.othMPField),e.othMPField.dsAllEmpsData=e.dsAllEmpsData,e.sEmpSeqNo=n[e.iEmpIndex];var t=0,a="";if(null!=e.dsData2&&e.dsData2.Tables.length>0&&null!=e.dsData2.Tables[0]&&e.dsData2.Tables[0].length>0){var i=[];null!=e.dsAllEmpsData.Tables[17]&&e.dsAllEmpsData.Tables[17].length>0&&(i=e.dsAllEmpsData.Tables[17]);for(var l=0;l<e.dsData2.Tables[0].length;l++){a=e.dsData2.Tables[0][l].SysColumnName.toString();var d=e.dsAllEmpsData.Tables[24].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo}));null!=d&&d.length>0&&(t=parseInt(d[0]["CCNID"+a.Replace("dcCCNID","")])),i=i.filter((function(e){return e[a]==t}))}if(null!=i&&null!=i&&i.length>0&&!r.e.IsEmpty(i[0].MPLockStatus)&&"Locked"==i[0].MPLockStatus.toString())return{v:(e.othMPField.sErrorMessage="Monthly Payroll Locked",void(e.IsCompleted=!0))}}var c,h=0,u=0,g=0,D=0,y=0,P=0,C=0,m=0,p=0,M=0;if(e.lstAccrAccumulateSNos=new Array,e.othMPField.dPTApplicableAmt=e.othMPField.dblGrossSalary=0,e.dblVacationDays=0,e.dblVacationDaysEncash=0,e.dblLeavesLOP=0,c="Actual Days"==s.a.SessionManager.Preferences.PayDays?e.PayrollMonthEnd.Subtract(e.PayrollMonthStart).Days+1:parseInt(s.a.SessionManager.Preferences.PayDays),e.othMPField.MonthDays=c,e.drcAllEmpsData=e.dsAllEmpsData.Tables[0].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),e.othMPField.drcAllEmpsData=e.drcAllEmpsData,e.othMPField.EmpSeqNo=e.sEmpSeqNo,e.othMPField.EmpCode=e.drcAllEmpsData[0].Code.toString(),e.othMPField.EmpName=e.drcAllEmpsData[0].Name.toString(),null!=e.dsAllEmpsData.Tables[14]&&e.dsAllEmpsData.Tables[14].length>0&&e.dsAllEmpsData.Columns[14].Contains("ServerMessage")&&null!=e.dsAllEmpsData.Tables[14][0].ServerMessage&&e.dsAllEmpsData.Tables[14][0].ServerMessage.toString().Contains("Invalid column name"))return{v:(e.othMPField.sErrorMessage="Please Enable Payroll Document Fields from Global Preferences (Payroll Tab) NumFields",void(e.IsCompleted=!0))};e.othMPField.DateOfJoining=new Date(e.drcAllEmpsData[0].CDOJ),e.othMPField.DateOfRelieve=null==e.drcAllEmpsData[0].CDORelieve||null==e.drcAllEmpsData[0].CDORelieve?new Date("01-Jan-9000"):new Date(e.drcAllEmpsData[0].CDORelieve),e.othMPField.dServiceDays=(new Date).Subtract(e.othMPField.DateOfJoining).Days+1,e.othMPField.CurrencyID=null==e.drcAllEmpsData[0].CurrencyID||""==e.drcAllEmpsData[0].CurrencyID.toString()||0==parseInt(e.drcAllEmpsData[0].CurrencyID)?1:parseInt(e.drcAllEmpsData[0].CurrencyID),e.othMPField.IsAllowOT=null!=e.drcAllEmpsData[0].IsAllowOT&&null!=e.drcAllEmpsData[0].IsAllowOT&&"No"!=e.drcAllEmpsData[0].IsAllowOT.toString(),null!=e.oParent&&"PostPayrollViewModel"==e.oParent.ClassName&&(e.othMPField.IsAllowOT=!(!e.othMPField.IsAllowOT||!e.IncludeOTHours)),e.drcEmpPay=e.dsAllEmpsData.Tables[2].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),e.drcEmpPay.length>0&&(e.othMPField.BasicMonthly=r.e.IsEmpty(e.drcEmpPay[0].BasicMonthly)||""==e.drcEmpPay[0].BasicMonthly.toString().Trim()?0:parseFloat(e.drcEmpPay[0].BasicMonthly)),e.drcWOffDef=e.dsAllEmpsData.Tables[4];var S=void 0,f=s.a.SessionManager.Preferences.WeeklyOffsDefBasedOn.split(","),E=" 1=1 ",F="";if(S=e.drcWOffDef,null!=f&&null!=f&&f.length>0)for(var T=0;T<f.length;T++)r.e.IsEmpty(f[T])||(F="CCNID"+(parseInt(f[T])-5e4),e.drcCCData=e.dsData.Tables[0].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),null!=e.drcCCData&&e.drcCCData.length>0&&(F.Contains("CCNID51")?(E+=" AND ( "+F+"="+e.drcCCData[0].EmpSeqNo+" OR "+F+"= 1)",S=S.filter((function(t){return t[F]==e.drcCCData[0].EmpSeqNo||1==t[F]}))):(E+=" AND ( "+F+"="+e.drcCCData[0][F]+" OR "+F+"= 1)",S=S.filter((function(t){return t[F]==e.drcCCData[0][F]||1==t[F]})))));" 1=1 "!=E&&(e.drcWOffDef=S),e.drcHolidayDef=e.dsAllEmpsData.Tables[5];var A=e.drcHolidayDef;if(f=s.a.SessionManager.Preferences.HolidaysBasedOn.split(","),E=" 1=1 ",F="",null!=f&&null!=f&&f.length>0)for(var L=0;L<f.length;L++)r.e.IsEmpty(f[L])||(F="CCNID"+(parseInt(f[L])-5e4),e.drcCCData=e.dsData.Tables[0].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),null!=e.drcCCData&&e.drcCCData.length>0&&(F.Contains("CCNID51")?(E+=" AND ( "+F+"="+e.drcCCData[0].EmpSeqNo+" OR "+F+"= 1)",A=A.filter((function(t){return t[F]==e.drcCCData[0].EmpSeqNo||1==t[F]}))):(E+=" AND ( "+F+"="+e.drcCCData[0][F]+" OR "+F+"= 1)",A=A.filter((function(t){return t[F]==e.drcCCData[0][F]||1==t[F]})))));if(" 1=1 "!=E&&(e.drcHolidayDef=A),null!=e.drcHolidayDef&&e.drcHolidayDef.length>0&&(e.dtHolidayDef=e.drcHolidayDef),e.lstHolidays.Clear(),null!=e.drcHolidayDef&&e.drcHolidayDef.length>0)for(var v=0;v<e.dsAllEmpsData.Tables[5].length;v++)e.lstHolidays.push(new Date(e.dsAllEmpsData.Tables[5][v].HolidayDate));if(e.drcPayProcessed=e.dsAllEmpsData.Tables[6].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),e.othMPField.drcPayProcessed=e.drcPayProcessed,null!=e.drcPayProcessed&&e.drcPayProcessed.length>0?(e.othMPField.IsAlreadyProcessed=!0,e.othMPField.DocStatus="["+e.drcPayProcessed[0].DocStatus.toString()+"]",e.othMPField.DocID=parseInt(e.drcPayProcessed[0].DocID),e.othMPField.DocNo=e.drcPayProcessed[0].DocNumber.toString(),e.othMPField.StatusID=parseInt(e.drcPayProcessed[0].StatusID)):(e.othMPField.IsAlreadyProcessed=!1,e.othMPField.DocStatus="[UnPosted]",e.othMPField.DocID=0,e.othMPField.DocNo="",e.othMPField.StatusID=0),e.IsPostFullAttendance&&(e.othMPField.IsAlreadyProcessed=!1),e.dsAllEmpsData.Tables[7].length>0&&(e.othMPField.WID=parseInt(e.dsAllEmpsData.Tables[7][0].WorkFlowID)),e.drcAssLeaves=e.dsAllEmpsData.Tables[8].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),e.drcApprLeaves=e.dsAllEmpsData.Tables[9].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),e.drcApprLoans=e.dsAllEmpsData.Tables[10].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),e.othMPField.drcApprLoans=e.drcApprLoans,e.drcLoanRepay=e.dsAllEmpsData.Tables[11].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),e.othMPField.drcLoanRepay=e.drcLoanRepay,1==e.IsArrearclick&&(e.dsAllEmpsData.Tables[12][0].GradeID=e.ArrGradeID),e.drcEmpGrades=e.dsAllEmpsData.Tables[12].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),e.drcPTDimension=e.dsAllEmpsData.Tables[13].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),e.othMPField.drcPTDimension=e.drcPTDimension,e.drcDailyAtten=e.dsAllEmpsData.Tables[14].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),e.IsPostFullAttendance&&0==e.drcDailyAtten.length&&s.a.SessionManager.Preferences.ContainsKey("ProcessMonthlyPayrollonlyifDailyAttendanceDataexists")&&"True"==s.a.SessionManager.Preferences.ProcessMonthlyPayrollonlyifDailyAttendanceDataexists.toString())return e.othMPField.sErrorMessage="Attendance data not found for the Employee","continue";if(e.drcDailyDays=e.dsAllEmpsData.Tables[15].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),e.drcRecData=e.dsAllEmpsData.Tables[16].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),e.othMPField.EmpGradeID=null!=e.drcEmpGrades&&e.drcEmpGrades.length>0?parseInt(e.drcEmpGrades[0].GradeID):1,e.othMPField.GradeID="True"==s.a.SessionManager.Preferences.GradeWiseMonthlyPayroll.toString()&&null!=e.drcEmpGrades&&e.drcEmpGrades.length>0?parseInt(e.drcEmpGrades[0].GradeID):1,1==e.IsArrearclick&&null!=e.drcArrStructure&&e.drcArrStructure.length>0){e.dsAllEmpsData.Tables[1].Clear();for(var I=0;I<e.drcArrStructure.length;I++)e.dsAllEmpsData.Tables[1].push(e.drcArrStructure[I])}if(e.drcStructure=e.dsAllEmpsData.Tables[1].filter((function(t){return t.GradeID==e.othMPField.GradeID})),0==e.drcStructure.length)return e.othMPField.sErrorMessage="Payroll Structure not found for this Employee","continue";if(e.drcVacations=e.dsAllEmpsData.Tables[18].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),e.drcArrears=e.dsAllEmpsData.Tables[19],e.drcArrears=e.dsAllEmpsData.Tables[19].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),e.othMPField.drcArrears=e.drcArrears,e.drcAdjustments=e.dsAllEmpsData.Tables[20],e.drcAdjustments=e.dsAllEmpsData.Tables[20].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),e.othMPField.drcAdjustments=e.drcAdjustments,e.drcLoanCrNetSalLessZero=e.dsAllEmpsData.Tables[21].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),e.othMPField.drcLoanCrNetSalLessZero=e.drcLoanCrNetSalLessZero,e.drcDues=e.dsAllEmpsData.Tables[22].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),e.othMPField.drcDues=e.drcDues,e.drcDependentInfo=e.dsAllEmpsData.Tables[23].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),e.drcAsOnDim=e.dsAllEmpsData.Tables[24],e.drcAsOnDim=e.dsAllEmpsData.Tables[24].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),e.othMPField.drcAsOnDim=e.drcAsOnDim,null!=e.dsAllEmpsData.Tables[26]&&e.dsAllEmpsData.Tables[26].length>0&&(e.VacationFieldSNo=parseInt(e.dsAllEmpsData.Tables[26][0].VacationField.toString()),e.othMPField.VacationComponentID=e.VacationFieldSNo),e.drcLEPay=e.dsAllEmpsData.Tables[27].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),e.drcADWData=e.dsAllEmpsData.Tables[28],e.drcADWData=e.dsAllEmpsData.Tables[28].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),e.othMPField.drcADWData=e.drcADWData,e.IsPostFullAttendance&&e.IsPostBasedOnAttDimWise&&0==e.drcADWData.length)return e.othMPField.sErrorMessage="Attendance Dimension wise data not found for the Employee","continue";if(e.drcVacFld=e.dsAllEmpsData.Tables[30].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),e.drcLatesProc=e.dsAllEmpsData.Tables[31].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),e.drcVacReJoin=e.dsAllEmpsData.Tables[32].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),e.drcVaclateReJoin=e.dsAllEmpsData.Tables[33].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),e.drcApprisal=e.dsAllEmpsData.Tables[34].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),e.drcApprisal.length>0&&(e.othMPField.AppraisalMonth=new Date(e.drcApprisal[0].CEffectFrom)),e.drcAllApprisal=e.dsAllEmpsData.Tables[35].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),e.drcAllApprovalDoc=e.dsAllEmpsData.Tables[36].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),s.a.SessionManager.Preferences.ContainsKey("DonotProcessPayrollIfDocumentareinApproval")&&"True"==s.a.SessionManager.Preferences.DonotProcessPayrollIfDocumentareinApproval.toString()&&null!=e.drcAllApprovalDoc&&e.drcAllApprovalDoc.length>0)return e.othMPField.sErrorMessage="Payroll can not Process Documents are in Approval","continue";e.drcPrevMonthPayroll=e.dsAllEmpsData.Tables[38];var b=e.dsAllEmpsData.Tables[38].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo}));if(s.a.SessionManager.Preferences.ContainsKey("DonotprocesspayrollifPreviousPayrollMonthnotprocessed")&&"True"==s.a.SessionManager.Preferences.DonotprocesspayrollifPreviousPayrollMonthnotprocessed.toString()){var N=new Date(e.othMPField.DateOfJoining.getFullYear(),e.othMPField.DateOfJoining.getMonth(),1);if(0==b.length&&e.PayrollMonth!=N)return e.othMPField.sErrorMessage="Previous Month Payroll is Not Processed","continue"}if(e.lstVacations.Clear(),e.othMPField.dGosi=0,null!=e.drcAllApprisal&&e.drcAllApprisal.length>0&&(e.drcAllApprisal=e.dsAllEmpsData.Tables[35].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo&&t.CEffectFrom<=e.PayrollMonthEnd.ToString("dd MMM yyyy")})),null!=e.drcAllApprisal&&e.drcAllApprisal.length>1&&(e.drcAllApprisal.sort((function(e,t){return t.CEffectFrom-e.CEffectFrom})),e.drcStructure=e.dsAllEmpsData.Tables[1].filter((function(t){return 1==t.Type&&"Yes"==t.Applicable&&t.GradeID==e.othMPField.GradeID})),null!=e.drcStructure&&e.drcStructure.length>0)))for(var O=0;O<e.drcStructure.length;O++)r.e.IsEmpty(s.a.SessionManager.Preferences.GosiComponent)||s.a.SessionManager.Preferences.GosiComponent!=e.drcStructure[O].ComponentID.toString()||(e.othMPField.dGosi=parseFloat(e.drcAllApprisal[1]["Earning"+parseInt(e.drcStructure[O].SNo)]));if(null!=e.drcVacFld&&e.drcVacFld.length>0){var V=e.dsAllEmpsData.Tables[30].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})).Compute("sum","VACDAYS");e.othMPField.dblTotMVacDays=parseFloat(V);var w=e.dsAllEmpsData.Tables[30].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})).Compute("sum","VACAMOUNT");e.othMPField.dblTotVacAmount=parseFloat(w);var R=e.dsAllEmpsData.Tables[30].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})).Compute("sum","ENCASHDAYS");e.othMPField.dblTotVacEncashDays=parseFloat(R);var x=e.dsAllEmpsData.Tables[30].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})).Compute("sum","ENCASHAMOUNT");e.othMPField.dblTotVacEncashAmount=parseFloat(x);var k=e.dsAllEmpsData.Tables[30].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})).Compute("sum","EXCESSDAYS");e.othMPField.dblTotVacExcessDays=parseFloat(k);var W=e.dsAllEmpsData.Tables[30].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})).Compute("sum","EXCESSAMOUNT");e.othMPField.dblTotVacExcessAmount=parseFloat(W);var j=e.dsAllEmpsData.Tables[30].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})).Compute("sum","NETTOTAL");e.othMPField.dblTotVacNetAmount=parseFloat(j)}if(null!=e.drcVacReJoin&&e.drcVacReJoin.length>0&&s.a.SessionManager.Preferences.ContainsKey("AllowPayrollProcessIfEmpOnVacation")&&"False"==s.a.SessionManager.Preferences.AllowPayrollProcessIfEmpOnVacation.toString())return e.othMPField.sErrorMessage="Payroll can not be processed. Because Employee is on VACATION. Please enter rejoin date.","continue";if(null!=e.drcVacations&&e.drcVacations.length>0){e.dblVacationDays=e.dblVacationDaysEncash=e.dVacPayYes=e.dVacPayNo=0;for(var B=0;B<e.drcVacations.length;B++)if(e.dVacDays=0,e.oVacation=new o.d,"01 Jan 1900"==new Date(e.drcVacations[B].ReJoinDate).ToString("dd MMM yyyy")?e.oVacation.DocDate=e.PayrollMonthEnd.AddDays(1):(e.oVacation.DocDate=new Date(e.drcVacations[B].ReJoinDate),e.oVacation.ActRejoinDate=e.drcVacations[B].ReJoinDate.toString()),e.oVacation.StartDate=new Date(e.drcVacations[B].FromDate),e.oVacation.EndDate=new Date(e.drcVacations[B].ToDate),!(e.oVacation.StartDate<=e.PayrollMonthStart&&e.oVacation.EndDate>=e.PayrollMonthStart||e.oVacation.StartDate<=e.PayrollMonthEnd&&e.oVacation.EndDate>=e.PayrollMonthEnd||e.PayrollMonthStart<=e.oVacation.StartDate&&e.PayrollMonthEnd>=e.oVacation.StartDate)||r.e.IsEmpty(e.drcVacations[B].IsEncash)||"YES"!=e.drcVacations[B].IsEncash.toString().toUpperCase()||r.e.IsEmpty(e.drcVacations[B].EncashedDays)){var _=0,G=new Date,H=new Date;if(e.oVacation.DocDate>=e.PayrollMonthStart&&(G=e.oVacation.EndDate>=e.PayrollMonthStart&&e.oVacation.EndDate<=e.PayrollMonthEnd?e.oVacation.EndDate.AddDays(1):e.PayrollMonthStart,H=e.oVacation.DocDate>=e.PayrollMonthStart&&e.oVacation.DocDate<=e.PayrollMonthEnd?e.oVacation.DocDate:e.PayrollMonthEnd.AddDays(1),e.oVacation.EndDate<H))for(;G<H;)_++,G=G.AddDays(1);e.oVacation.NotAttendedDays=_,e.oVacation.StartDate<=e.PayrollMonthStart&&e.oVacation.EndDate>=e.PayrollMonthStart||e.oVacation.StartDate<=e.PayrollMonthEnd&&e.oVacation.EndDate>=e.PayrollMonthEnd||e.PayrollMonthStart<=e.oVacation.StartDate&&e.PayrollMonthEnd>=e.oVacation.StartDate?(e.oVacation.ExcessDays=parseFloat(e.drcVacations[B].ExcessDays),e.dVacDays=e.oVacation.StartDate>=e.PayrollMonthStart?e.GetVacationDays(e.oVacation.StartDate,e.oVacation.EndDate<=e.PayrollMonthEnd?e.oVacation.DocDate<=e.oVacation.EndDate?e.oVacation.DocDate.AddDays(-1):e.oVacation.EndDate:e.oVacation.DocDate<=e.PayrollMonthEnd?e.oVacation.DocDate.AddDays(-1):e.PayrollMonthEnd,parseInt(e.drcVacations[B].DocID)):e.oVacation.EndDate<=e.PayrollMonthEnd?e.oVacation.DocDate<=e.oVacation.EndDate?e.oVacation.DocDate>=e.PayrollMonthStart?e.GetVacationDays(e.PayrollMonthStart,e.oVacation.DocDate.AddDays(-1),parseInt(e.drcVacations[B].DocID)):0:e.GetVacationDays(e.PayrollMonthStart,e.oVacation.EndDate,parseInt(e.drcVacations[B].DocID)):e.oVacation.DocDate<=e.oVacation.EndDate?e.oVacation.DocDate<=e.PayrollMonthEnd&&e.oVacation.DocDate>=e.PayrollMonthStart?e.GetVacationDays(e.PayrollMonthStart,e.oVacation.DocDate.AddDays(-1),parseInt(e.drcVacations[B].DocID)):e.oVacation.DocDate>=e.PayrollMonthEnd?e.GetVacationDays(e.PayrollMonthStart,e.PayrollMonthEnd,parseInt(e.drcVacations[B].DocID)):0:e.GetVacationDays(e.PayrollMonthStart,e.PayrollMonthEnd,parseInt(e.drcVacations[B].DocID)),e.oVacation.NotAttendedDays>0&&(e.dblLeavesLOP+=e.oVacation.NotAttendedDays),e.dVacDays>c&&(e.dVacDays=c),e.dblVacationDays+=e.dVacDays,e.lstVacations.push(e.oVacation),r.e.IsEmpty(e.drcVacations[B].PayWithSalary)||"YES"!=e.drcVacations[B].PayWithSalary.toString().toUpperCase()?e.dVacPayNo+=e.dVacDays:e.dVacPayYes+=e.dVacDays):e.oVacation.NotAttendedDays>0&&(e.oVacation.DocDate>=e.PayrollMonthStart&&e.oVacation.DocDate<=e.PayrollMonthEnd||e.oVacation.EndDate<=e.PayrollMonthStart&&e.oVacation.DocDate>=e.PayrollMonthEnd)&&(e.dblLeavesLOP+=e.oVacation.NotAttendedDays)}else e.dblVacationDaysEncash+=parseFloat(e.drcVacations[B].EncashedDays),e.oVacation.IsEncashDays=!0,e.lstVacations.push(e.oVacation);if(e.lstVacations.length>0&&!e.lstVacations[e.lstVacations.length-1].IsEncashDays&&e.lstVacations[e.lstVacations.length-1].StartDate<=e.PayrollMonthStart&&e.lstVacations[e.lstVacations.length-1].DocDate==e.PayrollMonthEnd.AddDays(1))if(null!=e.lstVacations[e.lstVacations.length-1].ActRejoinDate&&""!=e.lstVacations[e.lstVacations.length-1].ActRejoinDate&&new Date(e.lstVacations[e.lstVacations.length-1].ActRejoinDate)==e.lstVacations[e.lstVacations.length-1].DocDate);else if(s.a.SessionManager.Preferences.ContainsKey("AllowPayrollProcessIfEmpOnVacation")&&"False"==s.a.SessionManager.Preferences.AllowPayrollProcessIfEmpOnVacation.toString())return e.othMPField.sErrorMessage="Payroll can not be processed. Because Employee is on VACATION. Please enter rejoin date.","continue"}if(e.drcStructure=e.dsAllEmpsData.Tables[1].filter((function(t){return t.GradeID==e.othMPField.GradeID})),e.drcPr=e.dsAllEmpsData.Tables[6].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo&&11==t.VoucherType})),e.dsEarDedExtra=[],null!=e.drcPr&&e.drcPr.length>0&&(r.e.IsEmpty(e.drcPr[0].Remarks)||e.dsEarDedExtra.ReadXml(e.drcPr[0].Remarks.toString())),e.drcStructure=e.dsAllEmpsData.Tables[1].filter((function(t){return 1==t.Type&&"Yes"==t.Applicable&&"OverTime"!=t.FieldType&&t.GradeID==e.othMPField.GradeID})),null!=e.drcStructure&&e.drcStructure.length>0)for(var q=0;q<e.drcStructure.length;q++)e.oCPField=new o.a,e.oCPField.SNo=parseInt(e.drcStructure[q].SNo),e.oCPField.ComponentID=parseInt(e.drcStructure[q].ComponentID),e.oCPField.ComponentName=r.e.String(e.drcStructure[q].ComponentName),e.oCPField.Formula=r.e.String(e.drcStructure[q].Formula),e.oCPField.AddToNet=r.e.String(e.drcStructure[q].AddToNet),e.oCPField.ROff=parseFloat(e.drcStructure[q].ROff),e.oCPField.FieldType=r.e.String(e.drcStructure[q].FieldType),e.oCPField.MaxOTHrs=parseFloat(e.drcStructure[q].MaxOTHrs),e.oCPField.CalculateArrears=r.e.String(e.drcStructure[q].CalculateArrears),e.oCPField.CalculateAdjustments=r.e.String(e.drcStructure[q].CalculateAdjustments),"Monthly"==e.oCPField.FieldType?(e.oCPField.IsEditable=1,e.oCPField.IsReadOnly=0):(e.oCPField.IsEditable=0,e.oCPField.IsReadOnly=1),e.oCPField.Behaviour=r.e.IsEmpty(e.drcStructure[q].Behaviour)?"":e.drcStructure[q].Behaviour.toString(),"Accruals"!=e.oCPField.Behaviour&&"Accruals-AccumulateForPreviousYears"!=e.oCPField.Behaviour||(e.oCPField.IsAccrualType=!0,"Accruals-AccumulateForPreviousYears"==e.oCPField.Behaviour&&e.lstAccrAccumulateSNos.push(e.oCPField.SNo)),e.othMPField.IsAlreadyProcessed?null!=e.drcPr&&e.drcPr.length>0?(e.oCPField.dActual=null!=e.drcPr[0]["dcNum"+e.oCPField.SNo]&&null!=e.drcPr[0]["dcNum"+e.oCPField.SNo]&&""!=e.drcPr[0]["dcNum"+e.oCPField.SNo].toString()?parseFloat(e.drcPr[0]["dcNum"+e.oCPField.SNo]).ToString(s.a.SessionManager.sPayrollDecimals):(0).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.dEarned=null!=e.drcPr[0]["dcCalcNum"+e.oCPField.SNo]&&null!=e.drcPr[0]["dcCalcNum"+e.oCPField.SNo]&&""!=e.drcPr[0]["dcCalcNum"+e.oCPField.SNo].toString()?parseFloat(e.drcPr[0]["dcCalcNum"+e.oCPField.SNo]).ToString(s.a.SessionManager.sPayrollDecimals):(0).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.dArrear=null!=e.drcPr[0]["dcExchRT"+e.oCPField.SNo]&&null!=e.drcPr[0]["dcExchRT"+e.oCPField.SNo]&&""!=e.drcPr[0]["dcExchRT"+e.oCPField.SNo].toString()?parseFloat(e.drcPr[0]["dcExchRT"+e.oCPField.SNo]).ToString(s.a.SessionManager.sPayrollDecimals).Replace(",",""):(0).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.dAdjusted=null!=e.drcPr[0]["dcCalcNumFC"+e.oCPField.SNo]&&null!=e.drcPr[0]["dcCalcNumFC"+e.oCPField.SNo]&&""!=e.drcPr[0]["dcCalcNumFC"+e.oCPField.SNo].toString()?parseFloat(e.drcPr[0]["dcCalcNumFC"+e.oCPField.SNo]).ToString(s.a.SessionManager.sPayrollDecimals).Replace(",",""):(0).ToString(s.a.SessionManager.sPayrollDecimals),null!=e.dsEarDedExtra&&null!=e.dsEarDedExtra.Tables&&e.dsEarDedExtra.Tables.length>0&&(e.drcEDExtra=e.dsEarDedExtra.Tables[0].filter((function(t){return t.ComponentID==e.oCPField.ComponentID})),null!=e.drcEDExtra&&e.drcEDExtra.length>0&&(e.oCPField.sEarDedType=e.drcEDExtra[0].EarDedType.toString()))):(e.oCPField.dActual=(0).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.dEarned=(0).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.dArrear=(0).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.dAdjusted=(0).ToString(s.a.SessionManager.sPayrollDecimals)):("EmployeeMaster"==e.oCPField.FieldType?(e.oCPField.dActual=e.drcEmpPay.length>0?parseFloat(e.drcEmpPay[0]["Earning"+e.oCPField.SNo]).ToString(s.a.SessionManager.sPayrollDecimals):(0).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.dEarned=e.oCPField.dActual):"Monthly"==e.oCPField.FieldType?function(){if(e.drcRecData.length>0){var t=e.dsAllEmpsData.Tables[16].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo&&t.ComponentID==e.oCPField.ComponentID})).Compute("sum","Amount");null!=t&&""!=t.toString().Trim()?(e.oCPField.dActual=parseFloat(t).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.dEarned=parseFloat(t).ToString(s.a.SessionManager.sPayrollDecimals)):(e.oCPField.dActual=(0).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.dEarned=(0).ToString(s.a.SessionManager.sPayrollDecimals))}else e.oCPField.dActual=(0).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.dEarned=(0).ToString(s.a.SessionManager.sPayrollDecimals);var a=e.dsAllEmpsData.Tables[1];if((a=a.filter((function(t){return t.GradeID==e.othMPField.GradeID&&4==t.Type&&t.LEDaysField==e.oCPField.ComponentID}))).length>0&&(e.drcLEPay=e.dsAllEmpsData.Tables[27].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),e.drcLEPay.length>0)){for(var r=[],o=function(t){var s;(s=e.drcLEPay.filter((function(s){return s.EmpSeqNo==e.sEmpSeqNo&&s.LeaveComponentID==a[t].ComponentID.toString()}))).length>0&&r.push(s)},i=0;i<a.length;i++)o(i);if(r.length>0){var n=r.Compute("sum","AppliedDays");null!=n&&null!=n&&""!=n.toString().Trim()&&(e.oCPField.dActual=(parseFloat(e.oCPField.dActual)+parseFloat(n)).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.dEarned=(parseFloat(e.oCPField.dEarned)+parseFloat(n)).ToString(s.a.SessionManager.sPayrollDecimals))}}if((a=(a=e.dsAllEmpsData.Tables[1]).filter((function(t){return t.GradeID==e.othMPField.GradeID&&4==t.Type&&t.LEAmountField==e.oCPField.ComponentID}))).length>0&&(e.drcLEPay=e.dsAllEmpsData.Tables[27].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),e.drcLEPay.length>0)){for(var l=[],d=function(t){var s;(s=e.drcLEPay.filter((function(s){return s.EmpSeqNo==e.sEmpSeqNo&&s.LeaveComponentID==a[t].ComponentID.toString()}))).length>0&&l.push(s)},c=0;c<a.length;c++)d(c);if(l.length>0){var h=l.Compute("sum","LEAmount");null!=h&&null!=h&&""!=h.toString().Trim()&&(e.oCPField.dActual=(parseFloat(e.oCPField.dActual)+parseFloat(h)).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.dEarned=(parseFloat(e.oCPField.dEarned)+parseFloat(h)).ToString(s.a.SessionManager.sPayrollDecimals))}}}():(e.oCPField.dActual=(0).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.dEarned=(0).ToString(s.a.SessionManager.sPayrollDecimals)),e.oCPField.dArrear=(0).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.dAdjusted=(0).ToString(s.a.SessionManager.sPayrollDecimals)),e.arrLstCPFields[e.iEmpIndex][0].push(e.oCPField);if(e.drcStructure=e.dsAllEmpsData.Tables[1].filter((function(t){return 1==t.Type&&"Yes"==t.Applicable&&"OverTime"==t.FieldType&&t.GradeID==e.othMPField.GradeID})),null!=e.drcStructure&&e.drcStructure.length>0)for(var U=0;U<e.drcStructure.length;U++){if(e.oCPField=new o.a,e.oCPField.SNo=parseInt(e.drcStructure[U].SNo),e.oCPField.ComponentID=parseInt(e.drcStructure[U].ComponentID),e.oCPField.ComponentName=r.e.String(e.drcStructure[U].ComponentName),e.oCPField.Formula=r.e.String(e.drcStructure[U].Formula),e.oCPField.AddToNet=r.e.String(e.drcStructure[U].AddToNet),e.oCPField.FieldType=r.e.String(e.drcStructure[U].FieldType),e.oCPField.ROff=parseFloat(e.drcStructure[U].ROff),e.oCPField.IsEditable=1,e.oCPField.IsReadOnly=0,e.othMPField.IsAllowOT)if(e.othMPField.IsAlreadyProcessed)null!=e.drcPr&&e.drcPr.length>0?(e.oCPField.dActual=null!=e.drcPr[0]["dcNum"+e.oCPField.SNo]&&null!=e.drcPr[0]["dcNum"+e.oCPField.SNo]&&""!=e.drcPr[0]["dcNum"+e.oCPField.SNo].toString()?parseFloat(e.drcPr[0]["dcNum"+e.oCPField.SNo]).ToString(s.a.SessionManager.sPayrollDecimals2):(0).ToString(s.a.SessionManager.sPayrollDecimals2),e.oCPField.dEarned=null!=e.drcPr[0]["dcCalcNum"+e.oCPField.SNo]&&null!=e.drcPr[0]["dcCalcNum"+e.oCPField.SNo]&&""!=e.drcPr[0]["dcCalcNum"+e.oCPField.SNo].toString()?parseFloat(e.drcPr[0]["dcCalcNum"+e.oCPField.SNo]).ToString(s.a.SessionManager.sPayrollDecimals):(0).ToString(s.a.SessionManager.sPayrollDecimals)):(e.oCPField.dActual=(0).ToString(s.a.SessionManager.sPayrollDecimals2),e.oCPField.dEarned=(0).ToString(s.a.SessionManager.sPayrollDecimals));else if(e.IsPostFullAttendance)if(e.IsPostBasedOnDailyAttendance){var Y=r.e.DTComputeSUM(e.dsAllEmpsData.Tables[14].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),"OT"+(U+1),!0);e.oCPField.dActual=Y.ToString(s.a.SessionManager.sPayrollDecimals2)}else if(e.IsPostBasedOnAttDimWise){var X=r.e.DTComputeSUM(e.drcADWData.filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),"OT"+(U+1),!0);e.oCPField.dActual=X.ToString(s.a.SessionManager.sPayrollDecimals2)}else e.oCPField.dActual=(0).ToString(s.a.SessionManager.sPayrollDecimals2),e.oCPField.dEarned=(0).ToString(s.a.SessionManager.sPayrollDecimals);else if("True"==s.a.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll){var K=r.e.DTComputeSUM(e.dsAllEmpsData.Tables[14].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo})),"OT"+(U+1),!0);e.oCPField.dActual=K.ToString(s.a.SessionManager.sPayrollDecimals2)}else e.oCPField.dActual=(0).ToString(s.a.SessionManager.sPayrollDecimals2),e.oCPField.dEarned=(0).ToString(s.a.SessionManager.sPayrollDecimals);else e.oCPField.dActual=(0).ToString(s.a.SessionManager.sPayrollDecimals2),e.oCPField.dEarned=(0).ToString(s.a.SessionManager.sPayrollDecimals);e.oCPField.dArrear=(0).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.dAdjusted=(0).ToString(s.a.SessionManager.sPayrollDecimals),e.arrLstCPFields[e.iEmpIndex][1].push(e.oCPField)}if(e.drcPr=e.dsAllEmpsData.Tables[6].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo&&12==t.VoucherType})),e.dsEarDedExtra=[],null!=e.drcPr&&e.drcPr.length>0&&(r.e.IsEmpty(e.drcPr[0].Remarks)||e.dsEarDedExtra.ReadXml(e.drcPr[0].Remarks.toString())),e.drcStructure=e.dsAllEmpsData.Tables[1].filter((function(t){return 2==t.Type&&"Yes"==t.Applicable&&"OverTime"!=t.FieldType&&t.GradeID==e.othMPField.GradeID})),null!=e.drcStructure&&e.drcStructure.length>0)for(var J=0;J<e.drcStructure.length;J++){if(e.oCPField=new o.a,e.oCPField.SNo=parseInt(e.drcStructure[J].SNo),e.oCPField.ComponentID=parseInt(e.drcStructure[J].ComponentID),e.oCPField.ComponentName=r.e.String(e.drcStructure[J].ComponentName),e.oCPField.Formula=r.e.String(e.drcStructure[J].Formula),e.oCPField.AddToNet=r.e.String(e.drcStructure[J].AddToNet),e.oCPField.FieldType=r.e.String(e.drcStructure[J].FieldType),e.oCPField.ROff=parseFloat(e.drcStructure[J].ROff),e.oCPField.MaxOTHrs=parseFloat(e.drcStructure[J].MaxOTHrs),e.oCPField.CalculateArrears=r.e.String(e.drcStructure[J].CalculateArrears),e.oCPField.CalculateAdjustments=r.e.String(e.drcStructure[J].CalculateAdjustments),"PT"==e.oCPField.ComponentName&&(e.othMPField.PTIndex=J),"Monthly"==e.oCPField.FieldType?(e.oCPField.IsEditable=1,e.oCPField.IsReadOnly=0):(e.oCPField.IsEditable=0,e.oCPField.IsReadOnly=1),e.othMPField.IsAlreadyProcessed)null!=e.drcPr&&e.drcPr.length>0?(e.oCPField.dActual=null!=e.drcPr[0]["dcNum"+e.oCPField.SNo]&&null!=e.drcPr[0]["dcNum"+e.oCPField.SNo]&&""!=e.drcPr[0]["dcNum"+e.oCPField.SNo].toString()?parseFloat(e.drcPr[0]["dcNum"+e.oCPField.SNo]).ToString(s.a.SessionManager.sPayrollDecimals):(0).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.dEarned=null!=e.drcPr[0]["dcCalcNum"+e.oCPField.SNo]&&null!=e.drcPr[0]["dcCalcNum"+e.oCPField.SNo]&&""!=e.drcPr[0]["dcCalcNum"+e.oCPField.SNo].toString()?parseFloat(e.drcPr[0]["dcCalcNum"+e.oCPField.SNo]).ToString(s.a.SessionManager.sPayrollDecimals):(0).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.dArrear=null!=e.drcPr[0]["dcExchRT"+e.oCPField.SNo]&&null!=e.drcPr[0]["dcExchRT"+e.oCPField.SNo]&&""!=e.drcPr[0]["dcExchRT"+e.oCPField.SNo].toString()?parseFloat(e.drcPr[0]["dcExchRT"+e.oCPField.SNo]).ToString(s.a.SessionManager.sPayrollDecimals).Replace(",",""):(0).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.dAdjusted=null!=e.drcPr[0]["dcCalcNumFC"+e.oCPField.SNo]&&null!=e.drcPr[0]["dcCalcNumFC"+e.oCPField.SNo]&&""!=e.drcPr[0]["dcCalcNumFC"+e.oCPField.SNo].toString()?parseFloat(e.drcPr[0]["dcCalcNumFC"+e.oCPField.SNo]).ToString(s.a.SessionManager.sPayrollDecimals).Replace(",",""):(0).ToString(s.a.SessionManager.sPayrollDecimals),null!=e.dsEarDedExtra&&null!=e.dsEarDedExtra.Tables&&e.dsEarDedExtra.Tables.length>0&&(e.drcEDExtra=e.dsEarDedExtra.Tables[0].filter((function(t){return t.ComponentID==e.oCPField.ComponentID})),null!=e.drcEDExtra&&e.drcEDExtra.length>0&&(e.oCPField.sEarDedType=e.drcEDExtra[0].EarDedType.toString()))):(e.oCPField.dActual=(0).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.dEarned=(0).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.dArrear=(0).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.dAdjusted=(0).ToString(s.a.SessionManager.sPayrollDecimals));else{if("EmployeeMaster"==e.oCPField.FieldType)e.oCPField.dActual=e.drcEmpPay.length>0?parseFloat(e.drcEmpPay[0]["Deduction"+e.oCPField.SNo]).ToString(s.a.SessionManager.sPayrollDecimals):(0).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.dEarned=e.oCPField.dActual;else if("Monthly"==e.oCPField.FieldType)if(e.drcRecData.length>0){var Z=e.dsAllEmpsData.Tables[16].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo&&t.ComponentID==e.oCPField.ComponentID})).Compute("sum","Amount");null!=Z&&""!=Z.toString().Trim()?(e.oCPField.dActual=parseFloat(Z).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.dEarned=parseFloat(Z).ToString(s.a.SessionManager.sPayrollDecimals)):(e.oCPField.dActual=(0).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.dEarned=(0).ToString(s.a.SessionManager.sPayrollDecimals))}else e.oCPField.dActual=(0).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.dEarned=(0).ToString(s.a.SessionManager.sPayrollDecimals);else e.oCPField.dActual=(0).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.dEarned=(0).ToString(s.a.SessionManager.sPayrollDecimals);e.oCPField.dArrear=(0).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.dAdjusted=(0).ToString(s.a.SessionManager.sPayrollDecimals)}e.arrLstCPFields[e.iEmpIndex][2].push(e.oCPField)}if(e.drcStructure=e.dsAllEmpsData.Tables[1].filter((function(t){return 2==t.Type&&"Yes"==t.Applicable&&"OverTime"==t.FieldType&&t.GradeID==e.othMPField.GradeID})),null!=e.drcStructure&&e.drcStructure.length>0)for(var Q=0;Q<e.drcStructure.length;Q++)e.oCPField=new o.a,e.oCPField.SNo=parseInt(e.drcStructure[Q].SNo),e.oCPField.ComponentID=parseInt(e.drcStructure[Q].ComponentID),e.oCPField.ComponentName=r.e.String(e.drcStructure[Q].ComponentName),e.oCPField.Formula=r.e.String(e.drcStructure[Q].Formula),e.oCPField.AddToNet=r.e.String(e.drcStructure[Q].AddToNet),e.oCPField.FieldType=r.e.String(e.drcStructure[Q].FieldType),e.oCPField.ROff=parseFloat(e.drcStructure[Q].ROff),e.oCPField.IsEditable=1,e.oCPField.IsReadOnly=0,e.oCPField.dActual=(0).ToString(s.a.SessionManager.sPayrollDecimals2),e.oCPField.dEarned=(0).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.dArrear=(0).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.dAdjusted=(0).ToString(s.a.SessionManager.sPayrollDecimals),e.arrLstCPFields[e.iEmpIndex][3].push(e.oCPField);e.othMPField.iExtLoansCnt=0;var z=0,$=0,ee=0;if(e.drcPr=e.dsAllEmpsData.Tables[6].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo&&13==t.VoucherType})),e.drcStructure=e.dsAllEmpsData.Tables[1].filter((function(t){return 3==t.Type&&t.GradeID==e.othMPField.GradeID})),null!=e.drcStructure&&e.drcStructure.length>0)for(var te=0,ae=0;ae<e.drcStructure.length;ae++){e.oCPField=new o.a,e.oCPField.SNo=parseInt(e.drcStructure[ae].SNo),e.oCPField.ComponentID=parseInt(e.drcStructure[ae].ComponentID),e.oCPField.ComponentName=r.e.String(e.drcStructure[ae].ComponentName),e.oCPField.Formula=r.e.String(e.drcStructure[ae].Formula),e.oCPField.AddToNet=r.e.String(e.drcStructure[ae].AddToNet),e.oCPField.FieldType=r.e.String(e.drcStructure[ae].FieldType),e.oCPField.ROff=""==r.e.String(e.drcStructure[ae].ROff)?0:parseFloat(e.drcStructure[ae].ROff),e.oCPField.IsEditable=0,e.oCPField.IsReadOnly=1,e.oCPField.IsVisible=1;var se=e.dsAllEmpsData.Tables[10].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo&&t.LoanCompID==e.oCPField.ComponentID})).Compute("max","DeductionMonth");r.e.IsEmpty(se)||(e.MaxDeductionMonth=new Date(se)),s.a.SessionManager.Preferences.ContainsKey("ShowLoanBalRespDedMonthWhilePayProc")&&"True"==s.a.SessionManager.Preferences.ShowLoanBalRespDedMonthWhilePayProc&&e.PayrollMonth<=e.MaxDeductionMonth?e.drcTmp=e.dsAllEmpsData.Tables[10].filter(e.othMPField.IsAlreadyProcessed?function(t){return t.EmpSeqNo==e.sEmpSeqNo&&t.LoanCompID==e.oCPField.ComponentID&&new Date(t.DeductionMonth).ToString("dd/MMM/yyyy")==e.PayrollMonth.ToString("dd/MMM/yyyy")}:function(t){return t.EmpSeqNo==e.sEmpSeqNo&&t.LoanCompID==e.oCPField.ComponentID&&t.InstBalance>0&&new Date(t.DeductionMonth).ToString("dd/MMM/yyyy")==e.PayrollMonth.ToString("dd/MMM/yyyy")}):("EmpSeqNo="+e.sEmpSeqNo+" AND LoanCompID="+e.oCPField.ComponentID+" AND InstBalance>0 AND DeductionMonth<='"+e.PayrollMonth.ToString("dd/MMM/yyyy")+"'",e.drcTmp=e.dsAllEmpsData.Tables[10].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo&&t.LoanCompID==e.oCPField.ComponentID&&t.InstBalance>0&&new Date(t.DeductionMonth).ToString("dd/MMM/yyyy")<=e.PayrollMonth.ToString("dd/MMM/yyyy")}))),null!=e.drcTmp&&e.drcTmp.length>0&&e.drcTmp.sort((function(e,t){return e.DeductionMonth-t.DeductionMonth})),null!=e.drcTmp&&e.drcTmp.length>0?function(){te++,$=ee=0,e.oCPField.LoanSlNo=te.toString(),e.oCPField.LoanDocNo=e.drcTmp[0].DocNo.toString(),e.oCPField.LoanNodeNo=e.drcTmp[0].NodeNo.toString(),e.oCPField.LoanInvDocDetailsID=e.drcTmp[0].InvDocDetailsID.toString(),e.oCPField.LoanApprovedAmt=e.drcTmp[0].ApprovedAmt.toString();var t,a="";(1==e.drcTmp.length||s.a.SessionManager.Preferences.ContainsKey("ShowLoanBalRespDedMonthWhilePayProc")&&"True"==s.a.SessionManager.Preferences.ShowLoanBalRespDedMonthWhilePayProc?(e.oCPField.LoanInstNo=e.drcTmp[0].InstallmentNo.toString()+"/"+e.drcTmp[0].NoOfInstallments.toString(),e.oCPField.LoanActInstNo=e.drcTmp[0].InstallmentNo.toString(),a=e.drcTmp[0].InstallmentNo.toString()):(e.oCPField.LoanInstNo=e.drcTmp[e.drcTmp.length-1].InstallmentNo.toString()+"/"+e.drcTmp[0].NoOfInstallments.toString(),e.oCPField.LoanActInstNo=e.drcTmp[e.drcTmp.length-1].InstallmentNo.toString(),a=e.drcTmp[e.drcTmp.length-1].InstallmentNo.toString()),e.othMPField.IsAlreadyProcessed&&e.drcPr.length>0)?(e.oCPField.LoanActInstAmt=parseFloat(e.drcPr[0]["dcNum"+e.oCPField.SNo]).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.LoanInstAmt=parseFloat(e.drcPr[0]["dcCalcNum"+e.oCPField.SNo]).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.LoanBalAmt=parseFloat(e.drcPr[0]["dcExchRT"+e.oCPField.SNo]).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.LoanPayStatus=null==e.drcPr[0]["dcCalcNumFC"+e.oCPField.SNo]?"0":e.drcPr[0]["dcCalcNumFC"+e.oCPField.SNo].toString()):(null!=(t=s.a.SessionManager.Preferences.ContainsKey("ShowLoanBalRespDedMonthWhilePayProc")&&"True"==s.a.SessionManager.Preferences.ShowLoanBalRespDedMonthWhilePayProc&&e.PayrollMonth>e.MaxDeductionMonth?e.dsAllEmpsData.Tables[10].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo&&t.LoanCompID==e.oCPField.ComponentID&&t.DocNo==e.oCPField.LoanDocNo})).Compute("sum","Paid"):e.dsAllEmpsData.Tables[10].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo&&t.LoanCompID==e.oCPField.ComponentID&&t.DocNo==e.oCPField.LoanDocNo&&t.InstallmentNo<=a})).Compute("sum","Paid"))&&null!=t&&($=parseFloat(t)),z=parseFloat(e.oCPField.LoanApprovedAmt)-$,null!=(t=s.a.SessionManager.Preferences.ContainsKey("ShowLoanBalRespDedMonthWhilePayProc")&&"True"==s.a.SessionManager.Preferences.ShowLoanBalRespDedMonthWhilePayProc?e.dsAllEmpsData.Tables[10].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo&&t.LoanCompID==e.oCPField.ComponentID&&t.DocNo==e.oCPField.LoanDocNo&&t.InstallmentNo==a})).Compute("sum","InstBalance"):e.dsAllEmpsData.Tables[10].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo&&t.LoanCompID==e.oCPField.ComponentID&&t.DocNo==e.oCPField.LoanDocNo&&t.InstallmentNo<=a})).Compute("sum","InstBalance"))&&null!=t&&(ee=parseFloat(t)),e.oCPField.LoanActInstAmt=ee.toString(),e.oCPField.LoanInstAmt=ee.ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.LoanBalAmt=z.ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.LoanPayStatus="0");e.oCPField.IsVisible=1,e.oCPField.dActual=parseFloat(e.oCPField.LoanActInstAmt).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.dEarned=parseFloat(e.oCPField.LoanInstAmt).ToString(s.a.SessionManager.sPayrollDecimals),e.othMPField.iExtLoansCnt++}():(e.oCPField.IsVisible=0,e.oCPField.dActual=(0).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.dEarned=(0).ToString(s.a.SessionManager.sPayrollDecimals)),e.oCPField.dArrear=(0).ToString(s.a.SessionManager.sPayrollDecimals),e.oCPField.dAdjusted=(0).ToString(s.a.SessionManager.sPayrollDecimals),e.arrLstCPFields[e.iEmpIndex][4].push(e.oCPField)}if(e.drcPr=e.dsAllEmpsData.Tables[6].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo&&14==t.VoucherType})),e.drcStructure=e.dsAllEmpsData.Tables[1].filter((function(t){return 4==t.Type&&t.GradeID==e.othMPField.GradeID})),null!=e.drcStructure&&e.drcStructure.length>0){var re=s.a.SessionManager.Preferences.ConsiderLOPBasedOn.toString(),oe=null;re.length>0&&(oe=re.split(","));for(var ie,ne=0,le=0,de=0,ce=0,he=0,ue=0;ue<e.drcStructure.length;ue++){if(e.oCPField=new o.a,e.oCPField.SNo=parseInt(e.drcStructure[ue].SNo),e.oCPField.ComponentID=parseInt(e.drcStructure[ue].ComponentID),e.oCPField.ComponentName=r.e.String(e.drcStructure[ue].ComponentName),e.oCPField.Formula=r.e.String(e.drcStructure[ue].Formula),e.oCPField.AddToNet=r.e.String(e.drcStructure[ue].AddToNet),e.oCPField.FieldType=r.e.String(e.drcStructure[ue].FieldType),e.oCPField.ROff=""==r.e.String(e.drcStructure[ue].ROff)?0:parseFloat(e.drcStructure[ue].ROff),e.oCPField.IsEditable=0,e.oCPField.IsReadOnly=1,e.oCPField.Percentage=parseFloat(e.drcStructure[ue].Percentage),ce=0,e.othMPField.IsAlreadyProcessed)null!=e.drcPr&&e.drcPr.length>0?(e.oCPField.LeaveTotOPBal=null!=e.drcPr[0]["dcNum"+e.oCPField.SNo]&&null!=e.drcPr[0]["dcNum"+e.oCPField.SNo]&&""!=e.drcPr[0]["dcNum"+e.oCPField.SNo].toString()?parseFloat(e.drcPr[0]["dcNum"+e.oCPField.SNo]).ToString(s.a.SessionManager.sPayrollDecimals2):(0).ToString(s.a.SessionManager.sPayrollDecimals2),e.oCPField.LeaveTaken=null!=e.drcPr[0]["dcCalcNum"+e.oCPField.SNo]&&null!=e.drcPr[0]["dcCalcNum"+e.oCPField.SNo]&&""!=e.drcPr[0]["dcCalcNum"+e.oCPField.SNo].toString()?parseFloat(e.drcPr[0]["dcCalcNum"+e.oCPField.SNo]).ToString(s.a.SessionManager.sPayrollDecimals2):(0).ToString(s.a.SessionManager.sPayrollDecimals2),e.oCPField.LeaveMonOPBal=null!=e.drcPr[0]["dcExchRT"+e.oCPField.SNo]&&null!=e.drcPr[0]["dcExchRT"+e.oCPField.SNo]&&""!=e.drcPr[0]["dcExchRT"+e.oCPField.SNo].toString()?parseFloat(e.drcPr[0]["dcExchRT"+e.oCPField.SNo]).ToString(s.a.SessionManager.sPayrollDecimals2):(0).ToString(s.a.SessionManager.sPayrollDecimals2),e.oCPField.LeaveNetBal=null!=e.drcPr[0]["dcCalcNumFC"+e.oCPField.SNo]&&null!=e.drcPr[0]["dcCalcNumFC"+e.oCPField.SNo]&&""!=e.drcPr[0]["dcCalcNumFC"+e.oCPField.SNo].toString()?parseFloat(e.drcPr[0]["dcCalcNumFC"+e.oCPField.SNo]).ToString(s.a.SessionManager.sPayrollDecimals2):(0).ToString(s.a.SessionManager.sPayrollDecimals2),e.oCPField.ComponentID==e.VacationFieldSNo&&(e.othMPField.dblTotVacDays=parseFloat(e.oCPField.LeaveTaken))):(e.oCPField.LeaveTotOPBal=(0).ToString(s.a.SessionManager.sPayrollDecimals2),e.oCPField.LeaveMonOPBal=(0).ToString(s.a.SessionManager.sPayrollDecimals2),e.oCPField.LeaveTaken=(0).ToString(s.a.SessionManager.sPayrollDecimals2),e.oCPField.LeaveNetBal=(0).ToString(s.a.SessionManager.sPayrollDecimals2)),e.oCPField.ActLeaveTaken=e.oCPField.LeaveTaken;else if(e.oCPField.ComponentID==e.VacationFieldSNo){var ge=new Date(e.PayrollMonthStart.getFullYear(),e.PayrollMonthStart.getMonth(),e.PayrollMonthStart.DaysInMonth());e.oCPField.LeaveTotOPBal=e.GetVacationAvailability(ge,e.VacationFieldSNo),e.oCPField.LeaveTotOPBal=(parseFloat(e.oCPField.LeaveTotOPBal)+e.dblVacationDays+e.dblVacationDaysEncash).ToString(s.a.SessionManager.sPayrollDecimals2),e.oCPField.LeaveMonOPBal=e.oCPField.LeaveTotOPBal,e.oCPField.LeaveTaken=(e.dblVacationDays+e.dblVacationDaysEncash).ToString(s.a.SessionManager.sPayrollDecimals2),e.oCPField.ActLeaveTaken=e.dblVacationDays.ToString(s.a.SessionManager.sPayrollDecimals2),e.othMPField.dblTotVacDays=e.dblVacationDays,e.oCPField.LeaveNetBal=(parseFloat(e.oCPField.LeaveTotOPBal)-parseFloat(e.oCPField.LeaveTaken)).ToString(s.a.SessionManager.sPayrollDecimals2)}else{if(null!=e.drcStructure[ue].LeaveOthFeatures&&null!=e.drcStructure[ue].LeaveOthFeatures&&e.drcStructure[ue].LeaveOthFeatures.toString().toUpperCase().Contains("#REJOIN#")){if(e.drcApprLeaves=e.dsAllEmpsData.Tables[9].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo&&t.ComponentID==e.oCPField.ComponentID&&t.FromDate<e.PayrollMonthStart.ToString("dd MMM yyyy")&&"LatesProcessing"!=t.PostedFrom})),e.drcApprLeaves.length>0&&""==r.e.String(e.drcApprLeaves[0].RejoinDate)){e.othMPField.sErrorMessage="Payroll can not be processed. Because Employee is on "+e.oCPField.ComponentName+". Please enter rejoin date.";break}var De=void 0,ye=void 0,Pe=void 0;e.drcApprLeaves=e.dsAllEmpsData.Tables[9].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo&&t.ComponentID==e.oCPField.ComponentID&&t.FromDate>=e.PayrollMonthStart.ToString("dd MMM yyyy")&&t.ToDate<=e.PayrollMonthEnd.ToString("dd MMM yyyy")&&"LatesProcessing"!=t.PostedFrom}));for(var Ce=0;Ce<e.drcApprLeaves.length;Ce++){De=new Date(e.drcApprLeaves[Ce].FromDate),ye=new Date(e.drcApprLeaves[Ce].ToDate),Pe=""==r.e.String(e.drcApprLeaves[Ce].RejoinDate)?e.PayrollMonthEnd.AddDays(1):new Date(e.drcApprLeaves[Ce].RejoinDate);var me,pe=0,Me=ye.AddDays(1);if(ye<Pe)for(;Me<=Pe;)pe++,Me=Me.AddDays(1);if((me=pe-1)>0&&(e.dblLeavesLOP+=me),De<=e.PayrollMonthStart&&Pe==e.PayrollMonthEnd.AddDays(1)&&s.a.SessionManager.Preferences.ContainsKey("AllowPayrollProcessIfEmpOnVacation")&&"False"==s.a.SessionManager.Preferences.AllowPayrollProcessIfEmpOnVacation.toString()){e.othMPField.sErrorMessage="Payroll can not be processed. Because Employee is on "+e.oCPField.ComponentName+". Please enter rejoin date.";break}}}if(e.drcAssLeaves=e.dsAllEmpsData.Tables[8].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo&&t.LeaveType==e.oCPField.ComponentName})),ne=e.drcAssLeaves.length>0?parseFloat(e.drcAssLeaves[0].Total):0,(ie=(ie=e.dsAllEmpsData.Tables[25]).filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo&&t.LeaveType==e.oCPField.ComponentName}))).length>0)for(var Se=0;Se<ie.length;Se++)ce+=parseFloat(ie[Se].AppliedDays);ne-=ce;var fe={dLLDed:he};le=e.AggregateLeaves(e.oCPField.ComponentID,fe),he=fe.dLLDed,de=e.AggregateLeavesBeforePayroll(e.oCPField.ComponentID),(null==oe||null!=oe&&!oe.Contains(e.oCPField.ComponentID.toString()))&&(M+=he),null!=oe&&oe.Contains(e.oCPField.ComponentID.toString())?(e.oCPField.LeaveTotOPBal=(0).ToString(s.a.SessionManager.sPayrollDecimals2),e.oCPField.LeaveMonOPBal=(0).ToString(s.a.SessionManager.sPayrollDecimals2),e.oCPField.LeaveTaken=le.ToString(s.a.SessionManager.sPayrollDecimals2),e.oCPField.LeaveNetBal=(0).ToString(s.a.SessionManager.sPayrollDecimals2)):(e.oCPField.LeaveTotOPBal=(ne-de).ToString(s.a.SessionManager.sPayrollDecimals2),e.oCPField.LeaveMonOPBal=(0).ToString(s.a.SessionManager.sPayrollDecimals2),e.oCPField.LeaveTaken=le.ToString(s.a.SessionManager.sPayrollDecimals2),e.oCPField.LeaveNetBal=(ne-de-le).ToString(s.a.SessionManager.sPayrollDecimals2)),e.oCPField.ActLeaveTaken=e.oCPField.LeaveTaken}null!=oe&&oe.Contains(e.oCPField.ComponentID.toString())?e.dblLeavesLOP+=parseFloat(e.oCPField.LeaveTaken):C+=parseFloat(e.oCPField.ActLeaveTaken),e.oCPField.dActual=(0).ToString(s.a.SessionManager.sPayrollDecimals2),e.oCPField.dEarned=(0).ToString(s.a.SessionManager.sPayrollDecimals2),e.oCPField.dArrear=(0).ToString(s.a.SessionManager.sPayrollDecimals2),e.oCPField.dAdjusted=(0).ToString(s.a.SessionManager.sPayrollDecimals2),(null==oe||null!=oe&&!oe.Contains(e.oCPField.ComponentID.toString()))&&(e.oCPField.ComponentID==e.VacationFieldSNo?e.dblVacationDays>0&&e.oCPField.Percentage>0&&(m+=e.dblVacationDays*e.oCPField.Percentage/100):parseFloat(e.oCPField.LeaveTaken)>0&&e.oCPField.Percentage>0&&(m+=parseFloat(e.oCPField.LeaveTaken)*e.oCPField.Percentage/100)),e.arrLstCPFields[e.iEmpIndex][5].push(e.oCPField)}}e.othMPField.dblLeavesLOP=e.dblLeavesLOP,P=e.dblLeavesLOP,e.drcStructure=e.dsAllEmpsData.Tables[1].filter((function(t){return t.GradeID==e.othMPField.GradeID})),e.drcPr=e.dsAllEmpsData.Tables[6].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo&&11==t.VoucherType}));var Ee=e.dsDocDesig.Tables[0];if(null!=(Ee=Ee.filter((function(e){return 1==e.IsColumnUserDefined&&(2==e.SectionID&&"H"==e.SectionName||3==e.SectionID)})))&&Ee.length>0)for(var Fe=0;Fe<Ee.length;Fe++)e.oCPField=new o.a,e.oCPField.ExtraFieldSNo=Ee[Fe].SysColumnName.toString().Replace("dcAlpha","").Replace("dcCCNID",""),e.oCPField.ExtraFieldName=Ee[Fe].SysColumnName.toString(),e.oCPField.ExtraFieldCaption=Ee[Fe].UserColumnName.toString(),e.oCPField.ExtraFieldValue="EMPTY",e.oCPField.ExtraFieldDataType=Ee[Fe].ColumnDataType.toString().toUpperCase(),e.oCPField.ExtraFieldUserColumnType=Ee[Fe].UserColumnType.toString().toUpperCase(),e.othMPField.IsAlreadyProcessed&&null!=e.drcPr&&e.drcPr.length>0&&null!=e.drcPr[0][e.oCPField.ExtraFieldName]&&null!=e.drcPr[0][e.oCPField.ExtraFieldName]&&(e.oCPField.ExtraFieldValue=e.drcPr[0][e.oCPField.ExtraFieldName].toString()),e.arrLstCPFields[e.iEmpIndex][6].push(e.oCPField);if(e.drcPr=e.dsAllEmpsData.Tables[6].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo&&11==t.VoucherType})),e.lstHolidays.Clear(),null!=e.drcHolidayDef&&e.drcHolidayDef.length>0)for(var Te=0;Te<e.drcHolidayDef.length;Te++)e.lstHolidays.push(new Date(e.drcHolidayDef[Te].HolidayDate));if(e.othMPField.sRemarks="",e.othMPField.IsAlreadyProcessed)null!=e.drcPr&&e.drcPr.length>0&&(p=parseFloat(e.drcPr[0].dcAlpha5),C=parseFloat(e.drcPr[0].dcAlpha6),m=null!=e.drcPr[0].dcAlpha24&&null!=e.drcPr[0].dcAlpha24&&""!=e.drcPr[0].dcAlpha24.toString()?parseFloat(e.drcPr[0].dcAlpha24):0,g=parseFloat(e.drcPr[0].dcAlpha7),D=parseFloat(e.drcPr[0].dcAlpha8),P=parseFloat(e.drcPr[0].dcAlpha9),y=parseFloat(e.drcPr[0].dcAlpha10),null!=e.drcPr[0].CommonNarration&&null!=e.drcPr[0].CommonNarration&&(e.othMPField.sRemarks=e.drcPr[0].CommonNarration.toString()));else{y+=e.GetUnpaidDays();var Ae=e.othMPField.DateOfJoining>e.PayrollMonthStart?e.othMPField.DateOfJoining:e.PayrollMonthStart,Le=e.othMPField.DateOfRelieve<e.PayrollMonthEnd?e.othMPField.DateOfRelieve:e.PayrollMonthEnd;if(h=-1,u=-1,e.lstWeekoff.Clear(),e.drcWOffDef.length>0)g=e.CalculateWeeklyOffsFromDef();else{var ve="",Ie="";switch(ve="NONE"!=e.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()?e.drcAllEmpsData[0].WeeklyOff1.toString():s.a.SessionManager.Preferences.WeeklyOff1.toString(),"NONE"!=e.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()?e.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()!=ve.toUpperCase()&&(Ie=e.drcAllEmpsData[0].WeeklyOff2.toString()):Ie=s.a.SessionManager.Preferences.WeeklyOff2.toString(),ve){case"Sunday":h=0;break;case"Monday":h=1;break;case"Tuesday":h=2;break;case"Wednesday":h=3;break;case"Thursday":h=4;break;case"Friday":h=5;break;case"Saturday":h=6}switch(Ie){case"Sunday":u=0;break;case"Monday":u=1;break;case"Tuesday":u=2;break;case"Wednesday":u=3;break;case"Thursday":u=4;break;case"Friday":u=5;break;case"Saturday":u=6}-1!=h&&function(){var t=Ae;for(t.getDay()<h?t=t.AddDays(h-t.getDay()):t.getDay()>h&&(t=t.AddDays(7-(t.getDay()-h)));t<=Le;)if(e.lstHolidays.Contains(t))t=t.AddDays(7);else if(e.lstWeekoff.Contains(t))t=t.AddDays(7);else{if(e.drcApprLeaves=e.dsAllEmpsData.Tables[9].filter((function(a){return a.EmpSeqNo==e.sEmpSeqNo&&a.FromDate<=t.ToString("dd MMM yyyy")&&a.ToDate>=t.ToString("dd MMM yyyy")&&"LatesProcessing"!=a.PostedFrom})),0==e.drcApprLeaves.length)if(null!=e.lstVacations&&e.lstVacations.length>0)for(var a=0;a<e.lstVacations.length;a++)e.lstVacations[a].IsEncashDays||e.lstWeekoff.Contains(t)||(e.oVacation=e.lstVacations[a],null!=e.oVacation?e.oVacation.StartDate<=t&&e.oVacation.EndDate>=t?(e.ExcludeWeeklyOff&&g++,e.lstWeekoff.push(t)):(e.drcVacations=e.dsAllEmpsData.Tables[18].filter((function(a){return a.EmpSeqNo==e.sEmpSeqNo&&a.ToDate<=t.ToString("dd MMM yyyy")&&a.ReJoinDate>t.ToString("dd MMM yyyy")})),0==e.drcVacations.length&&g++,e.lstWeekoff.push(t)):g++,e.lstWeekoff.push(t));else e.drcVacations=e.dsAllEmpsData.Tables[18].filter((function(a){return a.EmpSeqNo==e.sEmpSeqNo&&a.ToDate<=t.ToString("dd MMM yyyy")&&a.ReJoinDate>t.ToString("dd MMM yyyy")})),0==e.drcVacations.length&&(g++,e.lstWeekoff.push(t));else if(e.drcStructure=e.dsAllEmpsData.Tables[1].filter((function(t){return 4==t.Type&&t.ComponentID==r.e.String(e.drcApprLeaves[0].ComponentID)&&t.GradeID==e.othMPField.GradeID})),e.drcStructure.length>0&&""!=r.e.String(e.drcStructure[0].IncludeRExclude).Trim())switch(e.drcStructure[0].IncludeRExclude.toString()){case"ExcludeBoth":case"ExcludeWeeklyOffs":case"IncludeHolidays":g++,e.lstWeekoff.push(t)}t=t.AddDays(7)}}(),-1!=u&&h!=u&&function(){var t=Ae;for(t.getDay()<u?t=t.AddDays(u-t.getDay()):t.getDay()>u&&(t=t.AddDays(7-(t.getDay()-u)));t<=Le;)if(e.lstHolidays.Contains(t))t=t.AddDays(7);else if(e.lstWeekoff.Contains(t))t=t.AddDays(7);else{if(e.drcApprLeaves=e.dsAllEmpsData.Tables[9].filter((function(a){return a.EmpSeqNo==e.sEmpSeqNo&&a.FromDate<=t.ToString("dd MMM yyyy")&&a.ToDate>=t.ToString("dd MMM yyyy")&&"LatesProcessing"!=a.PostedFrom})),0==e.drcApprLeaves.length)if(null!=e.lstVacations&&e.lstVacations.length>0)for(var a=0;a<e.lstVacations.length;a++)e.lstVacations[a].IsEncashDays||e.lstWeekoff.Contains(t)||(e.oVacation=e.lstVacations[a],null!=e.oVacation?e.oVacation.StartDate<=t&&e.oVacation.EndDate>=t?(e.ExcludeWeeklyOff&&g++,e.lstWeekoff.push(t)):(e.drcVacations=e.dsAllEmpsData.Tables[18].filter((function(a){return a.EmpSeqNo==e.sEmpSeqNo&&a.ToDate<=t.ToString("dd MMM yyyy")&&a.ReJoinDate>t.ToString("dd MMM yyyy")})),0==e.drcVacations.length&&g++,e.lstWeekoff.push(t)):g++,e.lstWeekoff.push(t));else e.drcVacations=e.dsAllEmpsData.Tables[18].filter((function(a){return a.EmpSeqNo==e.sEmpSeqNo&&a.ToDate<=t.ToString("dd MMM yyyy")&&a.ReJoinDate>t.ToString("dd MMM yyyy")})),0==e.drcVacations.length&&(g++,e.lstWeekoff.push(t));else if(e.drcStructure=e.dsAllEmpsData.Tables[1].filter((function(t){return 4==t.Type&&t.ComponentID==r.e.String(e.drcApprLeaves[0].ComponentID)&&t.GradeID==e.othMPField.GradeID})),e.drcStructure.length>0&&""!=r.e.String(e.drcStructure[0].IncludeRExclude).Trim())switch(e.drcStructure[0].IncludeRExclude.toString()){case"ExcludeBoth":case"ExcludeWeeklyOffs":case"IncludeHolidays":g++,e.lstWeekoff.push(t)}t=t.AddDays(7)}}()}-1==h&&-1==u&&(e.drcTmp=e.dsAllEmpsData.Tables[14].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo&&-1==t.NormalWorkingHours})),null!=e.drcTmp&&e.drcTmp.length>0&&(g=e.drcTmp.length));for(var be=new Array,Ne=function(t){if(e.lstHolidays[t]>=e.othMPField.DateOfJoining&&e.lstHolidays[t]<=e.othMPField.DateOfRelieve)if(e.drcApprLeaves=e.dsAllEmpsData.Tables[9].filter((function(a){return a.EmpSeqNo==e.sEmpSeqNo&&a.FromDate<=e.lstHolidays[t].ToString("dd MMM yyyy")&&a.ToDate>=e.lstHolidays[t].ToString("dd MMM yyyy")&&"LatesProcessing"!=a.PostedFrom})),0==e.drcApprLeaves.length)if(null!=e.lstVacations&&e.lstVacations.length>0)for(var a=0;a<e.lstVacations.length;a++)e.lstVacations[a].IsEncashDays||be.Contains(e.lstHolidays[t])||(e.oVacation=e.lstVacations[a],null!=e.oVacation?e.oVacation.StartDate<=e.lstHolidays[t]&&e.oVacation.EndDate>=e.lstHolidays[t]?(e.ExcludeHolidays&&D++,be.push(e.lstHolidays[t])):(e.drcVacations=e.dsAllEmpsData.Tables[18].filter((function(a){return a.EmpSeqNo==e.sEmpSeqNo&&a.ToDate<=e.lstHolidays[t].ToString("dd MMM yyyy")&&a.ReJoinDate>e.lstHolidays[t].ToString("dd MMM yyyy")})),0==e.drcVacations.length&&D++,be.push(e.lstHolidays[t])):D++,be.push(e.lstHolidays[t]));else e.drcVacations=e.dsAllEmpsData.Tables[18].filter((function(a){return a.EmpSeqNo==e.sEmpSeqNo&&a.ToDate<=e.lstHolidays[t].ToString("dd MMM yyyy")&&a.ReJoinDate>e.lstHolidays[t].ToString("dd MMM yyyy")})),0==e.drcVacations.length&&(D++,be.push(e.lstHolidays[t]));else if(e.drcStructure=e.dsAllEmpsData.Tables[1].filter((function(t){return 4==t.Type&&t.ComponentID==r.e.String(e.drcApprLeaves[0].ComponentID)&&t.GradeID==e.othMPField.GradeID})),e.drcStructure.length>0&&""!=e.drcStructure[0].IncludeRExclude.toString().Trim())switch(e.drcStructure[0].IncludeRExclude.toString()){case"ExcludeBoth":case"ExcludeHolidays":case"IncludeWeeklyOffs":D++,be.push(e.lstHolidays[t])}},Oe=0;Oe<e.lstHolidays.length;Oe++)Ne(Oe);if(e.drcTmp=e.dsAllEmpsData.Tables[14].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo&&-2==t.NormalWorkingHours})),null!=e.drcTmp&&e.drcTmp.length>0&&(D=e.drcTmp.length),e.IsPostFullAttendance)if(e.IsPostBasedOnDailyAttendance){var Ve=e.GetDaysAttendedBasedOnDailyAttendance(e.dsAllEmpsData.Tables[14],e.sEmpSeqNo);Ve+g+D<e.dblLeavesLOP?(p=Ve+g+D,P=c-((p-=M)+C+y)):(p=Ve+g+D,e.othMPField.dblLeavesLOP>0&&e.othMPField.LOPDays>0&&e.othMPField.LOPDays<e.othMPField.dblLeavesLOP&&(p-=e.othMPField.dblLeavesLOP),P=c-((p-=M)+C+y))}else e.IsPostBasedOnAttDimWise?null!=e.drcADWData&&e.drcADWData.length>0&&(p=r.e.DTComputeSUM(e.drcADWData,"DaysAttended",!1),e.othMPField.dblLeavesLOP>0&&e.othMPField.LOPDays>0&&e.othMPField.LOPDays<e.othMPField.dblLeavesLOP&&(p-=e.othMPField.dblLeavesLOP),P=c-((p-=M)+C+y)):p=c-C-P-y;else if("True"==s.a.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll){var we=e.GetDaysAttendedBasedOnDailyAttendance(e.dsAllEmpsData.Tables[14],e.sEmpSeqNo);we+g+D<e.dblLeavesLOP?(p=we+g+D,P=c-((p-=M)+C+y)):(p=we+g+D,e.othMPField.dblLeavesLOP>0&&e.othMPField.LOPDays>0&&e.othMPField.LOPDays<e.othMPField.dblLeavesLOP&&(p-=e.othMPField.dblLeavesLOP),P=c-((p-=M)+C+y))}else P=c-((p=g+D)+C+y)}if(e.othMPField.DaysAttended=p,e.othMPField.TotalLeaves=C,e.othMPField.PaidLeaves=m,e.othMPField.WeeklyOffs=g,e.othMPField.Holidays=D,e.othMPField.LOPDays=P,e.othMPField.UnpaidDays=y,e.othMPField.TotalDays=p+C+P+y,e.othMPField.PaidDays=p+m,e.ExecuteAllFormulas(),("MonthlyPayrollViewModel"==e.oParent.ClassName||"ConsolidatedMonthlyPayrollViewModel"==e.oParent.ClassName)&&!e.othMPField.IsAlreadyProcessed&&s.a.SessionManager.Preferences.ContainsKey("GetFulDaysAttndsinMnthlyPayroll")&&"True"==s.a.SessionManager.Preferences.GetFulDaysAttndsinMnthlyPayroll){var Re=e.othMPField.TotalDays;e.SetDaysAttended(e.iEmpIndex,"Days Attended",e.othMPField.TotalDays),e.othMPField.LOPDays<0&&(Re+=e.othMPField.LOPDays),e.othMPField.dblLeavesLOP>0&&e.othMPField.LOPDays<e.othMPField.dblLeavesLOP&&(Re-=e.othMPField.dblLeavesLOP),e.SetDaysAttended(e.iEmpIndex,"Days Attended",Re)}}();if("continue"===l)continue;if("object"==typeof l)return l.v}("PostPayrollViewModel"==this.oParent.ClassName||"ConsolidatedMonthlyPayrollViewModel"==this.oParent.ClassName)&&(this.oParent.InProgress=this.iEmpIndex+1+" of "+n.length,this.oParent.ProgressValue++)}}this.IsCompleted=!0}}},{key:"GetHoursDefChart",value:function(e){var t=this.dsAllEmpsData.Tables[29],a=new Date(e.DailyAttendanceDate).ToString("dd/MMM/yyyy"),o=null;if(s.a.SessionManager.Preferences.ContainsKey("HoursDefChartBasedOn")&&""!=s.a.SessionManager.Preferences.HoursDefChartBasedOn){var i=s.a.SessionManager.Preferences.HoursDefChartBasedOn.split(",");null!=i&&i.length>0&&function(){for(var s=" 1=1 ",n="",l=0;l<i.length;l++)null!=i[l]&&""!=i[l]&&(n="dcCCNID"+(parseInt(i[l])-5e4),r.e.IsEmpty(e[n])?(t=t.filter((function(e){return 1==e[n]})),s+=" AND "+n+"=1"):(t=t.filter((function(t){return t[n]==e[n].toString()||1==t[n]})),s+=" AND ( "+n+"="+e[n].toString()+" OR "+n+"=1 )"));if(s.length>0&&(s+=" AND WEF<='"+a+"'",null!=t&&t.length>0)){var d=t.filter((function(e){return e.WEF<=a}));d.sort((function(e,t){return e.WEF>t.WEF||e.WEF==t.WEF&&e.DocID>t.DocID?1:-1})),null!=d&&d.length>0&&(o=d)}}()}return o}},{key:"GetDaysAttendedBasedOnDailyAttendance",value:function(e,t){var a,s,o=this,i=0,n=this.PayrollMonthStart,l=this.PayrollMonthEnd,d=0,c=0,h=null,u=[];if(u=e,null!=(u=e.filter((function(e){return e.EmpSeqNo==t})))&&u.length>0)for(a=n;a<=l;)null!=(s=u.filter((function(e){return e.EmpSeqNo==t&&e.DailyAttendanceDate==a.ToString("dd/MMM/yyyy")})))&&s.length>0&&(h=this.GetHoursDefChart(s[0]),d=c=0,c=r.e.DTComputeSUM(u.filter((function(e){return e.EmpSeqNo==o.sEmpSeqNo&&e.DailyAttendanceDate==a.ToString("dd/MMM/yyyy")&&e.NormalWorkingHours>=0})),"NormalWorkingHours",!0),null!=h&&h.length>0&&(d=parseFloat(h[0].MinHalfHrs),i+=parseFloat(h[0].MinFullHrs)<=c?1:d<=c?.5:0)),a=a.AddDays(1);return i}},{key:"AggregateLeaves",value:function(e,t){var a=this;this.drcApprLeaves=this.dsAllEmpsData.Tables[9].filter((function(t){return t.EmpSeqNo==a.sEmpSeqNo&&t.ComponentID==e}));var r,o,i=0,n=0,l=0;t.dLLDed=0;for(var d=0;d<this.drcApprLeaves.length;d++){if(n=0,s.a.SessionManager.Preferences.ContainsKey("DontConsiderEmpLeavesLoansRecData")&&"True"==s.a.SessionManager.Preferences.DontConsiderEmpLeavesLoansRecData){var c=parseInt(s.a.SessionManager.Preferences.DontConsiderEmpLeavesLoansRecDataDays),h=new Date(s.a.SessionManager.PayrollMonth.getFullYear(),s.a.SessionManager.PayrollMonth.getMonth(),c);if(new Date(this.drcApprLeaves[d].DocDate)>=h)continue}r=new Date(this.drcApprLeaves[d].FromDate),o=new Date(this.drcApprLeaves[d].ToDate),r>=s.a.SessionManager.PayrollMonthStart?o<=s.a.SessionManager.PayrollMonthEnd?(i+=l=parseFloat(this.drcApprLeaves[d].NoOfDays),n+=l):r<=s.a.SessionManager.PayrollMonthEnd&&(i+=l=this.GetNoOfDays(r,s.a.SessionManager.PayrollMonthEnd,e),n+=l):o<=s.a.SessionManager.PayrollMonthEnd?o>=s.a.SessionManager.PayrollMonthStart&&(i+=l=this.GetNoOfDays(s.a.SessionManager.PayrollMonthStart,o,e),n+=l):(i+=l=this.GetNoOfDays(s.a.SessionManager.PayrollMonthStart,s.a.SessionManager.PayrollMonthEnd,e),n+=l),null!=this.drcApprLeaves[d].PostedFrom&&null!=this.drcApprLeaves[d].PostedFrom&&"LatesProcessing"==this.drcApprLeaves[d].PostedFrom.toString()&&(t.dLLDed+=n)}return i}},{key:"AggregateLeavesBeforePayroll",value:function(e){var t=this;this.drcApprLeaves=this.dsAllEmpsData.Tables[9].filter((function(a){return a.EmpSeqNo==t.sEmpSeqNo&&a.ComponentID==e}));for(var a,r,o=0,i=0;i<this.drcApprLeaves.length;i++){if(s.a.SessionManager.Preferences.ContainsKey("DontConsiderEmpLeavesLoansRecData")&&"True"==s.a.SessionManager.Preferences.DontConsiderEmpLeavesLoansRecData){var n=parseInt(s.a.SessionManager.Preferences.DontConsiderEmpLeavesLoansRecDataDays),l=new Date(s.a.SessionManager.PayrollMonth.getFullYear(),s.a.SessionManager.PayrollMonth.getMonth(),n);if(new Date(this.drcApprLeaves[i].DocDate)>=l)continue}a=new Date(this.drcApprLeaves[i].FromDate),r=new Date(this.drcApprLeaves[i].ToDate),a>=this.LeaveYearStartmonth?r<s.a.SessionManager.PayrollMonthStart?o+=parseFloat(this.drcApprLeaves[i].NoOfDays):a<s.a.SessionManager.PayrollMonthStart&&(o+=this.GetNoOfDays(a,s.a.SessionManager.PayrollMonthStart,e)):r<s.a.SessionManager.PayrollMonthStart?r>=this.LeaveYearStartmonth&&(o+=this.GetNoOfDays(this.LeaveYearStartmonth,r,e)):o+=this.GetNoOfDays(this.LeaveYearStartmonth,s.a.SessionManager.PayrollMonthStart,e)}return o}},{key:"GetNoOfDays",value:function(e,t,a){var o=this,i=0,n=0,l=0,d=null,c=this.dsAllEmpsData.Tables[1].filter((function(e){return e.GradeID==o.othMPField.GradeID&&4==e.Type&&e.ComponentID==a}));if(null!=c&&c.length>0){var h=function(){var a=e,h=c[0].IncludeRExclude.toString();if(i=r.e.GetDateDifference(t,e)+1,"IncludeBoth"==h||""==h)return{v:i};if("IncludeWeeklyOffs"==h)for(;a<=t;)null!=(d=o.dtHolidayDef.filter((function(e){return e.HolidayDate==a.ToString("dd/MMM/yyyy")})))&&d.length>0&&l++,a=a.AddDays(1);else if("IncludeHolidays"==h)for(;a<=t;)null!=o.drcWOffDef&&o.drcWOffDef.length>0?o.CheckIsWeeklyOffFromDef(a)&&n++:("NONE"!=o.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()?a.getDay().toString()==o.drcAllEmpsData[0].WeeklyOff1.toString()&&n++:a.getDay().toString()==s.a.SessionManager.Preferences.WeeklyOff1&&n++,"NONE"!=o.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()?o.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()!=o.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()&&a.getDay().toString()==o.drcAllEmpsData[0].WeeklyOff2.toString()&&n++:a.getDay().toString()==s.a.SessionManager.Preferences.WeeklyOff2&&n++),a=a.AddDays(1);else if("ExcludeBoth"==h)for(;a<=t;){var u=!1;null!=(d=o.dtHolidayDef.filter((function(e){return e.HolidayDate==a.ToString("dd/MMM/yyyy")})))&&d.length>0&&(l++,u=!0),null!=o.drcWOffDef&&o.drcWOffDef.length>0?o.CheckIsWeeklyOffFromDef(a)&&!u&&n++:("NONE"!=o.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()?a.getDay().toString()!=o.drcAllEmpsData[0].WeeklyOff1.toString()||u||n++:a.getDay().toString()!=s.a.SessionManager.Preferences.WeeklyOff1||u||n++,"NONE"!=o.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()?o.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()!=o.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()&&(a.getDay().toString()!=o.drcAllEmpsData[0].WeeklyOff2.toString()||u||n++):a.getDay().toString()!=s.a.SessionManager.Preferences.WeeklyOff2||u||n++),a=a.AddDays(1)}else if("ExcludeWeeklyOffs"==h)for(;a<=t;)null!=o.drcWOffDef&&o.drcWOffDef.length>0?o.CheckIsWeeklyOffFromDef(a)&&n++:("NONE"!=o.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()?a.getDay().toString()==o.drcAllEmpsData[0].WeeklyOff1.toString()&&n++:a.getDay().toString()==s.a.SessionManager.Preferences.WeeklyOff1&&n++,"NONE"!=o.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()?o.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()!=o.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()&&a.getDay().toString()==o.drcAllEmpsData[0].WeeklyOff2.toString()&&n++:a.getDay().toString()==s.a.SessionManager.Preferences.WeeklyOff2&&n++),a=a.AddDays(1);else if("ExcludeHolidays"==h)for(;a<=t;)null!=(d=o.dtHolidayDef.filter((function(e){return e.HolidayDate==a.ToString("dd/MMM/yyyy")})))&&d.length>0&&l++,a=a.AddDays(1)}();if("object"==typeof h)return h.v}return i-(n+l)}},{key:"CheckIsWeeklyOffFromDef",value:function(e){if(null!=this.drcWOffDef&&this.drcWOffDef.length>0)for(var t,a=1,o=this.othMPField.DateOfRelieve<s.a.SessionManager.PayrollMonthEnd?this.othMPField.DateOfRelieve:s.a.SessionManager.PayrollMonthEnd,i=this.othMPField.DateOfJoining>s.a.SessionManager.PayrollMonthStart?this.othMPField.DateOfJoining:s.a.SessionManager.PayrollMonthStart;i<=o;){for(t=i.AddDays(6);i<=t&&i<=o;){if(this.dsAllEmpsData.Columns[4].Contains("Week"+a.toString()+"_W1")&&!r.e.IsEmpty(this.drcWOffDef[0]["Week"+a.toString()+"_W1"])&&i.getDay().toString().toLowerCase()==this.drcWOffDef[0]["Week"+a.toString()+"_W1"].toString().toLowerCase()){if(i.Date==e.Date)return!0}else if(this.dsAllEmpsData.Columns[4].Contains("Week"+a.toString()+"_W2")&&!r.e.IsEmpty(this.drcWOffDef[0]["Week"+a.toString()+"_W2"])&&i.getDay().toString().toLowerCase()==this.drcWOffDef[0]["Week"+a.toString()+"_W2"].toString().toLowerCase()&&i.Date==e.Date)return!0;i=i.AddDays(1)}a++}return!1}},{key:"CalculateWeeklyOffsExcludeDays",value:function(e,t){var a=0;if(null!=this.drcWOffDef&&this.drcWOffDef.length>0)for(var o,i=1,n=this.othMPField.DateOfRelieve<s.a.SessionManager.PayrollMonthEnd?this.othMPField.DateOfRelieve:s.a.SessionManager.PayrollMonthEnd,l=this.othMPField.DateOfJoining>s.a.SessionManager.PayrollMonthStart?this.othMPField.DateOfJoining:s.a.SessionManager.PayrollMonthStart;l<=n;){for(o=l.AddDays(6);l<=o&&l<=n;)this.lstHolidays.Contains(l)||(r.e.IsEmpty(this.drcWOffDef[0]["Week"+i.toString()+"_W1"])||l.getDay().toString().toLowerCase()!=this.drcWOffDef[0]["Week"+i.toString()+"_W1"].toString().toLowerCase())&&(r.e.IsEmpty(this.drcWOffDef[0]["Week"+i.toString()+"_W2"])||l.getDay().toString().toLowerCase()!=this.drcWOffDef[0]["Week"+i.toString()+"_W2"].toString().toLowerCase())||l>=e&&l<=t&&a++,l=l.AddDays(1);i++}return a}},{key:"GetVacationDays",value:function(e,t,a){var i=this,n=null;this.ExcludeWeeklyOff=!1,this.ExcludeHolidays=!1;var l=-1,d=this.dsAllEmpsData.Tables[26];(d="True"==s.a.SessionManager.Preferences.GradeWiseVacation.toString()?d.filter((function(e){return e.GradeID==i.othMPField.EmpGradeID})):d.filter((function(e){return 1==e.GradeID}))).length>0&&(l=parseInt(d[0].VacationField),this.drcStructure=this.dsAllEmpsData.Tables[1].filter((function(e){return 4==e.Type&&e.ComponentID==l&&e.GradeID==i.othMPField.GradeID})),this.drcStructure.length>0&&null!=this.drcStructure[0].IncludeRExclude&&null!=this.drcStructure[0].IncludeRExclude&&""!=this.drcStructure[0].IncludeRExclude.toString()&&("ExcludeBoth"==this.drcStructure[0].IncludeRExclude.toString()?(this.ExcludeWeeklyOff=!0,this.ExcludeHolidays=!0):"ExcludeWeeklyOffs"==this.drcStructure[0].IncludeRExclude.toString()?this.ExcludeWeeklyOff=!0:"ExcludeHolidays"==this.drcStructure[0].IncludeRExclude.toString()&&(this.ExcludeHolidays=!0)));var c,h=1,u=new Date(e.getFullYear(),e.getMonth(),e.getDate()),g=0,D=0,y=0;if(g=-1,D=-1,null!=this.drcWOffDef&&this.drcWOffDef.length>0)h=(c=new Date(t.getFullYear(),t.getMonth(),t.getDate())).Subtract(u).Days+1,this.ExcludeWeeklyOff&&(y=this.CalculateWeeklyOffsExcludeDays(e,t)),this.ExcludeHolidays&&(null!=(n=this.dtHolidayDef.filter((function(e){return e.HolidayDate>=u.ToString("dd MMM yyyy")&&e.HolidayDate<=c.ToString("dd MMM yyyy")})))&&n.length>0&&(y+=n.length)),h-=y;else{var P="",C="";switch(P="NONE"!=this.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()?this.drcAllEmpsData[0].WeeklyOff1.toString():s.a.SessionManager.Preferences.WeeklyOff1.toString(),"NONE"!=this.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()?this.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()!=P.toUpperCase()&&(C=this.drcAllEmpsData[0].WeeklyOff2.toString()):C=s.a.SessionManager.Preferences.WeeklyOff2.toString(),P){case"Sunday":g=0;break;case"Monday":g=1;break;case"Tuesday":g=2;break;case"Wednesday":g=3;break;case"Thursday":g=4;break;case"Friday":g=5;break;case"Saturday":g=6}switch(C){case"Sunday":D=0;break;case"Monday":D=1;break;case"Tuesday":D=2;break;case"Wednesday":D=3;break;case"Thursday":D=4;break;case"Friday":D=5;break;case"Saturday":D=6}if(h=(c=new Date(t.getFullYear(),t.getMonth(),t.getDate())).Subtract(u).Days+1,this.ExcludeWeeklyOff){if(-1!=g){var m=u;for(m.getDay()<g?m=m.AddDays(g-m.getDay()):m.getDay()>g&&(m=m.AddDays(7-(m.getDay()-g)));m<=c;)y++,m=m.AddDays(7)}if(-1!=D&&g!=D){var p=u;for(p.getDay()<D?p=p.AddDays(D-p.getDay()):p.getDay()>D&&(p=p.AddDays(7-(p.getDay()-D)));p<=c;)y++,p=p.AddDays(7)}}this.ExcludeHolidays&&(null!=this.dtHolidayDef&&this.dtHolidayDef.length>0&&(n=this.dtHolidayDef.filter((function(e){return e.HolidayDate>=u.ToString("dd MMM yyyy")&&e.HolidayDate<=c.ToString("dd MMM yyyy")}))),null!=n&&n.length>0&&(y+=n.length)),h-=y}var M=this.dsAllEmpsData.Tables[18].filter((function(e){return e.EmpSeqNo==i.sEmpSeqNo&&e.DocID==a}));if(d.length>0&&null!=d[0].ConsiderExcessDaysAsLOP&&null!=d[0].ConsiderExcessDaysAsLOP&&"Yes"==d[0].ConsiderExcessDaysAsLOP.toString()&&M.length>0&&!r.e.IsEmpty(M[0].ExcessDays)&&parseFloat(M[0].ExcessDays)>0){var S,f=new Array,E=new Date,F=new Date,T=new Date,A=new Date,L=new Date,v=new Date,I=new Date(M[0].FromDate),b=new Date(M[0].ToDate),N=parseFloat(M[0].PaidDays),O=(parseFloat(M[0].ExcessDays),N);v="01 Jan 1900"==new Date(M[0].ReJoinDate).ToString("dd MMM yyyy")?this.PayrollMonthEnd.AddDays(1):new Date(M[0].ReJoinDate),A=I;var V={PayrollMonth:E,PayrollMonthStart:F,PayrollMonthEnd:T};for(r.e.SetPayrollDate(A,V),F=V.PayrollMonthStart,T=V.PayrollMonthEnd,A=E=V.PayrollMonth;A<=b;){S=new o.d;var w={PayrollMonth:E,PayrollMonthStart:F,PayrollMonthEnd:T};r.e.SetPayrollDate(A,w),F=w.PayrollMonthStart,T=w.PayrollMonthEnd,L=E=w.PayrollMonth,S.DocDate=E,L<I&&(L=I),T>b&&(T=v<b?v.AddDays(-1):b),S.PaidDays=this.GetNoOfDays(L,T,l),(O=r.e.Round(O-S.PaidDays,2))<0?(S.ExcessDays=Math.abs(O),O=0):S.ExcessDays=0,f.push(S),A=A.AddMonths(1)}if(f.length>0)for(var R=0;R<f.length;R++)if(f[R].DocDate==this.PayrollMonth){h-=f[R].ExcessDays,this.dblLeavesLOP+=f[R].ExcessDays;break}}return h}},{key:"ReEvaluateData",value:function(e,t,a,r){this.iEmpIndex=e;var o=this.arrLstCPFields[e][t].find((function(e){return e.SNo==a}));null!=o&&(o.dActual=parseFloat(r).ToString(s.a.SessionManager.sPayrollDecimals)),this.othMPField=this.arrLstOthMPFields[this.iEmpIndex],this.ExecuteAllFormulas()}},{key:"UpdateExtraFieldData",value:function(e,t,a){this.iEmpIndex=e;var s=this.arrLstCPFields[e][6].find((function(e){return e.ExtraFieldName==t}));null!=s&&(s.ExtraFieldValue=a),this.othMPField=this.arrLstOthMPFields[this.iEmpIndex],this.ExecuteAllFormulas()}},{key:"GetUnpaidDays",value:function(){var e,t,a=0,o=0;if(this.othMPField.DateOfJoining.getDate(),this.PayrollMonth.DaysInMonth(),this.othMPField.DateOfJoining>this.PayrollMonthStart)if("Actual Days"!=s.a.SessionManager.Preferences.PayDays){var i=parseInt(s.a.SessionManager.Preferences.PayDays);for(e=this.PayrollMonthStart,t=this.othMPField.DateOfJoining;e<t;)e.getDate()!=e.DaysInMonth()?(e.getDate()>i||a++,e=e.AddDays(1)):(a+=i-e.getDate()+1,e=e.AddDays(1));if(this.othMPField.DateOfRelieve<this.PayrollMonthEnd)for(e=this.othMPField.DateOfRelieve.AddDays(1),t=this.PayrollMonthEnd;e<=t&&!(s.a.SessionManager.Preferences.ContainsKey("ConsiderUnpaidDaysBasedOnPayDays")&&"TRUE"==s.a.SessionManager.Preferences.ConsiderUnpaidDaysBasedOnPayDays.toString().toUpperCase()&&(o=e.Date.Subtract(this.PayrollMonthStart).Days+1,o>i));)e.getDate()!=e.DaysInMonth()?(e.getDate()>i||a++,e=e.AddDays(1)):(a+=i-e.getDate()+1,e=e.AddDays(1))}else a+=r.e.GetDateDifference(this.othMPField.DateOfJoining,this.PayrollMonthStart),this.othMPField.DateOfRelieve<this.PayrollMonthEnd&&(a+=r.e.GetDateDifference(this.PayrollMonthEnd,this.othMPField.DateOfRelieve));else if(this.othMPField.DateOfRelieve<this.PayrollMonthEnd)if("Actual Days"!=s.a.SessionManager.Preferences.PayDays){var n=parseInt(s.a.SessionManager.Preferences.PayDays);for(e=this.othMPField.DateOfRelieve.AddDays(1),t=this.PayrollMonthEnd;e<=t&&!(s.a.SessionManager.Preferences.ContainsKey("ConsiderUnpaidDaysBasedOnPayDays")&&"TRUE"==s.a.SessionManager.Preferences.ConsiderUnpaidDaysBasedOnPayDays.toString().toUpperCase()&&(o=e.Date.Subtract(this.PayrollMonthStart).Days+1,o>n));)e.getDate()!=e.DaysInMonth()?(e.getDate()>n||a++,e=e.AddDays(1)):(a+=n-e.getDate()+1,e=e.AddDays(1))}else a+=r.e.GetDateDifference(this.PayrollMonthEnd,this.othMPField.DateOfRelieve);return a}},{key:"SetDaysAttended",value:function(e,t,a){try{Logger.InfoLog("CommonMonthlyPayroll::Entering dgvDays_EndEdit()"),this.iEmpIndex=e,this.othMPField=this.arrLstOthMPFields[this.iEmpIndex],"Days Attended"==t?(this.othMPField.DaysAttended=a,this.othMPField.LOPDays=this.othMPField.MonthDays-(this.othMPField.DaysAttended+this.othMPField.TotalLeaves+this.othMPField.UnpaidDays),this.sDisplayMessage=this.othMPField.LOPDays<0?s.a.GetResource("EnterValidDaysAttended"):this.othMPField.dblLeavesLOP>0&&this.othMPField.LOPDays<this.othMPField.dblLeavesLOP?"Employee Should have atleast "+this.othMPField.dblLeavesLOP+" LOP Days":""):"LOP"==t&&(this.othMPField.LOPDays=a,this.othMPField.DaysAttended=this.othMPField.MonthDays-(this.othMPField.LOPDays+this.othMPField.TotalLeaves+this.othMPField.UnpaidDays)),this.othMPField.TotalDays=this.othMPField.DaysAttended+this.othMPField.TotalLeaves+this.othMPField.LOPDays+this.othMPField.UnpaidDays,this.ExecuteAllFormulas(),Logger.InfoLog("CommonMonthlyPayroll::Exiting dgvDays_EndEdit()")}catch(r){Logger.ErrorLog("CommonMonthlyPayroll::EXCEPTION dgvDays_EndEdit()\r\n"+r.Message+"\r\n"+r.stack)}}},{key:"ExecuteAllFormulas",value:function(){var e=this;try{if(Logger.InfoLog("CommonMonthlyPayroll::Entering ExecuteAllFormulas()"),this.othMPField.NetSalary=0,this.othMPField.dblGrossSalary=0,this.ExecuteFormulas(!0),this.ExecuteFormulas(!1),this.ExecuteFormulas(!1),this.ExecuteFormulas(!0),this.ExecuteFormulas(!1),this.ExecuteFormulas(!1),this.othMPField.dblGrossSalary=this.othMPField.totEarnings,this.othMPField.PTIndex>=0){var t=this.dsAllEmpsData.Tables[3];if(this.othMPField.drcPTDimension.length>0){var a=this.dsAllEmpsData.Tables[3];if(null!=(a=a.filter((function(t){return t.NodeID==e.othMPField.drcPTDimension[0].PTDimension.toString()&&""!=t.Formula})))&&a.length>0&&null!=a[0].Formula&&null!=a[0].Formula&&""!=a[0].Formula.toString().Trim()){var o=this.fldDict,i=parseFloat(s.a.eval.EvaluateExpression(a[0].Formula.toString(),o));this.arrLstCPFields[this.iEmpIndex][2][this.othMPField.PTIndex].dEarned=i.ToString(s.a.SessionManager.sPayrollDecimals),this.arrLstCPFields[this.iEmpIndex][2][this.othMPField.PTIndex].dActual=i.ToString(s.a.SessionManager.sPayrollDecimals)}else(t=t.filter((function(t){return t.NodeID==e.othMPField.drcPTDimension[0].PTDimension.toString()&&t.FromSlab<=e.othMPField.dPTApplicableAmt&&t.ToSlab>=e.othMPField.dPTApplicableAmt}))).length>0?(this.arrLstCPFields[this.iEmpIndex][2][this.othMPField.PTIndex].dEarned=this.RoundOffValue(parseFloat(t[0].Amount),this.arrLstCPFields[this.iEmpIndex][2][this.othMPField.PTIndex].ROff),this.arrLstCPFields[this.iEmpIndex][2][this.othMPField.PTIndex].dActual=this.arrLstCPFields[this.iEmpIndex][2][this.othMPField.PTIndex].dEarned):(this.arrLstCPFields[this.iEmpIndex][2][this.othMPField.PTIndex].dEarned=(0).ToString(s.a.SessionManager.sPayrollDecimals),this.arrLstCPFields[this.iEmpIndex][2][this.othMPField.PTIndex].dActual=(0).ToString(s.a.SessionManager.sPayrollDecimals))}else this.arrLstCPFields[this.iEmpIndex][2][this.othMPField.PTIndex].dEarned=(0).ToString(s.a.SessionManager.sPayrollDecimals),this.arrLstCPFields[this.iEmpIndex][2][this.othMPField.PTIndex].dActual=(0).ToString(s.a.SessionManager.sPayrollDecimals)}this.othMPField.totEarnings=this.othMPField.totDeductions=this.othMPField.totActEarnings=0,this.othMPField.totActDeductions=this.othMPField.totLoans=this.othMPField.totOPBalLeaves=0,this.othMPField.totLeavesTaken=this.othMPField.totNetBalLeaves=0,this.othMPField.totEarArrears=this.othMPField.totDedArrears=0,this.othMPField.totEarAdjustments=this.othMPField.totDedAdjustments=0,this.othMPField.totOTAmount=0,this.othMPField.totAccrualsAct=this.othMPField.totAccrualsEar=this.othMPField.totAccrualsArr=this.othMPField.totAccrualsAdj=0;for(var n=0;n<this.arrLstCPFields[this.iEmpIndex][0].length;n++)r.e.IsEmpty(this.arrLstCPFields[this.iEmpIndex][0][n].SNo)||(this.arrLstCPFields[this.iEmpIndex][0][n].IsAccrualType?(this.othMPField.totAccrualsAct+=parseFloat(this.arrLstCPFields[this.iEmpIndex][0][n].dActual),this.othMPField.totAccrualsEar+=parseFloat(this.arrLstCPFields[this.iEmpIndex][0][n].dEarned),this.othMPField.totAccrualsArr+=parseFloat(this.arrLstCPFields[this.iEmpIndex][0][n].dArrear),this.othMPField.totAccrualsAdj+=parseFloat(this.arrLstCPFields[this.iEmpIndex][0][n].dAdjusted)):null==this.arrLstCPFields[this.iEmpIndex][0][n].AddToNet||""==this.arrLstCPFields[this.iEmpIndex][0][n].AddToNet||"Net"!=this.arrLstCPFields[this.iEmpIndex][0][n].AddToNet&&"NetAndTax"!=this.arrLstCPFields[this.iEmpIndex][0][n].AddToNet||(this.othMPField.totActEarnings+=parseFloat(this.arrLstCPFields[this.iEmpIndex][0][n].dActual),this.othMPField.totEarnings+=parseFloat(this.arrLstCPFields[this.iEmpIndex][0][n].dEarned),this.othMPField.totEarArrears+=parseFloat(this.arrLstCPFields[this.iEmpIndex][0][n].dArrear),this.othMPField.totEarAdjustments+=parseFloat(this.arrLstCPFields[this.iEmpIndex][0][n].dAdjusted)));for(var l=r.e.GetEmptyDate(),d=0,c=0;c<this.arrLstCPFields[this.iEmpIndex][1].length;c++)if(!r.e.IsEmpty(this.arrLstCPFields[this.iEmpIndex][1][c].SNo)&&null!=this.arrLstCPFields[this.iEmpIndex][1][c].AddToNet&&""!=this.arrLstCPFields[this.iEmpIndex][1][c].AddToNet&&("Net"==this.arrLstCPFields[this.iEmpIndex][1][c].AddToNet||"NetAndTax"==this.arrLstCPFields[this.iEmpIndex][1][c].AddToNet)){var h=parseFloat(this.arrLstCPFields[this.iEmpIndex][1][c].dActual).ToString("00.00").split(".");l=l.AddHours(parseFloat(h[0])),h.length>1&&(1==h[1].length&&(h[1]=h[1]+"0"),l=l.AddMinutes(parseFloat(h[1]))),this.othMPField.totOTAmount+=parseFloat(this.arrLstCPFields[this.iEmpIndex][1][c].dEarned)}var u=l.getMinutes().toString();1==u.length&&(u="0"+u),d=parseFloat(24*(l.getDate()-1)+l.getHours()+"."+u),this.othMPField.totOTHours=d.toString();for(var g=0;g<this.arrLstCPFields[this.iEmpIndex][2].length;g++)r.e.IsEmpty(this.arrLstCPFields[this.iEmpIndex][2][g].SNo)||null==this.arrLstCPFields[this.iEmpIndex][2][g].AddToNet||""==this.arrLstCPFields[this.iEmpIndex][2][g].AddToNet||"Net"!=this.arrLstCPFields[this.iEmpIndex][2][g].AddToNet&&"NetAndTax"!=this.arrLstCPFields[this.iEmpIndex][2][g].AddToNet||(this.othMPField.totActDeductions+=parseFloat(this.arrLstCPFields[this.iEmpIndex][2][g].dActual),this.othMPField.totDeductions+=parseFloat(this.arrLstCPFields[this.iEmpIndex][2][g].dEarned),this.othMPField.totDedArrears+=parseFloat(this.arrLstCPFields[this.iEmpIndex][2][g].dArrear),this.othMPField.totDedAdjustments+=parseFloat(this.arrLstCPFields[this.iEmpIndex][2][g].dAdjusted));for(var D=0;D<this.arrLstCPFields[this.iEmpIndex][4].length;D++)!r.e.IsEmpty(this.arrLstCPFields[this.iEmpIndex][4][D].SNo)&&1==this.arrLstCPFields[this.iEmpIndex][4][D].IsVisible&&!r.e.IsEmpty(this.arrLstCPFields[this.iEmpIndex][4][D].LoanInstAmt)&&parseFloat(this.arrLstCPFields[this.iEmpIndex][4][D].LoanInstAmt)>0&&(this.othMPField.totLoans+=parseFloat(this.arrLstCPFields[this.iEmpIndex][4][D].LoanInstAmt));for(var y=0;y<this.arrLstCPFields[this.iEmpIndex][5].length;y++)r.e.IsEmpty(this.arrLstCPFields[this.iEmpIndex][5][y].SNo)||(null!=this.arrLstCPFields[this.iEmpIndex][5][y].LeaveTotOPBal&&""!=this.arrLstCPFields[this.iEmpIndex][5][y].LeaveTotOPBal.toString()&&(this.othMPField.totOPBalLeaves+=parseFloat(this.arrLstCPFields[this.iEmpIndex][5][y].LeaveTotOPBal)),null!=this.arrLstCPFields[this.iEmpIndex][5][y].LeaveTaken&&""!=this.arrLstCPFields[this.iEmpIndex][5][y].LeaveTaken.toString()&&(this.othMPField.totLeavesTaken+=parseFloat(this.arrLstCPFields[this.iEmpIndex][5][y].LeaveTaken)),null!=this.arrLstCPFields[this.iEmpIndex][5][y].LeaveNetBal&&""!=this.arrLstCPFields[this.iEmpIndex][5][y].LeaveNetBal.toString()&&(this.othMPField.totNetBalLeaves+=parseFloat(this.arrLstCPFields[this.iEmpIndex][5][y].LeaveNetBal)));this.CalculateNet(),Logger.InfoLog("CommonMonthlyPayroll::Exiting ExecuteAllFormulas()")}catch(P){Logger.ErrorLog("CommonMonthlyPayroll::EXCEPTION ExecuteAllFormulas()\r\n"+P.Message+"\r\n"+P.stack)}this.arrLstOthMPFields[this.iEmpIndex]=this.othMPField}},{key:"CalculateNet",value:function(){this.othMPField.NetSalary=parseFloat(r.e.GetAmountsBasedOnPref(this.othMPField.totEarnings+this.othMPField.totEarArrears+this.othMPField.totEarAdjustments+this.othMPField.totOTAmount-(this.othMPField.totDeductions+this.othMPField.totDedArrears+this.othMPField.totDedAdjustments+this.othMPField.totLoans),s.a.SessionManager.sPayrollDecimals.Replace("N","")))}},{key:"ExecuteFormulas",value:function(e){var t=this;try{Logger.InfoLog("CommonMonthlyPayroll::Entering ExecuteFormulas()"),this.drcAllEmpsData=this.dsAllEmpsData.Tables[0].filter((function(e){return e.EmpSeqNo==t.othMPField.EmpSeqNo})),this.fldDict=new l.a;var a,o="0";this.othMPField.totEarnings=this.othMPField.totDeductions=this.othMPField.totActEarnings=0,this.othMPField.totActDeductions=this.othMPField.totLoans=this.othMPField.totOPBalLeaves=0,this.othMPField.totLeavesTaken=this.othMPField.totNetBalLeaves=0,this.othMPField.totEarArrears=this.othMPField.totDedArrears=0,this.othMPField.totEarAdjustments=this.othMPField.totDedAdjustments=0,this.othMPField.totOTAmount=0,a=new n.c("Basic",""),this.fldDict.push("Basic",a),this.fldDict.Basic.setFieldValue(this.othMPField.BasicMonthly),a=new n.c("Gross",""),this.fldDict.push("Gross",a),this.fldDict.Gross.setFieldValue(this.othMPField.dblGrossSalary),a=new n.c("ServiceDays",""),this.fldDict.push("ServiceDays",a),this.fldDict.ServiceDays.setFieldValue(this.othMPField.dServiceDays),a=new n.c("WeeklyOffs",""),this.fldDict.push("WeeklyOffs",a),this.fldDict.WeeklyOffs.setFieldValue(this.othMPField.WeeklyOffs),a=new n.c("LeavesTaken",""),this.fldDict.push("LeavesTaken",a),this.fldDict.LeavesTaken.setFieldValue(this.othMPField.TotalLeaves),a=new n.c("VacDaysTaken",""),this.fldDict.push("VacDaysTaken",a),this.fldDict.VacDaysTaken.setFieldValue(this.othMPField.dblTotVacDays),a=new n.c("VacDays",""),this.fldDict.push("VacDays",a),this.fldDict.VacDays.setFieldValue(this.othMPField.dblTotMVacDays),a=new n.c("VacAmount",""),this.fldDict.push("VacAmount",a),this.fldDict.VacAmount.setFieldValue(this.othMPField.dblTotVacAmount),a=new n.c("VacEncashDays",""),this.fldDict.push("VacEncashDays",a),this.fldDict.VacEncashDays.setFieldValue(this.othMPField.dblTotVacEncashDays),a=new n.c("VacEncashAmount",""),this.fldDict.push("VacEncashAmount",a),this.fldDict.VacEncashAmount.setFieldValue(this.othMPField.dblTotVacEncashAmount),a=new n.c("VacExcessDays",""),this.fldDict.push("VacExcessDays",a),this.fldDict.VacExcessDays.setFieldValue(this.othMPField.dblTotVacExcessDays),a=new n.c("VacExcessAmount",""),this.fldDict.push("VacExcessAmount",a),this.fldDict.VacExcessAmount.setFieldValue(this.othMPField.dblTotVacExcessAmount),a=new n.c("VacNetAmount",""),this.fldDict.push("VacNetAmount",a),this.fldDict.VacNetAmount.setFieldValue(this.othMPField.dblTotVacNetAmount),a=new n.c("TotalDays",""),this.fldDict.push("TotalDays",a),this.fldDict.TotalDays.setFieldValue(this.othMPField.TotalDays),a=new n.c("DaysAttended",""),this.fldDict.push("DaysAttended",a),this.fldDict.DaysAttended.setFieldValue(e?this.othMPField.TotalDays:this.othMPField.DaysAttended+this.othMPField.PaidLeaves),a=new n.c("UnpaidDays",""),this.fldDict.push("UnpaidDays",a),this.fldDict.UnpaidDays.setFieldValue(this.othMPField.UnpaidDays),a=new n.c("LOPDays",""),this.fldDict.push("LOPDays",a),this.fldDict.LOPDays.setFieldValue(this.othMPField.LOPDays),a=new n.c("Holidays",""),this.fldDict.push("Holidays",a),this.fldDict.Holidays.setFieldValue(this.othMPField.Holidays),a=new n.c("AdjDays",""),this.fldDict.push("AdjDays",a),this.fldDict.AdjDays.setFieldValue(this.dAdjDays),a=new n.c("EmpType",""),this.fldDict.push("EmpType",a),this.fldDict.EmpType.setFieldValue(this.drcAllEmpsData[0].sEmpType.toString()),a=new n.c("Gender",""),this.fldDict.push("Gender",a),this.fldDict.Gender.setFieldValue(this.drcAllEmpsData[0].sGender.toString()),a=new n.c("MaritalStatus",""),this.fldDict.push("MaritalStatus",a),this.fldDict.MaritalStatus.setFieldValue(this.drcAllEmpsData[0].sMaritalStatus.toString()),a=new n.c("Nationality",""),this.fldDict.push("Nationality",a),this.fldDict.Nationality.setFieldValue(this.drcAllEmpsData[0].sNationality.toString()),a=new n.c("Religion",""),this.fldDict.push("Religion",a),this.fldDict.Religion.setFieldValue(this.drcAllEmpsData[0].sReligion.toString()),a=new n.c("ChildrenCount",""),this.fldDict.push("ChildrenCount",a),null!=this.drcDependentInfo?(this.drcDependentInfo=this.dsAllEmpsData.Tables[23].filter((function(e){return e.EmpSeqNo==t.othMPField.EmpSeqNo&&"Children"==e.Relation})),this.fldDict.ChildrenCount.setFieldValue(this.drcDependentInfo.length)):this.fldDict.ChildrenCount.setFieldValue(0),a=new n.c("ChildrenDays",""),this.fldDict.push("ChildrenDays",a);var i=0;if(null!=this.drcDependentInfo&&(this.drcDependentInfo=this.dsAllEmpsData.Tables[23].filter((function(e){return e.EmpSeqNo==t.othMPField.EmpSeqNo&&"Children"==e.Relation}))),this.drcDependentInfo.length>0)for(var d=this.drcDependentInfo,c=0;c<d.length;c++)if(new Date(d.Rows[c].ChildDOB)>=this.PayrollMonthStart&&new Date(d.Rows[c].ChildDOB)<=this.PayrollMonthEnd)i+=r.e.GetDateDifference(this.PayrollMonthEnd,new Date(d.Rows[c].ChildDOB))+1;else{var h=0,u=0,g=0,D={iY:h,iM:u,iD:g};r.e.GetYearsMonthsDays(new Date(d.Rows[c].ChildDOB),this.PayrollMonthEnd,D),u=D.iM,g=D.iD,18==(h=D.iY)&&0==u?i+=this.PayrollMonthEnd.Subtract(this.PayrollMonthStart).Days+1-g:h<18&&(i+=this.PayrollMonthEnd.Subtract(this.PayrollMonthStart).Days+1)}this.fldDict.ChildrenDays.setFieldValue(i),a=new n.c("PayrollMonthNo",""),this.fldDict.push("PayrollMonthNo",a),this.fldDict.PayrollMonthNo.setFieldValue(this.PayrollMonth.iMonth()),a=new n.c("PayrollYearNo",""),this.fldDict.push("PayrollYearNo",a),this.fldDict.PayrollYearNo.setFieldValue(this.PayrollMonth.getFullYear()),a=new n.c("DOJMonth",""),this.fldDict.push("DOJMonth",a),this.fldDict.DOJMonth.setFieldValue(new Date(this.drcAllEmpsData[0].CDOJ).iMonth()),a=new n.c("DOJYear",""),this.fldDict.push("DOJYear",a),this.fldDict.DOJYear.setFieldValue(new Date(this.drcAllEmpsData[0].CDOJ).getFullYear()),a=new n.c("DORMonth",""),this.fldDict.push("DORMonth",a),r.e.IsEmpty(this.drcAllEmpsData[0].CDORelieve)?this.fldDict.DORMonth.setFieldValue(1):this.fldDict.DORMonth.setFieldValue(new Date(this.drcAllEmpsData[0].CDORelieve).iMonth()),a=new n.c("DORYear",""),this.fldDict.push("DORYear",a),r.e.IsEmpty(this.drcAllEmpsData[0].CDORelieve)?this.fldDict.DORYear.setFieldValue(2200):this.fldDict.DORYear.setFieldValue(new Date(this.drcAllEmpsData[0].CDORelieve).getFullYear()),a=new n.c("EmpConfirmationDate",""),this.fldDict.push("EmpConfirmationDate",a),this.fldDict.EmpConfirmationDate.setFieldValue(new Date(this.drcAllEmpsData[0].CDOC)),a=new n.c("LeaveFromDate",""),this.fldDict.push("LeaveFromDate",a),this.fldDict.LeaveFromDate.setFieldValue((new Date).Date),a=new n.c("LeaveNoOfDays",""),this.fldDict.push("LeaveNoOfDays",a),this.fldDict.LeaveNoOfDays.setFieldValue(0),a=new n.c("EmpVacationDays",""),this.fldDict.push("EmpVacationDays",a),this.fldDict.EmpVacationDays.setFieldValue(this.drcAllEmpsData[0].VacDaysPerMonth),a=new n.c("AppraisalMonthNo",""),this.fldDict.push("AppraisalMonthNo",a),this.fldDict.AppraisalMonthNo.setFieldValue(this.drcApprisal.length>0?this.othMPField.AppraisalMonth.iMonth():0),a=new n.c("VacDaysPayYes",""),this.fldDict.push("VacDaysPayYes",a),this.fldDict.VacDaysPayYes.setFieldValue(this.dVacPayYes),a=new n.c("VacDaysPayNo",""),this.fldDict.push("VacDaysPayNo",a),this.fldDict.VacDaysPayNo.setFieldValue(this.dVacPayNo),a=new n.c("PreviousGosiValue",""),this.fldDict.push("PreviousGosiValue",a),this.fldDict.PreviousGosiValue.setFieldValue(this.othMPField.dGosi);var y=0,P=0,C=0,m=0,p=0,M=0,S=0,f=0,E=0,F=0,T=0;null!=this.drcLatesProc&&(this.drcLatesProc=this.dsAllEmpsData.Tables[31].filter((function(e){return e.EmpSeqNo==t.othMPField.EmpSeqNo})),this.drcLatesProc.length>0&&(y=parseFloat(this.drcLatesProc[0].TotCheckInLateMins),P=parseFloat(this.drcLatesProc[0].TotCheckOutEarlyMins),C=parseFloat(this.drcLatesProc[0].TotBreak1MoreMins),m=parseFloat(this.drcLatesProc[0].TotBreak2MoreMins),p=parseFloat(this.drcLatesProc[0].TotBreak3MoreMins),M=parseFloat(this.drcLatesProc[0].TotBreak4MoreMins),S=parseFloat(this.drcLatesProc[0].TotBreak5MoreMins),f=parseFloat(this.drcLatesProc[0].TotLateHrsToDeduct),E=parseFloat(this.drcLatesProc[0].TotLateLeavesToDeduct),F=parseFloat(this.drcLatesProc[0].TotWorkingMinsLessBy),T=parseFloat(this.drcLatesProc[0].TotAbsentMinsLessBy))),a=new n.c("TotCheckInLateMins",""),this.fldDict.push("TotCheckInLateMins",a),this.fldDict.TotCheckInLateMins.setFieldValue(y),a=new n.c("TotCheckOutEarlyMins",""),this.fldDict.push("TotCheckOutEarlyMins",a),this.fldDict.TotCheckOutEarlyMins.setFieldValue(P),a=new n.c("TotBreak1MoreMins",""),this.fldDict.push("TotBreak1MoreMins",a),this.fldDict.TotBreak1MoreMins.setFieldValue(C),a=new n.c("TotBreak2MoreMins",""),this.fldDict.push("TotBreak2MoreMins",a),this.fldDict.TotBreak2MoreMins.setFieldValue(m),a=new n.c("TotBreak3MoreMins",""),this.fldDict.push("TotBreak3MoreMins",a),this.fldDict.TotBreak3MoreMins.setFieldValue(p),a=new n.c("TotBreak4MoreMins",""),this.fldDict.push("TotBreak4MoreMins",a),this.fldDict.TotBreak4MoreMins.setFieldValue(M),a=new n.c("TotBreak5MoreMins",""),this.fldDict.push("TotBreak5MoreMins",a),this.fldDict.TotBreak5MoreMins.setFieldValue(S),a=new n.c("TotLateHrsToDeduct",""),this.fldDict.push("TotLateHrsToDeduct",a),this.fldDict.TotLateHrsToDeduct.setFieldValue(f),a=new n.c("TotLateLeavesToDeduct",""),this.fldDict.push("TotLateLeavesToDeduct",a),this.fldDict.TotLateLeavesToDeduct.setFieldValue(E),a=new n.c("TotWorkingMinsLessBy",""),this.fldDict.push("TotWorkingMinsLessBy",a),this.fldDict.TotWorkingMinsLessBy.setFieldValue(F),a=new n.c("TotAbsentMinsLessBy",""),this.fldDict.push("TotAbsentMinsLessBy",a),this.fldDict.TotAbsentMinsLessBy.setFieldValue(T),this.drcCCData=this.dsData.Tables[0].filter((function(e){return e.EmpSeqNo==t.othMPField.EmpSeqNo}));var A="",L="";if(a=new n.c("RptManagerCode",""),this.fldDict.push("RptManagerCode",a),a=new n.c("RptManagerName",""),this.fldDict.push("RptManagerName",a),this.drcCCData.length>0&&Object.keys(this.drcCCData[0]).Contains("RptManager")&&(this.drcDimsData=this.dsData1.Tables[0].filter((function(e){return"RptManager"==e.SysColName&&e.NodeID==t.drcCCData[0].RptManager.toString()})),this.drcDimsData.length>0&&(A=this.drcDimsData[0].Code.toString(),L=this.drcDimsData[0].Name.toString())),this.fldDict.RptManagerCode.setFieldValue(A),this.fldDict.RptManagerName.setFieldValue(L),this.drcCCData.length>0)for(var v=function(e){var s=Object.keys(t.drcCCData[0])[e];s.Contains("CCNID")&&(t.drcDimsData=t.dsData1.Tables[0].filter((function(e){return e.SysColName==s})),t.drcDimsData.length>0&&(a=new n.c(t.drcDimsData[0].UserColumnName.toString()+"Code",""),t.fldDict.push(t.drcDimsData[0].UserColumnName.toString()+"Code",a),a=new n.c(t.drcDimsData[0].UserColumnName.toString()+"Name",""),t.fldDict.push(t.drcDimsData[0].UserColumnName.toString()+"Name",a),t.drcDimsData=t.dsData1.Tables[0].filter((function(e){return e.SysColName==s&&e.NodeID==t.drcCCData[0][s].toString()})),t.fldDict[t.drcDimsData[0].UserColumnName.toString()+"Code"].setFieldValue(t.drcDimsData[0].Code.toString()),t.fldDict[t.drcDimsData[0].UserColumnName.toString()+"Name"].setFieldValue(t.drcDimsData[0].Name.toString())))},I=0;I<Object.keys(this.drcCCData[0]).length;I++)v(I);for(var b=0;b<this.arrLstCPFields[this.iEmpIndex][0].length;b++)r.e.IsEmpty(this.arrLstCPFields[this.iEmpIndex][0][b].SNo)||(a=new n.c(this.arrLstCPFields[this.iEmpIndex][0][b].ComponentName,""),this.fldDict.push(this.arrLstCPFields[this.iEmpIndex][0][b].ComponentName,a),this.fldDict[this.arrLstCPFields[this.iEmpIndex][0][b].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[this.iEmpIndex][0][b].dActual).ToString(s.a.SessionManager.sPayrollDecimals)),a=new n.c("Calc"+this.arrLstCPFields[this.iEmpIndex][0][b].ComponentName,""),this.fldDict.push("Calc"+this.arrLstCPFields[this.iEmpIndex][0][b].ComponentName,a),this.fldDict["Calc"+this.arrLstCPFields[this.iEmpIndex][0][b].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[this.iEmpIndex][0][b].dEarned).ToString(s.a.SessionManager.sPayrollDecimals)),a=new n.c("Arr_"+this.arrLstCPFields[this.iEmpIndex][0][b].ComponentName,""),this.fldDict.push("Arr_"+this.arrLstCPFields[this.iEmpIndex][0][b].ComponentName,a),this.fldDict["Arr_"+this.arrLstCPFields[this.iEmpIndex][0][b].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[this.iEmpIndex][0][b].dArrear).ToString(s.a.SessionManager.sPayrollDecimals)),a=new n.c("Adj_"+this.arrLstCPFields[this.iEmpIndex][0][b].ComponentName,""),this.fldDict.push("Adj_"+this.arrLstCPFields[this.iEmpIndex][0][b].ComponentName,a),this.fldDict["Adj_"+this.arrLstCPFields[this.iEmpIndex][0][b].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[this.iEmpIndex][0][b].dAdjusted).ToString(s.a.SessionManager.sPayrollDecimals)));for(var N=0;N<this.arrLstCPFields[this.iEmpIndex][1].length;N++)""!=this.arrLstCPFields[this.iEmpIndex][1][N].SNo.toString()&&(a=new n.c(this.arrLstCPFields[this.iEmpIndex][1][N].ComponentName,""),this.fldDict.push(this.arrLstCPFields[this.iEmpIndex][1][N].ComponentName,a),this.fldDict[this.arrLstCPFields[this.iEmpIndex][1][N].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[this.iEmpIndex][1][N].dActual).ToString(s.a.SessionManager.sPayrollDecimals)),a=new n.c("Calc"+this.arrLstCPFields[this.iEmpIndex][1][N].ComponentName,""),this.fldDict.push("Calc"+this.arrLstCPFields[this.iEmpIndex][1][N].ComponentName,a),this.fldDict["Calc"+this.arrLstCPFields[this.iEmpIndex][1][N].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[this.iEmpIndex][1][N].dEarned).ToString(s.a.SessionManager.sPayrollDecimals)),a=new n.c("Arr_"+this.arrLstCPFields[this.iEmpIndex][1][N].ComponentName,""),this.fldDict.push("Arr_"+this.arrLstCPFields[this.iEmpIndex][1][N].ComponentName,a),this.fldDict["Arr_"+this.arrLstCPFields[this.iEmpIndex][1][N].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[this.iEmpIndex][1][N].dArrear).ToString(s.a.SessionManager.sPayrollDecimals)),a=new n.c("Adj_"+this.arrLstCPFields[this.iEmpIndex][1][N].ComponentName,""),this.fldDict.push("Adj_"+this.arrLstCPFields[this.iEmpIndex][1][N].ComponentName,a),this.fldDict["Adj_"+this.arrLstCPFields[this.iEmpIndex][1][N].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[this.iEmpIndex][1][N].dAdjusted).ToString(s.a.SessionManager.sPayrollDecimals)));for(var O=0;O<this.arrLstCPFields[this.iEmpIndex][2].length;O++)""!=this.arrLstCPFields[this.iEmpIndex][2][O].SNo.toString()&&(a=new n.c(this.arrLstCPFields[this.iEmpIndex][2][O].ComponentName,""),this.fldDict.push(this.arrLstCPFields[this.iEmpIndex][2][O].ComponentName,a),this.fldDict[this.arrLstCPFields[this.iEmpIndex][2][O].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[this.iEmpIndex][2][O].dActual).ToString(s.a.SessionManager.sPayrollDecimals)),a=new n.c("Calc"+this.arrLstCPFields[this.iEmpIndex][2][O].ComponentName,""),this.fldDict.push("Calc"+this.arrLstCPFields[this.iEmpIndex][2][O].ComponentName,a),this.fldDict["Calc"+this.arrLstCPFields[this.iEmpIndex][2][O].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[this.iEmpIndex][2][O].dEarned).ToString(s.a.SessionManager.sPayrollDecimals)),a=new n.c("Arr_"+this.arrLstCPFields[this.iEmpIndex][2][O].ComponentName,""),this.fldDict.push("Arr_"+this.arrLstCPFields[this.iEmpIndex][2][O].ComponentName,a),this.fldDict["Arr_"+this.arrLstCPFields[this.iEmpIndex][2][O].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[this.iEmpIndex][2][O].dArrear).ToString(s.a.SessionManager.sPayrollDecimals)),a=new n.c("Adj_"+this.arrLstCPFields[this.iEmpIndex][2][O].ComponentName,""),this.fldDict.push("Adj_"+this.arrLstCPFields[this.iEmpIndex][2][O].ComponentName,a),this.fldDict["Adj_"+this.arrLstCPFields[this.iEmpIndex][2][O].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[this.iEmpIndex][2][O].dAdjusted).ToString(s.a.SessionManager.sPayrollDecimals)));for(var V=0;V<this.arrLstCPFields[this.iEmpIndex][4].length;V++)""!=this.arrLstCPFields[this.iEmpIndex][4][V].SNo.toString()&&(a=new n.c(this.arrLstCPFields[this.iEmpIndex][4][V].ComponentName,""),this.fldDict.push(this.arrLstCPFields[this.iEmpIndex][4][V].ComponentName,a),a=new n.c(this.arrLstCPFields[this.iEmpIndex][4][V].ComponentName+"BalAmt",""),this.fldDict.push(this.arrLstCPFields[this.iEmpIndex][4][V].ComponentName+"BalAmt",a)),1==this.arrLstCPFields[this.iEmpIndex][4][V].IsVisible&&null!=this.arrLstCPFields[this.iEmpIndex][4][V].LoanInstAmt&&""!=this.arrLstCPFields[this.iEmpIndex][4][V].LoanInstAmt.toString()&&parseFloat(this.arrLstCPFields[this.iEmpIndex][4][V].LoanInstAmt)>0?(this.fldDict[this.arrLstCPFields[this.iEmpIndex][4][V].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[this.iEmpIndex][4][V].LoanInstAmt).ToString(s.a.SessionManager.sPayrollDecimals)),this.fldDict[this.arrLstCPFields[this.iEmpIndex][4][V].ComponentName+"BalAmt"].setFieldValue(parseFloat(this.arrLstCPFields[this.iEmpIndex][4][V].LoanBalAmt).ToString(s.a.SessionManager.sPayrollDecimals))):(this.fldDict[this.arrLstCPFields[this.iEmpIndex][4][V].ComponentName].setFieldValue(0),this.fldDict[this.arrLstCPFields[this.iEmpIndex][4][V].ComponentName+"BalAmt"].setFieldValue(0));for(var w=0;w<this.arrLstCPFields[this.iEmpIndex][5].length;w++)""!=this.arrLstCPFields[this.iEmpIndex][5][w].SNo.toString()&&(a=new n.c(this.arrLstCPFields[this.iEmpIndex][5][w].ComponentName,""),this.fldDict.push(this.arrLstCPFields[this.iEmpIndex][5][w].ComponentName,a),this.fldDict[this.arrLstCPFields[this.iEmpIndex][5][w].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[this.iEmpIndex][5][w].LeaveTaken).ToString(s.a.SessionManager.sPayrollDecimals)),a=new n.c(this.arrLstCPFields[this.iEmpIndex][5][w].ComponentName+"_Bal",""),this.fldDict.push(this.arrLstCPFields[this.iEmpIndex][5][w].ComponentName+"_Bal",a),this.fldDict[this.arrLstCPFields[this.iEmpIndex][5][w].ComponentName+"_Bal"].setFieldValue(parseFloat(this.arrLstCPFields[this.iEmpIndex][5][w].LeaveTotOPBal).ToString(s.a.SessionManager.sPayrollDecimals)));for(var R=this.fldDict,x=0,k=0;k<this.arrLstCPFields[this.iEmpIndex][0].length;k++)r.e.IsEmpty(this.arrLstCPFields[this.iEmpIndex][0][k].SNo)||(null!=this.arrLstCPFields[this.iEmpIndex][0][k].Formula&&""!=this.arrLstCPFields[this.iEmpIndex][0][k].Formula?(this.arrLstCPFields[this.iEmpIndex][0][k].dEarned=this.RoundOffValue(parseFloat(s.a.eval.EvaluateExpression(this.arrLstCPFields[this.iEmpIndex][0][k].Formula,R)),this.arrLstCPFields[this.iEmpIndex][0][k].ROff),this.fldDict["Calc"+this.arrLstCPFields[this.iEmpIndex][0][k].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[this.iEmpIndex][0][k].dEarned).ToString(s.a.SessionManager.sPayrollDecimals)),e&&"Formula"==this.arrLstCPFields[this.iEmpIndex][0][k].FieldType&&(this.arrLstCPFields[this.iEmpIndex][0][k].dActual=this.arrLstCPFields[this.iEmpIndex][0][k].dEarned.Replace(",",""),this.fldDict[this.arrLstCPFields[this.iEmpIndex][0][k].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[this.iEmpIndex][0][k].dActual).ToString(s.a.SessionManager.sPayrollDecimals))),"PFBasedOn"==this.arrLstCPFields[this.iEmpIndex][0][k].ComponentName&&(x=parseFloat(this.arrLstCPFields[this.iEmpIndex][0][k].dEarned))):"Monthly"!=this.arrLstCPFields[this.iEmpIndex][0][k].FieldType||null!=this.arrLstCPFields[this.iEmpIndex][0][k].Formula&&""!=this.arrLstCPFields[this.iEmpIndex][0][k].Formula||(this.arrLstCPFields[this.iEmpIndex][0][k].dEarned=this.arrLstCPFields[this.iEmpIndex][0][k].dActual.Replace(",",""),this.arrLstCPFields[this.iEmpIndex][0][k].dActual=this.arrLstCPFields[this.iEmpIndex][0][k].dEarned.Replace(",","")));for(var W=0;W<this.arrLstCPFields[this.iEmpIndex][1].length;W++)r.e.IsEmpty(this.arrLstCPFields[this.iEmpIndex][1][W].SNo)||(null!=this.arrLstCPFields[this.iEmpIndex][1][W].Formula&&""!=this.arrLstCPFields[this.iEmpIndex][1][W].Formula?(this.arrLstCPFields[this.iEmpIndex][1][W].dEarned=this.RoundOffValue(parseFloat(s.a.eval.EvaluateExpression(this.arrLstCPFields[this.iEmpIndex][1][W].Formula,R)),this.arrLstCPFields[this.iEmpIndex][1][W].ROff),r.e.IsEmpty(this.arrLstCPFields[this.iEmpIndex][1][W].dEarned)||(this.arrLstCPFields[this.iEmpIndex][1][W].dEarned=parseFloat(this.arrLstCPFields[this.iEmpIndex][1][W].dEarned).ToString(s.a.SessionManager.sPayrollDecimals)),this.fldDict["Calc"+this.arrLstCPFields[this.iEmpIndex][1][W].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[this.iEmpIndex][1][W].dEarned).ToString(s.a.SessionManager.sPayrollDecimals))):this.arrLstCPFields[this.iEmpIndex][1][W].dEarned=(0).ToString(s.a.SessionManager.sPayrollDecimals));for(var j=0;j<this.arrLstCPFields[this.iEmpIndex][2].length;j++)r.e.IsEmpty(this.arrLstCPFields[this.iEmpIndex][2][j].SNo)||(null!=this.arrLstCPFields[this.iEmpIndex][2][j].Formula&&""!=this.arrLstCPFields[this.iEmpIndex][2][j].Formula?("ESI"==this.arrLstCPFields[this.iEmpIndex][2][j].ComponentName?this.arrLstCPFields[this.iEmpIndex][2][j].dEarned=Math.ceil(parseFloat(s.a.eval.EvaluateExpression(this.arrLstCPFields[this.iEmpIndex][2][j].Formula,R))).ToString(s.a.SessionManager.sPayrollDecimals).Replace(",",""):(o=parseFloat(s.a.eval.EvaluateExpression(this.arrLstCPFields[this.iEmpIndex][2][j].Formula,R)).ToString(s.a.SessionManager.sPayrollDecimals),"PT"==this.arrLstCPFields[this.iEmpIndex][2][j].ComponentName?(this.othMPField.dPTApplicableAmt=parseFloat(o),this.arrLstCPFields[this.iEmpIndex][2][j].dEarned=(0).ToString(s.a.SessionManager.sPayrollDecimals)):this.arrLstCPFields[this.iEmpIndex][2][j].dEarned=this.RoundOffValue(parseFloat(o),this.arrLstCPFields[this.iEmpIndex][2][j].ROff),this.fldDict["Calc"+this.arrLstCPFields[this.iEmpIndex][2][j].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[this.iEmpIndex][2][j].dEarned).ToString(s.a.SessionManager.sPayrollDecimals))),e&&"Formula"==this.arrLstCPFields[this.iEmpIndex][2][j].FieldType&&(this.arrLstCPFields[this.iEmpIndex][2][j].dActual="PT"==this.arrLstCPFields[this.iEmpIndex][2][j].ComponentName?(0).ToString(s.a.SessionManager.sPayrollDecimals):this.arrLstCPFields[this.iEmpIndex][2][j].dEarned.Replace(",",""),this.fldDict[this.arrLstCPFields[this.iEmpIndex][2][j].ComponentName].setFieldValue(parseFloat(this.arrLstCPFields[this.iEmpIndex][2][j].dActual).ToString(s.a.SessionManager.sPayrollDecimals)))):"Monthly"!=this.arrLstCPFields[this.iEmpIndex][2][j].FieldType||null!=this.arrLstCPFields[this.iEmpIndex][2][j].Formula&&""!=this.arrLstCPFields[this.iEmpIndex][2][j].Formula||(this.arrLstCPFields[this.iEmpIndex][2][j].dEarned=this.arrLstCPFields[this.iEmpIndex][2][j].dActual.Replace(",",""),this.arrLstCPFields[this.iEmpIndex][2][j].dActual=this.arrLstCPFields[this.iEmpIndex][2][j].dEarned.Replace(",","")));if(!e&&x>0){for(var B=0;B<this.arrLstCPFields[this.iEmpIndex][0].length;B++)if(""!=r.e.String(this.arrLstCPFields[this.iEmpIndex][0][B].SNo)&&"PFE"==this.arrLstCPFields[this.iEmpIndex][0][B].ComponentName&&this.arrLstCPFields[this.iEmpIndex][0][B].isArrCalculated&&(parseFloat(this.arrLstCPFields[this.iEmpIndex][0][B].dArrear)>x-parseFloat(this.arrLstCPFields[this.iEmpIndex][0][B].dEarned)&&(this.arrLstCPFields[this.iEmpIndex][0][B].dArrear=(x-parseFloat(this.arrLstCPFields[this.iEmpIndex][0][B].dEarned)).ToString(s.a.SessionManager.sPayrollDecimals)),null!=this.arrLstCPFields[this.iEmpIndex][0][B].ArrData&&this.arrLstCPFields[this.iEmpIndex][0][B].ArrData.length>0)){var _,G=0;if(this.arrLstCPFields[this.iEmpIndex][0][B].ArrData=this.arrLstCPFields[this.iEmpIndex][0][B].ArrData.TrimEnd(","),_=this.arrLstCPFields[this.iEmpIndex][0][B].ArrData.split(";"),this.arrLstCPFields[this.iEmpIndex][0][B].ArrData="",G=parseFloat(this.arrLstCPFields[this.iEmpIndex][0][B].dArrear),null!=_&&_.length>0)for(var H=0;H<_.length;H+=2)null!=new Date(_[H]).ToString("dd MMM yyyy")&&(o=_[H+1],parseFloat(o)<G?(this.arrLstCPFields[this.iEmpIndex][0][B].ArrData+=new Date(_[H]).ToString("dd MMM yyyy")+","+o+",",G-=parseFloat(o)):(this.arrLstCPFields[this.iEmpIndex][0][B].ArrData+=new Date(_[H]).ToString("dd MMM yyyy")+","+G+",",G=0))}for(var q=0;q<this.arrLstCPFields[this.iEmpIndex][2].length;q++)if(""!=r.e.String(this.arrLstCPFields[this.iEmpIndex][2][q].SNo)&&"PF"==this.arrLstCPFields[this.iEmpIndex][2][q].ComponentName&&this.arrLstCPFields[this.iEmpIndex][2][q].isArrCalculated&&parseFloat(this.arrLstCPFields[this.iEmpIndex][2][q].dArrear)>x-parseFloat(this.arrLstCPFields[this.iEmpIndex][2][q].dEarned)&&(this.arrLstCPFields[this.iEmpIndex][2][q].dArrear=(x-parseFloat(this.arrLstCPFields[this.iEmpIndex][2][q].dEarned)).ToString(s.a.SessionManager.sPayrollDecimals),null!=this.arrLstCPFields[this.iEmpIndex][2][q].ArrData&&this.arrLstCPFields[this.iEmpIndex][2][q].ArrData.length>0)){var U,Y=0;if(this.arrLstCPFields[this.iEmpIndex][2][q].ArrData=this.arrLstCPFields[this.iEmpIndex][2][q].ArrData.TrimEnd(","),U=this.arrLstCPFields[this.iEmpIndex][2][q].ArrData.split(";"),this.arrLstCPFields[this.iEmpIndex][2][q].ArrData="",Y=parseFloat(this.arrLstCPFields[this.iEmpIndex][2][q].dArrear),null!=U&&U.length>0)for(var X=0;X<U.length;X+=2)null!=new Date(U[X]).ToString("dd MMM yyyy")&&(o=U[X+1],parseFloat(o)<Y?(this.arrLstCPFields[this.iEmpIndex][2][q].ArrData+=new Date(U[X]).ToString("dd MMM yyyy")+","+o+",",Y-=parseFloat(o)):(this.arrLstCPFields[this.iEmpIndex][2][q].ArrData+=new Date(U[X]).ToString("dd MMM yyyy")+","+Y+",",Y=0))}}Logger.InfoLog("CommonMonthlyPayroll::Exiting ExecuteFormulas()")}catch(K){Logger.ErrorLog("CommonMonthlyPayroll::EXCEPTION ExecuteFormulas()\r\n"+K.Message+"\r\n"+K.stack)}}},{key:"RoundOffValue",value:function(e,t){var a=!1;if(e<0&&(a=!0,e=Math.abs(e)),t>0&&e>0){var r,o=!1;(r=e%t)>0&&(t/r<=2&&(o=!0),e-=r,o&&(e+=t))}return a?(-1*e).ToString(s.a.SessionManager.sPayrollDecimals).Replace(",",""):e.ToString(s.a.SessionManager.sPayrollDecimals).Replace(",","")}},{key:"CalculateWeeklyOffsFromDef",value:function(){var e=this,t=0;try{Logger.InfoLog("CommonMonthlyPayroll::Entering CalculateWeeklyOffsFromDef()"),null!=this.drcWOffDef&&this.drcWOffDef.length>0&&function(){for(var a,o=1,i=e.othMPField.DateOfRelieve<s.a.SessionManager.PayrollMonthEnd?e.othMPField.DateOfRelieve:s.a.SessionManager.PayrollMonthEnd,n=e.othMPField.DateOfJoining>s.a.SessionManager.PayrollMonthStart?e.othMPField.DateOfJoining:s.a.SessionManager.PayrollMonthStart;n<=i;){for(a=n.AddDays(6);n<=a&&n<=i;){if(r.e.IsEmpty(e.drcWOffDef[0]["Week"+o.toString()+"_W1"])||n.getDayName().toString().toLowerCase()!=e.drcWOffDef[0]["Week"+o.toString()+"_W1"].toString().toLowerCase()){if(!r.e.IsEmpty(e.drcWOffDef[0]["Week"+o.toString()+"_W2"])&&n.getDayName().toString().toLowerCase()==e.drcWOffDef[0]["Week"+o.toString()+"_W2"].toString().toLowerCase()){if(e.lstHolidays.Contains(n)){n=n.AddDays(1);continue}if(e.drcApprLeaves=e.dsAllEmpsData.Tables[9].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo&&t.FromDate<=n.ToString("dd MMM yyyy")&&t.ToDate>=n.ToString("dd MMM yyyy")&&"LatesProcessing"!=t.PostedFrom})),0==e.drcApprLeaves.length)if(null!=e.lstVacations&&e.lstVacations.length>0)for(var l=0;l<e.lstVacations.length;l++)e.lstVacations[l].IsEncashDays||e.lstWeekoff.Contains(n)||(e.oVacation=e.lstVacations[l],null!=e.oVacation&&e.oVacation.StartDate<=n&&e.oVacation.EndDate>=n?e.ExcludeWeeklyOff&&(t++,e.lstWeekoff.push(n)):(t++,e.lstWeekoff.push(n)));else t++,e.lstWeekoff.push(n);else if(e.drcStructure=e.dsAllEmpsData.Tables[1].filter((function(t){return 4==t.Type&&t.ComponentID==r.e.String(e.drcApprLeaves[0].ComponentID)&&t.GradeID==e.othMPField.GradeID})),e.drcStructure.length>0&&""!=r.e.String(e.drcStructure[0].IncludeRExclude).Trim())switch(e.drcStructure[0].IncludeRExclude.toString()){case"ExcludeBoth":case"ExcludeWeeklyOffs":case"IncludeHolidays":t++,e.lstWeekoff.push(n)}}}else{if(e.lstHolidays.Contains(n)){n=n.AddDays(1);continue}if(e.lstWeekoff.Contains(n)){n=n.AddDays(1);continue}if(e.drcApprLeaves=e.dsAllEmpsData.Tables[9].filter((function(t){return t.EmpSeqNo==e.sEmpSeqNo&&t.FromDate<=n.ToString("dd MMM yyyy")&&t.ToDate>=n.ToString("dd MMM yyyy")&&"LatesProcessing"!=t.PostedFrom})),0==e.drcApprLeaves.length)if(null!=e.lstVacations&&e.lstVacations.length>0)for(var d=0;d<e.lstVacations.length;d++)e.lstVacations[d].IsEncashDays||e.lstWeekoff.Contains(n)||(e.oVacation=e.lstVacations[d],null!=e.oVacation&&e.oVacation.StartDate<=n&&e.oVacation.EndDate>=n?e.ExcludeWeeklyOff&&(t++,e.lstWeekoff.push(n)):(t++,e.lstWeekoff.push(n)));else t++,e.lstWeekoff.push(n);else if(e.drcStructure=e.dsAllEmpsData.Tables[1].filter((function(t){return 4==t.Type&&t.ComponentID==r.e.String(e.drcApprLeaves[0].ComponentID)&&t.GradeID==e.othMPField.GradeID})),e.drcStructure.length>0&&""!=r.e.String(e.drcStructure[0].IncludeRExclude).Trim())switch(e.drcStructure[0].IncludeRExclude.toString()){case"ExcludeBoth":case"ExcludeWeeklyOffs":case"IncludeHolidays":t++,e.lstWeekoff.push(n)}}n=n.AddDays(1)}o++}}(),Logger.InfoLog("CommonMonthlyPayroll::Exiting CalculateWeeklyOffsFromDef()")}catch(a){Logger.ErrorLog("CommonMonthlyPayroll::EXCEPTION CalculateWeeklyOffsFromDef()\r\n"+a.Message+"\r\n"+a.stack)}return t}},{key:"GetVacationAvailability",value:function(e,t){Logger.InfoLog("CommonMonthlyPayroll::Entering GetVacationAvailability()");var a=0;this.othMPField.dVacDaysUptoLastMonth=0;var r=[];r.push(e.ToString("dd/MMM/yyyy")),r.push(this.sEmpSeqNo),r.push(1),r.push(s.a.SessionManager.UserID),r.push(s.a.SessionManager.LanguageID);var o=s.a.empService.ExecuteQuery_SP(r,"spPAY_GetRemainingVacationDays");if(null!=o&&o.Tables.length>0&&o.Tables[0].length>0){var i=o.Tables[0].filter((function(e){return e.LeaveType==t}));null!=i&&i.length>0&&(a=parseFloat(i[0].AvlblDays),this.othMPField.dVacDaysUptoLastMonth=parseFloat(i[0].VacDaysUptoLastMonth))}return Logger.InfoLog("CommonMonthlyPayroll::Exiting GetVacationAvailability()"),a.toString()}},{key:"GetLeavesTaken",value:function(e,t,a,o){Logger.InfoLog("CommonMonthlyPayroll::Entering GetLeavesTaken()"),o.dTaken=o.dAvail=0;var i=[];i.push(e.ToString("dd/MMM/yyyy")),i.push(t.ToString("dd/MMM/yyyy")),i.push(this.sEmpSeqNo),i.push(a),i.push("Both"),i.push(s.a.SessionManager.UserID),i.push(s.a.SessionManager.LanguageID);var n=s.a.empService.ExecuteQuery_SP(i,"spPAY_ExtGetAvlblNoofDays");null!=n&&n.Tables.length>0&&n.Tables[0].length>0&&(r.e.IsEmpty(n.Tables[0][0].LeavesTaken)||(o.dTaken=parseFloat(n.Tables[0][0].LeavesTaken)),r.e.IsEmpty(n.Tables[0][0].AvailableLeaves)||(o.dAvail=parseFloat(n.Tables[0][0].AvailableLeaves)),e.ToString("dd/MMM/yyyy")==this.PayrollMonthStart.ToString("dd/MMM/yyyy")&&t.ToString("dd/MMM/yyyy")==this.PayrollMonthEnd.ToString("dd/MMM/yyyy")&&(0==this.dWklyoff&&0==this.dHdays&&(this.dWklyoff=parseFloat(n.Tables[0][0].Weeklyoff),this.dHdays=parseFloat(n.Tables[0][0].Holidays)),null!=n.Tables[0][0].MWeeklyoff&&null!=n.Tables[0][0].MWeeklyoff&&""!=n.Tables[0][0].MWeeklyoff.toString()&&(this.dblMWeekOffs=this.dblMWeekOffs+parseFloat(n.Tables[0][0].MWeeklyoff)),null!=n.Tables[0][0].MHolidays&&null!=n.Tables[0][0].MHolidays&&""!=n.Tables[0][0].MHolidays.toString()&&(this.dblMHolidays=this.dblMHolidays+parseFloat(n.Tables[0][0].MHolidays)))),Logger.InfoLog("CommonMonthlyPayroll::Exiting GetLeavesTaken()")}}]),e}()},Saj9:function(e,t,a){"use strict";a.r(t),a.d(t,"SetPayrollDateViewModel",(function(){return n}));var s=a("Do2H"),r=a("Lp6j"),o=a("ScVY"),i=a("JIg3"),n=function(e){_inherits(a,e);var t=_createSuper(a);function a(){var e;return _classCallCheck(this,a),(e=t.call(this)).DialogResult=!1,e.MsgVisibility=!1,e.MsgInVisibility=!1,e.PayrollMonth="",e.PayrollMonthStart="",e.PayrollMonthEnd="",e.PayDate=new i.a(0),e.PayDate.CustomFormat="MMM/yyyy",e.PayDate.Date=s.a.SessionManager.PayrollMonth,e.PayDate.Label="Date",e.MsgInVisibility=!0,e.MsgVisibility=!1,e}return _createClass(a,[{key:"OnPreviewKeyDown",value:function(e){}},{key:"OnSave",value:function(e){"OK"==e.toString()||"Cancel"==e.toString()?s.a.page.HideDialog():"Submit"==e.toString()&&(r.e.SetPayrollMonth(this.PayDate.Date,s.a.SessionManager),s.a.SessionManager.ModsTemp.split("~").Contains("13"),this.PayrollMonth=": "+s.a.SessionManager.PayrollMonth.ToString("MMMM, yyyy"),this.PayrollMonthStart=": "+s.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy"),this.PayrollMonthEnd=": "+s.a.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy"),this.MsgInVisibility=!1,this.MsgVisibility=!0,this.DialogResult=!0)}},{key:"OnMessageCallBack",value:function(){}}]),a}(o.b)},"V+gx":function(e,t,a){"use strict";a.r(t),a.d(t,"SetPayrollDateComponent",(function(){return u}));var s=a("3Pt+"),r=a("fXoL"),o=a("ofXK"),i=a("q8k3"),n=a("sYmb");function l(e,t){if(1&e&&(r.Zb(0,"div",3),r.Wc(1,"\n        "),r.Zb(2,"div",4),r.Wc(3,"\n            "),r.Vb(4,5),r.Wc(5,"\n        "),r.Yb(),r.Wc(6,"\n    "),r.Yb()),2&e){var a=r.lc();r.Db(4),r.tc("obj",a.obj.PayDate)("group",a.form)}}function d(e,t){if(1&e){var a=r.ac();r.Zb(0,"div",6),r.Wc(1,"\n        "),r.Zb(2,"div"),r.Wc(3,"\n            "),r.Zb(4,"button",7),r.hc("click",(function(){return r.Ic(a),r.lc().obj.OnSave("Submit")})),r.Wc(5),r.mc(6,"translate"),r.Yb(),r.Wc(7,"\n            "),r.Zb(8,"button",8),r.hc("click",(function(){return r.Ic(a),r.lc().obj.OnSave("Cancel")})),r.Ub(9,"i",9),r.Wc(10),r.mc(11,"translate"),r.Yb(),r.Wc(12,"\n        "),r.Yb(),r.Wc(13,"\n    "),r.Yb()}2&e&&(r.Db(5),r.Xc(r.nc(6,2,"Com_OK")),r.Db(5),r.Xc(r.nc(11,4,"Cancel")))}function c(e,t){if(1&e&&(r.Zb(0,"div",3),r.Wc(1,"\n\n        "),r.Zb(2,"div",4),r.Wc(3,"\n            "),r.Zb(4,"table"),r.Wc(5,"\n                "),r.Zb(6,"tr"),r.Wc(7,"\n                    "),r.Zb(8,"td",10),r.Wc(9,"\n                        "),r.Zb(10,"div",11),r.Wc(11),r.mc(12,"translate"),r.Yb(),r.Wc(13,"\n                    "),r.Yb(),r.Wc(14,"\n                    "),r.Zb(15,"td",10),r.Wc(16,"\n                        "),r.Zb(17,"div",12),r.Wc(18),r.Yb(),r.Wc(19,"\n                    "),r.Yb(),r.Wc(20,"\n                "),r.Yb(),r.Wc(21,"\n                "),r.Zb(22,"tr"),r.Wc(23,"\n                    "),r.Zb(24,"td",10),r.Wc(25,"\n                        "),r.Zb(26,"div",11),r.Wc(27),r.mc(28,"translate"),r.Yb(),r.Wc(29,"\n                    "),r.Yb(),r.Wc(30,"\n                    "),r.Zb(31,"td",10),r.Wc(32,"\n                        "),r.Zb(33,"div",12),r.Wc(34),r.Yb(),r.Wc(35,"\n                    "),r.Yb(),r.Wc(36,"\n                "),r.Yb(),r.Wc(37,"\n                "),r.Zb(38,"tr"),r.Wc(39,"\n                    "),r.Zb(40,"td",10),r.Wc(41,"\n                        "),r.Zb(42,"div",11),r.Wc(43),r.mc(44,"translate"),r.Yb(),r.Wc(45,"\n                    "),r.Yb(),r.Wc(46,"\n                    "),r.Zb(47,"td",10),r.Wc(48,"\n                        "),r.Zb(49,"div",12),r.Wc(50),r.Yb(),r.Wc(51,"\n                    "),r.Yb(),r.Wc(52,"\n                "),r.Yb(),r.Wc(53,"\n            "),r.Yb(),r.Wc(54,"\n        "),r.Yb(),r.Wc(55,"\n    "),r.Yb()),2&e){var a=r.lc();r.Db(11),r.Yc(" ",r.nc(12,6,"PayrollMonth")," "),r.Db(7),r.Yc(" ",a.obj.PayrollMonth," "),r.Db(9),r.Yc(" ",r.nc(28,8,"PayrollStartDate")," "),r.Db(7),r.Yc(" ",a.obj.PayrollMonthStart," "),r.Db(9),r.Yc(" ",r.nc(44,10,"PayrollEndDate")," "),r.Db(7),r.Yc(" ",a.obj.PayrollMonthEnd," ")}}function h(e,t){if(1&e){var a=r.ac();r.Zb(0,"div",6),r.Wc(1,"\n        "),r.Zb(2,"div"),r.Wc(3,"\n            "),r.Zb(4,"button",7),r.hc("click",(function(){return r.Ic(a),r.lc().obj.OnSave("OK")})),r.Wc(5),r.mc(6,"translate"),r.Yb(),r.Wc(7,"\n        "),r.Yb(),r.Wc(8,"\n    "),r.Yb()}2&e&&(r.Db(5),r.Xc(r.nc(6,1,"Com_OK")))}var u=function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"ngOnInit",value:function(){this.form=new s.j({})}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=r.Nb({type:e,selectors:[["app-set-payroll-date"]],decls:10,vars:5,consts:[[1,"master-screen",3,"formGroup"],["class","dialogSubBody",4,"ngIf"],["class","Pactdailogfooter",4,"ngIf"],[1,"dialogSubBody"],[1,"form-group","col-xl-12","col-md-12","col-sm-12","col-xs-12","PACTControl"],["FieldDirective","",3,"obj","group"],[1,"Pactdailogfooter"],[1,"primary-btn-wicon",3,"click"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-rectangle-xmark"],[2,"text-align","left","width","50%"],[1,"qvlabel"],[1,"qvtext"]],template:function(e,t){1&e&&(r.Zb(0,"div",0),r.Wc(1,"\n    "),r.Uc(2,l,7,2,"div",1),r.Wc(3,"\n    "),r.Uc(4,d,14,6,"div",2),r.Wc(5,"\n    "),r.Uc(6,c,56,12,"div",1),r.Wc(7,"\n    "),r.Uc(8,h,9,3,"div",2),r.Wc(9,"\n"),r.Yb()),2&e&&(r.tc("formGroup",t.form),r.Db(2),r.tc("ngIf",t.obj.MsgInVisibility),r.Db(2),r.tc("ngIf",t.obj.MsgInVisibility),r.Db(2),r.tc("ngIf",t.obj.MsgVisibility),r.Db(2),r.tc("ngIf",t.obj.MsgVisibility))},directives:[s.t,s.k,o.t,i.a],pipes:[n.d],encapsulation:2}),e}()},"dc+d":function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var s=a("3Pt+"),r=a("fXoL"),o=a("ofXK"),i=a("sYmb");function n(e,t){if(1&e){var a=r.ac();r.Xb(0,9),r.Wc(1,"\n            "),r.Zb(2,"div"),r.Wc(3,"\n              "),r.Zb(4,"input",10),r.hc("ngModelChange",(function(e){return r.Ic(a),t.$implicit.IsChecked=e}))("change",(function(e){r.Ic(a);var s=t.$implicit;return r.lc().OnCheckValue(e,s)})),r.Yb(),r.Wc(5,"\n              "),r.Zb(6,"label",11),r.hc("click",(function(){r.Ic(a);var e=t.$implicit;return r.lc().OnLblClick(e)})),r.Wc(7),r.Yb(),r.Wc(8,"\n            "),r.Yb(),r.Wc(9,"\n          "),r.Wb()}if(2&e){var s=t.$implicit,o=r.lc();r.tc("group",o.obj.form),r.Db(4),r.tc("ngModel",s.IsChecked)("disabled",!s.Enable),r.Db(3),r.Xc(s.Name)}}var l=function(){var e=function(){function e(){_classCallCheck(this,e),this.form=new s.j({})}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"OnCheckValue",value:function(e,t){e.target.checked=t.IsChecked}},{key:"OnLblClick",value:function(e){e.Enable&&(e.IsChecked=!e.IsChecked)}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=r.Nb({type:e,selectors:[["app-arrears"]],inputs:{obj:"obj"},decls:34,vars:16,consts:[[2,"padding-bottom","4px","width","200px"],[1,"PACTHeaderFields","dialogSubBody"],[1,"form-group","col-xl-12","col-md-12","col-sm-12","col-xs-12","PACTControl"],[1,"input_cntrl_label"],[1,"form-group","PACTControl","pnl","maxwidth",2,"overflow","auto"],[3,"group",4,"ngFor","ngForOf"],[1,"Pactdailogfooter"],[1,"primary-btn-wicon",3,"click"],[1,"secondary-btn-wicon",3,"click"],[3,"group"],["type","checkbox",3,"ngModel","disabled","ngModelChange","change"],[3,"click"]],template:function(e,t){1&e&&(r.Zb(0,"div",0),r.Wc(1,"\n  "),r.Zb(2,"div",1),r.Wc(3,"\n\n\n    "),r.Wc(4,"\n    "),r.Zb(5,"div",2),r.Wc(6,"\n      "),r.Zb(7,"div"),r.Wc(8,"\n        "),r.Zb(9,"label",3),r.Wc(10,"Payroll Months "),r.Yb(),r.Wc(11,"\n        "),r.Zb(12,"div",4),r.Wc(13,"\n          "),r.Uc(14,n,10,4,"ng-container",5),r.Wc(15,"\n        "),r.Yb(),r.Wc(16,"\n      "),r.Yb(),r.Wc(17,"\n    "),r.Yb(),r.Wc(18,"\n  "),r.Yb(),r.Wc(19,"\n  "),r.Zb(20,"div",6),r.Wc(21,"\n    "),r.Zb(22,"div"),r.Wc(23,"\n      "),r.Zb(24,"button",7),r.hc("click",(function(){return t.obj.Button_Click("OK")})),r.Wc(25),r.mc(26,"translate"),r.Yb(),r.Wc(27,"\n      "),r.Zb(28,"button",8),r.hc("click",(function(){return t.obj.Button_Click("Cancel")})),r.Wc(29),r.mc(30,"translate"),r.Yb(),r.Wc(31,"\n    "),r.Yb(),r.Wc(32,"\n  "),r.Yb(),r.Wc(33,"\n"),r.Yb()),2&e&&(r.Db(7),r.Kb("c-flex",t.obj.LblWidth),r.Db(2),r.Sc("width",t.obj.LblWidth,"px"),r.Kb("quicklink",t.obj.LblClick),r.Eb("for",t.obj.DBColumnName),r.Db(3),r.Sc("height",t.obj.Height,"px"),r.Db(2),r.tc("ngForOf",t.obj.ChklstPayrollMonths),r.Db(11),r.Xc(r.nc(26,12,"Ok")),r.Db(4),r.Xc(r.nc(30,14,"Close")))},directives:[o.s,s.a,s.s,s.v],pipes:[i.d],encapsulation:2}),e}()}}]);
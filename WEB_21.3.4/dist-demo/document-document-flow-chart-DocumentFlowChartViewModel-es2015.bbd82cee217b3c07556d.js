(window.webpackJsonp=window.webpackJsonp||[]).push([[151],{d36O:function(e,t,o){"use strict";o.r(t),o.d(t,"DocumentFlowChartViewModel",(function(){return u}));var s=o("Do2H"),i=o("Lp6j"),h=o("ScVY"),a=o("vTM8"),r=o("0/4Q"),n=o("PDNK"),l=o("EQd/"),c=o("CUWK");class u extends h.b{constructor(e,t,o=0,h=!0){super(),this.dtDocs=null,this.dtDocsDetail=null,this.RootNodes=[],this.lstDocNodes=new a.a,this.DocsFlowData=[],this.DocsArrowData=[],this.DocsArrowDataTemp=[],this.lstRibbonDocs=new a.c,this._DocNumber="",this.VoucherNoObj=new l.d,this.IsInv=!0,this.IsDialog=!1,this.Width=null,this.Height=null,this.MaxNodeHeight=0,this.arrLevelMax=[],this.ActualNodeHeight=80,this.NodePaddingTop=30,this.NodePaddingLeft=60,this.ActualNodeWidth=140,this.IsLinkFlowCall=!1,this.HideValue=!1,this.HideQty=!1,this.HideDocDate=!1,this.Width="800",this.Height="600",this.VoucherNoObj.SetFocus=!0,this.VoucherNoObj.Label=s.a.GetResource("DFCVoucherNo"),this.ShowData=new n.b,this.ShowData.GroupName="ShowData",this.ShowData.Items.push(new n.a("Summary",0,"ShowData")),this.ShowData.Items.push(new n.a("Detail",1,"ShowData")),this.ShowData.Items[0].Label=s.a.GetResource("DFCSummary"),this.ShowData.Items[0].Group=this.ShowData,this.ShowData.Items[1].Group=this.ShowData,this.ShowData.Items[1].Label=s.a.GetResource("DFCDetail"),s.a.SessionManager.PersonalSettings.ContainsKey("DocumentFlowShowData")&&"1"==s.a.SessionManager.PersonalSettings.DocumentFlowShowData?this.ShowData.Items[1].IsChecked=!0:this.ShowData.Items[0].IsChecked=!0,this.ShowData.Items[0].CheckedChangedCommand.Subscribe(this,"OnNameCheckedChanged"),this.ShowData.Items[1].CheckedChangedCommand.Subscribe(this,"OnNameCheckedChanged"),this.HideValue=s.a.SessionManager.IsActionAssigned(131,"Hide Value"),this.HideQty=s.a.SessionManager.IsActionAssigned(131,"Hide Qty"),this.HideDocDate=s.a.SessionManager.IsActionAssigned(131,"Hide DocDate"),this.Title="Link Map",this.IsDialog=e,this.VoucherNo=t,this.IsInv=h,this.DocumentType=new r.e(0),this.DocumentType.Label=s.a.GetResource("Document Type"),this.DocPrefix=new r.e(0),this.DocPrefix.Label=s.a.GetResource("DocPrefix"),this.DocumentType.SelectionChangedCommand.Subscribe(this,"OnDocumentChange"),this.DocPrefix.SelectionChangedCommand.Subscribe(this,"OnDocPrefix");let c=s.a.report.GetReportData(3,parseInt(s.a.SessionManager.UserID),null);this.DocumentType.Items.push(r.d.ComboBoxItems_2("","0")),null!=c&&(c.Tables[0].forEach(e=>{this.DocumentType.Items.push(r.d.ComboBoxItems_3(e[c.Columns[0][1]].toString(),e[c.Columns[0][0]].toString(),e.DocumentAbbr.toString()))}),o>0&&(this.DocumentType.SelectedValue=o.toString())),i.e.IsEmpty(t)||this.ConstructTree()}get DocNumber(){return this._DocNumber}set DocNumber(e){e!=this._DocNumber&&(this._DocNumber=e,this.UpdateVoucherNo())}get VoucherNo(){return this.VoucherNoObj.Text}set VoucherNo(e){this.VoucherNoObj.Text=e}get NodeHeight(){return this.ActualNodeHeight+this.NodePaddingTop}get NodeWidth(){return this.ActualNodeWidth+this.NodePaddingLeft}OnNameCheckedChanged(e){i.e.SetPersonalize("DocumentFlowShowData",this.ShowData.Items[1].IsChecked?"1":"0"),this.OnButtonClick("Submit")}OnDocumentChange(e){!i.e.IsEmpty(this.DocumentType.SelectedValue)&&parseInt(this.DocumentType.SelectedValue)>0&&(this.DocPrefix.Items.Clear(),s.a.common.GetDataSet("DOC048",this.DocumentType.SelectedValue).Tables[0].forEach(e=>{this.DocPrefix.Items.push(r.d.ComboBoxItems_3(e.CodePrefix.toString(),e.CodePrefix.toString(),e.CurrentCodeNumber.toString()))}),this.DocNumber=""),this.UpdateVoucherNo()}OnDocPrefix(e){this.DocNumber=null==this.DocPrefix.SelectedItem||i.e.IsEmpty(this.DocPrefix.SelectedItem.Parent)?"":this.DocPrefix.SelectedItem.Parent,this.UpdateVoucherNo()}UpdateVoucherNo(){let e="";!i.e.IsEmpty(this.DocumentType.SelectedValue)&&parseInt(this.DocumentType.SelectedValue)>0&&(e=this.DocumentType.SelectedItem.Parent+"-",i.e.IsEmpty(this.DocPrefix.SelectedValue)||(e+=this.DocPrefix.SelectedValue),i.e.IsEmpty(this.DocNumber)||(e+=this.DocNumber)),this.VoucherNo=e}OnButtonClick(e){if(this.DisplayMessage="","Submit"==e){if(i.e.IsEmpty(this.VoucherNo))return void(this.DisplayMessage="Enter Voucher No");this.ActualNodeWidth=140,this.ConstructTree()}else if("LinkFlow"==e){if(null==this.DocumentType.SelectedValue)return void(this.DisplayMessage="Select Document Type");this.ConstructTree(!0)}else"Close"==e&&s.a.page.HideDialog()}OnDocumentClick(e){if(this.DisplayMessage="",!i.e.IsEmpty(e)){s.a.page.ShowLoading=!0;let t=s.a.report.GetDocumentDetailsByVoucherNo(e);if(i.e.Int(t.obj)>0){let e;e=t.Tables[0].length>0?t.Tables[0][0]:t.Tables[1][0],c.RibbonExtViewModel.LoadDocument(e),this.IsDialog&&s.a.page.HideDialog()}else this.DisplayMessage="Document not found";s.a.page.ShowLoading=!1}}OnDocumentDefClick(e){}ConstructTree(e=!1){let t;if(this.DocsArrowData.Clear(),this.DocsArrowDataTemp.Clear(),this.arrLevelMax.Clear(),this.lstDocNodes.Clear(),this.RootNodes.Clear(),this.lstRibbonDocs.Clear(),this.IsLinkFlowCall=e,e)s.a.SessionManager.MenuTabs.forEach(e=>{e.Groups.forEach(e=>{for(let t=0;t<e.Items.length;t++){let o=e.Items[t];o.FeatureID>4e4&&o.FeatureID<5e4&&!this.lstRibbonDocs.keys.Contains(o.FeatureID)&&this.lstRibbonDocs.push(o.FeatureID,o)}})}),this.TempDVNode=new Array,t=s.a.report.GetDocsLinkTree(this.DocumentType.SelectedValue,this.ShowData.Items[0].IsChecked?1:0,this.IsInv);else{let e;this.TempVNode=[],e=this.VoucherNo.startsWith("LINEID:")?this.VoucherNo.split("~"):[this.VoucherNo],t=s.a.report.GetDocsLinkTree(e[0],this.ShowData.Items[0].IsChecked?1:0,this.IsInv),e.length>1&&(this.VoucherNo=e[1]),t.Tables.length>2&&t.Columns[2].Contains("BWDocNo")&&t.Tables[2].forEach(e=>{let o={CostCenterID:0};o.VoucherNo=e.BWDocNo,o.ParentVoucherNo=e.ParentVoucherNo,o.DocDate=e.DocDate,t.Tables[0].push(o)})}if(0==t.Tables.length)return;this.dtDocs=t.Tables[0],this.dtDocsDetail=t.Tables[1];let o=t.Tables[0].filter(e=>null==e.ParentVoucherNo||"-1"==e.ParentVoucherNo||""==e.ParentVoucherNo);var i;this.arrLevelMax.push(0),t.Columns[0].Contains("DocDate"),o.forEach(e=>{let t=this.GetNode(e,0);t&&(this.RootNodes.push(t),this.AddChildren(t))}),this.lstDocNodes.length>0&&(e?(i=this.lstDocNodes.values.find(e=>e.CostCenterID==parseInt(this.DocumentType.SelectedValue)))&&(i.ForeColor="Red"):(i=this.lstDocNodes.values.find(e=>e.DocNo.toString().toLowerCase()==this.VoucherNo.toLowerCase()))&&(i.ForeColor="Red")),this.arrLevelMax[0]=this.RootNodes.length,this.MaxNodeHeight=Math.max(...this.arrLevelMax)*this.NodeHeight,this.RootNodes.forEach(e=>{e.Top=this.MaxNodeHeight/(this.arrLevelMax[0]+1)-this.NodeHeight;let t=this.MaxNodeHeight/this.arrLevelMax[e.Level];e.Top=t*(e.LevelIndex+1)-((t-this.ActualNodeHeight)/2+this.ActualNodeHeight),e.Margin="0,"+e.Top.toString()+",0,0",this.AssignMargin(e)});let h=[];e?this.TempDVNode.forEach(e=>{h.push(e)}):this.TempVNode.forEach(e=>{h.push(e)}),this.DocsFlowData=h;let a=[];a.AddRange(this.DocsArrowData),this.DocsArrowDataTemp.push(a)}GetNode(e,t){if(this.lstDocNodes.ContainsKey(e.VoucherNo.toString()))return null;let o=new d;if(o.DocNo=e.VoucherNo.toString(),o.CostCenterID=parseInt(e.CostCenterID),this.IsLinkFlowCall)o=new N,o.DocNo=e.VoucherNo.toString(),o.CostCenterID=parseInt(e.CostCenterID),this.lstRibbonDocs.keys.Contains(o.CostCenterID)?o.SmallImage=this.lstRibbonDocs[o.CostCenterID].SmallImage:(o.BtnBorderColor="Gray",o.IsEnable=!1);else{o=new d,o.DocNo=e.VoucherNo.toString(),o.CostCenterID=parseInt(e.CostCenterID),this.HideDocDate||null==e.DocDate||(o.DocDate=new Date(e.DocDate).ToString(s.a.SessionManager.Preferences["Date Format"]));let t=this.dtDocsDetail.filter(e=>e.VoucherNo==o.DocNo);t.length>0&&(this.HideQty||null==t[0].Qty||(o.Qty=parseFloat(t[0].Qty).ToString("N"+s.a.SessionManager.Preferences.DecimalsinQty)),this.HideValue||null==t[0].Value||(o.Value=parseFloat(t[0].Value).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount)))}return this.lstDocNodes.push(e.VoucherNo.toString(),o),this.ActualNodeWidth/e.VoucherNo.toString().length<7&&(this.ActualNodeWidth=3+7*e.VoucherNo.toString().length),o.Width=this.ActualNodeWidth,o.Height=this.ActualNodeHeight,o.Level=t,this.arrLevelMax.length<=o.Level&&this.arrLevelMax.push(0),o.LevelIndex=this.arrLevelMax[o.Level],this.arrLevelMax[o.Level]++,this.IsLinkFlowCall?this.TempDVNode.push(o):this.TempVNode.push(o),o}AddChildren(e){this.dtDocs.filter(t=>t.ParentVoucherNo==e.DocNo).forEach(t=>{let o=t.VoucherNo.toString();if(this.lstDocNodes.ContainsKey(o))e.Children.find(e=>e.DocNo==o)||e.Children.push(this.lstDocNodes[o]);else{let o=this.GetNode(t,e.Level+1);null!=o&&(e.Children.push(o),this.AddChildren(o))}})}AssignMargin(e){for(let t=0;t<e.Children.length;t++){let o=e.Children[t];if(!o.IsRead){o.IsRead=!0,o.Left=o.Level*this.NodeWidth;let e=this.MaxNodeHeight/this.arrLevelMax[o.Level];o.Top=e*(o.LevelIndex+1)-((e-this.ActualNodeHeight)/2+this.ActualNodeHeight),o.Margin=o.Left+","+o.Top.toString()+",0,0",this.AssignMargin(o)}if(!this.DocsArrowData.find(t=>t.FromDocNo==e.DocNo&&t.ToDocNo==o.DocNo)){let t=new m;t.FromDocNo=e.DocNo,t.ToDocNo=o.DocNo,t.X1=e.Left,e.Left<o.Left&&(t.X1+=this.ActualNodeWidth),t.Y1=e.Top+this.ActualNodeHeight/2,t.X2=o.Left,o.Left<e.Left&&(t.X2+=this.ActualNodeWidth),t.Y2=o.Top+this.ActualNodeHeight/2,this.IsLinkFlowCall?null!=this.DocumentType.SelectedValue&&e.CostCenterID==parseInt(this.DocumentType.SelectedValue)&&(t.Stroke="Red"):i.e.LowerCase(e.DocNo)!=i.e.LowerCase(this.VoucherNo)&&i.e.LowerCase(o.DocNo)!=i.e.LowerCase(this.VoucherNo)||(t.Stroke="Red"),this.DocsArrowData.push(t)}}}}class D extends h.b{constructor(){super(...arguments),this.CostCenterID=0,this.Level=0,this.Order=0,this.Parent=null,this.Children=[],this.Top=0,this.Left=0,this.LevelIndex=0,this.IsRead=!1,this.Margin="0px 0px 0px 0px",this.ForeColor="Black",this.Width=0,this.Height=0}}class d extends D{get DocDateLbl(){return i.e.IsEmpty(this.DocDate)?"":"DocDate :"}get QtyLbl(){return i.e.IsEmpty(this.Qty)?"":"Qty :"}get ValueLbl(){return i.e.IsEmpty(this.Value)?"":"Value :"}get ToolTip(){return""!=this.QtyLbl?"Doc No: "+this.DocNo+"\r\nQty: "+this.Qty+"\r\nValue: "+this.Value:"Doc No: "+this.DocNo}}class N extends D{constructor(){super(),this.IsEnable=!1,this.IsEnable=!0,this.BtnBorderColor="Orange"}}class m{constructor(){this.X1=0,this.X2=0,this.Y1=0,this.Y2=0,this.Stroke="#000"}}}}]);
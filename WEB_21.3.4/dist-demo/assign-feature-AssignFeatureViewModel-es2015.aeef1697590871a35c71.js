(window.webpackJsonp=window.webpackJsonp||[]).push([[109],{"2Dtv":function(e,s,t){"use strict";t.r(s),t.d(s,"AssignFeatureViewModel",(function(){return g}));var i=t("Do2H"),h=t("Lp6j"),a=t("JIg3"),l=t("0/4Q"),n=t("ScVY"),o=t("EQd/"),r=t("DKUf"),m=t("CQvG"),I=t("m+Ff"),d=t("F+4J");class g extends n.b{constructor(){super(),this.LabelVisibility=!1,this.DetailButtonVisibility=!0,this.TeamVisible=!0,this.AssignDate=new a.a(0),this.RolesItemsObj=new l.b,this.UsersItemsObj=new l.b,this.GroupsItemsObj=new l.b,this.TypeOfAssigning=new l.e(0),this.Teams=new l.e(0),this.AssignUser=new l.e(0),this.InviteComments=new o.c(0),this.SelectedNode=new l.b,this.objTeam=new d.a,this.dtUsers=[],this._CCNodeID=0,this._CCID=0,this._ActivityID=0,this.Ret=0,this.userexists=!1,this.AssignXML="",this.Roles="",this.Users="",this.Grps=""}get RolesItems(){return this.RolesItemsObj}get UsersItems(){return this.UsersItemsObj}get GroupsItems(){return this.GroupsItemsObj}AssignFeatureViewModel_1(e,s,t){this._CCNodeID=s,this.SelectedNode.Visible=!1,this._CCID=t,this.Parent=e,this.Parent instanceof I.RCalenderViewModel||this.Parent instanceof r.a?(this.InviteComments.Visible=!0,this.InviteComments.Label="Comments"):this.InviteComments.Visible=!1,this.onLoadScreen(e)}AssignFeatureViewModel_2(e,s,t){this.SelectedNode.Items=s,this.SelectedNode.Visible=!0,this._CCID=t,this.Parent instanceof I.RCalenderViewModel?(this.InviteComments.Visible=!0,this.InviteComments.Label="Comments"):this.InviteComments.Visible=!1,this.Parent=e,this.onLoadScreen(e)}onLoadScreen(e){this.Title=i.a.GetResource("CRMTeam_Assign"),this.TypeOfAssigning.SelectionChangedCommand.Subscribe(this,"OnTypeChange"),this.Teams.SelectionChangedCommand.Subscribe(this,"OnChange"),this.RolesItemsObj.CheckedChangedCommand.Subscribe(this,"OnCheckedChanged"),this.UsersItemsObj.CheckedChangedCommand.Subscribe(this,"OnCheckedChanged"),this.GroupsItemsObj.CheckedChangedCommand.Subscribe(this,"OnCheckedChanged"),this.TypeOfAssigning.Label="Type",this.OnLoad(),this.Teams.Label=i.a.GetResource("CRMTeam_Title"),this.AssignDate.Label=i.a.GetResource("CRMTeam_AssignDate"),this.AssignUser.Label=i.a.GetResource("CRMTeam_AssignTo"),this.AssignDate.Text=Date.Today().ToString(i.a.SessionManager.Preferences["Date Format"].toString()),this.RolesItems.Visible=!1,this.UsersItems.Visible=!1,this.GroupsItems.Visible=!1;try{if(this._CCNodeID>0&&(this.dset=this.objTeam.GetAssignedDetails(this._CCID,this._CCNodeID,0),null!=this.dset&&this.dset.Tables.length>0)){if(this.dset.Tables[0].length>0){this.TypeOfAssigning.Items.push(l.d.ComboBoxItems_2("Team","1"));for(let e=0;e<this.dset.Tables[0].length;e++)this.Teams.Items.push(l.d.ComboBoxItems_2(this.dset.Tables[0][e].TeamName.toString(),this.dset.Tables[0][e].TeamID.toString()))}this.dset.Tables.length>1&&(this.dtUsers=this.dset.Tables[1]),this.dset.Tables.length>3&&this.dset.Columns[3].Contains("Company")&&this.dset.Tables[3].length>0&&(this.CompanyName=h.e.String(this.dset.Tables[3][0][this.dset.Columns[3][0]])),this.LabelVisibility=!1;let s=0;if(this.dset.Tables.length>4&&this.dset.Columns[4].Contains("UserName")&&this.dset.Tables[4].length>0&&(s=this.dset.Tables[4].filter(e=>e.UserName!=i.a.SessionManager.UserName).length),!(e instanceof m.b)&&this.dset.Tables.length>2&&this.dset.Columns[2].Contains("CCID")&&this.dset.Tables[2].length>0){let e=this.dset.Tables[2].filter(e=>e.UserID>1&&0==e.TeamNodeID);if(e.length>0)for(let t=0;t<e.length;t++)for(let i=0;i<this.UsersItems.Items.length;i++)if(this.UsersItems.Items[i].Value==e[t].UserID.toString()){0==s&&(this.UsersItems.Items[i].Enable=!1),this.UsersItems.Items[i].IsChecked=!0,this.userexists||(this.userexists=!0);break}if(e=this.dset.Tables[2].filter(e=>1==e.IsGroup),e.length>0)for(let s=0;s<e.length;s++)for(let t=0;t<this.GroupsItems.Items.length;t++)if(this.GroupsItems.Items[t].Value==e[s].TeamNodeID.toString()){this.GroupsItems.Items[t].IsChecked=!0,this.userexists||(this.userexists=!0);break}if(e=this.dset.Tables[2].filter(e=>1==e.IsRole),e.length>0)for(let s=0;s<e.length;s++)for(let t=0;t<this.RolesItems.Items.length;t++)if(this.RolesItems.Items[t].Value==e[s].TeamNodeID.toString()){this.RolesItems.Items[t].IsChecked=!0,this.userexists||(this.userexists=!0);break}e=this.dset.Tables[2].filter(e=>e.TeamNodeID>1&&1==e.IsTeam),e.length>0&&(this.Teams.SelectedValue=e[0].TeamNodeID.toString()),e=this.dset.Tables[2].filter(e=>e.TeamNodeID>1&&e.UserID>0),e.length>0&&(this.Teams.SelectedValue=e[0].TeamNodeID.toString(),this.AssignUser.SelectedValue=e[0].UserID.toString())}}}catch(s){throw Logger.ErrorLog("AssignFeatureViewModel::error ",s),s}}OnCheckedChanged(e){let s=e.item;if(s=e.item,"0"==s.Value){if(this.RolesItems.Items.Contains(s))for(let e=0;e<this.RolesItems.Items.length;e++)this.RolesItems.Items[e].IsChecked=s.IsChecked;if(this.UsersItems.Items.Contains(s))for(let e=0;e<this.UsersItems.Items.length;e++)this.UsersItems.Items[e].IsChecked=s.IsChecked;if(this.GroupsItems.Items.Contains(s))for(let e=0;e<this.GroupsItems.Items.length;e++)this.GroupsItems.Items[e].IsChecked=s.IsChecked}else s.IsChecked||(this.RolesItems.Items.Contains(s)&&(this.RolesItems[0].IsChecked=!1),this.UsersItems.Items.Contains(s)&&(this.UsersItems[0].IsChecked=!1),this.GroupsItems.Items.Contains(s)&&(this.GroupsItems[0].IsChecked=!1))}OnLoad(){let e=i.a.common.GetWorkFlowScreenDetails(!0);if(null!=e){if(e.Tables.length>1){e.Tables[1].length>0&&this.TypeOfAssigning.Items.push(l.d.ComboBoxItems_2("Users","2")),this.UsersItems.Items.push(l.c.CheckedListBoxItem_3("All","0"));for(let s=0;s<e.Tables[1].length;s++)this.UsersItems.Items.push(l.c.CheckedListBoxItem_3(e.Tables[1][s].UserName.toString(),e.Tables[1][s].UserID.toString()))}if(e.Tables.length>0){e.Tables[0].length>0&&this.TypeOfAssigning.Items.push(l.d.ComboBoxItems_2("Roles","3")),this.RolesItems.Items.push(l.c.CheckedListBoxItem_3("All","0"));for(let s=0;s<e.Tables[0].length;s++)this.RolesItems.Items.push(l.c.CheckedListBoxItem_3(e.Tables[0][s].Name.toString(),e.Tables[0][s].RoleID.toString()))}if(e.Tables.length>2){e.Tables[2].length>0&&this.TypeOfAssigning.Items.push(l.d.ComboBoxItems_2("Group","4")),this.GroupsItems.Items.push(l.c.CheckedListBoxItem_3("All","0"));for(let s=0;s<e.Tables[2].length;s++)this.GroupsItems.Items.push(l.c.CheckedListBoxItem_3(e.Tables[2][s].GroupName.toString(),e.Tables[2][s].GroupID.toString()))}}}OnSave(e){if("Cancel"==e.toString())i.a.page.HideDialog(),this.Parent instanceof m.b?this.Parent.Activities.AssignVisiblity=!1:this.Parent instanceof I.RCalenderViewModel?(this.Parent.Activities.IsPopup||(this.Parent.ActVisibility=!0),this.Parent.AssignVisiblity=!1):this.Parent instanceof r.a||"AddEditLeads"==this.Parent.ClassName?("AddEditLeads"==this.Parent.ClassName&&this.Parent.IsAssign&&(this.Parent.Status.SelectedValue="419"),i.a.page.HideDialog()):this.Parent.AssignVisiblity=!1;else if("Search_Roles"==e.toString());else if("Search_Users"==e.toString());else if("Search_Groups"==e.toString());else if("0"==this.TypeOfAssigning.SelectedValue||null==this.TypeOfAssigning.SelectedValue)this.DisplayMessage="Please select type to assign";else{if(this.userexists&&73==this._CCID&&!confirm("Open Activities will trasfer to Assigned users, Are you sure you want to continue?"))return;if(this.Users="",this.Roles="",this.Grps="",null!=this.Parent&&this.Parent instanceof m.b){let e=this.Parent.SelectedRow;if(null!=e){if(this.GetNodeNames(),!h.e.StringIsNullOrEmpty(this.DisplayMessage))return void(this.MessageVisibility=!0);e.UsersXML=this.Users,e.RolesXML=this.Roles,e.isEdited="1",e.GroupXML=this.Grps,e.TeamNodeID=parseInt(this.Teams.SelectedValue),"0"!=this.AssignUser.SelectedValue&&null!=this.AssignUser.SelectedValue?(e.UserID=parseInt(this.AssignUser.SelectedValue),e.isTeam="0"):(e.UserID="0",e.isTeam="1"),this.Parent.ActivityGridDataObj.updateRow(e),i.a.page.HideDialog()}return}if(this.objTeam.FetaureID=this._CCID,this.SelectedNode.Visible){let e="";this.SelectedNode.Items.filter(e=>e.IsChecked&&e.Value).forEach(s=>{e+='<Row NodeID="'+s.toString()+'" ></Row>'}),e.length>0&&(e="<XML>"+e+"</XML>",this.objTeam.NodesXML=e.toString())}else this.objTeam.FeatureNodeID=this._CCNodeID;if(this.GetNodeNames(),!h.e.StringIsNullOrEmpty(this.DisplayMessage))return void(this.MessageVisibility=!0);if(this.objTeam.UsersXML=this.Users,this.objTeam.RolesXML=this.Roles,this.objTeam.GroupXML=this.Grps,this.objTeam.TeamNodeID=parseInt(this.Teams.SelectedValue),"0"!=this.AssignUser.SelectedValue&&null!=this.AssignUser.SelectedValue?(this.objTeam.UserID=parseInt(this.AssignUser.SelectedValue),this.objTeam.isTeam=0):(this.objTeam.UserID=0,this.objTeam.isTeam=1),this.Parent instanceof I.RCalenderViewModel||this.Parent instanceof r.a){this.objTeam.InviteComments=null!=this.InviteComments.Text?this.InviteComments.Text:"";let e=this.objTeam.SetInvite();this.Ret=e.RetValue,this.DisplayMessage=e.Message,this.Ret>0?(this.MessageVisibility=!0,this.Parent instanceof I.RCalenderViewModel&&(this.Parent.ActVisibility=!0,this.Parent.AssignVisiblity=!1),Logger.InfoLog("AssignFeatureViewModel :: Exiting OnSave set invite error ")):this.MessageVisibility=!0}else if(null!=this.Parent&&"PACT.VIEWMODEL.ViewEventsViewModel"==this.Parent.toString()){let e,s=this.Parent.ActivityData.Rows.indexOf(this.Parent.SelectedRow.Row);e=this.Parent.ActivityGridData.filter(this.Parent.FilterStatus);let t=e[s];t.UsersXML=this.Users,t.RolesXML=this.Roles,t.GroupXML=this.Grps,this.Parent.ActivityGridData.AcceptChanges(),this.objTeam.FetaureID=128,this.objTeam.ActivityID=this._ActivityID;let i=this.objTeam.ActivityAssign();this.Ret=i.RetValue,this.DisplayMessage=i.Message}else if(this.SelectedNode.Visible){let e=this.objTeam.AssignMultipleFeature();this.Ret=e.RetValue,this.DisplayMessage=e.Message}else{if(0==this._CCNodeID){let e="";return e+="<XML>",e+="<Row TeamNodeID='"+this.objTeam.TeamNodeID+"'",e+=" UserID='"+this.objTeam.UserID+"'",e+=" isTeam='"+this.objTeam.isTeam+"'",e+=" RolesXML='"+this.objTeam.RolesXML+"'",e+=" UsersXML='"+this.objTeam.UsersXML+"'",e+=" GroupXML='"+this.objTeam.GroupXML+"' />",e+="</XML>",this.AssignXML=e.toString(),this.MessageVisibility=!0,void(this.DisplayMessage=i.a.GetResource("CRMTeam_Save"))}if(this.dset.Tables.length>2&&0==this.dset.Tables[2].length&&""==this.objTeam.RolesXML&&""==this.objTeam.UsersXML&&""==this.objTeam.GroupXML&&0==this.objTeam.TeamNodeID)this.DisplayMessage="There was No Selection";else{let e=this.objTeam.FeatureAssign();this.Ret=e.RetValue,this.DisplayMessage=e.Message}}this.Ret>0?(this.DisplayMessage=this.dset.Tables.length>2&&this.dset.Columns[2].Contains("CCID")&&this.dset.Tables[2].length>0&&""==this.objTeam.RolesXML&&""==this.objTeam.UsersXML&&""==this.objTeam.GroupXML&&0==this.objTeam.TeamNodeID?i.a.GetResource("CRMTeam_UnAssigned"):i.a.GetResource("CRMTeam_Save"),null!=this.Parent&&"AddEditLeads"==this.Parent.ClassName&&(this.Parent.IsAssign=!0)):this.Ret<0&&(this.DisplayMessage=i.a.GetResource("CRMTeam_Error")),this.MessageVisibility=!0,this.LabelVisibility=!1}}GetNodeNames(){this.DisplayMessage="",this.Roles="",this.Users="",this.Grps="";for(let s=0;s<this.RolesItems.Items.length;s++)this.RolesItems.Items[s].IsChecked&&"0"!=this.RolesItems.Items[s].Value&&(this.Roles+=this.RolesItems.Items[s].Value+",");this.Roles=this.Roles.Trim(",");for(let s=0;s<this.UsersItems.Items.length;s++)this.UsersItems.Items[s].IsChecked&&"0"!=this.UsersItems.Items[s].Value&&(this.Users+=this.UsersItems.Items[s].Value+",");this.Users=this.Users.Trim(",");for(let s=0;s<this.GroupsItems.Items.length;s++)this.GroupsItems.Items[s].IsChecked&&"0"!=this.GroupsItems.Items[s].Value&&(this.Grps+=this.GroupsItems.Items[s].Value+",");this.Grps=this.Grps.Trim(",");let e=i.a.SessionManager.GetActionDays(this._CCID,"Assign");if(e>0){if(this.Roles.split(",").length>e)return void(this.DisplayMessage=i.a.GetResource("Only ("+e+") Role(s) can be Assigned"));if(this.Users.split(",").length>e)return void(this.DisplayMessage=i.a.GetResource("Only ("+e+") User(s) can be Assigned"));if(this.Grps.split(",").length>e)return void(this.DisplayMessage=i.a.GetResource("Only ("+e+") Group(s) can be Assigned"));if(this.Roles.split(",").length+this.Users.split(",").length+this.Grps.split(",").length<e)return void(this.DisplayMessage=i.a.GetResource("Assign atleast ("+e+") Role/User/Group"))}}OnTypeChange(e){"0"!=this.TypeOfAssigning.SelectedValue&&null!=this.TypeOfAssigning.SelectedValue&&(this.TeamVisible=!1,this.RolesItems.Visible=!1,this.UsersItems.Visible=!1,this.GroupsItems.Visible=!1,"1"==this.TypeOfAssigning.SelectedValue?this.TeamVisible=!0:"2"==this.TypeOfAssigning.SelectedValue?this.UsersItems.Visible=!0:"3"==this.TypeOfAssigning.SelectedValue?this.RolesItems.Visible=!0:"4"==this.TypeOfAssigning.SelectedValue&&(this.GroupsItems.Visible=!0))}OnChange(e){"0"!=this.Teams.SelectedValue&&null!=this.Teams.SelectedValue&&(this.AssignUser.Items.Clear(),this.LoadUsers())}LoadUsers(){let e=this.dtUsers.filter(e=>e.TeamID==this.Teams.SelectedValue);if(e.length>0){this.AssignUser.Items.Clear();for(let s=0;s<e.length;s++)this.AssignUser.Items.push(l.d.ComboBoxItems_2(e[s].UserName.toString(),e[s].UserID.toString()))}}}}}]);
function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _createSuper(t){var e=_isNativeReflectConstruct();return function(){var i,s=_getPrototypeOf(t);if(e){var a=_getPrototypeOf(this).constructor;i=Reflect.construct(s,arguments,a)}else i=s.apply(this,arguments);return _possibleConstructorReturn(this,i)}}function _possibleConstructorReturn(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{C58A:function(t,e,i){"use strict";i.r(e),i.d(e,"RecurAppointmentViewModel",(function(){return d}));var s=i("Do2H"),a=i("Lp6j"),n=i("ScVY"),r=i("0/4Q"),o=i("PDNK"),l=i("EQd/"),c=i("c9yc"),h=i("JIg3"),u=i("wlFP"),d=function(t){_inherits(i,t);var e=_createSuper(i);function i(t){var a;return _classCallCheck(this,i),(a=e.call(this)).isCanceled=!1,a.FrequencyText="",a.headerVisible=!0,a.ScheduleID=0,a.FreqType=1,a.FreqInterval=0,a.FreqSubdayType=0,a.FreqSubdayInterval=0,a.FreqRelativeInterval=0,a.FreqRecurrenceFactor=0,a.ErrorMessage="",a.isOk=!1,a.DontFireEndDateChange=!1,a.Parent=t,a.Title=s.a.GetResource("Com_AppointmentRecurrence"),a.InitProperties(),a.EndingTime.Visible=!1,a.Duration.Visible=!1,a}return _createClass(i,[{key:"InitProperties",value:function(){this.StartingTime=new r.e(0),this.StartingTime.Label=s.a.GetResource("DocumentDesigner_DocPrefixStart"),this.StartingTime.LblWidth="80";for(var t=new Date(2012,0,1),e=0;e<49;e++)this.StartingTime.Items.push(r.d.ComboBoxItems_2(t.ToString("hh:mm a"),t.ToString("hh:mm a"))),t=t.AddMinutes(e>=0&&e<=46?30:29.99);this.StartingTime.SelectedValue=this.StartingTime.Items[0].Value,this.EndingTime=new r.e(0),this.EndingTime.Label=s.a.GetResource("Packages_EndDate"),t=new Date(2012,0,1);for(var i=0;i<48;i++)this.EndingTime.Items.push(r.d.ComboBoxItems_2(t.ToString("hh:mm a"),i.toString())),t=t.AddMinutes(30);this.EndingTime.SelectedValue=this.EndingTime.Items[0].Value,this.Duration=new r.e(0),this.Duration.Label=s.a.GetResource("Com_Duration"),this.Duration.Items.push(r.d.ComboBoxItems_2("30","30")),this.Duration.Items.push(r.d.ComboBoxItems_2("40","40")),this.Duration.SelectedValue="30",this.Duration.SelectedItem=this.Duration.Items[0],this.RecurrencePattern=new o.b("");var a=new o.a("Once",1);a.Group=this.RecurrencePattern,a.GroupName="RecurrencePattern",a.Label=s.a.GetResource("Com_Once"),a.IsChecked=!0,this.RecurrencePattern.Items.push(a),(a=new o.a("Daily",4)).Group=this.RecurrencePattern,a.GroupName="RecurrencePattern",a.Label=s.a.GetResource("Reports_LblDaily"),this.RecurrencePattern.Items.push(a),(a=new o.a("Weekly",8)).Group=this.RecurrencePattern,a.GroupName="RecurrencePattern",a.Label=s.a.GetResource("Com_Weekly"),this.RecurrencePattern.Items.push(a),(a=new o.a("Monthly",16)).Group=this.RecurrencePattern,a.GroupName="RecurrencePattern",a.Label=s.a.GetResource("Com_Monthly"),this.RecurrencePattern.Items.push(a),(a=new o.a("Yearly",64)).Group=this.RecurrencePattern,a.Label=s.a.GetResource("Com_Yearly"),this.RecurrencePattern.Items.push(a),this.RecurrencePattern.Items[0].IsChecked=!0,this.DailyEvery=new o.b(""),(a=new o.a("DailyEveryDay",1)).Group=this.DailyEvery,a.GroupName="1",a.IsChecked=!0,a.Label=s.a.GetResource("Com_Every"),this.DailyEvery.Items.push(a),(a=new o.a("DailyEveryWeekDay",2)).Group=this.DailyEvery,this.DailyEvery.Items.push(a),this.WeeklyRecurEvery=new l.d(0),this.WeeklyRecurEvery.Text="1",this.WeeklyRecurEvery.Label=s.a.GetResource("Com_Recurevery"),this.WeeklyRecurEvery.LblWidth="70",this.WeeklyDays=new c.a(""),this.WeeklyDays.Items.push(u.a.PactCheckBoxData_1(s.a.GetResource("Com_Sunday"),1)),this.WeeklyDays.Items.push(u.a.PactCheckBoxData_1(s.a.GetResource("Com_Monday"),2)),this.WeeklyDays.Items.push(u.a.PactCheckBoxData_1(s.a.GetResource("Com_Tuesday"),4)),this.WeeklyDays.Items.push(u.a.PactCheckBoxData_1(s.a.GetResource("Com_Wednesday"),8)),this.WeeklyDays.Items.push(u.a.PactCheckBoxData_1(s.a.GetResource("Com_Thursday"),16)),this.WeeklyDays.Items.push(u.a.PactCheckBoxData_1(s.a.GetResource("Com_Friday"),32)),this.WeeklyDays.Items.push(u.a.PactCheckBoxData_1(s.a.GetResource("Com_Saturday"),64)),this.WeeklyDays.Items.map((function(t){return t.Label=t.DBColumnName})),this.MonthlyEvery=new o.b(""),(a=new o.a("MonthlyDayOf",1)).Group=this.MonthlyEvery,a.IsChecked=!0,a.Label=s.a.GetResource("Doc_Day"),this.MonthlyEvery.Items.push(a),(a=new o.a("MonthlyTheFirst",2)).Group=this.MonthlyEvery,a.Label=s.a.GetResource("Com_The"),this.MonthlyEvery.Items.push(a),this.MonthlyDayOf=new l.d(0),this.MonthlyDayOf.Text=(new Date).getDate().toString(),this.MonthlyDayMonths=new l.d(0),this.MonthlyDayMonths.Text="1",this.MonthlyTheFirst=new r.e(0),this.MonthlyTheFirst.LblWidth="1",this.MonthlyTheFirst.Items.push(r.d.ComboBoxItems_2(s.a.GetResource("first"),"1")),this.MonthlyTheFirst.Items.push(r.d.ComboBoxItems_2(s.a.GetResource("second"),"2")),this.MonthlyTheFirst.Items.push(r.d.ComboBoxItems_2(s.a.GetResource("third"),"4")),this.MonthlyTheFirst.Items.push(r.d.ComboBoxItems_2(s.a.GetResource("fourth"),"8")),this.MonthlyTheFirst.Items.push(r.d.ComboBoxItems_2(s.a.GetResource("last"),"16")),this.MonthlyTheFirst.SelectedValue="1",this.MonthlyTheWeekDay=new r.e(0),this.MonthlyTheWeekDay.LblWidth="1",this.MonthlyTheWeekDay.Items.push(r.d.ComboBoxItems_2(s.a.GetResource("Doc_Day"),"8")),this.MonthlyTheWeekDay.Items.push(r.d.ComboBoxItems_2(s.a.GetResource("Com_Sunday"),"1")),this.MonthlyTheWeekDay.Items.push(r.d.ComboBoxItems_2(s.a.GetResource("Com_Monday"),"2")),this.MonthlyTheWeekDay.Items.push(r.d.ComboBoxItems_2(s.a.GetResource("Com_Tuesday"),"3")),this.MonthlyTheWeekDay.Items.push(r.d.ComboBoxItems_2(s.a.GetResource("Com_Wednesday"),"4")),this.MonthlyTheWeekDay.Items.push(r.d.ComboBoxItems_2(s.a.GetResource("Com_Thursday"),"5")),this.MonthlyTheWeekDay.Items.push(r.d.ComboBoxItems_2(s.a.GetResource("Com_Friday"),"6")),this.MonthlyTheWeekDay.Items.push(r.d.ComboBoxItems_2(s.a.GetResource("Com_Saturday"),"7"));var n=(new Date).getDay();this.MonthlyTheWeekDay.SelectedValue=this.MonthlyTheWeekDay.Items[n].Value,this.MonthlyTheMonths=new l.d(0),this.MonthlyTheMonths.Text="1",this.YearlyEvery=new o.b(""),(a=new o.a("YearlyEvery",1)).Group=this.YearlyEvery,a.IsChecked=!0,this.YearlyEvery.Items.push(a),(a=new o.a("YearlyTheFirst",2)).Group=this.YearlyEvery,this.YearlyEvery.Items.push(a),this.YearlyEveryMonth=new r.e(0);for(var d=1;d<=12;d++){var m=new Date(2012,d-1,1);this.YearlyEveryMonth.Items.push(r.d.ComboBoxItems_2(m.ToString("MMMM"),d.toString()))}this.YearlyEveryMonth.SelectedValue=Date.Today().getMonth().toString(),this.YearlyEveryMonthDay=new l.d(0),this.YearlyEveryMonthDay.Text=Date.Today().getDate().toString(),this.YearlyTheFirst=new r.e(0),this.YearlyTheFirst.Items=this.MonthlyTheFirst.Items,this.YearlyTheFirst.SelectedValue="1",this.YearlyTheWeekDay=new r.e(0),this.YearlyTheWeekDay.Items=this.MonthlyTheWeekDay.Items,this.YearlyTheWeekDay.SelectedValue=this.MonthlyTheWeekDay.SelectedValue,this.YearlyTheMonth=new r.e(0),this.YearlyTheMonth.Items=this.YearlyEveryMonth.Items,this.YearlyTheMonth.SelectedValue=Date.Today().getMonth().toString(),this.RangeEnd=new o.b(""),(a=new o.a("NoEndDate",1)).Group=this.RangeEnd,a.GroupName="RangeEnd",a.IsChecked=!0,a.Label=s.a.GetResource("Com_Noenddate"),a.IsChecked=!0,a.CheckedChangedCommand.Subscribe(this,"OnReccurrenceCheckedChanged","Yearly"),this.RangeEnd.Items.push(a),(a=new o.a("EndBy",2)).Group=this.RangeEnd,a.GroupName="RangeEnd",a.Label=s.a.GetResource("Com_Endby"),a.CheckedChangedCommand.Subscribe(this,"OnReccurrenceCheckedChanged","Yearly"),this.RangeEnd.Items.push(a),this.FirstPostingDate=new h.a(0),this.FirstPostingDate.Label=s.a.GetResource("DocumentDesigner_DocPrefixStart"),this.EndDate=new h.a(0),this.EndDate.LblWidth="1",this.EndDate.SelectedDateChanged.Subscribe(this,"EndDate_PropertyChanged"),this.Occurrences=new l.d(0),this.Occurrences.Label=s.a.GetResource("Com_Occurrences"),this.Occurrences.Text="10"}},{key:"EndDate_PropertyChanged",value:function(t,e){this.DontFireEndDateChange||(this.RangeEnd.Items[1].IsChecked?this.CalculateOccurrences():this.RangeEnd.Items[1].IsChecked=!0)}},{key:"LoadEditData",value:function(t){if(this.ScheduleID=parseInt(t.ScheduleID),this.FreqType=parseInt(t.FreqType),this.FreqInterval=parseInt(t.FreqInterval),this.FreqSubdayType=parseInt(t.FreqSubdayType),this.FreqSubdayInterval=parseInt(t.FreqSubdayInterval),this.FreqRelativeInterval=parseInt(t.FreqRelativeInterval),this.FreqRecurrenceFactor=parseInt(t.FreqRecurrenceFactor),this.Occurrences.Text=a.e.IsEmpty(t.Occurrence)?"0":t.Occurrence.toString(),1==this.FreqType)this.RecurrencePattern.Items[0].IsChecked=!0;else if(4==this.FreqType)this.RecurrencePattern.Items[1].IsChecked=!0,this.DailyEvery.Items[0].IsChecked=!0,this.DailyEvery.Items[0].GroupName=this.FreqInterval.toString();else if(8==this.FreqType){this.RecurrencePattern.Items[2].IsChecked=!0;for(var e=this.FreqInterval,i=this.WeeklyDays.Items.length-1;i>=0;i--)e>=this.WeeklyDays.Items[i].FeatureID?(this.WeeklyDays.Items[i].IsChecked=!0,e-=this.WeeklyDays.Items[i].FeatureID):this.WeeklyDays.Items[i].IsChecked=!1;this.WeeklyRecurEvery.Text=this.FreqRecurrenceFactor.toString()}else 16==this.FreqType?(this.RecurrencePattern.Items[3].IsChecked=!0,this.MonthlyEvery.Items[0].IsChecked=!0,this.MonthlyDayOf.Text=this.FreqInterval.toString(),this.MonthlyDayMonths.Text=this.FreqRecurrenceFactor.toString()):32==this.FreqType&&(this.RecurrencePattern.Items[3].IsChecked=!0,this.MonthlyEvery.Items[1].IsChecked=!0,this.MonthlyTheWeekDay.SelectedValue=this.FreqInterval.toString(),this.MonthlyTheFirst.SelectedValue=this.FreqRelativeInterval.toString(),this.MonthlyTheMonths.Text=this.FreqRecurrenceFactor.toString());0!=this.FreqType&&(this.FrequencyText=this.RecurrencePattern.CheckedItem.Label),this.FirstPostingDate.Date=new Date(t.CStartDate),a.e.isValidDate(t.CEndDate)?(this.EndDate.Date=this.FirstPostingDate.Date,this.EndDate.Visible=!1,this.RangeEnd.Items[0].IsChecked=!0):(this.RangeEnd.Items[1].IsChecked=!0,this.EndDate.Date=new Date(t.CEndDate),this.CalculateOccurrences());var s=t.StartTime.toString();if(s.length>0)if(s.Contains(":"))this.StartingTime.SelectedValue=Date.WithTime(s).ToString("hh:mm a");else{var n=Date.Today();n=(n=n.AddHours(parseFloat(s.substr(0,2)))).AddMinutes(parseFloat(s.substr(2,2))),this.StartingTime.SelectedValue=n.ToString("hh:mm a")}}},{key:"SetSaveData",value:function(){var t=this;if(this.FreqType=this.RecurrencePattern.CheckedItem.FeatureID,1==this.FreqType)this.FreqInterval=0;else if(4==this.FreqType)this.FreqInterval=parseInt(this.DailyEvery.Items[0].GroupName);else if(8==this.FreqType){if(this.FreqInterval=0,this.WeeklyDays.Items.forEach((function(e){e.IsChecked&&(t.FreqInterval+=e.FeatureID)})),0==this.FreqInterval)return void this.Parent.SetErroMessage("Select Day.");this.FreqRecurrenceFactor=parseInt(this.WeeklyRecurEvery.Text)}else 16==this.FreqType&&(this.MonthlyEvery.Items[0].IsChecked?(this.FreqInterval=parseInt(this.MonthlyDayOf.Text),this.FreqRecurrenceFactor=parseInt(this.MonthlyDayMonths.Text)):(this.FreqType=32,this.FreqInterval=parseInt(this.MonthlyTheWeekDay.SelectedValue),this.FreqRelativeInterval=parseInt(this.MonthlyTheFirst.SelectedValue),this.FreqRecurrenceFactor=parseInt(this.MonthlyTheMonths.Text)))}},{key:"OnButtonClick",value:function(t){if(this.FrequencyText=this.RecurrencePattern.CheckedItem.Label,"OK"==t){if(this.RecurrencePattern.Items[1].IsChecked){if(this.DailyEvery.Items[0].IsChecked&&a.e.Int(this.DailyEvery.Items[0].GroupName)<=0)return void alert("Invalid Day")}else if(this.RecurrencePattern.Items[2].IsChecked){if(a.e.Int(this.WeeklyRecurEvery.Text)<=0)return void alert("Invalid Every Week")}else if(this.RecurrencePattern.Items[3].IsChecked)if(this.MonthlyEvery.Items[0].IsChecked){if(a.e.Int(this.MonthlyDayOf.Text)<=0)return void alert("Invalid Day");if(a.e.Int(this.MonthlyDayMonths.Text)<=0)return void alert("Invalid Every Month")}else if(this.MonthlyEvery.Items[1].IsChecked&&a.e.Int(this.MonthlyTheMonths.Text)<=0)return void alert("Invalid Every Month");this.isOk=!0,"ActivitiesViewModel"==this.Parent.ClassName&&this.Parent.IsPopup&&this.Parent.IsPopupRecur(),s.a.page.HideDialog()}else"Cancel"==t&&(this.isOk=!1,s.a.page.HideDialog())}},{key:"onCancel",value:function(t){this.isCanceled=!0,this.isOk=!1,s.a.page.HideDialog()}},{key:"OnOccurrencesLeave",value:function(t){this.CalculateEndDate(),this.RangeEnd.Items[1].IsChecked=!0}},{key:"OnReccurrenceCheckedChanged",value:function(t){this.RangeEnd.Items[0].IsChecked||this.RangeEnd.Items[1].IsChecked&&this.CalculateOccurrences()}},{key:"CalculateEndDate",value:function(){var t=10,e=1;try{t=parseInt(this.Occurrences.Text)}catch(s){}var i=this.FirstPostingDate.Date;if(this.RecurrencePattern.Items[1].IsChecked){for(this.FreqInterval=parseInt(this.DailyEvery.Items[0].GroupName);e<t;)i=i.AddDays(this.FreqInterval),e++;this.DontFireEndDateChange=!0,this.EndDate.Date=i,this.DontFireEndDateChange=!1}else if(this.RecurrencePattern.Items[2].IsChecked){if(this.WeeklyDays.Items.filter((function(t){return 1==t.IsChecked})).length>0){for(this.FreqInterval=parseInt(this.WeeklyRecurEvery.Text),e=0;!(this.WeeklyDays.Items[i.getDay()].IsChecked&&(e++,e>=t));)0==(i=i.AddDays(1)).getDay()&&this.FreqInterval>1&&(i=i.AddDays(7*(this.FreqInterval-1)));this.DontFireEndDateChange=!0,this.EndDate.Date=i,this.DontFireEndDateChange=!1}}else if(this.RecurrencePattern.Items[3].IsChecked)if(this.MonthlyEvery.Items[0].IsChecked){for(this.FreqInterval=parseInt(this.MonthlyDayOf.Text),this.FreqRecurrenceFactor=parseInt(this.MonthlyDayMonths.Text),this.FreqInterval<i.getDate()?(i=(i=i.AddMonths(1)).AddDays(this.FreqInterval-i.getDate()),this.FirstPostingDate.Date=i):i=this.GetDate(i,this.FreqInterval);e<t;)i=i.AddMonths(this.FreqRecurrenceFactor),this.FreqInterval!=i.getDate()&&(i=this.GetDate(i,this.FreqInterval)),e++;this.DontFireEndDateChange=!0,this.EndDate.Date=i,this.DontFireEndDateChange=!1}else{if("8"==this.MonthlyTheWeekDay.SelectedValue)for("1"==this.MonthlyTheFirst.SelectedValue?1!=i.getDate()&&(i=new Date(i.getFullYear(),i.getMonth(),1).AddMonths(1)):"16"==this.MonthlyTheFirst.SelectedValue&&(i=new Date(i.getFullYear(),i.getMonth(),1).AddMonths(1).AddDays(-1)),this.FreqRecurrenceFactor=parseInt(this.MonthlyTheMonths.Text);e<t;)i="16"==this.MonthlyTheFirst.SelectedValue?new Date(i.getFullYear(),i.getMonth(),1).AddMonths(this.FreqRecurrenceFactor+1).AddDays(-1):i.AddMonths(this.FreqRecurrenceFactor),e++;else for(this.FreqRecurrenceFactor=parseInt(this.MonthlyTheMonths.Text);e<t;)i=i.AddMonths(this.FreqRecurrenceFactor),e++;this.DontFireEndDateChange=!0,this.EndDate.Date=i,this.DontFireEndDateChange=!1}}},{key:"CalculateOccurrences",value:function(){var t=0,e=this.FirstPostingDate.Date,i=this.EndDate.Date;if(this.RecurrencePattern.Items[1].IsChecked){for(this.FreqInterval=parseInt(this.DailyEvery.Items[0].GroupName);e<=i;)e=e.AddDays(this.FreqInterval),t++;this.Occurrences.Text=t.toString()}else if(this.RecurrencePattern.Items[2].IsChecked){if(this.WeeklyDays.Items.filter((function(t){return 1==t.IsChecked})).length>0){for(this.FreqInterval=parseInt(this.WeeklyRecurEvery.Text);e<=i;)this.WeeklyDays.Items[e.getDay()].IsChecked&&t++,0==(e=e.AddDays(1)).getDay()&&this.FreqInterval>1&&(e=e.AddDays(7*(this.FreqInterval-1)));this.Occurrences.Text=t.toString()}}else if(this.RecurrencePattern.Items[3].IsChecked)if(this.MonthlyEvery.Items[0].IsChecked){for(this.FreqInterval=parseInt(this.MonthlyDayOf.Text),this.FreqRecurrenceFactor=parseInt(this.MonthlyDayMonths.Text),this.FreqInterval<e.getDate()?(e=(e=e.AddMonths(1)).AddDays(this.FreqInterval-e.getDate()),this.FirstPostingDate.Date=e):e=this.GetDate(e,this.FreqInterval);e<=i;)e=e.AddMonths(this.FreqRecurrenceFactor),this.FreqInterval!=e.getDate()&&(e=this.GetDate(e,this.FreqInterval)),t++;this.Occurrences.Text=t.toString()}else{if("8"==this.MonthlyTheWeekDay.SelectedValue)for("1"==this.MonthlyTheFirst.SelectedValue?1!=e.getDate()&&(e=new Date(e.getFullYear(),e.getMonth(),1).AddMonths(1)):"16"==this.MonthlyTheFirst.SelectedValue&&(e=new Date(e.getFullYear(),e.getMonth(),1).AddMonths(1).AddDays(-1)),this.FreqRecurrenceFactor=parseInt(this.MonthlyTheMonths.Text);e<=i;)e=e.AddMonths(this.FreqRecurrenceFactor),t++;else for(this.FreqRecurrenceFactor=parseInt(this.MonthlyTheMonths.Text);e<=i;)e=e.AddMonths(this.FreqRecurrenceFactor),t++;this.Occurrences.Text=t.toString()}}},{key:"GetDate",value:function(t,e){try{t=new Date(t.getFullYear(),t.getMonth(),e)}catch(i){try{t=new Date(t.getFullYear(),t.getMonth(),e-1)}catch(s){try{t=new Date(t.getFullYear(),t.getMonth(),e-2)}catch(a){try{t=new Date(t.getFullYear(),t.getMonth(),e-3)}catch(n){}}}}return t}}]),i}(n.b)},CQvG:function(t,e,i){"use strict";i.d(e,"b",(function(){return A})),i.d(e,"a",(function(){return C}));var s=i("Do2H"),a=i("Lp6j"),n=i("ockk"),r=i("0/4Q"),o=i("8B8H"),l=i("NkMH"),c=i("EQd/"),h=i("xnJf"),u=i("OvA8"),d=i("JIg3"),m=i("n56n"),S=i("Jnyl"),y=i("31sV"),D=i("yWgc"),A=function(){function t(e){var i=this;_classCallCheck(this,t),this.Module="CASES",this.ClassName="ViewActivitiesViewModel",this.Visible=!0,this.ViewActivityInSection=!1,this.CloseVisible=!1,this.AssignVisible=!1,this.Activity=new r.e(0),this.tempActivityGridDataColumn=[],this.ActivityGridDataObj=new o.a,this.tempActivityDataColumn=[],this.CostCenterID=0,this.AssignVisiblity=!0,this.NodeID=0,this.ActVisibility=!1,this.ColumnSpan="4",this.DeletedActivity=[],this.ButtonAdd=new l.a,this.ButtonUpdate=new l.a,this.ButtonDelete=new l.a,this.DS=null,this.FilterStatus="",this.TempSchID=-1e3,this.SchID=-2e3,this.NodeID=e.NodeID,this.CostCenterID=e.CostCenterID,this.Activities=e.Activities,this.Parent=e,this.contextVisible=!0,null!=this.Activities&&(this.Activities.ActivitiesVisibility=!0),this.Activity.Label=s.a.GetResource("CRMOpportunity_Activities"),this.Activity.LblWidth="80",this.Activity.Items.push(r.d.ComboBoxItems_2("All","-1")),this.Activity.Items.push(r.d.ComboBoxItems_2("Open","1")),this.Activity.Items.push(r.d.ComboBoxItems_2("Confirmed","4")),this.Activity.Items.push(r.d.ComboBoxItems_2("Closed","2")),this.Activity.Items.push(r.d.ComboBoxItems_2("Re-Schedule","3")),this.Activity.Items.push(r.d.ComboBoxItems_2("In-Progress","5")),this.Activity.Items.push(r.d.ComboBoxItems_2("On-Hold","6")),this.Activity.SelectedValue="-1",this.ActivitisActualData(),e.CostCenterID>4e4&&e.CostCenterID<5e4?s.a.SessionManager.HideUnathorizedAccess?(this.ButtonUpdate.Visible=s.a.SessionManager.IsActionAssigned(1e3,"Activity_Create"),this.ButtonDelete.Visible=s.a.SessionManager.IsActionAssigned(1e3,"Activity_Delete")):(this.ButtonUpdate.Enable=s.a.SessionManager.IsActionAssigned(1e3,"Activity_Edit"),this.ButtonDelete.Enable=s.a.SessionManager.IsActionAssigned(1e3,"Activity_Delete")):(s.a.SessionManager.HideUnathorizedAccess?this.ButtonAdd.Visible=s.a.SessionManager.IsActionAssigned(1e3,"Activity_Create"):this.ButtonAdd.Enable=s.a.SessionManager.IsActionAssigned(1e3,"Activity_Create"),s.a.SessionManager.HideUnathorizedAccess?this.ButtonUpdate.Visible=s.a.SessionManager.IsActionAssigned(1e3,"Activity_Edit"):this.ButtonUpdate.Enable=s.a.SessionManager.IsActionAssigned(1e3,"Activity_Edit"),this.AssignVisible=s.a.SessionManager.IsActionAssigned(1e3,"Assign"),s.a.SessionManager.HideUnathorizedAccess?this.ButtonDelete.Visible=s.a.SessionManager.IsActionAssigned(1e3,"Activity_Delete"):this.ButtonDelete.Enable=s.a.SessionManager.IsActionAssigned(1e3,"Activity_Delete")),this.ButtonUpdate.Visible||this.ButtonDelete.Visible||(this.contextVisible=!1),this.ActivityGridDataObj.OnLinkClick.Subscribe(this,"OnCmnItem_Click"),this.ActivityGridDataObj.ContextMenuClickSubject.subscribe((function(t){i.OnCmnItem_Click("",t.item.Tag)})),this.ActivityGridDataObj.ContextMenu.Items=[];var a=new n.b;a.Header=s.a.GetResource("EDIT"),a.Tag="EDIT",a.Visibility=this.ButtonUpdate.Visible,this.ActivityGridDataObj.ContextMenu.Items.push(a),(a=new n.b).Header=s.a.GetResource("DELETE"),a.Tag="DELETE",a.Visibility=this.ButtonDelete.Visible,this.ActivityGridDataObj.ContextMenu.Items.push(a)}return _createClass(t,[{key:"OnSave",value:function(){Logger.InfoLog("AssignViewModel::Entering Save"),Logger.InfoLog("AssignViewModel::Exiting Save")}},{key:"OnCmnItem_Click",value:function(t,e){var i,n,o,l,A,v=this;switch(Logger.InfoLog("ViewNoteViewModel::Entering OnCmnItem_Click with Command="+t),this.Activities.enablecontrols(!this.Activities.isView),this.Activities.isView?(this.Activities.ButtonSave.Visible=!1,this.Activities.ButtonReschedule.Visible=!1,this.Activities.ButtonAttachments.Visible=!1,this.Activities.ButtonCustomize.Visible=!1):this.Activities.buttonsAction(),null!=this.Activities.CRMCustomer.Text&&""!=this.Activities.CRMCustomer.Text||null==this.Parent||("AddDContactViewModel"==this.Parent.ClassName?this.Activities.CRMCustomer.Text=this.Parent.Customer.Text:"AddEditLeads"==this.Parent.ClassName||"AddEditOpportunity"==this.Parent.ClassName?this.Activities.CRMCustomer.Text=this.Parent.Company.Text:"AddEditCasesViewModel"==this.Parent.ClassName?this.Activities.CRMCustomer.Text=this.Parent.Customer.Text:"AddEditCampaignViewModel"==this.Parent.ClassName?this.Activities.CRMCustomer.Text=this.Parent.txtName.Text:"QuickAddCaseViewModel"==this.Parent.ClassName?this.Activities.CRMCustomer.Text=this.Parent.Customer.Text:"AddCustomerViewModel"==this.Parent.ClassName?this.Activities.CRMCustomer.Text=this.Parent.CustomerName.Text:"AddEditRenContractViewModel"==this.Parent.ClassName?this.Activities.CRMCustomer.Text=this.Parent.Tenant.Text:"AddEditTenantViewModel"==this.Parent.ClassName&&(this.Activities.CRMCustomer.Text=this.Parent.FstName.Text)),e){case"ADD":if(null==this.Activities)return;if(this.SelectedRow=null,this.Activities.Selectedrow=null,this.Activities.ActivityID=0,this.Activities.buttonsAction(),this.Activities.ActivityType.SelectedValue="1",this.Activities.StatusSelectedValue="412",this.Activities.Subject.Text="",this.Activities.Priority.SelectedValue="2",this.Activities.PctComplete.Text="",this.Activities.Location.Text="",this.Activities.IsAllDayActivity.IsChecked=!0,this.Activities.ActualCloseDate.Date=new Date,this.Activities.ActualCloseTime.SelectedValue="12:00 AM",this.Activities.Remarks.Text="",this.Activities.Remarks.Tag="",this.Activities.Remarks.Xaml="",this.Activities.ActivitiesVisibility=!0,this.Activities.ClearFields(),this.Activities.AssignVisiblity=!1,this.Activities.ViewAttachVisible=!1,null!=this.Activities.ViewAttachments&&this.Activities.ViewAttachments.AttachmentsListObj.Clear(),null!=this.Activities&&this.Activities.SetActions(),!(null===(i=this.Activities)||void 0===i?void 0:i.ActivityOnScreen)&&"AddEditDocumentViewModel"==this.Parent.ClassName&&this.Parent.ScreenObject.Preferences.ContainsKey("ActivityAsPopUp")&&"True"==this.Parent.ScreenObject.Preferences.ActivityAsPopUp.toString())return void s.a.page.ShowDialog(this.Activities,y.ActivitiesComponent,{ShowCenter:!0,Title:s.a.GetResource("Activities")});if(this.Parent instanceof C||"AddEditLeads"==this.Parent.ClassName||"AddEditCasesViewModel"==this.Parent.ClassName||"AddCustomerViewModel"==this.Parent.ClassName){if("AddEditLeads"==this.Parent.ClassName&&this.Parent.ContactsBasedOnLeads&&this.Parent.LeadID>0&&(this.Activities.CRMContactPerson.CustomWhere="a.Featurepk ="+this.Parent.LeadID+" and a.Featureid=86  ",this.Activities.CRMContactPerson.Refresh(),this.Activities.CRMContactPerson.SelectedIndex=0),"AddEditCasesViewModel"==this.Parent.ClassName.toString())for(var p,b=0;b<this.Activities.Fields.length;b++){var g=this.Activities.Fields[b];g instanceof m.b&&g.CCID>5e4&&(null!=(p=this.Parent.ScreenObject.GetCustomCCField(g.CCID))&&(g.SelectedValue=p.SelectedValue))}else"AddCustomerViewModel"==this.Parent.ClassName.toString()&&this.Parent.CustomerID>0&&(this.Activities.CRMContactPerson.CustomWhere="a.Featurepk ="+this.Parent.CustomerID+" and a.Featureid=83  ",this.Activities.CRMContactPerson.Refresh(),this.Activities.CRMContactPerson.SelectedIndex=0);(null===(n=this.Activities)||void 0===n?void 0:n.ActivityOnScreen)||(this.Activities.IsPopup?(this.ActivitiesPopup=this.Activities,s.a.page.ShowDialog(this.ActivitiesPopup,y.ActivitiesComponent,{ShowCenter:!0,Title:s.a.GetResource("Activities")}),this.Parent.ActVisibility=!1):(this.Parent.ActVisibility=!0,s.a.page.ShowDialog(this.Activities,y.ActivitiesComponent,{Title:s.a.GetResource("Activities")})))}else this.Parent.ActVisibility=!0,(null===(o=this.Activities)||void 0===o?void 0:o.ActivityOnScreen)||s.a.page.ShowDialog(this.Activities,y.ActivitiesComponent,{Title:s.a.GetResource("Activities")});break;case"ASSIGN":if(null!=this.SelectedRow){if(null==this.Activities)return;this.Activities.ActivitiesVisibility=!1,this.Activities.AssignVisiblity=!0;var T,I,R;T=a.e.IsEmpty(this.SelectedRow.UsersXML)?"":this.SelectedRow.UsersXML.toString().split(","),I=a.e.IsEmpty(this.SelectedRow.RolesXML)?"":this.SelectedRow.RolesXML.toString().split(","),R=a.e.IsEmpty(this.SelectedRow.GroupXML)?"":this.SelectedRow.GroupXML.toString().split(",");for(var V=0;V<this.Activities.AssignFeature.RolesItems.Items.length;V++)for(var f=0;f<I.length;f++){if(I[f]==this.Activities.AssignFeature.RolesItems.Items[V].Value){this.Activities.AssignFeature.RolesItems.Items[V].IsChecked=!0;break}this.Activities.AssignFeature.RolesItems.Items[V].IsChecked=!1}for(var w=0;w<this.Activities.AssignFeature.UsersItems.Items.length;w++)for(var M=0;M<T.length;M++){if(T[M]==this.Activities.AssignFeature.UsersItems.Items[w].Value){this.Activities.AssignFeature.UsersItems.Items[w].IsChecked=!0;break}this.Activities.AssignFeature.UsersItems.Items[w].IsChecked=!1}for(var E=0;E<this.Activities.AssignFeature.GroupsItems.Items.length;E++)for(var P=0;P<R.length;P++){if(R[P]==this.Activities.AssignFeature.GroupsItems.Items[E].Value){this.Activities.AssignFeature.GroupsItems.Items[E].IsChecked=!0;break}this.Activities.AssignFeature.GroupsItems.Items[E].IsChecked=!1}s.a.page.ShowDialog(this.Activities.AssignFeature,D.AssignFeatureComponent,{ShowCenter:!0}),this.Activities.IsPopup&&(this.ActVisibility=!0,this.Parent.ActVisibility=!0)}break;case"EDIT":case"View":if(null!=this.SelectedRow){var F=this.SelectedRow;if(this.Parent.ActVisibility=!0,this.Activities.ActivitiesVisibility=!0,this.Activities.AssignVisiblity=!1,a.e.IntTryParse(F.ActivityID)>0){if("AddEditDocumentViewModel"!=this.Parent.ClassName&&parseInt(F.SchID)<0&&("3"!=F.ActivityTypeID.toString()||"4"!=F.ActivityTypeID.toString()))return void(this.Activities.IsPopup&&(this.ActivitiesPopup=this.Activities,this.Parent.ActVisibility=!1,this.ActVisibility=!1,(null===(l=this.Activities)||void 0===l?void 0:l.ActivityOnScreen)||s.a.page.ShowDialog(this.ActivitiesPopup,y.ActivitiesComponent,{ShowCenter:!0})));if(null==this.Activities)return;if(this.Activities.ButtonSave.Visible=a.e.IsEmpty(F.UserName)||F.UserName.toString().toLowerCase()==s.a.SessionManager.UserName.toLowerCase()?s.a.SessionManager.IsActionAssigned(1e3,"Activity_Edit"):s.a.SessionManager.IsActionAssigned(1e3,"Can_edit_All_Activities"),this.Activities.ActivityID=parseInt(F.ActivityID.toString()),this.Activities.ActivityType.SelectedValue=F.ActivityTypeID.toString(),a.e.IsEmpty(F.ScheduleID)||null==F.ScheduleID||""==F.ScheduleID.toString()||"0"==F.ScheduleID.toString()||this.Activities.Recur.LoadEditData(F),!a.e.IsEmpty(F.FreqType)&&null!=F.FreqType&&""!=F.FreqType.toString()){var k=parseInt(F.FreqType.toString());1==k?this.Activities.ActivityText.Text="Once":4==k?this.Activities.ActivityText.Text="Daily":8==k?this.Activities.ActivityText.Text="Weekly":k>=16&&(this.Activities.ActivityText.Text="Monthly")}if("1"==this.Activities.ActivityType.SelectedValue||"2"==this.Activities.ActivityType.SelectedValue?this.Activities.Exp.Visible=!1:"3"!=this.Activities.ActivityType.SelectedValue&&"4"!=this.Activities.ActivityType.SelectedValue||(this.Activities.Exp.Visible=!1,this.Activities.StartDate.Visible=!0,this.Activities.StartTime.Visible=!0,this.Activities.EndDate.Visible=!0,this.Activities.EndTime.Visible=!0),this.Activities.StatusSelectedValue=a.e.String(F.SchStatus),this.Activities.Subject.Text=F.Subject.toString(),this.Activities.Priority.SelectedValue=F.Priority.toString(),this.Activities.PctComplete.Text=F.PctComplete.toString(),this.Activities.Location.Text=F.Location.toString(),a.e.IsEmpty(F.SchID)||(this.Activities.SchID=parseInt(F.SchID.toString())),this.Activities.IsAllDayActivity.IsChecked="0"!=F.IsAllDayActivity.toString(),null!=F.ActualCloseDate_Key&&""!=F.ActualCloseDate_Key.toString()&&(this.Activities.ActualCloseDate.Date=1900==new Date(F.ActualCloseDate_Key.toString()).getFullYear()?new Date:new Date(F.ActualCloseDate_Key.toString()),this.Activities.ActualCloseDate.CustomFormat=s.a.SessionManager.Preferences["Date Format"].toString()),a.e.IsEmpty(F.ActualCloseTime)?this.Activities.ActualCloseTime.SelectedIndex=0:this.Activities.ActualCloseTime.SelectedValue=new Date(F.ActualCloseTime.toString()).ToString("hh:mm:ss a"),this.Activities.CRMCustomer.Text=F.CustomerID.toString(),this.Activities.CRMContactPerson.SelectedValue=a.e.IsEmpty(F.ContactID)?0:parseInt(F.ContactID.toString()),this.Activities.Remarks.Text=F.Remarks.toString(),a.e.IsEmpty(F.ActStartDate_Key)||(this.Activities.StartDate.Date=new Date(F.ActStartDate_Key.toString())),a.e.IsEmpty(F.ActEndDate_Key)||(this.Activities.EndDate.Date=new Date(F.ActEndDate_Key.toString())),a.e.IsEmpty(F.StartDateTime_Key)||(this.Activities.ActStartDate.Date=new Date(F.StartDateTime_Key.toString()),this.Activities.ActStartTime.AddItem(new Date(F.StartDateTime_Key.toString()).ToString("hh:mm:ss tt"),new Date(F.StartDateTime_Key.toString()).ToString("hh:mm:ss tt")),this.Activities.ActStartTime.SelectedValue=new Date(F.StartDateTime_Key.toString()).ToString("hh:mm:ss tt")),a.e.IsEmpty(F.EndDateTime_Key)||(this.Activities.ActEndDate.Date=new Date(F.EndDateTime_Key.toString()),this.Activities.ActEndTime.AddItem(new Date(F.EndDateTime_Key.toString()).ToString("hh:mm:ss tt"),new Date(F.EndDateTime_Key.toString()).ToString("hh:mm:ss tt")),this.Activities.ActEndTime.SelectedValue=new Date(F.EndDateTime_Key.toString()).ToString("hh:mm:ss tt")),this.Activities.TotalDuration=a.e.IsEmpty(F.TotalDuration)?0:parseInt(F.TotalDuration.toString()),this.Activities.laststartdate=a.e.IsEmpty(F.LastStartDate)?null:new Date(F.LastStartDate.toString()),this.Activities.StartTime.SelectedValue=new Date(F.ActStartTime.toString()).ToString("hh:mm:ss a"),this.Activities.EndTime.SelectedValue=new Date(F.ActEndTime.toString()).ToString("hh:mm:ss a"),this.Activities.AssignUserList.SelectedValue=F.AssignUserID.toString(),this.Activities.ViewAttachVisible=!1,null!=F.AttachmentXML&&""!=F.AttachmentXML.toString()){this.Activities.ViewAttachVisible=!0;var x=new a.f;try{this.Activities.ViewAttachments=new u.ViewAttachmentViewModel(this.Activities),x.LoadXml(F.AttachmentXML.toString());var G=x.SelectNodes("AttachmentsXML/Row");this.Activities.ViewAttachments.AttachmentsListObj.Clear(),G.forEach((function(t){var e=new h.AddAttachmentViewModel;e.AddAttachmentViewModel_2(v.Activities),e.AttachmentID=parseInt(t.attributes.AttachmentID.value),e.ActualFileName=t.attributes.ActualFileName.value,e.FileExtension=t.attributes.FileExtension.value,e.FileDescription=t.attributes.FileDescription.value,e.Guid=t.attributes.GUID.value,e.RelativeFileName=t.attributes.RelativeFileName.value,e.IsProductImage=!1,null!=t.attributes.IsSign&&"1"==t.attributes.IsSign.value&&(e.IsSign=!0),v.Activities.ViewAttachments.AttachmentsListObj.addRow(e)}))}catch(H){console.log("AttachmentXML"+H.stack)}}for(var L,_=null,O=null,N=null,j=null,U=null,q=null,W=0;W<this.Activities.Fields.length;W++){var B=this.Activities.Fields[W];if(B instanceof c.d&&((_=B).Text=a.e.StringValue(F[_.SysColumnName])),B instanceof d.b){U=B;try{U.Date=new Date(F[U.SysColumnName].toString())}catch(Y){var X=new Date;U.Date=new Date(1900,1,1,X.getHours(),X.getMinutes(),X.getSeconds(),X.getMilliseconds())}}else B instanceof d.a&&(O=B,a.e.IsEmpty(F[O.SysColumnName])||(O.Date=new Date(F[O.SysColumnName].toString())));B instanceof r.e&&((N=B).SelectedValue=F[N.SysColumnName].toString()),B instanceof S.a&&((q=B).TextBox.Text=F[q.SysColumnName].toString()),B instanceof c.c&&((j=B).Text=F[j.SysColumnName].toString()),B instanceof m.b&&(L=B,a.e.IsEmpty(F[L.SysColumnName])||(L.SelectedValue=a.e.IsEmpty(F[L.SysColumnName+"_Key"])?0:parseInt(F[L.SysColumnName+"_Key"])))}this.Activities.Selectedrow=F}else null!=this.Activities&&(this.Activities.Selectedrow=F,this.Activities.ActivityID=0,this.Activities.ActivityType.SelectedValue="1",this.Activities.StatusSelectedValue="412",this.Activities.Subject.Text="",this.Activities.Priority.SelectedValue="2",this.Activities.PctComplete.Text="",this.Activities.Location.Text="",this.Activities.IsAllDayActivity.IsChecked=!0,this.Activities.ActualCloseDate.Date=new Date,this.Activities.ActualCloseTime.SelectedValue="12:00:00 AM",this.Activities.CRMCustomer.Text="",this.Activities.Remarks.Text="",this.Activities.Remarks.Xaml="",this.Activities.StartDate.Date=new Date,this.Activities.EndDate.Date=new Date,this.Activities.StartTime.SelectedValue="09:00:00 AM",this.Activities.EndTime.SelectedValue="09:30:00 AM",this.Activities.ActStartDate.Date=null,this.Activities.ActEndDate.Date=null,this.Activities.TotalDuration=0,this.Activities.laststartdate=null,this.Activities.ActStartTime.SelectedValue="",this.Activities.ActEndTime.SelectedValue="");!this.CloseVisible||this.Parent instanceof C||"AddEditDocumentViewModel"==this.Parent.ClassName&&this.Parent.ScreenObject.Preferences.ContainsKey("ActivityAsPopUp")&&"True"==this.Parent.ScreenObject.Preferences.ActivityAsPopUp.toString()||s.a.page.HideDialog()}else null!=this.Activities&&(this.Activities.Selectedrow=null,this.Activities.ActivityID=0,this.Activities.ActivityType.SelectedValue="1",this.Activities.StatusSelectedValue="412",this.Activities.Subject.Text="",this.Activities.Priority.SelectedValue="2",this.Activities.PctComplete.Text="",this.Activities.Location.Text="",this.Activities.IsAllDayActivity.IsChecked=!0,this.Activities.ActualCloseDate.Date=new Date,this.Activities.ActualCloseTime.SelectedValue="12:00 AM",this.Activities.Remarks.Text="",this.Activities.Remarks.Xaml="",this.Activities.ActStartDate.Date=null,this.Activities.ActEndDate.Date=null,this.Activities.TotalDuration=0,this.Activities.laststartdate=null,this.Activities.ActStartTime.SelectedValue="",this.Activities.ActEndTime.SelectedValue="");null!=this.Activities&&this.Activities.SetActions(),!(null===(A=this.Activities)||void 0===A?void 0:A.ActivityOnScreen)&&"AddEditDocumentViewModel"==this.Parent.ClassName&&this.Parent.ScreenObject.Preferences.ContainsKey("ActivityAsPopUp")&&"True"==this.Parent.ScreenObject.Preferences.ActivityAsPopUp.toString()?s.a.page.ShowDialog(this.Activities,y.ActivitiesComponent,{Title:s.a.GetResource("Activities")}):null!=this.Parent&&(this.Parent instanceof C||"AddEditLeads"==this.Parent.ClassName.toString()||"AddEditCasesViewModel"==this.Parent.ClassName.toString())&&this.Activities.IsPopup?(this.ActivitiesPopup=this.Activities,this.Parent.ActVisibility=!1,this.ActVisibility=!1,s.a.page.ShowDialog(this.ActivitiesPopup,y.ActivitiesComponent,{ShowCenter:!0,Title:s.a.GetResource("Activities")})):(this.Parent.ActVisibility=!0,this.ActVisibility=!0,s.a.page.ShowDialog(this.Activities,y.ActivitiesComponent,{Title:s.a.GetResource("Activities")}));break;case"DELETE":if(null!=this.SelectedRow){var K=0;"0"!=this.SelectedRow.ActivityID.toString()&&(K=parseInt(this.SelectedRow.ActivityID.toString())),this.ActivityGridData.Remove(this.SelectedRow),this.ActivityGridDataObj.refreshDataView(),K>0&&this.DeletedActivity.push(K)}break;case"Cancel":s.a.page.HideDialog()}Logger.InfoLog("ViewNoteViewModel::Exiting OnCmnItem_Click")}},{key:"ActivitisActualData",value:function(){this.ActivityGridDataObj=new o.a;var t=this.BindActivityGridData();if(this.DS=s.a.cases.GetActivitiesCustomFields(this.CostCenterID,this.NodeID),null!=this.DS&&this.DS.Tables.length>0)for(var e=this.DS.Tables[0],i=0;i<e.length;i++)e[i].SysColumnName.toString().Contains("Alpha")&&"LISTBOX"==e[i].UserColumnType.toString().toUpperCase()?((t=new n.a).Header=e[i].UserColumnName.toString(),t.DisplayMember=e[i].SysColumnName.toString(),t.DataType="ListBox",t.Width=150,t.IsVisible=!0,t.ReadOnly=!0,this.ActivityColumnSource.push(t),this.tempActivityGridDataColumn.push(e[i].SysColumnName.toString()+"_Key"),this.tempActivityGridDataColumn.push(e[i].SysColumnName.toString())):e[i].SysColumnName.toString().Contains("Alpha")&&((t=new n.a).Header=e[i].UserColumnName.toString(),t.DisplayMember=e[i].SysColumnName.toString(),t.DataType="TEXTBOX",t.Width=150,t.IsVisible=!0,t.ReadOnly=!0,this.ActivityColumnSource.push(t),this.tempActivityDataColumn.push(e[i].SysColumnName.toString()),this.tempActivityGridDataColumn.push(e[i].SysColumnName.toString())),e[i].SysColumnName.toString().Contains("CCNID")&&!this.tempActivityGridDataColumn.Contains(e[i].SysColumnName.toString()+"_Key")&&((t=new n.a).Header=e[i].UserColumnName.toString(),t.DisplayMember=e[i].SysColumnName.toString(),t.DataType="ListBox",t.Width=150,t.IsVisible=!0,t.ReadOnly=!0,this.ActivityColumnSource.push(t),this.tempActivityGridDataColumn.push(e[i].SysColumnName.toString()+"_Key"),this.tempActivityGridDataColumn.push(e[i].SysColumnName.toString()))}},{key:"BindActivityGridData",value:function(){var t;return this.ActivityColumnSource=[],(t=new n.a).Header="View",t.DisplayMember="View",t.DataType="LINK",t.Width=70,t.IsVisible=!0,t.ReadOnly=!0,this.ActivityColumnSource.push(t),(t=new n.a).Header="Activity",t.DisplayMember="Activity",t.Width=150,t.IsVisible=!0,t.ReadOnly=!0,this.ActivityColumnSource.push(t),(t=new n.a).Header="Start Date",t.DisplayMember="ActStartDate",t.ValueMember="ActStartDate_Key",t.DataType="TEXTBOX",t.Width=100,t.IsVisible=!0,t.ReadOnly=!0,this.ActivityColumnSource.push(t),(t=new n.a).Header="End Date",t.DisplayMember="ActEndDate",t.ValueMember="ActEndDate_Key",t.DataType="TEXTBOX",t.Width=100,t.IsVisible=!0,t.ReadOnly=!0,this.ActivityColumnSource.push(t),(t=new n.a).Header="Subject",t.DisplayMember="Subject",t.DataType="TEXTBOX",t.Width=150,t.IsVisible=!0,t.ReadOnly=!0,this.ActivityColumnSource.push(t),this.Parent instanceof C&&((t=new n.a).Header="Contact",t.DisplayMember="CRMContactPerson",t.DataType="TEXTBOX",t.Width=120,t.IsVisible=!0,t.ReadOnly=!0,this.ActivityColumnSource.push(t)),(t=new n.a).Header="Status",t.DisplayMember="Status",t.DataType="TEXTBOX",t.Width=60,t.IsVisible=!0,t.ReadOnly=!0,this.ActivityColumnSource.push(t),(t=new n.a).Header="Customer",t.DisplayMember="CustomerID",t.DataType="TEXTBOX",t.Width=150,t.IsVisible=!0,t.ReadOnly=!0,this.ActivityColumnSource.push(t),(t=new n.a).Header="Discussion",t.DisplayMember="Remarks",t.DataType="TEXTBOX",t.Width=200,t.IsVisible=!0,t.ReadOnly=!0,this.ActivityColumnSource.push(t),(t=new n.a).Header="Location",t.DisplayMember="Location",t.DataType="TEXTBOX",t.Width=120,t.IsVisible=!1,t.ReadOnly=!0,this.ActivityColumnSource.push(t),(t=new n.a).Header="Created by",t.DisplayMember="UserName",t.DataType="TEXTBOX",t.Width=150,t.IsVisible=!0,t.ReadOnly=!0,this.ActivityColumnSource.push(t),(t=new n.a).Header="Created Date",t.DisplayMember="CreatedDate",t.DataType="TEXTBOX",t.Width=150,t.IsVisible=!0,t.ReadOnly=!0,this.ActivityColumnSource.push(t),(t=new n.a).Header="Assign User",t.DisplayMember="AssignUser",t.DataType="TEXTBOX",t.Width=150,t.IsVisible=!0,t.ReadOnly=!0,this.ActivityColumnSource.push(t),(t=new n.a).Header="Assign Date",t.DisplayMember="AssignDate",t.DataType="TEXTBOX",t.Width=150,t.IsVisible=!0,t.ReadOnly=!0,this.ActivityColumnSource.push(t),this.tempActivityGridDataColumn.push("View"),this.tempActivityGridDataColumn.push("Activity"),this.tempActivityGridDataColumn.push("Date"),this.tempActivityGridDataColumn.push("Subject"),this.tempActivityGridDataColumn.push("Status"),this.tempActivityGridDataColumn.push("CostCenterID"),this.tempActivityGridDataColumn.push("Schedule"),this.tempActivityGridDataColumn.push("ScheduleID"),this.tempActivityGridDataColumn.push("Recurrence"),this.tempActivityGridDataColumn.push("SchStatus"),this.tempActivityGridDataColumn.push("FreqType"),this.tempActivityGridDataColumn.push("FreqInterval"),this.tempActivityGridDataColumn.push("FreqSubdayType"),this.tempActivityGridDataColumn.push("FreqSubdayInterval"),this.tempActivityGridDataColumn.push("FreqRelativeInterval"),this.tempActivityGridDataColumn.push("FreqRecurrenceFactor"),this.tempActivityGridDataColumn.push("CStartDate"),this.tempActivityGridDataColumn.push("UserName"),this.tempActivityGridDataColumn.push("CEndDate"),this.tempActivityGridDataColumn.push("StartTime"),this.tempActivityGridDataColumn.push("strGroups"),this.tempActivityGridDataColumn.push("strRoles"),this.tempActivityGridDataColumn.push("strUsers"),this.tempActivityGridDataColumn.push("ActivityID"),this.tempActivityGridDataColumn.push("ActivityTypeID"),this.tempActivityGridDataColumn.push("NodeID"),this.tempActivityGridDataColumn.push("StatusID"),this.tempActivityGridDataColumn.push("Location"),this.tempActivityGridDataColumn.push("Priority"),this.tempActivityGridDataColumn.push("PctComplete"),this.tempActivityGridDataColumn.push("IsAllDayActivity"),this.tempActivityGridDataColumn.push("ActualCloseDate"),this.tempActivityGridDataColumn.push("ActualCloseDate_Key"),this.tempActivityGridDataColumn.push("ActualCloseTime"),this.tempActivityGridDataColumn.push("CustomerID"),this.tempActivityGridDataColumn.push("ContactID"),this.tempActivityGridDataColumn.push("Remarks"),this.tempActivityGridDataColumn.push("AssignGroupID"),this.tempActivityGridDataColumn.push("AssignRoleID"),this.tempActivityGridDataColumn.push("AssignUserID"),this.tempActivityGridDataColumn.push("ActStartDate"),this.tempActivityGridDataColumn.push("ActEndDate"),this.tempActivityGridDataColumn.push("ActStartDate_Key"),this.tempActivityGridDataColumn.push("ActEndDate_Key"),this.tempActivityGridDataColumn.push("ActStartTime"),this.tempActivityGridDataColumn.push("ActEndTime"),this.tempActivityGridDataColumn.push("UsersXML"),this.tempActivityGridDataColumn.push("RolesXML"),this.tempActivityGridDataColumn.push("GroupXML"),this.tempActivityGridDataColumn.push("TeamNodeID"),this.tempActivityGridDataColumn.push("UserID"),this.tempActivityGridDataColumn.push("isTeam"),this.tempActivityGridDataColumn.push("isEdited"),this.tempActivityGridDataColumn.push("SchID"),this.tempActivityGridDataColumn.push("AttachmentXML"),this.tempActivityGridDataColumn.push("CreatedDate"),this.tempActivityGridDataColumn.push("CreatedDate_Key"),this.tempActivityGridDataColumn.push("AssignUser"),this.tempActivityGridDataColumn.push("AssignDate"),this.tempActivityGridDataColumn.push("EndDateTime"),this.tempActivityGridDataColumn.push("EndDateTime_Key"),this.tempActivityGridDataColumn.push("StartDateTime"),this.tempActivityGridDataColumn.push("StartDateTime_Key"),this.tempActivityGridDataColumn.push("TotalDuration"),this.tempActivityGridDataColumn.push("LastStartDate"),this.Parent instanceof C&&this.tempActivityGridDataColumn.push("CRMContactPerson"),t}},{key:"OnButtonClick",value:function(t){s.a.page.HideDialog()}},{key:"onStatusSelectedChanged",value:function(t){if(null!=t&&null!=t){"-1"==t.toString()?(this.FilterStatus="",this.ActivityGridData[0]):"1"==t.toString()?(this.FilterStatus="412",this.ActivityGridData.filter((function(t){return"412"==t.schStatus}))):"2"==t.toString()?(this.FilterStatus="413",this.ActivityGridData.filter((function(t){return"413"==t.schStatus}))):"3"==t.toString()?(this.FilterStatus="414",this.ActivityGridData.filter((function(t){return"414"==t.schStatus}))):(this.FilterStatus="8",this.ActivityGridData.filter((function(t){return"8"==t.schStatus})))}}},{key:"LoadActivityData",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=s.a.empService.GetQueryData(0,"dsetAssignedList",this.CostCenterID,this.NodeID,"");if(this.ActivityGridDataObj.Clear(),null!=t&&0!=t.length){(""==i?t:t.filter(i)).forEach((function(t){var i=e.ActivityGridDataObj.NewRow();i.View="View",i.ScheduleID=t.ScheduleID,i.SchID=t.ScheduleID,i.FreqType=t.FreqType,i.FreqInterval=t.FreqInterval,i.FreqSubdayType=t.FreqSubdayType,i.FreqSubdayInterval=t.FreqSubdayInterval,i.FreqRelativeInterval=t.FreqRelativeInterval,i.FreqRecurrenceFactor=t.FreqRecurrenceFactor,i.CStartDate=t.CStartDate,i.CEndDate=t.CEndDate,i.StartTime=t.StartTime,i.ActivityID=t.ActivityID,i.ActivityTypeID=a.e.String(t.ActivityTypeID),i.CostCenterID=89,i.NodeID="1",i.SchStatus=t.ActStatus.toString(),i.Subject=e.GetValidXmlReserve(t.ActSubject.toString()),i.Priority=a.e.String(t.Priority),i.PctComplete=a.e.String(t.PctComplete),i.Location=a.e.String(t.Location),i.IsAllDayActivity=t.IsAllDayActivity.toString().toUpperCase()=="True".toUpperCase()?"1":"0",i.ActualCloseDate=a.e.String(t.ActualCloseDate),i.ActualCloseTime=a.e.String(t.ActualCloseTime),i.CustomerID=e.GetValidXmlReserve(t.CustomerID.toString()),null!=t.CRMContactPerson&&i.CRMContactPerson&&(i.CRMContactPerson=t.CRMContactPerson.toString()),i.ContactID=t.ContactID?e.GetValidXmlReserve(t.ContactID.toString()):0,i.Remarks=e.GetValidXmlReserve(t.Remarks.toString()),null==t.UserName||a.e.IsEmpty(t.UserName)||(i.UserName=t.UserName.toString()),i.AssignGroupID="1",i.AssignRoleID="1",i.AssignUserID=a.e.String(t.AssignUserID),null!=t.CreatedDate&&(i.CreatedDate=new Date(t.CreatedDate).ToString(s.a.SessionManager.Preferences["Date Format"].toString()),i.CreatedDate_Key=new Date(t.CreatedDate)),a.e.IsEmpty(t.StartDateTime)||(i.StartDateTime=new Date(t.StartDateTime).ToString(s.a.SessionManager.Preferences["Date Format"].toString()),i.StartDateTime_Key=new Date(t.StartDateTime)),a.e.IsEmpty(t.EndDateTime)||(i.EndDateTime=new Date(t.EndDateTime).ToString(s.a.SessionManager.Preferences["Date Format"].toString()),i.EndDateTime_Key=new Date(t.EndDateTime)),a.e.IsEmpty(t.TotalDuration)||(i.TotalDuration=t.TotalDuration.toString()),a.e.IsEmpty(t.LastStartDate)||(i.LastStartDate=new Date(t.LastStartDate.toString())),a.e.IsEmpty(t.ActStartDate)||(i.ActStartDate=new Date(t.ActStartDate).ToString(s.a.SessionManager.Preferences["Date Format"].toString()),i.ActStartDate_Key=new Date(t.ActStartDate)),a.e.IsEmpty(t.ActEndDate)||(i.ActEndDate=new Date(t.ActEndDate).ToString(s.a.SessionManager.Preferences["Date Format"].toString()),i.ActEndDate_Key=new Date(t.ActEndDate)),a.e.IsEmpty(t.ActStartTime)||(i.ActStartTime=t.ActStartTime),a.e.IsEmpty(t.ActEndTime)||(i.ActEndTime=t.ActEndTime),"1"==a.e.String(t.ActivityTypeID)?i.Activity="Appointment Regular":"2"==a.e.String(t.ActivityTypeID)?i.Activity="Task Regular":"3"==a.e.String(t.ActivityTypeID)?i.Activity="Appointment Recurring":"3"==a.e.String(t.ActivityTypeID)&&(i.Activity="Task Recurring"),a.e.IsEmpty(t.ActualCloseDate)||(i.ActualCloseDate=new Date(t.ActualCloseDate.toString()).ToString(s.a.SessionManager.Preferences["Date Format"].toString()),i.ActualCloseDate_Key=new Date(t.ActualCloseDate)),i.Subject=e.GetValidXmlReserve(t.ActSubject.toString()),"412"==a.e.String(t.ActStatus)?i.Status="Open":"413"==a.e.String(t.ActStatus)?i.Status="Close":"414"==a.e.String(t.ActStatus)?i.Status="Re-Schedule":"8"==a.e.String(t.ActStatus)?i.Status="Confirmed":"9"==a.e.String(t.ActStatus)?i.Status="In-Progress":"12"==a.e.String(t.ActStatus)&&(i.Status="On-Hold");for(var r=0;r<e.tempActivityGridDataColumn.length;r++)e.tempActivityGridDataColumn[r].toLowerCase().Contains("alpha")&&Object.keys(t).Contains(e.tempActivityGridDataColumn[r])?i[e.tempActivityGridDataColumn[r]]=e.GetValidXmlReserve(t[e.tempActivityGridDataColumn[r]].toString()):e.tempActivityGridDataColumn[r].toUpperCase().Contains("CCNID")&&Object.keys(t).Contains(e.tempActivityGridDataColumn[r])&&Object.keys(t).Contains(e.tempActivityGridDataColumn[r]+"_Key")&&(i[e.tempActivityGridDataColumn[r]+"_Key"]=e.GetValidXmlReserve(t[e.tempActivityGridDataColumn[r]+"_Key"].toString()),i[e.tempActivityGridDataColumn[r]+""]=e.GetValidXmlReserve(t[e.tempActivityGridDataColumn[r]].toString()));var o="",l="",h="";if(null!=n&&n.Tables.length>0&&n.Tables[0].length>0){var u=n.Tables[0];if(null!=u&&null!=u){if((u=u.filter((function(e){return e.ISFROMACTIVITY==t.ActivityID&&e.USERID>1&&0==e.TeamNodeID}))).length>0)for(var d=0;d<u.length;d++)o+=u[d].USERID.toString()+",";if(i.UsersXML=o.Trim(","),(u=(u=n.Tables[0]).filter((function(e){return e.ISFROMACTIVITY==t.ActivityID&&"True"==e.IsGroup}))).length>0)for(var m=0;m<u.length;m++)h+=u[m].TeamNodeID.toString()+",";if(i.GroupXML=h.Trim(","),(u=(u=n.Tables[0]).filter((function(e){return e.ISFROMACTIVITY==t.ActivityID&&"True"==e.IsRole}))).length>0)for(var S=0;S<u.length;S++)l+=u[S].TeamNodeID.toString()+",";i.RolesXML=l.Trim(","),(u=(u=n.Tables[0]).filter((function(e){return e.ISFROMACTIVITY==t.ActivityID&&e.TeamNodeID>1&&"True"==e.isTeam}))).length>0&&(i.TeamNodeID=u[0].TeamNodeID.toString(),i.isTeam="1"),(u=(u=n.Tables[0]).filter((function(e){return e.ISFROMACTIVITY==t.ActivityID&&e.TeamNodeID>1&&e.UserID>0}))).length>0&&(i.TeamNodeID=u[0].TeamNodeID.toString(),i.isTeam="0",i.UserID=u[0].UserID.toString())}if(n.Tables.length>2){var y=n.Tables[2];null!=y&&null!=y&&(o="",y[0].ISFROMACTIVITY&&((y=y.filter((function(e){return e.ISFROMACTIVITY==t.ActivityID}))).length>0&&(i.AssignUser=y[0].UserData.toString(),a.e.IsEmpty(y[0].ActAssignDate)||(i.AssignDate=new Date(y[0].ActAssignDate).ToString(s.a.SessionManager.Preferences["Date Format"].toString()+" hh:mm:ss tt")))))}}if(null!=n&&n.Tables.length>0&&n.Tables[1].length>0){var D=n.Tables[1];if(null!=D&&null!=D){var A="";if((D=D.filter((function(e){return 144==e.FeatureID&&e.FeaturePK==t.ActivityID}))).length>0){for(var C=0;C<D.length;C++)A+='<Row Action="MODIFY"',A+=' AttachmentID="'+D[C].FileID.toString()+'"',A+=' ActualFileName="'+D[C].ActualFileName.toString()+'"',A+=' RelativeFileName="'+D[C].RelativeFileName.toString()+'"',A+=' FileExtension="'+D[C].FileExtension+'"',A+=' GUID="'+D[C].GUID+'"',A+=' FileDescription="'+c.d.GetValidXml(D[C].FileDescription.toString())+'" ',A+=' IsProductImage="0"',!n.Columns[1].Contains("IsSign")||a.e.IsEmpty(D[C].IsSign)||"true"!=D[C].IsSign.toString().toLowerCase()&&"1"!=D[C].IsSign.toString()||(A+=' IsSign="1"'),A+="/>";A.length>0&&(A="<AttachmentsXML>"+A+"</AttachmentsXML>",i.AttachmentXML=A.toString())}}}e.ActivityGridDataObj.addRow(i)})),null!=this.SelectedRow&&(this.SelectedRow=null),null!=this.Activities&&(this.Activities.ClearFields(),this.Activities.OneActivity&&this.ActivityGridDataObj.Table.length>0&&(this.SelectedRow=this.ActivityGridDataObj.Table[0],this.OnCmnItem_Click("EDIT","EDIT")))}}},{key:"GetValidXmlReserve",value:function(t){return(t=(t=(t=t.Replace("&amp;","&")).Replace("''","'")).Replace("&quot;",'"')).Replace("&lt;","<")}},{key:"ActivitiesXML",value:function(){var t,e=this,i="";i+="<ScheduleActivityXml>";var s=1,n="";(null===(t=this.Activities)||void 0===t?void 0:t.OneActivity)&&this.Activities.onSaveActivity("Save"),this.ActivityGridDataObj.Table.forEach((function(t){if(!a.e.StringIsNullOrEmpty(t.Activity)){if(i+="<Row ",a.e.IsEmpty(t.ActivityID)||"0"==a.e.String(t.ActivityID)?(i+=' rowno="'+s+'" ',i+=' ActivityID="'+a.e.String(t.ActivityID)+'" ',s++):(i+=' rowno="0" ',i+=' ActivityID="'+a.e.String(t.ActivityID)+'"'),i+=' ScheduleID="'+a.e.String(t.ScheduleID)+'"',i+=' SchID="'+a.e.String(t.SchID)+'"',i+=' Status=""',i+=' FreqType="'+a.e.String(t.FreqType)+'"',i+=' FreqInterval="'+a.e.String(t.FreqInterval)+'"',i+=' FreqSubdayType="'+a.e.String(t.FreqSubdayType)+'"',i+=' FreqSubdayInterval="'+a.e.String(t.FreqSubdayInterval)+'"',i+=' FreqRelativeInterval="'+a.e.String(t.FreqRelativeInterval)+'"',i+=' FreqRecurrenceFactor="'+a.e.String(t.FreqRecurrenceFactor)+'"',""==a.e.String(t.CStartDate)?i+=' CStartDate=""':i+=' CStartDate="'+new Date(a.e.String(t.CStartDate)).ToString("dd/MMM/yyyy")+'"',""!=a.e.String(t.CEndDate)?i+=' CEndDate="'+new Date(a.e.String(t.CEndDate)).ToString("dd/MMM/yyyy")+'"':i+=' CEndDate=""',""==a.e.String(t.StartTime))i+=' StartTime=""';else{var r=new Date(a.e.String(t.StartTime));i+=' StartTime="'+r.getHours().PrefixZero(2)+":"+r.getMinutes().PrefixZero(2)+":"+r.getSeconds().PrefixZero(2)+'"'}"3"==a.e.String(t.ActivityTypeID)||"4"==a.e.String(t.ActivityTypeID)?(i+=' isRecu="1"',i+=' ActivityTypeID="'+a.e.String(t.ActivityTypeID)+'"'):(i+=' isRecu="0"',i+=' ActivityTypeID="'+a.e.String(t.ActivityTypeID)+'"'),i+=' CostCenterID="'+e.CostCenterID+'"',i+=' NodeID="'+e.NodeID+'"',i+=' StatusID="'+a.e.String(t.schStatus)+'"',i+=' Subject="'+e.GetValidXml(a.e.String(t.Subject))+'"',i+=' Priority="'+a.e.String(t.Priority)+'"',i+=' PctComplete="'+a.e.String(t.PctComplete)+'"',i+=' Location="'+e.GetValidXml(a.e.String(t.Location))+'"',i+=' IsAllDayActivity="'+("TRUE"==a.e.String(t.IsAllDayActivity).toUpperCase()?"1":"0")+'"';var o=new Date;if(a.e.IsEmpty(t.ActualCloseDate_Key))i+=' ActualCloseDate=""';else{try{o=new Date(a.e.String(t.ActualCloseDate_Key))}catch(h){}i+=' ActualCloseDate="'+o.ToString("dd/MMM/yyyy")+'"'}if(""==a.e.String(t.ActualCloseTime))i+=' ActualCloseTime=""';else{try{o=new Date(a.e.String(t.ActualCloseTime))}catch(h){}i+=' ActualCloseTime="'+o.ToString("dd/MMM/yyyy hh:mm:ss")+'"'}i+=' CustomerID="'+e.GetValidXml(a.e.String(t.CustomerID))+'"',null!=t.ContactID&&(i+=' ContactID="'+e.GetValidXml(a.e.String(t.ContactID))+'"'),i+=' Remarks="'+e.GetValidXml(a.e.String(t.Remarks))+'"',i+=' AssignGroupID="1"',i+=' AssignRoleID="1"',i+=' AssignUserID="'+a.e.String(t.AssignUserID)+'"',i+=' ActStartDate="'+new Date(a.e.String(t.ActStartDate_Key)).ToString("dd/MMM/yyyy")+'"',i+=' ActEndDate="'+new Date(a.e.String(t.ActEndDate_Key)).ToString("dd/MMM/yyyy")+'"',i+=' ActStartTime="'+a.e.String(t.ActStartTime)+'"',i+=' ActEndTime="'+a.e.String(t.ActEndTime)+'"',i+=' UsersXML="'+a.e.String(t.UsersXML)+'"',i+=' RolesXML="'+a.e.String(t.RolesXML)+'"',i+=' GroupXML="'+a.e.String(t.GroupXML)+'"',i+=' TeamNodeID="'+a.e.String(t.TeamNodeID)+'"',i+=' UserID="'+a.e.String(t.UserID)+'"',i+=' isTeam="'+a.e.String(t.isTeam)+'"';for(var l=1;l<=50;l++)e.tempActivityGridDataColumn.Contains("Alpha"+l)&&(n+="Alpha"+l+"='"+e.GetValidXml(a.e.String(t["Alpha"+l]))+"' ,");for(var c=1;c<=50;c++)e.tempActivityGridDataColumn.Contains("CCNID"+c)&&""!=a.e.String(t["CCNID"+c+"_Key"])&&(n+="CCNID"+c+"='"+("0"==a.e.String(t["CCNID"+c+"_Key"])?"1":a.e.String(t["CCNID"+c+"_Key"]))+"' ,");""!=n&&(i+=' ExtraUserDefinedFields ="'+n.substr(0,n.length-2)+'" '),i+=' AttachmentXML ="'+e.EncodedXMLString(a.e.String(t.AttachmentXML))+'" ',n="",null==t.isEdited||a.e.IsEmpty(t.isEdited)?i+=' isEdited="0"':i+=' isEdited="1"',i+="/>"}}));for(var r=0;r<this.DeletedActivity.length;r++)i+='<DeleteRow Action="DELETE"',i+=' ActivityID="'+this.DeletedActivity[r].toString()+'"/>';return(i+="</ScheduleActivityXml>").toString()}},{key:"FMActivitiesXML",value:function(t){var e="";e+="<ScheduleActivityXml>";var i=1,s="";if(this.ActivityGridData.length>0&&!a.e.IsEmpty(this.ActivityGridData[t].activity)){if(e+="<Row ","0"==this.ActivityGridData[t].ActivityID.toString()||""==this.ActivityGridData[t].ActivityID.toString()?(e+=' rowno="'+i+'" ',e+=' ActivityID="'+this.ActivityGridData[t].ActivityID.toString()+'" ',i++):(e+=' rowno="0" ',e+=' ActivityID="'+this.ActivityGridData[t].ActivityID+'"'),e+=' ScheduleID="'+a.e.String(this.ActivityGridData[t].ScheduleID)+'"',e+=' SchID="'+a.e.String(this.ActivityGridData[t].SchID)+'"',e+=' Status=""',e+=' FreqType="'+a.e.String(this.ActivityGridData[t].FreqType)+'"',e+=' FreqInterval="'+a.e.String(this.ActivityGridData[t].FreqInterval)+'"',e+=' FreqSubdayType="'+a.e.String(this.ActivityGridData[t].FreqSubdayType)+'"',e+=' FreqSubdayInterval="'+a.e.String(this.ActivityGridData[t].FreqSubdayInterval)+'"',e+=' FreqRelativeInterval="'+a.e.String(this.ActivityGridData[t].FreqRelativeInterval)+'"',e+=' FreqRecurrenceFactor="'+a.e.String(this.ActivityGridData[t].FreqRecurrenceFactor)+'"',""==a.e.String(this.ActivityGridData[t].CStartDate)?e+=' CStartDate=""':e+=' CStartDate="'+new Date(this.ActivityGridData[t].CStartDate).ToString("dd/MMM/yyyy")+'"',""!=this.ActivityGridData[t].CEndDate.toString()?e+=' CEndDate="'+new Date(this.ActivityGridData[t].CEndDate).ToString("dd/MMM/yyyy")+'"':e+=' CEndDate=""',""==a.e.String(this.ActivityGridData[t].StartTime))e+=' StartTime=""';else{var n=new Date(this.ActivityGridData[t].StartTime);e+=' StartTime="'+n.getHours().ToString("00")+":"+n.getMinutes().ToString("00")+":"+n.getSeconds().ToString("00")+'"'}"3"==this.ActivityGridData[t].ActivityTypeID.toString()||"4"==this.ActivityGridData[t].ActivityTypeID.toString()?(e+=' isRecu="1"',e+=' ActivityTypeID="'+this.ActivityGridData[t].ActivityTypeID.toString()+'"'):(e+=' isRecu="0"',e+=' ActivityTypeID="'+this.ActivityGridData[t].ActivityTypeID.toString()+'"'),e+=' CostCenterID="'+this.CostCenterID+'"',e+=' NodeID="'+this.NodeID+'"',e+=' StatusID="'+this.ActivityGridData[t].schStatus.toString()+'"',e+=' Subject="'+this.GetValidXml(this.ActivityGridData[t].Subject.toString())+'"',e+=' Priority="'+this.ActivityGridData[t].Priority.toString()+'"',e+=' PctComplete="'+this.ActivityGridData[t].PctComplete.toString()+'"',e+=' Location="'+this.GetValidXml(this.ActivityGridData[t].Location.toString())+'"',e+=' IsAllDayActivity="'+("TRUE"==this.ActivityGridData[t].IsAllDayActivity.toString().toUpperCase()?"1":"0")+'"';var r=new Date;if(""==this.ActivityGridData[t].ActualCloseDate_Key.toString())e+=' ActualCloseDate=""';else{try{r=new Date(this.ActivityGridData[t].ActualCloseDate_Key)}catch(h){}e+=' ActualCloseDate="'+r.getDate().ToString("dd/MMM/yyyy")+'"'}if(""==a.e.String(this.ActivityGridData[t].ActualCloseTime))e+=' ActualCloseTime=""';else{try{r=new Date(this.ActivityGridData[t].ActualCloseTime)}catch(h){}e+=' ActualCloseTime="'+r.ToString("dd/MMM/yyyy hh:mm:ss")+'"'}e+=' CustomerID="'+this.GetValidXml(this.ActivityGridData[t].CustomerID.toString())+'"',this.tempActivityGridDataColumn.Contains("ContactID")&&(e+=' ContactID="'+this.GetValidXml(this.ActivityGridData[t].ContactID.toString())+'"'),e+=' Remarks="'+this.GetValidXml(this.ActivityGridData[t].Remarks.toString())+'"',e+=' AssignGroupID="1"',e+=' AssignRoleID="1"',e+=' AssignUserID="'+this.ActivityGridData[t].AssignUserID.toString()+'"',e+=' ActStartDate="'+new Date(this.ActivityGridData[t].ActStartDate_Key.toString()).ToString("dd/MMM/yyyy")+'"',e+=' ActEndDate="'+new Date(this.ActivityGridData[t].ActEndDate_Key.toString()).ToString("dd/MMM/yyyy")+'"',e+=' ActStartTime="'+this.ActivityGridData[t].ActStartTime.toString()+'"',e+=' ActEndTime="'+this.ActivityGridData[t].ActEndTime.toString()+'"',e+=' UsersXML="'+this.ActivityGridData[t].UsersXML.toString()+'"',e+=' RolesXML="'+this.ActivityGridData[t].RolesXML.toString()+'"',e+=' GroupXML="'+this.ActivityGridData[t].GroupXML.toString()+'"',e+=' TeamNodeID="'+this.ActivityGridData[t].TeamNodeID.toString()+'"',e+=' UserID="'+this.ActivityGridData[t].UserID.toString()+'"',e+=' isTeam="'+this.ActivityGridData[t].isTeam.toString()+'"';for(var o=1;o<=50;o++)this.tempActivityGridDataColumn.Contains("Alpha"+o)&&(s+="Alpha"+o+"='"+this.GetValidXml(this.ActivityGridData[t]["Alpha"+o].toString())+"' ,");for(var l=1;l<=50;l++)this.tempActivityGridDataColumn.Contains("CCNID"+l)&&""!=this.ActivityGridData[t]["CCNID"+l+"_Key"].toString()&&(s+="CCNID"+l+"='"+("0"==this.ActivityGridData[t]["CCNID"+l+"_Key"].toString()?"1":this.ActivityGridData[t]["CCNID"+l+"_Key"].toString())+"' ,");""!=s&&(e+=' ExtraUserDefinedFields ="'+s.substr(0,s.length-2)+'" '),e+=' AttachmentXML ="'+this.EncodedXMLString(this.ActivityGridData[t].AttachmentXML.toString())+'" ',s="",this.tempActivityGridDataColumn.Contains("isEdited")&&null!=this.ActivityGridData[t].isEdited&&""!=this.ActivityGridData[t].isEdited.toString()?e+=' isEdited="1"':e+=' isEdited="0"',e+="/>"}for(var c=0;c<this.DeletedActivity.length;c++)e+='<DeleteRow Action="DELETE"',e+=' ActivityID="'+this.DeletedActivity[c].toString()+'"/>';return(e+="</ScheduleActivityXml>").toString()}},{key:"EncodedXMLString",value:function(t){return a.e.IsEmpty(t)?"":t.replace("&","&amp;").replace("<","&lt;").replace(">","&gt;").replace('"',"&quot;")}},{key:"GetValidXml",value:function(t){return(t=(t=(t=t.Replace("&","&amp;")).Replace("'","&apos;&apos;")).Replace('"',"&quot;")).Replace("<","&lt;")}},{key:"returnTimeString",value:function(t){return t.length>1?t:("0"+t).toString()}},{key:"angularGrid",get:function(){return this.ActivityGridDataObj.angularGrid}},{key:"ActivityGridData",get:function(){return this.ActivityGridDataObj.Table}},{key:"ActivityColumnSource",get:function(){return this.ActivityGridDataObj.Columns},set:function(t){this.ActivityGridDataObj.Columns=t}},{key:"ActivityColumn",get:function(){return this.ActivityGridDataObj.TableColumns}},{key:"SelectedRow",get:function(){return this.ActivityGridDataObj.SelectedItem},set:function(t){this.ActivityGridDataObj.SelectedItem=t}},{key:"contextVisible",get:function(){return this.ActivityGridDataObj.contextVisible},set:function(t){this.ActivityGridDataObj.contextVisible=t}}]),t}(),C=function t(){_classCallCheck(this,t),this.CostCenterID=0,this.NodeID=0,this.ActVisibility=!1,this.TextFields=[]}},DKUf:function(t,e,i){"use strict";i.d(e,"a",(function(){return w}));var s=i("mrSG"),a=i("Do2H"),n=i("Lp6j"),r=i("eQJW"),o=i("xnJf"),l=i("8B8H"),c=i("4HhE"),h=i("EQd/"),u=i("0/4Q"),d=i("JIg3"),m=i("wlFP"),S=i("n56n"),y=i("CQvG"),D=i("NkMH"),A=i("OvA8"),C=i("Jnyl"),v=i("3Pt+"),p=i("ScVY"),b=i("OQq8"),g=i("ThyT"),T=i("SLWk"),I=i("ockk"),R=i("9WDa"),V=i("bgvB"),f=i("C58A"),w=function(t){_inherits(p,t);var e=_createSuper(p);function p(t,i){var s;return _classCallCheck(this,p),(s=e.call(this)).Module="CASES",s.ClassName="ActivitiesViewModel",s.Visible=!0,s.ActivityOnScreen=!1,s.OneActivity=!1,s.AttachmentVisibility=!1,s.ViewAttachVisible=!1,s.ActivityDrawView=!1,s.ActSign=new V.c(0),s.tempActivitiesTempGridCol=[],s.ActVisibile=!0,s.FeatureWiseLable=new b.a,s.InviteLabel=new b.a,s.Fields=[],s.ColumnSpan="4",s.res="",s._ActivityID=0,s.ActivityText=new h.d(25130),s.Subject=new h.d(25135),s.Priority=new u.e(25136),s.Location=new h.d(25138),s.AssignUserList=new u.e(25144),s.PctComplete=new h.d(25137),s.StartDate=new d.a(26020),s.EndDate=new d.a(26021),s.StartTime=new u.e(25948),s.EndTime=new u.e(25949),s.IsAllDayActivity=new m.a(25139),s.ActualCloseDate=new d.a(25140),s.CRMCustomer=new S.c(25141),s.Remarks=new h.d(25142),s.HistoryVisibility=!0,s.ActivitiesVisibility=!0,s._AssignVisiblity=!0,s.Enabled=!0,s.AssignVisiblity2=!1,s.HeaderVisible=!0,s.ButtonsVisible=!0,s.RecrVisible=!1,s.CRMContactPerson=new S.b(0),s.CustomerType=new u.e(0),s.ActualCloseTime=new u.e(0),s.ActivityFrequency=new c.b,s.CustomerChangeCommand=new c.b,s.ActivityTypeSelectedChanged=new c.b,s.SaveActivity=new c.b,s.CancelActivity=new c.b,s.ViewHistory=new c.b,s.StatusSelectedChanged=new c.b,s.Click=new c.b,s.TimeChanged=new c.b,s.DateChanged=new c.b,s.dtPreferences=null,s.StatusVisible=!0,s.Status=new u.e(0),s.CheckdRecurPattern=0,s.CheckdMonthlyEvery=0,s.CheckdRangeEnd=0,s.Selectedrow=null,s._StatusSelectedText="0",s._StatusSelectedValue="412",s.FeatureLable="",s.CostCenterID=0,s.Width="230",s._IsPopup=!1,s.DisableCCFields=!0,s.UseActivityQuickAdd=!1,s.NodeID=0,s.ActVisibility=!1,s._SelectedStatusIndex=0,s.dr={},s.ActStartDate=new d.c(0),s.ActEndDate=new d.c(0),s.ActivityDuration="",s.ActStartTime=new u.e(0),s.ActEndTime=new u.e(0),s.StartVisible=!1,s.StopVisible=!1,s.HoldVisible=!1,s.StartStopVisible=!1,s.oText=null,s.oDate=null,s.oCombo=null,s.oTextArea=null,s.OComboText=null,s.oTime=null,s.FromCalendar=!1,s.TotalDuration=0,s.laststartdate=null,s.durtimer=null,s.Hrs=0,s.min=0,s.sec=0,s.SchID=-1e3,s.isView=!1,s.Customize=!1,s.objParent=t,s.ViewAttachments=new A.ViewAttachmentViewModel(_assertThisInitialized(s)),s.Title=a.a.GetResource("Activities"),s.form=new v.j({}),s.dtPreferences=a.a.empService.GetQueryData(0,"ActivityPref","","",""),s.Exp=new h.d,s.Exp.DefaultValue="Test",s.InitCombobox(),s.InviteLabel.Visible=!1,s.FromCalendar=i,s.ActivityFrequency.Subscribe(_assertThisInitialized(s),"onActivityFrequancy"),s.CustomerType.SelectionChangedCommand.Subscribe(_assertThisInitialized(s),"OnCustomerTypeChange"),s.Recur=new f.RecurAppointmentViewModel(_assertThisInitialized(s)),s.ActivitiesTempGrid=new l.a,s.AddActivityTempGridColumns(),s.Exp.Visible=!0,s.CRMCustomer.Text="",s.CRMCustomer.Code.SelectionChangedCommand.Subscribe(_assertThisInitialized(s),"onCustomerSelectionChange","Customer"),s.CRMContactPerson.CCID=65,s.CRMContactPerson.TypeID=1,s.SelectedStatusIndex=0,s.ActivityType.SelectedIndex=0,s.Exp.Visible=!1,s.ActSign.Visible=!1,s.PctComplete.Visible=!1,s.Priority.Visible=!1,s.ActivityText.Visible=!1,s.Location.Visible=!0,s.ActualCloseDate.Visible=!1,s.ActualCloseTime.Visible=!1,s.DateChanged.Subscribe(_assertThisInitialized(s),"OnStartDateChange"),s.Click.Subscribe(_assertThisInitialized(s),"OnClick"),s.TimeChanged.Subscribe(_assertThisInitialized(s),"OnTimeChanged"),s.ViewHistory.Subscribe(_assertThisInitialized(s),"onViewHistory"),s.AssignUserList.SelectedValue=a.a.SessionManager.UserID.toString(),s.ButtonSave=new D.a,s.ButtonCustomize=new D.a,s.ButtonAttachments=new D.a,s.ButtonReschedule=new D.a,s.CustomerType.SelectedValue="0",s.OnCustomerTypeChange(null),s.Remarks.RowSpan=4,s.AssignUserList.Enable=a.a.SessionManager.IsActionAssigned(1e3,"Assign"),s.AssignUserList.Enable?s.LoadAssignedUsers():(s.AssignUserList.Items.push(u.d.ComboBoxItems_2(a.a.SessionManager.UserName,a.a.SessionManager.UserID.toString())),s.AssignUserList.SelectedValue=a.a.SessionManager.UserID.toString()),s.buttonsAction(),s.CustomerType.Visible=!1,s.CRMCustomer.Visible=!0,s.CustomerType.Visible=null!=s.objParent&&1e3==s.objParent.CostCenterID,s.LoadData(t),s.enablecontrols(!0),s.FeatureWiseLable=new b.a,s.FeatureWiseLable.ClickCommand.Subscribe(_assertThisInitialized(s),"OnFeatureLableClick"),s.InviteLabel.ClickCommand.Subscribe(_assertThisInitialized(s),"OnFeatureLableClick"),s.FromCalendar?(s.FeatureWiseLable.Visible=!0,s.FeatureWiseLable.Label="test",s.FeatureWiseLable.DBColumnName="1",s.FeatureWiseLable.FeatureID=t.CostCenterID):s.FeatureWiseLable.Visible=!1,null!=s.objParent&&s.objParent.NodeID>0&&s.FilterSupplierBasedonCRMProduct(s.objParent.CostCenterID,s.objParent.NodeID),s}return _createClass(p,[{key:"OnShowAttachment",value:function(){}},{key:"OnAddAttachment",value:function(){this.Attachment=new o.AddAttachmentViewModel,this.Attachment.AddAttachmentViewModel_2(this)}},{key:"OnMessageCallBack",value:function(){this.res="Yes"}},{key:"OnSave",value:function(){Logger.InfoLog("AssignViewModel::Entering Save"),Logger.InfoLog("AssignViewModel::Exiting Save")}},{key:"SetErroMessage",value:function(t){}},{key:"onActivityTypeSelectedChanged",value:function(t){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=this.ActivityType.SelectedValue){t.next=2;break}return t.abrupt("return",(this.Exp.Visible=!1,this.PctComplete.Visible=!1,this.Priority.Visible=!1,this.ActivityText.Visible=!1,void(this.Location.Visible=!0)));case 2:"1"==this.ActivityType.SelectedValue||"2"==this.ActivityType.SelectedValue?(this.Exp.Visible=!1,this.PctComplete.Visible=!1,this.Priority.Visible=!1,this.StartDate.Visible=!0,this.EndDate.Visible=!0,this.EndTime.Visible=!0,this.StartTime.Visible=!0,this.Location.Visible=!0,this.ActivityText.Visible=!1):"3"!=this.ActivityType.SelectedValue&&"4"!=this.ActivityType.SelectedValue||(this.Exp.Visible=!0,this.AssignRowColumns(),this.PctComplete.Visible=!1,this.Priority.Visible=!1,this.StartDate.Visible=!1,this.EndDate.Visible=!1,this.EndTime.Visible=!1,this.StartTime.Visible=!1,this.Location.Visible=!0,this.ActivityText.Visible=!0,this.Recur=new f.RecurAppointmentViewModel(this),this.ActivityText.Text="");case 3:case"end":return t.stop()}}),t,this)})))}},{key:"LoadCustomFields",value:function(t){var e=a.a.cases.GetActivitiesCustomFields(t);this.LoadCustomFields_DS(e)}},{key:"LoadCustomFields_DS",value:function(t){var e=this;this.Fields.Clear();var i=0,s=0,o=0,l="";if(null!=t&&t.Tables.length>3&&t.Tables[3].length>0){var c=t.Tables[3].filter((function(t){return"ActivityAsPopUp"==t.Name}));this._IsPopup=c.length>0&&!n.e.IsEmpty(c[0].Value)&&Object(r.j)(c[0].Value.toString()),(c=t.Tables[3].filter((function(t){return"DisableDimensionsatActivities"==t.Name}))).length>0&&!n.e.IsEmpty(c[0].Value)&&(this.DisableCCFields=Object(r.j)(c[0].Value.toString())),(c=t.Tables[3].filter((function(t){return"ActivityFields"==t.Name}))).length>0&&!n.e.IsEmpty(c[0].Value)&&(l=c[0].Value.toString()),(c=t.Tables[3].filter((function(t){return"UseActivityQuickAdd"==t.Name}))).length>0&&!n.e.IsEmpty(c[0].Value)&&(this.UseActivityQuickAdd=Object(r.j)(c[0].Value.toString()))}if(null!=this.objParent&&this.objParent instanceof y.a?this._IsPopup=!0:null==this.objParent||"QuickAddLeads"!=this.objParent.ClassName&&"QuickAddCaseViewModel"!=this.objParent.ClassName||(this._IsPopup=!1),i=0,this.IsPopup?(s=6,o=1):(s=14,o=4),null!=t&&t.Tables.length>0){for(var m=0;m<t.Tables[0].length;m++){if("TEXT"==t.Tables[0][m].UserColumnType.toString()||"NUMERIC"==t.Tables[0][m].UserColumnType.toString())"true"==t.Tables[0][m].Iscolumninuse.toString().toLowerCase()&&"true"==t.Tables[0][m].IsColumnUserDefined.toString().toLowerCase()&&(this.oText=new h.d(0),this.oText.Label=t.Tables[0][m].UserColumnName.toString(),this.oText.DBColumnName=t.Tables[0][m].CostCenterColID.toString(),this.oText.SysColumnName=t.Tables[0][m].SysColumnName.toString(),this.oText.Row=s,this.oText.Column=i,this.oText.ColumnSpan=o),this.Fields.push(this.oText);else if("DATE"==t.Tables[0][m].UserColumnType.toString())"true"==t.Tables[0][m].Iscolumninuse.toString().toLowerCase()&&"true"==t.Tables[0][m].IsColumnUserDefined.toString().toLowerCase()&&(this.oDate=new d.a(0),this.oDate.Label=t.Tables[0][m].UserColumnName.toString(),this.oDate.DBColumnName=t.Tables[0][m].CostCenterColID.toString(),this.oDate.SysColumnName=t.Tables[0][m].SysColumnName.toString(),this.oDate.Row=s,this.oDate.Column=i,this.oDate.ColumnSpan=o),this.Fields.push(this.oDate);else if("TIME"==t.Tables[0][m].UserColumnType.toString()){if("true"==t.Tables[0][m].Iscolumninuse.toString().toLowerCase()&&"true"==t.Tables[0][m].IsColumnUserDefined.toString().toLowerCase()){var D=new Date;this.oTime=new d.b(0),this.oTime.Label=t.Tables[0][m].UserColumnName.toString(),this.oTime.DBColumnName=t.Tables[0][m].CostCenterColID.toString(),this.oTime.SysColumnName=t.Tables[0][m].SysColumnName.toString(),this.oTime.ShowTimePicker=!0,this.oTime.CustomFormat="hh:mm:ss a",this.oTime.Date=new Date(1900,1,1,D.getHours(),D.getMinutes(),D.getSeconds(),D.getMilliseconds()),this.oTime.Row=s,this.oTime.Column=i,this.oTime.ColumnSpan=o}this.Fields.push(this.oTime)}else if("COMBOBOX"==t.Tables[0][m].UserColumnType.toString()){if("true"==t.Tables[0][m].Iscolumninuse.toString().toLowerCase()&&"true"==t.Tables[0][m].IsColumnUserDefined.toString().toLowerCase()){this.oCombo=new u.e(0),this.oCombo.Label=t.Tables[0][m].UserColumnName.toString(),this.oCombo.DBColumnName=t.Tables[0][m].CostCenterColID.toString(),this.oCombo.SysColumnName=t.Tables[0][m].SysColumnName.toString();var A=t.Tables[0][m].UserProbableValues.toString().Trim();if(A.length>0){for(var v=A.split(";"),p=0;p<v.length;p++)this.oCombo.Items.push(u.d.ComboBoxItems_2(v[p],v[p]));this.oCombo.SelectedValue=this.oCombo.Items[0].Value}this.oCombo.Row=s,this.oCombo.Column=i,this.oCombo.ColumnSpan=o}this.Fields.push(this.oCombo)}else"TEXTAREA"==t.Tables[0][m].UserColumnType.toString()?("true"==t.Tables[0][m].Iscolumninuse.toString().toLowerCase()&&"true"==t.Tables[0][m].IsColumnUserDefined.toString().toLowerCase()&&(this.oTextArea=new h.c(0),this.oTextArea.Label=t.Tables[0][m].UserColumnName.toString(),this.oTextArea.DBColumnName=t.Tables[0][m].CostCenterColID.toString(),this.oTextArea.SysColumnName=t.Tables[0][m].SysColumnName.toString(),this.oTextArea.Row=s,this.oTextArea.Column=i,this.oTextArea.ColumnSpan=o),this.Fields.push(this.oTextArea)):"COMBOTEXT"==t.Tables[0][m].UserColumnType.toString()?("true"==t.Tables[0][m].Iscolumninuse.toString().toLowerCase()&&"true"==t.Tables[0][m].IsColumnUserDefined.toString().toLowerCase()&&(this.OComboText=new C.a(0),this.OComboText.Label=t.Tables[0][m].UserColumnName.toString(),this.OComboText.DBColumnName=t.Tables[0][m].CostCenterColID.toString(),this.OComboText.SysColumnName=t.Tables[0][m].SysColumnName.toString(),this.OComboText.Row=s,this.OComboText.Column=i,this.OComboText.ColumnSpan=o),this.Fields.push(this.OComboText)):"LISTBOX"==t.Tables[0][m].UserColumnType.toString()&&("true"==t.Tables[0][m].Iscolumninuse.toString().toLowerCase()&&"true"==t.Tables[0][m].IsColumnUserDefined.toString().toLowerCase()&&(this.oPactCombo=new S.b(0),this.oPactCombo.CCID=parseInt(t.Tables[0][m].ColumnCostCenterID),this.oPactCombo.TypeID=0==t.Tables[0][m].ColumnCCListViewTypeID.toString().Trim().length?1:parseInt(t.Tables[0][m].ColumnCCListViewTypeID),this.oPactCombo.Label=t.Tables[0][m].UserColumnName.toString(),this.oPactCombo.DBColumnName=t.Tables[0][m].CostCenterColID.toString(),this.oPactCombo.SysColumnName=t.Tables[0][m].SysColumnName.toString(),this.oPactCombo.DBColumnID=parseInt(t.Tables[0][m].ColumnCostCenterID),this.oPactCombo.Row=s,this.oPactCombo.Column=i,this.oPactCombo.ColumnSpan=o),this.Fields.push(this.oPactCombo));this.IsPopup?3==i?(s+=1,i=0):i+=1:s+=1}if(t.Tables.length>1&&t.Columns[1].Contains("SysColumnName")&&t.Tables[1].length>0)for(var b=function(i){null!=(R=e.Fields.find((function(e){return e.SysColumnName.toUpperCase()==t.Tables[1][i].SysColumnName.toString().toUpperCase()})))&&null!=R&&e.DisableCCFields&&(R.IsReadOnly=!0)},g=0;g<t.Tables[1].length;g++)b(g);if(t.Tables.length>2&&t.Columns[2].Contains("CostCenterColIDBase")&&t.Tables[2].length>0)for(var T=function(i){null!=(R=e.Fields.find((function(e){return e.DBColumnName==t.Tables[2][i].CostCenterColIDBase.toString()})))&&null!=R&&(R.IsReadOnly=!0)},I=0;I<t.Tables[2].length;I++){var R;T(I)}this.UseActivityQuickAdd&&t.Tables.length>3&&t.Tables[4].length>0?this.ArrangeQiuckScreen(t.Tables[4]):!this.UseActivityQuickAdd&&t.Tables.length>3&&t.Tables[4].length>0&&this.AssignProperties(t.Tables[4])}this.AssignRowColumns(l),this.ButtonSave.Visible=a.a.SessionManager.IsActionAssigned(1e3,this.ActivityID>0?"Activity_Edit":"Activity_Create")}},{key:"RecurInitialize",value:function(){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var e,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.resolve().then(i.bind(null,"C58A"));case 2:e=t.sent,s=e.RecurAppointmentViewModel,this.Recur=new s(this);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"AssignProperties",value:function(t){try{var e=t.find((function(t){return"StatusID"==t.SysColumnName}));this.Status.Mandatory=e.length>0&&parseInt(e[0].IsMandatory)>0,e=t.find((function(t){return"Subject"==t.SysColumnName})),this.Subject.Mandatory=e.length>0&&parseInt(e[0].IsMandatory)>0,e=t.find((function(t){return"CustomerType"==t.SysColumnName})),this.CustomerType.Mandatory=e.length>0&&parseInt(e[0].IsMandatory)>0,e=t.find((function(t){return"ContactID"==t.SysColumnName})),this.CRMContactPerson.Mandatory=e.length>0&&parseInt(e[0].IsMandatory)>0}catch(i){}}},{key:"LoadData",value:function(t){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var s,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==t){e.next=8;break}if(null!=this.objParent&&"QuickAddLeads"==this.objParent.ClassName){e.next=7;break}return e.next=4,Promise.all([i.e(23),i.e(131)]).then(i.bind(null,"2Dtv"));case 4:s=e.sent,a=s.AssignFeatureViewModel,this.AssignFeature=new a,this.AssignFeature.AssignFeatureViewModel_1(this.objParent.ViewActivities,t.NodeID,t.CostCenterID),this.HistoryVisibility=!("AddEditDocumentViewModel"!=t.ClassName||this.objParent.ScreenObject.Preferences.ContainsKey("ActivityAsPopUp")&&"True"==this.objParent.ScreenObject.Preferences.ActivityAsPopUp.toString());case 7:null!=this.objParent.ViewActivities&&null!=this.objParent.ViewActivities.DS?this.LoadCustomFields_DS(this.objParent.ViewActivities.DS):this.LoadCustomFields(this.objParent.CostCenterID);case 8:case"end":return e.stop()}}),e,this)})))}},{key:"SetActions",value:function(){if(this.StartStopVisible=!1,null!=this.durtimer&&(this.durtimer.Enabled=!1),this.EnableStart&&0!=this.ActivityID){if(this.StartStopVisible=!0,this.StartVisible=!1,this.StopVisible=!1,this.HoldVisible=!1,"8"==this.Status.SelectedValue||"12"==this.Status.SelectedValue||"412"==this.Status.SelectedValue||"414"==this.Status.SelectedValue)this.StartVisible=!0;else if("9"==this.Status.SelectedValue){this.HoldVisible=this.StopVisible=!0;var t=0;this.laststartdate&&this.laststartdate<new Date&&(t=n.e.GetDatesTotalMinutes(new Date,this.laststartdate),this.TotalDuration+=t,null==this.durtimer&&(this.durtimer=new n.d,this.durtimer.Interval=1e3,this.durtimer.Elapsed(this,"durtimer_Elapsed")),this.sec=0,this.durtimer.Enabled=!0)}this.Hrs=parseFloat(Math.round(this.TotalDuration/60).toString()),this.min=this.TotalDuration%60,this.ActivityDuration=this.Hrs.toString()+"."+this.min.toString()+"."+this.sec.toString()}}},{key:"durtimer_Elapsed",value:function(t,e){this.sec+=1,60==this.sec&&(this.sec=0,this.min+=1,60==this.min&&(this.Hrs+=1,this.min=0)),this.ActivityDuration=this.Hrs.toString()+"."+this.min.toString()+"."+this.sec.toString()}},{key:"buttonsAction",value:function(){0==this.ActivityID?a.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=a.a.SessionManager.IsActionAssigned(1e3,"Activity_Create"):this.ButtonSave.Enable=a.a.SessionManager.IsActionAssigned(1e3,"Activity_Create"):a.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=a.a.SessionManager.IsActionAssigned(1e3,"Activity_Edit"):this.ButtonSave.Enable=a.a.SessionManager.IsActionAssigned(1e3,"Activity_Edit"),a.a.SessionManager.HideUnathorizedAccess?this.ButtonReschedule.Visible=a.a.SessionManager.IsActionAssigned(1e3,"ReSchedule"):this.ButtonReschedule.Enable=a.a.SessionManager.IsActionAssigned(1e3,"ReSchedule"),a.a.SessionManager.HideUnathorizedAccess?this.ButtonCustomize.Visible=a.a.SessionManager.IsActionAssigned(1e3,"Customize"):this.ButtonCustomize.Enable=a.a.SessionManager.IsActionAssigned(1e3,"Customize"),a.a.SessionManager.HideUnathorizedAccess?this.ButtonAttachments.Visible=a.a.SessionManager.IsActionAssigned(1e3,"Attachment"):this.ButtonAttachments.Enable=a.a.SessionManager.IsActionAssigned(1e3,"Attachment")}},{key:"AssignRowColumns",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=null;if(""!=e?i=e.split(","):"AddEditDocumentViewModel"==this.objParent.ClassName&&this.objParent.ScreenObject.Preferences.ContainsKey("ActivityFields")&&""!=this.objParent.ScreenObject.Preferences.ActivityFields.toString()&&(i=this.objParent.ScreenObject.Preferences.ActivityFields.toString().split(",")),this.ActivityType.Label=a.a.GetResource("Activities_ActivityTypeName"),this.Status.Label=a.a.GetResource("Activities_Status"),this.Subject.Label=a.a.GetResource("Activities_Subject"),this.Priority.Label=a.a.GetResource("Activities_Priority"),this.Location.Label=a.a.GetResource("Activities_Location"),this.PctComplete.Label=a.a.GetResource("Activities_PctComplete"),this.Exp.Label=a.a.GetResource("Activities_Schedule"),this.StartDate.Label=a.a.GetResource("StartDate"),this.EndDate.Label=a.a.GetResource("EndDate"),this.IsAllDayActivity.Label=a.a.GetResource("Activities_IsAllDayActivity"),this.ActualCloseDate.Label=a.a.GetResource("Activities_ActualCloseDate"),this.ActualCloseTime.Label=a.a.GetResource("Activities_ActualCloseTime"),this.AssignUserList.Label=a.a.GetResource("Activities_AssignedTo"),this.CustomerType.Label=a.a.GetResource("Activities_CustomerType"),this.CRMContactPerson.Label=a.a.GetResource("Com_Contacts_ContactPerson"),this.Remarks.Label=a.a.GetResource("Activities_Remarks"),this.ActStartDate.Label="Actual Start Date",this.ActEndDate.Label="Actual End Date",this.ActStartDate.Visible=this.ActEndDate.Visible=!!this.EnableStart,this.IsPopup){this.Width="900";var s=new Array;4==this.ActivityType.ColumnSpan&&(this.ActivityType.ColumnSpan=3),4==this.Status.ColumnSpan&&(this.Status.ColumnSpan=3),4==this.Subject.ColumnSpan&&(this.Subject.ColumnSpan=3),4==this.StartDate.ColumnSpan&&(this.StartDate.ColumnSpan=1),4==this.EndDate.ColumnSpan&&(this.EndDate.ColumnSpan=1),null!=i&&i.length>1?(this.ActivityType.Visible=!1,this.Status.Visible=!1,this.Subject.Visible=!1,this.Priority.Visible=!1,this.PctComplete.Visible=!1,this.CRMCustomer.Visible=!1,this.CRMContactPerson.Visible=!1,this.StartDate.Visible=!1,this.EndDate.Visible=!1,this.IsAllDayActivity.Visible=!1,this.ActualCloseDate.Visible=!1,this.AssignUserList.Visible=!1,this.Remarks.Visible=!1,this.ActStartDate.Visible=!1,this.ActEndDate.Visible=!1,this.ActSign.Visible=!1,i.forEach((function(e){switch(e){case"ActivityTypeID":t.ActivityType.Visible=!0,s.push(t.ActivityType);break;case"StatusID":t.Status.Visible=!0,s.push(t.Status);break;case"Subject":t.Subject.Visible=!0,s.push(t.Subject);break;case"Priority":t.Priority.Visible=!0,s.push(t.Priority);break;case"PctComplete":t.PctComplete.Visible=!0,s.push(t.PctComplete);break;case"CustomerID":t.CRMCustomer.Visible=!0,s.push(t.CRMCustomer);break;case"ContactId":t.CRMContactPerson.Visible=!0,s.push(t.CRMContactPerson);break;case"StartDate":t.StartDate.Visible=!0,s.push(t.StartDate);break;case"EndDate":t.EndDate.Visible=!0,s.push(t.EndDate);break;case"IsAllDayActivity":t.IsAllDayActivity.Visible=!0,s.push(t.IsAllDayActivity);break;case"ActualCloseDate":t.ActualCloseTime.Visible=!0,s.push(t.ActualCloseDate),s.push(t.ActualCloseTime);break;case"AssignGroupID":t.AssignUserList.Visible=!0,s.push(t.AssignUserList);break;case"Remarks":t.Remarks.Visible=!0;break;case"ActStartDate":t.ActStartDate.Visible=!0,s.push(t.ActStartDate);break;case"ActEndDate":t.ActEndDate.Visible=!0,s.push(t.ActEndDate);break;case"Sign":t.ActSign.Visible=!0,t.ActivityDrawView=!0}}))):(s.push(this.ActivityType),s.push(this.Status),s.push(this.Subject),s.push(this.StartDate),s.push(this.EndDate),"3"!=this.ActivityType.SelectedValue&&"4"!=this.ActivityType.SelectedValue||s.push(this.Exp),s.push(this.IsAllDayActivity),s.push(this.ActualCloseDate),s.push(this.ActualCloseTime),s.push(this.AssignUserList),s.push(this.ActStartDate),s.push(this.ActEndDate),s.push(this.CustomerType),s.push(this.CRMCustomer),s.push(this.CRMContactPerson)),this.Setposition(s),this.Remarks.Visible&&(this.Remarks.Row=0,this.Remarks.Column=3),this.ViewAttachments.Row="5",this.ViewAttachments.Column="0",this.ViewAttachments.ColumnSpan=4}else if(this.FeatureWiseLable.Row=10,this.Width="230",null!=i&&i.length>1){this.ActivityType.Visible=!1,this.Status.Visible=!1,this.Subject.Visible=!1,this.Priority.Visible=!1,this.PctComplete.Visible=!1,this.CRMCustomer.Visible=!1,this.CRMContactPerson.Visible=!1,this.StartDate.Visible=!1,this.EndDate.Visible=!1,this.IsAllDayActivity.Visible=!1,this.ActualCloseDate.Visible=!1,this.AssignUserList.Visible=!1,this.Remarks.Visible=!1,this.ActStartDate.Visible=!1,this.ActEndDate.Visible=!1,this.ActSign.Visible=!1;for(var n=1,r=0;r<i.length;r++,n++)switch(i[r]){case"ActivityTypeID":this.ActivityType.Row=n,this.ActivityType.Column=0,this.ActivityType.ColumnSpan=4,this.ActivityType.Visible=!0;break;case"StatusID":this.Status.Row=n,this.Status.Column=0,this.Status.ColumnSpan=4,this.Status.Visible=!0;break;case"Subject":this.Subject.Row=n,this.Subject.Column=0,this.Subject.ColumnSpan=4,this.Subject.Visible=!0;break;case"Priority":this.Priority.Row=n,this.Priority.Column=0,this.Priority.ColumnSpan=4,this.Priority.Visible=!0;break;case"PctComplete":this.PctComplete.Row=n,this.PctComplete.Column=0,this.PctComplete.ColumnSpan=4,this.PctComplete.Visible=!0;break;case"CustomerID":this.CRMCustomer.Row=n,this.CRMCustomer.Column=0,this.CRMCustomer.ColumnSpan=4,this.CRMCustomer.Visible=!0;break;case"ContactId":this.CRMContactPerson.Row=n,this.CRMContactPerson.Column=0,this.CRMContactPerson.ColumnSpan=4,this.CRMContactPerson.Visible=!0;break;case"StartDate":this.StartDate.Row=n,this.StartDate.Column=0,this.StartDate.ColumnSpan=4,this.StartDate.Visible=!0;break;case"EndDate":this.EndDate.Row=n,this.EndDate.Column=0,this.EndDate.ColumnSpan=4,this.EndDate.Visible=!0;break;case"IsAllDayActivity":this.IsAllDayActivity.Row=n,this.IsAllDayActivity.Column=0,this.IsAllDayActivity.ColumnSpan=4,this.IsAllDayActivity.Visible=!0;break;case"ActualCloseDate":this.ActualCloseDate.Row=n,this.ActualCloseDate.Column=0,this.ActualCloseDate.ColumnSpan=4,this.ActualCloseDate.Visible=!0,n++,this.ActualCloseTime.Row=n,this.ActualCloseTime.Column=0,this.ActualCloseTime.ColumnSpan=4,this.ActualCloseTime.Visible=!0;break;case"AssignGroupID":this.AssignUserList.Row=n,this.AssignUserList.Column=0,this.AssignUserList.ColumnSpan=4,this.AssignUserList.Visible=!0;break;case"Remarks":this.Remarks.Row=n,this.Remarks.Column=0,this.Remarks.ColumnSpan=4,this.Remarks.Visible=!0,n+=3;break;case"ActStartDate":this.ActStartDate.Row=n,this.ActStartDate.Column=0,this.ActStartDate.ColumnSpan=4,this.ActStartDate.Visible=!0;break;case"ActEndDate":this.ActEndDate.Row=n,this.ActEndDate.Column=0,this.ActEndDate.ColumnSpan=4,this.ActEndDate.Visible=!0;break;case"Sign":this.ActSign.Row=n,this.ActSign.Column=0,this.ActSign.ColumnSpan=4,this.ActSign.Visible=!0,n++}}else this.ActivityType.Row=1,this.ActivityType.Column=0,this.ActivityType.ColumnSpan=4,this.Status.Row=2,this.Status.Column=0,this.Status.ColumnSpan=4,this.Subject.Row=3,this.Subject.Column=0,this.Subject.ColumnSpan=4,this.Exp.Row=4,this.Exp.Column=0,this.Exp.ColumnSpan=4,this.StartDate.Row=4,this.StartDate.Column=0,this.StartDate.ColumnSpan=4,this.EndDate.Row=5,this.EndDate.Column=0,this.EndDate.ColumnSpan=4,this.IsAllDayActivity.Row=6,this.IsAllDayActivity.Column=0,this.IsAllDayActivity.ColumnSpan=4,this.ActualCloseDate.Row=7,this.ActualCloseDate.Column=0,this.ActualCloseDate.ColumnSpan=4,this.ActualCloseTime.Row=7,this.ActualCloseTime.Column=0,this.ActualCloseTime.ColumnSpan=4,this.CustomerType.Row=8,this.CustomerType.Column=0,this.CustomerType.ColumnSpan=4,this.CRMCustomer.Row=9,this.CRMCustomer.Column=0,this.CRMCustomer.ColumnSpan=4,this.CRMContactPerson.Row=10,this.CRMContactPerson.Column=0,this.CRMContactPerson.ColumnSpan=4,this.AssignUserList.Row=11,this.AssignUserList.Column=0,this.AssignUserList.ColumnSpan=4,this.ActStartDate.Row=12,this.ActStartDate.Column=0,this.ActStartDate.ColumnSpan=4,this.ActEndDate.Row=13,this.ActEndDate.Column=0,this.ActEndDate.ColumnSpan=4,this.Remarks.Row=14,this.Remarks.Column=0,this.Remarks.ColumnSpan=4,this.ViewAttachments.Row="15",this.ViewAttachments.Column="0"}},{key:"Setposition",value:function(t){for(var e=0,i=0,s=1,a=0;a<t.length;a++){var r=t[a];null!=r&&r.Visible&&(s=1,(s=n.e.Int(r.ColumnSpan))<1&&(s=1),i+s>3&&(e++,i=0),r.Row=e,r.Column=i,i+=s)}}},{key:"CheckSign",value:function(){}},{key:"ArrangeQiuckScreen",value:function(t){var e=t.filter((function(t){return"ActivityTypeID"==t.SysColumnName}));e.length>0?(this.ActivityType.Label=e[0].ResourceData.toString(),this.ActivityType.Row=e[0].QuickAddOrder):this.ActivityType.Visible=!1,(e=t.filter((function(t){return"StatusID"==t.SysColumnName}))).length>0?(this.Status.Label=e[0].ResourceData.toString(),this.Status.Row=e[0].QuickAddOrder):this.Status.Visible=!1,(e=t.filter((function(t){return"Subject"==t.SysColumnName}))).length>0?(this.Subject.Label=e[0].ResourceData.toString(),this.Subject.Row=e[0].QuickAddOrder):this.Subject.Visible=!1,(e=t.filter((function(t){return"Priority"==t.SysColumnName}))).length>0?(this.Priority.Label=e[0].ResourceData.toString(),this.Priority.Row=e[0].QuickAddOrder):this.Priority.Visible=!1,(e=t.filter((function(t){return"Location"==t.SysColumnName}))).length>0?(this.Location.Label=e[0].ResourceData.toString(),this.Location.Row=e[0].QuickAddOrder):this.Location.Visible=!1,(e=t.filter((function(t){return"PctComplete"==t.SysColumnName}))).length>0?(this.PctComplete.Label=e[0].ResourceData.toString(),this.PctComplete.Row=e[0].QuickAddOrder):this.PctComplete.Visible=!1,(e=t.filter((function(t){return"ScheduleID"==t.SysColumnName}))).length>0?(this.Exp.Label=e[0].ResourceData.toString(),this.Exp.Row=e[0].QuickAddOrder):this.Exp.Visible=!1,(e=t.filter((function(t){return"StartDate"==t.SysColumnName}))).length>0?(this.StartDate.Label=e[0].ResourceData.toString(),this.StartDate.Row=e[0].QuickAddOrder):this.StartDate.Visible=!1,(e=t.filter((function(t){return"EndDate"==t.SysColumnName}))).length>0?(this.EndDate.Label=e[0].ResourceData.toString(),this.EndDate.Row=e[0].QuickAddOrder):this.EndDate.Visible=!1,(e=t.filter((function(t){return"IsAllDayActivity"==t.SysColumnName}))).length>0?(this.IsAllDayActivity.Label=e[0].ResourceData.toString(),this.IsAllDayActivity.Row=e[0].QuickAddOrder):this.IsAllDayActivity.Visible=!1,(e=t.filter((function(t){return"ActualCloseDate"==t.SysColumnName}))).length>0?(this.ActualCloseDate.Label=e[0].ResourceData.toString(),this.ActualCloseDate.Row=e[0].QuickAddOrder):this.ActualCloseDate.Visible=!1,(e=t.filter((function(t){return"ActualCloseTime"==t.SysColumnName}))).length>0?(this.ActualCloseTime.Label=e[0].ResourceData.toString(),this.ActualCloseTime.Row=e[0].QuickAddOrder):this.ActualCloseTime.Visible=!1,(e=t.filter((function(t){return"CustomerType"==t.SysColumnName}))).length>0?(this.CustomerType.Label=e[0].ResourceData.toString(),this.CustomerType.Row=e[0].QuickAddOrder):this.CustomerType.Visible=!1,(e=t.filter((function(t){return"CustomerID"==t.SysColumnName}))).length>0?(this.CRMCustomer.Label=e[0].ResourceData.toString(),this.CRMCustomer.Row=e[0].QuickAddOrder):this.CRMCustomer.Visible=!1,(e=t.filter((function(t){return"ContactID"==t.SysColumnName}))).length>0?(this.CRMContactPerson.Label=e[0].ResourceData.toString(),this.CRMContactPerson.Row=e[0].QuickAddOrder):this.CRMContactPerson.Visible=!1,(e=t.filter((function(t){return"AssignUserID"==t.SysColumnName}))).length>0?(this.AssignUserList.Label=e[0].ResourceData.toString(),this.AssignUserList.Row=e[0].QuickAddOrder):this.AssignUserList.Visible=!1,(e=t.filter((function(t){return"Remarks"==t.SysColumnName}))).length>0?(this.Remarks.Label=e[0].ResourceData.toString(),this.Remarks.Row=e[0].QuickAddOrder):this.Remarks.Visible=!1,this.Fields.forEach((function(i){(e=t.filter((function(t){return t.SysColumnName==i.SysColumnName}))).length>0?(i.Label=e[0].ResourceData.toString(),i.Row=e[0].QuickAddOrder):i.Visible=!1})),this.ViewAttachments.Row=t.length.toString()}},{key:"FilterSupplierBasedonCRMProduct",value:function(t,e){if(86==t||89==t){var i=a.a.cases.GetSuppliersByCRMProduct(t,e),s=-1;if(null!=i&&i.Tables.length>0&&i.Columns[0].Contains("MapCCID")&&i.Tables[0].length>0){for(var n,r,o="",l=0;l<i.Tables[0].length;l++)o+=i.Tables[0][l][i.Columns[0][0]]+",";if(s=parseInt(i.Tables[0][0].MapCCID),0==o.length)return;for(var c=0;c<this.Fields.length;c++)if(null!=(n=this.Fields[c])&&n instanceof S.b&&n.DBColumnID==s){(r=n).CustomWhere=" a.NodeID  in ("+o.TrimEnd(",")+")",r.Refresh();break}}}}},{key:"OnStartDateChange",value:function(t){"StartDate"==t.toString()?new Date(this.EndDate.Date)<new Date(this.StartDate.Date)&&(this.EndDate.Date=this.StartDate.Date):"EndDate"==t.toString()&&new Date(this.StartDate.Date)>new Date(this.EndDate.Date)&&(this.EndDate.Date=this.StartDate.Date)}},{key:"OnFeatureLableClick",value:function(t){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var s,n,r,o,l,c,h,u,d,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Invite"!=t.toString()){e.next=17;break}if("413"!=this.StatusSelectedValue){e.next=5;break}alert("Activity is closed"),e.next=15;break;case 5:if(!(this.ActivityID>0)){e.next=15;break}return e.next=8,Promise.all([i.e(23),i.e(131)]).then(i.bind(null,"2Dtv"));case 8:return s=e.sent,n=s.AssignFeatureViewModel,e.next=12,Promise.resolve().then(i.bind(null,"yWgc"));case 12:r=e.sent,o=r.AssignFeatureComponent,a.a.page.ShowDialog((new n).AssignFeatureViewModel_1(this,this.ActivityID,this.CostCenterID),o,{ShowCenter:!0,Title:a.a.GetResource("View Activities")});case 15:e.next=40;break;case 17:if("Attendees"!=t.toString()){e.next=34;break}if(!(this.ActivityID>0)){e.next=32;break}if(!(null!=(l=a.a.cases.GetAttendiesList(this.ActivityID))&&l.Tables.length>0)){e.next=32;break}if(l.Tables[0].length>0){e.next=23;break}return e.abrupt("return",void alert("No Intivitations"));case 23:return e.next=25,i.e(133).then(i.bind(null,"UlzB"));case 25:return c=e.sent,h=c.InvitesViewModel,e.next=29,i.e(134).then(i.bind(null,"dvUr"));case 29:u=e.sent,d=u.InvitesComponent,a.a.page.ShowDialog((new h).InvitesViewModel_2(a.a.SessionManager.UserID,l,!1,this.ActivityID),d,{ShowCenter:!0,Title:a.a.GetResource("Invites")});case 32:e.next=40;break;case 34:if(0==this.FeatureWiseLable.FeatureID){e.next=40;break}return e.next=37,Promise.resolve().then(i.bind(null,"CUWK"));case 37:m=e.sent,m.RibbonExtViewModel.LoadScreenFromActivity(this.FeatureWiseLable);case 40:case"end":return e.stop()}}),e,this)})))}},{key:"ActivitiesViewModel",value:function(){this.dtPreferences=a.a.common.GetDataSet("ACT001",""),this.Exp=new h.d,this.Exp.DefaultValue="Test",this.Exp.Visible=!1,this.CRMContactPerson.CCID=65,this.ActivitiesTempGrid=new l.a,this.ActivitiesTempGrid.Table=[],this.AddActivityTempGridColumns(),this.ViewActivities=new y.b(this),this.ViewAttachments=new A.ViewAttachmentViewModel(this),this.InitCombobox(),this.ButtonSave=new D.a,this.LoadAssignedUsers()}},{key:"onViewHistory",value:function(t){a.a.page.ShowDialog(this.objParent.ViewActivities,g.ViewActivitiesComponent,{ShowCenter:!0,Title:a.a.GetResource("View Activities"),VarWidth:!0})}},{key:"OnTimeChanged",value:function(t){null!=t&&parseInt(t.toString())<=this.StartTime.SelectedIndex&&(this.EndTime.SelectedIndex=this.StartTime.SelectedIndex+1)}},{key:"OnClick",value:function(t){var e=t;"1"==this.ActivityType.SelectedValue.toString()&&(1==e.IsChecked?(this.StartTime.SelectedValue="12:30:00 AM",this.EndTime.SelectedValue="12:30:00 AM",this.StartTime.Enable=!1,this.EndTime.Enable=!1):(this.StartTime.SelectedValue="08:00:00 AM",this.EndTime.SelectedValue="08:30:00 AM",this.StartTime.Enable=!0,this.EndTime.Enable=!0))}},{key:"onActivityFrequancy",value:function(){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var e,s,n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.resolve().then(i.bind(null,"8PvV"));case 2:e=t.sent,s=e.RecurAppointmentComponent,a.a.page.ShowDialog(this.Recur,s,{ShowCenter:!0}).subscribe((function(){n.Recur.isOk&&(0==n.ActivityID&&(n.SchID=n.SchID<0?n.SchID-1:-1e3),n.ActivityText.Text=n.Recur.FrequencyText,n.ActivitiesTempGrid.Table.Clear(),n.GenerateActivity(n.SchID))}));case 5:case"end":return t.stop()}}),t,this)})))}},{key:"IsPopupRecur",value:function(){}},{key:"OnCustomerTypeChange",value:function(t){"1"==this.CustomerType.SelectedValue?(this.CRMCustomer.Code.Visible=!0,this.CRMCustomer.TextVisible=!1,this.CRMCustomer.Code.CCID=2,this.CRMCustomer.Label="Account",this.CRMCustomer.Code.TypeID=2,this.CRMCustomer.Code.CustomWhere="",this.CRMCustomer.Code.SelectedValue=0,this.CRMCustomer.Code.Refresh()):"2"==this.CustomerType.SelectedValue?(this.CRMCustomer.Code.Visible=!0,this.CRMCustomer.TextVisible=!1,this.CRMCustomer.Code.CCID=83,this.CRMCustomer.Label="Customer",this.CRMCustomer.Code.TypeID=1,this.CRMCustomer.Code.SelectedValue=0,this.CRMCustomer.Code.Refresh()):(this.CRMCustomer.Label="Customer",this.CRMCustomer.Code.Visible=!1,this.CRMCustomer.TextVisible=!0)}},{key:"onCustomerSelectionChange",value:function(t){null!=t&&"Customer"==t.toString()&&(this.CRMCustomer.Code.SelectedValue>0?(this.CRMCustomer.Code.Visible||this.CRMCustomer.Code.SelectedValue>0)&&(83==this.CRMCustomer.Code.CCID?(this.CRMContactPerson.CustomWhere="a.Featurepk ="+this.CRMCustomer.Code.SelectedValue+" and a.Featureid=83  ",this.CRMContactPerson.Refresh(),this.CRMContactPerson.SelectedIndex=0):2==this.CRMCustomer.Code.CCID&&(this.CRMContactPerson.CustomWhere="a.Featurepk ="+this.CRMCustomer.Code.SelectedValue+" and a.Featureid=2  ",this.CRMContactPerson.Refresh(),this.CRMContactPerson.SelectedIndex=0)):83==this.CRMCustomer.Code.CCID?(this.CRMContactPerson.CustomWhere=" a.Featureid=83  ",this.CRMContactPerson.Refresh(),this.CRMContactPerson.SelectedIndex=0):2==this.CRMCustomer.Code.CCID&&(this.CRMContactPerson.CustomWhere="  a.Featureid=2  ",this.CRMContactPerson.Refresh(),this.CRMContactPerson.SelectedIndex=0))}},{key:"InitCombobox",value:function(){this.Status=new u.e,this.Status.Items.push(u.d.ComboBoxItems_2("Open","412")),this.Status.Items.push(u.d.ComboBoxItems_2("Confirmed","8")),this.Status.Items.push(u.d.ComboBoxItems_2("In-Progress","9")),this.Status.Items.push(u.d.ComboBoxItems_2("On-Hold","12")),this.Status.Items.push(u.d.ComboBoxItems_2("Close","413")),this.Status.Items.push(u.d.ComboBoxItems_2("Re-Schedule","414")),this.CustomerType=new u.e(0),this.CustomerType.Items.push(u.d.ComboBoxItems_2("None","0")),this.CustomerType.Items.push(u.d.ComboBoxItems_2("Account","1")),this.CustomerType.Items.push(u.d.ComboBoxItems_2("CRM-Customers","2")),this.ActivityType=new u.e(0),this.ActivityType.Items=[],this.ActivityType.Items.push(u.d.ComboBoxItems_2("Appointment Regular","1")),this.ActivityType.Items.push(u.d.ComboBoxItems_2("Appointment Recurring","3")),a.a.SessionManager.IsActionAssigned(1e3,"Task Regular")&&this.ActivityType.Items.push(u.d.ComboBoxItems_2("Task Regular","2")),a.a.SessionManager.IsActionAssigned(1e3,"Task Recurring")&&this.ActivityType.Items.push(u.d.ComboBoxItems_2("Task Recurring","4")),this.ActivityType.SelectionChangedCommand.Subscribe(this,"onActivityTypeSelectedChanged"),this.SaveActivity.Subscribe(this,"onSaveActivity"),this.CancelActivity.Subscribe(this,"onCancelActivity"),this.Status.SelectionChangedCommand.Subscribe(this,"onStatusSelectedChanged"),this.ActivityType.SelectedValue="1",this.Priority.Items.push(u.d.ComboBoxItems_2("Low","1")),this.Priority.Items.push(u.d.ComboBoxItems_2("Normal","2")),this.Priority.Items.push(u.d.ComboBoxItems_2("High","3")),this.Priority.SelectedIndex=1,this.Priority.SelectedValue="2";var t=0,e="08:00:00 AM",i="08:00:00 AM",s=this.dtPreferences.Tables[0].filter((function(t){return"ActivityDuration"==t.Name}));s.length>0&&!n.e.IsEmpty(s[0].value)&&(t=n.e.Int(s[0].value)),null!=(s=this.dtPreferences.Tables[0].filter((function(t){return"ActivityStartTime"==t.Name})))&&s.length>0&&!n.e.IsEmpty(s[0].value)&&(e=s[0].value.toString()),null!=(s=this.dtPreferences.Tables[0].filter((function(t){return"ActivityEndTime"==t.Name})))&&s.length>0&&!n.e.IsEmpty(s[0].value)&&(i=s[0].value.toString()),"AddEditDocumentViewModel"==this.objParent.ClassName?(this.EnableStart=!(!this.objParent.ScreenObject.Preferences.ContainsKey("EnableStart")||"True"!=this.objParent.ScreenObject.Preferences.EnableStart.toString()),this.IsPopup=!(!this.objParent.ScreenObject.Preferences.ContainsKey("ActivityAsPopUp")||"True"!=this.objParent.ScreenObject.Preferences.ActivityAsPopUp.toString())):null!=(s=this.dtPreferences.Tables[0].filter((function(t){return"EnableStart"==t.Name})))&&s.length>0&&!n.e.IsEmpty(s[0].value)&&(this.EnableStart=s[0].value.toString(),this.EnableStart=Object(r.j)(s[0].value.toString())),0==t&&(t=30);for(var o=a.a.cases.TimeChange(e,i,t),l=0;l<o;l++){var c;c=Date.WithTime(e).AddMinutes(l*t).ToString("hh:mm:ss a"),this.ActualCloseTime.Items.push(u.d.ComboBoxItems_2(c,c)),this.StartTime.Items.push(u.d.ComboBoxItems_2(c,c)),this.EndTime.Items.push(u.d.ComboBoxItems_2(c,c))}null!=(s=this.dtPreferences.Tables[0].filter((function(t){return"ActivityDefaultStartTime"==t.Name})))&&s.length>0&&!n.e.IsEmpty(s[0].Value)?(this.StartTime.SelectedValue=s[0].Value.toString(),this.StartTime.SelectedIndex=this.StartTime.Items.indexOf(this.StartTime.Items.find((function(t){return t.Value==s[0].Value.toString()})))):(this.StartTime.SelectedValue=e,this.StartTime.SelectedIndex=0),null!=(s=this.dtPreferences.Tables[0].filter((function(t){return"ActivityDefaultEndTime"==t.Name})))&&s.length>0&&!n.e.IsEmpty(s[0].Value)?(this.EndTime.SelectedValue=s[0].Value.toString(),this.EndTime.SelectedIndex=this.EndTime.Items.indexOf(this.EndTime.Items.find((function(t){return t.Value==s[0].Value.toString()})))):(this.EndTime.SelectedValue=Date.WithTime(e).AddMinutes(t).ToString("hh:mm:ss a"),this.EndTime.SelectedIndex=1)}},{key:"onStatusSelectedChanged",value:function(t){if(!(this.objParent.ClassName=this.objParent.ScreenObject.Preferences.ContainsKey("ActivityFields")&&""!=this.objParent.ScreenObject.Preferences.ActivityFields.toString()))return null==this.StatusSelectedValue?(this.ActualCloseDate.Visible=!1,this.ActualCloseTime.Visible=!1,this.StartDate.Visible=!1,this.StartTime.Visible=!1,this.EndDate.Visible=!1,void(this.EndTime.Visible=!1)):void("412"==this.StatusSelectedValue.toString()||"414"==this.StatusSelectedValue.toString()?(this.ActualCloseDate.Visible=!1,this.ActualCloseTime.Visible=!1,this.StartDate.Visible=!0,this.StartTime.Visible=!0,this.EndDate.Visible=!0,this.EndTime.Visible=!0,this.StartDate.Enable=!0,this.StartTime.Enable=!0,this.EndDate.Enable=!0,this.EndTime.Enable=!0,"3"!=this.ActivityType.SelectedValue&&"4"!=this.ActivityType.SelectedValue||this.AssignRowColumns()):"413"==this.StatusSelectedValue.toString()&&(this.ActualCloseDate.Visible=!0,this.ActualCloseTime.Visible=!0,this.ActualCloseDate.Date=new Date,this.StartDate.Visible=!0,this.StartTime.Visible=!0,this.EndDate.Visible=!0,this.EndTime.Visible=!0,this.StartDate.Enable=!1,this.StartTime.Enable=!1,this.EndDate.Enable=!1,this.EndTime.Enable=!1))}},{key:"onCancelActivity",value:function(t){var e=this;"Customize"==t.toString()?this.Customize=!0:"Attachment"==t.toString()?(this.OnAddAttachment(),this.ActivityOnScreen||(this.ActVisibile=!1),this.ViewAttachVisible=!0,this.AttachmentVisibility=!0,a.a.page.ShowDialog(this.Attachment,R.a,{Title:"Attachment"}).subscribe((function(){e.ActVisibile=!0,e.ViewAttachVisible=!0,e.AttachmentVisibility=!1}))):a.a.page.HideDialog()}},{key:"GenerateActivity",value:function(t){var e=1,i=0;try{e=parseInt(this.Recur.Occurrences.Text)}catch(r){}var s=new Date(this.Recur.FirstPostingDate.Date.toString()).AddDays(-1);if(this.Recur.RecurrencePattern.Items[1].IsChecked)for(this.Recur.FreqInterval=parseInt(this.Recur.DailyEvery.Items[0].GroupName);i<e;)s=s.AddDays(this.Recur.FreqInterval),this.AddRows(s,t),i++;else if(this.Recur.RecurrencePattern.Items[2].IsChecked){if(this.Recur.WeeklyDays.Items.filter((function(t){return 1==t.IsChecked})).length>0)for(this.Recur.FreqInterval=parseInt(this.Recur.WeeklyRecurEvery.Text),i=0;;){for(var a=s.getDay(),n=0;n<7;n++,a++){if(7==a&&(a=0),this.Recur.WeeklyDays.Items[a].IsChecked&&(this.AddRows(s,t),++i>=e))return;s=s.AddDays(1)}this.Recur.FreqInterval>1&&(s=s.AddDays(7*(this.Recur.FreqInterval-1)))}}else if(this.Recur.RecurrencePattern.Items[3].IsChecked)if(this.Recur.MonthlyEvery.Items[0].IsChecked){if(this.Recur.FreqInterval=parseInt(this.Recur.MonthlyDayOf.Text),this.Recur.FreqRecurrenceFactor=parseInt(this.Recur.MonthlyDayMonths.Text),this.Recur.FreqInterval<s.getDate())s=(s=s.AddMonths(1)).AddDays(s.getDate()-this.Recur.FreqInterval),this.Recur.FirstPostingDate.Date=s;else try{s=new Date(s.getFullYear(),s.getMonth(),this.Recur.FreqInterval)}catch(o){try{s=new Date(s.getFullYear(),s.getMonth(),this.Recur.FreqInterval-1)}catch(l){try{s=new Date(s.getFullYear(),s.getMonth(),this.Recur.FreqInterval-2)}catch(c){try{s=new Date(s.getFullYear(),s.getMonth(),this.Recur.FreqInterval-3)}catch(h){}}}}for(;i<e;)s=s.AddMonths(this.Recur.FreqRecurrenceFactor),this.AddRows(s,t),i++}else if("8"==this.Recur.MonthlyTheWeekDay.SelectedValue)for("1"==this.Recur.MonthlyTheFirst.SelectedValue?1!=s.getDate()&&(s=new Date(s.getFullYear(),s.getMonth(),1).AddMonths(1)):"16"==this.Recur.MonthlyTheFirst.SelectedValue&&(s=new Date(s.getFullYear(),s.getMonth(),1).AddMonths(1).AddDays(-1)),this.Recur.FreqRecurrenceFactor=parseInt(this.Recur.MonthlyTheMonths.Text);i<e;)s="16"==this.Recur.MonthlyTheFirst.SelectedValue?new Date(s.getFullYear(),s.getMonth(),1).AddMonths(this.Recur.FreqRecurrenceFactor+1).AddDays(-1):s.AddMonths(this.Recur.FreqRecurrenceFactor),this.AddRows(s,t),i++;else for(this.Recur.FreqRecurrenceFactor=parseInt(this.Recur.MonthlyTheMonths.Text);i<e;)s=s.AddMonths(this.Recur.FreqRecurrenceFactor),this.AddRows(s,t),i++}},{key:"AddRows",value:function(t,e){null!=this.Recur.StartingTime.SelectedValue&&""!=this.Recur.StartingTime.SelectedValue&&(t=new Date(t.ToString("dd/MMM/yyyy")+" "+this.Recur.StartingTime.SelectedValue));var i=this.ActivitiesTempGrid.addNewRowEmpty();i.sno=this.ActivitiesTempGrid.Table.length+1,i.StartDate=t.ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm a"),i.StartTime=t.ToString("hh:mm a"),i.StartDate_Key=t,i.EndDate=t.ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm a"),i.EndTime=t.ToString("hh:mm a"),i.EndDate_Key=t,i.Status="Schedule",i.ActivityID=this.ActivityID,i.SchID=e,this.ActivitiesTempGrid.Table.push(i)}},{key:"AddActivityTempGridColumns",value:function(){this.ActivitiesTempGrid.Table=[],this.tempActivitiesTempGridCol.push("sno"),this.tempActivitiesTempGridCol.push("StartDate"),this.tempActivitiesTempGridCol.push("StartDate_Key"),this.tempActivitiesTempGridCol.push("StartTime"),this.tempActivitiesTempGridCol.push("EndDate"),this.tempActivitiesTempGridCol.push("EndDate_Key"),this.tempActivitiesTempGridCol.push("EndTime"),this.tempActivitiesTempGridCol.push("Status"),this.tempActivitiesTempGridCol.push("ActivityID"),this.tempActivitiesTempGridCol.push("SchID")}},{key:"LoadAssignedUsers",value:function(){var t=null;if(t=a.a.empService.GetQueryData(0,"LoadAssignedUsers","","",""),"1"!=a.a.SessionManager.UserID&&this.AssignUserList.Items.push(u.d.ComboBoxItems_2(a.a.SessionManager.UserName,a.a.SessionManager.UserID.toString())),null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&t.Columns[0].Contains("UserName"))for(var e=0;e<t.Tables[0].length;e++)this.AssignUserList.Items.push(u.d.ComboBoxItems_2(t.Tables[0][e].UserName.toString(),t.Tables[0][e].UserID.toString()))}},{key:"onSaveActivity",value:function(t){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var s,o,l,c,h,d,m,S,y,D,A,C,v,p,b,g,R,V,f,w,E,P,F,k,x=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s={Latitude:"",Longitude:"",Address1:"",Address2:"",City:"",State:"",Country:"",PinCode:""},null==t||"ViewSign"!=t.toString()){e.next=4;break}return o=this.ViewAttachments.AttachmentsList.find((function(t){return t.IsSign})),e.abrupt("return",void(null!=o&&o.OpenFile()));case 4:if(null==t||"Start"!=t.toString()&&"Stop"!=t.toString()&&"Hold"!=t.toString()){e.next=30;break}return e.prev=5,e.next=8,n.e.UserCurrentLocation();case 8:if(l=e.sent,e.t0=null!=l,!e.t0){e.next=20;break}if(s.Latitude=l.coords.latitude,s.Longitude=l.coords.longitude,null==l.address){e.next=17;break}s.Address1=l.address.Address1,s.Address2=l.address.Address2,s.City=l.address.City,s.State=l.address.State,s.Country=l.address.Country,s.PinCode=l.address.PinCode,e.next=20;break;case 17:return e.next=19,n.e.GetUsersCurrentAddress(l);case 19:s.Address1=e.sent;case 20:e.next=24;break;case 22:e.prev=22,e.t1=e.catch(5);case 24:if(c=new Date,h=0,"Start"==t.toString()?(h=1,"9"==this.Status.SelectedValue&&(h=2)):"Stop"==t.toString()?h=4:"Hold"==t.toString()&&(h=3),d=new M,"Start"==t.toString())for(d.FromDate.Label="Start Date",m=0;m<this.StartTime.Items.length;m++)d.FromTime.Items.push(u.d.ComboBoxItems_2(this.StartTime.Items[m].Name,this.StartTime.Items[m].Value));else for("Stop"==t.toString()?d.FromDate.Label="End Date":(d.FromDate.Label="Hold Date",d.Reason.Visible=!0,d.Reason.Label="Reason"),S=0;S<this.EndTime.Items.length;S++)d.FromTime.Items.push(u.d.ComboBoxItems_2(this.EndTime.Items[S].Name,this.EndTime.Items[S].Value));return y=(new Date).ToString("hh:mm:ss a"),e.abrupt("return",(d.FromTime.AddItem(y,y),d.FromTime.SelectedValue=y,void a.a.page.ShowDialog(d,T.a,{ShowCenter:!0,Title:d.Title},(function(){if(d.DailogResult&&d.DailogResult){c=n.e.IsEmpty(d.FromTime.SelectedValue)?d.FromDate.Date:new Date(d.FromDate.Date.ToString("dd/MMM/yyyy")+" "+d.FromTime.SelectedValue);var e=[];e.push(x.ActivityID),e.push(c),e.push(h),d.Reason.Visible&&!n.e.IsEmpty(d.Reason.Text)?e.push(d.Reason.Text):e.push(""),e.push(s.Longitude),e.push(s.Latitude),e.push(s.Address1),e.push(s.Address2),e.push(s.City),e.push(s.State),e.push(s.Country),e.push(s.PinCode),e.push(a.a.SessionManager.CompanyGUID),e.push(a.a.SessionManager.UserName),e.push(a.a.SessionManager.LanguageID);var i=a.a.cases.SetActivityLog(e);if(x.DisplayMessage=i.obj.MessageText,x.MessageVisibility=!0,i.obj.RetValue>0)return"Start"==t.toString()?(1==h&&(x.ActStartDate.Date=c,x.ActStartTime.AddItem(c.ToString("hh:mm:ss a"),c.ToString("hh:mm:ss a")),x.ActStartTime.SelectedValue=c.ToString("hh:mm:ss a"),x.laststartdate=c),x.Status.SelectedValue="9"):"Stop"==t.toString()?(x.Status.SelectedValue="413",x.ActEndDate.Date=c,x.ActEndTime.AddItem(c.ToString("hh:mm:ss a"),c.ToString("hh:mm:ss a")),x.ActEndTime.SelectedValue=c.ToString("hh:mm:ss a"),null!=i&&i.Tables.length>0&&i.Tables[0].length>0&&i.Columns[0].Contains("duration")&&""!=i.Tables[0][0].duration.toString()&&(x.TotalDuration=parseInt(i.Tables[0][0].duration.toString())),x.laststartdate=null):(x.Status.SelectedValue="12",null!=i&&i.Tables.length>0&&i.Tables[0].length>0&&i.Columns[0].Contains("duration")&&""!=i.Tables[0][0].duration.toString()&&(x.TotalDuration=parseInt(i.Tables[0][0].duration.toString())),x.laststartdate=null),void x.SetActions()}}))));case 30:if(null==t||"Detail"!=t.toString()){e.next=39;break}for((D=[]).push(this.ActivityID),D.push((new Date).ToString("dd/MMM/yyyy")),D.push(10),D.push(""),D.push(s.Longitude),D.push(s.Latitude),D.push(s.Address1),D.push(s.Address2),D.push(s.City),D.push(s.State),D.push(s.Country),D.push(s.PinCode),D.push(a.a.SessionManager.CompanyGUID),D.push(a.a.SessionManager.UserName),D.push(a.a.SessionManager.LanguageID),A=a.a.cases.SetActivityLog(D),(C=new M).Title="History",C.PickDateViewModel(1),C.DetailGrid.Table=[],C.DetailGrid.TableColumns.push("StartDate"),C.DetailGrid.TableColumns.push("StartDate_Key"),C.DetailGrid.TableColumns.push("EndDate"),C.DetailGrid.TableColumns.push("EndDate_Key"),C.DetailGrid.TableColumns.push("Remarks"),C.DetailGrid.Columns=[],(v=new I.a).Header="Start",v.DisplayMember="StartDate",v.Width=130,C.DetailGrid.Columns.push(v),(v=new I.a).Header="End",v.DisplayMember="EndDate",v.Width=130,C.DetailGrid.Columns.push(v),(v=new I.a).Header="Reason",v.DisplayMember="Remarks",v.Width=150,C.DetailGrid.Columns.push(v),p=0;p<A.Tables[0].length;p++)b=C.DetailGrid.NewRow(),n.e.IsEmpty(A.Tables[0][p].StartDate)||(b.StartDate_Key=new Date(A.Tables[0][p].StartDate.toString()),b.StartDate=new Date(A.Tables[0][p].StartDate.toString()).ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm a")),n.e.IsEmpty(A.Tables[0][p].EndDate)||(b.EndDate_Key=new Date(A.Tables[0][p].EndDate.toString()),b.EndDate=new Date(A.Tables[0][p].EndDate.toString()).ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm a")),b.Remarks=n.e.StringValue(A.Tables[0][p].Remarks),C.DetailGrid.addRow(b);return e.abrupt("return",void a.a.page.ShowDialog(C,T.a,{ShowCenter:!0,Title:C.Title}));case 39:if(!n.e.IsEmpty(this.Status.SelectedValue)){e.next=41;break}return e.abrupt("return",void alert("Select Status"));case 41:if(!this.Status.Mandatory||!n.e.IsEmpty(this.Status.SelectedValue)){e.next=43;break}return e.abrupt("return",void alert("Please Select the Status"));case 43:if(!this.Subject.Mandatory||!n.e.IsEmpty(this.Subject.Text)){e.next=45;break}return e.abrupt("return",void alert("Please Enter the subject"));case 45:if(!this.CustomerType.Mandatory||!n.e.IsEmpty(this.CustomerType.SelectedValue)){e.next=47;break}return e.abrupt("return",void alert("Please Select the customer type"));case 47:if(!this.CRMContactPerson.Mandatory||!n.e.IsEmpty(this.CRMContactPerson.Text)){e.next=49;break}return e.abrupt("return",void alert("Please Select the Contact Person"));case 49:if(!(null!=this.dtPreferences&&this.dtPreferences.Tables.length>0)){e.next=59;break}if(e.prev=50,this.StatusSelectedValue=this.Status.SelectedValue,"413"!=this.StatusSelectedValue){e.next=55;break}if(!((g=this.dtPreferences.Tables[0].filter((function(t){return"AttachmentAtClosedActivity"==t.Name}))).length>0&&""!=g[0].value.toString()&&Object(r.j)(g[0].value)&&null!=this.ViewAttachments&&0==this.ViewAttachments.AttachmentsList.length)){e.next=55;break}return e.abrupt("return",void alert("Please Include Attachment,While Closing Activity"));case 55:e.next=59;break;case 57:e.prev=57,e.t2=e.catch(50);case 59:if(this.res="No",R=-1,!("ReSchedule"==t.toString()&&this.ActivityID>0)){e.next=74;break}return e.next=64,i.e(118).then(i.bind(null,"gk6P"));case 64:return V=e.sent,f=V.MessageDialogViewModel,e.next=68,i.e(0).then(i.bind(null,"cc1I"));case 68:for(w=e.sent,E=w.MessageDialogViewModelComponent,(P=new f).MessageDialogViewModel_3(this,a.a.GetResource("Reschedule: This action will close current event and creates a new event with selected date & time. \r\nDo you want to continue?"),"Yes","No"),P.Date.Visible=!0,P.Date.Label="Reschedule Date",P.Date.Date=this.StartDate.Date,P.StartTime.Visible=!0,F=0;F<this.StartTime.Items.length;F++)P.StartTime.Items.push(this.StartTime.Items[F]);return e.abrupt("return",(P.StartTime.SelectedValue=this.StartTime.SelectedValue,void a.a.page.ShowDialog(P,E,{ShowCenter:!0,Title:P.lblTitle}).subscribe((function(){"Yes"==x.res&&(x.StartTime.SelectedValue=P.StartTime.SelectedValue,x.StartDate.Date=P.Date.Date,R=1,x.onSaveActivity_Complete(R))}))));case 74:if("ReSchedule"==t.toString()&&0==this.ActivityID){e.next=84;break}if(this.objParent.Activities=this,this.MessageVisibility=!1,this.DisplayMessage="",null==this.StartDate.Date||null==this.EndDate.Date||!(new Date(this.StartDate.Date)>new Date(this.EndDate.Date)||new Date(this.EndDate.Date)<new Date(this.StartDate.Date))){e.next=77;break}return e.abrupt("return",(this.MessageVisibility=!0,void(this.DisplayMessage="Invalid Date Selection")));case 77:if(!a.a.SessionManager.IsActionAssigned(1e3,"Do not allow future dated activities")&&!a.a.SessionManager.IsActionAssigned(1e3,"Do not allow past dated activities")){e.next=83;break}if(k=a.a.empService.GetQueryData(0,"getdate","","",""),!(a.a.SessionManager.IsActionAssigned(1e3,"Do not allow future dated activities")&&this.StartDate.Date>new Date(k.Tables[0][0][Object.keys(k.Tables[0][0])[0]]).AddDays(a.a.SessionManager.GetActionDays(1e3,"Do not allow future dated activities")))){e.next=81;break}return e.abrupt("return",(this.MessageVisibility=!0,void(this.DisplayMessage="Future date activities not allowed")));case 81:if(!(a.a.SessionManager.IsActionAssigned(1e3,"Do not allow past dated activities")&&this.StartDate.Date<new Date(k.Tables[0][0][Object.keys(k.Tables[0][0])[0]]).AddDays(-a.a.SessionManager.GetActionDays(1e3,"Do not allow past dated activities")))){e.next=83;break}return e.abrupt("return",(this.MessageVisibility=!0,void(this.DisplayMessage="Back dated activities not allowed")));case 83:this.onSaveActivity_Complete(R);case 84:case"end":return e.stop()}}),e,this,[[5,22],[50,57]])})))}},{key:"onSaveActivity_Complete",value:function(t){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var i,s,r,o,l,c,m,y,D,A,v,p,b,g,T,I,R,V,f,w,M,E,P,F,k,x,G,L,_,O,N,j,U,q,W,B,X=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.FromCalendar){e.next=8;break}for(i=1,s=0,"3"!=this.ActivityType.SelectedValue&&"4"!=this.ActivityType.SelectedValue||(i=this.ActivitiesTempGrid.Table.length,null!=(r=a.a.common.GetDataSet("CALACT001",""))&&r.Tables[0].length>0&&(s=n.e.IsEmpty(r.Tables[0][0][r.Columns[0][0]])?1:parseInt(r.Tables[0][0][r.Columns[0][0]]))),this.ActivityID>0&&(i=1),o=0;o<i;o++){for(l=null,(c=[]).push(parseInt(this.ActivityType.SelectedValue)),c.push(0),"RCalenderViewModel"==this.objParent.ClassName?(l=this.objParent,c.push(-100!=l.CCID?l.CCID:1e3)):c.push(86),this.Status.SelectedValue!=this.StatusSelectedValue&&(this.StatusSelectedValue=this.Status.SelectedValue),c.push(parseInt(this.StatusSelectedValue)),c.push(this.Subject.Text),c.push(parseInt(this.Priority.SelectedValue)),c.push(this.Location.Text),c.push(this.IsAllDayActivity.IsChecked),"1"==this.CustomerType.SelectedValue||"2"==this.CustomerType.SelectedValue?(c.push(this.CRMCustomer.Code.Text),c.push(this.CRMCustomer.Code.SelectedValue)):(c.push(this.CRMCustomer.Text),c.push(0)),c.push(this.CustomerType.Visible?this.CustomerType.Items.find((function(t){return t.Value==X.CustomerType.SelectedValue})).Name:"None"),void 0,y=this.Remarks.Xaml.toString(),null!=this.Remarks.Tag&&""!=this.Remarks.Tag&&(y=this.Remarks.Tag),c.push(y),this.ActivityID>0?(c.push(this.StartDate.Date),c.push(this.EndDate.Date)):0==this.ActivityID&&("3"==this.ActivityType.SelectedValue||"4"==this.ActivityType.SelectedValue?(c.push(new Date(this.ActivitiesTempGrid.Table[o].StartDate_Key).ToString("dd/MMM/yyyy")),c.push(new Date(this.ActivitiesTempGrid.Table[o].EndDate_Key).ToString("dd/MMM/yyyy"))):(c.push(this.StartDate.Date.ToString("dd/MMM/yyyy")),c.push(this.EndDate.Date.ToString("dd/MMM/yyyy")))),m=this.ActualCloseDate.Date.ToString("dd/MMM/yyyy hh:mm a"),c.push(this.ActualCloseDate.Visible?m:"01/01/1900"),c.push("01/01/1900 "+n.e.String(this.ActualCloseTime.SelectedValue)),c.push("01/01/1900 "+this.StartTime.SelectedValue),c.push("01/01/1900 "+this.EndTime.SelectedValue),c.push(t),c.push(null!=this.AssignUserList&&this.AssignUserList.Items.length>0&&!n.e.IsEmpty(this.AssignUserList.SelectedValue)?parseInt(this.AssignUserList.SelectedValue):a.a.SessionManager.UserID),D="",A=0;A<this.Fields.length;A++)(v=this.Fields[A])instanceof h.d&&(this.oText=v,D+=this.oText.SysColumnName+"='"+this.oText.Text.Replace("'","''")+"' ,"),v instanceof d.b?(this.oTime=v,D+=this.oTime.SysColumnName+"='"+this.oTime.Date+"' ,"):v instanceof d.a&&(this.oDate=v,D+=this.oDate.SysColumnName+"='"+this.oDate.Date+"' ,"),v instanceof u.e&&(this.oCombo=v,D+=this.oCombo.SysColumnName+"='"+this.oCombo.SelectedValue.Replace("'","''")+"' ,"),v instanceof C.a&&(this.OComboText=v,D+=this.OComboText.SysColumnName+"='"+this.OComboText.TextBox.Text.Replace("'","''")+"' ,"),v instanceof h.c&&(this.oTextArea=v,D+=this.oTextArea.SysColumnName+"='"+this.oTextArea.Text.Replace("'","''")+"' ,"),v instanceof S.b&&(this.oPactCombo=v,D+=this.oPactCombo.SysColumnName+"='"+this.oPactCombo.SelectedValue+"' ,");c.push(D.length>0?D.toString().Trim(","):""),c.push(null!=this.ViewAttachments?this.ViewAttachments.GetXML():""),"RCalenderViewModel"==this.objParent.ClassName&&(l=this.objParent,c.push(l.ActivityID)),"3"==this.ActivityType.SelectedValue||"4"==this.ActivityType.SelectedValue?(this.Recur.SetSaveData(),c.push(s),c.push(this.Recur.FreqType),c.push(this.Recur.FreqInterval),c.push(this.Recur.FreqSubdayType),c.push(this.Recur.FreqSubdayInterval),c.push(this.Recur.FreqRelativeInterval),c.push(this.Recur.FreqRecurrenceFactor),c.push(this.Recur.FirstPostingDate.Date.ToString("dd/MMM/yyyy")),p=new Date(this.Recur.StartingTime.SelectedValue),c.push(p.getHours().PrefixZero(2)+":"+p.getMinutes().PrefixZero(2)+":"+p.getSeconds().PrefixZero(2)),c.push(this.Recur.EndDate.Date.ToString("dd/MMM/yyyy")),c.push(p.getHours().PrefixZero(2)+":"+p.getMinutes().PrefixZero(2)+":"+p.getSeconds().PrefixZero(2))):(c.push(0),c.push(0),c.push(0),c.push(0),c.push(0),c.push(0),c.push(0),c.push(null),c.push(null),c.push(null),c.push(null)),c.push(this.CRMContactPerson.SelectedValue>0?this.CRMContactPerson.SelectedValue:null),b=0,g=a.a.cases.SaveActivity(c,b),this.DisplayMessage=g.Message,b=g.RetValue,this.MessageVisibility=!0,b>0&&(l.ActivityID=0,this.IsPopup&&a.a.page.HideDialog(),"3"!=this.ActivityType.SelectedValue&&"4"!=this.ActivityType.SelectedValue&&this.ClearFields())}this.FromCalendar&&alert(this.DisplayMessage),e.next=15;break;case 8:if(T="",I="",R="",1!=t){e.next=13;break}if(null!=this.Selectedrow){e.next=12;break}return e.abrupt("return");case 12:this.Selectedrow.schStatus=413,this.Selectedrow.Status="Close",this.Selectedrow.isEdited="1",T=this.dr.UsersXML.toString(),R=this.dr.GroupXML.toString(),I=this.dr.RolesXML.toString(),this.Selectedrow=null,this.ActivityID=0;case 13:if(0==this.ActivityID&&null==this.Selectedrow){for(V=1,"3"!=this.ActivityType.SelectedValue&&"4"!=this.ActivityType.SelectedValue||(V=this.ActivitiesTempGrid.Table.length),f=0;f<V;f++){for(this.dr=this.objParent.ViewActivities.ActivityGridDataObj.NewRow(),this.Recur.SetSaveData(),0==this.objParent.ViewActivities.ActivityGridDataObj.Columns.length&&(this.objParent.ViewActivities.ActivitisActualData(),this.dr=this.objParent.ViewActivities.ActivityGridDataObj.NewRow()),this.dr.View="View",this.dr.FreqType=this.Recur.FreqType,this.dr.FreqInterval=this.Recur.FreqInterval,this.dr.FreqSubdayType=this.Recur.FreqSubdayType,this.dr.FreqSubdayInterval=this.Recur.FreqSubdayInterval,this.dr.FreqRelativeInterval=this.Recur.FreqRelativeInterval,this.dr.FreqRecurrenceFactor=this.Recur.FreqRecurrenceFactor,null!=this.dr.UserName&&(this.dr.UserName=a.a.SessionManager.UserName),"3"==this.ActivityType.SelectedValue||"4"==this.ActivityType.SelectedValue?(this.dr.CStartDate=new Date(this.Recur.FirstPostingDate.Date),this.dr.CEndDate=new Date(this.Recur.EndDate.Date),w=new Date(this.ActivitiesTempGrid.Table[f].StartTime.toString()),this.dr.StartTime=this.returnTimeString(w.getHours().toString())+":"+this.returnTimeString(w.getMinutes().toString())+":"+this.returnTimeString(w.getSeconds().toString()),this.dr.ActStartDate=new Date(this.ActivitiesTempGrid.Table[f].StartDate_Key).ToString(a.a.SessionManager.Preferences["Date Format"].toString()),this.dr.ActStartDate_Key=new Date(this.ActivitiesTempGrid.Table[f].StartDate_Key),this.dr.ActEndDate=new Date(this.ActivitiesTempGrid.Table[f].EndDate_Key).ToString(a.a.SessionManager.Preferences["Date Format"].toString()),this.dr.ActEndDate_Key=new Date(this.ActivitiesTempGrid.Table[f].EndDate_Key),this.dr.ActStartTime="01/01/1900 "+this.ActivitiesTempGrid.Table[f].StartTime.toString(),this.dr.ActEndTime="01/01/1900 "+this.ActivitiesTempGrid.Table[f].EndTime.toString(),this.dr.SchID=this.ActivitiesTempGrid.Table[f].SchID.toString(),this.dr.ScheduleID=this.ActivitiesTempGrid.Table[f].SchID.toString()):(this.dr.CStartDate=this.Recur.FirstPostingDate.Date,this.dr.CEndDate=this.Recur.RangeEnd.Items[0].IsChecked?null:this.Recur.EndDate.Date,M=Date.WithTime(this.Recur.StartingTime.SelectedValue),this.dr.StartTime=this.returnTimeString(M.getHours().toString())+":"+this.returnTimeString(M.getMinutes().toString())+":"+this.returnTimeString(M.getSeconds().toString()),this.dr.ActStartDate=this.StartDate.Date.ToString(a.a.SessionManager.Preferences["Date Format"].toString()),this.dr.ActStartDate_Key=this.StartDate.Date,this.dr.ActEndDate=this.EndDate.Date.ToString(a.a.SessionManager.Preferences["Date Format"].toString()),this.dr.ActEndDate_Key=this.EndDate.Date,this.dr.ActStartTime="01/01/1900 "+this.StartTime.SelectedValue,this.dr.ActEndTime="01/01/1900 "+this.EndTime.SelectedValue,this.dr.SchID=0,this.dr.ScheduleID=0),this.dr.ActivityID="0",this.dr.ActivityTypeID=this.ActivityType.SelectedValue,this.dr.CostCenterID=89,this.dr.NodeID="1",this.Status.SelectedValue!=this.StatusSelectedValue&&(this.StatusSelectedValue=this.Status.SelectedValue),this.dr.schStatus=this.StatusSelectedValue,this.dr.Subject=this.Subject.Text,this.dr.Priority=this.Priority.SelectedValue,this.dr.PctComplete=this.PctComplete.Text,this.dr.Location=this.Location.Text,this.dr.IsAllDayActivity=this.IsAllDayActivity.IsChecked,1==this.ActualCloseDate.Visible?(this.dr.ActualCloseDate_key=this.ActualCloseDate.Date,this.dr.ActualCloseDate=this.ActualCloseDate.Date.ToString(a.a.SessionManager.Preferences["Date Format"].toString()),this.dr.ActualCloseTime=this.ActualCloseTime.SelectedValue.toString()):"3"==this.ActivityType.SelectedValue||"4"==this.ActivityType.SelectedValue?(this.dr.ActualCloseDate=this.Recur.EndDate.Date,E=Date.WithTime(this.Recur.StartingTime.SelectedValue),this.dr.ActualCloseTime=this.returnTimeString(E.getHours().toString())+":"+this.returnTimeString(E.getMinutes().toString())+":"+this.returnTimeString(E.getSeconds().toString())):(this.dr.ActualCloseDate="",this.dr.ActualCloseTime=""),this.dr.CustomerID=this.CRMCustomer.Text,this.dr.ContactID=this.CRMContactPerson.SelectedValue>0?this.CRMContactPerson.SelectedValue:0,P=null!=this.Remarks.Xaml?this.Remarks.Xaml.toString():"",null!=this.Remarks.Tag&&""!=this.Remarks.Tag&&(P=this.Remarks.Tag),this.dr.Remarks=P,this.dr.AssignGroupID="1",this.dr.AssignRoleID="1",this.dr.AssignUserID=this.AssignUserList.SelectedValue,1==t&&(this.dr.UsersXML=T,this.dr.GroupXML=R,this.dr.RolesXML=I),this.ActivityType.Text=this.ActivityType.GetText(),this.dr.Activity=this.ActivityType.Text,this.dr.Subject=this.Subject.Text,this.dr.AttachmentXML=this.ViewAttachments.GetXML(),"412"==this.StatusSelectedValue?this.dr.Status="Open":"413"==this.StatusSelectedValue?this.dr.Status="Close":"8"==this.StatusSelectedValue?this.dr.Status="Confirmed":"414"==this.StatusSelectedValue&&(this.dr.Status="Re-Schedule"),F=0;F<this.Fields.length;F++)(k=this.Fields[F])instanceof h.d?(this.oText=k,this.dr[this.oText.SysColumnName]=this.oText.Text):k instanceof d.b?(this.oTime=k,this.dr[this.oTime.SysColumnName]=this.oTime.Date):k instanceof d.a?(this.oDate=k,this.dr[this.oDate.SysColumnName]=this.oDate.Date):k instanceof u.e?(this.oCombo=k,this.dr[this.oCombo.SysColumnName]=this.oCombo.SelectedValue):k instanceof C.a?(this.OComboText=k,this.dr[this.OComboText.SysColumnName]=this.OComboText.TextBox.Text):k instanceof h.c?(this.oTextArea=k,this.dr[this.oTextArea.SysColumnName]=this.oTextArea.Text):k instanceof S.b&&(this.oPactCombo=k,this.dr[this.oPactCombo.SysColumnName+"_Key"]=this.oPactCombo.SelectedValue,this.dr[this.oPactCombo.SysColumnName]=this.oPactCombo.Text);this.objParent.ViewActivities.ActivityGridData.push(this.dr),this.objParent.ViewActivities.ActVisibility=!0,this.objParent.ViewActivities.ActivityGridDataObj.RefreshGridView()}this.OneActivity||null!=this.objParent&&"QuickAddLeads"==this.objParent.ClassName||this.ClearFields()}else{for(this.Recur.SetSaveData(),this.Selectedrow.FreqType=this.Recur.FreqType,this.Selectedrow.FreqInterval=this.Recur.FreqInterval,this.Selectedrow.FreqSubdayType=this.Recur.FreqSubdayType,this.Selectedrow.FreqSubdayInterval=this.Recur.FreqSubdayInterval,this.Selectedrow.FreqRelativeInterval=this.Recur.FreqRelativeInterval,this.Selectedrow.FreqRecurrenceFactor=this.Recur.FreqRecurrenceFactor,this.Selectedrow.CStartDate=this.Recur.FirstPostingDate.Date,this.Selectedrow.CEndDate=this.Recur.RangeEnd.Items[0].IsChecked?null:this.Recur.EndDate.Date,x=Date.WithTime(this.Recur.StartingTime.SelectedValue),this.Selectedrow.StartTime=this.returnTimeString(x.getHours().toString())+":"+this.returnTimeString(x.getMinutes().toString())+":"+this.returnTimeString(x.getSeconds().toString()),this.Selectedrow.ActivityTypeID=this.ActivityType.SelectedValue,this.Selectedrow.CostCenterID=this.objParent.CostCenterID,this.Selectedrow.NodeID=1,this.Status.SelectedValue!=this.StatusSelectedValue&&(this.StatusSelectedValue=this.Status.SelectedValue),this.Selectedrow.schStatus=this.StatusSelectedValue,this.Selectedrow.Subject=this.Subject.Text,this.Selectedrow.Priority=this.Priority.SelectedValue,this.Selectedrow.PctComplete=this.PctComplete.Text,this.Selectedrow.Location=this.Location.Text,this.Selectedrow.IsAllDayActivity=this.IsAllDayActivity.IsChecked,1==this.ActualCloseDate.Visible?(this.Selectedrow.ActualCloseDate_key=this.ActualCloseDate.Date,this.Selectedrow.ActualCloseDate=this.ActualCloseDate.Date.ToString(a.a.SessionManager.Preferences["Date Format"].toString()),this.Selectedrow.ActualCloseTime="01/01/1900 "+this.ActualCloseTime.SelectedValue.toString()):"1"!=this.ActivityType.SelectedValue&&"2"!=this.ActivityType.SelectedValue||(this.Selectedrow.ActualCloseDate="",this.Selectedrow.ActualCloseTime=""),this.Selectedrow.ActStartDate=this.StartDate.Date.ToString(a.a.SessionManager.Preferences["Date Format"].toString()),this.Selectedrow.ActStartDate_Key=this.StartDate.Date,this.Selectedrow.ActEndDate=this.EndDate.Date.ToString(a.a.SessionManager.Preferences["Date Format"].toString()),this.Selectedrow.ActEndDate_Key=this.EndDate.Date,this.Selectedrow.ActStartTime="01/01/1900 "+this.StartTime.SelectedValue,this.Selectedrow.ActEndTime="01/01/1900 "+this.EndTime.SelectedValue,this.Selectedrow.CustomerID=this.CRMCustomer.Text,this.CRMContactPerson.SelectedValue>0&&(this.Selectedrow.ContactID=this.CRMContactPerson.SelectedValue),G=this.Remarks.Xaml.toString(),null!=this.Remarks.Tag&&""!=this.Remarks.Tag&&(G=this.Remarks.Tag),this.Selectedrow.Remarks=G,this.Selectedrow.AssignGroupID="1",this.Selectedrow.AssignRoleID="1",this.Selectedrow.AssignUserID=this.AssignUserList.SelectedValue,this.ActivityType.Text=this.ActivityType.GetText(),this.Selectedrow.Activity=this.ActivityType.Text,this.Selectedrow.isEdited="1",this.Selectedrow.Subject=this.Subject.Text,this.Selectedrow.AttachmentXML=this.ViewAttachments.GetXML(),"412"==this.StatusSelectedValue?this.Selectedrow.Status="Open":"413"==this.StatusSelectedValue?this.Selectedrow.Status="Close":"8"==this.StatusSelectedValue?this.Selectedrow.Status="Confirmed":"414"==this.StatusSelectedValue?this.Selectedrow.Status="Re-Schedule":"9"==this.StatusSelectedValue?this.Selectedrow.Status="In-Progress":"12"==this.StatusSelectedValue&&(this.Selectedrow.Status="On-Hold"),L=0;L<this.Fields.length;L++)(_=this.Fields[L])instanceof h.d&&(this.oText=_,this.Selectedrow[this.oText.SysColumnName]=this.oText.Text),_ instanceof d.b?(O=_,this.oTime=_,O.Date?(N=O.Date,O.ShowTimePicker&&1900!=O.Date.getFullYear()&&(N=(N=(N=(N=new Date(1900,1,1)).AddHours(O.Date.getHours())).AddMinutes(O.Date.getMinutes())).AddSeconds(O.Date.getSeconds())),this.Selectedrow[this.oTime.SysColumnName]=N.ToString("dd/MMM/yyyy hh:mm a")):this.Selectedrow[this.oTime.SysColumnName]=this.oTime.Date):_ instanceof d.a&&(this.oDate=_,this.Selectedrow[this.oDate.SysColumnName]=this.oDate.Date),_ instanceof u.e&&(this.oCombo=_,this.Selectedrow[this.oCombo.SysColumnName]=this.oCombo.SelectedValue),_ instanceof C.a&&(this.OComboText=_,this.Selectedrow[this.OComboText.SysColumnName]=this.OComboText.TextBox.Text),_ instanceof h.c&&(this.oTextArea=_,this.Selectedrow[this.oTextArea.SysColumnName]=this.oTextArea.Text),_ instanceof S.b&&(this.oPactCombo=_,this.Selectedrow[this.oPactCombo.SysColumnName+"_Key"]=this.oPactCombo.SelectedValue,this.Selectedrow[this.oPactCombo.SysColumnName]=this.oPactCombo.Text);this.objParent.ViewActivities.ActivityGridDataObj.updateRow(this.Selectedrow),this.objParent.ViewActivities.ActivityData=this.objParent.ViewActivities.ActivityGridData,this.OneActivity||null!=this.objParent&&("QuickAddLeads"==this.objParent.ClassName||"QuickAddCaseViewModel"==this.objParent.ClassName)||this.ClearFields()}"AddEditDocumentViewModel"==this.objParent.ClassName&&this.CheckSign(),this.objParent.NodeID>0&&((j=[]).push(this.objParent.ViewActivities.ActivitiesXML()),j.push(this.objParent.CostCenterID),j.push(this.objParent.NodeID),j.push(a.a.SessionManager.CompanyGUID),j.push(n.e.NewGuid()),j.push(a.a.SessionManager.UserName),j.push(new Date),j.push(a.a.SessionManager.LanguageID),0,q=a.a.cases.SetActivitiesAndSchedules(j),this.DisplayMessage=q.Message,this.FromCalendar&&alert(this.DisplayMessage),U=q.RetValue,this.MessageVisibility=!0,U>0&&(0==this.ActivityID?null!=(W=this.objParent.ViewActivities.ActivityGridData.filter((function(t){return 0==t.ActivityID})))&&W.length>0&&(W[0].ActivityID=U):this.objParent.ViewActivities.tempActivityDataColumn.Contains("isEdited")&&null!=(B=this.objParent.ViewActivities.ActivityGridData.filter((function(t){return"1"==t.isEdited})))&&B.length>0&&(B[0].isEdited=""),this.ActivityID=0,this.Selectedrow=null));case 15:case"end":return e.stop()}}),e,this)})))}},{key:"returnTimeString",value:function(t){return t.length>1?t:("0"+t).toString()}},{key:"ClearFields",value:function(){if(this.OneActivity&&(this.Selectedrow=null),this.ActivityID=0,this.FeatureLable="",this.Subject.Text="",null!=this.ViewAttachments&&this.ViewAttachments.AttachmentsListObj.Clear(),this.ViewAttachVisible=!1,this.Location.Enable&&(this.Location.Text=""),this.CRMCustomer.Enable&&(this.CRMCustomer.Text=""),this.Remarks.Text="",this.Remarks.Xaml="",this.CRMContactPerson.Text="",this.ActStartDate.Date=null,this.ActStartTime.SelectedValue="",this.ActEndDate.Date=null,this.ActSign.Visible){var t=this.ActSign.Row;this.ActSign=new V.c(0),this.IsPopup?this.Remarks.Visible?(this.ActSign.Row=4,this.ActSign.Column=3):(this.ActSign.Row=0,this.ActSign.Column=3):this.ActSign.Row=t}this.ActEndTime.SelectedValue="",this.StartDate.Date=new Date,this.EndDate.Date=new Date,this.AssignUserList.SelectedValue=a.a.SessionManager.UserID.toString();for(var e=0;e<this.Fields.length;e++){var i=this.Fields[e];i instanceof h.d&&(this.oText=i,this.oText.Text=""),i instanceof d.a&&(this.oDate=i),i instanceof u.e&&(this.oCombo=i,this.oCombo.SelectedValue=""),i instanceof C.a&&(this.OComboText=i,this.OComboText.TextBox.Text=""),i instanceof h.c&&(this.oTextArea=i,this.oTextArea.Text=""),i instanceof S.b&&(this.oPactCombo=i,this.oPactCombo.SelectedValue=0)}this.SetActions()}},{key:"enablecontrols",value:function(t){this.Fields.forEach((function(e){e.Enable=t})),this.ActivityType.Enable=t,this.Exp.Enable=t,this.ActivityText.Enable=t,this.Status.Enable=t,this.Subject.Enable=t,this.StartDate.Enable=t,this.EndDate.Enable=t,this.IsAllDayActivity.Enable=t,this.ActualCloseDate.Enable=t,this.ActualCloseTime.Enable=t,this.CustomerType.Enable=t,this.CRMContactPerson.Enable=t,this.AssignUserList.Enable=t,this.StartTime.Enable=t,this.EndTime.Enable=t,this.ButtonSave.Enable=t}},{key:"ActivityID",get:function(){return this._ActivityID},set:function(t){var e;this._ActivityID=t,0==this._ActivityID?this.InviteLabel.Visible=!1:201!=(null===(e=this.objParent)||void 0===e?void 0:e.DocumentType)&&(this.InviteLabel.Visible=!0)}},{key:"AssignVisiblity",get:function(){return this._AssignVisiblity},set:function(t){0==t&&(this.AssignVisiblity2=!1),t!=this._AssignVisiblity&&(this._AssignVisiblity=t)}},{key:"StatusSelectedText",get:function(){return this._StatusSelectedText},set:function(t){t!=this._StatusSelectedText?(this._StatusSelectedText=t,this.Status.Text=this._StatusSelectedText):null==this.Status.Text&&(this.Status.Text=this._StatusSelectedText)}},{key:"StatusSelectedValue",get:function(){return this._StatusSelectedValue},set:function(t){t!=this._StatusSelectedValue?(this._StatusSelectedValue=t,this.Status.SelectedValue=this._StatusSelectedValue):null==this.Status.SelectedValue&&(this.Status.SelectedValue=this._StatusSelectedValue)}},{key:"IsPopup",get:function(){return this._IsPopup},set:function(t){this._IsPopup!=t&&(this._IsPopup=t,this.AssignRowColumns())}},{key:"SelectedStatusIndex",get:function(){return this._SelectedStatusIndex},set:function(t){this._SelectedStatusIndex=t,this.Status.SelectedIndex=this._SelectedStatusIndex}}]),p}(p.b),M=function(t){_inherits(i,t);var e=_createSuper(i);function i(){var t;return _classCallCheck(this,i),(t=e.call(this)).FromDate=new d.a,t.FromTime=new u.e(0),t.Reason=new h.d(0),t.ButtonClick=new c.b,t.Reason.Visible=!1,t.Reason.Label="Reason",t.ButtonClick.Subscribe(_assertThisInitialized(t),"onCLick"),t.Title="Select Date",t}return _createClass(i,[{key:"PickDateViewModel",value:function(t){this.Type=t,this.ButtonClick.Subscribe(this,"onCLick"),1==t?(this.DetailGrid=new l.a,this.GridVisible=!0):this.Title="Select Date"}},{key:"onCLick",value:function(t){"OK"==t&&(this.DailogResult=!0),a.a.page.HideDialog()}}]),i}(p.b)},yWgc:function(t,e,i){"use strict";i.r(e),i.d(e,"AssignFeatureComponent",(function(){return D}));var s=i("3Pt+"),a=i("fXoL");function n(t,e){if(1&t&&(a.Zb(0,"div",9),a.Wc(1,"\n          "),a.Vb(2,10),a.Wc(3,"\n        "),a.Yb()),2&t){var i=a.lc();a.Db(2),a.tc("obj",i.obj.SelectedNode)("group",i.obj.form)}}function r(t,e){if(1&t&&(a.Zb(0,"div",9),a.Wc(1,"\n            "),a.Vb(2,10),a.Wc(3,"\n          "),a.Yb()),2&t){var i=a.lc();a.Db(2),a.tc("obj",i.obj.InviteComments)("group",i.obj.form)}}function o(t,e){if(1&t&&(a.Zb(0,"div",9),a.Wc(1,"\n            "),a.Vb(2,10),a.Wc(3,"\n          "),a.Yb()),2&t){var i=a.lc();a.Db(2),a.tc("obj",i.obj.TypeOfAssigning)("group",i.obj.form)}}function l(t,e){if(1&t&&(a.Zb(0,"div",9),a.Wc(1,"\n              "),a.Vb(2,10),a.Wc(3,"\n            "),a.Yb()),2&t){var i=a.lc(2);a.Db(2),a.tc("obj",i.obj.Teams)("group",i.obj.form)}}function c(t,e){if(1&t&&(a.Zb(0,"div",9),a.Wc(1,"\n              "),a.Vb(2,10),a.Wc(3,"\n            "),a.Yb()),2&t){var i=a.lc(2);a.Db(2),a.tc("obj",i.obj.AssignUser)("group",i.obj.form)}}function h(t,e){if(1&t&&(a.Zb(0,"div"),a.Wc(1),a.Yb()),2&t){var i=a.lc(2);a.Db(1),a.Yc("\n                ",i.obj.CompanyName,"\n            ")}}function u(t,e){if(1&t&&(a.Zb(0,"div"),a.Wc(1,"\n            "),a.Uc(2,l,4,2,"div",2),a.Wc(3,"\n            "),a.Uc(4,c,4,2,"div",2),a.Wc(5,"\n            "),a.Uc(6,h,2,1,"div",3),a.Wc(7,"\n        "),a.Yb()),2&t){var i=a.lc();a.Db(2),a.tc("ngIf",i.obj.Teams.Visible),a.Db(2),a.tc("ngIf",i.obj.AssignUser.Visible),a.Db(2),a.tc("ngIf",i.obj.LabelVisibility)}}function d(t,e){if(1&t&&(a.Zb(0,"div",9),a.Wc(1,"\n            "),a.Vb(2,10),a.Wc(3,"\n        "),a.Yb()),2&t){var i=a.lc();a.Db(2),a.tc("obj",i.obj.RolesItemsObj)("group",i.obj.form)}}function m(t,e){if(1&t&&(a.Zb(0,"div",9),a.Wc(1,"\n            "),a.Vb(2,10),a.Wc(3,"\n        "),a.Yb()),2&t){var i=a.lc();a.Db(2),a.tc("obj",i.obj.UsersItemsObj)("group",i.obj.form)}}function S(t,e){if(1&t&&(a.Zb(0,"div",9),a.Wc(1,"\n            "),a.Vb(2,10),a.Wc(3,"\n        "),a.Yb()),2&t){var i=a.lc();a.Db(2),a.tc("obj",i.obj.GroupsItemsObj)("group",i.obj.form)}}function y(t,e){if(1&t&&(a.Zb(0,"div",9),a.Wc(1,"\n            "),a.Vb(2,10),a.Wc(3,"\n          "),a.Yb()),2&t){var i=a.lc();a.Db(2),a.tc("obj",i.obj.AssignDate)("group",i.obj.form)}}var D=function(){var t=function(){function t(){_classCallCheck(this,t),this.group=new s.j({})}return _createClass(t,[{key:"ngOnInit",value:function(){}}]),t}();return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=a.Nb({type:t,selectors:[["app-assign-feature"]],decls:37,vars:15,consts:[[1,"master-screen",3,"formGroup"],[1,"PACTHeaderFields","dialogSubBody"],["class","form-group col PACTControl",4,"ngIf"],[4,"ngIf"],[1,"Pactdailogfooter"],[1,"primary-btn-wicon",3,"click"],[1,"fa-light","fa-floppy-disk"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-rectangle-xmark"],[1,"form-group","col","PACTControl"],["FieldDirective","",3,"obj","group"]],template:function(t,e){1&t&&(a.Zb(0,"div",0),a.Wc(1,"\n    "),a.Zb(2,"div",1),a.Wc(3,"\n        "),a.Uc(4,n,4,2,"div",2),a.Wc(5,"\n        "),a.Uc(6,r,4,2,"div",2),a.Wc(7,"\n          "),a.Uc(8,o,4,2,"div",2),a.Wc(9,"\n         "),a.Uc(10,u,8,3,"div",3),a.Wc(11,"\n\n        "),a.Uc(12,d,4,2,"div",2),a.Wc(13,"\n        "),a.Uc(14,m,4,2,"div",2),a.Wc(15,"\n        "),a.Uc(16,S,4,2,"div",2),a.Wc(17,"\n          \n          "),a.Uc(18,y,4,2,"div",2),a.Wc(19,"\n  "),a.Yb(),a.Wc(20,"\n\n  "),a.Zb(21,"div",4),a.Wc(22,"\n    "),a.Zb(23,"div"),a.Wc(24,"\n        "),a.Zb(25,"button",5),a.hc("click",(function(){return e.obj.OnSave("Save")})),a.Ub(26,"i",6),a.Wc(27),a.mc(28,"translate"),a.Yb(),a.Wc(29,"\n        "),a.Zb(30,"button",7),a.hc("click",(function(){return e.obj.OnSave("Cancel")})),a.Ub(31,"i",8),a.Wc(32),a.mc(33,"translate"),a.Yb(),a.Wc(34,"\n    "),a.Yb(),a.Wc(35,"      \n  "),a.Yb(),a.Wc(36,"\n"),a.Yb()),2&t&&(a.tc("formGroup",e.obj.group),a.Db(4),a.tc("ngIf",e.obj.SelectedNode.Visible),a.Db(2),a.tc("ngIf",e.obj.InviteComments.Visible),a.Db(2),a.tc("ngIf",e.obj.TypeOfAssigning.Visible),a.Db(2),a.tc("ngIf",e.obj.TeamVisible),a.Db(2),a.tc("ngIf",e.obj.RolesItemsObj.Visible),a.Db(2),a.tc("ngIf",e.obj.UsersItemsObj.Visible),a.Db(2),a.tc("ngIf",e.obj.GroupsItemsObj.Visible),a.Db(2),a.tc("ngIf",e.obj.AssignDate.Visible),a.Db(9),a.Xc(a.nc(28,11,"Save")),a.Db(5),a.Xc(a.nc(33,13,"Cancel")))},encapsulation:2}),t}()}}]);
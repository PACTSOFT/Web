(window.webpackJsonp=window.webpackJsonp||[]).push([[173],{CxGV:function(e,t,i){"use strict";i.r(t),i.d(t,"DeletedRecords",(function(){return U})),i.d(t,"AddUOMViewModel",(function(){return u}));var s=i("Do2H"),n=i("Lp6j"),a=i("ScVY"),r=i("NkMH"),o=i("0/4Q"),l=i("4HhE"),h=i("Agar"),d=i("8B8H"),g=i("ockk"),b=i("EQd/");class U{constructor(e){this.iSeqno=0,this.iSeqno=e}}class u extends a.b{constructor(){super(),this.ScreenName="",this.SaveUOM=new l.b,this.SelectionChangedCommand=new l.b,this.DeleteBase=new l.b,this.NewBase=new l.b,this.cmnItem_Click=new l.b,this.ButtonSave=new r.a,this.lstDeletedRecords=[],this.textChangedUnit=new l.b,this.Units1=new o.e(0),this.PACTControlData=[],this.GridUnitsObj=new d.a,this.BaseTextObj=new b.d(0),this.res="",this.SNO=1,this.RetValue=0,this.Flag=!1,this.textChangedUnit.Subscribe(this,"ontextChangedUnit"),Logger.InfoLog("AddUOMViewModel::Entering AddUOMViewModel"),this.DisplayName=s.a.GetResource("UOM_ScreenName"),s.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=s.a.SessionManager.IsActionAssigned(11,"Create"):this.ButtonSave.Enable=s.a.SessionManager.IsActionAssigned(11,"Create"),s.a.SessionManager.HideUnathorizedAccess&&!this.ButtonSave.Visible?this.ButtonSave.Visible=s.a.SessionManager.IsActionAssigned(11,"Update"):this.ButtonSave.Enable||(this.ButtonSave.Enable=s.a.SessionManager.IsActionAssigned(11,"Update")),this.MessageVisibility=!1,this.SaveUOM.Subscribe(this,"onSaveUOM"),this.NewBase.Subscribe(this,"NewBase_Click"),this.SelectionChangedCommand.Subscribe(this,"onSelectionChanged"),this.DeleteBase.Subscribe(this,"onDeleteBase"),this.cmnItem_Click.Subscribe(this,"OnCmnItem_Click"),new h.a(0),this.ScreenID="1002",this.PactScreenID="1002",this.ScreenName="Create UOM",this.DetailsVisibility=!0,this.BindBase(),this.BindGridUnits(),Logger.InfoLog("AddUOMViewModel::Exiting AddUOMViewModel")}get dtTable(){return this.GridUnitsObj.Table}get BaseVisibility(){return this._BaseVisibility}set BaseVisibility(e){this._BaseVisibility=e,e&&(this._DetailsVisibility=!1)}get DetailsVisibility(){return this._DetailsVisibility}set DetailsVisibility(e){this._DetailsVisibility=e,e&&(this._BaseVisibility=!1)}get angularGrid(){return this.GridUnitsObj.angularGrid}get GridUnits(){return this.GridUnitsObj.Table}get Columns(){return this.GridUnitsObj.Columns}set Columns(e){this.GridUnitsObj.Columns=e}get GridUnitsColumns(){return this.GridUnitsObj.TableColumns}get GridUnitsColumnSource(){return this.GridUnitsObj.Columns}get BaseText(){return this.BaseTextObj.Text}set BaseText(e){e!=this.BaseTextObj.Text&&(this.BaseTextObj.Text=e)}OnCmnItem_Click(e){if(Logger.InfoLog("AddUOMViewModel::Entering OnCmnItem_Click"),this.SelectedNode<0)this.DisplayMessage="Please Select Particular cell to remove",this.MessageVisibility=!0;else switch(this.SelectedNode<this.dtTable.length&&(this.res=""),e){case"DELETE":let e=0;for(let t=0;t<this.dtTable.length;t++)if(e=parseInt(this.dtTable[t].SNO),this.SelectedNode==e-1&&!n.e.IsEmpty(this.dtTable[t].UnitID)&&!n.e.IsEmpty(this.dtTable[t].PrimayColumn)){if("1"!=this.dtTable[t].UnitID.toString()){confirm("Are you Sure You Want To Delete this Unit ? ")?(this.lstDeletedRecords.push(new U(parseInt(this.dtTable[t].PrimayColumn.toString()))),this.res="Yes"):this.res="No";break}confirm("This Unit will delete Base name:Are you sure ? ")?(this.onDeleteBase(this.dtTable[t].BaseID.toString()),this.res="Yes"):this.res="No";break}this.dtTable.length>0&&"Yes"==this.res&&(this.dtTable.RemoveAt(this.SelectedNode),this.UpdateSequence())}Logger.InfoLog("AddUOMViewModel::Exiting OnCmnItem_Click")}OnMessageCallBack(){this.res="Yes"}onCanCmnItem_Click(e){return!0}NewBase_Click(e){Logger.InfoLog("AddUOMViewModel::Entering NewBase_Click");try{this.SelectedType="0",this.Units1.Items.Clear(),this.SelectedText="",this.GridUnitsObj.Clear(),this.BaseText=""}catch(t){Logger.ErrorLog("AddUOMViewModel:: NewBase_Click"+t.stack)}}GridUnits_TableNewRow(e,t){this.UpdateSequence(),t.Row.SNO=this.SNO}UpdateSequence(){this.SNO=1,this.dtTable.forEach(e=>{e.SNO=this.SNO++,this.GridUnitsObj.updateRow(e)})}GetGridHeader(){this.GridUnitsObj.TableColumns.push("PrimayColumn"),this.GridUnitsObj.TableColumns.push("SNO"),this.GridUnitsObj.TableColumns.push("Unit Name"),this.GridUnitsObj.TableColumns.push("Conversion Rate"),this.GridUnitsObj.TableColumns.push("UnitID"),this.GridUnitsObj.TableColumns.push("BaseID");for(let t=this.dtTable.length;t<10;t++){let e=this.GridUnitsObj.NewRow();e.SNO=t+1,this.GridUnitsObj.addRow(e)}this.Columns=[];let e=new g.a;e.Header="SNO",e.DisplayMember="SNO",e.Width=50,e.ReadOnly=!0,this.Columns.push(e),e=new g.a,e.Header=s.a.GetResource("UOM_UnitName"),e.DisplayMember="Unit Name",e.Width=200,this.Columns.push(e),e=new g.a,e.Header="Conv. Rate",e.DisplayMember="Conversion Rate",e.DataType="FLOAT",e.Width=150,this.Columns.push(e)}BindGridUnits(){return this.GridUnitsObj.Clear(),this.GetGridHeader(),this.dtTable}onDeleteBase(e){if(null!=this.SelectedType&&"-100"!=this.SelectedType.toString()){Logger.InfoLog("AddUOMViewModel::Entering onDeleteBase");let e,t=[];t.push(this.SelectedType),t.push(0),t.push(s.a.SessionManager.RoleID),t.push(s.a.SessionManager.LanguageID);let i=s.a.inventory.RemoveUOM(this.SelectedType,0),n=i.RetValue;e=i.Message,this.RetValue=n,n>0?(this.SelectedType="0",this.Units1.Items.Clear(),this.SelectedText="",this.GridUnitsObj.Clear(),this.BaseText="",this.BindBase(),this.DisplayMessage=s.a.GetResource("UOM_Del"),this.MessageVisibility=!0,this.BaseVisibility=!1):(this.DisplayMessage=e,this.MessageVisibility=!0),Logger.InfoLog("AddUOMViewModel::Exiting onDeleteBase")}}onCanDeleteBase(e){return!0}onSaveUOM(e){Logger.InfoLog("AddUOMViewModel::Entering onSaveUOM");try{this.MessageVisibility=!1;let e={},t="";if(n.e.IsEmpty(this.BaseText))return this.DisplayMessage=s.a.GetResource("CannotSaveBlankUOM"),void(this.MessageVisibility=!0);{if(t+="<XML>",null!=this.GridUnits&&this.GridUnits.length>0){for(let e=0;e<this.GridUnits.length;e++)n.e.IsEmpty(this.GridUnits[e]["Unit Name"])?n.e.IsEmpty(this.GridUnits[e].PrimayColumn)?t+="<Row RowNo='"+(e+1)+"' PrimaryKey='0' UName='"+n.e.String(this.GridUnits[e]["Unit Name"])+"'  ConversionRate='"+n.e.String(this.GridUnits[e]["Conversion Rate"])+"' MapAction='DELETE' />":t+="<Row RowNo='"+(e+1)+"' PrimaryKey='"+this.GridUnits[e].PrimayColumn.toString()+"' UName='"+n.e.String(this.GridUnits[e]["Unit Name"])+"'  ConversionRate='"+n.e.String(this.GridUnits[e]["Conversion Rate"])+"' MapAction='DELETE' />":n.e.IsEmpty(this.GridUnits[e].PrimayColumn)?t+="<Row RowNo='"+(e+1)+"' PrimaryKey='0' UName='"+this.GridUnits[e]["Unit Name"].toString()+"'  ConversionRate='"+n.e.String(this.GridUnits[e]["Conversion Rate"])+"' MapAction='NEW' />":t+="<Row RowNo='"+(e+1)+"' PrimaryKey='"+this.GridUnits[e].PrimayColumn.toString()+"' UName='"+this.GridUnits[e]["Unit Name"].toString()+"'  ConversionRate='"+n.e.String(this.GridUnits[e]["Conversion Rate"])+"' MapAction='UPDATE' />";for(let e=0;e<this.lstDeletedRecords.length;e++)t+='<Row MapAction="DELETE"',t+=' PrimaryKey="'+this.lstDeletedRecords[e].iSeqno+'"/>'}else t+="<Row RowNo='1' PrimaryKey='0' UName=''  ConversionRate='' MapAction='NEW' />";t+="</XML>";let i=0;e.Address1=this.BaseText,e.Address2=n.e.StringIsNullOrEmpty(this.SelectedType)?0:this.SelectedType,e.Address3=t.toString(),e.IsGroup=!1,s.a.inventory.AddUOM(e,"AddUOM").subscribe(e=>{this.DisplayMessage=e.Message,this.RetValue=e.RetValue,this.MessageVisibility=!0,i=this.RetValue,i>0?(this.GridUnitsObj.Clear(),this.BindBase(),this.DisplayMessage=s.a.GetResource("UOM_Saved"),this.MessageVisibility=!0,this.BaseVisibility=!1):(this.DisplayMessage=e.Message,this.MessageVisibility=!0)},e=>{alert(JSON.stringify(e)),console.log("AddUOMViewModel::Exiting OnSaveUOM"+JSON.stringify(e))}),Logger.InfoLog("AddUOMViewModel::Exiting OnSaveUOM")}}catch(t){Logger.ErrorLog("AddUOMViewModel:: OnSaveUOM"+t.stack)}}onCanSaveUOM(e){return!0}onSelectionChanged(e){let t=null;this.DisplayMessage="",this.MessageVisibility=!1,Logger.InfoLog("AddUOMViewModel::Entering SelectionChanged event");try{"-100"==e?(this.GridUnitsObj.Clear(),this.lstDeletedRecords.Clear(),this.BaseText="",this.BaseVisibility=!0):this.BaseVisibility=!0;let i=[];if(i.push(this.SelectedType),i.push(s.a.SessionManager.UserID),i.push(s.a.SessionManager.LanguageID),null!=this.SelectedType&&(t=s.a.inventory.getUOM2(this.ScreenID,i)),this.GridUnitsObj.Clear(),null!=t&&t.Tables.length>0&&t.Tables[0].length>0){this.BaseText=t.Tables[0][0].BaseName.toString();for(let e=0;e<t.Tables[0].length;e++){let i=this.GridUnitsObj.NewRow();i.SNO=e+1,i.PrimayColumn=t.Tables[0][e].UOMID.toString(),i["Unit Name"]=t.Tables[0][e].UnitName.toString(),i["Conversion Rate"]=t.Tables[0][e].Conversion.toString(),i.UnitID=t.Tables[0][e].UNITID.toString(),i.BaseID=null,this.GridUnitsObj.addRow(i)}}for(let e=this.GridUnits.length;e<10;e++){let t=this.GridUnitsObj.NewRow();t.SNO=e+1,this.GridUnitsObj.addRow(t)}}catch(i){Logger.ErrorLog("AddUOMViewModel:: onSelectionChanged"+i.stack)}Logger.InfoLog("AddUOMViewModel::Exiting onSelectionChanged")}onCanSelectionChanged(e){return!0}BindBase(){this.Units1.Items.Clear(),this.ScreenData=this.BuildControls(),null!=this.ScreenData&&this.ScreenData.Tables[0].forEach(e=>{this.Units1.Items.push(o.d.ComboBoxItems_2(e[Object.keys(e)[1]].toString(),e[Object.keys(e)[0]].toString()))}),this.Units1.Items.push(o.d.ComboBoxItems_2("New","-100"))}BuildControls(){Logger.InfoLog("AddUOMViewModel::Entering BuildControls");try{let e=[];e.push(0),e.push(s.a.SessionManager.UserID),e.push(s.a.SessionManager.LanguageID);let t=s.a.inventory.getUOM2(this.ScreenID,e);return null!=t&&t.Tables[0].length>0&&t.Tables.length>0?t:null}catch(e){return Logger.ErrorLog("AddUOMViewModel:: BuildControls"+e.stack),null}}ontextChangedUnit(e){}BindGrid(){let e=[],t=[];if(t.push(this.SelectedType),t.push(s.a.SessionManager.UserID),t.push(s.a.SessionManager.LanguageID),null!=this.SelectedType&&(e=s.a.inventory.getUOM2(this.ScreenID,t)),this.dtTable.Clear(),null!=e&&e.Tables.length>0&&e.Tables[0].length>0){this.BaseText=e.Tables[0][0].BaseName.toString();for(let t=0;t<e.Tables[0].length;t++)this.dtTable.push([e.Tables[0][t].UOMID.toString(),t+1,e.Tables[0][t].UnitName.toString(),e.Tables[0][t].Conversion.toString(),e.Tables[0][t].UnitID.toString(),e.Tables[0][t].BaseID.toString()])}for(let i=this.GridUnits.length;i<10;i++){let e=this.GridUnitsObj.NewRow();e.SNO=i+1,this.GridUnitsObj.addRow(e)}}}}}]);
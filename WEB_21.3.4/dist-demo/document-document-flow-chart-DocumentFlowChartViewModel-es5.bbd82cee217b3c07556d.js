function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var o,r=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;o=Reflect.construct(r,arguments,n)}else o=r.apply(this,arguments);return _possibleConstructorReturn(this,o)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[151],{d36O:function(e,t,o){"use strict";o.r(t),o.d(t,"DocumentFlowChartViewModel",(function(){return h}));var r=o("Do2H"),n=o("Lp6j"),a=o("ScVY"),i=o("vTM8"),s=o("0/4Q"),c=o("PDNK"),u=o("EQd/"),l=o("CUWK"),h=function(e){_inherits(o,e);var t=_createSuper(o);function o(e,a){var l,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];_classCallCheck(this,o),(l=t.call(this)).dtDocs=null,l.dtDocsDetail=null,l.RootNodes=[],l.lstDocNodes=new i.a,l.DocsFlowData=[],l.DocsArrowData=[],l.DocsArrowDataTemp=[],l.lstRibbonDocs=new i.c,l._DocNumber="",l.VoucherNoObj=new u.d,l.IsInv=!0,l.IsDialog=!1,l.Width=null,l.Height=null,l.MaxNodeHeight=0,l.arrLevelMax=[],l.ActualNodeHeight=80,l.NodePaddingTop=30,l.NodePaddingLeft=60,l.ActualNodeWidth=140,l.IsLinkFlowCall=!1,l.HideValue=!1,l.HideQty=!1,l.HideDocDate=!1,l.Width="800",l.Height="600",l.VoucherNoObj.SetFocus=!0,l.VoucherNoObj.Label=r.a.GetResource("DFCVoucherNo"),l.ShowData=new c.b,l.ShowData.GroupName="ShowData",l.ShowData.Items.push(new c.a("Summary",0,"ShowData")),l.ShowData.Items.push(new c.a("Detail",1,"ShowData")),l.ShowData.Items[0].Label=r.a.GetResource("DFCSummary"),l.ShowData.Items[0].Group=l.ShowData,l.ShowData.Items[1].Group=l.ShowData,l.ShowData.Items[1].Label=r.a.GetResource("DFCDetail"),r.a.SessionManager.PersonalSettings.ContainsKey("DocumentFlowShowData")&&"1"==r.a.SessionManager.PersonalSettings.DocumentFlowShowData?l.ShowData.Items[1].IsChecked=!0:l.ShowData.Items[0].IsChecked=!0,l.ShowData.Items[0].CheckedChangedCommand.Subscribe(_assertThisInitialized(l),"OnNameCheckedChanged"),l.ShowData.Items[1].CheckedChangedCommand.Subscribe(_assertThisInitialized(l),"OnNameCheckedChanged"),l.HideValue=r.a.SessionManager.IsActionAssigned(131,"Hide Value"),l.HideQty=r.a.SessionManager.IsActionAssigned(131,"Hide Qty"),l.HideDocDate=r.a.SessionManager.IsActionAssigned(131,"Hide DocDate"),l.Title="Link Map",l.IsDialog=e,l.VoucherNo=a,l.IsInv=d,l.DocumentType=new s.e(0),l.DocumentType.Label=r.a.GetResource("Document Type"),l.DocPrefix=new s.e(0),l.DocPrefix.Label=r.a.GetResource("DocPrefix"),l.DocumentType.SelectionChangedCommand.Subscribe(_assertThisInitialized(l),"OnDocumentChange"),l.DocPrefix.SelectionChangedCommand.Subscribe(_assertThisInitialized(l),"OnDocPrefix");var D=r.a.report.GetReportData(3,parseInt(r.a.SessionManager.UserID),null);return l.DocumentType.Items.push(s.d.ComboBoxItems_2("","0")),null!=D&&(D.Tables[0].forEach((function(e){l.DocumentType.Items.push(s.d.ComboBoxItems_3(e[D.Columns[0][1]].toString(),e[D.Columns[0][0]].toString(),e.DocumentAbbr.toString()))})),h>0&&(l.DocumentType.SelectedValue=h.toString())),n.e.IsEmpty(a)||l.ConstructTree(),l}return _createClass(o,[{key:"OnNameCheckedChanged",value:function(e){n.e.SetPersonalize("DocumentFlowShowData",this.ShowData.Items[1].IsChecked?"1":"0"),this.OnButtonClick("Submit")}},{key:"OnDocumentChange",value:function(e){var t=this;!n.e.IsEmpty(this.DocumentType.SelectedValue)&&parseInt(this.DocumentType.SelectedValue)>0&&(this.DocPrefix.Items.Clear(),r.a.common.GetDataSet("DOC048",this.DocumentType.SelectedValue).Tables[0].forEach((function(e){t.DocPrefix.Items.push(s.d.ComboBoxItems_3(e.CodePrefix.toString(),e.CodePrefix.toString(),e.CurrentCodeNumber.toString()))})),this.DocNumber=""),this.UpdateVoucherNo()}},{key:"OnDocPrefix",value:function(e){this.DocNumber=null==this.DocPrefix.SelectedItem||n.e.IsEmpty(this.DocPrefix.SelectedItem.Parent)?"":this.DocPrefix.SelectedItem.Parent,this.UpdateVoucherNo()}},{key:"UpdateVoucherNo",value:function(){var e="";!n.e.IsEmpty(this.DocumentType.SelectedValue)&&parseInt(this.DocumentType.SelectedValue)>0&&(e=this.DocumentType.SelectedItem.Parent+"-",n.e.IsEmpty(this.DocPrefix.SelectedValue)||(e+=this.DocPrefix.SelectedValue),n.e.IsEmpty(this.DocNumber)||(e+=this.DocNumber)),this.VoucherNo=e}},{key:"OnButtonClick",value:function(e){if(this.DisplayMessage="","Submit"==e){if(n.e.IsEmpty(this.VoucherNo))return void(this.DisplayMessage="Enter Voucher No");this.ActualNodeWidth=140,this.ConstructTree()}else if("LinkFlow"==e){if(null==this.DocumentType.SelectedValue)return void(this.DisplayMessage="Select Document Type");this.ConstructTree(!0)}else"Close"==e&&r.a.page.HideDialog()}},{key:"OnDocumentClick",value:function(e){if(this.DisplayMessage="",!n.e.IsEmpty(e)){r.a.page.ShowLoading=!0;var t,o=r.a.report.GetDocumentDetailsByVoucherNo(e);if(n.e.Int(o.obj)>0)t=o.Tables[0].length>0?o.Tables[0][0]:o.Tables[1][0],l.RibbonExtViewModel.LoadDocument(t),this.IsDialog&&r.a.page.HideDialog();else this.DisplayMessage="Document not found";r.a.page.ShowLoading=!1}}},{key:"OnDocumentDefClick",value:function(e){}},{key:"ConstructTree",value:function(){var e,t,o=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this.DocsArrowData.Clear(),this.DocsArrowDataTemp.Clear(),this.arrLevelMax.Clear(),this.lstDocNodes.Clear(),this.RootNodes.Clear(),this.lstRibbonDocs.Clear(),this.IsLinkFlowCall=n,n)?(r.a.SessionManager.MenuTabs.forEach((function(e){e.Groups.forEach((function(e){for(var t=0;t<e.Items.length;t++){var r=e.Items[t];r.FeatureID>4e4&&r.FeatureID<5e4&&!o.lstRibbonDocs.keys.Contains(r.FeatureID)&&o.lstRibbonDocs.push(r.FeatureID,r)}}))})),this.TempDVNode=new Array,e=r.a.report.GetDocsLinkTree(this.DocumentType.SelectedValue,this.ShowData.Items[0].IsChecked?1:0,this.IsInv)):(this.TempVNode=[],t=this.VoucherNo.startsWith("LINEID:")?this.VoucherNo.split("~"):[this.VoucherNo],e=r.a.report.GetDocsLinkTree(t[0],this.ShowData.Items[0].IsChecked?1:0,this.IsInv),t.length>1&&(this.VoucherNo=t[1]),e.Tables.length>2&&e.Columns[2].Contains("BWDocNo")&&e.Tables[2].forEach((function(t){var o={CostCenterID:0};o.VoucherNo=t.BWDocNo,o.ParentVoucherNo=t.ParentVoucherNo,o.DocDate=t.DocDate,e.Tables[0].push(o)})));if(0!=e.Tables.length){this.dtDocs=e.Tables[0],this.dtDocsDetail=e.Tables[1];var a,i=e.Tables[0].filter((function(e){return null==e.ParentVoucherNo||"-1"==e.ParentVoucherNo||""==e.ParentVoucherNo}));this.arrLevelMax.push(0),e.Columns[0].Contains("DocDate"),i.forEach((function(e){var t=o.GetNode(e,0);t&&(o.RootNodes.push(t),o.AddChildren(t))})),this.lstDocNodes.length>0&&(n?(a=this.lstDocNodes.values.find((function(e){return e.CostCenterID==parseInt(o.DocumentType.SelectedValue)})))&&(a.ForeColor="Red"):(a=this.lstDocNodes.values.find((function(e){return e.DocNo.toString().toLowerCase()==o.VoucherNo.toLowerCase()})))&&(a.ForeColor="Red")),this.arrLevelMax[0]=this.RootNodes.length,this.MaxNodeHeight=Math.max.apply(Math,_toConsumableArray(this.arrLevelMax))*this.NodeHeight,this.RootNodes.forEach((function(e){e.Top=o.MaxNodeHeight/(o.arrLevelMax[0]+1)-o.NodeHeight;var t=o.MaxNodeHeight/o.arrLevelMax[e.Level];e.Top=t*(e.LevelIndex+1)-((t-o.ActualNodeHeight)/2+o.ActualNodeHeight),e.Margin="0,"+e.Top.toString()+",0,0",o.AssignMargin(e)}));var s=[];n?this.TempDVNode.forEach((function(e){s.push(e)})):this.TempVNode.forEach((function(e){s.push(e)})),this.DocsFlowData=s;var c=[];c.AddRange(this.DocsArrowData),this.DocsArrowDataTemp.push(c)}}},{key:"GetNode",value:function(e,t){if(this.lstDocNodes.ContainsKey(e.VoucherNo.toString()))return null;var o=new D;if(o.DocNo=e.VoucherNo.toString(),o.CostCenterID=parseInt(e.CostCenterID),this.IsLinkFlowCall)(o=new f).DocNo=e.VoucherNo.toString(),o.CostCenterID=parseInt(e.CostCenterID),this.lstRibbonDocs.keys.Contains(o.CostCenterID)?o.SmallImage=this.lstRibbonDocs[o.CostCenterID].SmallImage:(o.BtnBorderColor="Gray",o.IsEnable=!1);else{(o=new D).DocNo=e.VoucherNo.toString(),o.CostCenterID=parseInt(e.CostCenterID),this.HideDocDate||null==e.DocDate||(o.DocDate=new Date(e.DocDate).ToString(r.a.SessionManager.Preferences["Date Format"]));var n=this.dtDocsDetail.filter((function(e){return e.VoucherNo==o.DocNo}));n.length>0&&(this.HideQty||null==n[0].Qty||(o.Qty=parseFloat(n[0].Qty).ToString("N"+r.a.SessionManager.Preferences.DecimalsinQty)),this.HideValue||null==n[0].Value||(o.Value=parseFloat(n[0].Value).ToString("N"+r.a.SessionManager.Preferences.DecimalsinAmount)))}return this.lstDocNodes.push(e.VoucherNo.toString(),o),this.ActualNodeWidth/e.VoucherNo.toString().length<7&&(this.ActualNodeWidth=3+7*e.VoucherNo.toString().length),o.Width=this.ActualNodeWidth,o.Height=this.ActualNodeHeight,o.Level=t,this.arrLevelMax.length<=o.Level&&this.arrLevelMax.push(0),o.LevelIndex=this.arrLevelMax[o.Level],this.arrLevelMax[o.Level]++,this.IsLinkFlowCall?this.TempDVNode.push(o):this.TempVNode.push(o),o}},{key:"AddChildren",value:function(e){var t=this;this.dtDocs.filter((function(t){return t.ParentVoucherNo==e.DocNo})).forEach((function(o){var r=o.VoucherNo.toString();if(t.lstDocNodes.ContainsKey(r))e.Children.find((function(e){return e.DocNo==r}))||e.Children.push(t.lstDocNodes[r]);else{var n=t.GetNode(o,e.Level+1);null!=n&&(e.Children.push(n),t.AddChildren(n))}}))}},{key:"AssignMargin",value:function(e){for(var t=this,o=function(o){var r=e.Children[o];if(!r.IsRead){r.IsRead=!0,r.Left=r.Level*t.NodeWidth;var a=t.MaxNodeHeight/t.arrLevelMax[r.Level];r.Top=a*(r.LevelIndex+1)-((a-t.ActualNodeHeight)/2+t.ActualNodeHeight),r.Margin=r.Left+","+r.Top.toString()+",0,0",t.AssignMargin(r)}if(!t.DocsArrowData.find((function(t){return t.FromDocNo==e.DocNo&&t.ToDocNo==r.DocNo}))){var i=new p;i.FromDocNo=e.DocNo,i.ToDocNo=r.DocNo,i.X1=e.Left,e.Left<r.Left&&(i.X1+=t.ActualNodeWidth),i.Y1=e.Top+t.ActualNodeHeight/2,i.X2=r.Left,r.Left<e.Left&&(i.X2+=t.ActualNodeWidth),i.Y2=r.Top+t.ActualNodeHeight/2,t.IsLinkFlowCall?null!=t.DocumentType.SelectedValue&&e.CostCenterID==parseInt(t.DocumentType.SelectedValue)&&(i.Stroke="Red"):n.e.LowerCase(e.DocNo)!=n.e.LowerCase(t.VoucherNo)&&n.e.LowerCase(r.DocNo)!=n.e.LowerCase(t.VoucherNo)||(i.Stroke="Red"),t.DocsArrowData.push(i)}},r=0;r<e.Children.length;r++)o(r)}},{key:"DocNumber",get:function(){return this._DocNumber},set:function(e){e!=this._DocNumber&&(this._DocNumber=e,this.UpdateVoucherNo())}},{key:"VoucherNo",get:function(){return this.VoucherNoObj.Text},set:function(e){this.VoucherNoObj.Text=e}},{key:"NodeHeight",get:function(){return this.ActualNodeHeight+this.NodePaddingTop}},{key:"NodeWidth",get:function(){return this.ActualNodeWidth+this.NodePaddingLeft}}]),o}(a.b),d=function(e){_inherits(o,e);var t=_createSuper(o);function o(){var e;return _classCallCheck(this,o),(e=t.apply(this,arguments)).CostCenterID=0,e.Level=0,e.Order=0,e.Parent=null,e.Children=[],e.Top=0,e.Left=0,e.LevelIndex=0,e.IsRead=!1,e.Margin="0px 0px 0px 0px",e.ForeColor="Black",e.Width=0,e.Height=0,e}return o}(a.b),D=function(e){_inherits(o,e);var t=_createSuper(o);function o(){return _classCallCheck(this,o),t.apply(this,arguments)}return _createClass(o,[{key:"DocDateLbl",get:function(){return n.e.IsEmpty(this.DocDate)?"":"DocDate :"}},{key:"QtyLbl",get:function(){return n.e.IsEmpty(this.Qty)?"":"Qty :"}},{key:"ValueLbl",get:function(){return n.e.IsEmpty(this.Value)?"":"Value :"}},{key:"ToolTip",get:function(){return""!=this.QtyLbl?"Doc No: "+this.DocNo+"\r\nQty: "+this.Qty+"\r\nValue: "+this.Value:"Doc No: "+this.DocNo}}]),o}(d),f=function(e){_inherits(o,e);var t=_createSuper(o);function o(){var e;return _classCallCheck(this,o),(e=t.call(this)).IsEnable=!1,e.IsEnable=!0,e.BtnBorderColor="Orange",e}return o}(d),p=function e(){_classCallCheck(this,e),this.X1=0,this.X2=0,this.Y1=0,this.Y2=0,this.Stroke="#000"}}}]);
function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,a=_getPrototypeOf(e);if(t){var i=_getPrototypeOf(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[22,151],{"+ryo":function(e,t,n){"use strict";n.r(t),n.d(t,"CasesContactViewModel",(function(){return h}));var a=n("ScVY"),i=n("EQd/"),r=n("JIg3"),s=n("4HhE"),o=n("0/4Q"),c=n("n56n"),l=n("Jnyl"),u=n("EggS"),d=n("Do2H"),D=n("3Pt+"),h=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,a){var r;_classCallCheck(this,n),(r=t.call(this)).Fields=new Array,r.SaveOrganization=new s.b,r.Contact=new o.e(0),r.JobTitle=new i.d(0),r.Title_=new i.d(0),r.Dept=new i.d(0),r.FirstName=new i.d(0),r.LastName=new i.d(0),r.MiddleName=new i.d(0),r.Company=new i.d(0),r.Phone1=new i.d(0),r.Phone2=new i.d(0),r.Email1=new i.d(0),r.Email2=new i.d(0),r.Fax=new i.d(0),r.Salutation=new o.e(0),r.Territory=new c.b(0),r.oText=null,r.oDate=null,r.oCombo=null,r.oTextArea=null,r.OComboText=null,r.Dset=null,r.ContactChange=new s.b,r.SelectionChangedCommand=new s.b,r.form=new D.j({}),Logger.InfoLog("CasesContactViewModel::Entering CasesContactViewModel"),(null!=a&&"AddEditCasesViewModel"==a.ClassName||null!=a&&"AddEditDocumentViewModel"==a.ClassName)&&(r.OParnt=a),r.CasesContactVisibility=!0,r.ContactChange.Subscribe(_assertThisInitialized(r),"onContactSelectionChanged"),r.SelectionChangedCommand.Subscribe(_assertThisInitialized(r),"onCompanySelectionChanged"),r.EnableControls(!1);try{var l=d.a.crmService.GetFeedbackDetails(120);r.Oparent=e,r.Salutation.Items.Clear(),null!=l&&l.Tables.length>5&&l.Tables[5].length>0&&l.Tables[5].forEach((function(e){r.Salutation.Items.push(o.d.ComboBoxItems_2(e[l.Columns[5][2]].toString(),e[l.Columns[5][0]].toString()))})),r.SaveOrganization.Subscribe(_assertThisInitialized(r),"OnSave")}catch(u){Logger.ErrorLog("CasesContactViewModel:: CasesContactViewModel"+u.stack)}return Logger.InfoLog("CasesContactViewModel::Exiting CasesContactViewModel"),r}return _createClass(n,[{key:"onContactSelectionChanged",value:function(e){var t=this;this.EnableControls(!0),null!=this.dvContacts&&null!=this.Contact.SelectedValue&&"0"!=this.Contact.SelectedValue&&(this.dvContacts=this.dvContacts.filter((function(e){return e.ContactID==t.Contact.SelectedValue})),this.dvContacts.length>0&&(this.FirstName.Visible&&(this.FirstName.Text=this.dvContacts[0].FirstName.toString(),this.FirstName.Enable=!1),this.MiddleName.Visible&&(this.MiddleName.Text=this.dvContacts[0].MiddleName.toString(),this.MiddleName.Enable=!1),this.LastName.Visible&&(this.LastName.Text=this.dvContacts[0].LastName.toString(),this.LastName.Enable=!1),this.JobTitle.Visible&&(this.JobTitle.Text=this.dvContacts[0].JobTitle.toString(),this.JobTitle.Enable=!1),this.Salutation.Visible&&""!=this.dvContacts[0].SalutationID.toString()&&(this.Salutation.SelectedValue=this.dvContacts[0].SalutationID.toString(),this.Salutation.Enable=!1),this.Dept.Visible&&(this.Dept.Text=this.dvContacts[0].Department.toString(),this.Dept.Enable=!1),this.JobTitle.Visible&&(this.JobTitle.Text=this.dvContacts[0].JobTitle.toString(),this.JobTitle.Enable=!1)))}},{key:"EnableControls",value:function(e){this.FirstName.Visible&&(this.FirstName.Enable=e,this.FirstName.Text=""),this.LastName.Visible&&(this.LastName.Enable=e,this.LastName.Text=""),this.MiddleName.Visible&&(this.MiddleName.Enable=e,this.MiddleName.Text=""),this.Salutation.Visible&&(this.Salutation.Enable=e,this.Salutation.SelectedValue="0"),this.JobTitle.Visible&&(this.JobTitle.Enable=e,this.JobTitle.Text=""),this.Dept.Visible&&(this.Dept.Enable=e,this.Dept.Text=""),this.Title_.Visible&&(this.Title_.Enable=e,this.Title_.Text=""),this.JobTitle.Visible&&(this.JobTitle.Enable=e,this.JobTitle.Text=""),this.Phone1.Visible&&(this.Phone1.Enable=e,this.Phone1.Text=""),this.Phone2.Visible&&(this.Phone2.Enable=e,this.Phone2.Text=""),this.Email1.Visible&&(this.Email1.Enable=e,this.Email1.Text=""),this.Email2.Visible&&(this.Email2.Enable=e,this.Email2.Text=""),this.Fax.Visible&&(this.Fax.Enable=e,this.Fax.Text=""),this.Company.Visible&&(this.Company.Enable=e,this.Company.Text="")}},{key:"onCompanySelectionChanged",value:function(e){this.Contact.Items.Clear();var t=(new u.a).GetCustomerDetails();if(t.Tables.length>1&&t.Tables[2].length>0){for(var n=0;n<t.Tables[2].length;n++)this.Contact.Items.push(o.d.ComboBoxItems_2(t.Tables[2][n].Fname.toString(),t.Tables[2][n].ContactID.toString()));this.dvContacts=t.Tables[2]}}},{key:"OnSave",value:function(e){Logger.InfoLog("DemoKitViewModel::Entering OnSave");try{if("Customize"==e.toString());else if("Cancel"==e.toString())this.Oparent.Parent.CasesContactVisibility=!1;else if("Save"==e.toString()){if(null!=this.Oparent&&null==this.Oparent.SelectedRow){var t=this.Oparent.OrganizationDataObj.NewRow();(this.OParnt.ClassName="AddEditCasesViewModel")?(t.Customer=this.OParnt.Customer.Text,t.CustomerID=this.OParnt.Customer.SelectedValue):(t.Customer=this.OParnt.ScreenObject.CreditAccount.Text,t.CustomerID=this.OParnt.ScreenObject.CreditAccount.SelectedValue),t.ContactName=this.FirstName.Text,t.MiddleName=this.MiddleName.Text,t.LastName=this.LastName.Text,t.ContactID=this.Contact.SelectedValue,t.Salutation=this.Salutation.GetText(),t.SalutationID=this.Salutation.SelectedValue,t.JobTitle=this.JobTitle.Text,t.Department=this.Dept.Text,t.Company=this.Company.Text,t.Phone1=this.Phone1.Text,t.Email1=this.Email1.Text,t["Phon e2"]=this.Phone2.Text,t.Email2=this.Email2.Text,t.Fax=this.Fax.Text;for(var n=0;n<this.Fields.length;n++){var a=this.Fields[n];a instanceof i.d&&(this.oText=a,t[this.oText.SysColumnName]=this.oText.Text),a instanceof r.a&&(this.oDate=a,t[this.oDate.SysColumnName]=this.oDate.Date),a instanceof o.e&&(this.oCombo=a,t[this.oCombo.SysColumnName]=this.oCombo.SelectedValue),a instanceof l.a&&(this.OComboText=a,t[this.OComboText.SysColumnName]=this.OComboText.TextBox.Text),a instanceof i.c&&(this.oTextArea=a,t[this.oTextArea.SysColumnName]=this.oTextArea.Text),a instanceof c.b&&(this.oPactCombo=a,t[this.oPactCombo.SysColumnName+"_Key"]=this.oPactCombo.SelectedValue,t[this.oPactCombo.SysColumnName]=this.oPactCombo.Text)}this.Oparent.OrganizationDataObj.addRow(t)}else this.Oparent.SelectedRow.ContactName=this.FirstName.Text,this.Oparent.SelectedRow.LastName=this.LastName.Text,this.Oparent.SelectedRow.MiddleName=this.MiddleName.Text,null!=this.Contact.SelectedValue&&(this.Oparent.SelectedRow.ContactID=this.Contact.SelectedValue),this.Oparent.SelectedRow.Salutation=this.Salutation.GetText(),this.Oparent.SelectedRow.SalutationID=this.Salutation.SelectedValue,this.Oparent.SelectedRow.JobTitle=this.JobTitle.Text,this.Oparent.SelectedRow.Department=this.Dept.Text,this.Oparent.SelectedRow.Email1=this.Email1.Text,this.Oparent.SelectedRow.Email2=this.Email2.Text,this.Oparent.SelectedRow.phone1=this.Phone1.Text,this.Oparent.SelectedRow.phone2=this.Phone2.Text,this.Oparent.SelectedRow=null;this.ClearFields(),this.Territory.SelectedValue=0,this.FirstName.Text="",this.MiddleName.Text="",this.LastName.Text="",this.JobTitle.Text="",this.Title_.Text="",this.Dept.Text="",this.Company.Text="",this.Email1.Text="",this.Phone1.Text="",this.Email2.Text="",this.Phone2.Text="",this.Fax.Text="",this.Salutation.SelectedValue="",this.Contact.SelectedValue="0"}}catch(s){Logger.ErrorLog("DemoKitViewModel:: OnSave"+s.stack)}Logger.InfoLog("DemoKitViewModel::Exiting OnSave")}},{key:"ClearFields",value:function(){for(var e=0;e<this.Fields.length;e++){var t=this.Fields[e];t instanceof i.d&&(this.oText=t,this.oText.Text=""),t instanceof r.a&&(this.oDate=t),t instanceof o.e&&(this.oCombo=t,this.oCombo.SelectedValue=""),t instanceof l.a&&(this.OComboText=t,this.OComboText.TextBox.Text=""),t instanceof i.c&&(this.oTextArea=t,this.oTextArea.Text=""),t instanceof c.b&&(this.oPactCombo=t,this.oPactCombo.SelectedValue=0)}}}]),n}(a.b)},"1Cra":function(e,t,n){"use strict";n.r(t),n.d(t,"AddEditDocumentViewModel",(function(){return tn})),n.d(t,"FailureMessage",(function(){return nn}));var a,i,r=n("mrSG"),s=n("Do2H"),o=n("Lp6j"),c=n("vTM8"),l=n("eQJW"),u=n("ScVY"),d=n("lUlH"),D=n("NkMH"),h=n("EQd/"),S=n("JIg3"),m=n("0/4Q"),b=n("wlFP"),C=n("n56n"),y=n("4HhE"),p=n("Huqd"),g=n("Jnyl"),f=n("ockk"),O=n("jgdN"),I=n("uMy8"),T=n("RHAd"),j=n("MCLT"),P=n("4ADR"),A=n("OvA8"),M=n("lG8W"),v=n("c6C+"),G=n("RJs6"),N=n("xnJf"),E=n("tDup"),w=n("dQvv"),F=n("lvkM"),V=n("8B8H"),L=n("CUWK"),R=n("hTlG"),B=function(e){_inherits(a,e);var t=_createSuper(a);function a(){var e;return _classCallCheck(this,a),(e=t.call(this)).ImportVisiblity=!1,e.ActualFileName=null,e.RimFileName=null,e.GridHeight=200,e.IsInventory=!1,e.CanDist=!1,e.GridWidth=0,e.Width=0,e._FifoEnabled=!0,e._Fifo=!1,e.NewReferenceDetailsVisibility=!1,e.ForeignCurrency=!1,e.PostVisibility=!1,e.OkVisible=!1,e.SaveVisible=!0,e.ColumnSource=[],e.DBCRColumnSource=[],e.DetailsColumnSource=[],e.NewRefColumnSource=[],e.GridData=[],e.GridDataColumns=[],e.GridDataObj=new V.a,e.GridDataDBCR=[],e.GridDataDBCRObj=new V.a,e.NewReferenceDetails=[],e.NewReferenceDetailsColumns=[],e.NewReferenceDetailsObj=new V.a,e.NewReferenceVisibility=!1,e.DBCRVisibility=!1,e.NewReferenceDt=[],e.NewReferenceDtColumns=[],e.NewReferenceDtObj=new V.a,e.CurrencyID=1,e.ExchangeRate=1,e.AccountID=0,e.IsCredit=!1,e.Accounts=new m.e(0),e.NewReference=new h.d(0),e.NegAmount=new h.d(0),e.AdjustAmt=new h.d(0),e.AmtToAdjust=new h.d(0),e.FromDate=new S.a,e.ToDate=new S.a,e.ToSearchVisible=!1,e.ToSearch="",e._UpdateFooter=!1,e.decimalpoints="",e.DbCrNetFld="",e.DocSeqNo=1,e.TotTaxableAmt=0,e.DiscCol=null,e.drdbcr=null,e.dtccData=null,e.AdvanceRowsCNT=0,e.VatAdvanceXML=null,e.GridDataDBCRObj.Table=e.GridDataDBCR,e.GridDataDBCRObj.SearchVisible=!0,e.GridDataDBCRObj.CanUserAddRows=!1,e.GridDataDBCRObj.CanUserDeleteRows=!1,e.Title=s.a.GetResource("BillWise_Title"),e.GridDataObj.Table=e.GridData,e.GridDataObj.TableColumns=e.GridDataColumns,e.GridDataObj.SearchVisible=!0,e.GridDataObj.CanUserAddRows=!1,e.GridDataObj.CanUserDeleteRows=!1,e.NewReferenceDtObj.MaxHeight=500,e.NewReferenceDtObj.Table=e.NewReferenceDt,e.NewReferenceDtObj.TableColumns=e.NewReferenceDtColumns,e.NewReferenceDtObj.Columns=e.NewRefColumnSource,e.NewReferenceDtObj.Height=200,e.NewReferenceDetailsObj.Table=e.NewReferenceDetails,e.NewReferenceDetailsObj.TableColumns=e.NewReferenceDetailsColumns,e.NewReferenceDetailsObj.Columns=e.DetailsColumnSource,e.NewReferenceDetailsObj.Height=200,e.Accounts.Label="Account",e.Accounts.LblWidth="70",e.NewReference.Label=s.a.GetResource("BillWise_NewReference"),e.AmtToAdjust.Label=s.a.GetResource("BillWise_AmtAdjust"),e.AdjustAmt.Label=s.a.GetResource("BillWise_AdjustedAmt"),e}return _createClass(a,[{key:"BindExchageRate",value:function(){var e=this;if(this.ExRate=this.ExchangeRate.toString(),this.Parent.ScreenObject.Data.Tables.length>14&&this.Parent.ScreenObject.Data.Tables[14].length>0){var t=this.Parent.ScreenObject.Data.Tables[14].filter((function(t){return t.CurrencyID==e.CurrencyID}));t.length>0&&(this.CurrencyName=t[0].Name.toString())}}},{key:"UpdateTotals",value:function(){for(var e=this,t=0,n=function(n){null!=e.ColumnSource[n].DecimalPoints&&"ExchgRate"!=e.ColumnSource[n].DisplayMember&&(t=0,e.GridData.forEach((function(a){o.e.IsEmpty(a[e.ColumnSource[n].DisplayMember])||""==a[e.ColumnSource[n].DisplayMember].toString().Trim()||(t+=parseFloat(a[e.ColumnSource[n].DisplayMember]))})),e.ColumnSource[n].footer=t.ToString("N"+e.ColumnSource[n].DecimalPoints),e.DBCRVisibility&&(t=0,e.GridDataDBCR.forEach((function(a){o.e.IsEmpty(a[e.ColumnSource[n].DisplayMember])||(t+=parseFloat(a[e.ColumnSource[n].DisplayMember]))})),e.DBCRColumnSource[n].footer=t.ToString("N"+e.ColumnSource[n].DecimalPoints)))},a=0;a<this.ColumnSource.length;a++)n(a);this.UpdateFooter=!0}},{key:"LoadColumns",value:function(e){var t=this;this.decimalpoints=this.Parent.ScreenObject.Preferences.ContainsKey("DecimalsBillWise")&&""!=this.Parent.ScreenObject.Preferences.DecimalsBillWise&&isFinite(this.Parent.ScreenObject.Preferences.DecimalsBillWise)&&parseInt(this.Parent.ScreenObject.Preferences.DecimalsBillWise)>0?this.Parent.ScreenObject.Preferences.DecimalsBillWise:s.a.SessionManager.Preferences.ContainsKey("DecimalsinAmount")?s.a.SessionManager.Preferences.DecimalsinAmount:"2";var n=new f.a;n.Header="#",n.DisplayMember="SNO",n.DataType="TextBlock",n.Width=24,n.ReadOnly=!0,this.ColumnSource.push(n),this.Parent.ScreenObject.Preferences.ContainsKey("UnappinBills")&&"True"==this.Parent.ScreenObject.Preferences.UnappinBills&&((n=new f.a).Header="Status",n.DisplayMember="Status",n.ReadOnly=!0,n.DataType="text",n.Width=2,n.DisableTab=!0,n.IsVisible=!0,n.ID="0",this.ColumnSource.push(n),this.GridDataColumns.push("Status_COLOR"),this.GridDataColumns.push("Status")),null!=this.Parent&&this.Parent.ScreenObject.Preferences.ContainsKey("ShowNewReference")&&"True"==this.Parent.ScreenObject.Preferences.ShowNewReference&&((n=new f.a).Header="Adjust Bill",n.DisplayMember="AdjustBill",n.ReadOnly=!0,n.DataType="LINK",n.ReadOnly=!1,n.Click.Subscribe(this,"OnAdjustBill"),n.Width=100,n.DisableTab=!0,n.IsVisible=!0,n.ID="0",this.ColumnSource.push(n),this.GridDataColumns.push("AdjustBill"));for(var a=0;a<e.length;a++){if((n=new f.a).Header=e[a].UserColumnName.toString(),n.DisplayMember=!o.e.IsEmpty(e[a].CostCenterID)&&parseInt(e[a].CostCenterID)>5e4&&parseInt(e[a].CostCenterID)<50100?"A"+e[a].CostCenterID.toString():e[a].Name.toString(),"DocDueDate"==n.DisplayMember&&(n.DisplayMember="DueDate"),n.ReadOnly=!Object(l.j)(e[a].IsEditable),"DiscAmount"==n.DisplayMember){if(this.IsInventory)continue;if("continue"===function(){var e=t.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&25927==e.LinkData}));if(0==e.length||!t.Parent.ScreenObject.GridDataColumns.Contains(e[0].SysColumnName.toString()))return"continue";t.DiscCol=t.Parent.ScreenObject.ColumnSource.find((function(t){return t.DisplayMember==e[0].SysColumnName.toString()})),n.ReadOnly=!1,n.DataType="FLOAT"}())continue}else"DocNo"==n.DisplayMember?(n.DataType="LINK",n.ReadOnly=!1,n.Click.Subscribe(this,"OnserieslinkClick")):n.DataType=e[a].UserColumnType.toString();"FLOAT"==n.DataType&&""!=this.decimalpoints&&(n.DecimalPoints=this.decimalpoints),s.a.SessionManager.Preferences.ContainsKey("BillwiseCurrency")&&"true"==s.a.SessionManager.Preferences.BillwiseCurrency.toLowerCase()&&"amountpaidlc"==n.DisplayMember.toLowerCase()&&(n.ReadOnly=!0),o.e.IsEmpty(e[a].ColumnWidth)||(n.Width=parseInt(e[a].ColumnWidth)),n.ID=o.e.StringValue(e[a].CostCenterID),this.ColumnSource.push(n)}this.GridDataObj.Columns=this.ColumnSource,(n=new f.a).Header="#",n.DisplayMember="SNO",n.DataType="TextBlock",n.Width=24,n.ReadOnly=!0,this.DetailsColumnSource.push(n),(n=new f.a).Header=s.a.GetResource("BillWise_DocumentNo"),n.DisplayMember="DocumentNo",n.DataType="TextBlock",n.Width=100,n.ReadOnly=!0,n.DataType="LINK",n.Click.Subscribe(this,"OnlinkClick"),this.DetailsColumnSource.push(n),(n=new f.a).Header=s.a.GetResource("BillWise_DocDate"),n.DisplayMember="DocDate",n.DataType="TextBlock",n.Width=80,n.ReadOnly=!0,this.DetailsColumnSource.push(n),(n=new f.a).Header=s.a.GetResource("BillWise_AmountPaid"),n.DisplayMember="AmountPaid",n.DataType="FLOAT",n.Width=80,n.ReadOnly=!0,""!=this.decimalpoints&&(n.DecimalPoints=this.decimalpoints),this.DetailsColumnSource.push(n),(n=new f.a).Header=s.a.GetResource("BillWise_AmountFC"),n.DisplayMember="AmountFC",n.DataType="FLOAT",n.Width=150,n.ReadOnly=!0,""!=this.decimalpoints&&(n.DecimalPoints=this.decimalpoints),n.IsVisible=!!this.ForeignCurrency,this.DetailsColumnSource.push(n)}},{key:"OnAdjustBill",value:function(){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,i,r,c,l=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,null==this.SelectedRow||o.e.IsEmpty(this.SelectedRow.CostCenterID)){e.next=10;break}return e.next=4,Promise.all([n.e(2),n.e(1),n.e(3),n.e(5),n.e(4),n.e(6),n.e(7),n.e(10),n.e(9),n.e(12),n.e(11),n.e(13),n.e(19),n.e(15),n.e(21),n.e(20),n.e(16),n.e(14),n.e(18),n.e(17),n.e(22),n.e(89)]).then(n.bind(null,"1Cra"));case 4:t=e.sent,i=t.AddEditDocumentViewModel,(r=new i(parseInt(this.SelectedRow.CostCenterID),"",!0)).ScreenObject.DocPrefix.ComboBox.SelectedValue=this.SelectedRow.DocPrefix.toString(),r.ScreenObject.DocPrefix.TextBox.Text=this.SelectedRow.DocNoStr.toString(),r.OnDocPrefixChanged("lostFocus"),r.ScreenObject.FillDocumentPrefix(!0),r.DialogResult=!1,""==this.Parent.ScreenObject.guid&&(this.Parent.ScreenObject.guid=o.e.NewGuid()),r.ScreenObject.guid=this.Parent.ScreenObject.guid,(c=new a).BillWiseViewModel_2(r,0,this.AccountID,!this.IsCredit,1,1,!0,""),r.DialogResult||(c.OkVisible=!1,c.SaveVisible=!1,s.a.page.ShowDialog(c,R.a).subscribe((function(){var e=r.ScreenObject.GetPendingAmount(l.AccountID.toString()),t=0;if(null!=e&&e.Tables.length>0&&e.Columns[0].Contains("bal")&&e.Tables[0].length>0){var n=e.Tables[0].filter((function(e){return e.docno==r.ScreenObject.VoucherNo}));n.length>0&&(t=parseFloat(n[0].bal.toString()))}if(!o.e.IsEmpty(l.SelectedRow.Due)&&parseFloat(l.SelectedRow.Due.toString())!=t&&(l.SelectedRow.Due=t.ToString("N"+l.decimalpoints),l.GridDataColumns.Contains("DueFC")&&!o.e.IsEmpty(l.SelectedRow.ExchgRate)&&(l.SelectedRow.DueFC=(t/parseFloat(l.SelectedRow.ExchgRate.toString())).ToString("N"+l.decimalpoints)),o.e.IsEmpty(l.SelectedRow.Amount)||(l.SelectedRow.Paid=(parseFloat(l.SelectedRow.Amount.toString())-t).ToString("N"+l.decimalpoints)),!l.GridDataColumns.Contains("PaidFC")||o.e.IsEmpty(l.SelectedRow.Paid)||o.e.IsEmpty(l.SelectedRow.ExchgRate)||(l.SelectedRow.PaidFC=(parseFloat(l.SelectedRow.Paid.toString())/parseFloat(l.SelectedRow.ExchgRate.toString())).ToString("N"+l.decimalpoints)),null!=l.NewReferenceDt)){if(null!=e&&e.Tables.length>0&&e.Columns[0].Contains("bal")&&e.Tables[0].length>0)for(var a=function(t){var n=null;(n=o.e.IsEmpty(l.NewReferenceDt[t].DocSeqNo)?e.Tables[0].filter((function(e){return e.docno==l.NewReferenceDt[t].DocumentNo.toString()})):e.Tables[0].filter((function(e){return e.docno==l.NewReferenceDt[t].DocumentNo.toString()&&e.DocSeqNo==l.NewReferenceDt[t].DocSeqNo.toString()}))).length>0&&(l.NewReferenceDt[t].Due=parseFloat(n[0].bal.toString()))},i=0;i<l.NewReferenceDt.length;i++)a(i);var s=l.NewReferenceDt.filter((function(e){return e.DocumentNo==l.SelectedRow.DocNo.toString()&&e.DocSeqNo==l.SelectedRow.DocSeqNo.toString()}));s.length>0&&(s[0].Due=t.ToString("N"+l.decimalpoints))}})));case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),Logger.ErrorLog("Billwise","OnAdjustBill",e.t0.Message);case 15:case"end":return e.stop()}}),e,this,[[0,12]])})))}},{key:"OnserieslinkClick",value:function(){try{null!=this.SelectedRow&&(Object(j.isUndefined)(this.SelectedRow.CostCenterID)||(s.a.page.HideDialog(),L.RibbonExtViewModel.LoadDocument(this.SelectedRow)))}catch(e){Logger.ErrorLog("UnAppDocumentsViewModel","OnLinkClickEvent",e.stack)}}},{key:"BillWiseViewModel_1",value:function(e,t){this.BillWiseViewModel_2(e,0,0,!1,1,1,t,"")}},{key:"BillWiseViewModel_2",value:function(e,t,n,a,i,r,c,u){var d=this;this.DbCrNetFld=u,this.IsInventory=e.IsInventoryVoucher,this.OkVisible=this.IsInventory,this.Parent=e,""!=this.DbCrNetFld?(this.NegAmount.Visible=!0,this.NegAmount.Label=a?"Adjusted Credits":"Adjusted Debits"):this.NegAmount.Visible=!1;var D="",h=!1;if(e.IsInventoryVoucher){n>0&&(h=!0);for(var S=0;S<e.BillWisedt.length;S++)!o.e.IsEmpty(e.BillWisedt[S].AccountID)&&parseInt(e.BillWisedt[S].AccountID)>0&&(D+='<Row AccountID="'+e.BillWisedt[S].AccountID.toString()+'" Iscr="'+e.BillWisedt[S].IsCredit.toString()+'" ',e.BillWisedtColumns.Contains("DocSeqNo")&&(D+=' DocSeqNo="'+e.BillWisedt[S].DocSeqNo.toString()+'" '),D+="  />")}D.length>0&&(D="<XML>"+D+"</XML>");var b=null;e.IsInventoryVoucher||null==e.SelectedRow||(b=e.SelectedRow);var C=new o.f;if(!this.IsInventory&&null!=e.SelectedRow){var y,p=o.e.StringValue(e.SelectedRow.ExtraXML);if(""!=p&&C.ReadXml(p),e.ScreenObject.Preferences.ContainsKey("DbCrBills")&&"True"==e.ScreenObject.Preferences.DbCrBills.toString()&&(this.DBCRVisibility=!0,this.Parent.ScreenObject.GridDataColumns.Contains("guidCol")&&!o.e.IsEmpty(b.guidCol)))if((y=this.Parent.ScreenObject.GridData.filter(18==this.Parent.ScreenObject.DocumentType||19==this.Parent.ScreenObject.DocumentType||21==this.Parent.ScreenObject.DocumentType||22==this.Parent.ScreenObject.DocumentType?function(e){return e.CreditAccount_Key==n&&e.guidCol==b.guidCol.toString()}:14==this.Parent.ScreenObject.DocumentType||15==this.Parent.ScreenObject.DocumentType||20==this.Parent.ScreenObject.DocumentType||23==this.Parent.ScreenObject.DocumentType?function(e){return e.DebitAccount_Key==n&&e.guidCol==b.guidCol.toString()}:function(e){return e.AccountID_Key==n&&e.guidCol==b.guidCol.toString()})).length>1&&(this.drdbcr=y[0]==b?y[1]:y[0]),null!=this.drdbcr&&!o.e.IsEmpty(b.Amount)&&parseFloat(b.Amount.toString())<0)return void(e.DialogResult=!0)}var g="";this.IsInventory||null==e.SelectedRow||o.e.IsEmpty(e.SelectedRow.DocSeqNo)||(this.DocSeqNo=parseInt(e.SelectedRow.DocSeqNo)),this.IsInventory||null==e.SelectedRow||!e.ScreenObject.GridDataColumns.Contains("OldSeqNo")||o.e.IsEmpty(e.SelectedRow.OldSeqNo)||(this.DocSeqNo=parseInt(e.SelectedRow.OldSeqNo)),null!=C&&C.Tables.length>0&&C.Columns[0].Contains("VNO")&&C.Tables[0].length>0?g=e.ScreenObject.ChildVNos:e.ScreenObject.IsDocEdit&&(g=e.ScreenObject.VoucherNo);var f=e.ScreenObject.GetBillWiseDetails(n,D.toString(),a,g,this.DocSeqNo,b,e.DocumentDate,h);if(e.IsInventoryVoucher){if(null==f||0==f.Tables.length)return void(e.DialogResult=!0)}else{if(null==f||0==f.Tables.length)return null!=e.SelectedRow&&(e.SelectedRow.ExtraXML=null,e.SelectedRow.Type=null),void(e.DialogResult=!0);null!=b&&(b.Type=!0)}if(this.IsInventory&&e.ScreenObject.GridDataColumns.Contains("dcCalcdcNum51")){var O=e.ScreenObject.GridData.Compute("sum","dcCalcdcNum51");null!=O&&(this.TotTaxableAmt=o.e.Double(O))}this.NewReference.Enable=!e.IsInventoryVoucher&&0==t,this.ForeignCurrency=!!s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"]);var I=0;this.IsInventory||null==this.Parent.SelectedRow||o.e.IsEmpty(this.Parent.SelectedRow.DocDetailsID)||(I=parseInt(this.Parent.SelectedRow.DocDetailsID)),this.PostVisibility=!(this.DBCRVisibility||!this.Parent.ScreenObject.IsDocEdit||!s.a.SessionManager.IsActionAssigned(this.Parent.CostCenterID,"Post Billwise")||!(!e.IsInventoryVoucher&&I>0||h)),s.a.SessionManager.PersonalSettings.ContainsKey("BillwiseWidth")?(this.Width=o.e.Double(s.a.SessionManager.PersonalSettings.BillwiseWidth),this.GridWidth=this.Width-20):(this.Width=990,this.GridWidth=780),this.GridDataColumns.push("SNO"),this.GridDataColumns.push("DocAbbr"),this.GridDataColumns.push("DocPrefix"),this.GridDataColumns.push("Docnumber"),this.GridDataColumns.push("DocNoStr"),this.GridDataColumns.push("CostCenterID"),this.GridDataColumns.push("DocSeqNo"),this.GridDataColumns.push("DocDate"),this.GridDataColumns.push("DocDate_Key"),this.GridDataColumns.push("DueDate"),this.GridDataColumns.push("DueDate_Key"),this.GridDataColumns.push("DueDays"),this.GridDataColumns.push("CurrID"),this.GridDataColumns.push("CurrName"),this.GridDataColumns.push("ExchgRate"),this.GridDataColumns.push("Amount"),this.GridDataColumns.push("Due"),this.GridDataColumns.push("Paid"),this.GridDataColumns.push("StatusID"),this.GridDataColumns.push("AmountFC"),this.GridDataColumns.push("DueFC"),this.GridDataColumns.push("PaidFC"),this.GridDataColumns.push("DiscAmount"),this.GridDataColumns.push("DiscAccount"),this.GridDataColumns.push("AmountPaid"),this.GridDataColumns.push("AmountPaidLC"),this.GridDataColumns.push("exchgl"),this.GridDataColumns.push("VatAdvance"),this.GridDataColumns.push("IsIncl"),this.GridDataColumns.push("Remarks"),!this.IsInventory&&this.Parent.ScreenObject.Preferences.ContainsKey("NonAccDocs")&&""!=this.Parent.ScreenObject.Preferences.NonAccDocs&&this.GridDataColumns.push("NonAc");var T=2;this.DBCRVisibility&&(T=4);for(var j=0;j<f.Tables[T].length;j++)!o.e.IsEmpty(f.Tables[T][j].CostcenterID)&&parseInt(f.Tables[T][j].CostcenterID)>5e4&&parseInt(f.Tables[T][j].CostcenterID.toString())<50100?this.GridDataColumns.Contains("A"+f.Tables[T][j].CostcenterID.toString())||this.GridDataColumns.push("A"+f.Tables[T][j].CostcenterID.toString()):this.GridDataColumns.Contains(f.Tables[T][j].Name.toString())||(this.GridDataColumns.push(f.Tables[T][j].Name.toString()),"DATE"==f.Tables[T][j].UserColumnType.toString().toUpperCase()&&this.GridDataColumns.push(f.Tables[T][j].Name.toString()+"_Key"));if(this.LoadColumns(f.Tables[T]),this.Accounts.Visible=this.Parent.IsInventoryVoucher,this.AmtToAdjust.Enable=!1,this.AdjustAmt.Enable=!1,this.Parent.IsInventoryVoucher){if(console.log("BILL"),console.log(this.Parent.BillWisedt),null!=f&&f.Tables.length>3)if(f.Columns[3].Contains("AccountID"))for(var P=function(t){var n=d.Parent.BillWisedt.filter((function(e){return e.AccountID==f.Tables[3][t].AccountID}));if(n.length>0)if(e.BillWisedtColumns.Contains("DocSeqNo"))for(var a=0;a<n.length;a++)n[a].AccountName=f.Tables[3][t].AccountName.toString(),d.Accounts.Items.push(m.d.ComboBoxItems_8(f.Tables[3][t].AccountName.toString(),f.Tables[3][t].AccountID.toString(),Object(l.j)(n[a].IsCredit),""!=d.decimalpoints?parseFloat(n[a].Amount).ToString("N"+d.decimalpoints):n[a].Amount.toString(),parseInt(n[a].CurrencyID),parseFloat(n[a].ExchangeRate),parseInt(n[a].DocSeqNo))),f.Tables[3].length>0&&f.Tables[3][0].SelectedAcc.toString()==f.Tables[3][t].AccountID.toString()&&f.Tables[3][0].SelSeq.toString()==n[a].DocSeqNo.toString()&&(d.AccountID=parseInt(f.Tables[3][t].AccountID),d.Accounts.SelectedValue=d.AccountID.toString(),d.IsCredit=Object(l.j)(n[a].IsCredit),d.AmtToAdjust.Text=n[a].Amount.toString(),d.NewReference.Text=n[a].Amount.toString(),d.AdjustAmt.Text="0",d.CurrencyID=parseInt(n[a].CurrencyID),d.ExchangeRate=parseFloat(n[a].ExchangeRate),d.DocSeqNo=parseInt(n[a].DocSeqNo),d.BindExchageRate());else n[0].AccountName=f.Tables[3][t].AccountName.toString(),d.Accounts.Items.push(m.d.ComboBoxItems_8(f.Tables[3][t].AccountName.toString(),f.Tables[3][t].AccountID.toString(),Object(l.j)(n[0].IsCredit),""!=d.decimalpoints?parseFloat(n[0].Amount).ToString("N"+d.decimalpoints):n[0].Amount.toString(),parseInt(n[0].CurrencyID),parseFloat(n[0].ExchangeRate),1)),f.Tables[3].length>0&&f.Tables[3][0].SelectedAcc.toString()==f.Tables[3][t].AccountID.toString()&&(d.AccountID=parseInt(f.Tables[3][t].AccountID),d.Accounts.SelectedValue=d.AccountID.toString(),d.IsCredit=Object(l.j)(n[0].IsCredit),d.AmtToAdjust.Text=parseFloat(n[0].Amount).Commas("N"+d.decimalpoints),d.NewReference.Text=parseFloat(n[0].Amount).Commas("N"+d.decimalpoints),d.AdjustAmt.Text="0",d.CurrencyID=parseInt(n[0].CurrencyID),d.ExchangeRate=parseFloat(n[0].ExchangeRate),d.BindExchageRate())},A=0;A<f.Tables[3].length;A++)P(A);else f.Columns[3].Contains("AdjAmount")&&f.Tables[3].length>0&&(this.AccountID=n,this.AmtToAdjust.Text=f.Tables[3][0].AmountFC.toString().replace("-",""),this.NewReference.Text=f.Tables[3][0].AmountFC.toString().replace("-",""),this.IsCredit=a,this.AdjustAmt.Text="0",this.CurrencyID=parseInt(f.Tables[3][0].AdjCurrID),this.ExchangeRate=parseFloat(f.Tables[3][0].AdjExchRT),this.Accounts.Items.push(m.d.ComboBoxItems_8(f.Tables[3][0].AccountName.toString(),this.AccountID.toString(),this.IsCredit,this.AmtToAdjust.Text.RemoveComma(),this.CurrencyID,this.ExchangeRate,1)),this.Accounts.SelectedValue=this.AccountID.toString())}else""!=this.decimalpoints?(this.AmtToAdjust.Text=t.Commas("N"+this.decimalpoints),this.NewReference.Text=t.Commas("N"+this.decimalpoints)):(this.AmtToAdjust.Text=t.toString(),this.NewReference.Text=t.toString()),this.AdjustAmt.Text="0",this.AccountID=n,this.IsCredit=a,this.CurrencyID=i,this.ExchangeRate=r,this.BindExchageRate();this.GetBillWiseDetails(C,f),this.GridDataObj.BeginEdit.Subscribe(this,"OnBeginEdit"),this.GridDataObj.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.GridDataDBCRObj.BeginEdit.Subscribe(this,"OnBeginEdit"),this.GridDataDBCRObj.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.Accounts.SelectionChangedCommand.Subscribe(this,"OnSave","SelectionChanged"),this.NewReferenceDetailsVisibility||this.NewReferenceVisibility||this.DBCRVisibility||(this.GridHeight=s.a.SessionManager.PersonalSettings.ContainsKey("BillwiseHeight")&&isFinite(s.a.SessionManager.PersonalSettings.BillwiseHeight)?o.e.Double(s.a.SessionManager.PersonalSettings.BillwiseHeight):500),this.IsInventory||!s.a.SessionManager.Preferences.ContainsKey("DistributeCost")||"True"!=s.a.SessionManager.Preferences.DistributeCost||!s.a.SessionManager.Preferences.ContainsKey("CostBasedON")||"True"!=s.a.SessionManager.Preferences.CostBasedON||!s.a.SessionManager.Preferences.ContainsKey("CostBasedONDims")||""==s.a.SessionManager.Preferences.CostBasedONDims||e.ScreenObject.Preferences.ContainsKey("DistributeCost")&&"True"==e.ScreenObject.Preferences.DistributeCost.toString()||this.GroupByDocNo()}},{key:"GroupByDocNo",value:function(){var e=this;this.GridDataColumns.push("IsClubed"),this.GridDataColumns.push("StyleHeightZero");var t=new Array;if(!o.e.IsEmpty(this.Parent.SelectedRow.DocDetailsID)&&parseInt(this.Parent.SelectedRow.DocDetailsID.toString())>0&&s.a.SessionManager.IsActionAssigned(43,"Billwise Distribute on Edit"))this.CanDist=!0;else if(!o.e.IsEmpty(this.Parent.SelectedRow.ExtraXML)){var n=this.ColumnSource.find((function(e){return"amountpaidlc"==e.DisplayMember.toLowerCase()}));null!=n&&(n.ReadOnly=!0),null!=(n=this.ColumnSource.find((function(e){return"amountpaid"==e.DisplayMember.toLowerCase()})))&&(n.ReadOnly=!0),this._FifoEnabled=!1}for(var a=!1,i=function(n){if(!t.Contains(o.e.String(e.GridData[n].DocNo))){t.push(o.e.String(e.GridData[n].DocNo));var i=0,r=0,s=0,l=0,u=0;if((c=e.GridData.filter((function(t){return t.DocNo=="'"+e.GridData[n].DocNo+"'"}))).length>1){a=!0;var d=!1;c.forEach((function(e){o.e.IsEmpty(e.Due)||(r+=parseFloat(e.Due.toString())),o.e.IsEmpty(e.Amount)||(i+=parseFloat(e.Amount.toString())),!o.e.IsEmpty(e.Paid)&&parseFloat(e.Paid.toString())>0?s+=parseFloat(e.Paid.toString()):d||(d=!0),o.e.IsEmpty(e.AmountPaidLC)||(u+=parseFloat(e.AmountPaidLC.toString())),o.e.IsEmpty(e.AmountPaid)||(l+=parseFloat(e.AmountPaid.toString())),e.IsClubed=1,e.sno=-1,e.StyleHeightZero=1}));for(var D=e.GridDataObj.NewRow(),h=0;h<e.GridDataColumns.length;h++)"Due"==e.GridDataColumns[h]?D.Due=r:"Amount"==e.GridDataColumns[h]?D.Amount=i:"Paid"==e.GridDataColumns[h]?D.Paid=s:"AmountPaidLC"==e.GridDataColumns[h]?D.AmountPaidLC=u:"AmountPaid"==e.GridDataColumns[h]?D.AmountPaid=l:"StyleHeightZero"!=e.GridDataColumns[h]&&(D[e.GridDataColumns[h]]=c[0][e.GridDataColumns[h]]);D.IsClubed=s>0&&d?3:2,e.GridDataObj.insertRowAt(D,n)}}},r=0;r<this.GridData.length;r++){var c;i(r)}if(a)for(var l=1,u=0;u<this.GridData.length;u++)"1"!=this.GridData[u].IsClubed.toString()&&(this.GridData[u].sno=l,this.GridDataObj.updateRow(this.GridData[u]),l++)}},{key:"OnBeginEdit",value:function(e){var t=e.args.item,n=e.args.column.DgCol,a=0;if(s.a.SessionManager.IsActionAssigned(43,"Do not adjust future date bills")&&!o.e.IsEmpty(t.DocDate_Key)&&this.Parent.DocumentDate<new Date(t.DocDate_Key))return this.DisplayMessage="Can not adjust future date bills",e.args.Cancel=!0,!1;if("AmountPaid"==n.DisplayMember){var i=o.e.Double(t.AmountPaid);if(o.e.IsEmpty(t.AmountPaid)||0==i){var r,c=0;null!=(r=this.GridDataColumns.Contains("IsClubed")?this.GridData.filter((function(e){return null==e.IsClubed||"1"!=e.IsClubed})).Compute("sum","AmountPaid"):this.GridData.Compute("sum","AmountPaid"))&&null!=r&&(c=o.e.Double(r)),c=o.e.Double(this.AmtToAdjust.Text)+this.GetAdjustedDbCr()-c,s.a.SessionManager.Preferences.ContainsKey("BillwiseCurrency")&&"true"==s.a.SessionManager.Preferences.BillwiseCurrency.toLowerCase()&&!o.e.IsEmpty(t.CurrID)&&parseInt(t.CurrID.toString())==this.CurrencyID?(c>0||this.NewReference.Enable||this.DBCRVisibility&&this.GridDataDBCRObj.Table==this.GridDataDBCR)&&(t.AmountPaid=this.NewReference.Enable||this.DBCRVisibility&&this.GridDataDBCRObj.Table==this.GridDataDBCR||c>parseFloat(t.DueFC)?t.DueFC:""!=this.decimalpoints?c.ToString("N"+this.decimalpoints):c,a=0,o.e.IsEmpty(t.ExchgRate)||parseFloat(t.ExchgRate)==this.ExchangeRate?t.AmountPaidLC=""!=this.decimalpoints?(parseFloat(t.AmountPaid)*this.ExchangeRate).ToString("N"+this.decimalpoints):parseFloat(t.AmountPaid)*this.ExchangeRate:(t.AmountPaidLC=""!=this.decimalpoints?(parseFloat(t.AmountPaid)*parseFloat(t.ExchgRate)).ToString("N"+this.decimalpoints):parseFloat(t.AmountPaid)*parseFloat(t.ExchgRate),a=parseFloat(t.AmountPaid)*(parseFloat(t.ExchgRate)-this.ExchangeRate)),t.exchgl=a):(o.e.IsEmpty(t.CurrID)||parseInt(t.CurrID)!=this.CurrencyID||o.e.IsEmpty(t.ExchgRate)||parseFloat(t.ExchgRate)==this.ExchangeRate?c*=this.ExchangeRate:c*=parseFloat(t.ExchgRate),(c>0||this.NewReference.Enable||this.DBCRVisibility&&this.GridDataDBCRObj.Table==this.GridDataDBCR)&&(t.AmountPaidLC=this.NewReference.Enable||this.DBCRVisibility&&this.GridDataDBCRObj.Table==this.GridDataDBCR||c>parseFloat(t.Due)?t.Due:""!=this.decimalpoints?c.ToString("N"+this.decimalpoints):c,a=0,o.e.IsEmpty(t.CurrID)||parseInt(t.CurrID)!=this.CurrencyID||o.e.IsEmpty(t.ExchgRate)||parseFloat(t.ExchgRate)==this.ExchangeRate?t.AmountPaid=""!=this.decimalpoints?(parseFloat(t.AmountPaidLC)/this.ExchangeRate).ToString("N"+this.decimalpoints):parseFloat(t.AmountPaidLC)/this.ExchangeRate:(t.AmountPaid=""!=this.decimalpoints?(parseFloat(t.AmountPaidLC)/parseFloat(t.ExchgRate)).ToString("N"+this.decimalpoints):parseFloat(t.AmountPaidLC)/parseFloat(t.ExchgRate),a=parseFloat(t.AmountPaid)*(parseFloat(t.ExchgRate)-this.ExchangeRate)),t.exchgl=a))}}else if("AmountPaidLC"==n.DisplayMember){var l=o.e.Double(t.AmountPaidLC);if(o.e.IsEmpty(t.AmountPaidLC)||0==l){var u,d=0;null!=(u=this.GridDataColumns.Contains("IsClubed")?this.GridData.filter((function(e){return null==e.IsClubed||"1"!=e.IsClubed})).Compute("sum","AmountPaid"):this.GridData.Compute("sum","AmountPaid"))&&null!=u&&(d=o.e.Double(u)),d=o.e.Double(this.AmtToAdjust.Text)+this.GetAdjustedDbCr()-d,o.e.IsEmpty(t.CurrID)||parseInt(t.CurrID)!=this.CurrencyID||o.e.IsEmpty(t.ExchgRate)||parseFloat(t.ExchgRate)==this.ExchangeRate?d*=this.ExchangeRate:d*=parseFloat(t.ExchgRate),(d>0||this.NewReference.Enable||this.DBCRVisibility&&this.GridDataDBCRObj.Table==this.GridDataDBCR)&&(t.AmountPaidLC=this.NewReference.Enable||this.DBCRVisibility&&this.GridDataDBCRObj.Table==this.GridDataDBCR||d>parseFloat(t.Due)?t.Due:""!=this.decimalpoints?d.ToString("N"+this.decimalpoints):d,a=0,o.e.IsEmpty(t.CurrID)||parseInt(t.CurrID)!=this.CurrencyID||o.e.IsEmpty(t.ExchgRate)||parseFloat(t.ExchgRate)==this.ExchangeRate?t.AmountPaid=""!=this.decimalpoints?(parseFloat(t.AmountPaidLC)/this.ExchangeRate).ToString("N"+this.decimalpoints):parseFloat(t.AmountPaidLC)/this.ExchangeRate:(t.AmountPaid=""!=this.decimalpoints?(parseFloat(t.AmountPaidLC)/parseFloat(t.ExchgRate)).ToString("N"+this.decimalpoints):parseFloat(t.AmountPaidLC)/parseFloat(t.ExchgRate),a=parseFloat(t.AmountPaid)*(parseFloat(t.ExchgRate)-this.ExchangeRate)),t.exchgl=a)}}}},{key:"OnlinkClick",value:function(e){!this.SeletedNewRef||o.e.IsEmpty(this.SeletedNewRef.DocID)||o.e.IsEmpty(this.SeletedNewRef.CostCenterID)||L.RibbonExtViewModel.LoadDocumentByDocID(this.SeletedNewRef)}},{key:"FillGriddata",value:function(e,t,n,a,i){for(var r=this,c=function(c){var l={};l.SNO=i.length+1,l.DocSeqNo=e.Tables[n][c].DocSeqNo.toString(),r.GridDataColumns.Contains("NonAc")&&(l.NonAc=e.Tables[n][c].NonAc.toString()),r.GridDataColumns.Contains("AdjustBill")&&(l.AdjustBill="Adjust"),e.Columns[n].Contains("DocAbbr")&&e.Columns[n].Contains("DocPrefix")&&e.Columns[n].Contains("Docnumber")&&(l.DocAbbr=e.Tables[n][c].DocAbbr.toString(),l.DocPrefix=e.Tables[n][c].DocPrefix.toString(),l.Docnumber=parseInt(e.Tables[n][c].Docnumber),l.DocNoStr=e.Tables[n][c].Docnumber.toString()),e.Columns[n].Contains("CostCenterID")&&(l.CostCenterID=e.Tables[n][c].CostCenterID.toString()),e.Columns[n].Contains("VatAdvance")&&""!=e.Tables[n][c].VatAdvance.toString()&&(l.VatAdvance=e.Tables[n][c].VatAdvance.toString());var u=0;o.e.IsEmpty(e.Tables[n][c].Amount)||(u=parseFloat(e.Tables[n][c].Amount.toString())),o.e.IsEmpty(e.Tables[n][c].Paid)||(u-=parseFloat(e.Tables[n][c].Paid.toString()));var d="";if(null!=e.Tables[a]&&e.Tables[a].length>0)for(var D=0;D<e.Tables[a].length;D++)d="",""!=(d=!o.e.IsEmpty(e.Tables[a][D].CostCenterID)&&parseInt(e.Tables[a][D].CostCenterID.toString())>5e4&&parseInt(e.Tables[a][D].CostCenterID.toString())<50100?"A"+e.Tables[a][D].CostCenterID.toString():(e.Tables[a][D].Name.toString().Contains("dcAlpha"),e.Tables[a][D].Name.toString()))&&e.Columns[n].Contains(d)&&"DocDate"!=d&&"DocDueDate"!=d&&("DATE"==e.Tables[a][D].UserColumnType.toString().toUpperCase()?o.e.IsEmpty(e.Tables[n][c][d])||(l[d]=new Date(e.Tables[n][c][d].toString()).ToString(s.a.SessionManager.Preferences["Date Format"]),l[d+"_Key"]=e.Tables[n][c][d].toString()):l[d]=o.e.StringValue(e.Tables[n][c][d]).toString());if(l.CurrID=e.Tables[n][c].AdjCurrID.toString(),l.ExchgRate=e.Tables[n][c].AdjExchRT.toString(),l.CurrName=e.Tables[n][c].Name.toString(),e.Columns[n].Contains("StatusID")&&(l.StatusID=e.Tables[n][c].StatusID.toString()),r.GridDataColumns.Contains("Status_COLOR")&&("441"==l.StatusID.toString()?(l.Status_COLOR="BLUE",l.Status="UnApproved"):"371"==l.StatusID.toString()?(l.Status_COLOR="ORANGE",l.Status="UnApproved"):l.Status="Posted"),o.e.IsEmpty(e.Tables[n][c].DocDate)||(l.DocDate=new Date(e.Tables[n][c].DocDate.toString()).ToString(s.a.SessionManager.Preferences["Date Format"]),l.DocDate_Key=new Date(e.Tables[n][c].DocDate.toString())),o.e.IsEmpty(e.Tables[n][c].DocDueDate)||(l.DueDate=new Date(e.Tables[n][c].DocDueDate.toString()).ToString(s.a.SessionManager.Preferences["Date Format"]),l.DueDate_Key=new Date(e.Tables[n][c].DocDueDate.toString())),""!=r.decimalpoints){if(0==parseFloat(u.ToString("N"+r.decimalpoints))&&(!e.Columns[n].Contains("FromDocNo")||o.e.IsEmpty(e.Tables[n][c].FromDocNo)))return"continue";l.Due=u.ToString("N"+r.decimalpoints),o.e.IsEmpty(e.Tables[n][c].Amount)||(l.Amount=parseFloat(e.Tables[n][c].Amount.toString()).ToString("N"+r.decimalpoints)),o.e.IsEmpty(e.Tables[n][c].Paid)||(l.Paid=parseFloat(e.Tables[n][c].Paid.toString()).ToString("N"+r.decimalpoints)),o.e.IsEmpty(e.Tables[n][c].AdjExchRT)||(e.Columns[n].Contains("Paidfc")&&!o.e.IsEmpty(e.Tables[n][c].Paidfc)&&r.GridDataColumns.Contains("PaidFC")?l.PaidFC=parseFloat(e.Tables[n][c].Paidfc.toString()).ToString("N"+r.decimalpoints):!o.e.IsEmpty(e.Tables[n][c].Paid)&&r.GridDataColumns.Contains("PaidFC")&&(l.PaidFC=(parseFloat(e.Tables[n][c].Paid.toString())/parseFloat(e.Tables[n][c].AdjExchRT.toString())).ToString("N"+r.decimalpoints)),""!=e.Tables[n][c].Amount.toString()&&r.GridDataColumns.Contains("AmountFC")&&(l.AmountFC=e.Columns[n].Contains("AmountFC")?parseFloat(e.Tables[n][c].AmountFC.toString()).ToString("N"+r.decimalpoints):(parseFloat(e.Tables[n][c].Amount.toString())/parseFloat(e.Tables[n][c].AdjExchRT.toString())).ToString("N"+r.decimalpoints)),r.GridDataColumns.Contains("DueFC")&&(l.DueFC=!o.e.IsEmpty(e.Tables[n][c].Paid)&&0==parseFloat(e.Tables[n][c].Paid.toString())&&e.Columns[n].Contains("AmountFC")?parseFloat(e.Tables[n][c].AmountFC.toString()).ToString("N"+r.decimalpoints):r.GridDataColumns.Contains("PaidFC")&&!o.e.IsEmpty(l.PaidFC)?(parseFloat(e.Tables[n][c].AmountFC.toString())-parseFloat(l.PaidFC.toString())).ToString("N"+r.decimalpoints):(u/parseFloat(e.Tables[n][c].AdjExchRT.toString())).ToString("N"+r.decimalpoints)))}else l.Due=u,l.Amount=e.Tables[n][c].Amount.toString(),l.Paid=e.Tables[n][c].Paid.toString(),o.e.IsEmpty(e.Tables[n][c].AdjExchRT)||(!o.e.IsEmpty(e.Tables[n][c].Paid)&&r.GridDataColumns.Contains("PaidFC")&&(l.PaidFC=parseFloat(e.Tables[n][c].Paid.toString())/parseFloat(e.Tables[n][c].AdjExchRT.toString())),!o.e.IsEmpty(e.Tables[n][c].Amount)&&r.GridDataColumns.Contains("AmountFC")&&(l.AmountFC=e.Columns[n].Contains("AmountFC")?e.Tables[n][c].AmountFC.toString():parseFloat(e.Tables[n][c].Amount.toString())/parseFloat(e.Tables[n][c].AdjExchRT.toString())),r.GridDataColumns.Contains("DueFC")&&(l.DueFC=!o.e.IsEmpty(e.Tables[n][c].Paid)&&0==parseFloat(e.Tables[n][c].Paid)&&e.Columns[n].Contains("AmountFC")?e.Tables[n][c].AmountFC.toString():r.GridDataColumns.Contains("PaidFC")&&!o.e.IsEmpty(l.PaidFC)?parseFloat(e.Tables[n][c].AmountFC)-parseFloat(l.PaidFC):u/parseFloat(e.Tables[n][c].AdjExchRT)));if(null!=t&&t.Tables.length>0){var h=null;t.Columns[0].Contains("RefDocNo")&&(h=t.Tables[0].filter((function(t){return t.RefDocNo==e.Tables[n][c].DocNo.toString().Replace("'","''")&&t.RefDocSeqNo==e.Tables[n][c].DocSeqNo.toString()&&0==t.IsNewReference}))),null!=h&&h.length>0?(l.AmountPaid=""!=r.decimalpoints?parseFloat(h[0].AmountFC.toString().Replace("-","")).ToString("N"+r.decimalpoints):h[0].AmountFC.toString().Replace("-",""),r.FillExchageRate(l),l.Remarks=h[0].Narration,t.Columns[0].Contains("DiscAmount")&&!o.e.IsEmpty(h[0].DiscAmount)&&(l.DiscAmount=parseFloat(h[0].DiscAmount.toString()).ToString("N"+r.decimalpoints))):t.Tables.length>1&&t.Columns[1].Contains("RefDocNo")&&((h=t.Tables[1].filter((function(t){return t.RefDocNo==e.Tables[n][c].DocNo.toString().Replace("'","''")}))).length>0&&(l.AmountPaid=""!=r.decimalpoints?parseFloat(h[0].Amount.toString()).ToString("N"+r.decimalpoints):h[0].Amount.toString().Replace("-",""),r.FillExchageRate(l),l.Remarks=h[0].Narration,t.Columns[1].Contains("DiscAmount")&&!o.e.IsEmpty(h[0].DiscAmount)&&(l.DiscAmount=h[0].DiscAmount.toString())))}else if(r.IsInventory&&e.Tables.length>4&&e.Columns[4].Contains("RefDocNo")){var S=e.Tables[4].filter((function(t){return t.RefDocNo==e.Tables[n][c].DocNo.toString().Replace("'","''")&&t.RefDocSeqNo==e.Tables[n][c].DocSeqNo.toString()&&0==t.IsNewReference}));S.length>0?(l.AmountPaid=""!=r.decimalpoints?parseFloat(S[0].AmountFC.toString().Replace("-","")).ToString("N"+r.decimalpoints):S[0].AmountFC.toString().Replace("-",""),r.FillExchageRate(l),l.Remarks=S[0].Narration):e.Tables.length>5&&e.Columns[5].Contains("docno")&&((S=e.Tables[5].filter((function(t){return t.docno==e.Tables[n][c].DocNo.toString().Replace("'","''")&&t.DocSeqNo==e.Tables[n][c].DocSeqNo.toString()}))).length>0&&(l.AmountPaid=""!=r.decimalpoints?parseFloat(S[0].amount.toString().Replace("-","")).ToString("N"+r.decimalpoints):S[0].amount.toString().Replace("-",""),r.FillExchageRate(l)))}i.push(l)},l=0;l<e.Tables[n].length;l++)c(l)}},{key:"GetAdjustedDbCr",value:function(){if(!this.NegAmount.Visible)return 0;var e=this.GridDataDBCR.Compute("sum","AmountPaid");return null!=e&&null!=e?(this.NegAmount.Text=""!=this.decimalpoints?parseFloat(e).ToString("N"+this.decimalpoints):parseFloat(e).toString(),parseFloat(e)):(this.NegAmount.Text=""!=this.decimalpoints?(0).ToString("N"+this.decimalpoints):"0".toString(),0)}},{key:"GetBillWiseDetails",value:function(e,t){if(this.GridData.Clear(),this.NewReferenceDetailsVisibility=!1,this.NewReferenceDetails.Clear(),null!=t&&t.Tables.length>0&&!t.Columns[0].Contains("ErrorMessage")){if(this.DBCRVisibility?this.FillGriddata(t,e,this.IsCredit?0:2,4,this.GridData):this.FillGriddata(t,e,0,2,this.GridData),this.FillInclExcl(),this.DBCRVisibility){var n=new o.f;null==this.drdbcr||o.e.IsEmpty(this.drdbcr.ExtraXML)||n.ReadXml(this.drdbcr.ExtraXML.toString()),this.DBCRColumnSource=[];for(var a=0;a<this.ColumnSource.length;a++)this.DBCRColumnSource.push(this.ColumnSource[a]);this.GridDataDBCR=this.GridData,this.FillGriddata(t,n,this.IsCredit?2:0,4,this.GridDataDBCR)}else if(t.Tables.length>1){if(0==this.NewReferenceDetailsColumns.length){this.NewReferenceDetailsColumns.push("SNO"),this.NewReferenceDetailsColumns.push("DocumentNo"),this.NewReferenceDetailsColumns.push("DocSeqNo"),this.NewReferenceDetailsColumns.push("DocDate"),this.NewReferenceDetailsColumns.push("DueDate"),this.NewReferenceDetailsColumns.push("DueDays"),this.NewReferenceDetailsColumns.push("AmountPaid"),this.NewReferenceDetailsColumns.push("CurrName"),this.NewReferenceDetailsColumns.push("ExchgRate"),this.NewReferenceDetailsColumns.push("AmountFC"),this.NewReferenceDetailsColumns.push("DocID"),this.NewReferenceDetailsColumns.push("CostCenterID"),this.NewReferenceDetailsColumns.push("VatAdvance");for(var i=0;i<t.Tables[2].length;i++)!o.e.IsEmpty(t.Tables[2][i].CostCenterID)&&parseInt(t.Tables[2][i].CostCenterID)>5e4?this.GridDataColumns.Contains("A"+t.Tables[2][i].CostCenterID.toString())||this.GridDataColumns.push("A"+t.Tables[2][i].CostCenterID.toString()):this.NewReferenceDetailsColumns.Contains(t.Tables[2][i].Name.toString())||this.NewReferenceDetailsColumns.push(t.Tables[2][i].Name.toString());this.NewReferenceDetailsColumns.Contains("Remarks")||this.NewReferenceDetailsColumns.push("Remarks")}for(var r=0;r<t.Tables[1].length;r++){this.NewReferenceDetailsVisibility=!0;var c=this.NewReferenceDetailsObj.NewRow();c.SNO=this.NewReferenceDetails.length+1,c.DocumentNo=t.Tables[1][r].DocNo.toString(),c.DocSeqNo=t.Tables[1][r].DocSeqNo.toString(),c.CurrName=t.Tables[1][r].Name.toString(),c.ExchgRate=t.Tables[1][r].AdjExchRT.toString(),o.e.IsEmpty(t.Tables[1][r].VatAdvance)||(c.VatAdvance=t.Tables[1][r].VatAdvance.toString()),c.DocID=t.Tables[1][r].DocID.toString(),c.CostCenterID=t.Tables[1][r].CostCenterID.toString(),o.e.IsEmpty(t.Tables[1][r].DocDate)||(c.DocDate=new Date(t.Tables[1][r].DocDate).OnlyDate()),o.e.IsEmpty(t.Tables[1][r].DocDueDate)||(c.DueDate=new Date(t.Tables[1][r].DocDueDate).OnlyDate()),""!=this.decimalpoints?(c.AmountPaid=parseFloat(t.Tables[1][r].AdjAmount.toString().replace("-","")).ToString("N"+this.decimalpoints),t.Columns[1].Contains("AmountFC")?c.AmountFC=parseFloat(t.Tables[1][r].AmountFC).ToString("N"+this.decimalpoints):!o.e.IsEmpty(c.ExchgRate)&&parseFloat(c.ExchgRate)>0&&(c.AmountFC=(parseFloat(t.Tables[1][r].AdjAmount.toString().replace("-",""))/this.ExchangeRate).ToString("N"+this.decimalpoints))):(c.AmountPaid=t.Tables[1][r].AdjAmount.toString().replace("-",""),t.Columns[1].Contains("AmountFC")?c.AmountFC=t.Tables[1][r].AmountFC.toString():!o.e.IsEmpty(c.ExchgRate)&&parseFloat(c.ExchgRate)>0&&(c.AmountFC=parseFloat(t.Tables[1][r].AdjAmount.toString().replace("-",""))/this.ExchangeRate)),c.Remarks=t.Tables[1][r].Narration,this.NewReferenceDetails.push(c)}}if(!this.DBCRVisibility&&!this.IsInventory&&t.Tables.length>5&&t.Tables[5].length>0){this.NewReferenceVisibility=!0,this.NewReferenceDt=[],this.NewReferenceDtColumns.push("SNO"),this.NewReferenceDtColumns.push("DocumentNo"),this.NewReferenceDtColumns.push("DocSeqNo"),this.NewReferenceDtColumns.push("DocDate"),this.NewReferenceDtColumns.push("DueDate"),this.NewReferenceDtColumns.push("DueDays"),this.NewReferenceDtColumns.push("Amount"),this.NewReferenceDtColumns.push("Due"),this.NewReferenceDtColumns.push("DocID"),this.NewReferenceDtColumns.push("CostCenterID");var l=new f.a;l.Header="#",l.DisplayMember="SNO",l.DataType="TextBlock",l.Width=24,l.ReadOnly=!0,this.NewRefColumnSource.push(l),(l=new f.a).Header=s.a.GetResource("BillWise_DocumentNo"),l.DisplayMember="DocumentNo",l.DataType="TextBlock",l.Width=100,l.ReadOnly=!0,l.DataType="LINK",l.Click.Subscribe(this,"OnlinkClick"),this.NewRefColumnSource.push(l),(l=new f.a).Header=s.a.GetResource("BillWise_DocDate"),l.DisplayMember="DocDate",l.DataType="TextBlock",l.Width=78,l.ReadOnly=!0,this.NewRefColumnSource.push(l),(l=new f.a).Header="Total",l.DisplayMember="Amount",l.DataType="FLOAT",l.Width=80,l.ReadOnly=!0,""!=this.decimalpoints&&(l.DecimalPoints=this.decimalpoints),this.NewRefColumnSource.push(l),(l=new f.a).Header="Due",l.DisplayMember="Due",l.DataType="FLOAT",l.Width=80,l.ReadOnly=!0,""!=this.decimalpoints&&(l.DecimalPoints=this.decimalpoints),this.NewRefColumnSource.push(l);for(var u=0;u<t.Tables[5].length;u++){var d=this.NewReferenceDtObj.NewRow();d.SNO=this.NewReferenceDt.length+1,d.DocumentNo=t.Tables[5][u].DocNo.toString(),d.DocID=t.Tables[5][u].DocID.toString(),d.CostCenterID=t.Tables[5][u].CostCenterID.toString(),o.e.IsEmpty(t.Tables[5][u].DocDate)||(d.DocDate=new Date(t.Tables[5][u].DocDate).OnlyDate()),o.e.IsEmpty(t.Tables[5][u].DocDueDate)||(d.DueDate=new Date(t.Tables[5][u].DocDueDate).OnlyDate());var D=0;o.e.IsEmpty(t.Tables[5][u].Amount)||(D=parseFloat(t.Tables[5][u].Amount)),o.e.IsEmpty(t.Tables[5][u].Paid)||(D-=parseFloat(t.Tables[5][u].Paid)),""!=this.decimalpoints?(d.Amount=parseFloat(t.Tables[5][u].Amount).ToString("N"+this.decimalpoints),d.Due=D.ToString("N"+this.decimalpoints)):(d.Amount=t.Tables[5][u].AdjAmount.toString(),d.Due=D),this.NewReferenceDt.push(d)}}}var h=0;if(null!=this.GridData.Compute("sum","AmountPaid")&&(h=parseFloat(this.GridData.Compute("sum","AmountPaid"))),this.AdjustAmt.Text=""!=this.decimalpoints?h.Commas("N"+this.decimalpoints):h.toString(),h=o.e.Double(this.AmtToAdjust.Text)+this.GetAdjustedDbCr()-h,this.NewReference.Enable){if(e.Tables.length>0&&e.Columns[0].Contains("IsNewReference")){var S=e.Tables[0].filter((function(e){return 1==e.IsNewReference}));if(S.length>0){if(h=parseFloat(S[0].AmountFC.toString().Replace("-","")),this.GridDataColumns.Contains("NonAc")){var m=this.GridData.filter((function(e){return 1==e.NonAc})).Compute("sum","AmountPaid");null!=m&&(h-=parseFloat(m))}this.NewReference.Text=""!=this.decimalpoints?h.ToString("N"+this.decimalpoints):h.toString()}}}else this.NewReference.Text=""!=this.decimalpoints?h.Commas("N"+this.decimalpoints):h.toString();this.SetBal(),this.UpdateTotals()}},{key:"AddBillrows",value:function(e,t){null==t.dtmain&&(t.dtmain=[]);var n=new o.f;if(n.ReadXml(e),n.Tables.length>0&&n.Tables[0].length>0&&n.Columns[0].Contains("RefDocNo")&&n.Columns[0].Contains("AdjAmount"))for(var a=0;a<n.Tables[0].length;a++){var i={};i.VoucherNo=n.Tables[0][a].RefDocNo.toString(),i.Amt=n.Tables[0][a].AdjAmount.toString().Replace("-",""),i.SeqNo=n.Tables[0][a].RefDocSeqNo.toString(),i.AmountFC=n.Tables[0][a].AmountFC.toString().Replace("-",""),t.dtmain.push(i)}}},{key:"SetBal",value:function(){var e,t=this,n=null;if(this.Parent.IsInventoryVoucher||null==this.Parent.SelectedRow){if(this.Parent.IsInventoryVoucher&&this.Parent.BillWisedtColumns.Contains("DocSeqNo"))for(var a=0;a<this.Parent.BillWisedt.length;a++)if(this.Parent.BillWisedt[a].AccountID.toString()==this.AccountID.toString()&&this.Parent.BillWisedt[a].DocSeqNo.toString()!=this.DocSeqNo.toString()&&!o.e.IsEmpty(this.Parent.BillWisedt[a].XML)){var i={dsmain:n};this.AddBillrows("<Billwise>"+this.Parent.BillWisedt[a].XML.toString()+"</Billwise>",i),n=i.dsmain}}else if((e=this.Parent.ScreenObject.GridData.filter(18==this.Parent.ScreenObject.DocumentType||19==this.Parent.ScreenObject.DocumentType||21==this.Parent.ScreenObject.DocumentType||22==this.Parent.ScreenObject.DocumentType?function(e){return e.CreditAccount_Key==t.AccountID}:14==this.Parent.ScreenObject.DocumentType||15==this.Parent.ScreenObject.DocumentType||20==this.Parent.ScreenObject.DocumentType||23==this.Parent.ScreenObject.DocumentType?function(e){return e.DebitAccount_Key==t.AccountID}:function(e){return e.AccountID_Key==t.AccountID})).length>1)for(var r=0;r<e.length;r++){var s=e[r];if(!o.e.IsEmpty(s.ExtraXML)&&this.Parent.SelectedRow!=s){var c={dsmain:n};this.AddBillrows(s.ExtraXML.toString(),c),n=c.dsmain}}if(null!=n&&n.length>0){for(var l=function(e){if(!o.e.IsEmpty(t.GridData[e].DocNo)){var a=n.filter((function(n){return n.VoucherNo==t.GridDataDBCR[e].DocNo.toString()&&n.SeqNo==o.e.String(t.GridData[e].DocSeqNo)}));if(a.length>0){var i,r=0,s=0;a.forEach((function(e){o.e.IsEmpty(e.Amt)||(r+=parseFloat(e.Amt),s+=parseFloat(e.AmountFC))})),i=o.e.Double(t.GridData[e].Due),i-=r,t.GridData[e].Due=""!=t.decimalpoints?i.ToString("N"+t.decimalpoints):i,i=o.e.Double(t.GridData[e].DueFC),i-=s,t.GridData[e].DueFC=""!=t.decimalpoints?i.ToString("N"+t.decimalpoints):i}}},u=0;u<this.GridData.length;u++)l(u);if(this.DBCRVisibility)for(var d=function(e){if(o.e.IsEmpty(t.GridDataDBCR[e].DocNo)){var a=n.filter((function(n){return n.VoucherNo==t.GridDataDBCR[e].DocNo.toString()&&n.SeqNo==o.e.String(t.GridDataDBCR[e].DocSeqNo)}));if(a.length>0){var i,r=0,s=0;a.forEach((function(e){o.e.IsEmpty(e.Amt)||(r+=parseFloat(e.Amt.toString()),s+=parseFloat(e.AmountFC.toString()))})),i=o.e.Double(t.GridDataDBCR[e].Due),i-=r,t.GridDataDBCR[e].Due=""!=t.decimalpoints?i.ToString("N"+t.decimalpoints):i,i=o.e.Double(t.GridDataDBCR[e].DueFC),i-=s,t.GridDataDBCR[e].DueFC=""!=t.decimalpoints?i.ToString("N"+t.decimalpoints):i}}},D=0;D<this.GridDataDBCR.length;D++)d(D)}}},{key:"FillInclExcl",value:function(){for(var e,t=this,n="",a=0;a<this.GridData.length;a++)!o.e.IsEmpty(this.GridData[a].VatAdvance)&&parseFloat(this.GridData[a].VatAdvance)>0&&(""!=n&&(n+="','"),n+=this.GridData[a].DocNo.toString());""!=n&&function(){var a=t.Parent.ScreenObject.getVatInclExcl(n);if(null!=a&&a.Tables.length>0&&a.Columns[0].Contains("IsIncl"))for(var i=function(n){(e=t.GridData.filter((function(e){return e.DocNo==a.Tables[0][n].voucherno.toString()}))).length>0&&e.forEach((function(e){e.IsIncl=a.Tables[0][n].IsIncl.toString()}))},r=0;r<a.Tables[0].length;r++)i(r)}()}},{key:"OnCellEditEnding",value:function(e){var t=e.column.DgCol.DisplayMember;"AmountPaid"!=t&&"AmountPaidLC"!=t||this.PaidChange(t,e.item,!0)}},{key:"PaidChange",value:function(e,t,n){if("AmountPaid"==e||"AmountPaidLC"==e){if("AmountPaidLC"==e){var a=0;o.e.IsEmpty(t.AmountPaidLC)?t.AmountPaid=0:o.e.IsEmpty(t.CurrID)||parseInt(t.CurrID)!=this.CurrencyID||o.e.IsEmpty(t.ExchgRate)||parseFloat(t.ExchgRate)==this.ExchangeRate?t.AmountPaid=""!=this.decimalpoints?(parseFloat(t.AmountPaidLC)/this.ExchangeRate).ToString("N"+this.decimalpoints):parseFloat(t.AmountPaidLC)/this.ExchangeRate:(t.AmountPaid=""!=this.decimalpoints?(parseFloat(t.AmountPaidLC)/parseFloat(t.ExchgRate)).ToString("N"+this.decimalpoints):parseFloat(t.AmountPaidLC)/parseFloat(t.ExchgRate),a=parseFloat(t.AmountPaid)*(parseFloat(t.ExchgRate)-this.ExchangeRate)),t.exchgl=a}if(o.e.IsEmpty(t.AmountPaid)||0==parseFloat(t.AmountPaid))t.exchgl=0,t.AmountPaidLC=0;else{var i=o.e.Double(this.AmtToAdjust.Text)+this.GetAdjustedDbCr();if(this.GridDataColumns.Contains("IsClubed")){var r=this.GridData.filter((function(e){return e.SNO!=t.SNO&&(null==e.IsClubed||"1"!=e.IsClubed)}));null!=r.Compute("sum","AmountPaid")&&(i-=r.Compute("sum","AmountPaid"))}else{var c=this.GridData.filter((function(e){return e.SNO!=t.SNO}));null!=c.Compute("sum","AmountPaid")&&(i-=c.Compute("sum","AmountPaid"))}if((i=parseFloat(i.ToString("N"+this.decimalpoints)))<parseFloat(t.AmountPaid)&&!this.NewReference.Enable&&(n&&((i-=parseFloat(t.AmountPaid))<-1e-4&&(this.DisplayMessage="Entered amount exceeds the amount entered in voucher")),t.AmountPaid=""!=this.decimalpoints?i.ToString("N"+this.decimalpoints):i,this.GridDataObj.updateRow(t)),s.a.SessionManager.Preferences.ContainsKey("BillwiseCurrency")&&"true"==s.a.SessionManager.Preferences.BillwiseCurrency.toLowerCase()&&!o.e.IsEmpty(t.CurrID)&&parseInt(t.CurrID.toString())==this.CurrencyID)parseFloat(t.AmountPaid)>parseFloat(t.DueFc)&&(n&&(this.DisplayMessage="Entered amount is more than due"),t.AmountPaid=parseFloat(t.DueFc),this.GridDataObj.updateRow(t));else{var l=0;l=o.e.IsEmpty(t.CurrID)||parseInt(t.CurrID)!=this.CurrencyID||o.e.IsEmpty(t.ExchgRate)||parseFloat(t.ExchgRate)==this.ExchangeRate?parseFloat(t.AmountPaid)*this.ExchangeRate:parseFloat(t.AmountPaid)*parseFloat(t.ExchgRate),""!=this.decimalpoints&&(l=parseFloat(l.ToString("N"+this.decimalpoints))),l>parseFloat(t.Due)&&(n&&(this.DisplayMessage="Entered amount is more than due"),t.AmountPaid=o.e.IsEmpty(t.CurrID)||parseInt(t.CurrID)!=this.CurrencyID||o.e.IsEmpty(t.ExchgRate)||parseFloat(t.ExchgRate)==this.ExchangeRate?parseFloat(t.Due)/this.ExchangeRate:""!=this.decimalpoints?(parseFloat(t.Due)/parseFloat(t.ExchgRate)).ToString("N"+this.decimalpoints):parseFloat(t.Due)/parseFloat(t.ExchgRate),this.GridDataObj.updateRow(t))}this.FillExchageRate(t)}var u;if(null!=(u=this.GridDataColumns.Contains("IsClubed")?this.GridData.filter((function(e){return null==e.IsClubed||"1"!=e.IsClubed})).Compute("sum","AmountPaid"):this.GridData.Compute("sum","AmountPaid"))||""!=this.DbCrNetFld?(null==u&&(u=0),""!=this.decimalpoints?(this.AdjustAmt.Text=parseFloat(u).Commas("N"+this.decimalpoints),this.NewReference.Enable||(this.NewReference.Text=(o.e.Double(this.AmtToAdjust.Text)+this.GetAdjustedDbCr()-parseFloat(u)).Commas("N"+this.decimalpoints))):(this.AdjustAmt.Text=u.toString(),this.NewReference.Enable||(this.NewReference.Text=(o.e.Double(this.AmtToAdjust.Text)+this.GetAdjustedDbCr()-parseFloat(u)).toString()))):(this.AdjustAmt.Text=""!=this.decimalpoints?(0).ToString("N"+this.decimalpoints):"0",this.NewReference.Enable||(this.NewReference.Text=this.AmtToAdjust.Text)),!o.e.IsEmpty(t.VatAdvance)&&parseFloat(t.VatAdvance)>0&&"1"!=t.IsIncl.toString()&&!o.e.IsEmpty(t.Amount)&&parseFloat(t.Amount)>0&&parseFloat(t.AmountPaid)*this.ExchangeRate>this.TotTaxableAmt)return void(this.DisplayMessage="Can not adjust more than:"+this.TotTaxableAmt.ToString("N"+this.decimalpoints)+" from "+t.DocNo.toString());this.UpdateTotals()}}},{key:"FillExchageRate",value:function(e){var t=0;!o.e.IsEmpty(e.AmountPaid)&&parseFloat(e.AmountPaid)>0&&(this.IsCredit?o.e.IsEmpty(e.CurrID)||parseInt(e.CurrID)!=this.CurrencyID||o.e.IsEmpty(e.ExchgRate)||parseFloat(e.ExchgRate)==this.ExchangeRate?e.AmountPaidLC=""!=this.decimalpoints?(parseFloat(e.AmountPaid)*this.ExchangeRate).ToString("N"+this.decimalpoints):parseFloat(e.AmountPaid)*this.ExchangeRate:(e.AmountPaidLC=""!=this.decimalpoints?(parseFloat(e.AmountPaid)*parseFloat(e.ExchgRate)).ToString("N"+this.decimalpoints):parseFloat(e.AmountPaid)*parseFloat(e.ExchgRate),t=parseFloat("-"+e.AmountPaid)*(parseFloat(e.ExchgRate)-this.ExchangeRate)):o.e.IsEmpty(e.CurrID)||parseInt(e.CurrID)!=this.CurrencyID||o.e.IsEmpty(e.ExchgRate)||parseFloat(e.ExchgRate)==this.ExchangeRate?e.AmountPaidLC=""!=this.decimalpoints?(parseFloat(e.AmountPaid)*this.ExchangeRate).ToString("N"+this.decimalpoints):parseFloat(e.AmountPaid)*this.ExchangeRate:(e.AmountPaidLC=""!=this.decimalpoints?(parseFloat(e.AmountPaid)*parseFloat(e.ExchgRate)).ToString("N"+this.decimalpoints):parseFloat(e.AmountPaid)*parseFloat(e.ExchgRate),t=parseFloat(e.AmountPaid)*(parseFloat(e.ExchgRate)-this.ExchangeRate))),e.exchgl=t}},{key:"OnSave",value:function(e){var t=this,n={Message:""};if("Fifo"==e.toString())this.Fifo=!this.Fifo;else if("Disc"==e.toString()&&null!=this.SelectedRow){var a;!o.e.IsEmpty(this.SelectedRow.AmountPaid)&&o.e.Double(this.SelectedRow.DueFC)>0&&(a-=parseFloat(this.SelectedRow.AmountPaid.toString()),this.SelectedRow.DiscAmount=a.ToString("N"+this.decimalpoints),this.GridDataObj.updateRow(this.SelectedRow))}else if("ImportVisiblity"==e.toString())s.a.SessionManager.PersonalSettings.ContainsKey("BillwiseWidth")&&isFinite(s.a.SessionManager.PersonalSettings.BillwiseWidth)?(this.Width=o.e.Double(s.a.SessionManager.PersonalSettings.BillwiseWidth),this.GridWidth=this.Width-270):(this.Width=1050,this.GridWidth=780),this.ImportVisiblity=!0;else if("CancelImport"==e.toString())this.ImportVisiblity=!1,s.a.SessionManager.PersonalSettings.ContainsKey("BillwiseWidth")&&isFinite(s.a.SessionManager.PersonalSettings.BillwiseWidth)?(this.Width=o.e.Double(s.a.SessionManager.PersonalSettings.BillwiseWidth),this.GridWidth=this.Width-20):(this.Width=800,this.GridWidth=780);else if("Import"==e.toString())this.ImportData();else if("Open"==e.toString());else if("openfile"==e.toString());else if("OK"==e.toString())this.GridDataObj.commitEdit(),this.Parent.BillWisedtColumns.Contains("DocSeqNo")?this.Parent.BillWisedt.filter((function(e){return e.AccountID=t.AccountID&&e.DocSeqNo==t.DocSeqNo&&e.IsCredit==t.IsCredit&&e.CurrencyID==t.CurrencyID}))[0].XML=this.GetXml(!1,n):(this.Parent.BillWisedt.filter((function(e){return e.AccountID==t.AccountID&&e.IsCredit==t.IsCredit&&e.CurrencyID==t.CurrencyID}))[0].XML=this.GetXml(!1,n),null!=this.VatAdvanceXML&&this.VatAdvanceXML.length>0&&(this.Parent.BillWisedt.filter((function(e){return e.AccountID==t.AccountID&&e.IsCredit==t.IsCredit&&e.CurrencyID==t.CurrencyID}))[0].DocXML=this.VatAdvanceXML));else if("SelectionChanged"==e.toString())null!=this.Accounts.SelectedItem&&this.FillSelectedAccountDetails(this.Accounts.SelectedItem);else if("SearchSelectionChanged"==e.toString());else if("Save"==e.toString()||"autosave"==e.toString()||"Distsave"==e.toString()||"CntrlSave"==e.toString()){this.GridDataObj.commitEdit(),null!=this.SelectedRow&&"CntrlSave"==e.toString()&&this.PaidChange("AmountPaid",this.SelectedRow,!1);var i="";if(this.IsInventory||null==this.Parent.SelectedRow){if(this.Parent.BillWisedt.length>0){if(this.Parent.BillWisedtColumns.Contains("DocSeqNo")?this.Parent.BillWisedt.filter((function(e){return e.AccountID==t.AccountID&&e.DocSeqNo==t.DocSeqNo&&e.IsCredit==t.IsCredit&&e.CurrencyID==t.CurrencyID}))[0].XML=this.GetXml(!1,n):(this.Parent.BillWisedt.filter((function(e){return e.AccountID==t.AccountID&&e.IsCredit==t.IsCredit&&e.CurrencyID==t.CurrencyID}))[0].XML=this.GetXml(!1,n),null!=this.VatAdvanceXML&&this.VatAdvanceXML.length>0&&(this.Parent.BillWisedt.filter((function(e){return e.AccountID==t.AccountID&&e.IsCredit==t.IsCredit&&e.CurrencyID==t.CurrencyID}))[0].DocXML=this.VatAdvanceXML)),""!=n.Message)return;for(var r=function(e){var n,a=t.Accounts.Items[e];n=a.CurrID>0?a.CurrID.toString():t.CurrencyID.toString();if(""==(t.Parent.BillWisedtColumns.Contains("DocSeqNo")?o.e.String(t.Parent.BillWisedt.filter((function(e){return e.AccountID==t.AccountID&&e.DocSeqNo==a.Seq&&e.IsCredit==t.IsCredit&&e.CurrencyID==t.CurrencyID}))[0].XML):o.e.String(t.Parent.BillWisedt.filter((function(e){return e.AccountID==a.Value&&e.IsCredit==a.Status&&e.CurrencyID==n}))[0].XML)))return{v:(t.DisplayMessage="Select BillWise for "+a.Name,void(t.Parent.BillWisedtColumns.Contains("DocSeqNo")&&(t.DisplayMessage+=" sno:"+a.Seq)))}},c=0;c<this.Accounts.Items.length;c++){var l=r(c);if("object"==typeof l)return l.v}this.Parent.DialogResult=!0,s.a.page.HideDialog(),this.Parent.IsInventoryVoucher&&this.Parent.SaveDocument()}}else{!(s.a.SessionManager.Preferences.ContainsKey("DistributeCost")&&"True"==s.a.SessionManager.Preferences.DistributeCost&&s.a.SessionManager.Preferences.ContainsKey("CostBasedON")&&"True"==s.a.SessionManager.Preferences.CostBasedON&&s.a.SessionManager.Preferences.ContainsKey("CostBasedONDims"))||o.e.IsEmpty(s.a.SessionManager.Preferences.CostBasedONDims)||(this.Parent.ScreenObject.GridDataColumns.Contains("IsDistributed")&&"1"==o.e.String(this.Parent.SelectedRow.IsDistributed)||!o.e.IsEmpty(this.Parent.SelectedRow.DocDetailsID)&&parseInt(this.Parent.SelectedRow.DocDetailsID.toString())>0)&&"Distsave"!=e.toString()||this.Parent.ScreenObject.Preferences.ContainsKey("DistributeCost")&&"True"==this.Parent.ScreenObject.Preferences.DistributeCost.toString()||(s.a.SessionManager.Preferences.CostBasedONDims.split(",").forEach((function(e){parseInt(e)>5e4&&(i+=",DCCCNID"+(parseInt(e)-5e4))})),s.a.SessionManager.Preferences.DistributeCostDims.split(",").forEach((function(e){parseInt(e)>5e4&&(i+=",DCCCNID"+(parseInt(e)-5e4))})),this.Parent.ScreenObject.GridDataColumns.Contains("IsDistributed")||this.Parent.ScreenObject.GridDataColumns.push("IsDistributed"));var u=this.GetXml(!0,n,i);if(""!=n.Message)return;if(("<BillWise>  </BillWise>"!=u||""==i||o.e.IsEmpty(this.Parent.SelectedRow.ExtraXML))&&(this.Parent.SelectedRow.ExtraXML=u),this.NewReference.Enable&&!(null!=this.dtccData&&this.dtccData.length>1)){var d=0;d=isFinite(this.NewReference.Text)?o.e.Double(this.NewReference.Text):0,d+=o.e.Double(this.AdjustAmt.Text),this.Parent.ScreenObject.GridDataColumns.Contains("Amount")&&(this.Parent.SelectedRow.Amount=d)}if(this.VatAdvanceXML.length>0?this.Parent.SelectedRow.DiscXML="<DiscXML>"+this.VatAdvanceXML+"</DiscXML>":this.Parent.ScreenObject.GridDataColumns.Contains("DiscXML")&&!o.e.IsEmpty(this.Parent.SelectedRow.DiscXML)&&(this.Parent.SelectedRow.DiscXML=null),this.DBCRVisibility){if(""!=this.DbCrNetFld){var D=0;D=o.e.Double(this.NewReference.Text)>0?parseFloat(this.NewReference.Text):0,D+=parseFloat(this.AdjustAmt.Text),this.Parent.ScreenObject.GridDataColumns.Contains("Amount")&&(this.Parent.SelectedRow.Amount=D)}n={Message:""},this.GetDBCRXml(n)}this.Parent.DialogResult=!0,this.Parent.ScreenObject.GridDataObj.updateRow(this.Parent.SelectedRow),"autosave"!=e.toString()&&s.a.page.HideDialog()}}else{if("Post"==e.toString()){if(this.GridDataObj.commitEdit(),this.IsInventory||null==this.Parent.SelectedRow){var h=this.GetXml(!0,n);if(""!=n.Message)return;return void(this.DisplayMessage=this.Parent.ScreenObject.PostBillWiseDetails(this.AccountID,this.IsCredit,0,this.DocSeqNo,this.Parent.DocumentDate,h,this.Parent.ScreenObject.guid,{RetValue:0}))}if(this.Parent.SelectedRow.ExtraXML=this.GetXml(!0,n),""!=n.Message)return;var S=0;this.IsInventory||null==this.Parent.SelectedRow||o.e.IsEmpty(this.Parent.SelectedRow.DocSeqNo)||(this.DocSeqNo=parseInt(this.Parent.SelectedRow.DocSeqNo)),this.IsInventory||null==this.Parent.SelectedRow||!this.Parent.ScreenObject.GridDataColumns.Contains("OldSeqNo")||o.e.IsEmpty(this.Parent.SelectedRow.OldSeqNo)||(this.DocSeqNo=parseInt(this.Parent.SelectedRow.OldSeqNo)),this.IsInventory||null==this.Parent.SelectedRow||o.e.IsEmpty(this.Parent.SelectedRow.DocDetailsID)||(S=parseInt(this.Parent.SelectedRow.DocDetailsID));return void(this.DisplayMessage=this.Parent.ScreenObject.PostBillWiseDetails(this.AccountID,this.IsCredit,S,this.DocSeqNo,this.Parent.DocumentDate,this.Parent.SelectedRow.ExtraXML.toString(),this.Parent.ScreenObject.guid,{RetValue:0}))}"Cancel"==e.toString()&&(this.Parent.DialogResult=!1,s.a.page.HideDialog())}}},{key:"ImportData",value:function(){}},{key:"FillSelectedAccountDetails",value:function(e){this.AccountID=parseInt(e.Value),this.IsCredit=e.Status,this.AmtToAdjust.Text=e.Aliasname,this.NewReference.Text=e.Aliasname,this.AdjustAmt.Text="0",this.CurrencyID=e.CurrID,this.ExchangeRate=e.ExchgRate,this.Parent.BillWisedtColumns.Contains("DocSeqNo")&&(this.DocSeqNo=e.Seq),this.BindExchageRate();var t="";this.Parent.ScreenObject.IsDocEdit&&(t=this.Parent.ScreenObject.VoucherNo);var n=this.Parent.ScreenObject.GetBillWiseDetails(this.AccountID,"",this.IsCredit,t,this.DocSeqNo,null,this.Parent.DocumentDate);this.GetBillWiseDetails(null,n)}},{key:"AdjustBills",value:function(){if(this.Fifo){for(var e=o.e.Double(this.AmtToAdjust.Text)+this.GetAdjustedDbCr(),t=0;t<this.GridData.length;t++)if(!(this.GridDataColumns.Contains("IsClubed")&&"1"==o.e.String(this.GridData[t].IsClubed)||s.a.SessionManager.IsActionAssigned(43,"Do not adjust future date bills")&&!o.e.IsEmpty(this.GridData[t].DocDate_Key)&&this.Parent.DocumentDate<new Date(this.GridData[t].DocDate_Key))){var n=0;s.a.SessionManager.Preferences.ContainsKey("BillwiseCurrency")&&"true"==s.a.SessionManager.Preferences.BillwiseCurrency.toLowerCase()&&!o.e.IsEmpty(this.GridData[t].CurrID)&&parseInt(this.GridData[t].CurrID.toString())==this.CurrencyID?n=parseFloat(this.GridData[t].DueFc):(n=parseFloat(this.GridData[t].Due),o.e.IsEmpty(this.GridData[t].CurrID)||parseInt(this.GridData[t].CurrID)!=this.CurrencyID||o.e.IsEmpty(this.GridData[t].ExchgRate)||parseFloat(this.GridData[t].ExchgRate)==this.ExchangeRate?n/=this.ExchangeRate:n/=parseFloat(this.GridData[t].ExchgRate),n=parseFloat(n.ToString("N"+this.decimalpoints))),e>=n?(this.GridData[t].AmountPaid=n,e-=n):!o.e.IsEmpty(this.GridData[t].VatAdvance)&&parseFloat(this.GridData[t].VatAdvance)>0&&"1"!=this.GridData[t].IsIncl.toString()&&e*this.ExchangeRate>this.TotTaxableAmt?(this.GridData[t].AmountPaid=""!=this.decimalpoints?this.TotTaxableAmt.ToString("N"+this.decimalpoints):this.TotTaxableAmt,e-=this.TotTaxableAmt):(this.GridData[t].AmountPaid=""!=this.decimalpoints?e.ToString("N"+this.decimalpoints):e,e=0),this.FillExchageRate(this.GridData[t]),this.GridDataObj.updateRow(this.GridData[t])}""!=this.decimalpoints?(this.AdjustAmt.Text=(o.e.Double(this.AmtToAdjust.Text)+this.GetAdjustedDbCr()-e).Commas("N"+this.decimalpoints),this.NewReference.Text=e.Commas("N"+this.decimalpoints)):(this.AdjustAmt.Text=(o.e.Double(this.AmtToAdjust.Text)+this.GetAdjustedDbCr()-e).toString(),this.NewReference.Text=e.toString())}else{for(var a=0;a<this.GridData.length;a++)this.GridData[a].AmountPaid=0,this.GridData[a].exchgl=0,this.GridData[a].AmountPaidLC=0,this.GridDataObj.updateRow(this.GridData[a]);this.AdjustAmt.Text="0",this.NewReference.Text=this.AmtToAdjust.Text}}},{key:"AdjustClubbedRows",value:function(){for(var e=this,t=function(t){if(e.GridDataColumns.Contains("IsClubed")&&("2"==o.e.String(e.GridData[t].IsClubed)||"3"==o.e.String(e.GridData[t].IsClubed))&&!o.e.IsEmpty(e.GridData[t].AmountPaid)&&parseFloat(e.GridData[t].AmountPaid.toString())>0){var n,i=0,r=parseFloat(e.GridData[t].AmountPaid.toString()),s=parseFloat(e.GridData.filter((function(n){return n.IsClubed=n.DocNo=="'"+e.GridData[t].DocNo.toString()+"'"})).Compute("sum","Amount"));a=e.GridData.filter((function(n){return 1==n.IsClubed&&n.DocNo=="'"+e.GridData[t].DocNo.toString()+"'"}));for(var c=0;c<a.length;c++)if("2"==o.e.String(e.GridData[t].IsClubed))n=c==a.length-1?r-i:parseFloat(a[c].Amount)/s*r,n=parseFloat(n.ToString("N"+e.decimalpoints)),a[c].AmountPaid=n,i+=n;else{if(n=parseFloat(a[c].Due.toString()),!(r>(n=parseFloat(n.ToString("N"+e.decimalpoints))))){a[c].AmountPaid=r;break}a[c].AmountPaid=n,r-=n}}},n=0;n<this.GridData.length;n++){var a;t(n)}}},{key:"GetDBCRXml",value:function(e){e.Message="",0==this.CurrencyID&&(this.CurrencyID=1),0==this.ExchangeRate&&(this.ExchangeRate=1);var t="";t+="<BillWise> ";for(var n=0,a=0,i=0;i<this.GridDataDBCR.length;i++)if((!this.GridDataColumns.Contains("IsClubed")||"2"!=this.GridDataDBCR[i].IsClubed.toString()&&"3"!=this.GridDataDBCR[i].IsClubed.toString())&&(!this.GridDataColumns.Contains("NonAc")||"1"!=this.GridDataDBCR[i].NonAc.toString())&&(this.GridDataColumns.Contains("ExchgRate")&&null!=this.GridDataDBCR[i].ExchgRate&&!o.e.IsEmpty(this.GridDataDBCR[i].ExchgRate)&&"0"==this.GridDataDBCR[i].ExchgRate.toString()&&(this.GridDataDBCR[i].ExchgRate="1"),!o.e.IsEmpty(this.GridDataDBCR[i].AmountPaid)&&parseFloat(this.GridDataDBCR[i].AmountPaid.toString())>0)){var r=parseFloat(this.GridDataDBCR[i].AmountPaid.toString());a+=r,t+="<Row ",t+=null!=this.drdbcr?'DocSeqNo="'+this.drdbcr.DocSeqNo.toString()+'" ':'DocSeqNo="1" ',t+='AccountID="'+this.AccountID.toString()+'" ',this.IsCredit?(t+='AmountFC="'+r+'" ',this.GridDataColumns.Contains("CurrID")&&this.GridDataColumns.Contains("ExchgRate")&&!o.e.IsEmpty(this.GridDataDBCR[i].CurrID)&&parseInt(this.GridDataDBCR[i].CurrID.toString())==this.CurrencyID&&!o.e.IsEmpty(this.GridDataDBCR[i].ExchgRate)&&parseFloat(this.GridDataDBCR[i].ExchgRate.toString())!=this.ExchangeRate?(t+=""!=this.decimalpoints?'AdjAmount="'+(r*parseFloat(this.GridDataDBCR[i].ExchgRate.toString())).ToString("N"+this.decimalpoints)+'" ':'AdjAmount="'+r*parseFloat(this.GridDataDBCR[i].ExchgRate.toString())+'" ',t+='AdjExchRT="'+this.GridDataDBCR[i].ExchgRate.toString()+'" ',n+=r*(parseFloat(this.GridDataDBCR[i].ExchgRate.toString())-this.ExchangeRate)):(t+=""!=this.decimalpoints?'AdjAmount="'+(r*this.ExchangeRate).ToString("N"+this.decimalpoints)+'" ':'AdjAmount="'+r*this.ExchangeRate+'" ',t+='AdjExchRT="'+this.ExchangeRate.toString()+'" ')):(t+='AmountFC="-'+r+'" ',this.GridDataColumns.Contains("CurrID")&&this.GridDataColumns.Contains("ExchgRate")&&!o.e.IsEmpty(this.GridDataDBCR[i].CurrID)&&parseInt(this.GridDataDBCR[i].CurrID.toString())==this.CurrencyID&&!o.e.IsEmpty(this.GridDataDBCR[i].ExchgRate)&&parseFloat(this.GridDataDBCR[i].ExchgRate.toString())!=this.ExchangeRate?(t+=""!=this.decimalpoints?'AdjAmount="-'+(r*parseFloat(this.GridDataDBCR[i].ExchgRate.toString())).ToString("N"+this.decimalpoints)+'" ':'AdjAmount="-'+r*parseFloat(this.GridDataDBCR[i].ExchgRate.toString())+'" ',t+='AdjExchRT="'+this.GridDataDBCR[i].ExchgRate.toString()+'" ',n+=r*(parseFloat(this.GridDataDBCR[i].ExchgRate.toString())-this.ExchangeRate)):(t+=""!=this.decimalpoints?'AdjAmount="-'+(r*this.ExchangeRate).ToString("N"+this.decimalpoints)+'" ':'AdjAmount="-'+r*this.ExchangeRate+'" ',t+='AdjExchRT="'+this.ExchangeRate.toString()+'" ')),"0"!=this.CurrencyID.toString()?t+='AdjCurrID="'+this.CurrencyID.toString()+'" ':"0"==this.CurrencyID.toString()&&(t+='AdjCurrID="1" '),t+='IsNewReference="0" ',t+='RefDocNo="'+h.d.GetValidXml(o.e.String(this.GridDataDBCR[i].DocNo))+'" ',t+='RefStatusID="'+o.e.String(this.GridDataDBCR[i].StatusID)+'" ',t+='RefDocSeqNo="'+o.e.String(this.GridDataDBCR[i].DocSeqNo)+'" ',o.e.IsEmpty(this.GridDataDBCR[i].DocDate_Key)||(t+='RefDocDate="'+new Date(this.GridDataDBCR[i].DocDate_Key.toString()).ToString("dd/MMM/yyyy")+'" '),o.e.IsEmpty(this.GridDataDBCR[i].DueDate_Key)||(t+='RefDocDueDate="'+new Date(this.GridDataDBCR[i].DueDate_Key.toString()).ToString("dd/MMM/yyyy")+'" '),t+='Narration="'+o.e.String(this.GridDataDBCR[i].Remarks)+'" ',t+='DiscAmount="0" ',t+='IsDocPDC="0" >',t+=" </Row>"}if(t+=" </BillWise>",a>0){if(null==this.drdbcr){18!=this.Parent.DocumentType&&19!=this.Parent.DocumentType&&21!=this.Parent.DocumentType&&22!=this.Parent.DocumentType||!this.Parent.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")?14!=this.Parent.DocumentType&&15!=this.Parent.DocumentType&&20!=this.Parent.DocumentType&&23!=this.Parent.DocumentType||!this.Parent.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")?this.Parent.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&(this.drdbcr=this.Parent.ScreenObject.GridData[this.Parent.GetEmptyRowPosition(this.Parent.ScreenObject.GridDataObj,"AccountID_Key")]):this.drdbcr=this.Parent.ScreenObject.GridData[this.Parent.GetEmptyRowPosition(this.Parent.ScreenObject.GridDataObj,"DebitAccount_Key")]:this.drdbcr=this.Parent.ScreenObject.GridData[this.Parent.GetEmptyRowPosition(this.Parent.ScreenObject.GridDataObj,"CreditAccount_Key")];for(var s=0;s<this.Parent.ScreenObject.GridDataColumns.length;s++)"DocDetailsID"!=this.Parent.ScreenObject.GridDataColumns[s]&&(this.drdbcr[this.Parent.ScreenObject.GridDataColumns[s]]=this.Parent.SelectedRow[this.Parent.ScreenObject.GridDataColumns[s]]);this.Parent.ScreenObject.GridDataColumns.Contains("guidCol")||this.Parent.ScreenObject.GridDataColumns.push("guidCol"),this.drdbcr.guidCol=o.e.NewGuid(),this.Parent.SelectedRow.guidCol=this.drdbcr.guidCol}this.drdbcr.Amount=-a,""!=this.DbCrNetFld&&(this.Parent.ScreenObject.Preferences.ContainsKey("NegAmountFld")&&!o.e.IsEmpty(this.Parent.ScreenObject.Preferences.NegAmountFld)&&this.Parent.ScreenObject.GridDataColumns.Contains(this.Parent.ScreenObject.Preferences.NegAmountFld)?this.Parent.SelectedRow[this.Parent.ScreenObject.Preferences.NegAmountFld]=-a:a>0&&(this.Parent.DisplayMessage="Define Neg Amount field",this.Parent.MessageVisibility=!0),this.Parent.CalculateTotals(this.Parent.SelectedRow,!1,this.DbCrNetFld),this.Parent.CalculateTotals(this.drdbcr,!1,this.DbCrNetFld),this.Parent.ScreenObject.GridDataColumns.Contains("StyleHeightZero")?"1"!=o.e.String(this.drdbcr.StyleHeightZero)&&(this.Parent.ScreenObject.GridDataColumns.push("tempcol"),this.drdbcr.StyleHeightZero=1,this.Parent.ScreenObject.GridDataColumns.Remove("tempcol")):(this.Parent.ScreenObject.GridDataColumns.push("StyleHeightZero"),this.drdbcr.StyleHeightZero=1)),this.Parent.ScreenObject.UpdateSequence(),this.drdbcr.ExtraXML=t.toString();var c=this.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&50403==e.LinkData}));c.length>0&&this.Parent.ScreenObject.GridDataColumns.Contains(c[0].SysColumnName.toString())?(this.drdbcr[c[0].SysColumnName.toString()]=n,c[0].SysColumnName.toString().toLowerCase().Contains("dcnum")&&(this.drdbcr["dcCalc"+c[0].SysColumnName.toString()]=n)):0!=n&&(this.Parent.DisplayMessage="Define Exchange gain or loss field",this.Parent.MessageVisibility=!0)}else null!=this.drdbcr&&this.Parent.ClearDatarow(this.drdbcr,!0)}},{key:"GetXml",value:function(e,t){var n=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(t.Message="",this.VatAdvanceXML="",!this.NewReference.Enable||null!=this.dtccData&&this.dtccData.length>1){var i,r=o.e.Double(this.AmtToAdjust.Text);if(null!=(i=this.GridDataColumns.Contains("IsClubed")?this.GridData.filter((function(e){return null==e.IsClubed||"1"!=e.IsClubed})).Compute("sum","AmountPaid"):this.GridData.Compute("sum","AmountPaid"))&&null!=i&&(r-=parseFloat(i)),(r=parseFloat(r.ToString("N"+this.decimalpoints)))<-1e-4)return t.Message=this.DisplayMessage="Entered amount exceeds the amount entered in voucher",""}0==this.CurrencyID&&(this.CurrencyID=1),0==this.ExchangeRate&&(this.ExchangeRate=1);var u=0;if(o.e.Double(this.NewReference.Text)>0&&(u=parseFloat((o.e.Double(this.NewReference.Text)*this.ExchangeRate).ToString("N"+this.decimalpoints))),u>0&&this.Parent.ScreenObject.Preferences.ContainsKey("DisableNewReference")&&!o.e.IsEmpty(this.Parent.ScreenObject.Preferences.DisableNewReference)&&Object(l.j)(this.Parent.ScreenObject.Preferences.DisableNewReference))return this.DisplayMessage="New Reference is Disabled",t.Message=this.DisplayMessage,"";if(this.NewReferenceDetailsVisibility&&this.NewReferenceDetails.length>0){var d=0,D=0;1==this.Parent.ScreenObject.DocumentType||27==this.Parent.ScreenObject.DocumentType||26==this.Parent.ScreenObject.DocumentType||25==this.Parent.ScreenObject.DocumentType||2==this.Parent.ScreenObject.DocumentType||34==this.Parent.ScreenObject.DocumentType||6==this.Parent.ScreenObject.DocumentType||3==this.Parent.ScreenObject.DocumentType||4==this.Parent.ScreenObject.DocumentType||13==this.Parent.ScreenObject.DocumentType?null!=this.Parent.ScreenObject.CreditAccount&&this.Parent.ScreenObject.CreditAccount.SelectedValue>0&&(d=this.Parent.ScreenObject.CreditAccount.SelectedValue):11!=this.Parent.ScreenObject.DocumentType&&5!=this.Parent.ScreenObject.DocumentType&&7!=this.Parent.ScreenObject.DocumentType&&9!=this.Parent.ScreenObject.DocumentType&&24!=this.Parent.ScreenObject.DocumentType&&33!=this.Parent.ScreenObject.DocumentType&&10!=this.Parent.ScreenObject.DocumentType&&8!=this.Parent.ScreenObject.DocumentType&&12!=this.Parent.ScreenObject.DocumentType||null!=this.Parent.ScreenObject.DebitAccount&&this.Parent.ScreenObject.DebitAccount.SelectedValue>0&&(d=this.Parent.ScreenObject.DebitAccount.SelectedValue),this.AccountID==d&&o.e.IsValidID(this.Parent.ScreenObject.PostVoucherDocID)&&(D=this.Parent.ScreenObject.PostVoucherAmount);var S=this.NewReferenceDetails.Compute("sum","AmountPaid");if(null!=S&&parseFloat(parseFloat(S).ToString("N"+this.decimalpoints))-D>u)return this.DisplayMessage=s.a.GetResource("Doc_BillWiseNewRef"),t.Message=this.DisplayMessage,""}var m=0;5==this.Parent.DocumentType&&(m="0"!=this.Parent.BillWisedt.filter((function(e){return e.AccountID==n.AccountID&&e.IsCredit==n.IsCredit&&e.CurrencyID==n.CurrencyID}))[0].FromTo.toString()?1:-1);var b,y="";e&&(y+="<BillWise> "),b=""!=this.decimalpoints?(o.e.Double(this.NewReference.Text)*this.ExchangeRate).ToString("N"+this.decimalpoints):(o.e.Double(this.NewReference.Text)*this.ExchangeRate).toString();var p=this.NewReference.Text.RemoveComma();if(this.GridDataColumns.Contains("NonAc")){var g=this.GridData.filter((function(e){return 1==e.NonAc})).Compute("sum","AmountPaid");null!=g&&(p=(parseFloat(p)+parseFloat(g)).ToString("N"+this.decimalpoints),b=(parseFloat(b)+parseFloat(g)).ToString("N"+this.decimalpoints))}var f=0,O=0;if(this.IsInventory||(O=this.Parent.ScreenObject.GridData.indexOf(this.Parent.SelectedRow)),parseFloat(p)>0){var I,T,P,A=function(){var e=1,i=0,r=0,c=null;if(""!=a){I=s.a.SessionManager.Preferences.CostBasedONDims.split(",");var l="",u=!1;I.forEach((function(e){if(parseInt(e)>5e4)if(n.Parent.ScreenObject.GridDataColumns.Contains("DCCCNID"+(parseInt(e)-5e4)+"_Key"))o.e.IsEmpty(n.Parent.SelectedRow["DCCCNID"+(parseInt(e)-5e4)+"_Key"])||(l+=" and DCCCNID"+(parseInt(e)-5e4)+"="+n.Parent.SelectedRow["DCCCNID"+(parseInt(e)-5e4)+"_Key"].toString());else{var t=n.Parent.ScreenObject._CCFields.find((function(t){return t instanceof C.b&&t.CCID==parseInt(e)}));null!=t&&t.SelectedValue>0&&(l+=" and DCCCNID"+(parseInt(e)-5e4)+"="+t.SelectedValue.toString())}else 2==parseInt(e)?l+=" and AccountID in("+n.AccountID+",0)":502==parseInt(e)&&(u=!0,l+=" and (db.AccountID is not null or Cr.AccountID is not null)")})),null!=(c=n.Parent.ScreenObject.getProfileBasedon(n.AccountID,0,u,l))&&c.Tables.length>0&&c.Columns[0].Contains("ProfileID")&&c.Tables[0].length>0&&(e=c.Tables[0].length)}T=s.a.SessionManager.Preferences.DistributeCostDims.split(",");for(var d=function(a){if(e>1?(a+1==c.Tables[0].length?r=parseFloat((parseFloat(p)-i).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())):!o.e.IsEmpty(c.Tables[0][a].Percent)&&parseFloat(c.Tables[0][a].Percent.toString())>0?r=parseFloat((parseFloat(p)*parseFloat(c.Tables[0][a].Percent.toString())/100).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())):!o.e.IsEmpty(c.Tables[0][a].Amount)&&parseFloat(c.Tables[0][a].Amount.toString())>0&&(r=parseFloat(c.Tables[0][a].Amount.toString())),i+=r):r=parseFloat(p),s.a.SessionManager.Preferences.ContainsKey("ExclZerodist")&&"True"==s.a.SessionManager.Preferences.ExclZerodist&&0==r)return"continue";var l=null;if(f>0){l=n.Parent.ScreenObject.GridDataObj.NewRow(),n.Parent.ScreenObject.GridDataObj.insertRowAt(l,O+f);for(var u=0;u<n.Parent.ScreenObject.GridDataColumns.length;u++)"DocDetailsID"!=n.Parent.ScreenObject.GridDataColumns[u]&&(l[n.Parent.ScreenObject.GridDataColumns[u]]=n.Parent.SelectedRow[n.Parent.ScreenObject.GridDataColumns[u]])}else null!=c&&c.Tables.length>0&&c.Columns[0].Contains("ProfileID")&&c.Tables[0].length>0&&(l=n.Parent.SelectedRow);if(null!=c&&c.Tables.length>0&&c.Columns[0].Contains("ProfileID")&&c.Tables[0].length>0&&(T.forEach((function(e){parseInt(e)>5e4&&c.Columns[0].Contains("DCCCNID"+(parseInt(e)-5e4))&&!o.e.IsEmpty(c.Tables[0][a]["DCCCNID"+(parseInt(e)-5e4)])&&n.Parent.ScreenObject.GridDataColumns.Contains("DCCCNID"+(parseInt(e)-5e4)+"_Key")&&(l["DCCCNID"+(parseInt(e)-5e4)]=null,l["DCCCNID"+(parseInt(e)-5e4)+"_Key"]=c.Tables[0][a]["DCCCNID"+(parseInt(e)-5e4)].toString())})),n.Parent.ScreenObject.GridDataColumns.Contains("Amount")?l.Amount=r:n.IsCredit&&n.Parent.ScreenObject.GridDataColumns.Contains("CreditAmount")?l.CreditAmount=r:!n.IsCredit&&n.Parent.ScreenObject.GridDataColumns.Contains("DebitAmount")&&(l.DebitAmount=r),f++),y+="<Row ",n.IsInventory||null==n.Parent.SelectedRow?n.IsInventory&&null!=n.Parent.BillWisedt&&n.Parent.BillWisedtColumns.Contains("DocSeqNo")?y+='DocSeqNo="'+n.DocSeqNo+'" ':y+='DocSeqNo="1" ':y+='DocSeqNo="'+n.Parent.SelectedRow.DocSeqNo.toString()+'" ',y+='AccountID="'+n.AccountID.toString()+'" ',n.IsCredit?(y+='AmountFC="-'+r+'" ',y+=e>1?'AdjAmount="-'+(r*n.ExchangeRate).ToString("N"+n.decimalpoints)+'" ':'AdjAmount="-'+b+'" '):(y+='AmountFC="'+r+'" ',y+=e>1?'AdjAmount="'+(r*n.ExchangeRate).ToString("N"+n.decimalpoints)+'" ':'AdjAmount="'+b+'" '),y+='AdjCurrID="'+n.CurrencyID.toString()+'" ',y+='AdjExchRT="'+n.ExchangeRate.toString()+'" ',y+='IsNewReference="1" ',y+='Narration="" ',y+='IsDocPDC="0" ',5==n.Parent.DocumentType)y+='InvDocDetID="'+m+'" ';else if(42==n.Parent.DocumentType||40==n.Parent.DocumentType){var d=0;if(n.Parent.ScreenObject.GridDataColumns.Contains("dcCalcdcNum59")&&(null!=(P=n.Parent.ScreenObject.GridData.Compute("sum","dcCalcdcNum59"))&&(d=o.e.Double(P)),n.IsCredit&&(d*=-1)),y+='VatAdvance="'+d+'" ',n.NewReferenceDetailsVisibility&&n.NewReferenceDetails.length>0)return{v:{v:(n.DisplayMessage="Vat advance can not be edited after Adjustments.Delete adjustments to edit.",t.Message=n.DisplayMessage,"")}}}y+=" ></Row>",null!=l&&null!=l&&(y+=" </BillWise>",l.IsDistributed=1,l.ExtraXML=y.toString(),y="",y+="<BillWise> ",n.Parent.CalculateTotals(l,!1))},D=0;D<e;D++){var h=d(D);if("continue"!==h&&"object"==typeof h)return h.v}}();if("object"==typeof A)return A.v}var M=new c.a;this.IsInventory||null==this.Parent.SelectedRow||this.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&99==e.LocalReference&&e.SysColumnName.startsWith("dcAlpha")})).forEach((function(e){if(n.Parent.ScreenObject.GridDataColumns.Contains(e.SysColumnName.toString())){var t=n.ColumnSource.find((function(t){return t.ID==e.LinkData.toString()}));t&&M.push(e.SysColumnName.toString(),t.DisplayMember),n.Parent.SelectedRow[e.SysColumnName.toString()]=null}})),o.e.StringIsNullOrEmpty(a)||this.AdjustClubbedRows();var v=0,G=0,N="",E=function(){for(var i=0,r=0,c=0,l=null,u=function(e){if((!n.GridDataColumns.Contains("IsClubed")||"2"!=o.e.String(n.GridData[e].IsClubed)&&"3"!=o.e.String(n.GridData[e].IsClubed))&&(!n.GridDataColumns.Contains("NonAc")||"1"!=n.GridData[e].NonAc.toString())&&(n.GridDataColumns.Contains("ExchgRate")&&!o.e.IsEmpty(n.GridData[e].ExchgRate)&&"0"==n.GridData[e].ExchgRate.toString()&&(n.GridData[e].ExchgRate="1"),!o.e.IsEmpty(n.GridData[e].AmountPaid)&&parseFloat(n.GridData[e].AmountPaid)>0)){if(!n.IsInventory&&null!=n.Parent.SelectedRow){if(!o.e.IsEmpty(n.GridData[e].VatAdvance)&&parseFloat(n.GridData[e].VatAdvance)>0)return{v:{v:(n.DisplayMessage="VatAdvance can not be used in this voucher.",t.Message=n.DisplayMessage,"")}};if(0==v&&n.FillPickFrom(n.AccountID,n.GridData[e].DocNo.toString(),a),n.NewReference.Enable&&null!=n.dtccData&&n.dtccData.length>1&&!n.dtccData[G].docno.toString().split(",").Contains(n.GridData[e].DocNo.toString()))return"continue";n.NewReference.Enable&&null!=n.dtccData&&n.dtccData.length>1&&(c+=parseFloat(n.GridData[e].AmountPaid)),v++,M.keys.forEach((function(t){var a=t,i=M[t];v>1&&!o.e.IsEmpty(n.Parent.SelectedRow[a])&&(n.Parent.SelectedRow[a]=n.Parent.SelectedRow[a].toString()+","),n.Parent.SelectedRow[a]=n.Parent.SelectedRow[a].toString()+o.e.StringValue(n.GridData[e][i]),n.GridDataColumns.Contains(i+"_Key")&&n.Parent.ScreenObject.GridDataColumns.Contains(a+"_Key")&&(n.Parent.SelectedRow[a+"_Key"]=o.e.StringValue(n.GridData[e][i+"_Key"]))}))}var u=null,d=1,D=0,S=0;if(""!=a&&(null!=(u=n.Parent.ScreenObject.getDistribution(a,o.e.String(n.GridData[e].DocNo),n.IsCredit,n.AccountID,o.e.String(n.GridData[e].DocSeqNo)))&&u.length>0&&null!=u[0].amt&&u.length>0)){d=u.length;var b=u.Compute("sum","amt");null!=b&&null!=b&&(D=parseFloat(b))}for(var C=0;C<d;C++){var p=parseFloat(o.e.String(n.GridData[e].AmountPaid));if(d>1&&D>0){if(p=C+1==d?parseFloat(o.e.String(n.GridData[e].AmountPaid))-S:parseFloat(o.e.String(n.GridData[e].AmountPaid))*(parseFloat(o.e.String(u[0][C].amt))/D),p=parseFloat(p.ToString("N"+n.decimalpoints)),s.a.SessionManager.Preferences.ContainsKey("ExclZerodist")&&"True"==s.a.SessionManager.Preferences.ExclZerodist&&0==p)continue;S+=p}if(f>0){l=n.Parent.ScreenObject.GridDataObj.NewRow(),n.Parent.ScreenObject.GridDataObj.insertRowAt(l,n.Parent.ScreenObject.GridData.indexOf(n.Parent.SelectedRow)+1);for(var g=0;g<n.Parent.ScreenObject.GridDataColumns.length;g++)"DocDetailsID"!=n.Parent.ScreenObject.GridDataColumns[g]&&(l[n.Parent.ScreenObject.GridDataColumns[g]]=n.Parent.SelectedRow[n.Parent.ScreenObject.GridDataColumns[g]])}else null!=u&&u.length>0&&null!=u[0].amt&&(l=n.Parent.SelectedRow);if(null!=u&&u.length>0&&null!=u[0].amt){for(var O=1;O<Object.keys(u[0]).length;O++){var I=Object.keys(u[0])[O];n.Parent.ScreenObject.GridDataColumns.Contains(I+"_Key")&&(l[I]=null,l[I+"_Key"]=o.e.String(u[0][C][I]))}n.Parent.ScreenObject.GridDataColumns.Contains("Amount")?l.Amount=p:n.IsCredit&&n.Parent.ScreenObject.GridDataColumns.Contains("CreditAmount")?l.CreditAmount=p:!n.IsCredit&&n.Parent.ScreenObject.GridDataColumns.Contains("DebitAmount")&&(l.DebitAmount=p),f++}if(y+="<Row ",n.IsInventory||null==n.Parent.SelectedRow?n.IsInventory&&null!=n.Parent.BillWisedt&&n.Parent.BillWisedtColumns.Contains("DocSeqNo")?y+='DocSeqNo="'+n.DocSeqNo+'" ':y+='DocSeqNo="1" ':y+='DocSeqNo="'+n.Parent.SelectedRow.DocSeqNo.toString()+'" ',y+='AccountID="'+n.AccountID.toString()+'" ',n.IsCredit?(y+='AmountFC="-'+p+'" ',n.GridDataColumns.Contains("CurrID")&&n.GridDataColumns.Contains("ExchgRate")&&!o.e.IsEmpty(n.GridData[e].CurrID)&&parseInt(n.GridData[e].CurrID.toString())==n.CurrencyID&&!o.e.IsEmpty(n.GridData[e].ExchgRate)&&parseFloat(n.GridData[e].ExchgRate.toString())!=n.ExchangeRate?(y+=""!=n.decimalpoints?'AdjAmount="-'+(p*parseFloat(n.GridData[e].ExchgRate.toString())).ToString("N"+n.decimalpoints)+'" ':'AdjAmount="-'+p*parseFloat(n.GridData[e].ExchgRate.toString())+'" ',y+='AdjExchRT="'+n.GridData[e].ExchgRate.toString()+'" ',i+=p*(parseFloat(n.GridData[e].ExchgRate.toString())-n.ExchangeRate)):(y+=""!=n.decimalpoints?'AdjAmount="-'+(p*n.ExchangeRate).ToString("N"+n.decimalpoints)+'" ':'AdjAmount="-'+p*n.ExchangeRate+'" ',y+='AdjExchRT="'+n.ExchangeRate.toString()+'" ')):(y+='AmountFC="'+p+'" ',n.GridDataColumns.Contains("CurrID")&&n.GridDataColumns.Contains("ExchgRate")&&!o.e.IsEmpty(n.GridData[e].CurrID)&&parseInt(n.GridData[e].CurrID.toString())==n.CurrencyID&&!o.e.IsEmpty(n.GridData[e].ExchgRate)&&parseFloat(n.GridData[e].ExchgRate.toString())!=n.ExchangeRate?(y+=""!=n.decimalpoints?'AdjAmount="'+(p*parseFloat(n.GridData[e].ExchgRate.toString())).ToString("N"+n.decimalpoints)+'" ':'AdjAmount="'+p*parseFloat(n.GridData[e].ExchgRate.toString())+'" ',y+='AdjExchRT="'+n.GridData[e].ExchgRate.toString()+'" ',i+=p*(parseFloat(n.GridData[e].ExchgRate.toString())-n.ExchangeRate)):(y+=""!=n.decimalpoints?'AdjAmount="'+(p*n.ExchangeRate).ToString("N"+n.decimalpoints)+'" ':'AdjAmount="'+p*n.ExchangeRate+'" ',y+='AdjExchRT="'+n.ExchangeRate.toString()+'" ')),"0"!=n.CurrencyID.toString()?y+='AdjCurrID="'+n.CurrencyID.toString()+'" ':"0"==n.CurrencyID.toString()&&(y+='AdjCurrID="1" '),y+='IsNewReference="0" ',y+='RefDocNo="'+h.d.GetValidXml(o.e.String(n.GridData[e].DocNo))+'" ',y+='RefStatusID="'+o.e.String(n.GridData[e].StatusID)+'" ',y+='RefDocSeqNo="'+o.e.String(n.GridData[e].DocSeqNo)+'" ',o.e.IsEmpty(n.GridData[e].DocDate_Key)||(y+='RefDocDate="'+new Date(n.GridData[e].DocDate_Key.toString()).ToString("dd/MMM/yyyy")+'" '),o.e.IsEmpty(n.GridData[e].DueDate_Key)||(y+='RefDocDueDate="'+new Date(n.GridData[e].DueDate_Key.toString()).ToString("dd/MMM/yyyy")+'" '),y+='Narration="'+o.e.String(n.GridData[e].Remarks)+'" ',5==n.Parent.DocumentType&&(y+='InvDocDetID="'+m+'" '),!o.e.IsEmpty(n.GridData[e].DiscAmount)&&parseFloat(n.GridData[e].DiscAmount.toString())>0){if(0==n.AdvanceRowsCNT&&null!=n.DiscCol){if(3==n.DiscCol.PostingType||4==n.DiscCol.PostingType)return{v:{v:(t.Message=n.DisplayMessage="Define Posting Type None for Billwise Discount",n.MessageVisibility=!0,"")}};if(n.IsCredit&&0==n.DiscCol.DebitAccount)return{v:{v:(t.Message=n.DisplayMessage="Define Debit account for Billwise Discount",n.MessageVisibility=!0,"")}};if(!n.IsCredit&&0==n.DiscCol.CreditAcount)return{v:{v:(t.Message=n.DisplayMessage="Define Credit account for Billwise Discount",n.MessageVisibility=!0,"")}};if(!(n.Parent.ScreenObject.Preferences.ContainsKey("DiscDoc")&&!o.e.IsEmpty(n.Parent.ScreenObject.Preferences.DiscDoc)&&parseInt(n.Parent.ScreenObject.Preferences.DiscDoc)>4e4))return{v:{v:(t.Message=n.DisplayMessage="Define Discount Doc to use Billwise Discount",n.MessageVisibility=!0,"")}}}n.GetDiscXML(parseFloat(o.e.String(n.GridData[e].DiscAmount)),e),r+=parseFloat(o.e.String(n.GridData[e].DiscAmount)),n.GridDataColumns.Contains("CurrID")&&n.GridDataColumns.Contains("ExchgRate")&&!o.e.IsEmpty(n.GridData[e].CurrID)&&!o.e.IsEmpty(n.GridData[e].ExchgRate)?y+='DiscCurrID="'+o.e.String(n.GridData[e].CurrID)+'" DiscExchRT="'+o.e.String(n.GridData[e].ExchgRate)+'" ':y+='DiscCurrID="1" DiscExchRT="1" ',y+='DiscAmount="'+parseFloat(o.e.String(n.GridData[e].DiscAmount))+'" ',y+=n.IsCredit?'DiscAccountID="'+n.DiscCol.DebitAccount+'" ':'DiscAccountID="'+n.DiscCol.CreditAcount+'" '}else y+='DiscAmount="0" ';if(!o.e.IsEmpty(n.GridData[e].VatAdvance)&&parseFloat(o.e.String(n.GridData[e].VatAdvance))>0&&!o.e.IsEmpty(n.GridData[e].Amount)&&parseFloat(o.e.String(n.GridData[e].Amount))>0){if(n.Parent.BillWisedtColumns.Contains("DocSeqNo"))return{v:{v:(n.DisplayMessage="Vat Advance can not be used in line wise.",n.MessageVisibility=!0,t.Message=n.DisplayMessage,"")}};if("1"!=o.e.String(n.GridData[e].IsIncl)&&parseFloat(o.e.String(n.GridData[e].AmountPaid))*n.ExchangeRate>n.TotTaxableAmt)return{v:{v:(n.DisplayMessage="Can not adjust more than:"+n.TotTaxableAmt.ToString("N"+n.decimalpoints)+" from "+o.e.String(n.GridData[e].DocNo),n.MessageVisibility=!0,t.Message=n.DisplayMessage,"")}};var T=0;if((T=o.e.Double(n.GridData[e].Amount)==o.e.Double(n.GridData[e].AmountPaidLC)?parseFloat(o.e.String(n.GridData[e].VatAdvance)):parseFloat((parseFloat(o.e.String(n.GridData[e].AmountPaid))*n.ExchangeRate*(parseFloat(o.e.String(n.GridData[e].VatAdvance))/parseFloat(o.e.String(n.GridData[e].Amount)))).ToString("N"+n.decimalpoints)))>0){if(!(n.Parent.ScreenObject.Preferences.ContainsKey("VatAdvanceDoc")&&""!=n.Parent.ScreenObject.Preferences.VatAdvanceDoc&&parseInt(n.Parent.ScreenObject.Preferences.VatAdvanceDoc)>4e4))return{v:{v:(n.DisplayMessage="Define Vat Advance Doc.",n.MessageVisibility=!0,t.Message=n.DisplayMessage,"")}};if(!n.GetVatAdvanceXML(o.e.String(n.GridData[e].CostCenterID),T))return{v:{v:(t.Message=n.DisplayMessage,"")}};n.IsCredit&&(T*=-1),y+='VatAdvance="'+T+'" '}}y+='IsDocPDC="0" >',y+=" </Row>",null!=l&&(y+=" </BillWise>",l.IsDistributed=1,l.ExtraXML=y.toString(),y="",y+="<BillWise> ",n.Parent.CalculateTotals(l,!1),null!=n.dtccData&&n.dtccData.length>1)&&function(){var t=n.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&99==e.LocalReference})),a=n.dtccData.filter((function(t){return t.docno="'"+n.GridData[e].DocNo.toString()+"'"||!1}));a.length>0&&t.forEach((function(e){if(!o.e.IsEmpty(e.ColumnCostCenterID)&&parseInt(e.ColumnCostCenterID.toString())>5e4&&!o.e.IsEmpty(e.SysColumnName)){var t=parseInt(e.ColumnCostCenterID.toString());t-=5e4,null!=n.dtccData["dcccnid"+t]&&n.Parent.ScreenObject.GridDataColumns.Contains(e.SysColumnName.toString()+"_Key")&&(l[e.SysColumnName.toString()+"_Key"]=a[0]["dcccnid"+t].toString(),l[e.SysColumnName.toString()]=a[0]["dcccnid"+t+"Name"].toString())}}))}()}}},d=0;d<n.GridData.length;d++){var D=u(d);if("continue"!==D&&"object"==typeof D)return D.v}if(o.e.IsEmpty(a)||(n.Parent.ScreenObject.UpdateSequence(),n.Parent.RefreshGrid=!0),n.IsInventory){if(0!=i){var S=o.e.Int(s.a.SessionManager.Preferences["Exchange Gain/Loss Account"]);if(!s.a.SessionManager.Preferences.ContainsKey("Exchange Gain/Loss Account")||0==S)return{v:(n.DisplayMessage=s.a.GetResource("ExchangeGainLossCannotAdjust"),t.Message=n.DisplayMessage,"")};var b=1;!o.e.IsEmpty(s.a.SessionManager.Preferences.DimensionwiseCurrency)&&parseInt(s.a.SessionManager.Preferences.DimensionwiseCurrency)>5e4&&(w=n.Parent.ScreenObject._CCFields.find((function(e){return e instanceof C.b&&e.CCID==parseInt(s.a.SessionManager.Preferences.DimensionwiseCurrency)})))&&w instanceof C.b&&w.SelectedValue>0&&(b=n.Parent.ScreenObject.GetCurrency(w.SelectedValue,w.CCID)),y+="<AccountsRow ",y+=i>0&&!n.IsCredit||n.IsCredit&&i<0?'DebitAccount="'+n.AccountID+'" CreditAccount="'+S+'" Amount="':'DebitAccount="'+S+'" CreditAccount="'+n.AccountID+'" Amount="',y+=Math.abs(i)+'" AmtFc="'+Math.abs(i)+'" CurrencyID="'+b+'" ExchangeRate="1" ></AccountsRow>'}}else{var p=n.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&50403==e.LinkData}));p.length>0&&n.Parent.ScreenObject.GridDataColumns.Contains(p[0].SysColumnName.toString())?(n.Parent.SelectedRow[p[0].SysColumnName.toString()]=i,p[0].SysColumnName.toString().toLowerCase().Contains("dcnum")&&(n.Parent.SelectedRow["dcCalc"+p[0].SysColumnName.toString()]=i)):0!=i&&(n.Parent.DisplayMessage="Define Exchange gain or loss field",n.Parent.MessageVisibility=!0),r>0&&null!=n.DiscCol?(n.Parent.SelectedRow[n.DiscCol.DisplayMember]=r,n.DiscCol.DisplayMember.toLowerCase().Contains("dcnum")&&(n.Parent.SelectedRow["dcCalc"+n.DiscCol.DisplayMember]=r)):null==n.DiscCol||o.e.IsEmpty(n.Parent.SelectedRow[n.DiscCol.DisplayMember])||"0"==n.Parent.SelectedRow[n.DiscCol.DisplayMember].toString()||(n.Parent.SelectedRow[n.DiscCol.DisplayMember]=r,n.DiscCol.DisplayMember.toLowerCase().Contains("dcnum")&&(n.Parent.SelectedRow["dcCalc"+n.DiscCol.DisplayMember]=r))}if(n.GridDataColumns.Contains("NonAc"))for(var g=0;g<n.GridData.length;g++)"0"!=n.GridData[g].NonAc.toString()&&!o.e.IsEmpty(n.GridData[g].AmountPaid)&&parseFloat(n.GridData[g].AmountPaid)>0&&(y+='<NonAccRows RefDocNo="'+n.GridData[g].DocNo.toString()+'" Amount="'+n.GridData[g].AmountPaid.toString()+'" Narration="'+o.e.StringValue(n.GridData[g].Remarks)+'" ></NonAccRows>');if(n.Parent.ScreenObject.Preferences.ContainsKey("UseAsDownPmt")&&"True"==n.Parent.ScreenObject.Preferences.UseAsDownPmt&&(y+='<NonAccRows RefDocNo="" AccountID="'+n.AccountID+'" Amount="'+n.AmtToAdjust.Text+'" ></NonAccRows>'),e&&(y+=" </BillWise>"),o.e.IsEmpty(a))if(null!=n.dtccData&&n.dtccData.length>1&&0==G){var O=o.e.Double(n.NewReference.Text);O+=c,n.Parent.ScreenObject.GridDataColumns.Contains("Amount")?n.Parent.SelectedRow.Amount=O:n.IsCredit&&n.Parent.ScreenObject.GridDataColumns.Contains("CreditAmount")?n.Parent.SelectedRow.CreditAmount=O:!n.IsCredit&&n.Parent.ScreenObject.GridDataColumns.Contains("DebitAmount")&&(n.Parent.SelectedRow.DebitAmount=O),N=y.toString(),y=""}else if(null!=n.dtccData&&n.dtccData.length>1&&G>0){for(var I=n.Parent.ScreenObject.GridDataObj.NewRow(),T=0;T<n.Parent.ScreenObject.GridDataColumns.length;T++)"DocDetailsID"!=n.Parent.ScreenObject.GridDataColumns[T]&&(I[n.Parent.ScreenObject.GridDataColumns[T]]=n.Parent.SelectedRow[n.Parent.ScreenObject.GridDataColumns[T]]);n.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&99==e.LocalReference})).forEach((function(e){if(!o.e.IsEmpty(e.ColumnCostCenterID)&&parseInt(e.ColumnCostCenterID)>5e4&&!o.e.IsEmpty(e.SysColumnName)){var t=parseInt(e.ColumnCostCenterID);t-=5e4,!Object(j.isUndefined)(n.dtccData[G]["dcCCNID"+t])&&n.Parent.ScreenObject.GridDataColumns.Contains(e.SysColumnName.toString()+"_Key")&&(I[e.SysColumnName.toString()+"_Key"]=n.dtccData[G]["dcCCNID"+t].toString(),I[e.SysColumnName.toString()]=n.dtccData[G]["dcCCNID"+t+"Name"].toString())}})),y="<BillWise> "+y,n.Parent.ScreenObject.GridDataColumns.Contains("Amount")?I.Amount=c:n.IsCredit&&n.Parent.ScreenObject.GridDataColumns.Contains("CreditAmount")?I.CreditAmount=c:!n.IsCredit&&n.Parent.ScreenObject.GridDataColumns.Contains("DebitAmount")&&(I.DebitAmount=c),I.ExtraXML=y.toString(),n.Parent.ScreenObject.GridDataObj.insertRowAt(I,n.Parent.ScreenObject.GridData.indexOf(n.Parent.SelectedRow)+1),n.Parent.CalculateTotals(I,!1),y=""}G++};do{var w,F=E();if("object"==typeof F)return F.v}while(null!=this.dtccData&&G<this.dtccData.length&&o.e.IsEmpty(a));return this.NewReference.Enable&&null!=this.dtccData&&this.dtccData.length>1?(this.Parent.ScreenObject.UpdateSequence(),N):y.toString()}},{key:"GetVatAdvanceXML",value:function(e,t){var n=this.Parent.ScreenObject.GetVatAdvanceAccounts(e);if(!(null!=n&&n.Tables.length>0&&n.Tables[0].length>0&&n.Columns[0].Contains("DebitAccount")&&!o.e.IsEmpty(n.Tables[0][0].CreditAccount)&&parseInt(n.Tables[0][0].CreditAccount)>0&&!o.e.IsEmpty(n.Tables[0][0].DebitAccount)&&parseInt(n.Tables[0][0].DebitAccount)>0))return this.DisplayMessage="Debit or credit account not defined.",!1;this.AdvanceRowsCNT++,this.VatAdvanceXML+="<Row><Transactions  ",this.VatAdvanceXML+=' DocDetailsID="0"  DocSeqNo="'+this.AdvanceRowsCNT+'" Amount="'+t+'" ',this.VatAdvanceXML+=' AmtFc="'+t+'" ',this.VatAdvanceXML+=' CurrencyID="1"  ExchangeRate="1" ',this.VatAdvanceXML+='CreditAccount="'+n.Tables[0][0].DebitAccount.toString()+'" ',this.VatAdvanceXML+='DebitAccount="'+n.Tables[0][0].CreditAccount.toString()+'" ',this.VatAdvanceXML+="></Transactions> ";var a=this.Parent.ScreenObject.GenerateQueryfromList(this.Parent.ScreenObject._CCFields,!0,{message:""},!1,!1);return this.VatAdvanceXML+=' <Numeric /> <Alpha /> <CostCenters  Query="'+a+'"  /> ',this.VatAdvanceXML+="<EXTRAXML> </EXTRAXML>  </Row>",!0}},{key:"GetDiscXML",value:function(e,t){this.AdvanceRowsCNT++;var n=1,a=e;this.GridDataColumns.Contains("CurrID")&&this.GridDataColumns.Contains("ExchgRate")&&!o.e.IsEmpty(this.GridData[t].CurrID)&&!o.e.IsEmpty(this.GridData[t].ExchgRate)&&o.e.Double(this.GridData[t].ExchgRate)>0?(n=o.e.Double(this.GridData[t].ExchgRate),a=parseFloat((e*n).ToString("N"+this.decimalpoints))):n=1,this.VatAdvanceXML+="<Row><Transactions  ",this.VatAdvanceXML+=' DocDetailsID="0"  DocSeqNo="'+this.AdvanceRowsCNT+'" Amount="'+a+'" ',this.VatAdvanceXML+=' AmtFc="'+e+'" ',this.VatAdvanceXML+=' CurrencyID="1" ExchangeRate="'+n+'" ',this.VatAdvanceXML+=this.IsCredit?'CreditAccount="'+this.AccountID+'" DebitAccount="'+this.DiscCol.DebitAccount+'" ':'CreditAccount="'+this.DiscCol.CreditAcount+'" DebitAccount="'+this.AccountID+'" ',this.VatAdvanceXML+="></Transactions> ";var i={message:""},r=this.Parent.ScreenObject.GenerateQueryfromList(this.Parent.ScreenObject._CCFields,!0,i,!1,!1);this.VatAdvanceXML+=' <Numeric /> <Alpha /> <CostCenters  Query="'+r+'"  /> ',this.VatAdvanceXML+='<EXTRAXML><BillWise><Row DocSeqNo="'+this.AdvanceRowsCNT+'" ',this.VatAdvanceXML+='AccountID="'+this.AccountID.toString()+'" ',this.IsCredit?(this.VatAdvanceXML+='AmountFC="-'+e+'" ',this.VatAdvanceXML+='AdjAmount="-'+(e*n).ToString("N"+this.decimalpoints)+'" '):(this.VatAdvanceXML+='AmountFC="'+e+'" ',this.VatAdvanceXML+='AdjAmount="'+(e*n).ToString("N"+this.decimalpoints)+'" '),this.VatAdvanceXML+='AdjExchRT="'+n+'" ',this.VatAdvanceXML+='AdjCurrID="1" ',this.VatAdvanceXML+='IsNewReference="0" ',this.VatAdvanceXML+='RefDocNo="'+h.d.GetValidXml(o.e.String(this.GridData[t].DocNo))+'" ',this.VatAdvanceXML+='RefStatusID="'+o.e.String(this.GridData[t].StatusID)+'" ',this.VatAdvanceXML+='RefDocSeqNo="'+o.e.String(this.GridData[t].DocSeqNo)+'" ',o.e.IsEmpty(this.GridData[t].DocDate_Key)||(this.VatAdvanceXML+='RefDocDate="'+new Date(this.GridData[t].DocDate_Key.toString()).ToString("dd/MMM/yyyy")+'" '),o.e.IsEmpty(this.GridData[t].DueDate_Key)||(this.VatAdvanceXML+='RefDocDueDate="'+new Date(this.GridData[t].DueDate_Key.toString()).ToString("dd/MMM/yyyy")+'" '),this.VatAdvanceXML+=' IsDocPDC="0" Narration="" ></Row></BillWise></EXTRAXML></Row>'}},{key:"FillPickFromNonAcc",value:function(e){var t=this;if(this.Parent.ScreenObject.Data.Tables.length>0&&null!=this.Parent.SelectedRow&&this.Parent.SelectedRow&&!this.Parent.IsInventoryVoucher){var n=this.Parent.ScreenObject.Data.Tables[0];if((n=n.filter((function(e){return null!=e.LocalReference&&99==e.LocalReference}))).length>0){var a=this.Parent.ScreenObject.GetBillwiseNonAccDetails(e,this.Parent.ScreenObject.CostCenterID);null!=a&&a.Tables.length>0&&!a.Columns[0].Contains("ErrorMessage")&&a.Tables[0].length>0&&n.forEach((function(e){if(""!=e.ColumnCostCenterID.toString()&&parseInt(e.ColumnCostCenterID.toString())>5e4&&""!=e.SysColumnName.toString()){var n=parseInt(e.ColumnCostCenterID.toString());if(n-=5e4,a.Columns[0].Contains("dcccnid"+n)&&t.Parent.ScreenObject.GridData.Columns.Contains(e.SysColumnName.toString()+"_Key"))t.Parent.SelectedRow[e.SysColumnName.toString()+"_Key"]=a.Tables[0][0]["dcccnid"+n].toString(),t.Parent.SelectedRow[e.SysColumnName.toString()]=a.Tables[0][0]["dcccnid"+n+"Name"].toString();else{var i=t.Parent.ScreenObject._CCFields.find((function(t){return t.DBColumnID==parseInt(e.CostCenterColID)}));null!=i&&i instanceof C.b&&a.Columns[0].Contains("dcccnid"+n)&&""!=a.Tables[0][0]["dcccnid"+n].toString()&&(i.SelectedValue=parseInt(a.Tables[0][0]["dcccnid"+n].toString()),i.IsAutoLoad&&(i.SelectedValueText=a.Tables[0][0]["dcccnid"+n+"Name"].toString()))}}}))}}}},{key:"FillPickFrom",value:function(e,t,n){var a=this;if(this.Parent.ScreenObject.Data.Tables.length>0&&null!=this.Parent.SelectedRow&&!this.Parent.IsInventoryVoucher){var i=this.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&99==e.LocalReference}));if(i.length>0){if(this.NewReference.Enable||!o.e.IsEmpty(n)){t="";for(var r=0;r<this.GridData.length;r++)this.GridDataColumns.Contains("NonAc")&&"1"==this.GridData[r].NonAc.toString()||!o.e.IsEmpty(this.GridData[r].AmountPaid)&&parseFloat(this.GridData[r].AmountPaid)>0&&(o.e.IsEmpty(t)||(t+="','"),t+=this.GridData[r].DocNo.toString())}var s=this.Parent.ScreenObject.GetBillwiseCCDetails(e,t,this.Parent.ScreenObject.CostCenterID);null!=s&&s.Tables.length>0&&!s.Columns[0].Contains("ErrorMessage")&&s.Tables[0].length>0&&(i.forEach((function(e){if(!o.e.IsEmpty(e.ColumnCostCenterID)&&parseInt(e.ColumnCostCenterID)>5e4&&!o.e.IsEmpty(e.SysColumnName)){var t=parseInt(e.ColumnCostCenterID);if(t-=5e4,s.Columns[0].Contains("dcccnid"+t)&&a.Parent.ScreenObject.GridDataColumns.Contains(e.SysColumnName.toString()+"_Key"))a.Parent.SelectedRow[e.SysColumnName.toString()+"_Key"]=s.Tables[0][0]["dcccnid"+t].toString(),a.Parent.SelectedRow[e.SysColumnName.toString()]=s.Tables[0][0]["dcccnid"+t+"name"].toString();else{var n=a.Parent.ScreenObject._CCFields.find((function(t){return t.DBColumnID==parseInt(e.CostCenterColID)}));n&&n instanceof C.b&&s.Columns[0].Contains("dcccnid"+t)&&!o.e.IsEmpty(s.Tables[0][0]["dcccnid"+t])&&(n.SelectedValue=parseInt(s.Tables[0][0]["dcccnid"+t]),n.IsAutoLoad&&(n.SelectedValueText=s.Tables[0][0]["dcccnid"+t+"name"].toString()))}}})),(this.NewReference.Enable&&s.Tables[0].length>1&&t.Contains("','")||!o.e.IsEmpty(n))&&(this.dtccData=s.Tables[0]))}}}},{key:"FifoEnabled",get:function(){return this._FifoEnabled}},{key:"Fifo",get:function(){return this._Fifo},set:function(e){e!=this._Fifo&&(this._Fifo=e,this.AdjustBills())}},{key:"SeletedNewRef",get:function(){return this.NewReferenceDetailsObj.SelectedItem}},{key:"UpdateFooter",get:function(){return this._UpdateFooter},set:function(e){this._UpdateFooter=!this._UpdateFooter}},{key:"SelectedRow",get:function(){return this.GridDataObj.SelectedItem}}]),a}(u.b),x=n("MCKn"),k=n("Z9XZ"),_=n("HNy5"),K=n("unLB"),Q=n("/Ge1"),H=n("WJZp"),W=n("gqOg"),U=n("zTKc"),X=n("q0aW"),q=n("JJ8n"),Y=n("Tvp0"),z=n("ouML"),J=n("vgHJ"),Z=n("Xpi9"),$=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,a,i,r,s,c,l,u,d){var D;_classCallCheck(this,n),(D=t.call(this))._Fifo=!1,D.GridDataObj=new V.a,D.Width=0,D.CurrencyID=1,D.ExchangeRate=1,D.AccountID=0,D.IsCredit=!1,D.TotalAmount=0,D.decimalpoints="",D.Title="Return Cheques",D.GridDataObj.Table=[],D.GridDataObj.TableColumns=[],D.GridDataObj.SearchVisible=!0,D.TotalAmount=r,D.Parent=e,D.ParentRow=a,D.VoucherNo=i,D.SetScreenObjectData(),D.GridDataObj.TableColumns.push("SNO"),D.GridDataObj.TableColumns.push("DocNo"),D.GridDataObj.TableColumns.push("DocSeqNo"),D.GridDataObj.TableColumns.push("DocDate"),D.GridDataObj.TableColumns.push("DocDate_Key"),D.GridDataObj.TableColumns.push("DueDate"),D.GridDataObj.TableColumns.push("DueDate_Key"),D.GridDataObj.TableColumns.push("CurrID"),D.GridDataObj.TableColumns.push("CurrName"),D.GridDataObj.TableColumns.push("ExchgRate"),D.GridDataObj.TableColumns.push("Amount"),D.GridDataObj.TableColumns.push("Due"),D.GridDataObj.TableColumns.push("Paid"),D.GridDataObj.TableColumns.push("Total"),D.GridDataObj.TableColumns.push("Remarks"),D.GridDataObj.TableColumns.push("BILLNO");for(var h=0;h<D.ScreenObjectData.Tables[4].length;h++)D.GridDataObj.TableColumns.Contains(D.ScreenObjectData.Tables[4][h].Name.toString())||D.GridDataObj.TableColumns.push(D.ScreenObjectData.Tables[4][h].Name.toString());D.LoadColumns(),D.AccountID=s,D.IsCredit=c,D.CurrencyID=l,D.ExchangeRate=u;var S=new o.f;return D.Parent.IsInventoryVoucher&&""!=D.Parent.ChkRtnXml&&S.ReadXml(D.Parent.ChkRtnXml),D.Parent.IsInventoryVoucher||null==a||o.e.IsEmpty(a.ReturnXML)||S.ReadXml(a.ReturnXML),D.GetChequeReturn(S,d),D.SetBalValue(),D.GridDataObj.CellEditEnding.Subscribe(_assertThisInitialized(D),"OnCellEditEnding"),D.GridDataObj.BeginEdit.Subscribe(_assertThisInitialized(D),"OnBeginEdit"),D}return _createClass(n,[{key:"OnBeginEdit",value:function(e){var t=e.args,n=t.item;if("Amount"==t.column.field){var a=o.e.Double(n.Amount);if(""==o.e.String(n.Amount)||0==a){var i=0,r=this.GridData.Compute("sum","Amount");null!=r&&(i=o.e.Double(r)),(i=this.TotalAmount-i)>0&&(n.Amount=i>parseFloat(n.Due)?n.Due:i)}}}},{key:"GetChequeReturn",value:function(e,t){var n=this;if(this.GridData.Clear(),null==this.ParentRow||o.e.IsEmpty(this.ParentRow.DocSeqNo)||parseInt(this.ParentRow.DocSeqNo),null!=t&&t.Tables.length>0&&!t.Columns[0].Contains("ErrorMessage"))for(var a=function(a){var i=n.GridDataObj.NewRow();i.SNO=n.GridData.length+1,i.DocNo=t.Tables[0][a].DocNo.toString(),i.DocSeqNo=t.Tables[0][a].DocSeqNo.toString(),t.Columns[0].Contains("BILLNO")&&(i.BILLNO=o.e.String(t.Tables[0][a].BILLNO));var r=0;o.e.IsEmpty(t.Tables[0][a].Amount)||(r=parseFloat(t.Tables[0][a].Amount)),o.e.IsEmpty(t.Tables[0][a].Paid)||(r-=parseFloat(t.Tables[0][a].Paid));var c="";if(null!=n.ScreenObjectData.Tables[4]&&n.ScreenObjectData.Tables[4].length>0)for(var l=0;l<n.ScreenObjectData.Tables[4].length;l++)c="",""!=(c=!o.e.IsEmpty(n.ScreenObjectData.Tables[4][l].CostcenterID)&&null!=n.ScreenObjectData.Tables[4][l].CostcenterID&&parseInt(n.ScreenObjectData.Tables[4][l].CostcenterID)>5e4?"A"+n.ScreenObjectData.Tables[4][l].CostcenterID.toString():o.e.String(n.ScreenObjectData.Tables[4][l].Name))&&t.Columns[0].Contains(c)&&"ChequeDate"==c?o.e.IsEmpty(t.Tables[0][a].ChequeDate)||(i[n.ScreenObjectData.Tables[4][l].Name.toString()]=new Date(t.Tables[0][a].ChequeDate).ToString(s.a.SessionManager.Preferences["Date Format"])):""!=c&&t.Columns[0].Contains(c)&&"DocDate"!=c&&"DocDueDate"!=c&&(i[n.ScreenObjectData.Tables[4][l].Name.toString()]=o.e.String(t.Tables[0][a][c]));if(i.CurrID=o.e.String(t.Tables[0][a].AdjCurrID),i.ExchgRate=o.e.String(t.Tables[0][a].AdjExchRT),i.CurrName=o.e.String(t.Tables[0][a].Name),o.e.IsEmpty(t.Tables[0][a].DocDate)||(i.DocDate=new Date(t.Tables[0][a].DocDate).ToString(s.a.SessionManager.Preferences["Date Format"]),i.DocDate_Key=new Date(t.Tables[0][a].DocDate)),o.e.IsEmpty(t.Tables[0][a].DocDueDate)||(i.DueDate=new Date(t.Tables[0][a].DocDueDate).ToString(s.a.SessionManager.Preferences["Date Format"]),i.DueDate_Key=new Date(t.Tables[0][a].DocDueDate)),""!=n.decimalpoints?(o.e.IsEmpty(t.Tables[0][a].Amount)||(i.Total=parseFloat(t.Tables[0][a].Amount).ToString("N"+n.decimalpoints)),i.Due=r.ToString("N"+n.decimalpoints),o.e.IsEmpty(t.Tables[0][a].Paid)||(i.Paid=parseFloat(t.Tables[0][a].Paid).ToString("N"+n.decimalpoints))):(i.Due=r,i.Total=o.e.String(t.Tables[0][a].Amount),i.Paid=o.e.String(t.Tables[0][a].Paid)),e.Tables.length>0&&e.Columns[0].Contains("RefDocNo")){var u=e.Tables[0].filter((function(e){return e.RefDocNo==o.e.String(t.Tables[0][a].DocNo).replace("'","''")&&e.RefDocSeqNo==t.Tables[0][a].DocSeqNo&&0==e.IsNewReference}));u.length>0?(i.Amount=""!=n.decimalpoints?parseFloat(u[0].AdjAmount.toString().replace("-","")).ToString("N"+n.decimalpoints):u[0].AdjAmount.toString().replace("-",""),n.GridDataObj.TableColumns.Contains("Remarks")&&(i.Remarks=u[0].Narration)):i.Amount=(0).ToString("N"+n.decimalpoints)}else i.Amount=(0).ToString("N"+n.decimalpoints);n.GridDataObj.addRow(i)},i=0;i<t.Tables[0].length;i++)a(i)}},{key:"LoadColumns",value:function(){var e=[];s.a.SessionManager.Preferences.ContainsKey("DecimalsinAmount")&&""!=this.decimalpoints&&(this.decimalpoints=s.a.SessionManager.Preferences.DecimalsinAmount);var t=new f.a;t.Header="#",t.DisplayMember="SNO",t.DataType="TextBlock",t.Width=24,t.ReadOnly=!0,e.push(t);for(var n=0;n<this.ScreenObjectData.Tables[4].length;n++)(t=new f.a).Header=this.ScreenObjectData.Tables[4][n].UserColumnName.toString(),t.DisplayMember=this.ScreenObjectData.Tables[4][n].Name.toString(),"DocDueDate"==t.DisplayMember&&(t.DisplayMember="DueDate"),t.ReadOnly=!Object(l.j)(this.ScreenObjectData.Tables[4][n].IsEditable),"DocNo"==t.DisplayMember?(t.DataType="LINK",t.ReadOnly=!1,t.Click.Subscribe(this,"OnserieslinkClick")):t.DataType=this.ScreenObjectData.Tables[4][n].UserColumnType.toString(),"FLOAT"==t.DataType&&""!=this.decimalpoints&&(t.DecimalPoints=this.decimalpoints),o.e.IsEmpty(this.ScreenObjectData.Tables[4][n].ColumnWidth)||(t.Width=parseInt(this.ScreenObjectData.Tables[4][n].ColumnWidth)),e.push(t);this.GridDataObj.Columns=e}},{key:"OnserieslinkClick",value:function(){null!=this.SelectedRow&&(Object(j.isUndefined)(this.SelectedRow.CostCenterID)||(L.RibbonExtViewModel.LoadDocument(this.SelectedRow),s.a.page.HideDialog()))}},{key:"OnCellEditEnding",value:function(e){var t=e.item;if("Amount"==e.column.field&&!o.e.IsEmpty(t.Amount)){var n=this.TotalAmount,a=this.GridData.filter((function(e){return e.SNO!=t.SNO})).Compute("sum","Amount");null!=a&&(n-=parseFloat(a)),n<parseFloat(t.Amount)&&(this.MessageVisibility=!0,this.DisplayMessage="Entered amount exceeds the amount entered in voucher",t.Amount=""!=this.decimalpoints?n.ToString("N"+this.decimalpoints):n,this.GridDataObj.updateRow(t));parseFloat(t.Amount)>parseFloat(t.Due)&&(this.MessageVisibility=!0,this.DisplayMessage="Entered amount is more than due",t.Amount=parseFloat(t.Due),this.GridDataObj.updateRow(t))}}},{key:"OnSave",value:function(e){"Save"==e.toString()?(this.Parent.IsInventoryVoucher&&(this.Parent.ChkRtnXml=this.GetXml()),this.Parent.IsInventoryVoucher||null==this.ParentRow||(this.ParentRow.ReturnXML=this.GetXml()),this.Parent.DialogResult=!0,s.a.page.HideDialog(),this.Parent.IsInventoryVoucher&&this.Parent.SaveDocument()):"Cancel"==e.toString()&&(this.Parent.DialogResult=!1,s.a.page.HideDialog())}},{key:"AdjustBills",value:function(){if(this.Fifo)for(var e=this.TotalAmount,t=0;t<this.GridData.length;t++){var n=parseFloat(this.GridData[t].Due);e>=n?(this.GridData[t].Amount=""!=this.decimalpoints?n.ToString("N"+this.decimalpoints):n,e-=n):(this.GridData[t].Amount=""!=this.decimalpoints?e.ToString("N"+this.decimalpoints):e,e=0),this.GridDataObj.updateRow(this.GridData[t])}else for(var a=0;a<this.GridData.length;a++)this.GridData[a].Amount=0,this.GridDataObj.updateRow(this.GridData[a])}},{key:"GetXml",value:function(){0==this.CurrencyID&&(this.CurrencyID=1),0==this.ExchangeRate&&(this.ExchangeRate=1);for(var e="",t=0,n="",a=0,i=0,r=0;r<this.GridData.length;r++)this.GridDataObj.TableColumns.Contains("ExchgRate")&&!o.e.IsEmpty(this.GridData[r].ExchgRate)&&"0"==this.GridData[r].ExchgRate.toString()&&(this.GridData[r].ExchgRate="1"),!o.e.IsEmpty(this.GridData[r].Amount)&&parseFloat(this.GridData[r].Amount)>0&&(""==e.toString()&&(e+=this.Parent.IsInventoryVoucher?"<ChkRtnXML> ":"<XML> "),a+=parseFloat(this.GridData[r].Amount),this.Parent.IsInventoryVoucher||0!=t||this.FillPickFrom(this.AccountID,this.GridData[r].DocNo.toString()),t++,e+="<Row ",e+=null!=this.ParentRow?'DocSeqNo="'+this.ParentRow.DocSeqNo.toString()+'" ':'DocSeqNo="1" ',e+='AccountID="'+this.AccountID.toString()+'" ',this.IsCredit?(e+='AmountFC="'+this.GridData[r].Amount.toString()+'" ',e+='AdjAmount="-'+parseFloat(this.GridData[r].Amount)*this.ExchangeRate+'" ',e+='AdjExchRT="'+this.ExchangeRate.toString()+'" '):(e+='AmountFC="-'+this.GridData[r].Amount.toString()+'" ',e+='AdjAmount="'+parseFloat(this.GridData[r].Amount)*this.ExchangeRate+'" ',e+='AdjExchRT="'+this.ExchangeRate.toString()+'" '),"0"!=o.e.String(this.CurrencyID)?e+='AdjCurrID="'+this.CurrencyID.toString()+'" ':"0"==o.e.String(this.CurrencyID)&&(e+='AdjCurrID="1" '),e+='IsNewReference="0" ',e+='RefDocNo="'+this.GridData[r].DocNo.toString()+'" ',e+='RefDocSeqNo="'+this.GridData[r].DocSeqNo.toString()+'" ',o.e.IsEmpty(this.GridData[r].DocDate_Key)||(e+='RefDocDate="'+new Date(this.GridData[r].DocDate_Key).ToString("dd/MMM/yyyy")+'" '),o.e.IsEmpty(this.GridData[r].DueDate_Key)||(e+='RefDocDueDate="'+new Date(this.GridData[r].DueDate_Key).ToString("dd/MMM/yyyy")+'" '),e+='Narration="'+o.e.StringValue(this.GridData[r].Remarks)+'" ',e+='IsDocPDC="0" >',e+=" </Row>",++i>1&&(n+=","),n+=this.GridData[r].DocNo.toString());if(""!=e&&(e+=this.Parent.IsInventoryVoucher?" </ChkRtnXML>":" </XML>",this.Parent.ScreenObject.Data.Tables[0].length>0)){var s=this.Parent.ScreenObject.Data.Tables[0].filter((function(e){return 159==e.LocalReference&&27237==e.LinkData}));s.length>0&&this.Parent.ScreenObject.GridDataColumns.Contains(s[0].SysColumnName.toString())&&(this.Parent.SelectedRow[s[0].SysColumnName.toString()]=n),(s=this.Parent.ScreenObject.Data.Tables[0].filter((function(e){return 159==e.LocalReference&&27250==e.LinkData}))).length>0&&this.Parent.ScreenObject.GridDataColumns.Contains(s[0].SysColumnName.toString())&&(this.Parent.SelectedRow[s[0].SysColumnName.toString()]=a)}return e.toString()}},{key:"FillPickFrom",value:function(e,t){var n=this;if(this.Parent.ScreenObject.Data.Tables.length>0&&null!=this.Parent.SelectedRow&&!this.Parent.IsInventoryVoucher){var a=this.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&159==e.LocalReference}));if(a.length>0){var i=this.Parent.ScreenObject.GetChequeReturnCCDetails(e,t,this.Parent.ScreenObject.CostCenterID);null!=i&&i.Tables.length>0&&!i.Columns[0].Contains("ErrorMessage")&&i.Tables[0].length>0&&a.forEach((function(e){if(!o.e.IsEmpty(e.ColumnCostCenterID)&&parseInt(e.ColumnCostCenterID)>5e4&&!o.e.IsEmpty(e.SysColumnName)){var t=parseInt(e.ColumnCostCenterID);if(t-=5e4,i.Columns[0].Contains("dcccnid"+t)&&n.Parent.ScreenObject.GridDataColumns.Contains(e.SysColumnName.toString()+"_Key"))n.Parent.SelectedRow[e.SysColumnName.toString()+"_Key"]=i.Tables[0][0]["dcccnid"+t].toString(),n.Parent.SelectedRow[e.SysColumnName.toString()]=i.Tables[0][0]["dcccnid"+t+"Name"].toString();else{var a=n.Parent.ScreenObject._CCFields.find((function(t){return t.DBColumnID==parseInt(e.CostCenterColID)}));a&&a instanceof C.b&&i.Columns[0].Contains("dcccnid"+t)&&!o.e.IsEmpty(i.Tables[0][0]["dcccnid"+t])&&(a.SelectedValue=parseInt(i.Tables[0][0]["dcccnid"+t]))}}}))}}}},{key:"SetScreenObjectData",value:function(){this.ScreenObjectData=s.a.common.GetScreenInfo(159),this.Width=this.ScreenObjectData.Tables.length>5&&this.ScreenObjectData.Tables[5].length>0&&this.ScreenObjectData.Columns[5].Contains("ColumnWidth")&&!o.e.IsEmpty(this.ScreenObjectData.Tables[5][0].ColumnWidth)?parseFloat(this.ScreenObjectData.Tables[5][0].ColumnWidth):800}},{key:"SetBalValue",value:function(){var e=this,t="";if(this.Parent.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")?t="CreditAccount_Key":this.Parent.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")?t="DebitAccount_Key":this.Parent.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&(t="AccountID_Key"),this.ParentRow&&!o.e.IsEmpty(this.ParentRow[t])){var n=this.Parent.ScreenObject.GridData.filter((function(n){return n[t]==e.ParentRow[t]}));if(n.length>0){var a=[];if(n.forEach((function(t){if(!o.e.IsEmpty(t.ReturnXML)&&e.ParentRow!=t){var n=new o.f;if(n.ReadXml(t.ReturnXML),n.Tables.length>0&&n.Tables[0].length>0&&n.Columns[0].Contains("AdjAmount")&&n.Columns[0].Contains("RefDocSeqNo")&&n.Columns[0].Contains("RefDocNo"))for(var i=0;i<n.Tables[0].length;i++){var r={};r.VoucherNo=n.Tables[0][i].RefDocNo.toString(),r.AdjAmount=n.Tables[0][i].AdjAmount.toString(),r.Seq=n.Tables[0][i].RefDocSeqNo.toString(),a.push(r)}}})),a.length>0)for(var i=function(t){if(!o.e.IsEmpty(e.GridData[t].DocNo)&&(n=a.filter((function(n){return n.VoucherNo==e.GridData[t].DocNo.toString()&&n.Seq==e.GridData[t].DocSeqNo}))).length>0){var i=0,r=0,c=(i=o.e.DoubleTryParse(e.GridData[t].Due)).toString();s.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=s.a.SessionManager.Preferences.DecimalsinQty&&(c=i.ToString("N"+s.a.SessionManager.Preferences.DecimalsinQty)),i=parseFloat(c),n.forEach((function(e){o.e.IsEmpty(e.AdjAmount)||(r+=parseFloat(e.AdjAmount))})),r<0?i+=r:i-=r,e.GridData[t].Due=s.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=s.a.SessionManager.Preferences.DecimalsinQty?i.ToString("N"+s.a.SessionManager.Preferences.DecimalsinQty):i}},r=0;r<this.GridData.length;r++)i(r)}}}},{key:"Fifo",get:function(){return this._Fifo},set:function(e){e!=this._Fifo&&(this._Fifo=e,this.AdjustBills())}},{key:"ColumnSource",get:function(){return this.GridDataObj.Columns}},{key:"GridData",get:function(){return this.GridDataObj.Table}},{key:"SelectedRow",get:function(){return this.GridDataObj.SelectedItem},set:function(e){this.GridDataObj.SelectedItem=e}}]),n}(u.b),ee=n("OljK"),te=n("Q01V"),ne=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,a,i,r){var o;if(_classCallCheck(this,n),(o=t.call(this)).dttemp=[],o.drpDocuments=new m.e(0),o.GridDataObj=new V.a,o.SelectedValueChanged=!1,o.SelectedValue=null,o.SelectedIndex=0,o.DebitAcc=new C.b(0),o.ProductList=new m.b,o.SelectedNode=0,o.ProductID=null,o.dtAbbr=[],o.dsParent={},o.RowPos=0,o.dtTempTable=[],o.SNO=1,o.ProductID=a,o.RowPos=r,o.oparent=e,o.dsParent=i,null!=i&&i.Tables.length>10&&i.Tables[10].length>0&&(o.dtAbbr=i.Tables[10]),o.ProdCols=new m.e(0),o.ProdCols.SelectionChangedCommand.Subscribe(_assertThisInitialized(o),"LinkSelectionChanged"),o.DisplayName=s.a.GetResource("LinkTitle"),o.GenerateColumns(),o.DefaultData(),o.GridDataObj.TableNewRow.Subscribe(_assertThisInitialized(o),"onAddRow"),o.GridDataObj.RowDeleted.Subscribe(_assertThisInitialized(o),"onDeleteRow"),null!=i&&i.Tables.length>0&&i.Tables[0].length>0)for(var c=0;c<i.Tables[0].length;c++){var l=o.GridDataObj.NewRow();l.DocSeqNo=(c+1).toString(),l.Select=!1,l.CostCenterID=i.Tables[0][c].CostCenterID.toString(),l.VoucherNo=i.Tables[0][c].VoucherNO.toString(),l.DocDetailsID=i.Tables[0][c].DocDetailsID.toString(),l.ProductName=i.Tables[0][c].ProductName.toString(),l.ProductCode=i.Tables[0][c].ProductCode.toString(),l.ProductID_Key=i.Tables[0][c].ProductID.toString(),l.Qty=i.Tables[0][c].Quantity.toString(),l.Balance=i.Tables[0][c][0].toString(),l.TobeUsed=i.Tables[0][c][0].toString(),""!=l.Balance.toString()&&""!=l.Qty.toString()&&(l.Executed=parseFloat(l.Qty.toString())-parseFloat(l.Balance.toString()));for(var u=0;u<o.ColumnSource.length;u++)if(4!=o.ColumnSource[u].SectionID&&"LinkedInvDocDetailsID"!=o.ColumnSource[u].DisplayMember&&"RefNo"!=o.ColumnSource[u].DisplayMember&&"LinkedFieldName"!=o.ColumnSource[u].DisplayMember&&!o.ColumnSource[u].DisplayMember.toLowerCase().Contains("dccurrid")&&!o.ColumnSource[u].DisplayMember.toLowerCase().Contains("dcexchrt"))if(o.ColumnSource[u].IsColumnUserDefined)if("SELECTIONBOX"==o.ColumnSource[u].DataType)i.Columns[3].Contains(o.ColumnSource[u].DisplayMember)&&(l[o.ColumnSource[u].DisplayMember]=i.Tables[3][c][o.ColumnSource[u].DisplayMember]);else if(null!=o.ColumnSource[u].CostCenterID&&o.ColumnSource[u].CostCenterID>0)o.ColumnSource[u].DisplayMember.Contains("TO")?i.Columns[1].Contains(o.ColumnSource[u].DisplayMember.Replace("TO",""))&&i.Tables[1].length>c+1&&i.Columns[1].Contains(o.ColumnSource[u].DisplayMember.Replace("TO",""))&&(l[o.ColumnSource[u].DisplayMember+"_Key"]=i.Tables[1][c+1][o.ColumnSource[u].DisplayMember.Replace("TO","")]):i.Columns[1].Contains(o.ColumnSource[u].DisplayMember)&&(l[o.ColumnSource[u].DisplayMember+"_Key"]=i.Tables[1][c][o.ColumnSource[u].DisplayMember]);else if(o.ColumnSource[u].DisplayMember.toLowerCase().Contains("dcnum"))l[o.ColumnSource[u].DisplayMember]=i.Tables[2][c][o.ColumnSource[u].DisplayMember];else if("DATE"==o.ColumnSource[u].DataType){if(i.Columns[3].Contains(o.ColumnSource[u].DisplayMember)&&""!=i.Tables[3][c][o.ColumnSource[u].DisplayMember].toString()){var d="dd/MMM/yyyy";s.a.SessionManager.Preferences.ContainsKey("Date Format")&&""!=s.a.SessionManager.Preferences["Date Format"]&&(d=s.a.SessionManager.Preferences["Date Format"]),l[o.ColumnSource[u].DisplayMember]=new Date(i.Tables[3][c][o.ColumnSource[u].DisplayMember].toString()).ToString(d),l[o.ColumnSource[u].DisplayMember+"_Key"]=new Date(i.Tables[3][c][o.ColumnSource[u].DisplayMember].toString())}}else"ComboBox"==o.ColumnSource[u].DataType?i.Columns[3].Contains(o.ColumnSource[u].ValueBinding)&&(l[o.ColumnSource[u].ValueBinding]=i.Tables[3][c][o.ColumnSource[u].ValueBinding]):i.Columns[3].Contains(o.ColumnSource[u].DisplayMember)&&(l[o.ColumnSource[u].DisplayMember]=i.Tables[3][c][o.ColumnSource[u].DisplayMember]);else if("AccountID_Key"==o.ColumnSource[u].ValueMember||"DebitAmount"==o.ColumnSource[u].DisplayMember||"CreditAmount"==o.ColumnSource[u].DisplayMember){if("AccountID_Key"==o.ColumnSource[u].ValueMember)continue}else if(null==o.ColumnSource[u].ValueMember||!i.Columns[0].Contains(o.ColumnSource[u].ValueMember.Replace("_Key",""))||"DebitAccount_Key"!=o.ColumnSource[u].ValueMember&&"CreditAccount_Key"!=o.ColumnSource[u].ValueMember){if(3==o.ColumnSource[u].CostCenterID&&i.Columns[0].Contains("ProductID"))l[o.ColumnSource[u].ValueMember]=i.Tables[0][c].ProductID;else if("DocSeqNo"!=o.ColumnSource[u].DisplayMember)if("DATE"==o.ColumnSource[u].DataType){if(i.Columns[0].Contains(o.ColumnSource[u].DisplayMember)&&""!=i.Tables[0][c][o.ColumnSource[u].DisplayMember].toString()){var D="dd/MMM/yyyy";s.a.SessionManager.Preferences.ContainsKey("Date Format")&&""!=s.a.SessionManager.Preferences["Date Format"]&&(D=s.a.SessionManager.Preferences["Date Format"]),l[o.ColumnSource[u].DisplayMember]=new Date(i.Tables[0][c][o.ColumnSource[u].DisplayMember]).ToString(D),o.GridDataObj.TableColumns.Contains(o.ColumnSource[u].DisplayMember+"_Key")&&(l[o.ColumnSource[u].DisplayMember+"_Key"]=new Date(i.Tables[0][c][o.ColumnSource[u].DisplayMember].toString()))}}else"gross"==o.ColumnSource[u].DisplayMember.toLowerCase()?i.Columns[0].Contains(o.ColumnSource[u].DisplayMember)&&(l[o.ColumnSource[u].DisplayMember]=i.Tables[0][c][o.ColumnSource[u].DisplayMember]):"Amount"==o.ColumnSource[u].DisplayMember?i.Columns[0].Contains("Amount")&&(l.Amount=i.Tables[0][c].Amount.toString()):"LISTBOX"==o.ColumnSource[u].DataType.toUpperCase()?i.Columns[0].Contains(o.ColumnSource[u].DisplayMember)&&(l[o.ColumnSource[u].ValueMember]=i.Tables[0][c][o.ColumnSource[u].DisplayMember]):i.Columns[0].Contains(o.ColumnSource[u].DisplayMember)&&l.Table.Columns.Contains(o.ColumnSource[u].DisplayMember)&&(l[o.ColumnSource[u].DisplayMember]=i.Tables[0][c][o.ColumnSource[u].DisplayMember])}else null!=o.ColumnSource[u].ValueMember&&"DebitAccount_Key"==o.ColumnSource[u].ValueMember&&(l.DebitAccount_KEY=i.Tables[0][c].DebitAccount),null!=o.ColumnSource[u].ValueMember&&"CreditAccount_Key"==o.ColumnSource[u].ValueMember&&(l.CreditAccount_KEY=i.Tables[0][c].CreditAccount);o.GridData.push(l)}return o.dttemp=o.GridData.Copy(),o.RefreshGrid=!0,Logger.InfoLog("LinkProdWiseViewModel::Exiting LinkProdWiseViewModel"),_possibleConstructorReturn(o)}return _createClass(n,[{key:"OnSelectionChangedCommand",value:function(e){var t=this,n=this.dtAbbr;null!=n&&n.length>0&&""!=this.ProdCols.SelectedItem.Parent?(n=this.dtAbbr.filter((function(e){return e.CostCenterID==t.ProdCols.SelectedItem.Parent}))).length>0||this.GridDataObj.ClearFilters():this.GridDataObj.ClearFilters()}},{key:"OnCmnItem_Click",value:function(e){switch(e){case"DELETE":confirm(s.a.GetResource("DeleteMessage"))&&this.OnDeleteCallBack()}}},{key:"DefaultData",value:function(){}},{key:"onAddRow",value:function(e){this.UpdateSequence(),e.DocSeqNo=this.SNO}},{key:"onDeleteRow",value:function(e){this.UpdateSequence()}},{key:"UpdateSequence",value:function(){var e=this;this.SNO=1,this.GridData.forEach((function(t){t.DocSeqNo=e.SNO++}))}},{key:"GenerateColumns",value:function(){var e=this,t=["ProductCode","ProductName"];this.GridDataObj.TableColumns.push("TobeUsed"),this.GridDataObj.TableColumns.push("DocSeqNo"),this.GridDataObj.TableColumns.push("Select"),this.GridDataObj.TableColumns.push("DocDetailsID"),this.GridDataObj.TableColumns.push("VoucherNo"),this.GridDataObj.TableColumns.push("ProductName"),this.GridDataObj.TableColumns.push("ProductCode"),this.GridDataObj.TableColumns.push("ProductID_Key");var n,a=[],i=[];if("AddEditDocumentViewModel"==this.oparent.ClassName&&null!=this.oparent.ScreenObject&&null!=this.oparent.ScreenObject.Data&&this.oparent.ScreenObject.Data.Tables.length>6&&((n=this.oparent.ScreenObject.Data.Tables[7].AsDataView()).RowFilter=" PrefValueType = 'GroupCheckBox'"),"AddEditDocumentViewModel"==this.oparent.ClassName&&this.oparent.ScreenObject.Preferences.ContainsKey("StaticLinkingColumns")&&""!=this.oparent.ScreenObject.Preferences.StaticLinkingColumns){var r=new o.f;r.LoadXml(this.oparent.ScreenObject.Preferences.StaticLinkingColumns);for(var c=0;c<r.DocumentElement.childNodes.length;c++){var u=r.DocumentElement.children[c],d=new f.a;d.Header=u.attributes.Header.value,d.DisplayMember=u.attributes.Name.value,d.DisplayIndex=parseInt(u.attributes.index.value),d.Width=parseInt(u.attributes.WIDTH.value),a.push(d)}}var D=new f.a;D.Header="#",D.DisplayMember="DocSeqNo",D.DataType="TextBlock",D.ReadOnly=!0,D.Width=25,D.DisableTab=!0,i.push(D),(D=new f.a).Header=s.a.GetResource("Select"),D.DisplayMember="Select",D.DataType="CheckBox",D.Width=50,i.push(D),(D=new f.a).Header="Voucher No",D.DisplayMember="VoucherNo",D.DataType="TextBlock",D.ReadOnly=!0,D.Width=100,D.DisableTab=!0,i.push(D);for(var h=function(r){var s=t[r],o=null;"AddEditDocumentViewModel"==e.oparent.ClassName?o=e.oparent.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember==s})):"DynamicSetViewModel"==e.oparent.ClassName&&(o=e.oparent.ColumnSource.find((function(e){return e.DisplayMember==s}))),null!=o&&((D=new f.a).Header=o.Header,D.DisplayMember=o.DisplayMember,D.DataType=o.DataType,D.Width=100,D.ValueMember=o.ValueMember,D.CostCenterID=o.CostCenterID,D.TypeID=o.TypeID,D.ReadOnly=!0,null!=n&&n.length>0&&"ProductCode"==o.DisplayMember&&(n.RowFilter=" PrefValueType = 'GroupCheckBox' and PrefName = 'ProductCode' ",n.length>0&&(D.IsVisible=Object(l.j)(n[0].PrefValue)),n.RowFilter=" PrefValueType = 'GroupCheckBox'"),null!=n&&n.length>0&&"ProductName"==o.DisplayMember&&(n.RowFilter=" PrefValueType = 'GroupCheckBox' and PrefName = 'ProductName' ",n.length>0&&(D.IsVisible=Object(l.j)(n[0].PrefValue)),n.RowFilter=" PrefValueType = 'GroupCheckBox'"),(b=a.find((function(e){return e.DisplayMember==D.DisplayMember})))&&(D.DisplayIndex=b.DisplayIndex,D.Width=b.Width),i.Contains(D)||i.push(D))},S=0;S<t.length;S++){var b;h(S)}this.GridDataObj.TableColumns.push("Qty"),(D=new f.a).Header="Qty",D.DisplayMember="Qty",D.DataType="TextBlock",D.Width=100,D.ReadOnly=!0,null!=n&&n.length>0&&(n.RowFilter=" PrefValueType = 'GroupCheckBox' and PrefName = 'Qty' ",n.length>0&&(D.IsVisible=Object(l.j)(n[0].PrefValue)),n.RowFilter=" PrefValueType = 'GroupCheckBox'");var C=a.find((function(e){return"Qty"==e.DisplayMember}));C&&(D.DisplayIndex=C.DisplayIndex,D.Width=C.Width),i.Contains(D)||i.push(D),this.GridDataObj.TableColumns.push("Executed"),(D=new f.a).Header=s.a.GetResource("Doc_Executed")+" Qty",D.DisplayMember="Executed",D.DataType="TextBlock",D.Width=100,D.ReadOnly=!0,null!=n&&n.length>0&&(n.RowFilter=" PrefValueType = 'GroupCheckBox' and PrefName = 'ExecutedQty' ",n.length>0&&(D.IsVisible=Object(l.j)(n[0].PrefValue)),n.RowFilter=" PrefValueType = 'GroupCheckBox'"),(C=a.find((function(e){return"ExecutedQty"==e.DisplayMember})))&&(D.DisplayIndex=C.DisplayIndex,D.Width=C.Width),i.Contains(D)||i.push(D),this.GridDataObj.TableColumns.push("Balance"),(D=new f.a).Header=s.a.GetResource("Doc_Balance")+" Qty",D.DisplayMember="Balance",D.DataType="TextBlock",D.Width=100,D.ReadOnly=!0,null!=n&&n.length>0&&(n.RowFilter=" PrefValueType = 'GroupCheckBox' and PrefName = 'BalanceQty' ",n.length>0&&(D.IsVisible=Object(l.j)(n[0].PrefValue)),n.RowFilter=" PrefValueType = 'GroupCheckBox'"),(C=a.find((function(e){return"BalanceQty"==e.DisplayMember})))&&(D.DisplayIndex=C.DisplayIndex,D.Width=C.Width),i.Contains(D)||i.push(D),(D=new f.a).Header=s.a.GetResource("Doc_LinkQty"),D.DisplayMember="TobeUsed",D.DataType="TextBlock",D.Width=100,null!=n&&n.length>0&&(n.RowFilter=" PrefValueType = 'GroupCheckBox' and PrefName = 'LinkValue' ",n.length>0&&(D.IsVisible=Object(l.j)(n[0].PrefValue)),n.RowFilter=" PrefValueType = 'GroupCheckBox'"),(C=a.find((function(e){return"LinkValue"==e.DisplayMember})))&&(D.DisplayIndex=C.DisplayIndex,D.Width=C.Width),i.Contains(D)||i.push(D),this.GridDataObj.TableColumns.push("CostCenterID");var y=this.dsParent.Tables[6];y.sort((function(e,t){return e.SectionID>t.SectionID||e.SectionID==t.SectionID&&e.SectionSeqNumber>t.SectionSeqNumber?1:-1}));for(var p=0;p<y.length;p++)if((D=new f.a).Header=y[p].UserColumnName.toString(),D.DisplayMember=y[p].SysColumnName.toString(),D.DataType=y[p].ColumnDataType.toString(),D.Width=100,D.ValueMember="LISTBOX"==D.DataType?y[p].SysColumnName.toString()+"_Key":y[p].SysColumnName.toString(),""!=y[p].IsColumnUserDefined.toString()&&(D.IsColumnUserDefined=Object(l.j)(y[p].IsColumnUserDefined.toString())),null!=y[p].ColumnCostCenterID&&""!=y[p].ColumnCostCenterID.toString()&&(D.CostCenterID=parseInt(y[p].ColumnCostCenterID)),D.ReadOnly=!0,(C=a.find((function(e){return e.DisplayMember==D.DisplayMember})))?(D.DisplayIndex=C.DisplayIndex,D.Width=C.Width):D.DisplayIndex=100,0==i.filter((function(e){return e.ValueMember==D.ValueMember&&"LISTBOX"==e.DataType||e.DisplayMember==D.DisplayMember&&"LISTBOX"!=e.DataType})).length){var g=y[p];if(!this.GridDataObj.TableColumns.Contains(D.DisplayMember))switch(i.push(D),g.ColumnDataType.toString().toUpperCase()){case"BIGINT":this.GridDataObj.TableColumns.push(g.SysColumnName.toString()),D.ShowTotal=!1;break;case"INT":this.GridDataObj.TableColumns.push(g.SysColumnName.toString()),D.ShowTotal=!0;break;case"FLOAT":this.GridDataObj.TableColumns.push(g.SysColumnName.toString()),g.SysColumnName.toString().toLowerCase().Contains("dcnum")?(D.DefaultValue=g.UserDefaultValue.toString(),this.GridDataObj.TableColumns.push("dcCalc"+g.SysColumnName.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinExtraFields")&&""!=s.a.SessionManager.Preferences.DecimalsinExtraFields&&(D.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinExtraFields)):g.SysColumnName.toString().toLowerCase().Contains("dcexchrt")||("Quantity"==g.SysColumnName.toString()?(this.GridDataObj.TableColumns.push("Linked"+g.SysColumnName.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=s.a.SessionManager.Preferences.DecimalsinQty&&(D.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinQty)):"Gross"==g.SysColumnName.toString()||"Rate"==g.SysColumnName.toString()?("Gross"==g.SysColumnName.toString()&&this.GridDataObj.TableColumns.push("Linked"+g.SysColumnName.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=s.a.SessionManager.Preferences.DecimalsinRate&&(D.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinRate)):"Amount"!=g.SysColumnName.toString()&&"DebitAmount"!=g.SysColumnName.toString()&&"CreditAmount"!=g.SysColumnName.toString()||!s.a.SessionManager.Preferences.ContainsKey("DecimalsinAmount")||""==s.a.SessionManager.Preferences.DecimalsinAmount||(D.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinAmount)),g.SysColumnName.toString().toLowerCase().Contains("dcexchrt")||"exchangerate"==g.SysColumnName.toString().toLowerCase()||(D.ShowTotal=!0);break;case"LISTBOX":D.ValueMember=g.SysColumnName.toString()+"_Key","unit"==g.SysColumnName.toString().toLowerCase()?(this.GridDataObj.TableColumns.push(g.SysColumnName.toString()),this.GridDataObj.TableColumns.push(g.SysColumnName.toString()+"_Key"),this.GridDataObj.TableColumns.push("UOMConversion"),this.GridDataObj.TableColumns.push("UOMConvertedQty")):"productid"==g.SysColumnName.toString().toLowerCase()?(D.ValueMember="ProductID_Key",D.DisplayMember=g.UserColumnName.toString().Replace(" ",""),this.GridDataObj.TableColumns.Contains(D.DisplayMember)||this.GridDataObj.TableColumns.push(D.DisplayMember),this.GridDataObj.TableColumns.Contains(D.ValueMember)||this.GridDataObj.TableColumns.push(D.ValueMember)):"accountid"==g.SysColumnName.toString().toLowerCase()||"debitaccount"==g.SysColumnName.toString().toLowerCase()||"creditaccount"==g.SysColumnName.toString().toLowerCase()?(D.DisplayMember=g.UserColumnName.toString().Replace(" ",""),this.GridDataObj.TableColumns.push(D.DisplayMember),this.GridDataObj.TableColumns.Contains(D.ValueMember)||this.GridDataObj.TableColumns.push(D.ValueMember)):(this.GridDataObj.TableColumns.push(g.SysColumnName.toString()),this.GridDataObj.TableColumns.push(g.SysColumnName.toString()+"_Key")),D.CostCenterID=parseInt(g.ColumnCostCenterID.toString()),D.TypeID=parseInt(g.ColumnCCListViewTypeID.toString()),"ProductID_Key"!=D.ValueMember&&"AccountID"!=D.DisplayMember&&"CreditAccount"!=D.DisplayMember&&"DebitAccount"!=D.DisplayMember||(D.FilterCondition=g.UserProbableValues.toString()),s.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==s.a.SessionManager.Preferences.EnableDivisionWise.toString()&&50001==D.CostCenterID&&(D.ReadOnly=!0),s.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==s.a.SessionManager.Preferences.EnableLocationWise.toString()&&50002==D.CostCenterID&&(D.ReadOnly=!0);break;case"TEXT":case"STRING":if(this.GridDataObj.TableColumns.push(g.SysColumnName.toString()),D.IsColumnUserDefined)if("Date"==g.UserColumnType.toString())D.DataType="DATE",this.GridDataObj.TableColumns.push(g.SysColumnName.toString()+"_Key");else if("Numeric"==g.UserColumnType.toString())D.DataType="FLOAT";else if("Combobox"==g.UserColumnType.toString()){D.ValueBinding=g.SysColumnName.toString(),D.DataType="ComboBox",D.DisplayMember="Name",D.ValueMember="Value";var O=[],I=g.UserProbableValues.toString().Trim();if(I.length>0)for(var T=I.split(";"),j=0;j<T.length;j++)O.push(m.d.ComboBoxItems_2(T[j],T[j]));D.ComboData=O}break;case"DATE":D.DataType="DATE",this.GridDataObj.TableColumns.push(g.SysColumnName.toString()),this.GridDataObj.TableColumns.push(g.SysColumnName.toString()+"_Key");break;case"":D.DataType="TextBlock",this.GridDataObj.TableColumns.push(g.SysColumnName.toString())}}i.sort((function(e,t){return e.DisplayIndex-t.DisplayIndex})).forEach((function(t){e.ColumnSource.push(t)}))}},{key:"OnSave",value:function(e){if(Logger.InfoLog("LinkProdWiseViewModel::Exiting OnSave"),"Cancel"==e)"DynamicSetViewModel"==this.oparent.ClassName?(this.oparent.Parent.Celleditend(this.oparent.GridData[this.RowPos],"ProductName",3),this.oparent.FillDynamicSetData(this.oparent.GridData[this.RowPos])):"AddEditDocumentViewModel"==this.oparent.ClassName&&this.oparent.AddProductData(this.oparent.SelectedRow,!1,!1,!0),s.a.page.HideDialog();else if("Save"==e){for(var t=0,n=null,a=0,i=0;a<this.GridData.length;a++,i++)if(""!=this.GridData[a].Select.toString()&&Object(l.j)(this.GridData[a].Select.toString())){if(t++,this.dsParent.Tables[0][i][0]=this.GridData[a].TobeUsed.toString(),"AddEditDocumentViewModel"==this.oparent.ClassName&&(n=this.oparent.ScreenObject.GetKitProductDetails(this.oparent.CostCenterID,parseInt(this.GridData[a].DocDetailsID.toString()),parseInt(this.GridData[a].CostCenterID.toString()))),null!=n&&n.Tables.length>3)for(var r=0;r<n.Tables[0].length;r++)this.dsParent.Tables[0].push(n.Tables[0][r].ItemArray),this.dsParent.Tables[1].push(n.Tables[1][r].ItemArray),this.dsParent.Tables[2].push(n.Tables[2][r].ItemArray),this.dsParent.Tables[3].push(n.Tables[3][r].ItemArray)}else this.dsParent.Tables[0].RemoveAt(i),this.dsParent.Tables[1].RemoveAt(i),this.dsParent.Tables[2].RemoveAt(i),this.dsParent.Tables[3].RemoveAt(i),i--;0==t?"DynamicSetViewModel"==this.oparent.ClassName?(this.oparent.Parent.Celleditend(this.oparent.GridData[this.RowPos],"ProductName",3),this.oparent.FillDynamicSetData(this.oparent.GridData[this.RowPos])):"AddEditDocumentViewModel"==this.oparent.ClassName&&this.oparent.AddProductData(this.oparent.SelectedRow,!1,!1,!0):"AddEditDocumentViewModel"==this.oparent.ClassName?this.oparent.LoadLinkData(this.dsParent,[],this.RowPos,[],null):"DynamicSetViewModel"==this.oparent.ClassName&&this.oparent.LoadLinkData(this.dsParent,[],this.RowPos),s.a.page.HideDialog()}Logger.InfoLog("LinkProdWiseViewModel::Exiting OnSave")}},{key:"OnDeleteCallBack",value:function(){for(var e=0,t=0;t<this.GridData.length&&(e=parseInt(this.GridData[t].DocSeqNo),this.SelectedNode!=e-1||null==this.GridData[t][0]||""==this.GridData[t][0].toString());t++);this.SelectedNode<this.GridData.length&&(this.GridDataObj.removeRowAt(this.SelectedNode),this.UpdateSequence())}},{key:"RefreshGrid",set:function(e){}},{key:"ColumnSource",get:function(){return this.GridDataObj.Columns}},{key:"GridData",get:function(){return this.GridDataObj.Table}},{key:"SelectedRow",get:function(){return this.GridDataObj.SelectedItem},set:function(e){this.GridDataObj.SelectedItem=e}}]),n}(u.b),ae=n("DMr2"),ie=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var a;_classCallCheck(this,n),(a=t.call(this)).GridDataObj=new V.a,a.CatalogCode="",a.Description=null,a.ProductCode=null,a.Parent=null,a.TotalQoh=0,a.Parent=e,a.GridDataObj.CellEditEnding.Subscribe(_assertThisInitialized(a),"oncelleditend"),a.InitGrid();var i=null;("AddEditDocumentViewModel"==e.ClassName||"DynamicSetViewModel"==e.ClassName)&&(i=a.Parent.SelectedRow),a.CatalogCode=o.e.String(i.dcCCNID6),a.ProductCode=o.e.String(i.ProductCode);var r=null;if("AddEditDocumentViewModel"==e.ClassName){var s=a.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&282==e.LinkData}));s.length>0&&(a.Description=o.e.String(i[s[0].SysColumnName.toString()])),r=a.Parent.ScreenObject.GetHoldQty(parseInt(i.ProductID_Key.toString()),i.DocDetailsID.toString(),i)}else if("DynamicSetViewModel"==e.ClassName){var c=a.Parent.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&282==e.LinkData}));c.length>0&&(a.Description=o.e.String(i[c[0].SysColumnName.toString()])),r=a.Parent.Parent.ScreenObject.GetHoldQty(parseInt(i.ProductID_Key.toString()),i.DocDetailsID.toString(),i)}if(null!=r&&r.Tables.length>0&&r.Columns[0].Contains("HoldQuantity")&&r.Tables[0].length>0){var l=a.GridDataObj.NewRow();l.Name="Order Quantity",l.Qty=i.Quantity.toString(),a.GridDataObj.addRow(l),(l=a.GridDataObj.NewRow()).Name="Hold Quantity",l.Qty=r.Tables[0][0].HoldQuantity.toString(),a.GridDataObj.addRow(l),""!=r.Tables[0][0].BalQOH.toString()&&(a.TotalQoh+=parseFloat(r.Tables[0][0].BalQOH.toString())),(l=a.GridDataObj.NewRow()).Name="Executed Qty",l.Qty=r.Tables[0][0].ExecQTY.toString().Replace("-",""),a.GridDataObj.addRow(l),a.GridDataObj.addEmptyRow();var u=0;""!=r.Tables[0][0].Bal.toString()&&(u=parseFloat(r.Tables[0][0].Bal.toString())),(l=a.GridDataObj.NewRow()).Name="Bal Qty",l.Qty=u,l.StyleHeightZero=1,a.GridDataObj.addRow(l),""!=r.Tables[0][0].Hold.toString()&&(u-=parseFloat(r.Tables[0][0].Hold.toString())),""!=r.Tables[0][0].Res.toString()&&(u-=parseFloat(r.Tables[0][0].Res.toString())),(l=a.GridDataObj.NewRow()).Name="Free Stock",l.Qty=u,a.GridDataObj.addRow(l),(l=a.GridDataObj.NewRow()).Name="Bal Qty + Already Hold",l.Qty=r.Tables[0][0].BalQOH.toString(),l.StyleHeightZero=1,a.GridDataObj.addRow(l),a.GridDataObj.addEmptyRow(),(l=a.GridDataObj.NewRow()).Name="Balance Hold";var d=0;""!=i.Quantity.toString()&&(d=parseFloat(i.Quantity.toString())),""!=r.Tables[0][0].HoldQuantity.toString()?""!=r.Tables[0][0].ExecQTY.toString().Replace("-","")&&parseFloat(r.Tables[0][0].ExecQTY.toString().Replace("-",""))>parseFloat(r.Tables[0][0].HoldQuantity.toString())?d-=parseFloat(r.Tables[0][0].ExecQTY.toString().Replace("-","")):d-=parseFloat(r.Tables[0][0].HoldQuantity.toString()):""!=r.Tables[0][0].ExecQTY.toString().Replace("-","")&&(d-=parseFloat(r.Tables[0][0].ExecQTY.toString().Replace("-",""))),l.Qty=d,l.StyleHeightZero=1,a.GridDataObj.addRow(l),(l=a.GridDataObj.NewRow()).Name="To Hold",l.Qty=0,a.GridDataObj.addRow(l),(l=a.GridDataObj.NewRow()).Name="Total Hold",l.Qty=r.Tables[0][0].HoldQuantity.toString(),l.StyleHeightZero=1,a.GridDataObj.addRow(l)}return Logger.InfoLog("HoldQtyViewModel:: Entering HoldQtyViewModel"),a}return _createClass(n,[{key:"InitGrid",value:function(){this.GridDataObj.TableColumns.push("Name"),this.GridDataObj.TableColumns.push("Qty"),this.GridDataObj.TableColumns.push("StyleHeightZero");var e=new f.a;e.Header="",e.DisplayMember="Name",e.DataType="TextBlock",e.Width=230,e.ReadOnly=!0,this.ColumnSource.push(e),(e=new f.a).Header="",e.DisplayMember="Qty",e.DataType="FLOAT",e.Width=100,this.ColumnSource.push(e)}},{key:"oncelleditend",value:function(e){var t=0;""!=this.GridData[1].Qty.toString()&&(t=parseFloat(this.GridData[1].Qty.toString())),""!=this.GridData[9].Qty.toString()&&(t+=parseFloat(this.GridData[9].Qty.toString())),this.GridData[10].Qty=t}},{key:"OnButtonClick",value:function(e){if(null!=e&&"Cancel"==e.toString())s.a.page.HideDialog();else if(null!=e&&"OK"==e.toString()){var t=null;("AddEditDocumentViewModel"==this.Parent.ClassName||"DynamicSetViewModel"==this.Parent.ClassName)&&(t=this.Parent.SelectedRow);var n=0;if(""!=t.Quantity.toString()&&(n=parseFloat(t.Quantity.toString())),""!=this.GridData[10].Qty.toString()&&parseFloat(this.GridData[10].Qty.toString())>n)return this.MessageVisibility=!0,void(this.DisplayMessage="Hold quantity can not be greater order quantity");if(""!=this.GridData[10].Qty.toString()&&parseFloat(this.GridData[10].Qty.toString())>this.TotalQoh)return void(this.DisplayMessage="Hold quantity can not be greater balance quantity");if(""!=this.GridData[8].Qty.toString()&&""!=this.GridData[9].Qty.toString()&&parseFloat(this.GridData[9].Qty.toString())>parseFloat(this.GridData[8].Qty.toString()))return void(this.DisplayMessage="Hold quantity can not be greater balance Hold quantity");t.HoldQuantity=this.GridData[10].Qty.toString();var a=null,i=null;"AddEditDocumentViewModel"==this.Parent.ClassName?(i=this.Parent.ScreenObject.Data.Tables[0],a=this.Parent.ScreenObject.GridDataColumns):"DynamicSetViewModel"==this.Parent.ClassName&&(i=this.Parent.Parent.ScreenObject.Data.Tables[0],a=this.Parent.Parent.ScreenObject.GridDataColumns),i.length>0&&(null.RowFilter=i.filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&52638==e.LinkData})),null.length>0&&a.Contains(null[0].SysColumnName.toString())&&(t[null[0].SysColumnName.toString()]=this.TotalQoh.toString())),"AddEditDocumentViewModel"==this.Parent.ClassName?this.Parent.CalculateTotals(t,!1):"DynamicSetViewModel"==this.Parent.ClassName&&this.Parent.Parent.CalculateTotals(t,!1),s.a.page.HideDialog()}else{var r=e;"To Hold"!=r.item.Name.toString()&&(r.Cancel=!0)}}},{key:"GridData",get:function(){return this.GridDataObj.Table}},{key:"ColumnSource",get:function(){return this.GridDataObj.Columns}}]),n}(u.b),re=n("O6o6"),se=n("ybar"),oe=n("MC0n"),ce=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,a,i){var r,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return _classCallCheck(this,n),(r=t.call(this)).GridDataObj=new V.a,r.FooterGridDataObj=new V.a,r.IsGenerate=!1,r.HoldReserve=!1,r.AddRows=new h.d,r.IsPromotional=!1,r.Parent=null,r.mappingdv=null,r.drSel=null,r.isKit=!1,r.isModifier=!1,r.CallType=0,r.stkID=null,r.stkName=null,r.ClassName="DynamicSetViewModel",r.CallType=s,r.drSel=a,2!=s&&e.ScreenObject.Data.Tables.length>15&&(r.mappingdv=e.ScreenObject.Data.Tables[15],r.mappingdvTable=e.ScreenObject.Data.Tables[15],r.mappingdvColumns=e.ScreenObject.Data.Columns[15]),r.Parent=e,null!=r.drSel&&"3"==o.e.String(r.drSel.Type)&&(r.isKit=!0),null==r.drSel||"11"!=o.e.String(r.drSel.Type)&&"12"!=o.e.String(r.drSel.Type)||(r.isModifier=!0),1==s&&(r.IsPromotional=!0),r.Title=r.IsPromotional?"Promotional Products":r.isKit?"KIT":r.isModifier?"Modifiers":2==s||3==s||4==s?"Copy Products":"Dynamic Set",r.InitGrid(),r.GridDataObj.CellEditEnding.Subscribe(_assertThisInitialized(r),"onCellEditEnding"),r.FooterGridDataObj.CellEditEnding.Subscribe(_assertThisInitialized(r),"onFooterCellEditEnding"),r.GridDataObj.BeginEdit.Subscribe(_assertThisInitialized(r),"onBeginEdit"),r.AddRows.Visible=!1,2==r.CallType||3==r.CallType||4==r.CallType?(r.loadData(),4!=r.CallType&&(r.AddRows.Visible=!0),r.AddRows.Label="Rows",r.AddRows.Row=4,r.AddRows.Column=3,4==r.CallType&&(r.IsGenerate=!0)):(r.AddRows.Row=3,r.AddRows.Column=4,r.loadData_ds(i)),r.FillEmptyRows(),r}return _createClass(n,[{key:"OnPickerClick",value:function(e){if(Logger.InfoLog("OnPickerClick::Entering OnPickerClick With String="+e),"3"==e){var t=new se.a;t.SearchPickerViewModel_2(this,"PRODUCTS"),s.a.page.ShowDialog(t,oe.a,{ShowCenter:!0,Title:t.Title})}else if("2"==e){var n=new se.a;n.SearchPickerViewModel_2(this,"ACCOUNTS"),s.a.page.ShowDialog(n,oe.a)}else{var a=new se.a;a.SearchPickerViewModel_3(this,"COSTCENTER",e),s.a.page.ShowDialog(a,oe.a,{ShowCenter:!0,Title:a.Title})}Logger.InfoLog("OnPickerClick:: Exiting OnPickerClick")}},{key:"ParentCallBack",value:function(e){if(Logger.InfoLog("ParentCallBack :: Entering ParentCallBack With PickerObject="+e),"COSTCENTER"==e.PickerType||"PRODUCTS"==e.PickerType||"ACCOUNTS"==e.PickerType){var t=this.CCList.filter((function(t){return t.DataType==e.TreeCCID.toString()}));if(t.length>0){var n=t[0];e.SelectedNodes.forEach((function(e){e.IsGroup||0==n.Items.filter((function(t){return t.Value==e.Id.toString()})).length&&(n.Items.push(m.c.CheckedListBoxItem_5(e.Text[1],e.Id.toString(),!0)),n.Items[n.Items.length-1].Parent=e.Text[0])}))}}Logger.InfoLog("ParentCallBack::Exiting ParentCallBack")}},{key:"CallRecursive",value:function(e){if(this.CCList[e].Items.length>0)for(var t=0;t<this.CCList[e].Items.length;t++)this.CCList[e].Items[t].IsChecked&&("Name"==this.CCList[e].CodeNameCombo.SelectedValue?(this.stkName[e]=this.CCList[e].Items[t].Name,this.stkID[e]=this.CCList[e].Items[t].Value):(this.stkName[e]=this.CCList[e].Items[t].Parent,this.stkID[e]=this.CCList[e].Items[t].Value),this.AddRecurRows(e));else this.AddRecurRows(e)}},{key:"AddRecurRows",value:function(e){if(e==this.CCList.length-1){var t=this.GridData[this.Parent.GetEmptyRowPosition(this.GridDataObj,"ProductID_Key")];t[Object.keys(t)[0]]=this.GridData.length+1;for(var n=0;n<this.GridDataColumns.length;n++)"ExtraXML"==this.GridDataColumns[n]||"DocDetailsID"==this.GridDataColumns[n]||this.GridDataColumns[n].toLowerCase().startsWith("dcccnid")||(t[this.GridDataColumns[n]]=this.FooterGridData[0][this.GridDataColumns[n]]);for(var a=0;a<this.stkName.length;a++)o.e.IsEmpty(this.stkID[a])||(t[this.CCList[a].DBColumnName]=this.stkName[a],t[this.CCList[a].GroupName]=this.stkID[a])}else this.CallRecursive(e+1)}},{key:"IsGrossMapped",value:function(){if(this.IsPromotional||this.Parent.ScreenObject.Preferences.ContainsKey("SplitKit")&&"true"==this.Parent.ScreenObject.Preferences.SplitKit.toLowerCase())return!1;if(null!=this.mappingdv){var e=this.ColumnSource.find((function(e){return"gross"==e.DisplayMember.toLowerCase()}));if(e&&(this.mappingdv=this.mappingdvTable.filter((function(t){return t.CostCenterColIDField==e.ID})),console.log(this.mappingdv),this.mappingdv.length>0&&this.FooterGridDataColumns.Contains(this.mappingdv[0].MapSysColumnName.toString())))return!(this.mappingdvColumns.Contains("IgnoreKit")&&this.isKit&&!o.e.IsEmpty(this.mappingdv[0].IgnoreKit)&&Object(l.j)(this.mappingdv[0].IgnoreKit))}return!1}},{key:"OnDistribute",value:function(e){if("PactTextBoxEditor"==e.column.className){var t=e.column.field;if(o.e.IsNum(e.item[t])){if(o.e.Double(e.item[t]),!confirm(s.a.GetResource("Doyouwanttodistribute")))return;var n="",a=this.ColumnSource.find((function(e){return e.DisplayMember==t}));a&&a.DisplayMember.toLowerCase().Contains("dcnum")&&null!=a.DistributeColName&&""!=a.DistributeColName&&this.GridDataColumns.Contains(a.DistributeColName)&&(n=a.DistributeColName);var i="",r="";!o.e.IsEmpty(a.DependantOn)&&this.GridDataColumns.Contains(a.DependantOn+"_Key")&&(i=a.DependantOn+"_Key",o.e.IsEmpty(e.item[i])||(r=e.item[i].toString())),this.DistributeValues(t,parseFloat(e.item[t]),n,!0,i,r)}}}},{key:"DistributeValues",value:function(e,t,n,a){for(var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",s=0,c=0;c<this.GridData.length;c++)if(!o.e.IsEmpty(this.GridData[c].ProductID_Key)){if(""!=i&&this.GridData[c][i].toString()!=r)continue;""==n?s++:o.e.IsNum(this.GridData[c][n])&&(s+=parseFloat(this.GridData[c][n]))}var l=0,u=0,d=this.ColumnSource.find((function(t){return t.DisplayMember==e}));!d&&e.toLowerCase().Contains("dccalc")&&(d=this.ColumnSource.find((function(t){return t.DisplayMember==e.replace("dcCalc","")})));for(var D=0;D<this.GridData.length;D++)if(!o.e.IsEmpty(this.GridData[D].ProductID_Key)){if(""!=i&&this.GridData[D][i].toString()!=r)continue;if(s>0){var h=0;""==n?h=1/s*t:o.e.IsNum(this.GridData[D][n])&&(h=parseFloat(this.GridData[D][n])/s*t),this.GridData[D][e]=d&&null!=d.DecimalPoints&&""!=d.DecimalPoints?h.ToString("N"+d.DecimalPoints):h,u+=parseFloat(this.GridData[D][e]),l=D}else this.GridData[D][e]=0;a&&this.Parent.CalculateTotals(this.GridData[D],!1)}if(l>0&&t-u!=0){var S=parseFloat(this.GridData[l][e])+t-u;this.GridData[l][e]=null!=d&&null!=d.DecimalPoints&&""!=d.DecimalPoints?S.ToString("N"+d.DecimalPoints):S,a&&this.Parent.CalculateTotals(this.GridData[l],!1)}}},{key:"loadData",value:function(){for(var e=0;e<this.GridDataColumns.length;e++)"ModSelect"!=this.GridDataColumns[e]&&"ModifierName"!=this.GridDataColumns[e]&&"MinSelect"!=this.GridDataColumns[e]&&"MaxSelect"!=this.GridDataColumns[e]&&"ExtraXML"!=this.GridDataColumns[e]&&"DimAdded"!=this.GridDataColumns[e]&&"DocDetailsID"!=this.GridDataColumns[e]&&(this.FooterGridData[0][this.GridDataColumns[e]]=this.drSel[this.GridDataColumns[e]])}},{key:"loadData_ds",value:function(e){var t,n,a=this;if(""!=(t=o.e.String(this.IsPromotional?this.drSel.PromotionXML:this.drSel.ExtraXML)))!function(){if(a.isModifier&&null!=e)for(var i=0;i<e.Tables[5].length;i++){var r=a.GridDataObj.NewRow();r.ModSelect=!1,r.ModifierName=e.Tables[5][i].ModifierName.toString(),r.MinSelect=parseInt(e.Tables[5][i].MinSelect),r.MaxSelect=parseInt(e.Tables[5][i].MaxSelect),a.GridDataColumns.Contains("ProductCode")&&(r.ProductCode=e.Tables[5][i].ProductCode.toString()),a.GridDataColumns.Contains("ProductName")&&(r.ProductName=e.Tables[5][i].ProductName.toString()),r.ProductID_Key=e.Tables[5][i].ProductID.toString(),e.Columns[5].Contains("UNIT")&&!o.e.IsEmpty(e.Tables[5][i].UNIT)&&(r.Unit_Key=e.Tables[5][i].UNIT.toString()),r.Quantity=o.e.String(e.Tables[5][i].Quantity),r.defaultQuantity=o.e.IsEmpty(e.Tables[5][0].KitSize)||o.e.IsEmpty(e.Tables[5][i].Quantity)?e.Tables[5][i].Quantity.toString():parseFloat(e.Tables[5][i].Quantity.toString())/parseFloat(e.Tables[5][0].KitSize.toString()),r.LinkType=o.e.String(e.Tables[5][i].LinkType);var c=1;!o.e.IsEmpty(r.UOMConversion)&&o.e.Int(r.UOMConversion)>0&&(c=parseFloat(r.UOMConversion.toString())),o.e.IsEmpty(r.Quantity)||(r.UOMConvertedQty=c*parseFloat(r.Quantity.toString())),a.GridDataObj.addRow(r)}var u=new o.f;if(u.ReadXmlDataset(t),u.Tables.length>1)for(var d=function(t){var i=null;a.isModifier&&null!=e?(n=a.GridData.filter((function(e){return e.ProductID_Key==u.Tables[1][t].ProductID.toString()}))).length>0&&((i=n[0]).ModSelect=!0,i.DimAdded=1):i=a.GridDataObj.NewRow(),a.isKit&&(u.Columns[1].Contains("LinkType")&&(i.LinkType=u.Tables[1][t].LinkType),u.Columns[1].Contains("defaultQuantity")&&(i.defaultQuantity=u.Tables[1][t].defaultQuantity)),u.Columns[1].Contains("AverageRate")&&!o.e.IsEmpty(u.Tables[1][t].AverageRate)&&(i.AvgRate=u.Tables[1][t].AverageRate.toString()),i.Type=u.Tables[1][t].Type;for(var r=0;r<a.ColumnSource.length;r++)if(a.ColumnSource[r].IsColumnUserDefined){if(("ComboBox"==a.ColumnSource[r].DataType||"PactComboBox"==a.ColumnSource[r].DataType)&&!u.Columns[1].Contains(a.ColumnSource[r].ValueBinding)||"ComboBox"!=a.ColumnSource[r].DataType&&"PactComboBox"!=a.ColumnSource[r].DataType&&!u.Columns[1].Contains(a.ColumnSource[r].DisplayMember))continue;if("SELECTIONBOX"==a.ColumnSource[r].DataType)i[a.ColumnSource[r].DisplayMember]=u.Tables[1][t][a.ColumnSource[r].DisplayMember];else if(null!=a.ColumnSource[r].CostCenterID&&a.ColumnSource[r].CostCenterID>0)i[a.ColumnSource[r].DisplayMember+"_Key"]=u.Tables[1][t][a.ColumnSource[r].DisplayMember];else if(a.ColumnSource[r].DisplayMember.toLowerCase().Contains("dcnum"))u.Tables[1].length>0&&(o.e.IsEmpty(u.Tables[1][t][a.ColumnSource[r].DisplayMember])||(i[a.ColumnSource[r].DisplayMember]=u.Tables[1][t][a.ColumnSource[r].DisplayMember]),s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&u.Columns[1].Contains("dcCalcNumFC"+a.ColumnSource[r].DisplayMember.replace("dcNum",""))?(i["dcCalc"+a.ColumnSource[r].DisplayMember]=u.Tables[1][t]["dcCalcNumFC"+a.ColumnSource[r].DisplayMember.replace("dcNum","")],"-2"==a.ColumnSource[r].DefaultValue?u.Columns[1].Contains("dcCurrID"+a.ColumnSource[r].DisplayMember.toLowerCase().replace("dcnum",""))&&o.e.String(u.Tables[1][t]["dcCurrID"+a.ColumnSource[r].DisplayMember.toLowerCase().replace("dcnum","")])?a.GridDataColumns.Contains(u.Tables[1][t]["dcCurrID"+a.ColumnSource[r].DisplayMember.toLowerCase().replace("dcnum","")].toString())&&(i["dcCurrID"+a.ColumnSource[r].DisplayMember.toLowerCase().replace("dcnum","")+"_Key"]="1",i["dcExchRT"+a.ColumnSource[r].DisplayMember.toLowerCase().replace("dcnum","")]="1"):(a.GridDataColumns.Contains("dcCurrID"+a.ColumnSource[r].DisplayMember.toLowerCase().replace("dcnum","")+"_Key")&&(i["dcCurrID"+a.ColumnSource[r].DisplayMember.toLowerCase().replace("dcnum","")+"_Key"]=u.Tables[1][t]["dcCurrID"+a.ColumnSource[r].DisplayMember.toLowerCase().replace("dcnum","")]),a.GridDataColumns.Contains("dcExchRT"+a.ColumnSource[r].DisplayMember.toLowerCase().replace("dcnum",""))&&(i["dcExchRT"+a.ColumnSource[r].DisplayMember.toLowerCase().replace("dcnum","")]=u.Tables[1][t]["dcExchRT"+a.ColumnSource[r].DisplayMember.toLowerCase().replace("dcnum","")])):"-1"!=a.ColumnSource[r].DefaultValue&&u.Columns[1].Contains("dcExchRT"+a.ColumnSource[r].DisplayMember.toLowerCase().replace("dcnum",""))&&o.e.Int(a.ColumnSource[r].DefaultValue)>0&&a.ColumnSource[r].CurrID>0&&(a.ColumnSource[r].ExhcgRt=o.e.IsEmpty(u.Tables[1][t]["dcExchRT"+a.ColumnSource[r].DisplayMember.toLowerCase().replace("dcnum","")])?1:parseFloat(u.Tables[1][t]["dcExchRT"+a.ColumnSource[r].DisplayMember.toLowerCase().replace("dcnum","")]))):u.Columns[1].Contains("dcCalc"+a.ColumnSource[r].DisplayMember.replace("dc",""))&&!o.e.IsEmpty(u.Tables[1][t]["dcCalc"+a.ColumnSource[r].DisplayMember.replace("dc","")])&&(i["dcCalc"+a.ColumnSource[r].DisplayMember]=u.Tables[1][t]["dcCalc"+a.ColumnSource[r].DisplayMember.replace("dc","")]));else if("DATE"==a.ColumnSource[r].DataType){if(!o.e.IsEmpty(u.Tables[1][t][a.ColumnSource[r].DisplayMember])){var c="dd/MMM/yyyy";s.a.SessionManager.Preferences.ContainsKey("Date Format")&&""!=s.a.SessionManager.Preferences["Date Format"]&&(c=s.a.SessionManager.Preferences["Date Format"]),i[a.ColumnSource[r].DisplayMember]=new Date(u.Tables[1][t][a.ColumnSource[r].DisplayMember]).ToString(c),i[a.ColumnSource[r].DisplayMember+"_Key"]=new Date(u.Tables[1][t][a.ColumnSource[r].DisplayMember])}}else"ComboBox"==a.ColumnSource[r].DataType?i[a.ColumnSource[r].ValueBinding]=u.Tables[1][t][a.ColumnSource[r].ValueBinding]:"PactComboBox"==a.ColumnSource[r].DataType?(i[a.ColumnSource[r].ValueBinding]=u.Tables[1][t][a.ColumnSource[r].ValueBinding],i[a.ColumnSource[r].ValueBinding+"_Key"]=u.Tables[1][t][a.ColumnSource[r].ValueBinding]):"FLOAT"==a.ColumnSource[r].DataType?o.e.IsNum(u.Tables[1][t][a.ColumnSource[r].DisplayMember])&&(i[a.ColumnSource[r].DisplayMember]=u.Tables[1][t][a.ColumnSource[r].DisplayMember]):i[a.ColumnSource[r].DisplayMember]=u.Tables[1][t][a.ColumnSource[r].DisplayMember]}else if(3==a.ColumnSource[r].CostCenterID){if(!u.Columns[1].Contains("ProductID"))continue;i[a.ColumnSource[r].ValueMember]=u.Tables[1][t].ProductID}else if(0!=a.ColumnSource[r].CostCenterID){if(!u.Columns[1].Contains(a.ColumnSource[r].ValueMember.substr(0,a.ColumnSource[r].ValueMember.length-4)))continue;i[a.ColumnSource[r].ValueMember]=u.Tables[1][t][a.ColumnSource[r].ValueMember.substr(0,a.ColumnSource[r].ValueMember.length-4)]}else if("LinkedInvDocDetailsID"==a.ColumnSource[r].DisplayMember)u.Columns[1].Contains(a.ColumnSource[r].DisplayMember)&&!o.e.IsEmpty(u.Tables[1][t][a.ColumnSource[r].DisplayMember])&&(i[a.ColumnSource[r].DisplayMember]=u.Tables[1][t][a.ColumnSource[r].DisplayMember]);else if("DocSeqNo"!=a.ColumnSource[r].DisplayMember)if("DATE"==a.ColumnSource[r].DataType){if(!u.Columns[1].Contains(a.ColumnSource[r].DisplayMember))continue;if(!o.e.IsEmpty(u.Tables[1][t][a.ColumnSource[r].DisplayMember])){var d="dd/MMM/yyyy";s.a.SessionManager.Preferences.ContainsKey("Date Format")&&""!=s.a.SessionManager.Preferences["Date Format"]&&(d=s.a.SessionManager.Preferences["Date Format"]),i[a.ColumnSource[r].DisplayMember]=new Date(u.Tables[1][t][a.ColumnSource[r].DisplayMember]).ToString(d),a.GridDataColumns.Contains(a.ColumnSource[r].DisplayMember+"_Key")&&(i[a.ColumnSource[r].DisplayMember+"_Key"]=new Date(u.Tables[1][t][a.ColumnSource[r].DisplayMember]))}}else if("ComboBox"==a.ColumnSource[r].DataType){if(!u.Columns[1].Contains(a.ColumnSource[r].ValueBinding))continue;i[a.ColumnSource[r].ValueBinding]=u.Tables[1][t][a.ColumnSource[r].ValueBinding]}else"FLOAT"==a.ColumnSource[r].DataType?u.Columns[1].Contains(a.ColumnSource[r].DisplayMember)&&!o.e.IsEmpty(u.Tables[1][t][a.ColumnSource[r].DisplayMember])&&(i[a.ColumnSource[r].DisplayMember]=u.Tables[1][t][a.ColumnSource[r].DisplayMember]):u.Columns[1].Contains(a.ColumnSource[r].DisplayMember)&&(i[a.ColumnSource[r].DisplayMember]=u.Tables[1][t][a.ColumnSource[r].DisplayMember]);u.Columns[1].Contains("ExtraXML")&&!o.e.IsEmpty(u.Tables[1][t].ExtraXML)&&(i.ExtraXML=u.Tables[1][t].ExtraXML),a.isModifier||a.GridDataObj.addRow(i)},D=0;D<u.Tables[1].length;D++)d(D);if(a.RefreshGrid=!0,!a.IsPromotional)for(var h=0;h<a.GridDataColumns.length;h++)"ModSelect"!=a.GridDataColumns[h]&&"ModifierName"!=a.GridDataColumns[h]&&"MinSelect"!=a.GridDataColumns[h]&&"MaxSelect"!=a.GridDataColumns[h]&&"DimAdded"!=a.GridDataColumns[h]&&"ExtraXML"!=a.GridDataColumns[h]&&"DocDetailsID"!=a.GridDataColumns[h]&&"Type"!=a.GridDataColumns[h]&&"UOMConversion"!=a.GridDataColumns[h]&&"UOMConvertedQty"!=a.GridDataColumns[h]&&"LinkedInvDocDetailsID"!=a.GridDataColumns[h]&&"RefNo"!=a.GridDataColumns[h]&&"LinkedFieldName"!=a.GridDataColumns[h]&&(a.FooterGridData[0][a.GridDataColumns[h]]=a.drSel[a.GridDataColumns[h]])}();else if(null!=this.drSel&&null!=e&&e.Tables.length>5&&e.Columns[5].Contains("Quantity")){for(var i=0;i<e.Tables[5].length;i++){var r=this.GridDataObj.NewRow();this.isModifier&&(r.ModSelect=!1,r.ModifierName=e.Tables[5][i].ModifierName.toString(),r.MinSelect=parseInt(e.Tables[5][i].MinSelect),r.MaxSelect=parseInt(e.Tables[5][i].MaxSelect)),this.GridDataColumns.Contains("ProductCode")&&(r.ProductCode=e.Tables[5][i].Productcode.toString()),this.GridDataColumns.Contains("ProductName")&&(r.ProductName=e.Tables[5][i].ProductName.toString()),r.ProductID_Key=e.Tables[5][i].ProductID.toString(),e.Columns[5].Contains("UNIT")&&!o.e.IsEmpty(e.Tables[5][i].UNIT)&&(r.Unit_Key=e.Tables[5][i].UNIT.toString()),this.GridDataObj.addRow(r),this.isModifier||this.Parent.AddProductData(r,!1,!1,!1,e.Tables[5][i].Rate.toString(),null),r.Quantity=e.Tables[5][i].Quantity.toString(),r.defaultQuantity=o.e.IsEmpty(e.Tables[5][0].KitSize)||o.e.IsEmpty(e.Tables[5][i].Quantity)?e.Tables[5][i].Quantity.toString():parseFloat(e.Tables[5][i].Quantity)/parseFloat(e.Tables[5][0].KitSize),r.LinkType=e.Tables[5][i].LinkType.toString();var c=1;!o.e.IsEmpty(r.UOMConversion)&&o.e.Double(r.UOMConversion)>0&&(c=parseFloat(r.UOMConversion.toString())),o.e.IsEmpty(r.Quantity)||(r.UOMConvertedQty=c*parseFloat(r.Quantity.toString())),this.Parent.CalculateTotals(r,!1)}this.FooterGridData[0].Quantity=e.Tables[5].length>0&&!o.e.IsEmpty(e.Tables[5][0].KitSize)?e.Tables[5][0].KitSize.toString():1;for(var u=0;u<this.GridDataColumns.length;u++)"ModSelect"!=this.GridDataColumns[u]&&"ModifierName"!=this.GridDataColumns[u]&&"MinSelect"!=this.GridDataColumns[u]&&"MaxSelect"!=this.GridDataColumns[u]&&"DimAdded"!=this.GridDataColumns[u]&&"ExtraXML"!=this.GridDataColumns[u]&&"DocDetailsID"!=this.GridDataColumns[u]&&"Quantity"!=this.GridDataColumns[u]&&"Type"!=this.GridDataColumns[u]&&"UOMConversion"!=this.GridDataColumns[u]&&"UOMConvertedQty"!=this.GridDataColumns[u]&&"LinkedInvDocDetailsID"!=this.GridDataColumns[u]&&"RefNo"!=this.GridDataColumns[u]&&"LinkedFieldName"!=this.GridDataColumns[u]&&(this.GridDataColumns[u].toLowerCase().Contains("unit")&&null==this.drSel[this.GridDataColumns[u]]&&e.Tables.length>0&&e.Columns[0].Contains("uomid")&&!o.e.IsEmpty(e.Tables[0][0].uomid)?(this.FooterGridData[0].Unit=e.Tables[0][0].UnitName.toString(),this.FooterGridData[0].Unit_key=e.Tables[0][0].uomid.toString()):this.FooterGridData[0][this.GridDataColumns[u]]=this.drSel[this.GridDataColumns[u]]);if(this.FillDynamicSetData(null),this.isModifier||e.Tables[5].length>0&&(!this.Parent.ScreenObject.Preferences.ContainsKey("SplitKit")||"true"!=this.Parent.ScreenObject.Preferences.SplitKit.toLowerCase())&&this.FillXml(!1),this.isModifier&&""!=t){this.drSel.ExtraXML=t,this.FooterGridData[0].Quantity=this.drSel.Quantity,this.OnfooterQtyChanged(this.FooterGridData[0]),this.FooterGridData[0].Rate=this.drSel.Rate,o.e.IsEmpty(this.FooterGridData[0].Rate)||o.e.IsEmpty(this.FooterGridData[0].Quantity)||(this.FooterGridData[0].Gross=parseFloat(this.FooterGridData[0].Rate.toString())*parseFloat(this.FooterGridData[0].Quantity.toString()));var d=new o.f;if(d.ReadXmlDataset(t),d.Tables.length>1)for(var D=0;D<d.Tables[1].length;D++)for(var h=0;h<this.GridData.length;h++)o.e.String(d.Tables[1][D].ProductID)==o.e.String(this.GridData[h].ProductID_Key)&&(this.GridData[h].ModSelect=!0,this.GridData[h].Quantity=d.Tables[1][D].Quantity,this.Parent.Celleditend(this.GridData[h],"Quantity",0))}}else if(!this.IsPromotional)for(var S=0;S<this.GridDataColumns.length;S++)"ModSelect"!=this.GridDataColumns[S]&&"ModifierName"!=this.GridDataColumns[S]&&"MinSelect"!=this.GridDataColumns[S]&&"MaxSelect"!=this.GridDataColumns[S]&&"DimAdded"!=this.GridDataColumns[S]&&"ExtraXML"!=this.GridDataColumns[S]&&"DocDetailsID"!=this.GridDataColumns[S]&&"Type"!=this.GridDataColumns[S]&&"UOMConversion"!=this.GridDataColumns[S]&&"UOMConvertedQty"!=this.GridDataColumns[S]&&"LinkedInvDocDetailsID"!=this.GridDataColumns[S]&&"RefNo"!=this.GridDataColumns[S]&&"LinkedFieldName"!=this.GridDataColumns[S]&&(this.FooterGridData[0][this.GridDataColumns[S]]=this.drSel[this.GridDataColumns[S]])}},{key:"onBeforeRowDeleting",value:function(e){this.isKit&&alert("Can't Delete Kit Products")}},{key:"OnfooterQtyChanged",value:function(e){if((this.isKit||this.isModifier)&&!o.e.IsEmpty(e.Quantity)){for(var t=0;t<this.GridData.length;t++)o.e.IsEmpty(this.GridData[t].defaultQuantity)||(this.GridData[t].Quantity=parseFloat(this.GridData[t].defaultQuantity)*parseFloat(e.Quantity),this.Parent.CalculateTotals(this.GridData[t],!1));this.FillDynamicSetData(null)}if(!o.e.IsEmpty(e.Gross)&&!o.e.IsEmpty(e.Quantity)&&0!=parseFloat(e.Quantity))if(this.CalcRate||(this.CalcRate=this.IsGrossMapped()),this.CalcRate){var n=parseFloat(e.Gross)/parseFloat(e.Quantity);e.Rate="Infinity"!=n.toString()&&"-Infinity"!=n.toString()&&"NaN"!=n.toString()?n:0}else o.e.IsEmpty(e.Rate)||o.e.IsEmpty(e.Quantity)||(e.Gross=parseFloat(e.Rate)*parseFloat(e.Quantity))}},{key:"onFooterCellEditEnding",value:function(e){var t,n=e.item;if("Quantity"==(t=e.column.field))this.OnfooterQtyChanged(n);else if("Rate"==t)o.e.IsEmpty(n.Rate)||o.e.IsEmpty(n.Quantity)||(n.Gross=parseFloat(n.Rate)*parseFloat(n.Quantity));else if("Gross"==t&&!o.e.IsEmpty(n.Gross)&&!o.e.IsEmpty(n.Quantity))if(this.CalcRate||(this.CalcRate=this.IsGrossMapped()),this.CalcRate){var a=parseFloat(n.Gross)/parseFloat(n.Quantity);n.Rate="Infinity"!=a.toString()&&"-Infinity"!=a.toString()&&"NaN"!=a.toString()?a:0}else o.e.IsEmpty(n.Rate)||o.e.IsEmpty(n.Quantity)||(n.Gross=parseFloat(n.Rate)*parseFloat(n.Quantity));this.FooterGridDataObj.updateRow(n)}},{key:"onCellEditEnding",value:function(e){var t=e.item;if("ModSelect"!=e.column.field&&"DataGridComboBoxColumn"!=e.column.className){var n,a=e.column.field,i=0;if("DataGridPactListBoxColumn"==e.column.className&&(i=e.column.DgCol.CostCenterID),3==i&&this.Parent.ScreenObject.Preferences.ContainsKey("dynamicsetProductwiselinking")&&null!=this.Parent.ScreenObject.Preferences.dynamicsetProductwiselinking&&Object(l.j)(this.Parent.ScreenObject.Preferences.dynamicsetProductwiselinking)){if(!o.e.IsEmpty(t.ProductID_Key))if(null!=(n=this.Parent.ScreenObject.GetProductLinkDetails(this.Parent.DocumentID,parseInt(t.ProductID_Key),this.Parent.ScreenObject.DocDate.Date.ToString("dd/MMM/yyyy"),null!=this.Parent.ScreenObject.DueDate&&this.Parent.ScreenObject.DueDate.Date?this.Parent.ScreenObject.DueDate.Date.ToString("dd/MMM/yyyy"):"",t))&&n.Tables.length>0&&n.Tables[0].length>0){var r=new ne(this,t.ProductID_Key.toString(),n,this.GridData.indexOf(t));s.a.page.ShowDialog(r,ae.a)}else this.Parent.Celleditend(t,a,i),this.FillDynamicSetData(t)}else 2==this.CallType||3==this.CallType||4==this.CallType?this.Parent.Celleditend(t,a,i,1):this.Parent.Celleditend(t,a,i),this.FillDynamicSetData(t)}}},{key:"FillDynamicSetData",value:function(e){var t=this;if(!(this.IsPromotional||this.Parent.ScreenObject.Preferences.ContainsKey("SplitKit")&&"true"==this.Parent.ScreenObject.Preferences.SplitKit.toLowerCase()))try{if(null!=this.mappingdv)for(var n=function(n){var a=t.ColumnSource[n];if(t.mappingdv=t.mappingdvTable.filter((function(e){return e.CostCenterColIDField==a.ID})),t.mappingdv.length>0&&t.FooterGridDataColumns.Contains(o.e.String(t.mappingdv[0].MapSysColumnName))){if(t.mappingdvColumns.Contains("IgnoreKit")&&t.isKit&&!o.e.IsEmpty(t.mappingdv[0].IgnoreKit)&&Object(l.j)(t.mappingdv[0].IgnoreKit))return"continue";var i="";if(Object(l.j)(t.mappingdv[0].ClubFields)){if("FLOAT"==a.DataType){for(var r=0,s=0;s<t.GridData.length;s++)o.e.IsEmpty(t.GridData[s][a.DisplayMember])||(r+=parseFloat(t.GridData[s][a.DisplayMember]));i=r.toString()}else if("DATE"!=a.DataType){for(var c=0;c<t.GridData.length;c++)"PactComboBox"==a.DataType||"ComboBox"==a.DataType?o.e.IsEmpty(t.GridData[c][a.ValueBinding])||(i+=t.GridData[c][a.ValueBinding].toString()+t.mappingdv[0].delimiter.toString()):o.e.IsEmpty(t.GridData[c][a.DisplayMember])||(i+=t.GridData[c][a.DisplayMember].toString()+t.mappingdv[0].delimiter.toString());i.length>1&&!o.e.IsEmpty(t.mappingdv[0].delimiter)&&(i=i.substr(0,i.length-1))}}else null!=e&&(i=e[a.DisplayMember].toString());if(t.FooterGridDataColumns.Contains(t.mappingdv[0].MapSysColumnName.toString()))if(t.FooterGridDataObj.DataTypes.Double.Contains(t.mappingdv[0].MapSysColumnName.toString())){var u=o.e.Double(i);t.FooterGridData[0][t.mappingdv[0].MapSysColumnName.toString()]=u}else if(t.FooterGridDataObj.DataTypes.Int.Contains(t.mappingdv[0].MapSysColumnName.toString())){var d=o.e.Int(i);t.FooterGridData[0][t.mappingdv[0].MapSysColumnName.toString()]=d}else if(t.FooterGridDataObj.DataTypes.Date.Contains(t.mappingdv[0].MapSysColumnName.toString())){o.e.isValidDate(i)&&(t.FooterGridData[0][t.mappingdv[0].MapSysColumnName.toString()]=void 0)}else t.FooterGridData[0][t.mappingdv[0].MapSysColumnName.toString()]=i;if("Gross"==a.DisplayMember&&!o.e.IsEmpty(t.FooterGridData[0].Gross)&&!o.e.IsEmpty(t.FooterGridData[0].Quantity)){var D=parseFloat(t.FooterGridData[0].Gross)/parseFloat(t.FooterGridData[0].Quantity);t.FooterGridData[0].Rate="Infinity"!=D.toString()&&"-Infinity"!=D.toString()&&"NaN"!=D.toString()?D:0}}},a=0;a<this.ColumnSource.length;a++)n(a)}catch(i){this.DisplayMessage="Error mapping Fields",this.MessageVisibility=!0,Logger.ErrorLog("dynamicsetviewmodel","cell edit ending",i)}}},{key:"FillXml",value:function(e){var t="";t+="<xml>";for(var n=0,a=this.GridData.Compute("sum","Gross"),i=this.GridData.Compute("sum","Quantity"),r=0;r<this.GridData.length;r++)if(!o.e.IsEmpty(this.GridData[r].ProductID_Key)){if(this.isModifier){if(!Object(l.j)(this.GridData[r].ModSelect))continue;if("1"!=o.e.String(this.GridData[r].DimAdded)){var c=this.GridData[r];this.Parent.AddProductData(c,!1,!1,!1,o.e.String(c.Rate),null),this.Parent.CalculateTotals(c,!1)}}n++,t+="<Row ><xml ";var u="",d="",D="",S=!1,m=1,b=1;null!=this.Parent.Currency&&null!=this.Parent.Currency.Currency.SelectedValue&&""!=this.Parent.Currency.Currency.SelectedValue?m=parseInt(this.Parent.Currency.Currency.SelectedValue):null!=this.drSel&&this.Parent.ScreenObject.GridDataColumns.Contains("CurrencyID")&&!o.e.IsEmpty(this.drSel.CurrencyID_Key)&&(m=parseInt(this.drSel.CurrencyID_Key)),null!=this.Parent.Currency&&null!=this.Parent.Currency.ExchangeRate.Text&&""!=this.Parent.Currency.ExchangeRate.Text?b=parseFloat(this.Parent.Currency.ExchangeRate.Text):null!=this.drSel&&this.Parent.ScreenObject.GridDataColumns.Contains("ExchangeRate")&&!o.e.IsEmpty(this.drSel.ExchangeRate)&&(b=parseFloat(this.drSel.ExchangeRate));for(var C=0;C<this.ColumnSource.length;C++)if(!this.ColumnSource[C].DisplayMember.toLowerCase().Contains("modselect")&&!this.ColumnSource[C].DisplayMember.toLowerCase().Contains("modifiername")){if(e&&!this.Parent.ValidateDataonSave_col_dr(this.ColumnSource[C],this.GridData[r]))return!1;if(this.ColumnSource[C].IsColumnUserDefined){if(this.ColumnSource[C].DisplayMember.toLowerCase().Contains("dcexchrt")||this.ColumnSource[C].DisplayMember.toLowerCase().Contains("dccurrid"))continue;if("SELECTIONBOX"==this.ColumnSource[C].DataType)t+=this.ColumnSource[C].DisplayMember+'="'+h.d.GetValidXml(this.GridData[r][this.ColumnSource[C].DisplayMember])+'" ',D+=this.ColumnSource[C].DisplayMember+"='"+h.d.GetValidTextXml(this.GridData[r][this.ColumnSource[C].DisplayMember])+"', ";else if(this.ColumnSource[C].DisplayMember.toLowerCase().Contains("dcnum")){s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&("-2"==this.ColumnSource[C].DefaultValue?(o.e.IsEmpty(this.GridData[r]["dcCurrID"+this.ColumnSource[C].DisplayMember.toLowerCase().replace("dcnum","")+"_Key"])||(m=parseInt(this.GridData[r]["dcCurrID"+this.ColumnSource[C].DisplayMember.toLowerCase().replace("dcnum","")+"_Key"])),o.e.IsEmpty(this.GridData[r]["dcExchRT"+this.ColumnSource[C].DisplayMember.toLowerCase().replace("dcnum","")])||(b=parseFloat(this.GridData[r]["dcExchRT"+this.ColumnSource[C].DisplayMember.toLowerCase().replace("dcnum","")]))):o.e.Int(this.ColumnSource[C].DefaultValue)>0&&this.ColumnSource[C].CurrID>0&&(m=this.ColumnSource[C].CurrID,b=this.ColumnSource[C].ExhcgRt)),t+=this.ColumnSource[C].DisplayMember+'="'+o.e.String(this.GridData[r][this.ColumnSource[C].DisplayMember])+'" ';var y=o.e.Double(this.GridData[r]["dcCalc"+this.ColumnSource[C].DisplayMember]);s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&(t+="dcCurrID"+this.ColumnSource[C].DisplayMember.toLowerCase().replace("dcnum","")+'="'+m+'" ',t+="dcExchRT"+this.ColumnSource[C].DisplayMember.toLowerCase().replace("dcnum","")+'="'+b+'" ',t+="dcCalcNumFC"+this.ColumnSource[C].DisplayMember.toLowerCase().replace("dcnum","")+'="'+y+'" '),t+="dcCalc"+this.ColumnSource[C].DisplayMember.replace("dc","")+'="'+y*b+'" ',o.e.IsEmpty(this.GridData[r][this.ColumnSource[C].DisplayMember])?d+=this.ColumnSource[C].DisplayMember+"=0, ":d+=this.ColumnSource[C].DisplayMember+"="+this.GridData[r][this.ColumnSource[C].DisplayMember].toString()+", ",y=o.e.Double(this.GridData[r]["dcCalc"+this.ColumnSource[C].DisplayMember]),s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&(d+="dcCurrID"+this.ColumnSource[C].DisplayMember.toLowerCase().replace("dcnum","")+"="+m+", ",d+="dcExchRT"+this.ColumnSource[C].DisplayMember.toLowerCase().replace("dcnum","")+"="+b+", ",d+="dcCalcNumFC"+this.ColumnSource[C].DisplayMember.toLowerCase().replace("dcnum","")+"="+y+", "),d+="dcCalc"+this.ColumnSource[C].DisplayMember.replace("dc","")+"="+y*b+", "}else"DATE"==this.ColumnSource[C].DataType?o.e.IsEmpty(this.GridData[r][this.ColumnSource[C].DisplayMember+"_Key"])||(t+=this.ColumnSource[C].DisplayMember+'="'+new Date(this.GridData[r][this.ColumnSource[C].DisplayMember+"_Key"]).ToString("dd/MMM/yyyy")+'" ',D+=this.ColumnSource[C].DisplayMember+"='"+new Date(this.GridData[r][this.ColumnSource[C].DisplayMember+"_Key"]).ToString("dd/MMM/yyyy")+"', "):"ComboBox"==this.ColumnSource[C].DataType?(t+=this.ColumnSource[C].ValueBinding+'="'+h.d.GetValidXml(this.GridData[r][this.ColumnSource[C].ValueBinding])+'" ',D+=this.ColumnSource[C].ValueBinding+"='"+h.d.GetValidTextXml(this.GridData[r][this.ColumnSource[C].ValueBinding])+"', "):"PactComboBox"==this.ColumnSource[C].DataType?(t+=this.ColumnSource[C].ValueBinding+'="'+h.d.GetValidXml(this.GridData[r][this.ColumnSource[C].ValueBinding+"_Key"])+'" ',D+=this.ColumnSource[C].ValueBinding+"='"+h.d.GetValidTextXml(this.GridData[r][this.ColumnSource[C].ValueBinding+"_Key"])+"', "):"LISTBOX"==this.ColumnSource[C].DataType&&0!=this.ColumnSource[C].CostCenterID&&this.ColumnSource[C].DisplayMember.toLowerCase().Contains("alpha")?(t+=this.ColumnSource[C].DisplayMember+'="'+o.e.String(this.GridData[r][this.ColumnSource[C].ValueMember])+'" ',D+=this.ColumnSource[C].DisplayMember+"='"+o.e.String(this.GridData[r][this.ColumnSource[C].ValueMember])+"', "):0!=this.ColumnSource[C].CostCenterID?o.e.Int(this.GridData[r][this.ColumnSource[C].ValueMember])>0&&(t+=this.ColumnSource[C].DisplayMember+'="'+o.e.String(this.GridData[r][this.ColumnSource[C].ValueMember])+'" ',this.ColumnSource[C].DisplayMember.toLowerCase().Contains("dcccnid")&&(u+=this.ColumnSource[C].DisplayMember+"="+o.e.String(this.GridData[r][this.ColumnSource[C].ValueMember])+", ")):(t+=this.ColumnSource[C].DisplayMember+'="'+h.d.GetValidXml(this.GridData[r][this.ColumnSource[C].DisplayMember])+'" ',D+=this.ColumnSource[C].DisplayMember+"='"+h.d.GetValidTextXml(this.GridData[r][this.ColumnSource[C].DisplayMember])+"', ")}else 3==this.ColumnSource[C].CostCenterID?(S||(t+=this.ColumnSource[C].ValueMember.substr(0,this.ColumnSource[C].ValueMember.length-4)+'="'+o.e.String(this.GridData[r][this.ColumnSource[C].ValueMember])+'" '),S=!0):0!=this.ColumnSource[C].CostCenterID?(o.e.Int(this.GridData[r][this.ColumnSource[C].ValueMember])>0&&"CurrencyID"!=this.ColumnSource[C].DisplayMember&&(t+=this.ColumnSource[C].ValueMember.substr(0,this.ColumnSource[C].ValueMember.length-4)+'="'+o.e.String(this.GridData[r][this.ColumnSource[C].ValueMember])+'" '),"unit"==this.ColumnSource[C].DisplayMember.toLowerCase()&&(t+='UOMConversion="'+o.e.String(this.GridData[r].UOMConversion)+'" ',t+='UOMConvertedQty="'+o.e.String(this.GridData[r].UOMConvertedQty)+'" ')):t+="DocDetailsID"==this.ColumnSource[C].DisplayMember?' DocDetailsID="'+o.e.String(this.GridData[r].DocDetailsID)+'" ':"ComboBox"==this.ColumnSource[C].DataType?this.ColumnSource[C].ValueBinding+'="'+h.d.GetValidXml(this.GridData[r][this.ColumnSource[C].ValueBinding])+'" ':this.ColumnSource[C].DisplayMember+'="'+h.d.GetValidXml(this.GridData[r][this.ColumnSource[C].DisplayMember])+'" '}o.e.IsEmpty(this.GridData[r].AVGRATE)||(t+='AverageRate="'+this.GridData[r].AVGRATE.toString()+'" '),t+=' CCQuery="'+u.toString()+'" ',t+=' NumQuery="'+d.toString()+'" ',t+=' texQuery="'+D.toString()+'" ',null!=a&&(t+=' totgross="'+a.toString()+'" '),null!=i&&(t+=' totQty="'+i.toString()+'" '),t+=' Type="'+o.e.String(this.GridData[r].Type)+'" ',this.isKit&&(t+=' LinkType="'+o.e.String(this.GridData[r].LinkType)+'" ',t+=' defaultQuantity="'+o.e.String(this.GridData[r].defaultQuantity)+'" '),o.e.IsEmpty(this.GridData[r].LinkedFieldName)||(t+='LinkedFieldValue="'+this.GridData[r][this.GridData[r].LinkedFieldName.toString()].toString()+'" '),o.e.IsEmpty(this.GridData[r].ExtraXML)||"2"!=o.e.String(this.GridData[r].Type)&&"5"!=o.e.String(this.GridData[r].Type)||(t+=' ExtraXML="'+h.d.GetValidTextXml(this.GridData[r].ExtraXML)+'" '),t+=" />",t+="</Row>"}if(t+="</xml>",this.IsPromotional){var p=this.Parent.ScreenObject.Data.Tables[0].filter((function(e){return 79==e.LocalReference&&55493==e.LinkData}));p.length>0&&this.Parent.ScreenObject.GridDataColumns.Contains(p[0].SysColumnName.toString())&&(this.drSel[p[0].SysColumnName.toString()]=n),this.drSel.PromotionXML=t.toString()}else{for(var g=0;g<this.GridDataColumns.length;g++)"ModSelect"!=this.GridDataColumns[g]&&"ModifierName"!=this.GridDataColumns[g]&&"MinSelect"!=this.GridDataColumns[g]&&"MaxSelect"!=this.GridDataColumns[g]&&"ExtraXML"!=this.GridDataColumns[g]&&"DimAdded"!=this.GridDataColumns[g]&&"DocSeqNo"!=this.GridDataColumns[g]&&"DocDetailsID"!=this.GridDataColumns[g]&&"Type"!=this.GridDataColumns[g]&&"UOMConversion"!=this.GridDataColumns[g]&&"UOMConvertedQty"!=this.GridDataColumns[g]&&"LinkedInvDocDetailsID"!=this.GridDataColumns[g]&&"RefNo"!=this.GridDataColumns[g]&&"LinkedFieldName"!=this.GridDataColumns[g]&&"ProductID_Key"!=this.GridDataColumns[g]&&"ProductCode"!=this.GridDataColumns[g]&&"ProductName"!=this.GridDataColumns[g]&&(this.drSel[this.GridDataColumns[g]]=this.FooterGridData[0][this.GridDataColumns[g]]);this.drSel.ExtraXML=t.toString()}return!0}},{key:"onSearch",value:function(e){"PactTextBoxEditor"==e.column.className&&"holdquantity"==e.column.field.toLowerCase()?null!=this.SelectedRow&&!o.e.IsEmpty(this.SelectedRow.DocDetailsID)&&parseInt(this.SelectedRow.DocDetailsID)>0&&s.a.page.ShowDialog(new ie(this),re.a):("quantity"==e.column.field.toLowerCase()&&!o.e.IsEmpty(this.SelectedRow.Quantity)||"FreeQTY"==e.column.field&&!o.e.IsEmpty(this.SelectedRow.FreeQTY))&&"5"==this.SelectedRow.Type.toString()&&(this.Parent.ScreenObject.Preferences.ContainsKey("ShowBatches")&&""!=this.Parent.ScreenObject.Preferences.ShowBatches&&Object(l.j)(this.Parent.ScreenObject.Preferences.ShowBatches)||!this.Parent.DonotUpdateInventory)&&(1==e.Owner.CurrentCellContainer.IsEditing?e.Owner.OnTabKeyDown(null):this.Parent.fillbatches(this.SelectedRow.Row,e.column.field))}},{key:"onBeginEdit",value:function(e){this.Parent.onBeginEdit(e)}},{key:"FillEmptyRows",value:function(){for(var e=this.GridData.length;e<10;e++)this.GridDataObj.addEmptyRow();for(var t=0;t<this.GridData.length;t++)this.GridData[t].DocSeqNo=t+1}},{key:"InitGrid",value:function(){var e=this;if(this.isModifier){var t=new f.a;(t=new f.a).ID="0",t.Header="Select",t.DisplayMember="ModSelect",t.DataType="CheckBox",t.Width=70,this.ColumnSource.push(t),(t=new f.a).ID="0",t.Header="Modifier Name",t.DisplayMember="ModifierName",t.DataType="TextBlock",t.Width=120,t.ReadOnly=!0,this.ColumnSource.push(t),this.GridDataObj.TableColumns.push("ModSelect"),this.GridDataObj.TableColumns.push("ModifierName"),this.GridDataObj.TableColumns.push("MinSelect"),this.GridDataObj.TableColumns.push("MaxSelect"),this.GridDataObj.TableColumns.push("DimAdded")}for(var n=0;n<this.Parent.ScreenObject.GridDataColumns.length;n++)this.GridDataColumns.push(this.Parent.ScreenObject.GridDataColumns[n]),this.FooterGridDataColumns.push(this.Parent.ScreenObject.GridDataColumns[n]);4==this.CallType&&(this.CCList=new Array);for(var a=function(t){var n=e.Parent.ScreenObject.ColumnSource[t],a=n.Clone(),i=n.Clone();if(4==e.CallType&&i.DisplayMember.toLowerCase().startsWith("dcccnid")){var r=new m.a;r.CheckedListBoxComboData_1(0),r.DBColumnName=i.DisplayMember,r.GroupName=i.ValueMember,r.FeatureID=i.CostCenterID,r.DataType=i.CostCenterID.toString(),r.Label=i.Header,r.Height=150,e.CCList.push(r),o.e.IsEmpty(e.drSel[i.ValueMember])||r.Items.push(m.c.CheckedListBoxItem_5(e.drSel[i.DisplayMember].toString(),e.drSel[i.ValueMember].toString(),!0))}else 2!=e.CallType&&3!=e.CallType&&4!=e.CallType&&(e.isModifier?n.Header.Contains("Product")&&(i.Header="Modifier Product"):n.Header.Contains("Product")&&(i.Header=i.Header.Replace("Product","KIT")),e.mappingdvColumns.length>0&&(e.mappingdv=e.mappingdvTable.filter((function(e){return e.CostCenterColIDField==n.ID}))),e.mappingdv.length>0&&!o.e.IsEmpty(e.mappingdv[0].Show)&&Object(l.j)(e.mappingdv[0].Show)?(a.IsVisible=!0,i.IsVisible=!0):(a.IsVisible=!1,i.IsVisible=!1),e.mappingdv.length>0&&!o.e.IsEmpty(e.mappingdv[0].ListTypeID)&&parseInt(e.mappingdv[0].ListTypeID)>0&&(a.TypeID=parseInt(e.mappingdv[0].ListTypeID)),e.isModifier?a.ReadOnly="ModSelect"!=a.DisplayMember&&"Quantity"!=a.DisplayMember:!e.isKit||"Quantity"!=a.DisplayMember&&"ProductID_Key"!=a.ValueMember||(a.ReadOnly=!0));e.ColumnSource.push(a),e.FooterColumnSource.push(i)},i=0;i<this.Parent.ScreenObject.ColumnSource.length;i++)a(i);this.FooterGridDataObj.addEmptyRow()}},{key:"OnButtonClick",value:function(e){var t=this;if(this.GridDataObj.angularGrid&&(this.GridDataObj.angularGrid.resizerService.resizeGrid(),this.GridDataObj.refreshDataView(),this.GridDataObj.RefreshColumns()),"Cancel"==e)this.isModifier&&null!=this.drSel&&""==o.e.String(this.drSel.ExtraXML)&&(this.Parent.ClearDatarow(this.drSel,!0),this.Parent.ScreenObject.GridDataObj.refreshDatawithIDs()),s.a.page.HideDialog();else if("Generate"==e){var n=this.CCList.length;this.stkID=new Array(n),this.stkName=new Array(n),this.CCList.length>0&&this.CallRecursive(0)}else if("AddRows"==e){var a,i=0;if(o.e.IsNum(this.AddRows.Text)){i=o.e.Int(this.AddRows.Text);for(var r=0;r<i;r++){a=this.Parent.GetEmptyRowPosition(this.GridDataObj,"ProductID_Key");for(var c=0;c<this.GridDataColumns.length;c++)"ModSelect"!=this.GridDataColumns[c]&&"ModifierName"!=this.GridDataColumns[c]&&"MinSelect"!=this.GridDataColumns[c]&&"MaxSelect"!=this.GridDataColumns[c]&&"ExtraXML"!=this.GridDataColumns[c]&&"DocDetailsID"!=this.GridDataColumns[c]&&(this.GridData[a][this.GridDataColumns[c]]=this.FooterGridData[0][this.GridDataColumns[c]]);this.GridDataObj.updateRow(this.GridData[a])}this.FillEmptyRows()}}else if("OK"==e||"AutoSave"==e){if(this.isModifier&&this.GridData.length>0){var u=this.GridData;if(null!=u)for(var d=0,D=0,h=0,S=0;S<u.length;S++)if(!o.e.IsEmpty(u[S].ModifierName)){d=D=h=0,D=parseInt(u[S].MinSelect),h=parseInt(u[S].MaxSelect);for(var m=0;m<this.GridData.length;m++)o.e.String(this.GridData[m].ModifierName)==o.e.String(u[S].ModifierName)&&Object(l.j)(this.GridData[m].ModSelect)&&d++;if(d<D)return this.DisplayMessage="You should select atleast "+D+" for this Modifier : "+u[S].ModifierName.toString(),void(this.MessageVisibility=!0);if(d>h)return this.DisplayMessage="You should select only "+h+" for this Modifier : "+u[S].ModifierName.toString(),void(this.MessageVisibility=!0)}}if(2==this.CallType||3==this.CallType||4==this.CallType){for(var b=0,C=0,y=0;y<this.GridData.length;y++)o.e.IsEmpty(this.GridData[y].ProductID_Key)||o.e.IsEmpty(this.GridData[y].Quantity)||(b+=parseFloat(this.GridData[y].Quantity));if(2==this.CallType&&this.FooterGridData.length>0&&!o.e.IsEmpty(this.FooterGridData[0].Quantity)&&parseFloat(this.FooterGridData[0].Quantity).ToString("N2")!=b.ToString("N2"))return this.DisplayMessage="Qty not equal",void(this.MessageVisibility=!0);var p=null;b=0;for(var g=0;g<this.GridData.length;g++)if(!o.e.IsEmpty(this.GridData[g].ProductID_Key)){var f=void 0;0==b?(f=this.drSel,"5"!=o.e.String(f.Type)||o.e.IsEmpty(f.ExtraXML)||((p=new o.f).LoadXml(f.ExtraXML),p.DocumentElement.children.length>0&&p.DocumentElement.children.length>0&&null!=p.DocumentElement.children[0].attributes.Quantity&&!o.e.IsEmpty(p.DocumentElement.children[0].attributes.Quantity.Value)&&(C=parseFloat(p.DocumentElement.children[0].attributes.Quantity.Value)))):(f=this.Parent.ScreenObject.GridDataObj.NewRow(),this.Parent.ScreenObject.GridDataObj.insertRowAt(f,this.Parent.ScreenObject.SelectedGridRowIndex+b));for(var O=0;O<this.GridDataColumns.length;O++)"ExtraXML"!=this.GridDataColumns[O]&&"DocSeqNo"!=this.GridDataColumns[O]&&"DocDetailsID"!=this.GridDataColumns[O]&&(f[this.GridDataColumns[O]]=this.GridData[g][this.GridDataColumns[O]]);C>0&&null!=p&&!o.e.IsEmpty(f.Quantity)&&(p.DocumentElement.children[0].attributes.Quantity.Value=f.Quantity.toString(),f.ExtraXML=p.getNodeData(p.DocumentElement),C-=parseFloat(f.Quantity)),b++}this.Parent.ScreenObject.UpdateSequence(),this.Parent.ScreenObject.GridDataObj.Update()}else if(this.Parent.ScreenObject.Preferences.ContainsKey("SplitKit")&&"true"==o.e.String(this.Parent.ScreenObject.Preferences.SplitKit).toLowerCase()){this.Parent.ScreenObject.ColumnSource.filter((function(e){return null!=e.ValueMember&&"productid_key"==e.ValueMember.toString().toLowerCase()})).forEach((function(e){t.Parent.ScreenObject.Data.Tables[0].filter((function(t){return null!=t.LocalReference&&t.LocalReference==e.ID})).length>0&&""!=e.ValueMember&&!o.e.IsEmpty(t.FooterGridData[0][e.ValueMember])&&t.Parent.ScreenObject.GetLinkReferenceData(parseInt(e.ID),t.Parent.DocumentID,parseInt(t.FooterGridData[0][e.ValueMember]),Date.Today(),"",e.CostCenterID,t.FooterGridData[0],null,!1)})),this.Parent.ScreenObject.Data.Tables[15].length>0&&this.ColumnSource.forEach((function(e){var n=t.Parent.ScreenObject.Data.Tables[15].filter((function(t){return 0!=t.CostCenterColIDMapping&&t.CostCenterColIDMapping==e.ID}));if(n.length>0&&t.GridDataColumns.Contains(n[0].SysColumnName.toString())&&(t.FooterGridDataColumns.Contains(e.DisplayMember)&&!o.e.IsEmpty(t.FooterGridData[0][e.DisplayMember])||"combobox"==e.DataType.toLowerCase()&&!o.e.IsEmpty(t.FooterGridData[0][e.ValueBinding])))for(var a=0;a<t.GridData.length;a++)o.e.IsEmpty(t.GridData[a].ProductID_Key)||("combobox"==e.DataType.toLowerCase()?t.GridData[a][n[0].SysColumnName.toString()]=t.FooterGridData[0][e.ValueBinding].toString():t.GridData[a][n[0].SysColumnName.toString()]=t.FooterGridData[0][e.DisplayMember].toString(),t.GridDataColumns.Contains(n[0].SysColumnName.toString()+"_Key")&&t.FooterGridDataColumns.Contains(e.DisplayMember+"_Key")&&(t.GridData[a][n[0].SysColumnName.toString()+"_Key"]=t.FooterGridData[0][e.DisplayMember+"_Key"].toString()))}));for(var I=0,T=-1,j=0;j<this.GridData.length;j++)if(!o.e.IsEmpty(this.GridData[j].ProductID_Key)){var P=void 0;1==++I?P=this.drSel:(-1==T&&(T=this.Parent.ScreenObject.GridData.indexOf(this.drSel)),T++,P=this.Parent.ScreenObject.GridDataObj.NewRow(),this.Parent.ScreenObject.GridDataObj.insertRowAt(P,T));for(var A=0;A<this.GridDataColumns.length;A++)"ExtraXML"!=this.GridDataColumns[A]&&"DocSeqNo"!=this.GridDataColumns[A]&&"DocDetailsID"!=this.GridDataColumns[A]&&(P[this.GridDataColumns[A]]=this.GridData[j][this.GridDataColumns[A]])}this.Parent.CalculateTotals(null,!1),I>1&&this.Parent.ScreenObject.UpdateSequence(),this.Parent.res="Yes"}else if(!this.FillXml(!0))return;"AutoSave"!=e&&s.a.page.HideDialog()}}},{key:"LoadLinkData",value:function(e,t,n){if(1!=e.Tables.length||!e.Columns[0].Contains("ErrorMessage")){for(var a,i=0,r=0;r<e.Tables[0].length;r++)if((!(t.length>0)||t.Contains(parseInt(e.Tables[0][r].DocDetailsID)))&&(!e.Columns[0].Contains("DynamicInvDocDetailsID")||o.e.IsEmpty(e.Tables[0][r].DynamicInvDocDetailsID)||!o.e.IsValidID(parseInt(e.Tables[0][r].DynamicInvDocDetailsID)))){a=this.GridDataObj.NewRow();for(var s=0,c=0;s<this.ColumnSource.length;s++,c++)"DocDetailsID"!=this.ColumnSource[s].DisplayMember&&"RefNo"!=this.ColumnSource[s].DisplayMember&&"LinkedFieldName"!=this.ColumnSource[s].DisplayMember&&this.Parent.ScreenObject.SetLinkValues(e,this.ColumnSource[s],r,a,null,"");a.LinkedInvDocDetailsID=e.Tables[0][r].DocDetailsID.toString(),a.RefNo=e.Tables[0][r].VoucherNo.toString(),a.LinkedFieldName=e.Tables[0][r][1].toString(),a[e.Tables[0][r][1].toString()]=e.Tables[0][r][0].toString(),this.Parent.ScreenObject.Preferences.ContainsKey("DisableQtyCheck")&&Object(l.j)(this.Parent.ScreenObject.Preferences.DisableQtyCheck)&&(a.defaultQuantity=a.Quantity),e.Columns[0].Contains("ProductTypeID")&&(a.Type=e.Tables[0][r].ProductTypeID.toString(),e.Columns[0].Contains("UOMConversion")?(a.UOMConversion=e.Tables[0][r].UOMConversion.toString(),a.UOMConvertedQty=o.e.IsEmpty(e.Tables[0][r].UOMConversion)?a.Quantity:parseFloat(a.Quantity)*parseFloat(e.Tables[0][r].UOMConversion)):(a.UOMConversion=1,a.UOMConvertedQty=a.Quantity)),this.GridDataObj.insertRowAt(a,n+i),i++,this.Parent.CalculateTotals(a,!1)}i>0&&this.GridDataObj.removeRowAt(n+i),0==t.length&&e.Tables[0].length>0&&(this.RefreshGrid=!0),i>0&&this.FillDynamicSetData(this.GridData[n+i-1])}}},{key:"GridData",get:function(){return this.GridDataObj.Table}},{key:"GridDataColumns",get:function(){return this.GridDataObj.TableColumns}},{key:"ColumnSource",get:function(){return this.GridDataObj.Columns}},{key:"SelectedRow",get:function(){return this.GridDataObj.SelectedItem},set:function(e){this.GridDataObj.SelectedItem=e}},{key:"FooterGridData",get:function(){return this.FooterGridDataObj.Table}},{key:"FooterGridDataColumns",get:function(){return this.FooterGridDataObj.TableColumns}},{key:"FooterColumnSource",get:function(){return this.FooterGridDataObj.Columns}},{key:"RefreshGrid",set:function(e){}},{key:"UpdateFooter",set:function(e){}}]),n}(u.b),le=n("6l4u"),ue=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,a){var i,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;_classCallCheck(this,n),(i=t.call(this)).BOEAdjSummary="",i.BOEAdjSummaryVisibility=!1,i.chkkBOEAdjustFIFOVisibility=!1,i.BOEAdjustFIFOObj=new b.a,i.GridDataObj=new V.a,i.GridMaxWidth=200,i.LoadDataVisibile=!1,i.CustomizeVisible=!1,i.FooterCalcValue=null,i.FooterName=null,i.FooterValue=null,i.QtyType=0,i.AutoAdjustVisibility=!1,i.ImportBtnVisibility=!1,i.ImportScrVisibility=!1,i.Parent=null,i.TotalQoh=0,i.Wt=0,i.Vol=0,i.flds=[],i.strFldsList=new c.a,i.FooterfldID=0,i.Footerfld="",i.Query="",i.Dims="",i.PackWise=!1,i.IsSingleProd=!1,i.drEdit=null,i.dtBins=null,i.dsusedbins=new o.f,i.SelectedRowEditing=!1,i.ExcelTable=[],i.ActualFileName="",i.RimFileName="",i.DtImport=[],i.ImportCols=[],i.GridDataObj.Table=[],i.GridDataObj.CanUserDeleteRows=!1,i.GridDataObj.CanUserAddRows=!1,i.Parent=e,i.QtyType=a,i.GridDataObj.BeginEdit.Subscribe(_assertThisInitialized(i),"OnBeginedit"),i.GridDataObj.CellEditEnding.Subscribe(_assertThisInitialized(i),"oncelleditend"),i.GridDataObj.DoubleClick.Subscribe(_assertThisInitialized(i),"onDoubleClick"),2!=i.QtyType&&(i.chkkBOEAdjustFIFOVisibility=!1,i.BOEAdjustFIFOObj.IsChecked=!1,i.BOEAdjSummaryVisibility=!1,i.BOEAdjSummary=""),6==i.QtyType&&(i.QtyType=3,i.IsSingleProd=!0),3==i.QtyType&&(i.Parent.ScreenObject.Preferences.ContainsKey("PackWiseProds")&&"true"==i.Parent.ScreenObject.Preferences.PackWiseProds.toLowerCase()||i.Parent.ScreenObject.Preferences.ContainsKey("LineWisePacking")&&"true"==i.Parent.ScreenObject.Preferences.LineWisePacking.toLowerCase())&&(i.PackWise=!0),i.TextFields=[],5==i.QtyType&&function(){i.Title="Customize";var e=s.a.SessionManager.ListViewDef.Tables[0].filter((function(e){return 3==e.CostCenterID})),t=new m.e;t.Label="Product Listview",t.Column=0,t.Row=0;for(var n=function(n){t.Items.find((function(t){return t.Value==e[n].ListViewTypeID.toString()}))||t.Items.push(m.d.ComboBoxItems_2(e[n].LISTVIEWNAME.toString(),e[n].ListViewTypeID.toString()))},a=0;a<e.length;a++)n(a);i.TextFields.push(t)}(),i.InitGrid();var u=null;if(1==i.QtyType)i.Title=s.a.SessionManager.Preferences.QtyAdjustmentTitle,i.GridDataObj.CanUserAddRows=!0,i.Parent.ScreenObject.Preferences.ContainsKey("QtyAdjust-AutoAdjust")&&"true"==i.Parent.ScreenObject.Preferences["QtyAdjust-AutoAdjust"].toString().toLowerCase()&&(i.AutoAdjustVisibility=!0),i.Parent.ScreenObject.Preferences.ContainsKey("QtyAdjust-Import")&&"true"==i.Parent.ScreenObject.Preferences["QtyAdjust-Import"].toString().toLowerCase()&&(i.ImportBtnVisibility=!0);else if(0==i.QtyType){if(i.Title="Field calculator",o.e.IsType(e,"AddEditDocumentViewModel")){var d=i.Parent.ScreenObject.ColumnSource,S=i.Parent.ScreenObject.Preferences.FieldCalculatorTextFields;if(u=i.Parent.SelectedRow,S.length>0){var y=0,p=new o.f;p.LoadXml(S);for(var O=function(e){var t=p.DocumentElement.children[e],n=d.find((function(e){return e.ID==t.attributes.CostCenterColID.value}));if(n){var a=new h.d;a.Label=n.Header,i.Parent.ScreenObject.GridDataColumns.Contains(n.DisplayMember)?a.Text=o.e.String(u[n.DisplayMember]):i.Parent.ScreenObject.GridDataColumns.Contains(n.ValueBinding)&&(a.Text=o.e.String(u[n.ValueBinding])),a.Column=y%2,1==a.Column&&(a.Column=3),a.ColumnSpan=2,a.Row=y/2,a.IsReadOnly=!0,i.TextFields.push(a),y++}},I=0;I<p.DocumentElement.children.length;I++)O(I)}}else if(e instanceof ce){u=i.Parent.SelectedRow;var T=new h.d;T.Label="Product Code",T.Column=0,T.Row=0,T.ColumnSpan=2,T.IsReadOnly=!0,T.Text=o.e.String(u.Productcode),i.TextFields.push(T),(T=new h.d).Label="Product Name",T.Column=3,T.Row=0,T.ColumnSpan=2,T.IsReadOnly=!0,T.Text=o.e.String(u.ProductName),i.TextFields.push(T)}var j=!1;(o.e.IsType(i.Parent,"AddEditDocumentViewModel")&&i.Parent.ScreenObject.Preferences.ContainsKey("CalcFieldsDynamic")&&Object(l.j)(i.Parent.ScreenObject.Preferences.CalcFieldsDynamic)||i.Parent instanceof ce&&i.Parent.Parent.ScreenObject.Preferences.ContainsKey("CalcFieldsDynamic")&&Object(l.j)(i.Parent.Parent.ScreenObject.Preferences.CalcFieldsDynamic))&&(j=!0),o.e.IsType(i.Parent,"AddEditDocumentViewModel")&&i.Parent.ScreenObject.Preferences.ContainsKey("CalcFooterField")&&""!=i.Parent.ScreenObject.Preferences.CalcFooterField&&parseInt(i.Parent.ScreenObject.Preferences.CalcFooterField)>0?i.FooterfldID=parseInt(i.Parent.ScreenObject.Preferences.CalcFooterField):i.Parent instanceof ce&&i.Parent.Parent.ScreenObject.Preferences.ContainsKey("CalcFooterField")&&""!=i.Parent.Parent.ScreenObject.Preferences.CalcFooterField&&parseInt(i.Parent.Parent.ScreenObject.Preferences.CalcFooterField)>0&&(i.FooterfldID=parseInt(i.Parent.Parent.ScreenObject.Preferences.CalcFooterField));var P=[],A=null,M=null;o.e.IsType(i.Parent,"AddEditDocumentViewModel")?(M=i.Parent.ScreenObject.ColumnSource,A=i.Parent.ScreenObject.GridDataColumns):i.Parent instanceof ce&&(M=i.Parent.Parent.ScreenObject.ColumnSource,A=i.Parent.Parent.ScreenObject.GridDataColumns),null!=M&&(P.push(m.d.ComboBoxItems_2("","")),M.forEach((function(e){if(e.ShowinCalc&&e.IsVisible){i.FooterfldID.toString()!=e.ID?P.push(m.d.ComboBoxItems_2(e.Header,e.DisplayMember)):i.FooterfldID.toString()==e.ID&&(i.Footerfld=e.DisplayMember,i.FooterName=e.Header),i.flds.push(e.DisplayMember);var t=i.GridDataObj.NewRow();t.Name=e.DisplayMember,0!=o.e.Double(u[e.DisplayMember])&&(t.Amount=u[e.DisplayMember]),A.Contains("dcCalc"+e.DisplayMember)?(t.CalcAmount=o.e.String(u["dcCalc"+e.DisplayMember]),i.flds.push("dcCalc"+e.DisplayMember)):t.CalcAmount=u[e.DisplayMember],j&&0==o.e.Double(t.Amount)||i.FooterfldID.toString()==e.ID||i.GridDataObj.addRow(t)}}))),i.ColumnSource[0].ComboData=P,j||(i.ColumnSource[0].DisableTab=i.ColumnSource[0].ReadOnly=!0),i.SetFocusongrid=!0}else if(2==i.QtyType||7==i.QtyType){i.Title="Bill of Entry",null==r&&(r=i.Parent.SelectedRow),i.Parent.ScreenObject.Preferences.ContainsKey("ShowBOE")&&"true"==i.Parent.ScreenObject.Preferences.ShowBOE.toLowerCase()&&(i.LoadDataVisibile=!0);var v=new h.d;if(v.Label="Scan",v.Column=0,v.Row=0,v.isSKU=!0,v.ColumnSpan=2,v.DBColumnName="SKU",v.TextChangedCommand.Subscribe(_assertThisInitialized(i),"Scan"),v.SetFocus=!0,i.TextFields.push(v),2==i.QtyType){i.chkkBOEAdjustFIFOVisibility=!0,i.BOEAdjustFIFOObj.IsChecked=!1,i.BOEAdjSummaryVisibility=!0,!o.e.IsEmpty(r.DocDetailsID)&&parseInt(r.DocDetailsID.toString())>0&&(i.SelectedRowEditing=!0);var G="",N="0";(v=new h.d).Label="Product",Object.keys(r).Contains("ProductName")?v.Text=o.e.String(r.ProductName):Object.keys(r).Contains("ProductCode")&&(v.Text=o.e.String(["ProductCode"])),v.Column=2,v.Row=0,i.TextFields.push(v),G=v.Text,(v=new h.d).Label="Qty",v.Text=i.getQty(r),v.Column=3,v.Row=0,v.IsReadOnly=!0,i.TextFields.push(v),N=v.Text,i.BOEAdjSummary="Qty. Adjusted  :  0  of  "+N+"  for the Product  :  "+G;var E="",w="",F="";if(i.Parent.ScreenObject.Preferences.ContainsKey("ClubBoe")&&"True"==i.Parent.ScreenObject.Preferences.ClubBoe&&!i.SelectedRowEditing)for(var L=0;L<i.Parent.ScreenObject.GridData.length;L++){var R;if(!(i.Parent.ScreenObject.GridData[L].ProductID_Key.toString()!=r.ProductID_Key.ToString()||o.e.Int(i.Parent.ScreenObject.GridData[L].DocDetailsID)>0||(o.e.IsEmpty(i.Parent.ScreenObject.GridData[L].LinkedInvDocDetailsID)||(""!=w&&(w+=","),w+=i.Parent.ScreenObject.GridData[L].LinkedInvDocDetailsID.toString()),o.e.IsEmpty(i.Parent.ScreenObject.GridData[L].DocExtraXML))))!function(){var e=new o.f;e.LoadXml(i.Parent.ScreenObject.GridData[L].DocExtraXML);for(var t=e.SelectNodes("DocExtraXML/Row"),n=function(e){var n=i.GridDataObj.NewRow();if(null!=t[e].attributes.RefID&&!o.e.IsEmpty(t[e].attributes.RefID.value)){if((R=i.GridData.filter((function(n){return n.RefID==t[e].attributes.RefID.value}))).length>0)return null==t[e].attributes.Qty||o.e.IsEmpty(t[e].attributes.Qty.value)||(R[0].Qty=parseFloat(R[0].Qty)+parseFloat(t[e].attributes.Qty.value)),"continue";n.RefID=t[e].attributes.RefID.value,""!=E&&(E+=","),E+=t[e].attributes.RefID.value}null==t[e].attributes.Qty||o.e.IsEmpty(t[e].attributes.Qty.value)||(n.Qty=t[e].attributes.Qty.value),n.Type=1,i.GridDataObj.addRow(n)},a=0;a<t.length;a++)n(a)}()}else{for(var B=0;B<i.Parent.ScreenObject.GridData.length;B++)i.Parent.ScreenObject.GridData[B]==r||o.e.IsEmpty(i.Parent.ScreenObject.GridData[B].DocExtraXML)||(F+=i.Parent.ScreenObject.GridData[B].DocExtraXML.toString());if(""!=F&&(F="<DocExtraXML>"+(F=F.replace("<DocExtraXML>","").replace("</DocExtraXML>",""))+"</DocExtraXML>",i.dsusedbins.ReadXml(F)),!o.e.IsEmpty(r.DocExtraXML)){var x=new o.f;x.LoadXml(r.DocExtraXML);for(var k=x.SelectNodes("DocExtraXML/Row"),_=0;_<k.length;_++){var K=i.GridDataObj.NewRow();null==k[_].attributes.RefID||o.e.IsEmpty(k[_].attributes.RefID.value)||(K.RefID=k[_].attributes.RefID.value,""!=E&&(E+=","),E+=k[_].attributes.RefID.value),null==k[_].attributes.Qty||o.e.IsEmpty(k[_].attributes.Qty.value)||(K.Qty=k[_].attributes.Qty.value),K.Type=1,i.GridDataObj.addRow(K)}}}i.Parent.ScreenObject.Preferences.ContainsKey("ShowBOE")&&"true"==i.Parent.ScreenObject.Preferences.ShowBOE.toLowerCase()?(null==r&&(r=i.Parent.SelectedRow),E=i.LoadBoes(E,r)):function(){var e="0";o.e.IsType(i.Parent,"AddEditDocumentViewModel")&&(null==r&&(r=i.Parent.SelectedRow),e=r.ProductID_Key.toString(),""==w&&(w=r.LinkedInvDocDetailsID.toString()));var t=i.Parent.ScreenObject.GetinvDetails("",E,e,"",w,i.SelectedRowEditing);if(null!=t&&t.Tables.length>0&&t.Tables[0].length>0)for(var n=function(e){var n=0;i.dsusedbins.Tables.length>0&&i.dsusedbins.Tables[0].filter((function(n){return n.RefID==t.Tables[0][e].InvDocDetailsID})).forEach((function(e){i.dsusedbins.Columns[0].Contains("Qty")&&!o.e.IsEmpty(e.Qty)&&(n+=parseFloat(e.Qty))}));var a=i.GridData.filter((function(n){return n.RefID==t.Tables[0][e].InvDocDetailsID}));a.length>0&&(o.e.IsEmpty(t.Tables[0][e].Qty)||(a[0].AvailQty=parseFloat(t.Tables[0][e].Qty)-n))},a=0;a<t.Tables[0].length;a++)n(a)}(),i.FillBoeData(E);var Q="2",H=i.ColumnSource.find((function(e){return"Qty"==e.DisplayMember}));null!=H&&(Q=H.DecimalPoints);var W=i.GridData.Compute("sum","Qty");null!=W&&""!=W.toString()&&0!=parseFloat(W.toString())||(W=0),i.BOEAdjSummary="Qty. Adjusted  :  "+parseFloat(W.toString()).ToString("N"+Q)+"  of  "+i.TextFields[2].Text+"  for the Product  :  "+i.TextFields[1].Text}}else if(3==i.QtyType){var U;if(null==i.Parent.DtPack&&(i.Parent.DtPack=[],i.Parent.DtPackColumns.push("ID"),i.Parent.DtPackColumns.push("Name"),i.Parent.DtPackColumns.push("Label"),i.Parent.DtPackColumns.push("cWeight"),i.Parent.DtPackColumns.push("cVolume"),i.Parent.DtPackColumns.push("Weight"),i.Parent.DtPackColumns.push("Volume"),i.Parent.DtPackColumns.push("Height"),i.Parent.DtPackColumns.push("length"),i.Parent.DtPackColumns.push("Width"),i.Parent.DtPackColumns.push("ActualWeight"),i.Parent.DtPackColumns.push("ActualVolume"),i.PackWise&&i.Parent.DtPackColumns.push("Data")),s.a.SessionManager.IsActionAssigned(43,"Customize Packing")&&(i.CustomizeVisible=!0),i.Title="Packing",!i.PackWise||i.IsSingleProd){(U=new h.d).Label="Product",i.Parent.ScreenObject.GridDataObj.TableColumns.Contains("ProductName")?U.Text=i.Parent.SelectedRow.ProductName.toString():i.Parent.ScreenObject.GridDataObj.TableColumns.Contains("ProductCode")&&(U.Text=i.Parent.SelectedRow.ProductCode.toString()),U.Column="0",U.Row="0",i.TextFields.push(U),(U=new h.d).Label="Qty",U.Text=i.Parent.SelectedRow.Quantity.toString(),U.Column="1",U.Row="0",i.TextFields.push(U);var X=i.Parent.ScreenObject.GetProdVWDetails(i.Parent.SelectedRow.ProductID_Key.toString());null!=X&&X.Tables.length>0&&X.Columns[0].Contains("Volume")&&X.Tables[0].length>0&&(o.e.IsEmpty(X.Tables[0][0].Volume)||(i.Vol=parseFloat(X.Tables[0][0].Volume)),o.e.IsEmpty(X.Tables[0][0].Weight)||(i.Wt=parseFloat(X.Tables[0][0].Weight)),i.Dims=X.Tables[0][0][X.Columns[0][0]].toString(),i.Dims.endsWith(",")&&(i.Dims=i.Dims.substr(0,i.Dims.length-1))),i.fillPack(i.Dims)}var q=new C.b;if(q.Label="Pack",q.Column=0,q.Row=1,q.CCID=parseInt(s.a.SessionManager.Preferences.PackDimension),q.TypeID=1,i.Dims.length>0&&(q.CustomWhere=" a.NodeID in("+i.Dims+")"),i.PackWise&&q.OnPactListBoxValueChanged.Subscribe(_assertThisInitialized(i),"onPackChanged"),i.Parent.ScreenObject.Preferences.ContainsKey("DefaultPack")&&!o.e.IsEmpty(i.Parent.ScreenObject.Preferences.DefaultPack)&&"0"!=i.Parent.ScreenObject.Preferences.DefaultPack&&(q.SelectedValue=parseInt(i.Parent.ScreenObject.Preferences.DefaultPack),q.DefaultValue=i.Parent.ScreenObject.Preferences.DefaultPack),i.TextFields.push(q),(U=new h.d).Label="Label",U.Column="1",U.Row="1",i.PackWise&&U.TextChangedCommand.Subscribe(_assertThisInitialized(i),"LabelScan"),i.TextFields.push(U),i.Parent.ScreenObject.Preferences.ContainsKey("DefaultLabel")&&!o.e.IsEmpty(i.Parent.ScreenObject.Preferences.DefaultLabel)&&(U.Text=U.DefaultValue=i.Parent.ScreenObject.Preferences.DefaultLabel),i.PackWise&&!i.IsSingleProd){var Y,z,J=function(){(U=new h.d).Label="Weight",U.Column="2",U.Row="1",i.TextFields.push(U),(U=new h.d).Label="Length",U.Column="0",U.Row="2",U.TextChangedCommand.Subscribe(_assertThisInitialized(i),"onTextChanged"),i.TextFields.push(U),(U=new h.d).Label="Width",U.Column="1",U.Row="2",U.TextChangedCommand.Subscribe(_assertThisInitialized(i),"onTextChanged"),i.TextFields.push(U),(U=new h.d).Label="Height",U.Column="2",U.Row="2",U.TextChangedCommand.Subscribe(_assertThisInitialized(i),"onTextChanged"),i.TextFields.push(U),(U=new h.d).Label="Volume",U.Column="3",U.Row="1",i.TextFields.push(U),(Y=i.ColumnSource.find((function(e){return"ActualVolume"==e.DisplayMember})))&&(U.IsReadOnly=Y.ReadOnly,U.IsReadOnly&&(U.IsTabStop=!1),U.Visible=Y.IsVisible),i.Parent.ScreenObject.Preferences.ContainsKey("PackMandScan")&&"true"==i.Parent.ScreenObject.Preferences.PackMandScan.toLowerCase()?((U=new h.d).Label="Scan Product",U.Column="0",U.Row="3",U.ColumnSpan="2",U.TextChangedCommand.Subscribe(_assertThisInitialized(i),"PackProductScan"),U.SetFocus=!0,i.TextFields.push(U)):((q=new C.b).Label="Product",q.Column=0,q.Row=3,q.ColumnSpan=2,q.CCID=3,q.TypeID=""!=i.Footerfld?parseInt(i.Footerfld):100,q.SelectionChangedCommand.Subscribe(_assertThisInitialized(i),"PackProductScan"),q.SelectedValue=-1,i.TextFields.push(q));var e=new g.a;e.Label="Qty",e.Column=2,e.Row=3,e.onGetData.Subscribe(_assertThisInitialized(i),"PackProductScan"),i.Parent.ScreenObject.Preferences.ContainsKey("PackMandScan")&&"true"==i.Parent.ScreenObject.Preferences.PackMandScan.toLowerCase()&&(e.Visible=!1),i.TextFields.push(e);var t=new m.e;t.Label="Option",t.Column=3,t.Row=2,t.SelectionChangedCommand.Subscribe(_assertThisInitialized(i),"SelectionChange"),t.Items.push(m.d.ComboBoxItems_2("Show Selected","1")),t.Items.push(m.d.ComboBoxItems_2("ShowAll","2")),t.Items.push(m.d.ComboBoxItems_2("To be Packed","3")),t.SelectedValue="1",i.TextFields.push(t);var n=new V.a;n.Columns=[],n.Width="",n.Height=200;var a=new f.a;a.Header="Code",a.DisplayMember="Code",a.ReadOnly=!0,a.Width=200,a.DisableTab=!0,n.Columns.push(a),(a=new f.a).Header="Name",a.DisplayMember="Name",a.ReadOnly=!0,a.Width=200,a.DisableTab=!0,n.Columns.push(a),(a=new f.a).Header="Qty",a.DisplayMember="Qty",a.ReadOnly=!0,a.DataType="FLOAT",a.Width=100,a.DisableTab=!0,n.Columns.push(a),(a=new f.a).Header="Already",a.DisplayMember="Already",a.ReadOnly=!0,a.Width=100,a.DataType="FLOAT",a.DisableTab=!0,n.Columns.push(a),(a=new f.a).Header="Packed",a.DisplayMember="Packed",a.Width=100,a.DataType="FLOAT",n.Columns.push(a),(a=new f.a).Header="Bal",a.DisplayMember="Bal",a.ReadOnly=!0,a.Width=100,a.DataType="FLOAT",a.DisableTab=!0,n.Columns.push(a),n.Table=[],n.TableColumns.push("Code"),n.TableColumns.push("ProductID"),n.TableColumns.push("Name"),n.TableColumns.push("Qty"),n.TableColumns.push("Already"),n.TableColumns.push("Packed"),n.TableColumns.push("Bal"),n.TableColumns.push("Unq"),n.TableColumns.push("Volume"),n.TableColumns.push("Weight"),n.Column=0,n.Row=4,n.ColumnSpan=4,n.CellEditEnding.Subscribe(_assertThisInitialized(i),"OnGridCellEditEnding"),n.SearchVisible=!0,n.AddSearchCols(),i.TextFields.push(n),i.Parent.ScreenObject.GridDataColumns.Contains("Unq")||i.Parent.ScreenObject.GridDataColumns.push("Unq"),Z=null!=(Z=i.Parent.ScreenObject.GridData.Compute("max","Unq"))?parseInt(Z)+1:0;var r="",c=null;if(i.Parent.ScreenObject.Preferences.ContainsKey("LineWisePacking")&&"true"==i.Parent.ScreenObject.Preferences.LineWisePacking.toLowerCase()){if(!i.Parent.ScreenObject.Preferences.ContainsKey("PackLabel")||""==i.Parent.ScreenObject.Preferences.PackLabel)return{v:_possibleConstructorReturn(i,void(i.DisplayMessage="Define pack label field"))};if(!(c=i.Parent.ScreenObject.ColumnSource.find((function(e){return e.ID==i.Parent.ScreenObject.Preferences.PackLabel}))))return{v:_possibleConstructorReturn(i,void(i.DisplayMessage="Define pack label field linewise"))};if(r=c.DisplayMember,!(c=i.Parent.ScreenObject.ColumnSource.find((function(e){return e.CostCenterID==parseInt(s.a.SessionManager.Preferences.PackDimension)}))))return{v:_possibleConstructorReturn(i,void(i.DisplayMessage="Define Pack Dimension linewise"))}}for(var l="",u=0;u<i.Parent.ScreenObject.GridData.length;u++)if(!o.e.IsEmpty(i.Parent.ScreenObject.GridData[u].ProductId_Key)&&"true"==i.Parent.ScreenObject.GridData[u].PackType.toString().toLowerCase()){var d=n.NewRow();if(d.ProductID=i.Parent.ScreenObject.GridData[u].ProductId_Key.toString(),i.Parent.ScreenObject.GridDataObj.TableColumns.Contains("ProductCode")&&(d.Code=i.Parent.ScreenObject.GridData[u].ProductCode.toString()),i.Parent.ScreenObject.GridDataObj.TableColumns.Contains("ProductName")&&(d.Name=i.Parent.ScreenObject.GridData[u].ProductName.toString()),d.Qty=i.Parent.ScreenObject.GridData[u].Quantity.toString(),d.Already=0,d.Packed=0,d.Bal=d.Qty,o.e.IsEmpty(i.Parent.ScreenObject.GridData[u].Unq)&&(i.Parent.ScreenObject.GridData[u].Unq=Z,Z=parseInt(Z)+1),d.Unq=i.Parent.ScreenObject.GridData[u].Unq.toString(),""!=r&&!i.FillDtPack(i.Parent.ScreenObject.GridData[u],r,c,d))return{v:_possibleConstructorReturn(i,void(i.DisplayMessage="check pack at row no:"+i.Parent.ScreenObject.GridData[u].DocSeqNo))};n.addRow(d),""!=l&&(l+=","),l+=d.ProductID.toString()}if(3==q.CCID&&(q.CustomWhere=l.length>0?" a.ProductID in ("+l+")":" 1<>1 "),l.length>0){var D=i.Parent.ScreenObject.GetProdVWDetails(l);if(null!=D&&D.Tables.length>0&&D.Columns[0].Contains("Volume")&&D.Tables[0].length>0)for(var S=function(e){(z=D.Tables[0].filter((function(t){return t.ProductID==n.Table[e].ProductID}))).length>0&&(o.e.IsEmpty(z[0].Volume)||(n.Table[e].Volume=parseFloat(z[0].Volume)),o.e.IsEmpty(z[0].Weight)||(n.Table[e].Weight=parseFloat(z[0].Weight)))},b=0;b<n.Table.length;b++)S(b)}}();if("object"==typeof J)return J.v}else(U=new h.d).Label="Qty",U.Column="2",U.Row="1",U.DataType="FLOAT",i.Parent.ScreenObject.Preferences.ContainsKey("PackQty")&&""!=i.Parent.ScreenObject.Preferences.PackQty&&null!=i.Parent.SelectedRow&&i.Parent.ScreenObject.GridDataColumns.Contains(i.Parent.ScreenObject.Preferences.PackQty)&&!o.e.IsEmpty(i.Parent.SelectedRow[i.Parent.ScreenObject.Preferences.PackQty])&&(U.Text=i.Parent.SelectedRow[i.Parent.ScreenObject.Preferences.PackQty].toString()),i.TextFields.push(U);var Z,$=new D.a;i.PackWise&&!i.IsSingleProd?($.Enable=!0,$.Row=5,$.Column=3,$.Visible=!1,$.Label="Add Pack"):(i.Parent.ScreenObject.Preferences.ContainsKey("PackQty")&&""!=i.Parent.ScreenObject.Preferences.PackQty&&null!=i.Parent.SelectedRow&&i.Parent.ScreenObject.GridDataColumns.Contains(i.Parent.ScreenObject.Preferences.PackQty)&&($.Label="Pack All Products",$.Visible=!1,$.Enable=!0,$.Row=1,$.Column=3,$.ClickCommand.Subscribe(_assertThisInitialized(i),"OnAddmultipleProd"),i.TextFields.push($),$=new D.a),$.Label="Add",$.Visible=!0,$.Enable=!1,$.Row=1,$.Column=3),$.ClickCommand.Subscribe(_assertThisInitialized(i),"OnAdd"),i.TextFields.push($),(i.Dims.length>0?i.Parent.DtPack.filter((function(e){return i.Dims.split(",").Contains(e.ID)})):i.Parent.DtPack).forEach((function(e){var t=i.GridDataObj.NewRow();if(t.RefID=e.ID,t.Name=e.Name,t.Label=e.Label,t.UsedWeight=e.cWeight,t.UsedVolume=e.cVolume,t.cWeight=e.cWeight,t.cVolume=e.cVolume,t.Weight=e.Weight,t.Volume=e.Volume,t.Type=2,t.Height=e.Height,t.length=e.length,t.Width=e.Width,i.PackWise&&(t.Data=e.Data,t.ActualWeight=e.ActualWeight,t.ActualVolume=e.ActualVolume,!i.IsSingleProd))for(var n=t.Data.toString().split(","),a=function(e){var t=n[e].split("~"),a=i.TextFields[10].Table.filter((function(e){return e.Unq==t[0]}));if(a.length>0){var r=o.e.DoubleTryParse(a[0].Qty);a[0].Already=o.e.IsEmpty(a[0].Already)?t[1]:parseFloat(a[0].Already)+parseFloat(t[1]),r-=parseFloat(a[0].Already),a[0].Bal=r}},r=0;r<n.length;r++)a(r);i.GridDataObj.addRow(t)})),i.PackWise&&i.IsSingleProd&&(i.Parent.ScreenObject.GridDataColumns.Contains("Unq")||i.Parent.ScreenObject.GridDataColumns.push("Unq"),o.e.IsEmpty(i.Parent.SelectedRow.Unq)&&(Z=null!=(Z=i.Parent.ScreenObject.GridData.Compute("max","Unq"))?parseInt(Z)+1:0,i.Parent.SelectedRow.Unq=Z)),i.PackWise&&!i.IsSingleProd||o.e.IsEmpty(i.Parent.SelectedRow.PackXML)||function(){var e=new o.f;e.LoadXml(i.Parent.SelectedRow.PackXML);for(var t=e.SelectNodes("DocExtraXML/Row"),n=function(e){if(null!=t[e].attributes.Label&&!o.e.IsEmpty(t[e].attributes.Label.value)&&null!=t[e].attributes.RefID&&!o.e.IsEmpty(t[e].attributes.RefID.value)){var n=i.GridData.filter((function(n){return n.RefID==t[e].attributes.RefID.value&&n.Label==t[e].attributes.Label.value}));if(n.length>0&&null!=t[e].attributes.Qty&&!o.e.IsEmpty(t[e].attributes.Qty.value)){var a=0;n[0].Qty=t[e].attributes.Qty.value,null==t[e].attributes.Fld1||o.e.IsEmpty(t[e].attributes.Fld1.value)||""==t[e].attributes.Fld1.value||(n[0].length=t[e].attributes.Fld1.value),null==t[e].attributes.Fld2||o.e.IsEmpty(t[e].attributes.Fld2.value)||""==t[e].attributes.Fld2.value||(n[0].Width=t[e].attributes.Fld2.value),null==t[e].attributes.Fld3||o.e.IsEmpty(t[e].attributes.Fld3.value)||""==t[e].attributes.Fld3.value||(n[0].Height=t[e].attributes.Fld3.value),null==t[e].attributes.Fld4||o.e.IsEmpty(t[e].attributes.Fld4.value)||""==t[e].attributes.Fld4.value||(n[0].ActualWeight=t[e].attributes.Fld4.value),null==t[e].attributes.Fld5||o.e.IsEmpty(t[e].attributes.Fld5.value)||""==t[e].attributes.Fld5.value||(n[0].ActualVolume=t[e].attributes.Fld5.value),n[0].pWeight=a=parseFloat(n[0].Qty)*i.Wt,o.e.IsEmpty(n[0].UsedWeight)||(n[0].UsedWeight=parseFloat(n[0].UsedWeight)-a),n[0].pVolume=a=parseFloat(n[0].Qty)*i.Vol,o.e.IsEmpty(n[0].UsedVolume)||(n[0].UsedVolume=parseFloat(n[0].UsedVolume)-a)}}},a=0;a<t.length;a++)n(a)}()}else if(4==i.QtyType){var ee,te;!function(){i.Title="Quality  Check";var e=new h.d;if(e.Label="Product",i.Parent.ScreenObject.GridDataObj.TableColumns.Contains("ProductName")?e.Text=i.Parent.SelectedRow.ProductName.toString():i.Parent.ScreenObject.GridDataObj.TableColumns.Contains("ProductCode")&&(e.Text=i.Parent.SelectedRow.ProductCode.toString()),e.Column=0,e.Row=0,i.TextFields.push(e),(e=new h.d).Label="Observations",e.Column=1,e.Row=0,e.DBColumnName="SKU",e.TextChangedCommand.Subscribe(_assertThisInitialized(i),"OnIterationChanged"),i.TextFields.push(e),(ee=i.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&55854==e.LinkData}))).length>0&&i.Parent.ScreenObject.GridDataColumns.Contains(ee[0].SysColumnName.toString())){var t=new m.h;t.Label="Status",t.Column=2,t.Row=0,t.DBColumnName=ee[0].SysColumnName.toString(),t.Items.push(m.d.ComboBoxItems_2("Not Tested","Not Tested")),t.Items.push(m.d.ComboBoxItems_2("Partial","Partial")),t.Items.push(m.d.ComboBoxItems_2("Failed","Failed")),t.Items.push(m.d.ComboBoxItems_2("Passed","Passed"));var n=i.Parent.SelectedRow[ee[0].SysColumnName.toString()].toString();"Not Tested"!=n&&"Partial"!=n&&"Failed"!=n&&"Passed"!=n&&t.Items.push(m.d.ComboBoxItems_2(n,n)),t.SelectedValue=n,i.TextFields.push(t)}var a=new o.f;o.e.IsEmpty(i.Parent.SelectedRow.TestCaseXML)||a.ReadXml(i.Parent.SelectedRow.TestCaseXML);var r=0;if(a.Tables.length>0)for(var c,l=0;l<a.Columns[0].length;l++)a.Columns[0][l].Contains("Fld")&&((c=o.e.IntTryParse(a.Columns[0][l].replace("Fld","")))>r&&(r=c));var u=i.Parent.ScreenObject.GetProdTestCaseDetails(i.Parent.SelectedRow.ProductID_Key.toString());if(null!=u&&u.Tables.length>0&&u.Columns[0].Contains("TestCaseID")&&u.Tables[0].length>0){null!=(te=u.Tables[0].Compute("max","Iteration"))&&parseFloat(te)>r&&(r=parseFloat(te)),0==r&&(r=1),i.TextFields[1].Text=r.toString(),i.OnIterationChanged(null,null);var d=1;o.e.IsEmpty(i.Parent.SelectedRow.Quantity)||(d=parseFloat(i.Parent.SelectedRow.Quantity));for(var D=0,S=0,b=function(e){var t=void 0,n=u.Tables[0].filter((function(t){return t.TestCaseID==u.Tables[0][e].ParentID}));"1"==(t=n.length>0?n[0]:u.Tables[0][e]).SampleType.toString()?(S=1,(D=o.e.DoubleTryParse(t.sample))>1&&d<D&&(D=d)):"3"==t.SampleType.toString()?(S=1,(D=o.e.DoubleTryParse(t.sample))>1&&(D=d*D/100)):(D=1,S=o.e.DoubleTryParse(t.sample),"2"==t.SampleType.toString()&&(S=d*S/100));for(var c=function(n){var c=i.GridDataObj.NewRow();if(c.RefID=u.Tables[0][e].TestCaseID.toString(),c.Name="false"==u.Tables[0][e].IsGroup.toString().toLowerCase()?"  "+u.Tables[0][e].Name.toString():u.Tables[0][e].Name.toString(),c.Min=t.Min.toString(),c.Max=t.Max.toString(),c.TestType=t.TestType.toString(),c.ProbableValues=t.ProbableValues.toString(),!o.e.IsEmpty(t.ProbableValues)&&t.ProbableValues.toString().split(";").length>1&&(c.MultiColTYPE="COMBOBOX"),c.Variance=t.Variance.toString(),c.SampleType=t.SampleType.toString(),c.Sample=t.sample.toString(),c.Retest=t.RetestDays.toString(),c.Samplesize=S,c.SampleNo=n+1,c.Unit_Key=i.Parent.SelectedRow.Unit_Key.toString(),a.Tables.length>0){var l=a.Tables[0].filter((function(e){return e.RefID==c.RefID&&e.Qty==n+1}));if(l.length>0){s.a.SessionManager.Preferences.ContainsKey("QCLabNameDimension")&&""!=s.a.SessionManager.Preferences.QCLabNameDimension.toString()&&0!=parseInt(s.a.SessionManager.Preferences.QCLabNameDimension)&&(a.Columns[0].Contains("LabID")&&(c.LabName_Key=l[0].LabID),a.Columns[0].Contains("ReportNo")&&(c.ReportNo=l[0].ReportNo),a.Columns[0].Contains("ReportDate")&&(o.e.IsEmpty(l[0].ReportDate)||(c.ReportDate_Key=new Date(l[0].ReportDate).ToString("dd MMM yyyy"),c.ReportDate=new Date(l[0].ReportDate).ToString(s.a.SessionManager.Preferences["Date Format"])))),a.Columns[0].Contains("Unit")&&(c.Unit_Key=l[0].Unit),a.Columns[0].Contains("Remarks")&&(c.Remarks=l[0].Remarks);for(var d=0;d<r;d++)a.Columns[0].Contains("Fld"+(d+1))&&(c["Result"+(d+1)]=l[0]["Fld"+(d+1)])}}i.GridDataObj.addRow(c)},l=0;l<D;l++)c(l)},C=0;C<u.Tables[0].length;C++)b(C);i.GridDataObj.RefreshGrid=!0,i.GridDataObj.UpdateFooter()}else i.Parent.res="NO"}()}else if(8==i.QtyType){var ne=new h.d;ne.Label="Scan",ne.Column=0,ne.Row=0,ne.ColumnSpan=2,ne.DBColumnName="SKU",ne.isSKU=!0,ne.TextChangedCommand.Subscribe(_assertThisInitialized(i),"Scan"),ne.SetFocus=!0,i.TextFields.push(ne)}return _possibleConstructorReturn(i)}return _createClass(n,[{key:"OnBOEAdjustFIFOCheckedChanged",value:function(){if(this.GridData.length>0)for(var e=0;e<this.GridData.length;e++)null!=this.GridData[e].AvailQty&&null!=this.GridData[e].AvailQty&&""!=this.GridData[e].AvailQty.toString()&&parseFloat(this.GridData[e].AvailQty.toString())>0&&(this.GridData[e].Qty="0");if(this.BOEAdjustFIFO&&this.GridData.length>0)for(var t=parseFloat(this.TextFields[2].Text),n=0;n<this.GridData.length&&(t>0&&!o.e.IsEmpty(this.GridData[n].AvailQty)&&parseFloat(this.GridData[n].AvailQty.toString())>0&&(this.GridData[n].Qty=parseFloat(this.GridData[n].AvailQty)>=t?t:parseFloat(this.GridData[n].AvailQty),t-=parseFloat(this.GridData[n].Qty)),this.GridDataObj.updateRow(this.GridData[n]),0!=t);n++);var a="2",i=this.ColumnSource.find((function(e){return"Qty"==e.DisplayMember}));null!=i&&(a=i.DecimalPoints);var r=this.GridData.Compute("sum","Qty");null!=r&&""!=r.toString()&&0!=parseFloat(r.toString())||(r=0),this.BOEAdjSummary="Qty. Adjusted  :  "+parseFloat(r.toString()).ToString("N"+a)+"  of  "+this.TextFields[2].Text+"  for the Product  :  "+this.TextFields[1].Text}},{key:"getQty",value:function(e){var t=this;if(this.Parent.ScreenObject.Preferences.ContainsKey("ClubBoe")&&"True"==this.Parent.ScreenObject.Preferences.ClubBoe&&!this.SelectedRowEditing){var n=0;return this.Parent.ScreenObject.GridData.filter((function(e){return 0==e.DocDetailsID&&e.ProductID_Key==t.Parent.SelectedRow.ProductID_Key})).forEach((function(e){o.e.IsEmpty(e.Quantity)||(n+=parseFloat(e.Quantity))})),n.toString()}return null!=e?e.Quantity.toString():this.Parent.SelectedRow.Quantity.toString()}},{key:"FillBoeData",value:function(e){var t=this;if(!o.e.IsEmpty(e)&&!o.e.IsEmpty(this.Query)){var n=this.Parent.ScreenObject.GetinvDetails(this.Query,e,"","","",this.SelectedRowEditing);if(null!=n&&n.Tables.length>0&&n.Columns[0].Contains("InvDocDetailsID")&&n.Tables[0].length>0){for(var a=4;a<this.ColumnSource.length;a++)n.Columns[0].Contains(this.ColumnSource[a].DisplayMember+"_ID")&&!this.GridDataObj.TableColumns.Contains(this.ColumnSource[a].DisplayMember+"_ID")&&this.GridDataObj.TableColumns.push(this.ColumnSource[a].DisplayMember+"_ID");for(var i=function(e){var a=n.Tables[0].filter((function(n){return n.InvDocDetailsID==t.GridData[e].RefID}));if(a.length>0)for(var i=4;i<t.ColumnSource.length;i++)t.GridData[e][t.ColumnSource[i].DisplayMember]=a[0][t.ColumnSource[i].DisplayMember].toString(),n.Columns[0].Contains(t.ColumnSource[i].DisplayMember+"_ID")&&!o.e.IsEmpty(a[0][t.ColumnSource[i].DisplayMember+"_ID"])&&(t.GridData[e][t.ColumnSource[i].DisplayMember+"_ID"]=a[0][t.ColumnSource[i].DisplayMember+"_ID"].toString()),t.GridDataObj.updateRow(t.GridData[e])},r=0;r<this.GridData.length;r++)i(r)}}}},{key:"LoadBoes",value:function(e,t){for(var n=this,a=this.Parent.ScreenObject.GetinvDetails("","",t.ProductID_Key.toString(),"",t.LinkedInvDocDetailsID.toString(),this.SelectedRowEditing,!0),i=new Array,r=0;r<this.GridData.length;r++)o.e.IsEmpty(this.GridData[r].RefID)||i.push(this.GridData[r].RefID.toString());if(null!=a&&a.Tables.length>0&&a.Columns[0].Contains("InvDocDetailsID")&&a.Tables[0].length>0)for(var s=function(t){var i=0;if(n.dsusedbins.Tables.length>0&&n.dsusedbins.Tables[0].filter((function(e){return e.RefID==a.Tables[0][t].InvDocDetailsID})).forEach((function(e){n.dsusedbins.Columns[0].Contains("Qty")&&!o.e.IsEmpty(e.Qty)&&(i+=parseFloat(e.Qty))})),n.GridData.filter((function(e){return e.RefID==a.Tables[0][t].InvDocDetailsID})).length>0){var r=n.GridData.filter((function(e){return e.RefID==a.Tables[0][t].InvDocDetailsID.toString()}));r.length>0&&(o.e.IsEmpty(a.Tables[0][t].Qty)||(r[0].AvailQty=parseFloat(a.Tables[0][t].Qty)-i))}else{var s=n.GridDataObj.NewRow();s.RefID=a.Tables[0][t].InvDocDetailsID.toString(),""!=e&&(e+=","),e+=s.RefID.toString(),o.e.IsEmpty(a.Tables[0][t].Qty)||(s.AvailQty=parseFloat(a.Tables[0][t].Qty)-i),s.Type=1,n.GridDataObj.addRow(s)}},c=0;c<a.Tables[0].length;c++)s(c);return e}},{key:"onTextChanged",value:function(e){var t,n,a;t=o.e.DoubleTryParse(this.TextFields[3].Text),n=o.e.DoubleTryParse(this.TextFields[4].Text),a=o.e.DoubleTryParse(this.TextFields[5].Text),this.TextFields[6].Text=(t*n*a).toString()}},{key:"onPackChanged",value:function(e){if(this.TextFields[0]instanceof C.b&&this.TextFields[0].SelectedValue>0&&this.PackWise&&!this.IsSingleProd&&null==this.drEdit){var t=this.Parent.ScreenObject.GetPackDetails(this.TextFields[0].SelectedValue.toString());null!=t&&t.Tables.length>0&&t.Columns[0].Contains("Name")&&t.Tables[0].length>0&&(this.TextFields[6].Text=t.Tables[0][0].Volume.toString(),this.TextFields[2].Text=t.Tables[0][0].Weight.toString(),this.TextFields[3].Text=t.Tables[0][0].length.toString(),this.TextFields[4].Text=t.Tables[0][0].Width.toString(),this.TextFields[5].Text=t.Tables[0][0].Height.toString())}}},{key:"FillDtPack",value:function(e,t,n,a){var i;if(!o.e.IsEmpty(e[t])&&!o.e.IsEmpty(e[n.ValueMember])&&""==o.e.String(e.PackXML)){var r=this.GridData.filter((function(n){return n.Label==e[t].toString()}));if(r.length>0){if((i=r[0]).RefID.toString()!=e[n.ValueMember].toString()&&!confirm("Same label is assigned to diffrent pack.\n Do you want to override pack?"))return!1;i.Data=i.Data.toString()+","+e.Unq.toString()+"~"+e.Quantity.toString()}else{(i=this.GridDataObj.NewRow()).RefID=e[n.ValueMember].toString(),i.Type=2,i.Label=e[t].toString(),i.Name=e[n.DisplayMember].toString();var s=this.Parent.ScreenObject.GetPackDetails(i.RefID.toString());null!=s&&s.Tables.length>0&&s.Columns[0].Contains("Name")&&s.Tables[0].length>0&&(i.Name=s.Tables[0][0].Name,i.Volume=s.Tables[0][0].Volume,i.Weight=s.Tables[0][0].Weight,i.length=s.Tables[0][0].length,i.Width=s.Tables[0][0].width,i.Height=s.Tables[0][0].height),this.GridDataObj.addRow(i),i.Data=e.Unq.toString()+"~"+e.Quantity.toString()}a.Already=e.Quantity,a.Bal=0}return!0}},{key:"OnGridCellEditEnding",value:function(e,t,n){if("Packed"==t){var a=0;if(o.e.IsEmpty(e.Qty)||(a=parseFloat(e.Qty)),o.e.IsEmpty(e.Already)||(a-=parseFloat(e.Already)),o.e.IsEmpty(e.Packed)||(a-=parseFloat(e.Packed)),a<0){if(!confirm("Qty grater than Document Qty, Do you want to Continue?"))return void(e.Packed=0);o.e.IsEmpty(e.Packed)||(e.Packed=parseFloat(e.Packed)+a),a=0}e.Bal=a,this.GridDataObj.updateRow(e)}}},{key:"fillPack",value:function(e){try{for(var t="",n=0;n<this.Parent.ScreenObject.GridData.length;n++)o.e.IsEmpty(this.Parent.ScreenObject.GridData[n].ProductID_Key)||"true"!=this.Parent.ScreenObject.GridData[n].PackType.toString().toLowerCase()||o.e.IsEmpty(this.Parent.ScreenObject.GridData[n].PackXML)||(t+=this.Parent.ScreenObject.GridData[n].PackXML.toString().replace("<DocExtraXML>","").replace("</DocExtraXML>",""));""!=t&&(new o.f).ReadXml("<xml>"+t+"</xml>")}catch(a){Logger.ErrorLog("FieldCalculatorViewModel","fillPack","fillPack",a)}}},{key:"OnAddPack",value:function(e){var t=this;if(o.e.IsEmpty(this.TextFields[1].Text))this.DisplayMessage="Enter Label";else if(this.TextFields[0].SelectedValue>0){for(var n=this.TextFields[10].Table,a="",i=0;i<n.length;i++)o.e.Double(n[i].Packed)>0&&(""!=a&&(a+=","),a+=n[i].Unq.toString()+"~"+n[i].Packed.toString());var r=null,s=this.GridData.filter((function(e){return e.Label==t.TextFields[1].Text}));if(s.length>0){if(null==this.drEdit)return void(this.DisplayMessage="Duplicate Label Name");if(this.drEdit!=s[0])return void(this.DisplayMessage="Re load Pack.");if(""==a)return confirm("Do you want to delete?")?void this.DeletePack(s[0],n):void 0;if(!confirm("Do you want to override?"))return;r=s[0]}if(null!=this.drEdit&&0==s.length){if(""==a)return confirm("Do you want to delete?")?void this.DeletePack(this.drEdit,n):void 0;if(!confirm("Do you want to override?"))return;r=this.drEdit}a="";for(var c=0;c<n.length;c++)if(!o.e.IsEmpty(n[c].Packed)){""!=a&&(a+=","),a+=n[c].Unq.toString()+"~"+n[c].Packed.toString();var l=0;o.e.IsEmpty(n[c].Qty)||(l=parseFloat(n[c].Qty)),o.e.IsEmpty(n[c].Already)?l-=parseFloat(n[c].Packed):(l-=parseFloat(n[c].Packed),l-=parseFloat(n[c].Already),n[c].Already=parseFloat(n[c].Already)+parseFloat(n[c].Packed)),n[c].Bal=l,n[c].Packed=null}if(null==r){if(""==a)return void(this.DisplayMessage="select products to add pack.");r=this.GridDataObj.NewRow(),this.GridDataObj.addRow(r)}r.Data=a,r.RefID=this.TextFields[0].SelectedValue.toString(),r.Type=2,r.Name=this.TextFields[0].Text,r.ActualVolume=this.TextFields[6].Text,r.ActualWeight=this.TextFields[2].Text,r.length=this.TextFields[3].Text,r.Width=this.TextFields[4].Text,r.Height=this.TextFields[5].Text,r.Label=this.TextFields[1].Text,this.TextFields[6].Text="",this.TextFields[2].Text="",this.TextFields[3].Text="",this.TextFields[4].Text="",this.TextFields[5].Text="",this.TextFields[0].SelectedValue=o.e.IsEmpty(this.TextFields[0].DefaultValue)?0:parseInt(this.TextFields[0].DefaultValue),this.AutoIncreamentLabel(1),this.drEdit=null,this.TextFields[11].Label="Add Pack"}else this.DisplayMessage="Select Pack"}},{key:"DeletePack",value:function(e,t){this.GridDataObj.removeRow(e);for(var n=0;n<t.length;n++)if(!o.e.IsEmpty(t[n].Packed)){var a=0;o.e.IsEmpty(t[n].Qty)||(a=parseFloat(t[n].Qty)),o.e.IsEmpty(t[n].Already)?a-=parseFloat(t[n].Packed):(a-=parseFloat(t[n].Packed),a-=parseFloat(t[n].Already),t[n].Already=parseFloat(t[n].Already)+parseFloat(t[n].Packed)),t[n].Bal=a,t[n].Packed=null}}},{key:"OnAddmultipleProd",value:function(e){this.Parent.DtPack.Rows.Clear();for(var t=0;t<this.Parent.ScreenObject.GridData.length;t++)o.e.IsEmpty(this.Parent.ScreenObject.GridData[t].ProductID_Key)||"true"!=this.Parent.ScreenObject.GridData[t].PackType.toString().toLowerCase()||(this.Parent.ScreenObject.GridData[t].PackXML=null);for(var a=0,i=0;i<this.Parent.ScreenObject.GridData.length;i++)if(!o.e.IsEmpty(this.Parent.ScreenObject.GridData[i].ProductID_Key)&&"true"==this.Parent.ScreenObject.GridData[i].PackType.toString().toLowerCase()){a++,this.Parent.Setselectedrow(i);var r=new n(this.Parent,3);a>1&&r.AutoIncreamentLabel(3),r.OnAddmultiple(null),r.OnButtonClick("AutoResave")}s.a.page.HideDialog()}},{key:"OnAddmultiple",value:function(e){var t,n=0,a=0;t=parseFloat(this.Parent.SelectedRow.Quantity),o.e.IsEmpty(this.TextFields[4].Text)&&(this.TextFields[4].Text="1"),o.e.IsEmpty(this.TextFields[4].Text)||""!=this.TextFields[4].ValidateData()||(a=parseFloat(this.TextFields[4].Text));var i=t;a>0&&(i=Math.floor(t/a));for(var r=0;r<i+1;r++){n=0;var s=this.GridData.Compute("sum","Qty");(n=null!=s?t-parseFloat(s):t)>0&&(n<a&&(this.TextFields[4].Text=n.toString()),this.OnAdd(null))}}},{key:"OnAdd",value:function(e){var t=this;if(!this.PackWise||this.IsSingleProd)if(o.e.IsEmpty(this.TextFields[3].Text))this.DisplayMessage="Enter Label";else{var n=this.Parent.DtPack.filter((function(e){return e.Label==t.TextFields[3].Text}));if(n.length>0)this.DisplayMessage="Duplicate Label Name";else if((n=this.GridData.filter((function(e){return e.Label==t.TextFields[3].Text}))).length>0)this.DisplayMessage="Duplicate Label Name";else if(this.TextFields[2].SelectedValue>0){var a=this.GridDataObj.NewRow();if(a.Label=this.TextFields[3].Text,(n=this.Parent.DtPack.filter((function(e){return e.ID==t.TextFields[2].SelectedValue}))).length>0)a.RefID=this.TextFields[2].SelectedValue.toString(),a.Type=2,a.Name=n[0].Name,a.Volume=n[0].Volume,a.Weight=n[0].Weight,a.length=n[0].length,a.Width=n[0].width,a.Height=n[0].Height;else{var i=this.Parent.ScreenObject.GetPackDetails(this.TextFields[2].SelectedValue.toString());null!=i&&i.Tables.length>0&&i.Columns[0].Contains("Name")&&i.Tables[0].length>0&&(a.RefID=this.TextFields[2].SelectedValue.toString(),a.Type=2,a.Name=i.Tables[0][0].Name,a.Volume=i.Tables[0][0].Volume,a.Weight=i.Tables[0][0].Weight,a.length=i.Tables[0][0].length,a.Width=i.Tables[0][0].width,a.Height=i.Tables[0][0].height)}o.e.IsEmpty(this.TextFields[4].Text)||""!=this.TextFields[4].ValidateData()||(a.Qty=this.TextFields[4].Text),this.GridDataObj.addRow(a),this.AutoIncreamentLabel(3),o.e.IsEmpty(this.TextFields[2].DefaultValue)||(this.TextFields[2].SelectedValue=parseInt(this.TextFields[2].DefaultValue))}else this.DisplayMessage="Select Pack"}else this.OnAddPack(null)}},{key:"AutoIncreamentLabel",value:function(e){if(o.e.IsEmpty(this.TextFields[e].DefaultValue))this.TextFields[e].Text="";else{var t,n=this.TextFields[e].DefaultValue,a=1,i=!1;if(null!=n&&""!=n.Trim())for(var r=0;r<n.length;r++)if(!o.e.IsDigit(n[n.length-r-1])){if(r<=15&&(i=!0,r>0)){t=n.substr(n.length-r);for(var s=0;s<t.length&&"0"==t[s];s++)r--;a=parseInt(n.substr(n.length-r)),n=n.substr(0,n.length-r)}break}if(!i&&null!=n&&""!=n.Trim()){var c=n.length;c>15?(c=15,t=n.substr(n.length-c)):t=n;for(var l=0;l<t.length&&"0"==t[l];l++)c--;a=parseInt(n.substr(n.length-c)),n=n.substr(0,n.length-c)}null!=n&&""!=n.Trim()||(n="");for(var u=0;u<this.GridData.length;u++)o.e.IsEmpty(this.GridData[u].Label)||(""!=n&&this.GridData[u].Label.toString().startsWith(n)&&o.e.DoubleTryParse(this.GridData[u].Label.toString().Remove(0,n.length))>a?a=o.e.DoubleTryParse(this.GridData[u].Label.toString().Remove(0,n.length)):""==n&&o.e.IntTryParse(this.GridData[u].Label)>a&&(a=o.e.IntTryParse(this.GridData[u].Label)));this.TextFields[e].Text=n+(a+1)}}},{key:"OnIterationChanged",value:function(e,t){var n=this;if(null==t||"13"==t.keyCode){if(o.e.IsNum(this.TextFields[1].Text))return this.DisplayMessage="Enter valid iteration",void(this.MessageVisibility=!0);var a=11;s.a.SessionManager.Preferences.ContainsKey("QCLabNameDimension")&&!o.e.IsEmpty(s.a.SessionManager.Preferences.QCLabNameDimension)&&0!=parseInt(s.a.SessionManager.Preferences.QCLabNameDimension)&&(a=14);var i=o.e.Double(this.TextFields[1].Text);if(i>10&&(i=10),this.ColumnSource.length>i+a){var r=[];i+=a;for(var c=0;c<i;c++)r.push(this.ColumnSource[c]);for(var l=function(e){n.GridDataObj.TableColumns[e].Contains("Result")&&(r.find((function(t){return t.DisplayMember==n.GridDataObj.TableColumns[e]}))||(n.GridDataObj.TableColumns.RemoveAt(e),e--)),u=e},u=0;u<this.GridDataObj.TableColumns.length;u++)l(u);this.ColumnSource=r}else if(this.ColumnSource.length<i+a){var d=[];i=i+a-this.ColumnSource.length;var D=this.ColumnSource.length-a;D++;for(var h=0;h<this.ColumnSource.length;h++)d.push(this.ColumnSource[h]);for(var S=0;S<i;S++,D++){var m=new f.a;m.Header="Result "+D,m.DisplayMember="Result"+D,m.DataType="MULTI_TYPE",m.Width=100,d.push(m),this.GridDataObj.TableColumns.push("Result"+D)}this.ColumnSource=d}}}},{key:"SelectionChange",value:function(e){}},{key:"LabelScan",value:function(e,t){this.TextFields.length>1&&null!=this.TextFields[1]&&!o.e.IsEmpty(this.TextFields[1].Text)&&"13"==t.keyCode&&this.EditPack(!0)}},{key:"EditPack",value:function(e){var t=this,n=this.GridData.filter((function(e){return e.Label==t.TextFields[1].Text}));if(n.length>0){if(e&&!confirm("Do you want to Edit "+this.TextFields[1].Text+" pack?"))return;var a=this.TextFields[10].Table,i=null;if(null!=this.drEdit){i=this.drEdit.Data.toString().split(",");for(var r=function(e){var t=i[e].split("~"),n=a.filter((function(e){return e.Unq==t[0]}));if(n.length>0){n[0].Already=o.e.IsEmpty(n[0].Already)?t[1]:parseFloat(n[0].Already)+parseFloat(t[1]),n[0].Packed=0;var r=0;o.e.IsEmpty(n[0].Qty)||(r=parseFloat(n[0].Qty)),o.e.IsEmpty(n[0].Already)||(r-=parseFloat(n[0].Already)),n[0].Bal=r}},s=0;s<i.length;s++)r(s)}this.drEdit=n[0],this.TextFields[11].Label="Save Changes",this.TextFields[0].SelectedValue=parseInt(n[0].RefID),this.TextFields[6].Text=n[0].ActualVolume.toString(),this.TextFields[2].Text=n[0].ActualWeight.toString(),this.TextFields[3].Text=n[0].length.toString(),this.TextFields[4].Text=n[0].Width.toString(),this.TextFields[5].Text=n[0].Height.toString(),i=n[0].Data.toString().split(",");for(var c=function(e){var t=i[e].split("~"),n=a.filter((function(e){return e.Unq==t[0]}));if(n.length>0){n[0].Packed=t[1];var r=0;o.e.IsEmpty(n[0].Qty)||(r=parseFloat(n[0].Qty)),o.e.IsEmpty(n[0].Already)||(n[0].Already=parseFloat(n[0].Already)-parseFloat(n[0].Packed),r-=parseFloat(n[0].Packed),r-=parseFloat(n[0].Already)),n[0].Bal=r}},l=0;l<i.length;l++)c(l)}}},{key:"PackProductScan",value:function(e,t){var n=this;if(this.TextFields.length>7&&null!=this.TextFields[7]&&this.TextFields[7]instanceof h.d&&"13"==t.keyCode)this.PackScan();else if(this.TextFields.length>7&&null!=this.TextFields[7]&&this.TextFields[7]instanceof C.b&&this.TextFields[7].SelectedValue>0&&(null==t||"13"==t.keyCode)&&this.TextFields.length>10&&this.TextFields[10]instanceof V.a){var a=this.TextFields[10].Table.filter((function(e){return e.ProductID==n.TextFields[7].SelectedValue}));if(a.length>0){var i=1;o.e.IsEmpty(this.TextFields[8].TextBox.Text)||(i=o.e.DoubleTryParse(this.TextFields[8].TextBox.Text)),a[0].Packed=o.e.IsEmpty(a[0].Packed)?i:parseFloat(a[0].Packed)+i,this.OnGridCellEditEnding(a[0],"Packed",0)}}}},{key:"PackScan",value:function(){var e=this.Parent.ScreenObject.ColumnSource.find((function(e){return null!=e.DisplayMember&&"ProductCode"==e.DisplayMember}));if(e&&e.UseBarcode){var t={PID:0};if(this.Parent.ReadBarcode(e.BarcodeDef,e.BarcodeProp,null,null,this.TextFields[7].Text,t)&&this.TextFields.length>10&&this.TextFields[10]instanceof V.a){var n=this.TextFields[10].Table.filter((function(e){return e.ProductID=t.PID}));if(n.length>0){o.e.IsEmpty(this.TextFields[8].TextBox.Text)||o.e.DoubleTryParse(this.TextFields[8].TextBox.Text),n[0].Packed=o.e.IsEmpty(n[0].Packed)?1:parseFloat(n[0].Packed)+1,this.OnGridCellEditEnding(n[0],"Packed",0),this.TextFields[7].Text=""}}}}},{key:"Scan",value:function(e,t){this.TextFields.length>0&&null!=this.TextFields[0]&&!o.e.IsEmpty(this.TextFields[0].Text)&&"13"==t.keyCode&&this.MainScan()}},{key:"MainScan",value:function(){var e=this;if(this.DisplayMessage="",2==this.QtyType){var t=this.GridData.Compute("sum","Qty");if(null!=t&&null!=t&&parseFloat(t)>=parseFloat(this.TextFields[2].Text))return void(this.DisplayMessage="Quantity already adjusted")}var n=1,a=this.TextFields[0].Text,i=this.Parent.ScreenObject.ColumnSource.find((function(e){return null!=e.DisplayMember&&"ProductCode"==e.DisplayMember}));if(""!=i.BarcodeDef){var r=this.TextFields[0].Text,s=new o.f;if(""!=i.BarcodeProp){s.LoadXml(i.BarcodeProp);var c=s.SelectSingleNode("BarCodeBody/IsFixedBarcodeLength");if(null!=c&&"true"==s.getNodeData(c).toLowerCase()){var u=s.getNodeData(c);if(null!=(c=s.SelectSingleNode("BarCodeBody/FixedBarcodeChar"))&&""!=u.Trim()){var d=u[0];if(null!=(c=s.SelectSingleNode("BarCodeBody/IsFixedBarcodePrefix"))&&"true"==u.Trim())for(var D=0;D<r.length&&r[D]==d;D++)r=r.Remove(0,1),D--;else for(var h=r.length-1;h>=0&&r[h]==d;h--)r=r.Remove(r.length-1,1)}}if(null!=(c=s.SelectSingleNode("BarCodeBody/IsExclude"))&&"true"==s.getNodeData(c).toLowerCase()){var S;c=s.SelectSingleNode("BarCodeBody/ExcludeChar");var m=s.getNodeData(c);if(null!=c&&""!=m.Trim()?S=m[0]:S=null!=(c=s.SelectSingleNode("BarCodeBody/FixedBarcodeChar"))&&""!=m.Trim()?m[0]:" ",null!=(c=s.SelectSingleNode("BarCodeBody/IsExcludePrefix"))&&"true"==s.getNodeData(c).Trim())for(var b=0;b<r.length&&r[b]==S;b++)r=r.Remove(0,1),b--;else for(var C=r.length-1;C>=0&&r[C]==S;C--)r=r.Remove(r.length-1,1)}null!=(c=s.SelectSingleNode("BarCodeBody/IncludeChecksum"))&&"true"==s.getNodeData(c).toLowerCase()&&(r=r.Remove(r.length-1,1))}(s=new o.f).LoadXml(i.BarcodeDef);for(var y=s.SelectNodes("Definition/Field"),p=0;p<y.length;p++){var g="",f="",O="",I="",T=0;null!=s.getDateByNodeName(y[p],"DataSource")&&(g=s.getDateByNodeName(y[p],"DataSource")),null!=s.getDateByNodeName(y[p],"SysColumn")&&(f=s.getDateByNodeName(y[p],"SysColumn")),null!=s.getDateByNodeName(y[p],"Delimiter")&&(O=s.getDateByNodeName(y[p],"Delimiter"));var j=s.getDateByNodeName(y[p],"Width");if(o.e.IsNum(j)&&(T=parseInt(j)),j=s.getDateByNodeName(y[p],"Decimals"),o.e.IsNum(j)&&parseInt(j),-1==T&&""!=O){var P=r.indexOf(O);P>0&&P<r.length&&(I=r.substr(0,P),r=r.Remove(0,P))}else-1!=T&&r.length>=T?(I=r.substr(0,T),r=r.Remove(0,T)):-1==T&&p==y.length-1&&(I=r);""!=O&&r.length>O.length&&(r=r.Remove(0,O.length)),"Document"==g&&"INVID"==f?""!=I?a=I:r="":"Document"==g&&"quantity"==f.toLowerCase()&&o.e.IsNum(I)&&(n=parseFloat(I))}}var A=this.GridData.filter((function(e){return e.RefID==a}));if(A.length>0){if(A[0].Qty=o.e.IsEmpty(A[0].Qty)?n:parseFloat(A[0].Qty)+n,2==this.QtyType&&!o.e.IsEmpty(A[0].AvailQty)&&parseFloat(A[0].AvailQty)<parseFloat(A[0].Qty)&&(A[0].Qty=A[0].AvailQty,this.DisplayMessage="Can not adjust more than available"),this.TextFields[0].Text="",o.e.PlaySound("beep-02.wav"),2==this.QtyType&&this.Parent.ScreenObject.GridDataObj.TableColumns.Contains("BinWise")&&1==Object(l.j)(this.Parent.SelectedRow.BinWise)&&(null==this.dtBins||0==this.dtBins.filter((function(e){return e.InvID==a})).length)){var M=this.Parent.SelectedRow,v=this.Parent.ScreenObject.GetinvBinDetails(a,M.ProductID_Key.toString(),M.LinkedInvDocDetailsID.toString());this.FillBins(v,0,a)}}else{var G=function(){var t="",i="0",r="";2==e.QtyType&&(r=e.Parent.SelectedRow.LinkedInvDocDetailsID.toString(),i=e.Parent.SelectedRow.ProductID_Key.toString()),2!=e.QtyType&&7!=e.QtyType||!e.Parent.ScreenObject.Preferences.ContainsKey("BilllandingScanField")||o.e.IsEmpty(e.Parent.ScreenObject.Preferences.BilllandingScanField)||o.e.IsEmpty(e.GridDataObj.SearchCols.SelectedValue)||e.GridDataObj.SearchCols.SelectedValue!=e.Parent.ScreenObject.Preferences.BilllandingScanField||(t=e.GridDataObj.SearchCols.SelectedValue);var s="";2==e.QtyType&&(s=e.Parent.SelectedRow.landingType.toString());var c=e.Parent.ScreenObject.GetinvDetails("",a,i,s,r,e.SelectedRowEditing,!1,t);if(!(null!=c&&c.Tables.length>0&&c.Columns[0].Contains("ProductID")&&c.Tables[0].length>0)){if(7==e.QtyType&&e.Parent.ScreenObject.Preferences.ContainsKey("usetempifnotscanned")&&Object(l.j)(e.Parent.ScreenObject.Preferences.usetempifnotscanned)){if(!(e.Parent.ScreenObject.TempProductID>0))return{v:void(e.DisplayMessage="Define Temp product")};var u=e.GridDataObj.NewRow();u.RefID=a,u.Qty=n,u.Type="1",u.ProductID=e.Parent.ScreenObject.TempProductID.toString(),e.GridDataObj.addRow(u)}else e.DisplayMessage="Product not found";return{v:(e.TextFields[0].Text="",void o.e.PlaySound("beep-01.wav"))}}if("0"!=i&&c.Tables[0][0].ProductID.toString()!=i)return{v:(o.e.PlaySound("beep-01.wav"),void(e.DisplayMessage="Different Product Scanned"))};if(c.Tables.length>1&&c.Tables[1].length>0)for(var d=function(t){return(A=e.GridData.filter((function(e){return e.RefID==c.Tables[1][t].InvDocDetailsID}))).length>0?parseFloat(A[0].Qty)<parseFloat(c.Tables[1][t].Qty)?{v:{v:void(e.DisplayMessage="Select Product in FIFO Order")}}:void 0:{v:{v:void(e.DisplayMessage="Select Product in FIFO Order")}}},D=0;D<c.Tables[1].length;D++){var h=d(D);if("object"==typeof h)return h.v}if(!o.e.IsEmpty(t)){for(var S=n,m=0;m<c.Tables[0].length&&S>0;m++)if(a=c.Tables[0][m].InvDocDetailsID.toString(),(A=e.GridData.filter((function(e){return e.RefID==a}))).length>0)if(2==e.QtyType){if(o.e.IsEmpty(A[0].AvailQty)?(A[0].Qty=S,S=0):o.e.IsEmpty(A[0].Qty)?parseFloat(A[0].AvailQty)>S?(A[0].Qty=S,S=0):(A[0].Qty=A[0].AvailQty.toString(),S-=parseFloat(A[0].AvailQty)):parseFloat(A[0].AvailQty)>S+parseFloat(A[0].Qty)?(A[0].Qty=parseFloat(A[0].Qty)+S,S=0):(S-=parseFloat(A[0].AvailQty)-parseFloat(A[0].Qty),A[0].Qty=A[0].AvailQty.toString()),!o.e.IsEmpty(A[0].AvailQty)&&parseFloat(A[0].AvailQty)<parseFloat(A[0].Qty)&&(A[0].Qty=A[0].AvailQty,e.DisplayMessage="Can not adjust more than available"),e.TextFields[0].Text="",e.Parent.ScreenObject.GridDataColumns.Contains("BinWise")&&"True"==e.Parent.SelectedRow.BinWise.toString()&&(null==e.dtBins||0==e.dtBins.filter((function(e){return e.InvID==a})).length)){var b=e.Parent.SelectedRow,C=e.Parent.ScreenObject.GetinvBinDetails(a,b.ProductID_Key.toString(),b.LinkedInvDocDetailsID.toString());e.FillBins(C,0,a)}}else A[0].Qty=o.e.IsEmpty(A[0].Qty)?n:parseFloat(A[0].Qty)+n,S=0,e.TextFields[0].Text="";else{var y=0;e.dsusedbins.Tables.length>0&&e.dsusedbins.Tables[0].filter((function(e){return e.RefID==a})).forEach((function(t){e.dsusedbins.Columns[0].Contains("Qty")&&!o.e.IsEmpty(t.Qty)&&(y+=parseFloat(t.Qty))}));var p=void 0,g=e.GridDataObj.NewRow();if(g.RefID=a,g.Qty=n,g.Type="1",7==e.QtyType?(g.ProductID=c.Tables[0][0].ProductID.toString(),g.Qty=n,S=0):2==e.QtyType&&(o.e.IsEmpty(c.Tables[0][m].Qty)?(g.Qty=S,S=0):(g.AvailQty=parseFloat(c.Tables[0][m].Qty)-y,parseFloat(g.AvailQty)>S?(g.Qty=S,S=0):(g.Qty=g.AvailQty,S-=parseFloat(g.AvailQty)))),""!=e.Query)for(var f=e.Parent.ScreenObject.GetinvDetails(e.Query,a,"","","",e.SelectedRowEditing),O=4;O<e.ColumnSource.length;O++)g[e.ColumnSource[O].DisplayMember]=f.Tables[0][0][e.ColumnSource[O].DisplayMember].toString();if(e.GridDataObj.addRow(g),7==e.QtyType)p=e.Parent.ScreenObject.GetinvBinDetails(a,c.Tables[0][0].ProductID.toString(),"");else{var I=e.Parent.SelectedRow;p=e.Parent.ScreenObject.GetinvBinDetails(a,I.ProductID_Key.toString(),I.LinkedInvDocDetailsID.toString())}e.FillBins(p,0,a)}return{v:void(S>0?e.DisplayMessage="Can not adjust more than available":(e.TextFields[0].Text="",o.e.PlaySound("beep-02.wav")))}}var T=0;e.dsusedbins.Tables.length>0&&e.dsusedbins.Tables[0].filter((function(e){return e.RefID==a})).forEach((function(t){e.dsusedbins.Columns[0].Contains("Qty")&&!o.e.IsEmpty(t.Qty)&&(T+=parseFloat(t.Qty))}));var j=e.GridDataObj.NewRow();if(j.RefID=a,j.Qty=n,j.Type="1",7==e.QtyType&&(j.ProductID=c.Tables[0][0].ProductID.toString()),2!=e.QtyType||o.e.IsEmpty(c.Tables[0][0].Qty)||(j.AvailQty=parseFloat(c.Tables[0][0].Qty)-T,parseFloat(j.AvailQty)<n&&(j.Qty=j.AvailQty,e.DisplayMessage="Can not adjust more than available")),""!=e.Query)for(var P=e.Parent.ScreenObject.GetinvDetails(e.Query,a,"","","",e.SelectedRowEditing),M=4;M<e.ColumnSource.length;M++)j[e.ColumnSource[M].DisplayMember]=P.Tables[0][0][e.ColumnSource[M].DisplayMember].toString();if(e.GridDataObj.addRow(j),e.TextFields[0].Text="",o.e.PlaySound("beep-02.wav"),o.e.IsEmpty(t))e.FillBins(c,2,a);else{var v=e.Parent.SelectedRow,G=e.Parent.ScreenObject.GetinvBinDetails(a,v.ProductID_Key.toString(),v.LinkedInvDocDetailsID.toString());e.FillBins(G,0,a)}}();if("object"==typeof G)return G.v}}},{key:"FillBins",value:function(e,t,n){if(null!=e&&e.Tables.length>t&&e.Tables[t].length>0){null==this.dtBins&&(this.dtBins=[],this.dtBinsColumns=[],this.dtBinsColumns.push("BinID"),this.dtBinsColumns.push("Qty"),this.dtBinsColumns.push("InvID"),e.Columns[t].Contains("InvDocDetailsID")&&this.dtBinsColumns.push("InvDocDetailsID"));for(var a=0;a<e.Tables[t].length;a++)if(o.e.Double(e.Tables[t][a].Quantity)>0){var i={};i.BinID=e.Tables[t][a].BinID.toString(),i.Qty=e.Tables[t][a].Quantity.toString(),i.InvID=n,e.Columns[t].Contains("InvDocDetailsID")&&(i.InvDocDetailsID=e.Tables[t][a].InvDocDetailsID.toString()),this.dtBins.push(i)}}}},{key:"InitGrid",value:function(){var e=this;if(1==this.QtyType){var t=this.Parent.SelectedRow,n=this.Parent.ScreenObject.GridDataObj.TableColumns;this.GridDataObj.CanUserDeleteRows=!0;var a=o.e.String(this.Parent.SelectedRow.ProductID_Key),i=this.Parent.ScreenObject.GetQtyAdjustmentDetails(a);this.fldDict=new c.a;var r=0,l=0,u=new o.f;this.Parent.ScreenObject.Preferences.ContainsKey("QtyAdjXML")&&!o.e.IsEmpty(this.Parent.ScreenObject.Preferences.QtyAdjXML)&&u.LoadXml(this.Parent.ScreenObject.Preferences.QtyAdjXML);var d=u.SelectNodes("XML/Row");this.GridDataObj.TableColumns.push("Islinked");for(var D=0;D<i.Tables[0].length;D++){var S=new f.a;if(S.Header=i.Tables[0][D].ResourceData.toString(),S.DisplayMember=i.Tables[0][D].SysColumnName.toString(),S.Formula=i.Tables[0][D].Cformula.toString(),S.DecimalPoints=o.e.IsEmpty(i.Tables[0][D].Decimal)?"0":i.Tables[0][D].Decimal.toString(),!o.e.IsEmpty(i.Tables[0][D].IsMandatory)){S.Action=parseInt(i.Tables[0][D].IsMandatory);var b="";if(S.Action>0?b="dcNum"+S.Action:-2==S.Action?b="Quantity":-3==S.Action?b="Rate":-4==S.Action&&(b="Gross"),""!=b){S.ShowTotal=!0;var C=new h.d;C.Label=S.Header,n.Contains(b)&&(C.Text=o.e.String(t[b])),C.Column=l%4,C.Row=l/4,C.IsReadOnly=!0,this.TextFields.push(C),l++}}"fld10"!=S.DisplayMember.toLowerCase()&&(S.DataType="FLOAT"),i.Tables.length>1&&i.Tables[1].length>0&&i.Columns[1].Contains(S.DisplayMember)&&(S.DefaultValue=i.Tables[1][0][S.DisplayMember].toString()),-1==(r=o.e.IntTryParse(i.Tables[0][D].UserDefaultValue))?(S.IsReEvaluate=!0,S.ShowTotal=!0):o.e.IsNum(i.Tables[0][D].UserDefaultValue)&&r<-2&&(S.ShowTotal=!1,S.ValueMember=S.DisplayMember+"_Key",this.GridDataObj.TableColumns.push(S.ValueMember),S.DataType="LISTBOX",r=-1*r+5e4,S.CostCenterID=r,S.TypeID=1,"product"==S.Formula.toLowerCase()&&(S.FilterCondition=" cc.productid="+a),S.Formula=""),S.Width=100;for(var y=0;y<d.length;y++)if(null!=d[y].attributes.ColName&&d[y].attributes.ColName.value==S.DisplayMember){null==d[y].attributes.Val||o.e.IsEmpty(d[y].attributes.Val.value)||("2"==d[y].attributes.Val.value?S.ReadOnly=!0:"3"==d[y].attributes.Val.value?S.IsVisible=!1:"4"==d[y].attributes.Val.value&&(S.NoRoundOff=!0)),null==d[y].attributes.Width||o.e.IsEmpty(d[y].attributes.Width.value)||(S.Width=parseInt(d[y].attributes.Width.value));break}this.ColumnSource.push(S),this.GridDataObj.TableColumns.push(S.DisplayMember);var p=new I.c;p.setFieldDetails(S.Header,1,1,"0",1,!1,!1),this.fldDict.push(S.Header,p)}var g=this.Parent.SelectedRow;if(u=new o.f,o.e.IsEmpty(g.QtyXML)){var O=this.ColumnSource.filter((function(e){return"LISTBOX"==e.DataType&&-1==e.Action}));if(O.length>0){var T=function(){var t=void 0,n=O[l],a=n.TypeID>0?n.TypeID:1;s.a.SessionManager.ListViewDef.Columns.Contains("ColumnType")&&(t=1);var i,r=s.a.SessionManager.ListViewDef.Tables[0].filter((function(e){return e.CostCenterID==n.CostCenterID&&e.ListViewTypeID==a&&(Object(j.isUndefined)(t)||e.ColumnType==t)}));if(r.length>0&&(null!=(i=o.e.IsEmpty(n.FilterCondition)?e.GetCostCenterListViewData(parseInt(r[0].ListViewID),"a."+r[0].SysColumnName.toString(),r[0].SysColumnName.toString(),0):e.GetCostCenterListViewData(parseInt(r[0].ListViewID),"a."+r[0].SysColumnName.toString(),r[0].SysColumnName.toString(),0,"",n.FilterCondition))&&i.Tables.length>0&&!i.Columns[0].Contains("ErrorMessage")))for(var c=0;c<i.Tables[0].length;c++){var u=void 0;1==l?(u=e.GridDataObj.NewRow(),e.GridDataObj.addRow(u)):e.GridData.length>c?u=e.GridData[c]:(u=e.GridDataObj.NewRow(),e.GridDataObj.addRow(u)),u[n.ValueMember]=parseInt(i.Tables[0][c][i.Columns[0][0]]),u[n.DisplayMember]=i.Tables[0][c][i.Columns[0][1]].toString()}};for(l=0,l=0;l<O.length;l++)T()}}else{u.LoadXml(g.QtyXML),d=u.SelectNodes("QtyAdjustments/Row");for(var P=0;P<d.length;P++){for(var A=this.GridDataObj.NewRow(),M=0;M<this.ColumnSource.length;M++)null==d[P].attributes[this.ColumnSource[M].DisplayMember]||o.e.IsEmpty(d[P].attributes[this.ColumnSource[M].DisplayMember].value)||("LISTBOX"==this.ColumnSource[M].DataType?(A[this.ColumnSource[M].ValueMember]=d[P].attributes[this.ColumnSource[M].DisplayMember].value,null==d[P].attributes[this.ColumnSource[M].ValueMember]||o.e.IsEmpty(d[P].attributes[this.ColumnSource[M].ValueMember].value)||(A[this.ColumnSource[M].DisplayMember]=d[P].attributes[this.ColumnSource[M].ValueMember].value)):A[this.ColumnSource[M].DisplayMember]=d[P].attributes[this.ColumnSource[M].DisplayMember].value);A.Islinked=null==d[P].attributes.Islinked||"1"!=d[P].attributes.Islinked.value&&"True"!=d[P].attributes.Islinked.value?"0":"1",this.GridDataObj.addRow(A)}this.RefreshGrid=!0,this.ColumnSource.filter((function(e){return 1==e.ShowTotal})).forEach((function(t){for(var n=0,a=0;a<e.GridData.length;a++)o.e.IsEmpty(e.GridData[a][t.DisplayMember])||(n+=parseFloat(e.GridData[a][t.DisplayMember]));t.footer=null!=t.DecimalPoints&&""!=t.DecimalPoints?n.ToString("N"+t.DecimalPoints):n.toString(),e.UpdateFooter=!0}))}for(var v=0;v<10;v++)this.GridDataObj.addEmptyRow()}else if(0==this.QtyType){this.GridDataObj.TableColumns.push("Name"),this.GridDataObj.TableColumns.push("Amount"),this.GridDataObj.TableColumns.push("CalcAmount");var G=new f.a;G.Header="Field",G.ValueBinding="Name",G.DataType="ComboBox",G.DisplayMember="Name",G.ValueMember="Value",G.Width=230,this.ColumnSource.push(G),(G=new f.a).Header="Value",G.DisplayMember="Amount",G.DataType="FLOAT",G.Width=100,this.ColumnSource.push(G),(G=new f.a).Header="Calculated Value",G.DisplayMember="CalcAmount",G.DataType="FLOAT",G.Width=120,this.ColumnSource.push(G)}else if(2==this.QtyType||7==this.QtyType){this.GridDataObj.TableColumns.push("RefID"),this.GridDataObj.TableColumns.push("Qty"),this.GridDataObj.TableColumns.push("Type"),7==this.QtyType&&this.GridDataObj.TableColumns.push("ProductID");var N=new f.a;if(N.Header="Code",N.DisplayMember="RefID",N.Width=100,N.ReadOnly=!0,2==this.QtyType&&(N.DisableTab=!0),this.ColumnSource.push(N),(N=new f.a).Header="Qty",N.DisplayMember="Qty",N.DataType="FLOAT",N.Width=100,N.ReadOnly=!s.a.SessionManager.IsActionAssigned(43,"Enable Qty in BOE"),"AddEditDocumentViewModel"==this.Parent.ClassName){var E=this.Parent.ScreenObject.ColumnSource.find((function(e){return null!=e.DisplayMember&&"quantity"==e.DisplayMember.toLowerCase()}));null!=E&&(N.DecimalPoints=E.DecimalPoints)}this.ColumnSource.push(N),this.GridDataObj.TableColumns.push("AvailQty"),(N=new f.a).Header="Available",N.DisplayMember="AvailQty",N.DataType="FLOAT",N.Width=100,N.ReadOnly=!0,2==this.QtyType&&(N.DisableTab=!0),this.ColumnSource.push(N),(N=new f.a).Header="Type",N.DisplayMember="Type",N.DataType="FLOAT",N.IsVisible=!1,N.Width=100,N.ReadOnly=!0,2==this.QtyType&&(N.DisableTab=!0),this.ColumnSource.push(N),o.e.IsNum(this.Parent.ScreenObject.Preferences.BilllandingReport)&&o.e.IntTryParse(this.Parent.ScreenObject.Preferences.BilllandingReport)}else if(3==this.QtyType||5==this.QtyType){this.GridDataObj.TableColumns.push("RefID"),this.GridDataObj.TableColumns.push("Name"),this.GridDataObj.TableColumns.push("Qty"),this.GridDataObj.TableColumns.push("Type"),this.GridDataObj.TableColumns.push("cWeight"),this.GridDataObj.TableColumns.push("cVolume"),this.GridDataObj.TableColumns.push("pWeight"),this.GridDataObj.TableColumns.push("pVolume"),this.GridDataObj.TableColumns.push("Weight"),this.GridDataObj.TableColumns.push("Volume"),this.GridDataObj.TableColumns.push("Label"),this.GridDataObj.TableColumns.push("UsedWeight"),this.GridDataObj.TableColumns.push("UsedVolume"),this.GridDataObj.TableColumns.push("length"),this.GridDataObj.TableColumns.push("Width"),this.GridDataObj.TableColumns.push("Height"),this.GridDataObj.TableColumns.push("ActualWeight"),this.GridDataObj.TableColumns.push("ActualVolume"),this.PackWise&&(this.GridDataObj.TableColumns.push("Data"),this.GridDataObj.TableColumns.push("ExtraProductXML"));var w,F=[],V=[],L=this.GridDataObj.NewRow();if(s.a.SessionManager.Preferences.ContainsKey("PackDef")&&""!=s.a.SessionManager.Preferences.PackDef){var R=new o.f;R.LoadXml(s.a.SessionManager.Preferences.PackDef);for(var B=0;B<R.DocumentElement.children.length;B++){var x=R.DocumentElement.children[B];(w=new f.a).Header=x.attributes.Header.value,w.DisplayMember=x.attributes.Name.value,w.DisplayIndex=parseInt(x.attributes.index.value),w.Width=parseInt(x.attributes.WIDTH.value),"1"==x.attributes.Visible.value?w.IsVisible=!0:"2"==x.attributes.Visible.value?(w.IsVisible=!0,w.ReadOnly=!0):w.IsVisible=!1,5==this.QtyType&&(L[w.DisplayMember]=x.attributes.Visible.value),F.push(w)}var k=R.SelectSingleNode("XML").attributes.ProdList;null==k||o.e.IsEmpty(k.Value)||(5==this.QtyType?this.TextFields[0].SelectedValue=k.Value:this.Footerfld=k.Value)}(w=new f.a).Header="Pack",w.DisplayMember="Name",w.Width=100,w.ReadOnly=!0,this.SetVarible(F,w),V.push(w),(w=new f.a).Header="Label",w.DisplayMember="Label",w.DataType="FLOAT",w.Width=100,w.ReadOnly=!0,this.SetVarible(F,w),V.push(w),(w=new f.a).Header="Qty",w.DisplayMember="Qty",w.DataType="FLOAT",w.Width=100,this.SetVarible(F,w),V.push(w),(w=new f.a).Header="Type",w.DisplayMember="Type",w.DataType="FLOAT",w.IsVisible=!1,w.Width=100,w.ReadOnly=!0,V.push(w),(w=new f.a).Header="RefID",w.DisplayMember="RefID",w.IsVisible=!1,w.Width=100,w.ReadOnly=!0,V.push(w),(w=new f.a).Header="Volume",w.DisplayMember="Volume",w.DataType="FLOAT",w.Width=100,w.ReadOnly=!0,this.SetVarible(F,w),V.push(w),(w=new f.a).Header="Product Volume",w.DisplayMember="pVolume",w.DataType="FLOAT",w.Width=120,w.ReadOnly=!0,this.SetVarible(F,w),V.push(w),(w=new f.a).Header="Total Volume",w.DisplayMember="cVolume",w.DataType="FLOAT",w.Width=120,w.ReadOnly=!0,this.SetVarible(F,w),V.push(w),(w=new f.a).Header="Actual Volume",w.DisplayMember="ActualVolume",w.DataType="FLOAT",w.Width=120,w.ReadOnly=!0,this.SetVarible(F,w),V.push(w),(w=new f.a).Header="Weight",w.DisplayMember="Weight",w.DataType="FLOAT",w.Width=100,w.ReadOnly=!0,this.SetVarible(F,w),V.push(w),(w=new f.a).Header="Product Weight",w.DisplayMember="pWeight",w.DataType="FLOAT",w.Width=120,w.ReadOnly=!0,this.SetVarible(F,w),V.push(w),(w=new f.a).Header="Total Weight",w.DisplayMember="cWeight",w.DataType="FLOAT",w.Width=120,w.ReadOnly=!0,this.SetVarible(F,w),V.push(w),(w=new f.a).Header="Actual Weight",w.DisplayMember="ActualWeight",w.DataType="FLOAT",w.Width=120,w.ReadOnly=!0,this.SetVarible(F,w),V.push(w),(w=new f.a).Header="length",w.DisplayMember="length",w.DataType="FLOAT",w.Width=100,w.ReadOnly=!0,this.SetVarible(F,w),V.push(w),(w=new f.a).Header="Width",w.DisplayMember="Width",w.DataType="FLOAT",w.Width=100,w.ReadOnly=!0,this.SetVarible(F,w),V.push(w),(w=new f.a).Header="Height",w.DisplayMember="Height",w.DataType="FLOAT",w.Width=120,w.ReadOnly=!0,this.SetVarible(F,w),V.push(w);var _=[];_.push(m.d.ComboBoxItems_2("Editable","1")),_.push(m.d.ComboBoxItems_2("ReadOnly","2")),_.push(m.d.ComboBoxItems_2("Hide","3"));var K=[];K.push(m.d.ComboBoxItems_2("ReadOnly","2")),K.push(m.d.ComboBoxItems_2("Hide","3"));for(var Q=V.sort((function(e,t){return e.DisplayIndex-t.DisplayIndex})),H=0;H<Q.length;H++){var W=Q[H];if(5==this.QtyType){if("Type"==W.DisplayMember||"RefID"==W.DisplayMember)continue;W.DataType="ComboBox",W.ComboData="ActualVolume"==W.DisplayMember||"ActualWeight"==W.DisplayMember||"Qty"==W.DisplayMember||"Height"==W.DisplayMember||"Width"==W.DisplayMember||"length"==W.DisplayMember?_:K,W.ValueBinding=W.DisplayMember,W.DisplayMember="Name",W.ValueMember="Value",W.ReadOnly=!1,W.IsVisible=!0}this.ColumnSource.push(W)}if(5==this.QtyType){if(0==F.length)for(var U=0;U<this.GridDataObj.TableColumns.length;U++)L[U]="Qty"==this.GridDataObj.TableColumns[U]?"1":"2";this.GridDataObj.addRow(L)}}else if(4==this.QtyType){this.GridDataObj.TableColumns.push("RefID"),this.GridDataObj.TableColumns.push("Name"),this.GridDataObj.TableColumns.push("Min"),this.GridDataObj.TableColumns.push("Max"),this.GridDataObj.TableColumns.push("TestType"),this.GridDataObj.TableColumns.push("ProbableValues"),this.GridDataObj.TableColumns.push("MultiColTYPE"),this.GridDataObj.TableColumns.push("Variance"),this.GridDataObj.TableColumns.push("Sample"),this.GridDataObj.TableColumns.push("SampleType"),this.GridDataObj.TableColumns.push("Retest"),this.GridDataObj.TableColumns.push("SampleNo"),this.GridDataObj.TableColumns.push("Samplesize"),s.a.SessionManager.Preferences.ContainsKey("QCLabNameDimension")&&!o.e.IsEmpty(s.a.SessionManager.Preferences.QCLabNameDimension)&&0!=parseInt(s.a.SessionManager.Preferences.QCLabNameDimension)&&(this.GridDataObj.TableColumns.push("LabName"),this.GridDataObj.TableColumns.push("LabName_Key"),this.GridDataObj.TableColumns.push("ReportNo"),this.GridDataObj.TableColumns.push("ReportDate"),this.GridDataObj.TableColumns.push("ReportDate_Key")),this.GridDataObj.TableColumns.push("Unit"),this.GridDataObj.TableColumns.push("Unit_Key"),this.GridDataObj.TableColumns.push("Remarks");var X=new f.a;X.Header="Name",X.DisplayMember="Name",X.Width=150,X.ReadOnly=!0,this.ColumnSource.push(X),(X=new f.a).Header=s.a.GetResource("Inv_TestType"),X.DisplayMember="Name",X.ValueMember="Value",X.ValueBinding="TestType";var q=[];q.push(m.d.ComboBoxItems_2("Numeric","0")),q.push(m.d.ComboBoxItems_2("Visual","1")),X.ComboData=q,X.DataType="ComboBox",X.Width=80,X.ReadOnly=!0,this.ColumnSource.push(X),(X=new f.a).Header=s.a.GetResource("Inv_Min"),X.DisplayMember="Min",X.DataType="TextBlock",X.Width=75,X.ReadOnly=!0,this.ColumnSource.push(X),(X=new f.a).Header=s.a.GetResource("Inv_Max"),X.DisplayMember="Max",X.DataType="TextBlock",X.Width=75,X.ReadOnly=!0,this.ColumnSource.push(X),(X=new f.a).Header=s.a.GetResource("CustomizeCostCenter_ProbableValues"),X.DisplayMember="ProbableValues",X.DataType="TextBlock",X.Width=120,X.ReadOnly=!0,this.ColumnSource.push(X),(X=new f.a).Header=s.a.GetResource("Inv_Variance"),X.DisplayMember="Variance",X.DataType="TextBlock",X.Width=80,X.ReadOnly=!0,this.ColumnSource.push(X),(X=new f.a).CostCenterID=11,X.TypeID=1,X.DataType="LISTBOX",X.DisplayMember="Unit",X.ValueMember="Unit_Key",X.Header="Unit",X.Width=100,this.ColumnSource.push(X),(X=new f.a).Header=s.a.GetResource("Inv_Sample"),X.DisplayMember="SampleNo",X.DataType="TextBlock",X.Width=80,X.ReadOnly=!0,this.ColumnSource.push(X),(X=new f.a).Header="Samplesize",X.DisplayMember="Samplesize",X.DataType="TextBlock",X.Width=80,X.ReadOnly=!0,this.ColumnSource.push(X),(X=new f.a).Header=s.a.GetResource("Inv_SampleType"),X.DisplayMember="Name",X.ValueMember="Value",X.ValueBinding="SampleType",(q=[]).push(m.d.ComboBoxItems_2("Value","0")),q.push(m.d.ComboBoxItems_2("Number","1")),q.push(m.d.ComboBoxItems_2("Percentage Value","2")),q.push(m.d.ComboBoxItems_2("Percentage Number","3")),X.ComboData=q,X.DataType="ComboBox",X.Width=120,X.ReadOnly=!0,this.ColumnSource.push(X),s.a.SessionManager.Preferences.ContainsKey("QCLabNameDimension")&&!o.e.IsEmpty(s.a.SessionManager.Preferences.QCLabNameDimension)&&0!=parseInt(s.a.SessionManager.Preferences.QCLabNameDimension)&&((X=new f.a).CostCenterID=parseInt(s.a.SessionManager.Preferences.QCLabNameDimension.toString()),X.TypeID=1,X.DataType="LISTBOX",X.DisplayMember="LabName",X.ValueMember="LabName_Key",X.Header="Lab Name",X.Width=100,this.ColumnSource.push(X),(X=new f.a).DisplayMember="ReportNo",X.Header="Report No.",X.DataType="TextBlock",X.Width=100,X.IsVisible=!0,this.ColumnSource.push(X),(X=new f.a).Header="Report Date",X.DisplayMember="ReportDate",X.ValueMember="ReportDate_Key",X.DataType="DATE",X.ReadOnly=!1,X.Width=100,this.ColumnSource.push(X)),(X=new f.a).DisplayMember="Remarks",X.Header=s.a.GetResource("Remarks"),X.DataType="TextBlock",X.Width=200,X.IsVisible=!0,this.ColumnSource.push(X)}this.GridDataObj.SearchVisible=!0}},{key:"GetCostCenterListViewData",value:function(e,t,n,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",o=[];return o.push(e),o.push(t),o.push(""),o.push(i),o.push(n),o.push(""),o.push(a),o.push(!1),o.push(""),o.push(""),o.push(r),o.push(""),o.push(""),o.push(0),o.push(!1),o.push(""),o.push(s.a.SessionManager.UserID),o.push(s.a.SessionManager.RoleID),o.push(s.a.SessionManager.LanguageID),s.a.common.GetCostCenterListViewData(s.a.SessionManager.CompanyIndex,o)}},{key:"SetVarible",value:function(e,t){var n=e.find((function(e){return e.DisplayMember==t.DisplayMember}));n&&(t.DisplayIndex=n.DisplayIndex,t.Width=n.Width,t.IsVisible=n.IsVisible,t.ReadOnly=n.ReadOnly)}},{key:"OnBeginedit",value:function(e){if(1==this.QtyType){var t=e.args.column.field;(i=this.ColumnSource.find((function(e){return e.DisplayMember==t}))).NoRoundOff&&"1"==e.Row.Item.Row.Islinked.toString()&&(e.Cancel=!0)}else if(2==this.QtyType){var n=e.args.item;if(this.Parent.ScreenObject.Preferences.ContainsKey("BOEAutoAdjustOnCellEnter")&&"TRUE"==this.Parent.ScreenObject.Preferences.BOEAutoAdjustOnCellEnter.toUpperCase()){var a=e.args.column.field;if("Qty"==a){var i,r="2";null!=(i=this.ColumnSource.find((function(e){return e.DisplayMember==a})))&&(r=i.DecimalPoints);var s,c=this.GridData.Compute("sum","Qty"),l=parseFloat(this.TextFields[2].Text);null!=c&&""!=c.toString()&&0!=parseFloat(c.toString())||(c=0),!o.e.IsEmpty(n.Qty)&&parseFloat(n.Qty.toString())>0&&(c=parseFloat(c.toString())-parseFloat(n.Qty.toString())),(s=parseFloat((l-parseFloat(c.toString())).ToString("N"+r)))>0&&!o.e.IsEmpty(n.AvailQty)&&parseFloat(n.AvailQty)>0&&(n.Qty=parseFloat(n.AvailQty)>=s?s:parseFloat(n.AvailQty)),null!=(c=this.GridData.Compute("SUM(Qty)",""))&&""!=c.toString()&&0!=parseFloat(c.toString())||(c=0),this.BOEAdjSummary="Qty. Adjusted  :  "+parseFloat(c.toString()).ToString("N"+r)+"  of  "+this.TextFields[2].Text+"  for the Product  :  "+this.TextFields[1].Text}}}else if(4==this.QtyType){var u=e.args.column.DgCol,d=e.args.column.field;if("DataGridPactListBoxColumn"==e.args.column.className&&"Unit"==d){var D,h=" (BaseID IN ";h+=" (SELECT     BaseID ",h=(h+=" FROM          COM_UOM AS COM_UOM_1 with(nolock) ")+" WHERE      (UOMID =(select UOMID from inv_product with(nolock) where productid="+(D=this.Parent.SelectedRow.ProductID_Key.toString())+") ))) ",""==D?(u.ProductID=0,h=" (BaseID IN ",h+=" (SELECT     BaseID ",h+=" FROM          COM_UOM AS COM_UOM_1 with(nolock) ",h+=" WHERE      (UOMID =-1 ))) "):u.ProductID=parseInt(D),u.FilterCondition=h}}}},{key:"onDoubleClick",value:function(e){this.IsSingleProd||3!=this.QtyType||!this.PackWise||null==this.SelectedRow||o.e.IsEmpty(this.SelectedRow.Label)||(this.TextFields[1].Text=this.SelectedRow.Label.toString(),this.EditPack(!1))}},{key:"oncelleditend",value:function(e){if("DataGridComboBoxColumn"!=e.column.className)if(1==this.QtyType){var t=e.item;this.ExecuteFormulas(t),this.ExecuteFormulas(t)}else if(0==this.QtyType){var n=e.column.field;"Amount"!=n&&"CalcAmount"!=n||this.calculate()}else if(2==this.QtyType){var a=e.item;if(null!=a&&o.e.Double(a.Qty)>0&&this.Parent.ScreenObject.GridDataColumns.Contains("BinWise")&&"True"==this.Parent.SelectedRow.BinWise.toString()&&(null==this.dtBins||0==this.dtBins.filter((function(e){return e.InvID==a.RefID})).length)){var i=this.Parent.SelectedRow,r=this.Parent.ScreenObject.GetinvBinDetails(a.RefID.toString(),i.ProductID_Key.toString(),i.LinkedInvDocDetailsID.toString());this.FillBins(r,0,a.RefID.toString())}var s="2",c=this.ColumnSource.find((function(e){return"Qty"==e.DisplayMember}));null!=c&&null!=c&&(s=c.DecimalPoints);var l=this.GridData.Compute("sum","Qty");null!=l&&""!=l.toString()&&0!=parseFloat(l.toString())||(l=0),this.BOEAdjSummary="Qty. Adjusted  :  "+parseFloat(l.toString()).ToString("N"+s)+"  of  "+this.TextFields[2].Text+"  for the Product  :  "+this.TextFields[1].Text}else if(3==this.QtyType&&"Qty"==e.column.field){var u=e.item;o.e.IsEmpty(u.Qty)||(this.Wt>0&&(u.pWeight=parseFloat(u.Qty)*this.Wt,u.cWeight=o.e.IsEmpty(u.UsedWeight)?u.pWeight.toString():parseFloat(u.UsedWeight)+parseFloat(u.pWeight)),this.Vol>0&&(u.pVolume=parseFloat(u.Qty)*this.Vol,u.cVolume=o.e.IsEmpty(u.UsedWeight)?u.pVolume.toString():parseFloat(u.UsedVolume)+parseFloat(u.pVolume)),this.GridDataObj.updateRow(u))}}},{key:"ExecuteFormulas",value:function(e){var t=this;this.fldDict.forEach((function(n){var a=t.ColumnSource.filter((function(e){return e.Header==t.fldDict[n.Key].getFieldName()}));o.e.IsNum(e[a[0].DisplayMember])?t.fldDict[n.Key].setFieldValue(null!=a[0].DecimalPoints&&""!=a[0].DecimalPoints?parseFloat(e[a[0].DisplayMember]).ToString("N"+a[0].DecimalPoints):e[a[0].DisplayMember]):t.fldDict[n.Key].setFieldValue(0)}));for(var n=this.fldDict,a=0;a<this.ColumnSource.length;a++){if(o.e.IsEmpty(this.ColumnSource[a].Formula))!o.e.IsEmpty(this.ColumnSource[a].DefaultValue)&&o.e.IsEmpty(e[this.ColumnSource[a].DisplayMember])&&(e[this.ColumnSource[a].DisplayMember]=this.ColumnSource[a].DefaultValue);else{var i=s.a.eval.EvaluateExpression(this.ColumnSource[a].Formula,n).toString();o.e.IsNum(i)&&(null!=this.ColumnSource[a].DecimalPoints&&""!=this.ColumnSource[a].DecimalPoints?e[this.ColumnSource[a].DisplayMember]=parseFloat(i).ToString("N"+this.ColumnSource[a].DecimalPoints):null!=i&&(e[this.ColumnSource[a].DisplayMember]=i.toString()))}if(this.ColumnSource[a].ShowTotal){for(var r=0,c=0;c<this.GridData.length;c++)o.e.IsEmpty(this.GridData[c][this.ColumnSource[a].DisplayMember])||(r+=parseFloat(this.GridData[c][this.ColumnSource[a].DisplayMember]));this.ColumnSource[a].footer=null!=this.ColumnSource[a].DecimalPoints&&""!=this.ColumnSource[a].DecimalPoints?r.ToString("N"+this.ColumnSource[a].DecimalPoints):r.toString(),this.UpdateFooter=!0}}}},{key:"calculate",value:function(){var e,t,n=this,a=null;o.e.IsType(this.Parent,"AddEditDocumentViewModel")?(a=this.Parent.SelectedRow,e=this.Parent.ScreenObject.GridDataObj.NewRow(),t=this.Parent.ScreenObject.GridDataColumns):this.Parent instanceof ce&&(a=this.Parent.SelectedRow);for(var i=0;i<t.length;i++){var r=this.exists(t[i]);e[t[i]]=this.flds.Contains(t[i])&&r>=0&&!o.e.IsEmpty(this.GridData[r].Amount)?this.GridData[r].Amount.toString():a[t[i]]}o.e.IsType(this.Parent,"AddEditDocumentViewModel")?this.Parent.CalculateTotals(e,!1):this.Parent instanceof ce&&this.Parent.Parent.CalculateTotals(e,!1);for(var s=function(a){if(!o.e.IsEmpty(n.GridData[a].Name)){var i=null;o.e.IsType(n.Parent,"AddEditDocumentViewModel")?i=n.Parent.ScreenObject.ColumnSource.find((function(e){return null!=e.DisplayMember&&e.DisplayMember.toLowerCase()==n.GridData[a].Name.toString().toLowerCase()})):n.Parent instanceof ce&&(i=n.Parent.Parent.ScreenObject.ColumnSource.find((function(e){return null!=e.DisplayMember&&e.DisplayMember.toLowerCase()==n.GridData[a].Name.toString().toLowerCase()}))),i&&!o.e.IsEmpty(e[n.GridData[a].Name.toString()])&&""!=i.DecimalPoints?(n.GridData[a].Amount=parseFloat(e[n.GridData[a].Name.toString()]).ToString("N"+i.DecimalPoints),t.Contains("dcCalc"+n.GridData[a].Name.toString())&&!o.e.IsEmpty(e["dcCalc"+n.GridData[a].Name.toString()])&&(n.GridData[a].CalcAmount=parseFloat(e["dcCalc"+n.GridData[a].Name.toString()]).ToString("N"+i.DecimalPoints))):(n.GridData[a].Amount=e[n.GridData[a].Name.toString()],t.Contains("dcCalc"+n.GridData[a].Name.toString())&&(n.GridData[a].CalcAmount=e["dcCalc"+n.GridData[a].Name.toString()]))}},c=0;c<this.GridData.length;c++)s(c);if(""!=this.Footerfld&&t.Contains(this.Footerfld)){var l=null;o.e.IsType(this.Parent,"AddEditDocumentViewModel")?l=this.Parent.ScreenObject.ColumnSource.find((function(e){return null!=e.DisplayMember&&e.DisplayMember.toLowerCase()==n.Footerfld.toLowerCase()})):this.Parent instanceof ce&&(l=this.Parent.Parent.ScreenObject.ColumnSource.find((function(e){return null!=e.DisplayMember&&e.DisplayMember.toLowerCase()==n.Footerfld.toLowerCase()}))),l&&!o.e.IsEmpty(e[this.Footerfld])&&""!=l.DecimalPoints?(this.FooterValue=parseFloat(e[this.Footerfld]).ToString("N"+l.DecimalPoints),t.Contains("dcCalc"+this.Footerfld)&&!o.e.IsEmpty(e["dcCalc"+this.Footerfld])&&(this.FooterCalcValue=parseFloat(e["dcCalc"+this.Footerfld]).ToString("N"+l.DecimalPoints))):(this.FooterValue=e[this.Footerfld].toString(),t.Contains("dcCalc"+this.Footerfld)&&(this.FooterCalcValue=e["dcCalc"+this.Footerfld].toString()))}}},{key:"exists",value:function(e){for(var t=0;t<this.GridData.length;t++)if(this.GridData[t].Name.toString()==e)return t;return-1}},{key:"SaveBoe_Empty",value:function(){null!=this.Parent.SelectedRow?this.SaveBoe(this.Parent.SelectedRow):7==this.QtyType&&this.SaveBoe(null)}},{key:"SaveBoe",value:function(e){var t=this,n=!1;this.Parent.ScreenObject.Preferences.ContainsKey("ClubBoe")&&"True"==this.Parent.ScreenObject.Preferences.ClubBoe&&!this.SelectedRowEditing&&(n=!0);var a,i=0,r=0;if(s.a.SessionManager.IsWebApplication){var c=0;if(this.GridData.length>0){for(var l=0;l<this.GridData.length;l++)o.e.IsEmpty(this.GridData[l].Qty)||(c+=parseFloat(this.GridData[l].Qty));if(c>parseFloat(e.Quantity))return void(this.DisplayMessage="Quantity can not be greater than actual qty.");c<parseFloat(e.Quantity)&&(i=parseFloat(e.Quantity)-c)}}else if(2==this.QtyType){var u=this.GridData.Compute("sum","Qty"),d="2",D=this.ColumnSource.find((function(e){return"Qty"==e.DisplayMember}));if(null!=D&&null!=D&&(d=D.DecimalPoints),null!=u&&""!=u.toString()&&(u=parseFloat(u.toString()).ToString("N"+d)),r=parseFloat(this.TextFields[2].Text),null!=u&&!o.e.IsEmpty(u)&&parseFloat(u)>r)return void(this.DisplayMessage="Quantity can not be greater than actual qty.");if(!n&&null!=u&&!o.e.IsEmpty(u)&&parseFloat(u)<r&&(i=parseFloat(e.Quantity)-parseFloat(u)),null!=e&&!o.e.IsEmpty(e.DocDetailsID)&&"0"!=e.DocDetailsID.toString())for(var h=0;h<this.GridData.length;h++)if(!o.e.IsEmpty(this.GridData[h].Qty)&&!o.e.IsEmpty(this.GridData[h].AvailQty)&&parseFloat(this.GridData[h].AvailQty)<parseFloat(this.GridData[h].Qty))return void(this.DisplayMessage="Can not adjust more than available for "+this.GridData[h].RefID.toString());if(this.Parent.ScreenObject.Preferences.ContainsKey("BOEValidateActualAndAdjustedQtys")&&"TRUE"==this.Parent.ScreenObject.Preferences.BOEValidateActualAndAdjustedQtys.toUpperCase()){for(var S=0;S<this.GridData.length;S++)if(null!=this.GridData[S].Qty&&null!=this.GridData[S].Qty&&""!=this.GridData[S].Qty.toString()&&null!=this.GridData[S].AvailQty&&null!=this.GridData[S].AvailQty&&""!=this.GridData[S].AvailQty.toString()&&parseFloat(this.GridData[S].AvailQty.toString())<parseFloat(this.GridData[S].Qty.toString()))return this.DisplayMessage="You can not adjust more than Available Quantity for "+o.e.String(this.GridData[S].RefID),void(this.MessageVisibility=!0);if(0!=i)return this.DisplayMessage="Sum of Quantity should be Equal to the Actual Quantity",void(this.MessageVisibility=!0)}}var m,b=0;m=2==this.QtyType?this.Parent.ScreenObject.GridData.indexOf(e):this.Parent.GetEmptyRowPosition(this.Parent.ScreenObject.GridDataObj,"ProductID_Key");var C,y,p=new o.f;if(this.Parent.ScreenObject.Preferences.ContainsKey("BilllandingMap")&&""!=this.Parent.ScreenObject.Preferences.BilllandingMap&&p.ReadXml(this.Parent.ScreenObject.Preferences.BilllandingMap),n)!function(){C=t.Parent.ScreenObject.GridData.filter((function(e){return 0==e.DocDetailsID&&e.ProductID_Key==t.Parent.SelectedRow.ProductID_Key}));for(var e=0;e<C.length;e++)C[e].DocExtraXML=null,C[e].BOEID=null,C[e].BinsXML=null;for(var n=0,i=null,r=function(e){if(!o.e.IsEmpty(t.GridData[e].RefID)&&o.e.DoubleTryParse(t.GridData[e].Qty)>0){if(a=o.e.DoubleTryParse(t.GridData[e].Qty),(y=C.filter((function(n){return n!=i&&!o.e.IsEmpty(n.LinkedBoe)&&n.LinkedBoe.toString()==t.GridData[e].RefID.toString()}))).length>0){for(var r=0;r<y.length;r++){if(parseFloat(y[r].Quantity)>a){t.FillData(y[r],e,p,a),a=0;break}if(!(a>0))break;var s=y[r];if(a-=parseFloat(s.Quantity),t.FillData(s,e,p,parseFloat(s.Quantity)),C.Remove(s),0==a)break}if(0==a)return"continue"}if((y=C.filter((function(e){return e!=i&&!o.e.IsEmpty(e.Quantity)&&parseFloat(e.Quantity)==a}))).length>0){var c=y[0];t.FillData(c,e,p,a),C.Remove(c)}else if(C.length>0)if(n>0){var l=t.Parent.ScreenObject.GridDataObj.NewRow();if(m=t.Parent.ScreenObject.GridData.indexOf(i),t.Parent.ScreenObject.GridDataObj.insertRowAt(l,m),t.FillDatarow(l,i),n>a)n-=a,l.Quantity=a,t.FillData(l,e,p,a);else if(a-=n,l.Quantity=n,t.FillData(l,e,p,n),C.Remove(i),n=0,i=null,a>0)for(var u=0;u<C.length;u++){if(parseFloat(C[u].Quantity)>a){n=parseFloat(C[u].Quantity)-a,(i=C[u]).Quantity=a,t.FillData(i,e,p,a);break}if(!(a>0))break;if(l=C[u],a-=parseFloat(l.Quantity),t.FillData(l,e,p,parseFloat(l.Quantity)),C.Remove(l),u--,0==a)break}}else for(var d=0;d<C.length;d++){if(parseFloat(C[d].Quantity)>a){n=parseFloat(C[d].Quantity)-a,(i=C[d]).Quantity=a,t.FillData(i,e,p,a);break}if(!(a>0))break;var D=C[d];if(a-=parseFloat(D.Quantity),t.FillData(D,e,p,parseFloat(D.Quantity)),C.Remove(D),d--,0==a)break}}},s=0;s<t.GridData.length;s++)r(s);null!=i&&n>0&&(i.Quantity=parseFloat(i.Quantity)+n,o.e.IsEmpty(i.UOMConversion)&&(i.UOMConversion="1"),i.UOMConvertedQty=o.e.IsEmpty(i.UOMConversion)||o.e.IsEmpty(i.Quantity)?i.Quantity:parseFloat(i.UOMConversion)*parseFloat(i.Quantity),t.Parent.CalculateTotals(i,!1))}();else for(var g=0;g<this.GridData.length;g++)if(!o.e.IsEmpty(this.GridData[g].RefID)&&o.e.DoubleTryParse(this.GridData[g].Qty)>0){var f=void 0;a=o.e.DoubleTryParse(this.GridData[g].Qty),b++,2==this.QtyType&&1==b?f=e:(f=this.Parent.ScreenObject.GridDataObj.NewRow(),2==this.QtyType?m+b-1>this.Parent.ScreenObject.GridData.length?this.Parent.ScreenObject.GridDataObj.addRow(f):this.Parent.ScreenObject.GridDataObj.insertRowAt(f,m+b-1):this.Parent.ScreenObject.GridDataObj.insertRowAt(f,m),2==this.QtyType?this.FillDatarow(f,e):(f.ProductID_Key=this.GridData[g].ProductID.toString(),f.Quantity=a,this.Parent.ProdID=0,this.Parent.AddProductData(f,!1,!1,!1,null,null))),this.Parent.ScreenObject.GridDataColumns.Contains("BOEAdjusted")&&(f.BOEAdjusted="1"),f.Quantity=2==this.QtyType&&i>0&&1==b?parseFloat(this.GridData[g].Qty)+i:this.GridData[g].Qty.toString(),this.FillData(f,g,p,a)}(b>1||7==this.QtyType)&&this.Parent.ScreenObject.UpdateSequence()}},{key:"FillDatarow",value:function(e,t){for(var n=this.Parent.ScreenObject.GridDataColumns,a=0;a<n.length;a++)"BinsXML"!=n[a]&&"DocExtraXML"!=n[a]&&"BOEID"!=n[a]&&(e[a]="DocDetailsID"==n[a]||"TODocDetailsID"==n[a]?0:t[a])}},{key:"FillData",value:function(e,t,n,a){var i=this,r="";if(r+='<DocExtraXML><Row  RefID="'+this.GridData[t].RefID.toString()+'" ',r+='Qty="'+a+'" Type="',this.Parent.ScreenObject.Preferences.ContainsKey("BOEInv")&&"True"==this.Parent.ScreenObject.Preferences.BOEInv?r+="11":r+=this.GridData[t].Type.toString(),r+='" /></DocExtraXML>',o.e.IsEmpty(e.UOMConversion)&&(e.UOMConversion="1"),e.UOMConvertedQty=o.e.IsEmpty(e.UOMConversion)||o.e.IsEmpty(e.Quantity)?e.Quantity:parseFloat(e.UOMConversion)*parseFloat(e.Quantity),e.DocExtraXML=r.toString(),e.BOEID=this.GridData[t].RefID.toString(),n.Tables.length>0&&n.Columns[0].Contains("ColID")&&n.Tables[0].length>0)for(var c=0;c<n.Tables[0].length;c++)this.GridDataObj.TableColumns.Contains(n.Tables[0][c].ReportCol.toString())&&(this.GridDataObj.TableColumns.Contains(n.Tables[0][c].ReportCol.toString()+"_ID")&&!o.e.IsEmpty(this.GridData[t][n.Tables[0][c].ReportCol.toString()+"_ID"])?this.Parent.ScreenObject.SetValueBYCOLID(n.Tables[0][c].ColID.toString(),this.GridData[t][n.Tables[0][c].ReportCol.toString()].toString(),this.GridData[t][n.Tables[0][c].ReportCol.toString()+"_ID"].toString(),e):this.Parent.ScreenObject.SetValueBYCOLID(n.Tables[0][c].ColID.toString(),this.GridData[t][n.Tables[0][c].ReportCol.toString()].toString(),"",e));if(7==this.QtyType&&this.GridData[t].ProductID.toString()==this.Parent.ScreenObject.TempProductID.toString()){var u=this.Parent.ScreenObject.ColumnSource.find((function(e){return!o.e.IsEmpty(e.ValueMember)&&"productid_key"==e.ValueMember.toLowerCase()&&!o.e.IsEmpty(e.Shortcut)&&"lostfocus"==e.Shortcut.toLowerCase()}));u&&this.Parent.ScreenObject.GetExternalFuncData(u.Mode,u.SPName,u.IPParams,u.OPParams,e)}if(this.Parent.CalculateTotals(e,!1,"",!1),!(this.Parent.ScreenObject.Preferences.ContainsKey("BOEInv")&&"True"==this.Parent.ScreenObject.Preferences.BOEInv||this.Parent.ScreenObject.Preferences.ContainsKey("BinvInv")&&"True"==this.Parent.ScreenObject.Preferences.BinvInv)){if(this.Parent.ScreenObject.Preferences.ContainsKey("ClubBoe")&&"True"==this.Parent.ScreenObject.Preferences.ClubBoe&&!this.SelectedRowEditing&&Object(l.j)(e.BinWise))if(null==this.dtBins){var d=this.Parent.ScreenObject.GetinvBinDetails(this.GridData[t].RefID.toString(),e.ProductID_Key.toString(),e.LinkedInvDocDetailsID.toString());this.FillBins(d,0,this.GridData[t].RefID.toString())}else if(0==(P=this.dtBins.filter((function(e){return e.InvID==i.GridData[t].RefID}))).length){var D=this.Parent.ScreenObject.GetinvBinDetails(this.GridData[t].RefID.toString(),e.ProductID_Key.toString(),e.LinkedInvDocDetailsID.toString());this.FillBins(D,0,this.GridData[t].RefID.toString())}if(2==this.QtyType&&null!=this.dtBins){var h=0,S=0,m=0,b=0,y=!1;if(s.a.SessionManager.Preferences.ContainsKey("DimensionwiseBins")&&""!=s.a.SessionManager.Preferences.DimensionwiseBins.toString()&&(S=o.e.IntTryParse(s.a.SessionManager.Preferences.DimensionwiseBins))>0){h=1;for(var p=0;p<this.Parent.ScreenObject._CCFields.length;p++){var g=this.Parent.ScreenObject._CCFields[p];if(g instanceof C.b&&g.CCID==S){g.SelectedValue>0&&(h=g.SelectedValue),y=!0;break}}y||null!=this.SelectedRow&&S>5e4&&this.Parent.ScreenObject.GridDataObj.TableColumns.Contains("dcCCNID"+(S-5e4).toString()+"_Key")&&o.e.Int(e["dcCCNID"+(S-5e4).toString()+"_Key"])>0&&(h=parseInt(e["dcCCNID"+(S-5e4).toString()+"_Key"]))}if(o.e.IsEmpty(e.DocDetailsID)||parseInt(e.DocDetailsID),!(S>5e4)||this.Parent.ScreenObject.IsBinWise(S,h)){this.Parent.ScreenObject.Preferences.ContainsKey("BinFilterDim")&&!o.e.IsEmpty(this.Parent.ScreenObject.Preferences.BinFilterDim)&&((b=o.e.IntTryParse(this.Parent.ScreenObject.Preferences.BinFilterDim))>0&&(m=this.Parent.GetDimValue(b,e)));var f=this.Parent.VoucherType;30==this.Parent.ScreenObject.DocumentType&&this.Parent.ScreenObject.GridDataObj.TableColumns.Contains("VoucherType")&&!o.e.IsEmpty(e.VoucherType)&&(f=parseInt(e.VoucherType));var O=0;-1!=f||o.e.IsEmpty(e.LinkedInvDocDetailsID)||(O=o.e.IntTryParse(e.LinkedInvDocDetailsID));for(var I=this.Parent.ScreenObject.GetProductwiseBins(parseInt(e.ProductID_Key),this.Parent.ScreenObject.DocID,f,this.Parent.DocumentDate,S,h,b,m,O,0,0,this.Parent.GetBOEIDS(e)),T=new le.a(this.Parent,f,a,parseInt(e.ProductID_Key),e.ProductName.toString(),I,e),j=0;j<T.BinsGrid.Table.length;j++)o.e.IsEmpty(T.BinsGrid.Table[j].NodeID)||o.e.IsEmpty(T.BinsGrid.Table[j].Allocate)||(a-=parseFloat(T.BinsGrid.Table[j].Allocate));for(var P=this.dtBins.filter((function(e){return e.InvID==i.GridData[t].RefID})),A=function(e){if((v=i.dtBinsColumns.Contains("InvDocDetailsID")&&T.BinsGrid.TableColumns.Contains("InvID")?T.BinsGrid.Table.filter((function(t){return t.NodeID==P[e].BinID&&t.InvID==P[e].InvDocDetailsID})):T.BinsGrid.Table.filter((function(t){return t.NodeID==P[e].BinID}))).length>0&&a>0)if(o.e.IsEmpty(v[0].Allocate))a>parseFloat(P[e].Qty)?(v[0].Allocate=P[e].Qty.toString(),T.celledtiend(v[0]),a-=parseFloat(v[0].Allocate)):(v[0].Allocate=a,T.celledtiend(v[0]),a-=parseFloat(v[0].Allocate));else{var t=parseFloat(v[0].Allocate);a>parseFloat(P[e].Qty)?(v[0].Allocate=t+parseFloat(P[e].Qty),T.celledtiend(v[0]),a-=parseFloat(v[0].Allocate)-t):(v[0].Allocate=t+a,T.celledtiend(v[0]),a-=parseFloat(v[0].Allocate)-t)}},M=0;M<P.length;M++){var v;A(M)}T.OnSave("AutoSave")}}}}},{key:"OnButtonClick",value:function(e){var t=this;if(null!=e&&"Cancel"==e.toString())s.a.page.HideDialog();else if(null!=e&&"Load"==e.toString()){var n=this.LoadBoes("",this.Parent.SelectedRow);this.FillBoeData(n)}else null!=e&&"AutoAdjust"==e.toString()?this.DoAutoAdjustments():"ParentImportBtn"==e.toString()?this.ImportScrVisibility=!0:"openfile"==e.toString()||"Open"==e.toString()||("SubImportBtn"==e.toString()?this.ImportData():"CancelImport"==e.toString()&&(this.ImportScrVisibility=!1));if(null!=e&&"OK"==e.toString()||"AutoResave"==e.toString()){if(1==this.QtyType){for(var a=this.Parent.SelectedRow,i=function(e){var n="";if(t.ColumnSource[e].Action>0?n="dcNum"+t.ColumnSource[e].Action:-2==t.ColumnSource[e].Action?n="Quantity":-3==t.ColumnSource[e].Action?n="Rate":-4==t.ColumnSource[e].Action&&(n="Gross"),""!=n){for(var i=0,r=0;r<t.GridData.length;r++)o.e.IsEmpty(t.GridData[r][t.ColumnSource[e].DisplayMember])||(i+=parseFloat(t.GridData[r][t.ColumnSource[e].DisplayMember]));if(!o.e.IsEmpty(a[n])&&parseFloat(a[n]).ToString("N0")!=i.ToString("N0"))return c=t.Parent.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember.toLowerCase()==n.toLowerCase()})),{v:void(t.DisplayMessage=t.ColumnSource[e].Header+" is not equal to "+c.Header)}}},r=0;r<this.ColumnSource.length;r++){var c,l=i(r);if("object"==typeof l)return l.v}if(a.QtyXML=this.GetXml("QtyAdjustments",null,""),this.Parent.ScreenObject.Preferences.ContainsKey("QtyAdjustmentField")&&""!=this.Parent.ScreenObject.Preferences.QtyAdjustmentField&&this.Parent.ScreenObject.GridDataObj.TableColumns.Contains(this.Parent.ScreenObject.Preferences.QtyAdjustmentField)){var u=this.ColumnSource.find((function(e){return 1==e.IsReEvaluate}));u&&!o.e.IsEmpty(u.footer)&&(a[this.Parent.ScreenObject.Preferences.QtyAdjustmentField]=u.footer)}}else if(0==this.QtyType){var d,D=null;o.e.IsType(this.Parent,"AddEditDocumentViewModel")?(D=this.Parent.SelectedRow,d=this.Parent.ScreenObject.GridDataObj.TableColumns):this.Parent instanceof ce&&(D=this.Parent.SelectedRow,d=this.Parent.GridDataObj.TableColumns);for(var S=0;S<this.GridData.length;S++)o.e.IsEmpty(this.GridData[S].Name)||o.e.IsEmpty(this.GridData[S].Amount)||(D[this.GridData[S].Name.toString()]=this.GridData[S].Amount,d.Contains("dcCalc"+this.GridData[S].Name.toString())&&(D["dcCalc"+this.GridData[S].Name.toString()]=this.GridData[S].CalcAmount));o.e.IsType(this.Parent,"AddEditDocumentViewModel")?this.Parent.CalculateTotals(D,!1):this.Parent instanceof ce&&this.Parent.Parent.CalculateTotals(D,!1)}else if(2==this.QtyType||7==this.QtyType){if(this.DisplayMessage="",this.SaveBoe_Empty(),""!=this.DisplayMessage)return}else if(3==this.QtyType){if(this.PackWise&&!this.IsSingleProd){if(this.TextFields.length<12)return;this.Parent.DtPack.Clear();for(var b=0;b<this.Parent.ScreenObject.GridData.length;b++)this.Parent.ScreenObject.GridData[b].PackXML=null;for(var C=0;C<this.GridData.length;C++){var y=this.GridData[C],p=[];if(p.ID=y.RefID,p.Name=y.Name,p.Label=y.Label,p.cWeight=y.cWeight,p.cVolume=y.cVolume,p.Weight=y.Weight,p.Volume=y.Volume,p.length=y.length,p.Width=y.width,p.Height=y.height,p.Data=y.Data,!o.e.IsEmpty(y.Data))for(var g=y.Data.toString().split(","),f=function(e){var n=g[e].split("~"),a=t.Parent.ScreenObject.GridData.filter((function(e){return e.Unq==n[0]}));if(a.length>0){var i="";i+="<Row ",o.e.IsEmpty(y.length)||(i+=' Fld1="'+y.length.toString()+'" '),o.e.IsEmpty(y.Width)||(i+=' Fld2="'+y.Width.toString()+'" '),o.e.IsEmpty(y.Height)||(i+=' Fld3="'+y.Height.toString()+'" '),o.e.IsEmpty(y.ActualWeight)||(i+=' Fld4="'+y.ActualWeight.toString()+'" '),o.e.IsEmpty(y.ActualVolume)||(i+=' Fld5="'+y.ActualVolume.toString()+'" '),i+=' Type="2" ',i+=' Label="'+y.Label.toString()+'" ',i+=' RefID="'+y.RefID.toString()+'" ',i+=' Qty="'+n[1]+'" ',i+=' Volume="'+y.Weight.toString()+'" ',i+=' Weight="'+y.Volume.toString()+'" ',i+=" />",a[0].PackXML=o.e.IsEmpty(a[0].PackXML)?i.toString():a[0].PackXML.toString()+i.toString()}},O=0;O<g.length;O++)f(O);o.e.IsEmpty(y.ActualWeight)||(p.ActualWeight=y.ActualWeight),o.e.IsEmpty(y.ActualVolume)||(p.ActualVolume=y.ActualVolume),this.Parent.DtPack.push(p)}for(var I=0;I<this.Parent.ScreenObject.GridData.length;I++)o.e.IsEmpty(this.Parent.ScreenObject.GridData[I].PackXML)||(this.Parent.ScreenObject.GridData[I].PackXML="<DocExtraXML>"+this.Parent.ScreenObject.GridData[I].PackXML.toString()+"</DocExtraXML>")}else{var T=this.GridData.Compute("sum","Qty");if(null==T||o.e.Double(T)!=o.e.Double(this.Parent.SelectedRow.Quantity))return void(this.DisplayMessage="Quantity not equal");var j="";this.PackWise&&this.IsSingleProd&&(j=this.Parent.SelectedRow.Unq.toString());var P="";this.GridData.forEach((function(e){o.e.IsEmpty(e.Qty)||(P+="<Row ",o.e.IsEmpty(e.length)||(P+=' Fld1="'+e.length.toString()+'" '),o.e.IsEmpty(e.Width)||(P+=' Fld2="'+e.Width.toString()+'" '),o.e.IsEmpty(e.Height)||(P+=' Fld3="'+e.Height.toString()+'" '),o.e.IsEmpty(e.ActualWeight)||(P+=' Fld4="'+e.ActualWeight.toString()+'" '),o.e.IsEmpty(e.ActualVolume)||(P+=' Fld5="'+e.ActualVolume.toString()+'" '),P+=' Type="'+e.Type.toString()+'" ',P+=' Label="'+e.Label.toString()+'" ',P+=' RefID="'+e.RefID.toString()+'" ',P+=' Qty="'+e.Qty.toString()+'" ',P+=' Volume="'+t.Vol+'" ',P+=' Weight="'+t.Wt+'" ',P+=" />")})),P.length>0&&(P="<DocExtraXML>"+P+"</DocExtraXML>"),this.Parent.SelectedRow.PackXML=P.toString();for(var A=function(e){var n=void 0,a=t.GridData[e],i=t.Parent.DtPack.filter((function(e){return e.Label==a.Label.toString()}));if(i.length>0){if((n=i[0]).cWeight=a.cWeight,n.cVolume=a.cVolume,t.IsSingleProd){if(t.Parent.DtPackColumns.Contains("Data")&&n.Data.toString().Contains(j+"~")){var r=n.Data.toString().indexOf(j+"~"),s=n.Data.toString().indexOf(",",r);n.Data=s>0?n.Data.toString().Remove(r,s-r+1):r>0?n.Data.toString().Remove(r-1):null}o.e.Double(a.Qty)>0&&(n.Data=o.e.IsEmpty(n.Data)?j+"~"+a.Qty.toString():n.Data.toString()+","+j+"~"+a.Qty.toString())}}else(n={}).ID=a.RefID,n.Name=a.Name,n.Label=a.Label,n.cWeight=a.cWeight,n.cVolume=a.cVolume,n.Weight=a.Weight,n.Volume=a.Volume,n.length=a.length,n.Width=a.width,n.Height=a.height,t.IsSingleProd&&t.Parent.DtPackColumns.Contains("Data")&&parseFloat(a.Qty)>0&&(n.Data=j+"~"+a.Qty.toString()),t.Parent.DtPack.push(n)},M=0;M<this.GridData.length;M++)A(M)}var v,G,N=this.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&55848==e.LinkData}));N.length>0&&(v=this.Parent.ScreenObject._TextFields.find((function(e){return e.DBColumnID.toString()==N[0].CostCenterColID.toString()})))&&v instanceof h.d&&(v.Text=this.Parent.DtPack.length.toString()),(N=this.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&55849==e.LinkData}))).length>0&&(v=this.Parent.ScreenObject._TextFields.find((function(e){return e.DBColumnID.toString()==N[0].CostCenterColID.toString()})))&&v instanceof h.d&&null!=(G=this.Parent.DtPack.Compute("sum","ActualWeight"))&&(v.Text=G.toString()),(N=this.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&56672==e.LinkData}))).length>0&&null!=(v=this.Parent.ScreenObject._TextFields.find((function(e){return e.DBColumnID.toString()==N[0].CostCenterColID.toString()})))&&v instanceof h.d&&this.Parent.DtPackColumns.Contains("ActualVolume")&&null!=(G=this.Parent.DtPack.Compute("sum","ActualVolume"))&&(v.Text=G.toString())}else if(4==this.QtyType){var E;if(!o.e.IsNum(this.TextFields[1].Text))return void(this.DisplayMessage="Enter valid iteration");E=parseFloat(this.TextFields[1].Text);var w="";this.GridData.forEach((function(e){w+="<Row ",w+=' RefID="'+e.RefID.toString()+'" ',w+=' Type="3" ',w+=' Qty="'+e.SampleNo.toString()+'" ',o.e.IsEmpty(e.Retest)||(w+=' Label="'+e.Retest.toString()+'" '),s.a.SessionManager.Preferences.ContainsKey("QCLabNameDimension")&&!o.e.IsEmpty(s.a.SessionManager.Preferences.QCLabNameDimension)&&0!=parseInt(s.a.SessionManager.Preferences.QCLabNameDimension)&&(o.e.IsEmpty(e.LabName_Key)||(w+=' LabID="'+e.LabName_Key.toString()+'" '),o.e.IsEmpty(e.ReportNo)||(w+=' ReportNo="'+e.ReportNo.toString()+'" '),o.e.IsEmpty(e.ReportDate_Key)||(w+=' ReportDate="'+new Date(e.ReportDate_Key).ToString("dd MMM yyyy")+'" ')),o.e.IsEmpty(e.Unit_Key)||(w+=' Unit="'+e.Unit_Key.toString()+'" '),o.e.IsEmpty(e.Remarks)||(w+=' Remarks="'+h.d.GetValidXml(e.Remarks.toString())+'" ');for(var n=0;n<parseInt(E);n++)t.GridDataObj.TableColumns.Contains("Result"+(n+1))&&(w+=" Fld"+n+'1="'+h.d.GetValidXml(e["Result"+(n+1)])+'" ');w+=" />"})),w.length>0&&(w="<DocExtraXML>"+w+"</DocExtraXML>"),this.Parent.SelectedRow.TestCaseXML=w.toString(),this.TextFields.length>2&&this.TextFields[2]instanceof m.h&&(this.Parent.SelectedRow[this.TextFields[2].DBColumnName]=this.TextFields[2].Text)}if(5==this.QtyType){this.SetColSize=!0,"&lt;XML",o.e.IsEmpty(this.TextFields[0].SelectedValue)||" ProdList='"+this.TextFields[0].SelectedValue+"'"," &gt;",this.ColumnSource.forEach((function(e){"&lt;Row Name='"+e.ValueBinding+"' WIDTH='"+e.Width,t.GridData.length>0&&"' Visible='"+t.GridData[0][e.ValueBinding].toString(),"' Header='"+e.Header+"' index='"+e.DisplayIndex+"' /&gt;"})),"&lt;/XML&gt;"}"AutoResave"!=e.toString()&&s.a.page.HideDialog()}}},{key:"ImportData",value:function(){}},{key:"DoAutoAdjustments",value:function(){if(1==this.QtyType){for(var e=this.Parent.SelectedRow,t=0,n=0,a=0,i="",r="",s="0",c=0;c<this.GridData.length;c++)for(var l=0;l<this.ColumnSource.length;l++){var u="";this.ColumnSource[l].Action>0?u="dcNum"+this.ColumnSource[l].Action:-2==this.ColumnSource[l].Action?u="Quantity":-3==this.ColumnSource[l].Action?u="Rate":-4==this.ColumnSource[l].Action&&(u="Gross"),-5==this.ColumnSource[l].Action&&(s=this.ColumnSource[l].DecimalPoints,r=this.ColumnSource[l].DisplayMember),""!=u&&(this.ColumnSource[l].DecimalPoints,i=this.ColumnSource[l].DisplayMember,0==c&&(o.e.IsEmpty(e[u])||(t=parseFloat(e[u].toString()))),null!=this.GridData[c][this.ColumnSource[l].DisplayMember]&&null!=this.GridData[c][this.ColumnSource[l].DisplayMember]&&""!=this.GridData[c][this.ColumnSource[l].DisplayMember].toString()&&0!=parseFloat(this.GridData[c][i].toString())&&(""!=r&&(this.GridData[c][r]=0,this.ExecuteFormulas(this.GridData[c]),this.ExecuteFormulas(this.GridData[c])),n+=parseFloat(this.GridData[c][this.ColumnSource[l].DisplayMember].toString()),a++))}if(a>0){var d=0,D=0,h=0,S=n-t;if(0!=S){D=parseFloat((Math.abs(S)/a).ToString("N"+s)),h=0;for(var m=0;m<this.GridData.length;m++)if(null!=this.GridData[m][i]&&null!=this.GridData[m][i]&&""!=this.GridData[m][i].toString()&&0!=parseFloat(this.GridData[m][i].toString())){d++;for(var b=0;b<this.ColumnSource.length;b++)-5==this.ColumnSource[b].Action&&(this.GridData[m][this.ColumnSource[b].DisplayMember]=d==a?S>0?-1*(S-h):Math.abs(S)-h:S>0?-1*D:D,h+=D,this.ExecuteFormulas(this.GridData[m]),this.ExecuteFormulas(this.GridData[m]))}}}}}},{key:"GetXml",value:function(e,t,n){var a,i,r=this,s="";return this.GridData.forEach((function(e){if(i=0,a="",""==n||!o.e.IsEmpty(e[n])){for(var c=0;c<r.ColumnSource.length;c++)null!=t&&!t.Contains(r.ColumnSource[c].DisplayMember)||o.e.IsEmpty(e[r.ColumnSource[c].DisplayMember])||(1!=r.QtyType||"LISTBOX"!=r.ColumnSource[c].DataType||o.e.IsEmpty(e[r.ColumnSource[c].ValueMember])?a+="FLOAT"==r.ColumnSource[c].DataType?r.ColumnSource[c].DisplayMember+'="'+e[r.ColumnSource[c].DisplayMember].toString().Replace(",","")+'" ':r.ColumnSource[c].DisplayMember+'="'+e[r.ColumnSource[c].DisplayMember].toString()+'" ':(a+=r.ColumnSource[c].DisplayMember+'="'+e[r.ColumnSource[c].ValueMember].toString()+'" ',a+=r.ColumnSource[c].ValueMember+'="'+h.d.GetValidTextXml(e[r.ColumnSource[c].DisplayMember])+'" '),i++);1==r.QtyType&&(o.e.IsEmpty(e.Islinked)?a+='Islinked="0"':a+='Islinked="1"')}i>0&&(a="<Row "+a,3==r.QtyType&&(a+=' Volume="'+r.Vol+'" ',a+=' Weight="'+r.Wt+'" '),s+=(a+=" />").toString())})),s.length>0&&(s="<"+e+">"+s+"</"+e+">"),s.toString()}},{key:"ScanMobile",value:function(e){this.TextFields.length>0&&null!=this.TextFields[0]&&"Enter"==e&&this.MainScan()}},{key:"BOEAdjustFIFO",get:function(){return this.BOEAdjustFIFOObj.IsChecked}},{key:"GridData",get:function(){return this.GridDataObj.Table}},{key:"SetColSize",set:function(e){}},{key:"ColumnSource",get:function(){return this.GridDataObj.Columns},set:function(e){this.GridDataObj.Columns=e}},{key:"SetFocusongrid",set:function(e){}},{key:"UpdateFooter",set:function(e){}},{key:"RefreshGrid",set:function(e){}},{key:"SelectedRow",get:function(){return this.GridDataObj.SelectedItem},set:function(e){this.GridDataObj.SelectedItem=e}}]),n}(u.b),de=n("G0MU"),De=n("F3jS"),he=n("keYA"),Se=n("iR3C"),me=n("N0aR"),be=n("4/f/"),Ce=n("EUZL"),ye=((a=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,a,i,r,c){var u;_classCallCheck(this,n),(u=t.call(this)).BindingPath="",u.AssetQty=0,u.Vtype=0,u.drSel=null,u.AvailableStatusID=0,u.SoldStatusID=0,u.dtSerials=[],u.dtProdSerial=[],u.GridDataObj=new V.a,u.SerialNumber=new h.d(0),u.Qty=new h.d(0),u.Separator=new h.d(0),u.MultiVisiblility=!1,u.Scanmulitple=!1,u.AddVisiblility=!1,u._SelectALL=!1,u.ActualFileName="",u.ExcelData=[],u.SerialNumber.Label=s.a.GetResource("SerialNo"),u.Qty.Label=s.a.GetResource("SerialNo_Qty"),u.Separator.Label="Separator",u.GridDataObj.Columns=[],u.GridDataObj.SelectAll.Visible=!0,u.Vtype=i,u.BindingPath=a,u.Qty.DataType="INT",u.Qty.Text="1",u.AssetQty=r,u.drSel=c,u.Parent=e,u.Parent.ScreenObject.GridDataColumns.Contains("ProductName")?u.pName=c.ProductName.toString():u.Parent.ScreenObject.GridDataColumns.Contains("ProductCode")&&(u.pName=c.ProductCode.toString()),1==u.Vtype||-1==u.Vtype?(u.Qty.Visible=!0,u.AddVisiblility=!0,n.SearchVisibility=!1,u.Title=s.a.GetResource("SerialNo_Title")):(u.Qty.Visible=!1,u.AddVisiblility=!1,n.SearchVisibility=!0,u.Title=s.a.GetResource("SelectSerialNo"));var d,D=0,S=0;s.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&Object(l.j)(s.a.SessionManager.Preferences.EnableDivisionWise)&&s.a.SessionManager.Preferences.ContainsKey("DW SNOS")&&Object(l.j)(s.a.SessionManager.Preferences["DW SNOS"])&&(u.Parent.ScreenObject.Preferences.ContainsKey("Donotusedivision")&&""!=u.Parent.ScreenObject.Preferences.Donotusedivision&&Object(l.j)(u.Parent.ScreenObject.Preferences.Donotusedivision)?(d=u.Parent.ScreenObject._CCFields.find((function(e){return"dcccnid1"==e.DBColumnName.toLowerCase()})))&&d instanceof C.b&&d.SelectedValue>0?S=d.SelectedValue:null==c||o.e.StringIsNullOrEmpty(c.dcCCNID1_Key)||(S=parseInt(c.dcCCNID1_Key.toString())):S=u.Parent.ScreenObject.DivisionID>0?u.Parent.ScreenObject.DivisionID:s.a.SessionManager.DivisionID),s.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&Object(l.j)(s.a.SessionManager.Preferences.EnableLocationWise)&&s.a.SessionManager.Preferences.ContainsKey("LW SNOS")&&Object(l.j)(s.a.SessionManager.Preferences["LW SNOS"])&&(u.Parent.ScreenObject.Preferences.ContainsKey("Donotuselocation")&&""!=u.Parent.ScreenObject.Preferences.Donotuselocation&&Object(l.j)(u.Parent.ScreenObject.Preferences.Donotuselocation)?(d=u.Parent.ScreenObject._CCFields.find((function(e){return"dcccnid2"==e.DBColumnName.toLowerCase()})))&&d instanceof C.b&&d.SelectedValue>0?D=d.SelectedValue:null==c||o.e.StringIsNullOrEmpty(c.dcCCNID2_Key)||(D=parseInt(c.dcCCNID2_Key.toString())):D=u.Parent.ScreenObject.LocationID>0?u.Parent.ScreenObject.LocationID:s.a.SessionManager.LocationID),u.Parent.ScreenObject.Preferences.ContainsKey("ScanMultiple")&&""!=u.Parent.ScreenObject.Preferences.ScanMultiple&&(u.MultiVisiblility=Object(l.j)(u.Parent.ScreenObject.Preferences.ScanMultiple),u.MultiVisiblility&&(u.Scanmulitple=!0)),u.Parent.ScreenObject.Preferences.ContainsKey("DefaultDelimiter")&&""!=u.Parent.ScreenObject.Preferences.DefaultDelimiter&&(u.Separator.Text=u.Parent.ScreenObject.Preferences.DefaultDelimiter.length>1?u.Parent.ScreenObject.Preferences.DefaultDelimiter[0].toString():u.Parent.ScreenObject.Preferences.DefaultDelimiter);var m=!1;u.Parent.ScreenObject.Preferences.ContainsKey("DocwiseSNo")&&Object(l.j)(u.Parent.ScreenObject.Preferences.DocwiseSNo)||1!=i||(m=!0),6!=u.Parent.ScreenObject.DocumentType&&39!=u.Parent.ScreenObject.DocumentType||(m=!1);var b=0;o.e.StringIsNullOrEmpty(c.DocDetailsID)||(b=parseInt(c.DocDetailsID)),u.ds=s.a.document.GetSerialNumberScreenDetails(parseInt(c.ProductID_Key),b,u.Parent.ScreenObject.DocID,S,D,m);var y,p=u.Parent.ScreenObject.GridData.filter((function(e){return e.ProductID_Key==c.ProductID_Key&&e.DocSeqNo!=c.DocSeqNo}));if(p.length>0&&p.forEach((function(e){var t=new o.f;o.e.StringIsNullOrEmpty(e.ExtraXML)||(t.ReadXml(e.ExtraXML.toString()),t.Tables.length>0&&t.Tables[0].length>0&&t.Tables[0].forEach((function(e){u.dtSerials.push(e)})))})),u.ds.Tables.length>1)for(var g=0;g<u.ds.Tables[0].length;g++)"Available"==o.e.StringValue(u.ds.Tables[0][g].ActualStatus)?u.AvailableStatusID=parseInt(u.ds.Tables[0][g].StatusID.toString()):"Sold"==o.e.StringValue(u.ds.Tables[0][g].ActualStatus)&&(u.SoldStatusID=parseInt(u.ds.Tables[0][g].StatusID.toString()));if(u.ds.Tables.length>2&&u.ds.Columns[2].length>0&&(u.dtProdSerial=u.ds.Tables[2]),u.SerialNumber.TextChangedCommand.Subscribe(_assertThisInitialized(u),"OnSerialScanned"),1==u.Vtype?((y=new f.a).Header=s.a.GetResource("UOM_Sno"),y.DisplayMember="Sno",y.DataType="TextBlock",y.ReadOnly=!0,y.Width=50,y.DisableTab=!0,u.ColumnSource.push(y),u.GridDataObj.TableColumns.push("Sno")):((y=new f.a).Header=s.a.GetResource("SerialNo_Select"),y.DisplayMember="Select",y.DataType="CheckBox",y.Width=30,y.CheckedChanged.Subscribe(_assertThisInitialized(u),"OnCheckedChanged"),u.ColumnSource.push(y),u.GridDataObj.TableColumns.push("Select")),(y=new f.a).Header="SerialProductID",y.DisplayMember="SerialProductID",y.DataType="TextBlock",y.Width=0,y.IsVisible=!1,u.ColumnSource.push(y),u.GridDataObj.TableColumns.push("SerialProductID"),(y=new f.a).Header=s.a.GetResource("Document_SerialNumber"),y.DisplayMember="SerialNumber",y.ReadOnly=!0,y.DataType="TextBlock",y.Width=250,u.ColumnSource.push(y),u.GridDataObj.TableColumns.push("SerialNumber"),(y=new f.a).Header=s.a.GetResource("Document_Status"),y.DisplayMember="Status",y.ValueBinding="StatusID",y.ValueMember="StatusID",u.ds.Tables.length>1&&(y.ComboData=u.ds.Tables[0]),y.DataType="ComboBox",y.Width=76,y.ReadOnly=!0,y.DisableTab=!0,"RecievedQty"==u.BindingPath&&(y.IsVisible=!1),u.ColumnSource.push(y),u.GridDataObj.TableColumns.push("StatusID"),(y=new f.a).Header="SerialGUID",y.DisplayMember="SerialGUID",y.DataType="TextBlock",y.Width=0,y.IsVisible=!1,y.ReadOnly=!0,y.DisableTab=!0,u.ColumnSource.push(y),u.GridDataObj.TableColumns.push("SerialGUID"),(y=new f.a).Header="RefInvDocDetailsID",y.DisplayMember="RefInvDocDetailsID",y.DataType="TextBlock",y.Width=0,y.IsVisible=!1,y.ReadOnly=!0,y.DisableTab=!0,u.ColumnSource.push(y),u.GridDataObj.TableColumns.push("RefInvDocDetailsID"),(y=new f.a).Header="IsAvailable",y.DisplayMember="IsAvailable",y.DataType="TextBlock",y.Width=0,y.IsVisible=!1,y.ReadOnly=!0,y.DisableTab=!0,u.ColumnSource.push(y),u.GridDataObj.TableColumns.push("IsAvailable"),-1==u.Vtype&&u.ds.Tables.length>1&&"RecievedQty"!=u.BindingPath)for(var O=0;O<u.ds.Tables[1].length;O++){for(var I=u.GridDataObj.NewRow(),T=1;T<u.ds.Columns[1].length;T++)u.GridDataObj.TableColumns.Contains(u.ds.Columns[1][T])&&(I[u.ds.Columns[1][T]]=u.ds.Tables[1][O][u.ds.Columns[1][T]]);u.GridDataObj.TableColumns.Contains("Select")&&(I.Select=!1),I.RefInvDocDetailsID=u.ds.Tables[1][O].InvDocDetailsID,I.SerialProductID=0,u.ds.Columns[1].Contains("RefInvDocDetailsID")&&!o.e.StringIsNullOrEmpty(u.ds.Tables[1][O].RefInvDocDetailsID)&&parseInt(u.ds.Tables[1][O].RefInvDocDetailsID)>0&&parseInt(u.ds.Tables[1][O].RefInvDocDetailsID.toString())==b&&(I.StatusID=u.AvailableStatusID),u.GridDataObj.addRow(I)}var j=new o.f;if(null!=u.Parent.SelectedRow){var P=new o.f;"RecievedQty"==u.BindingPath&&(o.e.StringIsNullOrEmpty(c.RecievedQtyXML)||P.ReadXml(c.RecievedQtyXML.toString())),o.e.StringIsNullOrEmpty(c.ExtraXML)?u.QtyAddMessage=u.AssetQty>0?o.e.Format(s.a.GetResource("SerialNo_SelectMessage"),"0",u.AssetQty.toString(),u.pName):u.GridDataObj.TableColumns.Contains("Select")?o.e.Format(s.a.GetResource("SerialNo_SelectMessage"),"0",c[u.BindingPath].toString(),u.pName):o.e.Format(s.a.GetResource("SerialNo_AddMessage"),"0",c.Quantity.toString(),u.pName):function(){j.LoadXml(c.ExtraXML.toString());for(var e=j.SelectNodes("xml/Row"),t=function(t){var n=null;if(u.GridDataObj.TableColumns.Contains("Select"))if("RecievedQty"==u.BindingPath)if(n=u.GridDataObj.NewRow(),P.Tables.length>0&&P.Columns[0].Contains("SerialNumber")&&P.Tables[0].filter((function(n){return n.SerialNumber==e[t].attributes.SerialNumber.value.toString()})).length>0){var a=P.Tables[0].filter((function(n){return n.SerialNumber==e[t].attributes.SerialNumber.value}));n.Select=!0,n.SerialGUID=a[0].SerialGUID.toString(),n.SerialProductID=a[0].SerialProductID.toString()}else n.Select=!1,n.SerialGUID=o.e.NewGuid(),n.SerialProductID=0;else{var i=u.GridData.filter((function(n){return n.SerialGUID==e[t].attributes.SerialGUID.value.toString()}));i.length>0&&((n=i[0]).Select=!0)}else(n=u.GridDataObj.NewRow()).Sno=(t+1).toString();for(var r=1;r<u.ColumnSource.length;r++)("RecievedQty"!=u.BindingPath||"SerialGUID"!=u.ColumnSource[r].DisplayMember&&"RefInvDocDetailsID"!=u.ColumnSource[r].DisplayMember&&"SerialProductID"!=u.ColumnSource[r].DisplayMember)&&null!=n&&(0==r?n[0]=(u.GridData.length+1).toString():"ComboBox"!=u.ColumnSource[r].DataType||o.e.IsEmpty(e[t].attributes[u.ColumnSource[r].ValueMember])?"ComboBox"==u.ColumnSource[r].DataType||o.e.IsEmpty(e[t].attributes[u.ColumnSource[r].DisplayMember])||(n[u.ColumnSource[r].DisplayMember]=e[t].attributes[u.ColumnSource[r].DisplayMember].value):n[u.ColumnSource[r].ValueMember]=e[t].attributes[u.ColumnSource[r].ValueMember].value);"RecievedQty"==u.BindingPath&&(n.StatusID=u.AvailableStatusID),u.GridDataObj.TableColumns.Contains("Select")&&"RecievedQty"!=u.BindingPath||u.GridDataObj.addRow(n)},n=0;n<e.length;n++)t(n);if(u.QtyAddMessage=u.AssetQty>0?o.e.Format(s.a.GetResource("SerialNo_SelectMessage"),e.length.toString(),u.AssetQty.toString(),u.pName):u.GridDataObj.TableColumns.Contains("Select")?o.e.Format(s.a.GetResource("SerialNo_SelectMessage"),e.length.toString(),c[u.BindingPath].toString(),u.pName):o.e.Format(s.a.GetResource("SerialNo_AddMessage"),e.length.toString(),c[u.BindingPath].toString(),u.pName),"RecievedQty"==u.BindingPath){var a="0";P.Tables.length>0&&P.Columns[0].Contains("SerialGUID")&&(a=P.Tables[0].length.toString()),u.QtyAddMessage=o.e.Format(s.a.GetResource("SerialNo_SelectMessage"),a,c.RecievedQty.toString(),u.pName)}}()}return u.GridDataObj.RowDeleted.Subscribe(_assertThisInitialized(u),"GridData_RowDeleted"),u}return _createClass(n,[{key:"GridData_RowDeleted",value:function(e){if(this.GridDataObj.TableColumns.Contains("Sno")){var t=1;this.GridData.forEach((function(e){e.Sno=t++})),this.QtyAddMessage=o.e.Format(s.a.GetResource("SerialNo_AddMessage"),(t-1).toString(),this.drSel[this.BindingPath].toString(),this.pName)}}},{key:"OnSerialScanned",value:function(e,t){o.e.StringIsNullOrEmpty(this.SerialNumber.Text)||"13"!=t.keyCode||(1==this.Vtype?(this.OnSave("Add"),this.QtyAddMessage=o.e.Format(s.a.GetResource("SerialNo_AddMessage"),this.GridData.length.toString(),this.drSel.Quantity.toString(),this.pName)):(this.OnSave("Search"),null!=this.SelectedRow&&o.e.StringValue(this.SelectedRow.SerialNumber)==this.SerialNumber.Text&&(this.SelectedRow.Select=!0,this.SerialNumber.Text="",this.cellEditEnd(this.SelectedRow))))}},{key:"OnCheckedChanged",value:function(e){this.cellEditEnd(e.item)}},{key:"cellEditEnd",value:function(e){Object(l.j)(e.Select)?"RecievedQty"==this.BindingPath?(e.StatusID=this.AvailableStatusID,e.IsAvailable=!0):(e.StatusID=this.SoldStatusID,e.IsAvailable=!1):(e.StatusID=this.AvailableStatusID,e.IsAvailable=!0);var t=0;this.GridData.forEach((function(e){Object(l.j)(e.Select)&&t++})),this.QtyAddMessage=o.e.Format(s.a.GetResource("SerialNo_SelectMessage"),t.toString(),this.drSel[this.BindingPath].toString(),this.pName)}},{key:"OnRemove",value:function(e){var t=this;if(null!=this.SelectedRow)if(null!=this.SelectedRows&&this.SelectedRows.length>1){if(!confirm("Are you sure you want to delete "+this.SelectedRows.length.toString()+" Rows?"))return;this.SelectedRows.forEach((function(e){e&&t.DeleteRow(e)}))}else this.DeleteRow(this.SelectedRow)}},{key:"DeleteRow",value:function(e){parseInt(e.StatusID)!=this.AvailableStatusID?this.DisplayMessage=s.a.GetResource("SerialNumber_CanNotRemove"):this.GridDataObj.removeRow(e)}},{key:"Setselectedrow",value:function(e){this.SelectedRow=this.GridData[e]}},{key:"CheckAll",value:function(e){if(this.GridDataObj.TableColumns.Contains("Select"))if(e){var t;t="RecievedQty"==this.BindingPath?parseInt(this.drSel.RecievedQty.toString()):this.AssetQty>0?this.AssetQty:parseInt(this.drSel.Quantity.toString());for(var n=0;n<this.GridData.length;n++)this.GridData[n].Select=n<t?e:!e,this.cellEditEnd(this.GridData[n])}else for(var a=0;a<this.GridData.length;a++)this.GridData[a].Select=!1}},{key:"OnSave",value:function(e){var t=this;if("Search"==e.toString()){if(""!=this.SerialNumber.Text){var n=0,a=0;for(null!=this.SelectedRow&&(a=this.GridData.indexOf(this.SelectedRow)+1);n<this.GridData.length;n++,a++)if(a>=this.GridData.length&&(a=0),this.GridData[a].SerialNumber.toString().Contains(this.SerialNumber.Text))return void this.Setselectedrow(a)}if(""!=this.SerialNumber.Text)if(this.Scanmulitple&&!o.e.IsEmpty(this.Separator.Text)&&this.GridDataObj.TableColumns.Contains("Select")){var i=this.SerialNumber.Text.split(this.Separator.Text[0]),r=0;for(this.Parent.ScreenObject.Preferences.ContainsKey("IgnoreFirstDelimiter")&&Object(l.j)(this.Parent.ScreenObject.Preferences.IgnoreFirstDelimiter)&&(r=1);r<i.length;r++)for(var c=0;c<this.GridData.length;c++)(i.Contains(this.GridData[c].SerialNumber.toString())||this.GridData[c].SerialNumber.toString().Contains(this.SerialNumber.Text))&&(this.GridData[c].Select=!0,this.GridData[c].StatusID=this.SoldStatusID,this.GridData[c].IsAvailable=!1);r=0,this.GridData.forEach((function(e){Object(l.j)(e.Select.toString())&&r++})),this.QtyAddMessage=o.e.Format(s.a.GetResource("SerialNo_SelectMessage"),r.toString(),this.drSel[this.BindingPath].toString(),this.pName),this.SerialNumber.Text=""}else{var u=0,d=0;for(null!=this.SelectedRow&&(d=this.GridData.indexOf(this.SelectedRow)+1);u<this.GridData.length;u++,d++)if(d>=this.GridData.length&&(d=0),this.GridData[d].SerialNumber.toString().Contains(this.SerialNumber.Text))return void this.Setselectedrow(d)}}else if("Save"==e.toString()){var D="",h="",S=0;h+="<xml>";for(var m=0;m<this.GridData.length;m++)if(!this.GridDataObj.TableColumns.Contains("Select")||Object(l.j)(this.GridData[m].Select.toString())){h+="<Row ";for(var b=1;b<this.ColumnSource.length;b++)h+="ComboBox"==this.ColumnSource[b].DataType?this.ColumnSource[b].ValueMember+'="'+this.GridData[m][this.ColumnSource[b].ValueMember].toString()+'" ':this.ColumnSource[b].DisplayMember+'="'+this.GridData[m][this.ColumnSource[b].DisplayMember].toString()+'" ';h+=" ></Row>",++S>1&&(D+=","),D+=this.GridData[m].SerialNumber.toString()}h+="</xml>";var C=!1;if(this.Parent.ScreenObject.Preferences.ContainsKey("QtyOnSerialNo")&&!o.e.IsEmpty(this.Parent.ScreenObject.Preferences.QtyOnSerialNo)&&Object(l.j)(this.Parent.ScreenObject.Preferences.QtyOnSerialNo)&&(C=!0),"RecievedQty"==this.BindingPath)return parseInt(this.drSel.RecievedQty.toString())!=S?void(this.DisplayMessage=s.a.GetResource("SerialNo_QtyMisMatch")):(this.drSel.RecievedQtyXML=h.toString(),this.Parent.DialogResult=!0,void s.a.page.HideDialog());if(this.AssetQty>0){if(this.AssetQty>=1&&this.AssetQty!=S||this.AssetQty<1&&S>1)return void(this.DisplayMessage=s.a.GetResource("SerialNo_QtyMisMatch"))}else if(parseInt(this.drSel[this.BindingPath].toString().Replace("-",""))!=S&&!C)return void(this.DisplayMessage=s.a.GetResource("SerialNo_QtyMisMatch"));this.drSel.ExtraXML=h.toString();var y=this.Parent.ScreenObject.Data.Tables[0];y.length>0&&(y=this.Parent.ScreenObject.Data.Tables[0].filter((function(e){return 79==e.LocalReference&&54308==e.LinkData}))).length>0&&this.Parent.ScreenObject.GridDataColumns.Contains(y[0].SysColumnName.toString())&&(this.drSel[y[0].SysColumnName.toString()]=D),C&&(this.drSel.Quantity=o.e.IsEmpty(this.drSel.UOMConversion)?S:S/parseFloat(this.drSel.UOMConversion.toString()),this.Parent.CalculateTotals(this.drSel,!1)),this.Parent.DialogResult=!0,s.a.page.HideDialog()}else if("Import"==e.toString())this.importData();else if("Add"==e.toString()){var p=function(){if(null==t.SerialNumber.Text||""==t.SerialNumber.Text||""!=t.Qty.ValidateData())return{v:void 0};if(t.AssetQty>0){if(t.AssetQty>=1&&t.GridData.length>=t.AssetQty||t.AssetQty<1&&t.GridData.length>0)return{v:void(t.DisplayMessage="Qty already adjusted")}}else if(t.GridData.length>=parseInt(t.drSel[t.BindingPath].toString().Replace("-","")))return{v:void(t.DisplayMessage="Qty already adjusted")};if(t.Scanmulitple&&!o.e.IsEmpty(t.Separator.Text)){i=t.SerialNumber.Text.split(t.Separator.Text[0]);var e=0;for(t.Parent.ScreenObject.Preferences.ContainsKey("IgnoreFirstDelimiter")&&Object(l.j)(t.Parent.ScreenObject.Preferences.IgnoreFirstDelimiter)&&(e=1);e<i.length;e++)if(!o.e.IsEmpty(i[e])){var n=t.GridDataObj.NewRow();n.Sno=(t.GridData.length+1).toString(),n.SerialProductID=0,n.SerialNumber=i[e],n.StatusID=t.AvailableStatusID,n.SerialGUID=o.e.NewGuid(),n.IsAvailable=1,n.RefInvDocDetailsID=0,t.SerialNumber.Text="",t.GridDataObj.addRow(n)}return{v:void 0}}if(null==t.Qty.Text||""==t.Qty.Text.trim()||"1"==t.Qty.Text.trim()){if(31!=t.Parent.DocumentType&&32!=t.Parent.DocumentType){if(t.dtSerials.length>0&&t.dtSerials.filter((function(e){return e.SerialNumber==t.SerialNumber.Text})).length>0||t.GridData.filter((function(e){return e.SerialNumber==t.SerialNumber.Text})).length>0)return{v:void(t.DisplayMessage=s.a.GetResource("SerialNo_Duplicate"))};if(null!=t.dtProdSerial&&t.dtProdSerial.length>0&&t.dtProdSerial.filter((function(e){return e.SerialNumber==t.SerialNumber.Text&&e.InvDocDetailsID!=t.drSel.DocDetailsID})).length>0)return{v:void(t.DisplayMessage=s.a.GetResource("SerialNo_Duplicate"))}}var a=t.GridDataObj.NewRow();return{v:(a.Sno=(t.GridData.length+1).toString(),a.SerialProductID=0,a.SerialNumber=t.SerialNumber.Text,a.StatusID=t.AvailableStatusID,a.SerialGUID=o.e.NewGuid(),a.IsAvailable=1,a.RefInvDocDetailsID=0,t.SerialNumber.Text="",void t.GridDataObj.addRow(a))}}var r,c=t.SerialNumber.Text,u=1,d=!1;if(null!=c&&""!=c.Trim())for(var D=0;D<c.length;D++)if(!o.e.IsDigit(c[c.length-D-1])){if(D<=15&&(d=!0,D>0)){r=c.substr(c.length-D);for(var h=0;h<r.length&&"0"==r[h];h++)D--;u=parseInt(c.substr(c.length-D)),c=c.substr(0,c.length-D)}break}if(!d&&null!=c&&""!=c.Trim()){var S=c.length;S>15?(S=15,r=c.substr(c.length-S)):r=c;for(var m=0;m<r.length&&"0"==r[m];m++)S--;u=parseInt(c.substr(c.length-S)),c=c.substr(0,c.length-S)}null!=c&&""!=c.Trim()||(c="");for(var b=0;b<parseInt(t.Qty.Text);b++,u++){var C=t.GridDataObj.NewRow();if(31!=t.Parent.DocumentType&&32!=t.Parent.DocumentType){if(t.dtSerials.length>0&&t.dtSerials.filter((function(e){return e.SerialNumber==c+u.toString()})).length>0||t.GridData.filter((function(e){return e.SerialNumber==c+u.toString()})).length>0)return{v:void(t.DisplayMessage=s.a.GetResource("SerialNo_Duplicate"))};if(null!=t.dtProdSerial&&t.dtProdSerial.length>0&&t.dtProdSerial.filter((function(e){return e.SerialNumber==c+u.toString()&&e.InvDocDetailsID!=t.drSel.DocDetailsID})).length>0)return{v:void(t.DisplayMessage=s.a.GetResource("SerialNo_Duplicate"))}}C.Sno=(t.GridData.length+1).toString(),C.SerialProductID=0,C.SerialNumber=c+u.toString(),C.StatusID=t.AvailableStatusID,C.SerialGUID=o.e.NewGuid(),C.IsAvailable=1,C.RefInvDocDetailsID=0,t.GridDataObj.addRow(C)}t.SerialNumber.Text="",t.Qty.Text=""}();if("object"==typeof p)return p.v}else"Cancel"==e.toString()&&(this.Parent.DialogResult=!1,s.a.page.HideDialog(),this.Parent.PopupVisibility=!1);1==this.Vtype&&(this.QtyAddMessage=o.e.Format(s.a.GetResource("SerialNo_AddMessage"),this.GridData.length.toString(),this.drSel[this.BindingPath].toString(),this.pName))}},{key:"OpenFile",value:function(e){var t=this;if(1!==e.target.files.length)throw new Error("Cannot use multiple files");var n=new FileReader,a=e.target.files[0];this.fileExt=a.name.split(".").pop(),this.fileName=a.name,n.onload=function(e){var a=Ce.read(n.result,{type:"binary"});if(t.ExcelData=Ce.utils.sheet_to_json(a.Sheets[a.SheetNames[0]],{header:1}),!o.e.IsEmpty(t.ExcelData)&&t.ExcelData.length>0)try{t.OnSave("Import")}catch(i){return void(t.DisplayMessage=i.Message)}},n.readAsBinaryString(a)}},{key:"importData",value:function(){var e=this;if(this.DisplayMessage="",null!=this.Separator.Text&&""!=this.Separator.Text){if(""!=this.fileExt)try{var t=this.fileExt,n="";if((n=[]).length>0&&(".txt"==t||"txt"==t)){var a=function(){var t=n.Split(e.Separator.Text[0]);if(1==e.Vtype){for(var a=function(n){if(e.dtSerials.length>0&&e.dtSerials.filter((function(e){return e.SerialNumber==t[n].toString()})).length>0||e.GridData.filter((function(e){return e.SerialNumber==t[n].toString()})).length>0)return{v:{v:void(e.DisplayMessage=s.a.GetResource("SerialNo_Duplicate"))}};var a=e.GridDataObj.NewRow();a.Sno=(e.GridData.length+1).toString(),a.SerialProductID=0,a.SerialNumber=t[n].toString(),a.StatusID=e.AvailableStatusID,a.SerialGUID=o.e.NewGuid(),a.IsAvailable=1,a.RefInvDocDetailsID=0,e.SerialNumber.Text="",e.GridDataObj.addRow(a)},i=0;i<t.length;i++){var r=a(i);if("object"==typeof r)return r.v}return{v:void(e.Qty.Text=t.length.toString())}}if(-1==e.Vtype&&n.length>0){var c,l="";t.forEach((function(t){0==(c=e.GridData.filter((function(e){return e.SerialNumber==t}))).length?l+=t+",":c.forEach((function(e){e.Select=!0}))})),l.length>0&&alert("SerialNo's '"+l+"' Not Exists ")}}();if("object"==typeof a)return a.v}else if(".xls"==t||".xlsx"==t||"xls"==t||"xlsx"==t)if(this.ActualFileName=this.fileName,this.ExcelTable=this.ExcelData,1==this.Vtype){if(this.ExcelTable.length>0)for(var i=function(t){if(e.dtSerials.length>0&&e.dtSerials.filter((function(n){return n.SerialNumber==e.ExcelTable[t][0].toString()})).length>0||e.GridData.filter((function(n){return n.SerialNumber==e.ExcelTable[t][0].toString()+"'"})).length>0)return{v:void(e.DisplayMessage=s.a.GetResource("SerialNo_Duplicate"))};var n=e.GridDataObj.NewRow();n[0]=e.ExcelTable[t][0],n.Sno=(e.GridData.length+1).toString(),n.SerialProductID=0,n.SerialNumber=e.ExcelTable[t][0].toString(),n.StatusID=e.AvailableStatusID,n.SerialGUID=o.e.NewGuid(),n.IsAvailable=1,n.RefInvDocDetailsID=0,e.SerialNumber.Text="",e.GridDataObj.addRow(n)},r=1;r<this.ExcelTable.length;r++){var c=i(r);if("object"==typeof c)return c.v}}else if(-1==this.Vtype&&null!=this.ExcelTable&&this.ExcelTable.length>0&&this.ExcelTable.length>0){for(var l,u="",d=function(t){0==(l=e.GridData.filter((function(n){return n.SerialNumber==e.ExcelTable[t][0].toString()}))).length?u+=e.ExcelTable[t][0].toString()+",":l.forEach((function(e){e.Select=!0}))},D=1;D<this.ExcelTable.length;D++)d(D);u.length>0&&alert("SerialNo's '"+u+"' Not Exists ")}}catch(h){throw Logger.ErrorLog("SerialNumberViewModel: OnSave, sender='Import', message="+h),new Error(h)}}else this.DisplayMessage="Enter Separator"}},{key:"ColumnSource",get:function(){return this.GridDataObj.Columns}},{key:"GridData",get:function(){return this.GridDataObj.Table}},{key:"SelectedRow",get:function(){return this.GridDataObj.SelectedItem},set:function(e){this.GridDataObj.SelectedItem=e}},{key:"SelectedRows",get:function(){return this.GridDataObj.SelectedRows}},{key:"CanRemove",get:function(){return null!=this.SelectedRow}},{key:"SelectALL",get:function(){return this._SelectALL},set:function(e){e!=this._SelectALL&&(this._SelectALL=e,this.CheckAll(e))}},{key:"QtyAddMessage",get:function(){return o.e.StringIsNullOrEmpty(this._QtyAddMessage)?"asdfasdf":this._QtyAddMessage},set:function(e){this._QtyAddMessage=e}}]),n}(u.b)).SearchVisibility=!1,a),pe=n("l/9E"),ge=n("BqqB"),fe=function(e){_inherits(a,e);var t=_createSuper(a);function a(e,n,i){var r;_classCallCheck(this,a),(r=t.call(this)).GridDataObj=new V.a,r.Parent=null,r.TotalQoh=0,r.Parent=e,r.InitGrid(),null!=e.SelectedRow&&""==i?(e.ScreenObject.GridDataColumns.Contains("Productname")&&(r.Description=r.CatalogCode=e.SelectedRow.Productname.toString()),e.ScreenObject.GridDataColumns.Contains("Productcode")&&(r.ProductCode=e.SelectedRow.Productcode.toString()),r.lblProductCode="Product code",r.lblProductname="Product Name",r.Title=r.DisplayName="Product Files"):o.e.IntTryParse(n[0].FeatureID)>5e4?(r.Description=r.CatalogCode=i,r.lblProductCode="Code",r.lblProductname="Name",r.Title=r.DisplayName="Files"):(r.Description=r.CatalogCode=i,r.lblProductCode="Account code",r.lblProductname="Account Name",r.Title=r.DisplayName="Account Files");for(var s=0;s<n.length;s++){var c=r.GridDataObj.NewRow();c.Select="false",c.ActualFileName=n[s].ActualFileName.toString(),c.FileExtension=n[s].FileExtension.toString(),c.GUID=n[s].GUID.toString(),c.FileDescription=n[s].FileDescription.toString(),c.RelativeFileName=n[s].RelativeFileName.toString(),c.IsProductImage=Object(l.j)(n[s].IsProductImage),c.AllowinPrint=!0,r.GridDataObj.addRow(c)}return r}return _createClass(a,[{key:"InitGrid",value:function(){var e;this.GridDataObj.TableColumns.push("IsProductImage"),this.GridDataObj.TableColumns.push("RelativeFileName"),this.GridDataObj.TableColumns.push("FilePath"),this.GridDataObj.TableColumns.push("FileDescription"),this.GridDataObj.TableColumns.push("GUID"),this.GridDataObj.TableColumns.push("FileExtension"),this.GridDataObj.TableColumns.push("ActualFileName"),this.GridDataObj.TableColumns.push("Select"),this.GridDataObj.TableColumns.push("AllowinPrint"),(e=new f.a).Header="Select",e.DisplayMember="Select",e.DataType="CheckBox",e.Width=50,this.ColumnSource.push(e),(e=new f.a).Header="FileName",e.DisplayMember="ActualFileName",e.DataType="TextBlock",e.Width=230,e.ReadOnly=!0,this.ColumnSource.push(e),(e=new f.a).Header="Description",e.DisplayMember="FileDescription",e.DataType="TextBlock",e.Width=100,this.ColumnSource.push(e),(e=new f.a).Header="Allow Print",e.DisplayMember="AllowinPrint",e.DataType="CheckBox",e.Width=90,this.ColumnSource.push(e)}},{key:"OnButtonClick",value:function(e){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var a,i,r,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null==e||"Cancel"!=e.toString()){t.next=4;break}s.a.page.HideDialog(),t.next=11;break;case 4:if(null==e||"OK"!=e.toString()){t.next=11;break}return t.next=7,Promise.resolve().then(n.bind(null,"xnJf"));case 7:for(a=t.sent,i=a.AddAttachmentViewModel,s.a.page.HideDialog(),r=0;r<this.GridData.length;r++)Object(l.j)(this.GridData[r].Select)&&((c=new i).AddAttachmentViewModel_2(this),c.ActualFileName=this.GridData[r].ActualFileName.toString(),c.FileExtension=this.GridData[r].FileExtension.toString(),c.FileDescription=o.e.String(this.GridData[r].FileDescription),c.FilePath=o.e.String(this.GridData[r].FilePath),c.RelativeFileName=o.e.String(this.GridData[r].RelativeFileName),c.AllowInPrintVisible=!0,c.AllowInPrint=Object(l.j)(this.GridData[r].AllowinPrint),c.isfrmProduct=!0,this.Parent.ViewAttachments.AttachmentsListObj.addRow(c));case 11:case"end":return t.stop()}}),t,this)})))}},{key:"GridData",get:function(){return this.GridDataObj.Table}},{key:"ColumnSource",get:function(){return this.GridDataObj.Columns}}]),a}(u.b),Oe=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this)).GridDataObj=new V.a,e.OKVisbile=!1,e.Parent=null,e.Amount=0,e.AdvanceAmt=0,e.ExchRate=0,e.Accountid=0,e.payds=null,e.Decimals="",e.ShowPercentPayTerms=!1,e.DecimalsNetAmount="2",e.NewRefNode=null,e.IsViewScreen=!1,e.Title=s.a.GetResource("Payterm"),e}return _createClass(n,[{key:"PaymentTermsViewModel_1",value:function(e,t){this.Parent=e,this.InitGrid(),this.FillDetails(t,!0),this.OKVisbile=!1,this.Name=new h.d(0),this.Name.Label="Name",this.Terms=new m.e(0),this.Terms.Label="Payment Terms";var n=new o.f;""!=t&&n.ReadXml(t),n.Tables.length>0&&n.Columns[0].Contains("ProfileId")&&n.Columns[0].Contains("ProfileName")&&n.Tables[0].length>0&&!o.e.IsEmpty(n.Tables[0][0].ProfileId)&&(this.Terms.Items.push(m.d.ComboBoxItems_2(n.Tables[0][0].ProfileName.toString(),n.Tables[0][0].ProfileId.toString())),this.Terms.SelectedValue=n.Tables[0][0].ProfileId.toString(),this.Name.Text=n.Tables[0][0].ProfileName.toString()),this.filldimensionValues()}},{key:"PaymentTermsViewModel_2",value:function(e,t,n,a,i){Logger.InfoLog("PaymentTermsViewModel::Entering PaymentTermsViewModel"),this.Parent=e,this.Amount=t,this.NewRefNode=i,this.InitGrid(),this.OKVisbile=!0,this.Accountid=n,this.GridDataObj.CellEditEnding.Subscribe(this,"oncelleditEnd"),this.Name=new h.d(0),this.Name.Label="Name",this.Terms=new m.e(0),this.Terms.Label="Payment Terms",this.Terms.SelectionChangedCommand.Subscribe(this,"OnselectionChanged"),this.payds=a;var r=e.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&26425==e.LinkData}));if(r.length>0){var s=e.ScreenObject.FooterGridData.filter((function(e){return e.ColumnName==r[0].SysColumnName}));s.length>0&&o.e.IsEmpty(s[0].Amount)&&(this.AdvanceAmt=parseFloat(s[0].Amount))}if(null!=a&&a.Tables.length>2&&a.Tables[1].length>0){if(a.Tables[1].length>0){var c=null;e.ScreenObject.Preferences.ContainsKey("Paytermids")&&""!=e.ScreenObject.Preferences.Paytermids&&(c=e.ScreenObject.Preferences.Paytermids.split(","));for(var u=0;u<a.Tables[1].length;u++)null!=c&&c.length>0&&!c.Contains(a.Tables[1][u].ProfileID.toString())||this.Terms.Items.push(m.d.ComboBoxItems_2(a.Tables[1][u].ProfileName.toString(),a.Tables[1][u].ProfileID.toString()));a.Tables[0].length>0&&(this.Terms.SelectedValue=o.e.StringValue(a.Tables[0][0].PaymentTerms),this.Name.Text=this.Terms.GetText())}e.ScreenObject.Preferences.ContainsKey("accountwisePaymentTerms")&&""!=e.ScreenObject.Preferences.accountwisePaymentTerms&&Object(l.j)(e.ScreenObject.Preferences.accountwisePaymentTerms)&&(this.Terms.Enable=!1)}if(a.Tables.length>3&&a.Tables[3].length>0&&a.Columns[3].Contains("Percentage")){a.Columns[3].Contains("ProfileID")&&!o.e.IsEmpty(a.Tables[3][0].ProfileID)&&(this.Terms.SelectedValue=a.Tables[3][0].ProfileID.toString());for(var d,D=0,S=0;S<a.Tables[3].length;S++)if(!o.e.IsEmpty(a.Tables[3][S].Percentage)){var b;D+=b=D+parseFloat(a.Tables[3][S].Percentage)>100?100-D:parseFloat(a.Tables[3][S].Percentage),d=(this.Amount+this.AdvanceAmt)*b/100,this.AddRow(D,d,a.Tables[3][S],parseInt(a.Tables[3][S].days),o.e.StringValue(a.Tables[3][S].dimccid),o.e.StringValue(a.Tables[3][S].dimnodeid))}this.AdvanceAmt>0&&this.AdvanceAdjustments()}else o.e.Int(this.Terms.SelectedValue)>0?this.LoadPayterms():""!=e.payTermXml&&this.FillDetails(e.payTermXml,!1);for(var C=0;C<this.GridData.length;C++)o.e.IsEmpty(this.GridData[C].Amount)?this.GridData[C].Percentage=0:(this.GridData[C].Amount=parseFloat(this.GridData[C].Amount).ToString(this.Decimals),this.GridData[C].Percentage=(100*parseFloat(this.GridData[C].Amount)/this.Amount).ToString(this.Decimals),this.ExchRate>0&&(this.GridData[C].AmountFC=(parseFloat(this.GridData[C].Amount)/this.ExchRate).ToString(this.Decimals)));for(var y=this.GridData.length;y<10;y++)this.GridDataObj.addEmptyRow();this.CalculateTotals(),this.filldimensionValues(),Logger.InfoLog("PaymentTermsViewModel::Exiting PaymentTermsViewModel")}},{key:"AdvanceAdjustments",value:function(){for(var e=this.AdvanceAmt,t=0;t<this.GridData.length;t++){if(o.e.Double(this.GridData[t].Amount)>e){this.GridData[t].Amount=parseFloat(this.GridData[t].Amount)-e,this.ExchRate>0&&(this.GridData[t].AmountFC=(parseFloat(this.GridData[t].Amount)/this.ExchRate).ToString(this.Decimals));break}if(parseFloat(this.GridData[t].Amount)==e){this.GridDataObj.removeRow(this.GridData[t]);break}e-=parseFloat(this.GridData[t].Amount),this.GridDataObj.removeRow(this.GridData[t]),t--}for(var n=0;n<this.GridData.length;n++)o.e.IsEmpty(this.GridData[n].Amount)||(this.GridData[n].Percentage=(parseFloat(this.GridData[n].Amount)/this.Amount*100).ToString(this.Decimals))}},{key:"PaymentTermsViewModel_3",value:function(e,t){this.IsViewScreen=!0;var n=s.a.report.GetReportData(20,e,t),a=n.Tables[1].filter((function(e){return"ShowPercentPayTerms"==e.PrefName}));a.length>0&&Object(l.j)(a[0].PrefValue)&&(this.ShowPercentPayTerms=!0),a.length>0&&(this.DecimalsNetAmount=a[0].PrefValue.toString()),this.InitGrid(),this.FillDetails(null,!0,n),this.ColumnSource.map((function(e){return e.ReadOnly=!0})),this.OKVisbile=!1,this.Name=new h.d(0),this.Name.Label="Name",this.Terms=new m.e(0),this.Terms.Label="Payment Terms",this.Terms.Enable=!1,n.Tables.length>0&&n.Columns[0].Contains("ProfileId")&&n.Columns[0].Contains("ProfileName")&&n.Tables[0].length>0&&!o.e.IsEmpty(n.Tables[0][0].ProfileId)&&(this.Terms.Items.push(m.d.ComboBoxItems_2(n.Tables[0][0].ProfileName.toString(),n.Tables[0][0].ProfileId.toString())),this.Terms.SelectedValue=n.Tables[0][0].ProfileId.toString(),this.Name.Text=n.Tables[0][0].ProfileName.toString())}},{key:"FillDetails",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{var a=0;if(null==n&&(n=new o.f,""!=e&&n.ReadXml(e)),n.Tables.length>0){n.Columns[0].Contains("ProfileId")&&n.Tables[0].length>0&&null!=this.Terms&&!o.e.IsEmpty(n.Tables[0][0].ProfileId)&&(this.Terms.SelectedValue=n.Tables[0][0].ProfileId.toString());for(var i=0;i<n.Tables[0].length;i++){var r=this.GridDataObj.NewRow();n.Columns[0].Contains("Percentage")&&!o.e.IsEmpty(n.Tables[0][i].Percentage)&&(r.Percentage=n.Tables[0][i].Percentage),n.Columns[0].Contains("Amount")&&!o.e.IsEmpty(n.Tables[0][i].Amount)&&(r.Amount=n.Tables[0][i].Amount),n.Columns[0].Contains("AmountFC")&&!o.e.IsEmpty(n.Tables[0][i].AmountFC)&&(r.AmountFC=n.Tables[0][i].AmountFC),n.Columns[0].Contains("Days")&&!o.e.IsEmpty(n.Tables[0][i].Days)&&(r.Days=n.Tables[0][i].Days),n.Columns[0].Contains("DueDate")&&!o.e.IsEmpty(n.Tables[0][i].DueDate)&&(r.DueDate_Key=new Date(n.Tables[0][i].DueDate),r.DueDate=new Date(r.DueDate_Key).ToString(s.a.SessionManager.Preferences["Date Format"])),n.Columns[0].Contains("BasedOn")&&!o.e.IsEmpty(n.Tables[0][i].BasedOn)&&(r.BasedOn=n.Tables[0][i].BasedOn),n.Columns[0].Contains("BaseDate")&&!o.e.IsEmpty(n.Tables[0][i].BaseDate)&&(r.BaseDate=n.Tables[0][i].BaseDate),n.Columns[0].Contains("Period")&&!o.e.IsEmpty(n.Tables[0][i].Period)&&(r.Period=n.Tables[0][i].Period),n.Columns[0].Contains("Remarks")&&!o.e.IsEmpty(n.Tables[0][i].Remarks)&&(r.Remarks=n.Tables[0][i].Remarks.toString()),n.Columns[0].Contains("DimCCID")&&!o.e.IsEmpty(n.Tables[0][i].DimCCID)&&(r.DimCCID=n.Tables[0][i].DimCCID.toString()),n.Columns[0].Contains("DimNodeID")&&!o.e.IsEmpty(n.Tables[0][i].DimNodeID)&&(r.DimNodeID=n.Tables[0][i].DimNodeID.toString()),o.e.IsNum(r.Amount)&&(a+=parseFloat(r.Amount.toString())),this.GridDataObj.addRow(r),console.log(r)}t&&(this.Amount=parseFloat(a.ToString(this.Decimals))),this.CalculateTotals(),console.log(this.GridDataObj.Table)}}catch(c){Logger.ErrorLog("Payments Terms","Fill Details",c)}}},{key:"filldimensionValues",value:function(){if(this.GridDataObj.TableColumns.Contains("Dim")){for(var e="",t="",n=0;n<this.GridData.length;n++)o.e.IsEmpty(this.GridData[n].DimCCID)||o.e.IsEmpty(this.GridData[n].DimNodeID)||(""!=e&&(e+=","),t=this.GridData[n].DimCCID.toString(),e+=this.GridData[n].DimNodeID.toString());if(""!=t&&""!=e){var a=this.Parent.ScreenObject.GetdimensionNames(t,e);a.Tables.length>0&&!a.Columns[0].Contains("ErrorMessage")&&this.GridData.forEach((function(e){if(!o.e.IsEmpty(e.DimNodeID)){var t=a.Tables[0].filter((function(t){return t.NodeID==e.DimNodeID}));t.length>0&&(e.Dim=o.e.StringValue(t[0][1]))}}))}}}},{key:"LoadPayterms",value:function(){var e=this,t=0,n=0,a=this.payds.Tables[2].filter((function(t){return t.ProfileID==e.Terms.SelectedValue}));this.GridData.Clear();for(var i=0;i<a.length;i++)if(!o.e.IsEmpty(a[i].percentage)){var r;if(n+=r=n+parseFloat(a[i].percentage)>100?100-n:parseFloat(a[i].percentage),t=(this.Amount+this.AdvanceAmt)*r/100,2==o.e.Int(a[i].TypeID))if(o.e.Int(a[i].Occurences)>1)for(var s=t/parseInt(a[i].Occurences),c=s/(this.Amount+this.AdvanceAmt)*100,l=0,u=1;u<=parseInt(a[i].Occurences);u++)u==parseInt(a[i].Occurences)?s=t-l:l+=parseFloat(s.ToString(this.Decimals)),this.AddRow(c,s,a[i],parseInt(a[i].Days)*u,o.e.StringValue(a[i].dimccid),o.e.StringValue(a[i].dimnodeid));else this.AddRow(r,t,a[i],parseInt(a[i].Days),o.e.StringValue(a[i].dimccid),o.e.StringValue(a[i].dimnodeid));else if(1==o.e.Int(a[i].TypeID))if(o.e.Int(a[i].Occurences)>1)for(var d=1;d<=parseInt(a[i].Occurences);d++)this.AddRow(r,t,a[i],parseInt(a[i].Days)*d,o.e.StringValue(a[i].dimccid),o.e.StringValue(a[i].dimnodeid));else this.AddRow(r,t,a[i],parseInt(a[i].Days),o.e.StringValue(a[i].dimccid),o.e.StringValue(a[i].dimnodeid));else this.AddRow(r,t,a[i],parseInt(a[i].Days),o.e.StringValue(a[i].dimccid),o.e.StringValue(a[i].dimnodeid))}this.AdvanceAmt>0&&this.AdvanceAdjustments();for(var D=this.GridData.length;D<8;D++)this.GridDataObj.addEmptyRow();this.CalculateTotals()}},{key:"AddRow",value:function(e,t,n,a,i,r){var c=this.GridDataObj.NewRow();c.Percentage=e.ToString(this.Decimals),c.Amount=t.ToString(this.Decimals),this.ExchRate>0&&(c.AmountFC=(t/this.ExchRate).ToString(this.Decimals)),c.Days=a,c.Period=n.Period.toString(),2==o.e.Int(n.BasedOn)?(c.DueDate_Key=2==o.e.Int(n.Period)?this.billdate.AddMonths(a):this.billdate.AddDays(a),c.BaseDate=s.a.SessionManager.IsWebApplication?this.billdate.ToString("dd/MMM/yyyy"):this.billdate,c.BasedOn="2"):(c.BasedOn="1",c.DueDate_Key=2==o.e.Int(n.Period)?this.Parent.DocumentDate.AddMonths(a):this.Parent.DocumentDate.AddDays(a),c.BaseDate=s.a.SessionManager.IsWebApplication?this.Parent.DocumentDate.ToString("dd/MMM/yyyy"):this.Parent.DocumentDate),""!=i&&(c.DimCCID=i),""!=r&&(c.DimNodeID=r),c.DueDate=new Date(c.DueDate_Key).ToString(s.a.SessionManager.Preferences["Date Format"]),c.Remarks=o.e.IsEmpty(n.Remarks)?"":n.Remarks.toString(),this.GridDataObj.addRow(c)}},{key:"CalculateTotals",value:function(){for(var e=0,t=0,n=0;n<this.GridData.length;n++)o.e.IsNum(this.GridData[n].Percentage)&&(t+=parseFloat(this.GridData[n].Percentage)),o.e.IsNum(this.GridData[n].Amount)&&(e+=parseFloat(this.GridData[n].Amount));"Percentage"==this.ColumnSource[0].DisplayMember?(this.ColumnSource[0].footer=t.Commas(this.Decimals),this.ColumnSource[1].footer=e.Commas(this.Decimals)):this.ColumnSource[0].footer=e.Commas(this.Decimals),this.AdjustedAmt=e.Commas(this.Decimals),this.Balance=(this.Amount-e).Commas(this.Decimals),this.updateFooter=!0}},{key:"InitGrid",value:function(){if(null!=this.Parent){if(this.billdate=this.Parent.DocumentDate,this.Parent.ScreenObject.Preferences.ContainsKey("Paymenttermsbasedon")&&""!=this.Parent.ScreenObject.Preferences.Paymenttermsbasedon){for(var e=this.Parent.ScreenObject.Preferences.Paymenttermsbasedon,t=0;t<this.Parent.ScreenObject.HeaderFields.length;t++){var n=this.Parent.ScreenObject.HeaderFields[t];if(n instanceof S.c&&n.DBColumnName.toLowerCase()==e.toLowerCase()&&n.Date){this.billdate=n.Date;break}}for(var a=0;a<this.Parent.ScreenObject._TextFields.length;a++){var i=this.Parent.ScreenObject._TextFields[a];if(i instanceof S.c&&i.DBColumnName.toLowerCase()==e.toLowerCase()&&i.Date){this.billdate=i.Date;break}}}this.Decimals=this.Parent.ScreenObject.Preferences.ContainsKey("DecimalsNetAmount")&&""!=this.Parent.ScreenObject.Preferences.DecimalsNetAmount?"N"+this.Parent.ScreenObject.Preferences.DecimalsNetAmount:"N2",this.Amount=parseFloat(this.Amount.ToString(this.Decimals)),this.Balance=this.AmttoAdjust=this.Amount.Commas(this.Decimals),this.AdjustedAmt=(0).Commas(this.Decimals)}var r;null!=this.Parent&&this.Parent.ScreenObject.Preferences.ContainsKey("DecimalsNetAmount")&&""!=this.Parent.ScreenObject.Preferences.DecimalsNetAmount&&(this.DecimalsNetAmount=this.Parent.ScreenObject.Preferences.DecimalsNetAmount),this.GridDataObj.Columns=[],this.GridDataObj.Table=[],this.GridDataObj.TableColumns=[],this.GridDataObj.TableColumns.push("Percentage"),this.GridDataObj.TableColumns.push("Amount"),this.GridDataObj.TableColumns.push("AmountFC"),this.GridDataObj.TableColumns.push("Days"),this.GridDataObj.TableColumns.push("DueDate"),this.GridDataObj.TableColumns.push("DueDate_Key"),this.GridDataObj.TableColumns.push("Remarks"),this.GridDataObj.TableColumns.push("Period"),this.GridDataObj.TableColumns.push("BasedOn"),this.GridDataObj.TableColumns.push("BaseDate"),this.GridDataObj.TableColumns.push("DimCCID"),this.GridDataObj.TableColumns.push("DimNodeID"),(this.ShowPercentPayTerms||null!=this.Parent&&this.Parent.ScreenObject.Preferences.ContainsKey("ShowPercentPayTerms")&&""!=this.Parent.ScreenObject.Preferences.ShowPercentPayTerms&&Object(l.j)(this.Parent.ScreenObject.Preferences.ShowPercentPayTerms))&&((r=new f.a).Header="%",r.DisplayMember="Percentage",r.Width=100,r.DecimalPoints="2",r.DataType="FLOAT",r.ShowTotal=!0,r.ReadOnly=!s.a.SessionManager.IsActionAssigned(43,"Override Payment Terms"),this.ColumnSource.push(r)),(r=new f.a).Header="Amount",r.DisplayMember="Amount",r.DecimalPoints=this.DecimalsNetAmount,r.Width=100,r.DataType="FLOAT",r.ShowTotal=!0,r.ReadOnly=!s.a.SessionManager.IsActionAssigned(43,"Override Payment Terms"),this.ColumnSource.push(r),null!=this.Parent&&null!=this.Parent.Currency&&o.e.IsNum(this.Parent.Currency.ExchangeRate.Text)&&s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&(this.ExchRate=parseFloat(this.Parent.Currency.ExchangeRate.Text),(r=new f.a).Header="AmountFC",r.DisplayMember="AmountFC",r.DecimalPoints=this.DecimalsNetAmount,r.Width=100,r.DataType="FLOAT",r.ReadOnly=!0,this.ColumnSource.push(r)),(r=new f.a).Header="Number",r.DisplayMember="Days",r.Width=100,r.DataType="FLOAT",r.ReadOnly=!s.a.SessionManager.IsActionAssigned(43,"Override Payment Terms"),this.ColumnSource.push(r),(r=new f.a).Header="Period",r.ValueBinding="Period",r.DataType="ComboBox",r.DisplayMember="Name",r.ValueMember="Value",r.Width=100;var c=[];c.push(m.d.ComboBoxItems_2("Month(s)","2")),c.push(m.d.ComboBoxItems_2("Day(s)","1")),r.ComboData=c,r.ReadOnly=!s.a.SessionManager.IsActionAssigned(43,"Override Payment Terms"),this.ColumnSource.push(r),(r=new f.a).Header="DueDate",r.DisplayMember="DueDate",r.DataType="DATE",r.Width=100,this.ColumnSource.push(r),(r=new f.a).Header="Remarks",r.DisplayMember="Remarks",r.Width=200,this.ColumnSource.push(r),""!=s.a.SessionManager.Preferences.EnableDimPayterm&&Object(l.j)(s.a.SessionManager.Preferences.EnableDimPayterm)&&((r=new f.a).Header="Dimension",r.DisplayMember="Dim",r.Width=200,this.ColumnSource.push(r),this.GridDataObj.TableColumns.push("Dim"))}},{key:"onSave",value:function(e){if("Cancel"==e)null!=this.Parent&&(this.Parent.DialogResult=!1),s.a.page.HideDialog();else if("OK"==e||"Save"==e){if("OK"==e){for(var t=0,n=0;n<this.GridData.length;n++)o.e.IsEmpty(this.GridData[n].Amount)||(t+=parseFloat(this.GridData[n].Amount));if(t.ToString(this.Decimals)!=this.Amount.ToString(this.Decimals))return void(this.DisplayMessage="Define 100 % payment");this.Parent.DialogResult=!0}var a="",i=null;this.Parent.ScreenObject.Preferences.ContainsKey("BillwisePosting")&&"2"==this.Parent.ScreenObject.Preferences.BillwisePosting&&(i="",i+="<BillWise> ");for(var r=0;r<this.GridData.length;r++)o.e.Double(this.GridData[r].Amount)>0&&(a+="<Row ",a+=' Percentage="'+this.GridData[r].Percentage.toString()+'" ',a+=' Accountid="'+this.Accountid+'" ',a+=' Amount="'+this.GridData[r].Amount.toString()+'" ',o.e.IsEmpty(this.GridData[r].AmountFC)||(a+=' AmountFC="'+this.GridData[r].AmountFC.toString()+'" '),o.e.IsEmpty(this.GridData[r].Days)?a+=' Days="0" ':a+=' Days="'+this.GridData[r].Days.toString()+'" ',o.e.IsEmpty(this.GridData[r].DueDate_Key)?a+=' DueDate="'+new Date(this.billdate).ToString("dd/MMM/yyyy")+'" ':a+=' DueDate="'+new Date(this.GridData[r].DueDate_Key).ToString("dd/MMM/yyyy")+'" ',o.e.IsEmpty(this.GridData[r].Period)?a+=' Period="1" ':a+=' Period="'+this.GridData[r].Period.toString()+'" ',o.e.IsEmpty(this.GridData[r].DimCCID)||(a+=' DimCCID="'+this.GridData[r].DimCCID.toString()+'" '),o.e.IsEmpty(this.GridData[r].DimNodeID)||(a+=' DimNodeID="'+this.GridData[r].DimNodeID.toString()+'" '),o.e.IsEmpty(this.GridData[r].BasedOn)?a+=' BasedOn="2" ':a+=' BasedOn="'+this.GridData[r].BasedOn.toString()+'" ',null!=this.Terms&&null!=this.Terms.SelectedValue&&""!=this.Terms.SelectedValue&&(a+=' ProfileId="'+this.Terms.SelectedValue+'" ',a+=' ProfileName="'+h.d.GetValidXml(this.Terms.GetText())+'" '),o.e.IsEmpty(this.GridData[r].BaseDate)?a+=' BaseDate="'+new Date(this.billdate).ToString("dd/MMM/yyyy")+'" ':a+=' BaseDate="'+new Date(this.GridData[r].BaseDate).ToString("dd/MMM/yyyy")+'" ',a+=' Remarks="'+h.d.GetValidXml(this.GridData[r].Remarks)+'" ',a+=" /> ",null!=i&&(i+='<Row DocSeqNo="'+r+'1" AccountID="'+this.Accountid.toString()+'" ',i+=1==this.Parent.ScreenObject.DocumentType||27==this.Parent.ScreenObject.DocumentType||26==this.Parent.ScreenObject.DocumentType||25==this.Parent.ScreenObject.DocumentType||2==this.Parent.ScreenObject.DocumentType||34==this.Parent.ScreenObject.DocumentType||6==this.Parent.ScreenObject.DocumentType||39==this.Parent.ScreenObject.DocumentType||3==this.Parent.ScreenObject.DocumentType||4==this.Parent.ScreenObject.DocumentType||13==this.Parent.ScreenObject.DocumentType?'AdjAmount="-'+this.GridData[r].Amount.toString()+'" ':'AdjAmount="'+this.GridData[r].Amount.toString()+'" ',o.e.IsEmpty(this.GridData[r].AmountFC)||null==this.NewRefNode||null==this.NewRefNode.attributes.AdjCurrID||this.NewRefNode.attributes.AdjCurrID.Value!=this.Parent.Currency.Currency.SelectedValue?(i+=1==this.Parent.ScreenObject.DocumentType||27==this.Parent.ScreenObject.DocumentType||26==this.Parent.ScreenObject.DocumentType||25==this.Parent.ScreenObject.DocumentType||2==this.Parent.ScreenObject.DocumentType||34==this.Parent.ScreenObject.DocumentType||6==this.Parent.ScreenObject.DocumentType||39==this.Parent.ScreenObject.DocumentType||3==this.Parent.ScreenObject.DocumentType||4==this.Parent.ScreenObject.DocumentType||13==this.Parent.ScreenObject.DocumentType?'AmountFC="-'+this.GridData[r].Amount.toString()+'" ':'AmountFC="'+this.GridData[r].Amount.toString()+'" ',i+='AdjCurrID="1" AdjExchRT="1" IsNewReference="1" '):(i+=1==this.Parent.ScreenObject.DocumentType||27==this.Parent.ScreenObject.DocumentType||26==this.Parent.ScreenObject.DocumentType||25==this.Parent.ScreenObject.DocumentType||2==this.Parent.ScreenObject.DocumentType||34==this.Parent.ScreenObject.DocumentType||6==this.Parent.ScreenObject.DocumentType||39==this.Parent.ScreenObject.DocumentType||3==this.Parent.ScreenObject.DocumentType||4==this.Parent.ScreenObject.DocumentType||13==this.Parent.ScreenObject.DocumentType?'AmountFC="-'+this.GridData[r].AmountFC.toString()+'" ':'AmountFC="'+this.GridData[r].AmountFC.toString()+'" ',i+='AdjCurrID="'+this.Parent.Currency.Currency.SelectedValue+'" AdjExchRT="'+this.Parent.Currency.ExchangeRate.Text+'" IsNewReference="1" '),o.e.IsEmpty(this.GridData[r].DueDate_Key)?i+=' DueDate="'+new Date(this.billdate).ToString("dd/MMM/yyyy")+'" ':i+=' DueDate="'+new Date(this.GridData[r].DueDate_Key).ToString("dd/MMM/yyyy")+'" ',o.e.IsEmpty(this.GridData[r].DimCCID)||(i+=' DimCCID="'+this.GridData[r].DimCCID.toString()+'" '),o.e.IsEmpty(this.GridData[r].DimNodeID)||(i+=' DimNodeID="'+this.GridData[r].DimNodeID.toString()+'" '),i+='Narration="" IsDocPDC="0"  ></Row>'));a.length>0&&(a="<Paymentterms>"+a+"</Paymentterms>"),null!=i&&(i+=" </BillWise>",this.Parent.BillWiseXML+=i),this.Parent.payTermXml=a,"OK"==e&&(s.a.page.HideDialog(),this.Parent.IsInventoryVoucher&&this.Parent.SaveDocument())}}},{key:"oncelleditEnd",value:function(e){var t=e.item,n=e.column.field;"DataGridComboBoxColumn"!=e.column.className&&(n=e.column.field),"Percentage"==n?(o.e.IsEmpty(t.Percentage)?(t.Amount=0,t.AmountFC=0):(t.Percentage=parseFloat(t.Percentage).ToString(this.Decimals),t.Amount=(this.Amount*parseFloat(t.Percentage)/100).ToString(this.Decimals),this.ExchRate>0&&(t.AmountFC=(parseFloat(t.Amount)/this.ExchRate).ToString(this.Decimals))),this.CalculateTotals()):"Amount"==n&&(o.e.IsEmpty(t.Amount)?t.Percentage=0:(t.Amount=parseFloat(t.Amount).ToString(this.Decimals),t.Percentage=(100*parseFloat(t.Amount)/this.Amount).ToString(this.Decimals),this.ExchRate>0&&(t.AmountFC=(parseFloat(t.Amount)/this.ExchRate).ToString(this.Decimals))),this.CalculateTotals()),"DueDate"!=n?this.FillDates(t):"DueDate"==n&&this.FillDays(t),this.GridDataObj.updateRow(t)}},{key:"FillDates",value:function(e){o.e.IsEmpty(e.Days)||(2==o.e.Int(e.BasedOn)?(e.DueDate_Key=2==o.e.Int(e.Period)?this.billdate.AddMonths(parseInt(e.Days)):this.billdate.AddDays(parseInt(e.Days)),e.BaseDate=this.billdate,e.BasedOn="2"):(e.BasedOn="1",e.DueDate_Key=2==o.e.Int(e.Period)?this.Parent.DocumentDate.AddMonths(parseInt(e.Days)):this.Parent.DocumentDate.AddDays(parseInt(e.Days)),e.BaseDate=this.Parent.DocumentDate),e.DueDate=new Date(e.DueDate_Key).ToString(s.a.SessionManager.Preferences["Date Format"]))}},{key:"FillDays",value:function(e){o.e.IsEmpty(e.DueDate)||(2==o.e.Int(e.BasedOn)?(2==o.e.Int(e.Period)?e.DueDate_Key=this.billdate.AddMonths(parseInt(e.Days)):e.Days=new Date(e.DueDate_Key).Subtract(this.billdate).TotalDays,e.BaseDate=this.billdate,e.BasedOn="2"):(2==o.e.Int(e.Period)?e.DueDate_Key=this.Parent.DocumentDate.AddMonths(parseInt(e.Days)):e.Days=new Date(e.DueDate_Key).Subtract(this.Parent.DocumentDate).TotalDays,e.BaseDate=this.Parent.DocumentDate,e.BasedOn="1"))}},{key:"OnselectionChanged",value:function(e){this.Name.Text=this.Terms.GetText(),this.LoadPayterms(),this.filldimensionValues()}},{key:"ColumnSource",get:function(){return this.GridDataObj.Columns}},{key:"GridData",get:function(){return this.GridDataObj.Table}},{key:"SelectedRow",get:function(){return this.GridDataObj.SelectedItem},set:function(e){this.GridDataObj.SelectedItem=e}},{key:"updateFooter",set:function(e){this.GridDataObj.UpdateFooter()}}]),n}(u.b),Ie=n("UWNR"),Te=n("sDFv"),je=n("Dc+n"),Pe=n("Ls/t"),Ae=n("j609"),Me=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var a;return _classCallCheck(this,n),(a=t.call(this)).parent=null,a.ContractID=0,a.TerminationDate=new S.a(0),a.ContractNumber=new h.d(0),a.DeleteVisible=!1,a.Reason=new C.b(0),a.Title=s.a.GetResource("Doc_Bounce"),a.parent=e,a.TerminationDate.Label=s.a.GetResource("Doc_BounceDate"),a.ContractNumber.Label=s.a.GetResource("DocumentDesigner_DocumentNumber"),a.ContractNumber.Text=e.ScreenObject.VoucherNo,a.DisplayMessage=s.a.GetResource("Doc_BounceMessage"),a.DeleteVisible=!0,a}return _createClass(n,[{key:"OnDelete",value:function(e){if("Cancel"==e)s.a.page.HideDialog();else try{this.parent.SaveAccountingDocument("Bounce")}catch(t){Logger.ErrorLog("DeleteLeadViewModel:: OnDelete"+t)}}}]),n}(u.b),ve=n("xSvK"),Ge=n("pqJT"),Ne=n("EAB5"),Ee=n("xbaw"),we=n("9UOb"),Fe=n("jDOZ"),Ve=n("C58A"),Le=n("8PvV"),Re=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var a;return _classCallCheck(this,n),(a=t.call(this)).Text="",a.RecurDocsWithApproval=new m.e(0),a.Application=new m.e(0),a.Groups=new m.b,a.Roles=new m.b,a.Users=new m.b,a.DeleteButtonVisiblily=!0,a.DocID=0,a.Parent=e,a.Title=s.a.GetResource("Recur"),a.RecurringMethod=new m.e(0),a.RecurringMethod.Label=s.a.GetResource("RecurringMethod"),a.RecurringMethod.Items.push(m.d.ComboBoxItems_2(s.a.GetResource("Normal"),"1")),a.RecurringMethod.Items.push(m.d.ComboBoxItems_2(s.a.GetResource("Reverse"),"2")),a.RecurringMethod.SelectedValue=e.ScreenObject.Preferences.ContainsKey("DefaultRecurringMethod")?e.ScreenObject.Preferences.DefaultRecurringMethod:"1",a.RecurringMethod.SetSelectedItem(a.RecurringMethod.SelectedValue),a.RecurDocsWithApproval.Label=s.a.GetResource("PostRecurDocsWithApproval"),a.RecurDocsWithApproval.Items.push(m.d.ComboBoxItems_2(s.a.GetResource("Autopost"),"2")),a.RecurDocsWithApproval.Items.push(m.d.ComboBoxItems_2(s.a.GetResource("WithApproval"),"1")),a.RecurDocsWithApproval.Items.push(m.d.ComboBoxItems_2(s.a.GetResource("WithoutApproval"),"0")),a.RecurDocsWithApproval.SelectedValue=e.ScreenObject.Preferences.ContainsKey("PostRecurDocument")?e.ScreenObject.Preferences.PostRecurDocument:"0",a.EndDate=new S.a(0),a.EndDate.Label=s.a.GetResource("Bth_EDate"),a.Appointment=new Ve.RecurAppointmentViewModel(_assertThisInitialized(a)),a.Appointment.FirstPostingDate.Label=s.a.GetResource("FirstPostingDate"),a.Application.Label=s.a.GetResource("Notif_Application"),a.Application.SelectionChangedCommand.Subscribe(_assertThisInitialized(a),"OnApplicationChange"),a.Application.Items.push(m.d.ComboBoxItems_2(s.a.GetResource("DocumentDesigner_Groups"),"1")),a.Application.Items.push(m.d.ComboBoxItems_2(s.a.GetResource("DocumentDesigner_Roles"),"2")),a.Application.Items.push(m.d.ComboBoxItems_2(s.a.GetResource("DocumentDesigner_Users"),"3")),a.Application.SelectedValue="1",a}return _createClass(n,[{key:"LoadData",value:function(){var e=this;this.DocID=this.Parent.DocID,this.Groups.Items.Clear(),this.Roles.Items.Clear(),this.Users.Items.Clear();var t=Fe.a.GetDocumentRecurrence(this.DocID,this.Parent.CostCenterID);null!=t&&t.Tables.length>0&&(t.Tables[0].forEach((function(t){e.Groups.Items.push(m.c.CheckedListBoxItem_5(t.GroupName.toString(),t.GID.toString(),!1))})),t.Tables[1].forEach((function(t){e.Roles.Items.push(m.c.CheckedListBoxItem_5(t.Name.toString(),t.RoleID.toString(),!1))})),t.Tables[2].forEach((function(t){e.Users.Items.push(m.c.CheckedListBoxItem_5(t.UserName.toString(),t.UserID.toString(),!1))}))),this.OnApplicationChange(null),this.Appointment.ScheduleID=0,this.DeleteButtonVisiblily=!1,t.Tables.length>3&&t.Tables[3].length>0&&(this.DeleteButtonVisiblily=!0,this.RecurringMethod.SelectedValue=t.Tables[3][0].RecurMethod.toString(),this.RecurDocsWithApproval.SelectedValue=t.Tables[3][0].RecurAutoPost.toString(),this.Appointment.LoadEditData(t.Tables[3][0]),this.SetSelectedItems(this.Groups,t.Tables[4],"GroupID"),this.SetSelectedItems(this.Roles,t.Tables[4],"RoleID"),this.SetSelectedItems(this.Users,t.Tables[4],"UserID"))}},{key:"SetSelectedItems",value:function(e,t,n){e.Items.forEach((function(e){e.IsChecked=t.filter((function(t){return t[n]==e.Value})).length>0}))}},{key:"OnButtonClick",value:function(e){if("Save"==e)this.SaveData();else if("Delete"==e){if(confirm(s.a.GetResource("DeleteMessage"))){var t=Fe.a.DeleteDocumentRecurrence(this.Appointment.ScheduleID);this.Parent.DisplayMessage=t.Message,t.RetValue>0&&s.a.page.HideDialog()}}else"Cancel"==e?s.a.page.HideDialog():"ShowAppointment"==e&&s.a.page.ShowDialog(this.Appointment,Le.RecurAppointmentComponent,{ShowCenter:!0})}},{key:"OnApplicationChange",value:function(e){"1"==this.Application.SelectedValue?this.SelectedApplication=this.Groups:"2"==this.Application.SelectedValue?this.SelectedApplication=this.Roles:"3"==this.Application.SelectedValue&&(this.SelectedApplication=this.Users),console.log(this.SelectedApplication)}},{key:"SaveData",value:function(){var e,t,n,a=this;if(this.Parent.DisplayMessage="",e=this.GetSelectedItems(this.Groups),t=this.GetSelectedItems(this.Roles),n=this.GetSelectedItems(this.Users),0!=e.length||0!=t.length||0!=n.length){if(this.Appointment.SetSaveData(),o.e.IsEmpty(this.Parent.DisplayMessage)){var i=[];i.push(this.Parent.CostCenterID),i.push(this.DocID),i.push(this.Appointment.ScheduleID),i.push("Recurrence"),i.push(1),i.push(this.Appointment.FreqType),i.push(this.Appointment.FreqInterval),i.push(this.Appointment.FreqSubdayType),i.push(this.Appointment.FreqSubdayInterval),i.push(this.Appointment.FreqRelativeInterval),i.push(this.Appointment.FreqRecurrenceFactor),i.push(this.Appointment.FirstPostingDate.Date.ToString("yyyyMMdd")),i.push(this.Appointment.RangeEnd.Items[0].IsChecked?null:this.Appointment.EndDate.Date.ToString("yyyyMMdd"));var r=new Date(this.Appointment.StartingTime.SelectedValue);i.push(r.getHours().PrefixZero(2)+":"+r.getMinutes().PrefixZero(2)+":"+r.getSeconds().PrefixZero(2)),i.push(null),i.push(null),i.push(e),i.push(t),i.push(n),i.push(this.Appointment.Occurrences.Text),i.push(this.RecurDocsWithApproval.SelectedValue),i.push(parseInt(this.RecurringMethod.SelectedValue)),i.push(s.a.SessionManager.CompanyGUID),i.push(s.a.SessionManager.UserName),i.push(s.a.SessionManager.UserID),i.push(s.a.SessionManager.LanguageID),Fe.a.SetDocumentRecurrence(i).subscribe((function(e){a.Parent.DisplayMessage=e.Message,e.RetValue>0&&(a.Appointment.ScheduleID=e.RetValue,s.a.page.HideDialog())}),(function(e){console.log(e)}))}}else this.Parent.DisplayMessage="Select altest one Group/Role/User"}},{key:"GetSelectedItems",value:function(e){var t="";return e.Items.forEach((function(e){e.IsChecked&&(t.length>0&&(t+=","),t+=e.Value)})),t}},{key:"OnDeleteCallBack",value:function(){}},{key:"SetErroMessage",value:function(e){this.Parent.DisplayMessage=e}}]),n}(u.b),Be=n("isE8"),xe=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this)).IsApprove=!1,e._Rejectall=!1,e._Approveall=!1,e.chkApproveall=new b.a,e.chkRejectall=new b.a,e.FromDate=new S.a(0),e.ToDate=new S.a(0),e.LinkedData=null,e.Filters="",e.chkApproveall.Label=s.a.GetResource("Approveall"),e.chkRejectall.Label=s.a.GetResource("Rejectall"),e.chkApproveall.CheckedChangedCommand.Subscribe(_assertThisInitialized(e),"onApproveCheck"),e.chkRejectall.CheckedChangedCommand.Subscribe(_assertThisInitialized(e),"onRejectCheck"),e}return _createClass(n,[{key:"onApproveCheck",value:function(e){this.Approveall=e.IsChecked}},{key:"onRejectCheck",value:function(e){this.Rejectall=e.IsChecked}},{key:"UpdateFieldsViewModel_1",value:function(e){this.SrcDocument=new m.e(101),this.DestDocument=new m.e(102),this.SrcDocument.Visible=!0,this.DestDocument.Visible=!1,this.SrcDocument.SelectionChangedCommand.Subscribe(this,"onSelectionChangedCommand"),this.SrcDocument.Label="Status",this.SrcDocument.Items.push(m.d.ComboBoxItems_2("Show All","")),this.SrcDocument.Items.push(m.d.ComboBoxItems_2("Posted","369")),this.SrcDocument.Items.push(m.d.ComboBoxItems_2("UnApproved","371")),this.SrcDocument.Items.push(m.d.ComboBoxItems_2("Rejected","372")),this.SrcDocument.Items.push(m.d.ComboBoxItems_2("Approved","441")),this.SrcDocument.SelectedValue="",this.Parent=e,this.IsApprove=!0,this.DisplayName=s.a.GetResource("ApproveReject"),this.linkGrid=new V.a,this.linkGrid.Columns=e.ScreenObject.ColumnSource,this.linkGrid.Table=e.ScreenObject.GridData,this.linkGrid.BeginEdit.Subscribe(this,"OnApproveBeginEdit");var t=this.linkGrid.Columns.find((function(e){return!o.e.IsEmpty(e.ValueBinding)&&"IsSelected"==e.ValueBinding}));t&&(t.IsVisible=!0),(t=this.linkGrid.Columns.find((function(e){return!o.e.IsEmpty(e.DisplayMember)&&"AppRemarks"==e.DisplayMember})))&&(t.IsVisible=!0);for(var n=0;n<this.linkGrid.Table.length;n++)this.linkGrid.Table[n].IsSelected="0";if(e.UserWiseApproval&&""!=s.a.SessionManager.Preferences["Dimension List"].Trim())for(var a=e.ScreenObject.GetUserWiseDim(),i=s.a.SessionManager.Preferences["Dimension List"].split(","),r=0;r<i.length;r++){alert("Check:Dcccnid-110");var c=a.Tables[0].filter("CostCenterID="+i[r]);if(c.length>0&&this.linkGrid.TableColumns.Contains("Dcccnid"+(parseInt(i[r])-5e4)+"_Key")){""!=this.Filters&&(this.Filters+=" and "),this.Filters+=" Dcccnid"+(parseInt(i[r])-5e4)+"_Key in (";for(var l=0;l<c.length;l++)l>0&&(this.Filters+=","),this.Filters+=c[l].NodeID.toString();this.Filters+=" )"}}}},{key:"UpdateFieldsViewModel_2",value:function(e){this.DisplayName=e,this.SrcDocument=new m.e(101),this.DestDocument=new m.e(102),this.SrcDocument.Label="Source",this.DestDocument.Label="Destination",this.SrcDocument.SelectionChangedCommand.Subscribe(this,"onSelectionChangedCommand");var t=Fe.a.GetAllDocuments();if(null!=t&&t.Tables.length>7&&(this.LinkedData=t.Tables[7]),null!=t&&t.Tables.length>0&&t.Tables[0].length>0)for(var n=0;n<t.Tables[0].length;n++)"0"!=t.Tables[0][n].HasAccess.toString()&&(this.SrcDocument.Items.push(m.d.ComboBoxItems_2(t.Tables[0][n].ResourceData.toString(),t.Tables[0][n].CostCenterID.toString())),null==this.LinkedData&&this.DestDocument.Items.push(m.d.ComboBoxItems_2(t.Tables[0][n].ResourceData.toString(),t.Tables[0][n].CostCenterID.toString())));this.linkGrid=new V.a,this.linkGrid.Columns=[],this.linkGrid.Table=[],this.linkGrid.BeginEdit.Subscribe(this,"OnBeginningEdit"),this.linkGrid.CanUserAddRows=!0,this.linkGrid.CanUserResizeColumns=!1;var a=new f.a;a.Header="Source",a.ValueBinding="SrcCostCenterColID",a.DataType="ComboBox",a.DisplayMember="ResourceData",a.ValueMember="CostCenterColID",a.Width=200,a.ComboData=t.Tables[4],this.linkGrid.Columns.push(a),this.linkGrid.TableColumns.push("SrcCostCenterColID"),(a=new f.a).Header="Destination",a.ValueBinding="DestCostCenterColID",a.DataType="ComboBox",a.DisplayMember="ResourceData",a.ValueMember="CostCenterColID",a.Width=200,a.ComboData=t.Tables[4],this.linkGrid.Columns.push(a),this.linkGrid.TableColumns.push("DestCostCenterColID");for(var i=0;i<10;i++)this.linkGrid.addEmptyRow();Logger.InfoLog("UpdateFieldsViewModel:: Entering UpdateFieldsViewModel")}},{key:"UpdateFieldsViewModel_3",value:function(){Logger.InfoLog("UpdateFieldsViewModel:: Entering UpdateFieldsViewModel"),this.DisplayName="",this.SrcDocument=new m.e(101),this.DestDocument=new m.e(102),this.SrcDocument.Visible=!1,this.DestDocument.Visible=!1;var e=Fe.a.GetAllDocuments();null!=e&&e.Tables.length>7&&(this.LinkedData=e.Tables[7]),this.linkGrid=new V.a,this.linkGrid.Columns=[],this.linkGrid.Table=[],this.linkGrid.BeginEdit.Subscribe(this,"OnBeginningEdit"),this.linkGrid.CanUserAddRows=!0,this.linkGrid.CanUserResizeColumns=!1;var t=new f.a;t.Header="Source Doc",t.ValueBinding="SrcCostCenterID",t.DataType="ComboBox",t.DisplayMember="ResourceData",t.ValueMember="CostCenterID",t.Width=200,t.ComboData=e.Tables[0],this.linkGrid.Columns.push(t),this.linkGrid.TableColumns.push("SrcCostCenterID"),(t=new f.a).Header="Destination Doc",t.ValueBinding="DestCostCenterID",t.DataType="PactComboBox",t.DisplayMember="ResourceData",t.ValueMember="CostCenterID",t.Width=200,t.ComboData=e.Tables[0],this.linkGrid.Columns.push(t),this.linkGrid.TableColumns.push("DestCostCenterID"),this.linkGrid.TableColumns.push("DestCostCenterID_Key"),(t=new f.a).Header="Source fld",t.ValueBinding="SrcCostCenterColID",t.DataType="PactComboBox",t.DisplayMember="ResourceData",t.ValueMember="CostCenterColID",t.Width=200,t.ComboData=e.Tables[4],this.linkGrid.Columns.push(t),this.linkGrid.TableColumns.push("SrcCostCenterColID"),this.linkGrid.TableColumns.push("SrcCostCenterColID_Key"),(t=new f.a).Header="Destination fld",t.ValueBinding="DestCostCenterColID",t.DataType="PactComboBox",t.DisplayMember="ResourceData",t.ValueMember="CostCenterColID",t.Width=200,t.ComboData=e.Tables[4],this.linkGrid.Columns.push(t),this.linkGrid.TableColumns.push("DestCostCenterColID"),this.linkGrid.TableColumns.push("DestCostCenterColID_Key");for(var n=0;n<10;n++)this.linkGrid.addEmptyRow()}},{key:"onSelectionChangedCommand",value:function(e){var t=this;if(null!=e&&101==e.DBColumnID){if(this.IsApprove)return;if(o.e.IsEmpty(this.SrcDocument.SelectedValue))return;this.DestDocument.Items.Clear();var n=this.LinkedData.filter((function(e){return e.CostCenterIDLinked==t.SrcDocument.SelectedValue}));if(n.length>0)for(var a=0;a<n.length;a++)this.DestDocument.Items.push(m.d.ComboBoxItems_2(n[a].SourceDocumentName.toString(),n[a].CostCenterIDBase.toString()))}}},{key:"OnApproveBeginEdit",value:function(e){var t=e.args.column.field;return"IsSelected"!=t&&"AppRemarks"!=t||"0"==e.args.item.CanApprove.toString()}},{key:"OnBeginningEdit",value:function(e){var t=e.args.item,n=e.args.column.field,a=e.args.column;if("DataGridComboBoxColumn"==a.className)a.ItemsSource instanceof DataView&&("DestCostCenterColID"==n?a.ItemsSource.RowFilter=null!=this.DestDocument.SelectedValue&&""!=this.DestDocument.SelectedValue?"CostCenterID="+this.DestDocument.SelectedValue:"CostCenterID=0":"SrcCostCenterColID"==n&&(a.ItemsSource.RowFilter=null!=this.SrcDocument.SelectedValue&&""!=this.SrcDocument.SelectedValue?"CostCenterID="+this.SrcDocument.SelectedValue:"CostCenterID=0"));else if("DataGridPactComboBoxColumn"==a.className&&a.ItemsSource instanceof DataView)if("DestCostCenterColID_Key"==n)a.ItemsSource.RowFilter=""!=t.DestCostCenterID.toString()?"CostCenterID="+t.DestCostCenterID.toString():"CostCenterID=0";else if("SrcCostCenterColID_Key"==n)a.ItemsSource.RowFilter=""!=t.SrcCostCenterID.toString()?"CostCenterID="+t.SrcCostCenterID.toString():"CostCenterID=0";else if("DestCostCenterID_Key"==n)if(""!=t.SrcCostCenterID.toString()){var i=this.LinkedData.filter((function(e){return e.CostCenterIDLinked==t.SrcCostCenterID}));if(i.length>0){for(var r="",s=0;s<i.length;s++)""!=r&&(r+=","),r+=i[s].CostCenterIDBase.toString();a.ItemsSource.RowFilter="CostCenterID in ("+r+")"}else a.ItemsSource.RowFilter="CostCenterID=0"}else a.ItemsSource.RowFilter="CostCenterID=0";return!1}},{key:"OnButtonClick",value:function(e){var t=this;if("Cancel"==e)""==this.Filters&&o.e.IsEmpty(this.SrcDocument.SelectedValue)||this.Parent.ScreenObject.GridDataObj.ClearFilters(),s.a.page.HideDialog();else if("Reject"==e){""==this.Filters&&o.e.IsEmpty(this.SrcDocument.SelectedValue)||this.Parent.ScreenObject.GridDataObj.ClearFilters();var n=this.linkGrid.Columns.find((function(e){return!o.e.IsEmpty(e.DisplayMember)&&"IsSelected"==e.DisplayMember}));n&&(n.IsVisible=!1);for(var a="",i=0;i<this.Parent.ScreenObject.GridData.length;i++)Object(l.j)(this.Parent.ScreenObject.GridData[i].IsSelected.toString())&&(a+='<Row ID="'+this.Parent.ScreenObject.GridData[i].DocDetailsID.toString()+'" Remarks="'+this.Parent.ScreenObject.GridData[i].AppRemarks.toString()+'" />');""!=a.toString()&&(a="<XML>"+a,a+="</XML>",this.Parent.SaveStatus(372,0,a.toString())),s.a.page.HideDialog()}else if("OKApprove"==e){if(!this.IsApprove&&!this.SrcDocument.Visible)return void s.a.page.HideDialog();if(this.linkGrid.Table.filter((function(e){return 2==e.IsSelected||1==e.IsSelected})).length>0){if(this.Parent.ScreenObject.Preferences.ContainsKey("CommentsMandatoryforApprove")&&""!=this.Parent.ScreenObject.Preferences.CommentsMandatoryforApprove&&Object(l.j)(this.Parent.ScreenObject.Preferences.CommentsMandatoryforApprove)&&this.linkGrid.Table.filter((function(e){return e.IsSelected=o.e.IsEmpty(e.AppRemarks)})).length>0)return void(this.DisplayMessage="Remarks Mandatory For Approval");if(this.Parent.ScreenObject.Preferences.ContainsKey("CommentsMandatoryforReject")&&""!=this.Parent.ScreenObject.Preferences.CommentsMandatoryforReject&&Object(l.j)(this.Parent.ScreenObject.Preferences.CommentsMandatoryforReject)&&this.linkGrid.Table.filter((function(e){return e.IsSelected=o.e.IsEmpty(e.AppRemarks)})).length>0)return this.DisplayMessage="Remarks Mandatory For Reject",void(this.MessageVisibility=!0);if(s.a.SessionManager.IsActionAssigned(this.Parent.CostCenterID,"Edit"))""==this.Filters&&o.e.IsEmpty(this.SrcDocument.SelectedValue)||this.Parent.ScreenObject.GridDataObj.ClearFilters(),s.a.page.HideDialog(),this.Parent.SaveInventoryDocument_1("Approve");else{for(var r=!0,c="",u=0;u<this.Parent.ScreenObject.GridData.length;u++)"2"==o.e.StringValue(this.Parent.ScreenObject.GridData[u].IsSelected)&&(c+='<Row ID="'+this.Parent.ScreenObject.GridData[u].DocDetailsID.toString()+'" Remarks="'+o.e.StringValue(this.Parent.ScreenObject.GridData[u].AppRemarks)+'" />',5==this.Parent.DocumentType&&""!=this.Parent.ScreenObject.GridData[u].TODocDetailsID.toString()&&(c+='<Row ID="'+this.Parent.ScreenObject.GridData[u].TODocDetailsID.toString()+'" Remarks="'+o.e.StringValue(this.Parent.ScreenObject.GridData[u].AppRemarks)+'" />'));""!=c.toString()&&(c="<XML>"+c,c+="</XML>",this.Parent.SaveStatus(372,0,c.toString()),r=!1),c="";for(var d=0;d<this.Parent.ScreenObject.GridData.length;d++)"1"==o.e.StringValue(this.Parent.ScreenObject.GridData[d].IsSelected)&&(c+='<Row ID="'+o.e.String(this.Parent.ScreenObject.GridData[d].DocDetailsID),c+='" WID="'+this.Parent.GetWorkFlow(!1,this.Parent.ScreenObject.GridData[d]),c+='" Remarks="'+o.e.String(this.Parent.ScreenObject.GridData[d].AppRemarks)+'" />',5==this.Parent.DocumentType&&""!=this.Parent.ScreenObject.GridData[d].TODocDetailsID.toString()&&(c+='<Row ID="'+o.e.String(this.Parent.ScreenObject.GridData[d].TODocDetailsID),c+='" WID="'+this.Parent.GetWorkFlow(!1,this.Parent.ScreenObject.GridData[d]),c+='" Remarks="'+o.e.String(this.Parent.ScreenObject.GridData[d].AppRemarks)+'" />'));""!=c.toString()&&(c="<XML>"+c,c+="</XML>",this.Parent.SaveStatus(369,0,c.toString(),r)),""==this.Filters&&o.e.IsEmpty(this.SrcDocument.SelectedValue)||this.Parent.ScreenObject.GridDataObj.ClearFilters(),s.a.page.HideDialog()}}else this.DisplayMessage="Select either Approve or Reject or else Cancel to Quit",this.MessageVisibility=!0}else if("OK"==e)for(var D=this.linkGrid.Columns[0].ComboData,h=function(e){if(""!=t.linkGrid.Table[e].SrcCostCenterColID.toString()&&""!=t.linkGrid.Table[e].DestCostCenterColID.toString()){var n=D.filter((function(n){return n.CostCenterColID==t.linkGrid.Table[e].SrcCostCenterColID})),a=n[0].SysColumnName.toString(),i=(n=D.filter((function(n){return n.CostCenterColID==t.linkGrid.Table[e].DestCostCenterColID})))[0].SysColumnName.toString();a.toLowerCase().Contains("dcnum")&&i.toLowerCase().Contains("dcnum")?(s.a.common.GetDataSet3("DOC044",i+","+a,t.SrcDocument.SelectedValue+","+t.DestDocument.SelectedValue,t.FromDate.Date.ToString("dd/MMM/yyyy")+","+t.ToDate.Date.ToString("dd/MMM/yyyy")),t.DisplayMessage="updated succesfully"):a.toLowerCase().Contains("dcnum")&&""!=i&&!i.toLowerCase().Contains("dcnum")?(s.a.common.GetDataSet3("DOC045",i+","+a,t.SrcDocument.SelectedValue+","+t.DestDocument.SelectedValue,t.FromDate.Date.ToString("dd/MMM/yyyy")+","+t.ToDate.Date.ToString("dd/MMM/yyyy")),t.DisplayMessage="updated succesfully"):""!=a&&!a.toLowerCase().Contains("dcnum")&&i.toLowerCase().Contains("dcnum")?(s.a.common.GetDataSet3("DOC046",i+","+a,t.SrcDocument.SelectedValue+","+t.DestDocument.SelectedValue,t.FromDate.Date.ToString("dd/MMM/yyyy")+","+t.ToDate.Date.ToString("dd/MMM/yyyy")),t.DisplayMessage="updated succesfully"):""==a||a.toLowerCase().Contains("dcnum")||""==i||i.toLowerCase().Contains("dcnum")||(s.a.common.GetDataSet3("DOC047",i+","+a,t.SrcDocument.SelectedValue+","+t.DestDocument.SelectedValue,t.FromDate.Date.ToString("dd/MMM/yyyy")+","+t.ToDate.Date.ToString("dd/MMM/yyyy")),t.DisplayMessage="updated succesfully")}},S=0;S<this.linkGrid.Table.length;S++)h(S)}},{key:"Rejectall",get:function(){return this._Rejectall},set:function(e){var t=this;e!=this._Rejectall&&(this._Rejectall=e,e&&(this._Approveall=!1,this.chkApproveall.IsChecked=!1),this.linkGrid.Table.forEach((function(e){t._Rejectall&&!o.e.IsEmpty(e.ProductID_Key)&&"1"==o.e.String(e.CanApprove)?e.IsSelected="2":t._Rejectall||"2"!=o.e.String(e.IsSelected)||(e.IsSelected="0")})),this.linkGrid.invalidate())}},{key:"Approveall",get:function(){return this._Approveall},set:function(e){var t=this;e!=this._Approveall&&(this._Approveall=e,e&&(this._Rejectall=!1,this.chkRejectall.IsChecked=!1),this.linkGrid.Table.forEach((function(e){t._Approveall&&!o.e.IsEmpty(e.ProductID_Key)&&"1"==o.e.String(e.CanApprove)?e.IsSelected="1":t._Approveall||"1"!=o.e.String(e.IsSelected)||(e.IsSelected="0")})),this.linkGrid.invalidate())}}]),n}(u.b),ke=n("/dSa"),_e=n("JTUb"),Ke=n("5FTv"),Qe=n("ia84"),He=n("SW+i"),We=n("bh5u"),Ue=n("6z9j"),Xe=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,a,i){var r;if(_classCallCheck(this,n),(r=t.call(this)).IsCopy=!1,r.dsCopy=null,r.dscols=null,r.isCancel=!1,r.Parent=e,r.IsCopy=a,r.tree=[],r.Header=r.IsCopy?"Copy":s.a.GetResource("SelectDocument"),r.CostCenters=new m.e(0),r.CostCenters.SelectionChangedCommand.Subscribe(_assertThisInitialized(r),"OnCostCenterChange"),a){var o=Fe.a.GetAllDocuments();if(null!=o&&o.Tables.length>0&&o.Tables[0].length>0)for(var c=o.Tables[3].filter((function(e){return e.CostCenterIDBase==i})),u=0;u<c.length;u++)for(var d=c[u],D=0;D<o.Tables[6].length;D++)if(d.CostCenterIDLinked.toString()==o.Tables[6][D].CostCenterID.toString()){if(o.Columns[6].Contains("Isinventory")&&r.Parent.IsInventoryVoucher!=Object(l.j)(o.Tables[6][D].Isinventory.toString()))continue;r.CostCenters.Items.push(m.d.ComboBoxItems_6(o.Tables[6][D].ResourceData.toString(),o.Tables[6][D].CostCenterID.toString(),Object(l.j)(parseInt(d.SelectionType)),d.GridViewID.toString(),o.Tables[6][D].DocumentType.toString()))}r.CostCenters.SelectedValue=i,r.CostCenters.SelectedItem=r.CostCenters.GetselectedItem(),r.OnCostCenterChange("")}else r.CostCenters.Items.push(m.d.ComboBoxItems_6("",i.toString(),!1,"0",r.Parent.DocumentType.toString())),r.CostCenters.SelectedValue=i,r.CostCenters.SelectedItem=r.CostCenters.GetselectedItem(),r.OnCostCenterChange(""),r.CostCenters.Visible=!1;return r.CostCenters.Label=s.a.GetResource("SelectDocument"),_possibleConstructorReturn(r)}return _createClass(n,[{key:"Refresh",value:function(){null!=this.tree&&this.tree.length>0&&(this.tree[0].RefreshData=!0)}},{key:"OnCostCenterChange",value:function(e){if(!o.e.IsEmpty(this.CostCenters.SelectedValue)){if(null!=this.ccID&&this.CostCenters.SelectedValue==this.ccID)return;this.ccID=this.CostCenters.SelectedValue,this.tree.Clear();var t=0;!this.CostCenters.SelectedItem||o.e.IsEmpty(this.CostCenters.SelectedItem.Parent)||o.e.Double(this.CostCenters.SelectedItem.Aliasname)>0||!o.e.IsNum(this.CostCenters.SelectedItem.Parent)?(t=parseInt(this.CostCenters.SelectedValue))>40999&&!(null!=this.CostCenters.SelectedItem&&parseInt(this.CostCenters.SelectedItem.Aliasname)>0)&&(t=4e4+this.Parent.DocumentType):parseInt(this.CostCenters.SelectedItem.Parent)<33?t=4e4+parseInt(this.CostCenters.SelectedItem.Parent):33==parseInt(this.CostCenters.SelectedItem.Parent)?t=40998:34==parseInt(this.CostCenters.SelectedItem.Parent)?t=40999:35==parseInt(this.CostCenters.SelectedItem.Parent)?t=40997:36==parseInt(this.CostCenters.SelectedItem.Parent)?t=40995:37==parseInt(this.CostCenters.SelectedItem.Parent)&&(t=40996);var n=new Ue.a;n.TreeViewModel(t,this,null!=this.CostCenters.SelectedItem?parseInt(this.CostCenters.SelectedItem.Aliasname):0,"",Date.Today(),"","","",this.CostCenters.SelectedValue,""),n.HeaderVisiblity=!1,n.ViewsVisible=!1,this.tree.push(n),null!=n.Data&&n.Data.length>0?this.MessageVisibility=!1:(this.MessageVisibility=!0,this.DisplayMessage=s.a.GetResource("CopyDocNoDocs"))}}},{key:"OnSearch",value:function(e){"OK"==e.toString()?null==this.SelectedNode&&null==this.SelectedNodes?(this.DisplayMessage=s.a.GetResource("CopyDocNoSelection"),this.MessageVisibility=!0):this.SelectDcument(!0):"Cancel"==e.toString()&&(this.Parent.DialogResult=!1,s.a.page.HideDialog())}},{key:"CommandController",value:function(e){this.SelectDcument(!1)}},{key:"SelectDcument",value:function(e){var t=this;if(!this.IsCopy)return null!=this.SelectedNode&&(this.Parent.ScreenObject.DocPrefix.ComboBox.Items.find((function(e){return e instanceof m.d&&e.Value==t.SelectedNode.Text[t.SelectedNode.Text.length-2]}))||this.Parent.ScreenObject.DocPrefix.ComboBox.Items.push(m.d.ComboBoxItems_2(this.SelectedNode.Text[this.SelectedNode.Text.length-2],this.SelectedNode.Text[this.SelectedNode.Text.length-2])),this.Parent.ScreenObject.DocPrefix.ComboBox.SelectedValue=this.SelectedNode.Text[this.SelectedNode.Text.length-2],this.Parent.ScreenObject.DocPrefix.TextBox.Text=this.SelectedNode.Text[this.SelectedNode.Text.length-1],this.Parent.OnDocPrefixChanged("lostFocus")),void s.a.page.HideDialog();var n="";this.Parent.IsInventoryVoucher?n="ProductID_Key":this.Parent.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")?n="CreditAccount_Key":this.Parent.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")?n="DebitAccount_Key":this.Parent.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&(n="AccountID_Key");var a=this.Parent.GetEmptyRowPosition(this.Parent.ScreenObject.GridDataObj,n);if(null!=this.CostCenters.SelectedValue&&(this.dscols=this.Parent.ScreenObject.GetCopyLinkDetails(this.Parent.CostCenterID,parseInt(this.CostCenters.SelectedValue))),null!=this.dscols&&this.dscols.Tables.length>0&&!this.dscols.Columns[0].Contains("ErrorMessage")&&this.dscols.Tables[0].length>0||parseInt(this.CostCenters.SelectedValue)==this.Parent.CostCenterID){if(e&&null!=this.SelectedNodes&&this.SelectedNodes.length>1)for(var i=0;i<this.SelectedNodes.length;i++){var r=this.SelectedNodes[i];this.dsCopy=this.Parent.ScreenObject.GetEditDataCopy(r.Text[this.SelectedNode.Text.length-3],r.Text[this.SelectedNode.Text.length-2],this.CostCenters.SelectedValue),null!=this.CostCenters.SelectedItem&&this.CostCenters.SelectedItem.Status&&s.a.page.HideDialog(),this.isCancel||(null!=this.dscols&&this.dscols.Tables.length>0&&this.dscols.Tables[0].length>0?(this.Parent.LoadLinkData(this.dsCopy,new Array,a,new Array,this.dscols.Tables[0]),null!=this.dsCopy&&this.dsCopy.Tables.length>0&&!this.dsCopy.Columns[0].Contains("ErrorMessage")&&(a+=this.dsCopy.Tables[0].length)):parseInt(this.CostCenters.SelectedValue)==this.Parent.CostCenterID&&(this.Parent.ScreenObject.LoadEditData(this.dsCopy,!0),null!=this.Parent.ViewAttachments&&this.dsCopy.Tables.length>8&&(this.dsCopy.Tables[8].Columns.FileID.Expression="0",this.Parent.ViewAttachments.LoadAttachments(this.dsCopy.Tables[8]))))}else null!=this.SelectedNode&&(this.dsCopy=this.Parent.ScreenObject.GetEditDataCopy(this.SelectedNode.Text[this.SelectedNode.Text.length-3],this.SelectedNode.Text[this.SelectedNode.Text.length-2],this.CostCenters.SelectedValue),null!=this.CostCenters.SelectedItem&&this.CostCenters.SelectedItem.Status&&s.a.page.HideDialog(),this.isCancel||(null!=this.dscols&&this.dscols.Tables.length>0&&this.dscols.Tables[0].length>0?this.Parent.LoadLinkData(this.dsCopy,new Array,a,new Array,this.dscols.Tables[0]):parseInt(this.CostCenters.SelectedValue)==this.Parent.CostCenterID&&(this.Parent.ScreenObject.LoadEditData(this.dsCopy,!0),null!=this.Parent.ViewAttachments&&this.dsCopy.Tables.length>8&&(this.dsCopy.Tables[8].Columns.FileID.Expression="0",this.Parent.ViewAttachments.LoadAttachments(this.dsCopy.Tables[8])))));this.Parent.ScreenObject.UpdateSequence()}this.Parent.DialogResult=!0,s.a.page.HideDialog()}},{key:"ClearSelectedNodes",get:function(){return this._ClearSelectedNodes},set:function(e){this._ClearSelectedNodes=e,this.tree.length>0&&(this.tree[0].ClearAllSelectedNodes=!this.tree[0].ClearAllSelectedNodes)}}]),n}(u.b),qe=n("CQvG"),Ye=n("DKUf"),ze=n("31sV"),Je=n("JUeo"),Ze=n("V52s"),$e=n("kD5w"),et=n("0LKI"),tt=function(){function e(t){_classCallCheck(this,e),this.sbErrorMsg="",this.sbErrorMsgCmplt="",this.iBudgetDimension=0,this.QtyType=0,this.DueDateCheck=!1,this.BudgetDateField="",this.BudgetAccountField="",this.lstBudgets=new c.c,this.Document=t,this.iBudgetDimension=s.a.SessionManager.Preferences.BudgetDimension.length>0?parseInt(s.a.SessionManager.Preferences.BudgetDimension):0;var n=!0;this.ScreenObject.Preferences.ContainsKey("DonotupdateAccounts")&&""!=this.ScreenObject.Preferences.DonotupdateAccounts&&(n=Object(l.j)(this.ScreenObject.Preferences.DonotupdateAccounts)),this.ScreenObject.IsInventory&&n&&this.ScreenObject.Preferences.ContainsKey("BUDGET_DueDateCheck")&&"TRUE"==this.ScreenObject.Preferences.BUDGET_DueDateCheck.toUpperCase()&&(this.DueDateCheck=!0),this.ScreenObject.IsInventory&&this.ScreenObject.Preferences.ContainsKey("BUDGET_BudgetDateField")&&!o.e.IsEmpty(this.ScreenObject.Preferences.BUDGET_BudgetDateField)&&(this.BudgetDateField=this.ScreenObject.Preferences.BUDGET_BudgetDateField),this.ScreenObject.IsInventory&&this.ScreenObject.Preferences.ContainsKey("BUDGET_BudgetAccountField")&&!o.e.IsEmpty(this.ScreenObject.Preferences.BUDGET_BudgetAccountField)&&(this.BudgetAccountField=this.ScreenObject.Preferences.BUDGET_BudgetAccountField)}return _createClass(e,[{key:"BudgetValidation",value:function(e){if(this.Document.DisplayMessage="",this.sbErrorMsg="",this.sbErrorMsgCmplt="",this.Document.IgnoreOnSave.ContainsKey("BUDGET"))"true"==s.a.SessionManager.Preferences.GBudgetUnapprove.toLowerCase()&&(this.Document.DisplayMessage=this.Document.IgnoreOnSave.BUDGET.toString());else{this.lstBudgets.Clear();var t=new o.f;e.startsWith("\x11".toString())&&(e="<XML>"+(e=e.replace("\x11",""))+"</XML>"),t.LoadXml(e);var n={date:this.ScreenObject.DocDate.Date,strDateXML:""};if(o.e.IsEmpty(this.BudgetDateField)){if(this.DueDateCheck&&(this.BudgetField("DueDate",n,t),0==this.lstBudgets.length))return void Logger.DebugLog("No Budgets Found For Non Accounting Documents.")}else this.BudgetField(this.BudgetDateField,n,t);try{this.CheckBudget(t,n.date,n.strDateXML)}catch(i){this.Document.DisplayMessage="Budget Error",Logger.ErrorLog("BudgetValidation: "+i.stack)}if(this.sbErrorMsg.length>0||this.sbErrorMsgCmplt.length>0)if(this.sbErrorMsg.length>0&&"1"!=s.a.SessionManager.RoleID&&s.a.SessionManager.IsActionAssigned(101,"Dont Save Voucher If Amount Exceeds Budget"))alert(this.sbErrorMsg),this.Document.DisplayMessage="Budget Error";else if(this.sbErrorMsgCmplt.length>0&&"1"!=s.a.SessionManager.RoleID&&s.a.SessionManager.IsActionAssigned(101,"Dont Save Voucher If Amount Exceeds Total Budget"))alert(this.sbErrorMsgCmplt),this.Document.DisplayMessage="Budget Error";else if(this.sbErrorMsg.length>0){var a=confirm(this.sbErrorMsg+"\r\n Do you want to continue?");this.Document.DisplayMessage=a?"true"!=s.a.SessionManager.Preferences.GBudgetUnapprove.toLowerCase()?"":"Budget Error":" "}}}},{key:"BudgetField",value:function(e,t,n){var a=this,i=this.ScreenObject._TextFields.find((function(t){return t.DBColumnName==e}));if("DueDate"==e&&this.ScreenObject.DueDate||e.Contains("dcAlpha")&&i instanceof S.c){"DueDate"==e&&this.ScreenObject.DueDate.Date?t.date=this.ScreenObject.DueDate.Date:e.Contains("dcAlpha")&&i.Date&&(t.date=i.Date);var r=this.ScreenObject.Data.Tables[5].filter((function(e){return e.FromDate<=t.date&&e.ToDate>=t.date}));r.length>0&&this.lstBudgets.push(parseInt(r[0].BudgetDefID),null)}else{var s=!1;console.log(n.DocumentElement),alert("check:budget-75");for(var c=o.f.SelectNodes(n.DocumentElement,"Row/Transactions"),l=function(n){var i=c[n];if(null!=i.attributes[e]&&""!=i.attributes[e].Value){t.strDateXML+='<Row Date="'+i.attributes[e].Value+'" />';var r=a.ScreenObject.Data.Tables[5].filter((function(t){return t.FromDate<=i.attributes[e].Value&&t.ToDate>=i.attributes[e].value}));if(0==r.length)return Logger.DebugLog("Budget Not Found"),"continue";var o=parseInt(r[0].BudgetDefID);a.lstBudgets.ContainsKey(o)||a.lstBudgets.push(o,null),i.setAttribute("BudgetID",o.toString())}else{s=!0;var l=a.ScreenObject.Data.Tables[5].filter((function(e){return e.FromDate<=a.ScreenObject.DocDate.Date&&e.ToDate>=a.ScreenObject.DocDate.Date}));if(0==l.length)return Logger.DebugLog("Budget Not Found"),"continue";var u=parseInt(l[0].BudgetDefID);a.lstBudgets.ContainsKey(u)||a.lstBudgets.push(u,null),i.setAttribute("BudgetID",u.toString())}},u=0;u<c.length;u++)l(u);t.strDateXML.length>0&&(s&&(t.strDateXML+='<Row Date="'+this.ScreenObject.DocDate.Date.ToString("dd MMM yyyy")+'" />'),t.strDateXML="<XML>"+t.strDateXML+"</XML>")}}},{key:"CheckBudget",value:function(e,t,n){var a,i,r,l,u=this,d=0,D=0,h=null,S="";if(this.Document.IsInventoryVoucher){if(0==this.lstBudgets.length){if((h=new nt(this.Document,t,0)).IsEmtyOrNoDefn)return}else this.lstBudgets.keys.forEach((function(e){var n=new nt(u.Document,t,e);u.lstBudgets[e]=n}));for(var m=function(n){var a=e.DocumentElement.children[n];if(!o.e.IsEmpty(i.attributes.IsSelected)&&"2"==i.attributes.IsSelected.value)return{v:void 0};l=t,i=o.f.SelectSingleNode(a,"Transactions"),l=t,o.e.IsEmpty(u.BudgetDateField)||null==i.attributes[u.BudgetDateField]||""==i.attributes[u.BudgetDateField].value?u.DueDateCheck&&!o.e.IsEmpty(i.attributes.DueDate)&&""!=i.attributes.DueDate.value&&(l=new Date(i.attributes.DueDate.value)):l=new Date(i.attributes[u.BudgetDateField].value);var c,m,b=h;if(u.lstBudgets.length>0&&(b=o.e.IsEmpty(i.attributes.BudgetID)?u.lstBudgets.values[0]:u.lstBudgets[parseInt(i.attributes.BudgetID.value)]),b.IsEmtyOrNoDefn)return{v:void 0};if(b.SetCurrentBudgetColumn(l,!1,u.BudgetDateField),b.IsEmtyOrNoDefn)return{v:void 0};(b.ClearInput(),null!=(r=o.f.SelectSingleNode(a,"CostCenters")).attributes.Query)&&r.attributes.Query.value.split(",").forEach((function(e){if((c=e.Trim()).startsWith("dcCCNID")&&(c=c.replace("dcCCNID",""),m=c.split("="),parseInt(m[1])>1)){var t="D"+(5e4+parseInt(m[0])).toString();b.dtBdgtTblColumns.Contains(t)&&(b.dtBdgtInp[0][t]=m[1])}}));if(b.dtBdgtTblColumns.Contains("D3")&&(D=parseInt(i.attributes.ProductID.value),b.dtBdgtInp[0].D3=D),b.dtBdgtInp[0].DocSeqNo=i.attributes.DocSeqNo.value,null!=i.attributes.LinkedInvDocDetailsID&&""!=i.attributes.LinkedInvDocDetailsID.value&&(b.dtBdgtInp[0].LinkedInvDocDetailsID=i.attributes.LinkedInvDocDetailsID.value,null!=i.attributes.LinkedFieldValue&&""!=i.attributes.LinkedFieldValue.value&&(b.dtBdgtInp[0].LinkedFieldValue=i.attributes.LinkedFieldValue.value)),b.IsQtyBudget>0){for(var C=0,y=0;y<e.DocumentElement.children.length;y++)parseInt(i.attributes.ProductID.value)==D&&(1==u.QtyType?null!=i.attributes.IsQtyFreeOffer&&parseInt(i.attributes.IsQtyFreeOffer.value)>0&&(1==parseInt(i.attributes.IsQtyFreeOffer.value)||null!=i.attributes.ParentSchemeID&&"0"!=i.attributes.ParentSchemeID.value)&&(C+=parseFloat(i.attributes.UOMConvertedQty.value)):2==u.QtyType?(null==i.attributes.IsQtyFreeOffer||parseInt(i.attributes.IsQtyFreeOffer.value)>1&&null==o.f.SelectSingleNode(a,"Transactions").attributes.ParentSchemeID)&&(C+=parseFloat(i.attributes.UOMConvertedQty.value)):C+=parseFloat(i.attributes.UOMConvertedQty.value));if(b.dtBdgtInp[0]["Amount Used"]=C,b.dtBdgtTblColumns.Contains("D2")&&(d=u.ScreenObject.IsPurchase?parseInt(i.attributes.CreditAccount.value):parseInt(i.attributes.DebitAccount.value),b.dtBdgtInp[0].D2=d),b.CheckBudgetRow(),u.CheckAlertMsg())return{v:void 0}}else if(b.NonAccountingDocs.Contains(u.Document.CostCenterID.toString())){var p,g=o.f.SelectSingleNode(a,"Numeric");if(null!=g.attributes.Query)g.attributes.Query.value.split(",").forEach((function(e){(p=e.Trim()).startsWith("dcCalcNum"+b.NonAccountingDocsField+"=")&&(p=p.replace("dcCalcNum"+b.NonAccountingDocsField+"=",""))}))}else if(b.IsAccountTypeWise){S="";for(var f=o.f.SelectSingleNode(a,"AccountsXML"),O=0;O<f.children.length;O++)S+=f.children[O].attributes.DebitAccount.value+",",S+=f.children[O].attributes.CreditAccount.value+",";if(S.length>0){b.dtBdgtInp[0]["Amount Used"]=0;for(var I,T=s.a.common.GetDataSet("DOC036",S.TrimEnd(",")).Tables[0],j=o.f.SelectSingleNode(a,"AccountsXML").children,P=0;P<j.length;P++){var A=j[P];(I=T.filter((function(e){return e.AccountID==i.attributes.DebitAccount.value}))).length>0&&b.SelectedAccountTypes.Contains(I[0].AccountTypeID.toString())&&(b.dtBdgtInp[0]["Amount Used"]=parseFloat(b.dtBdgtInp[0]["Amount Used"])+parseFloat(A.attributes.Amount.value)),(I=T.filter((function(e){return e.AccountID==i.attributes.CreditAccount.value}))).length>0&&b.SelectedAccountTypes.Contains(I[0].AccountTypeID.toString())&&(b.dtBdgtInp[0]["Amount Used"]=parseFloat(b.dtBdgtInp[0]["Amount Used"])-parseFloat(A.attributes.Amount.value))}if(b.CheckBudgetRow(),u.CheckAlertMsg())return{v:void 0}}}else{for(var M=o.f.SelectSingleNode(a,"AccountsXML").children,v=0;v<M.length;v++){var G=M[v];if(b.dtBdgtInp[0]["Amount Used"]=parseFloat(G.attributes.Amount.value),b.ChkBudgetOnlyForDefnAccounts){if(b.dtBdgtTblColumns.Contains("D2")){if(b.dtBdgtInp[0].D2=parseInt(G.attributes.DebitAccount.value),b.CheckBudgetRow(),u.CheckAlertMsg())return{v:void 0};if(b.dtBdgtInp[0].D2=parseInt(G.attributes.CreditAccount.value),b.CheckBudgetRow(),u.CheckAlertMsg())return{v:void 0}}}else if(b.dtBdgtTblColumns.Contains("D2")&&(d=parseInt(G.attributes.DebitAccount.value),b.dtBdgtInp[0].D2=d),b.CheckBudgetRow(),u.CheckAlertMsg())return{v:void 0}}if(!o.e.IsEmpty(u.BudgetAccountField)&&null!=i.attributes[u.BudgetAccountField].value&&o.e.IsNum(i.attributes[u.BudgetAccountField].value)&&(d=o.e.Int(i.attributes[u.BudgetAccountField].value),b.dtBdgtInp[0].D2=d,b.CheckBudgetRow(),u.CheckAlertMsg()))return{v:void 0}}},b=0;b<e.DocumentElement.children.length;b++){var C=m(b);if("object"==typeof C)return C.v}}else{var y=function(){if((h=new nt(u.Document,t,0)).IsEmtyOrNoDefn)return{v:void 0};var n,l,d,D=null,m=[],b=[],C=m;h.lstDimensions.forEach((function(e){b.push("D"+e)})),h.IsAccountTypeWise&&b.push("D2"),b.push("Amount"),b.push("AccountType"),b.push("DocSeqNo"),S="",new c.c,new c.c;for(var y=function(t){var s=e.DocumentElement.children[t],c=[],u=[];i=o.f.SelectSingleNode(s,"Transactions"),r=o.f.SelectSingleNode(s,"CostCenters");var d=[];d=null!=r.attributes.Query?r.attributes.Query.value.split(","):[],l=m,h.lstDimensions.forEach((function(e){if(e>5e4){n="dcCCNID"+(e-5e4)+"=";var t=d.find((function(e){return e.Trim().startsWith(n)}));n=t?t.Trim().Replace(n,""):"1",c["D"+e]=u["D"+e]=n,l=m.filter((function(t){return t["D"+e]==n}))}})),a=parseFloat(i.attributes.Amount.value),(C=l.filter((function(e){return e.D2==i.attributes.DebitAccount.value}))).length>0?(C[0].Amount=parseFloat(C[0].Amount)+a,C[0].DocSeqNo=i.attributes.DocSeqNo.value):(S+=i.attributes.DebitAccount.value+",",c.D2=i.attributes.DebitAccount.value,c.Amount=a,c.DocSeqNo=i.attributes.DocSeqNo.value,m.push(c)),(C=l.filter((function(e){return e.D2==i.attributes.CreditAccount.value}))).length>0?(C[0].Amount=parseFloat(C[0].Amount)-a,C[0].DocSeqNo=i.attributes.DocSeqNo.value):(S+=i.attributes.CreditAccount.value+",",u.D2=i.attributes.CreditAccount.value,u.Amount=-a,u.DocSeqNo=i.attributes.DocSeqNo.value,m.push(u))},p=0;p<e.DocumentElement.children.length;p++)y(p);if(S.length>0&&(D=s.a.common.GetDataSet("DOC036",S.TrimEnd(",")).Tables[0]),m.forEach((function(e){var t=D.filter((function(t){return t.AccountID==e.D2}));d=parseInt(t[0].AccountTypeID),e.AccountType=d})),h.IsAccountTypeWise)for(var g=!1,f=0;f<m.length;f++)if(d=parseInt(m[f].AccountType),h.SelectedAccountTypes.Contains(d.toString()))for(var O=f+1;O<m.length;O++)if(h.SelectedAccountTypes.Contains(m[O].AccountType.toString())){g=!1;for(var I=0;I<h.lstDimensions.length;I++){var T=h.lstDimensions[I];if(m[f]["D"+T].toString()!=m[O]["D"+T].toString()){g=!0;break}}g||(m[f].Amount=parseFloat(m[f].Amount)+parseFloat(m[O].Amount),m.RemoveAt(O),O--)}else m.RemoveAt(O),O--;else m.RemoveAt(f),f--;for(var j=function(e){var t=m[e];if(d=parseInt(t.AccountType),parseFloat(t.Amount)>0&&(h.ChkBudgetOnlyForDefnAccounts||7==d||12==d)&&(h.ClearInput(),h.dtBdgtInp[0]["Amount Used"]=t.Amount,h.dtBdgtInp[0].DocSeqNo=t.DocSeqNo,h.lstDimensions.forEach((function(e){h.dtBdgtInp[0]["D"+e]=t["D"+e]})),h.CheckBudgetRow(),u.CheckAlertMsg()))return{v:{v:void 0}}},P=0;P<m.length;P++){var A=j(P);if("object"==typeof A)return A.v}}();if("object"==typeof y)return y.v}}},{key:"ValidateBudget",value:function(e,t){var n=this;t.dim=null,t.LineWiseBudget=!1,t.BudID=0,t.BudStartDate=new Date;var a,i="";this.ScreenObject.Data.Tables.length>4&&this.ScreenObject.Data.Tables[5].length>0&&function(){var r=n.ScreenObject.Data.Tables[5].filter((function(t){return t.QtyBudget==e.toString()&&t.FromDate<=n.Document.DocumentDate&&t.ToDate>=n.Document.DocumentDate}));if(r.sort((function(e,t){return e.BudgetDefID-t.BudgetDefID})),r.length>0){t.dim=[],t.BudID=parseInt(r[0].BudgetDefID.toString()),t.BudStartDate=new Date(r[0].FromDate.toString());for(var s=function(e){"3"==r[e].CostCenterID.toString()||""!=r[e].CostCenterID.toString()&&parseInt(r[e].CostCenterID.toString())>5e4&&n.ScreenObject.GridDataColumns.Contains("dcCCNID"+(parseInt(r[e].CostCenterID.toString())-5e4))?(t.LineWiseBudget=!0,t.dim.push(r[e].CostCenterID.toString())):(a=n.ScreenObject._CCFields.find((function(t){return t.DBColumnName.toLowerCase()=="dcccnid"+(parseInt(r[e].CostCenterID.toString())-5e4)})))&&a instanceof C.b&&a.SelectedValue>0?i+=" and dcccnid"+(parseInt(r[e].CostCenterID.toString())-5e4)+"="+a.SelectedValue:"2"==r[e].CostCenterID.toString()?n.ScreenObject.IsPurchase&&null!=n.ScreenObject.CreditAccount&&n.ScreenObject.CreditAccount.SelectedValue>0?i+=" and CreditAccount="+n.ScreenObject.CreditAccount.SelectedValue:!n.ScreenObject.IsPurchase&&null!=n.ScreenObject.DebitAccount&&n.ScreenObject.DebitAccount.SelectedValue>0&&(i+=" and DebitAccount="+n.ScreenObject.DebitAccount.SelectedValue):i+=" and dcccnid"+(parseInt(r[e].CostCenterID.toString())-5e4)+"=1"},o=0;o<r.length;o++)s(o)}}();return i}},{key:"AutoBudgetDate",value:function(e,t,n){if(t.Table.Columns.Contains(e+"_Key")&&null!=t[e+"_Key"])n.date=new Date(t[e+"_Key"]);else if("DueDate"==e&&null!=this.ScreenObject.DueDate&&this.ScreenObject.DueDate.Date)n.date=this.ScreenObject.DueDate.Date;else if(e.Contains("dcAlpha")){var a=this.ScreenObject._TextFields.find((function(t){return t.DBColumnName==e}));a instanceof S.c&&a.Date&&(n.date=a.Date)}}},{key:"AutoLoadBudgetDimension",value:function(e,t){var n=this,a=this.ScreenObject.DocDate.Date;this.DueDateCheck&&(e.DueDate_Key?a=new Date(e.DueDate_Key):this.ScreenObject.DueDate.Date&&(a=this.ScreenObject.DueDate.Date));var i=this.ScreenObject.Data.Tables[5].filter((function(e){return e.CostCenterID==s.a.SessionManager.Preferences.BudgetDimension&&0==e.QtyBudget&&(0==n.QtyType||!n.QtyType)&&e.FromDate<=a&&e.ToDate>=a})),r="";if(i.length>0&&this.ScreenObject.Data.Tables[5].filter((function(e){return e.BudgetDefID==i[0].BudgetDefID})).forEach((function(t){var a=parseInt(t.CostCenterID);if(2==a){var i="";null!=n.ScreenObject.CreditAccount&&n.ScreenObject.CreditAccount.SelectedValue>0&&(i+=n.ScreenObject.CreditAccount.SelectedValue),null!=n.ScreenObject.DebitAccount&&n.ScreenObject.DebitAccount.SelectedValue>0&&(i.length>0&&(i+=","),i+=n.ScreenObject.DebitAccount.SelectedValue),n.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&""!=e.DebitAccount_Key.toString()&&(i.length>0&&(i+=","),i+=e.DebitAccount_Key.toString()),n.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&""!=e.CreditAccount_Key.toString()&&(i.length>0&&(i+=","),i+=e.CreditAccount_Key.toString()),n.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&""!=e.AccountID_Key.toString()&&(i.length>0&&(i+=","),i+=e.AccountID_Key.toString()),o.e.IsEmpty(n.BudgetAccountField)||!n.ScreenObject.GridDataColumns.Contains(n.BudgetAccountField+"_Key")||o.e.IsEmpty(e[n.BudgetAccountField+"_Key"])||(i.length>0&&(i+=","),i+=e[n.BudgetAccountField+"_Key"].toString()),i.length>0&&(r+=" and B.AccountID in("+i+")")}else if(t.CostCenterID.toString()!=s.a.SessionManager.Preferences.BudgetDimension&&a>5e4)if(n.ScreenObject.GridDataColumns.Contains("dcCCNID"+(a-5e4)))""!=e["dcCCNID"+(a-5e4)+"_Key"].toString()&&(r+=" and B.CCNID"+(a-5e4).toString()+"="+e["dcCCNID"+(a-5e4)+"_Key"].toString());else if(t.CostCenterID.toString()!=s.a.SessionManager.Preferences.BudgetDimension){var c=n.ScreenObject._CCFields.find((function(e){return e instanceof C.b&&e.DBColumnName.toLowerCase()=="dcccnid"+(parseInt(t.CostCenterID.toString())-5e4)}));c instanceof C.b&&c.SelectedValue>0&&(r+=" and B.CCNID"+(c.CCID-5e4)+"="+c.SelectedValue)}})),r.length>0){for(var c=i[0].BudgetDefID.toString(),l=1;l<i.length;l++)c+=","+i[l].BudgetDefID.toString();c=i.length>1?"B.BudgetDefID IN ("+c+")":"B.BudgetDefID="+c;var u="A.NodeID IN (select B.CCNID"+(this.iBudgetDimension-5e4)+" from COM_BudgetAlloc B with(nolock)\n                 where "+c+r;if(s.a.SessionManager.Preferences.BudgetAccount.length>0&&(u=u+" union\n                 select B.CCNID"+(this.iBudgetDimension-5e4)+"\n                 from COM_CostCenterCostCenterMap M with(nolock) \n                 inner join COM_BudgetAlloc B with(nolock) ON B.CCNID"+(this.iBudgetDimension-5e4)+"=M.NodeID\n                 where "+c+" and B.AccountID="+s.a.SessionManager.Preferences.BudgetAccount+" and M.ParentCostCenterID=2 and M.CostCenterID="+s.a.SessionManager.Preferences.BudgetDimension+"\n                 "+r.replace("B.AccountID","M.ParentNodeID")+" group by B.CCNID"+(this.iBudgetDimension-5e4)),u+=" )",null!=t)t.Where=u;else if(this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(this.iBudgetDimension-5e4)+"_Key")){var d=s.a.report.GetTableColumns(this.iBudgetDimension),D=s.a.common.GetDataSet3("DOC037",d.TableName,u);1==D.Tables[0].length&&D.Columns[0].Contains("name")?(e["dcCCNID"+(this.iBudgetDimension-5e4)+"_Key"]=D.Tables[0][0].NodeID,e["dcCCNID"+(this.iBudgetDimension-5e4)]=D.Tables[0][0].Name.toString()):0==D.Tables[0].length&&(e["dcCCNID"+(this.iBudgetDimension-5e4)+"_Key"]=null,e["dcCCNID"+(this.iBudgetDimension-5e4)]=null)}}}},{key:"CheckAlertMsg",value:function(){return this.Document.DisplayMessage.length>0&&(this.sbErrorMsg+=this.sbErrorMsg.length>0?"\r\n":""+this.Document.DisplayMessage,this.Document.DisplayMessage=""),null!=this.Document.AppDisplayMessage&&this.Document.AppDisplayMessage.length>0&&(this.sbErrorMsgCmplt+=(this.sbErrorMsgCmplt.length>0?"\r\n":"")+this.Document.AppDisplayMessage,this.Document.AppDisplayMessage=""),!1}},{key:"ScreenObject",get:function(){return this.Document.ScreenObject}}]),e}(),nt=function(){function e(t,n,a){var i=this;_classCallCheck(this,e),this.QtyType=0,this.IsQtyBudget=0,this.stPosDim=-1,this.ChkBudgetOnlyForDefnAccounts=!1,this.IsEmtyOrNoDefn=!1,this.strBudUtilizesColumn="",this.NonAccountingDocs="",this.NonAccountingDocsField="",this.dtBdgtTblColumns=[],this.dtCommonAccounts=null,this.BudgetAccount=0,this.CurrentBudegetSlotIndex=-1,this.CurrentBudegetMonthSlotIndex=-1,this.budgetInput=[],this.budgetTable=[],this.dbl=0,this.budgetUsedInp=0,this.lstDimensions=[],this.strTransLog=null,this.IsAccountTypeWise=!1,this.SelectedAccountTypes=null,this.Document=t,this.ScreenObject=this.Document.ScreenObject;var r=e.GetDocumentBudgetDefn(a,this.Document.CostCenterID,n);if(null==r||r.Tables.length<3||0==r.Tables[0].length)this.IsEmtyOrNoDefn=!0;else{this.lstDimensions.Clear(),this.budgetTable.Clear(),this.BudgetID=parseInt(r.Tables[0][0].BudgetID),this.nDims=parseInt(r.Tables[0][0].NumDimensions),this.BudgetType=parseInt(r.Tables[0][0].BudgetTypeID),""!=r.Tables[0][0].QtyType.toString()&&(this.QtyType=parseInt(r.Tables[0][0].QtyType.toString())),this.BudgetStartYear=new Date(r.Tables[0][0].StartYear),this.ChkBudgetOnlyForDefnAccounts=Object(l.j)(r.Tables[0][0].ChkBudgetOnlyForDefnAccounts),this.NonAccountingDocs=r.Tables[0][0].NonAccDocs.toString(),this.NonAccountingDocsField=r.Tables[0][0].NonAccDocsField.toString(),this.IsQtyBudget=0,this.dtBdgtTbl=r.Tables[2],this.dtBdgtTblColumns=r.Columns[2],this.dtCommonAccounts=null,s.a.SessionManager.Preferences.BudgetAccount.length>0&&s.a.SessionManager.Preferences.BudgetDimension.length>0&&(this.BudgetAccount=o.e.Int(s.a.SessionManager.Preferences.BudgetAccount),this.BudgetAccount>0&&(this.dtCommonAccounts=r.Tables[3].length>0?r.Tables[3]:null)),this.stPosDim=this.dtBdgtTblColumns.length-this.nDims,this.dtBdgtTblColumns.push("Row ID"),this.dtBdgtTblColumns.push("Amount Used"),this.dtBdgtTblColumns.push("Budget Amount"),this.dtBdgtTblColumns.push("Utilized"),this.dtBdgtTblColumns.push("DocSeqNo"),this.dtBdgtTblColumns.push("LinkedInvDocDetailsID"),this.dtBdgtTblColumns.push("LinkedFieldValue");for(var c=0;c<12;c++)this.dtBdgtTblColumns.push("UM"+c);r.Tables[1].forEach((function(e){i.lstDimensions.push(parseInt(e.CostCenterID))})),this.lstDimensions.Contains(2)||(this.SelectedAccountTypes=""!=r.Tables[0][0].AccountTypes.toString()?r.Tables[0][0].AccountTypes.toString().split(","):null,null!=this.SelectedAccountTypes&&(this.IsAccountTypeWise=!0)),this.SetCurrentBudgetColumn(n,!0,""),this.dtBdgtInp=[],this.dtBdgtInp.push({})}}return _createClass(e,[{key:"SetCurrentBudgetColumn",value:function(e,t,n){var a=this;if(o.e.IsEmpty(n)||e>=this.BudgetStartYear&&e<this.BudgetStartYear.AddMonths(12)){var i="AnnualAmount";if(this.strBudUtilizesColumn="",this.CurrentBudegetSlotIndex=-1,1==this.BudgetType)t&&(this.dtBdgtTblColumns.push("UH0"),this.dtBdgtTblColumns.push("UH1")),e>=this.BudgetStartYear&&e<this.BudgetStartYear.AddMonths(6)?(this.strBudUtilizesColumn="UH0",i="YearH1Amount",this.CurrentBudegetSlotIndex=2):(this.strBudUtilizesColumn="UH1",i="YearH2Amount",this.CurrentBudegetSlotIndex=2);else if(2==this.BudgetType)t&&(this.dtBdgtTblColumns.push("UQ0"),this.dtBdgtTblColumns.push("UQ1"),this.dtBdgtTblColumns.push("UQ2"),this.dtBdgtTblColumns.push("UQ3")),e>=this.BudgetStartYear&&e<this.BudgetStartYear.AddMonths(3)?(this.strBudUtilizesColumn="UQ0",i="Qtr1Amount",this.CurrentBudegetSlotIndex=1):e>=this.BudgetStartYear.AddMonths(3)&&e<this.BudgetStartYear.AddMonths(6)?(this.strBudUtilizesColumn="UQ1",i="Qtr2Amount",this.CurrentBudegetSlotIndex=2):e>=this.BudgetStartYear.AddMonths(6)&&e<this.BudgetStartYear.AddMonths(9)?(this.strBudUtilizesColumn="UQ2",i="Qtr3Amount",this.CurrentBudegetSlotIndex=3):(this.strBudUtilizesColumn="UQ3",i="Qtr4Amount",this.CurrentBudegetSlotIndex=4);else if(3==this.BudgetType)for(var r=this.BudgetStartYear,s=1;s<=12;s++){if(e>=r&&e<r.AddMonths(1)){this.strBudUtilizesColumn="UM"+(s-1),i="Month"+s+"Amount",this.CurrentBudegetSlotIndex=s;break}r=r.AddMonths(1)}for(var c=this.BudgetStartYear,l=1;l<=12;l++){if(e>=c&&e<c.AddMonths(1)){this.CurrentBudegetMonthSlotIndex=l;break}c=c.AddMonths(1)}for(var u=function(e){var n=a.dtBdgtTbl[e];if(n["Row ID"]=n.RowID,n["Amount Used"]=0,n["Budget Amount"]=n[i],"M"==n.CF.toString()){a.dbl=0;for(var r=1;r<=a.CurrentBudegetMonthSlotIndex;r++)a.dbl+=parseFloat(n["Month"+r+"Amount"]);n["Budget Amount"]=a.dbl}if(t)a.ValidateBudgetRow(n);else{var s=a.myBudget.currBudgetTable.find((function(e){return e.dr==n}));s&&(s.amount=parseFloat(n["Budget Amount"]),s.totalAmount=parseFloat(n.AnnualAmount))}if(!o.e.IsEmpty(a.Document.DisplayMessage))return{v:void 0}},d=0;d<this.dtBdgtTbl.length;d++){var D=u(d);if("object"==typeof D)return D.v}}else this.IsEmtyOrNoDefn=!0}},{key:"ValidateBudgetRow",value:function(e){var t=new et.c(0,"");t.amount=parseFloat(e["Budget Amount"]),t.totalAmount=parseFloat(e.AnnualAmount),t.CF=e.CF.toString();for(var n=0;n<this.nDims;n++)t.addDimValue(o.e.String(e[this.dtBdgtTblColumns[this.stPosDim+n]]));this.inpRow=t,this.budgetInput.Clear(),this.budgetInput.push(this.inpRow);var a={errMsg:""};this.myBudget=new et.a(this.budgetTable,this.nDims);var i=[],r=this.myBudget.checkAddBudgetConflicts(this.inpRow,i,a);if(0!=r)return this.Document.DisplayMessage=a.errMsg,this.inpRow.linkedDimRows="",void(this.inpRow.tempLinkedDimRows=0);var s=this.budgetTable.length+1;if(0==(r=this.myBudget.updateDimsRowsWithNewRowId(this.inpRow,i,s))){var c={strTransLog:this.strTransLog};this.myBudget.getTransactionLogSummary(i,c),this.strTransLog=c.strTransLog;var l=new et.c;l.DimensionRow_1(this.inpRow),l.dr=e,l.rowID=s,this.budgetTable.push(l)}}},{key:"CheckBudgetRow",value:function(){var e=this,t=new et.c(0,"");try{if(null!=this.dtCommonAccounts&&this.dtBdgtTblColumns.Contains("D2")&&null!=this.dtBdgtInp[0]["D"+s.a.SessionManager.Preferences.BudgetDimension]&&this.dtCommonAccounts.filter((function(t){return t.AccountID==e.dtBdgtInp[0].D2.toString()&&t.DimID==e.dtBdgtInp[0]["D"+s.a.SessionManager.Preferences.BudgetDimension]})).length>0&&(this.dtBdgtInp[0].D2=this.BudgetAccount),this.Document.DisplayMessage="",this.ChkBudgetOnlyForDefnAccounts&&this.dtBdgtTblColumns.Contains("D2")&&0==this.dtBdgtTbl.filter((function(t){return t.D2==e.dtBdgtInp[0].D2.toString()})).length)return;var n=this.dtBdgtInp[0];this.budgetUsedInp=o.e.Double(n["Amount Used"]),t.docSeqNo=o.e.Int(n.DocSeqNo),t.amount=0;for(var a=0;a<this.nDims;a++)t.addDimValue(n[this.dtBdgtTblColumns[this.stPosDim+a]].toString());this.inpRow=t,this.inpRow.budgetUsed=this.budgetUsedInp,this.budgetInput.Clear(),this.budgetInput.push(this.inpRow);var i={errMsg:"",errMsgCmplt:""};this.myBudget=new et.a(this.budgetTable,this.nDims),null!=this.budgetTable&&this.budgetTable.forEach((function(t){t.docSeqNo=e.inpRow.docSeqNo}));var r=[],c=this.myBudget.checkBudgetTransUsage(this.inpRow,r,i);if(0==c){for(var l=0;l<r.length;l++){var u=r[l];u.childRowId>0&&this.getBudgetUsed(u.childRowId),u.parentRowId>0&&this.getBudgetUsed(u.parentRowId)}if(this.Document.AppDisplayMessage="",i.errMsgCmplt="",0==(c=this.myBudget.checkTransValidity(this.IsQtyBudget,this.BudgetType,this.inpRow,r,i)))for(var d=0;d<r.length;d++){var D=r[d];if(D.relation==et.b.Self||D.relation==et.b.Child){this.getDimensionRow(D.parentRowId,null),null.budgetUsed+=this.budgetUsedInp}}else this.Document.DisplayMessage=i.errMsg,this.Document.AppDisplayMessage=i.errMsgCmplt}else this.Document.DisplayMessage=i.errMsg}catch(h){this.Document.DisplayMessage="Error @ Check Budget",console.log(h)}}},{key:"getBudgetUsed",value:function(t){for(var n=this,a=0,i=0,r=0;r<this.budgetTable.length;r++){var s=this.budgetTable[r];if(s.rowID==t){if(!s.dbCalled){var c=this.dtBdgtInp[0],l="",u=0;i=o.e.Int(c.LinkedInvDocDetailsID),a=o.e.Double(c.LinkedFieldValue),l="<XML>";for(var d=0;d<this.lstDimensions.length;d++)s.row[d].toString().length>0&&parseInt(s.row[d])>1&&(l+='<Row CCID="'+this.lstDimensions[d]+'" NodeID="'+s.row[d].toString()+'"/>');l+="</XML>";var D=e.GetDocsUsedBudget(this.BudgetID,this.Document.DocID,this.Document.CostCenterID,this.IsQtyBudget,this.QtyType,this.BudgetStartYear,l,i,a);null!=D&&D.Tables.length>0&&function(){var e=void 0,t=D.Tables[0],a=!1,i=0,r=new Date(n.BudgetStartYear.getFullYear(),n.BudgetStartYear.getMonth(),1);if(D.Tables[0].forEach((function(t){e=new Date(parseInt(t.YYYY),parseInt(t.MM),1),t.Month=e})),D.Tables[0].length>0&&(u=parseFloat(D.Tables[0].Compute("sum","Balance"))),1==n.BudgetType)r=r.AddMonths(6),c.UH0=n.GetDocsTotal(t.filter((function(e){return e.Month<r.ToString("dd MMM yyyy")}))),c.UH1=n.GetDocsTotal(t.filter((function(e){return e.Month>=r.ToString("dd MMM yyyy")})));else if(2==n.BudgetType)r=r.AddMonths(3),c.UQ0=n.GetDocsTotal(t.filter((function(e){return e.Month<r.ToString("dd MMM yyyy")}))),c.UQ1=n.GetDocsTotal(t.filter((function(e){return e.Month>=r.ToString("dd MMM yyyy")&&e.Month<r.AddMonths(3).ToString("dd MMM yyyy")}))),r=r.AddMonths(3),c.UQ2=n.GetDocsTotal(t.filter((function(e){return e.Month>=r.ToString("dd MMM yyyy")&&e.Month<r.AddMonths(3).ToString("dd MMM yyyy")}))),c.UQ3=n.GetDocsTotal(t.filter((function(e){return e.Month>=r.AddMonths(3).ToString("dd MMM yyyy")})));else if(3==n.BudgetType)for(var l=0;l<12;l++)c["UM"+l]=n.GetDocsTotal(t.filter((function(e){return e.Month>=r.ToString("dd MMM yyyy")&&e.Month<r.AddMonths(1).ToString("dd MMM yyyy")}))),r=r.AddMonths(1);"M"==s.CF&&function(){for(var e=new Date(n.BudgetStartYear.getFullYear(),n.BudgetStartYear.getMonth(),1),r=0;r<12;r++)3!=n.BudgetType&&(c["UM"+r]=n.GetDocsTotal(t.filter((function(t){return t.Month>=e.ToString("dd MMM yyyy")&&t.Month<e.AddMonths(1).ToString("dd MMM yyyy")}))),e=e.AddMonths(1)),"M"==s.CF&&(a=!0,c["UM"+r]&&(i+=parseFloat(c["UM"+r])))}(),s.budgetUsed=a?i:n.strBudUtilizesColumn.length>0?o.e.Double(c[n.strBudUtilizesColumn]):u,s.dbCalled=!0}()}return s.budgetUsed}}return-1}},{key:"ClearInput",value:function(){for(var e=this.dtBdgtTblColumns.length-this.nDims;e<this.dtBdgtTblColumns.length;e++)this.dtBdgtInp[0][this.dtBdgtTblColumns[e]]=null}},{key:"UpdateLinkedDimensions",value:function(e){for(var t=0;t<this.budgetTable.length;t++){var n=this.budgetTable[t];0!=n.tempLinkedDimRows&&(""!=n.linkedDimRows?n.linkedDimRows+="; "+e.toString():n.linkedDimRows=e.toString(),n.tempLinkedDimRows=0)}}},{key:"getDimensionRow",value:function(e,t){for(var n=0;n<this.budgetTable.length;n++)if(this.budgetTable[n].rowID==e)return 0;return 1}},{key:"GetDocsTotal",value:function(e){var t=0;return e.forEach((function(e){t+=parseFloat(e.Balance)})),t}}],[{key:"GetDocumentBudgetDefn",value:function(e,t,n){var a=[];return a.push(e),a.push(t),a.push(n),a.push(s.a.SessionManager.UserID),a.push(s.a.SessionManager.LanguageID),s.a.document.GetDocumentBudgetDefn(a)}},{key:"GetDocsUsedBudget",value:function(e,t,n,a,i,r,o,c,l){var u=[];return u.push(e),u.push(t),u.push(a),u.push(i),u.push(n),u.push(r),u.push(o),u.push(c),u.push(l),u.push(s.a.SessionManager.UserID),u.push(s.a.SessionManager.LanguageID),s.a.document.GetDocsUsedBudget(u)}}]),e}(),at=n("hAwP"),it=n("wnwj"),rt=n("7i9q"),st=n("y4Z9"),ot=n("zUnb"),ct=n("0K4e"),lt=n("3L/X"),ut=n("/GLD"),dt=n("MRsC"),Dt=n("KNVA"),ht=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var a;return _classCallCheck(this,n),(a=t.call(this)).FilterVisible=!0,a.AutoPopulateVisible=!0,a.DefaultVisible=!0,a.CustomizeVisible=!0,a.ClubProducts=!0,a.VendorWise=!0,a.SelectAll=!1,a.SelectAllCtrl=null,a._All=!1,a._ProductVendors=!1,a.SelectedValueChanged=!1,a._selectedvalue=0,a.SelectedNode=0,a.GridReadonly=!1,a.drpDocuments=new m.e(0),a.VendorAccountTypes=null,a.GridDataEnquiriesObj=new V.a,a.ProductList=new m.b,a.SNO=1,a.WorkFlowID=0,a.ProductList.Height=145,a.oparent=e,a.GridDataEnquiriesObj.CellEditEnding.Subscribe(_assertThisInitialized(a),"OnCellEditEnding"),a.SelectAllCtrl=new b.a(0),a.SelectAllCtrl.CheckedChangedCommand.Subscribe(_assertThisInitialized(a),"onCheckChange"),a.SelectAllCtrl.DBColumnName="Select",a.SelectAllCtrl.Label=s.a.GetResource("Selectall"),a.Title=a.DisplayName=s.a.GetResource("Doc_AccMEnquiries"),a.VendorAccountTypes=new C.b(0),a.VendorAccountTypes.CCID=2,a.VendorAccountTypes.TypeID=""!=a.oparent.ScreenObject.Preferences.VendorListView.toString()?parseInt(a.oparent.ScreenObject.Preferences.VendorListView.toString()):1,a.drpDocuments.Label=s.a.GetResource("CRMOpportunity_Documents"),a.VendorAccountTypes.Label=s.a.GetResource("Inv_Vendor"),a.ProductList.Label=s.a.GetResource("CRMOpportunity_Products"),a.DefaultData(),a.GenerateColumns(),a.GridDataEnquiriesObj.TableNewRow.Subscribe(_assertThisInitialized(a),"onAddRow"),a.GridDataEnquiriesObj.RowDeleted.Subscribe(_assertThisInitialized(a),"onDeleteRow"),a.LoadDefault(),o.e.IsEmpty(a.drpDocuments.SelectedValue)&&1==a.drpDocuments.Items.length&&(a.drpDocuments.SelectedValue=a.drpDocuments.Items[0].Value),"1"!=s.a.SessionManager.RoleID&&(a.CustomizeVisible=!1),a.GridReadonly=s.a.SessionManager.IsActionAssigned(43,"bulk enquiries grid Read only"),a}return _createClass(n,[{key:"LoadDefault",value:function(){var e=this,t=s.a.SessionManager.Preferences.EnquieriesLayout;if(null!=t&&""!=t){var n=new o.f;n.LoadXml(t),n.SelectNodes("XML/Row").forEach((function(t){null!=e.drpDocuments.Items.find((function(e){return e.Value==t.attributes.drpDocuments.value}))?e.drpDocuments.SelectedValue=t.attributes.drpDocuments.value.toString():e.drpDocuments.Items.length>0&&(e.drpDocuments.SelectedValue=e.drpDocuments.Items[0].Value),e.VendorAccountTypes.SelectedValue=parseInt(t.attributes.VendorAccountTypes.value),e.All=Object(l.j)(t.attributes.All.value),e.ProductVendors=Object(l.j)(t.attributes.ProductVendors.value),e.ClubProducts=Object(l.j)(t.attributes.ClubProducts.value),e.VendorWise=Object(l.j)(t.attributes.VendorWise.value)}))}}},{key:"OnCellEditEnding",value:function(e){if("DataGridComboBoxColumn"!=e.column.className){var t=e.item;"Qty"==e.column.field&&o.e.IsNum(t.Qty)&&o.e.IsNum(t.UnitPrice)&&(t.Value=parseFloat(t.Qty)*parseFloat(t.UnitPrice))}}},{key:"OnCmnItem_Click",value:function(e){switch(e){case"DELETE":confirm(s.a.GetResource("DeleteMessage"))&&this.OnDeleteCallBack()}}},{key:"DefaultData",value:function(){var e=this,t=null;this.oparent.ScreenObject.Preferences.ContainsKey("DefaultEnquiry")&&""!=this.oparent.ScreenObject.Preferences.DefaultEnquiry.toString()&&(t=this.oparent.ScreenObject.Preferences.DefaultEnquiry.toString().split(",")),null!=this.oparent.ScreenObject.Data&&this.oparent.ScreenObject.Data.Tables.length>13&&this.oparent.ScreenObject.Data.Tables[13].length>0&&function(){for(var n,a,i=0;i<e.oparent.ScreenObject.Data.Tables[13].length;i++)n=o.e.String(e.oparent.ScreenObject.Data.Tables[13][i][e.oparent.ScreenObject.Data.Columns[13][0]]),a=o.e.String(e.oparent.ScreenObject.Data.Tables[13][i][e.oparent.ScreenObject.Data.Columns[13][1]]),(!t||t.Contains(n)||t.Contains("-"+n))&&s.a.SessionManager.RoleActions.length>0&&s.a.SessionManager.RoleActions.filter((function(e){return 1==e.FeatureActionTypeID&&e.FeatureID==parseInt(n)})).length>0&&e.drpDocuments.Items.push(m.d.ComboBoxItems_2(a,n))}(),this.drpDocuments.Items.length>0&&o.e.IsEmpty(this.drpDocuments.SelectedValue)&&(this.drpDocuments.SelectedValue=this.drpDocuments.Items[0].Value,this.drpDocuments.SelectedItem=this.drpDocuments.Items[0])}},{key:"onAddRow",value:function(e){this.UpdateSequence(),e.DocSeqNo=this.SNO}},{key:"onDeleteRow",value:function(e){this.UpdateSequence()}},{key:"UpdateSequence",value:function(){var e=this;this.SNO=1,this.GridDataEnquiries.forEach((function(t){t.DocSeqNo=e.SNO++,e.GridDataEnquiriesObj.updateRow(t)}))}},{key:"GenerateColumns",value:function(){var e=this,t=this.oparent.ScreenObject.ColumnSource.find((function(e){return!o.e.IsEmpty(e.DisplayMember)&&"EnqSel"==e.DisplayMember}));if(null!=t)t.IsVisible=!0;else{var n=new f.a;n.Header=s.a.GetResource("Select"),n.DataType="CheckBox",n.DisplayMember="EnqSel",n.ReadOnly=!1,n.Width=50,n.DisableTab=!0,n.ID="0",this.oparent.ScreenObject.ColumnSource.Insert(1,n),this.oparent.ScreenObject.GridDataColumns.push("EnqSel")}this.linkGrid=new V.a,this.linkGrid.Columns=this.oparent.ScreenObject.ColumnSource,this.linkGrid.Table=this.oparent.ScreenObject.GridData,this.linkGrid.Height=175,this.linkGrid.SelectAll.Visible=!0,this.linkGrid.Width="830",this.linkGrid.SelectAll.DBColumnName="EnqSel",this.linkGrid.SelectAll.IsChecked=!1;for(var a=0;a<this.linkGrid.Table.length;a++)this.linkGrid.Table[a].EnqSel=!1;var i=[];if(i.push(m.c.CheckedListBoxItem_6("#","DocSeqNo",!0,25)),i.push(m.c.CheckedListBoxItem_6(s.a.GetResource("ProductCode"),"ProductCode",!0,100)),i.push(m.c.CheckedListBoxItem_6(s.a.GetResource("ProductName"),"ProductName",!0,100)),i.push(m.c.CheckedListBoxItem_6(s.a.GetResource("Vendor"),"Vendor",!0,150)),i.push(m.c.CheckedListBoxItem_6(s.a.GetResource("Qty"),"Qty",!0,100)),i.push(m.c.CheckedListBoxItem_6(s.a.GetResource("Units"),"Units",!0,100)),i.push(m.c.CheckedListBoxItem_6(s.a.GetResource("UnitPrice"),"UnitPrice",!0,80)),i.push(m.c.CheckedListBoxItem_6(s.a.GetResource("Value"),"Value",!0,150)),i.push(m.c.CheckedListBoxItem_6(s.a.GetResource("Remarks"),"Remarks",!0,100)),s.a.SessionManager.Preferences.ContainsKey("EnquiriesCustomize")&&""!=s.a.SessionManager.Preferences.EnquiriesCustomize){var r,c=new o.f;c.LoadXml(s.a.SessionManager.Preferences.EnquiriesCustomize),this.FilterVisible=!1,this.AutoPopulateVisible=!1,this.DefaultVisible=!1;for(var l=[],u=function(t){var n=c.DocumentElement.children[t],a=i.find((function(e){return e.Value==n.attributes.ID.value}));a?((r=new f.a).Header=a.Name,r.DisplayMember=a.Value,r.DisplayIndex=parseInt(n.attributes.index.value),r.Width=parseInt(n.attributes.WIDTH.value),e.SetAlignMent(r),l.push(r)):"Filter"==n.attributes.ID.value?e.FilterVisible=!0:"AutoPopulate"==n.attributes.ID.value?e.AutoPopulateVisible=!0:"Default"==n.attributes.ID.value?e.DefaultVisible=!0:(D=e.oparent.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember.toLowerCase()==n.attributes.ID.value})))&&((r=new f.a).Header=D.Header,r.DisplayMember=D.DisplayMember,r.DisplayIndex=parseInt(n.attributes.index.value),r.Width=parseInt(n.attributes.WIDTH.value),r.Expression=n.attributes.ID.value,r.ReadOnly=!0,e.SetAlignMent(r),l.push(r),e.GridDataEnquiriesObj.TableColumns.push(D.DisplayMember))},d=0;d<c.DocumentElement.children.length;d++){var D;u(d)}l.sort((function(e,t){return e.DisplayIndex-t.DisplayIndex})),l.forEach((function(t){e.ColumnSource.push(t)}))}else i.forEach((function(t){var n=new f.a;n.Header=t.Name,n.DisplayMember=t.Value,n.Width=t.Type,e.SetAlignMent(n),e.ColumnSource.push(n)}));this.GridDataEnquiriesObj.TableColumns.push("DocSeqNo"),this.GridDataEnquiriesObj.TableColumns.push("ProductCode"),this.GridDataEnquiriesObj.TableColumns.push("ProductID"),this.GridDataEnquiriesObj.TableColumns.push("ProductName"),this.GridDataEnquiriesObj.TableColumns.push("Vendor"),this.GridDataEnquiriesObj.TableColumns.push("VendorID"),this.GridDataEnquiriesObj.TableColumns.push("Qty"),this.GridDataEnquiriesObj.TableColumns.push("Units"),this.GridDataEnquiriesObj.TableColumns.push("Unit_Key"),this.GridDataEnquiriesObj.TableColumns.push("UomConversion"),this.GridDataEnquiriesObj.TableColumns.push("UnitPrice"),this.GridDataEnquiriesObj.TableColumns.push("Value"),this.GridDataEnquiriesObj.TableColumns.push("Remarks"),this.GridDataEnquiriesObj.TableColumns.push("DocDetailsID"),Logger.InfoLog("EnquiriesViewModel::Exiting GenerateColumns")}},{key:"SetAlignMent",value:function(e){("Qty"==e.DisplayMember||"Value"==e.DisplayMember||"UnitPrice"==e.DisplayMember||"Quantity"==e.DisplayMember||e.DisplayMember.toLowerCase().Contains("dcnum")||e.DisplayMember.toLowerCase().Contains("dccalcnum"))&&(e.TextAlign="Right")}},{key:"SaveInventoryDoc",value:function(){var e=this;try{this.DisplayMessage="";var t=this.GetEnquiriesXML(),n=this.oparent.ScreenObject.CheckInvPosting(t);if(null!=n&&n.Tables.length>0&&n.Tables[0].length>0&&n.Columns[0].Contains("ErrorMessage")){if(this.oparent.ScreenObject.Preferences.ContainsKey("DonotAllowDuplicateVendorforEnquiry")&&Object(l.j)(this.oparent.ScreenObject.Preferences.DonotAllowDuplicateVendorforEnquiry))return void(this.DisplayMessage="Enquiries Already exists for."+o.e.String(n.Tables[0][0].ErrorMessage));if(!confirm("Enquiries Already exists for."+o.e.String(n.Tables[0][0].ErrorMessage)+"\n Do you want to continue?"))return}this.oparent.ScreenObject.PostInventoryDocument(t,"","","",this.oparent.DocumentDate,this.WorkFlowID,this.drpDocuments.SelectedValue.toString()).subscribe((function(t){t.RetVal>0?(e.DisplayMessage=" Enquiries Posted Successfully",e.MessageVisibility=!0,e.GridDataEnquiriesObj.Clear()):(e.DisplayMessage=t.Message,e.MessageVisibility=!0)}),(function(e){console.log(e)}))}catch(a){Logger.ErrorLog("EnquiriesViewModel:: EnquiriesViewModel"+a.stack)}}},{key:"GetEnquiriesXML",value:function(){var e=this;this.WorkFlowID=0;var t=this.oparent.ScreenObject.GetLinkDefDetails(parseInt(this.drpDocuments.SelectedValue),this.oparent.CostCenterID),n="",a="",i="",r="",s="",c=0;null!=t&&t.Tables.length>1&&t.Tables[1].length>0&&t.Columns[1].Contains("WorkFlowID")&&!o.e.IsEmpty(t.Tables[1][0].WorkFlowID)&&(this.WorkFlowID=parseInt(t.Tables[1][0].WorkFlowID));var u,d=this.oparent.ScreenObject.Data.Tables[7].filter((function(e){return e.PrefName="LinkPrifixDimensions"}));d.length>0&&!o.e.IsEmpty(d[0].PrefValue)&&Object(l.j)(d[0].PrefValue)&&(u=e.oparent.ScreenObject.Data.Tables[8].filter((function(e){return e.CCID>=50001&&e.CCID<=50050}))).length>0&&function(){for(var n,a=function(a){if((n=e.oparent.ScreenObject.Data.Tables[0].filter((function(e){return e.ColumnCostCenterID==u[a].CCID}))).length>0&&!(t.Tables[0].filter((function(e){return e.BASECOL==n[0].SysColumnName})).length>0)){var i={};i.BASECOL=n[0].SysColumnName,i.LINKCOL=n[0].SysColumnName,i.VIEW="False",i.CostCenterColIDLinked=n[0].CostCenterColID,t.Tables[0].push(i)}},i=0;i<u.length;i++)a(i)}(),this.lstVendorIDs=[];var D=!1,S=[];S.push("productid"),S.push("uomconversion"),S.push("rate"),S.push("quantity"),S.push("gross"),S.push("exchangerate"),S.push("creditaccount"),S.push("unit"),S.push("refno"),n+="<Enquiries>";for(var m=function(l){if(i="",r="",s="",!o.e.IsEmpty(e.GridDataEnquiries[l].ProductID)&&!o.e.IsEmpty(e.GridDataEnquiries[l].VendorID)){if(c=parseInt(e.oparent.ScreenObject.GridData.filter((function(t){return t.DocDetailsID==e.GridDataEnquiries[l].DocDetailsID}))[0].DocSeqNo)-1,e.lstVendorIDs.Contains(parseInt(e.GridDataEnquiries[l].VendorID))||Object(j.isNullOrUndefined)(e.GridDataEnquiries[l].VendorID)||(e.lstVendorIDs.length>0&&(n+="</DocumentXML></ROWS>"),e.lstVendorIDs.push(parseInt(e.GridDataEnquiries[l].VendorID)),n+="<ROWS><DocumentXML>"),n+="<RowHead/><Row><Transactions  ",n+='DocDetailsID="0"  DocSeqNo="1" IsQtyIgnored="1" ProductID="'+o.e.String(e.GridDataEnquiries[l].ProductID)+'" Unit="'+e.GridDataEnquiries[l].Unit_Key.toString()+'" ',null!=t&&t.Tables.length>0&&t.Tables[0].length>0){for(var u=function(u){if(!S.Contains(o.e.String(t.Tables[0][u].BASECOL).toLowerCase())){if(a="","debitaccount"==o.e.String(t.Tables[0][u].BASECOL).toLowerCase()){if(e.oparent.ScreenObject.GridDataColumns.Contains(o.e.String(t.Tables[0][u].LINKCOL)+"_Key")?n+='DebitAccount="'+o.e.String(e.oparent.ScreenObject.GridData[c][o.e.String(t.Tables[0][u].LINKCOL)+"_Key"])+'" ':n+=null!=e.oparent.ScreenObject.DebitAccount?'DebitAccount="'+e.oparent.ScreenObject.DebitAccount.SelectedValue.toString()+'" ':'DebitAccount="2" ',t.Tables.length>3&&t.Tables[3].length>0&&(p=t.Tables[3].filter((function(e){return"debitaccount"==e.SysColumnName}))).length>0&&t.Tables[3].filter((function(e){return null!=e.LocalReference&&e.LocalReference==p[0].CostCenterColID})).length>0){var d=e.oparent.ScreenObject.GetLinkRefDataSet(parseInt(p[0].CostCenterColID),parseInt(e.drpDocuments.SelectedValue),parseInt(e.GridDataEnquiries[l].VendorID),e.oparent.DocumentDate,p[0].SysColumnName.toString(),2,null,parseInt(e.GridDataEnquiries[l].VendorID)),m={costcenter:s,Numeric:i,Alpha:r};e.FillLocalref(d,m),m.costcenter=s,m.Numeric=i,m.Alpha=r}return"continue"}if("currencyid"==o.e.String(t.Tables[0][u].BASECOL).toLowerCase())return e.oparent.ScreenObject.GridDataColumns.Contains("CurrencyID_Key")?o.e.IsEmpty(e.oparent.ScreenObject.GridData[c].CurrencyID_Key)||(D=!0,n+='CurrencyID="'+o.e.String(e.oparent.ScreenObject.GridData[c].CurrencyID_Key)+'" ',e.oparent.ScreenObject.GridDataColumns.Contains("ExchangeRate")&&!o.e.IsEmpty(e.oparent.ScreenObject.GridData[c].ExchangeRate)&&(n+='ExchangeRate="'+o.e.String(e.oparent.ScreenObject.GridData[c].ExchangeRate)+'" ')):null!=e.oparent.Currency&&e.oparent.Currency.Currency&&!o.e.IsEmpty(e.oparent.Currency.Currency.SelectedValue)&&(n+='CurrencyID="'+e.oparent.Currency.Currency.SelectedValue+'" ',n+='ExchangeRate="'+e.oparent.Currency.ExchangeRate.Text+'" ',D=!0),"continue";if("voucherno"==o.e.String(t.Tables[0][u].LINKCOL).toLowerCase())a=e.oparent.ScreenObject.VoucherNo;else if(e.oparent.ScreenObject.GridDataColumns.Contains(o.e.String(t.Tables[0][u].LINKCOL))){var b=t.Tables[0][u].LINKCOL+"_Key";a=e.oparent.ScreenObject.GridDataColumns.Contains(b)?e.oparent.ScreenObject.GridDataObj.DataTypes.Date.Contains(b)&&o.e.isValidDate(e.oparent.ScreenObject.GridData[c][b])?o.e.String(new Date(e.oparent.ScreenObject.GridData[c][b])):o.e.String(e.oparent.ScreenObject.GridData[c][b]):o.e.String(e.oparent.ScreenObject.GridData[c][o.e.String(t.Tables[0][u].LINKCOL)])}else(C=e.oparent.ScreenObject.HeaderFields.find((function(e){return e instanceof y.c&&e.DBColumnName&&e.DBColumnName.toLowerCase()==o.e.String(t.Tables[0][u].LINKCOL).toLowerCase()})))||(C=e.oparent.ScreenObject._CCFields.find((function(e){return e instanceof y.c&&e.DBColumnName&&e.DBColumnName.toLowerCase()==o.e.String(t.Tables[0][u].LINKCOL).toLowerCase()}))),C||(C=e.oparent.ScreenObject._TextFields.find((function(e){return e instanceof y.c&&e.DBColumnName&&e.DBColumnName.toLowerCase()==o.e.String(t.Tables[0][u].LINKCOL).toLowerCase()}))),null!=C&&(a=e.GetFldValue(C));if(""!=a){var g=o.e.String(t.Tables[0][u].BASECOL).toLowerCase();g.Contains("dcccnid")||"userid"==g||"customerid"==g||"contactid"==g?s+=o.e.String(t.Tables[0][u].BASECOL)+"="+a+",  ":g.Contains("dcnum")?i+=o.e.String(t.Tables[0][u].BASECOL)+"="+a+",  ":g.Contains("dcalpha")?r+=o.e.String(t.Tables[0][u].BASECOL)+"=N'"+h.d.GetValidTextXml(a)+"',  ":n+=" "+o.e.String(t.Tables[0][u].BASECOL)+'="'+h.d.GetValidTextXml(a)+'" '}}},d=0;d<t.Tables[0].length;d++)u(d);if(D||(n+=' CurrencyID="1" ExchangeRate="1" '),t.Tables.length>2&&t.Tables[2].length>0&&t.Tables[2].filter((function(e){return"ProductID"!=e.SysColumnName})).length>0&&(p=t.Tables[2].filter((function(e){return"ProductID"==e.SysColumnName}))).length>0){var m=e.oparent.ScreenObject.GetLinkRefDataSet(parseInt(p[0].CostCenterColID),parseInt(e.drpDocuments.SelectedValue),parseInt(e.GridDataEnquiries[l].ProductID),e.oparent.DocumentDate,"ProductID",3,null,parseInt(e.GridDataEnquiries[l].VendorID)),b={costcenter:s,Numeric:i,Alpha:r};e.FillLocalref(m,b),b.costcenter=s,b.Numeric=i,b.Alpha=r}if(t.Tables.length>3&&t.Tables[3].length>0&&(p=t.Tables[3].filter((function(e){return"CreditAccount"==e.SysColumnName}))).length>0&&t.Tables[3].filter((function(e){return null!=e.LocalReference&&e.LocalReference==p[0].CostCenterColID})).length>0){var g=e.oparent.ScreenObject.GetLinkRefDataSet(parseInt(p[0].CostCenterColID),parseInt(e.drpDocuments.SelectedValue),parseInt(e.GridDataEnquiries[l].VendorID),e.oparent.DocumentDate,p[0].SysColumnName.toString(),2,null,parseInt(e.GridDataEnquiries[l].VendorID)),f={costcenter:s,Numeric:i,Alpha:r};e.FillLocalref(g,f),f.costcenter=s,f.Numeric=i,f.Alpha=r}n.toString().Contains("DebitAccount=")||(n+=null!=e.oparent.ScreenObject.DebitAccount?'DebitAccount="'+e.oparent.ScreenObject.DebitAccount.SelectedValue.toString()+'" ':'DebitAccount="2" ')}else e.oparent.ScreenObject._CCFields.forEach((function(t){""!=(a=e.GetFldValue(t))&&(s+=t.DBColumnName+"="+a+", ")}));n+=' RefNO="'+e.oparent.ScreenObject.VoucherNo+'" ',n+='LinkedInvDocDetailsID="'+o.e.String(e.GridDataEnquiries[l].DocDetailsID)+'"  LinkedFieldName="Quantity"',n+=' Quantity="'+o.e.String(e.GridDataEnquiries[l].Qty)+'"  Rate="'+o.e.String(e.GridDataEnquiries[l].UnitPrice)+'"  Gross="'+o.e.String(e.GridDataEnquiries[l].Value)+'" CreditAccount ="'+o.e.String(e.GridDataEnquiries[l].VendorID)+'" ',o.e.IsEmpty(e.GridDataEnquiries[l].Qty)||o.e.IsEmpty(e.GridDataEnquiries[l].UomConversion)?n+=' UOMConversion="1" UOMConvertedQty="'+o.e.String(e.GridDataEnquiries[l].Qty)+'" ':n+=' UOMConversion="'+o.e.String(e.GridDataEnquiries[l].UomConversion)+'" UOMConvertedQty="'+parseFloat(e.GridDataEnquiries[l].Qty)*parseFloat(e.GridDataEnquiries[l].UomConversion)+'" ',n+="></Transactions> ",n+=' <Numeric Query="'+i+'" /> <Alpha Query="'+r+'" /> <CostCenters Query="'+s+'" /> <EXTRAXML/>',n+=" </Row>"}},b=0;b<this.GridDataEnquiries.length;b++){var C,p;m(b)}return n+="</DocumentXML></ROWS>",n+="</Enquiries>"}},{key:"FillLocalref",value:function(e,t){if(null!=e&&e.Tables.length>0&&e.Tables[0].length>0)for(var n,a=0;a<e.Columns[0].length;a++)n=e.Columns[0][a],o.e.IsEmpty(e.Tables[0][0][n])||(e.Columns[0][a].toLowerCase().Contains("dcccnid")&&!t.costcenter.Contains(e.Columns[0][a]+"=")&&o.e.IsDigit(e.Columns[0][a][e.Columns[0][a].length-1])?t.costcenter+=e.Columns[0][a]+"="+o.e.String(e.Tables[0][0][n])+",  ":e.Columns[0][a].toLowerCase().Contains("dcnum")&&!t.Numeric.Contains(e.Columns[0][a]+"=")?t.Numeric+=e.Columns[0][a]+"="+o.e.String(e.Tables[0][0][n])+",  ":e.Columns[0][a].toLowerCase().Contains("dcalpha")&&!t.Alpha.Contains(e.Columns[0][a]+"=")&&(t.Alpha+=e.Columns[0][a]+"=N'"+h.d.GetValidTextXml(e.Tables[0][0][n])+"',  "));if(null!=e&&e.Tables.length>2)for(var i,r=2;r<e.Tables.length;r++)i=e.Columns[r][0],!e.Columns[r].Contains("ErrorMessage")&&e.Tables[r].length>0&&e.Columns[r].length>0&&!o.e.IsEmpty(e.Tables[r][0][i])&&(e.Columns[r][0].toLowerCase().Contains("dcccnid")&&!t.costcenter.Contains(e.Columns[r][0]+"=")?t.costcenter+=e.Columns[r][0]+"="+o.e.String(e.Tables[r][0][i])+",  ":e.Columns[r][0].toLowerCase().Contains("dcnum")&&!t.Numeric.Contains(e.Columns[r][0]+"=")?t.Numeric+=e.Columns[r][0]+"="+o.e.String(e.Tables[r][0][i])+",  ":e.Columns[r][0].toLowerCase().Contains("dcalpha")&&!t.Alpha.Contains(e.Columns[r][0]+"=")&&(t.Alpha+=e.Columns[r][0]+"=N'"+h.d.GetValidTextXml(e.Tables[r][0][i])+"',  "))}},{key:"GetFldValue",value:function(e){var t="";if(e instanceof h.d&&(t=e.Text,o.e.IsEmpty(t)&&(t=""),o.e.IsEmpty(e.Tag)||(t=e.Tag)),e instanceof O.a)t=e.Text,o.e.IsEmpty(t)&&(t="");else if(e instanceof h.c)t=e.Text,o.e.IsEmpty(t)&&(t="");else if(e instanceof m.e)t=e.SelectedValue,o.e.IsEmpty(t)&&(t="");else if(e instanceof S.c)e.Date&&(t=e.Date.ToString("dd/MMM/yyyy")),o.e.IsEmpty(t)&&(t="");else if(e instanceof S.b){var n=e;if(n.Date){var a=n.Date;n.ShowTimePicker&&1900!=n.Date.getFullYear()&&(a=(a=(a=(a=new Date(1900,1,1)).AddHours(n.Date.getHours())).AddMinutes(n.Date.getMinutes())).AddSeconds(n.Date.getSeconds())),t=a.ToString("dd/MMM/yyyy hh:mm a")}o.e.IsEmpty(t)&&(t="")}else e instanceof S.a?(t=e.Date.ToString("dd/MMM/yyyy"),o.e.IsEmpty(t)&&(t="")):e instanceof C.b&&e.SelectedValue>0&&(t=e.SelectedValue.toString());return t}},{key:"OnSave",value:function(e){var t=this;if("Cancel"==e)s.a.page.HideDialog();else if("Customize"==e);else if("Save"==e){if(null==this.drpDocuments.SelectedValue||""==this.drpDocuments.SelectedValue)return void(this.DisplayMessage="please select Document");if(0==this.GridDataEnquiries.length)return void(this.DisplayMessage="please select products to generate enquiries");if(this.GridDataEnquiries.length>0&&(null==this.GridDataEnquiries[0].ProductID||null==this.GridDataEnquiries[0].ProductID))return void(this.DisplayMessage="please select atleast one product to generate enquiry");this.SaveInventoryDoc()}else if("SetAsDefault"==e){"&l;XML&gt;","&l;Row ","drpDocuments='"+this.drpDocuments.SelectedValue+"' ","VendorAccountTypes='"+this.VendorAccountTypes.SelectedValue+"' ","All='"+this.All+"' ","ProductVendors='"+this.ProductVendors+"' ","ClubProducts='"+this.ClubProducts+"' ","VendorWise='"+this.VendorWise+"' ","/&g;","&l;/XML&gt;"}else if("Gnenerate"==e){if(null==this.drpDocuments.SelectedValue)return this.DisplayMessage="please select Document",void(this.MessageVisibility=!0);for(var n="",a=0;a<this.linkGrid.Table.length;a++)""!=this.linkGrid.Table[a].EnqSel.toString()&&Object(l.j)(this.linkGrid.Table[a].EnqSel.toString())&&""!=this.linkGrid.Table[a].ProductID_Key.toString()&&(n+=this.linkGrid.Table[a].ProductID_Key.toString()+",");if(""==n)return this.DisplayMessage="please select products",void(this.MessageVisibility=!0);if(0==this.VendorAccountTypes.SelectedValue&&!this.VendorWise)return this.DisplayMessage="please select Vendor account",void(this.MessageVisibility=!0);if(this.oparent.ScreenObject.GridData.length>0){var i=0;if(this.VendorWise){""!=n&&(n=n.Remove(n.length-1,1)),0}else{this.GridDataEnquiries.filter((function(e){return e.Vendor==t.VendorAccountTypes.Text.Replace("'","''")})).forEach((function(e){t.GridDataEnquiriesObj.removeRow(e)})),i=this.GridDataEnquiries.length;for(var r=0,c=0;c<this.linkGrid.Table.length;c++)if(""!=this.linkGrid.Table[c].EnqSel.toString()&&Object(l.j)(this.linkGrid.Table[c].EnqSel.toString())&&""!=this.linkGrid.Table[c].ProductID_Key.toString()){this.GridDataEnquiriesObj.addEmptyRow(),this.GridDataEnquiries[i+r].DocSeqNo=(i+r+1).toString(),this.GridDataEnquiries[i+r].ProductID=this.linkGrid.Table[c].ProductID_Key.toString(),this.GridDataEnquiries[i+r].ProductCode=this.linkGrid.Table[c].ProductCode.toString(),this.GridDataEnquiries[i+r].ProductName=this.linkGrid.Table[c].ProductName.toString(),this.GridDataEnquiries[i+r].DocDetailsID=this.linkGrid.Table[c].DocDetailsID.toString(),this.GridDataEnquiries[i+r].UomConversion=null!=this.linkGrid.Table[c].UomConversion&&""!=this.linkGrid.Table[c].UomConversion.toString()?this.linkGrid.Table[c].UomConversion.toString():1,this.GridDataEnquiries[i+r].Qty=null!=this.linkGrid.Table[c].Quantity&&""!=this.linkGrid.Table[c].Quantity.toString()?parseFloat(this.linkGrid.Table[c].Quantity).ToString("N"+s.a.SessionManager.Preferences.DecimalsinQty.toString()):0,this.GridDataEnquiries[i+r].Units=null!=this.linkGrid.Table[c].Unit&&""!=this.linkGrid.Table[c].Unit.toString()?this.linkGrid.Table[c].Unit.toString():0,this.GridDataEnquiries[i+r].Unit_Key=null!=this.linkGrid.Table[c].Unit_Key&&""!=this.linkGrid.Table[c].Unit_Key.toString()?this.linkGrid.Table[c].Unit_Key.toString():0,this.GridDataEnquiries[i+r].UnitPrice=null!=this.linkGrid.Table[c].Rate&&""!=this.linkGrid.Table[c].Rate.toString()?parseFloat(this.linkGrid.Table[c].Rate).ToString("N"+s.a.SessionManager.Preferences.DecimalsinRate.toString()):0,this.GridDataEnquiries[i+r].Value=null!=this.linkGrid.Table[c].Gross&&""!=this.linkGrid.Table[c].Gross.toString()?parseFloat(this.linkGrid.Table[c].Gross).ToString("N"+s.a.SessionManager.Preferences.DecimalsinRate.toString()):0,this.GridDataEnquiries[i+r].Remarks=this.linkGrid.Table[c].LineNarration.toString(),this.GridDataEnquiries[i+r].Vendor=this.VendorAccountTypes.Text.toString(),this.GridDataEnquiries[i+r].VendorID=this.VendorAccountTypes.SelectedValue.toString();for(var u=0;u<this.ColumnSource.length;u++)!o.e.IsEmpty(this.ColumnSource[u].Expression)&&this.GridDataEnquiriesObj.TableColumns.Contains(this.ColumnSource[u].DisplayMember)&&(this.GridDataEnquiries[i+r][this.ColumnSource[u].DisplayMember]=this.linkGrid.Table[c][this.ColumnSource[u].DisplayMember].toString());r++}}}}}},{key:"OnDeleteCallBack",value:function(){for(var e=0,t=0;t<this.GridDataEnquiries.length&&(e=parseInt(this.GridDataEnquiries[t].DocSeqNo),this.SelectedNode!=e-1||o.e.IsEmpty(this.GridDataEnquiries[t][0]));t++);this.SelectedNode<this.GridDataEnquiries.length&&this.GridDataEnquiries.RemoveAt(this.SelectedNode),this.UpdateSequence()}},{key:"All",get:function(){return this._All},set:function(e){e!=this._All&&(this._All=e,e&&(this.VendorAccountTypes.CustomWhere=""))}},{key:"ProductVendors",get:function(){return this._ProductVendors},set:function(e){if(e!=this._ProductVendors&&(this._ProductVendors=e,e)){for(var t="",n=0;n<this.linkGrid.Table.length;n++)""!=this.linkGrid.Table[n].EnqSel.toString()&&Object(l.j)(this.linkGrid.Table[n].EnqSel.toString())&&""!=this.linkGrid.Table[n].ProductID_Key.toString()&&(t+=this.linkGrid.Table[n].ProductID_Key.toString()+",");""!=t?(t=t.Remove(t.length-1,1),this.VendorAccountTypes.CustomWhere=" a.AccountID in (select IPV.AccountID from INV_ProductVendors IPV WITH(NOLOCK) where IPV.ProductID in ("+t+") ) "):this.VendorAccountTypes.CustomWhere=""}}},{key:"SelectedValue",get:function(){return this._selectedvalue},set:function(e){this._selectedvalue!=e&&(this._selectedvalue=e,this.SelectedValueChanged=!this.SelectedValueChanged)}},{key:"ColumnSource",get:function(){return this.GridDataEnquiriesObj.Columns}},{key:"GridDataEnquiries",get:function(){return this.GridDataEnquiriesObj.Table}}]),n}(u.b),St=n("R1nY"),mt=n("7eIC"),bt=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this)).ParentTexbox=null,e.BindingPath=null,e.DocID=0,e.lstList=new C.b,e.Query="",e.Title=s.a.GetResource("SelectDocument"),e}return _createClass(n,[{key:"PreviousTextDialog_1",value:function(e,t,n,a,i,r){this.IsInventoryVoucher=t,this.CCID=e,this.Query="",this.lstList.CCID=e,this.lstList.TypeID=t?2:1,e>0&&(this.Query="a.CostCenterID="+e),o.e.IsEmpty(r)||(this.Query+=" and  a.VoucherNO  like '"+r+"-%'"),(n>0||a>0||i>5e4)&&(n>0&&(this.Query+=" and dcCCNID2="+n.toString()),a>0&&(this.Query+=" and dcCCNID1="+a.toString())),s.a.SessionManager.IsActionAssigned(43,"User-Wise Documents")&&(this.Query+=" and a.CreatedBy in (select username from ADM_Users WITH(NOLOCK)  where UserID="+s.a.SessionManager.UserID+" or  UserID in (select NodeID from COM_CostCenterCostCenterMap  WITH(NOLOCK)  ",this.Query+=" where parentcostcenterid=7 and parentnodeid="+s.a.SessionManager.UserID+"  and costcenterid=7))"),this.lstList.CustomWhere=this.Query,this.Query="",this.Query="select distinct top {1} DOCID,VoucherNO",this.Query+=t?" from INV_DocDetails a WITH(NOLOCK) ":" from ACC_DocDetails a WITH(NOLOCK) ",(n>0||a>0||i>5e4)&&(this.Query+=" join COM_DocCCData D WITH(NOLOCK) on ",this.Query+=t?" a.INVDocDetailsID=D.INVDocDetailsID ":" a.AccDocDetailsID=D.ACCDocDetailsID ",n>0&&(this.Query+=" and dcCCNID2="+n.toString()),a>0&&(this.Query+=" and dcCCNID1="+a.toString()),i>5e4&&(this.Query+=" JOIN  COM_CostCenterCostCenterMap CCM WITH(NOLOCK) ON  D.DcccNID"+(i-5e4).toString()+" =CCM.NodeID and parentcostcenterid=7 ",this.Query+=" and parentnodeid="+s.a.SessionManager.UserID+" and CCM.costcenterid="+i.toString())),this.Query+=" where ",this.Query+=e>0?" a.CostCenterID="+e.toString():" 1=1",s.a.SessionManager.IsActionAssigned(43,"User-Wise Documents")&&(this.Query+=" and a.CreatedBy in (select username from ADM_Users WITH(NOLOCK)  where UserID="+s.a.SessionManager.UserID+" or  UserID in (select NodeID from COM_CostCenterCostCenterMap  WITH(NOLOCK)  ",this.Query+=" where parentcostcenterid=7 and parentnodeid="+s.a.SessionManager.UserID+"  and costcenterid=7))"),o.e.IsEmpty(r)||(this.Query+=" and  VoucherNO  like '"+r+"-%'"),this.Query+=" and  VoucherNO {0} order by VoucherNO"}},{key:"btCancel_Click",value:function(){s.a.page.HideDialog()}},{key:"btOk_Click",value:function(){this.DocID=this.lstList.SelectedValue,s.a.page.HideDialog()}}]),n}(u.b),Ct=n("0h5z"),yt=n("0/dd"),pt=n("oiZC"),gt=n("d36O"),ft=n("/G+I"),Ot=n("SEJ9"),It=n("fPnf"),Tt=n("vSGu"),jt=n("ddhY"),Pt=n("kTcn"),At=function(){function e(t,n,a){var i=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;_classCallCheck(this,e),this.CheckedChanged=new y.b,this.ButtonClick=new y.b,this.IsDashboard=!1,this.IsDashboardDefault=!1,this.ListBoxVisible=!0,this.PrintLayouts=new m.e(0),this.ActionType=new m.e(0),this.Application=new m.e(0),this.SelectedApplication=new m.b(0),this.Groups=new m.b,this.Roles=new m.b,this.Users=new m.b,this.Location=new m.b,this.SelectedItem=null,this.IsLocationWise=!1,this.IsAssignVPTFromDocument=!1,this.CallType=0,this.LoadedAction=null,this.LoadedNodeID=0,this.LockCheckedChanged=!1,this.Parent=a,this.REPORTID=t,this.CallType=r,this.ReportName=n,this.ButtonClick.Subscribe(this,"OnButtonClick"),this.Application.SelectionChangedCommand.Subscribe(this,"OnApplicationChange"),this.Application.LblClick=new y.b,this.Application.LblClick.Subscribe(this,"OnButtonClick","ShowAssignGrid"),this.ActionType.SelectionChangedCommand.Subscribe(this,"OnActionChange"),this.SelectedApplication.CheckedChangedCommand.Subscribe(this,"OnCheckedChanged"),"AssignVPTFromDocument"==n?(this.IsAssignVPTFromDocument=!0,this.PrintLayouts.Visible=!0):this.PrintLayouts.Visible=!1,this.SelectedApplication.Visible=!0,this.ActionType.Visible=!1,this.ActionType.Label=s.a.GetResource("Format_Action"),"AddEditRevenUReportViewModel"==a.ClassName?(this.SelectLabel=s.a.GetResource("RevenUReport_Selected"),this.ActionType.Visible=!0,this.ActionType.Items.push(m.d.ComboBoxItems_2("All","0")),this.ActionType.Items.push(m.d.ComboBoxItems_2(s.a.GetResource("Rentals_UnitsView"),"1")),this.ActionType.Items.push(m.d.ComboBoxItems_2(s.a.GetResource("Print"),"2")),this.ActionType.Items.push(m.d.ComboBoxItems_2(s.a.GetResource("lbl_Export"),"3")),this.ActionType.Items.push(m.d.ComboBoxItems_2(s.a.GetResource("SMTP_Email"),"4")),this.ActionType.Items.push(m.d.ComboBoxItems_2(s.a.GetResource("SMTP_SMS"),"5"))):this.SelectLabel=s.a.GetResource("FavoritesViewModel"==a.ClassName?"Selected_Favorites":"ListOfDashBoards"==a.ClassName?"Selected_DashBoard":"View_Selected"),1!=r&&(this.Application.Items.push(m.d.ComboBoxItems_2(s.a.GetResource("DocumentDesigner_Groups"),"1")),this.Application.Items.push(m.d.ComboBoxItems_2(s.a.GetResource("DocumentDesigner_Roles"),"2"))),this.Application.Items.push(m.d.ComboBoxItems_2(s.a.GetResource("DocumentDesigner_Users"),"3")),this.Application.SelectedValue=1!=r?"2":"3",this.Application.Label=s.a.GetResource("Notif_Application"),this.Groups.Items.Clear(),this.Roles.Items.Clear(),this.Users.Items.Clear(),"True"==s.a.SessionManager.Preferences.EnableLocationWise.toString()&&(this.IsLocationWise=!0);var o=null;if("ListOfDashBoards"==a.ClassName)o=s.a.admin.GetDashBoardRoles(parseInt(a.SelectedNode.Id)),this.LoadEditData(o);else if(a instanceof Tt.FavoritesViewModel)o=s.a.admin.GetAssign(69,t),this.LoadEditData(o),this.Application.SelectedValue="3";else if("AddEditDocumentViewModel"==a.ClassName)if(1==this.CallType)o=s.a.admin.GetAssign(a.CostCenterID,a.DocID),this.LoadEditData(o);else if(this.IsAssignVPTFromDocument){this.IsLocationWise&&this.Application.Items.push(m.d.ComboBoxItems_2(s.a.GetResource("Location"),"50002"));var c=this.GetLocationPrintLayouts(this.Parent.CostCenterID,0,0);c.Tables[0]=c.Tables[0].sort((function(e,t){return e.Name-t.Name})),c.Tables[0].forEach((function(e){i.PrintLayouts.Items.push(m.d.ComboBoxItems_3(e.Name.toString(),e.DocPrintLayoutID.toString(),""))})),this.PrintLayouts.Items.length>0&&(this.PrintLayouts.SelectedValue=c.Tables[0][0].DocPrintLayoutID.toString()),this.PrintLayouts.SelectionChangedCommand.Subscribe(this,"OnPrintLayoutsChange"),this.OnPrintLayoutsChange(null)}else o=s.a.admin.GetDashBoardRoles(0),this.LoadEditData(o),this.Application.SelectedValue="3";this.OnApplicationChange(null),this.SearchText="Search..."}return _createClass(e,[{key:"GetLocationPrintLayouts",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=[];return i.push(a),i.push(e),i.push(t),i.push(s.a.SessionManager.LocationID),i.push(s.a.SessionManager.RoleID),i.push(s.a.SessionManager.UserID),i.push(n),i.push(s.a.SessionManager.LanguageID),s.a.report.GetPrintLayouts(i)}},{key:"OnButtonClick",value:function(e){if("Cancel"==e.toString())s.a.page.HideDialog();else if("ShowAssignGrid"==e.toString())null==this.AssignGrid&&(this.AssignGrid=new Mt(!0)),this.AssignGrid.IsShown=!0,this.AssignGrid.RefreshGrid(this.Groups.Items,this.Roles.Items,this.Users.Items),s.a.page.ShowDialog(this.AssignGrid,jt.a,{ShowCenter:!0,Title:s.a.GetResource("Assign")});else if("ShowAssignAllGrid"==e.toString())null==this.AssignGridAll&&(this.AssignGridAll=new Mt(!0,!0,this)),this.AssignGridAll.LoadReportAllGrid(this.Groups.Items,this.Roles.Items,this.Users.Items),s.a.page.ShowDialog(this.AssignGrid,jt.a,{ShowCenter:!0,Title:s.a.GetResource("Assign")});else try{var t,n,a;if(t=this.GetSelectedItems(this.Groups),n=this.GetSelectedItems(this.Roles),a=this.GetSelectedItems(this.Users),null!=this.BasedOnDimension&&this.GetSelectedItems(this.BasedOnDimension),0==t.length&&0==n.length&&0==a.length)return void(this.DisplayMessage=1==this.CallType?"Select altest one User":"Select altest one Group/Role/User");if("AddEditDocumentViewModel"==this.Parent.ClassName&&1==this.CallType){var i=s.a.admin.SetAssign(this.Parent.CostCenterID,this.Parent.DocID,t,n,a);this.DisplayMessage=i.Message,parseInt(i.RetValue)}else if("CostCenterViewModel"==this.Parent.ClassName){var r=s.a.admin.SetAssign(this.Parent.CostCenter,this.REPORTID,t,n,a);this.DisplayMessage=r.Message,parseInt(r.RetValue)}else if("AddCostCenterViewModel"==this.Parent.ClassName){var o=s.a.admin.SetAssign(this.Parent.CostCenterID,this.REPORTID,t,n,a);this.DisplayMessage=o.Message,parseInt(o.RetValue)}else if("AddEditRevenUReportViewModel"==this.Parent.ClassName)this.DisplayMessage=this.obj.AssignReport(this.REPORTID,this.ActionType.SelectedValue,t,n,a);else if("AddEditDocumentViewModel"==this.Parent.ClassName&&!this.IsAssignVPTFromDocument&&null!=this.Parent.SelectedRow){if(!s.a.SessionManager.IsActionAssigned(this.Parent.CostCenterID,"Assign Users"))return void(this.DisplayMessage=this.Parent.this.DisplayMessage="Access denied.");var c="";c+="<AssignXML  ",""!=a&&(c+='Users="'+a+'"  '),""!=n&&(c+='Roles="'+n+'" '),""!=t&&(c+='Groups="'+t+'" '),c+="></AssignXML>",this.Parent.SelectedRow.AssignXML=c.toString(),t=this.GetSelectedNames(this.Groups),n=this.GetSelectedNames(this.Roles),""!=(a=this.GetSelectedNames(this.Users))&&(""!=t?t+=","+a:t=a),""!=n&&(""!=t?t+=","+n:t=n),this.Parent.SelectedRow.dcAlpha13=t.toString()}}catch(l){Logger.ErrorLog("DeleteAccountViewModel:: OnDelete"+l.stack)}}},{key:"Search",value:function(e){var t=null;"1"==this.Application.SelectedValue?t=this.Groups:"2"==this.Application.SelectedValue?t=this.Roles:"3"==this.Application.SelectedValue&&(t=this.Users);var n=0;if(null!=t){t.SelectedIndex>=0&&(n=t.SelectedIndex),""==this.SearchText&&(t.SelectedIndex=0,this.SelectedItem=t.Items[0]),-1==n&&(n=0);for(var a=0;a<t.Items.length;a++)if(e?n<t.Items.length-1?n++:n=0:0==n?n=t.Items.length-1:n--,null!=this.SearchText&&""!=this.SearchText&&t.Items[n].Name.toLowerCase().Contains(this.SearchText.toLowerCase()))return void this.SelectSearchItem_2(n,t)}}},{key:"SelectSearchItem_2",value:function(e,t){t.SelectedIndex=e,this.SelectedItem=t.Items[e]}},{key:"OnActionChange",value:function(e){if(this.LoadedAction!=this.ActionType.SelectedValue||this.LoadedNodeID!=this.REPORTID){if(0==this.Users.Items.length){var t=this.obj.GetReportAssignInfo(1,this.ActionType.SelectedValue,this.REPORTID);this.LoadEditData(t)}else{this.Groups.Items.forEach((function(e){e.IsChecked=!1})),this.Roles.Items.forEach((function(e){e.IsChecked=!1})),this.Users.Items.forEach((function(e){e.IsChecked=!1}));var n=this.obj.GetReportAssignInfo(3,this.ActionType.SelectedValue,this.REPORTID);this.SetSelectedItems(this.Groups,n.Tables[0],"GroupID={0}"),this.SetSelectedItems(this.Roles,n.Tables[0],"RoleID={0}"),this.SetSelectedItems(this.Users,n.Tables[0],"UserID={0}")}this.LoadedAction=this.ActionType.SelectedValue,this.LoadedNodeID=this.REPORTID}}},{key:"OnApplicationChange",value:function(e){this.ListBoxVisible=!0,"1"==this.Application.SelectedValue?this.SelectedApplication.Items=this.Groups.Items:"2"==this.Application.SelectedValue?this.SelectedApplication.Items=this.Roles.Items:"3"==this.Application.SelectedValue?this.SelectedApplication.Items=this.Users.Items:"50002"==this.Application.SelectedValue?this.SelectedApplication.Items=this.Location.Items:"VPTBasedOnDimension"==this.Application.SelectedValue||"EmailBasedOnDimension"==this.Application.SelectedValue?this.SelectedApplication.Items=this.BasedOnDimension.Items:"EmailSMSBasedOnField"==this.Application.SelectedValue&&(this.ListBoxVisible=!1)}},{key:"OnPrintLayoutsChange",value:function(e){this.REPORTID=null!=this.PrintLayouts.SelectedValue?parseInt(this.PrintLayouts.SelectedValue):0;var t=this.GetAssignVPTInfo(this.REPORTID);("VPTDesignerViewModel"==this.Parent.ClassName||this.IsAssignVPTFromDocument)&&t.Tables.length>5&&t.Columns[5].Contains("Name")&&(this.BasedOnDimension=new m.b,this.Application.Items.push(m.d.ComboBoxItems_2("Based on Dimension","VPTBasedOnDimension"))),this.Groups.Items.Clear(),this.Roles.Items.Clear(),this.Users.Items.Clear(),this.LoadEditData(t)}},{key:"GetAssignVPTInfo",value:function(e){var t=[];t.push(1),t.push(e),t.push(""),t.push(""),t.push(""),t.push(""),t.push(""),"1"!=s.a.SessionManager.UserID?(s.a.SessionManager.Preferences.ContainsKey("LWRole")&&"true"==s.a.SessionManager.Preferences.LWRole.toLowerCase()?t.push(s.a.SessionManager.LocationWhereWithParent):t.push(null),s.a.SessionManager.Preferences.ContainsKey("DWRole")&&"true"==s.a.SessionManager.Preferences.DWRole.toLowerCase()?t.push(s.a.SessionManager.DivisionID>0?s.a.SessionManager.DivisionID.toString():s.a.SessionManager.DivisionWhere):t.push(null)):(t.push(null),t.push(null)),t.push(s.a.SessionManager.UserName),t.push(s.a.SessionManager.UserID),t.push(s.a.SessionManager.LanguageID);try{return s.a.report.GetAssignVPTInfo(t)}catch(n){return Logger.ErrorLog("PrintLayout:: GetAssignVPTInfo"+n.stack),null}}},{key:"LoadEditData",value:function(e){var t=this;null!=e&&e.Tables.length>0&&(this.Groups.Items.push(m.c.CheckedListBoxItem_6("All","All",!1,0)),e.Tables[0].forEach((function(e){t.Groups.Items.push(m.c.CheckedListBoxItem_6(e.GroupName.toString(),e.GID.toString(),!1,0))})),this.Roles.Items.push(m.c.CheckedListBoxItem_6("All","All",!1,0)),e.Tables[1].forEach((function(e){t.Roles.Items.push(m.c.CheckedListBoxItem_6(e.Name.toString(),e.RoleID.toString(),!1,0))})),this.Users.Items.push(m.c.CheckedListBoxItem_6("All","All",!1,0)),e.Tables[2].forEach((function(e){t.Users.Items.push(m.c.CheckedListBoxItem_6(e.UserName.toString(),e.UserID.toString(),!1,0))})),e.Columns[3].Contains("GroupID")&&(this.SetSelectedItems(this.Groups,e.Tables[3],"GroupID=={0}"),this.SetSelectedItems(this.Roles,e.Tables[3],"RoleID=={0}"),this.SetSelectedItems(this.Users,e.Tables[3],"UserID=={0}")),this.IsLocationWise&&("VPTDesignerViewModel"==this.Parent.ClassName||this.IsAssignVPTFromDocument)&&(this.Location.Items.push(m.c.CheckedListBoxItem_6("All","All",!1,0)),e.Tables[4].forEach((function(e){t.Location.Items.push(m.c.CheckedListBoxItem_5(e.Name.toString(),e.NodeID.toString(),!1))})),this.SetSelectedItems(this.Location,e.Tables[3],"CCNID2={0}")),null==this.BasedOnDimension||"VPTDesignerViewModel"!=this.Parent.ClassName&&!this.IsAssignVPTFromDocument||(this.BasedOnDimension.Items.push(m.c.CheckedListBoxItem_6("All","All",!1,0)),e.Tables[5].forEach((function(e){t.BasedOnDimension.Items.push(m.c.CheckedListBoxItem_5(e.Name.toString(),e.NodeID.toString(),!1))})),this.SetSelectedItems(this.BasedOnDimension,e.Tables[3],"BasedOn={0}")),e.Tables.length>3&&"ListOfDashBoards"==this.Parent.ClassName&&e.Tables[3].length>0&&(this.IsDashboardDefault=!(!e.Columns[3].Contains("IsDefault")||null==e.Tables[3][0].IsDefault&&""==e.Tables[3][0].IsDefault.toString())&&Object(l.j)(e.Tables[3][0].IsDefault.toString())),e.Tables.length>4&&this.Parent instanceof Tt.FavoritesViewModel&&(this.SetSelectedItems(this.Users,e.Tables[4],"FavName='"+this.ReportName+"' and UserID={0}"),this.SetSelectedItems(this.Roles,e.Tables[4],"FavName='"+this.ReportName+"' and RoleID={0}")))}},{key:"GetSelectedNames",value:function(e){for(var t,n="",a=1;a<e.Items.length;a++)(t=e.Items[a]).IsChecked&&1!=t.Type&&(n.length>0&&(n+=","),n+=t.Name);return n.toString()}},{key:"GetSelectedItems",value:function(e){for(var t,n="",a=1;a<e.Items.length;a++)(t=e.Items[a]).IsChecked&&1!=t.Type&&(n.length>0&&(n+=","),n+=t.Value);return n.toString()}},{key:"SetSelectedItems",value:function(e,t,n){var a=this;this.LockCheckedChanged=!0;for(var i,r=!0,s=[],c=1;c<e.Items.length;c++)i=e.Items[c],t.RowFilter=o.e.Format(n,i.Value),t.length>0&&(t.RowFilter.startsWith("Group",0)?s=Object.keys(t[0]).Contains("GroupID")?t.filter((function(e){return e.GroupID==i.Value})):t.filter((function(e){return e.Group==i.Value})):t.RowFilter.startsWith("RoleID",0)?s=t.filter((function(e){return e.RoleID==i.Value})):t.RowFilter.startsWith("CCNID2",0)?s=t.filter((function(e){return e.CCNID2==i.Value})):t.RowFilter.startsWith("UserID",0)?s=t.filter((function(e){return e.UserID==i.Value})):t.RowFilter.startsWith("FavName",0)&&t.RowFilter.Contains("UserID")?s=t.filter((function(e){return e.FavName==a.ReportName&&e.UserID==i.Value})):t.RowFilter.startsWith("FavName",0)&&t.RowFilter.Contains("RoleID")&&(s=t.filter((function(e){return e.FavName==a.ReportName&&e.RoleID==i.Value})))),i.IsChecked=s.length>0,e.Items[c].IsChecked=i.IsChecked,i.IsChecked||(r=!1),i.IsChecked&&s.length>0&&!o.e.IsEmpty(s[0].IsParent)&&(i.Type=parseInt(s[0].IsParent.toString()));r&&(e.Items[0].IsChecked=!0),this.LockCheckedChanged=!1}},{key:"SetSelectedItems_2",value:function(e,t){this.LockCheckedChanged=!0;for(var n,a=!0,i=t.split(","),r=1;r<e.Items.length;r++)(n=e.Items[r]).IsChecked=!!i.Contains(n.Value),n.IsChecked||(a=!1);a&&(e.Items[0].IsChecked=!0),this.LockCheckedChanged=!1}},{key:"OnCheckedChanged",value:function(e){if(!this.LockCheckedChanged&&e.item instanceof m.c){var t=e.item;if("All"==e.item.Value){this.LockCheckedChanged=!0;for(var n=1;n<this.SelectedApplication.Items.length;n++)this.SelectedApplication.Items[n].IsChecked=e.item.IsChecked;this.LockCheckedChanged=!1}else{if(this.LockCheckedChanged=!0,t.IsChecked){this.SelectedApplication.Items[0].IsChecked=!0;for(var a=1;a<this.SelectedApplication.Items.length;a++)if(!this.SelectedApplication.Items[a].IsChecked){this.SelectedApplication.Items[0].IsChecked=!1;break}}else this.SelectedApplication.Items[0].IsChecked=!1;this.LockCheckedChanged=!1}this.LockCheckedChanged=!1}}},{key:"SearchText",get:function(){return this._SearchText},set:function(e){e!=this._SearchText&&(this._SearchText=e,this.Search(!0))}}]),e}(),Mt=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var a,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;_classCallCheck(this,n),(a=t.call(this)).ButtonClick=new y.b,a.IsShown=!1,a.GroupsItems=[],a.RolesItems=[],a.UsersItems=[],a.Grid=new V.a,a.ButtonClick.Subscribe(_assertThisInitialized(a),"OnButtonClick"),a.IsAllExists=e,a.IsReportAllAssign=i,a.Assign=r,a.Grid=new V.a,a.Grid.Width="",a.Grid.CanUserResizeColumns=!1,a.Grid.CanUserAddRows=!0,a.Grid.CanUserDeleteRows=!0,a.Grid.SearchVisible=!0,a.Grid.SearchColStartIndex=1,a.Grid.Table=[],a.Grid.TableColumns.push("CostCenterId"),a.Grid.DataTypes.Int.push("CostCenterId"),a.Grid.TableColumns.push("NodeID"),a.Grid.DataTypes.Int.push("NodeID"),a.Grid.TableColumns.push("NodeID_Name"),a.Grid.TableColumns.push("All"),a.Grid.DataTypes.Int.push("All"),a.Grid.TableColumns.push("View"),a.Grid.DataTypes.Int.push("View"),a.Grid.TableColumns.push("Print"),a.Grid.DataTypes.Int.push("Print"),a.Grid.TableColumns.push("Export"),a.Grid.DataTypes.Int.push("Export"),a.Grid.TableColumns.push("Email"),a.Grid.DataTypes.Int.push("Email"),a.Grid.TableColumns.push("SMS"),a.Grid.DataTypes.Int.push("SMS"),a.Grid.Columns=[];var s=[],o=new f.a;o.Header="Assign",o.ValueBinding="CostCenterId",o.DataType="ComboBox",o.DisplayMember="Name",o.ValueMember="Value",o.Width=130;var c,l=[];(l.push(m.d.ComboBoxItems_2("Roles","6")),l.push(m.d.ComboBoxItems_2("Users","7")),l.push(m.d.ComboBoxItems_2("Groups","100")),o.ComboData=l,s.push(o),(o=new f.a).Header="Data",o.DataType="LISTBOX",o.DisplayMember="NodeID_Name",o.ValueMember="NodeID",o.TypeID=1,o.Width=220,s.push(o),a.Grid.Columns=s,i)?((o=new f.a).Header="All",o.ValueBinding="All",o.DataType="ComboBox",o.DisplayMember="Name",o.ValueMember="Value",o.Width=70,c.push(m.d.ComboBoxItems_2("Yes","1")),c.push(m.d.ComboBoxItems_2("No","1")),o.ComboData=c,s.push(o),(o=new f.a).Header="View",o.ValueBinding="View",o.DataType="ComboBox",o.DisplayMember="Name",o.ValueMember="Value",o.Width=70,o.ComboData=c,s.push(o),(o=new f.a).Header="Print",o.ValueBinding="Print",o.DataType="ComboBox",o.DisplayMember="Name",o.ValueMember="Value",o.Width=70,o.ComboData=c,s.push(o),(o=new f.a).Header="Export",o.ValueBinding="Export",o.DataType="ComboBox",o.DisplayMember="Name",o.ValueMember="Value",o.Width=70,o.ComboData=c,s.push(o),(o=new f.a).Header="Email",o.ValueBinding="Email",o.DataType="ComboBox",o.DisplayMember="Name",o.ValueMember="Value",o.Width=70,o.ComboData=c,s.push(o),(o=new f.a).Header="SMS",o.ValueBinding="SMS",o.DataType="ComboBox",o.DisplayMember="Name",o.ValueMember="Value",o.Width=70,o.ComboData=c,s.push(o)):(a.Grid.SearchCols.Width="90",a.Grid.SearchText.Width="110",a.Grid.SearchOptions.Width="120");return a.Grid.OnBeginEdit.Subscribe(_assertThisInitialized(a),"onBeginEdit"),a.Grid.OnCellEditEnding.Subscribe(_assertThisInitialized(a),"onCellEditEnd"),a}return _createClass(n,[{key:"RefreshGrid",value:function(e,t,n){this.GroupsItems=e,this.RolesItems=t,this.UsersItems=n,this.Grid.Clear(),this.LoadSelectedItems(100,e),this.LoadSelectedItems(6,t),this.LoadSelectedItems(7,n);for(var a=0;a<15;a++){var i=this.Grid.NewRow();this.Grid.addRow(i)}}},{key:"LoadReportAllGrid",value:function(e,t,n){}},{key:"OnButtonClick",value:function(e){"Cancel"==e?s.a.page.HideDialog():"OK"==e&&(this.SetSelectedItems(100,this.GroupsItems),this.SetSelectedItems(6,this.RolesItems),this.SetSelectedItems(7,this.UsersItems),s.a.page.HideDialog())}},{key:"onCellEditEnd",value:function(e,t,n){}},{key:"GetCodeInfo",value:function(e){}},{key:"onBeginEdit",value:function(e,t,n){return n instanceof Pt.a&&!o.e.IsEmpty(e.CostCenterId)&&(o.e.IsEmpty(e.CostCenterId)?n.CostCenterID=0:(n.CostCenterID=parseInt(e.CostCenterId),n.TypeID=1)),!1}},{key:"LoadSelectedItems",value:function(e,t){for(var n=this.IsAllExists?1:0;n<t.length;n++)if(t[n].IsChecked){var a=this.Grid.NewRow();a.CostCenterId=e,a.NodeID=t[n].Value,a.NodeID_Name=t[n].Name,this.Grid.addRow(a)}}},{key:"SetSelectedItems",value:function(e,t){var n,a=this.Grid.Table.filter((function(t){return t.CostCenterId==e}));t.forEach((function(e){e.IsChecked=!1})),a.forEach((function(e){null!=(n=t.find((function(t){return t.Value==e.NodeID.toString()})))&&(n.IsChecked=!0)}))}}]),n}(u.b),vt=n("e9cK"),Gt=n("BJEe"),Nt=n("kJpQ"),Et=n("GhW8"),wt=n("2BcO"),Ft=n("7ODK"),Vt=n("G8Yv"),Lt=n("PDNK"),Rt=n("/EUh"),Bt=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var a;_classCallCheck(this,n),(a=t.call(this)).Parent=null,a.Account=new C.b(0),a.ToDate=new S.a(0),a.FromDate=new S.a(0),a.rdoVTypeList=new Lt.b,a.IsVoucherNoChecked=new Lt.a,a.IsVoucherDateChecked=new Lt.a,a.rdoList=new Lt.b,a.IsPrintChecked=new Lt.a,a.IsExportChecked=new Lt.a,a.IsBarcodeChecked=new Lt.a,a.IsEmailChecked=new Lt.a,a.IsSMSChecked=new Lt.a,a.IsAPIChecked=new Lt.a,a.BarcodeVisibile=!1,a.APIVisibile=!1,a.IsPrintChecked.Label=s.a.GetResource("Print"),a.IsExportChecked.Label=s.a.GetResource("lbl_Export"),a.IsBarcodeChecked.Label=s.a.GetResource("Barcode"),a.IsEmailChecked.Label=s.a.GetResource("SMTP_Email"),a.IsSMSChecked.Label=s.a.GetResource("SMTP_SMS"),a.IsAPIChecked.Label=s.a.GetResource("API"),a.IsPrintChecked.Group=a.rdoList,a.IsExportChecked.Group=a.rdoList,a.IsBarcodeChecked.Group=a.rdoList,a.IsEmailChecked.Group=a.rdoList,a.IsSMSChecked.Group=a.rdoList,a.IsAPIChecked.Group=a.rdoList,a.rdoList.Items.push(a.IsPrintChecked),a.rdoList.Items.push(a.IsExportChecked),a.rdoList.Items.push(a.IsBarcodeChecked),a.rdoList.Items.push(a.IsEmailChecked),a.rdoList.Items.push(a.IsSMSChecked),a.rdoList.Items.push(a.IsAPIChecked),a.IsPrintChecked.IsChecked=!0,a.IsPrintChecked.CheckedChangedCommand.Subscribe(_assertThisInitialized(a),"rdoClick"),a.IsExportChecked.CheckedChangedCommand.Subscribe(_assertThisInitialized(a),"rdoClick"),a.IsBarcodeChecked.CheckedChangedCommand.Subscribe(_assertThisInitialized(a),"rdoClick"),a.IsEmailChecked.CheckedChangedCommand.Subscribe(_assertThisInitialized(a),"rdoClick"),a.IsSMSChecked.CheckedChangedCommand.Subscribe(_assertThisInitialized(a),"rdoClick"),a.IsAPIChecked.CheckedChangedCommand.Subscribe(_assertThisInitialized(a),"rdoClick"),a.Parent=e,a.FromPrefix=new g.a(0),a.ToPrefix=new g.a(0),a.EmailTemplates=new m.e(0),a.ClubAttachments=new b.a(0),a.EmailTemplates.Visible=!1,a.ClubAttachments.Visible=!1,a.Account.Label=s.a.GetResource("DocumentDesigner_Account"),a.Account.LblWidth="130",a.Account.CCID=2,a.Account.TypeID=2,a.ClubAttachments.LblWidth="130",a.EmailTemplates.LblWidth="130",a.IsVoucherNoChecked.IsChecked=!0,a.IsVoucherNoChecked.Label=s.a.GetResource("Doc_DocumentNumber"),a.IsVoucherDateChecked.Label=s.a.GetResource("Reports_LblVoucherDate"),a.IsVoucherNoChecked.Group=a.rdoVTypeList,a.IsVoucherDateChecked.Group=a.rdoVTypeList,a.rdoVTypeList.Items.push(a.IsVoucherNoChecked),a.rdoVTypeList.Items.push(a.IsVoucherDateChecked),a.FromPrefix.Label=s.a.GetResource("StockTransferFrom"),a.FromPrefix.LblWidth="50",a.ToPrefix.Label=s.a.GetResource("StockTransferTo"),a.ToPrefix.LblWidth="50",a.FromDate.Label=s.a.GetResource("StockTransferFrom"),a.FromDate.LblWidth="50",a.ToDate.Label=s.a.GetResource("StockTransferTo"),a.ToDate.LblWidth="50",a.PrintDims=[],s.a.SessionManager.IsActionAssigned(e.CostCenterID,"Save&Barcode")&&(a.BarcodeVisibile=!0),s.a.SessionManager.IsActionAssigned(e.CostCenterID,"API")&&(a.APIVisibile=!0);var i=s.a.SessionManager.Preferences.ContPrintDims.length>0?s.a.SessionManager.Preferences.ContPrintDims.split(","):[];if(i.length>0)for(var r=s.a.common.GetDataSet("DOC035",s.a.SessionManager.Preferences.ContPrintDims).Tables[0],o=0;o<r.length;o++){var c=new Qe.PactQueryListBoxData(parseInt(i[o]));c.Label=r[o].Name.toString(),c.LblWidth="130",c.CCID=parseInt(r[o].FeatureID),c.TypeID=1,c.Row=o,a.PrintDims.push(c)}return a.ToPrefix.ComboBox.SelectionChangedCommand.Subscribe(_assertThisInitialized(a),"OnPrefixChanged","ToPrefix"),a.ToPrefix.ComboBox.Items=e.ScreenObject.DocPrefix.ComboBox.Items,a.ToPrefix.ComboBox.SelectedValue=e.ScreenObject.DocPrefix.ComboBox.SelectedValue,a.FromPrefix.ComboBox=a.ToPrefix.ComboBox,a.OnPrefixChanged("ToPrefix"),a.FromPrefix.TextBox.Text="1",a}return _createClass(n,[{key:"rdoClick",value:function(e){e.IsChecked&&(e==this.IsPrintChecked?(this.ClubAttachments.Visible=!1,this.EmailTemplates.Visible=!1):e==this.IsExportChecked?(this.IsAPIChecked.Visible=!1,this.ClubAttachments.Label="Club All Documents In Single File",this.ClubAttachments.Visible=!0,this.EmailTemplates.Visible=!1):e==this.IsBarcodeChecked?(this.ClubAttachments.Visible=!1,this.EmailTemplates.Visible=!1,this.IsAPIChecked.Visible=!1):e==this.IsEmailChecked?(this.ClubAttachments.Label="Club All Documents In Attachment",this.ClubAttachments.Visible=!0,this.IsAPIChecked.Visible=!1,this.LoadEmailTemplates()):e==this.IsSMSChecked?(this.ClubAttachments.Visible=!1,this.IsAPIChecked.Visible=!1,this.LoadEmailTemplates()):e==this.IsAPIChecked&&(this.ClubAttachments.Visible=!1,this.LoadAPITemplates()))}},{key:"LoadAPITemplates",value:function(){var e=this;this.DisplayMessage="",this.EmailTemplates.Label="API Name",this.EmailTemplates.Visible=!0,this.EmailTemplates.Items.Clear(),s.a.document.GetAPIPostingDetails(this.Parent.CostCenterID,0,0,"").Tables[0].forEach((function(t){e.EmailTemplates.Items.push(m.d.ComboBoxItems_6(t.APIName.toString(),t.APISysName.toString(),!0,t.MapID.toString(),t.APIType.toString()))})),this.EmailTemplates.Items.length>0&&(this.EmailTemplates.SelectedItem=this.EmailTemplates.Items[0],this.EmailTemplates.SelectedValue=this.EmailTemplates.Items[0].Value)}},{key:"OnPrefixChanged",value:function(e){var t=this.FromPrefix;if("FromPrefix"!=e){"ToPrefix"==e&&(t=this.ToPrefix),t.TextBox.Text="0";var n=s.a.document.getcurrentcode(this.Parent.DocumentID,null==t.ComboBox.SelectedValue?"":t.ComboBox.SelectedValue);if(null!=n&&n.Tables.length>0&&n.Tables[0].length>0&&!n.Columns[0].Contains("ErrorMessage")&&n.Columns[0].Contains("CurrentCodeNumber")&&""!=n.Tables[0][0].CurrentCodeNumber.toString().Trim()){var a=parseInt(n.Tables[0][0].CurrentCodeNumber)-1;t.TextBox.Text=a.toString()}}}},{key:"OnButtonClick",value:function(e){"Cancel"==e?s.a.page.HideDialog():"OK"==e&&this.GetDocumentsList()}},{key:"GetDocumentsList",value:function(){var e=this,t="";this.DisplayMessage="";var n="";this.PrintDims.forEach((function(e){0!=e.SelectedValue&&(n+=" and DCC.dcCCNID"+(e.CCID-5e4)+"="+e.SelectedValue)}));var a=[];a.push(this.Parent.DocumentID),a.push(null==this.FromPrefix.ComboBox.SelectedValue?"":this.FromPrefix.ComboBox.SelectedValue),a.push(this.IsVoucherNoChecked.IsChecked?1:2),a.push(this.Account.SelectedValue);var i=o.e.Int(this.FromPrefix.TextBox.Text);a.push(i),i=o.e.Int(this.ToPrefix.TextBox.Text),a.push(i),a.push(this.FromDate.Date.ToString("dd MMM yyyy")),a.push(this.ToDate.Date.ToString("dd MMM yyyy")),a.push(n),a.push(!this.IsPrintChecked.IsChecked||s.a.SessionManager.IsActionAssigned(43,"Allow Re-Print")),a.push(this.IsPrintChecked.IsChecked||this.IsBarcodeChecked.IsChecked?this.Parent.DoNotPrintUnApprovedDocuments:this.Parent.DoNotEmailSMSUnApprovedDocuments),a.push(s.a.SessionManager.UserID),a.push(s.a.SessionManager.LanguageID);var r=s.a.document.GetDocVouchersList(a);if(null!=r&&r.Tables.length>0&&r.Tables[0].length>0)if(r.Columns[0].Contains("ErrorMessage"))this.DisplayMessage=r.Tables[0][0].ErrorMessage.toString();else{for(var c=r.Tables[0][0].DocID.toString(),l=1;l<r.Tables[0].length;l++)t+=","+r.Tables[0][l].DocID.toString();if(this.IsExportChecked.IsChecked||this.IsPrintChecked.IsChecked||this.IsEmailChecked.IsChecked&&this.ClubAttachments.IsChecked?t.length>0&&(t=t.Remove(0,1)):(t=c+t,c=null),this.IsPrintChecked.IsChecked)s.a.page.HideDialog(),setTimeout((function(){e.Parent.Export(parseInt(c),t.toString(),!0,-1,!0)}),600);else if(this.IsBarcodeChecked.IsChecked)s.a.page.HideDialog(),setTimeout((function(){e.Parent.PrintBarcode(t.toString(),null)}),500);else if(this.IsExportChecked.IsChecked)s.a.page.HideDialog(),setTimeout((function(){e.Parent.Export(parseInt(c),t.toString(),e.ClubAttachments.IsChecked)}),500);else if(this.IsAPIChecked){for(var u=0,d=0;d<r.Tables[0].length;d++)u=parseInt(r.Tables[0][d].DocID.toString()),this.Parent.APICallRequest(this.Parent.CostCenterID,u,parseInt(this.EmailTemplates.SelectedItem.Aliasname),this.EmailTemplates.SelectedItem.Parent);s.a.page.HideDialog()}else if(this.IsEmailChecked.IsChecked||this.IsSMSChecked.IsChecked){if(0==this.EmailTemplates.Items.length||null==this.EmailTemplates.SelectedValue)return void(this.DisplayMessage="Please Select Template");var D=[];D.push(2),D.push(this.Parent.CostCenterID),D.push(0),D.push(0),D.push(0),D.push(this.IsEmailChecked.IsChecked?1:2),D.push(s.a.SessionManager.UserEmail),D.push(""),D.push(null),this.IsEmailChecked.IsChecked?(D.push(null),D.push(null),D.push(null),D.push(parseInt(this.EmailTemplates.SelectedValue)),this.ClubAttachments.IsChecked?(D.push(t.toString()),D.push(c)):(D.push(null),D.push(t.toString()))):(D.push(""),D.push(""),D.push(null),D.push(parseInt(this.EmailTemplates.SelectedValue)),D.push(null),D.push(t.toString())),D.push(null),D.push(null),"TRUE"==s.a.SessionManager.Preferences.EnableLocationWise.toUpperCase()&&s.a.SessionManager.Preferences.ContainsKey("LWEmailSMS")&&"TRUE"==s.a.SessionManager.Preferences.LWEmailSMS.toUpperCase()?D.push(parseInt(this.EmailTemplates.GetselectedItem().Parent)):D.push(0);Rt.a.SetNotifEventTemp(D).subscribe((function(t){e.DisplayMessage=t.Message,t.RetValue>0&&(e.Parent.DisplayMessage=t.Message,s.a.page.HideDialog())}),(function(t){console.log(t),e.DisplayMessage="Error in mail."}))}}}},{key:"LoadEmailTemplates",value:function(){var e=this;this.DisplayMessage="",this.EmailTemplates.Label=this.IsEmailChecked.IsChecked?"Email Template":"SMS Template",this.EmailTemplates.Visible=!0,this.EmailTemplates.Items.Clear(),Rt.a.GetEmailSMS(6,this.Parent.DocumentID,this.IsEmailChecked.IsChecked?"1":"2").Tables[0].forEach((function(t){e.EmailTemplates.Items.push(m.d.ComboBoxItems_3(t.TemplateName.toString(),t.TemplateID.toString(),t.LocationID.toString()))})),this.EmailTemplates.Items.length>0&&(this.EmailTemplates.SelectedItem=this.EmailTemplates.Items[0],this.EmailTemplates.SelectedValue=this.EmailTemplates.Items[0].Value)}}]),n}(u.b),xt=n("phzQ"),kt=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var a;return _classCallCheck(this,n),(a=t.call(this)).PickFromAddress=new b.a,a.PickToAddress=new b.a,a.ShowAddress=!1,a.ShowDistance=!1,a.ShowLogin=!0,a.Actions=new m.e(0),a.Reasons=new m.e(0),a.GSTIN=new h.d(0),a.UserName=new h.d(0),a.Password=new h.d(0),a.Input=new h.d(0),a.FromPincode=new h.d(0),a.ToPincode=new h.d(0),a.Distance=new h.d(0),a.Parent=e,a.dsScreenDetails=Fe.a.GetGSTPostingDetails(a.Parent.DocID,a.Parent.CostCenterID,""),a.Actions.LblWidth="80",a.Actions.Label="GST Action : ",a.GSTIN.Label="GSTIN",a.UserName.Label="UserName",a.Password.Label="Password",a.FromPincode.Label="From Pincode",a.ToPincode.Label="To Pincode",a.Distance.Label="Distance",a.PickFromAddress.Label="Get From Address Details",a.PickToAddress.Label="Get To Address Details",a.Input.Visible=!1,a.Reasons.Visible=!1,a.Load(),a.Actions.SelectionChangedCommand.Subscribe(_assertThisInitialized(a),"OnselectionChanged"),a}return _createClass(n,[{key:"Load",value:function(){if(this.Actions.Items.Clear(),this.Title="",null!=this.dsScreenDetails&&null!=this.dsScreenDetails.Tables&&this.dsScreenDetails.Tables.length>0&&this.dsScreenDetails.Tables[0].length>0)for(var e=0;e<this.dsScreenDetails.Tables[0].length;e++)"EINV"==this.dsScreenDetails.Tables[0][e].GSTType.toString()?(this.Title="E Invoice - Eway Bill",this.Actions.Items.push(m.d.ComboBoxItems_4("Generate IRN","INVOICE","EINV","2001")),this.Actions.Items.push(m.d.ComboBoxItems_4("Generate E-Way Bill By IRN","EWAYBILL","EINV","2003")),this.Actions.Items.push(m.d.ComboBoxItems_4("Cancel E-Way Bill By IRN","EWAYAPI","EINV","2004")),this.Actions.Items.push(m.d.ComboBoxItems_4("Cancel IRN","INVOICE/CANCEL","EINV","2002"))):"EWB"==this.dsScreenDetails.Tables[0][e].GSTType.toString()&&(this.Title.Contains("Eway Bill")||(this.Title="Eway Bill"),this.Actions.Items.push(m.d.ComboBoxItems_4("Generate E-Way Bill","GENEWAYBILL","EWB","2003")),this.Actions.Items.push(m.d.ComboBoxItems_3("Update Part-B/Vehicle Number","VEHEWB","EWB")),this.Actions.Items.push(m.d.ComboBoxItems_3("Extend Validity of E-Way bill","EXTENDVALIDITY","EWB")),this.Actions.Items.push(m.d.ComboBoxItems_3("Update Transporter","UPDATETRANSPORTER","EWB")),this.Actions.Items.push(m.d.ComboBoxItems_4("Cancel E-Way Bill","CANEWB","EWB","2004")),this.Actions.Items.push(m.d.ComboBoxItems_3("Reject E-Way Bill","REJEWB","EWB")))}},{key:"OnselectionChanged",value:function(e){this.dsGSTDetails=Fe.a.GetGSTPostingDetails(this.Parent.DocID,this.Parent.CostCenterID,this.Actions.SelectedItem.Parent),null!=this.dsGSTDetails&&null!=this.dsGSTDetails.Tables&&this.dsGSTDetails.Tables.length>0&&this.dsGSTDetails.Tables[0].length>0?(this.dsGSTDetails.Columns[0].Contains("fromGstin")&&(this.GSTIN.Text=this.dsGSTDetails.Tables[0][0].fromGstin.toString()),this.dsGSTDetails.Columns[0].Contains("UserName")&&(this.UserName.Text=this.dsGSTDetails.Tables[0][0].UserName.toString())):(this.DisplayMessage="Error while data Fetch",this.MessageVisibility=!0),this.Input.Visible=!1,this.Reasons.Visible=!1,this.ShowAddress=!1,this.ShowDistance=!1,this.ShowLogin=!0,"B2CQRCODE"==this.Actions.SelectedValue?this.ShowLogin=!1:"GENEWAYBILL"==this.Actions.SelectedValue||"INVOICE"==this.Actions.SelectedValue?this.dsGSTDetails.Columns[0].Contains("transDistance")&&(this.ShowDistance=!0,o.e.IsNum(this.dsGSTDetails.Tables[0][0].transDistance)&&(this.Distance.Text=o.e.Int(this.dsGSTDetails.Tables[0][0].transDistance).toString()),o.e.IsNum(this.dsGSTDetails.Tables[0][0].fromPincode)&&(this.FromPincode.Text=o.e.Int(this.dsGSTDetails.Tables[0][0].fromPincode).toString()),o.e.IsNum(this.dsGSTDetails.Tables[0][0].dispPincode)&&(this.FromPincode.Text=o.e.Int(this.dsGSTDetails.Tables[0][0].dispPincode).toString()),o.e.IsNum(this.dsGSTDetails.Tables[0][0].toPincode)&&(this.ToPincode.Text=o.e.Int(this.dsGSTDetails.Tables[0][0].toPincode).toString()),o.e.IsNum(this.dsGSTDetails.Tables[0][0].shipPincode)&&(this.ToPincode.Text=o.e.Int(this.dsGSTDetails.Tables[0][0].shipPincode).toString())):"VEHEWB"==this.Actions.SelectedValue||"EXTENDVALIDITY"==this.Actions.SelectedValue?"VEHEWB"==this.Actions.SelectedValue?(this.Reasons.Visible=!0,this.Reasons.Label="Reason for Update ",this.Reasons.Items.Clear(),this.Reasons.Items.push(m.d.ComboBoxItems_3("Due to Break Down","1","Update")),this.Reasons.Items.push(m.d.ComboBoxItems_3("Due to Transshipment","2","Update")),this.Reasons.Items.push(m.d.ComboBoxItems_3("Others","3","Update")),this.Reasons.Items.push(m.d.ComboBoxItems_3("First Time","4","Update"))):"EXTENDVALIDITY"==this.Actions.SelectedValue&&(this.Input.Visible=!0,this.Input.Label="Remaining Distance ",this.Reasons.Visible=!0,this.Reasons.Label="Reason for Extension ",this.Reasons.Items.Clear(),this.Reasons.Items.push(m.d.ComboBoxItems_3("Natural Calamity","1","Extend")),this.Reasons.Items.push(m.d.ComboBoxItems_3("Law and Order Situation","2","Extend")),this.Reasons.Items.push(m.d.ComboBoxItems_3("Transshipment","4","Extend")),this.Reasons.Items.push(m.d.ComboBoxItems_3("Accident","5","Extend")),this.Reasons.Items.push(m.d.ComboBoxItems_3("Other","99","Extend"))):"UPDATETRANSPORTER"==this.Actions.SelectedValue?(this.Input.Visible=!0,this.Input.Label="Transporter ID "):"CANEWB"!=this.Actions.SelectedValue&&"INVOICE/CANCEL"!=this.Actions.SelectedValue&&"EWAYAPI"!=this.Actions.SelectedValue||(this.Reasons.Visible=!0,this.Reasons.Label="Reason for Cancellation ",this.Reasons.Items.Clear(),this.Reasons.Items.push(m.d.ComboBoxItems_3("Duplicate","1","Cancel")),this.Reasons.Items.push(m.d.ComboBoxItems_3("Order Cancelled","2","Cancel")),this.Reasons.Items.push(m.d.ComboBoxItems_3("Data Entry mistake","3","Cancel")),this.Reasons.Items.push(m.d.ComboBoxItems_3("Others","4","Cancel")))}},{key:"OnButtonClick",value:function(e){var t=this;if(null!=e)if("Cancel"==e.toString())s.a.page.HideDialog();else if("Distance"==e.toString()){if(o.e.IsEmpty(this.FromPincode.Text))return void(this.DisplayMessage="Please Enter From Pincode");if(o.e.IsEmpty(this.ToPincode.Text))return void(this.DisplayMessage="Please Enter To Pincode");var n=(void 0).GetDistance(this.FromPincode.Text,this.ToPincode.Text);if(n>0&&(this.Distance.Text=n.toString(),this.dsGSTDetails.Columns[0].Contains("transDistance")))for(var a=0;a<this.dsGSTDetails.Tables[0].length;a++)this.dsGSTDetails.Tables[0][a].transDistance=n}else if("B2CQRCode"==e.toString()){if(!(null!=this.dsGSTDetails&&null!=this.dsGSTDetails.Tables&&this.dsGSTDetails.Tables.length>0&&this.dsGSTDetails.Tables[0].length>0))return void(this.DisplayMessage="Error while data Fetch");this.dsGSTDetails.Columns[0].Contains("SignedQRCode")||this.dsGSTDetails.Tables[0].Columns.push("SignedQRCode");var i=(void 0).GetB2CQRCode(this.dsGSTDetails.Tables[0]),r=this.dsScreenDetails.Tables[1].filter((function(e){return e.GSTType==t.Actions.SelectedItem.Parent&&"SignedQRCode"==e.GSTColumnName}));if(r.length>0){var c="";(u=this.Parent.ScreenObject._TextFields.find((function(e){return e.DBColumnName.toString()==r[0].SysColumnName.toString()})))&&u instanceof h.d&&(u.Text=i,o.e.IsEmpty(i)?(c=c+"DTD."+r[0].SysColumnName.toString()+"=N'',",this.DisplayMessage="Error while B2C QR Code Generating"):(c=c+"DTD."+r[0].SysColumnName.toString()+"=N'"+i+"',",this.DisplayMessage="B2C QR Code Generated Successfully")),o.e.IsEmpty(c)||s.a.common.GetDataSet3("DOC055",c.TrimEnd(","),this.dsGSTDetails.Tables[0][0].DocID.toString())}}else if("Upload"==e.toString()||"Json"==e.toString()){if(o.e.IsEmpty(this.Actions.SelectedValue))return void(this.DisplayMessage="Please Select Action");if(!(null!=this.dsGSTDetails&&null!=this.dsGSTDetails.Tables&&this.dsGSTDetails.Tables.length>0&&this.dsGSTDetails.Tables[0].length>0))return void(this.DisplayMessage="Error while data Fetch");if(this.Reasons.Visible&&null==this.Reasons.SelectedValue)return void(this.DisplayMessage="Select "+this.Reasons.Label);var l;if(this.dsGSTDetails.Columns[0].Contains("success")||this.dsGSTDetails.Tables[0].Columns.push("success"),"VEHEWB"==this.Actions.SelectedValue?(this.dsGSTDetails.Columns[0].Contains("reasonRem")||this.dsGSTDetails.Tables[0].Columns.push("reasonRem"),this.dsGSTDetails.Tables[0][0].reasonRem=this.Reasons.SelectedItem.Name):"EXTENDVALIDITY"==this.Actions.SelectedValue?(this.dsGSTDetails.Columns[0].Contains("remainingDistance")||this.dsGSTDetails.Tables[0].Columns.push("remainingDistance"),this.dsGSTDetails.Columns[0].Contains("extnRemarks")||this.dsGSTDetails.Tables[0].Columns.push("extnRemarks"),this.dsGSTDetails.Tables[0][0].remainingDistance=this.Input.Text,this.dsGSTDetails.Tables[0][0].extnRemarks=this.Reasons.SelectedItem.Name):"UPDATETRANSPORTER"==this.Actions.SelectedValue?(this.dsGSTDetails.Columns[0].Contains("transporterId")||this.dsGSTDetails.Tables[0].Columns.push("transporterId"),this.dsGSTDetails.Tables[0][0].transporterId=this.Input.Text):"CANEWB"!=this.Actions.SelectedValue&&"INVOICE/CANCEL"!=this.Actions.SelectedValue&&"EWAYAPI"!=this.Actions.SelectedValue||(this.dsGSTDetails.Columns[0].Contains("cancelRmrk")||this.dsGSTDetails.Tables[0].Columns.push("cancelRmrk"),this.dsGSTDetails.Tables[0][0].cancelRmrk=this.Reasons.SelectedItem.Name),"GENEWAYBILL"==this.Actions.SelectedValue||"INVOICE"==this.Actions.SelectedValue?(l=this.dsGSTDetails.Tables[0],(void 0).pickFromAddress=(void 0).pickFromAddress=this.PickFromAddress.IsChecked,(void 0).pickToAddress=(void 0).pickToAddress=this.PickToAddress.IsChecked):(l=[]).push(this.dsGSTDetails.Tables[0][0]),"Upload"==e.toString()){var u,d=function(){if(o.e.IsEmpty(t.GSTIN.Text))return{v:void(t.DisplayMessage="Please Enter GSTIN")};if(o.e.IsEmpty(t.UserName.Text))return{v:void(t.DisplayMessage="Please Enter UserName")};if(o.e.IsEmpty(t.Password.Text))return{v:void(t.DisplayMessage="Please Enter Password")};if(!confirm("Are you sure to "+t.Actions.SelectedItem.Name))return{v:void 0};"EWB"==t.Actions.SelectedItem.Parent?t.DisplayMessage=(void 0).UploadingEWB(t.UserName.Text,t.GSTIN.Text,t.Password.Text,t.Actions.SelectedValue):"EINV"==t.Actions.SelectedItem.Parent&&(t.DisplayMessage=(void 0).UploadingEINV(t.UserName.Text,t.GSTIN.Text,t.Password.Text,t.Actions.SelectedValue));var e=t.dsScreenDetails.Tables[1].filter((function(e){return e.GSTType==t.Actions.SelectedItem.Parent}));if(e.length>0){if("INVOICE/CANCEL"==t.Actions.SelectedValue)t.Parent.onButtonClick("Suspend"),s.a.page.HideDialog();else{for(var n="",a=function(a){(u=t.Parent.ScreenObject._TextFields.find((function(t){return t.DBColumnName.toString()==e[a].SysColumnName.toString()})))&&(u instanceof h.d?(u.Text=l[0][e[a].GSTColumnName.toString()].toString(),n=o.e.IsEmpty(l[0][e[a].GSTColumnName.toString()].toString())?n+"DTD."+e[a].SysColumnName.toString()+"=N'',":n+"DTD."+e[a].SysColumnName.toString()+"=N'"+l[0][e[a].GSTColumnName.toString()].toString()+"',"):u instanceof S.b&&(o.e.IsEmpty(l[0][e[a].GSTColumnName.toString()].toString())?u.Date=null:(new Date,u.Date=o.e.isValidDate(l[0][e[a].GSTColumnName.toString()])?new Date(l[0][e[a].GSTColumnName.toString()].toString()):null),n=u.Date?n+"DTD."+e[a].SysColumnName.toString()+"=N'"+u.Date.ToString("dd/MMM/yyyy hh:mm a")+"',":n+"DTD."+e[a].SysColumnName.toString()+"=N'',"))},i=0;i<e.length;i++)a(i);o.e.IsEmpty(n)||s.a.common.GetDataSet3("DOC055",n.TrimEnd(","),l[0].DocID.toString())}if(!o.e.IsEmpty(t.Actions.SelectedItem.Aliasname)){var r=[];r.push(parseInt(t.Actions.SelectedItem.Aliasname)),r.push(t.Parent.CostCenterID),r.push(t.Parent.DocID),r.push("GUID"),r.push(s.a.SessionManager.UserName),r.push(s.a.SessionManager.UserID),r.push(s.a.SessionManager.LanguageID),s.a.report.SetNotifEvent(r)}}}();if("object"==typeof d)return d.v}else"Json"==e.toString()&&("EINV"==this.Actions.SelectedItem.Parent||"EWB"==this.Actions.SelectedItem.Parent)&&(this.DisplayMessage=(void 0).GenerateJSON("",this.Actions.SelectedValue,""));return}}}]),n}(u.b),_t=n("s7Y5"),Kt=n("BUEH"),Qt=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,a){var i;return _classCallCheck(this,n),(i=t.call(this)).Title="",i.EmpCode="",i.EmpName="",i.iEmpSeqNo=0,i.iEmpSeqNo=e,i.LoadGrid(a),i.ClassName="VacationCreditedDaysDetailViewModel",i}return _createClass(n,[{key:"LoadGrid",value:function(e){this.dgv=new V.a,this.dgv.Columns=[],this.dgv.Height=200,this.dgv.Width="";var t=new f.a;t.Header="From Date",t.DisplayMember="FDATE",t.ID="FDATE",t.Width=80,t.ReadOnly=!0,this.dgv.Columns.push(t),(t=new f.a).Header="To Date",t.DisplayMember="TDATE",t.ID="TDATE",t.Width=80,t.ReadOnly=!0,this.dgv.Columns.push(t),(t=new f.a).Header="Days",t.DisplayMember="Days",t.ID="Days",t.Width=50,t.ReadOnly=!0,t.DataType="FLOAT",t.ShowTotal=!0,t.IsCalculated=1,t.DecimalPoints="2",this.dgv.Columns.push(t),this.dgv.Table=[],this.dgv.TableColumns.push("FDATE"),this.dgv.TableColumns.push("TDATE"),this.dgv.TableColumns.push("Days"),this.BindGrid(this.iEmpSeqNo,e)}},{key:"BindGrid",value:function(e,t){this.iEmpSeqNo=e;var n,a=s.a.common.GetDataTable("PAY076",this.iEmpSeqNo.toString());if(null!=a&&a.length>0?(this.EmpCode="Employee Code : "+a[0].EmpCode.toString(),this.EmpName="Employee Name : "+a[0].EmpName.toString()):this.EmpCode=this.EmpName="",null!=t){for(var i=0,r=0;r<t.length;r++)(n=this.dgv.NewRow()).FDATE=new Date(t[r].FDATE).ToString(s.a.SessionManager.Preferences["Date Format"]),n.TDATE=new Date(t[r].TDATE).ToString(s.a.SessionManager.Preferences["Date Format"]),n.Days=parseFloat(t[r].Days).ToString("0.00"),i+=parseFloat(n.Days),this.dgv.addRow(n);this.dgv.Columns[2].footer=i.ToString("0.00"),this.dgv.UpdateFooter(),this.dgv.refreshDatawithIDs()}else n=this.dgv.NewRow(),this.dgv.addRow(n)}},{key:"Button_Click",value:function(e){s.a.page.HideDialog()}}]),n}(u.b),Ht=n("kBEi"),Wt=n("I/F0"),Ut=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,a){var i;return _classCallCheck(this,n),(i=t.call(this)).Parent=e,i.Title="Select Register",i.RegisterList=a,null==i.SelectedRegister&&i.RegisterList.length>0&&(i.SelectedRegister=i.RegisterList[0]),i.LoadGrid(),i.SelectedRegisterObj.Table=i.RegisterList,i.SelectedRegisterObj.refreshDataView(),i}return _createClass(n,[{key:"onSave",value:function(e){if("Cancel"==e)return this.MessageVisibility=!0,void(this.DisplayMessage=s.a.GetResource("Select Register"));if("OK"==e){if(null==this.SelectedRegister||""==o.e.String(this.SelectedRegister.NodeID).Trim())return this.MessageVisibility=!0,void(this.DisplayMessage=s.a.GetResource("Select Register"));this.SelectedRegister=this.SelectedRegisterObj.SelectedItem,this.Parent.ScreenObject.RegisterNodeID=parseInt(this.SelectedRegister.NodeID.toString()),s.a.page.HideDialog()}}},{key:"LoadGrid",value:function(){Logger.InfoLog("AdjustmentsViewModel::Entering LoadGrid()"),this.SelectedRegisterObj=new V.a,this.SelectedRegisterObj.Columns=[],this.SelectedRegisterObj.Width="";var e=new f.a;e.Header="Code",e.DisplayMember="Code",e.ID="Code",e.Width=200,e.ReadOnly=!0,this.SelectedRegisterObj.Columns.push(e),(e=new f.a).Header="Name",e.DisplayMember="Name",e.ID="Name",e.Width=200,e.ReadOnly=!0,this.SelectedRegisterObj.Columns.push(e),this.SelectedRegisterObj.Clear(),this.SelectedRegisterObj.TableColumns.push("Code"),this.SelectedRegisterObj.TableColumns.push("Name"),Logger.InfoLog("AdjustmentsViewModel::Exiting LoadGrid()")}}]),n}(u.b),Xt=n("JoYt"),qt=n("3WaB"),Yt=function(e){_inherits(a,e);var t=_createSuper(a);function a(e){var n;return _classCallCheck(this,a),(n=t.call(this)).ButtonClick=new y.b,n.ControlData=[],n.DisplayMember="",n.TouchVisibility=!1,n.txt=null,n.Parent=null,n.wid="50",n.ht="50",Logger.InfoLog("TouchScreenViewModel:: Entering TouchScreenViewModel"),n.Parent=e,n.ButtonClick.Subscribe(_assertThisInitialized(n),"OnButtonClick"),n.FillButtons(),Logger.InfoLog("TouchScreenViewModel:: Entering TouchScreenViewModel"),n}return _createClass(a,[{key:"FillButtons",value:function(){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.ControlData=[],(t=new D.a).DBColumnID=0,t.Label="0",t.Formula="22",t.Width=(2*parseInt(this.wid)+4).toString(),t.SectionID=this.ht,t.Row=4,t.Column=1,t.ColumnSpan=2,t.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(t),(t=new D.a).DBColumnID=1,t.Label="1",t.Formula="22",t.Width=this.wid,t.SectionID=this.ht,t.Row=3,t.Column=1,t.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(t),(t=new D.a).DBColumnID=2,t.Label="2",t.Formula="22",t.Width=this.wid,t.SectionID=this.ht,t.Row=3,t.Column=2,t.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(t),(t=new D.a).DBColumnID=3,t.Label="3",t.Formula="22",t.Width=this.wid,t.SectionID=this.ht,t.Row=3,t.Column=3,t.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(t),(t=new D.a).DBColumnID=4,t.Label="4",t.Formula="22",t.Width=this.wid,t.SectionID=this.ht,t.Row=2,t.Column=1,t.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(t),(t=new D.a).DBColumnID=5,t.Label="5",t.Formula="22",t.Width=this.wid,t.SectionID=this.ht,t.Row=2,t.Column=2,t.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(t),(t=new D.a).DBColumnID=6,t.Label="6",t.Formula="22",t.Width=this.wid,t.SectionID=this.ht,t.Row=2,t.Column=3,t.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(t),(t=new D.a).DBColumnID=7,t.Label="7",t.Formula="22",t.Width=this.wid,t.SectionID=this.ht,t.Row=1,t.Column=1,t.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(t),(t=new D.a).DBColumnID=8,t.Label="8",t.Formula="22",t.Width=this.wid,t.SectionID=this.ht,t.Row=1,t.Column=2,t.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(t),(t=new D.a).DBColumnID=9,t.Label="9",t.Formula="22",t.Width=this.wid,t.SectionID=this.ht,t.Row=1,t.Column=3,t.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(t),(t=new D.a).DBColumnID=10,t.Label=".",t.Formula="32",t.Width=this.wid,t.SectionID=this.ht,t.Row=4,t.Column=3,t.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(t),(t=new D.a).DBColumnID=11,t.Label="Enter",t.Formula="15",t.Width=this.wid,t.SectionID=(2*parseInt(this.ht)+4).toString(),t.Row=3,t.Column=4,t.RowSpan=2,t.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(t),(t=new D.a).DBColumnID=12,t.Label="+",t.Formula="32",t.Width=this.wid,t.SectionID=this.ht,t.Row=0,t.Column=4,t.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(t),(t=new D.a).DBColumnID=13,t.Label="-",t.Formula="32",t.Width=this.wid,t.SectionID=this.ht,t.Row=0,t.Column=0,t.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(t),(t=new D.a).DBColumnID=14,t.Label="C",t.Formula="22",t.Width=this.wid,t.SectionID=this.ht,t.Row=2,t.Column=4,t.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(t),(t=new D.a).DBColumnID=15,t.Label="<<",t.Formula="22",t.Width=this.wid,t.SectionID=this.ht,t.Row=1,t.Column=4,t.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(t),(t=new D.a).DBColumnID=16,t.Label="^",t.Formula="25",t.Width=this.wid,t.SectionID=this.ht,t.Row=1,t.Column=0,t.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(t),(t=new D.a).DBColumnID=17,t.Label="v",t.Formula="22",t.Width=this.wid,t.SectionID=this.ht,t.Row=2,t.Column=0,t.ClickCommand.Subscribe(this,"OnButtonClick"),this.ControlData.push(t),(t=new D.a).DBColumnID=18,t.Label="Del",t.Formula="18",t.Width=this.wid,t.SectionID=(2*parseInt(this.ht)+4).toString(),t.Row=3,t.Column=0,t.RowSpan=2,t.ClickCommand.Subscribe(this,"OnButtonClick"),t.Enable="AddEditDocumentViewModel"==this.Parent.ClassName,this.ControlData.push(t),this.txt=new h.d,this.txt.DBColumnID=19,this.txt.Text="0",this.txt.Formula="24",this.txt.Width=(3*parseInt(this.wid)+6).toString(),this.txt.SectionID=this.ht,this.txt.Row=0,this.txt.Column=1,this.txt.ColumnSpan=3,this.ControlData.push(this.txt);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"OnButtonClick",value:function(e){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var a,i,r,o,c,l,u,d,h,S,m,b,C,y;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.resolve().then(n.bind(null,"/GLD"));case 2:return a=t.sent,i=a.AddDenominationViewModel,t.next=6,Promise.all([n.e(8),n.e(23),n.e(24),n.e(25),n.e(28),n.e(30),n.e(29),n.e(32),n.e(31),n.e(27),n.e(26),n.e(35),n.e(37),n.e(38),n.e(36),n.e(33),n.e(34),n.e(39),n.e(40),n.e(41),n.e(70)]).then(n.bind(null,"FNqn"));case 6:return r=t.sent,o=r.POSExitViewModel,t.next=10,Promise.resolve().then(n.bind(null,"I/F0"));case 10:return c=t.sent,l=c.POSPayModesViewModel,t.next=14,Promise.resolve().then(n.bind(null,"9UOb"));case 14:if(u=t.sent,d=u.PostVoucherSaveViewModel,!(e instanceof D.a)){t.next=53;break}if(11!=(h=e).DBColumnID){t.next=22;break}"AddEditDocumentViewModel"==this.Parent.ClassName?null!=this.Parent.SelectedRow&&""!=this.txt.Text&&"0"!=this.txt.Text&&""!=this.DisplayMember&&(this.Parent.SelectedRow[this.DisplayMember]=parseFloat(this.txt.Text),this.Parent.FillDefaultProd(this.Parent.SelectedRow,this.DisplayMember),this.Parent.CalculateTotals(this.Parent.SelectedRow,!1,this.DisplayMember),this.DisplayMember="",this.txt.Text="0"):this.Parent instanceof l||this.Parent instanceof d?""!=this.txt.Text&&""!=this.DisplayMember?null!=this.Parent.Denom.GrdDenomination.SelectedItem&&(this.Parent.Denom.GrdDenomination.SelectedItem[this.DisplayMember]=parseFloat(this.txt.Text),this.Parent.Denom.GetTotal(),this.DisplayMember="",this.txt.Text="0"):""!=this.txt.Text&&""==this.DisplayMember&&(this.Parent.Amount.Text=parseFloat(this.txt.Text).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount),this.txt.Text="0"):this.Parent instanceof o?""!=this.txt.Text&&null!=this.Parent.ExitGrid.SelectedItem&&(this.Parent.ExitGrid.SelectedItem.Amount=parseFloat(this.txt.Text),this.txt.Text="0"):this.Parent instanceof i&&""!=this.txt.Text&&""!=this.DisplayMember&&null!=this.Parent.GrdDenomination.SelectedItem&&(this.Parent.GrdDenomination.SelectedItem[this.DisplayMember]=parseFloat(this.txt.Text),this.Parent.GetTotal(),this.DisplayMember="",this.txt.Text="0"),t.next=53;break;case 22:if(12!=h.DBColumnID){t.next=26;break}""==this.DisplayMember&&"AddEditDocumentViewModel"==this.Parent.ClassName?null!=this.Parent.SelectedRow&&""!=this.Parent.SelectedRow.ProductID_Key.toString()&&(this.txt.Text="0",this.Parent.SelectedRow.Quantity=parseFloat(this.Parent.SelectedRow.Quantity)+1,this.Parent.CalculateTotals(this.Parent.SelectedRow,!1,"Quantity")):""!=this.txt.Text&&(this.txt.Text=(parseFloat(this.txt.Text)+1).toString()),t.next=53;break;case 26:if(13!=h.DBColumnID){t.next=30;break}""==this.DisplayMember&&"AddEditDocumentViewModel"==this.Parent.ClassName?null!=this.Parent.SelectedRow&&""!=this.Parent.SelectedRow.ProductID_Key.toString()&&(this.txt.Text="0",parseFloat(this.Parent.SelectedRow.Quantity)>1&&(this.Parent.SelectedRow.Quantity=parseFloat(this.Parent.SelectedRow.Quantity)-1,this.Parent.CalculateTotals(this.Parent.SelectedRow,!1,"Quantity"))):""!=this.txt.Text&&"0"!=this.txt.Text&&(this.txt.Text=(parseFloat(this.txt.Text)-1).toString()),t.next=53;break;case 30:if(14!=h.DBColumnID){t.next=34;break}this.txt.Text="0",t.next=53;break;case 34:if(15!=h.DBColumnID){t.next=38;break}""!=this.txt.Text&&"0"!=this.txt.Text&&(this.txt.Text=this.txt.Text.substr(this.txt.Text.length-1),""==this.txt.Text&&(this.txt.Text="0")),t.next=53;break;case 38:if(16!=h.DBColumnID&&17!=h.DBColumnID){t.next=42;break}"AddEditDocumentViewModel"==this.Parent.ClassName?null!=this.Parent.SelectedRow&&(S=0,16==h.DBColumnID?S-=1:S+=1,S>=0&&S<this.Parent.SelectedRow.DataView.Table.length&&this.Parent.Setselectedrow(S),this.DisplayMember="",this.txt.Text="0"):this.Parent instanceof l?null!=this.Parent.Denom.GrdDenomination.SelectedItem&&(m=this.Parent.Denom.GrdDenomination.SelectedIndex,16==h.DBColumnID?m-=1:m+=1,m>=0&&m<this.Parent.Denom.GrdDenomination.SelectedItem.DataView.Table.length&&(this.Parent.Denom.GrdDenomination.SelectedIndex=m)):this.Parent instanceof d?null!=this.Parent.Denom.GrdDenomination.SelectedItem&&(b=this.Parent.Denom.GrdDenomination.SelectedIndex,16==h.DBColumnID?b-=1:b+=1,b>=0&&b<this.Parent.Denom.GrdDenomination.SelectedItem.DataView.Table.length&&(this.Parent.Denom.GrdDenomination.SelectedIndex=b)):this.Parent instanceof o?null!=this.Parent.ExitGrid.SelectedItem&&(C=this.Parent.ExitGrid.SelectedIndex,16==h.DBColumnID?C-=1:C+=1,C>=0&&C<this.Parent.ExitGrid.SelectedItem.DataView.Table.length&&(this.Parent.ExitGrid.SelectedIndex=C)):this.Parent instanceof i&&null!=this.Parent.GrdDenomination.SelectedItem&&(y=this.Parent.GrdDenomination.SelectedIndex,16==h.DBColumnID?y-=1:y+=1,y>=0&&y<this.Parent.GrdDenomination.SelectedItem.DataView.Table.length&&(this.Parent.GrdDenomination.SelectedIndex=y)),t.next=53;break;case 42:if(18!=h.DBColumnID){t.next=46;break}"AddEditDocumentViewModel"==this.Parent.ClassName&&this.Parent.CanDeleteRow(this.Parent.SelectedRow)&&this.Parent.OnBeforeRowDeleting(this.Parent.SelectedRow,!0),t.next=53;break;case 46:if(10!=h.DBColumnID){t.next=52;break}if(!this.txt.Text.Contains(".")){t.next=49;break}return t.abrupt("return");case 49:this.txt.Text=this.txt.Text+h.Label,t.next=53;break;case 52:this.txt.Text="0"==this.txt.Text?(parseFloat(this.txt.Text)+parseFloat(h.Label)).toString():this.txt.Text+h.Label;case 53:case"end":return t.stop()}}),t,this)})))}}]),a}(u.b),zt=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,a,i,r){var s;_classCallCheck(this,n),(s=t.call(this)).GridDataObj=new V.a,s.ColumnSource=[],s.Parent=null,s.ind=0,s.MaxLinkID=0,s.MaxLinkID=i,s.ind=r,Logger.InfoLog("LinkedProductsViewModel:: Entering LinkedProductsViewModel"),s.Parent=e,s.InitGrid();for(var o=0;o<a.length;o++)if(""!=a[o].LinkType.toString()&&1==parseInt(a[o].LinkType.toString())){var c=s.GridDataObj.NewRow();c.ProductName_Key=a[o].ProductID.toString(),c.ProductCode=a[o].Productcode.toString(),c.ProductName=a[o].ProductName.toString(),s.GridDataObj.addRow(c)}return s.FillEmptyRows(),Logger.InfoLog("LinkedProductsViewModel:: Entering LinkedProductsViewModel"),s}return _createClass(n,[{key:"FillEmptyRows",value:function(){for(var e=this.GridData.length;e<10;e++)this.GridDataObj.addEmptyRow();for(var t=0;t<this.GridData.length;t++)this.GridData[t].Select=!1}},{key:"CheckAll",value:function(e){for(var t=0;t<this.GridData.length;t++)o.e.IsEmpty(this.GridData[t].ProductName_Key)||(this.GridData[t].Select=e)}},{key:"InitGrid",value:function(){var e;this.GridDataObj.TableColumns.push("Select"),this.GridDataObj.TableColumns.push("ProductCode"),this.GridDataObj.TableColumns.push("ProductName"),this.GridDataObj.TableColumns.push("ProductName_Key"),(e=new f.a).Header="Select",e.DisplayMember="Select",e.DataType="CheckBox",e.Width=50,this.ColumnSource.push(e),(e=new f.a).Header=s.a.GetResource("BOM_ProductCOde"),e.DisplayMember="ProductCode",e.ValueMember="ProductName_Key",e.DataType="TextBlock",e.Width=230,e.ReadOnly=!0,this.ColumnSource.push(e),(e=new f.a).Header=s.a.GetResource("BOM_ProductName"),e.DisplayMember="ProductName",e.ValueMember="ProductName_Key",e.DataType="TextBlock",e.Width=230,e.ReadOnly=!0,this.ColumnSource.push(e),this.GridDataObj.Columns=this.ColumnSource,this.GridDataObj.SelectAll.Visible=!0}},{key:"OnButtonClick",value:function(e){if("Cancel"==e)s.a.page.HideDialog();else if("OK"==e){for(var t=0;t<this.GridData.length;t++)if(!o.e.IsEmpty(this.GridData[t].Select)&&!o.e.IsEmpty(this.GridData[t].ProductName_Key)&&Object(l.j)(this.GridData[t].Select.toString())){var n=this.Parent.ScreenObject.GridDataObj.NewRow();n.ProductID_Key=this.GridData[t].ProductName_Key.toString(),n.Quantity="1",n.LinkID=this.MaxLinkID,this.Parent.ScreenObject.GridDataObj.insertRowAt(n,this.ind),this.Parent.AddProductData(n,!0,!1),this.Parent.CalculateTotals(n,!1),this.ind++}this.Parent.ScreenObject.UpdateSequence(),this.Parent.ScreenObject.GridDataObj.gridObj.invalidate(),s.a.page.HideDialog()}}},{key:"GridData",get:function(){return this.GridDataObj.Table}}]),n}(u.b),Jt=n("ykB/"),Zt=n("aa/T"),$t=n("utDZ"),en=n("+ryo"),tn=function(e){_inherits(a,e);var t=_createSuper(a);function a(e,n){var r,l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"AddEditDocumentViewModel",C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(_classCallCheck(this,a),(r=t.call(this)).PrevDocID=0,r.AutoPostDocID=0,r.AutoProduceDocID=0,r.PosSessionID=0,r.AutoPOstXML=null,r.AutoProduceXML=null,r.parent=null,r.AutoPostViewModel=null,r.AutoProduce=null,r.IsAutoPost=!1,r.isAutoProduce=!1,r.isSaveXml=!1,r.ScheduleID=0,r.RecurDocumentVoucherNo="",r.IsSuspend=!1,r.IsUserLock=!1,r.DocumentNumber=null,r.sDSCUserName="",r.bDSExists=!1,r.oDSImg=null,r.TempPVSaccid=0,r.TempPVSamt=0,r.TempPVSIsBillwise=!1,r.IsMessageBox=!1,r.IsMessageBoxvalue=0,r.ProductImageVisibility=!1,r.PhotoTextVisibility=!1,r.ProductPhoto="",r.Unit_keyOnBeginEditValue="",r.LineNo=0,r.ReadOnlyBody=!1,r.BodyVisible=!1,r.TabBtnVisible=!1,r.ColumnNo=0,r.ViewActivities=null,r.NodeID=0,r.POSPayModes=null,r.ProductSearchVisibility=!1,r.Activities=null,r.DocHistoryVisibility=!1,r.HoldProdSearch=null,r.HoldDocName=new h.d(0),r.HoldDocDate=new S.a(0),r.VacCrDaysVisibility=!1,r.MappedDocsVisibility=!1,r.ReportInfoVisibility=!1,r.DocLinkVisibility=!1,r.AddressesVisibility=!1,r.AssignVisibility=!1,r.DependencyVisibility=!1,r.AssignFields=null,r.Dependflds=new m.b(0),r.SalesManDimension=null,r.payTermXml="",r.LCBillsXml="",r.ChkRtnXml="",r.BillWiseXML="",r.ArApBills="",r.APIAddressXML="",r.POSpayXml="",r.IsReplaced=0,r.Shortcuts=[],r.t=new o.d,r.ccid=0,r.PrAccID=0,r.dtActionAssigned=null,r.DtPack=null,r.DtPackColumns=[],r.donotupInv=null,r.DtTempSchemes=null,r.DtTempSchemesColumns=null,r.ScreenObject=null,r.IsSales="1",r.Currency=null,r.ChequeBook=null,r.DonotUpdateInventory=!0,r.PDCSCleared=!1,r.DonotUpdateSchemeQty=!0,r.VoucherType=0,r.GridNetTotal=0,r.FooterGridNetTotal=0,r.CashDrwerPrintID=0,r.SaveCallBack=null,r.FooterDics=new c.a,r.BillWisedt=[],r.BillWisedtColumns=[],r.Bal=0,r.DivisionID=0,r.NetAmtVisibility=!0,r._Ddate=Date.Today(),r.FooterVisible=!1,r.QuickInfoVisibility=!1,r.DQuickInfoVisibility=!1,r.VoucherDefVisibility=!1,r.SelectedHistoryRow=null,r.StatusColor="#736F6F",r._DocStatus="",r.DialogResult=!1,r.GridRowHeight=25,r.IgnoreQuickViews=[],r.QuickInfoView=null,r.DQuickInfoView=null,r.IsInventoryVoucher=!1,r.ButtonSave=new D.a,r.ButtonRevise=new D.a,r.ButtonDelete=new D.a,r.ButtonSuspendDoc=new D.a,r.ButtonApprove=new D.a,r.ButtonSuspend=new D.a,r.ButtonSaveandPrint=new D.a,r.ButtonSaveandBarcode=new D.a,r.ButtonBarcode=new D.a,r.NumPadText="",r.ButtonCloseVisibility=!1,r.Remarks=new h.c(0),r.AppRejDate=new S.a(0),r.IsLocked=!1,r.RecurDocsWithApproval=new m.e(0),r.AddressViewVisibility=!1,r.NoteVisibility=!1,r.CaseVisibility=!1,r.OKCancelVisibility=!1,r.SelectedCase=null,r.CaseList=null,r._ApproveVisibility=!1,r._SuspendVisiblity=!1,r.ImportbuttonVisible=!1,r.ImportVisiblity=!1,r.DtImportObj=new V.a,r.IsImport=!1,r.RightPanelWidth=300,r.TouchVisibility=!1,r.FooterTouchVisible=!1,r.TouchView=null,r.NumericPADView=null,r.ImportIsUpdate=!1,r.ImportChunkSize="5",r.SearchVisibility=!1,r._AttachmentVisibility=!1,r.PopupVisibility=!1,r.AppDisplayMessage="",r.ButtonsEnabled=!0,r.Recur=null,r.Bounce=null,r.WFDocLevelList=[],r.ButtonsLeft=[],r.ButtonsPopup=[],r.DistributeInstallmentsVisible=!1,r.LoanGuaranteeVisible=!1,r.FailedRecourdList=[],r.ButtonsPopUp=!1,r.Note=null,r.ViewNotes=null,r._Attachment=null,r.CasesContactViewModel=null,i.set(_assertThisInitialized(r),void 0),r.DocumentID=0,r.StatusID=0,r.WorkFlowDocLevel=0,r.intRecCount=0,r.NotifWorkflowID=0,r.WfID=0,r.LCDueAmt=0,r.RightPanelVisiblity=!0,r.DisableRightPanel=!1,r.isFromDate=!1,r.OnRejectEdit=!1,r.IsLockDimsLineWise=!1,r.IsEdit=!1,r.LineWiseApproval=!1,r.UserWiseApproval=!1,r.linkStatusRemarks=null,r.timerDraft=new o.d,r.PoleDisplaytimer=new o.d,r.dsData=null,r.dtData=null,r.IsFrmFS_LoanBal=!1,r.IsMPVParent=!1,r.ReevaluateFutureVac=!1,r.GenratePrefix=!1,r.IsDocValid=!1,r.savebulk=!1,r.pdcGCVM=null,r.strEmpFilter="",r.HelpDoc="",r.strValidationMessage="",r.strVacXml="",r.sApprUpdate="",r.strPMCXml="",r.strEmpIsMgr="",r.ProjDims=null,r.dtOTTypes=null,r.dtPayEmps=null,r.dtPayShifts=null,r.sSearchColName="",r.iPMCActivity=0,r.srcDocument=null,r.ErrorMessage="Missing Report Parameter ' ",r.itemSourceFilter=[],r.IsFirstCallSelective=!1,r.dtLoanGuarantees=null,r.dtVacDefineDays=null,r.dtShiftAssRot=null,r.dtVacContract=null,r.isCheckIn=!1,r.isCheckOut=!1,r.isDAValidate=!1,r.DocNumberDelegate=new y.b,r.RightTabSelectedIndex=0,r.IgnoreOnSave=new c.a,r.SaveCallReq={Validate:!0},r.RetValue=0,r.commandprarameter="",r.SaveCallBackMethod=new y.b,r.isChequeReturn=!1,r.IsSelectAll=!1,r.FooterColumn="",r.IsBinwise=null,r.IsToBinwise=null,r.dsProjWOffHol=null,r.ProdID=0,r.PrevValue="",r.SubDialogResult=!1,r.IsLatesProcessTimingsUpdated=!1,r._BudgetObj=null,r.barcodeValues=null,r.ViewOrganizationViewModel=null,r.ShowPrintDialog=!0,r.IsExportPrint=!1,r.sXpsFileName="",r.drSelPrintLayout=null,r.dsTotLayouts=null,r.iLayCnt=0,r.dsVacationdays=null,r.isVacContractedit=!1,r.isVacPopup=!1,r.dsAllEmployeeData=null,r.IsGetAllEmployees=!1,r.sBioErrLogs="",r.sDAErrLogs="",r.iDgColFrom=-1,r.iDgColUpto=-1,r.iDtColFrom=-1,r.iDtColUpto=-1,r.dtEData=null,r.dsHrsDefDict=new c.a,r.dsHrsDef={},r.dsSaved={Tables:[]},r.VacCrDaysScreen=[],r.objPayDayCheck=null,r.strWhere="",r.sFilter="",r.sNodes="",r.IsNewAssignLeave=!1,r.dtALeaveComp=[],r.sEmpFilter="",r.dtPayMon=new Date,r.dtPayMonStart=new Date,r.dtPayMonEnd=new Date,r.dtLatesMonth=new Date,r.dtLatesMonthStart=new Date,r.dtLatesMonthEnd=new Date,r.ExcelData=[],r.leaveTab=new P.b,r.LeaveData=[],r.OnSesionGridDataChanged=new y.b,r.assignedLeaves=new h.d,r.availableLeaves=new h.d,r.noOfDays=new h.d,r.fromDate=new S.a,r.toDate=new S.a,r.session=new m.e,r.displayAgGrid=!1,r.displayLineItems=!1,r.DtImportObj.Table=[],r.ClassName=b,r.POSRegisterID=C,"EMPTY_LOAD"!=n){r.Remarks.Label=s.a.GetResource("Remarks"),r.AppRejDate.Label=s.a.GetResource("Date"),r.RecurDocsWithApproval.Label=s.a.GetResource("PostRecurDocsWithApproval"),r.HoldDocName.Label=s.a.GetResource("DocName"),r.HoldDocDate.Label=s.a.GetResource("Doc_Date"),r.Onload(e,n,l,u),r.RefreshNetAmount(),r.ScreenObject.IsConstructorCall=!1;var p=r.ScreenObject.ColumnSource.filter((function(e){return"Rate"==e.DisplayMember}));0!=p.length&&(r.ScreenObject.RateVisibility=p[0].IsVisible),r.prepareLineItemsToForm()}else r.ScreenObject=new d.a(e,0);return _possibleConstructorReturn(r)}return _createClass(a,[{key:"RefreshNetAmount",value:function(){this.NetAmountObs=this.NetAmount}},{key:"OnAddNote",value:function(){this.Note=new v.AddNoteViewModel,this.Note.AddNoteViewModel_2(this)}},{key:"OnAddAttachment",value:function(){Logger.InfoLog("AddProductViewModel::Entering AddAttachment");var e="";null!=this.Attachment&&(e=this.Attachment.ColID);var t=null;null!=this.Attachment&&(t=this.Attachment.RowID),this.Attachment=new N.AddAttachmentViewModel,this.Attachment.AddAttachmentViewModel_2(this),""==e?(this.Attachment.ColID="",this.Attachment.RowID=null):(this.Attachment.ColID=e,this.Attachment.RowID=t),Logger.InfoLog("AddProductViewModel::Entering AddAttachment")}},{key:"Onload",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;Logger.InfoLog("AddEditDocumentViewModel::Entering AddEditDocumentViewModel"),this.timerDraft.Enabled=!0;try{this.timerDraft.Interval=1e3*parseInt(s.a.SessionManager.Preferences.AutoDocumentDraftTime)}catch(M){this.timerDraft.Interval=6e4}if(this.timerDraft.Elapsed(this,"timerDraft_Elapsed"),this.t.Interval=2e3,this.t.Tick(this,"t_Tick"),this.PoleDisplaytimer.Interval=6e4,this.IsEdit=i,this.CostCenterID=e,this.srcDocument=r,this.ScreenName=t,this.DocumentID=this.CostCenterID,this.ScreenObject=new d.a(this.CostCenterID,0),this.ScreenObject.LoadEditCallBack.Subscribe(this,"LoadEditCallBack"),this.ScreenObject.ClearCallBack.Subscribe(this,"ClearCallBack"),this.ScreenObject.ValidateData.Handler(this,"ValidateDataCallBack"),this.ScreenObject.GridDataObj.BeforeRowDeleting.Subscribe(this,"BeforeRowDeletingEvent"),this.ScreenObject.FooterGridDataObj.CellEditEnding.Subscribe(this,"OnFooterCellEditEnding"),this.ScreenObject.FooterGridDataObj.OnPreviewKeyDown.Subscribe(this,"OnFooterKeyDown"),this.ScreenObject.GridDataObj.CellEditEnding.Subscribe(this,"OnCellEditCommit"),this.ScreenObject.GridDataObj.BeginEdit.Subscribe(this,"onBeginEdit"),this.ScreenObject.GridDataObj.shortcut.Subscribe(this,"Onshortcut"),this.ScreenObject.FooterGridDataObj.BeginEdit.Subscribe(this,"onFooterBeginEdit"),this.ScreenObject.GridDataObj.OnPreviewKeyDown.Subscribe(this,"OnKeyDown"),this.ScreenObject.ReferenceCallBack.Subscribe(this,"ReferenceCallBack"),this.ScreenObject.ShowQuickViewCallBack.Handler(this,"ShowQuickViewCallBack"),this.ScreenObject.GridDataObj.callParentObjMethod.Subscribe(this,"CallfromgridObj"),this.ScreenObject.GridDataObj.OnLinkClick.Subscribe(this,"onGridLinkClick"),this.worker_DoWork(r),!this.ScreenObject.IsAccessDenied){if(this.RefreshGridFooter=!0,null!=this.ScreenObject.DocPrefix&&(this.ScreenObject.DocPrefix.onGetData.Subscribe(this,"GetData"),this.ScreenObject.DocPrefix.NextVisibility=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Next"),this.ScreenObject.DocPrefix.PreviousVisibility=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Previous"),this.ScreenObject.DocPrefix.LoadVisibility=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"LoadDocument")),this.ScreenObject.Preferences.ContainsKey("Notes")&&""!=this.ScreenObject.Preferences.Notes&&Object(l.j)(this.ScreenObject.Preferences.Notes)){this.ViewNotes=new G.a(this),this.Note=new v.AddNoteViewModel,this.Note.AddNoteViewModel_2(this);var c=this.ScreenObject.CustomTab.Pages.find((function(e){return"Notes"==e.Name&&3==e.TabType}));if(c){c.Fields.Clear(),c.Visible=!0,c.Fields.push(this.ViewNotes);var u=this.GetButton("Notes");u&&(u.Visible=!1)}}if(this.ScreenObject.Preferences.ContainsKey("Activities")&&"True"==this.ScreenObject.Preferences.Activities){this.ViewActivities=new qe.b(this),this.ViewActivities.NodeID=this.DocID,this.ViewActivities.ViewActivityInSection=!0,this.NodeID=this.DocID,this.Activities=new Ye.a(this,!1),this.Activities.AssignVisiblity=!1,this.ViewActivities.Activities=this.Activities,this.ViewActivities.CloseVisible=!0;var h=this.ScreenObject.CustomTab.Pages.find((function(e){return"Activities"==e.Name&&3==e.TabType}));if(h){h.Fields.Clear(),h.Visible=!0,this.ScreenObject.Preferences.ContainsKey("OneActivity")&&"True"==this.ScreenObject.Preferences.OneActivity?(this.Activities.ActivityOnScreen=!0,this.Activities.IsPopup=!0,this.Activities.OneActivity=!0,h.Fields.push(this.Activities)):this.ScreenObject.Preferences.ContainsKey("ActivityOnScreen")&&"True"==this.ScreenObject.Preferences.ActivityOnScreen?(this.Activities.ActivityOnScreen=!0,this.Activities.IsPopup=!0,h.Fields.push(this.Activities),h.Fields.push(this.ViewActivities)):h.Fields.push(this.ViewActivities);var S=this.GetButton("Activities");S&&(S.Visible=!1)}}if(this.ScreenObject.Preferences.ContainsKey("Attachments")&&""!=this.ScreenObject.Preferences.Attachments&&Object(l.j)(this.ScreenObject.Preferences.Attachments)){this.ViewAttachments=new A.ViewAttachmentViewModel(this),this.ViewAttachments.GridView=this.ScreenObject.Preferences.ContainsKey("AttachementThumbnail")&&""!=this.ScreenObject.Preferences.Attachments&&Object(l.j)(this.ScreenObject.Preferences.AttachementThumbnail);var b=this.ScreenObject.CustomTab.Pages.find((function(e){return"Attachments"==e.Name&&3==e.TabType}));if(b){b.Fields.Clear(),b.Visible=!0,b.Fields.push(this.ViewAttachments);var y=this.GetButton("Attachments");y&&(y.Visible=!1)}}var p=this.ScreenObject.CustomTab.Pages.find((function(e){return"LinkInfo"==e.Name&&3==e.TabType}));p&&(p.Fields.Clear(),p.Visible=!1,this.grdLinkTab=new Q.a(this)),this.ReportDimension=new C.b(0),this.ReportDimension.CCID=this.ScreenObject.IsInventory?3:2,this.ScreenObject.IsInventory?(this.ReportDimension.TypeID=10,this.ReportDimension.Label=s.a.GetResource("DocumentDesigner_Product")):(this.ReportDimension.TypeID=100,this.ReportDimension.Label=s.a.GetResource("DocumentDesigner_Account")),this.ReportsList=[],this.DocsList=[];var g=[];if(null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>21&&this.ScreenObject.Data.Tables[21].forEach((function(e){if("2"!=o.e.String(e.Type)){var t=new D.a;t.DBColumnID=parseInt(e.ReportID),t.Label=e.ReportName.toString(),n.ScreenObject.Data.Columns[21].Contains("Shortcut")&&(t.KeyTip=e.Shortcut.toString()),n.ScreenObject.Data.Columns[21].Contains("DisplayAsPopup")&&!o.e.IsEmpty(e.DisplayAsPopup)&&(t.Dependancy=o.e.Int(e.DisplayAsPopup)),n.ScreenObject.Data.Columns[21].Contains("Width")&&!o.e.IsEmpty(e.Width)&&(t.GroupName=e.Width.toString()),n.ScreenObject.Data.Columns[21].Contains("Height")&&!o.e.IsEmpty(e.Height)&&(t.Length=e.Height.toString()),n.ScreenObject.Data.Columns[21].Contains("DocumentField")&&!o.e.IsEmpty(e.DocumentField)&&(t.Formula=e.DocumentField.toString()),n.ScreenObject.Data.Columns[21].Contains("mapxml")&&!o.e.IsEmpty(e.mapxml)&&(t.ToolTipFooterDescription=e.mapxml.toString()),g.Contains(parseInt(e.ReportID))||(g.push(parseInt(e.ReportID)),n.ReportsList.push(t),n.IsPOs&&(n.ScreenObject.Data.Columns[1].Contains("ActionHeight")?(t.SectionID=o.e.IsEmpty(n.ScreenObject.Data.Tables[1][0].ActionHeight)?"60":n.ScreenObject.Data.Tables[1][0].ActionHeight.toString(),t.Width=o.e.IsEmpty(n.ScreenObject.Data.Tables[1][0].ActionWidth)?"62":n.ScreenObject.Data.Tables[1][0].ActionWidth.toString()):(t.Width="62",t.SectionID="60"),t.ComParam="Reports "+t.DBColumnID,n.ButtonsLeft.push(t)))}else{var a=new D.a;a.DBColumnID=parseInt(e.ReportID),a.Label=e.ReportName.toString(),n.ScreenObject.Data.Columns[21].Contains("Shortcut")&&(a.KeyTip=e.Shortcut.toString()),n.ScreenObject.Data.Columns[21].Contains("DisplayAsPopup")&&!o.e.IsEmpty(e.DisplayAsPopup)&&(a.Dependancy=o.e.Int(e.DisplayAsPopup)),n.DocsList.push(a),n.IsPOs&&(n.ScreenObject.Data.Columns[1].Contains("ActionHeight")?(a.SectionID=o.e.IsEmpty(n.ScreenObject.Data.Tables[1][0].ActionHeight)?"60":n.ScreenObject.Data.Tables[1][0].ActionHeight.toString(),a.Width=o.e.IsEmpty(n.ScreenObject.Data.Tables[1][0].ActionWidth)?"62":n.ScreenObject.Data.Tables[1][0].ActionWidth.toString()):(a.Width="62",a.SectionID="60"),a.ComParam="Documents "+a.DBColumnID,n.ButtonsLeft.push(a))}})),s.a.SessionManager.RegisterCCID>0&&0==this.ScreenObject.RegisterNodeID&&this.ScreenObject.Data.Tables.length>18&&this.ScreenObject.Data.Tables[18].length>0&&!this.IsPOs){var f=s.a.admin.GetRegisters();if(f.Tables.length>0&&f.Columns[0].Contains("NodeID"))if(1==f.Tables[0].length)this.ScreenObject.RegisterNodeID=parseInt(f.Tables[0][0].NodeID);else if(f.Tables[0].length>0){var O=new Ut(this,f.Tables[0]);s.a.page.ShowDialog(O,Xt.a,{ShowCenter:!0,Title:O.Title})}}if(this.DocumentNumber&&this.DocumentNumber.DialogOptions&&this.DocumentNumber.DialogOptions.IsOpen||s.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==s.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(this.ScreenObject.FillListViews(!0),this.ReportDimension.IsAutoLoad=!0),35==this.ScreenObject.DocumentType&&(this.ViewOrganizationViewModel=this.GetViewOrganizationViewModel(this),this.CasesContactViewModel=this.GetCasesContactViewModel(this.ViewOrganizationViewModel,this),this.CasesContactViewModel.Contact.Items.Clear(),null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.SelectedValue>0)){var I=s.a.accounting.GetAccountDetails(this.ScreenObject.DebitAccount.SelectedValue);if(null!=I&&I.Tables[0].length>0&&(this.CasesContactViewModel.Contact.Items.push(m.d.ComboBoxItems_2("New","0")),this.CasesContactViewModel.Contact.SelectedValue="0",I.Tables.length>1&&I.Tables[2].length>0)){for(var T=0;T<I.Tables[2].length;T++)this.CasesContactViewModel.Contact.Items.push(m.d.ComboBoxItems_2(I.Tables[2][T].FirstName.toString(),I.Tables[2][T].ContactID.toString()));this.CasesContactViewModel.dvContacts=I.Tables[2].DefaultView}}var j=0;if(this.ScreenObject.Preferences.ContainsKey("Autopostdocument")&&""!=this.ScreenObject.Preferences.Autopostdocument&&parseInt(this.ScreenObject.Preferences.Autopostdocument)>4e4&&(!this.ScreenObject.Preferences.ContainsKey("AutoIssueNextStage")||"True"!=this.ScreenObject.Preferences.AutoIssueNextStage)&&(j=o.e.Int(this.ScreenObject.Preferences.Autopostdocument),this.AutoPostViewModel=new a(j,"",!1,this),this.AutoPostViewModel.IsAutoPost=!0,this.AutoPostViewModel.ScreenObject.GridDataColumns.push("RefSeqNo"),this.ScreenObject.GridDataColumns.push("RefSeqNo"),this.ScreenObject.Preferences.ContainsKey("NoAutoproduce")&&Object(l.j)(this.ScreenObject.Preferences.NoAutoproduce)&&null!=this.AutoPostViewModel.AutoProduce&&(this.AutoPostViewModel.AutoProduce=null)),33==this.DocumentType&&s.a.SessionManager.Preferences.ContainsKey("AutoProduceDoc")&&""!=s.a.SessionManager.Preferences.AutoProduceDoc&&o.e.Int(s.a.SessionManager.Preferences.AutoProduceDoc)>4e4&&(j=o.e.Int(this.ScreenObject.Preferences.AutoProduceDoc),this.AutoProduce=new a(j,"",!1),this.AutoProduce.isAutoProduce=!0,this.AutoProduce.ScreenObject.GridDataColumns.push("AutoRefSeqNo"),this.ScreenObject.GridDataColumns.push("AutoRefSeqNo")),15==this.DocumentType&&this.BatchPayment(),this.SetFocus(),this.SetSaveVisibility(),i||null==this.ScreenObject||null==this.ScreenObject.Link||null==this.ScreenObject.Link.LinkCombo||o.e.IsEmpty(this.ScreenObject.Link.LinkCombo.SelectedValue)||this.OLinkSelectionChanged(null),this.ConsolidateLeaveMonth(),this.SetNewDocFields(),this.CheckListViews(),this.ScreenObject.IsPayrollDocument&&(this.SetButtonVisibility("Recur",!1),this.SetButtonVisibility("Hold",!1),this.SetButtonVisibility("Release",!1),this.SetButtonVisibility("ShowJV",!1),this.SetButtonVisibility("ReEvaluate",!1),this.SetButtonVisibility("PriceChart",!1),this.SetButtonVisibility("PostBills",!1),this.dtPayEmps=s.a.common.GetDataSet("PAY045","").Tables[0],67==this.ScreenObject.DocumentType&&(this.dtPayShifts=s.a.common.GetDataSet("PAY046","").Tables[0],this.dtOTTypes=s.a.common.GetDataSet("PAY047","").Tables[0]),40056!=this.ScreenObject.CostCenterID&&40057!=this.ScreenObject.CostCenterID&&40081!=this.ScreenObject.CostCenterID&&40061!=this.ScreenObject.CostCenterID&&40072!=this.ScreenObject.CostCenterID&&40065!=this.ScreenObject.CostCenterID&&73!=this.ScreenObject.DocumentType&&94!=this.ScreenObject.DocumentType&&97!=this.ScreenObject.DocumentType||(this.ScreenObject.GridDataObj.CanUserAddRows=!1,this.ScreenObject.GridDataObj.CanUserDeleteRows=!1),99==this.ScreenObject.DocumentType&&(this.ScreenObject.GridDataObj.Clear(),this.ScreenObject.GridDataObj.CanUserAddRows=!1,this.ScreenObject.GridDataObj.CanUserDeleteRows=!1),null!=r&&"IsFrmFS_LoanBal"==r.toString()&&(this.DisableRightPanel=!0,this.OKCancelVisibility=!0)),45==this.DocumentType){var P=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha15"==e.DisplayMember.toLowerCase()}));null!=P&&(P.FixedDateFormat=s.a.SessionManager.Preferences["Date Format"]+" hh:mm a"),null!=(P=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha16"==e.DisplayMember.toLowerCase()})))&&(P.FixedDateFormat=s.a.SessionManager.Preferences["Date Format"]+" hh:mm a"),null!=(P=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha22"==e.DisplayMember.toLowerCase()})))&&(P.FixedDateFormat=s.a.SessionManager.Preferences["Date Format"]+" hh:mm a"),null!=(P=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha23"==e.DisplayMember.toLowerCase()})))&&(P.FixedDateFormat=s.a.SessionManager.Preferences["Date Format"]+" hh:mm a")}this.ScreenObject.GridDataObj.IsDocument=!0,this.ScreenObject.GridDataObj.IsReadOnlyColor=!0,this.ScreenObject.GridDataObj.Height=this.ScreenObject.GridDataObj.Height+17,Logger.InfoLog("AddEditDocumentViewModel::Exiting AddEditDocumentViewModel")}}},{key:"GetViewOrganizationViewModel",value:function(e){return new $t.a(e)}},{key:"GetCasesContactViewModel",value:function(e,t){return new en.CasesContactViewModel(e,t)}},{key:"SetReportDim",value:function(){if(null!=this.ReportDimension&&this.ReportDimension.Visible&&null!=this.SelectedRow){if(null==this.SelectedRow)return;var e=this.GetColName();o.e.IsEmpty(this.SelectedRow[e])||(this.ReportDimension.SelectedValue=parseInt(this.SelectedRow[e].toString()),this.ReportDimension.IsAutoLoad&&(this.IsInventoryVoucher&&this.ScreenObject.GridDataColumns.Contains("ProductName")?this.ReportDimension.SelectedValueText=this.ReportDimension.Text=this.SelectedRow.ProductName.toString():this.IsInventoryVoucher&&this.ScreenObject.GridDataColumns.Contains("ProductCode")?this.ReportDimension.SelectedValueText=this.ReportDimension.Text=this.SelectedRow.ProductCode.toString():!this.IsInventoryVoucher&&this.ScreenObject.GridDataColumns.Contains("AccountCode")?this.ReportDimension.SelectedValueText=this.ReportDimension.Text=this.SelectedRow.AccountCode.toString():!this.IsInventoryVoucher&&this.ScreenObject.GridDataColumns.Contains("AccountName")&&(this.ReportDimension.SelectedValueText=this.ReportDimension.Text=this.SelectedRow.AccountName.toString())))}}},{key:"BatchPayment",value:function(){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,a,i,r,c,l,u,d,D,h=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.ScreenObject.Preferences.ContainsKey("batchpaymentreport")||""==this.ScreenObject.Preferences.batchpaymentreport||"0"==this.ScreenObject.Preferences.batchpaymentreport){e.next=13;break}return a=1,i=1,r=0,null!=this.Currency&&null!=this.Currency.Currency.SelectedValue&&""!=this.Currency.Currency.SelectedValue&&(a=parseInt(this.Currency.Currency.SelectedValue)),null!=this.Currency&&null!=this.Currency.ExchangeRate.Text&&""!=this.Currency.ExchangeRate.Text&&(i=parseFloat(this.Currency.ExchangeRate.Text)),e.next=5,Promise.all([n.e(2),n.e(1),n.e(3),n.e(5),n.e(4),n.e(6),n.e(7),n.e(10),n.e(9),n.e(8),n.e(12),n.e(11),n.e(13),n.e(19),n.e(15),n.e(21),n.e(20),n.e(16),n.e(14),n.e(18),n.e(17),n.e(22),n.e(23),n.e(24),n.e(25),n.e(28),n.e(30),n.e(29),n.e(32),n.e(31),n.e(27),n.e(26),n.e(35),n.e(37),n.e(38),n.e(36),n.e(33),n.e(34),n.e(39),n.e(40),n.e(41),n.e(212)]).then(n.bind(null,"ThYU"));case 5:return c=e.sent,l=c.ReportViewModel,e.next=9,Promise.all([n.e(32),n.e(37)]).then(n.bind(null,"YU11"));case 9:u=e.sent,d=u.ReportViewComponent,(D=new l).ReportViewModel_1(parseInt(this.ScreenObject.Preferences.batchpaymentreport)),D.DispayAsPopup=!0,D.ButtonSMS.Visible=D.ButtonPrint.Visible=D.ButtonExport.Visible=D.ButtonEmail.Visible=!1,D.ButtonPost.Visible=!0,D.ButtonPost.Label="Ok",s.a.page.ShowDialog(D,d,{HideHeader:!0}).subscribe((function(){var e=D.Data.filter((function(e){return e.IsSelected&&""!=e.DataRow.AccountName_ID}));if(e.sort((function(e,t){return e.DataRow.AccountName_ID-t.DataRow.AccountName_ID})),e.length>0){var n="";h.ScreenObject.GridDataObj.Clear();for(var c=null,l=null,u=function(u){if(u>0&&parseInt(e[u].DataRow.AccountName_ID.toString())!=parseInt(e[u-1].DataRow.AccountName_ID.toString())&&null!=l&&(l.AmtToAdjust.Text=r.ToString("N"+l.decimalpoints),l.NewReference.Text="0",h.ScreenObject.GridDataColumns.Contains("Amount")&&(c.Amount=r.ToString("N"+l.decimalpoints)),h.Celleditend(c,"DocSeqNo",0),l.OnSave("autosave"),c=null,l=null),null==c&&(r=0,(c=h.ScreenObject.GridDataObj.NewRow()).DebitAccount_Key=e[u].DataRow.AccountName_ID.toString(),h.SelectedRow=h.ScreenObject.GridData[h.ScreenObject.GridData.length-1],(l=new B).BillWiseViewModel_2(h,0,parseInt(e[u].DataRow.AccountName_ID.toString()),!1,a,i,!0,""),0)){if(t.iPayMode>0&&(null!=(m=h.ScreenObject.ColumnSource.find((function(e){return"CreditAccount"==e.DisplayMember})))&&null!=m&&(c.CreditAccount_Key=t.iPayMode.toString(),h.Celleditend(c,"CreditAccount",2,0)),null==m||null==m)&&null!=(S=h.ScreenObject._StaticFields.find((function(e){return"CreditAccount"==e.DBColumnName})))&&null!=S&&(S instanceof C.b?(S.SelectedValue=t.iPayMode,S.SelectedValueText=t.sPaymodeName,S.Text=t.sPaymodeName,h.ScreenObject.OnGetReference(S)):S instanceof p.a&&(S.Code.SelectedValueText=S.Code.Text=t.sPaymodeCode,S.Name.SelectedValueText=S.Name.Text=t.sPaymodeName,S.SelectedValue=t.iPayMode,h.ScreenObject.OnGetReference(S.Name))),""!=t.sChequeBook&&(null!=(m=h.ScreenObject.ColumnSource.find((function(e){return"ChequeBookNo"==e.ValueBinding})))&&null!=m&&(c.ChequeBookNo=t.sChequeBook),null==m||null==m)){var d=h.ScreenObject._StaticFields.find((function(e){return"ChequeBookNo"==e.DBColumnName}));null!=d&&null!=d&&(d.SelectedValue=t.sChequeBook)}if(""!=t.sChequeNo){if(h.ScreenObject.Preferences.ContainsKey("AutoChequeNo")&&"TRUE"==h.ScreenObject.Preferences.AutoChequeNo.toUpperCase()&&""!=n){var D=parseInt(n);t.sChequeNo=n.Replace(D.toString(),"")+(D+1)}if(null!=(m=h.ScreenObject.ColumnSource.find((function(e){return"ChequeNumber"==e.DisplayMember})))&&null!=m&&(c.ChequeNumber=t.sChequeNo),null==m||null==m){var y=h.ScreenObject._StaticFields.find((function(e){return"ChequeNumber"==e.DBColumnName}));null!=y&&(y.Text=t.sChequeNo)}n=t.sChequeNo}if(""!=t.sChequeDate&&(null!=(m=h.ScreenObject.ColumnSource.find((function(e){return"ChequeDate"==e.DisplayMember})))&&null!=m&&(c.ChequeDate=new Date(t.sChequeDate).ToString(s.a.SessionManager.Preferences["Date Format"]),c.ChequeDate_Key=new Date(t.sChequeDate)),null==m||null==m)){var g=h.ScreenObject._StaticFields.find((function(e){return"ChequeDate"==e.DBColumnName}));null!=g&&(g.Date=new Date(t.sChequeDate))}}if(null!=l&&(b=l.GridData.filter((function(t){return t.DocNo==e[u].DataRow.DocNo.toString()&&t.DocSeqNo==e[u].DataRow.DocSeqNo.toString()}))).length>0&&!o.e.IsEmpty(b[0].Due)){b[0].AmountPaidLC=b[0].Due;var f=0,O=0;o.e.IsEmpty(b[0].CurrID)||parseInt(b[0].CurrID.toString())!=a||""==b[0].ExchgRate.toString()||parseFloat(b[0].ExchgRate.toString())==i?O=parseFloat(b[0].AmountPaidLC.toString())/i:(O=parseFloat(b[0].AmountPaidLC.toString())/parseFloat(b[0].ExchgRate.toString()),f=parseFloat(b[0].AmountPaid.toString())*(parseFloat(b[0].ExchgRate.toString())-i)),b[0].AmountPaid=O.ToString("N"+l.decimalpoints),b[0].exchgl=f,l.PaidChange("AmountPaid",b[0],!1),r+=O}},d=0;d<e.length;d++){var S,m,b;u(d)}null!=l&&(l.AmtToAdjust.Text=r.ToString("N"+l.decimalpoints),l.NewReference.Text="0",h.ScreenObject.GridDataColumns.Contains("Amount")&&(c.Amount=r.ToString("N"+l.decimalpoints)),h.Celleditend(c,"DocSeqNo",0),l.OnSave("autosave"),h.ScreenObject.GridDataObj.addRow(c),h.ScreenObject.UpdateSequence(),h.RefreshGrid=!0)}}));case 13:case"end":return e.stop()}}),e,this)})))}},{key:"FillGridData",value:function(e){if(null!=e&&e.length>0){var t;this.ScreenObject.GridDataObj.Clear();for(var n=0;n<e.length;n++){t=this.ScreenObject.GridDataObj.NewRow();for(var a=0;a<Object.keys(e[0]).length;a++)t[Object.keys(e[0])[a]]=e[n][Object.keys(e[0])[a]];this.ScreenObject.GridData.push(t)}this.ScreenObject.GridDataObj.refreshDataView()}}},{key:"CheckListViews",value:function(){var e=this;if(!o.e.IsEmpty(s.a.SessionManager.config.ListViewCache))for(var t=s.a.SessionManager.config.ListViewCache.split(","),n=function(n){if("LISTBOX"==e.ScreenObject.ColumnSource[n].DataType&&null!=s.a.SessionManager.ListViewDef){var a;a=e.ScreenObject.ColumnSource[n].TypeID>0?e.ScreenObject.ColumnSource[n].TypeID:1;var i=s.a.SessionManager.ListViewDef.Tables[0].filter((function(t){return t.CostCenterID==e.ScreenObject.ColumnSource[n].CostCenterID&&t.ListViewTypeID==a}));if(i.length>0&&t.Contains(i[0].ListViewID.toString())&&s.a.SessionManager.ListViewCache&&s.a.SessionManager.ListViewCache.ContainsKey(parseInt(i[0].ListViewID)))return"continue"}},a=0;a<this.ScreenObject.ColumnSource.length;a++)n(a)}},{key:"DimensionSelectedvalueData",value:function(){var e=this,t=0;if(73!=this.ScreenObject.DocumentType)if(94!=this.ScreenObject.DocumentType){var n=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));if(61==this.ScreenObject.DocumentType&&(n=this.ScreenObject._CCFields.find((function(e){return"dcccnid53"==e.DBColumnName.toLowerCase()}))),(n&&n instanceof C.b&&n.SelectedValue>0||n&&n instanceof p.a&&n.SelectedValue>0)&&(t=n.SelectedValue),t>0)if(56==this.ScreenObject.DocumentType){if(s.a.SessionManager.Preferences.ContainsKey("DonotAllowApplyLoanDuringProbationPeriod")&&Object(l.j)(s.a.SessionManager.Preferences.DonotAllowApplyLoanDuringProbationPeriod)){var a=s.a.common.GetDataSet3("PAY035",this.ScreenObject.DocDate.Date.ToString("dd/MMM/yyyy"),t.toString()).Tables[0];if(null!=a&&a.length>0&&null!=a[0].Valid&&null!=a[0].Valid&&"1"==a[0].Valid.toString())return void(this.DisplayMessage="Employee is in probation period, can not apply the Loan")}}else if(69==this.ScreenObject.DocumentType){var i=s.a.common.GetDataSet3("PAY036",this.DocID.toString(),t.toString()).Tables[0];if(null!=i&&i.length>0)return void(this.DisplayMessage="Employee Resignation document already exists, Check Document @ "+i[0].VoucherNo.toString())}else if(58==this.ScreenObject.DocumentType)this.dsData=this.ScreenObject.GetEmployeePayrollInfo(t,0,this.ScreenObject.DocDate.Date,0),this.dsData.Tables.length<0&&(this.DisplayMessage="No Employee record found");else if(61==this.ScreenObject.DocumentType){if(this.dsData=this.ScreenObject.GetPayrollComponents(4,t,0,this.ScreenObject.DocDate.Date),this.dsData.Tables.length>0)if(this.dsData.Tables[0].length<=0)this.DisplayMessage="No record found";else if(this.dsData.Tables[0].length>0){this.DisplayMessage="",this.MessageVisibility=!1;var r=null,c=0;r=null,this.ScreenObject.GridDataObj.Clear();for(var u=this.ScreenObject.Data.Tables[0].filter((function(e){return"ProductID"==e.SysColumnName})),d=0;d<this.dsData.Tables[0].length;d++)r=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridData.InsertAt(r,c),c++,u.length>0&&!o.e.IsEmpty(u[0].UserDefaultValue)&&(r.ProductID_Key=u[0].UserDefaultValue),r.dcAlpha17=this.dsData.Tables[0][d].NODEID,r.dcNum1=this.dsData.Tables[0][d].PERCENTAGE;this.ScreenObject.GridDataObj.refreshDataView()}}else if(65==this.ScreenObject.DocumentType){this.ScreenObject.GridDataObj.Clear();var D=0,h=this.ScreenObject._CCFields.find((function(e){return"dcccnid52"==e.DBColumnName.toLowerCase()}));if(h instanceof C.b&&(D=h.SelectedValue),t>1&&D>0&&(this.dsData=this.ScreenObject.GetEmployeePayrollInfo(t,2,this.ScreenObject.DocDate.Date,D),this.dsData.Tables.length>0))if(this.dsData.Tables[0].length<=0)this.DisplayMessage="Employee Vacation/Leave Details Not Found";else if(this.dsData.Tables[0].length>0){this.DisplayMessage="",this.MessageVisibility=!1;var S=null,b=0;S=null;for(var y=this.ScreenObject.Data.Tables[0].filter((function(e){return"ProductID"==e.SysColumnName})),g=0;g<this.dsData.Tables[0].length;g++)S=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridData.InsertAt(S,b),b++,y.length>0&&!o.e.IsEmpty(y[0].UserDefaultValue)&&(S.ProductID_Key=y[0].UserDefaultValue),S.dcAlpha1=new Date(this.dsData.Tables[0][g].FROMDATE).ToString(s.a.SessionManager.Preferences["Date Format"]),S.dcAlpha1_Key=new Date(this.dsData.Tables[0][g].FROMDATE),S.dcAlpha2=new Date(this.dsData.Tables[0][g].TODATE).ToString(s.a.SessionManager.Preferences["Date Format"]),S.dcAlpha2_Key=new Date(this.dsData.Tables[0][g].TODATE),S.dcAlpha5=parseFloat(this.dsData.Tables[0][g].DOCID),S.LinkedInvDocDetailsID=parseFloat(this.dsData.Tables[0][g].InvDocDetailsID);this.ScreenObject.GridDataObj.refreshDataView()}}else if(71==this.ScreenObject.DocumentType){var f=this.ScreenObject._TextFields.find((function(e){return"dcAlpha1"==e.DBColumnName.toString()}));if(this.dsData=this.ScreenObject.GetEmployeePayrollInfo(t,1,f?new Date(f.Date):this.ScreenObject.DocDate.Date,0),this.dsData.Tables.length>0&&this.dsData.Tables[0].length>0)if(parseInt(this.dsData.Tables[0][0].VALIDEMP)<=0)this.DisplayMessage="Employee is not valid for the current fiscal year period",this.ReadOnlyBody=!0,this.PostSalaryDocResetColumns(),this.FillEarnDeductDetails(1,f?parseInt(new Date(f.Date).ToString("yyyy")):parseInt(this.ScreenObject.DocDate.Date.ToString("yyyy")));else{this.DisplayMessage="",this.MessageVisibility=!1,this.ReadOnlyBody=!1,this.SetMonthNames(f?parseInt(new Date(f.Date).ToString("yyyy")):parseInt(this.ScreenObject.DocDate.Date.ToString("yyyy"))),this.SetNoofMonths(this.dsData);var O=null,I=0,T=this.ScreenObject.GetPayrollComponents(2,1,t,this.ScreenObject.DocDate.Date);if(T.Tables[0].sort((function(e,t){return e.ParentID-t.ParentID})),T.Tables.length>0&&T.Tables[0].length>0){O=null,this.ScreenObject.GridDataObj.Clear();for(var j=this.ScreenObject.Data.Tables[0].filter((function(e){return"ProductID"==e.SysColumnName})),P=0;P<T.Tables[0].length;P++)O=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridData.InsertAt(O,I),I++,j.length>0&&!o.e.IsEmpty(j[0].UserDefaultValue)&&(O.ProductID_Key=j[0].UserDefaultValue),O.dcAlpha2=T.Tables[0][P].NODEID,O.dcAlpha15=2==parseInt(T.Tables[0][P].ParentID)?"Earnings":"Deductions";this.ScreenObject.GridDataObj.refreshDataView()}}}else if(72==this.ScreenObject.DocumentType)this.ShowVacationCreditDaysDetail(t);else if(78==this.ScreenObject.DocumentType){var A,M=this.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()}));if(!(M instanceof m.e)||o.e.IsEmpty(M.SelectedValue))return void(this.DisplayMessage="Please select the year");A=parseInt(M.SelectedValue),this.FillTdsMonthlyandQuarterlyDetails(0,this._Ddate,t,A)}else if(68==this.ScreenObject.DocumentType){var v=[],G=this.ScreenObject._TextFields.find((function(e){return"dcAlpha2"==e.DBColumnName.toString()}));if(G&&(this.dsData=this.ScreenObject.GetPayrollComponents(0,1,t,new Date(G.Date))),this.dsData.Tables.length>0){var N=this.ScreenObject.ColumnSource.find((function(e){return"dcAlpha1"==e.ValueBinding}));if(N&&this.dsData.Tables[0].length>0){for(var E=0;E<=this.dsData.Tables[0].length-1;E++)v.push(m.d.ComboBoxItems_2(this.dsData.Tables[0][E].NAME.toString(),this.dsData.Tables[0][E].NODEID.toString()));N.DisplayMember="Name",N.ValueMember="Value",N.ComboData=v}var w=this.ScreenObject.ColumnSource.find((function(e){return"dcAlpha3"==e.ValueBinding}));w&&(w.DisplayMember="NAME",w.ValueMember="NODEID",w.ComboData=this.dsData.Tables[1],w.FilterColumn="dcAlpha1",w.FilterCondition="PARENTID={0}")}}else if(80==this.ScreenObject.DocumentType){var F=[];if(this.dsData=this.ScreenObject.GetPayrollComponents(7,0,t,this.ScreenObject.DocDate.Date),this.dsData.Tables.length>0){var V=this.ScreenObject.ColumnSource.find((function(e){return"dcAlpha1"==e.ValueBinding}));if(V&&this.dsData.Tables[0].length>0){for(var L=0;L<=this.dsData.Tables[0].length-1;L++)F.push(m.d.ComboBoxItems_2(this.dsData.Tables[0][L].NAME.toString(),this.dsData.Tables[0][L].NODEID.toString()));V.DisplayMember="Name",V.ValueMember="Value",V.ComboData=F}var R=this.ScreenObject.ColumnSource.find((function(e){return"dcAlpha2"==e.ValueBinding}));R&&(R.DisplayMember="NAME",R.ValueMember="NODEID",R.ComboData=this.dsData.Tables[1],R.FilterColumn="dcAlpha1",R.FilterCondition="PARENTID={0}")}}}else{this.ScreenObject.GridDataObj.Clear();var B=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));if((B&&B instanceof C.b&&B.SelectedValue>0||B&&B instanceof p.a&&B.SelectedValue>0)&&(t=B.SelectedValue),0==t)return void(this.DisplayMessage="Please select the employee");if((B=this.ScreenObject._CCFields.find((function(e){return"dcccnid52"==e.DBColumnName.toLowerCase()})))&&B instanceof C.b&&B.SelectedValue>0){var x=0;if(this.dsData=this.GetLOPLeaveDocuments(t,B.SelectedValue,this.DocumentDate),null!=this.dsData&&this.dsData.Tables.length>0){if(this.dsData.Tables[0].length>0&&this.dsData.Columns[0].Contains("ErrorMessage"))return void(this.DisplayMessage=this.dsData.Tables[0][0].ErrorMessage.toString());this.dsData.Tables[0].length>0&&function(){var t="",n=0,a=null,i=0;a=null;for(var r=e.ScreenObject.Data.Tables[0].filter((function(e){return"ProductID"==e.SysColumnName})),s=0;s<e.dsData.Tables[0].length;s++){t=e.dsData.Tables[0][s].VoucherNo.toString(),n=parseFloat(e.dsData.Tables[0][s].NoOfDays);var c=o.e.DTComputeSUM(e.dsData.Tables[1].filter((function(e){return e.LOPLeaveDocVoucherNo==t})),"CurAdjDays",!1);c<n&&(a=e.ScreenObject.GridDataObj.NewRow(),e.ScreenObject.GridData.InsertAt(a,i),i++,r.length>0&&!o.e.IsEmpty(r[0].UserDefaultValue)&&(a.ProductID_Key=r[0].UserDefaultValue),a.dcAlpha1=e.dsData.Tables[0][s].VoucherNo,a.dcAlpha2=new Date(e.dsData.Tables[0][s].FROMDATE).ToString("dd-MMM-yyyy"),a.dcAlpha2_Key=new Date(e.dsData.Tables[0][s].FROMDATE).ToString("dd-MMM-yyyy"),a.dcAlpha3=new Date(e.dsData.Tables[0][s].TODATE).ToString("dd-MMM-yyyy"),a.dcAlpha3_Key=new Date(e.dsData.Tables[0][s].TODATE).ToString("dd-MMM-yyyy"),a.dcAlpha4=e.dsData.Tables[0][s].NOOFDAYS,a.dcAlpha5="false",a.dcAlpha6=c.toString(),x++)}e.ScreenObject.GridDataObj.refreshDataView()}()}0==x&&(this.ScreenObject.GridDataObj.Clear(),this.DisplayMessage="No record found")}}else{var k=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));if((k&&k instanceof C.b&&k.SelectedValue>0||k&&k instanceof p.a&&k.SelectedValue>0)&&(t=k.SelectedValue),0==t)return void(this.DisplayMessage="Please select the employee");if((k=this.ScreenObject._CCFields.find((function(e){return"dcccnid52"==e.DBColumnName.toLowerCase()})))&&k instanceof C.b&&k.SelectedValue>0&&(this.dsData=this.ScreenObject.GetAdjustmentLeaves(0,t,k.SelectedValue,this.DocID),this.dsData.Tables.length>0))if(this.dsData.Tables[0].length<=0)this.ScreenObject.GridDataObj.Clear(),this.DisplayMessage="No record found";else if(this.dsData.Tables[0].length>0){this.DisplayMessage="",this.MessageVisibility=!1;var _=null,K=0;_=null,this.ScreenObject.GridDataObj.Clear();for(var Q=this.ScreenObject.Data.Tables[0].filter((function(e){return"ProductID"==e.SysColumnName})),H=0;H<this.dsData.Tables[0].length;H++)_=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridData.InsertAt(_,K),K++,Q.length>0&&!o.e.IsEmpty(Q[0].UserDefaultValue)&&(_.ProductID_Key=Q[0].UserDefaultValue),_.dcAlpha1=this.dsData.Tables[0][H].VoucherNo,_.dcAlpha2=new Date(this.dsData.Tables[0][H].FROMDATE).ToString("dd-MMM-yyyy"),_.dcAlpha2_Key=new Date(this.dsData.Tables[0][H].FROMDATE).ToString("dd-MMM-yyyy"),_.dcAlpha3=new Date(this.dsData.Tables[0][H].TODATE).ToString("dd-MMM-yyyy"),_.dcAlpha3_Key=new Date(this.dsData.Tables[0][H].TODATE).ToString("dd-MMM-yyyy"),_.dcNum1=this.dsData.Tables[0][H].NOOFDAYS,_.dcAlpha4="No",_.dcAlpha5=this.dsData.Tables[0][H].DocSeqNo;this.dsData.Tables[0].length>0&&this.ScreenObject.GridDataObj.refreshDataView()}}}},{key:"ApplyVacationValidationMsg",value:function(e){var t="";if(e.Tables[0].length>0&&!o.e.IsEmpty(e.Tables[0][0].VacationdaysMessage)&&(t=e.Tables[0][0].VacationdaysMessage.toString()+" \r\n"),e.Tables[1].length>0&&!o.e.IsEmpty(e.Tables[1][0].VacationPreferencesMessage))t=t+e.Tables[1][0].VacationPreferencesMessage.toString()+" \r\n";else if(e.Tables[1].length>0&&parseInt(e.Tables[1][0].VacationField)>0&&o.e.IsEmpty(e.Tables[1][0].VacationPreferencesMessage)){var n=this.ScreenObject._CCFields.find((function(e){return"dcccnid52"==e.DBColumnName.toLowerCase()}));n&&n instanceof C.b&&(n.SelectedValue=parseInt(e.Tables[1][0].VacationField))}return e.Tables[2].length>0&&!o.e.IsEmpty(e.Tables[2][0].VacationMessage)&&(t=t+e.Tables[2][0].VacationMessage.toString()+" \r\n"),e.Tables[7].length>0&&!o.e.IsEmpty(e.Tables[7][0].VacationUnderApprovalMessage)&&(t=t+e.Tables[7][0].VacationUnderApprovalMessage.toString()+" \r\n"),t}},{key:"ConsolidateLeaveMonth",value:function(){if(63==this.ScreenObject.DocumentType){var e=this.ScreenObject._TextFields.find((function(e){return"dcAlpha1"==e.DBColumnName.toString()}));e instanceof S.c&&(e.Date=new Date,e.CustomFormat="MMM/yyyy")}else if(89==this.ScreenObject.DocumentType||90==this.ScreenObject.DocumentType){var t=this.ScreenObject._TextFields.find((function(e){return"dcalpha32"==e.DBColumnName.toLowerCase()}));t instanceof m.e&&("Manual"==t.SelectedValue?(this.ScreenObject._TextFields.forEach((function(e){"dcalpha26"==e.DBColumnName.toLowerCase()?e.IsReadOnly=!0:"dcalpha27"==e.DBColumnName.toLowerCase()&&(e.Enable=!1)})),this.SetButtonVisibility("Save",!0),this.SetButtonVisibility("SaveAndPrint",!0),this.SetButtonVisibility("Check-in",!1),this.SetButtonVisibility("Check-out",!1)):(this.ScreenObject._TextFields.forEach((function(e){"dcalpha26"==e.DBColumnName.toLowerCase()?e.IsReadOnly=!1:"dcalpha27"==e.DBColumnName.toLowerCase()&&(e.Enable=!0)})),this.SetButtonVisibility("Save",!1),this.SetButtonVisibility("SaveAndPrint",!1),this.SetButtonVisibility("Check-in",!0),this.SetButtonVisibility("Check-out",!0)))}else if(56==this.ScreenObject.DocumentType){var n=this.ScreenObject._TextFields.find((function(e){return"dcAlpha5"==e.DBColumnName.toString()}));n instanceof S.c&&(n.Date=new Date((new Date).getFullYear(),(new Date).getMonth(),1),n.CustomFormat="MMM/yyyy")}else if(69==this.ScreenObject.DocumentType||86==this.ScreenObject.DocumentType||91==this.ScreenObject.DocumentType||98==this.ScreenObject.DocumentType)this.BodyVisible=!1;else if(92==this.ScreenObject.DocumentType){var a=this.ScreenObject._TextFields.find((function(e){return"dcalpha4"==e.DBColumnName.toLowerCase()}));a&&(a.IsReadOnly=this.DocID>0),this.iDtColFrom=this.iDtColUpto=-1;var i=this.ScreenObject.CustomTab.Pages[0].Fields.find((function(e){return e instanceof S.c&&"dcAlpha1"==e.DBColumnName})),r=this.ScreenObject.CustomTab.Pages[0].Fields.find((function(e){return e instanceof S.c&&"dcAlpha2"==e.DBColumnName}));i.Enable=r.Enable=!(this.ScreenObject.DocID>0);for(var s=this.ScreenObject.ColumnSource.length-1;s>=0;s--)null!=this.ScreenObject.ColumnSource[s].DrRefColName&&""!=this.ScreenObject.ColumnSource[s].DrRefColName&&"Date"==this.ScreenObject.ColumnSource[s].DrRefColName&&(this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.ColumnSource[s].DisplayMember)&&this.ScreenObject.GridDataColumns.Remove(this.ScreenObject.ColumnSource[s].DisplayMember),this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.ColumnSource[s].DisplayMember+"_Key")&&this.ScreenObject.GridDataColumns.Remove(this.ScreenObject.ColumnSource[s].DisplayMember+"_Key"),this.ScreenObject.ColumnSource.RemoveAt(s));for(var o=[],c=0;c<this.ScreenObject.ColumnSource.length;c++)o.push(this.ScreenObject.ColumnSource[c]);this.ScreenObject.ColumnSource=o,this.ScreenObject.GridDataObj.RefreshColumns()}else if(68==this.ScreenObject.DocumentType){var l=this.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()}));null!=l&&null!=l&&(l.IsReadOnly=!1)}}},{key:"SetNewDocFields",value:function(){var e=this;if(58!=this.ScreenObject.DocumentType&&65!=this.ScreenObject.DocumentType&&71!=this.ScreenObject.DocumentType&&72!=this.ScreenObject.DocumentType&&78!=this.ScreenObject.DocumentType&&68!=this.ScreenObject.DocumentType&&80!=this.ScreenObject.DocumentType||this.ScreenObject._CCFields.forEach((function(t){if(t instanceof C.b&&t.OnPactListBoxValueChanged.Subscribe(e.ScreenObject,"OnGetReference"),72==e.ScreenObject.DocumentType){e.ReportInfoVisibility=!(e.ScreenObject.Preferences.ContainsKey("ShowVacationCreditDaysDetail")&&!o.e.IsEmpty(e.ScreenObject.Preferences.ShowVacationCreditDaysDetail)&&Object(l.j)(e.ScreenObject.Preferences.ShowVacationCreditDaysDetail));var n=e.ScreenObject._TextFields.find((function(e){return"dcAlpha25"==e.DBColumnName.toString()}));n&&(n.CustomFormat="MMM/yyyy",n.Date=(new Date).MonthsFirst()),e.ScreenObject._TextFields.forEach((function(e){})),e.FillEarningsDeductions(0,e.ScreenObject.DocDate.Date),e.ShowVacationCreditDaysDetail(0)}})),61==this.ScreenObject.DocumentType)this.ScreenObject._CCFields.forEach((function(t){t instanceof C.b&&"dcccnid53"==t.DBColumnName.toLowerCase()&&t.OnPactListBoxValueChanged.Subscribe(e.ScreenObject,"OnGetReference")})),this.ScreenObject._TextFields.forEach((function(e){e instanceof C.b&&"dcalpha1"==e.DBColumnName.toLowerCase()&&e.OnPactListBoxValueChanged.UnSubscribe(),e instanceof C.b&&"dcalpha5"==e.DBColumnName.toLowerCase()&&e.OnPactListBoxValueChanged.UnSubscribe()})),this.FillVacationManagementComponents();else if(67==this.ScreenObject.DocumentType){var t=s.a.common.GetDataSet("PAY037",this.ScreenObject.CostCenterID.toString());if(null!=t&&0==t.Tables[0].length)return this.DisplayMessage="Please Enable Payroll Document Fields from Global Preferences (Payroll Tab)",void(this.ReadOnlyBody=!0);var n=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));if((n instanceof C.b||n instanceof p.a)&&(n.KeyTip="",this.GetButton("All Employees").Visible=!1,this.GetButton("Get Previous Day").Visible=!1,this.GetButton("Fill Dates").Visible=!0,this.GetButton("Fill General Timings").Visible=!0),null!=this.ScreenObject.ColumnSource.find((function(e){return"dcccnid51"==e.DisplayMember.toLowerCase()}))&&(this.GetButton("All Employees").Visible=!0,this.GetButton("Get Previous Day").Visible=!0,this.GetButton("Fill Dates").Visible=!1,this.GetButton("Fill General Timings").Visible=!1),(n=this.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()})))instanceof S.c&&(n.KeyTip=""),s.a.SessionManager.Preferences.ContainsKey("BreakHoursImpactToOTS")&&Object(l.j)("True"==s.a.SessionManager.Preferences.BreakHoursImpactToOTS)){var a=this.ScreenObject.ColumnSource.find((function(e){return"dcNum4"==e.DisplayMember}));a&&(a.ReadOnly=!1)}if(s.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")&&Object(l.j)("True"==s.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)){var i=this.ScreenObject.ColumnSource.find((function(e){return"dcNum4"==e.DisplayMember}));i&&(i.ReadOnly=!1);var r=this.ScreenObject.ColumnSource.find((function(e){return"dcNum5"==e.DisplayMember}));r&&(r.ReadOnly=!1);var c=this.ScreenObject.ColumnSource.find((function(e){return"dcNum7"==e.DisplayMember}));c&&(c.ReadOnly=!1);var u=this.ScreenObject.ColumnSource.find((function(e){return"dcNum9"==e.DisplayMember}));u&&(u.ReadOnly=!1);var d=this.ScreenObject.ColumnSource.find((function(e){return"dcNum11"==e.DisplayMember}));d&&(d.ReadOnly=!1);var D=this.ScreenObject.ColumnSource.find((function(e){return"dcNum13"==e.DisplayMember}));D&&(D.ReadOnly=!1)}this.GetButton("Employee Filter").Visible=!0,this.GetButton("Set Columns").Visible=!0}else if(68==this.ScreenObject.DocumentType){var h=this.ScreenObject._TextFields.find((function(e){return"dcAlpha2"==e.DBColumnName.toString()}));null!=h&&(h.Date=new Date(s.a.SessionManager.PayrollMonth),h.CustomFormat="MMM/yyyy"),null!=(h=this.ScreenObject._TextFields.find((function(e){return"dcAlpha4"==e.DBColumnName.toString()})))&&(h.Date=new Date(s.a.SessionManager.PayrollMonth),h.CustomFormat="MMM/yyyy");var b=[];if(this.dsData=this.ScreenObject.GetPayrollComponents(0,1,0,new Date(s.a.SessionManager.PayrollMonth)),this.dsData.Tables.length>0){var y=this.ScreenObject.ColumnSource.find((function(e){return"dcAlpha1"==e.ValueBinding}));if(y&&this.dsData.Tables[0].length>0){var g=null;g=this.dsData.Tables[0];var O=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName==y.ValueBinding}));if(null!=O&&O.length>0&&!o.e.IsEmpty(O[0].UserProbableValues)&&""!=O[0].UserProbableValues.toString().Trim()&&(g=g.filter((function(e){return e.NodeID==O[0].UserProbableValues}))),g.length>0){for(var I=0;I<=g.length-1;I++)b.push(m.d.ComboBoxItems_2(g[I].NAME.toString(),g[I].NODEID.toString()));y.DisplayMember="Name",y.ValueMember="Value",y.ComboData=b}}var T=this.ScreenObject.ColumnSource.find((function(e){return"dcAlpha3"==e.ValueBinding}));if(T){T.DisplayMember="NAME",T.ValueMember="NODEID",T.ComboData=this.dsData.Tables[1],T.FilterColumn="dcAlpha1",T.FilterCondition="PARENTID={0}";var j=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName==T.ValueBinding}));null!=j&&j.length>0&&!o.e.IsEmpty(j[0].UserProbableValues)&&""!=j[0].UserProbableValues.toString().Trim()&&(T.FilterCondition+=" AND NodeID IN("+j[0].UserProbableValues+")")}}}else if(86==this.ScreenObject.DocumentType){var P=this.ScreenObject._TextFields.find((function(e){return"dcAlpha2"==e.DBColumnName.toString()}));P instanceof S.b&&(P.CustomFormat="HH:mm",P.Date=new Date),(P=this.ScreenObject._TextFields.find((function(e){return"dcAlpha3"==e.DBColumnName.toString()})))instanceof S.b&&(P.CustomFormat="HH:mm",P.Date=new Date);var A=this.ScreenObject._TextFields.find((function(e){return"dcAlpha3"==e.DBColumnName.toString()}));A&&this.onDateChanged(A)}else if(85==this.ScreenObject.DocumentType){var M=this.ScreenObject._TextFields.find((function(e){return"dcAlpha1"==e.DBColumnName.toString()}));M&&(M.CustomFormat="MMM/yyyy",M.Date=new Date((new Date).getFullYear(),(new Date).getMonth(),1)),(M=this.ScreenObject._TextFields.find((function(e){return"dcAlpha2"==e.DBColumnName.toString()})))&&(M.CustomFormat="MMM/yyyy",M.Date=new Date((new Date).getFullYear(),(new Date).getMonth(),1)),(M=this.ScreenObject._TextFields.find((function(e){return"dcAlpha4"==e.DBColumnName.toString()})))&&(M.CustomFormat="MMM/yyyy",M.Date=new Date((new Date).getFullYear(),(new Date).getMonth(),1));var v=this.GetButton("Employee Filter");v&&(v.Visible=!0)}else if(58==this.ScreenObject.DocumentType){var G=this.ScreenObject._TextFields.find((function(e){return"dcAlpha10"==e.DBColumnName.toString()}));G&&(G.CustomFormat="MMM/yyyy",G.Date=new Date((new Date).getFullYear(),(new Date).getMonth(),1))}else if(79==this.ScreenObject.DocumentType){var N=this.ScreenObject._TextFields.find((function(e){return"dcAlpha1"==e.DBColumnName.toString()}));N&&(N.Date=new Date((new Date).getFullYear(),(new Date).getMonth(),1))}else if(70==this.ScreenObject.DocumentType){if(s.a.SessionManager.Preferences.ContainsKey("EmpChecklistDimension")&&("0"==s.a.SessionManager.Preferences.EmpChecklistDimension.toString()||""==s.a.SessionManager.Preferences.EmpChecklistDimension.toString()))return void(this.DisplayMessage="Please set the Checklist Preference");this.ScreenObject.ColumnSource.forEach((function(e){null!=e.DisplayMember&&""!=e.DisplayMember&&e.DisplayMember.toLowerCase().Contains("dcalpha")&&"DATE"==e.DataType&&(e.DefaultValue="today")}));var E=[];if(this.dsData=this.ScreenObject.GetPayrollComponents(1,0,0,this.ScreenObject.DocDate.Date),this.dsData.Tables.length>0){var w=this.ScreenObject.ColumnSource.find((function(e){return"dcAlpha3"==e.ValueBinding}));if(w&&this.dsData.Tables[0].length>0){for(var F=0;F<=this.dsData.Tables[0].length-1;F++)E.push(m.d.ComboBoxItems_2(this.dsData.Tables[0][F].NAME.toString(),this.dsData.Tables[0][F].NODEID.toString()));w.DisplayMember="NAME",w.ValueMember="NODEID",w.ComboData=this.dsData.Tables[0]}var V=this.ScreenObject.ColumnSource.find((function(e){return"dcAlpha1"==e.ValueBinding}));V&&(V.DisplayMember="NAME",V.ValueMember="NODEID",V.ComboData=this.dsData.Tables[1],V.FilterColumn="dcAlpha3",V.FilterCondition="PARENTID={0}")}}else if(71==this.ScreenObject.DocumentType){var L=this.ScreenObject._TextFields.find((function(e){return"dcAlpha1"==e.DBColumnName.toString()}));L&&L instanceof S.c&&L.SelectedDateChanged.Subscribe(this,"FillPostPastSalEarningDeductionDtls"),this.FillEarnDeductDetails(0,parseInt(new Date(this.ScreenObject.DocDate.Date).ToString("yyyy")))}else if(73==this.ScreenObject.DocumentType)this.ScreenObject._CCFields.forEach((function(t){t instanceof C.b&&"dcccnid51"==t.DBColumnName.toLowerCase()&&t.OnPactListBoxValueChanged.Subscribe(e.ScreenObject,"OnGetReference"),t instanceof C.b&&"dcccnid52"==t.DBColumnName.toLowerCase()&&t.OnPactListBoxValueChanged.Subscribe(e.ScreenObject,"OnGetReference")}));else if(94==this.ScreenObject.DocumentType)this.ScreenObject._CCFields.forEach((function(t){t instanceof C.b&&"dcccnid51"==t.DBColumnName.toLowerCase()&&t.OnPactListBoxValueChanged.Subscribe(e.ScreenObject,"OnGetReference"),t instanceof C.b&&"dcccnid52"==t.DBColumnName.toLowerCase()&&t.OnPactListBoxValueChanged.Subscribe(e.ScreenObject,"OnGetReference")}));else if(75==this.ScreenObject.DocumentType)this.FillGratuitySettingsExpDetails();else if(76==this.ScreenObject.DocumentType)this.FillForm12BALookupDetails();else if(77==this.ScreenObject.DocumentType)this.FillPayrollLockUnlockDetails(!1);else if(81==this.ScreenObject.DocumentType||this.IsNewAssignLeave)this.ScreenObject._TextFields.forEach((function(t){t instanceof m.e&&"dcalpha1"==t.DBColumnName.toLowerCase()&&t.SelectionChangedCommand.Subscribe(e,"LeavesBasedon")}));else if(59==this.ScreenObject.DocumentType)s.a.SessionManager.Preferences.ContainsKey("CompensatoryLeaveType")&&""==s.a.SessionManager.Preferences.CompensatoryLeaveType.toString()&&(this.DisplayMessage="Please set the compensatory leave type preference");else if(80==this.ScreenObject.DocumentType){var R=[];if(this.dsData=this.ScreenObject.GetPayrollComponents(7,1,0,this.ScreenObject.DocDate.Date),this.dsData.Tables.length>0){var B=this.ScreenObject.ColumnSource.find((function(e){return"dcAlpha1"==e.ValueBinding}));if(B&&this.dsData.Tables[0].length>0){for(var x=0;x<=this.dsData.Tables[0].length-1;x++)R.push(m.d.ComboBoxItems_2(this.dsData.Tables[0][x].NAME.toString(),this.dsData.Tables[0][x].NODEID.toString()));B.DisplayMember="Name",B.ValueMember="Value",B.ComboData=R}var k=this.ScreenObject.ColumnSource.find((function(e){return"dcAlpha2"==e.ValueBinding}));k&&(k.DisplayMember="NAME",k.ValueMember="NODEID",k.ComboData=this.dsData.Tables[1],k.FilterColumn="dcAlpha1",k.FilterCondition="PARENTID={0}")}}if(this.DialogResult&&(51==this.ScreenObject.DocumentType||52==this.ScreenObject.DocumentType||53==this.ScreenObject.DocumentType||55==this.ScreenObject.DocumentType||56==this.ScreenObject.DocumentType||57==this.ScreenObject.DocumentType||58==this.ScreenObject.DocumentType||59==this.ScreenObject.DocumentType||60==this.ScreenObject.DocumentType||61==this.ScreenObject.DocumentType||62==this.ScreenObject.DocumentType||63==this.ScreenObject.DocumentType||65==this.ScreenObject.DocumentType||66==this.ScreenObject.DocumentType||67==this.ScreenObject.DocumentType||68==this.ScreenObject.DocumentType||69==this.ScreenObject.DocumentType||70==this.ScreenObject.DocumentType||71==this.ScreenObject.DocumentType||72==this.ScreenObject.DocumentType||73==this.ScreenObject.DocumentType||74==this.ScreenObject.DocumentType||75==this.ScreenObject.DocumentType||76==this.ScreenObject.DocumentType||77==this.ScreenObject.DocumentType||78==this.ScreenObject.DocumentType||80==this.ScreenObject.DocumentType||85==this.ScreenObject.DocumentType||86==this.ScreenObject.DocumentType||97==this.ScreenObject.DocumentType||79==this.ScreenObject.DocumentType||91==this.ScreenObject.DocumentType||92==this.ScreenObject.DocumentType)){var _="";if(67==this.ScreenObject.DocumentType){var K=!0;this.srcDocument&&"PostAttTimeSheet"==this.srcDocument.toString()&&(K=!1),K?this.strEmpFilter=_=this.PopupEmployeesFilter("","SetNewDocFields"):o.e.IsEmpty(_)&&(_=this.FilterEmployees());var Q,H=s.a.common.GetDataSet("PAY038",this.ScreenObject.CostCenterID.toString()).Tables[0];if(s.a.SessionManager.Preferences.ContainsKey("UseDailyAttRates"))for(var W=function(t){(Q=H.filter((function(n){return n.SysColumnName==e.ScreenObject.ColumnSource[t].DisplayMember})))&&Q.length>0&&(e.ScreenObject.ColumnSource[t].IsVisible="True"==s.a.SessionManager.Preferences.UseDailyAttRates.toString())},U=0;U<this.ScreenObject.ColumnSource.length;U++)W(U);var X=null,q=s.a.common.GetDataSet3("PAY039",this.ScreenObject.CostCenterID.toString(),s.a.SessionManager.RoleID);if(null!=q&&q.Tables[0].length>0&&(X=s.a.common.GetDataSet3("PAY040",this.ScreenObject.CostCenterID.toString(),s.a.SessionManager.RoleID)),null!=X&&X.Tables.length>0){for(var Y=0;Y<X.Tables[0].length;Y++)for(var z=function(t){e.ScreenObject.ColumnSource[t].DisplayMember.toString()==X.Tables[0][Y].SysColumnName&&(e.ScreenObject.ColumnSource[t].ReadOnly="1"==X.Tables[0][Y].ReadOnly.toString(),e.ScreenObject.ColumnSource[t].Width=parseInt(X.Tables[0][Y].Width),e.ScreenObject.ColumnSource[t].Mandatory="1"==X.Tables[0][Y].Mandatory.toString(),Q=H.filter((function(n){return n.SysColumnName==e.ScreenObject.ColumnSource[t].DisplayMember})),e.ScreenObject.ColumnSource[t].IsVisible=Q&&Q.length>0?"True"==s.a.SessionManager.Preferences.UseDailyAttRates.toString()&&"1"==X.Tables[0][Y].Visible.toString():"1"==X.Tables[0][Y].Visible.toString(),e.ScreenObject.ColumnSource[t].DisplayIndex=parseInt(X.Tables[0][Y].IndexValue))},J=0;J<this.ScreenObject.ColumnSource.length;J++)z(J);this.ScreenObject.ColumnSource.sort((function(e,t){return e.DisplayIndex-t.DisplayIndex})),this.ScreenObject.GridDataObj.RefreshColumns()}}else _=this.FilterEmployees();if(this.SetNewDocFieldsTemp(_),58==this.ScreenObject.DocumentType||60==this.ScreenObject.DocumentType||61==this.ScreenObject.DocumentType||62==this.ScreenObject.DocumentType||73==this.ScreenObject.DocumentType){_="",_=this.FilterLeaveTypes(61==this.ScreenObject.DocumentType?1:0);var Z=this.ScreenObject._CCFields.find((function(e){return"dcccnid52"==e.DBColumnName.toLowerCase()}));if(Z&&Z instanceof C.b)Z.CustomWhere=_;else if((Z=this.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()})))&&Z instanceof C.b&&50052==Z.CCID)Z.CustomWhere=_;else{var $=this.ScreenObject.ColumnSource.find((function(e){return 50052==e.CostCenterID}));$&&$ instanceof f.a&&($.FilterCondition=_)}}if(56==this.ScreenObject.DocumentType){var ee=s.a.common.GetDataSet("PAY041",s.a.SessionManager.UserID);ee&&ee.Tables[0].length>0&&(this.strEmpIsMgr=ee.Tables[0][0].IsManager.toString(),this.EmployeewiseDocumentView(40056,this.strEmpIsMgr,"False"))}if(92==this.ScreenObject.DocumentType){var te=this.ScreenObject.CustomTab.Pages[0].Fields.find((function(e){return e instanceof S.c&&"dcAlpha1"==e.DBColumnName})),ne=this.ScreenObject.CustomTab.Pages[0].Fields.find((function(e){return e instanceof S.c&&"dcAlpha2"==e.DBColumnName}));te.Enable=ne.Enable=!(this.ScreenObject.DocID>0);var ae=this.GetButton("Fill Dates");ae&&(ae.Visible=0==this.DocID)}if(97==this.ScreenObject.DocumentType){var ie=this.ScreenObject._TextFields.find((function(e){return"dcAlpha16"==e.DBColumnName.toString()}));ie&&(ie.CustomFormat="01/MMM/yyyy",ie.Date=s.a.SessionManager.PayrollMonth),null!=(ie=this.ScreenObject._TextFields.find((function(e){return"dcAlpha33"==e.DBColumnName.toString()})))&&(ie.CustomFormat="01/MMM/yyyy",ie.Date=s.a.SessionManager.PayrollMonth),this.ScreenObject.GridDataObj.Clear(),this.dtPayMon=s.a.SessionManager.PayrollMonth}99==this.DocumentType&&this.ScreenObject.GridDataObj.Clear()}}},{key:"SetNewDocFieldsTemp",value:function(e){var t=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));if(t&&t instanceof C.b)t.CustomWhere=e;else if(t&&t instanceof p.a)t.Name.CustomWhere=t.Code.CustomWhere=e;else if((t=this.ScreenObject._TextFields.find((function(e){return"dcalpha5"==e.DBColumnName.toLowerCase()})))&&t instanceof C.b&&50051==t.CCID)t.CustomWhere=e;else if(t&&t instanceof p.a&&50051==t.CCID)t.Name.CustomWhere=t.Code.CustomWhere=e;else{var n=this.ScreenObject.ColumnSource.find((function(e){return 50051==e.CostCenterID&&"dcCCNID51"==e.DisplayMember}));n&&n instanceof f.a&&(n.FilterCondition=e),this.ScreenObject.GridDataColumns.Contains("dcCCNID51Code")&&((n=this.ScreenObject.ColumnSource.find((function(e){return"dcccnid51code"==e.DisplayMember.toLowerCase()})))&&n instanceof f.a&&(n.FilterCondition=e))}this.ScreenObject.GridDataObj.RefreshColumns()}},{key:"EmployeewiseDocumentView",value:function(e,t,n){if(40056==e&&"No"==t){var a=this.GetButton("Distribute");a&&(a.Visible=!1);var i=this.GetButton("Generate");i&&(i.Visible=!1),this.ReadOnlyBody=!0;var r=this.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()}));r&&("False"==n&&o.e.IsEmpty(r.Text)||"True"==n&&o.e.IsEmpty(r.Text))?(this.BodyVisible=!1,this.ButtonSave.Visible=!0,this.ScreenObject._TextFields.forEach((function(e){e instanceof h.d&&"dcalpha1"==e.DBColumnName.toLowerCase()?(e.IsReadOnly=!1,e.Text="0"):e instanceof h.d&&"dcalpha2"==e.DBColumnName.toLowerCase()||e instanceof h.d&&"dcalpha3"==e.DBColumnName.toLowerCase()||e instanceof h.d&&"dcalpha4"==e.DBColumnName.toLowerCase()?(e.IsReadOnly=!0,e.Text="0"):e instanceof S.c&&"dcalpha5"==e.DBColumnName.toLowerCase()&&(e.Visible=!1)})),((r=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})))&&r instanceof C.b||r&&r instanceof p.a)&&(r.IsReadOnly=!1),(r=this.ScreenObject._CCFields.find((function(e){return"dcccnid52"==e.DBColumnName.toLowerCase()})))&&r instanceof C.b&&(r.IsReadOnly=!1)):(r=this.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()})))&&r instanceof h.d&&parseFloat(r.Text)>0&&(this.BodyVisible=!0,r.IsReadOnly=!0,this.ScreenObject._TextFields.forEach((function(e){e instanceof h.d&&"dcalpha1"==e.DBColumnName.toLowerCase()||e instanceof h.d&&"dcalpha3"==e.DBColumnName.toLowerCase()||e instanceof h.d&&"dcalpha4"==e.DBColumnName.toLowerCase()?e.IsReadOnly=!0:e instanceof S.c&&"dcalpha5"==e.DBColumnName.toLowerCase()&&(e.Visible=!0,e.IsReadOnly=!0)})),((r=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})))&&r instanceof C.b||r&&r instanceof p.a)&&(r.IsReadOnly=!0),(r=this.ScreenObject._CCFields.find((function(e){return"dcccnid52"==e.DBColumnName.toLowerCase()})))&&r instanceof C.b&&(r.IsReadOnly=!0))}}},{key:"FillPayrollLockUnlockDetails",value:function(e){var t=this;try{!function(){var n=s.a.common.GetDataSet("PAY034","");if(n&&n.Tables.length>0&&n.Tables[0].length>0){var a,i=null;e||t.ScreenObject.GridDataObj.Clear();for(var r=t.ScreenObject.Data.Tables[0].filter((function(e){return"ProductID"==e.SysColumnName})),c=0,l=function(e){(a=t.ScreenObject.GridData.filter((function(t){return t.dcAlpha1_Key==new Date(n.Tables[0][e].PayrollMonth)})))&&a.length>0||(i=t.ScreenObject.GridDataObj.NewRow(),t.ScreenObject.GridData.InsertAt(i,c),c++,r.length>0&&!o.e.IsEmpty(r[0].UserDefaultValue)&&(i.ProductID_Key=r[0].UserDefaultValue),i.dcAlpha1_Key=new Date(n.Tables[0][e].PayrollMonth),i.dcAlpha1=new Date(n.Tables[0][e].PayrollMonth).ToString("dd/MMM/yyyy"),i.dcAlpha2_Key=new Date(n.Tables[0][e].PayrollMonthStart),i.dcAlpha2=new Date(n.Tables[0][e].PayrollMonthStart).ToString("dd/MMM/yyyy"),i.dcAlpha3_Key=new Date(n.Tables[0][e].PayrollMonthEnd),i.dcAlpha3=new Date(n.Tables[0][e].PayrollMonthEnd).ToString("dd/MMM/yyyy"))},u=0;u<n.Tables[0].length;u++)l(u);t.ScreenObject.GridData.SortBy([{name:"dcAlpha1_Key",desc:!0}]),t.ScreenObject.GridDataObj.refreshDataView(),t.ScreenObject.UpdateSequence()}t.ScreenObject.GridDataObj.CanUserAddRows=!1,t.ScreenObject.GridDataObj.CanUserDeleteRows=!1,Logger.InfoLog("AddEditDocumentViewModel::Exiting FillPayrollLockUnlockDetails()")}()}catch(n){Logger.ErrorLog("AddEditDocumentViewModel::EXCEPTION FillPayrollLockUnlockDetails()"+n.stack)}}},{key:"SetSaveVisibility",value:function(){this.IsPOs&&(this.ButtonSave.Visible=!1,this.ButtonSaveandBarcode.Visible=!1,this.ButtonSaveandPrint.Visible=!1,this.ButtonRevise.Visible=!1,this.ButtonsLeft.Contains(this.ButtonSaveandPrint)&&this.ButtonsLeft.Remove(this.ButtonSaveandPrint))}},{key:"OnShortcutClick",value:function(e){try{for(var t=0;t<this.Shortcuts.length;t++)this.Shortcuts[t]instanceof y.c&&this.Shortcuts[t].DBColumnID.toString()==e.toString()?this.ScreenObject.GetExternalFuncData(this.Shortcuts[t].Mode,this.Shortcuts[t].ToolTipFooterTitle,this.Shortcuts[t].ToolTipFooterDescription,this.Shortcuts[t].ToolTipDescription,null):this.Shortcuts[t]instanceof f.a&&this.Shortcuts[t].ID==e.toString()&&null!=this.SelectedRow&&this.ScreenObject.GetExternalFuncData(this.Shortcuts[t].Mode,this.Shortcuts[t].SPName,this.Shortcuts[t].IPParams,this.Shortcuts[t].OPParams,this.SelectedRow)}catch(n){this.DisplayMessage="Problem processing request try again",Logger.ErrorLog("AddEditDocumentViewModel","OnShortcutClick",n)}}},{key:"OnDocLinkClick",value:function(e){var t=this.DocsList.find((function(t){return t.DBColumnID==parseInt(e)}));if(t)if(1==t.Dependancy){var n=new a(t.DBColumnID,t.Label,!1,this);s.a.page.addNewTab({component:x.AddEditDocumentComponent,params:{obj:n}})}else{var i=s.a.page.indexOf(this),r=this.DocsList,o=new a(t.DBColumnID,t.Label,!1,this);o.DocsList.Clear();for(var c=0;c<r.length;c++)r[c].DBColumnID==o.CostCenterID&&(r[c].DBColumnID=this.CostCenterID,r[c].Label=this.DisplayName),o.DocsList.push(r[c]);o.onButtonClick("Documents"),s.a.page.addNewTab({component:x.AddEditDocumentComponent,params:{obj:o},position:i}),s.a.page.removeTab(this)}}},{key:"OnReportsLinkClick",value:function(e){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var a,i,r,c,l,u,d,D,h,S,m,b=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((a=this.ScreenObject.Data.Tables[21].filter((function(e){return"ProductID"==e.SysColumnName}))).length>0&&a.forEach((function(e){e.SysColumnName="ProductID_Key"})),i=this.ReportsList.find((function(t){return t.DBColumnID==parseInt(e)})),r={strXML:""},i&&2==i.Dependancy||(this.DisplayMessage=this.GetReportFilterXML(e,r)),!(i&&2==i.Dependancy||0==this.DisplayMessage.length)){t.next=14;break}return t.next=7,Promise.all([n.e(2),n.e(1),n.e(3),n.e(5),n.e(4),n.e(6),n.e(7),n.e(10),n.e(9),n.e(8),n.e(12),n.e(11),n.e(13),n.e(19),n.e(15),n.e(21),n.e(20),n.e(16),n.e(14),n.e(18),n.e(17),n.e(22),n.e(23),n.e(24),n.e(25),n.e(28),n.e(30),n.e(29),n.e(32),n.e(31),n.e(27),n.e(26),n.e(35),n.e(37),n.e(38),n.e(36),n.e(33),n.e(34),n.e(39),n.e(40),n.e(41),n.e(212)]).then(n.bind(null,"ThYU"));case 7:return c=t.sent,l=c.ReportViewModel,t.next=11,Promise.all([n.e(32),n.e(37)]).then(n.bind(null,"YU11"));case 11:u=t.sent,d=u.ReportViewComponent,i&&1==i.Dependancy?((D=new l).ReportViewModel_Document(this.CostCenterID,r.strXML,parseInt(e),!0,null,null,this),o.e.Double(i.GroupName)>0&&(D.RptWidth=parseFloat(i.GroupName)),o.e.Double(i.Length)>0&&(D.RptHeight=parseFloat(i.Length)),s.a.page.ShowDialog(D,d,{HideHeader:!0}).subscribe((function(){null!=D.SelectedRow&&null!=D.SelectedRow.DataRow&&b.FillReportData(D.ReportID,D.SelectedRow.DataRow,D._ReportData),b.LineNo=b.ScreenObject.SelectedGridRowIndex+1,b.SetFocusongrid=!0}))):null!=i&&2==i.Dependancy?(h=!1,"-1"==i.GroupName&&(h=!0),(S=new l).ReportViewModel_Query(this.IsInventoryVoucher?3:2,0,this.IsInventoryVoucher?"Products":"Accounts",0,null,!0,h),S.DocumentObject=this,o.e.Double(i.GroupName)>0&&(S.RptWidth=parseFloat(i.GroupName)),o.e.Double(i.Length)>0&&(S.RptHeight=parseFloat(i.Length)),s.a.page.ShowDialog(S,d,{HideHeader:!0}).subscribe((function(){S.SelectedRow&&b.FillReportData(S.ReportID,S.SelectedRow.DataRow,S._ReportData),b.LineNo=b.ScreenObject.SelectedGridRowIndex+1,b.SetFocusongrid=!0}))):((m=new l).ReportViewModel_Document(this.CostCenterID,r.strXML,parseInt(e),!1,null,null),m.DocumentObject=this,s.a.page.addNewTab({component:d,params:{obj:m}}));case 14:case"end":return t.stop()}}),t,this)})))}},{key:"FillReportData",value:function(e,t,n){var a=this,i=this.ReportsList.find((function(t){return t.DBColumnID==e}));i&&!o.e.IsEmpty(i.ToolTipFooterDescription)&&function(){var r=new o.f;if(r.ReadXml(i.ToolTipFooterDescription),r.Tables.length>0&&r.Columns[0].Contains("ColID")&&r.Tables[0].length>0){var c=a.ScreenObject.Data.Tables[21].filter((function(t){return t.ReportID==e})),u=!1,d=!1;c.forEach((function(e){Object(l.j)(e.MapType)&&(u=!0)}));for(var D=function(e){var i=a.ScreenObject.ColumnSource.find((function(t){return t.ID==r.Tables[0][e].ColID.toString()}));if(i&&null==a.SelectedRow&&a.Setselectedrow(a.GetEmptyRowPosition(a.ScreenObject.GridDataObj,a.GetPrimaryColName())),!o.e.IsEmpty(t[r.Tables[0][e].ReportCol.toString()]))if(u){if(o.e.IsEmpty(t[r.Tables[0][e].ReportCol.toString()+"_ID"]))for(var l=function(t){for(var i=n,s=function(e){var n=c[e];if(o.e.IsEmpty(n.ReportFieldName)||o.e.IsEmpty(n.SysColumnName)||!a.ScreenObject.GridDataColumns.Contains(n.SysColumnName)||o.e.IsEmpty(a.ScreenObject.GridData[t][n.SysColumnName]))return i=[],"break";i=i.filter((function(e){return e[n.ReportFieldName.toString()]==a.ScreenObject.GridData[t][n.SysColumnName].toString()}))},l=0;l<c.length;l++){if("break"===s(l))break}i.length>0&&a.ScreenObject.SetValueBYCOLID(r.Tables[0][e].ColID.toString(),i[0][r.Tables[0][e].ReportCol.toString()].toString(),"",a.ScreenObject.GridData[t])},D=0;D<a.ScreenObject.GridData.length;D++)l(D)}else o.e.IsEmpty(t[r.Tables[0][e].ReportCol.toString()+"_ID"])?a.ScreenObject.SetValueBYCOLID(r.Tables[0][e].ColID.toString(),t[r.Tables[0][e].ReportCol.toString()].toString(),"",null!=a.SelectedRow?a.SelectedRow:null):a.ScreenObject.SetValueBYCOLID(r.Tables[0][e].ColID.toString(),t[r.Tables[0][e].ReportCol.toString()].toString(),t[r.Tables[0][e].ReportCol.toString()+"_ID"].toString(),null!=a.SelectedRow?a.SelectedRow:null);if(!d&&a.IsPOs&&null!=i&&s.a.SessionManager.Preferences.ContainsKey("POSItemCodeDimension")&&""!=s.a.SessionManager.Preferences.POSItemCodeDimension&&parseInt(s.a.SessionManager.Preferences.POSItemCodeDimension)>5e4&&!o.e.IsEmpty(t[r.Tables[0][e].ReportCol.toString()])&&i.CostCenterID==parseInt(s.a.SessionManager.Preferences.POSItemCodeDimension))d=!0,a.onSKUSearch(t[r.Tables[0][e].ReportCol.toString()].toString());else if(!d&&null!=i&&3==i.CostCenterID&&a.IsInventoryVoucher)d=!0,a.AddProductData(a.SelectedRow,!1,!1);else if(30==a.ScreenObject.DocumentType&&a.ScreenObject.Preferences.ContainsKey("AssembleProduct")&&a.ScreenObject.Preferences.AssembleProduct==r.Tables[0][e].ColID.toString()){var h=a.ScreenObject._TextFields.find((function(t){return t.DBColumnID==parseInt(r.Tables[0][e].ColID)}));h&&a.OnKitProductChange(h)}if(i&&i.CostCenterID>0)for(var S=0;S<a.ScreenObject.ColumnSource.length;S++)"LINK"==a.ScreenObject.ColumnSource[S].DataType&&!a.ScreenObject.ColumnSource[S].Dependantinuse&&a.ScreenObject.ColumnSource[S].Mandatory&&!o.e.IsEmpty(a.ScreenObject.ColumnSource[S].FilterCondition)&&a.ScreenObject.ColumnSource[S].FilterCondition.split(",").Contains(i.CostCenterID.toString())&&null!=a.SelectedRow&&a.RowAttachments(a.ScreenObject.ColumnSource[S].DisplayMember,!0,a.SelectedRow)},h=0;h<r.Tables[0].length;h++)D(h)}}()}},{key:"GetReportFilterXML",value:function(e,t){var n=this,a="";t.strXML="";var i=this.ScreenObject.Data.Tables[21];i=i.filter((function(t){return t.ReportID==e}));var r="",s="",c="",u=!1,d=!1,D=!1;i.forEach((function(e){Object(l.j)(e.GroupLevel)&&(u=!0),null!=e.MapType&&Object(l.j)(e.MapType)&&(d=!0)})),a+="<XML",u&&(a+=' GroupLevel="1"'),a+=" >";var m,b,y=this.ScreenObject.SelectedGridRowIndex,f="",O=this.ScreenObject.GridData,I=this.ScreenObject.GridDataColumns;this.ReportDimension.SelectedValue>0?2==this.ReportDimension.CCID?I.Contains("CreditAccount_Key")?O=this.ScreenObject.GridData.filter((function(e){return e.CreditAccount_Key==n.ReportDimension.SelectedValue})):I.Contains("DebitAccount_Key")?O=this.ScreenObject.GridData.filter((function(e){return e.DebitAccount_Key==n.ReportDimension.SelectedValue})):I.Contains("AccountID_Key")&&(O=this.ScreenObject.GridData.filter((function(e){return e.AccountID_Key==n.ReportDimension.SelectedValue}))):3==this.ReportDimension.CCID&&(O=this.ScreenObject.GridData.filter((function(e){return e.ProductID_Key==n.ReportDimension.SelectedValue}))):!d&&this.SelectedRow&&(O=this.ScreenObject.GridData.filter((function(e){return e.DocSeqNo==n.SelectedRow.DocSeqNo})));for(var T=0;T<i.length;T++){if(b=i[T].ReportField.toString(),a+="<Row ",a+='ColID ="'+b+'" ',D=!1,f=i[T].SysColumnName,m=parseInt(i[T].DocumentField),d=Object(l.j)(i[T].MapType),I.Contains(f)||I.Contains(f+"_Key")){if(d){r="",s="";for(var j=0;j<O.length;j++)I.Contains(f+"_Key")?o.e.IsEmpty(O[j][f+"_Key"])||"0"==O[j][f+"_Key"].toString()||("23148"==b&&O[j][f].toString().length>0&&(s=s+"'"+O[j][f].toString()+"',",I.Contains("LinkedInvDocDetailsID")&&!o.e.IsEmpty(O[j].LinkedInvDocDetailsID)&&"0"!=O[j].LinkedInvDocDetailsID.toString()&&(c=c+O[j].LinkedInvDocDetailsID.toString()+",")),r=r+"'"+O[j][f+"_Key"].toString()+"',"):o.e.IsEmpty(O[j][f])||(r=r+"'"+O[j][f].toString()+"',");if(""==r)return alert(this.ErrorMessage+i[T].DocumentFieldName.toString()+" '"),this.LineNo=y+1,this.SetFocusongrid=!0,"Empty Value";"23148"==b&&s.length>0&&(a+='ValueText="'+s.TrimEnd(",").TrimEnd("'").TrimStart("'")+'" ',a+='LinkedInvDocDetailsIDs="'+c.TrimEnd(",")+'" '),a+='Value ="'+r.TrimEnd(",")+'" '}else if(0==O.length)this.ReportDimension.CCID==parseInt(b)&&(a+='Value ="'+this.ReportDimension.SelectedValue+'" ');else if(I.Contains(f+"_Key")){if(0==o.e.Int(O[0][f+"_Key"]))return alert(this.ErrorMessage+i[T].DocumentFieldName.toString()+" '"),this.LineNo=y+1,this.SetFocusongrid=!0,"Empty Value";if("23148"==b&&O[0][f].toString().length>0){a+='ValueText="'+O[0][f]+'" ';for(var P=0;P<O.length;P++)I.Contains("ProductID_Key")&&I.Contains("LinkedInvDocDetailsID")&&(o.e.IsEmpty(O[P].ProductID_Key)||"0"==O[P].ProductID_Key.toString()||o.e.IsEmpty(O[P].LinkedInvDocDetailsID)||"0"==O[P].LinkedInvDocDetailsID.toString()||(c=c+O[P].LinkedInvDocDetailsID.toString()+","));a+='LinkedInvDocDetailsIDs="'+c.TrimEnd(",")+'" '}a+='Value="'+O[0][f+"_Key"].toString()+'" '}else{if(o.e.IsEmpty(O[0][f]))return alert(this.ErrorMessage+i[T].DocumentFieldName.toString()+" '"),this.LineNo=y+1,this.SetFocusongrid=!0,"Empty Value";if("ProductID_Key"==f&&"3"!=b){var A=this.ScreenObject.Data.Tables[0].filter((function(e){return e.CostCenterColID==m}));if(A.length>0){var M=A[0]=o.e.String(["parentccdefaultcolid"]);if("261"==M){a+='Value ="'+O[0].ProductCode.toString()+'" />';continue}if("262"==M){a+='Value ="'+O[0].ProductName.toString()+'" />';continue}}}a+='Value ="'+O[0][f].toString()+'" '}D=!0}if(!D){for(var v=function(e){if(n.ScreenObject.HeaderFields[e].DBColumnID==m)if(n.ScreenObject.HeaderFields[e]instanceof h.d){if(""==n.ScreenObject.HeaderFields[e].Text)return{v:(alert(n.ErrorMessage+n.ScreenObject.HeaderFields[e].Label+" '"),n.LineNo=y+1,n.SetFocusongrid=!0,"Empty Value")};a+='Value ="'+n.ScreenObject.HeaderFields[e].Text+'" '}else if(n.ScreenObject.HeaderFields[e]instanceof g.a){var t=n.ScreenObject.HeaderFields[e];if("VoucherNo"==t.DBColumnName)a+='Value ="'+n.ScreenObject.VoucherNo+'" ';else{if(""==t.TextBox.Text||""==t.ComboBox.SelectedValue)return{v:(alert(n.ErrorMessage+n.ScreenObject.HeaderFields[e].Label+" '"),n.LineNo=y+1,n.SetFocusongrid=!0,"Empty Value")};a+='Value ="'+t.ComboBox.SelectedValue+'" '}}else if(n.ScreenObject.HeaderFields[e]instanceof h.c){if(""==n.ScreenObject.HeaderFields[e].Text)return{v:(alert(n.ErrorMessage+n.ScreenObject.HeaderFields[e].Label+" '"),n.LineNo=y+1,n.SetFocusongrid=!0,"Empty Value")};a+='Value ="'+n.ScreenObject.HeaderFields[e].Text+'" '}else if(n.ScreenObject.HeaderFields[e]instanceof S.a||n.ScreenObject.HeaderFields[e]instanceof S.d||n.ScreenObject.HeaderFields[e]instanceof S.c){if(n.ScreenObject.HeaderFields[e]instanceof S.a)a+='Value ="'+n.ScreenObject.HeaderFields[e].Date.ToString("dd/MMM/yyyy")+'" ';else if(n.ScreenObject.HeaderFields[e]instanceof S.d)a+='Value ="'+n.DocumentDate.ToString("dd/MMM/yyyy")+'" ';else if(n.ScreenObject.HeaderFields[e]instanceof S.c){if(!n.ScreenObject.HeaderFields[e].Date)return{v:(alert(n.ErrorMessage+n.ScreenObject.HeaderFields[e].Label+" '"),n.LineNo=y+1,n.SetFocusongrid=!0,"Empty Value")};a+='Value ="'+n.ScreenObject.HeaderFields[e].Date.ToString("dd/MMM/yyyy")+'" '}}else if(n.ScreenObject.HeaderFields[e]instanceof C.b){if(null!=n.ScreenObject._CCFields.find((function(t){return t.DBColumnName.toLowerCase()==n.ScreenObject.HeaderFields[e].DBColumnName.toLowerCase()})))return"continue";if(""==n.ScreenObject.HeaderFields[e].Text)return{v:(alert(n.ErrorMessage+n.ScreenObject.HeaderFields[e].Label+" '"),n.LineNo=y+1,n.SetFocusongrid=!0,"Empty Value")};a+='Value ="'+n.ScreenObject.HeaderFields[e].SelectedValue+'" '}else if(n.ScreenObject.HeaderFields[e]instanceof p.a){if(null!=n.ScreenObject._CCFields.find((function(t){return t.DBColumnName.toLowerCase()==n.ScreenObject.HeaderFields[e].DBColumnName.toLowerCase()})))return"continue";if(""==n.ScreenObject.HeaderFields[e].Text)return{v:(alert(n.ErrorMessage+n.ScreenObject.HeaderFields[e].Label+" '"),n.LineNo=y+1,n.SetFocusongrid=!0,"Empty Value")};a+='Value ="'+n.ScreenObject.HeaderFields[e].SelectedValue+'" '}},G=0;G<this.ScreenObject.HeaderFields.length;G++){var N=v(G);if("continue"!==N&&"object"==typeof N)return N.v}for(var E=0;E<this.ScreenObject._CCFields.length;E++)if(this.ScreenObject._CCFields[E].DBColumnID==Math.abs(m)){if(this.ScreenObject._CCFields[E]instanceof C.b){if(m<0&&!this.ScreenObject._CCFields[E].DBColumnName.startsWith("TO"))continue;if(""==this.ScreenObject._CCFields[E].Text)return alert(this.ErrorMessage+this.ScreenObject._CCFields[E].Label+" '"),this.LineNo=y+1,this.SetFocusongrid=!0,"Empty Value";a+='Value ="'+this.ScreenObject._CCFields[E].SelectedValue+'" ';break}if(this.ScreenObject._CCFields[E]instanceof p.a){if(m<0&&!this.ScreenObject._CCFields[E].DBColumnName.startsWith("TO"))continue;if(""==this.ScreenObject._CCFields[E].Text)return alert(this.ErrorMessage+this.ScreenObject._CCFields[E].Label+" '"),this.LineNo=y+1,this.SetFocusongrid=!0,"Empty Value";a+='Value ="'+this.ScreenObject._CCFields[E].SelectedValue+'" ';break}}for(var w=0;w<this.ScreenObject._TextFields.length;w++)if(this.ScreenObject._TextFields[w].DBColumnID==parseInt(i[T].DocumentField))if(this.ScreenObject._TextFields[w]instanceof h.d){if(""==this.ScreenObject._TextFields[w].Text)return alert(this.ErrorMessage+this.ScreenObject._TextFields[w].Label),this.LineNo=y+1,this.SetFocusongrid=!0,"Empty Value";a+='Value ="'+this.ScreenObject._TextFields[w].Text+'" '}else if(this.ScreenObject._TextFields[w]instanceof g.a){if(""==this.ScreenObject._TextFields[w].TextBox.Text||""==this.ScreenObject._TextFields[w].ComboBox.SelectedValue)return alert(this.ErrorMessage+this.ScreenObject._TextFields[w].Label),this.LineNo=y+1,this.SetFocusongrid=!0,"Empty Value";a+='Value ="'+this.ScreenObject._TextFields[w].TextBox.Text+'" '}else if(this.ScreenObject._TextFields[w]instanceof h.c){if(""==this.ScreenObject._TextFields[w].Text)return alert(this.ErrorMessage+this.ScreenObject._TextFields[w].Label),this.LineNo=y+1,this.SetFocusongrid=!0,"Empty Value";a+='Value ="'+this.ScreenObject._TextFields[w].Text+'" '}else if(this.ScreenObject._TextFields[w]instanceof S.a||this.ScreenObject._TextFields[w]instanceof S.d){if(!this.ScreenObject._TextFields[w].Date)return alert(this.ErrorMessage+this.ScreenObject._TextFields[w].Label),this.LineNo=y+1,this.SetFocusongrid=!0,"Empty Value";a+='Value ="'+this.ScreenObject._TextFields[w].Date.ToString("dd/MMM/yyyy")+'" '}else if(this.ScreenObject._TextFields[w]instanceof C.b){if(""==this.ScreenObject._TextFields[w].Text)return alert(this.ErrorMessage+this.ScreenObject._TextFields[w].Label),this.LineNo=y+1,this.SetFocusongrid=!0,"Empty Value";a+='Value ="'+this.ScreenObject._TextFields[w].SelectedValue+'" '}else if(this.ScreenObject._TextFields[w]instanceof p.a){if(""==this.ScreenObject._TextFields[w].Text)return alert(this.ErrorMessage+this.ScreenObject._TextFields[w].Label),this.LineNo=y+1,this.SetFocusongrid=!0,"Empty Value";a+='Value ="'+this.ScreenObject._TextFields[w].SelectedValue+'" '}}a+=" />"}return a+="</XML>",t.strXML=a,""}},{key:"BeforeRowDeletingEvent",value:function(e){if(this.SelectedRow)if(this.SelectedRows&&this.SelectedRows.length>1){for(var t=new Array,n=!0,a=0;a<this.SelectedRows.length;a++){var i=this.SelectedRows[a];if(i){if(!(n=this.CanDeleteRow(i)))break;t.push(i)}}if(n){if(confirm("Are you sure you want to delete "+this.SelectedRows.length.toString()+" Rows?")){this.IsSelectAll=!0;for(var r=0;r<t.length;r++)this.OnBeforeRowDeleting(t[r],!1);this.IsSelectAll=!1,this.ScreenObject.UpdateSequence(),this.CalculateTotals(null,!1),this.CheckVendorWiseLinkingPref(),e.CanExecute=!1}}else e.CanExecute=!1}else this.CanDeleteRow(this.SelectedRow)?(this.IsSelectAll=!1,e.CanExecute=this.OnBeforeRowDeleting(this.SelectedRow,!0)):e.CanExecute=!1}},{key:"CanInsertDeleteRow",value:function(){if((38==this.DocumentType||39==this.DocumentType)&&s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Do Not Allow Row Insert and Delete")){var e=new Et.LoginViewModel(s.a.router);e.IsPosMangr=!0,e.ShowRememberMe=!1,e.ShowDefaultCompany=!1,e.LoginText=s.a.GetResource("Com_OK"),e.FeatureID=this.CostCenterID,e.FeatureName="Do Not Allow Row Insert and Delete",e.Mode=Object(l.j)(this.IsEdit)?2:1,e.Title="Authentication",s.a.page.ShowDialog(e,Nt.LoginScreenComponent).subscribe((function(){return e.IsLoggedIn}))}return!0}},{key:"CanDeleteRow",value:function(e){if(null!=e&&this.ScreenObject.IsInventory){if("Y"==o.e.String(e.IsScheme)&&"2"==o.e.String(e.SchemeID))return alert("Can't Delete Promotional Products"),!1;if(!o.e.IsEmpty(e.LinkType)&&"2"==e.LinkType.toString())return alert("Can't Delete Mandatory linked Products"),!1;if(!o.e.IsEmpty(e.MaxSchemeID)&&"Y"==e.IsScheme.toString()&&"1"!=e.SchemeID.toString())return alert("Can't Delete Scheme Product"),!1;if(this.ScreenObject.GridDataColumns.Contains("RemQty")&&!o.e.IsEmpty(e.RemQty))return alert("Can't Delete first row"),!1;if(null!=e.LinkedQuantity&&null!=e.LinkedQuantity&&parseFloat(e.LinkedQuantity)>0)return alert("Cannot Delete Linked Product"),!1;if(!o.e.IsEmpty(e.ExecutedQty)&&parseFloat(e.ExecutedQty)>0)return alert("Cannot Delete Executed Product"),!1;if(this.IsInventoryVoucher&&!o.e.IsEmpty(e.LinkedInvDocDetailsID)&&parseInt(e.LinkedInvDocDetailsID)>0&&this.ScreenObject.Preferences.ContainsKey("LockLinkedRows")&&""!=this.ScreenObject.Preferences.LockLinkedRows&&Object(l.j)(this.ScreenObject.Preferences.LockLinkedRows))return alert("Cannot Delete Linked Product"),!1;if(this.ScreenObject.GridDataColumns.Contains("IsKit")&&null!=e&&"2"==o.e.String(e.IsKit)&&(!this.ScreenObject.GridDataColumns.Contains("landingType")||"1"!=o.e.String(e.landingType)&&"2"!=o.e.String(e.landingType)||!(this.ScreenObject.GridData.filter((function(t){return t.IsKit=t.ProductID_Key==o.e.String(e.ProductID_Key)})).length>1)))return alert("Can't Delete Kit sub Products"),!1}return this.ScreenObject.Preferences.ContainsKey("LineWisePDC")&&Object(l.j)(this.ScreenObject.Preferences.LineWisePDC)&&this.ScreenObject.GridDataColumns.Contains("RefStatusID")&&!o.e.IsEmpty(e.RefStatusID)&&370!=parseInt(e.RefStatusID)&&!o.e.IsEmpty(e.DocDetailsID)&&parseInt(e.DocDetailsID)>0?(alert("Cannot Delete Converted PDC"),!1):this.CanInsertDeleteRow()}},{key:"OnBeforeRowDeleting",value:function(e,t){var n=this;if(t)if(this.res="NO",this.IsAutoPost&&this.IsInventoryVoucher)this.res=confirm("Are you sure you want to delete?")?"Yes":"No";else{var a=this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&55489==e.LinkData}));this.res=a.length>0&&this.ScreenObject.GridDataColumns.Contains(a[0].SysColumnName)&&!o.e.IsEmpty(e[a[0].SysColumnName])&&!o.e.IsEmpty(e.DocDetailsID)&&parseInt(e.DocDetailsID)>0?confirm("Are you sure you want to delete?\n Barcode will also be removed.")?"Yes":"No":confirm("Are you sure you want to delete?")?"Yes":"No"}else this.res="Yes";if("Yes"==this.res){if(null!=e&&this.ScreenObject.IsInventory&&!o.e.IsEmpty(e.LinkType)&&"0"==e.LinkType.toString()&&!o.e.IsEmpty(e.LinkID))return this.ScreenObject.GridData.filter((function(t){return t.LinkID==e.LinkID.toString()&&t.DocSeqNo!=e.DocSeqNo})).foreach((function(e){n.ScreenObject.GridDataObj.removeRow(e)})),this.ScreenObject.GridDataObj.removeRow(e),!1;if(this.ScreenObject.GridDataColumns.Contains("IsKit")&&null!=e&&"1"==e.IsKit.toString())return this.ScreenObject.GridData.filter((function(e){return 2==e.IsKit})).foreach((function(e){n.ScreenObject.GridDataObj.removeRow(e)})),this.ScreenObject.GridDataObj.removeRow(e),!1;if(this.IsInventoryVoucher&&!o.e.IsEmpty(e.MaxSchemeID)&&this.ScreenObject.GridData.filter((function(t){return t.MaxSchemeID==e.MaxSchemeID&&"Y"==t.IsScheme})).length>0)if(this.ScreenObject.GridData.filter((function(t){return t.MaxSchemeID==e.MaxSchemeID&&"N"==t.IsScheme})).length>1){var i=this.ScreenObject.GridData.filter((function(t){return t.MaxSchemeID==e.MaxSchemeID&&"N"==t.IsScheme}));if(i[0]!=e){var r=this.ScreenObject.GetSchemes(this.DocumentDate,i[0]);r.Tables.length>0&&r.Columns[0].Contains("SchemeID")&&this.fillSchemevalues(r.Tables[0],r.Columns[0],i[0]),this.ApplySchemes(i[0])}else{var s=this.ScreenObject.GetSchemes(this.DocumentDate,i[1]);s.Tables.length>0&&s.Columns[0].Contains("SchemeID")&&this.fillSchemevalues(s.Tables[0],s.Columns[0],i[1]),this.ApplySchemes(i[1])}}else this.ScreenObject.GridData.filter((function(t){return t.MaxSchemeID==e.MaxSchemeID&&"Y"==t.IsScheme})).forEach((function(e){n.ScreenObject.GridDataObj.removeRow(e)}));return null!=this.AutoPostViewModel&&(this.AutoPostViewModel.ScreenObject.GridData.filter((function(t){return t.RefSeqNo==e.RefSeqNo})).forEach((function(e){n.AutoPostViewModel.ScreenObject.GridDataObj.removeRow(e)})),this.AutoPostViewModel.CalculateTotals(null,!1)),this.CheckPackingWtVol(e),this.ScreenObject.GridDataObj.removeRow(e),!1}return!1}},{key:"onRoundOff",value:function(e){var t=this;if("DataGridPactListBoxColumn"!=e.column.className){if(this.IsInventoryVoucher&&(null==e.Column||"PactTextBoxEditor"==e.Column.GetType().toString())&&e.column){var n=e.column.field,a=e.item;if("quantity"==n.toLowerCase()&&this.ScreenObject.GridDataColumns.Contains("PackType")&&"true"==a.PackType.toString().toLowerCase())s.a.page.ShowDialog(new ue(this,6),de.a,{ShowCenter:!0}).subscribe((function(){var e=t.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember==n}));t.RoundOffValue(a,e)}));else{var i=this.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember==n}));this.RoundOffValue(a,i)}}}else{var r=e.item;if(3==e.column.DgCol.CostCenterID&&!o.e.IsEmpty(r.ProductID_Key)&&parseInt(r.ProductID_Key)>0){var c=this.ScreenObject.GetSubtituteProducts(parseInt(r.ProductID_Key),this.DocumentDate,r.DocDetailsID.toString(),r);if(c.Tables.length>0&&!c.Columns[0].Contains("ErrorMessage")&&c.Tables[0].length>0){var l=new me.a(this,c.Tables[0],c.Columns[0],c.Tables[1],r.ProductName.toString(),r.ProductCode.toString(),r.ProductID_Key.toString());l.GridData.length>0&&s.a.page.ShowDialog(l,be.a,{ShowCenter:!0}).subscribe((function(){return t.SetFocusongrid=!0}))}}}}},{key:"onFooterRoundOff",value:function(e){if(this.IsInventoryVoucher&&"PactTextBoxEditor"==e.Column.GetType().toString()){var t=e.item,n=e.column.field;if(("Amount"==n||"CalcAmount"==n)&&!o.e.IsEmpty(t.ColumnName)){var a=this.GetCeilValue();0!=a&&(o.e.IsEmpty(t[n])||0==parseFloat(t[n])||(this.SetFooterRoundoffValue(t,0),this.CalculateTotals(null,!1),a=this.GetCeilValue()),this.SetFooterRoundoffValue(t,a),this.CalculateTotals(null,!1),this.ScreenObject.FooterGridDataObj.updateRow(t))}}}},{key:"SetFooterRoundoffValue",value:function(e,t){e.Amount=t,e.CalcAmount=t}},{key:"GetCeilValue",value:function(){var e=0;s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&null!=this.Currency&&!o.e.IsEmpty(this.Currency.ExchangeRate.Text)&&this.ScreenObject.Preferences.ContainsKey("NettotaldocumentCurrency")&&""!=this.ScreenObject.Preferences.NettotaldocumentCurrency&&Object(l.j)(this.ScreenObject.Preferences.NettotaldocumentCurrency)&&o.e.IsNum(this.Currency.ExchangeRate.Text)&&(e=parseFloat(this.Currency.ExchangeRate.Text));var t=(0!=e?(this.GridNetTotal+this.FooterGridNetTotal)/e:this.GridNetTotal+this.FooterGridNetTotal)%1;return t=t<.5?-t:1-t}},{key:"RoundOffValue",value:function(e,t){if(t&&t.DisplayMember.toLowerCase().Contains("dcnum")){var n=this.GetCeilValue();0!=n&&(o.e.IsEmpty(e[t.DisplayMember])||0==parseFloat(e[t.DisplayMember])||(this.SetRoundoffValue(e,t,0),this.CalculateTotals(null,!1),n=this.GetCeilValue()),this.SetRoundoffValue(e,t,n),this.CalculateTotals(e,!1),this.ScreenObject.GridDataObj.updateRow(e))}}},{key:"SetRoundoffValue",value:function(e,t,n){e[t.DisplayMember]=n.ToString("N"+t.DecimalPoints),e["dcCalc"+t.DisplayMember]=n.ToString("N"+t.DecimalPoints)}},{key:"onEidtQuantity",value:function(e){if(null!=e&&"Quantity"==e.toString()&&this.ScreenObject.SelectedGridRowIndex>0){var t=this.ColumnNo,n=this.ScreenObject.ColumnSource.find((function(e){return!o.e.IsEmpty(e.DisplayMember)&&"quantity"==e.DisplayMember.toLowerCase()}));n&&(this.ColumnNo=this.ScreenObject.ColumnSource.indexOf(n)+1),this.LineNo=this.ScreenObject.SelectedGridRowIndex,this.SetFocusongrid=!0,this.ColumnNo=t}else if(null!=e&&"MovetoQty"==e.toString()){var a=this.GetEmptyRowPosition(this.ScreenObject.GridDataObj,"ProductID_Key");if(a<0)return;var i=this.ColumnNo,r=this.ScreenObject.ColumnSource.find((function(e){return!o.e.IsEmpty(e.DisplayMember)&&"quantity"==e.DisplayMember.toLowerCase()}));r&&(this.ColumnNo=this.ScreenObject.ColumnSource.indexOf(r)+1),this.LineNo=a,this.SetFocusongrid=!0,this.ColumnNo=i}else if(null!=e&&"MovetoSKU"==e.toString()&&this.SKU.Visible)this.SKU.SetFocus=!0;else if(null!=e&&"Attachments"==e.toString()){if(this.SelectedRow){var c=this.SelectedRow;if(this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!o.e.IsEmpty(c.ProductID_Key)&&parseInt(c.ProductID_Key)>0){var u=this.ScreenObject.GetAttachments(3,parseInt(c.ProductID_Key));null!=u&&u.Tables.length>0&&u.Tables[0].length>0&&u.Columns[0].Contains("FileID")&&s.a.page.ShowDialog(new fe(this,u.Tables[0],""),ge.a,{ShowCenter:!0})}else if(!this.IsInventoryVoucher&&this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&!o.e.IsEmpty(c.AccountID_Key)&&parseInt(c.AccountID_Key)>0){var d="";this.ScreenObject.GridDataColumns.Contains("accountName")&&!o.e.IsEmpty(c.accountName)?d=c.accountName.toString():this.ScreenObject.GridDataColumns.Contains("accountcode")&&!o.e.IsEmpty(c.accountcode)&&(d=c.accountcode.toString());var D=this.ScreenObject.GetAttachments(2,parseInt(c.AccountID_Key));null!=D&&D.Tables.length>0&&D.Tables[0].length>0&&D.Columns[0].Contains("FileID")&&s.a.page.ShowDialog(new fe(this,D.Tables[0],d),ge.a,{ShowCenter:!0})}else if(!this.IsInventoryVoucher&&this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!o.e.IsEmpty(c.CreditAccount_Key)&&parseInt(c.CreditAccount_Key)>0){var h="";this.ScreenObject.GridDataColumns.Contains("accountName")&&!o.e.IsEmpty(c.accountName)?h=c.accountName.toString():this.ScreenObject.GridDataColumns.Contains("accountcode")&&!o.e.IsEmpty(c.accountcode)&&(h=c.accountcode.toString());var S=this.ScreenObject.GetAttachments(2,parseInt(c.CreditAccount_Key));null!=S&&S.Tables.length>0&&S.Tables[0].length>0&&S.Columns[0].Contains("FileID")&&s.a.page.ShowDialog(new fe(this,S.Tables[0],h),ge.a,{ShowCenter:!0})}else if(!this.IsInventoryVoucher&&this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!o.e.IsEmpty(c.DebitAccount_Key)&&parseInt(c.DebitAccount_Key)>0){var m="";this.ScreenObject.GridDataColumns.Contains("accountName")&&!o.e.IsEmpty(c.accountName)?m=c.accountName.toString():this.ScreenObject.GridDataColumns.Contains("accountcode")&&!o.e.IsEmpty(c.accountcode)&&(m=c.accountcode.toString());var b=this.ScreenObject.GetAttachments(2,parseInt(c.DebitAccount_Key));null!=b&&b.Tables.length>0&&b.Tables[0].length>0&&b.Columns[0].Contains("FileID")&&s.a.page.ShowDialog(new fe(this,b.Tables[0],m),ge.a,{ShowCenter:!0})}}}else if(null!=e&&"FreeProds"==e.toString())null!=this.SelectedRow&&this.ScreenObject.Preferences.ContainsKey("EnablePromotions")&&""!=this.ScreenObject.Preferences.EnablePromotions&&Object(l.j)(this.ScreenObject.Preferences.EnablePromotions)&&s.a.page.ShowDialog(new ce(this,this.SelectedRow,null,1),Ne.a);else if(null==e||"Distribute"!=e.toString()&&"DistributeQty"!=e.toString()){if(null!=e&&"DistributeGen"==e.toString())s.a.page.ShowDialog(new ce(this,this.SelectedRow,null,4),Ne.a,{ShowCenter:!0});else if(null!=e&&"Copy"==e.toString())if(this.IsPOs)this.onCopy(e);else if(5==this.DocumentType&&this.ScreenObject.GridDataColumns.Contains("RecievedQty"))for(var C=0;C<this.ScreenObject.GridData.length;C++)!o.e.IsEmpty(this.ScreenObject.GridData[C].ProductID_Key)&&!o.e.IsEmpty(this.ScreenObject.GridData[C].Quantity)&&parseFloat(this.ScreenObject.GridData[C].Quantity)>0&&(this.ScreenObject.GridData[C].RecievedQty=this.ScreenObject.GridData[C].Quantity)}else s.a.page.ShowDialog(new ce(this,this.SelectedRow,null,"Distribute"==e.toString()?2:3),Ne.a)}},{key:"onShowImage",value:function(e){if(e&&e.item){var t=e.item;this.ScreenObject.GridDataColumns.Contains("FileExtension")&&this.ShowProductImage(t)}}},{key:"onFieldCalc",value:function(e){s.a.SessionManager.IsActionAssigned(43,"EnableFieldCalculator")&&this.ScreenObject.Preferences.ContainsKey("FieldCalculator")&&""!=this.ScreenObject.Preferences.FieldCalculator&&Object(l.j)(this.ScreenObject.Preferences.FieldCalculator)&&null!=e&&null!=e.item&&s.a.page.ShowDialog(new ue(this,0),de.a,{ShowCenter:!0,Title:"Field calculator"})}},{key:"onSearchProduct",value:function(e){var t=this,n=e.column,a=this.ScreenObject.SelectedGridRowIndex;if(null!=e.column){if("DataGridPactListBoxColumn"==n.className){var i=this.ScreenObject.ColumnSource.find((function(t){return t.DisplayMember==e.column.field})),r=0;i&&(r=i.GridViewID),(3==n.DgCol.CostCenterID||r>0)&&(0==r&&(r=268),s.a.page.ShowDialog(new Je.ProductSearchCatalogViewModel(this,r,n.DgCol.CostCenterID,i,null),Ze.ProductSearchCatalogComponent))}else if("PactTextBoxEditor"==n.className){var c="";if(32==this.DocumentType){var u=this.ScreenObject.Preferences.ContainsKey("VarienceField")?this.ScreenObject.ColumnSource.find((function(e){return e.ID==t.ScreenObject.Preferences.VarienceField})):null;null!=u&&(c=u.DisplayMember)}if("holdquantity"==e.column.field.toLowerCase())this.SelectedRow&&!o.e.IsEmpty(this.SelectedRow.DocDetailsID)&&parseInt(this.SelectedRow.DocDetailsID)>0&&s.a.page.ShowDialog(new ie(this),re.a);else if(("quantity"==e.column.field.toLowerCase()&&!o.e.IsEmpty(this.SelectedRow.Quantity)||"FreeQTY"==e.column.field&&!o.e.IsEmpty(this.SelectedRow.FreeQTY)||31==this.DocumentType&&e.column.field.toLowerCase().startsWith("dcnum")&&!o.e.IsEmpty(this.SelectedRow[e.column.field]))&&null!=this.SelectedRow&&5==o.e.Int(this.SelectedRow.Type)){if(this.ScreenObject.Preferences.ContainsKey("ShowBatches")&&""!=this.ScreenObject.Preferences.ShowBatches&&Object(l.j)(this.ScreenObject.Preferences.ShowBatches)||!this.DonotUpdateInventory||31==this.DocumentType){this.fillbatches(this.SelectedRow,e.column.field);var d=this.ColumnNo;return this.ColumnNo=e.column.DisplayIndex+2,this.LineNo=a+1,this.SetFocusongrid=!0,void(this.ColumnNo=d)}}else if("quantity"!=e.column.field.toLowerCase()||"2"==this.SelectedRow.Type.toString()||"5"==this.SelectedRow.Type.toString()||o.e.IsEmpty(this.SelectedRow.BinWise)||"True"!=this.SelectedRow.BinWise.toString()||o.e.IsEmpty(this.SelectedRow.Quantity)){if((this.DonotUpdateInventory||"quantity"!=e.column.field.toLowerCase()&&"recievedqty"!=e.column.field.toLowerCase()&&"freeqty"!=e.column.field.toLowerCase())&&(31!=this.DocumentType||!e.Column.field.toLowerCase().startsWith("dcnum")||o.e.IsEmpty(this.SelectedRow[e.Column.field]))&&(32!=this.DocumentType||""==c||e.Column.field!=c||o.e.IsEmpty(this.SelectedRow[e.Column.field]))||o.e.IsEmpty(this.SelectedRow.Type)||2!=parseInt(this.SelectedRow.Type)){if("amount"==e.column.field.toLowerCase()||"debitamount"==e.column.field.toLowerCase()||"creditamount"==e.column.field.toLowerCase()){var D=e.item,h=n.field,S=1,m=1;null!=this.Currency&&null!=this.Currency.Currency.SelectedValue&&""!=this.Currency.Currency.SelectedValue?S=parseInt(this.Currency.Currency.SelectedValue):this.ScreenObject.GridDataColumns.Contains("CurrencyID")&&!o.e.IsEmpty(D.CurrencyID_Key)&&(S=parseInt(D.CurrencyID_Key)),null!=this.Currency&&null!=this.Currency.ExchangeRate.Text&&""!=this.Currency.ExchangeRate.Text?m=parseFloat(this.Currency.ExchangeRate.Text):this.ScreenObject.GridDataColumns.Contains("ExchangeRate")&&!o.e.IsEmpty(D.ExchangeRate)&&(m=parseFloat(D.ExchangeRate)),"Amount"==h?null!=D[h]&&0!=parseFloat(D[h])&&(18==this.ScreenObject.DocumentType||19==this.ScreenObject.DocumentType||21==this.ScreenObject.DocumentType||22==this.ScreenObject.DocumentType?this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!o.e.IsEmpty(D.CreditAccount_Key)&&(o.e.IsEmpty(D[h])||this.CheckIsBillWise(parseInt(D.CreditAccount_Key),D,h,parseFloat(D[h]),!0,S,m)):14!=this.ScreenObject.DocumentType&&15!=this.ScreenObject.DocumentType&&20!=this.ScreenObject.DocumentType&&23!=this.ScreenObject.DocumentType||this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!o.e.IsEmpty(D.DebitAccount_Key)&&(o.e.IsEmpty(D[h])||this.CheckIsBillWise(parseInt(D.DebitAccount_Key),D,h,parseFloat(D[h]),!1,S,m))):"DebitAmount"==h?null==D[h]||0==parseFloat(D[h])||o.e.IsEmpty(D.AccountID_Key)||o.e.IsEmpty(D[h])||this.CheckIsBillWise(parseInt(D.AccountID_Key),D,h,parseFloat(D[h]),!1,S,m):"CreditAmount"==h&&(0==o.e.Double(D[h])||o.e.IsEmpty(D.AccountID_Key)||this.CheckIsBillWise(parseInt(D.AccountID_Key),D,h,parseFloat(D[h]),!0,S,m))}}else if(30==this.ScreenObject.DocumentType&&(this.VoucherType=this.ScreenObject.GridDataColumns.Contains("VoucherType")&&!o.e.IsEmpty(this.SelectedRow.VoucherType)?parseInt(this.SelectedRow.VoucherType):0),!o.e.IsEmpty(this.SelectedRow[e.column.field.toLowerCase()])&&(parseFloat(this.SelectedRow[e.column.field.toLowerCase()])>0||32==this.ScreenObject.DocumentType&&parseFloat(this.SelectedRow[e.column.field.toLowerCase()].toString())<0)){var b=new ye(this,e.column.field.toLowerCase(),this.VoucherType,0,this.SelectedRow);s.a.page.ShowDialog(b,pe.a,{NoWidth:!0})}}else this.AddBins(this.SelectedRow,!1,!1,null)}this.LineNo=a+1,this.SetFocusongrid=!0}}},{key:"onDistDim",value:function(e){if("PactTextBoxEditor"==e.column.className){var t=e.column.field,n=this.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember==t}));null==n&&(n=this.ScreenObject.ColumnSource.find((function(e){return e.distDim>5e4&&e.DefaultValueText.toLowerCase()==t.toLowerCase()}))),n.distDim>5e4&&this.ONDisDim(t)}}},{key:"ONDisDim",value:function(e){var t=new k.ShowJVViewModel;t.ShowJVViewModel_2(this,e,7),s.a.page.ShowDialog(t,_.ShowJVComponent,{ShowCenter:!0,Title:t.Title})}},{key:"onDistribute",value:function(e){var t=e.column.DgCol;e.column.field;if("DataGridComboBoxColumn"==e.column.className?t.ValueMember:t.DisplayMember,"DataGridPactListBoxColumn"!=e.column.className){var n=e.column.field;if("quantity"==n.toLowerCase()&&(!this.ScreenObject.GridDataColumns.Contains("landingType")||"1"!=e.item.landingType.toString()&&"2"!=e.item.landingType.toString()||this.ScreenObject.GridDataColumns.Contains("VoucherType")&&"-1"!=e.item.VoucherType.toString()||(this.ScreenObject.GridDataObj.angularGrid&&this.ScreenObject.GridDataObj.angularGrid.slickGrid.getEditorLock().commitCurrentEdit(),s.a.page.ShowDialog(new ue(this,2),de.a)),this.ScreenObject.GridDataColumns.Contains("IsTestCase"))){this.res="YES";var a=new ue(this,4);"NO"!=this.res&&s.a.page.ShowDialog(a,de.a)}var i=this.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember==n}));if(i&&i.DisplayMember.toLowerCase().Contains("dcnum")&&null!=i.DistributeColName&&""!=i.DistributeColName&&this.ScreenObject.GridDataColumns.Contains(i.DistributeColName)&&(this.ScreenObject.GridDataObj.angularGrid&&this.ScreenObject.GridDataObj.angularGrid.slickGrid.getEditorLock().commitCurrentEdit(),o.e.IsNum(e.item[n])&&confirm(s.a.GetResource("Doyouwanttodistribute")))){this.ScreenObject.GridDataObj.angularGrid&&this.ScreenObject.GridDataObj.angularGrid.slickGrid.getEditorLock().commitCurrentEdit();var r="",c="";!o.e.IsEmpty(i.DependantOn)&&this.ScreenObject.GridDataColumns.Contains(i.DependantOn+"_Key")&&(r=i.DependantOn+"_Key",o.e.IsEmpty(e.item[r])||(c=e.item[r].toString())),this.DistributeValues(n,parseFloat(e.item[n]),i.DistributeColName,!0,r,c)}}else 3==t.CostCenterID&&(this.ScreenObject.Preferences.ContainsKey("UseQtyAdjustment")&&""!=this.ScreenObject.Preferences.UseQtyAdjustment&&Object(l.j)(this.ScreenObject.Preferences.UseQtyAdjustment)&&this.ScreenObject.GridDataColumns.Contains("QtyType")&&!o.e.IsEmpty(e.item.QtyType)&&("1"==e.item.QtyType.toString()||"2"==e.item.QtyType.toString())?s.a.page.ShowDialog(new ue(this,1),de.a,{ShowCenter:!0}):this.ScreenObject.Preferences.ContainsKey("TempInfo")&&""!=this.ScreenObject.Preferences.TempInfo&&Object(l.j)(this.ScreenObject.Preferences.TempInfo))}},{key:"GetColName",value:function(){return null==this.ScreenObject?"":this.IsInventoryVoucher?"ProductID_Key":this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")?"CreditAccount_Key":this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")?"DebitAccount_Key":this.ScreenObject.GridDataColumns.Contains("AccountID_Key")?"AccountID_Key":""}},{key:"DistributeValues",value:function(e,t,n,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",s="";this.IsInventoryVoucher?s="ProductID_Key":this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")?s="CreditAccount_Key":this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")?s="DebitAccount_Key":this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&(s="AccountID_Key");for(var c=0,l=0;l<this.ScreenObject.GridData.length;l++)if(!o.e.IsEmpty(this.ScreenObject.GridData[l][s])&&!o.e.IsEmpty(this.ScreenObject.GridData[l][n])&&o.e.IsNum(this.ScreenObject.GridData[l][n])){if(""!=i&&this.ScreenObject.GridData[l][i].toString()!=r)continue;c+=parseFloat(this.ScreenObject.GridData[l][n])}var u=0,d=0,D=this.ScreenObject.ColumnSource.find((function(t){return t.DisplayMember==e}));!D&&e.toLowerCase().Contains("dccalc")&&(D=this.ScreenObject.ColumnSource.find((function(t){return t.DisplayMember==e.replace("dcCalc","")})));for(var h=0;h<this.ScreenObject.GridData.length;h++)if(!o.e.IsEmpty(this.ScreenObject.GridData[h][s])){if(""!=i&&this.ScreenObject.GridData[h][i].toString()!=r)continue;if(c>0&&!o.e.IsEmpty(this.ScreenObject.GridData[h][n])&&o.e.IsNum(this.ScreenObject.GridData[h][n])){var S=parseFloat(this.ScreenObject.GridData[h][n])/c*t;this.ScreenObject.GridData[h][e]=D&&null!=D.DecimalPoints&&""!=D.DecimalPoints?S.ToString("N"+D.DecimalPoints):S,d+=parseFloat(this.ScreenObject.GridData[h][e]),u=h}else this.ScreenObject.GridData[h][e]=0;a&&this.CalculateTotals(this.ScreenObject.GridData[h],!1,e)}if(u>0&&t-d!=0){var m=parseFloat(this.ScreenObject.GridData[u][e])+t-d;this.ScreenObject.GridData[u][e]=D&&null!=D.DecimalPoints&&""!=D.DecimalPoints?m.ToString("N"+D.DecimalPoints):m,a&&this.CalculateTotals(this.ScreenObject.GridData[u],!1,e)}}},{key:"onCopy",value:function(e){var t=this,n=this.GetPrimaryColName();if(""!=n){var a=e.column.className;"DataGridPactListBoxColumn"!=a&&e.grid.getEditorLock().commitCurrentEdit();var i="";i=e.column.field;for(var r=confirm(s.a.GetResource("overrideallNotocopyblank")),c=this.ScreenObject.GridData,l=e.item,u=0;u<c.length;u++)if("DataGridPactListBoxColumn"==a&&e.grid.getEditorLock().commitCurrentEdit(),!o.e.IsEmpty(c[u][n])){if(0==r&&!o.e.IsEmpty(c[u][i])&&(!this.ScreenObject.GridDataObj.DataTypes.Double.Contains(i)||o.e.IsEmpty(this.ScreenObject.GridData[u][i])||0!=parseFloat(this.ScreenObject.GridData[u][i])))continue;var d;if(c[u][i]=l[i].toString(),45==this.DocumentType&&"dcalpha13"==i.toLowerCase()&&this.ScreenObject.GridDataColumns.Contains("AssignXML")&&(c[u].AssignXML=l.AssignXML.toString()),"DataGridDateTimeColumn"!=a&&"DataGridDateColumn"!=a||!this.ScreenObject.GridDataColumns.Contains(i+"_key")){if("DataGridPactListBoxColumn"==a)!function(){var e=t.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember==i}));e&&(""==o.e.String(l[e.ValueMember])?c[u][e.ValueMember]=null:function(){c[u][e.ValueMember]=l[e.ValueMember].toString();var n=t.ScreenObject.Data.Tables[0].filter((function(t){return null!=t.LocalReference&&t.LocalReference==e.ID}));if(n.length>0)for(var a=function(e){""!=o.e.String(n[e].SysColumnName)&&""!=o.e.String(n[e].CostCenterColID)&&(null!=(d=t.ColumnSource.find((function(t){return t.ID==n[e].CostCenterColID.toString()})))&&("DATE"==d.DataType||"Time2"==d.DataType||"DATETIME"==d.DataType||"TIME"==d.DataType?o.e.isValidDate(o.e.String(l[d.DisplayMember+"_Key"]))&&(c[u][d.DisplayMember+"_Key"]=new Date(l[d.DisplayMember+"_Key"].toString()),"DATE"==d.DataType?c[u][d.DisplayMember]=new Date(l[d.DisplayMember+"_Key"].toString()).ToString(s.a.SessionManager.Preferences["Date Format"]):"Time2"==d.DataType?c[u][d.DisplayMember]=new Date(l[d.DisplayMember+"_Key"].toString()).ToString("HH:mm"):"DATETIME"==d.DataType?c[u][d.DisplayMember]=new Date(l[d.DisplayMember+"_Key"].toString()).ToString(s.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss tt"):"TIME"==d.DataType&&(c[u][d.DisplayMember]=new Date(l[d.DisplayMember+"_Key"].toString()).ToString("hh:mm:ss tt"))):"ComboBox"==d.DataType?c[u][d.ValueBinding]=l[d.ValueBinding].toString():"PactComboBox"==d.DataType?c[u][d.ValueBinding+"_Key"]=l[d.ValueBinding+"_Key"].toString():"LISTBOX"==d.DataType&&0!=d.CostCenterID?o.e.Int(l[d.ValueMember])>0&&(c[u][d.ValueMember]=l[d.ValueMember].toString(),c[u][d.DisplayMember]=l[d.DisplayMember].toString()):"Double"==t.ScreenObject.GridDataColumns[d.DisplayMember].DataType?o.e.Double(l[d.DisplayMember])>0&&(c[u][d.DisplayMember]=l[d.DisplayMember].toString()):c[u][d.DisplayMember]=l[d.DisplayMember].toString()))},i=0;i<n.length;i++)a(i)}())}()}else c[u][i+"_key"]=""==o.e.String(l[i+"_key"])?null:l[i+"_key"].toString();if("quantity"==i.toLowerCase()){var D=1;o.e.IsNum(c[u].UOMConversion)&&(D=parseFloat(c[u].UOMConversion)),o.e.IsEmpty(c[u].Quantity)||(c[u].UOMConvertedQty=D*parseFloat(this.ScreenObject.GridData[u].Quantity))}this.CalculateTotals(c[u],!1,i)}31!=this.DocumentType&&32!=this.DocumentType||"duedate"!=i.toLowerCase()||(this.ScreenObject.GridDataColumns.Contains(i+"_key")&&!o.e.IsEmpty(l[i+"_key"])?this.CalcQOH(new Date(l[i+"_key"])):this.CalcQOH(this.DocumentDate))}}},{key:"LineItemEditClick",value:function(e){this.ScreenObject.GridDataObj.SelectedItem=e,this.ScreenObject.GridDataObj.MobileAddLine.ShowMobileAddLineItem(e)}},{key:"LineItemFooterEditClick",value:function(e){this.ScreenObject.FooterGridDataObj.SelectedItem=e,this.ScreenObject.FooterGridDataObj.MobileAddLine.ShowMobileAddLineItem(e)}},{key:"LineItemDeleteClick",value:function(e){if(this.ScreenObject.GridDataObj.CanUserDeleteRows&&this.CanDeleteRow(this.SelectedRow)){var t=this.ScreenObject.GridData.indexOf(this.SelectedRow);if(this.OnBeforeRowDeleting(this.SelectedRow,!0),"Yes"==this.res&&(this.ScreenObject.GridDataObj.Table.Contains(e)&&this.ScreenObject.GridDataObj.removeRow(e),-1!=t))for(var n=t;n<this.ScreenObject.GridData.length;n++)this.ScreenObject.GridDataObj.updateRow(this.ScreenObject.GridData[n])}}},{key:"onGridLinkClick",value:function(e,t){"drEdit"==t&&"N"!=e.drEdit?this.LineItemEditClick(e):"drDelete"==t&&"N"!=e.drEdit&&this.LineItemDeleteClick(e)}},{key:"onBeginEdit",value:function(e){var t=this,n=e.args,i=e.args.item,r=e.args.column,c=r.DgCol,u=o.e.IsEmpty(c.ValueBinding)?c.DisplayMember:c.ValueBinding,d=o.e.IsEmpty(c.ValueBinding)?c.ValueMember:c.ValueBinding,D=r.className;if("DataGridPactComboBoxColumn"==D){if(c&&c.ReadOnly)return void(n.Cancel=!0);c&&(this.PrevValue=o.e.String(i[c.ValueBinding]))}else if(null!=c&&null!=c){if(null!=c&&null!=c&&(c.ReadOnly||"refno"==c.DisplayMember.toLowerCase()))return void(n.Cancel=!0);"POSDocumentViewModel"==this.ClassName&&"FLOAT"==c.DataType&&(this.NUmpadBindingPath=c.DisplayMember,this.NumPadText=o.e.IsEmpty(e.args.item[c.DisplayMember])?"":e.args.item[c.DisplayMember].toString())}if(this.ScreenObject.Preferences.ContainsKey("ControlAccountFilterField")&&""!=this.ScreenObject.Preferences.ControlAccountFilterField&&"0"!=this.ScreenObject.Preferences.ControlAccountFilterField){var h=this.ScreenObject.ColumnSource.find((function(e){return e.ID==t.ScreenObject.Preferences.ControlAccountFilterField}));if(h&&!o.e.IsEmpty(h.DefaultValue)&&o.e.IsEmpty(i[h.ValueMember])&&!o.e.IsEmpty(h.DefaultValueText)&&o.e.IsNum(h.DefaultValue)){var b=h.DefaultValueText.split("\x11");b.length>0&&(i[h.DisplayMember]=b[0]),i[h.ValueMember]=h.DefaultValue}}if(this.ScreenObject.GridDataColumns.Contains("FieldType")&&o.e.IsEmpty(i.FieldType)||100==this.DocumentType)n.Cancel=!0;else if(null!=this.NumericPADView&&(null!=c&&null!=c&&"FLOAT"==c.DataType.toUpperCase()?(this.NumericPADView.DisplayMember=c.DisplayMember,o.e.IsEmpty(i[c.DisplayMember])||(this.NumericPADView.txt.Text=i[c.DisplayMember].toString())):(this.NumericPADView.DisplayMember="",this.NumericPADView.txt.Text="0")),c&&"DATE"==c.DataType&&this.ScreenObject.GridDataColumns.Contains(c.DisplayMember+"_Key")&&(this.PrevValue=o.e.String(i[c.DisplayMember+"_Key"])),c&&"Time2"==c.DataType&&this.ScreenObject.GridDataColumns.Contains(c.DisplayMember+"_Key")&&(this.PrevValue=o.e.String(i[c.DisplayMember+"_Key"])),!this.ScreenObject.GridDataColumns.Contains("IsKit")||"1"!=o.e.String(i.IsKit)&&"2"!=o.e.String(i.IsKit)||"Quantity"!=c.DisplayMember&&("DataGridPactListBoxColumn"!=r.className||3!=c.CostCenterID&&11!=c.CostCenterID)&&("DataGridPactComboBoxColumn"!=r.className||"VoucherType"!=u))if(!o.e.IsEmpty(i.ExecutedQty)&&parseFloat(i.ExecutedQty)>0)n.Cancel=!0;else{if(45==this.DocumentType&&c){if(null==this.ProjDims){var y=0;this.ProjDims=[],(y=o.e.Int(s.a.SessionManager.Preferences.PMLevel1Dimension))>0&&this.ProjDims.push(y),(y=o.e.Int(s.a.SessionManager.Preferences.PMLevel2Dimension))>0&&this.ProjDims.push(y),(y=o.e.Int(s.a.SessionManager.Preferences.PMLevel3Dimension))>0&&this.ProjDims.push(y),(y=o.e.Int(s.a.SessionManager.Preferences.PMTaskDimension))>0&&this.ProjDims.push(y)}if("dcalpha12"==c.DisplayMember.toLowerCase())this.Dependencies();else if("dcalpha13"==c.DisplayMember.toLowerCase())this.AssignUsers();else if("dcalpha18"==c.DisplayMember.toLowerCase()&&this.ScreenObject.GridDataColumns.Contains("dcAlpha20")&&"Close"==o.e.String(i.dcAlpha20)||!o.e.IsEmpty(i.DocDetailsID)&&parseInt(i.DocDetailsID)>0&&this.ProjDims.Contains(c.CostCenterID))return void(n.Cancel=!0)}if(this.ScreenObject.GridDataColumns.Contains("CanEdit")&&"0"==o.e.String(i.CanEdit))n.Cancel=!0;else if(this.IsInventoryVoucher&&"Y"==o.e.String(i.IsScheme)&&"2"==o.e.String(i.SchemeID))n.Cancel=!0;else{if(92==this.DocumentType){var g="DayWise",f=this.ScreenObject._TextFields.find((function(e){return"dcalpha4"==e.DBColumnName.toLowerCase()}));if(f&&(g=f.SelectedValue),"DayWise"==g&&("dcalpha5_key"==n.model.SortMemberPath.toLowerCase()||"dcalpha6_key"==n.model.SortMemberPath.toLowerCase()||"dcccnid73"==n.model.SortMemberPath.toLowerCase()))return void(n.Cancel=!0)}if(89==this.DocumentType||90==this.DocumentType){var O=this.ScreenObject._TextFields.find((function(e){return"dcalpha32"==e.DBColumnName.toLowerCase()}));if(O instanceof m.e){var I="";if(null==(I=null==n.model.Binding?n.model.SelectedValueBinding:n.model.Binding)&&(I=""),null!=O.SelectedValue&&"Manual"==O.SelectedValue){if("dcalpha1_key"==I.toLowerCase()||"dcalpha2"==I.toLowerCase()||"dcalpha3_key"==I.toLowerCase()||"dcalpha4"==I.toLowerCase())return void(n.Cancel=!1)}else if("dcalpha1_key"==I.toLowerCase()||"dcalpha2"==I.toLowerCase()||"dcalpha3_key"==I.toLowerCase()||"dcalpha4"==I.toLowerCase())return void(n.Cancel=!0)}}if(94!=this.DocumentType||"dcalpha7"!=n.model.Binding.toLowerCase()||Object(l.j)(i.dcAlpha5))if(62==this.CostCenterID&&this.ScreenObject.GridDataColumns.Contains("dcccnid52_Key")&&this.ScreenObject.GridDataColumns.Contains("dcAlpha10")&&!o.e.IsEmpty(i.dcAlpha10)&&!o.e.IsEmpty(i.DocDetailsID)&&parseFloat(i.DocDetailsID)>0&&"dcccnid52"==n.model.Binding.toLowerCase())n.Cancel=!0;else if(40058==this.CostCenterID&&this.ScreenObject.GridDataColumns.Contains("dcccnid52_Key")&&this.ScreenObject.GridDataColumns.Contains("dcAlpha6")&&!o.e.IsEmpty(i.dcAlpha6)&&!o.e.IsEmpty(i.DocDetailsID)&&parseFloat(i.DocDetailsID)>0&&"DataGridPactComboBoxColumn"==r.className&&50052==c.CostCenterID&&("1"==o.e.String(i.dcAlpha6)||"2"==o.e.String(i.dcAlpha6)))n.Cancel=!0;else{if(40072==this.CostCenterID&&this.ScreenObject.GridDataColumns.Contains("dcAlpha21")&&!o.e.IsEmpty(i.dcAlpha21)){var T=!1,j=this.ScreenObject._TextFields.find((function(e){return"dcalpha16"==e.DBColumnName.toLowerCase()}));if(j&&"Yes"==j.SelectedValue&&(T=!0),!T&&"dcNum2"==n.model.Binding)return void(n.Cancel=!0);if("dcNum3"==n.model.Binding)return void(n.Cancel=!0);if("2"==o.e.String(i.dcAlpha21)){if("dcNum1"==n.model.Binding&&this.ScreenObject.GridDataColumns.Contains("dcAlpha23")&&!o.e.IsEmpty(i.dcAlpha23)&&parseFloat(i.dcAlpha23)>0)return void(n.Cancel=!0);if("dcNum2"==n.model.Binding&&this.ScreenObject.GridDataColumns.Contains("dcAlpha23")&&!o.e.IsEmpty(i.dcAlpha23)&&parseFloat(i.dcAlpha23)>0)return void(n.Cancel=!0);if(("dcNum1"==n.model.Binding||"dcNum2"==n.model.Binding)&&this.ScreenObject.GridDataColumns.Contains("dcAlpha23")&&!o.e.IsEmpty(i.dcAlpha23)&&("-1"==i.dcAlpha23.toString()||"-3"==i.dcAlpha23.toString()))return void(n.Cancel=!1)}else if(!("3"!=o.e.String(i.dcAlpha21)&&"4"!=o.e.String(i.dcAlpha21)||"dcNum2"!=n.model.Binding&&"dcNum3"!=n.model.Binding))return void(n.Cancel=!0)}if(40076==this.CostCenterID&&this.ScreenObject.GridDataColumns.Contains("dcAlpha2")&&this.ScreenObject.GridDataColumns.Contains("dcAlpha3")&&!o.e.IsEmpty(i.dcAlpha3)&&"-1"==i.dcAlpha3.toString())n.Cancel=!0;else{if(40078==this.CostCenterID&&this.ScreenObject.GridDataColumns.Contains("dcAlpha2")&&!o.e.IsEmpty(i.dcAlpha2))if("Quarterly"==i.dcAlpha2){if("dcAlpha4"==n.model.Binding||"dcAlpha5"==n.model.Binding||"dcAlpha6_Key"==n.model.Binding||"dcAlpha7"==n.model.Binding)return void(n.Cancel=!0)}else if("Monthly"==i.dcAlpha2&&("dcAlpha8"==n.model.Binding||"dcNum7"==n.model.Binding))return void(n.Cancel=!0);if(96==this.ScreenObject.DocumentType)if("dcAlpha6"==n.model.Binding){if("Hours"==o.e.String(i.dcAlpha5))return void(n.Cancel=!0)}else if("dcAlpha10"==n.model.Binding&&"Hours"==o.e.String(i.dcAlpha9))return void(n.Cancel=!0);if(67==this.ScreenObject.DocumentType){var P=null,A=null;if("DataGridPactListBoxColumn"!=r.className||"dcccnid51"!=n.model.Binding.toLowerCase()||o.e.IsEmpty(this.strEmpFilter)||(c.FilterCondition=this.strEmpFilter),"dcNum2"==n.model.Binding||"dcNum3"==n.model.Binding||"dcNum6"==n.model.Binding||"dcNum8"==n.model.Binding||"dcNum10"==n.model.Binding||"dcNum12"==n.model.Binding||"dcNum14"==n.model.Binding||"dcNum15"==n.model.Binding){if("dcNum2"!=n.model.Binding)return void(n.Cancel=!0);if((o.e.IsEmpty(i.PayrollType)||"WeeklyOff"!=i.PayrollType)&&"Holiday"!=i.PayrollType)return void(n.Cancel=!0)}if("dcNum4"==n.model.Binding)if(s.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")&&"True"==s.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence);else if(!o.e.IsEmpty(i.PayrollType)&&("WeeklyOff"==i.PayrollType||"Holiday"==i.PayrollType)||s.a.SessionManager.Preferences.ContainsKey("BreakHoursImpactToOTS")&&"False"==s.a.SessionManager.Preferences.BreakHoursImpactToOTS)return void(n.Cancel=!0);if("dcNum5"==n.model.Binding||"dcNum7"==n.model.Binding||"dcNum9"==n.model.Binding||"dcNum11"==n.model.Binding||"dcNum13"==n.model.Binding){if(!s.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=s.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)return void(n.Cancel=!0);var M=n.model.Binding;if(!o.e.IsEmpty(i.PayrollType))if("WeeklyOff"==i.PayrollType){if((P=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName==M}))).length>0&&((A=this.dtOTTypes.filter((function(e){return e.CostCenterColID==P[0].LinkData}))).length>0&&"PayWeeklyOffOT"!=A[0].SysColumnName&&"PayHolidayOT"!=A[0].SysColumnName&&"PayEveryDayOT"!=A[0].SysColumnName))return void(n.Cancel=!0)}else if("Holiday"==i.PayrollType){if((P=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName==M}))).length>0&&((A=this.dtOTTypes.filter((function(e){return e.CostCenterColID==P[0].LinkData}))).length>0&&"PayHolidayMastOT"!=A[0].SysColumnName&&"PayHolidayOT"!=A[0].SysColumnName&&"PayEveryDayOT"!=A[0].SysColumnName))return void(n.Cancel=!0)}else if((P=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName==M}))).length>0&&((A=this.dtOTTypes.filter((function(e){return e.CostCenterColID==P[0].LinkData}))).length>0&&"PayNormalOT"!=A[0].SysColumnName&&"PayEveryDayOT"!=A[0].SysColumnName))return void(n.Cancel=!0)}}if(40056==this.CostCenterID&&this.ScreenObject.GridDataColumns.Contains("dcNum2")&&!o.e.IsEmpty(i.dcNum2)&&null!=this.dsData&&"dcNum2"==n.model.Binding&&(this.dsData.Tables[1].filter((function(e){return e.LinkedInvDocDetailsID==i.DocDetailsID})).length>0||0==parseInt(i.dcNum2)))n.Cancel=!0;else if(this.IsInventoryVoucher&&"Y"==o.e.String(i.IsScheme)&&!o.e.IsEmpty(i.SchemeID)&&parseInt(i.SchemeID)>2&&("Quantity"==c.DisplayMember||"Gross"==c.DisplayMember||"DataGridPactListBoxColumn"==r.className&&(3==c.CostCenterID||11==c.CostCenterID)))n.Cancel=!0;else if(!this.ScreenObject.GridDataColumns.Contains("RemQty")||o.e.IsEmpty(i.RemQty)||"DataGridPactListBoxColumn"!=r.className||3!=c.CostCenterID){if("Quantity"==u&&this.ScreenObject.Preferences.ContainsKey("EnableWieghingPopupOnQty")&&""!=this.ScreenObject.Preferences.EnableWieghingPopupOnQty&&Object(l.j)(this.ScreenObject.Preferences.EnableWieghingPopupOnQty)&&"true"==o.e.String(i.IsWeightable).toLowerCase()){var v=this.QtyReader(o.e.String(i.Quantity));i.Quantity=o.e.IsEmpty(v)?"0":v}var G=this.ScreenObject.GridData.indexOf(i);if(G=-1==G||this.ScreenObject.GridData.length-G<3?3:0,this.ScreenObject.GridDataObj.CanUserAddRows)for(var N=0;N<G;N++){var E=this.ScreenObject.GridDataObj.NewRow();E.DocSeqNo=this.ScreenObject.GridData.length+1,E.DocDetailsID=0,this.ScreenObject.GridDataObj.addRow(E)}if(this.IsInventoryVoucher&&!o.e.IsEmpty(i.LinkedInvDocDetailsID)&&parseInt(i.LinkedInvDocDetailsID)>0&&(this.ScreenObject.Preferences.ContainsKey("LockLinkedRows")&&""!=this.ScreenObject.Preferences.LockLinkedRows&&Object(l.j)(this.ScreenObject.Preferences.LockLinkedRows)&&(!this.ScreenObject.Preferences.ContainsKey("LockLinkedCols")||!this.ScreenObject.Preferences.LockLinkedCols.split(",").Contains(u))||this.ScreenObject.Preferences.ContainsKey("DontSavePartiallyLinkedItem")&&""!=this.ScreenObject.Preferences.DontSavePartiallyLinkedItem&&Object(l.j)(this.ScreenObject.Preferences.DontSavePartiallyLinkedItem)&&"PactTextBoxEditor"==D&&i.LinkedFieldName==u))n.Cancel=!0;else if(this.ScreenObject.Preferences.ContainsKey("LineWisePDC")&&Object(l.j)(this.ScreenObject.Preferences.LineWisePDC)&&this.ScreenObject.GridDataColumns.Contains("RefStatusID")&&!o.e.IsEmpty(i.RefStatusID)&&370!=parseInt(i.RefStatusID)&&!o.e.IsEmpty(i.DocDetailsID)&&parseInt(i.DocDetailsID)>0)n.Cancel=!0;else{if("PactTextBoxEditor"==D&&(this.PrevValue=o.e.String(i[u])),(35==this.ScreenObject.DocumentType||202==this.ScreenObject.DocumentType)&&"PactTextBoxEditor"==D){if("dcAlpha20"==c.DisplayMember){var w=new Date,F=new Date;if(35==this.ScreenObject.DocumentType){if(this.ScreenObject.GridDataColumns.Contains("dcNum2")&&""!=i.dcNum2.toString()&&parseFloat(i.dcNum2.toString())>0&&parseFloat(i.dcNum2.toString()),this.ScreenObject.GridDataColumns.Contains("dcAlpha3")&&this.ScreenObject.GridDataObj.DataTypes.Date.Contains("dcAlpha3"))o.e.String(i.dcAlpha3)||(w=new Date(i.dcAlpha3.toString()));else{var V=this.ScreenObject._TextFields.find((function(e){return"dcalpha3"==e.DBColumnName.toLowerCase()}));null!=V&&V instanceof S.c&&V.Date&&(w=V.Date)}if(this.ScreenObject.GridDataColumns.Contains("dcAlpha4")&&this.ScreenObject.GridDataObj.DataTypes.Date.Contains("dcAlpha4"))o.e.String(i.dcAlpha4)||(F=new Date(i.dcAlpha4.toString()));else{var L=this.ScreenObject._TextFields.find((function(e){return"dcalpha4"==e.DBColumnName.toLowerCase()}));null!=L&&L instanceof S.c&&L.Date&&(F=L.Date)}}else if(202==this.ScreenObject.DocumentType){if(this.ScreenObject.GridDataColumns.Contains("dcalpha12")&&this.ScreenObject.GridDataObj.DataTypes.Date.Contains("dcAlpha12"))o.e.String(i.dcalpha12)||(w=new Date(i.dcalpha12.toString()));else{var R=this.ScreenObject._TextFields.find((function(e){return"dcalpha12"==e.DBColumnName.toLowerCase()}));null!=R&&R instanceof S.c&&R.Date&&(w=R.Date)}if(this.ScreenObject.GridDataColumns.Contains("dcalpha13")&&this.ScreenObject.GridDataObj.DataTypes.Date.Contains("dcAlpha13"))o.e.String(i.dcalpha13)||(F=new Date(i.dcalpha13.toString()));else{var B=this.ScreenObject._TextFields.find((function(e){return"dcalpha13"==e.DBColumnName.toLowerCase()}));null!=B&&B instanceof S.c&&B.Date&&(F=B.Date)}a.GetTotalMonthsFrom(w,F)}return void(n.Cancel=!0)}if("dcAlpha21"==c.DisplayMember)return void(n.Cancel=!0)}if("DataGridPactComboBoxColumn"==D){var x=n.model.SelectedValueBinding,k=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName==x}));if(k.length>0&&!o.e.IsEmpty(k[0].LinkData)&&22803==parseInt(k[0].LinkData)){var _=n.column.editor;this.ScreenObject.GridDataColumns.Contains("EndYear")&&this.ScreenObject.GridDataColumns.Contains("StartYear")&&!o.e.IsEmpty(i.StartYear)?(this.itemSourceFilter.length>0?_.ItemsSource=this.itemSourceFilter:this.itemSourceFilter=_.ItemsSource,_.ItemsSource=this.itemSourceFilter.filter((function(e){return e.Year>=o.e.String(i.StartYear)})),_.ItemsSource=!o.e.IsEmpty(i.EndYear)&&parseInt(i.EndYear)>0?_.ItemsSource.filter((function(e){return e.Year<=o.e.String(i.EndYear)})):_.ItemsSource.filter((function(e){return e.Year<=(new Date).getFullYear().toString()}))):_.ItemsSource=this.itemSourceFilter.filter((function(e){return 1==e.Year}))}}else if("DataGridPactListBoxColumn"==D){var K=n.model,Q=d;if(this.PrevValue=o.e.String(i[Q]),3==K.CostCenterID){if(""==this.PrevValue&&this.ScreenObject.Preferences.ContainsKey("AutoSearchcatalog")&&""!=this.ScreenObject.Preferences.AutoSearchcatalog&&Object(l.j)(this.ScreenObject.Preferences.AutoSearchcatalog)){this.ProdID=0;var H=this.ScreenObject.ColumnSource.find((function(e){return e.CostCenterID==K.CostCenterID})),W=0;return H&&(W=H.GridViewID),0==W&&(W=268),void s.a.page.ShowDialog(new Je.ProductSearchCatalogViewModel(this,W,3,null,null),Ze.ProductSearchCatalogComponent)}if(null!=i.LinkedQuantity&&null!=i.LinkedQuantity&&parseFloat(i.LinkedQuantity)>0)return alert("Cannot Edit Linked Product"),void(n.Cancel=!0)}if(11==K.CostCenterID){var U="";this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&(U=o.e.String(i.ProductID_Key)),this.Unit_keyOnBeginEditText=o.e.String(i.Unit);var X=" (BaseID IN ";X+=" (SELECT     BaseID ",X=(X+=" FROM          COM_UOM AS COM_UOM_1 with(nolock) ")+" WHERE      (UOMID =(select UOMID from inv_product with(nolock) where productid="+U+") ))) ",""==U?(K.ProductID=0,X=" (BaseID IN ",X+=" (SELECT     BaseID ",X+=" FROM          COM_UOM AS COM_UOM_1 with(nolock) ",X+=" WHERE      (UOMID =-1 ))) "):K.ProductID=parseInt(U),K.FilterCondition=X,K.ShowMutipleOption=!0,K.QtyWhere=this.ScreenObject.GetQtyWhere(i,"")}else if(2==K.CostCenterID){var q=1,Y=this.ScreenObject.ColumnSource.find((function(e){return e.ValueMember==Q}));if(Y&&Y.IsRepeat&&(o.e.IsEmpty(i[Y.ValueMember])||!o.e.IsEmpty(i[Y.ValueMember])&&0==parseInt(i[Y.ValueMember]))){var z=this.ScreenObject.GridData.indexOf(i);z>0&&(i[Y.DisplayMember]=this.ScreenObject.GridData[z-1][Y.DisplayMember],i[Y.ValueMember]=this.ScreenObject.GridData[z-1][Y.ValueMember])}this.ScreenObject.DivisionID>0&&(K.DivisionID=this.ScreenObject.DivisionID),this.ScreenObject.LocationID>0&&(K.LocationID=this.ScreenObject.LocationID);var J="";K.Join="";var Z=this.ScreenObject._CCFields.filter((function(e){return e.CrFilter>0}));"debitaccount_key"==Q.toLowerCase()?Z=this.ScreenObject._CCFields.filter((function(e){return e.DbFilter>0})):"creditaccount_key"!=Q.toLowerCase()&&"accountid_key"!=Q.toLowerCase()&&(Z=null),null!=Z&&Z.forEach((function(e){e instanceof C.b&&e.SelectedValue>0&&(""!=J&&(J+=" and "),e.AccDimInUse?(J="("+e.DBColumnName.replace("dc","")+"="+e.SelectedValue.toString(),1==e.CrFilter&&(J+=" OR "+e.DBColumnName.replace("dc","")+"=1 "),J+=")"):(K.Join+=" join COM_CostCenterCostCenterMap DCCM"+q+" with(nolock) on a.AccountID=DCCM"+q+".ParentNodeID and DCCM"+q+".ParentCostCenterID=2 ",K.Join+=" join "+t.ScreenObject.GetTableName(e.CCID)+" DCCMj"+q+" with(nolock) on DCCM"+q+".CostCenterID="+e.CCID+" and DCCM"+q+".NodeID= DCCMj"+q+".NodeID ",K.Join+=" join "+t.ScreenObject.GetTableName(e.CCID)+" DCG"+q+" with(nolock) on  DCG"+q+".lft between   DCCMj"+q+".lft and  DCCMj"+q+".rgt",J+="  DCG"+q+".NodeID="+e.SelectedValue.toString(),q++))}));var $=this.ScreenObject.ColumnSource.filter((function(e){return e.DisplayMember.toLowerCase().Contains("dcccnid")&&e.CrRefColID>0}));if("debitaccount_key"==Q.toLowerCase()?$=this.ScreenObject.ColumnSource.filter((function(e){return e.DisplayMember.toLowerCase().Contains("dcccnid")&&e.DrRefColID>0})):"creditaccount_key"!=Q.toLowerCase()&&"accountid_key"!=Q.toLowerCase()&&($=null),null!=$)for(var ee=0;ee<$.length;ee++){var te=$[ee];o.e.IsEmpty(i[te.ValueMember])||(te.isUpdate?(J+="(CC."+te.DisplayMember.replace("dc","")+"="+i[te.ValueMember].toString(),"debitaccount_key"==Q.toLowerCase()?1!=te.DrRefColID&&2!=te.DrRefColID||(J+=" OR CC."+te.DisplayMember.replace("dc","")+"=1 "):"creditaccount_key"==Q.toLowerCase()&&(1!=te.CrRefColID&&2!=te.CrRefColID||(J+=" OR CC."+te.DisplayMember.replace("dc","")+"=1 ")),J+=")"):(K.Join+=" join COM_CostCenterCostCenterMap DCCM"+q+" with(nolock) on a.AccountID=DCCM"+q+".ParentNodeID and DCCM"+q+".ParentCostCenterID=2 ",K.Join+=" join "+this.ScreenObject.GetTableName(te.CostCenterID)+" DCCMj"+q+" with(nolock) on DCCM"+q+".CostCenterID="+te.CostCenterID+" and DCCM"+q+".NodeID= DCCMj"+q+".NodeID ",K.Join+=" join "+this.ScreenObject.GetTableName(te.CostCenterID)+" DCG"+q+" with(nolock) on  DCG"+q+".lft between   DCCMj"+q+".lft and  DCCMj"+q+".rgt",J+="  DCG"+q+".NodeID="+i[te.ValueMember].toString(),q++))}if(this.ScreenObject.Preferences.ContainsKey("ControlAccountFilterField")&&""!=this.ScreenObject.Preferences.ControlAccountFilterField&&"0"!=this.ScreenObject.Preferences.ControlAccountFilterField){var ne=this.ScreenObject.ColumnSource.find((function(e){return e.ID==t.ScreenObject.Preferences.ControlAccountFilterField}));ne&&!o.e.IsEmpty(ne.ValueMember)&&(ne.ValueMember==Q?s.a.SessionManager.Preferences.ContainsKey("IsControlAccounts")&&"TRUE"==s.a.SessionManager.Preferences.IsControlAccounts.toUpperCase()&&(""!=J&&(J+=" and "),J+=" a.AccountID in (1",s.a.SessionManager.Preferences.ContainsKey("DebtorsControlGroup")&&""!=s.a.SessionManager.Preferences.DebtorsControlGroup.toUpperCase()&&(J+=","+s.a.SessionManager.Preferences.DebtorsControlGroup),s.a.SessionManager.Preferences.ContainsKey("CreditorsControlGroup")&&""!=s.a.SessionManager.Preferences.CreditorsControlGroup.toUpperCase()&&(J+=","+s.a.SessionManager.Preferences.CreditorsControlGroup),J+=")"):this.ScreenObject.Preferences.ContainsKey("AccountFilterField")&&""!=this.ScreenObject.Preferences.AccountFilterField&&"0"!=this.ScreenObject.Preferences.AccountFilterField||"LISTBOX"==ne.DataType&&this.ScreenObject.GridDataColumns.Contains(ne.ValueMember)&&!o.e.IsEmpty(i[ne.ValueMember])&&(K.Join+=" join Acc_accounts g with(nolock) on a.lft between g.lft and g.rgt  and g.AccountID="+i[ne.ValueMember].toString()+" or a.IsDrCr=1 ","1"==o.e.String(i[ne.ValueMember])&&(s.a.SessionManager.Preferences.ContainsKey("DebtorsControlGroup")&&""!=s.a.SessionManager.Preferences.DebtorsControlGroup.toUpperCase()&&(K.Join+=" join Acc_accounts dacg with(nolock) on a.lft not between dacg.lft and dacg.rgt  and dacg.AccountID="+s.a.SessionManager.Preferences.DebtorsControlGroup),s.a.SessionManager.Preferences.ContainsKey("CreditorsControlGroup")&&""!=s.a.SessionManager.Preferences.CreditorsControlGroup.toUpperCase()&&(K.Join+=" join Acc_accounts cacg with(nolock) on a.lft not between cacg.lft and cacg.rgt  and cacg.AccountID="+s.a.SessionManager.Preferences.CreditorsControlGroup))))}if(5!=this.DocumentType&&8!=this.DocumentType&&13!=this.DocumentType||!this.ScreenObject.Preferences.ContainsKey("BudgetFeild")||""==this.ScreenObject.Preferences.BudgetFeild||(fe=this.ScreenObject._TextFields.find((function(e){return e.DBColumnName.toLowerCase()==t.ScreenObject.Preferences.BudgetFeild.toLowerCase()})))&&fe.SelectedValue>0&&(K.Join+=" join COM_BudgetAlloc budg WITH(NOLOCK) on budg.AccountID=a.Accountid ",""!=J&&(J+=" and "),J+=" budg.BudgetDefID="+fe.SelectedValue),this.ScreenObject.Preferences.ContainsKey("AccountFilterField")&&""!=this.ScreenObject.Preferences.AccountFilterField&&"0"!=this.ScreenObject.Preferences.AccountFilterField){var ae=this.ScreenObject.ColumnSource.find((function(e){return e.ID==t.ScreenObject.Preferences.AccountFilterField}));if(ae&&!o.e.IsEmpty(ae.ValueMember)){if(ae.ValueMember==Q&&this.ScreenObject.Preferences.ContainsKey("ControlAccountFilterField")&&""!=this.ScreenObject.Preferences.ControlAccountFilterField){var ie=this.ScreenObject.ColumnSource.find((function(e){return e.ID==t.ScreenObject.Preferences.ControlAccountFilterField}));ie&&!o.e.IsEmpty(ie.ValueMember)&&"LISTBOX"==ie.DataType&&this.ScreenObject.GridDataColumns.Contains(ie.ValueMember)&&!o.e.IsEmpty(i[ie.ValueMember])&&(K.Join+=" join Acc_accounts g with(nolock) on a.lft between g.lft and g.rgt  and g.AccountID="+i[ie.ValueMember].toString(),"1"==o.e.String(i[ie.ValueMember])&&(s.a.SessionManager.Preferences.ContainsKey("DebtorsControlGroup")&&""!=s.a.SessionManager.Preferences.DebtorsControlGroup.toUpperCase()&&(K.Join+=" join Acc_accounts dacg with(nolock) on a.lft not between dacg.lft and dacg.rgt  and dacg.AccountID="+s.a.SessionManager.Preferences.DebtorsControlGroup),s.a.SessionManager.Preferences.ContainsKey("CreditorsControlGroup")&&""!=s.a.SessionManager.Preferences.CreditorsControlGroup.toUpperCase()&&(K.Join+=" join Acc_accounts cacg with(nolock) on a.lft not between cacg.lft and cacg.rgt  and cacg.AccountID="+s.a.SessionManager.Preferences.CreditorsControlGroup)))}"LISTBOX"==ae.DataType&&this.ScreenObject.GridDataColumns.Contains(ae.ValueMember)&&!o.e.IsEmpty(i[ae.ValueMember])&&(K.Join+=" join Acc_accounts g with(nolock) on a.lft between g.lft and g.rgt  and g.AccountID="+i[ae.ValueMember].toString())}}if("creditaccount_key"==Q.toLowerCase()&&this.ScreenObject.Preferences.ContainsKey("onlyProductvendors")&&"True"==this.ScreenObject.Preferences.onlyProductvendors&&!o.e.IsEmpty(i.ProductID_Key)){var re=this.ScreenObject.GetProductVendors(o.e.String(i.ProductID_Key)),se="";if(null!=re&&re.Tables.length>0&&re.Tables[0].length>0&&re.Columns[0].Contains("AccountID"))for(var oe=0;oe<re.Tables[0].length;oe++)""!=se&&(se+=","),se+=o.e.String(re.Tables[0][oe].AccountID);""!=se&&(""!=J&&(J+=" and "),J+=" a.AccountID in ("+se+")")}null!=J&&(K.Where=""!=J?null!=K.FilterCondition&&""!=K.FilterCondition?" and "+J:J:"")}else if(3==K.CostCenterID){this.ScreenObject.DivisionID>0&&(K.DivisionID=this.ScreenObject.DivisionID),this.ScreenObject.LocationID>0&&(K.LocationID=this.ScreenObject.LocationID),K.ExcludeSelected=0,K.Join="";for(var ce=0,le="",ue="",de=0;de<this.ScreenObject.FilterFields.length;de++){var De=this.ScreenObject.FilterFields[de];if(De.Key.SelectedValue>1){if(65==De.Key.CCID||83==De.Key.CCID)continue;50006==De.Key.CCID||50004==De.Key.CCID?""!=ue&&(ue+=" and "):""!=le&&(le+=" and "),50006==De.Key.CCID?(ue+="( a.CategoryID="+De.Key.SelectedValue.toString()+" ",1!=De.Value&&2!=De.Value||(ue+=" OR a.CategoryID=1"),ue+=")"):50004==De.Key.CCID?(ue+="(a.DepartmentID="+De.Key.SelectedValue.toString()+" ",1!=De.Value&&2!=De.Value||(ue+=" OR a.DepartmentID=1"),ue+=")"):!this.ScreenObject.ProdFilterinuse.ContainsKey(De.Key.CCID)||Object(l.j)(this.ScreenObject.ProdFilterinuse[De.Key.CCID])?(le+="(CC."+De.Key.DBColumnName.replace("dc","")+"="+De.Key.SelectedValue.toString()+" ",1!=De.Value&&2!=De.Value||(le+=" OR CC."+De.Key.DBColumnName.replace("dc","")+"=1 "),le+=")"):(K.Join+=" join COM_CostCenterCostCenterMap DCCM"+ce+" with(nolock) on a.ProductID=DCCM"+ce+".ParentNodeID and DCCM"+ce+".ParentCostCenterID=3 ",K.Join+=" join "+this.ScreenObject.GetTableName(De.Key.CCID)+" DCCMj"+ce+" with(nolock) on DCCM"+ce+".CostCenterID="+De.Key.CCID+" and DCCM"+ce+".NodeID= DCCMj"+ce+".NodeID ",K.Join+=" join "+this.ScreenObject.GetTableName(De.Key.CCID)+" DCG"+ce+" with(nolock) on  DCG"+ce+".lft between   DCCMj"+ce+".lft and  DCCMj"+ce+".rgt",le+="  DCG"+ce+".NodeID="+De.Key.SelectedValue.toString(),ce++)}}for(var he=function(e){var n=t.ScreenObject.FilterColumns.keys[e],a=t.ScreenObject.FilterColumns.values[e];if(!o.e.IsEmpty(i[n])&&parseInt(i[n])>0){var r=t.ScreenObject.ColumnSource.find((function(e){return e.ValueMember==n}));if(r){if(65==r.CostCenterID||83==r.CostCenterID)return"continue";50006==r.CostCenterID||50004==r.CostCenterID?""!=ue&&(ue+=" and "):""!=le&&(le+=" and "),50006==r.CostCenterID?(ue+="(a.CategoryID="+i[n],1!=a&&2!=a||(ue+=" OR a.CategoryID=1"),ue+=")"):50004==r.CostCenterID?(ue+="(a.DepartmentID="+i[n],1!=a&&2!=a||(ue+=" OR a.DepartmentID=1"),ue+=")"):!t.ScreenObject.ProdFilterinuse.ContainsKey(r.CostCenterID)||Object(l.j)(t.ScreenObject.ProdFilterinuse[r.CostCenterID])?(le+="(CC."+r.DisplayMember.replace("dc","")+"="+i[n],1!=a&&2!=a||(le+=" OR CC."+r.DisplayMember.replace("dc","")+"=1 "),le+=")"):(K.Join+=" join COM_CostCenterCostCenterMap DCCM"+ce+" with(nolock) on a.ProductID=DCCM"+ce+".ParentNodeID and DCCM"+ce+".ParentCostCenterID=3 ",K.Join+=" join "+t.ScreenObject.GetTableName(r.CostCenterID)+" DCCMj"+ce+" with(nolock) on DCCM"+ce+".CostCenterID="+r.CostCenterID+" and DCCM"+ce+".NodeID= DCCMj"+ce+".NodeID ",K.Join+=" join "+t.ScreenObject.GetTableName(r.CostCenterID)+" DCG"+ce+" with(nolock) on  DCG"+ce+".lft between   DCCMj"+ce+".lft and  DCCMj"+ce+".rgt",le+="  DCG"+ce+".NodeID="+i[n],ce++)}}},Se=0;Se<this.ScreenObject.FilterColumns.keys.length;Se++)he(Se);""!=le&&(ue+=""!=ue?"and "+le:le),Object(l.j)(this.ScreenObject.Preferences.Showvendorwiseproducts)&&null!=this.ScreenObject.CreditAccount&&this.ScreenObject.CreditAccount.SelectedValue>0?(""!=ue&&(ue+=" and "),K.Join+=" join INV_ProductVendors IPV with(nolock) on a.ProductID=IPV.ProductID",ue+=" IPV.AccountID="+this.ScreenObject.CreditAccount.SelectedValue):this.ScreenObject.Preferences.ContainsKey("Showcustomerwiseproducts")&&""!=this.ScreenObject.Preferences.Showcustomerwiseproducts&&Object(l.j)(this.ScreenObject.Preferences.Showcustomerwiseproducts)&&null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.SelectedValue>0&&(""!=ue&&(ue+=" and "),K.Join+=" join INV_ProductVendors IPV with(nolock) on a.ProductID=IPV.ProductID",ue+=" IPV.AccountID="+this.ScreenObject.DebitAccount.SelectedValue);var me=Object(l.j)(this.ScreenObject.Preferences.ExcludeTemproducts);if(null!=K.FilterCondition&&""!=K.FilterCondition?(K.Where=this.ScreenObject.TempProductID>0&&""!=ue?me?"and ("+ue+" and a.ProductID!="+this.ScreenObject.TempProductID+")":"and ("+ue+" or a.ProductID="+this.ScreenObject.TempProductID+")":"and "+ue,K.ExcludeSelected=1):(K.ExcludeSelected=1,K.Where=this.ScreenObject.TempProductID>0&&""!=ue?me?"("+ue+" and a.ProductID!="+this.ScreenObject.TempProductID+")":"("+ue+" or a.ProductID="+this.ScreenObject.TempProductID+")":this.ScreenObject.TempProductID>0&&""==ue?me?"a.ProductID!="+this.ScreenObject.TempProductID:"":""!=ue?ue:""),K.QtyWhere=this.ScreenObject.GetQtyWhere(i,""),this.ScreenObject.Preferences.ContainsKey("ProductFilterField")&&""!=this.ScreenObject.Preferences.ProductFilterField){var be=this.ScreenObject.ColumnSource.find((function(e){return e.ID==t.ScreenObject.Preferences.ProductFilterField}));be&&!o.e.IsEmpty(be.ValueMember)&&"LISTBOX"==be.DataType&&this.ScreenObject.GridDataColumns.Contains(be.ValueMember)&&!o.e.IsEmpty(i[be.ValueMember])&&(K.Join+=" join inv_Product g with(nolock) on a.lft between g.lft and g.rgt  and g.ProductID="+i[be.ValueMember])}this.ProdID=this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!o.e.IsEmpty(i.ProductID_Key)?parseInt(i.ProductID_Key):0;var Ce=this.ScreenObject.ColumnSource.find((function(e){return e.ValueMember==Q}));if(Ce&&Ce.IsRepeat&&(o.e.IsEmpty(i[Ce.ValueMember])||!o.e.IsEmpty(i[Ce.ValueMember])&&0==parseInt(i[Ce.ValueMember]))){var ye=this.ScreenObject.GridData.indexOf(i);ye>0&&(i[Ce.DisplayMember]=this.ScreenObject.GridData[ye-1][Ce.DisplayMember],i[Ce.ValueMember]=this.ScreenObject.GridData[ye-1][Ce.ValueMember])}}else if(61==K.CostCenterID||K.CostCenterID>5e4){K.Join="";var pe=c;K.ProductID=this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!o.e.IsEmpty(i.ProductID_Key)?null==pe||2!=pe.Filter&&4!=pe.Filter?0:parseInt(i.ProductID_Key):0;var ge="";if(""!=pe.DependantOn)if(5==this.DocumentType&&"-94"==pe.DependantOn&&this.ScreenObject.Preferences.ContainsKey("BudgetFeild")&&!o.e.IsEmpty(this.ScreenObject.Preferences.BudgetFeild)){var fe,Oe="0";c.DisplayMember.startsWith("TO")&&this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!o.e.IsEmpty(i.CreditAccount_Key)?Oe=i.CreditAccount_Key.toString():c.DisplayMember.startsWith("TO")||!this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")||o.e.IsEmpty(i.DebitAccount_Key)||(Oe=i.DebitAccount_Key.toString()),(fe=this.ScreenObject._TextFields.find((function(e){return e.DBColumnName.toLowerCase()==t.ScreenObject.Preferences.BudgetFeild.toLowerCase()})))&&fe.SelectedValue>0&&(K.Join=" join COM_BudgetAlloc budg WITH(NOLOCK) on budg.CCNID"+(c.CostCenterID-5e4)+"=a.NodeID ",ge=" budg.BudgetDefID="+fe.SelectedValue,ge+=" and budg.AccountID="+Oe)}else if(o.e.IsEmpty(pe.FilterColumn))if(pe.Dependantinuse)if(this.ScreenObject.GridDataColumns.Contains(pe.DependantOn+"_Key"))pe.DisplayMember.startsWith("TO")&&this.ScreenObject.GridDataColumns.Contains("TO"+pe.DependantOn+"_Key")?!o.e.IsEmpty(i["TO"+pe.DependantOn+"_Key"])&&parseInt(i["TO"+pe.DependantOn+"_Key"].toString())>1&&(ge="("+pe.DependantOn.Replace("dc","")+"="+i["TO"+pe.DependantOn+"_Key"].toString(),1==pe.Dependancy&&(ge+=" OR "+pe.DisplayMember.Replace("TO","").Replace("dc","")+"=1 "),ge+=")"):!o.e.IsEmpty(i[pe.DependantOn+"_Key"])&&parseInt(i[pe.DependantOn+"_Key"])>1&&(ge="("+pe.DependantOn.Replace("dc","")+"="+i[pe.DependantOn+"_Key"].toString(),1==pe.Dependancy&&(ge+=" OR "+pe.DisplayMember.Replace("dc","")+"=1 "),ge+=")");else{var Ie=this.ScreenObject._CCFields.find((function(e){return e.DBColumnName.toLowerCase()==pe.DependantOn.toLowerCase()}));(Ie&&Ie instanceof C.b&&Ie.SelectedValue>0||null!=Ie&&Ie instanceof p.a&&Ie.SelectedValue>0)&&(ge="("+Ie.DBColumnName.replace("dc","")+"="+Ie.SelectedValue.toString(),1==pe.Dependancy&&(ge+=" OR "+Ie.DBColumnName.replace("dc","")+"=1 "),ge+=")")}else if(this.ScreenObject.GridDataColumns.Contains(pe.DependantOn+"_Key")&&!o.e.IsEmpty(i[pe.DependantOn+"_Key"])&&parseInt(i[pe.DependantOn+"_Key"])>1){var Te=this.ScreenObject.ColumnSource.find((function(e){return null!=e.ValueMember&&e.ValueMember.toLowerCase()==pe.DependantOn.toLowerCase()+"_key"}));Te&&(K.Join=5==pe.Dependancy?"  JOIN "+this.ScreenObject.GetTableName(pe.CostCenterID)+" CMJ with(nolock) ON a.lft between  CMJ.lft and CMJ.rgt JOIN COM_CostCenterCostCenterMap CM with(nolock) on CM.CostCenterID="+pe.CostCenterID+" and CM.ParentCostCenterID="+Te.CostCenterID+" and CM.ParentNodeID="+i[pe.DependantOn+"_Key"].toString()+" and CMJ.NodeID=CM.NodeID ":"  JOIN COM_CostCenterCostCenterMap CM with(nolock) on CM.ParentCostCenterID="+pe.CostCenterID+" and a.NodeID=CM.ParentNodeID \n                                    JOIN "+this.ScreenObject.GetTableName(Te.CostCenterID)+" CMJ with(nolock) ON CM.CostCenterID= "+Te.CostCenterID+"  and CM.NodeID=CMJ.NodeID \n                                    JOIN "+this.ScreenObject.GetTableName(Te.CostCenterID)+" CMJG with(nolock) ON CMJG.lft between  CMJ.lft and CMJ.rgt and CMJG.NodeID="+i[pe.DependantOn+"_Key"].toString())}else{var je=this.ScreenObject._CCFields.find((function(e){return e.DBColumnName.toLowerCase()==pe.DependantOn.toLowerCase()})),Pe=0,Ae=0;je&&je instanceof C.b&&je.SelectedValue>0||null!=je&&je instanceof p.a&&je.SelectedValue>0?(Pe=je.SelectedValue,Ae=je.CCID):null!=this.ScreenObject.CreditAccount&&this.ScreenObject.CreditAccount.SelectedValue>0&&"creditaccount"==pe.DependantOn.toLowerCase()?(Pe=this.ScreenObject.CreditAccount.SelectedValue,Ae=2):null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.SelectedValue>0&&"debitaccount"==pe.DependantOn.toLowerCase()&&(Pe=this.ScreenObject.DebitAccount.SelectedValue,Ae=2),Pe>0&&(K.Join=5==pe.Dependancy?"  JOIN "+this.ScreenObject.GetTableName(pe.CostCenterID)+" CMJ with(nolock) ON a.lft between  CMJ.lft and CMJ.rgt JOIN COM_CostCenterCostCenterMap CM with(nolock) on CM.CostCenterID="+pe.CostCenterID+" and CM.ParentCostCenterID="+Ae+" and CM.ParentNodeID="+Pe.toString()+" and CMJ.NodeID=CM.NodeID ":"  JOIN COM_CostCenterCostCenterMap CM with(nolock) on CM.ParentCostCenterID="+pe.CostCenterID+" and a.NodeID=CM.ParentNodeID \n                                    JOIN "+this.ScreenObject.GetTableName(Ae)+" CMJ with(nolock) ON CM.CostCenterID= "+Ae+"  and CM.NodeID=CMJ.NodeID \n                                    JOIN "+this.ScreenObject.GetTableName(Ae)+" CMJG with(nolock) ON CMJG.lft between  CMJ.lft and CMJ.rgt and CMJG.NodeID="+Pe.toString())}else if(this.ScreenObject.GridDataColumns.Contains(pe.DependantOn+"_Key")&&!o.e.IsEmpty(i[pe.DependantOn+"_Key"])&&parseInt(i[pe.DependantOn+"_Key"])>1)ge=pe.FilterColumn+"="+i[pe.DependantOn+"_Key"].toString();else{var Me=this.ScreenObject._CCFields.find((function(e){return e.DBColumnName.toLowerCase()==pe.DependantOn.toLowerCase()})),ve=0;Me&&Me instanceof C.b&&Me.SelectedValue>0||Me&&Me instanceof p.a&&Me.SelectedValue>0?(ve=Me.SelectedValue,Me.CCID):null!=this.ScreenObject.CreditAccount&&this.ScreenObject.CreditAccount.SelectedValue>0&&"creditaccount"==pe.DependantOn.toLowerCase()?(ve=this.ScreenObject.CreditAccount.SelectedValue,2):null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.SelectedValue>0&&"debitaccount"==pe.DependantOn.toLowerCase()&&(ve=this.ScreenObject.DebitAccount.SelectedValue,2),ve>0&&(ge=pe.FilterColumn+"="+ve.toString())}if(""!=ge.Trim()&&(K.Where=null!=K.FilterCondition&&""!=K.FilterCondition?"and "+ge:ge),s.a.SessionManager.Preferences.BudgetAccount.length>0&&s.a.SessionManager.Preferences.BudgetDimension.length>0&&K.CostCenterID==this.BudgetObj.iBudgetDimension&&this.BudgetObj.AutoLoadBudgetDimension(i,K),this.IsInventoryVoucher&&this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!o.e.IsEmpty(i.ProductID_Key)&&this.ScreenObject.Preferences.ContainsKey("ProductWiseBins")&&Object(l.j)(this.ScreenObject.Preferences.ProductWiseBins)&&this.ScreenObject.Preferences.ContainsKey("BinsDimension")&&parseInt(this.ScreenObject.Preferences.BinsDimension)==K.CostCenterID){var Ge,Ne=" join INV_ProductBins Bin with(nolock) on a.NodeID=Bin.BinNodeID and Bin.NodeID="+o.e.String(i.ProductID_Key)+" and ";if(s.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==s.a.SessionManager.Preferences.EnableLocationWise.toString()&&s.a.SessionManager.Preferences.ContainsKey("LW Bins")&&""!=s.a.SessionManager.Preferences["LW Bins"]&&Object(l.j)(s.a.SessionManager.Preferences["LW Bins"]))if(this.ScreenObject.GridDataColumns.Contains("dcCCNID2_Key"))o.e.IsEmpty(i.dcCCNID2_Key)||(Ne+=" Bin.Location="+i.dcCCNID2_Key.toString()+" and ");else{var Ee=this.ScreenObject._CCFields.find((function(e){return"dcccnid2"==e.DBColumnName.toLowerCase()}));Ee&&Ee instanceof C.b||null!=Ee&&Ee instanceof p.a?Ee.SelectedValue>0&&(Ne+=" Bin.Location="+Ee.SelectedValue+" and "):this.ScreenObject.LocationID>0?Ne+=" Bin.Location="+this.ScreenObject.LocationID+" and ":s.a.SessionManager.LocationID>0&&(Ne+=" Bin.Location="+s.a.SessionManager.LocationID+" and ")}if(s.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==s.a.SessionManager.Preferences.EnableDivisionWise.toString()&&s.a.SessionManager.Preferences.ContainsKey("DW Bins")&&""!=s.a.SessionManager.Preferences["DW Bins"]&&Object(l.j)(s.a.SessionManager.Preferences["DW Bins"]))if(this.ScreenObject.GridDataColumns.Contains("dcCCNID1_Key"))o.e.IsEmpty(i.dcCCNID1_Key)||(Ne+=" Bin.Division="+i.dcCCNID1_Key.toString()+" and ");else{var we=this.ScreenObject._CCFields.find((function(e){return"dcccnid1"==e.DBColumnName.toLowerCase()}));we&&we instanceof C.b||null!=we&&we instanceof p.a?we.SelectedValue>0&&(Ne+=" Bin.Division="+we.SelectedValue+" and "):this.ScreenObject.DivisionID>0?Ne+=" Bin.Division="+this.ScreenObject.DivisionID+" and ":s.a.SessionManager.DivisionID>0&&(Ne+=" Bin.Division="+s.a.SessionManager.DivisionID+" and ")}if(s.a.SessionManager.Preferences.ContainsKey("DimensionwiseBins")&&""!=s.a.SessionManager.Preferences.DimensionwiseBins&&o.e.IsNum(s.a.SessionManager.Preferences.DimensionwiseBins)&&parseInt(s.a.SessionManager.Preferences.DimensionwiseBins)>5e4)if(Ge=parseInt(s.a.SessionManager.Preferences.DimensionwiseBins),this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(Ge-5e4)+"_Key"))o.e.IsEmpty(i["dcCCNID"+(Ge-5e4)+"_Key"])||(Ne+=" Bin.DimNodeID="+i["dcCCNID"+(Ge-5e4)+"_Key"].toString()+" and ");else{var Fe=this.ScreenObject._CCFields.find((function(e){return e.DBColumnName.toLowerCase()=="dcccnid"+(Ge-5e4)}));Fe&&Fe instanceof C.b?Fe.SelectedValue>0&&(Ne+=" Bin.DimNodeID="+Fe.SelectedValue+" and "):Fe&&Fe instanceof p.a&&Fe.SelectedValue>0&&(Ne+=" Bin.DimNodeID="+Fe.SelectedValue+" and ")}Ne+=" Bin.BinDimension="+K.CostCenterID.toString(),K.Join+=Ne}}else if(65==K.CostCenterID){var Ve=c;if(""!=Ve.DependantOn){var Le="";if(this.ScreenObject.GridDataColumns.Contains(Ve.DependantOn+"_Key")&&!o.e.IsEmpty(i[Ve.DependantOn+"_Key"])&&parseInt(i[Ve.DependantOn+"_Key"])>1)Le="(FeatureID="+Ve.CostCenterID+" and  FeaturePK="+i[Ve.DependantOn+"_Key"].toString(),Le+=")";else{var Re=this.ScreenObject._CCFields.find((function(e){return e.DBColumnName.toLowerCase()==Ve.DependantOn.toLowerCase()}));Re&&Re instanceof C.b&&Re.SelectedValue>0||null!=Re&&Re instanceof p.a&&Re.SelectedValue>0?(Le="(FeatureID="+Re.CCID+" and  FeaturePK="+Re.SelectedValue.toString(),Le+=")"):"debitaccount"==Ve.DependantOn.toLowerCase()&&null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.SelectedValue>0?(Le="(FeatureID=2 and  FeaturePK="+this.ScreenObject.DebitAccount.SelectedValue.toString(),Le+=")"):"creditaccount"==Ve.DependantOn.toLowerCase()&&null!=this.ScreenObject.CreditAccount&&this.ScreenObject.CreditAccount.SelectedValue>0&&(Le="(FeatureID=2 and  FeaturePK="+this.ScreenObject.CreditAccount.SelectedValue.toString(),Le+=")")}K.Where=null!=K.FilterCondition&&""!=K.FilterCondition?"and "+Le:Le}}else if(7==K.CostCenterID){var Be=0,xe=0,ke=c;if(this.ScreenObject.GridDataColumns.Contains(ke.DependantOn+"_Key")&&!o.e.IsEmpty(i[ke.DependantOn+"_Key"])&&parseInt(i[ke.DependantOn+"_Key"])>1){var _e=this.ScreenObject.ColumnSource.find((function(e){return null!=e.ValueMember&&e.ValueMember.toLowerCase()==ke.DependantOn.toLowerCase()+"_key"}));_e&&!o.e.IsEmpty(i[ke.DependantOn+"_Key"])&&(xe=_e.CostCenterID,Be=parseInt(i[ke.DependantOn+"_Key"]))}else{var Ke=this.ScreenObject._CCFields.find((function(e){return e.DBColumnName.toLowerCase()==ke.DependantOn.toLowerCase()}));Ke&&Ke instanceof C.b&&Ke.SelectedValue>0&&(Be=Ke.SelectedValue,xe=Ke.CCID)}Be>0&&(K.Join=" JOIN COM_CostCenterCostCenterMap CM with(nolock) on CM.ParentCostCenterID=7 and a.UserID=CM.ParentNodeID \n                                    and CM.CostCenterID="+xe+" and CM.NodeID="+Be)}else K.ProductID=0}}}else n.Cancel=!0}}else n.Cancel=!0}}else n.Cancel=!0}},{key:"OnKeyDown",value:function(e,t){if(t.ctrlKey||112!=t.which)if(t.ctrlKey||113!=t.which)if(t.ctrlKey||114!=t.which)if(t.ctrlKey||116!=t.which)if(t.ctrlKey||117!=t.which)if(t.ctrlKey||118!=t.which)if(t.ctrlKey||119!=t.which)if(t.ctrlKey||121!=t.which){if(t.ctrlKey)if(112==t.which){t.preventDefault();var n=this.SelectedRow;null!=this.SelectedRow&&this.IsInventoryVoucher&&!o.e.IsEmpty(n.DocDetailsID)&&0!=parseInt(n.DocDetailsID)?s.a.page.ShowDialog(new gt.DocumentFlowChartViewModel(!0,"LINEID:"+n.DocDetailsID.toString()+"~"+this.ScreenObject.VoucherNo),pt.DocumentFlowChartComponent):!o.e.IsEmpty(this.ScreenObject.VoucherNo)&&this.ScreenObject.VoucherNo.length>0&&s.a.page.ShowDialog(new gt.DocumentFlowChartViewModel(!0,this.ScreenObject.VoucherNo),pt.DocumentFlowChartComponent)}else 114==t.which?(t.preventDefault(),this.onEidtQuantity("DistributeQty")):116==t.which?(t.preventDefault(),this.onEidtQuantity("Distribute")):117==t.which?(t.preventDefault(),this.onEidtQuantity("Copy")):118==t.which?(t.preventDefault(),this.onEidtQuantity("DistributeGen")):113==t.which&&(t.preventDefault(),this.onDistDim(this.ScreenObject.GridDataObj.getArgsObj(e)))}else t.preventDefault(),this.onEidtQuantity("Quantity");else t.preventDefault(),this.onShowImage(this.ScreenObject.GridDataObj.getArgsObj(e));else t.preventDefault(),this.onFieldCalc(this.ScreenObject.GridDataObj.getArgsObj(e));else t.preventDefault(),this.onCopy(this.ScreenObject.GridDataObj.getArgsObj(e)),this.ScreenObject.GridDataObj.refreshDatawithIDs();else t.preventDefault(),this.onDistribute(this.ScreenObject.GridDataObj.getArgsObj(e));else t.preventDefault(),this.ScreenObject.GridDataObj.commitEdit(),this.onSearchProduct(this.ScreenObject.GridDataObj.getArgsObj(e));else t.preventDefault(),this.onRoundOff(this.ScreenObject.GridDataObj.getArgsObj(e));else t.preventDefault(),s.a.page.ShowDialog(new wt.a(this),Ft.a)}},{key:"Onshortcut",value:function(e,t){switch(e){case"Ctrl+f5":this.onEidtQuantity("Distribute");break;case"Ctrl+f3":this.onEidtQuantity("DistributeQty");break;case"Ctrl+f6":this.onEidtQuantity("Copy");case"Ctrl+f7":this.onEidtQuantity("DistributeGen");break;case"f5":this.onDistribute(t);break;case"Ctrl+f2":this.onDistDim(t);break;case"f6":this.onCopy(t),this.ScreenObject.GridDataObj.refreshDatawithIDs();break;case"f2":this.onRoundOff(t);break;case"f3":this.ScreenObject.GridDataObj.commitEdit(),this.onSearchProduct(t);break;case"f8":this.onShowImage(t);break;case"f7":this.onFieldCalc(t);break;case"f1":s.a.page.ShowDialog(new wt.a(this),Ft.a);break;case"Ctrl+f1":var n=this.SelectedRow;null!=this.SelectedRow&&this.IsInventoryVoucher&&!o.e.IsEmpty(n.DocDetailsID)&&0!=parseInt(n.DocDetailsID)?s.a.page.ShowDialog(new gt.DocumentFlowChartViewModel(!0,"LINEID:"+n.DocDetailsID.toString()+"~"+this.ScreenObject.VoucherNo),pt.DocumentFlowChartComponent):!o.e.IsEmpty(this.ScreenObject.VoucherNo)&&this.ScreenObject.VoucherNo.length>0&&s.a.page.ShowDialog(new gt.DocumentFlowChartViewModel(!0,this.ScreenObject.VoucherNo),pt.DocumentFlowChartComponent)}}},{key:"OnFooterKeyDown",value:function(e,t){t.ctrlKey||113!=t.which?t.ctrlKey||116!=t.which||this.DistributeFooter(!1,!0):this.onFooterRoundOff(this.ScreenObject.GridDataObj.getArgsObj(e))}},{key:"FillDt",value:function(e,t,n,a,i,r,s){var c=o.e.Double(a);c<0&&(i=!i,c*=-1);var l=e.find((function(e){return e.AccountID_Key==t&&e.IsRef==n}));l?(parseInt(l.CurrencyID)!=r&&(l.CRAmt=parseFloat(l.CRAmt)*parseFloat(l.ExchangeRate),l.DBAmt=parseFloat(l.DBAmt)*parseFloat(l.ExchangeRate),l.CurrencyID=1,l.ExchangeRate=1,c*=s),i?l.CRAmt=parseFloat(l.CRAmt)+c:l.DBAmt=parseFloat(l.DBAmt)+c):((l={}).AccountID_Key=t,l.IsRef=n,l.CurrencyID=r,l.ExchangeRate=s,i?(l.CRAmt=c,l.DBAmt=0):(l.DBAmt=c,l.CRAmt=0),e.push(l))}},{key:"GenerateLinkClick",value:function(){var e=this;if(this.ScreenObject.Data.Tables.length>20){var t=this.ScreenObject.Data.Tables[20].filter((function(e){return e.CostCenterIDBase>4e4}));if(1==t.length)new Promise((function(n,a){e.genLinkResolve=n,e.GenerateLinkDocument(parseInt(t[0].CostCenterIDBase))})).then((function(t){t||s.a.page.ShowDialog(new Q.b(e),K.a)}));else if(t.length>1){var n=new q.a;n.GoToLineViewModel_3(this,t,0),s.a.page.ShowDialog(n,Y.a,{ShowCenter:!0,NoWidth:!0})}}}},{key:"GenerateLinkDocument",value:function(e){var t;(t=this.ScreenObject.Preferences.ContainsKey("PromptDim")&&Object(l.j)(this.ScreenObject.Preferences.PromptDim)?new a(e,"",!1):new a(e,"",!1,this)).DocumentNumber&&t.DocumentNumber.DialogOptions?t.ToLinkParent=this:this.GenerateLinkDocument_Sub1(t)}},{key:"GenerateLinkDocument_Sub1",value:function(e){var t=this;if(!e.DialogResult)return this.genLinkResolve&&this.genLinkResolve(!1),!1;if((e.ScreenObject.Preferences.ContainsKey("Debit Account")&&Object(l.j)(e.ScreenObject.Preferences["Debit Account"])||e.ScreenObject.Preferences.ContainsKey("LinkVendorProducts")&&Object(l.j)(e.ScreenObject.Preferences.LinkVendorProducts))&&null!=e.ScreenObject.DebitAccount)if(10==e.DocumentType&&null!=this.ScreenObject.CreditAccount)e.ScreenObject.DebitAccount.SelectedValue=this.ScreenObject.CreditAccount.SelectedValue;else if(null!=this.ScreenObject.DebitAccount)e.ScreenObject.DebitAccount.SelectedValue=this.ScreenObject.DebitAccount.SelectedValue;else if(this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")){for(var n=this.ScreenObject.ColumnSource.find((function(e){return!o.e.IsEmpty(e.ValueMember)&&"creditaccount_key"==e.ValueMember.toLowerCase()})),a="",i=0;i<this.ScreenObject.GridData.length;i++)o.e.IsEmpty(this.ScreenObject.GridData[i].DebitAccount_Key)||(a+=this.ScreenObject.GridData[i].DebitAccount_Key.toString()+",");a.length>0&&(a=" a.accountid in("+a.substr(0,a.length-1)+")");var r=new q.a;r.GoToLineViewModel_4(this,2,2),n&&(r.Title="Select "+n.Header,r.Label=n.Header),r.Dimension.CustomWhere=a,s.a.page.ShowDialog(r,Y.a),r.Dimension.SelectedValue>0&&(e.ScreenObject.DebitAccount.SelectedValue=r.Dimension.SelectedValue)}if((e.ScreenObject.Preferences.ContainsKey("Credit Account")&&Object(l.j)(e.ScreenObject.Preferences["Credit Account"])||e.ScreenObject.Preferences.ContainsKey("LinkVendorProducts")&&Object(l.j)(e.ScreenObject.Preferences.LinkVendorProducts))&&null!=e.ScreenObject.CreditAccount)if(6==e.DocumentType&&null!=this.ScreenObject.DebitAccount)e.ScreenObject.CreditAccount.SelectedValue=this.ScreenObject.DebitAccount.SelectedValue;else if(null!=this.ScreenObject.CreditAccount)e.ScreenObject.CreditAccount.SelectedValue=this.ScreenObject.CreditAccount.SelectedValue;else if(this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")){for(var c=this.ScreenObject.ColumnSource.find((function(e){return!o.e.IsEmpty(e.ValueMember)&&"creditaccount_key"==e.ValueMember.toLowerCase()})),u="",d=0;d<this.ScreenObject.GridData.length;d++)o.e.IsEmpty(this.ScreenObject.GridData[d].CreditAccount_Key)||(u+=this.ScreenObject.GridData[d].CreditAccount_Key.toString()+",");u.length>0&&(u=" a.accountid in("+u.substr(0,u.length-1)+")");var D=new q.a;D.GoToLineViewModel_4(this,2,2),c&&(D.Title="Select "+c.Header,D.Label=c.Header),D.Dimension.CustomWhere=u,s.a.page.ShowDialog(D,Y.a),D.Dimension.SelectedValue>0&&(e.ScreenObject.CreditAccount.SelectedValue=D.Dimension.SelectedValue)}if(e.ScreenObject.Preferences.ContainsKey("DimensionWise")&&""!=e.ScreenObject.Preferences.DimensionWise&&e.ScreenObject.Preferences.DimensionWise.split(",").forEach((function(n){if(""!=n){var a=parseInt(n);if(3==a){var i=e.ScreenObject._TextFields.find((function(e){return e instanceof C.b&&3==e.CCID}));if(i){var r=t.ScreenObject._TextFields.find((function(e){return e instanceof C.b&&3==e.CCID}));r&&r.SelectedValue>0&&(i.SelectedValue=r.SelectedValue)}}else if(a>5e4){var s=e.ScreenObject._CCFields.find((function(e){return e instanceof C.b&&e.CCID==a}));if(s){var o=t.ScreenObject._CCFields.find((function(e){return e instanceof C.b&&e.CCID==a}));null!=o&&o.SelectedValue>0&&(s.SelectedValue=o.SelectedValue)}}}})),null!=e.ScreenObject.Link&&null!=e.ScreenObject.Link.LinkCombo){if(1==e.ScreenObject.Link.LinkCombo.Items.length)e.ScreenObject.Link.LinkCombo.SelectedValue=e.ScreenObject.Link.LinkCombo.Items[0].Value,e.OLinkSelectionChanged(null);else{var h=e.ScreenObject.Link.LinkCombo.Items.find((function(e){return null!=e.Parent&&e.Parent==t.CostCenterID.toString()}));h&&(e.ScreenObject.Link.LinkCombo.SelectedValue=h.Value,e.OLinkSelectionChanged(null))}var S=e.ScreenObject.Link.DocumentList.Items.find((function(e){return e.Value==t.ScreenObject.DocID.toString()}));if(!S)return this.genLinkResolve&&this.genLinkResolve(!1),!1;if(S.IsChecked=!0,e.IsFirstCallSelective=!0,e.OnLinkDocumentCheckedChanged(S),!e.DialogResult)return this.genLinkResolve&&this.genLinkResolve(!1),!1}return e.RefreshGridFooter||(e.RefreshGridFooter=!0),s.a.page.addNewTab({component:x.AddEditDocumentComponent,params:{obj:e}}),this.genLinkResolve&&this.genLinkResolve(!0),!0}},{key:"PrepareJV",value:function(){var e=this,t=[],n=[];n.push("AccountCode"),n.push("AccountID"),n.push("AccountID_Key"),n.push("CRAmt"),n.push("DBAmt"),n.push("IsRef"),n.push("CurrencyID"),n.push("ExchangeRate"),n.push("CRAmtFC"),n.push("DBAmtFC");var a=!0;this.ScreenObject.Preferences.ContainsKey("DonotupdateAccounts")&&""!=this.ScreenObject.Preferences.DonotupdateAccounts&&(a=Object(l.j)(this.ScreenObject.Preferences.DonotupdateAccounts));for(var i=1,r=1,c=0;c<this.ScreenObject.GridData.length;c++)for(var u=0;u<this.ScreenObject.ColumnSource.length;u++)if(i=this.GetCurrencyID(c),r=this.GetExchRate(c),3==this.ScreenObject.ColumnSource[u].SectionID&&!a&&(3==this.ScreenObject.ColumnSource[u].PostingType||4==this.ScreenObject.ColumnSource[u].PostingType)||!this.IsInventoryVoucher&&(3==this.ScreenObject.ColumnSource[u].PostingType||4==this.ScreenObject.ColumnSource[u].PostingType||"amount"==this.ScreenObject.ColumnSource[u].DisplayMember.toLowerCase()||"debitamount"==this.ScreenObject.ColumnSource[u].DisplayMember.toLowerCase()||"creditamount"==this.ScreenObject.ColumnSource[u].DisplayMember.toLowerCase())){var d=o.e.String(this.ScreenObject.GridData[c][this.ScreenObject.ColumnSource[u].DisplayMember]);if(this.ScreenObject.ColumnSource[u].DisplayMember.toLowerCase().Contains("dcnum")&&(d=o.e.String(this.ScreenObject.GridData[c]["dcCalc"+this.ScreenObject.ColumnSource[u].DisplayMember]),this.ScreenObject.GridDataColumns.Contains("dcExchRT"+this.ScreenObject.ColumnSource[u].DisplayMember.toLowerCase().replace("dcnum","").toString())&&this.ScreenObject.GridDataColumns.Contains("dcCurrID"+this.ScreenObject.ColumnSource[u].DisplayMember.toLowerCase().replace("dcnum","").toString()+"_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[c]["dcCurrID"+this.ScreenObject.ColumnSource[u].DisplayMember.toLowerCase().replace("dcnum","").toString()+"_Key"])&&(i=parseInt(this.ScreenObject.GridData[c]["dcCurrID"+this.ScreenObject.ColumnSource[u].DisplayMember.toLowerCase().replace("dcnum","").toString()+"_Key"]),r=parseFloat(this.ScreenObject.GridData[c]["dcExchRT"+this.ScreenObject.ColumnSource[u].DisplayMember.toLowerCase().replace("dcnum","").toString()]))),""!=d&&0!=o.e.Double(d)){var D=0,h=0,S=!1,m=!1;this.ScreenObject.ColumnSource[u].DrRefColID>0?(D=this.ScreenObject.ColumnSource[u].DrRefColID,m=!0):this.ScreenObject.ColumnSource[u].DebitAccount>0?D=this.ScreenObject.ColumnSource[u].DebitAccount:null!=this.ScreenObject.DebitAccount?D=this.ScreenObject.DebitAccount.SelectedValue:this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[c].DebitAccount_Key)&&(D=parseInt(this.ScreenObject.GridData[c].DebitAccount_Key)),this.ScreenObject.ColumnSource[u].CrRefColID>0?(h=this.ScreenObject.ColumnSource[u].CrRefColID,S=!0):this.ScreenObject.ColumnSource[u].CreditAcount>0?h=this.ScreenObject.ColumnSource[u].CreditAcount:null!=this.ScreenObject.CreditAccount?h=this.ScreenObject.CreditAccount.SelectedValue:this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[c].CreditAccount_Key)&&(h=parseInt(this.ScreenObject.GridData[c].CreditAccount_Key)),this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[c].AccountID_Key)&&"debitamount"==this.ScreenObject.ColumnSource[u].DisplayMember.toLowerCase()&&!o.e.IsEmpty(this.ScreenObject.GridData[c].DebitAmount)&&parseFloat(this.ScreenObject.GridData[c].DebitAmount)>0&&(D=parseInt(this.ScreenObject.GridData[c].AccountID_Key)),this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[c].AccountID_Key)&&"creditamount"==this.ScreenObject.ColumnSource[u].DisplayMember.toLowerCase()&&!o.e.IsEmpty(this.ScreenObject.GridData[c].CreditAmount)&&parseFloat(this.ScreenObject.GridData[c].CreditAmount)>0&&(h=parseInt(this.ScreenObject.GridData[c].AccountID_Key)),h>0&&this.FillDt(t,h.toString(),S,d,!0,i,r),D>0&&this.FillDt(t,D.toString(),m,d,!1,i,r)}}for(var b=function(n){var s=0,c=e.ScreenObject.ColumnSource.find((function(t){return t.DisplayMember==o.e.String(e.ScreenObject.FooterGridData[n].ColumnName)}));if(s=o.e.Double(e.ScreenObject.FooterGridData[n].CalcAmount),c&&0!=s&&!a&&(3==c.PostingType||4==c.PostingType)){e.ScreenObject.FooterColumnSource.length>4&&e.ScreenObject.FooterColumnSource[4].IsVisible&&!o.e.IsEmpty(e.ScreenObject.FooterGridData[n].CreditAccount)&&parseInt(e.ScreenObject.FooterGridData[n].CreditAccount)>0&&(c.CreditAcount=parseInt(e.ScreenObject.FooterGridData[n].CreditAccount));var l=0,u=0,d=!1,D=!1;if(c.DrRefColID>0)l=c.DrRefColID,D=!0;else if(e.ScreenObject.FooterColumnSource.length>3&&e.ScreenObject.FooterColumnSource[3].IsVisible&&!o.e.IsEmpty(e.ScreenObject.FooterGridData[n].DebitAccount)&&parseInt(e.ScreenObject.FooterGridData[n].DebitAccount)>0)l=parseInt(e.ScreenObject.FooterGridData[n].DebitAccount);else if(c.DebitAccount>0)l=c.DebitAccount;else if(null!=e.ScreenObject.DebitAccount)l=e.ScreenObject.DebitAccount.SelectedValue;else if(e.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")){e.DistributeValues("dcCalc"+c.DisplayMember,s,""!=c.DistributeColName?c.DistributeColName:"Gross",!1);for(var h=0;h<e.ScreenObject.GridData.length;h++)o.e.IsEmpty(e.ScreenObject.GridData[h].ProductID_Key)||o.e.IsEmpty(e.ScreenObject.GridData[h].DebitAccount_Key)||o.e.IsEmpty(e.ScreenObject.GridData[h]["dcCalc"+c.DisplayMember])||(e.ScreenObject.GridDataColumns.Contains("dcExchRT"+c.DisplayMember.toLowerCase().replace("dcnum","").toString())&&e.ScreenObject.GridDataColumns.Contains("dcCurrID"+c.DisplayMember.toLowerCase().replace("dcnum","").toString()+"_Key")&&!o.e.IsEmpty(e.ScreenObject.GridData[h]["dcCurrID"+c.DisplayMember.toLowerCase().replace("dcnum","").toString()+"_Key"])&&(i=parseInt(e.ScreenObject.GridData[h]["dcCurrID"+c.DisplayMember.toLowerCase().replace("dcnum","").toString()+"_Key"].toString()),r=parseFloat(e.ScreenObject.GridData[h]["dcExchRT"+c.DisplayMember.toLowerCase().replace("dcnum","").toString()].toString())),e.FillDt(t,e.ScreenObject.GridData[h].DebitAccount_Key.toString(),!1,e.ScreenObject.GridData[h]["dcCalc"+c.DisplayMember].toString(),!1,i,r))}if(c.CrRefColID>0)u=c.CrRefColID,d=!0;else if(e.ScreenObject.FooterColumnSource.length>4&&e.ScreenObject.FooterColumnSource[4].IsVisible&&!o.e.IsEmpty(e.ScreenObject.FooterGridData[n].CreditAccount)&&parseInt(e.ScreenObject.FooterGridData[n].CreditAccount)>0)u=parseInt(e.ScreenObject.FooterGridData[n].CreditAccount);else if(c.CreditAcount>0)u=c.CreditAcount;else if(null!=e.ScreenObject.CreditAccount)u=e.ScreenObject.CreditAccount.SelectedValue;else if(e.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")){e.DistributeValues("dcCalc"+c.DisplayMember,s,""!=c.DistributeColName?c.DistributeColName:"Gross",!1);for(var S=0;S<e.ScreenObject.GridData.length;S++)o.e.IsEmpty(e.ScreenObject.GridData[S].ProductID_Key)||o.e.IsEmpty(e.ScreenObject.GridData[S].CreditAccount_Key)||o.e.IsEmpty(e.ScreenObject.GridData[S]["dcCalc"+c.DisplayMember])||(e.ScreenObject.GridDataColumns.Contains("dcExchRT"+c.DisplayMember.toLowerCase().replace("dcnum","").toString())&&e.ScreenObject.GridDataColumns.Contains("dcCurrID"+c.DisplayMember.toLowerCase().replace("dcnum","").toString()+"_Key")&&!o.e.IsEmpty(e.ScreenObject.GridData[S]["dcCurrID"+c.DisplayMember.toLowerCase().replace("dcnum","").toString()+"_Key"])&&(i=parseInt(e.ScreenObject.GridData[S]["dcCurrID"+c.DisplayMember.toLowerCase().replace("dcnum","").toString()+"_Key"].toString()),r=parseFloat(e.ScreenObject.GridData[S]["dcExchRT"+c.DisplayMember.toLowerCase().replace("dcnum","").toString()].toString())),e.FillDt(t,e.ScreenObject.GridData[S].CreditAccount_Key.toString(),!1,e.ScreenObject.GridData[S]["dcCalc"+c.DisplayMember].toString(),!0,i,r))}e.ScreenObject.FooterGridDataColumns.Contains("dcCurrID_Key")&&("-3"==o.e.String(e.ScreenObject.FooterGridData[n].dcCurrID_Key)?(i=c.CurrID,r=c.ExhcgRt):"-1"!=o.e.String(e.ScreenObject.FooterGridData[n].dcCurrID_Key)||null==e.Currency||o.e.IsEmpty(e.Currency.Currency.SelectedValue)?""!=o.e.String(e.ScreenObject.FooterGridData[n].dcCurrID_Key)&&(i=parseInt(e.ScreenObject.FooterGridData[n].dcCurrID_Key.toString()),r=parseFloat(e.ScreenObject.FooterGridData[n].dcExchRT.toString())):(i=parseInt(e.Currency.Currency.SelectedValue),r=parseFloat(e.Currency.ExchangeRate.Text))),u>0&&e.FillDt(t,u.toString(),d,s.toString(),!0,i,r),l>0&&e.FillDt(t,l.toString(),D,s.toString(),!1,i,r)}},C=0;C<this.ScreenObject.FooterGridData.length;C++)b(C);null!=this.POSPayModes&&this.POSPayModes.GridData.length>0&&function(){for(var n,s=[],c=function(t){if(o.e.IsEmpty(e.POSPayModes.GridData[t].ColumnName))return"continue";"13"==e.POSPayModes.GridData[t].Type.toString()&&(e.POSPayModes.RedeemPoints=parseFloat(e.POSPayModes.GridData[t].Amount));var a=s.filter((function(n){return n.ColumnName==e.POSPayModes.GridData[t].ColumnName}));0==a.length?((n={}).Name=e.POSPayModes.GridData[t].Name.toString(),n.ColumnName=e.POSPayModes.GridData[t].ColumnName.toString(),n.Amount=e.POSPayModes.GridData[t].Amount.toString(),n.Description=e.POSPayModes.GridData[t].Description.toString(),n.Details=e.POSPayModes.GridData[t].Details.toString(),n.Denomination=o.e.StringValue(e.POSPayModes.GridData[t].Denomination),s.push(n)):((n=a[0]).Amount=parseFloat(n.Amount)+parseFloat(e.POSPayModes.GridData[t].Amount),n.Details=n.Details.toString()+e.POSPayModes.GridData[t].Details.toString(),n.Denomination=o.e.StringValue(n.Denomination)+o.e.StringValue(e.POSPayModes.GridData[t].Denomination))},l=0;l<e.POSPayModes.GridData.length;l++)c(l);o.e.IsEmpty(e.POSPayModes.Return)||!o.e.IsNum(e.POSPayModes.Return)||o.e.IsEmpty(e.POSPayModes.Returnfld)||((n={}).Name=e.POSPayModes.ReturnLabel,n.ColumnName=e.POSPayModes.Returnfld,n.Amount=e.POSPayModes.Return.replace("-",""),e.POSpayXml='<XML Amount="'+n.Amount.toString()+'" DBColumnName="'+e.POSPayModes.Returnfld+'" ',e.POSpayXml+=' RegisterID="'+e.ScreenObject.RegisterNodeID+'" ',e.POSpayXml+=' ShiftID="'+e.ScreenObject.ShiftNodeID+'" ',e.POSpayXml+=' DocDate="'+e.DocumentDate.ToString("dd/MMM/yyyy")+'" ',e.POSpayXml+=' Type="12" />',n.Details=e.POSpayXml,s.push(n),e.POSpayXml="");for(var u=function(n){var c=e.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName==s[n].ColumnName}));if(!(a||"3"!=c[0].PostingType.toString()&&"4"!=c[0].PostingType.toString()||o.e.IsEmpty(s[n].Amount)||0==parseFloat(s[n].Amount))){var l=0,u=0,d=!1,D=!1;o.e.IsEmpty(c[0].DrRefColID)?o.e.IsEmpty(c[0].DebitAccount)?null!=e.ScreenObject.DebitAccount&&(l=e.ScreenObject.DebitAccount.SelectedValue):l=parseInt(c[0].DebitAccount):(l=parseInt(c[0].DrRefColID),D=!0),o.e.IsEmpty(c[0].CrRefColID)?o.e.IsEmpty(c[0].CreditAccount)?null!=e.ScreenObject.CreditAccount&&(u=e.ScreenObject.CreditAccount.SelectedValue):u=parseInt(c[0].CreditAccount):(u=parseInt(c[0].CrRefColID),d=!0),u>0&&e.FillDt(t,u.toString(),d,s[n].Amount.toString(),!0,i,r),l>0&&e.FillDt(t,l.toString(),D,s[n].Amount.toString(),!1,i,r)}},d=0;d<s.length;d++)u(d)}();var y="2";s.a.SessionManager.Preferences.ContainsKey("DecimalsinAmount")&&(y=s.a.SessionManager.Preferences.DecimalsinAmount);for(var p=[],g="",f="",O=0;O<t.length;O++){var I=t[O];if(parseFloat(I.CRAmt)>0&&parseFloat(I.DBAmt)>0)if(parseFloat(I.CRAmt)>parseFloat(I.DBAmt)){if(0==parseFloat((parseFloat(I.CRAmt)-parseFloat(I.DBAmt)).ToString("N2"))){p.push(I);continue}I.CRAmt=parseFloat(I.CRAmt)-parseFloat(I.DBAmt),I.DBAmt=0}else if(parseFloat(I.DBAmt)>parseFloat(I.CRAmt)){if(0==parseFloat((parseFloat(I.DBAmt)-parseFloat(I.CRAmt)).ToString("N2"))){p.push(I);continue}I.DBAmt=parseFloat(I.DBAmt)-parseFloat(I.CRAmt),I.CRAmt=0}else if(parseFloat(I.DBAmt)==parseFloat(I.CRAmt)){p.push(I);continue}parseFloat(I.CRAmt)>0&&(I.CRAmt=parseFloat(I.CRAmt).ToString("N"+y)),parseFloat(I.DBAmt)>0&&(I.DBAmt=parseFloat(I.DBAmt).ToString("N"+y)),parseFloat(I.DBAmt)!=parseFloat(I.CRAmt)?!o.e.IsEmpty(I.IsRef)&&Object(l.j)(I.IsRef)?(""!=f&&(f+=","),f+=I.AccountID_Key.toString()):(""!=g&&(g+=","),g+=I.AccountID_Key.toString()):p.push(I)}""==g&&(g="0");var T,j=this.ScreenObject.GetNames(g,f);null!=j&&j.Tables.length>0&&!j.Columns[0].Contains("ErrorMessage")&&t.forEach((function(e){Object(l.j)(e.IsRef)&&j.Tables.length>1?(T=j.Tables[1].filter((function(t){return t.CostCenterColID==e.AccountID_Key}))).length>0&&(e.AccountID=T[0][Object.keys(T[0])[1]].toString(),e.AccountCode=T[0][Object.keys(T[0])[1]].toString()):(T=j.Tables[0].filter((function(t){return t.AccountId==e.AccountID_Key}))).length>0&&(e.AccountID=T[0][Object.keys(T[0])[1]].toString(),e.AccountCode=T[0][Object.keys(T[0])[2]].toString())}));p.forEach((function(e){t.Remove(e)}));var P=new k.ShowJVViewModel;P.ShowJVViewModel_3(t),s.a.page.ShowDialog(P,_.ShowJVComponent,{ShowCenter:!0,Title:P.Title})}},{key:"onButtonClick",value:function(e){var t,i;return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function r(){var c,u,d,D,h,b,g,O,I,T,j,P,A,M,v,G,N,w,F,V,L,H,W,Z,$,ee,te,ne,ae,ie,re,se,oe,ce,le,he,me,be,Ce,ye,pe,ge,fe,Te,je,Pe,Ae,Ne,Fe,Ve,Le,Qe,He,Ue,et,tt,nt,at,it,rt,st,ot,lt,ut,dt,St,mt,bt,Ct,ft,Tt,jt,Pt,Mt,vt,Gt,Nt,Et,wt,Ft,Lt,Rt,_t,Kt,Qt,Wt,Ut,Xt,qt,Yt,zt,Jt,$t,en,tn,nn,an,rn,sn,on,cn,ln,un,dn,Dn,hn,Sn,mn,bn,Cn,yn,pn,gn,fn,On,In,Tn,jn,Pn,An,Mn,vn,Gn,Nn,En,wn,Fn,Vn,Ln,Rn,Bn,xn,kn,_n,Kn,Qn,Hn,Wn,Un,Xn,qn,Yn,zn,Jn,Zn,$n,ea=this;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.isCheckIn=this.isCheckOut=!1,(null===(t=this.ScreenObject.GridDataObj.angularGrid)||void 0===t?void 0:t.slickGrid)&&(null===(i=this.ScreenObject.GridDataObj.angularGrid)||void 0===i?void 0:i.slickGrid.getActiveCellNode())&&((c=this.ScreenObject.GridDataObj.angularGrid.slickGrid.getActiveCell())&&0===c.cell&&0===c.row||this.ScreenObject.GridDataObj.angularGrid.slickGrid.gotoCell(0,0),this.ScreenObject.GridDataObj.angularGrid.slickGrid.getEditorLock().commitCurrentEdit()),this.ButtonsPopUp=!1,!(e instanceof C.b||e instanceof p.a)){r.next=8;break}return u=null,e instanceof C.b?u=e:e instanceof p.a&&((u=e.Name).Label=e.Label),(d=new C.b).CCID=u.CCID,d.TypeID=u.TypeID,d.CustomWhere=u.CustomWhere,u.IsReadOnly=!1,D=new Je.PactListSearchViewModel(u),r.abrupt("return",void s.a.page.ShowDialog(D,yt.a,{ShowCenter:!0}));case 8:if("CancelDialog"!=e.toString()){r.next=12;break}s.a.page.HideDialog(),r.next=630;break;case 12:if("Cancel"!=e.toString()){r.next=16;break}this.SetVisibiltiFalse(),this.IsPOs?this.ProductSearchVisibility=!0:this.SetDefaultRightPanel(),r.next=630;break;case 16:if(this.Unit_keyOnBeginEditValue="",this.Unit_keyOnBeginEditText="",!e.toString().startsWith("Documents ")){r.next=18;break}return r.abrupt("return",(e=e.toString().replace("Documents ",""),void this.OnDocLinkClick(e)));case 18:if(!e.toString().startsWith("Reports ")){r.next=20;break}return r.abrupt("return",(e=e.toString().replace("Reports ",""),void this.OnReportsLinkClick(e)));case 20:if(85!=this.DocumentType||!s.a.SessionManager.Preferences.ContainsKey("ConsiderGradeWiseSalarySlabs")||"True"!=s.a.SessionManager.Preferences.ConsiderGradeWiseSalarySlabs||"PickMin"!=e.toString()&&"PickMax"!=e.toString()){r.next=27;break}if(b=0,null==(g=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})))||null==g){r.next=26;break}if(!(g instanceof p.a&&0==g.SelectedValue)){r.next=25;break}return r.abrupt("return",(this.DisplayMessage="Select Employee First, and Employee should be in Header",void(this.MessageVisibility=!0)));case 25:b=g.SelectedValue;case 26:b>0&&(this.ScreenObject.GridDataObj.Clear(),this.FillComponentsBasedOnGradeSlabs(b,e.toString()));case 27:if(68!=this.DocumentType||"Save"!=e.toString()){r.next=31;break}if(new Date,new Date,T=this.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()})),O=T.Date,T=this.ScreenObject._TextFields.find((function(e){return"dcalpha4"==e.DBColumnName.toLowerCase()})),I=T.Date,!(O>I)){r.next=31;break}return r.abrupt("return",(this.DisplayMessage="'From Payroll Month' should be less than or equal to 'To Payroll Month'",void(this.MessageVisibility=!0)));case 31:r.t0=e.toString(),r.next="next"===r.t0?34:"prev"===r.t0?36:"Load"===r.t0?38:"Check-in"===r.t0?40:"Check-out"===r.t0?99:"New"===r.t0?159:"Duplicate"===r.t0?167:"Redeposit"===r.t0?172:"QtyAdjustment"===r.t0?174:"Print"===r.t0?176:"PrintPreview"===r.t0?186:"Save"===r.t0||"SaveonHold"===r.t0||"SaveAndPrint"===r.t0||"SaveAndBarcode"===r.t0?189:"AdjustDownPay"===r.t0?193:"PostBills"===r.t0?199:"Lock"===r.t0?201:"Advance"===r.t0?202:"Post Billwise"===r.t0?212:"DependantOK"===r.t0?214:"Exit"===r.t0?222:"Options"===r.t0?233:"SearchSKU"===r.t0?245:"OK"===r.t0?247:"Checkout"===r.t0?251:"Pack"===r.t0?255:"Revise"===r.t0?257:"GST"===r.t0?261:"API"===r.t0?263:"Pay"===r.t0?264:"PostStock"===r.t0?287:"ShowJV"===r.t0?291:"GenerateLink"===r.t0?293:"EInv"===r.t0?295:"SearchData"===r.t0?297:"Activities"===r.t0?299:"LoadDraft"===r.t0?308:"GoToLine"===r.t0?310:"Cheque"===r.t0?313:"ReEvaluate"===r.t0?315:"ReEvaluateTax"===r.t0?317:"ReEvaluatePrice"===r.t0?319:"Next"===r.t0||"Previous"===r.t0?321:"ChequeDate"===r.t0||"BillDate"===r.t0||"DueDate"===r.t0||"DocDate"===r.t0||"ChequeMaturityDate"===r.t0?325:"Hold"===r.t0?328:"HoldDoc"===r.t0?346:"Release"===r.t0?352:"ChangeLocation"===r.t0?354:"Copy"===r.t0?356:"LoadDocument"===r.t0?358:"SaveDraft"===r.t0?362:"Notes"===r.t0?379:"Attachment"===r.t0?383:"Contacts"===r.t0?387:"CancelAction"===r.t0?391:"ApproveVisiblity"===r.t0?393:"SuspendVisiblity"===r.t0?400:"PriceChart"===r.t0?404:"LinkStatus_Open"===r.t0?408:"LinkStatus_Suspend"===r.t0?410:"Recur"===r.t0?412:"Delete"===r.t0?416:"Suspend"===r.t0?434:"CancelAppReject"===r.t0?454:"Approve"===r.t0||"ApproveandPrint"===r.t0?456:"NoWorkFlow"===r.t0||"NoWorkFlowprint"===r.t0?462:"DocLink"===r.t0?466:"Addresses"===r.t0?468:"Report"===r.t0?470:"Documents"===r.t0?472:"VacCrDaysDetail"===r.t0?474:"Reject"===r.t0?476:"ViewHistory"===r.t0?481:"ContinuousPrint"===r.t0?483:"Bounce"===r.t0?487:"Enquiries"===r.t0?489:"Search"===r.t0?493:"ReviseHistory"===r.t0?495:"DocumentHistory"===r.t0?500:"LINK"===r.t0?505:"LINKMAP"===r.t0?507:"CashDrawer"===r.t0?509:"ViewPaymentTerms"===r.t0?524:"Email"===r.t0?527:"SMS"===r.t0?529:"Close"===r.t0?531:"ConvertCase"===r.t0?540:"Export"===r.t0?542:"Import"===r.t0?550:"SortVisiblity"===r.t0?552:"ImportVisiblity"===r.t0?554:"DistributeInstallments"===r.t0?565:"FillDates"===r.t0?571:"FillGeneralTimings"===r.t0?573:"GetAllEmployees"===r.t0?575:"GetPreviousDay"===r.t0?580:"DailyAttendanceFilter"===r.t0?585:"Validate"===r.t0?593:"VacationContract"===r.t0?596:"TabsPopUp"===r.t0?598:"SkuSearch"===r.t0?609:"ReturnLine"===r.t0?614:"DeleteLine"===r.t0?616:"Docs"===r.t0?618:"SalesReturn"===r.t0?623:"AssignVPT"===r.t0?626:"Assign"===r.t0?629:630;break;case 34:return this.GetData("Next"),r.abrupt("break",630);case 36:return this.GetData("Previous"),r.abrupt("break",630);case 38:return this.LoadDailyAttendanceDocuments(),r.abrupt("break",630);case 40:if(v={Flag:"",Msg:""},this.isCheckIn=!0,console.log("BaseService.SessionManager.EnableGOLOC =>",s.a.SessionManager.EnableGOLOC),r.t1="Yes"==s.a.SessionManager.EnableGOLOC,!r.t1){r.next=48;break}return r.next=47,Zt.a.getCurrentPosition();case 47:M=r.sent;case 48:if(89!=this.DocumentType&&90!=this.DocumentType){r.next=97;break}if(G="",N="",!(w=this.ScreenObject._TextFields.find((function(e){return"dcalpha26"==e.DBColumnName.toLowerCase()})))||w.Date){r.next=52;break}return r.abrupt("return",void(this.DisplayMessage="Select Date then Check-in"));case 52:if(G=w.Date.ToString(!s.a.IsAndroid&&s.a.IsNativeMobile?"dd-MMM-yyyy":"dd/MMM/yyyy"),!(new Date(G).Date()>Date.Today())){r.next=54;break}return r.abrupt("return",void(this.DisplayMessage="Can not allow future dates"));case 54:if(!(w=this.ScreenObject._TextFields.find((function(e){return"dcalpha27"==e.DBColumnName.toLowerCase()})))||w.Date){r.next=56;break}return r.abrupt("return",void(this.DisplayMessage="Select Time then Check-in"));case 56:if(N=w.Date.ToString("HH:mm"),F=-1,89!=this.DocumentType){r.next=62;break}F=0,r.next=76;break;case 62:if(!(this.ScreenObject.SelectedGridRowIndex>=0)){r.next=68;break}if(confirm("Are you sure want to update the selected row.?")){r.next=65;break}return r.abrupt("return");case 65:F=this.ScreenObject.SelectedGridRowIndex,r.next=76;break;case 68:V=0;case 69:if(!(V<this.ScreenObject.GridData.length)){r.next=76;break}if(!o.e.IsEmpty(this.ScreenObject.GridData[V].dcAlpha1_Key)||!o.e.IsEmpty(this.ScreenObject.GridData[V].dcAlpha3_Key)){r.next=73;break}return F=V,r.abrupt("break",76);case 73:V++,r.next=69;break;case 76:if("ProductID_Key",(L=this.ScreenObject.ColumnSource.find((function(e){return null!=e.ValueMember&&e.ValueMember.toLowerCase()=="ProductID_Key".toLowerCase()})))&&!o.e.IsEmpty(L.DefaultValue)&&null!=L.DefaultValueText&&(o.e.Int(L.DefaultValue)>0||-100==o.e.Int(L.DefaultValue))&&(this.ScreenObject.GridData[F].ProductID_Key=L.DefaultValue),this.ScreenObject.GridData[F].Type=1,this.ScreenObject.GridData[F].dcAlpha1=new Date(G).ToString(s.a.SessionManager.Preferences["Date Format"]),this.ScreenObject.GridData[F].dcAlpha1_Key=new Date(G),this.ScreenObject.GridData[F].dcAlpha2=N,this.ScreenObject.GridData[F].dcAlpha2_Key=new Date(G+" "+N),this.ScreenObject.GridData[F].dcAlpha14=o.e.CurrentTimeZoneName(),o.e.IsEmpty(this.ScreenObject.GridData[F].dcAlpha8)&&(this.ScreenObject.GridData[F].dcAlpha8="Web"),H=s.a.common.GetDataSet("PAY042","").Tables[0],this.ScreenObject.GridData[F].dcAlpha28=new Date(H[0].UTCDateTime).ToLocalTime().ToString(s.a.SessionManager.Preferences["Date Format"]),this.ScreenObject.GridData[F].dcAlpha28_Key=new Date(H[0].UTCDateTime).ToLocalTime(),this.ScreenObject.GridData[F].dcAlpha29=new Date(H[0].UTCDateTime).ToLocalTime().ToString("HH:mm"),this.ScreenObject.GridData[F].dcAlpha29_Key=new Date(H[0].UTCDateTime).ToLocalTime(),this.ScreenObject.GridDataObj.updateRow(this.ScreenObject.GridData[F]),this.Celleditend(this.ScreenObject.GridData[F],"dcAlpha1",0),"No"!=s.a.SessionManager.EnableGOLOC){r.next=81;break}return r.abrupt("return",void this.SaveInventoryDocument("Save",!0));case 81:console.log("coordinates.coords.latitude (Check In)"+M.coords.latitude),console.log("coordinates.coords.longitude (Check In)"+M.coords.longitude),console.log("EmpAccessibility In ");try{this.EmpAccessibility(s.a.SessionManager.iEmployee,M.coords.latitude,M.coords.longitude,v)}catch(ta){console.log("Check in Exception:EmpAccessibility"+ta)}if(console.log("EmpAccessibility out "),"200"==v.Flag){r.next=85;break}return r.abrupt("return",(this.DisplayMessage=v.Msg,void alert(v.Msg)));case 85:if("200"!=v.Flag){r.next=97;break}if(!s.a.IsNativeMobile){r.next=93;break}return r.next=89,o.e.UserCurrentLocation();case 89:W=r.sent,console.log("Response GetUsersCurrentAddress Response Obj = "+W),console.log("Response locationobj.coords.latitude = "+W.coords.latitude),o.e.IsEmpty(W)||(this.ScreenObject.GridData[F].dcAlpha6=W.coords.latitude,this.ScreenObject.GridData[F].dcAlpha7=W.coords.longitude,null!=W.address&&(this.ScreenObject.GridData[F].dcAlpha10=W.address.Address1,this.ScreenObject.GridData[F].dcAlpha11=W.address.Address2,this.ScreenObject.GridData[F].dcAlpha12=W.address.City,this.ScreenObject.GridData[F].dcAlpha13=W.address.State,this.ScreenObject.GridData[F].dcAlpha14=W.address.Country,this.ScreenObject.GridData[F].dcAlpha15=W.address.PinCode)),r.next=97;break;case 93:return r.next=95,o.e.GetUsersCurrentAddress(M);case 95:Z=r.sent,console.log("GetUsersCurrentAddress Response Address = "+Z.results[0].formatted),o.e.IsEmpty(Z)?console.log("location not detected"):(this.ScreenObject.GridData[F].dcAlpha6=M.coords.latitude,this.ScreenObject.GridData[F].dcAlpha7=M.coords.longitude,o.e.IsEmpty(Z.status)||200!=Z.status.code||(this.ScreenObject.GridData[F].dcAlpha10=Z.results[0].formatted,this.ScreenObject.GridData[F].dcAlpha11=Z.results[0].formatted,this.ScreenObject.GridData[F].dcAlpha12=Z.results[0].components.city,this.ScreenObject.GridData[F].dcAlpha13=Z.results[0].components.state,this.ScreenObject.GridData[F].dcAlpha14=Z.results[0].components.country,this.ScreenObject.GridData[F].dcAlpha15=Z.results[0].components.postcode));case 97:return"200"==v.Flag&&(this.SaveInventoryDocument("Save",!0),console.log("this.SaveInventoryDocument('Save', true); ")),r.abrupt("break",630);case 99:if(this.isCheckOut=!0,ee={Flag:"",Msg:""},console.log("BaseService.SessionManager.EnableGOLOC =>",s.a.SessionManager.EnableGOLOC),r.t2="Yes"==s.a.SessionManager.EnableGOLOC,!r.t2){r.next=107;break}return r.next=106,Zt.a.getCurrentPosition();case 106:$=r.sent;case 107:if(89!=this.DocumentType&&90!=this.DocumentType){r.next=157;break}if(te="",ne="",!(ae=this.ScreenObject._TextFields.find((function(e){return"dcalpha26"==e.DBColumnName.toLowerCase()})))||ae.Date){r.next=111;break}return r.abrupt("return",void(this.DisplayMessage="Select Date then Check-out"));case 111:if(te=ae.Date.ToString(!s.a.IsAndroid&&s.a.IsNativeMobile?"dd-MMM-yyyy":"dd/MMM/yyyy"),!(new Date(te).Date()>Date.Today())){r.next=113;break}return r.abrupt("return",void(this.DisplayMessage="Can not allow future dates"));case 113:if(!(ae=this.ScreenObject._TextFields.find((function(e){return"dcalpha27"==e.DBColumnName.toLowerCase()})))||ae.Date){r.next=115;break}return r.abrupt("return",void(this.DisplayMessage="Select Time then Check-out"));case 115:if(ne=ae.Date.ToString("HH:mm"),ie=-1,89!=this.DocumentType){r.next=121;break}ie=0,r.next=137;break;case 121:if(!(this.ScreenObject.SelectedGridRowIndex>=0)){r.next=129;break}if(confirm("Are you sure want to update the selected row.?")){r.next=124;break}return r.abrupt("return");case 124:if(!o.e.IsEmpty(this.ScreenObject.GridData[this.ScreenObject.SelectedGridRowIndex].dcAlpha1_Key)){r.next=126;break}return r.abrupt("return",void(this.DisplayMessage="Enter Check-in Date and Time first for the selected row."));case 126:ie=this.ScreenObject.SelectedGridRowIndex,r.next=137;break;case 129:re=this.ScreenObject.GridData.length-1;case 130:if(!(re>=0)){r.next=137;break}if(o.e.IsEmpty(this.ScreenObject.GridData[re].dcAlpha1_Key)&&o.e.IsEmpty(this.ScreenObject.GridData[re].dcAlpha3_Key)){r.next=134;break}return ie=o.e.IsEmpty(this.ScreenObject.GridData[re].dcAlpha3_Key)?re:re+1,r.abrupt("break",137);case 134:re--,r.next=130;break;case 137:if("ProductID_Key",(se=this.ScreenObject.ColumnSource.find((function(e){return null!=e.ValueMember&&e.ValueMember.toLowerCase()=="ProductID_Key".toLowerCase()})))&&!o.e.IsEmpty(se.DefaultValue)&&!o.e.IsEmpty(se.DefaultValueText)&&(o.e.Int(se.DefaultValue)>0||-100==o.e.Int(se.DefaultValue))&&(this.ScreenObject.GridData[ie].ProductID_Key=se.DefaultValue),this.ScreenObject.GridData[ie].Type=1,this.ScreenObject.GridData[ie].dcAlpha3=new Date(te).ToString(s.a.SessionManager.Preferences["Date Format"]),this.ScreenObject.GridData[ie].dcAlpha3_Key=new Date(te),this.ScreenObject.GridData[ie].dcAlpha4=new Date(te+" "+ne).ToString("HH:mm"),this.ScreenObject.GridData[ie].dcAlpha4_Key=new Date(te+" "+ne),this.ScreenObject.GridData[ie].dcAlpha24=o.e.CurrentTimeZoneName(),(null==this.ScreenObject.GridData[ie].dcAlpha18||null==this.ScreenObject.GridData[ie].dcAlpha18||o.e.IsEmpty(this.ScreenObject.GridData[ie].dcAlpha18))&&(this.ScreenObject.GridData[ie].dcAlpha18="Web"),oe=s.a.common.GetDataSet("PAY042","").Tables[0],this.ScreenObject.GridData[ie].dcAlpha30=new Date(oe[0].UTCDateTime).ToLocalTime().ToString(s.a.SessionManager.Preferences["Date Format"]),this.ScreenObject.GridData[ie].dcAlpha30_Key=new Date(oe[0].UTCDateTime).ToLocalTime(),this.ScreenObject.GridData[ie].dcAlpha31=new Date(oe[0].UTCDateTime).ToLocalTime().ToString("HH:mm"),this.ScreenObject.GridData[ie].dcAlpha31_Key=new Date(oe[0].UTCDateTime).ToLocalTime(),this.ScreenObject.GridDataObj.updateRow(this.ScreenObject.GridData[ie]),this.Celleditend(this.ScreenObject.GridData[ie],"dcAlpha3",0),"No"!=s.a.SessionManager.EnableGOLOC){r.next=142;break}return r.abrupt("return",void this.SaveInventoryDocument("Save",!0));case 142:console.log("coordinates.coords.latitude (Check In)"+$.coords.latitude),console.log("coordinates.coords.longitude (Check In)"+$.coords.longitude),console.log("EmpAccessibility In ");try{this.EmpAccessibility(s.a.SessionManager.iEmployee,$.coords.latitude,$.coords.longitude,ee)}catch(ta){console.log("Check Out Exception:EmpAccessibility"+ta)}if(console.log("EmpAccessibility out "),"200"==ee.Flag){r.next=146;break}return r.abrupt("return",(this.DisplayMessage=ee.Msg,void alert(ee.Msg)));case 146:if(!s.a.IsNativeMobile){r.next=153;break}return r.next=149,o.e.UserCurrentLocation();case 149:ce=r.sent,console.log("Response GetUsersCurrentAddress Response Obj = "+ce),console.log("Response locationobj.coords.latitude = "+ce.coords.latitude),o.e.IsEmpty(ce)||(this.ScreenObject.GridData[ie].dcAlpha16=ce.coords.latitude,this.ScreenObject.GridData[ie].dcAlpha17=ce.coords.longitude,null!=ce.address&&(this.ScreenObject.GridData[ie].dcAlpha20=ce.address.Address1,this.ScreenObject.GridData[ie].dcAlpha21=ce.address.Address2,this.ScreenObject.GridData[ie].dcAlpha22=ce.address.City,this.ScreenObject.GridData[ie].dcAlpha23=ce.address.State,this.ScreenObject.GridData[ie].dcAlpha24=ce.address.Country,this.ScreenObject.GridData[ie].dcAlpha25=ce.address.PinCode)),r.next=157;break;case 153:return r.next=155,o.e.GetUsersCurrentAddress($);case 155:le=r.sent,console.log("GetUsersCurrentAddress Response Address = "+le.results[0].formatted),o.e.IsEmpty(le)?console.log("location Address not detected"):(this.ScreenObject.GridData[ie].dcAlpha6=$.coords.latitude,this.ScreenObject.GridData[ie].dcAlpha7=$.coords.longitude,o.e.IsEmpty(le.status)||200!=le.status.code||(this.ScreenObject.GridData[ie].dcAlpha10=le.results[0].formatted,this.ScreenObject.GridData[ie].dcAlpha11=le.results[0].formatted,this.ScreenObject.GridData[ie].dcAlpha12=le.results[0].components.city,this.ScreenObject.GridData[ie].dcAlpha13=le.results[0].components.state,this.ScreenObject.GridData[ie].dcAlpha14=le.results[0].components.country,this.ScreenObject.GridData[ie].dcAlpha15=le.results[0].components.postcode));case 157:return"200"==ee.Flag&&(console.log("SaveInventoryDocument"),this.SaveInventoryDocument("Save",!0)),r.abrupt("break",630);case 159:if(!this.ConfirmDirtyRead()){r.next=166;break}if(!(s.a.SessionManager.Preferences.ContainsKey("ConfirmonNewDocument")&&"TRUE"==s.a.SessionManager.Preferences.ConfirmonNewDocument.toUpperCase()||this.ScreenObject.Preferences.ContainsKey("ConfirmonNewDocument")&&"TRUE"==this.ScreenObject.Preferences.ConfirmonNewDocument.toUpperCase())||(this.res="No",confirm("Do you want New Document?"))){r.next=162;break}return r.abrupt("return");case 162:if(0!=this.ScreenObject.DocID||this.CanInsertDeleteRow()){r.next=164;break}return r.abrupt("return");case 164:he={value:this._Ddate},this.ScreenObject.OnDocPrefixChanged(this.ScreenObject.Prefix,0,0,he,!1),this._Ddate=he.value,this.clear(1),this.ScreenObject.GridDataObj.UpdateFooter(),15==this.DocumentType&&this.BatchPayment();case 166:return r.abrupt("break",630);case 167:for(me=this.ScreenObject.GetEditDataCopy(this.ScreenObject.Prefix,this.ScreenObject.DocPrefix.TextBox.Text,this.CostCenterID.toString()),be={value:this._Ddate},this.ScreenObject.OnDocPrefixChanged(this.ScreenObject.Prefix,0,0,be,!1),this._Ddate=be.value,this.clear(5),this.ScreenObject.LoadEditData(me,!0),null!=this.ViewAttachments&&me.Tables.length>8&&this.ViewAttachments.LoadAttachments(me.Tables[8]),Ce=0;Ce<this.ScreenObject.GridData.length;Ce++)this.IsInventoryVoucher&&this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[Ce].ProductID_Key)&&(this.ScreenObject.GridDataColumns.Contains("LinkedInvDocDetailsID")&&(this.ScreenObject.GridData[Ce].LinkedInvDocDetailsID=null),this.ScreenObject.GridDataColumns.Contains("LinkedFieldName")&&(this.ScreenObject.GridData[Ce].LinkedFieldName=null),this.ScreenObject.GridDataColumns.Contains("RefNo")&&(this.ScreenObject.GridData[Ce].RefNo=null));return this.WfID=0,this.WorkFlowDocLevel=0,this.WFDocLevelList.Clear(),this.StatusID=0,this.CalculateTotals(null,!1),this.RefreshGrid=!0,r.abrupt("break",630);case 172:return this.Redeposit(),r.abrupt("break",630);case 174:return this.ScreenObject.GridDataColumns.Contains("QtyXML")||(this.ScreenObject.GridDataColumns.push("QtyType"),this.ScreenObject.GridDataColumns.push("QtyXML")),this.Setselectedrow(0),s.a.page.ShowDialog(new ue(this,1),de.a,{ShowCenter:!0}),r.abrupt("break",630);case 176:if(null!=(ye=this.GetButton("Print"))&&ye.Visible){r.next=179;break}return r.abrupt("return");case 179:if(this.DisplayMessage="",s.a.SessionManager.IsActionAssigned(43,"Allow Re-Print")){r.next=183;break}if(pe=Ke.VoucherExportExcel.AllowRePrint(this.DocumentID,0,this.DocID),!(parseInt(pe.Tables[0][0].PrintCount)>0)){r.next=183;break}return r.abrupt("return",void(this.DisplayMessage="Re-Print Not Allowed"));case 183:return ge=-1,this.ScreenObject.DocPrefix.RevisionCombo.Visible&&this.ScreenObject.DocPrefix.RevisionCombo.Items.length>1&&this.ScreenObject.DocPrefix.RevisionCombo.SelectedValue!=this.ScreenObject.DocPrefix.RevisionCombo.Items[this.ScreenObject.DocPrefix.RevisionCombo.Items.length-1].Value&&(ge=parseInt(this.ScreenObject.DocPrefix.RevisionCombo.SelectedValue)),this.DisplayMessage=this.PrintVoucher(!1,this.ScreenObject.DocID.toString(),!0,null,ge),this.IsPOs&&null!=this.SKU&&this.SKU.Visible&&this.SKU.IsTabStop&&(this.SKU.SetFocus=!0),r.abrupt("break",630);case 186:return fe=-1,this.ScreenObject.DocPrefix.RevisionCombo.Visible&&this.ScreenObject.DocPrefix.RevisionCombo.Items.length>1&&this.ScreenObject.DocPrefix.RevisionCombo.SelectedValue!=this.ScreenObject.DocPrefix.RevisionCombo.Items[this.ScreenObject.DocPrefix.RevisionCombo.Items.length-1].Value&&(fe=parseInt(this.ScreenObject.DocPrefix.RevisionCombo.SelectedValue)),this.DisplayMessage=this.PrintVoucher(!0,this.ScreenObject.DocID.toString(),!0,null,fe),r.abrupt("break",630);case 189:if(!this.ScreenObject.Preferences.ContainsKey("AlertMessageOnPost")||"True"!=this.ScreenObject.Preferences.AlertMessageOnPost||confirm("Do you want to post document?")){r.next=191;break}return r.abrupt("return");case 191:return this.IsInventoryVoucher?this.SaveInventoryDocument_1(e):this.SaveAccountingDocument(e),r.abrupt("break",630);case 193:if((Te=this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&26425==e.LinkData}))).length>0){r.next=196;break}return r.abrupt("return",void(this.DisplayMessage="Define Advance AR/AP field."));case 196:return(je=new k.ShowJVViewModel).ShowJVViewModel_2(this,Te[0].SysColumnName,2),s.a.page.ShowDialog(je,_.ShowJVComponent,{ShowCenter:!0,Title:je.Title}),r.abrupt("break",630);case 199:return s.a.SessionManager.Preferences.ContainsKey("On")&&"true"==s.a.SessionManager.Preferences.On.toLocaleLowerCase()&&(Pe=0,Ae=!1,1==this.ScreenObject.DocumentType||39==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||6==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||13==this.ScreenObject.DocumentType?(Ae=!0,null!=this.ScreenObject.CreditAccount&&this.ScreenObject.CreditAccount.SelectedValue>0&&(Pe=this.ScreenObject.CreditAccount.SelectedValue)):11!=this.ScreenObject.DocumentType&&38!=this.ScreenObject.DocumentType&&5!=this.ScreenObject.DocumentType&&7!=this.ScreenObject.DocumentType&&9!=this.ScreenObject.DocumentType&&24!=this.ScreenObject.DocumentType&&33!=this.ScreenObject.DocumentType&&10!=this.ScreenObject.DocumentType&&8!=this.ScreenObject.DocumentType&&12!=this.ScreenObject.DocumentType||(Ae=!1,null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.SelectedValue>0&&(Pe=this.ScreenObject.DebitAccount.SelectedValue)),Pe>0&&(this.DialogResult=!1,this.BillWisedt.Clear(),(Ne=new B).BillWiseViewModel_2(this,0,Pe,Ae,1,1,!0,""),this.DialogResult||s.a.page.ShowDialog(Ne,R.a,{ShowCenter:!0}))),r.abrupt("break",630);case 201:return r.abrupt("return",(h=this.GetButton("Lock")).Mandatory?(h.Mandatory=!1,h.Label="Unlock",void(this.DisplayMessage=this.ScreenObject.lockDocument(!0))):(h.Mandatory=!0,h.Label="lock",void(this.DisplayMessage=this.ScreenObject.lockDocument(!1))));case 202:if(!this.ScreenObject.Preferences.ContainsKey("DonotupdateAccounts")||""==this.ScreenObject.Preferences.DonotupdateAccounts||!Object(l.j)(this.ScreenObject.Preferences.DonotupdateAccounts)){r.next=211;break}if(this.ScreenObject.Preferences.ContainsKey("PostVoucherDocument")&&o.e.Int(this.ScreenObject.Preferences.PostVoucherDocument)>4e4){r.next=205;break}return r.abrupt("return");case 205:Fe=0,Ve=this.GridNetTotal+this.FooterGridNetTotal,1==this.ScreenObject.DocumentType||39==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||6==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||13==this.ScreenObject.DocumentType?null!=this.ScreenObject.CreditAccount&&this.ScreenObject.CreditAccount.SelectedValue>0&&(Fe=this.ScreenObject.CreditAccount.SelectedValue):11!=this.ScreenObject.DocumentType&&38!=this.ScreenObject.DocumentType&&5!=this.ScreenObject.DocumentType&&7!=this.ScreenObject.DocumentType&&9!=this.ScreenObject.DocumentType&&24!=this.ScreenObject.DocumentType&&33!=this.ScreenObject.DocumentType&&10!=this.ScreenObject.DocumentType&&8!=this.ScreenObject.DocumentType&&12!=this.ScreenObject.DocumentType||null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.SelectedValue>0&&(Fe=this.ScreenObject.DebitAccount.SelectedValue),Le=1,Qe=1,He=this.IsAccBillWise(Fe),null!=this.Currency&&null!=this.Currency.Currency.SelectedValue&&""!=this.Currency.Currency.SelectedValue&&(Le=parseInt(this.Currency.Currency.SelectedValue)),null!=this.Currency&&null!=this.Currency.ExchangeRate.Text&&""!=this.Currency.ExchangeRate.Text&&(Qe=parseFloat(this.Currency.ExchangeRate.Text)),Ue=new we.PostVoucherSaveViewModel(this,parseInt(this.ScreenObject.Preferences.PostVoucherDocument),Ve,Fe,Le,Qe,He,!1),s.a.page.ShowDialog(Ue,Ee.PostVoucherSaveComponent);case 211:return r.abrupt("break",630);case 212:return s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Post Billwise"),r.abrupt("break",630);case 214:if(s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Define Dependencies")){r.next=216;break}return r.abrupt("return",void(this.DisplayMessage="Access denied."));case 216:if(o.e.IsEmpty(this.SelectedRow.Docdetailsid)||!this.ScreenObject.GridDataColumns.Contains("dcAlpha20")||"open"==this.SelectedRow.dcAlpha20.toString().toLowerCase()){r.next=218;break}return r.abrupt("return",void(this.DisplayMessage="Can not change dependencies as activity is "+this.SelectedRow.dcAlpha20.toString()));case 218:for(et="",tt=0;tt<this.Dependflds.Items.length;tt++)this.Dependflds.Items[tt].IsChecked&&(et.length>0&&(et+=","),et+=this.Dependflds.Items[tt].Value);return this.SelectedRow.dcAlpha12=et.toString(),this.SelectedRow.Dependencies=et.toString(),r.abrupt("break",630);case 222:return r.next=224,n.e(0).then(n.bind(null,"Y4/b"));case 224:return nt=r.sent,at=nt.POSExitComponent,r.next=228,Promise.all([n.e(8),n.e(23),n.e(24),n.e(25),n.e(28),n.e(30),n.e(29),n.e(32),n.e(31),n.e(27),n.e(26),n.e(35),n.e(37),n.e(38),n.e(36),n.e(33),n.e(34),n.e(39),n.e(40),n.e(41),n.e(70)]).then(n.bind(null,"FNqn"));case 228:return it=r.sent,rt=it.POSExitViewModel,(st=new rt).POSExitViewModel_1(this,!1,!1,!1),s.a.page.ShowDialog(st,at,{ShowCenter:!0}),r.abrupt("break",630);case 233:if(!this.IsPOs){r.next=244;break}return r.next=236,n.e(0).then(n.bind(null,"Y4/b"));case 236:return ot=r.sent,lt=ot.POSExitComponent,r.next=240,Promise.all([n.e(8),n.e(23),n.e(24),n.e(25),n.e(28),n.e(30),n.e(29),n.e(32),n.e(31),n.e(27),n.e(26),n.e(35),n.e(37),n.e(38),n.e(36),n.e(33),n.e(34),n.e(39),n.e(40),n.e(41),n.e(70)]).then(n.bind(null,"FNqn"));case 240:ut=r.sent,dt=ut.POSExitViewModel,(St=new dt).POSExitViewModel_1(this,!0,!1,!1),s.a.page.ShowDialog(St,lt,{ShowCenter:!0});case 244:return r.abrupt("break",630);case 245:return null!=this.SKU&&((mt=this.ScreenObject.ColumnSource.find((function(e){return e.CostCenterID.toString()==s.a.SessionManager.Preferences.POSItemCodeDimension})))&&mt.GridViewID>0?s.a.page.ShowDialog(new Je.ProductSearchCatalogViewModel(this,mt.GridViewID,mt.CostCenterID,mt,null),Ze.ProductSearchCatalogComponent):(mt=this.ScreenObject.ColumnSource.find((function(e){return"3"==e.CostCenterID.toString()})))&&mt.GridViewID>0?s.a.page.ShowDialog(new Je.ProductSearchCatalogViewModel(this,mt.GridViewID,mt.CostCenterID,mt,null),Ze.ProductSearchCatalogComponent):this.DisplayMessage=""),r.abrupt("break",630);case 247:if(!this.IsPOs||""!=this.ScreenObject.CCguid){r.next=249;break}return r.abrupt("return");case 249:return this.SaveInventoryDocument_1("Save"),r.abrupt("break",630);case 251:if(!(this.Bal>0)){r.next=253;break}return r.abrupt("return",void(this.DisplayMessage="Pay Balance to check out"));case 253:return this.SaveInventoryDocument_1("Checkout"),r.abrupt("break",630);case 255:return this.ScreenObject.GridDataColumns.Contains("PackType")&&(null!=this.SelectedRow||this.ScreenObject.Preferences.ContainsKey("PackWiseProds")&&"true"==this.ScreenObject.Preferences.PackWiseProds.toLowerCase()||this.ScreenObject.Preferences.ContainsKey("LineWisePacking")&&"true"==this.ScreenObject.Preferences.LineWisePacking.toLowerCase())&&s.a.page.ShowDialog(new ue(this,3),de.a,{ShowCenter:!0}),r.abrupt("break",630);case 257:if(!(this.ScreenObject.DocID>0&&this.IsUserLock)){r.next=259;break}return r.abrupt("return",void(this.DisplayMessage="Document is Locked"));case 259:return s.a.page.ShowDialog(new X.a(this,0),U.a,{ShowCenter:!0}),r.abrupt("break",630);case 261:return s.a.page.ShowDialog(new kt(this),xt.a,{ShowCenter:!0}),r.abrupt("break",630);case 263:return r.abrupt("break",630);case 264:if(!(0==this.DocID&&s.a.SessionManager.Preferences.ContainsKey("PosShifts")&&""!=s.a.SessionManager.Preferences.PosShifts&&parseInt(s.a.SessionManager.Preferences.PosShifts)>5e4&&s.a.SessionManager.IsActionAssigned(this.CostCenterID,"DonotAllowbillingoutofSessionTime"))){r.next=268;break}if(!((bt=this.ScreenObject.Data.Tables[1].filter((function(e){return e.ShiftID==ea.ScreenObject.ShiftNodeID}))).length>0&&!((new Date).toTimeString().slice(0,8)>bt[0].StartTime.toString())&&(new Date).toTimeString().slice(0,8)>bt[0].EndTime.toString())){r.next=268;break}return r.abrupt("return",void(this.DisplayMessage="Session Timed out"));case 268:if(0!=this.POSPayModes.PayModes.length){r.next=270;break}return r.abrupt("return",void this.SaveInventoryDocument_1("CheckoutPrint"));case 270:if(o.e.IsEmpty(this.ScreenObject.GridData[0].ProductID_Key)||!(Ct=this.ScreenObject.ColumnSource.find((function(e){return-1==e.DistributionColID})))||3!=Ct.PostingType&&4!=Ct.PostingType||this.RoundOffValue(this.ScreenObject.GridData[0],Ct),ft=0,this.POSPayModes.BillValue=0,this.POSPayModes.points=0,this.POSPayModes.AvailablePoints=0,this.ScreenObject.Preferences.ContainsKey("UseAsOrder")&&"True"==this.ScreenObject.Preferences.UseAsOrder||null!=(Tt=this.ScreenObject.GetPosPoints(this.DocumentDate))&&Tt.Tables.length>0&&(Tt.Tables[0].length>0&&Tt.Columns[0].Contains("ccAlpha49")&&o.e.Double(Tt.Tables[0][0].ccAlpha49.toString())>0&&o.e.Double(Tt.Tables[0][0].ccAlpha50.toString())>0&&(this.POSPayModes.BillValue=parseFloat(Tt.Tables[0][0].ccAlpha49),this.POSPayModes.points=parseFloat(Tt.Tables[0][0].ccAlpha50)),Tt.Tables.length>1&&Tt.Tables[1].length>0&&Tt.Columns[1].Contains("points")&&!o.e.IsEmpty(Tt.Tables[1][0].points)&&(this.POSPayModes.AvailablePoints=parseFloat(Tt.Tables[1][0].points))),ft=0,this.POSPayModes.Return=""!=this.POSPayModes.ReturnDecimalPoints?(0).ToString("N"+this.POSPayModes.ReturnDecimalPoints).replace("-",""):"0".toString(),(jt=this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&26425==e.LinkData}))).length>0&&!this.ScreenObject.IsDocEdit&&null!=(Pt=this.ScreenObject.GetArApDetails(0,this.DocumentDate,!1))&&Pt.Tables.length>0&&Pt.Columns[0].Contains("DocNo")&&Pt.Tables[0].length>0){for((vt=this.POSPayModes.GridData.filter((function(e){return e.ColumnName==jt[0].SysColumnName}))).length>0?Mt=vt[0]:(Mt=this.POSPayModes.GridDataObj.NewRow(),this.POSPayModes.GridData.length>0?this.POSPayModes.GridData.InsertAt(Mt,0):this.POSPayModes.GridData.push(Mt)),Gt="",Nt=0,Et=0;Et<Pt.Tables[0].length;Et++)!o.e.IsEmpty(Pt.Tables[0][Et].Amount)&&parseFloat(Pt.Tables[0][Et].Amount)>0&&Nt+parseFloat(Pt.Tables[0][Et].Amount)<=this.GridNetTotal+this.FooterGridNetTotal&&(Nt+=parseFloat(Pt.Tables[0][Et].Amount),Gt+='<NonAccRows  RefDocNo="'+Pt.Tables[0][Et].DocNo.toString()+'" Amount="',Gt+=Pt.Tables[0][Et].Amount.toString()+'"  />');this.ArApBills=Gt.toString(),Mt.Name=jt[0].ResourceData.toString(),Mt.Amount=!o.e.IsEmpty(jt[0].Decimal)&&parseFloat(jt[0].Decimal)>=0?Nt.ToString("N"+jt[0].Decimal.toString()):s.a.SessionManager.Preferences.ContainsKey("DecimalsinExtraFields")&&""!=s.a.SessionManager.Preferences.DecimalsinExtraFields?Nt.ToString("N"+s.a.SessionManager.Preferences.DecimalsinExtraFields):Nt,Mt.ColumnName=jt[0].SysColumnName,Mt.Type="1"}for(wt=0;wt<this.POSPayModes.GridData.length;wt++)o.e.IsEmpty(this.POSPayModes.GridData[wt].ColumnName)||o.e.IsEmpty(this.POSPayModes.GridData[wt].Amount)||(ft+=parseFloat(this.POSPayModes.GridData[wt].Amount));if(this.Bal=this.GridNetTotal+this.FooterGridNetTotal-ft,this.Bal<0&&(this.POSPayModes.Return=""!=this.POSPayModes.ReturnDecimalPoints?(this.GridNetTotal+this.FooterGridNetTotal-ft).ToString("N"+this.POSPayModes.ReturnDecimalPoints).replace("-",""):(this.GridNetTotal+this.FooterGridNetTotal-ft).toString().replace("-",""),this.Bal=0),this.POSPayModes.DisplayMessage="",this.POSPayModes.PayModes.length>0&&this.POSPayModes.onClick(this.POSPayModes.PayModes[0].DBColumnName,!1),this.PoleDisplayMessage(3,null),39!=this.ScreenObject.DocumentType||!this.ScreenObject.Preferences.ContainsKey("DonotShowPayModesinReturn")||"TRUE"!=this.ScreenObject.Preferences.DonotShowPayModesinReturn.toUpperCase()){r.next=285;break}if(this.POSPayModes.Selectedbtn=this.POSPayModes.PayModes.find((function(e){return"9"==e.SectionID})),null!=this.POSPayModes.Selectedbtn){r.next=280;break}return r.abrupt("return",void(this.DisplayMessage="Difine PayMode"));case 280:if(this.POSPayModes.OnButtonClick("OK"),""==this.POSPayModes.DisplayMessage){r.next=282;break}return r.abrupt("return",void(this.DisplayMessage=this.POSPayModes.DisplayMessage));case 282:this.SaveInventoryDocument_1("CheckoutPrint"),r.next=286;break;case 285:s.a.page.ShowDialog(this.POSPayModes,Ht.a,{ShowCenter:!0});case 286:return r.abrupt("break",630);case 287:if(this.ScreenObject.Preferences.ContainsKey("PostingDOC")&&""!=this.ScreenObject.Preferences.PostingDOC&&parseInt(this.ScreenObject.Preferences.PostingDOC)>4e4){r.next=289;break}return r.abrupt("return",void(this.DisplayMessage="Define stock posting document"));case 289:return s.a.document.GetDocumentDrafts(0,parseInt(this.ScreenObject.Preferences.PostingDOC),1,!1).subscribe((function(e){if(e.Tables[0].length>0)ea.res="",s.a.page.ShowDialog(new z.DocumentDraftsViewModel(ea,parseInt(ea.ScreenObject.Preferences.PostingDOC),1),J.DocumentDraftsComponent).subscribe((function(){if("No"==ea.res){var e=new q.a;e.GoToLineViewModel_4(ea,0,0),s.a.page.ShowDialog(e,Y.a,{ShowCenter:!0,NoWidth:!0})}}));else{var t=new q.a;t.GoToLineViewModel_4(ea,0,0),s.a.page.ShowDialog(t,Y.a,{ShowCenter:!0,NoWidth:!0})}})),r.abrupt("break",630);case 291:return this.PrepareJV(),r.abrupt("break",630);case 293:return this.GenerateLinkClick(),r.abrupt("break",630);case 295:return this.GetEInv(9),r.abrupt("break",630);case 297:return this.SearchData(),r.abrupt("break",630);case 299:if(this.SetVisibiltiFalse(),null==this.ViewActivities?(this.ViewActivities=new qe.b(this),this.ViewActivities.NodeID=this.DocID,this.NodeID=this.DocID,this.Activities=new Ye.a(this,!1),this.Activities.AssignVisiblity=!1,this.ViewActivities.Activities=this.Activities,this.ViewActivities.CloseVisible=!0):this.NodeID=this.ViewActivities.NodeID=this.DocID,!((Ft=this.ScreenObject.Data.Tables[10].filter(this.NodeID>0?function(e){return-10==e.CostCenterColID&&(2==e.Mode||3==e.Mode)}:function(e){return-10==e.CostCenterColID&&(1==e.Mode||3==e.Mode)})).length>0)){r.next=305;break}if(Object(l.j)(Ft[0].IsVisible.toString())){r.next=302;break}return r.abrupt("return");case 302:this.Activities.Enabled=Object(l.j)(Ft[0].IsEditable.toString()),r.next=306;break;case 305:this.Activities.Enabled=!0;case 306:return this.ScreenObject.IsPurchase?null!=this.ScreenObject.CreditAccount&&this.ScreenObject.CreditAccount.Name.Visible&&(this.Activities.CRMCustomer.Text=this.ScreenObject.CreditAccount.Name.Text):null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.Name.Visible&&(this.Activities.CRMCustomer.Text=this.ScreenObject.DebitAccount.Name.Text),this.ScreenObject.Preferences.ContainsKey("ActivityAsPopUp")&&"True"==this.ScreenObject.Preferences.ActivityAsPopUp.toString()?(this.Activities.Customize=!1,this.Activities.Customize||this.Activities.onViewHistory(null)):s.a.page.ShowDialog(this.Activities,ze.ActivitiesComponent),r.abrupt("break",630);case 308:return s.a.page.ShowDialog(new z.DocumentDraftsViewModel(this,1),J.DocumentDraftsComponent),r.abrupt("break",630);case 310:return(Lt=new q.a).GoToLineViewModel_2(this),s.a.page.ShowDialog(Lt,Y.a,{ShowCenter:!0,NoWidth:!0}),this.SetFocusongrid=!0,r.abrupt("break",630);case 313:return null!=(h=this.GetButton("Pre Payments"))&&h.Visible&&this.ScreenObject.GridData.length>0&&!o.e.IsEmpty(this.ScreenObject.GridData[0].Amount)&&(this.pdcGCVM.Amount.Text=this.ScreenObject.GridData[0].Amount.toString()),this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&this.ScreenObject.GridData.length>0&&!o.e.IsEmpty(this.ScreenObject.GridData[0].CreditAccount_Key)&&this.pdcGCVM.DebitAcc.Visible&&(this.pdcGCVM.DebitAcc.SelectedValue=parseInt(this.ScreenObject.GridData[0].CreditAccount_Key)),this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&this.ScreenObject.GridData.length>0&&!o.e.IsEmpty(this.ScreenObject.GridData[0].DebitAccount_Key)&&this.pdcGCVM.CredAcc.Visible&&(this.pdcGCVM.CredAcc.SelectedValue=parseInt(this.ScreenObject.GridData[0].DebitAccount_Key)),s.a.page.ShowDialog(this.pdcGCVM,Se.a).subscribe((function(){ea.SetFocusongrid=!0})),r.abrupt("break",630);case 315:return s.a.SessionManager.IsActionAssigned(this.CostCenterID,"ReEvaluate")&&this.ReEvaluate(!0),r.abrupt("break",630);case 317:return(s.a.SessionManager.IsActionAssigned(this.CostCenterID,"ReEvaluate")||s.a.SessionManager.IsActionAssigned(this.CostCenterID,"ReEvaluateTaxChart"))&&this.ReEvaluatePriceTax(0,"t"),r.abrupt("break",630);case 319:return(s.a.SessionManager.IsActionAssigned(this.CostCenterID,"ReEvaluate")||s.a.SessionManager.IsActionAssigned(this.CostCenterID,"ReEvaluatePriceChart"))&&this.ReEvaluatePriceTax(0,"p"),r.abrupt("break",630);case 321:if((this.ScreenObject.DocPrefix.NextVisibility||"Next"!=e.toString())&&(this.ScreenObject.DocPrefix.PreviousVisibility||"Previous"!=e.toString())){r.next=323;break}return r.abrupt("return");case 323:return this.GetData(e.toString()),r.abrupt("break",630);case 325:return(Rt=this.ScreenObject.HeaderFields.find((function(t){return t instanceof y.c&&t.DBColumnName==e.toString()})))&&(Rt.SetFocus=!0),r.abrupt("break",630);case 328:if(0==this.DocID){r.next=330;break}return r.abrupt("return",(this.IsPOs&&null!=this.SKU&&this.SKU.Visible&&this.SKU.IsTabStop&&(this.SKU.SetFocus=!0),void(this.DisplayMessage=s.a.GetResource("Documentalreadysaved"))));case 330:if(this.HoldDocDate.Date=this.DocumentDate,38!=this.DocumentType){r.next=343;break}return r.next=333,n.e(0).then(n.bind(null,"Y4/b"));case 333:return _t=r.sent,Kt=_t.POSExitComponent,r.next=337,Promise.all([n.e(8),n.e(23),n.e(24),n.e(25),n.e(28),n.e(30),n.e(29),n.e(32),n.e(31),n.e(27),n.e(26),n.e(35),n.e(37),n.e(38),n.e(36),n.e(33),n.e(34),n.e(39),n.e(40),n.e(41),n.e(70)]).then(n.bind(null,"FNqn"));case 337:Qt=r.sent,Wt=Qt.POSExitViewModel,(Ut=new Wt).POSExitViewModel_1(this,!1,!0,!1),s.a.page.ShowDialog(Ut,Kt,{ShowCenter:!0}),r.next=344;break;case 343:s.a.page.ShowDialog(this,$e.a,{Title:s.a.GetResource("Com_SaveAsHold"),ShowCenter:!0,NoWidth:!0});case 344:return this.IsPOs&&null!=this.SKU&&this.SKU.Visible&&this.SKU.IsTabStop&&(this.SKU.SetFocus=!0),r.abrupt("break",630);case 346:if(0==this.DocID){r.next=348;break}return r.abrupt("return",void(this.DisplayMessage=s.a.GetResource("Documentalreadysaved")));case 348:if(!o.e.IsEmptySpace(this.HoldDocName.Text)){r.next=350;break}return r.abrupt("return",void(this.DisplayMessage="Enter Name"));case 350:return this.SaveDraft(!1,!1),r.abrupt("break",630);case 352:return s.a.page.ShowDialog(new z.DocumentDraftsViewModel(this,2),J.DocumentDraftsComponent).subscribe((function(){ea.IsPOs&&null!=ea.SKU&&ea.SKU.Visible&&ea.SKU.IsTabStop&&(ea.SKU.SetFocus=!0)})),r.abrupt("break",630);case 354:return this.ChangeLocation(!0,!1,s.a.SessionManager.LocationID),r.abrupt("break",630);case 356:return s.a.page.ShowDialog(new Xe(this,!0,this.CostCenterID.toString()),We.a,{ShowCenter:!0,NoWidth:!0}).subscribe((function(){ea.DialogResult&&(ea.CalculateTotals(null,!1),ea.RefreshGrid=!0)})),r.abrupt("break",630);case 358:if(this.ScreenObject.DocPrefix.LoadVisibility){r.next=360;break}return r.abrupt("return");case 360:return this.LoadDOcument(),r.abrupt("break",630);case 362:if(0==this.DocID){r.next=364;break}return r.abrupt("return",void(this.DisplayMessage=s.a.GetResource("Documentalreadysaved")));case 364:if(!this.ScreenObject.Preferences.ContainsKey("RemarksWhileSavingDrafts")||"TRUE"!=this.ScreenObject.Preferences.RemarksWhileSavingDrafts.toUpperCase()){r.next=377;break}return r.next=367,n.e(0).then(n.bind(null,"Y4/b"));case 367:return Xt=r.sent,qt=Xt.POSExitComponent,r.next=371,Promise.all([n.e(8),n.e(23),n.e(24),n.e(25),n.e(28),n.e(30),n.e(29),n.e(32),n.e(31),n.e(27),n.e(26),n.e(35),n.e(37),n.e(38),n.e(36),n.e(33),n.e(34),n.e(39),n.e(40),n.e(41),n.e(70)]).then(n.bind(null,"FNqn"));case 371:Yt=r.sent,zt=Yt.POSExitViewModel,(Jt=new zt).POSExitViewModel_1(this,!1,!1,!0),s.a.page.ShowDialog(Jt,qt,{ShowCenter:!0}).subscribe((function(){ea.SaveDraft(!1,!0)})),r.next=378;break;case 377:this.SaveDraft(!1,!0);case 378:return r.abrupt("break",630);case 379:if(null!=(h=this.GetButton("Notes"))&&h.Visible){r.next=381;break}return r.abrupt("return");case 381:return this.OnAddNote(),this.SetVisibiltiFalse(),s.a.page.ShowDialog(this,De.a,{Title:"Notes"}),r.abrupt("break",630);case 383:if(null!=(h=this.GetButton("Attachments"))&&h.Visible){r.next=385;break}return r.abrupt("return");case 385:return this.OnAddAttachment(),this.SetVisibiltiFalse(),this.AttachmentVisibility=!0,this.ViewAttachments.AttachmentsList.forEach((function(e){e.Height=null==e.RowID&&o.e.IsEmpty(e.ColID)?20:0})),this.Attachment.RowID=null,this.Attachment.ColID="",s.a.page.ShowDialog(this,E.a,{Title:"Attachment"}),r.abrupt("break",630);case 387:if(null!=(h=this.GetButton("Contacts"))&&h.Visible){r.next=389;break}return r.abrupt("return");case 389:return this.SetVisibiltiFalse(),r.abrupt("break",630);case 391:return this.ApproveVisibility=!1,r.abrupt("break",630);case 393:if(this.ButtonApprove.Visible&&this.ButtonApprove.Enable){r.next=395;break}return r.abrupt("return");case 395:if(!this.IsInventoryVoucher||!this.LineWiseApproval){r.next=398;break}return $t=new xe,r.abrupt("return",($t.UpdateFieldsViewModel_1(this),void s.a.page.ShowDialog($t,ke.a,{ShowCenter:!0,HideHeader:!0,HideClose:!0}).subscribe((function(){var e=ea.ScreenObject.ColumnSource.find((function(e){return!o.e.IsEmpty(e.ValueBinding)&&"IsSelected"==e.ValueBinding}));e&&(e.IsVisible=!1),(e=ea.ScreenObject.ColumnSource.find((function(e){return!o.e.IsEmpty(e.DisplayMember)&&"AppRemarks"==e.DisplayMember})))&&(e.IsVisible=!1)}))));case 398:return this.ScreenObject.Preferences.ContainsKey("UseAsLC")&&""!=this.ScreenObject.Preferences.UseAsLC&&Object(l.j)(this.ScreenObject.Preferences.UseAsLC)||this.ScreenObject.Preferences.ContainsKey("UseAsTR")&&""!=this.ScreenObject.Preferences.UseAsTR&&Object(l.j)(this.ScreenObject.Preferences.UseAsTR)?this.SaveAccountingDocument("Approve"):(this.SetVisibiltiFalse(),this.ApproveVisibility=!0,this.IsPOs&&(this.ButtonSaveandPrint.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save&Print")),this.RecurDocsWithApproval.Visible=!1,!this.IsInventoryVoucher&&this.ScreenObject.IsRecurDocumet()&&(0==this.RecurDocsWithApproval.Items.length&&(this.RecurDocsWithApproval.Items.push(m.d.ComboBoxItems_2("Auto post","2")),this.RecurDocsWithApproval.Items.push(m.d.ComboBoxItems_2("With Approval","1")),this.RecurDocsWithApproval.Items.push(m.d.ComboBoxItems_2("Without Approval","0")),this.RecurDocsWithApproval.SelectedValue="2"),this.RecurDocsWithApproval.Visible=!0)),r.abrupt("break",630);case 400:if(this.ButtonSuspend.Visible&&this.ButtonSuspend.Enable){r.next=402;break}return r.abrupt("return");case 402:return this.SuspendVisiblity=!0,this.ScreenObject.IsDocEdit&&(this.Remarks.Text=this.linkStatusRemarks),s.a.page.ShowDialog(this,_e.a,{ShowCenter:!0,NoWidth:!0,Title:s.a.GetResource("LinkStatusLabel")}),r.abrupt("break",630);case 404:if(null!=(h=this.GetButton("PriceChart"))&&h.Visible){r.next=406;break}return r.abrupt("return");case 406:return this.ScreenObject.Preferences.ContainsKey("PriceChartMapping")&&this.ScreenObject.Preferences.PriceChartMapping.length>0?this.LoadPriceChart():this.DisplayMessage="Please Configure Price Chart Mappings",r.abrupt("break",630);case 408:return this.SaveLinkStatus(369),r.abrupt("break",630);case 410:return this.SaveLinkStatus(445),r.abrupt("break",630);case 412:if(null!=(h=this.GetButton("Recur"))&&h.Visible){r.next=414;break}return r.abrupt("return");case 414:return this.ScreenObject.IsDocEdit&&(this.SetVisibiltiFalse(),this.Recur=new Re(this),this.Recur.LoadData(),s.a.page.ShowDialog(this.Recur,Be.a)),r.abrupt("break",630);case 416:if(this.ButtonDelete.Visible&&this.ButtonDelete.Enable){r.next=418;break}return r.abrupt("return");case 418:if(0!=this.ScreenObject.DocID){r.next=420;break}return r.abrupt("return",(this.DisplayMessage="Cannot Delete Empty Document",void(this.MessageVisibility=!0)));case 420:if(!(this.ScreenObject.DocID>0&&this.IsUserLock)){r.next=422;break}return r.abrupt("return",void(this.DisplayMessage="Document is Locked"));case 422:if(0==this.ScreenObject.RefNodeID||86==this.ScreenObject.RefCCId||73==this.ScreenObject.RefCCId||89==this.ScreenObject.RefCCId||this.ScreenObject.IsRefLCTR){r.next=424;break}return r.abrupt("return",void(this.DisplayMessage=s.a.GetResource("RefDeleteDocument")));case 424:if(this.IsInventoryVoucher||!this.ScreenObject.IsBouncedorPdcPosted||this.ScreenObject.Preferences.ContainsKey("LineWisePDC")&&""!=this.ScreenObject.Preferences.LineWisePDC&&Object(l.j)(this.ScreenObject.Preferences.LineWisePDC)){r.next=426;break}return r.abrupt("return",void(this.DisplayMessage=this.ScreenObject.BouncedorPdcMessage));case 426:if(439!=this.StatusID){r.next=428;break}return r.abrupt("return",void(this.DisplayMessage="Discounted PDC can not be deleted"));case 428:if(75!=this.ScreenObject.DocumentType){r.next=432;break}if(!(null!=(en=s.a.common.GetDataSet("PAY052",this.ScreenObject.DocID.toString()).Tables[0])&&en.length>0)){r.next=432;break}return r.abrupt("return",(this.DisplayMessage="Final Settlement already Posted for this Grade can not be deleted",void(this.MessageVisibility=!0)));case 432:return s.a.SessionManager.IsActionAssigned(this.CostCenterID,"API")&&this.GenerateAPIRequest(8),this.DeleteDocument(),r.abrupt("break",630);case 434:if(0!=this.ScreenObject.DocID){r.next=436;break}return r.abrupt("return",(this.DisplayMessage="Cannot Suspend Empty Document",void(this.MessageVisibility=!0)));case 436:if(!(this.ScreenObject.DocID>0&&this.IsUserLock)){r.next=438;break}return r.abrupt("return",void(this.DisplayMessage="Document is Locked"));case 438:if(this.ButtonSuspendDoc.Visible&&this.ButtonSuspendDoc.Enable){r.next=440;break}return r.abrupt("return");case 440:if(0==this.ScreenObject.RefNodeID||86==this.ScreenObject.RefCCId||73==this.ScreenObject.RefCCId||89==this.ScreenObject.RefCCId||this.ScreenObject.IsRefLCTR){r.next=442;break}return r.abrupt("return",void(this.DisplayMessage="Can not suspend reference document"));case 442:if(this.IsInventoryVoucher||!this.ScreenObject.IsBouncedorPdcPosted){r.next=444;break}return r.abrupt("return",void(this.DisplayMessage=this.ScreenObject.BouncedorPdcMessage));case 444:if(439!=this.StatusID){r.next=446;break}return r.abrupt("return",void(this.DisplayMessage="Discounted PDC can not be suspended"));case 446:if(75!=this.ScreenObject.DocumentType){r.next=452;break}if(tn="",null!=(nn=this.ScreenObject._CCFields.find((function(e){return"dcccnid53"==e.DBColumnName.toLowerCase()})))&&null!=nn&&(nn instanceof C.b||nn instanceof p.a)&&(tn=nn.SelectedValue.toString()),!(null!=(an=s.a.common.GetDataSet("PAY052",tn).Tables[0])&&an.length>0)){r.next=452;break}return r.abrupt("return",(this.DisplayMessage="Final Settlement already Posted for this Grade can not be suspended",void(this.MessageVisibility=!0)));case 452:return this.ScreenObject.Preferences.ContainsKey("SuspendRemarksMandatory")&&""!=this.ScreenObject.Preferences.SuspendRemarksMandatory&&Object(l.j)(this.ScreenObject.Preferences.SuspendRemarksMandatory)?s.a.page.ShowDialog(new X.a(this,1),U.a):(s.a.SessionManager.IsActionAssigned(this.CostCenterID,"API")&&this.GenerateAPIRequest(11),this.IsSuspend=!0,confirm("Are you sure you want to suspend?")&&this.OnDeleteCallBack()),r.abrupt("break",630);case 454:return this.ApproveVisibility=!1,r.abrupt("break",630);case 456:if(!(this.ScreenObject.DocID>0&&this.IsUserLock)){r.next=458;break}return r.abrupt("return",void(this.DisplayMessage="Document is Locked"));case 458:if(!this.ScreenObject.Preferences.ContainsKey("CommentsMandatoryforApprove")||""==this.ScreenObject.Preferences.CommentsMandatoryforApprove||!Object(l.j)(this.ScreenObject.Preferences.CommentsMandatoryforApprove)||null!=this.Remarks.Text&&""!=this.Remarks.Text){r.next=460;break}return r.abrupt("return",void(this.DisplayMessage="Remarks Mandatory For Approval"));case 460:return s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit")?this.IsInventoryVoucher?this.SaveInventoryDocument_1(e.toString()):this.SaveAccountingDocument(e.toString()):(this.SaveStatus(369,this.GetWorkFlow(!1,null),""),"ApproveandPrint"==e.toString()&&(this.DisplayMessage=this.DisplayMessage+"\r\n "+this.PrintVoucher(!1,this.ScreenObject.DocID.toString(),!0,null))),this.IsPOs&&(this.ButtonSaveandPrint.Visible=!1),r.abrupt("break",630);case 462:if(!(this.ScreenObject.DocID>0&&this.IsUserLock)){r.next=464;break}return r.abrupt("return",void(this.DisplayMessage="Document is Locked"));case 464:return this.IsInventoryVoucher?this.SaveInventoryDocument_1(e):this.SaveAccountingDocument(e),r.abrupt("break",630);case 466:return this.SetVisibiltiFalse(),this.DocLinkVisibility=!0,r.abrupt("break",630);case 468:return this.SetVisibiltiFalse(),this.AddressesVisibility=!0,r.abrupt("break",630);case 470:return this.SetVisibiltiFalse(),this.ReportInfoVisibility=!0,r.abrupt("break",630);case 472:return this.SetVisibiltiFalse(),this.MappedDocsVisibility=!0,r.abrupt("break",630);case 474:return 72==this.DocumentType&&(rn=0,(sn=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})))&&(sn instanceof C.b||sn instanceof p.a)&&(sn instanceof C.b?sn.SelectedValue>0&&(rn=sn.SelectedValue):sn instanceof p.a&&sn.SelectedValue>0&&(rn=sn.SelectedValue)),this.ShowVacationCreditDaysDetail(rn)),r.abrupt("break",630);case 476:if(!this.ScreenObject.Preferences.ContainsKey("CommentsMandatoryforReject")||""==this.ScreenObject.Preferences.CommentsMandatoryforReject||!Object(l.j)(this.ScreenObject.Preferences.CommentsMandatoryforReject)||null!=this.Remarks.Text&&""!=this.Remarks.Text){r.next=478;break}return r.abrupt("return",void(this.DisplayMessage="Remarks Mandatory For Reject"));case 478:return this.LineWiseApproval?((on=new xe).UpdateFieldsViewModel_1(this),s.a.page.ShowDialog(on,ke.a,{ShowCenter:!0,HideHeader:!0,HideClose:!0})):this.SaveStatus(372,0,""),this.IsPOs&&(this.ButtonSaveandPrint.Visible=!1),r.abrupt("break",630);case 481:return this.ScreenObject.IsDocEdit&&s.a.page.ShowDialog(new z.DocumentDraftsViewModel(this,3),J.DocumentDraftsComponent),r.abrupt("break",630);case 483:if(null!=(h=this.GetButton("Print"))&&h.Visible){r.next=485;break}return r.abrupt("return");case 485:return s.a.page.ShowDialog(new Bt(this),Vt.a,{HideHeader:!0,ShowCenter:!0}),r.abrupt("break",630);case 487:return this.ScreenObject.IsDocEdit&&(this.SetVisibiltiFalse(),this.Bounce=new Me(this),s.a.page.ShowDialog(this.Bounce,ve.a)),r.abrupt("break",630);case 489:return s.a.page.ShowDialog(new ht(this),Dt.a),null!=(cn=this.ScreenObject.ColumnSource.find((function(e){return!o.e.IsEmpty(e.DisplayMember)&&"EnqSel"==e.DisplayMember})))&&(cn.IsVisible=!1),r.abrupt("break",630);case 493:return this.ScreenObject.GridDataObj.SearchVisible=!this.ScreenObject.GridDataObj.SearchVisible,r.abrupt("break",630);case 495:if(this.SetVisibiltiFalse(),this.DocHistoryVisibility=!0,this.DocHistory.Clear(),this.HistCols[0].IsVisible=!0,this.HistCols[1].IsVisible=!0,this.HistoryUpdateFooter=!0,null!=(ln=this.ScreenObject.GetReviseHistory())&&ln.Tables.length>0&&ln.Columns[0].Contains("ModifiedBy"))for(un=0;un<ln.Tables[0].length;un++)(dn=s.a.slick.emptyObj()).VersionNo=ln.Tables[0][un].VersionNo,dn.ReviseReason=ln.Tables[0][un].ReviseReason,dn.ModifiedBy=ln.Tables[0][un].ModifiedBy,o.e.IsEmpty(ln.Tables[0][un].ModifiedDate)||(dn.ModifiedDate=new Date(ln.Tables[0][un].ModifiedDate).ToString(s.a.SessionManager.Preferences["Date Format"])),this.DocHistory.push(dn);return s.a.page.ShowDialog(this,Ge.a,{Title:"History"}),r.abrupt("break",630);case 500:if(this.SetVisibiltiFalse(),this.DocHistoryVisibility=!0,this.DocHistory.Clear(),this.HistCols[0].IsVisible=!1,this.HistCols[1].IsVisible=!1,this.HistoryUpdateFooter=!0,null!=(Dn=this.ScreenObject.GetDocumentHistory())&&Dn.Tables.length>0&&Dn.Columns[0].Contains("ModifiedBy")){for(hn=0,Sn=0;Sn<Dn.Tables[0].length;Sn++)(mn=s.a.slick.emptyObj()).ModifiedBy=Dn.Tables[0][Sn].ModifiedBy,o.e.IsEmpty(Dn.Tables[0][Sn].ModifiedDate)||(mn.ModifiedDate=new Date(Dn.Tables[0][Sn].ModifiedDate).ToString(s.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss tt")),o.e.IsEmpty(Dn.Tables[0][Sn].maxid)||(hn<parseInt(Dn.Tables[0][Sn].maxid)&&(hn=parseInt(Dn.Tables[0][Sn].maxid)),mn.maxid=Dn.Tables[0][Sn].maxid.toString()),this.DocHistory.push(mn);(bn=this.DocHistory.filter((function(e){return e.maxid==hn}))).length>0&&(bn[0].IsCurrent="YES")}return s.a.page.ShowDialog(this,Ge.a,{Title:"History"}),r.abrupt("break",630);case 505:return s.a.page.ShowDialog(new Q.b(this),K.a),r.abrupt("break",630);case 507:return o.e.IsEmpty(this.ScreenObject.VoucherNo)||s.a.page.ShowDialog(new gt.DocumentFlowChartViewModel(!0,this.ScreenObject.VoucherNo,this.ScreenObject.CostCenterID,this.ScreenObject.IsInventory),pt.DocumentFlowChartComponent),r.abrupt("break",630);case 509:if(!(this.ScreenObject.Data.Tables.length>18&&this.ScreenObject.Data.Tables[18].length>0)){r.next=523;break}if(Cn=this.ScreenObject.Data.Tables[18][0],!(this.ScreenObject.RegisterNodeID>0)){r.next=522;break}if(!((yn=this.ScreenObject.Data.Tables[18].filter((function(e){return e.NodeID==ea.ScreenObject.RegisterNodeID}))).length>0&&null!=yn[0].CashDrawPrintID&&parseInt(yn[0].CashDrawPrintID)>0)){r.next=517;break}this.CashDrwerPrintID=parseInt(yn[0].CashDrawPrintID),this.PrintVoucher(!1,"-1",!1,null),this.CashDrwerPrintID=0,r.next=520;break;case 517:if(yn.length>0&&!o.e.IsEmpty(yn[0].CashDrawerName)&&!o.e.IsEmpty(yn[0].CashDrawerCommand)){r.next=519;break}return r.abrupt("return");case 519:this.OpenCashDrawer(yn[0].CashDrawerName.toString(),yn[0].CashDrawerCommand.toString());case 520:r.next=523;break;case 522:null!=Cn&&this.OpenCashDrawer(Cn.CashDrawerName.toString(),Cn.CashDrawerCommand.toString());case 523:return r.abrupt("break",630);case 524:return(pn=new Oe).PaymentTermsViewModel_1(this,this.payTermXml),s.a.page.ShowDialog(pn,Ie.a,{NoWidth:!0}),r.abrupt("break",630);case 527:return this.ShowEmailSMS(!0),r.abrupt("break",630);case 529:return this.ShowEmailSMS(!1),r.abrupt("break",630);case 531:if(!this.IsAutoPost||null==parent){r.next=533;break}return r.abrupt("return",(this.DisplayMessage="close",void s.a.page.HideDialog()));case 533:if(this.ScreenObject.Preferences.ContainsKey("LcCloseDocument")&&""!=this.ScreenObject.Preferences.LcCloseDocument&&parseInt(this.ScreenObject.Preferences.LcCloseDocument)>4e4){r.next=535;break}return r.abrupt("return",(this.DialogResult=!1,void s.a.page.HideDialog()));case 535:if(gn=0,null!=(fn=this.ScreenObject.GetLCUsedAmt(parseInt(this.ScreenObject.GridData[0].DocDetailsID)))&&fn.Tables.length>0&&fn.Columns[0].Contains("amt")&&fn.Tables[0].length>0&&!o.e.IsEmpty(fn.Tables[0][0].amt)&&(gn=fn.Tables.length>2&&fn.Columns[2].Contains("CLoseAmount")&&fn.Tables[2].length>0&&!o.e.IsEmpty(fn.Tables[2][0].CLoseAmount)?parseFloat(fn.Tables[0][0].amt)-parseFloat(fn.Tables[2][0].CLoseAmount):parseFloat(fn.Tables[0][0].amt)),gn>0){r.next=538;break}return r.abrupt("return",void(this.DisplayMessage="lc is already closed"));case 538:return function(){var e=new a(parseInt(ea.ScreenObject.Preferences.LcCloseDocument),"",!1);if(e.LCDueAmt=gn,null!=e.ScreenObject.CreditAccount&&null!=ea.ScreenObject.CreditAccount)e.ScreenObject.CreditAccount.SelectedValue=ea.ScreenObject.CreditAccount.SelectedValue,null!=ea.ScreenObject.CreditAccount.Code&&(e.ScreenObject.CreditAccount.Code.SelectedValueText=ea.ScreenObject.CreditAccount.Code.Text),null!=ea.ScreenObject.CreditAccount.Name&&(e.ScreenObject.CreditAccount.Name.SelectedValueText=ea.ScreenObject.CreditAccount.Name.Text),null!=fn&&fn.Tables.length>1&&fn.Tables[1].length>0&&(e.ScreenObject.CreditAccount.Code.CustomWhere=e.ScreenObject.CreditAccount.Name.CustomWhere=" a.AccountID in ("+fn.Tables[1][0].account.toString()+","+fn.Tables[1][0].MarginAccount.toString()+","+fn.Tables[1][0].Traccount.toString()+") ");else if(e.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")){var t=e.ScreenObject.ColumnSource.find((function(e){return null!=e.ValueMember&&"creditaccount_key"==e.ValueMember.toLowerCase()}));t&&(t.FilterCondition=" a.AccountID in ("+fn.Tables[1][0].account.toString()+","+fn.Tables[1][0].MarginAccount.toString()+","+fn.Tables[1][0].Traccount.toString()+") ")}e.ScreenObject.IsRefLCTR=!0,e.ScreenObject.RefCCId=400,ea.ScreenObject.GridData.length>0&&!o.e.IsEmpty(ea.ScreenObject.GridData[0].DocDetailsID)&&parseInt(ea.ScreenObject.GridData[0].DocDetailsID)>0&&(e.ScreenObject.RefNodeID=parseInt(ea.ScreenObject.GridData[0].DocDetailsID));for(var n=function(t){if(!o.e.IsEmpty(ea.ScreenObject.GridData[t].DocDetailsID)&&parseInt(ea.ScreenObject.GridData[t].DocDetailsID)>0){if(ea.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!o.e.IsEmpty(ea.ScreenObject.GridData[t].CreditAccount_Key))if(e.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")){e.ScreenObject.GridData[t].CreditAccount_Key=ea.ScreenObject.GridData[t].CreditAccount_Key.toString();var n=e.ScreenObject.ColumnSource.filter((function(e){return null!=e.ValueMember&&""!=e.ValueMember&&"creditaccount_key"==e.ValueMember.toLowerCase()}));n&&n.forEach((function(n){e.ScreenObject.GridDataColumns.Contains(n.DisplayMember)&&ea.ScreenObject.GridDataColumns.Contains(n.DisplayMember)&&(e.ScreenObject.GridData[t][n.DisplayMember]=ea.ScreenObject.GridData[t][n.DisplayMember].toString())}))}else null!=e.ScreenObject.CreditAccount&&(e.ScreenObject.CreditAccount.SelectedValue=parseInt(ea.ScreenObject.GridData[t].CreditAccount_Key));else if(ea.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!o.e.IsEmpty(ea.ScreenObject.GridData[t].DebitAccount_Key))if(e.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")){e.ScreenObject.GridData[t].DebitAccount_Key=ea.ScreenObject.GridData[t].DebitAccount_Key.toString();var a=e.ScreenObject.ColumnSource.filter((function(e){return null!=e.ValueMember&&""!=e.ValueMember&&"debitaccount_key"==e.ValueMember.toLowerCase()}));a&&a.forEach((function(n){e.ScreenObject.GridDataColumns.Contains(n.DisplayMember)&&ea.ScreenObject.GridDataColumns.Contains(n.DisplayMember)&&(e.ScreenObject.GridData[t][n.DisplayMember]=ea.ScreenObject.GridData[t][n.DisplayMember].toString())}))}else null!=e.ScreenObject.DebitAccount&&(e.ScreenObject.DebitAccount.SelectedValue=parseInt(ea.ScreenObject.GridData[t].DebitAccount_Key));e.ScreenObject.GridDataColumns.Contains("Amount")&&(e.ScreenObject.GridData[t].Amount=gn),e.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&null!=ea.ScreenObject.CreditAccount&&(e.ScreenObject.GridData[t].CreditAccount=ea.ScreenObject.CreditAccount.Text,e.ScreenObject.GridData[t].CreditAccount_Key=ea.ScreenObject.CreditAccount.SelectedValue)}},i=0;i<ea.ScreenObject.GridData.length;i++)n(i);s.a.page.addNewTab({component:x.AddEditDocumentComponent,params:{obj:e}})}(),r.abrupt("break",630);case 540:return this.ConvertCase(),r.abrupt("break",630);case 542:if(!this.ScreenObject.IsDocEdit){r.next=549;break}if(376!=this.StatusID){r.next=545;break}return r.abrupt("return",void(this.DisplayMessage="Documents is cancelled"));case 545:if(371!=this.StatusID||!this.DoNotPrintUnApprovedDocuments){r.next=547;break}return r.abrupt("return",void(this.DisplayMessage="Un-Approved Documents not allowed to export"));case 547:On=-1,this.ScreenObject.DocPrefix.RevisionCombo.Visible&&this.ScreenObject.DocPrefix.RevisionCombo.Items.length>1&&this.ScreenObject.DocPrefix.RevisionCombo.SelectedValue!=this.ScreenObject.DocPrefix.RevisionCombo.Items[this.ScreenObject.DocPrefix.RevisionCombo.Items.length-1].Value&&(On=parseInt(this.ScreenObject.DocPrefix.RevisionCombo.SelectedValue)),this.Export(this.DocID,null,!1,On);case 549:return r.abrupt("break",630);case 550:return this.IsImport?null!=this.ExcelTable&&this.ExcelTable.length>0&&(90!=this.DocumentType&&89!=this.DocumentType||this.SetButtonVisibility("Save",!0),o.e.SetPersonalize("ImportChunkSize",this.ImportChunkSize),this.importWorker_DoWork(null,null)):(this.SortGrid(!1),s.a.page.HideDialog()),r.abrupt("break",630);case 552:return P=new Array,this.DtImportObj.Clear(),(j=new f.a).DisplayMember="Name",j.ValueMember="Value",j.ValueBinding="FieldName",j.Header="Column Name",j.DataType="ComboBox",j.Width=150,(A=new Array).push(m.d.ComboBoxItems_2("","")),this.ScreenObject.ColumnSource.forEach((function(e){!o.e.IsEmpty(e.ValueBinding)&&e.IsVisible?A.push(m.d.ComboBoxItems_2(e.Header,e.ValueBinding)):!o.e.IsEmpty(e.DisplayMember)&&"DocSeqNo"!=e.DisplayMember&&e.IsVisible&&(!ea.ScreenObject.GridDataColumns.Contains(e.DisplayMember+"_Key")||"DATE"!=e.DataType&&"DATETIME"!=e.DataType&&"TIME"!=e.DataType&&"Time2"!=e.DataType?A.push(m.d.ComboBoxItems_2(e.Header,e.DisplayMember)):A.push(m.d.ComboBoxItems_2(e.Header,e.DisplayMember+"_Key")))})),j.ComboData=A,P.push(j),this.DtImportObj.TableColumns.push("FieldName"),(j=new f.a).DisplayMember="Name",j.ValueMember="Value",j.ValueBinding="Order",j.Header="Order",j.DataType="ComboBox",j.Width=80,(A=new Array).push(m.d.ComboBoxItems_2("Ascending","Asc")),A.push(m.d.ComboBoxItems_2("Descending","Desc")),A.push(m.d.ComboBoxItems_2("Numeric Ascending","NUM")),A.push(m.d.ComboBoxItems_2("Numeric Descending","NUMDesc")),j.ComboData=A,P.push(j),this.DtImportObj.TableColumns.push("Order"),this.IsImport=!1,this.ImportCols=P,this.SetVisibiltiFalse(),this.ImportVisiblity=!0,this.RightTabSelectedIndex=0,this.DtImportObj.addEmptyRow(),this.DtImportObj.addEmptyRow(),this.DtImportObj.addEmptyRow(),this.DtImportObj.addEmptyRow(),this.DtImportObj.Height=200,s.a.page.ShowDialog(this,Ot.a,{ShowCenter:!s.a.IsMobile,NoWidth:!0,Title:"Sort"}),r.abrupt("break",630);case 554:if(P=[],this.DtImportObj.Clear(),this.DtImportObj.Columns=[],(j=new f.a).DisplayMember="FieldName",j.Header=s.a.GetResource("Import_FieldName"),j.DataType="TextBlock",j.Width=100,j.ReadOnly=!0,P.push(j),this.DtImportObj.TableColumns.push("FieldName"),(j=new f.a).DisplayMember="Name",j.ValueMember="Value",j.ValueBinding="FeatureFieldName",j.Header=s.a.GetResource("Import_FeatureFieldName"),j.DataType="ComboBox",j.Width=120,(A=[]).push(m.d.ComboBoxItems_2("","")),81!=this.DocumentType){r.next=560;break}if(!((Tn=this.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()})))&&Tn instanceof m.e&&o.e.IsEmpty(Tn.SelectedValue))){r.next=558;break}return r.abrupt("return",void(this.DisplayMessage="Please select Year"));case 558:if(!((Tn=this.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()})))&&Tn instanceof m.e&&o.e.IsEmpty(Tn.SelectedValue))){r.next=560;break}return r.abrupt("return",void(this.DisplayMessage="Please select BasedOn"));case 560:return In=o.e.Int(this.ScreenObject.Preferences.ImpPrf),this.ScreenObject.Preferences.ContainsKey("ImpPrf")&&In>0&&null!=(jn=s.a.admin.GetImportDetails(In,!0))&&jn.Tables.length>0&&jn.Tables[0].length>0&&(j.DefaultValue=jn.Tables[0][0].FileName.toString(),j.DefaultValueText=jn.Tables[0][0].Structure.toString()),this.ScreenObject.ColumnSource.forEach((function(e){!o.e.IsEmpty(e.DisplayMember)&&e.IsVisible&&("DocSeqNo"==e.DisplayMember?A.push(m.d.ComboBoxItems_2(e.Header,"100")):e.CostCenterID>5e4&&e.DisplayMember.endsWith("Code")?A.push(m.d.ComboBoxItems_2(e.Header,"-"+e.ID)):A.push(m.d.ComboBoxItems_2(e.Header,e.ID)))})),this.ScreenObject._StaticFields.forEach((function(e){o.e.IsEmpty(e.DBColumnName)||A.push(m.d.ComboBoxItems_2(e.Label,e.DBColumnID.toString()))})),this.ScreenObject._TextFields.forEach((function(e){o.e.IsEmpty(e.DBColumnName)||A.push(m.d.ComboBoxItems_2(e.Label,e.DBColumnID.toString()))})),this.ScreenObject._CCFields.forEach((function(e){o.e.IsEmpty(e.DBColumnName)||(e instanceof p.a&&A.push(m.d.ComboBoxItems_2(e.Label.replace("*","")+"Code","-"+e.DBColumnID.toString())),A.push(m.d.ComboBoxItems_2(e.Label,e.DBColumnID.toString())))})),A.push(m.d.ComboBoxItems_2("BatchNumber","-500")),j.ComboData=A,P.push(j),this.DtImportObj.TableColumns.push("FeatureFieldName"),this.IsImport=!0,this.ImportCols=P,this.ImportChunkSize=s.a.SessionManager.PersonalSettings.ContainsKey("ImportChunkSize")?s.a.SessionManager.PersonalSettings.ImportChunkSize:"5",this.SetVisibiltiFalse(),this.ImportVisiblity=!0,this.RightTabSelectedIndex=0,Pn=this.IsImport?"Import":"Sort",this.DtImportObj.Height=300,s.a.page.ShowDialog(this,Ot.a,{NoWidth:!0,Title:Pn}),r.abrupt("break",630);case 565:if(An="",this.ScreenObject.Preferences.ContainsKey("Distributebasedon")&&!o.e.IsEmpty(this.ScreenObject.Preferences.Distributebasedon)&&(Mn=this.ScreenObject._TextFields.find((function(e){return e.DBColumnID.toString()==ea.ScreenObject.Preferences.Distributebasedon})))&&Mn instanceof m.e&&!o.e.IsEmpty(Mn.SelectedValue)&&(An=Mn.SelectedValue.toLowerCase()),""!=An||(this.DisplayMessage=this.IsDateValid(null,""),""==this.DisplayMessage)){r.next=569;break}return r.abrupt("return");case 569:return this.DistributeInstallments(An),r.abrupt("break",630);case 571:return this.FillDates_Click(),r.abrupt("break",630);case 573:return this.FillGeneralTimings_Click(),r.abrupt("break",630);case 575:if(!((vn=this.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()})))&&vn instanceof S.c)||vn.Date){r.next=578;break}return r.abrupt("return",(this.DisplayMessage="Select the daily attendance date",void(vn.SetFocus=!0)));case 578:return null!=vn&&this.GetAllEmployees(vn.Date,this.DocID,this.strEmpFilter),r.abrupt("break",630);case 580:if(!((Gn=this.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()})))&&Gn instanceof S.c)||Gn.Date){r.next=583;break}return r.abrupt("return",(this.DisplayMessage="Select the daily attendance date",void(Gn.SetFocus=!0)));case 583:return this.GetPreviousDay(Gn.Date),r.abrupt("break",630);case 585:if(40097!=this.CostCenterID){r.next=591;break}if(!(null!=(Nn=this.ScreenObject._TextFields.find((function(e){return"dcalpha16"==e.DBColumnName.toLowerCase()})))&&Nn instanceof S.c)||Nn.Date){r.next=589;break}return r.abrupt("return",(this.DisplayMessage="Select Payroll Month",void(Nn.SetFocus=!0)));case 589:return En=new Date(Nn.Date.getFullYear(),Nn.Date.getMonth(),1),wn=this.EmpFilter_Click(En),r.abrupt("return",void(wn.length>0&&(this.ScreenObject.GridDataObj.Clear(),this.DoLateConsiderations(wn),this.IsLatesProcessTimingsUpdated=!1)));case 591:return this.strEmpFilter="",this.strEmpFilter=this.PopupEmployeesFilter("","DailyAttendanceFilter"),this.DailyAttendanceFilterTemp(),r.abrupt("break",630);case 593:if(67!=this.DocumentType){r.next=595;break}return r.abrupt("return",(this.isDAValidate=!0,this.sDAErrLogs="",this.DisplayMessage=this.CheckDocumentValidations(""),this.isDAValidate=!1,""!=this.sDAErrLogs?(this.DisplayMessage=this.sDAErrLogs,void(this.MessageVisibility=!0)):(this.DisplayMessage="Validated Succesfully",void(this.MessageVisibility=!0))));case 595:return r.abrupt("break",630);case 596:if(72==this.DocumentType&&this.ScreenObject.DocID>0){if(null==this.dtVacContract&&null!=(Fn=s.a.common.GetDataTable("DOC064",this.ScreenObject.DocID.toString()))&&Fn.length>0)for(this.dtVacContract=[],Ln=0;Ln<Fn.length;Ln++)(Vn={}).Select=!0,Vn.SNo=Fn[Ln].Sno.toString(),Vn.ContractNodeID=Fn[Ln].ContractNodeID.toString(),Vn.ContractCode=Fn[Ln].ContractCode.toString(),Vn.ContractName=Fn[Ln].ContractName.toString(),Vn.ContractFrom=Fn[Ln].ContractFrom.toString(),Vn.ContractTo=Fn[Ln].ContractTo.toString(),Vn.CreditedDays=parseFloat(Fn[Ln].CreditedDays),Vn.PrevTakenDays=parseFloat(Fn[Ln].PrevTakenDays),Vn.BalanceDays=parseFloat(Fn[Ln].BalanceDays),Vn.CanAvail=parseFloat(Fn[Ln].CanAvail),this.dtVacContract.push(Vn);this.isVacPopup=!0,this.ApplyVacationContract(),this.isVacPopup=!1}return r.abrupt("break",630);case 598:return r.next=600,n.e(0).then(n.bind(null,"TvXE"));case 600:return Rn=r.sent,Bn=Rn.DocOptionsComponent,r.next=604,n.e(146).then(n.bind(null,"T8e8"));case 604:return xn=r.sent,kn=xn.DocOptionsViewModel,_n=new kn(this,1),s.a.page.ShowDialog(_n,Bn,{ShowCenter:!0,NoWidth:!0}),r.abrupt("break",630);case 609:return Kn=new C.b,s.a.SessionManager.Preferences.ContainsKey("POSItemCodeDimension")&&o.e.Int(s.a.SessionManager.Preferences.POSItemCodeDimension)>5e4?(Qn=this.ScreenObject.ColumnSource.find((function(e){return e.CostCenterID.toString()==s.a.SessionManager.Preferences.POSItemCodeDimension})))&&this.ScreenObject.GridDataColumns.Contains(Qn.DisplayMember)&&(Kn.CCID=parseInt(s.a.SessionManager.Preferences.POSItemCodeDimension),Qn?(Kn.TypeID=Qn.TypeID,Kn.Label=Qn.Header):(Kn.TypeID=1,Kn.Label="Stock Code")):(Hn=this.ScreenObject.ColumnSource.find((function(e){return 3==e.CostCenterID&&"ProductCode"==e.DisplayMember})),(Wn=new C.b).CCID=3,Hn?(Wn.TypeID=Hn.TypeID,Wn.Label=Hn.Header):(Wn.TypeID=1,Wn.Label="product"),Wn.SelectedValue=-1),Un=new Je.PactListSearchViewModel(Kn),s.a.page.ShowDialog(Un,ct.a),Kn.SelectedValue>0&&Kn.SelectedValue>0?(Xn=this.GetEmptyRowPosition(this.ScreenObject.GridDataObj,"ProductID_Key"),(qn=this.ScreenObject.GridData[Xn]).ProductID_Key=Kn.SelectedValue,"0"==this.IsSales?(qn.Quantity=-1,this.RowForegroundChange(qn)):qn.Quantity=1,this.ProdID=0,this.Celleditend(qn,"ProductCode",3),this.PoleDisplayMessage(2,qn)):o.e.IsEmpty(Kn.Text)||this.onSKUSearch(Kn.Text),r.abrupt("break",630);case 614:return null==this.SelectedRow||o.e.IsEmpty(this.SelectedRow.Quantity)||(this.SelectedRow.Quantity=-1*parseFloat(this.SelectedRow.Quantity),this.CalculateTotals(this.SelectedRow,!1,"Quantity"),this.RowForegroundChange(this.SelectedRow,parseFloat(this.SelectedRow.Quantity)>0)),r.abrupt("break",630);case 616:return null!=this.SelectedRow&&this.CanDeleteRow(this.SelectedRow)&&this.OnBeforeRowDeleting(this.SelectedRow,!0),r.abrupt("break",630);case 618:return(Yn=new C.b).CCID=400,Yn.TypeID=2,Yn.CustomWhere=" a.CostCenterID="+this.CostCenterID+" and dcCCNID"+(s.a.SessionManager.RegisterCCID-5e4).toString()+"="+this.ScreenObject.RegisterNodeID,zn=new Je.PactListSearchViewModel(Yn),s.a.page.ShowDialog(zn,yt.a,{ShowCenter:!0,Title:s.a.GetResource("SelectDocument")}).subscribe((function(){if(o.e.IsValidID(Yn.SelectedValue)){var e={value:ea._Ddate};ea.ScreenObject.OnDocPrefixChanged("lostFocus",0,Yn.SelectedValue,e,!0),ea._Ddate=e.value}})),r.abrupt("break",630);case 623:return(Jn=this.ButtonsLeft.find((function(e){return"SalesReturn"==e.ComParam})))&&(o.e.IsEmpty(Jn.ToolTipFooterDescription)&&(Jn.ToolTipFooterDescription=Jn.ToolTipDescription),Jn.ToolTipFooterDescription==Jn.ToolTipDescription?(Jn.ToolTipDescription="#df4b33",this.IsSales="0"):(Jn.ToolTipDescription=Jn.ToolTipFooterDescription,this.IsSales="1")),r.abrupt("break",630);case 626:return Zn=new At(0,"AssignVPTFromDocument",this),s.a.page.ShowDialog(Zn,It.a,{HideClose:!1,ShowCenter:!0,Title:s.a.GetResource("Assign")}),r.abrupt("break",630);case 629:this.ScreenObject.DocID>0&&($n=new At(0,this.ScreenObject.VoucherNo,this,1),s.a.page.ShowDialog($n,It.a,{HideClose:!1,ShowCenter:!0,Title:s.a.GetResource("Assign")}));case 630:case"end":return r.stop()}}),r,this)})))}},{key:"LoadPriceChart",value:function(){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.e(178).then(n.bind(null,"eClI"));case 2:return e.next=4,Promise.all([n.e(2),n.e(1),n.e(43),n.e(52)]).then(n.bind(null,"bSOb"));case 4:t=e.sent,a=t.AddPriceChartNewViewModel,i=new a("DOCUMENT",0,0),s.a.page.addNewTab({component:a,params:{obj:i}});case 8:case"end":return e.stop()}}),e)})))}},{key:"ShowEmailSMS",value:function(e){this.ScreenObject.IsDocEdit&&(369!=this.StatusID&&this.DoNotEmailSMSUnApprovedDocuments?this.DisplayMessage="Un-Approved Documents not allowed to Email/SMS":s.a.page.ShowDialog(new it.SendEmailSMSViewModel(e,this.CostCenterID,this.DocID,this),rt.SendEmailSMSComponent))}},{key:"SearchData",value:function(){var e=this;try{var t=this.ScreenObject.HeaderFields.find((function(t){return t instanceof h.d&&t.DBColumnName==e.sSearchColName}));null==t&&(t=this.ScreenObject._TextFields.find((function(t){return t instanceof h.d&&t.DBColumnName==e.sSearchColName}))),null==t&&(t=this.ScreenObject._StaticFields.find((function(t){return t instanceof h.d&&t.DBColumnName==e.sSearchColName}))),null!=t&&o.e.IsEmpty(t.Text)}catch(n){}}},{key:"ConfirmDirtyRead",value:function(){return!(this.ScreenObject.IsDocEdit&&this.ScreenObject.IsDirty&&!confirm("Do you want to discard changes?"))}},{key:"Redeposit",value:function(){for(var e=0;e<this.ScreenObject.GridData.length;e++){var t=1,n=1;s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&(this.Currency&&!o.e.IsEmpty(this.Currency.Currency.SelectedValue)?t=parseInt(this.Currency.Currency.SelectedValue):this.ScreenObject.GridDataColumns.Contains("CurrencyID")&&!o.e.IsEmpty(this.ScreenObject.GridData[e].CurrencyID_Key)&&(t=parseInt(this.ScreenObject.GridData[e].CurrencyID_Key)),null!=this.Currency&&null!=this.Currency.ExchangeRate.Text&&""!=this.Currency.ExchangeRate.Text?n=parseFloat(this.Currency.ExchangeRate.Text):this.ScreenObject.GridDataColumns.Contains("ExchangeRate")&&!o.e.IsEmpty(this.ScreenObject.GridData[e].ExchangeRate)&&(n=parseFloat(this.ScreenObject.GridData[e].ExchangeRate)));var a="",i="";if(i+="<BillWise><Row  ",a+="<XML><Row  ",a+='DocSeqNo="'+this.ScreenObject.GridData[e].DocSeqNo.toString()+'" ',i+='DocSeqNo="'+this.ScreenObject.GridData[e].DocSeqNo.toString()+'" ',14==this.DocumentType||15==this.DocumentType){if(!this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")||o.e.IsEmpty(this.ScreenObject.GridData[e].DebitAccount_Key)||o.e.IsEmpty(this.ScreenObject.GridData[e].Amount)){this.ScreenObject.GridData[e].ReturnXML="",this.ScreenObject.GridData[e].ExtraXML="";continue}a+='AccountID="'+this.ScreenObject.GridData[e].DebitAccount_Key.toString()+'" ',i+='AccountID="'+this.ScreenObject.GridData[e].DebitAccount_Key.toString()+'" ',a+='AmountFC="-'+this.ScreenObject.GridData[e].Amount.toString()+'" ',a+='AdjAmount="-'+parseFloat(this.ScreenObject.GridData[e].Amount)*n+'" ',a+='AdjExchRT="'+n.toString()+'" ',i+='AmountFC="'+this.ScreenObject.GridData[e].Amount.toString()+'" ',i+='AdjAmount="'+parseFloat(this.ScreenObject.GridData[e].Amount)*n+'" '}else{if(!this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")||o.e.IsEmpty(this.ScreenObject.GridData[e].CreditAccount_Key)||o.e.IsEmpty(this.ScreenObject.GridData[e].Amount)){this.ScreenObject.GridData[e].ReturnXML="",this.ScreenObject.GridData[e].ExtraXML="";continue}a+='AccountID="'+this.ScreenObject.GridData[e].CreditAccount_Key.toString()+'" ',i+='AccountID="'+this.ScreenObject.GridData[e].CreditAccount_Key.toString()+'" ',a+='AmountFC="'+this.ScreenObject.GridData[e].Amount.toString()+'" ',a+='AdjAmount="'+parseFloat(this.ScreenObject.GridData[e].Amount)*n+'" ',a+='AdjExchRT="'+n.toString()+'" ',i+='AmountFC="-'+this.ScreenObject.GridData[e].Amount.toString()+'" ',i+='AdjAmount="-'+parseFloat(this.ScreenObject.GridData[e].Amount)*n+'" '}a+='AdjCurrID="'+t.toString()+'" ',a+='IsNewReference="0" ',a+='RefDocNo="'+this.ScreenObject.VoucherNo+'" ',a+='RefDocSeqNo="'+this.ScreenObject.GridData[e].DocSeqNo.toString()+'" ',a+='RefDocDate="'+this.DocumentDate.ToString("dd/MMM/yyyy")+'" ',null!=this.ScreenObject.DueDate&&this.ScreenObject.DueDate.Date&&(a+='RefDocDueDate="'+this.ScreenObject.DueDate.Date.ToString("dd/MMM/yyyy")+'" '),a+='Narration="" ',a+='IsDocPDC="0" >',a+=" </Row>",a+=" </XML>",i+='AdjCurrID="'+n.toString()+'" ',i+='AdjExchRT="'+n.toString()+'" ',i+='IsNewReference="1" ',i+='Narration="" ',i+='IsDocPDC="0" ',i+=" ></Row>",i+=" </BillWise>",this.ScreenObject.GridData[e].DocDetailsID=0,this.ScreenObject.GridData[e].ReturnXML=a,1==Object(l.j)(this.ScreenObject.GridData[e].Type)&&(this.ScreenObject.GridData[e].ExtraXML=i.toString())}this.DocStatus="["+s.a.GetResource("Doc_Draft")+"]",this.ScreenObject.DocID=0,this.ScreenObject.RefCCId=0,this.ScreenObject.RefNodeID=0,this.DocumentDate=Date.Today(),this.SetNewDocButtonVisibility();var r=s.a.document.getcurrentcode(this.ScreenObject.CostCenterID,this.ScreenObject.Prefix);null!=r&&r.Tables.length>0&&r.Tables[0].length>0&&!r.Columns[0].Contains("ErrorMessage")&&r.Columns[0].Contains("CurrentCodeNumber")&&""!=r.Tables[0][0].CurrentCodeNumber.toString().trim()&&(this.ScreenObject.DocPrefix.TextBox.Text=r.Tables[0][0].CurrentCodeNumber.toString())}},{key:"FillPickDimensionofHistoryControls",value:function(){var e=this;null!=this.ScreenObject&&this.ScreenObject.Data.Columns[0].Contains("IsHistory")&&function(){var t=[],n=e.ScreenObject.Data.Tables[0].filter((function(e){return 1==e.IsHistory}));if(n.length>0)for(var a=e.GetPrimaryColName(),i=function(i){if(!t.Contains(n[i].LocalReference.toString())){t.push(n[i].LocalReference.toString());var r=e.ScreenObject.ColumnSource.find((function(e){return!o.e.IsEmpty(e.ID)&&e.ID==n[i].LocalReference.toString()}));if(r&&e.ScreenObject.GridDataColumns.Contains(r.ValueMember))for(var s=0;s<e.ScreenObject.GridData.length;s++)o.e.IsEmpty(e.ScreenObject.GridData[s][a])||o.e.IsEmpty(e.ScreenObject.GridData[s][r.ValueMember])||e.ScreenObject.GetLinkReferenceData(parseInt(r.ID),e.CostCenterID,parseInt(e.ScreenObject.GridData[s][r.ValueMember]),Date.Today(),r.DisplayMember,r.CostCenterID,e.ScreenObject.GridData[s],null,!1);else{var c=e.ScreenObject._CCFields.find((function(e){return e.DBColumnID.toString()==n[i].LocalReference.toString()}));c||(c=e.ScreenObject.HeaderFields.find((function(e){return e instanceof y.c&&e.DBColumnID==n[i].LocalReference}))),(c instanceof C.b||c instanceof p.a)&&e.ScreenObject.GetLinkReferenceData(c.DBColumnID,e.CostCenterID,c.SelectedValue,e.DocumentDate,c.DBColumnName,c.CCID,null,null,!1)}}},r=0;r<n.length;r++)i(r)}()}},{key:"ReEvaluate",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=0,a=!0;if(e&&this.FillPickDimensionofHistoryControls(),this.IsInventoryVoucher&&!this.ScreenObject.IsPayrollDocument)for(var i=0;i<this.ScreenObject.GridData.length;i++)o.e.IsEmpty(this.ScreenObject.GridData[i].ProductID_Key)||(t&&0==n&&s.a.SessionManager.Preferences.ContainsKey("PromptRatechange")&&Object(l.j)(s.a.SessionManager.Preferences.PromptRatechange)&&(confirm("Do you want to ReEvaluate price Chart?")||(a=!1)),n++,this.ReEvaluate_dr(this.ScreenObject.GridData[i],a));0==n&&(this.FillDictionary(null,!1),this.CalcTextFields())}},{key:"ReEvaluatePriceTax",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=0;if(this.IsInventoryVoucher&&!this.ScreenObject.IsPayrollDocument)for(var a=0;a<this.ScreenObject.GridData.length;a++)o.e.IsEmpty(this.ScreenObject.GridData[a].ProductID_Key)||(n++,this.ReEvaluatePriceTax_3(this.ScreenObject.GridData[a],e,t));0==n&&(this.FillDictionary(null,!1),this.CalcTextFields())}},{key:"ReEvaluatePriceTax_3",value:function(e,t){var n=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this.ScreenObject.PriceTaxcc.ContainsKey(t)&&(a=this.ScreenObject.PriceTaxcc[t]);var i=1;0==(i=o.e.Double(e.Quantity))&&(i=1);var r=0;o.e.IsEmpty(e.Unit_Key)||(r=parseInt(e.Unit_Key));var s={};if(o.e.IsEmpty(e.ProductID_Key)||(s=this.ScreenObject.GetPriceTax(e.ProductID_Key.toString(),this.DocumentDate,r,i,e.DocDetailsID.toString(),e,a,this.Currency)),a.split(",").Contains("p")&&s.Tables.length>1)if(s.Tables[1].length>0){var c=this.ScreenObject.ColumnSource.find((function(e){return"Rate"==e.DisplayMember}));o.e.IsEmpty(c.Formula)||!s.Columns[1].Contains(c.Formula)||o.e.IsEmpty(s.Tables[1][0][c.Formula])?1==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||10==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||31==this.ScreenObject.DocumentType?o.e.IsEmpty(s.Tables[1][0].PurchaseRate)||(e.Rate=s.Tables[1][0].PurchaseRate.toString(),e.defaultRate=s.Tables[1][0].PurchaseRate.toString()):o.e.IsEmpty(s.Tables[1][0].SellingRate)||(e.Rate=s.Tables[1][0].SellingRate.toString(),e.defaultRate=s.Tables[1][0].SellingRate.toString()):(e.Rate=s.Tables[1][0][c.Formula].toString(),e.defaultRate=s.Tables[1][0][c.Formula].toString()),this.FillSalesPurchase(e,s.Tables[1],s.Tables[1][0])}else this.FillSalesPurchase(e,s.Tables[1],null);if(o.e.IsEmpty(e.ProductID_Key)||parseInt(e.ProductID_Key)==this.ScreenObject.TempProductID||(a.split(",").Contains("a")&&(this.FillDatarow(e,s.Tables[0],null,{LocalReference:79,LinkData:23819},"AvgRate"),e.AVGRATE=s.Columns[0].Contains("AvgRate")&&!o.e.IsEmpty(s.Tables[0][0].AvgRate)?s.Tables[0][0].AvgRate.toString():0),a.split(",").Contains("s")&&(this.FillDatarow(e,s.Tables[0],null,{LocalReference:79,LinkData:25398},"QOH"),this.FillDatarow(e,s.Tables[0],null,{LocalReference:79,LinkData:52638},"QOH"),this.FillDatarow(e,s.Tables[0],null,{LocalReference:79,LinkData:52637},"BalQOH"),this.FillDatarow(e,s.Tables[0],null,{LocalReference:79,LinkData:26421},"HOLDQTY"),this.FillDatarow(e,s.Tables[0],null,{LocalReference:79,LinkData:50454},"CommittedQty"),this.FillDatarow(e,s.Tables[0],null,{LocalReference:79,LinkData:26422},"RESERVEQTY"),this.FillDatarow(e,s.Tables[0],null,{LocalReference:79,LinkData:499943},"TotalReserve"),e.QOH=s.Columns[0].Contains("QOH")&&!o.e.IsEmpty(s.Tables[0][0].QOH)?s.Tables[0][0].QOH.toString():0,e.BalQOH=s.Columns[0].Contains("BalQOH")&&!o.e.IsEmpty(s.Tables[0][0].BalQOH)?s.Tables[0][0].BalQOH.toString():0,e.HOLDQTY=s.Columns[0].Contains("HOLDQTY")&&!o.e.IsEmpty(s.Tables[0][0].HOLDQTY)?s.Tables[0][0].HOLDQTY.toString():0,e.CommittedQty=s.Columns[0].Contains("CommittedQty")&&!o.e.IsEmpty(s.Tables[0][0].CommittedQty)?s.Tables[0][0].CommittedQty.toString():0,e.RESERVEQTY=s.Columns[0].Contains("RESERVEQTY")&&!o.e.IsEmpty(s.Tables[0][0].RESERVEQTY)?s.Tables[0][0].RESERVEQTY.toString():0,e.TotalReserve=s.Columns[0].Contains("TotalReserve")&&!o.e.IsEmpty(s.Tables[0][0].TotalReserve)?s.Tables[0][0].TotalReserve.toString():0)),a.split(",").Contains("t")&&s.Tables.length>2&&this.ScreenObject.ColumnSource.filter((function(e){return e.DisplayMember.Contains("dcNum")&&4!=e.SectionID})).forEach((function(t){var n=s.Tables[2].filter((function(e){return e.SysColumnName==t.DisplayMember}));n.length>0?(e[t.DisplayMember]=n[0].Value.toString(),e["default"+t.DisplayMember]=n[0].Value.toString()):t.IsReEvaluate&&(e[t.DisplayMember]=0,e["default"+t.DisplayMember]=0)})),null!=this.AutoPostViewModel){var l=this.ScreenObject._CCFields.find((function(e){return e instanceof C.b&&e.CCID==t})),u=this.AutoPostViewModel.ScreenObject._CCFields.find((function(e){return e instanceof C.b&&e.CCID==t}));l&&u&&(u.SelectedValue=l.SelectedValue,u.SelectedValueText=l.Text);var d=this.AutoPostViewModel.ScreenObject.GridData.find((function(t){return t.RefSeqNo==e.RefSeqNo}));d.forEach((function(a){o.e.IsEmpty(a.defaultQuantity)||parseFloat(e.Quantity)*parseFloat(a.defaultQuantity)==parseFloat(a.Quantity)||(a.Quantity=parseFloat(e.Quantity)*parseFloat(a.defaultQuantity),o.e.IsEmpty(a.Quantity)||o.e.IsEmpty(a.UOMConversion)||!o.e.IsNum(a.UOMConversion)?o.e.IsEmpty(a.Quantity)||(a.UOMConvertedQty=a.Quantity.toString()):a.UOMConvertedQty=o.e.Double(a.UOMConversion)*parseFloat(a.Quantity)),n.AutoPostViewModel.ReEvaluatePriceTax_3(e,t)}));var D=0;d.forEach((function(e){o.e.IsEmpty(e.Gross)||(D+=parseFloat(e.Gross))})),o.e.IsEmpty(e.Quantity)||(e.Rate=D/parseFloat(e.Quantity))}this.CalculateTotals(e,!1)}},{key:"ReEvaluate_dr",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=0;o.e.IsEmpty(e.Unit_Key)||(a=parseInt(e.Unit_Key));var i=this.GetProductValues(e,a,!1,null,!0);if(n&&this.FillRates(i,e),this.ScreenObject.ColumnSource.filter((function(e){return e.DisplayMember.Contains("dcNum")&&4!=e.SectionID})).forEach((function(t){if(i.Tables.length>4){var n=i.Tables[4].filter((function(e){return e.SysColumnName==t.DisplayMember}));n.length>0?(e[t.DisplayMember]=n[0].Value.toString(),e["default"+t.DisplayMember]=n[0].Value.toString()):t.IsReEvaluate&&(e[t.DisplayMember]=0,e["default"+t.DisplayMember]=0)}})),null!=this.AutoPostViewModel){this.AutoPostViewModel.ScreenObject._CCFields.forEach((function(e){var n=t.ScreenObject._CCFields.find((function(t){return t.DBColumnName==e.DBColumnName}));n&&e instanceof C.b&&n instanceof C.b&&(e.SelectedValue=n.SelectedValue,e.SelectedValueText=n.Text)}));var r=this.AutoPostViewModel.ScreenObject.GridData.find((function(t){return t.RefSeqNo==e.RefSeqNo}));r.forEach((function(n){o.e.IsEmpty(n.defaultQuantity)||parseFloat(e.Quantity)*parseFloat(n.defaultQuantity)==parseFloat(n.Quantity)||(n.Quantity=parseFloat(e.Quantity)*parseFloat(n.defaultQuantity),o.e.IsEmpty(n.Quantity)||o.e.IsEmpty(n.UOMConversion)||!o.e.IsNum(n.UOMConversion)?o.e.IsEmpty(n.Quantity)||(n.UOMConvertedQty=n.Quantity.toString()):n.UOMConvertedQty=o.e.Double(n.UOMConversion)*parseFloat(n.Quantity)),a=0,o.e.IsEmpty(e.Unit_Key)||(a=parseInt(e.Unit_Key));var i=t.AutoPostViewModel.GetProductValues(e,a,!1,null,!0);t.AutoPostViewModel.FillRates(i,n),t.AutoPostViewModel.CalculateTotals(n,!1)}));var s=0;r.forEach((function(e){o.e.IsEmpty(e.Gross)||(s+=parseFloat(e.Gross))})),o.e.IsEmpty(e.Quantity)||(e.Rate=s/parseFloat(e.Quantity))}if("8"==e.Type.toString()||"3"==e.Type.toString()){for(var c=new ce(this,e,null),l=0;l<c.GridData.length;l++)""!=o.e.StringValue(c.GridData[l].ProductID_Key).toString()&&this.ReEvaluate_dr(c.GridData[l],n);c.OnButtonClick("AutoSave")}this.CalculateTotals(e,!1)}},{key:"ConvertCase",value:function(){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,a,i,r,c,l,u,d,D,b=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.e(128).then(n.bind(null,"il++"));case 2:return t=e.sent,a=t.AddEditCaseComponent,e.next=6,Promise.all([n.e(8),n.e(23),n.e(35),n.e(127)]).then(n.bind(null,"Hzm0"));case 6:if(i=e.sent,r=i.AddEditCasesViewModel,(c=new r(0,1,!0)).RefCCID=this.CostCenterID,c.RefNodeID=this.ScreenObject.DocID,this.ScreenObject.Data.Tables.length>20&&this.ScreenObject.Data.Columns[20].Contains("DocumentLinkDefID")&&(l=this.ScreenObject.Data.Tables[20].filter((function(e){return 2==e.Mode&&73==e.CostCenterIDBase}))).length>0&&null!=(u=this.ScreenObject.GetCaseLinkDetails(l[0].DocumentLinkDefID.toString()))&&u.Tables.length>0&&u.Columns[0].Contains("BASECOL"))for(D=0;D<u.Tables[0].length;D++)o.e.IsEmpty(u.Tables[0][D].LINKCOL)||function(){var e="",t="",n=u.Tables[0][D].LINKCOL.toString(),a=u.Tables[0][D].BASECOL.toString();if(b.ScreenObject.GridDataColumns.Contains(n)||"productid"==a.toLowerCase()){var i=b.ScreenObject.ColumnSource.find((function(e){return"Name"!=e.DisplayMember&&e.DisplayMember==n}));if(i||(i=b.ScreenObject.ColumnSource.find((function(e){return"Name"==e.DisplayMember&&e.ValueBinding==n}))),i||(i=b.ScreenObject.ColumnSource.find((function(e){return""!=e.ValueMember&&e.ValueMember==n+"_Key"}))),i&&(i.CostCenterID>0&&b.ScreenObject.GridDataColumns.Contains(i.ValueMember)&&!o.e.IsEmpty(b.ScreenObject.GridData[0][i.ValueMember])?e=b.ScreenObject.GridData[0][i.ValueMember].toString():"DATE"!=i.DataType&&"DateTime"!=i.DataType&&0!=o.e.stringCompare(i.DataType,"Time",!0)||!b.ScreenObject.GridDataColumns.Contains(i.DisplayMember+"_Key")||o.e.IsEmpty(b.ScreenObject.GridData[0][i.DisplayMember+"_Key"])?"Name"==i.DisplayMember&&b.ScreenObject.GridDataColumns.Contains(i.ValueBinding)&&!o.e.IsEmpty(b.ScreenObject.GridData[0][i.ValueBinding])?e=b.ScreenObject.GridData[0][i.ValueBinding].toString():b.ScreenObject.GridDataColumns.Contains(i.DisplayMember)&&!o.e.IsEmpty(b.ScreenObject.GridData[0][i.DisplayMember])&&(e=b.ScreenObject.GridData[0][i.DisplayMember].toString()):o.e.isValidDate(b.ScreenObject.GridData[0][i.DisplayMember+"_Key"].toString())&&(e=new Date(b.ScreenObject.GridData[0][i.DisplayMember+"_Key"]).toString()),("productid"==a.toLowerCase()||"uomid"==a.toLowerCase()||"quantity"==a.toLowerCase()||"description"==a.toLowerCase()||a.Contains("Alpha")&&!a.Contains("acAlpha"))&&null!=c.ProductGrid&&null!=c.ProductGrid.ProductGrid&&b.ScreenObject.GridDataColumns.Contains("ProductID_Key"))){for(var r=0;r<b.ScreenObject.GridData.length;r++)!o.e.IsEmpty(b.ScreenObject.GridData[r].ProductID_Key)&&parseInt(b.ScreenObject.GridData[r].ProductID_Key)>0&&(c.ProductGrid.ProductGrid.length<r+1&&c.ProductGrid.ProductGrid.push(),"productid"==a.toLowerCase()&&c.ProductGrid.ProductGridObj.TableColumns.Contains("Product_Key")?(b.ScreenObject.GridDataColumns.Contains("ProductName")&&(c.ProductGrid.ProductGrid[r].ProductName=b.ScreenObject.GridData[r].ProductName.toString()),b.ScreenObject.GridDataColumns.Contains("ProductCode")&&(c.ProductGrid.ProductGrid[r].ProductCode=b.ScreenObject.GridData[r].ProductCode.toString()),c.ProductGrid.ProductGrid[r].Product_Key=b.ScreenObject.GridData[r].ProductID_Key.toString()):"uomid"==a.toLowerCase()&&c.ProductGrid.ProductGridObj.TableColumns.Contains("UOM_Key")?(c.ProductGrid.ProductGrid[r].UOM=b.ScreenObject.GridData[r].Unit.toString(),c.ProductGrid.ProductGrid[r].UOM_Key=b.ScreenObject.GridData[r].Unit_Key.toString()):"quantity"==a.toLowerCase()&&c.ProductGrid.ProductGridObj.TableColumns.Contains("QTY")?c.ProductGrid.ProductGrid[r].QTY=b.ScreenObject.GridData[r][i.DisplayMember].toString():c.ProductGrid.ProductGridObj.TableColumns.Contains(a)&&(c.ProductGrid.ProductGrid[r][a]=b.ScreenObject.GridData[r][i.DisplayMember].toString()));e=""}}else{var s=b.ScreenObject._TextFields.find((function(e){return e.DBColumnName==n}));if(s||(s=b.ScreenObject._CCFields.find((function(e){return e.DBColumnName==n}))),s||(s=b.ScreenObject._StaticFields.find((function(e){return e.DBColumnName==n}))),!s)for(var l=0;l<b.ScreenObject.HeaderFields.length;l++){var g=b.ScreenObject.HeaderFields[l];if("docdate"==n.toLowerCase()&&g instanceof S.d){e=b.DocumentDate.toString();break}g instanceof y.c&&g.DBColumnName.toLowerCase()==n.toLowerCase()&&(s=g)}s&&(t="",s instanceof S.c?s.Date&&(e=s.Date.toString()):s instanceof S.a?e=s.Date.toString():s instanceof C.b?s.SelectedValue>0&&(e=s.SelectedValue.toString(),t=s.Text.toString()):s instanceof p.a?s.SelectedValue>0&&(e=s.SelectedValue.toString()):s instanceof h.d||s instanceof h.c||s instanceof O.a?e=s.Text:s instanceof m.e&&(e=s.SelectedValue))}""==e||o.e.IsEmpty(u.Tables[0][D].BASECOL)||("CreateDate"==a?o.e.isValidDate(e)&&(c.CaseDate.Date=new Date(e)):"CaseNumber"==a?c.CName.Text=t.length>0&&""!=t?t:e:"CustomerID"==a?(d=o.e.Int(e))>0&&(c.Customer.SelectedValue=d):"ServiceLvlLookupID"==a?(d=o.e.Int(e))>0&&(c.ServiceLevel.SelectedValue=d):"Remarks"==a?c.Comments.Text=e:(a.toLowerCase().Contains("acalpha")||a.toLowerCase().Contains("ccnid"))&&c.ScreenObject.CustomTab.Pages.forEach((function(t){t.Fields.forEach((function(t){t instanceof h.d&&t.DBColumnName.toLowerCase()==a.toLowerCase()&&(t.Text=e),t instanceof m.e&&t.DBColumnName.toLowerCase()==a.toLowerCase()?t.SelectedValue=e:t instanceof C.b&&t.DBColumnName.toLowerCase()==a.toLowerCase()&&o.e.Int(e)>0&&(t.SelectedValue=parseInt(e))}))})))}();s.a.page.addNewTab({component:a,params:{obj:c}});case 11:case"end":return e.stop()}}),e,this)})))}},{key:"setStatusColor",value:function(){this.StatusColor=this.DocStatus.startsWith("["+s.a.GetResource("Doc_Draft")+"]")?s.a.SessionManager.Preferences.DraftColor:this.DocStatus.startsWith("[Partial]")?s.a.SessionManager.Preferences.partialColor:369==this.StatusID?s.a.SessionManager.Preferences.PostedColor:370==this.StatusID?s.a.SessionManager.Preferences.PDCColor:371==this.StatusID?s.a.SessionManager.Preferences.UnApprovedColor:372==this.StatusID?s.a.SessionManager.Preferences.RejectedColor:376==this.StatusID?s.a.SessionManager.Preferences.CancelledColor:429==this.StatusID?s.a.SessionManager.Preferences.BouncedColor:441==this.StatusID?s.a.SessionManager.Preferences.ApprovedColor:"#FF736F6F",9==this.StatusColor.length&&(this.StatusColor.startsWith("#FF")||this.StatusColor.startsWith("#ff"))&&(this.StatusColor="#"+this.StatusColor.substr(3))}},{key:"SaveStatus",value:function(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=this.ScreenObject.SetDocStatus(e,t,n,this.AppRejDate.Date,this.Remarks.Text,!0,a?this.ScreenObject.guid:"");null!=i&&i.Tables.length>0&&i.Tables[0].length>0&&i.Columns[0].Contains("status")&&(s.a.SessionManager.RefreshNotification(),this.DocStatus="["+i.Tables[0][0].status.toString()+"]",this.AppRejDate.Date=new Date,this.Remarks.Text="",this.ButtonApprove.Visible=!1,this.SetVisibiltiFalse(),this.IsPOs||this.SetDefaultRightPanel()),null!=i&&i.Tables.length>0&&i.Tables[i.Tables.length-1].length>0&&i.Columns[i.Columns.length-1].Contains("ErrorMessage")&&(this.DisplayMessage=i.Tables[i.Tables.length-1][0].ErrorMessage.toString()),this.clear(2)}},{key:"SetDefaultRightPanel",value:function(){if(72==this.DocumentType)this.onButtonClick("VacCrDaysDetail");else if(this.ScreenObject.Preferences.ContainsKey("DefaultRightView")&&""!=this.ScreenObject.Preferences.DefaultRightView)switch(this.ScreenObject.Preferences.DefaultRightView){case"Notes":this.onButtonClick("Notes");break;case"Import":this.onButtonClick("ImportVisiblity");break;case"Sort":this.onButtonClick("SortVisiblity");break;case"Attachments":this.RightTabSelectedIndex=5;break;case"Search":this.onButtonClick("Search");break;case"Documents":this.onButtonClick("Documents");break;case"reports":default:this.ReportInfoVisibility=!this.IsMobile,this.RightTabSelectedIndex=1}else this.ReportInfoVisibility=!this.IsMobile}},{key:"SaveLinkStatus",value:function(e){if(o.e.IsEmpty(this.Remarks.Text)&&this.ScreenObject.Preferences.ContainsKey("LinkStatusRemarksMandatory")&&""!=this.ScreenObject.Preferences.LinkStatusRemarksMandatory&&Object(l.j)(this.ScreenObject.Preferences.LinkStatusRemarksMandatory))this.DisplayMessage="Enter remarks";else{var t=this.ScreenObject.SetDocLinkStatus(e,this.AppRejDate.Date,this.Remarks.Text);null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&t.Columns[0].Contains("status")&&(this.DocStatus="["+t.Tables[0][0].status.toString()+"]",this.DocStatus="["+s.a.GetResource(o.e.String(t.Tables[0][0].status).Replace("-","_").Replace(" ",""))+"]",this.AppRejDate.Date=new Date,this.Remarks.Text="",this.SuspendVisiblity=!1,this.SetVisibiltiFalse(),this.IsPOs||this.SetDefaultRightPanel()),null!=t&&t.Tables.length>0&&t.Tables[t.Tables.length-1].length>0&&t.Columns[t.Columns.length-1].Contains("ErrorMessage")&&(this.DisplayMessage=t.Tables[t.Tables.length-1][0].ErrorMessage.toString())}}},{key:"DeleteDocument",value:function(){Logger.InfoLog("AddEditDocumentViewModel::Entering DeleteDocument"),this.IsSuspend=!1,confirm(s.a.GetResource("DeleteMessage"))&&this.OnDeleteCallBack(),Logger.InfoLog("AddEditDocumentViewModel::Exiting DeleteDocument")}},{key:"ConstructFormulaFields",value:function(){var e=this;this.fldDict=new c.a,this.FooterDics=new c.a;var t=new I.c;if(t.setFieldDetails("RATE",1,1,"",1,!1,!1),this.fldDict.push("RATE",t),(t=new I.c).setFieldDetails("NET",2,1,"",1,!1,!1),this.fldDict.push("NET",t),(t=new I.c).setFieldDetails("AVGRT",3,1,"",1,!1,!1),this.fldDict.push("AVGRT",t),(t=new I.c).setFieldDetails("QTY",4,1,"",1,!1,!1),this.fldDict.push("QTY",t),(t=new I.c).setFieldDetails("GROSS",5,1,"",1,!1,!1),this.fldDict.push("GROSS",t),(t=new I.c).setFieldDetails("LSTPRCHSRT",6,1,"",1,!1,!1),this.fldDict.push("LSTPRCHSRT",t),(t=new I.c).setFieldDetails("LSTLNDGRT",7,1,"",1,!1,!1),this.fldDict.push("LSTLNDGRT",t),(t=new I.c).setFieldDetails("CONVQTY",8,1,"",1,!1,!1),this.fldDict.push("CONVQTY",t),(t=new I.c).setFieldDetails("UNITS",9,1,"",1,!1,!1),this.fldDict.push("UNITS",t),(t=new I.c).setFieldDetails("BASEQTY",10,1,"",1,!1,!1),this.fldDict.push("BASEQTY",t),(t=new I.c).setFieldDetails("EXCHRT",11,1,"",1,!1,!1),this.fldDict.push("EXCHRT",t),(t=new I.c).setFieldDetails("HOLDQTY",16,1,"",1,!1,!1),this.fldDict.push("HOLDQTY",t),(t=new I.c).setFieldDetails("CommittedQty",18,1,"",1,!1,!1),this.fldDict.push("CommittedQty",t),(t=new I.c).setFieldDetails("RESERVEQTY",17,1,"",1,!1,!1),this.fldDict.push("RESERVEQTY",t),(t=new I.c).setFieldDetails("TotalReserve",19,1,"",1,!1,!1),this.fldDict.push("TotalReserve",t),(t=new I.c).setFieldDetails("QOH",12,1,"",1,!1,!1),this.fldDict.push("QOH",t),(t=new I.c).setFieldDetails("BalQOH",19,1,"",1,!1,!1),this.fldDict.push("BalQOH",t),(t=new I.c).setFieldDetails("MRate",13,1,"",1,!1,!1),this.fldDict.push("MRate",t),(t=new I.c).setFieldDetails("RRate",14,1,"",1,!1,!1),this.fldDict.push("RRate",t),(t=new I.c).setFieldDetails("SRate",15,1,"",1,!1,!1),this.fldDict.push("SRate",t),(t=new I.c).setFieldDetails("DOCDATE",20,1,"",1,!1,!1),this.fldDict.push("DOCDATE",t),(t=new I.c).setFieldDetails("ServerDate",23,1,"",1,!1,!1),this.fldDict.push("ServerDate",t),(t=new I.c).setFieldDetails("DUEDATE",21,1,"",1,!1,!1),this.fldDict.push("DUEDATE",t),(t=new I.c).setFieldDetails("BILLDATE",22,1,"",1,!1,!1),this.fldDict.push("BILLDATE",t),(t=new I.c).setFieldDetails("UOMCONVERSION",23,1,"",1,!1,!1),this.fldDict.push("UOMCONVERSION",t),(t=new I.c).setFieldDetails("MaturityDate",24,1,"",1,!1,!1),this.fldDict.push("MaturityDate",t),(t=new I.c).setFieldDetails("DocPrefix",25,1,"","",!1,!1),this.fldDict.push("DocPrefix",t),(t=new I.c).setFieldDetails("FreeQTY",4,1,"",1,!1,!1),this.fldDict.push("FreeQTY",t),this.ScreenObject.ColumnSource.forEach((function(n){var a=n.lbl;n.IsColumnUserDefined&&n.DisplayMember.Contains("dcNum")&&!e.fldDict.ContainsKey(a)?((t=new I.c).setFieldDetails(a,3,1,"",0,!1,!1),e.fldDict.push(a,t),(t=new I.c).setFieldDetails("Calc"+a,3,1,"",0,!1,!1),e.fldDict.push("Calc"+a,t),(t=new I.c).setFieldDetails(a+"EXRT",3,1,"",0,!1,!1),e.fldDict.push(a+"EXRT",t),e.CheckMaxMinFormula_1(a)):e.fldDict.ContainsKey(a)||((t=new I.c).setFieldDetails(a,3,1,"",0,!1,!1),e.fldDict.push(a,t))})),this.ScreenObject._CCFields.forEach((function(n){e.fldDict.ContainsKey(n.Lbl)||((t=new I.c).setFieldDetails(n.Lbl,3,1,"",0,!1,!1),e.fldDict.push(n.Lbl,t))})),this.ScreenObject.HeaderFields.forEach((function(n){n instanceof y.c&&!o.e.IsEmpty(n.Lbl)&&!e.fldDict.ContainsKey(n.Lbl)&&((t=new I.c).setFieldDetails(n.Lbl,3,1,"",0,!1,!1),e.fldDict.push(n.Lbl,t))})),this.ScreenObject._TextFields.forEach((function(n){e.fldDict.ContainsKey(n.Lbl)||((t=new I.c).setFieldDetails(n.Lbl,3,1,"",0,!1,!1),e.fldDict.push(n.Lbl,t))})),null==this.ScreenObject.CreditAccount||this.fldDict.ContainsKey(this.ScreenObject.CreditAccount.Lbl)||((t=new I.c).setFieldDetails(this.ScreenObject.CreditAccount.Lbl,3,1,"",0,!1,!1),this.fldDict.push(this.ScreenObject.CreditAccount.Lbl,t)),null==this.ScreenObject.DebitAccount||this.fldDict.ContainsKey(this.ScreenObject.DebitAccount.Lbl)||((t=new I.c).setFieldDetails(this.ScreenObject.DebitAccount.Lbl,3,1,"",0,!1,!1),this.fldDict.push(this.ScreenObject.DebitAccount.Lbl,t)),null!=this.POSPayModes&&null!=this.POSPayModes.PayModes)for(var n=0;n<this.POSPayModes.PayModes.length;n++)(t=new I.c).setFieldDetails(this.POSPayModes.PayModes[n].Lbl,3,1,"",0,!1,!1),this.fldDict.push(this.POSPayModes.PayModes[n].Lbl,t);for(var a=0;a<this.fldDict.keys.length;a++)this.FooterDics.push(this.fldDict.keys[a],this.fldDict.values[a].Clone())}},{key:"CheckMaxMinFormula",value:function(e,t){var n=new I.c;null!=t&&t.Contains("Max"+e)&&!this.fldDict.ContainsKey("Max"+e)&&((n=new I.c).setFieldDetails("Max"+e,3,1,"",0,!1,!1),this.fldDict.push("Max"+e,n)),null!=t&&t.Contains("MaxCalc"+e)&&!this.fldDict.ContainsKey("MaxCalc"+e)&&((n=new I.c).setFieldDetails("MaxCalc"+e,3,1,"",0,!1,!1),this.fldDict.push("MaxCalc"+e,n)),null!=t&&t.Contains("Min"+e)&&!this.fldDict.ContainsKey("Min"+e)&&((n=new I.c).setFieldDetails("Min"+e,3,1,"",0,!1,!1),this.fldDict.push("Min"+e,n)),null!=t&&t.Contains("MinCalc"+e)&&!this.fldDict.ContainsKey("MinCalc"+e)&&((n=new I.c).setFieldDetails("MinCalc"+e,3,1,"",0,!1,!1),this.fldDict.push("MinCalc"+e,n))}},{key:"IsExpressionAvailable",value:function(e){for(var t=0;t<this.ScreenObject.ColumnSource.length;t++){var n=this.ScreenObject.ColumnSource[t];if(null!=n.Formula&&n.Formula.Contains(e))return!0}if(null!=this.ScreenObject.FooterDataBind&&this.ScreenObject.FooterDataBindColumns.Contains("Formula"))for(var a=0;a<this.ScreenObject.FooterDataBind.length;a++)if(o.e.String(this.ScreenObject.FooterDataBind[a].Formula).Contains(e))return!0;if(this.ScreenObject.Data.Tables.length>10){if(this.ScreenObject.Data.Columns[10].Contains("Expression"))for(var i=0;i<this.ScreenObject.Data.Tables[10].length;i++)if(o.e.String(this.ScreenObject.Data.Tables[10][i].Expression).Contains(e))return!0;if(this.ScreenObject.Data.Columns[9].Contains("Expression"))for(var r=0;r<this.ScreenObject.Data.Tables[9].length;r++)if(o.e.String(this.ScreenObject.Data.Tables[9][r].Expression).Contains(e))return!0}return!1}},{key:"CheckMaxMinFormula_1",value:function(e){var t=this;if(this.ScreenObject.ColumnSource.forEach((function(n){t.CheckMaxMinFormula(e,n.Formula)})),null!=this.ScreenObject.FooterDataBind&&this.ScreenObject.FooterDataBindColumns.Contains("Formula"))for(var n=0;n<this.ScreenObject.FooterDataBind.length;n++)this.CheckMaxMinFormula(e,o.e.String(this.ScreenObject.FooterDataBind[n].Formula));if(this.ScreenObject.Data.Tables.length>10){if(this.ScreenObject.Data.Columns[10].Contains("Expression"))for(var a=0;a<this.ScreenObject.Data.Tables[10].length;a++)this.CheckMaxMinFormula(e,o.e.String(this.ScreenObject.Data.Tables[10][a].Expression));if(this.ScreenObject.Data.Columns[9].Contains("Expression"))for(var i=0;i<this.ScreenObject.Data.Tables[9].length;i++)this.CheckMaxMinFormula(e,o.e.String(this.ScreenObject.Data.Tables[9][i].Expression))}}},{key:"ChangeDateIfDateExists",value:function(e){try{var t=!1,n=this.ScreenObject.Data.Tables[8].filter((function(e){return 0==e.SeriesNo}));n.sort((function(e,t){return e.PrefixOrder-t.PrefixOrder}));for(var a=0,i=0,r=0,c=0,l=0,u=0;u<n.length;u++)51==parseInt(n[u].CCID)||52==parseInt(n[u].CCID)||53==parseInt(n[u].CCID)?(t=!0,o.e.IsEmpty(n[u].Delimiter)?"D"==n[u].Length.toString()?a>=0&&e.length>=a+2&&o.e.IsNum(e.substr(a,2))&&parseInt(e.substr(a,2))<31?(l=parseInt(e.substr(a,2)),a+=2):o.e.IsNum(e.substr(a,1))&&(l=parseInt(e.substr(a,1)),a++):"DD"==n[u].Length.toString()?a>=0&&e.length>=a+2&&o.e.IsNum(e.substr(a,2))&&parseInt(e.substr(a,2))<31&&(l=parseInt(e.substr(a,2)),a+=2):"MM"==n[u].Length.toString()?a>=0&&e.length>=a+2&&o.e.IsNum(e.substr(a,2))&&parseInt(e.substr(a,2))<13&&(c=parseInt(e.substr(a,2)),a+=2):"M"==n[u].Length.toString()?a>=0&&e.length>=a+2&&o.e.IsNum(e.substr(a,2))&&parseInt(e.substr(a,2))<13?(c=parseInt(e.substr(a,2)),a+=2):o.e.IsNum(e.substr(a,1))&&(c=parseInt(e.substr(a,1)),a++):"MMM"==n[u].Length.toString()?a>=0&&e.length>=a+3&&(c=this.ScreenObject.GetMonthNo(e.substr(a,3)),a+=3):"YY"==n[u].Length.toString()?a>=0&&e.length>=a+2&&o.e.IsNum(e.substr(a,2))&&(r=parseInt(e.substr(a,2))+2e3,a+=2):"YYYY"==n[u].Length.toString()?a>=0&&e.length>=a+4&&o.e.IsNum(e.substr(a,4))&&(r=parseInt(e.substr(a,4)),a+=4):"YY-YY"==n[u].Length.toString()&&a>=0&&e.length>a+5&&o.e.IsNum(e.substr(a,2))&&o.e.IsNum(e.substr(a+3,2))&&(r=0==c?s.a.SessionManager.AccountingToMonth<(new Date).iMonth()?parseInt(e.substr(a,2))+2e3:parseInt(e.substr(a+3,2))+2e3:s.a.SessionManager.AccountingToMonth<c?parseInt(e.substr(a,2))+2e3:parseInt(e.substr(a+3,2))+2e3,a+=5):(i=e.indexOf(n[u].Delimiter.toString(),a))>0&&(o.e.IsNum(e.substr(a,i-a))?(o.e.Int(e.substr(a,i-a)),51==parseInt(n[u].CCID)?l=parseInt(e.substr(a,i-a)):52==parseInt(n[u].CCID)?c=parseInt(e.substr(a,i-a)):53==parseInt(n[u].CCID)&&(r="YY"==n[u].Length.toString()&&i-a==2?parseInt(e.substr(a,i-a))+2e3:parseInt(e.substr(a,i-a))),a=i+1):"YY-YY"==n[u].Length.toString()&&(a>=0&&e.length>=a+5&&o.e.IsNum(e.substr(a,2))&&o.e.IsNum(e.substr(a+3,2))&&(r=0==c?s.a.SessionManager.AccountingToMonth<(new Date).iMonth()?parseInt(e.substr(a,2))+2e3:parseInt(e.substr(a+3,2))+2e3:s.a.SessionManager.AccountingToMonth<c?parseInt(e.substr(a,2))+2e3:parseInt(e.substr(a+3,2))+2e3),a=i+1))):o.e.IsEmpty(n[u].Delimiter)?o.e.IsNum(n[u].Length)&&(a+=parseInt(n[u].Length)):(i=e.indexOf(n[u].Delimiter.toString(),a))>0&&(a=i+1);if(t&&(r>0||c>0||l>0)){if(r>0&&this.DocumentDate.getFullYear()==r||c>0&&this.DocumentDate.iMonth()==c||l>0&&this.DocumentDate.getDate()==l)return;0==r&&(r=(new Date).getFullYear()),0==c&&(c=s.a.SessionManager.AccountingToMonth,s.a.SessionManager.AccountingFromMonth>s.a.SessionManager.AccountingToMonth&&0==r&&(r=(new Date).iMonth()<s.a.SessionManager.AccountingFromMonth?(new Date).getFullYear():(new Date).getFullYear()+1)),0==l&&(l=new Date(r,c,1).DaysInMonth()),this._Ddate=new Date(r,c,l)}}catch(d){Logger.ErrorLog("addeditdocument","ChangeDateifDateExists","CheckDateinPrefix",d)}}},{key:"CheckDateInDocNumber",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=!1,i="";if(null!=this.ScreenObject.DocPrefix){var r=new c.a;if(this.ScreenObject.DocPrefix.Prefixes.keys.forEach((function(e){null!=e&&(i=e);var c=t.ScreenObject.DocPrefix.Prefixes[e];i.Contains("'DD'")?(a=!0,i=t.DocumentDate.getDate()>9?i.replace("'DD'",t.DocumentDate.getDate().toString()):i.replace("'DD'","0"+t.DocumentDate.getDate().toString())):i.Contains("'D'")&&(a=!0,i=i.replace("'D'",t.DocumentDate.getDate().toString())),i.Contains("'MMM'")?(a=!0,i=i.replace("'MMM'",t.ScreenObject.GetMonthName(t.DocumentDate.iMonth(),!1))):i.Contains("'MM'")?(a=!0,i=t.DocumentDate.iMonth()>9?i.replace("'MM'",t.DocumentDate.iMonth().toString()):i.replace("'MM'","0"+t.DocumentDate.iMonth().toString())):i.Contains("'M'")?(a=!0,i=i.replace("'M'",t.DocumentDate.iMonth().toString())):i.Contains("'Name'")&&(a=!0,i=i.replace("'Name'",t.ScreenObject.GetMonthName(t.DocumentDate.iMonth(),!0))),i.Contains("'YYYY'")?(a=!0,i=i.replace("'YYYY'",t.DocumentDate.getFullYear().toString())):i.Contains("'YY'")?(a=!0,i=i.replace("'YY'",t.DocumentDate.getFullYear().toString().substr(2))):i.Contains("'YY-YY'")&&(a=!0,i=t.DocumentDate.iMonth()<s.a.SessionManager.AccountingFromMonth?i.replace("'YY-YY'",(t.DocumentDate.getFullYear()-1).toString().substr(2)+"-"+t.DocumentDate.getFullYear().toString().substr(2)):i.replace("'YY-YY'",t.DocumentDate.getFullYear().toString().substr(2)+"-"+(t.DocumentDate.getFullYear()+1).toString().substr(2))),a||c?t.ScreenObject.DocPrefix.ComboBox.Items.find((function(e){return e.Value==i}))?r.ContainsKey(i)||r.push(i,c):(t.ScreenObject.Preferences.ContainsKey("StartNoForNewPrefix")&&!o.e.IsEmpty(t.ScreenObject.Preferences.StartNoForNewPrefix)&&"0"!=t.ScreenObject.Preferences.StartNoForNewPrefix?t.ScreenObject.DocPrefix.ComboBox.Items.push(m.d.ComboBoxItems_4(i,i,"",t.ScreenObject.Preferences.StartNoForNewPrefix.length.toString())):t.ScreenObject.DocPrefix.ComboBox.Items.push(m.d.ComboBoxItems_4(i,i,"","1")),r.ContainsKey(i)||r.push(i,c),n&&(c||1==t.ScreenObject.DocPrefix.Prefixes.length)&&(t.isFromDate=!0,t.ScreenObject.DocPrefix.ComboBox.SelectedItem=t.ScreenObject.DocPrefix.ComboBox.Items[t.ScreenObject.DocPrefix.ComboBox.Items.length-1],t.ScreenObject.DocPrefix.ComboBox.SelectedValue=i,t.isFromDate=!1)):(null==t.ScreenObject.DocPrefix.ComboBox.Items.find((function(e){return e.Value==i}))&&(t.ScreenObject.Preferences.ContainsKey("StartNoForNewPrefix")&&!o.e.IsEmpty(t.ScreenObject.Preferences.StartNoForNewPrefix)&&"0"!=t.ScreenObject.Preferences.StartNoForNewPrefix?t.ScreenObject.DocPrefix.ComboBox.Items.push(m.d.ComboBoxItems_4(i,i,"",t.ScreenObject.Preferences.StartNoForNewPrefix.length.toString())):t.ScreenObject.DocPrefix.ComboBox.Items.push(m.d.ComboBoxItems_4(i,i,"","1"))),r.ContainsKey(i)||r.push(i,c))})),a&&r.length>0&&!e&&n&&!o.e.IsEmpty(this.ScreenObject.DocPrefix.ComboBox.SelectedValue)&&!r.ContainsKey(this.ScreenObject.DocPrefix.ComboBox.SelectedValue)){this.isFromDate=!0;var l=r.GetItemByValue(!0);this.ScreenObject.DocPrefix.ComboBox.SelectedValue=null==l&&r.length>0?r.keys[0]:l.Key,this.isFromDate=!1}else if(a&&r.length>0&&e&&n&&(o.e.IsEmpty(this.ScreenObject.DocPrefix.ComboBox.SelectedValue)||!r.ContainsKey(this.ScreenObject.DocPrefix.ComboBox.SelectedValue))){this.isFromDate=!0;var u=r.GetItemByValue(!0);this.ScreenObject.DocPrefix.ComboBox.SelectedValue=null==u&&r.length>0?r.keys[0]:u.Key,this.isFromDate=!1}else if(!a&&e){this.isFromDate=!0;var d=this.ScreenObject.DocPrefix.Prefixes.values.indexOf(!0);if(null!=(i=-1==d&&this.ScreenObject.DocPrefix.Prefixes.length>0?this.ScreenObject.DocPrefix.Prefixes.keys[0]:this.ScreenObject.DocPrefix.Prefixes.keys[d])){var D=this.ScreenObject.DocPrefix.ComboBox.Items.find((function(e){return e.Value==i}));o.e.IsEmpty(D)&&(this.ScreenObject.Preferences.ContainsKey("StartNoForNewPrefix")&&!o.e.IsEmpty(this.ScreenObject.Preferences.StartNoForNewPrefix)&&"0"!=this.ScreenObject.Preferences.StartNoForNewPrefix?this.ScreenObject.DocPrefix.ComboBox.Items.push(m.d.ComboBoxItems_4(i,i,"",this.ScreenObject.Preferences.StartNoForNewPrefix.length.toString())):this.ScreenObject.DocPrefix.ComboBox.Items.push(m.d.ComboBoxItems_4(i,i,"","1"))),this.ScreenObject.DocPrefix.ComboBox.SelectedValue=i}this.isFromDate=!1}if(this.IsInventoryVoucher&&(this.ScreenObject.IsPurchase&&null!=this.ScreenObject.CreditAccount&&this.ScreenObject.CreditAccount.SelectedValue>0?this.ScreenObject.GetDueDate(this.ScreenObject.CreditAccount.SelectedValue,this.DocumentDate,this.ScreenObject.IsPurchase):!this.ScreenObject.IsPurchase&&null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.SelectedValue>0&&this.ScreenObject.GetDueDate(this.ScreenObject.DebitAccount.SelectedValue,this.DocumentDate,this.ScreenObject.IsPurchase)),e||n&&(this.DisplayMessage=""),this.ScreenObject.DocPrefix.ComboBox.Items.length>0&&null!=this.ScreenObject.DocPrefix.ComboBox.SelectedValue){var h=this.ScreenObject.DocPrefix.ComboBox.Items.find((function(e){return e.Value==t.ScreenObject.DocPrefix.ComboBox.SelectedValue}));h&&(this.ScreenObject.DocPrefix.ComboBox.SelectedItem=h,this.ScreenObject.DocPrefix.ComboBox.Text=h.Name)}}}},{key:"FillExchangeRates",value:function(){var e=this;if(s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])){var t=o.e.Int(s.a.SessionManager.Preferences.DimensionwiseCurrency);this.Currency&&null!=this.Currency.Currency.SelectedValue&&""!=this.Currency.Currency.SelectedValue&&(this.Currency.ExchangeRate.Text="1"==this.Currency.Currency.SelectedValue?t>5e3?this.ScreenObject.GetExchangeRate(parseInt(this.Currency.Currency.SelectedValue),this.DocumentDate).toString():"1.0":this.ScreenObject.GetExchangeRate(parseInt(this.Currency.Currency.SelectedValue),this.DocumentDate).toString()),this.ScreenObject.ColumnSource.forEach((function(n){n.CurrID>0&&(n.ExhcgRt=1==n.CurrID?t>5e3?e.ScreenObject.GetExchangeRate(n.CurrID,e.DocumentDate):1:e.ScreenObject.GetExchangeRate(n.CurrID,e.DocumentDate))}));var n=this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&55847==e.LinkData}));if(n.length>0&&""!=s.a.SessionManager.Preferences.BaseCurrency&&o.e.IsNum(s.a.SessionManager.Preferences.BaseCurrency)&&o.e.Double(s.a.SessionManager.Preferences.BaseCurrency)>0){var a=this.ScreenObject._TextFields.find((function(e){return e.DBColumnID.toString()==n[0].CostcenterColid.toString()}));a&&a instanceof h.d&&(a.Text=this.ScreenObject.GetExchangeRate(parseInt(s.a.SessionManager.Preferences.BaseCurrency),this.DocumentDate).toString())}}for(var i="1",r=0;r<this.ScreenObject.GridData.length;r++){if(this.IsInventoryVoucher){if(!o.e.IsEmpty(this.ScreenObject.GridData[r].ProductID_Key))continue}else{if(this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&o.e.IsEmpty(this.ScreenObject.GridData[r].CreditAccount_Key))continue;if(this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&o.e.IsEmpty(this.ScreenObject.GridData[r].DebitAccount_Key))continue;if(this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&o.e.IsEmpty(this.ScreenObject.GridData[r].AccountID_Key))continue}for(var c=0;c<this.ScreenObject.ColumnSource.length;c++)this.ScreenObject.ColumnSource[c].DisplayMember.toLowerCase().Contains("dcnum")&&(i=this.ScreenObject.ColumnSource[c].DisplayMember.toLowerCase().replace("dcnum","").toString(),this.ScreenObject.GridDataColumns.Contains("dcExchRT"+i)&&this.ScreenObject.GridDataColumns.Contains("dcCurrID"+i+"_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[r]["dcCurrID"+i+"_Key"])&&(this.ScreenObject.GridData[r]["dcExchRT"+i]=1==parseInt(this.ScreenObject.GridData[r]["dcCurrID"+i+"_Key"])?"1":this.ScreenObject.GetExchangeRate(parseInt(this.ScreenObject.GridData[r]["dcCurrID"+i+"_Key"]),this.DocumentDate)));this.CalculateTotals(this.ScreenObject.GridData[r],!1)}if(this.IsInventoryVoucher)for(var u=0;u<this.ScreenObject.FooterGridData.length;u++)o.e.IsEmpty(this.ScreenObject.FooterGridData[u].Amount)||o.e.IsEmpty(this.ScreenObject.FooterGridData[u].dcCurrID_Key)||(this.ScreenObject.FooterGridData[u].dcExchRT=1==parseInt(this.ScreenObject.FooterGridData[u].dcCurrID_Key)?"1":this.ScreenObject.GetExchangeRate(parseInt(this.ScreenObject.FooterGridData[u].dcCurrID_Key),this.DocumentDate))}},{key:"GetTrimString",value:function(e,t){return null!=e&&t>=0&&e.length>t?e.substr(0,t):e}},{key:"ChangeLocation",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(31==this.ScreenObject.DocumentType)this.CheckStockDimensions(),this.DocumentNumber=new w.DocumentNumberViewModel(this,this.ScreenObject.Data.Tables[8],!0,a),s.a.page.ShowDialog(this.DocumentNumber,vt.a,{HideClose:!0,ShowCenter:!0,Title:s.a.GetResource("DocumentNumberTitle"),CallBack:[this,"DocNumberCallBack"]});else if(this.ScreenObject.Data.Tables.length>8&&this.ScreenObject.Data.Tables[8].length>0||s.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==s.a.SessionManager.Preferences.EnableDivisionWise.toString()&&(!this.ScreenObject.Preferences.ContainsKey("Donotusedivision")||""==this.ScreenObject.Preferences.Donotusedivision||!Object(l.j)(this.ScreenObject.Preferences.Donotusedivision))&&0==s.a.SessionManager.DivisionID||s.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==s.a.SessionManager.Preferences.EnableLocationWise.toString()&&(!this.ScreenObject.Preferences.ContainsKey("Donotuselocation")||""==this.ScreenObject.Preferences.Donotuselocation||!Object(l.j)(this.ScreenObject.Preferences.Donotuselocation))&&0==n||e){var i=this.ScreenObject.Data.Tables[8].filter((function(e){return e.CCID>5e4}));if(i.length>0||s.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==s.a.SessionManager.Preferences.EnableDivisionWise.toString()&&(!this.ScreenObject.Preferences.ContainsKey("Donotusedivision")||""==this.ScreenObject.Preferences.Donotusedivision||!Object(l.j)(this.ScreenObject.Preferences.Donotusedivision))&&0==s.a.SessionManager.DivisionID||s.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==s.a.SessionManager.Preferences.EnableLocationWise.toString()&&(!this.ScreenObject.Preferences.ContainsKey("Donotuselocation")||""==this.ScreenObject.Preferences.Donotuselocation||!Object(l.j)(this.ScreenObject.Preferences.Donotuselocation))&&0==n||e){i=this.ScreenObject.Data.Tables[8].filter((function(e){return e.CCID>5e4&&50002!=e.CCID}));var r=this.ScreenObject.Data.Tables[8].filter((function(e){return e.CCID>5e4&&50002!=e.CCID&&50001!=e.CCID}));if(!e&&n>0&&0==i.length&&(!s.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")||"True"!=s.a.SessionManager.Preferences.EnableDivisionWise.toString()||this.ScreenObject.Preferences.ContainsKey("Donotusedivision")&&""!=this.ScreenObject.Preferences.Donotusedivision&&Object(l.j)(this.ScreenObject.Preferences.Donotusedivision)||0!=s.a.SessionManager.DivisionID)){for(var c="",u=0,d=0;d<this.ScreenObject.Data.Tables[8].length;d++)0==d&&(u=parseInt(this.ScreenObject.Data.Tables[8][d].SeriesNo)),o.e.IsEmpty(this.ScreenObject.Data.Tables[8][d].SeriesNo)||parseInt(this.ScreenObject.Data.Tables[8][d].SeriesNo)==u||(null==this.ScreenObject.DocPrefix||this.ScreenObject.DocPrefix.Prefixes.ContainsKey(c)||this.ScreenObject.DocPrefix.Prefixes.push(c,Object(l.j)(this.ScreenObject.Data.Tables[8][d-1].Isdefault)),u=parseInt(this.ScreenObject.Data.Tables[8][d].SeriesNo),c=""),50002==parseInt(this.ScreenObject.Data.Tables[8][d].CCID)?c+=this.GetTrimString(this.ScreenObject.GetDocNumberString(this.ScreenObject.Data.Tables[8][d].SysColumnName,50002,n),parseInt(this.ScreenObject.Data.Tables[8][d].Length))+this.ScreenObject.Data.Tables[8][d].Delimiter.toString():51==parseInt(this.ScreenObject.Data.Tables[8][d].CCID)||52==parseInt(this.ScreenObject.Data.Tables[8][d].CCID)||53==parseInt(this.ScreenObject.Data.Tables[8][d].CCID)?c+="'"+this.ScreenObject.Data.Tables[8][d].Length.toString()+"'"+this.ScreenObject.Data.Tables[8][d].Delimiter.toString():54==parseInt(this.ScreenObject.Data.Tables[8][d].CCID)&&(c+=this.ScreenObject.Data.Tables[8][d].Length.toString()+this.ScreenObject.Data.Tables[8][d].Delimiter.toString());this.ScreenObject.Data.Tables[8].length>0&&null!=this.ScreenObject.DocPrefix&&!this.ScreenObject.DocPrefix.Prefixes.ContainsKey(c)&&this.ScreenObject.DocPrefix.Prefixes.push(c,Object(l.j)(this.ScreenObject.Data.Tables[8][this.ScreenObject.Data.Tables[8].length-1].Isdefault)),this.DialogResult=!0}else if(!e&&n>0&&s.a.SessionManager.DivisionID>0&&0==r.length){for(var D="",h=0,S=0;S<this.ScreenObject.Data.Tables[8].length;S++)0==S&&(h=parseInt(this.ScreenObject.Data.Tables[8][S].SeriesNo)),o.e.IsEmpty(this.ScreenObject.Data.Tables[8][S].SeriesNo)||parseInt(this.ScreenObject.Data.Tables[8][S].SeriesNo)==h||(null==this.ScreenObject.DocPrefix||this.ScreenObject.DocPrefix.Prefixes.ContainsKey(D)||this.ScreenObject.DocPrefix.Prefixes.push(D,Object(l.j)(this.ScreenObject.Data.Tables[8][S-1].Isdefault)),h=parseInt(this.ScreenObject.Data.Tables[8][S].SeriesNo),D=""),50002==parseInt(this.ScreenObject.Data.Tables[8][S].CCID)?D+=this.GetTrimString(this.ScreenObject.GetDocNumberString(this.ScreenObject.Data.Tables[8][S].SysColumnName,50002,n),parseInt(this.ScreenObject.Data.Tables[8][S].Length))+this.ScreenObject.Data.Tables[8][S].Delimiter.toString():50001==parseInt(this.ScreenObject.Data.Tables[8][S].CCID)?D+=this.GetTrimString(this.ScreenObject.GetDocNumberString(this.ScreenObject.Data.Tables[8][S].SysColumnName,50001,s.a.SessionManager.DivisionID),parseInt(this.ScreenObject.Data.Tables[8][S].Length))+this.ScreenObject.Data.Tables[8][S].Delimiter.toString():51==parseInt(this.ScreenObject.Data.Tables[8][S].CCID)||52==parseInt(this.ScreenObject.Data.Tables[8][S].CCID)||53==parseInt(this.ScreenObject.Data.Tables[8][S].CCID)?D+="'"+this.ScreenObject.Data.Tables[8][S].Length.toString()+"'"+this.ScreenObject.Data.Tables[8][S].Delimiter.toString():54==parseInt(this.ScreenObject.Data.Tables[8][S].CCID)&&(D+=this.ScreenObject.Data.Tables[8][S].Length.toString()+this.ScreenObject.Data.Tables[8][S].Delimiter.toString());this.ScreenObject.Data.Tables[8].length>0&&null!=this.ScreenObject.DocPrefix&&!this.ScreenObject.DocPrefix.Prefixes.ContainsKey(D)&&this.ScreenObject.DocPrefix.Prefixes.push(D,Object(l.j)(this.ScreenObject.Data.Tables[8][this.ScreenObject.Data.Tables[8].length-1].Isdefault)),this.DialogResult=!0}else t||(this.DocumentNumber=new w.DocumentNumberViewModel(this,this.ScreenObject.Data.Tables[8],!1,a),this.DocumentNumber.IsFirstCall=!e,o.e.IsEmpty(this.DocumentNumber.DisplayMessage)||t||s.a.page.ShowDialog(this.DocumentNumber,F.DocumentNumberComponent,{HideClose:!0,ShowCenter:!0,Title:s.a.GetResource("DocumentNumberTitle"),CallBack:[this,"DocNumberCallBack"]}))}else{for(var m="",b=0,C=0;C<this.ScreenObject.Data.Tables[8].length;C++)0==C&&(b=parseInt(this.ScreenObject.Data.Tables[8][C].SeriesNo)),o.e.IsEmpty(this.ScreenObject.Data.Tables[8][C].SeriesNo)||parseInt(this.ScreenObject.Data.Tables[8][C].SeriesNo)==b||(this.ScreenObject.DocPrefix&&!this.ScreenObject.DocPrefix.Prefixes.ContainsKey(m)&&this.ScreenObject.DocPrefix.Prefixes.push(m,C>0?Object(l.j)(this.ScreenObject.Data.Tables[8][C-1].Isdefault):Object(l.j)(this.ScreenObject.Data.Tables[8][C].Isdefault)),b=parseInt(this.ScreenObject.Data.Tables[8][C].SeriesNo),m=""),51==parseInt(this.ScreenObject.Data.Tables[8][C].CCID)||52==parseInt(this.ScreenObject.Data.Tables[8][C].CCID)||53==parseInt(this.ScreenObject.Data.Tables[8][C].CCID)?m+="'"+this.ScreenObject.Data.Tables[8][C].Length.toString()+"'"+this.ScreenObject.Data.Tables[8][C].Delimiter.toString():54==parseInt(this.ScreenObject.Data.Tables[8][C].CCID)&&(m+=this.ScreenObject.Data.Tables[8][C].Length.toString()+this.ScreenObject.Data.Tables[8][C].Delimiter.toString());this.ScreenObject.Data.Tables[8].length>0&&null!=this.ScreenObject.DocPrefix&&!this.ScreenObject.DocPrefix.Prefixes.ContainsKey(m)&&this.ScreenObject.DocPrefix.Prefixes.push(m,Object(l.j)(this.ScreenObject.Data.Tables[8][this.ScreenObject.Data.Tables[8].length-1].Isdefault)),this.DialogResult=!0}}else this.DialogResult=!0;this.DocumentNumber&&this.DocumentNumber.DialogOptions&&this.DocumentNumber.DialogOptions.IsOpen||this.DocNumberCallBack(e)}},{key:"DocNumberCallBack",value:function(e){var t=this;this.CheckDateInDocNumber(!0),this.OnDocPrefixChanged_2(this.ScreenObject.Prefix,!!e),this.ScreenObject.SetDefaultValuesforCostCenters(0),this.ScreenObject.FillListViews(!1),s.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==s.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(this.ScreenObject.FillListViews(!0),this.ReportDimension&&(this.ReportDimension.IsAutoLoad=!0)),this.ToLinkParent&&(this.ToLinkParent.GenerateLinkDocument_Sub1(this),this.ToLinkParent=null),this.DocNumberDelegate.IsSubscribed&&setTimeout((function(){t.DocNumberDelegate.Call()}),50)}},{key:"onDeleteRow",value:function(e){this.IsSelectAll||(this.ScreenObject.UpdateSequence(),this.CalculateTotals(null,!1),this.CheckVendorWiseLinkingPref())}},{key:"onCurrencyChanged",value:function(e){null==this.ScreenObject||null!=this.lastCurr&&null!=this.Currency.Currency.SelectedValue&&this.Currency.Currency.SelectedValue==this.lastCurr||(this.lastCurr=this.Currency.Currency.SelectedValue,this.Currency.ExchangeRate.Text=null!=this.Currency.Currency.SelectedValue&&""!=this.Currency.Currency.SelectedValue?this.ScreenObject.GetExchangeRate(parseInt(this.Currency.Currency.SelectedValue),this.DocumentDate).toString():"1",this.ScreenObject.PriceTaxcc.ContainsKey(12)&&this.ReEvaluatePriceTax(12))}},{key:"onExchangeRateChanged",value:function(e){var t=this;this.ScreenObject.GridData.forEach((function(e){(t.IsInventoryVoucher&&t.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!o.e.IsEmpty(e.ProductID_Key)&&parseInt(e.ProductID_Key)>0||!t.IsInventoryVoucher&&t.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!o.e.IsEmpty(e.DebitAccount_Key)&&parseInt(e.DebitAccount_Key)>0||!t.IsInventoryVoucher&&t.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!o.e.IsEmpty(e.CreditAccount_Key)&&parseInt(e.CreditAccount_Key)>0||!t.IsInventoryVoucher&&t.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&!o.e.IsEmpty(e.AccountID_Key)&&parseInt(e.AccountID_Key)>0)&&t.CalculateTotals(e,!1)}))}},{key:"onHistoryClick",value:function(e){var t=this.GetButton("Save");if(null!=this.SelectedHistoryRow&&!o.e.IsEmpty(this.SelectedHistoryRow.maxid)){var n=!1,a=null;"YES"==this.SelectedHistoryRow.IsCurrent.toString()?(a=this.ScreenObject.GetEditDataByDOCID(),n=!1):(a=this.ScreenObject.GetEditDataByVersion(-1,this.SelectedHistoryRow.maxid.toString()),n=!0),null!=a&&this.ScreenObject.IsDocEdit&&a.Tables.length>0&&a.Tables[0].length>0&&(this.ScreenObject.LoadEditData(a,!1),this.RefreshGrid=!0),n?(this.ButtonSave.Visible=!1,this.ButtonSaveandPrint.Visible=!1,null!=t&&(t.Visible=!1),this.ButtonRevise.Visible=!1,this.ButtonDelete.Visible=!1,this.ButtonSuspendDoc.Visible=!1):(s.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"):this.ButtonSave.Enable=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"),s.a.SessionManager.HideUnathorizedAccess?this.ButtonSaveandPrint.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"):this.ButtonSaveandPrint.Enable=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"),this.ScreenObject.Preferences.ContainsKey("enebleSaveonhold")&&""!=this.ScreenObject.Preferences.enebleSaveonhold&&Object(l.j)(this.ScreenObject.Preferences.enebleSaveonhold)&&438==this.StatusID&&null!=t?(t.Enable=this.ButtonSave.Enable,t.Visible=this.ButtonSave.Visible):null!=t&&(t.Visible=!1),this.ScreenObject.Preferences.ContainsKey("EnableRevision")&&""!=this.ScreenObject.Preferences.EnableRevision&&Object(l.j)(this.ScreenObject.Preferences.EnableRevision)?s.a.SessionManager.HideUnathorizedAccess?this.ButtonRevise.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Revise"):(this.ButtonRevise.Visible=!0,this.ButtonRevise.Enable=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Revise")):this.ButtonRevise.Visible=!1,s.a.SessionManager.HideUnathorizedAccess?this.ButtonDelete.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"):this.ButtonDelete.Enable=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),s.a.SessionManager.HideUnathorizedAccess?this.ButtonSuspendDoc.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Suspend"):this.ButtonSuspendDoc.Enable=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Suspend"))}}},{key:"onAttachLinkClick",value:function(e){null==e.grid?(this.SelectedRow=e.selectedRow,this.RowAttachments(e.sender.DisplayMember,!1,null!=this.SelectedRow?e.row:null)):(this.SelectedRow=e.grid.getDataItem(e.row),this.RowAttachments(e.sender.DisplayMember,!1,null!=this.SelectedRow?e.row:null))}},{key:"RowAttachments",value:function(e,t,n){var a=this;Logger.InfoLog("attachclick"),this.OnAddAttachment(),this.SetVisibiltiFalse(),this.AttachmentVisibility=!0,this.RightTabSelectedIndex=5;var i=this.ScreenObject.ColumnSource.find((function(t){return t.DisplayMember==e})),r=null;if(Logger.InfoLog("attachclick",i.toString(),"col"),null!=this.ViewAttachments&&this.ViewAttachments.AttachmentsList.forEach((function(t){t.RowID==n&&t.ColID==e?(t.Height=20,(null!=i&&!o.e.IsEmpty(i.FilterCondition)&&"jpg"==t.FileExtension.toLowerCase()||"jpeg"==t.FileExtension.toLowerCase()||"png"==t.FileExtension.toLowerCase())&&(r=t)):t.Height=0})),this.Attachment.RowID=n,this.Attachment.ColID=e,this.Attachment.SaveVisible&&(this.Attachment.SaveVisible=!1,this.Attachment.OkVisible=!0),i&&i.Dependantinuse){if(null!=r){o.e.IsEmpty(r.FilePath)?o.b.GetLogPath(r.guid+"."+r.FileExtension):r.FilePath}}else if(i&&!o.e.IsEmpty(i.FilterCondition)&&null!=n){var c=function(){for(var s=i.FilterCondition.split(","),c="",l=function(e){(i=a.ScreenObject.ColumnSource.find((function(t){return t.CostCenterID.toString()==s[e]})))&&!o.e.IsEmpty(n[i.ValueMember])&&(""!=c&&(c+=" OR "),c+="(FeatureID="+i.CostCenterID.toString()+" and FeaturePK="+n[i.ValueMember].toString()+")")},u=0;u<s.length;u++)l(u);if(!o.e.IsEmpty(c)){var d=a.ScreenObject.GetFiles(0,0,c);if(null!=d&&d.Columns[0].Contains("GUID")){if(null!=d&&d.Tables.length>0)for(var D=0;D<d.Tables[0].length;D++)o.b.GetLogPath(d.Tables[0][D].GUID.toString()+"."+d.Tables[0][D].FileExtension.toString())+";";if(null!=r&&o.b.GetLogPath(r.guid+"."+r.FileExtension),t)return{v:void(1==d.Tables[0].length&&(null!=r?(r.FileExtension=d.Tables[0][0].FileExtension.toString(),r.Guid=d.Tables[0][0].GUID.toString(),r.AllowInPrintVisible=!0,r.isfrmProduct=!0):(r=new N.AddAttachmentViewModel,r.FileExtension=d.Tables[0][0].FileExtension.toString(),r.Guid=d.Tables[0][0].GUID.toString(),r.AllowInPrintVisible=!0,r.isfrmProduct=!0,r.RowID=n,r.ColID=e,a.ViewAttachments.AttachmentsListObj.addRow(r))))}}}}();if("object"==typeof c)return c.v}s.a.page.ShowDialog(this,E.a,{Title:"Attachment"})}},{key:"onLinkRefClick",value:function(e){if(this.IsInventoryVoucher){if(null!=this.SelectedRow&&this.ScreenObject.GridDataColumns.Contains("LinkedInvDocDetailsID")&&""!=o.e.String(this.SelectedRow.LinkedInvDocDetailsID)){var t=this.ScreenObject.GetDocDetailsByInvID(parseInt(this.SelectedRow.LinkedInvDocDetailsID));if(null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&!t.Columns[0].Contains("ErrorMessage")){var n;n=t.Columns[0].Contains("DisplayName")&&!o.e.IsEmpty(t.Tables[0][0].DisplayName)?t.Tables[0][0].DisplayName.toString():t.Tables[0][0].ResourceData.toString();var i=new a(parseInt(t.Tables[0][0].CCID),n,!0);i.ScreenObject.DocPrefix.ComboBox.SelectedValue=t.Tables[0][0].Prefix.toString(),i.ScreenObject.DocPrefix.TextBox.Text=t.Tables[0][0].DocNumber.toString(),i.OnDocPrefixChanged("lostFocus"),i.RefreshGridFooter||(i.RefreshGridFooter=!0),i.ScreenObject.FillDocumentPrefix(!0),null==i.ScreenObject.DocPrefix.ComboBox.SelectedValue&&(i.ScreenObject.DocPrefix.ComboBox.SelectedValue=t.Tables[0][0].Prefix.toString()),s.a.page.addNewTab({component:x.AddEditDocumentComponent,params:{obj:i}})}}}else null!=this.SelectedRow&&s.a.page.ShowDialog(new ut.AddDenominationViewModel(this,o.e.String(this.SelectedRow.DenominationsXML)),lt.AddDenominationComponent)}},{key:"Setselectedrow",value:function(e){this.SelectedRow=this.ScreenObject.GridData[e]}},{key:"onVerionChanged",value:function(e){var t;if(!o.e.IsEmpty(e)&&o.e.IsNum(e)){t=0;for(var n=0;n<this.ScreenObject.DocPrefix.RevisionCombo.Items.length;n++)parseInt(this.ScreenObject.DocPrefix.RevisionCombo.Items[n].Value)>t&&(t=parseInt(this.ScreenObject.DocPrefix.RevisionCombo.Items[n].Value));var a=null;parseInt(e)<t?a=this.ScreenObject.GetEditDataByVersion(parseInt(e),"0"):this.ScreenObject.IsDocEdit&&(a=this.ScreenObject.GetEditDataByDOCID(),s.a.SessionManager.HideUnathorizedAccess?this.ButtonDelete.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"):this.ButtonDelete.Enable=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),s.a.SessionManager.HideUnathorizedAccess?this.ButtonSuspendDoc.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Suspend"):this.ButtonSuspendDoc.Enable=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Suspend"),s.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"):this.ButtonSave.Enable=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"),s.a.SessionManager.HideUnathorizedAccess?this.ButtonSaveandPrint.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save&Print"):this.ButtonSaveandPrint.Enable=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save&Print"),this.HideButtons("Save&Barcode"),this.HideButtons("BarcodePrint"),this.ScreenObject.Preferences.ContainsKey("EnableRevision")&&""!=this.ScreenObject.Preferences.EnableRevision&&Object(l.j)(this.ScreenObject.Preferences.EnableRevision)?s.a.SessionManager.HideUnathorizedAccess?this.ButtonRevise.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Revise"):(this.ButtonRevise.Visible=!0,this.ButtonRevise.Enable=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Revise")):this.ButtonRevise.Visible=!1),null!=a&&this.ScreenObject.IsDocEdit&&a.Tables.length>0&&a.Tables[0].length>0&&(this.ScreenObject.LoadEditData(a,!1),this.RefreshGrid=!0,this.CalculateTotals(null,!1)),parseInt(e)<t&&(this.ButtonSave.Visible=!1,this.ButtonSaveandPrint.Visible=!1,this.ButtonRevise.Visible=!1,this.ButtonDelete.Visible=!1,this.ButtonSuspendDoc.Visible=!1)}}},{key:"onComboBoxSelectionChanged",value:function(e){if(null!=this.ScreenObject)if(72==this.ScreenObject.DocumentType)null==e||o.e.IsEmpty(e)||("dcalpha13"==e.toLowerCase()&&this.ApplyVacationIsEncash(null),"dcalpha15"==e.toLowerCase()&&this.ApplyVacationExcessdays(""),"dcalpha16"==e.toLowerCase()&&this.ApplyVacationIsEncash(null));else if(92==this.DocumentType){var t="DayWise",n=this.ScreenObject._TextFields.find((function(e){return"dcalpha4"==e.DBColumnName.toLowerCase()}));n instanceof m.e&&(t=n.SelectedValue),"DayWise"==t?(this.ScreenObject._TextFields.forEach((function(e){e instanceof S.c&&("dcalpha1"==e.DBColumnName.toLowerCase()||"dcalpha2"==e.DBColumnName.toLowerCase())&&(e.IsReadOnly=!1)})),this.SetButtonVisibility("FillDates",!0)):(this.ScreenObject._TextFields.forEach((function(e){e instanceof S.c&&("dcalpha1"==e.DBColumnName.toLowerCase()||"dcalpha2"==e.DBColumnName.toLowerCase())&&(e.IsReadOnly=!0)})),this.SetButtonVisibility("FillDates",!1));for(var a=0;a<this.ScreenObject.ColumnSource.length;a++)"DCALPHA5"!=this.ScreenObject.ColumnSource[a].DisplayMember.toUpperCase()&&"DCALPHA6"!=this.ScreenObject.ColumnSource[a].DisplayMember.toUpperCase()&&"DCCCNID73"!=this.ScreenObject.ColumnSource[a].DisplayMember.toUpperCase()||(this.ScreenObject.ColumnSource[a].Mandatory="DayWise"!=t)}else if(89==this.ScreenObject.DocumentType||90==this.ScreenObject.DocumentType){var i=this.ScreenObject._TextFields.find((function(e){return"dcalpha32"==e.DBColumnName.toLowerCase()}));i instanceof m.e&&(null!=i.SelectedValue&&"Manual"==i.SelectedValue?(this.ScreenObject._TextFields.forEach((function(e){"dcalpha26"==e.DBColumnName.toLowerCase()?e.IsReadOnly=!0:"dcalpha27"==e.DBColumnName.toLowerCase()&&(e.Enable=!1)})),this.SetButtonVisibility("Save",!0),this.SetButtonVisibility("SaveAndPrint",!0),this.SetButtonVisibility("Check-in",!1),this.SetButtonVisibility("Check-out",!1)):(this.ScreenObject._TextFields.forEach((function(e){"dcalpha26"==e.DBColumnName.toLowerCase()?e.IsReadOnly=!1:"dcalpha27"==e.DBColumnName.toLowerCase()&&(e.Enable=!0)})),this.SetButtonVisibility("Save",!1),this.SetButtonVisibility("SaveAndPrint",!1),this.SetButtonVisibility("Check-in",!0),this.SetButtonVisibility("Check-out",!0)))}}},{key:"onTextBoxLostFocus",value:function(e){var t=this;if(null!=this.ScreenObject){if(this.ScreenObject._TextFields.forEach((function(e){t.fldDict.ContainsKey(e.Lbl)&&(e instanceof h.d?"FLOAT"==e.DataType?null!=e.Text&&""!=e.Text&&""==e.ValidateData()?t.fldDict[e.Lbl].setFieldValue(e.Text):t.fldDict[e.Lbl].setFieldValue(0):t.fldDict[e.Lbl].setFieldValue(e.Text):e instanceof m.e?t.fldDict[e.Lbl].setFieldValue(e.SelectedValue):e instanceof O.a?t.fldDict[e.Lbl].setFieldValue(e.Text):e instanceof C.b&&(e.SelectedValue>0&&!o.e.IsEmpty(e.Text)?t.fldDict[e.Lbl].setFieldValue(e.Text):t.fldDict[e.Lbl].setFieldValue("")))})),30==this.ScreenObject.DocumentType&&this.ScreenObject.GridDataColumns.Contains("IsKit")&&this.ScreenObject.Preferences.ContainsKey("AssembleQty")&&!o.e.IsEmpty(this.ScreenObject.Preferences.AssembleQty)){var n,a=this.ScreenObject._TextFields.find((function(e){return e.DBColumnID.toString()==t.ScreenObject.Preferences.AssembleQty}));if(a&&a instanceof h.d&&!o.e.IsEmpty(a.Text)&&o.e.IsNum(a.Text)&&a==e){n=parseFloat(a.Text);var i=this.ScreenObject.GridData.filter((function(e){return 1==e.IsKit}));i.length>0&&(o.e.IsEmpty(i[0].Quantity)||parseFloat(i[0].Quantity)!=n)&&(i[0].Quantity=n,this.CalculateTotals(i[0],!1,"Quantity"),(i=this.ScreenObject.GridData.find((function(e){return 2==e.IsKit}))).forEach((function(e){e.Quantity=o.e.IsEmpty(e.DefaultQuantity)?n:n*parseFloat(e.DefaultQuantity),t.CalculateTotals(e,!1,"Quantity")})))}}if((e instanceof h.d||e instanceof m.e||e instanceof O.a)&&this.ValidateData(e),72==this.ScreenObject.DocumentType&&e instanceof h.d&&"dcalpha14"==e.DBColumnName.toLowerCase()&&this.ApplyVacationIsTextEncash(null),e instanceof y.c&&!o.e.IsEmpty(e.KeyTip)&&"lostfocus"==e.KeyTip.toLowerCase()&&this.ValidateData(e,!0)&&this.ScreenObject.GetExternalFuncData(e.Mode,e.ToolTipFooterTitle,e.ToolTipFooterDescription,e.ToolTipDescription,null),this.CalcTextFields(),e instanceof h.d&&e.Calculate){var r=0;this.ScreenObject.GridData.forEach((function(e){t.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!o.e.IsEmpty(e.ProductID_Key)&&(t.CalculateTotals(e,!1),r++)})),0==r&&this.CalculateTotals(null,!1)}}}},{key:"CalcQOH",value:function(e){for(var t=this,n="",a=0;a<this.ScreenObject.GridData.length;a++)o.e.IsEmpty(this.ScreenObject.GridData[a].ProductID_Key)||(n.length>0&&(n+=","),n+=this.ScreenObject.GridData[a].ProductID_Key.toString());n.length>0&&this.ScreenObject.GridDataColumns.Contains("QOH")&&function(){var a="";if(t.ScreenObject.Preferences.ContainsKey("QOHField")){var i=t.ScreenObject.ColumnSource.find((function(e){return e.ID==t.ScreenObject.Preferences.QOHField}));!i||31!=t.DocumentType&&32!=t.DocumentType||(a=i.DisplayMember)}var r=t.ScreenObject.GetProductQtyOnHand(n,e);if(null!=r&&r.Tables.length>0&&r.Columns[0].Contains("ProductID"))for(var s=function(e){var n=t.ScreenObject.GridData.filter((function(t){return t.ProductID_Key==r.Tables[0][e].ProductID}));n[0].QOH=n.length>0?r.Tables[0][e].QOH.toString():0,""!=a&&(n[0][a]=n[0].QOH.toString())},o=0;o<r.Tables[0].length;o++)s(o)}()}},{key:"onDateChanged",value:function(e){if(e instanceof S.c){if(31!=this.DocumentType&&32!=this.DocumentType||"duedate"!=e.DBColumnName.toLowerCase()||this.CalcQOH(e.Date?e.Date:this.DocumentDate),this.ScreenObject.Preferences.ContainsKey("DueDateonBillDate")&&""!=this.ScreenObject.Preferences.DueDateonBillDate){var t=this.ScreenObject.Preferences.DueDateonBillDate;e.DBColumnName.toLowerCase()==t.toLowerCase()&&e.Date&&(this.ScreenObject.IsPurchase&&null!=this.ScreenObject.CreditAccount&&this.ScreenObject.CreditAccount.SelectedValue>0?this.ScreenObject.GetDueDate(this.ScreenObject.CreditAccount.SelectedValue,e.Date,this.ScreenObject.IsPurchase):!this.ScreenObject.IsPurchase&&null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.SelectedValue>0&&this.ScreenObject.GetDueDate(this.ScreenObject.DebitAccount.SelectedValue,e.Date,this.ScreenObject.IsPurchase))}if(35==this.ScreenObject.DocumentType){if("dcalpha3"==e.DBColumnName.toLowerCase()&&e.Date){var n=this.ScreenObject._TextFields.find((function(e){return"dcalpha4"==e.DBColumnName.toLowerCase()}));if(n&&n instanceof S.c&&n.Date){var a=this.ScreenObject._numericFields.find((function(e){return"dcnum30"==e.DBColumnName.toLowerCase()}));null!=a&&a instanceof h.d&&(a.Text=o.e.Round(n.Date.Subtract(e.Date).Days/30,0).toString())}}if("dcalpha4"==e.DBColumnName.toLowerCase()&&e.Date){var i=this.ScreenObject._TextFields.find((function(e){return"dcalpha3"==e.DBColumnName.toLowerCase()}));if(i&&i instanceof S.c&&i.Date){var r=this.ScreenObject._numericFields.find((function(e){return"dcnum30"==e.DBColumnName.toLowerCase()}));null!=r&&r instanceof h.d&&(r.Text=o.e.Round(e.Date.Subtract(i.Date).Days/30,0).toString())}}}92==this.ScreenObject.DocumentType?this.iDtColFrom>0&&this.iDtColUpto>0&&("dcalpha1"==e.DBColumnName.toLowerCase()&&e.Date||"dcalpha2"==e.DBColumnName.toLowerCase()&&e.Date)&&(this.DisplayMessage="Changing of Date will be effected on Line wise, Click on Fill Dates.."):72==this.DocumentType?"dcalpha2"==e.DBColumnName.toLowerCase()&&e.Date?this.ApplyVacationFrom(e):"dcalpha3"==e.DBColumnName.toLowerCase()&&e.Date&&this.ApplyVacation(e):97==this.DocumentType&&("dcalpha16"==e.DBColumnName.toLowerCase()&&e.Date&&(e.Date=new Date(e.Date.getFullYear(),e.Date.getMonth(),1),this.ScreenObject.GridData.length>0&&1!=this.dtPayMon.getFullYear()&&this.dtPayMon!=e.Date&&(this.DisplayMessage="Changing of Payroll Month will be effected on Line wise, Click on Filter to Process Lates..")),"dcalpha33"==e.DBColumnName.toLowerCase()&&e.Date&&(e.Date=new Date(e.Date.getFullYear(),e.Date.iMonth(),1))),e instanceof S.c&&e.Calculate&&(this.FillHeaderDictionary(),this.CalcTextFields())}else if(e instanceof S.b){if(this.ScreenObject.Data.Tables[0].filter((function(t){return t.CostCenterColID==e.DBColumnID&&null!=t.LocalReference&&79==t.LocalReference&&53580==t.LinkData})).length>0){var c=s.a.common.GetDataSet("DOC001","");if(null!=c&&c.Tables.length>0&&!c.Columns[0].Contains("ErrorMessage")&&c.Tables[0].length>0&&!o.e.IsEmpty(c.Tables[0][0][c.Columns[0][0]])&&null!=this.fldDict){var l=c.Columns[0][0];if(e.Date=new Date(c.Tables[0][0][l]),null!=this.fldDict)if(s.a.SessionManager.IsWebApplication){var u=new Date(c.Tables[0][0][l]);this.fldDict.ServerDate.setFieldValue(u.ToString("MMM/dd/yyyy")),this.FooterDics.ServerDate.setFieldValue(u.ToString("MMM/dd/yyyy"))}else this.fldDict.ServerDate.setFieldValue(c.Tables[0][0][l]),this.FooterDics.ServerDate.setFieldValue(c.Tables[0][0][l])}}if(86==this.ScreenObject.DocumentType){var d=null,D=null,m=null,b=this.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()}));if(b&&b instanceof S.c&&(d=b.Date),"dcalpha2"==e.DBColumnName.toLowerCase()||"dcalpha3"==e.DBColumnName.toLowerCase()){var C=this.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()}));C&&C instanceof S.b&&C.Date&&(m=C.Date),(C=this.ScreenObject._TextFields.find((function(e){return"dcalpha3"==e.DBColumnName.toLowerCase()})))&&C instanceof S.b&&C.Date&&(D=C.Date)}if(null!=D&&null!=m){var p=this.ScreenObject._TextFields.find((function(e){return"dcalpha4"==e.DBColumnName.toLowerCase()}));p&&p instanceof h.d&&(p.Text=this.CalculateTotalTimeAvailed(d,D,m))}}}e instanceof y.c&&!o.e.IsEmpty(e.KeyTip)&&"lostfocus"==e.KeyTip.toLowerCase()&&this.ValidateData(e,!0)&&this.ScreenObject.GetExternalFuncData(e.Mode,e.ToolTipFooterTitle,e.ToolTipFooterDescription,e.ToolTipDescription,null)}},{key:"LoadButtons",value:function(){var e,t="",n="",a=40,i=40;this.IsPOs&&(t+="Pay,Print,Hold,Release,Exit,Options,Return Line,Delete Line,Sales Return,Docs,",this.ScreenObject.Data.Columns[1].Contains("ActionHeight")?(i=o.e.IsEmpty(this.ScreenObject.Data.Tables[1][0].ActionHeight)?60:parseInt(this.ScreenObject.Data.Tables[1][0].ActionHeight),a=o.e.IsEmpty(this.ScreenObject.Data.Tables[1][0].ActionWidth)?62:parseInt(this.ScreenObject.Data.Tables[1][0].ActionWidth)):(a=62,i=60)),t+="LinkStatus,Lock,Generate,Adjust Down Payments,Close,Enquiries,Advance,Redeposit,Pack,Approve,Submit,Stock Posting,New,Save,Revise,Post,Delete,SaveAndPrint",this.DocumentType>50&&(t+=",Copy Leaves,Set Columns,Employee Filter,Get Previous Day,All Employees,Guarantees,Distribute,Fill Dates,Fill General Timings"),n="Print,PrintPreview,Suspend,ContinuousPrint,SaveAndBarcode,BarcodePrint,Export,Email,SMS,Draft,Copy,Clone,Import,Sort,Recur,Show JV,Generate Cheques,Pre Payments,Location,Notes,Attachments,Contacts,ReEvaluate,ReEvaluatePriceChart,ReEvaluateTaxChart,Activities,Customize,Search,Report,Documents,History,Bounce,Load Drafts,Hold,Release,CashDrawer,Payment Terms,Convert,DocumentHistory,Revise History,PriceChart,Map,Post Billwise,Help,LinkInfo,TabsPopUp,AssignVPT,Assign",this.ScreenObject.Preferences.ContainsKey("RightButtons")&&!o.e.IsEmpty(this.ScreenObject.Preferences.RightButtons)&&(n=this.ScreenObject.Preferences.RightButtons.toString()),this.ScreenObject.Preferences.ContainsKey("LeftButtons")&&!o.e.IsEmpty(this.ScreenObject.Preferences.LeftButtons)&&(t=this.ScreenObject.Preferences.LeftButtons.toString()),this.DocumentType<=50&&this.ScreenObject.Preferences.ContainsKey("Distributebasedon")&&!o.e.IsEmpty(this.ScreenObject.Preferences.Distributebasedon)&&(t+=",Distribute"),s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Innoviti")&&(t="Innoviti,"+t),89!=this.DocumentType&&90!=this.DocumentType||(t+=",Check-in,Check-out",a=45),85==this.ScreenObject.DocumentType&&s.a.SessionManager.Preferences.ContainsKey("ConsiderGradeWiseSalarySlabs")&&"True"==s.a.SessionManager.Preferences.ConsiderGradeWiseSalarySlabs&&(t+=",Pick Min.,Pick Max.",a=45),61==this.DocumentType&&(t+=",Define Days",a=45),67==this.DocumentType&&(t+=",Validate",a=45),92==this.DocumentType&&(t+=",Rotation",a=45),99==this.DocumentType&&(t+=",Load",a=45),s.a.SessionManager.IsActionAssigned(this.CostCenterID,"GST")&&(t="GST,"+t),s.a.SessionManager.IsActionAssigned(this.CostCenterID,"API")&&(t="API,"+t),n.Contains(",EInv")||(n+=",EInv"),s.a.IsMobile&&(null===(e=this.ScreenObject.Link)||void 0===e?void 0:e.Visible)&&(t+=",DocLink"),s.a.IsMobile&&this.AssignAddress&&(t+=",Addresses"),this.ButtonsLeft.Clear(),this.ButtonsPopup.Clear(),","==t[t.length-1]&&(t=t.Remove(t.length-2,2));for(var r=s.a.IsMobile?["Customize","Documents"]:["Customize","Report","Documents"],c=t.split(","),l=0;l<c.length;l++)r.Contains(c[l])||(this.ButtonsLeft.filter((function(e){return e.Visible})).length>=7&&s.a.IsMobile?this.AddButton(c[l],this.ButtonsPopup,"POSDocumentViewModel"==this.ClassName&&"Pay"==c[l]?3*a+8:a,i):this.AddButton(c[l],this.ButtonsLeft,"POSDocumentViewModel"==this.ClassName&&"Pay"==c[l]?3*a+8:a,i));c=n.split(",");for(var u=0;u<c.length;u++)r.Contains(c[u])||this.AddButton(c[u],this.ButtonsPopup,40,40);s.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Create"):this.ButtonSave.Enable=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Create"),s.a.SessionManager.HideUnathorizedAccess?this.ButtonDelete.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"):this.ButtonDelete.Enable=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),s.a.SessionManager.HideUnathorizedAccess?this.ButtonSuspendDoc.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Suspend"):this.ButtonSuspendDoc.Enable=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Suspend"),s.a.SessionManager.HideUnathorizedAccess?this.ButtonSaveandPrint.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save&Print"):this.ButtonSaveandPrint.Enable=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save&Print"),this.HideButtons("Save&Barcode"),this.HideButtons("BarcodePrint"),this.ButtonRevise.Visible=!1,this.ButtonApprove.Visible=!1;var d=this.GetButton("Generate Cheques");null==d&&(d=this.GetButton("Pre Payments")),null!=d&&(this.pdcGCVM=new he.a(this))}},{key:"AddButton",value:function(e,t,n,a){var i=new D.a;switch(i.DBColumnName=e,e){case"":return;case"Assign":if(!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"AssignUsers"))return;i.ImgData="btn_assign",i.Icon="fa-light fa-user-plus",i.Label=s.a.GetResource("Assign"),i.ComParam="Assign";break;case"Pick Min.":i.ImgData="btn_PickMin",i.Icon="fa-light fa-layer-minus",i.Label=s.a.GetResource("PickMin"),i.ComParam="PickMin";break;case"EInv":i.ImgData="btn_EInv",i.Icon="fa-light fa-time-circle",i.Label=s.a.GetResource("EInv"),i.ComParam="EInv",i.Visible=!0;break;case"Close":if(!(this.ScreenObject.Preferences.ContainsKey("UseAsLC")&&""!=this.ScreenObject.Preferences.UseAsLC&&Object(l.j)(this.ScreenObject.Preferences.UseAsLC)||this.ScreenObject.Preferences.ContainsKey("UseAsTR")&&""!=this.ScreenObject.Preferences.UseAsTR&&Object(l.j)(this.ScreenObject.Preferences.UseAsTR)))return;i.ImgData="btn_Close",i.Icon="fa-light fa-time-circle",i.Label=s.a.GetResource("Close"),i.ComParam="Close";break;case"next":i.ImgData="btn_PickMax",i.Icon="far fa-angle-right",i.Label=s.a.GetResource("next"),i.ComParam="next";break;case"prev":i.ImgData="far fa-angle-left",i.Label=s.a.GetResource("prev"),i.ComParam="prev";break;case"Pick Max.":i.ImgData="btn_PickMax",i.Icon="fa-light fa-layer-plus",i.Label=s.a.GetResource("PickMax"),i.ComParam="PickMax";break;case"Check-in":i.ImgData="btn_Check-in",i.Label=s.a.GetResource("Check_In"),i.ComParam="Check-in";break;case"Load":i.ImgData="btn_Load",i.Icon="fa-light fa-circle-notch fa-spin",i.Label=s.a.GetResource("Load"),i.ComParam="Load";break;case"Check-out":i.ImgData="btn_Check-out",i.Label=s.a.GetResource("Check_Out"),i.ComParam="Check-out";break;case"Rotation":i.ImgData="btn_Rotation",i.Icon="fa-light fa-arrows-rotate",i.Label=s.a.GetResource("Rotation"),i.ComParam="Rotation";break;case"Validate":i.ImgData="btn_Validate",i.Icon="fa-light fa-arrows-rotate",i.Label=s.a.GetResource("Validate"),i.ComParam="Validate";break;case"Innoviti":i.ImgData="btn_Innoviti",i.Icon="fa-light fa-credit-card",i.Label=s.a.GetResource("CardPay"),i.ComParam="Innoviti";break;case"LinkStatus":this.ButtonSuspend=i,i.DBColumnName=e,i.ImgData="btn_linkStatus",i.Icon="far fa-link",i.Label=s.a.GetResource("LinkStatus"),i.ComParam="SuspendVisiblity";break;case"Lock":if(!s.a.SessionManager.Preferences.ContainsKey("LockEditMode")||!Object(l.j)(s.a.SessionManager.Preferences.LockEditMode))return;i.ImgData="btn_Lock",i.Icon="fa-light fa-lock",i.Label=s.a.GetResource("Lock"),i.ComParam="Lock",i.Visible=!1;break;case"Generate":if(!this.IsInventoryVoucher||this.IsPOs||this.ScreenObject.Preferences.ContainsKey("DisableGenerate")&&"True"==this.ScreenObject.Preferences.DisableGenerate||this.ScreenObject.Data.Tables.length>20&&0==this.ScreenObject.Data.Tables[20].filter((function(e){return e.CostCenterIDBase>4e4})).length)return;i.ImgData="btn_GenerateLink",i.Icon="fa-light fa-link",i.Label=s.a.GetResource("GenerateLink"),i.ComParam="GenerateLink",i.Visible=!1;break;case"New":i.ImgData="btn_new",i.Icon="fa-light fa-file",i.Label=s.a.GetResource("New"),this.IsPOs&&(i.Label=i.Label+" F2"),i.ComParam="New";break;case"Revise":this.ButtonRevise=i,i.DBColumnName=e,i.ImgData="btn_revise",i.Icon="fa-light fa-book-open",i.Label=s.a.GetResource("Revise"),i.ComParam="Revise";break;case"GST":if(!this.IsInventoryVoucher)return;i.ImgData="btn_gst",i.Icon="fa-light fa-money-bill",i.Label=s.a.GetResource("GST"),i.ComParam="GST",i.Visible=!1;break;case"API":i.ImgData="btn_API",i.Icon="fa-light fa-time-circle",i.Label=s.a.GetResource("API"),i.ComParam="API",i.Visible=!1;break;case"Post":this.ButtonSave=i,i.DBColumnName=e,i.ImgData="btn_post",i.Icon="fa-light fa-floppy-disk-circle-arrow-right",i.Label=s.a.GetResource("Post"),i.ComParam="Save";break;case"Save":if(!this.ScreenObject.Preferences.ContainsKey("enebleSaveonhold")||"True"!=this.ScreenObject.Preferences.enebleSaveonhold)return;i.ImgData="btn_saveonhold",i.Icon="fa-light fa-save",i.Label=s.a.GetResource("Save"),i.ComParam="SaveonHold";break;case"Delete":this.ButtonDelete=i,i.DBColumnName=e,i.ImgData="btn_delete",i.Icon="fa-light fa-trash-alt",i.Label=s.a.GetResource("Delete"),i.ComParam="Delete";break;case"SaveAndPrint":this.ButtonSaveandPrint=i,i.DBColumnName=e,i.ImgData="btn_saveprint",i.Icon="fas fa-print",i.Label=s.a.GetResource("SaveAndPrint"),i.ComParam="SaveAndPrint";break;case"Adjust Down Payments":if(!this.ScreenObject.Preferences.ContainsKey("AllowAdjToDownPmt")||"True"!=this.ScreenObject.Preferences.AllowAdjToDownPmt.toString())return;i.ImgData="btn_adjustdownpayments",i.Icon="fa-light fa-money-bill",i.Label=s.a.GetResource("AdjustDownPay"),i.ComParam="AdjustDownPay";break;case"Enquiries":if(25!=this.ScreenObject.DocumentType)return;i.ImgData="btn_enquiries",i.Icon="fa-light fa-megaphone",i.Label=s.a.GetResource("Doc_Enquiries"),i.ComParam="Enquiries";break;case"Advance":if(!(this.ScreenObject.Preferences.ContainsKey("DonotupdateAccounts")&&""!=this.ScreenObject.Preferences.DonotupdateAccounts&&Object(l.j)(this.ScreenObject.Preferences.DonotupdateAccounts)&&this.ScreenObject.Preferences.ContainsKey("AllowAdvRct")&&""!=this.ScreenObject.Preferences.AllowAdvRct&&Object(l.j)(this.ScreenObject.Preferences.AllowAdvRct)&&this.ScreenObject.Preferences.ContainsKey("PostVoucherDocument")&&""!=this.ScreenObject.Preferences.PostVoucherDocument&&o.e.IsNum(this.ScreenObject.Preferences.PostVoucherDocument)&&parseInt(this.ScreenObject.Preferences.PostVoucherDocument)>4e4))return;i.ImgData="btn_advance",i.Icon="fa-light fa-ad",i.Label=s.a.GetResource("Advance"),i.ComParam="Advance";break;case"Redeposit":if(14!=this.DocumentType&&19!=this.DocumentType&&18!=this.ScreenObject.DocumentType&&15!=this.ScreenObject.DocumentType)return;i.ImgData="btn_redeposit",i.Icon="fa-light fa-step-backward",i.Label=s.a.GetResource("Redeposit"),i.ComParam="Redeposit",i.Visible=!1;break;case"Pack":if(!this.ScreenObject.Preferences.ContainsKey("EnablePacking")||"True"!=this.ScreenObject.Preferences.EnablePacking)return;i.ImgData="btn_pack",i.Icon="fa-light fa-archive",i.Label=s.a.GetResource("Pack"),i.ComParam="Pack";break;case"Approve":this.ButtonApprove=i,i.DBColumnName=e,i.ImgData="btn_approve",i.Icon="fa-light fa-user",i.Label=s.a.GetResource("btnApprove"),i.ComParam="ApproveVisiblity",i.Visible=!1;break;case"Submit":i.ImgData="btn_submit",i.Icon="fa-light fa-check-circle",i.Label=s.a.GetResource("Submit"),i.ComParam="NoWorkFlow",i.Visible=!1;break;case"Stock Posting":if(31!=this.ScreenObject.DocumentType)return;i.ImgData="btn_stockposting",i.Icon="fa-light fa-box-check",i.Label=s.a.GetResource("StockPosting"),i.ComParam="PostStock";break;case"Copy Leaves":if(81!=this.ScreenObject.DocumentType)return;i.ImgData="btn_copyleaves",i.Icon="far fa-copy",i.Label=s.a.GetResource("CopyLeaves"),i.ComParam="ALCopy";break;case"Set Columns":if(67!=this.ScreenObject.DocumentType)return;i.ImgData="btn_setcolumns",i.Icon="fa-light fa-columns",i.Label=s.a.GetResource("SetColumns"),i.ComParam="DATCustomize";break;case"Employee Filter":if(67!=this.ScreenObject.DocumentType&&97!=this.ScreenObject.DocumentType)return;i.ImgData="btn_employeefilter",i.Icon="fa-light fa-filter",i.Label=s.a.GetResource("Filter"),i.ComParam="DailyAttendanceFilter";break;case"Get Previous Day":if(67!=this.ScreenObject.DocumentType)return;i.ImgData="btn_getpreviousday",i.Icon="fa-light fa-calendar-minus",i.Label=s.a.GetResource("PreviousDay"),i.ComParam="GetPreviousDay";break;case"All Employees":if(67!=this.ScreenObject.DocumentType)return;i.ImgData="btn_allemployee",i.Icon="fa-light fa-users-class",i.Label="All Employees",i.ComParam="GetAllEmployees";break;case"Fill Dates":if(67!=this.ScreenObject.DocumentType&&92!=this.ScreenObject.DocumentType)return;i.ImgData="btn_filldates",i.Icon="fa-light fa-calendar-day",i.Label=s.a.GetResource("FillDates"),i.ComParam="FillDates";break;case"Fill General Timings":if(67!=this.ScreenObject.DocumentType)return;i.ImgData="btn_fillgeneraltimings",i.Icon="fa-light fa-clock",i.Label=s.a.GetResource("FillGeneralTimings"),i.ComParam="FillGeneralTimings";break;case"Define Days":if(61!=this.ScreenObject.DocumentType)return;i.ImgData="btn_DefineDays",i.Label=s.a.GetResource("DefineDays"),i.ComParam="DefineDays";break;case"Guarantees":if(56!=this.ScreenObject.DocumentType||!s.a.SessionManager.Preferences.ContainsKey("IsLoanGuaranteeMandatory")||"True"!=s.a.SessionManager.Preferences.IsLoanGuaranteeMandatory)return;this.LoanGuaranteeVisible=!0,i.ImgData="btn_guarantees",i.Label=s.a.GetResource("Guarantees"),i.ComParam="LoanGuarantees";break;case"Distribute":if(this.ScreenObject.DocumentType>50&&56!=this.ScreenObject.DocumentType)return;i.ImgData="btn_distribute",i.Icon="fa-project-diagram fa-light",i.Label=s.a.GetResource("Distribute"),i.ComParam="DistributeInstallments";break;case"Pay":if(!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Create")&&!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"))return;i.ImgData="btn_pay",i.Icon="fa-light fa-check",i.Label="Pay F7",i.ComParam="Pay";break;case"Print":if(!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Print"))return;i.ImgData="btn_print",i.Icon="fa-light fa-print",i.Label=s.a.GetResource("Print"),this.IsPOs&&(i.Label=i.Label+" F4"),i.ComParam="Print";break;case"Hold":if(this.IsPOs&&!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Hold")||s.a.SessionManager.LicenseSettings.ContainsKey("Hold_Release")&&"FALSE"==s.a.SessionManager.LicenseSettings.Hold_Release.toUpperCase())return;if(!this.IsPOs&&!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"HoldDoc"))return;i.ImgData="btn_hold",i.Icon="fa-light fa-box",i.Label=s.a.GetResource("Hold")+" F8",i.ComParam="Hold";break;case"Release":if(this.IsPOs&&!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Release")||s.a.SessionManager.LicenseSettings.ContainsKey("Hold_Release")&&"FALSE"==s.a.SessionManager.LicenseSettings.Hold_Release.toUpperCase())return;i.ImgData="btn_release",i.Icon="fa-light fa-box-open",i.Label=s.a.GetResource("Com_Release")+" F6",i.ComParam="Release";break;case"Exit":if(!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Exit"))return;i.ImgData="btn_exit",i.Icon="fa-light fa-share",i.Label="Exit",i.ComParam="Exit";break;case"Options":if(!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Options"))return;i.ImgData="btn_options",i.Icon="fa-light fa-money-check",i.Label=s.a.GetResource("Com_Options"),i.ComParam="Options";break;case"PrintPreview":if(!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Print"))return;i.ImgData="btn_printpreview",i.Icon="fa-light fa-eye",i.Label=s.a.GetResource("VPDesigner_PrintPreview"),i.ComParam="PrintPreview";break;case"Suspend":this.ButtonSuspendDoc=i,i.DBColumnName=e,i.ImgData="btn_suspend",i.Icon="fa-light fa-ban",i.Label=s.a.GetResource("Suspend"),i.ComParam="Suspend";break;case"ContinuousPrint":if(!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"ContinuousPrint"))return;i.ImgData="btn_ContinuousPrint",i.Icon="fa-light fa-shredder",i.Label=s.a.GetResource("Doc_ContinuousPrinting"),i.ComParam="ContinuousPrint";break;case"SaveAndBarcode":this.ButtonSaveandBarcode=i,i.DBColumnName=e,i.ImgData="btn_SaveAndBarcode",i.Icon="fa-light fa-barcode-alt",i.Label=s.a.GetResource("SaveAndBarcode"),i.ComParam="SaveAndBarcode";break;case"BarcodePrint":this.ButtonBarcode=i,i.DBColumnName=e,i.ImgData="btn_barcodeprint",i.Icon="fa-light fa-barcode",i.Label=s.a.GetResource("Barcode"),i.ComParam="BarcodePrint";break;case"Export":if(!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Export"))return;i.ImgData="btn_export",i.Icon="fa-light fa-file-export",i.Label=s.a.GetResource("Export"),i.ComParam="Export";break;case"Email":if(!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Email"))return;i.ImgData="btn_email",i.Icon="fa-light fa-envelope ",i.Label=s.a.GetResource("SMTP_Email"),i.ComParam="Email";break;case"SMS":if(!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"SMS"))return;i.ImgData="btn_sms",i.Icon="fa-light fa-message-dots",i.Label=s.a.GetResource("SMTP_SMS"),i.ComParam="SMS";break;case"Draft":if(!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Draft"))return;i.ImgData="btn_saveasDraft",i.Icon="fa-light fa-clipboard",i.Label=s.a.GetResource("Com_SaveAsDraft"),i.ComParam="SaveDraft";break;case"Copy":if(!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Copy"))return;i.ImgData="btn_copy",i.Icon="fa-light fa-copy",i.Label=s.a.GetResource("Copy"),i.ComParam="Copy";break;case"Clone":if(!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Duplicate"))return;i.ImgData="btn_clone",i.Icon="fa-light fa-clone",i.Label=s.a.GetResource("Clone"),i.ComParam="Duplicate";break;case"Import":if(!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Import")||s.a.SessionManager.LicenseSettings.ContainsKey("Import")&&"FALSE"==s.a.SessionManager.LicenseSettings.Import.toUpperCase())return;i.ImgData="btn_import",i.Icon="fa-light fa-file-import",i.Label=s.a.GetResource("Import_Data"),i.ComParam="ImportVisiblity";break;case"Sort":if(!s.a.SessionManager.IsActionAssigned(43,"Sort Body"))return;i.ImgData="btn_sort",i.Icon="fa-light fa-sort",i.Label=s.a.GetResource("Reports_Sort"),i.ComParam="SortVisiblity";break;case"Recur":if(!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Recur"))return;i.ImgData="btn_Recur",i.Icon="fa-light fa-repeat-alt",i.Label=s.a.GetResource("Recur"),i.ComParam="Recur";break;case"Show JV":if(this.ScreenObject.Preferences.ContainsKey("DonotupdateAccounts")&&""!=this.ScreenObject.Preferences.DonotupdateAccounts&&Object(l.j)(this.ScreenObject.Preferences.DonotupdateAccounts)||30==this.DocumentType)return;if(!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"JV"))return;i.ImgData="btn_showjv",i.Icon="fa-light fa-book",i.Label=s.a.GetResource("ShowJV"),i.ComParam="ShowJV";break;case"Generate Cheques":if(!this.ScreenObject.Preferences.ContainsKey("LineWisePDC")||"True"!=this.ScreenObject.Preferences.LineWisePDC)return;i.ImgData="btn_generatecheques",i.Label=s.a.GetResource("Generate_Cheques"),i.ComParam="Cheque";break;case"Pre Payments":if(this.IsInventoryVoucher||!(this.ScreenObject.Preferences.ContainsKey("PrepaymentDoc")&&!o.e.IsEmpty(this.ScreenObject.Preferences.PrepaymentDoc)&&parseInt(this.ScreenObject.Preferences.PrepaymentDoc)>4e4))return;i.ImgData="btn_prepayments",i.Icon="fa-light fa-money-bill-wave-alt",i.Label=s.a.GetResource("PrePayments"),i.ComParam="Cheque";break;case"Location":if(!this.ScreenObject.Preferences.ContainsKey("LocationVisibility")||"True"!=this.ScreenObject.Preferences.LocationVisibility)return;i.ImgData="btn_changeloc",i.Icon="fa-light fa-map-marker",i.Label=s.a.GetResource("DocChangeLocation"),i.ComParam="ChangeLocation";break;case"Notes":if(!this.ScreenObject.Preferences.ContainsKey("Notes")||"True"!=this.ScreenObject.Preferences.Notes||!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Notes"))return;i.ImgData="btn_note",i.Icon="fa-light fa-sticky-note",i.Label=s.a.GetResource("Notes"),i.ComParam="Notes";break;case"Attachments":if(!this.ScreenObject.Preferences.ContainsKey("Attachments")||"True"!=this.ScreenObject.Preferences.Attachments||!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Attach"))return;i.ImgData="btn_attachment",i.Icon="fa-light fa-paperclip",i.Label=s.a.GetResource("Attachments"),i.ComParam="Attachment";break;case"Contacts":if(!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Contacts"))return;i.ImgData="btn_Contacts",i.Label=s.a.GetResource("Com_Contacts"),i.ComParam="Contacts";break;case"ReEvaluate":if(!this.IsInventoryVoucher||!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"ReEvaluate"))return;i.ImgData="btn_reevaluate",i.Icon="fa-light fa-calculator",i.Label=s.a.GetResource("ReEvaluate"),i.ComParam="ReEvaluate";break;case"ReEvaluatePriceChart":if(!this.IsInventoryVoucher||!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"ReEvaluatePriceChart"))return;i.ImgData="btn_reevaluate",i.Icon="fa-light fa-calculator",i.Label=s.a.GetResource("ReEvaluatePriceChart"),i.ComParam="ReEvaluatePrice";break;case"ReEvaluateTaxChart":if(!this.IsInventoryVoucher||!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"ReEvaluateTaxChart"))return;i.ImgData="btn_reevaluate",i.Icon="fa-light fa-calculator",i.Label=s.a.GetResource("ReEvaluateTaxChart"),i.ComParam="ReEvaluateTax";break;case"Activities":if(!this.ScreenObject.Preferences.ContainsKey("Activities")||"True"!=this.ScreenObject.Preferences.Activities)return;i.ImgData="btn_activity",i.Icon="fa-light fa-calendar-alt",i.Label=s.a.GetResource("Activities"),i.ComParam="Activities";break;case"Customize":if(!s.a.SessionManager.IsFeatureAssigned(43)||!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Customize"))return;i.ImgData="btn_customize",i.Label=s.a.GetResource("Customize"),i.ComParam="Customize";break;case"Search":i.ImgData="btn_search",i.Icon="fa-light fa-search",i.Label=s.a.GetResource("btnSearch"),i.ComParam="Search";break;case"Report":i.ImgData="btn_Report",i.Icon="fa-light fa-file-chart-line",i.Label=s.a.GetResource("Report"),i.ComParam="Report";break;case"Documents":i.ImgData="btn_Report",i.Icon="fa-light fa-book",i.Label=s.a.GetResource("Documents"),i.ComParam="Documents";break;case"DocLink":i.Icon="fa-light fa-project-diagram",i.Label=s.a.GetResource("Doc_link"),i.ComParam="DocLink";break;case"Addresses":i.Icon="fa-light fa-book",i.Label="Address",i.ComParam="Addresses";break;case"Bounce":if(18!=this.ScreenObject.DocumentType&&15!=this.ScreenObject.DocumentType)return;i.ImgData="btn_bounce",i.Icon="fa-light fa-money-check",i.Label=s.a.GetResource("DocumentDesigner_Bounce"),i.ComParam="Bounce";break;case"History":i.ImgData="btn_history",i.Icon="fa-light fa-history",i.Label=s.a.GetResource("History"),i.ComParam="ViewHistory",i.Visible=!1;break;case"Load Drafts":if(!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Draft"))return;i.ImgData="btn_loaddrafts",i.Icon="fa-light fa-file-upload",i.Label=s.a.GetResource("Com_LoadDraft"),i.ComParam="LoadDraft";break;case"CashDrawer":if(!this.ScreenObject.Preferences.ContainsKey("Select Port")||"True"!=this.ScreenObject.Preferences["Select Port"])return;i.ImgData="btn_cashdrawer",i.Label=s.a.GetResource("Com_CashDrawer"),i.ComParam="CashDrawer";break;case"Payment Terms":if(!(this.ScreenObject.Preferences.ContainsKey("Enable Payment Terms")&&""!=this.ScreenObject.Preferences["Enable Payment Terms"]&&Object(l.j)(this.ScreenObject.Preferences["Enable Payment Terms"])||this.ScreenObject.Preferences.ContainsKey("CopyPaymentTerms")&&""!=this.ScreenObject.Preferences.CopyPaymentTerms&&Object(l.j)(this.ScreenObject.Preferences.CopyPaymentTerms)))return;i.ImgData="btn_paymentTerms",i.Icon="fa-light fa-list",i.Label=s.a.GetResource("ViewPaymentTerms"),i.ComParam="ViewPaymentTerms";break;case"Convert":if(!(this.ScreenObject.Data.Tables.length>20&&this.ScreenObject.Data.Columns[20].Contains("DocumentLinkDefID")&&this.ScreenObject.Data.Tables[20].filter((function(e){return 2==e.Mode&&73==e.CostCenterIDBase})).length>0))return;i.ImgData="btn_convert",i.Label=s.a.GetResource("Convert"),i.ComParam="Convert",i.Visible=!1;break;case"DocumentHistory":if(!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"DocumentHistory"))return;i.ImgData="btn_dochistory",i.Icon="fa-light fa-file-medical-alt",i.Label=s.a.GetResource("Doc_History"),i.ComParam="DocumentHistory";break;case"Revise History":if(!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"ReviseHistory")||!this.ScreenObject.Preferences.ContainsKey("EnableRevision")||""==this.ScreenObject.Preferences.EnableRevision||!Object(l.j)(this.ScreenObject.Preferences.EnableRevision))return;i.ImgData="btn_revhistory",i.Icon="fa-light fa-history",i.Label=s.a.GetResource("Revise_History"),i.ComParam="ReviseHistory";break;case"PriceChart":if(!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"PriceChart")&&s.a.SessionManager.LicenseSettings.ContainsKey("PriceChartFromDocument")&&"FALSE"==s.a.SessionManager.LicenseSettings.PriceChartFromDocument.toUpperCase())return;i.ImgData="btn_pricechart",i.Icon="fa-light fa-chart-line",i.Label=s.a.GetResource("PriceChart"),i.ComParam="PriceChart";break;case"Map":i.ImgData="btn_map",i.Icon="fa-light fa-project-diagram",i.Label=s.a.GetResource("Map"),i.ComParam="LINKMAP";break;case"Post Billwise":if(!this.IsInventoryVoucher||!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Post Billwise"))return;i.ImgData="btn_postbillwise",i.Icon="fa-light fa-list-alt",i.Label=s.a.GetResource("PostBillwise"),i.ComParam="PostBills";break;case"Help":if(o.e.IsEmpty(this.HelpDoc))return;i.ImgData="btn_help",i.Label=s.a.GetResource("Help"),i.ComParam="HelpDoc";break;case"LinkInfo":if(!this.IsInventoryVoucher||null==this.ScreenObject.Link)return;if(!this.ScreenObject.Preferences.ContainsKey("LinkPopup")||"True"!=this.ScreenObject.Preferences.LinkPopup)return;this.ScreenObject.Link.Visible=!1,i.ImgData="LinkInfo",i.Label=s.a.GetResource("Doc_link"),i.ComParam="LinkInfo";break;case"TabsPopUp":if(this.ScreenObject.Preferences.ContainsKey("TabsPopup")&&"2"==this.ScreenObject.Preferences.TabsPopup)return void(this.TabBtnVisible=!0);if(!this.ScreenObject.Preferences.ContainsKey("TabsPopup")||"1"!=this.ScreenObject.Preferences.TabsPopup||!this.ScreenObject.CustomTab.Visible)return;this.ScreenObject.CustomTab.Visible=!1,i.ImgData="TabsPopUp",i.Icon="fa-light fa-info-square",i.Label=s.a.GetResource("ExtraInfo"),i.ComParam="TabsPopUp";break;case"AssignVPT":if(!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"AssignVPT"))return;i.ImgData="btn_AssignVPT",i.Icon="fa-light fa-user-plus",i.Label=s.a.GetResource("AssignVPT"),i.ComParam="AssignVPT";break;case"Change Qty":i.ImgData="btn_AssignVPT",i.Label="Change Qty",i.ComParam="ChangeQty";break;case"Change Rate":i.ImgData="btn_AssignVPT",i.Label="Change Rate",i.ComParam="ChangeRate";break;case"Change Unit":i.ImgData="btn_AssignVPT",i.Label="Change Unit",i.ComParam="ChangeUnit";break;case"Return Line":i.ImgData="btn_AssignVPT",i.Label=s.a.GetResource("ReturnLine"),i.Icon="fa-light fa-user-plus",i.ComParam="ReturnLine";break;case"Delete Line":i.ImgData="btn_AssignVPT",i.Label="Delete Line",i.Icon="fa-light fa-layer-minus",i.ComParam="DeleteLine";break;case"Sales Return":i.ImgData="btn_AssignVPT",i.Label=s.a.GetResource("SalesReturn"),i.Icon="fa-light fa-file-chart-line",i.ComParam="SalesReturn";break;case"Docs":i.ImgData="btn_Report",i.Icon="fa-light fa-folder ",i.Label=s.a.GetResource("Docs"),i.ComParam="Docs"}i.Width=n.toString(),i.SectionID=a.toString(),t.push(i),"Submit"==e&&((i=new D.a).DBColumnName="Submitprint",i.ImgData="M17.099383,21.729994 L17.099383,24.035563 22.019618,24.035563 22.019618,21.729994 z M15.763892,20.31729 L15.763892,22.26473 C15.763892,22.341222 15.827995,22.40534 15.90447,22.40534 L16.537071,22.40534 16.537071,21.167554 22.58193,21.167554 22.58193,22.40534 23.214533,22.40534 C23.291007,22.40534 23.35511,22.341222 23.35511,22.26473 L23.35511,20.31729 z M20.690592,16.192655 L20.690592,17.39824 21.915168,17.39824 z M17.099383,16.17044 L17.099383,19.019888 22.019618,19.019888 22.019618,17.820068 20.268858,17.820068 20.268858,16.17044 z M16.537071,15.608 L20.697621,15.608 22.58193,17.462922 22.58193,17.819929 C22.835533,17.874203 23.02714,18.100584 23.02714,18.369571 L23.02714,19.019888 23.214533,19.019888 C23.678579,19.019888 24.058001,19.314042 24.058001,19.673298 L24.058001,22.26473 C24.058001,22.729022 23.678579,23.108386 23.214533,23.108386 L22.58193,23.108386 22.58193,24.598001 16.537071,24.598001 16.537071,23.108386 15.90447,23.108386 C15.440421,23.108386 15.061,22.729022 15.061001,22.26473 L15.061001,19.673298 C15.061,19.314042 15.440421,19.019888 15.90447,19.019888 L16.091861,19.019888 16.091861,18.369571 C16.091861,18.100584 16.283468,17.874203 16.537071,17.819929 z M9.4247408,7.9182401 L18.343435,7.9182401 C18.343435,7.9182401 22.433113,11.712019 22.433113,11.712018 L22.433113,14.734 20.624731,14.734 20.624731,12.643335 C20.624731,12.643335 17.642112,9.8768835 17.642113,9.8768835 L11.137668,9.8768835 C10.995637,9.8768835 10.880497,9.9810638 10.880497,10.109576 L10.880497,20.192904 C10.880497,20.321415 10.995637,20.425596 11.137668,20.425596 L13.847999,20.425596 13.847999,22.384239 9.4247408,22.384239 C9.229991,22.384239 9.0721149,22.241371 9.0721149,22.065136 L9.0721149,8.2373428 C9.0721149,8.0611076 9.229991,7.9182401 9.4247408,7.9182401 z M15,1.875 C7.7512627,1.875 1.875,7.7512622 1.875,15 1.875,22.248737 7.7512627,28.125 15,28.125 22.248737,28.125 28.125,22.248737 28.125,15 28.125,7.7512622 22.248737,1.875 15,1.875 z M15,0 C23.284269,0 30,6.7157288 30,15 30,23.284271 23.284269,30 15,30 6.7157297,30 0,23.284271 0,15 0,6.7157288 6.7157297,0 15,0 z",i.Label=s.a.GetResource("Submit_print"),i.ComParam="NoWorkFlowprint",i.Visible=!1,i.Width=n.toString(),i.SectionID=a.toString(),t.push(i))}},{key:"GetButton",value:function(e){var t=this.ButtonsLeft.find((function(t){return t.DBColumnName==e}));return null==t&&(t=this.ButtonsPopup.find((function(t){return t.DBColumnName==e}))),t}},{key:"GetButtonVisibility",value:function(e){var t=this.ButtonsLeft.find((function(t){return t.DBColumnName==e}));return null==t&&(t=this.ButtonsPopup.find((function(t){return t.DBColumnName==e}))),null!=t&&t.Visible&&t.Enable}},{key:"CheckRightTab",value:function(e){var t=this.ButtonsLeft.find((function(t){return t.DBColumnName==e}));null!=t?this.ButtonsLeft.Remove(t):null!=(t=this.ButtonsPopup.find((function(t){return t.DBColumnName==e})))?this.ButtonsPopup.Remove(t):(t=new D.a).Visible=!1}},{key:"SetButtonVisibility",value:function(e,t){var n=this.ButtonsLeft.find((function(t){return t.ComParam.toUpperCase()==e.toUpperCase()}));null!=n?n.Visible=t:null!=(n=this.ButtonsPopup.find((function(t){return t.ComParam.toUpperCase()==e.toUpperCase()})))&&(n.Visible=t)}},{key:"worker_DoWork",value:function(e){var t=this;if(Logger.InfoLog("AddEditDocumentViewModel::Entering worker_DoWork"),this.DisplayName=s.a.GetResource("Loading"),this.ScreenObject.LoadScreen(this,this.POSRegisterID),!this.ScreenObject.IsAccessDenied){if(65==this.ScreenObject.DocumentType){var n;n=this.FilterLeaveTypes(2);var a=this.ScreenObject._CCFields.find((function(e){return"dcccnid52"==e.DBColumnName.toLowerCase()}));if(a&&a instanceof C.b){a.CustomWhere=n;var i=s.a.common.GetDataSet("PAY043","").Tables[0];null!=i&&i.length>0&&(a.DefaultValue=i[0].ComponentID.toString(),a.SelectedValue=parseInt(i[0].ComponentID))}}if(94==this.ScreenObject.DocumentType){var r;r=this.FilterLeaveTypes(3);var c=this.ScreenObject._CCFields.find((function(e){return"dcccnid52"==e.DBColumnName.toLowerCase()}));c&&c instanceof C.b&&(c.CustomWhere=r),this.ScreenObject.GridDataObj.Clear()}if(this.IsNewAssignLeave&&(this.dtALeaveComp=s.a.common.GetDataTable("DOC069",""),null!=this.dtALeaveComp&&this.dtALeaveComp.length>0&&this.FillComponent(this.dtALeaveComp)),this.ScreenObject.IsPayrollDocument&&s.a.SessionManager.IsEmpUser){var u=null,d=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));if(d&&d instanceof C.b){if(s.a.SessionManager.lstEmpFilteredEmpSeqNos.Contains(s.a.SessionManager.iEmployee)){d.DefaultValue=s.a.SessionManager.iEmployee.toString(),d.SelectedValue=s.a.SessionManager.iEmployee,this.ScreenObject.OnGetReference(d);var D={ReferenceTable:null,ReferenceEditTable:null,DBColumnName:"Dimension",ccid:0,dr:u};this.ReferenceCallBack(D),u=D.dr}}else if(d&&d instanceof p.a&&s.a.SessionManager.lstEmpFilteredEmpSeqNos.Contains(s.a.SessionManager.iEmployee)){d.DefaultValue=s.a.SessionManager.iEmployee.toString(),d.SelectedValue=s.a.SessionManager.iEmployee,this.ScreenObject.OnGetReference(d.Name);var I={ReferenceTable:null,ReferenceEditTable:null,DBColumnName:"Dimension",ccid:0,dr:u};this.ReferenceCallBack(I),u=I.dr}}if(this.IsPOs&&0==this.ScreenObject.Data.Tables[1].length)return this.DisplayMessage="NO Register Assigned",this.DialogResult=!0,void(this.OKCancelVisibility=!0);if(this.IsPOs&&""==this.ScreenObject.CCguid)return this.DisplayMessage="Define Register in document prefix",this.DialogResult=!0,void(this.OKCancelVisibility=!0);if(this.IsPOs&&(this.POSPayModes=new Wt.POSPayModesViewModel(this)),this.ScreenObject.GridDataColumns.Contains("FieldType")){if(0==this.ScreenObject.Data.Tables[1].length)return this.DisplayMessage="NO Register Assigned",this.DialogResult=!0,void(this.OKCancelVisibility=!0);if(this.ScreenObject.RegisterNodeID=parseInt(this.ScreenObject.Data.Tables[1][0].NodeID),this.ScreenObject.ShiftNodeID=parseInt("0"==this.ScreenObject.Data.Tables[1][0].ShiftID.toString()?"1":this.ScreenObject.Data.Tables[1][0].ShiftID),0==this.ScreenObject.Data.Tables[8].filter((function(e){return e.CCID==s.a.SessionManager.RegisterCCID})).length)return this.DisplayMessage="Define Register in document prefix",this.DialogResult=!0,void(this.OKCancelVisibility=!0);if(!this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key"))return this.DisplayMessage="Define line wise debit account",this.DialogResult=!0,void(this.OKCancelVisibility=!0);if(!this.ScreenObject.Preferences.ContainsKey("PosPaymentTypeFld")||""==this.ScreenObject.Preferences.PosPaymentTypeFld||"0"==this.ScreenObject.Preferences.PosPaymentTypeFld)return this.DisplayMessage="Define Payment type field in preferences",this.DialogResult=!0,void(this.OKCancelVisibility=!0)}var j=this.ScreenObject.Data.Tables[10].filter((function(e){return-2==e.CostCenterColID&&(1==e.Mode||3==e.Mode)}));if(j.length>0?(this.BodyVisible=Object(l.j)(j[0].IsVisible),this.ReadOnlyBody=!Object(l.j)(j[0].IsEditable)):(this.BodyVisible=!0,this.ReadOnlyBody=!1),this.ReadOnlyBody=!(!this.ScreenObject.Preferences.ContainsKey("Lock Body")||!Object(l.j)(this.ScreenObject.Preferences["Lock Body"])),!o.e.IsEmpty(s.a.SessionManager.Preferences.DimensionwiseCurrency)&&parseInt(s.a.SessionManager.Preferences.DimensionwiseCurrency)>5e4&&!(this.ScreenObject.DocumentType>=51&&this.ScreenObject.DocumentType<=199)){if(this.ScreenObject.ColumnSource.find((function(e){return e.CostCenterID==parseInt(s.a.SessionManager.Preferences.DimensionwiseCurrency)&&e.DisplayMember.toLowerCase().startsWith("dcccnid")})))return this.DisplayMessage="Define Exchange Rate Dimension in header",this.DialogResult=!0,void(this.OKCancelVisibility=!0);if(null==this.ScreenObject._CCFields.find((function(e){return e instanceof C.b&&e.CCID==parseInt(s.a.SessionManager.Preferences.DimensionwiseCurrency)})))return this.DisplayMessage="Define Exchange Rate Dimension in document",this.DialogResult=!0,void(this.OKCancelVisibility=!0)}this.SetLockDims(),""==this.ScreenName&&this.ScreenObject.Data.Tables.length>3&&this.ScreenObject.Data.Columns[3].Contains("DocumentName")&&this.ScreenObject.Data.Tables[3].length>0&&(this.ScreenName=this.ScreenObject.Data.Tables[3][0].DocumentName.toString()),this.HistCols=[];var P=new f.a;P.Header="Version",P.DisplayMember="VersionNo",P.ReadOnly=!0,P.DisableTab=!0,P.Width=50,this.HistCols.push(P),(P=new f.a).Header="Reason",P.DisplayMember="ReviseReason",P.ReadOnly=!0,P.DisableTab=!0,P.Width=100,this.HistCols.push(P),(P=new f.a).Header="User",P.DisplayMember="ModifiedBy",P.ReadOnly=!0,P.DataType="LINK",P.DisableTab=!0,P.Click.Subscribe(this,"onHistoryClick"),P.Width=100,this.HistCols.push(P),(P=new f.a).Header="Date",P.DisplayMember="ModifiedDate",P.ReadOnly=!0,P.DisableTab=!0,P.Width=120,this.HistCols.push(P),this.DocHistory=[],this.DocHistoryColumns=[],this.DocHistoryColumns.push("ModifiedBy"),this.DocHistoryColumns.push("ModifiedDate"),this.DocHistoryColumns.push("MaxID"),this.DocHistoryColumns.push("IsCurrent"),this.DocHistoryColumns.push("VersionNo"),this.DocHistoryColumns.push("ReviseReason"),null!=this.ScreenObject.Link&&null!=this.ScreenObject.Link.DocumentList&&this.ScreenObject.Link.DocumentList.cmnItem_Click.Subscribe(this,"onselectall");var A=0,M=!1;if(this.ScreenObject.IsInventory&&(M=Object(l.j)(s.a.SessionManager.Preferences.EnableLocationWise),M=Object(l.j)(s.a.SessionManager.Preferences["Location AverageRate"]),s.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&Object(l.j)(s.a.SessionManager.Preferences.EnableLocationWise)&&s.a.SessionManager.Preferences.ContainsKey("Location AverageRate")&&Object(l.j)(s.a.SessionManager.Preferences["Location AverageRate"])&&(this.ScreenObject.PriceTaxcc.ContainsKey(50002)?this.ScreenObject.PriceTaxcc[50002]=this.ScreenObject.PriceTaxcc[50002]+",a":this.ScreenObject.PriceTaxcc.push(50002,"a")),M=Object(l.j)(s.a.SessionManager.Preferences.EnableDivisionWise),M=Object(l.j)(s.a.SessionManager.Preferences["Division AverageRate"]),s.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&Object(l.j)(s.a.SessionManager.Preferences.EnableDivisionWise)&&s.a.SessionManager.Preferences.ContainsKey("Division AverageRate")&&Object(l.j)(s.a.SessionManager.Preferences["Division AverageRate"])&&(this.ScreenObject.PriceTaxcc.ContainsKey(50001)?this.ScreenObject.PriceTaxcc[50001]=this.ScreenObject.PriceTaxcc[50001]+",a":this.ScreenObject.PriceTaxcc.push(50001,"a")),M=Object(l.j)(s.a.SessionManager.Preferences.EnableLocationWise),M=Object(l.j)(s.a.SessionManager.Preferences["Location Stock"]),s.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&Object(l.j)(s.a.SessionManager.Preferences.EnableLocationWise)&&s.a.SessionManager.Preferences.ContainsKey("Location Stock")&&Object(l.j)(s.a.SessionManager.Preferences["Location Stock"])&&(this.ScreenObject.PriceTaxcc.ContainsKey(50002)?this.ScreenObject.PriceTaxcc[50002]=this.ScreenObject.PriceTaxcc[50002]+",s":this.ScreenObject.PriceTaxcc.push(50002,"s")),M=Object(l.j)(s.a.SessionManager.Preferences.EnableDivisionWise),M=Object(l.j)(s.a.SessionManager.Preferences["Division Stock"]),s.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&Object(l.j)(s.a.SessionManager.Preferences.EnableDivisionWise)&&s.a.SessionManager.Preferences.ContainsKey("Division Stock")&&Object(l.j)(s.a.SessionManager.Preferences["Division Stock"])&&(this.ScreenObject.PriceTaxcc.ContainsKey(50001)?this.ScreenObject.PriceTaxcc[50001]=this.ScreenObject.PriceTaxcc[50001]+",s":this.ScreenObject.PriceTaxcc.push(50001,"s")),A=o.e.Int(s.a.SessionManager.Preferences["Maintain Dimensionwise stock"]),s.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&A>5e4&&(this.ScreenObject.PriceTaxcc.ContainsKey(A)?this.ScreenObject.PriceTaxcc[A]=this.ScreenObject.PriceTaxcc[A]+",s":this.ScreenObject.PriceTaxcc.push(A,"s")),A=o.e.Int(s.a.SessionManager.Preferences["Maintain Dimensionwise AverageRate"]),s.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise AverageRate")&&A>5e4&&(this.ScreenObject.PriceTaxcc.ContainsKey(A)?this.ScreenObject.PriceTaxcc[A]=this.ScreenObject.PriceTaxcc[A]+",a":this.ScreenObject.PriceTaxcc.push(A,"a"))),A=0,M=!1,this.SalesManDimension=new C.b,this.SalesManDimension.Visible=!1,this.ScreenObject.ColumnSource.forEach((function(e){if(e.footer="",A++,"RefNo"==e.DisplayMember||"Denomination"==e.DisplayMember)e.DataType="LINK",e.DisableTab=!0,e.Click.Subscribe(t,"onLinkRefClick"),"Denomination"==e.DisplayMember&&t.ScreenObject.GridDataColumns.push("DenominationsXML");else if("LINK"==e.DataType){if(e.ValueBinding)return;e.Click.Subscribe(t,"onAttachLinkClick")}else"CheckBox"==e.DataType&&e.CheckedChanged.Subscribe(t,"OnCheckedChanged");t.ScreenObject.IsInventory&&0==t.ColumnNo?null!=e.ValueMember&&"productid_key"==e.ValueMember.toLowerCase()?M=!0:M&&e.IsVisible&&(t.ColumnNo=A):t.ScreenObject.IsInventory||0!=t.ColumnNo||(null==e.ValueMember||"debitaccount_key"!=e.ValueMember.toLowerCase()&&"creditaccount_key"!=e.ValueMember.toLowerCase()&&"accountid_key"!=e.ValueMember.toLowerCase()?M&&e.IsVisible&&(t.ColumnNo=A):M=!0),38!=t.ScreenObject.DocumentType&&39!=t.ScreenObject.DocumentType||50005!=e.CostCenterID||(t.SalesManDimension.Visible=!0,t.SalesManDimension.CCID=50005,t.SalesManDimension.Label=e.Header,t.SalesManDimension.TypeID=e.TypeID,t.SalesManDimension.GridViewID=e.GridViewID,t.SalesManDimension.GridViewID>0&&(t.SalesManDimension.SearchVisible=!0)),o.e.IsEmpty(e.Shortcut)||t.Shortcuts.push(e)})),this.DynFooter=!(!this.ScreenObject.Preferences.ContainsKey("Dynamic Footer")||null==this.ScreenObject.Preferences["Dynamic Footer"]||"True"!=this.ScreenObject.Preferences["Dynamic Footer"]),this.AppRejDate.Visible=!(!this.ScreenObject.Preferences.ContainsKey("AppDate")||"True"!=this.ScreenObject.Preferences.AppDate),this.ScreenObject.Data.Tables.length>3&&this.ScreenObject.Data.Tables[3].length>0&&(this.ScreenObject.Data.Columns[3].Contains("IsLineWise")&&!o.e.IsEmpty(this.ScreenObject.Data.Tables[3][0].IsLineWise)&&(this.LineWiseApproval=Object(l.j)(this.ScreenObject.Data.Tables[3][0].IsLineWise)),this.ScreenObject.Data.Columns[3].Contains("UserWise")&&!o.e.IsEmpty(this.ScreenObject.Data.Tables[3][0].UserWise)&&(this.UserWiseApproval=Object(l.j)(this.ScreenObject.Data.Tables[3][0].UserWise)),this.ScreenObject.Data.Columns[3].Contains("OnReject")&&!o.e.IsEmpty(this.ScreenObject.Data.Tables[3][0].OnReject)&&(this.OnRejectEdit=Object(l.j)(this.ScreenObject.Data.Tables[3][0].OnReject)),this.ScreenObject.Data.Columns[3].Contains("attachfile")&&!o.e.IsEmpty(this.ScreenObject.Data.Tables[3][0].attachfile)&&(this.HelpDoc=this.ScreenObject.Data.Tables[3][0].attachfile)),this.RightPanelVisiblity=!this.ScreenObject.Preferences.ContainsKey("HideRightNav")||""==this.ScreenObject.Preferences.HideRightNav||"True"!=this.ScreenObject.Preferences.HideRightNav,this.ScreenObject.Preferences.ContainsKey("DisableRightPanel")&&""!=this.ScreenObject.Preferences.DisableRightPanel&&(this.DisableRightPanel=Object(l.j)(this.ScreenObject.Preferences.DisableRightPanel)),this.ScreenObject.Preferences.ContainsKey("EnableRevision")&&""!=this.ScreenObject.Preferences.EnableRevision&&Object(l.j)(this.ScreenObject.Preferences.EnableRevision)&&(this.ScreenObject.DocPrefix.RevisionCombo.Visible=!0,this.ScreenObject.DocPrefix.RevisionCombo.Items.push(m.d.ComboBoxItems_2("","0")),this.ScreenObject.DocPrefix.RevisionCombo.SelectedValue="0",this.ScreenObject.DocPrefix.RevisionCombo.SelectionChangedCommand.Subscribe(this,"onVerionChanged")),this.ScreenObject.Preferences.ContainsKey("DonotupdateInventory")&&""!=this.ScreenObject.Preferences.DonotupdateInventory&&(this.DonotUpdateInventory=Object(l.j)(this.ScreenObject.Preferences.DonotupdateInventory)),this.ScreenObject.Preferences.ContainsKey("DonotUpdateSchemeQty")&&""!=this.ScreenObject.Preferences.DonotUpdateSchemeQty&&(this.DonotUpdateSchemeQty=Object(l.j)(this.ScreenObject.Preferences.DonotUpdateSchemeQty)),this.ScreenObject.Preferences.ContainsKey("HideNetAmt")&&"True"==this.ScreenObject.Preferences.HideNetAmt&&(this.NetAmtVisibility=!1),this.ScreenObject.Preferences.ContainsKey("HideNetAmt")&&"True"==this.ScreenObject.Preferences.HideNetAmt)this.NetAmtVisibility=!1;else if(this.ScreenObject.Data.Tables.length>10){var v=this.ScreenObject.Data.Tables[10].filter((function(e){return(1==e.Mode||3==e.Mode)&&-1==e.CostCenterColID}));v.length>0&&!o.e.IsEmpty(v[0].IsVisible)&&(this.NetAmtVisibility=Object(l.j)(v[0].IsVisible))}if(this.ScreenObject.Preferences.ContainsKey("OptionalInventory")&&""!=this.ScreenObject.Preferences.OptionalInventory&&Object(l.j)(this.ScreenObject.Preferences.OptionalInventory)){var G=new b.a(0);G.Row=3,G.Column=3,this.ScreenObject.HeaderFields.push(G),this.donotupInv=this.ScreenObject.HeaderFields[this.ScreenObject.HeaderFields.length-1],null!=this.donotupInv&&(this.donotupInv.IsChecked=this.DonotUpdateInventory,this.donotupInv.Label="Do not Update Inventory")}if(this.ConstructFormulaFields(),this.IsInventoryVoucher=this.ScreenObject.IsInventory,this.DocumentType=this.ScreenObject.DocumentType,this.LoadButtons(),32==this.ScreenObject.DocumentType&&(this.savebulk=!0),this.ScreenObject.HeaderFields.forEach((function(e){if(e instanceof C.a)e.ClickCommand.Subscribe(t,"OnHistoryButtonClick");else if(e instanceof g.b)t.Currency=e,t.Currency.Currency.SelectionChangedCommand.Subscribe(t,"onCurrencyChanged"),t.Currency.ExchangeRate.LostFocusCommand.Subscribe(t,"onExchangeRateChanged");else if(e instanceof m.e&&"ChequeBookNo"==e.DBColumnName)t.ChequeBook=e,t.ChequeBook.SelectionChangedCommand.Subscribe(t,"OnChequeBookSelection");else if(e instanceof S.c&&"chequematuritydate"==e.DBColumnName.toLowerCase())e.SelectedDateChanged.Subscribe(t,"ValidateDate");else if(e instanceof S.c&&"duedate"==e.DBColumnName.toLowerCase()){if(31!=t.ScreenObject.DocumentType&&32!=t.ScreenObject.DocumentType||e.SelectedDateChanged.Subscribe(t,"onDateChanged"),t.ScreenObject.Preferences.ContainsKey("DueDateonBillDate")&&""!=t.ScreenObject.Preferences.DueDateonBillDate){for(var n=t.ScreenObject.Preferences.DueDateonBillDate,a=0;a<t.ScreenObject.HeaderFields.length;a++){var i=t.ScreenObject.HeaderFields[a];if(i instanceof S.c&&i.DBColumnName.toLowerCase()==n.toLowerCase()){e.VoucherDate=i;break}}for(var r=0;r<t.ScreenObject._TextFields.length;r++){var c=t.ScreenObject._TextFields[r];if(c instanceof S.c&&c.DBColumnName.toLowerCase()==n.toLowerCase()){e.VoucherDate=c;break}}}}else e instanceof h.d&&"SKU"==e.DBColumnName?(t.SKU=e,t.SKU.isSKU=!0,e.TextChangedCommand.Subscribe(t,"onSKUKeyDown")):e instanceof S.a&&"docdate"==e.DBColumnName.toLowerCase()&&(38==t.ScreenObject.DocumentType||39==t.ScreenObject.DocumentType||t.ScreenObject.GridDataColumns.Contains("FieldType")?(o.e.IsEmpty(t.ScreenObject.Data.Tables[1][0].Day)||(e.DefaultValue=t.ScreenObject.Data.Tables[1][0].Day.toString(),e.Date=new Date(t.ScreenObject.Data.Tables[1][0].Day),e.Text=new Date(t.ScreenObject.Data.Tables[1][0].Day).ToString(s.a.SessionManager.Preferences["Date Format"]),t.DocumentDate=new Date(t.ScreenObject.Data.Tables[1][0].Day)),e.IsReadOnly=!0):s.a.SessionManager.Preferences.ContainsKey("DocumentDateFromServer")&&"true"==s.a.SessionManager.Preferences.DocumentDateFromServer.toLowerCase()&&t.ScreenObject.Data.Tables.length>22&&t.ScreenObject.Data.Columns[22].Contains("ServerDate")&&t.ScreenObject.Data.Tables[22].length>0&&!o.e.IsEmpty(t.ScreenObject.Data.Tables[22][0].ServerDate)&&(e.DefaultValue=t.ScreenObject.Data.Tables[22][0].ServerDate.toString(),t._Ddate=new Date(t.ScreenObject.Data.Tables[22][0].ServerDate)));e instanceof y.c&&!o.e.IsEmpty(e.KeyTip)&&t.Shortcuts.push(e)})),this.ScreenObject.HeaderFields.Remove(this.SKU),this.ScreenObject._TextFields.forEach((function(e){if(e instanceof h.d?e.LostFocusCommand.Subscribe(t,"onTextBoxLostFocus"):e instanceof m.e?(e.LostFocusCommand.Subscribe(t,"onTextBoxLostFocus"),e.SelectionChangedCommand.Subscribe(t,"onComboBoxSelectionChanged")):e instanceof O.a?e.LostFocusCommand.Subscribe(t,"onTextBoxLostFocus"):(e instanceof S.a||e instanceof S.c||e instanceof S.b)&&e.SelectedDateChanged.Subscribe(t,"onDateChanged"),o.e.IsEmpty(e.KeyTip)||t.Shortcuts.push(e),30==t.ScreenObject.DocumentType&&(t.ScreenObject.Preferences.ContainsKey("AssembleType")&&t.ScreenObject.Preferences.AssembleType==e.DBColumnID.toString()?e instanceof m.e&&(e.SelectionChangedCommand.Subscribe(t,"onTypeChange"),e.Items.Clear(),e.Items.push(m.d.ComboBoxItems_2("DisAssemble","DisAssemble")),e.Items.push(m.d.ComboBoxItems_2("Assemble","Assemble")),e.DefaultValue=e.SelectedValue="DisAssemble"==e.DefaultValue?"DisAssemble":"Assemble"):t.ScreenObject.Preferences.ContainsKey("AssembleProduct")&&t.ScreenObject.Preferences.AssembleProduct==e.DBColumnID.toString()&&e instanceof C.b&&(e.OnPactListBoxValueChanged.Subscribe(t,"OnKitProductChange"),e.CustomWhere=" a.ProductTypeID=9 ")),81==t.ScreenObject.DocumentType||t.IsNewAssignLeave){if("dcAlpha1"==e.DBColumnName.toString()&&e instanceof m.e&&(e.SelectionChangedCommand.Subscribe(t,"OnYearSelected"),e.Items.Clear(),e.Items.push(m.d.ComboBoxItems_2("GradeWise","GradeWise")),e.Items.push(m.d.ComboBoxItems_2("EmployeeWise","EmployeeWise")),e.SelectedValue="GradeWise"),"dcAlpha2"==e.DBColumnName.toString()&&e instanceof m.e){e.SelectionChangedCommand.Subscribe(t,"OnYearSelected");for(var n=2e3;n<2100;n++)e.Items.push(m.d.ComboBoxItems_2(n.toString(),n.toString()))}}else 61==t.ScreenObject.DocumentType?"dcAlpha18"==e.DBColumnName.toString()&&e instanceof m.e&&(e.SelectionChangedCommand.Subscribe(t,"OnYearSelected"),e.Items.Clear(),e.Items.push(m.d.ComboBoxItems_2("(VacDaysPerMonth * MonthDaysToConsider)/TotalMonthDays","1")),e.Items.push(m.d.ComboBoxItems_2("(VacDaysPerYear / 365) * MonthDaysToConsider","2")),e.SelectedValue="1"):85==t.ScreenObject.DocumentType?"dcAlpha1"!=e.DBColumnName.toString()&&"dcAlpha2"!=e.DBColumnName.toString()||(e.CustomFormat="MMM/yyyy",e.Date=new Date((new Date).getFullYear(),(new Date).getMonth(),1),"dcAlpha1"==e.DBColumnName.toString()&&e.SelectedDateChanged.Subscribe(t,"dtpBulkApprEffectFrom_SelectedDateChanged")):58==t.ScreenObject.DocumentType?"dcAlpha10"==e.DBColumnName.toString()&&(e.CustomFormat="MMM/yyyy",e.Date=new Date((new Date).getFullYear(),(new Date).getMonth(),1),e.SelectedDateChanged.Subscribe(t,"PayrollMonthTypeOfField_SelectedDateChanged")):72==t.ScreenObject.DocumentType?"dcAlpha25"==e.DBColumnName.toString()&&(e.CustomFormat="MMM/yyyy",e.Date=new Date((new Date).getFullYear(),(new Date).getMonth(),1),e.SelectedDateChanged.Subscribe(t,"PayrollMonthTypeOfField_SelectedDateChanged")):79==t.ScreenObject.DocumentType&&"dcAlpha1"==e.DBColumnName.toString()&&(e.Date=new Date((new Date).getFullYear(),(new Date).getMonth(),1),e.SelectedDateChanged.Subscribe(t,"PayrollMonthTypeOfField_SelectedDateChanged"))})),this.ScreenObject._CCFields.forEach((function(e){e instanceof C.a&&e.ClickCommand.Subscribe(t,"OnHistoryButtonClick"),o.e.IsEmpty(e.KeyTip)||t.Shortcuts.push(e)})),this.ScreenObject.GridDataObj.RowDeleted.Subscribe(this,"onDeleteRow"),31==this.ScreenObject.DocumentType&&(this.ImportbuttonVisible=!0),1==this.ScreenObject.DocumentType||39==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||6==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||13==this.ScreenObject.DocumentType?this.VoucherType=1:11!=this.ScreenObject.DocumentType&&38!=this.ScreenObject.DocumentType&&5!=this.ScreenObject.DocumentType&&7!=this.ScreenObject.DocumentType&&9!=this.ScreenObject.DocumentType&&24!=this.ScreenObject.DocumentType&&33!=this.ScreenObject.DocumentType&&10!=this.ScreenObject.DocumentType&&8!=this.ScreenObject.DocumentType&&12!=this.ScreenObject.DocumentType||(this.VoucherType=-1),this.Title=this.ScreenName,this.DocStatus="POSDocumentViewModel"==this.ClassName?"":"["+s.a.GetResource("Doc_Draft")+"]",this.ChangeLocation(!1,this.IsEdit,s.a.SessionManager.LocationID,e),this.ScreenObject.SetDefaultValuesforCostCenters(0),this.ScreenObject.Data.Tables.length>22&&this.ScreenObject.Data.Columns[22].Contains("ServerDate")&&this.ScreenObject.Data.Tables[22].length>0&&!o.e.IsEmpty(this.ScreenObject.Data.Tables[22][0].ServerDate))if(1==s.a.SessionManager.IsWebApplication){var N=new Date(this.ScreenObject.Data.Tables[22][0].ServerDate);this.fldDict.ServerDate.setFieldValue(N.ToString("MMM/dd/yyyy")),this.FooterDics.ServerDate.setFieldValue(N.ToString("MMM/dd/yyyy"))}else this.fldDict.ServerDate.setFieldValue(this.ScreenObject.Data.Tables[22][0].ServerDate.toString()),this.FooterDics.ServerDate.setFieldValue(this.ScreenObject.Data.Tables[22][0].ServerDate.toString());if(this.IsPOs&&this.DialogResult){var E="";if(null!=this.DocumentNumber&&this.DocumentNumber.DocNumberFields.length>0)for(var w=0;w<this.DocumentNumber.DocNumberFields.length;w++)this.DocumentNumber.DocNumberFields[w].CCID>5e4&&(E=E+" AND CCD.dcCCNID"+(this.DocumentNumber.DocNumberFields[w].CCID-5e4)+"="+this.DocumentNumber.DocNumberFields[w].SelectedValue);var F=s.a.admin.POSLogin(this.ScreenObject.RegisterNodeID,this.ScreenObject.ShiftNodeID,this.DocumentDate,100,"","",E),V=F;if(this.PosSessionID=F.obj,-11==this.PosSessionID){if(1!=confirm("Shift is closed.Do you want to open another shift?"))return void(this.DialogResult=!1);var L=s.a.common.GetDataSet3("POS001",s.a.SessionManager.Preferences.PosShifts,this.ScreenObject.GetTableName(parseInt(s.a.SessionManager.Preferences.PosShifts)),this.DocumentDate.ToString("dd/MMM/yyyy"));if(!(null!=L&&L.Tables.length>0&&L.Tables[0].length>0&&L.Columns[0].Contains("NodeID")))return alert("All Shifts are closed."),void(this.DialogResult=!1);this.ScreenObject.ShiftNodeID=parseInt(L.Tables[0][0].NodeID),V=F=s.a.admin.POSLogin(this.ScreenObject.RegisterNodeID,this.ScreenObject.ShiftNodeID,this.DocumentDate,100,"","",E),this.PosSessionID=F.obj;var R=this.ScreenObject._CCFields.find((function(e){return e instanceof C.b&&e.CCID==parseInt(s.a.SessionManager.Preferences.PosShifts)}));R&&(R.SelectedValue=this.ScreenObject.ShiftNodeID,R.DefaultValue=this.ScreenObject.ShiftNodeID.toString())}if(-9==this.PosSessionID)return alert("Invalid user for this Register"),void(this.DialogResult=!1);if(-10==this.PosSessionID)return alert("POS session locked by user '"+V.Tables[0][0].UserName.toString()+"'"),void(this.DialogResult=!1);if(this.DocumentDate!=Date.Today()&&this.DocumentDate>Date.Today())if(s.a.SessionManager.Preferences.ContainsKey("NoFuturetransaction")&&"True"==s.a.SessionManager.Preferences.NoFuturetransaction){if(!s.a.SessionManager.IsActionAssigned(43,"Re-Open Pos Closed Shift"))return alert("Day is closed."),s.a.common.GetDataSet("POS002",this.PosSessionID.toString()),void(this.DialogResult=!1);if(1==confirm("Day is closed.Do you want to open last shift?")){var B=[];return B.push(this.PosSessionID),B.push(this.ScreenObject.RegisterNodeID),!this.ScreenObject.Preferences.ContainsKey("PosJVOn")||"2"!=this.ScreenObject.Preferences.PosJVOn&&"1"!=this.ScreenObject.Preferences.PosJVOn||(B.push(this.ScreenObject.Preferences.PosJVOn),B.push(s.a.SessionManager.RegisterCCID),B.push(s.a.SessionManager.Preferences.PosShifts),B.push(s.a.SessionManager.UserID),B.push(s.a.SessionManager.UserName),B.push(s.a.SessionManager.RoleID),B.push(s.a.SessionManager.LanguageID)),s.a.document.ReOpenClosedShift(B),void(this.DialogResult=!1)}}else s.a.SessionManager.IsWebApplication&&alert("Document date and system date are not same.");if(this.ScreenObject.Preferences.ContainsKey("RowHeight")&&!o.e.IsEmpty(this.ScreenObject.Preferences.RowHeight)&&o.e.Double(this.ScreenObject.Preferences.RowHeight)>0&&(this.GridRowHeight=parseFloat(this.ScreenObject.Preferences.RowHeight)),38!=this.ScreenObject.DocumentType&&39!=this.ScreenObject.DocumentType||(this.ScreenObject.Preferences.ContainsKey("right panel width")&&!o.e.IsEmpty(this.ScreenObject.Preferences["right panel width"])&&o.e.Double(this.ScreenObject.Preferences["right panel width"])>0&&(this.RightPanelWidth=parseFloat(this.ScreenObject.Preferences["right panel width"])),this.ScreenObject.Data.Columns[1].Contains("RightPanelWidth")&&!o.e.IsEmpty(this.ScreenObject.Data.Tables[1][0].RightPanelWidth)&&o.e.Double(this.ScreenObject.Data.Tables[1][0].RightPanelWidth)>0&&(this.RightPanelWidth=parseFloat(this.ScreenObject.Data.Tables[1][0].RightPanelWidth)),this.ScreenObject.Data.Columns[1].Contains("RowSize")&&!o.e.IsEmpty(this.ScreenObject.Data.Tables[1][0].RowSize)&&o.e.Double(this.ScreenObject.Data.Tables[1][0].RowSize)>0&&(this.GridRowHeight=parseFloat(this.ScreenObject.Data.Tables[1][0].RowSize)),this.ScreenObject.Data.Columns[1].Contains("TouchScreen")&&!o.e.IsEmpty(this.ScreenObject.Data.Tables[1][0].TouchScreen)&&Object(l.j)(this.ScreenObject.Data.Tables[1][0].TouchScreen)&&(this.TouchVisibility=!0,"POSDocumentViewModel"!=this.ClassName&&(this.TouchView=new qt.a(this),this.NumericPADView=new Yt(this)))),V.Tables.length>0&&V.Columns[0].Contains("IsOpening")&&"1"==V.Tables[0][0].IsOpening.toString())if(this.ScreenObject.Preferences.ContainsKey("DonotConsiderOpeningInPaymode")&&""!=this.ScreenObject.Preferences.DonotConsiderOpeningInPaymode&&Object(l.j)(this.ScreenObject.Preferences.DonotConsiderOpeningInPaymode)){var x=new ut.AddDenominationViewModel(this,null);s.a.page.ShowDialog(x,lt.AddDenominationComponent,{ShowCenter:!0}).subscribe((function(e){t.DialogResult||s.a.common.GetDataSet("POS002",t.PosSessionID.toString())}))}else if(s.a.SessionManager.Preferences.ContainsKey("OpeningCashDOc")&&""!=s.a.SessionManager.Preferences.OpeningCashDOc&&"0"!=s.a.SessionManager.Preferences.OpeningCashDOc)try{var k=new we.PostVoucherSaveViewModel(this,parseInt(s.a.SessionManager.Preferences.OpeningCashDOc),0,0,1,1,!1,!0);s.a.page.ShowDialog(k,Ee.PostVoucherSaveComponent,{ShowCenter:!0}).subscribe((function(e){t.DialogResult||(s.a.common.GetDataSet("POS002",t.PosSessionID.toString()),s.a.page.removeActiveTab())}))}catch(Y){this.DisplayMessage="Error In Loading Cash Receipt Document",Logger.ErrorLog("POS CashIn:",Y.message)}if(V.Tables.length>1&&V.Columns[1].Contains("EPOSDim")&&"1"!=V.Tables[1][0].EPOSDim.toString()&&s.a.SessionManager.Preferences.ContainsKey("EPOS")&&o.e.Int(s.a.SessionManager.Preferences.EPOS)>0){var _=this.ScreenObject._CCFields.find((function(e){return e instanceof C.b&&0==e.CCID}));null!=_&&(_.CustomWhere=" a.NodeID IN ("+V.Tables[1][0].EPOSDim.toString()+")",V.Tables[1][0].EPOSDim.toString().Contains(",")||(_.SelectedValue=parseInt(V.Tables[1][0].EPOSDim)))}if(V.Tables.length>1&&V.Columns[1].Contains("SmartCardDim")&&"1"!=V.Tables[1][0].SmartCardDim.toString()&&s.a.SessionManager.Preferences.ContainsKey("SmartCard")&&o.e.Int(s.a.SessionManager.Preferences.SmartCard)>0){var K=this.ScreenObject._CCFields.find((function(e){return e instanceof C.b&&0==e.CCID}));null!=K&&(K.CustomWhere=" a.NodeID IN ("+V.Tables[1][0].SmartCardDim.toString()+")",V.Tables[1][0].SmartCardDim.toString().Contains(",")||(K.SelectedValue=parseInt(V.Tables[1][0].SmartCardDim)))}}else this.ScreenObject.Preferences.ContainsKey("EnableTouch")&&Object(l.j)(this.ScreenObject.Preferences.EnableTouch)&&(this.TouchVisibility=!0);null!=this.SKU?38==this.ScreenObject.DocumentType||39==this.ScreenObject.DocumentType?(this.SKU.Mandatory=!0,"POSDocumentViewModel"==this.ClassName&&(this.SKU.Label=this.SKU.Label.replace("*","")+" F12")):this.SKU.Mandatory=!1:(this.SKU=new h.d,this.SKU.isSKU=!0,this.SKU.Visible=!1);var Q=this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&55500==e.LinkData}));if(Q.length>0){var H=this.ScreenObject._TextFields.find((function(e){return e.DBColumnID.toString()==Q[0].CostCenterColID.toString()}));H instanceof h.d&&(H.Text="0")}this.ScreenObject.GridDataObj.Height=this.ScreenObject.CustomTab.Pages.length>0&&this.ScreenObject.FooterGridData.length>0?252:this.ScreenObject.CustomTab.Pages.length>0?300:350;var W=o.e.Int(this.ScreenObject.Preferences.MaxRows);if(this.ScreenObject.Preferences.ContainsKey("MaxRows")&&W>0){if(W*this.ScreenObject.GridDataObj.RowHeight+55<this.ScreenObject.GridDataObj.Height&&(this.ScreenObject.GridDataObj.Height=W*this.ScreenObject.GridDataObj.RowHeight+55),this.ScreenObject.MinRowCount=W,this.ScreenObject.GridData.length>W){W=this.ScreenObject.GridData.length-W;for(var U=0;U<W;U++)this.ScreenObject.GridDataObj.removeRowAt(0);this.ScreenObject.UpdateSequence()}this.ScreenObject.GridDataObj.CanUserAddRows=!1}this.ScreenObject.Preferences.ContainsKey("BulkSaveon")&&o.e.Int(this.ScreenObject.Preferences.BulkSaveon)>0&&(this.ScreenObject.BulkSaveon=W=o.e.Int(this.ScreenObject.Preferences.BulkSaveon)),this.IsInventoryVoucher?(33!=this.ScreenObject.DocumentType&&34!=this.ScreenObject.DocumentType?(this.SetVisibiltiFalse(),(this.ScreenObject.Preferences.ContainsKey("PrimaryAddress")&&Object(l.j)(this.ScreenObject.Preferences.PrimaryAddress)||this.ScreenObject.Preferences.ContainsKey("BillingAddress")&&Object(l.j)(this.ScreenObject.Preferences.BillingAddress)||this.ScreenObject.Preferences.ContainsKey("ShippingAddress")&&Object(l.j)(this.ScreenObject.Preferences.ShippingAddress))&&(this.AssignAddress=new T.a(this),this.AddressViewVisibility=!0,this.AssignAddress.BillsVisibe=!(!this.ScreenObject.Preferences.ContainsKey("BillingAddress")||!Object(l.j)(this.ScreenObject.Preferences.BillingAddress))&&Object(l.j)(this.ScreenObject.Preferences.BillingAddress),this.AssignAddress.ShipVisibe=!(!this.ScreenObject.Preferences.ContainsKey("ShippingAddress")||!Object(l.j)(this.ScreenObject.Preferences.ShippingAddress))&&Object(l.j)(this.ScreenObject.Preferences.ShippingAddress),this.AssignAddress.PrimVisibe=!(!this.ScreenObject.Preferences.ContainsKey("PrimaryAddress")||!Object(l.j)(this.ScreenObject.Preferences.PrimaryAddress))&&Object(l.j)(this.ScreenObject.Preferences.PrimaryAddress),(j=this.ScreenObject.Data.Tables[10].length>0?this.ScreenObject.Data.Tables[10].filter((function(e){return-6==e.CostCenterColID&&(1==e.Mode||3==e.Mode)})):[]).length>0&&(this.AssignAddress.PrimVisibe=Object(l.j)(j[0].IsVisible),this.AssignAddress.PrimMandatory=Object(l.j)(j[0].IsMandatory)),j=this.ScreenObject.Data.Tables[10].length>0?this.ScreenObject.Data.Tables[10].filter((function(e){return-7==e.CostCenterColID&&(1==e.Mode||3==e.Mode)})):[],this.AssignAddress.BillsVisibe&&this.AssignAddress.PrimVisibe&&j.length>0&&(this.AssignAddress.BillsVisibe=Object(l.j)(j[0].IsVisible),this.AssignAddress.BillsMandatory=Object(l.j)(j[0].IsMandatory)),j=this.ScreenObject.Data.Tables[10].length>0?this.ScreenObject.Data.Tables[10].filter((function(e){return-8==e.CostCenterColID&&(1==e.Mode||3==e.Mode)})):[],this.AssignAddress.ShipVisibe&&j.length>0&&(this.AssignAddress.ShipVisibe=Object(l.j)(j[0].IsVisible),this.AssignAddress.ShipMandatory=Object(l.j)(j[0].IsMandatory)))):this.AddressViewVisibility=!1,this.BillWisedt=[],this.BillWisedtColumns.push("AccountID"),this.BillWisedtColumns.push("Amount"),this.BillWisedtColumns.push("IsCredit"),this.BillWisedtColumns.push("CurrencyID"),this.BillWisedtColumns.push("ExchangeRate"),this.BillWisedtColumns.push("XML"),this.BillWisedtColumns.push("FromTo"),this.BillWisedtColumns.push("AccountName"),this.BillWisedtColumns.push("DocXML"),this.BillWisedtColumns.push("Decimal"),this.ScreenObject.Preferences.ContainsKey("BillwisePosting")&&"1"==this.ScreenObject.Preferences.BillwisePosting&&this.BillWisedtColumns.push("DocSeqNo")):this.AddressViewVisibility=!1,this.ScreenObject.DocPrefix&&this.ScreenObject.DocPrefix.ComboBox.SelectionChangedCommand.Subscribe(this,"OnDocPrefixChanged"),null!=this.ScreenObject.Link&&(this.ScreenObject.Link.LinkCombo.SelectionChangedCommand.Subscribe(this,"OLinkSelectionChanged"),this.ScreenObject.Link.DocumentList.CheckedChangedCommand.Subscribe(this,"OnLinkDocumentCheckedChanged")),this.ButtonSuspend.Mandatory=!!this.IsInventoryVoucher&&!!(this.ScreenObject.Data.Tables.length>22&&this.ScreenObject.Data.Columns[22].Contains("CNT")&&this.ScreenObject.Data.Tables[22].length>0&&!o.e.IsEmpty(this.ScreenObject.Data.Tables[22][0].CNT)&&parseInt(this.ScreenObject.Data.Tables[22][0].CNT)>0),this.ButtonSuspend.Visible=!1,this.FooterVisible=!!((this.ScreenObject.FooterGridData.length>0||this.ScreenObject.Preferences.ContainsKey("Dynamic Footer")&&""!=this.ScreenObject.Preferences["Dynamic Footer"]&&Object(l.j)(this.ScreenObject.Preferences["Dynamic Footer"]))&&this.ScreenObject.FooterColumnSource.length>1&&this.ScreenObject.FooterColumnSource[1].ComboData.length>0);var X=this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&55847==e.LinkData}));if(X.length>0&&""!=s.a.SessionManager.Preferences.BaseCurrency&&o.e.Int(s.a.SessionManager.Preferences.BaseCurrency)>0){var q=this.ScreenObject._TextFields.find((function(e){return e.DBColumnID.toString()==X[0].CostcenterColid.toString()}));q&&q instanceof h.d&&(q.Text=this.ScreenObject.GetExchangeRate(parseInt(s.a.SessionManager.Preferences.BaseCurrency),this.DocumentDate).toString())}Logger.InfoLog("AddEditDocumentViewModel::BuildControls Success"),this.DisplayName=this.ScreenName,this.ScreenObject.Preferences.ContainsKey("HideBody")&&!o.e.IsEmpty(this.ScreenObject.Preferences.HideBody)&&Object(l.j)(this.ScreenObject.Preferences.HideBody.toString())&&(this.BodyVisible=!1),Logger.InfoLog("AddEditDocumentViewModel::Exiting worker_DoWork")}}},{key:"OnHistoryButtonClick",value:function(e){var t=this;null==e.Dialog&&(e.Dialog=new ee.a(e));var n,a=0;n=e.SelectedValue,e.Dialog.CheckEditData(),s.a.page.ShowDialog(e.Dialog,te.a,{ShowCenter:!0,Title:s.a.GetResource("History")}).subscribe((function(i){a=e.SelectedValue,n!=a&&(t.ScreenObject.Data.Tables[0].filter((function(t){return null!=t.LocalReference&&t.LocalReference==e.DBColumnID})).length>0||t.ScreenObject.DefaultBasedOn.ContainsKey(e.CCID.toString()))&&t.ScreenObject.GetLinkReferenceData(e.DBColumnID,t.CostCenterID,e.SelectedValue,t.DocumentDate,e.DBColumnName,e.CCID,null)}))}},{key:"OnCheckedChanged",value:function(e,t){null!=this.SelectedRow&&(t||94==this.DocumentType&&(o.e.IsEmpty(this.SelectedRow.ProductID_Key)||(this.SelectedRow.dcAlpha7=0,this.ScreenObject.GridDataObj.updateRow(this.SelectedRow))))}},{key:"GetProductByExternFunc",value:function(e,t,n){var a=this.ScreenObject.GetProductByExternFunc(e,this.IsSales,this.ScreenObject.Preferences.OnScan,t);if(null!=a&&a.Tables.length>0&&a.Tables[0].length>0&&a.Columns[0].Contains("ProductID"))for(var i=0;i<a.Tables[0].length;i++){if(i>0&&(n=this.GetEmptyRowPosition(this.ScreenObject.GridDataObj,"ProductID_Key"),t=this.ScreenObject.GridData[n]),o.e.IsEmpty(t.DocSeqNo)&&(t.DocSeqNo=n+1),t.ProductID_Key=a.Tables[0][i].ProductID.toString(),this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(t.ProductCode=a.Tables[0][i].ProductCode.toString()),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(t.ProductName=a.Tables[0][i].ProductName.toString()),this.ScreenObject.GridDataColumns.Contains("UOMID")&&(t.UOM=a.Tables[0][i].UnitName.toString(),t.UOM_Key=a.Tables[0][i].UOMID.toString()),t.Type=a.Tables[0][i].ProductTypeID.toString(),t.UOMConversion=a.Tables[0][i].Conversion.toString(),this.ScreenObject.GridDataColumns.Contains("IsWeightable")&&a.Columns[0].Contains("IsWeightable")&&(t.IsWeightable=a.Tables[0][i].IsWeightable.toString()),this.ScreenObject.Preferences.ContainsKey("EnableWieghingPopupOnQty")&&""!=this.ScreenObject.Preferences.EnableWieghingPopupOnQty&&Object(l.j)(this.ScreenObject.Preferences.EnableWieghingPopupOnQty)&&"true"==t.IsWeightable.toString().toLowerCase()){var r=this.QtyReader("0");"0"==this.IsSales?(t.Quantity=o.e.IsEmpty(r)?0:-parseFloat(r),this.RowForegroundChange(t)):t.Quantity=o.e.IsEmpty(r)?0:parseFloat(r)}else"0"==this.IsSales?(t.Quantity=-1,this.RowForegroundChange(t)):t.Quantity=1;t.UOMConvertedQty=o.e.IsEmpty(a.Tables[0][i].Conversion)?"1":parseFloat(t.UOMConversion)*parseFloat(t.Quantity);var c=null;s.a.SessionManager.Preferences.ContainsKey("POSItemCodeDimension")&&""!=s.a.SessionManager.Preferences.POSItemCodeDimension&&parseInt(s.a.SessionManager.Preferences.POSItemCodeDimension)>5e4&&((c=this.ScreenObject.ColumnSource.find((function(e){return e.CostCenterID.toString()==s.a.SessionManager.Preferences.POSItemCodeDimension})))&&this.ScreenObject.GridDataColumns.Contains(c.DisplayMember)&&(t[c.DisplayMember]=a.Tables[0][i].Code.toString(),!o.e.IsEmpty(c.ValueMember)&&this.ScreenObject.GridDataColumns.Contains(c.ValueMember)&&a.Columns[0].Contains("NodeID")&&(t[c.ValueMember]=a.Tables[0][i].NodeID.toString()))),this.SalesManDimension.Visible&&this.ScreenObject.GridDataColumns.Contains("dcCCNID5")&&this.SalesManDimension.SelectedValue>0&&(t.dcCCNID5=this.SalesManDimension.Text,t.dcCCNID5_Key=this.SalesManDimension.SelectedValue),this.FillDefaultValues(t),this.RepeatRowData(t),this.BindDivisionorLocation(t),this.FillDatarow(t,a.Tables[0],null,{LocalReference:79,LinkData:55490},"AvgPrice"),this.FillDatarow(t,a.Tables[0],null,{LocalReference:79,LinkData:55491},"DealerPrice"),this.FillDatarow(t,a.Tables[0],null,{LocalReference:79,LinkData:55492},"MRP"),a.Tables.length>1&&a.Tables[1].length>0&&(this.FillPromotions(a.Tables[1],n),n+=a.Tables[1].length);for(var u=11;u<a.Tables[0].Columns.length;u++){var d=a.Tables[0].Columns[u];this.ScreenObject.GridDataColumns.Contains(d)&&!o.e.IsEmpty(a.Tables[0][i][d])&&(t[d]=a.Tables[0][i][d])}if(!o.e.IsEmpty(t.ProductID_Key)){this.ProdID=0,this.AddProductData(t,!1,!0,!1,null,null,c);for(var D=11;D<a.Tables[0].Columns.length;D++){var h=a.Tables[0].Columns[D];this.ScreenObject.GridDataColumns.Contains(h)&&h.toLowerCase().Contains("dcnum")&&!o.e.IsEmpty(a.Tables[0][i][h])&&(t[h]=a.Tables[0][i][h])}this.FillScan(t,n)}}else null!=a&&a.Tables.length>0&&a.Tables[0].length>0&&a.Columns[0].Contains("ErrorMessage")&&(this.DisplayMessage=a.Tables[0][0].ErrorMessage.toString())}},{key:"GetProductByStockCode",value:function(e,t,n){var a=this.ScreenObject.GetProductByStockCode(e);if(null!=a&&a.Tables.length>0&&a.Tables[0].length>0){if(t.ProductID_Key=a.Tables[0][0].ProductID.toString(),this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(t.ProductCode=a.Tables[0][0].ProductCode.toString()),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(t.ProductName=a.Tables[0][0].ProductName.toString()),this.ScreenObject.GridDataColumns.Contains("UOMID")&&(t.UOM=a.Tables[0][0].UnitName.toString(),t.UOM_Key=a.Tables[0][0].UOMID.toString()),t.Type=a.Tables[0][0].ProductTypeID.toString(),t.UOMConversion=a.Tables[0][0].Conversion.toString(),this.ScreenObject.GridDataColumns.Contains("IsWeightable")&&a.Columns[0].Contains("IsWeightable")&&(t.IsWeightable=a.Tables[0][0].IsWeightable.toString()),this.ScreenObject.Preferences.ContainsKey("EnableWieghingPopupOnQty")&&""!=this.ScreenObject.Preferences.EnableWieghingPopupOnQty&&Object(l.j)(this.ScreenObject.Preferences.EnableWieghingPopupOnQty)&&"true"==t.IsWeightable.toString().toLowerCase()){var i=this.QtyReader("0");"0"==this.IsSales?(t.Quantity=o.e.IsEmpty(i)?0:-parseFloat(i),this.RowForegroundChange(t)):t.Quantity=o.e.IsEmpty(i)?0:parseFloat(i)}else"0"==this.IsSales?(t.Quantity=-1,this.RowForegroundChange(t)):t.Quantity=1;if(t.UOMConvertedQty=o.e.IsEmpty(a.Tables[0][0].Conversion)?"1":parseFloat(t.UOMConversion)*parseFloat(t.Quantity),s.a.SessionManager.Preferences.ContainsKey("POSItemCodeDimension")){var r=this.ScreenObject.ColumnSource.find((function(e){return e.CostCenterID.toString()==s.a.SessionManager.Preferences.POSItemCodeDimension}));r&&this.ScreenObject.GridDataColumns.Contains(r.DisplayMember)&&(t[r.DisplayMember]=a.Tables[0][0].Code.toString(),!o.e.IsEmpty(r.ValueMember)&&this.ScreenObject.GridDataColumns.Contains(r.ValueMember)&&a.Columns[0].Contains("NodeID")&&(t[r.ValueMember]=a.Tables[0][0].NodeID.toString()))}this.SalesManDimension.Visible&&this.ScreenObject.GridDataColumns.Contains("dcCCNID5")&&this.SalesManDimension.SelectedValue>0&&(t.dcCCNID5=this.SalesManDimension.Text,t.dcCCNID5_Key=this.SalesManDimension.SelectedValue),this.FillDefaultValues(t),this.RepeatRowData(t),this.BindDivisionorLocation(t),this.FillDatarow(t,a.Tables[0],null,{LocalReference:79,LinkData:55490},"AvgPrice"),this.FillDatarow(t,a.Tables[0],null,{LocalReference:79,LinkData:55491},"DealerPrice"),this.FillDatarow(t,a.Tables[0],null,{LocalReference:79,LinkData:55492},"MRP"),a.Tables.length>1&&a.Tables[1].length>0&&(this.FillPromotions(a.Tables[1],n),n+=a.Tables[1].length)}this.ScreenObject.UpdateSequence()}},{key:"onSKUKeyDown",value:function(e,t){s.a.IsNativeMobile&&""!=this.SKU.Text||null!=this.SKU&&"13"==t.keyCode?this.IsInventoryVoucher?this.onSKUSearch(this.SKU.Text):this.SearchInvoice(this.SKU.Text):null!=this.SKU&&"F5"==t.key&&(event.preventDefault(),s.a.page.ShowDialog(new ue(this,7),de.a,{ShowCenter:!0}))}},{key:"SearchInvoice",value:function(e){var t=!1,n="";if(18!=this.DocumentType&&19!=this.DocumentType&&21!=this.DocumentType&&22!=this.DocumentType||!this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")?14!=this.DocumentType&&15!=this.DocumentType&&20!=this.DocumentType&&23!=this.DocumentType||!this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")?this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&(n="AccountID_Key"):n="DebitAccount_Key":(n="CreditAccount_Key",t=!0),""!=n){var a=this.GetEmptyRowPosition(this.ScreenObject.GridDataObj,n),i=this.ScreenObject.GridData[a],r=this.ScreenObject.GetDetailsByDocno(e);if(null!=r&&r.Tables.length>0&&r.Columns[0].Contains("Account1")&&r.Tables[0].length>0){if(i[n]=r.Tables[0][0].Account1.toString(),this.ScreenObject.GridDataColumns.Contains("AccountName")&&(i.AccountName=r.Tables[0][0].AccountName.toString()),this.ScreenObject.GridDataColumns.Contains("AccountCode")&&(i.AccountCode=r.Tables[0][0].AccountCode.toString()),i.Type=Object(l.j)(r.Tables[0][0].IsBillwise.toString()),Object(l.j)(r.Tables[0][0].IsBillwise.toString())){var s=1,o=1;null!=this.Currency&&null!=this.Currency.Currency.SelectedValue&&""!=this.Currency.Currency.SelectedValue&&(s=parseInt(this.Currency.Currency.SelectedValue)),null!=this.Currency&&null!=this.Currency.ExchangeRate.Text&&""!=this.Currency.ExchangeRate.Text&&(o=parseFloat(this.Currency.ExchangeRate.Text)),this.Setselectedrow(a),this.CheckIsBillWise(parseInt(i[n]),i,n,0,t,s,o,r.Tables[0][0].VoucherNo.toString())}this.SKU.Text=""}}}},{key:"CheckandAddBatch",value:function(e,t){var n=this;if(this.ScreenObject.Preferences.ContainsKey("Donotuselocation")&&""!=this.ScreenObject.Preferences.Donotuselocation&&Object(l.j)(this.ScreenObject.Preferences.Donotuselocation)){var a=this.ScreenObject._CCFields.find((function(e){return"dcccnid2"==e.DBColumnName.toLowerCase()}));null!=a&&null!=a&&a instanceof C.b&&a.SelectedValue>0?a.SelectedValue:null!=t&&this.ScreenObject.GridDataColumns.Contains("dcCCNID2_Key")&&!o.e.IsEmpty(t.dcCCNID2_Key)&&parseInt(t.dcCCNID2_Key.toString())}else this.ScreenObject.LocationID>0?this.ScreenObject.LocationID:s.a.SessionManager.LocationID;this.ScreenObject.DivisionID>0?this.ScreenObject.DivisionID:s.a.SessionManager.DivisionID;var i=1;!o.e.IsEmpty(t.Quantity)&&parseFloat(t.Quantity.toString())>0?parseFloat(t.Quantity.toString()):this.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!o.e.IsEmpty(t.FreeQTY)&&parseFloat(t.FreeQTY.toString())>0&&parseFloat(t.FreeQTY.toString()),this.ScreenObject.GridDataColumns.Contains("UOMConversion")&&!o.e.IsEmpty(t.UOMConversion)&&(i=parseFloat(t.UOMConversion.toString()));var r=this.ScreenObject.GetProductwiseBatches(parseInt(t.ProductID_Key.toString()),0,this.VoucherType,t,0,!1),c=0,u=null;if(this.barcodeValues.ContainsKey("Batch_Code")?u=r.Tables[0].filter((function(e){return e.BatchCode==n.barcodeValues.Batch_Code})):this.barcodeValues.ContainsKey("Batch_No")&&(u=r.Tables[0].filter((function(e){return e.BATCHNUMBER==n.barcodeValues.Batch_No}))),null!=u&&0==u.length){if(!this.ScreenObject.Preferences.ContainsKey("OnBatchScan")||"1"!=this.ScreenObject.Preferences.OnBatchScan&&"2"!=this.ScreenObject.Preferences.OnBatchScan)return;if("1"==this.ScreenObject.Preferences.OnBatchScan&&confirm("Batch not exits.Do you want to create?"))return;var d,D,h=0,S=!1,m="";if(s.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise Batches")&&!o.e.IsEmpty(s.a.SessionManager.Preferences["Maintain Dimensionwise Batches"])&&(h=o.e.Int(s.a.SessionManager.Preferences["Maintain Dimensionwise Batches"].toString()))>0){for(var b=0;b<this.ScreenObject._CCFields.length;b++){var y=this.ScreenObject._CCFields[b];if(y instanceof C.b&&y.CCID==h){m="CCNID"+(h-5e4)+"='"+y.SelectedValue+"',",S=!0;break}}S||null!=t&&h>5e4&&this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(h-5e4).toString()+"_Key")&&!o.e.IsEmpty(t["dcCCNID"+(h-5e4).toString()+"_Key"])&&(m=m+"CCNID"+(h-5e4)+"='"+t["dcCCNID"+(h-5e4).toString()+"_Key"].toString()+"',")}if(this.ScreenObject.Preferences.ContainsKey("BatchFilterDim")&&(h=0,S=!1,(h=o.e.Int(this.ScreenObject.Preferences.BatchFilterDim.toString()))>0&&!m.Contains("CCNID"+(h-5e4)+"="))){for(var p=0;p<this.ScreenObject._CCFields.length;p++){var g=this.ScreenObject._CCFields[p];if(g instanceof C.b&&g.CCID==h){g.SelectedValue>0&&(m=m+"CCNID"+(h-5e4)+"='"+g.SelectedValue+"',"),S=!0;break}}S||h>5e4&&this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(h-5e4).toString()+"_Key")&&(S=!0,o.e.IsEmpty(t["dcCCNID"+(h-5e4).toString()+"_Key"])||(m=m+"CCNID"+(h-5e4)+"='"+t["dcCCNID"+(h-5e4).toString()+"_Key"].toString()+"',"))}if(this.barcodeValues.ContainsKey("Batch_MfgDate")&&o.e.isValidDate(this.barcodeValues.Batch_MfgDate)||(d=(new Date).OnlyDate()),this.barcodeValues.ContainsKey("Batch_ExpDate")&&o.e.isValidDate(this.barcodeValues.Batch_ExpDate)||(D=(new Date).OnlyDate().AddYears(1)),(c=this.ScreenObject.SaveBatch(this.barcodeValues.Batch_No,d,D,null,0,0,0,t.ProductID_Key.toString(),"",m))<1)return}else null!=u&&(c=parseInt(u[0].BatchID.toString()));if(e.length>1&&this.ScreenObject.Preferences.ContainsKey("DuplicateProduct_IncrementQuantity")&&!o.e.IsEmpty(this.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity)&&Object(l.j)(this.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity))for(var f=0;f<e.length;f++){var O=e[f];if(!o.e.IsEmpty(O.ExtraXML)&&O!=t){var I=new o.f;I.LoadXml(O.ExtraXML.toString());var T=I.SelectNodes("xml/Row");if(T.length>0&&null!=T[0].attributes.BatchID.value&&T[0].attributes.BatchID.value==c.toString()){var j=1;return o.e.IsEmpty(t.Quantity)||(j=parseFloat(t.Quantity.toString())),this.ClearDatarow(t,!0),o.e.IsEmpty((t=O).Quantity)||(t.Quantity=parseFloat(t.Quantity.toString())+j),T[0].attributes.Quantity.value=t.Quantity.toString(),null!=T[0].attributes.Release&&(T[0].attributes.Release.value=t.Quantity.toString()),void(t.ExtraXML=I.InnerXml)}}}var P="";P+='<xml><Row ProductID="'+t.ProductID_Key.toString()+'" ',P+=' BatchID="'+c+'" ',P+=' Quantity="'+t.Quantity.toString()+'" ',P+=' Hold="0" ',P+=' Release="'+t.Quantity.toString()+'" ></Row></xml>',t.ExtraXML=P.toString()}},{key:"onSKUSearch",value:function(e){var t=this;if(this.ScreenObject.Preferences.ContainsKey("MandatorySalesMan")&&"True"==this.ScreenObject.Preferences.MandatorySalesMan&&null!=this.SalesManDimension&&this.SalesManDimension.Visible&&this.SalesManDimension.SelectedValue<1)this.DisplayMessage=s.a.GetResource("Select")+" "+this.SalesManDimension.Label;else{var n=this.GetEmptyRowPosition(this.ScreenObject.GridDataObj,"ProductID_Key"),a=this.ScreenObject.GridData[n];if(this.ScreenObject.Preferences.ContainsKey("OnScan")&&""!=this.ScreenObject.Preferences.OnScan.toLowerCase())this.GetProductByExternFunc(this.SKU.Text,a,n);else if(this.ScreenObject.Preferences.ContainsKey("PickStockRate")&&"true"==this.ScreenObject.Preferences.PickStockRate.toLowerCase())this.GetProductByStockCode(this.SKU.Text,a,n),o.e.IsEmpty(a.ProductID_Key)||this.FillScan(a,n);else{var i=0,r=this.ScreenObject.ColumnSource.find((function(e){return null!=e.DisplayMember&&"ProductCode"==e.DisplayMember}));if(r&&r.UseBarcode){var c={PID:0};if(this.ReadBarcode(r.BarcodeDef,r.BarcodeProp,null,a,this.SKU.Text,c)){var u;if(i=c.PID,(u=31==this.DocumentType&&this.ScreenObject.GridDataColumns.Contains("BOEID")&&this.barcodeValues.ContainsKey("INVID")?this.ScreenObject.GridData.filter((function(e){return e.BOEID==t.barcodeValues.INVID})):this.ScreenObject.GridDataColumns.Contains("IsFullBatchScanned")?this.ScreenObject.GridData.filter((function(e){return parseInt(e.ProductID_Key)==i&&(null==e.IsFullBatchScanned||"1"!=e.IsFullBatchScanned)})):this.barcodeValues.ContainsKey("Unit_Key")?this.ScreenObject.GridData.filter((function(e){return e.ProductID_Key==i&&e.Unit_Key==t.barcodeValues.Unit_Key})):this.ScreenObject.GridData.filter((function(e){return parseInt(e.ProductID_Key)==i}))).length>0&&u[0]!=a&&(1!=this.VoucherType||!this.barcodeValues.ContainsKey("Batch_Code")&&!this.barcodeValues.ContainsKey("Batch_No"))&&(31==this.DocumentType||this.ScreenObject.Preferences.ContainsKey("DuplicateProduct_IncrementQuantity")&&""!=o.e.String(this.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity)&&"True"==o.e.String(this.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity))){var d=1;if(o.e.IsEmpty(a.Quantity)||(d=parseFloat(a.Quantity)),this.ClearDatarow(a,!0),a=u[0],o.e.IsEmpty(a.Quantity)||(a.Quantity=parseFloat(a.Quantity)+d),this.barcodeValues.ContainsKey("INVID")&&this.ScreenObject.GridDataColumns.Contains("DocExtraXML")&&(a.DocExtraXML='<DocExtraXML><Row RefID="'+this.barcodeValues.INVID+'" Qty="'+a.Quantity.toString()+'" Type="1" ></Row></DocExtraXML>',a.BOEID=this.barcodeValues.INVID.toString(),31!=this.DocumentType)){var D=this.ScreenObject.GetinvBinDetails(this.barcodeValues.INVID.toString(),i.toString(),"");null!=D&&D.Tables.length>0&&D.Tables[0].length>0&&this.AddBins(a,!1,!1,D.Tables[0])}}else if(a.ProductID_Key=i,"0"==this.IsSales?(a.Quantity=-1,this.RowForegroundChange(a)):a.Quantity=1,this.ProdID=0,this.AddProductData(a,!1,!1,!1,null,null),null!=this.barcodeValues&&this.barcodeValues.length>0)for(var h=function(e){var n={Key:t.barcodeValues.keys[e],Value:t.barcodeValues.values[e]};if(t.ScreenObject.GridDataColumns.Contains(n.Key))if("Unit"!=n.Key&&t.ScreenObject.GridDataColumns.Contains(n.Key+"_Key")){var i=t.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember.toLowerCase()==n.Key.toLowerCase()}));if(i&&i.CostCenterID>0&&11!=i.CostCenterID){var r=t.ScreenObject.GetCCListViewDataID(i.CostCenterID,i.TypeID,n.Value.toString());null!=r&&r.Tables.length>0&&r.Tables[0].length>0&&r.Columns[0].Contains("NodeID")&&!o.e.IsEmpty(r.Tables[0][0].NodeID)&&(a[n.Key+"_Key"]=r.Tables[0][0].NodeID.toString(),a[n.Key]=n.Value,t.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&e.LocalReference==i.ID})).length>0&&t.ScreenObject.GetLinkReferenceData(parseInt(i.ID),t.DocumentID,parseInt(a[i.ValueMember]),Date.Today(),"",i.CostCenterID,a))}else if(("DATE"==i.DataType||"DATETIME"==i.DataType)&&o.e.isValidDate(n.Value)){var c=new Date(n.Value);a[n.Key+"_Key"]=c,a[n.Key]=c.ToString("DATE"==i.DataType?s.a.SessionManager.Preferences["Date Format"]:s.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss tt")}}else a[n.Key]=n.Value;else if(t.barcodeValues.ContainsKey("INVID")){if(t.ScreenObject.GridDataColumns.Contains("DocExtraXML")&&(t.barcodeValues.ContainsKey("Quantity")&&(a.Quantity=t.barcodeValues.Quantity),a.DocExtraXML='<DocExtraXML><Row RefID="'+t.barcodeValues.INVID+'" Qty="'+a.Quantity.toString()+'" Type="1" ></Row></DocExtraXML>',a.BOEID=t.barcodeValues.INVID.toString(),31!=t.DocumentType)){var l=t.ScreenObject.GetinvBinDetails(t.barcodeValues.INVID.toString(),a.ProductID_Key.toString(),"");null!=l&&l.Tables.length>0&&l.Tables[0].length>0&&t.AddBins(a,!1,!1,l.Tables[0])}}else{var u=t.ScreenObject.ColumnSource.find((function(e){return!o.e.IsEmpty(e.ValueMember)&&e.ValueMember.toLowerCase()==n.Key.toLowerCase()+"_key"}));if(u&&u.CostCenterID>0){var d=t.ScreenObject.GetCCListViewDataID(u.CostCenterID,u.TypeID,n.Value.toString());null!=d&&d.Tables.length>0&&d.Tables[0].length>0&&d.Columns[0].Contains("NodeID")&&!o.e.IsEmpty(d.Tables[0][0].NodeID)&&(a[u.ValueMember]=d.Tables[0][0].NodeID.toString(),a[u.DisplayMember]=n.Value,t.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&e.LocalReference==u.ID})).length>0&&t.ScreenObject.GetLinkReferenceData(parseInt(u.ID),t.DocumentID,parseInt(a[u.ValueMember]),Date.Today(),"",u.CostCenterID,a))}}},S=0;S<this.barcodeValues.keys.length;S++)h(S);if("5"==a.Type.toString()&&(this.barcodeValues.ContainsKey("Batch_Code")||this.barcodeValues.ContainsKey("Batch_No")))if(-1==this.VoucherType){var m,b=0;if(this.ScreenObject.Preferences.ContainsKey("Donotuselocation")&&""!=this.ScreenObject.Preferences.Donotuselocation&&Object(l.j)(this.ScreenObject.Preferences.Donotuselocation)){var y=this.ScreenObject._CCFields.find((function(e){return"dcccnid2"==e.DBColumnName.toLowerCase()}));null!=y&&y instanceof C.b&&y.SelectedValue>0?b=y.SelectedValue:null!=a&&this.ScreenObject.GridDataColumns.Contains("dcCCNID2_Key")&&!o.e.IsEmpty(a.dcCCNID2_Key)&&(b=parseInt(a.dcCCNID2_Key.toString()))}else b=this.ScreenObject.LocationID>0?this.ScreenObject.LocationID:s.a.SessionManager.LocationID;m=this.ScreenObject.DivisionID>0?this.ScreenObject.DivisionID:s.a.SessionManager.DivisionID;var p=0,g=1;o.e.Double(a.Quantity)>0?p=parseFloat(a.Quantity.toString()):o.e.Double(a.FreeQTY)>0&&(p=parseFloat(a.FreeQTY.toString())),this.ScreenObject.GridDataColumns.Contains("UOMConversion")&&!o.e.IsEmpty(a.UOMConversion)&&(g=parseFloat(a.UOMConversion.toString())),p*=g;var f=new Pe.a(this.ScreenObject.GridDataObj);if(f.BatchNumberViewModel_3(this,this.VoucherType,p,parseInt(a.ProductID_Key),a.ProductName.toString(),b,m,a),u.length>2&&this.ScreenObject.Preferences.ContainsKey("DuplicateProduct_IncrementQuantity")&&!o.e.IsEmpty(this.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity)&&Object(l.j)(this.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity)){var O=null;if(this.barcodeValues.ContainsKey("Batch_Code")?O=f.GridData.filter((function(e){return e.BatchCode==t.barcodeValues.Batch_Code})):this.barcodeValues.ContainsKey("Batch_No")&&(O=f.GridData.filter((function(e){return e.BATCHNUMBER==t.barcodeValues.Batch_No}))),null!=O&&O.length>0)for(var I,T=0;T<u.length;T++){var j=u[T];if(!o.e.IsEmpty(j.ExtraXML)){var P=function(){(I=new o.f).LoadXml(j.ExtraXML.toString());var e=I.SelectNodes("xml/Row");if(e.length>0&&null!=e[0].attributes.BatchID.value&&e[0].attributes.BatchID.value==O[0].BatchID.toString()){if(null!=e[0].attributes.RefInvID&&e[0].attributes.RefInvID.value!=O[0].RefInvID.toString())return"continue";if(j!=a)return o.e.IsEmpty(O[0].BalQty)||o.e.IsEmpty(j.Quantity)||(O[0].BalQty=f.GridDataColumns.Contains("QtyUom")?parseFloat(O[0].BalQty)+parseFloat(j.Quantity)*g:parseFloat(O[0].BalQty)+parseFloat(j.Quantity)),o.e.IsEmpty(a.ExtraXML)||((I=new o.f).LoadXml(a.ExtraXML.toString()),(e=I.SelectNodes("xml/Row")).length>0&&null!=e[0].attributes.BatchID.value&&((O=f.GridData.filter((function(t){return t.BatchID==e[0].attributes.BatchID.value}))).length>0&&(O[0].Quantity=null,f.GridDataColumns.Contains("QtyUom")&&(O[0].QtyUom=null)))),a.Quantity=parseFloat(a.Quantity)-1,j.Quantity=parseFloat(j.Quantity)+1,g>1&&(a.UOMConvertedQty=parseFloat(a.Quantity)*g,j.UOMConvertedQty=parseFloat(j.Quantity)*g),a=j,f.BatchQty=parseFloat(a.Quantity)*g,f.drSel=a,"break"}}();if("continue"===P)continue;if("break"===P)break}}}for(var A=0;A<f.GridData.length;A++){if(this.barcodeValues.ContainsKey("Batch_Code")&&o.e.StringValue(f.GridData[A].BatchCode).toString().toLowerCase()==this.barcodeValues.Batch_Code.toString().toLowerCase()){if(!o.e.IsEmpty(f.GridData[A].BalQty)&&!o.e.IsEmpty(f.GridData[A].Quantity)&&parseFloat(f.GridData[A].BalQty.toString())<=parseFloat(f.GridData[A].Quantity.toString()))continue;if(""==o.e.String(f.GridData[A].BalQty)||0==parseFloat(f.GridData[A].BalQty.toString()))continue;f.GridData[A].Quantity=null,f.SelectQty(f.GridData[A]);break}if(this.barcodeValues.ContainsKey("Batch_No")&&o.e.StringValue(f.GridData[A].BATCHNUMBER).toString().toLowerCase()==this.barcodeValues.Batch_No.toString().toLowerCase()){if(!o.e.IsEmpty(f.GridData[A].BalQty)&&!o.e.IsEmpty(f.GridData[A].Quantity)&&parseFloat(f.GridData[A].BalQty.toString())<=parseFloat(f.GridData[A].Quantity.toString()))continue;if(""==o.e.String(f.GridData[A].BalQty)||0==parseFloat(o.e.String(f.GridData[A].BalQty)))continue;f.GridData[A].Quantity=null,f.SelectQty(f.GridData[A]);break}}f.DisplayMessage="",f.OnSave("AutoSaveScan"),""!=f.DisplayMessage&&s.a.page.ShowDialog(f,Ae.a)}else this.CheckandAddBatch(u,a);null!=this.barcodeValues&&this.barcodeValues.Clear()}else if(this.ScreenObject.Preferences.ContainsKey("usetempifnotscanned")&&Object(l.j)(this.ScreenObject.Preferences.usetempifnotscanned)){if(31==this.DocumentType&&this.ScreenObject.GridDataColumns.Contains("BOEID")&&!this.barcodeValues.ContainsKey("INVID"))return void o.e.PlaySound("beep-01.wav");if(!(this.ScreenObject.TempProductID>0))return o.e.PlaySound("beep-01.wav"),void(this.DisplayMessage="Define Temp product");var M;if(i=this.ScreenObject.TempProductID,(M=31==this.DocumentType&&this.ScreenObject.GridDataColumns.Contains("BOEID")&&this.barcodeValues.ContainsKey("INVID")?this.ScreenObject.GridData.filter((function(e){return e.BOEID==t.barcodeValues.INVID})):this.ScreenObject.GridData.filter((function(e){return e.ProductID_Key==i}))).length>0&&M[0]!=a&&(31==this.DocumentType||this.ScreenObject.Preferences.ContainsKey("DuplicateProduct_IncrementQuantity")&&""!=o.e.String(this.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity)&&"True"==o.e.String(this.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity))){var v=1;o.e.IsEmpty(a.Quantity)||(v=parseFloat(a.Quantity)),this.ClearDatarow(a,!0),a=M[0],o.e.IsEmpty(a.Quantity)||(a.Quantity=parseFloat(a.Quantity)+v)}else a.ProductID_Key=i,"0"==this.IsSales?(a.Quantity=-1,this.RowForegroundChange(a)):a.Quantity=1,this.ProdID=0,this.AddProductData(a,!1,!1,!1,null,null);if(this.barcodeValues.ContainsKey("INVID")&&this.ScreenObject.GridDataColumns.Contains("DocExtraXML")&&(a.DocExtraXML='<DocExtraXML><Row RefID="'+this.barcodeValues.INVID+'" Qty="'+a.Quantity.toString()+'" Type="1" ></Row></DocExtraXML>',a.BOEID=this.barcodeValues.INVID.toString(),31!=this.DocumentType)){var G=this.ScreenObject.GetinvBinDetails(this.barcodeValues.INVID.toString(),a.ProductID_Key.toString(),"");null!=G&&G.Tables.length>0&&G.Tables[0].length>0&&this.AddBins(a,!1,!1,G.Tables[0])}}}if(0==i&&(38==this.DocumentType||39==this.DocumentType)){var N=s.a.common.GetDataTable("DOC065",this.SKU.Text);if(!(null!=N&&N.length>0))return this.DisplayMessage="Item not found",void(this.MessageVisibility=!0);if("32"==o.e.String(N[0].StatusID))return this.DisplayMessage="Cannot scan the Inactive item",void(this.MessageVisibility=!0);this.DisplayMessage="",this.MessageVisibility=!1,this.AddProductData(a,!1,!1,!1,null,this.SKU.Text)}o.e.IsEmpty(a.ProductID_Key)||(this.FillScan(a,n),o.e.PlaySound("beep-02.wav"))}if(o.e.IsEmpty(a.ProductID_Key))o.e.PlaySound("beep-01.wav"),this.SKU.Visible&&this.ScreenObject.Preferences.ContainsKey("ShowSearchOnProductNotFound")&&""!=this.ScreenObject.Preferences.ShowSearchOnProductNotFound&&Object(l.j)(this.ScreenObject.Preferences.ShowSearchOnProductNotFound)&&this.onButtonClick("SearchSKU");else{var E=this.ScreenObject.ColumnSource.find((function(e){return!o.e.IsEmpty(e.ValueMember)&&"productid_key"==e.ValueMember.toLowerCase()&&!o.e.IsEmpty(e.Shortcut)&&"lostfocus"==e.Shortcut.toLowerCase()}));E&&this.ValidateData_Column(E,a,!0)&&this.ScreenObject.GetExternalFuncData(E.Mode,E.SPName,E.IPParams,E.OPParams,a),this.PoleDisplayMessage(2,a),this.ScreenObject.GridDataObj.updateRow(a),this.ScreenObject.GridDataObj.refreshDatawithIDs()}}}},{key:"FillScan",value:function(e,t){var n=this;if(this.Setselectedrow(38==this.DocumentType||39==this.DocumentType?t:this.ScreenObject.GridData.indexOf(e)),this.SKU.Text="",this.CalculateTotals(e,!1,"Quantity"),Object(l.j)(this.ScreenObject.Preferences.EnableSchemes)){if(this.ScreenObject.Preferences.ContainsKey("SchemesNumericFields")&&""!=this.ScreenObject.Preferences.SchemesNumericFields&&"0"!=this.ScreenObject.Preferences.SchemesNumericFields){var a=this.ScreenObject.ColumnSource.find((function(e){return e.ID==n.ScreenObject.Preferences.SchemesNumericFields}));a&&""!=a.DisplayMember&&a.DisplayMember}if(o.e.Int(e.ProductID_Key)>0){var i=this.ScreenObject.GetSchemes(this.DocumentDate,e);i.Tables.length>0&&i.Columns[0].Contains("SchemeID")&&this.fillSchemevalues(i.Tables[0],i.Columns[0],e)}this.ApplySchemes(e)}(38==this.DocumentType||39==this.DocumentType)&&this.ScreenObject.Preferences.ContainsKey("DuplicateProduct_IncrementQuantity")&&""!=this.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity&&Object(l.j)(this.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity)&&(this.AddProductQty(e,!1)&&(o.e.IsNum(e.Quantity)&&o.e.IsNum(e.UOMConversion)?e.UOMConvertedQty=parseFloat(e.UOMConversion)*parseFloat(e.Quantity):o.e.IsEmpty(e.Quantity)||(e.UOMConvertedQty=e.Quantity.toString()),this.Celleditend(e,"Quantity",this.CostCenterID),this.ScreenObject.GridDataObj.updateRow(e),this.CalculateTotals(e,!1,"Quantity")),this.SKU.SetFocus=!0)}},{key:"FillPromotions",value:function(e,t){var n=0,a=this.ScreenObject.GridData.Compute("max","MaxSchemeID");null!=a&&(n=o.e.Int(a)),n++,this.ScreenObject.GridData[t].MaxSchemeID=n,this.ScreenObject.GridData[t].IsScheme="N",this.ScreenObject.GridData[t].SchemeID="2",t++;for(var i=0;i<e.length;i++){var r=this.ScreenObject.GridDataObj.NewRow();r.ProductID_Key=e[i].ProductID.toString(),this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(r.ProductCode=e[i].ProductCode.toString()),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(r.ProductName=e[i].ProductName.toString()),this.ScreenObject.GridDataColumns.Contains("UOMID")&&(r.UOM=e[i].UnitName.toString(),r.UOM_Key=e[i].Unit.toString()),r.Type=e[i].ProductTypeID.toString(),r.UOMConversion=e[i].Conversion.toString(),r.Quantity=e[i].Quantity.toString(),r.UOMConvertedQty=o.e.IsNum(e[i].Conversion)?parseFloat(r.UOMConversion)*parseFloat(r.Quantity):"1",r.SchemeID="2",r.MaxSchemeID=n,r.IsScheme="Y",this.ScreenObject.GridData.length>t?this.ScreenObject.GridDataObj.insertRowAt(r,t):this.ScreenObject.GridDataObj.addRow(r)}this.ScreenObject.UpdateSequence()}},{key:"CalcOpRate",value:function(){if(30==this.ScreenObject.DocumentType&&this.ScreenObject.Preferences.ContainsKey("AssembleCalcOPRate")&&Object(l.j)(this.ScreenObject.Preferences.AssembleCalcOPRate)&&this.ScreenObject.GridDataColumns.Contains("IsKit")){var e=this.ScreenObject.GridData.filter((function(e){return 2==e.IsKit})),t=0;e.forEach((function(e){o.e.IsEmpty(e.DefaultQuantity)||o.e.IsEmpty(e.Rate)||(t+=parseFloat(e.DefaultQuantity)*parseFloat(e.Rate))})),(e=this.ScreenObject.GridData.filter((function(e){return 1==e.IsKit}))).length>0&&(e[0].Rate=t,this.CalculateTotals(e[0],!1))}}},{key:"OnKitProductChange",value:function(e){var t=this;if(e instanceof C.b){if(this.ScreenObject.GridDataColumns.Contains("IsKit")&&this.ScreenObject.GridData.filter((function(e){return 1==e.IsKit||2==e.IsKit})).forEach((function(e){t.ScreenObject.GridDataObj.removeRow(e)})),e.SelectedValue>0){var n=!0,a=!1,i=0,r=this.ScreenObject._TextFields.find((function(e){return e.DBColumnID.toString()==t.ScreenObject.Preferences.AssembleType}));r&&r instanceof m.e&&!o.e.IsEmpty(r.SelectedValue)&&"DisAssemble"==r.SelectedValue&&(n=!1),i=(r=this.ScreenObject._TextFields.find((function(e){return e.DBColumnID.toString()==t.ScreenObject.Preferences.AssembleQty})))&&r instanceof h.d&&!o.e.IsEmpty(r.Text)&&o.e.IsNum(r.Text)?parseFloat(r.Text):1,this.ScreenObject.GridDataColumns.Contains("IsKit")||this.ScreenObject.GridDataColumns.push("IsKit");var s=this.ScreenObject.GetProductBundle(e.SelectedValue);null!=s&&s.Tables.length>0&&s.Tables[0].length>0&&s.Columns[0].Contains("KitSize")&&!o.e.IsEmpty(s.Tables[0][0].KitSize)&&(i=parseFloat(s.Tables[0][0].KitSize),a=!0,r&&r instanceof h.d&&(r.Text=i.toString()));for(var c=0,l=0;l<this.ScreenObject.GridData.length;l++)if(o.e.IsEmpty(this.ScreenObject.GridData[l].ProductID_Key)){c=l;break}var u=this.ScreenObject.GridDataObj.NewRow();this.ScreenObject.GridData.InsertAt(u,c),u.ProductID_Key=e.SelectedValue,u.IsKit=1,u.Quantity=i,this.AddProductData(u,!1,!0),u.VoucherType=n?1:-1;var d=1;o.e.IsNum(u.UOMConversion)&&(d=parseFloat(u.UOMConversion)),u.UOMConvertedQty=d*parseFloat(u.Quantity),this.CalculateTotals(u,!1),c++;for(var D=0;D<s.Tables[0].length;D++)u=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridData.InsertAt(u,c+D),u.ProductID_Key=s.Tables[0][D].ProductID,u.LineNarration=s.Tables[0][D].Remarks,o.e.IsEmpty(s.Tables[0][D].Quantity)?a?(u.Quantity=1,u.DefaultQuantity=1/i):(u.Quantity=i,u.DefaultQuantity=1):a?(u.Quantity=s.Tables[0][D].Quantity.toString(),u.DefaultQuantity=parseFloat(s.Tables[0][D].Quantity)/i):(u.Quantity=i*parseFloat(s.Tables[0][D].Quantity),u.DefaultQuantity=s.Tables[0][D].Quantity.toString()),s.Columns[0].Contains("unit")&&!o.e.IsEmpty(s.Tables[0][D].unit)&&(u.Unit_Key=s.Tables[0][D].unit.toString(),u.Unit=s.Tables[0][D].UnitName.toString()),u.LineNarration=s.Tables[0][D].Remarks,this.AddProductData(u,!1,!0),o.e.IsNum(u.UOMConversion)&&(d=parseFloat(u.UOMConversion)),u.UOMConvertedQty=d*parseFloat(u.Quantity),u.VoucherType=n?-1:1,u.IsKit=2,this.CalculateTotals(u,!1);this.ScreenObject.UpdateSequence(),this.RefreshGrid=!this.RefreshGrid}e instanceof y.c&&!o.e.IsEmpty(e.KeyTip)&&"lostfocus"==e.KeyTip.toLowerCase()&&this.ValidateData(e,!0)&&this.ScreenObject.GetExternalFuncData(e.Mode,e.ToolTipFooterTitle,e.ToolTipFooterDescription,e.ToolTipDescription,null)}}},{key:"onTypeChange",value:function(e){var t=this;if(null!=this.ScreenObject){var n=!0,a=this.ScreenObject._TextFields.find((function(e){return e.DBColumnID.toString()==t.ScreenObject.Preferences.AssembleType}));if(a&&a instanceof m.e&&!o.e.IsEmpty(a.SelectedValue)&&"DisAssemble"==a.SelectedValue&&(n=!1),this.ScreenObject.GridDataColumns.Contains("IsKit")){var i=this.ScreenObject.GridData.filter((function(e){return 1==e.IsKit}));i.length>0&&(i[0].VoucherType=n?1:-1,(i=this.ScreenObject.GridData.filter((function(e){return 2==e.IsKit}))).forEach((function(e){e.VoucherType=n?-1:1})))}}}},{key:"LoadGradeData",value:function(e,t,n){var a="";if(0==e||2==e){if([],this.dtData=null,null==this.ScreenObject)return;if(this.DocID>0)return;if(o.e.IsEmpty(n))return;Logger.InfoLog("AssignLeavesViewModel::Start Loading Grade data"),s.a.SessionManager.Preferences.ContainsKey("AssignLeavesFilter")&&"True"==s.a.SessionManager.Preferences.AssignLeavesFilter.toString()&&(a=this.PopupEmployeesFilter(n+"~"+t,"LoadGradeData")),this.LoadGradeDataTemp(a,n+"~"+t)}else if(1==e){if(o.e.IsEmpty(n))return;var i=[],r=this.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()}));r&&r instanceof m.e&&(r.IsReadOnly=!0),(r=this.ScreenObject._CCFields.find((function(e){return"dcccnid2"==e.DBColumnName.toLowerCase()})))&&r instanceof C.b&&(r.Enable=!1);var c=this.ScreenObject.ColumnSource.find((function(e){return 50051==e.CostCenterID})),l=this.ScreenObject.ColumnSource.find((function(e){return 50053==e.CostCenterID}));c&&c instanceof f.a&&("EmployeeWise"==n?(c.IsVisible=!0,l.IsVisible=!1):(l.IsVisible=!0,c.IsVisible=!1)),i=this.ScreenObject.GridData,null!=this.dtData&&this.dtData.length>0&&i.AddRange(this.dtData),"GradeWise"==n?(i=this.ScreenObject.GridData.filter((function(e){return 1!=e.dcCCNID51_Key})),this.dtData=i.Copy(),i=(i=this.ScreenObject.GridData.filter((function(e){return 1==e.dcCCNID51_Key}))).Copy()):"EmployeeWise"==n&&(i=this.ScreenObject.GridData.filter((function(e){return 1==e.dcCCNID51_Key})),this.dtData=i.Copy(),i=(i=this.ScreenObject.GridData.filter((function(e){return 1!=e.dcCCNID51_Key}))).Copy()),i.length>0&&(this.ScreenObject.GridDataObj.Clear(),this.ScreenObject.GridDataObj.ClearFilters(),this.ScreenObject.GridDataObj.addRows(i)),this.ScreenObject.UpdateSequence(),this.RefreshGrid=!0}this.ScreenObject.GridDataObj.RefreshColumns()}},{key:"LoadLeaveyearDates",value:function(e){var t=new Date(e,parseInt(s.a.SessionManager.Preferences.LeaveYear),1),n=this.ScreenObject._TextFields.find((function(e){return"dcalpha3"==e.DBColumnName.toLowerCase()}));n&&n instanceof S.c&&(n.Date=new Date(t.ToString("dd/MMM/yyyy"))),t=(t=t.AddMonths(12)).AddDays(-t.getDate()),(n=this.ScreenObject._TextFields.find((function(e){return"dcalpha4"==e.DBColumnName.toLowerCase()})))&&n instanceof S.c&&(n.Date=new Date(t.ToString("dd/MMM/yyyy")))}},{key:"OnChequeBookSelection",value:function(e){var t=this;if(!o.e.IsEmpty(this.ChequeBook.SelectedValue)&&null!=this.ScreenObject){if(this.ScreenObject.Preferences.ContainsKey("AutoChequeonPost")&&"True"==this.ScreenObject.Preferences.AutoChequeonPost)return;var n=0;null!=this.ScreenObject.CreditAccount&&(n=this.ScreenObject.CreditAccount.SelectedValue),this.ScreenObject.HeaderFields.forEach((function(e){e instanceof h.d&&"ChequeNumber"==e.DBColumnName&&0==t.ScreenObject.ChequeBookChecking&&(e.Text=s.a.document.GetChequeNumbers(n,t.ChequeBook.SelectedValue))}))}}},{key:"OnSearchDocument",value:function(e){var t=this;if((null==this.ScreenObject.Link.LinkCombo.SelectedItem||null==this.ScreenObject.Link.LinkCombo.SelectedItem)&&o.e.Int(this.ScreenObject.Link.LinkCombo.SelectedValue)>0&&(this.ScreenObject.Link.LinkCombo.SelectedItem=this.ScreenObject.Link.LinkCombo.Items.find((function(e){return e.Value==t.ScreenObject.Link.LinkCombo.SelectedValue}))),null!=this.ScreenObject.Link.LinkCombo.SelectedItem&&null!=this.ScreenObject.Link.LinkCombo.SelectedItem){var n="",a="",i="",r="";s.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==s.a.SessionManager.Preferences.EnableLocationWise.toString()&&s.a.SessionManager.Preferences.ContainsKey("LocationWiseLinking")&&"True"==s.a.SessionManager.Preferences.LocationWiseLinking.toString()&&(this.ScreenObject.LocationID>0?a=this.ScreenObject.LocationID.toString():s.a.SessionManager.LocationID>0&&(a=s.a.SessionManager.LocationID.toString())),s.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==s.a.SessionManager.Preferences.EnableDivisionWise.toString()&&s.a.SessionManager.Preferences.ContainsKey("DivisionWiseLinking")&&"True"==s.a.SessionManager.Preferences.DivisionWiseLinking.toString()&&(this.ScreenObject.DivisionID>0?i=this.ScreenObject.DivisionID.toString():s.a.SessionManager.DivisionID>0&&(i=s.a.SessionManager.DivisionID.toString())),this.ScreenObject.DueDate&&this.ScreenObject.DueDate.Date&&(n=this.ScreenObject.DueDate.Date.ToString("dd/MMM/yyyy")),this.ScreenObject.Preferences.ContainsKey("DimensionWise")&&""!=this.ScreenObject.Preferences.DimensionWise&&this.ScreenObject.Preferences.DimensionWise.split(",").forEach((function(e){if(""!=e)for(var n=parseInt(e),a=0;a<t.ScreenObject._CCFields.length;a++){var i=t.ScreenObject._CCFields[a];if(i instanceof C.b&&i.CCID==n){r+=i.SelectedValue>0?" and DCM.dcCCNID"+(n-5e4).toString()+"="+i.SelectedValue.toString():" and DCM.dcCCNID"+(n-5e4).toString()+"=0";break}}}));var c,u=this.ScreenObject.Data.Tables[6].filter((function(e){return e.DocumentLinkDefID==t.ScreenObject.Link.LinkCombo.SelectedValue}));c=u.length>0&&this.ScreenObject.Data.Columns[6].Contains("syscolumnname")&&u[0].syscolumnname.toString().toLowerCase().Contains("dcnum")?" d.":" a.";var d=0;u.length>0&&this.ScreenObject.Data.Columns[6].Contains("DocumentType")&&!o.e.IsEmpty(u[0].DocumentType)&&(d=parseInt(u[0].DocumentType.toString())),(6==this.ScreenObject.DocumentType||10==this.ScreenObject.DocumentType||39==this.ScreenObject.DocumentType)&&6!=d&&10!=d&&39!=d||(6==d||10==d||39==d)&&6!=this.ScreenObject.DocumentType&&10!=this.ScreenObject.DocumentType&&39!=this.ScreenObject.DocumentType?(this.ScreenObject.Preferences.ContainsKey("Debit Account")&&Object(l.j)(this.ScreenObject.Preferences["Debit Account"])&&null!=this.ScreenObject.DebitAccount&&(r+=this.ScreenObject.DebitAccount.SelectedValue>0?" and "+c+"CreditAccount="+this.ScreenObject.DebitAccount.SelectedValue.toString():" and "+c+"CreditAccount=0"),this.ScreenObject.Preferences.ContainsKey("Credit Account")&&Object(l.j)(this.ScreenObject.Preferences["Credit Account"])&&null!=this.ScreenObject.CreditAccount&&(r+=this.ScreenObject.CreditAccount.SelectedValue>0?" and "+c+"DebitAccount="+this.ScreenObject.CreditAccount.SelectedValue.toString():" and "+c+"DebitAccount=0")):(this.ScreenObject.Preferences.ContainsKey("Debit Account")&&Object(l.j)(this.ScreenObject.Preferences["Debit Account"])&&null!=this.ScreenObject.DebitAccount&&(r+=this.ScreenObject.DebitAccount.SelectedValue>0?" and "+c+"DebitAccount="+this.ScreenObject.DebitAccount.SelectedValue.toString():" and "+c+"DebitAccount=0"),this.ScreenObject.Preferences.ContainsKey("Credit Account")&&Object(l.j)(this.ScreenObject.Preferences["Credit Account"])&&null!=this.ScreenObject.CreditAccount&&(r+=this.ScreenObject.CreditAccount.SelectedValue>0?" and "+c+"CreditAccount="+this.ScreenObject.CreditAccount.SelectedValue.toString():" and "+c+"CreditAccount=0")),this.ScreenObject.Preferences.ContainsKey("LinkVendorProducts")&&Object(l.j)(this.ScreenObject.Preferences.LinkVendorProducts)&&(this.ScreenObject.IsPurchase&&null!=this.ScreenObject.CreditAccount?r+=" join INV_ProductVendors PV WITH(NOLOCK) ON p.ProductID=pv.ProductID and pv.AccountID="+this.ScreenObject.CreditAccount.SelectedValue:this.ScreenObject.IsPurchase||null==this.ScreenObject.DebitAccount||(r+=" join INV_ProductVendors PV WITH(NOLOCK) ON p.ProductID=pv.ProductID and pv.AccountID="+this.ScreenObject.DebitAccount.SelectedValue));var D="";if(null!=this.ScreenObject.Link.DocumentList&&this.ScreenObject.Link.DocumentList.Items.forEach((function(e){e.IsChecked&&(D+=e.Value+",")})),"Link"==e.toString()){var h=new mt.a;h.SearchDocumentViewModel_1(this,this.ScreenObject.Link.LinkCombo.SelectedItem.Value,this.ScreenObject.Link.LinkCombo.SelectedItem.Parent,this.DocumentDate,n,a,i,r,D,!0),s.a.page.ShowDialog(h,St.a,{HideHeader:!0})}else{var S=new mt.a;S.SearchDocumentViewModel_1(this,this.ScreenObject.Link.LinkCombo.SelectedItem.Value,this.ScreenObject.Link.LinkCombo.SelectedItem.Parent,this.DocumentDate,n,a,i,r,D,!1),s.a.page.ShowDialog(S,St.a,{HideHeader:!0})}}}},{key:"GetWorkFlow",value:function(e,t){var n=this;if(e){if(this.ScreenObject.Data.Tables.length<=1||this.ScreenObject.Data.Tables.length>1&&this.ScreenObject.Data.Tables[1].length<1)return 0}else if(this.ScreenObject.Data.Tables.length<=9||this.ScreenObject.Data.Tables.length>9&&this.ScreenObject.Data.Tables[9].length<1)return 0;if(this.ScheduleID>0&&!this.ScreenObject.IsPostRecurDocumentWithApproval(this.RecurDocumentVoucherNo))return 0;if(null!=this.commandprarameter&&("NoWorkFlow"==this.commandprarameter||"NoWorkFlowReSave"==this.commandprarameter||"NoWorkFlowprint"==this.commandprarameter))return 0;if(this.ScreenObject.Preferences.ContainsKey("NoWorkflowPostedDocs")&&""!=this.ScreenObject.Preferences.NoWorkflowPostedDocs&&Object(l.j)(this.ScreenObject.Preferences.NoWorkflowPostedDocs)&&!this.LineWiseApproval&&369==this.StatusID)return 0;var a=this.WorkFlowDocLevel;if(this.LineWiseApproval||369!=this.StatusID&&370!=this.StatusID||(a=0),null!=t&&(a=0,o.e.IsEmpty(t.WorkFlowLevel)||"369"==t.StatusID.toString()||(a=parseInt(t.WorkFlowLevel)),this.FillDictionary(t,!1)),this.FooterDics.keys.forEach((function(e){var t=e,a=n.ScreenObject.ColumnSource.find((function(e){return e.lbl==n.FooterDics[t].getFieldName()}));if(a)if("FLOAT"!=a.DataType)n.FooterDics[t].setFieldValue(n.fldDict[t].getFieldResult());else{for(var i=0,r=0;r<n.ScreenObject.GridData.length;r++){var c=1;s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&(null==n.Currency||o.e.IsEmpty(n.Currency.ExchangeRate.Text)?n.ScreenObject.GridDataColumns.Contains("ExchangeRate")&&!o.e.IsEmpty(n.ScreenObject.GridData[r].ExchangeRate)&&(c=parseFloat(n.ScreenObject.GridData[r].ExchangeRate)):c=parseFloat(n.Currency.ExchangeRate.Text)),a.DisplayMember.toLowerCase().Contains("dcnum")&&("-2"==a.DefaultValue&&(c=n.ScreenObject.GridDataColumns.Contains(a.DisplayMember.toLowerCase().replace("dcnum","dcExchRT"))&&!o.e.IsEmpty(n.ScreenObject.GridData[r][a.DisplayMember.toLowerCase().replace("dcnum","dcExchRT")])?parseFloat(n.ScreenObject.GridData[r][a.DisplayMember.toLowerCase().replace("dcnum","dcExchRT")]):1),o.e.Int(a.DefaultValue)>0&&(c=a.CurrID>0?a.ExhcgRt:1)),"Quantity"==a.DisplayMember?o.e.IsEmpty(n.ScreenObject.GridData[r].UOMConvertedQty)||(i+=parseFloat(n.ScreenObject.GridData[r].UOMConvertedQty)):a.IsColumnUserDefined||"FLOAT"!=a.DataType?a.DisplayMember.Contains("dcNum")&&(o.e.IsEmpty(n.ScreenObject.GridData[r]["dcCalc"+a.DisplayMember])||(i+=parseFloat(n.ScreenObject.GridData[r]["dcCalc"+a.DisplayMember])*c)):o.e.IsEmpty(n.ScreenObject.GridData[r][a.DisplayMember])||(i+=parseFloat(n.ScreenObject.GridData[r][a.DisplayMember])*c)}n.FooterDics[t].setFieldValue(i)}else n.FooterDics[t].setFieldValue(0)})),this.ScreenObject._TextFields.forEach((function(e){n.FooterDics.ContainsKey(e.Lbl)&&(e instanceof h.d?"FLOAT"==e.DataType?null!=e.Text&&""!=e.Text&&""==e.ValidateData()?n.FooterDics[e.Lbl].setFieldValue(e.Text):n.FooterDics[e.Lbl].setFieldValue(0):n.FooterDics[e.Lbl].setFieldValue(e.Text):e instanceof m.e?n.FooterDics[e.Lbl].setFieldValue(e.SelectedValue):e instanceof O.a?n.FooterDics[e.Lbl].setFieldValue(e.Text):e instanceof C.b?e.SelectedValue>0&&!o.e.IsEmpty(e.Text)?n.FooterDics[e.Lbl].setFieldValue(e.Text):n.FooterDics[e.Lbl].setFieldValue(""):e instanceof p.a&&(e.SelectedValue>0?e.Code.Visible&&!o.e.IsEmpty(e.Code.Text)?n.FooterDics[e.Lbl].setFieldValue(e.Code.Text):e.Name.Visible&&!o.e.IsEmpty(e.Name.Text)&&n.FooterDics[e.Lbl].setFieldValue(e.Name.Text):n.FooterDics[e.Lbl].setFieldValue("")))})),this.ScreenObject._CCFields.forEach((function(e){n.FooterDics.ContainsKey(e.Lbl)&&(e instanceof C.b&&e.SelectedValue>0&&!o.e.IsEmpty(e.Text)?n.FooterDics[e.Lbl].setFieldValue(e.Text):n.FooterDics[e.Lbl].setFieldValue(""))})),this.ScreenObject.HeaderFields.forEach((function(e){e instanceof y.c&&!o.e.IsEmpty(e.Lbl)&&n.FooterDics.ContainsKey(e.Lbl)&&(e instanceof h.d?"FLOAT"!=e.DataType||!o.e.IsEmpty(e.Text)&&""==e.ValidateData()?n.FooterDics[e.Lbl].setFieldValue(e.Text):n.FooterDics[e.Lbl].setFieldValue(0):e instanceof m.e?n.FooterDics[e.Lbl].setFieldValue(e.SelectedValue):e instanceof O.a?n.FooterDics[e.Lbl].setFieldValue(e.Text):e instanceof S.c&&e.Date?n.FooterDics[e.Lbl].setFieldValue(e.Date):e instanceof C.b&&(e.SelectedValue>0&&!o.e.IsEmpty(e.Text)?n.FooterDics[e.Lbl].setFieldValue(e.Text):n.FooterDics[e.Lbl].setFieldValue("")))})),this.IsInventoryVoucher){var i=this.ScreenObject.ColumnSource.find((function(e){return"Rate"==e.DisplayMember}));i&&!o.e.IsEmpty(i.footer)?this.FooterDics.RATE.setFieldValue(i.footer):this.FooterDics.RATE.setFieldValue(0),(i=this.ScreenObject.ColumnSource.find((function(e){return"Quantity"==e.DisplayMember})))&&!o.e.IsEmpty(i.footer)?this.FooterDics.QTY.setFieldValue(i.footer):this.FooterDics.QTY.setFieldValue(0),(i=this.ScreenObject.ColumnSource.find((function(e){return"Gross"==e.DisplayMember})))&&!o.e.IsEmpty(i.footer)?this.FooterDics.GROSS.setFieldValue(i.footer):this.FooterDics.GROSS.setFieldValue(0),this.FooterDics.NET.setFieldValue(this.NetAmount)}var r=null,c=null;(c=(e?this.ScreenObject.Data.Tables[1]:this.ScreenObject.Data.Tables[9]).filter(this.ScreenObject.IsDocEdit?function(e){return 2==e.Action||6==e.Action}:function(e){return 1==e.Action||6==e.Action})).sort((function(e,t){return e.LevelID-t.LevelID}));for(var u=!1,d=0;d<c.length;d++)if(!(a>0&&!o.e.IsEmpty(c[d].LevelID)&&parseInt(c[d].LevelID)<a)&&(!(!this.LineWiseApproval&&a>0&&this.WfID>0)||o.e.IsEmpty(c[d].WorkFlowID)||parseInt(c[d].WorkFlowID)==this.WfID)&&(null==t||!this.ScreenObject.GridDataColumns.Contains("WorkFlowID")||o.e.IsEmpty(t.WorkFlowID)||"0"==t.WorkFlowID.toString()||t.WorkFlowID.toString()==c[d].WorkFlowID.toString())){if(o.e.IsNullOrWhiteSpace(c[d].Expression))return parseInt(c[d].WorkFlowID);if(u=!o.e.IsNullOrWhiteSpace(c[d].IsExpressionLineWise)&&Object(l.j)(c[d].IsExpressionLineWise),null!=c[d].Expression&&""!=c[d].Expression.toString()&&c[d].Expression.toString().Contains("ServerDate")){var D=s.a.common.GetDataTable("DOC068","");null!=this.FooterDics.ServerDate&&this.FooterDics.ServerDate.setFieldValue(new Date(D[0].ServerDate).Date()),null!=this.fldDict.ServerDate&&this.fldDict.ServerDate.setFieldValue(new Date(D[0].ServerDate).Date())}if(null!=c[d].Expression&&""!=c[d].Expression.toString()&&c[d].Expression.toString().Contains("DOCDATE")&&(null!=this.FooterDics.DOCDATE&&this.FooterDics.DOCDATE.setFieldValue(this.DocumentDate.Date()),null!=this.fldDict.DOCDATE&&this.fldDict.DOCDATE.setFieldValue(this.DocumentDate.Date())),u){if(null==t){for(var b=this.GetPrimaryColName(),g=0;g<this.ScreenObject.GridData.length;g++)if(!o.e.IsEmpty(this.ScreenObject.GridData[g][b])){this.FillDictionary(this.ScreenObject.GridData[g],!1),r=this.fldDict;var f=s.a.eval.EvaluateExpression(c[d].Expression.toString(),r);if(null!=f&&"1"==f.toString())return parseInt(c[d].WorkFlowID)}return 0}r=this.fldDict}else r=this.FooterDics;try{var I=s.a.eval.EvaluateExpression(c[d].Expression.toString(),r);if(null!=I&&"1"==I.toString())return parseInt(c[d].WorkFlowID)}catch(G){}}if(null!=t&&(s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Posted Docs")||s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Approved Docs")))for(var T=0;T<c.length;T++){if(""==c[T].Expression.toString().trim())return parseInt(c[T].WorkFlowID);if(u=""!=c[T].IsExpressionLineWise.toString().trim()&&Object(l.j)(c[T].IsExpressionLineWise),null!=c[T].Expression&&""!=c[T].Expression.toString()&&c[T].Expression.toString().Contains("ServerDate")){var j=s.a.common.GetDataTable("DOC068","");null!=this.FooterDics.ServerDate&&this.FooterDics.ServerDate.setFieldValue(new Date(j[0].ServerDate).Date),null!=this.fldDict.ServerDate&&this.fldDict.ServerDate.setFieldValue(new Date(j[0].ServerDate).Date)}if(null!=c[T].Expression&&""!=c[T].Expression.toString()&&c[T].Expression.toString().Contains("DOCDATE")&&(null!=this.FooterDics.DOCDATE&&this.FooterDics.DOCDATE.setFieldValue(this.DocumentDate.Date),null!=this.fldDict.DOCDATE&&this.fldDict.DOCDATE.setFieldValue(this.DocumentDate.Date)),u){if(null==t){for(var P=this.GetPrimaryColName(),A=0;A<this.ScreenObject.GridData.length;A++)if(!o.e.IsEmpty(this.ScreenObject.GridData[A][P])){this.FillDictionary(this.ScreenObject.GridData[A],!1),r=this.fldDict;var M=s.a.eval.EvaluateExpression(c[T].Expression.toString(),r);if(null!=M&&"1"==M.toString())return parseInt(c[T].WorkFlowID)}return 0}r=this.fldDict}else r=this.FooterDics;try{var v=s.a.eval.EvaluateExpression(c[T].Expression.toString(),r);if(null!=v&&"1"==v.toString())return parseInt(c[T].WorkFlowID)}catch(G){}}return 0}},{key:"GetRowValue",value:function(e,t,n){this.ScreenObject.Preferences.ContainsKey("PosPaymentTypeFld")&&this.ScreenObject.Preferences.PosPaymentTypeFld==this.ScreenObject.ColumnSource[n].ID?e.sbText+=this.ScreenObject.ColumnSource[n].DisplayMember+"=N'"+o.e.String(this.ScreenObject.GridData[t].FieldType)+"', ":"SELECTIONBOX"==this.ScreenObject.ColumnSource[n].DataType&&null!=this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[n].DisplayMember]?e.sbText+=this.savebulk?this.ScreenObject.ColumnSource[n].DisplayMember+'="'+h.d.GetValidXml(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[n].DisplayMember])+'" ':this.ScreenObject.ColumnSource[n].DisplayMember+"=N'"+h.d.GetValidTextXml(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[n].DisplayMember])+"', ":"DATE"!=this.ScreenObject.ColumnSource[n].DataType||o.e.IsEmpty(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[n].DisplayMember+"_Key"])?"DATETIME"!=this.ScreenObject.ColumnSource[n].DataType&&"TIME"!=this.ScreenObject.ColumnSource[n].DataType||""==o.e.String(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[n].DisplayMember+"_Key"])?"Time2"==this.ScreenObject.ColumnSource[n].DataType&&""!=o.e.String(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[n].DisplayMember+"_Key"])?e.sbText+=this.ScreenObject.ColumnSource[n].DisplayMember+"=N'"+new Date(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[n].DisplayMember+"_Key"]).ToString("dd/MMM/yyyy HH:mm")+"', ":"ComboBox"==this.ScreenObject.ColumnSource[n].DataType?e.sbText+=this.savebulk?this.ScreenObject.ColumnSource[n].ValueBinding+'="'+h.d.GetValidXml(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[n].ValueBinding])+'" ':this.ScreenObject.ColumnSource[n].ValueBinding+"=N'"+h.d.GetValidTextXml(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[n].ValueBinding])+"', ":"PactComboBox"==this.ScreenObject.ColumnSource[n].DataType?e.sbText+=68==this.DocumentType||70==this.DocumentType||80==this.DocumentType?this.ScreenObject.ColumnSource[n].ValueBinding+"=N'"+h.d.GetValidTextXml(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[n].ValueBinding])+"', ":this.savebulk?this.ScreenObject.ColumnSource[n].ValueBinding+'="'+h.d.GetValidXml(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[n].ValueBinding+"_Key"])+'" ':this.ScreenObject.ColumnSource[n].ValueBinding+"=N'"+h.d.GetValidTextXml(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[n].ValueBinding+"_Key"])+"', ":"LISTBOX"==this.ScreenObject.ColumnSource[n].DataType&&0!=this.ScreenObject.ColumnSource[n].CostCenterID&&this.ScreenObject.ColumnSource[n].DisplayMember.toLowerCase().Contains("alpha")?e.sbText+=this.savebulk?this.ScreenObject.ColumnSource[n].DisplayMember+'="'+o.e.String(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[n].ValueMember])+'" ':this.ScreenObject.ColumnSource[n].DisplayMember+"=N'"+o.e.String(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[n].ValueMember])+"', ":"CheckBox"==this.ColumnSource[n].DataType?"True"==o.e.String(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[n].DisplayMember])?e.sbText+=this.ScreenObject.ColumnSource[n].DisplayMember+"=N'True',":e.sbText+=this.ScreenObject.ColumnSource[n].DisplayMember+"=N'False',":"textblock"==this.ScreenObject.ColumnSource[n].DataType.toLowerCase()||"text"==this.ScreenObject.ColumnSource[n].DataType.toLowerCase()||"float"==this.ScreenObject.ColumnSource[n].DataType.toLowerCase()||"int"==this.ScreenObject.ColumnSource[n].DataType.toLowerCase()||o.e.IsEmpty(this.ScreenObject.ColumnSource[n].DataType)?e.sbText+=this.savebulk?this.ScreenObject.ColumnSource[n].DisplayMember+'="'+h.d.GetValidXml(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[n].DisplayMember])+'" ':89!=this.ScreenObject.DocumentType&&90!=this.ScreenObject.DocumentType||!(this.isCheckIn&&"dcAlpha9"==this.ScreenObject.ColumnSource[n].DisplayMember||this.isCheckOut&&"dcAlpha19"==this.ScreenObject.ColumnSource[n].DisplayMember)?this.ScreenObject.ColumnSource[n].DisplayMember+"=N'"+h.d.GetValidTextXml(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[n].DisplayMember])+"', ":this.ScreenObject.ColumnSource[n].DisplayMember+"=N'WEBIP',":this.savebulk||(e.sbText+=this.ScreenObject.ColumnSource[n].DisplayMember+"=NULL,"):e.sbText+=this.savebulk?this.ScreenObject.ColumnSource[n].DisplayMember+'="'+new Date(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[n].DisplayMember+"_Key"]).ToString("dd/MMM/yyyy hh:mm:ss a")+'" ':this.ScreenObject.ColumnSource[n].DisplayMember+"=N'"+new Date(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[n].DisplayMember+"_Key"]).ToString("dd/MMM/yyyy hh:mm:ss a")+"', ":55==this.DocumentType&&"dcalpha1"==this.ScreenObject.ColumnSource[n].DisplayMember.toLowerCase()||56==this.DocumentType&&"dcalpha5"==this.ScreenObject.ColumnSource[n].DisplayMember.toLowerCase()?e.sbText+=this.ScreenObject.ColumnSource[n].DisplayMember+"=N'"+new Date(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[n].DisplayMember+"_Key"]).ToString("01/MMM/yyyy")+"', ":e.sbText+=this.savebulk?this.ScreenObject.ColumnSource[n].DisplayMember+'="'+new Date(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[n].DisplayMember+"_Key"]).ToString("dd/MMM/yyyy")+'" ':this.ScreenObject.ColumnSource[n].DisplayMember+"=N'"+new Date(this.ScreenObject.GridData[t][this.ScreenObject.ColumnSource[n].DisplayMember+"_Key"]).ToString("dd/MMM/yyyy")+"', "}},{key:"DistributeInstallments",value:function(e){var t=this;try{var n=0,a=0,i=1,r=0,c=1,l=0,u=this.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()}));if(u&&u instanceof h.d&&!o.e.IsEmpty(u.Text)&&""==u.ValidateData()&&(n=parseFloat(u.Text)),0==n&&((u=this.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()})))&&u instanceof h.d&&!o.e.IsEmpty(u.Text)&&""==u.ValidateData()&&(n=parseFloat(u.Text))),n>0){(u=this.ScreenObject._TextFields.find((function(e){return"dcalpha3"==e.DBColumnName.toLowerCase()})))&&u instanceof h.d&&!o.e.IsEmpty(u.Text)&&""==u.ValidateData()&&parseFloat(u.Text)>0?(a=parseFloat(u.Text),i=parseInt(n/a),(c=parseFloat(n/a))>i&&c-i>.01&&i++,(u=this.ScreenObject._TextFields.find((function(e){return"dcalpha4"==e.DBColumnName.toLowerCase()}))).Text=i.toString()):(u=this.ScreenObject._TextFields.find((function(e){return"dcalpha4"==e.DBColumnName.toLowerCase()})))&&u instanceof h.d&&!o.e.IsEmpty(u.Text)&&""==u.ValidateData()&&parseInt(u.Text)>0&&(i=parseInt(u.Text),a=parseFloat(n/i),(u=this.ScreenObject._TextFields.find((function(e){return"dcalpha3"==e.DBColumnName.toLowerCase()}))).Text=a.toString()),0==a&&(a=n);var d=this.ScreenObject.ColumnSource.find((function(e){return null!=e.DisplayMember&&"dcnum2"==e.DisplayMember.toLowerCase()}));if(d){var D=o.e.Int(d.DecimalPoints);a=parseFloat(a.ToString("N"+D))}(u=this.ScreenObject._TextFields.find((function(e){return"dcalpha3"==e.DBColumnName.toLowerCase()})))&&u instanceof h.d&&(u.Text=a.toString()),(u=this.ScreenObject._TextFields.find((function(e){return"dcalpha4"==e.DBColumnName.toLowerCase()})))&&u instanceof h.d&&(u.Text=i.toString());var m=null,b=new Date,C=this.ScreenObject.ColumnSource.find((function(e){return null!=e.ValueMember&&"productid_key"==e.ValueMember.toLowerCase()}));if(C&&C.DefaultValueText&&o.e.IsNum(C.DefaultValue)&&(m=C.DefaultValueText.split("\x11")),a>n)return void(this.DisplayMessage="Installment amount should be less than or equal to approved amount");if((u=this.ScreenObject._TextFields.find((function(e){return"dcalpha5"==e.DBColumnName.toLowerCase()})))instanceof S.c){if(!u.Date)return void(this.DisplayMessage=s.a.GetResource("Select")+" "+u.Label);""==e?(b=new Date(parseInt(u.Date.ToString("yyyy")),parseInt(u.Date.ToString("MM"))-1,1),u.Date=b):b=u.Date}else b=this.DocumentDate;var y="";this.IsInventoryVoucher&&(y="ProductID_Key");var p="",g="",f="",O=this.ScreenObject.GridData.filter((function(e){return!o.e.IsEmpty(e.ProductName)}));O.length>0&&O.forEach((function(e){""!=p||o.e.IsEmpty(e.LinkedInvDocDetailsID)||(p=e.LinkedInvDocDetailsID.toString(),o.e.IsEmpty(e.LinkedFieldName)||(g=e.LinkedFieldName.toString()),o.e.IsEmpty(e.RefNo)||(f=e.RefNo.toString())),t.ScreenObject.GridDataObj.removeRow(e)}));for(var I=10;I<=i;I++){var T=this.ScreenObject.GridDataObj.NewRow();T.DocSeqNo=this.ScreenObject.GridData.length+1,T.DocDetailsID=0,this.ScreenObject.GridDataObj.addRow(T)}for(var j=0;j<i;j++){var P=this.GetEmptyRowPosition(this.ScreenObject.GridDataObj,y);C&&null!=m&&m.length>0&&(this.ScreenObject.GridData[P].ProductID_Key=C.DefaultValue,this.ScreenObject.GridDataColumns.Contains("ProductCode")&&m.length>1&&(this.ScreenObject.GridData[P].ProductCode=m[1]),this.ScreenObject.GridDataColumns.Contains("ProductName")&&m.length>0&&(this.ScreenObject.GridData[P].ProductName=m[0])),""!=p&&(this.ScreenObject.GridData[P].LinkedInvDocDetailsID=p),""!=g&&(this.ScreenObject.GridData[P].LinkedFieldName=g),""!=f&&(this.ScreenObject.GridData[P].RefNo=f),this.ScreenObject.GridDataColumns.Contains("dcAlpha6_Key")&&(this.ScreenObject.GridData[P].dcAlpha6_Key=b,this.ScreenObject.GridData[P].dcAlpha6=b.ToString(s.a.SessionManager.Preferences["Date Format"])),this.ScreenObject.GridDataColumns.Contains("dcNum1")&&(this.ScreenObject.GridData[P].dcNum1=j+1),l=0,this.ScreenObject.GridDataColumns.Contains("dcNum2")&&(this.ScreenObject.GridData[P].dcNum2=j+1==i?n-r:a,l=parseFloat(this.ScreenObject.GridData[P].dcNum2)),this.ScreenObject.GridDataObj.updateRow(this.ScreenObject.GridData[P]),this.CalculateTotals(this.ScreenObject.GridData[P],!1),r+=l,""==e||"monthly"==e?b=b.AddMonths(1):"daily"==e?b=b.AddDays(1):"weekly"==e?b=b.AddDays(7):"quarterly"==e?b=b.AddMonths(3):"halfyearly"==e?b=b.AddMonths(6):"yearly"==e&&(b=b.AddYears(1))}}else this.DisplayMessage=u?u.Label+" should not be empty":"Loan amount should not be empty"}catch(A){Logger.ErrorLog("AddEditDocumentViewModel::"+A.stack,"DistributeInstallments",A)}}},{key:"SaveInventoryDocument_1",value:function(e){if(this.IgnoreOnSave.Clear(),this.ButtonsEnabled&&(null==e||"Approve"==e.toString()||"ApproveandPrint"==e.toString()||"CheckoutSave"==e.toString()||"CheckoutPrint"==e.toString()||"NoWorkFlow"==e.toString()||"NoWorkFlowprint"==e.toString()||this.IsPOs&&"SaveonHold"==e.toString()||this.ButtonRevise.Visible&&"Revise"==e.toString()||this.ButtonSave.Visible&&this.ButtonSave.Enable))if(this.ScreenObject.Preferences.ContainsKey("NoWorkflowPostedDocs")&&""!=this.ScreenObject.Preferences.NoWorkflowPostedDocs&&Object(l.j)(this.ScreenObject.Preferences.NoWorkflowPostedDocs)&&369==this.StatusID&&"Save"==e.toString()&&!this.LineWiseApproval&&(e="NoWorkFlow"),0==this.ScreenObject.RefNodeID||86==this.ScreenObject.RefCCId||73==this.ScreenObject.RefCCId||89==this.ScreenObject.RefCCId||s.a.SessionManager.IsActionAssigned(43,"Edit Reference Documents"))if(this.ScreenObject.DocID>0&&this.IsUserLock)this.DisplayMessage="Document is Locked";else if(56!=this.ScreenObject.DocumentType||!this.LoanGuaranteeVisible||null!=this.dtLoanGuarantees&&0!=this.dtLoanGuarantees.length){if(this.ScreenObject.Preferences.ContainsKey("Linksingledoc")&&""!=this.ScreenObject.Preferences.Linksingledoc&&Object(l.j)(this.ScreenObject.Preferences.Linksingledoc)){var t=this.ScreenObject.GridData.filter((function(e){return e.LinkedInvDocDetailsID>0}));if(t.sort((function(e,t){return e.RefNo>t.RefNo?1:-1})),t.length>0)for(var n=t[0].RefNo.toString(),a=0;a<t.length;a++)if(n!=t[a].RefNo)return void(this.DisplayMessage="Can link only one document")}this.ButtonsEnabled=!1,this.SaveInventoryDocument(e,!0)||(this.ButtonsEnabled=!0)}else this.DisplayMessage="Loan Guarantee is Mandatory";else this.DisplayMessage=s.a.GetResource("RefDocument")}},{key:"DistributeFooter",value:function(e){for(var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=[],i=function(n){if(e&&!o.e.IsEmpty(t.ScreenObject.FooterGridData[n].ColumnName)&&!t.ValidateFooterDataonSave(t.ScreenObject.FooterGridData[n]))return{v:!1};var i=0,r=t.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember==t.ScreenObject.FooterGridData[n].ColumnName}));if(i=o.e.Double(t.ScreenObject.FooterGridData[n].Amount),null!=r){a.push(r.DisplayMember),t.ScreenObject.FooterColumnSource.length>3&&t.ScreenObject.FooterColumnSource[3].IsVisible&&o.e.Int(t.ScreenObject.FooterGridData[n].DebitAccount)>0&&(r.DebitAccount=parseInt(t.ScreenObject.FooterGridData[n].DebitAccount)),t.ScreenObject.FooterColumnSource.length>4&&t.ScreenObject.FooterColumnSource[4].IsVisible&&o.e.Int(t.ScreenObject.FooterGridData[n].CreditAccount)>0&&(r.CreditAcount=parseInt(t.ScreenObject.FooterGridData[n].CreditAccount)),o.e.IsEmpty(t.ScreenObject.FooterGridData[n].Remarks)||(r.Remarks=t.ScreenObject.FooterGridData[n].Remarks.toString());for(var s=0;s<t.ScreenObject.GridData.length;s++)o.e.IsEmpty(t.ScreenObject.GridData[s].ProductID_Key)||(t.ScreenObject.GridData[s][r.DisplayMember]=i);i=o.e.Double(t.ScreenObject.FooterGridData[n].CalcAmount),t.DistributeValues("dcCalc"+r.DisplayMember,i,o.e.IsEmpty(r.DistributeColName)?"Gross":r.DistributeColName,!1)}},r=0;r<this.ScreenObject.FooterGridData.length;r++){var s=i(r);if("object"==typeof s)return s.v}if(this.ScreenObject.FooterColumnSource[1].ReadOnly||this.ScreenObject.ColumnSource.filter((function(e){return 4==e.SectionID})).forEach((function(e){if(!a.Contains(e.DisplayMember))for(var n=0;n<t.ScreenObject.GridData.length;n++)o.e.IsEmpty(t.ScreenObject.GridData[n].ProductID_Key)||(t.ScreenObject.GridData[n][e.DisplayMember]=0,t.ScreenObject.GridData[n]["dcCalc"+e.DisplayMember]=0)})),n)for(var c=0;c<this.ScreenObject.GridData.length;c++)o.e.IsEmpty(this.ScreenObject.GridData[c].ProductID_Key)||this.CalculateTotals(this.ScreenObject.GridData[c],!1);return!0}},{key:"AutoAdjustbatches",value:function(e,t){for(var n=this,a=0;a<this.ScreenObject.GridData.length;a++)if(""!=o.e.String(this.ScreenObject.GridData[a].ProductID_Key)){var i=0;if(this.ScreenObject.Preferences.ContainsKey("ExcludeHold")&&!o.e.IsEmpty(this.ScreenObject.Preferences.ExcludeHold)&&Object(l.j)(this.ScreenObject.Preferences.ExcludeHold)&&this.ScreenObject.GridDataColumns.Contains("HoldQuantity")&&(i=!o.e.IsEmpty(this.ScreenObject.GridData[a].HoldQuantity)&&parseFloat(this.ScreenObject.GridData[a].HoldQuantity.toString())>0?parseFloat(this.ScreenObject.GridData[a].HoldQuantity.toString()):0),this.ScreenObject.Preferences.ContainsKey("ExcludeReserve")&&!o.e.IsEmpty(this.ScreenObject.Preferences.ExcludeReserve)&&Object(l.j)(this.ScreenObject.Preferences.ExcludeReserve)&&this.ScreenObject.GridDataColumns.Contains("ReserveQuantity")&&(i=!o.e.IsEmpty(this.ScreenObject.GridData[a].ReserveQuantity)&&parseFloat(this.ScreenObject.GridData[a].ReserveQuantity.toString())>0?parseFloat(this.ScreenObject.GridData[a].ReserveQuantity.toString()):0),32==this.DocumentType){var r="",c=this.ScreenObject.ColumnSource.find((function(e){return e.ID==n.ScreenObject.Preferences.VarienceField}));null!=c&&null!=c&&(r=c.DisplayMember),""!=r&&this.ScreenObject.GridDataColumns.Contains(r)&&!o.e.IsEmpty(this.ScreenObject.GridData[a][r])&&(i=parseFloat(o.e.String(this.ScreenObject.GridData[a][r]).Replace("-","")))}if("8"!=o.e.String(this.ScreenObject.GridData[a].Type)&&"3"!=o.e.String(this.ScreenObject.GridData[a].Type)||this.FillAutoBatchesforDynamic(a),(t&&""==o.e.String(this.ScreenObject.GridData[a].ExtraXML)||!this.DonotUpdateInventory||i>0)&&!o.e.IsEmpty(this.ScreenObject.GridData[a].Type)&&5==parseInt(this.ScreenObject.GridData[a].Type.toString())&&(!this.ScreenObject.Preferences.ContainsKey("SameBatchtoall")||"true"!=this.ScreenObject.Preferences.SameBatchtoall.toLowerCase())&&(!e||!this.ScreenObject.Preferences.ContainsKey("BatchBasedon")||""==this.ScreenObject.Preferences.BatchBasedon)&&(!o.e.IsEmpty(this.ScreenObject.GridData[a].Quantity)&&parseFloat(this.ScreenObject.GridData[a].Quantity.toString())>0||i>0||32==this.DocumentType||this.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!o.e.IsEmpty(this.ScreenObject.GridData[a].FreeQTY)&&parseFloat(this.ScreenObject.GridData[a].FreeQTY.toString())>0)&&-1==this.VoucherType&&(this.ScreenObject.Preferences.ContainsKey("AutoBatches")&&!o.e.IsEmpty(this.ScreenObject.Preferences.AutoBatches)&&Object(l.j)(this.ScreenObject.Preferences.AutoBatches)&&(""==o.e.String(this.ScreenObject.GridData[a].DocDetailsID)||0==parseInt(o.e.String(this.ScreenObject.GridData[a].DocDetailsID)))||t&&""==o.e.String(this.ScreenObject.GridData[a].ExtraXML))){var u,d=0;if(this.ScreenObject.Preferences.ContainsKey("Donotuselocation")&&""!=this.ScreenObject.Preferences.Donotuselocation&&Object(l.j)(this.ScreenObject.Preferences.Donotuselocation)){var D=this.ScreenObject._CCFields.find((function(e){return"dcccnid2"==e.DBColumnName.toLowerCase()}));null!=D&&null!=D&&D instanceof C.b&&D.SelectedValue>0?d=D.SelectedValue:this.ScreenObject.GridDataColumns.Contains("dcCCNID2_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[a].dcCCNID2_Key)&&(d=parseInt(this.ScreenObject.GridData[a].dcCCNID2_Key.toString()))}else d=this.ScreenObject.LocationID>0?this.ScreenObject.LocationID:s.a.SessionManager.LocationID;u=this.ScreenObject.DivisionID>0?this.ScreenObject.DivisionID:s.a.SessionManager.DivisionID,0==i&&(!o.e.IsEmpty(this.ScreenObject.GridData[a].Quantity)&&parseFloat(this.ScreenObject.GridData[a].Quantity.toString())>0&&(i=parseFloat(this.ScreenObject.GridData[a].Quantity.toString())),this.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!o.e.IsEmpty(this.ScreenObject.GridData[a].FreeQTY)&&parseFloat(this.ScreenObject.GridData[a].FreeQTY.toString())>0&&(i=parseFloat(this.ScreenObject.GridData[a].FreeQTY.toString())),this.ScreenObject.GridDataColumns.Contains("UOMConversion")&&!o.e.IsEmpty(this.ScreenObject.GridData[a].UOMConversion)&&(i*=parseFloat(this.ScreenObject.GridData[a].UOMConversion.toString())));var h=new Pe.a(this.ScreenObject.GridDataObj);h.BatchNumberViewModel_3(this,this.VoucherType,i,parseInt(this.ScreenObject.GridData[a].ProductID_Key.toString()),this.ScreenObject.GridData[a].ProductName.toString(),d,u,this.ScreenObject.GridData[a]),h.ChkFifo=!0,h.OnSave("AutoSave"),h.count>1&&this.ScreenObject.UpdateSequence()}}}},{key:"SaveDocument",value:function(){this.SaveInventoryDocument(this.SaveCallReq.sender,this.SaveCallReq.Validate,this.SaveCallReq.CheckStock,this.SaveCallReq.CallType,this.SaveCallReq.AutoBatches,this.SaveCallReq.IgnoreBatches,!0)}},{key:"SaveInventoryDocument",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=(arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4]),r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.SaveCallReq.sender=e,this.SaveCallReq.Validate=n,this.SaveCallReq.CheckStock=a,this.SaveCallReq.CallType="SYNC_SAVE",this.SaveCallReq.AutoBatches=i,this.SaveCallReq.IgnoreBatches=r,console.log("SaveInventoryDocument In"),Logger.InfoLog("AddEditDocumentViewModel::Entering OnSaveAccount");try{var u,d,D,S=function(){if(t.ScreenObject.BulkSaveon>0){var S=t.ScreenObject.GridData.filter((function(e){return e.ProductID_Key>0})).Compute("count","ProductID_Key");null==S&&(S=0),t.savebulk=parseInt(S)>t.ScreenObject.BulkSaveon}if(t.ScreenObject.Preferences.ContainsKey("LinkAll")&&""!=t.ScreenObject.Preferences.LinkAll&&Object(l.j)(t.ScreenObject.Preferences.LinkAll)&&null!=t.ScreenObject.Link&&null!=t.ScreenObject.Link.DocumentList&&t.ScreenObject.Link.DocumentList.Items.length>0&&t.ScreenObject.Link.DocumentList.Items.forEach((function(e){if(!e.IsChecked||0==t.ScreenObject.GridData.filter((function(t){return t.RefNo==e.Name})).length)return t.DisplayMessage="Link all Documents",!1})),c||t.BillWisedt.Clear(),n&&t.ScreenObject.Preferences.ContainsKey("MadatoryAttachments")&&""!=t.ScreenObject.Preferences.MadatoryAttachments&&Object(l.j)(t.ScreenObject.Preferences.MadatoryAttachments)&&(null==t.ViewAttachments||0==t.ViewAttachments.AttachmentsList.length))return{v:(t.DisplayMessage="No Attachments added.",!1)};var b=!0,p=!1,g=!1,O=!1,I=!0;if(t.ScreenObject.Preferences.ContainsKey("DonotupdateAccounts")&&""!=t.ScreenObject.Preferences.DonotupdateAccounts&&(b=Object(l.j)(t.ScreenObject.Preferences.DonotupdateAccounts)),t.ScreenObject.Preferences.ContainsKey("DonotupdateInventory")&&""!=t.ScreenObject.Preferences.DonotupdateInventory&&(t.DonotUpdateInventory=Object(l.j)(t.ScreenObject.Preferences.DonotupdateInventory)),null!=t.donotupInv&&(t.DonotUpdateInventory=t.donotupInv.IsChecked),t.ScreenObject.Preferences.ContainsKey("DonotUpdateSchemeQty")&&""!=t.ScreenObject.Preferences.DonotUpdateSchemeQty&&(t.DonotUpdateSchemeQty=Object(l.j)(t.ScreenObject.Preferences.DonotUpdateSchemeQty)),t.ScreenObject.Preferences.ContainsKey("DontSaveIf_ValueZero")&&""!=t.ScreenObject.Preferences.DontSaveIf_ValueZero&&(p=Object(l.j)(t.ScreenObject.Preferences.DontSaveIf_ValueZero)),t.ScreenObject.Preferences.ContainsKey("DontSaveIf_RateZero")&&""!=t.ScreenObject.Preferences.DontSaveIf_RateZero&&(g=Object(l.j)(t.ScreenObject.Preferences.DontSaveIf_RateZero)),t.ScreenObject.Preferences.ContainsKey("DontSaveIf_QtyIsZero")&&""!=t.ScreenObject.Preferences.DontSaveIf_QtyIsZero&&(O=Object(l.j)(t.ScreenObject.Preferences.DontSaveIf_QtyIsZero)),t.ScreenObject.Preferences.ContainsKey("DontSaveIf_QtyIsNegative")&&""!=t.ScreenObject.Preferences.DontSaveIf_QtyIsNegative&&(I=Object(l.j)(t.ScreenObject.Preferences.DontSaveIf_QtyIsNegative)),t.ScreenObject.IsForecast){var T=t.ScreenObject.ForecastObj.Validate();if(T.length>0)return{v:(t.DisplayMessage=T,!1)}}if(n&&30==t.ScreenObject.DocumentType&&t.ScreenObject.GridDataColumns.Contains("VoucherType")&&t.ScreenObject.Preferences.ContainsKey("DontSaveIssueRctequal")&&""!=t.ScreenObject.Preferences.DontSaveIssueRctequal&&Object(l.j)(t.ScreenObject.Preferences.DontSaveIssueRctequal)){var j=t.ScreenObject.GridData.filter((function(e){return e.ProductID_Key>0&&-1==e.VoucherType})).Compute("sum","Quantity"),P=t.ScreenObject.GridData.filter((function(e){return e.ProductID_Key>0&&1==e.VoucherType})).Compute("sum","Quantity");null==P&&(P=0),null==j&&(P=0);var A=parseFloat(j).ToString("N"+s.a.SessionManager.Preferences.DecimalsinQty),M=parseFloat(P).ToString("N"+s.a.SessionManager.Preferences.DecimalsinQty);if(null==j&&null==P);else if(A.toString()!=M.toString())return{v:(t.DisplayMessage=s.a.GetResource("IssRcvarenotEqual"),!1)}}if(81==t.ScreenObject.DocumentType){if(0==t.DocID)for(var v=0;v<t.ScreenObject._CCFields.length;v++){var G=t.ScreenObject._CCFields[v];if(G instanceof C.b&&50002==G.CCID&&G.SelectedValue>0){t.dtData=null;var N=t.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()}));N&&N instanceof m.e&&!o.e.IsEmpty(N.SelectedValue)&&t.LoadGradeData(t.DocID>0?1:2,new Date,"GradeWiseCopy");break}}if(null!=t.dtData&&t.dtData.length>0){var E=t.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()}));if(E&&E instanceof m.e&&o.e.IsEmpty(E.SelectedValue))return{v:(t.DisplayMessage="Please select the Year",!1)};var w=new Date(parseInt(E.SelectedValue),parseInt(s.a.SessionManager.Preferences.LeaveYear),1),F=0;if((E=t.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()})))&&E instanceof m.e)if("EmployeeWise"!=E.SelectedValue.toString())for(var V=0;V<t.ScreenObject.GridData.length;V++){if(null!=t.ScreenObject.GridData[V].ProductID_Key)for(var L=0;L<t.dtData.length;L++)parseFloat(t.ScreenObject.GridData[V].dcCCNID53_Key)==parseFloat(t.dtData[L].dcCCNID53_Key)&&parseFloat(t.ScreenObject.GridData[V].dcCCNID52_Key)==parseFloat(t.dtData[L].dcCCNID52_Key)&&(t.dtData[L].dcNum3=parseFloat(t.ScreenObject.GridData[V].dcNum3));F=V}else F=t.ScreenObject.GridData.length-1;var x=t.ScreenObject.GridData.filter((function(e){return o.e.IsEmpty(e.ProductID_Key)||0==e.ProductID_Key}));x.length>0&&x.forEach((function(e){t.ScreenObject.GridDataObj.removeRow(e)})),F+=2;for(var K=new Date,Q=0,H=null,W=null,q=s.a.common.GetDataTable("DOC070",""),Y=function(e){var n=t.ScreenObject.GridDataObj.NewRow();if(t.ScreenObject.GridDataObj.insertRowAt(n,F+e),n.ProductID_Key=parseInt(s.a.SessionManager.Preferences.PayrollProduct),n.Unit_Key=1,n.dcCCNID51_Key=t.dtData[e].dcCCNID51_Key.toString(),n.dcCCNID52_Key=t.dtData[e].dcCCNID52_Key.toString(),n.dcCCNID53_Key=t.dtData[e].dcCCNID53_Key.toString(),Q=parseFloat(t.dtData[e].dcNum3),parseInt(n.dcCCNID51_Key)>0&&null!=t.dtPayEmps&&t.dtPayEmps.length>0&&(null!=(H=t.dtPayEmps.filter((function(e){return e.NodeID==n.dcCCNID51_Key})))&&H.length>0))if(null!=q&&q.length>0&&(W=(W=q.filter((function(e){return e.GradeID==n.dcCCNID53_Key&&e.ComponentID==n.dcCCNID52_Key}))).sort((function(e,t){return e.PayrollDate>t.PayrollDate?1:-1}))),null!=W&&W.length>0&&"No"==o.e.String(W[0].AccrualInProbation)){if(!o.e.IsEmpty(H[0].DOC)&&(K=o.e.IsEmpty(H[0].DOC)?new Date("01-Jan-1900"):new Date(H[0].DOC))>w){var a=12-(K.iMonth()-w.iMonth());a>0&&K.getFullYear()==w.getFullYear()?(Q=Q*a/12,Q=Math.round(Q)):Q=0}}else if((K=o.e.IsEmpty(H[0].DOJ)?new Date("01-Jan-1900"):new Date(H[0].DOJ))>w){var i=12-(K.iMonth()-w.iMonth());i>0?(Q=Q*i/12,Q=Math.round(Q)):Q=0}n.dcNum3=Q.toString()},z=0;z<t.dtData.length;z++)Y(z);t.ScreenObject.GridDataObj.refreshDataView(),t.ScreenObject.UpdateSequence(),t.RefreshGrid=!0,t.dtData.length>0&&t.dtData.Clear()}}if(t.IsNewAssignLeave){var J=function(){var e=t.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()}));if(null!=e&&e instanceof m.e&&""==o.e.String(e.SelectedValue))return{v:{v:(t.DisplayMessage="Please select the Year",t.MessageVisibility=!0,!1)}};var n=new Date(parseInt(e.SelectedValue),parseInt(s.a.SessionManager.Preferences.LeaveYear.toString()),1),a=0;if(null!=(e=t.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()})))&&e instanceof m.e)if("EmployeeWise"!=e.SelectedValue.toString())for(var i=0;i<t.ScreenObject.GridData.length;i++){if(null!=t.ScreenObject.GridData[i].ProductID_Key)for(var r=function(e){var n=t.dtALeaveComp.filter((function(n){return n.ComponentID==t.dtData[e].dcCCNID52_Key}));parseFloat(t.ScreenObject.GridData[i].dcCCNID53_Key)==parseFloat(t.dtData[e].dcCCNID53_Key)&&t.ScreenObject.GridDataColumns.Contains("dcNum"+n[0].SNo.toString())&&null!=t.ScreenObject.GridData[i]["dcNum"+n[0].SNo.toString()]&&""!=t.ScreenObject.GridData[i]["dcNum"+n[0].SNo.toString()]&&null!=t.ScreenObject.GridData[i]["dcNum"+n[0].SNo.toString()]&&(t.dtData[e].dcNum3=parseFloat(t.ScreenObject.GridData[i]["dcNum"+n[0].SNo.toString()]))},c=0;c<t.dtData.length;c++)r(c);a=i}else a=t.ScreenObject.GridData.length-1;var l=t.ScreenObject.GridData.filter((function(e){return 0==e.ProductID_Key||null==e.ProductID_Key}));l.length>0&&l.forEach((function(e){t.ScreenObject.GridData.Remove(e)})),a+=2;for(var u=new Date,d=0,D=null,h=t.dtData.ToTable(!0,["dcCCNID51_Key"]),S=function(e){var i=t.dtData.filter((function(t){return t.dcCCNID51_Key==h[e].dcCCNID51_Key}));null!=i&&i.length>0&&function(){var r=t.ScreenObject.GridDataObj.NewRow();t.ScreenObject.GridDataObj.insertRowAt(r,a+e),r.ProductID_Key=parseInt(s.a.SessionManager.Preferences.PayrollProduct),r.Unit_Key=1,r.dcCCNID51_Key=i[0].dcCCNID51_Key.toString(),r.dcCCNID53_Key=i[0].dcCCNID53_Key.toString();for(var o=function(e){var a=t.dtALeaveComp.filter((function(t){return t.ComponentID==i[e].dcCCNID52_Key}));if(d=parseFloat(i[e].dcNum3),parseInt(r.dcCCNID51_Key)>0&&null!=t.dtPayEmps&&t.dtPayEmps.length>0&&(null!=(D=t.dtPayEmps.filter((function(e){return e.NodeID==r.dcCCNID51_Key.toString()})))&&D.length>0&&(u=null!=D[0].DOJ&&""!=D[0].DOJ.toString()?new Date(D[0].DOJ):new Date("01-Jan-1900"))>n)){var s=12-(u.iMonth()-n.iMonth());s>0?(d=d*s/12,d=Math.round(d)):d=0}r["dcNum"+a[0].SNo.toString()]=d.toString(),t.ScreenObject.GridDataObj.updateRow(r)},c=0;c<i.length;c++)o(c)}()},b=0;b<h.length;b++)S(b);t.ScreenObject.UpdateSequence(),t.RefreshGrid=!0,t.dtData.length>0&&t.dtData.Clear()}();if("object"==typeof J)return J.v}if(t.FillHeaderDictionary(),n&&!t.ValidateHeaderSave())return{v:!1};var Z="";if(t.DocumentType>50&&(t.DisplayMessage=t.CheckDocumentValidations(Z),""!=t.DisplayMessage))return{v:(""!=t.strVacXml&&(t.strVacXml=t.strVacXml+t.DisplayMessage),!1)};n&&t.FillCreatedByDate(e.toString());var $={message:Z};if(t.ScreenObject.GenerateQuery($,b,t.DocumentDate,n,t.savebulk),Z=$.message,null!=t.ScreenObject.DebitAccount&&(t.ScreenObject.strStaticFields+=' DebitAccount="'+t.ScreenObject.DebitAccount.SelectedValue+'" ',t.res="No",(7==t.ScreenObject.DocumentType||11==t.ScreenObject.DocumentType||12==t.ScreenObject.DocumentType)&&n&&!b&&!t.CheckCreditLimit(t.ScreenObject.DebitAccount.SelectedValue,parseFloat(t.NetAmount),!1)))return{v:!1};if(null!=t.ScreenObject.CreditAccount&&(t.ScreenObject.strStaticFields+=' CreditAccount="'+t.ScreenObject.CreditAccount.SelectedValue+'" ',t.res="No",(1==t.ScreenObject.DocumentType||2==t.ScreenObject.DocumentType||4==t.ScreenObject.DocumentType)&&n&&!b&&!t.CheckCreditLimit(t.ScreenObject.CreditAccount.SelectedValue,-parseFloat(t.NetAmount),!0)))return{v:!1};if(""!=Z)return{v:(t.DisplayMessage=Z,!1)};if("NoWorkFlowReSave"!=e.toString()&&t.ScreenObject.Preferences.ContainsKey("ReEvaluateBeforeSave")&&""!=t.ScreenObject.Preferences.ReEvaluateBeforeSave&&Object(l.j)(t.ScreenObject.Preferences.ReEvaluateBeforeSave)&&t.ReEvaluate(!0,!1),"NoWorkFlowReSave"!=e.toString()&&t.ScreenObject.Preferences.ContainsKey("ValidateSchemeBeforeSave")&&""!=t.ScreenObject.Preferences.ValidateSchemeBeforeSave&&Object(l.j)(t.ScreenObject.Preferences.ValidateSchemeBeforeSave)&&!t.ValidateSchemes())return{v:!1};if(92==t.ScreenObject.DocumentType)return{v:t.SaveShiftAssign()};if(t.AutoPOstXML="",null!=t.AutoPostViewModel&&t.ScreenObject.Preferences.ContainsKey("Autopostdocument")&&""!=t.ScreenObject.Preferences.Autopostdocument&&o.e.Int(t.ScreenObject.Preferences.Autopostdocument)&&parseInt(t.ScreenObject.Preferences.Autopostdocument)>4e4){for(var ee=function(e){if(!o.e.IsEmpty(t.ScreenObject.GridData[e].ProductID_Key)){var n=t.AutoPostViewModel.ScreenObject.GridData.filter((function(n){return n.RefSeqNo==t.ScreenObject.GridData[e].RefSeqNo}));if(n.length>0){var a=0;if(n.forEach((function(n){t.ScreenObject.Preferences.ContainsKey("ExpFPQTY")&&t.ScreenObject.GridDataColumns.Contains(t.ScreenObject.Preferences.ExpFPQTY)?o.e.IsEmpty(t.ScreenObject.GridData[e][t.ScreenObject.Preferences.ExpFPQTY])||(a=parseFloat(t.ScreenObject.GridData[e][t.ScreenObject.Preferences.ExpFPQTY])):o.e.IsEmpty(t.ScreenObject.GridData[e].Quantity)||(a=parseFloat(t.ScreenObject.GridData[e].Quantity)),o.e.IsEmpty(n.defaultQuantity)||a*parseFloat(n.defaultQuantity)==parseFloat(n.Quantity)||(n.Quantity=a*parseFloat(n.defaultQuantity),o.e.IsEmpty(n.Quantity)||o.e.IsEmpty(n.UOMConversion)||!o.e.IsNum(n.UOMConversion)?o.e.IsEmpty(n.Quantity)||(n.UOMConvertedQty=n.Quantity.toString()):n.UOMConvertedQty=o.e.Double(n.UOMConversion)*parseFloat(n.Quantity),t.AutoPostViewModel.CalculateTotals(n,!1))})),t.ScreenObject.Preferences.ContainsKey("Autopostdocument")&&""!=t.ScreenObject.Preferences.Autopostdocument&&"0"!=t.ScreenObject.Preferences.Autopostdocument){var i=t.AutoPostViewModel.ScreenObject._TextFields.find((function(e){return e.DBColumnName.toLowerCase()==t.ScreenObject.Preferences.FPQty.toLowerCase()}));i&&i instanceof h.d&&(i.Text=a.toString())}}}},te=0;te<t.ScreenObject.GridData.length;te++)ee(te);if(t.AutoPostViewModel.ScreenObject.UpdateSequence(),t.AutoPostViewModel.ScreenObject.DocID=t.AutoPostDocID,t.AutoPostViewModel.OKCancelVisibility=!0,t.AutoPostViewModel.parent=t,t.ScreenObject.Preferences.ContainsKey("DisplaydocbeforeSave")&&""!=t.ScreenObject.Preferences.DisplaydocbeforeSave&&Object(l.j)(t.ScreenObject.Preferences.DisplaydocbeforeSave)){if(t.AutoPostViewModel.DisplayMessage="","close"==t.AutoPostViewModel.DisplayMessage)return{v:!1};if(!t.ScreenObject.IsPurchase)for(var ne=function(e){if(!o.e.IsEmpty(t.ScreenObject.GridData[e].ProductID_Key)){var n=t.AutoPostViewModel.ScreenObject.GridData.filter((function(n){return n.RefSeqNo==t.ScreenObject.GridData[e].RefSeqNo})),a=0;n.forEach((function(e){o.e.IsEmpty(e.Gross)||(a+=parseFloat(e.Gross))})),t.ScreenObject.GridData[e].Rate=a/parseFloat(t.ScreenObject.GridData[e].Quantity),t.CalculateTotals(t.ScreenObject.GridData[e],!1)}},ae=0;ae<t.ScreenObject.GridData.length;ae++)ne(ae)}else if(t.AutoPostViewModel.SaveInventoryDocument("",!0),""!=t.AutoPostViewModel.DisplayMessage)return{v:(t.DisplayMessage=" Auto Post"+t.AutoPostViewModel.DisplayMessage,!1)}}if(null!=t.AutoProduce&&(t.AutoProduce.ScreenObject.UpdateSequence(),t.AutoProduce.ScreenObject.DocID=t.AutoProduceDocID,t.AutoProduce.parent=t,t.AutoProduceXML="",t.AutoProduce.SaveInventoryDocument("",!0),""!=t.AutoProduce.DisplayMessage))return{v:(t.DisplayMessage=" Auto Produce:"+t.AutoProduce.DisplayMessage,!1)};var ie="",re="",se="",oe="",ce="",le="",ue="",de="";t.savebulk&&(re+="<DocXML>",se+="<NumXML>",oe+="<TextXML>",ce+="<CCXML>",ie+="<AccXML>",ue+="<EXTRAXML>",de+="<DocExtraXml>");var De,me,be=0,Ce=0,ye=0,pe=[],ge=[],fe=!1,Te=!1,je=0,Ae=0,Me={dim:pe,BudID:je,BudStartDate:De,IsQtyBudLineWise:fe},ve=t.ValidateBudget(1,Me);pe=Me.dim,je=Me.BudID,De=Me.BudStartDate,fe=Me.IsQtyBudLineWise;var Ge={dim:ge,ValueBudID:Ae,ValueBudStartDate:me,IsValueBudLineWise:Te},Ne=t.ValidateBudget(2,Ge);ge=Me.dim,Ae=Ge.ValueBudID,me=Ge.ValueBudStartDate,Te=Ge.IsValueBudLineWise;var Ee=s.a.SessionManager.Preferences.DecimalsinQty,we=t.ScreenObject.ColumnSource.find((function(e){return null!=e.DisplayMember&&"quantity"==e.DisplayMember.toLowerCase()}));we&&!o.e.IsEmpty(we.DecimalPoints)&&(Ee=we.DecimalPoints),t.BodyVisible&&!t.ReadOnlyBody||t.CheckEmptyGrid();var Fe="",Ve="";t.IsBinwise=null,t.IsToBinwise=null;var Le=!1,Re=!1,Be=null;(t.ScreenObject.Preferences.ContainsKey("Alert Duplicate Product")&&""!=t.ScreenObject.Preferences["Alert Duplicate Product"].toString()&&Object(l.j)(t.ScreenObject.Preferences["Alert Duplicate Product"])||t.ScreenObject.Preferences.ContainsKey("DuplicateProduct_IncrementQuantity")&&""!=t.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity&&Object(l.j)(t.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity))&&(Le=!0),0==t.ScreenObject.DocID&&(t.ScreenObject.DistributeCostXML="");var xe=0,ke=0;if(1==t.ScreenObject.DocumentType||39==t.ScreenObject.DocumentType||27==t.ScreenObject.DocumentType||26==t.ScreenObject.DocumentType||25==t.ScreenObject.DocumentType||2==t.ScreenObject.DocumentType||34==t.ScreenObject.DocumentType||6==t.ScreenObject.DocumentType||3==t.ScreenObject.DocumentType||4==t.ScreenObject.DocumentType||13==t.ScreenObject.DocumentType?(null!=t.ScreenObject.CreditAccount&&t.ScreenObject.CreditAccount.SelectedValue>0&&(xe=t.ScreenObject.CreditAccount.SelectedValue),null!=t.ScreenObject.DebitAccount&&t.ScreenObject.DebitAccount.SelectedValue>0&&(ke=t.ScreenObject.DebitAccount.SelectedValue)):11!=t.ScreenObject.DocumentType&&38!=t.ScreenObject.DocumentType&&5!=t.ScreenObject.DocumentType&&7!=t.ScreenObject.DocumentType&&9!=t.ScreenObject.DocumentType&&24!=t.ScreenObject.DocumentType&&33!=t.ScreenObject.DocumentType&&10!=t.ScreenObject.DocumentType&&8!=t.ScreenObject.DocumentType&&12!=t.ScreenObject.DocumentType||(null!=t.ScreenObject.DebitAccount&&t.ScreenObject.DebitAccount.SelectedValue>0&&(xe=t.ScreenObject.DebitAccount.SelectedValue),null!=t.ScreenObject.CreditAccount&&t.ScreenObject.CreditAccount.SelectedValue>0&&(ke=t.ScreenObject.CreditAccount.SelectedValue)),s.a.SessionManager.Preferences.ContainsKey("DistributeCost")&&"True"==s.a.SessionManager.Preferences.DistributeCost&&s.a.SessionManager.Preferences.ContainsKey("CostBasedON")&&"True"==s.a.SessionManager.Preferences.CostBasedON&&s.a.SessionManager.Preferences.ContainsKey("CostBasedONDims")&&""!=s.a.SessionManager.Preferences.CostBasedONDims&&(!t.ScreenObject.Preferences.ContainsKey("DistributeCost")||"True"!=t.ScreenObject.Preferences.DistributeCost.toString())?Be=s.a.SessionManager.Preferences.CostBasedONDims.split(","):!s.a.SessionManager.Preferences.ContainsKey("DistributeCost")||"True"!=s.a.SessionManager.Preferences.DistributeCost||t.ScreenObject.Preferences.ContainsKey("DistributeCost")&&"True"==t.ScreenObject.Preferences.DistributeCost.toString()||(Re=t.ScreenObject.IsDistCost(xe.toString()+","+ke.toString())),t.ScreenObject.Preferences.ContainsKey("BatchBasedon")&&""!=t.ScreenObject.Preferences.BatchBasedon&&!t.ScreenObject.GridDataColumns.Contains(t.ScreenObject.Preferences.BatchBasedon)){var _e=t.ScreenObject._TextFields.find((function(e){return e instanceof h.d&&e.DBColumnName.toLowerCase()==t.ScreenObject.Preferences.BatchBasedon.toLowerCase()}));_e&&"1"==_e.Text&&(r=!0)}-1==t.VoucherType&&(i||t.ScreenObject.Preferences.ContainsKey("AutoBatches")&&!o.e.IsEmpty(t.ScreenObject.Preferences.AutoBatches)&&Object(l.j)(t.ScreenObject.Preferences.AutoBatches))&&t.AutoAdjustbatches(r,i);for(var Ke=function(a){if(o.e.IsEmpty(t.ScreenObject.GridData[a].ProductID_Key)){if(n)for(var c=0;c<t.ScreenObject.ColumnSource.length;c++)if(t.ScreenObject.ColumnSource[c].IsVisible&&"DocSeqNo"!=t.ScreenObject.ColumnSource[c].DisplayMember&&(("INT"==t.ScreenObject.ColumnSource[c].DataType||"FLOAT"==t.ScreenObject.ColumnSource[c].DataType)&&!o.e.IsEmpty(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[c].DisplayMember])&&0!=parseFloat(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[c].DisplayMember])||"LISTBOX"==t.ScreenObject.ColumnSource[c].DataType&&!o.e.IsEmpty(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[c].ValueMember])&&parseInt(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[c].ValueMember])>0||("SELECTIONBOX"==t.ScreenObject.ColumnSource[c].DataType||"String"==t.ScreenObject.ColumnSource[c].DataType||"TextBlock"==t.ScreenObject.ColumnSource[c].DataType||"TEXT"==t.ScreenObject.ColumnSource[c].DataType)&&!o.e.IsEmpty(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[c].DisplayMember])||("DATE"==t.ScreenObject.ColumnSource[c].DataType||"DATETIME"==t.ScreenObject.ColumnSource[c].DataType)&&!o.e.IsEmpty(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[c].DisplayMember+"_Key"])))return{v:{v:(t.DisplayMessage=" Product not selected at row no."+t.ScreenObject.GridData[a].DocSeqNo.toString(),!1)}};return"continue"}var D=!1;if(!o.e.IsEmpty(t.ScreenObject.GridData[a].SchemeID)&&parseInt(t.ScreenObject.GridData[a].SchemeID)>0&&"Y"==t.ScreenObject.GridData[a].IsScheme.toString()&&(D=!0),n&&Le&&!o.e.IsEmpty(t.ScreenObject.GridData[a].LinkedInvDocDetailsID)&&parseInt(t.ScreenObject.GridData[a].LinkedInvDocDetailsID)>0&&ie.Contains('ProductID="'+t.ScreenObject.GridData[a].ProductID_Key.toString()+'"')&&(s.a.SessionManager.Preferences.ContainsKey("ShowProdCodeinErrMsg")&&Object(l.j)(s.a.SessionManager.Preferences.ShowProdCodeinErrMsg)?t.res=t.ScreenObject.GridData[a].ProductCode.toString()+"-"+t.ScreenObject.GridData[a].ProductName.toString():t.ScreenObject.GridDataColumns.Contains("ProductName")?t.res=t.ScreenObject.GridData[a].ProductName.toString():t.ScreenObject.GridDataColumns.Contains("ProductCode")&&(t.res=t.ScreenObject.GridData[a].ProductCode.toString()),!confirm("Duplicate product:"+t.res+" at row no:"+t.ScreenObject.GridData[a].DocSeqNo.toString()+" \n do you want to continue?")))return{v:{v:!1}};if(t.ScreenObject.Preferences.ContainsKey("BatchBasedon")&&t.ScreenObject.GridDataColumns.Contains(t.ScreenObject.Preferences.BatchBasedon)&&(r=!1,"1"==t.ScreenObject.GridData[a][t.ScreenObject.Preferences.BatchBasedon].toString()&&(r=!0)),n&&t.ScreenObject.Preferences.ContainsKey("Mandatory")&&Object(l.j)(t.ScreenObject.Preferences.Mandatory)&&(o.e.IsEmpty(t.ScreenObject.GridData[a].LinkedInvDocDetailsID)||!o.e.IsEmpty(t.ScreenObject.GridData[a].LinkedInvDocDetailsID)&&parseInt(t.ScreenObject.GridData[a].LinkedInvDocDetailsID)<1)&&!(t.ScreenObject.GridDataColumns.Contains("jobID")&&!o.e.IsEmpty(t.ScreenObject.GridData[a].jobID)||t.ScreenObject.GridDataColumns.Contains("BOMID")&&!o.e.IsEmpty(t.ScreenObject.GridData[a].BOMID)))return{v:{v:(t.DisplayMessage=s.a.GetResource("Doc_MissingRef")+" "+t.ScreenObject.GridData[a].DocSeqNo.toString(),!1)}};if(n&&!D){if(!o.e.IsEmpty(t.ScreenObject.GridData[a].ProductID_Key)&&parseInt(t.ScreenObject.GridData[a].ProductID_Key)==t.ScreenObject.TempProductID&&t.ScreenObject.Preferences.ContainsKey("MandatorytempPartinfo")&&Object(l.j)(t.ScreenObject.Preferences.MandatorytempPartinfo)&&o.e.IsEmpty(t.ScreenObject.GridData[a].ExtraXML))return{v:{v:(t.DisplayMessage=s.a.GetResource("Doc_MandatoryTempInfo")+" "+t.ScreenObject.GridData[a].DocSeqNo.toString(),!1)}};if(O&&(o.e.IsEmpty(t.ScreenObject.GridData[a].Quantity)||!o.e.IsNum(t.ScreenObject.GridData[a].Quantity)||0==o.e.Double(t.ScreenObject.GridData[a].Quantity)))return{v:{v:(t.DisplayMessage=s.a.GetResource("Doc_ZeroQty")+" "+t.ScreenObject.GridData[a].DocSeqNo.toString(),!1)}};if(I&&!o.e.IsEmpty(t.ScreenObject.GridData[a].Quantity)&&parseFloat(t.ScreenObject.GridData[a].Quantity)<0)return{v:{v:(t.DisplayMessage=s.a.GetResource("Doc_NegativeQty")+" "+t.ScreenObject.GridData[a].DocSeqNo.toString(),!1)}};if(g&&(o.e.IsEmpty(t.ScreenObject.GridData[a].Rate)||!o.e.IsNum(t.ScreenObject.GridData[a].Rate)||0==parseFloat(t.ScreenObject.GridData[a].Rate)))return{v:{v:(t.DisplayMessage=s.a.GetResource("Doc_ZeroRate")+" "+t.ScreenObject.GridData[a].DocSeqNo.toString(),!1)}};if(p&&(o.e.IsEmpty(t.ScreenObject.GridData[a].Gross)||!o.e.IsNum(t.ScreenObject.GridData[a].Gross)||0==parseFloat(t.ScreenObject.GridData[a].Gross)))return{v:{v:(t.DisplayMessage=s.a.GetResource("Doc_ZeroValue")+" "+t.ScreenObject.GridData[a].DocSeqNo.toString(),!1)}}}if(n&&t.ScreenObject.GridDataColumns.Contains("QtyType")&&"1"==o.e.String(t.ScreenObject.GridData[a].QtyType)&&o.e.IsEmpty(t.ScreenObject.GridData[a].QtyXML))return{v:{v:(t.DisplayMessage="Qty Adjustment not done at row no. "+t.ScreenObject.GridData[a].DocSeqNo.toString(),!1)}};if(n&&t.ScreenObject.GridDataColumns.Contains("IsTestCase")&&"true"==o.e.LowerCase(t.ScreenObject.GridData[a].IsTestCase)&&o.e.IsEmpty(t.ScreenObject.GridData[a].TestCaseXML))return{v:{v:(t.DisplayMessage="Test Case not done at row no. "+t.ScreenObject.GridData[a].DocSeqNo.toString(),!1)}};if(t.AutoAdjustBOE(a),n&&t.ScreenObject.GridDataColumns.Contains("landingType")&&("1"==o.e.String(t.ScreenObject.GridData[a].landingType)||"2"==o.e.String(t.ScreenObject.GridData[a].landingType))&&(!t.ScreenObject.GridDataColumns.Contains("VoucherType")||"-1"==o.e.String(t.ScreenObject.GridData[a].VoucherType))&&!o.e.IsEmpty(t.ScreenObject.GridData[a].Quantity)&&parseFloat(t.ScreenObject.GridData[a].Quantity)>0){if(""==o.e.String(t.ScreenObject.GridData[a].DocExtraXML))return{v:{v:(t.DisplayMessage="Bill of Entry not done at row no. "+t.ScreenObject.GridData[a].DocSeqNo.toString(),!1)}};var S=new o.f;S.LoadXml(t.ScreenObject.GridData[a].DocExtraXML);for(var m=S.SelectNodes("DocExtraXML/Row"),y=0,T=0;T<m.length;T++)null==m[T].attributes.Qty||o.e.IsEmpty(m[T].attributes.Qty.value)||(y+=parseFloat(m[T].attributes.Qty.value));if(parseFloat(t.ScreenObject.GridData[a].Quantity)!=y)return{v:{v:(t.DisplayMessage="Bill of Entry not done at row no. "+t.ScreenObject.GridData[a].DocSeqNo.toString(),!1)}}}if(5==t.ScreenObject.DocumentType&&t.ScreenObject.GridDataColumns.Contains("RecievedQty")&&!o.e.IsEmpty(t.ScreenObject.GridData[a].RecievedQty)&&(!o.e.IsEmpty(t.ScreenObject.GridData[a].Quantity)&&parseFloat(t.ScreenObject.GridData[a].RecievedQty)>parseFloat(t.ScreenObject.GridData[a].Quantity)||o.e.IsEmpty(t.ScreenObject.GridData[a].Quantity)))return{v:{v:(t.DisplayMessage="RecievedQty greater than Issued quantity at row no:"+t.ScreenObject.GridData[a].DocSeqNo.toString(),!1)}};if(be++,t.res="No",1==be){if(0==t.DocID&&t.ScreenObject.Preferences.ContainsKey("AutoadjustDownPmt")&&Object(l.j)(t.ScreenObject.Preferences.AutoadjustDownPmt)&&Object(l.j)(t.ScreenObject.Preferences.AllowAdjToDownPmt)){var j=t.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&26425==e.LinkData}));if(!(j.length>0))return{v:{v:(t.DisplayMessage="Define Advance AR/AP field.",!1)}};var P=new k.ShowJVViewModel;P.ShowJVViewModel_2(t,j[0].SysColumnName.toString(),1),P.OnSave("OK")}var A=t.ScreenObject.ColumnSource.find((function(e){return-1==e.DistributionColID}));if(!A||3!=A.PostingType&&4!=A.PostingType||t.RoundOffValue(t.ScreenObject.GridData[a],A),("CheckoutPrint"==e.toString()||"CheckoutSave"==e.toString()||!n)&&null!=t.POSPayModes){t.FillHeaderDictionary();for(var M=0;M<t.POSPayModes.GridData.length;M++)o.e.IsEmpty(t.POSPayModes.GridData[M].ColumnName)||t.FooterDics.ContainsKey(t.POSPayModes.GridData[M].Name.toString().Replace(" ",""))&&t.FooterDics[t.POSPayModes.GridData[M].Name.toString().Replace(" ","")].setFieldValue(t.POSPayModes.GridData[M].Amount.toString());t.CalculateFooter(-1)}if(!t.DistributeFooter(n))return{v:{v:!1}}}var v=0,G=function(){t.savebulk?(re+="<Transactions ",se+="<Numeric ",ce+="<CostCenters ",oe+="<Alpha "):(re="",se="",oe="",ce="",de="",re+="<Transactions ",se+='<Numeric Query="',ce+='<CostCenters Query="',oe+='<Alpha Query="',t.isSaveXml||(t.IsAutoPost||t.isAutoProduce)&&null!=parent?ie+="<RowHead/>":ie+="\x11",ie+="<Row>",ie+="<AccountsXML>"),Ce=0,le="";var c=0,S=0;if(32==t.DocumentType){var m="";null!=(u=t.ScreenObject.ColumnSource.find((function(e){return e.ID==t.ScreenObject.Preferences.VarienceField})))&&(m=u.DisplayMember),""!=m&&t.ScreenObject.GridDataColumns.Contains(m)&&""!=t.ScreenObject.GridData[a][m].toString()&&(S=parseFloat(t.ScreenObject.GridData[a][m].toString().Replace("-","")))}else o.e.IsEmpty(t.ScreenObject.GridData[a].Quantity)||(S=parseFloat(t.ScreenObject.GridData[a].Quantity.toString()));var y=new o.f;if(n&&(!t.DonotUpdateInventory||32==t.DocumentType)&&!o.e.IsEmpty(t.ScreenObject.GridData[a].Type)&&2==parseInt(t.ScreenObject.GridData[a].Type)&&S>0){if(o.e.IsEmpty(t.ScreenObject.GridData[a].ExtraXML))return{v:{v:{v:(t.DisplayMessage=s.a.GetResource("Doc_SerialNoProductQtyMisMatch")+" "+t.ScreenObject.GridData[a].DocSeqNo.toString(),!1)}}};if(y.LoadXml(t.ScreenObject.GridData[a].ExtraXML),S!=y.SelectNodes("xml/Row").length)return{v:{v:{v:(t.DisplayMessage=s.a.GetResource("Doc_SerialNoProductQtyMisMatch")+" "+t.ScreenObject.GridData[a].DocSeqNo.toString(),!1)}}};if(5==t.ScreenObject.DocumentType&&t.ScreenObject.GridDataColumns.Contains("RecievedQty")&&!o.e.IsEmpty(t.ScreenObject.GridData[a].RecievedQty)){if(o.e.IsEmpty(t.ScreenObject.GridData[a].RecievedQtyXML))return{v:{v:{v:(t.DisplayMessage="Serial Numbers not defined for RecievedQty at row "+t.ScreenObject.GridData[a].DocSeqNo.toString(),!1)}}};y.LoadXml(t.ScreenObject.GridData[a].RecievedQtyXML);var p=y.SelectNodes("xml/Row");if(parseInt(t.ScreenObject.GridData[a].RecievedQty)!=p.length)return{v:{v:{v:(t.DisplayMessage="Serial Numbers not defined for RecievedQty at row "+t.ScreenObject.GridData[a].DocSeqNo.toString(),!1)}}}}}if(n&&t.ScreenObject.Preferences.ContainsKey("EnableAssetSerialNo")&&"true"==t.ScreenObject.Preferences.EnableAssetSerialNo.toLowerCase()&&!o.e.IsEmpty(t.ScreenObject.GridData[a].Quantity)){var g=0;if(t.ScreenObject.Preferences.ContainsKey("AssetBasedOn")&&t.ScreenObject.GridDataColumns.Contains(t.ScreenObject.Preferences.AssetBasedOn)?"0"==t.ScreenObject.GridData[a][t.ScreenObject.Preferences.AssetBasedOn].toString()?g=0:"1"!=t.ScreenObject.GridData[a][t.ScreenObject.Preferences.AssetBasedOn].toString()&&"2"!=t.ScreenObject.GridData[a][t.ScreenObject.Preferences.AssetBasedOn].toString()||o.e.IsEmpty(t.ScreenObject.GridData[a].Quantity)?"3"!=t.ScreenObject.GridData[a][t.ScreenObject.Preferences.AssetBasedOn].toString()&&"4"!=t.ScreenObject.GridData[a][t.ScreenObject.Preferences.AssetBasedOn].toString()||(g=1):g=parseFloat(t.ScreenObject.GridData[a].Quantity):o.e.IsEmpty(t.ScreenObject.GridData[a].Quantity)||(g=parseFloat(t.ScreenObject.GridData[a].Quantity)),g>0){if(o.e.IsEmpty(t.ScreenObject.GridData[a].ExtraXML))return{v:{v:{v:(t.DisplayMessage=s.a.GetResource("Doc_SerialNoProductQtyMisMatch")+" "+t.ScreenObject.GridData[a].DocSeqNo.toString(),!1)}}};y.LoadXml(t.ScreenObject.GridData[a].ExtraXML);var O=y.SelectNodes("xml/Row");if(g>=1&&g!=O.length||g<1&&O.length>1)return{v:{v:{v:(t.DisplayMessage=s.a.GetResource("Doc_SerialNoProductQtyMisMatch")+" "+t.ScreenObject.GridData[a].DocSeqNo.toString(),!1)}}}}else t.ScreenObject.GridData[a].ExtraXML=""}if(!t.ScreenObject.GridDataColumns.Contains("UOMConversion")||!o.e.IsEmpty(t.ScreenObject.GridData[a].UOMConversion)&&o.e.IsNum(t.ScreenObject.GridData[a].UOMConversion)&&0!=parseFloat(t.ScreenObject.GridData[a].UOMConversion)||(t.ScreenObject.GridData[a].UOMConversion="1",o.e.IsEmpty(t.ScreenObject.GridData[a].Quantity)?(t.ScreenObject.GridData[a].UOMConvertedQty=0,t.ScreenObject.GridData[a].Quantity=0):t.ScreenObject.GridData[a].UOMConvertedQty=t.ScreenObject.GridData[a].Quantity.toString()),t.ScreenObject.Preferences.ContainsKey("AutoAdjustBins")&&!o.e.IsEmpty(t.ScreenObject.Preferences.AutoAdjustBins)&&Object(l.j)(t.ScreenObject.Preferences.AutoAdjustBins)&&(o.e.IsEmpty(t.ScreenObject.GridData[a].DocDetailsID)||0==parseInt(t.ScreenObject.GridData[a].DocDetailsID))&&t.AddBins(t.ScreenObject.GridData[a],!1,!1,null,!0),S=0,t.DonotUpdateInventory?t.ScreenObject.Preferences.ContainsKey("ExcludeHoldBins")&&!o.e.IsEmpty(t.ScreenObject.Preferences.ExcludeHoldBins)&&Object(l.j)(t.ScreenObject.Preferences.ExcludeHoldBins)&&(t.ScreenObject.GridDataColumns.Contains("ReserveQuantity")||t.ScreenObject.GridDataColumns.Contains("HoldQuantity"))&&(t.ScreenObject.GridDataColumns.Contains("ReserveQuantity")&&!o.e.IsEmpty(t.ScreenObject.GridData[a].ReserveQuantity)&&parseFloat(t.ScreenObject.GridData[a].ReserveQuantity)>0&&(S=parseFloat(t.ScreenObject.GridData[a].ReserveQuantity)),t.ScreenObject.GridDataColumns.Contains("HoldQuantity")&&!o.e.IsEmpty(t.ScreenObject.GridData[a].HoldQuantity)&&parseFloat(t.ScreenObject.GridData[a].HoldQuantity)>0&&(S=parseFloat(t.ScreenObject.GridData[a].HoldQuantity))):(1==v&&t.ScreenObject.GridDataColumns.Contains("RecievedQty")?!o.e.IsEmpty(t.ScreenObject.GridData[a].RecievedQty)&&parseFloat(t.ScreenObject.GridData[a].RecievedQty)>0&&(S=parseFloat(t.ScreenObject.GridData[a].RecievedQty)):!o.e.IsEmpty(t.ScreenObject.GridData[a].Quantity)&&parseFloat(t.ScreenObject.GridData[a].Quantity)>0?S=parseFloat(t.ScreenObject.GridData[a].Quantity):t.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!o.e.IsEmpty(t.ScreenObject.GridData[a].FreeQTY)&&parseFloat(t.ScreenObject.GridData[a].FreeQTY)>0?S=parseFloat(t.ScreenObject.GridData[a].FreeQTY):t.ScreenObject.GridDataColumns.Contains("FreeQTY")||o.e.IsEmpty(t.ScreenObject.GridData[a].Quantity)||(S=parseFloat(t.ScreenObject.GridData[a].Quantity)),t.ScreenObject.GridDataColumns.Contains("UOMConversion")&&!o.e.IsEmpty(t.ScreenObject.GridData[a].UOMConversion)&&(S*=parseFloat(t.ScreenObject.GridData[a].UOMConversion))),n&&S>0&&t.ScreenObject.GridDataColumns.Contains("BinWise")&&"True"==t.ScreenObject.GridData[a].BinWise.toString()){var I={DimensionID:0};if(t.IsWarehouseBinwise(a,v,I)){if(!t.ScreenObject.GridDataColumns.Contains("BinStatus")){if(1==v){if(o.e.IsEmpty(t.ScreenObject.GridData[a].TOBinsXML)&&t.ScreenObject.Preferences.ContainsKey("AutoSelectBins")&&"true"==t.ScreenObject.Preferences.AutoSelectBins.toLowerCase()){var T=0;s.a.SessionManager.Preferences.ContainsKey("DimensionwiseBins")&&""!=s.a.SessionManager.Preferences.DimensionwiseBins.toString()&&(T=o.e.Int(s.a.SessionManager.Preferences.DimensionwiseBins)),t.AddToWarehouseBins(T,t.ScreenObject.GridData[a],S,!0)}if(o.e.IsEmpty(t.ScreenObject.GridData[a].TOBinsXML)&&S>0)return{v:{v:{v:(t.DisplayMessage=s.a.GetResource("Doc_BinsMissMatch")+" "+t.ScreenObject.GridData[a].DocSeqNo.toString(),!1)}}};o.e.IsEmpty(t.ScreenObject.GridData[a].TOBinsXML)||y.LoadXml(t.ScreenObject.GridData[a].TOBinsXML)}else{if(o.e.IsEmpty(t.ScreenObject.GridData[a].BinsXML)&&t.ScreenObject.Preferences.ContainsKey("AutoSelectBins")&&"true"==t.ScreenObject.Preferences.AutoSelectBins.toLowerCase()&&t.AddBins(t.ScreenObject.GridData[a],!0,!1,null),o.e.IsEmpty(t.ScreenObject.GridData[a].BinsXML)&&S>0)return{v:{v:{v:(t.DisplayMessage=s.a.GetResource("Doc_BinsMissMatch")+" "+t.ScreenObject.GridData[a].DocSeqNo.toString(),!1)}}};o.e.IsEmpty(t.ScreenObject.GridData[a].BinsXML)||y.LoadXml(t.ScreenObject.GridData[a].BinsXML)}if(S>0){for(var j=y.SelectNodes("BinsXML/Row"),P=0;P<j.length;P++)if(null!=j[P].attributes.Allocate.value&&""!=j[P].attributes.Allocate.value&&(c+=parseFloat(j[P].attributes.Allocate.value)),null!=j[P].attributes.Warehouse&&!o.e.IsEmpty(j[P].attributes.Warehouse.value)&&j[P].attributes.Warehouse.value!=I.DimensionID.toString())return{v:{v:{v:(t.DisplayMessage=s.a.GetResource("Doc_BinsMissMatch")+" "+t.ScreenObject.GridData[a].DocSeqNo.toString(),!1)}}};if(S.ToString("N"+Ee)!=c.ToString("N"+Ee))return{v:{v:{v:(t.DisplayMessage=s.a.GetResource("Doc_BinsMissMatch")+" "+t.ScreenObject.GridData[a].DocSeqNo.toString(),!1)}}}}}}else 1==v?t.ScreenObject.GridData[a].TOBinsXML='<BinsXML> <Row  NodeID="1" Allocate="'+S+'" ></Row></BinsXML>':t.ScreenObject.GridData[a].BinsXML='<BinsXML> <Row  NodeID="1" Allocate="'+S+'" ></Row></BinsXML>'}if(c=0,S=0,t.ScreenObject.Preferences.ContainsKey("ExcludeHold")&&""!=t.ScreenObject.Preferences.ExcludeHold.toString()&&Object(l.j)(t.ScreenObject.Preferences.ExcludeHold)&&t.ScreenObject.GridDataColumns.Contains("HoldQuantity")&&(S=!o.e.IsEmpty(t.ScreenObject.GridData[a].HoldQuantity)&&parseFloat(t.ScreenObject.GridData[a].HoldQuantity)>0?parseFloat(t.ScreenObject.GridData[a].HoldQuantity):0),t.ScreenObject.Preferences.ContainsKey("ExcludeReserve")&&""!=t.ScreenObject.Preferences.ExcludeReserve.toString()&&Object(l.j)(t.ScreenObject.Preferences.ExcludeReserve)&&t.ScreenObject.GridDataColumns.Contains("ReserveQuantity")&&(S=!o.e.IsEmpty(t.ScreenObject.GridData[a].ReserveQuantity)&&parseFloat(t.ScreenObject.GridData[a].ReserveQuantity)>0?parseFloat(t.ScreenObject.GridData[a].ReserveQuantity):0),32==t.DocumentType){var A="",M=t.ScreenObject.ColumnSource.find((function(e){return e.ID==t.ScreenObject.Preferences.VarienceField}));M&&(A=M.DisplayMember),""!=A&&t.ScreenObject.GridDataColumns.Contains(A)&&!o.e.IsEmpty(t.ScreenObject.GridData[a][A])&&(S=parseFloat(t.ScreenObject.GridData[a][A].toString().replace("-","")))}if(-1!=t.VoucherType||!(i||t.ScreenObject.Preferences.ContainsKey("AutoBatches")&&""!=t.ScreenObject.Preferences.AutoBatches.toString()&&Object(l.j)(t.ScreenObject.Preferences.AutoBatches))||"8"!=o.e.String(t.ScreenObject.GridData[a].Type)&&"3"!=o.e.String(t.ScreenObject.GridData[a].Type)&&"11"!=o.e.String(t.ScreenObject.GridData[a].Type)&&"12"!=o.e.String(t.ScreenObject.GridData[a].Type)||t.FillAutoBatchesforDynamic(a),n&&(!t.DonotUpdateInventory||S>0)&&!o.e.IsEmpty(t.ScreenObject.GridData[a].Type)&&5==parseInt(t.ScreenObject.GridData[a].Type)&&(!t.ScreenObject.Preferences.ContainsKey("SameBatchtoall")||"true"!=t.ScreenObject.Preferences.SameBatchtoall.toLowerCase())&&(!r||!t.ScreenObject.Preferences.ContainsKey("BatchBasedon")||""==t.ScreenObject.Preferences.BatchBasedon)&&(!o.e.IsEmpty(t.ScreenObject.GridData[a].Quantity)&&parseFloat(t.ScreenObject.GridData[a].Quantity)>0||S>0||32==t.DocumentType||t.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!o.e.IsEmpty(t.ScreenObject.GridData[a].FreeQTY)&&parseFloat(t.ScreenObject.GridData[a].FreeQTY)>0)){if(-1==t.VoucherType&&(t.ScreenObject.Preferences.ContainsKey("AutoBatches")&&""!=t.ScreenObject.Preferences.AutoBatches.toString()&&Object(l.j)(t.ScreenObject.Preferences.AutoBatches)&&(o.e.IsEmpty(t.ScreenObject.GridData[a].DocDetailsID)||0==parseInt(t.ScreenObject.GridData[a].DocDetailsID))||i&&o.e.IsEmpty(t.ScreenObject.GridData[a].ExtraXML))){var G,N=0;if(t.ScreenObject.Preferences.ContainsKey("Donotuselocation")&&""!=t.ScreenObject.Preferences.Donotuselocation&&Object(l.j)(t.ScreenObject.Preferences.Donotuselocation)){var E=t.ScreenObject._CCFields.find((function(e){return"dcccnid2"==e.DBColumnName.toLowerCase()}));E&&E instanceof C.b&&E.SelectedValue>0?N=E.SelectedValue:t.ScreenObject.GridDataColumns.Contains("dcCCNID2_Key")&&!o.e.IsEmpty(t.ScreenObject.GridData[a].dcCCNID2_Key)&&(N=parseInt(t.ScreenObject.GridData[a].dcCCNID2_Key))}else N=t.ScreenObject.LocationID>0?t.ScreenObject.LocationID:s.a.SessionManager.LocationID;G=t.ScreenObject.DivisionID>0?t.ScreenObject.DivisionID:s.a.SessionManager.DivisionID,0==S&&(!o.e.IsEmpty(t.ScreenObject.GridData[a].Quantity)&&parseFloat(t.ScreenObject.GridData[a].Quantity)>0&&(S=parseFloat(t.ScreenObject.GridData[a].Quantity)),t.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!o.e.IsEmpty(t.ScreenObject.GridData[a].FreeQTY)&&parseFloat(t.ScreenObject.GridData[a].FreeQTY)>0&&(S=parseFloat(t.ScreenObject.GridData[a].FreeQTY)),t.ScreenObject.GridDataColumns.Contains("UOMConversion")&&!o.e.IsEmpty(t.ScreenObject.GridData[a].UOMConversion)&&(S*=parseFloat(t.ScreenObject.GridData[a].UOMConversion)));var w=new Pe.a(t.ScreenObject.GridDataObj);if(w.BatchNumberViewModel_3(t,t.VoucherType,S,parseInt(t.ScreenObject.GridData[a].ProductID_Key),t.ScreenObject.GridData[a].ProductName.toString(),N,G,t.ScreenObject.GridData[a]),w.ChkFifo=!0,w.OnSave("AutoSave"),w.count>1&&t.ScreenObject.UpdateSequence(),S=0,t.ScreenObject.Preferences.ContainsKey("ExcludeHold")&&""!=t.ScreenObject.Preferences.ExcludeHold.toString()&&Object(l.j)(t.ScreenObject.Preferences.ExcludeHold)&&t.ScreenObject.GridDataColumns.Contains("HoldQuantity")&&(S=!o.e.IsEmpty(t.ScreenObject.GridData[a].HoldQuantity)&&parseFloat(t.ScreenObject.GridData[a].HoldQuantity)>0?parseFloat(t.ScreenObject.GridData[a].HoldQuantity):0),t.ScreenObject.Preferences.ContainsKey("ExcludeReserve")&&""!=t.ScreenObject.Preferences.ExcludeReserve.toString()&&Object(l.j)(t.ScreenObject.Preferences.ExcludeReserve)&&t.ScreenObject.GridDataColumns.Contains("ReserveQuantity")&&(S=!o.e.IsEmpty(t.ScreenObject.GridData[a].ReserveQuantity)&&parseFloat(t.ScreenObject.GridData[a].ReserveQuantity)>0?parseFloat(t.ScreenObject.GridData[a].ReserveQuantity):0),32==t.DocumentType){var F="",V=t.ScreenObject.ColumnSource.find((function(e){return e.ID==t.ScreenObject.Preferences.VarienceField}));V&&(F=V.DisplayMember),""!=F&&t.ScreenObject.GridDataColumns.Contains(F)&&!o.e.IsEmpty(t.ScreenObject.GridData[a][F])&&(S=parseFloat(t.ScreenObject.GridData[a][F].toString().replace("-","")))}}if(0==S&&(!o.e.IsEmpty(t.ScreenObject.GridData[a].Quantity)&&parseFloat(t.ScreenObject.GridData[a].Quantity.toString())>0&&(S=parseFloat(t.ScreenObject.GridData[a].Quantity.toString())),t.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!o.e.IsEmpty(t.ScreenObject.GridData[a].FreeQTY)&&parseFloat(t.ScreenObject.GridData[a].FreeQTY.toString())>0&&(S=parseFloat(t.ScreenObject.GridData[a].FreeQTY.toString())),t.ScreenObject.GridDataColumns.Contains("UOMConversion")&&!o.e.IsEmpty(t.ScreenObject.GridData[a].UOMConversion)&&(S*=parseFloat(t.ScreenObject.GridData[a].UOMConversion.toString()))),!r)if(o.e.IsEmpty(t.ScreenObject.GridData[a].ExtraXML)){if(32!=t.DocumentType||S>0)return{v:{v:{v:(t.DisplayMessage=s.a.GetResource("Doc_BatchQtyMissMatch")+" "+t.ScreenObject.GridData[a].DocSeqNo.toString(),!1)}}}}else{y.LoadXml(t.ScreenObject.GridData[a].ExtraXML);var L=y.SelectNodes("xml/Row");0==S&&(!o.e.IsEmpty(t.ScreenObject.GridData[a].Quantity)&&parseFloat(t.ScreenObject.GridData[a].Quantity)>0&&(S=parseFloat(t.ScreenObject.GridData[a].Quantity)),t.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!o.e.IsEmpty(t.ScreenObject.GridData[a].FreeQTY)&&parseFloat(t.ScreenObject.GridData[a].FreeQTY)>0&&(S=parseFloat(t.ScreenObject.GridData[a].FreeQTY)),t.ScreenObject.GridDataColumns.Contains("UOMConversion")&&!o.e.IsEmpty(t.ScreenObject.GridData[a].UOMConversion)&&(S*=parseFloat(t.ScreenObject.GridData[a].UOMConversion)));for(var R=0;R<L.length;R++){if(null!=L[R].attributes.ProductID.value&&""!=L[R].attributes.ProductID.value&&!o.e.IsEmpty(t.ScreenObject.GridData[a].ProductID_Key)&&parseInt(L[R].attributes.ProductID.value)!=parseInt(t.ScreenObject.GridData[a].ProductID_Key))return{v:{v:{v:(t.DisplayMessage=s.a.GetResource("Doc_BatchQtyMissMatch")+" "+t.ScreenObject.GridData[a].DocSeqNo.toString(),!1)}}};if(null!=L[R].attributes.Quantity.value&&""!=L[R].attributes.Quantity.value&&(c+=parseFloat(L[R].attributes.Quantity.value)),30==t.ScreenObject.DocumentType&&t.ScreenObject.GridDataColumns.Contains("VoucherType")&&"-1"==t.ScreenObject.GridData[a].VoucherType.toString()&&null!=L[R].attributes.Release&&null!=L[R].attributes.Release.value&&""!=L[R].attributes.Release.value)return{v:{v:{v:(t.DisplayMessage=s.a.GetResource("Doc_BatchQtyMissMatch")+" "+t.ScreenObject.GridData[a].DocSeqNo.toString(),!1)}}}}if(S.ToString("N"+Ee)!=c.ToString("N"+Ee))return{v:{v:{v:(t.DisplayMessage=s.a.GetResource("Doc_BatchQtyMissMatch")+" "+t.ScreenObject.GridData[a].DocSeqNo.toString(),!1)}}}}}if(("CheckoutPrint"==e.toString()||"CheckoutSave"==e.toString()||!n)&&null!=t.POSPayModes)if(1==be){var B=function(){t.POSPayModes.RedeemPoints=0,t.POSpayXml="";var n=[];if(t.POSPayModes.GridData.length>0){for(var a,i=function(e){if(o.e.IsEmpty(t.POSPayModes.GridData[e].ColumnName))return"continue";"13"==t.POSPayModes.GridData[e].Type.toString()&&(t.POSPayModes.RedeemPoints=parseFloat(t.POSPayModes.GridData[e].Amount));var i=n.filter((function(n){return n.ColumnName==t.POSPayModes.GridData[e].ColumnName}));0==i.length?((a={}).Name=t.POSPayModes.GridData[e].Name.toString(),a.ColumnName=t.POSPayModes.GridData[e].ColumnName.toString(),a.Amount=t.POSPayModes.GridData[e].Amount.toString(),a.Description=o.e.StringValue(t.POSPayModes.GridData[e].Description),a.Details=t.POSPayModes.GridData[e].Details.toString(),a.Denomination=o.e.StringValue(t.POSPayModes.GridData[e].Denomination),n.push(a)):((a=i[0]).Amount=parseFloat(a.Amount)+parseFloat(t.POSPayModes.GridData[e].Amount),a.Details=a.Details.toString()+t.POSPayModes.GridData[e].Details.toString(),a.Denomination=o.e.StringValue(a.Denomination)+o.e.StringValue(t.POSPayModes.GridData[e].Denomination))},r=0;r<t.POSPayModes.GridData.length;r++)i(r);o.e.IsEmpty(t.POSPayModes.Return)||!o.e.IsNum(t.POSPayModes.Return)||o.e.IsEmpty(t.POSPayModes.Returnfld)||((a={}).Name=t.POSPayModes.ReturnLabel,a.ColumnName=t.POSPayModes.Returnfld,a.Amount=t.POSPayModes.Return.replace("-",""),t.POSpayXml='<XML Amount="'+a.Amount.toString()+'" DBColumnName="'+t.POSPayModes.Returnfld+'" ',t.POSpayXml+=' RegisterID="'+t.ScreenObject.RegisterNodeID+'" ',t.POSpayXml+=' ShiftID="'+t.ScreenObject.ShiftNodeID+'" ',t.POSpayXml+=' DocDate="'+t.DocumentDate.ToString("dd/MMM/yyyy")+'" ',t.POSpayXml+=' Type="12" />',a.Details=t.POSpayXml,n.push(a),t.POSpayXml="")}for(var s=function(e){se+=n[e].ColumnName.toString()+"="+n[e].Amount.toString()+", ",se+="dcCalc"+n[e].ColumnName.toString().replace("dc","")+"="+n[e].Amount.toString()+", ",t.POSpayXml+=o.e.StringValue(n[e].Details),t.POSpayXml+=o.e.StringValue(n[e].Denomination);var a=new f.a,i=t.ScreenObject.Data.Tables[0].filter((function(t){return t.SysColumnName==n[e].ColumnName}));if(a.Header=i[0].ResourceData.toString(),a.DisplayMember=i[0].SysColumnName,o.e.IsEmpty(i[0].PostingType)||(a.PostingType=parseInt(i[0].PostingType)),o.e.IsEmpty(i[0].DebitAccount)||(a.DebitAccount=parseInt(i[0].DebitAccount)),o.e.IsEmpty(i[0].CreditAccount)||(a.CreditAcount=parseInt(i[0].CreditAccount)),a.DefCreditAcount=a.CreditAcount,a.DefDebitAccount=a.DebitAccount,o.e.IsEmpty(i[0].CRSysColumnName)||(a.CrRefColName=i[0].CRSysColumnName.toString()),o.e.IsEmpty(i[0].CrRefColID)||(a.CrRefColID=parseInt(i[0].CrRefColID)),o.e.IsEmpty(i[0].CrRefID)||(a.CrRefID=parseInt(i[0].CrRefID)),o.e.IsEmpty(i[0].CRSection)||(a.CrRefSection=parseInt(i[0].CRSection)),o.e.IsEmpty(i[0].DRSysColumnName)||(a.DrRefColName=i[0].DRSysColumnName.toString()),o.e.IsEmpty(i[0].DrRefColID)||(a.DrRefColID=parseInt(i[0].DrRefColID)),o.e.IsEmpty(i[0].DrRefID)||(a.DrRefID=parseInt(i[0].DrRefID)),o.e.IsEmpty(i[0].DrSection)||(a.DrRefSection=parseInt(i[0].DrSection)),!(b||3!=a.PostingType&&4!=a.PostingType||o.e.IsEmpty(n[e].Amount)||0==parseFloat(n[e].Amount))){var r={DBAcc:0,CrACC:0,PostingXml:""};if(!t.FillAccountPosting(a,t.ScreenObject.GridData[0],n[e].Amount.toString(),1,1,r))return{v:{v:{v:{v:{v:!1}}}}};ie+=r.PostingXml,t.ScreenObject.FillBillWiseDt(t.BillWisedt,t.BillWisedtColumns,r.CrACC.toString(),n[e].Amount.toString(),!0,1,1,1,a.DecimalPoints),t.ScreenObject.FillBillWiseDt(t.BillWisedt,t.BillWisedtColumns,r.DBAcc.toString(),n[e].Amount.toString(),!1,1,1,1,a.DecimalPoints)}},c=0;c<n.length;c++){var l=s(c);if("object"==typeof l)return l.v}t.ScreenObject.DocID>0&&(t.POSPayModes.PayModes.forEach((function(e){se.toString().Contains(e.DBColumnName)||(se+=e.DBColumnName+"=0, ",se+="dcCalc"+e.DBColumnName.replace("dc","")+"=0, ")})),o.e.IsEmpty(t.POSPayModes.Returnfld)||se.toString().Contains(t.POSPayModes.Returnfld)||(se+=t.POSPayModes.Returnfld+"=0, ",se+="dcCalc"+t.POSPayModes.Returnfld.replace("dc","")+"=0, ")),t.POSpayXml.length>0&&(t.POSpayXml="<PosPayModes>"+t.POSpayXml+"</PosPayModes>"),e="CheckoutPrint"==e.toString()?"SaveAndPrint":"Save"}();if("object"==typeof B)return B.v}else t.ScreenObject.DocID>0&&(t.POSPayModes.PayModes.forEach((function(e){se+=e.DBColumnName+"=0, ",se+="dcCalc"+e.DBColumnName.replace("dc","")+"=0, "})),o.e.IsEmpty(t.POSPayModes.Returnfld)||se.toString().Contains(t.POSPayModes.Returnfld)||(se+=t.POSPayModes.Returnfld+"=0, ",se+="dcCalc"+t.POSPayModes.Returnfld.replace("dc","")+"=0, "));for(var x=void 0,k=void 0,_=!1,K=function(i){if((x=t.ScreenObject.ColumnSource[i].DisplayMember).toLowerCase().Contains("exchangerate")||"AppRemarks"==x||"FreeQTY"==x||x.toLowerCase().Contains("currencyid")||t.ScreenObject.ColumnSource[i].CostCenterID>0&&x.endsWith("Code"))return"continue";k=x,"RefNo"==x&&(k="RefNO");var r=t.GetCurrencyID(a),c=t.GetExchRate(a);if(n&&t.ScreenObject.ColumnSource[i].Mandatory&&!o.e.IsEmpty(t.ScreenObject.GridData[a].Type)&&8!=parseInt(t.ScreenObject.GridData[a].Type)&&!D){if(0!=t.ScreenObject.ColumnSource[i].CostCenterID&&"SELECTIONBOX"!=t.ScreenObject.ColumnSource[i].DataType&&(o.e.IsEmpty(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[i].ValueMember])||parseInt(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[i].ValueMember])<1&&(3!=t.ScreenObject.ColumnSource[i].CostCenterID||"8"!=t.ScreenObject.GridData[a].Type.toString())))return{v:{v:{v:{v:(t.DisplayMessage=s.a.GetResource("Doc_Select")+t.ScreenObject.ColumnSource[i].Header+" "+t.ScreenObject.GridData[a].DocSeqNo,!1)}}}};if("ComboBox"==t.ScreenObject.ColumnSource[i].DataType&&o.e.IsEmpty(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[i].ValueBinding]))return{v:{v:{v:{v:(t.DisplayMessage=s.a.GetResource("Doc_Select")+t.ScreenObject.ColumnSource[i].Header+" "+t.ScreenObject.GridData[a].DocSeqNo.toString(),!1)}}}};if("PactComboBox"==t.ScreenObject.ColumnSource[i].DataType&&o.e.IsEmpty(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[i].ValueBinding+"_Key"]))return{v:{v:{v:{v:(t.DisplayMessage=s.a.GetResource("Doc_Select")+t.ScreenObject.ColumnSource[i].Header+" "+t.ScreenObject.GridData[a].DocSeqNo.toString(),!1)}}}};if("LINK"==t.ScreenObject.ColumnSource[i].DataType&&x.toLowerCase().Contains("dcalpha")){if(null==t.ViewAttachments.AttachmentsList.find((function(e){return e.RowID==t.ScreenObject.GridData[a]&&e.ColID==x})))return{v:{v:{v:{v:(t.DisplayMessage=s.a.GetResource("Doc_Select")+t.ScreenObject.ColumnSource[i].Header+" "+t.ScreenObject.GridData[a].DocSeqNo.toString(),!1)}}}}}else if("PactComboBox"!=t.ScreenObject.ColumnSource[i].DataType&&"ComboBox"!=t.ScreenObject.ColumnSource[i].DataType&&"LISTBOX"!=t.ScreenObject.ColumnSource[i].DataType&&(o.e.IsEmpty(t.ScreenObject.GridData[a][x])||"FLOAT"==t.ScreenObject.ColumnSource[i].DataType&&!o.e.IsEmpty(t.ScreenObject.GridData[a][x])&&0==parseFloat(t.ScreenObject.GridData[a][x])))return{v:{v:{v:{v:(t.DisplayMessage=s.a.GetResource("Doc_Enter")+t.ScreenObject.ColumnSource[i].Header+" "+t.ScreenObject.GridData[a].DocSeqNo.toString(),!1)}}}}}if(t.ScreenObject.IsPayrollDocument){if(n&&!t.ValidateDataonSave_col_dr(t.ScreenObject.ColumnSource[i],t.ScreenObject.GridData[a]))return{v:{v:{v:{v:!1}}}}}else if(n&&!o.e.IsEmpty(t.ScreenObject.GridData[a].Type)&&8!=parseInt(t.ScreenObject.GridData[a].Type)&&!t.ValidateDataonSave_col_dr(t.ScreenObject.ColumnSource[i],t.ScreenObject.GridData[a]))return{v:{v:{v:{v:!1}}}};if("FillGUID"!=t.ScreenObject.ColumnSource[i].DistributeColName||!o.e.IsEmpty(t.ScreenObject.GridData[a].DocDetailsID)&&parseInt(t.ScreenObject.GridData[a].DocDetailsID)>0||(t.ScreenObject.GridData[a][x]=o.e.NewGuid()),t.ScreenObject.ColumnSource[i].IsColumnUserDefined){if(56671==t.ScreenObject.ColumnSource[i].linkData||x.toLowerCase().Contains("dcexchrt")||x.toLowerCase().Contains("dccurrid"))return"continue";if(x.toLowerCase().Contains("dcnum")){if(t.ScreenObject.Preferences.ContainsKey("JobRemainingQty")&&t.ScreenObject.GridDataColumns.Contains("RemQty")&&x.toLowerCase()==t.ScreenObject.Preferences.JobRemainingQty.toLowerCase())return"continue";if(s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"]))if("-2"==t.ScreenObject.ColumnSource[i].DefaultValue)if(4==t.ScreenObject.ColumnSource[i].SectionID){var u=t.ScreenObject.FooterGridData.filter((function(e){return e.ColumnName==x}));u.length>0&&(o.e.IsEmpty(u[0].dcCurrID_Key)||(r=parseInt(u[0].dcCurrID_Key),c=o.e.IsEmpty(u[0].dcExchRT)?1:parseFloat(u[0].dcExchRT)))}else o.e.IsEmpty(t.ScreenObject.GridData[a]["dcCurrID"+x.toLowerCase().replace("dcnum","")+"_Key"])||(r=parseInt(t.ScreenObject.GridData[a]["dcCurrID"+x.toLowerCase().replace("dcnum","")+"_Key"])),o.e.IsEmpty(t.ScreenObject.GridData[a]["dcExchRT"+x.toLowerCase().replace("dcnum","")])||(c=parseFloat(t.ScreenObject.GridData[a]["dcExchRT"+x.toLowerCase().replace("dcnum","")]));else o.e.Int(t.ScreenObject.ColumnSource[i].DefaultValue)>0&&t.ScreenObject.ColumnSource[i].CurrID>0&&(r=t.ScreenObject.ColumnSource[i].CurrID,c=t.ScreenObject.ColumnSource[i].ExhcgRt);var d=0;t.savebulk?o.e.IsEmpty(t.ScreenObject.GridData[a][x])||(se+=x+'="'+t.ScreenObject.GridData[a][x].toString()+'" ',d=0,d=o.e.Double(t.ScreenObject.GridData[a]["dcCalc"+x]),s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&(se+="dcCurrID"+x.toLowerCase().Replace("dcnum","")+'="'+r+'" ',se+="dcExchRT"+x.toLowerCase().Replace("dcnum","")+'="'+c+'" ',se+="dcCalcNumFC"+x.toLowerCase().Replace("dcnum","")+'="'+d+'" '),se+="dcCalc"+x.Replace("dc","")+'="'+d*c+'" '):(o.e.IsEmpty(t.ScreenObject.GridData[a][x])?se+=x+"=0, ":se+=x+"="+t.ScreenObject.GridData[a][x].toString()+", ",d=0,d=o.e.Double(t.ScreenObject.GridData[a]["dcCalc"+x]),s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&(se+="dcCurrID"+x.toLowerCase().Replace("dcnum","")+"="+r+", ",se+="dcExchRT"+x.toLowerCase().Replace("dcnum","")+"="+c+", ",se+="dcCalcNumFC"+x.toLowerCase().Replace("dcnum","")+"="+d+", "),se+="dcCalc"+x.Replace("dc","")+"="+d*c+", ")}else if("Name"==x||"Year"==x||x.toLowerCase().Contains("dcalpha")||"PactComboBox"==t.ScreenObject.ColumnSource[i].DataType&&t.ScreenObject.ColumnSource[i].ValueBinding.toLowerCase().Contains("dcalpha")){var S={sbText:oe};t.GetRowValue(S,a,i),oe=S.sbText,"DATE"==t.ScreenObject.ColumnSource[i].DataType&&o.e.hasprop(t.ScreenObject.GridData[a],t.ScreenObject.ColumnSource[i].DisplayMember+"_Key")&&""!=t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[i].DisplayMember+"_Key"].toString()&&t.ScreenObject.Preferences.ContainsKey("BUDGET_BudgetDateField")&&!o.e.IsEmpty(t.ScreenObject.Preferences.BUDGET_BudgetDateField)&&t.ScreenObject.ColumnSource[i].DisplayMember==t.ScreenObject.Preferences.BUDGET_BudgetDateField&&(re+=t.ScreenObject.ColumnSource[i].DisplayMember+'="'+new Date(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[i].DisplayMember+"_Key"].toString()).ToString("dd/MMM/yyyy")+'" '),"LISTBOX"==t.ScreenObject.ColumnSource[i].DataType&&0!=t.ScreenObject.ColumnSource[i].CostCenterID&&t.ScreenObject.Preferences.ContainsKey("BUDGET_BudgetAccountField")&&!o.e.IsEmpty(t.ScreenObject.Preferences.BUDGET_BudgetAccountField)&&t.ScreenObject.ColumnSource[i].DisplayMember==t.ScreenObject.Preferences.BUDGET_BudgetAccountField&&(re+=t.ScreenObject.ColumnSource[i].DisplayMember+'="'+t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[i].ValueMember].toString()+'" ')}else 0!=t.ScreenObject.ColumnSource[i].CostCenterID?5==t.ScreenObject.DocumentType&&1==v?t.ScreenObject.ColumnSource[i].DisplayMember.Contains("TO")&&!o.e.IsEmpty(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[i].ValueMember])&&parseInt(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[i].ValueMember])>0?ce+=t.ScreenObject.ColumnSource[i].DisplayMember.replace("TO","")+"="+t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[i].ValueMember].toString()+", ":t.ScreenObject.ColumnSource[i].DisplayMember.Contains("TO")||!t.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember=="TO"+t.ScreenObject.ColumnSource[i].DisplayMember}))&&!o.e.IsEmpty(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[i].ValueMember])&&parseInt(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[i].ValueMember])>0&&(ce+=t.ScreenObject.ColumnSource[i].DisplayMember+"="+t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[i].ValueMember].toString()+", "):5==t.ScreenObject.DocumentType&&0==v&&!t.ScreenObject.ColumnSource[i].DisplayMember.Contains("TO")&&!o.e.IsEmpty(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[i].ValueMember])&&parseInt(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[i].ValueMember])>0?ce+=t.ScreenObject.ColumnSource[i].DisplayMember+"="+t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[i].ValueMember].toString()+", ":5!=t.ScreenObject.DocumentType&&(!o.e.IsEmpty(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[i].ValueMember])&&parseInt(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[i].ValueMember])>0?ce+=t.savebulk?t.ScreenObject.ColumnSource[i].DisplayMember+'="'+t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[i].ValueMember].toString()+'" ':t.ScreenObject.ColumnSource[i].DisplayMember+"="+t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[i].ValueMember].toString()+", ":t.savebulk||(ce+=t.ScreenObject.ColumnSource[i].DisplayMember+"=1, ")):t.savebulk||(oe+=t.ScreenObject.ColumnSource[i].DisplayMember+"=N'"+h.d.GetValidTextXml(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[i].DisplayMember])+"', ")}else 3==t.ScreenObject.ColumnSource[i].CostCenterID?(_||(re+='ProductID="'+t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[i].ValueMember].toString()+'" '),_=!0):0!=t.ScreenObject.ColumnSource[i].CostCenterID?(!o.e.IsEmpty(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[i].ValueMember])&&parseInt(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[i].ValueMember])>0&&"CurrencyID"!=t.ScreenObject.ColumnSource[i].DisplayMember&&(re+=t.ScreenObject.ColumnSource[i].ValueMember.substr(0,t.ScreenObject.ColumnSource[i].ValueMember.length-4)+'="'+t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[i].ValueMember].toString()+'" '),"unit"==t.ScreenObject.ColumnSource[i].DisplayMember.toLowerCase()&&(t.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!o.e.IsEmpty(t.ScreenObject.GridData[a].FreeQTY)&&parseFloat(t.ScreenObject.GridData[a].FreeQTY)>0&&(t.ScreenObject.GridData[a].UOMConvertedQty=o.e.IsEmpty(t.ScreenObject.GridData[a].UOMConversion)?t.ScreenObject.GridData[a].FreeQTY.toString():parseFloat(t.ScreenObject.GridData[a].FreeQTY)*parseFloat(t.ScreenObject.GridData[a].UOMConversion)),re+='UOMConversion="'+t.ScreenObject.GridData[a].UOMConversion.toString()+'" ',5==t.ScreenObject.DocumentType&&1==v&&t.ScreenObject.GridDataColumns.Contains("RecievedQty")?o.e.IsEmpty(t.ScreenObject.GridData[a].RecievedQty)?re+='UOMConvertedQty="0" ':o.e.IsEmpty(t.ScreenObject.GridData[a].UOMConversion)?re+='UOMConvertedQty="'+t.ScreenObject.GridData[a].RecievedQty.toString()+'" ':re+='UOMConvertedQty="'+parseFloat(t.ScreenObject.GridData[a].UOMConversion)*parseFloat(t.ScreenObject.GridData[a].RecievedQty)+'" ':38==t.ScreenObject.DocumentType&&!o.e.IsEmpty(t.ScreenObject.GridData[a].Quantity)&&parseFloat(t.ScreenObject.GridData[a].Quantity)<0?re+='UOMConvertedQty="'+t.ScreenObject.GridData[a].UOMConvertedQty.toString().replace("-","")+'" ':re+='UOMConvertedQty="'+t.ScreenObject.GridData[a].UOMConvertedQty.toString()+'" ')):"DocDetailsID"==t.ScreenObject.ColumnSource[i].DisplayMember?5==t.ScreenObject.DocumentType&&1==v?(!o.e.IsEmpty(t.ScreenObject.GridData[a].TODocDetailsID)&&(parseInt(t.ScreenObject.GridData[a].TODocDetailsID)>0||parseInt(t.ScreenObject.GridData[a].TODocDetailsID)<-1e4)&&(Fe+="~"+t.ScreenObject.GridData[a].TODocDetailsID.toString()),o.e.IsEmpty(t.ScreenObject.GridData[a].TODocDetailsID)?re+=' DocDetailsID="0" ':re+=' DocDetailsID="'+t.ScreenObject.GridData[a].TODocDetailsID.toString()+'" '):(!o.e.IsEmpty(t.ScreenObject.GridData[a].DocDetailsID)&&(parseInt(t.ScreenObject.GridData[a].DocDetailsID)>0||parseInt(t.ScreenObject.GridData[a].DocDetailsID)<-1e4)&&(Fe+="~"+t.ScreenObject.GridData[a].DocDetailsID.toString()),null==t.ScreenObject.GridData[a].DocDetailsID&&(t.ScreenObject.GridData[a].DocDetailsID=0),re+=' DocDetailsID="'+t.ScreenObject.GridData[a].DocDetailsID+'" ',t.savebulk&&(ce+=' DocDetailsID="'+t.ScreenObject.GridData[a].DocDetailsID+'" ',oe+=' DocDetailsID="'+t.ScreenObject.GridData[a].DocDetailsID+'" ',se+=' DocDetailsID="'+t.ScreenObject.GridData[a].DocDetailsID+'" ')):"ComboBox"==t.ScreenObject.ColumnSource[i].DataType?re+=t.ScreenObject.ColumnSource[i].ValueBinding+'="'+h.d.GetValidXml(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[i].ValueBinding])+'" ':"quantity"==t.ScreenObject.ColumnSource[i].DisplayMember.toLowerCase()?5==t.ScreenObject.DocumentType&&1==v&&t.ScreenObject.GridDataColumns.Contains("RecievedQty")?o.e.IsEmpty(t.ScreenObject.GridData[a].RecievedQty)?re+=t.ScreenObject.ColumnSource[i].DisplayMember+'="0" ':re+=t.ScreenObject.ColumnSource[i].DisplayMember+'="'+h.d.GetValidXml(t.ScreenObject.GridData[a].RecievedQty)+'" ':!o.e.IsEmpty(t.ScreenObject.GridData[a].SchemeID)&&parseInt(t.ScreenObject.GridData[a].SchemeID)>0&&t.ScreenObject.GridDataColumns.Contains("FreeQTY")&&"Y"==t.ScreenObject.GridData[a].IsScheme.toString()?re+=t.ScreenObject.ColumnSource[i].DisplayMember+'="'+h.d.GetValidXml(t.ScreenObject.GridData[a].FreeQTY)+'" ':38==t.ScreenObject.DocumentType&&!o.e.IsEmpty(t.ScreenObject.GridData[a].Quantity)&&parseFloat(t.ScreenObject.GridData[a].Quantity)<0?(re+=t.ScreenObject.ColumnSource[i].DisplayMember+'="'+t.ScreenObject.GridData[a].Quantity.toString().replace("-","")+'" ',re+=' VoucherType="1" '):re+=t.ScreenObject.ColumnSource[i].DisplayMember+'="'+h.d.GetValidXml(t.ScreenObject.GridData[a].Quantity)+'" ':"DATE"==t.ScreenObject.ColumnSource[i].DataType?o.e.IsEmpty(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[i].DisplayMember+"_Key"])||(re+=t.ScreenObject.ColumnSource[i].DisplayMember+'="'+new Date(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[i].DisplayMember+"_Key"]).ToString("dd/MMM/yyyy")+'" '):"DocSeqNo"==t.ScreenObject.ColumnSource[i].DisplayMember?(t.ScreenObject.GridData[a].DocSeqNo=be,re+=t.ScreenObject.ColumnSource[i].DisplayMember+'="'+be+'" ',t.savebulk&&(oe+=t.ScreenObject.ColumnSource[i].DisplayMember+'="'+be+'" ',se+=t.ScreenObject.ColumnSource[i].DisplayMember+'="'+be+'" ',ce+=t.ScreenObject.ColumnSource[i].DisplayMember+'="'+be+'" ')):(38==t.ScreenObject.DocumentType&&!o.e.IsEmpty(t.ScreenObject.GridData[a].Quantity)&&parseFloat(t.ScreenObject.GridData[a].Quantity)<0&&"gross"==x.toLowerCase()?re+=k+'="'+t.ScreenObject.GridData[a][x].toString().replace("-","")+'" ':re+=k+'="'+h.d.GetValidXml(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[i].DisplayMember])+'" ',null!=e&&"SaveonHold"==e.toString()&&"quantity"==x.toLowerCase()&&(t.ScreenObject.ColumnSource.find((function(e){return"holdquantity"==e.DisplayMember.toLowerCase()}))||(re+='HoldQuantity="'+h.d.GetValidXml(t.ScreenObject.GridData[a][x])+'" ')));var m="";if("ComboBox"!=t.ScreenObject.ColumnSource[i].DataType&&t.ScreenObject.ColumnSource[i].PostingType>0&&(m=o.e.String(t.ScreenObject.GridData[a][x])),x.toLowerCase().Contains("dcnum")&&(m=o.e.String(t.ScreenObject.GridData[a]["dcCalc"+t.ScreenObject.ColumnSource[i].DisplayMember])),(5==t.DocumentType&&0==v&&2==t.ScreenObject.ColumnSource[i].Dependancy||5==t.DocumentType&&1==v&&3==t.ScreenObject.ColumnSource[i].Dependancy)&&(m=""),!t.ScreenObject.Preferences.ContainsKey("KitAccPosting")||"True"!=t.ScreenObject.Preferences.KitAccPosting||"8"!=o.e.String(t.ScreenObject.GridData[a].Type)&&"3"!=o.e.String(t.ScreenObject.GridData[a].Type)&&"11"!=o.e.String(t.ScreenObject.GridData[a].Type)&&"12"!=o.e.String(t.ScreenObject.GridData[a].Type)||(m=""),null==e||"SaveonHold"==e.toString()||b||3!=t.ScreenObject.ColumnSource[i].PostingType&&4!=t.ScreenObject.ColumnSource[i].PostingType||""==m||0==o.e.Double(m))4==t.ScreenObject.ColumnSource[i].SectionID&&(""!=t.ScreenObject.ColumnSource[i].Remarks||t.ScreenObject.ColumnSource[i].CreditAcount>0||t.ScreenObject.ColumnSource[i].DebitAccount>0)&&(o.e.IsEmpty(le)&&(le+="<XML>"),le+="<Row ",t.ScreenObject.ColumnSource[i].CreditAcount>0&&(le+=' CreditAcount="'+t.ScreenObject.ColumnSource[i].CreditAcount+'"'),t.ScreenObject.ColumnSource[i].DebitAccount>0&&(le+=' DebitAccount="'+t.ScreenObject.ColumnSource[i].DebitAccount+'"'),le+=' Columnname="'+t.ScreenObject.ColumnSource[i].DisplayMember+'"',le+=' Remarks="'+h.d.GetValidXml(t.ScreenObject.ColumnSource[i].Remarks)+'" />');else{var C={DBAcc:0,CrACC:0,PostingXml:""};if(!t.FillAccountPosting(t.ScreenObject.ColumnSource[i],t.ScreenObject.GridData[a],m,r,c,C,0,be))return{v:{v:{v:{v:!1}}}};var y=C.DBAcc,p=C.CrACC;if(null!=Be||t.ScreenObject.ColumnSource[i].distDim>0){var g={CostXML:""};t.FillCostPosting(y,p,parseFloat(m),t.ScreenObject.GridData[a],Be,r,c,t.ScreenObject.ColumnSource[i],g)?Ve+=g.CostXML:ie+=C.PostingXml,t.ScreenObject.FillBillWiseDt(t.BillWisedt,t.BillWisedtColumns,C.CrACC.toString(),m,!0,r,c,v,t.ScreenObject.ColumnSource[i].NoRoundOff?"6":t.ScreenObject.ColumnSource[i].DecimalPoints,be),t.ScreenObject.FillBillWiseDt(t.BillWisedt,t.BillWisedtColumns,C.DBAcc.toString(),m,!1,r,c,v,t.ScreenObject.ColumnSource[i].NoRoundOff?"6":t.ScreenObject.ColumnSource[i].DecimalPoints,be)}else!Re||xe!=p&&xe!=y||ke!=p&&ke!=y?!t.ScreenObject.Preferences.ContainsKey("DistributeCost")||"True"!=t.ScreenObject.Preferences.DistributeCost.toString()||xe!=C.CrACC&&xe!=C.DBAcc?(ie+=C.PostingXml,t.ScreenObject.FillBillWiseDt(t.BillWisedt,t.BillWisedtColumns,C.CrACC.toString(),m,!0,r,c,v,t.ScreenObject.ColumnSource[i].NoRoundOff?"6":t.ScreenObject.ColumnSource[i].DecimalPoints,be),t.ScreenObject.FillBillWiseDt(t.BillWisedt,t.BillWisedtColumns,C.DBAcc.toString(),m,!1,r,c,v,t.ScreenObject.ColumnSource[i].NoRoundOff?"6":t.ScreenObject.ColumnSource[i].DecimalPoints,be)):xe==C.CrACC?(0==t.ScreenObject.DocID&&(t.ScreenObject.DistributeCostXML+='<Row AccountID="'+C.DBAcc.toString()+'" Amount="'+m+'" />'),t.ScreenObject.FillBillWiseDt(t.BillWisedt,t.BillWisedtColumns,C.CrACC.toString(),m,!0,r,c,v,t.ScreenObject.ColumnSource[i].NoRoundOff?"6":t.ScreenObject.ColumnSource[i].DecimalPoints,be)):(0==t.ScreenObject.DocID&&(t.ScreenObject.DistributeCostXML+='<Row AccountID="'+C.CrACC.toString()+'" Amount="'+m+'" />'),t.ScreenObject.FillBillWiseDt(t.BillWisedt,t.BillWisedtColumns,C.DBAcc.toString(),m,!1,r,c,v,t.ScreenObject.ColumnSource[i].NoRoundOff?"6":t.ScreenObject.ColumnSource[i].DecimalPoints,be)):xe==p?t.ScreenObject.FillBillWiseDt(t.BillWisedt,t.BillWisedtColumns,C.CrACC.toString(),m,!0,r,c,v,t.ScreenObject.ColumnSource[i].NoRoundOff?"6":t.ScreenObject.ColumnSource[i].DecimalPoints,be):t.ScreenObject.FillBillWiseDt(t.BillWisedt,t.BillWisedtColumns,C.DBAcc.toString(),m,!1,r,c,v,t.ScreenObject.ColumnSource[i].NoRoundOff?"6":t.ScreenObject.ColumnSource[i].DecimalPoints,be);4!=t.ScreenObject.ColumnSource[i].SectionID||""==t.ScreenObject.ColumnSource[i].Remarks&&t.ScreenObject.ColumnSource[i].CreditAcount!=C.CrACC&&t.ScreenObject.ColumnSource[i].DebitAccount!=C.DBAcc||(o.e.IsEmpty(le)&&(le+="<XML>"),le+="<Row ",t.ScreenObject.ColumnSource[i].CreditAcount==C.CrACC&&(le+=' CreditAcount="'+C.CrACC+'"'),t.ScreenObject.ColumnSource[i].DebitAccount==C.DBAcc&&(le+=' DebitAccount="'+C.DBAcc+'"'),le+=' Columnname="'+t.ScreenObject.ColumnSource[i].DisplayMember+'"',le+=' Remarks="'+h.d.GetValidXml(t.ScreenObject.ColumnSource[i].Remarks)+'" />')}if(2!=t.ScreenObject.ColumnSource[i].PostingType&&4!=t.ScreenObject.ColumnSource[i].PostingType||0==o.e.Double(m)||(Ce+=parseFloat(m)*c),3!=t.ScreenObject.ColumnSource[i].PostingType&&4!=t.ScreenObject.ColumnSource[i].PostingType||0==o.e.Double(m)||(ye+=parseFloat(m)*c),t.ScreenObject.ColumnSource[i].distDim>0){var f=new o.f;t.ScreenObject.ColumnSource[i].distLineWise&&!o.e.IsEmpty(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[i].DisplayMember+"DistXML"])?f.LoadXml(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[i].DisplayMember+"DistXML"].toString()):o.e.IsEmpty(t.ScreenObject.ColumnSource[i].distxml)||f.LoadXml(t.ScreenObject.ColumnSource[i].distxml);for(var O=f.SelectNodes("XML/Rows"),I=0;I<O.length;I++)o.e.IsEmpty(O[I].attributes.Percent)||o.e.IsEmpty(O[I].attributes["DCCCNID"+(t.ScreenObject.ColumnSource[i].distDim-5e4)])||(de+='<DocExtraXML><Row  RefID="'+O[I].attributes["DCCCNID"+(t.ScreenObject.ColumnSource[i].distDim-5e4)].value+'" ',de+=' Label="'+t.ScreenObject.ColumnSource[i].DisplayMember,de+='" Qty="'+O[I].attributes.Percent.value,de+='"  Type="50"  ></Row></DocExtraXML>')}},Q=0;Q<t.ScreenObject.ColumnSource.length;Q++){var H=K(Q);if("continue"!==H&&"object"==typeof H)return H.v}t.ScreenObject.Preferences.ContainsKey("JobRemainingQty")&&t.ScreenObject.GridDataColumns.Contains("RemQty")&&(o.e.IsEmpty(t.ScreenObject.GridData[a].RemQty)?(se+="dcCalc"+t.ScreenObject.Preferences.JobRemainingQty.Replace("dc","")+"=0,",se+=t.ScreenObject.Preferences.JobRemainingQty+"=0,"):(se+="dcCalc"+t.ScreenObject.Preferences.JobRemainingQty.Replace("dc","")+"="+t.ScreenObject.GridData[a].RemQty.toString().Replace(",","")+", ",se+=t.ScreenObject.Preferences.JobRemainingQty+"="+t.ScreenObject.GridData[a].RemQty.toString().Replace(",","")+", ")),o.e.IsEmpty(t.ScreenObject.GridData[a].LinkedFieldName)||o.e.IsEmpty(t.ScreenObject.GridData[a].LinkedInvDocDetailsID)||!o.e.IsValidID(parseInt(t.ScreenObject.GridData[a].LinkedInvDocDetailsID))||0!=v||("quantity"==t.ScreenObject.GridData[a].LinkedFieldName.toString().toLowerCase()&&t.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!o.e.IsEmpty(t.ScreenObject.GridData[a].FreeQTY)&&parseFloat(t.ScreenObject.GridData[a].FreeQTY)>0?re+='LinkedFieldValue="'+t.ScreenObject.GridData[a].FreeQTY.toString()+'" ':re+='LinkedFieldValue="'+t.ScreenObject.GridData[a][t.ScreenObject.GridData[a].LinkedFieldName.toString()].toString()+'" '),null!=e&&"SaveonHold"==e.toString()||t.DonotUpdateInventory||!o.e.IsEmpty(t.ScreenObject.GridData[a].Type)&&(6==parseInt(t.ScreenObject.GridData[a].Type)||8==parseInt(t.ScreenObject.GridData[a].Type)||3==parseInt(t.ScreenObject.GridData[a].Type)||11==parseInt(t.ScreenObject.GridData[a].Type))||t.ScreenObject.Preferences.ContainsKey("StockBasedon")&&t.ScreenObject.GridDataColumns.Contains(t.ScreenObject.Preferences.StockBasedon)&&"1"!=t.ScreenObject.GridData[a][t.ScreenObject.Preferences.StockBasedon].toString()||t.DonotUpdateSchemeQty&&t.ScreenObject.GridDataColumns.Contains("FreeQTY")&&o.e.Double(t.ScreenObject.GridData[a].FreeQTY)>0?re+=' IsQtyIgnored="1" ':t.ScreenObject.Preferences.ContainsKey("ConsBatch")&&"True"==t.ScreenObject.Preferences.ConsBatch&&"5"==t.ScreenObject.GridData[a].Type.toString()?re+=' IsQtyIgnored="1" BatchQtyIgnored="0" ':re+=' IsQtyIgnored="0" ',re+='AverageRate="'+o.e.String(t.ScreenObject.GridData[a].AVGRATE)+'" ',t.ScreenObject.GridDataColumns.Contains("ParentSeqNo")&&(re+='ParentSeqNo="'+t.ScreenObject.GridData[a].ParentSeqNo.toString()+'" '),38==t.ScreenObject.DocumentType&&!o.e.IsEmpty(t.ScreenObject.GridData[a].Quantity)&&parseFloat(t.ScreenObject.GridData[a].Quantity)<0&&(Ce*=-1),re+='StockValue="'+Ce.toString()+'" ',re+='Net="'+t.NetAmount.Replace(",","")+'" ',re+=null!=t.Currency&&null!=t.Currency.ExchangeRate.Text&&""!=t.Currency.ExchangeRate.Text?'StockValueFC="'+Ce/parseFloat(t.Currency.ExchangeRate.Text)+'" ':'StockValueFC="'+Ce+'" ';var W=t.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&56671==e.LinkData}));if(W.length>0&&(Ce/=parseFloat(t.ScreenObject.GridData[a].UOMConvertedQty),s.a.SessionManager.Preferences.ContainsKey("DecimalsinAmount")&&""!=s.a.SessionManager.Preferences.DecimalsinAmount&&(Ce=parseFloat(Ce.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount))),W[0].SysColumnName.toLowerCase().Contains("dcnum")?se+=t.savebulk?W[0].SysColumnName+'="'+Ce+'" dcCalc'+W[0].SysColumnName.replace("dc","")+'="'+Ce+'" ':W[0].SysColumnName+"="+Ce+",dcCalc"+W[0].SysColumnName.replace("dc","")+"="+Ce+", ":oe+=t.savebulk?W[0].SysColumnName+'="'+Ce+'" ':W[0].SysColumnName+"='"+Ce+"', ",t.ScreenObject.GridDataColumns.Contains(W[0].SysColumnName)&&(t.ScreenObject.GridData[a][W[0].SysColumnName]=Ce),t.ScreenObject.GridDataColumns.Contains("dcCalc"+W[0].SysColumnName)&&(t.ScreenObject.GridData[a]["dcCalc"+W[0].SysColumnName]=Ce)),re+=null!=t.Currency&&null!=t.Currency.Currency.SelectedValue&&""!=t.Currency.Currency.SelectedValue?'CurrencyID="'+t.Currency.Currency.SelectedValue.toString()+'" ':'CurrencyID="'+t.GetCurrencyID(a)+'" ',re+=null!=t.Currency&&null!=t.Currency.ExchangeRate.Text&&""!=t.Currency.ExchangeRate.Text?'ExchangeRate="'+t.Currency.ExchangeRate.Text.toString()+'" ':'ExchangeRate="'+t.GetExchRate(a)+'" ',3!=t.ScreenObject.DocumentType&&8!=t.ScreenObject.DocumentType&&13!=t.ScreenObject.DocumentType||(3==t.ScreenObject.DocumentType?(re.toString().Contains("DebitAccount=")||t.ScreenObject.strStaticFields.Contains("DebitAccount=")||(re+='DebitAccount="'+s.a.SessionManager.ReservedOSAccount+'" '),re.toString().Contains("CreditAccount=")||t.ScreenObject.strStaticFields.Contains("CreditAccount=")||(re+=' CreditAccount="'+s.a.SessionManager.ReservedOSAccount+'" ')):13==t.ScreenObject.DocumentType?(re.toString().Contains("DebitAccount=")||t.ScreenObject.strStaticFields.Contains("DebitAccount=")||(re+='DebitAccount="'+s.a.SessionManager.ReservedESAccount+'" '),re.toString().Contains("CreditAccount=")||t.ScreenObject.strStaticFields.Contains("CreditAccount=")||(re+=' CreditAccount="'+s.a.SessionManager.ReservedESAccount+'" ')):8==t.ScreenObject.DocumentType&&(re.toString().Contains("DebitAccount=")||t.ScreenObject.strStaticFields.Contains("DebitAccount=")||(re+='DebitAccount="'+s.a.SessionManager.ReservedSSAccount+'" '),re.toString().Contains("CreditAccount=")||t.ScreenObject.strStaticFields.Contains("CreditAccount=")||(re+=' CreditAccount="'+s.a.SessionManager.ReservedSSAccount+'" '))),se+=t.ScreenObject.strnumericFields,t.savebulk?se+=" >":(se+='" >',o.e.IsEmpty(le)||(se+=(le+="</XML>").toString())),se+="</Numeric>",oe+=t.savebulk?t.ScreenObject.strTextFields+" ></Alpha>":t.ScreenObject.strTextFields+'" ></Alpha>',!s.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")||"True"!=s.a.SessionManager.Preferences.EnableDivisionWise.toString()||ce.toString().Contains("dcCCNID1=")||t.ScreenObject.strCCFields.Contains("dcCCNID1=")||(t.savebulk?t.ScreenObject.DivisionID>0?ce+=' dcCCNID1=" '+t.ScreenObject.DivisionID.toString()+'" ':s.a.SessionManager.DivisionID>0&&(ce+=' dcCCNID1=" '+s.a.SessionManager.DivisionID.toString()+'" '):t.ScreenObject.DivisionID>0?ce+=" dcCCNID1="+t.ScreenObject.DivisionID.toString()+", ":s.a.SessionManager.DivisionID>0&&(ce+=" dcCCNID1="+s.a.SessionManager.DivisionID.toString()+", ")),!s.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")||"True"!=s.a.SessionManager.Preferences.EnableLocationWise.toString()||ce.toString().Contains("dcCCNID2=")||t.ScreenObject.strCCFields.Contains("dcCCNID2=")||(t.savebulk?t.ScreenObject.DivisionID>0?ce+=' dcCCNID2=" '+t.ScreenObject.LocationID.toString()+'" ':s.a.SessionManager.DivisionID>0&&(ce+=' dcCCNID2=" '+s.a.SessionManager.LocationID.toString()+'" '):t.ScreenObject.LocationID>0?ce+=" dcCCNID2="+t.ScreenObject.LocationID.toString()+", ":s.a.SessionManager.LocationID>0&&(ce+=" dcCCNID2="+s.a.SessionManager.LocationID.toString()+", ")),t.savebulk||(t.ScreenObject.Preferences.ContainsKey("StageCCID")&&""!=t.ScreenObject.Preferences.StageCCID.toString()&&parseInt(t.ScreenObject.Preferences.StageCCID)>5e4&&!ce.toString().Contains("dcCCNID"+(parseInt(t.ScreenObject.Preferences.StageCCID)-5e4)+"=")&&!t.ScreenObject.strCCFields.Contains("dcCCNID"+(parseInt(t.ScreenObject.Preferences.StageCCID)-5e4)+"=")&&t.ScreenObject.GridDataColumns.Contains("StageID")&&(o.e.IsEmpty(t.ScreenObject.GridData[a].StageID)||(ce+=" dcCCNID"+(parseInt(t.ScreenObject.Preferences.StageCCID)-5e4)+"="+t.ScreenObject.GridData[a].StageID.toString()+", ")),t.ScreenObject.Preferences.ContainsKey("jobCCID")&&""!=t.ScreenObject.Preferences.jobCCID.toString()&&parseInt(t.ScreenObject.Preferences.jobCCID)>5e4&&!ce.toString().Contains("dcCCNID"+(parseInt(t.ScreenObject.Preferences.jobCCID)-5e4)+"=")&&!t.ScreenObject.strCCFields.Contains("dcCCNID"+(parseInt(t.ScreenObject.Preferences.jobCCID)-5e4)+"=")&&t.ScreenObject.GridDataColumns.Contains("jobID")&&(o.e.IsEmpty(t.ScreenObject.GridData[a].jobID)||(ce+=" dcCCNID"+(parseInt(t.ScreenObject.Preferences.jobCCID)-5e4)+"="+t.ScreenObject.GridData[a].jobID.toString()+", ")),t.ScreenObject.Preferences.ContainsKey("BomCCID")&&""!=t.ScreenObject.Preferences.BomCCID.toString()&&parseInt(t.ScreenObject.Preferences.BomCCID)>5e4&&!ce.toString().Contains("dcCCNID"+(parseInt(t.ScreenObject.Preferences.BomCCID)-5e4)+"=")&&!t.ScreenObject.strCCFields.Contains("dcCCNID"+(parseInt(t.ScreenObject.Preferences.BomCCID)-5e4)+"=")&&t.ScreenObject.GridDataColumns.Contains("BOMID")&&(o.e.IsEmpty(t.ScreenObject.GridData[a].BOMID)||(ce+=" dcCCNID"+(parseInt(t.ScreenObject.Preferences.BomCCID)-5e4)+"="+t.ScreenObject.GridData[a].BOMID.toString()+", "))),"JOB"==o.e.String(t.ScreenObject.GridData[a].LinkedFieldName)&&t.ScreenObject.GridDataColumns.Contains("NetJobQty")&&!o.e.IsEmpty(t.ScreenObject.GridData[a].NetJobQty)&&o.e.Double(t.ScreenObject.GridData[a].NetJobQty)>0&&(t.ScreenObject.IsPurchase&&s.a.SessionManager.Preferences.ContainsKey("DoNotReceiveMoreThanJobQty")&&"true"==s.a.SessionManager.Preferences.DoNotReceiveMoreThanJobQty.toLowerCase()||!t.ScreenObject.IsPurchase&&s.a.SessionManager.Preferences.ContainsKey("DoNotIssueMoreThanJobQty")&&"true"==s.a.SessionManager.Preferences.DoNotIssueMoreThanJobQty.toLowerCase())&&(re+=' LinkedFieldValue="'+t.ScreenObject.GridData[a].NetJobQty.toString()+'" ',t.ScreenObject.Preferences.ContainsKey("StageCCID")&&""!=t.ScreenObject.Preferences.StageCCID.toString()&&parseInt(t.ScreenObject.Preferences.StageCCID)>5e4&&t.ScreenObject.Preferences.ContainsKey("jobCCID")&&""!=t.ScreenObject.Preferences.jobCCID.toString()&&parseInt(t.ScreenObject.Preferences.jobCCID)>5e4&&(re+=' LinkedFieldWhere="',re+=" and dcccnid"+(parseInt(t.ScreenObject.Preferences.StageCCID)-5e4)+"=",t.ScreenObject.GridDataColumns.Contains("dcCCNID"+(parseInt(t.ScreenObject.Preferences.StageCCID)-5e4)+"_Key")?re+=t.ScreenObject.GridData[a]["dcCCNID"+(parseInt(t.ScreenObject.Preferences.StageCCID)-5e4)+"_Key"].toString():re+=o.e.String(t.ScreenObject.GridData[a].StageID),re+=" and dcccnid"+(parseInt(t.ScreenObject.Preferences.jobCCID)-5e4)+"=",re+=o.e.String(t.ScreenObject.GridData[a].jobID),re+='" ',re+=' JobWhere="',re+=" and StageNodeID=",t.ScreenObject.GridDataColumns.Contains("dcCCNID"+(parseInt(t.ScreenObject.Preferences.StageCCID)-5e4)+"_Key")?re+=t.ScreenObject.GridData[a]["dcCCNID"+(parseInt(t.ScreenObject.Preferences.StageCCID)-5e4)+"_Key"].toString():re+=o.e.String(t.ScreenObject.GridData[a].StageID),re+=" and NodeID="+o.e.String(t.ScreenObject.GridData[a].jobID)+'" ')),fe){for(var U=ve,X=0;X<pe.length;X++)U+="3"==pe[X]?" and ProductID="+t.ScreenObject.GridData[a].ProductID_Key.toString():" and dcccnid"+(parseInt(pe[X])-5e4)+"="+t.ScreenObject.GridData[a]["dcCCNID"+(parseInt(pe[X])-5e4)+"_Key"].toString();re+=' BudQtyWhere="'+U+'" ',re+=' BudID="'+je+'" ',re+=' BudStartDate="'+De.ToString("dd/MMM/yyyy")+'" '}if(Te){for(var q=Ne,Y=0;Y<ge.length;Y++)q+="3"==ge[Y]?" and ProductID="+t.ScreenObject.GridData[a].ProductID_Key.toString():" and dcccnid"+(parseInt(ge[Y])-5e4)+"="+t.ScreenObject.GridData[a]["dcCCNID"+(parseInt(ge[Y])-5e4)+"_Key"].toString();re+=' ValueBudWhere="'+q+'" ',re+=' ValueBudID="'+Ae+'" ',re+=' ValueBudStartDate="'+me.ToString("dd/MMM/yyyy")+'" '}if(t.IsLockDimsLineWise){var z={join:""};re+=' LockDims="'+t.GetLockQuery(t.ScreenObject.GridData[a],z)+'" ',""!=z.join&&(re+=' LockDimsjoin="'+z.join+'" ')}s.a.SessionManager.RegisterCCID>0&&t.ScreenObject.RegisterNodeID>0&&!ce.toString().Contains("dcCCNID"+(s.a.SessionManager.RegisterCCID-5e4).toString()+"=")&&!t.ScreenObject.strCCFields.Contains("dcCCNID"+(s.a.SessionManager.RegisterCCID-5e4).toString()+"=")&&t.ScreenObject.RegisterNodeID>0&&!t.savebulk&&(ce+=" dcCCNID"+(s.a.SessionManager.RegisterCCID-5e4).toString()+"="+t.ScreenObject.RegisterNodeID.toString()+", "),(38==t.DocumentType||39==t.DocumentType)&&t.ScreenObject.ShiftNodeID>0&&!t.savebulk&&s.a.SessionManager.Preferences.ContainsKey("PosShifts")&&""!=s.a.SessionManager.Preferences.PosShifts.toString()&&parseInt(s.a.SessionManager.Preferences.PosShifts)>5e4&&!ce.toString().Contains("dcCCNID"+(parseInt(s.a.SessionManager.Preferences.PosShifts)-5e4)+"=")&&!t.ScreenObject.strCCFields.Contains("dcCCNID"+(parseInt(s.a.SessionManager.Preferences.PosShifts)-5e4)+"=")&&(ce+=" dcCCNID"+(parseInt(s.a.SessionManager.Preferences.PosShifts)-5e4).toString()+"="+t.ScreenObject.ShiftNodeID.toString()+", "),t.savebulk||(ie+="</AccountsXML>"),5==t.ScreenObject.DocumentType&&1==v?(ce+=t.ScreenObject.strTOCCFields+'" ></CostCenters>',re+=' VoucherType="1" '):(ce+=t.savebulk?t.ScreenObject.strCCFields+" ></CostCenters>":t.ScreenObject.strCCFields+'" ></CostCenters>',5==t.ScreenObject.DocumentType&&(re+=' VoucherType="-1" ')),t.LineWiseApproval&&(!o.e.IsEmpty(t.ScreenObject.GridData[a].DocDetailsID)&&parseInt(t.ScreenObject.GridData[a].DocDetailsID)>0&&("0"==o.e.String(t.ScreenObject.GridData[a].IsSelected)||"NoWorkFlow"==e.toString()||"NoWorkFlowReSave"==e.toString()||"NoWorkFlowprint"==e.toString()||t.ScreenObject.Preferences.ContainsKey("NoWorkflowPostedDocs")&&""!=t.ScreenObject.Preferences.NoWorkflowPostedDocs&&Object(l.j)(t.ScreenObject.Preferences.NoWorkflowPostedDocs)&&"369"==t.ScreenObject.GridData[a].StatusID.toString())?re+=' WorkFlowID="-1" ':"2"==o.e.String(t.ScreenObject.GridData[a].IsSelected)?re+=' WorkFlowID="-2" ':"0"!=o.e.String(t.ScreenObject.GridData[a].CanEdit)?re+=' WorkFlowID="'+t.GetWorkFlow(!1,t.ScreenObject.GridData[a])+'" ':re+=' WorkFlowID="-1" ',o.e.IsEmpty(t.ScreenObject.GridData[a].AppRemarks)||(re+=' AppRemarks="'+t.ScreenObject.GridData[a].AppRemarks.toString()+'" '));var J=t.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&50040==e.LinkData}));if(J.length>0&&t.ScreenObject.GridDataColumns.Contains(J[0].SysColumnName)&&(re+=' MatIndentIDColumn="'+J[0].SysColumnName+'" ',t.ScreenObject.GridDataColumns.Contains("IndentID")?re+=' MatIndentID="'+t.ScreenObject.GridData[a].IndentID.toString()+'" ':o.e.IsEmpty(t.ScreenObject.GridData[a][J[0].SysColumnName])||(re+=' MatIndentID="'+t.ScreenObject.GridData[a][J[0].SysColumnName].toString()+'" ')),!o.e.IsEmpty(t.ScreenObject.GridData[a].SchemeID)&&parseInt(t.ScreenObject.GridData[a].SchemeID)>0&&(re+=' IsQtyFreeOffer="'+t.ScreenObject.GridData[a].SchemeID.toString()+'" ',"Y"==t.ScreenObject.GridData[a].IsScheme.toString())){var Z=t.ScreenObject.GridData.filter((function(e){return e.MaxSchemeID==t.ScreenObject.GridData[a].MaxSchemeID&&"Y"!=e.IsScheme}));if(Z.length>0){var $="";Z.forEach((function(e){$+=e.DocSeqNo.toString()+","})),$=$.substr($.length-1,1),re+=' ParentSchemeID="'+$+'" '}}var ee=o.e.String(t.ScreenObject.GridData[a].ExtraXML),te="";if("8"==o.e.String(t.ScreenObject.GridData[a].Type)||"3"==o.e.String(t.ScreenObject.GridData[a].Type)||"11"==o.e.String(t.ScreenObject.GridData[a].Type)||"12"==o.e.String(t.ScreenObject.GridData[a].Type)?te=ee:t.ScreenObject.GridDataColumns.Contains("PromotionXML")&&(te=o.e.String(t.ScreenObject.GridData[a].PromotionXML)),""!=te){var ne="";ne+="<xml>";var ae=new o.f;if(ae.LoadXml(te),n&&!t.ValidateDataonSave_xml(ae,a))return{v:{v:{v:!1}}};var he,Se=ae.SelectNodes("xml/Row/xml"),Oe=Se.length,Ie=0;if(t.ScreenObject.Data.Tables[15].length>0){t.ScreenObject.Data.Columns[15].Contains("PostingVal")||t.ScreenObject.Data.Columns[15].push("PostingVal");for(var Me=0;Me<t.ScreenObject.Data.Tables[15].length;Me++)t.ScreenObject.Data.Tables[15][Me].PostingVal=0}for(var Ge=0;Ge<Se.length;Ge++){var we=Se[Ge];if(Ie++,ne+="<Row >"+ae.getNodeXml(we).replace("/>","").replace('CCQuery="','CCQuery="'+t.ScreenObject.strCCFields).replace('texQuery="','texQuery="'+t.ScreenObject.strTextFields),null!=e&&"SaveonHold"==e.toString()||t.DonotUpdateInventory||null!=we.attributes.Type&&""!=we.attributes.Type.value&&6==parseInt(we.attributes.Type.value)?ne+=' IsQtyIgnored="1" ':ne+=' IsQtyIgnored="0" ',n&&!t.DonotUpdateInventory&&null!=we.attributes.Type&&""!=we.attributes.Type.value&&5==parseInt(we.attributes.Type.value)&&null!=we.attributes.Quantity&&""!=we.attributes.Quantity.value&&parseFloat(we.attributes.Quantity.value)>0&&(null==we.attributes.ExtraXML||""==we.attributes.ExtraXML.value&&!r))return{v:{v:{v:(t.DisplayMessage=s.a.GetResource("Doc_BatchQtyMissMatch")+" "+t.ScreenObject.GridData[a].DocSeqNo.toString(),!1)}}};if(ne+=null!=t.Currency&&null!=t.Currency.Currency.SelectedValue&&""!=t.Currency.Currency.SelectedValue?'CurrencyID="'+t.Currency.Currency.SelectedValue.toString()+'" ':'CurrencyID="1" ',ne+=null!=t.Currency&&null!=t.Currency.ExchangeRate.Text&&""!=t.Currency.ExchangeRate.Text?'ExchangeRate="'+t.Currency.ExchangeRate.Text.toString()+'" ':'ExchangeRate="1" ',ne+=t.ScreenObject.strStaticFields,ne+='StockValue="##StkVal##" ',ne+=" />",null!=e&&"SaveonHold"!=e.toString()&&!b&&t.ScreenObject.Preferences.ContainsKey("KitAccPosting")&&"True"==t.ScreenObject.Preferences.KitAccPosting){var Le=new o.f;Le.ReadXml(ae.getNodeXml(we));var _e=0;ne+="<AccountsXML>";for(var Ke=function(e){var n=t.GetCurrencyID(a),i=t.GetExchRate(a),r=t.ScreenObject.Data.Tables[15].filter((function(n){return n.CostCenterColIDField==t.ScreenObject.ColumnSource[e].ID})),s="";if(r.length>0&&"No"==o.e.String(r[0].DistributOn)?1!=Ie||o.e.IsEmpty(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[e].DisplayMember])||(s=t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[e].DisplayMember].toString()):r.length>0&&!o.e.IsEmpty(r[0].DistributOn)&&("3"==o.e.String(t.ScreenObject.GridData[a].Type)||o.e.IsEmpty(r[0].IgnoreKit)||!Object(l.j)(r[0].IgnoreKit))?"Quantity"==o.e.String(r[0].DistributOn)&&null!=we.attributes.totQty&&""!=we.attributes.totQty.value&&parseFloat(we.attributes.totQty.value)>0&&null!=we.attributes.Quantity&&""!=we.attributes.Quantity.value&&parseFloat(we.attributes.Quantity.value)>0&&!o.e.IsEmpty(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[e].DisplayMember])?(he=Oe==Ie?parseFloat(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[e].DisplayMember])-parseFloat(r[0].PostingVal):parseFloat(we.attributes.Quantity.value)/parseFloat(we.attributes.totQty.value)*parseFloat(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[e].DisplayMember]),he=parseFloat(he.ToString("N"+t.ScreenObject.ColumnSource[e].DecimalPoints)),r[0].PostingVal=parseFloat(r[0].PostingVal)+he,s=he.toString()):"Gross"==o.e.String(r[0].DistributOn)&&null!=we.attributes.totgross&&""!=we.attributes.totgross.value&&parseFloat(we.attributes.totgross.value)>0&&null!=we.attributes.Gross&&""!=we.attributes.Gross.value&&parseFloat(we.attributes.Gross.value)>0&&!o.e.IsEmpty(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[e].DisplayMember])&&(he=Oe==Ie?parseFloat(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[e].DisplayMember])-parseFloat(r[0].PostingVal):parseFloat(we.attributes.Gross.value)/parseFloat(we.attributes.totgross.value)*parseFloat(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[e].DisplayMember]),he=parseFloat(he.ToString("N"+t.ScreenObject.ColumnSource[e].DecimalPoints)),r[0].PostingVal=parseFloat(r[0].PostingVal)+he,s=he.toString()):4==t.ScreenObject.ColumnSource[e].SectionID?null!=we.attributes.totgross&&""!=we.attributes.totgross.value&&parseFloat(we.attributes.totgross.value)>0&&null!=we.attributes.Gross&&""!=we.attributes.Gross.value&&parseFloat(we.attributes.Gross.value)>0&&!o.e.IsEmpty(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[e].DisplayMember])&&(s=(parseFloat(we.attributes.Gross.value)/parseFloat(we.attributes.totgross.value)*parseFloat(t.ScreenObject.GridData[a]["dcCalc"+t.ScreenObject.ColumnSource[e].DisplayMember])).toString()):("ComboBox"!=t.ScreenObject.ColumnSource[e].DataType&&t.ScreenObject.ColumnSource[e].PostingType>0&&we.attributes[t.ScreenObject.ColumnSource[e].DisplayMember]&&o.e.Double(we.attributes[t.ScreenObject.ColumnSource[e].DisplayMember].value)>0&&(s=we.attributes[t.ScreenObject.ColumnSource[e].DisplayMember].value),t.ScreenObject.ColumnSource[e].DisplayMember.toLowerCase().Contains("dcnum")&&null!=we.attributes["dcCalc"+t.ScreenObject.ColumnSource[e].DisplayMember]&&""!=we.attributes["dcCalc"+t.ScreenObject.ColumnSource[e].DisplayMember].value&&parseFloat(we.attributes["dcCalc"+t.ScreenObject.ColumnSource[e].DisplayMember].value)>0&&(s=we.attributes["dcCalc"+t.ScreenObject.ColumnSource[e].DisplayMember].value)),(3==t.ScreenObject.ColumnSource[e].PostingType||4==t.ScreenObject.ColumnSource[e].PostingType)&&0!=o.e.Double(s)){var c={DBAcc:0,CrACC:0,PostingXml:""};if(r.length>0&&"No"==o.e.String(r[0].DistributOn)){if(!t.FillAccountPosting(t.ScreenObject.ColumnSource[e],t.ScreenObject.GridData[a],s,n,i,c,0,be))return{v:{v:{v:{v:!1}}}}}else if(!t.FillAccountPosting(t.ScreenObject.ColumnSource[e],Le.Tables[0][0],s,n,i,c,0,be))return{v:{v:{v:{v:!1}}}};ne+=c.PostingXml,t.ScreenObject.FillBillWiseDt(t.BillWisedt,t.BillWisedtColumns,c.CrACC.toString(),s,!0,n,i,v,t.ScreenObject.ColumnSource[e].NoRoundOff?"6":t.ScreenObject.ColumnSource[e].DecimalPoints,be),t.ScreenObject.FillBillWiseDt(t.BillWisedt,t.BillWisedtColumns,c.DBAcc.toString(),s,!1,n,i,v,t.ScreenObject.ColumnSource[e].NoRoundOff?"6":t.ScreenObject.ColumnSource[e].DecimalPoints,be)}2!=t.ScreenObject.ColumnSource[e].PostingType&&4!=t.ScreenObject.ColumnSource[e].PostingType||""==s||0==o.e.Double(s)||(_e+=parseFloat(s)*i)},Qe=0;Qe<t.ScreenObject.ColumnSource.length;Qe++){var He=Ke(Qe);if("object"==typeof He)return He.v}ne=(ne+="</AccountsXML>").Replace("##StkVal##",_e.toString())}else{var We=new o.f;We.ReadXml(We.getNodeXml(we));for(var Ue=0,Xe=function(e){t.GetCurrencyID(a);var n=t.GetExchRate(a),i="";(d=t.ScreenObject.Data.Tables[15].filter((function(n){return n.CostCenterColIDField==t.ScreenObject.ColumnSource[e].ID}))).length>0&&"No"==o.e.String(d[0].DistributOn)?1!=Ie||o.e.IsEmpty(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[e].DisplayMember])||(i=t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[e].DisplayMember].toString().toString()):d.length>0&&!o.e.IsEmpty(d[0].DistributOn)&&("3"==t.ScreenObject.GridData[a].Type.toString()||o.e.IsEmpty(d[0].IgnoreKit)||!Object(l.j)(d[0].IgnoreKit.toString()))?"Quantity"==d[0].DistributOn.toString()&&!o.e.IsEmpty(we.attributes.totQty)&&!o.e.IsEmpty(we.attributes.totQty.value)&&parseFloat(we.attributes.totQty.value)>0&&null!=we.attributes.Quantity&&""!=we.attributes.Quantity.value&&parseFloat(we.attributes.Quantity.value)>0&&!o.e.IsEmpty(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[e].DisplayMember])?(he=Oe==Ie?parseFloat(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[e].DisplayMember].toString())-parseFloat(d[0].PostingVal.toString()):parseFloat(we.attributes.Quantity.value)/parseFloat(we.attributes.totQty.value)*parseFloat(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[e].DisplayMember].toString()),he=parseFloat(he.ToString("N"+t.ScreenObject.ColumnSource[e].DecimalPoints)),d[0].PostingVal=parseFloat(d[0].PostingVal.toString())+he,i=he.toString()):"Gross"==d[0].DistributOn.toString()&&null!=we.attributes.totgross&&""!=we.attributes.totgross.value&&parseFloat(we.attributes.totgross.value)>0&&null!=we.attributes.Gross&&""!=we.attributes.Gross.value&&parseFloat(we.attributes.Gross.value)>0&&!o.e.IsEmpty(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[e].DisplayMember])&&(he=Oe==Ie?parseFloat(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[e].DisplayMember].toString())-parseFloat(d[0].PostingVal.toString()):parseFloat(we.attributes.Gross.value)/parseFloat(we.attributes.totgross.value)*parseFloat(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[e].DisplayMember].toString()),he=parseFloat(he.ToString("N"+t.ScreenObject.ColumnSource[e].DecimalPoints)),d[0].PostingVal=parseFloat(d[0].PostingVal.toString())+he,i=he.toString()):4==t.ScreenObject.ColumnSource[e].SectionID?null!=we.attributes.totgross&&""!=we.attributes.totgross.value&&parseFloat(we.attributes.totgross.value)>0&&null!=we.attributes.Gross&&""!=we.attributes.Gross.value&&parseFloat(we.attributes.Gross.value)>0&&!o.e.IsEmpty(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[e].DisplayMember])&&(i=(parseFloat(we.attributes.Gross.value)/parseFloat(we.attributes.totgross.value)*parseFloat(t.ScreenObject.GridData[a][t.ScreenObject.ColumnSource[e].DisplayMember].toString())).toString()):("ComboBox"!=t.ScreenObject.ColumnSource[e].DataType&&t.ScreenObject.ColumnSource[e].PostingType>0&&null!=we.attributes[t.ScreenObject.ColumnSource[e].DisplayMember]&&""!=we.attributes[t.ScreenObject.ColumnSource[e].DisplayMember].value&&parseFloat(we.attributes[t.ScreenObject.ColumnSource[e].DisplayMember].value)>0&&(i=we.attributes[t.ScreenObject.ColumnSource[e].DisplayMember].value),t.ScreenObject.ColumnSource[e].DisplayMember.toLowerCase().Contains("dcnum")&&null!=we.attributes["dcCalc"+t.ScreenObject.ColumnSource[e].DisplayMember]&&""!=we.attributes["dcCalc"+t.ScreenObject.ColumnSource[e].DisplayMember].value&&parseFloat(we.attributes["dcCalc"+t.ScreenObject.ColumnSource[e].DisplayMember].value)>0&&(i=we.attributes["dcCalc"+t.ScreenObject.ColumnSource[e].DisplayMember].value)),(2==t.ScreenObject.ColumnSource[e].PostingType||4==t.ScreenObject.ColumnSource[e].PostingType)&&""!=i&&o.e.Double(i)>0&&0!=parseFloat(i)&&(Ue+=parseFloat(i)*n)},qe=0;qe<t.ScreenObject.ColumnSource.length;qe++)Xe(qe);ne=ne.Replace("##StkVal##",Ue.toString())}ne=ne.Replace("##StkVal##","0"),ne+="</Row>"}ne+="</xml>","8"==o.e.String(t.ScreenObject.GridData[a].Type)||"3"==o.e.String(t.ScreenObject.GridData[a].Type)||"11"==o.e.String(t.ScreenObject.GridData[a].Type)||"12"==o.e.String(t.ScreenObject.GridData[a].Type)?(ee=ne,te=""):te=ne}if(5==t.ScreenObject.DocumentType&&1==v&&t.ScreenObject.GridDataColumns.Contains("RecievedQtyXML")&&!t.DonotUpdateInventory&&2==o.e.Int(t.ScreenObject.GridData[a].Type)&&(ee=o.e.String(t.ScreenObject.GridData[a].RecievedQtyXML)),t.savebulk&&!o.e.IsEmpty(ee)&&"5"==o.e.String(t.ScreenObject.GridData[a].Type)){var Ye=new o.f;Ye.LoadXml(ee);var ze=Ye.SelectNodes("xml/Row");ze.length>0&&(re+='BatchID="'+ze[0].attributes.BatchID.value+'" ',re+='ReleaseQuantity="'+o.e.String(t.ScreenObject.GridData[a].UOMConvertedQty)+'" ')}if(r&&t.ScreenObject.Preferences.ContainsKey("BatchBasedon")&&t.ScreenObject.GridDataColumns.Contains(t.ScreenObject.Preferences.BatchBasedon)&&(re+=' IgnoreBatches="1" '),re+=t.ScreenObject.strStaticFields+" ></Transactions>",t.savebulk)"2"!=t.ScreenObject.GridData[a].Type.toString()||o.e.IsEmpty(ee)||(y.LoadXml(ee),y.SelectNodes("xml/Row").forEach((function(e){var t=y.CreateAttribute("DocSeqNo");t.Value=be.toString(),e.attributes+=t})),ue+=y.InnerXml),t.ScreenObject.GridDataColumns.Contains("DocExtraXML")&&""!=t.ScreenObject.GridData[a].DocExtraXML.toString()&&(y.LoadXml(t.ScreenObject.GridData[a].DocExtraXML.toString()),y.SelectNodes("DocExtraXML/Row").forEach((function(e){var t=y.CreateAttribute("DocSeqNo");t.Value=be.toString(),e.attributes+=t})),de+=y.InnerXml);else{if(ie+=re+se+oe+ce+"<EXTRAXML>"+ee+"</EXTRAXML>",""!=te?ie+="<DynPromXML>"+te+"</DynPromXML>":t.ScreenObject.Preferences.ContainsKey("BudgetDoc")&&""!=t.ScreenObject.Preferences.BudgetDoc&&(ie+=t.GetBudgetXml(t.ScreenObject.GridData[a])),t.ScreenObject.GridDataColumns.Contains("QtyXML")&&!o.e.IsEmpty(t.ScreenObject.GridData[a].QtyXML)&&(ie+=t.ScreenObject.GridData[a].QtyXML),t.ScreenObject.GridDataColumns.Contains("DocExtraXML")&&!o.e.IsEmpty(t.ScreenObject.GridData[a].DocExtraXML)&&(ie+=t.ScreenObject.GridData[a].DocExtraXML),de.length>0&&(ie+=de.toString()),t.ScreenObject.GridDataColumns.Contains("PackXML")&&!o.e.IsEmpty(t.ScreenObject.GridData[a].PackXML)&&(ie+=t.ScreenObject.GridData[a].PackXML),t.ScreenObject.GridDataColumns.Contains("TestCaseXML")&&!o.e.IsEmpty(t.ScreenObject.GridData[a].TestCaseXML)&&(ie+=t.ScreenObject.GridData[a].TestCaseXML),45==t.DocumentType&&(ie+="<ProjectPlanXML ",t.ScreenObject.GridDataColumns.Contains("Dependencies")&&!o.e.IsEmpty(t.ScreenObject.GridData[a].Dependencies)&&(ie+='Dependencies="'+t.ScreenObject.GridData[a].Dependencies+'" '),ie+=">",t.ScreenObject.GridDataColumns.Contains("AssignXML")&&!o.e.IsEmpty(t.ScreenObject.GridData[a].AssignXML)&&(ie+=t.ScreenObject.GridData[a].AssignXML),ie+="</ProjectPlanXML>"),null!=t.POSPayModes&&1==be){var Je=o.e.Int(s.a.SessionManager.Preferences.LoyaltyOn);if(s.a.SessionManager.Preferences.ContainsKey("LoyaltyOn")&&Je>5e4){var Ze=t.ScreenObject._CCFields.find((function(e){return e instanceof C.b&&e.CCID==Je}));Je=null!=Ze&&Ze.SelectedValue>0?Ze.SelectedValue:0}else null!=t.ScreenObject.DebitAccount&&(Je=t.ScreenObject.DebitAccount.SelectedValue);var $e=t.ScreenObject.Data.Tables[0].filter((function(e){return 79==e.LocalReference&&56569==e.LinkData}));if($e.length>0&&$e[0].SysColumnName.toLowerCase().Contains("dcnum")&&t.ScreenObject.GridDataColumns.Contains($e[0].SysColumnName)){if(0==Je)return{v:{v:{v:(t.DisplayMessage+="select loyalty based on.",!1)}}};var et=t.ScreenObject.GridData.Compute("sum",$e[0].SysColumnName.toString());null!=et&&null!=et&&(ie+='<DocExtraXML><Row  RefID="1"  Fld1="'+Je+'" ',ie+=' Qty="'+parseInt(et),ie+='"  Type="5"  ></Row></DocExtraXML>')}else if(t.POSPayModes.points>0&&(t.GridNetTotal+t.FooterGridNetTotal)/t.POSPayModes.BillValue>=1){if(0==Je)return{v:{v:{v:(t.DisplayMessage+="select loyalty based on.",!1)}}};ie+='<DocExtraXML><Row  RefID="1"  Fld1="'+Je+'" ',ie+=' Qty="'+(t.GridNetTotal+t.FooterGridNetTotal)/t.POSPayModes.BillValue*t.POSPayModes.points,ie+='"  Type="5"  ></Row></DocExtraXML>'}if(t.POSPayModes.RedeemPoints>0){if(0==Je)return{v:{v:{v:(t.DisplayMessage+="select loyalty based on.",!1)}}};ie+='<DocExtraXML><Row  RefID="1"  Fld1="'+Je+'" ',ie+=' Qty="-'+t.POSPayModes.RedeemPoints,ie+='"  Type="5"  ></Row></DocExtraXML>'}}if(5==t.ScreenObject.DocumentType&&1==v&&t.ScreenObject.GridDataColumns.Contains("TOBinsXML")&&!o.e.IsEmpty(t.ScreenObject.GridData[a].TOBinsXML)?ie+=t.ScreenObject.GridData[a].TOBinsXML:t.ScreenObject.GridDataColumns.Contains("BinsXML")&&!o.e.IsEmpty(t.ScreenObject.GridData[a].BinsXML)&&(ie+=t.ScreenObject.GridData[a].BinsXML),t.ScreenObject.Preferences.ContainsKey("PostAsset")&&"true"==t.ScreenObject.Preferences.PostAsset.toLowerCase()){var tt=0,nt=!1;t.ScreenObject.Preferences.ContainsKey("AssetBasedOn")&&t.ScreenObject.GridDataColumns.Contains(t.ScreenObject.Preferences.AssetBasedOn)?"0"==o.e.String(t.ScreenObject.GridData[a][t.ScreenObject.Preferences.AssetBasedOn])?tt=0:"1"!=o.e.String(t.ScreenObject.GridData[a][t.ScreenObject.Preferences.AssetBasedOn])||o.e.IsEmpty(t.ScreenObject.GridData[a].Quantity)?"2"!=o.e.String(t.ScreenObject.GridData[a][t.ScreenObject.Preferences.AssetBasedOn])||o.e.IsEmpty(t.ScreenObject.GridData[a].Quantity)?"4"==o.e.String(t.ScreenObject.GridData[a][t.ScreenObject.Preferences.AssetBasedOn])?(nt=!0,tt=1):"3"==o.e.String(t.ScreenObject.GridData[a][t.ScreenObject.Preferences.AssetBasedOn])&&(tt=parseFloat(t.ScreenObject.GridData[a].Quantity)):tt=parseFloat(t.ScreenObject.GridData[a].Quantity):(nt=!0,tt=parseFloat(t.ScreenObject.GridData[a].Quantity)):o.e.IsEmpty(t.ScreenObject.GridData[a].Quantity)||(tt=parseFloat(t.ScreenObject.GridData[a].Quantity)),tt>0&&(ie+=t.getAssetDeprXML(t.ScreenObject.GridData[a],nt))}ie+="</Row>"}v++};do{var N=G();if("object"==typeof N)return N.v}while(5==t.ScreenObject.DocumentType&&1==v)},Qe=0;Qe<t.ScreenObject.GridData.length;Qe++){var He=Ke(Qe);if("continue"!==He&&"object"==typeof He)return He.v}if(0==be)return{v:t.isAutoProduce&&null!=parent?(t.parent.AutoProduceXML="",!1):(t.DisplayMessage=s.a.GetResource("Doc_BlankData"),!1)};if(t.DialogResult=!1,n)for(var We=0;We<t.BillWisedt.length;We++)if(t.BillWisedt[We].AccountID.toString()==xe.toString()){if(t.ScreenObject.Preferences.ContainsKey("Dontsaveifpartybalancesgoes-ve")&&""!=t.ScreenObject.Preferences["Dontsaveifpartybalancesgoes-ve"]&&Object(l.j)(t.ScreenObject.Preferences["Dontsaveifpartybalancesgoes-ve"])&&t.CheckAccountBalance(xe,parseFloat(t.BillWisedt[We].Amount),Object(l.j)(t.BillWisedt[We].IsCredit)))return{v:(t.DisplayMessage=s.a.GetResource("PartyBalnceNegative"),!1)};if(!t.IgnoreOnSave.ContainsKey("ChequeReturn")&&(t.IgnoreOnSave.ACTION="ChequeReturn",t.ChequeReturn(xe,null,"",parseFloat(t.BillWisedt[We].Amount),Object(l.j)(t.BillWisedt[We].IsCredit),parseInt(t.BillWisedt[We].CurrencyID),parseFloat(t.BillWisedt[We].ExchangeRate)),t.isChequeReturn))return{v:!1};break}if(o.e.IsEmpty(Ve)){if((t.ScreenObject.Preferences.ContainsKey("DistributeCost")&&"True"==t.ScreenObject.Preferences.DistributeCost.toString()||Re)&&t.BillWisedt.length>0&&t.BillWisedt.filter((function(e){return e.AccountID==xe})).length>0){t.DialogResult=!1;var Ue=new k.ShowJVViewModel;if(Ue.ShowJVViewModel_2(t,xe.toString(),Re?5:3),Re&&(Ue.AccountID=ke,Ue.JVGrid.Columns[0].IsVisible=!1),n){if(s.a.page.ShowDialog(Ue,_.ShowJVComponent,{HideHeader:!0,Title:Ue.Title}),!t.DialogResult)return{v:!1}}else{var Xe=(Re?Ue.JVGrid.Table.filter((function(e){return e.AccountID_Key>0})):Ue.JVGrid.Table).Compute("sum","Amount");if(null==Xe||parseFloat(Xe).ToString("N"+Ue.decimalpoints)!=Ue.TotAmt.ToString("N"+Ue.decimalpoints))return{v:(t.DisplayMessage="Amount not equal.",!1)}}var ze=t.ScreenObject.ColumnSource.find((function(e){return null!=e.ValueMember&&"productid_key"==e.ValueMember.toLowerCase()}));if(!ze||o.e.IsEmpty(ze.DefaultValue)||o.e.Int(ze.DefaultValue)<1)return{v:(t.DisplayMessage="Define default product",!1)};ie+=Ue.getxml(ze.DefaultValue)}}else ie+=Ve;if(s.a.SessionManager.Preferences.ContainsKey("On")&&"true"==s.a.SessionManager.Preferences.On.toLowerCase()&&t.BillWisedt.length>0){var Je;if(t.DialogResult=!1,t.IgnoreOnSave.ContainsKey("BillWisedt")&&(t.BillWisedt=t.IgnoreOnSave.BillWisedt),t.IgnoreOnSave.ContainsKey("BillWise")?(t.DialogResult=!0,Je=t.IgnoreOnSave.BillWise):(Je=new B).BillWiseViewModel_1(t,n),!t.DialogResult){if(!n||t.ScreenObject.Preferences.ContainsKey("Alwaysnewreference")&&Object(l.j)(t.ScreenObject.Preferences.Alwaysnewreference)||t.ScreenObject.Preferences.ContainsKey("AdjustFifoBills")&&""!=t.ScreenObject.Preferences.AdjustFifoBills&&Object(l.j)(t.ScreenObject.Preferences.AdjustFifoBills)||t.ScreenObject.IsDocEdit&&s.a.SessionManager.IsActionAssigned(43,"Ignore Billwise on edit")){for(var Ze=function(e){var n=Je.Accounts.Items[e],a={Message:""};if(Je.FillSelectedAccountDetails(n),0==t.DocID&&t.ScreenObject.Preferences.ContainsKey("AdjustFifoBills")&&""!=t.ScreenObject.Preferences.AdjustFifoBills&&Object(l.j)(t.ScreenObject.Preferences.AdjustFifoBills)&&(Je._Fifo=!1,Je.Fifo=!0),t.BillWisedtColumns.Contains("DocSeqNo")?t.BillWisedt.filter((function(e){return e.AccountID==n.Value.toString()&&e.DocSeqNo==n.Seq&&e.IsCredit==e.item.Status&&e.CurrencyID==n.CurrID}))[0].XML=Je.GetXml(!1,a):(t.BillWisedt.filter((function(e){return e.AccountID==n.Value.toString()&&e.IsCredit==n.Status&&e.CurrencyID==n.CurrID}))[0].XML=Je.GetXml(!1,a),null!=Je.VatAdvanceXML&&Je.VatAdvanceXML.length>0&&(t.BillWisedt.filter((function(e){return e.AccountID==n.Value.toString()&&e.IsCredit==n.Status&&e.CurrencyID==n.CurrID}))[0].DocXML=Je.VatAdvanceXML)),""!=a.Message)return{v:{v:(t.DisplayMessage=a.Message,!1)}}},$e=0;$e<Je.Accounts.Items.length;$e++){var et=Ze($e);if("object"==typeof et)return et.v}t.DialogResult=!0}else t.IgnoreOnSave.ContainsKey("BillWise")?t.DialogResult=!0:(t.IgnoreOnSave.ACTION="BillWise",t.IgnoreOnSave.push("BillWise",Je),s.a.page.ShowDialog(Je,R.a,{ShowCenter:!0}));t.IgnoreOnSave.ContainsKey("BillWisedt")||t.IgnoreOnSave.push("BillWisedt",""),t.IgnoreOnSave.BillWisedt=t.BillWisedt}if(!t.DialogResult)return{v:!1}}t.BillWiseXML="";for(var tt="",nt=0,at=null,it=0;it<t.BillWisedt.length;it++)if(!o.e.IsEmpty(t.BillWisedt[it].XML)){if(t.ScreenObject.Preferences.ContainsKey("Enable Payment Terms")&&Object(l.j)(t.ScreenObject.Preferences["Enable Payment Terms"])){var rt=new o.f;rt.LoadXml("<BillWise> "+t.BillWisedt[it].XML.toString()+" </BillWise>");var st=rt.SelectNodes("BillWise/Row");t.DialogResult=!1;for(var ot=0;ot<st.length;ot++)null!=st[ot].attributes.AccountID&&""!=st[ot].attributes.AccountID.value&&parseInt(st[ot].attributes.AccountID.value)==xe&&(null!=st[ot].attributes.AdjAmount&&""!=st[ot].attributes.AdjAmount.value&&null!=st[ot].attributes.IsNewReference&&"1"==st[ot].attributes.IsNewReference.value&&(nt+=parseFloat(st[ot].attributes.AdjAmount.value.replace("-","")),at=st[ot]),t.DialogResult=!0);if(t.DialogResult&&t.ScreenObject.Preferences.ContainsKey("BillwisePosting")&&"2"==t.ScreenObject.Preferences.BillwisePosting)continue}o.e.IsEmpty(t.BillWiseXML)&&(t.BillWiseXML="<BillWise> "),t.BillWiseXML+=t.BillWisedt[it].XML.toString(),o.e.IsEmpty(t.BillWisedt[it].DocXML)||(tt+=t.BillWisedt[it].DocXML.toString())}""!=t.BillWiseXML||o.e.IsEmpty(t.ArApBills)||(t.BillWiseXML="<BillWise>"),t.BillWiseXML+=t.ArApBills,o.e.IsEmpty(t.BillWiseXML)||t.BillWiseXML.Contains("</BillWise>")||(t.BillWiseXML+=" </BillWise>");var ct="";if(t.ScreenObject.Preferences.ContainsKey("PrepaymentDoc")&&!o.e.IsEmpty(t.ScreenObject.Preferences.PrepaymentDoc)&&parseInt(t.ScreenObject.Preferences.PrepaymentDoc)>4e4&&(D=t.BillWisedt.filter((function(e){return e.AccountID==ke}))).length>0){var lt=new he.a(t,!0);t.ScreenObject.IsDocEdit&&lt.loadFromxml(t.ScreenObject.GetDescXml(),D[0].Amount.toString()),""!=D[0].Amount.toString()&&(lt.Amount.Text=D[0].Amount.toString()),lt.DebitAcc.Visible&&(lt.DebitAcc.SelectedValue=ke),lt.CredAcc.Visible&&(lt.CredAcc.SelectedValue=ke),lt.IsDataSaved=!1,s.a.page.ShowDialog(lt,Se.a).subscribe((function(){if(!lt.IsDataSaved)return!1;ct=lt.GenerateChequeNos(!0)}))}var ut=!1;if(t.DisplayMessage="",n&&t.BudgetValidation(ie.toString()),null!=t.DisplayMessage&&t.DisplayMessage.length>0){if("true"!=s.a.SessionManager.Preferences.GBudgetUnapprove.toLowerCase()||" "==t.DisplayMessage)return{v:!1};t.DisplayMessage="",ut=!0}if(t.ScreenObject.Preferences.ContainsKey("CopyPaymentTerms")&&xe>0&&(nt>0||ye>0)&&Object(l.j)(t.ScreenObject.Preferences.CopyPaymentTerms)&&(!t.ScreenObject.Preferences.ContainsKey("Enable Payment Terms")||!Object(l.j)(t.ScreenObject.Preferences["Enable Payment Terms"]))){var dt=0,Dt=t.ScreenObject.GridData.filter((function(e){return null!=e.LinkedInvDocDetailsID&&e.LinkedInvDocDetailsID>0}));if(Dt.length>0){dt=parseInt(Dt[0].LinkedInvDocDetailsID);var ht=t.ScreenObject.GetPaymentTerms(xe,dt);if(ht.Tables.length>3&&ht.Tables[3].length>0&&ht.Columns[3].Contains("Percentage")){0==nt&&(nt=ye);var St=new Oe;St.PaymentTermsViewModel_2(t,nt,xe,ht,at),St.onSave("Save")}}}if(0==nt&&xe>0&&b&&ye>0&&t.ScreenObject.Preferences.ContainsKey("Enable Payment Terms")&&""!=t.ScreenObject.Preferences["Enable Payment Terms"]&&Object(l.j)(t.ScreenObject.Preferences["Enable Payment Terms"])&&(nt=ye),nt>0&&xe>0&&t.ScreenObject.Preferences.ContainsKey("Enable Payment Terms")&&""!=t.ScreenObject.Preferences["Enable Payment Terms"]&&Object(l.j)(t.ScreenObject.Preferences["Enable Payment Terms"])){var mt=0;if(0==t.ScreenObject.DocID&&""==t.payTermXml){var bt=t.ScreenObject.GridData.filter((function(e){return null!=e.LinkedInvDocDetailsID&&e.LinkedInvDocDetailsID>0}));bt.length>0&&(mt=parseInt(bt[0].LinkedInvDocDetailsID))}var Ct=t.ScreenObject.GetPaymentTerms(xe,mt),yt=!0;if(t.ScreenObject.Preferences.ContainsKey("accountwisePaymentTerms")&&""!=t.ScreenObject.Preferences.accountwisePaymentTerms&&Object(l.j)(t.ScreenObject.Preferences.accountwisePaymentTerms)&&!s.a.SessionManager.IsActionAssigned(43,"Override Payment Terms")&&(null!=Ct&&0!=Ct.Tables.length&&0!=Ct.Tables[0].length&&Ct.Columns[0].Contains("PaymentTerms")&&!o.e.IsEmpty(Ct.Tables[0][0].PaymentTerms)&&parseInt(Ct.Tables[0][0].PaymentTerms)>0||(yt=!1)),t.ScreenObject.IsDocEdit&&s.a.SessionManager.IsActionAssigned(43,"Ignore Payment terms on edit")&&(yt=!1),yt)if(n){if(!t.IgnoreOnSave.ContainsKey("PaymentTerms")){t.IgnoreOnSave.ACTION="PaymentTerms";var pt=new Oe;return{v:(pt.PaymentTermsViewModel_2(t,nt,xe,Ct,at),t.IgnoreOnSave.push("PaymentTerms",pt),s.a.page.ShowDialog(pt,Ie.a),!1)}}}else{var gt=new Oe;gt.PaymentTermsViewModel_2(t,nt,xe,Ct,at),gt.onSave("Save")}}if(t.LCBillsXml="",xe>0&&t.ScreenObject.Preferences.ContainsKey("EnableLC")&&""!=t.ScreenObject.Preferences.EnableLC&&Object(l.j)(t.ScreenObject.Preferences.EnableLC)){var ft=t.ScreenObject.GetLCBills(xe,!0,t.ScreenObject.VoucherNo,1,t.DocumentDate);if(null!=ft&&ft.Tables.length>0&&!ft.Columns[0].Contains("ErrorMessage")&&ft.Tables[0].length>0){if(null!=t.Currency&&null!=t.Currency.Currency.SelectedValue&&""!=t.Currency.Currency.SelectedValue&&parseInt(t.Currency.Currency.SelectedValue),null!=t.Currency&&null!=t.Currency.ExchangeRate.Text&&""!=t.Currency.ExchangeRate.Text&&parseFloat(t.Currency.ExchangeRate.Text),""!=t.LCBillsXml){var Ot=new o.f;Ot.LoadXml(t.LCBillsXml);for(var It=Ot.SelectNodes("LCBillsXML/Row"),Tt=0,jt=0;jt<It.length;jt++)null!=It[jt].attributes.AdjAmount&&""!=It[jt].attributes.AdjAmount.value&&(Tt+=parseFloat(It[jt].attributes.AdjAmount.value.replace("-","")));if(t.GridNetTotal+t.FooterGridNetTotal>Tt&&(t.DialogResult=!1,alert("Lc Amount is less than bill.\n Do you want to proceed?"),!t.DialogResult))return{v:!1}}}}if(t.IsAutoPost&&null!=parent||t.isSaveXml)return{v:(t.DisplayMessage="",t.savebulk?(re+="</DocXML>",se+="</NumXML>",oe+="</TextXML>",ce+="</CCXML>",ie+="</AccXML>",ue+="</EXTRAXML>",de+="</DocExtraXML>",t.parent.AutoPOstXML='<AutoPOstXML DocID="'+t.ScreenObject.DocID+'"  DocDetIDs="'+Fe+'" WOrkFlowID="'+t.GetWorkFlow(!1,null)+'" >'+ie.toString()+re.toString()+se.toString()+ce.toString()+ue.toString()+oe.toString()+"<BillXML>"+t.BillWiseXML+"</BillXML><ActXML "+t.getQuery()+"/>"):t.isSaveXml?t.AutoPOstXML='<AutoPOstXML  CCID="'+t.ScreenObject.CostCenterID+'"   DocID="'+t.ScreenObject.DocID+'"  DocDetIDs="'+Fe+'" WOrkFlowID="'+t.GetWorkFlow(!1,null)+'" ><DOCXML>'+ie.toString()+"</DOCXML><BillXML>"+t.BillWiseXML+"</BillXML></AutoPOstXML>":(t.parent.AutoPOstXML='<AutoPOstXML DocID="'+t.ScreenObject.DocID+'"  DocDetIDs="'+Fe+'" WOrkFlowID="'+t.GetWorkFlow(!1,null)+'" ><DOCXML>'+ie.toString()+"</DOCXML><BillXML>"+t.BillWiseXML+"</BillXML>",null!=t.AutoProduce&&""!=t.AutoProduceXML&&(t.parent.AutoPOstXML+=t.AutoProduceXML)),t.parent.AutoPOstXML+="</AutoPOstXML>",s.a.page.HideDialog(),!1)};if(t.isAutoProduce&&null!=t.parent)return{v:(t.DisplayMessage="",t.parent.AutoProduceXML='<AutoProduceXML DocID="'+t.ScreenObject.DocID+'"  DocDetIDs="'+Fe+'" CostCenterID="'+t.CostCenterID+'" ><DOCXML>'+ie.toString()+"</DOCXML><BillXML>"+t.BillWiseXML+"</BillXML></AutoProduceXML>",!1)};o.e.IsEmpty(e)||(t.commandprarameter=e.toString());var Pt=0;if(t.LineWiseApproval||(Pt=t.GetWorkFlow(!1,null)),t.NotifWorkflowID=Pt,0==t.DocID&&t.ScreenObject.Preferences.ContainsKey("CreateActDoc")&&""!=t.ScreenObject.Preferences.CreateActDoc&&Object(l.j)(t.ScreenObject.Preferences.CreateActDoc)){if(null==t.ViewActivities?(t.ViewActivities=new qe.b(t),t.Activities=new Ye.a(t,!1),t.ViewActivities.Activities=t.Activities):(t.Activities=new Ye.a(t,!1),t.ViewActivities.Activities=t.Activities),t.ScreenObject.Preferences.ContainsKey("ActSubject")&&!o.e.IsEmpty(t.ScreenObject.Preferences.ActSubject)){var At=t.ScreenObject._TextFields.find((function(e){return e instanceof y.c&&e.DBColumnName.toLowerCase()==t.ScreenObject.Preferences.ActSubject.toLowerCase()}));null!=At&&(t.Activities.Subject.Text=t.ScreenObject.GetcontrolValue(At))}if(t.ScreenObject.Preferences.ContainsKey("DocActDate")&&!o.e.IsEmpty(t.ScreenObject.Preferences.DocActDate)){var Mt=t.ScreenObject._TextFields.find((function(e){return e instanceof y.c&&e.DBColumnName.toLowerCase()==t.ScreenObject.Preferences.DocActDate.toLowerCase()}));if(null!=Mt){var vt=t.ScreenObject.GetcontrolValue(Mt);o.e.isValidDate(vt)&&(t.Activities.StartDate.Date=new Date(vt))}}if(t.ScreenObject.Preferences.ContainsKey("DocActTime")&&!o.e.IsEmpty(t.ScreenObject.Preferences.DocActTime)){var Gt=t.ScreenObject._TextFields.find((function(e){return e instanceof y.c&&e.DBColumnName.toLowerCase()==t.ScreenObject.Preferences.DocActTime.toLowerCase()}));if(null!=Gt){var Nt=t.ScreenObject.GetcontrolValue(Gt);o.e.isValidDate("1/Jan/2020 "+Nt)&&(t.Activities.StartTime.SelectedValue=Nt)}}t.Activities.Status.SelectedValue="412",t.Activities.onSaveActivity("Save")}var Et=[];if(t.savebulk)re+="</DocXML>",se+="</NumXML>",oe+="</TextXML>",ce+="</CCXML>",ie+="</AccXML>",ue+="</EXTRAXML>",de+="</DocExtraXML>",Et.push(ie),Et.push(re),Et.push(se),Et.push(Fe),Et.push(oe),Et.push(ce),Et.push(ue),Et.push(de),Et.push(t.BillWiseXML),Et.push(Pt.toString());else{if(Et.push(ie),Et.push(t.BillWiseXML),Et.push(t.payTermXml),Et.push(Fe),Et.push(t.LCBillsXml),35==t.ScreenObject.DocumentType?null!=t.ViewOrganizationViewModel&&Et.push(t.ViewOrganizationViewModel.GetXML()):Et.push(""),Et.push(t.AutoPOstXML),Et.push(t.POSpayXml),Et.push(t.ChkRtnXml),Et.push(ut.toString()),t.ScreenObject.Preferences.ContainsKey("SkipNegStock")&&"true"==t.ScreenObject.Preferences.SkipNegStock.toLowerCase()?Et.push("false"):Et.push(a.toString()),Et.push(n.toString()),Et.push(t.AutoProduceXML),Et.push(tt.length>0?"<AccountingDoc>"+tt+"</AccountingDoc>":""),Et.push(Pt.toString()),Et.push(ct),Pt>0&&t.ScreenObject.Preferences.ContainsKey("L1Remarks")&&"True"==t.ScreenObject.Preferences.L1Remarks&&("Save"==e.toString()||"SaveAndPrint"==e.toString())&&(s.a.page.ShowDialog(new X.a(t,2),U.a),o.e.IsEmpty(t.ReviseReason)||Et.push(' L1Remarks="'+t.ReviseReason+'"')),(!fe&&""!=ve||!Te&&""!=Ne)&&(Z="",fe||""==ve||(Z=' BudQtyWhere="'+ve+'"  BudID="'+je+'" BudStartDate="'+De.ToString("dd/MMM/yyyy")+'" '),Te||""==Ne||(Z+=' ValueBudWhere="'+ve+'"  ValueBudID="'+je+'" ValueBudStartDate="'+De.ToString("dd/MMM/yyyy")+'" '),Et.push(Z),Z=""),r&&Et.push(' IgnoreBatches="1"'),t.PoleDisplayMessage(3,null),t.PoleDisplaytimer.Enabled=!0,null!=t.strVacXml&&""!=t.strVacXml&&Et[0].length>0){var wt=t.ScreenObject._TextFields.find((function(e){return"dcalpha3"==e.DBColumnName.toLowerCase()}));if(wt){var Ft=wt.Date.AddDays(1).ToString("dd/MMM/yyyy");Et[0]=Et[0].replace("dcAlpha1=NULL","dcAlpha1=N'"+Ft+"'")}var Vt="";return{v:(t.strVacXml=t.strVacXml.replace("LAV",""),Vt+='<AVX><ApplyVacationXML DocID="0" DocDetIDs="" WorkFlowID="0" >',Vt+="<DOCXML>",t.strVacXml=t.strVacXml+Vt.toString(),t.strVacXml=t.strVacXml+Et[0].toString(),t.strVacXml=t.strVacXml+"</DOCXML></ApplyVacationXML></AVX>",t.strVacXml=t.strVacXml.replace("\x11","<RowHead/>"),!0)}}if(!o.e.IsEmpty(t.strPMCXml)&&Et[0].length>0){var Lt=new o.f;if(""!=s.a.SessionManager.FMExtraXml){Lt.LoadXml(s.a.SessionManager.FMExtraXml),t.iPMCActivity=t.iPMCActivity+1;for(var Rt=Lt.SelectNodes("xml/Row"),Bt=0;Bt<Rt.length;Bt++)if(""!=Rt[Bt].attributes.StartDate.Value){var xt="";t.strPMCXml=t.strPMCXml.Replace("PRS",""),xt+="<AVX>",xt+='<PMCXML DocID="'+Rt[Bt].attributes.DocID.value.toString()+'" DocDetIDs="'+Rt[Bt].attributes.DocDetailsID.value.toString()+'" WorkFlowID="0" StartDate="'+new Date(Rt[Bt].attributes.StartDate.value).ToString("dd/MMM/yyyy")+'" DocSeqNo="'+t.iPMCActivity+'" >',xt+="<DOCXML>",t.strPMCXml=t.strPMCXml+xt.toString(),t.strPMCXml=t.strPMCXml+Et[0].toString(),t.strPMCXml=t.strPMCXml+"</DOCXML></PMCXML>",xt="",xt+="<PMCACTIVITYXML>",xt+="<DOCACTIVITYXML>#PMCACTIVITYXML#",t.strPMCXml=t.strPMCXml+xt.toString(),t.strPMCXml=t.strPMCXml+"</DOCACTIVITYXML></PMCACTIVITYXML>",t.strPMCXml=t.strPMCXml+"</AVX>",t.strPMCXml=t.strPMCXml.Replace("\x11","<RowHead/>")}return{v:(null!=t.ViewActivities&&(t.strPMCXml=t.strPMCXml.Replace("#PMCACTIVITYXML#",t.ViewActivities.FMActivitiesXML(t.iPMCActivity-1))),!0)}}}if(null!=t.strADWxml&&""!=t.strADWxml&&Et[0].length>0&&t.IsMPVParent){var kt="";return{v:(t.strADWxml=t.strADWxml.replace("ADWxml",""),kt+='<AttendanceDimensionwiseXML DocID="'+t.ScreenObject.DocID+'" DocDetIDs="'+Fe+'" WorkFlowID="'+t.GetWorkFlow(!1,null)+'" >',kt+="<DOCXML>",t.strADWxml=t.strADWxml+kt.toString(),t.strADWxml=t.strADWxml+Et[0].toString(),t.strADWxml=t.strADWxml+"</DOCXML></AttendanceDimensionwiseXML>",t.strADWxml=t.strADWxml.replace("\x11","<RowHead/>"),t.DialogResult=!0,s.a.page.HideDialog(),!0)}}85==t.ScreenObject.DocumentType&&(t.sApprUpdate="")}console.log("SYNC_SAVE in "),t.InventorySave_DoWork(null,Et),console.log("SYNC_SAVE out "),Logger.InfoLog("AddEditDocumentViewModel::Exiting OnSaveAccount")}();if("object"==typeof S)return S.v}catch(b){return s.a.SessionManager.IsWebApplication&&(this.DisplayMessage="Save Error"),Logger.ErrorLog("AddEditDocumentViewModel::"+b.stack,"SaveInventoryDocument",b.message),!1}return!0}},{key:"FillAutoBatchesforDynamic",value:function(e){for(var t=!1,n=new ce(this,this.ScreenObject.GridData[e],null),a=0;a<n.GridData.length;a++)if("5"==n.GridData[a].Type.toString()&&o.e.IsEmpty(n.GridData[a].ExtraXML)){var i,r=0;if(this.ScreenObject.Preferences.ContainsKey("Donotuselocation")&&""!=this.ScreenObject.Preferences.Donotuselocation&&Object(l.j)(this.ScreenObject.Preferences.Donotuselocation)){var c=this.ScreenObject._CCFields.find((function(e){return"dcccnid2"==e.DBColumnName.toLowerCase()}));c&&c instanceof C.b&&c.SelectedValue>0?r=c.SelectedValue:o.e.IsEmpty(this.ScreenObject.GridData[e].dcCCNID2_Key)||(r=parseInt(this.ScreenObject.GridData[e].dcCCNID2_Key))}else r=this.ScreenObject.LocationID>0?this.ScreenObject.LocationID:s.a.SessionManager.LocationID;i=this.ScreenObject.DivisionID>0?this.ScreenObject.DivisionID:s.a.SessionManager.DivisionID;var u=o.e.Double(n.GridData[a].Quantity);if(u>0){t=!0;var d=new Pe.a(this.ScreenObject.GridDataObj);d.BatchNumberViewModel_3(this,this.VoucherType,u,parseInt(n.GridData[a].ProductID_Key),n.GridData[a].ProductName.toString(),r,i,n.GridData[a],n.GridData),d.ChkFifo=!0,d.OnSave("AutoSave"),d.count>1&&this.ScreenObject.UpdateSequence()}}t&&n.OnButtonClick("OK")}},{key:"AutoAdjustBOE",value:function(e){if(-1==this.VoucherType&&this.ScreenObject.Preferences.ContainsKey("AutoBOE")&&!o.e.IsEmpty(this.ScreenObject.Preferences.AutoBOE)&&Object(l.j)(this.ScreenObject.Preferences.AutoBOE)&&(this.ScreenObject.GridDataColumns.Contains("BOEAdjusted")||this.ScreenObject.GridDataColumns.push("BOEAdjusted")),0==e&&this.ScreenObject.GridDataColumns.Contains("BOEAdjusted"))for(var t=0;t<this.ScreenObject.GridData.length;t++)!this.ScreenObject.GridDataColumns.Contains("landingType")||"1"!=this.ScreenObject.GridData[e].landingType.toString()&&"2"!=this.ScreenObject.GridData[e].landingType.toString()||!o.e.IsEmpty(this.ScreenObject.GridData[e].DocDetailsID)&&0!=parseInt(this.ScreenObject.GridData[e].DocDetailsID)||(this.ScreenObject.GridData[t].DocExtraXML=null,this.ScreenObject.GridData[t].BinsXML=null),this.ScreenObject.GridData[t].BOEAdjusted="0";if((!this.ScreenObject.GridDataColumns.Contains("BOEAdjusted")||"1"!=this.ScreenObject.GridData[e].BOEAdjusted.toString())&&-1==this.VoucherType&&this.ScreenObject.Preferences.ContainsKey("AutoBOE")&&""!=this.ScreenObject.Preferences.AutoBOE.toString()&&Object(l.j)(this.ScreenObject.Preferences.AutoBOE)&&this.ScreenObject.GridDataColumns.Contains("landingType")&&("1"==this.ScreenObject.GridData[e].landingType.toString()||"2"==this.ScreenObject.GridData[e].landingType.toString())&&(o.e.IsEmpty(this.ScreenObject.GridData[e].DocDetailsID)||0==parseInt(this.ScreenObject.GridData[e].DocDetailsID))){var n=new ue(this,2,this.ScreenObject.GridData[e]),a=n.LoadBoes("",this.ScreenObject.GridData[e]);n.FillBoeData(a);var i=0;o.e.IsEmpty(this.ScreenObject.GridData[e].UOMConvertedQty)||(i=parseFloat(this.ScreenObject.GridData[e].UOMConvertedQty));for(var r=0;r<n.GridData.length;r++)if(!o.e.IsEmpty(n.GridData[r].RefID)&&i>0){var s=o.e.Double(n.GridData[r].AvailQty);if(i>=s){if(n.GridData[r].Qty=s,this.ScreenObject.GridDataColumns.Contains("BinWise")&&"True"==this.ScreenObject.GridData[e].BinWise.toString()){var c=this.ScreenObject.GetinvBinDetails(n.GridData[r].RefID.toString(),this.ScreenObject.GridData[e].ProductID_Key.toString(),this.ScreenObject.GridData[e].LinkedInvDocDetailsID.toString());n.FillBins(c,0,n.GridData[r].RefID.toString())}i-=s}else{if(n.GridData[r].Qty=i,this.ScreenObject.GridDataColumns.Contains("BinWise")&&"True"==this.ScreenObject.GridData[e].BinWise.toString()){var u=this.ScreenObject.GetinvBinDetails(n.GridData[r].RefID.toString(),this.ScreenObject.GridData[e].ProductID_Key.toString(),this.ScreenObject.GridData[e].LinkedInvDocDetailsID.toString());n.FillBins(u,0,n.GridData[r].RefID.toString())}i=0}}n.SaveBoe(this.ScreenObject.GridData[e])}}},{key:"GetBudgetXml",value:function(e){if(!this.ScreenObject.Preferences.ContainsKey("BudgetType")||""==this.ScreenObject.Preferences.BudgetType)return"";var t="";this.ScreenObject.Preferences.ContainsKey("BudgetAnnualAmount")&&this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.Preferences.BudgetAnnualAmount)&&(t=this.ScreenObject.Preferences.BudgetAnnualAmount);var n=12;"1"==this.ScreenObject.Preferences.BudgetType?n=6:"2"==this.ScreenObject.Preferences.BudgetType?n=3:"3"==this.ScreenObject.Preferences.BudgetType&&(n=1);var a="";a+='<DynPromXML BudgetDoc="'+this.ScreenObject.Preferences.BudgetDoc+'" >';var i=o.e.Double(e[t]),r=0,c=0;12==n?c=parseFloat((i/12).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount)):(i=o.e.Double(e[this.ScreenObject.Preferences.BudgetField1]),c=parseFloat((i/n).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount)));var l=this.DocumentDate;if(this.ScreenObject.GridDataColumns.Contains("BillDate_Key")&&!o.e.IsEmpty(e.BillDate_Key))l=new Date(e.BillDate_Key);else{var u=this.ScreenObject.HeaderFields.find((function(e){return e instanceof S.c&&"billdate"==e.DBColumnName.toLowerCase()}));null!=u&&u.Date&&(l=u.Date)}for(var d=1;d<=12;d++)if(d%n==0)if(1==n)i=o.e.Double(e[this.ScreenObject.Preferences["BudgetField"+d/n]]),c=parseFloat((i/n).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount)),a+='<Row DocDate="'+l.AddMonths(d-1).ToString("dd/MMM/yyyy")+'" Amount="'+c+'" />';else{if(a+='<Row DocDate="'+l.AddMonths(d-1).ToString("dd/MMM/yyyy")+'" Amount="'+parseFloat((i-r).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount))+'" />',12==d)continue;i=o.e.Double(e[this.ScreenObject.Preferences["BudgetField"+(d/n+1).toString()]]),c=parseFloat((i/n).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount)),r=0}else a+='<Row DocDate="'+l.AddMonths(d-1).ToString("dd/MMM/yyyy")+'" Amount="'+c+'" />',r+=c;return a+="</DynPromXML>"}},{key:"CheckEmptyGrid",value:function(){for(var e=this.GetPrimaryColName(),t=0;t<this.ScreenObject.GridData.length;t++)if(!o.e.IsEmpty(this.ScreenObject.GridData[t][e]))return;var n=this.ScreenObject.ColumnSource.find((function(t){return null!=t.ValueMember&&t.ValueMember.toLowerCase()==e.toLowerCase()}));if(n&&""!=e&&!o.e.IsEmpty(n.DefaultValue)&&null!=n.DefaultValueText&&o.e.IsNum(n.DefaultValue)&&(parseInt(n.DefaultValue)>0||-100==parseInt(n.DefaultValue))){var a=n.DefaultValueText.split("\x11"),i=this.ScreenObject.GridData[this.GetEmptyRowPosition(this.ScreenObject.GridDataObj,e)];i.DocDetailsID=0,this.IsInventoryVoucher?(i.ProductID_Key=n.DefaultValue,this.ScreenObject.GridDataColumns.Contains("ProductCode")&&a.length>1&&(i.ProductCode=a[1]),this.ScreenObject.GridDataColumns.Contains("ProductName")&&a.length>0&&(i.ProductName=a[0]),this.AddProductData(i,!1,!1)):(i[e]=n.DefaultValue,this.ScreenObject.GridDataColumns.Contains("AccountCode")&&a.length>1&&(i.AccountCode=a[1]),this.ScreenObject.GridDataColumns.Contains("AccountName")&&a.length>0&&(i.AccountName=a[0]),this.FillDefaultValues(i)),this.CalculateTotals(i,!1)}}},{key:"GetAssetValue",value:function(e,t,n){var a=e.Tables[1].filter((function(e){return e.SysColumnName==n}));return a.length>0?this.ScreenObject.GetValueBYCOLID(a[0].BatchColID.toString(),t):e.Tables[0][0][n].toString()}},{key:"getAssetDeprXML",value:function(e,t){var n=new at.b(0),a=this.ScreenObject.GetAssetDetByProduct(parseInt(e.ProductID_Key.toString()));if(null!=a&&a.Tables.length>1&&a.Columns[0].Contains("IsDeprSchedule")&&a.Tables[0].length>0&&"1"==a.Tables[0][0].IsDeprSchedule.toString()){var i,r,s,c=0,l="0";s=o.e.Double(this.GetAssetValue(a,e,"PurchaseValue")),l=t?"0.1":this.GetAssetValue(a,e,"EstimateLife"),c=o.e.Double(this.GetAssetValue(a,e,"SalvageValue")),i=new Date(this.GetAssetValue(a,e,"DeprStartDate")),"2"==a.Tables[0][0].SalvageValueType.toString()&&(c=c*s/100);var u=0,d=0,D=0;try{var h=l.split(".");u=o.e.Int(h[0]),h.length>1&&(d=o.e.Int(h[1])),h.length>2&&(D=o.e.Int(h[2]))}catch(y){}t?r=(i=new Date(i.getFullYear(),i.getMonth(),1)).AddMonths(d).AddDays(-1):r=(r=(r=(r=i.AddYears(u)).AddMonths(d)).AddDays(D)).AddDays(-1);var S=this.GetAssetValue(a,e,"DepreciationMethod"),m=this.GetAssetValue(a,e,"AveragingMethod"),b=this.GetAssetValue(a,e,"Period"),C=this.GetAssetValue(a,e,"DeprBookID");return n.GetScheduleData(s,u,d,0,null,0,c,S,b,0,m,i,r,null,C),n.ErrorMessage,n.GetXML().replace("XML","DeprXML")}return""}},{key:"PickDbCr",value:function(e,t,n){var a=0;return n?null!=this.ScreenObject.CreditAccount?a=this.ScreenObject.CreditAccount.SelectedValue:o.e.Int(e.CreditAccount_Key)>0?a=parseInt(e.CreditAccount_Key):this.ScreenObject.GridDataColumns.Contains("CCQuery")&&o.e.Int(e.CreditAccount)>0?a=parseInt(e.CreditAccount):16!=this.ScreenObject.DocumentType&&17!=this.ScreenObject.DocumentType&&28!=this.ScreenObject.DocumentType&&29!=this.ScreenObject.DocumentType||(a=0!=o.e.Double(e.CreditAmount)&&o.e.Int(e.AccountID_Key)>0?parseInt(e.AccountID_Key):t):null!=this.ScreenObject.DebitAccount?a=this.ScreenObject.DebitAccount.SelectedValue:o.e.Int(e.DebitAccount_Key)>0?a=parseInt(e.DebitAccount_Key):this.ScreenObject.GridDataColumns.Contains("CCQuery")&&o.e.Int(e.DebitAccount)>0?a=parseInt(e.DebitAccount):16!=this.ScreenObject.DocumentType&&17!=this.ScreenObject.DocumentType&&28!=this.ScreenObject.DocumentType&&29!=this.ScreenObject.DocumentType||(a=0!=o.e.Double(e.DebitAmount)&&o.e.Int(e.AccountID_Key)>0?parseInt(e.AccountID_Key):t),a}},{key:"FillCostPosting",value:function(e,t,n,a,i,r,c,l,u){var d=this,D=l.NoRoundOff?"6":l.DecimalPoints;u.CostXML="";var S="",m=!1,b=null;if(l.distDim>0)if(b=new o.f,l.distLineWise&&!o.e.IsEmpty(a[l.DisplayMember+"DistXML"]))b.ReadXml(a[l.DisplayMember+"DistXML"].toString());else{if(o.e.IsEmpty(l.distxml))return!1;b.ReadXml(l.distxml)}else{for(var y=function(n){var r=i[n];parseInt(r)>5e4?d.ScreenObject.GridDataColumns.Contains("DCCCNID"+(parseInt(r)-5e4)+"_Key")?o.e.IsEmpty(a["DCCCNID"+(parseInt(r)-5e4)+"_Key"])||(S+=" and DCCCNID"+(parseInt(r)-5e4)+"="+a["DCCCNID"+(parseInt(r)-5e4)+"_Key"].toString()):(f=d.ScreenObject._CCFields.find((function(e){return e instanceof C.b&&e.CCID==parseInt(r)})))&&f.SelectedValue>0&&(S+=" and DCCCNID"+(parseInt(r)-5e4)+"="+f.SelectedValue.toString()):2==parseInt(r)?S+=" and AccountID in("+e+","+t+")":502==parseInt(r)&&(m=!0,S+=" and (db.AccountID is not null or Cr.AccountID is not null)")},g=0;g<i.length;g++){var f;y(g)}b=this.ScreenObject.getProfileBasedon(e,t,m,S)}var O=!1;if(n<0&&(n*=-1,O=!0),null!=b&&b.Tables.length>0&&b.Tables[0].length>0&&(l.distDim>0||b.Columns[0].Contains("ProfileID"))){var I,T="",j=0;l.distDim>0?I.push[0]=l.distDim.toString():I=s.a.SessionManager.Preferences.DistributeCostDims.split(",");var P="";this.ScreenObject._CCFields.forEach((function(e){(e instanceof C.b&&e.SelectedValue>0&&!I.Contains(e.CCID.toString())||e instanceof p.a&&e.SelectedValue>0&&!I.Contains(e.CCID.toString()))&&(P+=e.DBColumnName+"="+e.SelectedValue+", ")}));for(var A=0;A<this.ScreenObject.ColumnSource.length;A++)this.ScreenObject.ColumnSource[A].IsColumnUserDefined&&this.ScreenObject.ColumnSource[A].CostCenterID>5e4&&!I.Contains(this.ScreenObject.ColumnSource[A].CostCenterID.toString())&&this.ScreenObject.ColumnSource[A].DisplayMember.toLowerCase().startsWith("dcccnid")&&!o.e.IsEmpty(a[this.ScreenObject.ColumnSource[A].ValueMember])&&(P+=this.ScreenObject.ColumnSource[A].DisplayMember+"="+a[this.ScreenObject.ColumnSource[A].ValueMember].toString()+", ");for(var M=!1,v=this.ScreenObject._StaticFields.find((function(e){return"commonnarration"==e.DBColumnName.toLowerCase()})),G=function(i){var s=0;!o.e.IsEmpty(b.Tables[0][i].Percent)&&parseFloat(b.Tables[0][i].Percent.toString())>0?(s=parseFloat((n*parseFloat(b.Tables[0][i].Percent.toString())/100).ToString("N"+D)),M=!0):!o.e.IsEmpty(b.Tables[0][i].Amount)&&parseFloat(b.Tables[0][i].Amount.toString())>0&&(s=parseFloat(b.Tables[0][i].Amount.toString())),s>0&&(M&&i+1==b.Tables[0].length&&(s=parseFloat((n-j).ToString("N"+D))),j+=s,T+="\x11",T+='<Row><Transactions DocDetailsID="0" IsQtyIgnored="1" DocSeqNo="'+d.ScreenObject.GridData.length+'" ',T+='Quantity="" UOMConversion="1" UOMConvertedQty="1" Unit="1" Rate="'+s+'" ',T+=' CurrencyID="'+r+'" ExchangeRate="'+c+'" ',T+='Gross="'+s+'" StockValue="'+(s*c).ToString("N"+D).Replace(",","")+'" ',T+=' StockValueFC="'+s+'" ',T+=' DynamicInvDocDetailsID="-1" ProductID="'+a.ProductID_Key.toString()+'" ',O?(T+='  CreditAccount="'+e+'" ',T+='  DebitAccount="'+t.toString()+'" '):(T+='  CreditAccount="'+t+'" ',T+='  DebitAccount="'+e.toString()+'" '),null!=v&&null!=v&&(v instanceof h.d&&!o.e.IsEmpty(v.Text)||v instanceof h.c&&!o.e.IsEmpty(v.Text))&&(T+=' CommonNarration="'+h.d.GetValidXml(v.Text)+'" '),d.ScreenObject.GridDataColumns.Contains("LineNarration")&&(T+=' LineNarration="'+h.d.GetValidXml(a.LineNarration.toString())+'" '),T+=" ></Transactions>",T+="<AccountsXML><Accounts ",O?(T+='  CreditAccount="'+e+'" ',T+='  DebitAccount="'+t.toString()+'" ',T+='  IsNegative="1"'):(T+=' CreditAccount="'+t+'" ',T+='  DebitAccount="'+e.toString()+'" '),null!=v&&null!=v&&(v instanceof h.d&&!o.e.IsEmpty(v.Text)||v instanceof h.c&&!o.e.IsEmpty(v.Text))&&(T+=' CommonNarration="'+h.d.GetValidXml(v.Text)+'" '),d.ScreenObject.GridDataColumns.Contains("LineNarration")&&(T+=' LineNarration="'+h.d.GetValidXml(a.LineNarration.toString())+'" '),T+=' CurrencyID="'+r+'" ExchangeRate="'+c+'" ',T+='Amount="'+(s*c).ToString("N"+D).Replace(",","")+'" AmtFc="'+s+'" ></Accounts></AccountsXML>',T+="<EXTRAXML></EXTRAXML>",T+="<Numeric /><Alpha />",T+='<CostCenters Query="'+P.toString(),I.forEach((function(e){parseInt(e)>5e4&&b.Columns[0].Contains("DCCCNID"+(parseInt(e)-5e4))&&!o.e.IsEmpty(b.Tables[0][i]["DCCCNID"+(parseInt(e)-5e4)])&&(T+="DCCCNID"+(parseInt(e)-5e4)+"="+b.Tables[0][i]["DCCCNID"+(parseInt(e)-5e4)].toString()+",")})),T+='" ></CostCenters>',T+="</Row>")},N=0;N<b.Tables[0].length;N++)G(N);return(j=n-j)>.01&&(T+="\x11",T+='<Row><Transactions DocDetailsID="0" IsQtyIgnored="1" DocSeqNo="'+this.ScreenObject.GridData.length+'" ',T+='Quantity="" UOMConversion="1" UOMConvertedQty="1" Unit="1" Rate="'+j+'" ',T+=' CurrencyID="'+r+'" ExchangeRate="'+c+'" ',T+='Gross="'+j+'" StockValue="'+(j*c).ToString("N"+D).Replace(",","")+'" ',T+=' StockValueFC="'+j+'" ',T+=' DynamicInvDocDetailsID="-1" ProductID="'+a.ProductID_Key.toString()+'" ',O?(T+='  CreditAccount="'+e+'" ',T+='  DebitAccount="'+t.toString()+'" '):(T+='  CreditAccount="'+t+'" ',T+='  DebitAccount="'+e.toString()+'" '),null!=v&&null!=v&&(v instanceof h.d&&!o.e.IsEmpty(v.Text)||v instanceof h.c&&!o.e.IsEmpty(v.Text))&&(T+=' CommonNarration="'+h.d.GetValidXml(v.Text)+'" '),this.ScreenObject.GridDataColumns.Contains("LineNarration")&&(T+=' LineNarration="'+h.d.GetValidXml(a.LineNarration.toString())+'" '),T+=" ></Transactions>",T+="<AccountsXML><Accounts ",O?(T+='  CreditAccount="'+e+'" ',T+='  DebitAccount="'+t.toString()+'" ',T+='  IsNegative="1"'):(T+=' CreditAccount="'+t+'" ',T+='  DebitAccount="'+e.toString()+'" '),null!=v&&null!=v&&(v instanceof h.d&&!o.e.IsEmpty(v.Text)||v instanceof h.c&&!o.e.IsEmpty(v.Text))&&(T+=' CommonNarration="'+h.d.GetValidXml(v.Text)+'" '),this.ScreenObject.GridDataColumns.Contains("LineNarration")&&(T+=' LineNarration="'+h.d.GetValidXml(a.LineNarration.toString())+'" '),T+=' CurrencyID="'+r+'" ExchangeRate="'+c+'" ',T+='Amount="'+(j*c).ToString("N"+D).Replace(",","")+'" AmtFc="'+j+'" ></Accounts></AccountsXML>',T+="<EXTRAXML></EXTRAXML>",T+="<Numeric /><Alpha />",T+='<CostCenters Query="'+P.toString(),T+='" ></CostCenters>',T+="</Row>"),u.CostXML=T.toString(),!0}return!1}},{key:"FillAccountPosting",value:function(e,t,n,a,i,r){var c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;r.PostingXml="";var u="";u+="<Accounts ",r.DBAcc=0,r.CrACC=0;var d=!1;if(parseFloat(n)<0&&(d=!0),-98==e.DrRefColID||-99==e.DrRefColID){var D=0,S=0,m="";if(s.a.SessionManager.Preferences.ContainsKey("CrossDimension")&&""!=s.a.SessionManager.Preferences.CrossDimension.toString()&&(m="dcccnid"+(parseInt(s.a.SessionManager.Preferences.CrossDimension)-5e4)),this.ScreenObject.GridDataColumns.Contains(m+"_key")){if(o.e.IsEmpty(t[m+"_Key"])){var b=this.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember==m}));return this.DisplayMessage="Select ",b&&(this.DisplayMessage+=b.Header),this.DisplayMessage+=" at row:"+t.DocSeqNo.toString(),!1}D=parseInt(t[m+"_Key"])}else{var y=this.ScreenObject._CCFields.find((function(e){return e.DBColumnName.toLowerCase()==m}));if(!(y&&y instanceof C.b))return this.DisplayMessage="Define Cross Dimension field to use Cross Dimension Debit or Credit.",!1;if(!(y.SelectedValue>0))return this.DisplayMessage="Select "+y.Label,!1;D=y.SelectedValue}if(m="to"+m,this.ScreenObject.GridDataColumns.Contains(m+"_key")){if(o.e.IsEmpty(t[m+"_Key"])){var g=this.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember==m}));return this.DisplayMessage="Select ",g&&(this.DisplayMessage+=g.Header),this.DisplayMessage+=" at row:"+t.DocSeqNo.toString(),!1}S=parseInt(t[m+"_Key"])}else{var f=this.ScreenObject._CCFields.find((function(e){return e.DBColumnName.toLowerCase()==m}));if(!(f&&f instanceof C.b))return this.DisplayMessage="Define Cross Dimension field to use Cross Dimension Debit or Credit.",!1;if(!(f.SelectedValue>0))return this.DisplayMessage="Select "+f.Label,!1;S=f.SelectedValue}if(r.DBAcc=this.ScreenObject.GetAccountByRef(e.DrRefColID,D,S),0==r.DBAcc)return this.DisplayMessage="Cross dimension Accounts Not defined",!1}else if(56!=this.ScreenObject.DocumentType&&57!=this.ScreenObject.DocumentType||-3001!=e.DrRefColID&&-3002!=e.DrRefColID){if(0!=e.DrRefColID){if(e.DrRefColName&&3==e.DrRefSection&&(this.ScreenObject.GridDataColumns.Contains(e.DrRefColName+"_Key")||this.ScreenObject.GridDataColumns.Contains(e.DrRefColName)&&this.ScreenObject.GridDataColumns.Contains("CCQuery"))){if(this.ScreenObject.GridDataColumns.Contains("CCQuery")){if(o.e.IsEmpty(t[e.DrRefColName])){var O=this.ScreenObject.ColumnSource.find((function(t){return t.DisplayMember==e.DrRefColName}));return this.DisplayMessage="Select ",O&&(this.DisplayMessage+=O.Header),this.DisplayMessage+=" at row:"+t.DocSeqNo.toString()+" for kit.",!1}r.DBAcc=this.ScreenObject.GetAccountByRef(e.DrRefID,e.DrRefColID,parseInt(t[e.DrRefColName]))}else{if(o.e.IsEmpty(t[e.DrRefColName+"_Key"])){var I=this.ScreenObject.ColumnSource.find((function(t){return t.DisplayMember==e.DrRefColName}));return this.DisplayMessage="Select ",I&&(this.DisplayMessage+=I.Header),this.DisplayMessage+=" at row:"+t.DocSeqNo.toString(),!1}r.DBAcc=this.ScreenObject.GetAccountByRef(e.DrRefID,e.DrRefColID,parseInt(t[e.DrRefColName+"_Key"]))}if(0==r.DBAcc){var T=this.ScreenObject.ColumnSource.find((function(t){return null!=t.ValueMember&&t.ValueMember.toLowerCase()==e.DrRefColName.toLowerCase()+"_key"}));return this.DisplayMessage="Accounts Not defined for ",T&&(this.DisplayMessage+=T.Header,this.ScreenObject.GridDataColumns.Contains(T.DisplayMember)&&(this.DisplayMessage+=" :"+t[T.DisplayMember].toString())),this.DisplayMessage+=" at row:"+t.DocSeqNo.toString(),!1}}else if(1==e.DrRefSection||2==e.DrRefSection){if("debitaccount"==e.DrRefColName.toLowerCase()&&null!=this.ScreenObject.DebitAccount)r.DBAcc=this.ScreenObject.GetAccountByRef(e.DrRefID,e.DrRefColID,this.ScreenObject.DebitAccount.SelectedValue);else if("creditaccount"==e.DrRefColName.toLowerCase()&&null!=this.ScreenObject.CreditAccount)r.DBAcc=this.ScreenObject.GetAccountByRef(e.DrRefID,e.DrRefColID,this.ScreenObject.CreditAccount.SelectedValue);else{var j=this.ScreenObject._CCFields.find((function(t){return t.DBColumnName.toLowerCase()==e.DrRefColName.toLowerCase()}));if(j&&j instanceof C.b){if(!(j.SelectedValue>0))return this.DisplayMessage="Select "+j.Label,!1;if(r.DBAcc=this.ScreenObject.GetAccountByRef(e.DrRefID,e.DrRefColID,j.SelectedValue),0==r.DBAcc)return this.DisplayMessage="Accounts Not defined for "+j.Label+":"+j.Text,!1}}if(0==r.DBAcc)return"debitaccount"==e.DrRefColName.toLowerCase()&&null!=this.ScreenObject.DebitAccount?this.DisplayMessage="Accounts Not defined for "+this.ScreenObject.DebitAccount.Label+":"+this.ScreenObject.DebitAccount.Text:"creditaccount"==e.DrRefColName.toLowerCase()&&null!=this.ScreenObject.CreditAccount&&(this.DisplayMessage="Accounts Not defined for "+this.ScreenObject.CreditAccount.Label+":"+this.ScreenObject.CreditAccount.Text),!1}}else if(e.DebitAccount>0)r.DBAcc=e.DebitAccount;else if(r.DBAcc=this.PickDbCr(t,c,!(!d||1!=e.GridViewID)),0==r.DBAcc)return this.DisplayMessage="Select  DebitAccount",!1}else{var P=0,A=0,M=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));if(M&&(M instanceof C.b||M instanceof p.a)&&(M instanceof C.b&&M.SelectedValue>0||M instanceof p.a&&M.SelectedValue>0)&&(P=M.SelectedValue),56==this.ScreenObject.DocumentType)(M=this.ScreenObject._CCFields.find((function(e){return"dcccnid52"==e.DBColumnName.toLowerCase()})))&&M instanceof C.b&&M.SelectedValue>0&&(A=M.SelectedValue);else if(57==this.ScreenObject.DocumentType){var v=this.ScreenObject.ColumnSource.find((function(e){return"dcccnid52"==e.DisplayMember.toLowerCase()}));v&&this.ScreenObject.GridDataColumns.Contains(v.DisplayMember+"_key")&&(A=parseInt(t[v.DisplayMember+"_Key"]))}var G=s.a.common.GetDataSet3("DOC008",P.toString(),A.toString());if(null!=G&&G.Tables[0].length>0&&(r.DBAcc=-3001==e.DrRefColID?parseInt(G.Tables[0][0].CreditAccountID):parseInt(G.Tables[0][0].DebitAccountID)),0==r.DBAcc)return this.DisplayMessage=-3001==e.DrRefColID?"Credit Account not defined for this Loan Type in Employee Master":"Debit Account not defined for this Loan Type in Employee Master",!1}if(-98==e.CrRefColID||-99==e.CrRefColID){var N=0,E=0,w="";if(s.a.SessionManager.Preferences.ContainsKey("CrossDimension")&&""!=s.a.SessionManager.Preferences.CrossDimension.toString()&&(w="dcCCNID"+(parseInt(s.a.SessionManager.Preferences.CrossDimension)-5e4)),this.ScreenObject.GridDataColumns.Contains(w+"_key")){if(o.e.IsEmpty(t[w+"_Key"])){var F=this.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember==w}));return this.DisplayMessage="Select ",F&&(this.DisplayMessage+=F.Header),this.DisplayMessage+=" at row:"+t.DocSeqNo.toString(),!1}N=parseInt(t[w+"_Key"])}else{var V=this.ScreenObject._CCFields.find((function(e){return e.DBColumnName.toLowerCase()==w}));if(!(V&&V instanceof C.b))return this.DisplayMessage="Define Cross Dimension field to use Cross Dimension Debit or Credit.",!1;if(!(V.SelectedValue>0))return this.DisplayMessage="Select "+V.Label,!1;N=V.SelectedValue}if(w="to"+w,this.ScreenObject.GridDataColumns.Contains(w+"_key")){if(o.e.IsEmpty(t[w+"_Key"])){var L=this.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember==w}));return this.DisplayMessage="Select ",L&&(this.DisplayMessage+=L.Header),this.DisplayMessage+=" at row:"+t.DocSeqNo.toString(),!1}E=parseInt(t[w+"_Key"])}else{var R=this.ScreenObject._CCFields.find((function(e){return e.DBColumnName.toLowerCase()==w}));if(!(R&&R instanceof C.b))return this.DisplayMessage="Define Cross Dimension field to use Cross Dimension Debit or Credit.",!1;if(!(R.SelectedValue>0))return this.DisplayMessage="Select "+R.Label,!1;E=R.SelectedValue}if(r.CrACC=this.ScreenObject.GetAccountByRef(e.CrRefColID,N,E),0==r.CrACC)return this.DisplayMessage="Cross dimension Accounts Not defined",!1}else if(56!=this.ScreenObject.DocumentType&&57!=this.ScreenObject.DocumentType||-3001!=e.CrRefColID&&-3002!=e.CrRefColID){if(0!=e.CrRefColID){if(""!=e.CrRefColName&&3==e.CrRefSection&&this.ScreenObject.GridDataColumns.Contains(e.CrRefColName+"_Key")||this.ScreenObject.GridDataColumns.Contains("CCQuery")&&this.ScreenObject.GridDataColumns.Contains(e.CrRefColName)){if(this.ScreenObject.GridDataColumns.Contains("CCQuery")){if(o.e.IsEmpty(t[e.CrRefColName])){var B=this.ScreenObject.ColumnSource.find((function(t){return t.DisplayMember==e.CrRefColName}));return this.DisplayMessage="Select ",B&&(this.DisplayMessage+=B.Header),this.DisplayMessage+=" at row:"+t.DocSeqNo.toString()+" int kit.",!1}r.CrACC=this.ScreenObject.GetAccountByRef(e.CrRefID,e.CrRefColID,parseInt(t[e.CrRefColName]))}else{if(o.e.IsEmpty(t[e.CrRefColName+"_Key"])){var x=this.ScreenObject.ColumnSource.find((function(t){return t.DisplayMember==e.CrRefColName}));return this.DisplayMessage="Select ",x&&(this.DisplayMessage+=x.Header),this.DisplayMessage+=" at row:"+t.DocSeqNo.toString(),!1}r.CrACC=this.ScreenObject.GetAccountByRef(e.CrRefID,e.CrRefColID,parseInt(t[e.CrRefColName+"_Key"]))}if(0==r.CrACC){var k=this.ScreenObject.ColumnSource.find((function(t){return null!=t.ValueMember&&t.ValueMember.toLowerCase()==e.CrRefColName.toLowerCase()+"_key"}));return this.DisplayMessage="Accounts Not defined for ",k&&(this.DisplayMessage+=k.Header,this.ScreenObject.GridDataColumns.Contains(k.DisplayMember)&&(this.DisplayMessage+=" :"+t[k.DisplayMember].toString())),this.DisplayMessage+=" at row:"+t.DocSeqNo.toString(),!1}}else if(1==e.CrRefSection||2==e.CrRefSection){if("debitaccount"==e.CrRefColName.toLowerCase()&&null!=this.ScreenObject.DebitAccount)r.CrACC=this.ScreenObject.GetAccountByRef(e.CrRefID,e.CrRefColID,this.ScreenObject.DebitAccount.SelectedValue);else if("creditaccount"==e.CrRefColName.toLowerCase()&&null!=this.ScreenObject.CreditAccount)r.CrACC=this.ScreenObject.GetAccountByRef(e.CrRefID,e.CrRefColID,this.ScreenObject.CreditAccount.SelectedValue);else{var _=this.ScreenObject._CCFields.find((function(t){return t.DBColumnName.toLowerCase()==e.CrRefColName.toLowerCase()}));if(_&&_ instanceof C.b){if(!(_.SelectedValue>0))return this.DisplayMessage="Select "+_.Label,!1;if(r.CrACC=this.ScreenObject.GetAccountByRef(e.CrRefID,e.CrRefColID,_.SelectedValue),0==r.CrACC)return this.DisplayMessage="Accounts Not defined for "+_.Label+":"+_.Text,!1}}if(0==r.CrACC)return"debitaccount"==e.CrRefColName.toLowerCase()&&null!=this.ScreenObject.DebitAccount?this.DisplayMessage="Accounts Not defined for "+this.ScreenObject.DebitAccount.Label+":"+this.ScreenObject.DebitAccount.Text:"creditaccount"==e.CrRefColName.toLowerCase()&&null!=this.ScreenObject.CreditAccount&&(this.DisplayMessage="Accounts Not defined for "+this.ScreenObject.CreditAccount.Label+":"+this.ScreenObject.CreditAccount.Text),!1}}else if(e.CreditAcount>0)r.CrACC=e.CreditAcount;else if(r.CrACC=this.PickDbCr(t,c,!d||1!=e.GridViewID),0==r.CrACC)return this.DisplayMessage="Select  CreditAcount",!1}else{var K=0,Q=0,H=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));if(H&&H instanceof C.b?H.SelectedValue>0&&(K=H.SelectedValue):H&&H instanceof p.a&&H.SelectedValue>0&&(K=H.SelectedValue),56==this.ScreenObject.DocumentType)(H=this.ScreenObject._CCFields.find((function(e){return"dcccnid52"==e.DBColumnName.toLowerCase()})))&&H instanceof C.b&&H.SelectedValue>0&&(Q=H.SelectedValue);else if(57==this.ScreenObject.DocumentType){var W=this.ScreenObject.ColumnSource.find((function(e){return"dcccnid52"==e.DisplayMember.toLowerCase()}));W&&this.ScreenObject.GridDataColumns.Contains(W.DisplayMember+"_key")&&(Q=parseInt(t[W.DisplayMember+"_Key"]))}var U=s.a.common.GetDataSet3("DOC008",K.toString(),Q.toString());if(U&&U.Tables[0].length>0&&(r.CrACC=-3001==e.CrRefColID?parseInt(U.Tables[0][0].CreditAccountID):parseInt(U.Tables[0][0].DebitAccountID)),0==r.CrACC)return this.DisplayMessage=-3001==e.DrRefColID?"Credit Account not defined for this Loan Type in Employee Master":"Debit Account not defined for this Loan Type in Employee Master",!1}if(r.DBAcc<=0&&r.CrACC<=0&&(16==this.ScreenObject.DocumentType||17==this.ScreenObject.DocumentType||28==this.ScreenObject.DocumentType||29==this.ScreenObject.DocumentType))return!0;if(30==this.ScreenObject.DocumentType&&this.ScreenObject.GridDataColumns.Contains("vouchertype")&&"1"==t.vouchertype.toString()){var X=r.DBAcc;r.DBAcc=r.CrACC,r.CrACC=X}u+=this.ScreenObject.GetAccountTransaction(r.DBAcc.toString(),r.CrACC.toString(),n,a,i,e.NoRoundOff?"6":e.DecimalPoints);var q=this.ScreenObject._StaticFields.find((function(e){return"commonnarration"==e.DBColumnName.toLowerCase()}));q&&(q instanceof h.d&&!o.e.IsEmpty(q.Text)||q instanceof h.c&&!o.e.IsEmpty(q.Text))&&(u+=' CommonNarration="'+h.d.GetValidXml(q.Text)+'" '),u+=' DocSeqNo="'+l+'" ',o.e.IsEmpty(t.LineNarration)||(u+=' LineNarration="'+h.d.GetValidXml(t.LineNarration)+'" ');var Y=this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&50403==e.LinkData}));return Y.length>0&&Y[0].CostCenterColID.toString()==e.ID&&(u+=' IsExchangeGL="1" '),!this.ScreenObject.Preferences.ContainsKey("UseasCrossDimension")||"true"!=this.ScreenObject.Preferences.UseasCrossDimension.toLowerCase()||2!=e.Dependancy&&3!=e.Dependancy||(u+=' FromTo="'+e.Dependancy+'" '),u+=" ></Accounts>",r.PostingXml=u.toString(),!0}},{key:"PostCrossDimDOc",value:function(){var e=this;if(this.ScreenObject.Preferences.ContainsKey("CrossDimDocument")&&""!=this.ScreenObject.Preferences.CrossDimDocument&&parseInt(this.ScreenObject.Preferences.CrossDimDocument)>0){var t,n,i,r=function(){var r,c,l,u=new a(parseInt(e.ScreenObject.Preferences.CrossDimDocument),"",!0);u.OKCancelVisibility=!0;var d,D=0;if(s.a.SessionManager.Preferences.ContainsKey("CrossDimension")&&""!=s.a.SessionManager.Preferences.CrossDimension.toString()&&(r=parseInt(s.a.SessionManager.Preferences.CrossDimension.toString()),null!=(t=e.ScreenObject._CCFields.find((function(e){return e instanceof C.b&&e.CCID==r})))&&t.SelectedValue>0&&(d=t.SelectedValue),e.ScreenObject.Preferences.ContainsKey("CrossDimField"))){c=o.e.IntTryParse(e.ScreenObject.Preferences.CrossDimField),null!=(t=e.ScreenObject._TextFields.find((function(e){return e.DBColumnID==c})))&&t instanceof C.b&&t.SelectedValue>0&&(D=t.SelectedValue);var h=e.ScreenObject.GetCrossDimLinkDetails(d,D,e.CostCenterID,u.CostCenterID,e.ScreenObject.DocID);if(0==h.Tables[0].length)return{v:(e.DisplayMessage="Map Accounts for Cross Dimension",e.MessageVisibility=!0,"0")};if(!o.e.IsEmpty(h.Tables[0][0].docid)){u.ScreenObject.DocID=parseInt(h.Tables[0][0].docid.toString());var S=u.ScreenObject.GetEditDataByDOCID();null!=S&&S.Tables.length>0&&S.Tables[0].length>0&&(u.ScreenObject.LoadEditData(S,!1),u.ScreenObject.VoucherNo=o.e.String(S.Tables[0][0].VoucherNo))}if(null!=(t=u.ScreenObject._CCFields.find((function(e){return e instanceof C.b&&e.CCID==r})))&&t instanceof C.b&&t.SelectedValue>0&&(t.SelectedValue=D),e.LoadLinkFieldsData(h.Tables[1],u.ScreenObject._StaticFields),e.LoadLinkFieldsData(h.Tables[1],u.ScreenObject._TextFields),e.LoadLinkFieldsData(h.Tables[1],u.ScreenObject._numericFields),e.LoadLinkFieldsData(h.Tables[1],u.ScreenObject._CCFields),h.Tables[0].length>0&&(null!=u.ScreenObject.CreditAccount&&""!=h.Tables[0][0].CrAccount.toString()&&(u.ScreenObject.CreditAccount.SelectedValue=parseInt(h.Tables[0][0].CrAccount.toString())),null!=u.ScreenObject.DebitAccount&&""!=h.Tables[0][0].DrAccount.toString()&&(u.ScreenObject.DebitAccount.SelectedValue=parseInt(h.Tables[0][0].DrAccount.toString()))),u.ScreenObject.DocID>0){u.ScreenObject.GridDataColumns.Contains("IsChecked")||u.ScreenObject.GridDataColumns.push("IsChecked");for(var m=0;m<u.ScreenObject.GridData.length;m++)u.ScreenObject.GridData[m].IsChecked=0}for(var b=function(t){var a=null;u.ScreenObject.DocID>0&&!o.e.IsEmpty(e.ScreenObject.GridData[t].DocDetailsID)&&(n=u.ScreenObject.GridData.filter((function(n){return n.LinkedInvDocDetailsID==e.ScreenObject.GridData[t].DocDetailsID.toString()}))).length>0&&(a=n[0]),null==a&&(a=u.ScreenObject.GridData[e.GetEmptyRowPosition(u.ScreenObject.GridDataObj,"ProductID_Key")]),a.DocSeqNo=e.ScreenObject.GridData[t].DocSeqNo.toString(),h.Tables[0].length>0&&(u.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!o.e.IsEmpty(h.Tables[0][0].CrAccount)&&(a.CreditAccount_Key=parseInt(h.Tables[0][0].CrAccount.toString())),u.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!o.e.IsEmpty(h.Tables[0][0].DrAccount)&&(a.DebitAccount_Key=parseInt(h.Tables[0][0].DrAccount.toString()))),u.ScreenObject.GridDataColumns.Contains("IsChecked")&&(a.IsChecked=1);for(var r=function(n){if("DocDetailsID"==u.ScreenObject.ColumnSource[n].DisplayMember||"RefNo"==u.ScreenObject.ColumnSource[n].DisplayMember||"LinkedFieldName"==u.ScreenObject.ColumnSource[n].DisplayMember)return"continue";"LINK"==u.ScreenObject.ColumnSource[n].DataType&&u.ScreenObject.ColumnSource[n].DisplayMember.toLowerCase().Contains("dcalpha")&&(a[u.ScreenObject.ColumnSource[n].DisplayMember]="...");var i=null;if((i=3!=u.ScreenObject.ColumnSource[n].CostCenterID||u.ScreenObject.ColumnSource[n].DisplayMember.toLowerCase().Contains("alpha")?h.Tables[1].filter(u.ScreenObject.ColumnSource[n].CostCenterID>0&&null!=u.ScreenObject.ColumnSource[n].ValueMember?function(e){return e.BASECOL==u.ScreenObject.ColumnSource[n].ValueMember.Replace("_Key","")}:"ComboBox"==u.ScreenObject.ColumnSource[n].DataType||"PactComboBox"==u.ScreenObject.ColumnSource[n].DataType?function(e){return e.BASECOL==u.ScreenObject.ColumnSource[n].ValueBinding+"'"}:function(e){return e.BASECOL==u.ScreenObject.ColumnSource[n].DisplayMember+"'"}):h.Tables[1].filter((function(e){return"ProductID"==e.BASECOL}))).length>0){var r=e.ScreenObject.GetValueBYCOLID(i[0].CostCenterColIDLinked.toString(),e.ScreenObject.GridData[t]);if(""==r)return"continue";if(0!=u.ScreenObject.ColumnSource[n].CostCenterID)if("SELECTIONBOX"==u.ScreenObject.ColumnSource[n].DataType)a[u.ScreenObject.ColumnSource[n].DisplayMember]=r;else{o.e.IsEmpty(r)||(o.e.IntTryParse(r),a[u.ScreenObject.ColumnSource[n].ValueMember]=r,o.e.IsEmpty(a[u.ScreenObject.ColumnSource[n].DisplayMember])||(a[u.ScreenObject.ColumnSource[n].DisplayMember]=null))}else if("ComboBox"==u.ScreenObject.ColumnSource[n].DataType)a[u.ScreenObject.ColumnSource[n].ValueBinding]=r;else if("PactComboBox"==u.ScreenObject.ColumnSource[n].DataType)a[u.ScreenObject.ColumnSource[n].ValueBinding]=r,a[u.ScreenObject.ColumnSource[n].ValueBinding+"_Key"]=r;else if("DATE"==u.ScreenObject.ColumnSource[n].DataType){var c=new Date;!o.e.IsEmpty(r)&&o.e.isValidDate(r)&&(c=new Date(r),a[u.ScreenObject.ColumnSource[n].DisplayMember]=new Date(r).ToString(s.a.SessionManager.Preferences["Date Format"]),a[u.ScreenObject.ColumnSource[n].DisplayMember+"_Key"]=new Date(c))}else"DATETIME"==u.ScreenObject.ColumnSource[n].DataType||"TIME"==u.ScreenObject.ColumnSource[n].DataType?(new Date,!o.e.IsEmpty(r)&&o.e.isValidDate(r)&&(a[u.ScreenObject.ColumnSource[n].DisplayMember+"_Key"]=new Date(r),a[u.ScreenObject.ColumnSource[n].DisplayMember]=new Date(r).ToString(s.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss tt"))):"TIME2"==u.ScreenObject.ColumnSource[n].DataType.toUpperCase()?(new Date,!o.e.IsEmpty(r)&&o.e.isValidDate(r)&&(a[u.ScreenObject.ColumnSource[n].DisplayMember+"_Key"]=new Date(r),a[u.ScreenObject.ColumnSource[n].DisplayMember]=new Date(r).ToString("HH:mm"))):"double"==u.ScreenObject.GridDataColumns[u.ScreenObject.ColumnSource[n].DisplayMember].DataType?o.e.IsEmpty(r)||(l=o.e.IntTryParse(r),a[u.ScreenObject.ColumnSource[n].DisplayMember]=l):a[u.ScreenObject.ColumnSource[n].DisplayMember]=r}},c=0;c<u.ScreenObject.ColumnSource.length;c++)r(c);if(a.Type=e.ScreenObject.GridData[t].Type.toString(),"5"==a.Type.toString()&&!o.e.IsEmpty(e.ScreenObject.GridData[t].Extraxml)){var d=new o.f;d.LoadXml(e.ScreenObject.GridData[t].Extraxml.toString()),null!=(i=d.FirstChild.FirstChild.attributes.RefInvID)&&d.FirstChild.FirstChild.Attributes.Remove(i),null!=(i=d.FirstChild.FirstChild.attributes.Release)?i.value=d.FirstChild.FirstChild.attributes.Quantity.value:((i=d.CreateAttribute("Release")).value=d.FirstChild.FirstChild.attributes.Quantity.value,d.FirstChild.FirstChild.Attributes+=i),a.Extraxml=d.OuterXml}u.CalculateTotals(a,!1,"Quantity")},y=0;y<e.ScreenObject.GridData.length;y++)b(y);if(u.ScreenObject.DocID>0&&u.ScreenObject.GridDataColumns.Contains("IsChecked"))for(var p=0;p<u.ScreenObject.GridData.length;p++)"0"==u.ScreenObject.GridData[p].IsChecked.toString()&&(u.ScreenObject.GridDataObj.removeRowAt(p),p--);return{v:(u.parent=e,u.IsAutoPost=!0,u.SaveInventoryDocument("Save",!1),o.e.IsEmpty(u.DisplayMessage)?e.AutoPOstXML.Replace("AutoPOstXML","CrossDimXML"):(e.DisplayMessage=" Cross Dimension: "+u.DisplayMessage,e.MessageVisibility=!0,"0"))}}}();if("object"==typeof r)return r.v}return""}},{key:"LoadLinkFieldsData",value:function(e,t){var n=this;null!=e&&t.forEach((function(t){var a=e.filter((function(e){return e.BASECOL==t.DBColumnName}));if(a.length>0){var i=n.ScreenObject.GetValueBYCOLID(a[0].CostCenterColIDLinked.toString(),null);n.ScreenObject.fillcontrolValue(t,i)}}))}},{key:"InventorySave_DoWork",value:function(e,t){var n=this;if(this.DisplayMessage=s.a.GetResource("SavingDocumentPleasewait"),console.log("InventorySave_DoWork In"),t.length>4){this.RetValue=0;var i="<XML   ";if(null!=this.commandprarameter&&"SaveonHold"==this.commandprarameter?i+=' status="'+this.commandprarameter+'"':null!=this.commandprarameter&&"Revise"==this.commandprarameter?(i+=' IsRevision="1"',i+=' ReviseReason="'+this.ReviseReason+'"'):null==this.commandprarameter||"Approve"!=this.commandprarameter&&"ApproveandPrint"!=this.commandprarameter||(i+=' AppRejDate="'+this.AppRejDate.Date.ToString("dd/MMM/yyyy")+'"',i+=' Remarks="'+h.d.GetValidXml(this.Remarks.Text)+'"',this.IsLocked&&s.a.SessionManager.Preferences.ContainsKey("PostLockedDocs")&&Object(l.j)(s.a.SessionManager.Preferences.PostLockedDocs)&&(i+=' LockedPosting="1"')),!this.IsLockDimsLineWise&&null!=this.LockDims){var r={join:""};i+=' LockDims="'+this.GetLockQuery(null,r)+'" ',""!=r.join&&(i+=' LockDimsjoin="'+r.join+'" ')}if(this.GenratePrefix&&(i+=' GenratePrefix="1" '),i+=' SysInfo="'+s.a.SessionManager.GetSysInfo()+'" ',this.IsPOs&&Object(l.j)(t[11])&&(i+=' PosSessionID="'+this.PosSessionID+'"'),!this.savebulk&&t.length>10&&(i+=' CheckStock="'+t[10]+'" '),!this.savebulk&&t.length>16&&(i+=t[16]),!this.savebulk&&t.length>17&&(i+=t[17]),!this.savebulk&&t.length>18&&(i+=t[18]),(null!=this.commandprarameter&&("NoWorkFlow"==this.commandprarameter||"NoWorkFlowReSave"==this.commandprarameter||"NoWorkFlowprint"==this.commandprarameter)||this.ScreenObject.Preferences.ContainsKey("NoWorkflowPostedDocs")&&""!=this.ScreenObject.Preferences.NoWorkflowPostedDocs&&Object(l.j)(this.ScreenObject.Preferences.NoWorkflowPostedDocs)&&369==this.StatusID)&&(i+=' WorkFlow="NO"'),this.ScreenObject.IsDocEdit&&(i+=' Guid="'+o.e.String(this.ScreenObject.guid)+'"'),this.LineWiseApproval&&(i+=' LineWiseApproval="1"'),i+=' CCGuid="'+o.e.String(this.ScreenObject.CCguid)+'"',i+=' AP="'+s.a.SessionManager.GetAccessPoint()+'"',!this.savebulk&&t.length>9&&Object(l.j)(t[9])&&(i+=' SaveUnapproved="1"'),s.a.SessionManager.AccountingFromMonth>s.a.SessionManager.AccountingToMonth){var c,u;c=this.DocumentDate.iMonth()>s.a.SessionManager.AccountingFromMonth?"1/"+this.ScreenObject.GetMonthName(s.a.SessionManager.AccountingFromMonth,!1)+"/"+this.DocumentDate.getFullYear():"1/"+this.ScreenObject.GetMonthName(s.a.SessionManager.AccountingFromMonth,!1)+"/"+(this.DocumentDate.getFullYear()-1).toString(),u=this.DocumentDate.iMonth()<s.a.SessionManager.AccountingFromMonth?o.e.DaysInMonth(this.DocumentDate.getFullYear(),s.a.SessionManager.AccountingToMonth-1)+"/"+this.ScreenObject.GetMonthName(s.a.SessionManager.AccountingToMonth,!1)+"/"+this.DocumentDate.getFullYear():o.e.DaysInMonth(this.DocumentDate.getFullYear()+1,s.a.SessionManager.AccountingToMonth-1)+"/"+this.ScreenObject.GetMonthName(s.a.SessionManager.AccountingToMonth,!1)+"/"+(this.DocumentDate.getFullYear()+1).toString(),i+=' FinancialSartDate="'+c+'"',i+=' FinancialEndDate="'+u+'"'}else i+=' FinancialSartDate="1/'+this.ScreenObject.GetMonthName(s.a.SessionManager.AccountingFromMonth,!1)+"/"+this.DocumentDate.getFullYear()+'"',i+=' FinancialEndDate="'+o.e.DaysInMonth(this.DocumentDate.getFullYear(),s.a.SessionManager.AccountingToMonth-1)+"/"+this.ScreenObject.GetMonthName(s.a.SessionManager.AccountingToMonth,!1)+"/"+this.DocumentDate.getFullYear()+'"';if(t[3].length>1&&(i+=' DetailIds="'+t[3].substr(1)+'"'),this.ScreenObject.Preferences.ContainsKey("Enable Hold")&&Object(l.j)(this.ScreenObject.Preferences["Enable Hold"])){var d=this.ScreenObject.ColumnSource.find((function(e){return"HoldQuantity"==e.DisplayMember}));d&&null!=d.Expression&&""!=d.Expression&&(i+=' HoldCheck="1"')}if(this.savebulk&&(i+=this.getQuery()),i+=" >",i+=null!=this.ViewActivities?this.ViewActivities.ActivitiesXML():"<ScheduleActivityXml></ScheduleActivityXml>",o.e.IsEmpty(this.ScreenObject.HistoryCCXML)||(i+="<History>"+this.ScreenObject.HistoryCCXML+"</History>"),this.ScreenObject.Preferences.ContainsKey("CrossDimDocument")&&!o.e.IsEmpty(this.ScreenObject.Preferences.CrossDimDocument)&&parseInt(this.ScreenObject.Preferences.CrossDimDocument)>0){var D=this.PostCrossDimDOc();if("0"==D)return;i+=D}if(32==this.ScreenObject.DocumentType){var m="",b=this.ScreenObject.ColumnSource.find((function(e){return e.ID==n.ScreenObject.Preferences.VarienceField}));if(b&&(m=b.DisplayMember),this.ScreenObject.Preferences.ContainsKey("ShortageDOC")&&""!=this.ScreenObject.Preferences.ShortageDOC&&""!=m&&this.ScreenObject.GridDataColumns.Contains(m)){var y=new a(parseInt(this.ScreenObject.Preferences.ShortageDOC),"",!0),g=function(){var e;y.CheckStockDimensions(),y.ScreenObject.GridDataColumns.push("ParentSeqNo"),y.ScreenObject._CCFields.forEach((function(e){if(e instanceof C.b){var t=n.ScreenObject._CCFields.find((function(t){return t instanceof C.b&&t.CCID==e.CCID}));t instanceof C.b&&(e.SelectedValue=t.SelectedValue)}}));for(var t=0,a=function(a){!o.e.IsEmpty(n.ScreenObject.GridData[a].ProductID_Key)&&!o.e.IsEmpty(n.ScreenObject.GridData[a][m])&&parseFloat(n.ScreenObject.GridData[a][m])<0&&(t++,e=y.ScreenObject.GridDataObj.NewRow(),y.ScreenObject.ColumnSource.forEach((function(t){if(t.CostCenterID>5e4)if(n.ScreenObject.GridDataColumns.Contains("dcCCNID"+(t.CostCenterID-5e4)))o.e.IsEmpty(n.ScreenObject.GridData[a]["dcCCNID"+(t.CostCenterID-5e4)+"_Key"])||(e["dcCCNID"+(t.CostCenterID-5e4)+"_Key"]=n.ScreenObject.GridData[a]["dcCCNID"+(t.CostCenterID-5e4)+"_Key"].toString(),e["dcCCNID"+(t.CostCenterID-5e4)]=n.ScreenObject.GridData[a]["dcCCNID"+(t.CostCenterID-5e4)].toString());else{var i=n.ScreenObject._CCFields.find((function(e){return e instanceof C.b&&e.CCID==t.CostCenterID}));i instanceof C.b&&(e["dcCCNID"+(t.CostCenterID-5e4)]=i.SelectedValue)}})),e.ProductID_Key=n.ScreenObject.GridData[a].ProductID_Key.toString(),e.QOH=n.ScreenObject.GridData[a].QOH.toString(),e.ParentSeqNo=n.ScreenObject.GridData[a].DocSeqNo.toString(),y.ScreenObject.GridDataColumns.Contains("ProductCode")&&(e.ProductCode=n.ScreenObject.GridData[a].ProductCode),y.ScreenObject.GridDataColumns.Contains("ProductName")&&(e.ProductName=n.ScreenObject.GridData[a].ProductName),e.Type=n.ScreenObject.GridData[a].Type,e.Unit=n.ScreenObject.GridData[a].Unit,e.Unit_Key=n.ScreenObject.GridData[a].Unit_Key,e.Rate=n.ScreenObject.GridData[a].Rate,n.ScreenObject.Preferences.ContainsKey("DontCalcQOH")&&!o.e.IsEmpty(n.ScreenObject.Preferences.DontCalcQOH)&&Object(l.j)(n.ScreenObject.Preferences.DontCalcQOH)||y.AddProductData(e,!1,!0),e.Quantity=n.ScreenObject.GridData[a][m].toString().replace("-",""),o.e.IsEmpty(e.UOMConversion)?(e.UOMConversion="1",e.UOMConvertedQty=e.Quantity):e.UOMConvertedQty=parseFloat(e.Quantity)*parseFloat(e.UOMConversion),o.e.IsEmpty(n.ScreenObject.GridData[a].Type)||5!=parseInt(n.ScreenObject.GridData[a].Type.toString())&&2!=parseInt(n.ScreenObject.GridData[a].Type.toString())||(e.ExtraXML=n.ScreenObject.GridData[a].ExtraXML),y.ScreenObject.GridData.push(e),y.CalculateTotals(e,!1,"",!1))},r=0;r<n.ScreenObject.GridData.length;r++)a(r);if(t>0){if(y.parent=n,y.IsAutoPost=!0,y.savebulk=!0,y.SaveInventoryDocument("Save",!1),!o.e.IsEmpty(y.DisplayMessage))return{v:void(n.DisplayMessage=" Shortage of stock"+y.DisplayMessage)};i+=n.AutoPOstXML.replace("AutoPOstXML","ShortageXML"),n.AutoPOstXML=""}}();if("object"==typeof g)return g.v}if(this.ScreenObject.Preferences.ContainsKey("ExcessDOC")&&""!=this.ScreenObject.Preferences.ExcessDOC&&""!=m&&this.ScreenObject.GridDataColumns.Contains(m)){var f=new a(parseInt(this.ScreenObject.Preferences.ExcessDOC),"",!0),O=function(){f.CheckStockDimensions(),f.ScreenObject._CCFields.forEach((function(e){if(e instanceof C.b){var t=n.ScreenObject._CCFields.find((function(t){return t instanceof C.b&&t.CCID==e.CCID}));t instanceof C.b&&(e.SelectedValue=t.SelectedValue)}}));var e,t=0;f.ScreenObject.GridDataColumns.push("ParentSeqNo");for(var a=function(a){!o.e.IsEmpty(n.ScreenObject.GridData[a].ProductID_Key)&&!o.e.IsEmpty(n.ScreenObject.GridData[a][m])&&parseFloat(n.ScreenObject.GridData[a][m])>0&&(t++,e=f.ScreenObject.GridDataObj.NewRow(),f.ScreenObject.ColumnSource.forEach((function(t){if(t.CostCenterID>5e4)if(n.ScreenObject.GridDataColumns.Contains("dcCCNID"+(t.CostCenterID-5e4)))o.e.IsEmpty(n.ScreenObject.GridData[a]["dcCCNID"+(t.CostCenterID-5e4)+"_Key"])||(e["dcCCNID"+(t.CostCenterID-5e4)+"_Key"]=n.ScreenObject.GridData[a]["dcCCNID"+(t.CostCenterID-5e4)+"_Key"].toString(),e["dcCCNID"+(t.CostCenterID-5e4)]=n.ScreenObject.GridData[a]["dcCCNID"+(t.CostCenterID-5e4)].toString());else{var i=n.ScreenObject._CCFields.find((function(e){return e instanceof C.b&&e.CCID==t.CostCenterID}));i instanceof C.b&&(e["dcCCNID"+(t.CostCenterID-5e4)]=i.SelectedValue)}})),e.ProductID_Key=n.ScreenObject.GridData[a].ProductID_Key.toString(),e.QOH=n.ScreenObject.GridData[a].QOH.toString(),e.ParentSeqNo=n.ScreenObject.GridData[a].DocSeqNo.toString(),f.ScreenObject.GridDataColumns.Contains("ProductCode")&&(e.ProductCode=n.ScreenObject.GridData[a].ProductCode),f.ScreenObject.GridDataColumns.Contains("ProductName")&&(e.ProductName=n.ScreenObject.GridData[a].ProductName),e.Type=n.ScreenObject.GridData[a].Type,e.Unit=n.ScreenObject.GridData[a].Unit,e.Unit_Key=n.ScreenObject.GridData[a].Unit_Key,e.Rate=n.ScreenObject.GridData[a].Rate,n.ScreenObject.Preferences.ContainsKey("DontCalcQOH")&&!o.e.IsEmpty(n.ScreenObject.Preferences.DontCalcQOH)&&Object(l.j)(n.ScreenObject.Preferences.DontCalcQOH)||f.AddProductData(e,!1,!0),e.Quantity=n.ScreenObject.GridData[a][m].toString(),o.e.IsEmpty(e.UOMConversion)?(e.UOMConversion="1",e.UOMConvertedQty=e.Quantity):e.UOMConvertedQty=parseFloat(e.Quantity)*parseFloat(e.UOMConversion),o.e.IsEmpty(n.ScreenObject.GridData[a].Type)||5!=parseInt(n.ScreenObject.GridData[a].Type.toString())&&2!=parseInt(n.ScreenObject.GridData[a].Type.toString())||(e.ExtraXML=n.ScreenObject.GridData[a].ExtraXML),f.ScreenObject.GridData.push(e),f.CalculateTotals(e,!1,"",!1))},r=0;r<n.ScreenObject.GridData.length;r++)a(r);if(t>0){if(f.parent=n,f.IsAutoPost=!0,f.savebulk=!0,f.SaveInventoryDocument("Save",!1),!o.e.IsEmpty(f.DisplayMessage))return{v:void(n.DisplayMessage=" Excess of stock"+f.DisplayMessage)};i+=n.AutoPOstXML.Replace("AutoPOstXML","ExcessXML"),n.AutoPOstXML=""}}();if("object"==typeof O)return O.v}}else if(73==this.ScreenObject.DocumentType){var I=new a(40072,"Apply Vacation",!1);I.strVacXml="LAV";for(var T=0;T<this.ScreenObject.GridData.length;T++)if(null!=this.ScreenObject.GridData[T].dcAlpha4&&null!=this.ScreenObject.GridData[T].dcAlpha1&&"Yes"==this.ScreenObject.GridData[T].dcAlpha4.toString()){var j=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));(j instanceof C.b&&j.SelectedValue>0||j instanceof p.a&&j.SelectedValue>0)&&(I.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})).SelectedValue=j.SelectedValue),I.DimensionSelectedvalueData(),I.ScreenObject._StaticFields.find((function(e){return"commonnarration"==e.DBColumnName.toLowerCase()})).Text="Leave Adjusted as Vacation",I.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()})).Date=new Date(this.ScreenObject.GridData[T].dcAlpha2_Key);var P=I.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()}));null!=P&&P instanceof S.c&&!o.e.IsEmpty(P.Date)&&I.onDateChanged(P),I.ScreenObject._TextFields.find((function(e){return"dcalpha3"==e.DBColumnName.toLowerCase()})).Date=new Date(this.ScreenObject.GridData[T].dcAlpha3_Key),null!=(P=I.ScreenObject._TextFields.find((function(e){return"dcalpha3"==e.DBColumnName.toLowerCase()})))&&P instanceof S.c&&P.Date&&I.ApplyVacation(P),I.ButtonsEnabled=!0,I.SaveInventoryDocument_1("Save")}if(""!=I.strVacXml){if(I.strVacXml.Contains("LAV"))return void(this.DisplayMessage=I.strVacXml.toString().replace("LAV",""));i+=I.strVacXml.toString()}}else if(202==this.ScreenObject.DocumentType){var A=new a(40203,"Preventive Service Request",!1);A.strPMCXml="PRS",o.e.IsEmpty(this.ScreenObject.GridData[0].ExtraXML)||(s.a.SessionManager.FMExtraXml=this.ScreenObject.GridData[0].ExtraXML.toString()),A.ScreenObject.DocDate.Date=this.ScreenObject.DocDate.Date;for(var M=function(e){!o.e.IsEmpty(n.ScreenObject.GridData[e].dcCCNID154_Key)&&parseFloat(n.ScreenObject.GridData[e].dcCCNID154_Key.toString())>0&&(A.ScreenObject._CCFields.forEach((function(t){if(t instanceof C.b&&t.CCID>0&&n.ScreenObject.GridDataColumns.Contains("dcCCNID"+(t.CCID-5e4))&&!o.e.IsEmpty(n.ScreenObject.GridData[e]["dcCCNID"+(t.CCID-5e4)+"_Key"])){var a=n.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember==t.DBColumnName}));t.SelectedValue=null!=a&&t instanceof C.b&&!o.e.IsEmpty(n.ScreenObject.GridData[e]["dcCCNID"+(t.CCID-5e4)+"_Key"])?parseInt(n.ScreenObject.GridData[e]["dcCCNID"+(t.CCID-5e4)+"_Key"].toString()):0}})),A.ScreenObject._TextFields.forEach((function(t){var a=n.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember==t.DBColumnName}));null==a||"text"!=a.DataType.toLowerCase().toString()&&"string"!=a.DataType.toLowerCase().toString()?null==a||"date"!=a.DataType.toLowerCase().toString()&&"datetime"!=a.DataType.toLowerCase().toString()||o.e.IsEmpty(n.ScreenObject.GridData[e][t.DBColumnName+"_Key"])||(t.Date=new Date(n.ScreenObject.GridData[e][t.DBColumnName+"_Key"].toString())):t instanceof h.d?t.Text="dcalpha1"==t.DBColumnName.toLowerCase().toString()?s.a.SessionManager.UserName:n.ScreenObject.GridData[e][t.DBColumnName].toString():t instanceof h.c&&(t.Text=n.ScreenObject.GridData[e][t.DBColumnName].toString())})),A.ButtonsEnabled=!0,A.SaveInventoryDocument("Save"))},v=0;v<this.ScreenObject.GridData.length;v++)M(v);if(!o.e.IsEmpty(A.strPMCXml)){if(A.strPMCXml.Contains("PRS"))return this.DisplayMessage=A.strPMCXml.toString().Replace("PMC",""),void(this.MessageVisibility=!0);i+=A.strPMCXml.toString(),s.a.SessionManager.FMExtraXml="",this.iPMCActivity=0}}else if(56==this.ScreenObject.DocumentType){if(this.LoanGuaranteeVisible&&null!=this.dtLoanGuarantees&&this.dtLoanGuarantees.length>0){var G="";G+="<LoanGuaranteesXML>",G+="<Rows>";for(var N=0;N<this.dtLoanGuarantees.length;N++)G+='<Row EmpSeqNo="'+this.dtLoanGuarantees[N].GEmpSeqNo.toString(),G+='" />';G+="</Rows>",i+=(G+="</LoanGuaranteesXML>").toString()}}else if(61==this.ScreenObject.DocumentType){if(null!=this.dtVacDefineDays&&this.dtVacDefineDays.length>0){var E="";E+="<VacManageDefineDays>",E+="<Rows>";for(var w=0;w<this.dtVacDefineDays.length;w++)E+='<Row SNo="'+this.dtVacDefineDays[w].SNo.toString()+'" FromMonth="'+this.dtVacDefineDays[w].FromMonth.toString()+'" ToMonth="'+this.dtVacDefineDays[w].ToMonth.toString()+'" DaysPerMonth="'+this.dtVacDefineDays[w].DaysPerMonth.toString()+'" ApplyToPrevMonths="'+this.dtVacDefineDays[w].ApplyToPrevMonths.toString(),E+='" />';E+="</Rows>",i+=E+="</VacManageDefineDays>"}}else if(85==this.ScreenObject.DocumentType){if(this.sApprUpdate.length>0)if(this.ScreenObject.Preferences.ContainsKey("UpdateGradeandAppraisalData")&&"True"==this.ScreenObject.Preferences.UpdateGradeandAppraisalData){var F="0",V="0",L=new Date,R=this.ScreenObject._CCFields.find((function(e){return"dcccnid53"==e.DBColumnName.toLowerCase()}));null!=R&&null!=R&&(R instanceof C.b||R instanceof p.a)&&(F=R.SelectedValue.toString()),null!=(R=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})))&&null!=R&&(R instanceof C.b||R instanceof p.a)&&(V=R.SelectedValue.toString());var B=this.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()}));null!=B&&null!=B&&B instanceof S.c&&!o.e.IsEmpty(B.Date)&&(L=B.Date),i+='<PayrollBulkAppraisals Grade="'+F+'" EmpID="'+V+'" EffectFrom="'+L.ToString("dd/MMM/yyyy")+'" Query="'+h.d.GetValidXml(this.sApprUpdate)+'"></PayrollBulkAppraisals>'}else i+='<PayrollBulkAppraisals Query="'+h.d.GetValidXml(this.sApprUpdate)+'"></PayrollBulkAppraisals>'}else if(97==this.ScreenObject.DocumentType){if(this.ScreenObject.GridData.length>0){var x="",k=new Date,_=new Date,K=new Date,Q=this.ScreenObject._TextFields.find((function(e){return"dcalpha33"==e.DBColumnName.toLowerCase()}));if(Q&&Q instanceof S.c&&Q.Date){var H={PayrollMonth:k=Q.Date,PayrollMonthStart:_,PayrollMonthEnd:K};o.e.SetPayrollDate(k,H),k=H.PayrollMonth,_=H.PayrollMonthStart,x=(K=H.PayrollMonthEnd).ToString("dd MMM yyyy")}for(var W=s.a.common.GetDataSet("PAY050",this.DocID.toString()),U=null,X="",q=0;q<this.ScreenObject.GridData.length;q++)!o.e.IsEmpty(this.ScreenObject.GridData[q].dcAlpha27)&&parseFloat(this.ScreenObject.GridData[q].dcAlpha27)>0&&function(){var e=parseFloat(n.ScreenObject.GridData[q].dcAlpha27),t=0,a=0,i=n.ScreenObject.GridData[q].dcCCNID51_Key.toString(),r="",c=!1,l=!1,u=n.ScreenObject.GridData[q].dcAlpha28.toString().split(";");if(null!=u&&u.length>0)for(var d=function(n){if(null!=u[n]&&""!=u[n]&&e>0){if(c=!1,l=!1,r=W.Tables[0].filter((function(e){return e.ComponentName==u[n]}))[0].ComponentID.toString(),s.a.SessionManager.Preferences.ContainsKey("ConsiderLOPBasedOn")){var d=s.a.SessionManager.Preferences.ConsiderLOPBasedOn.split(",");if(null!=d&&d.length>0)for(var D=0;D<d.length;D++)if(null!=d[D]&&d[D]==r){l=!0;break}}if(null!=W.Tables[1]&&W.Tables[1].length>0&&null!=W.Tables[1][0].VacationComponentID&&null!=W.Tables[1][0].VacationComponentID&&W.Tables[1][0].VacationComponentID.toString()==r&&(c=!0),c);else{var h,S="",m="",b="";null!=s.a.SessionManager.dtDocDefAccs&&(null!=(h=s.a.SessionManager.dtDocDefAccs.filter((function(e){return 40062==e.CostCenterID&&"ProductID"==e.SysColumnName})))&&h.length>0&&!o.e.IsEmpty(h[0].UserDefaultValue)&&""!=h[0].UserDefaultValue.toString().trim()&&(b=h[0].UserDefaultValue.toString()),null!=(h=s.a.SessionManager.dtDocDefAccs.filter((function(e){return 40062==e.CostCenterID&&"CreditAccount"==e.SysColumnName})))&&h.length>0&&!o.e.IsEmpty(h[0].UserDefaultValue)&&""!=h[0].UserDefaultValue.toString().trim()&&(S=h[0].UserDefaultValue.toString()),null!=(h=s.a.SessionManager.dtDocDefAccs.filter((function(e){return 40062==e.CostCenterID&&"DebitAccount"==e.SysColumnName})))&&h.length>0&&!o.e.IsEmpty(h[0].UserDefaultValue)&&""!=h[0].UserDefaultValue.toString().trim()&&(m=h[0].UserDefaultValue.toString()));var C,y="0";null!=W.Tables[2]&&W.Tables[2].length>0&&(null!=(C=W.Tables[2].filter((function(e){return e.EmpSeqNo==i&&e.LeaveComponentID==r})))&&C.length>0&&(y=C[0].DocID.toString()));var p=[];if(p.push(i),p.push(r),p.push(x),p.push(y),p.push(s.a.SessionManager.UserID),p.push(s.a.SessionManager.LanguageID),null!=(U=s.a.common.GetDataSet_SP(p,"spPAY_ExtGetAssignedLeaves").Tables[0])&&U.length>0){if(t=parseFloat(U[0].AvailableLeaves),!l&&t<=0)return"continue";X+='<LatesLeaves DocID="'+y+'" DocDetIDs="" WorkFlowID="0" >',X+="<DOCXML>",X+="<RowHead/>",X+="<Row>",X+='<Transactions DocSeqNo="1"  DocDetailsID="0" LinkedInvDocDetailsID="0" LinkedFieldName="" IsScheme="" ProductID="'+b+'" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1" Rate="0" Gross="" RefNO="" LineNarration="Remarks" IsQtyIgnored="1" AverageRate="0" StockValue="0" Net="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1.0" CommonNarration="POSTED FROM LATES PROCESSING DOCUMENT"  DebitAccount="'+m+'"  CreditAccount="'+S+'"  ></Transactions>',X+='<Numeric Query="" ></Numeric>',l?(X+="<Alpha Query=\"dcAlpha2=N'0', dcAlpha3=N'0', dcAlpha4=N'"+x+"', dcAlpha5=N'"+x+"', dcAlpha6=N'Both', dcAlpha8=N'-1', dcAlpha7=N'"+e+"', dcAlpha9=N'-1', dcAlpha10=N'0', dcAlpha14=N'0', dcAlpha16=N'LatesProcessing', \" ></Alpha>",X+='<CostCenters Query="dcCCNID52='+r+", dcCCNID51="+i+', " ></CostCenters>'):(e<=t?(a=e,e=0):(a=t,e-=t),X+="<Alpha Query=\"dcAlpha2=N'"+U[0].AssignedLeaves.toString()+"', dcAlpha3=N'"+U[0].AvailableLeaves.toString()+"', dcAlpha4=N'"+x+"', dcAlpha5=N'"+x+"', dcAlpha6=N'Both', dcAlpha8=N'100', dcAlpha7=N'"+a+"', dcAlpha9=N'"+U[0].MaxLeaves.toString()+"', dcAlpha10=N'0', dcAlpha14=N'"+U[0].ActualAvailableLeaves.toString()+"', dcAlpha16=N'LatesProcessing', \" ></Alpha>",X+='<CostCenters Query="dcCCNID52='+r+", dcCCNID51="+i+', " ></CostCenters>'),X+="</Row>",X+="</DOCXML>",X+="</LatesLeaves>"}}}},D=0;D<u.length;D++)d(D)}();X.length>0&&(i+=(X="<LPL>"+X+"</LPL>").toString())}}else if(72==this.ScreenObject.DocumentType&&null!=this.dtVacContract&&this.dtVacContract.length>0){var Y="";Y+="<VacContract>",Y+="<Rows>";for(var z=0;z<this.dtVacContract.length;z++)Y+='<Row SNo="'+this.dtVacContract[z].SNo.toString()+'" ContractNodeID="'+this.dtVacContract[z].ContractNodeID.toString()+'" ContractFrom="'+this.dtVacContract[z].ContractFrom.toString()+'" ContractTo="'+this.dtVacContract[z].ContractTo.toString()+'" CreditedDays="'+this.dtVacContract[z].CreditedDays.toString()+'" PrevTakenDays="'+this.dtVacContract[z].PrevTakenDays.toString()+'" BalanceDays="'+this.dtVacContract[z].BalanceDays.toString()+'" CanAvail="'+this.dtVacContract[z].CanAvail.toString(),Y+='" />';Y+="</Rows>",i+=(Y+="</VacContract>").toString()}var J=null!=this.ViewAttachments?this.ViewAttachments.GetXML():"";if(J+=this.ScreenObject.GetExtraAttachmentXML(),this.savebulk){alert("Bulk Save Pending"),i+="</XML>";var Z=[];Z.push(t[0]),Z.push(t[1]),Z.push(t[2]),Z.push(t[4]),Z.push(t[5]),Z.push(t[6]),Z.push(t[7]),Z.push(t[8]);var $={stat:0,RetVal:0};this.DisplayMessage=this.ScreenObject.SaveBulkInvDoc(Z,null!=this.ViewNotes?this.ViewNotes.GetXML():"",J,this.DocumentDate,t[8],null!=this.AssignAddress?this.AssignAddress.GetXML():"",i,$),this.StatusID=$.stat,this.RetValue=$.RetVal}else{if(i+=t[2],i+=t[4],i+=t[5],i+=t[6],i+=t[7],i+=t[8],i+=t[12],i+=t[13],i+=t[15],i+="</XML>",this.PrevDocID=this.ScreenObject.DocID,o.e.IsEmpty(this.APIAddressXML))if(null!=this.AssignAddress){if(this.APIAddressXML=this.AssignAddress.GetXML(),this.AssignAddress.PrimMandatory&&!this.APIAddressXML.Contains('TypeID="1"'))return void(this.DisplayMessage="Primary Address Mandatory");if(this.AssignAddress.BillsMandatory&&!this.APIAddressXML.Contains('TypeID="2"'))return void(this.DisplayMessage="Billing Address Mandatory");if(this.AssignAddress.ShipMandatory&&!this.APIAddressXML.Contains('TypeID="3"'))return void(this.DisplayMessage="Shipping Address Mandatory")}else this.APIAddressXML="";this.ScreenObject.SaveInventoryDocument(t[0],t[1],null!=this.ViewNotes?this.ViewNotes.GetXML():"",J,this.DocumentDate,t[14],this.APIAddressXML,i,t),this.APIAddressXML=""}if(72!=this.ScreenObject.DocumentType||this.ReevaluateFutureVac||369!=this.StatusID||this.ReevaluateFutureVacation(),67==this.DocumentType&&"PostingFromBiometric"==this.ScreenObject.ParentFlagName&&this.ScreenObject.Preferences.ContainsKey("SkipEmployeesWhoGetErrorsWhileSaving")&&!o.e.IsEmpty(this.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving)&&Object(l.j)(this.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving)&&this.sBioErrLogs.length>0&&(o.e.WriteErrorsToFile(this.sBioErrLogs,"BiometricDocPostErrors"),this.DisplayMessage="Posted with Erros. Check for the Logs @ BiometricDocPostErrors.txt in application folder ",this.MessageVisibility=!0),this.MessageVisibility=!0,this.IsFrmFS_LoanBal)return this.DialogResult=!0,void s.a.page.HideDialog()}}},{key:"SaveInventoryDocument_CallBack",value:function(e){this.Save_Completed(),-407==this.RetValue&&Object(l.j)(e[11])&&alert(this.DisplayMessage)}},{key:"ReevaluateFutureVacation",value:function(){var e="",t=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));null!=t&&null!=t&&(t instanceof C.b||t instanceof p.a)&&(e=t.SelectedValue.toString());var n=this.ScreenObject._TextFields.find((function(e){return"dcalpha3"==e.DBColumnName.toLowerCase()}));if(null!=n&&n instanceof S.c&&""!=n.Date.toString()){var i=s.a.common.GetDataTable("PAY080",e+"~"+n.Date.ToString("dd/MMM/yyyy"));if(null!=i&&i.length>0){if(!(this.ScreenObject.DocID>0))return;var r=s.a.common.ExecuteQuery_ReturnString("PAY081",this.ScreenObject.DocID.toString());if(r.Trim().length>0)return this.DisplayMessage="Error : "+r,void(this.MessageVisibility=!0);for(var c=0;c<i.length;c++){var l=new a(40072,"Apply Vacation",!0);l.ReevaluateFutureVac=!0;var u={value:this._Ddate};l.ScreenObject.OnDocPrefixChanged("lostFocus",0,parseInt(i[c].DocID),u,!0),this._Ddate=u.value,l.DimensionSelectedvalueData();l.ScreenObject.GridData.Copy();var d=l.ScreenObject._TextFields.find((function(e){return"dcAlpha2"==e.DBColumnName.toString()}));null!=d&&null!=d&&l.onDateChanged(d);var D=l.ScreenObject._TextFields.find((function(e){return"dcAlpha3"==e.DBColumnName.toString()}));null!=D&&null!=D&&l.onDateChanged(d);var m=0,b=0,y=0,g=0,f=0,O=0,I=l.ScreenObject._TextFields.find((function(e){return"dcAlpha7"==e.DBColumnName.toString()}));null!=I&&null!=I&&I instanceof h.d&&(m=parseFloat(I.Text)),null!=(I=l.ScreenObject._TextFields.find((function(e){return"dcAlpha22"==e.DBColumnName.toString()})))&&null!=I&&I instanceof h.d&&(b=parseFloat(I.Text)),null!=(I=l.ScreenObject._TextFields.find((function(e){return"dcAlpha12"==e.DBColumnName.toString()})))&&null!=I&&I instanceof h.d&&(y=parseFloat(I.Text)),null!=(I=l.ScreenObject._TextFields.find((function(e){return"dcAlpha14"==e.DBColumnName.toString()})))&&null!=I&&I instanceof h.d&&!o.e.IsEmpty(I.Text)&&(g=parseFloat(I.Text)),null!=(I=l.ScreenObject._TextFields.find((function(e){return"dcAlpha11"==e.DBColumnName.toString()})))&&I instanceof h.d&&!o.e.IsEmpty(I.Text)&&(f=parseFloat(I.Text)),null!=(I=l.ScreenObject._TextFields.find((function(e){return"dcAlpha10"==e.DBColumnName.toString()})))&&null!=I&&I instanceof h.d&&!o.e.IsEmpty(I.Text)&&(O=parseFloat(I.Text));var T=s.a.common.ExecuteQuery_ReturnString("PAY082",m+"~"+y+"~"+b+"~"+g+"~"+f+"~"+O+"~"+l.ScreenObject.DocID.toString());if(T.Trim().length>0)return this.DisplayMessage="Error : "+T,void(this.MessageVisibility=!0)}}}}},{key:"getQuery",value:function(){for(var e="",t="",n="",a="",i="",r="",o="",c="",u="",d="",D=0;D<this.ScreenObject.Data.Tables[0].length;D++){var h=this.ScreenObject.Data.Tables[0][D].SysColumnName.toLowerCase();h.startsWith("dcnum")?(t+=this.ScreenObject.Data.Tables[0][D].SysColumnName+",",s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&(t+="dcCurrID"+this.ScreenObject.Data.Tables[0][D].SysColumnName.replace("dcNum","")+",",t+="dcExchRT"+this.ScreenObject.Data.Tables[0][D].SysColumnName.replace("dcNum","")+",",t+="dcCalcNumFC"+this.ScreenObject.Data.Tables[0][D].SysColumnName.replace("dcNum","")+","),t+="dcCalc"+this.ScreenObject.Data.Tables[0][D].SysColumnName.replace("dc","")+",",i+="X.value('@"+this.ScreenObject.Data.Tables[0][D].SysColumnName+"','Float'),",s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&(i+="X.value('@dcCurrID"+this.ScreenObject.Data.Tables[0][D].SysColumnName.replace("dcNum","")+"','Float'),",i+="X.value('@dcExchRT"+this.ScreenObject.Data.Tables[0][D].SysColumnName.replace("dcNum","")+"','Float'),",i+="X.value('@dcCalcNumFC"+this.ScreenObject.Data.Tables[0][D].SysColumnName.replace("dcNum","")+"','Float'),"),i+="X.value('@dcCalc"+this.ScreenObject.Data.Tables[0][D].SysColumnName.replace("dc","")+"','Float'),",this.ScreenObject.DocID>0&&(c+=this.ScreenObject.Data.Tables[0][D].SysColumnName+"=",c+="X.value('@"+this.ScreenObject.Data.Tables[0][D].SysColumnName+"','Float'),",s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&(c+="dcCurrID"+this.ScreenObject.Data.Tables[0][D].SysColumnName.replace("dcNum","")+"=",c+="X.value('@dcCurrID"+this.ScreenObject.Data.Tables[0][D].SysColumnName.replace("dcNum","")+"','Float'),",c+="dcExchRT"+this.ScreenObject.Data.Tables[0][D].SysColumnName.replace("dcNum","")+"=",c+="X.value('@dcExchRT"+this.ScreenObject.Data.Tables[0][D].SysColumnName.replace("dcNum","")+"','Float'),",c+="dcCalcNumFC"+this.ScreenObject.Data.Tables[0][D].SysColumnName.replace("dcNum","")+"=",c+="X.value('@dcCalcNumFC"+this.ScreenObject.Data.Tables[0][D].SysColumnName.replace("dcNum","")+"','Float'),"),c+="dcCalc"+this.ScreenObject.Data.Tables[0][D].SysColumnName.replace("dc","")+"=",c+="X.value('@dcCalc"+this.ScreenObject.Data.Tables[0][D].SysColumnName.replace("dc","")+"','Float'),")):h.startsWith("dcalpha")?(a+=this.ScreenObject.Data.Tables[0][D].SysColumnName+",",o+="X.value('@"+this.ScreenObject.Data.Tables[0][D].SysColumnName+"','Nvarchar(max)'),",this.ScreenObject.DocID>0&&(d+=this.ScreenObject.Data.Tables[0][D].SysColumnName+"=",d+="X.value('@"+this.ScreenObject.Data.Tables[0][D].SysColumnName+"','Nvarchar(max)'),")):h.startsWith("dcCCNID")&&(n+=this.ScreenObject.Data.Tables[0][D].SysColumnName+",",r+="isnull(X.value('@"+this.ScreenObject.Data.Tables[0][D].SysColumnName.toString()+"','BIGINT'),1),",this.ScreenObject.DocID>0&&(u+=this.ScreenObject.Data.Tables[0][D].SysColumnName+"=",u+="isnull(X.value('@"+this.ScreenObject.Data.Tables[0][D].SysColumnName.toString()+"','BIGINT'),1),"))}return e+=' NumCols="'+t.toString()+'" ',e+=' TextCols="'+a.toString()+'" ',e+=' CCCols="'+n.toString()+'" ',e+=' NumSelCols="'+i.toString()+'" ',e+=' TextSelCols="'+o.toString()+'" ',e+=' CCSelCols="'+r.toString()+'" ',this.ScreenObject.DocID>0&&(e+=' NumUpdateCols="'+c.toString()+'" ',e+=' TextUpdateCols="'+d.toString()+'" ',e+=' CCUpdateCols="'+u.toString()+'" '),e}},{key:"ConvertHoursToMinutes",value:function(e){var t,n=0;return t=o.e.Int(e.split(".")[0]),e.split(".").length>1&&(n=o.e.Int(e.split(".")[1])),60*t+n}},{key:"AccountingSave_DoWork",value:function(e,t){var n=this;if(this.DisplayMessage="Saving Document.Please wait...",this.ButtonsEnabled=!1,t.length>1){var a="<XML ";if(this.ScreenObject.Preferences.ContainsKey("UseAsLC")&&""!=this.ScreenObject.Preferences.UseAsLC&&Object(l.j)(this.ScreenObject.Preferences.UseAsLC)||this.ScreenObject.Preferences.ContainsKey("UseAsTR")&&""!=this.ScreenObject.Preferences.UseAsTR&&Object(l.j)(this.ScreenObject.Preferences.UseAsTR)?a+=null==this.commandprarameter||"Approve"!=this.commandprarameter&&"NoWorkFlow"!=this.commandprarameter?' LCStatus="open"':' LCStatus="approved"':null==this.commandprarameter||"Approve"!=this.commandprarameter&&"ApproveandPrint"!=this.commandprarameter||(a+=' AppRejDate="'+this.AppRejDate.Date.ToString("dd/MMM/yyyy")+'"',a+=' Remarks="'+h.d.GetValidXml(this.Remarks.Text)+'"',this.IsLocked&&s.a.SessionManager.Preferences.ContainsKey("PostLockedDocs")&&Object(l.j)(s.a.SessionManager.Preferences.PostLockedDocs)&&(a+=' LockedPosting="1"'),this.RecurDocsWithApproval.Visible&&(a+=' RecurDocsWithApproval="'+(o.e.IsEmpty(this.RecurDocsWithApproval.SelectedValue)?"1":this.RecurDocsWithApproval.SelectedValue)+'"')),(null!=this.commandprarameter&&("NoWorkFlow"==this.commandprarameter||"NoWorkFlowprint"==this.commandprarameter)||this.ScreenObject.Preferences.ContainsKey("NoWorkflowPostedDocs")&&""!=this.ScreenObject.Preferences.NoWorkflowPostedDocs&&Object(l.j)(this.ScreenObject.Preferences.NoWorkflowPostedDocs)&&369==this.StatusID)&&(a+=' WorkFlow="NO"'),this.GenratePrefix&&(a+=' GenratePrefix="1" '),a+=' SysInfo="'+s.a.SessionManager.GetSysInfo()+'" ',this.ScreenObject.Preferences.ContainsKey("CrossDimDocument")&&""!=this.ScreenObject.Preferences.CrossDimDocument&&o.e.IsNum(this.ScreenObject.Preferences.CrossDimDocument)&&parseInt(this.ScreenObject.Preferences.CrossDimDocument)>4e4&&(a+=' ChildWorkFlowID="'+this.GetWorkFlow(!0,null)+'"'),o.e.IsEmpty(this.ScreenObject.guid)||(a+=' Guid="'+o.e.String(this.ScreenObject.guid)+'"'),a+=' CCGuid="'+o.e.String(this.ScreenObject.CCguid)+'"',a+=' AP="'+s.a.SessionManager.GetAccessPoint()+'"',this.ScheduleID>0&&(a+=' ScheduleID="'+this.ScheduleID+'"'),Object(l.j)(t[1])&&(a+=' SaveUnapproved="1"'),!this.IsLockDimsLineWise&&null!=this.LockDims){var i={join:""};a+=' LockDims="'+this.GetLockQuery(null,i)+'" ',""!=i.join&&(a+=' LockDimsjoin="'+i.join+'" ')}95!=this.ScreenObject.RefCCId&&104!=this.ScreenObject.RefCCId||(a+=' IsRef="Yes"'),t.length>3&&(a+=t[3]),a+=" >",a+=this.ViewActivities?this.ViewActivities.ActivitiesXML():"<ScheduleActivityXml></ScheduleActivityXml>",o.e.IsEmpty(this.ScreenObject.HistoryCCXML)||(a+="<History>"+this.ScreenObject.HistoryCCXML+"</History>"),this.ScreenObject.GridDataColumns.Contains("FieldType")&&(a+=this.GetpaymentModes()),a+="</XML>";var r=null!=this.ViewAttachments?this.ViewAttachments.GetXML():"";r+=this.ScreenObject.GetExtraAttachmentXML(),this.RetValue=0,this.PrevDocID=this.ScreenObject.DocID;var c="";this.ScreenObject.SaveAccountingDocument(t[0],null!=this.ViewNotes?this.ViewNotes.GetXML():"",r,a,this.DocumentDate,t[2],this.IsReplaced).subscribe((function(e){n.RetValue=e.obj;var t=e;c=null!=t&&t.Tables.length>0&&t.Tables[t.Tables.length-1].length>0&&t.Columns[t.Tables.length-1].Contains("ErrorMessage")?t.Tables[t.Tables.length-1][0].ErrorMessage.toString():"Problem in processing your request,Please contact administrator.",n.RetValue>0&&(null!=t&&t.Tables.length>0&&t.Tables[t.Tables.length-1].length>0&&t.Columns[t.Tables.length-1].Contains("VoucherNo")&&(n.ScreenObject.VoucherNo=t.Tables[t.Tables.length-1][0].VoucherNo.toString()),n.ScreenObject.DocID=n.RetValue,n.ScreenObject.DraftID>0&&(s.a.document.DeleteDocumentDraft(n.ScreenObject.DraftID),n.ScreenObject.DraftID=0),n.Save_Completed()),n.DisplayMessage=c,n.MessageVisibility=!0,Logger.InfoLog("VoucherGenerator:: Exiting SaveDocument")}),(function(e){console.log(e),n.DisplayMessage="Error in save"}))}}},{key:"GetpaymentModes",value:function(){var e=this,t="";if(this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key"))for(var n=function(n){o.e.IsEmpty(e.ScreenObject.GridData[n].CreditAccount_Key)||(t+='<XML Type="'+e.ScreenObject.Data.Tables[0].filter((function(t){return t.SysColumnName==e.ScreenObject.GridData[n].FieldType}))[0].SectionID.toString()+'" Amount="'+e.ScreenObject.GridData[n].Amount.toString()+'"   DBColumnName="'+e.ScreenObject.GridData[n].FieldType.toString()+'" ',e.ScreenObject.GridDataColumns.Contains("ChequeNumber")&&(t+=' CardNo="'+e.ScreenObject.GridData[n].ChequeNumber.toString()+'" '),e.ScreenObject.GridDataColumns.Contains("ChequeBankName")&&(t+=' CardName="'+e.ScreenObject.GridData[n].ChequeBankName.toString()+'" '),e.ScreenObject.GridDataColumns.Contains("ChequeDate_Key")&&!o.e.IsEmpty(e.ScreenObject.GridData[n].ChequeDate_Key)&&(t+=' CardName="'+new Date(e.ScreenObject.GridData[n].ChequeDate_Key).ToString("dd/MMM/yyyy")+'" '),t+=' RegisterID="'+e.ScreenObject.RegisterNodeID+'" ShiftID="'+e.ScreenObject.ShiftNodeID+'" DocDate="'+e.DocumentDate.ToString("dd/MMM/yyyy")+'" />')},a=0;a<this.ScreenObject.GridData.length;a++)n(a);return t.length>0&&(t="<PosPayModes>"+t+"</PosPayModes>"),t}},{key:"GetpayModesNumericData",value:function(e){var t="";if(this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key"))for(var n=0;n<this.ScreenObject.GridData.length;n++)o.e.IsEmpty(this.ScreenObject.GridData[n].FieldType)||(e!=n||o.e.IsEmpty(this.ScreenObject.GridData[n].Amount)?t+=this.ScreenObject.GridData[n].FieldType.toString()+"=0,dcCalc"+this.ScreenObject.GridData[n].FieldType.toString().replace("dc","")+"=0,":t+=this.ScreenObject.GridData[n].FieldType.toString()+"="+this.ScreenObject.GridData[n].Amount.toString()+",dcCalc"+this.ScreenObject.GridData[n].FieldType.toString().replace("dc","")+"="+this.ScreenObject.GridData[n].Amount.toString()+",");return t}},{key:"GetLockQuery",value:function(e,t){var n=this;if(t.join="",!this.IsLockDimsLineWise&&null!=e)return"";if(this.IsLockDimsLineWise&&null==e)return"";var i=0,r="";return null!=this.LockDims&&this.LockDims.keys.length>0&&this.LockDims.keys.forEach((function(s){var c={Key:s,Value:n.LockDims[s]};if(i++,c.Value&&(t.join+=" left join "+n.ScreenObject.GetTableName(c.Key)+" CC"+i+" with(nolock) on C."+a.GetPrimarkyKey(c.Key,!0)+"=CC"+i+"."+a.GetPrimarkyKey(c.Key)+"\n                            left join "+n.ScreenObject.GetTableName(c.Key)+" CJ"+i+" with(nolock) on CJ"+i+".lft between CC"+i+".lft and CC"+i+".rgt"),c.Key>5e4)if(n.ScreenObject.GridDataColumns.Contains("dcCCNID"+(c.Key-5e4))&&!o.e.IsEmpty(e["dcCCNID"+(c.Key-5e4)+"_Key"]))r+=" and ("+(c.Value?"CJ"+i+".NodeID":"c.ccnid"+(c.Key-5e4))+" ="+e["dcCCNID"+(c.Key-5e4)+"_Key"].toString()+" or c.ccnid"+(c.Key-5e4)+"=0)";else{var l=n.ScreenObject._CCFields.find((function(e){return e.DBColumnName.toLowerCase()=="dcCCNID"+(c.Key-5e4)}));r+=l&&l instanceof C.b&&l.SelectedValue>0?" and ("+(c.Value?"CJ"+i+".NodeID":"c.ccnid"+(c.Key-5e4))+" ="+l.SelectedValue.toString()+" or c.ccnid"+(c.Key-5e4)+"=0)":" and c.ccnid"+(c.Key-5e4)+"=0"}else if(2==c.Key){var u="0";n.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&(u+=","+e.DebitAccount_Key.toString()),n.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&(u+=","+e.CreditAccount_Key.toString()),n.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&(u+=","+e.AccountID_Key.toString()),null!=n.ScreenObject.CreditAccount&&n.ScreenObject.CreditAccount.SelectedValue>0&&(u+=","+n.ScreenObject.CreditAccount.SelectedValue.toString()),null!=n.ScreenObject.DebitAccount&&n.ScreenObject.DebitAccount.SelectedValue>0&&(u+=","+n.ScreenObject.DebitAccount.SelectedValue.toString()),r+=" and ("+(c.Value?"CJ"+i:"c")+".AccountID in("+u+") or c.AccountID=0)"}else 3==c.Key&&n.IsInventoryVoucher&&null!=e?r+=" and ("+(c.Value?"CJ"+i:"c")+".ProductID ="+e.ProductID_Key.toString()+" or c.ProductID=0)":400==c.Key&&(r+=" and DocumentID in("+n.CostCenterID.toString()+",1)")})),r.toString()}},{key:"SetLockDims",value:function(){var e=this;if("true"==s.a.SessionManager.Preferences.UseDimWiseLock.toLowerCase()&&""!=s.a.SessionManager.Preferences["DimensionWiseLockData Customize Screen"]&&"<XML></XML>"!=s.a.SessionManager.Preferences["DimensionWiseLockData Customize Screen"]){this.ScreenObject.LockWhere="";var t="",n="";this.LockDims=new c.c;var i=0,r=0,l=new o.f;l.LoadXml(s.a.SessionManager.Preferences["DimensionWiseLockData Customize Screen"]),l.SelectNodes("XML/Row").forEach((function(s){if(null!=s.attributes.ID&&!o.e.IsEmpty(s.attributes.ID.value)){r++;var c=!1;((i=parseInt(s.attributes.ID.value))>5e4&&e.ScreenObject.GridDataColumns.Contains("dcCCNID"+(i-5e4))||2==i&&(e.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")||e.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")||e.ScreenObject.GridDataColumns.Contains("AccountID_Key"))||3==i&&e.IsInventoryVoucher)&&(e.IsLockDimsLineWise=!0),e.ScreenObject.Data.Tables.length>2&&e.ScreenObject.Data.Tables[2].length>0&&e.ScreenObject.Data.Tables[2].filter((function(e){return 3==e.DefType&&e.CostCenterID==i&&1==e.isgroupExists})).length>0&&(c=!0),e.LockDims.push(i,c),c?(n+=" left join "+e.ScreenObject.GetTableName(i)+" CC"+r+" with(nolock) on C."+a.GetPrimarkyKey(i,!0)+"=CC"+r+"."+a.GetPrimarkyKey(i)+"\n                            left join "+e.ScreenObject.GetTableName(i)+" CJ"+r+" with(nolock) on CJ"+r+".lft between CC"+r+".lft and CC"+r+".rgt",i>5e4?t+=" and (b.dcCCNID"+(i-5e4)+"=CJ"+r+".NodeID or c.CCNID"+(i-5e4)+"=0)":3==i&&e.IsInventoryVoucher?t+=" and (a.ProductID=CJ"+r+".ProductID or c.ProductID=0)":2==i&&(t+=" and (a.DebitAccount=CJ"+r+".AccountID or a.CreditAccount=CJ"+r+".AccountID or c.AccountID=0)")):i>5e4?t+=" and (b.dcCCNID"+(i-5e4)+"=c.CCNID"+(i-5e4)+" or c.CCNID"+(i-5e4)+"=0)":3==i&&e.IsInventoryVoucher?t+=" and (a.ProductID=c.ProductID or c.ProductID=0)":2==i?t+=" and (a.DebitAccount=c.AccountID or a.CreditAccount=c.AccountID or c.AccountID=0)":400==i&&(t+=" and (a.CostCenterID=c.DocumentID or c.DocumentID=1)")}})),this.ScreenObject.LockWhere=""!=n?'<XML where="'+t+'" join="'+n+'"></XML>':t}}},{key:"Save_Completed",value:function(){var e=this;this.SaveComplete(this.SaveCallReq.Validate),this.SaveCallBackMethod&&setTimeout((function(){e.SaveCallBackMethod.Call()}),20)}},{key:"ReSaveLinkedDocs",value:function(){for(var e=s.a.common.GetDataSet("DOC061",this.RetValue.toString()),t=null,n=function(n){null!=t&&t.CostCenterID==parseInt(e.Tables[0][n].Costcenterid.toString())||(t=new a(parseInt(e.Tables[0][n].Costcenterid.toString()),"",!0)),t.ScreenObject.DocID=parseInt(e.Tables[0][n].docid.toString());var i=t.ScreenObject.GetEditDataByDOCID();null!=i&&i.Tables.length>0&&i.Tables[0].length>0&&i.Columns[0].Contains("DocPrefix")&&(null!=t.ScreenObject.DocPrefix.ComboBox&&null!=t.ScreenObject.DocPrefix.ComboBox.Items&&null==t.ScreenObject.DocPrefix.ComboBox.Items.find((function(e){return e.Value==i.Tables[0][0].DocPrefix.toString()}))&&t.ScreenObject.DocPrefix.ComboBox.Items.push(m.d.ComboBoxItems_2(i.Tables[0][0].DocPrefix.toString(),i.Tables[0][0].DocPrefix.toString())),null!=t.ScreenObject.DocPrefix.TextBox&&(t.ScreenObject.DocPrefix.TextBox.Text=i.Tables[0][0].DocNumber.toString())),t.ScreenObject.LoadEditData(i,!1),o.e.IsEmpty(i.Tables[0][0].DocDate)||(t.DocumentDate=new Date(i.Tables[0][0].DocDate)),o.e.IsEmpty(i.Tables[0][0].VoucherNo)||(t.ScreenObject.VoucherNo=i.Tables[0][0].VoucherNo.toString()),o.e.IsEmpty(i.Tables[0][0].GUID)||(t.ScreenObject.guid=i.Tables[0][0].GUID.toString()),i.Columns[0].Contains("RefNodeid")&&!o.e.IsEmpty(i.Tables[0][0].RefNodeid)&&(t.ScreenObject.RefNodeID=parseInt(i.Tables[0][0].RefNodeid.toString())),i.Columns[0].Contains("RefCCId")&&!o.e.IsEmpty(i.Tables[0][0].RefCCId)&&(t.ScreenObject.RefCCId=parseInt(i.Tables[0][0].RefCCId.toString())),i.Tables.length>1&&i.Tables[1].length>0&&(s.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==s.a.SessionManager.Preferences.EnableLocationWise.toString()&&!o.e.IsEmpty(i.Tables[1][0].dcCCNID2)&&(t.ScreenObject.LocationID=parseInt(i.Tables[1][0].dcCCNID2.toString())),s.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==s.a.SessionManager.Preferences.EnableDivisionWise.toString()&&!o.e.IsEmpty(i.Tables[1][0].dcCCNID1)&&(t.ScreenObject.DivisionID=parseInt(i.Tables[1][0].dcCCNID1.toString())));for(var r=0;r<t.ScreenObject.GridData.length;r++)o.e.IsEmpty(t.ScreenObject.GridData[r].ProductID_Key)||t.CalculateTotals(t.ScreenObject.GridData[r],!0);t.RetValue=0,t.SaveInventoryDocument("NoWorkFlowReSave",!1,!1,null,!1,!1)},i=0;i<e.Tables[0].length;i++)n(i)}},{key:"SaveComplete",value:function(e){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,a,i,r,c,u,D,h,S,m,b,C,p,g,O,I,T,j,P,A,M,v,G,N,E=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.ButtonsEnabled=!0,!(this.RetValue>0||this.RetValue<-1e4)){t.next=24;break}if(s.a.SessionManager.IsActionAssigned(this.CostCenterID,"API")&&this.GenerateAPIRequest(9),this.ScreenObject.IsDirty=!1,this.IsExpressionAvailable("ServerDate")&&null!=(n=s.a.common.GetDataSet("DOC001",""))&&n.Tables.length>0&&!n.Columns[0].Contains("ErrorMessage")&&n.Tables[0].length>0&&null!=this.fldDict&&(this.fldDict.ServerDate.setFieldValue(n.Tables[0][0].dt.toString()),this.FooterDics.ServerDate.setFieldValue(n.Tables[0][0].dt.toString())),this.SetVisibiltiFalse(),this.IsPOs||this.SetDefaultRightPanel(),null!=this.ChequeBook&&(this.ChequeBook.Items.Clear(),this.ChequeBook.SelectedValue=""),this.ScheduleID>0&&(d.a.UpdateScheduleEvents(this.ScheduleID,this.ScreenObject.IsInventory,this.ScreenObject.DocID),this.objGeneralDashboard&&this.objGeneralDashboard.RefreshData(),this.ScheduleID=0,this.RecurDocumentVoucherNo=""),this.ScreenObject.Preferences.ContainsKey("ReSaveLinkDoc")&&"True"==this.ScreenObject.Preferences.ReSaveLinkDoc&&this.ReSaveLinkedDocs(),!(this.ScreenObject.Preferences.ContainsKey("Open Cash Drawer")&&"True"==this.ScreenObject.Preferences["Open Cash Drawer"]&&this.ScreenObject.Data.Tables.length>18&&this.ScreenObject.Data.Tables[18].length>0)){t.next=12;break}if(a=this.ScreenObject.Data.Tables[18][0],!(this.ScreenObject.RegisterNodeID>0)){t.next=11;break}if((i=this.ScreenObject.Data.Tables[18].filter((function(e){return e.NodeID==E.ScreenObject.RegisterNodeID}))).length>0&&!o.e.IsEmpty(i[0].CashDrawerName)&&!o.e.IsEmpty(i[0].CashDrawerCommand)){t.next=8;break}return t.abrupt("return");case 8:this.OpenCashDrawer(i[0].CashDrawerName.toString(),i[0].CashDrawerCommand.toString()),t.next=12;break;case 11:null!=a&&this.OpenCashDrawer(a.CashDrawerName.toString(),a.CashDrawerCommand.toString());case 12:if("Approve"!=this.SaveCallReq.sender&&"ApproveandPrint"!=this.SaveCallReq.sender||s.a.SessionManager.RefreshNotification(),e&&369==this.StatusID&&this.ScreenObject.Preferences.ContainsKey("PostVoucherDocument")&&""!=this.ScreenObject.Preferences.PostVoucherDocument&&o.e.IsNum(this.ScreenObject.Preferences.PostVoucherDocument)&&parseInt(this.ScreenObject.Preferences.PostVoucherDocument)>4e4){if(r=!0,this.ScreenObject.Preferences.ContainsKey("PostDocumentCondition")&&""!=this.ScreenObject.Preferences.PostDocumentCondition){r=!1;try{null!=(c=s.a.eval.EvaluateExpression(this.ScreenObject.Preferences.PostDocumentCondition,this.fldDict).toString())&&"1"==c.toString()&&(r=!0)}catch(w){}}if(r){for(u=0,D=0,1==this.ScreenObject.DocumentType||39==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||6==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||13==this.ScreenObject.DocumentType?null!=this.ScreenObject.CreditAccount&&this.ScreenObject.CreditAccount.SelectedValue>0&&(u=this.ScreenObject.CreditAccount.SelectedValue):11!=this.ScreenObject.DocumentType&&38!=this.ScreenObject.DocumentType&&5!=this.ScreenObject.DocumentType&&7!=this.ScreenObject.DocumentType&&9!=this.ScreenObject.DocumentType&&24!=this.ScreenObject.DocumentType&&33!=this.ScreenObject.DocumentType&&10!=this.ScreenObject.DocumentType&&8!=this.ScreenObject.DocumentType&&12!=this.ScreenObject.DocumentType||null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.SelectedValue>0&&(u=this.ScreenObject.DebitAccount.SelectedValue),h=1,S=1,m=!1,null==this.Currency||o.e.IsEmpty(this.Currency.Currency.SelectedValue)||(h=parseInt(this.Currency.Currency.SelectedValue)),null==this.Currency||o.e.IsEmpty(this.Currency.ExchangeRate.Text)||(S=parseFloat(this.Currency.ExchangeRate.Text)),b=0;b<this.BillWisedt.length;b++)if(!o.e.IsEmpty(this.BillWisedt[b].AccountID)&&!o.e.IsEmpty(this.BillWisedt[b].Amount)&&parseInt(this.BillWisedt[b].AccountID)==u&&(D=parseFloat(this.BillWisedt[b].Amount),o.e.IsEmpty(this.BillWisedt[b].CurrencyID)||(h=parseInt(this.BillWisedt[b].CurrencyID)),o.e.IsEmpty(this.BillWisedt[b].ExchangeRate)||(S=parseFloat(this.BillWisedt[b].ExchangeRate)),!o.e.IsEmpty(this.BillWisedt[b].XML))){for(m=!0,(C=new o.f).LoadXml("<BillWise> "+this.BillWisedt[b].XML.toString()+"</BillWise> "),p=C.SelectNodes("BillWise/Row"),g=0,O=0;O<p.length;O++)""!=p[O].attributes.AmountFC.value&&"0"==p[O].attributes.IsNewReference.value&&(g+=parseFloat(p[O].attributes.AmountFC.value.replace("-","")));D-=g}D>0&&u>0&&(I=new we.PostVoucherSaveViewModel(this,parseInt(this.ScreenObject.Preferences.PostVoucherDocument),D,u,h,S,m,!1),this.ScreenObject.Preferences.ContainsKey("DisplayBeforepost")&&""!=this.ScreenObject.Preferences.DisplayBeforepost&&Object(l.j)(this.ScreenObject.Preferences.DisplayBeforepost)?s.a.page.ShowDialog(I,Ee.PostVoucherSaveComponent):(I.OnButtonClick("OK"),this.DisplayMessage=this.DisplayMessage+"\n"+I.DisplayMessage))}}for(this.ScreenObject.GridDataColumns.Contains("NextStageID")&&this.OpenNextStage(),T=0;T<this.Shortcuts.length;T++)this.Shortcuts[T]instanceof f.a&&6==this.Shortcuts[T].Mode&&this.ScreenObject.GridData.length>0&&this.ValidateData_Column(this.Shortcuts[T],this.ScreenObject.GridData[0],!0)?this.ScreenObject.GetExternalFuncData(this.Shortcuts[T].Mode,this.Shortcuts[T].SPName,this.Shortcuts[T].IPParams,this.Shortcuts[T].OPParams,this.ScreenObject.GridData[0],!0):this.Shortcuts[T]instanceof y.c&&6==this.Shortcuts[T].Mode&&this.ScreenObject.GetExternalFuncData(this.Shortcuts[T].Mode,this.Shortcuts[T].ToolTipFooterTitle,this.Shortcuts[T].ToolTipFooterDescription,this.Shortcuts[T].ToolTipDescription,null,!0);if(o.e.IsEmpty(this.ScreenObject.ExternalFuncErrorMessage)||(this.DisplayMessage=this.DisplayMessage+"\r\n "+this.ScreenObject.ExternalFuncErrorMessage),null!=this.SaveCallBack&&this.SaveCallBack.Call({CostCenterID:this.ScreenObject.CostCenterID,DocID:this.ScreenObject.DocID}),"SaveAndPrint"!=this.commandprarameter&&"ApproveandPrint"!=this.commandprarameter&&"NoWorkFlowprint"!=this.commandprarameter){t.next=20;break}return t.next=18,this.PrintVoucher(!1,this.ScreenObject.DocID.toString(),!0,null);case 18:j=t.sent,this.DisplayMessage=this.DisplayMessage+"\r\n "+j;case 20:if(!this.IgnoreOnSave.ContainsKey("PostVoucherSave"))if(this.ScreenObject.Preferences.ContainsKey("onSaveNextVoucher")&&Object(l.j)(this.ScreenObject.Preferences.onSaveNextVoucher))P=this.DisplayMessage,this.GetData("NEXT"),this.DisplayMessage=P;else if(this.ScreenObject.Preferences.ContainsKey("ShowCurrentPostedVoucher")&&Object(l.j)(this.ScreenObject.Preferences.ShowCurrentPostedVoucher))A=this.DisplayMessage,M={value:this._Ddate},this.ScreenObject.OnDocPrefixChanged("lostFocus",1,0,M,!0),this.DocumentDate=M.value,this.QuickInfoVisibility=!1,this.DQuickInfoVisibility=!1,this.DisplayMessage=A;else{if(this.IsPOs&&0==this.PrevDocID){for(v=0,null!=this.ScreenObject.DocPrefix.ComboBox.SelectedItem&&""!=this.ScreenObject.DocPrefix.ComboBox.SelectedItem.Aliasname&&(v=parseInt(this.ScreenObject.DocPrefix.ComboBox.SelectedItem.Aliasname)),G=(parseInt(this.ScreenObject.DocPrefix.TextBox.Text)+1).toString();G.length<v;)G="0"+G;this.ScreenObject.DocPrefix.TextBox.Text=G}else N={value:this._Ddate},this.ScreenObject.OnDocPrefixChanged(this.ScreenObject.Prefix,0,0,N,!1),this._Ddate=N.value,null!=this.AutoPostViewModel&&(N={value:this.AutoPostViewModel._Ddate},this.AutoPostViewModel.ScreenObject.OnDocPrefixChanged(this.AutoPostViewModel.ScreenObject.Prefix,0,0,N,!1),this.AutoPostViewModel._Ddate=N.value);this.clear(2),("POSDocumentViewModel"==this.ClassName||s.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==s.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase())&&this.ScreenObject.FillListViews(!1)}this.PoleDisplayMessage(1,null),t.next=25;break;case 24:e&&"Problem in processing your request, Please contact administrator."==this.DisplayMessage&&confirm("Do you want to report issue?")&&s.a.page.ShowDialog(new it.SendEmailSMSViewModel(!0,-999,0,null),rt.SendEmailSMSComponent);case 25:this.commandprarameter="",this.IgnoreOnSave.Clear();case 26:case"end":return t.stop()}}),t,this)})))}},{key:"OpenNextStage",value:function(){for(var e=this,t=0,n=0;n<this.ScreenObject.GridData.length;n++)if(!o.e.IsEmpty(this.ScreenObject.GridData[n].NextStageID)){t++;break}if(t>0&&""!=this.ScreenObject.Preferences.Autopostdocument){for(var i=new a(parseInt(this.ScreenObject.Preferences.Autopostdocument),"",!0),r=[],c=function(t){if(!o.e.IsEmpty(e.ScreenObject.GridData[t].NextStageID)&&!r.Contains(e.ScreenObject.GridData[t].NextStageID)){var n=i.ScreenObject.Link.LinkCombo.Items.find((function(e){return!o.e.IsEmpty(e.Parent)&&"158"==e.Parent}));if(n){i.ScreenObject.Link.LinkCombo.SelectedValue=n.Value,i.OLinkSelectionChanged(n.Value);var a=e.ScreenObject.Link.DocumentList.Items.find((function(e){return e.IsChecked}));null!=(a=i.ScreenObject.Link.DocumentList.Items.find((function(e){return e.Value==a.Value})))&&function(){a.IsChecked=!0;for(var s=new W.a(i,a.Name,parseInt(n.Value),parseInt(a.Value),!1),c=s.ds.Tables[3].sort((function(e,t){return e.lft-t.lft})),l=function(n){if(c[n].StageNodeID.toString()==e.ScreenObject.GridData[t].NextStageID.toString()&&c.length>n+1){if(s.ds.Tables[0].filter((function(e){return e.BOMID==c[n+1].BOMID&&e.StageID==c[n+1].StageID})).length>0){(o.e.IsEmpty(s.Boms.SelectedValue)||s.Boms.SelectedValue!=c[n+1].BOMID.toString())&&(s.Boms.SelectedValue=c[n+1].BOMID.toString(),s.onBomChanged(s.Boms.SelectedValue)),s.Boms.SelectedItem=s.Boms.GetselectedItem(),(o.e.IsEmpty(s.Stages.SelectedValue)||s.Stages.SelectedValue!=c[n+1].StageID.toString())&&(s.Stages.SelectedValue=c[n+1].StageID.toString(),s.FillJobProducts()),s.Stages.SelectedItem=s.Stages.GetselectedItem();var a=s.GridData.filter((function(n){return n.ProductID_Key==e.ScreenObject.GridData[t].ProductID_Key}));a.length>0&&(r.push(e.ScreenObject.GridData[t].NextStageID.toString()),o.e.IsNum(a[0].ActualQty)&&o.e.IsNum(e.ScreenObject.GridData[t].Quantity)&&(s.RemQTY.Text=(parseFloat(e.ScreenObject.GridData[t].Quantity)/parseFloat(a[0].ActualQty)).ToString("N"+s.decimalpoints),s.CalcRemQty(),s.GridData.forEach((function(e){o.e.IsEmpty(e.Select)||(e.Select=!0)})),s.OnSave("Add"),s.OnSave("OKNoClose")))}return"break"}},u=0;u<c.length;u++){if("break"===l(u))break}}()}}},l=0;l<this.ScreenObject.GridData.length;l++)c(l);r.length>0&&(i.OKCancelVisibility=!0,s.a.page.ShowDialog(i,x.AddEditDocumentComponent))}}},{key:"SetFocusForHeader",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n instanceof C.b){if(n.IsTabStop&&n.Visible)return n.SetFocus=!0,!0}else if(n instanceof p.a){if(n.IsTabStop&&n.Visible)return n.Code.Visible?n.Code.SetFocus=!0:n.Name.SetFocus=!0,!0}else if(n instanceof S.d){if(n.IsTabStop&&n.Visible)return n.SetFocus=!0,!0}else if(n instanceof S.c){if(n.IsTabStop&&n.Visible)return n.SetFocus=!0,!0}else if(n instanceof g.a){if(n.IsTabStop&&n.Visible)return n.TextBox.SetFocus=!0,!0}else if(n instanceof h.d&&n.IsTabStop&&n.Visible)return n.SetFocus=!0,!0}return!1}},{key:"SetFocus",value:function(){if(38!=this.DocumentType&&39!=this.DocumentType||null==this.SKU||!this.SKU.Visible||!this.SKU.IsTabStop){if(!(this.SetFocusForHeader(this.ScreenObject.HeaderFields)||this.ScreenObject.CustomTab.Pages.length>0&&this.SetFocusForHeader(this.ScreenObject.CustomTab.Pages[0].Fields))){this.LineNo=1,this.SetFocusongrid=!0;var e=this.GetPrimaryColName();if(""!=e){var t=this.ScreenObject.ColumnSource.find((function(t){return!o.e.IsEmpty(t.ValueMember)&&t.IsVisible&&!t.DisableTab&&t.ValueMember.toLowerCase()==e.toLowerCase()}));t?this.ColumnNo=this.ScreenObject.ColumnSource.indexOf(t)+1:(t=this.ScreenObject.ColumnSource.find((function(e){return e.IsVisible&&!e.DisableTab})))&&(this.ColumnNo=this.ScreenObject.ColumnSource.indexOf(t)+1)}}}else this.SKU.SetFocus=!0}},{key:"ChequeReturn",value:function(e,t,n,a,i,r,o){var c=a;if(null!=t&&""!=n&&(c=parseFloat(t[n])),s.a.SessionManager.Preferences.ContainsKey("enableChequeReturnHistory")&&""!=s.a.SessionManager.Preferences.enableChequeReturnHistory&&Object(l.j)(s.a.SessionManager.Preferences.enableChequeReturnHistory)){var u=1,d=null;!this.IsInventoryVoucher&&this.SelectedRow&&(d=this.SelectedRow,u=parseInt(this.SelectedRow.DocSeqNo));var D=this.ScreenObject.GetChequeReturnDetails(e,i,this.ScreenObject.VoucherNo,u,d,this.DocumentDate);if(null!=D&&D.Tables.length>0&&!D.Columns[0].Contains("ErrorMessage")&&D.Tables[0].length>0){var h=new $(this,!this.IsInventoryVoucher&&this.SelectedRow?this.SelectedRow:null,this.ScreenObject.IsDocEdit?this.ScreenObject.VoucherNo:"",c,e,i,r,o,D);this.IgnoreOnSave.push("ChequeReturn",h),this.isChequeReturn=!0,s.a.page.ShowDialog(h,Z.a,{HideClose:!0})}}}},{key:"CheckDistCosts",value:function(e,t,n,a){var i,r,c,l=this;arguments.length>4&&void 0!==arguments[4]&&arguments[4];!(!o.e.IsEmpty(t.DocDetailsID)&&parseFloat(t.DocDetailsID.toString())>0||this.ScreenObject.GridDataColumns.Contains("IsDistributed")&&"1"==o.e.String(t.IsDistributed))&&s.a.SessionManager.Preferences.ContainsKey("DistributeCost")&&"True"==s.a.SessionManager.Preferences.DistributeCost&&s.a.SessionManager.Preferences.ContainsKey("CostBasedON")&&"True"==s.a.SessionManager.Preferences.CostBasedON&&s.a.SessionManager.Preferences.ContainsKey("CostBasedONDims")&&""!=s.a.SessionManager.Preferences.CostBasedONDims&&function(){i=s.a.SessionManager.Preferences.CostBasedONDims.split(",");for(var u="",d=!1,D=function(n){var a=i[n];parseInt(a)>5e4?l.ScreenObject.GridDataColumns.Contains("DCCCNID"+(parseInt(a)-5e4)+"_Key")?o.e.IsEmpty(t["DCCCNID"+(parseInt(a)-5e4)+"_Key"])||(u+=" and DCCCNID"+(parseInt(a)-5e4)+"="+t["DCCCNID"+(parseInt(a)-5e4)+"_Key"].toString()):(r=l.ScreenObject._CCFields.find((function(e){return e instanceof C.b&&e.CCID==parseInt(a)})))&&r.SelectedValue>0&&(u+=" and DCCCNID"+(parseInt(a)-5e4)+"="+r.SelectedValue.toString()):2==parseInt(a)?u+=" and AccountID in("+e+",0)":502==parseInt(a)&&(d=!0,u+=" and (db.AccountID is not null or Cr.AccountID is not null)")},h=0;h<i.length;h++)D(h);var S=l.ScreenObject.getProfileBasedon(e,0,d,u);if(null!=S&&S.Tables.length>0&&S.Columns[0].Contains("ProfileID")&&S.Tables[0].length>0){l.ScreenObject.GridDataColumns.Contains("IsDistributed")||l.ScreenObject.GridDataColumns.push("IsDistributed");var m=0,b=0,y=0;c=s.a.SessionManager.Preferences.DistributeCostDims.split(",");for(var p=function(e){if(e+1==S.Tables[0].length?b=parseFloat((n-y).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())):!o.e.IsEmpty(S.Tables[0][e].Percent)&&parseFloat(S.Tables[0][e].Percent.toString())>0?b=parseFloat((n*parseFloat(S.Tables[0][e].Percent.toString())/100).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())):!o.e.IsEmpty(S.Tables[0][e].Amount)&&parseFloat(S.Tables[0][e].Amount.toString())>0&&(b=parseFloat(S.Tables[0][e].Amount.toString())),s.a.SessionManager.Preferences.ContainsKey("ExclZerodist")&&"True"==s.a.SessionManager.Preferences.ExclZerodist&&0==b)return"continue";var i=void 0;if(1==++m)i=t;else{i=l.ScreenObject.GridDataObj.NewRow();for(var r=0;r<l.ScreenObject.GridDataColumns.length;r++)"docseqno"!=l.ScreenObject.GridDataColumns[r].toLowerCase()&&"docdetailsid"!=l.ScreenObject.GridDataColumns[r].toLowerCase()&&(i[r]=t[r]);l.ScreenObject.GridDataObj.insertRowAt(i,l.ScreenObject.GridData.indexOf(t)+1)}y+=b,i.IsDistributed=1,i[a]=b,c.forEach((function(t){parseInt(t)>5e4&&S.Columns[0].Contains("DCCCNID"+(parseInt(t)-5e4))&&""!=S.Tables[0][e]["DCCCNID"+(parseInt(t)-5e4)].toString()&&l.ScreenObject.GridDataColumns.Contains("DCCCNID"+(parseInt(t)-5e4)+"_Key")&&(i["DCCCNID"+(parseInt(t)-5e4)]=null,i["DCCCNID"+(parseInt(t)-5e4)+"_Key"]=S.Tables[0][e]["DCCCNID"+(parseInt(t)-5e4)].toString())})),l.CalculateTotals(i,!1)},g=0;g<S.Tables[0].length;g++)p(g);l.ScreenObject.UpdateSequence(),l.RefreshGrid=!0}}()}},{key:"CheckIsBillWise",value:function(e,t,n,a,i,r,c){var u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",D=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,h=0;"CreditAmount"!=n&&"DebitAmount"!=n&&"Amount"!=n&&""==d||o.e.IsEmpty(t[n])||(h=parseFloat(t[n]));var S="",m="";if(this.ScreenObject.Data.Tables[0].length>0){var b=this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&50403==e.LinkData}));b.length>0&&this.ScreenObject.GridDataColumns.Contains(b[0].SysColumnName)&&(S=b[0].SysColumnName,m=b[0].ResourceData.toString().Replace(" ",""))}for(var C=0;C<this.ScreenObject.ColumnSource.length;C++)!this.ScreenObject.ColumnSource[C].DisplayMember.toLowerCase().Contains("dcnum")||!this.ScreenObject.ColumnSource[C].IsColumnUserDefined||3!=this.ScreenObject.ColumnSource[C].PostingType&&4!=this.ScreenObject.ColumnSource[C].PostingType||!(i&&0==this.ScreenObject.ColumnSource[C].CreditAcount&&0==this.ScreenObject.ColumnSource[C].CrRefColID||!i&&0==this.ScreenObject.ColumnSource[C].DebitAccount&&0==this.ScreenObject.ColumnSource[C].DrRefColID)||o.e.IsEmpty(t["dcCalc"+this.ScreenObject.ColumnSource[C].DisplayMember])||S==this.ScreenObject.ColumnSource[C].DisplayMember||""!=m&&!o.e.IsEmpty(this.ScreenObject.ColumnSource[C].Formula)&&this.ScreenObject.ColumnSource[C].Formula.Contains(m)||(h+=parseFloat(t["dcCalc"+this.ScreenObject.ColumnSource[C].DisplayMember]));if(Logger.InfoLog("AddEditDocumentViewModel::Entering CheckIsBillWise"),s.a.SessionManager.Preferences.ContainsKey("On")&&"True"==s.a.SessionManager.Preferences.On&&e>0){if(0==a)h=0;else if(("CreditAmount"==n||"DebitAmount"==n||"Amount"==n)&&0==h)return;("CreditAmount"==n||"DebitAmount"==n||"Amount"==n)&&!this.IsInventoryVoucher&&h<0&&(i=!i,h*=-1),("CreditAmount"==n||"DebitAmount"==n)&&this.ScreenObject.Preferences.ContainsKey("Valueonbillwise")&&""!=this.ScreenObject.Preferences.Valueonbillwise&&Object(l.j)(this.ScreenObject.Preferences.Valueonbillwise)&&(i="CreditAmount"==n,h=0),this.DialogResult=!1;var y=new B;if(y.BillWiseViewModel_2(this,h,e,i,r,c,!0,d),this.DialogResult)this.CheckDistCosts(e,t,a,n,!1);else if(""!=u){var p=y.GridData.filter((function(e){return e.DocNo==u}));if(p.length>0&&!o.e.IsEmpty(p[0].Due)){p[0].AmountPaidLC=p[0].Due;var g=0,f=0;o.e.IsEmpty(p[0].CurrID)||parseInt(p[0].CurrID.toString())!=r||""==p[0].ExchgRate.toString()||parseFloat(p[0].ExchgRate.toString())==c?f=parseFloat(p[0].AmountPaidLC.toString())/c:(f=parseFloat(p[0].AmountPaidLC.toString())/parseFloat(p[0].ExchgRate.toString()),g=parseFloat(p[0].AmountPaid.toString())*(parseFloat(p[0].ExchgRate.toString())-c)),y.AmtToAdjust.Text=f.ToString("N"+y.decimalpoints),y.NewReference.Text="0",p[0].AmountPaid=f.ToString("N"+y.decimalpoints),this.ScreenObject.GridDataColumns.Contains("Amount")&&(t.Amount=f.ToString("N"+y.decimalpoints)),this.Celleditend(t,"DocSeqNo",0),p[0].exchgl=g,y.PaidChange("AmountPaid",p[0],!1),y.OnSave("autosave")}}else o.e.IsEmpty(t.ExtraXML)&&this.ScreenObject.Preferences.ContainsKey("Billwise Fifo")&&Object(l.j)(this.ScreenObject.Preferences["Billwise Fifo"])?(y.Fifo=!0,y.OnSave("autosave")):s.a.page.ShowDialog(y,R.a,{ShowCenter:!0},(function(){D()}))}Logger.InfoLog("AddEditDocumentViewModel::Exiting CheckIsBillWise")}},{key:"CheckAccountBalance",value:function(e,t,n){if(!this.IsInventoryVoucher||s.a.SessionManager.Preferences.ContainsKey("DontSaveCahsBankBalanceNegative")&&""!=s.a.SessionManager.Preferences.DontSaveCahsBankBalanceNegative&&Object(l.j)(s.a.SessionManager.Preferences.DontSaveCahsBankBalanceNegative)){var a=this.ScreenObject.GetAccBalance(e,this.DocumentDate);if(!this.IsInventoryVoucher&&null!=a&&a.Tables.length>0&&a.Tables[0].length>0&&a.Columns[0].Contains("IsBillwise")&&!o.e.IsEmpty(a.Tables[0][0].IsBillwise)&&Object(l.j)(a.Tables[0][0].IsBillwise)&&(14==this.ScreenObject.DocumentType||15==this.ScreenObject.DocumentType||20==this.ScreenObject.DocumentType||23==this.ScreenObject.DocumentType||18==this.ScreenObject.DocumentType||19==this.ScreenObject.DocumentType||21==this.ScreenObject.DocumentType||22==this.ScreenObject.DocumentType))return this.DisplayMessage=14==this.ScreenObject.DocumentType||15==this.ScreenObject.DocumentType||20==this.ScreenObject.DocumentType||23==this.ScreenObject.DocumentType?"Can not select billwise account in payment Mode":"Can not select billwise account in reciept Mode",!0;if((this.IsInventoryVoucher||s.a.SessionManager.Preferences.ContainsKey("DontSaveCahsBankBalanceNegative")&&""!=s.a.SessionManager.Preferences.DontSaveCahsBankBalanceNegative&&Object(l.j)(s.a.SessionManager.Preferences.DontSaveCahsBankBalanceNegative))&&null!=a&&a.Tables.length>0&&a.Tables[0].length>0&&a.Columns[0].Contains("BalDocDate")&&!o.e.IsEmpty(a.Tables[0][0].BalDocDate)){var i=parseFloat(a.Tables[0][0].BalDocDate);if(this.IsInventoryVoucher){if(n?i+=t:i-=t,i<0)return!0}else if(i=-i,n?i-=t:i+=t,(i=parseFloat(i.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount)))<0)return!(a.Columns[0].Contains("AccountTypeID")&&"1"!=a.Tables[0][0].AccountTypeID.toString()&&"2"!=a.Tables[0][0].AccountTypeID.toString()&&"10"!=a.Tables[0][0].AccountTypeID.toString()||s.a.SessionManager.IsActionAssigned(43,"OverrideNegativeBalance")&&confirm("Balance goes negative do you want to proceed?"))}}return!1}},{key:"CheckCreditLimit",value:function(e,t,n){if(0===t)return!0;if(Logger.InfoLog("AddEditDocumentViewModel::Entering CheckCreditLimit"),n&&(s.a.SessionManager.Preferences.ContainsKey("Warn if balance exceeds Credit Limit")&&"True"==s.a.SessionManager.Preferences["Warn if balance exceeds Credit Limit"]||s.a.SessionManager.Preferences.ContainsKey("Warncreditdays")&&"True"==s.a.SessionManager.Preferences.Warncreditdays)){var a=0;if(s.a.SessionManager.Preferences.ContainsKey("DimWiseCreditDebit")&&""!=s.a.SessionManager.Preferences.DimWiseCreditDebit&&parseInt(s.a.SessionManager.Preferences.DimWiseCreditDebit)>0){var i=this.ScreenObject._CCFields.find((function(e){return e.DBColumnName.toLowerCase()=="dcccnid"+(parseInt(s.a.SessionManager.Preferences.DimWiseCreditDebit)-5e4)}));i&&i instanceof C.b&&i.SelectedValue>0&&(a=i.SelectedValue)}var r=this.ScreenObject.CheckCreditLimit(e,t,this.DocumentDate,a);if(s.a.SessionManager.Preferences.ContainsKey("Warn if balance exceeds Credit Limit")&&"True"==s.a.SessionManager.Preferences["Warn if balance exceeds Credit Limit"]&&null!=r&&r.Tables.length>0&&r.Tables[0].length>0&&"1"==r.Tables[0][0][r.Columns[0][0]].toString()){if(!s.a.SessionManager.IsActionAssigned(43,"OverrideCreditLimit"))return this.DisplayMessage="Balance exceeds Credit limit",!1;if(this.res="",!confirm("Credit limit exceeds do you want to proceed ? "))return!1}if(s.a.SessionManager.Preferences.ContainsKey("Warncreditdays")&&"True"==s.a.SessionManager.Preferences.Warncreditdays&&null!=r&&r.Tables.length>1&&r.Tables[1].length>0){if(!s.a.SessionManager.IsActionAssigned(43,"OverrideCreditDays"))return this.DisplayMessage="Credit Days Exceeds for "+r.Tables[1][0][r.Columns[1][0]].toString(),!1;if(this.res="",!confirm("Credit Days Exceeds for"+r.Tables[1][0][r.Columns[1][0]].toString()+".Do you want to proceed ? "))return!1}}else if(!n&&(s.a.SessionManager.Preferences.ContainsKey("Warn if balance exceeds debit Limit")&&"True"==s.a.SessionManager.Preferences["Warn if balance exceeds debit Limit"]||s.a.SessionManager.Preferences.ContainsKey("Warndebitdays")&&"True"==s.a.SessionManager.Preferences.Warndebitdays)){var o=0;if(s.a.SessionManager.Preferences.ContainsKey("DimWiseCreditDebit")&&""!=s.a.SessionManager.Preferences.DimWiseCreditDebit&&parseInt(s.a.SessionManager.Preferences.DimWiseCreditDebit)>0){var c=this.ScreenObject._CCFields.find((function(e){return e.DBColumnName.toLowerCase()=="dcccnid"+(parseInt(s.a.SessionManager.Preferences.DimWiseCreditDebit)-5e4)}));c&&c instanceof C.b&&c.SelectedValue>0&&(o=c.SelectedValue)}var l=this.ScreenObject.CheckCreditLimit(e,t,this.DocumentDate,o);if(s.a.SessionManager.Preferences.ContainsKey("Warn if balance exceeds debit Limit")&&"True"==s.a.SessionManager.Preferences["Warn if balance exceeds debit Limit"]&&null!=l&&l.Tables.length>0&&l.Tables[0].length>0&&"1"==l.Tables[0][0][l.Columns[0][0]].toString()){if(!s.a.SessionManager.IsActionAssigned(43,"OverrideCreditLimit"))return this.DisplayMessage="Balance exceeds Credit limit",!1;if(this.res="",!confirm("Credit limit exceeds do you want to proceed ? "))return!1}if(s.a.SessionManager.Preferences.ContainsKey("Warndebitdays")&&"True"==s.a.SessionManager.Preferences.Warndebitdays&&null!=l&&l.Tables.length>1&&l.Tables[1].length>0){if(!s.a.SessionManager.IsActionAssigned(43,"OverrideCreditDays"))return this.DisplayMessage="Credit Days Exceeds for "+l.Tables[1][0][l.Columns[1][0]].toString(),!1;if(this.res="",!confirm("Credit Days Exceeds for"+l.Tables[1][0][l.Columns[1][0]].toString()+".Do you want to proceed ? "))return!1}}return!0}},{key:"LoadDOcument",value:function(){var e=this,t=0,n=0;s.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==s.a.SessionManager.Preferences.EnableDivisionWise.toString()&&(this.ScreenObject.DivisionID>0?n=this.ScreenObject.DivisionID:s.a.SessionManager.DivisionID>0&&(n=s.a.SessionManager.DivisionID)),s.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==s.a.SessionManager.Preferences.EnableLocationWise.toString()&&(this.ScreenObject.LocationID>0?t=this.ScreenObject.LocationID:s.a.SessionManager.LocationID>0&&(t=s.a.SessionManager.LocationID));var a=0;s.a.SessionManager.IsActionAssigned(43,"Dimension wise Documents")&&(s.a.SessionManager.Preferences.ContainsKey("DimensionwiseDocuments")&&o.e.IsNum(s.a.SessionManager.Preferences.DimensionwiseDocuments)&&(a=parseInt(s.a.SessionManager.Preferences.DimensionwiseDocuments)),a>5e4)&&0==this.ScreenObject.Data.Tables[0].filter((function(e){return e.ColumnCostCenterID==a})).length&&(a=0);var i=new bt;i.PreviousTextDialog_1(this.CostCenterID,this.IsInventoryVoucher,t,n,a,this.ScreenObject.Data.Tables[3][0].DocumentAbbr.toString()),s.a.page.ShowDialog(i,Ct.a,{ShowCenter:!0,NoWidth:!0}).subscribe((function(){if(o.e.IsValidID(i.DocID)){var t={value:e._Ddate};e.ScreenObject.OnDocPrefixChanged("lostFocus",0,i.DocID,t,!0),e._Ddate=t.value}}))}},{key:"GetData",value:function(e){if(Logger.InfoLog("AddEditDocumentViewModel::Entering GetData"),this.ConfirmDirtyRead()&&("Next"!=e.toString()||!(s.a.SessionManager.Preferences.ContainsKey("ConfirmonNext")&&"TRUE"==s.a.SessionManager.Preferences.ConfirmonNext.toUpperCase()||this.ScreenObject.Preferences.ContainsKey("ConfirmonNext")&&"TRUE"==this.ScreenObject.Preferences.ConfirmonNext.toUpperCase())||confirm("Do you want Next Document?"))&&("Previous"!=e.toString()||!(s.a.SessionManager.Preferences.ContainsKey("ConfirmonPrevious")&&"TRUE"==s.a.SessionManager.Preferences.ConfirmonPrevious.toUpperCase()||this.ScreenObject.Preferences.ContainsKey("ConfirmonPrevious")&&"TRUE"==this.ScreenObject.Preferences.ConfirmonPrevious.toUpperCase())||confirm("Do you want Previous Document?"))){if(this.MessageVisibility=!1,this.ReportDimension.SelectedValue=0,72==this.ScreenObject.DocumentType&&(this.isVacContractedit=!0,this.dtVacContract=null,this.ShowVacationCreditDaysDetail(0)),""!=this.ScreenObject.DocPrefix.TextBox.Text)try{var t=0;if(null!=this.ScreenObject.DocPrefix.ComboBox.SelectedItem&&""!=this.ScreenObject.DocPrefix.ComboBox.SelectedItem.Aliasname&&(t=parseInt(this.ScreenObject.DocPrefix.ComboBox.SelectedItem.Aliasname)),"LoadDocument"==e.toString())this.LoadDOcument();else if("NEXT"==e.toString().toUpperCase()){for(var n=(parseInt(this.ScreenObject.DocPrefix.TextBox.Text)+1).toString();n.length<t;)n="0"+n;this.ScreenObject.DocPrefix.TextBox.Text=n;var a={value:this._Ddate};this.ScreenObject.OnDocPrefixChanged("lostFocus",2,0,a,!0),this._Ddate=a.value,this.QuickInfoVisibility=!1,this.DQuickInfoVisibility=!1}else if(parseInt(this.ScreenObject.DocPrefix.TextBox.Text)>1){for(var i=(parseInt(this.ScreenObject.DocPrefix.TextBox.Text)-1).toString();i.length<t;)i="0"+i;this.ScreenObject.DocPrefix.TextBox.Text=i;var r={value:this._Ddate};this.ScreenObject.OnDocPrefixChanged("lostFocus",1,0,r,!0),this._Ddate=r.value,this.QuickInfoVisibility=!1,this.DQuickInfoVisibility=!1}if(72==this.ScreenObject.DocumentType){var c=0,u=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));(u&&u instanceof C.b&&u.SelectedValue>0||u&&u instanceof p.a&&u.SelectedValue>0)&&(c=u.SelectedValue),this.ShowVacationCreditDaysDetail(c),this.isVacContractedit=!1}this.ScreenObject.IsDocEdit||this.clear(4)}catch(d){this.DisplayMessage="Error Loading document try again",Logger.ErrorLog("Addeditdocumentviewmodel","OnDocPrefixChanged",d)}this.ScreenObject.Preferences.ContainsKey("HideBody")&&!o.e.IsEmpty(this.ScreenObject.Preferences.HideBody)&&Object(l.j)(this.ScreenObject.Preferences.HideBody.toString())&&(this.BodyVisible=!1),Logger.InfoLog("AddEditDocumentViewModel::Exiting GetData")}}},{key:"SortGrid",value:function(e){var t=this,n=[];if(!e)for(var a=0;a<this.DtImport.length;a++)if(!o.e.IsEmpty(this.DtImport[a].FieldName)){var i={name:this.DtImport[a].FieldName,desc:!1};"Desc"!=o.e.String(this.DtImport[a].Order)&&"numdesc"!=o.e.String(this.DtImport[a].Order).toLowerCase()||(i.desc=!0),n.push(i)}if(e){if(!this.IsInventoryVoucher)return;if(this.ScreenObject.Preferences.ContainsKey("Sortbasedon")&&!o.e.IsEmpty(this.ScreenObject.Preferences.Sortbasedon)){var r=this.ScreenObject.ColumnSource.find((function(e){return e.ID==t.ScreenObject.Preferences.Sortbasedon}));r&&!o.e.IsEmpty(r.ValueBinding)&&this.ScreenObject.GridDataColumns.Contains(r.ValueBinding)?n.push({name:r.ValueBinding,desc:!0}):r&&!o.e.IsEmpty(r.DisplayMember)&&this.ScreenObject.GridDataColumns.Contains(r.DisplayMember)&&n.push({name:r.DisplayMember,desc:!0})}else n.push({name:"ProductID_Key",desc:!0})}else{if(!(n.length>0))return;var s="";this.IsInventoryVoucher?s="ProductID_key":this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")?s="CreditAccount_Key":this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")?s="DebitAccount_Key":this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&(s="AccountID_Key"),s.length>0&&(n.InsertAt("EmptySort",0),this.ScreenObject.GridData.map((function(e){return e.EmptySort=Object(j.isNullOrUndefined)(e[s])?1:0})))}console.log(n),this.ScreenObject.GridData.SortBy(n);for(var c=0;c<this.ScreenObject.GridData.length;c++)this.ScreenObject.GridData[c].DocSeqNo=c+1;this.ScreenObject.GridDataObj.refreshDataView()}},{key:"LoadLinkData",value:function(e,t,n,a,i){var r=this,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if(1!=e.Tables.length||!e.Columns[0].Contains("ErrorMessage")){var d,D=null;try{var h,m;!function(){var b=new Date;r.ScreenObject.AttachDetach(!1),r.ScreenObject.Preferences.ContainsKey("SameserialNo")&&""!=r.ScreenObject.Preferences.SameserialNo&&Object(l.j)(r.ScreenObject.Preferences.SameserialNo)&&null==i&&e.Tables[0].length>0&&(r.ScreenObject.DocPrefix.TextBox.Text=e.Tables[0][0].DocNumber.toString()),null==i&&(h=e.Tables[4].filter((function(e){return"DocDate"==e.BASECOL}))).length>0&&e.Tables[0].length>0&&(""!=h[0].LINKCOL.toString()&&e.Columns[0].Contains(h[0].LINKCOL.toString())&&o.e.isValidDate(e.Tables[0][0][h[0].LINKCOL.toString()])?(b=new Date(e.Tables[0][0][h[0].LINKCOL]),r.DocumentDate=o.e.diffparseDate(b.ToString(s.a.SessionManager.Preferences["Date Format"]+" hh:mm a"))):""!=h[0].LINKCOL.toString()&&e.Columns[3].Contains(h[0].LINKCOL.toString())&&o.e.isValidDate(e.Tables[3][0][h[0].LINKCOL.toString()])&&(b=new Date(e.Tables[3][0][h[0].LINKCOL]),r.DocumentDate=o.e.diffparseDate(b.ToString(s.a.SessionManager.Preferences["Date Format"]+" hh:mm a")))),r.ScreenObject.LoadLinkFieldsData_3(e,i,t);var g=new c.c;null==i&&r.ScreenObject.Preferences.ContainsKey("DimensionWise")&&""!=r.ScreenObject.Preferences.DimensionWise&&r.ScreenObject.Preferences.DimensionWise.split(",").forEach((function(e){if(""!=e){var t=parseInt(e);if(3==t)for(var n=0;n<r.ScreenObject._TextFields.length;n++){var a=r.ScreenObject._TextFields[n];if(a instanceof C.b&&a.CCID==t){a.SelectedValue>0&&g.push(t,a.SelectedValue);break}}else if(t>5e4)for(var i=0;i<r.ScreenObject._CCFields.length;i++){var s=r.ScreenObject._CCFields[i];if(s instanceof C.b&&s.CCID==t){s.SelectedValue>0&&g.push(t,s.SelectedValue);break}}}}));var O=0,I="",T=!1;r.ScreenObject.Preferences.ContainsKey("EnableSchemes")&&Object(l.j)(r.ScreenObject.Preferences.EnableSchemes)&&(T=Object(l.j)(r.ScreenObject.Preferences.EnableSchemes));var P,A=null;r.IsInventoryVoucher&&r.ScreenObject.Preferences.ContainsKey("CopyProductdata")&&""!=r.ScreenObject.Preferences.CopyProductdata&&Object(l.j)(r.ScreenObject.Preferences.CopyProductdata)&&(A=new c.a);var M=null;e.Columns[0].Contains("sno")&&(M=e.Tables[0].sort((function(e,t){return e.sno-t.sno})));for(var v=function(c){if(r.ScreenObject.Preferences.ContainsKey("LinkOnlyFreeQTY")&&Object(l.j)(r.ScreenObject.Preferences.LinkOnlyFreeQTY)&&e.Columns[0].Contains("IsQtyFreeOffer")&&o.e.Int(e.Tables[0][P].IsQtyFreeOffer)>0&&!(e.Columns[0].Contains("ParentSchemeID")&&o.e.Int(e.Tables[0][P].ParentSchemeID)>0))return G=c,"continue";var h=null;if(t&&t.length>0){for(var b=!1,y=0;y<t.length;y++)if(parseInt(t[y].InvDocDetailsID)==parseInt(e.Tables[0][P].DocDetailsID)){h=t[y],b=!0;break}if(!b)return G=c,"continue"}if(e.Columns[0].Contains("DynamicInvDocDetailsID")&&!o.e.IsEmpty(e.Tables[0][P].DynamicInvDocDetailsID)&&o.e.IsValidID(parseInt(e.Tables[0][P].DynamicInvDocDetailsID)))return G=c,"continue";for(var M=0;M<g.keys.length;M++){var v={Key:g.keys[M],Value:g.values[M]};if(3==v.Key){if(e.Columns[0].Contains("ProductColName")&&!o.e.IsEmpty(e.Tables[0][P].ProductColName)&&e.Columns[3].Contains(e.Tables[0][P].ProductColName.toString())&&!o.e.IsEmpty(e.Tables[3][P][e.Tables[0][P].ProductColName.toString()])&&o.e.IsNum(e.Tables[3][P][e.Tables[0][P].ProductColName.toString()])&&parseInt(e.Tables[3][P][e.Tables[0][P].ProductColName.toString()])!=v.Value)continue}else if(v.Key>5e4&&e.Columns[1].Contains("dcCCNID"+(v.Key-5e4).toString())&&!o.e.IsEmpty(e.Tables[1][P]["dcCCNID"+(v.Key-5e4).toString()])&&parseInt(e.Tables[1][P]["dcCCNID"+(v.Key-5e4).toString()])!=v.Value)continue}if(r.ScreenObject.Preferences.ContainsKey("ClubSameProds")&&""!=r.ScreenObject.Preferences.ClubSameProds&&Object(l.j)(r.ScreenObject.Preferences.ClubSameProds)&&!o.e.IsEmpty(e.Tables[0][P].ProductID)){var N=r.ScreenObject.GridData.filter((function(t){return t.ProductID_key==e.Tables[0][P].ProductID}));if(N.length>0)return o.e.IsEmpty(N[0].Quantity)||(N[0].defaultQuantity=N[0].Quantity=parseFloat(N[0].Quantity)+parseFloat(e.Tables[0][P].Quantity)),o.e.IsEmpty(N[0].UOMConversion)||o.e.IsEmpty(N[0].Quantity)?o.e.IsEmpty(N[0].Quantity)||(N[0].UOMConvertedQty=N[0].Quantity):N[0].UOMConvertedQty=parseFloat(N[0].Quantity)*parseFloat(N[0].UOMConversion),r.CalculateTotals(N[0],!1,"",!1),G=c,"continue"}var E=null;d=r.ScreenObject.GridDataObj.NewRow(),r.FillDefaultValues(d);for(var w=0,F=0;w<r.ScreenObject.ColumnSource.length;w++,F++)"DocDetailsID"!=r.ScreenObject.ColumnSource[w].DisplayMember&&"RefNo"!=r.ScreenObject.ColumnSource[w].DisplayMember&&"LinkedFieldName"!=r.ScreenObject.ColumnSource[w].DisplayMember&&("LINK"==r.ScreenObject.ColumnSource[w].DataType&&r.ScreenObject.ColumnSource[w].DisplayMember.toLowerCase().Contains("dcalpha")&&(d[r.ScreenObject.ColumnSource[w].DisplayMember]="..."),r.ScreenObject.SetLinkValues(e,r.ScreenObject.ColumnSource[w],P,d,i,""));if(null==i&&r.ScreenObject.Preferences.ContainsKey("GrouptoFilterfield")&&"true"==r.ScreenObject.Preferences.GrouptoFilterfield.toLowerCase()&&r.ScreenObject.Preferences.ContainsKey("ProductFilterField")&&""!=r.ScreenObject.Preferences.ProductFilterField&&e.Columns[0].Contains("IsGroup")&&e.Columns[0].Contains("ParentID")){var V=r.ScreenObject.ColumnSource.find((function(e){return e.ID==r.ScreenObject.Preferences.ProductFilterField}));V&&"LISTBOX"==V.DataType&&r.ScreenObject.GridDataColumns.Contains(V.ValueMember)&&(Object(l.j)(e.Tables[0][P].IsGroup)?(d.ProductID_Key=null,r.ScreenObject.GridDataColumns.Contains("ProductCode")&&(d.ProductCode=null),r.ScreenObject.GridDataColumns.Contains("ProductName")&&(d.ProductName=null),d[V.ValueMember]=e.Tables[0][P].ProductID.toString()):d[V.ValueMember]=e.Tables[0][P].ParentID.toString())}if(r.IsInventoryVoucher&&null==i&&e.Tables.length>15&&e.Tables[15].length>0){var L=e.Tables[15].filter((function(t){return t.DocDetailsID==e.Tables[0][P].DocDetailsID}));if(L.length>1&&r.ScreenObject.Preferences.ContainsKey("PopulateMultiple")&&Object(l.j)(r.ScreenObject.Preferences.PopulateMultiple)){r.ScreenObject.GridDataColumns.Contains("Row_Background")||r.ScreenObject.GridDataColumns.push("Row_Background"),E=[];for(var R=0;R<L.length;R++)if(0==R)d.ProductID_Key=L[R].ProductID,r.ScreenObject.GridDataColumns.Contains("ProductCode")&&(d.ProductCode=L[R].ProductCode),r.ScreenObject.GridDataColumns.Contains("ProductName")&&(d.ProductName=L[R].ProductName),d.Row_Background="#c8D7D0";else{var B=r.ScreenObject.GridDataObj.NewRow();B.ProductID_Key=L[R].ProductID,r.ScreenObject.GridDataColumns.Contains("ProductCode")&&(B.ProductCode=L[R].ProductCode),r.ScreenObject.GridDataColumns.Contains("ProductName")&&(B.ProductName=L[R].ProductName),B.Row_Background="#c8D7D0",E.push(B)}}else L.length>0?(d.ProductID_Key=L[0].ProductID,r.ScreenObject.GridDataColumns.Contains("ProductCode")&&(d.ProductCode=L[0].ProductCode),r.ScreenObject.GridDataColumns.Contains("ProductName")&&(d.ProductName=L[0].ProductName),L.length>1&&(r.ScreenObject.GridDataColumns.Contains("Row_Background")||r.ScreenObject.GridDataColumns.push("Row_Background"),d.Row_Background="#c8D7D0")):(r.ScreenObject.GridDataColumns.Contains("Row_Background")||r.ScreenObject.GridDataColumns.push("Row_Background"),d.Row_Background="#c9c9c9",d.ProductID_Key=e.Tables[0][P].ProductID,r.ScreenObject.GridDataColumns.Contains("ProductCode")&&(d.ProductCode=e.Tables[0][P].ProductCode),r.ScreenObject.GridDataColumns.Contains("ProductName")&&(d.ProductName=e.Tables[0][P].ProductName))}if(a.length>0&&null!=h)for(var x=function(e){var t=a[e];if(r.ScreenObject.GridDataColumns.Contains(t)){var n=r.ScreenObject.ColumnSource.find((function(e){return"Name"!=e.DisplayMember&&e.DisplayMember==t}));n||(n=r.ScreenObject.ColumnSource.find((function(e){return"Name"==e.DisplayMember&&e.ValueBinding==t}))),n&&(n.CostCenterID>0&&!Object(j.isUndefined)(h[n.ValueMember])&&!o.e.IsEmpty(h[n.ValueMember])?d[n.ValueMember]=h[n.ValueMember]:"DATE"!=n.DataType&&"DateTime"!=n.DataType&&"time"!=n.DataType.toLowerCase()||Object(j.isUndefined)(h[n.DisplayMember+"_Key"])||o.e.IsEmpty(h[n.DisplayMember+"_Key"])?"Name"!=n.DisplayMember||Object(j.isUndefined)(h[n.ValueBinding])||o.e.IsEmpty(h[n.ValueBinding])?o.e.IsEmpty(h[n.DisplayMember])||(d[n.DisplayMember]=h[n.DisplayMember].toString()):d[n.ValueBinding]=h[n.ValueBinding].toString():o.e.isValidDate(h[n.DisplayMember+"_Key"])&&("DateTime"==n.DataType?(d[n.DisplayMember]=new Date(h[n.DisplayMember]).ToString(s.a.SessionManager.Preferences["Date Format"]+" hh:mm a"),d[n.DisplayMember+"_Key"]=new Date(h[n.DisplayMember+"_Key"])):"time"==n.DataType?(d[n.DisplayMember]=new Date(h[n.DisplayMember]).ToString("hh:mm:ss tt"),d[n.DisplayMember+"_Key"]=new Date(h[n.DisplayMember+"_Key"])):(d[n.DisplayMember]=h[n.DisplayMember].toString(),d[n.DisplayMember+"_Key"]=new Date(h[n.DisplayMember+"_Key"]))))}else{var i=r.ScreenObject._TextFields.find((function(e){return e.DBColumnName==t}));null==i&&(i=r.ScreenObject._CCFields.find((function(e){return e.DBColumnName==t}))),null==i&&(i=r.ScreenObject._StaticFields.find((function(e){return e.DBColumnName==t}))),i&&(i instanceof S.c||i instanceof S.a?Object(j.isUndefined)(h[t+"_Key"])||r.ScreenObject.fillcontrolValue(i,h[t+"_Key"]):i instanceof C.b||i instanceof p.a?(o.e.IsEmpty(h[t+"_Key"])||r.ScreenObject.fillcontrolValue(i,h[t+"_Key"].toString()),r.ScreenObject.GetLinkReferenceData(i.DBColumnID,r.CostCenterID,i.SelectedValue,r.DocumentDate,i.DBColumnName,i.CCID,null)):o.e.IsEmpty(h[t])||r.ScreenObject.fillcontrolValue(i,h[t].toString()))}},k=0;k<a.length;k++)x(k);if(r.IsInventoryVoucher){null==i&&!r.ScreenObject.RWFieldsExists.Contains("QOH")&&(r.ScreenObject.Preferences.ContainsKey("CheckStock")&&""!=r.ScreenObject.Preferences.CheckStock.toString()&&Object(l.j)(r.ScreenObject.Preferences.CheckStock)||r.ScreenObject.Preferences.ContainsKey("CheckFifoQOH")&&""!=r.ScreenObject.Preferences.CheckFifoQOH.toString()&&Object(l.j)(r.ScreenObject.Preferences.CheckFifoQOH)||r.ScreenObject.Preferences.ContainsKey("LinkPartial")&&""!=r.ScreenObject.Preferences.LinkPartial.toString()&&Object(l.j)(r.ScreenObject.Preferences.LinkPartial))&&r.ScreenObject.RWFieldsExists.push("QOH");var _=null;if(_=null!=A&&A.ContainsKey(parseInt(d.ProductID_Key.toString()))?r.GetProductValues(d,0,!0,null,!1,A[parseInt(d.ProductID_Key.toString())]):r.GetProductValues(d,0,!0),null==A||A.ContainsKey(parseInt(d.ProductID_Key.toString()))||A.push(parseInt(d.ProductID_Key.toString()),_),null!=_&&_.Tables.length>0&&_.Tables[0].length>0&&!_.Columns[0].Contains("ErrorMessage")&&_.Columns[0].Contains("ProductTypeID")&&"8"!=e.Tables[0][P].ProductTypeID.toString()){if(e.Columns[0].Contains("FileGUID")&&(d.FileGUID=_.Tables[0][0].FileGUID.toString(),d.FileExtension=_.Tables[0][0].FileExtension.toString()),parseInt(d.ProductID_Key)!=r.ScreenObject.TempProductID){var K=0;if(d.QOH=_.Columns[0].Contains("QOH")&&!o.e.IsEmpty(_.Tables[0][0].QOH)?_.Tables[0][0].QOH.toString():0,o.e.IsEmpty(d.QOH)||(K=parseFloat(d.QOH)),null==i&&r.ScreenObject.Preferences.ContainsKey("CheckFifoQOH")&&""!=r.ScreenObject.Preferences.CheckFifoQOH.toString()&&Object(l.j)(r.ScreenObject.Preferences.CheckFifoQOH)&&e.Columns[0].Contains("Fifo")&&!o.e.IsEmpty(e.Tables[0][P].Fifo)&&(K-=parseFloat(e.Tables[0][P].Fifo)),null==i&&r.ScreenObject.Preferences.ContainsKey("CheckStock")&&""!=r.ScreenObject.Preferences.CheckStock.toString()&&Object(l.j)(r.ScreenObject.Preferences.CheckStock)&&!o.e.IsEmpty(e.Tables[0][P][e.Columns[0][0]])&&parseFloat(e.Tables[0][P][e.Columns[0][0]])>K)return G=c,"continue";if(null==i&&r.ScreenObject.Preferences.ContainsKey("LinkPartial")&&""!=r.ScreenObject.Preferences.LinkPartial.toString()&&Object(l.j)(r.ScreenObject.Preferences.LinkPartial)){if(!o.e.IsEmpty(e.Tables[0][P][e.Columns[0][0]])&&K<=0)return G=c,"continue";!o.e.IsEmpty(e.Tables[0][P][e.Columns[0][0]])&&K<parseFloat(e.Tables[0][P][e.Columns[0][0]])&&(e.Tables[0][P][e.Columns[0][0]]=K)}d.BalQOH=_.Columns[0].Contains("BalQOH")&&!o.e.IsEmpty(_.Tables[0][0].BalQOH)?_.Tables[0][0].BalQOH.toString():0,d.HOLDQTY=_.Columns[0].Contains("HOLDQTY")&&!o.e.IsEmpty(_.Tables[0][0].HOLDQTY)?_.Tables[0][0].HOLDQTY.toString():0,d.CommittedQty=_.Columns[0].Contains("CommittedQty")&&!o.e.IsEmpty(_.Tables[0][0].CommittedQty)?_.Tables[0][0].CommittedQty.toString():0,d.RESERVEQTY=_.Columns[0].Contains("RESERVEQTY")&&!o.e.IsEmpty(_.Tables[0][0].RESERVEQTY)?_.Tables[0][0].RESERVEQTY.toString():0,d.TotalReserve=_.Columns[0].Contains("TotalReserve")&&!o.e.IsEmpty(_.Tables[0][0].TotalReserve)?_.Tables[0][0].TotalReserve.toString():0}if(_.Tables.length>0&&_.Tables[0].length>0&&!_.Columns[0].Contains("ErrorMessage")&&!o.e.IsEmpty(_.Tables[0][0].DrAccount)&&parseInt(_.Tables[0][0].DrAccount)>0)if(r.ScreenObject.GridDataColumns.Contains("DebitAccount_Key"))if(d.DebitAccount_Key=_.Tables[0][0].DrAccount.toString(),r.ScreenObject.GridDataColumns.Contains("DebitAccount"))d.DebitAccount=_.Tables[0][0].DrName.toString();else{var Q=r.ScreenObject.ColumnSource.find((function(e){return null!=e.ValueMember&&"debitaccount_key"==e.ValueMember.toLowerCase()}));Q&&(d[Q.DisplayMember]=_.Tables[0][0].DrName.toString())}else null!=r.ScreenObject.DebitAccount&&(r.ScreenObject.DebitAccount.SelectedValue=parseInt(_.Tables[0][0].DrAccount),s.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==s.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(r.ScreenObject.DebitAccount.Name.SelectedValueText=_.Tables[0][0].DrName.toString()));if(_.Tables.length>0&&_.Tables[0].length>0&&!_.Columns[0].Contains("ErrorMessage")&&!o.e.IsEmpty(_.Tables[0][0].CrAccount)&&parseInt(_.Tables[0][0].CrAccount)>0)if(r.ScreenObject.GridDataColumns.Contains("CreditAccount_Key"))if(d.CreditAccount_Key=_.Tables[0][0].CrAccount.toString(),r.ScreenObject.GridDataColumns.Contains("CreditAccount"))d.CreditAccount=_.Tables[0][0].CrName.toString();else{var H=r.ScreenObject.ColumnSource.find((function(e){return null!=e.ValueMember&&"creditaccount_key"==e.ValueMember.toLowerCase()}));H&&(d[H.DisplayMember]=_.Tables[0][0].CrName.toString())}else null!=r.ScreenObject.CreditAccount&&(r.ScreenObject.CreditAccount.SelectedValue=parseInt(_.Tables[0][0].CrAccount),s.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==s.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(r.ScreenObject.CreditAccount.Name.SelectedValueText=_.Tables[0][0].CrName.toString()));d.LASTPURCHASERATE=_.Columns[0].Contains("LastPurchaseRate")&&!o.e.IsEmpty(_.Tables[0][0].LastPurchaseRate)?_.Tables[0][0].LastPurchaseRate.toString():0,d.Subexists=_.Tables.length>8&&_.Tables[8].length>1&&!_.Columns[8].Contains("ErrorMessage")&&r.ScreenObject.Preferences.ContainsKey("EnableSubtitutes")&&""!=r.ScreenObject.Preferences.EnableSubtitutes.toString()&&Object(l.j)(r.ScreenObject.Preferences.EnableSubtitutes)?"1":"0";var W=null;_.Tables.length>3&&_.Tables[3].length>0&&(W=_.Tables[3][0]);var U,X=null;if(U=null!=i?i:e.Tables[4],X=U.filter((function(e){return"Rate"==e.BASECOL})),0==(X=null==i&&e.Columns[4].Contains("CostCenterIDLinked")&&e.Columns[0].Contains("CostCenterID")&&e.Tables[0].length>0?U.filter((function(t){return"Rate"==t.BASECOL&&t.CostCenterIDLinked==e.Tables[0][0].CostCenterID})):U.filter((function(e){return"Rate"==e.BASECOL}))).length){var q=r.ScreenObject.ColumnSource.find((function(e){return"Rate"==e.DisplayMember})),Y="";if(null!=W)o.e.IsEmpty(q.Formula)||Object(j.isUndefined)(W[Y])||(Y=q.Formula),""==(Y=1==r.ScreenObject.DocumentType||25==r.ScreenObject.DocumentType||2==r.ScreenObject.DocumentType||3==r.ScreenObject.DocumentType||4==r.ScreenObject.DocumentType||10==r.ScreenObject.DocumentType||26==r.ScreenObject.DocumentType||27==r.ScreenObject.DocumentType||34==r.ScreenObject.DocumentType||31==r.ScreenObject.DocumentType?"PurchaseRate":"SellingRate")||o.e.IsEmpty(W[Y])||(d.Rate=W[Y].toString(),d.defaultRate=W[Y].toString());else if(_.Tables.length>0&&_.Tables[0].length>0&&_.Columns[0].Contains("ProdBaseUOM")&&_.Tables[0][0].ProdBaseUOM.toString()!=_.Tables[0][0].uomid.toString()){var z=r.ScreenObject.GetPriceofUnit(d.ProductID_Key.toString(),r.DocumentDate,parseInt(d.Unit_Key),d);!o.e.IsEmpty(q.Formula)&&z.Columns[1].Contains(Y)&&(Y=q.Formula),Y=1==r.ScreenObject.DocumentType||25==r.ScreenObject.DocumentType||2==r.ScreenObject.DocumentType||3==r.ScreenObject.DocumentType||4==r.ScreenObject.DocumentType||10==r.ScreenObject.DocumentType||26==r.ScreenObject.DocumentType||27==r.ScreenObject.DocumentType||34==r.ScreenObject.DocumentType||31==r.ScreenObject.DocumentType?"PurchaseRate":"SellingRate";var J=0,Z=0;z.Tables.length>0&&z.Tables[0].length>0&&!o.e.IsEmpty(z.Tables[0][0].Conversion)&&(J=parseFloat(z.Tables[0][0].Conversion)),z.Tables.length>1&&z.Tables[1].length>0&&z.Columns[1].Contains(Y)&&!o.e.IsEmpty(z.Tables[1][0][Y])&&(Z=z.Columns[1].Contains("UOMID")?J*parseFloat(z.Tables[1][0][Y]):parseFloat(z.Tables[1][0][Y]),d.Rate=Z.ToString("N"+q.DecimalPoints),d.defaultRate=Z.ToString("N"+q.DecimalPoints))}else _.Tables.length>0&&_.Tables[0].length>0&&!_.Columns[0].Contains("ErrorMessage")&&(1==r.ScreenObject.DocumentType||2==r.ScreenObject.DocumentType||3==r.ScreenObject.DocumentType||4==r.ScreenObject.DocumentType||10==r.ScreenObject.DocumentType||26==r.ScreenObject.DocumentType||25==r.ScreenObject.DocumentType||27==r.ScreenObject.DocumentType||34==r.ScreenObject.DocumentType||31==r.ScreenObject.DocumentType?o.e.IsEmpty(_.Tables[0][0].PurchaseRate)?d.Rate=0:(d.Rate=_.Tables[0][0].PurchaseRate.toString(),d.defaultRate=_.Tables[0][0].PurchaseRate.toString()):o.e.IsEmpty(_.Tables[0][0].SellingRate)||(d.Rate=_.Tables[0][0].SellingRate.toString(),d.defaultRate=_.Tables[0][0].SellingRate.toString()))}r.FillLinkRefereceProducts(d,_.Tables[0],W);var $=r.ScreenObject.ColumnSource.filter((function(e){return e.DisplayMember.Contains("dcNum")&&4!=e.SectionID}));if(_.Tables.length>4)for(var ee=function(t){var n=$[t];if(0==(X=null==i&&X.length>0&&!Object(j.isUndefined)(X[0].CostCenterIDLinked)&&e.Columns[0].Contains("CostCenterID")&&e.Tables[0].length>0?U.filter((function(t){return t.BASECOL==n.DisplayMember&&t.CostCenterIDLinked==e.Tables[0][0].CostCenterID})):U.filter((function(e){return e.BASECOL==n.DisplayMember}))).length){var a=_.Tables[4].filter((function(e){return e.SysColumnName==n.DisplayMember}));a.length>0&&(d[n.DisplayMember]=a[0].Value.toString(),d["default"+n.DisplayMember]=a[0].Value.toString())}},te=0;te<$.length;te++)ee(te);if(_.Tables.length>10&&_.Columns[10].Contains("BinId")&&_.Tables[10].length>0&&"0"!=_.Tables[10][0].BinId.toString()&&r.ScreenObject.Preferences.ContainsKey("BinsDimension")&&parseInt(r.ScreenObject.Preferences.BinsDimension)>5e4){var ne=r.ScreenObject.ColumnSource.find((function(e){return e.CostCenterID==parseInt(r.ScreenObject.Preferences.BinsDimension)}));ne&&r.ScreenObject.GridDataColumns.Contains(ne.DisplayMember)&&(d[ne.DisplayMember]=_.Tables[10][0].BinName.toString(),d[ne.ValueMember]=_.Tables[10][0].BinId.toString())}}var ae=r.ScreenObject.ColumnSource.filter((function(e){return null!=e.ValueMember&&"productid_key"==e.ValueMember.toString().toLowerCase()}));if(null!=ae){var ie=r.ScreenObject.Data.Tables[0],re=!1;if(r.ScreenObject.Preferences.ContainsKey("FillLocalRef")&&""!=r.ScreenObject.Preferences.FillLocalRef.toString()&&Object(l.j)(r.ScreenObject.Preferences.FillLocalRef)){var se=r.ScreenObject.Preferences.LocalRefflds.toString().split(",");r.ScreenObject.ColumnSource.forEach((function(e){3!=e.CostCenterID||r.ScreenObject.Preferences.LocalRefflds.toString().length>0&&!se.Contains(e.ID)?3!=e.CostCenterID&&se.Contains(e.ID)&&""!=e.ValueMember&&null!=d[e.ValueMember]&&!o.e.IsEmpty(d[e.ValueMember])&&r.ScreenObject.Data.Tables[0].filter((function(t){return null!=t.LocalReference&&t.LocalReference==e.ID})).length>0&&r.ScreenObject.GetLinkReferenceData(parseInt(e.ID),r.DocumentID,parseInt(d[e.ValueMember]),Date.Today(),"",e.CostCenterID,d,null,!1):""!=e.ValueMember&&null!=d[e.ValueMember]&&!o.e.IsEmpty(d[e.ValueMember])&&r.ScreenObject.Data.Tables[0].filter((function(t){return null!=t.LocalReference&&(t.LocalReference==e.ID||79==t.LocalReference&&(26585==t.LinkData||53529==t.LinkData||53589==t.LinkData||53530==t.LinkData))})).length>0&&r.ScreenObject.GetLinkReferenceData(parseInt(e.ID),r.DocumentID,parseInt(d[e.ValueMember]),Date.Today(),"",e.CostCenterID,d,null,!1)}))}else ae.forEach((function(e){e.CostCenterID>0&&!re&&(ie.filter((function(e){return 79==e.LocalReference&&(26585==e.LinkData||54306==e.LinkData||54307==e.LinkData||53529==e.LinkData||53589==e.LinkData||53530==e.LinkData)})).length>0&&!o.e.IsEmpty(e.ValueMember)&&!o.e.IsEmpty(d[e.ValueMember])&&(re=!0,r.ScreenObject.GetLinkReferenceData(parseInt(e.ID),r.DocumentID,parseInt(d[e.ValueMember]),Date.Today(),"",e.CostCenterID,d,null,!1)))}))}if(null==i){d[e.Tables[0][P][e.Columns[0][3]].toString()]=e.Tables[0][P][e.Columns[0][0]],d.defaultQuantity=d.Quantity,d.TolVal=e.Tables[0][P].ToleranceLimitsValue.toString(),d.TolPer=e.Tables[0][P].PercentValue.toString(),d.LinkedInvDocDetailsID=e.Tables[0][P].DocDetailsID.toString(),d.RefNo=e.Tables[0][P].VoucherNO.toString(),d.LinkedFieldName=e.Tables[0][P][e.Columns[0][3]].toString();var oe=r.ScreenObject.Data.Tables[0].filter((function(e){return 79==e.LocalReference&&53735==e.LinkData}));if(oe.length>0&&r.ScreenObject.GridDataColumns.Contains(oe[0].SysColumnName)&&(d[oe[0].SysColumnName]=e.Columns[0].Contains("Executed")?e.Tables[0][P].Executed.toString():parseFloat(e.Tables[0][P].Quantity)-parseFloat(e.Tables[0][P][e.Columns[0][0]])),e.Tables[0].length>0&&e.Columns[0].Contains("IsQtyFreeOffer")&&!o.e.IsEmpty(e.Tables[0][P].IsQtyFreeOffer)&&parseInt(e.Tables[0][P].IsQtyFreeOffer)>0&&r.ScreenObject.GridDataColumns.Contains("FreeQTY")){e.Columns[0].Contains("ParentSchemeID")&&!o.e.IsEmpty(e.Tables[0][P].ParentSchemeID)&&"0"!=e.Tables[0][P].ParentSchemeID.toString()&&r.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!o.e.IsEmpty(e.Tables[0][P].IsQtyFreeOffer)&&parseInt(e.Tables[0][P].IsQtyFreeOffer)>0&&(d.FreeQTY=e.Tables[0][P].Quantity,d.Quantity=0),d.SchemeID=e.Tables[0][P].IsQtyFreeOffer.toString();var le=r.ScreenObject.GridData.filter((function(t){return 1!=t.SchemeID&&t.SchemeID==e.Tables[0][P].IsQtyFreeOffer}));if(le.length>0)d.MaxSchemeID=le[0].MaxSchemeID;else{var ue=0,de=r.ScreenObject.GridData.Compute("max","MaxSchemeID");null!=de&&(ue=o.e.Int(de)),ue++,d.MaxSchemeID=ue}"1"==d.SchemeID.toString()?(d.IsScheme="Y",d.FreeQTY=d.quantity,d.quantity=0):d.IsScheme=e.Columns[0].Contains("ParentSchemeID")&&!o.e.IsEmpty(e.Tables[0][P].ParentSchemeID)&&"0"!=e.Tables[0][P].ParentSchemeID.toString()?"Y":"N"}}if(o.e.IsEmpty(d.Unit_Key)&&null!=_&&_.Tables.length>0&&_.Columns[0].Contains("uomid")&&!o.e.IsEmpty(_.Tables[0][0].uomid)?(d.Unit=_.Tables[0][0].UnitName.toString(),d.Unit_Key=_.Tables[0][0].uomid.toString(),_.Columns[0].Contains("UOMConversion")?(d.UOMConversion=_.Tables[0][P].UOMConversion.toString(),o.e.IsEmpty(_.Tables[0][P].UOMConversion)||o.e.IsEmpty(d.Quantity)?o.e.IsEmpty(d.Quantity)||(d.UOMConvertedQty=d.Quantity):d.UOMConvertedQty=parseFloat(d.Quantity)*parseFloat(_.Tables[0][P].UOMConversion)):(d.UOMConversion=1,o.e.IsEmpty(d.Quantity)||(d.UOMConvertedQty=d.Quantity))):e.Columns[0].Contains("UOMConversion")?(d.UOMConversion=e.Tables[0][P].UOMConversion.toString(),o.e.IsEmpty(e.Tables[0][P].UOMConversion)||o.e.IsEmpty(d.Quantity)?o.e.IsEmpty(d.Quantity)||(d.UOMConvertedQty=d.Quantity):d.UOMConvertedQty=parseFloat(d.Quantity)*parseFloat(e.Tables[0][P].UOMConversion)):(d.UOMConversion=1,o.e.IsEmpty(d.Quantity)||(d.UOMConvertedQty=d.Quantity)),e.Columns[0].Contains("ProductTypeID")&&(d.Type=null!=_&&_.Tables.length>0&&_.Columns[0].Contains("ProductTypeID")&&_.Tables[0].length>0?_.Tables[0][0].ProductTypeID.toString():e.Tables[0][P].ProductTypeID.toString(),null!=_&&_.Tables.length>0&&_.Columns[0].Contains("BinWise")&&_.Tables[0].length>0&&(d.BinWise=_.Tables[0][0].BinWise),r.ScreenObject.GridDataColumns.Contains("QtyType")&&e.Columns[0].Contains("QtyAdjustType")&&(d.QtyType=e.Tables[0][P].QtyAdjustType),r.ScreenObject.GridDataColumns.Contains("PackType")&&e.Columns[0].Contains("IsPacking")&&(d.PackType=e.Tables[0][P].IsPacking),r.ScreenObject.GridDataColumns.Contains("IsTestCase")&&_.Columns[0].Contains("TestCaseExists")&&(d.IsTestCase=_.Tables[0][0].TestCaseExists),r.ScreenObject.GridDataColumns.Contains("landingType")&&e.Columns[0].Contains("IsBillOfEntry")&&(d.landingType=e.Tables[0][P].IsBillOfEntry),r.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!o.e.IsEmpty(d.FreeQTY)&&parseFloat(d.FreeQTY)>0&&(d.UOMConvertedQty=o.e.IsEmpty(d.UOMConversion)?d.FreeQTY:parseFloat(d.FreeQTY)*parseFloat(d.UOMConversion))),null==i)if(o.e.IsEmpty(e.Tables[0][P].ProductTypeID)||8!=parseInt(e.Tables[0][P].ProductTypeID)&&3!=parseInt(e.Tables[0][P].ProductTypeID)&&11!=parseInt(e.Tables[0][P].ProductTypeID)&&12!=parseInt(e.Tables[0][P].ProductTypeID)){if(!o.e.IsEmpty(e.Tables[0][P].ProductTypeID)&&5==parseInt(e.Tables[0][P].ProductTypeID)&&e.Tables[5].length>0){var De=e.Tables[5].filter((function(t){return t.InvDocDetailsID==e.Tables[0][P].DocDetailsID||t.DynamicInvDocDetailsID==e.Tables[0][P].DocDetailsID}));if(De.length>0&&(e.Columns[5].Contains("IsQtyIgnored")&&"1"==De[0].IsQtyIgnored.toString()||r.ScreenObject.Preferences.ContainsKey("CopyBatches")&&!o.e.IsEmpty(r.ScreenObject.Preferences.CopyBatches)&&Object(l.j)(r.ScreenObject.Preferences.CopyBatches)||r.ScreenObject.Preferences.ContainsKey("ConsBatch")&&"True"==r.ScreenObject.Preferences.ConsBatch)){var he="",Se=0;he+="<xml>";for(var me=0;me<De.length;me++)he+="<Row ",he+=' BatchID="'+De[me].BatchID.toString()+'" ',he+=' ProductID="'+d.ProductID_Key.toString()+'" ',e.Columns[5].Contains("RefInvDocDetailsID")&&!o.e.IsEmpty(De[me].RefInvDocDetailsID)&&(he+=' RefInvID="'+De[me].RefInvDocDetailsID.toString()+'" '),r.ScreenObject.Preferences.ContainsKey("ConsBatch")&&"True"==r.ScreenObject.Preferences.ConsBatch&&(he+=' LinkedID="'+De[me].InvDocDetailsID.toString()+'" '),De.length>1?(he+=' Quantity="'+De[me].Quantity.toString()+'" ',he+=' Hold="0" ',he+=' Release="'+De[me].Quantity.toString()+'" ',Se+=parseFloat(De[me].Quantity)):!o.e.IsEmpty(d.SchemeID)&&parseInt(d.SchemeID)>0&&"Y"==d.IsScheme.toString()&&r.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!o.e.IsEmpty(d.FreeQTY)?(he+=' Quantity="'+d.FreeQTY.toString()+'" ',he+=' Hold="0" ',he+=' Release="'+d.FreeQTY.toString()+'" '):(he+=' Quantity="'+d.Quantity.toString()+'" ',he+=' Hold="0" ',he+=' Release="'+d.Quantity.toString()+'" ',o.e.IsEmpty(d.UomConversion)||o.e.IsEmpty(d.Quantity)||(he+=' Quantity="'+(parseFloat(d.UomConversion.toString())*parseFloat(d.Quantity.toString())).toString()+'" ',he+=' Hold="0" ',he+=' Release="'+(parseFloat(d.UomConversion.toString())*parseFloat(d.Quantity.toString())).toString()+'" ')),he+=" ></Row>";he+="</xml>",d.ExtraXML=he,Se>0&&(d.Quantity=Se,d.UOMConvertedQty=d.Quantity.toString())}}else if(!o.e.IsEmpty(e.Tables[0][P].ProductTypeID)&&(2==parseInt(e.Tables[0][P].ProductTypeID)||10==parseInt(e.Tables[0][P].ProductTypeID))&&e.Tables.length>8&&e.Tables[8].length>0&&r.ScreenObject.Preferences.ContainsKey("CopySerialNos")&&""!=r.ScreenObject.Preferences.CopySerialNos.toString()&&Object(l.j)(r.ScreenObject.Preferences.CopySerialNos)){var be=e.Tables[8].filter((function(t){return t.InvDocDetailsID==e.Tables[0][P].DocDetailsID}));if(be.length>0){var Ce="";Ce+="<xml>";var ye=0;o.e.IsEmpty(d.Quantity)||(ye=parseFloat(d.Quantity)),be.length<ye&&(ye=be.length);for(var pe=0;pe<ye;pe++)Ce+="<Row ",Ce+=' SerialProductID="0" ',Ce+=' SerialNumber="'+o.e.String(be[pe].SerialNumber)+'" ',Ce+=' StockCode="'+o.e.String(be[pe].StockCode)+'" ',Ce+=' Quantity="'+o.e.String(be[pe].Quantity)+'" ',Ce+=' Narration="" ',1==r.VoucherType?(Ce+=' IsIssue="0" ',Ce+=' StatusID="157" ',Ce+=' RefInvDocDetailsID="0" ',Ce+=' IsAvailable="1" ',Ce+=' SerialGUID="'+o.e.NewGuid()+'" '):(Ce+=' IsIssue="1" ',Ce+=' StatusID="158" ',Ce+=' RefInvDocDetailsID="'+o.e.String(be[pe].InvDocDetailsID)+'" ',Ce+=' IsAvailable="0" ',Ce+=' SerialGUID="'+o.e.String(be[pe].SerialGUID)+'" '),Ce+=" ></Row>";Ce+="</xml>",d.ExtraXML=Ce}}}else{var ge=null;11!=parseInt(e.Tables[0][P].ProductTypeID.toString())&&12!=parseInt(e.Tables[0][P].ProductTypeID.toString())||(ge=_);var fe=e.Tables[0].filter((function(t){return t.DynamicInvDocDetailsID==e.Tables[0][P].DocDetailsID}));if(0==fe.length)return G=c,"continue";var Oe="";Oe+="<xml>";for(var Ie=0;Ie<fe.length;Ie++){Oe+="<Row ><xml ";for(var Te="",je="",Ae="",Me=!1,ve=0;ve<r.ScreenObject.ColumnSource.length;ve++)if("DocDetailsID"!=r.ScreenObject.ColumnSource[ve].DisplayMember&&"DocSeqNo"!=r.ScreenObject.ColumnSource[ve].DisplayMember&&"LinkedInvDocDetailsID"!=r.ScreenObject.ColumnSource[ve].DisplayMember&&"RefNo"!=r.ScreenObject.ColumnSource[ve].DisplayMember&&"LinkedFieldName"!=r.ScreenObject.ColumnSource[ve].DisplayMember&&r.ScreenObject.ColumnSource[ve].DisplayMember.toLowerCase()!=e.Tables[0][P][Object.keys(e.Tables[0][P])[3]].toString().toLowerCase()){if(3==r.ScreenObject.ColumnSource[ve].CostCenterID){if(Me)continue;Me=!0}Te+=r.ScreenObject.SetDynamicsetLinkValues(e,r.ScreenObject.ColumnSource[ve],e.Tables[0].indexOf(fe[Ie]),i),r.ScreenObject.ColumnSource[ve].DisplayMember.toLowerCase().Contains("dcccnid")&&(je+=r.ScreenObject.SetDynamicsetNumLinkValues(e,r.ScreenObject.ColumnSource[ve],e.Tables[0].indexOf(fe[Ie]),i)),r.ScreenObject.ColumnSource[ve].DisplayMember.toLowerCase().Contains("dcnum")&&(Ae+=r.ScreenObject.SetDynamicsetNumLinkValues(e,r.ScreenObject.ColumnSource[ve],e.Tables[0].indexOf(fe[Ie]),i))}var Ge=1,Ne=0;if(0==(Ge=o.e.Double(fe[Ie].Quantity))&&(Ge=1),o.e.IsEmpty(fe[Ie].Unit)||(Ne=parseInt(fe[Ie].Unit)),o.e.IsEmpty(fe[Ie].ProductID)||(_=r.ScreenObject.GetProductTypeDetails(fe[Ie].ProductID.toString(),r.DocumentDate,Ne,Ge,"0",e.Tables[1][e.Columns[1][e.Tables[0].indexOf(fe[Ie])]],!0,null,!1,0,r.Currency)),null!=_&&_.Tables.length>0&&_.Tables[0].length>0&&_.Columns[0].Contains("AvgRate")&&!o.e.IsEmpty(_.Tables[0][0].AvgRate)&&(Te+=' AverageRate="'+_.Tables[0][0].AvgRate.toString()+'" '),_.Tables.length>0&&_.Tables[0].length>0&&!_.Columns[0].Contains("ErrorMessage")&&(_.Columns[0].Contains("QOH")&&!o.e.IsEmpty(_.Tables[0][0].QOH)&&(Te+=' QOH="'+_.Tables[0][0].QOH.toString()+'" '),_.Columns[0].Contains("BalQOH")&&!o.e.IsEmpty(_.Tables[0][0].BalQOH)&&(Te+=' BalQOH="'+_.Tables[0][0].BalQOH.toString()+'" '),_.Columns[0].Contains("HOLDQTY")&&!o.e.IsEmpty(_.Tables[0][0].HOLDQTY)&&(Te+=' HOLDQTY="'+_.Tables[0][0].HOLDQTY.toString()+'" '),_.Columns[0].Contains("CommittedQty")&&!o.e.IsEmpty(_.Tables[0][0].CommittedQty)&&(Te+=' CommittedQty="'+_.Tables[0][0].CommittedQty.toString()+'" '),_.Columns[0].Contains("RESERVEQTY")&&!o.e.IsEmpty(_.Tables[0][0].RESERVEQTY)&&(Te+=' RESERVEQTY="'+_.Tables[0][0].RESERVEQTY.toString()+'" '),_.Columns[0].Contains("TotalReserve")&&!o.e.IsEmpty(_.Tables[0][0].TotalReserve)&&(Te+=' TotalReserve="'+_.Tables[0][0].TotalReserve.toString()+'" '),_.Columns[0].Contains("LastPurchaseRate")&&!o.e.IsEmpty(_.Tables[0][0].LastPurchaseRate)&&(Te+=' LASTPURCHASERATE="'+_.Tables[0][0].LastPurchaseRate.toString()+'" '),r.FillLinkRefereceProducts_2(Te,_.Tables[0]),_.Tables.length>10&&_.Columns[10].Contains("BinId")&&_.Tables[10].length>0&&"0"!=_.Tables[10][0].BinId.toString()&&r.ScreenObject.Preferences.ContainsKey("BinsDimension")&&parseInt(r.ScreenObject.Preferences.BinsDimension)>5e4)){var Ee=r.ScreenObject.ColumnSource.find((function(e){return e.CostCenterID==parseInt(r.ScreenObject.Preferences.BinsDimension)}));Ee&&r.ScreenObject.GridDataColumns.Contains(Ee.DisplayMember)&&(Te+=" "+Ee.DisplayMember+'="'+_.Tables[10][0].BinName.toString()+'" ',Te+=" "+Ee.ValueMember+'="'+_.Tables[10][0].BinId.toString()+'" ')}Te+=' DocDetailsID="0" ',null==i&&(Te+=' LinkedInvDocDetailsID="'+fe[Ie].DocDetailsID.toString()+'" ',Te+=' LinkedFieldName="'+fe[Ie][Object.keys(fe[Ie])[3]].toString()+'" ',Te+=' LinkedFieldValue="'+fe[Ie][Object.keys(fe[Ie])[0]].toString()+'" ',Te+=' RefNo="'+fe[Ie].VoucherNo.toString()+'" ',Te+=" "+e.Tables[0][P][e.Columns[0][3]].toString()+'="'+fe[Ie][0].toString()+'" ',e.Tables[0][P][e.Columns[0][3]].toString().toLowerCase().Contains("dcnum")&&(Ae+=e.Tables[0][P][e.Columns[0][3]].toString()+"="+fe[Ie][Object.keys(fe[Ie])[0]].toString()+",")),Te+=' DocSeqNo="'+(Ie+1).toString()+'" ',Oe+=' CCQuery="'+je+'" ',Oe+=' NumQuery="'+Ae+'" ',e.Columns[0].Contains("ProductTypeID")&&(Te+=' Type="'+fe[Ie].ProductTypeID.toString()+'" ',"3"==e.Tables[0][P].ProductTypeID.toString()&&(o.e.IsEmpty(fe[Ie].Quantity)||o.e.IsEmpty(e.Tables[0][P].Quantity)?Te+=' defaultQuantity="'+fe[Ie].Quantity.toString()+'" ':Te+=' defaultQuantity="'+parseFloat(fe[Ie].Quantity)/parseFloat(e.Tables[0][P].Quantity)+'" '),e.Columns[0].Contains("UOMConversion")?Te+=' UOMConversion="'+fe[Ie].UOMConversion.toString()+'" ':Te+=' UOMConversion="1" ',!Te.toString().toLowerCase().Contains("unit_key=")&&_.Tables.length>0&&_.Columns[0].Contains("uomid")&&!o.e.IsEmpty(_.Tables[0][0].uomid)&&(Te+=' Unit_key="'+_.Tables[0][0].uomid.toString()+'" ')),Oe+=Te.toString()+" /></Row>"}Oe+="</xml>",d.ExtraXML=Oe;for(var we=new ce(r,d,ge),Fe=0,Ve=0;Ve<we.GridData.length;Ve++)o.e.IsEmpty(we.GridData[Ve].ProductID_Key)||(r.CalculateTotals(we.GridData[Ve],!1,"",!1),Fe++);we.OnButtonClick("AutoSave"),r.ScreenObject.Preferences.ContainsKey("SplitKit")&&"true"==r.ScreenObject.Preferences.SplitKit.toLowerCase()&&Fe>1&&(O=O+Fe-1)}if(e.Tables.length>9&&e.Columns[9].Contains("InvDocDetailsID")&&r.ScreenObject.GridDataColumns.Contains("QtyType")&&e.Tables[9].length>0){var Le="",Re=e.Tables[9].filter((function(t){return t.InvDocDetailsID==e.Tables[0][P].DocDetailsID}));Re.length>0&&(Le+="<QtyAdjustments>",Re.forEach((function(t){Le+="<Row ";for(var n=0;n<e.Tables[9].Columns.length;n++)e.Tables[9].Columns[n].Contains("Fld")&&!o.e.IsEmpty(t[e.Tables[9].Columns[n]])&&(Le+=e.Tables[9].Columns[n]+'="'+t[e.Tables[9].Columns[n]].toString()+'" ');Le+='Islinked="1"',Le+=" ></Row>"})),Le+="</QtyAdjustments>",d.QtyXML=Le)}if(r.ScreenObject.Preferences.ContainsKey("CopyBins")&&"true"==r.ScreenObject.Preferences.CopyBins.toLowerCase()&&e.Tables.length>12&&e.Columns[12].Contains("BinID")&&r.ScreenObject.GridDataColumns.Contains("BinWise")&&"True"==d.BinWise.toString()&&e.Tables[12].length>0){var Be="",xe=e.Tables[12].filter((function(t){return t.InvDocDetailsID==e.Tables[0][P].DocDetailsID}));xe.length>0&&(Be+="<BinsXML>",xe.forEach((function(t){Be+="<Row ",Be+=' NodeID="'+t.BinID.toString()+'" ',Be+=' Allocate="'+t.Quantity.toString()+'" ',Be+=' Vol="'+e.Tables[0][P].Volume.toString()+'" ',Be+=' Waist="'+e.Tables[0][P].Wastage.toString()+'" ',Be+=" ></Row>"})),Be+="</BinsXML>",d.BinsXML=Be)}if(e.Tables.length>13&&e.Tables[13].length>0){var ke="",_e=e.Tables[13].filter((function(t){return 1==t.Type&&t.InvDocDetailsID==e.Tables[0][P].DocDetailsID}));r.ScreenObject.Preferences.ContainsKey("DonotCopyBOE")&&"true"==r.ScreenObject.Preferences.DonotCopyBOE.toLowerCase()?_e.length>0&&r.ScreenObject.GridDataColumns.Contains("DocExtraXML")&&(r.ScreenObject.GridDataColumns.Contains("LinkedBoe")||r.ScreenObject.GridDataColumns.push("LinkedBoe"),d.LinkedBoe=_e[0].RefID.toString()):_e.length>0&&r.ScreenObject.GridDataColumns.Contains("DocExtraXML")&&(ke+="<DocExtraXML>",_e.forEach((function(e){ke+="<Row ",ke+=' RefID="'+e.RefID.toString()+'" ',ke+=' Qty="'+e.Quantity.toString()+'" ',ke+=' Type="'+e.Type.toString()+'" ',ke+=" ></Row>",d.BOEID=e.RefID.toString()})),ke+="</DocExtraXML>",d.DocExtraXML=ke);var Ke=e.Tables[4].filter((function(e){return-5==e.CostCenterColIDLinked}));if(Ke.length>0&&_e.length>0&&r.ScreenObject.GridDataColumns.Contains(Ke[0].BASECOL.toString())&&(d[Ke[0].BASECOL.toString()]=_e[0].RefID.toString()),(_e=e.Tables[13].filter((function(t){return 2==t.Type&&t.InvDocDetailsID==e.Tables[0][P].DocDetailsID}))).length>0&&r.ScreenObject.GridDataColumns.Contains("PackXML")){null==r.DtPack&&(r.DtPack=[],r.DtPackColumns=[],r.DtPackColumns.push("ID"),r.DtPackColumns.push("Name"),r.DtPackColumns.push("Label"),r.DtPackColumns.push("cWeight"),r.DtPackColumns.push("cVolume"),r.DtPackColumns.push("Weight"),r.DtPackColumns.push("Volume"),r.DtPackColumns.push("Height"),r.DtPackColumns.push("length"),r.DtPackColumns.push("Width"),r.DtPackColumns.push("ActualWeight"),r.DtPackColumns.push("ActualVolume"),(r.ScreenObject.Preferences.ContainsKey("PackWiseProds")&&"true"==r.ScreenObject.Preferences.PackWiseProds.toLowerCase()||r.ScreenObject.Preferences.ContainsKey("LineWisePacking")&&"true"==r.ScreenObject.Preferences.LineWisePacking.toLowerCase())&&r.DtPackColumns.push("Data")),r.ScreenObject.GridDataColumns.Contains("Unq")||r.ScreenObject.GridDataColumns.push("Unq"),null==D&&(D=null!=(D=r.ScreenObject.GridData.Compute("max","Unq"))?parseInt(D)+1:0),d.Unq=D,D=parseInt(D)+1,ke="",ke+="<DocExtraXML>";for(var Qe=function(t){var n=_e[t];if(null!=u&&!u.Contains(n.label.toString()))return"continue";""!=I&&(I+=","),I+=n.RefID.toString(),ke+="<Row ",ke+=' RefID="'+n.RefID.toString()+'" ',ke+=' Qty="'+n.Quantity.toString()+'" ',ke+=' Type="'+n.Type.toString()+'" ',ke+=' Label="'+n.label.toString()+'" ',ke+=' Volume="'+e.Tables[0][P].Volume.toString()+'" ',ke+=' Weight="'+e.Tables[0][P].Weight.toString()+'" ',o.e.IsEmpty(n.Fld1)||(ke+=' Fld1="'+n.Fld1.toString()+'" '),o.e.IsEmpty(n.Fld2)||(ke+=' Fld2="'+n.Fld2.toString()+'" '),o.e.IsEmpty(n.fld3)||(ke+=' Fld3="'+n.fld3.toString()+'" '),o.e.IsEmpty(n.fld4)||(ke+=' Fld4="'+n.fld4.toString()+'" '),o.e.IsEmpty(n.fld5)||(ke+=' Fld5="'+n.fld5.toString()+'" '),ke+=" ></Row>";var a=void 0,i=r.DtPack.filter((function(e){return e.Label==n.label}));if(0==i.length?((a={}).ID=n.RefID.toString(),a.Label=n.label.toString(),r.DtPack.push(a)):a=i[0],e.Columns[0].Contains("Volume")){var s=0;o.e.IsEmpty(e.Tables[0][P].Volume)||(s=parseFloat(e.Tables[0][P].Volume)*parseFloat(n.Quantity)),a.cVolume=o.e.IsEmpty(a.cVolume)?s:parseFloat(a.cVolume)+s,s=0,o.e.IsEmpty(e.Tables[0][P].Weight)||(s=parseFloat(e.Tables[0][P].Weight)*parseFloat(n.Quantity)),a.cWeight=o.e.IsEmpty(a.cWeight)?s:parseFloat(a.cWeight)+s}r.DtPackColumns.Contains("Data")&&(a.Data=o.e.IsEmpty(a.Data)?d.Unq.toString()+"~"+n.Quantity.toString():a.Data.toString()+","+d.Unq.toString()+"~"+n.Quantity.toString())},He=0;He<_e.length;He++)Qe(He);ke+="</DocExtraXML>",d.PackXML=ke}}}if(r.ScreenObject.Preferences.ContainsKey("BarcodeField")&&""!=r.ScreenObject.Preferences.BarcodeField.toString()&&e.Columns[0].Contains("ScannedBarcodes")){var We=r.ScreenObject.ColumnSource.find((function(e){return null!=e.ID&&e.ID==r.ScreenObject.Preferences.BarcodeField}));We&&r.ScreenObject.GridDataColumns.Contains(We.DisplayMember)&&(d[We.DisplayMember]=e.Tables[0][P].ScannedBarcodes.toString())}if(s.a.SessionManager.Preferences.BudgetAccount.length>0&&s.a.SessionManager.Preferences.BudgetDimension.length>0&&null!=(m=r.ScreenObject.ColumnSource.find((function(e){return null!=e.ID&&e.CostCenterID==r.BudgetObj.iBudgetDimension})))&&r.ScreenObject.GridDataColumns.Contains(m.ValueMember)&&(o.e.IsEmpty(d[m.ValueMember])||parseInt(o.e.String(d[m.ValueMember]))<=1)&&r.BudgetObj.AutoLoadBudgetDimension(d,null),r.ScreenObject.GridDataObj.insertRowAt(d,n+O),null!=E)for(var Ue=function(t){for(var a=0;a<r.ScreenObject.GridDataColumns.length;a++)"ProductName"!=r.ScreenObject.GridDataColumns[a]&&"ProductID_Key"!=r.ScreenObject.GridDataColumns[a]&&"ProductCode"!=r.ScreenObject.GridDataColumns[a]&&"DocDetailsID"!=r.ScreenObject.GridDataColumns[a]&&"TODocDetailsID"!=r.ScreenObject.GridDataColumns[a]&&"Row_Background"!=r.ScreenObject.GridDataColumns[a]&&(E[t][a]=d[a]);r.ScreenObject.GridDataObj.insertRowAt(E[t],n+O);var s=r.GetProductValues(E[t],0,!0);if(s.Tables.length>0&&s.Tables[0].length>0&&!s.Columns[0].Contains("ErrorMessage")&&s.Columns[0].Contains("ProductTypeID")&&"8"!=e.Tables[0][P].ProductTypeID.toString()){e.Columns[0].Contains("FileGUID")&&(E[t].FileGUID=s.Tables[0][0].FileGUID.toString(),E[t].FileExtension=s.Tables[0][0].FileExtension.toString()),parseInt(d.ProductID_Key)!=r.ScreenObject.TempProductID&&(E[t].QOH=s.Columns[0].Contains("QOH")&&!o.e.IsEmpty(s.Tables[0][0].QOH)?s.Tables[0][0].QOH.toString():0,E[t].BalQOH=s.Columns[0].Contains("BalQOH")&&!o.e.IsEmpty(s.Tables[0][0].BalQOH)?s.Tables[0][0].BalQOH.toString():0,E[t].HOLDQTY=s.Columns[0].Contains("HOLDQTY")&&!o.e.IsEmpty(s.Tables[0][0].HOLDQTY)?s.Tables[0][0].HOLDQTY.toString():0,E[t].CommittedQty=s.Columns[0].Contains("CommittedQty")&&!o.e.IsEmpty(s.Tables[0][0].CommittedQty)?s.Tables[0][0].CommittedQty.toString():0,E[t].RESERVEQTY=s.Columns[0].Contains("RESERVEQTY")&&!o.e.IsEmpty(s.Tables[0][0].RESERVEQTY)?s.Tables[0][0].RESERVEQTY.toString():0,E[t].TotalReserve=s.Columns[0].Contains("TotalReserve")&&!o.e.IsEmpty(s.Tables[0][0].TotalReserve)?s.Tables[0][0].TotalReserve.toString():0),E[t].LASTPURCHASERATE=s.Columns[0].Contains("LastPurchaseRate")&&!o.e.IsEmpty(s.Tables[0][0].LastPurchaseRate)?s.Tables[0][0].LastPurchaseRate.toString():0,E[t].Subexists=s.Tables.length>8&&s.Tables[8].length>1&&!s.Columns[8].Contains("ErrorMessage")&&r.ScreenObject.Preferences.ContainsKey("EnableSubtitutes")&&""!=r.ScreenObject.Preferences.EnableSubtitutes.toString()&&Object(l.j)(r.ScreenObject.Preferences.EnableSubtitutes)?"1":"0";var c,u=null;if(s.Tables.length>3&&s.Tables[3].length>0&&(u=s.Tables[3][0]),0==(c=null==i&&c.length>0&&!Object(j.isUndefined)(c[0].CostCenterIDLinked)&&e.Columns[0].Contains("CostCenterID")&&e.Tables[0].length>0?e.Tables[4].filter((function(t){return t.BASECOL=t.CostCenterIDLinked==e.Tables[0][0].CostCenterID})):e.Tables[4].filter((function(e){return e.BASECOL="Rate"}))).length){var D=r.ScreenObject.ColumnSource.find((function(e){return"Rate"==e.DisplayMember})),h="";if(null!=u)!o.e.IsEmpty(D.Formula)&&s.Columns[3].Contains(h)&&(h=D.Formula),""==(h=1==r.ScreenObject.DocumentType||25==r.ScreenObject.DocumentType||2==r.ScreenObject.DocumentType||3==r.ScreenObject.DocumentType||4==r.ScreenObject.DocumentType||10==r.ScreenObject.DocumentType||26==r.ScreenObject.DocumentType||27==r.ScreenObject.DocumentType||34==r.ScreenObject.DocumentType||31==r.ScreenObject.DocumentType?"PurchaseRate":"SellingRate")||o.e.IsEmpty(u[h])||(E[t].Rate=u[h].toString(),E[t].defaultRate=u[h].toString());else if(s.Tables.length>0&&s.Tables[0].length>0&&s.Columns[0].Contains("ProdBaseUOM")&&s.Tables[0][0].ProdBaseUOM.toString()!=s.Tables[0][0].uomid.toString()){var S=r.ScreenObject.GetPriceofUnit(d.ProductID_Key.toString(),r.DocumentDate,parseInt(d.Unit_Key),d);!o.e.IsEmpty(D.Formula)&&S.Columns[1].Contains(h)&&(h=D.Formula),h=1==r.ScreenObject.DocumentType||25==r.ScreenObject.DocumentType||2==r.ScreenObject.DocumentType||3==r.ScreenObject.DocumentType||4==r.ScreenObject.DocumentType||10==r.ScreenObject.DocumentType||26==r.ScreenObject.DocumentType||27==r.ScreenObject.DocumentType||34==r.ScreenObject.DocumentType||31==r.ScreenObject.DocumentType?"PurchaseRate":"SellingRate";var m=0,b=0;S.Tables.length>0&&S.Tables[0].length>0&&!o.e.IsEmpty(S.Tables[0][0].Conversion)&&(m=parseFloat(S.Tables[0][0].Conversion)),S.Tables.length>1&&S.Tables[1].length>0&&S.Columns[1].Contains(h)&&!o.e.IsEmpty(S.Tables[1][0][h])&&(b=S.Columns[1].Contains("UOMID")?m*parseFloat(S.Tables[1][0][h]):parseFloat(S.Tables[1][0][h]),E[t].Rate=b.ToString("N"+D.DecimalPoints),E[t].defaultRate=b.ToString("N"+D.DecimalPoints))}else s.Tables.length>0&&s.Tables[0].length>0&&!s.Columns[0].Contains("ErrorMessage")&&(1==r.ScreenObject.DocumentType||2==r.ScreenObject.DocumentType||3==r.ScreenObject.DocumentType||4==r.ScreenObject.DocumentType||10==r.ScreenObject.DocumentType||26==r.ScreenObject.DocumentType||25==r.ScreenObject.DocumentType||27==r.ScreenObject.DocumentType||34==r.ScreenObject.DocumentType||31==r.ScreenObject.DocumentType?o.e.IsEmpty(s.Tables[0][0].PurchaseRate)?E[t].Rate=0:(E[t].Rate=s.Tables[0][0].PurchaseRate.toString(),E[t].defaultRate=s.Tables[0][0].PurchaseRate.toString()):o.e.IsEmpty(s.Tables[0][0].SellingRate)||(E[t].Rate=s.Tables[0][0].SellingRate.toString(),E[t].defaultRate=s.Tables[0][0].SellingRate.toString()))}r.FillLinkRefereceProducts(E[t],s.Tables[0],u);var C=r.ScreenObject.ColumnSource.filter((function(e){return e.DisplayMember.Contains("dcNum")&&4!=e.SectionID}));if(s.Tables.length>4)for(var y=function(n){var a=C[n];if(c=e.Tables[4].filter((function(e){return e.BASECOL==a.DisplayMember})),null==i&&c.length>0&&!Object(j.isUndefined)(c[0].CostCenterIDLinked)&&e.Columns[0].Contains("CostCenterID")&&e.Tables[0].length>0&&(c=c.filter((function(t){return t.CostCenterIDLinked==e.Tables[0][0].CostCenterID}))),0==c.length){var r=s.Tables[4].filter((function(e){return e.SysColumnName==a.DisplayMember}));r.length>0&&(E[t][a.DisplayMember]=r[0].Value.toString(),E[t]["default"+a.DisplayMember]=r[0].Value.toString())}},p=0;p<C.length;p++)y(p)}var g=r.ScreenObject.ColumnSource.filter((function(e){return null!=e.ValueMember&&"productid_key"==e.ValueMember.toString().toLowerCase()}));if(g.length>0){r.ScreenObject.Data.Tables[0];var f=!1;if(r.ScreenObject.Preferences.ContainsKey("FillLocalRef")&&""!=r.ScreenObject.Preferences.FillLocalRef.toString()&&Object(l.j)(r.ScreenObject.Preferences.FillLocalRef)){var I=g.length;g.forEach((function(e){I--,e.CostCenterID>0&&!f&&(r.ScreenObject.Data.Tables[0].filter(0==I?function(t){return null!=t.LocalReference&&(t.LocalReference==e.ID||79==t.LocalReference&&(26585==t.LinkData||54306==t.LinkData||54307==t.LinkData||53529==t.LinkData||53589==t.LinkData||53530==t.LinkData))}:function(t){return null!=t.LocalReference&&t.LocalReference==e.ID}).length>0&&!o.e.IsEmpty(e.ValueMember)&&!o.e.IsEmpty(E[t][e.ValueMember])&&(f=!0,r.ScreenObject.GetLinkReferenceData(parseInt(e.ID),r.DocumentID,parseInt(E[t][e.ValueMember]),Date.Today(),"",e.CostCenterID,E[t])))}))}}if(e.Columns[0].Contains("ProductTypeID")&&(E[t].Type=null!=s&&s.Tables.length>0&&s.Columns[0].Contains("ProductTypeID")&&s.Tables[0].length>0?s.Tables[0][0].ProductTypeID.toString():e.Tables[0][P].ProductTypeID.toString(),null!=s&&s.Tables.length>0&&s.Columns[0].Contains("BinWise")&&s.Tables[0].length>0&&(E[t].BinWise=s.Tables[0][0].BinWise.toString()),r.ScreenObject.GridDataColumns.Contains("QtyType")&&e.Columns[0].Contains("QtyAdjustType")&&(E[t].QtyType=e.Tables[0][P].QtyAdjustType.toString()),r.ScreenObject.GridDataColumns.Contains("PackType")&&e.Columns[0].Contains("IsPacking")&&(E[t].PackType=e.Tables[0][P].IsPacking.toString()),r.ScreenObject.GridDataColumns.Contains("IsTestCase")&&s.Columns[0].Contains("TestCaseExists")&&(E[t].IsTestCase=s.Tables[0][0].TestCaseExists.toString()),r.ScreenObject.GridDataColumns.Contains("landingType")&&e.Columns[0].Contains("IsBillOfEntry")&&(E[t].landingType=e.Tables[0][P].IsBillOfEntry.toString()),r.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!o.e.IsEmpty(d.FreeQTY)&&parseFloat(d.FreeQTY)>0&&(E[t].UOMConvertedQty=o.e.IsEmpty(d.UOMConversion)?d.FreeQTY.toString():parseFloat(d.FreeQTY)*parseFloat(d.UOMConversion))),T&&!o.e.IsEmpty(E[t].ProductID_Key)&&parseInt(E[t].ProductID_Key)>0){var A=r.ScreenObject.GetSchemes(r.DocumentDate,E[t]);A.Tables.length>0&&A.Columns[0].Contains("SchemeID")&&(r.fillSchemevalues(A.Tables[0],A.Columns[0],E[t]),r.ApplySchemes(E[t]))}r.ScreenObject.GridDataColumns.Contains(e.Tables[0][P][e.Columns[0][3]].toString())?r.CalculateTotals(E[t],!1,e.Tables[0][P][e.Columns[0][3]].toString(),!1):r.CalculateTotals(E[t],!1,"",!1)},Xe=0;Xe<E.length;Xe++,O++)Ue(Xe);if(r.ScreenObject.Preferences.ContainsKey("ExpandStages")&&""!=r.ScreenObject.Preferences.ExpandStages.toString()&&Object(l.j)(r.ScreenObject.Preferences.ExpandStages)&&e.Tables.length>14&&e.Tables[14].length>0&&function(){var t=e.Tables[14].filter((function(t){return t.Nodeid==e.Tables[1][P]["Dcccnid"+(parseInt(s.a.SessionManager.Preferences.PaytermLinkDim)-5e4)]}));if(t.length>0){for(var a=function(a){var i=void 0;if(0==a)i=d;else{i=r.ScreenObject.GridDataObj.NewRow();for(var s=0;s<r.ScreenObject.GridDataColumns.length;s++)i[s]="DocDetailsID"==r.ScreenObject.GridDataColumns[s]||"TODocDetailsID"==r.ScreenObject.GridDataColumns[s]?0:d[s];r.ScreenObject.GridDataObj.insertRowAt(i,n+O+a)}var c=r.ScreenObject.Data.Tables[0].filter((function(e){return 79==e.LocalReference&&5e4==e.LinkData}));if(c.length>0&&r.ScreenObject.GridDataColumns.Contains(c[0].SysColumnName)&&(i[c[0].SysColumnName]=t[a].percentage.toString()),(c=r.ScreenObject.Data.Tables[0].filter((function(e){return 79==e.LocalReference&&50001==e.LinkData}))).length>0&&r.ScreenObject.GridDataColumns.Contains(c[0].SysColumnName)&&(i[c[0].SysColumnName]=t[a].Days.toString()),!o.e.IsEmpty(t[a].dimccid)&&!o.e.IsEmpty(t[a].dimNodeID)&&r.ScreenObject.GridDataColumns.Contains("Dcccnid"+(parseInt(t[a].dimccid)-5e4)+"_Key")&&(i["Dcccnid"+(parseInt(t[a].dimccid)-5e4)+"_Key"]=t[a].dimNodeID.toString(),r.ScreenObject.Preferences.ContainsKey("FillLocalRef")&&""!=r.ScreenObject.Preferences.FillLocalRef.toString()&&Object(l.j)(r.ScreenObject.Preferences.FillLocalRef)&&""!=r.ScreenObject.Preferences.LocalRefflds.toString())){var u=r.ScreenObject.Preferences.LocalRefflds.toString().split(","),D=r.ScreenObject.ColumnSource.find((function(e){return e.CostCenterID==parseInt(t[a].dimccid)}));u.Contains(D.ID)&&r.ScreenObject.GetLinkReferenceData(parseInt(D.ID),r.DocumentID,parseInt(d[D.ValueMember]),Date.Today(),"",D.CostCenterID,i,null,!1)}a>0&&(r.ScreenObject.GridDataColumns.Contains(e.Tables[0][P][e.Columns[0][3]].toString())?r.CalculateTotals(i,!1,e.Tables[0][P][e.Columns[0][3]].toString(),!1):r.CalculateTotals(i,!1,"",!1))},i=0;i<t.length;i++)a(i);t.length>1&&(O=O+t.length-1)}}(),!o.e.IsEmpty(d.Type)&&5==parseInt(d.Type)&&(!o.e.IsEmpty(d.Quantity)&&parseFloat(d.Quantity)>0||r.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!o.e.IsEmpty(d.FreeQTY)&&parseFloat(d.FreeQTY)>0)&&(-1==r.VoucherType&&r.ScreenObject.Preferences.ContainsKey("AutoBatchesLinking")&&""!=r.ScreenObject.Preferences.AutoBatchesLinking.toString()&&Object(l.j)(r.ScreenObject.Preferences.AutoBatchesLinking)||!o.e.IsEmpty(e.Tables[0][P].BatchXML))){var qe,Ye=0;if(r.ScreenObject.Preferences.ContainsKey("Donotuselocation")&&""!=r.ScreenObject.Preferences.Donotuselocation&&Object(l.j)(r.ScreenObject.Preferences.Donotuselocation)){var ze=r.ScreenObject._CCFields.find((function(e){return"dcccnid2"==e.DBColumnName.toLowerCase()}));ze&&ze instanceof C.b&&ze.SelectedValue>0?Ye=ze.SelectedValue:null!=d&&r.ScreenObject.GridDataColumns.Contains("dcCCNID2_Key")&&!o.e.IsEmpty(d.dcCCNID2_Key)&&(Ye=parseInt(d.dcCCNID2_Key))}else Ye=r.ScreenObject.LocationID>0?r.ScreenObject.LocationID:s.a.SessionManager.LocationID;qe=r.ScreenObject.DivisionID>0?r.ScreenObject.DivisionID:s.a.SessionManager.DivisionID;var Je=0;!o.e.IsEmpty(d.Quantity)&&parseFloat(d.Quantity)>0?Je=parseFloat(d.Quantity):r.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!o.e.IsEmpty(d.FreeQTY)&&parseFloat(d.FreeQTY)>0&&(Je=parseFloat(d.FreeQTY)),r.ScreenObject.GridDataColumns.Contains("UOMConversion")&&!o.e.IsEmpty(d.UOMConversion)&&(Je*=parseFloat(d.UOMConversion));var Ze=new Pe.a(r.ScreenObject.GridDataObj);Ze.BatchNumberViewModel_3(r,r.VoucherType,Je,parseInt(d.ProductID_Key),d.ProductName.toString(),Ye,qe,d),e.Columns[0].Contains("BatchXML")&&!o.e.IsEmpty(e.Tables[0][P].BatchXML)?function(){var t=new o.f;if(t.ReadXml("<XML>"+e.Tables[0][P].BatchXML.toString()+"</XML>"),t.Tables.length>0&&t.Columns[0].Contains("QTY")&&t.Tables[0].length>0)for(var n=function(e){var n=null;t.Columns[0].Contains("BatchNo")&&!o.e.IsEmpty(t.Tables[0][e].BatchNo)?n=Ze.GridData.filter((function(n){return n.BATCHNUMBER==t.Tables[0][e].BatchNo.toString()})):t.Columns[0].Contains("BatchCode")&&!o.e.IsEmpty(t.Tables[0][e].BatchCode)&&(n=Ze.GridData.filter((function(n){return n.BatchCode==t.Tables[0][e].BatchCode.toString()}))),null!=n&&n.length>0&&!o.e.IsEmpty(t.Tables[0][e].QTY)&&(Ze.GridDataColumns.Contains("QtyUom")?(n[0].QtyUom=o.e.IsEmpty(n[0].QtyUom)?t.Tables[0][e].QTY.toString():parseFloat(n[0].QtyUom.toString())+parseFloat(t.Tables[0][e].QTY.toString()),n[0].Quantity=r.ScreenObject.GridDataColumns.Contains("UOMConversion")&&!o.e.IsEmpty(d.UOMConversion)?parseFloat(n[0].QtyUom.toString())*parseFloat(d.UOMConversion.toString()):n[0].QtyUom):n[0].Quantity=o.e.IsEmpty(n[0].Quantity)?t.Tables[0][e].QTY.toString():parseFloat(n[0].Quantity.toString())+parseFloat(t.Tables[0][e].QTY.toString()))},a=0;a<t.Tables[0].length;a++)n(a)}():Ze.ChkFifo=!0,Ze.OnSave("AutoSave"),Ze.count>1&&(O=O+Ze.count-1)}if(r.ScreenObject.Preferences.ContainsKey("AutoAdjustBinLinking")&&""!=r.ScreenObject.Preferences.AutoAdjustBinLinking.toString()&&Object(l.j)(r.ScreenObject.Preferences.AutoAdjustBinLinking)&&r.AddBins(d,!1,!1,null,!0),O++,null!=r.AutoPostViewModel&&e.Tables.length>16&&e.Tables[16].length>0){r.AutoPostViewModel.ScreenObject._CCFields.forEach((function(e){var t=r.ScreenObject._CCFields.find((function(t){return t.DBColumnName==e.DBColumnName}));t&&e instanceof C.b&&t instanceof C.b&&(e.SelectedValue=t.SelectedValue,e.SelectedValueText=t.Text)})),r.AutoPostViewModel.ScreenObject._TextFields.forEach((function(e){e instanceof C.b&&3==e.CCID&&!o.e.IsEmpty(d.ProductID_Key)&&(e.SelectedValue=parseInt(d.ProductID_Key),r.ScreenObject.GridDataColumns.Contains("ProductName")&&(e.SelectedValueText=d.ProductName.toString()))}));for(var $e=o.e.NewGuid(),et=0;et<e.Tables[16].length;et++){var tt=r.AutoPostViewModel.ScreenObject.GridDataObj.NewRow();tt.ProductID_Key=e.Tables[16][et].ProductID.toString(),tt.defaultQuantity=e.Tables[16][et].Quantity.toString(),tt.Quantity=parseFloat(d.Quantity)*parseFloat(e.Tables[16][et].Quantity),r.AutoPostViewModel.ScreenObject.GridDataColumns.Contains("Unit")&&(tt.Unit=e.Tables[16][et].UnitName.toString()),r.AutoPostViewModel.ScreenObject.GridDataColumns.Contains("Unit_Key")&&(tt.Unit_Key=e.Tables[16][et].Unit.toString()),r.AutoPostViewModel.ScreenObject.GridDataColumns.Contains("ProductCOde")&&(tt.ProductCOde=e.Tables[16][et].ProductCOde.toString()),r.AutoPostViewModel.ScreenObject.GridDataColumns.Contains("ProductName")&&(tt.ProductName=e.Tables[16][et].ProductName.toString()),tt.RefSeqNo=$e,r.AutoPostViewModel.ScreenObject.GridDataObj.insertRowAt(tt,P),r.AutoPostViewModel.AddProductData(tt,!1,!0,!0),r.AutoPostViewModel.CalculateTotals(tt,!1,"",!1)}d.RefSeqNo=$e;var nt=r.AutoPostViewModel.ScreenObject.GridData.filter((function(e){return e.RefSeqNo=$e})),at=0;nt.forEach((function(e){o.e.IsEmpty(e.Gross)||(at+=parseFloat(e.Gross))})),d.Rate=at/parseFloat(d.Quantity)}for(var it=0;it<r.Shortcuts.length;it++)r.Shortcuts[it]instanceof f.a&&5==r.Shortcuts[it].Mode&&r.ValidateData_Column(r.Shortcuts[it],d,!0)&&r.ScreenObject.GetExternalFuncData(r.Shortcuts[it].Mode,r.Shortcuts[it].SPName,r.Shortcuts[it].IPParams,r.Shortcuts[it].OPParams,d);if(T&&e.Columns[0].Contains("IsQtyFreeOffer")&&(o.e.IsEmpty(e.Tables[0][P].IsQtyFreeOffer)||!(parseInt(e.Tables[0][P].IsQtyFreeOffer)>0))){if(!o.e.IsEmpty(d.ProductID_Key)&&parseInt(d.ProductID_Key)>0){var rt=r.ScreenObject.GetSchemes(r.DocumentDate,d);rt.Tables.length>0&&rt.Columns[0].Contains("SchemeID")&&r.fillSchemevalues(rt.Tables[0],rt.Columns[0],d)}r.ApplySchemes(d)}r.ScreenObject.GridDataColumns.Contains(e.Tables[0][P][e.Columns[0][3]].toString())?r.CalculateTotals(d,!1,e.Tables[0][P][e.Columns[0][3]].toString(),!1):r.CalculateTotals(d,!1,"",!1);for(var st=0;st<r.Shortcuts.length;st++)r.Shortcuts[st]instanceof f.a&&10==r.Shortcuts[st].Mode&&r.ValidateData_Column(r.Shortcuts[st],d,!0)&&r.ScreenObject.GetExternalFuncData(r.Shortcuts[st].Mode,r.Shortcuts[st].SPName,r.Shortcuts[st].IPParams,r.Shortcuts[st].OPParams,d);e.Columns[0].Contains("DocumentType")&&"5"==e.Tables[0][P].DocumentType.toString()&&c++,G=c},G=0;G<e.Tables[0].length&&(P=M&&null!=M?e.Tables[0].IndexOf(M[G]):G,!(r.ScreenObject.Preferences.ContainsKey("linkSingleline")&&""!=r.ScreenObject.Preferences.linkSingleline&&Object(l.j)(r.ScreenObject.Preferences.linkSingleline)&&P>0));G++)v(G);if(O>0&&!r.IsSelectAll&&r.ScreenObject.GridDataObj.removeRowAt(n+O),""!=I){var E=r.ScreenObject.GetPackDetails(I);null!=E&&E.Tables.length>0&&E.Columns[0].Contains("Name")&&E.Tables[0].length>0&&E.Tables[0].forEach((function(e){r.DtPack.filter((function(t){return t.ID==e.Nodeid})).forEach((function(t){t.Name=e.Name,t.Volume=e.Volume,t.Weight=e.Weight,t.length=e.length,t.Width=e.width,t.Height=e.height}))}))}if(r.IsInventoryVoucher&&30==r.ScreenObject.DocumentType&&r.ScreenObject.Preferences.ContainsKey("UseasAssemble/DisAssembly")&&Object(l.j)(r.ScreenObject.Preferences["UseasAssemble/DisAssembly"])&&e.Tables.length>18&&e.Tables[18].length>0){var w=r.ScreenObject.GridData.filter((function(t){return t.ProductID_key==e.Tables[18][0].ParentProductID}));if(w.length>0)for(r.ScreenObject.GridDataColumns.Contains("IsKit")||r.ScreenObject.GridDataColumns.push("IsKit"),w[0].IsKit=1,P=0;P<r.ScreenObject.GridData.length;P++)o.e.IsEmpty(r.ScreenObject.GridData[P].ProductID_Key)||(w=e.Tables[18].filter((function(e){return e.ProductID==r.ScreenObject.GridData[P].ProductID_Key}))).length>0&&(r.ScreenObject.GridData[P].IsKit=2,r.ScreenObject.GridData[P].DefaultQuantity=w[0].Quantity)}if(r.ScreenObject.Preferences.ContainsKey("FillLocalRef")&&""!=r.ScreenObject.Preferences.FillLocalRef.toString()&&Object(l.j)(r.ScreenObject.Preferences.FillLocalRef)&&""!=r.ScreenObject.Preferences.LocalRefflds.toString()){var F=r.ScreenObject.Preferences.LocalRefflds.toString().split(",");r.ScreenObject._CCFields.forEach((function(e){F.Contains(e.DBColumnID.toString())&&(r.ScreenObject.Data.Tables[0].filter((function(t){return null!=t.LocalReference&&t.LocalReference==e.DBColumnID})).length>0||r.ScreenObject.DefaultBasedOn.ContainsKey(e.CCID.toString()))&&r.ScreenObject.GetLinkReferenceData(e.DBColumnID,r.ScreenObject.CostCenterID,e.SelectedValue,r.DocumentDate,e.DBColumnName,e.CCID,null)})),r.ScreenObject._TextFields.forEach((function(e){e instanceof C.b&&F.Contains(e.DBColumnID.toString())&&r.ScreenObject.Data.Tables[0].filter((function(t){return null!=t.LocalReference&&t.LocalReference==e.DBColumnID})).length>0&&r.ScreenObject.GetLinkReferenceData(e.DBColumnID,r.ScreenObject.CostCenterID,e.SelectedValue,r.DocumentDate,e.DBColumnName,e.CCID,null)})),null!=r.ScreenObject.DebitAccount&&r.ScreenObject.DebitAccount.SelectedValue>0&&F.Contains(r.ScreenObject.DebitAccount.DBColumnID.toString())&&r.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&e.LocalReference==r.ScreenObject.DebitAccount.DBColumnID.toString()})).length>0&&r.ScreenObject.GetLinkReferenceData(r.ScreenObject.DebitAccount.DBColumnID,r.ScreenObject.CostCenterID,r.ScreenObject.DebitAccount.SelectedValue,r.DocumentDate,r.ScreenObject.DebitAccount.DBColumnName,2,null),null!=r.ScreenObject.CreditAccount&&r.ScreenObject.CreditAccount.SelectedValue>0&&F.Contains(r.ScreenObject.CreditAccount.DBColumnID.toString())&&r.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&e.LocalReference==r.ScreenObject.CreditAccount.DBColumnID.toString()})).length>0&&r.ScreenObject.GetLinkReferenceData(r.ScreenObject.CreditAccount.DBColumnID,r.ScreenObject.CostCenterID,r.ScreenObject.CreditAccount.SelectedValue,r.DocumentDate,r.ScreenObject.CreditAccount.DBColumnName,2,null)}if(e.Tables.length>19&&e.Tables[19].length>0&&!o.e.IsEmpty(e.Tables[19][0][e.Columns[19][0]])){var V=r.ScreenObject.Data.Tables[0].filter((function(e){return 79==e.LocalReference&&55478==e.LinkData}));if(V.length>0){var L=e.Columns[19][0];if(r.ScreenObject.GridDataColumns.Contains(V[0].SysColumnName)&&r.ScreenObject.GridData.length>0)r.ScreenObject.GridData[0][V[0].SysColumnName]=e.Tables[19][0][L].toString();else{var R=r.ScreenObject._TextFields.find((function(e){return e.DBColumnID==V[0].CostCenterColID}));R&&r.ScreenObject.fillcontrolValue(R,e.Tables[19][0][L].toString())}}}if(r.IsInventoryVoucher&&r.FooterVisible){var B=new o.f;if(e.Columns[2].Contains("Remarks")&&e.Tables[2].length>0&&!o.e.IsEmpty(e.Tables[2][0].Remarks)&&r.ScreenObject.Preferences.ContainsKey("CopyFooterDetails")&&""!=r.ScreenObject.Preferences.CopyFooterDetails&&Object(l.j)(r.ScreenObject.Preferences.CopyFooterDetails)&&B.LoadXml(e.Tables[2][0].Remarks),r.ScreenObject.FooterColumnSource[1].ReadOnly)for(P=0;P<r.ScreenObject.FooterGridData.length;P++){var x=null,k="";if((x=(null==i?e.Tables[4]:i).filter((function(e){return e.BASECOL==r.ScreenObject.FooterGridData[P].ColumnName}))).length>0&&!o.e.IsEmpty(x[0].LINKCOL)){k=x[0].LINKCOL.toString();var _="",K="";if(e.Tables.length>2&&e.Columns[2].Contains(k)&&(k.toLowerCase().Contains("dcnum")||k.toLowerCase().Contains("dccalcnum")||k.toLowerCase().Contains("dccurrid")||k.toLowerCase().Contains("dcexchrt"))){var Q=null;e.Tables[2].length>0&&(Q=e.Tables[2][0][k].toString()),null!=Q&&(_=Q.toString());var H=e.Tables[2].Compute("sum","dcCalc"+k.replace("dc",""));null!=H&&(K=H.toString())}if(!(""!=_&&o.e.IsNum(_)&&0!=parseFloat(_)||""!=K&&o.e.IsNum(K)&&0!=parseFloat(K)))continue;r.ScreenObject.FooterGridDataColumns.Contains("dcCurrID_Key")&&!o.e.IsEmpty(r.ScreenObject.FooterGridData[P].dcCurrID_Key)&&-3!=parseInt(r.ScreenObject.FooterGridData[P].dcCurrID_Key.toString())&&-1!=parseInt(r.ScreenObject.FooterGridData[P].dcCurrID_Key.toString())&&(k.toLowerCase().Contains("dcnum")&&e.Columns[2].Contains("dcCurrID"+k.toLowerCase().Replace("dcnum",""))&&!o.e.IsEmpty(e.Tables[2][0]["dcCurrID"+k.toLowerCase().Replace("dcnum","")])&&(r.ScreenObject.FooterGridData[P].dcCurrID_Key=e.Tables[2][0]["dcCurrID"+k.toLowerCase().Replace("dcnum","")].toString()),k.toLowerCase().Contains("dcnum")&&e.Columns[2].Contains("dcExchRT"+k.toLowerCase().Replace("dcnum",""))&&!o.e.IsEmpty(e.Tables[2][0]["dcExchRT"+k.toLowerCase().Replace("dcnum","")])&&(r.ScreenObject.FooterGridData[P].dcExchRT=e.Tables[2][0]["dcExchRT"+k.toLowerCase().Replace("dcnum","")].toString()),k.toLowerCase().Contains("dccalcnum")&&e.Columns[2].Contains("dcCurrID"+k.toLowerCase().Replace("dccalcnum",""))&&!o.e.IsEmpty(e.Tables[2][0]["dcCurrID"+k.toLowerCase().Replace("dccalcnum","")])&&(r.ScreenObject.FooterGridData[P].dcCurrID_Key=e.Tables[2][0]["dcCurrID"+k.toLowerCase().Replace("dccalcnum","")].toString()),k.toLowerCase().Contains("dccalcnum")&&e.Columns[2].Contains("dcExchRT"+k.toLowerCase().Replace("dccalcnum",""))&&!o.e.IsEmpty(e.Tables[2][0]["dcExchRT"+k.toLowerCase().Replace("dccalcnum","")])&&(r.ScreenObject.FooterGridData[P].dcExchRT=e.Tables[2][0]["dcExchRT"+k.toLowerCase().Replace("dccalcnum","")].toString())),""!=_&&o.e.IsNum(_)?(r.ScreenObject.FooterGridData[P].Amount=r.ScreenObject.Preferences.ContainsKey("ClubFooter")&&""!=r.ScreenObject.Preferences.ClubFooter&&Object(l.j)(r.ScreenObject.Preferences.ClubFooter)&&!o.e.IsEmpty(r.ScreenObject.FooterGridData[P].Amount)&&o.e.IsNum(r.ScreenObject.FooterGridData[P].Amount)?parseFloat(r.ScreenObject.FooterGridData[P].Amount)+parseFloat(_):_,r.FooterCellEditEnd("Amount",r.ScreenObject.FooterGridData[P])):""!=K&&o.e.IsNum(K)&&(r.ScreenObject.FooterGridData[P].CalcAmount=r.ScreenObject.Preferences.ContainsKey("ClubFooter")&&""!=r.ScreenObject.Preferences.ClubFooter&&Object(l.j)(r.ScreenObject.Preferences.ClubFooter)&&!o.e.IsEmpty(r.ScreenObject.FooterGridData[P].CalcAmount)&&o.e.IsNum(r.ScreenObject.FooterGridData[P].CalcAmount)?parseFloat(r.ScreenObject.FooterGridData[P].CalcAmount)+parseFloat(K):K,r.FooterCellEditEnd("CalcAmount",r.ScreenObject.FooterGridData[P]));for(var W=B.SelectNodes("XML/Row"),U=0;U<W.length;U++){var X=W[U];if(null!=X.attributes.Columnname&&X.attributes.Columnname.value.toLowerCase()==k.toLowerCase()){null!=X.attributes.DebitAccount&&""!=X.attributes.DebitAccount.value&&(r.ScreenObject.FooterGridData[P].DebitAccount=X.attributes.DebitAccount.value),null!=X.attributes.CreditAcount&&""!=X.attributes.CreditAcount.value&&(r.ScreenObject.FooterGridData[P].CreditAccount=X.attributes.CreditAcount.value),null!=X.attributes.Remarks&&""!=X.attributes.Remarks.value&&(r.ScreenObject.FooterGridData[P].Remarks=X.attributes.Remarks.value);break}}}}else{if(r.ScreenObject.FooterColumnSource[1].ComboData instanceof DataView){for(r.ScreenObject.FooterColumnSource[1].SetComboData(r.ScreenObject.FooterColumnSource[1].ComboDataTable),P=0;P<r.ScreenObject.FooterColumnSource[1].ComboData.length;P++){var q=(null==i?e.Tables[4]:i).filter((function(e){return e.BASECOL==r.ScreenObject.FooterColumnSource[1].ComboData[P].ColumnName})),Y="";if(q.length>0&&!o.e.IsEmpty(q[0].LINKCOL)){Y=q[0].LINKCOL.toString();var z="",J="";if(e.Tables.length>2&&e.Columns[2].Contains(Y)&&(Y.toLowerCase().Contains("dcnum")||Y.toLowerCase().Contains("dccalcnum")||Y.toLowerCase().Contains("dccurrid")||Y.toLowerCase().Contains("dcexchrt"))){var Z=null;e.Tables[2].length>0&&(Z=e.Tables[2][0][Y].toString()),z=null!=Z?Z.toString():"0";var $=e.Tables[2].Compute("sum","dcCalc"+Y.replace("dc",""));null!=$&&(J=$.toString())}if(!(""!=z&&o.e.IsNum(z)&&0!=parseFloat(z)||""!=J&&o.e.IsNum(J)&&0!=parseFloat(J)))continue;var ee=void 0,te=r.ScreenObject.FooterGridData.filter((function(e){return e.ColumnName==r.ScreenObject.FooterColumnSource[1].ComboData[P].ColumnName}));if(te.length>0)ee=te[0],r.ScreenObject.FooterGridDataColumns.Contains("dcCurrID_Key")&&!o.e.IsEmpty(ee.dcCurrID_Key)&&-3!=parseInt(ee.dcCurrID_Key.toString())&&-1!=parseInt(ee.dcCurrID_Key.toString())&&(Y.toLowerCase().Contains("dcnum")&&e.Columns[2].Contains("dcCurrID"+Y.toLowerCase().Replace("dcnum",""))&&!o.e.IsEmpty(e.Tables[2][0]["dcCurrID"+Y.toLowerCase().Replace("dcnum","")])&&(ee.dcCurrID_Key=e.Tables[2][0]["dcCurrID"+Y.toLowerCase().Replace("dcnum","")].toString()),Y.toLowerCase().Contains("dcnum")&&e.Columns[2].Contains("dcExchRT"+Y.toLowerCase().Replace("dcnum",""))&&!o.e.IsEmpty(e.Tables[2][0]["dcExchRT"+Y.toLowerCase().Replace("dcnum","")])&&(ee.dcExchRT=e.Tables[2][0]["dcExchRT"+Y.toLowerCase().Replace("dcnum","")].toString()),Y.toLowerCase().Contains("dccalcnum")&&e.Columns[2].Contains("dcCurrID"+Y.toLowerCase().Replace("dccalcnum",""))&&!o.e.IsEmpty(e.Tables[2][0]["dcCurrID"+Y.toLowerCase().Replace("dccalcnum","")])&&(ee.dcCurrID_Key=e.Tables[2][0]["dcCurrID"+Y.toLowerCase().Replace("dccalcnum","")].toString()),Y.toLowerCase().Contains("dccalcnum")&&e.Columns[2].Contains("dcExchRT"+Y.toLowerCase().Replace("dccalcnum",""))&&!o.e.IsEmpty(e.Tables[2][0]["dcExchRT"+Y.toLowerCase().Replace("dccalcnum","")])&&(ee.dcExchRT=e.Tables[2][0]["dcExchRT"+Y.toLowerCase().Replace("dccalcnum","")].toString())),""!=z?(te[0].Amount=r.ScreenObject.Preferences.ContainsKey("ClubFooter")&&Object(l.j)(r.ScreenObject.Preferences.ClubFooter)&&o.e.IsNum(te[0].Amount)?parseFloat(te[0].Amount)+parseFloat(z):z,r.FooterCellEditEnd("Amount",te[0])):""!=J&&(te[0].CalcAmount=r.ScreenObject.Preferences.ContainsKey("ClubFooter")&&Object(l.j)(r.ScreenObject.Preferences.ClubFooter)&&o.e.IsNum(te[0].CalcAmount)?parseFloat(te[0].CalcAmount)+parseFloat(J):J,r.FooterCellEditEnd("CalcAmount",te[0]));else{var ne=r.GetEmptyRowPosition(r.ScreenObject.FooterGridDataObj,"ColumnName");ne>-1?ee=r.ScreenObject.FooterGridData[ne]:(ee=r.ScreenObject.FooterGridDataObj.NewRow(),r.ScreenObject.FooterGridData.push(ee)),ee.ColumnName=r.ScreenObject.FooterColumnSource[1].ComboData[P].ColumnName.toString(),r.FooterCellEditEnd("ColumnName",ee),r.ScreenObject.FooterGridDataColumns.Contains("StyleHeightZero")&&(Object(l.j)(ee.IsVisible)?ee.StyleHeightZero=0:(ee.StyleHeightZero=1,ne>-1&&(ee=r.ScreenObject.FooterGridDataObj.NewRow(),r.ScreenObject.FooterGridData.push(ee),ee.ColumnName=r.ScreenObject.FooterColumnSource[1].ComboData[P].ColumnName.toString(),r.FooterCellEditEnd("ColumnName",ee),ee.StyleHeightZero=1,r.ScreenObject.FooterGridDataObj.removeRowAt(ne)))),""!=z?(r.ScreenObject.FooterGridDataColumns.Contains("dcCurrID_Key")&&!o.e.IsEmpty(ee.dcCurrID_Key)&&-3!=parseInt(ee.dcCurrID_Key.toString())&&-1!=parseInt(ee.dcCurrID_Key.toString())&&(Y.toLowerCase().Contains("dcnum")&&e.Columns[2].Contains("dcCurrID"+Y.toLowerCase().Replace("dcnum",""))&&!o.e.IsEmpty(e.Tables[2][0]["dcCurrID"+Y.toLowerCase().Replace("dcnum","")])&&(ee.dcCurrID_Key=e.Tables[2][0]["dcCurrID"+Y.toLowerCase().Replace("dcnum","")].toString()),Y.toLowerCase().Contains("dcnum")&&e.Columns[2].Contains("dcExchRT"+Y.toLowerCase().Replace("dcnum",""))&&!o.e.IsEmpty(e.Tables[2][0]["dcExchRT"+Y.toLowerCase().Replace("dcnum","")])&&(ee.dcExchRT=e.Tables[2][0]["dcExchRT"+Y.toLowerCase().Replace("dcnum","")].toString()),Y.toLowerCase().Contains("dccalcnum")&&e.Columns[2].Contains("dcCurrID"+Y.toLowerCase().Replace("dccalcnum",""))&&!o.e.IsEmpty(e.Tables[2][0]["dcCurrID"+Y.toLowerCase().Replace("dccalcnum","")])&&(ee.dcCurrID_Key=e.Tables[2][0]["dcCurrID"+Y.toLowerCase().Replace("dccalcnum","")].toString()),Y.toLowerCase().Contains("dccalcnum")&&e.Columns[2].Contains("dcExchRT"+Y.toLowerCase().Replace("dccalcnum",""))&&!o.e.IsEmpty(e.Tables[2][0]["dcExchRT"+Y.toLowerCase().Replace("dccalcnum","")])&&(ee.dcExchRT=e.Tables[2][0]["dcExchRT"+Y.toLowerCase().Replace("dccalcnum","")].toString())),ee.Amount=r.ScreenObject.Preferences.ContainsKey("ClubFooter")&&Object(l.j)(r.ScreenObject.Preferences.ClubFooter)&&o.e.IsNum(ee.Amount)?parseFloat(ee.Amount)+parseFloat(z):z,r.FooterCellEditEnd("Amount",ee)):""!=J&&(ee.CalcAmount=r.ScreenObject.Preferences.ContainsKey("ClubFooter")&&Object(l.j)(r.ScreenObject.Preferences.ClubFooter)&&o.e.Double(ee.CalcAmount)?parseFloat(ee.CalcAmount)+parseFloat(J):J,r.FooterCellEditEnd("CalcAmount",ee))}for(var ae=B.SelectNodes("XML/Row"),ie=0;ie<ae.length;ie++){var re=ae[ie];if(null!=re.attributes.Columnname&&re.attributes.Columnname.value.toLowerCase()==Y.toLowerCase()){null!=re.attributes.DebitAccount&&""!=re.attributes.DebitAccount.value&&(ee.DebitAccount=re.attributes.DebitAccount.value),null!=re.attributes.CreditAcount&&""!=re.attributes.CreditAcount.value&&(ee.CreditAccount=re.attributes.CreditAcount.value),null!=re.attributes.Remarks&&""!=re.attributes.Remarks.value&&(ee.Remarks=re.attributes.Remarks.value);break}}}}r.ScreenObject.FooterColumnSource[1].SetComboData(r.ScreenObject.FooterColumnSource[1].ComboDataTable.filter((function(e){return 1==e.IsVisible})))}r.GetEmptyRowPosition(r.ScreenObject.FooterGridDataObj,"ColumnName"),r.ScreenObject.UpdateSequenceFoot()}r.RefreshGridFooter=!0}if(e.Tables.length>10&&e.Tables[10].length>0&&r.ScreenObject.Preferences.ContainsKey("CopyAddresses")&&""!=r.ScreenObject.Preferences.CopyAddresses&&Object(l.j)(r.ScreenObject.Preferences.CopyAddresses)&&r.AddAddress(e),e.Tables.length>7&&e.Tables[7].length>0&&r.ScreenObject.Preferences.ContainsKey("LinkAttachments")&&""!=r.ScreenObject.Preferences.LinkAttachments&&Object(l.j)(r.ScreenObject.Preferences.LinkAttachments)){var se=null;if(e.Columns[7].Contains("DocID")){var oe=[];for(P=0;P<e.Tables[0].length;P++)oe.push(e.Tables[0][P].DocID);oe.length>0&&(se=e.Tables[7].filter((function(e){return oe.Contains(e.DocID)})))}else se=e.Tables[7];if(null!=se&&se.length>0&&null!=r.ViewAttachments)for(var le=0;le<se.length;le++){var ue=new N.AddAttachmentViewModel;ue.AddAttachmentViewModel_2(r),ue.ActualFileName=se[le].ActualFileName.toString(),ue.FileExtension=se[le].FileExtension.toString(),ue.FileDescription=se[le].FileDescription.toString(),ue.FilePath=o.b.GetLogPath(se[le].GUID.toString()+"."+se[le].FileExtension.toString()),ue.RelativeFileName=se[le].RelativeFileName.toString(),ue.AllowInPrint=Object(l.j)(se[le].AllowInPrint),ue.isfrmProduct=!0,ue.ColID="",ue.RowID=null,ue.RefNo=e.Tables[0][0].VoucherNO.toString(),r.ViewAttachments.AttachmentsListObj.addRow(ue)}}if(57==r.ScreenObject.DocumentType){var de=0;for(P=0;P<e.Tables[0].length;P++)o.e.IsEmpty(e.Tables[0][0][e.Columns[0][0]])||(de+=parseFloat(e.Tables[0][0][e.Columns[0][0]]));for(P=0;P<r.ScreenObject.GridData.length;P++)o.e.IsEmpty(r.ScreenObject.GridData[P].RefNo)||""!=o.e.String(r.ScreenObject.GridData[P].dcAlpha2)||r.ScreenObject.GridData[P].RefNo.toString()==e.Tables[0][0].VoucherNO.toString()&&(r.ScreenObject.GridData[P].dcAlpha2=de)}for(P=0;P<r.Shortcuts.length;P++)r.Shortcuts[P]instanceof y.c&&5==r.Shortcuts[P].Mode&&r.ValidateData(r.Shortcuts[P],!0)&&r.ScreenObject.GetExternalFuncData(r.Shortcuts[P].Mode,r.Shortcuts[P].ToolTipFooterTitle,r.Shortcuts[P].ToolTipFooterDescription,r.Shortcuts[P].ToolTipDescription,null);if(0==t.length&&e.Tables[0].length>0&&!r.IsSelectAll?(r.RefreshGrid=!0,r.ScreenObject.FillListViews(!1)):s.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==s.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&r.ScreenObject.FillListViews(!1),r.ScreenObject.SetDefaultValuesforCostCenters(2),null==i&&r.ScreenObject.Preferences.ContainsKey("SortbyProduct")&&"true"==r.ScreenObject.Preferences.SortbyProduct.toLowerCase()&&r.SortGrid(!0),e.Tables[0].length<500)if(n>100)for(P=n;P<r.ScreenObject.GridData.length;P++)o.e.IsEmpty(r.ScreenObject.GridData[P].ProductID_Key)||r.CalculateTotals(r.ScreenObject.GridData[P],!1,"",!1);else r.ScreenObject.GridData.forEach((function(e){o.e.IsEmpty(e.ProductID_Key)||r.CalculateTotals(e,!1,"",!1)}));r.CalculateTotals(null,!1)}()}catch(b){Logger.ErrorLog("VoucherGenerator","LoadEditData",b.stack)}finally{this.ScreenObject.AttachDetach(!0)}}}},{key:"FillLinkRefereceProducts_2",value:function(e,t){this.FillDatarow_4(e,t,{LocalReference:79,LinkData:23819},"AvgRate"),this.FillDatarow_4(e,t,{LocalReference:79,LinkData:25398},"QOH"),this.FillDatarow_4(e,t,{LocalReference:79,LinkData:52638},"QOH"),this.FillDatarow_4(e,t,{LocalReference:79,LinkData:52637},"BalQOH"),this.FillDatarow_4(e,t,{LocalReference:79,LinkData:26421},"HOLDQTY"),this.FillDatarow_4(e,t,{LocalReference:79,LinkData:50454},"CommittedQty"),this.FillDatarow_4(e,t,{LocalReference:79,LinkData:26422},"RESERVEQTY"),this.FillDatarow_4(e,t,{LocalReference:79,LinkData:499943},"TotalReserve"),this.FillDatarow_4(e,t,{LocalReference:79,LinkData:23820},"LastPurchaseRate"),this.FillDatarow_4(e,t,{LocalReference:79,LinkData:24062},"PWLastPRate"),this.FillDatarow_4(e,t,{LocalReference:79,LinkData:50051},"LastPCost"),this.FillDatarow_4(e,t,{LocalReference:79,LinkData:23821},"PWLastPCost"),this.FillDatarow_4(e,t,{LocalReference:79,LinkData:50494},"UnitProductCode"),this.FillDatarow_4(e,t,{LocalReference:79,LinkData:50493},"VendorProductCode"),this.FillDatarow_4(e,t,{LinkData:22821},"SellingRate"),this.FillDatarow_4(e,t,{LinkData:22793},"SellingRateA"),this.FillDatarow_4(e,t,{LinkData:22794},"SellingRateB"),this.FillDatarow_4(e,t,{LinkData:22795},"SellingRateC"),this.FillDatarow_4(e,t,{LinkData:22796},"SellingRateD"),this.FillDatarow_4(e,t,{LinkData:22797},"SellingRateE"),this.FillDatarow_4(e,t,{LinkData:22798},"SellingRateF"),this.FillDatarow_4(e,t,{LinkData:22799},"SellingRateG"),this.FillDatarow_4(e,t,{LinkData:22820},"PurchaseRate"),this.FillDatarow_4(e,t,{LinkData:22786},"PurchaseRateA"),this.FillDatarow_4(e,t,{LinkData:22787},"PurchaseRateB"),this.FillDatarow_4(e,t,{LinkData:22788},"PurchaseRateC"),this.FillDatarow_4(e,t,{LinkData:22789},"PurchaseRateD"),this.FillDatarow_4(e,t,{LinkData:22790},"PurchaseRateE"),this.FillDatarow_4(e,t,{LinkData:22791},"PurchaseRateF"),this.FillDatarow_4(e,t,{LinkData:22792},"PurchaseRateG"),this.FillDatarow_4(e,t,{LinkData:277},"ReorderQty"),this.FillDatarow_4(e,t,{LinkData:276},"ReorderLevel")}},{key:"FillDatarow_4",value:function(e,t,n,a){var i;if((i=this.ScreenObject.Data.Tables[0].filter(n.LocalReference?function(e){return e.LocalReference==n.LocalReference&&e.LinkData==n.LinkData}:function(e){return null!=e.LocalReference&&e.LinkData==n.LinkData})).length>0&&i.length>0&&this.ScreenObject.GridDataColumns.Contains(i[0].SysColumnName)&&!o.e.IsEmpty(t[0][a])){if(e.toString().Contains(i[0].SysColumnName+'="')){var r=e.toString().indexOf(i[0].SysColumnName+'="'),s=e.toString().indexOf('"',r+i[0].SysColumnName.length+2);e=e.Remove(r,s+1-r)}e+=" "+i[0].SysColumnName+'="'+t[0][a].toString()+'" '}}},{key:"GetEmptyRowPosition",value:function(e,t){for(var n=-1,a=e.Table,i=e.Columns,r=0;r<a.length;r++)if(""==o.e.String(a[r][t])){n=r;break}return-1==n&&(a.push({}),n=a.length-1,i.Contains("Sno")&&(a[n].Sno=a.length),i.Contains("DocSeqNo")&&(a[n].DocSeqNo=a.length)),n}},{key:"FillLink",value:function(e,t,n,a){for(var i=this,r=this.ScreenObject.GetLinkDocDetails(e,t),s=0,c=0;c<this.ScreenObject.GridData.length;c++)if(o.e.IsEmpty(this.ScreenObject.GridData[c].ProductID_Key)&&(!this.ScreenObject.GridDataColumns.Contains("RefNo")||o.e.IsEmpty(this.ScreenObject.GridData[c].RefNo))){s=c;break}for(var l=function(e){var t=i.ScreenObject.GridData.filter((function(t){return t.LinkedInvDocDetailsID==r.Tables[0][e].DocDetailsID}));if(t.length>0){for(var n=0,a=0;a<t.length;a++)!o.e.IsEmpty(t[a][r.Tables[0][e][r.Columns[0][3]].toString()])&&o.e.IsNum(t[a][r.Tables[0][e][r.Columns[0][3]].toString()])&&(n+=parseFloat(t[a][r.Tables[0][e][r.Columns[0][3]]]));if(!(!o.e.IsEmpty(r.Tables[0][e][r.Columns[0][0]])&&o.e.IsNum(r.Tables[0][e][r.Columns[0][0]])&&parseFloat(r.Tables[0][e][r.Columns[0][0]])-n>0))return r.Tables[0].RemoveAt(e),r.Tables[1].RemoveAt(e),r.Tables[2].RemoveAt(e),r.Tables[3].RemoveAt(e),e--,u=e,"continue";r.Tables[0][e][r.Columns[0][0]]=parseFloat(r.Tables[0][e][r.Columns[0][0]])-n}u=e},u=0;u<r.Tables[0].length;u++)l(u);if(null!=n&&n.length>0){for(var d=function(e){n.find((function(t){return t.InvDocDetailsID==r.Tables[0][e].DocDetailsID}))||(r.Tables[0].RemoveAt(e),r.Tables[1].RemoveAt(e),r.Tables[2].RemoveAt(e),r.Tables[3].RemoveAt(e))},D=r.Tables[0].length-1;D>=0;D--)d(D);if(e.Contains(","))for(var h=function(e){0==r.Tables[0].filter((function(t){return t.DocID==r.Tables[7][e].FeaturePK})).length&&r.Tables[7].RemoveAt(e)},S=r.Tables[7].length-1;S>=0;S--)h(S)}this.LoadLinkData(r,n,s,a,null)}},{key:"onselectall",value:function(e){if(null!=this.ScreenObject.Link&&null!=this.ScreenObject.Link.LinkCombo&&null!=this.ScreenObject.Link.LinkCombo.SelectedValue&&""!=this.ScreenObject.Link.LinkCombo.SelectedValue&&null!=this.ScreenObject.Link.DocumentList){if(this.ScreenObject.Preferences.ContainsKey("SameserialNo")&&""!=this.ScreenObject.Preferences.SameserialNo&&Object(l.j)(this.ScreenObject.Preferences.SameserialNo))return void(this.DisplayMessage="Can not select all when same Serial No in linking");this.IsSelectAll=!0;for(var t=0;t<this.ScreenObject.Link.DocumentList.Items.length;t++)this.ScreenObject.Link.DocumentList.Items[t].IsChecked||(this.ScreenObject.Link.DocumentList.Items[t].IsChecked=!0,this.FillLinkDocument(this.ScreenObject.Link.DocumentList.Items[t]));this.IsSelectAll=!1}this.RefreshGrid=!0,this.CheckVendorWiseLinkingPref()}},{key:"FillLinkDocument",value:function(e){if(null!=this.ScreenObject.Link.LinkCombo.SelectedValue&&""!=this.ScreenObject.Link.LinkCombo.SelectedValue)if(null!=this.ScreenObject.Link.LinkCombo.SelectedItem&&("158"==this.ScreenObject.Link.LinkCombo.SelectedItem.Parent||"76"==this.ScreenObject.Link.LinkCombo.SelectedItem.Parent)||this.ScreenObject.Preferences.ContainsKey("Selective")&&Object(l.j)(this.ScreenObject.Preferences.Selective)){var t=0,n=!1;null==this.ScreenObject.Link.LinkCombo.SelectedItem||"158"!=this.ScreenObject.Link.LinkCombo.SelectedItem.Parent&&"76"!=this.ScreenObject.Link.LinkCombo.SelectedItem.Parent||null==e.Value||""==e.Value||(t=parseInt(e.Value)),null!=this.ScreenObject.Link.LinkCombo.SelectedItem&&"76"==this.ScreenObject.Link.LinkCombo.SelectedItem.Parent&&(n=!0);var a=new W.a(this,e.Name,parseInt(this.ScreenObject.Link.LinkCombo.SelectedValue),t,n);s.a.page.ShowDialog(a,H.a,{ShowCenter:!s.a.IsMobile});for(var i=0,r=0;r<this.ScreenObject.GridData.length;r++)if(o.e.IsEmpty(this.ScreenObject.GridData[r].ProductID_Key)){i=r;break}this.LineNo=i>0?i:1,this.SetFocusongrid=!0}else this.FillLink(e.Name,parseInt(this.ScreenObject.Link.LinkCombo.SelectedValue),[],[])}},{key:"OnLinkDocumentCheckedChanged",value:function(e){var t=this;if(!this.IsSelectAll){var n=e.item?e.item:e;if(Logger.InfoLog("AddEditDocumentViewModel::Entering OnLinkDocumentCheckedChanged"),n instanceof m.c){if(n.IsChecked){if((this.ScreenObject.Preferences.ContainsKey("SameserialNo")&&""!=this.ScreenObject.Preferences.SameserialNo&&Object(l.j)(this.ScreenObject.Preferences.SameserialNo)||this.ScreenObject.Preferences.ContainsKey("Linksingledoc")&&""!=this.ScreenObject.Preferences.Linksingledoc&&Object(l.j)(this.ScreenObject.Preferences.Linksingledoc))&&this.ScreenObject.GridData.filter((function(e){return e.LinkedInvDocDetailsID>0})).length>0)return this.DisplayMessage=this.ScreenObject.Preferences.ContainsKey("SameserialNo")&&""!=this.ScreenObject.Preferences.SameserialNo&&Object(l.j)(this.ScreenObject.Preferences.SameserialNo)?"Can not select multiple when same Serial No in linking":"Can link only one document",this.IsSelectAll=!0,n.IsChecked=!1,void(this.IsSelectAll=!1);this.DisplayMessage="Linking data please wait.",this.FillLinkDocument(n),this.DisplayMessage="",this.ScreenObject.GridDataObj.refreshDataView()}else{var a=!1,i=this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&55489==e.LinkData}));if(i.length>0&&this.ScreenObject.GridDataColumns.Contains(i[0].SysColumnName))for(var r=this.ScreenObject.GridData.filter((function(e){return e.RefNo=n.Name})),s=0;s<r.length;s++){var c=r[s];if(!o.e.IsEmpty(c[i[0].SysColumnName])&&!o.e.IsEmpty(c.DocDetailsID)&&parseInt(c.DocDetailsID)>0){a=!0;break}}if(this.res="No",confirm("Do you want to unlink "+n.Name+"? (Y/N)"+(a?"\n Barcodes will also be removed.":""))&&(this.res="Yes"),"Yes"!=this.res)return this.IsSelectAll=!0,n.IsChecked=!0,void(this.IsSelectAll=!1);if(null==this.ScreenObject.Link.LinkCombo.SelectedItem||"158"!=this.ScreenObject.Link.LinkCombo.SelectedItem.Parent&&"76"!=this.ScreenObject.Link.LinkCombo.SelectedItem.Parent){if(this.ScreenObject.GridData.filter((function(e){return e.RefNo==n.Name})).forEach((function(e){null!=t.AutoPostViewModel&&(t.AutoPostViewModel.ScreenObject.GridData.filter((function(t){return t.RefSeqNo==e.RefSeqNo})).forEach((function(e){t.AutoPostViewModel.ScreenObject.GridDataObj.removeRow(e)})),t.AutoPostViewModel.CalculateTotals(null,!1)),t.CheckPackingWtVol(e),t.ScreenObject.GridDataObj.removeRow(e)})),this.ScreenObject.Preferences.ContainsKey("LinkAttachments")&&""!=this.ScreenObject.Preferences.LinkAttachments&&Object(l.j)(this.ScreenObject.Preferences.LinkAttachments)){var u=this.ViewAttachments.AttachmentsList.filter((function(e){return!o.e.IsEmpty(e.RefNo)&&e.RefNo==n.Name}));u.length>0&&u.forEach((function(e){t.ViewAttachments.AttachmentsListObj.removeRow(e)}))}}else this.ScreenObject.GridDataColumns.Contains("jobID")&&this.ScreenObject.GridData.filter((function(e){return e.jobID==n.Value})).forEach((function(e){null!=t.AutoPostViewModel&&(t.AutoPostViewModel.ScreenObject.GridData.filter((function(t){return t.RefSeqNo==e.RefSeqNo})).forEach((function(e){t.AutoPostViewModel.ScreenObject.GridDataObj.removeRow(e)})),t.AutoPostViewModel.CalculateTotals(null,!1)),t.ScreenObject.GridDataObj.removeRow(e)}));this.CalculateTotals(null,!1)}this.ScreenObject.UpdateSequence(),this.CheckVendorWiseLinkingPref()}Logger.InfoLog("AddEditDocumentViewModel::Exiting OnLinkDocumentCheckedChanged")}}},{key:"CheckPackingWtVol",value:function(e){var t=this;this.ScreenObject.GridDataColumns.Contains("PackXML")&&!o.e.IsEmpty(e.PackXML)&&function(){var n=new o.f;n.LoadXml(e.PackXML);for(var a=n.SelectNodes("DocExtraXML/Row"),i=function(e){if(null!=a[e].attributes.Label&&!o.e.IsEmpty(a[e].attributes.Label.value)&&null!=a[e].attributes.RefID&&!o.e.IsEmpty(a[e].attributes.RefID.value)){var n=t.DtPack.filter((function(t){return t.Label==a[e].attributes.Label.value})),i=0;n.length>0&&null!=a[e].attributes.Qty&&!o.e.IsEmpty(a[e].attributes.Qty.value)&&(o.e.IsNum(a[e].attributes.Weight.value)&&(i=parseFloat(a[e].attributes.Weight.value)*parseFloat(a[e].attributes.Qty.value),o.e.IsEmpty(n[0].cWeight)||(n[0].cWeight=parseFloat(n[0].cWeight)-i)),o.e.IsNum(a[e].attributes.Volume.value)&&(i=parseFloat(a[e].attributes.Volume.value)*parseFloat(a[e].attributes.Qty.value),o.e.IsEmpty(n[0].cVolume)||(n[0].cVolume=parseFloat(n[0].cVolume)-i)))}},r=0;r<a.length;r++)i(r)}()}},{key:"CheckVendorWiseLinkingPref",value:function(){var e=this;this.ScreenObject.Preferences.ContainsKey("Debit Account")&&Object(l.j)(this.ScreenObject.Preferences["Debit Account"])&&null!=this.ScreenObject.DebitAccount?this.ScreenObject.DebitAccount.Enable=!(this.ScreenObject.DebitAccount.SelectedValue>0&&this.ScreenObject.GridData.filter((function(e){return e.LinkedInvDocDetailsID>0})).length>0):null!=this.ScreenObject.DebitAccount&&(this.ScreenObject.DebitAccount.Enable=!0),this.ScreenObject.Preferences.ContainsKey("Credit Account")&&Object(l.j)(this.ScreenObject.Preferences["Credit Account"])&&null!=this.ScreenObject.CreditAccount?this.ScreenObject.CreditAccount.Enable=!(this.ScreenObject.CreditAccount.SelectedValue>0&&this.ScreenObject.GridData.filter((function(e){return e.LinkedInvDocDetailsID>0})).length>0):null!=this.ScreenObject.CreditAccount&&(this.ScreenObject.CreditAccount.Enable=!0),this.ScreenObject.Preferences.ContainsKey("DimensionWise")&&""!=this.ScreenObject.Preferences.DimensionWise&&this.ScreenObject.Preferences.DimensionWise.split(",").forEach((function(t){if(""!=t){var n=parseInt(t);if(e.ScreenObject.Data.Tables[8].filter((function(e){return e.CCID==n})).length>0)return;for(var a=0;a<e.ScreenObject._CCFields.length;a++){var i=e.ScreenObject._CCFields[a];if(i instanceof C.b&&i.CCID==n){i.Enable=!(i.SelectedValue>0&&e.ScreenObject.GridData.filter((function(e){return e.LinkedInvDocDetailsID>0})).length>0);break}}}}))}},{key:"OLinkSelectionChanged",value:function(e){var t;""!=this.ScreenObject.Link.LinkCombo.SelectedValue?(this.ScreenObject.Link.DocumentList.Visible=!0,this.ScreenObject.Link.VouchersList=null,(t=this.ScreenObject.GetLinkDetails(parseInt(this.ScreenObject.Link.LinkCombo.SelectedValue),this.ScreenObject.DocDate.Date.ToString("dd/MMM/yyyy"),null!=this.ScreenObject.DueDate&&this.ScreenObject.DueDate.Date?this.ScreenObject.DueDate.Date.ToString("dd/MMM/yyyy"):"")).Tables.length>0&&t.Columns[0].Contains("voucherno")&&(this.ScreenObject.Link.VouchersList=t.Tables[0],this.ScreenObject.FillPendingList(!0))):this.ScreenObject.Link.DocumentList.Visible=!1}},{key:"GetReserveAccount",value:function(){switch(this.ScreenObject.DocumentType){case 16:return s.a.SessionManager.ReservedOPAccount.toString();case 17:return s.a.SessionManager.ReservedJVAccount.toString();case 28:return s.a.SessionManager.ReservedCNAccount.toString();case 29:return s.a.SessionManager.ReservedDNAccount.toString()}return""}},{key:"ValidateHeaderSave",value:function(){for(var e=0;e<this.ScreenObject._TextFields.length;e++){var t=this.ScreenObject._TextFields[e];if((t instanceof h.d||t instanceof m.e||t instanceof C.b||t instanceof C.a||t instanceof O.a||t instanceof S.c)&&!this.ValidateDataonSave_Ctrl(t))return!1}for(var n=0;n<this.ScreenObject.HeaderFields.length;n++){var a=this.ScreenObject.HeaderFields[n];if(a instanceof y.c&&!o.e.IsEmpty(a.Lbl)&&this.fldDict.ContainsKey(a.Lbl)&&!this.ValidateDataonSave_Ctrl(a))return!1}for(var i=0;i<this.ScreenObject._CCFields.length;i++){var r=this.ScreenObject._CCFields[i];if(this.fldDict.ContainsKey(r.Lbl)&&(r instanceof C.b||r instanceof p.a||r instanceof C.a)&&!this.ValidateDataonSave_Ctrl(r))return!1}return this.ValidateDataonSave()}},{key:"GetCurrencyID",value:function(e){var t=1;return this.Currency&&!o.e.IsEmpty(this.Currency.Currency.SelectedValue)?t=parseInt(this.Currency.Currency.SelectedValue):this.ScreenObject.GridDataColumns.Contains("CurrencyID")&&!o.e.IsEmpty(this.ScreenObject.GridData[e].CurrencyID_Key)&&(t=parseInt(this.ScreenObject.GridData[e].CurrencyID_Key)),t}},{key:"GetExchRate",value:function(e){var t=1;return this.Currency&&!o.e.IsEmpty(this.Currency.ExchangeRate.Text)?t=parseFloat(this.Currency.ExchangeRate.Text):this.ScreenObject.GridDataColumns.Contains("ExchangeRate")&&!o.e.IsEmpty(this.ScreenObject.GridData[e].ExchangeRate)&&(t=parseFloat(this.ScreenObject.GridData[e].ExchangeRate)),t}},{key:"GetPrimaryColName",value:function(){return this.IsInventoryVoucher?"ProductID_Key":this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")?"CreditAccount_Key":this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")?"DebitAccount_Key":this.ScreenObject.GridDataColumns.Contains("AccountID_Key")?"AccountID_Key":""}},{key:"MandaotryValidation",value:function(e,t){if(0!=this.ScreenObject.ColumnSource[t].CostCenterID&&(!o.e.IsEmpty(this.ScreenObject.ColumnSource[t].ValueMember)&&o.e.IsEmpty(this.ScreenObject.GridData[e][this.ScreenObject.ColumnSource[t].ValueMember])||parseInt(this.ScreenObject.GridData[e][this.ScreenObject.ColumnSource[t].ValueMember])<1))return this.DisplayMessage=s.a.GetResource("Doc_Select")+this.ScreenObject.ColumnSource[t].Header+" "+this.ScreenObject.GridData[e].DocSeqNo.toString(),!1;if("SELECTIONBOX"==this.ScreenObject.ColumnSource[t].DataType&&o.e.IsEmpty(this.ScreenObject.GridData[e][this.ScreenObject.ColumnSource[t].DisplayMember]))return this.DisplayMessage=s.a.GetResource("Doc_Select")+this.ScreenObject.ColumnSource[t].Header+" "+this.ScreenObject.GridData[e].DocSeqNo.toString(),!1;if("ComboBox"==this.ScreenObject.ColumnSource[t].DataType&&o.e.IsEmpty(this.ScreenObject.GridData[e][this.ScreenObject.ColumnSource[t].ValueBinding]))return this.DisplayMessage=s.a.GetResource("Doc_Select")+this.ScreenObject.ColumnSource[t].Header+" "+this.ScreenObject.GridData[e].DocSeqNo.toString(),!1;if("PactComboBox"==this.ScreenObject.ColumnSource[t].DataType&&o.e.IsEmpty(this.ScreenObject.GridData[e][this.ScreenObject.ColumnSource[t].ValueBinding+"_Key"]))return this.DisplayMessage=s.a.GetResource("Doc_Select")+this.ScreenObject.ColumnSource[t].Header+" "+this.ScreenObject.GridData[e].DocSeqNo.toString(),!1;if("LISTBOX"==this.ScreenObject.ColumnSource[t].DataType&&o.e.IsEmpty(this.ScreenObject.GridData[e][this.ScreenObject.ColumnSource[t].ValueMember]))return this.DisplayMessage=s.a.GetResource("Doc_Select")+this.ScreenObject.ColumnSource[t].Header+" "+this.ScreenObject.GridData[e].DocSeqNo.toString(),!1;if("debitamount"==this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase()||"creditamount"==this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase()){if(o.e.IsEmpty(this.ScreenObject.GridData[e].DebitAmount)&&o.e.IsEmpty(this.ScreenObject.GridData[e].CreditAmount)||!o.e.IsEmpty(this.ScreenObject.GridData[e].DebitAmount)&&0==parseFloat(this.ScreenObject.GridData[e].DebitAmount)&&!o.e.IsEmpty(this.ScreenObject.GridData[e].CreditAmount)&&0==parseFloat(this.ScreenObject.GridData[e].CreditAmount))return this.DisplayMessage=s.a.GetResource("Doc_Enter")+this.ScreenObject.ColumnSource[t].Header+" "+this.ScreenObject.GridData[e].DocSeqNo.toString(),!1}else if("LISTBOX"!=this.ScreenObject.ColumnSource[t].DataType&&"PactComboBox"!=this.ScreenObject.ColumnSource[t].DataType&&"ComboBox"!=this.ScreenObject.ColumnSource[t].DataType&&(o.e.IsEmpty(this.ScreenObject.GridData[e][this.ScreenObject.ColumnSource[t].DisplayMember])||"FLOAT"==this.ScreenObject.ColumnSource[t].DataType&&!o.e.IsEmpty(this.ScreenObject.GridData[e][this.ScreenObject.ColumnSource[t].DisplayMember])&&0==parseFloat(this.ScreenObject.GridData[e][this.ScreenObject.ColumnSource[t].DisplayMember])))return this.DisplayMessage=s.a.GetResource("Doc_Enter")+this.ScreenObject.ColumnSource[t].Header+" "+this.ScreenObject.GridData[e].DocSeqNo.toString(),!1;return!0}},{key:"SaveAccountingDocument",value:function(e){this.IgnoreOnSave.Clear(),this.ButtonsEnabled&&(this.ScreenObject.DocID>0&&this.IsUserLock?this.DisplayMessage="Document is Locked":(this.ButtonsEnabled=!1,this.SaveAccountingDocument_Validate(e,!0)||(this.ButtonsEnabled=!0)))}},{key:"SaveAccountingDocument_Validate",value:function(e,t){var n=this;if(!(null==e||"Approve"==e.toString()||"ApproveandPrint"==e.toString()||"NoWorkFlow"==e.toString()||"NoWorkFlowprint"==e.toString()||this.ButtonRevise.Visible&&"Revise"==e.toString()||this.ButtonSave.Visible&&this.ButtonSave.Enable))return!1;if(this.ScreenObject.Preferences.ContainsKey("NoWorkflowPostedDocs")&&""!=this.ScreenObject.Preferences.NoWorkflowPostedDocs&&Object(l.j)(this.ScreenObject.Preferences.NoWorkflowPostedDocs)&&369==this.StatusID&&"Save"==e.toString()&&(e="NoWorkFlow"),0!=this.ScreenObject.RefNodeID&&429==this.StatusID)return this.DisplayMessage=s.a.GetResource("RefDocument"),!1;if(0!=this.ScreenObject.RefNodeID&&86!=this.ScreenObject.RefCCId&&73!=this.ScreenObject.RefCCId&&89!=this.ScreenObject.RefCCId&&!this.ScreenObject.IsRefLCTR&&!s.a.SessionManager.IsActionAssigned(43,"Edit Reference Documents"))return this.DisplayMessage=s.a.GetResource("RefDocument"),!1;if(this.ScreenObject.Preferences.ContainsKey("LineWisePDC")&&""!=this.ScreenObject.Preferences.LineWisePDC&&Object(l.j)(this.ScreenObject.Preferences.LineWisePDC)&&this.PDCSCleared)return this.DisplayMessage="One or more pdc converted document can not be edited",!1;if(t&&this.ScreenObject.Preferences.ContainsKey("MadatoryAttachments")&&""!=this.ScreenObject.Preferences.MadatoryAttachments&&Object(l.j)(this.ScreenObject.Preferences.MadatoryAttachments)&&(null==this.ViewAttachments||0==this.ViewAttachments.AttachmentsList.length))return this.DisplayMessage="No Attachments added.",!1;if(this.ScreenObject.IsBouncedorPdcPosted&&(!this.ScreenObject.Preferences.ContainsKey("LineWisePDC")||""==this.ScreenObject.Preferences.LineWisePDC||!Object(l.j)(this.ScreenObject.Preferences.LineWisePDC)))return this.DisplayMessage=this.ScreenObject.BouncedorPdcMessage,!1;if(439==this.StatusID)return this.DisplayMessage="Discounted PDC can not be changed",!1;Logger.InfoLog("AddEditDocumentViewModel::Entering SaveInventoryDocument");try{this.ScreenObject.Preferences.ContainsKey("DonotupdateAccounts")&&""!=this.ScreenObject.Preferences.DonotupdateAccounts&&Object(l.j)(this.ScreenObject.Preferences.DonotupdateAccounts);var a=this.GetReserveAccount(),i=0,r=0,c=0,u=0,d=!1;if(this.FillHeaderDictionary(),t&&!this.ValidateHeaderSave())return!1;t&&this.FillCreatedByDate(e.toString());var D={message:""};if(this.ScreenObject.GenerateQuery(D,!1,this.DocumentDate,!0),""!=D.message)return this.DisplayMessage=D.message,!1;this.BodyVisible&&!this.ReadOnlyBody||this.CheckEmptyGrid();var S,m,b,y,p="",g="",f=0;p+="<DocumentXML",null!=e&&"Revise"==e&&(p+=' IsRevision="1"',p+=' ReviseReason="'+this.ReviseReason+'"'),p+=">";for(var O=this.GetPrimaryColName(),I=0;I<this.ScreenObject.GridData.length;I++)if(o.e.IsEmpty(this.ScreenObject.GridData[I][O])){if(t&&!this.ScreenObject.GridDataColumns.Contains("FieldType"))for(var T=void 0,j=0;j<this.ScreenObject.ColumnSource.length;j++)if((T=this.ScreenObject.ColumnSource[j]).IsVisible&&"DocSeqNo"!=T.DisplayMember&&(("INT"==T.DataType||"FLOAT"==T.DataType)&&0!=o.e.Double(this.ScreenObject.GridData[I][T.DisplayMember])||"LISTBOX"==T.DataType&&o.e.Int(this.ScreenObject.GridData[I][T.ValueMember])>0||("SELECTIONBOX"==T.DataType||"String"==T.DataType||"TextBlock"==T.DataType||"TEXT"==T.DataType)&&!o.e.IsEmpty(this.ScreenObject.GridData[I][T.DisplayMember])||("DATE"==T.DataType||"DATETIME"==T.DataType)&&!o.e.IsEmpty(this.ScreenObject.GridData[I][T.DisplayMember+"_Key"])))return this.DisplayMessage="Account not selected at row no."+this.ScreenObject.GridData[I].DocSeqNo.toString(),!1}else{f++,g="",p+="<Row>",g+="<AccountsXML>",S="",m="",b="",y="",S+="<Transactions ",m+='<Numeric Query="',y+='<CostCenters Query="',b+='<Alpha Query="';for(var P=0;P<this.ScreenObject.ColumnSource.length;P++){var A=this.GetCurrencyID(I),M=this.GetExchRate(I);if(!(this.ScreenObject.ColumnSource[P].DisplayMember.toLowerCase().Contains("exchangerate")||this.ScreenObject.ColumnSource[P].DisplayMember.toLowerCase().Contains("currencyid")||this.ScreenObject.ColumnSource[P].CostCenterID>0&&this.ScreenObject.ColumnSource[P].DisplayMember.endsWith("Code"))){if(this.ScreenObject.ColumnSource[P].Mandatory&&!this.MandaotryValidation(I,P))return!1;if(!this.ValidateDataonSave_col_dr(this.ScreenObject.ColumnSource[P],this.ScreenObject.GridData[I]))return!1;if(this.ScreenObject.ColumnSource[P].IsColumnUserDefined){if(this.ScreenObject.ColumnSource[P].DisplayMember.toLowerCase().Contains("dccurrid")||this.ScreenObject.ColumnSource[P].DisplayMember.toLowerCase().Contains("dcexchrt"))continue;if(this.ScreenObject.ColumnSource[P].DisplayMember.toLowerCase().Contains("dcnum")){if(s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])){var v=!1,G=this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&50403==e.LinkData}));if(G.length>0&&this.ScreenObject.ColumnSource[P].DisplayMember==G[0].SysColumnName){var N,E=0;if((N=o.e.Int(s.a.SessionManager.Preferences.DimensionwiseCurrency))>5e4&&(this.ScreenObject.Preferences.ContainsKey("UseasCrossDimension")&&"true"==this.ScreenObject.Preferences.UseasCrossDimension.toLowerCase()&&s.a.SessionManager.Preferences.ContainsKey("CrossDimension")&&""!=s.a.SessionManager.Preferences.CrossDimension.toString()&&o.e.IsNum(s.a.SessionManager.Preferences.CrossDimension)&&(E=parseInt(s.a.SessionManager.Preferences.CrossDimension)),E==N&&(v=!0,this.ScreenObject.Preferences.ContainsKey("CrossDimField")&&o.e.IsNum(this.ScreenObject.Preferences.CrossDimField)))){var w=this.ScreenObject._TextFields.find((function(e){return e.DBColumnID==parseInt(n.ScreenObject.Preferences.CrossDimField)}));w&&w instanceof C.b&&w.SelectedValue>0&&(A=this.ScreenObject.GetCurrency(w.SelectedValue,w.CCID),M=1)}}v||("-2"==this.ScreenObject.ColumnSource[P].DefaultValue?(o.e.IsEmpty(this.ScreenObject.GridData[I]["dcCurrID"+this.ScreenObject.ColumnSource[P].DisplayMember.toLowerCase().replace("dcnum","")+"_Key"])||(A=parseInt(this.ScreenObject.GridData[I]["dcCurrID"+this.ScreenObject.ColumnSource[P].DisplayMember.toLowerCase().replace("dcnum","")+"_Key"])),o.e.IsEmpty(this.ScreenObject.GridData[I]["dcExchRT"+this.ScreenObject.ColumnSource[P].DisplayMember.toLowerCase().replace("dcnum","")])||(M=parseFloat(this.ScreenObject.GridData[I]["dcExchRT"+this.ScreenObject.ColumnSource[P].DisplayMember.toLowerCase().replace("dcnum","")]))):o.e.Int(this.ScreenObject.ColumnSource[P].DefaultValue)>0&&this.ScreenObject.ColumnSource[P].CurrID>0&&(A=this.ScreenObject.ColumnSource[P].CurrID,M=this.ScreenObject.ColumnSource[P].ExhcgRt))}var F;o.e.IsEmpty(this.ScreenObject.GridData[I][this.ScreenObject.ColumnSource[P].DisplayMember])?m+=this.ScreenObject.ColumnSource[P].DisplayMember+"=0, ":m+=this.ScreenObject.ColumnSource[P].DisplayMember+"="+this.ScreenObject.GridData[I][this.ScreenObject.ColumnSource[P].DisplayMember].toString()+", ",F=o.e.Double(this.ScreenObject.GridData[I]["dcCalc"+this.ScreenObject.ColumnSource[P].DisplayMember]),s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&(m+="dcCurrID"+this.ScreenObject.ColumnSource[P].DisplayMember.toLowerCase().replace("dcnum","")+"="+A+", ",m+="dcExchRT"+this.ScreenObject.ColumnSource[P].DisplayMember.toLowerCase().replace("dcnum","")+"="+M+", ",m+="dcCalcNumFC"+this.ScreenObject.ColumnSource[P].DisplayMember.toLowerCase().replace("dcnum","")+"="+F+", "),m+="dcCalc"+this.ScreenObject.ColumnSource[P].DisplayMember.replace("dc","")+"="+F*M+", ";var V="";if(this.ScreenObject.ColumnSource[P].DisplayMember.toLowerCase().Contains("dcnum")&&!o.e.IsEmpty(this.ScreenObject.GridData[I]["dcCalc"+this.ScreenObject.ColumnSource[P].DisplayMember])&&(V=this.ScreenObject.GridData[I]["dcCalc"+this.ScreenObject.ColumnSource[P].DisplayMember].toString()),(3==this.ScreenObject.ColumnSource[P].PostingType||4==this.ScreenObject.ColumnSource[P].PostingType)&&""!=V&&o.e.IsNum(V)&&0!=parseFloat(V)){var L=0,R=0,B="",x={DBAcc:L,CrACC:R,PostingXml:B};if(!this.FillAccountPosting(this.ScreenObject.ColumnSource[P],this.ScreenObject.GridData[I],V,A,M,x,""!=a?parseInt(a):0))return!1;L=x.DBAcc,R=x.CrACC,B=x.PostingXml,16!=this.ScreenObject.DocumentType&&17!=this.ScreenObject.DocumentType&&28!=this.ScreenObject.DocumentType&&29!=this.ScreenObject.DocumentType||(R==parseInt(a)&&L>0?i+=parseFloat(V)*M:L==parseInt(a)&&R>0&&(r+=parseFloat(V)*M)),g+=B}}else if("Name"==this.ScreenObject.ColumnSource[P].DisplayMember||"Year"==this.ScreenObject.ColumnSource[P].DisplayMember||this.ScreenObject.ColumnSource[P].DisplayMember.toLowerCase().Contains("dcalpha")){var k={sbText:b};this.GetRowValue(k,I,P),b=k.sbText}else 0!=this.ScreenObject.ColumnSource[P].CostCenterID?!o.e.IsEmpty(this.ScreenObject.GridData[I][this.ScreenObject.ColumnSource[P].ValueMember])&&parseInt(this.ScreenObject.GridData[I][this.ScreenObject.ColumnSource[P].ValueMember])>0?"batchid"==this.ScreenObject.ColumnSource[P].DisplayMember.toLowerCase()?S+='BatchID="'+this.ScreenObject.GridData[I][this.ScreenObject.ColumnSource[P].ValueMember].toString()+'" ':y+=this.ScreenObject.ColumnSource[P].DisplayMember+"="+this.ScreenObject.GridData[I][this.ScreenObject.ColumnSource[P].ValueMember].toString()+", ":"batchid"==this.ScreenObject.ColumnSource[P].DisplayMember.toLowerCase()?S+='BatchID="1" ':y+=this.ScreenObject.ColumnSource[P].DisplayMember+"=1, ":b+=this.ScreenObject.ColumnSource[P].DisplayMember+"=N'"+h.d.GetValidTextXml(this.ScreenObject.GridData[I][this.ScreenObject.ColumnSource[P].DisplayMember].toString())+"', "}else if(16!=this.ScreenObject.DocumentType&&17!=this.ScreenObject.DocumentType&&28!=this.ScreenObject.DocumentType&&29!=this.ScreenObject.DocumentType||"AccountID_Key"!=this.ScreenObject.ColumnSource[P].ValueMember&&"DebitAmount"!=this.ScreenObject.ColumnSource[P].DisplayMember&&"CreditAmount"!=this.ScreenObject.ColumnSource[P].DisplayMember){if("DebitAccount_Key"==this.ScreenObject.ColumnSource[P].ValueMember||"CreditAccount_Key"==this.ScreenObject.ColumnSource[P].ValueMember)continue;if("SELECTIONBOX"==this.ScreenObject.ColumnSource[P].DataType)S+=this.ScreenObject.ColumnSource[P].DisplayMember+'="'+this.ScreenObject.GridData[I][this.ScreenObject.ColumnSource[P].DisplayMember].toString()+'" ';else if("Amount"==this.ScreenObject.ColumnSource[P].DisplayMember){var _="",K="";null!=this.ScreenObject.DebitAccount?_=this.ScreenObject.DebitAccount.SelectedValue.toString():this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[I].DebitAccount_Key)&&(_=this.ScreenObject.GridData[I].DebitAccount_Key.toString()),null!=this.ScreenObject.CreditAccount?K=this.ScreenObject.CreditAccount.SelectedValue.toString():this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[I].CreditAccount_Key)&&(K=this.ScreenObject.GridData[I].CreditAccount_Key.toString()),null!=e&&"Bounce"==e.toString()?S+=this.ScreenObject.GetAccountTransaction(K,_,this.ScreenObject.GridData[I][this.ScreenObject.ColumnSource[P].DisplayMember].toString(),A,M,this.ScreenObject.ColumnSource[P].DecimalPoints):S+=this.ScreenObject.GetAccountTransaction(_,K,this.ScreenObject.GridData[I][this.ScreenObject.ColumnSource[P].DisplayMember].toString(),A,M,this.ScreenObject.ColumnSource[P].DecimalPoints)}else 0!=this.ScreenObject.ColumnSource[P].CostCenterID?!o.e.IsEmpty(this.ScreenObject.GridData[I][this.ScreenObject.ColumnSource[P].ValueMember])&&parseInt(this.ScreenObject.GridData[I][this.ScreenObject.ColumnSource[P].ValueMember])>0&&(S+=this.ScreenObject.ColumnSource[P].DisplayMember+'="'+this.ScreenObject.GridData[I][this.ScreenObject.ColumnSource[P].ValueMember].toString()+'" '):"DATE"==this.ScreenObject.ColumnSource[P].DataType?o.e.IsEmpty(this.ScreenObject.GridData[I][this.ScreenObject.ColumnSource[P].DisplayMember+"_Key"])||(S+=this.ScreenObject.ColumnSource[P].DisplayMember+'="'+new Date(this.ScreenObject.GridData[I][this.ScreenObject.ColumnSource[P].DisplayMember+"_Key"]).ToString("dd/MMM/yyyy")+'" '):"datetime"==this.ScreenObject.ColumnSource[P].DataType.toLowerCase()||"time"==this.ScreenObject.ColumnSource[P].DataType.toLowerCase()?o.e.IsEmpty(this.ScreenObject.GridData[I][this.ScreenObject.ColumnSource[P].DisplayMember+"_Key"])||(S+=this.ScreenObject.ColumnSource[P].DisplayMember+'="'+new Date(this.ScreenObject.GridData[I][this.ScreenObject.ColumnSource[P].DisplayMember+"_Key"]).ToString("dd/MMM/yyyy hh:mm:ss a")+'" '):"ComboBox"==this.ScreenObject.ColumnSource[P].DataType?o.e.IsEmpty(this.ScreenObject.GridData[I][this.ScreenObject.ColumnSource[P].ValueBinding])||(S+=this.ScreenObject.ColumnSource[P].ValueBinding+'="'+this.ScreenObject.GridData[I][this.ScreenObject.ColumnSource[P].ValueBinding].toString()+'" '):"DocSeqNo"==this.ScreenObject.ColumnSource[P].DisplayMember?S+='DocSeqNo="'+f+'" ':null!=e&&"Bounce"==e.toString()?S+=this.ScreenObject.ColumnSource[P].DisplayMember+'="0" ':S+=this.ScreenObject.ColumnSource[P].DisplayMember+'="'+h.d.GetValidXml(this.ScreenObject.GridData[I][this.ScreenObject.ColumnSource[P].DisplayMember])+'" '}else{if("AccountID_Key"==this.ScreenObject.ColumnSource[P].ValueMember){if(o.e.IsEmpty(this.ScreenObject.GridData[I].AccountID_Key))return this.DisplayMessage=this.ScreenObject.DebitAccount.Label+"Required",!1;continue}o.e.IsEmpty(this.ScreenObject.GridData[I][this.ScreenObject.ColumnSource[P].DisplayMember])||"CreditAmount"!=this.ScreenObject.ColumnSource[P].DisplayMember||0==parseFloat(this.ScreenObject.GridData[I][this.ScreenObject.ColumnSource[P].DisplayMember])?o.e.IsEmpty(this.ScreenObject.GridData[I][this.ScreenObject.ColumnSource[P].DisplayMember])||"DebitAmount"!=this.ScreenObject.ColumnSource[P].DisplayMember||0==parseFloat(this.ScreenObject.GridData[I][this.ScreenObject.ColumnSource[P].DisplayMember])||(S+=this.ScreenObject.GetAccountTransaction(this.ScreenObject.GridData[I].AccountID_Key.toString(),a,this.ScreenObject.GridData[I][this.ScreenObject.ColumnSource[P].DisplayMember].toString(),A,M,this.ScreenObject.ColumnSource[P].DecimalPoints),i+=parseFloat(this.ScreenObject.GridData[I][this.ScreenObject.ColumnSource[P].DisplayMember])*M):(S+=this.ScreenObject.GetAccountTransaction(a,this.ScreenObject.GridData[I].AccountID_Key.toString(),this.ScreenObject.GridData[I][this.ScreenObject.ColumnSource[P].DisplayMember].toString(),A,M,this.ScreenObject.ColumnSource[P].DecimalPoints),r+=parseFloat(this.ScreenObject.GridData[I][this.ScreenObject.ColumnSource[P].DisplayMember])*M)}}}if(this.IsLockDimsLineWise){var Q={join:""};S+=' LockDims="'+this.GetLockQuery(this.ScreenObject.GridData[I],Q)+'" ',""!=Q.join&&(S+=' LockDimsjoin="'+Q.join+'" ')}if(null!=this.GetButton("Pre Payments")&&null!=this.pdcGCVM&&this.pdcGCVM.IsDataSaved&&1==f){if(!this.pdcGCVM.Validate(this.ScreenObject.GridData[I].Amount.toString()))return!1;S+=' Description="'+this.pdcGCVM.GetXML()+'" '}this.ScreenObject.GridDataColumns.Contains("oppdc")&&!o.e.IsEmpty(this.ScreenObject.GridData[I].oppdc)&&(S+=' PostPDC="1" '),this.ScreenObject.GridDataColumns.Contains("FieldType")&&(m+=this.GetpayModesNumericData(I)),S+=this.ScreenObject.strStaticFields+" ></Transactions>",m+=this.ScreenObject.strnumericFields+'" ></Numeric>',b+=this.ScreenObject.strTextFields+'" ></Alpha>',!s.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")||"True"!=s.a.SessionManager.Preferences.EnableDivisionWise.toString()||y.toString().Contains("dcCCNID1=")||this.ScreenObject.strCCFields.Contains("dcCCNID1=")||(this.ScreenObject.DivisionID>0?y+=" dcCCNID1="+this.ScreenObject.DivisionID.toString()+", ":s.a.SessionManager.DivisionID>0&&(y+=" dcCCNID1="+s.a.SessionManager.DivisionID.toString()+", ")),!s.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")||"True"!=s.a.SessionManager.Preferences.EnableLocationWise.toString()||y.toString().Contains("dcCCNID2=")||this.ScreenObject.strCCFields.Contains("dcCCNID2=")||(this.ScreenObject.LocationID>0?y+=" dcCCNID2="+this.ScreenObject.LocationID.toString()+", ":s.a.SessionManager.LocationID>0&&(y+=" dcCCNID2="+s.a.SessionManager.LocationID.toString()+", ")),s.a.SessionManager.Preferences.ContainsKey("Dimension List")&&s.a.SessionManager.RegisterCCID>0&&this.ScreenObject.RegisterNodeID>0&&!y.toString().Contains("dcCCNID"+(s.a.SessionManager.RegisterCCID-5e4).toString()+"=")&&!this.ScreenObject.strCCFields.Contains("dcCCNID"+(s.a.SessionManager.RegisterCCID-5e4).toString()+"=")&&this.ScreenObject.RegisterNodeID>0&&(y+=" dcCCNID"+(s.a.SessionManager.RegisterCCID-5e4).toString()+"="+this.ScreenObject.RegisterNodeID.toString()+", "),y+=this.ScreenObject.strCCFields+'" ></CostCenters>',g+="</AccountsXML>",c=0,u=0;var H=!1;if(this.ScreenObject.Preferences.ContainsKey("LineWisePDC")&&Object(l.j)(this.ScreenObject.Preferences.LineWisePDC)&&this.ScreenObject.GridDataColumns.Contains("RefStatusID")&&!o.e.IsEmpty(this.ScreenObject.GridData[I].RefStatusID)&&370!=parseInt(this.ScreenObject.GridData[I].RefStatusID)&&!o.e.IsEmpty(this.ScreenObject.GridData[I].DocDetailsID)&&parseInt(this.ScreenObject.GridData[I].DocDetailsID)>0&&(H=!0),s.a.SessionManager.Preferences.ContainsKey("On")&&"True"!=s.a.SessionManager.Preferences.On&&(H=!0),o.e.IsEmpty(this.ScreenObject.GridData[I].Type)||1!=Object(l.j)(this.ScreenObject.GridData[I].Type)||H)this.ScreenObject.GridData[I].ExtraXML="";else{var W="";if(this.ScreenObject.GridDataColumns.Contains("Amount")&&(W="Amount"),18==this.ScreenObject.DocumentType||19==this.ScreenObject.DocumentType||21==this.ScreenObject.DocumentType||22==this.ScreenObject.DocumentType?this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[I].CreditAccount_Key)&&(u=parseInt(this.ScreenObject.GridData[I].CreditAccount_Key),d=!0):14==this.ScreenObject.DocumentType||15==this.ScreenObject.DocumentType||20==this.ScreenObject.DocumentType||23==this.ScreenObject.DocumentType?this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[I].DebitAccount_Key)&&(u=parseInt(this.ScreenObject.GridData[I].DebitAccount_Key),d=!1):this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[I].AccountID_Key)&&(u=parseInt(this.ScreenObject.GridData[I].AccountID_Key),this.ScreenObject.GridDataColumns.Contains("CreditAmount")&&!o.e.IsEmpty(this.ScreenObject.GridData[I].CreditAmount)&&parseFloat(this.ScreenObject.GridData[I].CreditAmount)>0&&(d=!0,W="CreditAmount"),this.ScreenObject.GridDataColumns.Contains("DebitAmount")&&!o.e.IsEmpty(this.ScreenObject.GridData[I].DebitAmount)&&parseFloat(this.ScreenObject.GridData[I].DebitAmount)>0&&(W="DebitAmount",d=!1)),""!=W&&0!=o.e.Double(this.ScreenObject.GridData[I][W])){parseFloat(this.ScreenObject.GridData[I][W])<0&&(d=!d);var q=new o.f;o.e.IsEmpty(this.ScreenObject.GridData[I].ExtraXML)||q.LoadXml(this.ScreenObject.GridData[I].ExtraXML);for(var Y=q.SelectNodes("/BillWise/Row"),z=0,J=!1,Z=0;Z<Y.length;Z++){if(""==Y[Z].attributes.AccountID.value||""!=Y[Z].attributes.AccountID.value&&parseInt(Y[Z].attributes.AccountID.value)!=u)return this.DisplayMessage="Invalid BillWise Details at Row No."+this.ScreenObject.GridData[I].DocSeqNo.toString(),!1;""!=Y[Z].attributes.AdjAmount.value&&(z+=parseFloat(Y[Z].attributes.AdjAmount.value.replace("-",""))),Y[Z].attributes.AdjAmount.value.Contains("-")&&(J=!0)}if(null!=(Y=q.SelectNodes("BillWise/Row/AccountsXML")))for(var $=0;$<Y.length;$++)null!=Y[$].attributes.Amount&&""!=Y[$].attributes.Amount.value&&(d&&null!=Y[$].attributes.DebitAccount&&""!=Y[$].attributes.DebitAccount.value&&parseInt(Y[$].attributes.DebitAccount.value)==u||!d&&null!=Y[$].attributes.CreditAccount&&""!=Y[$].attributes.CreditAccount.value&&parseInt(Y[$].attributes.CreditAccount.value)==u?z+=parseFloat(Y[$].attributes.Amount.value.replace("-","")):z-=parseFloat(Y[$].attributes.Amount.value.replace("-","")));q.LoadXml(g),Y=q.SelectNodes("AccountsXML/Accounts");var ee=this.GetExchRate(I);c=this.ScreenObject.Preferences.ContainsKey("DecimalsBillWise")&&""!=this.ScreenObject.Preferences.DecimalsBillWise&&o.e.Int(this.ScreenObject.Preferences.DecimalsBillWise)>0?parseFloat((parseFloat(this.ScreenObject.GridData[I][W].toString().replace("-",""))*ee).ToString("N"+this.ScreenObject.Preferences.DecimalsBillWise)):s.a.SessionManager.Preferences.ContainsKey("DecimalsinAmount")?parseFloat((parseFloat(this.ScreenObject.GridData[I][W].toString().replace("-",""))*ee).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount)):parseFloat(this.ScreenObject.GridData[I][W].toString().replace("-",""))*ee;for(var te=0;te<Y.length;te++)null!=Y[te].attributes.DebitAccount&&""!=Y[te].attributes.DebitAccount.value&&parseInt(Y[te].attributes.DebitAccount.value)==u&&null!=Y[te].attributes.Amount&&""!=Y[te].attributes.Amount.value?d?c-=parseFloat(Y[te].attributes.Amount.value):c+=parseFloat(Y[te].attributes.Amount.value):null!=Y[te].attributes.CreditAccount&&""!=Y[te].attributes.CreditAccount.value&&parseInt(Y[te].attributes.CreditAccount.value)==u&&null!=Y[te].attributes.Amount&&""!=Y[te].attributes.Amount.value&&(d?c+=parseFloat(Y[te].attributes.Amount.value):c-=parseFloat(Y[te].attributes.Amount.value));if(!o.e.IsEmpty(this.ScreenObject.GridData[I][W])&&Math.abs(c-z)>.5)return this.DisplayMessage=s.a.GetResource("Doc_BillWiseMisMatch")+" "+this.ScreenObject.GridData[I].DocSeqNo.toString(),!1;if(d&&!J||!d&&J)return this.DisplayMessage=s.a.GetResource("Doc_BillWiseMisMatch")+" "+this.ScreenObject.GridData[I].DocSeqNo.toString(),!1}}if(18==this.ScreenObject.DocumentType||19==this.ScreenObject.DocumentType||21==this.ScreenObject.DocumentType||22==this.ScreenObject.DocumentType){if(null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.SelectedValue>0){if(this.CheckAccountBalance(this.ScreenObject.DebitAccount.SelectedValue,this.GridNetTotal,!1))return!1}else if(this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[I].DebitAccount_Key)){var ne=new o.f;ne.LoadXml(g);var ae=ne.SelectNodes("AccountsXML/Accounts");c=parseFloat(this.ScreenObject.GridData[I].Amount)*this.GetExchRate(I);for(var ie=0;ie<ae.length;ie++)null!=ae[ie].attributes.DebitAccount&&""!=ae[ie].attributes.DebitAccount.value&&parseInt(ae[ie].attributes.DebitAccount.value)==parseInt(this.ScreenObject.GridData[I].DebitAccount_Key)&&null!=ae[ie].attributes.Amount&&""!=ae[ie].attributes.Amount.value?c+=parseFloat(ae[ie].attributes.Amount.value):null!=ae[ie].attributes.CreditAccount&&""!=ae[ie].attributes.CreditAccount.value&&parseInt(ae[ie].attributes.CreditAccount.value)==parseInt(this.ScreenObject.GridData[I].DebitAccount_Key)&&null!=ae[ie].attributes.Amount&&""!=ae[ie].attributes.Amount.value&&(c-=parseFloat(ae[ie].attributes.Amount.value));if(this.CheckAccountBalance(parseInt(this.ScreenObject.GridData[I].DebitAccount_Key),c,!1))return null!=this.DisplayMessage&&""!=this.DisplayMessage||(this.DisplayMessage="Balance goes -ve for "+this.ScreenObject.GridData[I].CreditAccount.toString()+"at row no:"+this.ScreenObject.GridData[I].DocSeqNo.toString()),!1}}else if(14==this.ScreenObject.DocumentType||15==this.ScreenObject.DocumentType||20==this.ScreenObject.DocumentType||23==this.ScreenObject.DocumentType){if(null!=this.ScreenObject.CreditAccount&&this.ScreenObject.CreditAccount.SelectedValue>0){if(this.DisplayMessage="",this.CheckAccountBalance(this.ScreenObject.CreditAccount.SelectedValue,this.GridNetTotal,!0))return""==this.DisplayMessage&&(this.DisplayMessage="Balance goes -ve for ",this.DisplayMessage+=""!=this.ScreenObject.CreditAccount.Text?this.ScreenObject.CreditAccount.Text:"pament mode"),!1}else if(this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[I].CreditAccount_Key)){var re=new o.f;re.LoadXml(g);var se=re.SelectNodes("AccountsXML/Accounts");c=parseFloat(this.ScreenObject.GridData[I].Amount)*this.GetExchRate(I);for(var oe=0;oe<se.length;oe++)null!=se[oe].attributes.CreditAccount&&""!=se[oe].attributes.CreditAccount.value&&parseInt(se[oe].attributes.CreditAccount.value)==parseInt(this.ScreenObject.GridData[I].CreditAccount_Key)&&null!=se[oe].attributes.Amount&&""!=se[oe].attributes.Amount.value?c+=parseFloat(se[oe].attributes.Amount.value):null!=se[oe].attributes.DebitAccount&&""!=se[oe].attributes.DebitAccount.value&&parseInt(se[oe].attributes.DebitAccount.value)==parseInt(this.ScreenObject.GridData[I].CreditAccount_Key)&&null!=se[oe].attributes.Amount&&""!=se[oe].attributes.Amount.value&&(c-=parseFloat(se[oe].attributes.Amount.value));if(this.CheckAccountBalance(parseInt(this.ScreenObject.GridData[I].CreditAccount_Key),c,!0))return null!=this.DisplayMessage&&""!=this.DisplayMessage||(this.DisplayMessage="Balance goes -ve for "+this.ScreenObject.GridData[I].CreditAccount.toString()+"at row no:"+this.ScreenObject.GridData[I].DocSeqNo.toString()),!1}}else if(s.a.SessionManager.Preferences.ContainsKey("DontSaveCahsBankBalanceNegative")&&""!=s.a.SessionManager.Preferences.DontSaveCahsBankBalanceNegative&&Object(l.j)(s.a.SessionManager.Preferences.DontSaveCahsBankBalanceNegative)&&this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[I].AccountID_Key))if(this.ScreenObject.GridDataColumns.Contains("DebitAmount")&&!o.e.IsEmpty(this.ScreenObject.GridData[I].DebitAmount)&&parseFloat(this.ScreenObject.GridData[I].DebitAmount)>0){if(this.CheckAccountBalance(parseInt(this.ScreenObject.GridData[I].AccountID_Key),parseFloat(this.ScreenObject.GridData[I].DebitAmount),!1))return null!=this.DisplayMessage&&""!=this.DisplayMessage||!this.ScreenObject.GridDataColumns.Contains("AccountName")?null!=this.DisplayMessage&&""!=this.DisplayMessage||!this.ScreenObject.GridDataColumns.Contains("Accountcode")||(this.DisplayMessage="Balance goes -ve for "+this.ScreenObject.GridData[I].Accountcode.toString()+"at row no:"+this.ScreenObject.GridData[I].DocSeqNo.toString()):this.DisplayMessage="Balance goes -ve for "+this.ScreenObject.GridData[I].AccountName.toString()+"at row no:"+this.ScreenObject.GridData[I].DocSeqNo.toString(),!1}else if(this.ScreenObject.GridDataColumns.Contains("CreditAmount")&&!o.e.IsEmpty(this.ScreenObject.GridData[I].CreditAmount)&&parseFloat(this.ScreenObject.GridData[I].CreditAmount)>0&&this.CheckAccountBalance(parseInt(this.ScreenObject.GridData[I].AccountID_Key),parseFloat(this.ScreenObject.GridData[I].CreditAmount),!0))return null!=this.DisplayMessage&&""!=this.DisplayMessage||!this.ScreenObject.GridDataColumns.Contains("AccountName")?null!=this.DisplayMessage&&""!=this.DisplayMessage||!this.ScreenObject.GridDataColumns.Contains("Accountcode")||(this.DisplayMessage="Balance goes -ve for "+this.ScreenObject.GridData[I].Accountcode.toString()+"at row no:"+this.ScreenObject.GridData[I].DocSeqNo.toString()):this.DisplayMessage="Balance goes -ve for "+this.ScreenObject.GridData[I].AccountName.toString()+"at row no:"+this.ScreenObject.GridData[I].DocSeqNo.toString(),!1;if(p+=g.toString(),null!=e&&"Bounce"==e.toString())18==this.ScreenObject.DocumentType&&this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[I].CreditAccount_Key)?this.IsAccBillWise(parseInt(this.ScreenObject.GridData[I].CreditAccount_Key))?p+=S.toString()+m.toString()+b.toString()+y.toString()+"<EXTRAXML>"+this.BillXMLBounce(this.ScreenObject.GridData[I].CreditAccount_Key.toString(),this.ScreenObject.GridData[I].Amount.toString(),!1)+"</EXTRAXML>":p+=S.toString()+m.toString()+b.toString()+y.toString()+"<EXTRAXML> </EXTRAXML>":15==this.ScreenObject.DocumentType&&this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[I].DebitAccount_Key)&&this.IsAccBillWise(parseInt(this.ScreenObject.GridData[I].DebitAccount_Key))?p+=S.toString()+m.toString()+b.toString()+y.toString()+"<EXTRAXML>"+this.BillXMLBounce(this.ScreenObject.GridData[I].DebitAccount_Key.toString(),this.ScreenObject.GridData[I].Amount.toString(),!0)+"</EXTRAXML>":p+=S.toString()+m.toString()+b.toString()+y.toString()+"<EXTRAXML> </EXTRAXML>";else if(p+=S.toString()+m.toString()+b.toString()+y.toString()+"<EXTRAXML>"+this.ScreenObject.GridData[I].ExtraXML.toString()+"</EXTRAXML>",o.e.IsEmpty(this.ScreenObject.GridData[I].DiscXML)||(p+=this.ScreenObject.GridData[I].DiscXML.toString()),o.e.IsEmpty(this.ScreenObject.GridData[I].ReturnXML)||(p+="<ReturnXML>"+this.ScreenObject.GridData[I].ReturnXML.toString()+"</ReturnXML>"),this.ScreenObject.GridDataColumns.Contains("DenominationsXML")&&!o.e.IsEmpty(this.ScreenObject.GridData[I].DenominationsXML)&&(p+="<PosPayModes>"+this.ScreenObject.GridData[I].DenominationsXML.toString()+"</PosPayModes>"),null!=this.GetButton("Pre Payments")&&this.pdcGCVM&&this.pdcGCVM.IsDataSaved&&1==f){if(this.ScreenObject.Preferences.ContainsKey("Prepaymentdate")&&"True"==this.ScreenObject.Preferences.Prepaymentdate&&this.pdcGCVM.CheqStartDate.Date<this.DocumentDate)return this.DisplayMessage="Pre Payments Start date can not be less than document date.",this.MessageVisibility=!0,!1;p+=this.pdcGCVM.GenerateChequeNos()}p+="</Row>"}if(p+="</DocumentXML>",0==f)return this.DisplayMessage=s.a.GetResource("Doc_BlankData"),!1;if(17==this.ScreenObject.DocumentType||28==this.ScreenObject.DocumentType||29==this.ScreenObject.DocumentType){var ce=this.ScreenObject.ColumnSource.find((function(e){return"creditamount"==e.DisplayMember.toLowerCase()}));if(ce&&!o.e.IsEmpty(ce.DecimalPoints)){if(r.ToString("N"+ce.DecimalPoints)!=i.ToString("N"+ce.DecimalPoints))return this.DisplayMessage=s.a.GetResource("DebitCreditarenotEqual"),!1}else if(r!=i)return this.DisplayMessage=s.a.GetResource("DebitCreditarenotEqual"),!1}if(this.ScreenObject.IsRefLCTR){var le=this.ScreenObject.GridData.Compute("sum","Amount");if(null!=le&&parseFloat(le)>this.LCDueAmt)return this.DisplayMessage="Can not pay more than due",!1}var ue=!1;if(this.DisplayMessage="",this.BudgetValidation(p.toString()),null!=this.DisplayMessage&&this.DisplayMessage.length>0){if("true"!=s.a.SessionManager.Preferences.GBudgetUnapprove.toLowerCase()||" "==this.DisplayMessage)return!1;this.DisplayMessage="",ue=!0}if(this.IsAutoPost)return this.DisplayMessage="",this.AutoPOstXML=p.toString(),s.a.page.HideDialog(),!1;if(null!=e&&"Bounce"==e.toString()){if(this.ScreenObject.Data.Tables.length>3&&this.ScreenObject.Data.Tables[3].length>0){if(!(o.e.Double(this.ScreenObject.Data.Tables[3][0].Bounce)>0))return this.DisplayMessage=" Please set 'Bounce' for this Document ",!1;this.Bounce&&this.Bounce.TerminationDate&&this.Bounce.TerminationDate.Date&&(this.DocumentDate=this.Bounce.TerminationDate.Date),this.ScreenObject.PostAccountingDocument(p.toString(),this.ViewNotes?this.ViewNotes.GetXML():"",null!=this.ViewAttachments?this.ViewAttachments.GetXML():"",this.DocumentDate,this.GetWorkFlow(!1,null),this.ScreenObject.Data.Tables[3][0].Bounce.toString()).subscribe((function(e){n.DisplayMessage=e.Message,n.ScreenObject.DocID=e.RetValue,n.RetValue>0&&(n.ScreenObject.DocID=n.RetValue,n.ScreenObject.DraftID>0&&(s.a.document.DeleteDocumentDraft(n.ScreenObject.DraftID),n.ScreenObject.DraftID=0)),Logger.InfoLog("VoucherGenerator:: Exiting SaveDocument")}),(function(e){console.log(e),n.DisplayMessage="Error in save"})),this.ButtonSave.Visible=!1,this.ButtonsEnabled=!0}}else{var de=[];de.push(p),de.push(ue.toString()),o.e.IsEmpty(e.toString())||(this.commandprarameter=e.toString());var De=this.GetWorkFlow(!1,null);if(de.push(De.toString()),De>0&&this.ScreenObject.Preferences.ContainsKey("L1Remarks")&&"True"==this.ScreenObject.Preferences.L1Remarks&&("Save"==e.toString()||"SaveAndPrint"==e.toString())&&(s.a.page.ShowDialog(new X.a(this,2),U.a),o.e.IsEmpty(this.ReviseReason)||de.push(' L1Remarks="'+this.ReviseReason+'"')),"ReSave"!=e.toString())return this.AccountingSave_DoWork(null,de),!0;this.AccountingSave_DoWork(null,de),this.SaveComplete(!1),Logger.InfoLog("AddEditDocumentViewModel::Exiting OnSaveAccount")}Logger.InfoLog("AddEditDocumentViewModel::Exiting SaveAccountingDocument")}catch(he){return this.DisplayMessage="Error in Save.",Logger.ErrorLog("AddEditDocumentViewModel:: SaveAccountingDocument"+he.stack),!1}return!0}},{key:"IsAccBillWise",value:function(e){if(s.a.SessionManager.Preferences.ContainsKey("On")&&"True"==s.a.SessionManager.Preferences.On){var t=s.a.document.IsBillWiseAccount(e);if(null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&Object(l.j)(t.Tables[0][0].IsBillwise))return!0}return!1}},{key:"BillXMLBounce",value:function(e,t,n){var a=1,i=1;null==this.Currency||o.e.IsEmpty(this.Currency.Currency.SelectedValue)||(a=parseInt(this.Currency.Currency.SelectedValue)),null==this.Currency||o.e.IsEmpty(this.Currency.ExchangeRate.Text)||(i=parseFloat(this.Currency.ExchangeRate.Text));var r="";return r+="<BillWise><Row ",r+='DocSeqNo="1" ',r+='AccountID="'+e+'" ',n?(r+='AmountFC="-'+t+'" ',r+='AdjAmount="-'+parseFloat(t)*i+'" '):(r+='AmountFC="'+t+'" ',r+='AdjAmount="'+parseFloat(t)*i+'" '),r+='AdjCurrID="'+a.toString()+'" ',r+='AdjExchRT="'+i.toString()+'" ',r+='IsNewReference="1" ',r+='Narration="" ',r+='IsDocPDC="0" ',r+=" ></Row></BillWise>"}},{key:"OnDocPrefixChanged",value:function(e){(null==this.ScreenObject||null==e||"lostFocus"!=e.toString()||this.ConfirmDirtyRead())&&(this.OnDocPrefixChanged_2(e,!1),null==this.ScreenObject||null==e||"lostFocus"!=e.toString()||this.ScreenObject.IsDocEdit?null==e||"lostFocus"==e.toString()||this.isFromDate||this.clear(3):this.clear(4))}},{key:"OnDocPrefixChanged_2",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null!=this.ScreenObject){if(Logger.InfoLog("AddEditDocumentViewModel::Entering OnDocPrefixChanged"),null!=e)try{var n={value:this._Ddate};this.ScreenObject.OnDocPrefixChanged(e,0,0,n,t,this.isFromDate?this.ScheduleID:0),this._Ddate=n.value}catch(a){this.DisplayMessage="Error Loading document try again",Logger.ErrorLog("Addeditdocumentviewmodel","OnDocPrefixChanged",a.stack)}Logger.InfoLog("AddEditDocumentViewModel::Exiting OnDocPrefixChanged")}}},{key:"OnGridSelectionChanged",value:function(e){var t=this,n=e.column.DgCol,a=n.DisplayMember;if("LISTBOX"==n.DataType&&(a=n.ValueMember),Logger.InfoLog("AddEditDocumentViewModel::Entering OnGridSelectionChanged"),"LISTBOX"==n.DataType&&2==n.CostCenterID)try{var i=0;if(this.ScreenObject.GridDataColumns.Contains(a)&&(o.e.IsEmpty(this.SelectedRow[a])||(i=parseInt(this.SelectedRow[a]))),2==this.ccid&&this.PrAccID==i||(this.t.Enabled=!1,this.ccid=2,this.PrAccID=i,this.t.Enabled=!0),!this.IsInventoryVoucher&&(this.ReportDimension.SelectedValue=i,this.ReportDimension.SelectedValue>0)){var r=s.a.SessionManager.ListViewDef.Tables[0].filter((function(e){return e.CostCenterID==t.ReportDimension.CCID&&e.ListViewTypeID==t.ReportDimension.TypeID}));r.length>0&&("accountcode"==r[0].SysColumnName.toLowerCase()&&o.e.hasprop(e.item,"AccountCode")?this.ReportDimension.SelectedValueText=this.SelectedRow.AccountCode.toString():"accountname"==r[0].SysColumnName.toLowerCase()&&o.e.hasprop(e.item,"AccountName")&&(this.ReportDimension.SelectedValueText=this.SelectedRow.AccountName.toString()))}}catch(D){}else if("LISTBOX"==n.DataType&&3==n.CostCenterID)try{var c=0;if((this.ScreenObject.Preferences.ContainsKey("ShowProductImage")&&""!=this.ScreenObject.Preferences.ShowProductImage&&Object(l.j)(this.ScreenObject.Preferences.ShowProductImage)||this.ProductImageVisibility)&&this.ShowProductImage(e.item),this.ScreenObject.GridDataColumns.Contains(a)&&(o.e.IsEmpty(this.SelectedRow[a])||(c=parseInt(this.SelectedRow[a]))),3==this.ccid&&this.PrAccID==c||(this.t.Enabled=!1,this.ccid=3,this.PrAccID=c,this.t.Enabled=!0),this.IsInventoryVoucher&&(this.ReportDimension.SelectedValue=c,this.ReportDimension.SelectedValue>0)){var u=s.a.SessionManager.ListViewDef.Tables[0].filter((function(e){return e.CostCenterID==t.ReportDimension.CCID&&e.ListViewTypeID==t.ReportDimension.TypeID}));u.length>0&&("productcode"==u[0].SysColumnName.toLowerCase()&&o.e.hasprop(e.item,"ProductCode")?this.ReportDimension.SelectedValueText=this.SelectedRow.ProductCode.toString():"productname"==u[0].SysColumnName.toLowerCase()&&o.e.hasprop(e.item,"ProductName")&&(this.ReportDimension.SelectedValueText=this.SelectedRow.ProductName.toString()))}}catch(h){}else if(null!=n&&"LISTBOX"==n.DataType&&n.CostCenterID>=50001)try{if(this.ScreenObject.Preferences.ContainsKey("QuickViewDimensions")&&""!=this.ScreenObject.Preferences.QuickViewDimensions&&this.ScreenObject.Preferences.QuickViewDimensions.toString().Contains(n.CostCenterID.toString())){var d=0;this.ScreenObject.GridDataColumns.Contains(a)&&(o.e.IsEmpty(this.SelectedRow[a])||(d=parseInt(this.SelectedRow[a]))),this.ccid==n.CostCenterID&&this.PrAccID==d||(this.t.Enabled=!1,this.ccid=n.CostCenterID,this.PrAccID=d,this.t.Enabled=!0)}}catch(S){}else null!=this.SelectedRow&&(this.IsInventoryVoucher&&!o.e.IsEmpty(this.SelectedRow.ProductID_Key)&&parseInt(this.SelectedRow.ProductID_Key)>0?this.ReportDimension.SelectedValue=parseInt(this.SelectedRow.ProductID_Key):!this.IsInventoryVoucher&&!o.e.IsEmpty(this.SelectedRow.DebitAccount_Key)&&parseInt(this.SelectedRow.DebitAccount_Key)>0?this.ReportDimension.SelectedValue=parseInt(this.SelectedRow.DebitAccount_Key):!this.IsInventoryVoucher&&!o.e.IsEmpty(this.SelectedRow.CreditAccount_Key)&&parseInt(this.SelectedRow.CreditAccount_Key)>0?this.ReportDimension.SelectedValue=parseInt(this.SelectedRow.CreditAccount_Key):!this.IsInventoryVoucher&&!o.e.IsEmpty(this.SelectedRow.AccountID_Key)&&parseInt(this.SelectedRow.AccountID_Key)>0&&(this.ReportDimension.SelectedValue=parseInt(this.SelectedRow.AccountID_Key)));Logger.InfoLog("AddEditDocumentViewModel::Exiting OnGridSelectionChanged")}},{key:"t_Tick",value:function(){(2==this.ccid||3==this.ccid||this.ccid>=50001)&&this.PrAccID>0&&this.ShowQuickView(this.ccid,this.PrAccID,null!=this.SelectedRow?this.SelectedRow:null,null)}},{key:"ShowQuickViewCallBack",value:function(e){this.ShowQuickView(e.CCID,e.NodeID,e.datarow,e.ctrl)}},{key:"ShowQuickView",value:function(e,t,n,a){var i=this;if(0==e&&null!=a)return this.ScreenObject._CCFields.forEach((function(e){e instanceof C.b&&(e.SelectedValue>0&&!o.e.IsEmpty(e.Text)?i.fldDict[e.Lbl].setFieldValue(e.Text):i.fldDict[e.Lbl].setFieldValue(""))})),this.ScreenObject._TextFields.forEach((function(e){i.fldDict.ContainsKey(e.Lbl)&&(e instanceof h.d?"FLOAT"==e.DataType?null!=e.Text&&""!=e.Text&&""==e.ValidateData()?i.fldDict[e.Lbl].setFieldValue(e.Text):i.fldDict[e.Lbl].setFieldValue(0):i.fldDict[e.Lbl].setFieldValue(e.Text):e instanceof m.e?i.fldDict[e.Lbl].setFieldValue(e.SelectedValue):e instanceof O.a?i.fldDict[e.Lbl].setFieldValue(e.Text):e instanceof C.b&&(e.SelectedValue>0&&!o.e.IsEmpty(e.Text)?i.fldDict[e.Lbl].setFieldValue(e.Text):i.fldDict[e.Lbl].setFieldValue("")))})),void this.ValidateData(a);var r=this.QuickInfoVisibility,s=this.DQuickInfoVisibility;if(this.t.Enabled=!1,t<=0)return this.SetVisibiltiFalse(),void(this.IsPOs?this.ProductSearchVisibility=!0:this.SetDefaultRightPanel());if(this.SetVisibiltiFalse(),this.IsPOs||this.SetDefaultRightPanel(),this.IgnoreQuickViews.Contains(e))return this.QuickInfoVisibility=!1,void(this.DQuickInfoVisibility=!1);var c=null;if(2==e)this.QuickInfoView||(this.QuickInfoView=new M.a),c=this.QuickInfoView.QuickViewScreenViewModel_3(e,t,this.CostCenterID,this.DocumentDate,0,"");else if(3==e){var l=0,u=this.ScreenObject.DocumentType;null!=this.ScreenObject.CreditAccount&&this.ScreenObject.CreditAccount.SelectedValue>0&&(1==this.DocumentType||2==u||10==u||26==u||27==u||3==u||4==u||25==u||13==u)?l=this.ScreenObject.CreditAccount.SelectedValue:null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.SelectedValue>0&&(11==this.DocumentType||6==u||7==u||8==u||9==u||12==u||24==u)&&(l=this.ScreenObject.DebitAccount.SelectedValue);var d="<XML>";this.ScreenObject._CCFields.forEach((function(e){e instanceof C.b&&e.DBColumnName.Contains("TO")&&5==u||e instanceof C.b&&e.SelectedValue>0&&(d+='<Row CostCenterID="'+e.CCID+'" NODEID="'+e.SelectedValue.toString()+'" />')})),null!=n&&this.ScreenObject.ColumnSource.forEach((function(e){e.CostCenterID>5e4&&i.ScreenObject.GridDataColumns.Contains(e.ValueMember)&&(o.e.IsEmpty(n[e.ValueMember])?o.e.IsEmpty(n[e.DisplayMember])||(d+='<Row CostCenterID="'+e.CostCenterID+'" NODEID="'+n[e.DisplayMember].toString()+'" />'):d+='<Row CostCenterID="'+e.CostCenterID+'" NODEID="'+n[e.ValueMember].toString()+'" />')})),(1==u||2==u||10==u||26==u||27==u||3==u||4==u||25==u||13==u)&&null!=this.ScreenObject.CreditAccount&&this.ScreenObject.CreditAccount.SelectedValue>0?d+='<Row CostCenterID="2" NODEID="'+this.ScreenObject.CreditAccount.SelectedValue.toString()+'" />':(11==u||6==u||7==u||8==u||9==u||12==u||24==u)&&null!=this.ScreenObject.DebitAccount&&this.ScreenObject.DebitAccount.SelectedValue>0&&(d+='<Row CostCenterID="2" NODEID="'+this.ScreenObject.DebitAccount.SelectedValue.toString()+'" />'),d+="</XML>",this.QuickInfoView||(this.QuickInfoView=new M.a),c=this.QuickInfoView.QuickViewScreenViewModel_3(e,t,this.CostCenterID,this.DocumentDate,l,d.toString())}else e>=50001?(this.DQuickInfoView||(this.DQuickInfoView=new M.a),c=this.DQuickInfoView.QuickViewScreenViewModel_3(e,t,this.CostCenterID,this.DocumentDate,0,"")):(this.QuickInfoView||(this.QuickInfoView=new M.a),c=this.QuickInfoView.QuickViewScreenViewModel_3(e,t,e,this.DocumentDate,0,""));c&&c.then((function(){e>=50001?(i.DQuickInfoVisibility=!i.DQuickInfoView.IsError,i.QuickInfoVisibility=r,i.DQuickInfoView.IsError&&i.IgnoreQuickViews.push(e)):(i.QuickInfoVisibility=!i.QuickInfoView.IsError,i.DQuickInfoVisibility=s,i.QuickInfoView.IsError&&i.IgnoreQuickViews.push(e))}))}},{key:"ShowProductImage",value:function(e){this.SetVisibiltiFalse(),this.ProductImageVisibility=!0,this.ScreenObject.GridDataColumns.Contains("FileGUID")&&this.ScreenObject.GridDataColumns.Contains("FileExtension")&&!o.e.IsEmpty(e.FileGUID)&&(e.guid=e.FileGUID,this.ProductPhoto=o.e.GetPath(e.FileGUID.toString()+"."+e.FileExtension.toString()))}},{key:"BindDivisionorLocation",value:function(e){if(s.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==s.a.SessionManager.Preferences.EnableDivisionWise.toString()){var t=this.ScreenObject.ColumnSource.find((function(e){return 50001==e.CostCenterID}));t&&t.ReadOnly&&(this.ScreenObject.DivisionID>0?(e[t.DisplayMember+"_Key"]=this.ScreenObject.DivisionID,e[t.DisplayMember]=this.ScreenObject.DivisionName):s.a.SessionManager.DivisionID>0&&(e[t.DisplayMember+"_Key"]=s.a.SessionManager.DivisionID,e[t.DisplayMember]=s.a.SessionManager.DivisionName))}if(s.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==s.a.SessionManager.Preferences.EnableLocationWise.toString()){var n=this.ScreenObject.ColumnSource.find((function(e){return 50002==e.CostCenterID}));n&&n.ReadOnly&&(this.ScreenObject.LocationID>0?(e[n.DisplayMember+"_Key"]=this.ScreenObject.LocationID,e[n.DisplayMember]=this.ScreenObject.LocationName):s.a.SessionManager.LocationID>0&&(e[n.DisplayMember+"_Key"]=s.a.SessionManager.LocationID,e[n.DisplayMember]=s.a.SessionManager.LocationName))}}},{key:"onFooterBeginEdit",value:function(e){var t=e.args,n=e.args.item,a=e.args.column,i=a.DgCol,r=a.className;!Object(l.j)(n.IsVisible)&&1==n.StyleHeightZero||this.IsInventoryVoucher&&"PactTextBoxEditor"==r&&("Amount"==i.DisplayMember||"CalcAmount"==i.DisplayMember)&&this.ScreenObject.GridDataColumns.Contains("ReadOnly")&&!o.e.IsEmpty(n.ReadOnly)&&Object(l.j)(n.ReadOnly)||this.IsInventoryVoucher&&"DataGridPactListBoxColumn"==r&&"dcCurrID"==i.DisplayMember&&this.ScreenObject.GridDataColumns.Contains("dcCurrID_Key")&&!o.e.IsEmpty(n.dcCurrID_Key)&&(-3==parseInt(n.dcCurrID_Key)||-1==parseInt(n.dcCurrID_Key))||this.IsInventoryVoucher&&"PactTextBoxEditor"==r&&"dcExchRT"==i.DisplayMember&&this.ScreenObject.GridDataColumns.Contains("dcCurrID_Key")&&!o.e.IsEmpty(n.dcCurrID_Key)&&(-3==parseInt(n.dcCurrID_Key)||-1==parseInt(n.dcCurrID_Key))?t.Cancel=!0:(this.FooterColumn="ColumnName"!=i.DisplayMember&&"ColumnName"!=i.ValueBinding||!this.ScreenObject.GridDataColumns.Contains("ColumnName")||o.e.IsEmpty(n.ColumnName)?"":n.ColumnName.toString(),"POSDocumentViewModel"==this.ClassName&&"PactTextBoxEditor"==r&&(this.NUmpadBindingPath=i.DisplayMember,this.NumPadText=o.e.IsEmpty(n[i.DisplayMember])?"":n[i.DisplayMember].toString()))}},{key:"OnFooterCellEditEnding",value:function(e){if(e.column){var t=e.item,n=e.column.DgCol,a=e.column.field;a="DataGridComboBoxColumn"==e.column.className||"DataGridPactComboBoxColumn"==e.column.className?n.ValueMember:n.DisplayMember,this.FooterCellEditEnd(a,t),"CalcAmount"!=a&&"Amount"!=a||this.ValidateFooterData(t)}}},{key:"FooterCellEditEnd",value:function(e,t){if("ColumnName"==e&&this.ScreenObject.FooterGridDataColumns.Contains("ColumnName")&&!o.e.IsEmpty(t.ColumnName)&&t.ColumnName.toString()!=this.FooterColumn){var n=this.ScreenObject.FooterDataBind.filter((function(e){return e.ColumnName==t.ColumnName.toString()}));if(n.length>0&&(t.Name=n[0].Name,t.PostingType=n[0].PostingType,t.IsCalculated=n[0].IsCalculated,t.Formula=n[0].Formula,t.Decimals=n[0].Decimals,t.DebitAccount=n[0].DebitAccount,t.DebitAccountName=n[0].DebitAccountName,t.CreditAccount=n[0].CreditAccount,t.CreditAccountName=n[0].CreditAccountName,t.BasedOnXml=n[0].BasedOnXml,t.Message=n[0].Message,t.Action=n[0].Action,t.Expression=n[0].Expression,t.ReadOnly=n[0].ReadOnly,t.IsVisible=n[0].IsVisible,t.DrRefColID=n[0].DrRefColID,t.CrRefColID=n[0].CrRefColID,t.dcCurrID=n[0].CurrencyName,t.dcCurrID_Key=n[0].Currency,null!=this.Currency)){var a=this.Currency.Currency.Getvalue(o.e.String(t.dcCurrID));""!=a&&(t.dcExchRT=this.ScreenObject.GetExchangeRate(parseInt(a),this.DocumentDate))}}this.ScreenObject.FooterGridDataColumns.Contains("dcCurrID_Key")&&!o.e.IsEmpty(t.ColumnName)&&"dcCurrID"==e&&!o.e.IsEmpty(t.dcCurrID_Key)&&parseInt(t.dcCurrID_Key)>0&&(t.dcExchRT=this.ScreenObject.GetExchangeRate(parseInt(t.dcCurrID_Key),this.DocumentDate)),this.CalculateFooter("CalcAmount"==e?this.ScreenObject.FooterGridData.indexOf(t):-1)}},{key:"OnCellEditCommit",value:function(e){try{if(null==this.ScreenObject||!e.column)return;var t=e.item,n=e.column.DgCol;if("DataGridPactComboBoxColumn"==e.column.className&&62!=this.ScreenObject.DocumentType&&63!=this.ScreenObject.DocumentType&&!this.ScreenObject.IsPayrollDocument){if("ChequeBookNo"==n.DisplayMember&&!o.e.IsEmpty(t.ChequeBookNo)&&t.ChequeBookNo.toString()!=this.PrevValue&&this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!o.e.IsEmpty(t.CreditAccount_Key)){if(this.ScreenObject.Preferences.ContainsKey("AutoChequeonPost")&&"True"==this.ScreenObject.Preferences.AutoChequeonPost)return;var a=this.ScreenObject.ColumnSource.find((function(e){return null!=e.DisplayMember&&"ChequeNumber"==e.DisplayMember}));a&&(t[a.DisplayMember]=s.a.document.GetChequeNumbers(parseInt(t.CreditAccount_Key),t.ChequeBookNo.toString()))}return void this.CalculateTotals(t,!1)}var i=e.column.field,r=0;"DataGridComboBoxColumn"!=e.column.className?(i=n.DisplayMember,"DataGridPactListBoxColumn"==e.column.className&&(r=n.CostCenterID)):"DataGridComboBoxColumn"==e.column.className&&(i=e.model.SelectedValueBinding,r=0),this.ScreenObject.GridDataColumns.Contains(i)&&!o.e.IsEmpty(t[i])&&this.FillDefaultProd(t,i),89!=this.DocumentType&&90!=this.DocumentType||("dcAlpha1"==i||"dcAlpha2"==i?o.e.IsEmpty(t.dcAlpha1)?(t.dcAlpha2=null,t.dcAlpha2_Key=null):o.e.IsEmpty(t.dcAlpha2)&&(t.dcAlpha2=(new Date).ToString("HH:mm"),t.dcAlpha2_Key=new Date):"dcAlpha3"!=i&&"dcAlpha4"!=i||(o.e.IsEmpty(t.dcAlpha3)?(t.dcAlpha4=null,t.dcAlpha4_Key=null):o.e.IsEmpty(t.dcAlpha4)&&(t.dcAlpha4=(new Date).ToString("HH:mm"),t.dcAlpha4_Key=new Date))),this.Celleditend(t,i,r),this.ScreenObject.GridDataObj.updateRow(t),this.PoleDisplayMessage(2,t),this.OnGridSelectionChanged(e)}catch(c){if("PactException"==c.message)throw new Error("PactException")}}},{key:"CallfromgridObj",value:function(e){this.CalculateTotals(e,!1)}},{key:"FillDefaultProd",value:function(e,t){if(this.IsInventoryVoucher&&o.e.IsEmpty(e.ProductID_Key)){var n=this.ScreenObject.ColumnSource.find((function(e){return null!=e.ValueMember&&"productid_key"==e.ValueMember.toLowerCase()}));if(n&&!o.e.IsEmpty(n.DefaultValue)&&!o.e.IsEmpty(n.DefaultValueText)&&o.e.IsNum(n.DefaultValue)){var a="";o.e.IsEmpty(t)||(a=o.e.String(e[t]));var i=n.DefaultValueText.split("\x11");e.ProductID_Key=n.DefaultValue,this.ScreenObject.GridDataColumns.Contains("ProductCode")&&i.length>1&&(e.ProductCode=i[1]),this.ScreenObject.GridDataColumns.Contains("ProductName")&&i.length>0&&(e.ProductName=i[0]),this.ProdID=0,this.AddProductData(e,!1,!1,!1,null,null),o.e.IsEmpty(t)||(e[t]=a)}}else if(!this.IsInventoryVoucher&&(this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&o.e.IsEmpty(e.DebitAccount_Key)||this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&o.e.IsEmpty(e.CreditAccount_Key)))if(this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")){var r=this.ScreenObject.ColumnSource.find((function(e){return null!=e.ValueMember&&"creditaccount_key"==e.ValueMember.toLowerCase()}));if(r&&!o.e.IsEmpty(r.DefaultValue)&&!o.e.IsEmpty(r.DefaultValueText)&&o.e.IsNum(r.DefaultValue)&&parseInt(r.DefaultValue)>0){var s="";o.e.IsEmpty(t)||(s=e[t].toString());var c=r.DefaultValueText.split("\x11");e.CreditAccount_Key=r.DefaultValue,this.ScreenObject.GridDataColumns.Contains("AccountCode")&&c.length>1&&(e.AccountCode=c[1]),this.ScreenObject.GridDataColumns.Contains("AccountName")&&c.length>0&&(e.AccountName=c[0]),o.e.IsEmpty(t)||(e[t]=s),this.FillDefaultValues(e),this.ScreenObject.GridDataObj.updateRow(e)}}else if(this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")){var l=this.ScreenObject.ColumnSource.find((function(e){return null!=e.ValueMember&&"debitaccount_key"==e.ValueMember.toLowerCase()}));if(l&&!o.e.IsEmpty(l.DefaultValue)&&!o.e.IsEmpty(l.DefaultValueText)&&o.e.IsNum(l.DefaultValue)&&parseInt(l.DefaultValue)>0){var u="";o.e.IsEmpty(t)||(u=e[t].toString());var d=l.DefaultValueText.split("\x11");e.DebitAccount_Key=l.DefaultValue,this.ScreenObject.GridDataColumns.Contains("AccountCode")&&d.length>1&&(e.AccountCode=d[1]),this.ScreenObject.GridDataColumns.Contains("AccountName")&&d.length>0&&(e.AccountName=d[0]),o.e.IsEmpty(t)||(e[t]=u),this.FillDefaultValues(e),this.ScreenObject.GridDataObj.updateRow(e)}}}},{key:"FillDefaultValues",value:function(e){for(var t,n=this,a=function(a){var i=n.ScreenObject.ColumnSource[a];if(o.e.IsEmpty(i.ID))return"continue";var r=n.ScreenObject.Data.Tables[0].filter((function(e){return e.CostCenterColID==i.ID&&null!=e.LocalReference&&79==e.LocalReference&&53580==e.LinkData})),c=n.ScreenObject.Data.Tables[0].filter((function(e){return e.CostCenterColID==i.ID&&null!=e.LocalReference&&79==e.LocalReference&&(55496==e.LinkData||55495==e.LinkData)}));if(i.CostCenterID>0&&3!=i.CostCenterID&&!o.e.IsEmpty(i.LocalRefDefaultValue)&&o.e.IsNum(i.LocalRefDefaultValue)&&!o.e.IsEmpty(i.ValueMember)&&!o.e.IsEmpty(i.LocalRefDefaultValueText))e[i.DisplayMember]=i.LocalRefDefaultValueText,e[i.ValueMember]=i.LocalRefDefaultValue,n.FillLinkRef(e,i);else if(i.CostCenterID>0&&3!=i.CostCenterID&&!o.e.IsEmpty(i.DefaultValue)&&!o.e.IsEmpty(i.ValueMember)&&o.e.IsEmpty(e[i.ValueMember])&&!o.e.IsEmpty(i.DefaultValueText)){if(o.e.IsNum(i.DefaultValue)){var l=i.DefaultValueText.split("\x11");l.length>1?e[i.DisplayMember]=l[1]:l.length>0&&(e[i.DisplayMember]=l[0]),e[i.ValueMember]=i.DefaultValue,n.FillLinkRef(e,i)}}else if(o.e.IsEmpty(i.DefaultValue)||o.e.IsEmpty(i.ValueBinding)||!i.ValueBinding.toLowerCase().Contains("dcalpha"))if(o.e.IsEmpty(i.DefaultValue)||o.e.IsEmpty(i.DisplayMember)||!i.DisplayMember.toLowerCase().Contains("dcalpha"))if(r.length>0){if(null!=n.fldDict&&o.e.isValidDate(n.fldDict.ServerDate.fieldResult)&&("DATE"==i.DataType||"DATETIME"==i.DataType||"TIME"==i.DataType))if(e[i.DisplayMember]="DATETIME"==i.DataType?new Date(n.fldDict.ServerDate.fieldResult).ToString(s.a.SessionManager.Preferences["Date Format"]+" hh:mm a"):"TIME"==i.DataType?new Date(n.fldDict.ServerDate.fieldResult).ToString("hh:mm:ss tt"):new Date(n.fldDict.ServerDate.fieldResult).ToString(s.a.SessionManager.Preferences["Date Format"]),"TIME"==i.DataType){var u=new Date(n.fldDict.ServerDate.fieldResult);e[i.DisplayMember+"_Key"]=new Date(1900,1,1,u.getHours(),u.getMinutes(),u.getSeconds(),u.getMilliseconds())}else e[i.DisplayMember+"_Key"]=new Date(n.fldDict.ServerDate.fieldResult)}else c.length>0&&("DATE"!=i.DataType&&"DATETIME"!=i.DataType&&"TIME"!=i.DataType||(e[i.DisplayMember]="DATETIME"==i.DataType?(new Date).ToString(s.a.SessionManager.Preferences["Date Format"]+" hh:mm a"):"TIME"==i.DataType?(new Date).ToString("hh:mm:ss tt"):(new Date).ToString(s.a.SessionManager.Preferences["Date Format"]),e[i.DisplayMember+"_Key"]="TIME"==i.DataType?new Date(1900,1,1,(new Date).getHours(),(new Date).getMinutes(),(new Date).getSeconds(),(new Date).getMilliseconds()):new Date));else o.e.IsEmpty(e[i.DisplayMember])&&("DATETIME"==i.DataType.toUpperCase()?o.e.IsEmpty(i.DefaultValue)||"today"!=i.DefaultValue.toLowerCase()?o.e.isValidDate(i.DefaultValue)&&(e[i.DisplayMember]=t.ToString(s.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss tt"),e[i.DisplayMember+"_Key"]=t):(e[i.DisplayMember]=(new Date).ToString(s.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss tt"),e[i.DisplayMember+"_Key"]=new Date):"TIME"==i.DataType.toUpperCase()?o.e.IsEmpty(i.DefaultValue)||"today"!=i.DefaultValue.toLowerCase()?o.e.isValidDate(i.DefaultValue)&&(e[i.DisplayMember]=t.ToString("hh:mm:ss tt"),e[i.DisplayMember+"_Key"]=t):(e[i.DisplayMember]=(new Date).ToString("hh:mm:ss tt"),e[i.DisplayMember+"_Key"]=new Date):"TIME2"==i.DataType.toUpperCase()?o.e.IsEmpty(i.DefaultValue)||"today"!=i.DefaultValue.toLowerCase()?o.e.isValidDate(i.DefaultValue)&&(e[i.DisplayMember]=t.ToString("HH:mm"),e[i.DisplayMember+"_Key"]=t):(e[i.DisplayMember]=(new Date).ToString("HH:mm"),e[i.DisplayMember+"_Key"]=new Date):"DATE"==i.DataType.toUpperCase()?o.e.IsEmpty(i.DefaultValue)||"today"!=i.DefaultValue.toLowerCase()?o.e.isValidDate(i.DefaultValue)&&(e[i.DisplayMember]=t.ToString(s.a.SessionManager.Preferences["Date Format"]),e[i.DisplayMember+"_Key"]=t):(e[i.DisplayMember]=Date.Today().ToString(s.a.SessionManager.Preferences["Date Format"]),e[i.DisplayMember+"_Key"]=Date.Today()):e[i.DisplayMember]=i.DefaultValue);else o.e.IsEmpty(e[i.ValueBinding])&&(e[i.ValueBinding]=i.DefaultValue)},i=0;i<this.ScreenObject.ColumnSource.length;i++)a(i)}},{key:"FillLinkRef",value:function(e,t){this.ScreenObject.Data.Tables.length>0&&this.ScreenObject.Data.Tables[0].length>0&&null!=t&&t.CostCenterID>0&&this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&e.LocalReference==t.ID})).length>0&&!o.e.IsEmpty(t.ValueMember)&&!o.e.IsEmpty(e[t.ValueMember])&&this.ScreenObject.GetLinkReferenceData(parseInt(t.ID),this.DocumentID,parseInt(e[t.ValueMember]),Date.Today(),"",t.CostCenterID,e)}},{key:"IsWarehouseBinwise",value:function(e,t,n){var a=this;n.DimensionID=0;var i=0;if(s.a.SessionManager.Preferences.ContainsKey("DimensionwiseBins")&&""!=s.a.SessionManager.Preferences.DimensionwiseBins.toString()&&(i=o.e.Int(s.a.SessionManager.Preferences.DimensionwiseBins))>0){if(i>5e4&&this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(i-5e4).toString()+"_Key"))return n.DimensionID=1,1==t&&this.ScreenObject.GridDataColumns.Contains("TOdcCCNID"+(i-5e4).toString()+"_Key")?!o.e.IsEmpty(this.ScreenObject.GridData[e]["TOdcCCNID"+(i-5e4).toString()+"_Key"])&&parseInt(this.ScreenObject.GridData[e]["TOdcCCNID"+(i-5e4).toString()+"_Key"])>0&&(n.DimensionID=parseInt(this.ScreenObject.GridData[e]["TOdcCCNID"+(i-5e4).toString()+"_Key"])):!o.e.IsEmpty(this.ScreenObject.GridData[e]["dcCCNID"+(i-5e4).toString()+"_Key"])&&parseInt(this.ScreenObject.GridData[e]["dcCCNID"+(i-5e4).toString()+"_Key"])>0&&(n.DimensionID=parseInt(this.ScreenObject.GridData[e]["dcCCNID"+(i-5e4).toString()+"_Key"])),this.ScreenObject.IsBinWise(i,n.DimensionID);if(1!=t){var r=this.ScreenObject._CCFields.find((function(e){return e instanceof C.b&&e.CCID==i}));return r&&(n.DimensionID=r.SelectedValue),this.IsBinwise}if(null!=this.IsToBinwise){for(var c=function(e){var t=a.ScreenObject._CCFields[e];if(t instanceof C.b&&t.CCID==i){if(t.DBColumnName.Contains("TO"))t.SelectedValue>0&&(n.DimensionID=t.SelectedValue);else{var r=a.ScreenObject._CCFields.find((function(e){return e.DBColumnName=="TO"+t.DBColumnName}));r instanceof C.b?r.SelectedValue>0&&(n.DimensionID=r.SelectedValue):t.SelectedValue>0&&(n.DimensionID=t.SelectedValue)}return{v:a.IsToBinwise}}},l=0;l<this.ScreenObject._CCFields.length;l++){var u=c(l);if("object"==typeof u)return u.v}return this.IsToBinwise}n.DimensionID=1;for(var d=function(e){var t=a.ScreenObject._CCFields[e];if(t instanceof C.b&&t.CCID==i){if(t.DBColumnName.Contains("TO"))t.SelectedValue>0&&(n.DimensionID=t.SelectedValue);else{var r=a.ScreenObject._CCFields.find((function(e){return e.DBColumnName=="TO"+t.DBColumnName}));r instanceof C.b?r.SelectedValue>0&&(n.DimensionID=r.SelectedValue):t.SelectedValue>0&&(n.DimensionID=t.SelectedValue)}return{v:(a.IsToBinwise=a.ScreenObject.IsBinWise(i,n.DimensionID),a.IsToBinwise)}}},D=0;D<this.ScreenObject._CCFields.length;D++){var h=d(D);if("object"==typeof h)return h.v}}return!0}},{key:"GetDimValue",value:function(e,t){for(var n=1,a=!1,i=0;i<this.ScreenObject._CCFields.length;i++){var r=this.ScreenObject._CCFields[i];if(r instanceof C.b&&r.CCID==e){r.SelectedValue>0&&(n=r.SelectedValue),a=!0;break}}return a||null!=t&&e>5e4&&this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(e-5e4).toString()+"_Key")&&!o.e.IsEmpty(t["dcCCNID"+(e-5e4).toString()+"_Key"])&&parseInt(t["dcCCNID"+(e-5e4).toString()+"_Key"])>0&&(n=parseInt(t["dcCCNID"+(e-5e4).toString()+"_Key"])),n}},{key:"GetBOEIDS",value:function(e){var t="";if(s.a.SessionManager.IsActionAssigned(43,"Show only BOE Bins if fifo")&&-1==this.VoucherType&&this.ScreenObject.GridDataColumns.Contains("landingType")&&"2"==o.e.String(e.landingType))if(o.e.IsEmpty(e.DocExtraXML))t+="0";else{var n=new o.f;n.LoadXml(e.DocExtraXML);for(var a=n.SelectNodes("DocExtraXML/Row"),i=0;i<a.length;i++)null==a[i].attributes.RefID||o.e.IsEmpty(a[i].attributes.RefID.value)||(""!=t&&(t+=","),t+=a[i].attributes.RefID.value)}else if(s.a.SessionManager.IsActionAssigned(43,"Show only BOE Bins")&&-1==this.VoucherType&&this.ScreenObject.GridDataColumns.Contains("landingType")&&("2"==o.e.String(e.landingType)||"1"==o.e.String(e.landingType)))if(o.e.IsEmpty(e.DocExtraXML))t+="0";else{var r=new o.f;r.LoadXml(e.DocExtraXML);for(var c=r.SelectNodes("DocExtraXML/Row"),l=0;l<c.length;l++)null==c[l].attributes.RefID||o.e.IsEmpty(c[l].attributes.RefID.value)||(""!=t&&(t+=","),t+=c[l].attributes.RefID.value)}return t}},{key:"AddBins",value:function(e,t,n,a){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=null,c=null;if(null!=a&&(r=a.Tables[0],c=a.Columns[0]),!(s.a.page.DialogModel instanceof ue))if(!n||!this.ScreenObject.GridDataColumns.Contains("landingType")||"1"!=o.e.String(e.landingType)&&"2"!=o.e.String(e.landingType)){var u=0;if(this.ScreenObject.Preferences.ContainsKey("ExcludeHoldBins")&&""!=this.ScreenObject.Preferences.ExcludeHoldBins.toString()&&Object(l.j)(this.ScreenObject.Preferences.ExcludeHoldBins)&&(this.ScreenObject.GridDataColumns.Contains("ReserveQuantity")||this.ScreenObject.GridDataColumns.Contains("HoldQuantity"))){if(this.ScreenObject.GridDataColumns.Contains("ReserveQuantity")){var d=this.ScreenObject.ColumnSource.find((function(e){return"ReserveQuantity"==e.DisplayMember}));d&&!o.e.IsEmpty(d.Formula)&&this.CalculateTotals(e,!1),!o.e.IsEmpty(e.ReserveQuantity)&&parseFloat(e.ReserveQuantity)>0&&(u=parseFloat(e.ReserveQuantity))}if(this.ScreenObject.GridDataColumns.Contains("HoldQuantity")){var D=this.ScreenObject.ColumnSource.find((function(e){return"HoldQuantity"==e.DisplayMember}));D&&!o.e.IsEmpty(D.Formula)&&this.CalculateTotals(e,!1),!o.e.IsEmpty(e.HoldQuantity)&&parseFloat(e.HoldQuantity)>0&&(u=parseFloat(e.HoldQuantity))}}else(this.ScreenObject.Preferences.ContainsKey("ShowBins")&&""!=this.ScreenObject.Preferences.ShowBins&&Object(l.j)(this.ScreenObject.Preferences.ShowBins)||!this.DonotUpdateInventory)&&(u=!o.e.IsEmpty(e.SchemeID)&&parseInt(e.SchemeID)>0&&"Y"==e.IsScheme.toString()&&this.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!o.e.IsEmpty(e.FreeQTY)?parseFloat(e.FreeQTY):parseFloat(e.Quantity),this.ScreenObject.GridDataColumns.Contains("UOMConversion")&&!o.e.IsEmpty(e.UOMConversion)&&(u*=parseFloat(e.UOMConversion)));if(0!=u&&(30==this.ScreenObject.DocumentType&&(this.VoucherType=this.ScreenObject.GridDataColumns.Contains("VoucherType")&&!o.e.IsEmpty(e.VoucherType)?parseInt(e.VoucherType):0),0!=this.VoucherType&&u>0)){var h=0,S=0,m=0,b=0;if(s.a.SessionManager.Preferences.ContainsKey("DimensionwiseBins")&&""!=s.a.SessionManager.Preferences.DimensionwiseBins.toString()&&((S=o.e.Int(s.a.SessionManager.Preferences.DimensionwiseBins))>0&&(h=this.GetDimValue(S,e))),this.ScreenObject.Preferences.ContainsKey("BinFilterDim")&&""!=this.ScreenObject.Preferences.BinFilterDim.toString()&&((b=o.e.Int(this.ScreenObject.Preferences.BinFilterDim))>0&&(m=this.GetDimValue(b,e))),o.e.IsEmpty(e.DocDetailsID)||parseInt(e.DocDetailsID),!t&&S>5e4&&!this.ScreenObject.IsBinWise(S,h))5!=this.ScreenObject.DocumentType||this.ScreenObject.GridDataColumns.Contains("RecievedQty")||S>0&&this.AddToWarehouseBins(S,e,u,t);else{var C=0;-1!=this.VoucherType||o.e.IsEmpty(e.LinkedInvDocDetailsID)||(C=o.e.Int(e.LinkedInvDocDetailsID));var y=this.ScreenObject.GetProductwiseBins(parseInt(e.ProductID_Key),this.ScreenObject.DocID,this.VoucherType,this.DocumentDate,S,h,b,m,C,0,0,this.GetBOEIDS(e)),p=new le.a(this,this.VoucherType,u,parseInt(e.ProductID_Key),e.ProductName.toString(),y,e);if(i)p.ChkFifo=!0,p.OnSave("AutoSave");else if(this.ScreenObject.Preferences.ContainsKey("AutoSelectBins")&&"true"==this.ScreenObject.Preferences.AutoSelectBins.toLowerCase()&&null!=y&&y.Tables.length>0&&1==y.Tables[0].length&&p.BinsGrid.Table.length>0)p.BinsGrid.Table[0].Allocate=u,p.celledtiend(p.BinsGrid.Table[0]),p.DisplayMessage="",p.OnSave("AutoSave"),""==p.DisplayMessage||t||s.a.page.ShowDialog(p,je.a);else if(null!=r){for(var g=function(e){var t=void 0;(t=c.Contains("InvDocDetailsID")&&p.BinsGrid.TableColumns.Contains("InvID")?p.BinsGrid.Table.filter((function(t){return t.NodeID==r[e].BinID&&t.InvID==r[e].InvDocDetailsID})):p.BinsGrid.Table.filter((function(t){return t.NodeID==r[e].BinID}))).length>0&&u>0&&(u>parseFloat(r[e].Quantity)?(t[0].Allocate=r[e].Quantity.toString(),p.celledtiend(p.BinsGrid.Table[0]),u-=parseFloat(r[e].Quantity)):(t[0].Allocate=u,p.celledtiend(p.BinsGrid.Table[0]),u=0))},f=0;f<r.length;f++)g(f);p.OnSave("AutoSave")}else s.a.page.ShowDialog(p,je.a)}}}else{if(s.a.page.DialogModel instanceof le.a)return;s.a.page.ShowDialog(new ue(this,2),de.a)}}},{key:"AddToWarehouseBins",value:function(e,t,n,a){var i=this,r=1,c=!1,l=0,u=0;if(0==e&&(r=0),e>0){for(var d=function(t){var n=i.ScreenObject._CCFields[t];if(n instanceof C.b&&n.CCID==e){if(n.DBColumnName.Contains("TO"))n.SelectedValue>0&&(r=n.SelectedValue);else{var a=i.ScreenObject._CCFields.find((function(e){return e.DBColumnName=="TO"+n.DBColumnName}));a instanceof C.b?a.SelectedValue>0&&(r=a.SelectedValue):n.SelectedValue>0&&(r=n.SelectedValue)}return c=!0,"break"}},D=0;D<this.ScreenObject._CCFields.length;D++){if("break"===d(D))break}c||null!=t&&e>5e4&&this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(e-5e4).toString()+"_Key")&&(this.ScreenObject.GridDataColumns.Contains("TOdcCCNID"+(e-5e4).toString()+"_Key")?!o.e.IsEmpty(t["TOdcCCNID"+(e-5e4).toString()+"_Key"])&&parseInt(t["TOdcCCNID"+(e-5e4).toString()+"_Key"])>0&&(r=parseInt(t["TOdcCCNID"+(e-5e4).toString()+"_Key"])):!o.e.IsEmpty(t["dcCCNID"+(e-5e4).toString()+"_Key"])&&parseInt(t["dcCCNID"+(e-5e4).toString()+"_Key"])>0&&(r=parseInt(t["dcCCNID"+(e-5e4).toString()+"_Key"])))}if(this.ScreenObject.Preferences.ContainsKey("BinFilterDim")&&""!=this.ScreenObject.Preferences.BinFilterDim.toString()&&((u=o.e.Int(this.ScreenObject.Preferences.BinFilterDim))>0&&(l=this.GetDimValue(u,t))),!(e>5e4)||this.ScreenObject.IsBinWise(e,r)){o.e.IsEmpty(t.TODocDetailsID)||parseInt(t.TODocDetailsID);var h=this.ScreenObject.GetProductwiseBins(parseInt(t.ProductID_Key),this.ScreenObject.DocID,1,this.DocumentDate,e,r,u,l,0,0,0,this.GetBOEIDS(t)),S=new le.a(this,1,n,parseInt(t.ProductID_Key),t.ProductName.toString(),h,t);this.ScreenObject.Preferences.ContainsKey("AutoSelectBins")&&"true"==this.ScreenObject.Preferences.AutoSelectBins.toLowerCase()&&null!=h&&h.Tables.length>0&&1==h.Tables[0].length&&S.BinsGrid.Table.length>0?(S.BinsGrid.Table[0].Allocate=n,S.celledtiend(S.BinsGrid.Table[0]),S.DisplayMessage="",S.OnSave("AutoSave"),""==S.DisplayMessage||a||s.a.page.ShowDialog(S,je.a)):s.a.page.ShowDialog(S,je.a)}}},{key:"fillbatches",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.ScreenObject.Preferences.ContainsKey("SameBatchtoall")||"true"!=this.ScreenObject.Preferences.SameBatchtoall.toLowerCase()){if(this.ScreenObject.Preferences.ContainsKey("BatchBasedon")&&""!=this.ScreenObject.Preferences.BatchBasedon){if(this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.Preferences.BatchBasedon)&&"1"==e[this.ScreenObject.Preferences.BatchBasedon].toString())return;var i=this.ScreenObject._TextFields.find((function(e){return e instanceof h.d&&e.DBColumnName.toLowerCase()==t.ScreenObject.Preferences.BatchBasedon.toLowerCase()}));if(i&&"1"==i.Text)return}var r=this.VoucherType;38==this.ScreenObject.DocumentType&&!o.e.IsEmpty(e.Quantity)&&parseFloat(e.Quantity.toString())<0&&(r=1),30==this.ScreenObject.DocumentType&&(r=this.ScreenObject.GridDataColumns.Contains("VoucherType")&&!o.e.IsEmpty(e.VoucherType)?parseInt(e.VoucherType):0);var c="";if(32==this.DocumentType){r=0;var u=this.ScreenObject.ColumnSource.find((function(e){return e.ID==t.ScreenObject.Preferences.VarienceField}));u&&(c=u.DisplayMember),""==c||o.e.IsEmpty(e[c])||(parseFloat(e[c])<0?r=-1:parseFloat(e[c])>0&&(r=1))}else 31==this.DocumentType&&""!=n&&(r=1,c=n);var d=null;if(-1==r){var D=0;if(o.e.IsEmpty(e.DocDetailsID)||(D=parseInt(e.DocDetailsID)),s.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise Batches")&&""!=s.a.SessionManager.Preferences["Maintain Dimensionwise Batches"].toString()){var S=0;if(o.e.Int(s.a.SessionManager.Preferences["Maintain Dimensionwise Batches"].toString())>0){S=parseInt(s.a.SessionManager.Preferences["Maintain Dimensionwise Batches"].toString());var m=this.ScreenObject._CCFields.find((function(e){return e instanceof C.b&&e.CCID==S}));if(null!=m){if(m.SelectedValue<1)return this.DisplayMessage=s.a.GetResource("Select")+" "+m.Label,void(this.MessageVisibility=!0)}else if(this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(S-5e4).toString()+"_Key")&&""==e["dcCCNID"+(S-5e4).toString()+"_Key"].toString()){var b=this.ScreenObject.ColumnSource.find((function(e){return e.CostCenterID==S}));if(null!=b)return this.DisplayMessage=s.a.GetResource("Select")+" "+b.Header,void(this.MessageVisibility=!0)}}}if(!(null!=(d=this.ScreenObject.GetProductwiseBatches(parseInt(e.ProductID_Key),D,r,e,0,!1))&&d.Tables.length>0))return void(this.DisplayMessage=s.a.GetResource("Batch_PrdNoBtch").toString());if(d.Tables.length>1&&d.Tables[1].length>0&&d.Columns[1].Contains("ErrorMessage"))return void(this.DisplayMessage=d.Tables[1][0].ErrorMessage.toString());if(!(d.Tables[0].length>0&&d.Columns[0].Contains("BalQty")))return void(this.DisplayMessage=s.a.GetResource("Batch_PrdNoBtch").toString())}var y=0,p=0;if(this.ScreenObject.Preferences.ContainsKey("Donotuselocation")&&""!=this.ScreenObject.Preferences.Donotuselocation&&Object(l.j)(this.ScreenObject.Preferences.Donotuselocation)){var g=this.ScreenObject._CCFields.find((function(e){return"dcccnid2"==e.DBColumnName.toLowerCase()}));g&&g instanceof C.b&&g.SelectedValue>0?p=g.SelectedValue:null==e||o.e.IsEmpty(e.dcCCNID2_Key)||(p=parseInt(e.dcCCNID2_Key))}else p=this.ScreenObject.LocationID>0?this.ScreenObject.LocationID:s.a.SessionManager.LocationID;if(y=this.ScreenObject.DivisionID>0?this.ScreenObject.DivisionID:s.a.SessionManager.DivisionID,0!=r){var f=0;if(f=""==c||o.e.IsEmpty(e[c])?!o.e.IsEmpty(e.SchemeID)&&parseInt(e.SchemeID)>0&&"Y"==e.IsScheme.toString()&&this.ScreenObject.GridDataColumns.Contains("FreeQTY")&&!o.e.IsEmpty(e.FreeQTY)?parseFloat(e.FreeQTY):parseFloat(e.Quantity):parseFloat(e[c].toString().replace("-","")),o.e.IsEmpty(e.UOMConversion)||(f*=parseFloat(e.UOMConversion)),38==this.ScreenObject.DocumentType&&!o.e.IsEmpty(e.Quantity)&&parseFloat(e.Quantity.toString())<0&&(f*=-1),this.ScreenObject.Preferences.ContainsKey("ExcludeHold")&&!o.e.IsEmpty(this.ScreenObject.Preferences.ExcludeHold)&&Object(l.j)(this.ScreenObject.Preferences.ExcludeHold)&&this.ScreenObject.GridDataColumns.Contains("HoldQuantity")){var O=this.ScreenObject.ColumnSource.find((function(e){return"HoldQuantity"==e.DisplayMember}));O&&!o.e.IsEmpty(O.Formula)&&this.CalculateTotals(e,!1),f=!o.e.IsEmpty(e.HoldQuantity)&&parseFloat(e.HoldQuantity)>0?parseFloat(e.HoldQuantity):0}if(this.ScreenObject.Preferences.ContainsKey("ExcludeReserve")&&""!=this.ScreenObject.Preferences.ExcludeReserve.toString()&&Object(l.j)(this.ScreenObject.Preferences.ExcludeReserve)&&this.ScreenObject.GridDataColumns.Contains("ReserveQuantity")){var I=this.ScreenObject.ColumnSource.find((function(e){return"ReserveQuantity"==e.DisplayMember}));I&&!o.e.IsEmpty(I.Formula)&&this.CalculateTotals(e,!1),f=!o.e.IsEmpty(e.ReserveQuantity)&&parseFloat(e.ReserveQuantity)>0?parseFloat(e.ReserveQuantity):0}if(-1==r&&31!=this.DocumentType&&32!=this.DocumentType&&d.Tables[0].length>0&&d.Columns[0].Contains("BalQty")){var T=d.Tables[0].Compute("sum","BalQty");if(null!=T&&(T=parseFloat(T).ToString("N"+s.a.SessionManager.Preferences.DecimalsinQty),f=parseFloat(parseFloat(f).ToString("N"+s.a.SessionManager.Preferences.DecimalsinQty)),parseFloat(T)<f))return this.DisplayMessage="Allocated batch quantity is less than document quantity.",void(this.MessageVisibility=!0)}if(f>0||this.ScreenObject.Preferences.ContainsKey("QtyonBatch")&&""!=this.ScreenObject.Preferences.QtyonBatch&&Object(l.j)(this.ScreenObject.Preferences.QtyonBatch)){var j=new Pe.a(this.ScreenObject.GridDataObj);j.BatchNumberViewModel_4(this,r,f,d,parseInt(e.ProductID_Key),e.ProductName.toString(),p,y,c,e),a?(j.AdjusFifo(!0),j.OnSave("AutoSave")):f>0&&this.ScreenObject.Preferences.ContainsKey("Autobatchifsingle")&&Object(l.j)(this.ScreenObject.Preferences.Autobatchifsingle)&&1==d.Tables[0].length&&""==n?(j.AdjusFifo(!0),j.OnSave("AutoSave"),j.count>1&&this.ScreenObject.UpdateSequence()):s.a.page.ShowDialog(j,Ae.a).subscribe((function(){j.count>1&&t.ScreenObject.UpdateSequence()}))}}}}},{key:"Celleditend",value:function(e,t,n){var a=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;try{var r=t,c="";Logger.InfoLog("AddEditDocumentViewModel::Entering OnCellEditEnding");var u=1,d=1;if(this.Currency&&null!=this.Currency.Currency.SelectedValue&&""!=this.Currency.Currency.SelectedValue?u=parseInt(this.Currency.Currency.SelectedValue):this.ScreenObject.GridDataColumns.Contains("CurrencyID")&&!o.e.IsEmpty(e.CurrencyID_Key)&&(u=parseInt(e.CurrencyID_Key)),this.Currency&&!o.e.IsEmpty(this.Currency.ExchangeRate.Text)?d=parseFloat(this.Currency.ExchangeRate.Text):this.ScreenObject.GridDataColumns.Contains("ExchangeRate")&&!o.e.IsEmpty(e.ExchangeRate)&&(d=parseFloat(e.ExchangeRate)),this.ScreenObject.Preferences.ContainsKey("BudgetAnnualAmount")&&this.ScreenObject.Preferences.BudgetAnnualAmount==t){if("0"!=this.ScreenObject.Preferences.BudgetType){var D=12;"1"==this.ScreenObject.Preferences.BudgetType?D=2:"2"==this.ScreenObject.Preferences.BudgetType&&(D=4);var m=0;if((m=o.e.Double(e[t]))!=o.e.Double(this.PrevValue)){for(var b=0,y=parseFloat((m/D).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount)),g=1;g<D;g++)e[this.ScreenObject.Preferences["BudgetField"+g]]=y,this.ScreenObject.Preferences["BudgetField"+g].startsWith("dcNum")&&(e["dcCalc"+this.ScreenObject.Preferences["BudgetField"+g]]=y),b+=y;e[this.ScreenObject.Preferences["BudgetField"+D]]=parseFloat((m-b).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount)),this.ScreenObject.Preferences["BudgetField"+D].startsWith("dcNum")&&(e["dcCalc"+this.ScreenObject.Preferences["BudgetField"+D]]=y)}}return}var O=this.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember==t}));if(!O&&t&&(O=this.ScreenObject.ColumnSource.find((function(e){return"Name"==e.DisplayMember&&e.ValueBinding==t}))),68!=this.ScreenObject.DocumentType&&70!=this.ScreenObject.DocumentType&&80!=this.ScreenObject.DocumentType&&67!=this.ScreenObject.DocumentType||(t&&t.endsWith("_Key")&&(t=t.replace("_Key",""),O=this.ScreenObject.ColumnSource.find((function(e){return e.ValueBinding==t}))),70!=this.ScreenObject.DocumentType&&67!=this.ScreenObject.DocumentType||this.FillDefaultValues(e)),"ProductName"!=t&&"ProductCode"!=t||(t="ProductID"),"DueDate"!=t||31!=this.ScreenObject.DocumentType||o.e.IsEmpty(e.DueDate_Key)||this.GetProductValues(e,0),"Quantity"==t){if(!o.e.IsEmpty(e.Quantity)&&this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&this.ScreenObject.Preferences.ContainsKey("DuplicateProduct_IncrementQuantity")&&""!=this.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity&&Object(l.j)(this.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity)&&!o.e.IsEmpty(e.ProductID_Key)&&parseInt(e.ProductID_Key)!=this.ScreenObject.TempProductID&&(o.e.IsEmpty(e.LinkedInvDocDetailsID)||"0"==e.LinkedInvDocDetailsID.toString())&&this.AddProductQty(e,!0),o.e.IsEmpty(e.Quantity)||o.e.IsEmpty(e.UOMConversion)||!o.e.IsNum(e.UOMConversion)?o.e.IsEmpty(e.Quantity)||(e.UOMConvertedQty=e.Quantity):e.UOMConvertedQty=o.e.Double(e.UOMConversion)*parseFloat(e.Quantity),o.e.String(e.Quantity)!=this.PrevValue){if(this.GetProductValues(e,0,!1,null,!0),"3"==o.e.String(e.Type)){var I=new ce(this,e,null);I.FooterGridData.length>0&&I.OnfooterQtyChanged(I.FooterGridData[0]),I.OnButtonClick("AutoSave")}if(!o.e.IsEmpty(e.LinkedInvDocDetailsID)&&"Quantity"==e.LinkedFieldName.toString()){var T=this.ScreenObject.ColumnSource.filter((function(e){return e.IsPartialLinking}));if(T.length>0){var j=this.ScreenObject.GetDetailsByInvDetID(e.LinkedInvDocDetailsID.toString());T.forEach((function(t){a.ScreenObject.SetLinkValues(j,t,0,e,null,e.Quantity.toString())}))}}}if(!o.e.IsEmpty(e.Quantity)&&parseFloat(e.Quantity)>0&&this.ScreenObject.GridDataColumns.Contains("FreeQTY")&&1==o.e.Int(e.SchemeID)&&(e.FreeQTY=0,e.IsScheme=null,e.MaxSchemeID=null,e.SchemeID=null),this.ScreenObject.Preferences.ContainsKey("SubstituteOnQty")&&this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.Preferences.SubstituteOnQty)&&!o.e.IsEmpty(e.ProductID_Key)&&!o.e.IsEmpty(e.Quantity)&&!o.e.IsEmpty(e[this.ScreenObject.Preferences.SubstituteOnQty])&&parseFloat(e.Quantity)>parseFloat(e[this.ScreenObject.Preferences.SubstituteOnQty])){var P=this.ScreenObject.GetSubtituteProducts(parseInt(e.ProductID_Key),this.DocumentDate,e.DocDetailsID.toString(),e);if(P.Tables.length>0&&!P.Columns[0].Contains("ErrorMessage")&&P.Tables[0].length>0){var A=new me.a(this,P.Tables[0],P.Columns[0],P.Tables[1],e.ProductName.toString(),e.ProductCode.toString(),e.ProductID_Key.toString());A.GridData.length>0&&s.a.page.ShowDialog(A,be.a,{ShowCenter:!0})}}if(this.ScreenObject.Preferences.ContainsKey("UseQtyAdjustment")&&""!=this.ScreenObject.Preferences.UseQtyAdjustment&&Object(l.j)(this.ScreenObject.Preferences.UseQtyAdjustment)&&this.ScreenObject.GridDataColumns.Contains("QtyType")&&1==o.e.Int(e.QtyType)){var M=new ue(this,1);s.a.page.ShowDialog(M,de.a,{ShowCenter:!0})}}else if("FreeQTY"==t&&o.e.Double(e.FreeQTY)>0&&o.e.IsEmpty(e.IsScheme)){if(o.e.Double(e.Quantity)>0)return void(this.DisplayMessage="Can not enter both qty and free qty");e.IsScheme="Y";var v=0,G=this.ScreenObject.GridData.Compute("max","MaxSchemeID");null!=G&&(v=o.e.Int(G)),v++,e.MaxSchemeID=v,e.SchemeID=1,o.e.Double(e.FreeQTY)>0&&(e.UOMConvertedQty=o.e.IsEmpty(e.UOMConversion)?e.FreeQTY.toString():parseFloat(e.FreeQTY)*parseFloat(e.UOMConversion))}if(this.ScreenObject.Preferences.ContainsKey("QtyAdjustmentField")&&(this.ScreenObject.Preferences.QtyAdjustmentField==t||"Gross"==t&&"dcNum"==this.ScreenObject.Preferences.QtyAdjustmentField)&&s.a.page.ShowDialog(new ue(this,1),de.a,{ShowCenter:!0}),n>0){if(11==n)this.OnProductUnitChange(e);else if(12==n){var N=t;N=N.substr(8,N.length-8),this.ScreenObject.GridDataColumns.Contains(t+"_Key")&&!o.e.IsEmpty(e[t+"_Key"])&&("currencyid"==t.toLowerCase().toString()&&this.ScreenObject.GridDataColumns.Contains("ExchangeRate")?e.ExchangeRate=this.ScreenObject.GetExchangeRate(parseInt(e[t+"_Key"]),this.DocumentDate.OnlyDate()):this.ScreenObject.GridDataColumns.Contains("dcExchRT"+N)&&(e["dcExchRT"+N]=this.ScreenObject.GetExchangeRate(parseInt(e[t+"_Key"]),this.DocumentDate.OnlyDate())))}else if(2==n){if(O&&!o.e.IsEmpty(e[O.ValueMember])){if(!this.IsInventoryVoucher&&this.ScreenObject.IsDocEdit&&e[O.ValueMember].toString()!=this.PrevValue&&(e.Type=!!this.IsAccBillWise(parseInt(e[O.ValueMember]))||null),this.IsInventoryVoucher||this.ScreenObject.IsDocEdit||e[O.ValueMember].toString()==this.PrevValue||this.FillDefaultValues(e),(5==this.DocumentType||8==this.DocumentType||13==this.DocumentType)&&this.ScreenObject.Preferences.ContainsKey("BudgetFeild")&&!o.e.IsEmpty(this.ScreenObject.Preferences.BudgetFeild)&&e[O.ValueMember].toString()!=this.PrevValue){var E=this.ScreenObject._TextFields.find((function(e){return e.DBColumnName.toLowerCase()==a.ScreenObject.Preferences.BudgetFeild.toLowerCase()}));if(null!=E&&E.SelectedValue>0){var w=null,F=null;if(8==this.DocumentType||13==this.DocumentType?(O.ValueMember.toLowerCase().Contains("creditaccount")||O.ValueMember.toLowerCase().Contains("debitaccount"))&&(w=this.ScreenObject.FillBudgetDims(!0,E.SelectedValue,e,e[O.ValueMember].toString())):O.ValueMember.toLowerCase().Contains("creditaccount")?w=this.ScreenObject.FillBudgetDims(!1,E.SelectedValue,e,e[O.ValueMember].toString()):O.ValueMember.toLowerCase().Contains("debitaccount")&&(w=this.ScreenObject.FillBudgetDims(!0,E.SelectedValue,e,e[O.ValueMember].toString())),1==w.Tables[0].length&&(F=w.Tables[0][0]),null!=F)for(var V=0;V<Object.keys(F).length;V++)this.ScreenObject.GridDataColumns.Contains(Object.keys(F)[V])&&!o.e.IsEmpty(F[Object.keys(F)[V]])&&(e[Object.keys(F)[V]]=F[Object.keys(F)[V]].toString())}}this.ScreenObject.GridDataObj.updateRow(e)}}else this.IsInventoryVoucher&&n>5e4&&this.ScreenObject.PriceTaxcc.ContainsKey(n)&&this.ScreenObject.GridDataColumns.Contains(t+"_Key")&&o.e.String(e[t+"_Key"])!=this.PrevValue&&!o.e.IsEmpty(e.ProductID_Key)&&parseInt(e.ProductID_Key)>0?this.ReEvaluatePriceTax_3(e,n):38!=this.ScreenObject.DocumentType&&39!=this.ScreenObject.DocumentType||!s.a.SessionManager.Preferences.ContainsKey("POSItemCodeDimension")||s.a.SessionManager.Preferences.POSItemCodeDimension!=n.toString()||o.e.String(e[t+"_Key"])==this.PrevValue||!o.e.IsEmpty(e.ProductID_Key)&&parseInt(e.ProductID_Key)>0||this.AddProductData(e,!1,!1,!1,null,e[t].toString());if(this.ScreenObject.Preferences.ContainsKey("DimWiseAttachments")&&this.ScreenObject.Preferences.DimWiseAttachments==n.toString()&&O&&O.ValueMember&&!o.e.IsEmpty(e[O.ValueMember])&&parseInt(e[O.ValueMember])>0&&e[O.ValueMember].toString()!=this.PrevValue&&1==this.ScreenObject.GridData.find((function(t){return t[O.DisplayMember+"_Key"]==e[O.ValueMember]})).length){var L=this.ScreenObject.GetFiles(n,parseInt(e[O.ValueMember]));L.Tables.length>0&&L.Tables[0].length>0&&this.DimWiseAttachment(L.Tables[0],e[O.DisplayMember].toString())}45==this.DocumentType&&null!=this.ProjDims&&this.ProjDims.Contains(n)&&this.FillWBS(!1)}if(45==this.DocumentType){if((t.startsWith("dcCCNID")||"dcalpha15"==t.toLowerCase()||"dcalpha16"==t.toLowerCase())&&("dcalpha15"==t.toLowerCase()&&Object.keys(e).Contains("dcAlpha15_Key")&&!o.e.IsEmpty(e.dcAlpha15_Key)&&(e.dcAlpha15=new Date(e.dcAlpha15_Key).ToString(s.a.SessionManager.Preferences["Date Format"]+" hh:mm a")),"dcalpha16"==t.toLowerCase()&&Object.keys(e).Contains("dcAlpha16_Key")&&!o.e.IsEmpty(e.dcAlpha16_Key)&&(e.dcAlpha16=new Date(e.dcAlpha16_Key).ToString(s.a.SessionManager.Preferences["Date Format"]+" hh:mm a")),"dcalpha22"==t.toLowerCase()&&Object.keys(e).Contains("dcAlpha22_Key")&&!o.e.IsEmpty(e.dcAlpha22_Key)&&(e.dcAlpha22=new Date(e.dcAlpha22_Key).ToString(s.a.SessionManager.Preferences["Date Format"]+" hh:mm a")),"dcalpha23"==t.toLowerCase()&&Object.keys(e).Contains("dcAlpha23_Key")&&!o.e.IsEmpty(e.dcAlpha23_Key)&&(e.dcAlpha23=new Date(e.dcAlpha23_Key).ToString(s.a.SessionManager.Preferences["Date Format"]+" hh:mm a")),null==this.dsProjWOffHol&&this.InitProjWOffsHolidays(),null!=this.dsProjWOffHol)){var R=!1;if(this.ScreenObject.Preferences.ContainsKey("ConsiderWeeklyOffsAndHolidays")&&!o.e.IsEmpty(this.ScreenObject.Preferences.ConsiderWeeklyOffsAndHolidays)&&(R=Object(l.j)(this.ScreenObject.Preferences.ConsiderWeeklyOffsAndHolidays)),this.ScreenObject.GridDataColumns.Contains("dcAlpha15_Key")&&!o.e.IsEmpty(e.dcAlpha15_Key)&&this.ScreenObject.GridDataColumns.Contains("dcAlpha16_Key")&&!o.e.IsEmpty(e.dcAlpha16_Key)&&e[t+"_Key"].toString()!=this.PrevValue){var B=0,x=0,k={odWHrs:B,odHrsPerDay:x},_=o.e.GetNoOfDays(this.dsProjWOffHol,new Date(e.dcAlpha15_Key),new Date(e.dcAlpha16_Key),R,e,this.DocumentDate,k);B=k.odWHrs,x=k.odHrsPerDay,e.dcAlpha17=_.toString(),e.dcAlpha30=x.ToString("0.00"),e.dcAlpha31=o.e.IsEmpty(e.dcAlpha30)?"0":B.ToString("0.00"),o.e.IsEmpty(e.dcAlpha30)||o.e.IsEmpty(e.dcAlpha31)||(e.dcAlpha32=parseFloat(e.dcAlpha30)>0?(parseFloat(e.dcAlpha31)/parseFloat(e.dcAlpha30)).ToString("0.00"):"0")}}(this.ScreenObject.GridDataColumns.Contains(t+"_Key")&&o.e.String(e[t+"_Key"])!=this.PrevValue&&!o.e.IsEmpty(e[t+"_Key"])&&("dcalpha15"==t.toLowerCase()||"dcalpha16"==t.toLowerCase())||"dcalpha18"==t.toLowerCase()||"dcalpha30"==t.toLowerCase()||"dcalpha31"==t.toLowerCase()||"dcalpha32"==t.toLowerCase()&&e[t].toString()!=this.PrevValue)&&this.FillWBS(!1)}if(this.NumFieldEditOptionValidation(O,e),this.ScreenObject.Data.Tables.length>0){var K=this.ScreenObject.Data.Tables[0];if(K.length>0&&O&&O.CostCenterID>0){if(3!=O.CostCenterID&&(((K=this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&e.LocalReference==O.ID}))).length>0||s.a.SessionManager.Preferences.ContainsKey("LW CreditDebit")&&""!=s.a.SessionManager.Preferences["LW CreditDebit"]&&Object(l.j)(s.a.SessionManager.Preferences["LW CreditDebit"])&&50002==O.CostCenterID||s.a.SessionManager.Preferences.ContainsKey("DW CreditDebit")&&""!=s.a.SessionManager.Preferences["DW CreditDebit"]&&Object(l.j)(s.a.SessionManager.Preferences["DW CreditDebit"])&&50001==O.CostCenterID||s.a.SessionManager.Preferences.ContainsKey("DimWiseCreditDebit")&&""!=s.a.SessionManager.Preferences.DimWiseCreditDebit&&parseInt(s.a.SessionManager.Preferences.DimWiseCreditDebit)==O.CostCenterID||2==O.CostCenterID&&17==this.ScreenObject.DocumentType&&this.ScreenObject.Preferences.ContainsKey("Use Account-wise Currency")&&""!=this.ScreenObject.Preferences["Use Account-wise Currency"]&&Object(l.j)(this.ScreenObject.Preferences["Use Account-wise Currency"])&&!this.IsInventoryVoucher||2==O.CostCenterID&&(15==this.DocumentType||14==this.DocumentType)&&!this.IsInventoryVoucher&&"CreditAccount"==t||2==O.CostCenterID&&!this.IsInventoryVoucher&&this.ScreenObject.Preferences.ContainsKey("Account-wiseAttachments")&&""!=this.ScreenObject.Preferences["Account-wiseAttachments"]&&Object(l.j)(this.ScreenObject.Preferences["Account-wiseAttachments"])||O.Filter>0&&this.IsInventoryVoucher||this.ScreenObject.Preferences.ContainsKey("DefaultProfileID")&&""!=this.ScreenObject.Preferences.DefaultProfileID&&parseInt(this.ScreenObject.Preferences.DefaultProfileID)>0&&this.ScreenObject.DefaultBasedOn.ContainsKey(O.CostCenterID.toString()))&&O.ValueMember&&!o.e.IsEmpty(e[O.ValueMember])&&parseInt(e[O.ValueMember])>0&&e[O.ValueMember].toString()!=this.PrevValue&&this.ScreenObject.GetLinkReferenceData(parseInt(O.ID),this.DocumentID,parseInt(e[O.ValueMember]),Date.Today(),t,O.CostCenterID,e),2==O.CostCenterID)){var Q=this.ScreenObject.ColumnSource.filter((function(e){return!o.e.IsEmpty(e.ValueMember)&&e.ValueMember.toLowerCase()==O.ValueMember.toLowerCase()}));Q.length>1&&""!=O.ValueMember&&e[O.ValueMember]&&!o.e.IsEmpty(e[O.ValueMember])&&(Q[0]==O?(K=this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&e.LocalReference==Q[Q.length-1].ID}))).length>0&&this.ScreenObject.GetLinkReferenceData(parseInt(Q[Q.length-1].ID),this.DocumentID,parseInt(e[O.ValueMember]),Date.Today(),"",O.CostCenterID,e):(K=this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&e.LocalReference==Q[0].ID}))).length>0&&this.ScreenObject.GetLinkReferenceData(parseInt(Q[0].ID),this.DocumentID,parseInt(e[O.ValueMember]),Date.Today(),"",O.CostCenterID,e))}if("ProductID"==t&&this.ScreenObject.Data.Tables.length>6&&this.ScreenObject.Data.Tables[6].length>0&&this.ScreenObject.Preferences.ContainsKey("Productwise")&&null!=this.ScreenObject.Preferences.Productwise&&Object(l.j)(this.ScreenObject.Preferences.Productwise)&&!o.e.IsEmpty(e.ProductID_Key)){var H=function(){var t=a.ScreenObject.GetProductLinkDetails(a.DocumentID,parseInt(e.ProductID_Key),a.ScreenObject.DocDate.Date.ToString("dd/MMM/yyyy"),a.ScreenObject.DueDate&&a.ScreenObject.DueDate.Date?a.ScreenObject.DueDate.Date.ToString("dd/MMM/yyyy"):"",e);if(null!=t&&t.Tables.length>0&&t.Tables[0].length>0)for(var n=function(e){var n=a.ScreenObject.GridData.filter((function(n){return 0==n.DocDetailsID&&n.LinkedInvDocDetailsID==t.Tables[0][e].DocDetailsID}));if(n.length>0){for(var r=t.Columns[0][0],s=t.Columns[0][1],c=0,l=0;l<n.length;l++)o.e.IsNum(n[l][t.Tables[0][e][s].toString()])&&(c+=parseFloat(n[l][t.Tables[0][e][s].toString()]));if(!(o.e.IsNum(t.Tables[0][e][r])&&parseFloat(t.Tables[0][e][r])-c>0))return t.Tables[0].RemoveAt(e),t.Tables[1].RemoveAt(e),t.Tables[2].RemoveAt(e),t.Tables[3].RemoveAt(e),e--,i=e,"continue";t.Tables[0][e][r]=parseFloat(t.Tables[0][e][r])-c}i=e},i=0;i<t.Tables[0].length;i++)n(i);if(null!=t&&t.Tables.length>0&&t.Tables[0].length>0)return{v:void s.a.page.ShowDialog(new ne(a,e.ProductID_Key.toString(),t,a.ScreenObject.GridData.indexOf(e)),ae.a)}}();if("object"==typeof H)return H.v}}}if(this.IsInventoryVoucher){if(!this.DonotUpdateInventory&&("Quantity"==t||"RecievedQty"==t||"FreeQTY"==t)&&""!=o.e.String(e.Type)&&2==parseInt(o.e.String(e.Type))&&(30==this.ScreenObject.DocumentType&&(this.VoucherType=this.ScreenObject.GridDataColumns.Contains("VoucherType")&&!o.e.IsEmpty(e.VoucherType)?parseInt(e.VoucherType):0),!o.e.IsEmpty(e[t])&&parseFloat(e[t])>0)){var W=new ye(this,t,this.VoucherType,0,e);1==this.VoucherType&&null!=W.ds&&W.ds.Tables.length>3&&W.ds.Tables[3].length>0&&!o.e.IsEmpty(W.ds.Tables[3][0][0])?this.AutoSerialNumber(e,W):s.a.page.ShowDialog(W,pe.a)}if(this.ScreenObject.Preferences.ContainsKey("EnableAssetSerialNo")&&"true"==this.ScreenObject.Preferences.EnableAssetSerialNo.toLowerCase()&&"Quantity"==t){var U=0;if(this.ScreenObject.Preferences.ContainsKey("AssetBasedOn")&&this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.Preferences.AssetBasedOn)?"0"==e[this.ScreenObject.Preferences.AssetBasedOn].toString()?U=0:"2"!=e[this.ScreenObject.Preferences.AssetBasedOn].toString()&&"1"!=e[this.ScreenObject.Preferences.AssetBasedOn].toString()||o.e.IsEmpty(e.Quantity)?"3"!=e[this.ScreenObject.Preferences.AssetBasedOn].toString()&&"4"!=e[this.ScreenObject.Preferences.AssetBasedOn].toString()||(U=1):U=parseFloat(e.Quantity):o.e.IsEmpty(e.Quantity)||(U=parseFloat(e.Quantity)),U>0){var X=new ye(this,t,1,U,e);null!=X.ds&&X.ds.Tables.length>3&&X.ds.Tables[3].length>0&&!o.e.IsEmpty(X.ds.Tables[3][0][0])?this.AutoSerialNumber(e,X):s.a.page.ShowDialog(X,pe.a)}}if(-1==this.VoucherType&&this.ScreenObject.Preferences.ContainsKey("AutoBatches")&&""!=this.ScreenObject.Preferences.AutoBatches.toString()&&Object(l.j)(this.ScreenObject.Preferences.AutoBatches)&&(i=1),1!=i&&(this.ScreenObject.Preferences.ContainsKey("ShowBatches")&&""!=this.ScreenObject.Preferences.ShowBatches&&Object(l.j)(this.ScreenObject.Preferences.ShowBatches)||!this.DonotUpdateInventory||32==this.DocumentType||this.ScreenObject.Preferences.ContainsKey("ExcludeReserve")&&""!=this.ScreenObject.Preferences.ExcludeReserve.toString()&&Object(l.j)(this.ScreenObject.Preferences.ExcludeReserve)&&this.ScreenObject.GridDataColumns.Contains("ReserveQuantity")||this.ScreenObject.Preferences.ContainsKey("ExcludeHold")&&""!=this.ScreenObject.Preferences.ExcludeHold.toString()&&Object(l.j)(this.ScreenObject.Preferences.ExcludeHold)&&this.ScreenObject.GridDataColumns.Contains("HoldQuantity")))if(32!=this.DocumentType||o.e.IsEmpty(e.Type)||5!=parseInt(o.e.String(e.Type)))"Quantity"==t&&!o.e.IsEmpty(e.Type)&&5==parseInt(e.Type)&&(!o.e.IsEmpty(e.Quantity)||this.ScreenObject.Preferences.ContainsKey("QtyonBatch")&&""!=this.ScreenObject.Preferences.QtyonBatch&&Object(l.j)(this.ScreenObject.Preferences.QtyonBatch))?this.fillbatches(e):"FreeQTY"!=t||o.e.IsEmpty(e.Type)||5!=parseInt(e.Type)||o.e.IsEmpty(e.FreeQTY)||this.fillbatches(e);else{var q="",Y=this.ScreenObject.ColumnSource.find((function(e){return e.ID==a.ScreenObject.Preferences.VarienceField}));Y&&(q=Y.DisplayMember),t==q&&this.fillbatches(e)}if("Quantity"!=t||!this.ScreenObject.GridDataColumns.Contains("landingType")||"1"!=o.e.String(e.landingType)&&"2"!=o.e.String(e.landingType)){if("Quantity"==t&&"2"!=o.e.String(e.Type)&&("5"!=o.e.String(e.Type)||this.ScreenObject.Preferences.ContainsKey("SameBatchtoall")&&"true"==this.ScreenObject.Preferences.SameBatchtoall.toLowerCase())&&"true"==o.e.LowerCase(e.BinWise)&&!o.e.IsEmpty(e.Quantity))this.AddBins(e,!1,!0,null);else if("RecievedQty"==t&&"2"!=o.e.String(e.Type)&&!o.e.IsEmpty(e.BinWise)&&"true"==o.e.LowerCase(e.BinWise)&&!o.e.IsEmpty(e.RecievedQty)){var z,J=0;s.a.SessionManager.Preferences.ContainsKey("DimensionwiseBins")&&""!=s.a.SessionManager.Preferences.DimensionwiseBins.toString()&&(J=o.e.Int(s.a.SessionManager.Preferences.DimensionwiseBins)),z=parseFloat(e.RecievedQty)>0?parseFloat(e.RecievedQty):0,this.ScreenObject.GridDataColumns.Contains("UOMConversion")&&!o.e.IsEmpty(e.UOMConversion)&&(z*=parseFloat(e.UOMConversion)),this.AddToWarehouseBins(J,e,z,!1)}}else 0==s.a.page.DialogCount&&s.a.page.ShowDialog(new ue(this,2),de.a,{ShowCenter:!0});if("ProductName"!=r&&"ProductCode"!=r||null==e.ProductID_Key||o.e.IsEmpty(e.ProductID_Key))if("ProductName"!=r&&"ProductCode"!=r||o.e.IsEmpty(e.ProductID_Key)){if(35==this.ScreenObject.DocumentType&&("dcAlpha13"==r||"dcAlpha14"==r)){var Z=new Date,$=new Date;o.e.IsEmpty(e.dcAlpha13)||(Z=new Date(e.dcAlpha13_Key)),o.e.IsEmpty(e.dcAlpha14)||($=new Date(e.dcAlpha14_Key)),null!=Z&&null!=$&&Z.getFullYear()>1&&$.getFullYear()>1&&(e.dcAlpha15=this.DocumentDate>=Z&&this.DocumentDate<=$?"Warranty":"Out of Warranty")}}else this.ScreenObject.Preferences.ContainsKey("Dontresetvaluesonproductchange")&&""!=this.ScreenObject.Preferences.Dontresetvaluesonproductchange&&Object(l.j)(this.ScreenObject.Preferences.Dontresetvaluesonproductchange)||this.ClearDatarow(e,!1);else{if(this.ScreenObject.Preferences.ContainsKey("Dontresetvaluesonproductchange")&&""!=this.ScreenObject.Preferences.Dontresetvaluesonproductchange&&Object(l.j)(this.ScreenObject.Preferences.Dontresetvaluesonproductchange)&&this.ProdID>0){if(this.ProdID!=parseInt(e.ProductID_Key)&&0!=parseInt(e.ProductID_Key)){var ee,te=this.GetProductValues(e,0);if(null!=te&&te.Tables.length>0&&te.Tables[0].length>0&&!te.Columns[0].Contains("ErrorMessage")&&(e.Type=te.Tables[0][0].ProductTypeID.toString(),this.ScreenObject.GridDataColumns.Contains("BinWise")&&te.Columns[0].Contains("BinWise")&&(e.BinWise=o.e.String(te.Tables[0][0].BinWise)),this.ScreenObject.GridDataColumns.Contains("QtyType")&&te.Columns[0].Contains("QtyAdjustType")&&(e.QtyType=o.e.String(te.Tables[0][0].QtyAdjustType)),this.ScreenObject.GridDataColumns.Contains("PackType")&&te.Columns[0].Contains("IsPacking")&&(e.PackType=o.e.String(te.Tables[0][0].IsPacking)),this.ScreenObject.GridDataColumns.Contains("IsTestCase")&&te.Columns[0].Contains("TestCaseExists")&&(e.IsTestCase=o.e.String(te.Tables[0][0].TestCaseExists)),this.ScreenObject.GridDataColumns.Contains("landingType")&&te.Columns[0].Contains("IsBillOfEntry")&&(e.landingType=o.e.String(te.Tables[0][0].IsBillOfEntry)),this.ScreenObject.GridDataColumns.Contains("SchemeProductID")&&(e.SchemeProductID=null),e.ExtraXML=null),this.ScreenObject.Preferences.ContainsKey("ResetFields")&&""!=this.ScreenObject.Preferences.ResetFields.toString())!function(){for(var t=[],n=a.ScreenObject.Preferences.ResetFields.toString().split(","),i=function(i){t.push(n[i]),a.ScreenObject.GridDataColumns.Contains(n[i])&&(e[n[i]]=null),a.ScreenObject.GridDataColumns.Contains(n[i]+"_Key")&&(e[n[i]+"_Key"]=null);var r=!1;if("debitaccount"==n[i].toLowerCase()&&a.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!o.e.IsEmpty(te.Tables[0][0].DrAccount))o.e.String(e.DebitAccount_Key)!=te.Tables[0][0].DrAccount.toString()&&(r=!0),e.DebitAccount_Key=te.Tables[0][0].DrAccount.toString(),a.ScreenObject.GridDataColumns.Contains("DebitAccount")?e.DebitAccount=te.Tables[0][0].DrName.toString():null!=(ee=a.ScreenObject.ColumnSource.find((function(e){return null!=e.ValueMember&&"debitaccount_key"==e.ValueMember.toLowerCase()})))&&(e[ee.DisplayMember]=te.Tables[0][0].DrName.toString()),r&&(ee=a.ScreenObject.ColumnSource.find((function(e){return null!=e.ValueMember&&"debitaccount_key"==e.ValueMember.toLowerCase()})),a.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&e.LocalReference==ee.ID})).length>0&&a.ScreenObject.GetLinkReferenceData(parseInt(O.ID),a.DocumentID,parseInt(e[ee.ValueMember]),new Date,"",ee.CostCenterID,e),s.a.SessionManager.Preferences.BudgetAccount.length>0&&s.a.SessionManager.Preferences.BudgetDimension.length>0&&a.BudgetObj.AutoLoadBudgetDimension(e,null));else if("creditaccount"==n[i].toLowerCase()&&a.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!o.e.IsEmpty(te.Tables[0][0].CrAccount))o.e.String(e.CreditAccount_Key)!=te.Tables[0][0].CrAccount.toString()&&(r=!0),e.CreditAccount_Key=te.Tables[0][0].CrAccount.toString(),a.ScreenObject.GridDataColumns.Contains("CreditAccount")?e.CreditAccount=te.Tables[0][0].CrName.toString():null!=(ee=a.ScreenObject.ColumnSource.find((function(e){return null!=e.ValueMember&&"creditaccount_key"==e.ValueMember.toLowerCase()})))&&(e[ee.DisplayMember]=te.Tables[0][0].CrName.toString()),r&&(ee=a.ScreenObject.ColumnSource.find((function(e){return null!=e.ValueMember&&"creditaccount_key"==e.ValueMember.toLowerCase()})),a.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&e.LocalReference==ee.ID})).length>0&&a.ScreenObject.GetLinkReferenceData(parseInt(O.ID),a.DocumentID,parseInt(e[ee.ValueMember]),new Date,"",ee.CostCenterID,e),s.a.SessionManager.Preferences.BudgetAccount.length>0&&s.a.SessionManager.Preferences.BudgetDimension.length>0&&a.BudgetObj.AutoLoadBudgetDimension(e,null));else{var c=te.Tables[4].filter((function(e){return e.SysColumnName=n[i]}));c.length>0?(e[n[i]]=o.e.String(c[0].Value),e["default"+n[i]]=o.e.String(c[0].Value)):(c=a.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName==n[i]&&null!=e.LinkData&&e.LinkData>0}))).length>0?a.FillLinkRefereceProducts(e,te.Tables[0],te.Tables[3].length>0?te.Tables[3][0]:null,o.e.String(c[0].LinkData)):"Unit"==n[i]&&te.Tables.length>0&&te.Columns[0].Contains("uomid")&&!o.e.IsEmpty(te.Tables[0][0].uomid)?(e.Unit=o.e.String(te.Tables[0][0].UnitName),e.Unit_Key=o.e.String(te.Tables[0][0].uomid)):"Rate"==n[i]&&(te.Tables.length>3&&te.Tables[3].length>0?1==a.ScreenObject.DocumentType||25==a.ScreenObject.DocumentType||2==a.ScreenObject.DocumentType||3==a.ScreenObject.DocumentType||4==a.ScreenObject.DocumentType||10==a.ScreenObject.DocumentType||26==a.ScreenObject.DocumentType||27==a.ScreenObject.DocumentType||34==a.ScreenObject.DocumentType||31==a.ScreenObject.DocumentType?o.e.IsEmpty(te.Tables[3][0].PurchaseRate)||(e.Rate=te.Tables[3][0].PurchaseRate):o.e.IsEmpty(te.Tables[3][0].SellingRate)||(e.Rate=te.Tables[3][0].SellingRate):te.Tables.length>0&&te.Tables[0].length>0&&(1==a.ScreenObject.DocumentType||25==a.ScreenObject.DocumentType||2==a.ScreenObject.DocumentType||3==a.ScreenObject.DocumentType||4==a.ScreenObject.DocumentType||10==a.ScreenObject.DocumentType||26==a.ScreenObject.DocumentType||27==a.ScreenObject.DocumentType||34==a.ScreenObject.DocumentType||31==a.ScreenObject.DocumentType?o.e.IsEmpty(te.Tables[0][0].PurchaseRate)||(e.Rate=te.Tables[0][0].PurchaseRate):o.e.IsEmpty(te.Tables[0][0].SellingRate)||(e.Rate=te.Tables[0][0].SellingRate)))}},r=0;r<n.length;r++)i(r);var c=a.ScreenObject.Data.Tables[0].filter((function(e){return t.Contains(e.SysColumnName)&&null!=e.LocalReference&&e.LocalReference==O.ID}));c.length>0&&a.ScreenObject.GetLinkReferenceData(parseInt(O.ID),a.DocumentID,parseInt(e.ProductID_Key),Date.Today(),"",3,e,n,!1);var l=a.ScreenObject.ColumnSource.find((function(e){return!o.e.IsEmpty(e.ValueMember)&&e.ValueMember.toLowerCase()==O.ValueMember.toLowerCase()&&e.ID!=O.ID}));l&&((c=a.ScreenObject.Data.Tables[0].filter((function(e){return t.Contains(e.SysColumnName)&&null!=e.LocalReference&&e.LocalReference==l.ID}))).length>0&&a.ScreenObject.GetLinkReferenceData(parseInt(l.ID),a.DocumentID,parseInt(e.ProductID_Key),Date.Today(),"",3,e,n,!1))}()}}else if(this.AddProductData(e,!1,!1),this.ScreenObject.GridDataColumns.Contains("SchemeProductID")&&(e.SchemeProductID=null),null!=this.barcodeValues&&this.barcodeValues.length>0){if(this.barcodeValues.keys.forEach((function(t){var n={Key:t,Value:a.barcodeValues[t]};if(a.ScreenObject.GridDataColumns.Contains(n.Key))if(a.ScreenObject.GridDataColumns.Contains(n.Key+"_Key")){var i=a.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember.toLowerCase()==n.Key.toLowerCase()}));if(i&&i.CostCenterID>0){var r=a.ScreenObject.GetCCListViewDataID(i.CostCenterID,i.TypeID,n.Value.toString());null!=r&&r.Tables.length>0&&r.Tables[0].length>0&&r.Columns[0].Contains("NodeID")&&!o.e.IsEmpty(r.Tables[0][0].NodeID)&&(e[n.Key+"_Key"]=r.Tables[0][0].NodeID.toString(),e[n.Key]=n.Value)}else if("DATE"==i.DataType||"DATETIME"==i.DataType){var c;o.e.isValidDate(n.Value)&&(c=new Date(n.Value),e[n.Key+"_Key"]=c,e[n.Key]=c.ToString("DATE"==i.DataType?s.a.SessionManager.Preferences["Date Format"]:s.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss tt"))}}else e[n.Key]=n.Value;else{var l=a.ScreenObject.ColumnSource.find((function(e){return!o.e.IsEmpty(e.ValueMember)&&e.ValueMember.toLowerCase()==n.Key.toLowerCase()+"_key"}));if(l&&l.CostCenterID>0){var u=a.ScreenObject.GetCCListViewDataID(l.CostCenterID,l.TypeID,n.Value.toString());null!=u&&u.Tables.length>0&&u.Tables[0].length>0&&u.Columns[0].Contains("NodeID")&&!o.e.IsEmpty(u.Tables[0][0].NodeID)&&(e[l.ValueMember]=u.Tables[0][0].NodeID.toString(),e[l.DisplayMember]=n.Value)}}})),this.barcodeValues.ContainsKey("INVID")&&this.ScreenObject.GridDataColumns.Contains("DocExtraXML")){e.DocExtraXML='<DocExtraXML><Row RefID="'+this.barcodeValues.INVID+'" Qty="'+e.Quantity.toString()+'" Type="1" ></Row></DocExtraXML>',e.BOEID=this.barcodeValues.INVID.toString();var ie=this.ScreenObject.GetinvBinDetails(this.barcodeValues.INVID.toString(),e.ProductID_Key.toString(),e.LinkedInvDocDetailsID.toString());null!=ie&&ie.Tables.length>0&&ie.Tables[0].length>0&&this.AddBins(e,!1,!1,ie)}if(-1==this.VoucherType&&"5"==o.e.String(e.Type)&&(this.barcodeValues.ContainsKey("Batch_Code")||this.barcodeValues.ContainsKey("Batch_No"))){var re=0,se=0;if(this.ScreenObject.Preferences.ContainsKey("Donotuselocation")&&""!=this.ScreenObject.Preferences.Donotuselocation&&Object(l.j)(this.ScreenObject.Preferences.Donotuselocation)){var oe=this.ScreenObject._CCFields.find((function(e){return"dcccnid2"==e.DBColumnName.toLowerCase()}));oe&&oe instanceof C.b&&oe.SelectedValue>0?se=oe.SelectedValue:null==e||o.e.IsEmpty(e.dcCCNID2_Key)||(se=parseInt(e.dcCCNID2_Key))}else se=this.ScreenObject.LocationID>0?this.ScreenObject.LocationID:s.a.SessionManager.LocationID;re=this.ScreenObject.DivisionID>0?this.ScreenObject.DivisionID:s.a.SessionManager.DivisionID;var le=0;!o.e.IsEmpty(e.Quantity)&&parseFloat(e.Quantity)>0?le=parseFloat(e.Quantity):!o.e.IsEmpty(e.FreeQTY)&&parseFloat(e.FreeQTY)>0&&(le=parseFloat(e.FreeQTY)),o.e.IsEmpty(e.UOMConversion)||(le*=parseFloat(e.UOMConversion));var De=new Pe.a(this.ScreenObject.GridDataObj);De.BatchNumberViewModel_3(this,this.VoucherType,le,parseInt(e.ProductID_Key),e.ProductName.toString(),se,re,e);for(var he=0;he<De.GridData.length;he++){if(this.barcodeValues.ContainsKey("Batch_Code")&&De.GridData[he].BatchCode.toString().toLowerCase()==this.barcodeValues.Batch_Code.toString().toLowerCase()){De.SelectQty(De.GridData[he]);break}if(this.barcodeValues.ContainsKey("Batch_No")&&De.GridData[he].BATCHNUMBER.toString().toLowerCase()==this.barcodeValues.Batch_No.toString().toLowerCase()){De.SelectQty(De.GridData[he]);break}}De.DisplayMessage="",De.OnSave("AutoSave"),""!=De.DisplayMessage&&s.a.page.ShowDialog(De,Ae.a)}this.barcodeValues.Clear()}if((!this.ScreenObject.Preferences.ContainsKey("SubonProdChange")||""==this.ScreenObject.Preferences.SubonProdChange.toString()||!Object(l.j)(this.ScreenObject.Preferences.SubonProdChange))&&(!this.ScreenObject.Preferences.ContainsKey("SubstituteOnQty")||""==this.ScreenObject.Preferences.SubstituteOnQty.toString()||!this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.Preferences.SubstituteOnQty))&&this.ScreenObject.Preferences.ContainsKey("EnableSubtitutes")&&""!=this.ScreenObject.Preferences.EnableSubtitutes.toString()&&Object(l.j)(this.ScreenObject.Preferences.EnableSubtitutes)&&!o.e.IsEmpty(e.ProductID_Key)&&parseInt(e.ProductID_Key)==this.ProdID&&("1"==o.e.String(e.Subexists)||this.ScreenObject.IsDocEdit)){var Se=this.ScreenObject.GetSubtituteProducts(parseInt(e.ProductID_Key),this.DocumentDate,e.DocDetailsID.toString(),e);if(Se.Tables.length>0&&!Se.Columns[0].Contains("ErrorMessage")&&Se.Tables[0].length>1){var Ce=new me.a(this,Se.Tables[0],Se.Columns[0],Se.Tables[1],e.ProductName.toString(),e.ProductCode.toString(),e.ProductID_Key.toString());Ce.GridData.length>0&&s.a.page.ShowDialog(Ce,be.a,{ShowCenter:!0})}}}Logger.InfoLog("AddEditDocumentViewModel::Entering OnCellEditEnding")}else"CreditAccount"!=t&&"DebitAccount"!=t&&"AccountCode"!=t&&"AccountName"!=t&&"AccountID"!=t&&"AccountID_Key"!=t||(O&&this.ScreenObject.GridDataColumns.Contains(O.ValueMember)&&!o.e.IsEmpty(e[O.ValueMember])&&this.RepeatRowData(e),this.BindDivisionorLocation(e),null==e[t]||o.e.IsEmpty(e[t])||(this.ScreenObject.ColumnSource.filter((function(e){return e.DisplayMember.Contains("dcNum")})).forEach((function(t){a.ScreenObject.GridDataColumns.Contains("dcCurrID"+t.DisplayMember.replace("dcNum","").toString()+"_Key")&&(e["dcCurrID"+t.DisplayMember.replace("dcNum","").toString()+"_Key"]=t.DefaultValue),a.ScreenObject.GridDataColumns.Contains("dcExchRT"+t.DisplayMember.replace("dcNum","").toString())&&(e["dcExchRT"+t.DisplayMember.replace("dcNum","").toString()]=a.ScreenObject.GetExchangeRate(parseInt(t.DefaultValue),a.DocumentDate))})),this.ScreenObject.GridDataObj.updateRow(e)),"AccountCode"!=t&&"AccountName"!=t||(18!=this.ScreenObject.DocumentType&&19!=this.ScreenObject.DocumentType&&21!=this.ScreenObject.DocumentType&&22!=this.ScreenObject.DocumentType||o.e.IsEmpty(e.CreditAccount_Key)||this.ScreenObject.Preferences.ContainsKey("Valueonbillwise")&&""!=this.ScreenObject.Preferences.Valueonbillwise&&Object(l.j)(this.ScreenObject.Preferences.Valueonbillwise)&&this.CheckIsBillWise(parseInt(e.CreditAccount_Key.toString()),e,t,0,!0,u,d),14!=this.ScreenObject.DocumentType&&15!=this.ScreenObject.DocumentType&&20!=this.ScreenObject.DocumentType&&23!=this.ScreenObject.DocumentType||o.e.IsEmpty(e.DebitAccount_Key)||this.ScreenObject.Preferences.ContainsKey("Valueonbillwise")&&""!=this.ScreenObject.Preferences.Valueonbillwise&&Object(l.j)(this.ScreenObject.Preferences.Valueonbillwise)&&this.CheckIsBillWise(parseInt(e.DebitAccount_Key.toString()),e,t,0,!1,u,d)));if(2==O.CostCenterID&&s.a.SessionManager.Preferences.BudgetAccount.length>0&&s.a.SessionManager.Preferences.BudgetDimension.length>0&&e[O.ValueMember].toString()!=this.PrevValue&&this.BudgetObj.AutoLoadBudgetDimension(e,null),!this.IsInventoryVoucher&&this.ScreenObject.Preferences.ContainsKey("DbCrBills")&&"True"==o.e.String(this.ScreenObject.Preferences.DbCrBills)&&this.ScreenObject.Preferences.ContainsKey("NetAmountFld")&&this.ScreenObject.Preferences.NetAmountFld==t||this.CalculateTotals(e,!1,t),!this.IsInventoryVoucher){var ge="";if(this.ScreenObject.Preferences.ContainsKey("DbCrBills")&&"True"==o.e.String(this.ScreenObject.Preferences.DbCrBills)&&this.ScreenObject.Preferences.ContainsKey("NetAmountFld")&&!o.e.IsEmpty(this.ScreenObject.Preferences.NetAmountFld)&&(ge=this.ScreenObject.Preferences.NetAmountFld),""==ge&&"Amount"==t||ge==t){var fe=!1;this.ScreenObject.Preferences.ContainsKey("Valueonbillwise")&&(fe=Object(l.j)(this.ScreenObject.Preferences.Valueonbillwise)),null!=e[t]&&0!=parseFloat(e[t])&&(18==this.ScreenObject.DocumentType||19==this.ScreenObject.DocumentType||21==this.ScreenObject.DocumentType||22==this.ScreenObject.DocumentType?this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!o.e.IsEmpty(e.CreditAccount_Key)&&(o.e.IsEmpty(e[t])||fe||this.CheckIsBillWise(parseInt(e.CreditAccount_Key),e,t,parseFloat(e[t]),!0,u,d,"",ge,(function(){a.ChequeReturn(parseInt(e.CreditAccount_Key),e,t,parseFloat(e[t]),!0,u,d)}))):14!=this.ScreenObject.DocumentType&&15!=this.ScreenObject.DocumentType&&20!=this.ScreenObject.DocumentType&&23!=this.ScreenObject.DocumentType||this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!o.e.IsEmpty(e.DebitAccount_Key)&&(o.e.IsEmpty(e[t])||fe||this.CheckIsBillWise(parseInt(e.DebitAccount_Key),e,t,parseFloat(e[t]),!1,u,d,"",ge,(function(){a.ChequeReturn(parseInt(e.DebitAccount_Key),e,t,parseFloat(e[t]),!1,u,d)}))))}else"DebitAmount"==t?null==e[t]||0==parseFloat(e[t])||o.e.IsEmpty(e.AccountID_Key)||(o.e.IsEmpty(e[t])||(this.CheckIsBillWise(parseInt(e.AccountID_Key),e,t,parseFloat(e[t]),!1,u,d),this.ChequeReturn(parseInt(e.AccountID_Key),e,t,parseFloat(e[t]),!1,u,d)),this.ScreenObject.GridDataColumns.Contains("CreditAmount")&&(e.CreditAmount=0)):"CreditAmount"==t&&(null==e[t]||0==parseFloat(e[t])||o.e.IsEmpty(e.AccountID_Key)||(this.CheckIsBillWise(parseInt(e.AccountID_Key),e,t,parseFloat(e[t]),!0,u,d),this.ChequeReturn(parseInt(e.AccountID_Key),e,t,parseFloat(e[t]),!0,u,d),this.ScreenObject.GridDataColumns.Contains("DebitAmount")&&(e.DebitAmount=0)))}null!=O&&this.ValidateData_Column(O,e);var Oe=!1;if(this.ScreenObject.Preferences.ContainsKey("EnableSchemes")&&Object(l.j)(this.ScreenObject.Preferences.EnableSchemes)&&(Oe=Object(l.j)(this.ScreenObject.Preferences.EnableSchemes)),Oe){var Ie="GROSS";if(this.ScreenObject.Preferences.ContainsKey("SchemesNumericFields")&&""!=this.ScreenObject.Preferences.SchemesNumericFields&&"0"!=this.ScreenObject.Preferences.SchemesNumericFields){var Te=this.ScreenObject.ColumnSource.find((function(e){return e.ID==a.ScreenObject.Preferences.SchemesNumericFields}));Te&&""!=Te.DisplayMember&&(Ie=Te.DisplayMember)}if("Quantity"==t||"ProductID"==t||t.toLowerCase()==Ie.toLowerCase()){if(!o.e.IsEmpty(e.ProductID_Key)&&parseInt(e.ProductID_Key)>0){var je=this.ScreenObject.GetSchemes(this.DocumentDate,e);je.Tables.length>0&&je.Columns[0].Contains("SchemeID")&&this.fillSchemevalues(je.Tables[0],je.Columns[0],e)}this.ApplySchemes(e)}}if(n>0)for(var Me=0;Me<this.ScreenObject.ColumnSource.length;Me++)"ModSelect"!=this.ScreenObject.ColumnSource[Me].DisplayMember&&"ModifierName"!=this.ScreenObject.ColumnSource[Me].DisplayMember&&"LINK"==this.ScreenObject.ColumnSource[Me].DataType&&!this.ScreenObject.ColumnSource[Me].Dependantinuse&&this.ScreenObject.ColumnSource[Me].Mandatory&&!o.e.IsEmpty(this.ScreenObject.ColumnSource[Me].FilterCondition)&&this.ScreenObject.ColumnSource[Me].FilterCondition.split(",").Contains(n.toString())&&this.RowAttachments(this.ScreenObject.ColumnSource[Me].DisplayMember,!0,e);if(62==this.ScreenObject.DocumentType&&("dcccnid52"==t.toLowerCase()||"dcalpha4"==t.toLowerCase())||40058==this.ScreenObject.CostCenterID&&"dcccnid52"==t.toLowerCase()){var ve,Ge;ve=Ge=0;var Ne=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));(null!=Ne&&Ne instanceof C.b&&Ne.SelectedValue>0||null!=Ne&&Ne instanceof p.a&&Ne.SelectedValue>0)&&(ve=Ne.SelectedValue);var Ee=this.ScreenObject.ColumnSource.find((function(e){return 50052==e.CostCenterID}));if(Ee&&Ee instanceof f.a&&null!=e[Ee.ValueMember]&&(Ge=parseInt(e[Ee.ValueMember])),ve>0&&Ge>0){var we={IfFormulaExistsNoOfDays:!1};if(this.DisplayMessage=this.IsLeaveTypeValid(ve,Ge,e,we),""!=this.DisplayMessage){if(40058==this.ScreenObject.CostCenterID&&((Ee=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha1"==e.DisplayMember.toLowerCase()})))&&(e[Ee.DisplayMember]=0)),!we.IfFormulaExistsNoOfDays)return(Ee=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha2"==e.DisplayMember.toLowerCase()})))&&(e[Ee.DisplayMember]=0),void((Ee=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha3"==e.DisplayMember.toLowerCase()})))&&(e[Ee.DisplayMember]=0))}else this.MessageVisibility=!1}this.ScreenObject.GridDataObj.updateRow(e)}if(40055==this.ScreenObject.CostCenterID&&"dcalpha1"==t.toLowerCase()&&null!=e.dcAlpha1||40057==this.ScreenObject.CostCenterID&&("dcalpha5"==t.toLowerCase()&&null!=e.dcAlpha5||"dcalpha4"==t.toLowerCase()&&null!=e.dcAlpha4)){if(this.DisplayMessage=this.IsDateValid(e,t),this.DisplayMessage)return void(e.Rate=-1);e.Rate=0,this.MessageVisibility=!1}if(40060==this.ScreenObject.CostCenterID&&60==this.ScreenObject.DocumentType){if(("dcAlpha3"==t||"dcAlpha4"==t)&&null!=e.dcAlpha3_Key&&null!=e.dcAlpha4_Key){if(e.dcAlpha3=new Date(e.dcAlpha3_Key).ToString(s.a.SessionManager.Preferences["Date Format"]),e.dcAlpha4=new Date(e.dcAlpha4_Key).ToString(s.a.SessionManager.Preferences["Date Format"]),"dcAlpha3"==t&&(new Date(e.dcAlpha3_Key)>new Date(e.dcAlpha4_Key)?(c="Fromdate should be less than or equal to Todate\r\n",e.dcNum6=2):e.dcNum6=0),"dcAlpha4"==t&&(new Date(e.dcAlpha4_Key)<new Date(e.dcAlpha3_Key)?(c="Todate should be greater than or equal to Fromdate\r\n",e.dcNum6=2):e.dcNum6=0),c)return void(this.DisplayMessage=c);this.DisplayMessage=""}if("dcAlpha4"==t&&null!=e.dcAlpha4_Key&&null!=e.dcAlpha5_Key){if(new Date(e.dcAlpha4_Key)>new Date(e.dcAlpha5_Key))return e.dcNum6=1,void(this.DisplayMessage="ToDate should be less than Leaveyear enddate ("+new Date(e.dcAlpha5_Key).ToString("dd-MMM-yyyy")+")");e.dcNum6=0,this.DisplayMessage="",this.MessageVisibility=!1}}if(62==this.ScreenObject.DocumentType){if(parseInt(e.DocDetailsID)>0&&2==parseInt(e.dcAlpha10)&&3==O.Mode&&("dcAlpha4"==t||"dcccnid52"==t.toLowerCase())){var Fe=0;Fe=parseInt(e.DocSeqNo);for(var Ve=0;Ve<this.dtData.length;Ve++)if(Ve==Fe-1&&parseInt(e.dcCCNID52_Key)==parseInt(this.dtData[Ve].dcCCNID52))return void("dcAlpha4"==t&&null!=e.dcAlpha4_Key&&new Date(e.dcAlpha4_Key)>new Date(e.dcAlpha5_Key)&&"Both"==o.e.String(e.dcAlpha6)&&(e.dcAlpha5=new Date(e.dcAlpha4_Key).AddDays(1),e.dcAlpha5_Key=new Date(e.dcAlpha4_Key).AddDays(1)))}if(("dcAlpha4"==t||"dcAlpha5"==t||"dcAlpha6"==t)&&null!=e.dcAlpha4_Key&&null!=e.dcAlpha5_Key){if(e.dcAlpha4=new Date(e.dcAlpha4_Key).ToString(s.a.SessionManager.Preferences["Date Format"]),e.dcAlpha5=new Date(e.dcAlpha5_Key).ToString(s.a.SessionManager.Preferences["Date Format"]),"dcAlpha4"==t&&(new Date(e.dcAlpha4_Key)>new Date(e.dcAlpha5_Key)&&"Both"==o.e.String(e.dcAlpha6)&&(e.dcAlpha5=new Date(e.dcAlpha4_Key).ToString(s.a.SessionManager.Preferences["Date Format"]),e.dcAlpha5_Key=new Date(e.dcAlpha4_Key)),new Date(e.dcAlpha5_Key)>=new Date(e.dcAlpha4_Key)&&"Both"==o.e.String(e.dcAlpha6))){var Le=this.ScreenObject.ColumnSource.find((function(e){return"dcAlpha5"==e.DisplayMember}));Le&&!o.e.IsEmpty(Le.Shortcut)&&"lostfocus"==Le.Shortcut.toLowerCase()&&this.ValidateData_Column(Le,e,!0)&&this.ScreenObject.GetExternalFuncData(Le.Mode,Le.SPName,Le.IPParams,Le.OPParams,e)}if("dcAlpha5"==t){var Re,Be;new Date(e.dcAlpha5_kKey)<new Date(e.dcAlpha4_Key)&&"Both"==o.e.String(e.dcAlpha6)&&(e.dcAlpha4=new Date(e.dcAlpha5_Key).ToString(s.a.SessionManager.Preferences["Date Format"]),e.dcAlpha4_Key=new Date(e.dcAlpha5_Key),c="Todate should be greater than or equal to Fromdate\r\n"),Re=Be=0;var xe=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));(xe instanceof C.b&&xe.SelectedValue>0||xe instanceof p.a&&xe.SelectedValue>0)&&(Re=xe.SelectedValue);var ke=this.ScreenObject.ColumnSource.find((function(e){return 50052==e.CostCenterID}));if(ke&&ke instanceof f.a&&null!=e[ke.ValueMember]&&(Be=parseInt(e[ke.ValueMember])),Re>0&&Be>0){var _e=o.e.GetPayrollStructureBasedonEmployee(Re,new Date(e.dcAlpha4_Key)).Tables[0].filter((function(e){return 4==e.Type&&e.ComponentID==Be}));if(null!=_e&&_e.length>0&&null!=_e[0].LeaveOthFeatures&&null!=_e[0].LeaveOthFeatures&&""!=_e[0].LeaveOthFeatures.toString().trim()){var Ke=0,Qe=_e[0].LeaveOthFeatures.toString().split(";");if(null!=Qe&&Qe.length>0)for(var He=0;He<Qe.length;He++){if(null!=Qe[He]&&Qe[He].startsWith("#ContLeaveS_")){var We=Qe[He].replace("#","").split("_");if(We.length>2){var Ue=parseInt(We[1]);if(new Date(e.dcAlpha5_Key).Date().Subtract(new Date(e.dcAlpha4_Key).Date()).TotalDays+1>=Ue){var Xe=1,qe=0;do{qe=0;var Ye=new Date(e.dcAlpha5_Key).Date();null==this.objPayDayCheck&&(this.objPayDayCheck=new st.a(this.ScreenObject)),this.objPayDayCheck.CheckIsHolidayDate(Re.toString(),Ye.AddDays(1).ToString("dd/MMM/yyyy"),e),o.e.IsEmpty(e.PayrollType)||("WeeklyOff"==e.PayrollType.toString()&&"W"==o.e.String(We[2])||"Holiday"==e.PayrollType.toString()&&"H"==o.e.String(We[2])||("WeeklyOff"==e.PayrollType.toString()||"Holiday"==e.PayrollType.toString())&&"WH"==o.e.String(We[2]))&&(0==Ke?confirm("WeeklyOff/Holiday days will be considered, Are you sure want to Proceed.? ")?(e.dcAlpha5=Ye.AddDays(1).ToString(s.a.SessionManager.Preferences["Date Format"]),e.dcAlpha5_Key=new Date(Ye.AddDays(1)),qe=1,Ke=1):(e.dcAlpha5=e.dcAlpha4,e.dcAlpha5_Key=e.dcAlpha4_Key):(e.dcAlpha5=Ye.AddDays(1).ToString(s.a.SessionManager.Preferences["Date Format"]),e.dcAlpha5_Key=new Date(Ye.AddDays(1)),qe=1),this.ScreenObject.GridDataObj.updateRow(e))}while(Xe==qe)}}}if(null!=Qe[He]&&Qe[He].startsWith("#ContLeaveP_")){var ze=Qe[He].replace("#","").split("_");if(ze.length>2){var Je=parseInt(ze[1]);if(new Date(e.dcAlpha5_Key).Date().Subtract(new Date(e.dcAlpha4_Key).Date()).TotalDays+1>=Je){var Ze=1,$e=0;do{$e=0;var et=new Date(e.dcAlpha4_Key).Date();null==this.objPayDayCheck&&(this.objPayDayCheck=new st.a(this.ScreenObject)),this.objPayDayCheck.CheckIsHolidayDate(Re.toString(),et.AddDays(-1).ToString("dd/MMM/yyyy"),e),o.e.IsEmpty(e.PayrollType)||("WeeklyOff"==e.PayrollType.toString()&&"W"==o.e.String(ze[2])||"Holiday"==e.PayrollType.toString()&&"H"==o.e.String(ze[2])||("WeeklyOff"==e.PayrollType.toString()||"Holiday"==e.PayrollType.toString())&&"WH"==o.e.String(ze[2]))&&(0==Ke?confirm("WeeklyOff/Holiday days will be considered, Are you sure want to Proceed.? ")?(e.dcAlpha4=et.AddDays(-1).ToString(s.a.SessionManager.Preferences["Date Format"]),e.dcAlpha4_Key=et.AddDays(-1),$e=1,Ke=1):(e.dcAlpha4=e.dcAlpha5,e.dcAlpha4_Key=e.dcAlpha5_Key):(e.dcAlpha4=et.AddDays(-1).ToString(s.a.SessionManager.Preferences["Date Format"]),e.dcAlpha4_Key=new Date(et.AddDays(-1)),$e=1),this.ScreenObject.GridDataObj.updateRow(e))}while(Ze==$e)}}}}}}}if(c)return void(this.DisplayMessage=c);this.DisplayMessage=""}if(this.ScreenObject.GridData.length>1&&!o.e.IsEmpty(this.ScreenObject.GridData[1].dcCCNID52_Key)){var tt;tt=parseInt(e[Object.keys(e)[1]])-1;for(var nt=0;nt<this.ScreenObject.GridData.length-1;nt++){if(nt!=tt&&!o.e.IsEmpty(this.ScreenObject.GridData[nt].dcAlpha4_Key)&&!o.e.IsEmpty(this.ScreenObject.GridData[tt].dcAlpha5_Key)){if(new Date(this.ScreenObject.GridData[tt].dcAlpha4_Key)>=new Date(this.ScreenObject.GridData[nt].dcAlpha4_Key)&&new Date(this.ScreenObject.GridData[tt].dcAlpha4_Key)<=new Date(this.ScreenObject.GridData[nt].dcAlpha5_Key)||new Date(this.ScreenObject.GridData[nt].dcAlpha4_Key)>=new Date(this.ScreenObject.GridData[tt].dcAlpha4_Key)&&new Date(this.ScreenObject.GridData[nt].dcAlpha4_Key)<=new Date(this.ScreenObject.GridData[tt].dcAlpha5_Key))return this.DisplayMessage="FromDate already exist",void(this.ScreenObject.GridData[tt].dcAlpha7=0);this.DisplayMessage=""}if(nt!=tt&&!o.e.IsEmpty(this.ScreenObject.GridData[nt].dcAlpha5_Key)&&!o.e.IsEmpty(this.ScreenObject.GridData[tt].dcAlpha4_Key)){if(nt!=tt&&new Date(this.ScreenObject.GridData[tt].dcAlpha5_Key)>=new Date(this.ScreenObject.GridData[nt].dcAlpha4_Key)&&new Date(this.ScreenObject.GridData[tt].dcAlpha5_Key)<=new Date(this.ScreenObject.GridData[nt].dcAlpha5_Key)||new Date(this.ScreenObject.GridData[nt].dcAlpha5_Key)>=new Date(this.ScreenObject.GridData[tt].dcAlpha4_Key)&&new Date(this.ScreenObject.GridData[nt].dcAlpha5_Key)<=new Date(this.ScreenObject.GridData[tt].dcAlpha5_Key))return this.DisplayMessage="ToDate already exist",void(this.ScreenObject.GridData[tt].dcAlpha7=0);parseInt(this.ScreenObject.GridData[tt].dcCCNID52_Key)==parseInt(this.ScreenObject.GridData[nt].dcCCNID52_Key)&&parseFloat(this.ScreenObject.GridData[tt].dcAlpha3)==parseFloat(this.ScreenObject.GridData[nt].dcAlpha3)&&(this.ScreenObject.GridData[tt].dcAlpha3=parseFloat(this.ScreenObject.GridData[tt].dcAlpha3)-parseFloat(this.ScreenObject.GridData[nt].dcAlpha7)),this.DisplayMessage=""}}}}if(63==this.ScreenObject.DocumentType){if(this.ScreenObject.GridDataObj.updateRow(e),parseInt(e.DocDetailsID)>0&&3==O.Mode&&("dcAlpha4"==t||"dcccnid52"==t.toLowerCase())){var at=0;at=parseInt(e.DocSeqNo);for(var it=0;it<this.dtData.length;it++)if(it==at-1&&parseInt(e.dcCCNID51_Key)==parseInt(this.dtData[it].dcCCNID51)&&parseInt(e.dcCCNID52_Key)==parseInt(this.dtData[it].dcCCNID52))return void("dcAlpha4"==t&&null!=e.dcAlpha4_Key&&new Date(e.dcAlpha4_Key)>new Date(e.dcAlpha5_Key)&&"Both"==o.e.String(e.dcAlpha6)&&(e.dcAlpha5=new Date(e.dcAlpha4_Key).AddDays(1),e.dcAlpha5_Key=new Date(e.dcAlpha4_Key).AddDays(1)))}if(("dcAlpha4"==t||"dcAlpha5"==t||"dcAlpha6"==t)&&null!=e.dcAlpha4_Key&&null!=e.dcAlpha5_Key){if(e.dcAlpha4=new Date(e.dcAlpha4_Key).ToString(s.a.SessionManager.Preferences["Date Format"]),e.dcAlpha4_Key=new Date(e.dcAlpha4_Key),e.dcAlpha5=new Date(e.dcAlpha5_Key).ToString(s.a.SessionManager.Preferences["Date Format"]),e.dcAlpha5_Key=new Date(e.dcAlpha5_Key),"dcAlpha4"==t&&(new Date(e.dcAlpha4_Key)>new Date(e.dcAlpha5_Key)&&"Both"==o.e.String(e.dcAlpha6)&&(e.dcAlpha5=new Date(e.dcAlpha4_Key).ToString(s.a.SessionManager.Preferences["Date Format"]),e.dcAlpha5_Key=new Date(e.dcAlpha4_Key)),new Date(e.dcAlpha5_Key)>=new Date(e.dcAlpha4_Key)&&"Both"==o.e.String(e.dcAlpha6))){var rt=this.ScreenObject.ColumnSource.find((function(e){return"dcAlpha5"==e.DisplayMember}));rt&&!o.e.IsEmpty(rt.Shortcut)&&"lostfocus"==rt.Shortcut.toLowerCase()&&this.ValidateData_Column(rt,e,!0)&&this.ScreenObject.GetExternalFuncData(rt.Mode,rt.SPName,rt.IPParams,rt.OPParams,e)}if("dcAlpha5"==t&&new Date(e.dcAlpha5_Key)<new Date(e.dcAlpha4_Key)&&"Both"==o.e.String(e.dcAlpha6)&&(e.dcAlpha4=new Date(e.dcAlpha5_Key).ToString(s.a.SessionManager.Preferences["Date Format"]),e.dcAlpha4_Key=new Date(e.dcAlpha5_Key),c="Todate should be greater than or equal to Fromdate\r\n"),c)return void(this.DisplayMessage=c);this.DisplayMessage=""}if(!o.e.IsEmpty(this.ScreenObject.GridData[1].dcCCNID51_Key)){var ot;ot=parseInt(e[Object.keys(e)[1]])-1;for(var ct=0;ct<this.ScreenObject.GridData.length-1;ct++)if(!(o.e.IsEmpty(this.ScreenObject.GridData[ct].dcCCNID51_Key)||o.e.IsEmpty(this.ScreenObject.GridData[ct].dcCCNID52_Key)||o.e.IsEmpty(this.ScreenObject.GridData[ct].dcAlpha4_Key)||o.e.IsEmpty(this.ScreenObject.GridData[ct].dcAlpha5_Key)||o.e.IsEmpty(this.ScreenObject.GridData[ot].dcAlpha4_Key)||o.e.IsEmpty(this.ScreenObject.GridData[ot].dcAlpha5_Key))){if(ct!=ot&&parseInt(this.ScreenObject.GridData[ct].dcCCNID51_Key)==parseInt(this.ScreenObject.GridData[ot].dcCCNID51_Key)&&parseInt(this.ScreenObject.GridData[ct].dcCCNID52_Key)==parseInt(this.ScreenObject.GridData[ot].dcCCNID52_Key)&&!o.e.IsEmpty(this.ScreenObject.GridData[ct].dcAlpha4_Key)&&!o.e.IsEmpty(this.ScreenObject.GridData[ot].dcAlpha5_Key)){if(new Date(this.ScreenObject.GridData[ot].dcAlpha4_Key)>=new Date(this.ScreenObject.GridData[ct].dcAlpha4_Key)&&new Date(this.ScreenObject.GridData[ot].dcAlpha4_Key)<=new Date(this.ScreenObject.GridData[ct].dcAlpha5_Key)||new Date(this.ScreenObject.GridData[ct].dcAlpha4_Key)>=new Date(this.ScreenObject.GridData[ot].dcAlpha4_Key)&&new Date(this.ScreenObject.GridData[ct].dcAlpha4_Key)<=new Date(this.ScreenObject.GridData[ot].dcAlpha5_Key))return this.DisplayMessage="FromDate already exist",void(this.ScreenObject.GridData[ot].dcAlpha7=0);this.DisplayMessage=""}if(ct!=ot&&parseInt(this.ScreenObject.GridData[ct].dcCCNID51_Key)==parseInt(this.ScreenObject.GridData[ot].dcCCNID51_Key)&&parseInt(this.ScreenObject.GridData[ct].dcCCNID52_Key)==parseInt(this.ScreenObject.GridData[ot].dcCCNID52_Key)&&!o.e.IsEmpty(this.ScreenObject.GridData[ct].dcAlpha5_Key)&&!o.e.IsEmpty(this.ScreenObject.GridData[ot].dcAlpha4_Key)){if(ct!=ot&&new Date(this.ScreenObject.GridData[ot].dcAlpha5_Key)>=new Date(this.ScreenObject.GridData[ct].dcAlpha4_Key)&&new Date(this.ScreenObject.GridData[ot].dcAlpha5_Key)<=new Date(this.ScreenObject.GridData[ct].dcAlpha5_Key)||new Date(this.ScreenObject.GridData[ct].dcAlpha5_Key)>=new Date(this.ScreenObject.GridData[ot].dcAlpha4_Key)&&new Date(this.ScreenObject.GridData[ct].dcAlpha5_Key)<=new Date(this.ScreenObject.GridData[ot].dcAlpha5_Key))return this.DisplayMessage="ToDate already exist",void(this.ScreenObject.GridData[ot].dcAlpha7=0);parseInt(this.ScreenObject.GridData[ot].dcCCNID51_Key)==parseInt(this.ScreenObject.GridData[ct].dcCCNID51_Key)&&parseInt(this.ScreenObject.GridData[ot].dcCCNID52_Key)==parseInt(this.ScreenObject.GridData[ct].dcCCNID52_Key)&&parseFloat(this.ScreenObject.GridData[ot].dcAlpha3)==parseFloat(this.ScreenObject.GridData[ct].dcAlpha3)?this.ScreenObject.GridData[ot].dcAlpha3=parseFloat(this.ScreenObject.GridData[ot].dcAlpha3)-parseFloat(this.ScreenObject.GridData[ct].dcNum1):parseInt(this.ScreenObject.GridData[ot].dcCCNID51_Key)==parseInt(this.ScreenObject.GridData[ct].dcCCNID51_Key)&&parseInt(this.ScreenObject.GridData[ot].dcCCNID52_Key)==parseInt(this.ScreenObject.GridData[ct].dcCCNID52_Key)&&parseFloat(this.ScreenObject.GridData[ct].dcAlpha3)<parseFloat(this.ScreenObject.GridData[ot].dcAlpha3)&&(this.ScreenObject.GridData[ct].dcAlpha3=parseFloat(this.ScreenObject.GridData[ot].dcAlpha3)-parseFloat(this.ScreenObject.GridData[ct].dcNum1)),this.DisplayMessage=""}}this.ScreenObject.GridDataObj.updateRow(e)}}if(67==this.ScreenObject.DocumentType){if("dcCCNID51"==t||"dcCCNID51Code"==t){var lt=this.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()}));if(lt&&lt instanceof S.c&&!lt.Date)return void(this.DisplayMessage="Select the daily attendance date")}if("dcNum2"==t&&("WeeklyOff"!=e.PayrollType.toString()&&"Holiday"!=e.PayrollType.toString()||o.e.IsEmpty(e.dcNum2)||-1!=parseFloat(e.dcNum2)&&-2!=parseFloat(e.dcNum2)&&parseFloat(e.dcNum2)>0&&(e.dcNum2="0.00")),("dcCCNID51Code"==t||"dcCCNID51"==t)&&this.ScreenObject.GridDataColumns.Contains("dcCCNID51_Key")&&o.e.String(e.dcCCNID51_Key)==this.PrevValue)return;if("dcAlpha1"==t&&this.ScreenObject.GridDataColumns.Contains("dcAlpha1_Key")&&o.e.String(e.dcAlpha1_Key)==this.PrevValue)return;if("dcAlpha2"==t&&this.ScreenObject.GridDataColumns.Contains("dcAlpha2_Key")&&o.e.String(e.dcAlpha2_Key)==this.PrevValue)return;if("dcAlpha3"==t&&this.ScreenObject.GridDataColumns.Contains("dcAlpha3_Key")&&o.e.String(e.dcAlpha3_Key)==this.PrevValue)return;if("dcNum1"==t&&this.ScreenObject.GridDataColumns.Contains("dcNum1")&&o.e.String(e.dcNum1)==this.PrevValue)return;if(("dcCCNID73Code"==t||"dcCCNID73"==t)&&this.ScreenObject.GridDataColumns.Contains("dcCCNID73_Key")&&e.dcCCNID73_Key.toString()==this.PrevValue)return;this.DailyAttendanceCellEditEnd(e,t,O)}if(62==this.ScreenObject.DocumentType&&("dcCCNID52"==t||"dcAlpha5"==t)){if(this.ScreenObject.GridDataObj.updateRow(e),null!=e.dcAlpha3&&null!=e.dcAlpha9&&parseFloat(e.dcAlpha3)<=0&&(parseInt(e.dcAlpha9)>=0||-4==parseInt(e.dcAlpha9))&&(c="Please check the availability of leaves\r\n"),null!=e.dcAlpha7&&parseFloat(e.dcAlpha7)<=0&&(c="Dates already applied | Selected dates between Holidays/Weeklyoffs\r\n"),c)return void(this.DisplayMessage=c);this.DisplayMessage=""}if(40071==this.ScreenObject.CostCenterID&&("dcAlpha3"==t||"dcAlpha4"==t||"dcAlpha5"==t||"dcAlpha6"==t||"dcAlpha7"==t||"dcAlpha8"==t||"dcAlpha9"==t||"dcAlpha10"==t||"dcAlpha11"==t||"dcAlpha12"==t||"dcAlpha13"==t||"dcAlpha14"==t)){for(var ut=0;ut<this.ScreenObject.GridData.length-1;ut++){var dt=0;if(null!=this.ScreenObject.GridData[ut][t]){for(var Dt=3;Dt<15;Dt++)null!=this.ScreenObject.GridData[ut]["dcAlpha"+Dt]&&parseFloat(this.ScreenObject.GridData[ut]["dcAlpha"+Dt])>0&&(dt+=parseFloat(this.ScreenObject.GridData[ut]["dcAlpha"+Dt]));this.ScreenObject.GridData[ut].dcNum1=dt}}this.ScreenObject.GridDataObj.updateRow(e),this.CalculateTotals(e,!1)}if(40072==this.ScreenObject.CostCenterID&&("dcNum1"==t||"dcNum2"==t||"dcNum3"==t)){for(var ht=0,St=0,mt=0,bt=0,Ct=0;Ct<this.ScreenObject.GridData.length;Ct++)o.e.IsEmpty(this.ScreenObject.GridData[Ct].dcAlpha21)||(2==parseFloat(this.ScreenObject.GridData[Ct].dcAlpha21)?(o.e.IsEmpty(this.ScreenObject.GridData[Ct].dcNum1)||(St+=parseFloat(this.ScreenObject.GridData[Ct].dcNum1)),o.e.IsEmpty(this.ScreenObject.GridData[Ct].dcNum2)||(St+=parseFloat(this.ScreenObject.GridData[Ct].dcNum2)),o.e.IsEmpty(this.ScreenObject.GridData[Ct].dcNum3)||(St+=parseFloat(this.ScreenObject.GridData[Ct].dcNum3))):2!=parseFloat(this.ScreenObject.GridData[Ct].dcAlpha21)&&(o.e.IsEmpty(this.ScreenObject.GridData[Ct].dcNum1)||(mt+=parseFloat(this.ScreenObject.GridData[Ct].dcNum1))));var yt=this.ScreenObject._TextFields.find((function(e){return"dcalpha5"==e.DBColumnName.toLowerCase()}));yt instanceof h.d&&!o.e.IsEmpty(yt.Text)&&(bt=parseFloat(yt.Text)),ht=St+bt-mt,(yt=this.ScreenObject._TextFields.find((function(e){return"dcalpha6"==e.DBColumnName.toLowerCase()})))instanceof h.d&&(yt.Text=ht.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount)),this.ScreenObject.GridDataObj.updateRow(e),this.CalculateTotals(e,!1),this.GridNetTotal=parseFloat(ht.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount)),this.RefreshNetAmount()}if(40076==this.ScreenObject.CostCenterID){var pt=0,gt=0,ft=0,Ot=0;if("dcNum1"==t||"dcNum2"==t){null!=e.dcAlpha2&&(0!=parseInt(e.dcAlpha3)&&-2!=parseInt(e.dcAlpha3)||(null!=e.dcNum1&&(ft=parseFloat(e.dcNum1)),null!=e.dcNum2&&(Ot=parseFloat(e.dcNum2)),e.dcNum3=ft-Ot));for(var It=0;It<this.ScreenObject.GridData.length-1;It++)o.e.IsEmpty(this.ScreenObject.GridData[It].dcAlpha2)||(0==parseInt(this.ScreenObject.GridData[It].dcAlpha3)&&(ft=0,Ot=0,o.e.IsEmpty(this.ScreenObject.GridData[It].dcNum1)||(ft=parseFloat(this.ScreenObject.GridData[It].dcNum1)),o.e.IsEmpty(this.ScreenObject.GridData[It].dcNum2)||(Ot=parseFloat(this.ScreenObject.GridData[It].dcNum2)),pt+=ft,gt+=Ot),-1==parseInt(this.ScreenObject.GridData[It].dcAlpha3)&&(this.ScreenObject.GridData[It].dcNum1=pt,this.ScreenObject.GridData[It].dcNum2=gt,this.ScreenObject.GridData[It].dcNum3=pt-gt))}this.ScreenObject.GridDataObj.updateRow(e)}if(74==this.ScreenObject.DocumentType&&("dcNum1"==t||"dcNum2"==t)){if(this.ScreenObject.GridDataObj.updateRow(e),c=this.GetITSlabValidation(0,e))return void(this.DisplayMessage=c);this.DisplayMessage=""}if(40080==this.ScreenObject.CostCenterID&&"dcAlpha3"==t&&null!=e.dcAlpha3_Key){var Tt=new Date;Tt=new Date(parseInt(new Date(e.dcAlpha3_Key).ToString("yyyy")),parseInt(new Date(e.dcAlpha3_Key).ToString("MM")),1),e.dcAlpha3=new Date(Tt).ToString(s.a.SessionManager.Preferences["Date Format"]),e.dcAlpha3_Key=new Date(Tt)}if(40085==this.ScreenObject.CostCenterID&&this.ScreenObject.GridDataObj.updateRow(e),58==this.ScreenObject.DocumentType&&"dcAlpha3"==t){if(null==e.dcCCNID52_Key)return;var jt=0;if((jt=parseFloat(e.dcAlpha1)-parseFloat(e.dcAlpha8))<0&&(jt=0),jt>parseFloat(e.dcAlpha2)&&(jt=parseFloat(e.dcAlpha2)),parseFloat(e.dcAlpha3)>jt&&(c="You can not Encash more than ( "+jt+" ) Days\r\n"),c)return void(this.DisplayMessage=c);this.DisplayMessage="",e.dcNum1=this.GetLeaveEncashAmount(parseFloat(e.dcAlpha3),parseInt(e.dcCCNID52_Key))}if(89==this.ScreenObject.DocumentType&&("dcAlpha1"==t||"dcAlpha2"==t||"dcAlpha3"==t||"dcAlpha4"==t)){var Pt=null,At=null,Mt=null,vt=null,Gt=new Date,Nt=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha1"==e.DisplayMember.toLowerCase()}));if(Nt&&!o.e.IsEmpty(e[Nt.DisplayMember+"_Key"])&&(Pt=new Date(e[Nt.DisplayMember+"_Key"])),(Nt=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha2"==e.DisplayMember.toLowerCase()})))&&!o.e.IsEmpty(e[Nt.DisplayMember+"_Key"])&&(Gt=new Date(e[Nt.DisplayMember+"_Key"]),At=new Date(Pt.getFullYear(),Pt.getMonth(),Pt.getDate(),Gt.getHours(),Gt.getMinutes(),Gt.getSeconds()),e[Nt.DisplayMember+"_Key"]=At),(Nt=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha3"==e.DisplayMember.toLowerCase()})))&&!o.e.IsEmpty(e[Nt.DisplayMember+"_Key"])&&(Mt=new Date(e[Nt.DisplayMember+"_Key"])),(Nt=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha4"==e.DisplayMember.toLowerCase()})))&&!o.e.IsEmpty(e[Nt.DisplayMember+"_Key"])&&(Gt=new Date(e[Nt.DisplayMember+"_Key"]),vt=new Date(Mt.getFullYear(),Mt.getMonth(),Mt.getDate(),Gt.getHours(),Gt.getMinutes(),Gt.getSeconds()),e[Nt.DisplayMember+"_Key"]=vt),null!=Pt&&null!=At&&null!=Mt&&null!=vt){var Et=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha5"==e.DisplayMember.toLowerCase()}));null!=Et&&(e[Et.DisplayMember]=this.CalculateTotalTime(Pt,At,Mt,vt))}else{var wt=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha5"==e.DisplayMember.toLowerCase()}));null!=wt&&(e[wt.DisplayMember]=null)}this.ScreenObject.GridDataObj.updateRow(e)}if(90==this.ScreenObject.DocumentType&&("dcAlpha1"==t||"dcAlpha2"==t||"dcAlpha3"==t||"dcAlpha4"==t)){var Ft=null,Vt=null,Lt=null,Rt=null,Bt=new Date,xt=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha1"==e.DisplayMember.toLowerCase()}));if(xt&&!o.e.IsEmpty(e[xt.DisplayMember+"_Key"])&&(Ft=new Date(e[xt.DisplayMember+"_Key"])),(xt=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha2"==e.DisplayMember.toLowerCase()})))&&!o.e.IsEmpty(e[xt.DisplayMember+"_Key"])&&(Bt=new Date(e[xt.DisplayMember+"_Key"]),Vt=new Date(Ft.getFullYear(),Ft.getMonth(),Ft.getDate(),Bt.getHours(),Bt.getMinutes(),Bt.getSeconds()),e[xt.DisplayMember+"_Key"]=Vt),(xt=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha3"==e.DisplayMember.toLowerCase()})))&&!o.e.IsEmpty(e[xt.DisplayMember+"_Key"])&&(Lt=new Date(e[xt.DisplayMember+"_Key"])),(xt=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha4"==e.DisplayMember.toLowerCase()})))&&!o.e.IsEmpty(e[xt.DisplayMember+"_Key"])&&(Bt=new Date(e[xt.DisplayMember+"_Key"]),Rt=new Date(Lt.getFullYear(),Lt.getMonth(),Lt.getDate(),Bt.getHours(),Bt.getMinutes(),Bt.getSeconds()),e[xt.DisplayMember+"_Key"]=Rt),this.ScreenObject.GridDataObj.updateRow(e),null!=Ft&&null!=Vt&&null!=Lt&&null!=Rt){var kt=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha5"==e.DisplayMember.toLowerCase()}));null!=kt&&(e[kt.DisplayMember]=this.CalculateTotalTime(Ft,Vt,Lt,Rt))}else{var _t=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha5"==e.DisplayMember.toLowerCase()}));null!=_t&&(e[_t.DisplayMember]=null)}this.ScreenObject.GridDataObj.updateRow(e)}if(94==this.DocumentType&&("dcalpha5"==t.toLowerCase()&&(Object(l.j)(e.dcAlpha5)||(e.dcAlpha7=0,this.ScreenObject.GridDataObj.updateRow(e))),"dcalpha7"==t.toLowerCase())){if(!Object(l.j)(e.dcAlpha5))return e.dcAlpha7=0,this.ScreenObject.GridDataObj.updateRow(e),void(this.DisplayMessage="First Consider the Document then adjust");if(o.e.Double(e.dcAlpha7)+parseFloat(e.dcAlpha6)>parseFloat(e.dcAlpha4))return void(this.DisplayMessage="SUM of Prev.Adj.Days and Cur.Adj.Days should be less than or equal to 'No of Days'")}if(O&&!o.e.IsEmpty(O.Shortcut)&&"lostfocus"==O.Shortcut.toLowerCase()&&this.ValidateData_Column(O,e,!0)&&this.ScreenObject.GetExternalFuncData(O.Mode,O.SPName,O.IPParams,O.OPParams,e),O&&!o.e.IsEmpty(O.Shortcut)&&"onchange"==O.Shortcut.toLowerCase()&&this.ValidateData_Column(O,e,!0)&&(this.ScreenObject.GridDataColumns.Contains(t+"_Key")&&!o.e.IsEmpty(e[t+"_Key"])&&e[t+"_Key"].toString()!=this.PrevValue||!this.ScreenObject.GridDataColumns.Contains(t+"_Key")&&!o.e.IsEmpty(e[t])&&e[t].toString()!=this.PrevValue)&&this.ScreenObject.GetExternalFuncData(O.Mode,O.SPName,O.IPParams,O.OPParams,e),65==this.DocumentType&&"dcAlpha3"==t&&null!=e.dcAlpha1_Key&&null!=e.dcAlpha2_Key&&null!=e.dcAlpha3_Key){if(e.dcAlpha1=new Date(e.dcAlpha1_Key).ToString(s.a.SessionManager.Preferences["Date Format"]),e.dcAlpha1_Key=new Date(e.dcAlpha1_Key),e.dcAlpha2=new Date(e.dcAlpha2_Key).ToString(s.a.SessionManager.Preferences["Date Format"]),e.dcAlpha2_Key=new Date(e.dcAlpha2_Key),e.dcAlpha3=new Date(e.dcAlpha3_Key).ToString(s.a.SessionManager.Preferences["Date Format"]),e.dcAlpha3_Key=new Date(e.dcAlpha3_Key),"dcAlpha3"==t&&(null!=e.dcAlpha4&&s.a.SessionManager.Preferences.ContainsKey("AllowRejoinonHolidayweeklyoff")&&Object(l.j)("False"==s.a.SessionManager.Preferences.AllowRejoinonHolidayweeklyoff)&&(1==parseInt(e.dcAlpha4)?c="Re-join date should not be Weekly Off\r\n":2==parseInt(e.dcAlpha4)&&(c="Re-join date should not be Holiday\r\n")),new Date(e.dcAlpha3_Key)<=new Date(e.dcAlpha1_Key)?(c+="Re-join date should be after the vacation FromDate\r\n",e.dcAlpha4=1):""==c&&(e.dcAlpha4=0)),""!=c)return void(this.DisplayMessage=c);this.DisplayMessage="",this.MessageVisibility=!1}if(40059==this.ScreenObject.CostCenterID&&59==this.ScreenObject.DocumentType&&(this.ScreenObject.GridDataObj.updateRow(e),"dcAlpha1"==t&&null!=e.dcAlpha1_Key&&null!=e.dcNum1)){if(parseFloat(e.dcNum1)<=0)return void(this.DisplayMessage="Selected date should be Weeklyoff or Holiday");this.DisplayMessage=""}if(63==this.ScreenObject.DocumentType&&("dcCCNID52"==t||"dcAlpha5"==t||"dcAlpha6"==t)){if(this.ScreenObject.GridDataObj.updateRow(e),null!=e.dcAlpha3&&null!=e.dcAlpha8&&parseFloat(e.dcAlpha3)<=0&&-1!=parseFloat(e.dcAlpha8)&&(c="Please check the availability of leaves\r\n"),null!=e.dcNum1&&null!=e.dcAlpha4_Key&&null!=e.dcAlpha5_Key&&parseFloat(e.dcNum1)<=0&&(c="Dates already applied | Selected dates between Holidays/Weeklyoffs\r\n"),""!=c)return void(this.DisplayMessage=c);this.DisplayMessage="",this.MessageVisibility=!1}if(null!=O){var Kt=this.ReportsList.find((function(e){return e.Formula==O.ID&&"lostfocus"==e.KeyTip.toLowerCase()}));Kt&&this.OnReportsLinkClick(Kt.DBColumnID)}Logger.InfoLog("AddEditDocumentViewModel::Exiting OnCellEditEnding")}catch(Qt){if("PactException"==Qt.message)throw new Error("PactException");this.DisplayMessage="Problem processing document try again",Logger.ErrorLog("Addeditdocumentviewmodel","cell edit ending",Qt.stack)}}},{key:"InitProjWOffsHolidays",value:function(){this.dsProjWOffHol=[],this.dsProjWOffHol=s.a.common.GetDataSet("DOC066",this.DocumentDate.ToString("dd MMM yyyy"))}},{key:"DailyAttendanceCellEditEnd",value:function(e,t,n){var a,i,r=this,c="",l="",u="",d="",D="",h="",m="",b=0,y="",g="1",f=this.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()}));if(f instanceof S.c)f.Date&&(y=f.Date.ToString("dd/MMM/yyyy"));else{var O=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha1"==e.DisplayMember.toLowerCase()}));O&&!o.e.IsEmpty(e[O.DisplayMember+"_Key"])&&(y=new Date(e[O.DisplayMember+"_Key"]).ToString("dd/MMM/yyyy"))}if(f=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})))(f instanceof C.b||f instanceof p.a)&&(g=f.SelectedValue.toString());else{var I=this.ScreenObject.ColumnSource.find((function(e){return"LISTBOX"==e.DataType.toUpperCase()&&"dcccnid51_key"==e.ValueMember.toLowerCase()}));I&&!o.e.IsEmpty(e[I.ValueMember])&&(g=e[I.ValueMember].toString())}if(""!=y&&parseInt(g)>1){if(("dcAlpha2"==t||"dcAlpha3"==t||"dcNum1"==t)&&null!=e.dcAlpha2_Key&&null!=e.dcAlpha3_Key){if(e.dcAlpha2=c=new Date(e.dcAlpha2_Key).ToString("HH:mm"),e.dcAlpha2_Key=new Date(e.dcAlpha2_Key).ToString("dd-MMM-yyyy HH:mm"),e.dcAlpha3=l=new Date(e.dcAlpha3_Key).ToString("HH:mm"),e.dcAlpha3_Key=new Date(e.dcAlpha3_Key).ToString("dd-MMM-yyyy HH:mm"),"dcNum1"==t){var T=new Date(e.dcAlpha3_Key).Subtract(new Date(e.dcAlpha2_Key));D=1==T.Minutes.toString().length?T.Hours+".0"+T.Minutes:T.Hours+"."+T.Minutes,m=parseFloat(e.dcNum1).ToTime("00.00"),h=1==(i=new Date(Date.WithTime(m.toString().replace(".",":"))).Subtract(new Date(Date.WithTime(D.toString().replace(".",":"))))).Minutes.toString().length?i.Hours+".0"+i.Minutes:i.Hours+"."+i.Minutes,b=this.ConvertHoursToMinutes(h),l=new Date(e.dcAlpha3_Key).AddMinutes(b).ToString("HH:mm"),e.dcAlpha3=new Date(Date.WithTime(l)).ToString("HH:mm"),d=new Date(e.dcAlpha3_Key).ToString("dd-MMM-yyyy")+" "+l,e.dcAlpha3_Key=new Date(d).ToString("dd-MMM-yyyy HH:mm"),c=new Date(e.dcAlpha2_Key).ToString("HH:mm"),e.dcAlpha2=new Date(Date.WithTime(c)).ToString("HH:mm"),u=new Date(e.dcAlpha2_Key).ToString("dd-MMM-yyyy")+" "+c,e.dcAlpha2_Key=new Date(u).ToString("dd-MMM-yyyy HH:mm")}var j=this.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()}));j?j instanceof S.c&&j.Date&&(new Date(Date.Today().ToString("dd-MMM-yyyy")+" "+c)>new Date(Date.Today().ToString("dd-MMM-yyyy")+" "+l)?(u=(a=new Date(y)).ToString("dd-MMM-yyyy")+" "+c,e.dcAlpha2_Key=new Date(u).ToString("dd-MMM-yyyy HH:mm"),d=a.AddDays(1).ToString("dd-MMM-yyyy")+" "+l,e.dcAlpha3_Key=new Date(d).ToString("dd-MMM-yyyy HH:mm")):(u=(a=new Date(y)).ToString("dd-MMM-yyyy")+" "+c,e.dcAlpha2_Key=new Date(u).ToString("dd-MMM-yyyy HH:mm"),d=a.ToString("dd-MMM-yyyy")+" "+l,e.dcAlpha3_Key=new Date(d).ToString("dd-MMM-yyyy HH:mm"))):null!=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha1"==e.DisplayMember.toLowerCase()}))&&(new Date(Date.Today().ToString("dd-MMM-yyyy")+" "+c)>new Date(Date.Today().ToString("dd-MMM-yyyy")+" "+l)?(u=(a=new Date(y)).ToString("dd-MMM-yyyy")+" "+c,e.dcAlpha2_Key=new Date(u).ToString("dd-MMM-yyyy HH:mm"),d=a.AddDays(1).ToString("dd-MMM-yyyy")+" "+l,e.dcAlpha3_Key=new Date(d).ToString("dd-MMM-yyyy HH:mm")):(u=(a=new Date(y)).ToString("dd-MMM-yyyy")+" "+c,e.dcAlpha2_Key=new Date(u).ToString("dd-MMM-yyyy HH:mm"),d=a.ToString("dd-MMM-yyyy")+" "+l,e.dcAlpha3_Key=new Date(d).ToString("dd-MMM-yyyy HH:mm"))),(j=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})))?j instanceof C.b&&j.SelectedValue>0&&(new Date(a.ToString("dd-MMM-yyyy")+" "+c)>new Date(a.ToString("dd-MMM-yyyy")+" "+l)?(u=(a=new Date(y)).ToString("dd-MMM-yyyy")+" "+c,e.dcAlpha2_Key=new Date(u).ToString("dd-MMM-yyyy HH:mm"),d=a.AddDays(1).ToString("dd-MMM-yyyy")+" "+l,e.dcAlpha3_Key=new Date(d).ToString("dd-MMM-yyyy HH:mm")):(u=(a=new Date(y)).ToString("dd-MMM-yyyy")+" "+c,e.dcAlpha2_Key=new Date(u).ToString("dd-MMM-yyyy HH:mm"),d=a.ToString("dd-MMM-yyyy")+" "+l,e.dcAlpha3_Key=new Date(d).ToString("dd-MMM-yyyy HH:mm"))):null!=this.ScreenObject.ColumnSource.find((function(e){return"dcccnid51"==e.DisplayMember.toLowerCase()}))&&(new Date(Date.Today().ToString("dd-MMM-yyyy")+" "+c)>new Date(Date.Today().ToString("dd-MMM-yyyy")+" "+l)?(u=(a=new Date(y)).ToString("dd-MMM-yyyy")+" "+c,e.dcAlpha2_Key=new Date(u).ToString("dd-MMM-yyyy HH:mm"),d=a.AddDays(1).ToString("dd-MMM-yyyy")+" "+l,e.dcAlpha3_Key=new Date(d).ToString("dd-MMM-yyyy HH:mm")):(u=(a=new Date(y)).ToString("dd-MMM-yyyy")+" "+c,e.dcAlpha2_Key=new Date(u).ToString("dd-MMM-yyyy HH:mm"),d=a.ToString("dd-MMM-yyyy")+" "+l,e.dcAlpha3_Key=new Date(d).ToString("dd-MMM-yyyy HH:mm")))}"dcccnid51"!=t.toLowerCase()&&"dcccnid51code"!=t.toLowerCase()&&"dcalpha1"!=t.toLowerCase()||(this.CheckEmployeeShift(g,y,e),null==this.objPayDayCheck&&(this.objPayDayCheck=new st.a(this.ScreenObject)),this.objPayDayCheck.CheckIsHolidayDate(g,y,e,this.IsGetAllEmployees,this.dsAllEmployeeData)),(s.a.SessionManager.Preferences.ContainsKey("GeneralTimingsBasedOn")&&""!=s.a.SessionManager.Preferences.GeneralTimingsBasedOn||"dcAlpha1"==t)&&function(){var a=s.a.SessionManager.Preferences.GeneralTimingsBasedOn.split(",");if(null!=a&&a.length>0)for(var i=function(e){if(null!=a[e]&&""!=a[e]){r.ScreenObject.Data.Tables[0].CaseSensitive=!1;var t=r.ScreenObject.Data.Tables[0].filter((function(t){return t.localreference>0&&t.SysColumnName.startsWith("dcCCNID")&&t.ColumnCostcenterID==a[e]}));t.length>0&&!o.e.IsEmpty(t[0].LocalCCID)&&a.push(t[0].LocalCCID.toString())}},c=0;c<a.length;c++)i(c);(t.startsWith("dcCCNID")&&a.Contains(n.CostCenterID.toString())&&e[n.ValueMember].toString()!=r.PrevValue||"dcAlpha1"==t)&&r.FillGeneralTimings(g,y,e)}(),(s.a.SessionManager.Preferences.ContainsKey("HoursDefChartBasedOn")&&""!=s.a.SessionManager.Preferences.HoursDefChartBasedOn&&t.startsWith("dcCCNID")||"dcAlpha1"==t||"dcAlpha2"==t||"dcAlpha3"==t||"dcNum1"==t||"dcNum4"==t||"dcNum5"==t||"dcnum7"==t.toLowerCase()||"dcnum9"==t.toLowerCase()||"dcnum11"==t.toLowerCase()||"dcnum13"==t.toLowerCase())&&function(){var a=s.a.SessionManager.Preferences.HoursDefChartBasedOn.split(",");if(null!=a&&a.length>0)for(var i=function(e){if(null!=a[e]&&""!=a[e]){r.ScreenObject.Data.Tables[0].CaseSensitive=!1;var t=r.ScreenObject.Data.Tables[0].filter((function(t){return t.localreference>0&&t.SysColumnName.startsWith("dcCCNID")&&t.ColumnCostcenterID==a[e]}));t.length>0&&!o.e.IsEmpty(t[0].LocalCCID)&&a.push(t[0].LocalCCID.toString())}},c=0;c<a.length;c++)i(c);(t.startsWith("dcCCNID")&&a.Contains(n.CostCenterID.toString())&&e[n.ValueMember].toString()!=r.PrevValue||"dcAlpha1"==t||"dcAlpha2"==t||"dcAlpha3"==t||"dcNum1"==t||"dcNum4"==t||"dcNum5"==t||"dcnum7"==t.toLowerCase()||"dcnum9"==t.toLowerCase()||"dcnum11"==t.toLowerCase()||"dcnum13"==t.toLowerCase())&&r.DistributeTotalHours(g,y,e,t)}()}this.ScreenObject.GridDataObj.updateRow(e),this.ScreenObject.GridDataObj.refreshDatawithIDs()}},{key:"AutoSerialNumber",value:function(e,t){if(0==this.ScreenObject.DocID||o.e.IsEmpty(e.ExtraXML))t.SerialNumber.Text=t.ds.Tables[3][0][t.ds.Columns[3][0]].toString(),t.Qty.Text=e.Quantity.toString(),t.DisplayMessage="",t.GridData.Clear(),t.OnSave("Add"),t.DisplayMessage.length>0?this.DisplayMessage=t.DisplayMessage:(t.OnSave("Save"),t.DisplayMessage.length>0&&(this.DisplayMessage=t.DisplayMessage));else{var n=new o.f;n.LoadXml(e.ExtraXML);var a=n.SelectNodes("xml/Row");if(parseInt(e.Quantity)>a.length)t.SerialNumber.Text=t.ds.Tables[3][0][t.ds.Columns[3][0]].toString(),t.Qty.Text=(parseInt(e.Quantity)-a.length).toString(),t.DisplayMessage="",t.OnSave("Add"),t.DisplayMessage.length>0?this.DisplayMessage=t.DisplayMessage:(t.OnSave("Save"),t.DisplayMessage.length>0&&(this.DisplayMessage=t.DisplayMessage));else if(parseInt(e.Quantity)<a.length&&t.GridData.length>0)for(var i=t.GridData.length-1;i>=parseInt(e.Quantity);i--)t.SelectedRow=t.GridData[t.GridData.indexOf(t.GridData[i])],t.OnRemove("Remove"),t.DisplayMessage.length>0&&(this.DisplayMessage=t.DisplayMessage)}}},{key:"AddProductQty",value:function(e,t){var n=this,a=!1;this.ScreenObject.GridDataObj.updateRow(e);var i=this.ScreenObject.GridData;if(o.e.IsEmpty(e.ProductID_Key))return a;if(i=i.filter((function(t){return t.ProductID_Key==o.e.String(e.ProductID_Key)})),o.e.IsEmpty(e.Unit_Key)||(i=i.filter((function(t){return t.Unit_Key==o.e.String(e.Unit_Key)}))),"5"==o.e.String(e.Type)){if(!o.e.IsEmpty(e.ExtraXML))return!1;i=i.filter((function(e){return null==e.ExtraXML}))}console.log("Test:ClubProdBasedon-29813"),this.ScreenObject.Preferences.ContainsKey("ClubProdBasedon")&&""!=this.ScreenObject.Preferences.ClubProdBasedon&&this.ScreenObject.Preferences.ClubProdBasedon.split(",").forEach((function(t){n.ScreenObject.GridDataColumns.Contains(t)&&(i=i.filter((function(n){return n[t]==o.e.String(e[t])})))}));var r=i;if(r.length>1){var s,c,l=this.ScreenObject.GridData.indexOf(r[0]),u=this.ScreenObject.GridData.indexOf(r[1]);s=o.e.Double(r[0].Quantity),c=o.e.Double(r[1].Quantity),l>u?(r[1].Quantity=s+c,e=r[1],this.Setselectedrow(u),this.ScreenObject.GridDataObj.removeRow(r[0]),this.LineNo=u+1):(r[0].Quantity=s+c,e=r[0],this.Setselectedrow(l),this.ScreenObject.GridDataObj.removeRow(r[1]),this.LineNo=l+1);var d=this.ColumnNo,D=this.ScreenObject.ColumnSource.find((function(e){return!o.e.IsEmpty(e.DisplayMember)&&"quantity"==e.DisplayMember.toLowerCase()}));D&&(this.ColumnNo=this.ScreenObject.ColumnSource.indexOf(D)+1),t&&(this.SetFocusongrid=!0),this.ColumnNo=d,a=!0}return a}},{key:"jvTotal",value:function(){if(17==this.ScreenObject.DocumentType||28==this.ScreenObject.DocumentType||29==this.ScreenObject.DocumentType){for(var e=0,t=0,n=0;n<this.ScreenObject.GridData.length;n++){var a=1;s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&(this.Currency&&!o.e.IsEmpty(this.Currency.ExchangeRate.Text)?a=parseFloat(this.Currency.ExchangeRate.Text):this.ScreenObject.GridDataColumns.Contains("ExchangeRate")&&!o.e.IsEmpty(this.ScreenObject.GridData[n].ExchangeRate)&&(a=parseFloat(this.ScreenObject.GridData[n].ExchangeRate))),o.e.IsEmpty(this.ScreenObject.GridData[n].AccountID_Key)||(o.e.IsEmpty(this.ScreenObject.GridData[n].DebitAmount)||(t+=parseFloat(this.ScreenObject.GridData[n].DebitAmount)*a),o.e.IsEmpty(this.ScreenObject.GridData[n].CreditAmount)||(e+=parseFloat(this.ScreenObject.GridData[n].CreditAmount)*a))}var i=this.ScreenObject.ColumnSource.find((function(e){return null!=e.DisplayMember&&"debitamount"==e.DisplayMember.toLowerCase()})),r=this.ScreenObject.ColumnSource.find((function(e){return null!=e.DisplayMember&&"creditamount"==e.DisplayMember.toLowerCase()}));if(null!=i&&null!=r&&e.ToString("N"+i.DecimalPoints)!=t.ToString("N"+r.DecimalPoints))if(t>e)if(1==r.ShowbodyTotal)r.footer=(e-t).ToString("N"+i.DecimalPoints);else{var c=1;s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&this.Currency&&!o.e.IsEmpty(this.Currency.ExchangeRate.Text)&&(c=parseFloat(this.Currency.ExchangeRate.Text)),r.footer=0!=c?((e-t)/c).ToString("N"+i.DecimalPoints):(e-t).ToString("N"+i.DecimalPoints)}else if(1==i.ShowbodyTotal)i.footer=(t-e).ToString("N"+r.DecimalPoints);else{var u=1;s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&this.Currency&&!o.e.IsEmpty(this.Currency.ExchangeRate.Text)&&(u=parseFloat(this.Currency.ExchangeRate.Text)),i.footer=0!=u?((t-e)/u).ToString("N"+r.DecimalPoints):(t-e).ToString("N"+r.DecimalPoints)}}}},{key:"GetProductValues",value:function(e,t){var n=this,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=1;if(0==(l=o.e.Double(e.Quantity))&&(l=1),0!=t||!this.ScreenObject.GridDataColumns.Contains("Unit_Key")||o.e.IsEmpty(e.Unit_Key)||o.e.IsEmpty(e.ProductID_Key)||0!=this.ProdID&&this.ProdID!=parseInt(e.ProductID_Key)||(t=parseInt(e.Unit_Key)),0==t&&null!=this.barcodeValues&&this.barcodeValues.ContainsKey("Unit_Key")&&!o.e.IsEmpty(this.barcodeValues.Unit_Key)&&(t=parseInt(e.Unit_Key)),null!=c||""==o.e.String(e.ProductID_Key)&&null==i||(c=this.ScreenObject.GetProductTypeDetails(o.e.String(e.ProductID_Key),this.DocumentDate,t,l,o.e.String(e.DocDetailsID),e,a,i,!1,0,this.Currency,r)),c&&c.Tables.length>0&&c.Tables[0].length>0){if(!o.e.IsEmpty(i)&&!c.Columns[0].Contains("ErrorMessage")){if(e.ProductID_Key=c.Tables[0][0].ProductID,this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(e.ProductCode=c.Tables[0][0].ProductCode.toString()),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(e.ProductName=c.Tables[0][0].ProductName.toString()),s.a.SessionManager.Preferences.ContainsKey("POSItemCodeDimension")){var u=this.ScreenObject.ColumnSource.find((function(e){return e.CostCenterID.toString()==s.a.SessionManager.Preferences.POSItemCodeDimension}));u&&this.ScreenObject.GridDataColumns.Contains(u.DisplayMember)&&(e[u.DisplayMember]=i,!o.e.IsEmpty(u.ValueMember)&&this.ScreenObject.GridDataColumns.Contains(u.ValueMember)&&c.Columns[0].Contains("stockID")&&!o.e.IsEmpty(c.Tables[0][0].stockID)&&(e[u.ValueMember]=c.Tables[0][0].stockID.toString()))}this.SalesManDimension.Visible&&this.ScreenObject.GridDataColumns.Contains("Dcccnid5")&&this.SalesManDimension.SelectedValue>0&&(e.Dcccnid5=this.SalesManDimension.Text,e.Dcccnid5_Key=this.SalesManDimension.SelectedValue),this.FillDefaultValues(e),this.RepeatRowData(e),this.BindDivisionorLocation(e),c.Tables.length>1&&c.Tables[1].length>0&&this.FillPromotions(c.Tables[1],this.ScreenObject.GridData.indexOf(e))}if(e.AVGRATE=c.Columns[0].Contains("AvgRate")&&!o.e.IsEmpty(c.Tables[0][0].AvgRate)?c.Tables[0][0].AvgRate.toString():0,parseInt(e.ProductID_Key)!=this.ScreenObject.TempProductID&&(e.QOH=o.e.IsEmpty(c.Tables[0][0].QOH)?0:c.Tables[0][0].QOH.toString(),e.BalQOH=o.e.IsEmpty(c.Tables[0][0].BalQOH)?0:c.Tables[0][0].BalQOH.toString(),e.HOLDQTY=o.e.IsEmpty(c.Tables[0][0].HOLDQTY)?0:c.Tables[0][0].HOLDQTY.toString(),e.CommittedQty=o.e.IsEmpty(c.Tables[0][0].CommittedQty)?0:c.Tables[0][0].CommittedQty.toString(),e.RESERVEQTY=o.e.IsEmpty(c.Tables[0][0].RESERVEQTY)?0:c.Tables[0][0].RESERVEQTY.toString(),e.TotalReserve=o.e.IsEmpty(c.Tables[0][0].TotalReserve)?0:c.Tables[0][0].TotalReserve.toString(),this.FillDatarow(e,c.Tables[0],null,{LocalReference:79,LinkData:23819},"AvgRate"),this.FillDatarow(e,c.Tables[0],null,{LocalReference:79,LinkData:25398},"QOH"),this.FillDatarow(e,c.Tables[0],null,{LocalReference:79,LinkData:52638},"QOH"),this.FillDatarow(e,c.Tables[0],null,{LocalReference:79,LinkData:52637},"BalQOH"),this.FillDatarow(e,c.Tables[0],null,{LocalReference:79,LinkData:26421},"HOLDQTY"),this.FillDatarow(e,c.Tables[0],null,{LocalReference:79,LinkData:50454},"CommittedQty"),this.FillDatarow(e,c.Tables[0],null,{LocalReference:79,LinkData:26422},"RESERVEQTY"),this.FillDatarow(e,c.Tables[0],null,{LocalReference:79,LinkData:499943},"TotalReserve")),c.Tables.length>3&&c.Tables[3].length>0&&(this.FillDatarowNN(e,c.Tables[3],null,{LinkData:55481},"WEF"),this.FillDatarowNN(e,c.Tables[3],null,{LinkData:55484},"TillDate"),this.FillDatarowNN(e,c.Tables[3],null,{LinkData:55486},"ProfileName")),c.Tables.length>4&&c.Tables[4].length>0&&(this.FillDatarowNN(e,c.Tables[4],null,{LinkData:55482},"WEF"),this.FillDatarowNN(e,c.Tables[4],null,{LinkData:55485},"TillDate"),this.FillDatarowNN(e,c.Tables[4],null,{LinkData:55487},"ProfileName")),31==this.ScreenObject.DocumentType){e.QOH=o.e.IsEmpty(c.Tables[0][0].QOH)?0:c.Tables[0][0].QOH.toString();var d="",D=this.ScreenObject.ColumnSource.find((function(e){return e.ID==n.ScreenObject.Preferences.QOHField}));D&&(d=D.DisplayMember),""!=d&&(e[d]=e.QOH.toString())}}return c}},{key:"FillProductValues",value:function(e){var t=this.GetProductValues(e,0);o.e.IsEmpty(e.Unit_Key)&&t.Tables.length>0&&t.Columns[0].Contains("uomid")&&!o.e.IsEmpty(t.Tables[0][0].uomid)&&(e.Unit=t.Tables[0][0].UnitName.toString(),e.Unit_Key=t.Tables[0][0].uomid.toString());for(var n=this.ScreenObject.ColumnSource.filter((function(e){return e.DisplayMember.Contains("dcNum")&&4!=e.SectionID})),a=function(a){var i=n[a];if(!(i.linkData>0)&&t.Tables.length>4){var r=t.Tables[4].filter((function(e){return e.SysColumnName==i.DisplayMember}));r.length>0&&(e[i.DisplayMember]=r[0].Value.toString(),e["default"+i.DisplayMember]=r[0].Value.toString())}},i=0;i<n.length;i++)a(i);this.FillRates(t,e);var r=this.ScreenObject.Data.Tables[0];if(r.length>0){var s=this.ScreenObject.ColumnSource.find((function(e){return null!=e.ValueMember&&"productid_key"==e.ValueMember.toString().toLowerCase()}));if(s&&s.CostCenterID>0){(r=this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&(e.LocalReference==s.ID||79==e.LocalReference&&(26585==e.LinkData||54306==e.LinkData||54307==e.LinkData||53529==e.LinkData||53589==e.LinkData||53530==e.LinkData))}))).length>0&&s.ValueMember&&!o.e.IsEmpty(e[s.ValueMember])&&this.ScreenObject.GetLinkReferenceData(parseInt(s.ID),this.DocumentID,parseInt(e[s.ValueMember]),Date.Today(),"",s.CostCenterID,e,null,!1);var c=null;"ProductName"==s.DisplayMember?c=this.ScreenObject.ColumnSource.find((function(e){return"ProductCode"==e.DisplayMember})):"ProductCode"==s.DisplayMember&&(c=this.ScreenObject.ColumnSource.find((function(e){return"ProductName"==e.DisplayMember}))),c&&((r=this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&e.LocalReference==c.ID}))).length>0&&c.ValueMember&&!o.e.IsEmpty(e[c.ValueMember])&&this.ScreenObject.GetLinkReferenceData(parseInt(c.ID),this.DocumentID,parseInt(e[c.ValueMember]),Date.Today(),"",c.CostCenterID,e,null,!1))}}t.Tables.length>0&&t.Tables[0].length>0&&!t.Columns[0].Contains("ErrorMessage")&&o.e.Int(t.Tables[0][0].DrAccount)>0&&this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&(e.DebitAccount_Key=t.Tables[0][0].DrAccount.toString(),this.ScreenObject.GridDataColumns.Contains("DebitAccount")&&(e.DebitAccount=t.Tables[0][0].DrName.toString())),t.Tables.length>0&&t.Tables[0].length>0&&!t.Columns[0].Contains("ErrorMessage")&&o.e.Int(t.Tables[0][0].CrAccount)>0&&this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&(e.CreditAccount_Key=t.Tables[0][0].CrAccount.toString(),this.ScreenObject.GridDataColumns.Contains("CreditAccount")&&(e.CreditAccount=t.Tables[0][0].CrName.toString())),this.CalculateTotals(e,!1)}},{key:"ClearDatarow",value:function(e,t){if(s.a.IsMobile)this.ScreenObject.GridDataObj.removeRow(e);else{e.Type=0,this.ScreenObject.GridDataColumns.Contains("BinWise")&&(e.BinWise=null),this.ScreenObject.GridDataColumns.Contains("QtyType")&&(e.QtyType=null),e.LinkedInvDocDetailsID=0,e.LinkedFieldName="",e.RefNo="",e.UOMConversion=0,e.QOH=0,e.BalQOH=0,e.HOLDQTY=0,e.CommittedQty=0,e.RESERVEQTY=0,e.TotalReserve=0,e.LASTPURCHASERATE=0,e.UOMConvertedQty=0,e.Unit="",e.Unit_Key=0,e.ExtraXML=null,t?(e.Quantity=null,e.Rate=null,e.defaultRate=null):(e.Quantity=0,e.Rate=0,e.defaultRate=0);for(var n=0;n<this.ScreenObject.ColumnSource.length;n++){var a=this.ScreenObject.ColumnSource[n];if(4!=a.SectionID&&"FillGUID"!=a.DistributeColName){if(null!=a.DisplayMember&&a.DisplayMember.toLowerCase().Contains("dcnum")&&(t?(e[a.DisplayMember]=null,e["default"+a.DisplayMember]=null,e["dcCalc"+a.DisplayMember]=null):(e[a.DisplayMember]=0,e["default"+a.DisplayMember]=0,e["dcCalc"+a.DisplayMember]=0)),null!=a.DisplayMember&&a.DisplayMember.toLowerCase().Contains("alpha")){if(!t&&this.ScreenObject.Preferences.ContainsKey("ProductFilterField")&&""!=this.ScreenObject.Preferences.ProductFilterField&&a.ID==this.ScreenObject.Preferences.ProductFilterField)continue;e[a.DisplayMember]=null}t&&!o.e.IsEmpty(a.ValueMember)&&this.ScreenObject.GridDataColumns.Contains(a.ValueMember)&&(e[a.ValueMember]=null,e[a.DisplayMember]=null)}}}}},{key:"RepeatRowData",value:function(e){var t=this.ScreenObject.GridData.indexOf(e);if(t>0)for(var n=0;n<this.ScreenObject.ColumnSource.length;n++)this.ScreenObject.ColumnSource[n].IsRepeat&&(this.ScreenObject.ColumnSource[n].CostCenterID>0&&this.ScreenObject.ColumnSource[n].CostCenterID!=this.CostCenterID?o.e.IsEmpty(e[this.ScreenObject.ColumnSource[n].ValueMember])&&(e[this.ScreenObject.ColumnSource[n].DisplayMember]=this.ScreenObject.GridData[t-1][this.ScreenObject.ColumnSource[n].DisplayMember],e[this.ScreenObject.ColumnSource[n].ValueMember]=this.ScreenObject.GridData[t-1][this.ScreenObject.ColumnSource[n].ValueMember],this.FillLinkRef(e,this.ScreenObject.ColumnSource[n])):this.ScreenObject.ColumnSource[n].DisplayMember.toLowerCase().Contains("dcnum")?o.e.IsEmpty(e[this.ScreenObject.ColumnSource[n].DisplayMember])&&(e[this.ScreenObject.ColumnSource[n].DisplayMember]=this.ScreenObject.GridData[t-1][this.ScreenObject.ColumnSource[n].DisplayMember]):"DATE"==this.ScreenObject.ColumnSource[n].DataType||"datetime"==this.ScreenObject.ColumnSource[n].DataType.toLocaleLowerCase()||"time"==this.ScreenObject.ColumnSource[n].DataType.toLocaleLowerCase()?o.e.IsEmpty(e[this.ScreenObject.ColumnSource[n].DisplayMember])&&(e[this.ScreenObject.ColumnSource[n].DisplayMember]=this.ScreenObject.GridData[t-1][this.ScreenObject.ColumnSource[n].DisplayMember],e[this.ScreenObject.ColumnSource[n].DisplayMember+"_Key"]=this.ScreenObject.GridData[t-1][this.ScreenObject.ColumnSource[n].DisplayMember+"_Key"]):"PactComboBox"==this.ScreenObject.ColumnSource[n].DataType||"ComboBox"==this.ScreenObject.ColumnSource[n].DataType?o.e.IsEmpty(e[this.ScreenObject.ColumnSource[n].ValueBinding])&&(e[this.ScreenObject.ColumnSource[n].ValueBinding]=this.ScreenObject.GridData[t-1][this.ScreenObject.ColumnSource[n].ValueBinding]):o.e.IsEmpty(e[this.ScreenObject.ColumnSource[n].DisplayMember])&&(e[this.ScreenObject.ColumnSource[n].DisplayMember]=this.ScreenObject.GridData[t-1][this.ScreenObject.ColumnSource[n].DisplayMember]))}},{key:"CheckStockDimensions",value:function(){if(s.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&o.e.Int(s.a.SessionManager.Preferences["Maintain Dimensionwise stock"])>5e4){var e=this.ScreenObject._CCFields.find((function(e){return"dcccnid-50000"==e.DBColumnName.toLowerCase()}));if(!this.ScreenObject.GridDataColumns.Contains("dcCCNID-50000_Key")&&!e){var t=new C.b(0);if(t.CCID=0,t.TypeID=1,t.Label=this.ScreenObject.GetCostcenterName(0),t.DBColumnName="dcCCNID-50000",t.Mandatory=!0,this.ScreenObject.CustomTab.Pages.length>0)t.Row=this.ScreenObject.CustomTab.Pages[0].Fields.length/4,t.Column=this.ScreenObject.CustomTab.Pages[0].Fields.length%4,this.ScreenObject.CustomTab.Pages[0].Fields.push(t),this.ScreenObject._CCFields.push(t);else{t.Row=0,t.Column=0;var n=new P.b;n.Header="Extra fields",n.Name="Extra fields",this.ScreenObject.CustomTab.Pages.push(n),this.ScreenObject.CustomTab.Pages[0].Fields.push(t),this.ScreenObject.CustomTab.Visible=!0,this.ScreenObject.CustomTab.SelectedTab=this.ScreenObject.CustomTab.Pages[0],this.ScreenObject._CCFields.push(t)}}}if(s.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&Object(l.j)(s.a.SessionManager.Preferences.EnableLocationWise)&&Object(l.j)(s.a.SessionManager.Preferences.EnableLocationWise)&&s.a.SessionManager.Preferences.ContainsKey("Location Stock")&&Object(l.j)(s.a.SessionManager.Preferences["Location Stock"])&&Object(l.j)(s.a.SessionManager.Preferences["Location Stock"])&&!this.ScreenObject._CCFields.find((function(e){return"dcccnid2"==e.DBColumnName.toLowerCase()}))&&!this.ScreenObject.GridDataColumns.Contains("dcCCNID2_Key")){var a=new C.b(0);if(a.CCID=50002,a.TypeID=1,a.Label=s.a.SessionManager.Preferences.ContainsKey("LocationName")?s.a.SessionManager.Preferences.LocationName:"Location",a.DBColumnName="dcCCNID2",a.Mandatory=!0,this.ScreenObject.CustomTab.Pages.length>0)a.Row=this.ScreenObject.CustomTab.Pages[0].Fields.length/4,a.Column=this.ScreenObject.CustomTab.Pages[0].Fields.length%4,this.ScreenObject.CustomTab.Pages[0].Fields.push(a),this.ScreenObject._CCFields.push(a);else{a.Row=0,a.Column=0;var i=new P.b;i.Header="Extra fields",i.Name="Extra fields",this.ScreenObject.CustomTab.Pages.push(i),this.ScreenObject.CustomTab.Pages[0].Fields.push(a),this.ScreenObject.CustomTab.Visible=!0,this.ScreenObject.CustomTab.SelectedTab=this.ScreenObject.CustomTab.Pages[0],this.ScreenObject._CCFields.push(a)}}if(s.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&Object(l.j)(s.a.SessionManager.Preferences.EnableDivisionWise)&&Object(l.j)(s.a.SessionManager.Preferences.EnableDivisionWise)&&s.a.SessionManager.Preferences.ContainsKey("Division Stock")&&Object(l.j)(s.a.SessionManager.Preferences["Division Stock"])&&Object(l.j)(s.a.SessionManager.Preferences["Division Stock"])&&!this.ScreenObject._CCFields.find((function(e){return"dcccnid1"==e.DBColumnName.toLowerCase()}))&&!this.ScreenObject.GridDataColumns.Contains("dcCCNID1_Key")){var r=new C.b(0);if(r.CCID=50001,r.TypeID=1,r.Label=s.a.SessionManager.Preferences.ContainsKey("DivisionName")?s.a.SessionManager.Preferences.DivisionName:"Division",r.DBColumnName="dcCCNID1",r.Mandatory=!0,this.ScreenObject.CustomTab.Pages.length>0)r.Row=this.ScreenObject.CustomTab.Pages[0].Fields.length/4,r.Column=this.ScreenObject.CustomTab.Pages[0].Fields.length%4,this.ScreenObject.CustomTab.Pages[0].Fields.push(r),this.ScreenObject._CCFields.push(r);else{r.Row=0,r.Column=0;var c=new P.b;c.Header="Extra fields",c.Name="Extra fields",this.ScreenObject.CustomTab.Pages.push(c),this.ScreenObject.CustomTab.Pages[0].Fields.push(r),this.ScreenObject.CustomTab.Visible=!0,this.ScreenObject.CustomTab.SelectedTab=this.ScreenObject.CustomTab.Pages[0],this.ScreenObject._CCFields.push(r)}}}},{key:"QtyReader",value:function(e){return e}},{key:"AddProductData",value:function(e,t,n){var a=this,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;if(o.e.IsEmpty(e.ProductID_Key)||null!=c||this.ProdID!=parseInt(e.ProductID_Key)||0==parseInt(e.ProductID_Key)){if(o.e.IsEmpty(e.ProductID_Key)||this.ProdID==parseInt(e.ProductID_Key)||this.ScreenObject.Preferences.ContainsKey("SnoBasedLinking")&&""!=this.ScreenObject.Preferences.SnoBasedLinking&&Object(l.j)(this.ScreenObject.Preferences.SnoBasedLinking)||(e.LinkedInvDocDetailsID=0,e.LinkedFieldName="",e.RefNo=""),o.e.IsEmpty(e.ProductID_Key)||this.ProdID==parseInt(e.ProductID_Key)||0==parseInt(e.ProductID_Key)||(e.ExtraXML=null,!(this.ProdID>0)||this.ScreenObject.Preferences.ContainsKey("Dontresetvaluesonproductchange")&&""!=this.ScreenObject.Preferences.Dontresetvaluesonproductchange&&Object(l.j)(this.ScreenObject.Preferences.Dontresetvaluesonproductchange))||this.ScreenObject.ColumnSource.filter((function(e){return e.DisplayMember.toLowerCase().Contains("dcalpha")})).forEach((function(t){"FillGUID"!=t.DistributeColName&&(e[t.DisplayMember]=null)})),31!=this.ScreenObject.DocumentType&&32!=this.ScreenObject.DocumentType||null==u){if(!o.e.IsEmpty(e.ProductID_Key)&&e.ProductID_Key.toString()!=this.ScreenObject.TempProductID.toString()&&(this.ScreenObject.Preferences.ContainsKey("Alert Duplicate Product")&&""!=this.ScreenObject.Preferences["Alert Duplicate Product"].toString()&&Object(l.j)(this.ScreenObject.Preferences["Alert Duplicate Product"])||(31==this.ScreenObject.DocumentType||32==this.ScreenObject.DocumentType)&&!this.ScreenObject.GridDataColumns.Contains("BOEID")))for(var d=0;d<this.ScreenObject.GridData.length;d++)if(this.ScreenObject.GridData[d]!=e&&!o.e.IsEmpty(this.ScreenObject.GridData[d].ProductID_Key)&&this.ScreenObject.GridData[d].ProductID_Key.toString()==e.ProductID_Key.toString()&&("5"!=this.ScreenObject.GridData[d].Type.toString()||31!=this.ScreenObject.DocumentType&&32!=this.ScreenObject.DocumentType)){if(s.a.SessionManager.Preferences.ContainsKey("ShowProdCodeinErrMsg")&&Object(l.j)(s.a.SessionManager.Preferences.ShowProdCodeinErrMsg)?this.res=this.ScreenObject.GridData[d].ProductCode.toString()+"-"+this.ScreenObject.GridData[d].ProductName.toString():this.ScreenObject.GridDataColumns.Contains("ProductName")?this.res=this.ScreenObject.GridData[d].ProductName.toString():this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(this.res=this.ScreenObject.GridData[d].ProductCode.toString()),confirm("Product '"+this.res+"' Already exists at Row No:"+this.ScreenObject.GridData[d].DocSeqNo.toString()+".\nDo you want to continue?")&&31!=this.ScreenObject.DocumentType&&32!=this.ScreenObject.DocumentType)break;if(this.ProdID>0){e.ProductID_Key=this.ProdID;var D=s.a.document.GetCCValues(this.ProdID.toString(),3,2);return void(null!=D&&D.Tables.length>0&&D.Columns[0].Contains("name")&&(this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(e.ProductCode=D[0].Code.toString()),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(e.ProductName=D[0].name.toString())))}return this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(e.ProductCode=null),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(e.ProductName=null),this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&(e.ProductID_Key=null),this.LineNo=d+1,void(this.SetFocusongrid=!0)}}else{var h=this.ScreenObject.GridData.filter((function(t){return t[u.ValueMember]==o.e.String(e[u.ValueMember])}));if(h.length>1)return s.a.SessionManager.Preferences.ContainsKey("ShowProdCodeinErrMsg")&&Object(l.j)(s.a.SessionManager.Preferences.ShowProdCodeinErrMsg)?this.res=e.ProductCode.toString()+"-"+e.ProductName.toString():this.ScreenObject.GridDataColumns.Contains("ProductName")?this.res=e.ProductName.toString():this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(this.res=e.ProductCode.toString()),this.DisplayMessage="Product '"+this.res+"' Already exists at Row No:"+h[0].DocSeqNo.toString(),void(this.SetFocusongrid=!0)}31==this.ScreenObject.DocumentType&&this.ScreenObject.GridDataColumns.Contains("DueDate")&&(e.DueDate=Date.Today().ToString(s.a.SessionManager.Preferences["Date Format"]),e.DueDate_Key=Date.Today()),o.e.IsEmpty(e.ProductID_Key)||(this.FillDefaultValues(e),this.RepeatRowData(e),this.BindDivisionorLocation(e));var S=this.GetProductValues(e,0,!1,c);if(null!=S&&S.Tables.length>4&&S.Tables[4].length>0){var m=S.Tables[4].filter((function(e){return-1==e.ColID}));if(m.length>0)for(var b=0;b<m.length;b++)alert(m[b].Message.toString())}if(o.e.IsEmpty(c)||o.e.IsEmpty(e.ProductID_Key)){try{this.ScreenObject.GridDataColumns.Contains("ProductCode")&&o.e.IsEmpty(e.ProductCode)&&(e.ProductCode=S.Tables[0][0].ProductCode),this.ScreenObject.GridDataColumns.Contains("ProductName")&&o.e.IsEmpty(e.ProductName)&&(e.ProductName=S.Tables[0][0].ProductName),this.ScreenObject.GridDataColumns.Contains("IsWeightable")&&S.Columns[0].Contains("IsWeightable")&&(e.IsWeightable=S.Tables[0][0].IsWeightable)}catch(K){}if(i)e.Subexists="1";else if(null!=S&&S.Tables.length>8&&S.Tables[8].length>1&&!S.Columns[8].Contains("ErrorMessage")&&(!this.ScreenObject.Preferences.ContainsKey("SubstituteOnQty")||""==this.ScreenObject.Preferences.SubstituteOnQty.toString()||!this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.Preferences.SubstituteOnQty))&&this.ScreenObject.Preferences.ContainsKey("EnableSubtitutes")&&""!=this.ScreenObject.Preferences.EnableSubtitutes.toString()&&Object(l.j)(this.ScreenObject.Preferences.EnableSubtitutes))if(n||0!=s.a.page.DialogCount)e.Subexists="1";else{if(null!=e.ProductCode){var C=new me.a(this,S.Tables[8],S.Columns[8],S.Tables[9],e.ProductName.toString(),e.ProductCode.toString(),e.ProductID_Key.toString());C.GridData.length>0&&s.a.page.ShowDialog(C,be.a,{ShowCenter:!0})}else{var y=new me.a(this,S.Tables[8],S.Columns[8],S.Tables[9],e.ProductName.toString(),"","");y.GridData.length>0&&s.a.page.ShowDialog(y,be.a,{ShowCenter:!0})}if(this.ScreenObject.UpdateSequence(),this.SubDialogResult)return void this.ScreenObject.GridDataObj.updateRow(e);e.AVGRATE=S.Columns[0].Contains("AvgRate")&&!o.e.IsEmpty(S.Tables[0][0].AvgRate)?S.Tables[0][0].AvgRate.toString():0}else e.Subexists="0";if(this.ScreenObject.Preferences.ContainsKey("ProductWiseCreditDays")&&""!=this.ScreenObject.Preferences.ProductWiseCreditDays&&Object(l.j)(this.ScreenObject.Preferences.ProductWiseCreditDays)&&S.Tables.length>0&&S.Tables[0].length>0&&S.Columns[0].Contains("CreditDays")&&this.ScreenObject.GetDueDate_Table(S.Tables[0],this.DocumentDate,!1),S.Tables.length>0&&S.Tables[0].length>0&&!S.Columns[0].Contains("ErrorMessage")&&!o.e.IsEmpty(S.Tables[0][0].DrAccount)&&parseInt(S.Tables[0][0].DrAccount)>0){var p=!1;if(this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")){if(o.e.String(e.DebitAccount_Key)!=S.Tables[0][0].DrAccount.toString()&&(p=!0),e.DebitAccount_Key=S.Tables[0][0].DrAccount.toString(),this.ScreenObject.GridDataColumns.Contains("DebitAccount"))e.DebitAccount=S.Tables[0][0].DrName.toString();else{var g=this.ScreenObject.ColumnSource.find((function(e){return null!=e.ValueMember&&"debitaccount_key"==e.ValueMember.toLowerCase()}));g&&(e[g.DisplayMember]=S.Tables[0][0].DrName.toString())}if(p){var f=this.ScreenObject.ColumnSource.find((function(e){return null!=e.ValueMember&&"debitaccount_key"==e.ValueMember.toLowerCase()}));this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&e.LocalReference==f.ID})).length>0&&this.ScreenObject.GetLinkReferenceData(parseInt(f.ID),this.DocumentID,parseInt(e[f.ValueMember]),Date.Today(),"",f.CostCenterID,e),s.a.SessionManager.Preferences.BudgetAccount.length>0&&s.a.SessionManager.Preferences.BudgetDimension.length>0&&this.BudgetObj.AutoLoadBudgetDimension(e,null)}}else null!=this.ScreenObject.DebitAccount&&(this.ScreenObject.DebitAccount.SelectedValue!=parseInt(S.Tables[0][0].DrAccount)&&(p=!0),this.ScreenObject.DebitAccount.SelectedValue=parseInt(S.Tables[0][0].DrAccount),s.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==s.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(this.ScreenObject.DebitAccount.Name.SelectedValueText=S.Tables[0][0].DrName.toString()),p&&s.a.SessionManager.Preferences.BudgetAccount.length>0&&s.a.SessionManager.Preferences.BudgetDimension.length>0&&this.BudgetObj.AutoLoadBudgetDimension(e,null))}if(S.Tables.length>0&&S.Tables[0].length>0&&!S.Columns[0].Contains("ErrorMessage")&&!o.e.IsEmpty(S.Tables[0][0].CrAccount)&&parseInt(S.Tables[0][0].CrAccount)>0){var O=!1;if(this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")){if(o.e.String(e.CreditAccount_Key)!=S.Tables[0][0].CrAccount.toString()&&(O=!0),e.CreditAccount_Key=S.Tables[0][0].CrAccount.toString(),this.ScreenObject.GridDataColumns.Contains("CreditAccount"))e.CreditAccount=S.Tables[0][0].CrName.toString();else{var I=this.ScreenObject.ColumnSource.find((function(e){return null!=e.ValueMember&&"creditaccount_key"==e.ValueMember.toLowerCase()}));I&&(e[I.DisplayMember]=S.Tables[0][0].CrName.toString())}if(O){var T=this.ScreenObject.ColumnSource.find((function(e){return null!=e.ValueMember&&"creditaccount_key"==e.ValueMember.toLowerCase()}));this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&e.LocalReference==T.ID})).length>0&&this.ScreenObject.GetLinkReferenceData(parseInt(T.ID),this.DocumentID,parseInt(e[T.ValueMember]),Date.Today(),"",T.CostCenterID,e),s.a.SessionManager.Preferences.BudgetAccount.length>0&&s.a.SessionManager.Preferences.BudgetDimension.length>0&&this.BudgetObj.AutoLoadBudgetDimension(e,null)}}else null!=this.ScreenObject.CreditAccount&&(this.ScreenObject.CreditAccount.SelectedValue!=parseInt(S.Tables[0][0].CrAccount)&&(O=!0),this.ScreenObject.CreditAccount.SelectedValue=parseInt(S.Tables[0][0].CrAccount),s.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==s.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(this.ScreenObject.CreditAccount.Name.SelectedValueText=S.Tables[0][0].CrName.toString()),O&&s.a.SessionManager.Preferences.BudgetAccount.length>0&&s.a.SessionManager.Preferences.BudgetDimension.length>0&&this.BudgetObj.AutoLoadBudgetDimension(e,null))}if(S.Tables.length>0&&S.Tables[0].length>0&&!S.Columns[0].Contains("ErrorMessage")&&("8"==S.Tables[0][0].ProductTypeID.toString()||"3"==S.Tables[0][0].ProductTypeID.toString()||"11"==S.Tables[0][0].ProductTypeID.toString()||"12"==S.Tables[0][0].ProductTypeID.toString())){var j=this.ScreenObject.GridData.indexOf(e)+1;e.Type=S.Tables[0][0].ProductTypeID.toString(),this.ScreenObject.GridDataColumns.Contains("BinWise")&&S.Columns[0].Contains("BinWise")&&(e.BinWise=S.Tables[0][0].BinWise),this.ScreenObject.GridDataColumns.Contains("QtyType")&&S.Columns[0].Contains("QtyAdjustType")&&(e.QtyType=S.Tables[0][0].QtyAdjustType),this.ScreenObject.GridDataColumns.Contains("PackType")&&S.Columns[0].Contains("IsPacking")&&(e.PackType=S.Tables[0][0].IsPacking),this.ScreenObject.GridDataColumns.Contains("IsTestCase")&&S.Columns[0].Contains("TestCaseExists")&&(e.IsTestCase=S.Tables[0][0].TestCaseExists),this.ScreenObject.GridDataColumns.Contains("landingType")&&S.Columns[0].Contains("IsBillOfEntry")&&(e.landingType=S.Tables[0][0].IsBillOfEntry),S.Tables.length>3&&S.Tables[3].length>0?1==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||10==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||31==this.ScreenObject.DocumentType?null!=S.Tables[3][0].PurchaseRate&&(e.Rate=S.Tables[3][0].PurchaseRate):null!=S.Tables[3][0].SellingRate&&(e.Rate=S.Tables[3][0].SellingRate):S.Tables.length>0&&S.Tables[0].length>0&&(1==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||10==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||31==this.ScreenObject.DocumentType?o.e.IsEmpty(S.Tables[0][0].PurchaseRate)||(e.Rate=S.Tables[0][0].PurchaseRate):o.e.IsEmpty(S.Tables[0][0].SellingRate)||(e.Rate=S.Tables[0][0].SellingRate));var P=this.ScreenObject.ColumnSource.find((function(e){return"Quantity"==e.DisplayMember}));if(e.Quantity=P&&""!=P.DefaultValue&&o.e.IsNum(P.DefaultValue)?P.DefaultValue:1,0==s.a.page.DialogCount&&j>0){if(this.res="No",S.Tables.length>0&&S.Columns[0].Contains("uomid")&&!o.e.IsEmpty(S.Tables[0][0].uomid)&&(e.Unit=S.Tables[0][0].UnitName.toString(),e.Unit_Key=S.Tables[0][0].uomid.toString()),this.ScreenObject.Preferences.ContainsKey("IgnoreKitPopup")&&"True"==this.ScreenObject.Preferences.IgnoreKitPopup&&"3"==S.Tables[0][0].ProductTypeID.toString()?new ce(this,e,S).OnButtonClick("AutoSave"):s.a.page.ShowDialog(new ce(this,e,S),Ne.a),"Yes"==this.res)return;if("No"==this.res&&""==e.ProductID_Key)return}}else if(!n){if((!this.ScreenObject.Preferences.ContainsKey("Dontresetvaluesonproductchange")||""==this.ScreenObject.Preferences.Dontresetvaluesonproductchange||!Object(l.j)(this.ScreenObject.Preferences.Dontresetvaluesonproductchange)||o.e.IsEmpty(e.Quantity))&&!(!o.e.IsEmpty(e.LinkedInvDocDetailsID)&&parseInt(e.LinkedInvDocDetailsID)>0&&this.ScreenObject.Preferences.ContainsKey("SnoBasedLinking")&&""!=this.ScreenObject.Preferences.SnoBasedLinking&&Object(l.j)(this.ScreenObject.Preferences.SnoBasedLinking)))if(o.e.IsEmpty(c)||"0"!=this.IsSales)if(this.ScreenObject.Preferences.ContainsKey("EnableWieghingPopupOnQty")&&""!=this.ScreenObject.Preferences.EnableWieghingPopupOnQty&&Object(l.j)(this.ScreenObject.Preferences.EnableWieghingPopupOnQty)&&"true"==e.IsWeightable.toString().toLowerCase()){var A=this.QtyReader("0");"0"==this.IsSales?(e.Quantity=o.e.IsEmpty(A)?0:-parseFloat(A),this.RowForegroundChange(e)):e.Quantity=o.e.IsEmpty(A)?0:parseFloat(A)}else{var M=this.ScreenObject.ColumnSource.find((function(e){return"Quantity"==e.DisplayMember})),v=0;M&&""!=M.DefaultValue&&o.e.IsNum(M.DefaultValue)?(v=o.e.Double(M.DefaultValue),"0"==this.IsSales?(e.Quantity=-v,this.RowForegroundChange(e)):e.Quantity=v):"0"==this.IsSales?(e.Quantity=-1,this.RowForegroundChange(e)):e.Quantity=1}else e.Quantity=-1,this.RowForegroundChange(e);o.e.IsEmpty(e.Rate)||(e.Rate=0,e.defaultRate=0)}if(!o.e.IsEmpty(e.Quantity)&&this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&parseInt(e.ProductID_Key)!=this.ScreenObject.TempProductID&&this.ScreenObject.Preferences.ContainsKey("DuplicateProduct_IncrementQuantity")&&""!=this.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity&&Object(l.j)(this.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity)&&(this.ScreenObject.ColumnSource.find((function(e){return"quantity"==e.DisplayMember.toLowerCase()})).ReadOnly||n)&&(S.Tables.length>0&&S.Columns[0].Contains("uomid")&&!o.e.IsEmpty(S.Tables[0][0].uomid)&&(e.Unit=S.Tables[0][0].UnitName.toString(),e.Unit_Key=S.Tables[0][0].uomid.toString()),e.Type=S.Tables[0][0].ProductTypeID.toString(),this.AddProductQty(e,!n)))return o.e.IsEmpty(e.Quantity)||o.e.IsEmpty(e.UOMConversion)||!o.e.IsNum(e.UOMConversion)?o.e.IsEmpty(e.Quantity)||(e.UOMConvertedQty=e.Quantity.toString()):e.UOMConvertedQty=o.e.Double(e.UOMConversion)*parseFloat(e.Quantity),void this.ScreenObject.GridDataObj.updateRow(e);if(S.Tables.length>0&&S.Tables[0].length>0&&!S.Columns[0].Contains("ErrorMessage")){if(e.Type=S.Tables[0][0].ProductTypeID.toString(),this.ScreenObject.GridDataColumns.Contains("QtyType")&&S.Columns[0].Contains("QtyAdjustType")&&(e.QtyType=S.Tables[0][0].QtyAdjustType),this.ScreenObject.GridDataColumns.Contains("PackType")&&S.Columns[0].Contains("IsPacking")&&(e.PackType=S.Tables[0][0].IsPacking),this.ScreenObject.GridDataColumns.Contains("IsTestCase")&&S.Columns[0].Contains("TestCaseExists")&&(e.IsTestCase=S.Tables[0][0].TestCaseExists),this.ScreenObject.GridDataColumns.Contains("landingType")&&S.Columns[0].Contains("IsBillOfEntry")&&(e.landingType=S.Tables[0][0].IsBillOfEntry),this.ScreenObject.GridDataColumns.Contains("BinWise")&&S.Columns[0].Contains("BinWise")&&(e.BinWise=S.Tables[0][0].BinWise),e.UOMConversion=S.Tables[0][0].Conversion,S.Columns[0].Contains("FileGUID")&&(e.FileGUID=o.e.String(S.Tables[0][0].FileGUID),e.FileExtension=o.e.String(S.Tables[0][0].FileExtension)),S.Columns[0].Contains("Barcode_Key")&&!o.e.IsEmpty(S.Tables[0][0].Barcode_Key)&&this.ScreenObject.Preferences.ContainsKey("BarcodeDimension")&&""!=this.ScreenObject.Preferences.BarcodeDimension&&parseInt(this.ScreenObject.Preferences.BarcodeDimension)>0){var G=this.ScreenObject.ColumnSource.find((function(e){return e.CostCenterID==parseInt(a.ScreenObject.Preferences.BarcodeDimension)}));G&&(e[G.ValueMember]=S.Tables[0][0].Barcode_Key,e[G.DisplayMember]=S.Tables[0][0].UnitProductCode,this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&e.LocalReference==G.ID})).length>0&&this.ScreenObject.GetLinkReferenceData(parseInt(G.ID),this.DocumentID,parseInt(e[G.ValueMember]),Date.Today(),"",G.CostCenterID,e))}e.LASTPURCHASERATE=S.Columns[0].Contains("LastPurchaseRate")&&!o.e.IsEmpty(S.Tables[0][0].LastPurchaseRate)?S.Tables[0][0].LastPurchaseRate:0,o.e.IsEmpty(e.Quantity)||o.e.IsEmpty(S.Tables[0][0].Conversion)||!o.e.IsNum(S.Tables[0][0].Conversion)?o.e.IsEmpty(e.Quantity)||(e.UOMConvertedQty=e.Quantity):e.UOMConvertedQty=o.e.Double(S.Tables[0][0].Conversion)*parseFloat(e.Quantity),S.Tables.length>0&&S.Columns[0].Contains("uomid")&&!o.e.IsEmpty(S.Tables[0][0].uomid)&&(e.Unit=S.Tables[0][0].UnitName,e.Unit_Key=S.Tables[0][0].uomid)}var N=null;if(null!=e.Type&&"8"!=o.e.String(e.Type)&&"3"!=o.e.String(e.Type)){var E=this.ScreenObject.ColumnSource.find((function(e){return"Rate"==e.DisplayMember})),w="";if(!o.e.IsEmpty(E.Formula)&&S.Columns[3].Contains(E.Formula)&&(w=E.Formula),S.Tables.length>3&&S.Tables[3].length>0){w=1==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||10==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||31==this.ScreenObject.DocumentType?"PurchaseRate":"SellingRate",N=S.Tables[3][0];var F=this.ScreenObject.GridData.indexOf(e)+1;S.Tables[3].length>1&&F>0&&(null==E.Formula||E.Formula.toLowerCase().Contains("avgrate")),o.e.IsEmpty(w)||o.e.IsEmpty(N[w])||(e.Rate=N[w],e.defaultRate=N[w])}else o.e.IsEmpty(r)?S.Tables.length>0&&S.Tables[0].length>0&&!S.Columns[0].Contains("ErrorMessage")&&(1==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||10==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||31==this.ScreenObject.DocumentType?o.e.IsEmpty(S.Tables[0][0].PurchaseRate)?e.Rate=0:(e.Rate=S.Tables[0][0].PurchaseRate,e.defaultRate=S.Tables[0][0].PurchaseRate):o.e.IsEmpty(S.Tables[0][0].SellingRate)||(e.Rate=S.Tables[0][0].SellingRate,e.defaultRate=S.Tables[0][0].SellingRate)):e.Rate=r}if(null!=S&&S.Tables.length>0&&S.Tables[0].length>0&&!S.Columns[0].Contains("ErrorMessage")&&this.FillLinkRefereceProducts(e,S.Tables[0],N),S.Tables.length>10&&S.Columns[10].Contains("BinId")&&S.Tables[10].length>0&&0!=S.Tables[10][0].BinId&&this.ScreenObject.Preferences.ContainsKey("BinsDimension")&&parseInt(this.ScreenObject.Preferences.BinsDimension)>5e4){var V=this.ScreenObject.ColumnSource.find((function(e){return e.CostCenterID==parseInt(a.ScreenObject.Preferences.BinsDimension)}));V&&this.ScreenObject.GridDataColumns.Contains(V.DisplayMember)&&(e[V.DisplayMember]=S.Tables[10][0].BinName.toString(),e[V.ValueMember]=S.Tables[10][0].BinId.toString())}if(this.ScreenObject.ColumnSource.filter((function(e){return e.DisplayMember.Contains("dcNum")&&4!=e.SectionID})).forEach((function(t){if(!(t.linkData>0)&&("8"!=o.e.String(e.Type)&&"3"!=o.e.String(e.Type)&&(a.ScreenObject.Preferences.ContainsKey("Dontresetvaluesonproductchange")&&""!=a.ScreenObject.Preferences.Dontresetvaluesonproductchange&&Object(l.j)(a.ScreenObject.Preferences.Dontresetvaluesonproductchange)&&!o.e.IsEmpty(e.Quantity)||t.IsRepeat||(e[t.DisplayMember]=0,e["default"+t.DisplayMember]=0,e["dcCalc"+t.DisplayMember]=0)),S.Tables.length>4)){var n=S.Tables[4].filter((function(e){return e.SysColumnName==t.DisplayMember}));n.length>0&&(e[t.DisplayMember]=n[0].Value.toString(),e["default"+t.DisplayMember]=n[0].Value.toString())}})),null!=S&&S.Tables.length>7&&S.Tables[7].length>0&&!S.Columns[7].Contains("ErrorMessage")&&this.ScreenObject.Preferences.ContainsKey("Enable Linked Products")&&""!=this.ScreenObject.Preferences["Enable Linked Products"]&&Object(l.j)(this.ScreenObject.Preferences["Enable Linked Products"])&&!t){var L=this.ScreenObject.GridData.indexOf(e)+1;L>0&&this.AddLinkProducts(S.Tables[7],L)}var R=!1,B=this.ScreenObject.ColumnSource.filter((function(e){return null!=e.ValueMember&&"productid_key"==e.ValueMember.toString().toLowerCase()}));B.forEach((function(t){a.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&e.LocalReference==t.ID})).length>0&&""!=t.ValueMember&&null!=e[t.ValueMember]&&!o.e.IsEmpty(e[t.ValueMember])&&(R=!0,a.ScreenObject.GetLinkReferenceData(parseInt(t.ID),a.DocumentID,parseInt(e[t.ValueMember]),Date.Today(),"",t.CostCenterID,e,null,!1))}));var x=this.ScreenObject.Data.Tables[0].filter((function(e){return 79==e.LocalReference&&(26585==e.LinkData||54306==e.LinkData||54307==e.LinkData||53529==e.LinkData||53589==e.LinkData||53530==e.LinkData)}));if(!R&&x.length>0&&B.length>0){var k=B[0];this.ScreenObject.GetLinkReferenceData(parseInt(k.ID),this.DocumentID,parseInt(e[k.ValueMember]),Date.Today(),"",k.CostCenterID,e,null,!1)}this.ScreenObject.Preferences.ContainsKey("BUDGET_BudgetAccountField")&&!o.e.IsEmpty(this.ScreenObject.Preferences.BUDGET_BudgetAccountField)&&this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.Preferences.BUDGET_BudgetAccountField+"_Key")&&!o.e.IsEmpty(e[this.ScreenObject.Preferences.BUDGET_BudgetAccountField+"_Key"])&&this.BudgetObj.AutoLoadBudgetDimension(e,null),null!=S&&S.Tables.length>0&&S.Tables[0].length>0&&!S.Columns[0].Contains("ErrorMessage")&&this.FillSalesPurchase(e,S.Tables[0],N),this.ScreenObject.Preferences.ContainsKey("DimWiseCurrency")&&"true"==this.ScreenObject.Preferences.DimWiseCurrency.toLowerCase()&&this.ScreenObject.Preferences.ContainsKey("CurrencyDim")&&"3"==this.ScreenObject.Preferences.CurrencyDim&&null!=S&&S.Tables.length>12&&S.Columns[12].Contains("Name")&&S.Tables[12].length>0&&(this.ScreenObject.GridDataColumns.Contains("CurrencyID")?(e.CurrencyID_Key=S.Tables[12][0].CurrencyID.toString(),e.CurrencyID=S.Tables[12][0].Name.toString(),this.ScreenObject.GridDataColumns.Contains("ExchangeRate")&&S.Tables.length>13&&S.Columns[13].Contains("Rate")&&S.Tables[13].length>0&&(e.ExchangeRate=S.Tables[13][0].Rate.toString())):this.Currency&&null!=this.Currency.Currency.SelectedValue&&""!=this.Currency.Currency.SelectedValue&&(this.Currency.Currency.SelectedValue=S.Tables[12][0].CurrencyID.toString(),S.Tables.length>13&&S.Columns[13].Contains("Rate")&&S.Tables[13].length>0&&(this.Currency.ExchangeRate.Text=S.Tables[13][0].Rate.toString())))}}else{if(this.RepeatRowData(e),this.ScreenObject.Preferences.ContainsKey("IgnoreKitPopup")&&"True"==this.ScreenObject.Preferences.IgnoreKitPopup&&"3"==o.e.String(e.Type))return;if(!o.e.IsEmpty(e.Type)&&("8"==e.Type.toString()||"3"==e.Type.toString()||"11"==e.Type.toString()||"12"==e.Type.toString()))if("11"==e.Type.toString()||"12"==e.Type.toString()){var _=this.GetProductValues(e,0,!1,c);s.a.page.ShowDialog(new ce(this,e,_),Ne.a)}else s.a.page.ShowDialog(new ce(this,e,null),Ne.a)}}},{key:"RowForegroundChange",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.ScreenObject.GridDataColumns.Contains("Row_Foreground")||this.ScreenObject.GridDataColumns.push("Row_Foreground"),e.Row_Foreground=t?null:"#D30609",this.ScreenObject.GridDataObj.refreshDataView()}},{key:"ValidateSchemes",value:function(){for(var e=this,t=function(t){if(!o.e.IsEmpty(e.ScreenObject.GridData[t].ProductID_Key)&&!o.e.IsEmpty(e.ScreenObject.GridData[t].SchemeID)&&parseInt(e.ScreenObject.GridData[t].ProductID_Key)>0&&parseInt(e.ScreenObject.GridData[t].SchemeID)>0&&"N"==e.ScreenObject.GridData[t].IsScheme.toString()){var n=e.ScreenObject.GetSchemes(e.DocumentDate,e.ScreenObject.GridData[t]);if(n.Tables.length>0&&n.Columns[0].Contains("SchemeID")){var a=n.Tables[0].filter((function(n){return n.SchemeID==e.ScreenObject.GridData[t].SchemeID}));if(a.length>0){if(!o.e.IsEmpty(a[0].FromQty)&&!o.e.IsEmpty(e.ScreenObject.GridData[t].Quantity)&&!o.e.IsEmpty(a[0].ToQty)&&parseFloat(a[0].ToQty)!=parseFloat(a[0].FromQty)&&parseFloat(e.ScreenObject.GridData[t].Quantity)>=parseFloat(a[0].FromQty))return"continue";if(!o.e.IsEmpty(a[0].FromQty)&&!o.e.IsEmpty(e.ScreenObject.GridData[t].Quantity)&&!o.e.IsEmpty(a[0].ToQty)&&parseFloat(a[0].ToQty)==parseFloat(a[0].FromQty)&&parseFloat(e.ScreenObject.GridData[t].Quantity)>=parseFloat(a[0].FromQty))return"continue"}e.fillSchemevalues(n.Tables[0],n.Columns[0],e.ScreenObject.GridData[t]),e.ApplySchemes(e.ScreenObject.GridData[t])}}},n=0;n<this.ScreenObject.GridData.length;n++)t(n);return!0}},{key:"fillSchemevalues",value:function(e,t,n){null!=this.DtTempSchemes?this.DtTempSchemes.Clear():(this.DtTempSchemes=[],this.DtTempSchemesColumns=[],this.DtTempSchemesColumns.push("SchemeProductID"),this.DtTempSchemesColumns.push("SchemeID"),this.DtTempSchemesColumns.push("ProfileName"),this.DtTempSchemesColumns.push("FromQty"),this.DtTempSchemesColumns.push("ToQty"),this.DtTempSchemesColumns.push("FromValue"),this.DtTempSchemesColumns.push("ToValue"),this.DtTempSchemesColumns.push("ProductID"),this.DtTempSchemesColumns.push("Quantity"),this.DtTempSchemesColumns.push("Value"),this.DtTempSchemesColumns.push("Percentage"),this.DtTempSchemesColumns.push("freeProductID"),this.DtTempSchemesColumns.push("ProductName"),this.DtTempSchemesColumns.push("ProductCode"),this.DtTempSchemesColumns.push("freeQuantity"),this.DtTempSchemesColumns.push("freeValue"),this.DtTempSchemesColumns.push("freePercentage"),this.DtTempSchemesColumns.push("ProductTypeID"),this.DtTempSchemesColumns.push("IsQtyPercent"),this.DtTempSchemesColumns.push("FreeQtyPercent"),this.DtTempSchemesColumns.push("FromDate"),this.DtTempSchemesColumns.push("ToDate"),null!=e&&t.Contains("Dim1")&&(this.DtTempSchemesColumns.push("Dim1"),this.DtTempSchemesColumns.push("Name")));for(var a=0;a<e.length;a++){var i={};i.SchemeProductID=e[a].SchemeProductID.toString(),i.SchemeID=e[a].SchemeID.toString(),i.FromQty=e[a].FromQty.toString(),i.ToQty=e[a].ToQty.toString(),i.ProfileName=e[a].ProfileName.toString(),i.FromValue=e[a].FromValue.toString(),i.ToValue=e[a].ToValue.toString(),i.ProductID=e[a].ProductID.toString(),i.Quantity=e[a].Quantity.toString(),i.Value=e[a].Value.toString(),i.Percentage=e[a].Percentage.toString(),i.IsQtyPercent=e[a].IsQtyPercent.toString(),i.FromDate=e[a].FromDate.toString(),i.ToDate=e[a].ToDate.toString(),o.e.IsEmpty(e[a].freeProductID)||(i.FreeQtyPercent=e[a].FreeQtyPercent.toString(),i.freeProductID=e[a].freeProductID.toString(),i.ProductName=e[a].ProductName.toString(),i.ProductCode=e[a].ProductCode.toString(),i.freeQuantity=e[a].freeQuantity.toString(),i.freeValue=e[a].freeValue.toString(),i.freePercentage=e[a].freePercentage.toString(),i.ProductTypeID=e[a].ProductTypeID.toString(),t.Contains("Dim1")&&this.DtTempSchemesColumns.Contains("Dim1")&&(i.Dim1=e[a].Dim1.toString(),i.Name=e[a].Name.toString())),this.DtTempSchemes.push(i)}}},{key:"FillRowValues",value:function(e,t,n){var a={};if(a.SchemeProductID=t.SchemeProductID.toString(),a.SchemeID=t.SchemeID.toString(),a.FromQty=t.FromQty.toString(),a.ToQty=t.ToQty.toString(),a.ProfileName=t.ProfileName.toString(),a.FromValue=t.FromValue.toString(),a.ToValue=t.ToValue.toString(),a.ProductID=t.ProductID.toString(),a.Quantity=t.Quantity.toString(),a.Value=t.Value.toString(),a.Percentage=t.Percentage.toString(),a.IsQtyPercent=t.IsQtyPercent.toString(),a.ToDate=t.ToDate.toString(),a.FromDate=t.FromDate.toString(),!o.e.IsEmpty(t.freeProductID)){a.FreeQtyPercent=t.FreeQtyPercent.toString(),a.freeProductID=t.freeProductID.toString(),a.ProductName=t.ProductName.toString(),a.ProductCode=t.ProductCode.toString(),a.freeQuantity=t.freeQuantity.toString(),a.freeValue=t.freeValue.toString(),a.freePercentage=t.freePercentage.toString(),a.ProductTypeID=t.ProductTypeID.toString(),a.FreeProductName=t.ProductName.toString();var i=e.filter((function(e){return e.SchemeID==t.SchemeID.toString()&&(null==e.StyleHeightZero||1!=e.StyleHeightZero)}));i.length>0&&(i[0].FreeProductName=i[0].FreeProductName.toString()+","+t.ProductName.toString(),a.StyleHeightZero="1"),n.Contains("Dim1")&&(a.Dim1=t.Dim1.toString(),a.Name=t.Name.toString())}e.push(a)}},{key:"ApplySchemes",value:function(e){var t=this,n=!1;if(this.ScreenObject.Preferences.ContainsKey("EnableSchemes")&&Object(l.j)(this.ScreenObject.Preferences.EnableSchemes)&&(n=Object(l.j)(this.ScreenObject.Preferences.EnableSchemes)),n){var a=!1,i=[],r=[],c=[];c.push("SchemeProductID"),c.push("SchemeID"),c.push("FromQty"),c.push("ToQty"),c.push("FromValue"),c.push("ToValue"),c.push("ProductID"),c.push("Quantity"),c.push("Value"),c.push("Percentage"),c.push("freeProductID"),c.push("ProductName"),c.push("FreeProductName"),c.push("StyleHeightZero"),c.push("ProductCode"),c.push("freeQuantity"),c.push("freeValue"),c.push("ProfileName"),c.push("freePercentage"),c.push("ProductTypeID"),c.push("IsQtyPercent"),c.push("FreeQtyPercent"),c.push("ToDate"),c.push("FromDate"),null!=this.DtTempSchemes&&this.DtTempSchemesColumns.Contains("Dim1")&&(c.push("Dim1"),c.push("Name"));var u="GROSS";if(this.ScreenObject.Preferences.ContainsKey("SchemesNumericFields")&&""!=this.ScreenObject.Preferences.SchemesNumericFields&&"0"!=this.ScreenObject.Preferences.SchemesNumericFields){var d=this.ScreenObject.ColumnSource.find((function(e){return e.ID==t.ScreenObject.Preferences.SchemesNumericFields}));d&&""!=d.DisplayMember&&(u=d.DisplayMember)}if(!o.e.IsEmpty(e.ProductID_Key)&&null!=this.DtTempSchemes){var D=this.DtTempSchemes.filter((function(t){return t.ProductID==e.ProductID_Key}));if(D.sort((function(e,t){return e.FromQty<t.FromQty||e.FromQty==t.FromQty&&e.FromValue<t.FromValue?1:-1})),D.length>0){var h=0,S=0,m=s.a.SessionManager.Preferences.LoyaltyBasedOn.toString().split(",");if(this.ScreenObject.Preferences.ContainsKey("PriceScheme")&&Object(l.j)(this.ScreenObject.Preferences.PriceScheme))o.e.IsEmpty(e.Quantity)||(h=parseFloat(e.Quantity)),o.e.IsEmpty(e[u])||(S=parseFloat(e[u]));else{var b=(i=this.ScreenObject.GridData.filter((function(t){return t.ProductID_Key==e.ProductID_Key&&(Object(j.isNullOrUndefined)(t.IsScheme)||"Y"!=t.IsScheme)}))).Compute("sum","Quantity");null!=b&&o.e.IsNum(b)&&(h=parseFloat(b)),null!=(b=i.Compute("sum",u))&&o.e.IsNum(b)&&(S=parseFloat(b))}for(var C=function(n){var a=D[n];if(m.length>1&&(!t.ScreenObject.Preferences.ContainsKey("PriceScheme")||!Object(l.j)(t.ScreenObject.Preferences.PriceScheme))){i=t.ScreenObject.GridData.filter((function(e){return Object(j.isNullOrUndefined)(e.IsScheme)||"Y"!=e.IsScheme})),m.Contains("-1")&&(i=i.filter((function(e){return e.SchemeProductID==a.SchemeProductID}))),m.forEach((function(n){var a=t.ScreenObject.ColumnSource.find((function(e){return e.CostCenterID.toString()==n}));a&&!o.e.IsEmpty(e[a.ValueMember])&&(i=i.filter((function(t){return t[a.ValueMember]==e[a.ValueMember]})))}));var s=i.Compute("sum","Quantity");null!=s&&o.e.IsNum(s)&&(h=parseFloat(s)),null!=(s=i.Compute("sum",u))&&o.e.IsNum(s)&&(S=parseFloat(s))}(!o.e.IsEmpty(a.FromQty)&&!o.e.IsEmpty(a.ToQty)&&parseFloat(a.FromQty)>0&&parseFloat(a.ToQty)!=parseFloat(a.FromQty)&&h>=parseFloat(a.FromQty)&&(0==parseFloat(a.ToQty)||h<=parseFloat(a.ToQty))||!o.e.IsEmpty(a.FromQty)&&!o.e.IsEmpty(a.ToQty)&&parseFloat(a.FromQty)>0&&parseFloat(a.ToQty)==parseFloat(a.FromQty)&&h>=parseFloat(a.FromQty)||!o.e.IsEmpty(a.FromValue)&&!o.e.IsEmpty(a.ToValue)&&parseFloat(a.FromValue)>0&&parseFloat(a.ToValue)!=parseFloat(a.FromValue)&&S>=parseFloat(a.FromValue)&&(0==parseFloat(a.ToValue)||S<=parseFloat(a.ToValue))||!o.e.IsEmpty(a.FromValue)&&!o.e.IsEmpty(a.ToValue)&&parseFloat(a.FromValue)>0&&parseFloat(a.ToValue)==parseFloat(a.FromValue)&&S>=parseFloat(a.FromValue))&&t.FillRowValues(r,a,c)},y=0;y<D.length;y++)C(y);1==r.length?(a=!0,this.FillSchemeRows(e,r[0],u),m.Contains("-1")&&(e.SchemeProductID=r[0].SchemeProductID.toString()),!o.e.IsEmpty(r[0].Percentage)&&parseFloat(r[0].Percentage)>0&&!o.e.IsEmpty(r[0].IsQtyPercent)&&2==parseInt(r[0].IsQtyPercent)?this.CalculateTotals(e,!1):this.CalculateTotals(null,!1)):r.length>1||0==r.length&&m.Contains("-1")&&D.length>0&&(e.SchemeProductID=D[0].SchemeProductID.toString())}}if(!a){var p="";if(i.length>0){var g=i.filter((function(e){return-1==e.SchemeID}));if(this.ScreenObject.Preferences.ContainsKey("SchemesValueField")&&""!=this.ScreenObject.Preferences.SchemesValueField&&"0"!=this.ScreenObject.Preferences.SchemesValueField){var f=this.ScreenObject.ColumnSource.find((function(e){return e.ID==t.ScreenObject.Preferences.SchemesValueField}));f&&""!=f.DisplayMember&&g.forEach((function(e){e[f.DisplayMember]="0",t.CalculateTotals(e,!1)}))}}else if("-1"==o.e.String(e.SchemeID)&&this.ScreenObject.Preferences.ContainsKey("SchemesValueField")&&""!=this.ScreenObject.Preferences.SchemesValueField&&"0"!=this.ScreenObject.Preferences.SchemesValueField){var O=this.ScreenObject.ColumnSource.find((function(e){return e.ID==t.ScreenObject.Preferences.SchemesValueField}));O&&""!=O.DisplayMember&&(e[O.DisplayMember]="0",this.CalculateTotals(e,!1))}var I=[];if(o.e.IsEmpty(e.ProductID_Key)){if(o.e.IsEmpty(e.MaxSchemeID))return;I=this.ScreenObject.GridData.filter((function(t){return t.MaxSchemeID==e.MaxSchemeID&&(Object(j.isNullOrUndefined)(t.IsScheme)||"Y"!=t.IsScheme)}))}else I=this.ScreenObject.GridData.filter((function(t){return t.ProductID_Key==e.ProductID_Key&&(Object(j.isNullOrUndefined)(t.IsScheme)||"Y"!=t.IsScheme)}));I.forEach((function(e){!o.e.IsEmpty(e.MaxSchemeID)&&parseInt(e.MaxSchemeID)>0&&(p+=e.MaxSchemeID.toString()+",",e.IsScheme=null,e.MaxSchemeID=null,e.SchemeID=null)})),p.length>1&&(p=p.Remove(p.length-1,1),this.ScreenObject.GridData.filter((function(e){return p.split(",").Contains(e.MaxSchemeID)&&"Y"==e.IsScheme})).forEach((function(e){t.ScreenObject.GridDataObj.removeRow(e)})))}}}},{key:"Copyparentrow",value:function(e,t){for(var n=0;n<this.ScreenObject.GridDataColumns.length;n++)this.ScreenObject.GridDataColumns[n].toLowerCase().Contains("ccnid")&&this.ScreenObject.GridDataColumns[n].toLowerCase().Contains("alpha")&&(e[n]=t[n])}},{key:"FillSchemeRows",value:function(e,t,n){var a=this,i=0;s.a.SessionManager.Preferences.ContainsKey("SchemeFreeProdDim")&&(i=o.e.Int(s.a.SessionManager.Preferences.SchemeFreeProdDim));var r=n;if(this.ScreenObject.Preferences.ContainsKey("SchemesValueField")&&""!=this.ScreenObject.Preferences.SchemesValueField&&"0"!=this.ScreenObject.Preferences.SchemesValueField){var c=this.ScreenObject.ColumnSource.find((function(e){return e.ID==a.ScreenObject.Preferences.SchemesValueField}));c&&""!=c.DisplayMember&&(r=c.DisplayMember)}var u=0,d=0,D=s.a.SessionManager.Preferences.LoyaltyBasedOn.toString().split(","),h=null;if(this.ScreenObject.Preferences.ContainsKey("PriceScheme")&&Object(l.j)(this.ScreenObject.Preferences.PriceScheme))o.e.IsEmpty(e.Quantity)||(u=parseFloat(e.Quantity)),o.e.IsEmpty(e[n])||(d=parseFloat(e[n])),h=[];else{var S;D.length>1?(S=D.Contains("-1")?this.ScreenObject.GridData.filter((function(e){return(Object(j.isNullOrUndefined)(e.IsScheme)||"Y"!=e.IsScheme)&&e.SchemeProductID==t.SchemeProductID})):this.ScreenObject.GridData.filter((function(e){return Object(j.isNullOrUndefined)(e.IsScheme)||"Y"!=e.IsScheme})),D.forEach((function(t){var n=a.ScreenObject.ColumnSource.find((function(e){return e.CostCenterID.toString()==t}));n&&!o.e.IsEmpty(e[n.ValueMember])&&(S=S.filter((function(t){return t[n.ValueMember]==e[n.ValueMember]})))}))):S=this.ScreenObject.GridData.filter((function(t){return t.ProductID_Key==e.ProductID_Key&&(Object(j.isNullOrUndefined)(t.IsScheme)||"Y"!=t.IsScheme)}));var m=S.Compute("sum","Quantity");null!=m&&(u=o.e.Double(m)),null!=(m=S.Compute("sum",n))&&(d=o.e.Double(m)),h=S}var b=!1,C="",y=0;if(h.forEach((function(e){!o.e.IsEmpty(e.MaxSchemeID)&&parseInt(e.MaxSchemeID)>0&&(C+=e.MaxSchemeID.toString()+",")})),C.length>1&&(C=C.Remove(C.length-1,1)),parseFloat(t.FromQty)>0){if(parseFloat(t.ToQty)!=parseFloat(t.FromQty))if(!o.e.IsEmpty(t.freeProductID)&&parseInt(t.freeProductID)>0){var p=this.ScreenObject.GridData.Compute("max","MaxSchemeID");null!=p&&(y=o.e.Int(p)),y++;var g=null,f=this.DtTempSchemes.filter((function(e){return e.SchemeID==t.SchemeID})),O=null;""!=C&&(O=this.ScreenObject.GridData.filter((function(e){return C.split(",").Contains(e.MaxSchemeID)&&"Y"==e.IsScheme})));for(var I=0;I<f.length;I++){if(b=!1,""!=C&&null!=O&&O.length>I?(g=O[I],y=parseInt(C.split(",")[0])):((g=this.ScreenObject.GridDataObj.NewRow()).IsScheme="Y",e.IsScheme="N",g.MaxSchemeID=y,e.MaxSchemeID=y,this.ScreenObject.GridDataObj.insertRowAt(g,this.ScreenObject.GridData.indexOf(e)+1),this.ScreenObject.UpdateSequence()),this.ScreenObject.Preferences.ContainsKey("schemecopydata")&&Object(l.j)(this.ScreenObject.Preferences.schemecopydata)&&this.Copyparentrow(g,e),g.ProductID_Key.toString()!=f[I].freeProductID.toString()&&(b=!0),g.ProductID_Key=f[I].freeProductID.toString(),this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(g.ProductCode=f[I].ProductCode.toString()),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(g.ProductName=f[I].ProductName.toString()),o.e.IsEmpty(f[I].freeQuantity)||(g.FreeQTY=parseFloat(f[I].freeQuantity)),i>5e4&&this.DtTempSchemesColumns.Contains("Dim1")&&!o.e.IsEmpty(f[I].Dim1)&&this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(i-5e4))&&(g["dcCCNID"+(i-5e4)]=f[I].Name.toString(),g["dcCCNID"+(i-5e4)+"_Key"]=f[I].Dim1.toString()),this.FillDatarowNN(g,null,t,{LocalReference:79,LinkData:53734},"ProfileName"),this.FillDatarowNN(g,null,t,{LocalReference:79,LinkData:55480},"FromDate"),this.FillDatarowNN(g,null,t,{LocalReference:79,LinkData:55483},"ToDate"),this.FillDatarowNN(g,null,t,{LocalReference:79,LinkData:55850},"FromQty"),this.FillDatarowNN(g,null,t,{LocalReference:79,LinkData:55851},"ToQty"),!o.e.IsEmpty(f[I].freeQuantity)&&parseFloat(f[I].freeQuantity)>0)g.FreeQTY=parseFloat(f[I].freeQuantity),g[r]=0;else if(!o.e.IsEmpty(t.freeValue)&&parseFloat(f[I].freeValue)>0)g[r]=-1*parseFloat(f[I].freeValue),g.FreeQTY=0;else if(!o.e.IsEmpty(f[I].freePercentage)&&parseFloat(f[I].freePercentage)>0)if(!o.e.IsEmpty(f[I].FreeQtyPercent)&&Object(l.j)(f[I].FreeQtyPercent)){var T=u/100*parseFloat(f[I].freePercentage);g.FreeQTY=T,g[r]=0}else if(!o.e.IsEmpty(e[n])){var P=d/100*parseFloat(f[I].freePercentage);g[r]=-1*P,g.FreeQTY=0}o.e.IsEmpty(f[I].ProductTypeID)||(g.Type=parseFloat(f[I].ProductTypeID)),b?this.FillProductValues(g):this.CalculateTotals(g,!1),g.SchemeID=f[I].SchemeID.toString(),!o.e.IsEmpty(g.FreeQTY)&&parseFloat(g.FreeQTY)>0&&(g.UOMConvertedQty=o.e.IsEmpty(g.UOMConversion)?g.FreeQTY.toString():parseFloat(g.FreeQTY)*parseFloat(g.UOMConversion))}if(null!=O)for(var A=f.length;A<O.length;A++)this.ScreenObject.GridDataObj.removeRow(O[A])}else{var M=null;if(""!=C&&this.ScreenObject.GridData.filter((function(e){return e.MaxSchemeID&&C.split(",").Contains(e.MaxSchemeID.toString())&&"Y"==e.IsScheme})).length>0){var v=this.ScreenObject.GridData.filter((function(e){return e.MaxSchemeID&&C.split(",").Contains(e.MaxSchemeID.toString())&&"Y"==e.IsScheme}));M=v[0],y=parseInt(v[0].MaxSchemeID);for(var G=1;G<v.length;G++)this.ScreenObject.GridDataObj.removeRow(v[G])}else if(o.e.IsEmpty(t.Percentage)||!(parseFloat(t.Percentage)>0)||o.e.IsEmpty(t.IsQtyPercent)||2!=parseInt(t.IsQtyPercent)){M=this.ScreenObject.GridDataObj.NewRow();var N=this.ScreenObject.GridData.Compute("max","MaxSchemeID");null!=N&&(y=o.e.Int(N)),y++,M.IsScheme="Y",e.IsScheme="N",M.MaxSchemeID=y,e.MaxSchemeID=y,this.ScreenObject.GridDataObj.insertRowAt(M,this.ScreenObject.GridData.indexOf(e)+1),this.ScreenObject.UpdateSequence()}if(this.ScreenObject.Preferences.ContainsKey("schemecopydata")&&Object(l.j)(this.ScreenObject.Preferences.schemecopydata)&&this.Copyparentrow(M,e),!o.e.IsEmpty(t.Percentage)&&parseFloat(t.Percentage)>0&&!o.e.IsEmpty(t.IsQtyPercent)&&2==parseInt(t.IsQtyPercent)||(M.ProductID_Key=e.ProductID_Key.toString(),this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(M.ProductCode=e.ProductCode.toString()),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(M.ProductName=e.ProductName.toString()),this.FillDatarowNN(M,null,t,{LocalReference:79,LinkData:53734},"ProfileName"),this.FillDatarowNN(M,null,t,{LocalReference:79,LinkData:55480},"FromDate"),this.FillDatarowNN(M,null,t,{LocalReference:79,LinkData:55483},"ToDate"),this.FillDatarowNN(M,null,t,{LocalReference:79,LinkData:55850},"FromQty"),this.FillDatarowNN(M,null,t,{LocalReference:79,LinkData:55851},"ToQty")),!o.e.IsEmpty(t.Quantity)&&parseFloat(t.Quantity)>0)M.FreeQTY=parseFloat(t.Quantity),M[r]=0;else if(!o.e.IsEmpty(t.Value)&&parseFloat(t.Value)>0)M[r]=-1*parseFloat(t.Value),M.FreeQTY=0;else if(!o.e.IsEmpty(t.Percentage)&&parseFloat(t.Percentage)>0)if(o.e.IsEmpty(t.IsQtyPercent)||2!=parseInt(t.IsQtyPercent))if(o.e.IsEmpty(t.IsQtyPercent)||1!=parseInt(t.IsQtyPercent)){if(!o.e.IsEmpty(e[n])){var E=d/100*parseFloat(t.Percentage);M[r]=-1*E,M.FreeQTY=0}}else{var w=u/100*parseFloat(t.Percentage);M.FreeQTY=w,M[r]=0}else e[r]=t.Percentage.toString(),e.SchemeID="-1",this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:53734},"ProfileName"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55480},"FromDate"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55483},"ToDate"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55850},"FromQty"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55851},"ToQty"),h.forEach((function(t){t!=e&&(t[r]=0)}));!o.e.IsEmpty(t.Percentage)&&parseFloat(t.Percentage)>0&&!o.e.IsEmpty(t.IsQtyPercent)&&2==parseInt(t.IsQtyPercent)||(M.Type=o.e.String(e.Type),M.SchemeID=t.SchemeID.toString(),b?this.FillProductValues(M):this.CalculateTotals(M,!1),!o.e.IsEmpty(M.FreeQTY)&&parseFloat(M.FreeQTY)>0&&(M.UOMConvertedQty=o.e.IsEmpty(M.UOMConversion)?M.FreeQTY.toString():parseFloat(M.FreeQTY)*parseFloat(M.UOMConversion)))}else if(parseFloat(t.ToQty)==parseFloat(t.FromQty)){var F=0;if(!o.e.IsEmpty(t.freeProductID)&&parseInt(t.freeProductID)>0){var V=this.ScreenObject.GridData.Compute("max","MaxSchemeID");null!=V&&(y=o.e.Int(V)),y++;var L=null,R=this.DtTempSchemes.filter((function(e){return e.SchemeID==t.SchemeID})),B=null;""!=C&&(B=this.ScreenObject.GridData.filter((function(e){return C.split(",").Contains(e.MaxSchemeID)&&"Y"==e.IsScheme})));for(var x=0;x<R.length;x++){if(b=!1,""!=C&&null!=B&&B.length>x?(L=B[x],y=parseInt(C.split(",")[0])):((L=this.ScreenObject.GridDataObj.NewRow()).IsScheme="Y",e.IsScheme="N",L.MaxSchemeID=y,e.MaxSchemeID=y,this.ScreenObject.GridDataObj.insertRowAt(L,this.ScreenObject.GridData.indexOf(e)+1),this.ScreenObject.UpdateSequence()),this.ScreenObject.Preferences.ContainsKey("schemecopydata")&&Object(l.j)(this.ScreenObject.Preferences.schemecopydata)&&this.Copyparentrow(L,e),L.ProductID_Key.toString()!=R[x].freeProductID.toString()&&(b=!0),L.ProductID_Key=R[x].freeProductID.toString(),this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(L.ProductCode=R[x].ProductCode.toString()),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(L.ProductName=R[x].ProductName.toString()),o.e.IsEmpty(R[x].ProductTypeID)||(L.Type=parseFloat(R[x].ProductTypeID)),!o.e.IsEmpty(R[x].freeQuantity)&&parseFloat(R[x].freeQuantity)>0){F=parseFloat(R[x].freeQuantity);var k=u/parseFloat(R[x].FromQty);L.FreeQTY=Math.floor(k)*F,L[r]=0}else if(!o.e.IsEmpty(t.freeValue)&&parseFloat(R[x].freeValue)>0){F=parseFloat(R[x].freeValue);var _=u/parseFloat(R[x].FromQty);L[r]=Math.floor(_)*F*-1,L.FreeQTY=0}else if(!o.e.IsEmpty(R[x].freePercentage)&&parseFloat(R[x].freePercentage)>0)if(!o.e.IsEmpty(R[x].FreeQtyPercent)&&Object(l.j)(R[x].FreeQtyPercent)){F=parseFloat(R[x].freePercentage);var K=u/parseFloat(R[x].FromQty);K=u/100*Math.floor(K),L.FreeQTY=K*F,L[r]=0}else if(!o.e.IsEmpty(e[n])){F=parseFloat(R[x].freePercentage);var Q=u/parseFloat(R[x].FromQty);Q=d/100*Math.floor(Q),L[r]=Q*F*-1,L.FreeQTY=0}i>5e4&&this.DtTempSchemesColumns.Contains("Dim1")&&!o.e.IsEmpty(R[x].Dim1)&&this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(i-5e4))&&(L["dcCCNID"+(i-5e4)]=R[x].Name.toString(),L["dcCCNID"+(i-5e4)+"_Key"]=R[x].Dim1.toString()),this.FillDatarowNN(L,null,t,{LocalReference:79,LinkData:53734},"ProfileName"),this.FillDatarowNN(L,null,t,{LocalReference:79,LinkData:55480},"FromDate"),this.FillDatarowNN(L,null,t,{LocalReference:79,LinkData:55483},"ToDate"),this.FillDatarowNN(L,null,t,{LocalReference:79,LinkData:55850},"FromQty"),this.FillDatarowNN(L,null,t,{LocalReference:79,LinkData:55851},"ToQty"),L.SchemeID=R[x].SchemeID.toString(),b?this.FillProductValues(L):this.CalculateTotals(L,!1),!o.e.IsEmpty(L.FreeQTY)&&parseFloat(L.FreeQTY)>0&&(L.UOMConvertedQty=o.e.IsEmpty(L.UOMConversion)?L.FreeQTY.toString():parseFloat(L.FreeQTY)*parseFloat(L.UOMConversion))}if(null!=B)for(var H=R.length;H<B.length;H++)this.ScreenObject.GridDataObj.removeRow(B[H])}else{var W=null;if(""!=C&&this.ScreenObject.GridData.filter((function(e){return e.MaxSchemeID&&C.split(",").Contains(e.MaxSchemeID.toString())&&"Y"==e.IsScheme})).length>0){var U=this.ScreenObject.GridData.filter((function(e){return e.MaxSchemeID&&C.split(",").Contains(e.MaxSchemeID.toString())&&"Y"==e.IsScheme}));W=U[0],y=parseInt(U[0].MaxSchemeID);for(var X=1;X<U.length;X++)this.ScreenObject.GridDataObj.removeRow(U[X])}else if(o.e.IsEmpty(t.Percentage)||!(parseFloat(t.Percentage)>0)||o.e.IsEmpty(t.IsQtyPercent)||2!=parseInt(t.IsQtyPercent)){W=this.ScreenObject.GridDataObj.NewRow();var q=this.ScreenObject.GridData.Compute("max","MaxSchemeID");null!=q&&(y=o.e.Int(q)),y++,W.IsScheme="Y",e.IsScheme="N",W.MaxSchemeID=y,e.MaxSchemeID=y,this.ScreenObject.GridDataObj.insertRowAt(W,this.ScreenObject.GridData.indexOf(e)+1),this.ScreenObject.UpdateSequence()}if(this.ScreenObject.Preferences.ContainsKey("schemecopydata")&&Object(l.j)(this.ScreenObject.Preferences.schemecopydata)&&this.Copyparentrow(W,e),!o.e.IsEmpty(t.Percentage)&&parseFloat(t.Percentage)>0&&!o.e.IsEmpty(t.IsQtyPercent)&&2==parseInt(t.IsQtyPercent)||(o.e.String(W.ProductID_Key)!=e.ProductID_Key.toString()&&(b=!0),W.ProductID_Key=e.ProductID_Key.toString(),this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(W.ProductCode=e.ProductCode.toString()),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(W.ProductName=e.ProductName.toString()),W.Type=o.e.String(e.Type)),!o.e.IsEmpty(t.Quantity)&&parseFloat(t.Quantity)>0){F=parseFloat(t.Quantity);var Y=u/parseFloat(t.FromQty);W.FreeQTY=Math.floor(Y)*F}else if(!o.e.IsEmpty(t.Value)&&parseFloat(t.Value)>0){F=parseFloat(t.Value);var z=u/parseFloat(t.FromQty);W[r]=Math.floor(z)*F*-1,W.FreeQTY=0}else if(!o.e.IsEmpty(t.Percentage)&&parseFloat(t.Percentage)>0)if(o.e.IsEmpty(t.IsQtyPercent)||2!=parseInt(t.IsQtyPercent))if(o.e.IsEmpty(t.IsQtyPercent)||1!=parseInt(t.IsQtyPercent)){if(!o.e.IsEmpty(e[n])){F=parseFloat(t.Percentage);var J=u/parseFloat(t.FromQty);J=d/100*Math.floor(J),W[r]=J*F*-1,W.FreeQTY=0}}else{F=parseFloat(t.Percentage);var Z=u/parseFloat(t.FromQty);Z=u/100*Math.floor(Z),W.FreeQTY=Z*F,W[r]=0}else this.IsPOs?(F=u/parseFloat(t.FromQty),e[r]=Math.floor(F)*parseFloat(t.Percentage)):e[r]=t.Percentage.toString(),e.SchemeID="-1",this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:53734},"ProfileName"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55480},"FromDate"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55483},"ToDate"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55850},"FromQty"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55851},"ToQty"),h.forEach((function(t){t!=e&&(t[r]=0)}));!o.e.IsEmpty(t.Percentage)&&parseFloat(t.Percentage)>0&&!o.e.IsEmpty(t.IsQtyPercent)&&2==parseInt(t.IsQtyPercent)||(this.FillDatarowNN(W,null,t,{LocalReference:79,LinkData:53734},"ProfileName"),this.FillDatarowNN(W,null,t,{LocalReference:79,LinkData:55480},"FromDate"),this.FillDatarowNN(W,null,t,{LocalReference:79,LinkData:55483},"ToDate"),this.FillDatarowNN(W,null,t,{LocalReference:79,LinkData:55850},"FromQty"),this.FillDatarowNN(W,null,t,{LocalReference:79,LinkData:55851},"ToQty"),W.SchemeID=t.SchemeID.toString(),b?this.FillProductValues(W):this.CalculateTotals(W,!1),!o.e.IsEmpty(W.FreeQTY)&&parseFloat(W.FreeQTY)>0&&(W.UOMConvertedQty=o.e.IsEmpty(W.UOMConversion)?W.FreeQTY.toString():parseFloat(W.FreeQTY)*parseFloat(W.UOMConversion)))}}}else if(parseFloat(t.FromValue)>0)if(parseFloat(t.ToValue)!=parseFloat(t.FromValue))if(!o.e.IsEmpty(t.freeProductID)&&parseInt(t.freeProductID)>0){var $=this.ScreenObject.GridData.Compute("max","MaxSchemeID");null!=$&&(y=o.e.Int($)),y++;var ee=null,te=this.DtTempSchemes.filter((function(e){return e.SchemeID==t.SchemeID})),ne=null;""!=C&&(ne=this.ScreenObject.GridData.filter((function(e){return C.split(",").Contains(e.MaxSchemeID)&&"Y"==e.IsScheme})));for(var ae=0;ae<te.length;ae++){if(b=!1,""!=C&&null!=ne&&ne.length>ae?(ee=ne[ae],y=parseInt(C.split(",")[0])):((ee=this.ScreenObject.GridDataObj.NewRow()).IsScheme="Y",e.IsScheme="N",ee.MaxSchemeID=y,e.MaxSchemeID=y,this.ScreenObject.GridDataObj.insertRowAt(ee,this.ScreenObject.GridData.indexOf(e)+1),this.ScreenObject.UpdateSequence()),this.ScreenObject.Preferences.ContainsKey("schemecopydata")&&Object(l.j)(this.ScreenObject.Preferences.schemecopydata)&&this.Copyparentrow(ee,e),ee.ProductID_Key.toString()!=te[ae].freeProductID.toString()&&(b=!0),ee.ProductID_Key=te[ae].freeProductID.toString(),this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(ee.ProductCode=te[ae].ProductCode.toString()),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(ee.ProductName=te[ae].ProductName.toString()),o.e.IsEmpty(te[ae].freeQuantity)||(ee.FreeQTY=parseFloat(te[ae].freeQuantity)),!o.e.IsEmpty(te[ae].freeQuantity)&&parseFloat(te[ae].freeQuantity)>0)ee.FreeQTY=parseFloat(te[ae].freeQuantity),ee[r]=0;else if(!o.e.IsEmpty(t.freeValue)&&parseFloat(te[ae].freeValue)>0)ee[r]=-1*parseFloat(te[ae].freeValue),ee.FreeQTY=0;else if(!o.e.IsEmpty(te[ae].freePercentage)&&parseFloat(te[ae].freePercentage)>0&&!o.e.IsEmpty(e[n])){var ie=d/100*parseFloat(te[ae].freePercentage);ee[r]=-1*ie,ee.FreeQTY=0}o.e.IsEmpty(te[ae].ProductTypeID)||(ee.Type=parseFloat(te[ae].ProductTypeID)),i>5e4&&this.DtTempSchemesColumns.Contains("Dim1")&&!o.e.IsEmpty(te[ae].Dim1)&&this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(i-5e4))&&(ee["dcCCNID"+(i-5e4)]=te[ae].Name.toString(),ee["dcCCNID"+(i-5e4)+"_Key"]=te[ae].Dim1.toString()),this.FillDatarowNN(ee,null,t,{LocalReference:79,LinkData:53734},"ProfileName"),this.FillDatarowNN(ee,null,t,{LocalReference:79,LinkData:55480},"FromDate"),this.FillDatarowNN(ee,null,t,{LocalReference:79,LinkData:55483},"ToDate"),this.FillDatarowNN(ee,null,t,{LocalReference:79,LinkData:55850},"FromValue"),this.FillDatarowNN(ee,null,t,{LocalReference:79,LinkData:55851},"ToValue"),ee.SchemeID=te[ae].SchemeID.toString(),b?this.FillProductValues(ee):this.CalculateTotals(ee,!1)}if(null!=ne)for(var re=te.length;re<ne.length;re++)this.ScreenObject.GridDataObj.removeRow(ne[re])}else{var se=null;if(""!=C&&this.ScreenObject.GridData.filter((function(e){return e.MaxSchemeID&&C.split(",").Contains(e.MaxSchemeID.toString())&&"Y"==e.IsScheme})).length>0){var oe=this.ScreenObject.GridData.filter((function(e){return e.MaxSchemeID&&C.split(",").Contains(e.MaxSchemeID.toString())&&"Y"==e.IsScheme}));se=oe[0],y=parseInt(oe[0].MaxSchemeID);for(var ce=1;ce<oe.length;ce++)this.ScreenObject.GridDataObj.removeRow(oe[ce])}else if(o.e.IsEmpty(t.Percentage)||!(parseFloat(t.Percentage)>0)||o.e.IsEmpty(t.IsQtyPercent)||2!=parseInt(t.IsQtyPercent)){se=this.ScreenObject.GridDataObj.NewRow();var le=this.ScreenObject.GridData.Compute("max","MaxSchemeID");null!=le&&(y=o.e.Int(le)),y++,se.IsScheme="Y",e.IsScheme="N",se.MaxSchemeID=y,e.MaxSchemeID=y,this.ScreenObject.GridDataObj.insertRowAt(se,this.ScreenObject.GridData.indexOf(e)+1),this.ScreenObject.UpdateSequence()}if(this.ScreenObject.Preferences.ContainsKey("schemecopydata")&&Object(l.j)(this.ScreenObject.Preferences.schemecopydata)&&this.Copyparentrow(se,e),!o.e.IsEmpty(t.Percentage)&&parseFloat(t.Percentage)>0&&!o.e.IsEmpty(t.IsQtyPercent)&&2==parseInt(t.IsQtyPercent)||(o.e.String(se.ProductID_Key)!=e.ProductID_Key.toString()&&(b=!0),se.ProductID_Key=e.ProductID_Key.toString(),this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(se.ProductCode=e.ProductCode.toString()),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(se.ProductName=e.ProductName.toString()),o.e.IsEmpty(t.Quantity)||(se.FreeQTY=parseFloat(t.Quantity))),!o.e.IsEmpty(t.Quantity)&&parseFloat(t.Quantity)>0)se.FreeQTY=parseFloat(t.Quantity),se[r]=0;else if(!o.e.IsEmpty(t.Value)&&parseFloat(t.Value)>0)se[r]=-1*parseFloat(t.Value),se.FreeQTY=0;else if(!o.e.IsEmpty(t.Percentage)&&parseFloat(t.Percentage)>0)if(o.e.IsEmpty(t.IsQtyPercent)||2!=parseInt(t.IsQtyPercent)){if(!o.e.IsEmpty(e[n])){var ue=d/100*parseFloat(t.Percentage);se[r]=-1*ue,se.FreeQTY=0}}else e[r]=t.Percentage.toString(),e.SchemeID="-1",this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:53734},"ProfileName"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55480},"FromDate"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55483},"ToDate"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55850},"FromValue"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55851},"ToValue"),h.forEach((function(t){t!=e&&(t[r]=0)}));!o.e.IsEmpty(t.Percentage)&&parseFloat(t.Percentage)>0&&!o.e.IsEmpty(t.IsQtyPercent)&&2==parseInt(t.IsQtyPercent)||(se.Type=o.e.String(e.Type),this.FillDatarowNN(se,null,t,{LocalReference:79,LinkData:53734},"ProfileName"),this.FillDatarowNN(se,null,t,{LocalReference:79,LinkData:55480},"FromDate"),this.FillDatarowNN(se,null,t,{LocalReference:79,LinkData:55483},"ToDate"),this.FillDatarowNN(se,null,t,{LocalReference:79,LinkData:55850},"FromValue"),this.FillDatarowNN(se,null,t,{LocalReference:79,LinkData:55851},"ToValue"),se.SchemeID=t.SchemeID.toString(),b?this.FillProductValues(se):this.CalculateTotals(se,!1))}else if(parseFloat(t.ToValue)==parseFloat(t.FromValue)){var de=0;if(!o.e.IsEmpty(t.freeProductID)&&parseInt(t.freeProductID)>0){var De=this.ScreenObject.GridData.Compute("max","MaxSchemeID");null!=De&&(y=o.e.Int(De)),y++;var he=null,Se=this.DtTempSchemes.filter((function(e){return e.SchemeID==t.SchemeID})),me=null;""!=C&&(me=this.ScreenObject.GridData.filter((function(e){return C.split(",").Contains(e.MaxSchemeID)&&"Y"==e.IsScheme})));for(var be=0;be<Se.length;be++){if(b=!1,""!=C&&null!=me&&me.length>be?(he=me[be],y=parseInt(C.split(",")[0])):((he=this.ScreenObject.GridDataObj.NewRow()).IsScheme="Y",e.IsScheme="N",he.MaxSchemeID=y,e.MaxSchemeID=y,this.ScreenObject.GridDataObj.insertRowAt(he,this.ScreenObject.GridData.indexOf(e)+1),this.ScreenObject.UpdateSequence()),this.ScreenObject.Preferences.ContainsKey("schemecopydata")&&Object(l.j)(this.ScreenObject.Preferences.schemecopydata)&&this.Copyparentrow(he,e),he.ProductID_Key.toString()!=Se[be].freeProductID.toString()&&(b=!0),he.ProductID_Key=Se[be].freeProductID.toString(),this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(he.ProductCode=Se[be].ProductCode.toString()),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(he.ProductName=Se[be].ProductName.toString()),o.e.IsEmpty(Se[be].ProductTypeID)||(he.Type=parseFloat(Se[be].ProductTypeID)),!o.e.IsEmpty(Se[be].freeQuantity)&&parseFloat(Se[be].freeQuantity)>0){de=parseFloat(Se[be].freeQuantity);var Ce=d/parseFloat(Se[be].FromValue);he.FreeQTY=Math.floor(Ce)*de,he[r]=0}else if(!o.e.IsEmpty(t.freeValue)&&parseFloat(Se[be].freeValue)>0){de=parseFloat(Se[be].freeValue);var ye=d/parseFloat(Se[be].FromValue);he[r]=Math.floor(ye)*de*-1,he.FreeQTY=0}else if(!o.e.IsEmpty(Se[be].freePercentage)&&parseFloat(Se[be].freePercentage)>0&&!o.e.IsEmpty(e[n])){de=parseFloat(Se[be].freePercentage);var pe=d/parseFloat(Se[be].FromValue);pe=d/100*Math.floor(pe),he[r]=pe*de*-1,he.FreeQTY=0}i>5e4&&this.DtTempSchemesColumns.Contains("Dim1")&&!o.e.IsEmpty(Se[be].Dim1)&&this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(i-5e4))&&(he["dcCCNID"+(i-5e4)]=Se[be].Name.toString(),he["dcCCNID"+(i-5e4)+"_Key"]=Se[be].Dim1.toString()),this.FillDatarowNN(he,null,t,{LocalReference:79,LinkData:53734},"ProfileName"),this.FillDatarowNN(he,null,t,{LocalReference:79,LinkData:55480},"FromDate"),this.FillDatarowNN(he,null,t,{LocalReference:79,LinkData:55483},"ToDate"),this.FillDatarowNN(he,null,t,{LocalReference:79,LinkData:55850},"FromValue"),this.FillDatarowNN(he,null,t,{LocalReference:79,LinkData:55851},"ToValue"),he.SchemeID=Se[be].SchemeID.toString(),b?this.FillProductValues(he):this.CalculateTotals(he,!1)}if(null!=me)for(var ge=Se.length;ge<me.length;ge++)this.ScreenObject.GridDataObj.removeRow(me[ge])}else{var fe=null;if(""!=C&&this.ScreenObject.GridData.filter((function(t){return t.MaxSchemeID==e.MaxSchemeID&&"Y"==t.IsScheme})).length>0){var Oe=this.ScreenObject.GridData.filter((function(e){return C.split(",").Contains(e.MaxSchemeID)&&"Y"==e.IsScheme}));fe=Oe[0],y=parseInt(Oe[0].MaxSchemeID);for(var Ie=1;Ie<Oe.length;Ie++)this.ScreenObject.GridDataObj.removeRow(Oe[Ie])}else if(o.e.IsEmpty(t.Percentage)||!(parseFloat(t.Percentage)>0)||o.e.IsEmpty(t.IsQtyPercent)||2!=parseInt(t.IsQtyPercent)){fe=this.ScreenObject.GridDataObj.NewRow();var Te=this.ScreenObject.GridData.Compute("max","MaxSchemeID");null!=Te&&(y=o.e.Int(Te)),y++,fe.IsScheme="Y",e.IsScheme="N",fe.MaxSchemeID=y,e.MaxSchemeID=y,this.ScreenObject.GridDataObj.insertRowAt(fe,this.ScreenObject.GridData.indexOf(e)+1),this.ScreenObject.UpdateSequence()}if(this.ScreenObject.Preferences.ContainsKey("schemecopydata")&&Object(l.j)(this.ScreenObject.Preferences.schemecopydata)&&this.Copyparentrow(fe,e),!o.e.IsEmpty(t.Percentage)&&parseFloat(t.Percentage)>0&&!o.e.IsEmpty(t.IsQtyPercent)&&2==parseInt(t.IsQtyPercent)||(o.e.String(fe.ProductID_Key)!=e.ProductID_Key.toString()&&(b=!0),fe.ProductID_Key=e.ProductID_Key.toString(),this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(fe.ProductCode=e.ProductCode.toString()),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(fe.ProductName=e.ProductName.toString()),fe.Type=o.e.String(e.Type)),!o.e.IsEmpty(t.Quantity)&&parseFloat(t.Quantity)>0){de=parseFloat(t.Quantity);var je=d/parseFloat(t.FromValue);fe.FreeQTY=Math.floor(je)*de}else if(!o.e.IsEmpty(t.Value)&&parseFloat(t.Value)>0){de=parseFloat(t.Value);var Pe=d/parseFloat(t.FromValue);fe[r]=Math.floor(Pe)*de*-1,fe.FreeQTY=0}else if(!o.e.IsEmpty(t.Percentage)&&parseFloat(t.Percentage)>0)if(o.e.IsEmpty(t.IsQtyPercent)||2!=parseInt(t.IsQtyPercent)){if(!o.e.IsEmpty(e[n])){de=parseFloat(t.Percentage);var Ae=d/parseFloat(t.FromValue);Ae=d/100*Math.floor(Ae),fe[r]=Ae*de*-1,fe.FreeQTY=0}}else this.IsPOs?(de=d/parseFloat(t.FromValue),e[r]=Math.floor(de)*parseFloat(t.Percentage)):e[r]=t.Percentage.toString(),e.SchemeID="-1",this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:53734},"ProfileName"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55480},"FromDate"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55483},"ToDate"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55850},"FromValue"),this.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55851},"ToValue"),h.forEach((function(t){t!=e&&(t[r]=0)}));!o.e.IsEmpty(t.Percentage)&&parseFloat(t.Percentage)>0&&!o.e.IsEmpty(t.IsQtyPercent)&&2==parseInt(t.IsQtyPercent)||(this.FillDatarowNN(fe,null,t,{LocalReference:79,LinkData:53734},"ProfileName"),this.FillDatarowNN(fe,null,t,{LocalReference:79,LinkData:55480},"FromDate"),this.FillDatarowNN(fe,null,t,{LocalReference:79,LinkData:55483},"ToDate"),this.FillDatarowNN(fe,null,t,{LocalReference:79,LinkData:55850},"FromValue"),this.FillDatarowNN(fe,null,t,{LocalReference:79,LinkData:55851},"ToValue"),fe.SchemeID=t.SchemeID.toString(),b?this.FillProductValues(fe):this.CalculateTotals(fe,!1))}}h.forEach((function(e){y>0&&(e.IsScheme="N",e.MaxSchemeID=y,e.SchemeID=t.SchemeID.toString()),a.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:53734},"ProfileName"),a.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55480},"FromDate"),a.FillDatarowNN(e,null,t,{LocalReference:79,LinkData:55483},"ToDate")}))}},{key:"AddLinkProducts",value:function(e,t){var n=t,a=0,i=this.ScreenObject.GridData.Compute("max","LinkID");null!=i&&(a=o.e.Int(i)),a++,this.ScreenObject.GridData[n-1].LinkID=a,this.ScreenObject.GridData[n-1].LinkType=0;for(var r=0,c=0;c<e.length;c++)if(o.e.IsEmpty(e[c].LinkType)||2!=parseInt(e[c].LinkType))o.e.IsEmpty(e[c].LinkType)||1!=parseInt(e[c].LinkType)||r++;else{var l=this.ScreenObject.GridDataObj.NewRow();l.LinkID=a,l.ProductID_Key=e[c].ProductID.toString(),l.Quantity="1",this.ScreenObject.GridData.InsertAt(l,n),this.AddProductData(l,!0,!1),this.CalculateTotals(l,!1),l.LinkType=2,n++}r>0&&0==s.a.page.DialogCount&&s.a.page.ShowDialog(new zt(this,e,a,t),Jt.a,{ShowCenter:!0,HideClose:!0,Title:"Optinal Linked Products"}),this.ScreenObject.UpdateSequence()}},{key:"FillDatarow",value:function(e,t,n,a,i){var r,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1;(r=this.ScreenObject.Data.Tables[0].filter(a.LocalReference?function(e){return e.LocalReference==a.LocalReference&&e.LinkData==a.LinkData}:function(e){return null!=e.LocalReference&&e.LinkData==a.LinkData})).length>0&&this.ScreenObject.GridDataColumns.Contains(r[0].SysColumnName)&&(e[r[0].SysColumnName]=null==n||o.e.IsEmpty(n[i])||0==parseFloat(n[i])?t.length>0&&!o.e.IsEmpty(t[0][i])?t[0][i].toString():0:-1==s?n[i].toString():parseFloat(n[i])*s)}},{key:"FillDatarowNN",value:function(e,t,n,a,i){var r;(r=this.ScreenObject.Data.Tables[0].filter(a.LocalReference?function(e){return e.LocalReference==a.LocalReference&&e.LinkData==a.LinkData}:function(e){return null!=e.LocalReference&&e.LinkData==a.LinkData})).length>0&&this.ScreenObject.GridDataColumns.Contains(r[0].SysColumnName)&&("DATE"!=r[0].ColumnDataType.toString().toUpperCase()&&"DATE"!=r[0].UserColumnType.toString().toUpperCase()||!this.ScreenObject.GridDataColumns.Contains(r[0].SysColumnName+"_Key")?e[r[0].SysColumnName]=null==n||o.e.IsEmpty(n[i])?null==t||o.e.IsEmpty(t[0][i])?null:t[0][i].toString():n[i].toString():null!=n&&o.e.isValidDate(n[i])?(e[r[0].SysColumnName+"_Key"]=new Date(n[i]),e[r[0].SysColumnName]=new Date(n[i]).ToString(s.a.SessionManager.Preferences["Date Format"])):null!=t&&!o.e.IsEmpty(t[0][i])&&o.e.isValidDate(t[0][i])?(e[r[0].SysColumnName+"_Key"]=new Date(t[0][i]),e[r[0].SysColumnName]=new Date(t[0][i]).ToString(s.a.SessionManager.Preferences["Date Format"])):(e[r[0].SysColumnName]=null,e[r[0].SysColumnName+"_Key"]=null))}},{key:"FillCreatedByDate",value:function(e){var t=this;if(0!=this.ScreenObject.Data.Tables.length){if(this.ScreenObject.IsDocEdit&&"Revise"==e){var n=this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&55488==e.LinkData}));if(!(n.length>0))return;if(this.ScreenObject.GridDataColumns.Contains(n[0].SysColumnName))for(var a=0;a<this.ScreenObject.GridData.length;a++)(this.IsInventoryVoucher&&!o.e.IsEmpty(this.ScreenObject.GridData[a].ProductID_Key)||!this.IsInventoryVoucher&&(this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[a].AccountID_Key)||this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[a].DebitAccount_Key)||this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[a].CreditAccount_Key)))&&("Date"==n[0].UserColumnType.toString()?(this.ScreenObject.GridData[a][n[0].SysColumnName]=(new Date).ToString(s.a.SessionManager.Preferences["Date Format"]),this.ScreenObject.GridData[a][n[0].SysColumnName+"_Key"]=new Date):"DateTime"==n[0].UserColumnType.toString()?(this.ScreenObject.GridData[a][n[0].SysColumnName]=(new Date).ToString(s.a.SessionManager.Preferences["Date Format"]+" hh:mm a"),this.ScreenObject.GridData[a][n[0].SysColumnName+"_Key"]=new Date):"Time"==n[0].UserColumnType.toString()?(this.ScreenObject.GridData[a][n[0].SysColumnName]=(new Date).ToString(s.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss tt"),this.ScreenObject.GridData[a][n[0].SysColumnName+"_Key"]=new Date):this.ScreenObject.GridData[a][n[0].SysColumnName]=(new Date).ToString(s.a.SessionManager.Preferences["Date Format"]));else{var i=this.ScreenObject._TextFields.find((function(e){return e.DBColumnName==n[0].SysColumnName}));i&&(i instanceof h.d?i.Text=(new Date).ToString(s.a.SessionManager.Preferences["Date Format"]):i instanceof S.c&&(i.Date=new Date),i instanceof S.b&&(i.Date=new Date))}}var r=this.ScreenObject.Data.Tables[0];if(r.length>0)if(this.ScreenObject.IsDocEdit){if((r=this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&49983==e.LinkData}))).length>0){if(this.ScreenObject.GridDataColumns.Contains(r[0].SysColumnName))for(var c=0;c<this.ScreenObject.GridData.length;c++)(this.IsInventoryVoucher&&!o.e.IsEmpty(this.ScreenObject.GridData[c].ProductID_Key)||!this.IsInventoryVoucher&&(this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[c].AccountID_Key)||this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[c].DebitAccount_Key)||this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[c].CreditAccount_Key)))&&(this.ScreenObject.GridData[c][r[0].SysColumnName]=s.a.SessionManager.UserName);var l=this.ScreenObject._TextFields.find((function(e){return e.DBColumnName==r[0].SysColumnName}));l&&l instanceof h.d&&(l.Text=s.a.SessionManager.UserName)}if((r=this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&49984==e.LinkData}))).length>0){var u=s.a.common.GetDataSet("DOC001","");if(null!=u&&u.Tables.length>0&&!u.Columns[0].Contains("ErrorMessage")&&u.Tables[0].length>0&&!o.e.IsEmpty(u.Tables[0][0].dt)){if(this.ScreenObject.GridDataColumns.Contains(r[0].SysColumnName))for(var d=0;d<this.ScreenObject.GridData.length;d++)if(this.IsInventoryVoucher&&!o.e.IsEmpty(this.ScreenObject.GridData[d].ProductID_Key))this.ScreenObject.GridData[d][r[0].SysColumnName]=s.a.SessionManager.UserName;else if(!this.IsInventoryVoucher&&(this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[d].AccountID_Key)||this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[d].DebitAccount_Key)||this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[d].CreditAccount_Key))){var D=u.Columns[0][0];"Date"==r[0].UserColumnType.toString()?(this.ScreenObject.GridData[d][r[0].SysColumnName]=new Date(u.Tables[0][0][D]).ToString(s.a.SessionManager.Preferences["Date Format"]),this.ScreenObject.GridData[d][r[0].SysColumnName+"_Key"]=new Date(u.Tables[0][0][D])):"DateTime"==r[0].UserColumnType.toString()?(this.ScreenObject.GridData[d][r[0].SysColumnName]=new Date(u.Tables[0][0][D]).ToString(s.a.SessionManager.Preferences["Date Format"]+" hh:mm a"),this.ScreenObject.GridData[d][r[0].SysColumnName+"_Key"]=new Date(u.Tables[0][0][D])):"Time"==r[0].UserColumnType.toString()?(this.ScreenObject.GridData[d][r[0].SysColumnName]=new Date(u.Tables[0][0][D]).ToString(s.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss tt"),this.ScreenObject.GridData[d][r[0].SysColumnName+"_Key"]=new Date(u.Tables[0][0][D])):this.ScreenObject.GridData[d][r[0].SysColumnName]=new Date(u.Tables[0][0][D]).ToString(s.a.SessionManager.Preferences["Date Format"])}var m=this.ScreenObject._TextFields.find((function(e){return e.DBColumnName==r[0].SysColumnName}));if(m){var b=u.Columns[0][0];m instanceof h.d?m.Text=new Date(u.Tables[0][0][b]).ToString(s.a.SessionManager.Preferences["Date Format"]):m instanceof S.c&&(m.Date=new Date(u.Tables[0][0][b])),m instanceof S.b&&(m.Date=new Date(u.Tables[0][0][b]))}}}if((r=this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalCCID&&-7==e.LocalCCID}))).length>0)for(var C=function(e){if(t.ScreenObject.GridDataColumns.Contains(r[e].SysColumnName))for(var n=0;n<t.ScreenObject.GridData.length;n++)t.IsInventoryVoucher&&!o.e.IsEmpty(t.ScreenObject.GridData[n].ProductID_Key)?t.ScreenObject.Data.Tables.length>22&&null!=t.ScreenObject.Data.Tables[23]&&t.ScreenObject.Data.Tables[23].length>0&&("22898"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].UserName.toString():"22900"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].FirstName.toString():"22901"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].MiddleName.toString():"22902"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].LastName.toString():"22903"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Address1.toString():"22904"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Address2.toString():"22905"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Address3.toString():"22906"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].City.toString():"22907"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].State.toString():"22908"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Zip.toString():"22909"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Country.toString():"22910"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Phone1.toString():"22911"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Phone2.toString():"22912"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Fax.toString():"22913"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Email1.toString():"22914"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Email2.toString():"22915"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Website.toString():"22916"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Description.toString():"22917"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Role.toString():"53531"==r[e].LinkData.toString()&&(t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Status.toString())):!t.IsInventoryVoucher&&(t.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&!o.e.IsEmpty(t.ScreenObject.GridData[n].AccountID_Key)||t.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!o.e.IsEmpty(t.ScreenObject.GridData[n].DebitAccount_Key)||t.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!o.e.IsEmpty(t.ScreenObject.GridData[n].CreditAccount_Key))&&t.ScreenObject.Data.Tables.length>22&&null!=t.ScreenObject.Data.Tables[23]&&t.ScreenObject.Data.Tables[23].length>0&&("22898"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].UserName.toString():"22900"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].FirstName.toString():"22901"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].MiddleName.toString():"22902"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].LastName.toString():"22903"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Address1.toString():"22904"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Address2.toString():"22905"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Address3.toString():"22906"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].City.toString():"22907"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].State.toString():"22908"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Zip.toString():"22909"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Country.toString():"22910"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Phone1.toString():"22911"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Phone2.toString():"22912"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Fax.toString():"22913"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Email1.toString():"22914"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Email2.toString():"22915"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Website.toString():"22916"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Description.toString():"22917"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Role.toString():"53531"==r[e].LinkData.toString()&&(t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Status.toString()));var a=t.ScreenObject._TextFields.find((function(t){return t.DBColumnName==r[e].SysColumnName}));a&&a instanceof h.d&&t.ScreenObject.Data.Tables.length>22&&null!=t.ScreenObject.Data.Tables[23]&&t.ScreenObject.Data.Tables[23].length>0&&("22898"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].UserName.toString():"22900"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].FirstName.toString():"22901"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].MiddleName.toString():"22902"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].LastName.toString():"22903"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].Address1.toString():"22904"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].Address2.toString():"22905"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].Address3.toString():"22906"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].City.toString():"22907"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].State.toString():"22908"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].Zip.toString():"22909"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].Country.toString():"22910"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].Phone1.toString():"22911"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].Phone2.toString():"22912"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].Fax.toString():"22913"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].Email1.toString():"22914"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].Email2.toString():"22915"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].Website.toString():"22916"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].Description.toString():"22917"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].Role.toString():"53531"==r[e].LinkData.toString()&&(a.Text=t.ScreenObject.Data.Tables[23][0].Status.toString()))},y=0;y<r.length;y++)C(y)}else{if((r=this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&24060==e.LinkData}))).length>0){if(this.ScreenObject.GridDataColumns.Contains(r[0].SysColumnName))for(var p=0;p<this.ScreenObject.GridData.length;p++)(this.IsInventoryVoucher&&!o.e.IsEmpty(this.ScreenObject.GridData[p].ProductID_Key)||!this.IsInventoryVoucher&&(this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[p].AccountID_Key)||this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[p].DebitAccount_Key)||this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[p].CreditAccount_Key)))&&(this.ScreenObject.GridData[p][r[0].SysColumnName]=s.a.SessionManager.UserName);var g=this.ScreenObject._TextFields.find((function(e){return e.DBColumnName==r[0].SysColumnName}));g&&g instanceof h.d&&(g.Text=s.a.SessionManager.UserName)}if((r=this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&24061==e.LinkData}))).length>0){var f=s.a.common.GetDataSet("DOC001","");if(null!=f&&f.Tables.length>0&&!f.Columns[0].Contains("ErrorMessage")&&f.Tables[0].length>0&&!o.e.IsEmpty(f.Tables[0][0].dt)){if(this.ScreenObject.GridDataColumns.Contains(r[0].SysColumnName))for(var O=0;O<this.ScreenObject.GridData.length;O++)if(this.IsInventoryVoucher&&!o.e.IsEmpty(this.ScreenObject.GridData[O].ProductID_Key))this.ScreenObject.GridData[O][r[0].SysColumnName]=s.a.SessionManager.UserName;else if(!this.IsInventoryVoucher&&(this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[O].AccountID_Key)||this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[O].DebitAccount_Key)||this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[O].CreditAccount_Key))){var I=f.Columns[0][0];"Date"==r[0].UserColumnType.toString()?(this.ScreenObject.GridData[O][r[0].SysColumnName]=new Date(f.Tables[0][0][I]).ToString(s.a.SessionManager.Preferences["Date Format"]),this.ScreenObject.GridData[O][r[0].SysColumnName+"_Key"]=new Date(f.Tables[0][0][I])):"DateTime"==r[0].UserColumnType.toString()?(this.ScreenObject.GridData[O][r[0].SysColumnName]=new Date(f.Tables[0][0][I]).ToString(s.a.SessionManager.Preferences["Date Format"]+" hh:mm a"),this.ScreenObject.GridData[O][r[0].SysColumnName+"_Key"]=new Date(f.Tables[0][0][I])):"Time"==r[0].UserColumnType.toString()?(this.ScreenObject.GridData[O][r[0].SysColumnName]=new Date(f.Tables[0][0][I]).ToString(s.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss tt"),this.ScreenObject.GridData[O][r[0].SysColumnName+"_Key"]=new Date(f.Tables[0][0][I])):this.ScreenObject.GridData[O][r[0].SysColumnName]=new Date(f.Tables[0][0][I]).ToString(s.a.SessionManager.Preferences["Date Format"])}var T=this.ScreenObject._TextFields.find((function(e){return e.DBColumnName==r[0].SysColumnName}));if(T){var j=f.Columns[0][0];T instanceof h.d?T.Text=new Date(f.Tables[0][0][j]).ToString(s.a.SessionManager.Preferences["Date Format"]):T instanceof S.c&&(T.Date=new Date(f.Tables[0][0][j])),T instanceof S.b&&(T.Date=new Date(f.Tables[0][0][j]))}}}if((r=this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalCCID&&7==e.LocalCCID}))).length>0)for(var P=function(e){if(t.ScreenObject.GridDataColumns.Contains(r[e].SysColumnName))for(var n=0;n<t.ScreenObject.GridData.length;n++)t.IsInventoryVoucher&&!o.e.IsEmpty(t.ScreenObject.GridData[n].ProductID_Key)?t.ScreenObject.Data.Tables.length>22&&null!=t.ScreenObject.Data.Tables[23]&&t.ScreenObject.Data.Tables[23].length>0&&("22898"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].UserName.toString():"22900"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].FirstName.toString():"22901"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].MiddleName.toString():"22902"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].LastName.toString():"22903"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Address1.toString():"22904"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Address2.toString():"22905"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Address3.toString():"22906"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].City.toString():"22907"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].State.toString():"22908"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Zip.toString():"22909"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Country.toString():"22910"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Phone1.toString():"22911"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Phone2.toString():"22912"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Fax.toString():"22913"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Email1.toString():"22914"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Email2.toString():"22915"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Website.toString():"22916"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Description.toString():"22917"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Role.toString():"53531"==r[e].LinkData.toString()&&(t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Status.toString())):!t.IsInventoryVoucher&&(t.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&!o.e.IsEmpty(t.ScreenObject.GridData[n].AccountID_Key)||t.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!o.e.IsEmpty(t.ScreenObject.GridData[n].DebitAccount_Key)||t.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!o.e.IsEmpty(t.ScreenObject.GridData[n].CreditAccount_Key))&&t.ScreenObject.Data.Tables.length>22&&null!=t.ScreenObject.Data.Tables[23]&&t.ScreenObject.Data.Tables[23].length>0&&("22898"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].UserName.toString():"22900"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].FirstName.toString():"22901"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].MiddleName.toString():"22902"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].LastName.toString():"22903"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Address1.toString():"22904"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Address2.toString():"22905"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Address3.toString():"22906"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].City.toString():"22907"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].State.toString():"22908"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Zip.toString():"22909"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Country.toString():"22910"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Phone1.toString():"22911"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Phone2.toString():"22912"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Fax.toString():"22913"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Email1.toString():"22914"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Email2.toString():"22915"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Website.toString():"22916"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Description.toString():"22917"==r[e].LinkData.toString()?t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Role.toString():"53531"==r[e].LinkData.toString()&&(t.ScreenObject.GridData[n][r[e].SysColumnName]=t.ScreenObject.Data.Tables[23][0].Status.toString()));var a=t.ScreenObject._TextFields.find((function(t){return t.DBColumnName==r[e].SysColumnName}));a&&a instanceof h.d&&t.ScreenObject.Data.Tables.length>22&&null!=t.ScreenObject.Data.Tables[23]&&t.ScreenObject.Data.Tables[23].length>0&&("22898"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].UserName.toString():"22900"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].FirstName.toString():"22901"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].MiddleName.toString():"22902"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].LastName.toString():"22903"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].Address1.toString():"22904"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].Address2.toString():"22905"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].Address3.toString():"22906"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].City.toString():"22907"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].State.toString():"22908"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].Zip.toString():"22909"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].Country.toString():"22910"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].Phone1.toString():"22911"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].Phone2.toString():"22912"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].Fax.toString():"22913"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].Email1.toString():"22914"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].Email2.toString():"22915"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].Website.toString():"22916"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].Description.toString():"22917"==r[e].LinkData.toString()?a.Text=t.ScreenObject.Data.Tables[23][0].Role.toString():"53531"==r[e].LinkData.toString()&&(a.Text=t.ScreenObject.Data.Tables[23][0].Status.toString()))},A=0;A<r.length;A++)P(A)}}}},{key:"FillLinkRefereceProducts",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";o.e.IsEmpty(e.ProductID_Key)||parseInt(e.ProductID_Key)==this.ScreenObject.TempProductID||(""!=a&&"23819"!=a||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:23819},"AvgRate"),""!=a&&"25398"!=a||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:25398},"QOH"),""!=a&&"52638"!=a||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:52638},"QOH"),""!=a&&"49"!=a||this.FillDatarow(e,t,null,{LinkData:49},"Loc_QOH"),""!=a&&"50"!=a||this.FillDatarow(e,t,null,{LinkData:50},"Div_QOH"),""!=a&&"52637"!=a||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:52637},"BalQOH"),""!=a&&"26421"!=a||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:26421},"HOLDQTY"),""!=a&&"50454"!=a||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:50454},"CommittedQty"),""!=a&&"26422"!=a||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:26422},"RESERVEQTY"),""!=a&&"499943"!=a||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:499943},"TotalReserve")),""!=a&&"23820"!=a||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:23820},"LastPurchaseRate"),""!=a&&"55479"!=a||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:55479},"LPRStockNonStock"),""!=a&&"24062"!=a||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:24062},"PWLastPRate"),""!=a&&"50051"!=a||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:50051},"LastPCost"),""!=a&&"23821"!=a||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:23821},"PWLastPCost"),""!=a&&"50494"!=a||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:50494},"UnitProductCode"),""!=a&&"50493"!=a||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:50493},"VendorProductCode"),""!=a&&"53736"!=a||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:53736},"VendorQty"),""!=a&&"55490"!=a||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:55490},"AvgPrice"),""!=a&&"55491"!=a||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:55491},"dp"),""!=a&&"55492"!=a||this.FillDatarow(e,t,null,{LocalReference:79,LinkData:55492},"rp"),this.FillSalesPurchase(e,t,n,-1,a),""!=a&&"277"!=a||this.FillDatarow(e,t,n,{LinkData:277},"ReorderQty"),""!=a&&"276"!=a||this.FillDatarow(e,t,n,{LinkData:276},"ReorderLevel")}},{key:"FillSalesPurchase",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";""!=i&&"22821"!=i||this.FillDatarow(e,t,n,{LinkData:22821},"SellingRate",a),""!=i&&"22793"!=i||this.FillDatarow(e,t,n,{LinkData:22793},"SellingRateA",a),""!=i&&"22794"!=i||this.FillDatarow(e,t,n,{LinkData:22794},"SellingRateB",a),""!=i&&"22795"!=i||this.FillDatarow(e,t,n,{LinkData:22795},"SellingRateC",a),""!=i&&"22796"!=i||this.FillDatarow(e,t,n,{LinkData:22796},"SellingRateD",a),""!=i&&"22797"!=i||this.FillDatarow(e,t,n,{LinkData:22797},"SellingRateE",a),""!=i&&"22798"!=i||this.FillDatarow(e,t,n,{LinkData:22798},"SellingRateF",a),""!=i&&"22799"!=i||this.FillDatarow(e,t,n,{LinkData:22799},"SellingRateG",a),""!=i&&"22820"!=i||this.FillDatarow(e,t,n,{LinkData:22820},"PurchaseRate",a),""!=i&&"22786"!=i||this.FillDatarow(e,t,n,{LinkData:22786},"PurchaseRateA",a),""!=i&&"22787"!=i||this.FillDatarow(e,t,n,{LinkData:22787},"PurchaseRateB",a),""!=i&&"22788"!=i||this.FillDatarow(e,t,n,{LinkData:22788},"PurchaseRateC",a),""!=i&&"22789"!=i||this.FillDatarow(e,t,n,{LinkData:22789},"PurchaseRateD",a),""!=i&&"22790"!=i||this.FillDatarow(e,t,n,{LinkData:22790},"PurchaseRateE",a),""!=i&&"22791"!=i||this.FillDatarow(e,t,n,{LinkData:22791},"PurchaseRateF",a),""!=i&&"22792"!=i||this.FillDatarow(e,t,n,{LinkData:22792},"PurchaseRateG",a)}},{key:"FillRates",value:function(e,t){var n=this,a=null;if(e.Tables.length>3&&e.Tables[3].length>0){a=e.Tables[3][0];var i=this.ScreenObject.ColumnSource.find((function(e){return"Rate"==e.DisplayMember}));o.e.IsEmpty(i.Formula)||!e.Columns[3].Contains(i.Formula)||o.e.IsEmpty(e.Tables[3][0][i.Formula])?1==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||10==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||31==this.ScreenObject.DocumentType?o.e.IsEmpty(e.Tables[3][0].PurchaseRate)||(t.Rate=e.Tables[3][0].PurchaseRate.toString(),t.defaultRate=e.Tables[3][0].PurchaseRate.toString()):o.e.IsEmpty(e.Tables[3][0].SellingRate)||(t.Rate=e.Tables[3][0].SellingRate.toString(),t.defaultRate=e.Tables[3][0].SellingRate.toString()):(t.Rate=e.Tables[3][0][i.Formula].toString(),t.defaultRate=e.Tables[3][0][i.Formula].toString())}if(this.FillLinkRefereceProducts(t,e.Tables[0],a),e.Tables.length>0&&e.Tables[0].length>0&&(t.UOMConversion=e.Tables[0][0].Conversion.toString(),o.e.IsEmpty(t.Quantity)||o.e.IsEmpty(e.Tables[0][0].Conversion)||!o.e.IsNum(e.Tables[0][0].Conversion)?o.e.IsEmpty(t.Quantity)||(t.UOMConvertedQty=t.Quantity.toString()):t.UOMConvertedQty=o.e.Double(e.Tables[0][0].Conversion)*parseFloat(t.Quantity)),e.Tables.length>10&&e.Columns[10].Contains("BinId")&&e.Tables[10].length>0&&e.Tables[10][0].BinId&&"0"!=e.Tables[10][0].BinId.toString()&&this.ScreenObject.Preferences.ContainsKey("BinsDimension")&&parseInt(this.ScreenObject.Preferences.BinsDimension)>5e4){var r=this.ScreenObject.ColumnSource.find((function(e){return e.CostCenterID==parseInt(n.ScreenObject.Preferences.BinsDimension)}));r&&this.ScreenObject.GridDataColumns.Contains(r.DisplayMember)&&(t[r.DisplayMember]=e.Tables[10][0].BinName.toString(),t[r.ValueMember]=e.Tables[10][0].BinId.toString())}}},{key:"OnProductUnitChange",value:function(e){var t=this;if(o.e.IsNum(e.Unit_Key)&&parseInt(e.Unit_Key)>0&&e.Unit_Key.toString()!=this.PrevValue){var n=this.ScreenObject.GetPriceofUnit(e.ProductID_Key.toString(),this.DocumentDate,parseInt(e.Unit_Key),e),a=0,i=0;if(n.Tables.length>0&&n.Tables[0].length>0){o.e.IsEmpty(n.Tables[0][0].Conversion)||(a=parseFloat(n.Tables[0][0].Conversion)),e.UOMConversion=a,o.e.IsEmpty(e.Quantity)||o.e.IsEmpty(n.Tables[0][0].Conversion)||!o.e.IsNum(n.Tables[0][0].Conversion)?o.e.IsEmpty(e.Quantity)||(e.UOMConvertedQty=e.Quantity.toString()):e.UOMConvertedQty=o.e.Double(n.Tables[0][0].Conversion)*parseFloat(e.Quantity);var r=this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&50494==e.LinkData}));if(r.length>0&&this.ScreenObject.GridDataColumns.Contains(r[0].SysColumnName)&&(o.e.IsEmpty(n.Columns[0].Contains("Barcode")&&n.Tables[0][0].Barcode)||(e[r[0].SysColumnName]=n.Tables[0][0].Barcode.toString())),n.Columns[0].Contains("Barcode_Key")&&!o.e.IsEmpty(n.Tables[0][0].Barcode_Key)&&this.ScreenObject.Preferences.ContainsKey("BarcodeDimension")&&""!=this.ScreenObject.Preferences.BarcodeDimension&&parseInt(this.ScreenObject.Preferences.BarcodeDimension)>0){var s=this.ScreenObject.ColumnSource.find((function(e){return e.CostCenterID==parseInt(t.ScreenObject.Preferences.BarcodeDimension)}));s&&(e[s.ValueMember]=n.Tables[0][0].Barcode_Key.toString(),e[s.DisplayMember]=n.Tables[0][0].Barcode.toString(),this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&e.LocalReference==s.ID})).length>0&&this.ScreenObject.GetLinkReferenceData(parseInt(s.ID),this.DocumentID,parseInt(e[s.ValueMember]),Date.Today(),"",s.CostCenterID,e))}}if(n.Tables.length>1&&n.Tables[1].length>0&&n.Columns[1].Contains("PurchaseRate")){var c=this.ScreenObject.ColumnSource.find((function(e){return"Rate"==e.DisplayMember}));o.e.IsEmpty(c.Formula)||!n.Columns[1].Contains(c.Formula)||o.e.IsEmpty(n.Tables[1][0][c.Formula])?1==this.ScreenObject.DocumentType||2==this.ScreenObject.DocumentType||3==this.ScreenObject.DocumentType||4==this.ScreenObject.DocumentType||10==this.ScreenObject.DocumentType||26==this.ScreenObject.DocumentType||27==this.ScreenObject.DocumentType||25==this.ScreenObject.DocumentType||34==this.ScreenObject.DocumentType||31==this.ScreenObject.DocumentType?o.e.IsEmpty(n.Tables[1][0].PurchaseRate)||(i=n.Columns[1].Contains("UOMID")?a*parseFloat(n.Tables[1][0].PurchaseRate):parseFloat(n.Tables[1][0].PurchaseRate),e.Rate=i.ToString("N"+c.DecimalPoints),e.defaultRate=i.ToString("N"+c.DecimalPoints)):o.e.IsEmpty(n.Tables[1][0].SellingRate)||(i=n.Columns[1].Contains("UOMID")?a*parseFloat(n.Tables[1][0].SellingRate):parseFloat(n.Tables[1][0].SellingRate),e.Rate=i.ToString("N"+c.DecimalPoints),e.defaultRate=i.ToString("N"+c.DecimalPoints)):(i=n.Columns[1].Contains("UOMID")?a*parseFloat(n.Tables[1][0][c.Formula]):parseFloat(n.Tables[1][0][c.Formula]),e.Rate=i.ToString("N"+c.DecimalPoints),e.defaultRate=i.ToString("N"+c.DecimalPoints))}this.FillSalesPurchase(e,n.Tables[1],n.Tables[1][0],a)}}},{key:"ValidateDataonSave_xml",value:function(e,t){var n=this;try{for(var a=0;a<this.ScreenObject._TextFields.length;a++){var i=this.ScreenObject._TextFields[a];this.fldDict.ContainsKey(i.Lbl)&&(i instanceof h.d?"FLOAT"==i.DataType?null!=i.Text&&""!=i.Text&&""==i.ValidateData()?this.fldDict[i.Lbl].setFieldValue(i.Text):this.fldDict[i.Lbl].setFieldValue(0):this.fldDict[i.Lbl].setFieldValue(i.Text):i instanceof m.e?this.fldDict[i.Lbl].setFieldValue(i.SelectedValue):i instanceof O.a?this.fldDict[i.Lbl].setFieldValue(i.Text):i instanceof C.b&&(i.SelectedValue>0&&!o.e.IsEmpty(i.Text)?this.fldDict[i.Lbl].setFieldValue(i.Text):this.fldDict[i.Lbl].setFieldValue("")))}for(var r=0;r<this.ScreenObject.ColumnSource.length;r++){var c=this.ScreenObject.ColumnSource[r];if(null!=c.Expression&&""!=c.Expression)for(var u=e.SelectNodes("xml/Row/xml"),d=0,D=function(e){var a=u[e];d++;var i=n.ScreenObject.ColumnSource,r=1;if(s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&null!=n.Currency&&null!=n.Currency.ExchangeRate.Text&&""!=n.Currency.ExchangeRate.Text&&(r=parseFloat(n.Currency.ExchangeRate.Text)),n.fldDict.forEach((function(e){var t=i.filter((function(t){return t.lbl==n.fldDict[e.Key].getFieldName()}));t.length>0&&"ComboBox"!=t[0].DataType&&"PactComboBox"!=t[0].DataType&&a.attributes[t[0].DisplayMember]&&!o.e.IsEmpty(a.attributes[t[0].DisplayMember].value)?o.e.IsNum(a.attributes[t[0].DisplayMember].value)?n.fldDict[e.Key].setFieldValue(null!=t[0].DecimalPoints&&""!=t[0].DecimalPoints?parseFloat(a.attributes[t[0].DisplayMember].value).ToString("N"+t[0].DecimalPoints):a.attributes[t[0].DisplayMember].value):n.fldDict[e.Key].setFieldValue(a.attributes[t[0].DisplayMember].value):e.Key.toLowerCase().startsWith("calc")?(t=i.filter((function(t){return t.lbl==n.fldDict[e.Key.substr(4)].getFieldName()}))).length>0&&"ComboBox"!=t[0].DataType&&"PactComboBox"!=t[0].DataType&&null!=a.attributes["dcCalc"+t[0].DisplayMember.replace("dc","")]&&""!=a.attributes["dcCalc"+t[0].DisplayMember.replace("dc","")].value&&(o.e.IsNum(a.attributes["dcCalc"+t[0].DisplayMember.replace("dc","")].value)?n.fldDict[e.Key].setFieldValue(null!=t[0].DecimalPoints&&""!=t[0].DecimalPoints?parseFloat(a.attributes["dcCalc"+t[0].DisplayMember.replace("dc","")].value).ToString("N"+t[0].DecimalPoints):a.attributes["dcCalc"+t[0].DisplayMember.replace("dc","")].value):n.fldDict[e.Key].setFieldValue(a.attributes["dcCalc"+t[0].DisplayMember.replace("dc","")].value)):n.fldDict[e.Key].setFieldValue(0)})),n.IsInventoryVoucher&&(n.fldDict.RATE.setFieldValue(null!=a.attributes.Rate&&""!=a.attributes.Rate.value?a.attributes.Rate.value:0),n.fldDict.QTY.setFieldValue(null!=a.attributes.Quantity&&""!=a.attributes.Quantity.value?a.attributes.Quantity.value:0),n.fldDict.GROSS.setFieldValue(null!=a.attributes.Gross&&""!=a.attributes.Gross.value?a.attributes.Gross.value:0),n.fldDict.CONVQTY.setFieldValue(null!=a.attributes.UOMConvertedQty&&""!=a.attributes.UOMConvertedQty.value?a.attributes.UOMConvertedQty.value:0),n.fldDict.UOMCONVERSION.setFieldValue(null!=a.attributes.UOMConversion&&""!=a.attributes.UOMConversion.value?a.attributes.UOMConversion.value:0),n.fldDict.AVGRT.setFieldValue(null!=a.attributes.AVGRATE&&""!=a.attributes.AVGRATE.value?a.attributes.AVGRATE.value:0),n.fldDict.QOH.setFieldValue(null!=a.attributes.QOH&&""!=a.attributes.QOH.value?a.attributes.QOH.value:0),n.fldDict.BalQOH.setFieldValue(null!=a.attributes.BalQOH&&""!=a.attributes.BalQOH.value?a.attributes.BalQOH.value:0),n.fldDict.HOLDQTY.setFieldValue(null!=a.attributes.HOLDQTY&&""!=a.attributes.HOLDQTY.value?a.attributes.HOLDQTY.value:0),n.fldDict.CommittedQty.setFieldValue(null!=a.attributes.CommittedQty&&""!=a.attributes.CommittedQty.value?a.attributes.CommittedQty.value:0),n.fldDict.RESERVEQTY.setFieldValue(null!=a.attributes.RESERVEQTY&&""!=a.attributes.RESERVEQTY.value?a.attributes.RESERVEQTY.value:0),n.fldDict.TotalReserve.setFieldValue(null!=a.attributes.TotalReserve&&""!=a.attributes.TotalReserve.value?a.attributes.TotalReserve.value:0)),n.fldDict.EXCHRT.setFieldValue(r),"1"==s.a.eval.EvaluateExpression(c.Expression,n.fldDict).toString().toString()&&(1==c.Action||3==c.Action||4==c.Action)){var D=c.Message;if(D=(D=c.Message.replace("[ROWNO]",null!=a.attributes.DocSeqNo&&""!=a.attributes.DocSeqNo.value?a.attributes.DocSeqNo.value:d.toString())).replace("[ProductCode]",null!=a.attributes.ProductCode&&""!=a.attributes.ProductCode.value?a.attributes.ProductCode.value:""),D+=" For Dynamic set at Row No:"+n.ScreenObject.GridData[t].DocSeqNo.toString(),alert(D),3==c.Action||4==c.Action)return{v:!1}}},S=0;S<u.length;S++){var b=D(S);if("object"==typeof b)return b.v}}}catch(y){if("Cannot set Visibility or call Show, ShowDialog, or WindowInteropHelper.EnsureHandle after a Window has closed."==y)return!1}return!0}},{key:"ValidateDataonSave",value:function(){try{for(var e=this.GetColName(),t=0;t<this.ScreenObject.ColumnSource.length;t++)if(!(this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase().Contains("exchangerate")||"AppRemarks"==this.ScreenObject.ColumnSource[t].DisplayMember||"FreeQTY"==this.ScreenObject.ColumnSource[t].DisplayMember||this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase().Contains("currencyid")||this.ScreenObject.ColumnSource[t].CostCenterID>0&&"ProductCode"!=this.ScreenObject.ColumnSource[t].DisplayMember&&this.ScreenObject.ColumnSource[t].DisplayMember.endsWith("Code")||o.e.IsEmpty(this.ScreenObject.ColumnSource[t].Expression)||5!=this.ScreenObject.ColumnSource[t].Action)){for(var n="",a="",i=0;i<this.ScreenObject.GridData.length;i++)o.e.IsEmpty(this.ScreenObject.GridData[i][e])||(this.FillDictionary(this.ScreenObject.GridData[i],!1),"1"==s.a.eval.EvaluateExpression(this.ScreenObject.ColumnSource[t].Expression,this.fldDict).toString().toString()&&(n+=this.ScreenObject.GridData[i].DocSeqNo.toString()+",",this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(a+=this.ScreenObject.GridData[i].ProductCode.toString())));if(n.length>1){var r=this.ScreenObject.ColumnSource[t].Message.replace("[ROWNO]",n.substr(0,n.length-1));if(r=r.replace("[ProductCode]",a),!confirm(r))return!1}}}catch(c){if(alert("SaveError"),"Cannot set Visibility or call Show, ShowDialog, or WindowInteropHelper.EnsureHandle after a Window has closed."==c.message)return!1}return!0}},{key:"ValidateDataonSave_col_dr",value:function(e,t){try{if(null!=e.Expression&&""!=e.Expression){if(this.FillDictionary(t,!1),"1"==s.a.eval.EvaluateExpression(e.Expression,this.fldDict).toString().toString()&&(1==e.Action||3==e.Action||4==e.Action)){var n=e.Message.replace("[ROWNO]",t.DocSeqNo.toString());if(this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(n=n.replace("[ProductCode]",t.ProductCode.toString())),this.ScreenObject.Preferences.tempWarningMsg=s.a.SessionManager.IsWebApplication?n:null,alert(n),3==e.Action||4==e.Action)return!1}}else if(4!=e.EditOption||3!=e.Action&&4!=e.Action){if(5==e.EditOption&&(3==e.Action||4==e.Action))for(var a=this.GetPrimaryColName(),i=null,r=0;r<this.ScreenObject.GridData.length;r++)if(!o.e.IsEmpty(this.ScreenObject.GridData[r][a]))if(null==i)i=this.ScreenObject.GridData[r][e.DisplayMember].toString();else if(i!=this.ScreenObject.GridData[r][e.DisplayMember].toString()){var c=e.Message.replace("[ROWNO]",t.DocSeqNo.toString());return this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(c=c.replace("[ProductCode]",t.ProductCode.toString())),alert(c),!1}}else for(var l=this.GetPrimaryColName(),u=[],d=0;d<this.ScreenObject.GridData.length;d++)if(!o.e.IsEmpty(this.ScreenObject.GridData[d][l])&&!o.e.IsEmpty(this.ScreenObject.GridData[d][e.DisplayMember])){if(u.Contains(this.ScreenObject.GridData[d][e.DisplayMember].toString())){var D=e.Message.replace("[ROWNO]",t.DocSeqNo.toString());return this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(D=D.replace("[ProductCode]",t.ProductCode.toString())),alert(D),!1}u.push(this.ScreenObject.GridData[d][e.DisplayMember].toString())}}catch(h){if("Cannot set Visibility or call Show, ShowDialog, or WindowInteropHelper.EnsureHandle after a Window has closed."==h)return!1}return!0}},{key:"ValidateDataonSave_Ctrl",value:function(e){try{if(null!=e.Expression&&""!=e.Expression){var t=s.a.eval.EvaluateExpression(e.Expression,this.fldDict).toString();if("1"!=t.toString()||1!=e.Action&&3!=e.Action&&4!=e.Action){if("1"==t.toString()&&5==e.Action&&!confirm(e.Message))return!1}else if(alert(e.Message),3==e.Action||4==e.Action)return!1}}catch(n){}return!0}},{key:"ValidateDate",value:function(e){try{if(!o.e.IsEmpty(e.Expression)){this.FillDictionary(null,!1);var t=s.a.eval.EvaluateExpression(e.Expression,this.fldDict).toString();"1"!=o.e.String(t)||1!=e.Action&&3!=e.Action&&4!=e.Action||alert(e.Message)}}catch(n){}}},{key:"NumFieldEditOptionValidation",value:function(e,t){if(e){if(1==e.EditOption&&this.ScreenObject.GridDataColumns.Contains("default"+e.DisplayMember)){if(!o.e.IsEmpty(t["default"+e.DisplayMember])&&!o.e.IsEmpty(t[e.DisplayMember])&&parseFloat(t["default"+e.DisplayMember])>parseFloat(t[e.DisplayMember]))throw alert("Can not decrease value less than "+t["default"+e.DisplayMember].toString()),new Error("PactException")}else if(2==e.EditOption&&this.ScreenObject.GridDataColumns.Contains("default"+e.DisplayMember)&&!o.e.IsEmpty(t["default"+e.DisplayMember])&&!o.e.IsEmpty(t[e.DisplayMember])&&parseFloat(t["default"+e.DisplayMember])<parseFloat(t[e.DisplayMember]))throw alert("Can not increase value greater than "+t["default"+e.DisplayMember].toString()),new Error("PactException");if("Quantity"==e.DisplayMember&&"Quantity"==o.e.String(t.LinkedFieldName)&&0==this.ScreenObject.DocID&&!o.e.IsEmpty(t.LinkedInvDocDetailsID)&&parseInt(t.LinkedInvDocDetailsID)>0&&(!this.ScreenObject.Preferences.ContainsKey("DisableQtyCheck")||!Object(l.j)(this.ScreenObject.Preferences.DisableQtyCheck))){var n=Object(l.j)(this.ScreenObject.Preferences.Enabletolerance);if(!o.e.IsEmpty(t["default"+e.DisplayMember])&&!o.e.IsEmpty(t[e.DisplayMember]))if(n&&o.e.Double(t.TolPer)>0){if(parseFloat(t["default"+e.DisplayMember])+parseFloat(t.TolPer)<parseFloat(t[e.DisplayMember]))throw alert("Can not enter more than source document quantity :"+(parseFloat(t["default"+e.DisplayMember])+parseFloat(t.TolPer))),new Error("PactException")}else if(n&&o.e.Double(t.TolVal)>0){if(parseFloat(t["default"+e.DisplayMember])+parseFloat(t.TolVal)<parseFloat(t[e.DisplayMember]))throw alert("Can not enter more than source document quantity :"+(parseFloat(t["default"+e.DisplayMember])+parseFloat(t.TolVal))),new Error("PactException")}else if(parseFloat(t["default"+e.DisplayMember])<parseFloat(t[e.DisplayMember]))throw alert("Can not enter more than source document quantity :"+t["default"+e.DisplayMember].toString()),new Error("PactException")}}}},{key:"ValidateFooterDataonSave",value:function(e){try{if(this.ScreenObject.FooterGridDataColumns.Contains("Expression")&&this.ScreenObject.FooterGridDataColumns.Contains("Action")&&this.ScreenObject.FooterGridDataColumns.Contains("Message")&&!o.e.IsEmpty(e.Expression)){var t=this.FooterDics;if("1"==s.a.eval.EvaluateExpression(e.Expression.toString(),t).toString()&&("1"==e.Action.toString()||"3"==e.Action.toString()||"4"==e.Action.toString())&&(alert(e.Message.toString()),"3"==e.Action.toString()||"4"==e.Action.toString()))return!1}}catch(n){}return!0}},{key:"ValidateFooterData",value:function(e){try{if(this.ScreenObject.FooterGridDataColumns.Contains("Expression")&&this.ScreenObject.FooterGridDataColumns.Contains("Action")&&this.ScreenObject.FooterGridDataColumns.Contains("Message")&&!o.e.IsEmpty(e.Expression)){var t=this.FooterDics,n=s.a.eval.EvaluateExpression(e.Expression.toString(),t);"1"!=o.e.String(n)||"2"!=o.e.String(e.Action)&&"4"!=o.e.String(e.Action)||(alert(e.Message),"4"==o.e.String(e.Action)&&(e.Amount=null,this.CalculateTotals(e,!1)))}}catch(a){}}},{key:"ValidateData_Column",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{if(n)return!!o.e.IsEmpty(e.ExternExpression)||"1"==s.a.eval.EvaluateExpression(e.ExternExpression,this.fldDict).toString().toString();if(this.IsInventoryVoucher&&!o.e.IsEmpty(t.ProductID_Key)&&"8"==o.e.String(t.Type))return!1;if(o.e.IsEmpty(e.Expression)){if(4!=e.EditOption||2!=e.Action&&4!=e.Action){if(5==e.EditOption&&(2==e.Action||4==e.Action))for(var a=this.GetPrimaryColName(),i=null,r=0;r<this.ScreenObject.GridData.length;r++)if(!o.e.IsEmpty(this.ScreenObject.GridData[r][a]))if(null==i)i=this.ScreenObject.GridData[r][e.DisplayMember].toString();else if(i!=this.ScreenObject.GridData[r][e.DisplayMember].toString()){var c=e.Message.replace("[ROWNO]",t.DocSeqNo.toString());return this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(c=c.replace("[ProductCode]",t.ProductCode.toString())),alert(c),!1}}else for(var l=this.GetPrimaryColName(),u=[],d=0;d<this.ScreenObject.GridData.length;d++)if(!o.e.IsEmpty(this.ScreenObject.GridData[d][l])&&!o.e.IsEmpty(this.ScreenObject.GridData[d][e.DisplayMember])){if(u.Contains(this.ScreenObject.GridData[d][e.DisplayMember].toString())){var D=e.Message.replace("[ROWNO]",t.DocSeqNo.toString());return this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(D=D.replace("[ProductCode]",t.ProductCode.toString())),alert(D),!1}u.push(this.ScreenObject.GridData[d][e.DisplayMember].toString())}}else if("1"==s.a.eval.EvaluateExpression(e.Expression,this.fldDict).toString().toString()&&(2==e.Action||4==e.Action)){var h=e.Message.replace("[ROWNO]",t.DocSeqNo.toString());if(this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(h=h.replace("[ProductCode]",t.ProductCode.toString())),alert(h),4==e.Action)throw this.CalculateTotals(t,!1),new Error("PactException")}}catch(S){if("PactException"==S.message)throw new Error("PactException")}return!1}},{key:"ValidateDataCallBack",value:function(e){return this.ValidateData(e.sender,e.IsExternal)}},{key:"ValidateData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{if(t)return!!o.e.IsEmpty(e.ExternExpression)||"1"==s.a.eval.EvaluateExpression(e.ExternExpression,this.fldDict).toString().toString();o.e.IsEmpty(e.Expression)||"1"!=s.a.eval.EvaluateExpression(e.Expression,this.fldDict).toString().toString()||2!=e.Action&&4!=e.Action||alert(e.Message)}catch(n){}return!1}},{key:"Fill",value:function(e,t,n,a){var i=this,r="",u="",d=0;if(t<4){if(d=o.e.Int(s.a.SessionManager.Preferences["PMLevel"+t.toString()+"Dimension"]),!(s.a.SessionManager.Preferences.ContainsKey("PMLevel"+t.toString()+"Dimension")&&d>0&&this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(d-5e4)+"_Key")))return void this.Fill(e,t+1,n,a);for(r="dcCCNID"+(d-5e4)+"_Key",d=t+1;d<5;){if(4==d&&s.a.SessionManager.Preferences.ContainsKey("PMTaskDimension")&&""!=s.a.SessionManager.Preferences.PMTaskDimension&&"0"!=s.a.SessionManager.Preferences.PMTaskDimension){u="dcCCNID"+(parseInt(s.a.SessionManager.Preferences.PMTaskDimension)-5e4)+"_Key";break}if(s.a.SessionManager.Preferences.ContainsKey("PMLevel"+d.toString()+"Dimension")&&""!=s.a.SessionManager.Preferences["PMLevel"+d.toString()+"Dimension"]&&"0"!=s.a.SessionManager.Preferences["PMLevel"+d.toString()+"Dimension"]&&this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(parseInt(s.a.SessionManager.Preferences["PMLevel"+d.toString()+"Dimension"])-5e4)+"_Key")){u="dcCCNID"+(parseInt(s.a.SessionManager.Preferences["PMLevel"+d.toString()+"Dimension"])-5e4)+"_Key";break}d++}}else{if(4!=t)return;if(!s.a.SessionManager.Preferences.ContainsKey("PMTaskDimension")||!o.e.IsNum(s.a.SessionManager.Preferences.PMTaskDimension))return;d=parseInt(s.a.SessionManager.Preferences.PMTaskDimension),r="dcCCNID"+(d-5e4)+"_Key"}for(var D,h,S=new c.a,m=null,b=null,C=null,y=null,p=null,g=0,f=0,O=0,I=0,T=0,j=0,P=0,A=0;A<e.length;A++)!o.e.IsEmpty(e[A].ProductID_Key)&&!o.e.IsEmpty(e[A][r])&&parseInt(e[A][r])>1?(4==t?g++:S.ContainsKey(e[A][r].toString())||S.push(e[A][r].toString(),S.length+1),a&&(!o.e.IsEmpty(e[A].DocDetailsID)&&parseInt(e[A].DocDetailsID)>0||(e[A].dcAlpha11=4==t?e[A].dcAlpha11.toString()+"."+g.toString():e[A].dcAlpha11.toString()+"."+S[e[A][r].toString()].toString())),o.e.isValidDate(e[A].dcAlpha15_Key)&&(!b||D<b)&&(b=new Date(e[A].dcAlpha15_Key)),o.e.isValidDate(e[A].dcAlpha16_Key)&&(!C||D>C)&&(C=new Date(e[A].dcAlpha16_Key)),o.e.isValidDate(e[A].dcAlpha22_Key)&&(!y||D<y)&&(y=D),o.e.isValidDate(e[A].dcAlpha23_Key)&&(!p||D>p)&&(p=D),(h=o.e.Int(e[A].dcAlpha18))>0&&(4!=t&&(""==u||""!=o.e.String(e[A][u])&&"1"!=o.e.String(e[A][u]))||(P+=h),e[A].dcAlpha14=null!=m&&o.e.IsNum(m.dcAlpha14)?o.e.Double(m.dcAlpha14)*h/100:h),4!=t&&(""==u||""!=o.e.String(e[A][u])&&"1"!=o.e.String(e[A][u]))||((f=o.e.Double(e[A].dcAlpha31))>0&&(O+=f),(f=o.e.Double(e[A].dcAlpha32))>0&&(I+=f),(f=o.e.Double(e[A].dcAlpha33))>0&&(T+=f),(f=o.e.Double(e[A].dcAlpha34))>0&&(j+=f))):null!=m||o.e.IsEmpty(e[A].ProductID_Key)||(m=e[A]);if(P>100&&(this.DisplayMessage="Percentage exceeds 100"),null!=m){if(b&&(m.dcAlpha15=b.ToString(s.a.SessionManager.Preferences["Date Format"]+" hh:mm tt"),m.dcAlpha15_Key=b),C&&(m.dcAlpha16=C.ToString(s.a.SessionManager.Preferences["Date Format"]+" hh:mm tt"),m.dcAlpha16_Key=C),y&&(m.dcAlpha22=y.ToString(s.a.SessionManager.Preferences["Date Format"]+" hh:mm tt"),m.dcAlpha22_Key=y),p&&(m.dcAlpha23=p.ToString(s.a.SessionManager.Preferences["Date Format"]+" hh:mm tt"),m.dcAlpha23_Key=p),null!=this.dsProjWOffHol){var M=!1;if(this.ScreenObject.Preferences.ContainsKey("ConsiderWeeklyOffsAndHolidays")&&!o.e.IsEmpty(this.ScreenObject.Preferences.ConsiderWeeklyOffsAndHolidays)&&(M=Object(l.j)(this.ScreenObject.Preferences.ConsiderWeeklyOffsAndHolidays)),this.ScreenObject.GridDataColumns.Contains("dcAlpha15_Key")&&!o.e.IsEmpty(m.dcAlpha15_Key)&&this.ScreenObject.GridDataColumns.Contains("dcAlpha16_Key")&&!o.e.IsEmpty(m.dcAlpha16_Key)){var v=0,G=0,N={odWHrs:v,odHrsPerDay:G},E=o.e.GetNoOfDays(this.dsProjWOffHol,new Date(m.dcAlpha15_Key),new Date(m.dcAlpha16_Key),M,m,this.DocumentDate,N);v=N.odWHrs,G=N.odHrsPerDay,m.dcAlpha17=E.toString()}if(this.ScreenObject.GridDataColumns.Contains("dcAlpha22_Key")&&!o.e.IsEmpty(m.dcAlpha22_Key)&&this.ScreenObject.GridDataColumns.Contains("dcAlpha23_Key")&&!o.e.IsEmpty(m.dcAlpha23_Key)){var w=0,F=0,V={odWHrs:w,odHrsPerDay:F},L=o.e.GetNoOfDays(this.dsProjWOffHol,new Date(m.dcAlpha22_Key),new Date(m.dcAlpha23_Key),M,m,this.DocumentDate,V);w=V.odWHrs,F=V.odHrsPerDay,m.dcAlpha24=L.toString()}}m.dcAlpha31=O,m.dcAlpha32=I,m.dcAlpha33=T,m.dcAlpha34=j}for(var R=function(s){i.Fill(e.filter((function(e){return e[r]==S.keys[s]})),t+1,n,a)},B=0;B<S.keys.length;B++)R(B)}},{key:"EditProjectDim",value:function(e){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var a,i,r,c,l,u,d,D;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(s.a.SessionManager.Preferences.ContainsKey("ProjectManagementDimension")&&""!=s.a.SessionManager.Preferences.ProjectManagementDimension&&"0"!=s.a.SessionManager.Preferences.ProjectManagementDimension&&!o.e.IsEmpty(e.DocDetailsID)&&parseInt(e.DocDetailsID)>0)){t.next=12;break}return a=parseInt(s.a.SessionManager.Preferences.ProjectManagementDimension),i="dcCCNID"+(a-5e4),r=this.ScreenObject.GetProjectByINVID(e.DocDetailsID.toString(),i),t.next=4,n.e(0).then(n.bind(null,"Upsa"));case 4:return c=t.sent,l=c.AddEditCostcenterComponent,t.next=8,Promise.all([n.e(4),n.e(6),n.e(8),n.e(11),n.e(54),n.e(71)]).then(n.bind(null,"2pkr"));case 8:u=t.sent,d=u.AddCostCenterViewModel,(D=new d(a)).AddCostCenterViewModel_1(r,a,0,"",!1),s.a.page.addNewTab({title:this.ScreenName,component:l,params:{obj:D}});case 12:case"end":return t.stop()}}),t,this)})))}},{key:"GenerateDoc",value:function(e){if(!o.e.IsEmpty(e.DocDetailsID)&&parseInt(e.DocDetailsID)>0&&this.ScreenObject.Data.Tables.length>20){var t=this.ScreenObject.Data.Tables[20].filter((function(e){return e.CostCenterIDBase>4e4}));if(1==t.length)this.GenerateDocfromProject(parseInt(t[0].CostCenterIDBase));else if(t.length>1){var n=new q.a;n.GoToLineViewModel_3(this,t,0),s.a.page.ShowDialog(n,Y.a,{ShowCenter:!0,NoWidth:!0})}}}},{key:"GenerateDocfromProject",value:function(e){for(var t=this,n=0,i=parseInt(s.a.SessionManager.Preferences.ProjectManagementDimension),r="dcCCNID"+(i-5e4),c=this.ScreenObject.GetProjectByINVID(this.SelectedRow.DocDetailsID.toString(),r),l=new a(e,"",!1,this),u=0;u<l.ScreenObject._CCFields.length;u++){var d=l.ScreenObject._CCFields[u];if(d instanceof C.b)if(d.CCID==i)d.SelectedValue=c;else{n=d.CCID;var D=this.ScreenObject._CCFields.find((function(e){return e instanceof C.b&&e.CCID==n}));D instanceof C.b&&D.SelectedValue>0?d.SelectedValue=D.SelectedValue:this.ScreenObject.GridDataColumns.Contains("dcCCNID"+(n-5e4))&&!o.e.IsEmpty(this.SelectedRow["dcCCNID"+(n-5e4)+"_Key"])&&(d.SelectedValue=parseInt(this.SelectedRow["dcCCNID"+(n-5e4)+"_Key"]))}}if(s.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==s.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&l.ScreenObject.FillListViews(!1),33==l.DocumentType||34==l.DocumentType){if(null!=l.ScreenObject.Link){var h=l.ScreenObject.Link.LinkCombo.Items.find((function(e){return null!=e.Parent&&"158"==e.Parent}));h&&(l.ScreenObject.Link.LinkCombo.SelectedValue=h.Value,l.OLinkSelectionChanged(null))}if(this.ScreenObject.Preferences.ContainsKey("jobCCID")&&""!=this.ScreenObject.Preferences.jobCCID.toString()&&parseInt(this.ScreenObject.Preferences.jobCCID)>5e4&&this.ScreenObject.Preferences.ContainsKey("StageCCID")&&""!=this.ScreenObject.Preferences.StageCCID.toString()&&parseInt(this.ScreenObject.Preferences.StageCCID)>5e4&&this.ScreenObject.Preferences.ContainsKey("BomCCID")&&""!=this.ScreenObject.Preferences.BomCCID.toString()&&parseInt(this.ScreenObject.Preferences.BomCCID)>5e4){var S=this.ScreenObject._CCFields.find((function(e){return e instanceof C.b&&e.CCID==parseInt(t.ScreenObject.Preferences.jobCCID)})),m=0,b=0,y=0;if(r="dcCCNID"+(parseInt(this.ScreenObject.Preferences.StageCCID)-5e4)+"_Key",this.ScreenObject.GridDataColumns.Contains(r)&&!o.e.IsEmpty(this.SelectedRow[r])&&(y=parseInt(this.SelectedRow[r])),r="dcCCNID"+(parseInt(this.ScreenObject.Preferences.BomCCID)-5e4)+"_Key",this.ScreenObject.GridDataColumns.Contains(r)&&!o.e.IsEmpty(this.SelectedRow[r])&&(m=parseInt(this.SelectedRow[r])),S&&S.SelectedValue>0&&m>0&&y>0){var p=l.ScreenObject.Link.DocumentList.Items.find((function(e){return e.Value==S.SelectedValue.toString()}));if(p){p.IsChecked=!0;var g=new W.a(l,S.Text,parseInt(l.ScreenObject.Link.LinkCombo.SelectedValue),S.SelectedValue,!1),f=g.ds.Tables[0].filter((function(e){return e.CCNodeID==m}));f.length>0&&(m=parseInt(f[0].BomID)),(o.e.IsEmpty(g.Boms.SelectedValue)||g.Boms.SelectedValue!=m.toString())&&(g.Boms.SelectedValue=m.toString(),g.onBomChanged(g.Boms.SelectedValue)),g.Boms.SelectedItem=g.Boms.GetselectedItem(),(f=g.ds.Tables[3].filter((function(e){return e.BOMID==m&&e.StageNodeID==y}))).length>0&&(b=parseInt(f[0].StageID)),(o.e.IsEmpty(g.Stages.SelectedValue)||g.Stages.SelectedValue!=b.toString())&&(g.Stages.SelectedValue=b.toString(),g.FillJobProducts()),g.Stages.SelectedItem=g.Stages.GetselectedItem(),g.GridData.forEach((function(e){o.e.IsEmpty(e.Select)||(e.Select=!0)})),g.OnSave("Add"),g.OnSave("OKNoClose")}}}}s.a.page.addNewTab({component:x.AddEditDocumentComponent,params:{obj:l}})}},{key:"FillWBS",value:function(e){var t,n="";if(s.a.SessionManager.Preferences.ContainsKey("ProjectManagementDimension")&&o.e.IsNum(s.a.SessionManager.Preferences.ProjectManagementDimension)){t=parseInt(s.a.SessionManager.Preferences.ProjectManagementDimension);var a=this.ScreenObject._TextFields.find((function(e){return e instanceof C.b&&e.CCID==t}));a&&a.SelectedValue>0&&(n=this.ScreenObject.GetDocNumberString("Code",t,a.SelectedValue))}for(var i=0;i<this.ScreenObject.GridData.length;i++)o.e.IsEmpty(this.ScreenObject.GridData[i].ProductID_Key)||!o.e.IsEmpty(this.ScreenObject.GridData[i].DocDetailsID)&&parseInt(this.ScreenObject.GridData[i].DocDetailsID)>0||(this.ScreenObject.GridData[i].dcAlpha11=n);for(this.Fill(this.ScreenObject.GridData,1,e,!0),t=1;t<4&&s.a.SessionManager.Preferences.ContainsKey("PMLevel"+t.toString()+"Dimension")&&!o.e.IsEmpty(s.a.SessionManager.Preferences["PMLevel"+t.toString()+"Dimension"])&&"0"!=s.a.SessionManager.Preferences["PMLevel"+t.toString()+"Dimension"]&&this.ScreenObject.GridDataColumns.Contains("dcccnid"+(parseInt(s.a.SessionManager.Preferences["PMLevel"+t.toString()+"Dimension"])-5e4)+"_Key");)this.Fill(this.ScreenObject.GridData,1,e,!1),t++}},{key:"FillHeaderDictionary",value:function(){var e=this;this.ScreenObject._CCFields.forEach((function(t){e.fldDict.ContainsKey(t.Lbl)&&(t instanceof C.b&&t.SelectedValue>0&&!o.e.IsEmpty(t.Text)||t instanceof p.a&&t.SelectedValue>0&&!o.e.IsEmpty(t.Text)?e.fldDict[t.Lbl].setFieldValue(t.Text):e.fldDict[t.Lbl].setFieldValue(""),e.FooterDics.ContainsKey(t.Lbl)&&e.FooterDics[t.Lbl].setFieldValue(e.fldDict[t.Lbl].fieldResult))})),this.ScreenObject.HeaderFields.forEach((function(t){t instanceof y.c&&!o.e.IsEmpty(t.Lbl)&&e.fldDict.ContainsKey(t.Lbl)&&(t instanceof h.d?"FLOAT"==t.DataType?null!=t.Text&&""!=t.Text&&""==t.ValidateData()?e.fldDict[t.Lbl].setFieldValue(t.Text):e.fldDict[t.Lbl].setFieldValue(0):e.fldDict[t.Lbl].setFieldValue(t.Text):t instanceof m.e?e.fldDict[t.Lbl].setFieldValue(t.SelectedValue):t instanceof O.a?e.fldDict[t.Lbl].setFieldValue(t.Text):t instanceof S.c&&t.Date?e.fldDict[t.Lbl].setFieldValue(t.Date):t instanceof C.b&&(t.SelectedValue>0&&!o.e.IsEmpty(t.Text)?e.fldDict[t.Lbl].setFieldValue(t.Text):e.fldDict[t.Lbl].setFieldValue("")),e.FooterDics.ContainsKey(t.Lbl)&&e.FooterDics[t.Lbl].setFieldValue(e.fldDict[t.Lbl].fieldResult))})),this.ScreenObject._TextFields.forEach((function(t){e.fldDict.ContainsKey(t.Lbl)&&(t instanceof h.d?"FLOAT"==t.DataType?null!=t.Text&&""!=t.Text&&""==t.ValidateData()?e.fldDict[t.Lbl].setFieldValue(t.Text):e.fldDict[t.Lbl].setFieldValue(0):e.fldDict[t.Lbl].setFieldValue(t.Text):t instanceof m.e?e.fldDict[t.Lbl].setFieldValue(t.SelectedValue):t instanceof O.a?e.fldDict[t.Lbl].setFieldValue(t.Text):t instanceof S.c&&t.Date||t instanceof S.b&&t.Date?e.fldDict[t.Lbl].setFieldValue(t.Date):t instanceof C.b&&(t.SelectedValue>0&&!o.e.IsEmpty(t.Text)?e.fldDict[t.Lbl].setFieldValue(t.Text):e.fldDict[t.Lbl].setFieldValue("")),e.FooterDics.ContainsKey(t.Lbl)&&e.FooterDics[t.Lbl].setFieldValue(e.fldDict[t.Lbl].fieldResult))})),null!=this.ScreenObject.DebitAccount&&this.fldDict.ContainsKey(this.ScreenObject.DebitAccount.Lbl)&&(this.ScreenObject.DebitAccount.SelectedValue>0&&this.ScreenObject.DebitAccount.Name.Visible&&!o.e.IsEmpty(this.ScreenObject.DebitAccount.Name.Text)?this.fldDict[this.ScreenObject.DebitAccount.Lbl].setFieldValue(this.ScreenObject.DebitAccount.Name.Text):this.ScreenObject.DebitAccount.SelectedValue>0&&this.ScreenObject.DebitAccount.Code.Visible&&!o.e.IsEmpty(this.ScreenObject.DebitAccount.Code.Text)?this.fldDict[this.ScreenObject.DebitAccount.Lbl].setFieldValue(this.ScreenObject.DebitAccount.Code.Text):this.fldDict[this.ScreenObject.DebitAccount.Lbl].setFieldValue("")),null!=this.ScreenObject.CreditAccount&&this.fldDict.ContainsKey(this.ScreenObject.CreditAccount.Lbl)&&(this.ScreenObject.CreditAccount.SelectedValue>0&&this.ScreenObject.CreditAccount.Name.Visible&&!o.e.IsEmpty(this.ScreenObject.CreditAccount.Name.Text)?this.fldDict[this.ScreenObject.CreditAccount.Lbl].setFieldValue(this.ScreenObject.CreditAccount.Name.Text):this.ScreenObject.CreditAccount.SelectedValue>0&&this.ScreenObject.CreditAccount.Code.Visible&&!o.e.IsEmpty(this.ScreenObject.CreditAccount.Code.Text)?this.fldDict[this.ScreenObject.CreditAccount.Lbl].setFieldValue(this.ScreenObject.CreditAccount.Code.Text):this.fldDict[this.ScreenObject.CreditAccount.Lbl].setFieldValue("")),this.fldDict.DOCDATE.setFieldValue(this.DocumentDate),null==this.ScreenObject.DocPrefix||null==this.ScreenObject.DocPrefix.ComboBox||o.e.IsEmpty(this.ScreenObject.DocPrefix.ComboBox.Text)?this.fldDict.DocPrefix.setFieldValue(""):this.fldDict.DocPrefix.setFieldValue(this.ScreenObject.DocPrefix.ComboBox.Text),this.fldDict.DUEDATE.setFieldValue(null!=this.ScreenObject.DueDate&&this.ScreenObject.DueDate.Date?this.ScreenObject.DueDate.Date:Date.Today());var t=this.ScreenObject._StaticFields.find((function(e){return"billdate"==e.DBColumnName.toLowerCase()}));this.fldDict.BILLDATE.setFieldValue(t&&t instanceof S.c&&t.Date?t.Date:Date.Today());var n=this.ScreenObject._StaticFields.find((function(e){return"chequematuritydate"==e.DBColumnName.toLowerCase()}));this.fldDict.MaturityDate.setFieldValue(n&&n instanceof S.c&&n.Date?n.Date:Date.Today()),this.FooterDics.ContainsKey("BILLDATE")&&this.FooterDics.BILLDATE.setFieldValue(this.fldDict.BILLDATE.fieldResult),this.FooterDics.ContainsKey("DUEDATE")&&this.FooterDics.DUEDATE.setFieldValue(this.fldDict.DUEDATE.fieldResult),this.FooterDics.ContainsKey("DOCDATE")&&this.FooterDics.DOCDATE.setFieldValue(this.fldDict.DOCDATE.fieldResult)}},{key:"FillDictionary",value:function(e,t){var n=this,a=this.ScreenObject.ColumnSource,i=1;s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&(this.Currency&&null!=this.Currency.ExchangeRate.Text&&""!=this.Currency.ExchangeRate.Text?i=parseFloat(this.Currency.ExchangeRate.Text):null!=e&&this.ScreenObject.GridDataColumns.Contains("ExchangeRate")&&!o.e.IsEmpty(e.ExchangeRate)&&(i=parseFloat(e.ExchangeRate))),null!=e&&(this.fldDict.keys.forEach((function(r){var s={Key:r,Value:n.fldDict[r]};if("ServerDate"!=s.Key){var c=a.filter((function(e){return e.lbl==n.fldDict[s.Key].getFieldName()}));if(c.length>0&&"ComboBox"==c[0].DataType&&null!=e[c[0].ValueBinding]&&!o.e.IsEmpty(e[c[0].ValueBinding]))n.fldDict[s.Key].setFieldValue(e[c[0].ValueBinding]);else if(c.length>0&&"PactComboBox"==c[0].DataType&&null!=e[c[0].ValueBinding+"_Key"]&&!o.e.IsEmpty(e[c[0].ValueBinding+"_Key"]))n.fldDict[s.Key].setFieldValue(e[c[0].ValueBinding+"_Key"]);else if(c.length>0&&("DATE"==c[0].DataType||"DATETIME"==c[0].DataType||"TIME"==c[0].DataType)&&null!=e[c[0].DisplayMember+"_Key"]&&!o.e.IsEmpty(e[c[0].DisplayMember+"_Key"]))n.fldDict[s.Key].setFieldValue(e[c[0].DisplayMember+"_Key"]);else if(c.length>0&&"LISTBOX"==c[0].DataType&&!o.e.IsEmpty(e[c[0].DisplayMember]))n.fldDict[s.Key].setFieldValue(e[c[0].DisplayMember].toString());else if(c.length>0&&"ComboBox"!=c[0].DataType&&"DATE"!=c[0].DataType&&"LISTBOX"!=c[0].DataType&&"DATETIME"!=c[0].DataType&&"TIME"!=c[0].DataType&&"PactComboBox"!=c[0].DataType&&!o.e.IsEmpty(e[c[0].DisplayMember]))o.e.IsNum(e[c[0].DisplayMember])?o.e.IsEmpty(c[0].DecimalPoints)?n.fldDict[s.Key].setFieldValue(e[c[0].DisplayMember]):n.fldDict[s.Key].setFieldValue(parseFloat(e[c[0].DisplayMember]).ToString("N"+c[0].DecimalPoints)):n.fldDict[s.Key].setFieldValue(e[c[0].DisplayMember]);else if(s.Key.endsWith("EXRT"))if((c=a.filter((function(e){return e.lbl==n.fldDict[s.Key.replace("EXRT","")].getFieldName()}))).length>0)if("-1"==c[0].DefaultValue)n.fldDict[s.Key].setFieldValue(i);else if("-2"==c[0].DefaultValue)n.ScreenObject.GridDataColumns.Contains(c[0].DisplayMember.replace("dcNum","dcExchRT"))&&!o.e.IsEmpty(e[c[0].DisplayMember.replace("dcNum","dcExchRT")])?n.fldDict[s.Key].setFieldValue(e[c[0].DisplayMember.replace("dcNum","dcExchRT")].toString()):n.fldDict[s.Key].setFieldValue(1);else{var l=o.e.Double(c[0].DefaultValue);n.fldDict[s.Key].setFieldValue(l>0&&c[0].CurrID>0?c[0].ExhcgRt:1)}else n.fldDict[s.Key].setFieldValue(1);else s.Key.toLowerCase().startsWith("calc")&&!s.Key.toLowerCase().startsWith("calculate")?(c=a.filter((function(e){return e.lbl==n.fldDict[s.Key.substr(4)].getFieldName()}))).length>0&&"ComboBox"!=c[0].DataType&&"PactComboBox"!=c[0].DataType&&!o.e.IsEmpty(e[c[0].DisplayMember])?o.e.IsNum(e["dcCalc"+c[0].DisplayMember])?o.e.IsEmpty(c[0].DecimalPoints)?n.fldDict[s.Key].setFieldValue(e["dcCalc"+c[0].DisplayMember]):n.fldDict[s.Key].setFieldValue(parseFloat(e["dcCalc"+c[0].DisplayMember]).ToString("N"+c[0].DecimalPoints)):n.fldDict[s.Key].setFieldValue(e["dcCalc"+c[0].DisplayMember]):n.fldDict[s.Key].setFieldValue(0):n.fldDict[s.Key].setFieldValue(c.length>0&&("STRING"==c[0].DataType||"TEXT"==c[0].DataType||"LISTBOX"==c[0].DataType||"LINK"==c[0].DataType)?"":"NET"==s.Key?n.NetAmount:0);t&&c&&c.length>0&&null!=c[0].Formula&&c[0].Formula.Contains("AVGRATE")&&n.fldDict[s.Key].setFieldValue(0)}})),this.IsInventoryVoucher&&(o.e.IsEmpty(e.Rate)?this.fldDict.RATE.setFieldValue(0):this.fldDict.RATE.setFieldValue(e.Rate),o.e.IsEmpty(e.Quantity)?this.fldDict.QTY.setFieldValue(0):this.fldDict.QTY.setFieldValue(e.Quantity),o.e.IsEmpty(e.FreeQTY)?this.fldDict.FreeQTY.setFieldValue(0):this.fldDict.FreeQTY.setFieldValue(e.FreeQTY),o.e.IsEmpty(e.Gross)?this.fldDict.GROSS.setFieldValue(0):this.fldDict.GROSS.setFieldValue(e.Gross),o.e.IsEmpty(e.UOMConvertedQty)?this.fldDict.CONVQTY.setFieldValue(0):this.fldDict.CONVQTY.setFieldValue(e.UOMConvertedQty),o.e.IsEmpty(e.UOMConversion)?this.fldDict.UOMCONVERSION.setFieldValue(1):this.fldDict.UOMCONVERSION.setFieldValue(e.UOMConversion),o.e.IsEmpty(e.LASTPURCHASERATE)?this.fldDict.LSTPRCHSRT.setFieldValue(0):this.fldDict.LSTPRCHSRT.setFieldValue(e.LASTPURCHASERATE),o.e.IsEmpty(e.AVGRATE)?this.fldDict.AVGRT.setFieldValue(0):this.fldDict.AVGRT.setFieldValue(e.AVGRATE),o.e.IsEmpty(e.SRate)?this.fldDict.SRate.setFieldValue(0):this.fldDict.SRate.setFieldValue(e.SRate),o.e.IsEmpty(e.RRate)?this.fldDict.RRate.setFieldValue(0):this.fldDict.RRate.setFieldValue(e.RRate),o.e.IsEmpty(e.MRate)?this.fldDict.MRate.setFieldValue(0):this.fldDict.MRate.setFieldValue(e.MRate),o.e.IsEmpty(e.QOH)?this.fldDict.QOH.setFieldValue(0):this.fldDict.QOH.setFieldValue(e.QOH),o.e.IsEmpty(e.BalQOH)?this.fldDict.BalQOH.setFieldValue(0):this.fldDict.BalQOH.setFieldValue(e.BalQOH),o.e.IsEmpty(e.HOLDQTY)?this.fldDict.HOLDQTY.setFieldValue(0):this.fldDict.HOLDQTY.setFieldValue(e.HOLDQTY),o.e.IsEmpty(e.CommittedQty)?this.fldDict.CommittedQty.setFieldValue(0):this.fldDict.CommittedQty.setFieldValue(e.CommittedQty),o.e.IsEmpty(e.RESERVEQTY)?this.fldDict.RESERVEQTY.setFieldValue(0):this.fldDict.RESERVEQTY.setFieldValue(e.RESERVEQTY),o.e.IsEmpty(e.TotalReserve)?this.fldDict.TotalReserve.setFieldValue(0):this.fldDict.TotalReserve.setFieldValue(e.TotalReserve))),this.FillHeaderDictionary(),this.fldDict.EXCHRT.setFieldValue(i),this.FooterDics.ContainsKey("EXCHRT")&&this.FooterDics.EXCHRT.setFieldValue(this.fldDict.EXCHRT.fieldResult)}},{key:"DontChVlue",value:function(e,t,n){if("Gross"==t.DisplayMember&&!o.e.IsEmpty(e[t.DisplayMember])&&!o.e.IsEmpty(t.DecimalPoints)){var a=(parseFloat(e[t.DisplayMember].toString())-n).toString().split(".");if(a.length>0&&0==parseFloat(a[0])&&a.length>1&&a[1].length>parseInt(t.DecimalPoints)&&0==parseFloat(a[1].substr(0,parseInt(t.DecimalPoints))))return!0}return!1}},{key:"CalculateTotals",value:function(e,t){var n=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=function(){if(null==n.ScreenObject.GridData||null!=e&&n.IsInventoryVoucher&&o.e.IsEmpty(e.ProductID_Key))return{v:void 0};null!=e&&!n.IsInventoryVoucher&&n.ScreenObject.GridDataColumns.Contains("Denomination")&&(e.Denomination="Denominations");var r=1;s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&(n.Currency&&null!=n.Currency.ExchangeRate.Text&&""!=n.Currency.ExchangeRate.Text?(r=parseFloat(n.Currency.ExchangeRate.Text),o.e.IsEmpty(n.Currency.Currency.SelectedValue)||parseInt(n.Currency.Currency.SelectedValue)):null!=e&&n.ScreenObject.GridDataColumns.Contains("ExchangeRate")&&!o.e.IsEmpty(e.ExchangeRate)&&(r=parseFloat(e.ExchangeRate),n.ScreenObject.GridDataColumns.Contains("CurrencyID_Key")&&!o.e.IsEmpty(e.CurrencyID_Key)&&parseInt(e.CurrencyID_Key))),n.GridNetTotal=0;var c=n.ScreenObject.ColumnSource;n.FillDictionary(e,t);var u,d=0,D=0,h=0,S=n.fldDict;if(""!=a&&null!=e){var m;if(!(m=c.find((function(e){return e.DisplayMember==a})))||o.e.IsEmpty(m.DecimalPoints)||o.e.IsEmpty(e[a])||"FLOAT"!=m.DataType||(m.NoRoundOff||(e[m.DisplayMember]=parseFloat(e[a]).ToString("N"+m.DecimalPoints)),n.fldDict[m.lbl].setFieldValue(e[a].toString()),"Gross"==m.DisplayMember?n.fldDict.GROSS.setFieldValue(e.Gross):"Quantity"==m.DisplayMember?n.fldDict.QTY.setFieldValue(o.e.String(e.Quantity)):"Rate"==m.DisplayMember&&n.fldDict.RATE.setFieldValue(o.e.String(e.Rate))),m=null,m=c.find((function(e){return!o.e.IsEmpty(e.FilterCondition)&&!o.e.IsEmpty(e.DisplayMember)&&e.DisplayMember.toLowerCase().Contains("dcnum")&&e.FilterCondition.toLowerCase()==a.toLowerCase()})))a=m.DisplayMember;else{if("productid"==a.toLowerCase())a="Gross";else if("gross"==a.toLowerCase())a="Rate";else if("rate"==a.toLowerCase()||"quantity"==a.toLowerCase()||"unit"==a.toLowerCase()){if("Quantity"==a){n.fldDict.QTY.setFieldValue(o.e.String(e.Quantity));var b=1;o.e.IsNum(e.UOMConversion)&&(b=parseFloat(e.UOMConversion)),o.e.IsEmpty(e.Quantity)||(e.UOMConvertedQty=b*parseFloat(e.Quantity))}a="Gross"}(m=c.find((function(e){return e.DisplayMember==a})))&&!o.e.IsEmpty(m.FilterCondition)&&(m=c.find((function(e){return!o.e.IsEmpty(e.DisplayMember)&&e.DisplayMember.toLowerCase()==m.FilterCondition.toLowerCase()})))}!m||o.e.IsEmpty(m.Formula)||4==m.SectionID||"8"==o.e.String(e.Type)&&m.UseBarcode?m&&m.DisplayMember.Contains("dcNum")&&n.fldDict["Calc"+m.lbl].setFieldValue(e[m.DisplayMember]):null!=(u=s.a.eval.EvaluateExpression(m.Formula,S))&&"Infinity"!=u.toString()&&"-Infinity"!=u.toString()&&"NaN"!=u.toString()&&o.e.IsNum(u)&&(0==m.IsCalculated&&m.IsColumnUserDefined&&m.DisplayMember.toLowerCase().Contains("dcnum")?null!=u&&o.e.IsNum(u)&&(m.NoRoundOff?e["dcCalc"+m.DisplayMember]=parseFloat(u).ToString("N6"):null!=m.DecimalPoints&&""!=m.DecimalPoints?e["dcCalc"+m.DisplayMember]=parseFloat(u).ToString("N"+m.DecimalPoints):null!=u&&(e["dcCalc"+m.DisplayMember]=u)):n.DontChVlue(e,m,parseFloat(u.toString()))||(m.NoRoundOff?e[m.DisplayMember]=parseFloat(u).ToString("N6"):o.e.IsEmpty(m.DecimalPoints)?null!=u&&(e[m.DisplayMember]=u.toString()):e[m.DisplayMember]=parseFloat(u).ToString("N"+m.DecimalPoints)),"Gross"==m.DisplayMember?n.fldDict.GROSS.setFieldValue(e.Gross):"Quantity"==m.DisplayMember?(n.fldDict.QTY.setFieldValue(o.e.String(e.Quantity)),o.e.IsEmpty(e.UOMConversion)||o.e.IsEmpty(e.Quantity)||(e.UOMConvertedQty=parseFloat(e.Quantity)*parseFloat(e.UOMConversion))):"FreeQTY"==m.DisplayMember?(n.fldDict.FreeQTY.setFieldValue(e.FreeQTY),!o.e.IsEmpty(e.FreeQTY)&&parseFloat(e.FreeQTY)>0&&(e.UOMConvertedQty=o.e.IsEmpty(e.UOMConversion)?e.FreeQTY.toString():parseFloat(e.FreeQTY)*parseFloat(e.UOMConversion))):"Rate"==m.DisplayMember?n.fldDict.RATE.setFieldValue(e.Rate):1==m.IsCalculated?(n.fldDict[m.lbl].setFieldValue(e[m.DisplayMember]),m.DisplayMember.Contains("dcNum")&&n.fldDict["Calc"+m.lbl].setFieldValue(e[m.DisplayMember])):m.DisplayMember.Contains("dcNum")&&n.fldDict["Calc"+m.lbl].setFieldValue(e["dcCalc"+m.DisplayMember]))}for(var C=function(t){if(null!=e)if(o.e.IsEmpty(c[t].Formula)||4==c[t].SectionID||"8"==o.e.String(e.Type)&&c[t].UseBarcode)c[t].DisplayMember.Contains("dcNum")&&(4!=c[t].SectionID||o.e.IsEmpty(c[t].Formula))?null!=e[c[t].DisplayMember]&&(e["dcCalc"+c[t].DisplayMember]=e[c[t].DisplayMember],n.fldDict["Calc"+c[t].lbl].setFieldValue(e[c[t].DisplayMember])):"LINK"==c[t].DataType&&c[t].DisplayMember.toLowerCase().Contains("dcalpha")&&(e[c[t].DisplayMember]="...");else{try{if(1==c[t].IsCalculated||!c[t].IsColumnUserDefined&&"DueDate"!=c[t].DisplayMember)null!=(u=s.a.eval.EvaluateExpression(c[t].Formula,S))&&"Infinity"!=u.toString()&&"-Infinity"!=u.toString()&&"NaN"!=u.toString()&&o.e.IsNum(u)&&(n.DontChVlue(e,c[t],parseFloat(u.toString()))||(c[t].NoRoundOff?e[c[t].DisplayMember]=parseFloat(u).ToString("N6"):o.e.IsEmpty(c[t].DecimalPoints)?null!=u&&(e[c[t].DisplayMember]=u.toString()):e[c[t].DisplayMember]=parseFloat(u).ToString("N"+c[t].DecimalPoints))),c[t].DisplayMember.Contains("dcNum")&&(e["dcCalc"+c[t].DisplayMember]=e[c[t].DisplayMember]);else if(c[t].DisplayMember.Contains("dcNum"))null!=(u=s.a.eval.EvaluateExpression(c[t].Formula,S))&&"Infinity"!=u.toString()&&"-Infinity"!=u.toString()&&"NaN"!=u.toString()&&o.e.IsNum(u)&&(c[t].NoRoundOff?e["dcCalc"+c[t].DisplayMember]=parseFloat(u).ToString("N6"):o.e.IsEmpty(c[t].DecimalPoints)?null!=u&&(e["dcCalc"+c[t].DisplayMember]=u.toString()):e["dcCalc"+c[t].DisplayMember]=parseFloat(u).ToString("N"+c[t].DecimalPoints));else if((c[t].DisplayMember.toLowerCase().Contains("dcalpha")||"DueDate"==c[t].DisplayMember)&&(null!=(u=s.a.eval.EvaluateExpression(c[t].Formula,S).toString())&&"Infinity"!=u.toString()&&"-Infinity"!=u.toString()&&"NaN"!=u.toString()))if("DATE"==c[t].DataType||"DATETIME"==c[t].DataType||"TIME"==c[t].DataType){var a;o.e.isValidDate(u)&&(e[c[t].DisplayMember]="DATETIME"==c[t].DataType?new Date(u).ToString(s.a.SessionManager.Preferences["Date Format"]+" hh:mm a"):"TIME"==c[t].DataType?new Date(u).ToString("hh:mm:ss tt"):new Date(u).ToString(s.a.SessionManager.Preferences["Date Format"]),"TIME"==c[t].DataType?(a=new Date(u),e[c[t].DisplayMember+"_Key"]=new Date(1900,1,1,a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds())):e[c[t].DisplayMember+"_Key"]=new Date(u),n.fldDict[c[t].lbl].setFieldValue(u.toString()))}else"FLOAT"==c[t].DataType?o.e.IsNum(u)?(e[c[t].DisplayMember]=u.toString(),n.fldDict[c[t].lbl].setFieldValue(u)):(e[c[t].DisplayMember]=0,n.fldDict[c[t].lbl].setFieldValue(0)):(e[c[t].DisplayMember]=u.toString(),n.fldDict[c[t].lbl].setFieldValue(u.toString()))}catch(v){console.log("i"+t+" "+c[t].Formula),n.DisplayMessage="Problem evaluating formula,try again",Logger.ErrorLog("Addeditdocumentviewmodel","Formua evaluation calculate totals",v)}"Gross"!=c[t].DisplayMember||o.e.IsEmpty(e.Gross)?"FreeQTY"!=c[t].DisplayMember||o.e.IsEmpty(e.FreeQTY)?"Quantity"==c[t].DisplayMember?o.e.IsEmpty(e.Quantity)||(n.fldDict.QTY.setFieldValue(o.e.String(e.Quantity)),o.e.IsEmpty(e.UOMConversion)||(e.UOMConvertedQty=parseFloat(e.Quantity)*parseFloat(e.UOMConversion))):"Rate"!=c[t].DisplayMember||o.e.IsEmpty(e.Rate)?1==c[t].IsCalculated?(o.e.IsEmpty(e[c[t].DisplayMember])||n.fldDict[c[t].lbl].setFieldValue(e[c[t].DisplayMember]),c[t].DisplayMember.Contains("dcNum")&&!o.e.IsEmpty(e[c[t].DisplayMember])&&n.fldDict["Calc"+c[t].lbl].setFieldValue(e[c[t].DisplayMember])):c[t].DisplayMember.Contains("dcNum")&&n.fldDict["Calc"+c[t].lbl].setFieldValue(e["dcCalc"+c[t].DisplayMember]):n.fldDict.RATE.setFieldValue(e.Rate):n.fldDict.FreeQTY.setFieldValue(e.FreeQTY):n.fldDict.GROSS.setFieldValue(e.Gross),c[t].DisplayMember.Contains("dcNum")&&o.e.IsEmpty(e[c[t].DisplayMember])&&n.fldDict[c[t].lbl].setFieldValue(0),c[t].DisplayMember.Contains("dcNum")&&o.e.IsEmpty(e["dcCalc"+c[t].DisplayMember])&&n.fldDict["Calc"+c[t].lbl].setFieldValue(0),n.ScreenObject.GridDataObj.updateRow(e)}if(i){var m=o.e.GetEmptyDate();if(d=0,h=0,D=0,c[t].DisplayMember.Contains("dcAlpha")||"FLOAT"!=c[t].DataType.toUpperCase()||4==c[t].SectionID){if(c[t].DisplayMember.Contains("dcAlpha")&&"FLOAT"==c[t].DataType.toUpperCase()&&4!=c[t].SectionID){d=0;for(var b=0;b<n.ScreenObject.GridData.length;b++)o.e.IsEmpty(n.ScreenObject.GridData[b][c[t].DisplayMember])||(d+=parseFloat(n.ScreenObject.GridData[b][c[t].DisplayMember]));h=d,1==c[t].ShowbodyTotal&&(c[t].footer=o.e.IsEmpty(c[t].DecimalPoints)?h.toString():h.ToString("N"+c[t].DecimalPoints))}}else{for(var C=0,y=0,p=0,g=0,f=0;f<n.ScreenObject.GridData.length;f++){var O=r;if(s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&n.ScreenObject.GridDataColumns.Contains("ExchangeRate")&&!o.e.IsEmpty(n.ScreenObject.GridData[f].ExchangeRate)&&(O=parseFloat(n.ScreenObject.GridData[f].ExchangeRate)),c[t].DisplayMember.toLowerCase().Contains("dcnum")&&(!o.e.IsEmpty(n.ScreenObject.GridData[f][c[t].DisplayMember])&&parseFloat(n.ScreenObject.GridData[f][c[t].DisplayMember])>C&&(C=parseFloat(n.ScreenObject.GridData[f][c[t].DisplayMember])),!o.e.IsEmpty(n.ScreenObject.GridData[f][c[t].DisplayMember])&&(parseFloat(n.ScreenObject.GridData[f][c[t].DisplayMember])<y||0==y)&&(y=parseFloat(n.ScreenObject.GridData[f][c[t].DisplayMember])),!o.e.IsEmpty(n.ScreenObject.GridData[f]["dcCalc"+c[t].DisplayMember])&&parseFloat(n.ScreenObject.GridData[f]["dcCalc"+c[t].DisplayMember])>p&&(p=parseFloat(n.ScreenObject.GridData[f]["dcCalc"+c[t].DisplayMember])),!o.e.IsEmpty(n.ScreenObject.GridData[f]["dcCalc"+c[t].DisplayMember])&&(parseFloat(n.ScreenObject.GridData[f]["dcCalc"+c[t].DisplayMember])<g||0==g)&&(g=parseFloat(n.ScreenObject.GridData[f]["dcCalc"+c[t].DisplayMember])),"-2"==c[t].DefaultValue&&(O=n.ScreenObject.GridDataColumns.Contains(c[t].DisplayMember.toLowerCase().replace("dcnum","dcExchRT"))&&!o.e.IsEmpty(n.ScreenObject.GridData[f][c[t].DisplayMember.toLowerCase().replace("dcnum","dcExchRT")])?parseFloat(n.ScreenObject.GridData[f][c[t].DisplayMember.toLowerCase().replace("dcnum","dcExchRT")]):1),o.e.Double(c[t].DefaultValue)>0&&(O=c[t].CurrID>0?c[t].ExhcgRt:1)),"Quantity"==c[t].DisplayMember)o.e.IsEmpty(n.ScreenObject.GridData[f].UOMConvertedQty)||o.e.IsEmpty(n.ScreenObject.GridData[f].Quantity)||0==parseFloat(n.ScreenObject.GridData[f].Quantity)||(d+=parseFloat(n.ScreenObject.GridData[f].UOMConvertedQty),h=d);else if(1!=c[t].IsCalculated&&c[t].IsColumnUserDefined)c[t].DisplayMember.Contains("dcNum")&&(o.e.IsEmpty(n.ScreenObject.GridData[f]["dcCalc"+c[t].DisplayMember])||(h+=parseFloat(n.ScreenObject.GridData[f]["dcCalc"+c[t].DisplayMember]),D+=parseFloat(n.ScreenObject.GridData[f]["dcCalc"+c[t].DisplayMember])*O),o.e.IsEmpty(n.ScreenObject.GridData[f][c[t].DisplayMember])||(d+=parseFloat(n.ScreenObject.GridData[f][c[t].DisplayMember])));else if(!o.e.IsEmpty(n.ScreenObject.GridData[f][c[t].DisplayMember]))if(67!=n.DocumentType||"dcNum1"!=c[t].DisplayMember&&"dcNum2"!=c[t].DisplayMember&&"dcNum4"!=c[t].DisplayMember&&"dcNum5"!=c[t].DisplayMember&&"dcNum7"!=c[t].DisplayMember&&"dcNum9"!=c[t].DisplayMember&&"dcNum11"!=c[t].DisplayMember&&"dcNum13"!=c[t].DisplayMember)d+=parseFloat(n.ScreenObject.GridData[f][c[t].DisplayMember]),D+=parseFloat(n.ScreenObject.GridData[f][c[t].DisplayMember])*O,h=d;else if(n.drcc1=n.ScreenObject.Data.Tables[0].filter((function(e){return e.CostCenterColID==c[t].ID})),null!=n.drcc1&&n.drcc1.length>0)if(o.e.IsEmpty(n.drcc1[0].UserColumnType))d+=parseFloat(n.ScreenObject.GridData[f][c[t].DisplayMember]),D+=parseFloat(n.ScreenObject.GridData[f][c[t].DisplayMember])*O,h=d;else if(parseFloat(n.ScreenObject.GridData[f][c[t].DisplayMember])>0){var I=parseFloat(n.ScreenObject.GridData[f][c[t].DisplayMember]).ToTime("00.00").split(".");m=m.AddHours(parseFloat(I[0])),I.length>1&&(1==I[1].length&&(I[1]=I[1]+"0"),m=m.AddMinutes(parseFloat(I[1])));var T=m.getMinutes().toString();1==T.length&&(T="0"+T),d=parseFloat(24*(m.getDate()-1)+m.getHours()+"."+T),D=h=d}}if(1!=c[t].IsCalculated&&c[t].IsColumnUserDefined){if(0!=c[t].ShowbodyTotal)if(o.e.IsEmpty(c[t].DecimalPoints))if(1==c[t].ShowbodyTotal)c[t].footer=D.toString();else{var j=1;s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&n.Currency&&!o.e.IsEmpty(n.Currency.ExchangeRate.Text)&&(j=parseFloat(n.Currency.ExchangeRate.Text)),c[t].footer=0!=j?(D/j).toString():D.toString()}else if(1==c[t].ShowbodyTotal)c[t].footer=D.ToString("N"+c[t].DecimalPoints);else{var P=1;s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&n.Currency&&!o.e.IsEmpty(n.Currency.ExchangeRate.Text)&&(P=parseFloat(n.Currency.ExchangeRate.Text)),c[t].footer=0!=P?(D/P).ToString("N"+c[t].DecimalPoints):D.ToString("N"+c[t].DecimalPoints)}3==c[t].PostingType||4==c[t].PostingType?n.IsInventoryVoucher?1==n.ScreenObject.DocumentType||2==n.ScreenObject.DocumentType||25==n.ScreenObject.DocumentType||26==n.ScreenObject.DocumentType||27==n.ScreenObject.DocumentType||6==n.ScreenObject.DocumentType||39==n.ScreenObject.DocumentType||3==n.ScreenObject.DocumentType||4==n.ScreenObject.DocumentType||34==n.ScreenObject.DocumentType||8==n.ScreenObject.DocumentType||31==n.ScreenObject.DocumentType?0==c[t].CrRefColID&&0==c[t].CreditAcount&&(n.GridNetTotal+=D):0==c[t].DrRefColID&&0==c[t].DebitAccount&&(n.GridNetTotal+=D):n.GridNetTotal+=D:n.IsInventoryVoucher||"Amount"!=c[t].DisplayMember&&"CreditAmount"!=c[t].DisplayMember||(n.GridNetTotal+=D)}else{if(0!=c[t].ShowbodyTotal)if("Quantity"==c[t].DisplayMember||"Rate"==c[t].DisplayMember)c[t].footer=o.e.IsEmpty(c[t].DecimalPoints)?d.toString():d.ToString("N"+c[t].DecimalPoints);else if(o.e.IsEmpty(c[t].DecimalPoints))if(1==c[t].ShowbodyTotal)c[t].footer=D.toString();else{var A=1;s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&n.Currency&&!o.e.IsEmpty(n.Currency.ExchangeRate.Text)&&(A=parseFloat(n.Currency.ExchangeRate.Text)),c[t].footer=0!=A?(D/A).toString():D.toString()}else if(1==c[t].ShowbodyTotal)c[t].footer=D.ToString("N"+c[t].DecimalPoints);else{var M=1;s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&n.Currency&&!o.e.IsEmpty(n.Currency.ExchangeRate.Text)&&(M=parseFloat(n.Currency.ExchangeRate.Text)),c[t].footer=0!=M?(D/M).ToString("N"+c[t].DecimalPoints):D.ToString("N"+c[t].DecimalPoints)}3==c[t].PostingType||4==c[t].PostingType?n.IsInventoryVoucher?1==n.ScreenObject.DocumentType||2==n.ScreenObject.DocumentType||25==n.ScreenObject.DocumentType||26==n.ScreenObject.DocumentType||27==n.ScreenObject.DocumentType||6==n.ScreenObject.DocumentType||39==n.ScreenObject.DocumentType||3==n.ScreenObject.DocumentType||4==n.ScreenObject.DocumentType||34==n.ScreenObject.DocumentType||8==n.ScreenObject.DocumentType||31==n.ScreenObject.DocumentType?0==c[t].CrRefColID&&0==c[t].CreditAcount&&(n.GridNetTotal+=D):0==c[t].DrRefColID&&0==c[t].DebitAccount&&(n.GridNetTotal+=D):n.GridNetTotal+=D:n.IsInventoryVoucher||"Amount"!=c[t].DisplayMember&&"CreditAmount"!=c[t].DisplayMember||(n.GridNetTotal+=D)}n.fldDict.ContainsKey("Max"+c[t].lbl)&&n.fldDict["Max"+c[t].lbl].setFieldValue(C),n.fldDict.ContainsKey("MaxCalc"+c[t].lbl)&&n.fldDict["MaxCalc"+c[t].lbl].setFieldValue(p),n.fldDict.ContainsKey("Min"+c[t].lbl)&&n.fldDict["Min"+c[t].lbl].setFieldValue(y),n.fldDict.ContainsKey("MinCalc"+c[t].lbl)&&n.fldDict["MinCalc"+c[t].lbl].setFieldValue(g),n.FooterDics.ContainsKey("Max"+c[t].lbl)&&n.FooterDics["Max"+c[t].lbl].setFieldValue(C),n.FooterDics.ContainsKey("MaxCalc"+c[t].lbl)&&n.FooterDics["MaxCalc"+c[t].lbl].setFieldValue(p),n.FooterDics.ContainsKey("Min"+c[t].lbl)&&n.FooterDics["Min"+c[t].lbl].setFieldValue(y),n.FooterDics.ContainsKey("MinCalc"+c[t].lbl)&&n.FooterDics["MinCalc"+c[t].lbl].setFieldValue(g)}c[t].IsColumnUserDefined&&n.FooterDics.ContainsKey(c[t].lbl)?(n.FooterDics[c[t].lbl].setFieldValue(d),c[t].DisplayMember.Contains("dcNum")&&n.FooterDics.ContainsKey("Calc"+c[t].lbl)&&n.FooterDics["Calc"+c[t].lbl].setFieldValue(h)):"Gross"==c[t].DisplayMember&&n.FooterDics.ContainsKey("GROSS")?n.FooterDics.GROSS.setFieldValue(d):"Quantity"==c[t].DisplayMember&&n.FooterDics.ContainsKey("QTY")?n.FooterDics.QTY.setFieldValue(d):"FreeQTY"==c[t].DisplayMember&&n.FooterDics.ContainsKey("FreeQTY")?n.FooterDics.FreeQTY.setFieldValue(d):"Rate"==c[t].DisplayMember&&n.FooterDics.ContainsKey("RATE")?n.FooterDics.RATE.setFieldValue(d):n.FooterDics.ContainsKey(c[t].DisplayMember)&&n.FooterDics[c[t].DisplayMember].setFieldValue(d)}},y=0;y<c.length;y++)C(y);i&&(n.ScreenObject.GridDataColumns.Contains("IsKit")&&null!=e&&"2"==e.IsKit.toString()&&n.CalcOpRate(),n.CalculateFooter(-1),n.RefreshNetAmount(),n.jvTotal(),n.UpdateFooter=!0)}();if("object"==typeof r)return r.v;this.ScreenObject.GridDataObj.UpdateFooter()}},{key:"GetLineWiseValue",value:function(e){for(var t=0,n=0;n<this.ScreenObject.GridData.length;n++)if(!o.e.IsEmpty(this.ScreenObject.GridData[n].ProductID_Key)){this.FillDictionary(this.ScreenObject.GridData[n],!1);var a=s.a.eval.EvaluateExpression(e,this.fldDict);!o.e.IsEmpty(a)&&"Infinity"!=a.toString()&&"-Infinity"!=a.toString()&&"NaN"!=a.toString()&&o.e.IsNum(a)&&(t+=parseFloat(a))}return t}},{key:"CalculateFooter",value:function(e){var t=this;if(this.IsInventoryVoucher)try{var n=this.FooterDics;if(null!=this.ScreenObject.FooterGridData&&this.ScreenObject.FooterGridData.length>0){for(var a="",i=0;i<this.ScreenObject.FooterGridData.length;i++)a=o.e.String(this.ScreenObject.FooterGridData[i].Name).Replace(" ",""),this.FooterDics.ContainsKey(a)&&(o.e.IsEmpty(this.ScreenObject.FooterGridData[i].Amount)?this.FooterDics[a].setFieldValue(0):this.FooterDics[a].setFieldValue(this.ScreenObject.FooterGridData[i].Amount)),this.FooterDics.ContainsKey("Calc"+a)&&(o.e.IsEmpty(this.ScreenObject.FooterGridData[i].CalcAmount)?this.FooterDics["Calc"+a].setFieldValue(0):this.FooterDics["Calc"+a].setFieldValue(this.ScreenObject.FooterGridData[i].CalcAmount));this.FooterGridNetTotal=0;for(var r=function(i){a=o.e.String(t.ScreenObject.FooterGridData[i].Name).Replace(" ","");var r=1;if(s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])){null!=t.Currency&&null!=t.Currency.ExchangeRate.Text&&""!=t.Currency.ExchangeRate.Text&&(r=parseFloat(t.Currency.ExchangeRate.Text));var c=t.ScreenObject.ColumnSource.find((function(e){return null!=e.DisplayMember&&e.DisplayMember==t.ScreenObject.FooterGridData[i].ColumnName}));c&&("-2"==c.DefaultValue&&(r=o.e.IsEmpty(t.ScreenObject.FooterGridData[i].dcCurrID_Key)||o.e.IsEmpty(t.ScreenObject.FooterGridData[i].dcExchRT)?1:parseFloat(t.ScreenObject.FooterGridData[i].dcExchRT)),o.e.Double(c.DefaultValue)>0&&(r=c.CurrID>0?c.ExhcgRt:1))}if(o.e.IsEmpty(t.ScreenObject.FooterGridData[i].Formula))t.ScreenObject.FooterGridData[i].CalcAmount=t.ScreenObject.FooterGridData[i].Amount;else{var u=[];if(!o.e.IsEmpty(t.ScreenObject.FooterGridData[i].BasedOnXML)){var d=new o.f;d.LoadXml(t.ScreenObject.FooterGridData[i].BasedOnXML);for(var D=d.SelectNodes("Xml/Row"),h=function(e){var n=D[e];if(null!=n.attributes.ColumnName&&!o.e.IsEmpty(n.attributes.ColumnName.value)&&null!=n.attributes.Formula&&!o.e.IsEmpty(n.attributes.Formula.value)){var a=t.ScreenObject.ColumnSource.find((function(e){return e.ID==n.attributes.ColumnName.value}));if(a){u.push(a);var i=t.GetLineWiseValue(n.attributes.Formula.value);"Gross"==a.DisplayMember?t.FooterDics.GROSS.setFieldValue(i):"Quantity"==a.DisplayMember?t.FooterDics.QTY.setFieldValue(i):"Rate"==a.DisplayMember?t.FooterDics.RATE.setFieldValue(i):t.FooterDics.ContainsKey(a.lbl)&&t.FooterDics[a.lbl].setFieldValue(i)}}},S=0;S<D.length;S++)h(S)}if("2"==t.ScreenObject.FooterGridData[i].IsCalculated){var m=t.GetLineWiseValue(t.ScreenObject.FooterGridData[i].Formula.toString());t.ScreenObject.FooterGridData[i].Amount=parseFloat(m.toString()).ToString("N"+t.ScreenObject.FooterGridData[i].Decimals.toString()),t.ScreenObject.FooterGridData[i].CalcAmount=t.ScreenObject.FooterGridData[i].Amount}else if("1"==t.ScreenObject.FooterGridData[i].IsCalculated){var b=s.a.eval.EvaluateExpression(t.ScreenObject.FooterGridData[i].Formula.toString(),n);t.ScreenObject.FooterGridData[i].Amount=null!=b&&!o.e.IsEmpty(b)&&"Infinity"!=b.toString()&&"-Infinity"!=b.toString()&&"NaN"!=b.toString()&&o.e.IsNum(b)?parseFloat(b.toString()).ToString("N"+t.ScreenObject.FooterGridData[i].Decimals.toString()):0,t.ScreenObject.FooterGridData[i].CalcAmount=t.ScreenObject.FooterGridData[i].Amount}else if(e==i&&t.ScreenObject.FooterGridData[i].Formula.toString().Contains("%")){var C,y;t.FooterDics[a].setFieldValue(1),C=o.e.Double(s.a.eval.EvaluateExpression(t.ScreenObject.FooterGridData[i].Formula.toString(),n).toString()),y=o.e.Double(t.ScreenObject.FooterGridData[i].CalcAmount),0!=C&&(C=y/C),t.ScreenObject.FooterGridData[i].Amount=parseFloat(C.toString()).ToString("N"+t.ScreenObject.FooterGridData[i].Decimals.toString())}else{var p=s.a.eval.EvaluateExpression(t.ScreenObject.FooterGridData[i].Formula.toString(),n);t.ScreenObject.FooterGridData[i].CalcAmount=null!=p&&!o.e.IsEmpty(p)&&"Infinity"!=p.toString()&&"-Infinity"!=p.toString()&&"NaN"!=p.toString()&&o.e.IsNum(p)?parseFloat(p.toString()).ToString("N"+t.ScreenObject.FooterGridData[i].Decimals.toString()):0}u.length>0&&u.forEach((function(e){for(var n=0,a=0;a<t.ScreenObject.GridData.length;a++)o.e.IsEmpty(t.ScreenObject.GridData[a].ProductID_Key)||!o.e.IsEmpty(t.ScreenObject.GridData[a][e.DisplayMember])&&o.e.IsNum(t.ScreenObject.GridData[a][e.DisplayMember])&&(n+=parseFloat(t.ScreenObject.GridData[a][e.DisplayMember]));"Gross"==e.DisplayMember?t.FooterDics.GROSS.setFieldValue(n):"Quantity"==e.DisplayMember?t.FooterDics.QTY.setFieldValue(n):"Rate"==e.DisplayMember?t.FooterDics.RATE.setFieldValue(n):t.FooterDics.ContainsKey(e.lbl)&&t.FooterDics[e.lbl].setFieldValue(n)}))}t.FooterDics.ContainsKey(a)&&(o.e.IsEmpty(t.ScreenObject.FooterGridData[i].Amount)?t.FooterDics[a].setFieldValue(0):t.FooterDics[a].setFieldValue(t.ScreenObject.FooterGridData[i].Amount.toString())),t.FooterDics.ContainsKey("Calc"+a)&&(o.e.IsEmpty(t.ScreenObject.FooterGridData[i].CalcAmount)?t.FooterDics["Calc"+a].setFieldValue(0):t.FooterDics["Calc"+a].setFieldValue(t.ScreenObject.FooterGridData[i].CalcAmount.toString())),t.FooterDics.ContainsKey(a+"EXRT")&&t.FooterDics[a+"EXRT"].setFieldValue(r),null==t.ScreenObject.FooterGridData[i].CalcAmount||o.e.IsEmpty(t.ScreenObject.FooterGridData[i].CalcAmount)||null==t.ScreenObject.FooterGridData[i].PostingType||o.e.IsEmpty(t.ScreenObject.FooterGridData[i].PostingType)||3!=parseInt(t.ScreenObject.FooterGridData[i].PostingType)&&4!=parseInt(t.ScreenObject.FooterGridData[i].PostingType)||(t.FooterGridNetTotal+=parseFloat(t.ScreenObject.FooterGridData[i].CalcAmount)*r),t.ScreenObject.FooterGridDataObj.updateRow(t.ScreenObject.FooterGridData[i])},c=0;c<this.ScreenObject.FooterGridData.length;c++)r(c)}if(null!=this.ScreenObject.DocPrefix&&!o.e.IsNullOrWhiteSpace(this.ScreenObject.DocPrefix.Formula)){this.GridNetTotal=0,this.FooterGridNetTotal=0;var u=s.a.eval.EvaluateExpression(this.ScreenObject.DocPrefix.Formula,n);o.e.IsNum(u)&&(this.FooterGridNetTotal=parseFloat(u))}this.RefreshNetAmount(),this.CalcTextFields()}catch(d){this.DisplayMessage="Problem processing document try again",Logger.ErrorLog("Addeditdocumentviewmodel","footer calculation",d.stack)}else this.CalcTextFields()}},{key:"CalcTextFields",value:function(){var e=this;try{var t=this.FooterDics;if(this.ScreenObject._TextFields.forEach((function(n){var a,i=e.ScreenObject.Data.Tables[0].filter((function(e){return e.CostCenterColID==n.DBColumnID&&null!=e.LocalReference&&79==e.LocalReference&&53580==e.LinkData}));if(i.length>0&&null!=e.fldDict&&o.e.isValidDate(e.fldDict.ServerDate.fieldResult)&&(a=new Date(e.fldDict.ServerDate.fieldResult),n instanceof S.b||n instanceof S.c?n.Date=a:n instanceof h.d&&(n.Text=a.ToString(s.a.SessionManager.Preferences["Date Format"]))),(i=e.ScreenObject.Data.Tables[0].filter((function(e){return e.CostCenterColI==n.DBColumnID&&null!=e.LocalReference&&79==e.LocalReference&&(55496==e.LinkData||55495==e.LinkData)}))).length>0&&(a=new Date,n instanceof S.b||n instanceof S.c?(n.Date=a,e.FooterDics.ContainsKey(n.Lbl)&&n.Date&&e.FooterDics[n.Lbl].setFieldValue(n.Date)):n instanceof h.d&&(n.Text=a.ToString(s.a.SessionManager.Preferences["Date Format"]),e.FooterDics.ContainsKey(n.Lbl)&&e.FooterDics[n.Lbl].setFieldValue(n.Text))),!o.e.IsEmpty(n.Formula)){var r=s.a.eval.EvaluateExpression(n.Formula,t);n instanceof h.d&&"FLOAT"==n.DataType?(n.Text=o.e.IsNum(r)?o.e.IsEmpty(n.DecimalPoints)?parseFloat(r).ToString("N"+s.a.SessionManager.Preferences.DecimalsinExtraFields):parseFloat(r).ToString("N"+n.DecimalPoints):"0",e.FooterDics.ContainsKey(n.Lbl)&&e.FooterDics[n.Lbl].setFieldValue(n.Text)):n instanceof h.d?(n.Text=null!=r?r.toString():"",e.FooterDics.ContainsKey(n.Lbl)&&e.FooterDics[n.Lbl].setFieldValue(n.Text)):n instanceof S.c&&(n.Date=null!=r&&o.e.isValidDate(r)?new Date(r):null,e.FooterDics.ContainsKey(n.Lbl)&&n.Date&&e.FooterDics[n.Lbl].setFieldValue(n.Date))}if(57==e.ScreenObject.DocumentType&&"dcalpha3"==n.DBColumnName.toLowerCase()){var c=e.ColumnSource.find((function(e){return e.DisplayMember.toLowerCase().Contains("dcnum3")}));null!=c&&(n.Text=e.FooterDics[c.lbl].fieldResult.fieldResult.toString())}})),null!=this.ScreenObject.DueDate&&!o.e.IsEmpty(this.ScreenObject.DueDate.Formula)){var n=s.a.eval.EvaluateExpression(this.ScreenObject.DueDate.Formula,t);null!=n&&o.e.isValidDate(n)&&(this.ScreenObject.DueDate.Date=new Date(n)),this.FooterDics.ContainsKey("DUEDATE")&&this.ScreenObject.DueDate.Date&&this.FooterDics.DUEDATE.setFieldValue(this.ScreenObject.DueDate.Date)}if(!this.IsInventoryVoucher&&null!=this.ScreenObject.DocPrefix&&!o.e.IsEmpty(this.ScreenObject.DocPrefix.Formula)&&""!=this.ScreenObject.DocPrefix.Formula.trim()){this.GridNetTotal=0,this.FooterGridNetTotal=0;var a=s.a.eval.EvaluateExpression(this.ScreenObject.DocPrefix.Formula,t);o.e.IsNum(a)&&(this.FooterGridNetTotal=parseFloat(a)),this.RefreshNetAmount()}}catch(i){this.DisplayMessage="Problem processing document try again",Logger.ErrorLog("Addeditdocumentviewmodel","footer calculation",i.stack)}}},{key:"FillCreatedByDate_ds",value:function(e){if(!(0==this.ScreenObject.Data.Tables.length||null==e||0==e.Tables.length||e.Tables.length>0&&0==e.Tables[0].length)&&this.ScreenObject.Data.Tables[0].length>0){var t=this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&24060==e.LinkData}));if(t.length>0&&e.Columns[0].Contains("CreatedBy")){if(this.ScreenObject.GridDataColumns.Contains(t[0].SysColumnName))for(var n=0;n<this.ScreenObject.GridData.length;n++)(this.IsInventoryVoucher&&!o.e.IsEmpty(this.ScreenObject.GridData[n].ProductID_Key)||!this.IsInventoryVoucher&&(this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[n].AccountID_Key)||this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[n].DebitAccount_Key)||this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[n].CreditAccount_Key)))&&(this.ScreenObject.GridData[n][t[0].SysColumnName]=e.Tables[0][0].CreatedBy.toString());var a=this.ScreenObject._TextFields.find((function(e){return e.DBColumnName==t[0].SysColumnName}));a&&a instanceof h.d&&e.Columns[0].Contains("CreatedBy")&&(a.Text=e.Tables[0][0].CreatedBy.toString())}if((t=this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&24061==e.LinkData}))).length>0){if(this.ScreenObject.GridDataColumns.Contains(t[0].SysColumnName)&&e.Columns[0].Contains("CreatedDate"))for(var i=0;i<this.ScreenObject.GridData.length;i++)(this.IsInventoryVoucher&&!o.e.IsEmpty(this.ScreenObject.GridData[i].ProductID_Key)||!this.IsInventoryVoucher&&(this.ScreenObject.GridDataColumns.Contains("AccountID_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[i].AccountID_Key)||this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[i].DebitAccount_Key)||this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[i].CreditAccount_Key)))&&("Date"==t[0].UserColumnType.toString()?(this.ScreenObject.GridData[i][t[0].SysColumnName]=new Date(e.Tables[0][0].CreatedDate).ToString(s.a.SessionManager.Preferences["Date Format"]),this.ScreenObject.GridData[i][t[0].SysColumnName+"_Key"]=new Date(e.Tables[0][0].CreatedDate)):"DateTime"==t[0].UserColumnType.toString()?(this.ScreenObject.GridData[i][t[0].SysColumnName]=new Date(e.Tables[0][0].CreatedDate).ToString(s.a.SessionManager.Preferences["Date Format"]+" hh:mm a"),this.ScreenObject.GridData[i][t[0].SysColumnName+"_Key"]=new Date(e.Tables[0][0].CreatedDate)):"Time"==t[0].UserColumnType.toString()?(this.ScreenObject.GridData[i][t[0].SysColumnName]=new Date(e.Tables[0][0].CreatedDate).ToString(s.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss tt"),this.ScreenObject.GridData[i][t[0].SysColumnName+"_Key"]=new Date(e.Tables[0][0].CreatedDate)):this.ScreenObject.GridData[i][t[0].SysColumnName]=new Date(e.Tables[0][0].CreatedDate).ToString(s.a.SessionManager.Preferences["Date Format"]));var r=this.ScreenObject._TextFields.find((function(e){return e.DBColumnName==t[0].SysColumnName}));r&&e.Columns[0].Contains("CreatedDate")&&(r instanceof h.d?r.Text=new Date(e.Tables[0][0].CreatedDate).ToString(s.a.SessionManager.Preferences["Date Format"]):r instanceof S.c&&(r.Date=new Date(e.Tables[0][0].CreatedDate)),r instanceof S.b&&(r.Date=new Date(e.Tables[0][0].CreatedDate)))}}}},{key:"AddAddress",value:function(e){var t,n,a=this;null!=this.AssignAddress&&e.Tables.length>11&&e.Tables[11].length>0&&(this.AssignAddress.IsEditing=!0,null!=this.ScreenObject.DebitAccount&&(n=e.Tables[11].filter((function(e){return 3==e.AddressTypeID&&e.FEATUREPK==a.ScreenObject.DebitAccount.SelectedValue})),t=e.Tables[10].filter((function(e){return 3==e.AddressTypeID})),this.AssignAddress.ShipTo.push(m.d.ComboBoxItems_2("","")),n.forEach((function(e){a.AssignAddress.ShipTo.push(m.d.ComboBoxItems_2(e.AddressName.toString(),e.AddressID.toString())),t.length>0&&t[0].addressid.toString()==e.AddressID.toString()&&(a.AssignAddress.SelectedShipTo=e.AddressID.toString(),a.AssignAddress.SAddressName.Text=o.e.String(e.ContactPerson),a.AssignAddress.SAddress1.Text=o.e.String(e.Address1)+" "+o.e.String(e.Address2)+" "+o.e.String(e.Address3),a.AssignAddress.SAddressCity.Text=o.e.String(e.City)+" "+o.e.String(e.State)+" "+o.e.String(e.Zip),a.AssignAddress.SPhone1.Text=o.e.String(e.Phone1),a.AssignAddress.ShipToVisibility=!0)}))),this.ScreenObject.IsPurchase?null!=this.ScreenObject.CreditAccount&&(n=e.Tables[11].filter((function(e){return e.AddressTypeID=e.FEATUREPK==a.ScreenObject.CreditAccount.SelectedValue})),t=e.Tables[10].filter((function(e){return 2==e.AddressTypeID})),this.AssignAddress.BillTo.push(m.d.ComboBoxItems_2("","")),n.forEach((function(e){a.AssignAddress.BillTo.push(m.d.ComboBoxItems_2(e.AddressName.toString(),e.AddressID.toString())),t.length>0&&t[0].addressid.toString()==e.AddressID.toString()&&(a.AssignAddress.SelectedBillTo=e.AddressID.toString(),a.AssignAddress.AddressName.Text=o.e.String(e.ContactPerson),a.AssignAddress.Address1.Text=o.e.String(e.Address1)+" "+o.e.String(e.Address2)+" "+o.e.String(e.Address3),a.AssignAddress.Phone1.Text=o.e.String(e.Phone1),a.AssignAddress.AddressCity.Text=o.e.String(e.City)+" "+o.e.String(e.State)+" "+o.e.String(e.Zip),a.AssignAddress.BillToVisibility=!0)})),n=e.Tables[11].filter((function(e){return 1==e.AddressTypeID&&e.FEATUREPK==a.ScreenObject.CreditAccount.SelectedValue})),t=e.Tables[10].filter((function(e){return 1==e.AddressTypeID})),this.AssignAddress.AddressTo.push(m.d.ComboBoxItems_2("","")),n.forEach((function(e){a.AssignAddress.AddressTo.push(m.d.ComboBoxItems_2(e.AddressName.toString(),e.AddressID.toString())),t.length>0&&t[0].addressid.toString()==e.AddressID.toString()&&(a.AssignAddress.SelectedAddressTo=e.AddressID.toString(),a.AssignAddress.AddressToName.Text=o.e.String(e.ContactPerson),a.AssignAddress.AddressTo1.Text=o.e.String(e.Address1)+" "+o.e.String(e.Address2)+" "+o.e.String(e.Address3),a.AssignAddress.PhoneTo1.Text=o.e.String(e.Phone1),a.AssignAddress.AddressToCity.Text=o.e.String(e.City)+" "+o.e.String(e.State)+" "+o.e.String(e.Zip),a.AssignAddress.AddressToVisbility=!0)})),n=e.Tables[11].filter((function(e){return 3==e.AddressTypeID&&e.FEATUREPK==a.ScreenObject.CreditAccount.SelectedValue})),t=e.Tables[10].filter((function(e){return 3==e.AddressTypeID})),this.AssignAddress.ShipTo.push(m.d.ComboBoxItems_2("","")),n.forEach((function(e){a.AssignAddress.ShipTo.push(m.d.ComboBoxItems_2(e.AddressName.toString(),e.AddressID.toString())),t.length>0&&t[0].AddressID.toString()==e.AddressID.toString()&&(a.AssignAddress.SelectedShipTo=e.AddressID.toString(),a.AssignAddress.SAddressName.Text=e.ContactPerson.toString(),a.AssignAddress.SAddress1.Text=e.Address1.toString()+" "+e.Address2.toString()+" "+e.Address3.toString(),a.AssignAddress.SAddressCity.Text=e.City.toString()+" "+e.State.toString()+" "+e.Zip.toString(),a.AssignAddress.SPhone1.Text=e.Phone1.toString(),a.AssignAddress.ShipToVisibility=!0)}))):null!=this.ScreenObject.DebitAccount&&(n=e.Tables[11].filter((function(e){return 2==e.AddressTypeID&&e.FEATUREPK==a.ScreenObject.DebitAccount.SelectedValue})),t=e.Tables[10].filter((function(e){return 2==e.AddressTypeID})),this.AssignAddress.BillTo.push(m.d.ComboBoxItems_2("","")),n.forEach((function(e){a.AssignAddress.BillTo.push(m.d.ComboBoxItems_2(e.AddressName.toString(),e.AddressID.toString())),t.length>0&&t[0].addressid.toString()==e.AddressID.toString()&&(a.AssignAddress.SelectedBillTo=e.AddressID.toString(),a.AssignAddress.AddressName.Text=o.e.String(e.ContactPerson),a.AssignAddress.Address1.Text=o.e.String(e.Address1)+" "+o.e.String(e.Address2)+" "+o.e.String(e.Address3),a.AssignAddress.Phone1.Text=o.e.String(e.Phone1),a.AssignAddress.AddressCity.Text=o.e.String(e.City)+" "+o.e.String(e.State)+" "+o.e.String(e.Zip),a.AssignAddress.BillToVisibility=!0)})),n=e.Tables[11].filter((function(e){return e.AddressTypeID=e.FEATUREPK==a.ScreenObject.DebitAccount.SelectedValue})),t=e.Tables[10].filter((function(e){return 1==e.AddressTypeID})),this.AssignAddress.AddressTo.push(m.d.ComboBoxItems_2("","")),n.forEach((function(e){a.AssignAddress.AddressTo.push(m.d.ComboBoxItems_2(e.AddressName.toString(),e.AddressID.toString())),t.length>0&&t[0].addressid.toString()==e.AddressID.toString()&&(a.AssignAddress.SelectedAddressTo=e.AddressID.toString(),a.AssignAddress.AddressToName.Text=o.e.String(e.ContactPerson),a.AssignAddress.AddressTo1.Text=o.e.String(e.Address1)+" "+o.e.String(e.Address2)+" "+o.e.String(e.Address3),a.AssignAddress.PhoneTo1.Text=o.e.String(e.Phone1),a.AssignAddress.AddressToCity.Text=o.e.String(e.City)+" "+o.e.String(e.State)+" "+o.e.String(e.Zip),a.AssignAddress.AddressToVisbility=!0)}))),this.AssignAddress.IsEditing=!1)}},{key:"CheckViewOnLoad",value:function(){var e=this;try{var t=this.ScreenObject.Data.Tables[10].filter((function(e){return 6==e.Mode}));t.forEach((function(t){o.e.IsEmpty(t.Expression)||o.e.IsEmpty(t.ActionOptionID)||"1"==s.a.eval.EvaluateExpression(t.Expression.toString(),e.FooterDics).toString().toString()&&("4"==t.ActionOptionID.toString()&&(e.ScreenObject.DocID=0,e.ScreenObject.VoucherNo="",e.clear(1)),alert(t.FailureMessage.toString()))})),(t=this.ScreenObject.Data.Tables[10].filter(null!=this.ScreenObject.Link&&"[Open]"!=this.ScreenObject.Link.LinkStatus?369==this.StatusID?function(e){return-2==e.CostCenterColID&&(2==e.Mode||3==e.Mode||4==e.Mode||5==e.Mode)}:function(e){return-2==e.CostCenterColID&&(2==e.Mode||3==e.Mode||5==e.Mode)}:369==this.StatusID?function(e){return-2==e.CostCenterColID&&(2==e.Mode||3==e.Mode||4==e.Mode)}:function(e){return-2==e.CostCenterColID&&(2==e.Mode||3==e.Mode)})).length>0?(this.BodyVisible=Object(l.j)(t[0].IsVisible),this.ReadOnlyBody=!Object(l.j)(t[0].IsEditable)):(this.BodyVisible=!0,this.ReadOnlyBody=!1,this.ReadOnlyBody=!(!this.ScreenObject.Preferences.ContainsKey("Lock Body")||""==this.ScreenObject.Preferences["Lock Body"]||!Object(l.j)(this.ScreenObject.Preferences["Lock Body"]))),this.IsInventoryVoucher&&null!=this.AssignAddress&&(this.AssignAddress.BillsVisibe=!!this.ScreenObject.Preferences.ContainsKey("BillingAddress")&&Object(l.j)(this.ScreenObject.Preferences.BillingAddress),this.AssignAddress.ShipVisibe=!!this.ScreenObject.Preferences.ContainsKey("ShippingAddress")&&Object(l.j)(this.ScreenObject.Preferences.ShippingAddress),this.AssignAddress.PrimVisibe=!!this.ScreenObject.Preferences.ContainsKey("PrimaryAddress")&&Object(l.j)(this.ScreenObject.Preferences.PrimaryAddress),t=this.ScreenObject.Data.Tables[10].length>0?this.ScreenObject.Data.Tables[10].filter((function(e){return-6==e.CostCenterColID&&(2==e.Mode||3==e.Mode)})):[],this.AssignAddress.PrimVisibe&&t.length>0?(this.AssignAddress.PrimVisibe=Object(l.j)(t[0].IsVisible),this.AssignAddress.PrimMandatory=Object(l.j)(t[0].IsMandatory)):this.AssignAddress.PrimMandatory=!1,t=this.ScreenObject.Data.Tables[10].length>0?this.ScreenObject.Data.Tables[10].filter((function(e){return-7==e.CostCenterColID&&(2==e.Mode||3==e.Mode)})):[],this.AssignAddress.BillsVisibe&&t.length>0?(this.AssignAddress.BillsVisibe=Object(l.j)(t[0].IsVisible),this.AssignAddress.BillsMandatory=Object(l.j)(t[0].IsMandatory)):this.AssignAddress.BillsMandatory=!1,t=this.ScreenObject.Data.Tables[10].length>0?this.ScreenObject.Data.Tables[10].filter((function(e){return-8==e.CostCenterColID&&(2==e.Mode||3==e.Mode)})):[],this.AssignAddress.ShipVisibe&&t.length>0?(this.AssignAddress.ShipVisibe=Object(l.j)(t[0].IsVisible),this.AssignAddress.ShipMandatory=Object(l.j)(t[0].IsMandatory)):this.AssignAddress.ShipMandatory=!1)}catch(n){}}},{key:"Addguid",value:function(){var e,t=this;(this.ScreenObject.GridDataColumns.Contains("StyleHeightZero")?this.ScreenObject.GridDataColumns.push("tempcol"):this.ScreenObject.GridDataColumns.push("StyleHeightZero"),this.ScreenObject.Preferences.ContainsKey("DbCrBills")&&"True"==o.e.String(this.ScreenObject.Preferences.DbCrBills))&&function(){var n="";t.ScreenObject.Preferences.ContainsKey("DbCrBills")&&"True"==t.ScreenObject.Preferences.DbCrBills.toString()&&t.ScreenObject.Preferences.ContainsKey("NetAmountFld")&&""!=t.ScreenObject.Preferences.NetAmountFld&&(n=t.ScreenObject.Preferences.NetAmountFld),t.ScreenObject.GridDataColumns.Contains("guidCol")||t.ScreenObject.GridDataColumns.push("guidCol");var a;a=18==t.ScreenObject.DocumentType||19==t.ScreenObject.DocumentType||21==t.ScreenObject.DocumentType||22==t.ScreenObject.DocumentType?"CreditAccount_Key":14==t.ScreenObject.DocumentType||15==t.ScreenObject.DocumentType||20==t.ScreenObject.DocumentType||23==t.ScreenObject.DocumentType?"DebitAccount_Key":"AccountID_Key";for(var i=function(i){!o.e.IsEmpty(t.ScreenObject.GridData[i].Amount)&&parseFloat(t.ScreenObject.GridData[i].Amount.toString())>0&&(e=t.ScreenObject.GridData.filter((function(e){return e[a]==o.e.String(t.ScreenObject.GridData[i][a])&&e.Amount<0&&null==e.guidCol}))).length>0&&(t.ScreenObject.GridData[i].guidCol=o.e.NewGuid(),e[0].guidCol=t.ScreenObject.GridData[i].guidCol.toString(),""!=n&&(e[0].StyleHeightZero=1))},r=0;r<t.ScreenObject.GridData.length;r++)i(r)}();this.ScreenObject.UpdateSequence(),this.ScreenObject.GridDataColumns.Contains("tempcol")&&this.ScreenObject.GridDataColumns.Remove("tempcol")}},{key:"LoadEditCallBack",value:function(e){var t,n=this,i=this.GetButton("Submit"),r=this.GetButton("History");if(this.WfID=0,this.WorkFlowDocLevel=0,this.IsLocked=!1,this.IsReplaced=0,this.LCDueAmt=0,i.Visible=!1,this.ChkRtnXml="",this.DisplayMessage="",this.MessageVisibility=!1,this.IsUserLock=!1,this.ArApBills="",null!=this.pdcGCVM&&(this.pdcGCVM=new he.a(this)),this.ScreenObject.Preferences.ContainsKey("DbCrBills")&&"True"==o.e.String(this.ScreenObject.Preferences.DbCrBills)&&this.Addguid(),!this.IsInventoryVoucher&&16!=this.DocumentType&&e.Columns[0].Contains("Description")&&e.Tables[0].length>0&&!o.e.IsEmpty(e.Tables[0][0].Description)&&this.pdcGCVM.loadFromxml(e.Tables[0][0].Description.toString(),this.ScreenObject.GridData[0].Amount.toString()),56==this.ScreenObject.DocumentType&&this.LoanGuaranteeVisible){this.dtLoanGuarantees=null;var c=s.a.common.GetDataSet("PAY051",this.DocID.toString()).Tables[0];if(null!=c&&c.length>0){var u;this.dtLoanGuarantees=[];for(var d=0;d<c.length;d++)(u={}).GEmpSeqNo=c[d].GEmpSeqNo.toString(),this.dtLoanGuarantees.push(u)}}if(61==this.ScreenObject.DocumentType){this.dtVacDefineDays=null;var D=s.a.common.GetDataSet("PAY052",this.DocID.toString()).Tables[0];if(null!=D&&D.length>0){var b;this.dtVacDefineDays=[];for(var g=0;g<D.length;g++)(b={}).SNo=D[g].SNo.toString(),b.FromMonth=D[g].FromMonth.toString(),b.ToMonth=D[g].ToMonth.toString(),b.DaysPerMonth=D[g].DaysPerMonth.toString(),b.ApplyToPrevMonths=D[g].ApplyToPrevMonths.toString(),this.dtVacDefineDays.push(b)}}62==this.ScreenObject.DocumentType&&(this.dtData=e.Tables[1]),this.FillCreatedByDate_ds(e),null!=this.Currency&&null!=this.Currency.Currency&&null!=this.Currency.Currency.SelectedValue&&(this.lastCurr=this.Currency.Currency.SelectedValue),this.ButtonApprove.Visible=!1,null!=this.ViewNotes&&this.ViewNotes.NotesListObj.Clear(),null!=this.DtPack&&this.DtPack.Clear(),null!=this.ViewAttachments&&this.ViewAttachments.AttachmentsListObj.Clear(),null!=this.grdLinkTab&&(this.grdLinkTab.Clear(),this.grdLinkTab.loadGrid(this.ScreenObject.VoucherNo),this.grdLinkTab.linkTabs.Pages.map((function(e){return e.IsAccordionOpen=n.ScreenObject.Preferences.ContainsKey("OpenAllSection")&&"True"==n.ScreenObject.Preferences.OpenAllSection}))),null!=this.ViewActivities&&this.ViewActivities.ActivityGridDataObj.Clear(),null!=this.Activities&&this.Activities.ClearFields(),null!=this.AssignAddress&&(this.AssignAddress.AddressTo.Clear(),this.AssignAddress.BillTo.Clear(),this.AssignAddress.ShipTo.Clear()),null!=this.ViewOrganizationViewModel&&this.ViewOrganizationViewModel.OrganizationData.Clear(),this.ScreenObject.IsForecast&&this.ScreenObject.GridDataObj.RefreshColumns(),this.StatusID=parseInt(e.Tables[0][0].StatusID),e.Columns[0].Contains("WorkFlowLevel")&&null!=e.Tables[0][0].WorkFlowLevel&&372!=this.StatusID&&(this.WorkFlowDocLevel=parseInt(e.Tables[0][0].WorkFlowLevel)),null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&e.Columns[0].Contains("DocNumber")&&e.Tables[0][0].DocNumber.toString()!=this.ScreenObject.DocPrefix.TextBox.Text&&(this.ScreenObject.DocPrefix.TextBox.Text=e.Tables[0][0].DocNumber.toString()),null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&e.Columns[0].Contains("DocDate")&&!o.e.IsEmpty(e.Tables[0][0].DocDate)&&(this._Ddate=new Date(e.Tables[0][0].DocDate),this.ScreenObject.DocDate.Date=this.DocumentDate,38!=this.ScreenObject.DocumentType&&this.ScreenObject.SetView(this.ScreenObject.DocDate,this.StatusID));var O=this.GetButton("GST");null!=O&&(this.IsInventoryVoucher&&369==this.StatusID?s.a.SessionManager.HideUnathorizedAccess?O.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"GST"):O.Enable=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"GST"):O.Visible=!1);var I=this.GetButton("API");null!=I&&(369==this.StatusID?s.a.SessionManager.HideUnathorizedAccess?I.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"API"):I.Enable=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"API"):I.Visible=!1);var T=this.GetButton("Generate");if(this.IsInventoryVoucher){null!=T&&(T.Visible=!(e.Columns[0].Contains("LinkStatusID")&&0==e.Tables[0].filter((function(e){return 445!=e.LinkStatusID})).length||369!=this.StatusID&&(372!=this.StatusID||!this.ScreenObject.Preferences.ContainsKey("LinkUnposted")||""==this.ScreenObject.Preferences.LinkUnposted||!Object(l.j)(this.ScreenObject.Preferences.LinkUnposted))));var j,P=this.GetButton("Advance");if(369==this.StatusID&&null!=P?P.Visible=!0:null!=P&&(P.Visible=!1),this.IsEdit&&null!=this.ScreenObject.Link&&null!=this.ScreenObject.Link.LinkCombo&&null!=this.ScreenObject.Link.LinkCombo.SelectedValue&&""!=this.ScreenObject.Link.LinkCombo.SelectedValue&&parseInt(this.ScreenObject.Link.LinkCombo.SelectedValue)>0&&(this.IsEdit=!1,this.OLinkSelectionChanged("")),e.Tables.length>0&&e.Columns[0].Contains("IsQtyIgnored")&&e.Tables[0].length>0&&!o.e.IsEmpty(this.donotupInv))for(var A=0;A<e.Tables[0].length;A++)if("6"!=e.Tables[0][A].ProductTypeID.toString()&&"8"!=e.Tables[0][A].ProductTypeID.toString()&&"3"!=e.Tables[0][A].ProductTypeID.toString()){o.e.IsEmpty(e.Tables[0][A].IsQtyIgnored)||(this.donotupInv.IsChecked=Object(l.j)(e.Tables[0][A].IsQtyIgnored));break}if(this.linkStatusRemarks=e.Tables.length>0&&e.Columns[0].Contains("LinkStatusRemarks")&&e.Tables[0].length>0&&!o.e.IsEmpty(e.Tables[0][0].LinkStatusRemarks)?e.Tables[0][0].LinkStatusRemarks.toString():"",null!=this.ViewNotes&&e.Tables.length>7&&this.ViewNotes.LoadNotes(e.Tables[7]),null!=this.ViewAttachments&&e.Tables.length>8&&this.ViewAttachments.LoadAttachments(e.Tables[8],e.Tables[0]),e.Tables.length>9&&(null!=this.ViewActivities?(this.ViewActivities.NodeID=this.DocID,this.ViewActivities.LoadActivityData(e.Tables[9])):e.Tables[9].length>0&&(this.ViewActivities.NodeID=this.DocID,this.NodeID=this.DocID,this.ViewActivities.CloseVisible=!0,this.ViewActivities.LoadActivityData(e.Tables[9]))),this.AddAddress(e),this.ScreenObject.Data.Tables[0].length>0&&this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&((j=this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&50455==e.LinkData}))).length>0&&this.ScreenObject.GridDataColumns.Contains(j[0].SysColumnName)&&this.ScreenObject.GridData.forEach((function(e){o.e.IsEmpty(e.ProductID_Key)||n.CalculateTotals(e,!1)}))),e.Tables.length>15&&e.Columns[15].Contains("Amount")){var M="";if(e.Tables[15].length>0){M+="<Paymentterms>";for(var v=0;v<e.Tables[15].length;v++)o.e.IsEmpty(e.Tables[15][v].Amount)||(M+="<Row ",M+=' Percentage="'+e.Tables[15][v].Percentage.toString()+'" ',M+=' BasedOn="'+e.Tables[15][v].BasedOn.toString()+'" ',M+=' Period="'+e.Tables[15][v].Period.toString()+'" ',o.e.IsEmpty(e.Tables[15][v].BaseDate)||(M+=' BaseDate="'+new Date(e.Tables[15][v].BaseDate).ToString("dd/MMM/yyyy")+'" '),e.Columns[15].Contains("ProfileID")&&!o.e.IsEmpty(e.Tables[15][v].ProfileID)&&(M+=' ProfileId="'+e.Tables[15][v].ProfileID.toString()+'" ',M+=' ProfileName="'+o.e.String(e.Tables[15][v].ProfileName)+'" '),o.e.IsEmpty(e.Tables[15][v].DimCCID)||(M+=' DimCCID="'+e.Tables[15][v].DimCCID.toString()+'" '),o.e.IsEmpty(e.Tables[15][v].DimNodeID)||(M+=' DimNodeID="'+e.Tables[15][v].DimNodeID.toString()+'" '),M+=' Accountid="'+e.Tables[15][v].AccountID.toString()+'" ',M+=' Amount="'+e.Tables[15][v].Amount.toString()+'" ',o.e.IsEmpty(e.Columns[15].Contains("AmountFC")&&e.Tables[15][v].AmountFC)||(M+=' AmountFC="'+e.Tables[15][v].AmountFC.toString()+'" '),M+=' Days="'+e.Tables[15][v].days.toString()+'" ',o.e.IsEmpty(e.Tables[15][v].DueDate)||(M+=' DueDate="'+new Date(e.Tables[15][v].DueDate).ToString("dd/MMM/yyyy")+'" '),M+=' Remarks="'+h.d.GetValidXml(e.Tables[15][v].Remarts)+'" ',M+=" /> ");M+="</Paymentterms>",this.payTermXml=M}}if(null!=e&&e.Tables.length>27&&e.Tables[27].length>0&&e.Columns[27].Contains("Refdocno")){for(var G="",N=0;N<e.Tables[27].length;N++)G+='<NonAccRows  RefDocNo="'+e.Tables[27][N].Refdocno.toString()+'" Amount="',G+=e.Tables[27][N].Amount.toString()+'" ',38!=this.DocumentType&&(G+='AccountID="'+e.Tables[27][N].AccountID.toString()+'" '),G+=" />";this.ArApBills=G}if(e.Tables.length>23&&e.Tables[23].length>0&&e.Columns[23].Contains("AdjAmount")){var E="";E+="<ChkRtnXML>";for(var w=0;w<e.Tables[23].length;w++)o.e.IsEmpty(e.Tables[23][w].AdjAmount)||(E+="<Row ",E+='DocSeqNo="1" ',E+=' AccountID="'+e.Tables[23][w].AccountID.toString()+'" ',E+='IsNewReference="0" ',E+=' RefDocNo="'+e.Tables[23][w].RefDocNo.toString()+'" ',E+=' RefDocSeqNo="'+e.Tables[23][w].RefDocSeqNo.toString()+'" ',o.e.IsEmpty(e.Tables[23][w].RefDocDate)||(E+=' RefDocDate="'+new Date(e.Tables[23][w].RefDocDate).ToString("dd/MMM/yyyy")+'" '),E+=' AdjAmount="'+e.Tables[23][w].AdjAmount.toString()+'" ',E+=' Amount="'+e.Tables[23][w].AmountFC.toString()+'" ',E+=' AdjCurrID="'+e.Tables[23][w].AdjCurrID.toString()+'" ',E+=' AdjExchRT="'+e.Tables[23][w].AdjExchRT.toString()+'" ',o.e.IsEmpty(e.Tables[23][w].RefDocDueDate)||(E+=' RefDocDueDate="'+new Date(e.Tables[23][w].RefDocDueDate).ToString("dd/MMM/yyyy")+'" '),E+=' Narration="'+e.Tables[23][w].Narration.toString()+'" ',E+=" /> ");E+="</ChkRtnXML>",this.ChkRtnXml=E}if(null!=this.POSPayModes&&this.IsPOs&&e.Tables.length>16&&e.Columns[16].Contains("Amount")){this.POSPayModes.clear();for(var F=function(t){var a=n.POSPayModes.PayModes.find((function(n){return n.DBColumnName==e.Tables[16][t].DBColumnName.toString()}));if(a){var i;t<n.POSPayModes.GridData.length?i=n.POSPayModes.GridData[t]:(i=n.POSPayModes.GridDataObj.NewRow(),n.POSPayModes.GridData.push(i)),i.Name=a.Label,i.Amount=e.Tables[16][t].Amount.toString(),i.ColumnName=a.DBColumnName,i.Type=a.SectionID;var r="";if(r+='<XML Amount="'+e.Tables[16][t].Amount.toString()+'" ',r+=' DBColumnName="'+a.DBColumnName+'" ',r+=' Type="'+a.SectionID+'" ',r+=' RegisterID="'+n.ScreenObject.RegisterNodeID+'" ',r+=' ShiftID="'+n.ScreenObject.ShiftNodeID+'" ',r+=' DocDate="'+n.DocumentDate.ToString("dd/MMM/yyyy")+'" ',"5"==a.SectionID&&n.ScreenObject.Preferences.ContainsKey("CashForeignCurrency")&&Object(l.j)(n.ScreenObject.Preferences.CashForeignCurrency)){if(!o.e.IsEmpty(e.Tables[16][t].Currency)){r+=' Currency="'+e.Tables[16][t].Currency.toString()+'" ';var s=n.POSPayModes.Currency.Currency.Items.find((function(n){return n.Value==e.Tables[16][t].Currency.toString()}));s&&(i.Description=e.Tables[16][t].AmountFC.toString()+" "+s.Name+"@"+e.Tables[16][t].ExchangeRate.toString())}o.e.IsEmpty(e.Tables[16][t].ExchangeRate)||(r+=' ExchangeRate="'+e.Tables[16][t].ExchangeRate.toString()+'" '),o.e.IsEmpty(e.Tables[16][t].AmountFC)||(r+=' FCAmt="'+e.Tables[16][t].AmountFC.toString()+'" ')}if("6"==a.SectionID||"7"==a.SectionID)i.Description=e.Tables[16][t].CardNo.toString(),r+=' CardNo="'+h.d.GetValidXml(e.Tables[16][t].CardNo)+'" ',r+=' CardName="'+h.d.GetValidXml(e.Tables[16][t].CardName)+'" ',o.e.IsEmpty(e.Tables[16][t].ExpDate)||(r+=' ExpDate="'+new Date(e.Tables[16][t].ExpDate).ToString("dd/MMM/yyyy")+'" '),"6"==a.SectionID&&(r+=' ApprovalCode="'+h.d.GetValidXml(e.Tables[16][t].ApprovalCode)+'" ',o.e.IsEmpty(e.Tables[16][t].BankName)||(r+=' BankName="'+e.Tables[16][t].BankName.toString()+'" '),o.e.IsEmpty(e.Tables[16][t].CardType)||(r+=' CardType="'+e.Tables[16][t].CardType.toString()+'" '));else if("5"==a.SectionID||"8"==a.SectionID){var c="",u=null;u=e.Tables[17].filter("5"==a.SectionID?function(e){return-10!=e.CurrencyID}:function(e){return-10==e.CurrencyID});for(var d=0;d<u.length;d++)c+='<XML IsDenom="1" ',o.e.IsEmpty(u[d].Notes)||o.e.IsEmpty(u[d].NotesTender)||(c+=' CurrencyID="'+u[d].CurrencyID.toString()+'" Notes="'+u[d].Notes.toString()+'"  NotesTender="',c+=u[d].NotesTender.toString()+'"  Change="'),o.e.IsEmpty(u[d].Change)||o.e.IsEmpty(u[d].ChangeTender)?c+='0" ChangeTender="0" />':c+=u[d].Change.toString()+'" ChangeTender="'+u[d].ChangeTender.toString()+'" />';i.Denomination=c.toString()}else"9"!=a.SectionID&&"10"!=a.SectionID||(i.Description=e.Tables[16][t].CardNo.toString(),r+=' CardNo="'+h.d.GetValidXml(e.Tables[16][t].CardNo)+'" ',"9"==a.SectionID&&(r+=' VoucherNodeID="'+e.Tables[16][t].VoucherNodeID.toString()+'" '));r+=" />",i.Details=r}else"12"==e.Tables[16][t].Type.toString()&&e.Tables[16][t].DBColumnName.toString().toLowerCase()==n.POSPayModes.Returnfld.toLowerCase()&&(n.POSPayModes.Return=""==n.POSPayModes.ReturnDecimalPoints||o.e.IsEmpty(e.Tables[16][t].Amount)?""!=n.POSPayModes.ReturnDecimalPoints?(0).ToString("N"+n.POSPayModes.ReturnDecimalPoints):e.Tables[16][t].Amount.toString():parseFloat(e.Tables[16][t].Amount).ToString("N"+n.POSPayModes.ReturnDecimalPoints))},V=0;V<e.Tables[16].length;V++)F(V)}if(30==this.ScreenObject.DocumentType&&this.ScreenObject.Preferences.ContainsKey("UseasAssemble/DisAssembly")&&Object(l.j)(this.ScreenObject.Preferences["UseasAssemble/DisAssembly"])&&e.Tables.length>20&&e.Tables[20].length>0){var L=this.ScreenObject.GridData.filter((function(t){return t.ProductID_key==e.Tables[20][0].ParentProductID}));if(L.length>0){this.ScreenObject.GridDataColumns.Contains("IsKit")||this.ScreenObject.GridDataColumns.push("IsKit"),L[0].IsKit=1;for(var R=function(t){o.e.IsEmpty(n.ScreenObject.GridData[t].ProductID_Key)||(L=e.Tables[20].filter((function(e){return e.ProductID==n.ScreenObject.GridData[t].ProductID_Key}))).length>0&&(n.ScreenObject.GridData[t].IsKit=2,n.ScreenObject.GridData[t].DefaultQuantity=L[0].Quantity)},B=0;B<this.ScreenObject.GridData.length;B++)R(B)}}if(35==this.ScreenObject.DocumentType&&null!=this.ViewOrganizationViewModel&&null!=e&&e.Tables.length>17&&e.Tables[17].length>0&&this.ViewOrganizationViewModel.LoadData(e.Tables[17]),null!=e&&e.Tables.length>18&&e.Tables[18].length>0&&e.Columns[18].Contains("DocID")&&!o.e.IsEmpty(e.Tables[18][0].DocID)){if(this.AutoPostDocID=null!=this.AutoPostViewModel&&this.AutoPostViewModel.CostCenterID.toString()==e.Tables[18][0].costcenterid.toString()?parseInt(e.Tables[18][0].DocID):e.Tables[18].length>1&&null!=this.AutoPostViewModel&&this.AutoPostViewModel.CostCenterID.toString()==e.Tables[18][1].costcenterid.toString()?parseInt(e.Tables[18][1].DocID):0,this.AutoProduceDocID=null!=this.AutoProduce&&this.AutoProduce.CostCenterID.toString()==e.Tables[18][0].costcenterid.toString()?parseInt(e.Tables[18][0].DocID):e.Tables[18].length>1&&null!=this.AutoProduce&&this.AutoProduce.CostCenterID.toString()==e.Tables[18][1].costcenterid.toString()?parseInt(e.Tables[18][1].DocID):0,null!=this.AutoPostViewModel)if(this.AutoPostDocID>0){this.AutoPostViewModel.ScreenObject.DocID=this.AutoPostDocID;var x=this.AutoPostViewModel.ScreenObject.GetEditDataByDOCID();if(null!=e&&this.AutoPostViewModel.ScreenObject.IsDocEdit&&x.Tables.length>0&&x.Tables[0].length>0){if(this.AutoPostViewModel.ScreenObject.LoadEditData(x,!1),this.ScreenObject.Preferences.ContainsKey("Autopostdocument")&&""!=this.ScreenObject.Preferences.Autopostdocument&&"0"!=this.ScreenObject.Preferences.Autopostdocument){var k=this.AutoPostViewModel.ScreenObject._TextFields.find((function(e){return e.DBColumnName.toLowerCase()==n.ScreenObject.Preferences.FPQty.toLowerCase()}));if(k&&k instanceof h.d){var _=o.e.NewGuid().toString(),K=0;o.e.IsNum(k.Text)&&(K=parseFloat(k.Text));for(var Q=0;Q<this.AutoPostViewModel.ScreenObject.GridData.length;Q++)o.e.IsEmpty(this.AutoPostViewModel.ScreenObject.GridData[Q].ProductID_Key)||o.e.IsEmpty(this.AutoPostViewModel.ScreenObject.GridData[Q].Quantity)||(this.AutoPostViewModel.ScreenObject.GridData[Q].RefSeqNo=_,this.AutoPostViewModel.ScreenObject.GridData[Q].defaultQuantity=parseFloat(this.AutoPostViewModel.ScreenObject.GridData[Q].Quantity)/K);this.ScreenObject.GridData.length>0&&(this.ScreenObject.GridData[0].RefSeqNo=_)}}this.AutoPostViewModel.RefreshGrid=!0}}else this.AutoPostViewModel.ScreenObject.GridData.Clear();if(null!=this.AutoProduce)if(this.AutoProduce.ScreenObject.DocID=this.AutoProduceDocID,this.AutoProduceDocID>0){var H=this.AutoProduce.ScreenObject.GetEditDataByDOCID();null!=e&&this.AutoProduce.ScreenObject.IsDocEdit&&H.Tables.length>0&&H.Tables[0].length>0&&this.AutoProduce.ScreenObject.LoadEditData(H,!1)}else this.AutoProduce.ScreenObject.GridData.Clear()}else this.AutoPostDocID=0,null!=this.AutoPostViewModel&&this.AutoPostViewModel.ScreenObject.GridData.Clear(),this.AutoProduceDocID=0,null!=this.AutoProduce&&this.AutoProduce.ScreenObject.GridData.Clear();if(null!=this.DtTempSchemes&&this.DtTempSchemes.Clear(),null!=e&&e.Tables.length>26&&e.Tables[26].length>0&&e.Columns[26].Contains("InvDocDetailsID")){var W=e.Tables[26].filter((function(e){return 2==e.Type})),U=0;if(W.length>0){null==this.DtPack&&(this.DtPack=[],this.DtPackColumns.push("ID"),this.DtPackColumns.push("Name"),this.DtPackColumns.push("Label"),this.DtPackColumns.push("cWeight"),this.DtPackColumns.push("cVolume"),this.DtPackColumns.push("Weight"),this.DtPackColumns.push("Volume"),this.DtPackColumns.push("Height"),this.DtPackColumns.push("length"),this.DtPackColumns.push("Width"),this.DtPackColumns.push("ActualWeight"),this.DtPackColumns.push("ActualVolume"),(this.ScreenObject.Preferences.ContainsKey("PackWiseProds")&&"true"==this.ScreenObject.Preferences.PackWiseProds.toLowerCase()||this.ScreenObject.Preferences.ContainsKey("LineWisePacking")&&"true"==this.ScreenObject.Preferences.LineWisePacking.toLowerCase())&&this.DtPackColumns.push("Data"));for(var X="",q=function(t){var a=W[t];""!=X&&(X+=","),X+=a.RefID.toString();var i=void 0,r=n.DtPack.filter((function(e){return e.Label==a.label.toString()}));if(0==r.length?((i={}).ID=a.RefID.toString(),i.Label=a.label.toString(),o.e.IsEmpty(a.Fld1)||(i.length=a.Fld1),o.e.IsEmpty(a.Fld2)||(i.Width=a.Fld2),o.e.IsEmpty(a.Fld3)||(i.Height=a.Fld3),o.e.IsEmpty(a.Fld4)||(i.ActualWeight=a.Fld4),o.e.IsEmpty(a.Fld5)||(i.ActualVolume=a.Fld5),n.DtPack.push(i)):i=r[0],n.DtPackColumns.Contains("Data")&&(i.Data=o.e.IsEmpty(i.Data)?a.Unq.toString()+"~"+a.Quantity.toString():i.Data.toString()+","+a.Unq.toString()+"~"+a.Quantity.toString()),e.Columns[0].Contains("Volume")){var s=e.Tables[0].filter((function(e){return e.DocDetailsID==a.InvDocDetailsID}));U=0,o.e.IsEmpty(s[0].Volume)||o.e.IsEmpty(a.Quantity)||(U=parseFloat(s[0].Volume)*parseFloat(a.Quantity)),i.cVolume=o.e.IsEmpty(i.cVolume)?U:parseFloat(i.cVolume)+U,U=0,o.e.IsEmpty(s[0].Weight)||o.e.IsEmpty(a.Quantity)||(U=parseFloat(s[0].Weight)*parseFloat(a.Quantity)),i.cWeight=o.e.IsEmpty(i.cWeight)?U:parseFloat(i.cWeight)+U}},Y=0;Y<W.length;Y++)q(Y);var z=this.ScreenObject.GetPackDetails(X);null!=z&&z.Tables.length>0&&z.Columns[0].Contains("Name")&&z.Tables[0].length>0&&z.Tables[0].forEach((function(e){n.DtPack.filter((function(t){return t.ID==e.Nodeid})).forEach((function(t){t.Name=e.Name}))}))}}}else{var J,Z=this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&55845==e.LinkData}));if(Z.length>0)if(this.ScreenObject.GridDataColumns.Contains(Z[0].SysColumnName))for(var $=0;$<e.Tables[0].length;$++)J=o.e.isValidDate(e.Tables[0][$].ClearanceDate)?new Date(e.Tables[0][$].ClearanceDate):void 0,this.ScreenObject.GridData[$].DocDetailsID==e.Tables[0][$].DocDetailsID&&null!=J&&J.getFullYear()>2e3&&(this.ScreenObject.GridData[$][Z[0].SysColumnName]=J.ToString(s.a.SessionManager.Preferences["Date Format"]),this.ScreenObject.GridDataColumns.Contains(Z[0].SysColumnName+"_Key")&&(this.ScreenObject.GridData[$][Z[0].SysColumnName+"_Key"]=J));else{var ee=this.ScreenObject._TextFields.find((function(e){return e.DBColumnID==parseInt(Z[0].CostCenterColID)}));ee&&o.e.isValidDate(e.Tables[0][0].ClearanceDate)&&((J=new Date(e.Tables[0][0].ClearanceDate)).getFullYear()>2e3&&(ee instanceof h.d?ee.Text=J.ToString(s.a.SessionManager.Preferences["Date Format"]):ee instanceof S.c&&(ee.Date=J)))}if((Z=this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&55846==e.LinkData}))).length>0)if(this.ScreenObject.GridDataColumns.Contains(Z[0].SysColumnName))for(var te=0;te<e.Tables[0].length;te++)this.ScreenObject.GridData[te].DocDetailsID==e.Tables[0][te].DocDetailsID&&("0"==e.Tables[0][te].BRS_Status.toString()?this.ScreenObject.GridData[te][Z[0].SysColumnName]=s.a.GetResource("Reports_Outstanding"):"1"==e.Tables[0][te].BRS_Status.toString()&&(this.ScreenObject.GridData[te][Z[0].SysColumnName]=s.a.GetResource("Reports_Cleared")));else{var ne=this.ScreenObject._TextFields.find((function(e){return e.DBColumnID==parseInt(Z[0].CostCenterColID)}));ne&&ne instanceof h.d&&("0"==e.Tables[0][0].BRS_Status.toString()?ne.Text=s.a.GetResource("Reports_Outstanding"):"1"==e.Tables[0][0].BRS_Status.toString()&&(ne.Text=s.a.GetResource("Reports_Cleared")))}this.IsReplaced=0,429==this.StatusID&&e.Tables[0].length>0&&e.Columns[0].Contains("IsReplce")&&o.e.IsNum(e.Tables[0][0].IsReplce)&&(this.IsReplaced=parseInt(e.Tables[0][0].IsReplce));var ae=this.GetButton("Redeposit");if(0==this.IsReplaced&&null!=ae&&e.Tables.length>6&&e.Tables[6].length>0&&e.Columns[6].Contains("CanRedeposit")&&e.Tables[6][0].CanRedeposit&&Object(l.j)(e.Tables[6][0].CanRedeposit)?ae.Visible=!0:null!=ae&&(ae.Visible=!1),null!=this.ViewNotes&&e.Tables.length>7&&this.ViewNotes.LoadNotes(e.Tables[7]),null!=this.ViewAttachments&&e.Tables.length>8&&this.ViewAttachments.LoadAttachments(e.Tables[8],e.Tables[0]),e.Tables.length>9&&(null!=this.ViewActivities?(this.ViewActivities.LoadActivityData(e.Tables[9]),this.ViewActivities.NodeID=this.DocID):e.Tables[9].length>0&&(this.ViewActivities.NodeID=this.DocID,this.NodeID=this.DocID,this.Activities.AssignVisiblity=!1,this.ViewActivities.CloseVisible=!0,this.ViewActivities.LoadActivityData(e.Tables[9]))),this.ScreenObject.Preferences.ContainsKey("UseAsLC")&&!o.e.IsEmpty(this.ScreenObject.Preferences.UseAsLC)&&Object(l.j)(this.ScreenObject.Preferences.UseAsLC)||this.ScreenObject.Preferences.ContainsKey("UseAsTR")&&!o.e.IsEmpty(this.ScreenObject.Preferences.UseAsTR)&&Object(l.j)(this.ScreenObject.Preferences.UseAsTR)){var ie=this.GetButton("Close");null!=ie&&(ie.Visible=!1),null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&e.Columns[0].Contains("StatusID")&&!o.e.IsEmpty(e.Tables[0][0].StatusID)&&(443==parseInt(e.Tables[0][0].StatusID.toString())?(null!=ie&&(ie.Visible=!1),this.ButtonApprove.Visible=!0):(null!=ie&&(ie.Visible=!0),this.ButtonApprove.Visible=!1,s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit")&&(i.Visible=!0),this.ButtonSaveandPrint.Enable=!1,this.ButtonSaveandBarcode.Enable=!1,this.ButtonSave.Enable=!1))}}if(e.Tables[0].length>0&&e.Columns[0].Contains("WorkflowID")&&!o.e.IsEmpty(e.Tables[0][0].WorkflowID)&&parseInt(e.Tables[0][0].WorkflowID)>0?(r.Visible=!0,this.WfID=parseInt(e.Tables[0][0].WorkflowID)):r.Visible=!1,e.Tables.length>6&&e.Tables[6].length>0&&e.Columns[6].Contains("CanEdit")&&!o.e.IsEmpty(e.Tables[6][0].CanEdit)&&!Object(l.j)(e.Tables[6][0].CanEdit)?369==this.StatusID&&(this.ScreenObject.Preferences.ContainsKey("NoWorkflowPostedDocs")&&""!=this.ScreenObject.Preferences.NoWorkflowPostedDocs&&Object(l.j)(this.ScreenObject.Preferences.NoWorkflowPostedDocs)||"true"==s.a.SessionManager.Preferences.EditApprovedDocuments.toLowerCase()||s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Posted Docs"))?(this.ButtonSaveandPrint.Enable=!0,this.ButtonSaveandBarcode.Enable=!0,this.ButtonSave.Enable=!0,this.WorkFlowDocLevel=0):441==this.StatusID&&s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Approved Docs")?(this.ButtonSaveandPrint.Enable=!1,this.ButtonSaveandBarcode.Enable=!1,this.ButtonSave.Enable=!1,this.WorkFlowDocLevel=0,i.Visible=!0):(this.ButtonSaveandPrint.Enable=!1,this.ButtonSaveandBarcode.Enable=!1,this.ButtonSave.Enable=!1):this.ScreenObject.Preferences.ContainsKey("UseAsLC")&&""!=this.ScreenObject.Preferences.UseAsLC&&Object(l.j)(this.ScreenObject.Preferences.UseAsLC)||this.ScreenObject.Preferences.ContainsKey("UseAsTR")&&""!=this.ScreenObject.Preferences.UseAsTR&&Object(l.j)(this.ScreenObject.Preferences.UseAsTR)||(e.Tables.length>6&&e.Tables[6].length>0&&e.Columns[6].Contains("canapprove")&&Object(l.j)(e.Tables[6][0].canapprove)?(this.ButtonApprove.Visible=!0,this.ButtonSave.Enable=!1):s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit")&&(this.ButtonApprove.Visible=!1,this.ButtonSave.Enable=!0),this.ButtonSaveandPrint.Enable=!0,this.ButtonSaveandBarcode.Enable=!0),!this.ButtonApprove.Visible&&e.Tables.length>6&&e.Tables[6].length>0&&e.Columns[6].Contains("WType")&&(e.Tables.length>6&&e.Tables[6].length>0&&e.Columns[6].Contains("userlevel")&&null!=e.Tables[6][0].userlevel&&e.Tables[6][0].Wlevel==e.Tables[6][0].userlevel&&369!=this.StatusID?(this.ButtonSave.Enable=!1,this.ButtonSaveandPrint.Enable=!1,this.ButtonSaveandBarcode.Enable=!1,s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit")&&(i.Visible=!0)):2==e.Tables[6][0].WType&&e.Tables.length>6&&e.Tables[6].length>0&&e.Columns[6].Contains("userlevel")&&(o.e.IsEmpty(e.Tables[6][0].userlevel)||!o.e.IsEmpty(e.Tables[6][0].Wlevel)&&parseInt(e.Tables[6][0].Wlevel)<parseInt(e.Tables[6][0].userlevel))&&369!=this.StatusID?(this.ButtonSave.Enable=!1,this.ButtonSaveandPrint.Enable=!1,this.ButtonSaveandBarcode.Enable=!1,s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit")&&o.e.IsEmpty(e.Tables[6][0].userlevel)&&(i.Visible=!0)):1==e.Tables[6][0].WType&&e.Tables.length>6&&e.Tables[6].length>0&&e.Columns[6].Contains("userlevel")&&null!=e.Tables[6][0].userlevel&&369!=this.StatusID&&(this.ButtonSave.Enable=!1,this.ButtonSaveandPrint.Enable=!1,this.ButtonSaveandBarcode.Enable=!1,s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit")&&(i.Visible=!0))),!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Printed Documents")&&e.Tables.length>6&&e.Tables[6].length>0&&e.Columns[6].Contains("IsPrinted")&&null!=e.Tables[6][0].IsPrinted&&Object(l.j)(e.Tables[6][0].IsPrinted)&&(this.ButtonSave.Enable=!1,this.ButtonSaveandBarcode.Enable=!1,this.ButtonSaveandPrint.Enable=!1),this.ButtonSuspend.Visible=!1,this.ButtonSuspend.Mandatory&&!this.IsPOs&&s.a.SessionManager.IsActionAssigned(43,"Modify Link Status")&&(this.ButtonSuspend.Visible=!0),this.IsPOs){var re=this.GetButton("Pay");null!=re&&(re.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"))}if(376!=this.StatusID&&this.ScreenObject.Preferences.ContainsKey("EnableRevision")&&""!=this.ScreenObject.Preferences.EnableRevision&&Object(l.j)(this.ScreenObject.Preferences.EnableRevision)?s.a.SessionManager.HideUnathorizedAccess?this.ButtonRevise.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Revise"):(this.ButtonRevise.Visible=!0,this.ButtonRevise.Enable=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Revise")):this.ButtonRevise.Visible=!1,371==this.StatusID&&this.ButtonSave.Enable||372==this.StatusID||438==this.StatusID?(372==this.StatusID?(this.ButtonSave.Enable=!1,this.ButtonApprove.Visible=!1,this.OnRejectEdit&&(!this.OnRejectEdit||o.e.IsEmpty(e.Tables[6][0].userlevel)||o.e.IsEmpty(e.Tables[6][0].Wlevel)||parseInt(e.Tables[6][0].Wlevel)-1!=parseInt(e.Tables[6][0].userlevel))||(s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit")||s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Rejected Documents"))&&(this.ButtonSave.Visible=!0,this.ButtonSave.Enable=!0,s.a.SessionManager.HideUnathorizedAccess?(this.ButtonSaveandPrint.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save&Print"),this.ButtonSaveandPrint.Enable=!0):this.ButtonSaveandPrint.Enable=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save&Print"),this.HideButtons("Save&Barcode"))):(s.a.SessionManager.HideUnathorizedAccess?(this.ButtonSave.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"),this.ButtonSave.Enable=!0):this.ButtonSave.Enable=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"),s.a.SessionManager.HideUnathorizedAccess?(this.ButtonSaveandPrint.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save&Print"),this.ButtonSaveandPrint.Enable=!0):this.ButtonSaveandPrint.Enable=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save&Print"),this.HideButtons("Save&Barcode")),this.HideButtons("BarcodePrint")):this.ButtonSave.Enable&&376!=this.StatusID&&(s.a.SessionManager.HideUnathorizedAccess?(this.ButtonSave.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"),this.ButtonSave.Enable=!0):this.ButtonSave.Enable=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"),s.a.SessionManager.HideUnathorizedAccess?(this.ButtonSaveandPrint.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save&Print"),this.ButtonSaveandPrint.Enable=!0):this.ButtonSaveandPrint.Enable=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save&Print"),this.HideButtons("Save&Barcode"),this.HideButtons("BarcodePrint"),376!=this.StatusID&&this.ScreenObject.Preferences.ContainsKey("EnableRevision")&&""!=this.ScreenObject.Preferences.EnableRevision&&Object(l.j)(this.ScreenObject.Preferences.EnableRevision)?s.a.SessionManager.HideUnathorizedAccess?this.ButtonRevise.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Revise"):(this.ButtonRevise.Visible=!0,this.ButtonRevise.Enable=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Revise")):this.ButtonRevise.Visible=!1),this.ButtonApprove.Visible&&(s.a.SessionManager.IsRptManagerUser||(s.a.SessionManager.HideUnathorizedAccess?this.ButtonApprove.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Approve"):this.ButtonApprove.Enable=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Approve")),s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit")&&(i.Visible=!0)),this.ScreenObject.Preferences.ContainsKey("enebleSaveonhold")&&"True"==this.ScreenObject.Preferences.enebleSaveonhold){var se=this.GetButton("Save");null!=se&&(438==this.StatusID?(se.Enable=this.ButtonSave.Enable,se.Visible=this.ButtonSave.Visible):se.Visible=!1)}if(25==this.ScreenObject.DocumentType&&((t=this.GetButton("Enquiries")).Visible=!(null==T||!T.Visible)||!(!this.ScreenObject.Preferences.ContainsKey("DisableGenerate")||"True"!=this.ScreenObject.Preferences.DisableGenerate||369!=this.StatusID)),31!=this.ScreenObject.DocumentType&&32!=this.ScreenObject.DocumentType&&63!=this.ScreenObject.DocumentType||(null!=(t=this.GetButton("Stock Posting"))&&(t.Visible=!1),null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&e.Columns[0].Contains("StatusID")&&!o.e.IsEmpty(e.Tables[0][0].StatusID)&&(443==parseInt(e.Tables[0][0].StatusID)?t.Visible=!0:369==parseInt(e.Tables[0][0].StatusID)&&(this.ButtonSave.Enable=!1,this.ButtonSaveandBarcode.Enable=!1,this.ButtonSaveandPrint.Enable=!1))),this.ScreenObject.Preferences.ContainsKey("batchpaymentreport")&&!o.e.IsEmpty(this.ScreenObject.Preferences.batchpaymentreport)&&"0"!=this.ScreenObject.Preferences.batchpaymentreport&&15==this.ScreenObject.DocumentType&&377==parseInt(e.Tables[0][0].StatusID.toString())&&(this.ButtonSave.Enable=!1,this.ButtonSaveandBarcode.Enable=!1,this.ButtonSaveandPrint.Enable=!1),t=this.GetButton("Bounce"),15!=this.ScreenObject.DocumentType&&18!=this.ScreenObject.DocumentType||(t.Visible=!0),18!=this.ScreenObject.DocumentType&&15!=this.ScreenObject.DocumentType||429!=this.StatusID||(t.Visible=!1,this.ButtonSave.Visible=!1,this.ButtonRevise.Visible=!1),this.ScreenObject.SetDefaultValuesforCostCenters(2),this.SetSaveVisibility(),this.CalculateTotals(null,!1),this.RefreshGrid=!0,this.RefreshGridFooter=!0,this.DQuickInfoVisibility=!1,this.QuickInfoVisibility=!1,this.ApproveVisibility=!1,this.VoucherDefVisibility=!1,14==this.ScreenObject.DocumentType||19==this.ScreenObject.DocumentType){this.DocStatus="";for(var oe=0;oe<e.Tables[0].length;oe++)if(e.Tables[0][oe].StatusID.toString()!=this.StatusID.toString()&&"[Partial]"!=this.DocStatus){this.DocStatus="[Partial]";break}var ce=this.ScreenObject.ColumnSource.find((function(e){return"StatusID"==e.DisplayMember}));ce&&(ce.IsVisible="[Partial]"==this.DocStatus)}if((this.ScreenObject.Preferences.ContainsKey("UseAsLC")&&""!=this.ScreenObject.Preferences.UseAsLC&&Object(l.j)(this.ScreenObject.Preferences.UseAsLC)||this.ScreenObject.Preferences.ContainsKey("UseAsTR")&&""!=this.ScreenObject.Preferences.UseAsTR&&Object(l.j)(this.ScreenObject.Preferences.UseAsTR))&&369==this.StatusID)this.DocStatus=s.a.GetResource("Status_Approved");else if(429==this.StatusID&&this.IsReplaced>0&&"[Partial]"!=this.DocStatus)1==this.IsReplaced?this.DocStatus="["+s.a.GetResource("Replaced")+"]":2==this.IsReplaced?this.DocStatus="["+s.a.GetResource("ReplacedPartial")+"]":e.Tables.length>6&&e.Columns[6].Contains("Status")&&e.Tables[6].length>0&&(this.DocStatus="Hold"==o.e.String(e.Tables[6][0].Status).Replace("-","_").Replace(" ","")?"["+s.a.GetResource("Status_Hold")+"]":"["+s.a.GetResource(e.Tables[6][0].Status.toString().Replace("-","_").Replace(" ",""))+"]");else if(e.Tables.length>6&&e.Columns[6].Contains("Status")&&e.Tables[6].length>0){this.ScreenObject.IsDocEdit&&("[Partial]"!=this.DocStatus||14!=this.ScreenObject.DocumentType&&19!=this.ScreenObject.DocumentType)&&(this.DocStatus="Hold"==o.e.String(e.Tables[6][0].Status).Replace("-","_").Replace(" ","")?"["+s.a.GetResource("Status_Hold")+"]":"["+s.a.GetResource(e.Tables[6][0].Status.toString().Replace("-","_").Replace(" ",""))+"]");var le=!1;if(this.ScreenObject.Preferences.ContainsKey("PostAsset")&&"true"==this.ScreenObject.Preferences.PostAsset.toLowerCase()&&(le=!0),this.ScreenObject.Preferences.ContainsKey("DimTransferSrc")&&parseInt(this.ScreenObject.Preferences.DimTransferSrc)>0&&(le=!0),5!=this.DocumentType&&8!=this.DocumentType&&13!=this.DocumentType||!this.ScreenObject.Preferences.ContainsKey("IsBudgetDocument")||"true"!=this.ScreenObject.Preferences.IsBudgetDocument.toLowerCase()&&"1"!=this.ScreenObject.Preferences.IsBudgetDocument||(le=!0),this.LineWiseApproval){for(var ue=!1,de=0;de<e.Tables[0].length;de++)if(de>0&&!o.e.IsEmpty(e.Tables[0][de].WorkFlowID)&&!o.e.IsEmpty(e.Tables[0][de-1].WorkFlowID)&&e.Tables[0][de].WorkFlowID.toString()!=e.Tables[0][de-1].WorkFlowID.toString()&&(ue=!0),de>0&&o.e.String(e.Tables[0][de].canapprove)!=o.e.String(e.Tables[0][de-1].canapprove)&&(ue=!0),o.e.String(e.Tables[0][de].StatusID)!=this.StatusID.toString()&&"[Partial]"!=this.DocStatus){this.DocStatus="[Partial]";break}if("[Partial]"!=this.DocStatus&&(369==this.StatusID&&le||this.ScreenObject.Preferences.ContainsKey("batchpaymentDoc")&&!o.e.IsEmpty(this.ScreenObject.Preferences.batchpaymentDoc)&&parseInt(this.ScreenObject.Preferences.batchpaymentDoc.toString())>4e4&&377==this.StatusID))this.ButtonSave.Enable=!1,this.ButtonSaveandBarcode.Enable=!1,this.ButtonSaveandPrint.Enable=!1,this.ButtonRevise.Enable=!1,this.ButtonSuspend.Enable=!1;else if("[Partial]"==this.DocStatus||ue){for(var De=!1,Se=!1,me=!1,be=0;be<e.Tables[0].length;be++)this.IsInventoryVoucher&&null!=T&&!T.Visible&&"369"==e.Tables[0][be].StatusID.toString()&&(T.Visible=!0),"369"==e.Tables[0][be].StatusID.toString()&&le&&(e.Tables[0][be].CanEdit="0"),e.Columns[0].Contains("CanApprove")&&"1"==e.Tables[0][be].CanApprove.toString()?Se=!0:e.Columns[0].Contains("CanEdit")&&"1"==e.Tables[0][be].CanEdit.toString()&&("372"==e.Tables[0][be].StatusID.toString()&&!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Rejected Documents")&&!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit")||"372"!=e.Tables[0][be].StatusID.toString()&&!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit")?e.Tables[0][be].CanEdit="0":De=!0),"372"==e.Tables[0][be].StatusID.toString()&&e.Columns[0].Contains("CanEdit")&&"1"==e.Tables[0][be].CanEdit.toString()&&(me=!0);Se&&s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Approve")?(e.Tables.length>6&&e.Tables[6].length>0&&e.Columns[6].Contains("WType")&&"2"!=e.Tables[6][0].WType.toString()&&(i.Visible=!!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit")),this.ButtonApprove.Visible=!0,this.ButtonSave.Enable=!1):me&&(s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Rejected Documents")||s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"))&&e.Tables.length>6&&e.Tables[6].length>0&&e.Columns[6].Contains("userlevel")&&!o.e.IsEmpty(e.Tables[6][0].userlevel)?(i.Visible=!1,this.ButtonApprove.Visible=!1,this.ButtonSave.Enable=!0,this.ButtonSave.Visible=!0):De&&s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit")?e.Tables.length>6&&e.Tables[6].length>0&&e.Columns[6].Contains("userlevel")&&!o.e.IsEmpty(e.Tables[6][0].userlevel)&&e.Tables[6][0].Wlevel.toString()==e.Tables[6][0].userlevel.toString()?(this.ButtonSave.Enable=!1,this.ButtonSaveandPrint.Enable=!1,this.ButtonSaveandBarcode.Enable=!1,i.Visible=!0):e.Tables.length>6&&e.Tables[6].length>0&&e.Columns[6].Contains("WType")&&"2"==e.Tables[6][0].WType.toString()&&(!e.Columns[6].Contains("userlevel")||!o.e.IsEmpty(e.Tables[6][0].userlevel))||s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Posted Docs")||s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Approved Docs")?(i.Visible=!1,this.ButtonApprove.Visible=!1,this.ButtonSave.Enable=!0):(i.Visible=!0,this.ButtonApprove.Visible=!1,this.ButtonSave.Enable=!1):(i.Visible=!1,this.ButtonApprove.Visible=!1,this.ButtonSave.Enable=!1)}}else(369==this.StatusID&&le||this.ScreenObject.Preferences.ContainsKey("batchpaymentDoc")&&!o.e.IsEmpty(this.ScreenObject.Preferences.batchpaymentDoc)&&parseInt(this.ScreenObject.Preferences.batchpaymentDoc.toString())>4e4&&377==this.StatusID)&&(this.ButtonSave.Enable=!1,this.ButtonSaveandBarcode.Enable=!1,this.ButtonSaveandPrint.Enable=!1,this.ButtonRevise.Enable=!1,this.ButtonSuspend.Enable=!1)}if(this.IsInventoryVoucher&&e.Tables.length>19&&e.Tables[19].length>0&&e.Columns[19].Contains("ExecutedQty")&&this.ScreenObject.Preferences.ContainsKey("ShowLinkStatus")&&""!=this.ScreenObject.Preferences.ShowLinkStatus&&Object(l.j)(this.ScreenObject.Preferences.ShowLinkStatus)){var Ce="";if(e.Columns[0].Contains("LinkStatusID")&&0==e.Tables[0].filter((function(e){return 445!=e.LinkStatusID})).length)Ce="Close";else{Ce="Open";var ye=0,pe=null;if(null!=(pe=5==this.DocumentType&&e.Columns[19].Contains("VoucherType")?e.Tables[19].filter((function(e){return-1==e.VoucherType})).Compute("sum","ExecutedQty"):e.Tables[19].Compute("sum","ExecutedQty"))&&pe.toString().length>0&&(ye=parseFloat(pe)),0==ye)Ce="Open";else Ce=(5==this.DocumentType&&e.Columns[19].Contains("VoucherType")?e.Tables[19].filter((function(e){return-1==e.VoucherType&&e.Quantity>e.ExecutedQty})):e.Tables[19].filter((function(e){return e.Quantity>e.ExecutedQty}))).length>0?"Pending":"Executed"}null!=this.ScreenObject.Link?this.ScreenObject.Link.LinkStatus="["+Ce+"]":(this.ScreenObject.linkstat=Ce,this.DocStatus+="("+s.a.GetResource(Ce.Replace("-","_").Replace(" ",""))+")")}if(this.ScreenObject.CheckViewForUser(this.StatusID),this.UpdateFooter=!0,this.ButtonSuspendDoc.Visible&&this.ButtonSuspendDoc.Enable||(s.a.SessionManager.HideUnathorizedAccess?this.ButtonSuspendDoc.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Suspend"):this.ButtonSuspendDoc.Enable=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Suspend")),e.Tables.length>6&&e.Tables[6].length>0&&e.Columns[6].Contains("IsLock")&&!o.e.IsEmpty(e.Tables[6][0].IsLock)&&Object(l.j)(e.Tables[6][0].IsLock)&&!s.a.SessionManager.IsActionAssigned(43,"Override Lock")?(this.ButtonSave.Enable=!1,this.ButtonSaveandBarcode.Enable=!1,this.ButtonSaveandPrint.Enable=!1,this.ButtonRevise.Enable=!1,this.ButtonSuspend.Enable=!1,this.ButtonDelete.Visible=!1,this.ButtonSuspend.Visible=!1,this.ButtonSuspendDoc.Visible=!1,i.Visible=!1,this.IsLocked=!0,this.ButtonApprove.Visible&&(s.a.SessionManager.IsActionAssigned(43,"Approve Locked Documents")||s.a.SessionManager.Preferences.ContainsKey("PostLockedDocs")&&Object(l.j)(s.a.SessionManager.Preferences.PostLockedDocs)||s.a.SessionManager.Preferences.ContainsKey("DocDateasPostedDate")&&Object(l.j)(s.a.SessionManager.Preferences.DocDateasPostedDate))||(this.ButtonApprove.Enable=!1)):null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&e.Columns[0].Contains("StatusID")&&!o.e.IsEmpty(e.Tables[0][0].StatusID)&&376==parseInt(e.Tables[0][0].StatusID)?(this.ButtonSaveandPrint.Enable=!1,this.ButtonSaveandBarcode.Enable=!1,this.ButtonApprove.Visible=!1,this.ButtonDelete.Visible=!1,this.ButtonSuspendDoc.Visible=!1,s.a.SessionManager.HideUnathorizedAccess?(this.ButtonSave.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Post Cancelled Documents"),this.ButtonSave.Enable=!0):this.ButtonSave.Enable=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Post Cancelled Documents")):r.Visible&&"true"==s.a.SessionManager.Preferences["Override Workflow"].toLowerCase()&&"1"==s.a.SessionManager.UserID?(this.ButtonDelete.Visible=!0,this.ButtonSuspendDoc.Visible=!0,this.ButtonRevise.Visible=!0,this.ButtonSave.Visible=!0,this.ButtonDelete.Enable=!0,this.ButtonSuspendDoc.Enable=!0,this.ButtonRevise.Enable=!0,this.ButtonSave.Enable=!0):r.Visible&&!(this.ButtonApprove.Enable&&this.ButtonApprove.Visible||this.ButtonSave.Enable&&this.ButtonSave.Visible)?e.Tables.length>6&&e.Tables[6].length>0&&e.Columns[6].Contains("userlevel")&&!o.e.IsEmpty(e.Tables[6][0].userlevel)&&e.Columns[6].Contains("Wlevel")&&o.e.String(e.Tables[6][0].Wlevel)==o.e.String(e.Tables[6][0].userlevel)&&i.Visible?this.ButtonDelete.Visible&&this.ButtonDelete.Enable||(this.ButtonDelete.Visible=!0,this.ButtonDelete.Enable=!0,this.ButtonSuspendDoc.Visible=!0,this.ButtonSuspendDoc.Enable=!0,s.a.SessionManager.HideUnathorizedAccess?this.ButtonDelete.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"):this.ButtonDelete.Enable=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),s.a.SessionManager.HideUnathorizedAccess?this.ButtonSuspendDoc.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Suspend"):this.ButtonSuspendDoc.Enable=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Suspend")):(this.ButtonDelete.Enable=!1,this.ButtonSuspendDoc.Enable=!1,this.ButtonRevise.Visible&&372==this.StatusID||(this.ButtonRevise.Visible=!1)):this.ButtonDelete.Visible&&this.ButtonDelete.Enable||(this.ButtonDelete.Visible=!0,this.ButtonDelete.Enable=!0,this.ButtonSuspendDoc.Visible=!0,this.ButtonSuspendDoc.Enable=!0,s.a.SessionManager.HideUnathorizedAccess?this.ButtonDelete.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"):this.ButtonDelete.Enable=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),s.a.SessionManager.HideUnathorizedAccess?this.ButtonSuspendDoc.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Suspend"):this.ButtonSuspendDoc.Enable=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Suspend")),!(r.Visible&&s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Suspend")&&s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Withdraw"))||this.ButtonSuspendDoc.Visible&&this.ButtonSuspendDoc.Enable||376==this.StatusID||(this.ButtonSuspendDoc.Visible=this.ButtonSuspendDoc.Enable=!0),s.a.SessionManager.HideUnathorizedAccess?r.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"History"):r.Enable=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"History"),s.a.SessionManager.Preferences.ContainsKey("LockEditMode")&&Object(l.j)(s.a.SessionManager.Preferences.LockEditMode)){var ge=this.GetButton("Lock");this.ButtonSave.Visible&&this.ButtonSave.Enable&&e.Tables.length>6&&e.Tables[6].length>0&&null==e.Tables[6][0].LockedBY?(ge.Visible=!0,ge.Label="Lock",ge.Mandatory=!0):e.Tables.length>6&&e.Tables[6].length>0&&null!=e.Tables[6][0].LockedBY&&(e.Tables[6][0].LockedBY.toString()==s.a.SessionManager.UserName?(ge.Visible=!0,ge.Mandatory=!1,ge.Label="Unlock"):(this.IsUserLock=!0,this.DocStatus+="(LockedBy "+e.Tables[6][0].LockedBY.toString()+")"))}if(s.a.SessionManager.IsOffline&&this.ScreenObject.DocID<0&&(e.Tables.length>6&&e.Tables[6].length>0&&e.Columns[6].Contains("OffLineStatus")&&"1"==e.Tables[6][0].OffLineStatus.toString()?(null!=(t=this.GetButton("Pay"))&&(t.Visible=!1),this.ButtonSave.Visible=this.ButtonDelete.Visible=i.Visible=this.ButtonRevise.Visible=this.ButtonSaveandPrint.Visible=!1):s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit")&&!this.ButtonSave.Visible&&(this.ButtonSave.Visible=!0,null!=(t=this.GetButton("Pay"))&&(t.Visible=!0),this.ButtonSuspendDoc.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Suspend"),this.ButtonDelete.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),this.ScreenObject.Preferences.ContainsKey("EnableRevision")&&""!=this.ScreenObject.Preferences.EnableRevision&&Object(l.j)(this.ScreenObject.Preferences.EnableRevision)&&(this.ButtonRevise.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Revise")))),this.ScreenObject.Preferences.ContainsKey("ShowPackStat")&&Object(l.j)(this.ScreenObject.Preferences.ShowPackStat))if(e.Tables[26].filter((function(e){return 2==e.Type})).length>0){for(var fe=!1,Oe=function(t){if(!o.e.IsEmpty(n.ScreenObject.GridData[t].DocDetailsID)){var a=e.Tables[26].filter((function(e){return 2==e.Type&&e.InvDocDetailsID==n.ScreenObject.GridData[t].DocDetailsID})).Compute("sum","Quantity");if(null==a||a.toString()!=n.ScreenObject.GridData[t].Quantity.toString())return fe=!0,"break"}},Ie=0;Ie<this.ScreenObject.GridData.length;Ie++){if("break"===Oe(Ie))break}this.DocStatus+=fe?"(Partially packed)":"(Packed)"}else this.DocStatus+="(To be packed)";this.WFDocLevelList.Clear();var je=null,Pe=null;if(this.IsInventoryVoucher&&e.Tables.length>25?(je=e.Tables[25],Pe=e.Tables[24]):!this.IsInventoryVoucher&&e.Tables.length>15&&(je=e.Tables[15],Pe=e.Tables[14]),null!=je&&je.length>0&&!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"HideWorkflowLevels")){var Ae=0;o.e.IsEmpty(e.Tables[0][0].WorkFlowLevel)||(Ae=parseInt(e.Tables[0][0].WorkFlowLevel)),Pe.length>0&&parseInt(Pe[Pe.length-1].StatusID),console.log("WF"),console.log(je);for(var Me=Pe.length>0?parseInt(Pe[0].WorkFlowLevel)-1:0,ve=0;ve<je.length;ve++){var Ge=new Te.a(parseInt(je[0].WID),parseInt(je[ve].levelID),je[ve].LevelName.toString(),this.CostCenterID,this.ScreenObject.DocID,this.ScreenObject.DocDate.Date);ve==Me&&(Ge.IsPending=!0,Ge.Label="C"),0==ve&&(Ge.LeftLineBrush=""),ve==je.length-1&&(Ge.RightLineBrush=""),this.WFDocLevelList.push(Ge)}for(var Ne=Pe.length-1;Ne>=0;Ne--){var Ee=parseInt(Pe[Ne].WorkFlowLevel);if(Ee<=Ae&&Ee<=this.WFDocLevelList.length&&!this.WFDocLevelList[Ee-1].IsSet){this.WFDocLevelList[Ee-1].IsSet=!0,this.WFDocLevelList[Ee-1].ModifiedBy=Pe[Ne].Status.toString()+" By "+Pe[Ne].CreatedBy.toString(),Pe[Ne].FirstName.toString().length>0&&(this.WFDocLevelList[Ee-1].ModifiedBy+="("+Pe[Ne].FirstName.toString()+")");var we=new Date(Pe[Ne].Date);this.WFDocLevelList[Ee-1].ModifiedBy+=" On "+we.ToString(s.a.SessionManager.Preferences["Date Format"]);var Fe=parseInt(Pe[Ne].StatusID);372==Fe?this.WFDocLevelList[Ee-1].IsRejected=!0:441==Fe?this.WFDocLevelList[Ee-1].IsApproved=!0:369!=Fe&&370!=Fe||(this.WFDocLevelList[Ee-1].IsPending=!0,this.WFDocLevelList[Ee-1].Label=" P"),this.WFDocLevelList[Ee-1].BgColor=a.getStatusColor(Fe)}}}if(this.CheckViewOnLoad(),69!=this.ScreenObject.DocumentType&&86!=this.ScreenObject.DocumentType&&91!=this.ScreenObject.DocumentType&&98!=this.ScreenObject.DocumentType||(this.BodyVisible=!1),71==this.ScreenObject.DocumentType){var Ve=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));if(Ve){var Le=0;(Ve instanceof C.b||Ve instanceof p.a)&&(Le=Ve.SelectedValue),Le>0&&(this.dsData=this.ScreenObject.GetEmployeePayrollInfo(Le,1,this.ScreenObject.DocDate.Date,0),this.dsData.Tables.length>0&&this.dsData.Tables[0].length>0&&this.SetNoofMonths(this.dsData))}}if(369==this.StatusID&&(62==this.ScreenObject.DocumentType||40063==this.ScreenObject.CostCenterID||40059==this.ScreenObject.CostCenterID||58==this.ScreenObject.DocumentType||67==this.ScreenObject.DocumentType||72==this.ScreenObject.DocumentType||97==this.ScreenObject.DocumentType)){var Re=this.ScreenObject.GetPayrollProcessed(0,this.DocID);Re.Tables.length>0&&Re.Tables[0].length>0&&(this.ButtonSave.Visible=!1,this.ButtonDelete.Visible=!1,this.ButtonSuspendDoc.Visible=!1,62==this.ScreenObject.DocumentType||40063==this.ScreenObject.CostCenterID?s.a.SessionManager.Preferences.ContainsKey("AllowLeavesifPayrollProcessedorLocked")&&Object(l.j)("False"==s.a.SessionManager.Preferences.AllowLeavesifPayrollProcessedorLocked)?this.DocStatus+=" (Payroll Processed)":this.ButtonSave.Visible=!0:67==this.ScreenObject.DocumentType?s.a.SessionManager.Preferences.ContainsKey("AllowDailyPayrollEntryforPostedMonths")&&Object(l.j)("False"==s.a.SessionManager.Preferences.AllowDailyPayrollEntryforPostedMonths)?this.DocStatus+=" (Payroll Processed)":(this.ButtonSave.Visible=!0,this.ButtonDelete.Visible=!0,this.ButtonSuspendDoc.Visible=!0):72==this.ScreenObject.DocumentType?s.a.SessionManager.Preferences.ContainsKey("AllowVacationifPayrollProcessedorLocked")&&Object(l.j)("False"==s.a.SessionManager.Preferences.AllowVacationifPayrollProcessedorLocked)?this.DocStatus+=" (Payroll Processed)":(this.ButtonSave.Visible=!0,this.ButtonDelete.Visible=!0):this.DocStatus+=" (Payroll Processed)")}if(68==this.ScreenObject.DocumentType)for(var Be=(new Date).OnlyDate(),xe=(new Date).OnlyDate(),ke="0",_e=null,Ke=0;Ke<this.ScreenObject.GridData.length;Ke++)if(this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[Ke].ProductID_Key)){_e=this.ScreenObject.GridData[Ke];var Qe=this.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()}));if(null!=Qe&&null!=Qe)Be=new Date(Qe.Date.getFullYear(),Qe.Date.iMonth(),1);else{var He=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha2"==e.DisplayMember.toLowerCase()}));null!=He&&null!=_e[He.DisplayMember+"_Key"]&&null!=_e[He.DisplayMember+"_Key"]&&""!=_e[He.DisplayMember+"_Key"].toString()&&(Be=new Date(_e[He.DisplayMember+"_Key"]))}if(null!=(Qe=this.ScreenObject._TextFields.find((function(e){return"dcalpha4"==e.DBColumnName.toLowerCase()}))))xe=new Date(Qe.Date.getFullYear(),Qe.Date.iMonth(),1);else{var We=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha4"==e.DisplayMember.toLowerCase()}));null!=We&&null!=_e[We.DisplayMember+"_Key"]&&null!=_e[We.DisplayMember+"_Key"]&&""!=_e[We.DisplayMember+"_Key"].toString()&&(xe=new Date(_e[We.DisplayMember+"_Key"]))}if(null!=(Qe=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}))))(Qe instanceof C.b||Qe instanceof p.a)&&(ke=Qe.SelectedValue.toString());else{var Ue=this.ScreenObject.ColumnSource.find((function(e){return"LISTBOX"==e.DataType.toUpperCase()&&"dcccnid51_key"==e.ValueMember.toLowerCase()}));null!=Ue&&null!=_e[Ue.ValueMember]&&null!=_e[Ue.ValueMember]&&""!=_e[Ue.ValueMember].toString()&&(ke=_e[Ue.ValueMember].toString())}var Xe=s.a.common.GetDataTable("PAY090",ke.toString()+"~"+Be+"~"+xe),qe=this.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()}));null!=qe&&(qe.IsReadOnly=!1),null!=Xe&&Xe.length>0&&(null!=qe&&(qe.IsReadOnly=!0),this.ReadOnlyBody=!0)}if(72==this.ScreenObject.DocumentType){var Ye=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));if(Ye){var ze="0";(Ye instanceof C.b||Ye instanceof p.a)&&(ze=Ye.SelectedValue.toString()),parseInt(ze)>0&&this.ShowVacationCreditDaysDetail(parseInt(ze))}var Je=this.ScreenObject._TextFields.find((function(e){return"dcalpha6"==e.DBColumnName.toLowerCase()}));Je instanceof h.d&&""!=Je.Text&&(this.GridNetTotal=parseFloat(Je.Text),this.RefreshNetAmount())}if(77==this.ScreenObject.DocumentType&&this.FillPayrollLockUnlockDetails(!0),56==this.ScreenObject.DocumentType){if(this.dsData=this.ScreenObject.CheckLoanRepayAmountDetails(this.DocID),this.dsData.Tables.length>0&&this.dsData.Tables[0].length>0){var Ze=this.GetButton("Distribute");null!=Ze&&(Ze.Visible=!(parseFloat(this.dsData.Tables[0][0][e.Columns[0][0]])>0))}this.EmployeewiseDocumentView(40056,this.strEmpIsMgr,"True")}if(81==this.ScreenObject.DocumentType||this.IsNewAssignLeave){this.dtData=null;var $e=this.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()}));$e&&$e instanceof m.e&&!o.e.IsEmpty($e.SelectedValue)&&(this.IsNewAssignLeave?this.LoadGradeDataNew(1,new Date,$e.SelectedValue.toString(),e):this.LoadGradeData(1,new Date,$e.SelectedValue.toString()))}if(67==this.ScreenObject.DocumentType&&this.ScreenObject.IsDocEdit){this.ScreenObject.GridDataColumns.Contains("Row_Background")||this.ScreenObject.GridDataColumns.push("Row_Background");for(var et=Date.Today().ToString("dd/MMM/yyyy"),tt="1",nt=!1,at=0;at<this.ScreenObject.GridData.length;at++)if(null!=this.ScreenObject.GridData[at].ProductID_Key&&null!=this.ScreenObject.GridData[at].ProductID_Key&&!o.e.IsEmpty(this.ScreenObject.GridData[at].ProductID_Key)){var it=this.ScreenObject.GridData[at],rt=this.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()}));if(rt instanceof S.c)et=rt.Date.ToString("dd/MMM/yyyy");else{var ot=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha1"==e.DisplayMember.toLowerCase()}));ot&&null!=it[ot.DisplayMember+"_Key"]&&null!=it[ot.DisplayMember+"_Key"]&&!o.e.IsEmpty(it[ot.DisplayMember+"_Key"])&&(et=new Date(it[ot.DisplayMember+"_Key"]).ToString("dd/MMM/yyyy"),nt=!0)}if(rt=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})))(rt instanceof C.b||rt instanceof p.a)&&(tt=rt.SelectedValue.toString());else{var ct=this.ScreenObject.ColumnSource.find((function(e){return"LISTBOX"==e.DataType.toUpperCase()&&"dcccnid51_key"==e.ValueMember.toLowerCase()}));ct&&null!=it[ct.ValueMember]&&null!=it[ct.ValueMember]&&!o.e.IsEmpty(it[ct.ValueMember])&&(tt=it[ct.ValueMember].toString())}nt&&(null==this.objPayDayCheck&&(this.objPayDayCheck=new st.a(this.ScreenObject)),this.objPayDayCheck.CheckIsHolidayDate(tt,et,it))}}if(89==this.ScreenObject.DocumentType||90==this.ScreenObject.DocumentType){var lt=null,ut=null,dt=null,Dt=null,ht=new Date;this.ScreenObject.GridData.forEach((function(e){var t=n.ScreenObject.ColumnSource.find((function(e){return"dcalpha1"==e.DisplayMember.toLowerCase()}));t&&!o.e.IsEmpty(e[t.DisplayMember+"_Key"])&&(lt=new Date(e[t.DisplayMember+"_Key"])),(t=n.ScreenObject.ColumnSource.find((function(e){return"dcalpha2"==e.DisplayMember.toLowerCase()})))&&!o.e.IsEmpty(e[t.DisplayMember+"_Key"])&&(ht=new Date(e[t.DisplayMember+"_Key"]),ut=new Date(lt.getFullYear(),lt.getMonth(),lt.getDate(),ht.getHours(),ht.getMinutes(),ht.getSeconds()),e[t.DisplayMember+"_Key"]=ut),(t=n.ScreenObject.ColumnSource.find((function(e){return"dcalpha3"==e.DisplayMember.toLowerCase()})))&&!o.e.IsEmpty(e[t.DisplayMember+"_Key"])&&(dt=new Date(e[t.DisplayMember+"_Key"])),(t=n.ScreenObject.ColumnSource.find((function(e){return"dcalpha4"==e.DisplayMember.toLowerCase()})))&&!o.e.IsEmpty(e[t.DisplayMember+"_Key"])&&(ht=new Date(e[t.DisplayMember+"_Key"]),Dt=new Date(dt.getFullYear(),dt.getMonth(),dt.getDate(),ht.getHours(),ht.getMinutes(),ht.getSeconds()),e[t.DisplayMember+"_Key"]=Dt),n.ScreenObject.GridDataObj.updateRow(e)}));var St=this.ScreenObject._TextFields.find((function(e){return"dcalpha26"==e.DBColumnName.toLowerCase()}));St&&(St.Date=null),(St=this.ScreenObject._TextFields.find((function(e){return"dcalpha27"==e.DBColumnName.toLowerCase()})))&&(St.Date=null)}if(92==this.ScreenObject.DocumentType&&this.LoadEditShiftAssign(e),73==this.ScreenObject.DocumentType)null!=(t=this.GetButton("Post"))&&(t.Visible=!1),null!=(t=this.GetButton("SaveAndPrint"))&&(t.Visible=!1);else if(89==this.ScreenObject.DocumentType||90==this.ScreenObject.DocumentType){var mt=this.ScreenObject._TextFields.find((function(e){return"dcalpha32"==e.DBColumnName.toLowerCase()}));mt instanceof m.e&&(null!=mt.SelectedValue&&"Manual"==mt.SelectedValue?(this.ScreenObject._TextFields.forEach((function(e){"dcalpha26"==e.DBColumnName.toLowerCase()?e.IsReadOnly=!0:"dcalpha27"==e.DBColumnName.toLowerCase()&&(e.Enable=!1)})),this.SetButtonVisibility("Save",!0),this.SetButtonVisibility("SaveAndPrint",!0),this.SetButtonVisibility("Check-in",!1),this.SetButtonVisibility("Check-out",!1)):(this.ScreenObject._TextFields.forEach((function(e){"dcalpha26"==e.DBColumnName.toLowerCase()?e.IsReadOnly=!1:"dcalpha27"==e.DBColumnName.toLowerCase()&&(e.Enable=!0)})),this.SetButtonVisibility("Save",!1),this.SetButtonVisibility("SaveAndPrint",!1),this.SetButtonVisibility("Check-in",!0),this.SetButtonVisibility("Check-out",!0)))}else if(97==this.ScreenObject.DocumentType){var bt=this.ScreenObject._TextFields.find((function(e){return"dcAlpha16"==e.DBColumnName.toString()}));bt instanceof S.c&&(this.dtPayMon=bt.Date.Date())}else if(62==this.ScreenObject.DocumentType){this.ReadOnlyBody=!1;var Ct=this.ScreenObject._TextFields.find((function(e){return"dcalpha16"==e.DBColumnName.toLowerCase()}));Ct&&Ct instanceof h.d&&null!=Ct.Text&&"LatesProcessing"==Ct.Text&&(this.ReadOnlyBody=!0)}else if(100==this.ScreenObject.DocumentType){var yt,pt=["#017EFA","#21bf74","#FFAA2E","#293978","#33a9b6","#ff3333"];this.ScreenObject.GridData.forEach((function(e){e.SchemeID&&(e.ParentSchemeID=e.SchemeID,e.MaxSchemeID=e.SchemeID,yt==o.e.Int(e.SchemeID)?(e.drEdit="N",e.drDelete="N",e.IsScheme="Y"):e.IsScheme="N",yt=o.e.Int(e.SchemeID),e.MCColorID=pt[yt%pt.length])})),this.ScreenObject.GridDataObj.MobileAddLine&&this.ScreenObject.GridDataObj.MobileAddLine.RefreshWidgetData()}null!=i&&(t=this.GetButton("Submitprint"),i.Visible&&s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Print")&&null!=t?t.Visible=!0:null!=t&&(t.Visible=!1));for(var gt=0;gt<this.Shortcuts.length;gt++)this.Shortcuts[gt]instanceof f.a&&15==this.Shortcuts[gt].Mode&&this.ScreenObject.GridData.length>0&&this.ValidateData_Column(this.Shortcuts[gt],this.ScreenObject.GridData[0],!0)?this.ScreenObject.GetExternalFuncData(this.Shortcuts[gt].Mode,this.Shortcuts[gt].SPName,this.Shortcuts[gt].IPParams,this.Shortcuts[gt].OPParams,this.ScreenObject.GridData[0],!0):this.Shortcuts[gt]instanceof y.c&&15==this.Shortcuts[gt].Mode&&this.ScreenObject.GetExternalFuncData(this.Shortcuts[gt].Mode,this.Shortcuts[gt].ToolTipFooterTitle,this.Shortcuts[gt].ToolTipFooterDescription,this.Shortcuts[gt].ToolTipDescription,null,!0);if(this.ScreenObject.Preferences.ContainsKey("HideBody")&&!o.e.IsEmpty(this.ScreenObject.Preferences.HideBody)&&Object(l.j)(this.ScreenObject.Preferences.HideBody.toString())&&(this.BodyVisible=!1),40045==this.CostCenterID&&this.ScreenObject.GridDataColumns.Contains("dcAlpha15_Key"))for(var ft=0;ft<this.ScreenObject.GridData.length;ft++)o.e.IsEmpty(this.ScreenObject.GridData[ft].dcAlpha15_Key)||this.Celleditend(this.ScreenObject.GridData[ft],"dcAlpha15",40045);Logger.InfoLog("AddEditDocumentViewModel::Exiting LoadEditCallBack")}},{key:"ClearCallBack",value:function(e){"Clear"==e||alert(e)}},{key:"OnDeleteCallBack",value:function(){var e=0,t="";if(this.IsSuspend){var n=!1;this.ScreenObject.Preferences.ContainsKey("SuspendAllDocs")&&"True"==this.ScreenObject.Preferences.SuspendAllDocs&&confirm("Do you want to suspend linked documents?")&&(n=!0);var a=this.ScreenObject.SuspentDocument(n,"");t=a.Message,e=a.RetValue}else{var i=this.ScreenObject.DeleteDocument();t=i.Message,e=i.RetValue}72!=this.ScreenObject.DocumentType||this.ReevaluateFutureVac||1!=e||this.ReevaluateFutureVacation(),this.ScreenObject.CheckViewForUser(0),this.clear(e),this.DisplayMessage=t}},{key:"setDefaultCurrency",value:function(){null!=this.Currency&&(!o.e.IsEmpty(this.Currency.DefaultValue)&&parseInt(this.Currency.DefaultValue)>0?this.Currency.Currency.SelectedValue!=this.Currency.DefaultValue&&(this.Currency.Currency.SelectedValue=this.Currency.DefaultValue,this.Currency.ExchangeRate.Text=this.ScreenObject.GetExchangeRate(parseInt(this.Currency.Currency.SelectedValue),this.DocumentDate).toString()):(this.Currency.Currency.SelectedValue="1",this.Currency.ExchangeRate.Text="1"))}},{key:"ClearLeaveData",value:function(){this.ScreenObject.GridDataObj.Clear();var e=this.ScreenObject.GridDataObj.NewRow();e.DocSeqNo=1,e.DocDetailsID=0,this.ScreenObject.GridDataObj.Table.push(e),this.ScreenObject.GridDataObj.refreshDataView(),this.leaveTab.Fields.forEach((function(e){e instanceof C.b?e.OnPactListBoxValueChanged=new y.b:e instanceof S.a||e instanceof S.c?e.SelectedDateChanged=new y.b:e instanceof m.e?e.SelectionChangedCommand=new y.b:e instanceof h.d&&(e.TextChangedCommand=new y.b)})),this.leaveTab.Fields.forEach((function(e){e instanceof C.b?(e.SelectedValue=0,e.SelectedValueText=""):e instanceof S.a||e instanceof S.c?(e.Date=null,e.Text=""):e instanceof m.e?(e.Text="",e.SelectedValue=""):e instanceof h.d&&(e.Text="")})),this.prepareLineItemsToForm()}},{key:"clear",value:function(e){var t=this;if(1==e||2==e||3==e||4==e||5==e){if(4!=e){var n=this.DocumentDate,a={value:this._Ddate};this.ScreenObject.Clear(a,e),this._Ddate=a.value,n!=this.DocumentDate&&(2==e?this.CheckDateInDocNumber(!1,!1):1==e&&this.CheckDateInDocNumber(!1)),3==e&&this.ChangeDateIfDateExists(this.ScreenObject.DocPrefix.ComboBox.SelectedValue)}if(this.setDefaultCurrency(),null!=this.pdcGCVM&&(this.pdcGCVM=new he.a(this)),14==this.ScreenObject.DocumentType||19==this.ScreenObject.DocumentType){var i=this.ScreenObject.ColumnSource.find((function(e){return"StatusID"==e.DisplayMember}));i&&(i.IsVisible="[Partial]"==this.DocStatus)}var r=this.ScreenObject.Data.Tables[10].length>0?this.ScreenObject.Data.Tables[10].filter((function(e){return-2==e.CostCenterColID&&(1==e.Mode||3==e.Mode)})):[];if(r.length>0?(this.BodyVisible=Object(l.j)(r[0].IsVisible),this.ReadOnlyBody=!Object(l.j)(r[0].IsEditable)):(this.BodyVisible=!0,this.ReadOnlyBody=!1,this.ReadOnlyBody=!(!this.ScreenObject.Preferences.ContainsKey("Lock Body")||""==this.ScreenObject.Preferences["Lock Body"]||!Object(l.j)(this.ScreenObject.Preferences["Lock Body"]))),this.IsInventoryVoucher&&null!=this.AssignAddress&&(this.AssignAddress.BillsVisibe=!!this.ScreenObject.Preferences.ContainsKey("BillingAddress")&&Object(l.j)(this.ScreenObject.Preferences.BillingAddress),this.AssignAddress.ShipVisibe=!!this.ScreenObject.Preferences.ContainsKey("ShippingAddress")&&Object(l.j)(this.ScreenObject.Preferences.ShippingAddress),this.AssignAddress.PrimVisibe=!!this.ScreenObject.Preferences.ContainsKey("PrimaryAddress")&&Object(l.j)(this.ScreenObject.Preferences.PrimaryAddress),r=this.ScreenObject.Data.Tables[10].length>0?this.ScreenObject.Data.Tables[10].filter((function(e){return-6==e.CostCenterColID&&(1==e.Mode||3==e.Mode)})):[],this.AssignAddress.PrimVisibe&&r.length>0?(this.AssignAddress.PrimVisibe=Object(l.j)(r[0].IsVisible),this.AssignAddress.PrimMandatory=Object(l.j)(r[0].IsMandatory)):this.AssignAddress.PrimMandatory=!1,r=this.ScreenObject.Data.Tables[10].length>0?this.ScreenObject.Data.Tables[10].filter((function(e){return-7==e.CostCenterColID&&(1==e.Mode||3==e.Mode)})):[],this.AssignAddress.BillsVisibe&&r.length>0?(this.AssignAddress.BillsVisibe=Object(l.j)(r[0].IsVisible),this.AssignAddress.BillsMandatory=Object(l.j)(r[0].IsMandatory)):this.AssignAddress.BillsMandatory=!1,r=this.ScreenObject.Data.Tables[10].length>0?this.ScreenObject.Data.Tables[10].filter((function(e){return-8==e.CostCenterColID&&(1==e.Mode||3==e.Mode)})):[],this.AssignAddress.ShipVisibe&&r.length>0?(this.AssignAddress.ShipVisibe=Object(l.j)(r[0].IsVisible),this.AssignAddress.ShipMandatory=Object(l.j)(r[0].IsMandatory)):this.AssignAddress.ShipMandatory=!1),this.WfID=0,this.WorkFlowDocLevel=0,this.WFDocLevelList.Clear(),this.StatusID=0,this.payTermXml="",this.LCBillsXml="",this.ChkRtnXml="",this.ArApBills="",this.IsUserLock=!1,this.IsLocked=!1,null!=this.CaseList&&this.CaseList.Clear(),null!=this.DtTempSchemes&&this.DtTempSchemes.Clear(),null!=this.DtPack&&this.DtPack.Clear(),null!=this.AssignAddress&&(this.AssignAddress.AddressTo.Clear(),this.AssignAddress.BillTo.Clear(),this.AssignAddress.ShipTo.Clear()),null!=this.ChequeBook&&(this.ChequeBook.Items.Clear(),this.ChequeBook.SelectedValue=""),null!=this.ViewNotes&&this.ViewNotes.NotesListObj.Clear(),null!=this.AutoPostViewModel){var c={value:this.AutoPostViewModel._Ddate};this.AutoPostViewModel.ScreenObject.Clear(c,e),this.AutoPostViewModel._Ddate=c.value,null!=this.AutoPostViewModel.AutoProduce&&(c={value:this.AutoPostViewModel.AutoProduce._Ddate},this.AutoPostViewModel.AutoProduce.ScreenObject.Clear(c,e),this.AutoPostViewModel.AutoProduce._Ddate=c.value)}if(null!=this.AutoProduce){var u={value:this.AutoProduce._Ddate};this.AutoProduce.ScreenObject.Clear(u,e),this.AutoProduce._Ddate=u.value}if(this.ScreenObject.IsDirty=!1,null!=this.donotupInv&&(this.donotupInv.IsChecked=this.DonotUpdateInventory),null!=this.ViewAttachments&&this.ViewAttachments.AttachmentsListObj.Clear(),null!=this.grdLinkTab&&this.grdLinkTab.Clear(),null!=this.ViewActivities&&(this.ViewActivities.ActivityGridDataObj.Clear(),this.ViewActivities.NodeID=0),null!=this.Activities&&this.Activities.ClearFields(),null!=this.POSPayModes&&this.POSPayModes.clear(),null!=this.ViewOrganizationViewModel&&this.ViewOrganizationViewModel.OrganizationData.Clear(),this.IsExpressionAvailable("ServerDate")){var d=s.a.common.GetDataSet("DOC001","");if(null!=d&&d.Tables.length>0&&!d.Columns[0].Contains("ErrorMessage")&&d.Tables[0].length>0&&""!=d.Tables[0][0].dt&&null!=this.fldDict)if(s.a.SessionManager.IsWebApplication){var D=new Date(d.Tables[0][0].dt);this.fldDict.ServerDate.setFieldValue(D.ToString("MMM/dd/yyyy")),this.FooterDics.ServerDate.setFieldValue(D.ToString("MMM/dd/yyyy"))}else this.fldDict.ServerDate.setFieldValue(d.Tables[0][0].dt),this.FooterDics.ServerDate.setFieldValue(d.Tables[0][0].dt)}null!=this.ScreenObject.Link&&(this.ScreenObject.Link.LinkStatus="[Open]"),this.ScreenObject.IsForecast&&(this.ScreenObject.ForecastObj.Clear(),this.ScreenObject.GridDataObj.RefreshColumns()),this.AutoPostDocID=0,this.IsReplaced=0,this.AutoProduceDocID=0,this.LCDueAmt=0,this.DocStatus="POSDocumentViewModel"==this.ClassName?"":"["+s.a.GetResource("Doc_Draft")+"]",this.GridNetTotal=0,this.FooterGridNetTotal=0,this.Title=this.ScreenName,this.RefreshNetAmount();var b=this.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&55500==e.LinkData}));if(b.length>0){var y=this.ScreenObject._TextFields.find((function(e){return e.DBColumnID==b[0].CostCenterColID}));y&&y instanceof h.d&&(y.Text="0")}if(this.FillExchangeRates(),this.UpdateFooter=!0,this.AppRejDate.Date=new Date,this.Remarks.Text="",this.ReviseReason="",this.DocHistoryVisibility&&this.DocHistory.Clear(),4!=e&&this.SetFocus(),this.SetNewDocButtonVisibility(),this.SetSaveVisibility(),this.ConsolidateLeaveMonth(),this.dtLoanGuarantees=null,this.dsProjWOffHol=null,this.PrevVacFrom=new Date,this.PrevVacTo=new Date,62==this.ScreenObject.DocumentType&&this.ClearLeaveData(),1==e&&(94!=this.ScreenObject.DocumentType&&99!=this.ScreenObject.DocumentType||this.ScreenObject.GridDataObj.Clear(),71==this.ScreenObject.DocumentType&&(this.PostSalaryDocResetColumns(),this.FillEarnDeductDetails(0,parseInt(new Date(this.ScreenObject.DocDate.Date).ToString("yyyy")))),72==this.ScreenObject.DocumentType)){var g=this.ScreenObject._TextFields.find((function(e){return"dcalpha15"==e.DBColumnName.toLowerCase()}));g instanceof m.e&&!o.e.IsEmpty(g.SelectedValue)&&(g.IsReadOnly=!1),(g=this.ScreenObject._TextFields.find((function(e){return"dcalpha16"==e.DBColumnName.toLowerCase()})))instanceof m.e&&!o.e.IsEmpty(g.SelectedValue)&&(g.IsReadOnly=!1),(g=this.ScreenObject._TextFields.find((function(e){return"dcalpha13"==e.DBColumnName.toLowerCase()})))instanceof m.e&&(g.SelectedValue="No",g.IsReadOnly=!1),(g=this.ScreenObject._TextFields.find((function(e){return"dcalpha16"==e.DBColumnName.toLowerCase()})))instanceof m.e&&(g.SelectedValue="No",g.IsReadOnly=!1),(g=this.ScreenObject._TextFields.find((function(e){return"dcalpha4"==e.DBColumnName.toLowerCase()})))instanceof h.d&&(g.IsReadOnly=!0),(g=this.ScreenObject._TextFields.find((function(e){return"dcalpha14"==e.DBColumnName.toLowerCase()})))instanceof h.d&&(g.IsReadOnly=!0),(g=this.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()})))instanceof S.c&&(g.IsReadOnly=!1),(g=this.ScreenObject._TextFields.find((function(e){return"dcalpha3"==e.DBColumnName.toLowerCase()})))instanceof S.c&&(g.IsReadOnly=!1),((g=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})))instanceof C.b||g instanceof p.a)&&(g.IsReadOnly=!1),this.FillEarningsDeductions(0,this.ScreenObject.DocDate.Date),this.ShowVacationCreditDaysDetail(0)}if(72==this.ScreenObject.DocumentType&&this.ShowVacationCreditDaysDetail(0),75==this.ScreenObject.DocumentType&&this.FillGratuitySettingsExpDetails(),76==this.ScreenObject.DocumentType&&this.FillForm12BALookupDetails(),77==this.ScreenObject.DocumentType&&this.FillPayrollLockUnlockDetails(!1),72==this.ScreenObject.DocumentType&&null!=this.oVac&&(this.oVac=null),68==this.ScreenObject.DocumentType){var O=this.ScreenObject._TextFields.find((function(e){return"dcAlpha2"==e.DBColumnName.toString()}));null!=O&&(O.Date=new Date(s.a.SessionManager.PayrollMonth),O.CustomFormat="MMM/yyyy"),null!=(O=this.ScreenObject._TextFields.find((function(e){return"dcAlpha4"==e.DBColumnName.toString()})))&&(O.Date=new Date(s.a.SessionManager.PayrollMonth),O.CustomFormat="MMM/yyyy")}if(86==this.ScreenObject.DocumentType){var I=this.ScreenObject._TextFields.find((function(e){return"dcAlpha2"==e.DBColumnName.toString()}));I instanceof S.b&&(I.CustomFormat="HH:mm",I.Date=new Date),(I=this.ScreenObject._TextFields.find((function(e){return"dcAlpha3"==e.DBColumnName.toString()})))instanceof S.b&&(I.CustomFormat="HH:mm",I.Date=new Date);var T=this.ScreenObject._TextFields.find((function(e){return"dcAlpha3"==e.DBColumnName.toString()}));T&&this.onDateChanged(T)}if(85==this.ScreenObject.DocumentType){var j=this.ScreenObject._TextFields.find((function(e){return"dcAlpha1"==e.DBColumnName.toString()}));j instanceof S.c&&(j.CustomFormat="MMM/yyyy",j.Date=new Date((new Date).getFullYear(),(new Date).getMonth(),1)),(j=this.ScreenObject._TextFields.find((function(e){return"dcAlpha2"==e.DBColumnName.toString()})))instanceof S.c&&(j.CustomFormat="MMM/yyyy",j.Date=new Date((new Date).getFullYear(),(new Date).getMonth(),1)),(j=this.ScreenObject._TextFields.find((function(e){return"dcAlpha4"==e.DBColumnName.toString()})))instanceof S.c&&(j.CustomFormat="MMM/yyyy",j.Date=new Date((new Date).getFullYear(),(new Date).getMonth(),1))}if(56==this.ScreenObject.DocumentType&&this.EmployeewiseDocumentView(40056,this.strEmpIsMgr,"False"),81==this.ScreenObject.DocumentType){this.ScreenObject._TextFields.forEach((function(e){e instanceof m.e&&"dcalpha1"==e.DBColumnName.toLowerCase()&&e.SelectionChangedCommand.Subscribe(t,"LeavesBasedon"),e instanceof m.e&&"dcalpha2"==e.DBColumnName.toLowerCase()&&(e.IsReadOnly=!1)}));var P=this.ScreenObject._CCFields.find((function(e){return"dcccnid2"==e.DBColumnName.toLowerCase()}));P&&P instanceof C.b&&(P.Enable=!0),this.dtData=null;var A=this.ScreenObject.ColumnSource.find((function(e){return 50051==e.CostCenterID}));A&&A instanceof f.a&&(A.IsVisible=!1)}if(67==this.ScreenObject.DocumentType){var M=s.a.common.GetDataSet("PAY033",this.ScreenObject.CostCenterID.toString());null!=M&&0==M.Tables[0].length&&(this.ReadOnlyBody=!0)}if(97==this.ScreenObject.DocumentType){this.ScreenObject.GridDataObj.Clear(),this.dtPayMon=new Date,this.dtPayMonStart=new Date,this.dtPayMonEnd=new Date;var v=this.ScreenObject._TextFields.find((function(e){return"dcAlpha16"==e.DBColumnName.toString()}));null!=v&&(v.CustomFormat="01/MMM/yyyy",v.Date=new Date(s.a.SessionManager.PayrollMonth)),null!=(v=this.ScreenObject._TextFields.find((function(e){return"dcAlpha33"==e.DBColumnName.toString()})))&&(v.CustomFormat="01/MMM/yyyy",v.Date=new Date(s.a.SessionManager.PayrollMonth))}this.intRecCount=0,null!=this.objPayDayCheck&&(this.objPayDayCheck.dsWOffData={Tables:[]},this.objPayDayCheck.dsHMData={Tables:[]},this.objPayDayCheck.dtEmpData=null),this.dsSaved={Tables:[]},this.dsHrsDef={Tables:[]},this.dtEData=null,this.dtVacDefineDays=null,this.dtVacContract=null,this.IsLatesProcessTimingsUpdated=!1}this.ScreenObject.Preferences.ContainsKey("HideBody")&&!o.e.IsEmpty(this.ScreenObject.Preferences.HideBody)&&Object(l.j)(this.ScreenObject.Preferences.HideBody.toString())&&(this.BodyVisible=!1)}},{key:"SetNewDocButtonVisibility",value:function(){var e=this.GetButton("Submit");null!=e&&(e.Visible=!1),null!=(e=this.GetButton("Submitprint"))&&(e.Visible=!1),null!=(e=this.GetButton("Generate"))&&(e.Visible=!1),null!=(e=this.GetButton("GST"))&&(e.Visible=!1),null!=(e=this.GetButton("API"))&&(e.Visible=!1),null!=(e=this.GetButton("Redeposit"))&&(e.Visible=!1),null!=(e=this.GetButton("Stock Posting"))&&(e.Visible=!1),null!=(e=this.GetButton("Enquiries"))&&(e.Visible=!1),null!=(e=this.GetButton("Bounce"))&&(e.Visible=!1),null!=(e=this.GetButton("Advance"))&&(e.Visible=!1),null!=(e=this.GetButton("PriceChart"))&&(e.Visible=!1),null!=(e=this.GetButton("Pay"))&&(e.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Create")),null!=(e=this.GetButton("Save"))&&(e.Visible=!0),null!=(e=this.GetButton("Convert"))&&(e.Visible=!1),null!=(e=this.GetButton("Close"))&&(e.Visible=!1),this.ApproveVisibility=!1,this.ButtonRevise.Visible=!1,this.ButtonApprove.Visible=!1,this.ButtonSuspend.Visible=!1,this.ButtonCloseVisibility=!1,this.CaseVisibility=!1,56==this.ScreenObject.DocumentType&&0==this.DocID&&(this.DistributeInstallmentsVisible=!0),92==this.ScreenObject.DocumentType&&(null!=(e=this.GetButton("Fill Dates"))&&(e.Visible=0==this.DocID)),this.ButtonSave.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Create"),this.ButtonSave.Enable=!!s.a.SessionManager.HideUnathorizedAccess||s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Create"),this.ButtonDelete.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),this.ButtonDelete.Enable=!!s.a.SessionManager.HideUnathorizedAccess||s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),this.ButtonSaveandPrint.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save&Print"),this.ButtonSaveandPrint.Enable=!!s.a.SessionManager.HideUnathorizedAccess||s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save&Print"),this.HideButtons("Save&Barcode"),this.HideButtons("BarcodePrint"),(this.IsMPVParent||this.IsFrmFS_LoanBal)&&(this.OKCancelVisibility=!0,this.ButtonCloseVisibility=!0,this.IsFrmFS_LoanBal&&(this.DisableRightPanel=!0))}},{key:"DimWiseAttachment",value:function(e,t){e.length>0&&o.e.Int(e[0].FeatureID)>5e4&&this.ScreenObject.Preferences.ContainsKey("AutoDimWiseAttachments")&&Object(l.j)(this.ScreenObject.Preferences.AutoDimWiseAttachments)&&Object(l.j)(this.ScreenObject.Preferences.AutoDimWiseAttachments)}},{key:"ReferenceCallBack",value:function(e){var t=this,n=e.ReferenceTable,a=e.DBColumnName,i=e.ccid,r=e.dr;if("LinkAll"==a){this.ScreenObject.GridDataObj.Clear(),this.ScreenObject.UpdateSequence();for(var c="",u=0;u<this.ScreenObject.Link.DocumentList.Items.length;u++)""!=c&&(c+="','"),c+=this.ScreenObject.Link.DocumentList.Items[u].Name;""!=c&&this.FillLink(c,parseInt(this.ScreenObject.Link.LinkCombo.SelectedValue),[],[]),this.ScreenObject.UpdateSequence()}else if("ReCalculate"==a)this.onExchangeRateChanged(""),this.CalculateTotals(null,!1);else if("ReEvaluate"==a)null!=r?this.ReEvaluatePriceTax_3(r,i):this.ReEvaluatePriceTax(i);else if("Dimension"==a)this.DimensionSelectedvalueData();else if("Formula"==a){if(null==this.fldDict)return;this.ScreenObject._TextFields.forEach((function(e){t.fldDict.ContainsKey(e.Lbl)&&(e instanceof h.d?"FLOAT"==e.DataType?null!=e.Text&&""!=e.Text&&""==e.ValidateData()?t.fldDict[e.Lbl].setFieldValue(e.Text):t.fldDict[e.Lbl].setFieldValue(0):t.fldDict[e.Lbl].setFieldValue(e.Text):e instanceof m.e?t.fldDict[e.Lbl].setFieldValue(e.SelectedValue):e instanceof O.a?t.fldDict[e.Lbl].setFieldValue(e.Text):e instanceof S.c&&e.Date?t.fldDict[e.Lbl].setFieldValue(e.Date):e instanceof C.b&&(e.SelectedValue>0&&!o.e.IsEmpty(e.Text)?t.fldDict[e.Lbl].setFieldValue(e.Text):t.fldDict[e.Lbl].setFieldValue("")))})),this.fldDict.DOCDATE.setFieldValue(this.DocumentDate),this.fldDict.DUEDATE.setFieldValue(this.ScreenObject.DueDate&&this.ScreenObject.DueDate.Date?this.ScreenObject.DueDate.Date:Date.Today());var d=this.ScreenObject._StaticFields.find((function(e){return"billdate"==e.DBColumnName.toLowerCase()}));this.fldDict.BILLDATE.setFieldValue(d&&d instanceof S.c&&d.Date?d.Date:Date.Today());var D=s.a.eval.EvaluateExpression(this.ScreenObject.DueDate.Formula,this.fldDict);null!=D&&o.e.isValidDate(D)&&(this.ScreenObject.DueDate.Date=new Date(D))}else if(a.Contains("Attachments")&&null!=this.ViewAttachments)a=a.substr(a.indexOf("~")+1),this.DimWiseAttachment(n,a);else if(null!=r)this.ProdID=0,this.AddProductData(r,!1,!1),this.ApplySchemes(r);else if(null!=this.AssignAddress&&n.length>0){this.ScreenObject.IsPurchase&&"creditaccount"==a.toLowerCase()?(this.AssignAddress.AddressTo.Clear(),this.AssignAddress.BillTo.Clear(),this.AssignAddress.ShipTo.Clear(),this.AssignAddress.AddressTo.push(m.d.ComboBoxItems_2("","")),this.AssignAddress.BillTo.push(m.d.ComboBoxItems_2("","")),this.AssignAddress.ShipTo.push(m.d.ComboBoxItems_2("","")),this.AssignAddress.AddressToName.Text="",this.AssignAddress.AddressTo1.Text="",this.AssignAddress.PhoneTo1.Text="",this.AssignAddress.AddressName.Text="",this.AssignAddress.Address1.Text="",this.AssignAddress.Phone1.Text="",this.AssignAddress.SAddressName.Text="",this.AssignAddress.SAddress1.Text="",this.AssignAddress.SPhone1.Text="",n.filter((function(e){return 1==e.AddressTypeID})).forEach((function(e){t.AssignAddress.AddressTo.push(m.d.ComboBoxItems_2(e.AddressName.toString(),e.AddressID.toString())),Object.keys(n[0]).Contains("IsDefault")&&Object(l.j)(e.IsDefault)&&(t.AssignAddress.SelectedAddressTo=o.e.String(e.AddressID),t.AssignAddress.AddressToName.Text=o.e.String(e.ContactPerson),t.AssignAddress.AddressTo1.Text=o.e.String(e.Address1)+" "+o.e.String(e.Address2)+" "+o.e.String(e.Address3),t.AssignAddress.PhoneTo1.Text=o.e.String(e.Phone1),t.AssignAddress.AddressToCity.Text=o.e.String(e.City)+" "+o.e.String(e.State)+" "+o.e.String(e.Zip),t.AssignAddress.AddressToVisbility=!0)})),n.filter((function(e){return 2==e.AddressTypeID})).forEach((function(e){t.AssignAddress.BillTo.push(m.d.ComboBoxItems_2(e.AddressName.toString(),e.AddressID.toString())),Object.keys(n[0]).Contains("IsDefault")&&Object(l.j)(e.IsDefault)&&(t.AssignAddress.SelectedAddressTo=o.e.String(e.AddressID),t.AssignAddress.AddressToName.Text=o.e.String(e.ContactPerson),t.AssignAddress.AddressTo1.Text=o.e.String(e.Address1)+" "+o.e.String(e.Address2)+" "+o.e.String(e.Address3),t.AssignAddress.PhoneTo1.Text=o.e.String(e.Phone1),t.AssignAddress.AddressToCity.Text=o.e.String(e.City)+" "+o.e.String(e.State)+" "+o.e.String(e.Zip),t.AssignAddress.AddressToVisbility=!0)})),n.filter((function(e){return 3==e.AddressTypeID})).forEach((function(e){t.AssignAddress.ShipTo.push(m.d.ComboBoxItems_2(e.AddressName.toString(),e.AddressID.toString())),Object.keys(n[0]).Contains("IsDefault")&&Object(l.j)(e.IsDefault)&&(t.AssignAddress.SelectedAddressTo=o.e.String(e.AddressID),t.AssignAddress.AddressToName.Text=o.e.String(e.ContactPerson),t.AssignAddress.AddressTo1.Text=o.e.String(e.Address1)+" "+o.e.String(e.Address2)+" "+o.e.String(e.Address3),t.AssignAddress.PhoneTo1.Text=o.e.String(e.Phone1),t.AssignAddress.AddressToCity.Text=o.e.String(e.City)+" "+o.e.String(e.State)+" "+o.e.String(e.Zip),t.AssignAddress.AddressToVisbility=!0)}))):"debitaccount"==a.toLowerCase()&&(this.AssignAddress.ShipTo.Clear(),this.AssignAddress.ShipTo.push(m.d.ComboBoxItems_2("","")),this.AssignAddress.SAddressName.Text="",this.AssignAddress.SAddress1.Text="",this.AssignAddress.SPhone1.Text="",n.filter((function(e){return 3==e.AddressTypeID})).forEach((function(e){t.AssignAddress.ShipTo.push(m.d.ComboBoxItems_2(e.AddressName.toString(),e.AddressID.toString())),Object.keys(n[0]).Contains("IsDefault")&&Object(l.j)(e.IsDefault)&&(t.AssignAddress.SelectedAddressTo=o.e.String(e.AddressID),t.AssignAddress.AddressToName.Text=o.e.String(e.ContactPerson),t.AssignAddress.AddressTo1.Text=o.e.String(e.Address1)+" "+o.e.String(e.Address2)+" "+o.e.String(e.Address3),t.AssignAddress.PhoneTo1.Text=o.e.String(e.Phone1),t.AssignAddress.AddressToCity.Text=o.e.String(e.City)+" "+o.e.String(e.State)+" "+o.e.String(e.Zip),t.AssignAddress.AddressToVisbility=!0)})),this.ScreenObject.IsPurchase||(this.AssignAddress.AddressTo.Clear(),this.AssignAddress.BillTo.Clear(),this.AssignAddress.AddressTo.push(m.d.ComboBoxItems_2("","")),this.AssignAddress.BillTo.push(m.d.ComboBoxItems_2("","")),this.AssignAddress.AddressToName.Text="",this.AssignAddress.AddressTo1.Text="",this.AssignAddress.PhoneTo1.Text="",this.AssignAddress.AddressName.Text="",this.AssignAddress.Address1.Text="",this.AssignAddress.Phone1.Text="",n.filter((function(e){return 1==e.AddressTypeID})).forEach((function(e){t.AssignAddress.AddressTo.push(m.d.ComboBoxItems_2(e.AddressName.toString(),e.AddressID.toString())),Object.keys(n[0]).Contains("IsDefault")&&Object(l.j)(e.IsDefault)&&(t.AssignAddress.SelectedAddressTo=o.e.String(e.AddressID),t.AssignAddress.AddressToName.Text=o.e.String(e.ContactPerson),t.AssignAddress.AddressTo1.Text=o.e.String(e.Address1)+" "+o.e.String(e.Address2)+" "+o.e.String(e.Address3),t.AssignAddress.PhoneTo1.Text=o.e.String(e.Phone1),t.AssignAddress.AddressToCity.Text=o.e.String(e.City)+" "+o.e.String(e.State)+" "+o.e.String(e.Zip),t.AssignAddress.AddressToVisbility=!0)})),n.filter((function(e){return 2==e.AddressTypeID})).forEach((function(e){t.AssignAddress.BillTo.push(m.d.ComboBoxItems_2(e.AddressName.toString(),e.AddressID.toString())),Object.keys(n[0]).Contains("IsDefault")&&Object(l.j)(e.IsDefault)&&(t.AssignAddress.SelectedAddressTo=o.e.String(e.AddressID),t.AssignAddress.AddressToName.Text=o.e.String(e.ContactPerson),t.AssignAddress.AddressTo1.Text=o.e.String(e.Address1)+" "+o.e.String(e.Address2)+" "+o.e.String(e.Address3),t.AssignAddress.PhoneTo1.Text=o.e.String(e.Phone1),t.AssignAddress.AddressToCity.Text=o.e.String(e.City)+" "+o.e.String(e.State)+" "+o.e.String(e.Zip),t.AssignAddress.AddressToVisbility=!0)}))))}}},{key:"GetDraftXML",value:function(e){var t,n,a={LastRowNo:0,strXML:""};for(a.LastRowNo=this.ScreenObject.GridData.length-1;a.LastRowNo>=0;a.LastRowNo--){for(t=2;t<this.ScreenObject.GridDataColumns.length&&!(o.e.String(this.ScreenObject.GridData[a.LastRowNo][this.ScreenObject.GridDataColumns[t]]).length>0);t++);if(t!=this.ScreenObject.GridDataColumns.length)break}if(-1==a.LastRowNo&&e)return"";var i,r="";for(r+="<XML>",r+="<Header>",this.ScreenObject.HeaderFields.forEach((function(e){e instanceof h.d||e instanceof h.c?(r+="<"+e.DBColumnName+">",r+=h.d.GetValidXml(e.Text),r+="</"+e.DBColumnName+">"):e instanceof S.c?e.Date&&(r+="<"+e.DBColumnName+">",r+=e.Date.ToString("dd MMM yyyy"),r+="</"+e.DBColumnName+">"):e instanceof S.a?(r+="<"+e.DBColumnName+">",r+=e.Date.ToString("dd MMM yyyy"),r+="</"+e.DBColumnName+">"):e instanceof C.b?(r+="<"+e.DBColumnName+">",r+=e.SelectedValue,r+="</"+e.DBColumnName+">"):e instanceof g.a?(r+="<"+e.DBColumnName+"_COMBO>",r+=e.ComboBox.SelectedValue,r+="</"+e.DBColumnName+"_COMBO>"):e instanceof p.a&&(r+="<"+e.DBColumnName+">",r+=e.SelectedValue,r+="</"+e.DBColumnName+">")})),this.ScreenObject._CCFields.forEach((function(e){(e instanceof C.b||e instanceof p.a)&&(r+="<"+e.DBColumnName+">",r+=e.SelectedValue,r+="</"+e.DBColumnName+">")})),this.ScreenObject._TextFields.forEach((function(e){if(e instanceof h.d){var t=e;r+="<"+t.DBColumnName+">",r+=h.d.GetValidXml(t.Text),r+="</"+t.DBColumnName+">"}else if(e instanceof h.c){var n=e;r+="<"+n.DBColumnName+">",r+=h.d.GetValidXml(n.Text),r+="</"+n.DBColumnName+">"}else if(e instanceof S.c){var a=e;a.Date&&(r+="<"+a.DBColumnName+">",r+=a.Date.ToString("dd MMM yyyy"),r+="</"+a.DBColumnName+">")}else if(e instanceof S.a){var i=e;null!=i.Date&&null!=i.Date||(i.Date=(new Date).OnlyDate()),r+="<"+i.DBColumnName+">",r+=i.Date.ToString("dd MMM yyyy"),r+="</"+i.DBColumnName+">"}else e instanceof C.b||e instanceof m.e?(r+="<"+e.DBColumnName+">",r+=e.SelectedValue,r+="</"+e.DBColumnName+">"):e instanceof O.a&&(r+="<"+e.DBColumnName+">",r+=e.Text,r+="</"+e.DBColumnName+">")})),r+="</Header>",r+="<DataTable>",n=0;n<=a.LastRowNo;n++){var s=this.ScreenObject.GridData[n];for(r+="<Row>",t=0;t<this.ScreenObject.GridDataColumns.length;t++)i=s[this.ScreenObject.GridDataColumns[t]],o.e.IsEmpty(i)||(r+="<"+this.ScreenObject.GridDataColumns[t]+">",r+=h.d.GetValidXml(i),r+="</"+this.ScreenObject.GridDataColumns[t]+">");r+="</Row>"}return r+="</DataTable>",r+="<FooterTable>",this.ScreenObject.FooterGridData.forEach((function(e){r+="<Row>",r+="<ColumnName>",r+=o.e.String(e.ColumnName),r+="</ColumnName>",r+="<Amount>",r+=o.e.String(e.Amount),r+="</Amount>",r+="<CalcAmount>",r+=o.e.String(e.CalcAmount),r+="</CalcAmount>",r+="<dcCurrID>",r+=o.e.String(e.dcCurrID),r+="</dcCurrID>",r+="<dcCurrID_Key>",r+=o.e.String(e.dcCurrID_Key),r+="</dcCurrID_Key>",r+="<dcExchrt>",r+=o.e.String(e.dcExchrt),r+="</dcExchrt>",r+="</Row>"})),r+="</FooterTable>",r+="</XML>",a.strXML=r,a}},{key:"PoleDisplaytimer_Elapsed",value:function(){this.PoleDisplayMessage(1,null),this.PoleDisplaytimer.Enabled=!1}},{key:"timerDraft_Elapsed",value:function(){null!=this.ScreenObject&&this.ScreenObject.IsDocEdit||s.a.SessionManager.Preferences.ContainsKey("AutoDocumentDraft")&&!Object(l.j)(s.a.SessionManager.Preferences.AutoDocumentDraft)||s.a.page.isActiveTab(this)&&this.SaveDraft(!0,!0)}},{key:"SaveDraft",value:function(e,t){var n=this;try{var a;if(a=this.GetDraftXML(e),e&&0==a.strXML.length)return;var i=[];i.push(this.ScreenObject.DraftID),i.push(this.ScreenObject.CostCenterID),i.push(0),i.push(a.strXML),i.push(t?1:2),i.push(this.HoldDocName.Text),i.push(t?this.DocumentDate:this.HoldDocDate.Date),i.push(a.LastRowNo),i.push(this.NetAmount),i.push(this.ScreenObject.RegisterNodeID),this.ScreenObject.SetDocumentDraft(i).subscribe((function(e){e.RetValue>0&&(n.ScreenObject.DraftID=e.RetValue),n.ScreenObject.DraftID>0?t?n.DisplayMessage+="Draft Saved At "+(new Date).ToString("hh:mm a"):(n.clear(1),n.ScreenObject.DraftID=0,n.DisplayMessage+="Document Hold Succesfully",s.a.page.HideDialog(),n.HoldDocName.Text=""):n.DisplayMessage=e.Message}),(function(e){console.log(e)}))}catch(r){}}},{key:"LoadDraftXML",value:function(e){var t,n,a=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(0!=e.DataXML.toString().length){var r,c,u,d=new o.f;d.LoadXml(e.DataXML),this.ScreenObject.DraftID=parseInt(e.DraftID),o.e.IsEmpty(e.DocName)||(this.HoldDocName.Text=e.DocName.toString()),r=d.SelectSingleNode("XML/Header"),this.ScreenObject.HeaderFields.forEach((function(e){if(e instanceof h.d){var t=e;null!=(c=d.getDateByNodeName(r,e.DBColumnName))&&(t.Text=c)}else if(e instanceof h.c)c=d.getDateByNodeName(r,e.DBColumnName);else if(e instanceof S.c){var n=e;null!=(c=d.getDateByNodeName(r,e.DBColumnName))&&(n.Date=new Date(c))}else if(e instanceof S.a){var i=e;null!=(c=d.getDateByNodeName(r,e.DBColumnName))&&(i.Date=new Date(c)),"DocDate"==i.DBColumnName&&(a.DocumentDate=i.Date)}else if(e instanceof C.b){var s=e;null!=(c=d.getDateByNodeName(r,e.DBColumnName))&&(s.OnPactListBoxValueChanged.UnSubscribe(),s.SelectedValue=parseInt(c),s.OnPactListBoxValueChanged.Subscribe(a.ScreenObject,"OnGetReference"))}else if(e instanceof g.a){var o=e;null!=(c=d.getDateByNodeName(r,e.DBColumnName+"_COMBO"))&&(o.ComboBox.SelectedValue=c)}else if(e instanceof p.a){var l=e;null!=(c=d.getDateByNodeName(r,e.DBColumnName))&&(l.SelectionCallBack.UnSubscribe(),l.SelectedValue=parseInt(c),l.SelectionCallBack.Subscribe(a.ScreenObject,"OnGetReference"))}})),this.ScreenObject._CCFields.forEach((function(e){(e instanceof C.b||e instanceof p.a)&&(null!=(c=d.getDateByNodeName(r,e.DBColumnName))&&e instanceof C.b?(e.OnPactListBoxValueChanged.UnSubscribe(),e.SelectedValue=parseInt(c),e.OnPactListBoxValueChanged.Subscribe(a.ScreenObject,"OnGetReference"),(50001!=e.CCID||e.DBColumnName.startsWith("TO")||!i||!s.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")||"True"!=s.a.SessionManager.Preferences.EnableDivisionWise.toString()||a.ScreenObject.Preferences.ContainsKey("Donotusedivision")&&""!=a.ScreenObject.Preferences.Donotusedivision&&Object(l.j)(a.ScreenObject.Preferences.Donotusedivision))&&(50002!=e.CCID||e.DBColumnName.startsWith("TO")||!i||!s.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")||"True"!=s.a.SessionManager.Preferences.EnableLocationWise.toString()||a.ScreenObject.Preferences.ContainsKey("Donotuselocation")&&""!=a.ScreenObject.Preferences.Donotuselocation&&Object(l.j)(a.ScreenObject.Preferences.Donotuselocation))||(a.ScreenObject.DivisionID=e.SelectedValue)):null!=c&&e instanceof p.a&&(e.Name.OnPactListBoxValueChanged.UnSubscribe(),e.SelectedValue=parseInt(c),e.Name.OnPactListBoxValueChanged.Subscribe(a.ScreenObject,"OnGetReference"),(50001!=e.CCID||e.DBColumnName.startsWith("TO")||!i||!s.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")||"True"!=s.a.SessionManager.Preferences.EnableDivisionWise.toString()||a.ScreenObject.Preferences.ContainsKey("Donotusedivision")&&""!=a.ScreenObject.Preferences.Donotusedivision&&Object(l.j)(a.ScreenObject.Preferences.Donotusedivision))&&(50002!=e.CCID||e.DBColumnName.startsWith("TO")||!i||!s.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")||"True"!=s.a.SessionManager.Preferences.EnableLocationWise.toString()||a.ScreenObject.Preferences.ContainsKey("Donotuselocation")&&""!=a.ScreenObject.Preferences.Donotuselocation&&Object(l.j)(a.ScreenObject.Preferences.Donotuselocation))||(a.ScreenObject.DivisionID=e.SelectedValue)))})),this.ScreenObject._TextFields.forEach((function(e){null!=(c=d.getDateByNodeName(r,e.DBColumnName))&&a.ScreenObject.fillcontrolValue(e,c)}));var D=d.SelectNodes("XML/DataTable/Row");for(n=0;n<D.length;n++){this.ScreenObject.GridData.length-1<=n&&this.ScreenObject.GridDataObj.addEmptyRow();var m=this.ScreenObject.GridData[n];for(m.DocSeqNo=n+1,t=1;t<this.ScreenObject.GridDataColumns.length;t++)if(u=this.ScreenObject.GridDataColumns[t],c=d.getDateByNodeName(D[n],u),!Object(j.isNullOrUndefined)(c))if(this.ScreenObject.GridDataObj.DataTypes.Date.Contains(u))o.e.isValidDate(c)&&(m[u]=new Date(c));else if(""==c&&(this.ScreenObject.GridDataObj.DataTypes.Double.Contains(u)||this.ScreenObject.GridDataObj.DataTypes.Int.Contains(u)));else try{m[u]=c}catch(y){}this.CalculateTotals(m,!1),this.ScreenObject.GridDataObj.updateRow(m)}for(D=d.SelectNodes("XML/FooterTable/Row"),n=0;n<D.length;n++){this.ScreenObject.FooterGridData.length-1<=n&&this.ScreenObject.FooterGridDataObj.addEmptyRow();var b=this.ScreenObject.FooterGridData[n];c=d.getDateByNodeName(D[n],"ColumnName"),Object(j.isNullOrUndefined)(c)||(D[n].ColumnName=c),this.FooterCellEditEnd("ColumnName",b),c=d.getDateByNodeName(D[n],"Amount"),Object(j.isNullOrUndefined)(c)||(D[n].Amount=c),c=d.getDateByNodeName(D[n],"CalcAmount"),Object(j.isNullOrUndefined)(c)||(D[n].CalcAmount=c),c=d.getDateByNodeName(D[n],"dcCurrID"),Object(j.isNullOrUndefined)(c)||(D[n].dcCurrID=c),c=d.getDateByNodeName(D[n],"dcCurrID_Key"),Object(j.isNullOrUndefined)(c)||(D[n].dcCurrID_Key=c),c=d.getDateByNodeName(D[n],"dcExchRT"),Object(j.isNullOrUndefined)(c)||(D[n].dcExchRT=c)}s.a.SessionManager.Preferences.ContainsKey("DraftServerDate")&&"true"==s.a.SessionManager.Preferences.DraftServerDate.toLowerCase()&&null!=this.fldDict&&o.e.isValidDate(this.fldDict.ServerDate.fieldResult)&&(this.DocumentDate=new Date(this.fldDict.ServerDate)),s.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==s.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&this.ScreenObject.FillListViews(!1),this.CalculateTotals(null,!1)}}},{key:"OpenCashDrawer",value:function(e,t){if(this.ScreenObject.Preferences.ContainsKey("Select Port")&&"True"==this.ScreenObject.Preferences["Select Port"])try{Logger.InfoLog("Message :"+t+"   to Port NO:"+e)}catch(n){Logger.ErrorLog("Cash Drawer :: "+n.Message)}}},{key:"BudgetValidation",value:function(e){if(null!=this.ScreenObject.Data.Tables[5]&&this.ScreenObject.Data.Columns[5].length>0){if(!this.ScreenObject.Preferences.ContainsKey("Check Budget")||"False"==this.ScreenObject.Preferences["Check Budget"]||"False"==s.a.SessionManager.Preferences["Use Budget"]||0==this.ScreenObject.Data.Tables[5].filter((function(e){return 0==e.QtyBudget})).length||s.a.SessionManager.LicenseSettings.ContainsKey("Budget")&&"FALSE"==s.a.SessionManager.LicenseSettings.Budget.toUpperCase())return;this.BudgetObj.BudgetValidation(e)}}},{key:"ValidateBudget",value:function(e,t){return!this.ScreenObject.Preferences.ContainsKey("Check Budget")||"False"==this.ScreenObject.Preferences["Check Budget"]||"False"==s.a.SessionManager.Preferences["Use Budget"]||s.a.SessionManager.LicenseSettings.ContainsKey("Budget")&&"FALSE"==s.a.SessionManager.LicenseSettings.Budget.toUpperCase()?(t.dim=null,t.BudID=0,t.BudStartDate=new Date,""):this.BudgetObj.ValidateBudget(e,t)}},{key:"SetVisibiltiFalse",value:function(){this.ImportVisiblity=!1,this.ProductImageVisibility=!1}},{key:"Dependencies",value:function(){if(null!=this.SelectedRow){this.SetVisibiltiFalse(),this.DependencyVisibility=!0,this.RightTabSelectedIndex=0,this.DependantText=o.e.StringValue(this.SelectedRow.dcAlpha11);var e=o.e.StringValue(this.SelectedRow.Dependencies).toString().split(",");this.Dependflds.Items.Clear();for(var t=0;t<this.ScreenObject.GridData.length;t++)if(!o.e.IsEmpty(this.ScreenObject.GridData[t].ProductID_Key)){if(this.ScreenObject.GridData[t]==this.SelectedRow)continue;e.Contains(this.ScreenObject.GridData[t].dcAlpha11.toString())?this.Dependflds.Items.push(m.c.CheckedListBoxItem_6(this.ScreenObject.GridData[t].dcAlpha11.toString(),this.ScreenObject.GridData[t].dcAlpha11.toString(),!0,0)):this.Dependflds.Items.push(m.c.CheckedListBoxItem_6(this.ScreenObject.GridData[t].dcAlpha11.toString(),this.ScreenObject.GridData[t].dcAlpha11.toString(),!1,0))}}}},{key:"AssignUsers",value:function(){if(null!=this.SelectedRow){this.SetVisibiltiFalse(),this.AssignVisibility=!0,this.RightTabSelectedIndex=0,null==this.AssignFields&&(this.AssignFields=new At(0,"",this)),s.a.page.ShowDialog(this.AssignFields,It.a,{HideClose:!1,ShowCenter:!0,Title:s.a.GetResource("Assign")}),this.AssignFields.ReportName=o.e.StringValue(this.SelectedRow.dcAlpha11);var e="",t="",n="";if(!o.e.IsEmpty(this.SelectedRow.AssignXML)){var a=new o.f;a.LoadXml(this.SelectedRow.AssignXML),a.DocumentElement.children.length>0&&(null==a.DocumentElement.children[0].attributes.Groups||o.e.IsEmpty(a.DocumentElement.children[0].attributes.Groups.value)||(e=a.DocumentElement.children[0].attributes.Groups.value),null==a.DocumentElement.children[0].attributes.Roles||o.e.IsEmpty(a.DocumentElement.children[0].attributes.Roles.value)||(n=a.DocumentElement.children[0].attributes.Roles.value),null==a.DocumentElement.children[0].attributes.Users||o.e.IsEmpty(a.DocumentElement.children[0].attributes.Users.value)||(t=a.DocumentElement.children[0].attributes.Users.value))}this.AssignFields.SetSelectedItems_2(this.AssignFields.Groups,e),this.AssignFields.SetSelectedItems_2(this.AssignFields.Roles,n),this.AssignFields.SetSelectedItems_2(this.AssignFields.Users,t)}}},{key:"PoleDisplayMessage",value:function(e,t){var n=this;try{var a="";if(this.ScreenObject.Data.Tables.length>18&&this.ScreenObject.Data.Tables[18].length>0){var i=function(){var i=n.ScreenObject.Data.Tables[18][0];if(n.ScreenObject.RegisterNodeID>0){var r=n.ScreenObject.Data.Tables[18].filter((function(e){return e.NodeID==n.ScreenObject.RegisterNodeID}));if(!(r.length>0))return{v:void 0};i=r[0]}var s=new o.f,c=null;if(1!=e||o.e.IsEmpty(i.IdleMessageXML)?2!=e||o.e.IsEmpty(i.ProductScanXML)?3!=e||o.e.IsEmpty(i.BillPayXML)?4!=e||o.e.IsEmpty(i.OnExitXML)||(s.LoadXml(i.OnExitXML),c=s.SelectNodes("ExitXML/Rows")):(s.LoadXml(i.BillPayXML),c=s.SelectNodes("BillPay/Rows")):(s.LoadXml(i.ProductScanXML),c=s.SelectNodes("ProductScan/Rows")):(s.LoadXml(i.IdleMessageXML),c=s.SelectNodes("IdleMessage/Rows")),null!=c&&c.length>0){var l=0,u=0;o.e.IsEmpty(i.NoOfLines)||(u=parseInt(i.NoOfLines)),o.e.IsEmpty(i.CharactersPerLine)||(l=parseInt(i.CharactersPerLine));for(var d=1,D=function(e){if(null!=c[e].attributes.LineNo&&""!=c[e].attributes.LineNo.value&&parseInt(c[e].attributes.LineNo.value)>u)return"continue";var i="";if(null!=c[e].attributes.FieldID&&"-1"==c[e].attributes.FieldID.value)null!=c[e].attributes.Data&&(i=c[e].attributes.Data.value);else if(null!=c[e].attributes.FieldID&&"-2"==c[e].attributes.FieldID.value)i=n.NetAmount;else if(null!=c[e].attributes.FieldID&&""!=c[e].attributes.FieldID.value){var r=n.ScreenObject.ColumnSource.find((function(t){return t.ID==c[e].attributes.FieldID.value}));i=null!=t&&r?"FLOAT"==r.DataType&&null!=c[e].attributes.Decimal&&""!=c[e].attributes.Decimal.value?parseFloat(t[r.DisplayMember]).ToString("N"+c[e].attributes.Decimal.value):t[r.DisplayMember].toString():n.GetHeaderData(c[e].attributes.FieldID.value)}var s=0;null!=c[e].attributes.NoOfCharacters&&""!=c[e].attributes.NoOfCharacters.value&&(s=parseInt(c[e].attributes.NoOfCharacters.value));var o="";if(i.length<s)for(var D=s-i.length;D>0;D--)o+=" ";else i=i.substr(0,s);if(null!=c[e].attributes.Align&&"Left"==c[e].attributes.Align.value?o=o.Insert(0,i):o+=i,i=o.toString(),null!=c[e].attributes.StartPosition&&""!=c[e].attributes.StartPosition.value&&parseInt(c[e].attributes.StartPosition.value)>1){o="";for(var h=1;h<parseInt(c[e].attributes.StartPosition.value);h++)o+=" ";i=o.toString()+i}if(null!=c[e].attributes.LineNo&&""!=c[e].attributes.LineNo.value&&parseInt(c[e].attributes.LineNo.value)<d)for(var S=d;S<parseInt(c[e].attributes.LineNo.value);S++){o="";for(var m=s;m<l;m++)o+=" ";s=0,a+=o.toString()}s+=i.length,d=parseInt(c[e].attributes.LineNo.value),a+=i},h=0;h<c.length;h++)D(h);n.OpenCashDrawer(i.PortName.toString(),a)}}();if("object"==typeof i)return i.v}}catch(r){}}},{key:"GetHeaderData",value:function(e){var t=o.e.Int(e);if(t>0){var n=this.ScreenObject._StaticFields.find((function(e){return e.DBColumnID==t}));if(n||(n=this.ScreenObject._TextFields.find((function(e){return e.DBColumnID==t}))),n||(n=this.ScreenObject._CCFields.find((function(e){return e.DBColumnID==t}))),!n){var a=this.ScreenObject.Data.Tables[0].filter((function(e){return e.CostCenterColID==t}));a.length>0&&(e=a[0].SysColumnName,null==n&&null!=this.ScreenObject.DocDate&&"DocDate"==e&&(n=this.ScreenObject.DocDate),null==n&&null!=this.ScreenObject.DocPrefix&&"VoucheNo"==e&&(n=this.ScreenObject.DocPrefix),null==n&&null!=this.ScreenObject.DueDate&&"DueDate"==e&&(n=this.ScreenObject.DueDate),null==n&&null!=this.ScreenObject.BillNo&&"BillNo"==e&&(n=this.ScreenObject.BillNo))}if(n)return this.GetFldName(n)}return""}},{key:"GetFldName",value:function(e){return e instanceof C.b&&e.SelectedValue>0&&null!=e.Text||e instanceof h.d&&null!=e.Text||e instanceof m.e&&null!=e.Text?e.Text:e instanceof g.a&&null!=e.ComboBox&&null!=e.TextBox&&null!=e.TextBox.Text&&null!=e.ComboBox.Text?e.ComboBox.Text+e.TextBox.Text:e instanceof S.a&&null!=e.Date?e.Date.ToString(s.a.SessionManager.Preferences["Date Format"]):""}},{key:"GetMatchedIndex",value:function(e,t){for(var n,a=0,i=0;i<this.ScreenObject.Data.Tables[19].length;i++){var r=e,s=!0,c=this.ScreenObject.Data.Tables[19][i].DefinitionXML.toString(),l=this.ScreenObject.Data.Tables[19][i].BarcodeXml.toString();if(""!=l){(n=new o.f).LoadXml(l);var u=n.SelectSingleNodeText("BarCodeBody/IsFixedBarcodeLength");if(null!=u&&"true"==u.toLowerCase()&&(null!=(u=n.SelectSingleNodeText("BarCodeBody/FixedBarcodeChar"))&&""!=u.trim())){var d=u[0];if(null!=(u=n.SelectSingleNodeText("BarCodeBody/IsFixedBarcodePrefix"))&&"true"==u.trim())for(var D=0;D<r.length&&r[D]==d;D++)r=r.Remove(0,1),D--;else for(var h=r.length-1;h>=0&&r[h]==d;h--)r=r.Remove(r.length-1,1)}if(null!=(u=n.SelectSingleNodeText("BarCodeBody/IsExclude"))&&"true"==u.toLowerCase()){var S=void 0;if(null!=(u=n.SelectSingleNodeText("BarCodeBody/ExcludeChar"))&&""!=u.trim()?S=u[0]:S=null!=(u=n.SelectSingleNodeText("BarCodeBody/FixedBarcodeChar"))&&""!=u.trim()?u[0]:" ",null!=(u=n.SelectSingleNode("BarCodeBody/IsExcludePrefix"))&&"true"==u.trim())for(var m=0;m<r.length&&r[m]==S;m++)r=r.Remove(0,1),m--;else for(var b=r.length-1;b>=0&&r[b]==S;b--)r=r.Remove(r.length-1,1)}null!=(u=n.SelectSingleNodeText("BarCodeBody/IncludeChecksum"))&&"true"==u.toLowerCase()&&(r=r.Remove(r.length-1,1))}if(""!=c){(n=new o.f).LoadXml(c);for(var C=n.SelectNodes("Definition/Field"),y=0;y<C.length;y++){var p,g="",f=0;if(o.f.SelectSingleNodeText(C[y],"DataSource"),o.f.SelectSingleNodeText(C[y],"SysColumn"),p=o.f.SelectSingleNodeText(C[y],"Delimiter"),(g=o.f.SelectSingleNodeText(C[y],"Width")).length>0&&o.e.IsNum(g)&&(f=parseInt(g)),(g=o.f.SelectSingleNodeText(C[y],"Decimals")).length>0&&o.e.IsNum(g)&&parseInt(g),g="",-1==f&&""!=p){var O=r.indexOf(p);O>0&&O<r.length?(g=r.substr(0,O),r=r.Remove(0,O)):s=!1}else-1!=f?r.length>=f?(g=r.substr(0,f),r=r.Remove(0,f)):s=!1:-1==f&&y==C.length-1&&(g=r,r="");""!=p&&r.length>p.length?r=r.Remove(0,p.length):""!=r&&(s=!1)}}if(s){a=i;break}}return a}},{key:"ReadBarcode",value:function(e,t,n,a,i,r){var l=this;if(r.PID=0,null!=n&&o.e.IsEmpty(n.Text))return!1;var u=0;this.ScreenObject.Data.Tables[19].length>1&&(u=this.GetMatchedIndex(null!=n?n.Text:i,a),e=this.ScreenObject.Data.Tables[19][u].DefinitionXML.toString(),t=this.ScreenObject.Data.Tables[19][u].BarcodeXml.toString());var d=!1,D=0,h=function(){var h="";h=null!=n?n.Text:i,l.barcodeValues=new c.a;var S="";if(""!=e||""!=t){var m;if(""!=t){(m=new o.f).LoadXml(t);var b,C=m.SelectSingleNodeText("BarCodeBody/IsFixedBarcodeLength");if(null!=C&&"true"==C.toLowerCase()&&(null!=(C=m.SelectSingleNodeText("BarCodeBody/FixedBarcodeChar"))&&""!=C.trim())){var y=C[0];if(null!=(C=m.SelectSingleNodeText("BarCodeBody/IsFixedBarcodePrefix"))&&"true"==C.trim())for(var p=0;p<h.length&&h[p]==y;p++)h=h.Remove(0,1),p--;else for(var g=h.length-1;g>=0&&h[g]==y;g--)h=h.Remove(h.length-1,1)}if(null!=(C=m.SelectSingleNodeText("BarCodeBody/IsExclude"))&&"true"==C.toLowerCase())if(null!=(C=m.SelectSingleNodeText("BarCodeBody/ExcludeChar"))&&""!=C.trim()?b=C[0]:b=null!=(C=m.SelectSingleNodeText("BarCodeBody/FixedBarcodeChar"))&&""!=C.trim()?C[0]:" ",null!=(C=m.SelectSingleNodeText("BarCodeBody/IsExcludePrefix"))&&"true"==C.trim())for(var f=0;f<h.length&&h[f]==b;f++)h=h.Remove(0,1),f--;else for(var O=h.length-1;O>=0&&h[O]==b;O--)h=h.Remove(h.length-1,1);null!=(C=m.SelectSingleNodeText("BarCodeBody/IncludeChecksum"))&&"true"==C.toLowerCase()&&(h=h.Remove(h.length-1,1))}if(""!=e){(m=new o.f).LoadXml(e);for(var I=m.SelectNodes("Definition/Field"),T=0;T<I.length;T++){var j,P,A="",M="",v="",G=0,N=0;if(A=o.f.SelectSingleNodeText(I[T],"DataSource"),j=o.f.SelectSingleNodeText(I[T],"SysColumn"),P=o.f.SelectSingleNodeText(I[T],"Delimiter"),M=o.f.SelectSingleNodeText(I[T],"Width"),("Batch_MfgDate"==j||"Batch_ExpDate"==j)&&M.length>0&&(G=(v=M).length),M.length>0&&o.e.IsNum(M)&&(G=parseInt(M)),(M=o.f.SelectSingleNodeText(I[T],"Decimals")).length>0&&o.e.IsNum(M)&&(N=parseInt(M)),M="",-1==G&&""!=P){var E=h.indexOf(P);E>0&&E<h.length&&(M=h.substr(0,E),h=h.Remove(0,E))}else-1!=G&&h.length>=G?(M=h.substr(0,G),h=h.Remove(0,G)):-1==G&&T==I.length-1&&(M=h);if(""!=P&&h.length>P.length&&(h=h.Remove(0,P.length)),"Product"==A&&""!=M)""==S&&(S+="<XML>"),S+='<Row CostcenterID="3"',S+=' syscolname="'+j+'"',S+=' value="'+M+'" />';else if(A.startsWith("CC")&&""!=M){var w=5e4;""==S&&(S+="<XML>"),S+='<Row CostcenterID="'+(w+=parseInt(A.replace("CC","")))+'"',S+=' syscolname="'+j+'"',S+=' value="'+M+'" />'}else if("Document"==A&&"INVID"==j&&""!=M)""==S&&(S+="<XML>"),S+='<Row CostcenterID="400"',S+=' syscolname="Inv_docDetailsID"',S+=' value="'+M+'" />',l.barcodeValues.push(j,M);else if("Document"==A&&""!=M)if(""!=v){var F,V=0,L=0;F=v.startsWith("YYYY")?l.ScreenObject.GetMonthName(parseInt(M.substr(4,2)),!1):v.startsWith("MM")?l.ScreenObject.GetMonthName(parseInt(M.substr(0,2)),!1):l.ScreenObject.GetMonthName(parseInt(M.substr(2,2)),!1),V=v.startsWith("YYYY")?parseInt(M.substr(6,2)):v.startsWith("DD")?parseInt(M.substr(0,2)):parseInt(M.substr(2,2)),L=v.startsWith("YYYY")?parseInt(M.substr(0,4)):v.Contains("YYYY")?parseInt(M.substr(4,4)):parseInt(M.substr(4,2)),l.barcodeValues.push(j,V.toString()+"/"+F+"/"+L.toString())}else l.ScreenObject.GridDataColumns.Contains(j)?l.ScreenObject.GridDataObj.DataTypes.Double.Contains(j)?(N>0&&(M=M.Insert(M.length-N,".")),o.e.IsNum(M)&&(null!=a&&(a[j]=M),l.barcodeValues.push(j,M))):l.ScreenObject.GridDataObj.DataTypes.Int.Contains(j)?o.e.IsNum(M)&&(null!=a&&(a[j]=M),l.barcodeValues.push(j,M)):(null!=a&&(a[j]=M),l.barcodeValues.push(j,M)):N>0?(M=M.Insert(M.length-N,"."),l.barcodeValues.push(j,M)):l.barcodeValues.push(j,M);else"Document"!=A||null==a||"Batch_No"!=j&&"Batch_Code"!=j||""==M||l.barcodeValues.push(j,M)}}else S+="<XML>",S+='<Row CostcenterID="3"',S+=' syscolname="ProductCode"',S+=' value="'+h+'" />'}var R=null;if(""!=S&&(S+="</XML>",R=s.a.document.GetCCValues_xml(S)),null!=R&&R.Tables.length>0&&R.Columns[0].Contains("CostCenterID")){if(R.Tables.length>1&&R.Tables[1].length>0)for(var B=function(e){var t=l.ScreenObject.GridData.filter((function(t){return t.BOEID==R.Tables[1][e].InvDocDetailsID}));return t.length>0?!o.e.IsEmpty(t[0].UOMConvertedQty)&&parseFloat(t[0].UOMConvertedQty)<parseFloat(R.Tables[1][e].Qty)?{v:{v:(l.DisplayMessage="Select Product in FIFO Order",!1)}}:void 0:{v:{v:(l.DisplayMessage="Select Product in FIFO Order",!1)}}},x=0;x<R.Tables[1].length;x++){var k=B(x);if("object"==typeof k)return k.v}for(var _=function(e){var t=l.ScreenObject.ColumnSource.find((function(t){return t.CostCenterID==parseInt(R.Tables[0][e].CostCenterID)}));if(t)if(null!=a){if(a[t.DisplayMember]=R.Tables[0][e].Name.toString(),a[t.ValueMember]=R.Tables[0][e].NODEID.toString(),3==t.CostCenterID){if(R.Columns[0].Contains("VenderID")){if(R.Columns[0].Contains("barcodeid")&&!o.e.IsEmpty(R.Tables[0][e].barcodeid)&&parseInt(R.Tables[0][e].barcodeid)>0&&l.ScreenObject.Preferences.ContainsKey("BarcodeDimension")&&""!=l.ScreenObject.Preferences.BarcodeDimension&&parseInt(l.ScreenObject.Preferences.BarcodeDimension)>0){var i=l.ScreenObject.ColumnSource.find((function(e){return e.CostCenterID==parseInt(l.ScreenObject.Preferences.BarcodeDimension)}));i&&!l.barcodeValues.ContainsKey(i.ValueMember)&&(l.barcodeValues.push(i.ValueMember,R.Tables[0][e].barcodeid.toString()),l.barcodeValues.push(i.DisplayMember,R.Tables[0][e].ECode.toString()))}if(R.Columns[0].Contains("UnitID")&&o.e.Int(R.Tables[0][e].UnitID)>0&&!l.barcodeValues.ContainsKey("Unit_Key"))l.barcodeValues.push("Unit_Key",R.Tables[0][e].UnitID.toString()),l.barcodeValues.push("Unit",R.Tables[0][e].UnitName.toString()),a.Unit_Key=R.Tables[0][e].UnitID.toString(),a.Unit=R.Tables[0][e].UnitName.toString();else if(R.Columns[0].Contains("AccountCode")&&!o.e.IsEmpty(R.Tables[0][e].VenderID)&&parseInt(R.Tables[0][e].VenderID)>0){var r=l.ScreenObject.Data.Tables[0];r.length>0&&((r=l.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&53412==e.LinkData}))).length>0&&!l.barcodeValues.ContainsKey(r[0].SysColumnName)&&(a[r[0].SysColumnName]=R.Tables[0][e].AccountCode.toString(),l.barcodeValues.push(r[0].SysColumnName,R.Tables[0][e].AccountCode.toString())),(r=l.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&53413==e.LinkData}))).length>0&&!l.barcodeValues.ContainsKey(r[0].SysColumnName)&&(a[r[0].SysColumnName]=R.Tables[0][e].AccountName.toString(),l.barcodeValues.push(r[0].SysColumnName,R.Tables[0][e].AccountName.toString())),(r=l.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&50493==e.LinkData}))).length>0&&!l.barcodeValues.ContainsKey(r[0].SysColumnName)&&R.Columns[0].Contains("ECode")&&(a[r[0].SysColumnName]=R.Tables[0][e].ECode.toString(),l.barcodeValues.push(r[0].SysColumnName,R.Tables[0][e].ECode.toString())))}}null!=n&&(n.Text=R.Tables[0][e].Code.toString(),n.SelectedValue=R.Tables[0][e].NODEID.toString()),l.ScreenObject.GridDataColumns.Contains("ProductCode")&&(a.ProductCode=R.Tables[0][e].Code.toString()),l.ScreenObject.GridDataColumns.Contains("ProductName")&&(a.ProductName=R.Tables[0][e].Name.toString()),l.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&(a.ProductID_Key=R.Tables[0][e].NODEID.toString()),!o.e.IsEmpty(R.Tables[0][e].NODEID)&&parseInt(R.Tables[0][e].NODEID)>0&&(d=!0)}}else l.barcodeValues.ContainsKey(t.ValueMember)||l.barcodeValues.push(t.ValueMember,R.Tables[0][e].NODEID.toString())},K=0;K<R.Tables[0].length;K++)_(K);for(var Q=0;Q<R.Tables[0].length;Q++)3==parseInt(R.Tables[0][Q].CostCenterID)&&!o.e.IsEmpty(R.Tables[0][Q].NODEID)&&parseInt(R.Tables[0][Q].NODEID)>0&&(r.PID=parseInt(R.Tables[0][Q].NODEID),d=!0)}d||(D++,l.ScreenObject.Data.Tables[19].length>D&&(++u>=l.ScreenObject.Data.Tables[19].length&&(u=0),e=l.ScreenObject.Data.Tables[19][u].DefinitionXML.toString(),t=l.ScreenObject.Data.Tables[19][u].BarcodeXml.toString()))};do{var S=h();if("object"==typeof S)return S.v}while(!d&&this.ScreenObject.Data.Tables[19].length>D);return d||null==a||(this.ScreenObject.GridDataColumns.Contains("ProductCode")&&(a.ProductCode=null),this.ScreenObject.GridDataColumns.Contains("ProductName")&&(a.ProductName=null),this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&(a.ProductID_Key=null)),d}},{key:"Export",value:function(e,t,a){arguments.length>3&&void 0!==arguments[3]&&arguments[3];var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function r(){var l,u,d,D,h,S,m,b,C,y=this;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(376!=this.StatusID){r.next=2;break}return r.abrupt("return",void(this.DisplayMessage="Documents is cancelled"));case 2:if(371!=this.StatusID||!this.DoNotPrintUnApprovedDocuments){r.next=4;break}return r.abrupt("return",void(this.DisplayMessage="Un-Approved documents not allowed to export"));case 4:if(371!=this.StatusID||s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Print/Export Un-Approved")){r.next=6;break}return r.abrupt("return",void(this.DisplayMessage="Un-Approved documents not allowed to export"));case 6:if(441!=this.StatusID||s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Print/Export Approved")){r.next=8;break}return r.abrupt("return",void(this.DisplayMessage="Approved documents not allowed to export"));case 8:if(372!=this.StatusID||s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Print/Export Rejected")){r.next=10;break}return r.abrupt("return",void(this.DisplayMessage="Rejected documents not allowed to export"));case 10:return l=null,r.next=13,Promise.resolve().then(n.bind(null,"5FTv"));case 13:return u=r.sent,d=u.VoucherExportExcel,r.next=17,Promise.resolve().then(n.bind(null,"ia84"));case 17:return D=r.sent,h=D.VPTDialogViewModel,r.next=21,Promise.resolve().then(n.bind(null,"SW+i"));case 21:S=r.sent,m=S.VPTDialogComponent,null!=(b=d.GetLocationPrintLayouts(this.DocumentID,0,e,4))&&0!=b.Tables[0].length||(this.DisplayMessage=s.a.GetResource("Err_PrintLayoutNotDefined")),this.sDSCUserName="",this.bDSExists=!1,this.oDSImg=null,C=new h(b.Tables[0],!i,!1),s.a.page.ShowDialog(C,m,{ShowCenter:!0,NoWidth:!0}).subscribe((function(){if(C.IsOkClicked&&(l=C.SelectedRow,y.sDSCUserName=C.sDSCUserName),null!=l){var n=new c.a;n.push("SaveFileName",y.ScreenObject.VoucherNo),n.push("ContinuousExportClubOtherDocs",a?"1":"0");var r=[e.toString()];a||o.e.IsEmpty(t)||(r.AddRange(t.split(",")),t=null),n.push("OtherDocNos",t);var u=C.IsExcelChecked?"EXCEL":"PDF";r.forEach((function(e){s.a.report.ExportVPT(y.CostCenterID,e,parseInt(l.DocPrintLayoutID),u,y.IsInventoryVoucher,n).subscribe((function(t){console.log(t),i?(s.a.SessionManager.printTab(t.FileName),o.e.IsEmpty(t.Message)&&!o.e.IsEmpty(t.FileName)&&(y.DisplayMessage="Error in Print")):(s.a.SessionManager.Download(t.FileName,"abcd"+e),o.e.IsEmpty(t.Message)&&!o.e.IsEmpty(t.FileName)&&(y.DisplayMessage="Exported Successfully"))}),(function(e){console.log(e)}))}))}}));case 27:case"end":return r.stop()}}),r,this)})))}},{key:"importWorker_DoWork",value:function(e,t){var n=this;this.FailedRecourdList.Clear();var a,i=null,r=null;i=new c.a;for(var u=function(e){var t=n.DtImport[e];if(!o.e.IsEmpty(t.FeatureFieldName)&&"0"!=o.e.StringValue(t.FeatureFieldName))if(null==(D=n.ScreenObject.ColumnSource.find((function(e){return e.ID==t.FeatureFieldName.toString()})))&&(D=n.ScreenObject.ColumnSource.find((function(e){return"-"+e.ID==t.FeatureFieldName.toString()}))),null==D||"LISTBOX"!=D.DataType||o.e.IsEmpty(i.ContainsKey(D.CostCenterID))){if(null!=D&&"LINK"==D.DataType&&"refno"==D.DisplayMember.toLowerCase()&&!i.ContainsKey(400)&&i.ContainsKey(3)){for(var r="",c="",l=1;l<n.ExcelTable.length;l++)""!=r&&(r+=","),r+="'"+n.ExcelTable[l][0]+"'";for(var u=0;u<i[3].length;u++)""!=c&&(c+=","),c+=i[3][u].ID.toString();var d=n.ScreenObject.GetLinkDefDetails(n.CostCenterID,0,r,c);null!=d&&d.Tables.length>0&&i.push(400,d.Tables[0]),null!=d&&d.Tables.length>1&&i.push(43,d.Tables[1])}}else{var m=!1;(D.DisplayMember.toLowerCase().Contains("code")||s.a.SessionManager.Preferences.ContainsKey("POSItemCodeDimension")&&n.IsInventoryVoucher&&D.CostCenterID.toString()==s.a.SessionManager.Preferences.POSItemCodeDimension)&&(m=!0);var b=n.ScreenObject.GetUniqueDimension(D.CostCenterID,m);if(b>5e4){var y=0;if(null==(h=n.ScreenObject.ColumnSource.find((function(e){return e.CostCenterID==b})))||o.e.IsEmpty(h.ID)?null!=(S=n.ScreenObject._CCFields.find((function(e){return e instanceof C.b&&e.CCID==b})))&&(y=S.DBColumnID):y=parseInt(h.ID),!(y>0))return{v:(n.DisplayMessage="Define Unique dimension column",void(n.MessageVisibility=!0))};!function(){var e=n.DtImport.filter((function(e){return e.FeatureFieldName=="'"+y+"'"}));if(e.length>0){if(!i.ContainsKey(b)){var r="";n.ExcelTable.Columns.Contains("IMPORT_STATUS")||n.ExcelTable.Columns.push("IMPORT_STATUS"),n.ExcelTable.Columns.Contains("xIMP_STATUSx")||n.ExcelTable.Columns.push("xIMP_STATUSx"),n.ExcelTable.Columns.Contains("IMPORT_MESSAGE")||n.ExcelTable.Columns.push("IMPORT_MESSAGE");for(var o=1;o<n.ExcelTable.length;o++)""!=r&&(r+=","),r+="'"+n.ExcelTable[o][e[0][0].toString()].toString().Trim().Replace("'","''")+"'";var c=s.a.document.GetCCValues(r,b,0);i.push(b,c)}n.ExcelTable.Columns.Contains("UniqDim")||n.ExcelTable.Columns.push("UniqDim");for(var l="",u=function(r){(a=i[b].filter((function(t){return t.Name==n.ExcelTable[r][e[0][0].toString()].toString().Trim().Replace("'","''")}))).length>0&&(""!=l&&(l+=" or "),3==D.CostCenterID?l+=" ("+(m?"ProductCode":"ProductName")+"='"+n.ExcelTable[r][t[0].toString()].toString().Trim().Replace("'","''")+"' and ccnid"+(b-5e4)+"="+a[0].ID.toString()+")":2==D.CostCenterID?l+=" ("+(m?"AccountCode":"AccountName")+"='"+n.ExcelTable[r][t[0].toString()].toString().Trim().Replace("'","''")+"' and ccnid"+(b-5e4)+"="+a[0].ID.toString()+")":D.CostCenterID>5e4&&(l+=" ("+(m?"Code":"Name")+"='"+n.ExcelTable[r][t[0].toString()].toString().Trim().Replace("'","''")+"' and ccnid"+(b-5e4)+"="+a[0].ID.toString()+")"),n.ExcelTable[r].UniqDim=a[0].ID.toString())},d=1;d<n.ExcelTable.length;d++)u(d);if(""!=l){var h=s.a.document.GetCCValues_string(l,D.CostCenterID,"ccnid"+(b-5e4));i.push(D.CostCenterID,h)}}}()}else{for(var p,g="",f=1;f<n.ExcelTable.length;f++)""!=g&&(g+=","),g+="'"+n.ExcelTable[f][0].toString().Trim().Replace("'","''")+"'";if("CreditAccount_Key"==D.ValueMember||"DebitAccount_Key"==D.ValueMember)if(null!=(p=n.ScreenObject.ColumnSource.find("CreditAccount_Key"==D.ValueMember?function(e){return!o.e.IsEmpty(e.ValueMember)&&"DebitAccount_Key"==e.ValueMember}:function(e){return!o.e.IsEmpty(e.ValueMember)&&"CreditAccount_Key"==e.ValueMember}))){var O=n.DtImport.filter((function(e){return e.FeatureFieldName==p.ID}));if(O.length>0)for(var I=0;I<n.ExcelTable.length;I++)""!=g&&(g+=","),g+="'"+n.ExcelTable[I][O[0][0].toString()].toString().Trim().Replace("'","''")+"'"}var T=s.a.document.GetCCValues(g,D.CostCenterID,m?1:0,"CreditAccount_Key"==D.ValueMember||"DebitAccount_Key"==D.ValueMember?" and IsGroup=0 ":"");i.push(D.CostCenterID,T)}}},d=0;d<this.DtImport.length-1;d++){var D,h,S,m=u(d);if("object"==typeof m)return m.v}for(var b=null,g=0,f=0;f<this.ScreenObject.GridData.length;f++)if(this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&""==o.e.String(this.ScreenObject.GridData[f].ProductID_Key)||this.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&""==o.e.String(this.ScreenObject.GridData[f].DebitAccount_Key)||this.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&""==o.e.String(this.ScreenObject.GridData[f].CreditAccount_Key)){g=f;break}var O=this.ScreenObject.Data.Tables[0].filter((function(e){return"ProductID"==e.SysColumnName})),I=!1;this.ScreenObject.Preferences.ContainsKey("EnableSchemes")&&Object(l.j)(this.ScreenObject.Preferences.EnableSchemes)&&(I=Object(l.j)(this.ScreenObject.Preferences.EnableSchemes));var T=5;(T=o.e.IntTryParse(this.ImportChunkSize))<1&&(T=5);for(var j=!0,P=function(e){b=null,e%T==0&&(n.DisplayMessage="Importing   "+(e+1).toString()+" of "+n.ExcelTable.length,n.ExcelTable.Columns.Contains("IMPORT_STATUS")&&(n.ExcelTable[e].xIMP_STATUSx="PASS",n.ExcelTable[e].IMPORT_MESSAGE=""));for(var t=function(t){var c=n.DtImport[t];if(o.e.IsEmpty(c.FeatureFieldName)||"0"==o.e.String(c.FeatureFieldName))return"continue";var l=null;if("100"==c.FeatureFieldName.toString()&&n.ImportIsUpdate&&null==b?(r=n.ScreenObject.GridData.filter((function(t){return t.DocSeqNo==n.ExcelTable[e][0].toString().Trim().Replace("'","''")+"'"}))).length>0&&(b=r[0]):l=n.ScreenObject.ColumnSource.find((function(e){return e.ID==c.FeatureFieldName.toString()})),null==l&&(l=n.ScreenObject.ColumnSource.find((function(e){return"-"+e.ID==c.FeatureFieldName.toString()}))),null!=l)if(67==n.ScreenObject.DocumentType&&null==b&&(b=n.ScreenObject.GridDataObj.NewRow(),n.ScreenObject.GridDataObj.insertRowAt(b,g),g++,O.length>0&&""!=o.e.StringValue(O[0].UserDefaultValue)&&(b.ProductID_Key=O[0].UserDefaultValue)),81==n.ScreenObject.DocumentType&&null==b&&(j&&(n.ScreenObject.GridDataObj.Clear(),j=!1),b=n.ScreenObject.GridDataObj.NewRow(),n.ScreenObject.GridDataObj.insertRowAt(b,g),g++,O.length>0&&""!=o.e.StringValue(O[0].UserDefaultValue)&&(b.ProductID_Key=O[0].UserDefaultValue)),89!=n.ScreenObject.DocumentType&&90!=n.ScreenObject.DocumentType&&68!=n.ScreenObject.DocumentType&&79!=n.ScreenObject.DocumentType||null==b&&(b=n.ScreenObject.GridDataObj.NewRow(),n.ScreenObject.GridDataObj.insertRowAt(b,g),g++,O.length>0&&""!=o.e.StringValue(O[0].UserDefaultValue)&&(b.ProductID_Key=O[0].UserDefaultValue)),"LISTBOX"==l.DataType&&!o.e.IsEmpty(i.ContainsKey(l.CostCenterID))&&i.ContainsKey(l.CostCenterID)){if(a=l.DisplayMember.toLowerCase().Contains("code")||s.a.SessionManager.Preferences.ContainsKey("POSItemCodeDimension")&&n.IsInventoryVoucher&&l.CostCenterID.toString()==s.a.SessionManager.Preferences.POSItemCodeDimension?i[l.CostCenterID].Tables[0].filter((function(t){return t.Code.toLowerCase()==n.ExcelTable[e][0].toLowerCase().toString().Trim().Replace("'","''")})):i[l.CostCenterID].Tables[0].filter((function(t){return t.name.toLowerCase()==n.ExcelTable[e][0].toLowerCase().toString().Trim().Replace("'","''")})),i[l.CostCenterID].Tables[0].Contains("dim")&&(a=a.filter((function(t){return t.dim.toLowerCase()==n.ExcelTable[e].UniqDim.toLowerCase()}))),11==l.CostCenterID&&i[l.CostCenterID].Tables[0].Contains("ProductID")&&null!=b&&!o.e.IsEmpty(b.ProductID_Key)&&(a=a.filter((function(e){return e.ProductID.toLowerCase()==b.ProductID_Key.toLowerCase()}))),0==a.length&&50051==l.CostCenterID&&(a=i[l.CostCenterID].Tables[0].filter((function(t){return t.name.toLowerCase()==n.ExcelTable[e][0].toLowerCase().toString().Trim().Replace("'","''")}))),0==a.length&&11==l.CostCenterID&&i[l.CostCenterID].Contains("ProductID")&&null!=b&&""!=b.ProductID_Key.toString()&&(a=i[l.CostCenterID].Tables[0].filter((function(t){return t.name.toLowerCase()==n.ExcelTable[e][0].toLowerCase().toString().Trim().Replace("'","''")}))),null!=a)if(null==b){if(n.IsInventoryVoucher&&3==l.CostCenterID)if(a.length>0)n.ImportIsUpdate?(r=n.ScreenObject.GridData.filter((function(e){return e.ProductID_Key==a[0].ID.toString()}))).length>0&&(b=r[0]):(b=n.ScreenObject.GridDataObj.NewRow(),n.ScreenObject.GridDataObj.insertRowAt(b,g),g++,b.ProductID_Key=a[0].ID,n.ScreenObject.GridDataColumns.Contains("ProductCode")&&(b.ProductCode=a[0].Code),n.ScreenObject.GridDataColumns.Contains("ProductName")&&(b.ProductName=a[0].Name),n.ProdID=0,n.AddProductData(b,!1,!0));else{var u=n.ScreenObject.ColumnSource.find((function(e){return null!=e.ValueMember&&"productid_key"==e.ValueMember.toLowerCase()}));if(null!=u&&null!=u.DefaultValue&&""!=u.DefaultValue&&null!=u.DefaultValueText&&o.e.IntTryParse(u.DefaultValue)>0){o.e.IntTryParse(u.DefaultValue),b=n.ScreenObject.GridDataObj.NewRow(),n.ScreenObject.GridDataObj.insertRowAt(b,g),g++;var d=u.DefaultValueText.split("\x11");b.ProductID_Key=u.DefaultValue,n.ScreenObject.GridDataColumns.Contains("ProductCode")&&d.length>1&&(b.ProductCode=d[1]),n.ScreenObject.GridDataColumns.Contains("ProductName")&&d.length>0&&(b.ProductName=d[0]),n.ProdID=0,n.AddProductData(b,!1,!0)}else{if(l.DisplayMember.toLowerCase().Contains("code")){var D=new nn;D.Name=" Product Code: "+n.ExcelTable[e][c[0].toString()].toString(),D.Message="Not Found",n.FailedRecourdList.push(D)}n.ExcelTable.Columns.Contains("IMPORT_STATUS")&&(n.ExcelTable[e].xIMP_STATUSx="FAIL",n.ExcelTable[e].IMPORT_MESSAGE=n.ExcelTable[e][c[0].toString()].toString()+" Not Found")}}else 2==l.CostCenterID&&!n.IsInventoryVoucher&&a.length>0?n.ImportIsUpdate?(r=n.ScreenObject.GridData.filter((function(e){return e.ProductID_Key==a[0].ID.toString()}))).length>0&&(b=r[0]):(b=n.ScreenObject.GridDataObj.NewRow(),n.ScreenObject.GridDataObj.insertRowAt(b,g),g++,b[l.ValueMember]=a[0].ID,l.DisplayMember.toLowerCase().Contains("code")&&n.ScreenObject.GridDataColumns.Contains(l.DisplayMember)?b[l.DisplayMember]=a[0].Code:n.ScreenObject.GridDataColumns.Contains(l.DisplayMember)&&(b[l.DisplayMember]=a[0].Name)):s.a.SessionManager.Preferences.ContainsKey("POSItemCodeDimension")&&n.IsInventoryVoucher&&l.CostCenterID.toString()==s.a.SessionManager.Preferences.POSItemCodeDimension?a.length>0?(b=n.ScreenObject.GridDataObj.NewRow(),n.ScreenObject.GridDataObj.insertRowAt(b,g),g++,b[l.ValueMember]=a[0].ID,b[l.DisplayMember]=a[0].Code,n.ScreenObject.Preferences.ContainsKey("OnScan")&&""!=n.ScreenObject.Preferences.OnScan.toLowerCase()?n.GetProductByExternFunc(b[l.DisplayMember].toString(),b,g):n.ScreenObject.Preferences.ContainsKey("PickStockRate")&&"true"==n.ScreenObject.Preferences.PickStockRate.toLowerCase()?(n.GetProductByStockCode(b[l.DisplayMember].toString(),b,g),""!=b.ProductID_Key.toString()&&n.FillScan(b,g)):n.AddProductData(b,!1,!1,!1,null,b[l.DisplayMember].toString())):n.ExcelTable.Columns.Contains("IMPORT_STATUS")&&(n.ExcelTable[e].xIMP_STATUSx="FAIL",n.ExcelTable[e].IMPORT_MESSAGE=n.ExcelTable[e][c[0].toString()].toString()+" Not Found"):n.IsInventoryVoucher&&50051==l.CostCenterID&&(a.length>0?n.ImportIsUpdate?(r=n.ScreenObject.GridData.filter((function(e){return e.col.DisplayMember+"_Key"==a[0].ID.toString()}))).length>0&&(b=r[0]):(b=n.ScreenObject.GridDataObj.NewRow(),n.ScreenObject.GridDataObj.insertRowAt(b,g),g++,O.length>0&&""!=o.e.StringValue(O[0].UserDefaultValue)&&(b.ProductID_Key=O[0].UserDefaultValue),b[l.ValueMember]=a[0].ID,l.DisplayMember.toLowerCase().Contains("code")&&n.ScreenObject.GridDataColumns.Contains(l.DisplayMember)?(b[l.DisplayMember]=a[0].Code,b[l.DisplayMember.toLowerCase().Replace("code","")]=a[0].Name):n.ScreenObject.GridDataColumns.Contains(l.DisplayMember)&&(b[l.DisplayMember]=a[0].Name)):n.ExcelTable.Columns.Contains("IMPORT_STATUS")&&(n.ExcelTable[e].xIMP_STATUSx="FAIL",n.ExcelTable[e].IMPORT_MESSAGE=n.ExcelTable[e][c[0].toString()].toString()+" Not Found"));67!=n.ScreenObject.DocumentType&&79!=n.ScreenObject.DocumentType||n.Celleditend(b,l.DisplayMember,0),2!=l.CostCenterID||n.IsInventoryVoucher||0!=a.length||n.ExcelTable.Columns.Contains("IMPORT_STATUS")&&(n.ExcelTable[e].xIMP_STATUSx="FAIL",n.ExcelTable[e].IMPORT_MESSAGE=n.ExcelTable[e][c[0].toString()].toString()+" Not Found")}else null!=b&&3!=l.CostCenterID&&(a.length>0?(b[l.ValueMember]=a[0].ID,n.ScreenObject.GridDataColumns.Contains(l.DisplayMember)&&(l.DisplayMember.endsWith("Code")?(b[l.DisplayMember]=a[0].Code,b.Table.Columns.Contains(l.DisplayMember.Replace("Code",""))&&(b[l.DisplayMember.Replace("Code","")]=a[0].Name)):b[l.DisplayMember]=a[0].Name)):n.ExcelTable.Columns.Contains("IMPORT_STATUS")&&(n.ExcelTable[e].xIMP_STATUSx="FAIL",n.ExcelTable[e].IMPORT_MESSAGE=n.ExcelTable[e][c[0].toString()].toString()+" Not Found"),11==n.CostCenterID&&n.OnProductUnitChange(b),67!=n.ScreenObject.DocumentType&&63!=n.ScreenObject.DocumentType&&79!=n.ScreenObject.DocumentType||n.Celleditend(b,l.DisplayMember,0))}else if(null!=b&&null!=l&&"LINK"==l.DataType&&"refno"==l.DisplayMember.toLowerCase()&&i.Contains(400)&&i.Contains(43))(a=i[400].filter((function(t){return t.VoucherNo=="'"+n.ExcelTable[e][0].toString().Trim()+"'"&&t.ProductID==b.ProductID_Key.toString()}))).length>0&&(b[l.DisplayMember]=n.ExcelTable[e][0].toString().Trim(),b.LinkedInvDocDetailsID=a[0].InvDocDetailsID.toString(),(a=i[43].filter((function(e){return e.CostCenterIDLinked==a[0].CostCenterID.toString()}))).length>0&&(b.LinkedFieldName=a[0].SysColumnName.toString()));else if(null!=b&&null!=l&&"LINK"==l.DataType&&l.DisplayMember.Contains("dcAlpha"));else if(null==b||"FLOAT"!=l.DataType.toUpperCase()&&"INT"!=l.DataType.toUpperCase()){var h;if(null==b||"textblock"!=l.DataType.toLowerCase()&&"text"!=l.DataType.toLowerCase()&&"FLOAT"!=l.DataType.toUpperCase()&&"INT"!=l.DataType.toUpperCase())if(null==b||"date"!=l.DataType.toLowerCase()&&"datetime"!=l.DataType.toLowerCase()&&"time"!=l.DataType.toLowerCase()&&"time2"!=l.DataType.toLowerCase()){if(null!=b&&"combobox"==l.DataType.toLowerCase()){if(68==n.ScreenObject.DocumentType&&(n.ExcelTable[e][0].toString().Trim().toLowerCase().Contains("earning")||n.ExcelTable[e][c.FieldName.toString()].toString().Trim().toLowerCase().Contains("deduction")))n.ExcelTable[e][c.FieldName.toString()].toString().Trim().toLowerCase().Contains("earning")&&(b[l.ValueBinding]=2),n.ExcelTable[e][c.FieldName.toString()].toString().Trim().toLowerCase().Contains("deduction")&&(b[l.ValueBinding]=3);else{b[l.ValueBinding]=n.ExcelTable[e][0].toString().Trim();var S=n.ScreenObject.ColumnSource.filter((function(e){return"dcCCNID52"==e.DisplayMember}));null!=S&&!o.e.IsEmpty(S.Shortcut)&&"lostfocus"==S.Shortcut.toLowerCase()&&n.ValidateData_Column(S,b,!0)&&n.ScreenObject.GetExternalFuncData(S.Mode,S.SPName,S.IPParams,S.OPParams,b)}63==n.ScreenObject.DocumentType&&n.Celleditend(b,l.ValueBinding,0)}else if(null!=b&&"pactcombobox"==l.DataType.toLowerCase()&&68==n.ScreenObject.DocumentType){var m=l.ComboDataTable.filter((function(t){return t.NAME==n.ExcelTable[e][0].toString().Trim()}));null!=m&&m.length>0&&(b[l.ValueBinding]=m[0].NODEID,b[l.ValueBinding+"_Key"]=m[0].NAME)}}else o.e.isValidDate(new Date(n.ExcelTable[e][0].toString()))&&(h=new Date(n.ExcelTable[e][0].toString()),"date"==l.DataType.toLowerCase()?(b[l.DisplayMember]=h.ToString(s.a.SessionManager.Preferences["Date Format"]),b[l.DisplayMember+"_Key"]=h,60!=n.ScreenObject.DocumentType&&63!=n.ScreenObject.DocumentType||n.Celleditend(b,l.DisplayMember,0)):"datetime"==l.DataType.toLowerCase()?(b[l.DisplayMember]=h.ToString(s.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss tt"),b[l.DisplayMember+"_Key"]=h):"time"==l.DataType.toLowerCase()?(b[l.DisplayMember]=h.ToString("hh:mm:ss tt"),b[l.DisplayMember+"_Key"]=h):"time2"==l.DataType.toLowerCase()&&(b[l.DisplayMember]=h.ToString("HH:mm"),b[l.DisplayMember+"_Key"]=h.ToString("dd-MMM-yyyy HH:mm"),67==n.ScreenObject.DocumentType&&n.Celleditend(b,l.DisplayMember,0)));else b[l.DisplayMember]=n.ExcelTable[e][0].toString().Trim(),67==n.ScreenObject.DocumentType&&n.Celleditend(b,l.DisplayMember,0)}else o.e.DoubleTryParse(n.ExcelTable[e][c[0].toString()].toString().Trim())>0&&(b[l.DisplayMember]=n.ExcelTable[e][c[0].toString()].toString().Trim()),67==n.ScreenObject.DocumentType&&n.Celleditend(b,l.DisplayMember,0);else if(0==e){var f=n.ScreenObject._TextFields.find((function(e){return e.DBColumnID.toString()==c.FeatureFieldName.toString()}));if(null==f&&(null==(f=n.ScreenObject._CCFields.find((function(e){return e.DBColumnID.toString()==c.FeatureFieldName.toString()})))&&(f=n.ScreenObject._CCFields.find((function(e){return"-"+e.DBColumnID.toString()==c.FeatureFieldName.toString()})))),null==f&&(f=n.ScreenObject._StaticFields.find((function(e){return e.DBColumnID.toString()==c.FeatureFieldName.toString()}))),null!=f)if(f instanceof y.c&&"docdate"==f.DBColumnName.toLowerCase()&&""!=n.ExcelTable[e][0].toString())n.DocumentDate=new Date(n.ExcelTable[e][0].toString());else if(f instanceof C.b){var I=s.a.document.GetCCValues("'"+n.ExcelTable[e][0].toString().Trim().Replace("'","''")+"'",f.CCID,0);null!=I&&I.length>0&&I.Columns.Contains("ID")&&n.ScreenObject.fillcontrolValue(f,I[0].ID.toString())}else if(f instanceof p.a){var T=s.a.document.GetCCValues("'"+n.ExcelTable[e][0].toString().Trim().Replace("'","''")+"'",f.CCID,0);null!=T&&T.length>0&&T.Columns.Contains("ID")&&n.ScreenObject.fillcontrolValue(f,T[0].ID.toString(),!1,T)}else f instanceof y.c&&n.ScreenObject.fillcontrolValue(f,n.ExcelTable[e][0].toString())}else if("-500"==c[1].toString()&&null!=b&&"5"==b.Type.toString()&&""!=n.ExcelTable[e][0].toString()){var P,A;A=n.ScreenObject.LocationID>0?n.ScreenObject.LocationID:s.a.SessionManager.LocationID,P=n.ScreenObject.DivisionID>0?n.ScreenObject.DivisionID:s.a.SessionManager.DivisionID;var M,v=new Pe.a(n.ScreenObject.GridDataObj);v.BatchNumberViewModel_4(n,n.VoucherType,parseFloat(b.Quantity.toString()),null,parseInt(b.ProductID_Key.toString()),b.ProductName.toString(),A,P,""),-1==n.VoucherType?(M=v.GridData.filter((function(t){return t.BATCHNUMBER==n.ExcelTable[e][c[0].toString()].toString()}))).length>0&&(M[0].Quantity=""!=M[0].BalQty.toString()&&parseFloat(M[0].BalQty.toString())>parseFloat(b.Quantity.toString())?b.Quantity.toString():M[0].BalQty):(M=v.dsBatch.Tables[0].filter((function(t){return t.BATCHNUMBER==n.ExcelTable[e][c[0].toString()].toString()}))).length>0&&(v.GridData[0].BatchID=M[0].BatchID.toString(),v.OnBatchSelected(v.GridData[0],parseInt(M[0].BatchID.toString())),v.GridData[0].Quantity=b.Quantity.toString()),M.length>0&&v.OnSave("AutoSave")}},c=0;c<n.DtImport.length-1;c++)t(c);if(null!=b&&(n.IsInventoryVoucher?n.CalculateTotals(b,!1,"Quantity"):n.CalculateTotals(b,!1),I)){if(""!=b.ProductID_Key.toString()&&parseInt(b.ProductID_Key.toString())>0){var l=n.ScreenObject.GetSchemes(n.DocumentDate,b);l.Tables.length>0&&l.Columns[0].Contains("SchemeID")&&n.fillSchemevalues(n.DtTempSchemes,l.Tables[0],b)}n.ApplySchemes(b)}},A=1;A<this.ExcelTable.length;A++)P(A);if(63==this.ScreenObject.DocumentType)for(var M=0,v=0;v<this.ScreenObject.GridData.length-1;v++)if(v>=1&&(M=v-1),null!=this.ScreenObject.GridData[v].dcCCNID51_Key&&null!=this.ScreenObject.GridData[v].dcCCNID52_Key&&null!=this.ScreenObject.GridData[v].dcCCNID51_Key&&null!=this.ScreenObject.GridData[v].dcCCNID52_Key&&null!=this.ScreenObject.GridData[v].dcAlpha4_Key&&null!=this.ScreenObject.GridData[v].dcAlpha5_Key&&null!=this.ScreenObject.GridData[M].dcAlpha4_Key&&null!=this.ScreenObject.GridData[M].dcAlpha5_Key){if(v!=M&&parseInt(this.ScreenObject.GridData[v].dcCCNID51_Key)==parseInt(this.ScreenObject.GridData[M].dcCCNID51_Key)&&parseInt(this.ScreenObject.GridData[v].dcCCNID52_Key)==parseInt(this.ScreenObject.GridData[M].dcCCNID52_Key)&&null!=this.ScreenObject.GridData[v].dcAlpha4_Key&&null!=this.ScreenObject.GridData[M].dcAlpha4_Key&&null!=this.ScreenObject.GridData[M].dcAlpha5_Key&&(new Date(this.ScreenObject.GridData[M].dcAlpha4_Key)>=new Date(this.ScreenObject.GridData[v].dcAlpha4_Key)&&new Date(this.ScreenObject.GridData[M].dcAlpha4_Key)<=new Date(this.ScreenObject.GridData[v].dcAlpha5_Key)||new Date(this.ScreenObject.GridData[v].dcAlpha4_Key)>=new Date(this.ScreenObject.GridData[M].dcAlpha4_Key)&&new Date(this.ScreenObject.GridData[v].dcAlpha4_Key)<=new Date(this.ScreenObject.GridData[M].dcAlpha5_Key))){this.DisplayMessage="FromDate already exist",this.ScreenObject.GridData[M].dcAlpha7=0;break}if(v!=M&&parseInt(this.ScreenObject.GridData[v].dcCCNID51_Key)==parseInt(this.ScreenObject.GridData[M].dcCCNID51_Key)&&parseInt(this.ScreenObject.GridData[v].dcCCNID52_Key)==parseInt(this.ScreenObject.GridData[M].dcCCNID52_Key)&&null!=this.ScreenObject.GridData[v].dcAlpha5_Key&&null!=this.ScreenObject.GridData[M].dcAlpha5_Key&&null!=this.ScreenObject.GridData[M].dcAlpha4_Key){if(v!=M&&new Date(this.ScreenObject.GridData[M].dcAlpha5_Key)>=new Date(this.ScreenObject.GridData[v].dcAlpha4_Key)&&new Date(this.ScreenObject.GridData[M].dcAlpha5_Key)<=new Date(this.ScreenObject.GridData[v].dcAlpha5_Key)||new Date(this.ScreenObject.GridData[v].dcAlpha5_Key)>=new Date(this.ScreenObject.GridData[M].dcAlpha4_Key)&&new Date(this.ScreenObject.GridData[v].dcAlpha5_Key)<=new Date(this.ScreenObject.GridData[M].dcAlpha5_Key)){this.DisplayMessage="ToDate already exist",this.ScreenObject.GridData[M].dcAlpha7=0;break}parseInt(this.ScreenObject.GridData[M].dcCCNID51_Key)==parseInt(this.ScreenObject.GridData[v].dcCCNID51_Key)&&parseInt(this.ScreenObject.GridData[M].dcCCNID52_Key)==parseInt(this.ScreenObject.GridData[v].dcCCNID52_Key)&&parseFloat(this.ScreenObject.GridData[M].dcAlpha3)==parseFloat(this.ScreenObject.GridData[v].dcAlpha3)?parseFloat(this.ScreenObject.GridData[M].dcAlpha3)>=parseFloat(this.ScreenObject.GridData[v].dcAlpha3)?this.ScreenObject.GridData[v].dcAlpha3=parseFloat(this.ScreenObject.GridData[M].dcAlpha3)-parseFloat(this.ScreenObject.GridData[v].dcNum1):parseFloat(this.ScreenObject.GridData[M].dcAlpha3)<parseFloat(this.ScreenObject.GridData[v].dcAlpha3)&&(this.ScreenObject.GridData[v].dcAlpha3=parseFloat(this.ScreenObject.GridData[v].dcNum1)-parseFloat(this.ScreenObject.GridData[M].dcAlpha3)):parseInt(this.ScreenObject.GridData[M].dcCCNID51_Key)==parseInt(this.ScreenObject.GridData[v].dcCCNID51_Key)&&parseInt(this.ScreenObject.GridData[M].dcCCNID52_Key)==parseInt(this.ScreenObject.GridData[v].dcCCNID52_Key)&&parseFloat(this.ScreenObject.GridData[M].dcAlpha3)<parseFloat(this.ScreenObject.GridData[v].dcAlpha3)&&(this.ScreenObject.GridData[v].dcAlpha3=parseFloat(this.ScreenObject.GridData[v].dcAlpha3)-parseFloat(this.ScreenObject.GridData[M].dcNum1))}}this.DisplayMessage="",this.ScreenObject.UpdateSequence(),this.ListVisbility=this.FailedRecourdList.length>0;try{this.UpdateExcelSheet()}catch(G){}}},{key:"UpdateExcelSheet",value:function(){}},{key:"GetLeaveEncashAmount",value:function(e,t){var n,a,i=0,r=null,c=new dt.b;if(null!=this.dsData||this.DimensionSelectedvalueData(),(r=this.dsData).Tables[1].length>0){c.sEmpSeqNo=r.Tables[0][0].NodeID.toString();var l={PayrollMonth:c.PayrollMonth,PayrollMonthStart:c.PayrollMonthStart,PayrollMonthEnd:c.PayrollMonthEnd};o.e.SetPayrollDate(this.ScreenObject.DocDate.Date,l),c.PayrollMonth=l.PayrollMonth,c.PayrollMonthStart=l.PayrollMonthStart,c.PayrollMonthEnd=l.PayrollMonthEnd,c.arrLstCPFields[6].Clear(),c.Intialize(),c.othMPField.BasicMonthly=parseFloat(r.Tables[2][0].BasicMonthly),c.ExecuteAllFormulas();var u=new dt.a;(n=r.Tables[1].filter((function(e){return e.ComponentID==t}))).length>0&&(u.ComponentName="EncashFormula",u.Formula=n[0].EncashFormula.toString(),c.arrLstCPFields[6].push(u)),a=new I.c("EncashDays",""),c.fldDict.push("EncashDays",a),c.fldDict.EncashDays.setFieldValue(e);var d=c.fldDict;o.e.IsEmpty(c.arrLstCPFields[6][0].Formula)||(i=parseFloat(s.a.eval.EvaluateExpression(c.arrLstCPFields[6][0].Formula.toString(),d)))}return i}},{key:"FillEarnDeductDetails",value:function(e,t){Logger.InfoLog("AddEditDocumentViewModel::Entering FillEarningsandDeductions");try{var n,a=[],i=this.ScreenObject._TextFields.find((function(e){return"dcAlpha1"==e.DBColumnName.toString()}));if(0==e){if(i)n=new Date(parseInt(new Date(s.a.SessionManager.FinancialYearStartDate).ToString("yyyy")),s.a.SessionManager.AccountingFromMonth-1,1),i.Date=new Date(n),i.CustomFormat="yyyy",this.SetMonthNames(n.getFullYear())}else this.SetMonthNames(t);var r=this.ScreenObject.GetPayrollComponents(2,1,0,i?new Date(i.Date):this.ScreenObject.DocDate.Date);if(r.Tables.length>0){r.Tables[0].sort((function(e,t){return e.ParentID-t.ParentID}));var c=this.ScreenObject.ColumnSource.find((function(e){return"dcAlpha2"==e.ValueBinding}));if(c&&r.Tables[0].length>0){for(var l=0;l<=r.Tables[0].length-1;l++)a.push(m.d.ComboBoxItems_2(r.Tables[0][l].NAME.toString(),r.Tables[0][l].NODEID.toString()));c.DisplayMember="Name",c.ValueMember="Value",c.ComboData=a}}var u=null,d=0;if(r.Tables.length>0&&r.Tables[0].length>0){u=null,this.ScreenObject.GridDataObj.Clear();for(var D=this.ScreenObject.Data.Tables[0].filter((function(e){return"ProductID"==e.SysColumnName})),h=0;h<r.Tables[0].length;h++)u=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridData.InsertAt(u,d),d++,D.length>0&&!o.e.IsEmpty(D[0].UserDefaultValue)&&(u.ProductID_Key=D[0].UserDefaultValue),u.dcAlpha2=r.Tables[0][h].NODEID,u.dcAlpha15=2==parseInt(r.Tables[0][h].ParentID)?"Earnings":"Deductions";r.Tables[0].length>0&&this.ScreenObject.GridDataObj.refreshDataView()}}catch(S){this.DisplayMessage="Load Error",Logger.ErrorLog("AddEditDocumentViewModel:: FillEarningsandDeductions"+S.stack)}}},{key:"SetMonthNames",value:function(e){var t=this;Logger.InfoLog("AddEditDocumentViewModel::Entering SetMonthNames");try{!function(){var n,a,i,r=0,o=0,c=0,l=0;n=(c=e).toString(),c=parseInt(n.substr(2,2)),l=c+1,a=s.a.SessionManager.AccountingFromMonth,i=a;for(var u=t.ScreenObject.ColumnSource.find((function(e){return"dcalpha3"==e.DisplayMember.toLowerCase()})),d=function(e){if(12==r){o=r+2-e;for(var n=function(n){(u=t.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember.toLowerCase()=="dcalpha"+(n+2).toString()})))&&(u.Header=t.ScreenObject.GetMonthName(n,!1)+"-"+l.toString(),u.DisplayMember="dcAlpha"+(n+2).toString()),e+=1},s=1;s<=o;s++)n(s)}else(u=t.ScreenObject.ColumnSource.find((function(t){return t.DisplayMember.toLowerCase()=="dcalpha"+(e+i).toString()})))&&(r=a+(e-2),u.Header=t.ScreenObject.GetMonthName(r,!1)+"-"+c.toString(),u.DisplayMember="dcAlpha"+(e+i).toString());D=e},D=2;D<14;D++)d(D);t.ScreenObject.GridDataObj.RefreshColumns()}()}catch(n){this.DisplayMessage="Load Month Names Error",Logger.ErrorLog("AddEditDocumentViewModel:: SetMonthNames"+n.stack)}}},{key:"PostSalaryDocResetColumns",value:function(){for(var e=this,t=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha1"==e.DisplayMember.toLowerCase()})),n=function(n){(t=e.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember.toLowerCase()=="dcalpha"+(n+2).toString()})))&&(t.IsVisible=!0)},a=1;a<13;a++)n(a);this.ScreenObject.GridDataObj.RefreshColumns()}},{key:"SetNoofMonths",value:function(e){var t=this;Logger.InfoLog("AddEditDocumentViewModel::Entering SetNoofMonths");try{if(parseInt(e.Tables[0][0].NoOfMonths)>0){var n=0;n=parseInt(e.Tables[0][0].NoOfMonths);var a=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha1"==e.DisplayMember.toLowerCase()}));if(1==s.a.SessionManager.AccountingFromMonth)for(var i=function(e){(a=t.ScreenObject.ColumnSource.find((function(t){return t.DisplayMember.toLowerCase()=="dcalpha"+(e+2).toString()})))&&(a.IsVisible=!1)},r=n+=1;r<13;r++)i(r);else{n+=2,this.ScreenObject.ColumnSource.forEach((function(e){for(var t=1;t<13;t++)null!=e.DisplayMember&&""!=e.DisplayMember&&e.DisplayMember.toLowerCase()=="dcalpha"+(t+2).toString()&&(e.IsVisible=!1)}));for(var o=function(e){(a=t.ScreenObject.ColumnSource.find((function(t){return t.DisplayMember.toLowerCase()=="dcalpha"+(s.a.SessionManager.AccountingFromMonth+e).toString()})))&&(a.IsVisible=!0)},c=2;c<n;c++)o(c)}this.ScreenObject.GridDataObj.RefreshColumns()}}catch(l){this.DisplayMessage="Load NoofMonths Error",Logger.ErrorLog("AddEditDocumentViewModel:: SetNoofMonths"+l.stack)}}},{key:"HideButtons",value:function(e){"BarcodePrint"==e?this.ButtonBarcode.Enable=s.a.SessionManager.LicenseSettings.ContainsKey("Barcode")&&"FALSE"==s.a.SessionManager.LicenseSettings.Barcode.toUpperCase()?this.ButtonBarcode.Visible=!1:s.a.SessionManager.HideUnathorizedAccess?this.ButtonBarcode.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"BarcodePrint"):s.a.SessionManager.IsActionAssigned(this.CostCenterID,"BarcodePrint"):"Save&Barcode"==e&&(this.ButtonSaveandBarcode.Enable=s.a.SessionManager.LicenseSettings.ContainsKey("Barcode")&&"FALSE"==s.a.SessionManager.LicenseSettings.Barcode.toUpperCase()?this.ButtonSaveandBarcode.Visible=!1:s.a.SessionManager.HideUnathorizedAccess?this.ButtonSaveandBarcode.Visible=s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save&Barcode"):s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save&Barcode"))}},{key:"PrintVoucher",value:function(e,t,n,a){var i=this,r=(arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5&&void 0!==arguments[5]?arguments[5]:null),l=(arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]&&arguments[7],arguments.length>8&&void 0!==arguments[8]?arguments[8]:null),u=this;u.DisplayMessage="";var d=u.CostCenterID;u.IsInventoryVoucher;if(!o.e.IsEmpty(a)){var D=new o.f;D.LoadXml(a),null!=D.DocumentElement.attributes.CostCenterID&&(d=parseInt(D.DocumentElement.attributes.CostCenterID.value)),null!=D.DocumentElement.attributes.IsInventoryVoucher&&"1"==D.DocumentElement.attributes.IsInventoryVoucher.value}if(!o.e.IsEmpty(t)&&"0"!=t){if(n){if(376==u.StatusID)return"Documents is cancelled";if(371==u.StatusID&&u.DoNotPrintUnApprovedDocuments&&!e)return"Un-Approved Documents not allowed to print";if(u.LineWiseApproval){var h=!1,S=!1,m=!1;if(u.GRIDTABLE.forEach((function(e){if(null!=e.DocDetailsID&&parseInt(e.DocDetailsID)>0)switch(e.StatusID.toString()){case"371":h=!0;break;case"372":S=!0;break;case"441":m=!0}})),h&&u.DoNotPrintUnApprovedDocuments&&!e&&!s.a.SessionManager.IsActionAssigned(u.CostCenterID,"Print/Export Un-Approved"))return"Un-Approved documents not allowed to print";if(m&&!e&&!s.a.SessionManager.IsActionAssigned(u.CostCenterID,"Print/Export Approved"))return"Approved documents not allowed to print";if(S&&!e&&!s.a.SessionManager.IsActionAssigned(u.CostCenterID,"Print/Export Rejected"))return"Rejected documents not allowed to print"}else{if(371==u.StatusID&&!e&&!s.a.SessionManager.IsActionAssigned(u.CostCenterID,"Print/Export Un-Approved"))return"Un-Approved documents not allowed to print";if(441==u.StatusID&&!e&&!s.a.SessionManager.IsActionAssigned(u.CostCenterID,"Print/Export Approved"))return"Approved documents not allowed to print";if(372==u.StatusID&&!e&&!s.a.SessionManager.IsActionAssigned(u.CostCenterID,"Print/Export Rejected"))return"Rejected documents not allowed to print"}}var b=0,C=new c.a;t.Contains(",")||(b=o.e.Int(t));var y=null,p=Ke.VoucherExportExcel.GetLocationPrintLayouts(d,0,b);if(this.IsExportPrint)y=r;else{if(0!=u.CashDrwerPrintID)for(var g=p.Tables[0].length-1;g>=0;g--)parseInt(p.Tables[0][g].DocPrintLayoutID)!=u.CashDrwerPrintID&&p.Tables[0].RemoveAt(g);if(null==p||0==p.Tables[0].length)return s.a.GetResource("Err_PrintLayoutNotDefined");var f=!1;if(1==p.Tables[0].length&&p.Columns[0].Contains("Copies")&&null!=p.Tables[0][0].Copies&&0==u.CashDrwerPrintID&&parseInt(p.Tables[0][0].Copies)>0&&(f=!0),this.iLayCnt=p.Tables[0].length,this.ScreenObject.Preferences.ContainsKey("AskForVoucherPrintFormat")&&"TRUE"!=this.ScreenObject.Preferences.AskForVoucherPrintFormat.toUpperCase())y=p.Tables[0][0];else if(p.Tables[0].length>1||f){this.bDSExists=!1,this.sDSCUserName="",this.oDSImg=null;var O=new Qe.VPTDialogViewModel(p.Tables[0]),I=b>0?b:this.DocID;s.a.page.ShowDialog(O,He.VPTDialogComponent,{ShowCenter:!0},(function(){if(O.IsOkClicked&&(i.sDSCUserName=O.sDSCUserName,y=O.SelectedRow),null!=y){var e=O.IsExcelChecked?"EXCEL":"PDF";s.a.report.ExportVPT(d,I,parseInt(y.DocPrintLayoutID),e,i.IsInventoryVoucher,C,a).subscribe((function(e){l&&(l.DisplayMessage=""),console.log(e),s.a.SessionManager.printTab(e.FileName),o.e.IsEmpty(e.Message)&&!o.e.IsEmpty(e.FileName)&&(i.DisplayMessage="Printed Sucessfully")}),(function(e){l&&(l.DisplayMessage="Error in Preview"),console.log(e)}))}}))}else y=p.Tables[0][0]}this.dsTotLayouts=p,this.drSelPrintLayout=y,null!=y&&s.a.report.ExportVPT(this.CostCenterID,t,parseInt(y.DocPrintLayoutID),"PDF",this.IsInventoryVoucher,C,a).subscribe((function(e){l&&(l.DisplayMessage=""),console.log(e),s.a.SessionManager.Download(e.FileName,"abcd"),s.a.SessionManager.printTab(e.FileName),o.e.IsEmpty(e.Message)&&!o.e.IsEmpty(e.FileName)&&(i.DisplayMessage="printed Successfully")}),(function(e){l&&(l.DisplayMessage="Error in Preview"),console.log(e)}))}return""}},{key:"GenerateAPIRequest",value:function(e){try{s.a.document.GetDocumentMapFieldsDetail(this.CostCenterID,e)}catch(t){Logger.ErrorLog("GenerateAPIRequest::EXCEPTION GenerateAPIRequest()"+t.StackTrace+" "+t.Message)}}},{key:"APICallRequest",value:function(e,t,n,a){}},{key:"GetEInv",value:function(e){}},{key:"SaveShiftAssign",value:function(){for(var e=this,t=0;t<this.ScreenObject.GridData.length;t++)if(!o.e.IsEmpty(this.ScreenObject.GridData[t].ProductID_Key))for(var n=0;n<this.ScreenObject.ColumnSource.length;n++)if(this.ScreenObject.ColumnSource[n].Mandatory&&!this.MandaotryValidation(t,n))return!1;var a=0;this.LineWiseApproval||(a=this.GetWorkFlow(!1,null));var i=0,r=[];r.push(this.ScreenObject.CostCenterID),r.push(this.ScreenObject.DocID),r.push(this.ScreenObject.DocPrefix.ComboBox.Text),r.push(this.ScreenObject.DocPrefix.TextBox.Text),r.push(this.ScreenObject.DocDate.Date),r.push(this.ScreenObject.DocDate.Date),r.push(""),r.push(this.GetShiftAssignDocumentXML()),r.push(""),r.push(""),r.push(""),r.push(""),r.push("false"),s.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==s.a.SessionManager.Preferences.EnableLocationWise.toString()?r.push(s.a.SessionManager.LocationID>0?s.a.SessionManager.LocationID:1):r.push(0),s.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==s.a.SessionManager.Preferences.EnableDivisionWise.toString()?r.push(s.a.SessionManager.DivisionID>0?s.a.SessionManager.DivisionID:1):r.push(0),r.push(a),r.push(s.a.SessionManager.RoleID),r.push(""),r.push(0),r.push(0),r.push(s.a.SessionManager.CompanyGUID),r.push(s.a.SessionManager.UserName),r.push(s.a.SessionManager.UserID),r.push(s.a.SessionManager.LanguageID),r.push(s.a.SessionManager.IsOffline);var c="";return s.a.document.SetTempInvDocument(r).subscribe((function(t){i=t.obj;var n=t;if(c=null!=n&&n.Tables.length>0&&n.Tables[n.Tables.length-1].length>0&&n.Columns[n.Tables.length-1].Contains("ErrorMessage")?n.Tables[n.Tables.length-1][0].ErrorMessage.toString():"Problem in processing your request,Please contact administrator.",i>0){null!=n&&n.Tables.length>0&&n.Tables[n.Tables.length-1].length>0&&n.Columns[n.Tables.length-1].Contains("VoucherNo")&&(e.ScreenObject.VoucherNo=n.Tables[n.Tables.length-1][0].VoucherNo.toString());var a={value:e._Ddate};e.ScreenObject.OnDocPrefixChanged(e.ScreenObject.Prefix,0,0,a,!1),e._Ddate=a.value,e.clear(2),e.commandprarameter=""}else null!=n&&n.Tables.length>0&&n.Tables[n.Tables.length-1].length>0&&n.Columns[n.Tables.length-1].Contains("ServerMessage")&&(i="-407"==n.Tables[n.Tables.length-1][0].ServerMessage.toString()?-407:-12345);e.DisplayMessage=c,e.MessageVisibility=!0})),!1}},{key:"GetShiftAssignDocumentXML",value:function(){var e="";s.a.SessionManager.Preferences.ContainsKey("ShiftAssignBasedOn")&&(e=s.a.SessionManager.Preferences.ShiftAssignBasedOn);var t,n="",a="",i="",r="",c="",l="";null!=s.a.SessionManager.dtDocDefAccs&&(null!=(t=s.a.SessionManager.dtDocDefAccs.filter((function(e){return 40092==e.CostCenterID&&"CreditAccount"==e.SysColumnName})))&&t.length>0&&!o.e.IsEmpty(t[0].UserDefaultValue)&&""!=t[0].UserDefaultValue.toString().Trim()&&(c=t[0].UserDefaultValue.toString()),null!=(t=s.a.SessionManager.dtDocDefAccs.filter((function(e){return 40092==e.CostCenterID&&"DebitAccount"==e.SysColumnName})))&&t.length>0&&!o.e.IsEmpty(t[0].UserDefaultValue)&&""!=t[0].UserDefaultValue.toString().Trim()&&(l=t[0].UserDefaultValue.toString())),a+='" ProductID="'+this.ScreenObject.GridData[0].ProductID_Key.toString()+'" Quantity="0" Unit="1" UOMConversion="1" UOMConvertedQty="0" Rate="0" Gross="0" IsQtyIgnored="1" AverageRate="0" StockValue="0" StockValueFC="0" RefNO="" BillDate="'+this.ScreenObject.DocDate.Date.ToString("dd/MMM/yyyy")+'" CurrencyID="1" ExchangeRate="1" DebitAccount="'+l+'" CreditAccount="'+c;var u=this.ScreenObject.HeaderFields.find((function(e){return"CommonNarration"==e.DBColumnName}));u&&(a+='" CommonNarration="'+o.e.EncodeXML(this.ScreenObject.GetcontrolValue(u)));var d="DayWise",D=this.ScreenObject._TextFields.find((function(e){return"dcalpha4"==e.DBColumnName.toLowerCase()}));D&&(d=D.SelectedValue);for(var h=0;h<this.ScreenObject.GridData.length;h++)if("DayWise"==d)for(var S=!0,m="",b=this.iDtColFrom;b<=this.iDtColUpto;b++){S=!0;var p=e.split(",");if(null!=p&&p.length>0)for(var g=0;g<p.length;g++)null!=p[g]&&null!=p[g]&&""!=p[g]&&(m="-2"==p[g]?"dcCCNID51_Key":"dcCCNID"+(parseInt(p[g])-5e4)+"_Key",o.e.IsEmpty(this.ScreenObject.GridData[h][m])&&(S=!1));if(this.ScreenObject.GridDataColumns[b].endsWith("_Key")&&S){n+="\x11",n+="<Row>",n+="<AccountsXML></AccountsXML>",n+='<Transactions DocSeqNo="'+(h+1)+'" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="'+this.ScreenObject.GridData[h].LineNarration.toString(),n+=(r="").length>0?'" DocDetailsID="'+r:'" DocDetailsID="',n+=a.toString()+'" ></Transactions>',n+='<Numeric Query="',n+='" ></Numeric>',i="",n+='<Alpha Query="',n+=" dcAlpha3='"+new Date(this.ScreenObject.GridDataColumns[b].Replace("_Key","")).ToString("dd/MMM/yyyy")+"',";var f="";if(this.ScreenObject.CustomTab.Pages.length>0)for(var O=0;O<this.ScreenObject.CustomTab.Pages.length;O++)for(var I=0;I<this.ScreenObject.CustomTab.Pages[O].Fields.length;I++)this.ScreenObject.CustomTab.Pages[O].Fields[I]instanceof y.c&&this.ScreenObject.CustomTab.Pages[O].Fields[I].DBColumnName.startsWith("dcAlpha")&&"DCALPHA3"!=this.ScreenObject.CustomTab.Pages[O].Fields[I].DBColumnName.toUpperCase()&&(f=this.ScreenObject.GetcontrolValue(this.ScreenObject.CustomTab.Pages[O].Fields[I]),i+=" "+this.ScreenObject.CustomTab.Pages[O].Fields[I].DBColumnName+"='"+o.e.EncodeXML(f)+"',");for(var T=0;T<this.ScreenObject.ColumnSource.length;T++)this.ScreenObject.ColumnSource[T].DisplayMember.startsWith("dcAlpha")&&"DCALPHA3"!=this.ScreenObject.ColumnSource[T].DisplayMember.toUpperCase()&&("DCALPHA5"==this.ScreenObject.ColumnSource[T].DisplayMember.toUpperCase()||"DCALPHA6"==this.ScreenObject.ColumnSource[T].DisplayMember.toUpperCase()?i+=" "+this.ScreenObject.ColumnSource[T].DisplayMember+"='"+new Date(this.ScreenObject.GridDataColumns[b].Replace("_Key","")).ToString("dd/MMM/yyyy")+"',":null!=this.ScreenObject.GridData[h][this.ScreenObject.ColumnSource[T].DisplayMember]&&null!=this.ScreenObject.GridData[h][this.ScreenObject.ColumnSource[T].DisplayMember]&&(i+=" "+this.ScreenObject.ColumnSource[T].DisplayMember+"='"+o.e.EncodeXML(this.ScreenObject.GridData[h][this.ScreenObject.ColumnSource[T].DisplayMember].toString())+"',"));if(n+=i,n+='" ></Alpha>',i="",n+='<CostCenters Query="',n+=" dcCCNID51="+this.ScreenObject.GridData[h].dcCCNID51_Key.toString()+",",n+=" dcCCNID73="+this.ScreenObject.GridData[h][b].toString()+",",this.ScreenObject.CustomTab.Pages.length>0)for(var j=0;j<this.ScreenObject.CustomTab.Pages.length;j++)for(var P=0;P<this.ScreenObject.CustomTab.Pages[j].Fields.length;P++)this.ScreenObject.CustomTab.Pages[j].Fields[P].DBColumnName.startsWith("dcCCNID")&&(i+=" "+this.ScreenObject.CustomTab.Pages[j].Fields[P].DBColumnName+"="+this.ScreenObject.CustomTab.Pages[j].Fields[P].SelectedValue+",");for(var A=0;A<this.ScreenObject.ColumnSource.length;A++)!this.ScreenObject.ColumnSource[A].DisplayMember.startsWith("dcCCNID")||this.ScreenObject.ColumnSource[A].DisplayMember.startsWith("dcCCNID51")||this.ScreenObject.ColumnSource[A].DisplayMember.startsWith("dcCCNID73")||o.e.IsEmpty(this.ScreenObject.GridData[h][this.ScreenObject.ColumnSource[A].DisplayMember+"_Key"])||(i+=" "+this.ScreenObject.ColumnSource[A].DisplayMember+"='"+this.ScreenObject.GridData[h][this.ScreenObject.ColumnSource[A].DisplayMember+"_Key"].toString()+"',");n+=i,n+='" ></CostCenters>',n+="<EXTRAXML></EXTRAXML>",n+="</Row>"}}else{var M=!0,v="",G=e.split(",");if(null!=G&&G.length>0)for(var N=0;N<G.length;N++)null!=G[N]&&null!=G[N]&&""!=G[N]&&(v="-2"==G[N]?"dcCCNID51_Key":"dcCCNID"+(parseInt(G[N])-5e4)+"_Key",o.e.IsEmpty(this.ScreenObject.GridData[h][v])&&(M=!1));if(M){n+="\x11",n+="<Row>",n+="<AccountsXML></AccountsXML>",n+='<Transactions DocSeqNo="'+(h+1)+'" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="'+o.e.String(this.ScreenObject.GridData[h].LineNarration),n+=(r="").length>0?'" DocDetailsID="'+r:'" DocDetailsID="',n+=a.toString()+'" ></Transactions>',n+='<Numeric Query="',n+='" ></Numeric>',i="",n+='<Alpha Query="';var E="";if(this.ScreenObject.CustomTab.Pages.length>0)for(var w=0;w<this.ScreenObject.CustomTab.Pages.length;w++)for(var F=0;F<this.ScreenObject.CustomTab.Pages[w].Fields.length;F++)this.ScreenObject.CustomTab.Pages[w].Fields[F]instanceof y.c&&this.ScreenObject.CustomTab.Pages[w].Fields[F].DBColumnName.startsWith("dcAlpha")&&"DCALPHA1"!=this.ScreenObject.CustomTab.Pages[w].Fields[F].DBColumnName.toUpperCase()&&"DCALPHA2"!=this.ScreenObject.CustomTab.Pages[w].Fields[F].DBColumnName.toUpperCase()&&"DCALPHA3"!=this.ScreenObject.CustomTab.Pages[w].Fields[F].DBColumnName.toUpperCase()&&(E=this.ScreenObject.GetcontrolValue(this.ScreenObject.CustomTab.Pages[w].Fields[F]),i+=" "+this.ScreenObject.CustomTab.Pages[w].Fields[F].DBColumnName+"='"+o.e.EncodeXML(E)+"',");for(var V=0;V<this.ScreenObject.ColumnSource.length;V++)this.ScreenObject.ColumnSource[V].DisplayMember.startsWith("dcAlpha")&&"DCALPHA1"!=this.ScreenObject.ColumnSource[V].DisplayMember.toUpperCase()&&"DCALPHA2"!=this.ScreenObject.ColumnSource[V].DisplayMember.toUpperCase()&&"DCALPHA3"!=this.ScreenObject.ColumnSource[V].DisplayMember.toUpperCase()&&null!=this.ScreenObject.GridData[h][this.ScreenObject.ColumnSource[V].DisplayMember]&&null!=this.ScreenObject.GridData[h][this.ScreenObject.ColumnSource[V].DisplayMember]&&(i+="DATE"==this.ScreenObject.ColumnSource[V].DataType?" "+this.ScreenObject.ColumnSource[V].DisplayMember+"='"+new Date(this.ScreenObject.GridData[h][this.ScreenObject.ColumnSource[V].DisplayMember+"_Key"].toString()).ToString("dd/MMM/yyyy")+"',":" "+this.ScreenObject.ColumnSource[V].DisplayMember+"='"+o.e.EncodeXML(this.ScreenObject.GridData[h][this.ScreenObject.ColumnSource[V].DisplayMember].toString())+"',");if(n+=i,n+='" ></Alpha>',i="",n+='<CostCenters Query="',n+=" dcCCNID51="+this.ScreenObject.GridData[h].dcCCNID51_Key.toString()+",",n+=" dcCCNID73="+this.ScreenObject.GridData[h].dcCCNID73_Key.toString()+",",this.ScreenObject.CustomTab.Pages.length>0)for(var L=0;L<this.ScreenObject.CustomTab.Pages.length;L++)for(var R=0;R<this.ScreenObject.CustomTab.Pages[L].Fields.length;R++)this.ScreenObject.CustomTab.Pages[L].Fields[R]instanceof C.b&&this.ScreenObject.CustomTab.Pages[L].Fields[R].DBColumnName.startsWith("dcCCNID")&&"DCCCNID51"!=this.ScreenObject.CustomTab.Pages[L].Fields[R].DBColumnName.toUpperCase()&&"DCCCNID73"!=this.ScreenObject.CustomTab.Pages[L].Fields[R].DBColumnName.toUpperCase()&&(i+=" "+this.ScreenObject.CustomTab.Pages[L].Fields[R].DBColumnName+"="+this.ScreenObject.CustomTab.Pages[L].Fields[R].SelectedValue+",");for(var B=0;B<this.ScreenObject.ColumnSource.length;B++)!this.ScreenObject.ColumnSource[B].DisplayMember.startsWith("dcCCNID")||this.ScreenObject.ColumnSource[B].DisplayMember.startsWith("dcCCNID51")||this.ScreenObject.ColumnSource[B].DisplayMember.startsWith("dcCCNID73")||o.e.IsEmpty(this.ScreenObject.GridData[h][this.ScreenObject.ColumnSource[B].DisplayMember+"_Key"])||(i+=" "+this.ScreenObject.ColumnSource[B].DisplayMember+"='"+this.ScreenObject.GridData[h][this.ScreenObject.ColumnSource[B].DisplayMember+"_Key"].toString()+"',");n+=i,n+='" ></CostCenters>',n+="<EXTRAXML></EXTRAXML>",n+="</Row>"}}return n.toString()}},{key:"LoadEditShiftAssign",value:function(e){var t=this,n="";s.a.SessionManager.Preferences.ContainsKey("ShiftAssignBasedOn")&&(n=s.a.SessionManager.Preferences.ShiftAssignBasedOn);var a=n.split(","),i="",r="DayWise",c=this.ScreenObject._TextFields.find((function(e){return"dcalpha4"==e.DBColumnName.toLowerCase()}));if(c instanceof m.e&&(r=c.SelectedValue),c.IsReadOnly=!0,"DayWise"==r)!function(){t.FillDates_Click();for(var n,r=e.Tables[3].ToTable(!0,["dcAlpha3"]),c=0,l=null,u=0,d=0;d<e.Tables[1].length;d+=r.length,u++){if(t.ScreenObject.GridData.length-1<=u&&t.ScreenObject.GridDataObj.addEmptyRow(),null!=a&&null!=a&&a.length>0){for(var D=0;D<a.length;D++)null!=a[D]&&""!=a[D]&&(i="-2"==a[D]?"dcCCNID51_Key":"dcCCNID"+(parseInt(a[D])-5e4)+"_Key",t.ScreenObject.GridData[u][i]=e.Tables[1][d][i.Replace("_Key","")]);t.FillDefaultProd(t.ScreenObject.GridData[u],i.Replace("_Key","")),t.Celleditend(t.ScreenObject.GridData[u],i.Replace("_Key",""),t.ScreenObject.GridDataColumns.indexOf(i.Replace("_Key","")))}for(var h=0;h<r.length;h++)c=parseInt(e.Tables[1][d+h].InvDocDetailsID),n=r[h].dcAlpha3.toString().Replace("/","-"),t.GetDgvColumnIndex(n),null!=(l=e.Tables[3].filter((function(e){return e.InvDocDetailsID==c})))&&l.length>0&&new Date(n)==new Date(l[0].dcAlpha3)&&(null!=(l=e.Tables[1].filter((function(e){return e.InvDocDetailsID==c})))&&l.length>0&&(t.ScreenObject.GridData[u][n+"_Key"]=l[0].dcCCNID73,t.ScreenObject.GridDataObj.updateRow(t.ScreenObject.GridData[u])));for(var S=0;S<t.ScreenObject.ColumnSource.length;S++)t.ScreenObject.ColumnSource[S].DisplayMember.startsWith("dcAlpha")?"dcalpha5"!=t.ScreenObject.ColumnSource[S].DisplayMember.toLowerCase()&&"dcalpha6"!=t.ScreenObject.ColumnSource[S].DisplayMember.toLowerCase()&&("DATE"==t.ScreenObject.ColumnSource[S].DataType.toUpperCase()?o.e.IsEmpty(e.Tables[3][d][t.ScreenObject.ColumnSource[S].DisplayMember])||(t.ScreenObject.GridData[u][t.ScreenObject.ColumnSource[S].DisplayMember]=new Date(e.Tables[3][d][t.ScreenObject.ColumnSource[S].DisplayMember]).ToString(s.a.SessionManager.Preferences["Date Format"]),t.ScreenObject.GridData[u][t.ScreenObject.ColumnSource[S].DisplayMember+"_key"]=new Date(e.Tables[3][d][t.ScreenObject.ColumnSource[S].DisplayMember])):t.ScreenObject.GridData[u][t.ScreenObject.ColumnSource[S].DisplayMember]=e.Tables[3][d][t.ScreenObject.ColumnSource[S].DisplayMember]):!t.ScreenObject.ColumnSource[S].DisplayMember.startsWith("dcCCNID")||t.ScreenObject.ColumnSource[S].DisplayMember.startsWith("dcCCNID51")||t.ScreenObject.ColumnSource[S].DisplayMember.startsWith("dcCCNID73")?"LINENARRATION"==t.ScreenObject.ColumnSource[S].DisplayMember.toUpperCase()&&e.Columns[0].Contains(t.ScreenObject.ColumnSource[S].DisplayMember)&&(t.ScreenObject.GridData[u][t.ScreenObject.ColumnSource[S].DisplayMember]=e.Tables[0][d][t.ScreenObject.ColumnSource[S].DisplayMember]):t.ScreenObject.GridData[u][t.ScreenObject.ColumnSource[S].DisplayMember+"_Key"]=e.Tables[1][d][t.ScreenObject.ColumnSource[S].DisplayMember]}}();else{this.ConsolidateLeaveMonth();for(var l=0;l<e.Tables[1].length;l++){if(this.ScreenObject.GridData.length-1<=l&&this.ScreenObject.GridDataObj.addEmptyRow(),null!=a&&null!=a&&a.length>0)for(var u=0;u<a.length;u++)null!=a[u]&&""!=a[u]&&(i="-2"==a[u]?"dcCCNID51_Key":"dcCCNID"+(parseInt(a[u])-5e4)+"_Key",this.ScreenObject.GridData[l][i]=e.Tables[1][l][i.Replace("_Key","")]);for(var d=0;d<this.ScreenObject.ColumnSource.length;d++)if(this.ScreenObject.ColumnSource[d].DisplayMember.startsWith("dcAlpha"))"DATE"==this.ScreenObject.ColumnSource[d].DataType.toUpperCase()?o.e.IsEmpty(e.Tables[3][l][this.ScreenObject.ColumnSource[d].DisplayMember])||(this.ScreenObject.GridData[l][this.ScreenObject.ColumnSource[d].DisplayMember]=new Date(e.Tables[3][l][this.ScreenObject.ColumnSource[d].DisplayMember]).ToString(s.a.SessionManager.Preferences["Date Format"]),this.ScreenObject.GridData[l][this.ScreenObject.ColumnSource[d].DisplayMember+"_key"]=new Date(e.Tables[3][l][this.ScreenObject.ColumnSource[d].DisplayMember])):this.ScreenObject.GridData[l][this.ScreenObject.ColumnSource[d].DisplayMember]=e.Tables[3][l][this.ScreenObject.ColumnSource[d].DisplayMember];else if(this.ScreenObject.ColumnSource[d].DisplayMember.startsWith("dcCCNID")&&!this.ScreenObject.ColumnSource[d].DisplayMember.startsWith("dcCCNID51"))this.ScreenObject.GridData[l][this.ScreenObject.ColumnSource[d].DisplayMember+"_Key"]=e.Tables[1][l][this.ScreenObject.ColumnSource[d].DisplayMember];else if("LINENARRATION"==this.ScreenObject.ColumnSource[d].DisplayMember.toUpperCase())e.Columns[0].Contains(this.ScreenObject.ColumnSource[d].DisplayMember)&&(this.ScreenObject.GridData[l][this.ScreenObject.ColumnSource[d].DisplayMember]=e.Tables[0][l][this.ScreenObject.ColumnSource[d].DisplayMember]);else if("PRODUCTCODE"==this.ScreenObject.ColumnSource[d].DisplayMember.toUpperCase()){this.ScreenObject.GridData[l].ProductID_key=this.ScreenObject.ColumnSource[d].DefaultValue;var D=this.ScreenObject.ColumnSource[d].DefaultValueText.split("\x11");this.ScreenObject.GridDataColumns.Contains("ProductCode")&&D.length>1&&(this.ScreenObject.GridData[l].ProductCode=D[1]),this.ScreenObject.GridDataColumns.Contains("ProductName")&&D.length>0&&(this.ScreenObject.GridData[l].ProductName=D[0])}}}this.ScreenObject.UpdateSequence(),this.RefreshGrid=!0}},{key:"GetDgvColumnIndex",value:function(e){var t;for(t=0;t<this.ScreenObject.ColumnSource.length;t++)if(this.ScreenObject.ColumnSource[t].DisplayMember.toLowerCase()==e.toLowerCase())return t;return t}},{key:"LoadShiftAssignRotationData",value:function(){if(null!=this.dtShiftAssRot&&this.dtShiftAssRot.length>0){var e=this.ScreenObject._TextFields.find((function(e){return"dcalpha4"==e.DBColumnName.toLowerCase()}));null!=e&&(e.SelectedValue="PeriodWise",e.IsReadOnly=!0);var t="";s.a.SessionManager.Preferences.ContainsKey("ShiftAssignBasedOn")&&(t=s.a.SessionManager.Preferences.ShiftAssignBasedOn);var n=t.split(","),a="";if(null!=n&&null!=n&&n.length>0)for(var i=0;i<n.length;i++)null!=n[i]&&""!=n[i]&&(a="-2"==n[i]?"dcCCNID51_Key":"dcCCNID"+(parseInt(n[i])-5e4)+"_Key");var r=null;if(this.ScreenObject.GridDataColumns.Contains(a)){this.ScreenObject.GridData.Clear();for(var c=this.ScreenObject.Data.Tables[0].filter((function(e){return"ProductID"==e.SysColumnName})),l=0;l<this.dtShiftAssRot.length;l++)r=this.ScreenObject.GridDataObj.NewRow(),c.length>0&&""!=o.e.String(c[0].UserDefaultValue)&&(r.ProductID_Key=c[0].UserDefaultValue),r[a]=this.dtShiftAssRot[l].Employee_Key,r[a.Replace("_Key","")]=this.dtShiftAssRot[l].Employee,r.dcAlpha5_Key=new Date(this.dtShiftAssRot[l].From),r.dcAlpha5=new Date(this.dtShiftAssRot[l].From).ToString(s.a.SessionManager.Preferences["Date Format"]),r.dcAlpha6_Key=new Date(this.dtShiftAssRot[l].To),r.dcAlpha6=new Date(this.dtShiftAssRot[l].To).ToString(s.a.SessionManager.Preferences["Date Format"]),r.dcCCNID73_Key=this.dtShiftAssRot[l].Shift_Key,r.dcCCNID73=this.dtShiftAssRot[l].Shift,this.ScreenObject.GridDataObj.addRow(r);this.RefreshGrid=!this.RefreshGrid}}}},{key:"CalculateTotalTimeAvailed",value:function(e,t,n){t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),t.getHours(),t.getMinutes(),t.getSeconds()),n=new Date(e.getFullYear(),e.getMonth(),e.getDate(),n.getHours(),n.getMinutes(),n.getSeconds());var a=t.Subtract(n);return a.Hours<0&&(a=a.add(ot.TimeSpan.FromDays(1))),a.Hours.PrefixZero(2)+"."+a.Minutes.PrefixZero(2)}},{key:"CalculateTotalTime",value:function(e,t,n,a){if(t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),t.getHours(),t.getMinutes(),t.getSeconds()),(a=new Date(n.getFullYear(),n.getMonth(),n.getDate(),a.getHours(),a.getMinutes(),a.getSeconds()))<t)return"00.00";var i=a.Subtract(t);return i.Hours<0&&(i=i.add(ot.TimeSpan.FromDays(1))),(24*i.Days+i.Hours).PrefixZero(2)+"."+i.Minutes.PrefixZero(2)}},{key:"ApplyVacationFrom",value:function(e){var t=this;if(this.dsVacationdays=null,e.Date&&e.SelectedDateChanged.IsSubscribed){var n,a=0,i=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));if((null!=i&&null!=i&&i instanceof C.b&&i.SelectedValue>0||null!=i&&i instanceof p.a&&i.SelectedValue>0)&&(a=i.SelectedValue),a>0&&(this.dsData=this.ScreenObject.GetVacationDetails(a,new Date(this.ScreenObject.DocDate.Date),new Date(e.Date)),this.dsData.Tables.length>0)){if(this.ScreenObject._TextFields.forEach((function(e){e.DBColumnName.startsWith("dcalpha")&&parseInt(e.DBColumnName.Replace("dcalpha",""))<=50&&(e instanceof h.d&&e.DBColumnName.toLowerCase().Contains("dcalpha")&&(e.Text=""),e instanceof h.d&&"dcalpha14"==e.DBColumnName.toLowerCase()&&(e.IsReadOnly=!0))})),this.DisplayMessage=this.ApplyVacationValidationMsg(this.dsData),""!=this.DisplayMessage.toString())return void(this.MessageVisibility=!0);if(this.dsData.Tables[3].length>0){var r=[];this.ScreenObject.GridDataObj.Clear();var c=this.ScreenObject.ColumnSource.find((function(e){return"dcAlpha21"==e.ValueBinding}));if(null!=c&&null!=c){for(var u=0;u<=this.dsData.Tables[3].length-1;u++)r.push(m.d.ComboBoxItems_2(this.dsData.Tables[3][u].NAME.toString(),this.dsData.Tables[3][u].NODEID.toString()));c.DisplayMember="Name",c.ValueMember="Value",c.ComboData=r}}var d;if(this.dsData.Tables[4].length>0)!function(){var e=[],n=null,a=null,i=0;if(null!=(d=t.ScreenObject.ColumnSource.find((function(e){return"dcAlpha20"==e.ValueBinding})))&&null!=d){for(var r=0;r<=t.dsData.Tables[4].length-1;r++)e.push(m.d.ComboBoxItems_2(t.dsData.Tables[4][r].NAME.toString(),t.dsData.Tables[4][r].NODEID.toString()));d.DisplayMember="Name",d.ValueMember="Value",d.ComboData=e}n=null;for(var s=t.ScreenObject.Data.Tables[0].filter((function(e){return"ProductID"==e.SysColumnName})),c=0;c<t.dsData.Tables[4].length;c++)n=t.ScreenObject.GridDataObj.NewRow(),s.length>0&&""!=o.e.String(s[0].UserDefaultValue)&&(n.ProductID_Key=s[0].UserDefaultValue),n.dcAlpha20=t.dsData.Tables[4][c].NODEID,a=t.dsData.Tables[4].filter((function(e){return e.NODEID==parseInt(n.dcAlpha20)})),n.dcAlpha21=a[0].PARENTID,t.ScreenObject.GridDataObj.insertRowAt(n,i),i++}();if(this.dsData.Tables[5].length>0){var D=(new Date).OnlyDate(),b=this.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()}));null!=b&&null!=b&&b instanceof S.c&&!o.e.IsEmpty(b.Date)&&(D=b.Date);var y=s.a.common.GetDataTable("PAY083",a.toString()+"~"+D.ToString("dd/MMM/yyyy")),g=null,f=0;null!=y&&y.length>0&&new Date(y[0].REJOINDATE)<=new Date(y[0].TODATE)&&(null!=(g=this.ScreenObject.GetVacationDays(new Date(y[0].FROMDATE),new Date(y[0].REJOINDATE).AddDays(-1),a,parseInt(y[0].DOCID),parseFloat(y[0].OpeningBalance),0))&&g.Tables.length>0&&(f=parseFloat(g.Tables[1][0].REMAININGDAYS))),null!=(n=this.ScreenObject._TextFields.find((function(e){return"dcalpha22"==e.DBColumnName.toLowerCase()})))&&n instanceof h.d&&(n.Text=parseFloat(this.dsData.Tables[5][0].OPVACATIONDAYS)<0&&s.a.SessionManager.Preferences.ContainsKey("DonotshownegitiveOPvacationdays")&&Object(l.j)("True"==s.a.SessionManager.Preferences.DonotshownegitiveOPvacationdays)?(0).ToTime("00.00"):f>0?f.ToString("0.00"):parseFloat(this.dsData.Tables[5][0].OPVACATIONDAYS).ToTime("00.00")),null!=(n=this.ScreenObject._TextFields.find((function(e){return"dcalpha5"==e.DBColumnName.toLowerCase()})))&&n instanceof h.d&&(n.Text=parseFloat(this.dsData.Tables[5][0].OPVACATIONSALARY).ToTime("00.00")),null!=(n=this.ScreenObject._TextFields.find((function(e){return"dcalpha4"==e.DBColumnName.toLowerCase()})))&&n instanceof h.d&&(n.IsReadOnly=!0)}}(n=this.ScreenObject._TextFields.find((function(e){return"dcalpha3"==e.DBColumnName.toLowerCase()})))instanceof S.c&&n.Date&&this.ApplyVacation(n)}}},{key:"ApplyVacation",value:function(e){if(this.dsVacationdays=null,e.Date&&e.SelectedDateChanged.IsSubscribed){var t=new Date,n=new Date,a=0,i=0,r=0,l=0,u=this.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()}));if(u instanceof S.c&&u.Date&&(t=u.Date),((u=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})))instanceof C.b&&u.SelectedValue>0||u instanceof p.a&&u.SelectedValue>0)&&(a=u.SelectedValue),0==a)return;if((u=this.ScreenObject._TextFields.find((function(e){return"dcalpha3"==e.DBColumnName.toLowerCase()})))instanceof S.c&&u.Date&&(n=u.Date,a>0&&this.FillEarningsDeductions(a,new Date(n))),new Date(t)>new Date(n))return this.DisplayMessage="Todate should be greater than Fromdate",void(this.MessageVisibility=!0);(u=this.ScreenObject._TextFields.find((function(e){return"dcalpha22"==e.DBColumnName.toLowerCase()})))instanceof h.d&&!o.e.IsEmpty(u.Text)&&(i=parseFloat(u.Text)),(u=this.ScreenObject._TextFields.find((function(e){return"dcalpha5"==e.DBColumnName.toLowerCase()})))instanceof h.d&&!o.e.IsEmpty(u.Text)&&(l=parseFloat(u.Text));var d=0;this.dsVacationdays=this.ScreenObject.GetVacationDays(t,n,a,this.DocID,i,0);var D,m=s.a.common.GetDataTable("PAY074",a.toString()),b="";if(null!=m&&m.length>0&&(b=m[0].ConsiderVacationdayforExcessVacationDays+""),b.length>0&&"No"==b&&null!=this.dsVacationdays&&this.dsVacationdays.Tables.length>0&&this.dsVacationdays.Tables[1].length>0&&this.dsVacationdays.Columns[1].Contains("ExcessDays")&&parseFloat(this.dsVacationdays.Tables[1][0].ExcessDays)>0){for(var y,g=n.AddDays(-1),f=parseFloat(this.dsVacationdays.Tables[1][0].VacationDays),O=0;t<=g;){if(null!=(y=this.ScreenObject.GetVacationDays(t,g,a,this.DocID,i,0))&&y.Tables.length>0&&y.Tables[1].length>0&&0==parseFloat(y.Tables[1][0].ExcessDays)){O=parseFloat(y.Tables[1][0].VacationDays);break}g=g.AddDays(-1)}d=f-O}if(this.dsVacationdays=this.ScreenObject.GetVacationDays(t,n,a,this.DocID,i,d),this.dsVacationdays.Tables.length>0){if(this.dsVacationdays.Tables[0].length>0&&!o.e.IsEmpty(this.dsVacationdays.Tables[0][0].ProbationPeriodMessage))return this.DisplayMessage=this.dsVacationdays.Tables[0][0].ProbationPeriodMessage.toString(),void(this.MessageVisibility=!0);if(!(this.dsVacationdays.Tables[1].length>0&&o.e.IsEmpty(this.dsVacationdays.Tables[1][0].VacationDaysMessage)))return this.dsVacationdays.Tables[1].length>0&&(this.DisplayMessage=this.dsVacationdays.Tables[1][0].VacationDaysMessage.toString()),void(this.MessageVisibility=!0);(u=this.ScreenObject._TextFields.find((function(e){return"dcalpha4"==e.DBColumnName.toLowerCase()})))instanceof h.d&&(u.Text=parseFloat(this.dsVacationdays.Tables[1][0].VacationDays).ToTime("00.00")),(u=this.ScreenObject._TextFields.find((function(e){return"dcalpha8"==e.DBColumnName.toLowerCase()})))instanceof h.d&&(u.Text=parseFloat(this.dsVacationdays.Tables[1][0].AppliedDays).ToTime("00.00")),(u=this.ScreenObject._TextFields.find((function(e){return"dcalpha9"==e.DBColumnName.toLowerCase()})))instanceof h.d&&(u.Text=parseFloat(this.dsVacationdays.Tables[1][0].ApprovedDays).ToTime("00.00")),(u=this.ScreenObject._TextFields.find((function(e){return"dcalpha10"==e.DBColumnName.toLowerCase()})))instanceof h.d&&(parseFloat(this.dsVacationdays.Tables[1][0].PaidDays)<0?(u.Text="0.00",r=0):(u.Text=parseFloat(this.dsVacationdays.Tables[1][0].PaidDays).ToTime("0.00"),r=parseFloat(this.dsVacationdays.Tables[1][0].PaidDays))),(u=this.ScreenObject._TextFields.find((function(e){return"dcalpha7"==e.DBColumnName.toLowerCase()})))instanceof h.d&&(u.Text=parseFloat(this.dsVacationdays.Tables[1][0].CreditedDays).ToTime("00.00")),(u=this.ScreenObject._TextFields.find((function(e){return"dcalpha11"==e.DBColumnName.toLowerCase()})))instanceof h.d&&(u.Text=parseFloat(this.dsVacationdays.Tables[1][0].ExcessDays).ToTime("00.00")),(u=this.ScreenObject._TextFields.find((function(e){return"dcalpha12"==e.DBColumnName.toLowerCase()})))instanceof h.d&&(u.Text=parseFloat(this.dsVacationdays.Tables[1][0].RemainingDays).ToTime("00.00")),null!=(u=this.ScreenObject._TextFields.find((function(e){return"dcalpha26"==e.DBColumnName.toLowerCase()})))&&u instanceof h.d&&(u.Text=parseFloat(this.dsVacationdays.Tables[1][0].FSEncashDays).ToTime("00.00"))}if(this.LEDict=new c.a,this.oVac=new dt.b,this.oVac.iDocID=this.ScreenObject.DocID,this.oVac.GetVacationAmountDetails(this.dsVacationdays),this.oVac.arrLstVacAmountFields.length>0){var T=null,j=0;T=null;var P=0,A=0,M=0;this.ScreenObject.GridDataObj.Clear();for(var v=this.ScreenObject.Data.Tables[0].filter((function(e){return"ProductID"==e.SysColumnName})),G=0;G<this.oVac.arrLstVacAmountFields.length;G++)T=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridDataObj.insertRowAt(T,j),j++,v.length>0&&!o.e.IsEmpty(v[0].UserDefaultValue)&&(T.ProductID_Key=v[0].UserDefaultValue),T.dcAlpha20=this.oVac.arrLstVacAmountFields[G].ComponentID,T.dcAlpha21=this.oVac.arrLstVacAmountFields[G].TypeId,2==parseFloat(this.oVac.arrLstVacAmountFields[G].TypeId)?parseFloat(this.oVac.arrLstVacAmountFields[G].Percentage)>0?(D=new I.c(this.oVac.arrLstVacAmountFields[G].ComponentName,""),this.LEDict.push(this.oVac.arrLstVacAmountFields[G].ComponentName,D),this.LEDict[this.oVac.arrLstVacAmountFields[G].ComponentName].setFieldValue(this.oVac.arrLstVacAmountFields[G].PercActualAmount),T.dcNum1=r*parseFloat(s.a.eval.EvaluateExpression(this.oVac.arrLstVacAmountFields[G].Formula,this.LEDict))):T.dcNum1=parseFloat(this.oVac.arrLstVacAmountFields[G].Percentage)<0?parseFloat(this.oVac.arrLstVacAmountFields[G].ActualAmount):0:T.dcNum1=parseFloat(this.oVac.arrLstVacAmountFields[G].ActualAmount),T.dcAlpha23=parseFloat(this.oVac.arrLstVacAmountFields[G].Percentage),null!=T.dcAlpha21&&(2==parseFloat(T.dcAlpha21)?(null==T.dcNum1||isNaN(T.dcNum1)||(A+=parseFloat(T.dcNum1)),null==T.dcNum2||isNaN(T.dcNum2)||(A+=parseFloat(T.dcNum2)),null==T.dcNum3||isNaN(T.dcNum3)||(A+=parseFloat(T.dcNum3))):2!=parseFloat(T.dcAlpha21)&&null!=T.dcNum1&&(M+=parseFloat(T.dcNum1))),this.CalculateTotals(T,!1);P=A+l-M,(u=this.ScreenObject._TextFields.find((function(e){return"dcalpha6"==e.DBColumnName.toLowerCase()})))instanceof h.d&&(u.Text=P.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount)),this.GridNetTotal=parseFloat(P.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount)),this.RefreshNetAmount()}if(this.ShowVacationCreditDaysDetail(a,d),!this.isVacContractedit&&s.a.SessionManager.Preferences.ContainsKey("VacationBasedOnContract")&&parseInt(s.a.SessionManager.Preferences.VacationBasedOnContract)>0){var N=s.a.common.GetDataTable("PAY089",a.toString()+"~"+parseInt(s.a.SessionManager.Preferences.VacationBasedOnContract));null!=N&&N.length>0&&this.ApplyVacationContract()}}}},{key:"ApplyVacationIsEncash",value:function(e){this.dsVacationdays=null;var t=new Date,n=new Date,a=0,i=0,r=0,u=0,d=0,D=0,b="",y="",g=this.ScreenObject._TextFields.find((function(e){return"dcalpha16"==e.DBColumnName.toLowerCase()}));if(g instanceof m.e&&!o.e.IsEmpty(g.SelectedValue)){if(null==g.SelectionChangedCommand&&!s.a.SessionManager.IsWebApplication)return;b=g.SelectedValue.toString()}var f=this.ScreenObject._TextFields.find((function(e){return"dcalpha14"==e.DBColumnName.toLowerCase()}));if((g=this.ScreenObject._TextFields.find((function(e){return"dcalpha13"==e.DBColumnName.toLowerCase()})))instanceof m.e&&!o.e.IsEmpty(g.SelectedValue)){if(null==g.SelectionChangedCommand&&o.e.IsEmpty(f.Text)&&"Yes"!=b&&!s.a.SessionManager.IsWebApplication)return;y=g.SelectedValue.toString()}if(((g=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})))instanceof C.b&&g.SelectedValue>0||g instanceof p.a&&g.SelectedValue>0)&&(a=g.SelectedValue),0!=a){if((g=this.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()})))instanceof S.c&&g.Date&&(t=g.Date),(g=this.ScreenObject._TextFields.find((function(e){return"dcalpha3"==e.DBColumnName.toLowerCase()})))instanceof S.c&&g.Date&&(n=g.Date),this.CalculateTotals(null,!1),(g=this.ScreenObject._TextFields.find((function(e){return"dcalpha15"==e.DBColumnName.toLowerCase()})))instanceof m.e&&(g.SelectedValue="No",g.IsReadOnly=!0),(g=this.ScreenObject._TextFields.find((function(e){return"dcalpha22"==e.DBColumnName.toLowerCase()})))instanceof h.d&&!o.e.IsEmpty(g.Text)&&(i=parseFloat(g.Text)),(g=this.ScreenObject._TextFields.find((function(e){return"dcalpha5"==e.DBColumnName.toLowerCase()})))instanceof h.d&&!o.e.IsEmpty(g.Text)&&(D=parseFloat(g.Text)),(g=this.ScreenObject._TextFields.find((function(e){return"dcalpha10"==e.DBColumnName.toLowerCase()})))instanceof h.d&&!o.e.IsEmpty(g.Text)&&(r=parseFloat(g.Text)),(g=this.ScreenObject._TextFields.find((function(e){return"dcalpha7"==e.DBColumnName.toLowerCase()})))instanceof h.d&&!o.e.IsEmpty(g.Text)&&(u=parseFloat(g.Text)),"Yes"==b||"Yes"==y){if("Yes"==b?((g=this.ScreenObject._TextFields.find((function(e){return"dcalpha13"==e.DBColumnName.toLowerCase()})))instanceof m.e&&(g.SelectedValue="Yes",g.IsReadOnly=!0),(g=this.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()})))instanceof S.c&&g.Date&&(t=g.Date,g.IsReadOnly=!0),(g=this.ScreenObject._TextFields.find((function(e){return"dcalpha3"==e.DBColumnName.toLowerCase()})))instanceof S.c&&g.Date&&(g.Date=t,n=g.Date,g.IsReadOnly=!0),(g=this.ScreenObject._TextFields.find((function(e){return"dcalpha4"==e.DBColumnName.toLowerCase()})))instanceof h.d&&(g.Text=(0).toString()),(g=this.ScreenObject._TextFields.find((function(e){return"dcalpha8"==e.DBColumnName.toLowerCase()})))instanceof h.d&&(g.Text=(0).toString()),(g=this.ScreenObject._TextFields.find((function(e){return"dcalpha9"==e.DBColumnName.toLowerCase()})))instanceof h.d&&(g.Text=(0).toString()),(g=this.ScreenObject._TextFields.find((function(e){return"dcalpha10"==e.DBColumnName.toLowerCase()})))instanceof h.d&&(g.Text=(0).toString(),r=parseFloat(g.Text.toString())),(g=this.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()})))instanceof S.c&&0==r&&(g.Date=t.AddDays(1))):"No"==b&&"Yes"==y&&null==e&&!o.e.IsEmpty(f.Text)&&parseFloat(f.Text.toString())>0&&(g=this.ScreenObject._TextFields.find((function(e){return"dcalpha13"==e.DBColumnName.toLowerCase()})))instanceof m.e&&(g.SelectedValue="No",g.IsReadOnly=!1,f.IsReadOnly=!0,f.Text="0",y="No"),"Yes"==y&&null==e&&(f.Text="0",f.IsReadOnly=!1),(g=this.ScreenObject._TextFields.find((function(e){return"dcalpha14"==e.DBColumnName.toLowerCase()})))instanceof h.d){var O=this.ScreenObject._TextFields.find((function(e){return"dcalpha12"==e.DBColumnName.toLowerCase()}));if(null!=e&&"lostfoucs"==e.toString()){if(g instanceof h.d&&!o.e.IsEmpty(g.Text)&&(d=parseFloat(g.Text)),O instanceof h.d&&!o.e.IsEmpty(O.Text)&&(O.Text=(u+i-r-d).toString()),O instanceof h.d){if(parseFloat((u+i-r).toString())<parseFloat(g.Text))return this.DisplayMessage="Encash days should be less than or equal to remaining days",void(this.MessageVisibility=!0);this.DisplayMessage="",this.MessageVisibility=!1,d=parseFloat(g.Text)}}else"No"==b&&null==e?(g.Text="0",d=0,O.Text=(i+u-r).toString()):(g.IsReadOnly=!1,g.Text=(i+u).toString(),d=i+u,O.Text="0")}}else f.IsReadOnly=!0,f.Text="0",(g=this.ScreenObject._TextFields.find((function(e){return"dcalpha22"==e.DBColumnName.toLowerCase()})))instanceof h.d&&!o.e.IsEmpty(g.Text)&&(i=parseFloat(g.Text)),(g=this.ScreenObject._TextFields.find((function(e){return"dcalpha7"==e.DBColumnName.toLowerCase()})))instanceof h.d&&!o.e.IsEmpty(g.Text)&&(u=parseFloat(g.Text)),(g=this.ScreenObject._TextFields.find((function(e){return"dcalpha10"==e.DBColumnName.toLowerCase()})))instanceof h.d&&!o.e.IsEmpty(g.Text)&&(r=parseFloat(g.Text)),(O=this.ScreenObject._TextFields.find((function(e){return"dcalpha12"==e.DBColumnName.toLowerCase()})))instanceof h.d&&!o.e.IsEmpty(O.Text)&&(O.Text=(u+i-r).toString());var T;this.LEDict=new c.a,this.dsVacationdays=this.ScreenObject.GetVacationDays(t,n,a,this.DocID,i,0),this.oVac=new dt.b,this.oVac.iDocID=this.ScreenObject.DocID,this.oVac.GetVacationAmountDetails(this.dsVacationdays);var j=s.a.common.GetDataTable("PAY075",a.toString()+"~"+t.ToString("dd/MMM/yyyy")),P=!1,A="";if(null!=j&&j.length>0&&(A=j[0].EncashFormula.toString()),s.a.SessionManager.Preferences.ContainsKey("CalcVacEncAmtBsdOnCustPayEncFormula")&&(P=Object(l.j)(s.a.SessionManager.Preferences.CalcVacEncAmtBsdOnCustPayEncFormula)),null!=this.oVac&&this.oVac.arrLstVacAmountFields.length>0){var M=null,v=0;M=null;var G=0,N=0,E=0,w=0;this.ScreenObject.GridDataObj.Clear();for(var F=this.ScreenObject.Data.Tables[0].filter((function(e){return"ProductID"==e.SysColumnName})),V=0;V<this.oVac.arrLstVacAmountFields.length;V++){if(M=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridDataObj.insertRowAt(M,v),v++,F.length>0&&!o.e.IsEmpty(F[0].UserDefaultValue)&&(M.ProductID_Key=F[0].UserDefaultValue),M.dcAlpha20=this.oVac.arrLstVacAmountFields[V].ComponentID,M.dcAlpha21=this.oVac.arrLstVacAmountFields[V].TypeId,2==parseFloat(this.oVac.arrLstVacAmountFields[V].TypeId))if(parseFloat(this.oVac.arrLstVacAmountFields[V].Percentage)>0){T=new I.c(this.oVac.arrLstVacAmountFields[V].ComponentName.toString(),""),this.LEDict.push(this.oVac.arrLstVacAmountFields[V].ComponentName.toString(),T),this.LEDict[this.oVac.arrLstVacAmountFields[V].ComponentName.toString()].setFieldValue(this.oVac.arrLstVacAmountFields[V].PercActualAmount.toString());var L=this.LEDict;"EMPLOYEE_BASIC"==this.oVac.arrLstVacAmountFields[V].ComponentName.toString()&&"Yes"==b?(M.dcNum1=0,P?(this.ScreenObject.GridData[0].dcNum2=0,(A=A.Replace("EncashDays",d.toString())).length>0&&(this.ScreenObject.GridData[0].dcNum2=this.ReturnFormulaValue(a,t,A)),w=parseFloat(this.ScreenObject.GridData[0].dcNum2)):M.dcNum2=d*parseFloat(s.a.eval.EvaluateExpression(this.oVac.arrLstVacAmountFields[V].Formula.toString(),L))):(P?(this.ScreenObject.GridData[0].dcNum2=0,(A=A.Replace("EncashDays",d.toString())).length>0&&(this.ScreenObject.GridData[0].dcNum2=this.ReturnFormulaValue(a,t,A)),w=parseFloat(this.ScreenObject.GridData[0].dcNum2)):M.dcNum2=d*parseFloat(s.a.eval.EvaluateExpression(this.oVac.arrLstVacAmountFields[V].Formula.toString(),L)),M.dcNum1=r*parseFloat(s.a.eval.EvaluateExpression(this.oVac.arrLstVacAmountFields[V].Formula.toString(),L)))}else parseFloat(this.oVac.arrLstVacAmountFields[V].Percentage)<0&&(M.dcNum2=0,M.dcNum1=parseFloat(this.oVac.arrLstVacAmountFields[V].ActualAmount));M.dcAlpha23=parseFloat(this.oVac.arrLstVacAmountFields[V].Percentage),null!=M.dcAlpha21&&(2==parseFloat(M.dcAlpha21)?(null!=M.dcNum1&&(N+=parseFloat(M.dcNum1)),null!=M.dcNum2&&(N+=parseFloat(M.dcNum2)),null!=M.dcNum3&&(N+=parseFloat(M.dcNum3))):2!=parseFloat(M.dcAlpha21)&&null!=M.dcNum1&&(E+=parseFloat(M.dcNum1))),this.CalculateTotals(M,!1)}G=(N+=w)+D-E,(g=this.ScreenObject._TextFields.find((function(e){return"dcalpha6"==e.DBColumnName.toLowerCase()})))instanceof h.d&&(g.Text=G.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount)),this.GridNetTotal=parseFloat(G.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount)),this.RefreshNetAmount()}}}},{key:"ReturnFormulaValue",value:function(e,t,n){var a=new dt.b;a.sEmpSeqNo=e.toString();var i={PayrollMonth:a.PayrollMonth,PayrollMonthStart:a.PayrollMonthStart,PayrollMonthEnd:a.PayrollMonthEnd};o.e.SetPayrollDate(t.Date(),i),a.PayrollMonth=i.PayrollMonth,a.PayrollMonthStart=i.PayrollMonthStart,a.PayrollMonthEnd=i.PayrollMonthEnd,a.arrLstCPFields[6].Clear();var r=new dt.a;return r.ComponentName="RetFormulaValue",r.SNo=0,r.Formula=n,a.arrLstCPFields[6].push(r),a.Intialize(),a.ExecuteAllFormulas(),a.arrLstCPFields[6][0].dEarned}},{key:"ApplyVacationIsTextEncash",value:function(e){this.ApplyVacationIsEncash("lostfoucs")}},{key:"ApplyVacationExcessdays",value:function(e){var t="",n=this.ScreenObject._TextFields.find((function(e){return"dcalpha15"==e.DBColumnName.toLowerCase()}));if(n instanceof m.e&&!o.e.IsEmpty(n.SelectedValue)){if(null==n.SelectionChangedCommand&&!s.a.SessionManager.IsWebApplication)return;t=n.SelectedValue.toString()}if("Yes"==t){this.CalculateTotals(null,!1);new Date,new Date;var a,i=0,r=0,l=0,u=0;if((n=this.ScreenObject._TextFields.find((function(e){return"dcalpha16"==e.DBColumnName.toLowerCase()})))instanceof m.e&&(n.SelectedValue="No",n.IsReadOnly=!0),(n=this.ScreenObject._TextFields.find((function(e){return"dcalpha14"==e.DBColumnName.toLowerCase()})))instanceof h.d&&(n.Text="",n.IsReadOnly=!0),(n=this.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()})))instanceof S.c&&!o.e.IsEmpty(n.Date)&&n.Date,(n=this.ScreenObject._TextFields.find((function(e){return"dcalpha3"==e.DBColumnName.toLowerCase()})))instanceof S.c&&!o.e.IsEmpty(n.Date)&&n.Date,((n=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})))instanceof C.b&&n.SelectedValue>0||n instanceof p.a&&n.SelectedValue>0)&&(i=n.SelectedValue),0==i)return;if((n=this.ScreenObject._TextFields.find((function(e){return"dcalpha22"==e.DBColumnName.toLowerCase()})))instanceof h.d&&!o.e.IsEmpty(n.Text)&&parseFloat(n.Text),(n=this.ScreenObject._TextFields.find((function(e){return"dcalpha5"==e.DBColumnName.toLowerCase()})))instanceof h.d&&!o.e.IsEmpty(n.Text)&&(u=parseFloat(n.Text)),(n=this.ScreenObject._TextFields.find((function(e){return"dcalpha10"==e.DBColumnName.toLowerCase()})))instanceof h.d&&(r=parseFloat(n.Text)),(n=this.ScreenObject._TextFields.find((function(e){return"dcalpha11"==e.DBColumnName.toLowerCase()})))instanceof h.d&&(l=parseFloat(n.Text)),l<=0)return this.DisplayMessage="No Excess days available",void(this.MessageVisibility=!0);if(this.LEDict=new c.a,this.oVac.arrLstVacAmountFields.length>0){var d=null,D=0;d=null;var b=0,y=0,g=0;this.ScreenObject.GridDataObj.Clear();for(var f=this.ScreenObject.Data.Tables[0].filter((function(e){return"ProductID"==e.SysColumnName})),O=0;O<this.oVac.arrLstVacAmountFields.length;O++){if(d=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridDataObj.insertRowAt(d,D),D++,f.length>0&&!o.e.IsEmpty(f[0].UserDefaultValue)&&(d.ProductID_Key=f[0].UserDefaultValue),d.dcAlpha20=this.oVac.arrLstVacAmountFields[O].ComponentID,d.dcAlpha21=this.oVac.arrLstVacAmountFields[O].TypeId,2==parseFloat(this.oVac.arrLstVacAmountFields[O].TypeId)&&parseFloat(this.oVac.arrLstVacAmountFields[O].Percentage)>0){a=new I.c(this.oVac.arrLstVacAmountFields[O].ComponentName.toString(),""),this.LEDict.push(this.oVac.arrLstVacAmountFields[O].ComponentName.toString(),a),this.LEDict[this.oVac.arrLstVacAmountFields[O].ComponentName.toString()].setFieldValue(this.oVac.arrLstVacAmountFields[O].PercActualAmount.toString());var T=this.LEDict;"EMPLOYEE_BASIC"==this.oVac.arrLstVacAmountFields[O].ComponentName.toString()?(d.dcNum2=0,d.dcNum1=r*parseFloat(s.a.eval.EvaluateExpression(this.oVac.arrLstVacAmountFields[O].Formula.toString(),T)),d.dcNum3=l*parseFloat(s.a.eval.EvaluateExpression(this.oVac.arrLstVacAmountFields[O].Formula.toString(),T)),d.dcAlpha23=-4):(d.dcNum2=0,d.dcNum3=l*parseFloat(s.a.eval.EvaluateExpression(this.oVac.arrLstVacAmountFields[O].Formula.toString(),T)),d.dcNum1=r*parseFloat(s.a.eval.EvaluateExpression(this.oVac.arrLstVacAmountFields[O].Formula.toString(),T)))}else 2==parseFloat(this.oVac.arrLstVacAmountFields[O].TypeId)&&parseFloat(this.oVac.arrLstVacAmountFields[O].Percentage)<0&&(d.dcNum2=0,d.dcNum1=parseFloat(this.oVac.arrLstVacAmountFields[O].ActualAmount));d.dcAlpha23=parseFloat(this.oVac.arrLstVacAmountFields[O].Percentage),null!=d.dcAlpha21&&(2==parseFloat(d.dcAlpha21)?(null!=d.dcNum1&&(y+=parseFloat(d.dcNum1)),null!=d.dcNum2&&(y+=parseFloat(d.dcNum2)),null!=d.dcNum3&&(y+=parseFloat(d.dcNum3))):2!=parseFloat(d.dcAlpha21)&&null!=d.dcNum1&&(g+=parseFloat(d.dcNum1))),this.CalculateTotals(d,!1)}b=y+u-g,(n=this.ScreenObject._TextFields.find((function(e){return"dcalpha6"==e.DBColumnName.toLowerCase()})))instanceof h.d&&(n.Text=b.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount)),this.GridNetTotal=parseFloat(b.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount)),this.RefreshNetAmount()}}}},{key:"ApplyVacationContract",value:function(){var e="1",t=new Date,n=new Date,a=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));null!=a&&(a instanceof C.b||a instanceof p.a)&&(e=a.SelectedValue.toString());var i=this.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()}));if(null!=i&&i instanceof S.c&&!o.e.IsEmpty(i.Date)&&(t=i.Date),null!=(i=this.ScreenObject._TextFields.find((function(e){return"dcalpha3"==e.DBColumnName.toLowerCase()})))&&i instanceof S.c&&!o.e.IsEmpty(i.Date)&&(n=i.Date),null!=(i=this.ScreenObject._TextFields.find((function(e){return"dcalpha22"==e.DBColumnName.toLowerCase()})))&&i instanceof h.d&&!o.e.IsEmpty(i.Text)&&parseFloat(i.Text),null!=(i=this.ScreenObject._TextFields.find((function(e){return"dcalpha5"==e.DBColumnName.toLowerCase()})))&&i instanceof h.d&&!o.e.IsEmpty(i.Text)&&parseFloat(i.Text),parseInt(e)>1&&(this.PrevVacFrom!=t||this.PrevVacTo!=n)){null!=(i=this.ScreenObject._TextFields.find((function(e){return"dcalpha4"==e.DBColumnName.toLowerCase()})))&&i instanceof h.d&&parseFloat(i.Text),this.PrevVacFrom=t,this.PrevVacTo=n}}},{key:"GetAllEmployees",value:function(e,t,n){try{var a,i=null,r="",c="",l=0,u={value:this._Ddate};this.ScreenObject.OnDocPrefixChanged(this.ScreenObject.Prefix,0,0,u,!1),this._Ddate=u.value;var d=this.ScreenObject._TextFields.find((function(e){return"dcalpha14"==e.DBColumnName.toLowerCase()}));if(d instanceof m.e&&!o.e.IsEmpty(d.SelectedValue)&&(r="TreeView"==d.SelectedValue.toString()?"lft":d.SelectedValue.toString()),this.clear(1),this._Ddate=e,this.QuickInfoVisibility=!1,this.DQuickInfoVisibility=!1,this.ScreenObject.DocID=0,this.StatusID=0,this.WorkFlowDocLevel=0,this.ScreenObject.VoucherNo="",this.ScreenObject.guid="",this.DocStatus="["+s.a.GetResource("Doc_Draft")+"]",this.ScreenObject.DocPrefix.TextBox.Text=parseInt(this.ScreenObject.DocPrefix.TextBox.Text).toString(),this.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()})).Date=e,(a=n.toString().toLowerCase().Contains("nodeid")?this.ScreenObject.GetAllEmployeesList(e,t,0,0,n):this.ScreenObject.GetAllEmployeesList(e,t,0,0,"")).Tables.length>0&&a.Tables[0].length>0){var D=a.Tables[0];D.sort((function(e,t){return e[r]-t[r]})),d instanceof m.e&&null!=d.SelectedItem&&(d.SelectedItem.Name=r),i=null,this.ScreenObject.GridDataObj.Clear();var h=this.ScreenObject.Data.Tables[0].filter((function(e){return"ProductID"==e.SysColumnName}));this.dsAllEmployeeData=null;for(var S=0;S<D.length;S++)c.length>0&&(c+=","),c+=D[S].EMPNODE.toString();this.dsAllEmployeeData=s.a.common.GetDataSet("PAY091",c),this.IsGetAllEmployees=!0,null==this.objPayDayCheck&&(this.objPayDayCheck=new st.a(this.ScreenObject));for(var b=0;b<D.length;b++)i=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridDataObj.insertRowAt(i,l),l++,h.length>0&&!o.e.IsEmpty(h[0].UserDefaultValue)&&(i.ProductID_Key=h[0].UserDefaultValue),this.ScreenObject.GridDataColumns.Contains("dcCCNID51Code")&&(i.dcCCNID51Code=D[b].EMPCODE),i.dcCCNID51_Key=D[b].EMPNODE,i.dcCCNID51=D[b].EMPNAME,i.dcAlpha10=1,i.dcAlpha11=1,i.dcAlpha13=1,this.FillDefaultProd(i,"dcCCNID51"),this.Celleditend(i,"dcCCNID51",0),this.ScreenObject.GridDataColumns.Contains("dcAlpha2")&&this.ScreenObject.GridDataColumns.Contains("dcAlpha3")&&this.FillGeneralTimings(D[b].EMPNODE.toString(),new Date(e).ToString("dd/MMM/yyyy"),i),this.ScreenObject.GridDataColumns.Contains("dcAlpha4")&&this.DistributeTotalHours(D[b].EMPNODE.toString(),new Date(e).ToString("dd/MMM/yyyy"),i,""),this.IsDocValid=!1,this.ScreenObject.GridDataObj.updateRow(i),this.CalculateTotals(i,!1);this.IsGetAllEmployees=!1,this.dsAllEmployeeData=null}}catch(C){this.DisplayMessage="Load Error",Logger.ErrorLog("AddEditDocumentViewModel:: GetAllEmployees"+C.stack)}}},{key:"FillDates_Click",value:function(){if(67==this.ScreenObject.DocumentType){var e="1",t=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));if(t&&(t instanceof C.b||t instanceof p.a)&&(e=t.SelectedValue.toString()),parseInt(e)<=1)return this.DisplayMessage="Select any Employee",void(this.MessageVisibility=!0);if(this.ScreenObject.ColumnSource.find((function(e){return"dcalpha1"==e.DisplayMember.toLowerCase()}))){this.ScreenObject.GridDataObj.Clear();for(var n,a=s.a.SessionManager.PayrollMonthStart,i=s.a.SessionManager.PayrollMonthEnd,r=0;a<=i;)this.ScreenObject.GridData.length-1<=r&&((n=this.ScreenObject.GridDataObj.NewRow()).DocSeqNo=this.ScreenObject.GridData.length+1,n.DocDetailsID=0,this.ScreenObject.GridDataObj.addRow(n)),this.ScreenObject.GridData[r].dcAlpha1=a.ToString(s.a.SessionManager.Preferences["Date Format"]),this.ScreenObject.GridData[r].dcAlpha1_Key=a,this.FillDefaultProd(this.ScreenObject.GridData[r],"dcAlpha1"),this.Celleditend(this.ScreenObject.GridData[r],"dcAlpha1",0),a=a.AddDays(1),r+=1}}else if(92==this.ScreenObject.DocumentType){var o,c;if(o=this.ScreenObject.CustomTab.Pages[0].Fields.find((function(e){return e instanceof S.c&&"dcAlpha1"==e.DBColumnName})),c=this.ScreenObject.CustomTab.Pages[0].Fields.find((function(e){return e instanceof S.c&&"dcAlpha2"==e.DBColumnName})),!o.Date||!c.Date)return this.DisplayMessage="Please select dates",void(this.MessageVisibility=!0);if(o.Date>c.Date)return this.DisplayMessage="Please select ToDate greater than FromDate",void(this.MessageVisibility=!0);var l=this.GetButton("Fill Dates");this.ScreenObject.DocID>0?(null!=l&&(l.Visible=!1),o.Enable=c.Enable=!1):(null!=l&&(l.Visible=!0),o.Enable=c.Enable=!0);for(var u=this.ScreenObject.ColumnSource.length-1;u>=0;u--)null!=this.ScreenObject.ColumnSource[u].DrRefColName&&""!=this.ScreenObject.ColumnSource[u].DrRefColName&&"Date"==this.ScreenObject.ColumnSource[u].DrRefColName&&(this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.ColumnSource[u].DisplayMember)&&this.ScreenObject.GridDataColumns.Remove(this.ScreenObject.ColumnSource[u].DisplayMember),this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.ColumnSource[u].DisplayMember+"_Key")&&this.ScreenObject.GridDataColumns.Remove(this.ScreenObject.ColumnSource[u].DisplayMember+"_Key"),this.ScreenObject.ColumnSource.RemoveAt(u));for(var d=-1,D=[],h=0;h<this.ScreenObject.ColumnSource.length;h++)"LineNarration"==this.ScreenObject.ColumnSource[h].DisplayMember&&(d=h,this.ScreenObject.ColumnSource[h].Width=150),null!=this.ScreenObject.ColumnSource[h].DrRefColName&&""!=this.ScreenObject.ColumnSource[h].DrRefColName||"Date"==this.ScreenObject.ColumnSource[h].DrRefColName||D.push(this.ScreenObject.ColumnSource[h]);d<0&&(d=D.length),this.iDgColFrom=d,this.iDtColFrom=this.ScreenObject.GridDataColumns.length;for(var m=o.Date,b=null,y=s.a.common.GetDataTable("PAY001","");m<=c.Date;)(b=new f.a).Header=m.ToString("dd'-'MMM'-'yyyy")+"\n ("+m.DayOfWeek.toString()+")",b.DisplayMember=m.ToString("dd'-'MMM'-'yyyy"),b.ID=y[0].CostCenterColID.toString(),b.DrRefColName="Date",b.DataType="LISTBOX",b.CostCenterID=50073,b.Mandatory=!0,b.TypeID=1,b.Width=90,this.ScreenObject.GridDataColumns.Contains(b.DisplayMember)||this.ScreenObject.GridDataColumns.push(b.DisplayMember),this.ScreenObject.GridDataColumns.Contains(b.DisplayMember+"_Key")||this.ScreenObject.GridDataColumns.push(b.DisplayMember+"_Key"),D.Insert(d,b),m=m.AddDays(1),d++;this.iDgColUpto=d,this.iDtColUpto=this.ScreenObject.GridDataColumns.length-1,this.ScreenObject.ColumnSource=D,this.ScreenObject.GridDataObj.RefreshColumns()}}},{key:"FillGeneralTimings_Click",value:function(){var e="",t="1",n=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));if(n&&(n instanceof C.b||n instanceof p.a)&&(t=n.SelectedValue.toString()),parseInt(t)<=1)this.DisplayMessage="Select any Employee";else if(this.ScreenObject.ColumnSource.find((function(e){return"dcalpha1"==e.DisplayMember.toLowerCase()})))for(var a=0;a<this.ScreenObject.GridData.length;a++)o.e.IsEmpty(this.ScreenObject.GridData[a].dcAlpha1)||o.e.IsEmpty(this.ScreenObject.GridData[a].dcAlpha1_Key)||(e=new Date(this.ScreenObject.GridData[a].dcAlpha1_Key).ToString("dd/MMM/yyyy"),this.ScreenObject.GridDataColumns.Contains("dcAlpha2")&&this.ScreenObject.GridDataColumns.Contains("dcAlpha3")&&this.FillGeneralTimings(t,e,this.ScreenObject.GridData[a]),this.ScreenObject.GridDataColumns.Contains("dcAlpha4")&&this.DistributeTotalHours(t,e,this.ScreenObject.GridData[a],""))}},{key:"GetPreviousDay",value:function(e){try{var t=new Date;this.strValidationMessage="";var n="",a=0,i={value:this._Ddate};if(this.ScreenObject.OnDocPrefixChanged(this.ScreenObject.Prefix,0,0,i,!1),this._Ddate=i.value,this.ScreenObject.Clear(i,1),this._Ddate=i.value,null==this.ScreenObject.DocPrefix.ComboBox.SelectedItem||o.e.IsEmpty(this.ScreenObject.DocPrefix.ComboBox.SelectedItem.Aliasname)||(a=parseInt(this.ScreenObject.DocPrefix.ComboBox.SelectedItem.Aliasname)),parseInt(this.ScreenObject.DocPrefix.TextBox.Text)>1){for(var r=(parseInt(this.ScreenObject.DocPrefix.TextBox.Text)-1).toString();r.length<a;)r="0"+r;if(this.ScreenObject.DocPrefix.TextBox.Text=r,t=e.AddDays(this.intRecCount>0?-(this.intRecCount+1):-1),this.intRecCount=this.intRecCount+1,this.dsData=this.ScreenObject.GetEmployeePayrollInfo(0,4,t,0),!(null!=this.dsData&&this.dsData.Tables[0].length>0))return this.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()})).Date=e,this.DisplayMessage="No Records exist with date '"+t.ToString(s.a.SessionManager.Preferences["Date Format"])+"'",void(this.MessageVisibility=!0);var c={value:this._Ddate};this.ScreenObject.OnDocPrefixChanged("lostFocus",0,parseInt(this.dsData.Tables[0][0][0]),c,!0),this._Ddate=c.value,this._Ddate=Date.Today(),this.QuickInfoVisibility=!1,this.DQuickInfoVisibility=!1,this.ScreenObject.DocID=0,this.StatusID=0,this.WorkFlowDocLevel=0,this.WfID=0,this.WFDocLevelList.Clear(),this.ScreenObject.VoucherNo="",this.ScreenObject.guid="",this.DocStatus="["+s.a.GetResource("Doc_Draft")+"]",this.ScreenObject.DocPrefix.TextBox.Text=(parseInt(r)+1).toString(),this.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()})).Date=e;for(var l=0;l<this.ScreenObject.GridData.length;l++)if(parseInt(this.ScreenObject.GridData[l].DocDetailsID)>0){this.IsDocValid=!1,this.ScreenObject.GridData[l].DocDetailsID=0,this.ScreenObject.GridData[l].dcAlpha2_Key=new Date(e.ToString("dd/MMM/yyyy")+" "+this.ScreenObject.GridData[l].dcAlpha2).ToString("dd/MMM/yyyy HH:mm"),this.ScreenObject.GridData[l].dcAlpha3_Key=new Date(this.ScreenObject.GridData[l].dcAlpha3_Key).ToString("dd/MMM/yyyy")==e.ToString("dd/MMM/yyyy")?new Date(e.AddDays(1).ToString("dd/MMM/yyyy")+" "+this.ScreenObject.GridData[l].dcAlpha3).ToString("dd/MMM/yyyy HH:mm"):new Date(e.ToString("dd/MMM/yyyy")+" "+this.ScreenObject.GridData[l].dcAlpha3).ToString("dd/MMM/yyyy HH:mm");var u=this.ScreenObject.ColumnSource.find((function(e){return"dcCCNID51"==e.DisplayMember}));if(u&&!o.e.IsEmpty(u.Shortcut)&&"lostfocus"==u.Shortcut.toLowerCase()&&this.ValidateData_Column(u,this.ScreenObject.GridData[l],!0)&&this.ScreenObject.GetExternalFuncData(u.Mode,u.SPName,u.IPParams,u.OPParams,this.ScreenObject.GridData[l]),null!=this.ScreenObject.GridData[l].dcAlpha3_Key&&null!=this.ScreenObject.GridData[l].dcAlpha2_Key){var d=new Date(this.ScreenObject.GridData[l].dcAlpha3_Key).Subtract(new Date(this.ScreenObject.GridData[l].dcAlpha2_Key));n=d.Hours+"."+d.Minutes,this.ScreenObject.GridData[l].dcNum1=parseFloat(n)}(u=this.ScreenObject.ColumnSource.find((function(e){return"dcNum1"==e.DisplayMember})))&&!o.e.IsEmpty(u.Shortcut)&&"lostfocus"==u.Shortcut.toLowerCase()&&this.ValidateData_Column(u,this.ScreenObject.GridData[l],!0)&&this.ScreenObject.GetExternalFuncData(u.Mode,u.SPName,u.IPParams,u.OPParams,this.ScreenObject.GridData[l])}}}catch(D){this.DisplayMessage="Load Error",Logger.ErrorLog("AddEditDocumentViewModel:: GetPreviousDay"+D.stack)}}},{key:"CheckEmployeeShift",value:function(e,t,n){var a=this;if(this.ScreenObject.GridDataColumns.Contains("dcCCNID73")){var i="",r="",o="";s.a.SessionManager.Preferences.ContainsKey("ShiftAssignBasedOn")&&(o=s.a.SessionManager.Preferences.ShiftAssignBasedOn);var c=null;if(this.IsGetAllEmployees){if(null!=this.dsAllEmployeeData&&this.dsAllEmployeeData.Tables.length>2)if("-2"==o){i=" dcCCNID51 IN("+e+",1) ",r="dcCCNID51";var l=this.dsAllEmployeeData.Tables[2];null!=(l=(l=(l=l.filter((function(n){return n.FromDate<=new Date(t).ToString("dd/MMM/yyyy")&&n.ToDate>=new Date(t).ToString("dd/MMM/yyyy")&&n.dcCCNID51==e}))).sort((function(e,t){return e.FromDate>t.FromDate||e.FromDate==t.FromDate&&e[r]>t[r]?1:-1}))).sort((function(e,t){return t.DocID-e.DocID})))&&l.length>0&&(c=l)}else!function(){var n=[];n.push(t),n.push(" AND EmpSeqNo="+e),n.push(0),n.push(s.a.SessionManager.RoleID),n.push(s.a.SessionManager.UserID),n.push(s.a.SessionManager.LanguageID);var l=s.a.common.GetDataSet_SP(n,"spPAY_GetEmpMasterCCDetails").Tables[0];null!=l&&l.length>0&&function(){var e="",n=o.split(",");if(null!=n&&n.length>0){for(var s=a.dsAllEmployeeData.Tables[2],u=0;u<n.length;u++)null!=n[u]&&""!=n[u]&&(e="-2"==n[u]?"CCNID51":"CCNID"+(parseInt(n[u])-5e4),r.length>0&&(r+=","),r+="dc"+e,i.length>0&&(i+=" AND "),i+="dc"+e+"="+l[0][e],s=s.filter((function(n){return n.FromDate<=new Date(t).ToString("dd/MMM/yyyy")&&n.ToDate>=new Date(t).ToString("dd/MMM/yyyy")&&n["dc"+e]==l[0][e]})));null!=(s=s.sort((function(e,t){return e.FromDate-t.FromDate})))&&s.length>0&&(c=s)}}()}()}else c=s.a.common.GetDataSet3("PAY005",e,t).Tables[0];null!=c&&c.length>0?(n.dcCCNID73_Key=c[0].dcCCNID73,n.dcCCNID73=c[0].Name):(n.dcCCNID73_Key=1,n.dcCCNID73=""),this.ScreenObject.GridDataObj.updateRow(n),this.RefreshGrid=!this.RefreshGrid,99!=this.ScreenObject.DocumentType&&97!=this.ScreenObject.DocumentType&&this.Celleditend(n,"dcCCNID73",0)}}},{key:"FillGeneralTimings",value:function(e,t,n){if(s.a.SessionManager.Preferences.ContainsKey("GeneralTimingsBasedOn")&&""!=s.a.SessionManager.Preferences.GeneralTimingsBasedOn){var a=s.a.SessionManager.Preferences.GeneralTimingsBasedOn.split(",");if(null!=a&&a.length>0){for(var i="",r="",c=0;c<a.length;c++)null!=a[c]&&""!=a[c]&&(r="dcCCNID"+(parseInt(a[c])-5e4),o.e.IsEmpty(n[r+"_Key"])?i+=" AND "+r+"=1":i+=" AND ( "+r+"="+n[r+"_Key"].toString()+" OR "+r+"=1 )");if(i.length>0){var l=[];l.push(t),l.push(e),l.push(i),l.push(s.a.SessionManager.UserID),l.push(s.a.SessionManager.LanguageID);var u=s.a.common.GetDataSet_SP(l,"spPAY_ExtGetTimings").Tables[0];if(u.length>0){var d=new Date(t),D=new Date(t).AddDays(1),h=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha2"==e.DisplayMember.toLowerCase()}));h&&(n[h.DisplayMember]=new Date(u[0].STARTTIME).ToString("HH:mm"),n[h.DisplayMember+"_Key"]=new Date(d).AddHours(new Date(u[0].STARTTIME).getHours()).AddMinutes(new Date(u[0].STARTTIME).getMinutes()).ToString("dd/MMM/yyyy HH:mm")),(h=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha3"==e.DisplayMember.toLowerCase()})))&&(n[h.DisplayMember]=new Date(u[0].ENDTIME).ToString("HH:mm"),n[h.DisplayMember+"_Key"]=new Date(u[0].ENDTIME)<new Date(u[0].STARTTIME)?new Date(D).AddHours(new Date(u[0].ENDTIME).getHours()).AddMinutes(new Date(u[0].ENDTIME).getMinutes()).ToString("dd/MMM/yyyy HH:mm"):new Date(d).AddHours(new Date(u[0].ENDTIME).getHours()).AddMinutes(new Date(u[0].ENDTIME).getMinutes()).ToString("dd/MMM/yyyy HH:mm")),n.dcAlpha5=u[0].VALIDDAY,this.DistributeTotalHours(e,t,n,""),this.ScreenObject.GridDataObj.updateRow(n)}}}}}},{key:"DistributeTotalHours",value:function(e,t,n,a){try{var i=!1;null==this.dtEData&&(this.dtEData=s.a.common.GetDataTable("PAY002",""));var r=this.dtEData.filter((function(t){return t.NodeID==e}));null!=r&&r.length>0&&(o.e.IsEmpty(r[0].IsAllowOT)||(i="Yes"==r[0].IsAllowOT.toString()));var c=0,l=1,u=0,d=0,D=0,h=0,S=0;if(o.e.IsEmpty(n.dcAlpha3_Key)||o.e.IsEmpty(n.dcAlpha2_Key))n.dcNum1="0.00";else{var m=new Date(n.dcAlpha3_Key).Subtract(new Date(n.dcAlpha2_Key));n.dcNum1=m.Hours>0||m.Minutes>0?1==m.Minutes.toString().length?m.Hours+".0"+m.Minutes:m.Hours+"."+m.Minutes:"0.00"}var b=this.ScreenObject.ColumnSource.find((function(e){return"FLOAT"==e.DataType.toUpperCase()&&"dcnum1"==e.DisplayMember.toLowerCase()}));if(null==b||o.e.IsEmpty(n[b.DisplayMember])||(c=parseFloat(n[b.DisplayMember])),s.a.SessionManager.Preferences.ContainsKey("DonotallowAttendancebasedon")&&""!=s.a.SessionManager.Preferences.DonotallowAttendancebasedon&&s.a.SessionManager.Preferences.ContainsKey("DonotallowAttendancebasedonid")&&""!=s.a.SessionManager.Preferences.DonotallowAttendancebasedonid){var C=this.ScreenObject.ColumnSource.find((function(e){return"LISTBOX"==e.DataType.toUpperCase()&&e.ValueMember.toLowerCase()=="dcccnid"+(parseInt(s.a.SessionManager.Preferences.DonotallowAttendancebasedon)-5e4)+"_key"}));null==C||null==C||o.e.IsEmpty(n[C.ValueMember])||n[C.ValueMember].toString()!=s.a.SessionManager.Preferences.DonotallowAttendancebasedonid||(this.ScreenObject.GridDataColumns.Contains("dcAlpha2")&&(n.dcAlpha2=new Date(t).ToString("HH:mm"),n.dcAlpha2_Key=new Date(t).ToString("dd/MMM/yyyy HH:mm")),this.ScreenObject.GridDataColumns.Contains("dcAlpha3")&&(n.dcAlpha3=new Date(t).ToString("HH:mm"),n.dcAlpha3_Key=new Date(t).ToString("dd/MMM/yyyy HH:mm")),c=0,this.ScreenObject.GridDataColumns.Contains("dcNum1")&&(n.dcNum1="0.00"))}null==this.objPayDayCheck&&(this.objPayDayCheck=new st.a(this.ScreenObject)),this.objPayDayCheck.CheckIsHolidayDate(e,t,n,this.IsGetAllEmployees,this.dsAllEmployeeData);var y=this.GetHoursDefChart(t,n);if(null!=y&&y.length>0){var p,g=null,f=null,O=o.e.GetEmptyDate(),I=o.e.GetEmptyDate(),T=o.e.GetEmptyDate(),j=o.e.GetEmptyDate(),P=o.e.GetEmptyDate(),A=o.e.GetEmptyDate(),M=c.ToTime("00.00").split("."),v=o.e.GetEmptyDate().AddHours(parseFloat(M[0])).AddMinutes(parseFloat(M[1]));u=d=D=h=S=0;var G=this.ScreenObject.ColumnSource.find((function(e){return"dcccnid73"==e.DisplayMember.toLowerCase()}));if(null==G||null==G||o.e.IsEmpty(n.dcCCNID73_Key)||(l=parseInt(n.dcCCNID73_Key),null!=this.dtPayShifts&&this.dtPayShifts.length>0&&(null!=(p=this.dtPayShifts.filter((function(e){return e.NodeID==l})))&&p.length>0&&(u=parseInt(p[0].MinOT1),d=parseInt(p[0].MinOT2),D=parseInt(p[0].MinOT3),h=parseInt(p[0].MinOT4),S=parseInt(p[0].MinOT5)))),"WeeklyOff"==n.PayrollType.toString()||"Holiday"==n.PayrollType.toString())if("WeeklyOff"==n.PayrollType.toString()){if((he=this.ScreenObject.ColumnSource.find((function(e){return"FLOAT"==e.DataType.toUpperCase()&&"dcnum2"==e.DisplayMember.toLowerCase()})))&&this.ScreenObject.GridDataColumns.Contains("dcNum2")&&(o.e.IsEmpty(n.dcNum2)||-1==parseFloat(n.dcNum2)||(n.dcNum2=(0).ToTime("00.00"))),null!=(he=this.ScreenObject.ColumnSource.find((function(e){return"FLOAT"==e.DataType.toUpperCase()&&"dcnum4"==e.DisplayMember.toLowerCase()})))&&null!=he&&this.ScreenObject.GridDataColumns.Contains("dcNum4"))if("dcnum4"!=a.toLowerCase()&&"dcnum5"!=a.toLowerCase()&&"dcnum7"!=a.toLowerCase()&&"dcnum9"!=a.toLowerCase()&&"dcnum11"!=a.toLowerCase()&&"dcnum13"!=a.toLowerCase()||!s.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=s.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)if("dcnum4"==a.toLowerCase()&&s.a.SessionManager.Preferences.ContainsKey("BreakHoursImpactToOTS")&&"True"==s.a.SessionManager.Preferences.BreakHoursImpactToOTS){if(v.getHours()>0||v.getMinutes()>0){var N=parseFloat(n.dcNum4).ToTime("00.00").split(".");O=new Date(1,1,1,0).AddHours(parseFloat(N[0])).AddMinutes(parseFloat(N[1])),n.dcNum4=O.ToString("HH.mm"),v=v.AddHours(-O.getHours()).AddMinutes(-O.getMinutes())}}else n.dcNum4=(0).ToTime("00.00"),(v.getHours()>0||v.getMinutes()>0)&&(v<(O=this.GetMaxAvilableHrs(e,t,y,"dcNum4"))&&(O=v),n.dcNum4=O.ToString("HH.mm"),v=v.AddHours(-O.getHours()).AddMinutes(-O.getMinutes()));else{var E=parseFloat(n.dcNum4).ToTime("00.00").split(".");if(O=new Date(1,1,1,0).AddHours(parseFloat(E[0])).AddMinutes(parseFloat(E[1])),s.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==s.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)P=P.AddHours(O.getHours()).AddMinutes(O.getMinutes());else{var w=parseFloat(n.dcNum1).ToTime("00.00").split(".");A=(I=(new Date).AddHours(parseFloat(w[0])).AddMinutes(parseFloat(w[1]))).AddHours(-O.getHours()).AddMinutes(-O.getMinutes())}}if(i){if(null!=(he=this.ScreenObject.ColumnSource.find((function(e){return"FLOAT"==e.DataType.toUpperCase()&&"dcnum5"==e.DisplayMember.toLowerCase()})))&&null!=he&&this.ScreenObject.GridDataColumns.Contains("dcNum5"))if("dcnum4"!=a.toLowerCase()&&"dcnum5"!=a.toLowerCase()&&"dcnum7"!=a.toLowerCase()&&"dcnum9"!=a.toLowerCase()&&"dcnum11"!=a.toLowerCase()&&"dcnum13"!=a.toLowerCase()||!s.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=s.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)n.dcNum5=(0).ToTime("00.00"),60*v.getHours()+v.getMinutes()>=u&&(v.getHours()>0||v.getMinutes()>0)&&(null!=(g=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName==he.DisplayMember})))&&g.length>0&&(null!=(f=this.dtOTTypes.filter((function(e){return e.CostCenterColID==g[0].LinkData.toString()})))&&f.length>0&&("PayWeeklyOffOT"!=f[0].SysColumnName.toString()&&"PayHolidayOT"!=f[0].SysColumnName.toString()&&"PayEveryDayOT"!=f[0].SysColumnName.toString()||(v<(O=this.GetMaxAvilableHrs(e,t,y,"dcNum5"))&&(O=v),n.dcNum5=O.ToString("HH.mm"),v=v.AddHours(-O.getHours()).AddMinutes(-O.getMinutes())))));else{var F=parseFloat(n.dcNum5).ToTime("00.00").split(".");if(O=new Date(1,1,1,0).AddHours(parseFloat(F[0])).AddMinutes(parseFloat(F[1])),s.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==s.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)P=P.AddHours(O.getHours()).AddMinutes(O.getMinutes());else if(null!=(g=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName=="'"+he.DisplayMember+"'"})))&&g.length>0&&(null!=(f=this.dtOTTypes.filter((function(e){return e.CostCenterColID==g[0].LinkData.toString()})))&&f.length>0&&("PayWeeklyOffOT"==f[0].SysColumnName.toString()||"PayHolidayOT"==f[0].SysColumnName.toString()||"PayEveryDayOT"==f[0].SysColumnName.toString()))){var V=parseFloat(n.dcNum1).ToTime("00.00").split(".");I=(new Date).AddHours(parseFloat(V[0])).AddMinutes(parseFloat(V[1]));var L=parseFloat(n.dcNum5).ToTime("00.00").split(".");j=(new Date).AddHours(parseFloat(L[0])).AddMinutes(parseFloat(L[1])),A<(T=(T=this.GetMaxAvilableHrs(e,t,y,"dcNum5")).AddHours(j.getHours()).AddMinutes(j.getMinutes()))&&(T=A),n.dcNum5=T.ToString("HH.mm"),A=A.AddHours(-T.getHours()).AddMinutes(-T.getMinutes())}}if(null!=(he=this.ScreenObject.ColumnSource.find((function(e){return"FLOAT"==e.DataType.toUpperCase()&&"dcnum7"==e.DisplayMember.toLowerCase()})))&&null!=he&&this.ScreenObject.GridDataColumns.Contains("dcNum7"))if("dcnum4"!=a.toLowerCase()&&"dcnum5"!=a.toLowerCase()&&"dcnum7"!=a.toLowerCase()&&"dcnum9"!=a.toLowerCase()&&"dcnum11"!=a.toLowerCase()&&"dcnum13"!=a.toLowerCase()||!s.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=s.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)n.dcNum7=(0).ToTime("00.00"),60*v.getHours()+v.getMinutes()>=d&&(v.getHours()>0||v.getMinutes()>0)&&(null!=(g=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName==he.DisplayMember})))&&g.length>0&&(null!=(f=this.dtOTTypes.filter((function(e){return e.CostCenterColID==g[0].LinkData.toString()})))&&f.length>0&&("PayWeeklyOffOT"!=f[0].SysColumnName.toString()&&"PayHolidayOT"!=f[0].SysColumnName.toString()&&"PayEveryDayOT"!=f[0].SysColumnName.toString()||(v<(O=this.GetMaxAvilableHrs(e,t,y,"dcNum7"))&&(O=v),n.dcNum7=O.ToString("HH.mm"),v=v.AddHours(-O.getHours()).AddMinutes(-O.getMinutes())))));else{var R=parseFloat(n.dcNum7).ToTime("00.00").split(".");if(O=new Date(1,1,1,0).AddHours(parseFloat(R[0])).AddMinutes(parseFloat(R[1])),s.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==s.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)P=P.AddHours(O.getHours()).AddMinutes(O.getMinutes());else if(null!=(g=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName==he.DisplayMember})))&&g.length>0&&(null!=(f=this.dtOTTypes.filter((function(e){return e.CostCenterColID==o.e.String(g[0].LinkData)})))&&f.length>0&&("PayWeeklyOffOT"==f[0].SysColumnName.toString()||"PayHolidayOT"==f[0].SysColumnName.toString()||"PayEveryDayOT"==f[0].SysColumnName.toString()))){var B=parseFloat(n.dcNum1).ToTime("00.00").split(".");I=(new Date).AddHours(parseFloat(B[0])).AddMinutes(parseFloat(B[1]));var x=parseFloat(n.dcNum7).ToTime("00.00").split(".");j=(new Date).AddHours(parseFloat(x[0])).AddMinutes(parseFloat(x[1])),A<(T=(T=this.GetMaxAvilableHrs(e,t,y,"dcNum7")).AddHours(j.getHours()).AddMinutes(j.getMinutes()))&&(T=A),n.dcNum7=T.ToString("HH.mm"),A=A.AddHours(-T.getHours()).AddMinutes(-T.getMinutes())}}if(null!=(he=this.ScreenObject.ColumnSource.find((function(e){return"FLOAT"==e.DataType.toUpperCase()&&"dcnum9"==e.DisplayMember.toLowerCase()})))&&null!=he&&this.ScreenObject.GridDataColumns.Contains("dcNum9"))if("dcnum4"!=a.toLowerCase()&&"dcnum5"!=a.toLowerCase()&&"dcnum7"!=a.toLowerCase()&&"dcnum9"!=a.toLowerCase()&&"dcnum11"!=a.toLowerCase()&&"dcnum13"!=a.toLowerCase()||!s.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=s.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)n.dcNum9=(0).ToTime("00.00"),60*v.getHours()+v.getMinutes()>=D&&(v.getHours()>0||v.getMinutes()>0)&&(null!=(g=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName==he.DisplayMember})))&&g.length>0&&(null!=(f=this.dtOTTypes.filter((function(e){return e.CostCenterColID==g[0].LinkData.toString()})))&&f.length>0&&("PayWeeklyOffOT"!=f[0].SysColumnName.toString()&&"PayHolidayOT"!=f[0].SysColumnName.toString()&&"PayEveryDayOT"!=f[0].SysColumnName.toString()||(v<(O=this.GetMaxAvilableHrs(e,t,y,"dcNum9"))&&(O=v),n.dcNum9=O.ToString("HH.mm"),v=v.AddHours(-O.getHours()).AddMinutes(-O.getMinutes())))));else{var k=parseFloat(n.dcNum9).ToTime("00.00").split(".");if(O=new Date(1,1,1,0).AddHours(parseFloat(k[0])).AddMinutes(parseFloat(k[1])),s.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==s.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)P=P.AddHours(O.getHours()).AddMinutes(O.getMinutes());else if(null!=(g=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName=="'"+he.DisplayMember+"'"})))&&g.length>0&&(null!=(f=this.dtOTTypes.filter((function(e){return e.CostCenterColID==o.e.String(g[0].LinkData)})))&&f.length>0&&("PayWeeklyOffOT"==f[0].SysColumnName.toString()||"PayHolidayOT"==f[0].SysColumnName.toString()||"PayEveryDayOT"==f[0].SysColumnName.toString()))){var _=parseFloat(n.dcNum1).ToTime("00.00").split(".");I=(new Date).AddHours(parseFloat(_[0])).AddMinutes(parseFloat(_[1]));var K=parseFloat(n.dcNum9).ToTime("00.00").split(".");j=(new Date).AddHours(parseFloat(K[0])).AddMinutes(parseFloat(K[1])),A<(T=(T=this.GetMaxAvilableHrs(e,t,y,"dcNum9")).AddHours(j.getHours()).AddMinutes(j.getMinutes()))&&(T=A),n.dcNum9=T.ToString("HH.mm"),A=A.AddHours(-T.getHours()).AddMinutes(-T.getMinutes())}}if(null!=(he=this.ScreenObject.ColumnSource.find((function(e){return"FLOAT"==e.DataType.toUpperCase()&&"dcnum11"==e.DisplayMember.toLowerCase()})))&&null!=he&&this.ScreenObject.GridDataColumns.Contains("dcNum11"))if("dcnum4"!=a.toLowerCase()&&"dcnum5"!=a.toLowerCase()&&"dcnum7"!=a.toLowerCase()&&"dcnum9"!=a.toLowerCase()&&"dcnum11"!=a.toLowerCase()&&"dcnum13"!=a.toLowerCase()||!s.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=s.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)n.dcNum11=(0).ToTime("00.00"),60*v.getHours()+v.getMinutes()>=h&&(v.getHours()>0||v.getMinutes()>0)&&(null!=(g=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName==he.DisplayMember})))&&g.length>0&&(null!=(f=this.dtOTTypes.filter((function(e){return e.CostCenterColID==g[0].LinkData.toString()})))&&f.length>0&&("PayWeeklyOffOT"!=f[0].SysColumnName.toString()&&"PayHolidayOT"!=f[0].SysColumnName.toString()&&"PayEveryDayOT"!=f[0].SysColumnName.toString()||(v<(O=this.GetMaxAvilableHrs(e,t,y,"dcNum11"))&&(O=v),n.dcNum11=O.ToString("HH.mm"),v=v.AddHours(-O.getHours()).AddMinutes(-O.getMinutes())))));else{var Q=parseFloat(n.dcNum11).ToTime("00.00").split(".");if(O=new Date(1,1,1,0).AddHours(parseFloat(Q[0])).AddMinutes(parseFloat(Q[1])),s.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==s.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)P=P.AddHours(O.getHours()).AddMinutes(O.getMinutes());else if(null!=(g=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName=="'"+he.DisplayMember+"'"})))&&g.length>0&&(null!=(f=this.dtOTTypes.filter((function(e){return e.CostCenterColID==o.e.String(g[0].LinkData)})))&&f.length>0&&("PayWeeklyOffOT"==f[0].SysColumnName.toString()||"PayHolidayOT"==f[0].SysColumnName.toString()||"PayEveryDayOT"==f[0].SysColumnName.toString()))){var H=parseFloat(n.dcNum1).ToTime("00.00").split(".");I=(new Date).AddHours(parseFloat(H[0])).AddMinutes(parseFloat(H[1]));var W=parseFloat(n.dcNum11).ToTime("00.00").split(".");j=(new Date).AddHours(parseFloat(W[0])).AddMinutes(parseFloat(W[1])),A<(T=(T=this.GetMaxAvilableHrs(e,t,y,"dcNum11")).AddHours(j.getHours()).AddMinutes(j.getMinutes()))&&(T=A),n.dcNum11=T.ToString("HH.mm"),A=A.AddHours(-T.getHours()).AddMinutes(-T.getMinutes())}}if(null!=(he=this.ScreenObject.ColumnSource.find((function(e){return"FLOAT"==e.DataType.toUpperCase()&&"dcnum13"==e.DisplayMember.toLowerCase()})))&&null!=he&&this.ScreenObject.GridDataColumns.Contains("dcNum13"))if("dcnum4"!=a.toLowerCase()&&"dcnum5"!=a.toLowerCase()&&"dcnum7"!=a.toLowerCase()&&"dcnum9"!=a.toLowerCase()&&"dcnum11"!=a.toLowerCase()&&"dcnum13"!=a.toLowerCase()||!s.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=s.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)n.dcNum13=(0).ToTime("00.00"),60*v.getHours()+v.getMinutes()>=S&&(v.getHours()>0||v.getMinutes()>0)&&(null!=(g=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName==he.DisplayMember})))&&g.length>0&&(null!=(f=this.dtOTTypes.filter((function(e){return e.CostCenterColID==g[0].LinkData})))&&f.length>0&&("PayWeeklyOffOT"!=f[0].SysColumnName.toString()&&"PayHolidayOT"!=f[0].SysColumnName.toString()&&"PayEveryDayOT"!=f[0].SysColumnName.toString()||(v<(O=this.GetMaxAvilableHrs(e,t,y,"dcNum13"))&&(O=v),n.dcNum13=O.ToString("HH.mm"),v=v.AddHours(-O.getHours()).AddMinutes(-O.getMinutes())))));else{var U=parseFloat(n.dcNum13).ToTime("00.00").split(".");if(O=new Date(1,1,1,0).AddHours(parseFloat(U[0])).AddMinutes(parseFloat(U[1])),s.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==s.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)P=P.AddHours(O.getHours()).AddMinutes(O.getMinutes());else if(null!=(g=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName=="'"+he.DisplayMember+"'"})))&&g.length>0&&(null!=(f=this.dtOTTypes.filter((function(e){return e.CostCenterColID==o.e.String(g[0].LinkData)})))&&f.length>0&&("PayWeeklyOffOT"==f[0].SysColumnName.toString()||"PayHolidayOT"==f[0].SysColumnName.toString()||"PayEveryDayOT"==f[0].SysColumnName.toString()))){var X=parseFloat(n.dcNum1).ToTime("00.00").split(".");I=(new Date).AddHours(parseFloat(X[0])).AddMinutes(parseFloat(X[1]));var q=parseFloat(n.dcNum13).ToTime("00.00").split(".");j=(new Date).AddHours(parseFloat(q[0])).AddMinutes(parseFloat(q[1])),A<(T=(T=this.GetMaxAvilableHrs(e,t,y,"dcNum13")).AddHours(j.getHours()).AddMinutes(j.getMinutes()))&&(T=A),n.dcNum13=T.ToString("HH.mm"),A=A.AddHours(-T.getHours()).AddMinutes(-T.getMinutes())}}}else n.dcNum5=(0).ToTime("00.00"),n.dcNum7=(0).ToTime("00.00"),n.dcNum9=(0).ToTime("00.00"),n.dcNum11=(0).ToTime("00.00"),n.dcNum13=(0).ToTime("00.00");"dcnum4"!=a.toLowerCase()&&"dcnum5"!=a.toLowerCase()&&"dcnum7"!=a.toLowerCase()&&"dcnum9"!=a.toLowerCase()&&"dcnum11"!=a.toLowerCase()&&"dcnum13"!=a.toLowerCase()||!s.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=s.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence||s.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==s.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry&&(n.dcNum1=P.ToString("HH.mm"))}else{if(null!=(he=this.ScreenObject.ColumnSource.find((function(e){return"FLOAT"==e.DataType.toUpperCase()&&"dcnum2"==e.DisplayMember.toLowerCase()})))&&null!=he&&this.ScreenObject.GridDataColumns.Contains("dcNum2")&&(o.e.IsEmpty(n.dcNum2)||-2==parseFloat(n.dcNum2)||(n.dcNum2=(0).ToTime("00.00"))),null!=(he=this.ScreenObject.ColumnSource.find((function(e){return"FLOAT"==e.DataType.toUpperCase()&&"dcnum4"==e.DisplayMember.toLowerCase()})))&&null!=he&&this.ScreenObject.GridDataColumns.Contains("dcNum4"))if("dcnum4"!=a.toLowerCase()&&"dcnum5"!=a.toLowerCase()&&"dcnum7"!=a.toLowerCase()&&"dcnum9"!=a.toLowerCase()&&"dcnum11"!=a.toLowerCase()&&"dcnum13"!=a.toLowerCase()||!s.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=s.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)if("dcnum4"==a.toLowerCase()&&s.a.SessionManager.Preferences.ContainsKey("BreakHoursImpactToOTS")&&"True"==s.a.SessionManager.Preferences.BreakHoursImpactToOTS){if(v.getHours()>0||v.getMinutes()>0){var Y=parseFloat(n.dcNum4).ToTime("00.00").split(".");O=new Date(1,1,1,0).AddHours(parseFloat(Y[0])).AddMinutes(parseFloat(Y[1])),n.dcNum4=O.ToString("HH.mm"),v=v.AddHours(-O.getHours()).AddMinutes(-O.getMinutes())}}else n.dcNum4=(0).ToTime("00.00"),(v.getHours()>0||v.getMinutes()>0)&&(v<(O=this.GetMaxAvilableHrs(e,t,y,"dcNum4"))&&(O=v),n.dcNum4=O.ToString("HH.mm"),v=v.AddHours(-O.getHours()).AddMinutes(-O.getMinutes()));else{var z=parseFloat(n.dcNum4).ToTime("00.00").split(".");if(O=new Date(1,1,1,0).AddHours(parseFloat(z[0])).AddMinutes(parseFloat(z[1])),s.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==s.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)P=P.AddHours(O.getHours()).AddMinutes(O.getMinutes());else{var J=parseFloat(n.dcNum1).ToTime("00.00").split(".");A=(I=(new Date).AddHours(parseFloat(J[0])).AddMinutes(parseFloat(J[1]))).AddHours(-O.getHours()).AddMinutes(-O.getMinutes())}}if(i){if(null!=(he=this.ScreenObject.ColumnSource.find((function(e){return"FLOAT"==e.DataType.toUpperCase()&&"dcnum5"==e.DisplayMember.toLowerCase()})))&&null!=he&&this.ScreenObject.GridDataColumns.Contains("dcNum5"))if("dcnum4"!=a.toLowerCase()&&"dcnum5"!=a.toLowerCase()&&"dcnum7"!=a.toLowerCase()&&"dcnum9"!=a.toLowerCase()&&"dcnum11"!=a.toLowerCase()&&"dcnum13"!=a.toLowerCase()||!s.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=s.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)n.dcNum5=(0).ToTime("00.00"),60*v.getHours()+v.getMinutes()>=u&&(v.getHours()>0||v.getMinutes()>0)&&(null!=(g=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName==he.DisplayMember})))&&g.length>0&&(null!=(f=this.dtOTTypes.filter((function(e){return e.CostCenterColID==g[0].LinkData.toString()})))&&f.length>0&&("PayHolidayMastOT"!=f[0].SysColumnName.toString()&&"PayHolidayOT"!=f[0].SysColumnName.toString()&&"PayEveryDayOT"!=f[0].SysColumnName.toString()||(v<(O=this.GetMaxAvilableHrs(e,t,y,"dcNum5"))&&(O=v),n.dcNum5=O.ToString("HH.mm"),v=v.AddHours(-O.getHours()).AddMinutes(-O.getMinutes())))));else{var Z=parseFloat(n.dcNum5).ToTime("00.00").split(".");if(O=new Date(1,1,1,0).AddHours(parseFloat(Z[0])).AddMinutes(parseFloat(Z[1])),s.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==s.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)P=P.AddHours(O.getHours()).AddMinutes(O.getMinutes());else if(null!=(g=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName=="'"+he.DisplayMember+"'"})))&&g.length>0&&(null!=(f=this.dtOTTypes.filter((function(e){return e.CostCenterColID==o.e.String(g[0].LinkData)})))&&f.length>0&&("PayHolidayMastOT"==f[0].SysColumnName.toString()||"PayHolidayOT"==f[0].SysColumnName.toString()||"PayEveryDayOT"==f[0].SysColumnName.toString()))){var $=parseFloat(n.dcNum1).ToTime("00.00").split(".");I=(new Date).AddHours(parseFloat($[0])).AddMinutes(parseFloat($[1]));var ee=parseFloat(n.dcNum5).ToTime("00.00").split(".");j=(new Date).AddHours(parseFloat(ee[0])).AddMinutes(parseFloat(ee[1])),A<(T=(T=this.GetMaxAvilableHrs(e,t,y,"dcNum5")).AddHours(j.getHours()).AddMinutes(j.getMinutes()))&&(T=A),n.dcNum5=T.ToString("HH.mm"),A=A.AddHours(-T.getHours()).AddMinutes(-T.getMinutes())}}if(null!=(he=this.ScreenObject.ColumnSource.find((function(e){return"FLOAT"==e.DataType.toUpperCase()&&"dcnum7"==e.DisplayMember.toLowerCase()})))&&null!=he&&this.ScreenObject.GridDataColumns.Contains("dcNum7"))if("dcnum4"!=a.toLowerCase()&&"dcnum5"!=a.toLowerCase()&&"dcnum7"!=a.toLowerCase()&&"dcnum9"!=a.toLowerCase()&&"dcnum11"!=a.toLowerCase()&&"dcnum13"!=a.toLowerCase()||!s.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=s.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)n.dcNum7=(0).ToTime("00.00"),60*v.getHours()+v.getMinutes()>=d&&(v.getHours()>0||v.getMinutes()>0)&&(null!=(g=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName==he.DisplayMember})))&&g.length>0&&(null!=(f=this.dtOTTypes.filter((function(e){return e.CostCenterColID==g[0].LinkData.toString()})))&&f.length>0&&("PayHolidayMastOT"!=f[0].SysColumnName.toString()&&"PayHolidayOT"!=f[0].SysColumnName.toString()&&"PayEveryDayOT"!=f[0].SysColumnName.toString()||(v<(O=this.GetMaxAvilableHrs(e,t,y,"dcNum7"))&&(O=v),n.dcNum7=O.ToString("HH.mm"),v=v.AddHours(-O.getHours()).AddMinutes(-O.getMinutes())))));else{var te=parseFloat(n.dcNum7).ToTime("00.00").split(".");if(O=new Date(1,1,1,0).AddHours(parseFloat(te[0])).AddMinutes(parseFloat(te[1])),s.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==s.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)P=P.AddHours(O.getHours()).AddMinutes(O.getMinutes());else if(null!=(g=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName=="'"+he.DisplayMember+"'"})))&&g.length>0&&(null!=(f=this.dtOTTypes.filter((function(e){return e.CostCenterColID==o.e.String(g[0].LinkData)})))&&f.length>0&&("PayHolidayMastOT"==f[0].SysColumnName.toString()||"PayHolidayOT"==f[0].SysColumnName.toString()||"PayEveryDayOT"==f[0].SysColumnName.toString()))){var ne=parseFloat(n.dcNum1).ToTime("00.00").split(".");I=(new Date).AddHours(parseFloat(ne[0])).AddMinutes(parseFloat(ne[1]));var ae=parseFloat(n.dcNum7).ToTime("00.00").split(".");j=(new Date).AddHours(parseFloat(ae[0])).AddMinutes(parseFloat(ae[1])),A<(T=(T=this.GetMaxAvilableHrs(e,t,y,"dcNum7")).AddHours(j.getHours()).AddMinutes(j.getMinutes()))&&(T=A),n.dcNum7=T.ToString("HH.mm"),A=A.AddHours(-T.getHours()).AddMinutes(-T.getMinutes())}}if(null!=(he=this.ScreenObject.ColumnSource.find((function(e){return"FLOAT"==e.DataType.toUpperCase()&&"dcnum9"==e.DisplayMember.toLowerCase()})))&&null!=he&&this.ScreenObject.GridDataColumns.Contains("dcNum9"))if("dcnum4"!=a.toLowerCase()&&"dcnum5"!=a.toLowerCase()&&"dcnum7"!=a.toLowerCase()&&"dcnum9"!=a.toLowerCase()&&"dcnum11"!=a.toLowerCase()&&"dcnum13"!=a.toLowerCase()||!s.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=s.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)n.dcNum9=(0).ToTime("00.00"),60*v.getHours()+v.getMinutes()>=D&&(v.getHours()>0||v.getMinutes()>0)&&(null!=(g=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName==he.DisplayMember})))&&g.length>0&&(null!=(f=this.dtOTTypes.filter((function(e){return e.CostCenterColID==g[0].LinkData.toString()})))&&f.length>0&&("PayHolidayMastOT"!=f[0].SysColumnName.toString()&&"PayHolidayOT"!=f[0].SysColumnName.toString()&&"PayEveryDayOT"!=f[0].SysColumnName.toString()||(v<(O=this.GetMaxAvilableHrs(e,t,y,"dcNum9"))&&(O=v),n.dcNum9=O.ToString("HH.mm"),v=v.AddHours(-O.getHours()).AddMinutes(-O.getMinutes())))));else{var ie=parseFloat(n.dcNum9).ToTime("00.00").split(".");if(O=new Date(1,1,1,0).AddHours(parseFloat(ie[0])).AddMinutes(parseFloat(ie[1])),s.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==s.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)P=P.AddHours(O.getHours()).AddMinutes(O.getMinutes());else if(null!=(g=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName=="'"+he.DisplayMember+"'"})))&&g.length>0&&(null!=(f=this.dtOTTypes.filter((function(e){return e.CostCenterColID==o.e.String(g[0].LinkData)})))&&f.length>0&&("PayHolidayMastOT"==f[0].SysColumnName.toString()||"PayHolidayOT"==f[0].SysColumnName.toString()||"PayEveryDayOT"==f[0].SysColumnName.toString()))){var re=parseFloat(n.dcNum1).ToTime("00.00").split(".");I=(new Date).AddHours(parseFloat(re[0])).AddMinutes(parseFloat(re[1]));var se=parseFloat(n.dcNum9).ToTime("00.00").split(".");j=(new Date).AddHours(parseFloat(se[0])).AddMinutes(parseFloat(se[1])),A<(T=(T=this.GetMaxAvilableHrs(e,t,y,"dcNum9")).AddHours(j.getHours()).AddMinutes(j.getMinutes()))&&(T=A),n.dcNum9=T.ToString("HH.mm"),A=A.AddHours(-T.getHours()).AddMinutes(-T.getMinutes())}}if(null!=(he=this.ScreenObject.ColumnSource.find((function(e){return"FLOAT"==e.DataType.toUpperCase()&&"dcnum11"==e.DisplayMember.toLowerCase()})))&&null!=he&&this.ScreenObject.GridDataColumns.Contains("dcNum11"))if("dcnum4"!=a.toLowerCase()&&"dcnum5"!=a.toLowerCase()&&"dcnum7"!=a.toLowerCase()&&"dcnum9"!=a.toLowerCase()&&"dcnum11"!=a.toLowerCase()&&"dcnum13"!=a.toLowerCase()||!s.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=s.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)n.dcNum11=(0).ToTime("00.00"),60*v.getHours()+v.getMinutes()>=h&&(v.getHours()>0||v.getMinutes()>0)&&(null!=(g=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName==he.DisplayMember})))&&g.length>0&&(null!=(f=this.dtOTTypes.filter((function(e){return e.CostCenterColID==g[0].LinkData.toString()})))&&f.length>0&&("PayHolidayMastOT"!=f[0].SysColumnName.toString()&&"PayHolidayOT"!=f[0].SysColumnName.toString()&&"PayEveryDayOT"!=f[0].SysColumnName.toString()||(v<(O=this.GetMaxAvilableHrs(e,t,y,"dcNum11"))&&(O=v),n.dcNum11=O.ToString("HH.mm"),v=v.AddHours(-O.getHours()).AddMinutes(-O.getMinutes())))));else{var oe=parseFloat(n.dcNum11).ToTime("00.00").split(".");if(O=new Date(1,1,1,0).AddHours(parseFloat(oe[0])).AddMinutes(parseFloat(oe[1])),s.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==s.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)P=P.AddHours(O.getHours()).AddMinutes(O.getMinutes());else if(null!=(g=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName=="'"+he.DisplayMember+"'"})))&&g.length>0&&(null!=(f=this.dtOTTypes.filter((function(e){return e.CostCenterColID==o.e.String(g[0].LinkData)})))&&f.length>0&&("PayHolidayMastOT"==f[0].SysColumnName.toString()||"PayHolidayOT"==f[0].SysColumnName.toString()||"PayEveryDayOT"==f[0].SysColumnName.toString()))){var ce=parseFloat(n.dcNum1).ToTime("00.00").split(".");I=(new Date).AddHours(parseFloat(ce[0])).AddMinutes(parseFloat(ce[1]));var le=parseFloat(n.dcNum11).ToTime("00.00").split(".");j=(new Date).AddHours(parseFloat(le[0])).AddMinutes(parseFloat(le[1])),A<(T=(T=this.GetMaxAvilableHrs(e,t,y,"dcNum11")).AddHours(j.getHours()).AddMinutes(j.getMinutes()))&&(T=A),n.dcNum11=T.ToString("HH.mm"),A=A.AddHours(-T.getHours()).AddMinutes(-T.getMinutes())}}if(null!=(he=this.ScreenObject.ColumnSource.find((function(e){return"FLOAT"==e.DataType.toUpperCase()&&"dcnum13"==e.DisplayMember.toLowerCase()})))&&null!=he&&this.ScreenObject.GridDataColumns.Contains("dcNum13"))if("dcnum4"!=a.toLowerCase()&&"dcnum5"!=a.toLowerCase()&&"dcnum7"!=a.toLowerCase()&&"dcnum9"!=a.toLowerCase()&&"dcnum11"!=a.toLowerCase()&&"dcnum13"!=a.toLowerCase()||!s.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=s.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)n.dcNum13=(0).ToTime("00.00"),60*v.getHours()+v.getMinutes()>=S&&(v.getHours()>0||v.getMinutes()>0)&&(null!=(g=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName==he.DisplayMember})))&&g.length>0&&(null!=(f=this.dtOTTypes.filter((function(e){return e.CostCenterColID==g[0].LinkData.toString()})))&&f.length>0&&("PayHolidayMastOT"!=f[0].SysColumnName.toString()&&"PayHolidayOT"!=f[0].SysColumnName.toString()&&"PayEveryDayOT"!=f[0].SysColumnName.toString()||(v<(O=this.GetMaxAvilableHrs(e,t,y,"dcNum13"))&&(O=v),n.dcNum13=O.ToString("HH.mm"),v=v.AddHours(-O.getHours()).AddMinutes(-O.getMinutes())))));else{var ue=parseFloat(n.dcNum13).ToTime("00.00").split(".");if(O=new Date(1,1,1,0).AddHours(parseFloat(ue[0])).AddMinutes(parseFloat(ue[1])),s.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==s.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)P=P.AddHours(O.getHours()).AddMinutes(O.getMinutes());else if(null!=(g=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName=="'"+he.DisplayMember+"'"})))&&g.length>0&&(null!=(f=this.dtOTTypes.filter((function(e){return e.CostCenterColID==o.e.String(g[0].LinkData)})))&&f.length>0&&("PayHolidayMastOT"==f[0].SysColumnName.toString()||"PayHolidayOT"==f[0].SysColumnName.toString()||"PayEveryDayOT"==f[0].SysColumnName.toString()))){var de=parseFloat(n.dcNum1).ToTime("00.00").split(".");I=(new Date).AddHours(parseFloat(de[0])).AddMinutes(parseFloat(de[1]));var De=parseFloat(n.dcNum13).ToTime("00.00").split(".");j=(new Date).AddHours(parseFloat(De[0])).AddMinutes(parseFloat(De[1])),A<(T=(T=this.GetMaxAvilableHrs(e,t,y,"dcNum13")).AddHours(j.getHours()).AddMinutes(j.getMinutes()))&&(T=A),n.dcNum13=T.ToString("HH.mm"),A=A.AddHours(-T.getHours()).AddMinutes(-T.getMinutes())}}}else n.dcNum5=(0).ToTime("00.00"),n.dcNum7=(0).ToTime("00.00"),n.dcNum9=(0).ToTime("00.00"),n.dcNum11=(0).ToTime("00.00"),n.dcNum13=(0).ToTime("00.00");"dcnum4"!=a.toLowerCase()&&"dcnum5"!=a.toLowerCase()&&"dcnum7"!=a.toLowerCase()&&"dcnum9"!=a.toLowerCase()&&"dcnum11"!=a.toLowerCase()&&"dcnum13"!=a.toLowerCase()||!s.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=s.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence||s.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==s.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry&&(n.dcNum1=P.ToString("HH.mm"))}else{var he;if(null!=(he=this.ScreenObject.ColumnSource.find((function(e){return"FLOAT"==e.DataType.toUpperCase()&&"dcnum2"==e.DisplayMember.toLowerCase()})))&&null!=he&&this.ScreenObject.GridDataColumns.Contains("dcNum2")&&(n.dcNum2=(0).ToTime("00.00"),(v.getHours()>0||v.getMinutes()>0)&&(v<(O=this.GetMaxAvilableHrs(e,t,y,"dcNum2"))&&(O=v),n.dcNum2=O.ToString("HH.mm"),v=v.AddHours(-O.getHours()).AddMinutes(-O.getMinutes()),P=P.AddHours(O.getHours()).AddMinutes(O.getMinutes()))),null!=(he=this.ScreenObject.ColumnSource.find((function(e){return"FLOAT"==e.DataType.toUpperCase()&&"dcnum4"==e.DisplayMember.toLowerCase()})))&&null!=he&&this.ScreenObject.GridDataColumns.Contains("dcNum4"))if("dcnum4"!=a.toLowerCase()&&"dcnum5"!=a.toLowerCase()&&"dcnum7"!=a.toLowerCase()&&"dcnum9"!=a.toLowerCase()&&"dcnum11"!=a.toLowerCase()&&"dcnum13"!=a.toLowerCase()||!s.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=s.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)if("dcnum4"==a.toLowerCase()&&s.a.SessionManager.Preferences.ContainsKey("BreakHoursImpactToOTS")&&"True"==s.a.SessionManager.Preferences.BreakHoursImpactToOTS){if(v.getHours()>0||v.getMinutes()>0){var Se=parseFloat(n.dcNum4).ToTime("00.00").split(".");O=new Date(1,1,1,0).AddHours(parseFloat(Se[0])).AddMinutes(parseFloat(Se[1])),n.dcNum4=O.ToString("HH.mm"),v=v.AddHours(-O.getHours()).AddMinutes(-O.getMinutes())}}else n.dcNum4=(0).ToTime("00.00"),(v.getHours()>0||v.getMinutes()>0)&&(v<(O=this.GetMaxAvilableHrs(e,t,y,"dcNum4"))&&(O=v),n.dcNum4=O.ToString("HH.mm"),v=v.AddHours(-O.getHours()).AddMinutes(-O.getMinutes()));else{var me=parseFloat(n.dcNum4).ToTime("00.00").split(".");if(O=new Date(1,1,1,0).AddHours(parseFloat(me[0])).AddMinutes(parseFloat(me[1])),s.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==s.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)P=P.AddHours(O.getHours()).AddMinutes(O.getMinutes());else{var be=parseFloat(n.dcNum1).ToTime("00.00").split(".");I=(new Date).AddHours(parseFloat(be[0])).AddMinutes(parseFloat(be[1]));var Ce=parseFloat(n.dcNum2).ToTime("00.00").split(".");j=(new Date).AddHours(parseFloat(Ce[0])).AddMinutes(parseFloat(Ce[1])),T=(T=this.GetMaxAvilableHrs(e,t,y,"dcNum2")).AddHours(j.getHours()).AddMinutes(j.getMinutes()),(A=I.AddHours(-O.getHours()).AddMinutes(-O.getMinutes()))<T&&(T=A),n.dcNum2=T.ToString("HH.mm"),A=A.AddHours(-T.getHours()).AddMinutes(-T.getMinutes())}}if(i){if(null!=(he=this.ScreenObject.ColumnSource.find((function(e){return"FLOAT"==e.DataType.toUpperCase()&&"dcnum5"==e.DisplayMember.toLowerCase()})))&&null!=he&&this.ScreenObject.GridDataColumns.Contains("dcNum5"))if("dcnum4"!=a.toLowerCase()&&"dcnum5"!=a.toLowerCase()&&"dcnum7"!=a.toLowerCase()&&"dcnum9"!=a.toLowerCase()&&"dcnum11"!=a.toLowerCase()&&"dcnum13"!=a.toLowerCase()||!s.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=s.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)n.dcNum5=(0).ToTime("00.00"),60*v.getHours()+v.getMinutes()>=u&&(v.getHours()>0||v.getMinutes()>0)&&(null!=(g=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName==he.DisplayMember})))&&g.length>0&&(null!=(f=this.dtOTTypes.filter((function(e){return e.CostCenterColID==g[0].LinkData.toString()})))&&f.length>0&&("PayNormalOT"!=f[0].SysColumnName.toString()&&"PayEveryDayOT"!=f[0].SysColumnName.toString()||(v<(O=this.GetMaxAvilableHrs(e,t,y,"dcNum5"))&&(O=v),n.dcNum5=O.ToString("HH.mm"),v=v.AddHours(-O.getHours()).AddMinutes(-O.getMinutes())))));else{var ye=parseFloat(n.dcNum5).ToTime("00.00").split(".");if(O=new Date(1,1,1,0).AddHours(parseFloat(ye[0])).AddMinutes(parseFloat(ye[1])),s.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==s.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)P=P.AddHours(O.getHours()).AddMinutes(O.getMinutes());else if(null!=(g=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName=="'"+he.DisplayMember+"'"})))&&g.length>0&&(null!=(f=this.dtOTTypes.filter((function(e){return e.CostCenterColID==o.e.String(g[0].LinkData)})))&&f.length>0&&("PayNormalOT"==f[0].SysColumnName.toString()||"PayEveryDayOT"==f[0].SysColumnName.toString()))){var pe=parseFloat(n.dcNum1).ToTime("00.00").split(".");I=(new Date).AddHours(parseFloat(pe[0])).AddMinutes(parseFloat(pe[1]));var ge=parseFloat(n.dcNum5).ToTime("00.00").split(".");j=(new Date).AddHours(parseFloat(ge[0])).AddMinutes(parseFloat(ge[1])),A<(T=(T=this.GetMaxAvilableHrs(e,t,y,"dcNum5")).AddHours(j.getHours()).AddMinutes(j.getMinutes()))&&(T=A),n.dcNum5=T.ToString("HH.mm"),A=A.AddHours(-T.getHours()).AddMinutes(-T.getMinutes())}}if(null!=(he=this.ScreenObject.ColumnSource.find((function(e){return"FLOAT"==e.DataType.toUpperCase()&&"dcnum7"==e.DisplayMember.toLowerCase()})))&&null!=he&&this.ScreenObject.GridDataColumns.Contains("dcNum7"))if("dcnum4"!=a.toLowerCase()&&"dcnum5"!=a.toLowerCase()&&"dcnum7"!=a.toLowerCase()&&"dcnum9"!=a.toLowerCase()&&"dcnum11"!=a.toLowerCase()&&"dcnum13"!=a.toLowerCase()||!s.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=s.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)n.dcNum7=(0).ToTime("00.00"),60*v.getHours()+v.getMinutes()>=d&&(v.getHours()>0||v.getMinutes()>0)&&(null!=(g=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName==he.DisplayMember})))&&g.length>0&&(null!=(f=this.dtOTTypes.filter((function(e){return e.CostCenterColID==g[0].LinkData.toString()})))&&f.length>0&&("PayNormalOT"!=f[0].SysColumnName.toString()&&"PayEveryDayOT"!=f[0].SysColumnName.toString()||(v<(O=this.GetMaxAvilableHrs(e,t,y,"dcNum7"))&&(O=v),n.dcNum7=O.ToString("HH.mm"),v=v.AddHours(-O.getHours()).AddMinutes(-O.getMinutes())))));else{var fe=parseFloat(n.dcNum7).ToTime("00.00").split(".");if(O=new Date(1,1,1,0).AddHours(parseFloat(fe[0])).AddMinutes(parseFloat(fe[1])),s.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==s.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)P=P.AddHours(O.getHours()).AddMinutes(O.getMinutes());else if(null!=(g=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName=="'"+he.DisplayMember+"'"})))&&g.length>0&&(null!=(f=this.dtOTTypes.filter((function(e){return e.CostCenterColID==o.e.String(g[0].LinkData)})))&&f.length>0&&("PayNormalOT"==f[0].SysColumnName.toString()||"PayEveryDayOT"==f[0].SysColumnName.toString()))){var Oe=parseFloat(n.dcNum1).ToTime("00.00").split(".");I=(new Date).AddHours(parseFloat(Oe[0])).AddMinutes(parseFloat(Oe[1]));var Ie=parseFloat(n.dcNum7).ToTime("00.00").split(".");j=(new Date).AddHours(parseFloat(Ie[0])).AddMinutes(parseFloat(Ie[1])),A<(T=(T=this.GetMaxAvilableHrs(e,t,y,"dcNum7")).AddHours(j.getHours()).AddMinutes(j.getMinutes()))&&(T=A),n.dcNum7=T.ToString("HH.mm"),A=A.AddHours(-T.getHours()).AddMinutes(-T.getMinutes())}}if(null!=(he=this.ScreenObject.ColumnSource.find((function(e){return"FLOAT"==e.DataType.toUpperCase()&&"dcnum9"==e.DisplayMember.toLowerCase()})))&&null!=he&&this.ScreenObject.GridDataColumns.Contains("dcNum9"))if("dcnum4"!=a.toLowerCase()&&"dcnum5"!=a.toLowerCase()&&"dcnum7"!=a.toLowerCase()&&"dcnum9"!=a.toLowerCase()&&"dcnum11"!=a.toLowerCase()&&"dcnum13"!=a.toLowerCase()||!s.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=s.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)n.dcNum9=(0).ToTime("00.00"),60*v.getHours()+v.getMinutes()>=D&&(v.getHours()>0||v.getMinutes()>0)&&(null!=(g=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName==he.DisplayMember})))&&g.length>0&&(null!=(f=this.dtOTTypes.filter((function(e){return e.CostCenterColID==g[0].LinkData.toString()})))&&f.length>0&&("PayNormalOT"!=f[0].SysColumnName.toString()&&"PayEveryDayOT"!=f[0].SysColumnName.toString()||(v<(O=this.GetMaxAvilableHrs(e,t,y,"dcNum9"))&&(O=v),n.dcNum9=O.ToString("HH.mm"),v=v.AddHours(-O.getHours()).AddMinutes(-O.getMinutes())))));else{var Te=parseFloat(n.dcNum9).ToTime("00.00").split(".");if(O=new Date(1,1,1,0).AddHours(parseFloat(Te[0])).AddMinutes(parseFloat(Te[1])),s.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==s.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)P=P.AddHours(O.getHours()).AddMinutes(O.getMinutes());else if(null!=(g=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName=="'"+he.DisplayMember+"'"})))&&g.length>0&&(null!=(f=this.dtOTTypes.filter((function(e){return e.CostCenterColID==o.e.String(g[0].LinkData)})))&&f.length>0&&("PayNormalOT"==f[0].SysColumnName.toString()||"PayEveryDayOT"==f[0].SysColumnName.toString()))){var je=parseFloat(n.dcNum1).ToTime("00.00").split(".");I=(new Date).AddHours(parseFloat(je[0])).AddMinutes(parseFloat(je[1]));var Pe=parseFloat(n.dcNum9).ToTime("00.00").split(".");j=(new Date).AddHours(parseFloat(Pe[0])).AddMinutes(parseFloat(Pe[1])),A<(T=(T=this.GetMaxAvilableHrs(e,t,y,"dcNum9")).AddHours(j.getHours()).AddMinutes(j.getMinutes()))&&(T=A),n.dcNum9=T.ToString("HH.mm"),A=A.AddHours(-T.getHours()).AddMinutes(-T.getMinutes())}}if(null!=(he=this.ScreenObject.ColumnSource.find((function(e){return"FLOAT"==e.DataType.toUpperCase()&&"dcnum11"==e.DisplayMember.toLowerCase()})))&&null!=he&&this.ScreenObject.GridDataColumns.Contains("dcNum11"))if("dcnum4"!=a.toLowerCase()&&"dcnum5"!=a.toLowerCase()&&"dcnum7"!=a.toLowerCase()&&"dcnum9"!=a.toLowerCase()&&"dcnum11"!=a.toLowerCase()&&"dcnum13"!=a.toLowerCase()||!s.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=s.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)n.dcNum11=(0).ToTime("00.00"),60*v.getHours()+v.getMinutes()>=h&&(v.getHours()>0||v.getMinutes()>0)&&(null!=(g=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName==he.DisplayMember})))&&g.length>0&&(null!=(f=this.dtOTTypes.filter((function(e){return e.CostCenterColID==g[0].LinkData.toString()})))&&f.length>0&&("PayNormalOT"!=f[0].SysColumnName.toString()&&"PayEveryDayOT"!=f[0].SysColumnName.toString()||(v<(O=this.GetMaxAvilableHrs(e,t,y,"dcNum11"))&&(O=v),n.dcNum11=O.ToString("HH.mm"),v=v.AddHours(-O.getHours()).AddMinutes(-O.getMinutes())))));else{var Ae=parseFloat(n.dcNum11).ToTime("00.00").split(".");if(O=new Date(1,1,1,0).AddHours(parseFloat(Ae[0])).AddMinutes(parseFloat(Ae[1])),s.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==s.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)P=P.AddHours(O.getHours()).AddMinutes(O.getMinutes());else if(null!=(g=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName=="'"+he.DisplayMember+"'"})))&&g.length>0&&(null!=(f=this.dtOTTypes.filter((function(e){return e.CostCenterColID==o.e.String(g[0].LinkData)})))&&f.length>0&&("PayNormalOT"==f[0].SysColumnName.toString()||"PayEveryDayOT"==f[0].SysColumnName.toString()))){var Me=parseFloat(n.dcNum1).ToTime("00.00").split(".");I=(new Date).AddHours(parseFloat(Me[0])).AddMinutes(parseFloat(Me[1]));var ve=parseFloat(n.dcNum11).ToTime("00.00").split(".");j=(new Date).AddHours(parseFloat(ve[0])).AddMinutes(parseFloat(ve[1])),A<(T=(T=this.GetMaxAvilableHrs(e,t,y,"dcNum11")).AddHours(j.getHours()).AddMinutes(j.getMinutes()))&&(T=A),n.dcNum11=T.ToString("HH.mm"),A=A.AddHours(-T.getHours()).AddMinutes(-T.getMinutes())}}if(null!=(he=this.ScreenObject.ColumnSource.find((function(e){return"FLOAT"==e.DataType.toUpperCase()&&"dcnum13"==e.DisplayMember.toLowerCase()})))&&null!=he&&this.ScreenObject.GridDataColumns.Contains("dcNum13"))if("dcnum4"!=a.toLowerCase()&&"dcnum5"!=a.toLowerCase()&&"dcnum7"!=a.toLowerCase()&&"dcnum9"!=a.toLowerCase()&&"dcnum11"!=a.toLowerCase()&&"dcnum13"!=a.toLowerCase()||!s.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=s.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence)n.dcNum13=(0).ToTime("00.00"),60*v.getHours()+v.getMinutes()>=S&&(v.getHours()>0||v.getMinutes()>0)&&(null!=(g=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName==he.DisplayMember})))&&g.length>0&&(null!=(f=this.dtOTTypes.filter((function(e){return e.CostCenterColID==g[0].LinkData.toString()})))&&f.length>0&&("PayNormalOT"!=f[0].SysColumnName.toString()&&"PayEveryDayOT"!=f[0].SysColumnName.toString()||(v<(O=this.GetMaxAvilableHrs(e,t,y,"dcNum13"))&&(O=v),n.dcNum13=O.ToString("HH.mm"),v=v.AddHours(-O.getHours()).AddMinutes(-O.getMinutes())))));else{var Ge=parseFloat(n.dcNum13).ToTime("00.00").split(".");if(O=new Date(1,1,1,0).AddHours(parseFloat(Ge[0])).AddMinutes(parseFloat(Ge[1])),s.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==s.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry)P=P.AddHours(O.getHours()).AddMinutes(O.getMinutes());else if(null!=(g=this.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName=="'"+he.DisplayMember+"'"})))&&g.length>0&&(null!=(f=this.dtOTTypes.filter((function(e){return e.CostCenterColID==o.e.String(g[0].LinkData)})))&&f.length>0&&("PayNormalOT"==f[0].SysColumnName.toString()||"PayEveryDayOT"==f[0].SysColumnName.toString()))){var Ne=parseFloat(n.dcNum1).ToTime("00.00").split(".");I=(new Date).AddHours(parseFloat(Ne[0])).AddMinutes(parseFloat(Ne[1]));var Ee=parseFloat(n.dcNum13).ToTime("00.00").split(".");j=(new Date).AddHours(parseFloat(Ee[0])).AddMinutes(parseFloat(Ee[1])),A<(T=(T=this.GetMaxAvilableHrs(e,t,y,"dcNum13")).AddHours(j.getHours()).AddMinutes(j.getMinutes()))&&(T=A),n.dcNum13=T.ToString("HH.mm"),A=A.AddHours(-T.getHours()).AddMinutes(-T.getMinutes())}}}else this.ScreenObject.GridDataColumns.Contains("dcNum5")&&(n.dcNum5=(0).ToTime("00.00")),this.ScreenObject.GridDataColumns.Contains("dcNum7")&&(n.dcNum7=(0).ToTime("00.00")),this.ScreenObject.GridDataColumns.Contains("dcNum9")&&(n.dcNum9=(0).ToTime("00.00")),this.ScreenObject.GridDataColumns.Contains("dcNum11")&&(n.dcNum11=(0).ToTime("00.00")),this.ScreenObject.GridDataColumns.Contains("dcNum13")&&(n.dcNum13=(0).ToTime("00.00"));"dcnum4"!=a.toLowerCase()&&"dcnum5"!=a.toLowerCase()&&"dcnum7"!=a.toLowerCase()&&"dcnum9"!=a.toLowerCase()&&"dcnum11"!=a.toLowerCase()&&"dcnum13"!=a.toLowerCase()||!s.a.SessionManager.Preferences.ContainsKey("AllowManualHoursEntryInDailyAttendence")||"True"!=s.a.SessionManager.Preferences.AllowManualHoursEntryInDailyAttendence||s.a.SessionManager.Preferences.ContainsKey("DistributeHoursafterBreakHoursEntry")&&"False"==s.a.SessionManager.Preferences.DistributeHoursafterBreakHoursEntry&&(n.dcNum1=P.ToString("HH.mm"))}}else this.ScreenObject.GridDataColumns.Contains("dcNum2")&&(n.dcNum2=(0).ToTime("00.00")),this.ScreenObject.GridDataColumns.Contains("dcNum4")&&(n.dcNum4=(0).ToTime("00.00")),this.ScreenObject.GridDataColumns.Contains("dcNum5")&&(n.dcNum5=(0).ToTime("00.00")),this.ScreenObject.GridDataColumns.Contains("dcNum7")&&(n.dcNum7=(0).ToTime("00.00")),this.ScreenObject.GridDataColumns.Contains("dcNum9")&&(n.dcNum9=(0).ToTime("00.00")),this.ScreenObject.GridDataColumns.Contains("dcNum11")&&(n.dcNum11=(0).ToTime("00.00")),this.ScreenObject.GridDataColumns.Contains("dcNum13")&&(n.dcNum13=(0).ToTime("00.00"));if(s.a.SessionManager.Preferences.ContainsKey("UseDailyAttRates")){var we=0;o.e.IsEmpty(n.dcNum2)||o.e.IsEmpty(n.dcNum3)||(we=this.ConvertHoursToMinutes(n.dcNum2.toString())*(parseFloat(n.dcNum3)/60));for(var Fe=5;Fe<15;Fe++)0,null!=n["dcNum"+Fe]&&parseFloat(n["dcNum"+Fe])>0&&null!=n["dcNum"+Fe]&&null!=n["dcNum"+Fe]&&""!=n["dcNum"+Fe].toString()&&null!=n["dcNum"+(Fe+1)]&&null!=n["dcNum"+(Fe+1)]&&""!=n["dcNum"+(Fe+1)].toString()&&(we+=this.ConvertHoursToMinutes(n["dcNum"+Fe].toString())*(parseFloat(n["dcNum"+(Fe+1)])/60)),Fe+=1;n.dcNum15=we.ToString("0.00")}}catch(Ve){Logger.ErrorLog("AddEditDocumentsPayroll:: DistributeTotalHours() : "+Ve.stack)}}},{key:"GetHoursDefChart",value:function(e,t){var n=null;if(s.a.SessionManager.Preferences.ContainsKey("HoursDefChartBasedOn")&&""!=s.a.SessionManager.Preferences.HoursDefChartBasedOn){var a=s.a.SessionManager.Preferences.HoursDefChartBasedOn.split(",");if(null!=a&&a.length>0){for(var i=" 1=1 ",r="",c=0;c<a.length;c++)null!=a[c]&&""!=a[c]&&(r="dcCCNID"+(parseInt(a[c])-5e4),o.e.IsEmpty(t[r+"_Key"])?i+=" AND "+r+"=1":i+=" AND ( "+r+"="+t[r+"_Key"].toString()+" OR "+r+"=1 )");if(i.length>0){var l=new Date(e).ToString("ddMMMyyyy")+"_"+i.Replace(" ",""),u=!1;null!=this.dsHrsDefDict&&this.dsHrsDefDict.length>0&&this.dsHrsDefDict.ContainsKey(l)&&(u=!0),u?n=this.dsHrsDefDict[l]:(n=s.a.common.GetDataSet3("PAY004",e,i).Tables[0],this.dsHrsDefDict.push(l,n))}}}return n}},{key:"GetTotalEnteredHours",value:function(e,t,n,a){var i;a.dtdblOld=Date.Today();var r="";if(a.VoucherNo="",this.ScreenObject.GridData.length>0){for(var c=Date.Today().ToString("dd/MMM/yyyy"),l="1",u=null,d=0;d<this.ScreenObject.GridData.length;d++)if(this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[d].ProductID_Key)){u=this.ScreenObject.GridData[d];var D,h=this.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()}));h?c=h.Date.ToString("dd/MMM/yyyy"):(D=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha1"==e.DisplayMember.toLowerCase()})))&&!o.e.IsEmpty(u[D.DisplayMember+"_Key"])&&(c=new Date(u[D.DisplayMember+"_Key"]).ToString("dd/MMM/yyyy")),(h=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})))?(h instanceof C.b||h instanceof p.a)&&(l=h.SelectedValue.toString()):(D=this.ScreenObject.ColumnSource.find((function(e){return"LISTBOX"==e.DataType.toUpperCase()&&"dcccnid51_key"==e.ValueMember.toLowerCase()})))&&!o.e.IsEmpty(u[D.ValueMember])&&(l=u[D.ValueMember].toString()),e==l&&t==c&&(o.e.IsEmpty(u[n])||("dcnum2"==n.toLowerCase()?-1!=parseFloat(u[n])&&-2!=parseFloat(u[n])&&(i=parseFloat(u[n]).ToTime("00.00").split("."),a.dtdblOld=a.dtdblOld.AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1]))):(i=parseFloat(u[n]).ToTime("00.00").split("."),a.dtdblOld=a.dtdblOld.AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1]))),r.length>0&&(r+=","),r+=u.DocSeqNo.toString()))}a.sVoucherNo=" @SeqNo - "+r;var S=null;if(new Date(t).ToString("ddMMMyyyy"),null!=(S=s.a.common.GetDataSet3("PAY003",t,e,this.ScreenObject.IsDocEdit?this.ScreenObject.DocID.toString():"0").Tables[0])&&S.length>0){r="";for(var m=0;m<S.length;m++)o.e.IsEmpty(S[m][n])||("dcnum2"==n.toLowerCase()?-1!=parseFloat(S[m][n])&&-2!=parseFloat(S[n])&&(i=parseFloat(S[m][n]).ToTime("00.00").split("."),a.dtdblOld=a.dtdblOld.AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1]))):(i=parseFloat(S[m][n]).ToTime("00.00").split("."),a.dtdblOld=a.dtdblOld.AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1]))),a.sVoucherNo+=" @VoucherNo - "+S[m].VoucherNo.toString()+" @SeqNo - "+S[m].DocSeqNo.toString())}}return a.dtdblOld}},{key:"GetMaxAvilableHrs",value:function(e,t,n,a){var i,r=new Date(1,1,1,0),s=new Date(1,1,1,0),o="",c={dtdblOld:s,sVoucherNo:o};return this.GetTotalEnteredHours(e,t,a,c),s=c.dtdblOld,o=c.sVoucherNo,"dcNum1"==a?(i=parseFloat(n[0].MaxHrsPerDay).ToTime("00.00").split("."),r=(r=r.AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1]))).AddHours(-s.getHours()).AddMinutes(-s.getMinutes())):"dcNum2"==a?(i=parseFloat(n[0].NormalHrs).ToTime("00.00").split("."),r=(r=r.AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1]))).AddHours(-s.getHours()).AddMinutes(-s.getMinutes())):"dcNum4"==a?(i=parseFloat(n[0].BreakHrs).ToTime("00.00").split("."),r=(r=r.AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1]))).AddHours(-s.getHours()).AddMinutes(-s.getMinutes())):"dcNum5"==a?(i=parseFloat(n[0].OT1).ToTime("00.00").split("."),r=(r=r.AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1]))).AddHours(-s.getHours()).AddMinutes(-s.getMinutes())):"dcNum7"==a?(i=parseFloat(n[0].OT2).ToTime("00.00").split("."),r=(r=r.AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1]))).AddHours(-s.getHours()).AddMinutes(-s.getMinutes())):"dcNum9"==a?(i=parseFloat(n[0].OT3).ToTime("00.00").split("."),r=(r=r.AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1]))).AddHours(-s.getHours()).AddMinutes(-s.getMinutes())):"dcNum11"==a?(i=parseFloat(n[0].OT4).ToTime("00.00").split("."),r=(r=r.AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1]))).AddHours(-s.getHours()).AddMinutes(-s.getMinutes())):"dcNum13"==a&&(i=parseFloat(n[0].OT5).ToTime("00.00").split("."),r=(r=r.AddHours(parseFloat(i[0])).AddMinutes(parseFloat(i[1]))).AddHours(-s.getHours()).AddMinutes(-s.getMinutes())),r}},{key:"GetDuplicateTimingsOfEmployeeTimeSheet",value:function(e,t,n,a){for(var i,r,c="",l=Date.Today().ToString("dd/MMM/yyyy"),u="1",d=0;d<this.ScreenObject.GridData.length;d++)if(d!=n&&this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[d].ProductID_Key)){l="",u="1",r=this.ScreenObject.GridData[d];var D=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha1"==e.DisplayMember.toLowerCase()}));D&&!o.e.IsEmpty(r[D.DisplayMember+"_Key"])&&(l=new Date(r[D.DisplayMember+"_Key"]).ToString("dd/MMM/yyyy"));var h=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));if(h?(h instanceof C.b||h instanceof p.a)&&(u=h.SelectedValue.toString()):(D=this.ScreenObject.ColumnSource.find((function(e){return"LISTBOX"==e.DataType.toUpperCase()&&"dcccnid51_key"==e.ValueMember.toLowerCase()})))&&!o.e.IsEmpty(r[D.ValueMember])&&(u=r[D.ValueMember].toString()),t==u&&e==l){if(this.ScreenObject.GridDataColumns.Contains("dcAlpha2_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[n].dcAlpha2_Key)&&(i=new Date(this.ScreenObject.GridData[n].dcAlpha2_Key),!o.e.IsEmpty(this.ScreenObject.GridData[d].dcAlpha2_Key)&&!o.e.IsEmpty(this.ScreenObject.GridData[d].dcAlpha4_Key)&&i>=new Date(this.ScreenObject.GridData[d].dcAlpha2_Key)&&i<new Date(this.ScreenObject.GridData[d].dcAlpha4_Key))){c=(d+1).toString();break}if(this.ScreenObject.GridDataColumns.Contains("dcAlpha4_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[n].dcAlpha4_Key)&&(i=new Date(this.ScreenObject.GridData[n].dcAlpha4_Key),!o.e.IsEmpty(this.ScreenObject.GridData[d].dcAlpha2_Key)&&!o.e.IsEmpty(this.ScreenObject.GridData[d].dcAlpha4_Key)&&i>new Date(this.ScreenObject.GridData[d].dcAlpha2_Key)&&i<new Date(this.ScreenObject.GridData[d].dcAlpha4_Key))){c=(d+1).toString();break}if(this.ScreenObject.GridDataColumns.Contains("dcAlpha2_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[d].dcAlpha2_Key)&&(i=new Date(this.ScreenObject.GridData[d].dcAlpha2_Key),!o.e.IsEmpty(this.ScreenObject.GridData[n].dcAlpha2_Key)&&!o.e.IsEmpty(this.ScreenObject.GridData[n].dcAlpha4_Key)&&i>=new Date(this.ScreenObject.GridData[n].dcAlpha2_Key)&&i<new Date(this.ScreenObject.GridData[n].dcAlpha4_Key))){c=(d+1).toString();break}if(this.ScreenObject.GridDataColumns.Contains("dcAlpha4_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[d].dcAlpha4_Key)&&(i=new Date(this.ScreenObject.GridData[d].dcAlpha4_Key),!o.e.IsEmpty(this.ScreenObject.GridData[n].dcAlpha2_Key)&&!o.e.IsEmpty(this.ScreenObject.GridData[n].dcAlpha4_Key)&&i>new Date(this.ScreenObject.GridData[n].dcAlpha2_Key)&&i<new Date(this.ScreenObject.GridData[n].dcAlpha4_Key))){c=(d+1).toString();break}}}if(this.ScreenObject.GridDataColumns.Contains("dcAlpha2_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[n].dcAlpha2_Key)&&this.ScreenObject.GridDataColumns.Contains("dcAlpha4_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[n].dcAlpha4_Key)){var S="d.tDocumentType="+a+" and a.StatusID=369 AND ISDATE(d.dcAlpha1)=1 AND ISDATE(d.dcAlpha2)=1 AND ISDATE(d.dcAlpha3)=1 AND ISDATE(d.dcAlpha4)=1 AND a.DOCID<>"+this.ScreenObject.DocID+" AND b.dcCCNID51="+t+" \nAND (\n( CONVERT(DATETIME,d.dcAlpha2) >= CONVERT(DATETIME,'"+new Date(this.ScreenObject.GridData[n].dcAlpha2_Key).ToString("dd/MMM/yyyy HH:mm:ss")+"') AND CONVERT(DATETIME,d.dcAlpha2) < CONVERT(DATETIME,'"+new Date(this.ScreenObject.GridData[n].dcAlpha4_Key).ToString("dd/MMM/yyyy HH:mm:ss")+"') ) OR\n( CONVERT(DATETIME,d.dcAlpha4) > CONVERT(DATETIME,'"+new Date(this.ScreenObject.GridData[n].dcAlpha2_Key).ToString("dd/MMM/yyyy HH:mm:ss")+"') AND CONVERT(DATETIME,d.dcAlpha4) < CONVERT(DATETIME,'"+new Date(this.ScreenObject.GridData[n].dcAlpha4_Key).ToString("dd/MMM/yyyy HH:mm:ss")+"') ) OR\n( CONVERT(DATETIME,'"+new Date(this.ScreenObject.GridData[n].dcAlpha2_Key).ToString("dd/MMM/yyyy HH:mm:ss")+"') >= CONVERT(DATETIME,d.dcAlpha2) AND CONVERT(DATETIME,'"+new Date(this.ScreenObject.GridData[n].dcAlpha2_Key).ToString("dd/MMM/yyyy HH:mm:ss")+"') < CONVERT(DATETIME,d.dcAlpha4)) OR\n( CONVERT(DATETIME,'"+new Date(this.ScreenObject.GridData[n].dcAlpha4_Key).ToString("dd/MMM/yyyy HH:mm:ss")+"') > CONVERT(DATETIME,d.dcAlpha2) AND CONVERT(DATETIME,'"+new Date(this.ScreenObject.GridData[n].dcAlpha4_Key).ToString("dd/MMM/yyyy HH:mm:ss")+"') < CONVERT(DATETIME,d.dcAlpha4))\n)",m=s.a.common.GetDataSet("PAY006",JSON.stringify(S));null!=m&&m.length>0&&(c=m[0].VoucherNo.toString())}return c}},{key:"GetDuplicateTimingsOfEmployee",value:function(e,t,n){for(var a,i,r="",c=Date.Today().ToString("dd/MMM/yyyy"),l="1",u=0;u<this.ScreenObject.GridData.length;u++)if(u!=n&&this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[u].ProductID_Key)){c="",l="1",i=this.ScreenObject.GridData[u];var d,D=this.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()}));if(D?c=D.Date.ToString("dd/MMM/yyyy"):(d=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha1"==e.DisplayMember.toLowerCase()})))&&!o.e.IsEmpty(i[d.DisplayMember+"_Key"])&&(c=new Date(i[d.DisplayMember+"_Key"]).ToString("dd/MMM/yyyy")),(D=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})))?(D instanceof C.b||D instanceof p.a)&&(l=D.SelectedValue.toString()):(d=this.ScreenObject.ColumnSource.find((function(e){return"LISTBOX"==e.DataType.toUpperCase()&&"dcccnid51_key"==e.ValueMember.toLowerCase()})))&&!o.e.IsEmpty(i[d.ValueMember])&&(l=i[d.ValueMember].toString()),t==l&&e==c){if(this.ScreenObject.GridDataColumns.Contains("dcAlpha2_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[n].dcAlpha2_Key)&&(a=new Date(this.ScreenObject.GridData[n].dcAlpha2_Key),!o.e.IsEmpty(this.ScreenObject.GridData[u].dcAlpha2_Key)&&!o.e.IsEmpty(this.ScreenObject.GridData[u].dcAlpha3_Key)&&a>=new Date(this.ScreenObject.GridData[u].dcAlpha2_Key)&&a<new Date(this.ScreenObject.GridData[u].dcAlpha3_Key))){r=(u+1).toString();break}if(this.ScreenObject.GridDataColumns.Contains("dcAlpha3_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[n].dcAlpha3_Key)&&(a=new Date(this.ScreenObject.GridData[n].dcAlpha3_Key),!o.e.IsEmpty(this.ScreenObject.GridData[u].dcAlpha2_Key)&&!o.e.IsEmpty(this.ScreenObject.GridData[u].dcAlpha3_Key)&&a>new Date(this.ScreenObject.GridData[u].dcAlpha2_Key)&&a<new Date(this.ScreenObject.GridData[u].dcAlpha3_Key))){r=(u+1).toString();break}if(this.ScreenObject.GridDataColumns.Contains("dcAlpha2_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[u].dcAlpha2_Key)&&(a=new Date(this.ScreenObject.GridData[u].dcAlpha2_Key),!o.e.IsEmpty(this.ScreenObject.GridData[n].dcAlpha2_Key)&&!o.e.IsEmpty(this.ScreenObject.GridData[n].dcAlpha3_Key)&&a>=new Date(this.ScreenObject.GridData[n].dcAlpha2_Key)&&a<new Date(this.ScreenObject.GridData[n].dcAlpha3_Key))){r=(u+1).toString();break}if(this.ScreenObject.GridDataColumns.Contains("dcAlpha3_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[u].dcAlpha3_Key)&&(a=new Date(this.ScreenObject.GridData[u].dcAlpha3_Key),!o.e.IsEmpty(this.ScreenObject.GridData[n].dcAlpha2_Key)&&!o.e.IsEmpty(this.ScreenObject.GridData[n].dcAlpha3_Key)&&a>new Date(this.ScreenObject.GridData[n].dcAlpha2_Key)&&a<new Date(this.ScreenObject.GridData[n].dcAlpha3_Key))){r=(u+1).toString();break}}}var h="d.ta.DocumentType=67 and a.StatusID=369\nAND ISDATE(d.dcAlpha1)=1 AND ISDATE(d.dcAlpha2)=1 AND ISDATE(d.dcAlpha3)=1  \nAND a.DOCID<>"+this.ScreenObject.DocID+" AND b.dcCCNID51="+t+" \n--AND CONVERT(DATETIME,d.dcAlpha1)=CONVERT(DATETIME,'"+e+"') \nAND (\n( CONVERT(DATETIME,d.dcAlpha2) >= CONVERT(DATETIME,'"+new Date(this.ScreenObject.GridData[n].dcAlpha2_Key).ToString("dd/MMM/yyyy HH:mm:ss")+"') AND CONVERT(DATETIME,d.dcAlpha2) < CONVERT(DATETIME,'"+new Date(this.ScreenObject.GridData[n].dcAlpha3_Key).ToString("dd/MMM/yyyy HH:mm:ss")+"') ) OR\n( CONVERT(DATETIME,d.dcAlpha3) > CONVERT(DATETIME,'"+new Date(this.ScreenObject.GridData[n].dcAlpha2_Key).ToString("dd/MMM/yyyy HH:mm:ss")+"') AND CONVERT(DATETIME,d.dcAlpha3) < CONVERT(DATETIME,'"+new Date(this.ScreenObject.GridData[n].dcAlpha3_Key).ToString("dd/MMM/yyyy HH:mm:ss")+"') ) OR\n( CONVERT(DATETIME,'"+new Date(this.ScreenObject.GridData[n].dcAlpha2_Key).ToString("dd/MMM/yyyy HH:mm:ss")+"') >= CONVERT(DATETIME,d.dcAlpha2) AND CONVERT(DATETIME,'"+new Date(this.ScreenObject.GridData[n].dcAlpha2_Key).ToString("dd/MMM/yyyy HH:mm:ss")+"') < CONVERT(DATETIME,d.dcAlpha3)) OR\n( CONVERT(DATETIME,'"+new Date(this.ScreenObject.GridData[n].dcAlpha3_Key).ToString("dd/MMM/yyyy HH:mm:ss")+"') > CONVERT(DATETIME,d.dcAlpha2) AND CONVERT(DATETIME,'"+new Date(this.ScreenObject.GridData[n].dcAlpha3_Key).ToString("dd/MMM/yyyy HH:mm:ss")+"') < CONVERT(DATETIME,d.dcAlpha3))\n) ",S=s.a.common.GetDataSet("PAY007",JSON.stringify(h)).Tables[0];return null!=S&&S.length>0&&(r=S[0].VoucherNo.toString()),r}},{key:"LoadDailyAttendanceDocuments",value:function(){var e=this;this.ScreenObject.GridDataObj.Clear();var t="",n=o.e.GetEmptyDate(),a=o.e.GetEmptyDate(),i=o.e.GetEmptyDate(),r=o.e.GetEmptyDate(),c=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));if((null!=c&&null!=c&&c instanceof C.b||null!=c&&null!=c&&c instanceof p.a)&&(t=c.SelectedValue.toString()),""==t||0==parseInt(t))return this.DisplayMessage="Select any Employee",void(this.MessageVisibility=!0);var u=this.ScreenObject._TextFields.find((function(e){return"dcalpha10"==e.DBColumnName.toLowerCase()}));null!=u&&null!=u&&u instanceof S.c&&(o.e.IsEmpty(u.Date)||(n=new Date(u.Date)));var d=this.ScreenObject._TextFields.find((function(e){return"dcalpha11"==e.DBColumnName.toLowerCase()}));if(null!=d&&null!=d&&d instanceof S.c&&(o.e.IsEmpty(d.Date)||(a=new Date(d.Date))),1==n.getFullYear()||1==a.getFullYear())return this.DisplayMessage="Enter From / To Date.",void(this.MessageVisibility=!0);i=n,r=a;var D=this.CheckIsLateCheckInOrEarlyCheckOut(t),h="";if(null!=D&&D.length>0)for(var m=0;m<D.length;m++)h.length>0&&(h+=","),h+=D[m].sInvDocIDs;var b=this.ScreenObject.Data.Tables[0].filter((function(e){return"dcAlpha12"==e.SysColumnName}));h.length>0&&function(){var i=s.a.common.GetDataTable("DOC056",t+"~"+n.ToString("dd/MMM/yyyy")+"~"+a.ToString("dd/MMM/yyyy")+"~"+h);if(null!=i&&i.length>0){var r=null;e.ScreenObject.Data.Tables[0].filter((function(e){return"ProductID"==e.SysColumnName}));for(var o=function(t){r=e.ScreenObject.GridDataObj.NewRow(),r.dcAlpha1=i[t].VoucherNo,r.dcAlpha2=i[t].DocSeqNo,r.dcAlpha3=new Date(i[t].DailyAttDate).ToString(s.a.SessionManager.Preferences["Date Format"]),r.dcAlpha3_Key=new Date(i[t].DailyAttDate),r.dcAlpha4=new Date(i[t].StartTime).ToString("HH:mm"),r.dcAlpha4_Key=new Date(i[t].StartTime),r.dcAlpha5=new Date(i[t].EndTime).ToString("HH:mm"),r.dcAlpha5_Key=new Date(i[t].EndTime),r.dcCCNID73=i[t].ShiftName,r.dcCCNID73_Key=i[t].ShiftSeqNo,r.dcAlpha6=new Date(i[t].ShiftStartTime).ToString("HH:mm"),r.dcAlpha7=new Date(i[t].ShiftEndTime).ToString("HH:mm"),e.ScreenObject.Preferences.ContainsKey("SetUpdatedStartEndTimeToShiftTime")&&""!=e.ScreenObject.Preferences.SetUpdatedStartEndTimeToShiftTime&&Object(l.j)(e.ScreenObject.Preferences.SetUpdatedStartEndTimeToShiftTime)?(r.dcAlpha8=new Date(i[t].ShiftStartTime).ToString("HH:mm"),r.dcAlpha8_Key=new Date(i[t].ShiftStartTime),r.dcAlpha9=new Date(i[t].ShiftEndTime).ToString("HH:mm"),r.dcAlpha9_Key=new Date(i[t].ShiftEndTime)):(r.dcAlpha8=new Date(i[t].StartTime).ToString("HH:mm"),r.dcAlpha8_Key=new Date(i[t].StartTime),r.dcAlpha9=new Date(i[t].EndTime).ToString("HH:mm"),r.dcAlpha9_Key=new Date(i[t].EndTime)),null!=b&&b.length>0&&(r.dcAlpha12=b[0].UserDefaultValue);var n=D.filter((function(e){return e.sInvDocIDs==i[t].InvDocDetailsID}));if(null!=n&&n.length>0){for(var a="",o=0;o<n.length;o++)a.length>0&&(a+=","),a+=n[o].LateType.toString();r.dcAlpha13=a}e.FillDefaultProd(r,"dcAlpha1"),e.Celleditend(r,"dcAlpha1",0),e.ScreenObject.GridDataObj.addRow(r)},c=0;c<i.length;c++)o(c);e.RefreshGrid=!e.RefreshGrid}}();var y,g=s.a.common.GetDataTable("DOC060",t+"~"+i.ToString("dd MMM yyyy")+"~"+r.ToString("dd MMM yyyy")),f="";f+="  AND EmpSeqNo IN ("+t+")";var O=[];O.push(a.ToString("dd MMM yyyy")),O.push(f),O.push(0),O.push(s.a.SessionManager.RoleID),O.push(s.a.SessionManager.UserID),O.push(s.a.SessionManager.LanguageID);var I,T=s.a.common.GetDataSet_SP(O,"spPAY_GetEmpMasterCCDetails"),j=null;if(null!=T&&T.Tables.length>0){I=T.Tables[0];for(var P=function(e){var t=T.Columns[e];t.Contains("CCNID")&&!t.Contains("Name")&&I.forEach((function(e){e["dc"+t+"_Key"]=e[t]}))},A=0;A<T.Columns.length;A++)P(A);I.forEach((function(e){e.dcCCNID51_Key=e.EmpSeqNo})),j=I.filter((function(e){return e.EmpSeqNo==t}))}for(;i<=r;)if(null!=g&&g.length>0&&(null!=(y=g.filter((function(e){return e.FromDate>=i.ToString("dd MMM yyyy")&&e.ToDate<=i.ToString("dd MMM yyyy")||e.FromDate<=e.dtTempF.ToString("dd MMM yyyy")&&e.ToDate>=i.ToString("dd MMM yyyy")})))&&y.length>0))i=i.AddDays(1);else if(null!=j&&j.length>0&&(this.CheckEmployeeShift(t,i.ToString("dd MMM yyyy"),j[0]),null==this.objPayDayCheck&&(this.objPayDayCheck=new st.a(this.ScreenObject)),j[0].PayrollType="",this.objPayDayCheck.CheckIsHolidayDate(t,i.ToString("dd MMM yyyy"),j[0]),!o.e.IsEmpty(j[0].PayrollType)))i=i.AddDays(1);else{var M=null;this.ScreenObject.GridData.length;(M=this.ScreenObject.GridDataObj.NewRow()).dcAlpha1="",M.dcAlpha2="",M.dcAlpha3=i.ToString(s.a.SessionManager.Preferences["Date Format"]),M.dcAlpha3_Key=i.ToString("dd MMM yyyy"),M.dcAlpha4="00:00",M.dcAlpha5="00:00",M.dcCCNID73="",M.dcCCNID73_Key=1,M.dcAlpha6="00:00",M.dcAlpha7="00:00",M.dcAlpha8="00:00",M.dcAlpha8_Key="00:00",M.dcAlpha9="00:00",M.dcAlpha9_Key="00:00",M.dcAlpha13="Absent",null!=b&&b.length>0&&(M.dcAlpha12=b[0].UserDefaultValue),this.FillDefaultProd(M,"dcAlpha1"),this.Celleditend(M,"dcAlpha1",0),i=i.AddDays(1),this.ScreenObject.GridDataObj.addRow(M)}this.RefreshGrid=!this.RefreshGrid}},{key:"GetLOPLeaveDocuments",value:function(e,t,n){return s.a.common.GetDataSet3("PAY008",e.toString(),t.toString(),n.ToString("dd/MMM/yyyy"))}},{key:"FillEarningsDeductions",value:function(e,t){var n=this;try{var a,i,r;!function(){var c=[],u=[],d=n.ScreenObject.GetPayrollComponents(3,1,e,new Date(t));if(d.Tables.length>0){if((a=n.ScreenObject.ColumnSource.find((function(e){return"dcAlpha20"==e.ValueBinding})))&&d.Tables[1].length>0){for(var D=0;D<=d.Tables[1].length-1;D++)c.push(m.d.ComboBoxItems_2(d.Tables[1][D].NAME.toString(),d.Tables[1][D].NODEID.toString()));a.DisplayMember="Name",a.ValueMember="Value",a.ComboData=c}if((i=n.ScreenObject.ColumnSource.find((function(e){return"dcAlpha21"==e.ValueBinding})))&&d.Tables[0].length>0){for(var h=0;h<=d.Tables[0].length-1;h++)u.push(m.d.ComboBoxItems_2(d.Tables[0][h].NAME.toString(),d.Tables[0][h].NODEID.toString()));i.DisplayMember="Name",i.ValueMember="Value",i.ComboData=u}}var S=null,b=0,C=null;if(d.Tables.length>0&&d.Tables[1].length>0){S=null,n.ScreenObject.GridDataObj.Clear();for(var y=n.ScreenObject.Data.Tables[0].filter((function(e){return"ProductID"==e.SysColumnName})),p=0;p<d.Tables[1].length;p++)S=n.ScreenObject.GridDataObj.NewRow(),n.ScreenObject.GridDataObj.insertRowAt(S,b),b++,y.length>0&&!o.e.IsEmpty(y[0].UserDefaultValue)&&(S.ProductID_Key=y[0].UserDefaultValue),S.dcAlpha20=d.Tables[1][p].NODEID,C=d.Tables[1].filter((function(e){return e.NODEID==parseInt(S.dcAlpha20)})),S.dcAlpha21=C[0].PARENTID;n.ScreenObject.GridDataObj.refreshDataView(),n.RefreshGrid=!0}s.a.SessionManager.Preferences.ContainsKey("DonotConsiderVacationdaysasLeave")&&Object(l.j)("True"==s.a.SessionManager.Preferences.DonotConsiderVacationdaysasLeave)?(r=n.ScreenObject._TextFields.find((function(e){return"dcalpha17"==e.DBColumnName.toLowerCase()})))instanceof m.e&&!o.e.IsEmpty(r.SelectedValue)&&(r.SelectedValue="Yes"):(r=n.ScreenObject._TextFields.find((function(e){return"dcalpha17"==e.DBColumnName.toLowerCase()})))instanceof m.e&&!o.e.IsEmpty(r.SelectedValue)&&(r.SelectedValue="No")}()}catch(c){this.DisplayMessage="Load Error",Logger.ErrorLog("AddEditDocumentViewModel:: FillEarningsDeductions"+c.stack)}}},{key:"FillVacationManagementComponents",value:function(){Logger.InfoLog("AddEditDocumentViewModel::Entering FillVacationManagementComponents");try{var e=[],t=this.ScreenObject.GetPayrollComponents(4,1,0,this.DocumentDate);if(t.Tables.length>0){var n=this.ScreenObject.ColumnSource.find((function(e){return"dcAlpha17"==e.ValueBinding}));if(n&&t.Tables[0].length>0){for(var a=0;a<=t.Tables[0].length-1;a++)e.push(m.d.ComboBoxItems_2(t.Tables[0][a].NAME.toString(),t.Tables[0][a].NODEID.toString()));n.DisplayMember="Name",n.ValueMember="Value",n.ComboData=e}}}catch(i){this.DisplayMessage="Load Error",Logger.ErrorLog("AddEditDocumentViewModel:: FillVacationManagementComponents"+i.stack)}}},{key:"FillForm12BALookupDetails",value:function(){Logger.InfoLog("AddEditDocumentViewModel::Entering FillForm12BALookupDetails");try{var e=[],t=null,n=0,a=0,i=this.ScreenObject.GetPayrollComponents(5,0,0,this.DocumentDate);if(i.Tables.length>0&&i.Tables[0].length>0){a=i.Tables[0].length,a+=1;var r=i.Tables[0].NewRow();r.NAME="Total Value of Perquisites",r.NODEID=a,i.Tables[0].Rows.push(r),a+=1,(r=i.Tables[0].NewRow()).NAME="Total Value of Profits in lieu of salary as per section 17(3)",r.NODEID=a,i.Tables[0].Rows.push(r);var s=this.ScreenObject.ColumnSource.find((function(e){return"dcAlpha2"==e.ValueBinding}));if(s){for(var c=0;c<=i.Tables[0].length-1;c++)e.push(m.d.ComboBoxItems_2(i.Tables[0][c].NAME.toString(),i.Tables[0][c].NODEID.toString()));s.DisplayMember="Name",s.ValueMember="Value",s.ComboData=e}t=null,this.ScreenObject.GridDataObj.Clear();for(var l=this.ScreenObject.Data.Tables[0].filter((function(e){return"ProductID"==e.SysColumnName})),u=0;u<i.Tables[0].length;u++)t=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridDataObj.insertRowAt(t,n),n++,l.length>0&&!o.e.IsEmpty(l[0].UserDefaultValue)&&(t.ProductID_Key=l[0].UserDefaultValue),t.dcAlpha2=i.Tables[0][u].NODEID,t.dcAlpha3="Total Value of Perquisites"==i.Tables[0][u].NAME.toString()?-1:"Total Value of Profits in lieu of salary as per section 17(3)"==i.Tables[0][u].NAME.toString()?-2:0;this.ScreenObject.GridDataObj.refreshDataView()}this.ScreenObject.GridDataObj.CanUserAddRows=!1,this.ScreenObject.GridDataObj.CanUserDeleteRows=!1}catch(d){this.DisplayMessage="Load Error",Logger.ErrorLog("AddEditDocumentViewModel:: FillForm12BALookupDetails"+d.stack)}}},{key:"GetITSlabValidation",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n="",a=null;0==e?a=t.Table.Copy():1==e&&(a=this.ScreenObject.GridData.Copy()),a.sort((function(e,t){return t.dcAlpha8-e.dcAlpha8}));for(var i=1;i<a.length-1;i++)if(null!=a[i].dcAlpha8&&null!=a[i].dcNum1&&null!=a[i].dcNum2){if(a[i].dcAlpha8.toString()==a[i-1].dcAlpha8.toString()&&parseFloat(a[i].dcNum1)<=parseFloat(a[i-1].dcNum2)){n="From Slab should be greater than To Slab for gender '"+a[i].dcAlpha8.toString()+"'\r\n";break}if(a[i].dcAlpha8.toString()==a[i].dcAlpha8.toString()&&parseFloat(a[i].dcNum2)<=parseFloat(a[i].dcNum1)){n="To Slab should be greater than From Slab for gender '"+a[i].dcAlpha8.toString()+"'\r\n";break}}return n}},{key:"FillGratuitySettingsExpDetails",value:function(){Logger.InfoLog("AddEditDocumentViewModel::Entering FillGratuitySettingsExpDetails");try{var e=[],t=[],n=null,a=0,i=this.ScreenObject.GetPayrollComponents(6,0,0,this.DocumentDate);if(i.Tables.length>0&&i.Tables[0].length>0){var r=this.ScreenObject.ColumnSource.find((function(e){return"dcAlpha5"==e.ValueBinding}));if(r){for(var s=0;s<=i.Tables[0].length-1;s++)e.push(m.d.ComboBoxItems_2(i.Tables[0][s].NAME.toString(),i.Tables[0][s].NODEID.toString()));r.DisplayMember="Name",r.ValueMember="Value",r.ComboData=e}if(r=this.ScreenObject.ColumnSource.find((function(e){return"dcAlpha9"==e.ValueBinding}))){for(var c=0;c<=i.Tables[0].length-1;c++)t.push(m.d.ComboBoxItems_2(i.Tables[0][c].NAME.toString(),i.Tables[0][c].NODEID.toString()));r.DisplayMember="Name",r.ValueMember="Value",r.ComboData=t}n=null,this.ScreenObject.GridDataObj.Clear();for(var l=this.ScreenObject.Data.Tables[0].filter((function(e){return"ProductID"==e.SysColumnName})),u=0;u<i.Tables[0].length;u++)n=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridDataObj.insertRowAt(n,a),a++,l.length>0&&!o.e.IsEmpty(l[0].UserDefaultValue)&&(n.ProductID_Key=l[0].UserDefaultValue),n.dcAlpha5=i.Tables[0][u].NODEID,n.dcAlpha6=0,n.dcAlpha9=i.Tables[0][u].NODEID,n.dcAlpha10=0;this.ScreenObject.GridDataObj.refreshDataView()}this.ScreenObject.GridDataObj.CanUserAddRows=!1,this.ScreenObject.GridDataObj.CanUserDeleteRows=!1}catch(d){this.DisplayMessage="Load Error",Logger.ErrorLog("AddEditDocumentViewModel:: FillGratuitySettingsExpDetails"+d.stack)}}},{key:"FillTdsMonthlyandQuarterlyDetails",value:function(e,t,n,a){try{var i=null,r=0,c=new Date(a,s.a.SessionManager.AccountingFromMonth-1,1),l=this.ScreenObject.GetTDSMonthlyandQuarterlyDetails(n,a,c);if(l.Tables.length>0&&l.Tables[0].length>0){i=null,this.ScreenObject.GridDataObj.Clear();for(var u=this.ScreenObject.Data.Tables[0].filter((function(e){return"ProductID"==e.SysColumnName})),d=0;d<l.Tables[0].length;d++)i=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridDataObj.insertRowAt(i,r),r++,u.length>0&&!o.e.IsEmpty(u[0].UserDefaultValue)&&(i.ProductID_Key=u[0].UserDefaultValue),i.dcAlpha2=l.Tables[0][d].TDSTYPE,parseInt(l.Tables[0][d].QUARTERNO)>0?(i.dcAlpha3=new Date(l.Tables[0][d].PayrollDate).ToString("MMM'-'yyyy"),i.dcNum5=parseFloat(l.Tables[0][d].AMOUNT),i.dcNum6=0):(i.dcAlpha3=l.Tables[0][d].MONTHTEXT,i.dcNum6=parseFloat(l.Tables[0][d].AMOUNT),i.dcNum5=0),i.dcAlpha10=l.Tables[0][d].QUARTERNO,i.dcNum1=parseFloat(l.Tables[0][d].TDS),i.dcNum2=parseFloat(l.Tables[0][d].SURCHARGE),i.dcNum3=parseFloat(l.Tables[0][d].EDUCATIONCESS),i.dcNum4=parseFloat(l.Tables[0][d].SECANDHIGHEDUCESS)}}catch(D){this.DisplayMessage="Load Error",Logger.ErrorLog("AddEditDocumentViewModel:: FillTdsMonthlyandQuarterlyDetails"+D.stack)}}},{key:"FilterEmployees",value:function(){var e="";try{Logger.InfoLog("AddEditDocumentViewModel::Entering FilterEmployees()"),e=69==this.DocumentType?" ( a.StatusID=250) ":" ( a.StatusID=250 AND DATEDIFF(DAY,GETDATE(),ISNULL(CONVERT(DATETIME,a.DORelieve),'01-Jan-9000'))>=0) ",s.a.SessionManager.LocationID>0&&s.a.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&s.a.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(e=e+" AND a.NodeID IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+s.a.SessionManager.LocationID+")"),67==this.DocumentType&&(o.e.IsEmpty(s.a.SessionManager.sWHEmpFilteredEmpSeqNos)||(e+=" AND ( a.NodeID IN ("+s.a.SessionManager.sWHEmpFilteredEmpSeqNos+"))")),Logger.InfoLog("AddEditDocumentViewModel::Exiting FilterEmployees()")}catch(t){Logger.ErrorLog("AddEditDocumentViewModel::EXCEPTION FilterEmployees()"+t.stack)}return e}},{key:"FilterLeaveTypes",value:function(e){var t="";try{0==e?(t=" ( a.ParentID=5 and Convert(Varchar,a.NodeId)  NOT IN (Select Isnull(TD.dcAlpha1,'0') From Com_DocTextData TD with(nolock),Inv_DocDetails ID with(nolock) Where ID.InvDocDetailsID=TD.InvDocDetailsID And ID.CostCenterID=40061)) ",s.a.SessionManager.IsEmpUser&&(t+=" AND (a.NodeID in (Select ComponentID from Com_CC50054  with(nolock) where  GradeID=1 AND Type=4 and ShowInESS='Yes' And Convert(Datetime,Payrolldate)=(Select Max(Convert(Datetime,Payrolldate)) from Com_CC50054 with(nolock) WHERE GradeID=1)))")):1==e?t=" ( a.ParentID=5 and a.NodeId  NOT IN (Select Isnull(CC.dcCCnid52,'0') From Com_DocCCData CC with(nolock),Inv_DocDetails ID with(nolock) Where ID.InvDocDetailsID=CC.InvDocDetailsID And ID.CostCenterID IN(40060,40081))) ":2==e?t=" 1=1\n                AND\n                (\n                a.NodeID IN(Select ComponentID FROM COM_CC50054 \n                WHERE GradeID=1 AND TYPE=4 \n                AND PayrollDate=(SELECT MAX(PayrollDate) FROM COM_CC50054 )\n                AND LeaveOthFeatures LIKE '%#REJOIN#%' )\n                OR a.NodeID IN(Select DISTINCT CONVERT(INT,Isnull(TD.dcAlpha1,'0')) From Com_DocTextData TD with(nolock),Inv_DocDetails ID with(nolock) \n                Where TD.tCostCenterID=40061 AND ISNUMERIC(TD.dcAlpha1)=1 AND ID.InvDocDetailsID=TD.InvDocDetailsID )\n                )":3==e&&(t=s.a.SessionManager.Preferences.ContainsKey("ConsiderLOPBasedOn")&&""!=s.a.SessionManager.Preferences.ConsiderLOPBasedOn.toString()?" 1=1 AND ( a.NodeID IN("+s.a.SessionManager.Preferences.ConsiderLOPBasedOn.toString()+") )":" 1<>1 ")}catch(n){Logger.ErrorLog("AddEditDocumentViewModel::EXCEPTION FilterLeaveTypes()"+n.stack)}return t}},{key:"PopupEmployeesFilter",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(null!=this.srcDocument&&("Biometric"==this.srcDocument.toString()||"PostAttTimeSheet"==this.srcDocument.toString()))return"";var a=e.split("~")[1];e=e.split("~")[0],this.strWhere="",this.sFilter="",this.sNodes="";try{67==this.ScreenObject.DocumentType&&s.a.SessionManager.Preferences.ContainsKey("DailyAttendanceFilter")&&parseInt(s.a.SessionManager.Preferences.DailyAttendanceFilter)>0?(null==this.oEmpFilter?this.oEmpFilter=new _t.a("",0,5):(this.oEmpFilter.CostCenterFilters.length>0?this.oEmpFilter.CostCenters.SelectedValue=this.oEmpFilter.CostCenterFilters[0].CostCenterID.toString():(this.oEmpFilter.Filter=5,this.oEmpFilter.InitControls()),this.oEmpFilter.CostCenters.Enable=!0),s.a.page.ShowDialog(this.oEmpFilter,Kt.a,{ShowCenter:!0,HideHeader:!0}).subscribe((function(){t.empFilterTemp(),t.PopupEmpFilterCallBack(n,e)}))):85==this.ScreenObject.DocumentType?(null==this.oEmpFilter?this.oEmpFilter=new _t.a("",0,85):(this.oEmpFilter.CostCenterFilters.length>0?this.oEmpFilter.CostCenters.SelectedValue=this.oEmpFilter.CostCenterFilters[0].CostCenterID.toString():(this.oEmpFilter.Filter=85,this.oEmpFilter.InitControls()),this.oEmpFilter.CostCenters.Enable=!0),s.a.page.ShowDialog(this.oEmpFilter,Kt.a,{ShowCenter:!0,HideHeader:!0}).subscribe((function(){t.empFilterTemp(),t.PopupEmpFilterCallBack(n,e)}))):null==this.oEmpFilter?this.oEmpFilter=new _t.a("",0,81==this.ScreenObject.DocumentType&&"GradeWise"==e.toString()?6:7):(81!=this.ScreenObject.DocumentType||"GradeWise"!=e.toString()&&"GradeWiseCopy"!=e.toString()?81==this.ScreenObject.DocumentType&&"EmployeeWise"==e.toString()&&(this.oEmpFilter.Filter=7):this.oEmpFilter.Filter=6,this.oEmpFilter.InitControls()),81==this.ScreenObject.DocumentType&&(this.oEmpFilter.CostCenters.Enable=!1,"GradeWiseCopy"!=e.toString()&&s.a.page.ShowDialog(this.oEmpFilter,Kt.a,{ShowCenter:!0,HideHeader:!0}).subscribe((function(){t.empFilterTemp(),t.PopupEmpFilterCallBack(n,e+"~"+a)}))),Logger.InfoLog("AddEditDocumentViewModel::Exiting PopupEmployeesFilter()")}catch(i){Logger.ErrorLog("AddEditDocumentViewModel::EXCEPTION PopupEmployeesFilter()"+i.stack)}return this.strWhere}},{key:"empFilterTemp",value:function(){var e=this;this.DialogResult=this.oEmpFilter.IsCompleted,this.oEmpFilter.IsCompleted&&(this.oEmpFilter.CostCenterFilters.length>0?function(){for(var t=1,n="",i="",r="",c=0;c<e.oEmpFilter.CostCenterFilters.length;c++){var l=e.oEmpFilter.CostCenterFilters[c];if(l.CostCenterID>5e4&&(t=2,n="NodeID",i=50051==l.CostCenterID?"EmpSeqNo":"CCNID"+(l.CostCenterID-5e4)),l.SelectedNodes.length>0){if(1==l.SelectedNodes.length)r+=" AND ",r+=i+"="+l.SelectedNodes[0].Id;else if(!l.SelectedNodes.find((function(e){return e.Id==t&&e.IsGroup})))if(r+=" AND ",ft.IPrefetchFilter.IsGroupTree(l)){for(var u="",d=0;d<l.SelectedNodes.length;d++)null!=l.SelectedNodes[d].Parent&&l.SelectedNodes[d].Parent.IsSelected||(u.length>0&&(u+=","),u+=l.SelectedNodes[d].Id);0==u.length&&(u+=-12912),r+=i+" IN ",r+=" (select T."+n+" GTID from "+a.GetTagTableName(l.CostCenterID)+" T with(nolock),"+a.GetTagTableName(l.CostCenterID)+" GTP with(nolock) where T.lft BETWEEN GTP.lft AND GTP.rgt AND GTP."+n+" IN (",r+=u.toString()+")  group by T."+n+")"}else{r+=i+" IN (";for(var D=0;D<l.SelectedNodes.length;D++)D>0&&(r+=","),r+=l.SelectedNodes[D].Id;r+=")"}}else l.DeleteButtonVisibility||(r+=" AND ",r+=i+"=-12912")}e.sFilter=r.toString(),e.sFilter+=" AND ( CONVERT(DATETIME,EMP.DOJ) <='"+s.a.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")+"' AND CONVERT(DATETIME,EMP.DORelieve) >='"+s.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"' ) ",s.a.SessionManager.Preferences.ContainsKey("NPDontAllowPayrollProcessing")&&"True"==s.a.SessionManager.Preferences.NPDontAllowPayrollProcessing&&(e.sFilter+=" AND EmpSeqNo NOT IN ( Select NodeID From COM_CC50051 WITH(NOLOCK) Where ResignStatus='Posted' AND DateDiff(day,ISNULL(CONVERT(DATETIME,DORelieve),'01-Jan-9000'),'"+s.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')<=0 AND DateDiff(day,CONVERT(DATETIME,CONVERT(DATETIME,('01-'+CONVERT(NVARCHAR(3),DATENAME(MONTH,ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000')))+'-'+CONVERT(NVARCHAR,YEAR(ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000'))))) ),'"+s.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')>=0 )"),s.a.SessionManager.LocationID>0&&s.a.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&s.a.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(e.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+s.a.SessionManager.LocationID+")"),o.e.IsEmpty(s.a.SessionManager.sWHEmpFilteredEmpSeqNos)||(e.sFilter+="  AND EmpSeqNo IN ("+s.a.SessionManager.sWHEmpFilteredEmpSeqNos+")");var h=[];if(h.push(s.a.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")),h.push(e.sFilter),h.push(0),h.push(s.a.SessionManager.RoleID),h.push(s.a.SessionManager.UserID),h.push(s.a.SessionManager.LanguageID),e.dsData=s.a.common.GetDataSet_SP(h,"spPAY_GetEmpMasterCCDetails"),e.dsData.Tables.length>0)if(e.dsData.Tables[0].length>0){for(var S=0;S<e.dsData.Tables[0].length;S++)e.sNodes=e.sNodes+e.dsData.Tables[0][S].EmpSeqNo.toString()+",";""!=e.sNodes&&(e.sNodes=e.sNodes.substr(0,e.sNodes.length-1),e.strWhere=" ( a.NodeId IN ("+e.sNodes+"))")}else e.strWhere=" ( a.NodeId = 0)"}():81==this.ScreenObject.DocumentType?this.strWhere="":this.oEmpFilter.Filter>0&&(this.strWhere=this.FilterEmployees()))}},{key:"DailyAttendanceFilterTemp",value:function(){this.strEmpFilter=this.strWhere;var e=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));if(e&&e instanceof C.b)e.CustomWhere=this.strEmpFilter;else if(e&&e instanceof p.a)e.Code.CustomWhere=e.Name.CustomWhere=this.strEmpFilter;else if((e=this.ScreenObject._TextFields.find((function(e){return"dcalpha5"==e.DBColumnName.toLowerCase()})))&&e instanceof C.b&&50051==e.CCID)e.CustomWhere=this.strEmpFilter;else if(e&&e instanceof p.a&&50051==e.CCID)e.Name.CustomWhere=e.Code.CustomWhere=this.strEmpFilter;else{var t=this.ScreenObject.ColumnSource.find((function(e){return 50051==e.CostCenterID&&"dcCCNID51"==e.DisplayMember}));t&&t instanceof f.a&&(t.FilterCondition=this.strEmpFilter),this.ScreenObject.GridDataColumns.Contains("dcCCNID51Code")&&((t=this.ScreenObject.ColumnSource.find((function(e){return"dcccnid51code"==e.DisplayMember.toLowerCase()})))&&t instanceof f.a&&(t.FilterCondition=this.strEmpFilter))}this.ScreenObject.ColumnSource.sort((function(e,t){return e.DisplayIndex-t.DisplayIndex})),this.ScreenObject.GridDataObj.RefreshColumns()}},{key:"LoadGradeDataTemp",value:function(e,t){var n,a=this,i=t.split("~")[0],r=new Date(t.split("~")[1]);n=[];var c,l=[],u=[],d=this.ScreenObject.ColumnSource.find((function(e){return 50051==e.CostCenterID})),D=this.ScreenObject.ColumnSource.find((function(e){return 50053==e.CostCenterID}));if(0==e.trim().length&&(e=" 1=1 "),s.a.SessionManager.LocationID>0&&s.a.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&s.a.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(e+=" AND a.NodeID IN ( Select 1 as NodeID UNION ALL Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+s.a.SessionManager.LocationID+")"),o.e.IsEmpty(s.a.SessionManager.sWHEmpFilteredEmpSeqNos)||(e+=" AND ( a.NodeID IN ("+s.a.SessionManager.sWHEmpFilteredEmpSeqNos+"))"),u.push("GradeWise"),u.push(e),u.push(new Date(r.ToString("dd/MMM/yyyy"))),u.push(s.a.SessionManager.UserID),u.push(s.a.SessionManager.LanguageID),null!=(c=s.a.empService.GetAssignLeaves(u))&&c.Tables.length>0&&c.Tables[0].length>0&&!c.Columns[0].Contains("ErrorMessage")){for(var h=c.Tables[0],S=function(e){var t=a.ScreenObject._CCFields[e];if(t instanceof C.b&&50002==t.CCID&&t.SelectedValue>0)return l=c.Tables[0],h=l.filter((function(e){return 0==e.Location||e.Location==t.SelectedValue})),"break"},m=0;m<this.ScreenObject._CCFields.length;m++){if("break"===S(m))break}if(n=h,"GradeWise"==i?(d&&d instanceof f.a&&(d.IsVisible=!1),D&&D instanceof f.a&&(D.IsVisible=!0),(n=h.filter((function(e){return 1!=e.dcCCNID51_Key}))).sort((function(e,t){return e.dcCCNID51_Key>t.dcCCNID51_Key||e.dcCCNID51_Key==t.dcCCNID51_Key&&e.dcCCNID52_Key>t.dcCCNID52_Key?1:-1})),this.dtData=n.Copy(),(n=h.filter((function(e){return 1==e.dcCCNID51_Key}))).sort((function(e,t){return e.dcCCNID53_Key>t.dcCCNID53_Key||e.dcCCNID53_Key==t.dcCCNID53_Key&&e.dcCCNID52_Key>t.dcCCNID52_Key?1:-1})),n=n.Copy()):"EmployeeWise"==i&&(d&&d instanceof f.a&&(d.IsVisible=!0),D&&D instanceof f.a&&(D.IsVisible=!1),(n=h.filter((function(e){return 1==e.dcCCNID51_Key}))).sort((function(e,t){return e.dcCCNID53_Key>t.dcCCNID53_Key||e.dcCCNID53_Key==t.dcCCNID53_Key&&e.dcCCNID52_Key>t.dcCCNID52_Key?1:-1})),this.dtData=n.Copy(),(n=h.filter((function(e){return 1!=e.dcCCNID51_Key}))).sort((function(e,t){return e.dcCCNID51_Key>t.dcCCNID51_Key||e.dcCCNID51_Key==t.dcCCNID51_Key&&e.dcCCNID52_Key>t.dcCCNID52_Key?1:-1})),n=n.Copy()),this.ScreenObject.GridDataObj.Clear(),this.ScreenObject.GridDataObj.ClearFilters(),n.length>0)for(var b=0;b<n.length;b++){var y=this.ScreenObject.GridDataObj.NewRow();this.ScreenObject.GridData.InsertAt(y,b),y.ProductID_Key=parseInt(s.a.SessionManager.Preferences.PayrollProduct),y.dcCCNID51_Key=n[b].dcCCNID51_Key.toString(),y.dcCCNID52_Key=n[b].dcCCNID52_Key.toString(),y.dcCCNID53_Key=n[b].dcCCNID53_Key.toString(),y.dcNum3=0}else for(var p=0;p<12;p++){var g=this.ScreenObject.GridDataObj.NewRow();g.DocSeqNo=this.ScreenObject.GridData.length+1,g.DocDetailsID=0,this.ScreenObject.GridData.push(g)}Logger.InfoLog("AssignLeavesViewModel::End Binding Grade data to grid")}this.ScreenObject.GridDataObj.refreshDataView(),this.ScreenObject.UpdateSequence(),this.RefreshGrid=!0,this.ScreenObject.GridDataObj.RefreshColumns()}},{key:"PopupEmpFilterCallBack",value:function(e,t){if("DailyAttendanceFilter"==e)this.DailyAttendanceFilterTemp();else if("SetNewDocFields"==e){var n=this.strEmpFilter=this.strWhere;o.e.IsEmpty(n)&&(n=this.FilterEmployees()),this.SetNewDocFieldsTemp(n)}else if("LoadGradeData"==e){var a=this.strEmpFilter=this.strWhere;this.LoadGradeDataTemp(a,t)}}},{key:"IsLeaveTypeValid",value:function(e,t,n,a){a.IfFormulaExistsNoOfDays=!1;this.strValidationMessage="";try{var i,r=null;if((r=this.ScreenObject.GetEmployeePayrollInfo(e,0,this.DocumentDate,0)).Tables.length>0&&r.Tables[1].length>0){if((i=r.Tables[1].filter((function(e){return 4==e.Type&&e.LeaveOthFeatures.Contains("%#REJOIN#%")}))).length>0)for(var c=0;c<i.length;c++){var l=s.a.common.GetDataSet3("PAY010",e.toString(),i[c].ComponentID.toString()).Tables[0];if(null!=l&&l.length>0)return this.strValidationMessage="Please enter Rejoining date of this Employee to the Leave Type : "+i[c].ComponentName.toString(),this.strValidationMessage}if(62==this.DocumentType){var u=new dt.b;u.sEmpSeqNo=e.toString();var d={PayrollMonth:u.PayrollMonth,PayrollMonthStart:u.PayrollMonthStart,PayrollMonthEnd:u.PayrollMonthEnd};o.e.SetPayrollDate(this.DocumentDate,d),u.PayrollMonth=d.PayrollMonth,u.PayrollMonthStart=d.PayrollMonthStart,u.PayrollMonthEnd=d.PayrollMonthEnd,u.arrLstCPFields[6].Clear(),r.Tables[2].filter((function(e){return 4==e.Type&&""!=o.e.String(e.formula)&&e.ComponentID==t}));var D=new dt.a;if(i.length>0){for(var h=0;h<i.length;h++)D.ComponentName=i[h].LeaveErrorMessage.toString(),D.SNo=parseInt(i[h].SNo.toString()),D.Formula=i[h].Formula.toString(),u.arrLstCPFields[6].push(D);u.Intialize(),u.ExecuteAllFormulas();var S=this.DocumentDate;u.fldDict.ContainsKey("LeaveFromDate")&&(o.e.IsEmpty(n.dcAlpha4_Key)?u.fldDict.LeaveFromDate.setFieldValue(this.DocumentDate):(u.fldDict.LeaveFromDate.setFieldValue(new Date(n.dcAlpha4_Key)),S=new Date(n.dcAlpha4_Key))),u.fldDict.ContainsKey("LeaveNoOfDays")&&(o.e.IsEmpty(n.dcAlpha7)?u.fldDict.LeaveNoOfDays.setFieldValue(0):u.fldDict.LeaveNoOfDays.setFieldValue(n.dcAlpha7.toString()));for(var m=u.fldDict,b=0;b<u.arrLstCPFields[6].length;b++){for(var C=0;C<u.arrLstCPFields[5].length;C++)if(null!=u.arrLstCPFields[6][b].Formula&&u.arrLstCPFields[6][b].Formula.Contains(u.arrLstCPFields[5][C].ComponentName+"_Bal")&&u.fldDict.ContainsKey(u.arrLstCPFields[5][C].ComponentName+"_Bal")){var y=s.a.common.GetDataSet3("PAY044",u.sEmpSeqNo.toString(),u.arrLstCPFields[5][C].ComponentID,S.ToString("dd/MMM/yyyy"));null!=y&&y.length>0&&u.fldDict[u.arrLstCPFields[5][C].ComponentName+"_Bal"].setFieldValue(y[0].AvailableLeaves.toString())}null!=u.arrLstCPFields[6][b].Formula&&(u.arrLstCPFields[6][b].Formula.Contains("LeaveFromDate")||u.arrLstCPFields[6][b].Formula.Contains("LeaveNoOfDays"))&&(a.IfFormulaExistsNoOfDays=!0),"0"==o.e.String(u.eval.EvaluateExpression(u.arrLstCPFields[6][b].Formula.toString(),m))&&(this.strValidationMessage=u.arrLstCPFields[6][b].ComponentName.toString());break}}else this.strValidationMessage=""}}else this.strValidationMessage="Please check the payroll structure";Logger.InfoLog("AddEditDocumentViewModel::Exiting IsLeaveTypeValid()")}catch(p){Logger.ErrorLog("AddEditDocumentViewModel::EXCEPTION IsLeaveTypeValid()"+p.stack)}return this.strValidationMessage}},{key:"IsDateValid",value:function(e,t){try{Logger.InfoLog("AddEditDocumentViewModel::Entering IsDateValid()");var n,a=0,i=Date.Today();this.strValidationMessage="";var r=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));r&&r instanceof C.b||r&&r instanceof p.a||(r=this.ScreenObject._TextFields.find((function(e){return"dcalpha5"==e.DBColumnName.toLowerCase()})))&&r instanceof C.b&&50051==r.CCID||r&&r instanceof p.a&&50051==r.CCID?a=r.SelectedValue:(s=this.ScreenObject.ColumnSource.find((function(e){return 50051==e.CostCenterID})))instanceof f.a&&!o.e.IsEmpty(e[s.ValueMember])&&(a=parseInt(e[s.ValueMember]));var s,c="";40055!=this.ScreenObject.CostCenterID||"dcalpha1"!=t.toLowerCase()||o.e.IsEmpty(e.dcAlpha1)?40056==this.ScreenObject.CostCenterID?c="dcalpha5":40057!=this.ScreenObject.CostCenterID||"dcalpha5"!=t.toLowerCase()||o.e.IsEmpty(e.dcAlpha5)?40057!=this.ScreenObject.CostCenterID||"dcalpha4"!=t.toLowerCase()||o.e.IsEmpty(e.dcAlpha4)?40069==this.ScreenObject.CostCenterID&&(c=t.toLowerCase()):c="dcalpha4":c="dcalpha5":c="dcalpha1",(r=this.ScreenObject._TextFields.find((function(e){return e.DBColumnName.toLowerCase()==c})))instanceof S.c?i=new Date(r.Date):(s=this.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember.toLowerCase()==c})))instanceof f.a&&(i=new Date(e[s.DisplayMember+"_key"])),(n=this.ScreenObject.GetEmployeePayrollInfo(a,3,i,0)).Tables.length>0&&n.Tables[0].length>0&&(this.strValidationMessage=o.e.String(n.Tables[0][0][0])),Logger.InfoLog("AddEditDocumentViewModel::Exiting IsDateValid()")}catch(l){Logger.ErrorLog("AddEditDocumentViewModel::EXCEPTION IsDateValid()"+l.stack)}return this.strValidationMessage}},{key:"IsDocumentLocked",value:function(e,t,n){try{var a=0,i=Date.Today();this.strValidationMessage="";var r=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));if(r&&r instanceof C.b)a=r.SelectedValue;else if(r&&r instanceof p.a)a=r.SelectedValue;else if((r=this.ScreenObject._TextFields.find((function(e){return"dcalpha5"==e.DBColumnName.toLowerCase()})))&&r instanceof C.b&&50051==r.CCID)a=r.SelectedValue;else if(r&&r instanceof p.a&&50051==r.CCID)a=r.SelectedValue;else{var s;null!=(s=this.ScreenObject.ColumnSource.find((function(e){return 50051==e.CostCenterID})))&&s instanceof f.a&&(a=parseInt(e[s.ValueMember]))}if((r=this.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()})))instanceof S.c?i=new Date(r.Date):null!=(s=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha1"==e.DisplayMember.toLowerCase()})))&&s instanceof f.a&&(i=o.e.IsEmpty(e[s.DisplayMember+"_key"])?Date.Today():new Date(e[s.DisplayMember+"_key"])),this.dsData=this.ScreenObject.GetEmpDimensionDetails(a,t,i),this.dsData.Tables.length>0&&this.dsData.Tables[0].length>0){this.strValidationMessage="Payroll Month Locked",e.dcAlpha2=e.dcAlpha2_Key=e.dcAlpha3=e.dcAlpha3_Key="";for(var c=1;c<16;c++)e["dcNum"+c]=0;this.ScreenObject.GridDataObj.updateRow(e)}Logger.InfoLog("AddEditDocumentViewModel::Exiting IsDocumentLocked()")}catch(l){Logger.ErrorLog("AddEditDocumentViewModel::EXCEPTION IsDocumentLocked()"+l.stack)}return this.strValidationMessage}},{key:"OnYearSelected",value:function(e){try{Logger.InfoLog("AddEditDocumentViewModel::Entering OnYearSelected()");var t=this.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()}));if(null!=t&&t instanceof m.e&&!o.e.IsEmpty(t.SelectedValue)&&(this.LoadLeaveyearDates(parseInt(t.SelectedValue)),null!=(t=this.ScreenObject._TextFields.find((function(e){return"dcalpha3"==e.DBColumnName.toLowerCase()})))&&t instanceof S.c&&t.Date)){var n=this.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()}));null!=n&&n instanceof m.e&&!o.e.IsEmpty(n.SelectedValue)&&(this.IsNewAssignLeave?this.LoadGradeDataNew(0,new Date(t.Date),n.SelectedValue.toString(),null):this.LoadGradeData(0,new Date(t.Date),n.SelectedValue.toString()))}Logger.InfoLog("AddEditDocumentViewModel::Exiting OnYearSelected()")}catch(a){Logger.ErrorLog("AddEditDocumentViewModel::EXCEPTION OnYearSelected()"+a.stack)}}},{key:"LeavesBasedon",value:function(e){var t="",n=this.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()}));if(null!=n&&n instanceof m.e&&!o.e.IsEmpty(n.SelectedValue)&&(t=n.SelectedValue),!o.e.IsEmpty(t)){var a=this.ScreenObject._TextFields.find((function(e){return"dcalpha3"==e.DBColumnName.toLowerCase()}));null!=a&&a instanceof S.c&&a.Date?this.IsNewAssignLeave?this.LoadGradeDataNew(this.DocID>0?1:0,new Date(a.Date),t,null):this.LoadGradeData(this.DocID>0?1:0,new Date(a.Date),t):this.IsNewAssignLeave?this.LoadGradeDataNew(this.DocID>0?1:0,new Date,t,null):this.LoadGradeData(this.DocID>0?1:0,new Date,t)}}},{key:"FillComponent",value:function(e){for(var t=this.ScreenObject.ColumnSource.length-1;t>=0;t--)null==this.ScreenObject.ColumnSource[t].DisplayMember||""==this.ScreenObject.ColumnSource[t].DisplayMember||"dcCCNID52"!=this.ScreenObject.ColumnSource[t].DisplayMember&&"LeaveComp"!=this.ScreenObject.ColumnSource[t].DrRefColName||("dcCCNID52"==this.ScreenObject.ColumnSource[t].DisplayMember?(this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.ColumnSource[t].DisplayMember)&&this.ScreenObject.GridDataColumns.Remove(this.ScreenObject.ColumnSource[t].DisplayMember),this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.ColumnSource[t].DisplayMember+"_Key")&&this.ScreenObject.GridDataColumns.Remove(this.ScreenObject.ColumnSource[t].DisplayMember+"_Key")):this.ScreenObject.GridDataColumns.Contains(this.ScreenObject.ColumnSource[t].DisplayMember)&&this.ScreenObject.GridDataColumns.Remove(this.ScreenObject.ColumnSource[t].DisplayMember),this.ScreenObject.ColumnSource.RemoveAt(t));for(var n=-1,a=[],i=0;i<this.ScreenObject.ColumnSource.length;i++)"LineNarration"==this.ScreenObject.ColumnSource[i].DisplayMember&&(n=i,this.ScreenObject.ColumnSource[i].Width=150),null!=this.ScreenObject.ColumnSource[i].DrRefColName&&""!=this.ScreenObject.ColumnSource[i].DrRefColName||"LeaveComp"==this.ScreenObject.ColumnSource[i].DrRefColName||a.push(this.ScreenObject.ColumnSource[i]);n<0&&(n=a.length);for(var r=null,s=0;s<e.length;s++)(r=new f.a).Header=e[s].Name.toString(),r.DisplayMember="dcNum"+e[s].SNo.toString(),r.ID=e[s].SNo.toString(),r.DrRefColName="LeaveComp",r.DataType="FLOAT",r.IsCalculated=1,r.IsColumnUserDefined=!0,r.Width=90,this.ScreenObject.GridDataColumns.Contains(r.DisplayMember)||this.ScreenObject.GridDataColumns.push(r.DisplayMember),this.ScreenObject.GridDataColumns.Contains("dcCalc"+r.DisplayMember)||this.ScreenObject.GridDataColumns.push("dcCalc"+r.DisplayMember),this.ScreenObject.GridDataColumns.Contains("default"+r.DisplayMember)||this.ScreenObject.GridDataColumns.push("default"+r.DisplayMember),a.Insert(n,r),n++;this.ScreenObject.ColumnSource=a}},{key:"LoadGradeDataNew",value:function(e,t,n,a){var i,r=this,c="";if(0==e||2==e){i=[];var l=[];if(this.dtData=null,null==this.ScreenObject)return;if(this.DocID>0)return;if(""==n.toString())return;Logger.InfoLog("AssignLeavesViewModel::Start Loading Grade data");var u=[];this.dsData=[];var d=this.ScreenObject.ColumnSource.find((function(e){return 50051==e.CostCenterID})),D=this.ScreenObject.ColumnSource.find((function(e){return 50053==e.CostCenterID}));if(s.a.SessionManager.Preferences.ContainsKey("AssignLeavesFilter")&&"True"==s.a.SessionManager.Preferences.AssignLeavesFilter.toString()&&(c=this.PopupEmployeesFilter(n)),0==c.Trim().length&&(c=" 1=1 "),s.a.SessionManager.LocationID>0&&s.a.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&s.a.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(c+=" AND a.NodeID IN ( Select 1 as NodeID UNION ALL Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+s.a.SessionManager.LocationID+")"),o.e.IsEmpty(s.a.SessionManager.sWHEmpFilteredEmpSeqNos)||(c+=" AND ( a.NodeID IN ("+s.a.SessionManager.sWHEmpFilteredEmpSeqNos+"))"),u.push("GradeWise"),u.push(c),u.push(new Date(t.ToString("dd/MMM/yyyy"))),u.push(s.a.SessionManager.UserID),u.push(s.a.SessionManager.LanguageID),this.dsData=s.a.empService.GetAssignLeaves(u),Logger.InfoLog("AssignLeavesViewModel::End Loading Grade data"),null!=this.dsData&&this.dsData.Tables.length>0&&this.dsData.Tables[0].length>0&&!this.dsData.Columns[0].Contains("ErrorMessage")){Logger.InfoLog("AssignLeavesViewModel::Start Binding data to grid");for(var h=this.dsData.Tables[0],S=function(e){var t=r.ScreenObject._CCFields[e];if(t instanceof C.b&&50002==t.CCID&&t.SelectedValue>0)return l=r.dsData.Tables[0],h=l.filter((function(e){return 0==e.Location||e.Location==t.SelectedValue})),"break"},b=0;b<this.ScreenObject._CCFields.length;b++){if("break"===S(b))break}if(i=h,"GradeWise"==n?(null!=d&&d instanceof f.a&&(d.IsVisible=!1),null!=D&&D instanceof f.a&&(D.IsVisible=!0),(i=h.filter((function(e){return 1!=e.dcCCNID51_Key}))).sort((function(e,t){return e.dcCCNID51_Key-t.dcCCNID51_Key})),this.dtData=i.Copy(),(i=h.filter((function(e){return 1==e.dcCCNID51_Key}))).sort((function(e,t){return e.dcCCNID53_Key-t.dcCCNID53_Key})),i=i.ToTable(!0,["dcCCNID51_Key","dcCCNID53_Key"])):"EmployeeWise"==n&&(null!=d&&d instanceof f.a&&(d.IsVisible=!0),null!=D&&D instanceof f.a&&(D.IsVisible=!1),(i=h.filter((function(e){return 1==e.dcCCNID51_Key}))).sort((function(e,t){return e.dcCCNID53_Key-t.dcCCNID53_Key})),this.dtData=i.ToTable(),(i=h.filter((function(e){return 1!=e.dcCCNID51_Key}))).sort((function(e,t){return e.dcCCNID51_Key-t.dcCCNID51_Key})),i=i.ToTable(!0,["dcCCNID51_Key","dcCCNID53_Key"])),this.ScreenObject.GridDataObj.Clear(),this.ScreenObject.GridDataObj.ClearFilters(),i.length>0)for(var y=0;y<i.length;y++){var p=this.ScreenObject.GridDataObj.NewRow();this.ScreenObject.GridDataObj.insertRowAt(p,y),p.ProductID_Key=parseInt(s.a.SessionManager.Preferences.PayrollProduct),p.dcCCNID51_Key=i[y].dcCCNID51_Key.toString(),p.dcCCNID53_Key=i[y].dcCCNID53_Key.toString();for(var g=0;g<this.ScreenObject.ColumnSource.length;g++)null!=this.ScreenObject.ColumnSource[g].DrRefColName&&""!=this.ScreenObject.ColumnSource[g].DrRefColName&&this.ScreenObject.ColumnSource[g].DrRefColName.startsWith("LeaveComp")&&(p[this.ScreenObject.ColumnSource[g].DisplayMember]="0.0");this.ScreenObject.GridDataObj.updateRow(p)}else for(var O=0;O<12;O++){var I=this.ScreenObject.GridDataObj.NewRow();I.DocSeqNo=this.ScreenObject.GridData.length+1,I.DocDetailsID=0,this.ScreenObject.GridDataObj.addRow(I)}Logger.InfoLog("AssignLeavesViewModel::End Binding Grade data to grid")}this.ScreenObject.UpdateSequence(),this.RefreshGrid=!0}else if(1==e){if(""==n.toString())return;var T=[],j=this.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()}));null!=j&&j instanceof m.e&&(j.IsReadOnly=!0),null!=(j=this.ScreenObject._CCFields.find((function(e){return"dcccnid2"==e.DBColumnName.toLowerCase()})))&&j instanceof C.b&&(j.Enable=!1);var P=this.ScreenObject.ColumnSource.find((function(e){return 50051==e.CostCenterID})),A=this.ScreenObject.ColumnSource.find((function(e){return 50053==e.CostCenterID}));null!=P&&P instanceof f.a&&("EmployeeWise"==n?(P.IsVisible=!0,A.IsVisible=!1):(A.IsVisible=!0,P.IsVisible=!1)),T=this.ScreenObject.GridData,null!=this.dtData&&this.dtData.length>0&&T.AddRange(this.dtData),"GradeWise"==n?(T=this.ScreenObject.GridData.filter((function(e){return 1!=e.dcCCNID51_Key})),this.dtData=T.Copy(),T=(T=this.ScreenObject.GridData.filter((function(e){return 1==e.dcCCNID51_Key}))).Copy()):"EmployeeWise"==n&&(T=this.ScreenObject.GridData.filter((function(e){return 1==e.dcCCNID51_Key})),this.dtData=T.Copy(),T=(T=this.ScreenObject.GridData.filter((function(e){return 1!=e.dcCCNID51_Key}))).Copy()),T.length>0&&(this.ScreenObject.GridDataObj.Clear(),this.ScreenObject.GridDataObj.ClearFilters(),this.ScreenObject.GridData.AddRange(T)),this.ScreenObject.UpdateSequence(),this.RefreshGrid=!0}for(var M=[],v=0;v<this.ScreenObject.ColumnSource.length;v++)M.push(this.ScreenObject.ColumnSource[v]);this.ScreenObject.ColumnSource=M}},{key:"CheckDocumentValidations",value:function(e){var t=this;e="";var n=0;try{if(97==this.ScreenObject.DocumentType){var a=this.ScreenObject._TextFields.find((function(e){return"dcAlpha16"==e.DBColumnName.toString()}));if(a&&a.Date.OnlyDate()!=this.dtPayMon.OnlyDate())return"Payroll Month value changed, Filter and Process again.";if(this.IsLatesProcessTimingsUpdated)return"Timings are updated, Filter and Process again.";for(var i="",r="",c=0;c<this.ScreenObject.GridData.length&&!o.e.IsEmpty(this.ScreenObject.GridData[c].dcCCNID51_Key);c++)i.length>0&&(i+=","),i+=this.ScreenObject.GridData[c].dcCCNID51_Key.toString();if(""==i.Trim())return"No Employees found to Process.";var u=s.a.common.GetDataSet3("PAY011",this.DocID.toString(),i,a.Date.ToString("dd/MMM/yyyy")).Tables[0];if(null!=u&&u.length>0){i=r="";for(var d=0;d<u.length;d++)i+=u[d].EmpCode.toString()+",",r.Contains(u[d].VoucherNo.toString()+",")||(r+=u[d].VoucherNo.toString()+",");return e+"Lates are already Processed to the Employee Codes : "+i.Trim(",")+" in the Following Documents "+r.Trim(",")}if(null!=this.ScreenObject._TextFields.find((function(e){return"dcAlpha33"==e.DBColumnName.toString()})))for(var D=0;D<this.ScreenObject.GridData.length;D++)if(!o.e.IsEmpty(this.ScreenObject.GridData[D].dcCCNID51_Key)&&this.CheckIsPayrollProcessed(new Date(a.Date).ToString("dd/MMM/yyyy"),this.ScreenObject.GridData[D].dcCCNID51_Key.toString()))return e+"Cannot save the record, Payroll processed for the Employee - "+this.ScreenObject.GridData[D].dcCCNID51Code.toString()}else if(96==this.ScreenObject.DocumentType){var b=0;if(this.ScreenObject.GridData.length>0)for(var y=0;y<this.ScreenObject.GridData.length;y++)if(!o.e.IsEmpty(this.ScreenObject.GridData[y].dcAlpha2)){b++;break}if(0==b)return"Enter atleast one row.";for(var g=s.a.common.GetDataSet("PAY012","").Tables[0],f=0;f<this.ScreenObject.GridData.length;f++){if(!o.e.IsEmpty(this.ScreenObject.GridData[f].dcAlpha2)&&!o.e.IsEmpty(this.ScreenObject.GridData[f].dcNum1)&&!o.e.IsEmpty(this.ScreenObject.GridData[f].dcAlpha5)&&"Leaves"==this.ScreenObject.GridData[f].dcAlpha5.toString()){if((I=this.ScreenObject._TextFields.find((function(e){return"dcalpha6"==e.DBColumnName.toLowerCase()})))instanceof h.d&&""==I.Text.Trim())return"Enter Leave Types Deduction Order @ Header";var O=function(){var e=void 0,t=I.Text.Trim(),n=t.split(";");if(t.length>0&&0==g.length)return{v:"No Leave Types found. Define Leave Types at Customize Payroll"};if(null!=n&&n.length>0)for(var a=function(t){if(null!=n[t]&&""!=n[t].Trim()&&(null==(e=g.filter((function(e){return e.ComponentName==n[t].Trim()})))||0==e.length))return{v:{v:"Leave Type : "+n[t].Trim()+" not found. Check @ Leave Types Deduction Order"}}},i=0;i<n.length;i++){var r=a(i);if("object"==typeof r)return r.v}}();if("object"==typeof O)return O.v}if(o.e.Int(this.ScreenObject.GridData[f].dcNum3)>0&&!o.e.IsEmpty(this.ScreenObject.GridData[f].dcAlpha9)&&"Leaves"==this.ScreenObject.GridData[f].dcAlpha9.toString()){var I;if((I=this.ScreenObject._TextFields.find((function(e){return"dcalpha6"==e.DBColumnName.toLowerCase()})))&&I instanceof h.d&&""==I.Text.Trim())return"Enter Leave Types Deduction Order @ Header";var T=function(){var e=void 0,t=I.Text.Trim(),n=t.split(";");if(t.length>0&&0==g.length)return{v:"No Leave Types found. Define Leave Types at Customize Payroll"};if(null!=n&&n.length>0)for(var a=function(t){if(null!=n[t]&&""!=n[t].Trim()&&(null==(e=g.filter((function(e){return e.ComponentName==n[t].Trim()})))||0==e.length))return{v:{v:"Leave Type : "+n[t].Trim()+" not found. Check @ Leave Types Deduction Order"}}},i=0;i<n.length;i++){var r=a(i);if("object"==typeof r)return r.v}}();if("object"==typeof T)return T.v}}if(this.DocID>0){var j=s.a.common.GetDataSet("PAY013",this.DocID.toString()).Tables[0];if(null!=j&&j.length>0)return"Cannot save the record,Lates processed in Document @"+j[0].VoucherNo.toString()}}else if(94==this.ScreenObject.DocumentType){var P="0",A="";if((bt=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})))&&(bt instanceof C.b||bt instanceof p.a)&&(P=bt.SelectedValue.toString()),"0"==P)return"Select any Employee";if((bt=this.ScreenObject._CCFields.find((function(e){return"dcccnid52"==e.DBColumnName.toLowerCase()})))&&(bt instanceof C.b||bt instanceof p.a)&&(A=bt.SelectedValue.toString()),"0"==A)return"Select any Leave Type";var M=0;if(this.ScreenObject.GridData.length>0)for(var v=0;v<this.ScreenObject.GridData.length;v++)o.e.IsEmpty(this.ScreenObject.GridData[v].dcAlpha1)||M++;if(0==this.ScreenObject.GridData.length||0==M)return"No LOP Leave documents found.";M=0;for(var G=0;G<this.ScreenObject.GridData.length;G++)o.e.IsEmpty(this.ScreenObject.GridData[G].dcAlpha1)||Object(l.j)(this.ScreenObject.GridData[G].dcAlpha5)&&M++;if(0==M)return"Consider atleast one LOP Leave document to Post";for(var N=0;N<this.ScreenObject.GridData.length;N++)if(!o.e.IsEmpty(this.ScreenObject.GridData[N].dcAlpha1)&&Object(l.j)(this.ScreenObject.GridData[N].dcAlpha5)&&o.e.IsEmptySpace(this.ScreenObject.GridData[N].dcAlpha7))return"Enter 'Current Adjustment Days' at Row No. "+(N+1).toString();for(var E=0;E<this.ScreenObject.GridData.length;E++)if(!o.e.IsEmpty(this.ScreenObject.GridData[E].dcAlpha1)&&Object(l.j)(this.ScreenObject.GridData[E].dcAlpha5)&&!o.e.IsEmpty(this.ScreenObject.GridData[E].dcAlpha7)&&(parseFloat(this.ScreenObject.GridData[E].dcAlpha7)<=0||parseFloat(this.ScreenObject.GridData[E].dcAlpha7)>parseFloat(this.ScreenObject.GridData[E].dcAlpha4)))return"''Current Adjustment Days' should be Grater than '0' and less than or equal to 'No. of days'";if(this.dsData=this.GetLOPLeaveDocuments(parseInt(P),parseInt(A),this.DocumentDate),null!=this.dsData&&this.dsData.Tables.length>0){if(this.dsData.Tables[0].length>0&&this.dsData.Columns[0].Contains("ErrorMessage"))return this.dsData.Tables[0][0].ErrorMessage.toString();if(this.dsData.Tables[0].length>0){var w=function(){for(var e="",n=0,a=0;a<t.ScreenObject.GridData.length;a++)if(t.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!o.e.IsEmpty(t.ScreenObject.GridData[a].ProductID_Key)){e=t.ScreenObject.GridData[a].dcAlpha1.toString(),n=parseFloat(t.ScreenObject.GridData[a].dcAlpha4);var i=o.e.DTComputeSUM(t.dsData.Tables[1].filter((function(n){return n.LOPLeaveDocVoucherNo==e&&n.DocID!=t.DocID})),"CurAdjDays",!1);if(i+o.e.Double(t.ScreenObject.GridData[a].dcAlpha7)>n)return{v:"You can not adjust more than "+(n-i)+" days, previously adjusted in other documents"}}}();if("object"==typeof w)return w.v}}}else if(60==this.ScreenObject.DocumentType){for(var F=0;F<this.ScreenObject.GridData.length;F++)null!=this.ScreenObject.GridData[F].dcCCNID51_Key&&(n+=parseInt(this.ScreenObject.GridData[F].dcNum6));n>0&&(e="Please check the dates")}else if(69==this.ScreenObject.DocumentType){var V="0",L="",R=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));R&&(R instanceof C.b||R instanceof p.a)&&(V=R.SelectedValue.toString());var B=s.a.common.GetDataSet3("PAY014",this.DocID.toString(),V.toString()).Tables[0];if(null!=B&&B.length>0)return this.DisplayMessage="Employee Resignation document already exists, Check Document @ "+B[0].VoucherNo.toString(),this.MessageVisibility=!0,this.DisplayMessage;if(this.ScreenObject.Preferences.ContainsKey("AllowResignationifEmployeeonLeaveorVacation")&&"False"==this.ScreenObject.Preferences.AllowResignationifEmployeeonLeaveorVacation)for(var x=0;x<this.ScreenObject.GridData.length;x++)if(L="",V="1",null!=(R=this.ScreenObject._TextFields.find((function(e){return"dcalpha4"==e.DBColumnName.toLowerCase()})))&&(L=R.Date.ToString("dd/MMM/yyyy")),null!=(R=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})))&&(R instanceof C.b||R instanceof p.a)&&(V=R.SelectedValue.toString()),""!=L&&parseInt(V)>1){var k=s.a.common.GetDataSet3("PAY084",V,L).Tables[0];if(null!=k&&k.length>0&&""!=o.e.String(k[0].LeaveMessage))return this.DisplayMessage=k[0].LeaveMessage.toString(),this.MessageVisibility=!0,this.DisplayMessage}}else if(89==this.ScreenObject.DocumentType){var _=function(){var e,n=null,a=null,i=null,r=null,c="0",l="";if((bt=t.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})))&&(bt instanceof C.b||bt instanceof p.a)&&(c=bt.SelectedValue.toString()),parseInt(c)>1){var u=t.dtPayEmps.filter((function(e){return e.NodeID==c}));if(null!=u&&u.length>0){var d=o.e.String(u[0].CheckInOutDevice);if(""==d)return{v:"Employee Cannot checkIn/CheckOut from Desktop"};var D=!1;if(d.split(",").forEach((function(e){"Desktop"==e&&(D=!0)})),!D)return{v:"Employee Cannot checkIn/CheckOut from Desktop"}}}if((St=t.ScreenObject.ColumnSource.find((function(e){return"dcalpha1"==e.DisplayMember.toLowerCase()})))&&!o.e.IsEmpty(t.ScreenObject.GridData[0][St.DisplayMember+"_Key"])&&(n=new Date(t.ScreenObject.GridData[0][St.DisplayMember+"_Key"])),(St=t.ScreenObject.ColumnSource.find((function(e){return"dcalpha2"==e.DisplayMember.toLowerCase()})))&&!o.e.IsEmpty(t.ScreenObject.GridData[0][St.DisplayMember+"_Key"])&&(a=new Date(t.ScreenObject.GridData[0][St.DisplayMember+"_Key"])),(St=t.ScreenObject.ColumnSource.find((function(e){return"dcalpha3"==e.DisplayMember.toLowerCase()})))&&!o.e.IsEmpty(t.ScreenObject.GridData[0][St.DisplayMember+"_Key"])&&(i=new Date(t.ScreenObject.GridData[0][St.DisplayMember+"_Key"])),(St=t.ScreenObject.ColumnSource.find((function(e){return"dcalpha4"==e.DisplayMember.toLowerCase()})))&&!o.e.IsEmpty(t.ScreenObject.GridData[0][St.DisplayMember+"_Key"])&&(r=new Date(t.ScreenObject.GridData[0][St.DisplayMember+"_Key"])),null==n&&null==i)return{v:"Select atleast one Check-in/out Date."};if(n&&i&&(n=new Date(n.getFullYear(),n.getMonth(),n.getDate(),a.getHours(),a.getMinutes(),a.getSeconds()),(i=new Date(i.getFullYear(),i.getMonth(),i.getDate(),r.getHours(),r.getMinutes(),r.getSeconds()))<n))return{v:"Check-in date should be less then or equal to Check-out date"};if(parseInt(c)>1&&null!=n){var h=s.a.common.GetDataSet3("PAY015",c,n.ToString("dd MMM yyyy"),t.DocID.toString()).Tables[0];if(null!=h&&h.length>0)return{v:"Employee Attendance already exists on Voucher No : "+h[0].VoucherNo.toString()}}for(var S=0;S<t.ScreenObject.GridData.length;S++)if(t.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!o.e.IsEmpty(t.ScreenObject.GridData[S].ProductID_Key)&&(l="",c="1",e=t.ScreenObject.GridData[S],(St=t.ScreenObject.ColumnSource.find((function(e){return"dcalpha1"==e.DisplayMember.toLowerCase()})))&&!o.e.IsEmpty(e[St.DisplayMember+"_Key"])&&(l=new Date(e[St.DisplayMember+"_Key"]).ToString("dd/MMM/yyyy")),(bt=t.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})))?(bt instanceof C.b||bt instanceof p.a)&&(c=bt.SelectedValue.toString()):(St=t.ScreenObject.ColumnSource.find((function(e){return"LISTBOX"==e.DataType.toUpperCase()&&"dcccnid51_key"==e.ValueMember.toLowerCase()})))&&!o.e.IsEmpty(e[St.ValueMember])&&(c=e[St.ValueMember].toString()),""!=l&&parseInt(c)>1)){t.drcc1=t.dtPayEmps.filter((function(e){return e.NodeID==c}));var m=t.GetDuplicateTimingsOfEmployeeTimeSheet(l,c,S,t.ScreenObject.DocumentType);if(""!=m){try{parseInt(m),t.DisplayMessage="Employee has already worked on these timings, can't allow same timings. Check Timings of the Employee - "+t.drcc1[0].Code.toString()+" @ Row No - "+parseInt(m)}catch(b){t.DisplayMessage="Employee has already worked on these timings, can't allow same timings. Check Timings of the Employee - "+t.drcc1[0].Code.toString()+" @ Voucher No - "+m}return{v:(t.MessageVisibility=!0,t.DisplayMessage)}}}}();if("object"==typeof _)return _.v}else if(90==this.ScreenObject.DocumentType){var K=function(){var e=null,n=null,a=null,i=null,r="0",c="";if((bt=t.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})))&&(bt instanceof C.b||bt instanceof p.a)&&(r=bt.SelectedValue.toString()),(St=t.ScreenObject.ColumnSource.find((function(e){return"dcalpha1"==e.DisplayMember.toLowerCase()})))&&!o.e.IsEmpty(t.ScreenObject.GridData[0][St.DisplayMember+"_Key"])&&(e=new Date(t.ScreenObject.GridData[0][St.DisplayMember+"_Key"])),(St=t.ScreenObject.ColumnSource.find((function(e){return"dcalpha2"==e.DisplayMember.toLowerCase()})))&&!o.e.IsEmpty(t.ScreenObject.GridData[0][St.DisplayMember+"_Key"])&&(n=new Date(t.ScreenObject.GridData[0][St.DisplayMember+"_Key"])),(St=t.ScreenObject.ColumnSource.find((function(e){return"dcalpha3"==e.DisplayMember.toLowerCase()})))&&!o.e.IsEmpty(t.ScreenObject.GridData[0][St.DisplayMember+"_Key"])&&(a=new Date(t.ScreenObject.GridData[0][St.DisplayMember+"_Key"])),(St=t.ScreenObject.ColumnSource.find((function(e){return"dcalpha4"==e.DisplayMember.toLowerCase()})))&&!o.e.IsEmpty(t.ScreenObject.GridData[0][St.DisplayMember+"_Key"])&&(i=new Date(t.ScreenObject.GridData[0][St.DisplayMember+"_Key"])),null==e&&null==a)return{v:"Select atleast one Check-in/out Date."};if(e&&a&&(e=new Date(e.getFullYear(),e.getMonth(),e.getDate(),n.getHours(),n.getMinutes(),n.getSeconds()),(a=new Date(a.getFullYear(),a.getMonth(),a.getDate(),i.getHours(),i.getMinutes(),i.getSeconds()))<e))return{v:"Check-in date should be less then or equal to Check-out date"};if(s.a.SessionManager.Preferences.ContainsKey("AllowMultipleTimeSheetsOnSameDay")&&"FALSE"==s.a.SessionManager.Preferences.AllowMultipleTimeSheetsOnSameDay.toString().toUpperCase()&&parseInt(r)>1&&null!=e){var l=s.a.common.GetDataSet3("PAY016",r,e.ToString("dd MMM yyyy"),t.DocID.toString()).Tables[0];if(null!=l&&l.length>0)return{v:"Employee Time Sheet already exists on Voucher No : "+l[0].VoucherNo.toString()}}if(s.a.SessionManager.Preferences.ContainsKey("AllowOverlapTimeInTimeSheet")&&"FALSE"==s.a.SessionManager.Preferences.AllowOverlapTimeInTimeSheet.toString().toUpperCase())for(var u,d=0;d<t.ScreenObject.GridData.length;d++)if(t.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!o.e.IsEmpty(t.ScreenObject.GridData[d].ProductID_Key)&&(c="",r="1",u=t.ScreenObject.GridData[d],(St=t.ScreenObject.ColumnSource.find((function(e){return"dcalpha1"==e.DisplayMember.toLowerCase()})))&&!o.e.IsEmpty(u[St.DisplayMember+"_Key"])&&(c=new Date(u[St.DisplayMember+"_Key"]).ToString("dd/MMM/yyyy")),(bt=t.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})))?(bt instanceof C.b||bt instanceof p.a)&&(r=bt.SelectedValue.toString()):(St=t.ScreenObject.ColumnSource.find((function(e){return"LISTBOX"==e.DataType.toUpperCase()&&"dcccnid51_key"==e.ValueMember.toLowerCase()})))&&!o.e.IsEmpty(u[St.ValueMember])&&(r=u[St.ValueMember].toString()),""!=c&&parseInt(r)>1)){t.drcc1=t.dtPayEmps.filter((function(e){return e.NodeID==r}));var D=t.GetDuplicateTimingsOfEmployeeTimeSheet(c,r,d,t.ScreenObject.DocumentType);if(""!=D){try{parseInt(D),t.DisplayMessage="Employee has already worked on these timings, can't allow same timings. Check Timings of the Employee - "+t.drcc1[0].Code.toString()+" @ Row No - "+parseInt(D)}catch(h){t.DisplayMessage="Employee has already worked on these timings, can't allow same timings. Check Timings of the Employee - "+t.drcc1[0].Code.toString()+" @ Voucher No - "+D}return{v:(t.MessageVisibility=!0,t.DisplayMessage)}}}}();if("object"==typeof K)return K.v}else if(79==this.ScreenObject.DocumentType){var Q="0",H="";if((bt=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})))&&(bt instanceof C.b||bt instanceof p.a)&&(Q=bt.SelectedValue.toString()),(bt=this.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()})))&&(H=bt.Date.ToString("dd/MMM/yyyy")),""!=H&&parseInt(Q)>1){var W=s.a.common.GetDataSet3("PAY017",this.DocID.toString(),Q,H);if(null!=W&&W.length>0)return"Attendance Dimension Wise already exists on Voucher No : "+W[0].VoucherNo.toString()}}else if(58==this.ScreenObject.DocumentType){for(var U=0,X=0;X<this.ScreenObject.GridData.length;X++)if(null!=this.ScreenObject.GridData[X].dcCCNID52_Key){if(U++,o.e.Double(this.ScreenObject.GridData[X].dcAlpha3)<=0){e="Enter Valid Applied Days ";break}if(-1==(n=parseInt(this.ScreenObject.GridData[X].dcAlpha5))){e="Applied days should be less than or equal to available days";break}if(-2==n){e="Total applied days should be less than or equal to max encash days";break}}if(0==U)return"Encash atleast one Leave Type";var q="";(bt=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})))&&(bt instanceof C.b||bt instanceof p.a)&&(q=bt.SelectedValue.toString());var Y=this.ScreenObject._TextFields.find((function(e){return"dcalpha9"==e.DBColumnName.toLowerCase()}));if(null!=Y&&Y instanceof m.e&&!o.e.IsEmpty(Y.SelectedValue)&&"Yes"==Y.SelectedValue.toString()&&null!=(Y=this.ScreenObject._TextFields.find((function(e){return"dcalpha10"==e.DBColumnName.toLowerCase()})))&&Y instanceof S.c&&Y.Date&&o.e.Int(q)>0&&this.CheckIsPayrollProcessed(new Date(Y.Date).ToString("dd/MMM/yyyy"),q))return e+"Cannot save the record, Payroll processed for the selected month"}else if(59==this.ScreenObject.DocumentType){if(s.a.SessionManager.Preferences.ContainsKey("CompensatoryLeaveType")&&""==s.a.SessionManager.Preferences.CompensatoryLeaveType.toString())e="Please set the compensatory leave type preference";else for(var z=0;z<this.ScreenObject.GridData.length;z++)if(null!=this.ScreenObject.GridData[z].dcCCNID51_Key){if(null!=this.ScreenObject.GridData[z].dcAlpha1_Key&&new Date(this.DocumentDate)>new Date(this.ScreenObject.GridData[z].dcAlpha1_Key)&&this.ScreenObject.Preferences.ContainsKey("IgnoreDocumentDateValidation")&&!Object(l.j)(this.ScreenObject.Preferences.IgnoreDocumentDateValidation)){e="Document Date should be less than or equal to Selected Date";break}if(0==(n=parseInt(this.ScreenObject.GridData[z].dcNum1))){e="Selected date should be Weeklyoff or Holiday";break}}}else if(62==this.ScreenObject.DocumentType){var J=function(){for(var n="",a=s.a.common.GetDataSet("PAY019","").Tables[0],i=0;i<t.ScreenObject.GridData.length;i++){if((bt=t.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})))?(bt instanceof C.b||bt instanceof p.a)&&(n=bt.SelectedValue.toString()):(St=t.ScreenObject.ColumnSource.find((function(e){return"LISTBOX"==e.DataType.toUpperCase()&&"dcccnid51_key"==e.ValueMember.toLowerCase()})))&&!o.e.IsEmpty(t.ScreenObject.GridData[i][St.ValueMember])&&(n=t.ScreenObject.GridData[i][St.ValueMember].toString()),null!=a&&a.length>0&&!o.e.IsEmpty(n)&&parseInt(n)>0&&null!=t.ScreenObject.GridData[i].dcAlpha4_Key){var r=a.filter((function(e){return e.NodeId==n}));if(null!=r&&r.length>0&&new Date(r[0].DateOfJoining.toString())>new Date(t.ScreenObject.GridData[i].dcAlpha4_Key.toString()))return{v:(t.DisplayMessage="Please Check The Employee Dependency With date Of joining ",t.MessageVisibility=!0,t.DisplayMessage)}}if(t.ScreenObject.Preferences.ContainsKey("DonotallowLeaveduringNoticePeriod")&&""!=t.ScreenObject.Preferences.DonotallowLeaveduringNoticePeriod&&Object(l.j)(t.ScreenObject.Preferences.DonotallowLeaveduringNoticePeriod)&&!o.e.IsEmpty(t.ScreenObject.GridData[i].dcAlpha5_key)){var c=s.a.report.GetDataTable("AEDDALeave",n,new Date(t.ScreenObject.GridData[i].dcAlpha5_key).ToString("dd/MMM/yyyy"));if(null!=c&&c.length>0){e+="Employee is on Notice Period,Cannot Apply Leave";break}}if(s.a.SessionManager.Preferences.ContainsKey("DonotAllowLeaveIfAttendencePosted")&&Object(l.j)("True"==s.a.SessionManager.Preferences.DonotAllowLeaveIfAttendencePosted)&&null!=t.ScreenObject.GridData[i].dcAlpha4_Key&&null!=t.ScreenObject.GridData[i].dcAlpha5_Key){var u=s.a.common.GetDataSet3("PAY018",n,new Date(t.ScreenObject.GridData[i].dcAlpha4_Key).ToString("dd/MMM/yyyy"),new Date(t.ScreenObject.GridData[i].dcAlpha5_Key).ToString("dd/MMM/yyyy"));if(null!=u&&u.length>0){e="Daily Attendence Already Posted";break}}if(null!=t.ScreenObject.GridData[i].dcCCNID52_Key){if(""!=(e=t.IsLeaveTypeValid(parseInt(n),parseInt(t.ScreenObject.GridData[i].dcCCNID52_Key),t.ScreenObject.GridData[i],{IfFormulaExistsNoOfDays:!1})))break;var d=s.a.common.GetDataSet3("PAY009",n,new Date(t.ScreenObject.GridData[i].dcAlpha4_Key.toString()).ToString("dd/MMM/yyyy")).Tables[0];if(null!=d&&d.length>0){e="Please enter Rejoining date of this Employee to the Last Vacation";break}if(null!=t.ScreenObject.GridData[i].dcAlpha4_Key&&new Date(t.DocumentDate)>new Date(t.ScreenObject.GridData[i].dcAlpha4_Key)&&t.ScreenObject.Preferences.ContainsKey("IgnoreDocumentDateValidation")&&!Object(l.j)(t.ScreenObject.Preferences.IgnoreDocumentDateValidation)){e="Document Date should be less than or equal to From Date";break}if(null!=t.ScreenObject.GridData[i].dcAlpha7&&parseFloat(t.ScreenObject.GridData[i].dcAlpha7)<=0){e="Dates already applied | Selected dates between holidays or weeklyoffs dates";break}if(null!=t.ScreenObject.GridData[i].dcAlpha9&&(parseInt(t.ScreenObject.GridData[i].dcAlpha9)>=0||-4==parseInt(t.ScreenObject.GridData[i].dcAlpha9))){if(null!=t.ScreenObject.GridData[i].dcAlpha3&&parseFloat(t.ScreenObject.GridData[i].dcAlpha3)<=0){e="Please check the Payroll structure/Available leaves for the selected month";break}if(null!=t.ScreenObject.GridData[i].dcAlpha3&&null!=t.ScreenObject.GridData[i].dcAlpha7&&null!=t.ScreenObject.GridData[i].dcAlpha9&&-4!=parseInt(t.ScreenObject.GridData[i].dcAlpha9)&&parseFloat(t.ScreenObject.GridData[i].dcAlpha7)>parseFloat(t.ScreenObject.GridData[i].dcAlpha3)){e="Cannot apply leaves more than Available leaves";break}}if(o.e.IsEmpty(t.ScreenObject.GridData[i].dcAlpha6)||"1"==o.e.String(t.ScreenObject.GridData[i].dcAlpha6)||"2"==o.e.String(t.ScreenObject.GridData[i].dcAlpha6)||"3"==o.e.String(t.ScreenObject.GridData[i].dcAlpha6)){e="Please select the session type";break}if(s.a.SessionManager.Preferences.ContainsKey("AllowLeavesifPayrollProcessedorLocked")&&Object(l.j)("False"==s.a.SessionManager.Preferences.AllowLeavesifPayrollProcessedorLocked)&&null!=t.ScreenObject.GridData[i].dcAlpha4_key&&null!=t.ScreenObject.GridData[i].dcAlpha5_key&&""!=(e=t.IsDocLocked(n,new Date(t.ScreenObject.GridData[i].dcAlpha4_key),new Date(t.ScreenObject.GridData[i].dcAlpha5_key),t.ScreenObject.DocumentType)))break}}}();if("object"==typeof J)return J.v}else if(65==this.ScreenObject.DocumentType){for(var Z=0;Z<this.ScreenObject.GridData.length;Z++)if(null!=this.ScreenObject.GridData[Z].dcAlpha1){if(o.e.IsEmpty(this.ScreenObject.GridData[Z].dcAlpha3_Key)){e="Please enter the Re-join date";break}if(new Date(this.DocumentDate)>new Date(this.ScreenObject.GridData[Z].dcAlpha3_Key)&&this.ScreenObject.Preferences.ContainsKey("IgnoreDocumentDateValidation")&&!Object(l.j)(this.ScreenObject.Preferences.IgnoreDocumentDateValidation)){e="Document Date should be less than or equal to Re-join date";break}if((n=parseInt(this.ScreenObject.GridData[Z].dcAlpha4))>0){e="Please check the Re-join date";break}}}else if(68==this.ScreenObject.DocumentType||69==this.ScreenObject.DocumentType||70==this.ScreenObject.DocumentType||80==this.ScreenObject.DocumentType){var $=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));if(null!=$&&($ instanceof C.b&&o.e.IsEmpty($.Text)||$ instanceof p.a&&o.e.IsEmpty($.Text))&&(e="Please select the employee"),69==this.ScreenObject.DocumentType){var ee=this.ScreenObject._TextFields.find((function(e){return"dcalpha4"==e.DBColumnName.toLowerCase()}));ee instanceof S.c&&ee.Date&&new Date(this.DocumentDate)>new Date(ee.Date)&&this.ScreenObject.Preferences.ContainsKey("IgnoreDocumentDateValidation")&&!Object(l.j)(this.ScreenObject.Preferences.IgnoreDocumentDateValidation)&&(e+=" Document Date should be less than or equal to Release Date");for(var te=0;te<this.ScreenObject._TextFields.length;te++){var ne=this.ScreenObject._TextFields[te];if(ne instanceof S.c&&ne.DBColumnName.toLowerCase().Contains("dcalpha")&&ne.Date){e+=this.IsDateValid(null,ne.DBColumnName);break}}}else if(70==this.ScreenObject.DocumentType)for(var ae=0;ae<this.ScreenObject.GridData.length;ae++){if(null!=this.ScreenObject.GridData[ae].dcAlpha4_Key&&null!=this.ScreenObject.GridData[ae].dcAlpha5_Key&&new Date(this.ScreenObject.GridData[ae].dcAlpha5_Key)<new Date(this.ScreenObject.GridData[ae].dcAlpha4_Key)){e="Expected completed date should be greater than start date";break}if(null!=this.ScreenObject.GridData[ae].dcAlpha4_Key&&null!=this.ScreenObject.GridData[ae].dcAlpha6_Key&&new Date(this.ScreenObject.GridData[ae].dcAlpha6_Key)<new Date(this.ScreenObject.GridData[ae].dcAlpha4_Key)){e="Completed date should be greater than start date";break}if(null!=this.ScreenObject.GridData[ae].dcAlpha5_Key&&null!=this.ScreenObject.GridData[ae].dcAlpha6_Key&&new Date(this.ScreenObject.GridData[ae].dcAlpha6_Key)<new Date(this.ScreenObject.GridData[ae].dcAlpha5_Key)){e="Completed date should be greater than Expected completed date";break}if(null!=this.ScreenObject.GridData[ae].dcAlpha4_Key&&new Date(this.DocumentDate)>new Date(this.ScreenObject.GridData[ae].dcAlpha4_Key)&&this.ScreenObject.Preferences.ContainsKey("IgnoreDocumentDateValidation")&&!Object(l.j)(this.ScreenObject.Preferences.IgnoreDocumentDateValidation)){e="Document Date should be less than or equal to Start Date";break}}else if(68==this.ScreenObject.DocumentType){(new Date).OnlyDate();for(var ie=(new Date).OnlyDate(),re="",se=0;se<this.ScreenObject.GridData.length;se++)if(this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&null!=this.ScreenObject.GridData[se].ProductID_Key&&null!=this.ScreenObject.GridData[se].ProductID_Key&&""!=this.ScreenObject.GridData[se].ProductID_Key.toString()){var oe=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));if(null!=oe)(oe instanceof C.b||oe instanceof p.a)&&(re=oe.SelectedValue.toString());else{var ce=this.ScreenObject.ColumnSource.find((function(e){return"LISTBOX"==e.DataType.toUpperCase()&&"dcccnid51_key"==e.ValueMember.toLowerCase()}));null==ce||o.e.IsEmpty(this.ScreenObject.GridData[se][ce.ValueMember])||(re=this.ScreenObject.GridData[se][ce.ValueMember].toString())}var le=this.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()}));null!=le&&le instanceof S.c&&!o.e.IsEmpty(le.Date)&&le.Date,null!=(le=this.ScreenObject._TextFields.find((function(e){return"dcalpha4"==e.DBColumnName.toLowerCase()})))&&le instanceof S.c&&!o.e.IsEmpty(le.Date)&&(ie=new Date(le.Date.getFullYear(),le.Date.iMonth(),1));var ue=s.a.common.GetDataTable("PAY092",re+"~"+ie.AddMonths(1));if(null!=ue&&ue.length>0){e="Cannot save the record, Payroll processed for the selected month";break}if(""!=(e=this.IsDocLocked(re,ie.AddMonths(1),ie.AddMonths(1),this.ScreenObject.DocumentType)))break}}else if(80==this.ScreenObject.DocumentType){var de=(new Date).OnlyDate(),De=(new Date).OnlyDate(),he="",Se=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));null!=Se&&(Se instanceof C.b||Se instanceof p.a)&&(he=Se.SelectedValue.toString());var me=this.ScreenObject._TextFields.find((function(e){return"dcalpha3"==e.DBColumnName.toLowerCase()}));null!=me&&me instanceof S.c&&!o.e.IsEmpty(me.Date)&&(de=me.Date),De=de,e=this.IsDocLocked(he,de,De,this.ScreenObject.DocumentType)}}else if(72==this.ScreenObject.DocumentType){var be=new Date,Ce=new Date,ye="",pe=s.a.common.GetDataSet("PAY019","").Tables[0];if((bt=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})))&&(bt instanceof C.b||bt instanceof p.a)&&(ye=bt.SelectedValue.toString()),null!=pe&&pe.length>0&&!o.e.IsEmpty(ye)&&parseInt(ye)>0&&(Ie=this.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()})))){var ge=pe.filter((function(e){return e.NodeId==ye}));if(null!=ge&&ge.length>0&&new Date(ge[0].DateOfJoining.toString())>new Date(Ie.Date))return this.DisplayMessage="Please Check The Employee Dependency With date Of joining ",this.MessageVisibility=!0,this.DisplayMessage}var fe,Oe=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));if(null!=Oe&&Oe instanceof C.b&&Oe.SelectedValue>0&&0==this.DocID){var Ie=this.ScreenObject._TextFields.find((function(e){return"dcalpha3"==e.DBColumnName.toLowerCase()})),Te=this.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()}));if(null!=Ie&&Ie instanceof S.c&&""!=o.e.String(Ie.Date)&&null!=Te&&Te instanceof S.c&&""!=Te.Date.toString()){var je=this.ScreenObject.GetVacationDetails(Oe.SelectedValue,new Date(Ie.Date),new Date(Te.Date));je.Tables.length>0&&(e=this.ApplyVacationValidationMsg(je)),s.a.SessionManager.Preferences.ContainsKey("DonotAllowVacationDuringProbationPeriod")&&"True"==s.a.SessionManager.Preferences.DonotAllowVacationDuringProbationPeriod.toString()&&new Date(be)<=new Date(je.Tables[6][0].ConfirmationDate)&&(e+=" Employee is in probation period, cannot apply the vacation\r\n")}}else if(null!=Oe&&Oe instanceof p.a&&Oe.SelectedValue>0&&0==this.DocID&&(Ie=this.ScreenObject._TextFields.find((function(e){return"dcalpha3"==e.DBColumnName.toLowerCase()})),Te=this.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()})),null!=Ie&&Ie instanceof S.c&&""!=o.e.String(Ie.Date)&&null!=Te&&Te instanceof S.c&&""!=o.e.String(Te.Date))){var Pe=this.ScreenObject.GetVacationDetails(Oe.SelectedValue,new Date(Ie.Date),new Date(Te.Date));Pe.Tables.length>0&&(e=this.ApplyVacationValidationMsg(Pe)),s.a.SessionManager.Preferences.ContainsKey("DonotAllowVacationDuringProbationPeriod")&&"True"==s.a.SessionManager.Preferences.DonotAllowVacationDuringProbationPeriod.toString()&&new Date(be)<=new Date(Pe.Tables[6][0].ConfirmationDate)&&(e+=" Employee is in probation period, cannot apply the vacation\r\n")}if(null!=(Oe=this.ScreenObject._TextFields.find((function(e){return"dcalpha16"==e.DBColumnName.toLowerCase()})))&&Oe instanceof m.e&&!o.e.IsEmpty(Oe.SelectedValue)&&"Yes"==Oe.SelectedValue&&this.ScreenObject._TextFields.find((function(e){return"dcalpha14"==e.DBColumnName.toLowerCase()}))instanceof h.d){var Ae=0,Me=0,ve=0,Ge=this.ScreenObject._TextFields.find((function(e){return"dcalpha22"==e.DBColumnName.toLowerCase()}));Ge instanceof h.d&&!o.e.IsEmpty(Ge.Text)&&(Ae=parseFloat(Ge.Text)),(Ge=this.ScreenObject._TextFields.find((function(e){return"dcalpha10"==e.DBColumnName.toLowerCase()})))instanceof h.d&&!o.e.IsEmpty(Ge.Text)&&(ve=parseFloat(Ge.Text)),(Ge=this.ScreenObject._TextFields.find((function(e){return"dcalpha7"==e.DBColumnName.toLowerCase()})))instanceof h.d&&!o.e.IsEmpty(Ge.Text)&&(Me=parseFloat(Ge.Text)),Ae+Me-ve<parseFloat(Ge.Text)&&(e+="Encash days should be less than or equal to remaining days\r\n")}if(null!=(Oe=this.ScreenObject._TextFields.find((function(e){return"dcalpha16"==e.DBColumnName.toLowerCase()})))&&Oe instanceof m.e&&!o.e.IsEmpty(Oe.SelectedValue)&&"Yes"!=Oe.SelectedValue.toString()&&(null!=(Oe=this.ScreenObject._TextFields.find((function(e){return"dcalpha4"==e.DBColumnName.toLowerCase()})))&&Oe instanceof h.d&&(""==Oe.Text.toString()||"0.00"==Oe.Text.toString())&&(e+="Please check the vacation days\r\n")),null!=(Oe=this.ScreenObject._TextFields.find((function(e){return"dcalpha18"==e.DBColumnName.toLowerCase()})))&&Oe instanceof S.c&&Oe.Date&&new Date(Oe.Date)<new Date(this.DocumentDate)&&(e+="Exit rentry date should be greater than doc date\r\n"),null!=(Oe=this.ScreenObject._TextFields.find((function(e){return"dcalpha19"==e.DBColumnName.toLowerCase()})))&&Oe instanceof S.c&&Oe.Date&&new Date(Oe.Date)<new Date(this.DocumentDate)&&(e+="Approved date should be greater than doc date\r\n"),null!=(Oe=this.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()})))&&Oe instanceof S.c&&Oe.Date&&(be=Oe.Date),null!=(Oe=this.ScreenObject._TextFields.find((function(e){return"dcalpha3"==e.DBColumnName.toLowerCase()})))&&Oe instanceof S.c&&Oe.Date&&(Ce=Oe.Date),new Date(be)>new Date(Ce)&&(e+="Todate should be greater than Fromdate\r\n"),new Date(this.DocumentDate)>new Date(be)&&this.ScreenObject.Preferences.ContainsKey("IgnoreDocumentDateValidation")&&!Object(l.j)(this.ScreenObject.Preferences.IgnoreDocumentDateValidation)&&(e+="Document Date should be less than or equal to From Date"),""!=e)return e;s.a.SessionManager.Preferences.ContainsKey("AllowVacationifPayrollProcessedorLocked")&&Object(l.j)("False"==s.a.SessionManager.Preferences.AllowVacationifPayrollProcessedorLocked)&&(e=this.IsDocLocked(ye,be,Ce,this.ScreenObject.DocumentType));var Ne=s.a.common.GetDataSet("PAY020","").Tables[0];if(null!=Ne&&Ne.length>0)for(var Ee=0;Ee<Ne.length;Ee++)null!=(fe=s.a.common.GetDataSet3("PAY021",ye,Ne[Ee].ComponentID.toString()).Tables[0])&&fe.length>0&&(e+="Please enter Rejoining date of this Employee to the Leave Type : "+Ne[Ee].ComponentName.toString());if(null!=(Oe=this.ScreenObject._TextFields.find((function(e){return"dcalpha24"==e.DBColumnName.toLowerCase()})))&&Oe instanceof m.e&&!o.e.IsEmpty(Oe.SelectedValue)&&"Yes"==Oe.SelectedValue.toString()&&(null!=(Oe=this.ScreenObject._TextFields.find((function(e){return"dcalpha25"==e.DBColumnName.toLowerCase()})))&&Oe instanceof S.c&&Oe.Date&&o.e.Int(ye)>0&&this.CheckIsPayrollProcessed(new Date(Oe.Date).ToString("dd/MMM/yyyy"),ye)&&(e+="Cannot save the record, Payroll processed for the selected month")),!o.e.IsEmpty(ye)&&parseInt(ye)>0){var we=new Date(be.getFullYear(),be.getMonth(),1),Fe=s.a.report.GetDataTable("AEDVACLeave",ye,we.ToString("dd/MMM/yyyy"));if(null!=Fe&&Fe.length>0){var Ve=s.a.report.GetDataTable("AEDVACLeave01",ye,Ce.ToString("dd MMM yyyy"));if(null!=Ve&&Ve.length>0)return e+"Employee is on Notice Period,Cannot Apply Vacation"}}if(s.a.SessionManager.Preferences.ContainsKey("VacationBasedOnContract")&&parseInt(s.a.SessionManager.Preferences.VacationBasedOnContract)>0){var Le=this.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()}));if(null!=Le&&Le instanceof S.c&&o.e.IsEmpty(Le.Date)){var Re=s.a.common.GetDataTable("DOC058",ye+"~"+Le.Date.ToString("dd/MMM/yyyy")+"~"+this.ScreenObject.DocID);null!=Re&&Re.length>0&&(e+="Employee has Already applied Vacation in future Date")}}}else if(73==this.ScreenObject.DocumentType){var Be=0;if(this.ScreenObject.GridData.length>0)for(var xe=0;xe<this.ScreenObject.GridData.length;xe++)null!=this.ScreenObject.GridData[xe].dcAlpha4&&null!=this.ScreenObject.GridData[xe].dcAlpha4&&"YES"==this.ScreenObject.GridData[xe].dcAlpha4.toString().toUpperCase()&&Be++;if(1!=Be)return"Select only one document to adjust."}else if(74==this.ScreenObject.DocumentType)e=this.GetITSlabValidation(1,null);else if(57==this.ScreenObject.DocumentType){0==this.ScreenObject.Link.VouchersList.length&&(e+="No loan link document available for the loan repayment");for(var ke=0;ke<this.ScreenObject.GridData.length;ke++)if(null!=this.ScreenObject.GridData[ke].Rate&&parseInt(this.ScreenObject.GridData[ke].Rate)<0){e+="Please check the date for Paid On / Month ";break}}else if(55==this.ScreenObject.DocumentType){for(var _e=0;_e<this.ScreenObject.GridData.length;_e++){if(null!=this.ScreenObject.GridData[_e].Rate&&parseInt(this.ScreenObject.GridData[_e].Rate)<0){e="Please check the deduction month";break}if(null!=this.ScreenObject.GridData[_e].dcCCnid51_Key&&null==this.ScreenObject.GridData[_e].dcAlpha1_Key){e="Please enter the deduction month";break}if(null!=this.ScreenObject.GridData[_e].dcNum1&&null!=this.ScreenObject.GridData[_e].dcNum2){if(parseFloat(this.ScreenObject.GridData[_e].dcNum2)>parseFloat(this.ScreenObject.GridData[_e].dcNum1)){e="Opening balance amount should be less than loan amount";break}if(null!=this.ScreenObject.GridData[_e].dcNum3){if(0==parseFloat(this.ScreenObject.GridData[_e].dcNum3)){e="Please enter the installment amount";break}if(parseFloat(this.ScreenObject.GridData[_e].dcNum3)>parseFloat(this.ScreenObject.GridData[_e].dcNum1)){e="Installment amount should be less than loan amount";break}if(parseFloat(this.ScreenObject.GridData[_e].dcNum3)>parseFloat(this.ScreenObject.GridData[_e].dcNum2)){e="Installment amount should be less than opening balance amount";break}}}}if(this.DocID>0){var Ke=this.ScreenObject.CheckLoanRepayAmountDetails(this.DocID);Ke.Tables.length>0&&Ke.Tables[0].length>0&&parseFloat(Ke.Tables[0][0][0])>0&&(e="Can't update the linked document")}}else if(56==this.ScreenObject.DocumentType){if(!s.a.SessionManager.IsWebApplication){var Qe=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));(Qe&&Qe instanceof C.b&&o.e.IsEmpty(Qe.Text)||Qe&&Qe instanceof p.a&&o.e.IsEmpty(Qe.Text))&&(e="Please select the employee\r\n"),(Qe=this.ScreenObject._CCFields.find((function(e){return"dcccnid52"==e.DBColumnName.toLowerCase()})))&&Qe instanceof C.b&&o.e.IsEmpty(Qe.Text)&&(e+="Please select the loan type\r\n"),(Qe=this.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()})))&&Qe instanceof h.d&&(""==Qe.Text.toString()||"0"==Qe.Text.toString())&&(e+="Please enter the loan amount\r\n"),e+=this.IsDateValid(null,"")}var He="0";if((bt=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})))&&(bt instanceof C.b||bt instanceof p.a)&&(He=bt.SelectedValue.toString()),"0"==He&&(e="Select any Employee"),s.a.SessionManager.Preferences.ContainsKey("DonotAllowApplyLoanDuringProbationPeriod")&&Object(l.j)(s.a.SessionManager.Preferences.DonotAllowApplyLoanDuringProbationPeriod)){var We=s.a.common.GetDataSet3("PAY022",this.ScreenObject.DocDate.Date.ToString("dd/MMM/yyyy"),He).Tables[0];null!=We&&We.length>0&&null!=We[0].Valid&&null!=We[0].Valid&&"1"==We[0].Valid.toString()&&(e+=" Employee is in probation period, can not apply the Loan")}}else if(66==this.ScreenObject.DocumentType)for(var Ue=0;Ue<this.ScreenObject.GridData.length&&o.e.IsEmpty(e);Ue++){for(var Xe=1;Xe<=12;Xe++)if(6==Xe&&(Xe=8),null!=this.ScreenObject.GridData[Ue]["dcAlpha"+Xe]&&parseFloat(this.ScreenObject.GridData[Ue]["dcAlpha"+Xe])>0&&parseFloat(this.ScreenObject.GridData[Ue]["dcAlpha"+Xe])>24){e="Hours should be less than or equal to 24 hours at row no : "+this.ScreenObject.GridData[Ue].DocSeqNo.toString()+"\r\n";break}if(null!=this.ScreenObject.GridData[Ue].dcAlpha3&&null!=this.ScreenObject.GridData[Ue].dcAlpha4&&parseFloat(this.ScreenObject.GridData[Ue].dcAlpha3)>=parseFloat(this.ScreenObject.GridData[Ue].dcAlpha4)){e=e+"Minimum hours half day should be less than minimum hours full day at row no : "+this.ScreenObject.GridData[Ue].DocSeqNo.toString()+"\r\n";break}if(null!=this.ScreenObject.GridData[Ue].dcAlpha4&&null!=this.ScreenObject.GridData[Ue].dcAlpha5&&parseFloat(this.ScreenObject.GridData[Ue].dcAlpha4)>=parseFloat(this.ScreenObject.GridData[Ue].dcAlpha5)){e=e+"Minimum hours full day should be less than maximum hours per day at row no : "+this.ScreenObject.GridData[Ue].DocSeqNo.toString()+"\r\n";break}if(null!=this.ScreenObject.GridData[Ue].dcAlpha6_Key&&new Date(this.DocumentDate)>new Date(this.ScreenObject.GridData[Ue].dcAlpha6_Key)&&this.ScreenObject.Preferences.ContainsKey("IgnoreDocumentDateValidation")&&!Object(l.j)(this.ScreenObject.Preferences.IgnoreDocumentDateValidation)){e="Document Date should be less than or equal to WEF Date";break}}else if(52==this.ScreenObject.DocumentType){var qe=this.ScreenObject._TextFields.find((function(e){return"dcalpha3"==e.DBColumnName.toLowerCase()}));null!=qe&&qe instanceof S.c&&qe.Date&&new Date(this.DocumentDate)>qe.Date.OnlyDate()&&this.ScreenObject.Preferences.ContainsKey("IgnoreDocumentDateValidation")&&!Object(l.j)(this.ScreenObject.Preferences.IgnoreDocumentDateValidation)&&(e="Document Date should be less than or equal to WEF Date")}else if(53==this.ScreenObject.DocumentType)null==this.ScreenObject.DueDate.Date?e="Please enter the  "+this.ScreenObject.DueDate.Label+"\r\n":new Date(this.DocumentDate)>new Date(this.ScreenObject.DueDate.Date)&&this.ScreenObject.Preferences.ContainsKey("IgnoreDocumentDateValidation")&&!Object(l.j)(this.ScreenObject.Preferences.IgnoreDocumentDateValidation)&&(e="Document Date should be less than or equal to W.E.F Date");else if(63==this.ScreenObject.DocumentType){var Ye=new Date,ze=this.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()}));if(!(null!=ze&&ze instanceof S.c&&ze.Date))return this.DisplayMessage="Please select the payroll month",this.MessageVisibility=!0,this.DisplayMessage;Ye=ze.Date;for(var Je=0;Je<this.ScreenObject.GridData.length;Je++)if(null!=this.ScreenObject.GridData[Je].dcCCNID51_Key&&null!=this.ScreenObject.GridData[Je].dcCCNID52_Key){if(null!=this.ScreenObject.GridData[Je].dcAlpha4_Key&&new Date(this.DocumentDate)>new Date(this.ScreenObject.GridData[Je].dcAlpha4_Key)&&this.ScreenObject.Preferences.ContainsKey("IgnoreDocumentDateValidation")&&!Object(l.j)(this.ScreenObject.Preferences.IgnoreDocumentDateValidation)){e="Document Date should be less than or equal to From Date";break}if(null!=this.ScreenObject.GridData[Je].dcAlpha7&&parseFloat(this.ScreenObject.GridData[Je].dcAlpha7)<=0){e="Dates already applied | Selected dates between holidays or weeklyoffs dates";break}if(null!=this.ScreenObject.GridData[Je].dcAlpha8&&(parseInt(this.ScreenObject.GridData[Je].dcAlpha8)>=0||-4==parseInt(this.ScreenObject.GridData[Je].dcAlpha8))){if(null!=this.ScreenObject.GridData[Je].dcAlpha3&&parseFloat(this.ScreenObject.GridData[Je].dcAlpha3)<=0){e="Please check the Payroll structure/Available leaves for the selected month";break}if(null!=this.ScreenObject.GridData[Je].dcNum1&&null!=this.ScreenObject.GridData[Je].dcAlpha7&&parseFloat(this.ScreenObject.GridData[Je].dcNum1)>parseFloat(this.ScreenObject.GridData[Je].dcAlpha3)){e="Cannot apply leaves more than Available leaves";break}}if(!o.e.IsEmpty(this.ScreenObject.GridData[Je].dcAlpha6)||"1"==o.e.String(this.ScreenObject.GridData[Je].dcAlpha6)||"2"==o.e.String(this.ScreenObject.GridData[Je].dcAlpha6)||"3"==o.e.String(this.ScreenObject.GridData[Je].dcAlpha6)){e="Please select the session type";break}if(null!=this.ScreenObject.GridData[Je].dcAlpha4_Key&&null!=this.ScreenObject.GridData[Je].dcAlpha5_Key){if(new Date(this.ScreenObject.GridData[Je].dcAlpha4_Key).ToString("MMM/yyyy")!=new Date(Ye).ToString("MMM/yyyy")){e="From date should be from payroll month";break}if(new Date(this.ScreenObject.GridData[Je].dcAlpha5_Key).ToString("MMM/yyyy")!=new Date(Ye).ToString("MMM/yyyy")){e="To date should be from payroll month";break}}}}if(62==this.ScreenObject.DocumentType&&this.ScreenObject.GridData.length>0){var Ze,$e=function(){for(var e,n="",a=0,i=0,r=0,c=0,l=t.ScreenObject.GridData.filter((function(e){return!o.e.IsEmpty(e.dcCCNID52)})),u=[],d=function(e){var t=u.find((function(t){return t.LQLeaveType==l[e].dcCCNID52}));if(t)t.LQTotNoofDays=o.e.Double(t.LQTotNoofDays)+o.e.Double(l[e].dcAlpha7);else{var n={LQLeaveType:l[e].dcCCNID52,LQTotNoofDays:o.e.Double(l[e].dcAlpha7),LQAssignedDays:o.e.Double(l[e].dcAlpha2),LQAvlblDays:o.e.Double(l[e].dcAlpha3),LQAtATime:o.e.Double(l[e].dcAlpha8),LQMaxLeaves:o.e.Double(l[e].dcAlpha9)};u.push(n)}},D=0;D<l.length;D++)d(D);for(var h=function(l){var d=u[l];if(a=i=r=0,c=Math.abs(parseFloat(d.LQAtATime)),d.LQAtATime<0?d.LQTotNoofDays<c&&(n=n+"Apply minimum "+c+" days for this Leave Type\r\n"):d.LQTotNoofDays>c&&(n=n+"Can't Apply leaves more than AtATime leaves("+d.LQAtATime+") for leave type '"+d.LQLeaveType+"'\r\n"),d.LQTotNoofDays<=0&&(n=n+"Please check the NoOfDays for leave type '"+d.LQLeaveType+"'\r\n"),d.LQMaxLeaves>=0)d.LQTotNoofDays>d.LQAvlblDays&&(n=n+"Can't Apply leaves more than available leaves("+d.LQAvlblDays+") for leave type '"+d.LQLeaveType+"'\r\n");else if(-3==d.LQMaxLeaves){if((Ze=t.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})))&&(Ze instanceof C.b&&!o.e.IsEmpty(Ze.Text)||Ze instanceof p.a&&!o.e.IsEmpty(Ze.Text))){var D="";(Ze instanceof C.b||Ze instanceof p.a)&&(D=D+" AND CC.dccCNID51= "+Ze.SelectedValue),(e=t.ScreenObject.GridData.filter((function(e){return e.dccCNID52==d.LQLeaveType.toString()&&e.dcAlpha9==d.LQMaxLeaves}))).length>0&&(D=D+" AND CC.dccCNID52= "+parseInt(e[0].dccCNID52_Key));var h=s.a.common.GetDataSet3("PAY023",t.DocID.toString(),D);null!=h&&h.Tables[0].length>0&&parseInt(h.Tables[0][0][0])>0&&(n+="Can't apply morethan once in your Service for this Leave type")}}else if(-4==d.LQMaxLeaves&&(e=t.ScreenObject.GridData.filter((function(e){return e.dccCNID52==d.LQLeaveType.toString()&&e.dcAlpha9==d.LQMaxLeaves}))).length>0){var S=new Date(parseInt(new Date(e[0].dcAlpha4_Key).ToString("yyyy")),parseInt(s.a.SessionManager.Preferences.LeaveYear.toString()),1),m=S.AddMonths(12).AddDays(-1);if((Ze=t.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})))&&(Ze instanceof C.b&&!o.e.IsEmpty(Ze.Text)||Ze instanceof p.a&&!o.e.IsEmpty(Ze.Text))){var b=[];b.push(S.ToString("dd/MMM/yyyy")),b.push(m.ToString("dd/MMM/yyyy")),(Ze instanceof C.b||Ze instanceof p.a)&&b.push(Ze.SelectedValue),b.push(parseInt(e[0].dccCNID52_Key)),b.push("Both"),b.push(s.a.SessionManager.UserID),b.push(s.a.SessionManager.LanguageID);var y=s.a.common.GetDataSet_SP(b,"spPAY_ExtGetAvlblNoofDays");if(null!=y&&y.Tables.length>0&&y.Tables[0].length>0){if(o.e.IsEmpty(y.Tables[0][0].LeavesTaken)||(a=parseFloat(y.Tables[0][0].LeavesTaken)),t.DocID>0){var g="";(Ze instanceof C.b||Ze instanceof p.a)&&(g=g+" AND CC.dccCNID51= "+Ze.SelectedValue),e.length>0&&(g=g+" AND CC.dccCNID52= "+parseInt(e[0].dccCNID52_Key));var f=s.a.common.GetDataSet3("PAY024",t.DocID.toString(),g);null!=f&&f.Tables[0].length>0&&parseInt(f.Tables[0][0][0])>0&&(r=parseFloat(f.Tables[0][0].NoofDays))}i=(a-=r)+parseFloat(d.LQTotNoofDays)}i>d.LQAssignedDays&&(n=n+"Can't Apply leaves more than Assigned leaves("+d.LQAssignedDays+") for leave type '"+d.LQLeaveType+"'\r\n")}}},S=0;S<u.length;S++)h(S);if(""!=n)return{v:(t.DisplayMessage=n,t.MessageVisibility=!0,n)}}();if("object"==typeof $e)return $e.v}if(56==this.ScreenObject.DocumentType&&"No"!=this.strEmpIsMgr.toString()){var et=this.ScreenObject._TextFields.filter((function(e){return e instanceof h.d})).find((function(e){return"dcalpha4"==e.DBColumnName.toLowerCase()}));if(et){if(0==parseFloat(et.Text))return this.DisplayMessage="Please Distribute Installments. No of Installments should be Grater Than 0",this.MessageVisibility=!0,this.DisplayMessage;if(this.ScreenObject.GridData.length>0){var tt,nt,at,it,rt="";tt=nt=at=it=0;var st=new Date,ct=new Date,lt="0";if((bt=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})))&&(bt instanceof C.b||bt instanceof p.a)&&(lt=bt.SelectedValue.toString()),(et=this.ScreenObject._TextFields.filter((function(e){return e instanceof S.c})).find((function(e){return"dcalpha5"==e.DBColumnName.toLowerCase()})))&&(st=new Date(et.Date)),this.ScreenObject.GridDataColumns.Contains("dcAlpha6_Key")&&this.ScreenObject.GridData.length>0&&null!=this.ScreenObject.GridData[0].dcAlpha6_Key&&null!=this.ScreenObject.GridData[0].dcAlpha6_Key&&""!=this.ScreenObject.GridData[0].dcAlpha6_Key.toString().Trim()&&(ct=new Date(this.ScreenObject.GridData[0].dcAlpha6_Key)),st.getMonth()!=ct.getMonth()||st.getFullYear()!=ct.getFullYear())return rt="Distribute Installments, Deduction Month should be same in Header and Line wise. \r\n",this.DisplayMessage=rt,this.MessageVisibility=!0,rt;if((et=this.ScreenObject._TextFields.filter((function(e){return e instanceof h.d})).find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()})))&&(tt=parseFloat(et.Text)),(et=this.ScreenObject._TextFields.filter((function(e){return e instanceof h.d})).find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()})))&&(nt=parseFloat(et.Text)),(et=this.ScreenObject._TextFields.filter((function(e){return e instanceof h.d})).find((function(e){return"dcalpha3"==e.DBColumnName.toLowerCase()})))&&(it=parseFloat(et.Text)),nt>tt)return rt="Approved loan amount should be less than or equal to Loan Amount\r\n",this.DisplayMessage=rt,this.MessageVisibility=!0,rt;if(parseFloat(this.ScreenObject.GridData.Compute("sum","dcNum2"))!=parseFloat(nt.ToString("N2")))return rt+="Total Installment(s) amount should be equal to Approved Amount\r\n",this.DisplayMessage=rt,this.MessageVisibility=!0,rt;if(it>nt)return rt+="Installment amount should be less than or equal to approved amount\r\n",this.DisplayMessage=rt,this.MessageVisibility=!0,rt;for(var ut=function(n){if(null!=t.ScreenObject.GridData[n].dcAlpha6_Key&&null!=t.ScreenObject.GridData[n].dcAlpha6_Key&&""!=t.ScreenObject.GridData[n].dcAlpha6_Key.toString().Trim()){if(""!=(e=t.IsDocLocked(lt,new Date(t.ScreenObject.GridData[n].dcAlpha6_Key),new Date(t.ScreenObject.GridData[n].dcAlpha6_Key),t.ScreenObject.DocumentType)))return"break";if(t.DocID>0){if(t.dsData=t.ScreenObject.CheckLoanRepayAmountDetails(t.DocID),0==t.dsData.Tables[1].filter((function(e){return e.LinkedInvDocDetailsID==parseInt(t.ScreenObject.GridData[n].DocDetailsID)})).length&&t.CheckIsPayrollProcessed(new Date(t.ScreenObject.GridData[n].dcAlpha6_Key).ToString("dd/MMM/yyyy"),lt))return rt=rt+"Payroll already processed for the Month : "+new Date(t.ScreenObject.GridData[n].dcAlpha6_Key).ToString("MMM/yyyy")+" to this Employee \r\n","break"}else if(t.CheckIsPayrollProcessed(new Date(t.ScreenObject.GridData[n].dcAlpha6_Key).ToString("dd/MMM/yyyy"),lt))return rt=rt+"Payroll already processed for the Month : "+new Date(t.ScreenObject.GridData[n].dcAlpha6_Key).ToString("MMM/yyyy")+" to this Employee \r\n","break"}},dt=0;dt<this.ScreenObject.GridData.length;dt++){if("break"===ut(dt))break}if(this.DocID>0){var Dt=this.ScreenObject.CheckLoanRepayAmountDetails(this.DocID);Dt.Tables.length>0&&Dt.Tables[0].length>0&&((at=parseFloat(Dt.Tables[0][0][0]))>0&&nt<at&&(rt+="Can't change the approved loan amount of linked document\r\n"))}if(""!=rt)return this.DisplayMessage=rt,this.MessageVisibility=!0,rt}}}if(58==this.ScreenObject.DocumentType&&this.ScreenObject.GridData.length>0){var ht=function(){for(var e="",n=t.ScreenObject.GridData.filter((function(e){return!o.e.IsEmpty(e.dcCCNID52)})),a=[],i=function(e){var t=a.find((function(t){return t.LQLeaveType==n[e].dcCCNID52}));if(t)t.LQTotAppliedDays=o.e.Double(t.LQTotAppliedDays)+o.e.Double(n[e].dcAlpha3);else{var i={LQLeaveType:n[e].dcCCNID52,LQTotAppliedDays:o.e.Double(n[e].dcAlpha3),LQAvlblDays:o.e.Double(n[e].dcAlpha1),LQMaxEncash:o.e.Double(n[e].dcAlpha2),LQAppliedDays:o.e.Double(n[e].dcAlpha5),LQThresholdLimit:o.e.Double(n[e].dcAdcAlpha8lpha9)};a.push(i)}},r=0;r<n.length;r++)i(r);for(var s=0;s<a.length;s++){var c=a[s];c.LQAppliedDays<0&&(e=e+"Please check the applied days for leave type '"+c.LQLeaveType+"'\r\n");var l=0;(l=c.LQAvlblDays-c.LQThresholdLimit)<0&&(l=0),l>c.LQMaxEncash&&(l=c.LQMaxEncash),c.LQTotAppliedDays>l&&(e=e+"You can not Encash more than ( "+l+" ) Days for leave type '"+c.LQLeaveType+"'\r\n")}if(""!=e)return{v:(t.DisplayMessage=e,t.MessageVisibility=!0,e)}}();if("object"==typeof ht)return ht.v}if(67==this.ScreenObject.DocumentType){var St,mt=function(){for(var n="",a="1",i=null,r=0;r<t.ScreenObject.GridData.length;r++)if(t.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&null!=t.ScreenObject.GridData[r].ProductID_Key&&null!=t.ScreenObject.GridData[r].ProductID_Key&&""!=t.ScreenObject.GridData[r].ProductID_Key.toString()){n="",a="1",i=t.ScreenObject.GridData[r];var c=t.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()}));if(null!=c?n=c.Date.ToString("dd/MMM/yyyy"):null==(St=t.ScreenObject.ColumnSource.find((function(e){return"dcalpha1"==e.DisplayMember.toLowerCase()})))||o.e.IsEmpty(i[St.DisplayMember+"_Key"])||(n=new Date(i[St.DisplayMember+"_Key"]).ToString("dd/MMM/yyyy")),null!=(c=t.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()})))?(c instanceof C.b||c instanceof p.a)&&(a=c.SelectedValue.toString()):null!=(St=t.ScreenObject.ColumnSource.find((function(e){return"LISTBOX"==e.DataType.toUpperCase()&&"dcccnid51_key"==e.ValueMember.toLowerCase()})))&&null!=i[St.ValueMember]&&null!=i[St.ValueMember]&&""!=i[St.ValueMember].toString()&&(a=i[St.ValueMember].toString()),""!=n&&parseInt(a)>1){if(""!=(e=t.IsDocLocked(a,new Date(n),new Date(n),t.ScreenObject.DocumentType))){if("PostingFromBiometric"==t.ScreenObject.ParentFlagName&&t.ScreenObject.Preferences.ContainsKey("SkipEmployeesWhoGetErrorsWhileSaving")&&!o.e.IsEmpty(t.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving)&&Object(l.j)(t.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving)){t.sBioErrLogs+="\r\n "+e+"\r\n ",t.ScreenObject.GridDataObj.removeRowAt(r),r--;continue}if(t.isDAValidate){t.sDAErrLogs+="\r\n "+e+"\r\n ",e="";continue}break}var u,d=void 0;if(null!=(u=t.GetHoursDefChart(n,i))&&u.length>0){var D=void 0,h=void 0,S=Date.Today(),m=Date.Today();t.drcc1=t.dtPayEmps.filter((function(e){return e.NodeID==a}));var b="",y={dtdblOld:m,sVoucherNo:b};if(t.GetTotalEnteredHours(a,n,"dcNum1",y),m=y.dtdblOld,b=y.sVoucherNo,t.sHrs=parseFloat(u[0].MaxHrsPerDay).ToTime("00.00").split("."),S=S.AddHours(parseFloat(t.sHrs[0])).AddMinutes(parseFloat(t.sHrs[1])),D=new ot.TimeSpan(S.ToNumber()),(h=new ot.TimeSpan(m.ToNumber())).TotalHours>D.TotalHours){if("PostingFromBiometric"==t.ScreenObject.ParentFlagName&&t.ScreenObject.Preferences.ContainsKey("SkipEmployeesWhoGetErrorsWhileSaving")&&""!=t.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving&&Object(l.j)(t.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving)){t.sBioErrLogs+="\r\n 'Total Hours' per day Exceeded for an Employee - "+t.drcc1[0].Code.toString()+b+"\r\n ",t.ScreenObject.GridDataObj.removeRowAt(r),r--;continue}if(t.isDAValidate){t.sDAErrLogs+="\r\n 'Total Hours' per day Exceeded for an Employee - "+t.drcc1[0].Code.toString()+b+"\r\n ";continue}return{v:(t.DisplayMessage="'Total Hours' per day Exceeded for an Employee - "+t.drcc1[0].Code.toString()+b,t.MessageVisibility=!0,t.DisplayMessage)}}if(S=Date.Today(),y={dtdblOld:m,sVoucherNo:b},t.GetTotalEnteredHours(a,n,"dcNum2",y),m=y.dtdblOld,b=y.sVoucherNo,t.sHrs=parseFloat(u[0].NormalHrs).ToTime("00.00").split("."),S=S.AddHours(parseFloat(t.sHrs[0])).AddMinutes(parseFloat(t.sHrs[1])),D=new ot.TimeSpan(S.valueOf()),h=new ot.TimeSpan(m.valueOf()),parseFloat(h.TotalHours)>parseFloat(D.TotalHours)){if("PostingFromBiometric"==t.ScreenObject.ParentFlagName&&t.ScreenObject.Preferences.ContainsKey("SkipEmployeesWhoGetErrorsWhileSaving")&&""!=t.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving&&Object(l.j)(t.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving)){t.sBioErrLogs+="\r\n 'Normal Working Hours' Exceeded for an Employee - "+t.drcc1[0].Code.toString()+b+"\r\n ",t.ScreenObject.GridDataObj.removeRowAt(r),r--;continue}if(t.isDAValidate){t.sDAErrLogs+="\r\n 'Normal Working Hours' Exceeded for an Employee - "+t.drcc1[0].Code.toString()+b+"\r\n ";continue}return{v:(Logger.DebugLog("Entered into the TRUE Block"),t.DisplayMessage="'Normal Working Hours' Exceeded for an Employee - "+t.drcc1[0].Code.toString()+b,t.MessageVisibility=!0,t.DisplayMessage)}}if(Logger.DebugLog("Entered into the FLASE Block"),S=Date.Today(),y={dtdblOld:m,sVoucherNo:b},t.GetTotalEnteredHours(a,n,"dcNum4",y),m=y.dtdblOld,b=y.sVoucherNo,t.sHrs=parseFloat(u[0].BreakHrs).ToTime("00.00").split("."),S=S.AddHours(parseFloat(t.sHrs[0])).AddMinutes(parseFloat(t.sHrs[1])),D=new ot.TimeSpan(S.ToNumber()),(h=new ot.TimeSpan(m.ToNumber())).TotalHours>D.TotalHours){if("PostingFromBiometric"==t.ScreenObject.ParentFlagName&&t.ScreenObject.Preferences.ContainsKey("SkipEmployeesWhoGetErrorsWhileSaving")&&""!=t.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving&&Object(l.j)(t.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving)){t.sBioErrLogs+="\r\n 'Break Hours' Exceeded for an Employee - "+t.drcc1[0].Code.toString()+b+"\r\n ",t.ScreenObject.GridDataObj.removeRowAt(r),r--;continue}if(t.isDAValidate){t.sDAErrLogs+="\r\n 'Break Hours' Exceeded for an Employee - "+t.drcc1[0].Code.toString()+b+"\r\n ";continue}return{v:(t.DisplayMessage="'Break Hours' Exceeded for an Employee - "+t.drcc1[0].Code.toString()+b,t.MessageVisibility=!0,t.DisplayMessage)}}if(S=Date.Today(),y={dtdblOld:m,sVoucherNo:b},t.GetTotalEnteredHours(a,n,"dcNum5",y),m=y.dtdblOld,b=y.sVoucherNo,t.sHrs=parseFloat(u[0].OT1).ToTime("00.00").split("."),S=S.AddHours(parseFloat(t.sHrs[0])).AddMinutes(parseFloat(t.sHrs[1])),D=new ot.TimeSpan(S.ToNumber()),(h=new ot.TimeSpan(m.ToNumber())).TotalHours>D.TotalHours){if(t.drcc2=t.ScreenObject.Data.Tables[0].filter((function(e){return"dcNum5"==e.SysColumnName})),"PostingFromBiometric"==t.ScreenObject.ParentFlagName&&t.ScreenObject.Preferences.ContainsKey("SkipEmployeesWhoGetErrorsWhileSaving")&&""!=t.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving&&Object(l.j)(t.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving)){t.sBioErrLogs+="\r\n '"+t.drcc2[0].UserColumnName.toString()+"' Hours Exceeded for an Employee - "+t.drcc1[0].Code.toString()+b+"\r\n ",t.ScreenObject.GridDataObj.removeRowAt(r),r--;continue}if(t.isDAValidate){t.sDAErrLogs+="\r\n '"+t.drcc2[0].UserColumnName.toString()+"' Hours Exceeded for an Employee - "+t.drcc1[0].Code.toString()+b+"\r\n ";continue}return{v:(t.DisplayMessage="'"+t.drcc2[0].UserColumnName.toString()+"' Hours Exceeded for an Employee - "+t.drcc1[0].Code.toString()+b,t.MessageVisibility=!0,t.DisplayMessage)}}if(S=Date.Today(),y={dtdblOld:m,sVoucherNo:b},t.GetTotalEnteredHours(a,n,"dcNum7",y),m=y.dtdblOld,b=y.sVoucherNo,t.sHrs=parseFloat(u[0].OT2).ToTime("00.00").split("."),S=S.AddHours(parseFloat(t.sHrs[0])).AddMinutes(parseFloat(t.sHrs[1])),D=new ot.TimeSpan(S.ToNumber()),(h=new ot.TimeSpan(m.ToNumber())).TotalHours>D.TotalHours){if(t.drcc2=t.ScreenObject.Data.Tables[0].filter((function(e){return"dcNum7"==e.SysColumnName})),"PostingFromBiometric"==t.ScreenObject.ParentFlagName&&t.ScreenObject.Preferences.ContainsKey("SkipEmployeesWhoGetErrorsWhileSaving")&&""!=t.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving&&Object(l.j)(t.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving)){t.sBioErrLogs+="\r\n '"+t.drcc2[0].UserColumnName.toString()+"' Hours Exceeded for an Employee - "+t.drcc1[0].Code.toString()+b+"\r\n ",t.ScreenObject.GridDataObj.removeRowAt(r),r--;continue}if(t.isDAValidate){t.sDAErrLogs+="\r\n '"+t.drcc2[0].UserColumnName.toString()+"' Hours Exceeded for an Employee - "+t.drcc1[0].Code.toString()+b+"\r\n ";continue}return{v:(t.DisplayMessage="'"+t.drcc2[0].UserColumnName.toString()+"' Hours Exceeded for an Employee - "+t.drcc1[0].Code.toString()+b,t.MessageVisibility=!0,t.DisplayMessage)}}if(S=Date.Today(),y={dtdblOld:m,sVoucherNo:b},t.GetTotalEnteredHours(a,n,"dcNum9",y),m=y.dtdblOld,b=y.sVoucherNo,t.sHrs=parseFloat(u[0].OT3).ToTime("00.00").split("."),S=S.AddHours(parseFloat(t.sHrs[0])).AddMinutes(parseFloat(t.sHrs[1])),D=new ot.TimeSpan(S.ToNumber()),(h=new ot.TimeSpan(m.ToNumber())).TotalHours>D.TotalHours){if(t.drcc2=t.ScreenObject.Data.Tables[0].filter((function(e){return"dcNum9"==e.SysColumnName})),"PostingFromBiometric"==t.ScreenObject.ParentFlagName&&t.ScreenObject.Preferences.ContainsKey("SkipEmployeesWhoGetErrorsWhileSaving")&&""!=t.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving&&Object(l.j)(t.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving)){t.sBioErrLogs+="\r\n '"+t.drcc2[0].UserColumnName.toString()+"' Hours Exceeded for an Employee - "+t.drcc1[0].Code.toString()+b+"\r\n ",t.ScreenObject.GridDataObj.removeRowAt(r),r--;continue}if(t.isDAValidate){t.sDAErrLogs+="\r\n '"+t.drcc2[0].UserColumnName.toString()+"' Hours Exceeded for an Employee - "+t.drcc1[0].Code.toString()+b+"\r\n ";continue}return{v:(t.DisplayMessage="'"+t.drcc2[0].UserColumnName.toString()+"' Hours Exceeded for an Employee - "+t.drcc1[0].Code.toString()+b,t.MessageVisibility=!0,t.DisplayMessage)}}if(S=Date.Today(),y={dtdblOld:m,sVoucherNo:b},t.GetTotalEnteredHours(a,n,"dcNum11",y),m=y.dtdblOld,b=y.sVoucherNo,t.sHrs=parseFloat(u[0].OT4).ToTime("00.00").split("."),S=S.AddHours(parseFloat(t.sHrs[0])).AddMinutes(parseFloat(t.sHrs[1])),D=new ot.TimeSpan(S.ToNumber()),(h=new ot.TimeSpan(m.ToNumber())).TotalHours>D.TotalHours){if(t.drcc2=t.ScreenObject.Data.Tables[0].filter((function(e){return"dcNum11"==e.SysColumnName})),"PostingFromBiometric"==t.ScreenObject.ParentFlagName&&t.ScreenObject.Preferences.ContainsKey("SkipEmployeesWhoGetErrorsWhileSaving")&&""!=t.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving&&Object(l.j)(t.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving)){t.sBioErrLogs+="\r\n '"+t.drcc2[0].UserColumnName.toString()+"' Hours Exceeded for an Employee - "+t.drcc1[0].Code.toString()+b+"\r\n ",t.ScreenObject.GridDataObj.removeRowAt(r),r--;continue}if(t.isDAValidate){t.sDAErrLogs+="\r\n '"+t.drcc2[0].UserColumnName.toString()+"' Hours Exceeded for an Employee - "+t.drcc1[0].Code.toString()+b+"\r\n ";continue}return{v:(t.DisplayMessage="'"+t.drcc2[0].UserColumnName.toString()+"' Hours Exceeded for an Employee - "+t.drcc1[0].Code.toString()+b,t.MessageVisibility=!0,t.DisplayMessage)}}if(S=Date.Today(),y={dtdblOld:m,sVoucherNo:b},t.GetTotalEnteredHours(a,n,"dcNum13",y),m=y.dtdblOld,b=y.sVoucherNo,t.sHrs=parseFloat(u[0].OT5).ToTime("00.00").split("."),S=S.AddHours(parseFloat(t.sHrs[0])).AddMinutes(parseFloat(t.sHrs[1])),D=new ot.TimeSpan(S.ToNumber()),(h=new ot.TimeSpan(m.ToNumber())).TotalHours>D.TotalHours){if(t.drcc2=t.ScreenObject.Data.Tables[0].filter((function(e){return"dcNum13"==e.SysColumnName})),"PostingFromBiometric"==t.ScreenObject.ParentFlagName&&t.ScreenObject.Preferences.ContainsKey("SkipEmployeesWhoGetErrorsWhileSaving")&&""!=t.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving&&Object(l.j)(t.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving)){t.sBioErrLogs+="\r\n '"+t.drcc2[0].UserColumnName.toString()+"' Hours Exceeded for an Employee - "+t.drcc1[0].Code.toString()+b+"\r\n ",t.ScreenObject.GridDataObj.removeRowAt(r),r--;continue}if(t.isDAValidate){t.sDAErrLogs+="\r\n '"+t.drcc2[0].UserColumnName.toString()+"' Hours Exceeded for an Employee - "+t.drcc1[0].Code.toString()+b+"\r\n ";continue}return{v:(t.DisplayMessage="'"+t.drcc2[0].UserColumnName.toString()+"' Hours Exceeded for an Employee - "+t.drcc1[0].Code.toString()+b,t.MessageVisibility=!0,t.DisplayMessage)}}}if(""!=n&&parseInt(a)>1&&null!=t.dtPayEmps&&t.dtPayEmps.length>0&&(null!=(d=t.dtPayEmps.filter((function(e){return e.NodeId==a&&e.DOJ>new Date(n.toString())})))&&d.length>0&&new Date(d[0].DOJ.toString())>new Date(n.toString()))){if("PostingFromBiometric"==t.ScreenObject.ParentFlagName&&t.ScreenObject.Preferences.ContainsKey("SkipEmployeesWhoGetErrorsWhileSaving")&&""!=t.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving&&Object(l.j)(t.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving)){t.sBioErrLogs+="\r\n Please Check The Employee Dependency With date Of joining "+d[0].Code.toString()+"\r\n ",t.ScreenObject.GridDataObj.removeRowAt(r),r--;continue}if(t.isDAValidate){t.sDAErrLogs+="\r\n Please Check The Employee Dependency With date Of joining "+d[0].Code.toString()+"\r\n ";continue}return{v:(t.DisplayMessage="Please Check The Employee Dependency With date Of joining "+d[0].Code.toString(),t.MessageVisibility=!0,t.DisplayMessage)}}var g=new Date(n),f=new Date(n).AddDays(1);o.e.IsEmpty(t.ScreenObject.GridData[r].dcalpha2)||o.e.IsEmpty(t.ScreenObject.GridData[r].dcalpha2_Key)||o.e.IsEmpty(t.ScreenObject.GridData[r].dcalpha3)||o.e.IsEmpty(t.ScreenObject.GridData[r].dcalpha3_Key)||new Date(n).ToString("dd/MMM/yyyy")!=new Date(t.ScreenObject.GridData[r].dcAlpha2_Key).ToString("dd/MMM/yyyy")&&(t.ScreenObject.GridData[r].dcAlpha2_Key=new Date(n).AddHours(new Date(t.ScreenObject.GridData[r].dcAlpha2_Key).getHours()).AddMinutes(new Date(t.ScreenObject.GridData[r].dcAlpha2_Key).getMinutes()).ToString("dd/MMM/yyyy HH:mm"),t.ScreenObject.GridData[r].dcAlpha3_Key=new Date(t.ScreenObject.GridData[r].dcalpha2)>new Date(t.ScreenObject.GridData[r].dcalpha3)?new Date(f).AddHours(new Date(t.ScreenObject.GridData[r].dcAlpha3_Key).getHours()).AddMinutes(new Date(t.ScreenObject.GridData[r].dcAlpha3_Key).getMinutes()).ToString("dd/MMM/yyyy HH:mm"):new Date(g).AddHours(new Date(t.ScreenObject.GridData[r].dcAlpha3_Key).getHours()).AddMinutes(new Date(t.ScreenObject.GridData[r].dcAlpha3_Key).getMinutes()).ToString("dd/MMM/yyyy HH:mm"));var O=t.ScreenObject.ColumnSource.find((function(e){return"dcalpha2"==e.DisplayMember.toLowerCase()})),I=t.ScreenObject.ColumnSource.find((function(e){return"dcalpha3"==e.DisplayMember.toLowerCase()}));if(null!=O&&O.IsVisible&&null!=I&&I.IsVisible){t.drcc1=t.dtPayEmps.filter((function(e){return e.NodeID==a}));var T=t.GetDuplicateTimingsOfEmployee(n,a,r);if(""!=T){try{parseInt(T),e="Employee has already worked on these timings, can't allow same timings. Check Timings of the Employee - "+t.drcc1[0].Code.toString()+" @ Row No - "+parseInt(T)}catch(A){e="Employee has already worked on these timings, can't allow same timings. Check Timings of the Employee - "+t.drcc1[0].Code.toString()+" @ Voucher No - "+T}if("PostingFromBiometric"==t.ScreenObject.ParentFlagName&&t.ScreenObject.Preferences.ContainsKey("SkipEmployeesWhoGetErrorsWhileSaving")&&""!=t.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving&&Object(l.j)(t.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving)){t.sBioErrLogs+="\r\n "+e+"\r\n ",e="",t.ScreenObject.GridDataObj.removeRowAt(r),r--;continue}if(t.isDAValidate){t.sDAErrLogs+="\r\n "+e+"\r\n ",e="";continue}break}}if(s.a.SessionManager.Preferences.ContainsKey("AllowDailyPayrollEntryforEmpOnleave")&&Object(l.j)("False"==s.a.SessionManager.Preferences.AllowDailyPayrollEntryforEmpOnleave)){t.drcc1=t.dtPayEmps.filter((function(e){return e.NodeID==a}));var j=s.a.common.GetDataSet3("PAY025",a,n).Tables[0];if(null!=j&&j.length>0&&""!=o.e.String(j[0].LeaveMessage)){if("PostingFromBiometric"==t.ScreenObject.ParentFlagName&&t.ScreenObject.Preferences.ContainsKey("SkipEmployeesWhoGetErrorsWhileSaving")&&""!=t.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving&&Object(l.j)(t.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving)){t.sBioErrLogs+="\r\n "+j[0].LeaveMessage.toString()+" Check for the Employee - "+t.drcc1[0].Code.toString()+"\r\n ",t.ScreenObject.GridDataObj.removeRowAt(r),r--;continue}if(t.isDAValidate){t.sDAErrLogs+="\r\n "+j[0].LeaveMessage.toString()+" Check for the Employee - "+t.drcc1[0].Code.toString()+"\r\n ";continue}return{v:(t.DisplayMessage=j[0].LeaveMessage.toString()+" Check for the Employee - "+t.drcc1[0].Code.toString()+" @ Row No - "+(r+1),t.MessageVisibility=!0,t.DisplayMessage)}}}t.drcc1=t.dtPayEmps.filter((function(e){return e.NodeID==a}));var P=s.a.common.GetDataSet3("PAY026",a,n).Tables[0];if(null!=P&&P.length>0){if("PostingFromBiometric"==t.ScreenObject.ParentFlagName&&t.ScreenObject.Preferences.ContainsKey("SkipEmployeesWhoGetErrorsWhileSaving")&&""!=t.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving&&Object(l.j)(t.ScreenObject.Preferences.SkipEmployeesWhoGetErrorsWhileSaving)){t.sBioErrLogs+="\r\n Lates Processed For Employee - "+t.drcc1[0].Code.toString()+" @ Voucher No - "+P[0].VoucherNo+"\r\n ",t.ScreenObject.GridDataObj.removeRowAt(r),r--;continue}if(t.isDAValidate){t.sDAErrLogs+="\r\n Lates Processed For Employee - "+t.drcc1[0].Code.toString()+" @ Voucher No - "+P[0].VoucherNo+"\r\n ";continue}return{v:(t.DisplayMessage="Lates Processed For Employee - "+t.drcc1[0].Code.toString()+"@ Row No - "+(r+1)+" @ Voucher No - "+P[0].VoucherNo,t.MessageVisibility=!0,t.DisplayMessage)}}}}}();if("object"==typeof mt)return mt.v}if(92==this.ScreenObject.DocumentType){var bt,Ct="DayWise";(bt=this.ScreenObject._TextFields.find((function(e){return"dcalpha4"==e.DBColumnName.toLowerCase()})))instanceof m.e&&(Ct=bt.SelectedValue);var yt,pt,gt,ft=null;if("DayWise"==Ct){for(var Ot,It,Tt=0,jt=0;jt<this.ScreenObject.ColumnSource.length;jt++)if(null!=this.ScreenObject.ColumnSource[jt].DrRefColName&&""!=this.ScreenObject.ColumnSource[jt].DrRefColName&&"Date"==this.ScreenObject.ColumnSource[jt].DrRefColName){Tt++;break}if(0==Tt)return"No dates found. Assign atlest for one day.";if(Ot=this.ScreenObject.CustomTab.Pages[0].Fields.find((function(e){return e instanceof S.c&&"dcAlpha1"==e.DBColumnName})),It=this.ScreenObject.CustomTab.Pages[0].Fields.find((function(e){return e instanceof S.c&&"dcAlpha2"==e.DBColumnName})),new Date(this.ScreenObject.GridDataColumns[this.iDtColFrom].Replace("_Key","")).OnlyDate()!=Ot.Date)return this.DisplayMessage="Dates should be in between From Date and To Date",this.MessageVisibility=!0,this.DisplayMessage;if(new Date(this.ScreenObject.GridDataColumns[this.iDtColUpto].Replace("_Key","")).Date()!=It.Date)return this.DisplayMessage="Dates should be in between From Date and To Date",this.MessageVisibility=!0,this.DisplayMessage;if(this.ScreenObject.GridData.length>0){for(var Pt="",At="",Mt=0;Mt<this.ScreenObject.GridData.length;Mt++)if(!o.e.IsEmpty(this.ScreenObject.GridData[Mt].dcCCNID51_Key)&&(Pt=this.ScreenObject.GridData[Mt].dcCCNID51_Key.toString(),null!=(ft=s.a.common.GetDataSet("PAY027",Pt).Tables[0])&&ft.length>0&&Ot.Date<new Date(ft[0].DateOfJoining).Date))return this.DisplayMessage="From Date should be Grater than or Equal to the Date of Joining of the Employee : "+this.ScreenObject.GridData[Mt].dcCCNID51Code.toString(),this.MessageVisibility=!0,this.DisplayMessage;for(var vt=0;vt<this.ScreenObject.GridData.length;vt++)if(!o.e.IsEmpty(this.ScreenObject.GridData[vt].dcCCNID51_Key)){Pt=this.ScreenObject.GridData[vt].dcCCNID51_Key.toString();for(var Gt=0;Gt<this.ScreenObject.GridData.length;Gt++)if(vt!=Gt&&o.e.String(this.ScreenObject.GridData[Gt].dcCCNID51_Key)==Pt)return this.DisplayMessage="Shifts already asssigned for the Employee : "+this.ScreenObject.GridData[vt].dcCCNID51Code.toString()+", check at Row : "+(Gt+1),this.MessageVisibility=!0,this.DisplayMessage}if(this.ScreenObject.Preferences.ContainsKey("AllowMultipleShiftAssignonsameday")&&!o.e.IsEmpty(this.ScreenObject.Preferences.AllowMultipleShiftAssignonsameday)&&"False"==this.ScreenObject.Preferences.AllowMultipleShiftAssignonsameday)for(var Nt=0;Nt<this.ScreenObject.GridData.length;Nt++)for(var Et=this.iDtColFrom;Et<=this.iDtColUpto;Et++)if(this.ScreenObject.GridDataColumns[Et].endsWith("_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[Nt].dcCCNID51_Key)&&(Pt=this.ScreenObject.GridData[Nt].dcCCNID51_Key.toString(),At=this.ScreenObject.GridDataColumns[Et].Replace("_Key",""),null!=(ft=s.a.common.GetDataSet3("PAY028",Pt,new Date(At).ToString("dd/MMM/yyyy"),this.ScreenObject.DocID.toString()).Tables[0])&&ft.length>0))return this.DisplayMessage="Shifts already asssigned for the Employee : "+this.ScreenObject.GridData[Nt].dcCCNID51Code.toString()+", Dated : "+At+", check at Voucher No : "+ft[0].VoucherNo.toString(),this.MessageVisibility=!0,this.DisplayMessage}}else if(this.ScreenObject.GridDataColumns.Contains("dcCCNID51_Key")){var wt=function(){for(var e=0,n=0;n<t.ScreenObject.GridData.length;n++)if(!o.e.IsEmpty(t.ScreenObject.GridData[n].dcCCNID51_Key)){e++;break}if(0==e)return{v:"No dates found. Assign atlest for one day."};var a="",i="",r="";ft=s.a.common.GetDataTable("PAY097",t.ScreenObject.DocID.toString());for(var c=function(e){if(!o.e.IsEmpty(t.ScreenObject.GridData[e].dcCCNID51_Key)){if(null,pt=null,null,a=t.ScreenObject.GridData[e].dcCCNID51_Key.toString(),i=new Date(t.ScreenObject.GridData[e].dcAlpha5_Key).ToString("dd MMM yyyy"),r=new Date(t.ScreenObject.GridData[e].dcAlpha6_Key).ToString("dd MMM yyyy"),new Date(i).Date>new Date(r).Date)return{v:{v:"AssignFrom Date should be lessthan or equal to AssignUpto Date @ Row No. "+(e+1).toString()}};if(null!=(yt=t.dtPayEmps.filter((function(e){return e.NodeId==a})))&&yt.length>0&&parseInt(a)>1&&new Date(i).Date<new Date(yt[0].DOJ).Date)return{v:{v:(t.DisplayMessage="AssignFrom Date should be Grater than or Equal to the Date of Joining of the Employee : "+t.ScreenObject.GridData[e].dcCCNID51.toString()+" @ Row No. "+(e+1).toString(),t.DisplayMessage)}};if(null!=(gt=t.ScreenObject.GridData.filter((function(t){return t.dcCCNID51_Key==a&&t.DocSeqNo!=e+1&&(t.dcAlpha5_Key<=i&&t.dcAlpha6_Key>=i||t.dcAlpha5_Key<=r&&t.dcAlpha6_Key>=r||t.dcAlpha5_Key>=i&&t.dcAlpha6_Key<=r)})))&&gt.length>0)return{v:{v:(t.DisplayMessage="Shifts already asssigned for the Employee : "+t.ScreenObject.GridData[e].dcccnid51.toString()+", check at Row : "+gt[0].DocSeqNo,t.MessageVisibility=!0,t.DisplayMessage)}};if(t.ScreenObject.Preferences.ContainsKey("AllowMultipleShiftAssignonsameday")&&!o.e.IsEmpty(t.ScreenObject.Preferences.AllowMultipleShiftAssignonsameday)&&"False"==t.ScreenObject.Preferences.AllowMultipleShiftAssignonsameday&&null!=ft&&ft.length>0&&(null!=(pt=ft.filter((function(e){return e.dcCCNID51==a&&(e.dcAlpha5<=i&&e.dcAlpha6>=i||e.dcAlpha5<=r&&e.dcAlpha6>=r||e.dcAlpha5>=i&&e.dcAlpha6<=r)})))&&pt.length>0))return{v:{v:(t.DisplayMessage="Shifts already asssigned for the Employee : "+t.ScreenObject.GridData[e].dcccnid51.toString()+",  @ Row No. : "+(e+1)+", check at Voucher No : "+pt[0].VoucherNo.toString(),t.MessageVisibility=!0,t.DisplayMessage)}}}},l=0;l<t.ScreenObject.GridData.length;l++){var u=c(l);if("object"==typeof u)return u.v}}();if("object"==typeof wt)return wt.v}}if(98==this.ScreenObject.DocumentType){var Ft=this.ScreenObject._TextFields.find((function(e){return"DCALPHA1"==e.DBColumnName.toUpperCase()}));if(Ft instanceof C.b&&Ft.SelectedValue>0){var Vt=this.ScreenObject._CCFields.find((function(e){return"DCCCNID51"==e.DBColumnName.toUpperCase()}));if(Vt instanceof C.b&&Ft.SelectedValue==Vt.SelectedValue)return"Delegator and Delegatee should not be same."}var Lt=this.ScreenObject._TextFields.find((function(e){return"DCALPHA3"==e.DBColumnName.toUpperCase()}));if(Lt instanceof m.e&&null!=Lt.SelectedValue&&"Temporary"==Lt.SelectedValue){if((Rt=this.ScreenObject._TextFields.find((function(e){return"DCALPHA4"==e.DBColumnName.toUpperCase()})))instanceof S.c&&!Rt.Date)return"'Period From' and 'Period Upto' is Mandatory when the Type is 'Temporary'";if((Rt=this.ScreenObject._TextFields.find((function(e){return"DCALPHA5"==e.DBColumnName.toUpperCase()})))instanceof S.c&&!Rt.Date)return"'Period From' and 'Period Upto' is Mandatory when the Type is 'Temporary'"}else{var Rt;if(null!=(Rt=this.ScreenObject._TextFields.find((function(e){return"DCALPHA4"==e.DBColumnName.toUpperCase()})))&&Rt instanceof S.c&&!Rt.Date)return"'Period From' is Mandatory when the Type is 'Permanent'";if(!confirm("Do you want to update the Delegatee at Employee Level.?"))return"Cancelled by the User."}}if(75==this.ScreenObject.DocumentType){var Bt=s.a.common.GetDataSet("PAY067",this.ScreenObject.DocID.toString()).Tables[0];if(null!=Bt&&Bt.length>0)return this.DisplayMessage="Final Settlement Already Posted For This Grade",this.MessageVisibility=!0,this.DisplayMessage}if(77==this.ScreenObject.DocumentType){var xt=function(){var e=0,n="",a="",i=s.a.common.GetDataSet("PAY068","");if(null!=i&&i.Tables.length>0&&null!=i.Tables[0]&&i.Tables[0].length>0){for(var r=0;r<i.Tables[0].length;r++){n=i.Tables[0][r].SysColumnName.toString();var o=t.ScreenObject._CCFields.find((function(e){return e.DBColumnName.toLowerCase()==n.toLowerCase()}));null!=o&&null!=o&&(o instanceof C.b||o instanceof p.a)&&(e=o.SelectedValue),a+=" AND "+n+"="+e}var c=s.a.common.GetDataSet3("PAY069",JSON.stringify(a),t.DocID.toString(),"").Tables[0];if(null!=c&&c.length>0)return{v:(t.DisplayMessage="Data Already Available for this Dimensions on Document No. - "+c[0].VoucherNo,t.MessageVisibility=!0,t.DisplayMessage)}}}();if("object"==typeof xt)return xt.v}if(99==this.ScreenObject.DocumentType){for(var kt="",_t="1",Kt=null,Qt=0;Qt<this.ScreenObject.GridData.length;Qt++){if(this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[Qt].ProductID_Key)){kt="",_t="1",Kt=this.ScreenObject.GridData[Qt];var Ht=this.ScreenObject._TextFields.find((function(e){return"dcAlpha3"==e.DBColumnName.toLowerCase()}));if(null!=Ht)kt=Ht.Date.ToString("dd/MMM/yyyy");else{var Wt=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha3"==e.DisplayMember.toLowerCase()}));null==Wt||o.e.IsEmpty(Kt[Wt.DisplayMember+"_Key"])||(kt=new Date(Kt[Wt.DisplayMember+"_Key"]).ToString("dd/MMM/yyyy"))}if(null!=(Ht=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}))))(Ht instanceof C.b||Ht instanceof p.a)&&(_t=Ht.SelectedValue.toString());else{var Ut=this.ScreenObject.ColumnSource.find((function(e){return"LISTBOX"==e.DataType.toUpperCase()&&"dcccnid51_key"==e.ValueMember.toLowerCase()}));null==Ut||o.e.IsEmpty(Kt[Ut.ValueMember])||(_t=Kt[Ut.ValueMember].toString())}if(""!=kt&&parseInt(_t)>1){var Xt=new Date(kt),qt=new Date(kt).AddDays(1);null!=this.ScreenObject.GridData[Qt].dcAlpha8&&null!=this.ScreenObject.GridData[Qt].dcAlpha8&&""!=this.ScreenObject.GridData[Qt].dcAlpha8.toString()&&null!=this.ScreenObject.GridData[Qt].dcAlpha8_Key&&null!=this.ScreenObject.GridData[Qt].dcAlpha8_Key&&""!=this.ScreenObject.GridData[Qt].dcAlpha8_Key.toString()&&null!=this.ScreenObject.GridData[Qt].dcAlpha9&&null!=this.ScreenObject.GridData[Qt].dcAlpha9&&""!=this.ScreenObject.GridData[Qt].dcAlpha9.toString()&&null!=this.ScreenObject.GridData[Qt].dcAlpha9_Key&&null!=this.ScreenObject.GridData[Qt].dcAlpha9_Key&&""!=this.ScreenObject.GridData[Qt].dcAlpha9_Key.toString()&&(this.ScreenObject.GridData[Qt].dcAlpha8_Key=new Date(kt).AddHours(new Date(this.ScreenObject.GridData[Qt].dcAlpha8_Key).getHours()).AddMinutes(new Date(this.ScreenObject.GridData[Qt].dcAlpha8_Key).getMinutes()).ToString("dd/MMM/yyyy HH:mm"),this.ScreenObject.GridData[Qt].dcAlpha9_Key=new Date(this.ScreenObject.GridData[Qt].dcAlpha8)>new Date(this.ScreenObject.GridData[Qt].dcAlpha9)?new Date(qt).AddHours(new Date(this.ScreenObject.GridData[Qt].dcAlpha9_Key).getHours()).AddMinutes(new Date(this.ScreenObject.GridData[Qt].dcAlpha9_Key).getMinutes()).ToString("dd/MMM/yyyy HH:mm"):new Date(Xt).AddHours(new Date(this.ScreenObject.GridData[Qt].dcAlpha9_Key).getHours()).AddMinutes(new Date(this.ScreenObject.GridData[Qt].dcAlpha9_Key).getMinutes()).ToString("dd/MMM/yyyy HH:mm"))}}this.ScreenObject.GridDataObj.updateRow(this.ScreenObject.GridData[Qt])}if(s.a.SessionManager.Preferences.ContainsKey("MaxAllowedMinToRegularizeDocument")&&!o.e.IsEmpty(s.a.SessionManager.Preferences.MaxAllowedMinToRegularizeDocument)){var Yt=this.ValidateMaxAllowedAbsenseMinutes(_t);Yt.length>0&&(e=Yt)}}Logger.InfoLog("AddEditDocumentViewModel::Exiting CheckDocumentValidationsOnSave")}catch(zt){e="Problem processing your request please contact administrator",Logger.ErrorLog("AddEditDocumentViewModel:: CheckDocumentValidationsOnSave"+zt.stack)}return e}},{key:"ValidateMaxAllowedAbsenseMinutes",value:function(e){var t=this,n="";if(this.ScreenObject.GridData.length>0){var a=function(){var a,i,r,c,u,d=new Array,D=t.ScreenObject.GridData.Compute("min","dcAlpha3_Key"),h=t.ScreenObject.GridData.Compute("max","dcAlpha3_Key"),S=new Date,m=new Date;null!=D&&(S=new Date(D)),null!=h&&(m=new Date(h));var b={dtPM:r,dtFrom:a,dtTo:i};o.e.SetPayrollDate(S.Date(),b),r=b.dtPM,a=b.dtFrom,i=b.dtTo,d.push(r),b={dtPM:r,dtFrom:a,dtTo:i},o.e.SetPayrollDate(m.Date(),b),r=b.dtPM,a=b.dtFrom,i=b.dtTo,d.Contains(r)||d.push(r);var C,y=s.a.common.GetDataSet3("PAY093",a.Date.ToString("dd MMM yyyy")+"~"+i.Date.ToString("dd MMM yyyy"),t.ScreenObject.DocID+"~"+e,s.a.SessionManager.Preferences.MaxAllowedMinToRegularizeDocument),p=y.Tables[0],g=0,f=0,O=new Date,I=t.ScreenObject._TextFields.find((function(e){return"DCALPHA10"==e.DBColumnName.toUpperCase()}));null!=I&&(O=I.Date);var T=[];T.push(O.Date().ToString("dd MMM yyyy")),T.push(" AND EmpSeqNo="+e),T.push(0),T.push(s.a.SessionManager.RoleID),T.push(s.a.SessionManager.UserID),T.push(s.a.SessionManager.LanguageID);var j=s.a.common.GetDataSet_SP(T,"spPAY_GetEmpMasterCCDetails"),P=0,A="",M="";if(null!=y.Tables[1]&&y.Tables[1].length>0)for(var v=0;v<y.Tables[1].length;v++){A=y.Tables[1][v].SysColumnName.toString();var G=j.Tables[0].filter((function(t){return t.EmpSeqNo==e}));null!=G&&G.length>0&&(P=parseInt(G[0]["CCNID"+A.Replace("dcCCNID","")])),M.length>0&&(M+=" AND "),M+=A+"="+P}var N=s.a.common.GetDataTable("PAY094",s.a.SessionManager.Preferences.MaxAllowedMinToRegularizeDocument+"~"+M);if(N.length>0&&(f=parseFloat(N[0].MaxMinutes)),f>0)for(var E=0,w=d[0];d.length>E&&w<=d[E];){g=0;var F={dtPM:r,dtPMS:c,dtPME:u};if(o.e.SetPayrollDate(w.Date(),F),r=F.dtPM,c=F.dtPMS,u=F.dtPME,null!=p&&p.length>0&&(null!=(C=p.filter((function(e){return e.DADate>=c.ToString("dd MMM yyyy")&&e.DADate<=u.ToString("dd MMM yyyy")})))&&C.length>0))for(var V=0;V<C.length;V++)if(o.e.IsEmpty(C[V].AdjChkInMins)||(g+=parseFloat(C[V].AdjChkInMins)),o.e.IsEmpty(C[V].AdjChkOutMins)||(g+=parseFloat(C[V].AdjChkOutMins)),g>f)return{v:(n="Maximum Allowed Absense minutes exceeded for the Payroll Month : "+r.ToString("MMM, yyyy"),n)};if(g>f)return{v:(n="Maximum Allowed Absense minutes exceeded for the Payroll Month : "+r.ToString("MMM, yyyy"),n)};if(null!=(C=t.ScreenObject.GridData.filter((function(e){return e.dcAlpha3_Key>=c.ToString("dd MMM yyyy")&&e.dcAlpha3_Key<=u.ToString("dd MMM yyyy")&&"True"==e.dcAlpha12})))&&C.length>0){for(var L=0;L<C.length;L++)if(Object(l.j)(C[L].dcAlpha12)&&(g+=new Date(C[L].dcAlpha4_Key).Subtract(new Date(C[L].dcAlpha8_Key)).TotalMinutes,(g+=new Date(C[L].dcAlpha9_Key).Subtract(new Date(C[L].dcAlpha5_Key)).TotalMinutes)>f))return{v:(n="Maximum Allowed Absense minutes exceeded for the Payroll Month : "+r.ToString("MMM, yyyy"),n)};if(g>f)return{v:(n="Maximum Allowed Absense minutes exceeded for the Payroll Month : "+r.ToString("MMM, yyyy"),n)}}E++,w=w.AddMonths(1)}}();if("object"==typeof a)return a.v}return n}},{key:"CheckIsPayrollProcessed",value:function(e,t){var n=s.a.common.GetDataSet3("PAY030",t,e).Tables[0];return null!=n&&n.length>0}},{key:"FillPostPastSalEarningDeductionDtls",value:function(e){e&&(null!=e.SelectedDateChanged||s.a.SessionManager.IsWebApplication)&&(this.FillEarnDeductDetails(1,parseInt(new Date(e.Date).ToString("yyyy"))),this.DimensionSelectedvalueData())}},{key:"dtpBulkApprEffectFrom_SelectedDateChanged",value:function(e){if(null!=e.Date&&e.SelectedDateChanged.IsSubscribed&&e.Date){var t=e.Date;e.Date=new Date(t.getFullYear(),t.getMonth(),1);var n=this.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()}));null!=n&&n instanceof S.c&&(n.Date=e.Date)}}},{key:"FillComponentsBasedOnGradeSlabs",value:function(e,t){if(s.a.SessionManager.Preferences.ContainsKey("ConsiderGradeWiseSalarySlabs")&&"True"==s.a.SessionManager.Preferences.ConsiderGradeWiseSalarySlabs){var n="0",a=this.ScreenObject._CCFields.find((function(e){return"dcccnid53"==e.DBColumnName.toLowerCase()}));null!=a&&(a instanceof C.b||a instanceof p.a)&&(n=a.SelectedValue.toString());var i=s.a.common.GetDataTable("DOC054",n+"~"+e);if(null!=i&&i.length>0){if(o.e.IsEmpty(i[0].ComponentID)||!(parseInt(i[0].ComponentID)>0))return this.DisplayMessage="Employee Already has same Grade,Please Change the Grade  ",void(this.MessageVisibility=!0);var r=null,c=0;this.ScreenObject.GridDataObj.Clear();for(var l=this.ScreenObject.Data.Tables[0].filter((function(e){return"ProductID"==e.SysColumnName})),u=0;u<i.length;u++)if(this.ValidateGradeWiseSalarySlabsApplicableFormula(i[u],e)){r=this.ScreenObject.GridDataObj.NewRow(),this.ScreenObject.GridDataObj.insertRowAt(r,c),c++,l.length>0&&!o.e.IsEmpty(l[0].UserDefaultValue)&&(r.ProductID_Key=l[0].UserDefaultValue),r.dcCCNID52_Key=i[u].ComponentID,r.dcCCNID52=i[u].ComponentName;var d=0,D=0;d=o.e.Double(i[u].MinAmount),D=o.e.Double(i[u].MaxAmount),r.dcNum1="PickMin"==t?d.toString():D.toString()}}}}},{key:"ValidateGradeWiseSalarySlabsApplicableFormula",value:function(e,t){if(null!=e&&null!=e.ApplicableFormula&&null!=e.ApplicableFormula&&""!=e.ApplicableFormula.toString().Trim()){var n=new dt.b;n.sEmpSeqNo=t.toString();var a={PayrollMonth:n.PayrollMonth,PayrollMonthStart:n.PayrollMonthStart,PayrollMonthEnd:n.PayrollMonthEnd};o.e.SetPayrollDate(new Date,a),n.PayrollMonth=a.PayrollMonth,n.PayrollMonthStart=a.PayrollMonthStart,n.PayrollMonthEnd=a.PayrollMonthEnd,n.arrLstCPFields[6].Clear();var i=new dt.a;i.ComponentName="GrdWiseSalSlabsFormula",i.SNo=1,i.Formula=e.ApplicableFormula.toString(),i.dEarned=i.dActual="0",n.arrLstCPFields[6].push(i),n.Intialize(),n.othMPField.BasicMonthly=0,n.othMPField.TotalLeaves=0,n.othMPField.DaysAttended=n.othMPField.TotalDays;var r=new Date,s=this.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()}));if(null!=s&&null!=s&&s instanceof S.c&&(r=s.Date),n.isValidBulkAppraisal=!0,n.EffectFrom=r,n.ExecuteAllFormulas(),"GrdWiseSalSlabsFormula"==n.arrLstCPFields[6][0].ComponentName)return 0!=parseFloat(n.arrLstCPFields[6][0].dEarned)}return!0}},{key:"BulkAppraisalsInsert",value:function(){var e=this,t=this.ScreenObject.GridData;if(null!=t&&t.length>0){var n,a=function(){var a=null,i=0,r=0,c=0,l=0,u=!1,d="",D="",m=Date.Today(),b=Date.Today(),y=Date.Today(),g=!1;if(null!=!o.e.IsEmpty(t[0].dcCCNID51_Key)&&(g=!0),g){var f,O=t.ToTable(!0,"dcCCNID51_Key");if(null!=O&&O.length>0)for(var I=0;I<O.length;I++)if(!o.e.IsEmpty(O[I].dcCCNID51_Key)&&(i=parseInt(O[I].dcCCNID51_Key),null!=(f=t.filter((function(e){return e.dcCCNID51_Key==i})))&&f.length>0)){var T=e.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()}));if(null!=T&&null!=T&&T instanceof S.c)m=T.Date;else{var j=e.ScreenObject.ColumnSource.find((function(e){return"dcalpha1"==e.DisplayMember.toLowerCase()}));null==j||null==j||o.e.IsEmpty(f[0][j.DisplayMember+"_Key"])||(m=new Date(f[0][j.DisplayMember+"_Key"]))}if(null!=(T=e.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()})))&&null!=T&&T instanceof S.c)b=T.Date;else{var P=e.ScreenObject.ColumnSource.find((function(e){return"dcalpha2"==e.DisplayMember.toLowerCase()}));null==P||null==P||o.e.IsEmpty(f[0][P.DisplayMember+"_Key"])||(b=new Date(f[0][P.DisplayMember+"_Key"]))}null!=(T=e.ScreenObject._TextFields.find((function(e){return"dcalpha4"==e.DBColumnName.toLowerCase()})))&&null!=T&&T instanceof S.c?y=T.Date:null==(n=e.ScreenObject.ColumnSource.find((function(e){return"dcalpha4"==e.DisplayMember.toLowerCase()})))||null==n||o.e.String(f[0][n.DisplayMember+"_Key"])||(y=new Date(f[0][n.DisplayMember+"_Key"])),null!=(T=e.ScreenObject._TextFields.find((function(e){return"dcalpha6"==e.DBColumnName.toLowerCase()})))&&null!=T&&T instanceof h.d&&!o.e.String(T.Text)&&(D=T.Text),null!=(T=e.ScreenObject._TextFields.find((function(e){return"dcalpha7"==e.DBColumnName.toLowerCase()})))&&null!=T&&T instanceof h.d&&!o.e.String(T.Text)&&(d=T.Text);var A=s.a.common.GetDataSet3("PAY031",i.toString(),m.ToString("dd/MMM/yyyy")).Tables[0];c=null!=A&&A.length>0?parseInt(A[0].SeqNo):0,(a=new Gt.a(null,i,new Date,c)).isFromBulkAppraisals=!0,a.EffectFrom.Date=m,a.ActAppraisalFrom.Date=b,a.NextAppraisal.Date=y,a.Remarks.Text=d,a.Reason.Text=D;for(var M=0;M<f.length;M++){r=parseInt(f[M].dcCCNID52_Key),l=parseFloat(f[M].dcNum1),u=!1;for(var v=0;v<a.dgvEarnings.Table.length;v++)if(a.dgvEarnings.Table[v].EarComponentID.toString()==r.toString()){a.dgvEarnings.Table[v].EarValue=l,u=!0;break}if(!u)for(var G=0;G<a.dgvDeductions.Table.length;G++)if(a.dgvDeductions.Table[G].DedComponentID.toString()==r.toString()){a.dgvDeductions.Table[G].DedValue=l;break}}if(a.ExecuteFormulas(),a.OnButtonClick("Save"),null!=a.DisplayMessage&&a.DisplayMessage.length>0)return{v:(e.DisplayMessage=a.DisplayMessage,!1)};e.sApprUpdate+=a.strUpdate}}else{var N=e.ScreenObject._CCFields.find((function(e){return"dcCCNID51"==e.DBColumnName}));if(null!=N){if(null==N.SelectedValue||""==o.e.String(N.SelectedValue))return{v:(e.DisplayMessage="Select Employee",!1)};i=N.SelectedValue}var E="0";if(e.ScreenObject.Preferences.ContainsKey("UpdateGradeandAppraisalData")&&"True"==e.ScreenObject.Preferences.UpdateGradeandAppraisalData){var w=e.ScreenObject._CCFields.find((function(e){return"dcccnid53"==e.DBColumnName.toLowerCase()}));null!=w&&(w instanceof C.b||w instanceof p.a)&&(E=w.SelectedValue.toString())}var F=e.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()}));null!=F&&null!=F&&F instanceof S.c&&(m=F.Date),null!=(F=e.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()})))&&null!=F&&F instanceof S.c&&(b=F.Date),null!=(F=e.ScreenObject._TextFields.find((function(e){return"dcalpha4"==e.DBColumnName.toLowerCase()})))&&null!=F&&F instanceof S.c&&(y=F.Date),null!=(F=e.ScreenObject._TextFields.find((function(e){return"dcalpha6"==e.DBColumnName.toLowerCase()})))&&null!=F&&F instanceof h.d&&!o.e.IsEmpty(F.Text)&&(D=F.Text),null!=(F=e.ScreenObject._TextFields.find((function(e){return"dcalpha7"==e.DBColumnName.toLowerCase()})))&&null!=F&&F instanceof h.d&&!o.e.IsEmpty(F.Text)&&(d=F.Text);var V=s.a.common.GetDataSet3("PAY031",i.toString(),m.ToString("dd/MMM/yyyy")).Tables[0];c=null!=V&&V.length>0?parseInt(V[0].SeqNo):0,(a=new Gt.a(null,i,new Date,c)).isFromBulkAppraisals=!0,a.EffectFrom.Date=m,a.ActAppraisalFrom.Date=b,a.NextAppraisal.Date=y,a.Remarks.Text=d,a.Reason.Text=D,a.sBulkAppraisalGrade=E;for(var L=0;L<t.length;L++)if(!o.e.IsEmpty(t[L].dcCCNID52_Key)){r=parseInt(t[L].dcCCNID52_Key),l=parseFloat(t[L].dcNum1),u=!1;for(var R=0;R<a.dgvEarnings.Table.length;R++)if(a.dgvEarnings.Table[R].EarComponentID.toString()==r.toString()){a.dgvEarnings.Table[R].EarValue=l,u=!0;break}if(!u)for(var B=0;B<a.dgvDeductions.Table.length;B++)if(a.dgvDeductions.Table[B].DedComponentID.toString()==r.toString()){a.dgvDeductions.Table[B].DedValue=l;break}}if(a.ExecuteFormulas(),a.OnButtonClick("Save"),null!=a.DisplayMessage&&a.DisplayMessage.length>0)return{v:(e.DisplayMessage=a.DisplayMessage,!1)};e.sApprUpdate+=a.strUpdate}if((null==e.DisplayMessage||0==e.DisplayMessage.length)&&e.sApprUpdate.length>0)return{v:!0}}();if("object"==typeof a)return a.v}return!1}},{key:"ShowVacationCreditDaysDetail",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.ScreenObject.Preferences.ContainsKey("ShowVacationCreditDaysDetail")&&!o.e.IsEmpty(this.ScreenObject.Preferences.ShowVacationCreditDaysDetail)&&Object(l.j)(this.ScreenObject.Preferences.ShowVacationCreditDaysDetail)&&(this.SetVisibiltiFalse(),this.VacCrDaysVisibility=!0),0!=e){var t=new Date,n=new Date,a=0,i=this.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()}));i instanceof S.c&&i.Date&&(t=i.Date),(i=this.ScreenObject._TextFields.find((function(e){return"dcalpha3"==e.DBColumnName.toLowerCase()})))instanceof S.c&&i.Date&&(n=i.Date),(i=this.ScreenObject._TextFields.find((function(e){return"dcalpha22"==e.DBColumnName.toLowerCase()})))instanceof h.d&&!o.e.IsEmpty(i.Text)&&(a=parseFloat(i.Text)),s.a.SessionManager.Preferences.ContainsKey("CalcVacDaysuptolastmonth")&&Object(l.j)(s.a.SessionManager.Preferences.CalcVacDaysuptolastmonth)&&(t=t.AddDays(-(t.getDate()-1)));var r=this.ScreenObject.GetVacationDays(t,n,e,this.DocID,a,0);if(0==this.VacCrDaysScreen.length&&null!=r&&r.Tables.length>0){if(this.ScreenObject.Preferences.ContainsKey("ShowVacationCreditDaysDetail")&&!o.e.IsEmpty(this.ScreenObject.Preferences.ShowVacationCreditDaysDetail)&&Object(l.j)(this.ScreenObject.Preferences.ShowVacationCreditDaysDetail)){var c=new Qt(e,r.Tables[5]);this.VacCrDaysScreen.push(c)}}else if(null!=r&&r.Tables.length>0&&this.ScreenObject.Preferences.ContainsKey("ShowVacationCreditDaysDetail")&&!o.e.IsEmpty(this.ScreenObject.Preferences.ShowVacationCreditDaysDetail)&&Object(l.j)(this.ScreenObject.Preferences.ShowVacationCreditDaysDetail)){var u=this.VacCrDaysScreen[0];u.dgv.Clear(),u.BindGrid(e,r.Tables[5])}}}},{key:"PayrollMonthTypeOfField_SelectedDateChanged",value:function(e){if(e instanceof S.c&&e.Date){var t=e.Date;e.Date=new Date(t.getFullYear(),t.getMonth(),1)}}},{key:"EmpFilter_Click",value:function(e){var t=this;return this.sEmpFilter="",this.DialogResult=this.objEmpFilter.IsCompleted,this.objEmpFilter.IsCompleted?(this.objEmpFilter.CostCenterFilters.length>0&&function(){for(var e=1,n="",a="",i=0;i<t.objEmpFilter.CostCenterFilters.length;i++){var r=t.objEmpFilter.CostCenterFilters[i];r.CostCenterID>5e4&&(e=2,"NodeID",n=50051==r.CostCenterID?"EmpSeqNo":"CCNID"+(r.CostCenterID-5e4)),r.SelectedNodes.length>0?1==r.SelectedNodes.length?(a+=" AND ",a+=n+"="+r.SelectedNodes[0].Id):r.SelectedNodes.find((function(t){return t.Id==e&&t.IsGroup}))||(a+=" AND "):r.DeleteButtonVisibility||(a+=" AND ",a+=n+"=-12912")}t.sEmpFilter=a.toString()}(),this.FilterPayEmployees(e)):(Logger.InfoLog("AddEditDocumentsPayroll::Exiting EmpFilter_Click()"),"")}},{key:"FilterPayEmployees",value:function(e){var t="";try{s.a.SessionManager.LocationID>0&&s.a.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&s.a.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sEmpFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+s.a.SessionManager.LocationID+")"),o.e.IsEmpty(s.a.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sEmpFilter+="  AND EmpSeqNo IN ("+s.a.SessionManager.sWHEmpFilteredEmpSeqNos+")");var n=[];n.push(e.ToString("dd MMM yyyy")),n.push(this.sEmpFilter),n.push(0),n.push(s.a.SessionManager.RoleID),n.push(s.a.SessionManager.UserID),n.push(s.a.SessionManager.LanguageID);var a=s.a.common.GetDataSet_SP(n,"spPAY_GetEmpMasterCCDetails");if(null!=a&&a.Tables.length>0&&a.Tables[0].length>0){for(var i=0;i<a.Tables[0].length;i++)t.Trim().length>0&&(t+=","),t+=a.Tables[0][i].EmpSeqNo.toString();return t.length>0?t:(this.DisplayMessage="No data found for the selected Criteria.",this.MessageVisibility=!0,"")}return Logger.InfoLog("AddEditDocumentsPayroll::Exiting FilterPayEmployees()"),""}catch(r){return Logger.ErrorLog("AddEditDocumentsPayroll::EXCEPTION FilterPayEmployees()"+r.stack),""}}},{key:"DoLateConsiderations",value:function(e){var t=this;if(s.a.SessionManager.Preferences.ContainsKey("ConsiderLatesConfig")&&"True"==s.a.SessionManager.Preferences.ConsiderLatesConfig&&s.a.SessionManager.Preferences.ContainsKey("LatesConfigBasedOn")&&""!=s.a.SessionManager.Preferences.LatesConfigBasedOn.toString().Trim()){var n=!1,a=s.a.SessionManager.Preferences.LatesConfigBasedOn;"50073"==a&&(n=!0);var i=a.split(","),r=e.split(",");if(r.length>0&&i.length>0){var l,u=function(){if((l=t.ScreenObject._TextFields.find((function(e){return"dcalpha16"==e.DBColumnName.toLowerCase()})))instanceof S.c&&!l.Date)return{v:(t.DisplayMessage="Select Payroll Month",t.MessageVisibility=!0,void(l.SetFocus=!0))};var a=new Date(l.Date.getFullYear(),l.Date.getMonth(),1),u={PayrollMonth:t.dtPayMon,PayrollMonthStart:t.dtPayMonStart,PayrollMonthEnd:t.dtPayMonEnd,LatesMonth:t.dtLatesMonth,LatesMonthStart:t.dtLatesMonthStart,LatesMonthEnd:t.dtLatesMonthEnd};o.e.SetPayrollDate(a,u),t.dtPayMon=u.PayrollMonth,t.dtPayMonStart=u.PayrollMonthStart,t.dtPayMonEnd=u.PayrollMonthEnd,t.dtLatesMonth=u.LatesMonth,t.dtLatesMonthStart=u.LatesMonthStart,t.dtLatesMonthEnd=u.LatesMonthEnd;var d=s.a.common.GetDataSet3("PAY032",e,t.dtLatesMonth.ToString("dd/MMM/yyyy"),t.dtLatesMonthStart.ToString("dd/MMM/yyyy")+","+t.dtLatesMonthEnd.ToString("dd/MMM/yyyy")),D=[];D.push(s.a.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")),D.push(" a.IsGroup=0 AND a.NodeID IN("+e+")"),D.push("");var h,m=s.a.common.GetDataSet_SP(D,"spPAY_GetEmpDimensionsAsOnDate").Tables[0],b=s.a.common.GetDataTable("PAY095",e+"~"+t.dtLatesMonthStart.ToString("dd MMM yyyy")+"~"+t.dtLatesMonthEnd.ToString("dd MMM yyyy")),C=s.a.common.GetDataTable("PAY096",""),y=0,p=t.ScreenObject.Data.Tables[0].filter((function(e){return"ProductID"==e.SysColumnName}));p.length>0&&!o.e.IsEmpty(p[0].UserDefaultValue)&&(y=parseInt(p[0].UserDefaultValue));for(var g,f,O,I,T,j,P="",A="",M="",v=new Date,G=new Date,N=new Date,E=new Date,w=new Date,F=0,V=0,L=0,R=0,B=0,x=null,k=null,_=0;_<r.length;_++){if(h=new c.a,null!=d&&d.Tables.length>0&&d.Tables[1].length>0)for(var K=0;K<d.Tables[1].length;K++)h.ContainsKey(d.Tables[1][K].DISTDeviation.toString()+"_NDMT")||(h.push(d.Tables[1][K].DISTDeviation.toString()+"_NDMT",0),h.push(d.Tables[1][K].DISTDeviation.toString()+"_FENDMT",0),h.push(d.Tables[1][K].DISTDeviation.toString()+"_IsNDMTDone",0));if(M=r[_],null!=(I=m.filter((function(e){return e.EmpSeqNo==M})))&&I.length>0){var Q=void 0;if(R=0,i.filter((function(e){return e.length>1})).length>0){if((f=t.DoLate_Filter(d.Tables[1],I[0]).filter((function(e){return e.WEF<=t.dtLatesMonthEnd.Date()}))).sort((function(e,t){return e.WEF<t.WEF?1:e.WEF>t.WEF?-1:0})),n||f.length>0&&(B=parseInt(f[0].DocID),(f=d.Tables[1].filter((function(e){return e.DocID==B}))).length>0&&(P=(f=Q=f)[0].IncludeRExclude.toString())),(g=d.Tables[0]((function(e){return e.EmpSeqNo==M}))).sort((function(e,t){return e.DailyAttDate>t.DailyAttDate||e.DailyAttDate==t.DailyAttDate&&e.StartTime>t.StartTime?1:-1})),g.length>0){x=[],x=g.ToTable(!0,["DailyAttDate"]);for(var H=0;H<x.length;H++){if(v=new Date(x[H].DailyAttDate),(O=d.Tables[0]((function(e){return e.EmpSeqNo==M&&e.DailyAttDate==v.OnlyDate()}))).sort((function(e,t){return e.DailyAttDate>t.DailyAttDate||e.DailyAttDate==t.DailyAttDate&&e.StartTime>t.StartTime?1:-1})),O.length>0){if(n){if((f=(f=d.Tables[1]).filter((function(e){return e.dcCCNID73==O[0].ShiftSeqNo&&e.WEF<=t.dtLatesMonthEnd.ToString("dd/MMM/yyyy")}))).sort((function(e,t){return e.WEF<t.WEF?1:e.WEF>t.WEF?-1:0})),!(f.length>0))continue;B=parseInt(f[0].DocID),(f=f.filter((function(e){return e.DocID==B}))).length>0&&(P=(f=Q=f)[0].IncludeRExclude.toString())}if(""!=(A=O[0].DADayType.toString())){if("WeeklyOff"==A&&("ExcludeBoth"==P||"ExcludeWeeklyOffs"==P))continue;if("Holiday"==A&&("ExcludeBoth"==P||"ExcludeHolidays"==P))continue}}for(var W=!1,U=0,X=function(e){if(k=null,W=!1,0==e&&((f=t.DoLate_Filter(Q,I[0]).filter((function(e){return"Check-in is late By"==e.DeviationWhen}))).sort((function(e,t){return e.DevHours<t.DevHours?1:-1})),f.length>0))for(var n=0;n<f.length;n++)if(("Flexible"!=O[e].ShiftType.toString()||"NO"!=O[e].ConsiderStartandEndTimelimits.toString().toUpperCase())&&(G=new Date(f[n].DevHours),N=new Date(O[e].StartTime),(new Date(O[e].StartTime)==new Date(O[e].EndTime)||new Date(O[e].StartTime)>new Date(O[e].DADateShiftEndTime)&&new Date(O[e].EndTime)>new Date(O[e].DADateShiftEndTime))&&new Date(O[e].EndTime)>new Date(O[e].DADateShiftEndTime)&&(N=new Date(O[e].DADateShiftEndTime)),E=new Date(O[e].DADateShiftStartTime),w=new Date(O[e].DADateShiftStartTime).AddHours(G.getHours()).AddMinutes(G.getMinutes()),N>w)){F=N.Subtract(E).TotalMinutes,U=F,(k=t.ScreenObject.GridDataObj.NewRow()).DocSeqNo=t.ScreenObject.GridData.length+1,k.ProductID_Key=y,k.LinkedInvDocDetailsID=f[n].InvDocDetailsID,k.dcCCNID51_Key=M,k.dcCCNID51Code=I[0].EmpCode.toString(),k.dcCCNID51=I[0].EmpName.toString(),k.dcAlpha1=O[e].VoucherNo,k.dcAlpha2=O[e].DocSeqNo,k.dcAlpha3=v.ToString(s.a.SessionManager.Preferences["Date Format"]),k.dcAlpha3_Key=v,k.dcAlpha4=new Date(O[e].StartTime).ToString("HH:mm"),k.dcAlpha5=new Date(O[e].EndTime).ToString("HH:mm"),k.dcCCNID73_Key=O[e].ShiftSeqNo.toString(),k.dcCCNID73=O[e].ShiftName.toString(),k.dcAlpha6=new Date(O[e].ShiftStartTime).ToString("HH:mm"),k.dcAlpha7=new Date(O[e].ShiftEndTime).ToString("HH:mm"),k.dcAlpha8=F,k.dcAlpha15="",0==h[f[n].DISTDeviation.toString()+"_IsNDMTDone"]?(R=parseInt(h[f[n].DISTDeviation.toString()+"_NDMT"]),h[f[n].DISTDeviation.toString()+"_NDMT"]=R+1,parseInt(h[f[n].DISTDeviation.toString()+"_NDMT"])>parseInt(f[n].NDMT)&&(null!=k.dcAlpha15&&null!=k.dcAlpha15&&k.dcAlpha15.toString().length>0?k.dcAlpha15+=";Deduct - "+f[n].NDMTNoOfHoursOrDays+" - "+f[n].NDMTDeduct:k.dcAlpha15="Deduct - "+f[n].NDMTNoOfHoursOrDays+" - "+f[n].NDMTDeduct,"Leaves"==f[n].NDMTDeduct.toString()&&null!=f[n].LeaveTypesDeductionOrder&&null!=f[n].LeaveTypesDeductionOrder&&(k.dcAlpha28=f[n].LeaveTypesDeductionOrder),h[f[n].DISTDeviation.toString()+"_NDMT"]=0,h[f[n].DISTDeviation.toString()+"_IsNDMTDone"]=1)):(R=parseInt(h[f[n].DISTDeviation.toString()+"_FENDMT"]),h[f[n].DISTDeviation.toString()+"_FENDMT"]=R+1,parseInt(h[f[n].DISTDeviation.toString()+"_FENDMT"])>parseInt(f[n].FENDMT)&&(null!=k.dcAlpha15&&null!=k.dcAlpha15&&k.dcAlpha15.toString().length>0?k.dcAlpha15+=";Deduct - "+f[n].FENDMTNoOfHoursOrDays+" - "+f[n].FENDMTDeduct:k.dcAlpha15="Deduct - "+f[n].FENDMTNoOfHoursOrDays+" - "+f[n].FENDMTDeduct,"Leaves"==f[n].FENDMTDeduct.toString()&&null!=f[n].LeaveTypesDeductionOrder&&null!=f[n].LeaveTypesDeductionOrder&&(k.dcAlpha28=f[n].LeaveTypesDeductionOrder),h[f[n].DISTDeviation.toString()+"_FENDMT"]=0)),t.ScreenObject.GridDataObj.addRow(k),W=!0;break}if(e==O.length-1&&((f=t.DoLate_Filter(Q,I[0]).filter((function(e){return"Check-out is early By"==e.DeviationWhen}))).sort((function(e,t){return e.DevHours<t.DevHours?1:-1})),f.length>0))for(var a=0;a<f.length;a++)if(("Flexible"!=O[e].ShiftType.toString()||"NO"!=O[e].ConsiderStartandEndTimelimits.toString().toUpperCase())&&(G=new Date(f[a].DevHours),N=new Date(O[e].EndTime),(new Date(O[e].StartTime)==new Date(O[e].EndTime)||new Date(O[e].StartTime)<new Date(O[e].DADateShiftStartTime)&&new Date(O[e].EndTime)<new Date(O[e].DADateShiftStartTime))&&new Date(O[e].StartTime)<new Date(O[e].DADateShiftStartTime)&&(N=new Date(O[e].DADateShiftStartTime)),E=new Date(O[e].DADateShiftEndTime),w=new Date(O[e].DADateShiftEndTime).AddHours(-G.getHours()).AddMinutes(-G.getMinutes()),N<w)){F=E.Subtract(N).TotalMinutes,U+=F,null!=(j=t.ScreenObject.GridData.filter((function(e){return e.dcCCNID51_Key==M&&e.dcAlpha3_Key==v.Date()})))&&j.length>0?(k=j[0],W=!0):((k=t.ScreenObject.GridDataObj.NewRow()).DocSeqNo=t.ScreenObject.GridData.length+1,k.ProductID_Key=y,k.LinkedInvDocDetailsID=f[a].InvDocDetailsID,k.dcCCNID51_Key=M,k.dcCCNID51Code=I[0].EmpCode.toString(),k.dcCCNID51=I[0].EmpName.toString(),k.dcAlpha1=O[e].VoucherNo,k.dcAlpha2=O[e].DocSeqNo,k.dcAlpha3=v.ToString(s.a.SessionManager.Preferences["Date Format"]),k.dcAlpha3_Key=v,k.dcAlpha4=new Date(O[e].StartTime).ToString("HH:mm"),k.dcAlpha5=new Date(O[e].EndTime).ToString("HH:mm"),k.dcCCNID73_Key=O[e].ShiftSeqNo.toString(),k.dcCCNID73=O[e].ShiftName.toString(),k.dcAlpha6=new Date(O[e].ShiftStartTime).ToString("HH:mm"),k.dcAlpha7=new Date(O[e].ShiftEndTime).ToString("HH:mm")),k.dcAlpha9=F,k.dcAlpha15="",0==h[f[a].DISTDeviation.toString()+"_IsNDMTDone"]?(R=parseInt(h[f[a].DISTDeviation.toString()+"_NDMT"]),h[f[a].DISTDeviation.toString()+"_NDMT"]=R+1,parseInt(h[f[a].DISTDeviation.toString()+"_NDMT"])>parseInt(f[a].NDMT)&&(null!=k.dcAlpha15&&null!=k.dcAlpha15&&k.dcAlpha15.toString().length>0?k.dcAlpha15+=";Deduct - "+f[a].NDMTNoOfHoursOrDays+" - "+f[a].NDMTDeduct:k.dcAlpha15="Deduct - "+f[a].NDMTNoOfHoursOrDays+" - "+f[a].NDMTDeduct,"Leaves"==f[a].NDMTDeduct.toString()&&null!=f[a].LeaveTypesDeductionOrder&&null!=f[a].LeaveTypesDeductionOrder&&(k.dcAlpha28=f[a].LeaveTypesDeductionOrder),h[f[a].DISTDeviation.toString()+"_NDMT"]=0,h[f[a].DISTDeviation.toString()+"_IsNDMTDone"]=1)):(R=parseInt(h[f[a].DISTDeviation.toString()+"_FENDMT"]),h[f[a].DISTDeviation.toString()+"_FENDMT"]=R+1,parseInt(h[f[a].DISTDeviation.toString()+"_FENDMT"])>parseInt(f[a].FENDMT)&&(null!=k.dcAlpha15&&null!=k.dcAlpha15&&k.dcAlpha15.toString().length>0?k.dcAlpha15+=";Deduct - "+f[a].FENDMTNoOfHoursOrDays+" - "+f[a].FENDMTDeduct:k.dcAlpha15="Deduct - "+f[a].FENDMTNoOfHoursOrDays+" - "+f[a].FENDMTDeduct,"Leaves"==f[a].FENDMTDeduct.toString()&&null!=f[a].LeaveTypesDeductionOrder&&null!=f[a].LeaveTypesDeductionOrder&&(k.dcAlpha28=f[a].LeaveTypesDeductionOrder),h[f[a].DISTDeviation.toString()+"_FENDMT"]=0)),W||null==k||t.ScreenObject.GridDataObj.addRow(k),W=!0;break}if(O.length>1&&((f=t.DoLate_Filter(Q,I[0]).filter((function(t){return t.DeviationWhen=="Break"+(e+1)+" hours is more by"}))).sort((function(e,t){return e.DevHours<t.DevHours?1:-1})),f.length>0))for(var i=0;i<f.length;i++)if(("Flexible"!=O[e].ShiftType.toString()||"NO"!=O[e].ConsiderStartandEndTimelimits.toString().toUpperCase())&&(G=new Date(f[i].DevHours),N=new Date(O[e].EndTime),O.length>e+1&&(E=new Date(O[e+1].StartTime),V=E.Subtract(N).TotalMinutes,T=parseFloat(O[e]["Break"+(e+1)+"Mins"]),L=T+60*G.getHours()+G.getMinutes(),V>L))){F=V-T,null!=(j=t.ScreenObject.GridData.filter((function(e){return e.dcCCNID51_Key==M&&e.dcAlpha3_Key==v.Date()})))&&j.length>0?(k=j[0],W=!0):((k=t.ScreenObject.GridDataObj.NewRow()).DocSeqNo=t.ScreenObject.GridData.length+1,k.ProductID_Key=y,k.LinkedInvDocDetailsID=f[i].InvDocDetailsID,k.dcCCNID51_Key=M,k.dcCCNID51Code=I[0].EmpCode.toString(),k.dcCCNID51=I[0].EmpName.toString(),k.dcAlpha1=O[e].VoucherNo,k.dcAlpha2=O[e].DocSeqNo,k.dcAlpha3=v.ToString(s.a.SessionManager.Preferences["Date Format"]),k.dcAlpha3_Key=v,k.dcAlpha4=new Date(O[e].StartTime).ToString("HH:mm"),k.dcAlpha5=new Date(O[e].EndTime).ToString("HH:mm"),k.dcCCNID73_Key=O[e].ShiftSeqNo.toString(),k.dcCCNID73=O[e].ShiftName.toString(),k.dcAlpha6=new Date(O[e].ShiftStartTime).ToString("HH:mm"),k.dcAlpha7=new Date(O[e].ShiftEndTime).ToString("HH:mm")),k["dcAlpha"+(9+e+1)]=F,k.dcAlpha15="",0==h[f[i].DISTDeviation.toString()+"_IsNDMTDone"]?(R=parseInt(h[f[i].DISTDeviation.toString()+"_NDMT"]),h[f[i].DISTDeviation.toString()+"_NDMT"]=R+1,parseInt(h[f[i].DISTDeviation.toString()+"_NDMT"])>parseInt(f[i].NDMT)&&(null!=k.dcAlpha15&&null!=k.dcAlpha15&&k.dcAlpha15.toString().length>0?k.dcAlpha15+=";Deduct - "+f[i].NDMTNoOfHoursOrDays+" - "+f[i].NDMTDeduct:k.dcAlpha15="Deduct - "+f[i].NDMTNoOfHoursOrDays+" - "+f[i].NDMTDeduct,"Leaves"==f[i].NDMTDeduct.toString()&&null!=f[i].LeaveTypesDeductionOrder&&null!=f[i].LeaveTypesDeductionOrder&&(k.dcAlpha28=f[i].LeaveTypesDeductionOrder),h[f[i].DISTDeviation.toString()+"_NDMT"]=0,h[f[i].DISTDeviation.toString()+"_IsNDMTDone"]=1)):(R=parseInt(h[f[i].DISTDeviation.toString()+"_FENDMT"]),h[f[i].DISTDeviation.toString()+"_FENDMT"]=R+1,parseInt(h[f[i].DISTDeviation.toString()+"_FENDMT"])>parseInt(f[i].FENDMT)&&(null!=k.dcAlpha15&&null!=k.dcAlpha15&&k.dcAlpha15.toString().length>0?k.dcAlpha15+=";Deduct - "+f[i].FENDMTNoOfHoursOrDays+" - "+f[i].FENDMTDeduct:k.dcAlpha15="Deduct - "+f[i].FENDMTNoOfHoursOrDays+" - "+f[i].FENDMTDeduct,"Leaves"==f[i].FENDMTDeduct.toString()&&null!=f[i].LeaveTypesDeductionOrder&&null!=f[i].LeaveTypesDeductionOrder&&(k.dcAlpha28=f[i].LeaveTypesDeductionOrder),h[f[i].DISTDeviation.toString()+"_FENDMT"]=0)),W||null==k||t.ScreenObject.GridDataObj.addRow(k),W=!0;break}W||null==k||t.ScreenObject.GridDataObj.addRow(k),W=!0},q=0;q<O.length;q++)X(q);if(O.length>0&&((f=t.DoLate_Filter(Q,I[0]).filter((function(e){return"Working hours is less by"==e.DeviationWhen}))).sort((function(e,t){return e.DevHours<t.DevHours?1:-1})),f.length>0))for(var Y=0;Y<f.length;Y++){var z=f[Y].DeviationHours.toString().substr(0,5).Replace(":",".").split("."),J=60*parseInt(z[0])+parseInt(z[1]),Z=t.CalculateTotalHoursBasedOnStartEndTime(O).split("."),$=60*parseInt(Z[0])+parseInt(Z[1]);if($<J){if(F=J-$,(F-=U)<=0)continue;(k=t.ScreenObject.GridDataObj.NewRow()).DocSeqNo=t.ScreenObject.GridData.length+1,k.ProductID_Key=y,k.LinkedInvDocDetailsID=f[Y].InvDocDetailsID,k.dcCCNID51_Key=M,k.dcCCNID51Code=I[0].EmpCode.toString(),k.dcCCNID51=I[0].EmpName.toString(),k.dcAlpha1=O[0].VoucherNo,k.dcAlpha2=O[0].DocSeqNo,k.dcAlpha3=v.ToString(s.a.SessionManager.Preferences["Date Format"]),k.dcAlpha3_Key=v,k.dcAlpha4=new Date(O[0].StartTime).ToString("HH:mm"),k.dcAlpha5=new Date(O[0].EndTime).ToString("HH:mm"),k.dcCCNID73_Key=O[0].ShiftSeqNo.toString(),k.dcCCNID73=O[0].ShiftName.toString(),k.dcAlpha6=new Date(O[0].ShiftStartTime).ToString("HH:mm"),k.dcAlpha7=new Date(O[0].ShiftEndTime).ToString("HH:mm"),k.dcAlpha29=F,k.dcAlpha15="",0==h[f[Y].DISTDeviation.toString()+"_IsNDMTDone"]?(R=parseInt(h[f[Y].DISTDeviation.toString()+"_NDMT"]),h[f[Y].DISTDeviation.toString()+"_NDMT"]=R+1,parseInt(h[f[Y].DISTDeviation.toString()+"_NDMT"])>parseInt(f[Y].NDMT)&&(!o.e.IsEmpty(k.dcAlpha15)&&o.e.String(k.dcAlpha15).length>0?k.dcAlpha15+=";Deduct - "+f[Y].NDMTNoOfHoursOrDays+" - "+f[Y].NDMTDeduct:k.dcAlpha15="Deduct - "+f[Y].NDMTNoOfHoursOrDays+" - "+f[Y].NDMTDeduct,"Leaves"==f[Y].NDMTDeduct.toString()&&null!=f[Y].LeaveTypesDeductionOrder&&null!=f[Y].LeaveTypesDeductionOrder&&(k.dcAlpha28=f[Y].LeaveTypesDeductionOrder),h[f[Y].DISTDeviation.toString()+"_NDMT"]=0,h[f[Y].DISTDeviation.toString()+"_IsNDMTDone"]=1)):(R=parseInt(h[f[Y].DISTDeviation.toString()+"_FENDMT"]),h[f[Y].DISTDeviation.toString()+"_FENDMT"]=R+1,parseInt(h[f[Y].DISTDeviation.toString()+"_FENDMT"])>parseInt(f[Y].FENDMT)&&(!o.e.IsEmpty(k.dcAlpha15)&&o.e.String(k.dcAlpha15).length>0?k.dcAlpha15+=";Deduct - "+f[Y].FENDMTNoOfHoursOrDays+" - "+f[Y].FENDMTDeduct:k.dcAlpha15="Deduct - "+f[Y].FENDMTNoOfHoursOrDays+" - "+f[Y].FENDMTDeduct,"Leaves"==f[Y].FENDMTDeduct.toString()&&null!=f[Y].LeaveTypesDeductionOrder&&null!=f[Y].LeaveTypesDeductionOrder&&(k.dcAlpha28=f[Y].LeaveTypesDeductionOrder),h[f[Y].DISTDeviation.toString()+"_FENDMT"]=0)),t.ScreenObject.GridDataObj.addRow(k),W=!0;break}}}}(f=t.DoLate_Filter(Q,I[0]).filter((function(e){return"Yes"==e.ConsiderAbsentDays}))).length>0&&function(){var e=void 0,n=void 0,a=new Date,i=new Date,r=new Date,c=(new Date,null),l=0,u=m;if(null!=(u=u.filter((function(e){return e.EmpSeqNo==M})))&&u.length>0){n=u;for(var d=function(e){var t=Object.keys(u[0])[e];Object.keys(t).Contains("CCNID")&&!Object.keys(t).Contains("Name")&&n.forEach((function(e){e["dc"+t+"_Key"]=e[t]}))},D=0;D<Object.keys(u[0]).length;D++)d(D);n.forEach((function(e){e.dcCCNID51_Key=e.EmpSeqNo})),c=n.filter((function(e){return e.EmpSeqNo==M}))}for(a=t.dtLatesMonthStart,i=t.dtLatesMonthEnd;a<=i;)if(null!=b&&b.length>0&&(null!=(e=b.filter((function(e){return e.EmpSeqNo==M&&(e.FromDate>=a.ToString("dd MMM yyyy")&&e.ToDate<=e.dtTempF.ToString("dd MMM yyyy")||e.FromDate<=a.ToString("dd MMM yyyy")&&e.ToDate>=a.ToString("dd MMM yyyy"))})))&&e.length>0))a=a.AddDays(1);else if(null!=c&&c.length>0&&(t.CheckEmployeeShift(M,a.ToString("dd MMM yyyy"),c[0]),null==t.objPayDayCheck&&(t.objPayDayCheck=new st.a(t.ScreenObject)),c[0].PayrollType="",t.objPayDayCheck.CheckIsHolidayDate(M,a.ToString("dd MMM yyyy"),c[0]),!o.e.IsEmpty(c[0].PayrollType)))a=a.AddDays(1);else{var h=C.filter((function(e){return e.NodeID==c[0].dcCCNID73_Key}));r=a.AddHours(new Date(h[0].ShiftStartTime).getHours()).AddMinutes(new Date(h[0].ShiftStartTime).getMinutes()),l=a.AddHours(new Date(h[0].ShiftEndTime).getHours()).AddMinutes(new Date(h[0].ShiftEndTime).getMinutes()).Subtract(r).TotalMinutes,k=null,(k=t.ScreenObject.GridDataObj.NewRow()).DocSeqNo=t.ScreenObject.GridData.length+1,k.ProductID_Key=y,k.LinkedInvDocDetailsID="0",k.dcCCNID51_Key=M,k.dcCCNID51Code=I[0].EmpCode.toString(),k.dcCCNID51=I[0].EmpName.toString(),k.dcAlpha1="",k.dcAlpha2="",k.dcAlpha3=a.ToString(s.a.SessionManager.Preferences["Date Format"]),k.dcAlpha3_Key=a,k.dcAlpha4="00:00",k.dcAlpha5="00:00",k.dcCCNID73_Key=c[0].dcCCNID73_Key,null!=h&&(k.dcCCNID73=h[0].NAME.toString(),k.dcAlpha6=new Date(h[0].ShiftStartTime).ToString("HH:mm"),k.dcAlpha7=new Date(h[0].ShiftEndTime).ToString("HH:mm")),k.dcAlpha31=l,t.ScreenObject.GridDataObj.addRow(k),a=a.AddDays(1)}t.RefreshGrid=!t.RefreshGrid}()}}var ee=t.ScreenObject.GridData.filter((function(e){return e.dcCCNID51_Key==M}));if(ee.length>0){var te=ee.filter((function(e){return e.dcCCNID51_Key==M&&""!=o.e.String(e.dcAlpha15)}));t.ScreenObject.GridData[t.ScreenObject.GridData.length-1].dcAlpha19=o.e.DTComputeSUM(te,"dcAlpha8",!1),t.ScreenObject.GridData[t.ScreenObject.GridData.length-1].dcAlpha20=o.e.DTComputeSUM(te,"dcAlpha9",!1),t.ScreenObject.GridData[t.ScreenObject.GridData.length-1].dcAlpha21=o.e.DTComputeSUM(te,"dcAlpha10",!1),t.ScreenObject.GridData[t.ScreenObject.GridData.length-1].dcAlpha22=o.e.DTComputeSUM(te,"dcAlpha11",!1),t.ScreenObject.GridData[t.ScreenObject.GridData.length-1].dcAlpha23=o.e.DTComputeSUM(te,"dcAlpha12",!1),t.ScreenObject.GridData[t.ScreenObject.GridData.length-1].dcAlpha24=o.e.DTComputeSUM(te,"dcAlpha13",!1),t.ScreenObject.GridData[t.ScreenObject.GridData.length-1].dcAlpha25=o.e.DTComputeSUM(te,"dcAlpha14",!1),te=ee.filter((function(e){return e.dcCCNID51_Key==M})),t.ScreenObject.GridData[t.ScreenObject.GridData.length-1].dcAlpha32=o.e.DTComputeSUM(te,"dcAlpha31",!1);for(var ne=0,ae=0,ie="",re=0;re<ee.length;re++)if(!o.e.IsEmpty(ee[re].dcAlpha15)){var se=ee[re].dcAlpha15.toString().split(";");if(null!=se&&se.length>0)for(var oe=0;oe<se.length;oe++)null!=se[oe]&&""!=se[oe]&&(se[oe].endsWith("Hours")?ne+=parseFloat(se[oe].Replace("Deduct - ","").Replace(" - Hours","")):se[oe].endsWith("Leaves")&&(ae+=parseFloat(se[oe].Replace("Deduct - ","").Replace(" - Leaves","")),ie=ee[re].dcAlpha28.toString()))}t.ScreenObject.GridData[t.ScreenObject.GridData.length-1].dcAlpha26=ne,t.ScreenObject.GridData[t.ScreenObject.GridData.length-1].dcAlpha27=ae,t.ScreenObject.GridData[t.ScreenObject.GridData.length-1].dcAlpha28=ie}}}();if("object"==typeof u)return u.v}}}},{key:"DoLate_Filter",value:function(e,t){for(var n=s.a.SessionManager.Preferences.LatesConfigBasedOn.split(","),a=0;a<n.length;a++)o.e.IsEmpty(n[a])||function(){var i="CCNID"+(parseInt(n[a])-5e4);e=Object.keys(t[0]).Contains(i)&&!o.e.IsEmpty(t[0][i])?e.filter((function(e){return e["dc"+i]==t[i]||1==e["dc"+i]})):e.filter((function(e){return 1==e["dc"+i]}))}();return e}},{key:"CalculateTotalHoursBasedOnStartEndTime",value:function(e){for(var t=0,n="00.00",a="",i=0;i<e.length;i++){var r=new Date(e[i].DailyAttDate),s=r.AddHours(new Date(e[i].StartTime).getHours()).AddMinutes(new Date(e[i].StartTime).getMinutes()),c=r.AddHours(new Date(e[i].EndTime).getHours()).AddMinutes(new Date(e[i].EndTime).getMinutes());c<s&&(c=c.AddDays(1)),a=this.CalculateTotalTime(s,s,c,c),n=(t=o.e.SUMHoursAndMinutes(n,a)).ToString("00.00")}return t.ToString("00.00")}},{key:"CheckIsLateCheckInOrEarlyCheckOut",value:function(e){var t,n=this,a=[];if(s.a.SessionManager.Preferences.ContainsKey("ConsiderLatesConfig")&&"True"==s.a.SessionManager.Preferences.ConsiderLatesConfig&&s.a.SessionManager.Preferences.ContainsKey("LatesConfigBasedOn")&&""!=s.a.SessionManager.Preferences.LatesConfigBasedOn.toString().Trim()){var i=!1,r=s.a.SessionManager.Preferences.LatesConfigBasedOn;"50073"==r&&(i=!0);var l=r.split(","),u=e.split(",");if(u.length>0&&l.length>0){var d=function(){var r=n.ScreenObject._TextFields.find((function(e){return"dcalpha10"==e.DBColumnName.toLowerCase()}));if(null!=r&&r instanceof S.c&&""==r.Date.toString())return{v:(n.DisplayMessage="Select From Date",n.MessageVisibility=!0,r.SetFocus=!0,a)};var d=n.ScreenObject._TextFields.find((function(e){return"dcalpha11"==e.DBColumnName.toLowerCase()}));if(null!=d&&d instanceof S.c&&""==d.Date.toString())return{v:(n.DisplayMessage="Select To Date",n.MessageVisibility=!0,d.SetFocus=!0,a)};var D=d.Date,h=s.a.common.GetDataSet3("PAY077",e,r.Date.ToString("dd/MMM/yyyy"),D.ToString("dd/MMM/yyyy")),m=[];m.push(s.a.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")),m.push(" a.IsGroup=0 AND a.NodeID IN("+e+")"),m.push("");var b,C=s.a.common.GetDataSet_SP(m,"spPAY_GetEmpDimensionsAsOnDate").Tables[0],y=n.ScreenObject.Data.Tables[0].filter((function(e){return"ProductID"==e.SysColumnName}));y.length>0&&""!=o.e.String(y[0].UserDefaultValue)&&parseInt(y[0].UserDefaultValue);for(var p,g,f="",O="",I="",T=[],j=[],P=[],A=new Date,M=new Date,v=new Date,G=new Date,N=new Date,E=0,w=0,F=0,V=null,L=0;L<u.length;L++){if(b=new c.a,null!=h&&h.Tables.length>0&&h.Tables[1].length>0)for(var R=0;R<h.Tables[1].length;R++)b.ContainsKey(h.Tables[1][R].DISTDeviation.toString()+"_NDMT")||(b.push(h.Tables[1][R].DISTDeviation.toString()+"_NDMT",0),b.push(h.Tables[1][R].DISTDeviation.toString()+"_FENDMT",0),b.push(h.Tables[1][R].DISTDeviation.toString()+"_IsNDMTDone",0));var B=void 0;if(I=u[L],null!=(p=C.filter((function(e){return e.EmpSeqNo==I})))&&p.length>0&&l.filter((function(e){return e.length>1})).length>0&&((j=n.DoLate_Filter(h.Tables[1],p[0]).filter((function(e){return e.WEF<=n.dtPayMonEnd.Date()}))).sort((function(e,t){return e.WEF<t.WEF?1:e.WEF>t.WEF?-1:0})),i||j.length>0&&(F=parseInt(j[0].DocID),(j=h.Tables[1].filter((function(e){return e.DocID==F}))).length>0&&(f=(j=B=j)[0].IncludeRExclude.toString())),(T=h.Tables[0]((function(e){return e.EmpSeqNo==I}))).sort((function(e,t){return e.DailyAttDate>t.DailyAttDate||e.DailyAttDate==t.DailyAttDate&&e.StartTime>t.StartTime?1:-1})),T.length>0)){V=[],V=T.ToTable(!0,"DailyAttDate");for(var x=0;x<V.length;x++){if(A=new Date(V[x].DailyAttDate),(P=h.Tables[0]((function(e){return e.EmpSeqNo==I&&e.DailyAttDate==A.OnlyDate()}))).sort((function(e,t){return e.DailyAttDate>t.DailyAttDate||e.DailyAttDate==t.DailyAttDate&&e.StartTime>t.StartTime?1:-1})),P.length>0){if(i){if((j=(j=h.Tables[1]).filter((function(e){return e.dcCCNID73==P[0].ShiftSeqNo&&e.WEF<=n.dtPayMonEnd.ToString("dd/MMM/yyyy")}))).sort((function(e,t){return e.WEF<t.WEF?1:e.WEF>t.WEF?-1:0})),!(j.length>0))continue;F=parseInt(j[0].DocID),(j=j.filter((function(e){return e.DocID==F}))).length>0&&(f=(j=B=j)[0].IncludeRExclude.toString())}if(""!=(O=P[0].DADayType.toString())){if("WeeklyOff"==O&&("ExcludeBoth"==f||"ExcludeWeeklyOffs"==f))continue;if("Holiday"==O&&("ExcludeBoth"==f||"ExcludeHolidays"==f))continue}}for(var k=function(e){if(0==e&&((j=n.DoLate_Filter(B,p[0]).filter((function(e){return"Check-in is late By"==e.DeviationWhen}))).sort((function(e,t){return e.DevHours<t.DevHours?1:-1})),j.length>0))for(var i=0;i<j.length;i++)"Flexible"==P[e].ShiftType.toString()&&"NO"==P[e].ConsiderStartandEndTimelimits.toString().toUpperCase()||(M=new Date(j[i].DevHours),v=new Date(P[e].StartTime),G=new Date(P[e].DADateShiftStartTime),N=new Date(P[e].DADateShiftStartTime).AddHours(M.getHours()).AddMinutes(M.getMinutes()),v>N&&(v.Subtract(G).TotalMinutes,(t={}).sInvDocIDs=P[e].InvDocDetailsID.toString(),t.LateType="Check-In Late",a.push(t)));if(e==P.length-1&&((j=n.DoLate_Filter(B,p[0]).filter((function(e){return"Check-out is early By"==e.DeviationWhen}))).sort((function(e,t){return e.DevHours<t.DevHours?1:-1})),j.length>0))for(var r=0;r<j.length;r++)"Flexible"==P[e].ShiftType.toString()&&"NO"==P[e].ConsiderStartandEndTimelimits.toString().toUpperCase()||(M=new Date(j[r].DevHours),v=new Date(P[e].EndTime),G=new Date(P[e].DADateShiftEndTime),N=new Date(P[e].DADateShiftEndTime).AddHours(-M.getHours).AddMinutes(-M.getMinutes()),v<N&&(G.Subtract(v).TotalMinutes,(t={}).sInvDocIDs=P[e].InvDocDetailsID.toString(),t.LateType="Check-Out Early",a.push(t)));if(P.length>1&&((j=n.DoLate_Filter(B,p[0]).filter((function(t){return t.DeviationWhen=="Break"+(e+1)+" hours is more by"}))).sort((function(e,t){return e.DevHours<t.DevHours?1:-1})),j.length>0))for(var s=0;s<j.length;s++)"Flexible"==P[e].ShiftType.toString()&&"NO"==P[e].ConsiderStartandEndTimelimits.toString().toUpperCase()||(M=new Date(j[s].DevHours),v=new Date(P[e].EndTime),P.length>e+1&&(G=new Date(P[e+1].StartTime),E=G.Subtract(v).TotalMinutes,g=parseFloat(P[e]["Break"+(e+1)+"Mins"]),w=g+60*M.getHours()+M.getMinutes(),E>w&&(E-g,(t={}).sInvDocIDs=P[e].InvDocDetailsID.toString(),t.LateType="Break Late",a.push(t))))},_=0;_<P.length;_++)k(_);if(P.length>0&&((j=n.DoLate_Filter(B,p[0]).filter((function(e){return"Working hours is less by"==e.DeviationWhen}))).sort((function(e,t){return e.DevHours<t.DevHours?1:-1})),j.length>0))for(var K=0;K<j.length;K++){var Q=j[K].DeviationHours.toString().substr(0,5).Replace(":",".").split("."),H=60*parseInt(Q[0])+parseInt(Q[1]),W=n.CalculateTotalHoursBasedOnStartEndTime(P).split("."),U=60*parseInt(W[0])+parseInt(W[1]);U<H&&(H-U,(t={}).sInvDocIDs=P[0].InvDocDetailsID.toString(),t.LateType="Less Working Hours",a.push(t))}}}}}();if("object"==typeof d)return d.v}}return a}},{key:"IsDocLocked",value:function(e,t,n,a){var i=this;this.strValidationMessage="";var r=[];r.push(t.ToString("dd MMM yyyy")),r.push(this.sEmpFilter),r.push(0),r.push(s.a.SessionManager.RoleID),r.push(s.a.SessionManager.UserID),r.push(s.a.SessionManager.LanguageID);var c=s.a.common.GetDataSet_SP(r,"spPAY_GetEmpMasterCCDetails");return null!=c&&c.Tables.length>0&&c.Tables[0].length>0&&function(){var r=0,l="",u=s.a.common.GetDataSet("PAY085","");if(null!=u&&u.Tables.length>0&&null!=u.Tables[0]&&u.Tables[0].length>0){var d=s.a.common.GetDataSet3("PAY086",t.ToString("dd/MMM/yyyy"),n.ToString("dd/MMM/yyyy"));if(null!=d&&d.Tables.length>0&&null!=d.Tables[0]&&d.Tables[0].length>0&&"".length>0){for(var D=d.Tables[0],h=0;h<u.Tables[0].length;h++){l=u.Tables[0][h].SysColumnName.toString();var S=c.Tables[0].filter((function(t){return t.EmpSeqNo==e}));null!=S&&S.length>0&&(r=parseInt(S[0]["CCNID"+l.Replace("dcCCNID","")])),D=D.filter((function(e){return e[l]==r}))}if(null!=D&&D.length>0)for(var m=0;m<D.length;m++)o.e.IsEmpty(D[m].MPLockStatus)||"Locked"!=D[m].MPLockStatus.toString()?""==i.strValidationMessage&&67==a&&(o.e.IsEmpty(D[m].DALockStatus)||"Locked"!=D[m].DALockStatus.toString()||(i.strValidationMessage="Daily Attendance Locked")):i.strValidationMessage="Payroll Locked"}}}(),this.strValidationMessage}},{key:"DocLock",value:function(e){var t=(new Date).OnlyDate(),n=(new Date).OnlyDate(),a="",i="";if(68==e)for(var r=0;r<this.ScreenObject.GridData.length;r++){var c=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));if(null!=c)(c instanceof C.b||c instanceof p.a)&&(a=c.SelectedValue.toString());else{var u=this.ScreenObject.ColumnSource.find((function(e){return"LISTBOX"==e.DataType.toUpperCase()&&"dcccnid51_key"==e.ValueMember.toLowerCase()}));null==u||o.e.IsEmpty(this.ScreenObject.GridData[r][u.ValueMember])||(a=this.ScreenObject.GridData[r][u.ValueMember].toString())}var d=this.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()}));if(null!=d&&d instanceof S.c&&!o.e.IsEmpty(d.Date)&&(t=d.Date),null!=(d=this.ScreenObject._TextFields.find((function(e){return"dcalpha4"==e.DBColumnName.toLowerCase()})))&&d instanceof S.c&&!o.e.IsEmpty(d.Date)&&(n=d.Date),this.strValidationMessage=this.IsDocLocked(a,t,n,e),""!=this.strValidationMessage)break}else if(67==this.ScreenObject.DocumentType){for(var D=0;D<this.ScreenObject.GridData.length;D++)if(this.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!o.e.IsEmpty(this.ScreenObject.GridData[D].ProductID_Key)){i="",a="";var h=this.ScreenObject.GridData[D],m=this.ScreenObject._TextFields.find((function(e){return"dcalpha1"==e.DBColumnName.toLowerCase()}));if(null!=m)i=m.Date.ToString("dd/MMM/yyyy");else{var b=this.ScreenObject.ColumnSource.find((function(e){return"dcalpha1"==e.DisplayMember.toLowerCase()}));null==b||o.e.IsEmpty(h[b.DisplayMember+"_Key"])||(i=new Date(h[b.DisplayMember+"_Key"]).ToString("dd/MMM/yyyy"))}if(null!=(m=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}))))(m instanceof C.b||m instanceof p.a)&&(a=m.SelectedValue.toString());else{var y=this.ScreenObject.ColumnSource.find((function(e){return"LISTBOX"==e.DataType.toUpperCase()&&"dcccnid51_key"==e.ValueMember.toLowerCase()}));null==y||o.e.IsEmpty(h[y.ValueMember])||(a=h[y.ValueMember].toString())}if(""!=i&&parseInt(a)>1&&(this.strValidationMessage=this.IsDocLocked(a,new Date(i),new Date(i),e),""!=this.strValidationMessage))break}}else if(80==this.ScreenObject.DocumentType){var g=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));null!=g&&(g instanceof C.b||g instanceof p.a)&&(a=g.SelectedValue.toString());var f=this.ScreenObject._TextFields.find((function(e){return"dcalpha3"==e.DBColumnName.toLowerCase()}));null!=f&&f instanceof S.c&&""!=f.Date.toString()&&(t=f.Date),n=t,this.strValidationMessage=this.IsDocLocked(a,t,n,e)}else if(62==this.ScreenObject.DocumentType){if(s.a.SessionManager.Preferences.ContainsKey("AllowLeavesifPayrollProcessedorLocked")&&Object(l.j)("False"==s.a.SessionManager.Preferences.AllowLeavesifPayrollProcessedorLocked))for(var O=0;O<this.ScreenObject.GridData.length;O++){var I=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));if(null!=I)(I instanceof C.b||I instanceof p.a)&&(a=I.SelectedValue.toString());else{var T=this.ScreenObject.ColumnSource.find((function(e){return"LISTBOX"==e.DataType.toUpperCase()&&"dcccnid51_key"==e.ValueMember.toLowerCase()}));null==T||o.e.IsEmpty(this.ScreenObject.GridData[O][T.ValueMember])||(a=this.ScreenObject.GridData[O][T.ValueMember].toString())}if(!o.e.IsEmpty(this.ScreenObject.GridData[O].dcAlpha4_key)&&!o.e.IsEmpty(this.ScreenObject.GridData[O].dcAlpha5_key)&&(this.strValidationMessage=this.IsDocLocked(a,new Date(this.ScreenObject.GridData[O].dcAlpha4_key),new Date(this.ScreenObject.GridData[O].dcAlpha5_key),e),""!=this.strValidationMessage))break}}else if(72==this.ScreenObject.DocumentType){if(s.a.SessionManager.Preferences.ContainsKey("AllowVacationifPayrollProcessedorLocked")&&Object(l.j)("False"==s.a.SessionManager.Preferences.AllowVacationifPayrollProcessedorLocked)){var j=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));null!=j&&(j instanceof C.b||j instanceof p.a)&&(a=j.SelectedValue.toString());var P=this.ScreenObject._TextFields.find((function(e){return"dcalpha2"==e.DBColumnName.toLowerCase()}));null!=P&&P instanceof S.c&&!o.e.IsEmpty(P.Date)&&(t=P.Date),null!=(P=this.ScreenObject._TextFields.find((function(e){return"dcalpha3"==e.DBColumnName.toLowerCase()})))&&P instanceof S.c&&!o.e.IsEmpty(P.Date)&&(n=P.Date),this.strValidationMessage=this.IsDocLocked(a,t,n,e)}}else if(56==this.ScreenObject.DocumentType)for(var A=0;A<this.ScreenObject.GridData.length;A++){var M=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));if(null!=M&&(M instanceof C.b||M instanceof p.a)&&(a=M.SelectedValue.toString()),!o.e.IsEmpty(this.ScreenObject.GridData[A].dcAlpha6_Key)&&(this.strValidationMessage=this.IsDocLocked(a,new Date(this.ScreenObject.GridData[A].dcAlpha6_Key),new Date(this.ScreenObject.GridData[A].dcAlpha6_Key),e),""!=this.strValidationMessage))break}return this.strValidationMessage}},{key:"OpenFile",value:function(e){var t=this;if(1!==e.target.files.length)throw new Error("Cannot use multiple files");var n=new FileReader,a=e.target.files[0];n.onload=function(a){var i=Ce.read(n.result,{type:"binary"});t.ExcelData=Ce.utils.sheet_to_json(i.Sheets[i.SheetNames[0]],{header:1}),t.ExcelTable=t.ExcelData;try{t.ActualFileName=e.target.value,t.DtImport.Clear();for(var r=0;r<t.ExcelData[0].length;r++){var s=t.DtImportObj.NewRow();t.DtImportObj.addRow(s),s.FieldName=t.ExcelData[0][r],t.DtImportObj.updateRow(s)}if(console.log(t.DtImport),console.log("DTImport"),!o.e.IsEmpty(t.ImportCols[1].DefaultValueText)){var c=new o.f;c.LoadXml(t.ImportCols[1].DefaultValueText),null!=c&&c.DocumentElement.children[0].childNodes.forEach((function(e){for(var n=0;n<t.DtImport.length;n++)(n+1).toString()==e[0].value.toString()&&(t.DtImport[n].FeatureFieldName=e[2].value.toString())}))}}catch(l){return void(t.DisplayMessage=l.Message)}},n.readAsBinaryString(a)}},{key:"prepareLineItemsToForm",value:function(){var e=this;this.leaveTab.Enable=!1,this.leaveTab.Visible=!1,this.displayLineItems=!0,40062==this.CostCenterID&&(this.displayAgGrid=!1,this.BodyVisible=!1,this.displayLineItems=!1,s.a.IsMobile&&(this.BodyVisible=!1),this.ScreenObject.GridDataObj.refreshUI(),this.leaveTab=new P.b,this.leaveTab.Enable=!0,this.leaveTab.Visible=!0,this.leaveTab.Header="Details",this.leaveTab.Name="Details",this.leaveTab.Fields=this.ScreenObject.LineItemFields,this.assignedLeaves=this.leaveTab.Fields.filter((function(e){return"dcAlpha2"==e.DBColumnName}))[0],this.availableLeaves=this.leaveTab.Fields.filter((function(e){return"dcAlpha3"==e.DBColumnName}))[0],this.noOfDays=this.leaveTab.Fields.filter((function(e){return"dcAlpha7"==e.DBColumnName}))[0],this.fromDate=this.leaveTab.Fields.filter((function(e){return"dcAlpha4"==e.DBColumnName}))[0],this.toDate=this.leaveTab.Fields.filter((function(e){return"dcAlpha5"==e.DBColumnName}))[0],this.session=this.leaveTab.Fields.filter((function(e){return"dcAlpha6"==e.DBColumnName}))[0],this.session.Text="",this.session.SelectedValue="",this.leaveTab.Fields.forEach((function(t){t instanceof C.b?t.OnPactListBoxValueChanged.Subscribe(e,"onLineItemsChange"):t instanceof S.a||t instanceof S.c?t.SelectedDateChanged.Subscribe(e,"onLineItemsChange"):t instanceof m.e?t.SelectionChangedCommand.Subscribe(e,"onLineItemsChange"):t instanceof h.d&&t.TextChangedCommand.Subscribe(e,"onLineItemsChange")})))}},{key:"refresh",value:function(e){return!1}},{key:"onLineItemsChange",value:function(e,t){var n=null!=t;e instanceof h.d&&null!=t&&(n=!1);var a=e;if(!n){if(t=this.ScreenObject.GridData[0],e instanceof C.b){if(null==a.SelectedItem)return;t[e.DBColumnName]=a.SelectedItem.Name,t[e.DBColumnName+"_Key"]=a.SelectedItem.NodeID}else if(e instanceof S.a||e instanceof S.c){if(null==a.Date)return;t[e.DBColumnName]=a.Date.ToString(s.a.SessionManager.Preferences["Date Format"]),t[e.DBColumnName+"_Key"]=a.Date}else if(e instanceof m.e)t[e.DBColumnName]=a._SelectedValue;else if(e instanceof h.d)return void(t[e.DBColumnName]=a.Text);this.ScreenObject.GridDataObj.updateRow(this.ScreenObject.GridData[0])}e instanceof h.d||(this.ScreenObject.GridDataColumns.Contains(e.DBColumnName)&&!o.e.IsEmpty(t[e.DBColumnName])&&this.FillDefaultProd(t,e.DBColumnName),this.Celleditend(t,e.DBColumnName,null!=e.CCID?e.CCID:0),this.ScreenObject.GridDataObj.updateRow(t),this.PoleDisplayMessage(2,t),n||this.onPrepareDatesGrid()),this.onBindLeaveAssignDetails()}},{key:"onBindLeaveAssignDetails",value:function(){var e=this,t=this.ScreenObject.GridData[this.ScreenObject.GridData.length-1];if(null==t.dcAlpha3&&null==t.dcAlpha2&&null!=this.ScreenObject.GridData[this.ScreenObject.GridData.length-2]&&(t=this.ScreenObject.GridData[this.ScreenObject.GridData.length-2]),null!=t){this.assignedLeaves.Text=t.dcAlpha2,this.availableLeaves.Text=t.dcAlpha3;var n=!1;this.leaveTab.Fields.forEach((function(e){e instanceof C.b?e.OnPactListBoxValueChanged=new y.b:e instanceof S.a||e instanceof S.c?e.SelectedDateChanged=new y.b:e instanceof m.e?e.SelectionChangedCommand=new y.b:e instanceof h.d&&(e.TextChangedCommand=new y.b)})),this.leaveTab.Fields.forEach((function(e){e instanceof h.d||e instanceof h.c||e instanceof O.a?e.Text=o.e.String(t[e.DBColumnName]):e instanceof m.e?e.SelectedValue=o.e.String(t[e.DBColumnName]):e instanceof S.c?("dcAlpha4"!=e.DBColumnName&&"dcAlpha5"!=e.DBColumnName||null!=e.Date||(n=!0),null!=t[e.DBColumnName+"_Key"]?(e.Date=new Date(t[e.DBColumnName+"_Key"].ToString("MM-dd-yyyy")),t[e.DBColumnName+"_Key"]=e.Date):e.Date=null):e instanceof S.b?e.Date=null!=t[e.DBColumnName+"_Key"]?new Date(t[e.DBColumnName+"_Key"].ToString("MM-dd-yyyy")):null:e instanceof S.a&&("dcAlpha4"!=e.DBColumnName&&"dcAlpha5"!=e.DBColumnName||null!=e.Date||(n=!0),null!=t[e.DBColumnName+"_Key"]&&(e.Date=new Date(t[e.DBColumnName+"_Key"].ToString("MM-dd-yyyy"))))})),setTimeout((function(){e.leaveTab.Fields.forEach((function(t){t instanceof C.b?t.OnPactListBoxValueChanged.Subscribe(e,"onLineItemsChange"):t instanceof S.a||t instanceof S.c?t.SelectedDateChanged.Subscribe(e,"onLineItemsChange"):t instanceof m.e?t.SelectionChangedCommand.Subscribe(e,"onLineItemsChange"):t instanceof h.d&&t.TextChangedCommand.Subscribe(e,"onLineItemsChange")}))}),70),n&&this.onLineItemsChange(this.toDate,null)}var a=this.ScreenObject.GridData.reduce((function(e,t){return e+(null!=t.dcAlpha7?parseFloat(t.dcAlpha7):0)}),0);this.noOfDays.Text=isNaN(a)?0:a}},{key:"onPrepareDatesGrid",value:function(){var e=this;if(null!=this.fromDate.Date&&null!=this.toDate.Date){if("Both"==this.session._SelectedValue||null==this.session._SelectedValue||""==this.session._SelectedValue)return s.a.IsMobile||(this.BodyVisible=!1),this.displayAgGrid=!1,void this.ScreenObject.GridDataObj.Table.forEach((function(t){null!=t.dcAlpha1&&(t.dcAlpha6="Both",e.Celleditend(t,"Name",0),e.ScreenObject.GridDataObj.updateRow(t),e.PoleDisplayMessage(2,t))}));this.displayAgGrid=!0,s.a.IsMobile||(this.BodyVisible=!0);var t=0,n=this.ScreenObject._CCFields.find((function(e){return"dcccnid51"==e.DBColumnName.toLowerCase()}));(n&&n instanceof C.b&&n.SelectedValue>0||n&&n instanceof p.a&&n.SelectedValue>0)&&(t=n.SelectedValue);var a=s.a.mcommon.GetAttendanceDetails(this.fromDate.Date.ToString("dd/MMM/yyyy"),this.toDate.Date.ToString("dd/MMM/yyyy"),t);this.LeaveData=[];for(var i=0;i<a.length;i++){var r=a[i];this.LeaveData.push({Date:r.AttDate,Type:r.AttendanceType,Morning:!1,Afternoon:!1,Full:!0})}var o=Object.assign({},this.ScreenObject.GridDataObj.Table[0]);this.ScreenObject.GridDataObj.Clear(),this.LeaveData.forEach((function(t){if("Weekly Off"!=t.Type&&"Holidays"!=t.Type&&"OnLeave"!=t.Type){var n=Object.assign({},o),a=new Date(t.Date.split("/")[1]+"/"+t.Date.split("/")[0]+"/"+t.Date.split("/")[2]),i=a.ToString(s.a.SessionManager.Preferences["Date Format"]);t.FDate=i,0==e.ScreenObject.GridDataObj.Table.filter((function(e){return e.dcAlpha4==i})).length&&(n.DocSeqNo=e.ScreenObject.GridDataObj.Table.length+1,n.SNo=e.ScreenObject.GridDataObj.Table.length+1,n.id=n.SNo,n.dcAlpha4=i,n.dcAlpha4_Key=a,n.dcAlpha5=i,n.dcAlpha5_Key=a,n.dcAlpha6="Both",e.ScreenObject.GridDataObj.addRow(n),e.Celleditend(n,"Name",0),e.ScreenObject.GridDataObj.updateRow(n),e.PoleDisplayMessage(2,n))}})),this.OnSesionGridDataChanged.Call(),this.ScreenObject.GridDataObj.refreshDataView()}}},{key:"onEditLeaveData",value:function(e,t){var n=this;if(this.leaveTab.Fields.forEach((function(e){e instanceof C.b?e.OnPactListBoxValueChanged=new y.b:e instanceof S.a||e instanceof S.c?e.SelectedDateChanged=new y.b:e instanceof m.e?e.SelectionChangedCommand=new y.b:e instanceof h.d&&(e.TextChangedCommand=new y.b)})),this.ScreenObject.LoadFieldsData(e.Tables[1],this.ScreenObject.LineItemFields,t,e.Columns[1]),this.ScreenObject.LoadFieldsData(e.Tables[3],this.ScreenObject.LineItemFields,t,e.Columns[3]),null!=this.toDate){var a=e.Tables[3][e.Tables[3].length-1].dcAlpha4;o.e.isValidDate(a)&&(this.toDate.Date=new Date(a))}this.onPrepareDatesGrid(),setTimeout((function(){var t=!0;e.Tables[3].forEach((function(e){"Both"!=e.dcAlpha6&&(t=!1);var a=n.LeaveData.filter((function(t){return t.Date==e.dcAlpha4}));0!=a.length&&("Session1"==e.dcAlpha6?(a[0].Full=!1,a[0].Morning=!0,a[0].Afternoon=!1):"Session2"==e.dcAlpha6?(a[0].Full=!1,a[0].Morning=!1,a[0].Afternoon=!0):(a[0].Full=!0,a[0].Morning=!1,a[0].Afternoon=!1))})),t?(n.displayAgGrid=!1,n.BodyVisible=!1):(n.displayAgGrid=!0,n.BodyVisible=!0),n.OnSesionGridDataChanged.Call(),n.onBindLeaveAssignDetails(),n.leaveTab.Fields.forEach((function(e){e instanceof C.b?e.OnPactListBoxValueChanged.Subscribe(n,"onLineItemsChange"):e instanceof S.a||e instanceof S.c?e.SelectedDateChanged.Subscribe(n,"onLineItemsChange"):e instanceof m.e?e.SelectionChangedCommand.Subscribe(n,"onLineItemsChange"):e instanceof h.d&&e.TextChangedCommand.Subscribe(n,"onLineItemsChange")}))}),40)}},{key:"EmpAccessibility",value:function(e,t,n,a){var i=[],r="",c=0,l="",u="",d="",D="",h=null;console.log("EmpAccessibility Inside");try{if(i.push(s.a.SessionManager.CompanyIndex),i.push(s.a.SessionManager.iEmployee),h=s.a.empService.ExecuteQuery_SP(i,"spPAY_GetGeoLocation"),o.e.IsEmpty(h)||!(h.Tables.length>0))return a.Flag="404",a.Msg="No records found please contact your system administrator!",console.log(a.Msg),!0;if(!(h.Tables[0].length>0&&h.Tables[1].length>0))return a.Flag="404",a.Msg="No records found please contact your system administrator!",console.log(a.Msg),!1;if(l=o.e.String(h.Tables[0][0].Latitude),u=o.e.String(h.Tables[0][0].Longitude),o.e.String(h.Tables[1][0].CheckInOutDevice),r=o.e.String(h.Tables[1][0].AccessAnyWhere),c=parseInt(h.Tables[1][0].CheckInOutMobileRange||250),d=o.e.String(h.Tables[1][0].AttSetType),D=o.e.String(h.Tables[1][0].AttSetDimNodes),"True"==r)return a.Flag="200",a.Msg="Allowed",!0;var S;if("Company"==d)return S=o.e.haversineDistance({latitude:t,longitude:n},{latitude:l,longitude:u}),console.log("ApiRangeValue KM  "+S),S*=1e3,console.log("ApiRangeValue Meter only  "+S),console.log("strCatSetType  "+d),c>0&&S<=c?(a.Flag="200",a.Msg=" Allowed",console.log(a.Msg),!0):(a.Flag="404",a.Msg=" Not Allow for this location to check-in/check-out, out of range",console.log(a.Msg),!1);if("Dimension"==d){if(console.log("strCatSetType"+d),!(D.length>0))return a.Flag="500",a.Msg=" No location is assigned",console.log(a.Msg),!1;var m=D.split(",");if(m.length>0){for(var b=!1,C=function(e){var i=m[e],r=void 0,s=void 0;if(h.Tables[0].length>0){var l=h.Tables[0].find((function(e){return e.NodeID==i}));if(s=o.e.IsEmpty(l.Longitude)?0:l.Longitude,r=o.e.IsEmpty(l.Latitude)?0:l.Latitude,console.log("CurrUserLat"+t+"CurrUserLong"+n),console.log("strNodeLat"+r+"strNodeLon"+s),S=o.e.haversineDistance({latitude:t,longitude:n},{latitude:r,longitude:s}),console.log("ApiRangeValue KM"+S+"index"+e),S*=1e3,console.log("ApiRangeValue Meter"+S+"index"+e),c>0&&S<=c)return{v:(a.Flag="200",a.Msg=" Allowed",void(b=!0))}}},y=0;y<m.length;y++){var p=C(y);if("object"==typeof p)return p.v}return b?(a.Flag="200",a.Msg=" Allowed",!0):(a.Flag="404",a.Msg=" You are not allowed to check-in/check-out, out of range from this location",console.log(a.Msg),!1)}}}catch(g){console.log("catch (error) "+g),console.log("Excetion EmpAccessibility"+g)}return!1}},{key:"IsPurchase",get:function(){return this.ScreenObject.IsPurchase}},{key:"SetFocusongrid",get:function(){return this._SetFocusongrid},set:function(e){this._SetFocusongrid=!this._SetFocusongrid,this.ScreenObject.GridDataObj.TosetFocus.Call({LineNo:this.LineNo,ColumnNo:this.ColumnNo})}},{key:"POSBalanceAmount",get:function(){return this.ScreenObject.Preferences.ContainsKey("DecimalsNetAmount")&&""!=this.ScreenObject.Preferences.DecimalsNetAmount?(s.a.SessionManager.Preferences.ContainsKey("Commas"),this.Bal.ToString("N"+this.ScreenObject.Preferences.DecimalsNetAmount)):(s.a.SessionManager.Preferences.ContainsKey("Commas"),this.Bal.toString())}},{key:"NetAmountObs",get:function(){return this._NetAmountObs},set:function(e){var t=o.e.Double(e);this._NetAmountObs=(this.ScreenObject.Preferences.ContainsKey("DecimalsNetAmount"),t.Commas("N"+this.ScreenObject.Preferences.DecimalsNetAmount))}},{key:"NetAmount",get:function(){var e=1,t=0;return s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&null!=this.Currency&&null!=this.Currency.ExchangeRate.Text&&""!=this.Currency.ExchangeRate.Text&&this.ScreenObject.Preferences.ContainsKey("NettotaldocumentCurrency")&&""!=this.ScreenObject.Preferences.NettotaldocumentCurrency&&Object(l.j)(this.ScreenObject.Preferences.NettotaldocumentCurrency)&&o.e.IsNum(this.Currency.ExchangeRate.Text)&&(e=parseFloat(this.Currency.ExchangeRate.Text)),t=0!=e?(this.GridNetTotal+this.FooterGridNetTotal)/e:this.GridNetTotal+this.FooterGridNetTotal,this.ScreenObject.Preferences.ContainsKey("DecimalsNetAmount")&&""!=this.ScreenObject.Preferences.DecimalsNetAmount?(s.a.SessionManager.Preferences.ContainsKey("Commas")&&"Millions"!=s.a.SessionManager.Preferences.Commas&&(this.NetAmountObs=t.ToString("N"+this.ScreenObject.Preferences.DecimalsNetAmount)),t.ToString("N"+this.ScreenObject.Preferences.DecimalsNetAmount)):(s.a.SessionManager.Preferences.ContainsKey("Commas")&&"Millions"!=s.a.SessionManager.Preferences.Commas&&(this.NetAmountObs=t.toString()),this.NetAmountObs=t.toString(),this.NetAmountObs)}},{key:"DynFooter",set:function(e){this.ScreenObject.FooterGridDataObj.CanUserAddRows=e}},{key:"DocumentDate",get:function(){return this._Ddate},set:function(e){o.e.isValidDate(e)&&o.e.isValidDate(this._Ddate)&&e.getDate()===this._Ddate.getDate()||e!=this._Ddate&&(this._Ddate=e,this.ScreenObject.ovDate.Date=e,this.ScreenObject.DocDate&&(this.ScreenObject.DocDate.Date=e),0==this.ScreenObject.DocID&&this.CheckDateInDocNumber(!1),this.ReEvaluate(!0),null!=this.AutoPostViewModel&&(this.AutoPostViewModel.DocumentDate=e),s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&this.FillExchangeRates())}},{key:"SelectedRow",get:function(){return this.ScreenObject.GridDataObj.SelectedItem},set:function(e){e!=this.ScreenObject.GridDataObj.SelectedItem&&(o.e.IsEmpty(this.NUmpadBindingPath)||(this.NUmpadBindingPath=""),this.ScreenObject.GridDataObj.SelectedItem=e,this.SetReportDim())}},{key:"SelectedRowColumns",get:function(){return this.ScreenObject.GridDataColumns}},{key:"DocStatus",get:function(){return this._DocStatus},set:function(e){e!=this._DocStatus&&(this._DocStatus=e,this.setStatusColor())}},{key:"DocStatusText",get:function(){return!(this._DocStatus.length>0)||this._DocStatus.Contains("[")&&this._DocStatus.Contains("(")?this._DocStatus:this._DocStatus.substring(1,this._DocStatus.length-1)}},{key:"UpdateFooter",set:function(e){}},{key:"HistoryUpdateFooter",set:function(e){}},{key:"RefreshGridFooter",set:function(e){}},{key:"RefreshGrid",set:function(e){this.ScreenObject.GridDataObj.RefreshGrid=!0,this.ScreenObject.GridDataObj.RefreshGridView()}},{key:"ApproveVisibility",set:function(e){e!=this._ApproveVisibility&&(e?s.a.page.ShowDialog(this,_e.a,{ShowCenter:!0,HideClose:!0,NoWidth:!0,Title:s.a.GetResource("ApproveReject")}):s.a.page.HideDialog(),this._ApproveVisibility=e),this._SuspendVisiblity=!1}},{key:"SuspendVisiblity",set:function(e){e!=this._SuspendVisiblity&&(e||s.a.page.HideDialog(),this._SuspendVisiblity=e)}},{key:"DtImport",get:function(){return this.DtImportObj.Table},set:function(e){this.DtImportObj.Table=e}},{key:"IsPOs",get:function(){return null!=this.ScreenObject&&(38==this.ScreenObject.DocumentType||39==this.ScreenObject.DocumentType)}},{key:"ImportCols",get:function(){return this.DtImportObj.Columns},set:function(e){this.DtImportObj.Columns=e}},{key:"AttachmentVisibility",get:function(){return this._AttachmentVisibility},set:function(e){e!=this._AttachmentVisibility&&(this._AttachmentVisibility=e)}},{key:"DocID",get:function(){return null!=this.ScreenObject?this.ScreenObject.DocID:0}},{key:"GRIDTABLE",get:function(){return null!=this.ScreenObject?this.ScreenObject.GridData:[]}},{key:"ColumnSource",get:function(){return this.ScreenObject.ColumnSource}},{key:"DoNotPrintUnApprovedDocuments",get:function(){return!!this.ScreenObject.Preferences.ContainsKey("DoNotPrintUn-ApprovedDocuments")&&"TRUE"==this.ScreenObject.Preferences["DoNotPrintUn-ApprovedDocuments"].toUpperCase()}},{key:"DoNotEmailSMSUnApprovedDocuments",get:function(){return!!this.ScreenObject.Preferences.ContainsKey("DoNotEmailOrSMSUn-ApprovedDocuments")&&"TRUE"==this.ScreenObject.Preferences["DoNotEmailOrSMSUn-ApprovedDocuments"].toUpperCase()}},{key:"Attachment",get:function(){return this._Attachment},set:function(e){e!=this._Attachment&&(this._Attachment=e)}},{key:"BudgetObj",get:function(){return null==this._BudgetObj&&(this._BudgetObj=new tt(this)),this._BudgetObj}}],[{key:"getStatusColor",value:function(e){var t="#fff";return 9==(t=369==e?s.a.SessionManager.Preferences.PostedColor:370==e?s.a.SessionManager.Preferences.PDCColor:371==e?s.a.SessionManager.Preferences.UnApprovedColor:372==e?s.a.SessionManager.Preferences.RejectedColor:376==e?s.a.SessionManager.Preferences.CancelledColor:429==e?s.a.SessionManager.Preferences.BouncedColor:441==e?s.a.SessionManager.Preferences.ApprovedColor:"#FF736F6F").length&&(t.startsWith("#FF")||t.startsWith("#ff"))&&(t="#"+t.substr(3)),t}},{key:"GetPrimarkyKey",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return 2==e?"AccountID":3==e?"ProductID":t?"CCNID"+(e-5e4):"NodeID"}},{key:"GetTotalMonthsFrom",value:function(e,t){for(var n=e.Date()>t.Date()?t.Date():e.Date(),a=e>t.Date()?e.Date():t.Date(),i=1;n.AddMonths(i)<=a;)i++;return i}},{key:"GetTagTableName",value:function(e){return 2==e?"ACC_Accounts":3==e?"INV_Product":7==e?"ADM_Users":50001==e?"COM_Division":50002==e?"COM_Location":50003==e?"COM_Branch":50004==e?"COM_Department":50005==e?"COM_Salesman":50006==e?"COM_Category":50007==e?"COM_Area":50008==e?"COM_Teritory":"COM_CC"+e}}]),a}(u.b);i=new WeakMap;var nn=function e(){_classCallCheck(this,e),this.Name="",this.Message=""}},"3WaB":function(e,t,n){"use strict";n.d(t,"a",(function(){return D}));var a=n("mrSG"),i=n("Do2H"),r=n("Lp6j"),s=n("eQJW"),o=n("4HhE"),c=n("n56n"),l=n("NkMH"),u=n("ScVY"),d=n("Huqd"),D=function(e){_inherits(u,e);var t=_createSuper(u);function u(e){var n;_classCallCheck(this,u),(n=t.call(this)).ButtonClick=new o.b,n.Groups=[],n.Parent=null,n.wid="50",n.ht="50",n.tWhere="",Logger.InfoLog("TouchScreenViewModel:: Entering TouchScreenViewModel"),n.Parent=e,n.ButtonClick.Subscribe(_assertThisInitialized(n),"OnButtonClick"),n.Groups=[];var a=null;if(n.Parent.ScreenObject.Data.Columns[11].Contains("CCID")&&n.Parent.ScreenObject.Data.Tables[11].length>0){r.e.IsEmpty(n.Parent.ScreenObject.Data.Tables[11][0].ButtonHeight)||(n.ht=n.Parent.ScreenObject.Data.Tables[11][0].ButtonHeight.toString()),r.e.IsEmpty(n.Parent.ScreenObject.Data.Tables[11][0].ButtonWidth)||(n.wid=n.Parent.ScreenObject.Data.Tables[11][0].ButtonWidth.toString());for(var i=0;i<n.Parent.ScreenObject.Data.Tables[11].length-1;i++)"3"==n.Parent.ScreenObject.Data.Tables[11][i].CCID.toString()?a=n.Parent.ScreenObject.Data.Tables[11][i]:r.e.IsEmpty(n.Parent.ScreenObject.Data.Tables[11][i].CCID)||(n.Groups.push(new c.b),n.Groups[i].CCID=parseInt(n.Parent.ScreenObject.Data.Tables[11][i].CCID.toString()),""!=n.Parent.ScreenObject.Data.Tables[11][i].Map.toString()&&(n.Groups[i].Dependancy=parseInt(n.Parent.ScreenObject.Data.Tables[11][i].Map.toString())),r.e.IsEmpty(n.Parent.ScreenObject.Data.Tables[11][i].ParentCCID)||(n.Groups[i].DBColumnID=parseInt(n.Parent.ScreenObject.Data.Tables[11][i].ParentCCID.toString())),n.Groups[i].Label=n.Parent.ScreenObject.Data.Tables[11][i].Name.toString()+" >>",n.Groups[i].Expression=n.Parent.ScreenObject.Data.Tables[11][i].Filter,n.Groups[i].Expression=r.e.IsEmpty(n.Groups[i].Expression)?"":n.GetExpression(n.Groups[i].Expression),r.e.IsEmpty(n.Parent.ScreenObject.Data.Tables[11][i].ColumnInUse)||(n.Groups[i].Dependantinuse=Object(s.j)(n.Parent.ScreenObject.Data.Tables[11][i].ColumnInUse.toString())),n.Groups[i].SelectionChangedCommand.Subscribe(_assertThisInitialized(n),"OnButtonClick"),n.Groups[i].Visible=!1)}var l=new c.b;return l.CCID=3,l.Visible=!1,l.Label="Products",n.Groups.length>0&&(l.DBColumnID=n.Groups[n.Groups.length-1].CCID),null==a&&""!=n.Parent.ScreenObject.Data.Tables[11][n.Parent.ScreenObject.Data.Tables[11].length-1].ColumnInUse.toString()?l.Dependantinuse=Object(s.j)(n.Parent.ScreenObject.Data.Tables[11][n.Parent.ScreenObject.Data.Tables[11].length-1].ColumnInUse):null!=a&&""!=n.Parent.ScreenObject.Data.Tables[11][n.Parent.ScreenObject.Data.Tables[11].length-2].ColumnInUse.toString()&&(l.Dependantinuse=Object(s.j)(n.Parent.ScreenObject.Data.Tables[11][n.Parent.ScreenObject.Data.Tables[11].length-2].ColumnInUse)),l.Expression=null==a||r.e.IsEmpty(a.Filter).toString()?"":n.GetExpression(a.Filter.toString()),n.Groups.push(l),r.e.IsEmpty(n.Parent.ScreenObject.Data.Tables[11][n.Parent.ScreenObject.Data.Tables[11].length-1].Filter).toString()||(n.tWhere=" and "+n.Parent.ScreenObject.Data.Tables[11][n.Parent.ScreenObject.Data.Tables[11].length-1].Filter.toString(),n.tWhere=n.GetExpression(n.tWhere)),n.Groups.length>0&&n.FillButtons(n.Groups[0]),Logger.InfoLog("TouchScreenViewModel:: Entering TouchScreenViewModel"),n}return _createClass(u,[{key:"GetExpression",value:function(e){for(var t=0;t<this.Parent.ScreenObject._CCFields.length;t++)this.Parent.ScreenObject._CCFields[t]instanceof c.b&&e.Contains("@dim"+(this.Parent.ScreenObject._CCFields[t].CCID-5e4))?this.Parent.ScreenObject._CCFields[t].SelectedValue>0&&(e=e.Replace("@dim"+(this.Parent.ScreenObject._CCFields[t].CCID-5e4),this.Parent.ScreenObject._CCFields[t].SelectedValue.toString())):this.Parent.ScreenObject._CCFields[t]instanceof d.a&&e.Contains("@dim"+(this.Parent.ScreenObject._CCFields[t].CCID-5e4))&&this.Parent.ScreenObject._CCFields[t].SelectedValue>0&&(e=e.Replace("@dim"+(this.Parent.ScreenObject._CCFields[t].CCID-5e4),this.Parent.ScreenObject._CCFields[t].SelectedValue.toString()));return e.Contains("@dim2")&&this.Parent.ScreenObject.LocationID>0&&(e=e.Replace("@dim2",this.Parent.ScreenObject.LocationID.toString())),e.Contains("@dim1")&&this.Parent.ScreenObject.DivisionID>0&&(e=e.Replace("@dim1",this.Parent.ScreenObject.DivisionID.toString())),e.Contains("@REGISTER")&&this.Parent.ScreenObject.RegisterNodeID>0&&(e=e.Replace("@REGISTER",this.Parent.ScreenObject.RegisterNodeID.toString())),e}},{key:"Search",value:function(){var e=this;if(r.e.IsEmpty(this.SearchText))this.ButtonsData.forEach((function(e){return e.IsTabStop=!0}));else{var t=this.ButtonsData.filter((function(t){return t.Label.toLowerCase().Contains(e.SearchText.toLowerCase())||!r.e.IsEmpty(t.ToolTipDescription)&&t.ToolTipDescription.toLowerCase().Contains(e.SearchText.toLowerCase())}));this.ButtonsData.forEach((function(e){return e.IsTabStop=t.Contains(e)}))}}},{key:"FillButtons",value:function(e){e.Visible=!0,e.SelectedValue=0,e.Text="";var t="",n="";3==e.CCID?(t=" p.IsGroup=0 ",this.Groups.indexOf(e)>0&&this.Groups[this.Groups.indexOf(e)-1].DBColumnID<0&&(t=t+" AND p.ParentID="+e.FeatureID)):e.CCID<0?(t=" p.Depth="+-e.CCID,this.Groups.indexOf(e)>0&&(t=t+" AND p.ParentID="+e.FeatureID)):t=" a.IsGroup=0 ",r.e.IsEmpty(e.Expression)||(t+=" and "+e.Expression);var a=this.Groups.find((function(t){return t.CCID==e.DBColumnID}));null!=a&&a.SelectedValue>0&&(e.Dependantinuse?t+=50006==e.DBColumnID?" and CategoryID="+a.SelectedValue.toString():50004==e.DBColumnID?" and DepartmentID="+a.SelectedValue.toString():" and ccnid"+(e.DBColumnID-5e4)+"="+a.SelectedValue.toString():5==e.Dependancy&&e.CCID>0&&(n="JOIN "+this.Parent.ScreenObject.GetTableName(e.CCID)+" CMJ WITH(NOLOCK) ON a.lft between  CMJ.lft and CMJ.rgt \n                                 JOIN COM_CostCenterCostCenterMap CM WITH(NOLOCK) on CM.CostCenterID="+e.CCID+" and CM.ParentCostCenterID="+a.CCID+" and CM.ParentNodeID="+a.SelectedValue.toString()+' and CMJ.NodeID=CM.NodeID ";\n                    else if (grp.Dependancy > 0 && grp.CCID > 0 && !(this.Groups.indexOf(grp) > 0 && (this.Groups[this.Groups.indexOf(grp) - 1].DBColumnID < 0 || this.Groups[this.Groups.indexOf(grp) - 1].CCID < 0)))\n                        join = " JOIN COM_CostCenterCostCenterMap CM WITH(NOLOCK) on CM.ParentCostCenterID='+e.CCID+" and "+(3==e.CCID?"p.ProductID":"a.NodeID")+"=CM.ParentNodeID \n                                 JOIN "+this.Parent.ScreenObject.GetTableName(a.CCID)+" CMJ WITH(NOLOCK) ON CM.CostCenterID= "+a.CCID+"   and CM.NodeID=CMJ.NodeID \n                                 JOIN "+this.Parent.ScreenObject.GetTableName(a.CCID)+" CMJG WITH(NOLOCK) ON CMJG.lft between  CMJ.lft and CMJ.rgt and CMJG.NodeID="+a.SelectedValue));var o=this.Parent.ScreenObject.GetCCData(e.CCID,t,n,this.tWhere);if(null!=o&&!o.Columns.Contains("ErrorMessage")){for(var c="",u=[],d=0;d<o.length;d++){var D=new l.a;D.FeatureID=parseInt(o[d].ID.toString()),D.DBColumnID=e.CCID<0&&o.Columns.Contains("IsGroup")&&!Object(s.j)(o[d].IsGroup.toString())?3:e.CCID,D.ClickCommand.Subscribe(this,"OnButtonClick"),D.Width=this.wid,D.SectionID=this.ht,D.Mandatory=!1,D.Visible=!1,D.IsTabStop=!0,D.Dependantinuse=!1,3==D.DBColumnID?(c+=D.FeatureID+",","true"==i.a.SessionManager.Preferences.POSShowProductCode.toLowerCase()?("true"==i.a.SessionManager.Preferences.POSShowProductName.toLowerCase()&&(D.ToolTipDescription=o[d].name.toString(),D.Mandatory=!0),D.Label="true"==i.a.SessionManager.Preferences.POSShowStockCodes.toLowerCase()&&o.Columns.Contains("StkCode")?o[d].StkCode.toString():o[d].Code.toString()):"true"==i.a.SessionManager.Preferences.POSShowProductName.toLowerCase()&&(D.Label=o[d].name.toString()),"true"!=i.a.SessionManager.Preferences.POSShowProductImage.toLowerCase()&&"true"!=i.a.SessionManager.Preferences.POSShowDimImage.toLowerCase()||!o.Columns.Contains("FileName")||(D.Visible=!0,D.ToolTipFooterDescription=r.e.IsEmpty(o[d].FileName)?i.a.SessionManager.IsWebApplication?"NO Image Available.png":"/PACT.VIEW;component/Images/NO Image Available.png":i.a.SessionManager.IsWebApplication?o[d].FileName.toString():r.e.GetPath(o[d].FileName.toString())),""!=i.a.SessionManager.Preferences.POSSellingRate.toLowerCase()&&o.Columns.Contains("MRP")&&(D.Dependantinuse=!0,D.KeyTip=o[d].MRP.toString()),o.Columns.Contains("StkCode")&&(D.ToolTipFooterTitle=o[d].StkCode.toString(),D.ToolTipTitle=o[d].NodeID.toString())):(D.Label=o[d].name.toString(),D.DBColumnID<0?"true"==i.a.SessionManager.Preferences.POSShowProductImage.toLowerCase()&&o.Columns.Contains("FileName")&&(D.Visible=!0,D.ToolTipFooterDescription=r.e.IsEmpty(o[d].FileName)?i.a.SessionManager.IsWebApplication?"NO Image Available.png":"/PACT.VIEW;component/Images/NO Image Available.png":i.a.SessionManager.IsWebApplication?o[d].FileName.toString():r.e.GetPath(o[d].FileName.toString())):"true"==i.a.SessionManager.Preferences.POSShowDimImage.toLowerCase()&&o.Columns.Contains("FileName")&&(D.Visible=!0,D.ToolTipFooterDescription=r.e.IsEmpty(o[d].FileName)?i.a.SessionManager.IsWebApplication?"NO Image Available.png":"/PACT.VIEW;component/Images/NO Image Available.png":i.a.SessionManager.IsWebApplication?o[d].FileName.toString():r.e.GetPath(o[d].FileName.toString()))),u.push(D)}if(c.length>2&&"PriceChart"==i.a.SessionManager.Preferences.POSSellingRate){c=c.substr(0,c.length-1);var h=this.Parent.ScreenObject.GetProductPrices(c,this.Parent.DocumentDate);null!=h&&h.Columns[0].Contains("ProductID")&&u.forEach((function(e){var t=h.Tables[0].filter((function(t){return t.ProductID==e.FeatureID})).sort((function(e,t){return e.RowID-t.RowID}));t.length>0&&(e.Dependantinuse=!0,e.KeyTip=t[0].SellingRate.toString())}))}this.ButtonsData=u}}},{key:"OnButtonClick",value:function(e){return Object(a.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var a,o,u,d,D,h,S,m,b,C,y,p,g=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([n.e(2),n.e(1),n.e(3),n.e(5),n.e(4),n.e(6),n.e(7),n.e(10),n.e(9),n.e(12),n.e(11),n.e(13),n.e(19),n.e(15),n.e(21),n.e(20),n.e(16),n.e(14),n.e(18),n.e(17),n.e(22),n.e(148)]).then(n.bind(null,"1Cra"));case 2:return t.next=4,n.e(196).then(n.bind(null,"7Uhj"));case 4:if(!(e instanceof l.a)){t.next=9;break}3==(a=e).DBColumnID?(o=this.Parent.GetEmptyRowPosition(this.Parent.ScreenObject.GridDataObj,"ProductID_Key"),(u=this.Parent.ScreenObject.GridData[o]).ProductID_Key=a.FeatureID,r.e.IsEmpty(a.ToolTipTitle)?this.Parent.AddProductData(u,!1,!0,!1,null,""):(this.Parent.ScreenObject.Preferences.ContainsKey("OnScan")&&""!=this.Parent.ScreenObject.Preferences.OnScan.toLowerCase()?this.Parent.GetProductByExternFunc(a.ToolTipFooterTitle,u,o):this.Parent.ScreenObject.Preferences.ContainsKey("PickStockRate")&&"true"==this.Parent.ScreenObject.Preferences.PickStockRate.toLowerCase()?this.Parent.GetProductByStockCode(a.ToolTipFooterTitle,u,o):this.Parent.AddProductData(u,!1,!0,!1,null,a.ToolTipFooterTitle),null!=(d=this.Parent.ScreenObject.ColumnSource.find((function(e){return e.CostCenterID.toString()==i.a.SessionManager.Preferences.POSItemCodeDimension})))&&this.Parent.ScreenObject.GridDataObj.Columns.Contains(d.DisplayMember)&&(u[d.DisplayMember]=a.ToolTipFooterTitle,u[d.ValueMember]=a.ToolTipTitle)),""!=u.ProductID_Key.toString()&&(null!=(D=this.Parent.ScreenObject.ColumnSource.find((function(e){return!r.e.IsEmpty(e.ValueMember)&&"productid_key"==e.ValueMember.toLowerCase()&&!r.e.IsEmpty(e.Shortcut)&&"lostfocus"==e.Shortcut.toLowerCase()})))&&this.Parent.ValidateData(D,!0)&&this.Parent.ScreenObject.GetExternalFuncData(D.Mode,D.SPName,D.IPParams,D.OPParams,u),this.Parent.PoleDisplayMessage(2,u)),null!=this.Parent.NumericPADView&&null!=this.Parent.NumericPADView.txt&&""!=this.Parent.NumericPADView.txt.Text&&"0"!=this.Parent.NumericPADView.txt.Text&&(r.e.hasprop(u,"Quantity")&&("0"==this.Parent.IsSales?(u.Quantity=-r.e.DoubleTryParse(this.Parent.NumericPADView.txt.Text),this.Parent.RowForegroundChange(u)):u.Quantity=r.e.DoubleTryParse(this.Parent.NumericPADView.txt.Text)),this.Parent.NumericPADView.txt.Text="0",this.Parent.NumericPADView.DisplayMember=""),r.e.IsEmpty(u.Quantity)&&("0"==this.Parent.IsSales?(u.Quantity=-1,this.Parent.RowForegroundChange(u)):u.Quantity=1),this.Parent.CalculateTotals(u,!1),h=!1,h=this.Parent.ScreenObject.Preferences.EnableSchemes,this.Parent.ScreenObject.Preferences.ContainsKey("EnableSchemes")&&this.Parent.ScreenObject.Preferences.EnableSchemes&&(h=Object(s.j)(this.Parent.ScreenObject.Preferences.EnableSchemes)),h&&("GROSS",this.Parent.ScreenObject.Preferences.ContainsKey("SchemesNumericFields")&&""!=this.Parent.ScreenObject.Preferences.SchemesNumericFields&&"0"!=this.Parent.ScreenObject.Preferences.SchemesNumericFields&&null!=(S=this.Parent.ScreenObject.ColumnSource.find((function(e){return e.ID==g.Parent.ScreenObject.Preferences.SchemesNumericFields})))&&""!=S.DisplayMember&&S.DisplayMember,""!=u.ProductID_Key.toString()&&parseInt(u.ProductID_Key.toString())>0&&(m=this.Parent.ScreenObject.GetSchemes(this.Parent.DocumentDate,u)).Tables.Count>0&&m.Tables[0].Columns.Contains("SchemeID")&&this.Parent.fillSchemevalues(this.Parent.DtTempSchemes,m.Tables[0],u),this.Parent.ApplySchemes(u)),this.Parent.Celleditend(u,"Quantity",0),null!=this.Parent.NumericPADView&&(this.Parent.NumericPADView.txt.Text="0",this.Parent.NumericPADView.DisplayMember="")):((b=this.Groups.find((function(e){return e.CCID==a.DBColumnID}))).SelectedValue=a.FeatureID,b.Text=a.Label,C=this.Groups.indexOf(b),a.DBColumnID<0&&(this.Groups[C+1].Label=a.Label,this.Groups[C+1].FeatureID=a.FeatureID),this.Groups.length>C+1&&this.FillButtons(this.Groups[C+1])),t.next=10;break;case 9:if(e instanceof c.b)for(this.FillButtons(e),y=!0,p=0;p<this.Groups.length;p++)this.Groups[p].Visible=y,this.Groups[p]==e&&(y=!1);case 10:case"end":return t.stop()}}),t,this)})))}},{key:"Refresh",value:function(){if(this.Groups.length>0){this.FillButtons(this.Groups[0]);for(var e=1;e<this.Groups.length;e++)this.Groups[e].Visible=!1}}},{key:"IsNewPOS",get:function(){return null!=this.Parent&&"POSDocumentViewModel"==this.Parent.ClassName}},{key:"SearchText",get:function(){return this._SearchText},set:function(e){e!=this._SearchText&&(this._SearchText=e,this.Search())}}]),u}(u.b)},"9UOb":function(e,t,n){"use strict";n.r(t),n.d(t,"PostVoucherSaveViewModel",(function(){return S}));var a=n("mrSG"),i=n("Do2H"),r=n("Lp6j"),s=n("eQJW"),o=n("ScVY"),c=n("keYA"),l=n("EQd/"),u=n("JIg3"),d=n("n56n"),D=n("/GLD"),h=n("4HhE"),S=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,a,o,S,m,b,C,y){var p;if(_classCallCheck(this,n),(p=t.call(this)).ExpanderVisibility=!1,p.Denom=null,p.PDCS=null,p.ChequeNo=new l.d(0),p.Shift=new l.d(0),p.DocDate=new l.d(0),p.ChequeDate=new u.c(0),p.Amount=new l.d(0),p.Narration=new l.d(0),p.PaymentMode=new d.b(0),p.Account=new d.b(0),p.NumericPADView=null,p.PdcVisible=!1,p.TouchVisibility=!1,p.VoucherAmt=0,p.ExhgRate=0,p.PDC=0,p.DocumentType=0,p.CostCenterID=0,p.AccountID=0,p.CurrID=0,p.IsBillwise=!1,p.IsOpening=!1,p.Tempretval=0,p.PaymentMode.CCID=2,p.PaymentMode.TypeID=15,p.Account.CCID=2,p.Account.TypeID=2,e.ScreenObject.Preferences.ContainsKey("PostPdcDoc")&&r.e.Int(e.ScreenObject.Preferences.PostPdcDoc)>4e4?(p.CostCenterID=r.e.Int(e.ScreenObject.Preferences.PostPdcDoc),p.PdcVisible=!0,p.PDCS=new c.a(e),p.PDCS.ButtonVisibility=!1):p.PdcVisible=!1,p.CurrID=m,p.CostCenterID=a,p.ExhgRate=b,p.IsBillwise=C,p.VoucherAmt=o,p.IsOpening=y,p.AccountID=S,p.Amount.DataType="FLOAT",p.oparent=e,p.Amount.Mandatory=!0,p.Amount.Text=p.PdcVisible&&p.PDCS.PDCAmount>0?(o-p.PDCS.PDCAmount).toString():o.toString(),p.PaymentMode.Mandatory=!0,p.Amount.Label=i.a.GetResource("DocumentDesigner_Amount"),p.IsOpening){if(p.DocDate.Visible=!0,p.DocDate.Label="Date",p.DocDate.Text=e.DocumentDate.ToString(i.a.SessionManager.Preferences["Date Format"]),r.e.IsEmpty(i.a.SessionManager.Preferences.PosShifts)||"0"==i.a.SessionManager.Preferences.PosShifts?p.Shift.Visible=!1:(p.Shift.Visible=!0,p.Shift.Label="Shift",p.Shift.Text=e.ScreenObject.GetDocNumberString("Name",parseInt(i.a.SessionManager.Preferences.PosShifts),e.ScreenObject.ShiftNodeID)),p.oparent.ScreenObject.Preferences.ContainsKey("GetOpCash")&&"True"==p.oparent.ScreenObject.Preferences.GetOpCash){p.Amount.IsReadOnly=!0;for(var g=null,f=0;f<p.oparent.Shortcuts.length;f++)if(p.oparent.Shortcuts[f]instanceof h.c&&17==p.oparent.Shortcuts[f].Mode){g=p.oparent.ScreenObject.GetExtData(p.oparent.Shortcuts[f].ToolTipFooterDescription,null,p.oparent.Shortcuts[f].ToolTipFooterTitle);break}p.Amount.Text=null!=g&&g.Tables.length>0&&g.Tables[0].length>0&&!r.e.IsEmpty(g.Tables[0][0][g.Columns[0][0]])?g.Tables[0][0][g.Columns[0][0]].toString():p.oparent.ScreenObject.getPrevCash(p.oparent.DocumentDate)}}else p.DocDate.Visible=!1,p.Shift.Visible=!1;p.oparent.FooterTouchVisible&&(p.TouchVisibility=p.oparent.FooterTouchVisible),p.ChequeDate.Visible=p.ChequeNo.Visible=p.Narration.Visible=!1,p.VoucherAmt>0?(p.Account.Visible=!1,e.ScreenObject.Preferences.ContainsKey("ChequeNODate")&&"true"==e.ScreenObject.Preferences.ChequeNODate.toLowerCase()&&(p.ChequeDate.Visible=p.ChequeNo.Visible=!0)):(e.ScreenObject.Preferences.ContainsKey("MandatoryDenom")&&Object(s.j)(e.ScreenObject.Preferences.MandatoryDenom)&&(p.Amount.Enable=!1),p.ExpanderVisibility=!(e.ScreenObject.Preferences.ContainsKey("ShowDenom")&&!Object(s.j)(e.ScreenObject.Preferences.ShowDenom)&&e.ScreenObject.Preferences.ContainsKey("MandatoryDenom")&&!Object(s.j)(e.ScreenObject.Preferences.MandatoryDenom)),p.Denom=new D.AddDenominationViewModel(_assertThisInitialized(p))),p.Account.Label="Account";var O=e.ScreenObject.GetScreenInfo(a);if(null!=O&&O.Tables.length>3&&O.Tables[3].length>0){p.DocumentType=parseInt(O.Tables[3][0].DocumentType),p.DocName=O.Tables[3][0].DocumentName.toString(),p.Title=p.DocName;var I=null,T=null;if(14==p.DocumentType||15==p.DocumentType||23==p.DocumentType?I=O.Tables[0].filter((function(e){return"CreditAccount"==e.SysColumnName})):18!=p.DocumentType&&19!=p.DocumentType&&22!=p.DocumentType||(I=O.Tables[0].filter((function(e){return"DebitAccount"==e.SysColumnName}))),null!=I&&I.length>0&&(p.PaymentMode.Label=I[0].ResourceData.toString(),p.PaymentMode.TypeID=parseInt(I[0].ColumnCCListViewTypeID),0==p.VoucherAmt&&(r.e.IsEmpty(I[0].IsVisible)||(p.PaymentMode.Visible=Object(s.j)(I[0].IsVisible)),r.e.IsEmpty(I[0].IsEditable)||(p.PaymentMode.IsReadOnly=!Object(s.j)(I[0].IsEditable))),0==p.oparent.ScreenObject.PostVoucherDocID||0==p.VoucherAmt)&&(T=O.Tables[0].filter((function(e){return"Amount"==e.SysColumnName})),14==p.DocumentType||15==p.DocumentType||23==p.DocumentType?r.e.Int(T[0].CrRefColID)>0&&(P=p.oparent.ScreenObject._CCFields.find((function(e){return e.DBColumnName.toLowerCase()==T[0].CRSysColumnName.toString().toLowerCase()})))instanceof d.b&&P.SelectedValue>0&&(p.PaymentMode.SelectedValue=p.oparent.ScreenObject.GetAccountByRef(parseInt(T[0].CrRefID),parseInt(T[0].CrRefColID),P.SelectedValue)):18!=p.DocumentType&&19!=p.DocumentType&&22!=p.DocumentType||r.e.Int(T[0].DrRefColID)>0&&(P=p.oparent.ScreenObject._CCFields.find((function(e){return e.DBColumnName.toLowerCase()==T[0].DRSysColumnName.toString().toLowerCase()})))instanceof d.b&&P.SelectedValue>0&&(p.PaymentMode.SelectedValue=p.oparent.ScreenObject.GetAccountByRef(parseInt(T[0].DrRefID),parseInt(T[0].DrRefColID),P.SelectedValue)),0!=p.PaymentMode.SelectedValue||r.e.IsEmpty(I[0].UserDefaultValue)||(p.PaymentMode.SelectedValue=parseInt(I[0].UserDefaultValue))),null!=(I=O.Tables[0].filter((function(e){return"CommonNarration"==e.SysColumnName})))&&I.length>0&&(p.Narration.Label=I[0].ResourceData.toString(),r.e.IsEmpty(I[0].IsVisible)||(p.Narration.Visible=Object(s.j)(I[0].IsVisible)),"1"==r.e.String(I[0].IsMandatory)&&(p.Narration.Mandatory=!0),r.e.IsEmpty(I[0].IsEditable)||(p.Narration.IsReadOnly=!Object(s.j)(I[0].IsEditable))),p.ChequeNo.Visible&&(null!=(I=O.Tables[0].filter((function(e){return"ChequeNumber"==e.SysColumnName})))&&I.length>0&&(p.ChequeNo.Label=I[0].ResourceData.toString(),r.e.IsEmpty(I[0].IsVisible)||(p.ChequeNo.Visible=Object(s.j)(I[0].IsVisible)),"1"==r.e.String(I[0].IsMandatory)&&(p.ChequeNo.Mandatory=!0),r.e.IsEmpty(I[0].IsEditable)||(p.ChequeNo.IsReadOnly=!Object(s.j)(I[0].IsEditable)))),p.ChequeDate.Visible&&(null!=(I=O.Tables[0].filter((function(e){return"ChequeDate"==e.SysColumnName})))&&I.length>0&&(p.ChequeDate.Label=I[0].ResourceData.toString(),r.e.IsEmpty(I[0].IsVisible)||(p.ChequeDate.Visible=Object(s.j)(I[0].IsVisible)),"1"==r.e.String(I[0].IsMandatory)&&(p.ChequeDate.Mandatory=!0),r.e.IsEmpty(I[0].IsEditable)||(p.ChequeDate.IsReadOnly=!Object(s.j)(I[0].IsEditable))),p.ChequeNo.Visible||p.ChequeDate.Visible)){var j=e.ScreenObject.GetChequeDetails();null!=j&&j.Tables.length>0&&j.Tables[0].length>0?(p.ChequeDate.Date=r.e.IsEmpty(j.Tables[0][0].CD)?null:new Date(j.Tables[0][0].CD),p.ChequeNo.Text=j.Tables[0][0].ChequeNumber.toString()):p.ChequeDate.Date=null}if(0==p.VoucherAmt&&(14==p.DocumentType||15==p.DocumentType||23==p.DocumentType?I=O.Tables[0].filter((function(e){return"DebitAccount"==e.SysColumnName})):18!=p.DocumentType&&19!=p.DocumentType&&22!=p.DocumentType||(I=O.Tables[0].filter((function(e){return"CreditAccount"==e.SysColumnName}))),null!=I&&I.length>0&&(p.Account.Label=I[0].ResourceData.toString(),p.Account.TypeID=parseInt(I[0].ColumnCCListViewTypeID),r.e.IsEmpty(I[0].IsVisible)||(p.Account.Visible=Object(s.j)(I[0].IsVisible)),r.e.IsEmpty(I[0].IsEditable)||(p.Account.IsReadOnly=!Object(s.j)(I[0].IsEditable)),0==p.Account.SelectedValue))){if(T=O.Tables[0].filter((function(e){return"Amount"==e.SysColumnName})),18==p.DocumentType||19==p.DocumentType||22==p.DocumentType)r.e.Int(T[0].CrRefColID)>0&&(P=p.oparent.ScreenObject._CCFields.find((function(e){return e.DBColumnName.toLowerCase()==T[0].CRSysColumnName.toString().toLowerCase()})))instanceof d.b&&P.SelectedValue>0&&(p.Account.SelectedValue=p.oparent.ScreenObject.GetAccountByRef(parseInt(T[0].CrRefID),parseInt(T[0].CrRefColID),P.SelectedValue));else if(14==p.DocumentType||15==p.DocumentType||23==p.DocumentType){var P;r.e.Int(T[0].DrRefColID)>0&&(P=p.oparent.ScreenObject._CCFields.find((function(e){return e.DBColumnName.toLowerCase()==T[0].DRSysColumnName.toString().toLowerCase()})))instanceof d.b&&P.SelectedValue>0&&(p.Account.SelectedValue=p.oparent.ScreenObject.GetAccountByRef(parseInt(T[0].DrRefID),parseInt(T[0].DrRefColID),P.SelectedValue))}0!=p.Account.SelectedValue||r.e.IsEmpty(I[0].UserDefaultValue)||(p.Account.SelectedValue=parseInt(I[0].UserDefaultValue))}}return p.VoucherAmt>0&&(14==p.DocumentType||15==p.DocumentType||23==p.DocumentType)&&r.e.IsValidID(p.oparent.ScreenObject.PostVoucherDocID)&&p.oparent.ScreenObject.PostVoucherCreditAccount>0?p.PaymentMode.SelectedValue=p.oparent.ScreenObject.PostVoucherCreditAccount:p.VoucherAmt>0&&(18==p.DocumentType||19==p.DocumentType||22==p.DocumentType)&&r.e.IsValidID(p.oparent.ScreenObject.PostVoucherDocID)&&p.oparent.ScreenObject.PostVoucherDebitAccount>0&&(p.PaymentMode.SelectedValue=p.oparent.ScreenObject.PostVoucherDebitAccount),p.PaymentMode.DefaultValue=p.PaymentMode.SelectedValue.toString(),p.Account.DefaultValue=p.Account.SelectedValue.toString(),Logger.InfoLog("PostVoucherSaveViewModel:: Entering PostVoucherSaveViewModel"),_possibleConstructorReturn(p)}return _createClass(n,[{key:"ValidateChequeDetails",value:function(e){var t=this.oparent.ScreenObject.GetAccBalance(this.PaymentMode.SelectedValue,this.oparent.DocumentDate);if(null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&t.Columns[0].Contains("IsBillwise")&&Object(s.j)(t.Tables[0][0].IsBillwise))return this.DisplayMessage="Can not select billwise account in "+(e?"reciept":"payment")+" Mode",this.MessageVisibility=!0,!1;if((this.ChequeDate.Mandatory||this.ChequeNo.Mandatory)&&null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&t.Columns[0].Contains("AccountTypeID")&&("2"==r.e.String(t.Tables[0][0].AccountTypeID)||"3"==r.e.String(t.Tables[0][0].AccountTypeID))){if(this.ChequeDate.Mandatory&&!this.ChequeDate.Date)return this.DisplayMessage=i.a.GetResource("Select")+" "+this.ChequeDate.Label,this.MessageVisibility=!0,!1;if(this.ChequeNo.Mandatory&&r.e.IsEmpty(this.ChequeNo.Text))return this.DisplayMessage=i.a.GetResource("Enter")+" "+this.ChequeNo.Label,this.MessageVisibility=!0,!1}return!0}},{key:"OnButtonClick",value:function(e){var t=this;if("Cancel"==e){if(this.PdcVisible){if(this.PDCS.PDCAmount+this.oparent.ScreenObject.PostVoucherAmount>this.VoucherAmt)return this.DisplayMessage=14==this.DocumentType||15==this.DocumentType||23==this.DocumentType?"Save reciept as amount is less than reciept made earlier":"Save payment as amount is less than payment made earlier",void(this.MessageVisibility=!0)}else if(this.oparent.ScreenObject.PostVoucherAmount>this.VoucherAmt)return this.DisplayMessage=14==this.DocumentType||15==this.DocumentType||23==this.DocumentType?"Save reciept as amount is less than reciept made earlier":"Save payment as amount is less than payment made earlier",void(this.MessageVisibility=!0);this.IsOpening&&(this.oparent.DialogResult=!1),i.a.page.HideDialog()}else if("LostFocus"==e)this.PdcVisible&&r.e.IsNum(this.Amount.Text)&&(this.PDCS.Amount.Text=(this.VoucherAmt-r.e.Double(this.Amount.Text)).toString());else if("OK"==e||"OKPrint"==e){var n=this.PaymentMode.GetValidationError("SelectedValue");if(""!=n)return this.DisplayMessage=n,void(this.MessageVisibility=!0);if(""!=(n=this.Amount.GetValidationError("Text")))return this.DisplayMessage=n,void(this.MessageVisibility=!0);if(this.PdcVisible){if(parseFloat(this.Amount.Text)+this.PDCS.CalcPDCAmt()>this.VoucherAmt)return this.DisplayMessage=i.a.GetResource("PostVoucherAmtValidation")+this.VoucherAmt.toString(),void(this.MessageVisibility=!0)}else if(this.VoucherAmt>0&&parseFloat(this.Amount.Text)>this.VoucherAmt)return this.DisplayMessage=i.a.GetResource("PostVoucherAmtValidation")+this.VoucherAmt.toString(),void(this.MessageVisibility=!0);if(0==this.VoucherAmt&&(this.Account.Mandatory=!0,""!=(n=this.Account.GetValidationError("SelectedValue"))))return this.DisplayMessage=n,void(this.MessageVisibility=!0);if(0!=parseFloat(this.Amount.Text)){var s="";if(s+="<DocumentXML><Row><Transactions  ",s+=' DocDetailsID="'+this.oparent.ScreenObject.PostVoucherDocDetailsID+'"  DocSeqNo="1" Amount="'+parseFloat(this.Amount.Text)*this.ExhgRate+'" ',s+=' AmtFc="'+parseFloat(this.Amount.Text)+'" ',s+=' CurrencyID="'+this.CurrID+'" ',s+=' ExchangeRate="'+this.ExhgRate+'" ',null!=this.Narration&&null!=this.Narration.Text&&""!=this.Narration.Text&&(s+=' CommonNarration="'+l.d.GetValidXml(this.Narration.Text)+'" '),this.ChequeDate.Visible&&this.ChequeDate.Date&&(s+=' ChequeDate="'+this.ChequeDate.Date.ToString("dd/MMM/yyyy")+'" '),this.ChequeNo.Visible&&!r.e.IsEmpty(this.ChequeNo.Text)&&(s+=' ChequeNumber="'+this.ChequeNo.Text+'" '),14==this.DocumentType||15==this.DocumentType||23==this.DocumentType){if(!this.ValidateChequeDetails(!1))return;s+='CreditAccount="'+this.PaymentMode.SelectedValue+'" ',s+=0==this.VoucherAmt&&this.Account.SelectedValue>0?'DebitAccount="'+this.Account.SelectedValue+'" ':'DebitAccount="'+this.AccountID+'" '}else if(18==this.DocumentType||19==this.DocumentType||22==this.DocumentType){if(!this.ValidateChequeDetails(!0))return;s+='DebitAccount="'+this.PaymentMode.SelectedValue+'" ',s+=0==this.VoucherAmt&&this.Account.SelectedValue>0?'CreditAccount="'+this.Account.SelectedValue+'" ':'CreditAccount="'+this.AccountID+'" '}if(s+="></Transactions> ",0==this.VoucherAmt){var o=this.oparent.ScreenObject.GenerateQueryfromList(this.oparent.ScreenObject._CCFields,!0,{message:""},!1,!1);i.a.SessionManager.RegisterCCID>0&&this.oparent.ScreenObject.RegisterNodeID>0&&!o.toString().Contains("dcCCNID"+(i.a.SessionManager.RegisterCCID-5e4).toString()+"=")&&(o+=" dcCCNID"+(i.a.SessionManager.RegisterCCID-5e4).toString()+"="+this.oparent.ScreenObject.RegisterNodeID.toString()+", "),this.oparent.ScreenObject.ShiftNodeID>0&&i.a.SessionManager.Preferences.ContainsKey("PosShifts")&&""!=i.a.SessionManager.Preferences.PosShifts.toString()&&parseInt(i.a.SessionManager.Preferences.PosShifts)>5e4&&!o.toString().Contains("dcCCNID"+(parseInt(i.a.SessionManager.Preferences.PosShifts)-5e4)+"=")&&(o+=" dcCCNID"+(parseInt(i.a.SessionManager.Preferences.PosShifts)-5e4).toString()+"="+this.oparent.ScreenObject.ShiftNodeID.toString()+", "),s+=' <Numeric /> <Alpha /> <CostCenters  Query="'+o+'"  /> '}else s+=' <Numeric /> <Alpha /> <CostCenters  Query="'+this.oparent.ScreenObject.GenerateQueryfromList(this.oparent.ScreenObject._CCFields,!0,{message:""},!1,!1)+'"  /> ';if(s+="<EXTRAXML> ",this.VoucherAmt>0&&this.IsBillwise&&i.a.SessionManager.Preferences.ContainsKey("On")&&"True"==i.a.SessionManager.Preferences.On&&""!=this.Amount.Text){0==this.ExhgRate&&(this.ExhgRate=1),s+='<BillWise> <Row DocSeqNo="1" AccountID="'+this.AccountID.toString(),14==this.DocumentType||15==this.DocumentType||23==this.DocumentType?s+='" AmountFC="'+parseFloat(this.Amount.Text)+'" AdjAmount="'+parseFloat(this.Amount.Text)*this.ExhgRate+'"':18!=this.DocumentType&&19!=this.DocumentType&&22!=this.DocumentType||(s+='" AmountFC="-'+parseFloat(this.Amount.Text)+'" AdjAmount="-'+parseFloat(this.Amount.Text)*this.ExhgRate+'"'),s+=' AdjCurrID="'+this.CurrID+'" ',s+='AdjExchRT="'+this.ExhgRate+'" ',s+='Narration="" ',s+='IsDocPDC="0" ';var c=this.oparent.GetButton("Advance");null!=c&&c.Visible?s+='IsNewReference="1" ':(s+='IsNewReference="0" ',s+='RefDocNo="'+this.oparent.ScreenObject.VoucherNo+'" ',s+='RefDocSeqNo="1" ',s+='RefDocDate="'+this.oparent.DocumentDate.ToString("dd/MMM/yyyy")+'" ',null!=this.oparent.ScreenObject.DueDate&&this.oparent.ScreenObject.DueDate.Date&&(s+='RefDocDueDate="'+this.oparent.ScreenObject.DueDate.Date.ToString("dd/MMM/yyyy")+'" ')),s+=" ></Row>",null!=c&&c.Visible&&(s+='<NonAccRows RefDocNo="'+this.oparent.ScreenObject.VoucherNo+'" Amount="'+parseFloat(this.Amount.Text)*this.ExhgRate+'" ></NonAccRows>'),s+="</BillWise>"}s+="</EXTRAXML> ",0==this.VoucherAmt&&null!=this.Denom&&(s+="<PosPayModes>"+this.Denom.GetXML()+"</PosPayModes>"),s+=" </Row>",s+="</DocumentXML> ";var u=0,d=300;0!=this.VoucherAmt||this.IsOpening||(d=0);var D='<XML SysInfo="'+i.a.SessionManager.GetSysInfo()+'" GenratePrefix="1" ';null!=this.oparent&&this.oparent.IsPOs&&(D+=' PosSessionID="'+this.oparent.PosSessionID+'"'),D+=' AP="'+i.a.SessionManager.GetAccessPoint()+'"',D+=" />",this.oparent.ScreenObject.SaveAccountingDocument_2(this.CostCenterID,this.oparent.ScreenObject.PostVoucherDocID,this.oparent.ScreenObject.PostVouceherDocPrefix,this.oparent.ScreenObject.PostVoucherDocnumber,s.toString(),this.oparent.DocumentDate,0,d,this.oparent.ScreenObject.DocID,D,this.GetPDCSML()).subscribe((function(n){return Object(a.b)(t,void 0,void 0,regeneratorRuntime.mark((function t(){var a,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.DisplayMessage=n.Message,u=n.RetValue,!i.a.SessionManager.IsValidNode(u)){t.next=8;break}if(this.Tempretval=u,"OKPrint"!=e){t.next=7;break}return a='<XML CostCenterID="'+this.CostCenterID+'" IsInventoryVoucher="0" />',t.next=5,this.oparent.PrintVoucher(!1,this.Tempretval.toString(),!1,a);case 5:s=t.sent,this.DisplayMessage=this.DisplayMessage+"\r\n "+s;case 7:this.VoucherAmt>0||this.IsOpening?i.a.page.HideDialog():(this.Amount.Text="0",this.Account.SelectedValue=r.e.IsEmpty(this.Account.DefaultValue)?0:parseInt(this.Account.DefaultValue),this.PaymentMode.SelectedValue=r.e.IsEmpty(this.PaymentMode.DefaultValue)?0:parseInt(this.PaymentMode.DefaultValue));case 8:case"end":return t.stop()}}),t,this)})))}),(function(e){console.log(e),t.DisplayMessage="Error in save"}))}else if(this.PdcVisible&&this.PDCS.CalcPDCAmt()>0){var h='<XML SysInfo="'+i.a.SessionManager.GetSysInfo()+'" AP="'+i.a.SessionManager.GetAccessPoint()+'"  GenratePrefix="1" />',S=0;this.oparent.ScreenObject.SaveAccountingDocument_2(0,0,"","","",this.oparent.DocumentDate,0,300,this.oparent.ScreenObject.DocID,h,this.GetPDCSML()).subscribe((function(e){t.DisplayMessage=e.Message,(S=e.RetValue)>0&&(t.Tempretval=S,i.a.page.HideDialog())}),(function(e){console.log(e),t.DisplayMessage="Error in save"}))}else if(0==parseFloat(this.Amount.Text)&&r.e.IsValidID(this.oparent.ScreenObject.PostVoucherDocID)){var m,b=this.oparent.ScreenObject.DeleteDocumentByDocID(this.CostCenterID,this.oparent.ScreenObject.PostVoucherDocID,!0);this.DisplayMessage=b.Message,(m=b.RetValue)>0&&i.a.page.HideDialog(),this.Tempretval=m}else 0==parseFloat(this.Amount.Text)&&this.IsOpening&&i.a.page.HideDialog()}}},{key:"GetPDCSML",value:function(){if(!this.PdcVisible)return"";for(var e="",t=0;t<this.PDCS.GrBody.Table.length;t++)r.e.IsEmpty(this.PDCS.GrBody.Table[t].Amount)||(e+=" <PDCRow ",r.e.IsEmpty(this.PDCS.GrBody.Table[t].DocID)||(e+=' DOcid="'+this.PDCS.GrBody.Table[t].DocID.toString()+'" '),r.e.IsEmpty(this.PDCS.GrBody.Table[t].StatusID)||(e+=' StatusID="'+this.PDCS.GrBody.Table[t].StatusID.toString()+'" '),e+=">",e+="<DocumentXML><Row><Transactions  ",e+=' DocDetailsID="0"  DocSeqNo="1" Amount="'+parseFloat(this.PDCS.GrBody.Table[t].Amount)*this.ExhgRate+'" ',e+=' AmtFc="'+parseFloat(this.PDCS.GrBody.Table[t].Amount)+'" ',e+=' CurrencyID="'+this.CurrID+'" ',e+=' ExchangeRate="'+this.ExhgRate+'" ',r.e.IsEmpty(this.PDCS.GrBody.Table[t].ChequeDate_Key)||(e+=' ChequeDate="'+new Date(this.PDCS.GrBody.Table[t].ChequeDate_Key).ToString("dd/MMM/yyyy")+'"  ChequeMaturityDate="'+new Date(this.PDCS.GrBody.Table[t].ChequeDate_Key).ToString("dd/MMM/yyyy")+'" '),r.e.IsEmpty(this.PDCS.GrBody.Table[t].ChequeNumber)||(e+=' ChequeNumber="'+this.PDCS.GrBody.Table[t].ChequeNumber.toString()+'" '),r.e.IsEmpty(this.PDCS.GrBody.Table[t].ChequeBankName)||(e+=' ChequeBankName="'+this.PDCS.GrBody.Table[t].ChequeBankName.toString()+'" '),this.PDCS.GrBody.TableColumns.Contains("CreditAccount_Key")?(e+='CreditAccount="'+this.PDCS.GrBody.Table[t].CreditAccount_Key.toString()+'" ',e+='DebitAccount="'+this.AccountID+'" '):this.PDCS.GrBody.TableColumns.Contains("DebitAccount_Key")&&(e+='DebitAccount="'+this.PDCS.GrBody.Table[t].DebitAccount_Key.toString()+'" ',e+='CreditAccount="'+this.AccountID+'" '),e+="></Transactions> ",e+=' <Numeric /> <Alpha /> <CostCenters  Query="'+this.oparent.ScreenObject.GenerateQueryfromList(this.oparent.ScreenObject._CCFields,!0,{message:""},!1,!1)+'"  /> ',e+="<EXTRAXML> ",this.IsBillwise&&i.a.SessionManager.Preferences.ContainsKey("On")&&"True"==i.a.SessionManager.Preferences.On&&(0==this.ExhgRate&&(this.ExhgRate=1),e+='<BillWise> <Row DocSeqNo="1" AccountID="'+this.AccountID.toString(),this.PDCS.GrBody.TableColumns.Contains("CreditAccount_Key")?e+='" AmountFC="'+parseFloat(this.PDCS.GrBody.Table[t].Amount)+'" AdjAmount="'+parseFloat(this.PDCS.GrBody.Table[t].Amount)*this.ExhgRate+'"':e+='" AmountFC="-'+parseFloat(this.PDCS.GrBody.Table[t].Amount)+'" AdjAmount="-'+parseFloat(this.PDCS.GrBody.Table[t].Amount)*this.ExhgRate+'"',e+=' AdjCurrID="'+this.CurrID+'" ',e+='AdjExchRT="'+this.ExhgRate+'" ',e+='Narration="" ',e+='IsDocPDC="1" ',e+='IsNewReference="0" ',e+='RefDocNo="'+this.oparent.ScreenObject.VoucherNo+'" ',e+='RefDocSeqNo="1" ',e+='RefDocDate="'+this.oparent.DocumentDate.ToString("dd/MMM/yyyy")+'" ',null!=this.oparent.ScreenObject.DueDate&&this.oparent.ScreenObject.DueDate.Date&&(e+='RefDocDueDate="'+this.oparent.ScreenObject.DueDate.Date.ToString("dd/MMM/yyyy")+'" '),e+=" ></Row>",e+="</BillWise>"),e+="</EXTRAXML> ",e+=" </Row>",e+="</DocumentXML> ",e+=" </PDCRow>");return e.length>0&&(e='<PDCXML PDCDocument="'+this.oparent.ScreenObject.Preferences.PostPdcDoc+'">'+e+"</PDCXML> "),e}}]),n}(o.b)},"I/F0":function(e,t,n){"use strict";n.r(t),n.d(t,"POSPayModesViewModel",(function(){return y}));var a=n("mrSG"),i=n("8B8H"),r=n("4HhE"),s=n("ockk"),o=n("ScVY"),c=n("0/4Q"),l=n("n56n"),u=n("EQd/"),d=n("Jnyl"),D=n("JIg3"),h=n("/GLD"),S=n("NkMH"),m=n("Do2H"),b=n("eQJW"),C=n("Lp6j"),y=function(e){_inherits(o,e);var t=_createSuper(o);function o(e){var n;_classCallCheck(this,o),(n=t.call(this)).ButtonClick=new r.b,n.AddDenomClick=new r.b,n.SubDenomClick=new r.b,n.DenomChange=new r.b,n.celleditend=new r.b,n.BeginEdit=new r.b,n.GridDataObj=new i.a,n.ExpiryMonth=new c.e,n.ExpiryYear=new c.e,n.BankName=new l.b,n.CardType=new l.b,n.ExpDate=new D.c,n._SelectedRow=!1,n.DenomButtons=[],n.TouchVisibility=!1,n.PayModes=[],n.Parent=null,n.Returnfld="",n.denominationxml="",n.ReturnDecimalPoints="",n.NOdeid=0,n.BillValue=0,n.points=0,n.AvailablePoints=0,n.RedeemPoints=0,n.IsinTextchanged=!1,n.Title="Pay",Logger.InfoLog("POSPayModesViewModel:: Entering POSPayModesViewModel"),n.Parent=e,n.TouchVisibility=n.Parent.FooterTouchVisible,n.BeginEdit.Subscribe(_assertThisInitialized(n),"OnBeginedit"),n.ButtonClick.Subscribe(_assertThisInitialized(n),"OnButtonClick"),n.celleditend.Subscribe(_assertThisInitialized(n),"oncelleditend"),n.SubDenomClick.Subscribe(_assertThisInitialized(n),"OnSubDenomClick"),n.AddDenomClick.Subscribe(_assertThisInitialized(n),"OnAddDenomClick"),n.DenomChange.Subscribe(_assertThisInitialized(n),"OnDenomChange");for(var a=1;a<13;a++)n.ExpiryMonth.Items.push(c.d.ComboBoxItems_2(n.Parent.ScreenObject.GetMonthName(a,!1),a.toString()));for(var s=2010;s<2050;s++)n.ExpiryYear.Items.push(c.d.ComboBoxItems_1(s.toString()));n.ExpiryMonth.Visible=!1,n.ExpiryYear.Visible=!1,n.ExpDate.Visible=!1,n.CardNo=new u.d,n.CardNo.TextChangedCommand.Subscribe(_assertThisInitialized(n),"OnCardKeyDown"),n.CardNo.Visible=!1,n.VoucherNo=new u.d,n.VoucherNo.Visible=!1,n.VoucherNo.Label="Voucher No.",n.VoucherNo.TextChangedCommand.Subscribe(_assertThisInitialized(n),"OnVoucherNoChanged"),m.a.SessionManager.Preferences.ContainsKey("Posbankname")&&""!=m.a.SessionManager.Preferences.Posbankname&&parseInt(m.a.SessionManager.Preferences.Posbankname)>0?(n.BankName.Enable=!0,n.BankName.CCID=parseInt(m.a.SessionManager.Preferences.Posbankname),n.BankName.TypeID=1):n.BankName.Enable=!1,m.a.SessionManager.Preferences.ContainsKey("PosCardType")&&""!=m.a.SessionManager.Preferences.PosCardType&&parseInt(m.a.SessionManager.Preferences.PosCardType)>0?(n.CardType.Enable=!0,n.CardType.CCID=parseInt(m.a.SessionManager.Preferences.PosCardType),n.CardType.TypeID=1):n.CardType.Enable=!1,n.CardType.Visible=!1,n.BankName.Visible=!1,n.CardType.Label="Card Type",n.BankName.Label="Bank Name",n.Amount=new u.d,n.Amount.DataType="FLOAT",n.Amount.Label=m.a.GetResource("DocumentDesigner_Amount"),n.AvailAmount=new u.d,n.AvailAmount.DataType="FLOAT",n.AvailAmount.Label="Available Amount",n.AvailAmount.IsReadOnly=!0,n.CardName=new u.d,n.CardName.Visible=!1,n.ApprovalCode=new u.d,n.ApprovalCode.Label="Approval Code",n.ApprovalCode.Visible=!1,n.Parent.ScreenObject.Preferences.ContainsKey("CashForeignCurrency")&&Object(b.j)(n.Parent.ScreenObject.Preferences.CashForeignCurrency)&&(n.Currency=new d.b,n.Currency.Label=m.a.GetResource("Reports_Currency"),n.Currency.ExchangeRate.Label="Exchange",n.Currency.Currency.Label="FC Amount",n.Parent.ScreenObject.Data.Tables[14].forEach((function(e){n.Currency.Currency.Items.push(c.d.ComboBoxItems_2(e.Name.toString(),e.CurrencyID.toString()))})),n.Currency.Currency.SelectionChangedCommand.Subscribe(_assertThisInitialized(n),"OnCurrencyChanged","Curr"),n.Currency.ExchangeRate.LostFocusCommand.Subscribe(_assertThisInitialized(n),"OnCurrencyChanged")),n.InitGrid(),n.PayModes=[];var h="";e.ScreenObject.Data.Columns[1].Contains("PaymentModes")&&e.ScreenObject.Data.Tables[1].length>0&&(h=C.e.StringValue(e.ScreenObject.Data.Tables[1][0].PaymentModes));var y=n.Parent.ScreenObject.Data.Tables[0].filter((function(e){return e.SectionID>4}),"SectionID");if(y.length>0)for(var p=0;p<y.length;p++){var g=y[p];if(!g.SysColumnName.toString().toLowerCase().Contains("currid")&&!g.SysColumnName.toString().toLowerCase().Contains("exchrt")&&(""==h||h.split(",").Contains(g.SectionID.toString())))if("12"==g.SectionID.toString())n.ReturnLabel=g.ResourceData.toString(),n.Returnfld=g.SysColumnName.toString(),C.e.hasprop(g,"Decimal")&&""!=g.Decimal.toString()&&parseFloat(g.Decimal.toString())>=0?n.ReturnDecimalPoints=g.Decimal.toString():m.a.SessionManager.Preferences.ContainsKey("DecimalsinExtraFields")&&""!=m.a.SessionManager.Preferences.DecimalsinExtraFields&&(n.ReturnDecimalPoints=m.a.SessionManager.Preferences.DecimalsinExtraFields),""!=n.ReturnDecimalPoints&&(n.Return=0+n.ReturnDecimalPoints);else{var f=new S.a;f.Label=g.ResourceData.toString(),f.DBColumnName=g.SysColumnName.toString(),f.ClickCommand.Subscribe(_assertThisInitialized(n),"onClick_1"),f.Row=n.PayModes.length,f.SectionID=g.SectionID.toString(),f.Mandatory=Object(b.j)(g.IsMandatory),""!=g.IsVisible.toString()&&(f.Visible=Object(b.j)(g.IsVisible)),n.PayModes.push(f),1==n.PayModes.filter((function(e){return e.Visible})).length?n.onClick(f.DBColumnName,!1):f.Enable=!1}}return n.Parent.ScreenObject.Preferences.ContainsKey("ShowDenom")&&Object(b.j)(n.Parent.ScreenObject.Preferences.ShowDenom)&&0==n.DenomButtons.length&&n.AddDenominations("1"),Logger.InfoLog("POSPayModesViewModel:: Entering POSPayModesViewModel"),n}return _createClass(o,[{key:"GridData_RowDeleted",value:function(e,t){var n=0,a="2";this.Parent.ScreenObject.Preferences.ContainsKey("DecimalsNetAmount")&&""!=this.Parent.ScreenObject.Preferences.DecimalsNetAmount&&(a=this.Parent.ScreenObject.Preferences.DecimalsNetAmount);for(var i=0;i<this.GridData.length;i++)C.e.IsEmpty(this.GridData[i].ColumnName)||C.e.IsEmpty(this.GridData[i].Amount)||(n+=parseFloat(this.GridData[i].Amount.toString()));this.Return=""!=this.ReturnDecimalPoints?(0).ToString("N"+this.ReturnDecimalPoints):"0",this.Parent.Bal=parseFloat((this.Parent.GridNetTotal+this.Parent.FooterGridNetTotal-n).ToString("N"+a)),this.Parent.Bal<0&&(this.Parent.Bal=0),this.Amount.Text=parseFloat(this.POSBalanceAmount)>0?this.POSBalanceAmount:"",n>parseFloat((this.Parent.GridNetTotal+this.Parent.FooterGridNetTotal).ToString("N"+a))&&(this.Return=""!=this.ReturnDecimalPoints?(this.Parent.GridNetTotal+this.Parent.FooterGridNetTotal-n).ToString("N"+this.ReturnDecimalPoints).Replace("-",""):(this.Parent.GridNetTotal+this.Parent.FooterGridNetTotal-n).toString().Replace("-",""))}},{key:"OnCurrencyChanged",value:function(e){if(!this.IsinTextchanged){var t,n="2";if(this.Parent.ScreenObject.Preferences.ContainsKey("DecimalsNetAmount")&&""!=this.Parent.ScreenObject.Preferences.DecimalsNetAmount&&(n=this.Parent.ScreenObject.Preferences.DecimalsNetAmount),"exch"==e.toString())this.IsinTextchanged=!0,t=C.e.DoubleTryParse(this.Currency.ExchangeRate.Text),C.e.DoubleTryParse(this.Currency.ExchangeRate.Text)||(t=1),this.Amount.Text=(parseFloat(this.FcAmt)*t).ToString("N"+n),this.IsinTextchanged=!1;else if("Curr"==e.toString()){if(null==this.Parent.ScreenObject||null!=this.lastCurr&&null!=this.Currency.Currency.SelectedValue&&this.Currency.Currency.SelectedValue==this.lastCurr)return;var a;this.IsinTextchanged=!0,this.lastCurr=this.Currency.Currency.SelectedValue,this.Currency.ExchangeRate.Text=null!=this.Currency.Currency.SelectedValue&&""!=this.Currency.Currency.SelectedValue?this.Parent.ScreenObject.GetExchangeRate(parseInt(this.Currency.Currency.SelectedValue),this.Parent.DocumentDate).toString():"1",a=C.e.DoubleTryParse(this.Currency.ExchangeRate.Text),C.e.DoubleTryParse(this.Amount.Text)&&(C.e.DoubleTryParse(this.Currency.ExchangeRate.Text)||(a=1),this.FcAmt=(parseFloat(this.Amount.Text)/a).ToString("N"+n)),this.Parent.ScreenObject.Preferences.ContainsKey("ShowDenom")&&Object(b.j)(this.Parent.ScreenObject.Preferences.ShowDenom)&&this.AddDenominations(this.Currency.Currency.SelectedValue),this.IsinTextchanged=!1}else if("FCAmount"==e.toString()){var i;this.IsinTextchanged=!0,i=C.e.DoubleTryParse(this.Currency.ExchangeRate.Text),C.e.DoubleTryParse(this.Currency.ExchangeRate.Text)||(i=1),this.Amount.Text=(parseFloat(this.FcAmt)*i).ToString("N"+n),this.IsinTextchanged=!1}else if("AmtChanged"==e.toString()){var r;this.IsinTextchanged=!0,r=C.e.DoubleTryParse(this.Currency.ExchangeRate.Text),C.e.DoubleTryParse(this.Amount.Text)&&(C.e.DoubleTryParse(this.Currency.ExchangeRate.Text)||(r=1),this.FcAmt=(parseFloat(this.Amount.Text)/r).ToString("N"+n)),this.IsinTextchanged=!1}}}},{key:"OnDenomChange",value:function(e){var t=e;null!=t&&(C.e.IntTryParse(t.Length),C.e.IntTryParse(t.Length)||(t.Length="0"),this.GetTotal())}},{key:"OnAddDenomClick",value:function(e){var t,n=e;null!=n&&(C.e.IntTryParse(n.Length)||0==C.e.IntTryParse(n.Length)?(t=C.e.IntTryParse(n.Length),n.Length=(t+1).toString()):n.Length="0",this.GetTotal())}},{key:"GetDenominationXML",value:function(){for(var e="",t=0;t<this.DenomButtons.length;t++){var n=void 0,a=void 0;C.e.DoubleTryParse(this.DenomButtons[t].Label)&&C.e.DoubleTryParse(this.DenomButtons[t].Length)&&n>0&&a>0&&(a=C.e.DoubleTryParse(this.DenomButtons[t].Label),n=C.e.DoubleTryParse(this.DenomButtons[t].Length),e+='<XML IsDenom="1" ',e+=this.IsCashFC?' CurrencyID="'+this.Currency.Currency.SelectedValue+'"':' CurrencyID="1"',e+=' Notes="'+this.DenomButtons[t].Label+'"  NotesTender="',e+=this.DenomButtons[t].Length+'"  Change="0" ChangeTender="0" />')}return e.toString()}},{key:"AddDenominations",value:function(e){this.DenomButtons.Clear();for(var t=this.Parent.ScreenObject.GetDenominations(e),n=0;n<t.Tables[0].length;n++){var a=new S.a;a.Label=t.Tables[0][n].Notes.toString(),a.Length="0",a.ToolTipFooterDescription=C.e.GetPath(t.Tables[0][n].GUID.toString()+"."+t.Tables[0][n].FileExtension.toString()),a.Width="165",a.DBColumnID=14+n,a.SectionID="114",this.DenomButtons.push(a)}}},{key:"GetTotal",value:function(){for(var e=0,t=0;t<this.DenomButtons.length;t++){var n=void 0;C.e.DoubleTryParse(this.DenomButtons[t].Label)&&C.e.DoubleTryParse(this.DenomButtons[t].Length)&&(n=C.e.DoubleTryParse(this.DenomButtons[t].Label),e+=C.e.DoubleTryParse(this.DenomButtons[t].Length)*n)}var a="2";this.Parent.ScreenObject.Preferences.ContainsKey("DecimalsNetAmount")&&""!=this.Parent.ScreenObject.Preferences.DecimalsNetAmount&&(a=this.Parent.ScreenObject.Preferences.DecimalsNetAmount),this.IsCashFC?this.FcAmt=e.ToString("N"+a):this.Amount.Text=e.ToString("N"+a)}},{key:"OnSubDenomClick",value:function(e){var t,n=e;null!=n&&(C.e.IntTryParse(n.Length)||0==C.e.IntTryParse(n.Length)?(t=C.e.IntTryParse(n.Length),n.Length=t-1<0?"0":(t-1).toString()):n.Length="0",this.GetTotal())}},{key:"onClick_1",value:function(e){this.onClick(e.toString(),!1)}},{key:"onClick",value:function(e,t){var n=this;if(this.Selectedbtn=this.PayModes.find((function(t){return t.DBColumnName==e})),t||null==this.SelectedRow||(this.SelectedRow=null),this.Amount.Text=parseFloat(this.POSBalanceAmount)>0?this.POSBalanceAmount:"",this.CardName.Text="",this.ExpDate.Date=null,this.CardNo.Text="",this.denominationxml="",this.NOdeid=0,null!=this.Denom&&this.Denom.GrdDenomination.Table.Clear(),this.ApprovalCode.Text="",this.ExpiryYear.SelectedValue="",this.ExpiryMonth.SelectedValue="",this.AvailAmount.Text="",this.AvailAmount.Visible=!1,this.VoucherNo.Visible=!1,this.BankName.Visible=!1,this.CardType.Visible=!1,this.Amount.Enable=!0,this.IsCash=!1,this.IsCashFC=!1,null!=this.Selectedbtn)switch(this.PayModes.forEach((function(e){e.Enable=e==n.Selectedbtn})),this.Selectedbtn.SectionID){case"8":case"5":case"11":this.ExpDate.Visible=!1,this.CardNo.Visible=!1,this.CardName.Visible=!1,this.ApprovalCode.Visible=!1,"5"==this.Selectedbtn.SectionID?(this.Parent.ScreenObject.Preferences.ContainsKey("ShowDenom")&&Object(b.j)(this.Parent.ScreenObject.Preferences.ShowDenom)&&(this.IsCash=!0,this.Parent.ScreenObject.Preferences.ContainsKey("MandatoryDenom")&&Object(b.j)(this.Parent.ScreenObject.Preferences.MandatoryDenom)&&(this.Amount.Enable=!1)),this.Parent.ScreenObject.Preferences.ContainsKey("CashForeignCurrency")&&Object(b.j)(this.Parent.ScreenObject.Preferences.CashForeignCurrency)&&(this.IsCashFC=!0),t||this.IsCashFC&&(this.IsinTextchanged=!0,this.Currency.Currency.SelectedValue="1",this.lastCurr!=this.Currency.Currency.SelectedValue&&this.AddDenominations(this.Currency.Currency.SelectedValue),this.lastCurr=this.Currency.Currency.SelectedValue,this.Currency.ExchangeRate.Text="1",this.FcAmt=this.Amount.Text,this.IsinTextchanged=!1)):"8"!=this.Selectedbtn.SectionID||t||(this.Denom=new h.AddDenominationViewModel(this)),this.ExpiryMonth.Visible=!1,this.ExpiryYear.Visible=!1;break;case"6":this.ExpDate.Visible=!1,this.ExpiryMonth.Visible=!0,this.ExpiryYear.Visible=!0,this.CardNo.Visible=!0,this.CardName.Visible=!0,this.ApprovalCode.Visible=!0,this.ExpDate.Label="Expiry",this.ExpiryMonth.Label="Expiry",this.CardNo.Label="Card No.",this.CardName.Label="Card Holder Name",this.BankName.Enable&&(this.BankName.Visible=!0),this.CardType.Enable&&(this.CardType.Visible=!0);break;case"7":this.ExpDate.Visible=!0,this.ExpiryMonth.Visible=!1,this.ExpiryYear.Visible=!1,this.ApprovalCode.Visible=!1,this.CardNo.Visible=!0,this.CardName.Visible=!0,this.ExpDate.Label="Cheque Date",this.CardNo.Label="Cheque No.",this.CardName.Label="Cheque Bank Name";break;case"9":this.ExpDate.Visible=!1,38==this.Parent.ScreenObject.DocumentType?(this.VoucherNo.Visible=!0,this.AvailAmount.Visible=!0,this.AvailAmount.Label="Available Amount"):(this.VoucherNo.Visible=!1,this.AvailAmount.Visible=!1),this.CardNo.Visible=!1,this.CardName.Visible=!1,this.ApprovalCode.Visible=!1,this.ExpiryMonth.Visible=!1,this.ExpiryYear.Visible=!1;break;case"10":this.ExpDate.Visible=!1,this.CardNo.Visible=!0,this.CardName.Visible=!1,this.ApprovalCode.Visible=!1,this.ExpiryMonth.Visible=!1,this.ExpiryYear.Visible=!1,this.CardNo.Label="Card No.";break;case"13":this.ExpDate.Visible=!1,this.AvailAmount.Visible=!0,this.AvailAmount.Label="Available Points",this.AvailAmount.Text=this.AvailablePoints.toString(),this.VoucherNo.Visible=!1,this.CardNo.Visible=!1,this.CardName.Visible=!1,this.ApprovalCode.Visible=!1,this.ExpiryMonth.Visible=!1,this.ExpiryYear.Visible=!1}}},{key:"clear",value:function(){this.Amount.Text="",this.CardName.Text="",this.ExpDate.Date=null,this.CardNo.Text="",this.VoucherNo.Text="",this.ApprovalCode.Text="",this.denominationxml="",this.BankName.Enable&&(this.BankName.SelectedValue=0),this.CardType.Enable&&(this.CardType.SelectedValue=0),this.Return=""!=this.ReturnDecimalPoints?(0).ToString("N"+this.ReturnDecimalPoints):"0",this.NOdeid=0,null!=this.Denom&&this.Denom.GrdDenomination.Table.Clear(),this.ExpiryYear.SelectedValue="",this.ExpiryMonth.SelectedValue="",this.GridData.Clear();for(var e=0;e<5;e++)this.GridData.push({})}},{key:"InitGrid",value:function(){this.GridDataObj=new i.a,this.GridDataObj.Table=[],this.GridDataObj.CanUserDeleteRows=!0,this.GridDataObj.RowDeleted.Subscribe(this,"GridData_RowDeleted"),this.GridDataObj.TableColumns.push("Name"),this.GridDataObj.TableColumns.push("ColumnName"),this.GridDataObj.TableColumns.push("Amount"),this.GridDataObj.DataTypes.Double.push("Amount"),this.GridDataObj.TableColumns.push("Description"),this.GridDataObj.TableColumns.push("Details"),this.GridDataObj.TableColumns.push("Denomination"),this.GridDataObj.TableColumns.push("Type"),this.ColumnSource=[];var e=new s.a;e.Header="Mode",e.DisplayMember="Name",e.Width=150,e.ReadOnly=!0,this.ColumnSource.push(e),(e=new s.a).Header="Amount",e.DisplayMember="Amount",e.DataType="FLOAT",e.Width=120,e.ReadOnly=!0,this.ColumnSource.push(e),(e=new s.a).Header="Description",e.DisplayMember="Description",e.Width=450,e.ReadOnly=!0,this.ColumnSource.push(e),this.GridDataObj.Columns=this.ColumnSource,this.clear(),this.Width="760"}},{key:"OnBeginedit",value:function(e){return Object(a.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var a,i,r,s,o,c,l,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([n.e(13),n.e(15),n.e(160)]).then(n.bind(null,"Z9XZ"));case 2:return a=t.sent,i=a.ShowJVViewModel,t.next=6,Promise.resolve().then(n.bind(null,"HNy5"));case 6:r=t.sent,s=r.ShowJVComponent,c=e.args.item,l=e.args.column.DgCol,u=C.e.IsEmpty(l.ValueBinding)?l.DisplayMember:l.ValueBinding,"PactTextBoxEditor"==e.args.column.className&&"Description"==u&&"1"==c.Type.toString()&&(o=new i),o.ShowJVViewModel_1(this.Parent,e.Row.Item.Row.ColumnName.toString(),2),m.a.page.ShowDialog(o,s,{ShowCenter:!0}),e.Cancel=!0;case 10:case"end":return t.stop()}}),t,this)})))}},{key:"oncelleditend",value:function(e){var t;t=e.column.field,"DataGridComboBoxColumn"!=e.column.className&&("Amount"!=t&&"CalcAmount"!=t||this.calculate())}},{key:"calculate",value:function(){this.GridDataObj.refreshDataView()}},{key:"exists",value:function(e){for(var t=0;t<this.GridData.length;t++)if(this.GridData[t].Name.toString()==e)return t;return-1}},{key:"OnButtonClick",value:function(e){var t=this;if(null!=e&&"Cancel"==e.toString());else if(null!=e&&"AmtChanged"==e.toString())this.IsCashFC&&this.OnCurrencyChanged(e);else if(null!=e&&"Denomination"==e.toString())this.Denom=new h.AddDenominationViewModel(this);else if(null!=e&&"OK"==e.toString()){if(null!=this.Selectedbtn&&!C.e.IsEmpty(this.Amount.Text)){if(this.DisplayMessage="",this.DisplayMessage=this.Amount.ValidateData(),""!=this.DisplayMessage)return void(this.MessageVisibility=!0);if(this.Selectedbtn.Mandatory){if(this.CardNo.Visible&&""==this.CardNo.Text)return this.DisplayMessage=this.CardNo.Label+" is Mandatory",void(this.MessageVisibility=!0);if(this.CardName.Visible&&""==this.CardName.Text)return this.DisplayMessage=this.CardName.Label+" is Mandatory",void(this.MessageVisibility=!0);if(this.ExpDate.Visible&&!this.ExpDate.Date)return this.DisplayMessage=this.ExpDate.Label+" is Mandatory",void(this.MessageVisibility=!0);if(this.ExpiryMonth.Visible&&C.e.IsEmpty(this.ExpiryMonth.SelectedValue))return this.DisplayMessage=this.ExpiryMonth.Label+" Month is Mandatory",void(this.MessageVisibility=!0);if(this.ExpiryYear.Visible&&C.e.IsEmpty(this.ExpiryYear.SelectedValue))return this.DisplayMessage=this.ExpiryMonth.Label+" Year is Mandatory",void(this.MessageVisibility=!0);if(this.ApprovalCode.Visible&&""==this.ApprovalCode.Text)return this.DisplayMessage=this.ApprovalCode.Label+" is Mandatory",void(this.MessageVisibility=!0)}if("9"==this.Selectedbtn.SectionID&&38==this.Parent.ScreenObject.DocumentType){if(!(this.NOdeid>0))return this.DisplayMessage="Enter Valid Voucher No",void(this.MessageVisibility=!0);if(!C.e.DoubleTryParse(this.AvailAmount.Text)||parseFloat(this.Amount.Text)>parseFloat(this.AvailAmount.Text))return this.DisplayMessage="Amount should be less than available",void(this.MessageVisibility=!0)}var n=0,a=null;if(null!=this.SelectedRow&&"1"!=this.SelectedRow.Type.toString()?""!=this.Amount.Text&&C.e.DoubleTryParse(this.Amount.Text)&&0==parseFloat(this.Amount.Text)?this.GridData.Remove(this.SelectedRow):a=this.SelectedRow:a=this.GridData[this.Parent.GetEmptyRowPosition(this.GridDataObj,"ColumnName")],"13"==this.Selectedbtn.SectionID&&38==this.Parent.ScreenObject.DocumentType){if(!C.e.DoubleTryParse(this.AvailAmount.Text)||parseFloat(this.Amount.Text)>parseFloat(this.AvailAmount.Text))return this.DisplayMessage="Amount should be less than available points",void(this.MessageVisibility=!0);for(var i=0;i<this.GridData.length;i++)if(this.GridData[i]!=a&&this.GridData[i].Type.toString()==this.Selectedbtn.SectionID)return this.DisplayMessage="Edit row no."+(i+1).toString()+" to redeem points.",void(this.MessageVisibility=!0)}n=0;for(var r=0;r<this.GridData.length;r++)this.GridData[r]==a||C.e.IsEmpty(this.GridData[r].ColumnName)||C.e.IsEmpty(this.GridData[r].Amount)||(n+=parseFloat(this.GridData[r].Amount.toString()));var s="2";if(this.Parent.ScreenObject.Preferences.ContainsKey("DecimalsNetAmount")&&""!=this.Parent.ScreenObject.Preferences.DecimalsNetAmount&&(s=this.Parent.ScreenObject.Preferences.DecimalsNetAmount),parseFloat((n+parseFloat(this.Amount.Text)).ToString("N"+s))>parseFloat((this.Parent.GridNetTotal+this.Parent.FooterGridNetTotal).ToString("N"+s))){if("5"!=this.Selectedbtn.SectionID||38!=this.Parent.ScreenObject.DocumentType)return this.DisplayMessage="Can not pay more than balance",void(this.MessageVisibility=!0);for(var o=0;o<this.GridData.length;o++)if(this.GridData[o]!=a&&this.GridData[o].Type.toString()==this.Selectedbtn.SectionID)return this.DisplayMessage="Edit row no."+(o+1).toString()+" to pay cash.",void(this.MessageVisibility=!0);if(""==this.Returnfld)return this.DisplayMessage="Define Cash Return Field to pay more than balance",void(this.MessageVisibility=!0);this.Return=""!=this.ReturnDecimalPoints?(this.Parent.GridNetTotal+this.Parent.FooterGridNetTotal-n-parseFloat(this.Amount.Text)).ToString("N"+this.ReturnDecimalPoints).Replace("-",""):(this.Parent.GridNetTotal+this.Parent.FooterGridNetTotal-n-parseFloat(this.Amount.Text)).toString().Replace("-","")}else"5"==this.Selectedbtn.SectionID&&38==this.Parent.ScreenObject.DocumentType&&C.e.DoubleTryParse(this.Return)&&parseFloat(this.Return)>0&&(this.Return=""!=this.ReturnDecimalPoints?(0).ToString("N"+this.ReturnDecimalPoints):"0");if(this.Parent.Bal=parseFloat((this.Parent.GridNetTotal+this.Parent.FooterGridNetTotal-n-parseFloat(this.Amount.Text)).ToString("N"+s)),this.Parent.Bal<0&&(this.Parent.Bal=0),null!=a){a.Name=this.Selectedbtn.Label,a.Amount=this.Amount.Text,a.ColumnName=this.Selectedbtn.DBColumnName,a.Type=this.Selectedbtn.SectionID;var c="";if(c+='<XML Amount="'+this.Amount.Text.Replace(",","")+'" ',c+=' DBColumnName="'+this.Selectedbtn.DBColumnName+'" ',c+=' RegisterID="'+this.Parent.ScreenObject.RegisterNodeID+'" ',c+=' ShiftID="'+this.Parent.ScreenObject.ShiftNodeID+'" ',c+=' DocDate="'+this.Parent.DocumentDate.ToString("dd/MMM/yyyy")+'" ',c+=' Type="'+this.Selectedbtn.SectionID+'" ',this.IsCashFC&&!C.e.IsEmpty(this.Currency.Currency.SelectedValue)&&(c+=' Currency="'+this.Currency.Currency.SelectedValue+'" ',c+=' ExchangeRate="'+this.Currency.ExchangeRate.Text+'" ',c+=' FCAmt="'+this.FcAmt.Replace(",","")+'" ',a.Description=this.FcAmt+" "+this.Currency.Currency.GetText()+"@"+this.Currency.ExchangeRate.Text),"5"==this.Selectedbtn.SectionID)a.Denomination=this.GetDenominationXML();else if("8"==this.Selectedbtn.SectionID)a.Denomination=this.Denom.GetXML();else if("6"==this.Selectedbtn.SectionID||"7"==this.Selectedbtn.SectionID)a.Description=this.CardNo.Text,c+=' CardNo="'+u.d.GetValidXml(this.CardNo.Text)+'" ',c+=' CardName="'+u.d.GetValidXml(this.CardName.Text)+'" ',"6"==this.Selectedbtn.SectionID?(C.e.IsEmpty(this.ExpiryYear.SelectedValue)||C.e.IsEmpty(this.ExpiryMonth.SelectedValue)||(c+=' ExpDate="'+new Date("1/"+this.ExpiryMonth.GetText()+"/"+this.ExpiryYear.SelectedValue).ToString("dd/MMM/yyyy")+'" '),c+=' ApprovalCode="'+u.d.GetValidXml(this.ApprovalCode.Text)+'" ',this.CardType.Enable&&this.CardType.Visible&&this.CardType.SelectedValue>0&&(c+=' CardType="'+this.CardType.SelectedValue+'" '),this.BankName.Enable&&this.BankName.Visible&&this.BankName.SelectedValue>0&&(c+=' BankName="'+this.BankName.SelectedValue+'" ')):this.ExpDate.Date&&(c+=' ExpDate="'+this.ExpDate.Date.ToString("dd/MMM/yyyy")+'" ');else if("9"==this.Selectedbtn.SectionID&&38==this.Parent.ScreenObject.DocumentType){if(!(this.NOdeid>0))return this.DisplayMessage="Enter Valid Voucher No",void(this.MessageVisibility=!0);if(!C.e.DoubleTryParse(this.AvailAmount.Text)||parseFloat(this.Amount.Text)>parseFloat(this.AvailAmount.Text))return this.DisplayMessage="Amount should be less than available",void(this.MessageVisibility=!0);a.Description=this.VoucherNo.Text,c+=' CardNo="'+this.VoucherNo.Text+'" ',c+=' VoucherNodeID="'+this.NOdeid+'" '}else"10"==this.Selectedbtn.SectionID&&(a.Description=this.CardNo.Text,c+=' CardNo="'+u.d.GetValidXml(this.CardNo.Text)+'" ');c+=" />",a.Details=c.toString(),this.GridDataObj.updateRow(a)}for(var l=0;l<this.DenomButtons.length;l++)this.DenomButtons[l].Length="0";this.Amount.Text=parseFloat(this.POSBalanceAmount)>0?this.POSBalanceAmount:"",this.CardName.Text="",this.ExpDate.Date=null,this.CardNo.Text="",this.denominationxml="",this.VoucherNo.Text="",this.AvailAmount.Text="",this.IsCashFC&&(this.IsinTextchanged=!0,this.Currency.Currency.SelectedValue="1",this.lastCurr!=this.Currency.Currency.SelectedValue&&this.AddDenominations(this.Currency.Currency.SelectedValue),this.lastCurr=this.Currency.Currency.SelectedValue,this.Currency.ExchangeRate.Text="1",this.FcAmt=this.Amount.Text,this.IsinTextchanged=!1),this.NOdeid=0,null!=this.Denom&&null!=this.Denom.GrdDenomination&&null!=this.Denom.GrdDenomination.Table&&this.Denom.GrdDenomination.Table.length>0&&this.Denom.GrdDenomination.Table.forEach((function(e){t.Denom.GrdDenomination.TableColumns.Contains("Notestender")&&(e.Notestender=null),t.Denom.GrdDenomination.TableColumns.Contains("ChangeTender")&&(e.ChangeTender=null)})),this.ApprovalCode.Text="",this.ExpiryYear.SelectedValue="",this.ExpiryMonth.SelectedValue=""}}else if(null==e||"CheckoutSave"!=e.toString()&&"CheckoutPrint"!=e.toString())if(null!=e&&"CheckoutPrint"==e.toString()){if(this.Parent.ScreenObject.Preferences.ContainsKey("DecimalsNetAmount")&&""!=this.Parent.ScreenObject.Preferences.DecimalsNetAmount){if(0!=parseFloat(this.Parent.Bal.ToString("N"+this.Parent.ScreenObject.Preferences.DecimalsNetAmount)))return this.DisplayMessage="Pay Balance to check out",void(this.MessageVisibility=!0)}else if(0!=this.Parent.Bal)return this.DisplayMessage="Pay Balance to check out",void(this.MessageVisibility=!0);m.a.page.HideDialog(),this.Parent.SaveInventoryDocument("CheckoutPrint")}else null!=e&&"Close"==e.toString()&&(m.a.page.HideDialog(),this.Parent.IsPOs&&null!=this.Parent.SKU&&this.Parent.SKU.Visible&&this.Parent.SKU.IsTabStop&&(this.Parent.SKU.SetFocus=!0));else{if(!this.Parent.ScreenObject.Preferences.ContainsKey("UseAsOrder")||"True"!=this.Parent.ScreenObject.Preferences.UseAsOrder){if(this.Parent.ScreenObject.Preferences.ContainsKey("DecimalsNetAmount")&&""!=this.Parent.ScreenObject.Preferences.DecimalsNetAmount){if(0!=parseFloat(this.Parent.Bal.ToString("N"+this.Parent.ScreenObject.Preferences.DecimalsNetAmount)))return this.DisplayMessage="Pay Balance to check out",void(this.MessageVisibility=!0)}else if(0!=this.Parent.Bal)return this.DisplayMessage="Pay Balance to check out",void(this.MessageVisibility=!0);var d=0,D=0;if(d=C.e.DoubleTryParse(this.Return),!C.e.StringIsNullOrEmpty(this.Return)&&d>0){d=0;for(var S=0;S<this.GridData.length;S++)"5"==this.GridData[S].Type.toString()&&""!=this.GridData[S].ColumnName.toString()&&""!=this.GridData[S].Amount.toString()?d+=parseInt(this.GridData[S].Amount.toString()):"5"!=this.GridData[S].Type.toString()&&""!=this.GridData[S].ColumnName.toString()&&""!=this.GridData[S].Amount.toString()&&(D+=parseInt(this.GridData[S].Amount.toString()));if(D>0&&parseInt(this.Return)>d)return this.DisplayMessage="Return cannot be more than cash",void(this.MessageVisibility=!0)}}m.a.page.HideDialog(),this.Parent.SaveInventoryDocument_1(e.toString())}}},{key:"OnVoucherNoChanged",value:function(e){null!=this.VoucherNo&&e instanceof KeyboardEvent&&e.keyCode==b.g.ENTER&&this.GetVoucher()}},{key:"GetVoucher",value:function(){var e=0;if(this.NOdeid=0,this.AvailAmount.Text="",!C.e.IsEmpty(this.VoucherNo.Text)&&m.a.SessionManager.Preferences.ContainsKey("PosCoupons")&&C.e.IntTryParse(m.a.SessionManager.Preferences.PosCoupons)&&parseInt(m.a.SessionManager.Preferences.PosCoupons)>5e4){e=parseInt(m.a.SessionManager.Preferences.PosCoupons);var t=this.Parent.ScreenObject.GetPosVoucherDetails(this.VoucherNo.Text,e,this.NOdeid);this.NOdeid>0?(null!=t&&t.Tables.length>0&&t.Columns[0].Contains("BAL")&&t.Tables[0].length>0&&C.e.DoubleTryParse(t.Tables[0][0].BAL.toString())&&(this.AvailAmount.Text=t.Tables[0][0].bal.toString()),this.MessageVisibility=!1):(this.NOdeid=0,null!=t&&t.Tables.length>0&&t.Tables[t.Tables.length-1].length>0&&t.Columns[t.Columns.length-1].Contains("ErrorMessage")&&(this.DisplayMessage=t.Tables[t.Tables.length-1][0].ErrorMessage.toString()),this.MessageVisibility=!0)}}},{key:"FillDenomination",value:function(){var e=this,t=new C.f;t.LoadXml("<PosPayModes>"+this.denominationxml+"</PosPayModes>");var n=t.SelectNodes("PosPayModes/XML");this.DenomButtons.forEach((function(e){e.Length="0"})),n.forEach((function(t){if(null!=t.attributes.Notes&&""!=t.attributes.Notes.value&&0!=parseInt(t.attributes.Notes.value)&&null!=t.attributes.NotesTender&&""!=t.attributes.NotesTender.value&&parseInt(t.attributes.NotesTender.value)>0){var n=e.DenomButtons.filter((function(e){return e.Label==t.attributes.Notes.value}));null!=n&&(n[0].Length=t.attributes.NotesTender.value)}}))}},{key:"Fillvalue",value:function(){if(null!=this.SelectedRow&&!C.e.IsEmpty(this.SelectedRow.Details.toString())){var e=new C.f;e.LoadXml(this.SelectedRow.Details.toString());var t=e.SelectSingleNode("XML");null!=t&&null!=t.attributes.DBColumnName&&""!=t.attributes.DBColumnName.value&&(this.onClick(t.attributes.DBColumnName.value,!0),null!=this.Selectedbtn&&(this.denominationxml=this.SelectedRow.Denomination.toString(),"8"==this.Selectedbtn.SectionID?this.Denom=new h.AddDenominationViewModel(this):"5"==this.Selectedbtn.SectionID&&this.FillDenomination(),null!=t.attributes.Amount&&""!=t.attributes.Amount.value&&(this.Amount.Text=t.attributes.Amount.value),null!=t.attributes.CardNo&&""!=t.attributes.CardNo.value&&(null!=this.Selectedbtn&&"9"==this.Selectedbtn.SectionID?this.VoucherNo.Text=t.attributes.CardNo.value:this.CardNo.Text=t.attributes.CardNo.value),null!=t.attributes.CardName&&""!=t.attributes.CardName.value&&(this.CardName.Text=t.attributes.CardName.value),null!=t.attributes.ApprovalCode&&""!=t.attributes.ApprovalCode.value&&(this.ApprovalCode.Text=t.attributes.ApprovalCode.value),null!=t.attributes.CardType&&""!=t.attributes.CardType.value&&(this.CardType.SelectedValue=parseInt(t.attributes.CardType.value)),null!=t.attributes.BankName&&""!=t.attributes.BankName.value&&(this.BankName.SelectedValue=parseInt(t.attributes.BankName.value)),null!=t.attributes.VoucherNodeID&&""!=t.attributes.VoucherNodeID.Value&&(this.NOdeid=parseInt(t.attributes.VoucherNodeID.value)),null!=t.attributes.ExpDate&&""!=t.attributes.ExpDate.value&&"7"==this.Selectedbtn.SectionID&&(this.ExpDate.Date=new Date(t.attributes.ExpDate.value)),this.IsCashFC&&(this.IsinTextchanged=!0,this.FcAmt=null!=t.attributes.FCAmt&&""!=t.attributes.FCAmt.value?t.attributes.FCAmt.value:this.Amount.Text,this.Currency.ExchangeRate.Text=null!=t.attributes.ExchangeRate&&""!=t.attributes.ExchangeRate.value?t.attributes.ExchangeRate.value:"1",this.Currency.Currency.SelectedValue=null!=t.attributes.Currency&&""!=t.attributes.Currency.value?t.attributes.Currency.value:"1",this.lastCurr!=this.Currency.Currency.SelectedValue&&this.AddDenominations(this.Currency.Currency.SelectedValue),this.lastCurr=this.Currency.Currency.SelectedValue,this.IsinTextchanged=!1)))}}},{key:"OnCardKeyDown",value:function(e){if(e instanceof KeyboardEvent&&e.keyCode==b.g.ENTER){var t,n=this.CardNo.Text,a=n.indexOf("%B");if(n.length>0&&a>=0&&"?"==n[n.length-1]&&(a+=2,(t=n.indexOf("^",a))>0)){if(this.CardNo.Text=n.substr(a,t-a),a=t+1,(t=n.indexOf("^",a))>0){var i=n.substr(a,t-a).split("/");this.CardName.Text=i[0].Trim(),i.length>1&&(this.CardName.Text+=" "+i[1].Trim())}if((a=t+1)+4<n.length)try{this.ExpiryMonth.SelectedValue=parseInt(n.substr(a+2,2)).toString(),this.ExpiryYear.SelectedValue="20"+parseInt(n.substr(a,2)).ToString("00")}catch(r){}}}}},{key:"GridData",get:function(){return this.GridDataObj.Table}},{key:"angularGrid",get:function(){return this.GridDataObj.angularGrid}},{key:"POSBalanceAmount",get:function(){return null!=this.Parent?this.Parent.POSBalanceAmount:""}},{key:"NetAmount",get:function(){return null!=this.Parent?this.Parent.NetAmount:""}},{key:"SelectedRow",get:function(){return this.GridDataObj.SelectedItem},set:function(e){e!=this._SelectedRow&&(this.GridDataObj.SelectedItem=e,this.Fillvalue())}},{key:"GridRowHeight",get:function(){return null!=this.Parent?this.Parent.GridRowHeight:25}}]),o}(o.b)},JoYt:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n("3Pt+"),i=n("fXoL"),r=function(){var e=function(){function e(){_classCallCheck(this,e),this.form=new a.j({})}return _createClass(e,[{key:"ngOnInit",value:function(){}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i.Nb({type:e,selectors:[["app-register"]],inputs:{obj:"obj"},decls:24,vars:8,consts:[[1,"master-screen",2,"padding-bottom","4px","width","400px"],[1,"PACTHeaderFields","dialogSubBody"],[1,"documentgrid","row","form-row",2,"width","100%"],[2,"width","100%",3,"obj","group"],[1,"Pactdailogfooter"],[1,"primary-btn-wicon",3,"click"],[1,"secondary-btn-wicon",3,"click"]],template:function(e,t){1&e&&(i.Zb(0,"div",0),i.Wc(1,"\n    "),i.Zb(2,"div",1),i.Wc(3,"\n        \n      "),i.Zb(4,"div",2),i.Wc(5,"\n        "),i.Ub(6,"app-PactGridView",3),i.Wc(7,"  \n      "),i.Yb(),i.Wc(8,"\n      \n    "),i.Yb(),i.Wc(9,"\n    "),i.Zb(10,"div",4),i.Wc(11,"\n      "),i.Zb(12,"div"),i.Wc(13,"\n        "),i.Zb(14,"button",5),i.hc("click",(function(){return t.obj.onSave("OK")})),i.Wc(15),i.mc(16,"translate"),i.Yb(),i.Wc(17,"\n        "),i.Zb(18,"button",6),i.hc("click",(function(){return t.obj.onSave("Cancel")})),i.Wc(19),i.mc(20,"translate"),i.Yb(),i.Wc(21,"\n      "),i.Yb(),i.Wc(22,"\n  "),i.Yb(),i.Wc(23,"\n"),i.Yb()),2&e&&(i.Db(6),i.tc("obj",t.obj.SelectedRegisterObj)("group",t.form),i.Db(9),i.Xc(i.nc(16,4,"Ok")),i.Db(4),i.Xc(i.nc(20,6,"Close")))},encapsulation:2}),e}()},d36O:function(e,t,n){"use strict";n.r(t),n.d(t,"DocumentFlowChartViewModel",(function(){return d}));var a=n("Do2H"),i=n("Lp6j"),r=n("ScVY"),s=n("vTM8"),o=n("0/4Q"),c=n("PDNK"),l=n("EQd/"),u=n("CUWK"),d=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var u,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,D=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];_classCallCheck(this,n),(u=t.call(this)).dtDocs=null,u.dtDocsDetail=null,u.RootNodes=[],u.lstDocNodes=new s.a,u.DocsFlowData=[],u.DocsArrowData=[],u.DocsArrowDataTemp=[],u.lstRibbonDocs=new s.c,u._DocNumber="",u.VoucherNoObj=new l.d,u.IsInv=!0,u.IsDialog=!1,u.Width=null,u.Height=null,u.MaxNodeHeight=0,u.arrLevelMax=[],u.ActualNodeHeight=80,u.NodePaddingTop=30,u.NodePaddingLeft=60,u.ActualNodeWidth=140,u.IsLinkFlowCall=!1,u.HideValue=!1,u.HideQty=!1,u.HideDocDate=!1,u.Width="800",u.Height="600",u.VoucherNoObj.SetFocus=!0,u.VoucherNoObj.Label=a.a.GetResource("DFCVoucherNo"),u.ShowData=new c.b,u.ShowData.GroupName="ShowData",u.ShowData.Items.push(new c.a("Summary",0,"ShowData")),u.ShowData.Items.push(new c.a("Detail",1,"ShowData")),u.ShowData.Items[0].Label=a.a.GetResource("DFCSummary"),u.ShowData.Items[0].Group=u.ShowData,u.ShowData.Items[1].Group=u.ShowData,u.ShowData.Items[1].Label=a.a.GetResource("DFCDetail"),a.a.SessionManager.PersonalSettings.ContainsKey("DocumentFlowShowData")&&"1"==a.a.SessionManager.PersonalSettings.DocumentFlowShowData?u.ShowData.Items[1].IsChecked=!0:u.ShowData.Items[0].IsChecked=!0,u.ShowData.Items[0].CheckedChangedCommand.Subscribe(_assertThisInitialized(u),"OnNameCheckedChanged"),u.ShowData.Items[1].CheckedChangedCommand.Subscribe(_assertThisInitialized(u),"OnNameCheckedChanged"),u.HideValue=a.a.SessionManager.IsActionAssigned(131,"Hide Value"),u.HideQty=a.a.SessionManager.IsActionAssigned(131,"Hide Qty"),u.HideDocDate=a.a.SessionManager.IsActionAssigned(131,"Hide DocDate"),u.Title="Link Map",u.IsDialog=e,u.VoucherNo=r,u.IsInv=D,u.DocumentType=new o.e(0),u.DocumentType.Label=a.a.GetResource("Document Type"),u.DocPrefix=new o.e(0),u.DocPrefix.Label=a.a.GetResource("DocPrefix"),u.DocumentType.SelectionChangedCommand.Subscribe(_assertThisInitialized(u),"OnDocumentChange"),u.DocPrefix.SelectionChangedCommand.Subscribe(_assertThisInitialized(u),"OnDocPrefix");var h=a.a.report.GetReportData(3,parseInt(a.a.SessionManager.UserID),null);return u.DocumentType.Items.push(o.d.ComboBoxItems_2("","0")),null!=h&&(h.Tables[0].forEach((function(e){u.DocumentType.Items.push(o.d.ComboBoxItems_3(e[h.Columns[0][1]].toString(),e[h.Columns[0][0]].toString(),e.DocumentAbbr.toString()))})),d>0&&(u.DocumentType.SelectedValue=d.toString())),i.e.IsEmpty(r)||u.ConstructTree(),u}return _createClass(n,[{key:"OnNameCheckedChanged",value:function(e){i.e.SetPersonalize("DocumentFlowShowData",this.ShowData.Items[1].IsChecked?"1":"0"),this.OnButtonClick("Submit")}},{key:"OnDocumentChange",value:function(e){var t=this;!i.e.IsEmpty(this.DocumentType.SelectedValue)&&parseInt(this.DocumentType.SelectedValue)>0&&(this.DocPrefix.Items.Clear(),a.a.common.GetDataSet("DOC048",this.DocumentType.SelectedValue).Tables[0].forEach((function(e){t.DocPrefix.Items.push(o.d.ComboBoxItems_3(e.CodePrefix.toString(),e.CodePrefix.toString(),e.CurrentCodeNumber.toString()))})),this.DocNumber=""),this.UpdateVoucherNo()}},{key:"OnDocPrefix",value:function(e){this.DocNumber=null==this.DocPrefix.SelectedItem||i.e.IsEmpty(this.DocPrefix.SelectedItem.Parent)?"":this.DocPrefix.SelectedItem.Parent,this.UpdateVoucherNo()}},{key:"UpdateVoucherNo",value:function(){var e="";!i.e.IsEmpty(this.DocumentType.SelectedValue)&&parseInt(this.DocumentType.SelectedValue)>0&&(e=this.DocumentType.SelectedItem.Parent+"-",i.e.IsEmpty(this.DocPrefix.SelectedValue)||(e+=this.DocPrefix.SelectedValue),i.e.IsEmpty(this.DocNumber)||(e+=this.DocNumber)),this.VoucherNo=e}},{key:"OnButtonClick",value:function(e){if(this.DisplayMessage="","Submit"==e){if(i.e.IsEmpty(this.VoucherNo))return void(this.DisplayMessage="Enter Voucher No");this.ActualNodeWidth=140,this.ConstructTree()}else if("LinkFlow"==e){if(null==this.DocumentType.SelectedValue)return void(this.DisplayMessage="Select Document Type");this.ConstructTree(!0)}else"Close"==e&&a.a.page.HideDialog()}},{key:"OnDocumentClick",value:function(e){if(this.DisplayMessage="",!i.e.IsEmpty(e)){a.a.page.ShowLoading=!0;var t,n=a.a.report.GetDocumentDetailsByVoucherNo(e);if(i.e.Int(n.obj)>0)t=n.Tables[0].length>0?n.Tables[0][0]:n.Tables[1][0],u.RibbonExtViewModel.LoadDocument(t),this.IsDialog&&a.a.page.HideDialog();else this.DisplayMessage="Document not found";a.a.page.ShowLoading=!1}}},{key:"OnDocumentDefClick",value:function(e){}},{key:"ConstructTree",value:function(){var e,t,n=this,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this.DocsArrowData.Clear(),this.DocsArrowDataTemp.Clear(),this.arrLevelMax.Clear(),this.lstDocNodes.Clear(),this.RootNodes.Clear(),this.lstRibbonDocs.Clear(),this.IsLinkFlowCall=i,i)?(a.a.SessionManager.MenuTabs.forEach((function(e){e.Groups.forEach((function(e){for(var t=0;t<e.Items.length;t++){var a=e.Items[t];a.FeatureID>4e4&&a.FeatureID<5e4&&!n.lstRibbonDocs.keys.Contains(a.FeatureID)&&n.lstRibbonDocs.push(a.FeatureID,a)}}))})),this.TempDVNode=new Array,e=a.a.report.GetDocsLinkTree(this.DocumentType.SelectedValue,this.ShowData.Items[0].IsChecked?1:0,this.IsInv)):(this.TempVNode=[],t=this.VoucherNo.startsWith("LINEID:")?this.VoucherNo.split("~"):[this.VoucherNo],e=a.a.report.GetDocsLinkTree(t[0],this.ShowData.Items[0].IsChecked?1:0,this.IsInv),t.length>1&&(this.VoucherNo=t[1]),e.Tables.length>2&&e.Columns[2].Contains("BWDocNo")&&e.Tables[2].forEach((function(t){var n={CostCenterID:0};n.VoucherNo=t.BWDocNo,n.ParentVoucherNo=t.ParentVoucherNo,n.DocDate=t.DocDate,e.Tables[0].push(n)})));if(0!=e.Tables.length){this.dtDocs=e.Tables[0],this.dtDocsDetail=e.Tables[1];var r,s=e.Tables[0].filter((function(e){return null==e.ParentVoucherNo||"-1"==e.ParentVoucherNo||""==e.ParentVoucherNo}));this.arrLevelMax.push(0),e.Columns[0].Contains("DocDate"),s.forEach((function(e){var t=n.GetNode(e,0);t&&(n.RootNodes.push(t),n.AddChildren(t))})),this.lstDocNodes.length>0&&(i?(r=this.lstDocNodes.values.find((function(e){return e.CostCenterID==parseInt(n.DocumentType.SelectedValue)})))&&(r.ForeColor="Red"):(r=this.lstDocNodes.values.find((function(e){return e.DocNo.toString().toLowerCase()==n.VoucherNo.toLowerCase()})))&&(r.ForeColor="Red")),this.arrLevelMax[0]=this.RootNodes.length,this.MaxNodeHeight=Math.max.apply(Math,_toConsumableArray(this.arrLevelMax))*this.NodeHeight,this.RootNodes.forEach((function(e){e.Top=n.MaxNodeHeight/(n.arrLevelMax[0]+1)-n.NodeHeight;var t=n.MaxNodeHeight/n.arrLevelMax[e.Level];e.Top=t*(e.LevelIndex+1)-((t-n.ActualNodeHeight)/2+n.ActualNodeHeight),e.Margin="0,"+e.Top.toString()+",0,0",n.AssignMargin(e)}));var o=[];i?this.TempDVNode.forEach((function(e){o.push(e)})):this.TempVNode.forEach((function(e){o.push(e)})),this.DocsFlowData=o;var c=[];c.AddRange(this.DocsArrowData),this.DocsArrowDataTemp.push(c)}}},{key:"GetNode",value:function(e,t){if(this.lstDocNodes.ContainsKey(e.VoucherNo.toString()))return null;var n=new h;if(n.DocNo=e.VoucherNo.toString(),n.CostCenterID=parseInt(e.CostCenterID),this.IsLinkFlowCall)(n=new S).DocNo=e.VoucherNo.toString(),n.CostCenterID=parseInt(e.CostCenterID),this.lstRibbonDocs.keys.Contains(n.CostCenterID)?n.SmallImage=this.lstRibbonDocs[n.CostCenterID].SmallImage:(n.BtnBorderColor="Gray",n.IsEnable=!1);else{(n=new h).DocNo=e.VoucherNo.toString(),n.CostCenterID=parseInt(e.CostCenterID),this.HideDocDate||null==e.DocDate||(n.DocDate=new Date(e.DocDate).ToString(a.a.SessionManager.Preferences["Date Format"]));var i=this.dtDocsDetail.filter((function(e){return e.VoucherNo==n.DocNo}));i.length>0&&(this.HideQty||null==i[0].Qty||(n.Qty=parseFloat(i[0].Qty).ToString("N"+a.a.SessionManager.Preferences.DecimalsinQty)),this.HideValue||null==i[0].Value||(n.Value=parseFloat(i[0].Value).ToString("N"+a.a.SessionManager.Preferences.DecimalsinAmount)))}return this.lstDocNodes.push(e.VoucherNo.toString(),n),this.ActualNodeWidth/e.VoucherNo.toString().length<7&&(this.ActualNodeWidth=3+7*e.VoucherNo.toString().length),n.Width=this.ActualNodeWidth,n.Height=this.ActualNodeHeight,n.Level=t,this.arrLevelMax.length<=n.Level&&this.arrLevelMax.push(0),n.LevelIndex=this.arrLevelMax[n.Level],this.arrLevelMax[n.Level]++,this.IsLinkFlowCall?this.TempDVNode.push(n):this.TempVNode.push(n),n}},{key:"AddChildren",value:function(e){var t=this;this.dtDocs.filter((function(t){return t.ParentVoucherNo==e.DocNo})).forEach((function(n){var a=n.VoucherNo.toString();if(t.lstDocNodes.ContainsKey(a))e.Children.find((function(e){return e.DocNo==a}))||e.Children.push(t.lstDocNodes[a]);else{var i=t.GetNode(n,e.Level+1);null!=i&&(e.Children.push(i),t.AddChildren(i))}}))}},{key:"AssignMargin",value:function(e){for(var t=this,n=function(n){var a=e.Children[n];if(!a.IsRead){a.IsRead=!0,a.Left=a.Level*t.NodeWidth;var r=t.MaxNodeHeight/t.arrLevelMax[a.Level];a.Top=r*(a.LevelIndex+1)-((r-t.ActualNodeHeight)/2+t.ActualNodeHeight),a.Margin=a.Left+","+a.Top.toString()+",0,0",t.AssignMargin(a)}if(!t.DocsArrowData.find((function(t){return t.FromDocNo==e.DocNo&&t.ToDocNo==a.DocNo}))){var s=new m;s.FromDocNo=e.DocNo,s.ToDocNo=a.DocNo,s.X1=e.Left,e.Left<a.Left&&(s.X1+=t.ActualNodeWidth),s.Y1=e.Top+t.ActualNodeHeight/2,s.X2=a.Left,a.Left<e.Left&&(s.X2+=t.ActualNodeWidth),s.Y2=a.Top+t.ActualNodeHeight/2,t.IsLinkFlowCall?null!=t.DocumentType.SelectedValue&&e.CostCenterID==parseInt(t.DocumentType.SelectedValue)&&(s.Stroke="Red"):i.e.LowerCase(e.DocNo)!=i.e.LowerCase(t.VoucherNo)&&i.e.LowerCase(a.DocNo)!=i.e.LowerCase(t.VoucherNo)||(s.Stroke="Red"),t.DocsArrowData.push(s)}},a=0;a<e.Children.length;a++)n(a)}},{key:"DocNumber",get:function(){return this._DocNumber},set:function(e){e!=this._DocNumber&&(this._DocNumber=e,this.UpdateVoucherNo())}},{key:"VoucherNo",get:function(){return this.VoucherNoObj.Text},set:function(e){this.VoucherNoObj.Text=e}},{key:"NodeHeight",get:function(){return this.ActualNodeHeight+this.NodePaddingTop}},{key:"NodeWidth",get:function(){return this.ActualNodeWidth+this.NodePaddingLeft}}]),n}(r.b),D=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.apply(this,arguments)).CostCenterID=0,e.Level=0,e.Order=0,e.Parent=null,e.Children=[],e.Top=0,e.Left=0,e.LevelIndex=0,e.IsRead=!1,e.Margin="0px 0px 0px 0px",e.ForeColor="Black",e.Width=0,e.Height=0,e}return n}(r.b),h=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"DocDateLbl",get:function(){return i.e.IsEmpty(this.DocDate)?"":"DocDate :"}},{key:"QtyLbl",get:function(){return i.e.IsEmpty(this.Qty)?"":"Qty :"}},{key:"ValueLbl",get:function(){return i.e.IsEmpty(this.Value)?"":"Value :"}},{key:"ToolTip",get:function(){return""!=this.QtyLbl?"Doc No: "+this.DocNo+"\r\nQty: "+this.Qty+"\r\nValue: "+this.Value:"Doc No: "+this.DocNo}}]),n}(D),S=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this)).IsEnable=!1,e.IsEnable=!0,e.BtnBorderColor="Orange",e}return n}(D),m=function e(){_classCallCheck(this,e),this.X1=0,this.X2=0,this.Y1=0,this.Y2=0,this.Stroke="#000"}},kBEi:function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var a=n("fXoL"),i=n("sYmb");function r(e,t){if(1&e&&(a.Xb(0),a.Wc(1,"\n                    "),a.Wc(2,"\n                    "),a.Zb(3,"span",29),a.hc("click",(function(){var e=t.$implicit;return e.ClickCommand.Call(e.DBColumnName)})),a.Wc(4),a.Yb(),a.Wc(5,"\n                  "),a.Wb()),2&e){var n=t.$implicit,i=a.lc();a.Db(3),a.Sc("background-color",i.obj.Selectedbtn==n?"#666666":"#eeeeee"),a.Kb("list_selected",i.obj.Selectedbtn==n),a.uc("title",n.Label),a.Db(1),a.Yc("\n                    ",n.Label,"")}}function s(e,t){if(1&e&&(a.Zb(0,"div",30),a.Wc(1,"\n                    "),a.Vb(2,31),a.Wc(3,"\n                  "),a.Yb()),2&e){var n=a.lc();a.Db(2),a.tc("obj",n.obj.VoucherNo)("group",n.form)}}function o(e,t){if(1&e&&(a.Zb(0,"div",32),a.Wc(1,"\n                    "),a.Vb(2,31),a.Wc(3,"\n                  "),a.Yb()),2&e){var n=a.lc();a.Db(2),a.tc("obj",n.obj.AvailAmount)("group",n.form)}}function c(e,t){if(1&e&&(a.Zb(0,"div",33),a.Wc(1,"\n                    "),a.Vb(2,31),a.Wc(3,"\n                  "),a.Yb()),2&e){var n=a.lc();a.Db(2),a.tc("obj",n.obj.Currency)("group",n.form)}}function l(e,t){if(1&e&&(a.Zb(0,"div",33),a.Wc(1,"\n                    "),a.Vb(2,31),a.Wc(3,"\n                  "),a.Yb()),2&e){var n=a.lc();a.Db(2),a.tc("obj",n.obj.Currency.ExchangeRate)("group",n.form)}}function u(e,t){if(1&e){var n=a.ac();a.Zb(0,"div",33),a.Wc(1,"\n                    "),a.Zb(2,"label",34),a.Wc(3),a.Yb(),a.Wc(4,"\n                    "),a.Zb(5,"input",18),a.hc("keydown",(function(){return a.Ic(n),a.lc().obj.Currency.ExchangeRate.LostFocusCommand.Call("FCAmount")}))("ngModelChange",(function(e){return a.Ic(n),a.lc().obj.FcAmt=e})),a.Yb(),a.Wc(6,"\n                  "),a.Yb()}if(2&e){var i=a.lc();a.Db(3),a.Xc(i.obj.Currency.Label),a.Db(2),a.tc("ngModel",i.obj.FcAmt)}}function d(e,t){if(1&e){var n=a.ac();a.Xb(0),a.Wc(1,"\n                        "),a.Zb(2,"div",36),a.Wc(3,"\n                            "),a.Zb(4,"span",37),a.hc("click",(function(){a.Ic(n);var e=t.$implicit;return a.lc(2).obj.OnSubDenomClick(e)})),a.Wc(5,"\n                                "),a.Ub(6,"i",38),a.Yb(),a.Wc(7,"\n                                "),a.Zb(8,"input",39),a.hc("keydown",(function(){a.Ic(n);var e=t.$implicit;return a.lc(2).obj.OnDenomChange(e)}))("ngModelChange",(function(e){return a.Ic(n),t.$implicit.Length=e})),a.Yb(),a.Wc(9,"\n                                "),a.Zb(10,"span",37),a.hc("click",(function(){a.Ic(n);var e=t.$implicit;return a.lc(2).obj.OnAddDenomClick(e)})),a.Wc(11,"\n                                "),a.Ub(12,"i",40),a.Wc(13,"\n                               "),a.Yb(),a.Wc(14,"\n                        "),a.Yb(),a.Wc(15,"\n                    "),a.Wb()}if(2&e){var i=t.$implicit;a.Db(2),a.Sc("height",i.SectionID,"px"),a.Db(6),a.tc("ngModel",i.Length)}}function D(e,t){if(1&e&&(a.Zb(0,"div",35),a.Wc(1,"\n                    "),a.Uc(2,d,16,3,"ng-container",11),a.Wc(3,"\n                  "),a.Yb()),2&e){var n=a.lc();a.Db(2),a.tc("ngForOf",n.obj.DenomButtons)}}function h(e,t){if(1&e&&(a.Zb(0,"div",32),a.Wc(1,"\n                    "),a.Vb(2,31),a.Wc(3,"\n                  "),a.Yb()),2&e){var n=a.lc();a.Db(2),a.tc("obj",n.obj.CardNo)("group",n.form)}}function S(e,t){if(1&e&&(a.Zb(0,"div",32),a.Wc(1,"\n                    "),a.Vb(2,31),a.Wc(3,"\n                  "),a.Yb()),2&e){var n=a.lc();a.Db(2),a.tc("obj",n.obj.ApprovalCode)("group",n.form)}}function m(e,t){if(1&e&&(a.Zb(0,"div",33),a.Wc(1,"\n                        "),a.Vb(2,31),a.Wc(3,"\n                      "),a.Yb()),2&e){var n=a.lc();a.Db(2),a.tc("obj",n.obj.ExpiryMonth)("group",n.form)}}function b(e,t){if(1&e&&(a.Zb(0,"div",33),a.Wc(1,"\n                        "),a.Vb(2,31),a.Wc(3,"\n                      "),a.Yb()),2&e){var n=a.lc();a.Db(2),a.tc("obj",n.obj.ExpiryYear)("group",n.form)}}function C(e,t){if(1&e&&(a.Zb(0,"div",33),a.Wc(1,"\n                        "),a.Vb(2,31),a.Wc(3,"\n                      "),a.Yb()),2&e){var n=a.lc();a.Db(2),a.tc("obj",n.obj.ExpDate)("group",n.form)}}function y(e,t){if(1&e&&(a.Zb(0,"div",41),a.Wc(1,"\n                        "),a.Vb(2,31),a.Wc(3,"\n                      "),a.Yb()),2&e){var n=a.lc();a.Db(2),a.tc("obj",n.obj.CardName)("group",n.form)}}function p(e,t){if(1&e&&(a.Zb(0,"div",42),a.Wc(1,"\n                        "),a.Vb(2,31),a.Wc(3,"\n                      "),a.Yb()),2&e){var n=a.lc();a.Db(2),a.tc("obj",n.obj.BankName)("group",n.form)}}function g(e,t){if(1&e&&(a.Zb(0,"div",42),a.Wc(1,"\n                        "),a.Vb(2,31),a.Wc(3,"\n                      "),a.Yb()),2&e){var n=a.lc();a.Db(2),a.tc("obj",n.obj.CardType)("group",n.form)}}var f=function(){var e=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;_classCallCheck(this,e),this.translate=t,this.elementRef=n,this.height=300}return _createClass(e,[{key:"ngOnInit",value:function(){this.obj.GridDataObj.Height=200,this.height=.8*window.innerHeight-50}},{key:"ngAfterViewInit",value:function(){this.element.getElementsByClassName("master-screen")}},{key:"element",get:function(){return this.elementRef.nativeElement}}]),e}();return e.\u0275fac=function(t){return new(t||e)(a.Tb(i.e),a.Tb(a.l))},e.\u0275cmp=a.Nb({type:e,selectors:[["app-pospay-modes"]],decls:127,vars:43,consts:[[2,"padding-bottom","4px","min-height","300px"],[2,"padding","6px","text-align","right"],[1,"primary-btn-wicon",3,"click"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-rectangle-xmark"],[2,"padding","5px","height","calc(100% - 40px)"],[2,"margin-bottom","8px","height","200px"],[2,"width","100%",3,"obj"],[2,"margin","0 10px 0 2px","display","flex","height","calc(100% - 250px)"],["GrdPaymodes",""],[2,"width","200px","display","flex","overflow","auto","max-height","400px","flex-direction","column"],[4,"ngFor","ngForOf"],[1,"splitter",2,"width","1px","border-left","1px solid #ccc"],[2,"margin-left","5px","width","calc(100% - 200px)","max-height","400px","overflow","auto"],["class","form-group PACTControl",4,"ngIf"],["class","form-group col-xl-12  col-md-12 col-sm-12 col-xs-12 PACTControl",4,"ngIf"],[1,"Control_flex",2,"width","100%","display","flex","justify-content","space-between"],[1,"input_cntrl_label",2,"padding","5px"],[1,"input_cntrl",3,"ngModel","keydown","ngModelChange"],["title","Add",1,"secondary-btn-wicon",2,"width","38px","margin-left","5px",3,"click"],[1,"fa-light","fa-plus-circle"],["class","PACTControl col-xl-4",4,"ngIf"],["style","max-height: 300px;overflow: auto;","class","row PayModes_buttons",4,"ngIf"],["class","form-group col-xl-4  col-md-4 col-sm-4 col-xs-4 PACTControl",4,"ngIf"],["class","form-group col-xl-6  col-md-6 col-sm-6 col-xs-6 PACTControl",4,"ngIf"],[2,"vertical-align","bottom","display","flex","justify-content","space-between","border-top","1px solid #ccc"],[2,"display","flex","flex-direction","column"],[1,"input_cntrl_label","MetroHeading2",2,"text-align","left","margin-left","8px","vertical-align","top"],[1,"MetroHeading1",2,"text-align","left","margin-left","8px","vertical-align","top"],[1,"rbtn","rbtnGray",2,"width","180px","padding","5px 0","height","36px","font-weight","500","display","flex","justify-content","center","align-items","center","margin","2px 0",3,"title","click"],[1,"form-group","PACTControl"],["FieldDirective","",3,"obj","group"],[1,"form-group","col-xl-12","col-md-12","col-sm-12","col-xs-12","PACTControl"],[1,"PACTControl","col-xl-4"],[1,"input_cntrl_label"],[1,"row","PayModes_buttons",2,"max-height","300px","overflow","auto"],[1,"col-xl-4","col-md-4","col-sm-12","col-xs-12",2,"display","flex","background-color","white","vertical-align","bottom","text-align","center","justify-content","center","align-items","center"],["title","Add",1,"secondary-btn-wicon",2,"font-size","18px","opacity","0.80","color","black",3,"click"],[1,"fa-light","fa-caret-circle-left"],[1,"input_cntrl",2,"max-width","40px","max-height","22px","text-align","center",3,"ngModel","keydown","ngModelChange"],[1,"fa-light","fa-caret-circle-right"],[1,"form-group","col-xl-4","col-md-4","col-sm-4","col-xs-4","PACTControl"],[1,"form-group","col-xl-6","col-md-6","col-sm-6","col-xs-6","PACTControl"]],template:function(e,t){1&e&&(a.Zb(0,"div",0),a.Wc(1,"\n    "),a.Zb(2,"div",1),a.Wc(3,"\n        "),a.Zb(4,"button",2),a.hc("click",(function(){return t.obj.OnButtonClick("CheckoutSave")})),a.Wc(5),a.mc(6,"translate"),a.Yb(),a.Wc(7,"\n        "),a.Zb(8,"button",3),a.hc("click",(function(){return t.obj.OnButtonClick("CheckoutPrint")})),a.Wc(9),a.mc(10,"translate"),a.Yb(),a.Wc(11,"\n        "),a.Zb(12,"button",3),a.hc("click",(function(){return t.obj.OnButtonClick("Close")})),a.Ub(13,"i",4),a.Wc(14),a.mc(15,"translate"),a.Yb(),a.Wc(16,"\n    "),a.Yb(),a.Wc(17,"\n    "),a.Zb(18,"div",5),a.Wc(19,"\n        "),a.Zb(20,"div",6),a.Wc(21,"\n            "),a.Ub(22,"app-PactGridView",7),a.Wc(23," \n        "),a.Yb(),a.Wc(24,"\n        "),a.Zb(25,"div",8,9),a.Wc(27,"\n            "),a.Zb(28,"div",10),a.Wc(29,"\n                "),a.Uc(30,r,6,6,"ng-container",11),a.Wc(31,"\n            "),a.Yb(),a.Wc(32,"\n            "),a.Zb(33,"div",12),a.Wc(34,"\n            "),a.Yb(),a.Wc(35,"\n            "),a.Zb(36,"div",13),a.Wc(37,"\n                  "),a.Uc(38,s,4,2,"div",14),a.Wc(39,"\n                  "),a.Uc(40,o,4,2,"div",15),a.Wc(41,"\n                  "),a.Zb(42,"div",16),a.Wc(43,"\n                    "),a.Zb(44,"label",17),a.Wc(45),a.Yb(),a.Wc(46,"\n                    "),a.Zb(47,"input",18),a.hc("keydown",(function(){return t.obj.OnButtonClick("AmtChanged")}))("ngModelChange",(function(e){return t.obj.Amount.Text=e})),a.Yb(),a.Wc(48,"\n                    "),a.Zb(49,"span",19),a.hc("click",(function(){return t.obj.OnButtonClick("OK")})),a.Wc(50,"\n                        "),a.Ub(51,"i",20),a.Wc(52,"Add"),a.Yb(),a.Wc(53,"\n                  "),a.Yb(),a.Wc(54,"\n                  "),a.Zb(55,"div",16),a.Wc(56,"\n                  "),a.Uc(57,c,4,2,"div",21),a.Wc(58,"\n                  "),a.Uc(59,l,4,2,"div",21),a.Wc(60,"\n                  "),a.Uc(61,u,7,2,"div",21),a.Wc(62,"\n                  "),a.Yb(),a.Wc(63,"\n\n                  "),a.Uc(64,D,4,1,"div",22),a.Wc(65,"\n\n                  "),a.Uc(66,h,4,2,"div",15),a.Wc(67,"\n                  "),a.Uc(68,S,4,2,"div",15),a.Wc(69,"\n                   \n                    "),a.Zb(70,"div",16),a.Wc(71,"\n                    "),a.Uc(72,m,4,2,"div",21),a.Wc(73,"\n                      "),a.Uc(74,b,4,2,"div",21),a.Wc(75,"\n                      "),a.Uc(76,C,4,2,"div",21),a.Wc(77,"\n                      "),a.Uc(78,y,4,2,"div",23),a.Wc(79,"\n                  "),a.Yb(),a.Wc(80,"\n                  "),a.Zb(81,"div",16),a.Wc(82,"\n                    "),a.Uc(83,p,4,2,"div",24),a.Wc(84,"\n                      "),a.Uc(85,g,4,2,"div",24),a.Wc(86,"\n                  "),a.Yb(),a.Wc(87,"\n                \n                  "),a.Wc(88,"\n            "),a.Yb(),a.Wc(89,"\n        "),a.Yb(),a.Wc(90,"\n        "),a.Zb(91,"div",25),a.Wc(92,"\n\n            "),a.Zb(93,"div",26),a.Wc(94,"\n                "),a.Zb(95,"label",27),a.Wc(96),a.mc(97,"translate"),a.Yb(),a.Wc(98,"\n                "),a.Zb(99,"span",28),a.Wc(100),a.Yb(),a.Wc(101,"\n            "),a.Yb(),a.Wc(102,"\n            "),a.Zb(103,"div",26),a.Wc(104,"\n                "),a.Zb(105,"label",27),a.Wc(106),a.mc(107,"translate"),a.Yb(),a.Wc(108,"\n                "),a.Zb(109,"span",28),a.Wc(110),a.Yb(),a.Wc(111,"\n            "),a.Yb(),a.Wc(112,"\n            "),a.Zb(113,"div",26),a.Wc(114,"\n                "),a.Zb(115,"label",27),a.Wc(116),a.mc(117,"translate"),a.Yb(),a.Wc(118,"\n                "),a.Zb(119,"span",28),a.Wc(120),a.Yb(),a.Wc(121,"\n            "),a.Yb(),a.Wc(122,"\n\n        "),a.Yb(),a.Wc(123,"\n    "),a.Yb(),a.Wc(124,"\n     "),a.Wc(125,"\n"),a.Yb(),a.Wc(126,"\n\n")),2&e&&(a.Sc("height",t.height,"px")("width",t.obj.Width,"px"),a.Db(5),a.Xc(a.nc(6,31,"Save")),a.Db(4),a.Xc(a.nc(10,33,"SaveAndPrint")),a.Db(5),a.Xc(a.nc(15,35,"Cancel")),a.Db(8),a.tc("obj",t.obj.GridDataObj),a.Db(8),a.tc("ngForOf",t.obj.PayModes),a.Db(8),a.tc("ngIf",t.obj.VoucherNo.Visible),a.Db(2),a.tc("ngIf",t.obj.AvailAmount.Visible),a.Db(5),a.Xc(t.obj.Amount.Label),a.Db(2),a.tc("ngModel",t.obj.Amount.Text),a.Db(10),a.tc("ngIf",null!=t.obj.Currency&&t.obj.Currency.Visible),a.Db(2),a.tc("ngIf",null!=t.obj.Currency&&t.obj.Currency.ExchangeRate.Visible),a.Db(2),a.tc("ngIf",null!=t.obj.Currency),a.Db(3),a.tc("ngIf",t.obj.IsCash),a.Db(2),a.tc("ngIf",t.obj.CardNo.Visible),a.Db(2),a.tc("ngIf",t.obj.ApprovalCode.Visible),a.Db(4),a.tc("ngIf",t.obj.ExpiryMonth.Visible),a.Db(2),a.tc("ngIf",t.obj.ExpiryYear.Visible),a.Db(2),a.tc("ngIf",t.obj.ExpDate.Visible),a.Db(2),a.tc("ngIf",t.obj.CardName.Visible),a.Db(5),a.tc("ngIf",t.obj.BankName.Visible),a.Db(2),a.tc("ngIf",t.obj.CardType.Visible),a.Db(11),a.Xc(a.nc(97,37,"DocumentNet")),a.Db(4),a.Xc(t.obj.NetAmount),a.Db(6),a.Xc(a.nc(107,39,"Balance")),a.Db(4),a.Xc(t.obj.POSBalanceAmount),a.Db(6),a.Xc(a.nc(117,41,"ReturnLabel")),a.Db(4),a.Xc(t.obj.Return))},encapsulation:2}),e}()},keYA:function(e,t,n){"use strict";n.d(t,"a",(function(){return C}));var a=n("Do2H"),i=n("Lp6j"),r=n("eQJW"),s=n("ScVY"),o=n("0/4Q"),c=n("JIg3"),l=n("jgdN"),u=n("EQd/"),d=n("n56n"),D=n("NkMH"),h=n("8B8H"),S=n("ockk"),m=n("Z9XZ"),b=n("HNy5"),C=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var s,m=arguments.length>1&&void 0!==arguments[1]&&arguments[1];_classCallCheck(this,n),(s=t.call(this)).ButtonVisibility=!0,s.AdjustBillsVisible=!1,s.Repeat=new o.e(0),s.CheqStartDate=new c.a(0),s.CheqEndDate=new c.a(0),s.PayeeBank=new l.a(0),s.Amount=new u.d(0),s.ChequeBankName=new u.d(0),s.NoofCheques=new u.d(0),s.FirstChequeNo=new u.d(0),s.SelectedValueChanged=!1,s._selectedvalue=0,s.DebitAcc=new d.b(0),s.AdjustBills=!0,s.GenerateButton=new D.a,s.CredAcc=new d.b(0),s.PDCAmount=0,s.IsDataSaved=!1,s.GenChqVis=!1,s.IsPrepayment=!1,s.Dedimals="2",s.HeaderFields=[],s.PrevValue="",s.ClassName="pdcGenerateChequeViewModel";var b=e.GetButton("Generate Cheques");if(null!=b&&(s.GenChqVis=b.Visible),s.IsPrepayment=m,s.IsDataSaved=!1,s.oparent=e,s.Amount.DataType="FLOAT",s.NoofCheques.DataType="FLOAT",s.NoofCheques.TextChangedCommand.Subscribe(_assertThisInitialized(s),"OnSave","TextChanged"),s.CheqStartDate.SelectedDateChanged.Subscribe(_assertThisInitialized(s),"OnSave","SelectedDateChanged"),s.CheqStartDate.DBColumnName="CheqStartDate",s.CheqEndDate.DBColumnName="CheqEndDate",s.GrBody=new h.a,s.GrBody.Width="600",s.GrBody.OnCellEditEnding.Subscribe(_assertThisInitialized(s),"OnGridCellEditEnding"),s.GrBody.OnBeginEdit.Subscribe(_assertThisInitialized(s),"Grid_BeginEdit"),s.GenerateButton.Visible=!1,19==e.ScreenObject.DocumentType)e.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")?(C=e.ScreenObject.ColumnSource.find((function(e){return null!=e.ValueMember&&"creditaccount_key"==e.ValueMember.toLowerCase()})))&&(s.CredAcc.Label=C.Header):s.CredAcc.Label="Account Name",e.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")?(C=e.ScreenObject.ColumnSource.find((function(e){return null!=e.ValueMember&&"debitaccount_key"==e.ValueMember.toLowerCase()})))&&(s.DebitAcc.Label=C.Header):s.DebitAcc.Label=null!=e.ScreenObject.DebitAccount?e.ScreenObject.DebitAccount.Label:"Reciept Mode";else if(14==e.ScreenObject.DocumentType){var C;e.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")?(C=e.ScreenObject.ColumnSource.find((function(e){return null!=e.ValueMember&&"debitaccount_key"==e.ValueMember.toLowerCase()})))&&(s.CredAcc.Label=C.Header):s.CredAcc.Label="Account Name",e.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")?(C=e.ScreenObject.ColumnSource.find((function(e){return null!=e.ValueMember&&"creditaccount_key"==e.ValueMember.toLowerCase()})))&&(s.DebitAcc.Label=C.Header):s.DebitAcc.Label=null!=e.ScreenObject.CreditAccount?e.ScreenObject.CreditAccount.Label:"Reciept Mode"}else{s.GrBody.Table=[],s.GrBody.Columns=[];var y=new S.a;y.Header="#",y.DisplayMember="DocSeqNo",y.lbl="DocSeqNo",y.DataType="TextBlock",y.ReadOnly=!0,y.Width=45,y.ID="0",y.DisableTab=!0,s.GrBody.Columns.push(y),s.GrBody.TableColumns.push("DocSeqNo");var p=0;!e.ScreenObject.Preferences.ContainsKey("PrepaymentDoc")||!m&&e.IsInventoryVoucher?e.ScreenObject.Preferences.ContainsKey("PostPdcDoc")&&(p=parseInt(e.ScreenObject.Preferences.PostPdcDoc)):p=i.e.IsEmpty(e.ScreenObject.Preferences.PrepaymentDoc)?0:parseInt(e.ScreenObject.Preferences.PrepaymentDoc);var g=e.ScreenObject.GetScreenInfo(p);if(null!=g&&g.Tables.length>0&&!g.Columns[0].Contains("ErrorMessage")&&g.Tables[0].length>0){var f=parseInt(g.Tables[0][0].DocumentType),O=null;if((O=g.Tables[0].filter((function(e){return"CreditAccount"==e.SysColumnName}))).length>0&&(s.CredAcc.Label=O[0].ResourceData.toString(),e.IsInventoryVoucher&&14==f&&(1==e.DocumentType||2==e.DocumentType||4==e.DocumentType)||(!e.IsInventoryVoucher||m)&&"3"==O[0].SectionID.toString()?(e.IsInventoryVoucher&&!s.IsPrepayment||(s.CredAcc.Visible=!1),s.GrBody.TableColumns.push("CreditAccount"),s.GrBody.TableColumns.push("CreditAccount_Key"),(y=new S.a).Header=O[0].ResourceData.toString(),y.CostCenterID=parseInt(O[0].ColumnCostCenterID),y.TypeID=parseInt(O[0].ColumnCCListViewTypeID),y.DisplayMember="CreditAccount",y.ValueMember="CreditAccount_Key",y.DataType="LISTBOX",y.Width=parseInt(O[0].UIWidth),s.GrBody.Columns.push(y)):e.IsInventoryVoucher&&!m&&(s.CredAcc.Visible=!1)),null!=(O=g.Tables[0].filter((function(e){return"DebitAccount"==e.SysColumnName})))&&O.length>0&&(s.DebitAcc.Label=O[0].ResourceData.toString(),e.IsInventoryVoucher&&19==f&&(11==e.DocumentType||7==e.DocumentType||12==e.DocumentType||38==e.DocumentType)||(!e.IsInventoryVoucher||m)&&"3"==O[0].SectionID.toString()?(e.IsInventoryVoucher&&!s.IsPrepayment||(s.DebitAcc.Visible=!1),s.GrBody.TableColumns.push("DebitAccount"),s.GrBody.TableColumns.push("DebitAccount_Key"),(y=new S.a).Header=O[0].ResourceData.toString(),y.CostCenterID=parseInt(O[0].ColumnCostCenterID),y.TypeID=parseInt(O[0].ColumnCCListViewTypeID),y.DisplayMember="DebitAccount",y.ValueMember="DebitAccount_Key",y.DataType="LISTBOX",y.Width=parseInt(O[0].UIWidth),s.GrBody.Columns.push(y)):e.IsInventoryVoucher&&!m&&(s.DebitAcc.Visible=!1)),!e.IsInventoryVoucher&&m){if(s.GrBody.CanUserAddRows=!0,s.GrBody.CanUserDeleteRows=!0,(O=g.Tables[0].filter((function(e){return 3==e.SectionID&&e.SysColumnName.toLowerCase().startsWith("dcccnid")}))).length>0)for(var I=0;I<O.length;I++)s.GrBody.TableColumns.push(O[I].SysColumnName.toString()),s.GrBody.TableColumns.push(O[I].SysColumnName.toString()+"_Key"),(y=new S.a).Header=O[I].ResourceData.toString(),y.CostCenterID=parseInt(O[I].ColumnCostCenterID),y.TypeID=parseInt(O[I].ColumnCCListViewTypeID),y.DisplayMember=O[I].SysColumnName.toString(),y.ValueMember=O[I].SysColumnName.toString()+"_Key",y.DataType="LISTBOX",y.Width=parseInt(O[I].UIWidth),s.GrBody.Columns.push(y);(y=new S.a).Header="Percentage",y.DisplayMember="Percentage",y.DataType="FLOAT",s.GrBody.Columns.push(y),y.Width=80,y.IsCalculated=1,y.ShowTotal=!0,s.GrBody.TableColumns.push("Percentage"),(y=new S.a).Header="Amount",y.DisplayMember="Amount",y.DataType="FLOAT",(O=g.Tables[0].filter((function(e){return"Amount"==e.SysColumnName}))).length>0&&i.e.DoubleTryParse(O[0].Decimal)>=0?s.Dedimals=O[0].Decimal.toString():a.a.SessionManager.Preferences.ContainsKey("DecimalsinAmount")&&""!=a.a.SessionManager.Preferences.DecimalsinAmount&&(s.Dedimals=a.a.SessionManager.Preferences.DecimalsinAmount),y.DecimalPoints=s.Dedimals,s.GrBody.Columns.push(y),y.Width=80,y.IsCalculated=1,y.ShowTotal=!0,s.GrBody.TableColumns.push("Amount"),s.GrBody.TableColumns.push("Detailsxml")}else(y=new S.a).Header="Amount",y.DisplayMember="Amount",y.DataType="FLOAT",(O=g.Tables[0].filter((function(e){return"Amount"==e.SysColumnName}))).length>0&&i.e.DoubleTryParse(O[0].Decimal)>=0?s.Dedimals=O[0].Decimal.toString():a.a.SessionManager.Preferences.ContainsKey("DecimalsinAmount")&&""!=a.a.SessionManager.Preferences.DecimalsinAmount&&(s.Dedimals=a.a.SessionManager.Preferences.DecimalsinAmount),y.DecimalPoints=s.Dedimals,s.GrBody.Columns.push(y),y.Width=80,s.GrBody.TableColumns.push("Amount"),(y=new S.a).Header="Cheque No",y.DisplayMember="ChequeNumber",s.GrBody.Columns.push(y),y.Width=100,s.GrBody.TableColumns.push("ChequeNumber"),(y=new S.a).Header="Cheque Date",y.DisplayMember="ChequeDate",y.DataType="DATE",s.GrBody.Columns.push(y),y.Width=120,s.GrBody.TableColumns.push("ChequeDate"),s.GrBody.TableColumns.push("ChequeDate_Key"),s.GrBody.TableColumns.push("ChequeBankName"),s.GrBody.TableColumns.push("DocID"),s.GrBody.TableColumns.push("DocDetailsID"),s.GrBody.TableColumns.push("StatusID")}else s.DebitAcc.Label="Debit account",s.CredAcc.Label="Credit account",(22==e.ScreenObject.DocumentType||18==e.ScreenObject.DocumentType)&&e.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&e.ScreenObject.GridData.length>0&&!i.e.StringIsNullOrEmpty(e.ScreenObject.GridData[0].CreditAccount_Key)?s.DebitAcc.SelectedValue=parseInt(e.ScreenObject.GridData[0].CreditAccount_Key):e.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&e.ScreenObject.GridData.length>0&&!i.e.StringIsNullOrEmpty(e.ScreenObject.GridData[0].DebitAccount_Key)&&(s.CredAcc.SelectedValue=parseInt(e.ScreenObject.GridData[0].DebitAccount_Key));if(!s.oparent.IsInventoryVoucher&&e.ScreenObject.GridData.length>0&&!i.e.StringIsNullOrEmpty(e.ScreenObject.GridData[0].Amount)&&(s.Amount.Text=e.ScreenObject.GridData[0].Amount.toString(),s.Amount.Enable=!1),s.oparent.IsInventoryVoucher&&!m){var T=g.Tables[7].filter((function(e){return"BankNameDropDown"==e.PrefName}));T.length>0&&"True"==T[0].PrefValue.toString()?(s.PayeeBank.Visible=!0,s.PayeeBank.Label="Bank Name",s.PayeeBank.CostCenterID=p,s.PayeeBank.DBColumnName="chequebankname",s.ChequeBankName.Visible=!1):(s.PayeeBank.Visible=!1,s.ChequeBankName.Visible=!0)}}if(e.IsInventoryVoucher||(e.ScreenObject.Preferences.ContainsKey("BankNameDropDown")&&""!=e.ScreenObject.Preferences.BankNameDropDown&&Object(r.j)(e.ScreenObject.Preferences.BankNameDropDown)?(s.PayeeBank.Visible=!0,s.PayeeBank.Label="Bank Name",s.PayeeBank.CostCenterID=e.ScreenObject.CostCenterID,s.PayeeBank.DBColumnName="chequebankname",s.ChequeBankName.Visible=!1):(s.PayeeBank.Visible=!1,s.ChequeBankName.Visible=!0)),e.IsInventoryVoucher&&!m){s.GrBody.CanUserAddRows=!0,s.GrBody.CanUserDeleteRows=!0,s.AdjustBillsVisible=!1,s.Repeat.Items.push(o.d.ComboBoxItems_2("Monthly","1")),s.Repeat.Items.push(o.d.ComboBoxItems_2("Quaterly","3")),s.Repeat.Items.push(o.d.ComboBoxItems_2("Half yearly","6")),s.Repeat.Label="Repeat",s.CheqStartDate.Label=a.a.GetResource("Ren_CntrctCheStartD"),s.CheqEndDate.Label=a.a.GetResource("EndDate"),s.GrBody.Row=3,s.CheqStartDate.Row=0,s.CheqStartDate.Column=2,s.Repeat.Row=2,s.Repeat.Column=0,s.DebitAcc.Row=0,s.DebitAcc.Visible?s.DebitAcc.Column=0:s.CredAcc.Column=0,s.CredAcc.Row=0,s.Amount.Row=0,s.Amount.Column=1,s.GenerateButton.Visible=!0,s.GenerateButton.Row=2,s.GenerateButton.Column=1,s.GrBody.Visible=!0,s.CheqEndDate.Visible=!1,s.NoofCheques.Label=a.a.GetResource("Ren_CntrctNoCheque"),s.DisplayName=a.a.GetResource("Ren_CntrctCheqNo"),s.btnSavetext=a.a.GetResource("SerialNo_Generate");for(var j=s.oparent.ScreenObject.GetPDCInstallmentDetails(),P=0;P<j.Tables[0].length;P++){var A=s.GrBody.NewRow();s.PDCAmount+=parseFloat(j.Tables[0][P].Amount),A.DocSeqNo=(P+1).toString(),A.Amount=j.Tables[0][P].Amount.toString(),A.ChequeNumber=j.Tables[0][P].chequenumber.toString(),A.StatusID=j.Tables[0][P].Statusid.toString(),A.DocDetailsID=j.Tables[0][P].Accdocdetailsid.toString(),A.DocID=j.Tables[0][P].docid.toString(),A.ChequeBankName=j.Tables[0][P].ChequeBankName.toString(),i.e.StringIsNullOrEmpty(j.Tables[0][P].chequedate)||(A.ChequeDate_Key=new Date(j.Tables[0][P].chequedate),A.ChequeDate=new Date(j.Tables[0][P].chequedate).ToString(a.a.SessionManager.Preferences["Date Format"])),i.e.StringIsNullOrEmpty(j.Tables[0][P].BankAccountID)?s.GrBody.TableColumns.Contains("DebitAccount_Key")?A.DebitAccount_Key=j.Tables[0][P].DebitAccount.toString():A.CreditAccount_Key=j.Tables[0][P].CreditAccount.toString():s.GrBody.TableColumns.Contains("DebitAccount_Key")?A.DebitAccount_Key=j.Tables[0][P].BankAccountID.toString():A.CreditAccount_Key=j.Tables[0][P].BankAccountID.toString(),s.GrBody.addRow(A)}s.Amount.Text=s.PDCAmount.toString(),s.GrBody.RefreshGrid=!0}else s.GenChqVis?(s.Repeat.Items.push(o.d.ComboBoxItems_2("Monthly","1")),s.Repeat.Items.push(o.d.ComboBoxItems_2("Quaterly","3")),s.Repeat.Items.push(o.d.ComboBoxItems_2("Half yearly","6")),s.Repeat.Label="Repeat",s.CheqStartDate.Label=a.a.GetResource("Ren_CntrctCheStartD"),s.CheqEndDate.Label=a.a.GetResource("EndDate"),s.AdjustBillsVisible=!0,s.GrBody.Row=2,s.CheqStartDate.Row=2,s.CheqStartDate.Column=0,s.Repeat.Row=2,s.Repeat.Column=1,s.DebitAcc.Row=0,s.DebitAcc.Column=0,s.CredAcc.Row=0,s.CredAcc.Column=1,s.Amount.Row=0,s.Amount.Column=2,s.GrBody.Visible=!1,s.CheqEndDate.Visible=!1,s.NoofCheques.Label=a.a.GetResource("Ren_CntrctNoCheque"),s.DisplayName=a.a.GetResource("Ren_CntrctCheqNo"),s.btnSavetext=a.a.GetResource("SerialNo_Generate")):(s.Repeat.Label="Rent based on",s.Repeat.Items.push(o.d.ComboBoxItems_2("Monthly","1")),s.Repeat.Items.push(o.d.ComboBoxItems_2("Daily","2")),s.PayeeBank.Visible=!1,s.ChequeBankName.Visible=!1,s.FirstChequeNo.Visible=!1,s.AdjustBillsVisible=!1,s.NoofCheques.Label="No. of Months",s.CheqStartDate.Label="Start Date",s.CheqEndDate.Label="End Date",s.DisplayName="Pre payments",s.btnSavetext="OK",s.CheqStartDate.Row=1,s.CheqStartDate.Column=1,s.CheqEndDate.Row=1,s.CheqEndDate.Column=2,s.Repeat.Row=0,s.Repeat.Column=2,s.GrBody.Row=3,s.DebitAcc.Visible?s.DebitAcc.Column=0:s.CredAcc.Column=0,s.DebitAcc.Row=0,s.CredAcc.Row=0,s.Amount.Row=0,s.Amount.Column=1);if(s.NoofCheques.Row=1,s.NoofCheques.Column=0,s.FirstChequeNo.Row=1,s.FirstChequeNo.Column=1,s.PayeeBank.Row=1,s.PayeeBank.Column=2,s.ChequeBankName.Row=1,s.ChequeBankName.Column=2,s.Amount.Label="Amount",s.CredAcc.TypeID=s.DebitAcc.TypeID=100,s.CredAcc.CCID=s.DebitAcc.CCID=2,s.HeaderFields.push(s.DebitAcc),s.HeaderFields.push(s.CredAcc),s.HeaderFields.push(s.Amount),s.HeaderFields.push(s.NoofCheques),s.HeaderFields.push(s.CheqEndDate),s.HeaderFields.push(s.FirstChequeNo),s.HeaderFields.push(s.PayeeBank),s.HeaderFields.push(s.ChequeBankName),s.HeaderFields.push(s.CheqStartDate),s.HeaderFields.push(s.Repeat),s.HeaderFields.sort((function(e,t){return e.Column-t.Column})),s.HeaderFields.sort((function(e,t){return e.Row-t.Row})),s.Title=s.DisplayName,s.GrBody.Visible)for(var M=0;M<50;M++){s.GrBody.addEmptyRow();var v=s.GrBody.NewRow();v.DocSeqNo=(M+1).toString(),s.GrBody.addRow(v)}return s.Repeat.SelectedValue="1",s}return _createClass(n,[{key:"loadFromxml",value:function(e,t){if(!i.e.IsEmpty(e)){var n=new i.f;n.LoadXml(e);var a=n.SelectNodes("XML");if(a.length>0){this.IsDataSaved=!0,null==a[0].attributes.BasedOn||i.e.IsEmpty(a[0].attributes.BasedOn.value)||(this.Repeat.SelectedValue=a[0].attributes.BasedOn.value),null==a[0].attributes.StartDate||i.e.IsEmpty(a[0].attributes.StartDate.value)||(this.CheqStartDate.Date=new Date(a[0].attributes.StartDate.value)),null==a[0].attributes.EndDate||i.e.IsEmpty(a[0].attributes.EndDate.value)||(this.CheqEndDate.Date=new Date(a[0].attributes.EndDate.value)),null==a[0].attributes.Months||i.e.IsEmpty(a[0].attributes.Months.value)||(this.NoofCheques.Text=a[0].attributes.Months.value),""!=t&&(this.Amount.Text=t),a=n.SelectNodes("XML/Rows"),this.GrBody.Clear();for(var r=0;r<a.length;r++){var s=this.GrBody.NewRow();s.DocSeqNo=(r+1).toString(),null==a[r].attributes.DebitAcc||i.e.IsEmpty(a[r].attributes.DebitAcc.value)||(this.DebitAcc.Visible?this.DebitAcc.SelectedValue=parseInt(a[r].attributes.DebitAcc.value):this.GrBody.TableColumns.Contains("DebitAccount_Key")&&(s.DebitAccount_Key=a[r].attributes.DebitAcc.value)),null==a[r].attributes.CredAcc||i.e.IsEmpty(a[r].attributes.CredAcc.value)||(this.CredAcc.Visible?this.CredAcc.SelectedValue=parseInt(a[r].attributes.CredAcc.value):this.GrBody.TableColumns.Contains("CreditAccount_Key")&&(s.CreditAccount_Key=a[r].attributes.CredAcc.value)),null==a[r].attributes.Amount||i.e.IsEmpty(a[r].attributes.Amount.value)||this.GrBody.TableColumns.Contains("Percentage")&&this.GrBody.TableColumns.Contains("Amount")&&(s.Percentage=a[r].attributes.Amount.value,s.Amount=""==s.Percentage.toString()||i.e.IsEmpty(this.Amount.Text)?0:i.e.Round(parseFloat(this.Amount.Text)*parseFloat(s.Percentage.toString())/100,parseInt(this.Dedimals)));for(var o=1;o<this.GrBody.Columns.length;o++)this.GrBody.Columns[o].DisplayMember.toLowerCase().Contains("dcccnid")&&null!=a[r].Attributes[this.GrBody.Columns[o].DisplayMember]&&!i.e.IsEmpty(a[r].Attributes[this.GrBody.Columns[o].DisplayMember].value)&&(s[this.GrBody.Columns[o].ValueMember]=a[r].attributes[this.GrBody.Columns[o].DisplayMember].value);""!=a[r].InnerXml&&(s.Detailsxml="<XML>"+a[r].InnerXml+"</XML>"),this.GrBody.addRow(s)}this.GrBody.RefreshGrid=!0,this.GrBody.UpdateTotals();for(var c=0;c<50;c++){this.GrBody.addEmptyRow();var l=this.GrBody.NewRow();l.DocSeqNo=(c+1).toString(),this.GrBody.addRow(l)}}}}},{key:"Grid_BeginEdit",value:function(e,t,n){return"Percentage"!=t&&"Amount"!=t||(this.PrevValue=e[t].toString()),!1}},{key:"OnGridCellEditEnding",value:function(e,t,n){if(this.GrBody.TableColumns.Contains("Percentage")){if("Percentage"==t){if(e[t].toString()==this.PrevValue)return;e.Amount=i.e.StringIsNullOrEmpty(e.Percentage)?0:i.e.Round(parseFloat(this.Amount.Text)*parseFloat(e.Percentage)/100,parseInt(this.Dedimals)),this.GrBody.UpdateTotals()}"Amount"==t&&(e.Percentage=i.e.StringIsNullOrEmpty(e.Amount)?0:i.e.Round(parseFloat(e.Amount)*(100/parseFloat(this.Amount.Text)),2),this.GrBody.UpdateTotals())}}},{key:"Validate",value:function(e){return i.e.StringIsNullOrEmpty(this.Amount.Text)||parseFloat(this.Amount.Text).ToString("N0")==parseFloat(e).ToString("N0")?this.DebitAcc.Visible&&0==this.DebitAcc.SelectedValue?(this.oparent.DisplayMessage="Select "+this.DebitAcc.Label+" in Prepayments.",this.oparent.MessageVisibility=!0,!1):!this.CredAcc.Visible||0!=this.CredAcc.SelectedValue||(this.oparent.DisplayMessage="Select "+this.CredAcc.Label+" in Prepayments.",this.oparent.MessageVisibility=!0,!1):(this.oparent.DisplayMessage="Amount not equal in Prepayments.",this.oparent.MessageVisibility=!0,!1)}},{key:"GetXML1",value:function(){var e="";e+="&lt;XML",i.e.StringIsNullOrEmpty(this.NoofCheques.Text)||(e+=" Months='"+this.NoofCheques.Text+"' "),i.e.StringIsNullOrEmpty(this.Repeat.SelectedValue)||(e+=" BasedOn='"+this.Repeat.SelectedValue+"' "),e+=" StartDate='"+this.CheqStartDate.Date.ToString("dd/MMM/yyyy")+"' ",e+=" EndDate='"+this.CheqEndDate.Date.ToString("dd/MMM/yyyy")+"' >";for(var t=0;t<this.GrBody.Table.length;t++)if(i.e.DoubleTryParse(this.GrBody.Table[t].Percentage)>0){e+="&lt;Rows ",this.DebitAcc.Visible?e+=" DebitAcc='"+this.DebitAcc.SelectedValue+"' ":this.GrBody.TableColumns.Contains("DebitAccount_Key")&&!i.e.StringIsNullOrEmpty(this.GrBody.Table[t].DebitAccount_Key)&&(e+=" DebitAcc='"+this.GrBody.Table[t].DebitAccount_Key.toString()+"' "),this.CredAcc.Visible?e+=" CredAcc='"+this.CredAcc.SelectedValue+"' ":this.GrBody.TableColumns.Contains("CreditAccount_Key")&&!i.e.StringIsNullOrEmpty(this.GrBody.Table[t].CreditAccount_Key)&&(e+=" CredAcc='"+this.GrBody.Table[t].CreditAccount_Key.toString()+"' ");for(var n=1;n<this.GrBody.Columns.length;n++)this.GrBody.Columns[n].DisplayMember.toLowerCase().Contains("dcccnid")&&!i.e.StringIsNullOrEmpty(this.GrBody.Table[t][this.GrBody.Columns[n].ValueMember])&&(e+=this.GrBody.Columns[n].DisplayMember+"='"+this.GrBody.Table[t][this.GrBody.Columns[n].ValueMember].toString()+"' ");if(e+=" Amount='"+this.GrBody.Table[t].Percentage.toString()+"'  >",!i.e.StringIsNullOrEmpty(this.GrBody.Table[t].Detailsxml)){var a=new i.f;if(a.ReadXml(this.GrBody.Table[t].Detailsxml),a.Tables.length>0&&a.Columns[0].Contains("Amount")&&a.Tables[0].length>0)for(var r=0;r<a.Tables[0].length;r++)e+="&lt;DetRow  Amount='"+a.Tables[0][r].Amount.toString()+"' Date='",e+=new Date(a.Tables[0][r].Date).ToString("dd/MMM/yyyy")+"' />"}e+="&lt;/Rows>"}return(e+="&lt;/XML>").toString()}},{key:"GetXML",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t="";t+=e?"<XML":"&lt;XML",i.e.IsEmpty(this.NoofCheques.Text)||(t+=" Months='"+this.NoofCheques.Text+"' "),i.e.IsEmpty(this.Repeat.SelectedValue)||(t+=" BasedOn='"+this.Repeat.SelectedValue+"' "),t+=" StartDate='"+this.CheqStartDate.Date.ToString("dd/MMM/yyyy")+"' ",t+=" EndDate='"+this.CheqEndDate.Date.ToString("dd/MMM/yyyy")+"' >";for(var n=0;n<this.GrBody.Table.length;n++)if(!i.e.IsEmpty(this.GrBody.Table[n].Percentage)&&parseFloat(this.GrBody.Table[n].Percentage.toString())>0){t+=e?"<Rows ":"&lt;Rows ",this.DebitAcc.Visible?t+=" DebitAcc='"+this.DebitAcc.SelectedValue+"' ":this.GrBody.TableColumns.Contains("DebitAccount_Key")&&!i.e.IsEmpty(this.GrBody.Table[n].DebitAccount_Key)&&(t+=" DebitAcc='"+this.GrBody.Table[n].DebitAccount_Key.toString()+"' "),this.CredAcc.Visible?t+=" CredAcc='"+this.CredAcc.SelectedValue+"' ":this.GrBody.TableColumns.Contains("CreditAccount_Key")&&!i.e.IsEmpty(this.GrBody.Table[n].CreditAccount_Key)&&(t+=" CredAcc='"+this.GrBody.Table[n].CreditAccount_Key.toString()+"' ");for(var a=1;a<this.GrBody.Columns.length;a++)this.GrBody.Columns[a].DisplayMember.toLowerCase().Contains("dcccnid")&&!i.e.IsEmpty(this.GrBody.Table[n][this.GrBody.Columns[a].ValueMember])&&(t+=this.GrBody.Columns[a].DisplayMember+"='"+this.GrBody.Table[n][this.GrBody.Columns[a].ValueMember].toString()+"' ");if(t+=" Amount='"+this.GrBody.Table[n].Percentage.toString()+"'  >",!i.e.IsEmpty(this.GrBody.Table[n].Detailsxml)){var r=[];if(r.ReadXml(this.GrBody.Table[n].Detailsxml.toString()),r.Tables.length>0&&r.Columns[0].Contains("Amount")&&r.Tables[0].length>0)for(var s=0;s<r.Tables[0].length;s++)t+=e?"<DetRow ":"&lt;DetRow ",t+=" Amount='"+r.Tables[0][s].Amount.toString()+"' Date='",t+=new Date(r.Tables[0][s].Date.toString()).ToString("dd/MMM/yyyy")+"' />"}t+=e?"</Rows>":"&lt;/Rows>"}return(t+=e?"</XML>":"&lt;/XML>").toString()}},{key:"OnSave",value:function(e){if("Cancel"==e)a.a.page.HideDialog();else if("TextChanged"!=e||this.GenChqVis){if("Distribute"!=e||this.oparent.IsInventoryVoucher||this.GenChqVis)if("SelectedDateChanged"!=e||this.GenChqVis){if("Gnenerate"==e){if(i.e.StringIsNullOrEmpty(this.NoofCheques.Text))return this.DisplayMessage="Please enter "+this.NoofCheques.Label,void(this.MessageVisibility=!0);if(!i.e.IsNum(this.NoofCheques.Text))return this.DisplayMessage="Invalid "+this.NoofCheques.Label,void(this.MessageVisibility=!0);if(parseInt(this.NoofCheques.Text)<=0)return this.DisplayMessage="Please enter "+this.NoofCheques.Label+" greater than zero",void(this.MessageVisibility=!0);if(i.e.StringIsNullOrEmpty(this.Amount.Text))return this.DisplayMessage="Please enter "+this.Amount.Label,void(this.MessageVisibility=!0);if(!i.e.IsNum(this.Amount.Text))return this.DisplayMessage="Invalid "+this.Amount.Label,void(this.MessageVisibility=!0);if(parseFloat(this.Amount.Text)<=0)return this.DisplayMessage="Please enter "+this.Amount.Label+" greater than zero",void(this.MessageVisibility=!0);if(null==this.FirstChequeNo.Text||""==this.FirstChequeNo.Text.trim())return this.DisplayMessage="Please enter First Cheque No",void(this.MessageVisibility=!0);if(!i.e.IsNum(this.FirstChequeNo.Text))return this.DisplayMessage="Invalid First Cheque No",void(this.MessageVisibility=!0);if(null!=this.FirstChequeNo.Text&&parseInt(this.FirstChequeNo.Text)<=0)return this.DisplayMessage="Please enter First Cheque No greater than zero",void(this.MessageVisibility=!0);if(this.DebitAcc.Visible&&0==this.DebitAcc.SelectedValue)return this.DisplayMessage="Select "+this.DebitAcc.Label,void(this.MessageVisibility=!0);if(this.CredAcc.Visible&&0==this.CredAcc.SelectedValue)return this.DisplayMessage="Select "+this.CredAcc.Label,void(this.MessageVisibility=!0);this.GenerateChequeNos()}else if("OK"==e){if(null==this.NoofCheques.Text||""==this.NoofCheques.Text.trim())return this.DisplayMessage="Please enter "+this.NoofCheques.Label,void(this.MessageVisibility=!0);if(!i.e.IsNum(this.NoofCheques.Text))return this.DisplayMessage="Invalid "+this.NoofCheques.Label,void(this.MessageVisibility=!0);if(null!=this.NoofCheques.Text&&parseInt(this.NoofCheques.Text)<=0)return this.DisplayMessage="Please enter "+this.NoofCheques.Label+" greater than zero",void(this.MessageVisibility=!0);if(this.GenChqVis){if(null==this.FirstChequeNo.Text||""==this.FirstChequeNo.Text.trim())return this.DisplayMessage="Please enter First Cheque No",void(this.MessageVisibility=!0);if(!i.e.IsNum(this.FirstChequeNo.Text))return this.DisplayMessage="Invalid First Cheque No",void(this.MessageVisibility=!0);if(null!=this.FirstChequeNo.Text&&parseInt(this.FirstChequeNo.Text)<=0)return this.DisplayMessage="Please enter First Cheque No greater than zero",void(this.MessageVisibility=!0)}else{if(this.oparent.ScreenObject.Preferences.ContainsKey("Prepaymentdate")&&"True"==this.oparent.ScreenObject.Preferences.Prepaymentdate&&this.CheqStartDate.Date<this.oparent.DocumentDate)return this.DisplayMessage="Start date can not be less than document date.",void(this.MessageVisibility=!0);if(this.DebitAcc.Visible&&0==this.DebitAcc.SelectedValue)return this.DisplayMessage="Select "+this.DebitAcc.Label,void(this.MessageVisibility=!0);if(this.CredAcc.Visible&&0==this.CredAcc.SelectedValue)return this.DisplayMessage="Select "+this.CredAcc.Label,void(this.MessageVisibility=!0);for(var t=0,n=0,r=0;r<this.GrBody.Table.length;r++)if(i.e.DoubleTryParse(this.GrBody.Table[r].Percentage)>0){if(this.GrBody.TableColumns.Contains("DebitAccount_Key")&&i.e.StringIsNullOrEmpty(this.GrBody.Table[r].DebitAccount_Key)){var s=this.GrBody.Columns.find((function(e){return"DebitAccount"==e.DisplayMember}));return this.DisplayMessage=s?"Select "+s.Header+"at row no."+(r+1):"Select Accountat row no."+(r+1),void(this.MessageVisibility=!0)}if(this.GrBody.TableColumns.Contains("CreditAccount_Key")&&i.e.StringIsNullOrEmpty(this.GrBody.Table[r].CreditAccount_Key))return s=this.GrBody.Columns.find((function(e){return"CreditAccount"==e.DisplayMember})),this.DisplayMessage=s?"Select "+s.Header+"at row no."+(r+1):"Select Accountat row no."+(r+1),void(this.MessageVisibility=!0);t+=parseFloat(this.GrBody.Table[r].Percentage),""!=this.GrBody.Table[r].Amount.toString()&&(n+=parseInt(this.GrBody.Table[r].Amount.toString()))}if(t=parseFloat(t.ToString("N2")),n.ToString("N2")!=i.e.DoubleTryParse(this.Amount.Text).ToString("N2"))return this.DisplayMessage="Amount not equal.",void(this.MessageVisibility=!0)}this.IsDataSaved=!0,this.GenChqVis&&this.GenerateChequeNos(),a.a.page.HideDialog()}}else i.e.IsNum(this.NoofCheques.Text)&&parseInt(this.NoofCheques.Text)>0&&(this.CheqEndDate.Date=this.CheqStartDate.Date.AddMonths(parseInt(this.NoofCheques.Text)).AddDays(-1));else if(i.e.DoubleTryParse(this.GrBody.SelectedItem.Amount)>0){var o=new m.ShowJVViewModel;o.ShowJVViewModel_1(this,3),a.a.page.ShowDialog(o,b.ShowJVComponent)}}else i.e.IsNum(this.NoofCheques.Text)&&parseInt(this.NoofCheques.Text)>0&&(this.CheqEndDate.Date=this.CheqStartDate.Date.AddMonths(parseInt(this.NoofCheques.Text)).AddDays(-1))}},{key:"CalcPDCAmt",value:function(){for(var e=0,t=0;t<this.GrBody.Table.length;t++)i.e.StringIsNullOrEmpty(this.GrBody.Table[t].Amount)||(e+=parseFloat(this.GrBody.Table[t].Amount));return e}},{key:"GenerateChequeNos",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t="";this.oparent.SetFocusongrid=!0;var n="";this.oparent.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")||this.oparent.IsInventoryVoucher&&this.GrBody.TableColumns.Contains("CreditAccount_Key")?n="CreditAccount_Key":(this.oparent.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")||this.oparent.IsInventoryVoucher&&this.GrBody.TableColumns.Contains("DebitAccount_Key"))&&(n="DebitAccount_Key");var s=this.CheqStartDate.Date;this.oparent.IsInventoryVoucher||this.oparent.GetEmptyRowPosition(this.oparent.ScreenObject.GridDataObj,n);var o=1,c=0;null!=this.Repeat.SelectedValue&&""!=this.Repeat.SelectedValue&&parseInt(this.Repeat.SelectedValue)>0&&(o=parseInt(this.Repeat.SelectedValue));var l=!1,u={},d="",D="";if(this.oparent.IsInventoryVoucher&&!this.IsPrepayment){this.DebitAcc.Visible&&this.DebitAcc.SelectedValue>0?D=this.DebitAcc.Text:this.CredAcc.Visible&&this.CredAcc.SelectedValue>0&&(D=this.CredAcc.Text);for(var h=0;h<this.GrBody.Table.length;h++)""!=i.e.StringValue(this.GrBody.Table[h].StatusID)&&"370"!=this.GrBody.Table[h].StatusID.toString()||(this.GrBody.Table.Remove(this.GrBody.Table[h]),h--)}else if(!this.IsPrepayment&&a.a.SessionManager.Preferences.ContainsKey("On")&&"True"==a.a.SessionManager.Preferences.On&&this.CredAcc.SelectedValue>0){var S=this.oparent.ScreenObject.IsBillWiseAccount(this.CredAcc.SelectedValue);null!=S&&S.Tables.length>0&&S.Tables[0].length>0&&(l=!!Object(r.j)(S.Tables[0][0].IsBillwise),d=S.Tables[0][0].AccountCode.toString(),D=S.Tables[0][0].AccountName.toString(),l&&this.AdjustBills&&(u=this.oparent.ScreenObject.GetBillWiseDetails(this.CredAcc.SelectedValue,"",!0,"",0,null,this.oparent.DocumentDate)))}var m=0;if(this.oparent.IsInventoryVoucher&&!this.IsPrepayment||this.GenChqVis){c=parseFloat(this.Amount.Text)/parseFloat(this.NoofCheques.Text),this.oparent.IsInventoryVoucher&&(c=i.e.Round(c,parseInt(this.Dedimals)));var b=0;for(m=0;m<parseInt(this.NoofCheques.Text);m++)m>0&&(s=this.CheqStartDate.Date.AddMonths(o*m)),m==parseInt(this.NoofCheques.Text)-1&&(c=i.e.Round(parseFloat(this.Amount.Text)-b,parseInt(this.Dedimals))),b+=c,this.AddRows(D,d,c,m,0,s,l,u)}else{var C=2,y=this.oparent.ScreenObject.ColumnSource.find((function(e){return"amount"==e.DisplayMember.toLowerCase()}));y&&""!=y.DecimalPoints&&(C=parseInt(y.DecimalPoints)),t+="<PrePaymentXML>";var p=0,g=0,f=parseFloat(this.Amount.Text)/(this.CheqEndDate.Date.Subtract(this.CheqStartDate.Date).Days+1);for("1"==this.Repeat.SelectedValue&&(g=this.CalculateMonths()>0?i.e.Round(parseFloat(this.Amount.Text)/this.CalculateMonths(),C):parseFloat(this.Amount.Text));s<=this.CheqEndDate.Date;){if(p+=c=0==m?s.getMonth()==this.CheqEndDate.Date.getMonth()&&s.getFullYear()==this.CheqEndDate.Date.getFullYear()?parseFloat(this.Amount.Text):1==s.getDate()?"1"==this.Repeat.SelectedValue?g:i.e.Round(f*s.DaysInMonth(),C):i.e.Round(f*(s.DaysInMonth()-s.getDate()+1),C):s.AddMonths(1)>this.CheqEndDate.Date?parseFloat(this.Amount.Text)-p:"1"==this.Repeat.SelectedValue?g:i.e.Round(f*s.DaysInMonth(),C),this.GenChqVis)this.AddRows(D,d,c,m,0,s,l,u);else{t+="<Row Date='"+s.ToString("dd/MMM/yyyy")+"' >";for(var O=0;O<this.GrBody.Table.length;O++)if(i.e.DoubleTryParse(this.GrBody.Table[O].Percentage)>0){var I=i.e.Double(this.GrBody.Table[O].Amount.toString())*(100/i.e.Double(this.Amount.Text));t+="<data ",this.DebitAcc.Visible?t+=" DebitAcc='"+this.DebitAcc.SelectedValue+"' ":this.GrBody.TableColumns.Contains("DebitAccount_Key")&&!i.e.StringIsNullOrEmpty(this.GrBody.Table[O].DebitAccount_Key)&&(t+=" DebitAcc='"+this.GrBody.Table[O].DebitAccount_Key.toString()+"' "),this.CredAcc.Visible?t+=" CredAcc='"+this.CredAcc.SelectedValue+"' ":this.GrBody.TableColumns.Contains("CreditAccount_Key")&&!i.e.StringIsNullOrEmpty(this.GrBody.Table[O].CreditAccount_Key)&&(t+=" CredAcc='"+this.GrBody.Table[O].CreditAccount_Key.toString()+"' "),t+=" Query='";for(var T=1;T<this.GrBody.Columns.length;T++)this.GrBody.Columns[T].DisplayMember.toLowerCase().Contains("dcccnid")&&!i.e.StringIsNullOrEmpty(this.GrBody.Table[O][this.GrBody.Columns[T].ValueMember])&&(t+=this.GrBody.Columns[T].DisplayMember+"="+this.GrBody.Table[O][this.GrBody.Columns[T].ValueMember].toString()+", ");if(t+="' ",i.e.StringIsNullOrEmpty(this.GrBody.Table[O].Detailsxml))t+=" Amount='"+i.e.Round(c*I/100,C)+"'  />";else{var j=new i.f;j.ReadXml(this.GrBody.Table[O].Detailsxml),j.Tables.length>0&&j.Columns[0].Contains("Amount")&&j.Tables[0].length>m&&!i.e.StringIsNullOrEmpty(j.Tables[0][m].Amount)?t+=" Amount='"+j.Tables[0][m].Amount.toString()+"'  />":t+=" Amount='"+i.e.Round(c*I/100,C)+"'  />"}}t+="</Row>"}s=0==m?s.AddDays(s.DaysInMonth()-s.getDate()+1):s.AddMonths(1),m++}e&&(t+=this.GetXML(!0)),t+="</PrePaymentXML>"}return t.toString()}},{key:"CalculateMonths",value:function(){try{for(var e=0,t=0,n=this.CheqStartDate.Date;this.CheqEndDate.Date>n;)0==e&&0==t?1==n.getDate()?(e++,n=n.AddMonths(1)):(t=n.DaysInMonth()-n.getDate()+1,n=n.AddDays(t)):(n=n.AddMonths(1))>this.CheqEndDate.Date?n.AddMonths(-1).DaysInMonth()==this.CheqEndDate.Date.getDate()?e++:t+=this.CheqEndDate.Date.getDate():e++;return t>0&&(this.CheqStartDate.Date.iMonth()==this.CheqEndDate.Date.iMonth()||this.CheqStartDate.Date.getDate()==this.CheqEndDate.Date.getDate()+1?t==this.CheqStartDate.Date.DaysInMonth()||t==this.CheqEndDate.Date.DaysInMonth()?e++:e+=t/(new Date).DaysInMonth():1==this.CheqStartDate.Date.getDate()?t==this.CheqEndDate.Date.DaysInMonth()?e++:e+=t/this.CheqEndDate.Date.DaysInMonth():this.CheqEndDate.Date.getDate()==this.CheqEndDate.Date.DaysInMonth()?e+=t/this.CheqStartDate.Date.DaysInMonth():e+=t/30),e}catch(a){return 0}}},{key:"AddRows",value:function(e,t,n,r,s,o,c,l){var u=this,d=(parseInt(this.FirstChequeNo.Text)+r).toString();if(this.FirstChequeNo.Text.length-d.length>0){for(var D=this.FirstChequeNo.Text.length-d.length,h="",S=0;S<D;S++)h+="0";d=h+d}var m=null,b=null;this.oparent.IsInventoryVoucher?(b=this.GrBody.TableColumns,m=this.GrBody.NewRow()):(b=this.oparent.ScreenObject.GridDataColumns,m=this.oparent.ScreenObject.GridDataObj.NewRow()),this.oparent.IsInventoryVoucher?this.GrBody.TableColumns.Contains("DebitAccount_Key")&&this.DebitAcc.Visible?(m.DebitAccount_Key=this.DebitAcc.SelectedValue,this.GrBody.TableColumns.Contains("DebitAccount")&&(m.DebitAccount=this.DebitAcc.Text)):this.GrBody.TableColumns.Contains("CreditAccount_Key")&&this.CredAcc.Visible&&(m.CreditAccount_Key=this.CredAcc.SelectedValue,this.GrBody.TableColumns.Contains("CreditAccount")&&(m.CreditAccount=this.CredAcc.Text)):19==this.oparent.ScreenObject.DocumentType?(m.CreditAccount_Key=this.CredAcc.SelectedValue,this.oparent.ScreenObject.GridDataColumns.Contains("CreditAccount")?m.CreditAccount=e:this.oparent.ScreenObject.GridDataColumns.Contains("AccountName")&&(m.AccountName=e),this.oparent.ScreenObject.GridDataColumns.Contains("AccountCode")&&(m.AccountCode=t),this.oparent.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")?(m.DebitAccount_Key=this.DebitAcc.SelectedValue,this.oparent.ScreenObject.GridDataColumns.Contains("DebitAccount")&&(m.DebitAccount=this.DebitAcc.Text)):null!=this.oparent.ScreenObject.DebitAccount&&(this.oparent.ScreenObject.DebitAccount.SelectedValue=this.DebitAcc.SelectedValue)):14==this.oparent.ScreenObject.DocumentType&&(m.DebitAccount_Key=this.CredAcc.SelectedValue,this.oparent.ScreenObject.GridDataColumns.Contains("DebitAccount")?m.DebitAccount=e:this.oparent.ScreenObject.GridDataColumns.Contains("AccountName")&&(m.AccountName=e),this.oparent.ScreenObject.GridDataColumns.Contains("AccountCode")&&(m.AccountCode=t),this.oparent.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")?(m.CreditAccount_Key=this.DebitAcc.SelectedValue,this.oparent.ScreenObject.GridDataColumns.Contains("CreditAccount")&&(m.CreditAccount=this.DebitAcc.Text)):null!=this.oparent.ScreenObject.CreditAccount&&(this.oparent.ScreenObject.CreditAccount.SelectedValue=this.DebitAcc.SelectedValue)),m.ChequeBankName=this.PayeeBank.Visible?this.PayeeBank.Text:this.ChequeBankName.Text,m.ChequeNumber=d,m.Amount=n,b.Contains("ChequeDate")&&(m.ChequeDate=o.ToString(a.a.SessionManager.Preferences["Date Format"]),m.ChequeDate_Key=o),b.Contains("ChequeMaturityDate")&&(m.ChequeMaturityDate=o.ToString(a.a.SessionManager.Preferences["Date Format"]),m.ChequeMaturityDate_Key=o),m.Table.Rows.InsertAt(m,s+r),this.oparent.ScreenObject.UpdateSequence(),b.Contains("Type")&&(m.Type=c);var C="";19==this.oparent.ScreenObject.DocumentType?C="CreditAccount_Key":14==this.oparent.ScreenObject.DocumentType&&(C="DebitAccount_Key");var y=this.oparent.ScreenObject.ColumnSource.filter((function(e){return null!=e.ValueMember&&e.ValueMember.toLowerCase()==C.toLowerCase()}));if(y.length>0)for(var p,g=function(e){var t=y[e];(p=u.oparent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&e.LocalReference==t.ID}))).length>0&&!i.e.StringIsNullOrEmpty(t.ValueMember)&&!i.e.StringIsNullOrEmpty(m[t.ValueMember])&&(0==r?u.oparent.ScreenObject.GetLinkReferenceData(parseInt(t.ID),u.oparent.DocumentID,parseInt(m[t.ValueMember]),Date.Today(),"",t.CostCenterID,m):p.forEach((function(e){var t=u.oparent.ScreenObject.ColumnSource.find((function(t){return t.ID==e.CostCenterColID}));t&&(null!=t.DisplayMember&&b.Contains(t.DisplayMember)&&(m[t.DisplayMember]=m.Table.Rows[s][t.DisplayMember]),null!=t.ValueMember&&b.Contains(t.ValueMember)&&(m[t.ValueMember]=m.Table.Rows[s][t.ValueMember]),null!=t.ValueBinding&&b.Contains(t.ValueBinding)&&(m[t.ValueBinding]=m.Table.Rows[s][t.ValueBinding]))})))},f=0;f<y.length;f++)g(f);c&&this.AdjustBills&&this.FlllXml(l,n,m)}},{key:"FlllXml",value:function(e,t,n){var r="";i.e.IntTryParse(this.oparent.ScreenObject.Preferences.DecimalsBillWise)>0?r=this.oparent.ScreenObject.Preferences.DecimalsBillWise:a.a.SessionManager.Preferences.ContainsKey("DecimalsinAmount")&&(r=a.a.SessionManager.Preferences.DecimalsinAmount);var s,o="";o+="<BillWise> ";for(var c=0;c<e.Tables[0].length&&!(t<=0);c++){var l=0;if(i.e.StringIsNullOrEmpty(e.Tables[0][c].Amount)||(l=parseFloat(e.Tables[0][c].Amount)),i.e.StringIsNullOrEmpty(e.Tables[0][c].Paid)||(l-=parseFloat(e.Tables[0][c].Paid)),l>0){var u=0;t>l?(u=l,t-=l,e.Tables[0][c].Paid=e.Tables[0][c].Amount):(u=t,e.Tables[0][c].Paid=parseFloat(e.Tables[0][c].Paid)+t,t=0),e.Columns[0].Contains("ExchgRate")&&null!=e.Tables[0][c].ExchgRate&&!i.e.StringIsNullOrEmpty(e.Tables[0][c].ExchgRate)&&"0"==e.Tables[0][c].ExchgRate.toString()&&(e.Tables[0][c].ExchgRate="1"),o+="<Row ",o+='DocSeqNo="'+n.DocSeqNo.toString()+'" ',o+='AccountID="'+this.CredAcc.SelectedValue.toString()+'" ',19==this.oparent.ScreenObject.DocumentType?(o+='AmountFC="-'+u+'" ',o+='AdjAmount="-'+u+'" ',o+='AdjExchRT="1" '):(o+='AmountFC="'+u+'" ',o+='AdjAmount="'+u+'" ',o+='AdjExchRT="1" '),o+='AdjCurrID="1" ',o+='IsNewReference="0" ',o+='RefDocNo="'+e.Tables[0][c].DocNo.toString()+'" ',o+='RefStatusID="'+e.Tables[0][c].StatusID.toString()+'" ',o+='RefDocSeqNo="'+e.Tables[0][c].DocSeqNo.toString()+'" ',i.e.StringIsNullOrEmpty(e.Tables[0][c].DocDate)||(o+='RefDocDate="'+new Date(e.Tables[0][c].DocDate).ToString("dd/MMM/yyyy")+'" '),i.e.StringIsNullOrEmpty(e.Tables[0][c].DocDueDate)||(o+='RefDocDueDate="'+new Date(e.Tables[0][c].DocDueDate).ToString("dd/MMM/yyyy")+'" '),o+='Narration="" ',o+='IsDocPDC="0" >',o+=" </Row>"}}t>0&&(o+="<Row ",o+='DocSeqNo="'+n.DocSeqNo.toString()+'" ',o+='AccountID="'+this.CredAcc.SelectedValue.toString()+'" ',s=""!=r?t.ToString("N"+r):t.toString(),19==this.oparent.ScreenObject.DocumentType?(o+='AmountFC="-'+s+'" ',o+='AdjAmount="-'+s+'" '):(o+='AmountFC="'+s+'" ',o+='AdjAmount="'+s+'" '),o+='AdjCurrID="1" ',o+='AdjExchRT="1" ',o+='IsNewReference="1" ',o+='Narration="" ',o+='IsDocPDC="0" ',o+=" ></Row>");o+=" </BillWise>",n.ExtraXML=o.toString()}},{key:"SelectedValue",get:function(){return this._selectedvalue},set:function(e){this._selectedvalue!=e&&(this._selectedvalue=e,this.SelectedValueChanged=!this.SelectedValueChanged)}}]),n}(s.b)},sDFv:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n("ouML"),i=n("Do2H"),r=n("vgHJ"),s=function(){function e(t,n,a,i,r,s){_classCallCheck(this,e),this.LeftVisible=!0,this.RightVisible=!0,this.IsApproved=!1,this.IsPending=!1,this.IsRejected=!1,this.IsSet=!1,this.BgColor="#fff",this.LeftLineBrush="#707070",this.RightLineBrush="#707070",this.LevelID=0,this.WID=0,this.ccid=0,this.DOcId=0,this.ClassName="WFLevelDoc",this.LevelID=n,this.WID=t,this.LevelName=a,this.ccid=i,this.DOcId=r,this.ccDate=s}return _createClass(e,[{key:"OnButtonClick",value:function(e){if("Level"==e){var t=new a.DocumentDraftsViewModel(this,4);i.a.page.ShowDialog(t,r.DocumentDraftsComponent)}}}]),e}()},utDZ:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var a=n("mrSG"),i=n("ScVY"),r=n("ockk"),s=n("NkMH"),o=n("4HhE"),c=n("Do2H"),l=n("eQJW"),u=n("8B8H"),d=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){var n;_classCallCheck(this,i),(n=t.call(this)).ColumnSpan="4",n.OrganizationDataObj=new u.a,n.Module="CRM",n.Visible=!0,n.cmnItem_Click=new o.b,n.AddOrganization=new o.b,n.res="",Logger.InfoLog("ViewDemoKitViewModel::Entering ViewDemoKitViewModel");try{n.ClassName="ViewOrganizationViewModel",n.Parent=e,n.CostCenterID=e.CostCenterID,n.cmnItem_Click.Subscribe(_assertThisInitialized(n),"OnCmnItem_Click"),n.AddOrganization.Subscribe(_assertThisInitialized(n),"OnAddOrganization");var a,d=c.a.crmService.GetFeedbackDetails(120),D=[];if(D=d.Tables[0],n.OrganizationDataObj.Table=[],n.OrganizationDataObj.TableColumns.push("Customer"),n.OrganizationDataObj.TableColumns.push("CustomerID"),n.OrganizationDataObj.TableColumns.push("ContactID"),n.OrganizationDataObj.TableColumns.push("ContactName"),n.OrganizationDataObj.TableColumns.push("JobTitle"),n.OrganizationDataObj.TableColumns.push("Department"),n.OrganizationDataObj.TableColumns.push("Salutation"),n.OrganizationDataObj.TableColumns.push("SalutationID"),73!=e.CostCenterID&&35!=e.DocumentType){n.OrganizationDataObj.TableColumns.push("CytomedDivision"),n.OrganizationDataObj.TableColumns.push("CytomedDivision_Key"),n.OrganizationDataObj.TableColumns.push("Territory"),n.OrganizationDataObj.TableColumns.push("Territory_Key"),n.OrganizationDataObj.TableColumns.push("City"),n.OrganizationDataObj.TableColumns.push("City_Key"),n.OrganizationDataObj.TableColumns.push("Country"),n.OrganizationDataObj.TableColumns.push("Country_Key");for(var h=1;h<=50;h++)n.OrganizationDataObj.TableColumns.push("Alpha"+h);for(var S=1;S<=50;S++)n.OrganizationDataObj.TableColumns.push("CCNID"+S),n.OrganizationDataObj.TableColumns.push("CCNID"+S+"_Key")}else n.OrganizationDataObj.TableColumns.push("MiddleName"),n.OrganizationDataObj.TableColumns.push("LastName"),n.OrganizationDataObj.TableColumns.push("Phone1"),n.OrganizationDataObj.TableColumns.push("Email1"),n.OrganizationDataObj.TableColumns.push("Phone2"),n.OrganizationDataObj.TableColumns.push("Email2"),n.OrganizationDataObj.TableColumns.push("Company"),n.OrganizationDataObj.TableColumns.push("Fax");if(n.OrganizationDataObj.Columns=[],(a=new r.a).Header=c.a.GetResource("Customer"),a.DisplayMember="Customer",a.DataType="TEXTBOX",a.Width=150,a.IsVisible=73!=e.CostCenterID&&35!=e.DocumentType,a.ReadOnly=!0,n.ColumnSource.push(a),(a=new r.a).Header=c.a.GetResource("ContactName"),a.DisplayMember="ContactName",a.DataType="TEXTBOX",a.Width=150,a.IsVisible=!0,a.ReadOnly=!0,n.ColumnSource.push(a),(a=new r.a).Header=c.a.GetResource("JobTitle"),a.DisplayMember="JobTitle",a.DataType="TEXTBOX",a.Width=150,a.IsVisible=!0,a.ReadOnly=!0,n.ColumnSource.push(a),(a=new r.a).Header=c.a.GetResource("Department"),a.DisplayMember="Department",a.DataType="TEXTBOX",a.Width=150,a.IsVisible=!0,a.ReadOnly=!0,n.ColumnSource.push(a),(a=new r.a).Header=c.a.GetResource("Salutation"),a.DisplayMember="Salutation",a.DataType="TEXTBOX",a.Width=150,a.IsVisible=!0,a.ReadOnly=!0,n.ColumnSource.push(a),73!=e.CostCenterID&&35!=e.DocumentType){(a=new r.a).Header=c.a.GetResource("CytomedDivision"),a.DisplayMember="CytomedDivision",a.DataType="TEXTBOX",a.Width=150,a.IsVisible=!0,a.ReadOnly=!0,n.ColumnSource.push(a),(a=new r.a).Header=c.a.GetResource("Country"),a.DisplayMember="Country",a.DataType="TEXTBOX",a.Width=150,a.IsVisible=!0,a.ReadOnly=!0,n.ColumnSource.push(a),(a=new r.a).Header=c.a.GetResource("City"),a.DisplayMember="City",a.DataType="TEXTBOX",a.Width=150,a.IsVisible=!0,a.ReadOnly=!0,n.ColumnSource.push(a),(a=new r.a).Header=c.a.GetResource("Territory"),a.DisplayMember="Territory",a.DataType="TEXTBOX",a.Width=150,a.IsVisible=!0,a.ReadOnly=!0,n.ColumnSource.push(a);for(var m=0;m<D.length;m++)"True"==D.Rows[m].IsVisible.toString()&&D.Rows[m].SysColumnName.toString().Contains("Alpha")&&((a=new r.a).Header=D.Rows[m].UserColumnName.toString(),a.DisplayMember=D.Rows[m].SysColumnName.toString(),a.DataType="TEXTBOX",a.Width=150,a.IsVisible=!0,a.ReadOnly=!0,n.ColumnSource.push(a)),"True"==D.Rows[m].IsVisible.toString()&&D.Rows[m].SysColumnName.toString().Contains("CCNID")&&((a=new r.a).Header=D.Rows[m].UserColumnName.toString(),a.DisplayMember=D.Rows[m].SysColumnName.toString(),a.CostCenterID=parseInt(D.Rows[m].COLUMNCOSTCENTERID.toString()),a.TypeID=1,a.DataType="LISTBOX",a.DisplayMember=D.Rows[m].SysColumnName.toString(),a.ValueMember=D.Rows[m].SysColumnName.toString()+"_Key",a.Width=170,a.IsVisible=!0,a.ReadOnly=!0,n.ColumnSource.push(a))}else(a=new r.a).Header="MiddleName",a.DisplayMember="MiddleName",a.DataType="TEXTBOX",a.Width=150,a.IsVisible=!0,a.ReadOnly=!0,n.ColumnSource.push(a),(a=new r.a).Header="LastName",a.DisplayMember="LastName",a.DataType="TEXTBOX",a.Width=150,a.IsVisible=!0,a.ReadOnly=!0,n.ColumnSource.push(a);if(73!=e.CostCenterID&&35!=e.DocumentType&&null!=d&&d.Tables.length>7&&d.Columns[7].Contains("GRIDORDER")&&d.Tables[7].length>0){n.ColumnSource.forEach((function(e){if(null!=e){var t=d.Tables[7];t.RowFilter="SYSCOLUMNNAME=='"+e.DisplayMember+"'",t.length>0&&(e.DisplayIndex=null!=t[0].GRIDORDER&&""!=t[0].GRIDORDER.toString()?parseInt(t[0].GRIDORDER)-1:e.DisplayIndex,e.IsVisible=null!=t[0].Visible&&""!=t[0].Visible.toString()?Object(l.j)(t[0].Visible):e.IsVisible,e.Width=null!=t[0].Width&&""!=t[0].Width.toString()?parseInt(t[0].Width):e.Width)}}));try{n.ColumnSource.sort((function(e,t){return e.DisplayIndex-t.DisplayIndex})).forEach((function(e){n.ColumnSource.push(e)}))}catch(b){Logger.ErrorLog("ViewDemoKitViewModel:: ViewDemoKitViewModel"+b.stack)}}n.ButtonCustomize=new s.a,c.a.SessionManager.HideUnathorizedAccess&&(n.ButtonCustomize.Visible=c.a.SessionManager.IsActionAssigned(88,"Customize_Organizer"))}catch(b){Logger.ErrorLog("ViewDemoKitViewModel:: ViewDemoKitViewModel"+b.stack)}return Logger.InfoLog("ViewDemoKitViewModel::Exiting ViewDemoKitViewModel"),n}return _createClass(i,[{key:"ViewOrganizationViewModel_1",value:function(){}},{key:"OnAddOrganization",value:function(e){return Object(a.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var a,i,r,s,o,l,u,d,D,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null==e&&(e=""),null==e){t.next=15;break}if("Search"!=e.toString()){t.next=14;break}return t.next=4,n.e(0).then(n.bind(null,"r9vo"));case 4:return a=t.sent,i=a.SearchContactComponent,t.next=8,n.e(110).then(n.bind(null,"86Y6"));case 8:r=t.sent,s=r.SearchContactViewModel,o=new s(this),c.a.page.ShowDialog(o,i,{ShowCenter:!0,HideHeader:!0}),t.next=15;break;case 14:e.toString();case 15:if(73!=this.Parent.CostCenterID&&35!=this.Parent.DocumentType||null==this.Parent){t.next=27;break}return t.next=18,n.e(0).then(n.bind(null,"7Mi5"));case 18:return l=t.sent,u=l.CasesContactComponent,t.next=22,Promise.resolve().then(n.bind(null,"+ryo"));case 22:d=t.sent,D=d.CasesContactViewModel,this.Parent.CasesContactVisibility=!0,h=new D(this,null),c.a.page.ShowDialog(h,u,{ShowCenter:!0,HideHeader:!1});case 27:case"end":return t.stop()}}),t,this)})))}},{key:"OnCmnItem_Click",value:function(e){var t=this;switch(Logger.InfoLog("ViewDemoKitViewModel::Entering OnCmnItem_Click"),e){case"Customize":break;case"EDIT":if((73==this.Parent.CostCenterID||35==this.Parent.DocumentType)&&null!=this.SelectedRow){null!=this.Parent.CasesContactViewModel&&(this.Parent.CasesContactViewModel.CasesContactVisibility=!0);var n=this.SelectedRow;""!=n.CustomerID.toString()&&(this.Parent.CasesContactViewModel.Contact.Text="",this.Parent.CasesContactViewModel.FirstName.Text=n.ContactName.toString(),this.Parent.CasesContactViewModel.MiddleName.Text=n.MiddleName.toString(),this.Parent.CasesContactViewModel.LastName.Text=n.LastName.toString(),this.Parent.CasesContactViewModel.JobTitle.Text=n.JobTitle.toString(),this.Parent.CasesContactViewModel.Dept.Text=n.Department.toString(),this.Parent.CasesContactViewModel.Salutation.SelectedValue=n.SalutationID.toString(),this.Parent.CasesContactViewModel.Company.Text=n.Company.toString(),this.Parent.CasesContactViewModel.Phone1.Text=n.Phone1.toString(),this.Parent.CasesContactViewModel.Email1.Text=n.Email1.toString(),this.Parent.CasesContactViewModel.Phone2.Text=n.Phone2.toString(),this.Parent.CasesContactViewModel.Email2.Text=n.Email2.toString(),this.Parent.CasesContactViewModel.Fax.Text=n.Fax.toString())}break;case"DELETE":if(null!=this.SelectedRow){if(""!=this.SelectedRow.ContactID.toString()){var a=this.lstContacts.find((function(e){return e.toString()==t.SelectedRow.ContactID.toString()}));null!=a&&this.lstContacts.Remove(a)}this.OrganizationDataObj.removeRowAt(this.SelectedRow)}}Logger.InfoLog("ViewDemoKitViewModel::Exiting OnCmnItem_Click")}},{key:"OnMessageCallBack",value:function(){this.res="Yes"}},{key:"onCanCmnItem_Click",value:function(e){return!0}},{key:"GetXML",value:function(){Logger.InfoLog("ViewDemoKitViewModel::Entering GetXML");try{var e="";e+="<XML>";for(var t=0;t<this.OrganizationData.length;t++)if(""!=this.OrganizationData[t].Customer.toString()||""!=this.OrganizationData[t].CustomerID.toString()){if(e+="<Row ",e+=' Rowno="'+t+'"',e+=' Customer="'+this.GetValidXml(this.OrganizationData[t].Customer.toString())+'"',e+=' CustomerID="'+this.OrganizationData[t].CustomerID+'"',e+=' ContactID="'+this.OrganizationData[t].ContactID+'"',e+=' ContactName="'+this.GetValidXml(this.OrganizationData[t].ContactName.toString())+'"',e+=' JobTitle="'+this.GetValidXml(this.OrganizationData[t].JobTitle.toString())+'"',e+=' Department="'+this.GetValidXml(this.OrganizationData[t].Department.toString())+'"',e+=' SalutationID="'+this.GetValidXml(this.OrganizationData[t].SalutationID.toString())+'"',73!=this.Parent.CostCenterID&&35!=this.Parent.DocumentType){e+=' Country="'+this.GetValidXml(this.OrganizationData[t].Country_Key.toString())+'"',e+=' City="'+this.GetValidXml(this.OrganizationData[t].City_Key.toString())+'"',e+=' CytomedDivision="'+this.GetValidXml(this.OrganizationData[t].CytomedDivision_Key.toString())+'"',e+=' Territory="'+this.GetValidXml(this.OrganizationData[t].Territory_Key.toString())+'"';for(var n=1;n<=50;n++)e+=" Alpha"+n+'="'+this.GetValidXml(this.OrganizationData[t]["Alpha"+n].toString())+'"';for(var a=1;a<=50;a++)null!=this.OrganizationData[t]["CCNID"+a+"_Key"]&&""!=this.OrganizationData[t]["CCNID"+a+"_Key"].toString()?e+=" CCNID"+a+'="'+this.OrganizationData[t]["CCNID"+a+"_Key"].toString()+'"':e+=" CCNID"+a+'="1"'}else e+=' Company="'+this.GetValidXml(this.OrganizationData[t].Company.toString())+'"',e+=' Phone1="'+this.GetValidXml(this.OrganizationData[t].Phone1.toString())+'"',e+=' Email1="'+this.GetValidXml(this.OrganizationData[t].Email1.toString())+'"',e+=' Phone2="'+this.GetValidXml(this.OrganizationData[t].Phone2.toString())+'"',e+=' Email2="'+this.GetValidXml(this.OrganizationData[t].Email2.toString())+'"',e+=' Fax="'+this.GetValidXml(this.OrganizationData[t].Fax.toString())+'"',e+=' FirstName="'+this.GetValidXml(this.OrganizationData[t].ContactName.toString())+'"',e+=' LastName="'+this.GetValidXml(this.OrganizationData[t].LastName.toString())+'"',e+=' MiddleName="'+this.GetValidXml(this.OrganizationData[t].MiddleName.toString())+'"',"0"==this.OrganizationData[t].ContactID.toString()?e+=' Action="NEW"':e+=' Action="MODIFY"';e+="></Row>  "}return e+="</XML>",35==this.Parent.DocumentType?e.toString().Replace("XML","ContactXML"):e.toString()}catch(i){return""}Logger.InfoLog("ViewDemoKitDataViewModel::Exiting GetXML")}},{key:"GetValidXml",value:function(e){return(e=(e=(e=e.Replace("&","&amp;")).Replace("'","&apos;&apos;")).Replace('"',"&quot;")).Replace("<","&lt;")}},{key:"GetValidXmlReserve",value:function(e){return(e=(e=(e=e.Replace("&amp;","&")).Replace("''","'")).Replace("&quot;",'"')).Replace("&lt;","<")}},{key:"LoadData",value:function(e){try{for(var t=0;t<e.length;t++){var n=this.OrganizationDataObj.NewRow();if(this.lstContacts.push(null!=e[t].ContactID&&""!=e[t].ContactID.toString()?parseInt(e.Rows[t].ContactID.toString()):0),n.ContactID=e[t].ContactID.toString(),n.ContactName=e[t].ContactName.toString(),n.JobTitle=e[t].JobTitle.toString(),n.Department=e[t].Department.toString(),n.CustomerID=e[t].CustomerID.toString(),n.Customer=e[t].Customer.toString(),n.Salutation=e[t].SalutationName.toString(),n.SalutationID=e[t].Salutation.toString(),73!=this.Parent.CostCenterID&&35!=this.Parent.DocumentType){n.Country=e[t].Co.toString(),n.City=e[t].Ci.toString(),n.CytomedDivision=e[t].D.toString(),n.Territory=e[t].T.toString(),n.Country_Key=e[t].Country.toString(),n.City_Key=e[t].City.toString(),n.CytomedDivision_Key=e[t].CytomedDivision.toString(),n.Territory_Key=e[t].Territory.toString();for(var a=1;a<=50;a++)n["Alpha"+a]=this.GetValidXmlReserve(e[t]["Alpha"+a].toString());for(var i=1;i<=50;i++)"1"!=e[t]["CCNID"+i].toString()&&(n["CCNID"+i]=this.GetValidXmlReserve(e.Rows[t]["NAME"+i].toString()),n["CCNID"+i+"_Key"]=e[t]["CCNID"+i].toString())}else n.Salutation=e[t].Salutation.toString(),n.SalutationID=e[t].SalutationID.toString(),n.MiddleName=e[t].MiddleName.toString(),n.LastName=e[t].LastName.toString(),n.Company=e[t].Company.toString(),n.Email1=e[t].Email1.toString(),n.Email2=e[t].Email2.toString(),n.Phone1=e[t].Phone1.toString(),n.Phone2=e[t].Phone2.toString(),n.Fax=e[t].Fax.toString();this.OrganizationDataObj.addRows(n)}}catch(r){}}},{key:"OrganizationData",get:function(){return this.OrganizationDataObj.Table}},{key:"angularGrid",get:function(){return this.OrganizationDataObj.angularGrid}},{key:"ColumnSource",get:function(){return this.OrganizationDataObj.Columns}}]),i}(i.b)},ybar:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a=n("Do2H"),i=n("Lp6j"),r=n("ScVY"),s=n("ZDA+"),o=n("6z9j"),c=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.apply(this,arguments)).WhereString="",e.PickerType="",e.TreeVisibility=!1,e}return _createClass(n,[{key:"Refresh",value:function(){null!=this.tree&&this.tree.length>0&&(this.tree[0].RefreshData=!0)}},{key:"GetSeqNosList",value:function(){if(null==this.SelectedNodes)return"";var e="";return this.SelectedNodes.forEach((function(t){e+=t.Id+","})),e.length>0?e=e.Remove(e.length-1,1):e+=0,e.toString()}},{key:"SearchPickerViewModel_2",value:function(e,t){this.SearchPickerViewModel(e,t,"","","")}},{key:"SearchPickerViewModel_3",value:function(e,t,n){this.SearchPickerViewModel(e,t,n,"","")}},{key:"SearchPickerViewModel_4",value:function(e,t,n,a){this.SearchPickerViewModel(e,t,n,a,"")}},{key:"SearchPickerViewModel",value:function(e,t,n,r,c){if(this.PickerType=t,this.ViewModel=e,"PRODUCTS"==t)this.TreeCCID=3,this.TreeID=20;else if("ACCOUNTS"==t)this.TreeCCID=2,this.TreeID=126;else if("CUSTOMERS"==t)this.TreeCCID=51,this.TreeID=141;else if("PACKAGE"==t)this.TreeCCID=62,this.TreeID=160;else if("REPORTS"==t)this.TreeCCID=200,this.TreeID=267;else if("DOCUMENTS"==t)this.TreeCCID=300,this.TreeID=410;else if("units"==t)this.TreeCCID=93,this.TreeID=262;else if("COSTCENTER"==t){this.TreeCCID=parseInt(n),n=r;var l=a.a.common.GetCostCenterGridViewList(this.TreeCCID,!1),u=l.Tables[0];if((u=u.filter((function(e){return 0==e.IsUserDefined}))).length>0)this.TreeID=parseInt(u[0].GridViewID);else{if(!(l.Tables[0].length>0))return void a.a.page.HideDialog();this.TreeID=parseInt(l.Tables[0][0].GridViewID)}}else if(t.startsWith("PRODUCTGROUPS")){this.TreeCCID=3;var d=t.split("~");this.TreeID=parseInt(d[1]),n="A.IsGroup=1"}var D=[];if(""!=c)for(var h=c.split(","),S=0;S<h.length;S++){if(i.e.IntTryParse(h[S])){var m=new s.a;m.Id=parseInt(h[S]),D.push(m)}}this.tree=[];var b=new o.a;b.TreeViewModel_6(this.TreeCCID,this,this.TreeID,n,D,""),b.HeaderVisiblity=!1,b.ViewsVisible=!1,this.tree.push(b),this.ViewModel=this.ViewModel,this.MessageVisibility=!1}},{key:"CommandController",value:function(e){null!=e&&"MouseDoubleClick"==e.toString()&&null!=this.SelectedNode&&(this.SelectedNode.IsGroup||(null==this.SelectedNodes?this.SelectedNodes=[]:this.SelectedNodes.Clear(),this.SelectedNodes.push(this.SelectedNode),a.a.page.HideDialog(),this.ViewModel.ParentCallBack(this)))}},{key:"OnOkClick",value:function(e){a.a.page.HideDialog(),this.ViewModel.ParentCallBack(this)}},{key:"OnCancelClick",value:function(e){a.a.page.HideDialog()}}]),n}(r.b)}}]);
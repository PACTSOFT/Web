(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{Rr92:function(t,e,s){"use strict";s.r(e),s.d(e,"UpdatePayTermsViewModel",(function(){return S}));var i=s("Do2H"),a=s("Lp6j"),o=s("eQJW"),r=s("ScVY"),n=s("n56n"),l=s("0/4Q"),h=s("JIg3"),D=s("EQd/"),u=s("8B8H"),d=s("P6ee"),c=s("ockk"),m=s("lUlH"),p=s("CUWK"),b=s("4HhE");class S extends r.b{constructor(t){if(super(),this.SavePostedDocument=new b.b,this._SelectAll=!1,this.Filter=new l.e,this.CopyRows=new D.d,this.IsCancelVisible=!1,this.Rows=[],this.Calltype=0,this.DocCCID=0,this.CCID=0,this.CompletionDateColName="",this.Columns="",this.Joins="","AddEditRenContractViewModel"==t)return this.IsCancelVisible=!1,void(this.Filter.Visible=!1);this.IsCancelVisible=!1,this.Filter.Visible=!1,this.DisplayName=t,this.PstDocGrid=new u.a,this.PartGrid=new u.a,this.onLoad(),this.FillSearchDetails()}get SelectAll(){return this._SelectAll}set SelectAll(t){t!=this._SelectAll&&(this._SelectAll=t,this.SelectAllRows())}get angularGrid(){return this.PstDocGrid.angularGrid}get PstDocGridTable(){return this.PstDocGrid.Table}get PstDocGridTableColumns(){return this.PstDocGrid.TableColumns}get angularGrid1(){return this.PartGrid.angularGrid}get PartGridTable(){return this.PartGrid.Table}get PartGridTableableColumns(){return this.PartGrid.TableColumns}UpdatePayTermsViewModel_1(t,e,s,i=0){this.DisplayName=2==i?"Contract History":1==i?"Copy":3==i?"Renew Sub Contracts":4==i?"Terminate Sub Contracts":5==i?"Refund Sub Contracts":6==i?"Close Sub Contracts":null!=e?"Distribute":"Generate Contract",this.Calltype=i,this.oparent=t,this.selectedrow=e,this.Rows=s,this.CopyRows.Visible=!1,2==i||3==i||4==i||5==i||6==i?(this.Filter.Visible=!1,this.PstDocGrid=new u.a,this.PartGrid=new u.a,this.EndDate=new h.b(0),this.Tower=new n.b(0),this.CompletionDate=new h.b(0),this.EndDate.Visible=!1,this.PartGrid.Visible=!1,this.PstDocGrid.Visible=!0,this.Tower.Visible=!1,this.CompletionDate.Visible=!1,this.CopyRows.Label="Copy",this.CopyRows.Visible=!1,this.CopyRows.DataType="INT",this.IsGenerateVisible=!1):1==i?(this.Filter.Visible=!1,this.PstDocGrid=new u.a,this.PartGrid=new u.a,this.EndDate=new h.b(0),this.Tower=new n.b(0),this.CompletionDate=new h.b(0),this.EndDate.Visible=!1,this.PstDocGrid.Visible=!1,this.PartGrid.Visible=!1,this.Tower.Visible=!1,this.CompletionDate.Visible=!1,this.CopyRows.Label="Copy",this.CopyRows.Visible=!0,this.CopyRows.DataType="INT"):null==this.selectedrow?(this.Filter.Visible=!0,this.Filter.Label="Contract for Year",this.Filter.Items.push(l.d.ComboBoxItems_2("ALL","ALL")),this.Rows.forEach(t=>{this.Filter.Items.push(t)}),this.Filter.Width="320",this.Filter.Items.length>0&&(this.Filter.SelectedValue=this.Filter.Items[0].Value,this.Filter.SelectedItem=this.Filter.Items[0])):this.oparent.multiVisi?(this.Filter.Visible=!0,this.Filter.Width="120",this.Filter.Label="Show",this.Filter.Items.push(l.d.ComboBoxItems_2("Both","0")),this.Filter.Items.push(l.d.ComboBoxItems_2("Show only unit","1")),this.Filter.Items.push(l.d.ComboBoxItems_2("Show only Dates","2")),this.Filter.SelectionChangedCommand.Subscribe(this,"ButtonSave"),this.Filter.SelectedValue="0"):this.Filter.Visible=!1,1!=i&&2!=i&&3!=i&&4!=i&&5!=i&&6!=i&&this.AddDateColumns(),this.IsCancelVisible=!0,this.PstDocGridTable.length>0&&(this.PstDocGrid.Height=252,this.PstDocGrid.Width="800"),this.PartGridTable.length>0&&(this.PartGrid.Height=252)}onLoad(){this.InitColumns(),this.SavePostedDocument.Subscribe(this,"ButtonSave")}AddDateColumns(){let t;if(this.Tower=new n.b(0),this.CompletionDate=new h.b(0),this.CompletionDate.Label="Start date",this.CompletionDate.Enable=!1,this.oparent.StartDate.Date&&(this.CompletionDate.Date=this.oparent.StartDate.Date),this.EndDate=new h.b(0),this.oparent.EndDate.Date&&(this.EndDate.Date=this.oparent.EndDate.Date),this.EndDate.Label="End Date",this.EndDate.Enable=!1,this.Tower.Visible=!1,this.PartGrid=new u.a,this.PartGrid.Visible=!0,this.PstDocGrid=new u.a,this.PstDocGrid.CanUserSortColumns=!1,this.PstDocGrid.CanUserDeleteRows=!0,this.PstDocGrid.RowHeight=25,this.PstDocGrid.Columns=[],this.PstDocGrid.Width="",this.PstDocGrid.CanUserAddRows=!0,this.PstDocGrid.CellEditEnding.Subscribe(this,"OnGridCellEditEnding"),this.PstDocGrid.OnRowSelection.Subscribe(this,"OnRowSelection"),this.PstDocGridTableColumns.push("Sno"),this.PstDocGridTableColumns.push("FromDate"),this.PstDocGridTableColumns.push("FromDate_Key"),this.PstDocGrid.DataTypes.Date.push("FromDate_Key"),this.PstDocGridTableColumns.push("ToDate"),this.PstDocGridTableColumns.push("ToDate_Key"),this.PstDocGrid.DataTypes.Date.push("ToDate_Key"),this.PstDocGridTableColumns.push("Amount"),this.PstDocGrid.DataTypes.Double.push("Amount"),this.PstDocGridTableColumns.push("Unit"),this.PstDocGridTableColumns.push("Unit_key"),this.PstDocGrid.DataTypes.Int.push("Unit_key"),this.PstDocGridTableColumns.push("Period"),this.PstDocGridTableColumns.push("Rate"),this.PstDocGrid.DataTypes.Double.push("Rate"),this.PstDocGridTableColumns.push("Discount"),this.PstDocGrid.DataTypes.Double.push("Discount"),this.PstDocGridTableColumns.push("ActAmount"),this.PstDocGrid.DataTypes.Double.push("ActAmount"),this.PstDocGridTableColumns.push("Narration"),this.PstDocGridTableColumns.push("Percent"),this.PstDocGrid.DataTypes.Double.push("Percent"),this.oparent.DistribtueInvoice&&null!=this.selectedrow&&this.oparent.DataTable.length>0&&this.selectedrow==this.oparent.DataTable[0]&&(this.PstDocGridTableColumns.push("Distribute"),this.PstDocGrid.DataTypes.Int.push("Distribute")),this.oparent.ShowMonthAmountInDistribute&&null!=this.selectedrow&&this.oparent.DataTable.length>0&&this.selectedrow==this.oparent.DataTable[0]&&(this.PstDocGridTableColumns.push("MonthAmount"),this.PstDocGrid.DataTypes.Double.push("MonthAmount")),null!=this.selectedrow?(t=new c.a,t.Header=i.a.GetResource("DocumentDesigner_Sno"),t.DisplayMember="Sno",t.ReadOnly=!0,t.Width=50,this.PstDocGrid.Columns.push(t)):(this.CompletionDate.Visible=!1,this.EndDate.Visible=!1,this.PstDocGrid.Visible=!1,this.PstDocGrid.Visible=!1,this.IsGenerateVisible=!0),t=new c.a,t.Header="From Date",t.DisplayMember="FromDate",t.Width=100,t.DataType="DATE",this.PstDocGrid.Columns.push(t),t=new c.a,t.Header="To Date",t.DisplayMember="ToDate",t.Width=100,t.DataType="DATE",this.PstDocGrid.Columns.push(t),null!=this.selectedrow){t=new c.a,t.Header="Unit",t.DisplayMember="Unit",t.ValueMember="Unit_key",t.Width=100,t.DataType="LISTBOX",t.CostCenterID=this.oparent.Unit.CCID,t.TypeID=this.oparent.Unit.TypeID,this.oparent.multiVisi?(t.IsVisible=!0,t.FilterCondition=" a.unitid in("+this.oparent.SelectedUnits+")"):t.IsVisible=!1,this.PstDocGrid.Columns.push(t),this.PstDocGridTableColumns.Contains("MonthAmount")&&(t=new c.a,t.Header="Month Wise",t.DisplayMember="MonthAmount",t.Width=100,t.DataType="FLOAT",t.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinAmount.toString(),this.PstDocGrid.Columns.push(t));var e=this.oparent.ContractParticular.find(t=>"Discount"==t.DisplayMember);null!=e&&e.IsVisible&&(t=new c.a,t.Header="Amount",t.DisplayMember="ActAmount",t.Width=100,t.DataType="FLOAT",t.IsCalculated=1,t.ShowTotal=!0,t.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinAmount.toString(),this.PstDocGrid.Columns.push(t),t=new c.a,t.Header="Discount",t.DisplayMember="Discount",t.Width=100,t.DataType="FLOAT",t.IsCalculated=1,t.ShowTotal=!0,t.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinAmount.toString(),this.PstDocGrid.Columns.push(t)),t=new c.a,t.Header=null!=e&&e.IsVisible?"After discount":"Amount",t.DisplayMember="Amount",t.Width=100,t.DataType="FLOAT",t.IsCalculated=1,t.ShowTotal=!0,t.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinAmount.toString(),this.PstDocGrid.Columns.push(t),t=new c.a,t.Header="%",t.DisplayMember="Percent",t.Width=100,t.DataType="FLOAT",t.DecimalPoints="0",this.PstDocGrid.Columns.push(t),this.PstDocGridTableColumns.Contains("Distribute")&&(t=new c.a,t.Header="Distribute",t.DisplayMember="Distribute",t.Width=100,t.DataType="FLOAT",t.DecimalPoints="0",this.PstDocGrid.Columns.push(t)),t=new c.a,t.Header="Rate",t.DisplayMember="Rate",t.Width=80,t.DataType="FLOAT",t.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinAmount.toString();let s=this.oparent.ScreenObject.Data.Tables[5].filter(t=>"ShowRateInDistribute"==t.Name);t.IsVisible=!!(s.length>0&&Object(o.j)(s[0].Value)),this.PstDocGrid.Columns.push(t)}t=new c.a,t.Header="Period",t.ValueBinding="Period",t.DataType="ComboBox",t.DisplayMember="Name",t.ValueMember="Value",t.Width=100;let s,r=m.a.GetLookupData(31);if(null!=r){let e=[];for(let t=0;t<r.length;t++)e.push(l.d.ComboBoxItems_2(r[t].Name.toString(),r[t].NodeID.toString()));t.ComboData=e}if(this.PstDocGrid.Columns.push(t),t=new c.a,t.Header="Narration",t.DisplayMember="Narration",t.DataType="TextBlock",t.Width=150,this.PstDocGrid.Columns.push(t),null==this.selectedrow)this.Rows.forEach(t=>{let e=this.PstDocGrid.NewRow();!a.e.IsEmpty(t.Value)&&a.e.isValidDate(t.Value)&&(s=a.e.isValidDate(t.Value),e.FromDate=new Date(t.Value).ToString(i.a.SessionManager.Preferences["Date Format"]),e.FromDate_key=new Date(t.Value)),!a.e.IsEmpty(t.Parent)&&a.e.isValidDate(t.Parent)&&(s=a.e.isValidDate(t.Parent),e.ToDate=new Date(t.Parent).ToString(i.a.SessionManager.Preferences["Date Format"]),e.ToDate_key=new Date(t.Parent)),t.CurrID>0&&(e.Period=t.CurrID),this.PstDocGrid.addRow(e)});else if(a.e.IsEmpty(this.selectedrow.Xml)){if(this.oparent.EndDate.Date&&this.oparent.StartDate.Date&&!a.e.IsEmpty(this.selectedrow.Amount))if(""!=this.oparent.SelectedUnits){if(!a.e.IsEmpty(this.oparent.dsPart)&&this.oparent.dsPart.Tables.length>5&&this.oparent.dsPart.Tables[5].length>0){let t=this.oparent.dsPart.Tables[5].Compute("sum","RENT"),e=this.oparent.SelectedUnits.split(",");if(this.oparent.EndDate.Date>this.oparent.StartDate.Date.AddYears(1)){let s;s=a.e.DoubleTryParse(this.oparent.TotalYears.Text);for(let o=0;o<e.length;o++){let r=null;if(null!=this.oparent.dsPart&&this.oparent.dsPart.Tables[5].length>0&&(r=this.oparent.dsPart.Tables[5].filter(t=>t.UnitID==e[o])),null!=r&&r.length>0){let e=parseFloat(this.selectedrow.Amount.toString())*parseFloat(r[0].RENT);null!=t&&parseFloat(t)>0&&(e/=parseFloat(t));let o=e/s;for(let t=0;t<s;t++){let e=this.PstDocGrid.NewRow();e.FromDate=this.oparent.StartDate.Date.AddYears(t).ToString(i.a.SessionManager.Preferences["Date Format"]),e.FromDate_key=this.oparent.StartDate.Date.AddYears(t),t==s-1?(e.ToDate=this.oparent.EndDate.Date.ToString(i.a.SessionManager.Preferences["Date Format"]),e.ToDate_key=this.oparent.EndDate.Date):(e.ToDate=this.oparent.StartDate.Date.AddYears(t+1).AddDays(-1).ToString(i.a.SessionManager.Preferences["Date Format"]),e.ToDate_key=this.oparent.StartDate.Date.AddYears(t+1).AddDays(-1)),e.Unit_key=r[0].UnitID.toString(),a.e.IsEmpty(r[0].RENT)||(e.Amount=o.ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()),e.Rate=(parseFloat(e.Amount)/parseFloat(r[0].RentableArea.toString())).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString())),e.Discount=0,e.ActAmount=e.Amount.toString(),e.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(e)}}}}else{this.Filter.SelectedValue="1",this.PstDocGrid.Clear();let s=parseFloat(this.selectedrow.Amount.toString());if(s.ToString("N2")==parseFloat(t).ToString("N2"))for(let t=0;t<e.length;t++){let s=this.PstDocGrid.NewRow();s.FromDate=this.oparent.StartDate.Date.ToString(i.a.SessionManager.Preferences["Date Format"]),s.FromDate_key=this.oparent.StartDate.Date,s.ToDate=this.oparent.StartDate.Date.ToString(i.a.SessionManager.Preferences["Date Format"]),s.ToDate_key=this.oparent.StartDate.Date;let o=null;null!=this.oparent.dsPart&&this.oparent.dsPart.Tables[5].length>0&&(o=this.oparent.dsPart.Tables[5].filter(s=>s.UnitID==e[t])),null!=o&&o.length>0&&(s.Unit_key=o[0].UnitID.toString(),a.e.IsEmpty(o[0].RENT)||(s.Amount=parseFloat(o[0].RENT).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()),s.Rate=(parseFloat(s.Amount)/parseFloat(o[0].RentableArea.toString())).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString())),s.Discount=0,s.ActAmount=s.Amount.toString()),s.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(s)}else for(let o=0;o<e.length;o++){let r=this.PstDocGrid.NewRow();r.FromDate=this.oparent.StartDate.Date.ToString(i.a.SessionManager.Preferences["Date Format"]),r.FromDate_key=this.oparent.StartDate.Date,r.ToDate=this.oparent.StartDate.Date.ToString(i.a.SessionManager.Preferences["Date Format"]),r.ToDate_key=this.oparent.StartDate.Date;let n=null;null!=this.oparent.dsPart&&this.oparent.dsPart.Tables[5].length>0&&(n=this.oparent.dsPart.Tables[5].filter(t=>t.UnitID==e[o])),null!=n&&n.length>0&&(r.Unit_key=n[0].UnitID.toString(),a.e.IsEmpty(n[0].RENT)||(r.Amount=null!=t?(s*parseFloat(n[0].RENT)/parseFloat(t)).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()):(s*parseFloat(n[0].RENT)).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()),r.Rate=(parseFloat(r.Amount)/parseFloat(n[0].RentableArea.toString())).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString())),r.Discount=0,r.ActAmount=r.Amount.toString()),r.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(r)}}this.PstDocGrid.Columns[3].IsVisible&&!this.PstDocGrid.RefreshGrid&&(this.PstDocGrid.RefreshGrid=!0)}}else if(this.oparent.EndDate.Date>this.oparent.StartDate.Date.AddYears(1)){let t;t=a.e.DoubleTryParse(this.oparent.TotalYears.Text);let e,s=parseFloat(this.selectedrow.Amount.toString())/t;a.e.DoubleTryParse(this.selectedrow.Discount.toString())?(e=a.e.DoubleTryParse(this.selectedrow.Discount.toString()),e/=t):e=0;let o=0,r=0;for(let a=0;a<t;a++){let n=this.PstDocGrid.NewRow();n.FromDate=this.oparent.StartDate.Date.AddYears(a).ToString(i.a.SessionManager.Preferences["Date Format"]),n.FromDate_key=this.oparent.StartDate.Date.AddYears(a),a==t-1?(n.ToDate=this.oparent.EndDate.Date.ToString(i.a.SessionManager.Preferences["Date Format"]),n.ToDate_key=this.oparent.EndDate.Date,n.Amount=(parseFloat(this.selectedrow.Amount.toString())-o).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()),e>0?(n.Discount=(parseFloat(this.selectedrow.Discount.toString())-r).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()),n.ActAmount=(parseFloat(n.Amount.toString())+parseFloat(n.Discount.toString())).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString())):(n.Discount=0,n.ActAmount=n.Amount.toString()),null!=this.oparent.dsPart&&this.oparent.dsPart.Tables.length>0&&this.oparent.dsPart.Tables[5].length>0&&(n.Rate=(parseFloat(n.Amount)/parseFloat(this.oparent.dsPart.Tables[5][0].RentableArea.toString())).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()))):(n.ToDate=this.oparent.StartDate.Date.AddYears(a+1).AddDays(-1).ToString(i.a.SessionManager.Preferences["Date Format"]),n.ToDate_key=this.oparent.StartDate.Date.AddYears(a+1).AddDays(-1),n.Amount=s.ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()),e>0?(n.Discount=e.ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()),n.ActAmount=(s+e).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()),r+=parseFloat(n.Discount)):(n.Discount=0,n.ActAmount=n.Amount.toString()),null!=this.oparent.dsPart&&this.oparent.dsPart.Tables.length>0&&this.oparent.dsPart.Tables[5].length>0&&(n.Rate=(parseFloat(n.Amount)/parseFloat(this.oparent.dsPart.Tables[5][0].RentableArea.toString())).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()))),o+=parseFloat(n.Amount.toString()),n.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(n)}}}else{let t=new a.f;if(t.LoadXml(this.selectedrow.Xml.toString()),null!=t){t.DocumentElement.children.length>0&&null!=t.DocumentElement.children[0].attributes&&null!=t.DocumentElement.children[0].attributes.Filter&&!a.e.IsEmpty(t.DocumentElement.children[0].attributes.Filter.value)&&(this.Filter.SelectedValue=t.DocumentElement.children[0].attributes.Filter.value),this.PstDocGrid.Clear();let e=t.SelectNodes("XML/Row");"0"==this.Filter.SelectedValue&&(e=t.SelectNodes("XML/UnitsRow/Row"));for(let t=0;t<e.length;t++){let o=e[t],r=this.PstDocGrid.NewRow();null!=o.attributes.FromDate&&!a.e.IsEmpty(o.attributes.FromDate.value)&&a.e.isValidDate(o.attributes.FromDate.value)&&(s=a.e.isValidDate(o.attributes.FromDate.value),r.FromDate=new Date(o.attributes.FromDate.value).ToString(i.a.SessionManager.Preferences["Date Format"]),r.FromDate_key=new Date(o.attributes.FromDate.value)),null!=o.attributes.ToDate&&!a.e.IsEmpty(o.attributes.ToDate.value)&&a.e.isValidDate(o.attributes.ToDate.value)&&(s=a.e.isValidDate(o.attributes.ToDate.value),r.ToDate=new Date(o.attributes.ToDate.value).ToString(i.a.SessionManager.Preferences["Date Format"]),r.ToDate_key=new Date(o.attributes.ToDate.value)),null==o.attributes.Unit||a.e.IsEmpty(o.attributes.Unit.value)||(r.Unit_key=parseInt(o.attributes.Unit.value)),null==o.attributes.Period||a.e.IsEmpty(o.attributes.Period.value)||(r.Period=parseInt(o.attributes.Period.value)),null==o.attributes.Amount||a.e.IsEmpty(o.attributes.Amount.value)||(r.Amount=parseFloat(o.attributes.Amount.value)),null==o.attributes.MonthAmount||a.e.IsEmpty(o.attributes.MonthAmount.value)||(r.MonthAmount=parseFloat(o.attributes.MonthAmount.value)),null==o.attributes.Rate||a.e.IsEmpty(o.attributes.Rate.value)||(r.Rate=parseFloat(o.attributes.Rate.value)),this.PstDocGridTableColumns.Contains("Distribute")&&null!=o.attributes.Distribute&&!a.e.IsEmpty(o.attributes.Distribute.value)&&(r.Distribute=parseFloat(o.attributes.Distribute.value)),this.PstDocGridTableColumns.Contains("ActAmount")&&null!=o.attributes.ActAmount&&!a.e.IsEmpty(o.attributes.ActAmount.value)&&(r.ActAmount=parseFloat(o.attributes.ActAmount.value)),this.PstDocGridTableColumns.Contains("Percent")&&null!=o.attributes.Percent&&!a.e.IsEmpty(o.attributes.Percent.value)&&(r.Percent=parseFloat(o.attributes.Percent.value)),this.PstDocGridTableColumns.Contains("Discount")&&null!=o.attributes.Discount&&!a.e.IsEmpty(o.attributes.Discount.value)&&(r.Discount=parseFloat(o.attributes.Discount.value)),null==o.attributes.Narration||a.e.IsEmpty(o.attributes.Narration.value)||(r.Narration=o.attributes.Narration.value),r.Sno=this.PstDocGridTable.length+1,this.PstDocGrid.addRow(r)}}null!=this.oparent.dsPart&&this.oparent.dsPart.Tables.length>5&&this.oparent.dsPart.Tables[5].length>0||!this.PstDocGrid.Columns[3].IsVisible||(this.PstDocGrid.RefreshGrid=!0)}null!=this.selectedrow&&this.OnGridCellEditEnding(null,"Amount",0);for(let i=0;i<5;i++){let t=this.PstDocGrid.NewRow();this.PstDocGridTableColumns.Contains("select")?t.select=!1:t.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(t)}if(null!=this.selectedrow){this.PartGrid.CanUserSortColumns=!1,this.PartGrid.CanUserDeleteRows=!0,this.PartGrid.RowHeight=25,this.PartGrid.Columns=[],this.PartGrid.Width="",this.PartGrid.CanUserAddRows=!1,this.PartGridTableableColumns.push("Sno"),this.PartGridTableableColumns.push("Part"),this.PartGridTableableColumns.push("Part_Key"),this.PstDocGrid.DataTypes.Int.push("Part_Key"),this.PartGridTableableColumns.push("Amount"),this.PstDocGrid.DataTypes.Double.push("Amount"),t=new c.a,t.Header="Particulars",t.DisplayMember="Part",t.Width=100,t.ReadOnly=!0,this.PartGrid.Columns.push(t),t=new c.a,t.Header="Amount",t.DisplayMember="Amount",t.Width=100,t.DataType="FLOAT",t.ReadOnly=!0,t.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinAmount.toString(),this.PartGrid.Columns.push(t);for(let t=0;t<this.oparent.DataTable.length;t++)if(!a.e.IsEmpty(this.oparent.DataTable[t].NodeID)){let e=this.PartGrid.NewRow();if(e.Part_Key=this.oparent.DataTable[t].NodeID.toString(),a.e.IsEmpty(this.oparent.DataTable[t].Particulars)){var D=this.oparent.ContractParticular.find(t=>!a.e.StringIsNullOrEmpty(t.ValueBinding)&&"NodeID"==t.ValueBinding);if(null!=D&&null!=D){let s=this.oparent.ContractParticular[1].ComboData.filter(e=>e.NodeID==this.oparent.DataTable[t].NodeID.toString());s.length>0&&(e.Part=s[0].Particulars.toString())}}else e.Part=this.oparent.DataTable[t].Particulars.toString();this.PartGrid.addRow(e)}}}OnRowSelection(t){return null!=t&&this.PopulateParticulars(t),!0}PopulateParticulars(t){let e,s,i=null,o=null;a.e.IsEmpty(t.ToDate_Key)||(o=new Date(t.ToDate_Key.toString())),a.e.IsEmpty(t.FromDate_Key)||(i=new Date(t.FromDate_Key.toString()));for(let r=0;r<this.oparent.DataTable.length;r++)if(!a.e.IsEmpty(this.oparent.DataTable[r].NodeID)){let t=this.PartGrid.Table.filter(t=>t.Part_Key==this.oparent.DataTable[r].NodeID.toString());if(t.length>0){let n=0;if(this.oparent.DataTable[r]==this.selectedrow)for(let t=0;t<this.PstDocGrid.Table.length;t++)a.e.IsEmpty(this.PstDocGrid.Table[t].Amount)||a.e.IsEmpty(this.PstDocGrid.Table[t].FromDate_Key)||(new Date(this.PstDocGrid.Table[t].FromDate_Key.toString()),n+=parseFloat(this.PstDocGrid.Table[t].Amount.toString()));else if(a.e.IsEmpty(this.oparent.DataTable[r].Xml))a.e.IsEmpty(i)||i.Date!=this.oparent.StartDate.Date||a.e.IsEmpty(this.oparent.DataTable[r].Amount)||(n+=parseFloat(this.oparent.DataTable[r].Amount.toString()));else{let t=new a.f;t.LoadXml(this.oparent.DataTable[r].Xml.toString());let l=-1;if(t.DocumentElement.children.length>0&&null!=t.DocumentElement.children[0].attributes&&null!=t.DocumentElement.children[0].attributes.Filter&&!a.e.IsEmpty(t.DocumentElement.children[0].attributes.Filter.value)&&(l=parseInt(t.DocumentElement.children[0].attributes.Filter.value)),2==l||-1==l)t.DocumentElement.children[0].childNodes.forEach(t=>{e=a.e.isValidDate(t.FromDate.value),s=a.e.isValidDate(t.ToDate.value),a.e.IsEmpty(i)||null==e||i.Date!=e.Date||a.e.IsEmpty(t.Amount.value)||a.e.IsEmpty(o)||null==s||o.Date!=s.Date||(n+=parseFloat(t.Amount.value))});else if(0==l){let r=t.SelectNodes("XML/UnitsRow/Row");for(let t=0;t<r.length;t++){let l=r[t];e=a.e.isValidDate(l.attributes.FromDate.value),s=a.e.isValidDate(l.attributes.ToDate.value),a.e.IsEmpty(i)||null==e||i.Date!=e.Date||a.e.IsEmpty(l.attributes.Amount.value)||a.e.IsEmpty(o)||null==s||o.Date!=s.Date||(n+=parseFloat(l.attributes.Amount.value))}}}t[0].Amount=n,this.PartGrid.updateRow(t[0])}}}OnGridCellEditEnding(t,e,s){if(a.e.IsEmpty(t)||(e=t.column.field,t=t.item),"Percent"==e&&!a.e.IsEmpty(t.Percent)&&parseFloat(t.Percent.toString())>0&&this.PstDocGrid.SelectedIndex>0&&!a.e.IsEmpty(this.PstDocGrid.Table[this.PstDocGrid.SelectedIndex-1].Amount)){let s=parseFloat(this.PstDocGrid.Table[this.PstDocGrid.SelectedIndex-1].Amount.toString());t.Amount=(s+parseFloat(t.Percent)*s/100).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()),e="Amount"}if("MonthAmount"!=e||null==t||a.e.IsEmpty(t.MonthAmount)||a.e.IsEmpty(t.ToDate_Key)||a.e.IsEmpty(t.FromDate_Key)||(t.Amount=parseFloat(t.MonthAmount.toString())*this.oparent.CalculateMonthsbetweenDates(new Date(t.FromDate_Key.toString()),new Date(t.ToDate_Key.toString())),e="Amount"),("Amount"==e||"ActAmount"==e||"Discount"==e||"Rate"==e)&&this.PstDocGrid.Columns.length>4){if("Rate"==e&&null!=t)if(null==this.oparent.dsPart&&this.oparent.validateUnit(!1),a.e.IsEmpty(t.Unit_key))this.oparent.dsPart.Tables[5].length>0&&(t.Amount=(parseFloat(t.Rate)*parseFloat(this.oparent.dsPart.Tables[5].Compute("sum","RentableArea").toString())).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()));else{let e=this.oparent.dsPart.Tables[5].filter(e=>e.UnitID==t.Unit_key.toString());e.length>0&&(t.Amount=(parseFloat(t.Rate)*parseFloat(e[0].RentableArea.toString())).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()))}if(null!=t){let s,o,r;s=a.e.DoubleTryParse(t.ActAmount),o=a.e.DoubleTryParse(t.Discount),r=a.e.DoubleTryParse(t.Amount),"Amount"!=e&&"Rate"!=e||(t.ActAmount=(r+o).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString())),"ActAmount"!=e&&"Discount"!=e||(0==s&&r>0?t.ActAmount=(r+o).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()):t.Amount=(s-o).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()))}if(this.CalculateTotals(t),null!=t){if("Rate"!=e&&(null==this.oparent.dsPart&&this.oparent.validateUnit(!1),!a.e.IsEmpty(t.Amount)))if(a.e.IsEmpty(t.Unit_key))this.oparent.dsPart.Tables[5].length>0&&(t.Rate=(parseFloat(t.Amount)/parseFloat(this.oparent.dsPart.Tables[5].Compute("sum","RentableArea").toString())).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()));else{let e=this.oparent.dsPart.Tables[5].filter(e=>e.UnitID==t.Unit_key.toString());e.length>0&&(t.Rate=(parseFloat(t.Amount)/parseFloat(e[0].RentableArea.toString())).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()))}this.PstDocGrid.updateRow(t),this.PstDocGrid.UpdateTotals(),this.PopulateParticulars(t)}}}CalculateTotals(t){let e=this.PstDocGrid.Table.Compute("sum","Amount");null!=e&&null!=e||(e=0);var s=this.PstDocGrid.Columns.find(t=>"Amount"==t.DisplayMember);null!=s&&(s.footer=parseFloat(e).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString())),e=this.PstDocGrid.Table.Compute("sum","ActAmount"),null!=e&&null!=e||(e=0),null!=(s=this.PstDocGrid.Columns.find(t=>"ActAmount"==t.DisplayMember))&&(s.footer=parseFloat(e).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString())),e=this.PstDocGrid.Table.Compute("sum","Discount"),null!=e&&null!=e||(e=0),null!=(s=this.PstDocGrid.Columns.find(t=>"Discount"==t.DisplayMember))&&(s.footer=parseFloat(e).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString())),null!=t&&this.PstDocGrid.UpdateFooter()}InitColumns(){let t;this.Tower=new n.b(0),this.CompletionDate=new h.b(0),this.CompletionDate.Label="New CompletionDate",this.EndDate=new h.b(0),this.EndDate.Visible=!1,this.PartGrid=new u.a,this.PartGrid.Visible=!1,this.PartGrid=new u.a,this.PartGrid.CanUserSortColumns=!0,this.PartGrid.Columns=[],this.PartGrid.Width="",this.PstDocGridTableColumns.push("Sno"),this.PstDocGridTableColumns.push("select"),this.PstDocGrid.DataTypes.Bool.push("select"),this.PstDocGridTableColumns.push("DocNumber"),this.PstDocGridTableColumns.push("DocPrefix"),this.PstDocGridTableColumns.push("DocID"),this.PstDocGridTableColumns.push("CostCenterID"),this.PstDocGridTableColumns.push("VNO"),t=new c.a,t.Header=i.a.GetResource("DocumentDesigner_Sno"),t.DisplayMember="Sno",t.ReadOnly=!0,t.Width=50,this.PstDocGrid.Columns.push(t),t=new c.a,t.Header="Select",t.DisplayMember="select",t.Width=60,t.DataType="CheckBox",this.PstDocGrid.Columns.push(t);let e=i.a.rental.GetPaymentScreenDef(),s=null;for(let i=0;i<e.Tables[0].length;i++)"PaymentTermDocumentName"==e.Tables[0][i].DBText.toString()?a.e.IsEmpty(e.Tables[0][i].Value)||(this.DocCCID=parseInt(e.Tables[0][i].Value.toString())):"PaymentTermCompletionDate"==e.Tables[0][i].DBText.toString()?this.CompletionDateColName=e.Tables[0][i].Value.toString():"LinkDocument"==e.Tables[0][i].DBText.toString()?a.e.IsEmpty(e.Tables[0][i].Value)||(this.CCID=parseInt(e.Tables[0][i].Value.toString())):"PaymentTermFields"==e.Tables[0][i].DBText.toString()&&(s=e.Tables[0][i].Value.toString().split(";"));this.Tower.CCID=this.CCID,this.Tower.TypeID=1,this.Tower.Label="Tower",s.forEach(s=>{let i=[]=e.Tables[1].filter(t=>t.SysColumnName==s);if(i.length>0)if(t=new c.a,t.Header=i[0].ResourceData.toString(),t.DisplayMember=i[0].SysColumnName.toString(),"VoucherNo"==t.DisplayMember&&(t.DataType="LINK",t.Click.Subscribe(this,"onClick")),t.ReadOnly=!0,t.Width=100,this.PstDocGrid.Columns.push(t),t.SectionName=i[0].UserColumnType.toString(),this.PstDocGridTableColumns.push(i[0].SysColumnName.toString()),i[0].SysColumnName.toString().toLowerCase().Contains("dcccnid")){let e=parseInt(i[0].SysColumnName.toString().toLowerCase().Replace("dcccnid",""));e+=5e4,this.Joins+=" left Join "+this.GetTableName(e)+" c"+e.toString()+"  WITH(NOLOCK) on c."+i[0].SysColumnName.toString()+"= c"+e.toString()+".NODEID  ",this.Columns+=",c"+e.toString()+".name "+t.DisplayMember}else"debitaccount"==i[0].SysColumnName.toString().toLowerCase()||"creditaccount"==i[0].SysColumnName.toString().toLowerCase()?(this.Joins+=" left Join "+this.GetTableName(2)+" c"+i[0].SysColumnName.toString()+"  WITH(NOLOCK) on a."+i[0].SysColumnName.toString()+"= c"+i[0].SysColumnName.toString()+".AccountID  ",this.Columns+=",c"+i[0].SysColumnName.toString()+".Accountname "+t.DisplayMember):"duedate"==i[0].SysColumnName.toString().toLowerCase()||"docdate"==i[0].SysColumnName.toString().toLowerCase()||"billdate"==i[0].SysColumnName.toString().toLowerCase()?this.Columns+=",Convert(datetime,"+t.DisplayMember+") "+t.DisplayMember:this.Columns+=","+t.DisplayMember;else"PaymentTerm"==s&&(t=new c.a,t.Header="PaymentTerm",t.DisplayMember="PaymentTerm",t.ReadOnly=!0,t.Width=100,t.SectionName="PaymentTerm",this.PstDocGrid.Columns.push(t),this.PstDocGridTableColumns.push("PaymentTerm"),this.Columns+=",(select top 1 pd.ProfileName from COM_DocPayTerms p ",this.Columns+=" join Acc_PaymentDiscountProfile pd on p.ProfileID=pd.ProfileID  ",this.Columns+=" where p.VoucherNo=a.VoucherNo)  "+t.DisplayMember)})}GetTableName(t){return 2==t?"ACC_Accounts":3==t?"INV_Product":50001==t?"COM_Division":50002==t?"COM_Location":50003==t?"COM_Branch":50004==t?"COM_Department":50005==t?"COM_Salesman":50006==t?"COM_Category":50007==t?"COM_Area":50008==t?"COM_Teritory":"COM_CC"+t}onClick(){null==this.PstDocGrid.SelectedItem||a.e.IsEmpty(this.PstDocGrid.SelectedItem.CostCenterID)||p.RibbonExtViewModel.LoadDocument(this.PstDocGrid.SelectedItem)}SelectAllRows(){for(let t=0;t<this.PstDocGrid.Table.length;t++)this.PstDocGridTable[t].select=this.SelectAll}FillSearchDetails(){this.Options=new l.e(0),this.SearchCols=new l.e(0),this.Options.Items.push(l.d.ComboBoxItems_2(i.a.GetResource("Com_Equals"),"1")),this.Options.Items.push(l.d.ComboBoxItems_2(i.a.GetResource("Com_NotEquals"),"2")),this.Options.Items.push(l.d.ComboBoxItems_2(i.a.GetResource("Com_BeginsWith"),"3")),this.Options.Items.push(l.d.ComboBoxItems_2(i.a.GetResource("Com_EndsWith"),"4")),this.Options.Items.push(l.d.ComboBoxItems_2(i.a.GetResource("Com_Contains"),"5")),this.Options.Items.push(l.d.ComboBoxItems_2(i.a.GetResource("Com_NotContains"),"6")),this.Options.SelectedValue="5",this.PstDocGrid.Columns.forEach(t=>{t.IsVisible&&"Sno"!=t.DisplayMember&&"select"!=t.DisplayMember&&this.SearchCols.Items.push(l.d.ComboBoxItems_2(t.Header,t.DisplayMember))}),this.SearchCols.Items.length>0&&(this.SearchCols.SelectedValue=this.SearchCols.Items[0].Value)}LoadData(){if(null!=this.Tower&&this.Tower.CCID>0&&this.Tower.SelectedValue>0){let t,e;this.PstDocGrid.Clear();let s=" where c.dcCCNID"+(this.Tower.CCID-5e4).toString()+"="+this.Tower.SelectedValue,o=i.a.rental.GetPayTermsofProperty(s,this.Columns,this.Joins);if(null!=o&&o.Tables.length>0&&o.Columns[0].Contains("DocPrefix")){for(let s=0;s<o.Tables[0].length;s++){e=this.PstDocGrid.NewRow(),e.Sno=(s+1).toString(),e.select=!1,e.DocNumber=o.Tables[0][s].DocNumber.toString(),e.DocPrefix=o.Tables[0][s].DocPrefix.toString(),e.DocID=o.Tables[0][s].DocID.toString(),e.CostCenterID=o.Tables[0][s].CostCenterID.toString(),e.VNO=o.Tables[0][s].VNO.toString();for(let r=2;r<this.PstDocGrid.Columns.length;r++)o.Columns[0].Contains(this.PstDocGrid.Columns[r].DisplayMember)?"date"==this.PstDocGrid.Columns[r].SectionName.toLowerCase()&&!a.e.IsEmpty(o.Tables[0][s][this.PstDocGrid.Columns[r].DisplayMember])&&a.e.isValidDate(o.Tables[0][s][this.PstDocGrid.Columns[r].DisplayMember].toString())&&(t=a.e.isValidDate(o.Tables[0][s][this.PstDocGrid.Columns[r].DisplayMember].toString()),e[this.PstDocGrid.Columns[r].DisplayMember]=new Date(o.Tables[0][s][this.PstDocGrid.Columns[r].DisplayMember].toString()).ToString(i.a.SessionManager.Preferences["Date Format"])):"datetime"==this.PstDocGrid.Columns[r].SectionName.toLowerCase()&&!a.e.IsEmpty(o.Tables[0][s][this.PstDocGrid.Columns[r].DisplayMember])&&a.e.isValidDate(o.Tables[0][s][this.PstDocGrid.Columns[r].DisplayMember].toString())?(t=a.e.isValidDate(o.Tables[0][s][this.PstDocGrid.Columns[r].DisplayMember].toString()),e[this.PstDocGrid.Columns[r].DisplayMember]=new Date(o.Tables[0][s][this.PstDocGrid.Columns[r].DisplayMember].toString()).ToString(i.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss")):e[this.PstDocGrid.Columns[r].DisplayMember]=o.Tables[0][s][this.PstDocGrid.Columns[r].DisplayMember].toString()}this.PstDocGrid.addRow(e)}}}ButtonSave(t){if(this.DisplayMessage="","Save"==t){if(2==this.Calltype)return void i.a.page.HideDialog();if(1==this.Calltype){let t=0;if(t=a.e.IntTryParse(this.CopyRows.Text),!(t>0))return this.DisplayMessage="Enter valid count.",void(this.MessageVisibility=!0);{let e=["DocID","DocNumber","DocPrefix","DocumentName","CostCenterID","DocumentNo","Status","Xml"],s=this.oparent.DataTable.indexOf(this.selectedrow);for(let i=0;i<t;i++){let t=this.oparent.DataTableObj.NewRow();for(let s=0;s<this.oparent.DataTableObj.Columns.length;s++)this.oparent.DataTableColumns.Contains(e[s])||(t[s]=this.selectedrow[s]);this.oparent.DataTableObj.insertRowAt(t,s)}for(let t=0;t<this.oparent.DataTableObj.Table.length;t++)this.oparent.DataTable[t].SNO=t+1}return}if(3==this.Calltype||4==this.Calltype||5==this.Calltype||6==this.Calltype){for(let t=0;t<this.PstDocGrid.Table.length;t++)if(""!=this.PstDocGrid.Table[t].Select.toString()&&Object(o.j)(this.PstDocGrid.Table[t].Select.toString())){let e=new d.AddEditRenContractViewModel;e.AddEditRenContractViewModel_1(95,parseInt(this.PstDocGrid.Table[t].ContractID.toString()),!1,0,0,""),e.ContractDate.Text=e.ContractDate.Date.ToString("dd/MMM/yyyy"),e.StartDate.Text=e.StartDate.Date.ToString("dd/MMM/yyyy"),e.EndDate.Text=e.EndDate.Date.ToString("dd/MMM/yyyy"),e.Tenant.Text=e.Property.Text=e.Unit.Text="",3==this.Calltype?(e.OnCustomizeExtraFields("AutoRenew"),e.OnSave("AutoSave")):4==this.Calltype?(e.TerminateContracts=this.oparent.TerminateContracts,e.TerminateContract(e.ContractID,this.oparent.cntrct.Reason,this.oparent.cntrct.TerminationDate,1,!0)):5==this.Calltype?(e.TerminateContracts=this.oparent.TerminateContracts,e.TerminateContract(e.ContractID,this.oparent.cntrct.Reason,this.oparent.cntrct.TerminationDate,3,!0)):6==this.Calltype&&(e.TerminateContracts=this.oparent.TerminateContracts,e.TerminateContract(e.ContractID,this.oparent.cntrct.Reason,this.oparent.cntrct.TerminationDate,2,!0))}return void i.a.page.HideDialog()}if(null!=this.oparent&&null!=this.selectedrow){if(this.oparent.IsRecurPosted)return this.DisplayMessage="Can not change as documents posted.",void(this.MessageVisibility=!0);let t=0,e=null,s=null,o=0,r=0,n=0,l=new Array;if(this.Filter.Visible&&"2"!=this.Filter.SelectedValue){if(this.Filter.Visible&&"1"==this.Filter.SelectedValue){for(let e=0;e<this.PstDocGrid.Table.length;e++)if(!a.e.IsEmpty(this.PstDocGrid.Table[e].Unit_key)){if(l.Contains(parseInt(this.PstDocGrid.Table[e].Unit_key.toString())))return this.DisplayMessage="Unit "+this.PstDocGrid.Table[e].Unit.toString()+" is defined more than once.",void(this.MessageVisibility=!0);l.push(parseInt(this.PstDocGrid.Table[e].Unit_key.toString())),a.e.IsEmpty(this.PstDocGrid.Table[e].Amount)||(o+=parseFloat(this.PstDocGrid.Table[e].Amount.toString()),t++),a.e.IsEmpty(this.PstDocGrid.Table[e].ActAmount)||(n+=parseFloat(this.PstDocGrid.Table[e].ActAmount.toString())),a.e.IsEmpty(this.PstDocGrid.Table[e].Discount)||(r+=parseFloat(this.PstDocGrid.Table[e].Discount.toString()))}if(t>0&&l.length!=this.oparent.SelectedUnits.split(",").length)return this.DisplayMessage="Distribution not defined for some units.",void(this.MessageVisibility=!0)}else if(this.Filter.Visible&&"0"==this.Filter.SelectedValue&&(this.oparent.SelectedUnits.split(",").forEach(i=>{var h=this.PstDocGrid.Table.filter(t=>t.Unit_key==i,"FromDate_key");if(e=null,s=null,h.length>0){l.push(parseInt(i));for(let i=0;i<h.length;i++){if(null!=e||a.e.IsEmpty(h[i].FromDate_key)||(e=new Date(h[i].FromDate_key.toString())),null!=s&&!a.e.IsEmpty(h[i].FromDate_key)&&1!=a.e.GetDateDifference(new Date(h[i].FromDate_key),new Date(s)))return this.DisplayMessage="Enter correct from date at row no:"+(this.PstDocGrid.Table.indexOf(h[i])+1),void(this.MessageVisibility=!0);if(a.e.IsEmpty(h[i].Amount)||(o+=parseFloat(h[i].Amount.toString()),t++),a.e.IsEmpty(h[i].ActAmount)||(n+=parseFloat(h[i].ActAmount.toString())),a.e.IsEmpty(h[i].Discount)||(r+=parseFloat(h[i].Discount.toString())),a.e.IsEmpty(h[i].ToDate_key)||(s=new Date(h[i].ToDate_key.toString())),this.PstDocGrid.TableColumns.Contains("Distribute")&&!a.e.IsEmpty(h[i].FromDate_key)&&!a.e.IsEmpty(h[i].ToDate_Key)&&(""==a.e.String(h[i].Distribute)||parseInt(h[i].Distribute.toString())<1))return this.DisplayMessage="Enter Distribute at row no:"+(this.PstDocGrid.Table.indexOf(h[i])+1),void(this.MessageVisibility=!0)}if(null==e||e.toDateString()!=this.CompletionDate.Date.toDateString())return this.DisplayMessage="Contract start date and first date does not match for ."+h[0].Unit.toString(),void(this.MessageVisibility=!0);if(null==s||s.toDateString()!=this.EndDate.Date.toDateString())return this.DisplayMessage="Contract end date and last date does not match for ."+h[0].Unit.toString(),void(this.MessageVisibility=!0)}}),t>0&&l.length!=this.oparent.SelectedUnits.split(",").length))return this.DisplayMessage="Distribution not defined for some units.",void(this.MessageVisibility=!0)}else{for(let i=0;i<this.PstDocGrid.Table.length;i++){if(null!=e||a.e.IsEmpty(this.PstDocGrid.Table[i].FromDate_key)||(e=new Date(this.PstDocGrid.Table[i].FromDate_key.toString())),null!=s&&!a.e.IsEmpty(this.PstDocGrid.Table[i].FromDate_key)&&1!=a.e.GetDateDifference(new Date(this.PstDocGrid.Table[i].FromDate_key),new Date(s)))return this.DisplayMessage="Enter correct from date at row no:"+(i+1),void(this.MessageVisibility=!0);if(a.e.IsEmpty(this.PstDocGrid.Table[i].Amount)||(o+=parseFloat(this.PstDocGrid.Table[i].Amount.toString()),t++),a.e.IsEmpty(this.PstDocGrid.Table[i].ActAmount)||(n+=parseFloat(this.PstDocGrid.Table[i].ActAmount.toString())),a.e.IsEmpty(this.PstDocGrid.Table[i].Discount)||(r+=parseFloat(this.PstDocGrid.Table[i].Discount.toString())),a.e.IsEmpty(this.PstDocGrid.Table[i].ToDate_key)||(s=new Date(this.PstDocGrid.Table[i].ToDate_key.toString())),this.PstDocGrid.TableColumns.Contains("Distribute")&&!a.e.IsEmpty(this.PstDocGrid.Table[i].FromDate_key)&&!a.e.IsEmpty(this.PstDocGrid.Table[i].ToDate_Key)&&(""==a.e.String(this.PstDocGrid.Table[i].Distribute)||parseInt(this.PstDocGrid.Table[i].Distribute.toString())<1))return this.DisplayMessage="Enter Distribute at row no:"+(i+1),void(this.MessageVisibility=!0)}if(t>0&&(null==e||e.toDateString()!=this.CompletionDate.Date.toDateString()))return this.DisplayMessage="Contract start date and first date does not match.",void(this.MessageVisibility=!0);if(t>0&&(null==s||s.toDateString()!=this.EndDate.Date.toDateString()))return this.DisplayMessage="Contract end date and last date does not match.",void(this.MessageVisibility=!0)}if(t>0&&(""==a.e.String(this.selectedrow.Amount)||0==parseFloat(this.selectedrow.Amount.toString()))&&(this.selectedrow.Amount=o.ToString("N"+this.oparent.Mdeci),this.selectedrow.Discount=r.ToString("N"+this.oparent.Mdeci),this.selectedrow.ActAmount=n.ToString("N"+this.oparent.Mdeci),this.oparent.Reevaluate(),this.oparent.CalculateNRec()),t>0&&!a.e.IsEmpty(this.selectedrow.Amount)&&parseFloat(this.selectedrow.Amount.toString()).ToString("N"+this.oparent.Mdeci)!=o.ToString("N"+this.oparent.Mdeci))return this.DisplayMessage="Amount mismatch",void(this.MessageVisibility=!0);let h="";if(t>0){if(h+="<XML",this.Filter.Visible&&(h+=' Filter="'+this.Filter.SelectedValue+'" '),h+=">",this.Filter.Visible&&"0"==this.Filter.SelectedValue)this.oparent.SelectedUnits.split(",").forEach(t=>{let e=this.PstDocGrid.Table.filter(e=>e.Unit_key==t,"FromDate_key");h+='<UnitsRow Unit="'+t+'" Amount="##amt##" >';let s=0;for(let i=0;i<e.length;i++)a.e.IsEmpty(e[i].Amount)||(h+="<Row ",h+='FromDate="'+new Date(e[i].FromDate_key).ToString("dd/MMM/yyyy")+'" ',h+='ToDate="'+new Date(e[i].ToDate_key).ToString("dd/MMM/yyyy")+'" ',h+='Unit="'+e[i].Unit_key.toString()+'" ',a.e.IsEmpty(e[i].Period)||(h+='Period="'+e[i].Period.toString()+'" '),a.e.IsEmpty(e[i].Rate)||(h+='Rate="'+e[i].Rate.toString()+'" '),this.PstDocGrid.TableColumns.Contains("MonthAmount")&&!a.e.IsEmpty(e[i].MonthAmount)&&(h+='MonthAmount="'+e[i].MonthAmount.toString()+'" '),this.PstDocGrid.TableColumns.Contains("Distribute")&&!a.e.IsEmpty(e[i].Distribute)&&(h+='Distribute="'+e[i].Distribute.toString()+'" '),a.e.IsEmpty(e[i].Discount)||(h+='Discount="'+e[i].Discount.toString()+'" '),a.e.IsEmpty(e[i].ActAmount)||(h+='ActAmount="'+e[i].ActAmount.toString()+'" '),a.e.IsEmpty(e[i].Percent)||(h+='Percent="'+e[i].Percent.toString()+'" '),h+='Amount="'+e[i].Amount.toString()+'" ',h+='Narration="'+a.e.String(e[i].Narration)+'"/>',s+=parseFloat(e[i].Amount.toString()));h=h.Replace("##amt##",s.toString()),h+="</UnitsRow>"});else for(let t=0;t<this.PstDocGrid.Table.length;t++)a.e.IsEmpty(this.PstDocGrid.Table[t].Amount)||(h+="<Row ",this.Filter.Visible&&!this.PstDocGrid.Columns[1].IsVisible||(h+='FromDate="'+new Date(this.PstDocGrid.Table[t].FromDate_key).ToString("dd/MMM/yyyy")+'" ',h+='ToDate="'+new Date(this.PstDocGrid.Table[t].ToDate_key).ToString("dd/MMM/yyyy")+'" '),this.Filter.Visible&&this.PstDocGrid.Columns[3].IsVisible&&!a.e.IsEmpty(this.PstDocGrid.Table[t].Unit_key)&&(h+='Unit="'+this.PstDocGrid.Table[t].Unit_key.toString()+'" '),a.e.IsEmpty(this.PstDocGrid.Table[t].Period)||(h+='Period="'+this.PstDocGrid.Table[t].Period.toString()+'" '),a.e.IsEmpty(this.PstDocGrid.Table[t].Rate)||(h+='Rate="'+this.PstDocGrid.Table[t].Rate.toString()+'" '),this.PstDocGrid.TableColumns.Contains("MonthAmount")&&!a.e.IsEmpty(this.PstDocGrid.Table[t].MonthAmount)&&(h+='MonthAmount="'+this.PstDocGrid.Table[t].MonthAmount.toString()+'" '),this.PstDocGrid.TableColumns.Contains("Distribute")&&!a.e.IsEmpty(this.PstDocGrid.Table[t].Distribute)&&(h+='Distribute="'+this.PstDocGrid.Table[t].Distribute.toString()+'" '),this.PstDocGrid.TableColumns.Contains("Discount")&&!a.e.IsEmpty(this.PstDocGrid.Table[t].Discount)&&(h+='Discount="'+this.PstDocGrid.Table[t].Discount.toString()+'" '),this.PstDocGrid.TableColumns.Contains("ActAmount")&&!a.e.IsEmpty(this.PstDocGrid.Table[t].ActAmount)&&(h+='ActAmount="'+this.PstDocGrid.Table[t].ActAmount.toString()+'" '),this.PstDocGrid.TableColumns.Contains("Percent")&&!a.e.IsEmpty(this.PstDocGrid.Table[t].Percent)&&(h+='Percent="'+this.PstDocGrid.Table[t].Percent.toString()+'" '),h+='Amount="'+this.PstDocGrid.Table[t].Amount.toString()+'" ',h+='Narration="'+a.e.String(this.PstDocGrid.Table[t].Narration)+'"/>');h+="</XML>"}return this.selectedrow.Xml=h.toString(),this.oparent.DataTableObj.updateRow(this.selectedrow),void i.a.page.HideDialog()}if(!(null!=this.CompletionDate.Date&&this.CompletionDate.Date&&this.PstDocGrid.Table.length>0))return this.PstDocGrid.Table.length>0?(this.DisplayMessage="can not save blank data ",void(this.MessageVisibility=!0)):(this.DisplayMessage="Select Completion Date",void(this.MessageVisibility=!0));{let t="";for(let e=0;e<this.PstDocGrid.Table.length;e++)!a.e.IsEmpty(this.PstDocGrid.Table[e].select)&&Object(o.j)(this.PstDocGrid.Table[e].select.toString())&&(t+='<Row ID="'+this.PstDocGrid.Table[e].DocID.toString()+'" ',t+=' CostCenterID="'+this.PstDocGrid.Table[e].CostCenterID.toString()+'" ',t+=' VNO="'+this.PstDocGrid.Table[e].VNO.toString()+'" />');if(!(t.length>0))return this.DisplayMessage="Select data to save",void(this.MessageVisibility=!0);{t="<XML>"+t+"</XML>";let e=0,s=i.a.rental.SaveCompletionDate(t.toString(),this.CompletionDate.Date.Date(),this.Tower.SelectedValue);this.DisplayMessage=s.Message,e=s.RetValue,this.MessageVisibility=!0,e>0&&this.PstDocGrid.Clear()}}}else if("GenFirst"==t){if(null!=this.oparent&&null==this.selectedrow&&null!=this.Rows){if(a.e.IsEmpty(this.Filter.SelectedValue))return this.DisplayMessage="Select Year",void(this.MessageVisibility=!0);if("ALL"==this.Filter.SelectedValue)this.oparent.GenerateContract();else{let t=null,e=null,s=0;t=new Date(this.Filter.SelectedValue),a.e.IsEmpty(this.Filter.SelectedItem.Parent)||(e=new Date(this.Filter.SelectedItem.Parent)),this.Filter.SelectedItem.CurrID>0&&(s=parseInt(this.Filter.SelectedItem.CurrID.toString())),this.oparent.GenerateContract(t,e,s)}return void i.a.page.HideDialog()}}else"Search"==t?this.SearchGrid():"OK"==t?this.LoadData():"Close"==t?i.a.page.HideDialog():"Selectionchanged"==t&&("0"==this.Filter.SelectedValue?(this.PstDocGrid.Columns[1].IsVisible=!0,this.PstDocGrid.Columns[2].IsVisible=!0,this.PstDocGrid.Columns[3].IsVisible=!0):"1"==this.Filter.SelectedValue?(this.PstDocGrid.Columns[1].IsVisible=!1,this.PstDocGrid.Columns[2].IsVisible=!1,this.PstDocGrid.Columns[3].IsVisible=!0):"2"==this.Filter.SelectedValue&&(this.PstDocGrid.Columns[1].IsVisible=!0,this.PstDocGrid.Columns[2].IsVisible=!0,this.PstDocGrid.Columns[3].IsVisible=!1),this.LoadDefaultValues(),this.PstDocGrid.UpdateFooter())}LoadDefaultValues(){if(null!=this.oparent.dsPart&&this.oparent.dsPart.Tables.length>5&&this.oparent.dsPart.Tables[5].length>0){this.PstDocGrid.Clear();var t=this.oparent.dsPart.Tables[5].Compute("sum","RENT"),e=this.oparent.SelectedUnits.split(",");let s;if(s=a.e.DoubleTryParse(this.oparent.TotalYears.Text),"0"==this.Filter.SelectedValue&&this.oparent.EndDate.Date>this.oparent.StartDate.Date.AddYears(1))for(let o=0;o<e.length;o++){let r=null;if(null!=this.oparent.dsPart&&this.oparent.dsPart.Tables[5].length>0&&(r=this.oparent.dsPart.Tables[5].filter(t=>t.UnitID==e[o])),null!=r&&r.length>0){let e=parseFloat(this.selectedrow.Amount.toString())*parseFloat(r[0].RENT);null!=t&&parseFloat(t)>0&&(e/=parseFloat(t));let o=e/s;for(let t=0;t<s;t++){let e=this.PstDocGrid.NewRow();e.FromDate=this.oparent.StartDate.Date.AddYears(t).ToString(i.a.SessionManager.Preferences["Date Format"]),e.FromDate_key=this.oparent.StartDate.Date.AddYears(t),t==s-1?(e.ToDate=this.oparent.EndDate.Date.ToString(i.a.SessionManager.Preferences["Date Format"]),e.ToDate_key=this.oparent.EndDate.Date):(e.ToDate=this.oparent.StartDate.Date.AddYears(t+1).AddDays(-1).ToString(i.a.SessionManager.Preferences["Date Format"]),e.ToDate_key=this.oparent.StartDate.Date.AddYears(t+1).AddDays(-1)),e.Unit_key=r[0].UnitID.toString(),a.e.IsEmpty(r[0].RENT)||(e.Amount=o.ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()),e.Rate=(parseFloat(e.Amount)/parseFloat(r[0].RentableArea.toString())).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString())),e.Discount=0,e.ActAmount=e.Amount.toString(),e.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(e)}}}else if("1"==this.Filter.SelectedValue){let s=parseFloat(this.selectedrow.Amount.toString());if(s.ToString("N2")==parseFloat(t).ToString("N2"))for(let t=0;t<e.length;t++){let s=this.PstDocGrid.NewRow();s.FromDate=this.oparent.StartDate.Date.ToString(i.a.SessionManager.Preferences["Date Format"]),s.FromDate_key=this.oparent.StartDate.Date,s.ToDate=this.oparent.StartDate.Date.ToString(i.a.SessionManager.Preferences["Date Format"]),s.ToDate_key=this.oparent.StartDate.Date;let o=null;null!=this.oparent.dsPart&&this.oparent.dsPart.Tables[5].length>0&&(o=this.oparent.dsPart.Tables[5].filter(s=>s.UnitID==e[t])),null!=o&&o.length>0&&(s.Unit_key=o[0].UnitID.toString(),a.e.IsEmpty(o[0].RENT)||(s.Amount=parseFloat(o[0].RENT).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()),s.Rate=(parseFloat(s.Amount)/parseFloat(o[0].RentableArea.toString())).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString())),s.Discount=0,s.ActAmount=s.Amount.toString()),s.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(s)}else for(let o=0;o<e.length;o++){let r=this.PstDocGrid.NewRow();r.FromDate=this.oparent.StartDate.Date.ToString(i.a.SessionManager.Preferences["Date Format"]),r.FromDate_key=this.oparent.StartDate.Date,r.ToDate=this.oparent.StartDate.Date.ToString(i.a.SessionManager.Preferences["Date Format"]),r.ToDate_key=this.oparent.StartDate.Date;let n=null;null!=this.oparent.dsPart&&this.oparent.dsPart.Tables[5].length>0&&(n=this.oparent.dsPart.Tables[5].filter(t=>t.UnitID==e[o])),null!=n&&n.length>0&&(r.Unit_key=n[0].UnitID.toString(),a.e.IsEmpty(n[0].RENT)||(r.Amount=null!=t?(s*parseFloat(n[0].RENT)/parseFloat(t)).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()):(s*parseFloat(n[0].RENT)).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()),r.Rate=(parseFloat(r.Amount)/parseFloat(n[0].RentableArea.toString())).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString())),r.Discount=0,r.ActAmount=r.Amount.toString()),r.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(r)}}else if("2"==this.Filter.SelectedValue)for(let t=0;t<s;t++){let e=this.PstDocGrid.NewRow();e.FromDate=this.oparent.StartDate.Date.AddYears(t).ToString(i.a.SessionManager.Preferences["Date Format"]),e.FromDate_key=this.oparent.StartDate.Date.AddYears(t),t==s-1?(e.ToDate=this.oparent.EndDate.Date.ToString(i.a.SessionManager.Preferences["Date Format"]),e.ToDate_key=this.oparent.EndDate.Date):(e.ToDate=this.oparent.StartDate.Date.AddYears(t+1).AddDays(-1).ToString(i.a.SessionManager.Preferences["Date Format"]),e.ToDate_key=this.oparent.StartDate.Date.AddYears(t+1).AddDays(-1)),e.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(e)}this.PstDocGrid.Columns[3].IsVisible&&(this.PstDocGrid.RefreshGrid=!0);for(let t=0;t<5;t++){let t=this.PstDocGrid.NewRow();t.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(t)}}}SearchGrid(){if(a.e.IsEmpty(this.SearchText))return;let t="";if(""!=this.SearchCols.SelectedValue)t=this.SearchCols.SelectedValue;else{if(!(this.SearchCols.Items.length>0))return;t=this.SearchCols.Items[0].Value}if(!this.PstDocGridTableColumns.Contains(t))return;let e=this.PstDocGrid.SelectedIndex;-1==e&&(e=0);for(let s=0;s<this.PstDocGrid.Table.length;s++)if(e<this.PstDocGrid.Table.length-1?e++:e=0,!a.e.IsEmpty(this.PstDocGrid.Table[e][t]))switch(this.Options.SelectedValue){case"1":if(this.PstDocGrid.Table[e][t].toString().toLowerCase()==this.SearchText.toLowerCase())return void this.Setselectedrow(e);break;case"2":if(this.PstDocGrid.Table[e][t].toString().toLowerCase()!=this.SearchText.toLowerCase())return void this.Setselectedrow(e);break;case"3":if(this.PstDocGrid.Table[e][t].toString().toLowerCase().startsWith(this.SearchText.toLowerCase()))return void this.Setselectedrow(e);break;case"4":if(this.PstDocGrid.Table[e][t].toString().toLowerCase().endsWith(this.SearchText.toLowerCase()))return void this.Setselectedrow(e);break;case"5":if(this.PstDocGrid.Table[e][t].toString().toLowerCase().Contains(this.SearchText.toLowerCase()))return void this.Setselectedrow(e);break;case"6":if(!this.PstDocGrid.Table[e][t].toString().toLowerCase().Contains(this.SearchText.toLowerCase()))return void this.Setselectedrow(e)}}Setselectedrow(t){this.PstDocGrid.SelectedItem=this.PstDocGrid.Table[t]}}}}]);
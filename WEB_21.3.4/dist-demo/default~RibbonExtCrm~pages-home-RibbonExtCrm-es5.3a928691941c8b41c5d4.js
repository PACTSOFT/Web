function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,s){return t&&_defineProperties(e.prototype,t),s&&_defineProperties(e,s),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var s,i=_getPrototypeOf(e);if(t){var a=_getPrototypeOf(this).constructor;s=Reflect.construct(i,arguments,a)}else s=i.apply(this,arguments);return _possibleConstructorReturn(this,s)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[55,141,150,160],{D3Vc:function(e,t,s){"use strict";s.r(t),s.d(t,"RibbonExtCrm",(function(){return ye}));var i=s("Do2H"),a=s("vwWw"),o=s("mrSG"),n=s("Lp6j"),l=s("eQJW"),r=s("ScVY"),d=s("VxiT"),h=s("EQd/"),c=s("n56n"),u=s("0/4Q"),C=s("JIg3"),m=s("EggS"),b=s("EuF+"),p=s("v8xd"),S=function(e){_inherits(s,e);var t=_createSuper(s);function s(e,i,a,o,n){var l;return _classCallCheck(this,s),(l=t.call(this)).Height=700,l.obj=new m.a,l.ScreenObject=new d.a,l.ParentId=0,l.CustomerCode=null,l.CustomerName=null,l.Status=null,l.Group=null,l.QuickAddVisibility=!1,l.DetailButtonVisibility=!0,l.RetVal=0,l.Load(e,i,a,i>0&&1==o||o,n),l}return _createClass(s,[{key:"Load",value:function(e,t,s,a,o){var n=this;this.Parent=o,this.CustomerID=e,this.obj.CustomerID=this.CustomerID,this.ScreenObject.LoadQuickScreen(this,83,a),this.CustomerCode=this.ScreenObject.GetQuickCode(24200),this.CustomerName=this.ScreenObject.GetQuickText(24201),this.Status=this.ScreenObject.GetQuickCombo(24204),this.ParentId=s,this.obj.ParentID=s,this.obj.IsGroup=a,null!=this.Status&&(this.ScreenObject.Data.Tables[3].forEach((function(e){n.Status.Items.push(u.d.ComboBoxItems_2(e.Status.toString(),e.StatusID.toString()))})),this.Status.SelectedValue="393"),this.ScreenObject.InitAutoCode(this.ScreenObject.Data.Tables[6],this.obj.IsGroup),this.obj.CustomerID>0&&0==a?(this.LoadEditData(),null!=this.Group&&(this.Group.Enable=!1,this.Group.CCID=83,this.Group.TypeID=2)):(this.obj.GUID="",null!=this.Group&&(this.Group.CCID=83,this.Group.TypeID=2)),this.DisplayName=this.ScreenName,this.obj.SelectedNodeID=t,this.obj.IsGroup=a,0==this.CustomerID&&this.AutoGenerateCode();var r=this.ScreenObject.Data.Tables[5].filter((function(e){return"CapsLock"==e.Name}));r.length>0&&Object(l.j)(r[0].Value)&&null!=this.CustomerName&&(this.CustomerName.IsAllCaps=!0),(r=this.ScreenObject.Data.Tables[5].filter((function(e){return"CapsToFirstLetter"==e.Name}))).length>0&&Object(l.j)(r[0].Value)&&null!=this.CustomerName&&(this.CustomerName.IsFirstLetterCaps=!0),a?(this.DetailButtonVisibility=!1,this.CustomerID>0?(this.LoadEditData(),this.Title=i.a.GetResource("Customer_EditGroup")):this.Title=i.a.GetResource("Customer_AddGroup")):this.Title=i.a.GetResource(this.CustomerID>0?"Customer_EditCustomer":"Customer_AddCustomer"),this.QuickAddVisibility=!0,this.DisplayName=this.Title,null!=this.Group&&(this.Group.SelectedValue=s),Logger.InfoLog("QuickAddCustomersViewModel::Exiting QuickAddCustomersViewModel")}},{key:"AutoGenerateCode",value:function(){0==this.CustomerID&&null!=this.CustomerCode&&this.ScreenObject.SetAutoCode(this.CustomerCode,this.obj.IsGroup,this.ParentId,this.ScreenObject.Data.Tables[6])}},{key:"LoadEditData",value:function(){Logger.InfoLog("QuickAddCustomersViewModel::Entering LoadEditData");var e=this.obj.GetCustomerDetails();null!=this.CustomerCode&&(this.CustomerCode.Text=this.obj.CustomerCode,(this.ScreenObject.InheritParentCode||this.ScreenObject.IsAutoCode)&&(this.CustomerCode.Enable=!1));var t=null;e.Tables[7].length>0&&(t=e.Tables[7][0]),this.ScreenObject.FillControls(e.Tables[0][0],e.Tables[1][0],t,null),null!=this.Group&&(this.Group.SelectedValue=parseInt(e.Tables[0][0].ParentID)),Logger.InfoLog("QuickAddCustomersViewModel::Exiting LoadEditData")}},{key:"OnSaveCustomer",value:function(e){return Object(o.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var s,a,o,l,r,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("Cancel"!=e.toString()){t.next=4;break}null!=this.Parent?(this.Parent.QuickAddCustomersVisibility=!1,this.Parent.SetDetailsVisibile(),this.QuickAddVisibility=!1,this.Parent.DetailsVisibility=!0):i.a.page.HideDialog(),t.next=40;break;case 4:if(Logger.InfoLog("QuickAddCustomersViewModel::Entering OnSaveCustomer"),"Details"!=e.toString()){t.next=10;break}i.a.page.HideDialog(),s=new b.a(this.obj.CustomerID,this.obj.SelectedNodeID,this.obj.ParentID,this.obj.IsGroup),i.a.page.addNewTab({component:p.AddCustomerComponent,params:{obj:s}}),t.next=40;break;case 10:if(t.prev=10,a=this.ScreenObject.ValidateData(),n.e.IsEmpty(a)){t.next=14;break}return t.abrupt("return",(this.DisplayMessage=a,void(this.MessageVisibility=!0)));case 14:if(0!=this.obj.CustomerID){t.next=28;break}if(null==this.CustomerCode){t.next=21;break}if(o={StrCode:this.obj.CustomerCode,CodePrefix:this.obj.CodePrefix,CodeNumber:this.obj.CodeNumber},this.DisplayMessage=this.ScreenObject.SetAutoCodeParams_3(this.CustomerCode,this.ParentId,this.ScreenObject.Data.Tables[6],o),this.obj.CustomerCode=o.StrCode,this.obj.CodePrefix=o.CodePrefix,this.obj.CodeNumber=o.CodeNumber,!(this.DisplayMessage.length>0)){t.next=19;break}return t.abrupt("return");case 19:t.next=22;break;case 21:this.obj.CustomerCode=null!=this.CustomerCode?this.CustomerCode.Text:"";case 22:if(null!=this.CustomerName&&null!=this.CustomerName.Text&&""!=this.CustomerName.Text.Trim()&&(this.obj.CustomerName=this.CustomerName.Text),null==this.obj.AliasName&&(this.obj.AliasName=""),this.obj.SelectedNodeID=null!=this.Group&&this.Group.SelectedValue>0?this.Group.SelectedValue:this.ParentId,null!=this.Status&&this.Status.Enable&&null!=this.Status.SelectedValue&&""!=this.Status.SelectedValue&&(this.obj.StatusID=parseInt(this.Status.SelectedValue)),0==this.CustomerID&&(this.obj.AliasName=this.obj.CustomerName),this.obj.ContactsXML="",this.obj.NotesXML="",this.obj.AttachmetsXML="",this.obj.AddressXML="",this.obj.CustomFieldsQuery=this.ScreenObject.GetQuickExtraFieldsQuery(),this.obj.CustomCostCenterFieldsQuery=this.ScreenObject.GetQuickExtraCCFieldsQuery(),this.obj.PrimaryContactQuery="",this.ScreenObject.ValidateDataonSave()){t.next=24;break}return t.abrupt("return");case 24:l=this.obj.SaveCustomer(),this.DisplayMessage=l.Message,this.RetVal=l.RetValue,t.next=34;break;case 28:if(this.obj.StatusID=this.ScreenObject.GetTextComboValue_int(24204,0),r=this.ScreenObject.GetStaticFieldsQuery(),this.obj.StaticFieldsQuery=r,this.obj.CustomFieldsQuery=this.ScreenObject.GetQuickExtraFieldsQuery(),this.obj.CustomCostCenterFieldsQuery=this.ScreenObject.GetQuickExtraCCFieldsQuery(),this.ScreenObject.ValidateDataonSave()){t.next=32;break}return t.abrupt("return");case 32:d=this.obj.SaveCustomerQuick(),this.DisplayMessage=d.Message,this.RetVal=d.RetValue;case 34:this.MessageVisibility=!0,this.RetVal>0&&(this.AutoGenerateCode(),null!=this.CustomerName&&(this.CustomerName.Text=""),null!=this.Group&&(this.Group.SelectedValue=this.ParentId),null!=this.Parent&&(null!=this.Parent.SelectedNode&&(this.Parent.tree[0].SetFocusNodeID=this.Parent.SelectedNode.Id),this.Parent.Refresh()),this.ScreenObject.Clear(),null!=this.CustomerCode&&(this.CustomerCode.Text=""),Logger.InfoLog("QuickAddCustomersViewModel::Exiting OnSaveCustomer")),t.next=40;break;case 37:t.prev=37,t.t0=t.catch(10),Logger.ErrorLog("QuickAddCustomersViewModel:: OnSaveCustomer"+t.t0.stack);case 40:case"end":return t.stop()}}),t,this,[[10,37]])})))}},{key:"GetCustomFieldsQuery",value:function(){var e="";return this.ScreenObject.CustomFields.forEach((function(t){(t instanceof h.d||t instanceof u.e||t instanceof C.a)&&(null,e+=t.DBColumnName+"='null',")})),e.toString()}},{key:"GetCustomCostCenterFieldsQuery",value:function(){var e="";return this.ScreenObject.CustomFields.forEach((function(t){t instanceof c.b&&(null,e+=t.DBColumnName+"='null',")})),e}},{key:"CustomerID",get:function(){return this.obj.CustomerID},set:function(e){this.obj.CustomerID=e}}]),s}(r.b),D=s("NkMH"),g=s("CQvG"),T=s("DKUf"),I=s("r2z3"),y=s("2mtM"),V=s("ThYU"),f=s("c6C+"),v=s("8BPh"),w=s("xnJf"),L=s("THE7"),M=s("OvA8"),A=s("RJs6"),O=s("4HhE"),N=s("jgdN"),E=s("W7OG"),x=s("GQfG"),P=s("Jnyl"),R=s("wlFP"),k=function(e){_inherits(s,e);var t=_createSuper(s);function s(e){var a;_classCallCheck(this,s),(a=t.call(this)).ScreenObject=new d.a,a.ProductList=new c.b(0),a.FeedbackDate=new C.a(0),a.Technical=new h.c(0),a.SMS=new R.a(0),a.Email=new R.a(0),a.Commercial=new h.c(0),a.Fields=new Array,a.CVRVisibility=!0,a.SMSEmailVisibility=!1,a.GroupsItems=new Array,a.oText=null,a.oDate=null,a.oCombo=null,a.oTextArea=null,a.OComboText=null,a.Dset=null,a.CVRVisibility=!0,a.ClassName="CVRDataViewModel",a.FeedbackDate.Label=i.a.GetResource("Feed_Date"),a.ProductList.Label=i.a.GetResource("CVR_Product"),a.Technical.Label=i.a.GetResource("CVR_Technical"),a.Commercial.Label=i.a.GetResource("CVR_Commercial"),a.Title="CVR";try{a.ProductList.CCID=3,a.ProductList.TypeID=10,a.SMS.Label="SMS",a.Email.Label="Email",a.ProductList.Visible=!1;var o=i.a.crmService.GetFeedbackDetails(146);a.OnLoad(),a.Oparent=e;for(var n=0,l=0,r=0;r<o.Tables[0].length;r++){if("TEXT"!=o.Tables[0][r].UserColumnType.toString()&&"NUMERIC"!=o.Tables[0][r].UserColumnType.toString()||("True"==o.Tables[0][r].Iscolumninuse.toString()&&"True"==o.Tables[0][r].IsColumnUserDefined.toString()&&(a.oText=new h.d(0),a.oText.Label=o.Tables[0][r].UserColumnName.toString(),a.oText.DBColumnName=o.Tables[0][r].COSTCENTERCOLID.toString(),a.oText.SysColumnName=o.Tables[0][r].SysColumnName.toString(),a.oText.Column=n,a.oText.Row=l,l+=1),a.Fields.push(a.oText)),"DATE"==o.Tables[0][r].UserColumnType.toString()&&("True"==o.Tables[0][r].Iscolumninuse.toString()&&"True"==o.Tables[0][r].IsColumnUserDefined.toString()&&(a.oDate=new C.a(0),a.oDate.Label=o.Tables[0][r].UserColumnName.toString(),a.oDate.DBColumnName=o.Tables[0][r].COSTCENTERCOLID.toString(),a.oDate.SysColumnName=o.Tables[0][r].SysColumnName.toString(),a.oDate.Column=n,a.oDate.Row=l,l+=1),a.Fields.push(a.oDate)),"COMBOBOX"==o.Tables[0][r].UserColumnType.toString()){if("True"==o.Tables[0][r].Iscolumninuse.toString()&&"True"==o.Tables[0][r].IsColumnUserDefined.toString()){a.oCombo=new u.e(0),a.oCombo.Label=o.Tables[0][r].UserColumnName.toString(),a.oCombo.DBColumnName=o.Tables[0][r].COSTCENTERCOLID.toString(),a.oCombo.SysColumnName=o.Tables[0][r].SysColumnName.toString(),a.oCombo.Column=n;var m=o.Tables[0][r].UserProbableValues.toString().Trim();if(m.length>0){for(var b=m.split(";"),p=0;p<b.length;p++)a.oCombo.Items.push(u.d.ComboBoxItems_2(b[p],b[p]));a.oCombo.SelectedValue=a.oCombo.Items[0].Value}a.oCombo.Row=l,l+=1}a.Fields.push(a.oCombo)}"TEXTAREA"==o.Tables[0][r].UserColumnType.toString()&&("True"==o.Tables[0][r].Iscolumninuse.toString()&&"True"==o.Tables[0][r].IsColumnUserDefined.toString()&&(a.oTextArea=new h.c(0),a.oTextArea.Label=o.Tables[0][r].UserColumnName.toString(),a.oTextArea.DBColumnName=o.Tables[0][r].COSTCENTERCOLID.toString(),a.oTextArea.SysColumnName=o.Tables[0][r].SysColumnName.toString(),a.oTextArea.Column=n,a.oTextArea.Row=l,l+=1),a.Fields.push(a.oTextArea)),"COMBOTEXT"==o.Tables[0][r].UserColumnType.toString()&&("True"==o.Tables[0][r].Iscolumninuse.toString()&&"True"==o.Tables[0][r].IsColumnUserDefined.toString()&&(a.OComboText=new P.a(0),a.OComboText.Label=o.Tables[0][r].UserColumnName.toString(),a.OComboText.DBColumnName=o.Tables[0][r].COSTCENTERCOLID.toString(),a.OComboText.SysColumnName=o.Tables[0][r].SysColumnName.toString(),a.OComboText.Column=n,a.OComboText.Row=l,l+=1),a.Fields.push(a.OComboText)),"LISTBOX"==o.Tables[0][r].UserColumnType.toString()&&("True"==o.Tables[0][r].Iscolumninuse.toString()&&"True"==o.Tables[0][r].IsColumnUserDefined.toString()&&(a.oPactCombo=new c.b(0),a.oPactCombo.CCID=parseInt(o.Tables[0][r].ColumnCostCenterID),a.oPactCombo.TypeID=0==o.Tables[0][r].ColumnCCListViewTypeID.toString().Trim().length?1:parseInt(o.Tables[0][r].ColumnCCListViewTypeID),a.oPactCombo.Label=o.Tables[0][r].UserColumnName.toString(),a.oPactCombo.DBColumnName=o.Tables[0][r].COSTCENTERCOLID.toString(),a.oPactCombo.SysColumnName=o.Tables[0][r].SysColumnName.toString(),a.oPactCombo.Column=n,a.oPactCombo.Row=l,l+=1),a.Fields.push(a.oPactCombo)),3==n&&(l+=1,n=0),n+=1}a.Dset=o}catch(S){throw Logger.ErrorLog("FeedbackViewModel:: FeedbackViewModel",S),S}return Logger.InfoLog("FeedbackViewModel::Exiting FeedbackViewModel"),a}return _createClass(s,[{key:"OnCheckedChanged",value:function(e){var t=e;if("0"==t.Value){if(this.GroupsItems.Contains(t))for(var s=0;s<this.GroupsItems.length;s++)this.GroupsItems[s].IsChecked=t.IsChecked}else t.IsChecked||this.GroupsItems.Contains(t)&&(this.GroupsItems[0].IsChecked=!1)}},{key:"OnLoad",value:function(){var e=i.a.common.GetWorkFlowScreenDetails();if(null!=e&&e.Tables.length>2){this.GroupsItems.push(u.c.CheckedListBoxItem_3("All","0"));for(var t=0;t<e.Tables[2].length;t++)this.GroupsItems.push(u.c.CheckedListBoxItem_3(e.Tables[2][t].GroupName.toString(),e.Tables[2][t].GroupID.toString()))}}},{key:"OnSave",value:function(e){try{if("EmailCancel"==e.toString())i.a.page.HideDialog();else if("Cancel"==e.toString())i.a.page.HideDialog();else if("Ok"==e.toString())i.a.page.HideDialog();else if("Save"==e.toString()){if(null==this.Oparent.SelectedRow){var t=this.Oparent.FeedBackDataObj.NewRow();t.Date=this.FeedbackDate.Date.ToString("dd/MMM/yyyy"),t.Product_Key=this.ProductList.SelectedValue,t.Product=this.ProductList.Text,t.Technical=this.Technical.Text,t.Commercial=this.Commercial.Text;for(var s=0;s<this.Fields.length;s++){var a=this.Fields[s];a instanceof h.d&&(this.oText=a,t[this.oText.SysColumnName]=this.oText.Text),a instanceof C.a&&(this.oDate=a,t[this.oDate.SysColumnName]=this.oDate.Date),a instanceof u.e&&(this.oCombo=a,t[this.oCombo.SysColumnName]=this.oCombo.SelectedValue),a instanceof P.a&&(this.OComboText=a,t[this.OComboText.SysColumnName]=this.OComboText.TextBox.Text),a instanceof h.c&&(this.oTextArea=a,t[this.oTextArea.SysColumnName]=this.oTextArea.Text),a instanceof c.b&&(this.oPactCombo=a,t[this.oPactCombo.SysColumnName]=this.oPactCombo.SelectedValue)}this.Oparent.FeedBackDataObj.addRow(t)}else{this.Oparent.SelectedRow.Date=this.FeedbackDate.Date.ToString("dd/MMM/yyyy"),this.Oparent.SelectedRow.Product_Key=this.ProductList.SelectedValue,this.Oparent.SelectedRow.Technical=this.Technical.Text,this.Oparent.SelectedRow.Commercial=this.Commercial.Text,this.Oparent.SelectedRow.Product=this.ProductList.Text;for(var o=0;o<this.Fields.length;o++){var n=this.Fields[o];n instanceof h.d&&(this.oText=n,this.Oparent.SelectedRow[this.oText.SysColumnName]=this.oText.Text),n instanceof C.a&&(this.oDate=n,this.Oparent.SelectedRow[this.oDate.SysColumnName]=this.oDate.Date),n instanceof u.e&&(this.oCombo=n,this.Oparent.SelectedRow[this.oCombo.SysColumnName]=this.oCombo.SelectedValue),n instanceof P.a&&(this.OComboText=n,this.Oparent.SelectedRow[this.OComboText.SysColumnName]=this.OComboText.TextBox.Text),n instanceof h.c&&(this.oTextArea=n,this.Oparent.SelectedRow[this.oTextArea.SysColumnName]=this.oTextArea.Text),n instanceof c.b&&(this.oPactCombo=n,this.Oparent.SelectedRow[this.oPactCombo.SysColumnName]=this.oPactCombo.SelectedValue)}this.Oparent.FeedBackDataObj.updateRow(this.Oparent.SelectedRow),this.Oparent.SelectedRow=null}this.ProductList.SelectedValue=0,this.Commercial.Text="",this.Technical.Text="",this.ClearFields()}}catch(l){throw Logger.ErrorLog("FeedbackViewModel:: OnSave",l),l}Logger.InfoLog("FeedbackViewModel::Exiting OnSave")}},{key:"ClearFields",value:function(){for(var e=0;e<this.Fields.length;e++){var t=this.Fields[e];t instanceof h.d&&(this.oText=t,this.oText.Text=""),t instanceof C.a&&(this.oDate=t),t instanceof u.e&&(this.oCombo=t,this.oCombo.SelectedValue=""),t instanceof P.a&&(this.OComboText=t,this.OComboText.TextBox.Text=""),t instanceof h.c&&(this.oTextArea=t,this.oTextArea.Text=""),t instanceof c.b&&(this.oPactCombo=t,this.oPactCombo.SelectedValue=0)}}}]),s}(r.b),j=s("8B8H"),G=s("ockk"),F=s("Q5a/"),_=function(e){_inherits(s,e);var t=_createSuper(s);function s(e){var a;_classCallCheck(this,s),(a=t.call(this)).Module="CRM",a.Visible=!0,a.ColumnSpan="4",a.FeedBackDataObj=new j.a,a.res="";try{a.Parent=e,a.ClassName="ViewCVRViewModel";var o,n=i.a.crmService.GetFeedbackDetails(146).Tables[0];a.FeedBackDataObj.Table=[],a.FeedBackDataObj.TableColumns.push("Product"),a.FeedBackDataObj.TableColumns.push("Product_Key"),a.FeedBackDataObj.TableColumns.push("Date"),a.FeedBackDataObj.TableColumns.push("Technical"),a.FeedBackDataObj.TableColumns.push("Commercial"),a.FeedBackDataObj.TableColumns.push("Print");for(var l=1;l<=50;l++)a.FeedBackDataObj.TableColumns.push("Alpha"+l);var r=new Array;a.FeedBackDataObj.Columns=r,(o=new G.a).Header=i.a.GetResource("Print"),o.DisplayMember="Print",o.DataType="CheckBox",o.Width=50,o.IsVisible=!0,r.push(o),(o=new G.a).Header=i.a.GetResource("Feed_Date"),o.DisplayMember="Date",o.DataType="TEXTBOX",o.Width=150,o.IsVisible=!0,o.ReadOnly=!0,r.push(o),(o=new G.a).Header=i.a.GetResource("CVR_Product"),o.DisplayMember="Product",o.DataType="TEXTBOX",o.Width=150,o.IsVisible=!1,o.ReadOnly=!0,r.push(o),(o=new G.a).Header=i.a.GetResource("CVR_Technical"),o.DisplayMember="Technical",o.DataType="TEXTBOX",o.Width=150,o.IsVisible=!0,o.ReadOnly=!0,r.push(o),(o=new G.a).Header=i.a.GetResource("CVR_Commercial"),o.DisplayMember="Commercial",o.DataType="TEXTBOX",o.Width=150,o.IsVisible=!0,o.ReadOnly=!0,r.push(o);for(var d=0;d<n.length;d++)"True"==n[d].IsVisible.toString()&&((o=new G.a).Header=n[d].UserColumnName.toString(),o.DisplayMember=n[d].SysColumnName.toString(),o.DataType="TEXTBOX",o.Width=150,o.IsVisible=!0,o.ReadOnly=!0,r.push(o))}catch(h){throw Logger.ErrorLog("ViewFeedbackViewModel:: ViewFeedbackViewModel",h),h}return Logger.InfoLog("ViewFeedbackViewModel::Exiting ViewFeedbackViewModel"),a}return _createClass(s,[{key:"OnNewClick",value:function(e){"New"==e?(this.Parent.CVR=new k(this),this.Parent.CVR.ClearFields(),this.FeedBackDataObj.SelectedItem=null,this.Parent.CVR.CVRVisibility=!0,i.a.page.ShowDialog(this.Parent.CVR,F.a)):"Assign"==e&&(this.Parent.CVR.CVRVisibility=!1,this.Parent.CVR.SMSEmailVisibility=!0)}},{key:"OnCmnItem_Click",value:function(e){switch(Logger.InfoLog("ViewFeedbackViewModel::Entering OnCmnItem_Click"),this.Parent.CVRVisibility||(this.Parent.CVRVisibility=!0),e){case"EDIT":if(null!=this.SelectedRow){var t=this.SelectedRow;if(!n.e.IsEmpty(t.Date)){this.Parent.CVR.FeedbackDate.Date=new Date(t.Date),n.e.IsEmpty(t.Product)||(this.Parent.CVR.ProductList.SelectedValue=parseInt(t.Product_Key)),this.Parent.CVR.Technical.Text=t.Technical.toString(),this.Parent.CVR.Commercial.Text=t.Commercial.toString();for(var s,a=null,o=null,l=null,r=null,d=null,m=0;m<this.Parent.CVR.Fields.length;m++){var b=this.Parent.CVR.Fields[m];b instanceof h.d&&((a=b).Text=t[a.SysColumnName].toString()),b instanceof C.a&&((o=b).Date=new Date(t[o.SysColumnName].toString())),b instanceof u.e&&((l=b).SelectedValue=t[l.SysColumnName].toString()),b instanceof P.a&&((d=b).TextBox.Text=t[d.SysColumnName].toString()),b instanceof h.c&&((r=b).Text=t[r.SysColumnName].toString()),b instanceof c.b&&(""!=t[(s=b).SysColumnName].toString()&&null!=t[s.SysColumnName]&&(s.SelectedValue=parseInt(t[s.SysColumnName])))}}i.a.page.ShowDialog(this.Parent.CVR,F.a)}break;case"DELETE":null!=this.SelectedRow&&this.FeedBackDataObj.removeRow(this.SelectedRow)}Logger.InfoLog("ViewFeedbackViewModel::Exiting OnCmnItem_Click")}},{key:"OnMessageCallBack",value:function(){this.res="Yes"}},{key:"GetXML",value:function(){Logger.InfoLog("ViewFeedbackViewModel::Entering GetXML");try{var e="";e+="<XML>";for(var t=0;t<this.FeedBackData.length;t++)if(""!=this.FeedBackData[t].Date.toString()){e+="<Row ",e+=' Date="'+this.FeedBackData[t].Date+'"',e+=' Product="'+s.GetValidXml(this.FeedBackData[t].Product_Key.toString())+'"',e+=' Technical="'+s.GetValidXml(this.FeedBackData[t].Technical.toString())+'"',e+=' Commercial="'+s.GetValidXml(this.FeedBackData[t].Commercial.toString())+'"';for(var i=1;i<=50;i++)e+=" Alpha"+i+'="'+s.GetValidXml(this.FeedBackData[t]["Alpha"+i].toString())+'"';e+="></Row>  "}return(e+="</XML>").toString()}catch(a){return""}Logger.InfoLog("ViewFeedbackViewModel::Exiting GetXML")}},{key:"LoadData",value:function(e){try{for(var t=0;t<e.length;t++){var i=this.FeedBackDataObj.NewRow();i.Date=new Date(e[t].d).ToString("dd/MMM/yyyy"),i.Product=n.e.String(e[t].PRODUCT1),i.Product_Key=n.e.String(e[t].PRODUCTID),i.Technical=s.GetValidXmlReserve(n.e.String(e[t].TechnicalInfo)),i.Commercial=s.GetValidXmlReserve(n.e.String(e[t].CommercialInfo));for(var a=1;a<=50;a++)i["Alpha"+a]=s.GetValidXmlReserve(n.e.String(e[t]["Alpha"+a]));this.FeedBackDataObj.addRow(i)}}catch(o){throw o}Logger.InfoLog("ViewFeedbackViewModel::Exiting LoadData")}},{key:"angularGrid",get:function(){return this.FeedBackDataObj.angularGrid}},{key:"SelectedRow",get:function(){return this.FeedBackDataObj.SelectedItem},set:function(e){this.FeedBackDataObj.SelectedItem=e}},{key:"FeedBackData",get:function(){return this.FeedBackDataObj.Table}}],[{key:"GetValidXml",value:function(e){return(e=(e=(e=e.Replace("&","&amp;")).Replace("'","&apos;&apos;")).Replace('"',"&quot;")).Replace("<","&lt;")}},{key:"GetValidXmlReserve",value:function(e){return(e=(e=(e=e.Replace("&amp;","&")).Replace("''","'")).Replace("&quot;",'"')).Replace("&lt;","<")}}]),s}(r.b),B=s("E6JT"),U=s("nFYD"),X=s("N0rE"),H=s("wunX"),Q=s("7oCR"),W=function(e){_inherits(s,e);var t=_createSuper(s);function s(e,a,o){var l;return _classCallCheck(this,s),(l=t.call(this)).LED=new I.a,l.Oppor=new Q.a,l.ds=null,l.CCID=0,l.Leads=new R.a(86),l.AddressDetails=new R.a(86),l.Opportunity=new R.a(86),l.Account=new R.a(86),l.Customer=new R.a(86),l.AccountContactVisible=new R.a(2),l.CustomerContactVisible=new R.a(86),l.Contact=new R.a(86),l.Ret=0,l.Title=l.DisplayName=i.a.GetResource("CRMLead_ConvertTo"),l.Leads.DBColumnName="Leads",l.Opportunity.DBColumnName="Opportunity",l.AddressDetails.DBColumnName="AddressDetails",l.Account.DBColumnName="Account",l.Customer.DBColumnName="Customer",l.AccountContactVisible.DBColumnName="AccountContactVisible",l.CustomerContactVisible.DBColumnName="CustomerContactVisible",l.Contact.DBColumnName="Contact",l.Leads.Label=i.a.GetResource("Leads"),l.Opportunity.Label=i.a.GetResource("CRMLead_Opportunity"),l.AddressDetails.Label=i.a.GetResource("CRMLead_CopyContacts"),l.Account.Label=i.a.GetResource("CRMLead_Account"),l.Customer.Label=i.a.GetResource("CRMLead_Customer"),l.AccountContactVisible.Label=i.a.GetResource("CRMLead_CopyContacts"),l.CustomerContactVisible.Label=i.a.GetResource("CRMLead_CopyContacts"),l.Contact.Label=i.a.GetResource("CRMLead_Contact"),l.CustomerContactVisible.Visible=!1,l.AccountContactVisible.Visible=!1,l.AddressDetails.Visible=!1,l.Opportunity.CheckedChangedCommand.Subscribe(_assertThisInitialized(l),"Opportunity_PropertyChanged"),l.Account.CheckedChangedCommand.Subscribe(_assertThisInitialized(l),"Account_PropertyChanged"),l.Customer.CheckedChangedCommand.Subscribe(_assertThisInitialized(l),"Customer_PropertyChanged"),l.CCID=o,88==l.CCID?(l.Campgn.CampaignId=e,l.ds=l.Campgn.GetCompaignDetails(),0!=l.ds.Tables[21].length&&(l.Opportunity.IsChecked=!0,l.Opportunity.Enable=!1),0!=l.ds.Tables[22].length&&(l.Leads.IsChecked=!0,l.Leads.Enable=!1),l.Leads.Visible=!0,l.Opportunity.Visible=!0,l.Customer.Visible=!1,l.Account.Visible=!1,l.Contact.Visible=!1):89==l.CCID?(l.Oppor.OpportunityID=e,l.Leads.Visible=!1,l.Opportunity.Visible=!1,l.Account.Visible=!0,l.Contact.Visible=!1,l.Customer.Visible=!0,l.AddressDetails.Visible=!1,l.ds=l.Oppor.GetOpportunity(e),null!=l.ds&&l.ds.Tables.length>15&&0!=l.ds.Tables[16].length&&(l.Customer.IsChecked=!0,l.Customer.Enable=!1),null!=l.ds&&l.ds.Tables.length>16&&0!=l.ds.Tables[17].length&&(l.Account.IsChecked=!0,l.Account.Enable=!1),l.CustomerContactVisible.Visible=!1,l.AccountContactVisible.Visible=!1):(l.LED.LeadID=e,l.ds=a,l.Account.Enable=!0,l.Customer.Enable=!0,l.ds.Tables[0].length>0&&!n.e.IsEmpty(l.ds.Tables[0][0].Mode.toString())&&""!=l.ds.Tables[0][0].Mode.toString()&&("2"==l.ds.Tables[0][0].Mode.toString()&&(l.Account.Enable=!1),"3"==l.ds.Tables[0][0].Mode.toString()&&(l.Customer.Enable=!1)),l.ds.Tables[5].length>0&&(l.Opportunity.IsChecked=!0,l.Opportunity.Enable=!1,l.AddressDetails.Visible=!1),l.ds.Tables[6].length>0&&(l.Customer.IsChecked=!0,l.Customer.Enable=!1,l.CustomerContactVisible.Visible=!1),l.ds.Tables[14].length>0&&(l.Account.IsChecked=!0,l.Account.Enable=!1,l.AccountContactVisible.Visible=!1),(l.ds.Tables[7].length>0&&"0"!=l.ds.Tables[7][0][0].toString()||l.ds.Tables[0].length>0&&!n.e.IsEmpty(l.ds.Tables[0][0].ContactID.toString())&&""!=l.ds.Tables[0][0].ContactID.toString()&&"0"!=l.ds.Tables[0][0].ContactID.toString())&&(l.Contact.IsChecked=!0,l.Contact.Enable=!1),l.Opportunity.Visible=!!i.a.SessionManager.IsActionAssigned(86,"Convert_Opportunity"),l.Customer.Visible=!!i.a.SessionManager.IsActionAssigned(86,"Convert_Customer"),l.Account.Visible=!!i.a.SessionManager.IsActionAssigned(86,"Convert_Account"),l.Contact.Visible=!!i.a.SessionManager.IsActionAssigned(86,"Convert_Contact"),l.Leads.Visible=!1,l.Opportunity.Visible||l.Customer.Visible||l.Account.Visible||l.Contact.Visible||(l.DisplayMessage="Access Denied")),l}return _createClass(s,[{key:"Opportunity_PropertyChanged",value:function(e){86==this.Opportunity.DBColumnID&&this.Opportunity.IsChecked?this.AddressDetails.Visible=!0:86==this.Account.DBColumnID&&(this.AddressDetails.Visible=!1)}},{key:"Account_PropertyChanged",value:function(e){86==this.Account.DBColumnID&&this.Account.IsChecked?this.AccountContactVisible.Visible=!0:86==this.Account.DBColumnID&&(this.AccountContactVisible.Visible=!1)}},{key:"Customer_PropertyChanged",value:function(e){86==this.Customer.DBColumnID&&this.Customer.IsChecked?this.CustomerContactVisible.Visible=!0:86==this.Customer.DBColumnID&&(this.CustomerContactVisible.Visible=!1)}},{key:"OnSave",value:function(e){if("Cancel"==e)i.a.page.HideDialog();else if(86==this.CCID)if(null!=this.ds&&0!=this.ds.Tables[5].length&&0!=this.ds.Tables[6].length&&0!=this.ds.Tables[7].length)this.DisplayMessage="Already Converted";else if(Logger.InfoLog("Convertion :: Entering OnConvertionLead"),this.Opportunity.IsChecked||this.Contact.IsChecked||this.Customer.IsChecked||this.Account.IsChecked){this.LED.ConvOpportunity=this.Opportunity.IsChecked,this.LED.ConvContact=this.Contact.IsChecked,this.LED.ConvCustomer=this.Customer.IsChecked,this.LED.ConvAccount=this.Account.IsChecked,this.LED.ConvCustomerContacts=this.CustomerContactVisible.IsChecked,this.LED.ConvAccountContacts=this.AccountContactVisible.IsChecked,this.LED.ConvLeadAddressDetails=this.AddressDetails.IsChecked;var t=this.LED.ConvertLead();this.DisplayMessage=t.Message,this.Ret=t.RetValue,this.Ret>0&&(this.Opportunity.Enable=!this.Opportunity.IsChecked,this.Customer.Enable=!this.Customer.IsChecked,this.Account.Enable=!this.Account.IsChecked,this.Contact.Enable=!this.Contact.IsChecked)}else this.DisplayMessage="Select atleast one option";else if(88==this.CCID)if(this.Opportunity.IsChecked||this.Leads.IsChecked){this.LED.ConvOpportunity=this.Opportunity.IsChecked,this.LED.ConvLead=this.Leads.IsChecked,this.LED.CampaignID=this.Campgn.CampaignId;var s=this.LED.ConvertLeadFromCampaign();this.DisplayMessage=s.Message,this.Ret=s.RetValue,this.Ret>0&&(this.Opportunity.Enable=!this.Opportunity.IsChecked,this.Leads.Enable=!this.Leads.IsChecked)}else this.DisplayMessage="Select atleast one option";else if(89==this.CCID)if(this.Customer.IsChecked||this.Account.IsChecked){this.Oppor.ConvAccount=this.Account.IsChecked,this.Oppor.ConvCustomer=this.Customer.IsChecked,this.Oppor.ConvCustomerContacts=this.CustomerContactVisible.IsChecked,this.Oppor.ConvAccountContacts=this.AccountContactVisible.IsChecked;var a=this.Oppor.ConvertOpportunity();this.DisplayMessage=a.Message,this.Ret=a.RetValue,this.Ret>0&&(this.Customer.Enable=!this.Customer.IsChecked,this.Account.Enable=!this.Account.IsChecked)}else this.DisplayMessage="Select atleast one option"}}]),s}(r.b),z=s("/W8Q"),J=s("EPb/"),K=s("CXnT"),Y=s("wnwj"),q=s("7i9q"),Z=s("2Dtv"),$=s("yWgc"),ee=s("F+4J"),te=function(e){_inherits(s,e);var t=_createSuper(s);function s(e){var i;return _classCallCheck(this,s),(i=t.call(this)).ColumnSpan="4",i.ListObj=new j.a,Logger.InfoLog("ViewAssignCRMHistroyViewModel::Entering ViewAssignCRMHistroyViewModel with Parent="+e),i.Parent=e,i.ListObj.Table=[],i.ListObj.Columns=[],i.ListObj.TableColumns.push("From"),i.ListObj.TableColumns.push("AssignFrom"),i.ListObj.TableColumns.push("AssignTo"),i.ListObj.TableColumns.push("Date"),i.ListObj.TableColumns.push("Description"),Logger.InfoLog("ViewAssignCRMHistroyViewModel::Exiting ViewAssignCRMHistroyViewModel "),i}return _createClass(s,[{key:"LoadCRMHistroy_1",value:function(e,t){Logger.InfoLog("ViewAssignCRMHistroyViewModel::Entering LoadHistroy");try{this.ListObj.Clear();var s=(new ee.a).GetCRMHistoryDetails(e,t);if(null!=s&&s.Tables.length>0&&s.Tables[0].length>0)for(var a=0;a<s.Tables[0].length;a++){var o=this.ListObj.NewRow();o.From=s.Tables[0][a].IsFrom.toString(),o.AssignFrom=s.Tables[0][a].ASSIGNEDFROM.toString(),o.AssignTo=s.Tables[0][a].ASSIGNEDTO.toString(),o.Date=new Date(s.Tables[0][a].DATE).ToString(i.a.SessionManager.Preferences["Date Format"].toString()),o.Description=s.Tables[0][a].Description.toString(),this.ListObj.addRow(o)}}catch(n){Logger.InfoLog("ViewAssignCRMHistroyViewModel::Exiting LoadHistroy")}Logger.InfoLog("ViewAssignCRMHistroyViewModel::Exiting LoadHistroy")}},{key:"LoadCRMHistroy",value:function(e){try{if(this.ListObj.Clear(),null!=e&&e.length>0)for(var t=0;t<e.length;t++){var s=this.ListObj.NewRow();s.From=e.Rows[t].IsFrom.toString(),s.AssignFrom=e.Rows[t].ASSIGNEDFROM.toString(),s.AssignTo=e.Rows[t].ASSIGNEDTO.toString(),s.Date=new Date(e.Rows[t].DATE).ToString(i.a.SessionManager.Preferences["Date Format"].toString()),s.Description=e.Rows[t].Description.toString(),this.ListObj.addRow(s)}}catch(a){}}}]),s}(r.b),se=function(e){_inherits(s,e);var t=_createSuper(s);function s(e,a,o){var r;_classCallCheck(this,s),(r=t.call(this)).timerDraft=new n.d,r.LED=new I.a,r.LeadID=0,r.DefaultcontactsVisible=!1,r.ContactsBasedOnLeads=!1,r.IncludeNewInMode=!1,r.PrintVisible=!1,r.NextPreviousVisibility=!0,r.AssignVisiblity=!1,r.IsAssign=!1,r.CloseVisiblity=!1,r.ContactVisibility=!1,r.CostCenterID=0,r.ScreenObject=new d.a,r.ButtonEnable=!0,r.Code=new h.a(24198),r.Mode=new u.e(26637),r.Date=new C.a(25068),r.Status=new u.e(24400),r.Subject=new h.d(25069),r.AssignedTo=new h.d(25534),r.ContactList=new u.e(26651),r.Company=new c.c(24399),r.Source=new c.b(25071),r.Rating=new c.b(25072),r.Campaign=new c.b(25073),r.Industry=new c.b(25074),r.Salutation=new c.b(25042),r.FirstName=new h.d(25039),r.MiddleName=new h.d(25040),r.LastName=new h.d(25041),r.JobTitle=new h.d(25043),r.Phone1=new h.d(25044),r.Phone2=new h.d(25045),r.Email=new h.d(25046),r.Fax=new h.d(25047),r.Department=new h.d(25048),r.Role=new c.b(25049),r.Gender=new u.e(25057),r.Birthday=new C.a(25058),r.Anniversary=new C.a(25059),r.Address1=new h.d(25050),r.Address2=new h.d(25051),r.Address3=new h.d(25052),r.City=new h.d(25053),r.State=new h.d(25054),r.Zip=new h.d(25055),r.Country=new u.e(25056),r.CreatedDate=new C.a(25535),r.Owner=new h.d(25532),r.ContactPersonColID=0,r.PrimaryVisibility=!1,r.ActVisibility=!1,r.NodeID=0,r.StatusColor="#736F6F",r.ProductVisiblity=!1,r.Ret=0,r.ParentId=1,r.IsGroup=!1,r.dvContacts=null,r.dvContactsTable=null,r.dsLeadData=null,r.isCust=!1,r.isAccount=!1,r.isLead=!1,r.lstModeDetails=new Array,r.bShowAssignedCustomers=!1,r.ClassName="AddEditLeads";try{if(r.ParentId=a,r.IsGroup=o,r.LED.SelectedNodeID=r.ParentId,r.ScreenObject.LoadScreen_2(_assertThisInitialized(r),86),r.CostCenterID=86,r.NodeID=e,r.Company.Code.Visible=!1,r.Company.TextVisible=!0,null!=r.ScreenObject.Data&&r.ScreenObject.Data.Tables[4].length>0){var m=r.ScreenObject.Data.Tables[4].filter((function(e){return"ActContactPerson"==e.Name}));m.length>0&&!n.e.IsEmpty(m[0].Value)&&(r.ContactPersonColID=parseInt(m[0].Value)),(m=r.ScreenObject.Data.Tables[4].filter((function(e){return"AutoDraft"==e.Name}))).length>0&&!n.e.IsEmpty(m[0].Value)&&(r.timerDraft.Enabled=Object(l.j)(m[0].Value)),r.timerDraft.Enabled&&(m=r.ScreenObject.Data.Tables[4].filter((function(e){return"AutoDraftTime"==e.Name})),r.timerDraft.Interval=m.length>0&&!n.e.IsEmpty(m[0].Value)?1e3*parseInt(m[0].Value):6e4,r.timerDraft.Elapsed(_assertThisInitialized(r),"timerDraft_Elapsed")),(m=r.ScreenObject.Data.Tables[4].filter((function(e){return"ContactsBasedOnLeads"==e.Name}))).length>0&&!n.e.IsEmpty(m[0].Value)&&(r.ContactsBasedOnLeads=Object(l.j)(m[0].Value)),(m=r.ScreenObject.Data.Tables[4].filter((function(e){return"IncludeNewInMode"==e.Name}))).length>0&&!n.e.IsEmpty(m[0].Value)&&(r.IncludeNewInMode=Object(l.j)(m[0].Value)),(m=r.ScreenObject.Data.Tables[4].filter((function(e){return"CapsLock"==e.Name}))).length>0&&Object(l.j)(m[0].Value)&&(r.Company.IsAllCaps=!0),(m=r.ScreenObject.Data.Tables[4].filter((function(e){return"CapsToFirstLetter"==e.Name}))).length>0&&Object(l.j)(m[0].Value)&&(r.Company.IsFirstLetterCaps=!0)}if(r.ViewContactMethod=new X.ContactMethod,r.LeadID=e,r.ViewAssignHistroy=new y.a(_assertThisInitialized(r)),r.ViewCRMHistroy=new te(_assertThisInitialized(r)),r.ViewActivities=new g.b(_assertThisInitialized(r)),r.Activities=new T.a(_assertThisInitialized(r),!1),r.ViewActivities.Activities=r.Activities,r.ViewNotes=new A.a(_assertThisInitialized(r)),r.ViewFeedback=new U.a(_assertThisInitialized(r)),r.ViewCVRViewModel=new _(_assertThisInitialized(r)),r.Note=new f.AddNoteViewModel,r.Attachment=new w.AddAttachmentViewModel,r.CVR=new k(r.ViewCVRViewModel),r.Feedback=new B.a(r.ViewFeedback),r.Mode.SelectionChangedCommand.Subscribe(_assertThisInitialized(r),"OnModeChange"),r.Status.SelectionChangedCommand.Subscribe(_assertThisInitialized(r),"onStatusSelectionChanged"),r.ContactList.SelectionChangedCommand.Subscribe(_assertThisInitialized(r),"onContactlistChanged"),r.ViewAttachments=new M.ViewAttachmentViewModel(_assertThisInitialized(r)),r.LeadsProduct=new E.a(_assertThisInitialized(r),86),r.PriContact=new v.a,r.PriContact.QuickAddDContactViewModel_1(_assertThisInitialized(r)),r.PriContact.IsPrimaryContact=!0,r.ViewContacts=new L.a(_assertThisInitialized(r)),r.ButtonApprove=new D.a,r.ButtonClose=new D.a,r.ButtonConvert=new D.a,r.ButtonAssign=new D.a,r.ButtonSave=new D.a,r.ButtonEmail=new D.a,r.worker_DoWork(),r.AutoGenerateCode(),0==r.LeadID?(r.Owner.Text=i.a.SessionManager.UserName,r.CreatedDate.Text=(new Date).ToString(i.a.SessionManager.Preferences["Date Format"]+" hh:mm a"),r.DisplayName=i.a.GetResource("CRMLead_AddLead"),r.LED.GUID="Guid",r.LeadStatus="UnApproved",r.NextPreviousVisibility=!1,r.ButtonConvert.Visible=!1,r.ButtonApprove.Visible=!1,r.ButtonClose.Visible=!1,r.Campaign.CCID=88,r.Campaign.TypeID=2):(r.Campaign.CCID=88,r.Campaign.TypeID=2,r.ButtonConvert.Visible=!0,r.ButtonApprove.Visible=!0,r.Load(r.LeadID),r.DisplayName=i.a.GetResource("CRMLead_EditLead"),r.PrintVisible=!0),r.Title=r.DisplayName,r.loadtabs(),r.ScreenObject.CheckEstimateRevenueMapping(r.LeadsProduct.DestProductValueMapping),0==r.LeadID?i.a.SessionManager.HideUnathorizedAccess?r.ButtonSave.Visible=i.a.SessionManager.IsActionAssigned(86,"Create"):r.ButtonSave.Enable=i.a.SessionManager.IsActionAssigned(86,"Create"):i.a.SessionManager.HideUnathorizedAccess?r.ButtonSave.Visible=i.a.SessionManager.IsActionAssigned(86,"Update"):r.ButtonSave.Enable=i.a.SessionManager.IsActionAssigned(86,"Update"),0!=r.LeadID&&(i.a.SessionManager.HideUnathorizedAccess?r.ButtonApprove.Visible=i.a.SessionManager.IsActionAssigned(86,"Approved"):r.ButtonApprove.Enable=i.a.SessionManager.IsActionAssigned(86,"Approved")),0!=r.LeadID?(i.a.SessionManager.HideUnathorizedAccess?r.ButtonConvert.Visible=i.a.SessionManager.IsActionAssigned(86,"Convert"):r.ButtonConvert.Enable=i.a.SessionManager.IsActionAssigned(86,"Convert"),i.a.SessionManager.HideUnathorizedAccess?r.ButtonAssign.Visible=i.a.SessionManager.IsActionAssigned(86,"Assign"):r.ButtonAssign.Enable=i.a.SessionManager.IsActionAssigned(86,"Assign")):r.ButtonAssign.Visible=!1,0!=r.LeadID&&(i.a.SessionManager.HideUnathorizedAccess?r.ButtonEmail.Visible=i.a.SessionManager.IsActionAssigned(86,"Email"):r.ButtonEmail.Enable=i.a.SessionManager.IsActionAssigned(86,"Email")),r.Owner.Enable=!1,r.AssignedTo.Enable=!1,r.CreatedDate.Enable=!1,r.Company.Code.SelectionChangedCommand.Subscribe(_assertThisInitialized(r),"onCompanySelectionChanged"),r.ContactList.SelectionChangedCommand.Subscribe(_assertThisInitialized(r),"onContactlistChanged"),r.PrimaryVisibility=!0,r.ContactVisibility=!1,r.PriContact.Visiblebtns=!1,null!=r.ScreenObject.Data&&r.ScreenObject.Data.Tables[4].length>0){var b=r.ScreenObject.Data.Tables[4].filter((function(e){return"HidePrimaryContact"==e.Name}));r.PrimaryVisibility=b.length>0&&!Object(l.j)(b[0].Value)}r.ScreenObject.HeaderFields.sort((function(e,t){return e.Row>t.Row||e.Row==t.Row&&e.Column>t.Column?1:-1}))}catch(p){Logger.ErrorLog("AddEditLeads:: AddEditLeads"+p.stack)}return Logger.InfoLog("AddEditLeads::Exiting AddEditLeads"),r}return _createClass(s,[{key:"OnMessageCallBack",value:function(){this.res="Yes"}},{key:"OnAddNote",value:function(){this.Note=new f.AddNoteViewModel,this.Note.AddNoteViewModel_2(this)}},{key:"OnAddContact",value:function(){this.Contact=new v.a,this.Contact.QuickAddDContactViewModel_1(this)}},{key:"OnAddAttachment",value:function(){this.Attachment=new w.AddAttachmentViewModel,this.Attachment.AddAttachmentViewModel_2(this)}},{key:"timerDraft_Elapsed",value:function(e,t){var s=this,a=i.a.page.tabs.find((function(e){var t;return(null===(t=e.params)||void 0===t?void 0:t.obj)==s}));a&&a.active&&this.timerDraft.Enabled&&this.OnSave("SaveDraft")}},{key:"EnableControls",value:function(e){this.FirstName.Visible&&(this.FirstName.Enable=e,this.FirstName.Text=""),this.LastName.Visible&&(this.LastName.Enable=e,this.LastName.Text=""),this.MiddleName.Visible&&(this.MiddleName.Enable=e,this.MiddleName.Text=""),this.Salutation.Visible&&(this.Salutation.Enable=e,this.Salutation.SelectedValue=0),this.JobTitle.Visible&&(this.JobTitle.Enable=e,this.JobTitle.Text=""),this.Phone1.Visible&&(this.Phone1.Enable=e,this.Phone1.Text=""),this.Phone2.Visible&&(this.Phone2.Enable=e,this.Phone2.Text=""),this.Email.Visible&&(this.Email.Enable=e,this.Email.Text=""),this.Fax.Visible&&(this.Fax.Enable=e,this.Fax.Text=""),this.Department.Visible&&(this.Department.Enable=e,this.Department.Text=""),this.Role.Visible&&(this.Role.Enable=e,this.Role.SelectedValue=0)}},{key:"onContactlistChanged",value:function(e){var t=this;this.EnableControls(!0),null!=this.dvContacts&&null!=this.ContactList.SelectedValue&&"0"!=this.ContactList.SelectedValue&&(this.dvContacts=this.dvContactsTable.filter((function(e){return e.ContactID==t.ContactList.SelectedValue})),this.dvContacts.length>0&&(this.EnableControls(!1),this.FirstName.Visible&&(this.FirstName.Text=n.e.String(this.dvContacts[0].FirstName)),this.LastName.Visible&&(this.LastName.Text=n.e.String(this.dvContacts[0].LastName)),this.MiddleName.Visible&&(this.MiddleName.Text=n.e.String(this.dvContacts[0].MiddleName)),this.Salutation.Visible&&!n.e.IsEmpty(this.dvContacts[0].SalutationID)&&(this.Salutation.SelectedValue=parseInt(this.dvContacts[0].SalutationID)),this.JobTitle.Visible&&(this.JobTitle.Text=n.e.String(this.dvContacts[0].JobTitle)),this.Phone1.Visible&&(this.Phone1.Text=n.e.String(this.dvContacts[0].Phone1)),this.Phone2.Visible&&(this.Phone2.Text=n.e.String(this.dvContacts[0].Phone2)),this.Email.Visible&&(this.Email.Text=n.e.String(this.dvContacts[0].Email1)),this.Fax.Visible&&(this.Fax.Text=n.e.String(this.dvContacts[0].Fax)),this.Department.Visible&&(this.Department.Text=n.e.String(this.dvContacts[0].Department)),this.Role.Visible&&!n.e.IsEmpty(this.dvContacts[0].RoleLookUpID)&&(this.Role.SelectedValue=parseInt(this.dvContacts[0].RoleLookUpID))))}},{key:"onStatusSelectionChanged",value:function(e){this.MessageVisibility=!1,""==this.Status.SelectedValue||"417"!=this.Status.SelectedValue&&("419"!=this.Status.SelectedValue||this.IsAssign)||(this.Status.SelectedIndex=0)}},{key:"ChangeAllSecondary",value:function(e,t,s,i){for(var a=0;a<e.Tables[t].length;a++)e.Tables[t][a][s]=i}},{key:"onCompanySelectionChanged",value:function(e){var t=this;if(this.EnableControls(!0),this.ContactList.Items.Clear(),"3"==this.Mode.SelectedValue){if(this.Company.Code.SelectedValue==this.Company.Code.PreviousSelectedValue)return;0!=this.Company.Code.SelectedValue&&function(){var e=new m.a;e.CustomerID=t.Company.Code.SelectedValue;var i=e.GetCustomerDetails(),a=null;null!=i&&i.Tables[0].length>0&&function(){t.ViewContacts.ContactsListObj.Clear(),null==t.dsLeadData&&(t.dsLeadData=I.a.GetLeadScrenDetails(86));var e=t.dsLeadData.Tables[4];if(e.RowFilter="CostCenterid=83",e=e.filter((function(e){return 83==e.Costcenterid})),t instanceof s&&function(){var s=null,a=null,o=null;if(null!=t.ScreenObject)for(var l=function(l){for(var r=0;r<t.ScreenObject.CustomTab.Pages.length;r++)"Contacts"!=t.ScreenObject.CustomTab.Pages[r].Name&&"Products"!=t.ScreenObject.CustomTab.Pages[r].Name&&"Contact Methods"!=t.ScreenObject.CustomTab.Pages[r].Name&&"History"!=t.ScreenObject.CustomTab.Pages[r].Name&&"Activities"!=t.ScreenObject.CustomTab.Pages[r].Name&&"Notes"!=t.ScreenObject.CustomTab.Pages[r].Name&&"Attachments"!=t.ScreenObject.CustomTab.Pages[r].Name&&"Documents"!=t.ScreenObject.CustomTab.Pages[r].Name&&"Follow Up"!=t.ScreenObject.CustomTab.Pages[r].Name&&"CVR DATA"!=t.ScreenObject.CustomTab.Pages[r].Name&&"CRM History"!=t.ScreenObject.CustomTab.Pages[r].Name&&t.ScreenObject.CustomTab.Pages[r].Fields.forEach((function(t){t instanceof O.c&&null!=t.DBColumnName&&(t instanceof h.d?(s=t,i.Columns[1].Contains(e[l].LSysColumnName.toString())&&s.DBColumnID==parseInt(e[l].CostCenterColIDBase)&&i.Tables[1].length>0&&(s.Text=n.e.String(i.Tables[1][0][e[l].LSysColumnName.toString()]))):t instanceof u.e?(a=t,i.Columns[1].Contains(e[l].LSysColumnName.toString())&&a.DBColumnID==parseInt(e[l].CostCenterColIDBase)&&i.Tables[1].length>0&&(t.SelectedValue=n.e.String(i.Tables[1][0][e[l].LSysColumnName.toString()]))):t instanceof c.b&&(o=t,i.Columns[7].Contains(e[l].LSysColumnName.toString())&&o.DBColumnID==parseInt(e[l].CostCenterColIDBase)&&i.Tables[7].length>0?o.SelectedValue=parseInt(i.Tables[7][0][e[l].LSysColumnName]):i.Columns[1].Contains(e[l].LSysColumnName.toString())&&o.DBColumnID==parseInt(e[l].CostCenterColIDBase)&&i.Tables[1].length>0&&(o.SelectedValue=n.e.Int(i.Tables[1][0][e[l].LSysColumnName.toString()]))))}))},r=0;r<e.length;r++)l(r)}(),t.ContactList.Items.push(u.d.ComboBoxItems_2("New","0")),t.ContactList.SelectedValue="0",a=i.Tables[2].Copy(),i.Tables.length>1&&a.length>0){a=i.Tables[2].Copy();for(var o=0;o<a.length;o++)t.ContactList.Items.push(u.d.ComboBoxItems_2(n.e.String(a[o].FirstName),a[o].ContactID.toString()));t.dvContacts=a,t.dvContactsTable=t.dvContacts,i.Tables.length>5&&i.Tables[5].length>0&&t.dvContactsTable.AddRange(i.Tables[5]);var r=t.ScreenObject.Data.Tables[4].filter((function(e){return"ContactsBasedOnCustomer"==e.Name}));r.length>0&&(n.e.IsEmpty(r[0].Value)||"0"==r[0].Value.toString()||Object(l.j)(r[0].Value)&&(i.Tables[5].Columns.ContactID.Expression="0",t.ChangeAllSecondary(i,2,"AddressTypeID","2"),i.Tables[2].Columns.ContactID.Expression="0",i.Tables[2].AcceptChanges(),t.ViewContacts.LoadContactsWithOutClearingRows(i.Tables[2])))}}(),t.Company.Code.SelectedValue!=t.Company.Code.PreviousSelectedValue&&(t.Company.Code.PreviousSelectedValue=t.Company.Code.SelectedValue,t.ScreenObject.OnGetReference(t.Company.Code))}()}else if("2"==this.Mode.SelectedValue){if(0!=this.Company.Code.SelectedValue){var a=i.a.accounting.GetAccountDetails(this.Company.Code.SelectedValue);if(null!=a&&a.Tables.length>0&&!a.Columns[0].Contains("ErrorMessage")&&a.Tables[0].length>0){var o=null;if(null!=a&&a.Tables[0].length>0&&(this.ViewContacts.ContactsListObj.Clear(),this.ContactList.Items.push(u.d.ComboBoxItems_2("New","0")),this.ContactList.SelectedValue="0",o=a.Tables[2].Copy(),a.Tables.length>1&&o.length>0)){o=a.Tables[8].Copy();for(var r=0;r<o.length;r++)this.ContactList.Items.push(u.d.ComboBoxItems_2(n.e.String(o[r].FirstName),o[r].ContactID.toString()));o=a.Tables[2].Copy();for(var d=0;d<o.length;d++)this.ContactList.Items.push(u.d.ComboBoxItems_2(n.e.String(o[d].FirstName),o[d].ContactID.toString()));this.dvContacts=o,this.dvContactsTable=this.dvContacts,a.Tables.length>8&&a.Tables[8].length>0&&this.dvContactsTable.AddRange(a.Tables[8]);var C=this.ScreenObject.Data.Tables[4].filter((function(e){return"ContactsBasedOnAccount"==e.Name}));C.length>0&&(n.e.IsEmpty(C[0].Value)||"0"==C[0].Value.toString()||Object(l.j)(C[0].Value)&&(this.ChangeAllSecondary(a,8,"AddressTypeID","2"),this.ChangeAllSecondary(a,2,"AddressTypeID","2"),a.Tables[8].Columns.ContactID.Expression="0",a.Tables[8].AcceptChanges(),this.ViewContacts.LoadContactsWithOutClearingRows(a.Tables[8]),a.Tables[2].Columns.ContactID.Expression="0",a.Tables[2].AcceptChanges(),this.ViewContacts.LoadContactsWithOutClearingRows(a.Tables[2])))}this.Company.Code.SelectedValue!=this.Company.Code.PreviousSelectedValue&&(this.Company.Code.PreviousSelectedValue=this.Company.Code.SelectedValue,this.ScreenObject.OnGetReference(this.Company.Code))}}}else if("1"==this.Mode.SelectedValue){var b=-1,p=i.a.common.GetDataSet("PAY066",this.Company.Code.SelectedValue.toString());null!=p&&p.Tables[0].length>0&&(b=parseInt(p.Tables[0][0][0]));var S=this.LED.GetCRMContacts(86,0);this.dvContacts=S.Tables[0].filter((function(e){return e.FeaturePK==b})),this.dvContactsTable=this.dvContacts,this.dvContacts.length>0&&(this.EnableControls(!1),this.FirstName.Visible&&(this.FirstName.Text=n.e.String(this.dvContacts[0].FirstName)),this.LastName.Visible&&(this.FirstName.Text=n.e.String(this.dvContacts[0].LastName)),this.MiddleName.Visible&&(this.MiddleName.Text=n.e.String(this.dvContacts[0].MiddleName)),this.Salutation.Visible&&!n.e.IsEmpty(this.dvContacts[0].SalutationID)&&(this.Salutation.SelectedValue=parseInt(this.dvContacts[0].SalutationID)),this.JobTitle.Visible&&(this.JobTitle.Text=n.e.String(this.dvContacts[0].JobTitle)),this.Phone1.Visible&&(this.Phone1.Text=n.e.String(this.dvContacts[0].Phone1)),this.Phone2.Visible&&(this.Phone2.Text=n.e.String(this.dvContacts[0].Phone2)),this.Email.Visible&&(this.Email.Text=n.e.String(this.dvContacts[0].Email1)),this.Fax.Visible&&(this.Fax.Text=n.e.String(this.dvContacts[0].Fax)),this.Department.Visible&&(this.Department.Text=n.e.String(this.dvContacts[0].Department)),this.Role.Visible&&!n.e.IsEmpty(this.dvContacts[0].RoleLookUpID)&&(this.Role.SelectedValue=parseInt(this.dvContacts[0].RoleLookUpID)))}}},{key:"GetRecords",value:function(e){this.ButtonSave.Enable||(this.ButtonSave.Enable=!0);var t=0,s=!1;"NEXT"==e.toString().toUpperCase()?s=!0:"PREVIOUS"==e.toString().toUpperCase()&&(s=!1);var a=i.a.common.GetNextPreviousRecords(this.CostCenterID,this.LeadID,s,0,this.IsGroup?1:0);null!=a&&a.Tables.length>0&&a.Tables[0].length>0&&((t=parseInt(a.Tables[0][0][a.Columns[0][0]]))>0&&(this.Mode.Items.Clear(),this.lstModeDetails.Clear(),this.IncludeNewInMode&&this.Mode.Items.push(u.d.ComboBoxItems_2("New","0")),this.ScreenObject.Clear(),this.Load(t)))}},{key:"ActivityRefresh",value:function(){var e=this;"0"==this.Mode.SelectedValue?this.Activities.CRMCustomer.Text=this.Company.Text:(null!=this.Activities.CRMCustomer&&(this.Activities.CRMCustomer.Code.CCID=this.Company.Code.CCID,this.Activities.CRMCustomer.Code.TypeID=this.Company.Code.TypeID),this.Activities.CRMCustomer.Text=this.Company.Code.Text,this.Activities.CRMCustomer.Code.SelectedValue=this.Company.Code.SelectedValue,this.Activities.onCustomerSelectionChange("Customer"));var t=this.ScreenObject.StaticFields.find((function(t){return t.DBColumnID==e.ContactPersonColID}));t&&t instanceof h.d&&(this.Activities.CRMContactPerson.Text=t.Text),this.Activities.Location.Text=i.a.SessionManager.LocationName}},{key:"worker_DoWork",value:function(){var e=this;try{for(var t=this.ScreenObject.Data.Tables[6].filter((function(e){return 16==e.LookupType})),s=0;s<this.ScreenObject.CustomTab.Pages.length;s++)if("Address Details"==this.ScreenObject.CustomTab.Pages[s].Name)for(var a=0;a<this.ScreenObject.CustomTab.Pages[s].Fields.length;a++)if("Country"==this.ScreenObject.CustomTab.Pages[s].Fields[a].Label&&t.length>0){for(var o=0;o<t.length;o++)this.ScreenObject.CustomTab.Pages[s].Fields[a].Items.push(u.d.ComboBoxItems_2(n.e.String(t[o].Name),t[o].NodeID.toString()));this.ScreenObject.CustomTab.Pages[s].Fields[a].SelectedValue=this.ScreenObject.CustomTab.Pages[s].Fields[a].Items[0].Value}this.ScreenObject.Data.Tables[5].forEach((function(t){e.Status.Items.push(u.d.ComboBoxItems_2(t.Status.toString(),t.StatusID.toString()))})),this.Status.SelectedValue="415",this.IncludeNewInMode&&(this.Mode.Items.push(u.d.ComboBoxItems_2("New","0")),this.Mode.SelectedValue="0"),this.ContactList.Items.push(u.d.ComboBoxItems_2("New","0")),this.ContactList.SelectedValue="0";for(var l=0;l<this.ScreenObject.CustomTab.Pages.length;l++)if("Personal Information"==this.ScreenObject.CustomTab.Pages[l].Name)for(var r=0;r<this.ScreenObject.CustomTab.Pages[l].Fields.length;r++)"Gender"==this.ScreenObject.CustomTab.Pages[l].Fields[r].Label&&(this.ScreenObject.CustomTab.Pages[l].Fields[r].Items.push(u.d.ComboBoxItems_2(i.a.GetResource("CRMLead_Male"),"1")),this.ScreenObject.CustomTab.Pages[l].Fields[r].Items.push(u.d.ComboBoxItems_2(i.a.GetResource("CRMLead_Female"),"2")),this.ScreenObject.CustomTab.Pages[l].Fields[r].SelectedValue="1");(t=this.ScreenObject.Data.Tables[6].filter((function(e){return 44==e.LookupType}))).forEach((function(t){e.ViewContactMethod.Preferred.Items.push(u.d.ComboBoxItems_2(t.Name.toString(),t.NodeID.toString()))})),this.ViewContactMethod.Preferred.SelectedValue="141",this.Campaign.SelectedValue=1,this.ScreenObject.InitAutoCode(this.ScreenObject.Data.Tables[7],!1)}catch(d){throw d}}},{key:"OnModeChange",value:function(e){if("1"==this.Mode.SelectedValue){if(this.Company.Code.Visible=!0,this.Company.TextVisible=!1,!this.isLead&&this.lstModeDetails.filter((function(e){return"LEAD"==e.Value.toUpperCase()})).length>0){var t=this.lstModeDetails.find((function(e){return"Lead"==e.Value}));this.Company.Code.CCID=parseInt(t.Name),this.Company.Code.TypeID=1,this.Company.Code.CustomWhere="",this.Company.Code.PreviousSelectedValue=0,this.Company.Code.SelectedValue=0,this.Company.Code.Refresh(),this.isCust=!1,this.isAccount=!1,this.isLead=!0}}else"2"==this.Mode.SelectedValue?(this.Company.Code.Visible=!0,this.Company.TextVisible=!1,!this.isAccount&&this.lstModeDetails.filter((function(e){return"ACCOUNT"==e.Value.toUpperCase()})).length>0&&(this.Company.Code.DBColumnName="AccountID",this.Company.Code.PreviousSelectedValue=0,this.Company.Code.CCID=2,t=this.lstModeDetails.find((function(e){return"Account"==e.Value})),this.Company.Code.TypeID=parseInt(t.Name),this.Company.Code.CustomWhere="",this.Company.Code.SelectedValue=0,this.Company.Code.Refresh(),this.isCust=!1,this.isLead=!1,this.isAccount=!0)):"3"==this.Mode.SelectedValue?(this.Company.Code.Visible=!0,this.Company.TextVisible=!1,!this.isCust&&this.lstModeDetails.filter((function(e){return"CUSTOMER"==e.Value.toUpperCase()})).length>0&&(this.Company.Code.DBColumnName="CustomerID",this.Company.Code.PreviousSelectedValue=0,this.Company.Code.CCID=83,t=this.lstModeDetails.find((function(e){return"Customer"==e.Value})),this.Company.Code.TypeID=1,this.Company.Code.SelectedValue=0,this.Company.Code.CustomWhere=this.bShowAssignedCustomers?this.ReturnWhereForCustomer():"",this.Company.Code.Refresh(),this.isAccount=!1,this.isLead=!1,this.isCust=!0)):(this.Company.Code.Visible=!1,this.Company.TextVisible=!0,this.isCust=!1,this.isAccount=!1,this.isLead=!1,83==this.Company.Code.CCID?this.isCust=!0:2==this.Company.Code.CCID?this.isAccount=!0:this.Company.Code.CCID>5e4&&(this.isLead=!0))}},{key:"ReturnWhereForCustomer",value:function(){var e="";return e+="('"+i.a.SessionManager.UserID+"'=1 or a.CreatedBy in ('"+i.a.SessionManager.UserName+"') or '"+i.a.SessionManager.UserID+"' in ",e+="( select UserID from CRM_Assignment with(nolock) where CCID=83 and CCNODEID=a.CustomerID and IsTeam=0) or '"+i.a.SessionManager.UserID+"' in",e+="( select  UserID from COM_GROUPS with(nolock) where   GROUPNAME<>'''' AND GID  IN (select teamnodeid from CRM_Assignment with(nolock) where CCID=83 and CCNODEID=a.CustomerID and ISGROUP=1) )",e+=" or '"+i.a.SessionManager.UserID+"' in ( select  UserID from ADM_UserRoleMap with(nolock) where ROLEID IN  (select teamnodeid from CRM_Assignment with(nolock) where CCID=83 and CCNODEID=a.CustomerID and ISROLE=1) )",e+=" or '"+i.a.SessionManager.UserID+"' in (select userid from crm_teams with(nolock) where isowner=0 and  teamid in ( select teamnodeid from CRM_Assignment with(nolock) where CCID=83 and CCNODEID=a.CustomerID and IsTeam=1))  )",""!=i.a.SessionManager.LocationWhere&&(e+=" OR  a.CustomerID in ( SELECT NODEID FROM COM_CCCCDATA with(nolock) WHERE COSTCENTERID=83 AND CCNID2 IN ("+i.a.SessionManager.LocationWhere+"))   "),e="("+e+")"}},{key:"loadtabs",value:function(){try{this.AssignRowColumns();for(var e=this.ScreenObject.CustomTab.Pages.length-1;e>=0;e--){var t=this.ScreenObject.CustomTab.Pages[e];switch(t.Name){case"Contacts":t.Fields.push(this.ViewContacts),this.DefaultcontactsVisible=!0;break;case"Products":t.Fields.push(this.LeadsProduct);break;case"Contact Methods":t.Fields.AddRange(this.ViewContactMethod.Fields);break;case"History":t.Fields.push(this.ViewAssignHistroy.ListObj);break;case"Activities":t.Fields.push(this.ViewActivities);break;case"Notes":t.Fields.push(this.ViewNotes);break;case"Attachments":t.Fields.push(this.ViewAttachments);break;case"Follow Up":t.Fields.push(this.ViewFeedback);break;case"CVR DATA":t.Fields.push(this.ViewCVRViewModel);break;case"CRM History":t.Fields.push(this.ViewCRMHistroy)}}}catch(s){throw s}Logger.InfoLog("AddEditLeads::Exiting worker_DoWork")}},{key:"AssignRowColumns",value:function(){try{var e;e=this.ScreenObject.CustomFields.length;for(var t=0;t<e;t++)this.ScreenObject.CustomFields[t].Row=t/4,this.ScreenObject.CustomFields[t].Column=t%4}catch(s){throw s}}},{key:"details",value:function(){try{var e="";return e+="<Row ",e+=""!=this.FirstName.Text&&""!=this.FirstName.Text?' FirstName="'+s.GetValidXml(this.FirstName.Text)+'"':' FirstName=""',e+=""!=this.MiddleName.Text&&""!=this.MiddleName.Text?' MiddleName="'+s.GetValidXml(this.MiddleName.Text)+'"':' MiddleName=""',e+=""!=this.LastName.Text&&""!=this.LastName.Text?' LastName="'+s.GetValidXml(this.LastName.Text)+'"':' LastName=""',n.e.IsEmpty(this.Salutation.SelectedValue)?e+=' Salutation="0"':e+=' Salutation="'+this.Salutation.SelectedValue+'"',e+=""!=this.JobTitle.Text&&""!=this.JobTitle.Text?' JobTitle="'+s.GetValidXml(this.JobTitle.Text)+'"':' JobTitle=""',e+=""!=this.Phone1.Text&&""!=this.Phone1.Text?' Phone1="'+s.GetValidXml(this.Phone1.Text)+'"':' Phone1=""',e+=""!=this.Phone2.Text&&""!=this.Phone2.Text?' Phone2="'+s.GetValidXml(this.Phone2.Text)+'"':' Phone2=""',e+=""!=this.Email.Text&&""!=this.Email.Text?' Email="'+s.GetValidXml(this.Email.Text)+'"':' Email=""',e+=""!=this.Fax.Text&&""!=this.Fax.Text?' Fax="'+s.GetValidXml(this.Fax.Text)+'"':' Fax="'+this.Fax.Text+'"',e+=""!=this.Department.Text&&""!=this.Department.Text?' Department="'+s.GetValidXml(this.Department.Text)+'"':' Department=""',e+=0!=this.Role.SelectedValue?' Role="'+this.Role.SelectedValue+'"':' Role="0"',e+="/>"}catch(t){return""}}},{key:"getFields",value:function(){var e=this;Logger.InfoLog("AddEditLeads::Entering getFields");try{var t="",i="";return i+="<Row ",this.ScreenObject.CustomTab.Pages.forEach((function(a){a.Fields.forEach((function(a){a instanceof O.c&&null!=a.DBColumnName&&(a instanceof h.d?(t=a.Text,n.e.IsEmpty(t)&&(t="",null),i+=a.DBColumnName+'="'+s.GetValidXml(t)+'" '):a instanceof u.e?(t=a.SelectedValue,n.e.IsEmpty(t)&&(t=""),"Gender"==a.DBColumnName?null!=a.SelectedItem&&(i+=a.DBColumnName+'="'+s.GetValidXml(a.SelectedItem.Name)+'" '):"Country"==a.DBColumnName?null!=a.SelectedValue&&""!=a.SelectedValue&&(i+=a.DBColumnName+'="'+a.SelectedValue+'" '):i+=a.DBColumnName+'="'+s.GetValidXml(t)+'" '):a instanceof C.a?(t=n.e.IsEmpty(a.Date)?"":a.Date.ToString("dd/MMM/yyyy"),n.e.IsEmpty(t)&&(t=""),i+=a.DBColumnName+'="'+t+'" '):a instanceof N.a?(t=a.Text,n.e.IsEmpty(t)&&(t=""),i+=a.DBColumnName+'="'+t+'" '):a instanceof c.b&&(e.oPactCombo=a,i+=e.oPactCombo.DBColumnName+'="'+e.oPactCombo.SelectedValue+'" '))}))})),i+=' PreferredID="'+this.ViewContactMethod.Preferred.SelectedValue+'" ',i+=' PreferredName="'+this.ViewContactMethod.Preferred.Text+'" ',i+=" />"}catch(a){throw a}}},{key:"ClearFields",value:function(){this.Subject.Text="",this.Date.Date=new Date((new Date).ToString("dd/MMM/yyyy")),this.Company.Text="",null!=this.Rating&&(this.Rating.SelectedValue=1),null!=this.Industry&&(this.Industry.SelectedValue=1),this.FirstName.Text="",this.MiddleName.Text="",this.LastName.Text="",null!=this.Salutation&&(this.Salutation.SelectedValue=1),this.JobTitle.Text="",this.Phone1.Text="",this.Phone2.Text="",this.Email.Text="",this.ContactList.Items.Clear(),this.ContactList.Items.push(u.d.ComboBoxItems_2("New","0")),this.Fax.Text="",this.Department.Text="",this.ScreenObject.Clear(),this.Status.SelectedValue="415",null!=this.Campaign&&(this.Campaign.SelectedValue=1),null!=this.Source&&(this.Source.SelectedValue=1),null!=this.Role&&(this.Role.SelectedValue=1)}},{key:"AutoGenerateCode",value:function(){Logger.InfoLog("AddEditLeads::Entering AutoGenerateCode");try{0==this.LeadID&&this.ScreenObject.SetAutoCode(this.Code,!1,this.ParentId,this.ScreenObject.Data.Tables[7]);var e=this.ScreenObject.Data.Tables[4].filter((function(e){return"ShowAssignedCustomers"==e.Name}));e.length>0&&!n.e.IsEmpty(e[0].Value)&&(this.bShowAssignedCustomers="0"==e[0].Value.toString()||"1"==e[0].Value.toString()?!!Object(l.j)(parseInt(e[0].Value)):!!Object(l.j)(e[0].Value)),0==this.LeadID&&((e=this.ScreenObject.Data.Tables[4].filter((function(e){return"LinkDimension"==e.Name}))).length>0&&!n.e.IsEmpty(e[0].Value)&&(this.Mode.Items.push(u.d.ComboBoxItems_2("Existing lead","1")),this.lstModeDetails.push(u.d.ComboBoxItems_2(e[0].Value.toString(),"Lead"))),(e=this.ScreenObject.Data.Tables[4].filter((function(e){return"AccountLinkDimension"==e.Name}))).length>0&&!n.e.IsEmpty(e[0].Value)&&(this.Mode.Items.push(u.d.ComboBoxItems_2("Account","2")),this.lstModeDetails.push(u.d.ComboBoxItems_2(e[0].Value.toString(),"Account"))),(e=this.ScreenObject.Data.Tables[4].filter((function(e){return"CustomerInMode"==e.Name}))).length>0&&Object(l.j)(e[0].Value)&&(this.Mode.Items.push(u.d.ComboBoxItems_2("Customer","3")),this.lstModeDetails.push(u.d.ComboBoxItems_2(e[0].Value.toString(),"Customer"))),(e=this.ScreenObject.Data.Tables[4].filter((function(e){return"DefaultModeSelection"==e.Name}))).length>0&&!n.e.IsEmpty(e[0].Value)&&(this.Mode.SelectedValue=this.Mode.Items.filter((function(t){return t.Value==e[0].Value.toString()})).length>0?this.Mode.SelectedValue=e[0].Value.toString():"0",parseInt(this.Mode.SelectedValue)>0&&this.OnModeChange(this.Mode.SelectedValue)))}catch(t){throw t}Logger.InfoLog("AddEditLeads::Exiting AutoGenerateCode")}},{key:"Load",value:function(e){Logger.InfoLog("AddEditLeads::Entering Load");try{if(this.LeadID=e,this.ds=this.LED.GetLead(e),this.ScreenObject.CheckViewForUser(!0),this.ScreenObject.IsAutoCode&&(this.Code.Enable=!1),null!=this.ds){if(this.ds.Tables.length>5&&this.ds.Columns[5].Contains("ConvertFromLeadID")&&this.ds.Tables[5].length>0&&parseInt(this.ds.Tables[5][0][this.ds.Columns[5][0]])>0&&(this.ButtonSave.Enable=!1,this.DisplayMessage="Lead is converted to Opportunity cannot be edited"),this.ds.Tables.length>2&&this.ds.Tables[2].length>0){var t=this.ds.Tables[2].filter((function(e){return"LinkDimension"==e.Name}));t.length>0&&!n.e.IsEmpty(t[0].Value)&&(this.Mode.Items.push(u.d.ComboBoxItems_2("Existing lead","1")),this.lstModeDetails.push(u.d.ComboBoxItems_2(t[0].Value.toString(),"Lead"))),(t=this.ds.Tables[2].filter((function(e){return"AccountLinkDimension"==e.Name}))).length>0&&!n.e.IsEmpty(t[0].Value)&&(this.Mode.Items.push(u.d.ComboBoxItems_2("Account","2")),this.lstModeDetails.push(u.d.ComboBoxItems_2(t[0].Value.toString(),"Account"))),(t=this.ds.Tables[2].filter((function(e){return"CustomerInMode"==e.Name}))).length>0&&Object(l.j)(t[0].Value)&&(this.Mode.Items.push(u.d.ComboBoxItems_2("Customer","3")),this.lstModeDetails.push(u.d.ComboBoxItems_2(t[0].Value.toString(),"Customer"))),(t=this.ds.Tables[2].filter((function(e){return"ShowAssignedCustomers"==e.Name}))).length>0&&(this.bShowAssignedCustomers=!!Object(l.j)(t[0].Value))}if(this.ds.Tables.length>0&&this.ds.Tables[0].length>0){if(n.e.IsEmpty(this.ds.Tables[0][0].Code)||(this.Code.Text=this.ds.Tables[0][0].Code.toString()),n.e.IsEmpty(this.ds.Tables[0][0].Subject)||(this.Subject.Text=this.ds.Tables[0][0].Subject.toString()),n.e.IsEmpty(this.ds.Tables[0][0].CDate)||(this.Date.Date=new Date(this.ds.Tables[0][0].CDate.toString())),n.e.IsEmpty(this.ds.Tables[0][0].StatusID)||(this.Status.SelectedValue=this.ds.Tables[0][0].StatusID.toString()),n.e.IsEmpty(this.ds.Tables[0][0].CreatedBy)||(this.Owner.Text=this.ds.Tables[0][0].CreatedBy.toString()),n.e.IsEmpty(this.ds.Tables[0][0].CvtDate)||(this.CreatedDate.Text=new Date(this.ds.Tables[0][0].CvtDate).ToString("dd/MMM/yyyy hh:mm a")),this.CreatedDate.Date=new Date(new Date(this.ds.Tables[0][0].CvtDate).ToString("dd/MMM/yyyy hh:mm a")),n.e.IsEmpty(this.ds.Tables[0][0].AssignedTo)||(this.AssignedTo.Text=this.ds.Tables[0][0].AssignedTo.toString()),this.LeadStatus=n.e.IsEmpty(this.ds.Tables[0][0].IsApproved)||!Object(l.j)(this.ds.Tables[0][0].IsApproved)?"UnApproved":"Approved",this.Status.Enable="417"!=this.Status.SelectedValue&&"419"!=this.Status.SelectedValue,this.ButtonClose.Visible=!("419"!=this.Status.SelectedValue||!i.a.SessionManager.IsActionAssigned(86,"Close")),this.Mode.SelectedValue=n.e.IsEmpty(this.ds.Tables[0][0].Mode)?"0":this.ds.Tables[0][0].Mode.toString(),n.e.IsEmpty(this.ds.Tables[0][0].Company)||(this.OnModeChange(null),"0"==this.Mode.SelectedValue?this.Company.Text=this.ds.Tables[0][0].Company.toString():(this.Company.Code.SelectedValue=parseInt(this.ds.Tables[0][0].SelectedModeID),this.Company.Code.PreviousSelectedValue=this.Company.Code.SelectedValue,this.ScreenObject.OnGetReference(this.Company.Code))),"3"==this.Mode.SelectedValue){this.ContactList.Items.Clear();var s=new m.a;s.CustomerID=this.Company.Code.SelectedValue;var a=s.GetCustomerDetails();if(null!=a&&a.Tables[0].length>0){if(this.ContactList.Items.push(u.d.ComboBoxItems_2("New","0")),this.ContactList.SelectedValue="0",a.Tables.length>5&&a.Tables[5].length>0)for(var o=0;o<a.Tables[5].length;o++)this.ContactList.Items.push(u.d.ComboBoxItems_2(n.e.String(a.Tables[5][o].FirstName),a.Tables[5][o].ContactID.toString()));if(a.Tables.length>1&&a.Tables[2].length>0){for(var r=0;r<a.Tables[2].length;r++)this.ContactList.Items.push(u.d.ComboBoxItems_2(n.e.String(a.Tables[2][r].FirstName),a.Tables[2][r].ContactID.toString()));this.dvContacts=a.Tables[2],this.dvContactsTable=this.dvContacts,a.Tables.length>5&&a.Tables[5].length>0&&this.dvContactsTable.AddRange(a.Tables[5])}}}if("2"==this.Mode.SelectedValue){this.ContactList.Items.Clear();var d=i.a.accounting.GetAccountDetails(this.Company.Code.SelectedValue);if(null!=d&&d.Tables[0].length>0){if(this.ContactList.Items.push(u.d.ComboBoxItems_2("New","0")),this.ContactList.SelectedValue="0",d.Tables.length>8&&d.Tables[8].length>0)for(var h=0;h<d.Tables[8].length;h++)this.ContactList.Items.push(u.d.ComboBoxItems_2(n.e.String(d.Tables[8][h].FirstName),d.Tables[8][h].ContactID.toString()));if(d.Tables.length>1&&d.Tables[2].length>0){for(var c=0;c<d.Tables[2].length;c++)this.ContactList.Items.push(u.d.ComboBoxItems_2(n.e.String(d.Tables[2][c].FirstName),d.Tables[2][c].ContactID.toString()));this.dvContacts=d.Tables[2],this.dvContactsTable=this.dvContacts,d.Tables.length>8&&d.Tables[8].length>0&&this.dvContactsTable.AddRange(d.Tables[8])}}}n.e.IsEmpty(this.ds.Tables[0][0].ContactID)||(this.ContactList.SelectedValue=this.ds.Tables[0][0].ContactID.toString()),null!=this.ContactList.SelectedValue&&"0"!=this.ContactList.SelectedValue&&this.EnableControls(!1),n.e.IsEmpty(this.ds.Tables[0][0].SourceLookUpID)||(this.Source.SelectedValue=parseInt(this.ds.Tables[0][0].SourceLookUpID)),n.e.IsEmpty(this.ds.Tables[0][0].RatinglookupID)||(this.Rating.SelectedValue=parseInt(this.ds.Tables[0][0].RatinglookupID)),n.e.IsEmpty(this.ds.Tables[0][0].IndustryLookUpID)||(this.Industry.SelectedValue=parseInt(this.ds.Tables[0][0].IndustryLookUpID)),n.e.IsEmpty(this.ds.Tables[0][0].CampaignID)||(this.Campaign.SelectedValue=parseInt(this.ds.Tables[0][0].CampaignID))}this.ds.Tables.length>4&&this.ScreenObject.LoadCustomFieldsData(this.ds.Tables[4],!0),this.ds.Tables.length>3&&this.ds.Tables[3].length>0&&(n.e.IsEmpty(this.ds.Tables[3][0].FirstName)||(this.FirstName.Text=this.ds.Tables[3][0].FirstName.toString()),n.e.IsEmpty(this.ds.Tables[3][0].MiddleName)||(this.MiddleName.Text=this.ds.Tables[3][0].MiddleName.toString()),n.e.IsEmpty(this.ds.Tables[3][0].LastName)||(this.LastName.Text=this.ds.Tables[3][0].LastName.toString()),n.e.IsEmpty(this.ds.Tables[3][0].SalutationID)||(this.Salutation.SelectedValue=parseInt(this.ds.Tables[3][0].SalutationID)),n.e.IsEmpty(this.ds.Tables[3][0].JobTitle)||(this.JobTitle.Text=this.ds.Tables[3][0].JobTitle.toString()),n.e.IsEmpty(this.ds.Tables[3][0].Company)||(this.Company.Text=this.ds.Tables[3][0].Company.toString()),n.e.IsEmpty(this.ds.Tables[3][0].Phone1)||(this.Phone1.Text=this.ds.Tables[3][0].Phone1.toString()),n.e.IsEmpty(this.ds.Tables[3][0].Phone2)||(this.Phone2.Text=this.ds.Tables[3][0].Phone2.toString()),n.e.IsEmpty(this.ds.Tables[3][0].Email1)||(this.Email.Text=this.ds.Tables[3][0].Email1.toString()),n.e.IsEmpty(this.ds.Tables[3][0].Fax)||(this.Fax.Text=this.ds.Tables[3][0].Fax.toString()),n.e.IsEmpty(this.ds.Tables[3][0].Department)||(this.Department.Text=this.ds.Tables[3][0].Department.toString()),n.e.IsEmpty(this.ds.Tables[3][0].RoleLookUpID)||(this.Role.SelectedValue=parseInt(this.ds.Tables[3][0].RoleLookUpID.toString())),this.ScreenObject.LoadCustomFieldsData(this.ds.Tables[3],!0),n.e.IsEmpty(this.ds.Tables[3][0].PreferredID)||(this.ViewContactMethod.Preferred.SelectedValue=this.ds.Tables[3][0].PreferredID.toString()),n.e.IsEmpty(this.ds.Tables[3][0].IsEmailOn)||(1==Object(l.j)(this.ds.Tables[3][0].IsEmailOn)?(this.ViewContactMethod.EmailAllow.IsChecked=!0,this.ViewContactMethod.EmailNotAllow.IsChecked=!1):(this.ViewContactMethod.EmailNotAllow.IsChecked=!0,this.ViewContactMethod.EmailAllow.IsChecked=!1)),n.e.IsEmpty(this.ds.Tables[3][0].IsBulkEmailOn)||(1==Object(l.j)(this.ds.Tables[3][0].IsBulkEmailOn)?(this.ViewContactMethod.BulkEmailAllow.IsChecked=!0,this.ViewContactMethod.BulkEmailNotAllow.IsChecked=!1):(this.ViewContactMethod.BulkEmailNotAllow.IsChecked=!0,this.ViewContactMethod.BulkEmailAllow.IsChecked=!1)),n.e.IsEmpty(this.ds.Tables[3][0].IsMailOn)||(1==Object(l.j)(this.ds.Tables[3][0].IsMailOn)?(this.ViewContactMethod.MailAllow.IsChecked=!0,this.ViewContactMethod.MailNotAllow.IsChecked=!1):(this.ViewContactMethod.MailNotAllow.IsChecked=!0,this.ViewContactMethod.MailAllow.IsChecked=!1)),n.e.IsEmpty(this.ds.Tables[3][0].IsPhoneOn)||(1==Object(l.j)(this.ds.Tables[3][0].IsPhoneOn)?(this.ViewContactMethod.PhoneAllow.IsChecked=!0,this.ViewContactMethod.PhoneNotAllow.IsChecked=!1):(this.ViewContactMethod.PhoneNotAllow.IsChecked=!0,this.ViewContactMethod.PhoneAllow.IsChecked=!1)),n.e.IsEmpty(this.ds.Tables[3][0].IsFaxOn)||(1==Object(l.j)(this.ds.Tables[3][0].IsFaxOn)?(this.ViewContactMethod.FaxAllow.IsChecked=!0,this.ViewContactMethod.FaxNotAllow.IsChecked=!1):(this.ViewContactMethod.FaxNotAllow.IsChecked=!0,this.ViewContactMethod.FaxAllow.IsChecked=!1))),this.ds.Tables.length>8&&this.ViewActivities.LoadActivityData(this.ds.Tables[8]),this.ds.Tables.length>9&&this.ViewNotes.LoadNotes(this.ds.Tables[9]),this.ds.Tables.length>10&&this.ViewAttachments.LoadAttachments(this.ds.Tables[10]),this.ds.Tables.length>11&&this.ScreenObject.LoadCustomFieldsCCData(this.ds.Tables[11]),this.ds.Tables.length>12&&this.LeadsProduct.LoadProductData(this.ds.Tables[12],this.ds.Columns[12]),this.ds.Tables.length>13&&this.ViewFeedback.LoadData(this.ds.Tables[13]),this.ds.Tables.length>15&&this.ViewContacts.LoadContacts(this.ds.Tables[15],this.ds.Columns[15]),this.ds.Tables.length>16&&this.ViewCVRViewModel.LoadData(this.ds.Tables[16]),this.ds.Tables.length>17&&this.PriContact.LoadContacts(this.ds.Tables[17]),this.ds.Tables.length>18&&this.ViewAssignHistroy.LoadHistroy_2(this.ds.Tables[18]),this.ds.Tables.length>19&&this.ViewCRMHistroy.LoadCRMHistroy(this.ds.Tables[18]),this.LoadReport()}}catch(C){Logger.ErrorLog("AddEditLeads:: Load"+C.stack)}Logger.InfoLog("AddEditLeads::Exiting Load")}},{key:"LoadReport",value:function(){var e=this.ScreenObject.CustomTab.Pages.find((function(e){return"Documents"==e.Name}));if(e&&null!=this.ds){var t=this.ds.Tables[2].filter((function(e){return"LinkDimension"==e.Name}));if(t.length>0&&!n.e.IsEmpty(t[0].Value)&&this.ds.Tables[0].length>0){var s=0,i=parseInt(t[0].Value)-5e4;0==(s=n.e.Int(this.ds.Tables[0][0].CCLeadID))&&(s=-123);var a="DCC.dcCCNID"+i+"="+s,o="";if((t=this.ds.Tables[2].filter((function(e){return"CreateDocuments"==e.Name}))).length>0&&!n.e.IsEmpty(t[0].Value)&&(o=t[0].Value.toString().Replace(";",",")),o.length>0){var l="<XML><Row ColID='300' Value='"+o+"'/>";l+="<Row ColID='CRM_Masters_DocumentsTab' Value='"+a+"'/>",l+="</XML>",null==this.Report?(this.Report=new V.ReportViewModel,this.Report.ReportViewModel_Document(86,l,162,!1,null,null),this.Report.ShowHeaderButtons=!1,this.Report.ShowRightPanel=!1,this.Report.SearchVisibility=!1,e.Fields.Clear(),e.Fields.push(this.Report)):(this.Report.LoadDocFilterXML(l),this.Report.OnReportClick(this.Report.ReportID,0))}}}}},{key:"OnSave",value:function(e){if("CloseVisiblity"==e)this.CloseLead=new x.a(this.LeadID,this,86),i.a.page.ShowDialog(this.CloseLead,H.CloseLeadComponent,{ShowCenter:!0,NoWidth:!0});else if("Save"==e||"SaveDraft"==e)try{this.LED.LeadID=this.LeadID;var t=this.ScreenObject.ValidateData();if(!n.e.IsEmpty(t))return this.DisplayMessage=t,void(this.MessageVisibility=!0);if(0==this.LED.LeadID){var s={StrCode:this.LED.Code,CodePrefix:this.LED.CodePrefix,CodeNumber:this.LED.CodeNumber};if(this.DisplayMessage=this.ScreenObject.SetAutoCodeParams_3(this.Code,this.ParentId,this.ScreenObject.Data.Tables[7],s),this.LED.Code=s.StrCode,this.LED.CodePrefix=s.CodePrefix,this.LED.CodeNumber=s.CodeNumber,this.DisplayMessage.length>0)return}else this.LED.Code=this.Code.Text;if(null!=this.Mode.SelectedValue&&""!=this.Mode.SelectedValue||(this.Mode.SelectedValue="0"),this.LED.Mode=parseInt(this.Mode.SelectedValue),this.Company.Visible?"0"==this.Mode.SelectedValue?this.LED.Company=null!=this.Company.Text?this.Company.Text:"":(this.LED.Company=null!=this.Company.Code.Text?this.Company.Code.Text:"",this.LED.SelectedModeID=this.Company.Code.SelectedValue):this.Company.Enable&&this.Company.Visible||(this.LED.Company=this.Code.Text),this.Subject.Visible?this.LED.Name=this.Subject.Text:this.Subject.Enable&&this.Subject.Visible||(this.LED.Name=this.Code.Text),this.Status.Visible?this.LED.StatusID=parseInt(this.Status.SelectedValue):this.Status.Enable&&this.Status.Visible||(this.LED.StatusID=415),this.Date.Visible?this.LED.Date=this.Date.Date:this.Date.Enable&&this.Date.Visible||(this.LED.Date=Date.Today()),this.LED.CampaignID=this.Campaign.Visible||0!=this.Campaign.SelectedValue?this.Campaign.SelectedValue:1,this.LED.SourceID=this.Source.Visible&&0!=this.Source.SelectedValue?this.Source.SelectedValue:0,this.LED.RatingID=this.Rating.Visible&&0!=this.Rating.SelectedValue?this.Rating.SelectedValue:0,this.LED.IndustryID=this.Industry.Enable&&0!=this.Industry.SelectedValue?this.Industry.SelectedValue:0,this.LED.Contact=this.ContactList.Visible&&""!=this.ContactList.SelectedValue?parseInt(this.ContactList.SelectedValue):0,this.LED.Details=this.details(),this.LED.ActivityXML=this.ViewActivities.ActivitiesXML(),this.LED.ProductsXML=this.LeadsProduct.GetProductXML(),this.LED.TabXML=this.getFields(),this.LED.CustomFieldsQuery=this.ScreenObject.GetCustomFieldsQuery(),this.LED.CustomCostCenterFieldsQuery=this.ScreenObject.GetCustomCostCenterFieldsQuery(),this.LED.EmailsAllow=this.ViewContactMethod.EmailAllow.IsChecked,this.LED.BulkEmailAllow=this.ViewContactMethod.BulkEmailAllow.IsChecked,this.LED.PhoneAllow=this.ViewContactMethod.PhoneAllow.IsChecked,this.LED.FaxAllow=this.ViewContactMethod.FaxAllow.IsChecked,this.LED.MailAllow=this.ViewContactMethod.MailAllow.IsChecked,this.LED.NotesXML=this.ViewNotes.GetXML(),this.LED.FeedBackXML=this.ViewFeedback.GetXML(),this.LED.CVRXML=this.ViewCVRViewModel.GetXML(),this.LED.AttachmentXML=this.ViewAttachments.GetXML(),this.LED.ContactsXML=this.ViewContacts.GetXML(),null!=this.PriContact&&this.PriContact.CheckPrimaryDuplicateContact())return void(this.DisplayMessage="Duplicate Contact[s] in Contacts DB");if(this.LED.PrimaryContactXML=this.PriContact.GetXML(),!this.ScreenObject.ValidateDataonSave())return;var a=this.LED.SaveLead();this.DisplayMessage=a.Message,this.Ret=a.RetValue,this.Ret>0&&("SaveDraft"==e&&(this.LeadID=this.Ret,this.LeadID>0&&this.Load(this.LeadID)),"SaveDraft"!=e&&(this.ClearFields(),this.LED.LeadID>0&&(this.ButtonSave.Enable=!1,this.Code.Text=""),this.Status.SelectedValue="415",this.Mode.Items.Clear(),this.IncludeNewInMode&&(this.Mode.Items.push(u.d.ComboBoxItems_2("New","0")),this.Mode.SelectedValue="0"),this.lstModeDetails.Clear(),this.AutoGenerateCode(),this.ViewActivities.Activity.SelectedValue="-1",this.ViewContacts.ContactsListObj.Clear(),this.ViewNotes.NotesListObj.Clear(),this.ViewContacts.DeletedContacts.Clear(),this.ViewAttachments.AttachmentsListObj.Clear(),this.LeadsProduct.ClearGrid(),this.ViewActivities.ActivityGridDataObj.Clear(),this.ViewAssignHistroy.ListObj.Clear(),this.ViewCRMHistroy.ListObj.Clear(),this.ViewFeedback.FeedBackDataObj.Clear(),this.ViewCVRViewModel.FeedBackDataObj.Clear(),null!=this.PriContact&&this.PriContact.ClearFields()),Logger.InfoLog("AddEditLeads :: Exiting OnSaveLead"))}catch(t){Logger.ErrorLog("AddEditLeads :: OnSaveLead"+t.stack)}else if("Convert"==e){var o=null;if((o=this.ds.Tables[2].filter((function(e){return"ConvertApprovedLeads"==e.Name}))).length>0)if(n.e.IsEmpty(o[0].Value)||"0"==o[0].Value.toString()){var r=new W(this.LeadID,this.ds,86);i.a.page.ShowDialog(r,z.a,{ShowCenter:!0})}else if(Object(l.j)(o[0].Value)){if(null!=this.ds&&this.ds.Tables.length>1&&this.ds.Tables[0].length>0&&this.ds.Columns[0].Contains("IsApproved")&&!Object(l.j)(this.ds.Tables[0][0].IsApproved))return void alert("Lead should be in approved status!");var d=new W(this.LeadID,this.ds,86);i.a.page.ShowDialog(d,z.a,{ShowCenter:!0})}else{var h=new W(this.LeadID,this.ds,86);i.a.page.ShowDialog(h,z.a,{ShowCenter:!0})}}else if("Assign"==e){if(this.LeadID>0){this.IsAssign=!0;var c=new Z.AssignFeatureViewModel;c.AssignFeatureViewModel_1(this,this.LeadID,86),i.a.page.ShowDialog(c,$.AssignFeatureComponent,{ShowCenter:!0})}}else if("Approve"==e){var C=new J.a(this,86,this.LeadID);i.a.page.ShowDialog(C,K.a,{ShowCenter:!0})}else"Email"==e&&this.LeadID>0&&i.a.page.ShowDialog(new Y.SendEmailSMSViewModel(!0,this.CostCenterID,this.LeadID,this),q.SendEmailSMSComponent)}},{key:"OnShowContact",value:function(){}}],[{key:"GetValidXml",value:function(e){return(e=(e=(e=e.Replace("&","&amp;")).Replace("'","&apos;&apos;")).Replace('"',"&quot;")).Replace("<","&lt;")}}]),s}(r.b),ie=s("unEg"),ae=function(e){_inherits(s,e);var t=_createSuper(s);function s(e,a,o,r,c){var C;_classCallCheck(this,s),(C=t.call(this)).leadmodel=new I.a,C.ScreenObject=new d.a,C.parentid=1,C.selectedNode=0,C.group=!1,C.Company=null,C.Subject=null,C.Code=new h.a(24198),C.Status=null,C.Mode=null,C.Group=null,C.Ret=0,C.RetValue=0,C.CostCenterID=0,C.NodeID=0,C.ActVisibility=!1,C.ClassName="QuickAddLeads",C.parent=e,C.NodeID=a,C.parentid=o,C.selectedNode=c,C.CostCenterID=86,C.group=r,C.ButtonSave=new D.a,C.ScreenObject.LoadQuickScreen(_assertThisInitialized(C),86,r),r?C.ActVisibility=!1:s.SetActivityUI(_assertThisInitialized(C),C.ScreenObject.dtActivityQuick),C.leadmodel.LeadID=C.NodeID;var m=C.ScreenObject.GetQuickCode(24198);if(null!=m?C.Code=m:C.Code.Visible=!1,C.Company=C.ScreenObject.GetQuickText(24399),C.Status=C.ScreenObject.GetQuickCombo(24400),C.Mode=C.ScreenObject.GetQuickCombo(26637),C.Group=C.ScreenObject.GetQuickField(25905),C.Subject=C.ScreenObject.GetQuickText(25069),null!=C.Group&&(C.Group.Enable=!1,C.Group.CCID=86,C.Group.TypeID=2,C.Group.SelectedValue=o),null!=C.Status&&(C.ScreenObject.Data.Tables[3].forEach((function(e){C.Status.Items.push(u.d.ComboBoxItems_2(n.e.String(e.Status),e.StatusID.toString()))})),C.Status.SelectedValue="415"),null!=C.Company){var b=C.ScreenObject.Data.Tables[4].filter((function(e){return"CapsLock"==e.Name}));b.length>0&&Object(l.j)(b[0].Value)&&(C.Company.IsAllCaps=!0),(b=C.ScreenObject.Data.Tables[4].filter((function(e){return"CapsToFirstLetter"==e.Name}))).length>0&&Object(l.j)(b[0].Value)&&(C.Company.IsFirstLetterCaps=!0)}return C.ScreenObject.InitAutoCode(C.ScreenObject.Data.Tables[7],C.group),C.AutoGenerateCode(),0==C.NodeID?(C.Title=i.a.GetResource("CRMLead_AddLead"),C.leadmodel.GUID="GUID"):(C.Title=i.a.GetResource("CRMLead_EditLead"),C.LoadEditData()),C.Title=0==C.group?i.a.GetResource(0==C.NodeID?"CRMLead_AddLead":"CRMLead_EditLead"):0==C.NodeID?i.a.GetResource("CRMLead_AddGroup"):"Edit Group",C}return _createClass(s,[{key:"LoadEditData",value:function(){var e=this.leadmodel.GetLead(this.NodeID);null!=e&&e.Tables.length>5&&e.Columns[5].Contains("ConvertFromLeadID")&&e.Tables[5].length>0&&parseInt(e.Tables[5][0][e.Columns[5][0]].toString())>0&&(this.ButtonSave.Enable=!1,this.DisplayMessage="Lead is converted to Opportunity cannot be edited"),null!=this.Code&&(this.Code.Text=e.Tables[0][0].Code.toString(),(this.ScreenObject.InheritParentCode||this.ScreenObject.IsAutoCode)&&(this.Code.Enable=!1)),this.leadmodel.GUID=e.Tables[0][0].GUID.toString(),this.leadmodel.Company=e.Tables[0][0].Company.toString(),this.leadmodel.Code=e.Tables[0][0].Code.toString();var t=null;e.Tables[11].length>0&&(t=e.Tables[11][0]);var s=null;e.Tables[3].length>0&&(s=e.Tables[3][0]),this.ScreenObject.FillControls(e.Tables[0][0],e.Tables[4][0],t,s),this.ScreenObject.LoadPrimaryContactData(e.Tables[3],e.Columns[3]),this.ActVisibility&&!this.group&&e.Tables.length>7&&(this.ViewActivities.LoadActivityData(e.Tables[8]),this.ViewActivities.ActivityGridData.length>0?(this.ViewActivities.SelectedRow=this.ViewActivities.ActivityGridData[this.ViewActivities.ActivityGridData.length-1],this.ViewActivities.OnCmnItem_Click("EDIT","EDIT")):this.ActVisibility=!1),null!=this.Group&&(this.Group.SelectedValue=parseInt(e.Tables[0][0].ParentID)),null!=this.Status&&(this.Status.SelectedValue=e.Tables[0][0].StatusID.toString()),Logger.InfoLog("QuickAddCustomersViewModel::Exiting LoadEditData")}},{key:"AutoGenerateCode",value:function(){var e;0==this.NodeID&&null!=this.Code&&this.ScreenObject.SetAutoCode(this.Code,this.group,this.parentid,this.ScreenObject.Data.Tables[7]);var t=this.ScreenObject.StaticFields.find((function(e){return 26637==e.DBColumnID}));t&&t instanceof u.e&&(t.Items.Clear(),(e=this.ScreenObject.Data.Tables[4].filter((function(e){return"IncludeNewInMode"==e.Name}))).length>0&&""!=e[0].Value.toString()&&Object(l.j)(e[0].Value.toString())&&(t.Items.push(u.d.ComboBoxItems_2("New","0")),t.SelectedValue="0"),(e=this.ScreenObject.Data.Tables[4].filter((function(e){return"LinkDimension"==e.Name}))).length>0&&""!=e[0].Value.toString()&&t.Items.push(u.d.ComboBoxItems_2("Existing lead","1")),(e=this.ScreenObject.Data.Tables[4].filter((function(e){return"AccountLinkDimension"==e.Name}))).length>0&&""!=e[0].Value.toString()&&t.Items.push(u.d.ComboBoxItems_2("Account","2")),(e=this.ScreenObject.Data.Tables[4].filter((function(e){return"CustomerInMode"==e.Name}))).length>0&&Object(l.j)(e[0].Value)&&t.Items.push(u.d.ComboBoxItems_2("Customer","3")))}},{key:"OnSave",value:function(e){if("Cancel"==e)this.parent.DetailsVisibility=!0;else if("Save"==e)try{this.leadmodel.LeadID=this.NodeID,this.leadmodel.IsGroup=this.group;var t=this.ScreenObject.ValidateData();if(!n.e.IsEmpty(t))return this.DisplayMessage=t,void(this.MessageVisibility=!0);if(0==this.leadmodel.LeadID){if(0==this.leadmodel.LeadID&&null!=this.Code){var s={StrCode:this.leadmodel.Code,CodePrefix:this.leadmodel.CodePrefix,CodeNumber:this.leadmodel.CodeNumber};if(this.DisplayMessage=this.ScreenObject.SetAutoCodeParams_3(this.Code,this.parentid,this.ScreenObject.Data.Tables[7],s),this.leadmodel.Code=s.StrCode,this.leadmodel.CodePrefix=s.CodePrefix,this.leadmodel.CodeNumber=s.CodeNumber,this.DisplayMessage.length>0)return}if(this.Company&&(this.leadmodel.Company=this.Company.Text),this.Subject?this.leadmodel.Name=this.Subject.Text:this.Code&&(this.leadmodel.Name=this.Code.Text),this.leadmodel.StatusID=this.Status?parseInt(this.Status.SelectedValue):415,this.leadmodel.SelectedNodeID=this.Group&&this.Group.SelectedValue>0?this.Group.SelectedValue:this.parentid,this.leadmodel.Date=this.ScreenObject.GetDatePickerValue(25068,Date.Today()),this.leadmodel.CampaignID=this.ScreenObject.GetPactListValue(25073,1),this.leadmodel.SourceID=this.ScreenObject.GetTextComboValue_int(25071,0),this.leadmodel.RatingID=this.ScreenObject.GetTextComboValue_int(25072,0),this.leadmodel.IndustryID=this.ScreenObject.GetTextComboValue_int(25074,0),this.leadmodel.Contact=this.ScreenObject.GetTextComboValue_int(26651,0),this.leadmodel.Details=this.details(),this.ActVisibility){if(this.Activities.onSaveActivity("Save"),!n.e.IsEmpty(this.Activities.DisplayMessage))return void(this.DisplayMessage=this.Activities.DisplayMessage);this.leadmodel.ActivityXML=this.ViewActivities.ActivitiesXML()}else this.leadmodel.ActivityXML="";if(this.leadmodel.ProductsXML="",this.leadmodel.TabXML="",this.leadmodel.CustomFieldsQuery=this.ScreenObject.GetQuickExtraFieldsQuery(),this.leadmodel.CustomCostCenterFieldsQuery=this.ScreenObject.GetQuickExtraCCFieldsQuery(),this.leadmodel.NotesXML="",this.leadmodel.FeedBackXML="",this.leadmodel.CVRXML="",this.leadmodel.AttachmentXML="",this.leadmodel.ContactsXML="",this.leadmodel.PrimaryContactXML=this.ScreenObject.GetPrimaryContact(),!this.ScreenObject.ValidateDataonSave())return;var a=this.leadmodel.SaveLead();this.DisplayMessage=a.Message,this.Ret=a.RetValue}else{if(null!=this.Code&&(this.leadmodel.Code=this.Code.Text),null!=this.Company&&(this.leadmodel.Company=this.Company.Text),this.ActVisibility){if(this.Activities.onSaveActivity("Save"),!n.e.IsEmpty(this.Activities.DisplayMessage))return void(this.DisplayMessage=this.Activities.DisplayMessage);this.leadmodel.ActivityXML=this.ViewActivities.ActivitiesXML()}else this.leadmodel.ActivityXML="";if(this.leadmodel.StaticFieldsQuery=this.ScreenObject.GetStaticFieldsQuery(),this.leadmodel.CustomFieldsQuery=this.ScreenObject.GetQuickExtraFieldsQuery(),this.leadmodel.CustomCostCenterFieldsQuery=this.ScreenObject.GetQuickExtraCCFieldsQuery(),this.leadmodel.Details=this.details(),!this.ScreenObject.ValidateDataonSave())return;var o=this.leadmodel.SaveLeadQuick();this.DisplayMessage=o.Message,this.Ret=o.RetValue}this.MessageVisibility=!0,this.RetValue=this.Ret,this.Ret>0&&(null!=this.Company&&(this.Company.Text=""),null!=this.Status&&(this.Status.SelectedValue="415"),null!=this.parent&&(null!=this.parent.SelectedNode&&(this.parent.obj.SetFocusNodeID=this.parent.SelectedNode.Id),this.parent.Refresh()),this.AutoGenerateCode(),null!=this.Activities&&this.Activities.ClearFields())}catch(t){Logger.ErrorLog("SaveLeadViewModel:: OnSave"+t.stack)}else{var l=new se(this.NodeID,this.parentid,this.group);this.ScreenObject.StaticFields.forEach((function(e){var t=l.ScreenObject.StaticFields.find((function(t){return t.DBColumnID==e.DBColumnID}));t&&(t instanceof h.d?t.Text=e.Text:t instanceof c.c?e instanceof h.d&&(t.Text=e.Text):t instanceof u.e||t instanceof c.b?t.SelectedValue=e.SelectedValue:t instanceof C.a?t.Date=e.Date:t instanceof h.a&&e instanceof h.a&&(t.Text=e.Text,t.SuffixCode=e.SuffixCode,t.PrefixCode=e.PrefixCode))})),i.a.page.addNewTab({component:ie.AddEditLeadComponent,params:{obj:l}}),i.a.page.HideDialog()}}},{key:"details",value:function(){Logger.InfoLog("AddEditLeads::Entering details");try{var e="";return 0==this.NodeID?(e+="<Row ",this.ScreenObject.StaticFields.forEach((function(t){"CRM_CONTACTS"==t.SysTableName.toUpperCase()&&("FirstName"==t.DBColumnName&&""!=t.Text?e+=' FirstName="'+s.GetValidXml(t.Text)+'"':"MiddleName"==t.DBColumnName&&""!=t.Text?e+=' MiddleName="'+s.GetValidXml(t.Text)+'"':"LastName"==t.DBColumnName&&""!=t.Text?e+=' LastName="'+s.GetValidXml(t.Text)+'"':"JobTitle"==t.DBColumnName&&""!=t.Text?e+=' JobTitle="'+s.GetValidXml(t.Text)+'"':"Phone1"==t.DBColumnName&&""!=t.Text?e+=' Phone1="'+s.GetValidXml(t.Text)+'"':"Phone2"==t.DBColumnName&&""!=t.Text?e+=' Phone2="'+s.GetValidXml(t.Text)+'"':"Email"==t.DBColumnName&&""!=t.Text?e+=' Email="'+s.GetValidXml(t.Text)+'"':"Fax"==t.DBColumnName&&""!=t.Text?e+=' Fax="'+s.GetValidXml(t.Text)+'"':"Department"==t.DBColumnName&&""!=t.Text&&(e+=' Department="'+s.GetValidXml(t.Text)+'"'))})),e+="/>"):this.ScreenObject.StaticFields.forEach((function(t){"CRM_CONTACTS"==t.SysTableName.toUpperCase()&&"CRM_CONTACTS"==t.SysTableName.toUpperCase()&&("FirstName"==t.DBColumnName&&""!=t.Text?e+=" FirstName='"+s.GetValidXml(t.Text)+"'":"MiddleName"==t.DBColumnName&&""!=t.Text?e+=" MiddleName='"+s.GetValidXml(t.Text)+"'":"LastName"==t.DBColumnName&&""!=t.Text?e+=" LastName='"+s.GetValidXml(t.Text)+"'":"JobTitle"==t.DBColumnName&&""!=t.Text?e+=" JobTitle='"+s.GetValidXml(t.Text)+"'":"Phone1"==t.DBColumnName&&""!=t.Text?e+=" Phone1='"+s.GetValidXml(t.Text)+"'":"Phone2"==t.DBColumnName&&""!=t.Text?e+=" Phone2='"+s.GetValidXml(t.Text)+"'":"Email"==t.DBColumnName&&""!=t.Text?e+=" Email='"+s.GetValidXml(t.Text)+"'":"Fax"==t.DBColumnName&&""!=t.Text?e+=" Fax='"+s.GetValidXml(t.Text)+"'":"Department"==t.DBColumnName&&""!=t.Text&&(e+=" Department='"+s.GetValidXml(t.Text)+"'"))})),e.toString()}catch(t){return""}}}],[{key:"GetValidXml",value:function(e){return(e=(e=(e=e.Replace("&","&amp;")).Replace("'","&apos;&apos;")).Replace('"',"&quot;")).Replace("<","&lt;")}},{key:"SetActivityUI",value:function(e,t){if(t.length>0){e.ActVisibility=!0,e.Activities=new T.a(e,!1),e.Activities.IsPopup=!1,e.Activities.LoadCustomFields(86),e.Activities.AssignVisiblity=!1,e.Activities.HeaderVisible=!1,e.Activities.ButtonsVisible=!1,e.ViewActivities=new g.b(e),e.ViewActivities.Activities=e.Activities;var s=t.filter((function(e){return"ActivityTypeName"==e.SysColumnName}));e.Activities.ActivityType.Visible=s.length>0,s=t.filter((function(e){return"StatusID"==e.SysColumnName})),e.Activities.StatusVisible=s.length>0,s=t.filter((function(e){return"Subject"==e.SysColumnName})),e.Activities.Subject.Visible=s.length>0,s=t.filter((function(e){return"CRMCustomer"==e.SysColumnName})),e.Activities.CRMCustomer.Visible=s.length>0,s=t.filter((function(e){return"CRMContactPerson"==e.SysColumnName})),e.Activities.CRMContactPerson.Visible=s.length>0,s=t.filter((function(e){return"AssignUserID"==e.SysColumnName})),e.Activities.AssignUserList.Visible=s.length>0,s=t.filter((function(e){return"Remarks"==e.SysColumnName})),e.Activities.Remarks.Visible=s.length>0,e.Activities.Fields.forEach((function(e){s=t.filter((function(t){return t.SysColumnName==e.SysColumnName})),e.Visible=s.length>0}))}else e.ActVisibility=!1}}]),s}(r.b),oe=s("5Crg"),ne=s("uMy8"),le=s("vTM8"),re=function(e){_inherits(s,e);var t=_createSuper(s);function s(e){var a;_classCallCheck(this,s),(a=t.call(this)).ButtonClick=new O.b,a.ds=[],a.dr1=[],a.Date=new C.a(0),a.Status=new u.e(0),a.Reason=new u.e(0),a.EstimatedRevenue=new h.d(0),a.Remark=new h.d(0),a.oparent=e,a.ButtonClick.Subscribe(_assertThisInitialized(a),"OnSave"),e.ScreenObject.Data.Tables[0].forEach((function(e){"24320"==e.CostCenterColID.toString()&&(a.Status.Label=e.ResourceData.toString()),"25403"==e.CostCenterColID.toString()&&(a.EstimatedRevenue.Label=e.ResourceData.toString()),"25405"==e.CostCenterColID.toString()&&(a.Date.Label=e.ResourceData.toString()),"53583"==e.CostCenterColID.toString()&&(a.Reason.Label=e.ResourceData.toString(),a.Reason.Mandatory=Object(l.j)(e.IsMandatory)),"25953"==e.CostCenterColID.toString()&&(a.Remark.Label=e.ResourceData.toString(),a.Remark.Mandatory=Object(l.j)(e.IsMandatory))}));var o=i.a.admin.GetLookupDataByType(0);if(a.dr1=o.Tables[1].filter((function(e){return 19==e.LookupType})),a.dr1.length>0){for(var n=0;n<a.dr1.length;n++)a.Reason.Items.push(u.d.ComboBoxItems_2(a.dr1[n].Name.toString(),a.dr1[n].NodeID.toString()));a.Reason.SelectedValue=a.Reason.Items[0].Value.toString()}if(null==e.ds)return _possibleConstructorReturn(a);a.drr=e.ds.Tables[0].filter((function(e){return"CloseStatus"==e.Name}));var r=null;if(a.drr.length>0&&""!=a.drr[0].Value.toString()&&(r=a.drr[0].Value.toString().split(";")),null!=r&&r.length>0)for(var d=0;d<r.length;d++)for(var c=0;d<e.Status.Items.length;c++){var m=e.Status.Items[c];if(r[d]==m.Value){a.Status.Items.push(m);break}}return a.Status.Items.length>0&&(a.Status.SelectedValue=a.Status.Items[0].Value),a.Title=a.DisplayName=i.a.GetResource("CRMOpportunity_CloseOpportunity"),a}return _createClass(s,[{key:"OnSave",value:function(e){"Cancel"==e?i.a.page.HideDialog():"OK"==e&&(null!=this.oparent.Status&&this.oparent.Status.Mandatory&&n.e.StringIsNullOrEmpty(this.Status.SelectedValue)?(this.DisplayMessage=i.a.GetResource("Select")+"  Status",this.MessageVisibility=!0):null!=this.Reason&&this.Reason.Mandatory&&n.e.StringIsNullOrEmpty(this.Reason.SelectedValue)?(this.DisplayMessage=i.a.GetResource("Select")+" Status",this.MessageVisibility=!0):null!=this.oparent.EstimatedRevenue&&this.oparent.EstimatedRevenue.Mandatory&&n.e.StringIsNullOrEmpty(this.EstimatedRevenue.Text)?(this.DisplayMessage=" Please Enter Revenue",this.MessageVisibility=!0):(this.oparent.Status.SelectedValue=this.Status.SelectedValue,this.oparent.EstimateRevenceData(this.EstimatedRevenue.Text,Date.Today(),this.Reason.SelectedValue),i.a.page.HideDialog()))}}]),s}(r.b),de=s("Sbfj"),he=function(e){_inherits(s,e);var t=_createSuper(s);function s(e,a,o){var r;_classCallCheck(this,s),(r=t.call(this)).PrintVisible=!1,r.PrintViewVisible=!1,r.AssignVisiblity=!1,r.dt=null,r.Opp=new Q.a,r.OppID=0,r.ScreenObject=new d.a,r.ButtonEnable=!0,r.CloseVisible=!1,r.Salutation=new u.e(26670),r.FirstName=new h.d(26661),r.MiddleName=new h.d(26662),r.LastName=new h.d(26663),r.JobTitle=new h.d(26664),r.Phone1=new h.d(26665),r.Phone2=new h.d(26666),r.Email=new h.d(26667),r.Fax=new h.d(26668),r.Department=new h.d(26669),r.Code=new h.a(24317),r.Date=new C.a(24319),r.Status=new u.e(24320),r.Subject=new h.d(24318),r.Company=new c.c(25400),r.Campaign=new u.e(25399),r.Mode=new u.e(26639),r.Lead=new c.b(25401),r.ContactCombo=new u.e(25402),r.EstimateRow=0,r.EstimateColumn=0,r.EstimateColumnSpan=1,r.EstimatedRevenue=new h.d(25403),r.Currency=new c.b(25404),r.EstimatedCloseDate=new C.c(25405),r.Probability=new c.b(25406),r.Rating=new c.b(25407),r.CloseDate=new h.d(25408),r.Document=new u.e(0),r.Activity=new u.e(0),r.Address1=new h.d(26679),r.Address2=new h.d(26680),r.Address3=new h.d(26681),r.City=new h.d(26682),r.State=new h.d(26683),r.Zip=new h.d(26684),r.Country=new u.e(26685),r.ActivityGridData=[],r.ActivityColumnSource=new Array,r.ContactPersonColID=0,r.Ret=0,r.CostCenterID=0,r.NodeID=0,r.NextPreviousVisibility=!0,r.ContactVisibility=!1,r.PrimaryVisibility=!1,r.ParentId=1,r.LeadModeID=0,r.LeadMode=0,r.IsGroup=!1,r.dtStatusProbability=null,r.dvContacts=null,r.dvContactsTable=null,r.lstModeDetails=new Array,r.ParentId=a,r.IsGroup=o,r.ClassName="AddEditOpportunity",r.Opp.SelectedNodeID=r.ParentId,r.CostCenterID=89,r.NodeID=e,r.OppID=e;var m=i.a.admin.GetLookupDataByType(0);if(r.LeadsProduct=new E.a(_assertThisInitialized(r),89),r.ViewFeedback=new U.a(_assertThisInitialized(r)),i.a.SessionManager.IsWebApplication&&(r.Feedback=new B.a(r.ViewFeedback)),r.ViewContacts=new L.a(_assertThisInitialized(r)),r.PrimaryContact=new v.a,r.PrimaryContact.QuickAddDContactViewModel_1(_assertThisInitialized(r)),r.PrimaryContact.IsPrimaryContact=!0,r.ViewActivities=new g.b(_assertThisInitialized(r)),r.Activities=new T.a(_assertThisInitialized(r),!1),r.ViewActivities.Activities=r.Activities,r.ViewNotes=new A.a(_assertThisInitialized(r)),r.ViewAttachments=new M.ViewAttachmentViewModel(_assertThisInitialized(r)),r.ViewAssignHistroy=new y.a(_assertThisInitialized(r)),r.ScreenObject.LoadScreen_2(_assertThisInitialized(r),89),r.EstimateRow=r.EstimatedRevenue.Row,r.EstimateColumn=r.EstimatedRevenue.Column,r.EstimateColumnSpan=r.EstimatedRevenue.ColumnSpan,r.Mode.Items.push(u.d.ComboBoxItems_2("New","0")),r.Mode.Items.push(u.d.ComboBoxItems_2("Converted","4")),null!=r.ScreenObject.Data&&r.ScreenObject.Data.Tables[4].length>0){var b=r.ScreenObject.Data.Tables[4].filter((function(e){return"ActContactPerson"==e.Name}));b.length>0&&!n.e.IsEmpty(b[0].Value)&&(r.ContactPersonColID=parseInt(b[0].Value)),(b=r.ScreenObject.Data.Tables[4].filter((function(e){return"CapsLock"==e.Name}))).length>0&&Object(l.j)(b[0].Value)&&(r.Company.IsAllCaps=!0),(b=r.ScreenObject.Data.Tables[4].filter((function(e){return"CapsToFirstLetter"==e.Name}))).length>0&&Object(l.j)(b[0].Value)&&(r.Company.IsFirstLetterCaps=!0),(b=r.ScreenObject.Data.Tables[4].filter((function(e){return"AccountLinkDimension"==e.Name}))).length>0&&!n.e.IsEmpty(b[0].Value)&&(r.Mode.Items.push(u.d.ComboBoxItems_2("Account","2")),r.lstModeDetails.push(u.d.ComboBoxItems_2(b[0].Value.toString(),"Account"))),(b=r.ScreenObject.Data.Tables[4].filter((function(e){return"CustomerInMode"==e.Name}))).length>0&&Object(l.j)(b[0].Value)&&(r.Mode.Items.push(u.d.ComboBoxItems_2("Customer","3")),r.lstModeDetails.push(u.d.ComboBoxItems_2(b[0].Value.toString(),"Customer"))),b=r.ScreenObject.Data.Tables[4].filter((function(e){return"HidePrimaryContact"==e.Name})),r.PrimaryVisibility=b.length>0&&!Object(l.j)(b[0].Value)}r.Company.Code.Visible=!1,r.Company.TextVisible=!0,r.ScreenObject.Data.Tables.length>5&&(r.dtStatusProbability=r.ScreenObject.Data.Tables[6]),r.Lead.SelectionChangedCommand.Subscribe(_assertThisInitialized(r),"onClickLeadCommand"),r.Mode.SelectionChangedCommand.Subscribe(_assertThisInitialized(r),"OnModeChange"),r.Status.SelectionChangedCommand.Subscribe(_assertThisInitialized(r),"onStatusSelectionChanged"),r.ContactCombo.SelectionChangedCommand.Subscribe(_assertThisInitialized(r),"onContactSelectionChanged"),r.EstimatedRevenue.Enable=!1,r.Company.Code.SelectionChangedCommand.Subscribe(_assertThisInitialized(r),"onCompanySelectionChanged");var p=m.Tables[1].filter((function(e){return 56==e.LookupType}));p.length>0&&u.e.FillComboWithDefaultOption(p,r.Status),(p=m.Tables[1].filter((function(e){return 20==e.LookupType}))).length>0&&u.e.FillComboWithDefaultOption(p,r.Salutation),p=m.Tables[1].filter((function(e){return 16==e.LookupType}));for(var S=0;S<r.ScreenObject.CustomTab.Pages.length;S++)if("Address Details"==r.ScreenObject.CustomTab.Pages[S].Name.toString())for(var I=0;I<r.ScreenObject.CustomTab.Pages[S].Fields.length;I++)if(26685==r.ScreenObject.CustomTab.Pages[S].Fields[I].DBColumnID&&p.length>0){for(var V=0;V<p.length;V++)r.ScreenObject.CustomTab.Pages[S].Fields[I].Items.push(u.d.ComboBoxItems_2(p[V].Name.toString(),p[V].NodeID.toString()));r.ScreenObject.CustomTab.Pages[S].Fields[I].SelectedValue=r.ScreenObject.CustomTab.Pages[S].Fields[I].Items[0].Value}if(r.ContactCombo.Items.push(u.d.ComboBoxItems_2("New","0")),r.ContactCombo.SelectedValue="0",r.Campaign.Items.push(u.d.ComboBoxItems_2("Default","1")),r.Campaign.SelectedValue="1",null!=r.dt&&r.dt.Tables.length>1&&r.dt.Tables[1].length>0){for(var f=0;f<r.dt.Tables[1].length;f++)r.Document.Items.push(u.d.ComboBoxItems_2(r.dt.Tables[1][f].DOCNAME.toString(),r.dt.Tables[1][f].DOCID.toString()));r.Document.SelectedValue="-1"}return r.Activity.Items.push(u.d.ComboBoxItems_2("All","-1")),r.Activity.Items.push(u.d.ComboBoxItems_2("Open","1")),r.Activity.Items.push(u.d.ComboBoxItems_2("Closed","2")),r.Activity.SelectedValue="1",r.loadtabs(),r.ButtonSave=new D.a,r.ButtonEmail=new D.a,0==e&&(i.a.SessionManager.HideUnathorizedAccess?r.ButtonSave.Visible=i.a.SessionManager.IsActionAssigned(89,"Create"):r.ButtonSave.Enable=i.a.SessionManager.IsActionAssigned(89,"Create")),0!=e?i.a.SessionManager.HideUnathorizedAccess?r.ButtonEmail.Visible=i.a.SessionManager.IsActionAssigned(r.CostCenterID,"Email"):r.ButtonEmail.Enable=i.a.SessionManager.IsActionAssigned(r.CostCenterID,"Email"):i.a.SessionManager.HideUnathorizedAccess?r.ButtonSave.Visible=i.a.SessionManager.IsActionAssigned(89,"Update"):r.ButtonSave.Enable=i.a.SessionManager.IsActionAssigned(89,"Update"),r.ScreenObject.InitAutoCode(r.ScreenObject.Data.Tables[7],!1),r.AutoGenerateCode(),r.ds=[],0==e?(r.DisplayName=i.a.GetResource("CRMOpportunity_AddOpportunity"),r.Opp.GUID="Guid",r.GetCurrency(),r.NextPreviousVisibility=!1,r.Lead.CCID=86,r.Currency.CCID=12,r.Lead.TypeID=r.Currency.TypeID=1,r.Lead.SelectedValue=r.Currency.SelectedValue=1,r.CloseDate.IsReadOnly=!0,r.CloseVisible=!1,r.OnModeChange(null)):(r.Lead.CCID=86,r.Currency.CCID=12,r.Lead.TypeID=r.Currency.TypeID=1,r.Lead.SelectedValue=r.Currency.SelectedValue=1,r.DisplayName=i.a.GetResource("CRMOpportunity_EditOpportunity"),r.LoadData(e),r.CloseDate.IsReadOnly=!0,r.PrintVisible=!0,r.PrintViewVisible=!0,r.CloseVisible=!0),r.Title=r.DisplayName,r.PrimaryContact.Visiblebtns=!1,r.ContactVisibility=!1,r.ScreenObject.CheckEstimateRevenueMapping(r.LeadsProduct.DestProductValueMapping),r.ScreenObject.HeaderFields.sort((function(e,t){return e.Row>t.Row||e.Row==t.Row&&e.Column>t.Column?1:-1})),r}return _createClass(s,[{key:"OnAddContact",value:function(){this.Contact=new v.a,this.Contact.QuickAddDContactViewModel_1(this)}},{key:"OnAddNote",value:function(){this.Note=new f.AddNoteViewModel,this.Note.AddNoteViewModel_2(this)}},{key:"OnAddAttachment",value:function(){this.Attachment=new w.AddAttachmentViewModel,this.Attachment.AddAttachmentViewModel_2(this)}},{key:"onStatusSelectionChanged",value:function(e){var t=this;if(""!=this.Status.SelectedValue){var s=this.dtStatusProbability.filter((function(e){return e.Status==t.Status.SelectedValue}));s.length>0?(this.Probability.SelectedValue=parseInt(s[0].Probability.toString()),this.Probability.Enable=!1):this.Probability.Enable=!0}}},{key:"onCompanySelectionChanged",value:function(e){if(this.EnableControls(!0),this.ContactCombo.Items.Clear(),"3"==this.Mode.SelectedValue){if(0!=this.Company.Code.SelectedValue){var t=new m.a;t.CustomerID=this.Company.Code.SelectedValue;var s=t.GetCustomerDetails();if(null!=s&&s.Tables[0].length>0){if(this.ViewContacts.ContactsListObj.Clear(),this.ContactCombo.Items.push(u.d.ComboBoxItems_2("New","0")),this.ContactCombo.SelectedValue="0",s.Tables.length>5&&s.Tables[5].length>0)for(var a=0;a<s.Tables[5].length;a++)n.e.IsEmpty(s.Tables[5][a].ContactID)||this.ContactCombo.Items.push(u.d.ComboBoxItems_2(n.e.String(s.Tables[5][a].FirstName),n.e.String(s.Tables[5][a].ContactID)));if(s.Tables.length>2&&s.Tables[2].length>0){for(var o=0;o<s.Tables[2].length;o++)n.e.IsEmpty(s.Tables[2][o].ContactID)||this.ContactCombo.Items.push(u.d.ComboBoxItems_2(n.e.String(s.Tables[2][o].FirstName),n.e.String(s.Tables[2][o].ContactID)));this.dvContacts=s.Tables[2],this.dvContactsTable=this.dvContacts,s.Tables.length>5&&s.Tables[5].length>0&&this.dvContactsTable.AddRange(s.Tables[5])}}this.Company.Code.SelectedValue!=this.Company.Code.PreviousSelectedValue&&(this.Company.Code.PreviousSelectedValue=this.Company.Code.SelectedValue,this.ScreenObject.OnGetReference(this.Company.Code))}}else if("2"==this.Mode.SelectedValue){if(0!=this.Company.Code.SelectedValue){var l=i.a.accounting.GetAccountDetails(this.Company.Code.SelectedValue);if(null!=l&&l.Tables[0].length>0){if(this.ContactCombo.Items.push(u.d.ComboBoxItems_2("New","0")),this.ContactCombo.SelectedValue="0",l.Tables.length>8&&l.Tables[8].length>0)for(var r=0;r<l.Tables[8].length;r++)this.ContactCombo.Items.push(u.d.ComboBoxItems_2(l.Tables[8][r].FirstName.toString(),l.Tables[8][r].ContactID.toString()));if(l.Tables.length>2&&l.Tables[2].length>0){for(var d=0;d<l.Tables[2].length;d++)this.ContactCombo.Items.push(u.d.ComboBoxItems_2(l.Tables[2][d].FirstName.toString(),l.Tables[2][d].ContactID.toString()));this.dvContacts=l.Tables[2],this.dvContactsTable=this.dvContacts,l.Tables.length>8&&l.Tables[8].length>0&&this.dvContactsTable.AddRange(l.Tables[8])}}this.Company.Code.SelectedValue!=this.Company.Code.PreviousSelectedValue&&(this.Company.Code.PreviousSelectedValue=this.Company.Code.SelectedValue,this.ScreenObject.OnGetReference(this.Company.Code))}}else this.ViewContacts.isPick=!1}},{key:"onContactSelectionChanged",value:function(e){var t=this;this.EnableControls(!0),null!=this.dvContacts&&null!=this.ContactCombo.SelectedValue&&"0"!=this.ContactCombo.SelectedValue&&(this.dvContacts=this.dvContactsTable.filter((function(e){return e.ContactID==t.ContactCombo.SelectedValue})),this.dvContacts.length>0&&(this.EnableControls(!1),this.FirstName.Visible&&(this.FirstName.Text=this.dvContacts[0].FirstName.toString()),this.LastName.Visible&&(this.LastName.Text=this.dvContacts[0].LastName.toString()),this.MiddleName.Visible&&(this.MiddleName.Text=this.dvContacts[0].MiddleName.toString()),this.Salutation.Visible&&(this.Salutation.SelectedValue=this.dvContacts[0].SalutationID.toString()),this.JobTitle.Visible&&(this.JobTitle.Text=this.dvContacts[0].JobTitle.toString()),this.Phone1.Visible&&(this.Phone1.Text=this.dvContacts[0].Phone1.toString()),this.Phone2.Visible&&(this.Phone2.Text=this.dvContacts[0].Phone2.toString()),this.Email.Visible&&(this.Email.Text=this.dvContacts[0].Email1.toString()),this.Fax.Visible&&(this.Fax.Text=this.dvContacts[0].Fax.toString()),this.Department.Visible&&(this.Department.Text=this.dvContacts[0].Department.toString())))}},{key:"GetRecords",value:function(e){this.ButtonSave.Enable||(this.ButtonSave.Enable=!0);var t=0,s=!1;"NEXT"==e.toString().toUpperCase()?s=!0:"PREVIOUS"==e.toString().toUpperCase()&&(s=!1);var a=i.a.common.GetNextPreviousRecords(this.CostCenterID,this.OppID,s,0,this.IsGroup?1:0);if(null!=a&&a.Tables.length>0&&a.Tables[0].length>0&&(t=parseInt(a.Tables[0][0][a.Columns[0][0]]))>0){this.Mode.Items.Clear(),this.lstModeDetails.Clear(),this.Mode.Items.push(u.d.ComboBoxItems_2("New","0")),this.Mode.Items.push(u.d.ComboBoxItems_2("Converted","4"));var o=this.ScreenObject.Data.Tables[4].filter((function(e){return"AccountLinkDimension"==e.Name}));o.length>0&&""!=o[0].Value.toString()&&(this.Mode.Items.push(u.d.ComboBoxItems_2("Account","2")),this.lstModeDetails.push(u.d.ComboBoxItems_2(o[0].Value.toString(),"Account"))),(o=this.ScreenObject.Data.Tables[4].filter((function(e){return"CustomerInMode"==e.Name}))).length>0&&Object(l.j)(o[0].Value)&&(this.Mode.Items.push(u.d.ComboBoxItems_2("Customer","3")),this.lstModeDetails.push(u.d.ComboBoxItems_2(o[0].Value.toString(),"Customer"))),this.LoadData(t)}}},{key:"OnModeChange",value:function(e){if(this.ViewContacts.isPick=!1,"4"==this.Mode.SelectedValue&&this.Mode.Enable&&(this.Mode.SelectedValue="0"),"1"==this.Mode.SelectedValue){if(this.Company.Code.Visible=!0,this.Company.TextVisible=!1,this.lstModeDetails.filter((function(e){return"LEAD"==e.Value.toUpperCase()})).length>0){var t=this.lstModeDetails.find((function(e){return"Lead"==e.Value}));this.Company.Code.CCID=parseInt(t.Name),this.Company.Code.TypeID=1,this.Company.Label="Company",this.Company.Code.Refresh()}}else if("3"==this.Mode.SelectedValue){if(this.ViewContacts.isPick=!0,this.Company.Code.Visible=!0,this.Company.TextVisible=!1,this.lstModeDetails.filter((function(e){return"CUSTOMER"==e.Value.toUpperCase()})).length>0){this.Company.Code.PreviousSelectedValue=0,this.Company.Code.DBColumnName="CustomerID",this.Company.Code.CCID=83,this.Company.Label="Customer";var s=this.lstModeDetails.find((function(e){return"Customer"==e.Value}));this.Company.Code.TypeID=1,this.Company.Code.Refresh()}}else"2"==this.Mode.SelectedValue?(this.ViewContacts.isPick=!0,this.Company.Code.Visible=!0,this.Company.TextVisible=!1,this.lstModeDetails.filter((function(e){return"ACCOUNT"==e.Value.toUpperCase()})).length>0&&(this.Company.Code.PreviousSelectedValue=0,this.Company.Code.DBColumnName="AccountID",this.Company.Code.CCID=2,this.Company.Label="Account",s=this.lstModeDetails.find((function(e){return"Account"==e.Value})),this.Company.Code.TypeID=parseInt(s.Name),this.Company.Code.Refresh())):(this.Company.Label="Company",this.Company.Code.Visible=!1,this.Company.TextVisible=!0)}},{key:"onClickLeadCommand",value:function(e){}},{key:"onTabSelectionChanged",value:function(e){var t=this;if(null!=this.ScreenObject.CustomTab.SelectedTab)if("Activities"==this.ScreenObject.CustomTab.SelectedTab.Name){this.ScreenObject.CustomTab.ColumnSpan=4,"0"==this.Mode.SelectedValue||"4"==this.Mode.SelectedValue?(this.Activities.CRMCustomer.Text=this.Company.Text,"4"!=this.Mode.SelectedValue||2!=this.LeadMode&&3!=this.LeadMode||(2==this.LeadMode?this.Activities.CRMCustomer.Code.CCID=2:3==this.LeadMode&&(this.Activities.CRMCustomer.Code.CCID=83),this.Activities.CRMCustomer.Code.TypeID=1,this.LeadModeID>0&&(this.Activities.CRMCustomer.Code.SelectedValue=this.LeadModeID),this.Activities.onCustomerSelectionChange("Customer"))):(this.Activities.CRMCustomer.Text=this.Company.Code.Text,null!=this.Activities.CRMCustomer&&(this.Activities.CRMCustomer.Code.CCID=this.Company.Code.CCID,this.Activities.CRMCustomer.Code.TypeID=this.Company.Code.TypeID),this.Activities.CRMCustomer.Text=this.Company.Code.Text,this.Activities.CRMCustomer.Code.SelectedValue=this.Company.Code.SelectedValue,this.Activities.onCustomerSelectionChange("Customer"));var s=this.ScreenObject.StaticFields.find((function(e){return e.DBColumnID==t.ContactPersonColID}));null!=s&&s instanceof h.d&&(this.Activities.CRMContactPerson.Text=s.Text),this.Activities.Location.Text=i.a.SessionManager.LocationName,this.Activities.Location.Enable=!1,this.Activities.CRMCustomer.Enable=!1,this.Activities.AssignVisiblity=!1,this.PrimaryVisibility=!1,this.PrimaryContact.Visiblebtns=!1,this.ContactVisibility=!1}else"Contacts"==this.ScreenObject.CustomTab.SelectedTab.Name&&(this.PrimaryVisibility=!1,this.PrimaryContact.Visiblebtns=!0,this.ViewContacts.OnShowNewContact(null),1==this.Contact.isPopup&&(this.ContactVisibility=!1))}},{key:"LoadData",value:function(e){if(this.OppID=e,this.ds=this.Opp.GetOpportunity(e),this.ScreenObject.IsAutoCode&&(this.Code.Enable=!1),null!=this.ds&&this.ds.Tables.length>1&&this.ds.Tables[1].length>0){if(n.e.IsEmpty(this.ds.Tables[1][0].Code)||(this.Code.Text=this.ds.Tables[1][0].Code.toString()),n.e.IsEmpty(this.ds.Tables[1][0].Subject)||(this.Subject.Text=this.ds.Tables[1][0].Subject.toString()),n.e.IsEmpty(this.ds.Tables[1][0].Date)||(this.Date.Date=new Date(this.ds.Tables[1][0].Date.toString())),n.e.IsEmpty(this.ds.Tables[1][0].StatusID)||(this.Status.SelectedValue=this.ds.Tables[1][0].StatusID.toString()),n.e.IsEmpty(this.ds.Tables[1][0].LeadID)||(this.Lead.SelectedValue=parseInt(this.ds.Tables[1][0].LeadID.toString())),n.e.IsEmpty(this.ds.Tables[1][0].CampaignID)||(this.Campaign.SelectedValue=this.ds.Tables[1][0].CampaignID.toString()),this.EstimatedRevenue.Text="0",n.e.IsEmpty(this.ds.Tables[1][0].EstimatedRevenue)||(this.EstimatedRevenue.Text=n.e.Double(this.ds.Tables[1][0].EstimatedRevenue).ToString("N2")),n.e.IsEmpty(this.ds.Tables[1][0].CurrencyID)||(this.Currency.SelectedValue=parseInt(this.ds.Tables[1][0].CurrencyID.toString())),n.e.IsEmpty(this.ds.Tables[1][0].EstimatedCloseDate)||(this.EstimatedCloseDate.Date=new Date(this.ds.Tables[1][0].EstimatedCloseDate.toString())),n.e.IsEmpty(this.ds.Tables[1][0].ProbabilityLookUpID)||(this.Probability.SelectedValue=parseInt(this.ds.Tables[1][0].ProbabilityLookUpID.toString())),n.e.IsEmpty(this.ds.Tables[1][0].ReasonLookUpID)||(this.Reason=this.ds.Tables[1][0].ReasonLookUpID.toString()),n.e.IsEmpty(this.ds.Tables[1][0].RatingLookUpID)||(this.Rating.SelectedValue=parseInt(this.ds.Tables[1][0].RatingLookUpID.toString())),n.e.IsEmpty(this.ds.Tables[1][0].CloseDate)||(this.CloseDate.Text=new Date(this.ds.Tables[1][0].CloseDate.toString()).ToString(i.a.SessionManager.Preferences["Date Format"].toString()),this.CloseDate.Tag=new Date(this.ds.Tables[1][0].CloseDate.toString()).toString()),n.e.IsEmpty(this.ds.Tables[1][0].Mode)||("4"==this.ds.Tables[1][0].Mode.toString()?(this.Lead.Enable=!1,this.Mode.Enable=!1,n.e.IsEmpty(this.ds.Tables[1][0].LeadMode)||(this.LeadMode=parseInt(this.ds.Tables[1][0].LeadMode.toString()),n.e.IsEmpty(this.ds.Tables[1][0].CustomerID)||(this.LeadModeID=parseInt(this.ds.Tables[1][0].CustomerID.toString())))):(this.Lead.Enable=!0,this.Mode.Enable=!0),this.Mode.SelectedValue=this.ds.Tables[1][0].Mode.toString()),this.ds.Tables.length>0&&this.ds.Tables[0].length>0){var t=this.ds.Tables[0].filter((function(e){return"StatusReadOnly"==e.Name})),s=null;if(t.length>0&&!n.e.IsEmpty(t[0].Value)&&(s=t[0].Value.toString().split(";")),null!=s&&s.length>0)for(var a=0;a<s.length;a++)if(s[a]==this.Status.SelectedValue){this.ButtonSave.Enable=!1;break}}if(n.e.IsEmpty(this.ds.Tables[1][0].Company)||(this.OnModeChange(null),"0"==this.Mode.SelectedValue||"4"==this.Mode.SelectedValue?this.Company.Text=this.ds.Tables[1][0].Company.toString():(this.Company.Code.SelectedValue=parseInt(this.ds.Tables[1][0].SelectedModeID),this.ScreenObject.OnGetReference(this.Company.Code))),"3"==this.Mode.SelectedValue){this.ContactCombo.Items.Clear();var o=new m.a;o.CustomerID=this.Company.Code.SelectedValue;var l=o.GetCustomerDetails();if(null!=l&&l.Tables[0].length>0){if(this.ContactCombo.Items.push(u.d.ComboBoxItems_2("New","0")),this.ContactCombo.SelectedValue="0",l.Tables.length>5&&l.Tables[5].length>0)for(var r=0;r<l.Tables[5].length;r++)n.e.IsEmpty(l.Tables[5][r].ContactID)||this.ContactCombo.Items.push(u.d.ComboBoxItems_2(l.Tables[5][r].FirstName.toString(),l.Tables[5][r].ContactID.toString()));if(l.Tables.length>1&&l.Tables[2].length>0){for(var d=0;d<l.Tables[2].length;d++)n.e.IsEmpty(l.Tables[2][d].ContactID)||this.ContactCombo.Items.push(u.d.ComboBoxItems_2(l.Tables[2][d].FirstName.toString(),l.Tables[2][d].ContactID.toString()));this.dvContacts=l.Tables[2],this.dvContactsTable=this.dvContacts,l.Tables.length>5&&l.Tables[5].length>0&&this.dvContactsTable.AddRange(l.Tables[5])}}}if("2"==this.Mode.SelectedValue){this.ContactCombo.Items.Clear();var h=i.a.accounting.GetAccountDetails(this.Company.Code.SelectedValue);if(null!=h&&h.Tables[0].length>0){if(this.ContactCombo.Items.push(u.d.ComboBoxItems_2("New","0")),this.ContactCombo.SelectedValue="0",h.Tables.length>8&&h.Tables[8].length>0)for(var c=0;c<h.Tables[8].length;c++)n.e.IsEmpty(h.Tables[8][c].ContactID)||this.ContactCombo.Items.push(u.d.ComboBoxItems_2(h.Tables[8][c].FirstName.toString(),h.Tables[8][c].ContactID.toString()));if(h.Tables.length>1&&h.Tables[2].length>0){for(var C=0;C<h.Tables[2].length;C++)n.e.IsEmpty(h.Tables[2][C].ContactID)||this.ContactCombo.Items.push(u.d.ComboBoxItems_2(h.Tables[2][C].FirstName.toString(),h.Tables[2][C].ContactID.toString()));this.dvContacts=h.Tables[2],this.dvContactsTable=this.dvContacts,h.Tables.length>8&&h.Tables[8].length>0&&this.dvContactsTable.AddRange(h.Tables[8])}}}if("4"==this.Mode.SelectedValue&&(this.ContactCombo.Items.Clear(),this.ds.Tables.length>15)){if(this.ContactCombo.Items.push(u.d.ComboBoxItems_2("New","0")),this.ContactCombo.SelectedValue="0",this.ds.Tables[15].length>0)for(var b=0;b<this.ds.Tables[15].length;b++)n.e.IsEmpty(this.ds.Tables[15][b].ContactID)||this.ContactCombo.Items.push(u.d.ComboBoxItems_2(this.ds.Tables[15][b].FirstName.toString(),this.ds.Tables[15][b].ContactID.toString()));if(this.ds.Tables[14].length>0)for(var p=0;p<this.ds.Tables[14].length;p++)n.e.IsEmpty(this.ds.Tables[14][p].ContactID)||this.ContactCombo.Items.push(u.d.ComboBoxItems_2(n.e.String(this.ds.Tables[14][p].FirstName),this.ds.Tables[14][p].ContactID.toString()));this.dvContacts=this.ds.Tables[14],this.dvContactsTable=this.dvContacts,this.ds.Tables[15].length>0&&this.dvContactsTable.AddRange(this.ds.Tables[15])}n.e.IsEmpty(this.ds.Tables[1][0].ContactID.toString())||(this.ContactCombo.SelectedValue=this.ds.Tables[1][0].ContactID.toString()),null!=this.ContactCombo.SelectedValue&&"0"!=this.ContactCombo.SelectedValue&&this.EnableControls(!1),null==this.ContactCombo.GetselectedItem()&&this.ContactCombo.Items.length>1&&(this.ContactCombo.SelectedValue=this.ContactCombo.Items[1].Value),null!=this.ds&&this.ds.Tables.length>12&&this.ds.Tables[13].length>0&&(n.e.IsEmpty(this.ds.Tables[13][0].FirstName.toString())||(this.FirstName.Text=this.ds.Tables[13][0].FirstName.toString()),n.e.IsEmpty(this.ds.Tables[13][0].MiddleName.toString())||(this.MiddleName.Text=this.ds.Tables[13][0].MiddleName.toString()),n.e.IsEmpty(this.ds.Tables[13][0].LastName.toString())||(this.LastName.Text=this.ds.Tables[13][0].LastName.toString()),n.e.IsEmpty(this.ds.Tables[13][0].SalutationID.toString())||(this.Salutation.SelectedValue=this.ds.Tables[13][0].SalutationID.toString()),n.e.IsEmpty(this.ds.Tables[13][0].JobTitle.toString())||(this.JobTitle.Text=this.ds.Tables[13][0].JobTitle.toString()),n.e.IsEmpty(this.ds.Tables[13][0].Company.toString())||(this.Company.Text=this.ds.Tables[13][0].Company.toString()),n.e.IsEmpty(this.ds.Tables[13][0].Phone1.toString())||(this.Phone1.Text=this.ds.Tables[13][0].Phone1.toString()),n.e.IsEmpty(this.ds.Tables[13][0].Phone2.toString())||(this.Phone2.Text=this.ds.Tables[13][0].Phone2.toString()),n.e.IsEmpty(this.ds.Tables[13][0].Email1.toString())||(this.Email.Text=this.ds.Tables[13][0].Email1.toString()),n.e.IsEmpty(this.ds.Tables[13][0].Fax.toString())||(this.Fax.Text=this.ds.Tables[13][0].Fax.toString()),n.e.IsEmpty(this.ds.Tables[13][0].Department.toString())||(this.Department.Text=this.ds.Tables[13][0].Department.toString()),this.LoadCustomFieldsData(this.ds.Tables[13],this.ds.Columns[13])),null!=this.ds&&this.ds.Tables.length>4&&this.ViewActivities.LoadActivityData(this.ds.Tables[4]),null!=this.ds&&this.ds.Tables.length>5&&this.LeadsProduct.LoadProductData(this.ds.Tables[5],this.ds.Columns[5]),null!=this.ds&&this.ds.Tables.length>8&&this.ScreenObject.LoadCustomFieldsData(this.ds.Tables[8]),null!=this.ds&&this.ds.Tables.length>9&&this.ViewNotes.LoadNotes(this.ds.Tables[9]),null!=this.ds&&this.ds.Tables.length>10&&this.ViewAttachments.LoadAttachments(this.ds.Tables[10]),null!=this.ds&&this.ds.Tables.length>11&&this.ScreenObject.LoadCustomFieldsCCData(this.ds.Tables[11]),null!=this.ds&&this.ds.Tables.length>12&&this.ViewFeedback.LoadData(this.ds.Tables[12]),null!=this.PrimaryContact&&this.PrimaryContact.LoadContacts(this.ds.Tables[14]),this.ViewContacts.LoadContacts(this.ds.Tables[15],this.ds.Columns[15]),this.ViewAssignHistroy.LoadHistroy_1(89,this.OppID),this.LoadReport()}}},{key:"LoadCustomFieldsData",value:function(e,t){if(null!=e&&e.length>0)try{this.ScreenObject.CustomTab.Pages.forEach((function(s){s.Fields.forEach((function(s){s instanceof O.c&&null!=s.DBColumnName&&t.Contains(s.DBColumnName)&&(s instanceof h.d?s.Text=n.e.String(e[0][s.DBColumnName]).Replace("&amp","&").Replace("''","'"):s instanceof h.c?s.Text=n.e.String(e[0][s.DBColumnName]).Replace("&amp;","&").Replace("''","'"):s instanceof u.e?s.SelectedValue="Gender"==s.DBColumnName.toString()?"Female"==e[0][s.DBColumnName].toString()?"2":"1":n.e.String(e[0][s.DBColumnName]).Replace("&amp;","&").Replace("''","'"):s instanceof C.a?n.e.isValidDate(e[0][s.DBColumnName])&&(s.Date=new Date(e[0][s.DBColumnName])):s instanceof N.a?s.Text=e[0][s.DBColumnName].toString():s instanceof c.b&&n.e.IsNum(e[0][s.DBColumnName])&&(s.SelectedValue=parseInt(e[0][s.DBColumnName])))}))}))}catch(s){Logger.ErrorLog("AddEditLeads::  LoadCustomFieldsData : "+s.stack)}}},{key:"EnableControls",value:function(e){this.FirstName.Visible&&(this.FirstName.Enable=e,this.FirstName.Text=""),this.LastName.Visible&&(this.LastName.Enable=e,this.LastName.Text=""),this.MiddleName.Visible&&(this.MiddleName.Enable=e,this.MiddleName.Text=""),this.Salutation.Visible&&(this.Salutation.Enable=e,this.Salutation.SelectedValue="0"),this.JobTitle.Visible&&(this.JobTitle.Enable=e,this.JobTitle.Text=""),this.Phone1.Visible&&(this.Phone1.Enable=e,this.Phone1.Text=""),this.Phone2.Visible&&(this.Phone2.Enable=e,this.Phone2.Text=""),this.Email.Visible&&(this.Email.Enable=e,this.Email.Text=""),this.Fax.Visible&&(this.Fax.Enable=e,this.Fax.Text=""),this.Department.Visible&&(this.Department.Enable=e,this.Department.Text="")}},{key:"details",value:function(){Logger.InfoLog("AddEditLeads::Entering details");try{var e="";return e+="<Row ",e+=""!=this.FirstName.Text&&""!=this.FirstName.Text?' FirstName="'+se.GetValidXml(this.FirstName.Text)+'"':' FirstName=""',e+=""!=this.MiddleName.Text&&""!=this.MiddleName.Text?' MiddleName="'+se.GetValidXml(this.MiddleName.Text)+'"':' MiddleName=""',e+=""!=this.LastName.Text&&""!=this.LastName.Text?' LastName="'+se.GetValidXml(this.LastName.Text)+'"':' LastName=""',e+=""!=this.Salutation.SelectedValue?' Salutation="'+this.Salutation.SelectedValue+'"':' Salutation="0"',e+=""!=this.JobTitle.Text&&""!=this.JobTitle.Text?' JobTitle="'+se.GetValidXml(this.JobTitle.Text)+'"':' JobTitle=""',e+=""!=this.Phone1.Text&&""!=this.Phone1.Text?' Phone1="'+se.GetValidXml(this.Phone1.Text)+'"':' Phone1=""',e+=""!=this.Phone2.Text&&""!=this.Phone2.Text?' Phone2="'+se.GetValidXml(this.Phone2.Text)+'"':' Phone2=""',e+=""!=this.Email.Text&&""!=this.Email.Text?' Email="'+se.GetValidXml(this.Email.Text)+'"':' Email=""',e+=""!=this.Fax.Text&&""!=this.Fax.Text?' Fax="'+se.GetValidXml(this.Fax.Text)+'"':' Fax="'+this.Fax.Text+'"',e+=""!=this.Department.Text&&""!=this.Department.Text?' Department="'+se.GetValidXml(this.Department.Text)+'"':' Department=""',e+="/>",Logger.InfoLog("AddEditLeads::Exiting details"),e.toString()}catch(t){return""}}},{key:"ClearFields",value:function(){this.Subject.Text="",this.Company.Text="",this.Status.SelectedValue="1",this.Campaign.SelectedValue="",this.Lead.SelectedValue=0,this.ContactCombo.SelectedValue="53",this.EstimatedRevenue.Text="",this.Currency.SelectedValue=1,this.Probability.SelectedValue=0,this.Rating.SelectedValue=0,this.CloseDate.Text="",this.ViewActivities.ActivityGridData.Clear(),this.ViewActivities.ActivityGridDataObj.refreshDataView(),this.ViewActivities.Activity.SelectedValue="-1",this.LeadsProduct.ClearGrid(),this.ScreenObject.Clear()}},{key:"EstimateRevenceData",value:function(e,t,s){try{this.EstimatedRevenue.Text=parseFloat(e).ToString("N2")}catch(a){this.EstimatedRevenue.Text="0"}this.CloseDate.Text=t.ToString(i.a.SessionManager.Preferences["Date Format"].toString()),this.CloseDate.Tag=t.toString(),this.Reason=s}},{key:"AutoGenerateCode",value:function(){0==this.OppID&&this.ScreenObject.SetAutoCode(this.Code,!1,this.ParentId,this.ScreenObject.Data.Tables[7])}},{key:"OnCellEditEnding",value:function(e){var t=e.item;if("Microsoft.Windows.Controls.DataGridComboBoxColumn"!=e.OriginalSource.Column.GetType().toString()){if(t.Table.Columns.Contains("UOM")&&"ProductName"==e.OriginalSource.Column.Binding.Path.Path&&!n.e.IsEmpty(t.ProductName_Key)){var s=d.a.GetProductTypeDetails(parseInt(t.ProductName_Key.toString()),this.Date.Date,0,81,"",!1,!1,!1,!1,!1,!1,!1,!1,!1);s.Tables.length>0&&s.Columns[0].Contains("uomid")&&!n.e.IsEmpty(s.Tables[0][0].uomid)&&(t.UOM=s.Tables[0][0].UnitName.toString(),t.UOM_Key=s.Tables[0][0].uomid.toString(),s.Tables.length>3&&s.Tables[3].length>0&&s.Columns[3].Contains("PurchaseRate")&&!n.e.IsEmpty(s.Tables[3][0].PurchaseRate)?t.UnitPrice=s.Tables[3][0].PurchaseRate.toString():s.Tables.length>0&&s.Tables[0].length>0&&s.Columns[0].Contains("PurchaseRate")&&!n.e.IsEmpty(s.Tables[0][0].PurchaseRate)&&(t.UnitPrice=s.Tables[0][0].PurchaseRate.toString()),t.AcceptChanges())}this.CalculateTotals(t)}}},{key:"CalculateTotals",value:function(e){var t=new le.a,s=new ne.c;s.setFieldDetails("RATE",1,1,"",1,!1,!1),t.push("RATE",s),(s=new ne.c).setFieldDetails("QTY",4,1,"",1,!1,!1),t.push("QTY",s),e.Table.Columns.Contains("UnitPrice")&&!n.e.IsEmpty(e.UnitPrice)?t.RATE.setFieldValue(e.UnitPrice):t.RATE.setFieldValue(0),e.Table.Columns.Contains("Qty")&&!n.e.IsEmpty(e.Qty)?t.QTY.setFieldValue(e.Qty):t.QTY.setFieldValue(0),e.Value=i.a.eval.EvaluateExpression("QTY*RATE",t).toString()}},{key:"onBeginEdit",value:function(e){if("DataGridPactListBoxColumn"==e.column.className){var t=e.column.DgCol;if(11==t.CostCenterID){var s=e.item,i=" (BaseID IN ";i+=" (SELECT BaseID ",i=(i+=" FROM COM_UOM AS COM_UOM_1 WITH(NOLOCK) ")+" WHERE (UOMID ="+s.UOM_Key.toString()+" ))) ",""==s.UOM_Key.toString()&&(i=" (BaseID IN ",i+=" (SELECT BaseID ",i+=" FROM COM_UOM AS COM_UOM_1 WITH(NOLOCK) ",i+=" WHERE (UOMID =-1 ))) "),t.FilterCondition=i}}}},{key:"loadtabs",value:function(){this.AssignRowColumns();for(var e=this.ScreenObject.CustomTab.Pages.length-1;e>=0;e--){var t=this.ScreenObject.CustomTab.Pages[e];switch(t.Name){case"Products":t.Fields.push(this.LeadsProduct);break;case"Activities":t.Fields.push(this.ViewActivities);break;case"History":t.Fields.push(this.ViewAssignHistroy.ListObj);break;case"Attachments":t.Fields.push(this.ViewAttachments);break;case"Notes":t.Fields.push(this.ViewNotes);break;case"Follow Up":t.Fields.push(this.ViewFeedback);break;case"Contacts":t.Fields.push(this.ViewContacts)}}}},{key:"AssignRowColumns",value:function(){for(var e=this.ScreenObject.CustomFields.length,t=0;t<e;t++)this.ScreenObject.CustomFields[t].Row=t/4,this.ScreenObject.CustomFields[t].Column=t%4}},{key:"GetCurrency",value:function(){var e=[];e.push(0),e.push(i.a.SessionManager.UserID);var t=i.a.admin.GetCurrencies(e);null!=t&&t.Tables.length>0&&t.Columns[0].Contains("CurrencyID")&&(this.Currency.SelectedValue=n.e.IsEmpty(t.Tables[0][0].CurrencyID)?0:parseInt(t.Tables[0][0].CurrencyID.toString()))}},{key:"LoadReport",value:function(){var e=this.ScreenObject.CustomTab.Pages.find((function(e){return"Documents"==e.Name}));if(null!=e&&null!=this.ds){var t=this.ds.Tables[0].filter((function(e){return"LinkDimension"==e.Name&&89==e.CostCenterID}));if(t.length>0&&!n.e.IsEmpty(t[0].Value)&&this.ds.Tables[2].length>0){var s=0,i=0,a=parseInt(t[0].Value)-5e4;0==(s=n.e.Int(this.ds.Tables[1][0].CCOpportunityID))&&(s=-123);var o="(DCC.dcCCNID"+a+"="+s;(t=this.ds.Tables[0].filter((function(e){return"LinkDimension"==e.Name&&89==e.CostCenterID}))).length>0&&!n.e.IsEmpty(t[0].Value)&&((i=n.e.Int(this.ds.Tables[1][0].CCLeadID))>0&&(o+=" OR DCC.dcCCNID"+(parseInt(t[0].Value)-5e4)+"="+i)),o+=")";var l="";if((t=this.ds.Tables[0].filter((function(e){return"CreateDocuments"==e.Name&&89==e.CostCenterID}))).length>0&&!n.e.IsEmpty(t[0].Value)&&(l=t[0].Value.toString().Replace(";",",")),i>0&&((t=this.ds.Tables[0].filter((function(e){return"CreateDocuments"==e.Name&&89==e.CostCenterID}))).length>0&&!n.e.IsEmpty(t[0].Value)&&(l.length>0&&(l+=","),l+=t[0].Value.toString().Replace(";",","))),l.length>0){var r="<XML><Row ColID='300' Value='"+l+"'/>";r+="<Row ColID='CRM_Masters_DocumentsTab' Value='"+o+"'/>",r+="</XML>",null==this.Report?(e.Fields.Clear(),e.Fields.push(this.Report)):(this.Report.LoadDocFilterXML(r),this.Report.OnReportClick(this.Report.ReportID,0))}}}}},{key:"OnSave",value:function(e){if("Close"==e&&i.a.page.ShowDialog(new re(this),de.a,{ShowCenter:!0}),"EstimateRevenue"==e&&""!=this.EstimatedRevenue.Text&&(this.EstimatedRevenue.Enable=!0),"Save"==e||"SaveDraft"==e){Logger.InfoLog("SaveOpportunityViewModel:: OnSave");try{this.Opp.OpportunityID=this.OppID;var t=this.ScreenObject.ValidateData();if(!n.e.IsEmpty(t))return this.DisplayMessage=t,void(this.MessageVisibility=!0);if(0==this.Opp.OpportunityID){var s={StrCode:this.Opp.Code,CodePrefix:this.Opp.CodePrefix,CodeNumber:this.Opp.CodeNumber};if(this.DisplayMessage=this.ScreenObject.SetAutoCodeParams_3(this.Code,this.ParentId,this.ScreenObject.Data.Tables[7],s),this.Opp.Code=s.StrCode,this.Opp.CodePrefix=s.CodePrefix,this.Opp.CodeNumber=s.CodeNumber,this.DisplayMessage.length>0)return}else this.Opp.Code=this.Code.Text;if(this.Opp.Subject=this.Subject.Text,n.e.IsEmpty(this.Mode.SelectedValue)&&(this.Mode.SelectedValue="0"),this.Opp.Mode=parseInt(n.e.String(this.Mode.SelectedValue)),this.Company.Visible?"0"==this.Mode.SelectedValue||"4"==this.Mode.SelectedValue?this.Opp.Company=null!=this.Company.Text?this.Company.Text:"":(this.Opp.Company=null!=this.Company.Code.Text?this.Company.Code.Text:"",this.Opp.SelectedModeID=this.Company.Code.SelectedValue):this.Company.Enable&&this.Company.Visible||(this.Opp.Company=this.Code.Text),this.Opp.GUID=this.OppID>0?this.ds.Tables[1][0].GUID.toString():"GUID",this.Opp.Status=""!=this.Status.SelectedValue?parseInt(this.Status.SelectedValue):0,this.Opp.Date=this.Date.Date,this.Opp.Leadid=0!=this.Lead.SelectedValue?this.Lead.SelectedValue:0,this.Opp.Contactid=""!=this.ContactCombo.SelectedValue?parseInt(this.ContactCombo.SelectedValue):0,this.Opp.Campaignid=""!=this.Campaign.SelectedValue?parseInt(this.Campaign.SelectedValue):0,this.Opp.EstimateRevenue=this.EstimatedRevenue.Text,this.Opp.Currency=0!=this.Currency.SelectedValue?this.Currency.SelectedValue:0,this.Opp.EstimateCloseDate=this.EstimatedCloseDate.Date?this.EstimatedCloseDate.Date:null,this.Opp.Probabilityid=0!=this.Probability.SelectedValue?this.Probability.SelectedValue:0,this.Opp.Ratingid=0!=this.Rating.SelectedValue?this.Rating.SelectedValue:0,""!=this.CloseDate.Text&&null!=this.CloseDate.Tag?this.Opp.CloseDate=new Date(this.CloseDate.Tag):""!=this.CloseDate.Text&&(this.Opp.CloseDate=new Date(this.CloseDate.Text)),this.Opp.Details=this.details(),this.Opp.OppProXML=this.LeadsProduct.GetProductXML(),this.Opp.ActivityXml=this.ViewActivities.ActivitiesXML(),this.Opp.Reason=this.Reason,this.Opp.CustomFieldsQuery=this.ScreenObject.GetCustomFieldsQuery(),this.Opp.CustomCostCenterFieldsQuery=this.ScreenObject.GetCustomCostCenterFieldsQuery(),this.Opp.NotesXML=this.ViewNotes.GetXML(),this.Opp.AttachmetsXML=this.ViewAttachments.GetXML(),this.Opp.FeedbackXML=this.ViewFeedback.GetXML(),this.Opp.TabXML=this.getFields(),this.Opp.ContactXML=this.ViewContacts.GetXML(),null!=this.PrimaryContact&&this.PrimaryContact.CheckPrimaryDuplicateContact())return this.DisplayMessage="Duplicate Contact[s] in Contacts DB",void(this.MessageVisibility=!0);if(this.Opp.PrimaryContactXML=this.PrimaryContact.GetXML(),!this.ScreenObject.ValidateDataonSave())return;var a=this.Opp.SaveOpportunity();this.DisplayMessage=a.Message,this.Ret=a.RetValue,this.Ret>0&&(this.OppID=this.Ret,"SaveDraft"==e?(this.ds=this.Opp.GetOpportunity(this.OppID),this.OppID>0&&null!=this.ds&&this.ds.Tables[1].length>0&&(n.e.IsEmpty(this.ds.Tables[1][0].GUID)||(this.Opp.GUID=this.ds.Tables[1][0].GUID.toString()))):(this.LeadsProduct.ClearGrid(),this.Opp.OpportunityID>0?(this.ButtonSave.Enable=!1,this.Code.Text=""):this.OppID=0,this.ClearFields(),this.AutoGenerateCode(),this.LeadsProduct.ProductGridObj.Clear(),this.ViewFeedback.FeedBackDataObj.Clear(),this.ViewNotes.NotesListObj.Clear(),this.ViewContacts.ContactsListObj.Clear(),this.ViewAttachments.AttachmentsListObj.Clear(),this.ViewAssignHistroy.ListObj.Clear(),this.ViewFeedback.FeedBackDataObj.Clear())),Logger.InfoLog("SaveOpportunityViewModel:: OnSave")}catch(t){Logger.ErrorLog("SaveOpportunityViewModel:: OnSave"+t.stack)}}else"Email"==e&&this.OppID>0&&i.a.page.ShowDialog(new Y.SendEmailSMSViewModel(!0,this.CostCenterID,this.OppID,this),q.SendEmailSMSComponent)}},{key:"getFields",value:function(){var e=this;Logger.InfoLog("AddEditLeads::Entering getFields");try{var t,s="";return s+="<Row ",this.ScreenObject.CustomTab.Pages.forEach((function(i){i.Fields.forEach((function(i){i instanceof O.c&&null!=i.DBColumnName&&(i instanceof h.d?(t=i.Text,n.e.IsEmpty(t)&&(t=""),s+=i.DBColumnName+'="'+se.GetValidXml(t)+'" '):i instanceof u.e?(t=i.SelectedValue,n.e.IsEmpty(t)&&(t=""),"Gender"==i.DBColumnName?null!=i.SelectedItem&&(s+=i.DBColumnName+'="'+se.GetValidXml(i.SelectedItem.Name)+'" '):"Country"==i.DBColumnName?null!=i.SelectedValue&&""!=i.SelectedValue&&(s+=i.DBColumnName+'="'+i.SelectedValue+'" '):s+=i.DBColumnName+'="'+se.GetValidXml(t)+'" '):i instanceof C.a?(t=n.e.IsEmpty(i.Date)?"":i.Date.ToString("dd/MMM/yyyy"),n.e.IsEmpty(t)&&(t=""),s+=i.DBColumnName+'="'+t+'" '):i instanceof N.a?(t=i.Text,n.e.IsEmpty(t)&&(t=""),s+=i.DBColumnName+'="'+t+'" '):i instanceof c.b&&(e.oPactCombo=i,s+=e.oPactCombo.DBColumnName+'="'+e.oPactCombo.SelectedValue+'" '))}))})),s+=" />",Logger.InfoLog("AddEditLeads::Exiting getFields"),s.toString()}catch(i){throw i}}}]),s}(r.b),ce=s("/7g1"),ue=s("ZwlZ"),Ce=s("LCKI"),me=s("W4+j"),be=s("MMwJ"),pe=s("Qq+n"),Se=s("5DrK"),De=s("il++"),ge=s("Hzm0"),Te=function(e){_inherits(s,e);var t=_createSuper(s);function s(e,a,o,n,r){var m;_classCallCheck(this,s),(m=t.call(this)).lstatusid="",m.AllowCreationofCase=!1,m.ActMandatory=!1,m.ScreenObject=new d.a,m.Casesmodel=new Se.a,m.CaseID=0,m.parentid=1,m.selectedNode=1,m.group=!1,m.GroupVisible=!1,m.QuickVisible=!0,m.DetailButtonVisibility=!0,m.RetValue=0,m.CName=new h.a(0),m.CaseDate=new C.a(0),m.Status=new u.e(0),m.Customer=new c.b(0),m.Group=new c.b(0),m.dsinfo=null,m.CostCenterID=0,m.NodeID=0,m.ActVisibility=!1,m.CaseID=a;var b=m.Casesmodel.GetCaseScreenDetails(m.CaseID);m.parent=e,m.parentid=o,m.selectedNode=r,m.CostCenterID=73,m.group=n,m.ScreenObject.LoadQuickScreen(_assertThisInitialized(m),73,m.group),n?(m.GroupVisible=!0,m.QuickVisible=!1,m.CName.Label=i.a.GetResource("CRMCases_CaseNumber"),m.CaseDate.Label=i.a.GetResource("CRMCases_CaseDate"),m.Status.Label=i.a.GetResource("CRMCases_Status"),m.Group.Label=i.a.GetResource("CRMCases_Group"),m.Customer.Label=i.a.GetResource("CRMCases_Customer")):(m.QuickVisible=!0,m.GroupVisible=!1,m.CaseDate=m.ScreenObject.GetQuickField(24233),null==m.CaseDate&&(m.CaseDate=new C.a(24233),m.CaseDate.Visible=!1,m.CaseDate.Date=Date.Today()),m.CName=m.ScreenObject.GetQuickCode(24234),m.Status=m.ScreenObject.GetQuickCombo(24235),null==m.Status&&(m.Status=new u.e(24235),m.Status.Visible=!1),m.Customer=m.ScreenObject.GetQuickField(24238),null==m.Customer&&(m.Customer=new c.b(24238),m.Customer.Visible=!1),m.Group=m.ScreenObject.GetQuickField(24398),null==m.Group&&(m.Group=new c.b(24398)),m.FillComboBoxItems(b)),null!=m.Group?(m.Group.Visible=!0,m.Group.CCID=73,m.Group.TypeID=2):(m.Group=new c.b(0),m.Group.SelectedValue=o),null!=m.Customer&&(m.Customer.CCID=83,m.Customer.TypeID=1),m.dsinfo=m.ScreenObject.Data,m.ScreenObject.Data=m.dsinfo,m.ScreenObject.CostCenterID=73,n?m.ActVisibility=!1:(s.SetActivityUI(_assertThisInitialized(m),m.ScreenObject.dtActivityQuick),null!=m.Activities&&m.Activities.AssignRowColumns()),0==m.group?m.Title=i.a.GetResource(0==m.CaseID?"CRMCase_AddCase":"CRMCase_EditCase"):(m.Title=i.a.GetResource("CRMLead_AddGroup"),m.DetailButtonVisibility=!1,m.Casesmodel.GUID="GUID"),m.Casesmodel.CaseID=m.CaseID,null!=m.ScreenObject.Data&&m.ScreenObject.Data.Tables.length>7&&m.ScreenObject.Data.Columns[7].Contains("IsParentCodeInherited")&&m.ScreenObject.Data.Tables[7].length>0&&m.ScreenObject.InitAutoCode(m.ScreenObject.Data.Tables[7],m.group);var p=m.ScreenObject.Data.Tables[4].filter((function(e){return"AllowCreationofCase"==e.Name}));return p.length>0&&""!=p[0].Value.toString()&&(m.AllowCreationofCase=Object(l.j)(p[0].Value)),m.AllowCreationofCase&&((p=m.ScreenObject.Data.Tables[4].filter((function(e){return"StatusDuplicateCreationofCases"==e.Name}))).length>0&&""!=p[0].Value.toString()&&(m.lstatusid=p[0].Value.toString())),(p=m.ScreenObject.Data.Tables[4].filter((function(e){return"Activitymandatorywhilecreatingcase"==e.Name}))).length>0&&""!=p[0].Value.toString()&&(m.ActMandatory=Object(l.j)(p[0].Value)),null!=m.Status&&m.dsinfo.Tables[5].forEach((function(e){m.Status.Items.push(u.d.ComboBoxItems_2(e.Name.toString(),e.NodeID.toString())),Object(l.j)(e.IsDefault)&&(m.Status.SelectedValue=e.NodeID.toString(),m.Status.DefaultValue=e.NodeID.toString())})),null!=m.Group&&m.Group.SelectionChangedCommand.Subscribe(_assertThisInitialized(m),"OnGroupSelectionChanged"),0==m.CaseID?(m.Group.SelectedValue=o,m.AutoGenerateCode(),m.Casesmodel.GUID="GUID",i.a.SessionManager.Preferences.ContainsKey("Date Format")&&(m.CaseDate.Text=(new Date).ToString(i.a.SessionManager.Preferences["Date Format"].toString()))):(b.Tables.length>4&&b.Tables[4].length>0&&((m.ScreenObject.InheritParentCode||m.ScreenObject.IsAutoCode)&&(m.CName.Enable=!1),m.Casesmodel.GUID=b.Tables[4][0].GUID.toString(),m.CaseDate.Date=new Date(b.Tables[4][0].CDAte.toString()),m.CName.Text=b.Tables[4][0].CaseNumber.toString(),m.Status.SelectedValue=b.Tables[4][0].StatusID.toString(),m.Group.SelectedValue=parseInt(b.Tables[4][0].ParentID),m.Customer.SelectedValue=parseInt(b.Tables[4][0].CustomerID)),m.ActVisibility&&!m.group&&b.Tables.length>7&&(m.ViewActivities.LoadActivityData(b.Tables[7]),m.ViewActivities.ActivityGridData.length>0?(m.ViewActivities.SelectedRow=m.ViewActivities.ActivityGridData[m.ViewActivities.ActivityGridData.length-1],m.ViewActivities.OnCmnItem_Click("EDIT","EDIT")):m.ActVisibility=!1)),m.MessageVisibility=!1,m}return _createClass(s,[{key:"FillComboBoxItems",value:function(e){this.cType=this.ScreenObject.GetQuickCombo(24397),null!=this.cType&&u.e.FillComboWithDefaultOption(e.Tables[7],this.ScreenObject.GetQuickCombo(24397)),this.origin=this.ScreenObject.GetQuickCombo(24237),null!=origin&&u.e.FillComboWithDefaultOption(e.Tables[6],this.ScreenObject.GetQuickCombo(24237)),this.priority=this.ScreenObject.GetQuickCombo(24236),null!=this.priority&&u.e.FillComboWithDefaultOption(e.Tables[5],this.ScreenObject.GetQuickCombo(24236)),this.cmode=this.ScreenObject.GetQuickCombo(53516),null!=this.cmode&&(this.cmode.Items.Clear(),this.cmode.Items.push(u.d.ComboBoxItems_2("Manual","Manual")),this.cmode.Items.push(u.d.ComboBoxItems_2("PM","PM")),this.cmode.SelectedValue="Manual")}},{key:"OnGroupSelectionChanged",value:function(e){this.Group.SelectedValue>0&&(this.parentid=this.Group.SelectedValue,this.AutoGenerateCode())}},{key:"AutoGenerateCode",value:function(){this.ScreenObject.SetAutoCode(this.CName,this.group,this.parentid,this.dsinfo.Tables[7])}},{key:"OnSave",value:function(e){if("Cancel"==e)i.a.page.HideDialog();else if("Save"==e)try{var t=0;if(!this.group&&(0==this.Customer.SelectedValue||null==this.Customer.SelectedValue))return this.DisplayMessage="Select "+this.Customer.Label,void(this.MessageVisibility=!0);if(0==this.Casesmodel.CaseID){if(0==this.Casesmodel.CaseID&&this.AllowCreationofCase){var s=0,a=0,o="";2==this.Customer.CCID?a=1:83==this.Customer.CCID&&(a=2);var l=i.a.common.GetDataSet3("CRM002",this.lstatusid.toString().Replace(";",","),a.toString(),this.Customer.SelectedValue.toString());if(null!=l&&l.Tables.length>0&&l.Tables[0].length>0&&""!=l.Tables[0][0][0].toString()&&(s=parseInt(l.Tables[0][0][1].toString()),o=l.Tables[0][0][0].toString(),s>0&&!confirm("Case already opened with Customer and Case Number is "+o+", Are you sure you want to continue?")))return}if(0==this.Casesmodel.CaseID&&this.ActMandatory)return void alert("Activity is mandatory");var r={StrCode:this.Casesmodel.CaseNumber,CodePrefix:this.Casesmodel.CodePrefix,CodeNumber:this.Casesmodel.CodeNumber};if(this.DisplayMessage=this.ScreenObject.SetAutoCodeParams_3(this.CName,this.parentid,this.ScreenObject.Data.Tables[7],r),this.Casesmodel.CaseNumber=r.StrCode,this.Casesmodel.CodePrefix=r.CodePrefix,this.Casesmodel.CodeNumber=r.CodeNumber,this.DisplayMessage.length>0)return}else this.Casesmodel.CaseNumber=this.CName.Text;if(this.group){if(null==this.CaseDate.Date)return this.MessageVisibility=!0,void(this.DisplayMessage="Please Enter Case Date");this.Casesmodel.CaseDate=this.CaseDate.Date,this.Casesmodel.StatusID=parseInt(this.Status.SelectedValue),this.Casesmodel.IsGroup=this.group,this.Casesmodel.Customer=this.Customer.SelectedValue,2==this.Customer.CCID?this.Casesmodel.CustomerMode=1:83==this.Customer.CCID&&(this.Casesmodel.CustomerMode=2),this.Casesmodel.SelectedNodeID=this.Group.SelectedValue}else{if(null==this.CaseDate.Date)return this.MessageVisibility=!0,void(this.DisplayMessage="Please Enter Case Date");this.Casesmodel.CaseDate=this.ScreenObject.GetDatePickerValue(24233,Date.Today()),""==this.Status.DefaultValue&&(this.Status.DefaultValue="0"),""==this.Customer.DefaultValue&&(this.Customer.DefaultValue="0"),""==this.Group.DefaultValue&&(this.Group.DefaultValue=this.selectedNode.toString()),this.Casesmodel.StatusID=this.ScreenObject.GetTextComboValue_int(24235,parseInt(this.Status.DefaultValue)),this.Casesmodel.IsGroup=this.group,this.Casesmodel.Customer=this.ScreenObject.GetPactListValue(24238,parseInt(this.Customer.DefaultValue)),2==this.Customer.CCID?this.Casesmodel.CustomerMode=1:83==this.Customer.CCID&&(this.Casesmodel.CustomerMode=2),this.Casesmodel.SelectedNodeID=null==this.ScreenObject.GetQuickField(24398)?this.selectedNode:this.ScreenObject.GetPactListValue(24398,parseInt(this.Group.DefaultValue))}if(this.ActVisibility){if(this.Activities.onSaveActivity("Save"),!n.e.IsEmpty(this.Activities.DisplayMessage))return void(this.DisplayMessage=this.Activities.DisplayMessage);this.Casesmodel.ActivityXml=this.ViewActivities.ActivitiesXML()}else this.Casesmodel.ActivityXml="";if(this.Casesmodel.Subject=this.ScreenObject.GetTextComboValue_string(27293,""),null!=this.cType&&(this.Casesmodel.CaseTypeID=this.ScreenObject.GetTextComboValue_int(24397,0)),null!=origin&&(this.Casesmodel.CaseOriginID=this.ScreenObject.GetTextComboValue_int(24237,0)),null!=this.priority&&(this.Casesmodel.CasePriorityID=this.ScreenObject.GetTextComboValue_int(24236,0)),null!=this.cmode&&(this.Casesmodel.Mode=this.ScreenObject.GetTextComboValue_string(53516,"")),!this.ScreenObject.ValidateDataonSave())return;if(0==this.Casesmodel.CaseID){var d=this.Casesmodel.SaveCase(0,0);t=d.RetValue,this.DisplayMessage=d.Message}else{var h=this.Casesmodel.QuickUpdateCase();t=h.RetValue,this.DisplayMessage=h.RetValue}this.RetValue=t,t>0&&(this.CName.Text="",this.Casesmodel.CaseID=0,i.a.SessionManager.Preferences.ContainsKey("Date Format")&&(this.CaseDate.Text=(new Date).ToString(i.a.SessionManager.Preferences["Date Format"].toString())),this.Status.SelectedValue="1",null!=this.parent&&(null!=this.parent.SelectedNode&&(this.parent.tree[0].SetFocusNodeID=this.parent.SelectedNode.Id),this.parent.Refresh()),this.AutoGenerateCode(),this.Group.SelectedValue=this.selectedNode)}catch(u){Logger.ErrorLog("SaveCaseViewModel:: OnSave",u)}else if("Details"==e.toString()){null!=this.Group&&(this.parentid=this.Group.SelectedValue);var c=new ge.AddEditCasesViewModel(this.CaseID,this.parentid,this.group);c.isClose||i.a.page.addNewTab({component:De.AddEditCaseComponent,params:{obj:c}}),i.a.page.HideDialog()}}}],[{key:"SetActivityUI",value:function(e,t){if(t.length>0){e.ActVisibility=!0,e.Activities=new T.a(e,!1),e.Activities.IsPopup=!1,e.Activities.LoadCustomFields(73),e.Activities.AssignVisiblity=!1,e.Activities.HeaderVisible=!1,e.Activities.ButtonsVisible=!1,e.ViewActivities=new g.b(e),e.ViewActivities.Activities=e.Activities;var s=t.filter((function(e){return"ActivityTypeName"==e.SysColumnName}));e.Activities.ActivityType.Visible=s.length>0,s=t.filter((function(e){return"StatusID"==e.SysColumnName})),e.Activities.StatusVisible=s.length>0,s=t.filter((function(e){return"Subject"==e.SysColumnName})),e.Activities.Subject.Visible=s.length>0,s=t.filter((function(e){return"CRMCustomer"==e.SysColumnName})),e.Activities.CRMCustomer.Visible=s.length>0,s=t.filter((function(e){return"CRMContactPerson"==e.SysColumnName})),e.Activities.CRMContactPerson.Visible=s.length>0,s=t.filter((function(e){return"AssignUserID"==e.SysColumnName})),e.Activities.AssignUserList.Visible=s.length>0,s=t.filter((function(e){return"Remarks"==e.SysColumnName})),e.Activities.Remarks.Visible=s.length>0,e.Activities.Fields.forEach((function(e){s=t.filter((function(t){return t.SysColumnName==e.SysColumnName})),e.Visible=s.length>0}))}else e.ActVisibility=!1}}]),s}(r.b),Ie=s("k8LF"),ye=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"AddPage",value:function(e,t,s,o,n,l){var r=e.obj;if(83==r.CostCenterID)if(i.a.page.ShowLoading=!0,r.IsQuickNodeDefined&&!t){var d=new S(o,r.SelectedNode.id,n,s?r.SelectedNode.IsGroup:l,e);i.a.page.ShowDialog(d,a.a)}else{var h=new b.a(o,r.SelectedNode.id,n,!1);i.a.page.addNewTab({component:p.AddCustomerComponent,params:{obj:h}})}else if(86==r.CostCenterID)if(i.a.page.ShowLoading=!0,r.IsQuickNodeDefined&&!t){var c=new ae(e,o,n,s?r.SelectedNode.IsGroup:l,r.SelectedNode.id);i.a.page.ShowDialog(c,oe.a)}else{var u=new se(o,r.SelectedNode.id,!1);i.a.page.addNewTab({component:ie.AddEditLeadComponent,params:{obj:u}})}else if(88==r.CostCenterID){i.a.page.ShowLoading=!0;var C=new be.a(o,r.SelectedNode.id);i.a.page.addNewTab({component:pe.AddEditCampaignComponent,params:{obj:C}})}else if(89==r.CostCenterID){i.a.page.ShowLoading=!0;var m=new he(o,r.SelectedNode.id,!1);i.a.page.addNewTab({component:ce.AddEditOpportunityComponent,params:{obj:m}})}else if(73==r.CostCenterID)if(i.a.page.ShowLoading=!0,r.IsQuickNodeDefined&&!t){var D=new Te(e,o,n,s?r.SelectedNode.IsGroup:l,r.SelectedNode.id);i.a.page.ShowDialog(D,Ie.a)}else{var g=new ge.AddEditCasesViewModel(o,r.SelectedNode.id,!1);i.a.page.addNewTab({component:De.AddEditCaseComponent,params:{obj:g}})}else if(65==r.CostCenterID){i.a.page.ShowLoading=!0;var T=new X.AddDContactViewModel(o,!1,r.SelectedNode.id);i.a.page.addNewTab({component:ue.a,params:{obj:T}})}}},{key:"Convert",value:function(e){if(e.SelectedNode.IsGroup)alert("Group cannot be converted ");else if(null!=e.SelectedNode)if(83==e.CostCenterID){var t=new b.a(83,e.SelectedNode.id,1,!1);t.CustomerID=e.SelectedNode.id;var s=new Ce.a;s.ConvertCustomer_1(t),i.a.page.ShowDialog(s,me.a,{ShowCenter:!0})}else if(86==e.CostCenterID){var a=(new I.a).GetLead(e.SelectedNode.id),o=null;if((o=a.Tables[2].filter((function(e){return"ConvertApprovedLeads"==e.Name}))).length>0)if(n.e.IsEmpty(o[0].Value)||"0"==o[0].Value.toString()){var r=new W(e.SelectedNode.id,a,e.CostCenterID);i.a.page.ShowDialog(r,z.a,{ShowCenter:!0})}else if(Object(l.j)(o[0].Value)){if(null!=a&&a.Tables.length>1&&a.Tables[0].length>0&&a.Columns[0].Contains("IsApproved")&&(n.e.IsEmpty(a.Tables[0][0].IsApproved)||!Object(l.j)(a.Tables[0][0].IsApproved)))return void alert("Lead should be in approved status! ");var d=new W(e.SelectedNode.id,a,e.CostCenterID);i.a.page.ShowDialog(d,z.a,{ShowCenter:!0})}else{var h=new W(e.SelectedNode.id,a,e.CostCenterID);i.a.page.ShowDialog(h,z.a,{ShowCenter:!0})}}else if(89==e.CostCenterID){var c=new W(e.SelectedNode.id,null,e.CostCenterID);i.a.page.ShowDialog(c,z.a,{ShowCenter:!0})}}},{key:"Close",value:function(e,t){if(t.SelectedNode.IsGroup)alert("Group cannot be converted ");else if(null!=t.SelectedNode&&86==t.CostCenterID){var s=i.a.common.GetDataSet("CRM001",t.SelectedNode.id.toString());if(null!=s&&s.Tables.length>0&&s.Tables[0].length>0&&"419"==s.Tables[0][0].StatusID.toString()){var a=new x.a(t.SelectedNode.id,e,86);i.a.page.ShowDialog(a,H.CloseLeadComponent,{ShowCenter:!0,NoWidth:!0})}else t.DisplayMessage="Select Assigned lead"}}},{key:"Assign",value:function(e,t){if(null!=t.SelectedNode){if(1==t.SelectedNode.id)return;var s=new Array;null!=t.SelectedNodes&&t.SelectedNodes.forEach((function(e){s.push(u.c.CheckedListBoxItem_6(e.Text[0],e.Id.toString(),!0,e.TypeID))}));var a=new Z.AssignFeatureViewModel;s.length>0?a.AssignFeatureViewModel_2(this,s,t.CostCenterID):a.AssignFeatureViewModel_1(this,t.SelectedNode.id,t.CostCenterID),i.a.page.ShowDialog(a,$.AssignFeatureComponent)}}},{key:"ShowQuickAdd_CRMIsQuick",value:function(e,t){if(83==e){var s=new S(t,0,1,!1,null);return s.Height=400,i.a.page.ShowDialog(s,a.a),s.CustomerID}return 0}},{key:"ShowQuickAdd_CRM",value:function(e,t){if(83==e){var s;s=0==t?new b.a(0,0,1,!1):new b.a(83,t,1,!1),i.a.page.ShowDialog(s,p.AddCustomerComponent,{ShowCenter:!0})}}},{key:"GetCRMActivityScreen",value:function(e){var t=null;return 86==e.FeatureID?t=new se(e.DBColumnID,0,!1):89==e.FeatureID?t=new he(e.DBColumnID,0,!1):73==e.FeatureID?t=new ge.AddEditCasesViewModel(e.DBColumnID,0,!1):88==e.FeatureID?t=new be.a(e.DBColumnID,0):83==e.FeatureID&&(t=new b.a(e.DBColumnID,e.DBColumnID,0,!1)),t}}]),e}()},ouML:function(e,t,s){"use strict";s.r(t),s.d(t,"DocumentDraftsViewModel",(function(){return c}));var i=s("mrSG"),a=s("Do2H"),o=s("Lp6j"),n=s("ScVY"),l=s("8B8H"),r=s("ockk"),d=s("rJVx"),h=s("CUWK"),c=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,s){var i,o,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(_classCallCheck(this,n),(i=t.call(this)).Grid=new l.a,i.IsFromDocs=!1,i.PopupWidth=0,i.ReportType=0,i.Parent=null,i.CCID=0,i.WID=0,i.LevelID=0,i.PactGridVisible=!1,i.CCID=h,i.Parent=e,i.ReportType=s,i.Parent instanceof d.GeneralDashboardViewModel||"DashAddOnsViewModel"==i.Parent.ClassName)?1==s&&(i.ColSource=d.GeneralDashboardViewModel.InitColumns("Document Drafts_DashBoardCustomize")):(1==s?i.DisplayName="Drafts":2==s?i.DisplayName="Hold Documents":3==s?i.DisplayName="Approval History":4==s&&(i.DisplayName="Level Info",i.PactGrid=new l.a),i.Title=i.DisplayName,i.IsFromDocs=!0,i.FillGrid(),i.Grid.OnLinkClick.Subscribe(_assertThisInitialized(i),"GridLinkClick"),i.ColSource=[],1==s?(i.ColSource=d.GeneralDashboardViewModel.InitColumns("Document Drafts_DashBoardCustomize"),i.PopupWidth=22,i.ColSource.forEach((function(e){i.PopupWidth=i.PopupWidth+e.Width}))):2==s?((o=new r.a).DataType="TextBlock",o.Header="Hold Date",o.DisplayMember="HoldDate_Key",o.Width=100,i.ColSource.push(o),(o=new r.a).DataType="LINK",o.Header=a.a.GetResource("DocName"),o.DisplayMember="DocName",o.Width=135,i.ColSource.push(o),(o=new r.a).DataType="TextBlock",o.Header="NetValue",o.DisplayMember="NetValue",o.Width=100,i.ColSource.push(o),(o=new r.a).DataType="TextBlock",o.Header="NoOfProducts",o.DisplayMember="NoOfProducts",o.Width=50,i.ColSource.push(o),(o=new r.a).DataType="LINK",o.Header=a.a.GetResource("Delete"),o.DisplayMember="Delete",o.Width=100,i.ColSource.push(o),i.PopupWidth=450):3==s?((o=new r.a).DataType="TextBlock",o.Header="User",o.DisplayMember="CreatedBy",o.Width=90,i.ColSource.push(o),(o=new r.a).DataType="TextBlock",o.Header="FirstName",o.DisplayMember="FirstName",o.Width=90,i.ColSource.push(o),(o=new r.a).DataType="TextBlock",o.Header="LastName",o.DisplayMember="LastName",o.Width=90,i.ColSource.push(o),(o=new r.a).DataType="TextBlock",o.Header="Email",o.DisplayMember="Email1",o.Width=150,i.ColSource.push(o),(o=new r.a).DataType="TextBlock",o.Header=a.a.GetResource("Date"),o.DisplayMember="AppDate",o.Width=128,i.ColSource.push(o),(o=new r.a).DataType="LINK",o.Header="Level",o.DisplayMember="LevelName",o.Width=93,i.ColSource.push(o),(o=new r.a).DataType="TextBlock",o.Header="Status",o.DisplayMember="Status",o.Width=80,i.ColSource.push(o),(o=new r.a).DataType="Format",o.Header="Remarks",o.DisplayMember="Remarks",o.Width=190,i.ColSource.push(o),i.PopupWidth=950,"AddEditDocumentViewModel"==i.Parent.ClassName&&((o=new r.a).Header="WorkFlowName",o.DisplayMember="WorkFlowName",o.Width=200,i.ColSource.push(o)),i.PopupWidth=950):4==s&&((o=new r.a).DataType="TextBlock",o.ReadOnly=!0,o.Header="User Name",o.DisplayMember="UserName",o.Width=120,i.ColSource.push(o),(o=new r.a).DataType="TextBlock",o.ReadOnly=!0,o.Header="First Name",o.DisplayMember="FirstName",o.Width=120,i.ColSource.push(o),(o=new r.a).DataType="TextBlock",o.ReadOnly=!0,o.Header="Last Name",o.DisplayMember="LastName",o.Width=120,i.ColSource.push(o),i.PactGrid.Columns=i.ColSource,i.PopupWidth=400));return _possibleConstructorReturn(i)}return _createClass(n,[{key:"onClick",value:function(e){event.preventDefault(),null!=this.SelectedRow&&this.LoadDraft(this.SelectedRow)}},{key:"FillGrid",value:function(){var e=this,t=0,s=null;if(o.e.IsType(this.Parent,"AddEditDocumentViewModel")?(s=this.Parent,t=0==this.CCID?s.CostCenterID:this.CCID):o.e.IsEmpty(this.Parent.ClassName)||"AddEditRenContractViewModel"!=this.Parent.ClassName||(t=this.CCID),1==this.ReportType||2==this.ReportType)(o.e.IsEmpty(this.Parent.ClassName)||"AddEditRenContractViewModel"!=this.Parent.ClassName?null==s||38!=s.ScreenObject.DocumentType&&39!=s.ScreenObject.DocumentType?a.a.document.GetDocumentDrafts(0,t,this.ReportType,!1):a.a.document.GetDocumentDrafts(s.ScreenObject.RegisterNodeID,t,this.ReportType,!1,!0):a.a.document.GetDocumentDrafts(0,this.Parent.CostCenterID,this.ReportType,!1)).subscribe((function(t){e.Table=t.Tables[0],e.Grid.TableColumns.Contains("Date_Text")||(e.Grid.TableColumns.push("Date_Text"),e.Grid.TableColumns.push("Delete")),e.Grid.TableColumns.Contains("HoldDate_Key")||e.Grid.TableColumns.push("HoldDate_Key"),e.Table.forEach((function(e){e.Delete="Delete",e.id=a.a.slick.rowid,e.Date_Text=new Date(e.Date).ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm a"),null!=e.HoldDate&&(e.HoldDate_Key=new Date(e.HoldDate).ToString(a.a.SessionManager.Preferences["Date Format"]))}))}));else if(3==this.ReportType){var i=null;if(o.e.IsType(this.Parent,"AddEditDocumentViewModel")?(i=this.Parent.ScreenObject.GetDocStatusHistory()).Tables.length>1&&i.Tables[1].length>0&&i.Columns[1].Contains("WID")&&(this.WID=parseInt(i.Tables[1][0].WID)):o.e.IsEmpty(this.Parent.ClassName)||"AddEditRenContractViewModel"!=this.Parent.ClassName?o.e.IsEmpty(this.Parent.ClassName)||"AddEditCasesViewModel"!=this.Parent.ClassName||(i=this.GetDocStatusHistory(73,this.Parent.CaseID,!1)):i=a.a.rental.GetHistory(t,this.Parent.ContractID),null!=i&&i.Tables.length>0){this.Table=i.Tables[0],this.Grid.TableColumns.push("AppDate");for(var l=0;l<this.Table.length;l++)""!=this.Table[l].Date.toString()&&(this.Table[l].AppDate=new Date(this.Table[l].Date.toString()).ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm a"));var r=0,d=0;this.Table.length>0&&(r=o.e.IntTryParse(this.Table[this.Table.length-1].WorkFlowLevel.toString()),d=o.e.IntTryParse(this.Table[this.Table.length-1].StatusID.toString())),369!=d&&(i.Tables[1]=i.Tables[1].filter((function(e){return e.levelID>r})),i.Tables[1].forEach((function(t){var s=e.Grid.NewRow();s.LevelName=t.LevelName,s.Status="Pending",s.WorkFlowLevel=t.LevelID,e.Grid.addRow(s)})));for(var h=this.Table.length;h<7;h++)this.Grid.addEmptyRow()}}else if(4==this.ReportType){var c=null;if("WFLevelDoc"==this.Parent.ClassName?c=a.a.SessionManager.Preferences.ContainsKey("CanApproveFunction")&&"True"==a.a.SessionManager.Preferences.CanApproveFunction?a.a.report.GetExtWFDet(this.Parent.WID,this.Parent.LevelID,this.Parent.ccid,this.Parent.DOcId):a.a.report.GetWorkFlowLevelDetails(this.Parent.WID,this.Parent.LevelID,this.Parent.ccDate):this.Parent instanceof n&&(a.a.SessionManager.Preferences.ContainsKey("CanApproveFunction")&&"True"==a.a.SessionManager.Preferences.CanApproveFunction?"AddEditDocumentViewModel"==this.Parent.Parent.ClassName?c=a.a.report.GetExtWFDet(this.Parent.WID,this.Parent.LevelID,this.Parent.Parent.CostCenterID,this.Parent.Parent.ScreenObject.DocID):"ReportViewModel"==this.Parent.Parent.ClassName&&"INV_ComparisonReport"==this.Parent.Parent.StaticReportObject&&(c=a.a.report.GetExtWFDet(this.Parent.WID,this.Parent.LevelID,this.Parent.Parent.StaticReportObject.QuotationDocument,this.Parent.Parent.StatusDocID)):c=a.a.report.GetWorkFlowLevelDetails(this.Parent.WID,this.Parent.LevelID,"AddEditDocumentViewModel"==this.Parent.Parent.ClassName?this.Parent.Parent.ScreenObject.DocDate.Date:Date.Today())),null!=c){for(var u=c.Tables[0].length;u<8;u++)c.Tables[0].push();this.PactGrid.Table=c.Tables[0]}this.PactGrid.Width="",this.PactGrid.SearchVisible=!0,this.PactGrid.SearchCols.Width="85",this.PactGrid.SearchOptions.Width="90",this.PactGrid.SearchText.Width="110",this.PactGridVisible=!0}}},{key:"GetDocStatusHistory",value:function(e,t,s){Logger.InfoLog("DocumentDraftsViewModel:: Inside GetDocStatusHistory");var i=[];i.push(e),i.push(t),i.push(s),i.push(a.a.SessionManager.UserID),i.push(a.a.SessionManager.LanguageID);var o=a.a.document.GetDocStatusHistory(i);return Logger.InfoLog("DocumentDraftsViewModel:: Exiting GetDocStatusHistory"),o}},{key:"OnButtonClick",value:function(e){"Cancel"==e.toString()&&(o.e.IsType(this.Parent,"AddEditDocumentViewModel")&&this.CCID>0&&(this.Parent.res="No"),a.a.page.HideDialog())}},{key:"DeleteDraft",value:function(e){(o.e.IsEmpty(this.Parent.ClassName)||"AddEditRenContractViewModel"!=this.Parent.ClassName?a.a.document.DeleteDocumentDraft(parseInt(e.DraftID)):a.a.rental.DeleteQuotation(parseInt(e.CostCenterID),parseInt(e.DraftID))).RetValue>0&&this.Grid.removeRow(e)}},{key:"LoadDraft",value:function(e){return Object(i.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var i,n,l,r,d,c=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!o.e.IsEmpty(this.Parent.ClassName)&&"AddEditRenContractViewModel"==this.Parent.ClassName){t.next=12;break}return t.next=3,Promise.all([s.e(2),s.e(1),s.e(3),s.e(5),s.e(4),s.e(6),s.e(7),s.e(10),s.e(9),s.e(12),s.e(11),s.e(13),s.e(19),s.e(15),s.e(21),s.e(20),s.e(16),s.e(14),s.e(18),s.e(17),s.e(22),s.e(89)]).then(s.bind(null,"1Cra"));case 3:return i=t.sent,n=i.AddEditDocumentViewModel,t.next=7,Promise.all([s.e(4),s.e(6)]).then(s.bind(null,"MCKn"));case 7:l=t.sent,r=l.AddEditDocumentComponent,a.a.document.GetDocumentDrafts(parseInt(e.DraftID),0,1,!1).subscribe((function(t){if(null!=(d=t.Tables[0])&&d.length>0)if("AddEditDocumentViewModel"==c.Parent.ClassName||"POSDocumentViewModel"==c.Parent.ClassName)c.CCID>0||(c.Parent.clear(1),c.Parent.LoadDraftXML(d[0]),a.a.page.HideDialog(),c.Parent.ScreenObject.GridDataObj.RefreshGridView());else{var s=1==c.ReportType,i=new n(parseInt(e.CostCenterID),e.Type.toString(),s);a.a.page.addNewTab({component:r,params:{obj:i}}),i.LoadDraftXML(d[0],s)}})),t.next=13;break;case 12:h.RibbonExtViewModel.LoadDraftRentalContract(this.Parent,parseInt(e.DraftID)),a.a.page.HideDialog();case 13:case"end":return t.stop()}}),t,this)})))}},{key:"GridLinkClick",value:function(e,t,s){event.preventDefault(),"Delete"==t?this.DeleteDraft(e):"Date_Text"!=t&&"DocName"!=t||this.LoadDraft(e)}},{key:"Table",get:function(){return this.Grid.Table},set:function(e){this.Grid.Table=e}},{key:"TableColumns",get:function(){return this.Grid.TableColumns},set:function(e){this.Grid.TableColumns=e}},{key:"ColSource",get:function(){return this.Grid.Columns},set:function(e){this.Grid.Columns=e}},{key:"SelectedRow",get:function(){return this.Grid.SelectedItem},set:function(e){this.Grid.SelectedItem=e}}]),n}(n.b)},rJVx:function(e,t,s){"use strict";s.r(t),s.d(t,"GeneralDashboardViewModel",(function(){return h}));var i=s("mrSG"),a=s("Do2H"),o=s("Lp6j"),n=s("ScVY"),l=s("NkMH"),r=s("ockk"),d=s("JIg3"),h=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this)).ButtonPDC=new l.a,e.timerdashboard=new o.d,e.Date=new d.a(0),e.tdMaximize=new Array(4).fill(!1),Logger.InfoLog("DashboardViewModel::Entering DashboardViewModel"),e.timerdashboard.Enabled=!0,e.timerdashboard.Interval=6e4,a.a.SessionManager.IsWebApplication||e.timerdashboard.Elapsed(_assertThisInitialized(e),"timerdashboard_Elapsed"),e.DisplayName=a.a.GetResource("Dashboard_Maindashboard"),e.loadDrafts(),Logger.InfoLog("DashboardViewModel::Exiting DashboardViewModel"),e}return _createClass(n,[{key:"loadDrafts",value:function(){return Object(i.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,i,a,o,n,l,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.e(150).then(s.bind(null,"ouML"));case 2:return t=e.sent,i=t.DocumentDraftsViewModel,this.DocumentDrafts=new i(this,1),setTimeout((function(){r.DocumentDrafts.FillGrid()}),500),e.next=7,s.e(0).then(s.bind(null,"AyOk"));case 7:return a=e.sent,o=a.UnAppDocumentsViewModel,this.UnApprovedDocuments=new o,e.next=12,Promise.all([s.e(2),s.e(1),s.e(5),s.e(26),s.e(42),s.e(0),s.e(73)]).then(s.bind(null,"Wh9R"));case 12:n=e.sent,l=n.DashBoardNotifViewModel,this.NotifEvents=new l(2),this.PDCDocuments=new l(4);case 15:case"end":return e.stop()}}),e,this)})))}},{key:"timerdashboard_Elapsed",value:function(e,t){a.a.page.isActiveTab(this)&&(this.OnButtonClick("RefreshPDC"),this.OnButtonClick("RefreshEvents"),this.NotifEvents.RefreshData(),this.UnApprovedDocuments.OnLoad())}},{key:"OnButtonClick",value:function(e){"PostPDC"==e||("RefreshPDC"==e?(this.PDCDocuments.EventsType=4,this.PDCDocuments.InitColumns()):"PostEvents"==e||("RefreshEvents"==e?this.NotifEvents.RefreshData():"UnApproved"==e?this.UnApprovedDocuments.OnLoad():"Drafts"==e&&this.DocumentDrafts.FillGrid()))}},{key:"OnMessageCallBack",value:function(){this.res="Yes"}}],[{key:"InitColumns",value:function(e){var t,s="",i=[];if(a.a.SessionManager.Preferences.ContainsKey(e)&&(s=a.a.SessionManager.Preferences[e]),s.length>0){var n=new o.f;n.LoadXml(s);for(var l=0;l<n.DocumentElement.children.length;l++){var d=n.DocumentElement.children[l];(t=new r.a).Header=a.a.GetResource(d.attributes.Header.value),t.DisplayMember=d.attributes.ID.value,t.ReadOnly=!0,t.Width=parseInt(d.attributes.Width.value),i.push(t),"Un Approved Documents_DashBoardCustomize"==e?"VoucherNo"==t.DisplayMember?t.DataType="LINK":"Amount"==t.DisplayMember&&(t.DataType="FLOAT",t.DecimalPoints=a.a.SessionManager.Preferences.DecimalsinAmount.toString()):"Document Drafts_DashBoardCustomize"==e?"Date_Text"!=t.DisplayMember&&"Delete"!=t.DisplayMember||(t.DataType="LINK"):"Post Dated Documents_DashBoardCustomize"==e?"VoucherNo"==t.DisplayMember?t.DataType="LINK":"Amount"==t.DisplayMember&&(t.DataType="FLOAT",t.DecimalPoints=a.a.SessionManager.Preferences.DecimalsinAmount.toString()):"Notification Events_DashBoardCustomize"==e&&"VoucherNo"==t.DisplayMember&&(t.DataType="LINK")}}return i}},{key:"IsActionAssigned",value:function(e,t){return a.a.SessionManager.IsActionAssigned(e,t)}}]),n}(n.b)}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[35,109],{"/aGy":function(e,t,s){"use strict";s.d(t,"a",(function(){return p}));var i=s("3Pt+"),a=s("fXoL"),o=s("sYmb");function n(e,t){if(1&e&&(a.Zb(0,"div",15),a.Wc(1,"\n                    "),a.Vb(2,16),a.Wc(3,"\n                "),a.Yb()),2&e){const e=a.lc();a.Db(2),a.tc("obj",e.obj.Mode)("group",e.form)}}function l(e,t){if(1&e&&(a.Zb(0,"div",15),a.Wc(1,"\n                    "),a.Vb(2,16),a.Wc(3,"\n                "),a.Yb()),2&e){const e=a.lc();a.Db(2),a.tc("obj",e.obj.Customer)("group",e.form)}}function r(e,t){if(1&e&&(a.Zb(0,"div",15),a.Wc(1,"\n                    "),a.Vb(2,16),a.Wc(3,"\n                "),a.Yb()),2&e){const e=a.lc();a.Db(2),a.tc("obj",e.obj.Contracts)("group",e.form)}}function d(e,t){if(1&e&&(a.Zb(0,"div",15),a.Wc(1,"\n                    "),a.Vb(2,16),a.Wc(3,"\n                "),a.Yb()),2&e){const e=a.lc();a.Db(2),a.tc("obj",e.obj.Product)("group",e.form)}}function h(e,t){if(1&e&&(a.Zb(0,"div",15),a.Wc(1,"\n                    "),a.Vb(2,16),a.Wc(3,"\n                "),a.Yb()),2&e){const e=a.lc();a.Db(2),a.tc("obj",e.obj.SerailNo)("group",e.form)}}function c(e,t){if(1&e&&(a.Zb(0,"div",15),a.Wc(1,"\n                    "),a.Vb(2,16),a.Wc(3,"\n                "),a.Yb()),2&e){const e=a.lc();a.Db(2),a.tc("obj",e.obj.BomCode)("group",e.form)}}function u(e,t){if(1&e&&(a.Zb(0,"div",15),a.Wc(1,"\n                    "),a.Vb(2,16),a.Wc(3,"\n                "),a.Yb()),2&e){const e=a.lc();a.Db(2),a.tc("obj",e.obj.BomName)("group",e.form)}}function C(e,t){if(1&e&&a.Vb(0,16),2&e){const e=a.lc(2).$implicit,t=a.lc();a.tc("obj",e.CC)("group",t.form)}}function m(e,t){if(1&e&&a.Vb(0,16),2&e){const e=a.lc(3).$implicit,t=a.lc();a.tc("obj",e.Condition)("group",t.form)}}function b(e,t){if(1&e&&a.Vb(0,16),2&e){const e=a.lc(3).$implicit,t=a.lc();a.tc("obj",e.FromValue)("group",t.form)}}function S(e,t){if(1&e&&(a.Zb(0,"div"),a.Wc(1,"\n                            "),a.Zb(2,"label",20),a.Wc(3),a.Yb(),a.Wc(4,"\n                            "),a.Zb(5,"div",2),a.Wc(6,"\n                                "),a.Zb(7,"div",21),a.Wc(8,"\n                                    "),a.Uc(9,m,1,2,"ng-container",18),a.Wc(10,"\n                                "),a.Yb(),a.Wc(11,"\n                                "),a.Zb(12,"div",22),a.Wc(13,"\n                                    "),a.Uc(14,b,1,2,"ng-container",18),a.Wc(15,"\n                                "),a.Yb(),a.Wc(16,"\n                            "),a.Yb(),a.Wc(17,"                           \n                        "),a.Yb()),2&e){const e=a.lc(2).$implicit;a.Db(3),a.Yc("",e.Header," "),a.Db(6),a.tc("ngIf",e.Condition.Visible),a.Db(5),a.tc("ngIf",e.FromValue.Visible)}}function D(e,t){if(1&e&&(a.Zb(0,"div",15),a.Wc(1,"\n                        "),a.Uc(2,C,1,2,"ng-container",18),a.Wc(3,"\n                        "),a.Uc(4,S,18,3,"div",19),a.Wc(5,"                          \n                    "),a.Yb()),2&e){const e=a.lc().$implicit;a.Db(2),a.tc("ngIf",e.CC.Visible),a.Db(2),a.tc("ngIf",!e.CC.Visible)}}function g(e,t){if(1&e&&(a.Xb(0),a.Wc(1,"\n                    "),a.Uc(2,D,6,2,"div",17),a.Wc(3,"\n                "),a.Wb()),2&e){const e=t.$implicit;a.Db(2),a.tc("ngIf",e.Visible)}}let p=(()=>{class e{constructor(e){this.translate=e,this.form=new i.j({})}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)(a.Tb(o.e))},e.\u0275cmp=a.Nb({type:e,selectors:[["app-case-search"]],decls:62,vars:22,consts:[[1,"master-screen",2,"padding-bottom","4px","width","1000px"],[1,"PACTHeaderFields","dialogSubBody"],[2,"display","flex"],[1,"row","form-row",2,"display","block","flex-direction","column","width","300px"],["class","form-group col-xl-12 col-md-12 col-sm-12 col-xs-12 PACTControl",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"btnMetroDiv","secondary-btn-group",2,"margin","auto","text-align","center"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-check"],[1,"fa-light","fa-times"],[2,"flex-direction","column","width","700px","margin-left","10px","padding-left","15px","border-left","solid 1px gray"],[1,"documentgrid","row","form-row",2,"width","100%"],[2,"width","100%",3,"obj","group"],[1,"Pactdailogfooter"],[1,"primary-btn-wicon",3,"click"],[1,"form-group","col-xl-12","col-md-12","col-sm-12","col-xs-12","PACTControl"],["FieldDirective","",3,"obj","group"],["class","form-group col-xl-12  col-md-12 col-sm-12 col-xs-12 PACTControl",4,"ngIf"],["FieldDirective","",3,"obj","group",4,"ngIf"],[4,"ngIf"],[1,"input_cntrl_label"],[2,"display","block","flex-direction","column","width","90px"],[2,"display","block","flex-direction","column"]],template:function(e,t){1&e&&(a.Zb(0,"div",0),a.Wc(1,"\n    "),a.Zb(2,"div",1),a.Wc(3,"\n        "),a.Zb(4,"div",2),a.Wc(5,"\n            "),a.Zb(6,"div",3),a.Wc(7,"\n                "),a.Uc(8,n,4,2,"div",4),a.Wc(9,"\n                "),a.Uc(10,l,4,2,"div",4),a.Wc(11,"\n                "),a.Uc(12,r,4,2,"div",4),a.Wc(13,"\n                "),a.Uc(14,d,4,2,"div",4),a.Wc(15,"\n                "),a.Uc(16,h,4,2,"div",4),a.Wc(17,"\n                "),a.Uc(18,c,4,2,"div",4),a.Wc(19,"\n                "),a.Uc(20,u,4,2,"div",4),a.Wc(21,"              \n                "),a.Uc(22,g,4,1,"ng-container",5),a.Wc(23,"\n                \n                "),a.Zb(24,"div",6),a.Wc(25,"\n                    "),a.Zb(26,"span",7),a.hc("click",(function(){return t.obj.onSave("Filter")})),a.Ub(27,"i",8),a.Wc(28),a.mc(29,"translate"),a.Yb(),a.Wc(30,"\n                    "),a.Zb(31,"span",7),a.hc("click",(function(){return t.obj.onSave("Clear")})),a.Ub(32,"i",9),a.Wc(33),a.mc(34,"translate"),a.Yb(),a.Wc(35,"\n                "),a.Yb(),a.Wc(36,"\n            "),a.Yb(),a.Wc(37,"\n\n            "),a.Zb(38,"div",10),a.Wc(39,"\n                "),a.Zb(40,"div",11),a.Wc(41,"\n                    "),a.Ub(42,"app-PactGridView",12),a.Wc(43,"\n                "),a.Yb(),a.Wc(44,"                               \n            "),a.Yb(),a.Wc(45,"\n        "),a.Yb(),a.Wc(46,"\n    "),a.Yb(),a.Wc(47,"\n    "),a.Zb(48,"div",13),a.Wc(49,"\n        "),a.Zb(50,"div"),a.Wc(51,"\n            "),a.Zb(52,"button",14),a.hc("click",(function(){return t.obj.onSave("OK")})),a.Wc(53),a.mc(54,"translate"),a.Yb(),a.Wc(55,"\n            "),a.Zb(56,"button",7),a.hc("click",(function(){return t.obj.onSave("Close")})),a.Wc(57),a.mc(58,"translate"),a.Yb(),a.Wc(59,"\n        "),a.Yb(),a.Wc(60,"\n    "),a.Yb(),a.Wc(61,"\n"),a.Yb()),2&e&&(a.Db(8),a.tc("ngIf",t.obj.Mode.Visible),a.Db(2),a.tc("ngIf",t.obj.Customer.Visible),a.Db(2),a.tc("ngIf",t.obj.Contracts.Visible),a.Db(2),a.tc("ngIf",t.obj.Product.Visible),a.Db(2),a.tc("ngIf",t.obj.SerailNo.Visible),a.Db(2),a.tc("ngIf",t.obj.BomCode.Visible),a.Db(2),a.tc("ngIf",t.obj.BomName.Visible),a.Db(2),a.tc("ngForOf",t.obj.ProductFields),a.Db(6),a.Xc(a.nc(29,14,"Filter")),a.Db(5),a.Xc(a.nc(34,16,"Clear")),a.Db(9),a.tc("obj",t.obj.GridDataObj)("group",t.form),a.Db(11),a.Xc(a.nc(54,18,"Ok")),a.Db(4),a.Xc(a.nc(58,20,"Close")))},encapsulation:2}),e})()},"2Dtv":function(e,t,s){"use strict";s.r(t),s.d(t,"AssignFeatureViewModel",(function(){return C}));var i=s("Do2H"),a=s("Lp6j"),o=s("JIg3"),n=s("0/4Q"),l=s("ScVY"),r=s("EQd/"),d=s("DKUf"),h=s("CQvG"),c=s("m+Ff"),u=s("F+4J");class C extends l.b{constructor(){super(),this.LabelVisibility=!1,this.DetailButtonVisibility=!0,this.TeamVisible=!0,this.AssignDate=new o.a(0),this.RolesItemsObj=new n.b,this.UsersItemsObj=new n.b,this.GroupsItemsObj=new n.b,this.TypeOfAssigning=new n.e(0),this.Teams=new n.e(0),this.AssignUser=new n.e(0),this.InviteComments=new r.c(0),this.SelectedNode=new n.b,this.objTeam=new u.a,this.dtUsers=[],this._CCNodeID=0,this._CCID=0,this._ActivityID=0,this.Ret=0,this.userexists=!1,this.AssignXML="",this.Roles="",this.Users="",this.Grps=""}get RolesItems(){return this.RolesItemsObj}get UsersItems(){return this.UsersItemsObj}get GroupsItems(){return this.GroupsItemsObj}AssignFeatureViewModel_1(e,t,s){this._CCNodeID=t,this.SelectedNode.Visible=!1,this._CCID=s,this.Parent=e,this.Parent instanceof c.RCalenderViewModel||this.Parent instanceof d.a?(this.InviteComments.Visible=!0,this.InviteComments.Label="Comments"):this.InviteComments.Visible=!1,this.onLoadScreen(e)}AssignFeatureViewModel_2(e,t,s){this.SelectedNode.Items=t,this.SelectedNode.Visible=!0,this._CCID=s,this.Parent instanceof c.RCalenderViewModel?(this.InviteComments.Visible=!0,this.InviteComments.Label="Comments"):this.InviteComments.Visible=!1,this.Parent=e,this.onLoadScreen(e)}onLoadScreen(e){this.Title=i.a.GetResource("CRMTeam_Assign"),this.TypeOfAssigning.SelectionChangedCommand.Subscribe(this,"OnTypeChange"),this.Teams.SelectionChangedCommand.Subscribe(this,"OnChange"),this.RolesItemsObj.CheckedChangedCommand.Subscribe(this,"OnCheckedChanged"),this.UsersItemsObj.CheckedChangedCommand.Subscribe(this,"OnCheckedChanged"),this.GroupsItemsObj.CheckedChangedCommand.Subscribe(this,"OnCheckedChanged"),this.TypeOfAssigning.Label="Type",this.OnLoad(),this.Teams.Label=i.a.GetResource("CRMTeam_Title"),this.AssignDate.Label=i.a.GetResource("CRMTeam_AssignDate"),this.AssignUser.Label=i.a.GetResource("CRMTeam_AssignTo"),this.AssignDate.Text=Date.Today().ToString(i.a.SessionManager.Preferences["Date Format"].toString()),this.RolesItems.Visible=!1,this.UsersItems.Visible=!1,this.GroupsItems.Visible=!1;try{if(this._CCNodeID>0&&(this.dset=this.objTeam.GetAssignedDetails(this._CCID,this._CCNodeID,0),null!=this.dset&&this.dset.Tables.length>0)){if(this.dset.Tables[0].length>0){this.TypeOfAssigning.Items.push(n.d.ComboBoxItems_2("Team","1"));for(let e=0;e<this.dset.Tables[0].length;e++)this.Teams.Items.push(n.d.ComboBoxItems_2(this.dset.Tables[0][e].TeamName.toString(),this.dset.Tables[0][e].TeamID.toString()))}this.dset.Tables.length>1&&(this.dtUsers=this.dset.Tables[1]),this.dset.Tables.length>3&&this.dset.Columns[3].Contains("Company")&&this.dset.Tables[3].length>0&&(this.CompanyName=a.e.String(this.dset.Tables[3][0][this.dset.Columns[3][0]])),this.LabelVisibility=!1;let t=0;if(this.dset.Tables.length>4&&this.dset.Columns[4].Contains("UserName")&&this.dset.Tables[4].length>0&&(t=this.dset.Tables[4].filter(e=>e.UserName!=i.a.SessionManager.UserName).length),!(e instanceof h.b)&&this.dset.Tables.length>2&&this.dset.Columns[2].Contains("CCID")&&this.dset.Tables[2].length>0){let e=this.dset.Tables[2].filter(e=>e.UserID>1&&0==e.TeamNodeID);if(e.length>0)for(let s=0;s<e.length;s++)for(let i=0;i<this.UsersItems.Items.length;i++)if(this.UsersItems.Items[i].Value==e[s].UserID.toString()){0==t&&(this.UsersItems.Items[i].Enable=!1),this.UsersItems.Items[i].IsChecked=!0,this.userexists||(this.userexists=!0);break}if(e=this.dset.Tables[2].filter(e=>1==e.IsGroup),e.length>0)for(let t=0;t<e.length;t++)for(let s=0;s<this.GroupsItems.Items.length;s++)if(this.GroupsItems.Items[s].Value==e[t].TeamNodeID.toString()){this.GroupsItems.Items[s].IsChecked=!0,this.userexists||(this.userexists=!0);break}if(e=this.dset.Tables[2].filter(e=>1==e.IsRole),e.length>0)for(let t=0;t<e.length;t++)for(let s=0;s<this.RolesItems.Items.length;s++)if(this.RolesItems.Items[s].Value==e[t].TeamNodeID.toString()){this.RolesItems.Items[s].IsChecked=!0,this.userexists||(this.userexists=!0);break}e=this.dset.Tables[2].filter(e=>e.TeamNodeID>1&&1==e.IsTeam),e.length>0&&(this.Teams.SelectedValue=e[0].TeamNodeID.toString()),e=this.dset.Tables[2].filter(e=>e.TeamNodeID>1&&e.UserID>0),e.length>0&&(this.Teams.SelectedValue=e[0].TeamNodeID.toString(),this.AssignUser.SelectedValue=e[0].UserID.toString())}}}catch(t){throw Logger.ErrorLog("AssignFeatureViewModel::error ",t),t}}OnCheckedChanged(e){let t=e.item;if(t=e.item,"0"==t.Value){if(this.RolesItems.Items.Contains(t))for(let e=0;e<this.RolesItems.Items.length;e++)this.RolesItems.Items[e].IsChecked=t.IsChecked;if(this.UsersItems.Items.Contains(t))for(let e=0;e<this.UsersItems.Items.length;e++)this.UsersItems.Items[e].IsChecked=t.IsChecked;if(this.GroupsItems.Items.Contains(t))for(let e=0;e<this.GroupsItems.Items.length;e++)this.GroupsItems.Items[e].IsChecked=t.IsChecked}else t.IsChecked||(this.RolesItems.Items.Contains(t)&&(this.RolesItems[0].IsChecked=!1),this.UsersItems.Items.Contains(t)&&(this.UsersItems[0].IsChecked=!1),this.GroupsItems.Items.Contains(t)&&(this.GroupsItems[0].IsChecked=!1))}OnLoad(){let e=i.a.common.GetWorkFlowScreenDetails(!0);if(null!=e){if(e.Tables.length>1){e.Tables[1].length>0&&this.TypeOfAssigning.Items.push(n.d.ComboBoxItems_2("Users","2")),this.UsersItems.Items.push(n.c.CheckedListBoxItem_3("All","0"));for(let t=0;t<e.Tables[1].length;t++)this.UsersItems.Items.push(n.c.CheckedListBoxItem_3(e.Tables[1][t].UserName.toString(),e.Tables[1][t].UserID.toString()))}if(e.Tables.length>0){e.Tables[0].length>0&&this.TypeOfAssigning.Items.push(n.d.ComboBoxItems_2("Roles","3")),this.RolesItems.Items.push(n.c.CheckedListBoxItem_3("All","0"));for(let t=0;t<e.Tables[0].length;t++)this.RolesItems.Items.push(n.c.CheckedListBoxItem_3(e.Tables[0][t].Name.toString(),e.Tables[0][t].RoleID.toString()))}if(e.Tables.length>2){e.Tables[2].length>0&&this.TypeOfAssigning.Items.push(n.d.ComboBoxItems_2("Group","4")),this.GroupsItems.Items.push(n.c.CheckedListBoxItem_3("All","0"));for(let t=0;t<e.Tables[2].length;t++)this.GroupsItems.Items.push(n.c.CheckedListBoxItem_3(e.Tables[2][t].GroupName.toString(),e.Tables[2][t].GroupID.toString()))}}}OnSave(e){if("Cancel"==e.toString())i.a.page.HideDialog(),this.Parent instanceof h.b?this.Parent.Activities.AssignVisiblity=!1:this.Parent instanceof c.RCalenderViewModel?(this.Parent.Activities.IsPopup||(this.Parent.ActVisibility=!0),this.Parent.AssignVisiblity=!1):this.Parent instanceof d.a||"AddEditLeads"==this.Parent.ClassName?("AddEditLeads"==this.Parent.ClassName&&this.Parent.IsAssign&&(this.Parent.Status.SelectedValue="419"),i.a.page.HideDialog()):this.Parent.AssignVisiblity=!1;else if("Search_Roles"==e.toString());else if("Search_Users"==e.toString());else if("Search_Groups"==e.toString());else if("0"==this.TypeOfAssigning.SelectedValue||null==this.TypeOfAssigning.SelectedValue)this.DisplayMessage="Please select type to assign";else{if(this.userexists&&73==this._CCID&&!confirm("Open Activities will trasfer to Assigned users, Are you sure you want to continue?"))return;if(this.Users="",this.Roles="",this.Grps="",null!=this.Parent&&this.Parent instanceof h.b){let e=this.Parent.SelectedRow;if(null!=e){if(this.GetNodeNames(),!a.e.StringIsNullOrEmpty(this.DisplayMessage))return void(this.MessageVisibility=!0);e.UsersXML=this.Users,e.RolesXML=this.Roles,e.isEdited="1",e.GroupXML=this.Grps,e.TeamNodeID=parseInt(this.Teams.SelectedValue),"0"!=this.AssignUser.SelectedValue&&null!=this.AssignUser.SelectedValue?(e.UserID=parseInt(this.AssignUser.SelectedValue),e.isTeam="0"):(e.UserID="0",e.isTeam="1"),this.Parent.ActivityGridDataObj.updateRow(e),i.a.page.HideDialog()}return}if(this.objTeam.FetaureID=this._CCID,this.SelectedNode.Visible){let e="";this.SelectedNode.Items.filter(e=>e.IsChecked&&e.Value).forEach(t=>{e+='<Row NodeID="'+t.toString()+'" ></Row>'}),e.length>0&&(e="<XML>"+e+"</XML>",this.objTeam.NodesXML=e.toString())}else this.objTeam.FeatureNodeID=this._CCNodeID;if(this.GetNodeNames(),!a.e.StringIsNullOrEmpty(this.DisplayMessage))return void(this.MessageVisibility=!0);if(this.objTeam.UsersXML=this.Users,this.objTeam.RolesXML=this.Roles,this.objTeam.GroupXML=this.Grps,this.objTeam.TeamNodeID=parseInt(this.Teams.SelectedValue),"0"!=this.AssignUser.SelectedValue&&null!=this.AssignUser.SelectedValue?(this.objTeam.UserID=parseInt(this.AssignUser.SelectedValue),this.objTeam.isTeam=0):(this.objTeam.UserID=0,this.objTeam.isTeam=1),this.Parent instanceof c.RCalenderViewModel||this.Parent instanceof d.a){this.objTeam.InviteComments=null!=this.InviteComments.Text?this.InviteComments.Text:"";let e=this.objTeam.SetInvite();this.Ret=e.RetValue,this.DisplayMessage=e.Message,this.Ret>0?(this.MessageVisibility=!0,this.Parent instanceof c.RCalenderViewModel&&(this.Parent.ActVisibility=!0,this.Parent.AssignVisiblity=!1),Logger.InfoLog("AssignFeatureViewModel :: Exiting OnSave set invite error ")):this.MessageVisibility=!0}else if(null!=this.Parent&&"PACT.VIEWMODEL.ViewEventsViewModel"==this.Parent.toString()){let e,t=this.Parent.ActivityData.Rows.indexOf(this.Parent.SelectedRow.Row);e=this.Parent.ActivityGridData.filter(this.Parent.FilterStatus);let s=e[t];s.UsersXML=this.Users,s.RolesXML=this.Roles,s.GroupXML=this.Grps,this.Parent.ActivityGridData.AcceptChanges(),this.objTeam.FetaureID=128,this.objTeam.ActivityID=this._ActivityID;let i=this.objTeam.ActivityAssign();this.Ret=i.RetValue,this.DisplayMessage=i.Message}else if(this.SelectedNode.Visible){let e=this.objTeam.AssignMultipleFeature();this.Ret=e.RetValue,this.DisplayMessage=e.Message}else{if(0==this._CCNodeID){let e="";return e+="<XML>",e+="<Row TeamNodeID='"+this.objTeam.TeamNodeID+"'",e+=" UserID='"+this.objTeam.UserID+"'",e+=" isTeam='"+this.objTeam.isTeam+"'",e+=" RolesXML='"+this.objTeam.RolesXML+"'",e+=" UsersXML='"+this.objTeam.UsersXML+"'",e+=" GroupXML='"+this.objTeam.GroupXML+"' />",e+="</XML>",this.AssignXML=e.toString(),this.MessageVisibility=!0,void(this.DisplayMessage=i.a.GetResource("CRMTeam_Save"))}if(this.dset.Tables.length>2&&0==this.dset.Tables[2].length&&""==this.objTeam.RolesXML&&""==this.objTeam.UsersXML&&""==this.objTeam.GroupXML&&0==this.objTeam.TeamNodeID)this.DisplayMessage="There was No Selection";else{let e=this.objTeam.FeatureAssign();this.Ret=e.RetValue,this.DisplayMessage=e.Message}}this.Ret>0?(this.DisplayMessage=this.dset.Tables.length>2&&this.dset.Columns[2].Contains("CCID")&&this.dset.Tables[2].length>0&&""==this.objTeam.RolesXML&&""==this.objTeam.UsersXML&&""==this.objTeam.GroupXML&&0==this.objTeam.TeamNodeID?i.a.GetResource("CRMTeam_UnAssigned"):i.a.GetResource("CRMTeam_Save"),null!=this.Parent&&"AddEditLeads"==this.Parent.ClassName&&(this.Parent.IsAssign=!0)):this.Ret<0&&(this.DisplayMessage=i.a.GetResource("CRMTeam_Error")),this.MessageVisibility=!0,this.LabelVisibility=!1}}GetNodeNames(){this.DisplayMessage="",this.Roles="",this.Users="",this.Grps="";for(let t=0;t<this.RolesItems.Items.length;t++)this.RolesItems.Items[t].IsChecked&&"0"!=this.RolesItems.Items[t].Value&&(this.Roles+=this.RolesItems.Items[t].Value+",");this.Roles=this.Roles.Trim(",");for(let t=0;t<this.UsersItems.Items.length;t++)this.UsersItems.Items[t].IsChecked&&"0"!=this.UsersItems.Items[t].Value&&(this.Users+=this.UsersItems.Items[t].Value+",");this.Users=this.Users.Trim(",");for(let t=0;t<this.GroupsItems.Items.length;t++)this.GroupsItems.Items[t].IsChecked&&"0"!=this.GroupsItems.Items[t].Value&&(this.Grps+=this.GroupsItems.Items[t].Value+",");this.Grps=this.Grps.Trim(",");let e=i.a.SessionManager.GetActionDays(this._CCID,"Assign");if(e>0){if(this.Roles.split(",").length>e)return void(this.DisplayMessage=i.a.GetResource("Only ("+e+") Role(s) can be Assigned"));if(this.Users.split(",").length>e)return void(this.DisplayMessage=i.a.GetResource("Only ("+e+") User(s) can be Assigned"));if(this.Grps.split(",").length>e)return void(this.DisplayMessage=i.a.GetResource("Only ("+e+") Group(s) can be Assigned"));if(this.Roles.split(",").length+this.Users.split(",").length+this.Grps.split(",").length<e)return void(this.DisplayMessage=i.a.GetResource("Assign atleast ("+e+") Role/User/Group"))}}OnTypeChange(e){"0"!=this.TypeOfAssigning.SelectedValue&&null!=this.TypeOfAssigning.SelectedValue&&(this.TeamVisible=!1,this.RolesItems.Visible=!1,this.UsersItems.Visible=!1,this.GroupsItems.Visible=!1,"1"==this.TypeOfAssigning.SelectedValue?this.TeamVisible=!0:"2"==this.TypeOfAssigning.SelectedValue?this.UsersItems.Visible=!0:"3"==this.TypeOfAssigning.SelectedValue?this.RolesItems.Visible=!0:"4"==this.TypeOfAssigning.SelectedValue&&(this.GroupsItems.Visible=!0))}OnChange(e){"0"!=this.Teams.SelectedValue&&null!=this.Teams.SelectedValue&&(this.AssignUser.Items.Clear(),this.LoadUsers())}LoadUsers(){let e=this.dtUsers.filter(e=>e.TeamID==this.Teams.SelectedValue);if(e.length>0){this.AssignUser.Items.Clear();for(let t=0;t<e.length;t++)this.AssignUser.Items.push(n.d.ComboBoxItems_2(e[t].UserName.toString(),e[t].UserID.toString()))}}}},"2mtM":function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var i=s("Do2H"),a=s("Lp6j"),o=s("ScVY"),n=s("8B8H"),l=s("ockk");class r extends o.b{constructor(e){super(),this.ListObj=new n.a,this.ColumnSpan="4",this.Parent=e,this.ListObj.Table=[],this.ListObj.Columns=[],this.ListObj.ColumnSpan=4,this.ListObj.TableColumns.push("AssignFrom"),this.ListObj.TableColumns.push("AssignTo"),this.ListObj.TableColumns.push("Date"),this.ListObj.TableColumns.push("Time");let t=new l.a;t.Header="Assign From",t.DisplayMember="AssignFrom",t.Width=250,t.ReadOnly=!0,this.ListObj.Columns.push(t),t=new l.a,t.Header="AssignTo",t.DisplayMember="AssignTo",t.Width=250,t.ReadOnly=!0,this.ListObj.Columns.push(t),t=new l.a,t.Header="Date",t.DisplayMember="Date",t.Width=250,t.ReadOnly=!0,this.ListObj.Columns.push(t),t=new l.a,t.Header="Time",t.DisplayMember="Time",t.Width=250,t.ReadOnly=!0,this.ListObj.Columns.push(t)}LoadHistroy_1(e,t){try{let e;if(this.ListObj.Clear(),null!=e&&e.Tables.length>0&&e.Tables[0].length>0)for(let t=0;t<e.Tables[0].length;t++){let s=this.ListObj.NewRow();s.AssignFrom=e.Tables[0][t].ASSIGNEDFROM.toString(),s.AssignTo=e.Tables[0][t].ASSIGNEDTO.toString(),s.Date=new Date(e.Tables[0][t].DATE).ToString(i.a.SessionManager.Preferences["Date Format"].toString()),a.e.IsEmpty(e.Tables[0][t].TIME.toString())||(s.Time=new Date(e.Tables[0][t].TIME).ToString("hh:mm:ss tt")),this.ListObj.addRow(s)}}catch(s){Logger.InfoLog("ViewAssignHistroyViewModel::Exiting LoadHistroy")}Logger.InfoLog("ViewAssignHistroyViewModel::Exiting LoadHistroy")}LoadHistroy_2(e){try{if(this.ListObj.Clear(),null!=e&&e.length>0)for(let t=0;t<e.length;t++){let s=this.ListObj.NewRow();s.AssignFrom=e[t].ASSIGNEDFROM.toString(),s.AssignTo=e[t].ASSIGNEDTO.toString(),s.Date=new Date(e[t].DATE).ToString(i.a.SessionManager.Preferences["Date Format"].toString()),a.e.IsEmpty(e[t].TIME.toString())||(s.Time=new Date(e[t].TIME).ToString("hh:mm:ss tt")),this.ListObj.addRow(s)}}catch(t){}}}},E6JT:function(e,t,s){"use strict";s.d(t,"a",(function(){return b}));var i=s("Do2H"),a=s("Lp6j"),o=s("eQJW"),n=s("EQd/"),l=s("JIg3"),r=s("n56n"),d=s("0/4Q"),h=s("Jnyl"),c=s("ScVY"),u=s("VxiT"),C=s("4HhE"),m=s("NkMH");class b extends c.b{constructor(e,t=0){super(),this.ScreenObject=new u.a,this.Feedback=new n.c(0),this.FeedbackDate=new l.b(0),this.Fields=new Array,this.FeedbackVisibility=!0,this.isEdit=!1,this.oText=null,this.oDate=null,this.oCombo=null,this.oTextArea=null,this.OComboText=null,this.ButtonSave=new m.a,this.isView=!1,this.DiscussionClick=new C.b,73!=e.Parent.CostCenterID&&(this.FeedbackVisibility=!0),this.Title="Follow Up";try{this.ScreenObject.Data=null==e||null==e.ScreenObject.Data?i.a.crmService.GetFeedbackDetails(114):e.ScreenObject.Data,this.Oparent=e,0==t&&null!=this.Oparent&&(t=this.Oparent.Parent.CostCenterID),i.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=i.a.SessionManager.IsActionAssigned(t,"FollowUp_Create"):this.ButtonSave.Enable=i.a.SessionManager.IsActionAssigned(t,"FollowUp_Create"),this.Feedback.Label=i.a.GetResource("Feed_Diss"),this.FeedbackDate.Label=i.a.GetResource("Feed_Date");let a=0,c=0;for(let e=0;e<this.ScreenObject.Data.Tables[0].length;e++){if("TEXT"==this.ScreenObject.Data.Tables[0][e].UserColumnType.toString()||"NUMERIC"==this.ScreenObject.Data.Tables[0][e].UserColumnType.toString())this.ScreenObject.Data.Tables[0][e].Iscolumninuse&&this.ScreenObject.Data.Tables[0][e].IsColumnUserDefined&&(this.oText=new n.d(0),this.oText.Label=this.ScreenObject.Data.Tables[0][e].UserColumnName.toString(),this.oText.DBColumnName=this.ScreenObject.Data.Tables[0][e].CostCenterColID.toString(),this.oText.SysColumnName=this.ScreenObject.Data.Tables[0][e].SysColumnName.toString(),this.oText.DBColumnID=parseInt(this.ScreenObject.Data.Tables[0][e].CostCenterColID),this.oText.Column=a,this.oText.Row=c,c+=1),this.Fields.push(this.oText);else if("DATE"==this.ScreenObject.Data.Tables[0][e].UserColumnType.toString())this.ScreenObject.Data.Tables[0][e].Iscolumninuse&&this.ScreenObject.Data.Tables[0][e].IsColumnUserDefined&&(this.oDate=new l.a(0),this.oDate.Label=this.ScreenObject.Data.Tables[0][e].UserColumnName.toString(),this.oDate.DBColumnName=this.ScreenObject.Data.Tables[0][e].CostCenterColID.toString(),this.oDate.SysColumnName=this.ScreenObject.Data.Tables[0][e].SysColumnName.toString(),this.oDate.Column=a,this.oDate.DBColumnID=parseInt(this.ScreenObject.Data.Tables[0][e].CostCenterColID),this.oDate.Row=c,c+=1),this.Fields.push(this.oDate);else if("COMBOBOX"==this.ScreenObject.Data.Tables[0][e].UserColumnType.toString()){if(this.ScreenObject.Data.Tables[0][e].Iscolumninuse&&this.ScreenObject.Data.Tables[0][e].IsColumnUserDefined){this.oCombo=new d.e(0),this.oCombo.Label=this.ScreenObject.Data.Tables[0][e].UserColumnName.toString(),this.oCombo.DBColumnName=this.ScreenObject.Data.Tables[0][e].CostCenterColID.toString(),this.oCombo.DBColumnID=parseInt(this.ScreenObject.Data.Tables[0][e].CostCenterColID),this.oCombo.SysColumnName=this.ScreenObject.Data.Tables[0][e].SysColumnName.toString(),this.oCombo.Column=a;let t=this.ScreenObject.Data.Tables[0][e].UserProbableValues.toString().Trim();if(t.length>0){let e=t.split(";");for(let t=0;t<e.length;t++)this.oCombo.Items.push(d.d.ComboBoxItems_2(e[t],e[t]));this.oCombo.SelectedValue=this.oCombo.Items[0].Value}this.oCombo.Row=c,c+=1}this.Fields.push(this.oCombo)}else"TEXTAREA"==this.ScreenObject.Data.Tables[0][e].UserColumnType.toString()?(this.ScreenObject.Data.Tables[0][e].Iscolumninuse&&this.ScreenObject.Data.Tables[0][e].IsColumnUserDefined&&(this.oTextArea=new n.c(0),this.oTextArea.Label=this.ScreenObject.Data.Tables[0][e].UserColumnName.toString(),this.oTextArea.DBColumnName=this.ScreenObject.Data.Tables[0][e].CostCenterColID.toString(),this.oTextArea.SysColumnName=this.ScreenObject.Data.Tables[0][e].SysColumnName.toString(),this.oTextArea.DBColumnID=parseInt(this.ScreenObject.Data.Tables[0][e].CostCenterColID),this.oTextArea.Column=a,this.oTextArea.Row=c,c+=1),this.Fields.push(this.oTextArea)):"COMBOTEXT"==this.ScreenObject.Data.Tables[0][e].UserColumnType.toString()?(this.ScreenObject.Data.Tables[0][e].Iscolumninuse&&this.ScreenObject.Data.Tables[0][e].IsColumnUserDefined&&(this.OComboText=new h.a(0),this.OComboText.Label=this.ScreenObject.Data.Tables[0][e].UserColumnName.toString(),this.OComboText.DBColumnName=this.ScreenObject.Data.Tables[0][e].CostCenterColID.toString(),this.OComboText.DBColumnID=parseInt(this.ScreenObject.Data.Tables[0][e].CostCenterColID),this.OComboText.SysColumnName=this.ScreenObject.Data.Tables[0][e].SysColumnName.toString(),this.OComboText.Column=a,this.OComboText.Row=c,c+=1),this.Fields.push(this.OComboText)):"LISTBOX"==this.ScreenObject.Data.Tables[0][e].UserColumnType.toString()&&(this.ScreenObject.Data.Tables[0][e].Iscolumninuse&&this.ScreenObject.Data.Tables[0][e].IsColumnUserDefined&&(this.oPactCombo=new r.b(0),this.oPactCombo.CCID=parseInt(this.ScreenObject.Data.Tables[0][e].ColumnCostCenterID),this.oPactCombo.TypeID=0==this.ScreenObject.Data.Tables[0][e].ColumnCCListViewTypeID.toString().Trim().length?1:parseInt(this.ScreenObject.Data.Tables[0][e].ColumnCCListViewTypeID),this.oPactCombo.DBColumnID=parseInt(this.ScreenObject.Data.Tables[0][e].CostCenterColID),this.oPactCombo.Label=this.ScreenObject.Data.Tables[0][e].UserColumnName.toString(),this.oPactCombo.DBColumnName=this.ScreenObject.Data.Tables[0][e].CostCenterColID.toString(),this.oPactCombo.SysColumnName=this.ScreenObject.Data.Tables[0][e].SysColumnName.toString(),this.oPactCombo.Column=a,this.oPactCombo.Row=c,c+=1),this.Fields.push(this.oPactCombo));3==a&&(c+=1,a=0),a+=1}if(this.FeedbackDate.CustomFormat=i.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss tt",this.FeedbackDate.Date=new Date,this.ScreenObject.Data.Tables.length>8?this.ScreenObject.Data.Tables[8].forEach(e=>{"Date"==e.SysColumnName.toString()&&(this.FeedbackDate.DBColumnID=parseInt(e.CostCenterColID.toString()),this.FeedbackDate.Visible=Object(o.j)(e.IsVisible.toString()),this.FeedbackDate.Enable=Object(o.j)(e.IsEditable.toString())),"Feedback"==e.SysColumnName.toString()&&(this.Feedback.DBColumnID=parseInt(e.CostCenterColID.toString()),this.Feedback.Visible=Object(o.j)(e.IsVisible.toString()),this.Feedback.Enable=Object(o.j)(e.IsEditable.toString()))}):null!=e&&e.FeedBackDataObj.Columns.forEach(e=>{"Feedback"==e.DisplayMember?this.Feedback.Visible=e.IsVisible:"Date"==e.DisplayMember&&(this.FeedbackDate.Visible=e.IsVisible)}),this.ScreenObject.SetView(this.FeedbackDate,!1),this.ScreenObject.SetView(this.Feedback,!1),this.Fields.forEach(e=>{this.ScreenObject.SetView(e,!1)}),null!=this.Oparent&&null!=this.Oparent.Parent&&("AddEditLeads"==this.Oparent.Parent.ClassName||"AddEditOpportunity"==this.Oparent.Parent.ClassName))try{let e=null,t=null,s=null;if("AddEditLeads"==this.Oparent.Parent.ClassName?(t=this.Oparent.Parent,null!=t.ScreenObject&&(e=t.ScreenObject.Data)):"AddEditOpportunity"==this.Oparent.Parent.ClassName&&(s=this.Oparent.Parent,null!=s.ScreenObject&&(e=s.ScreenObject.Data)),null!=e){if(0==e.Tables.length)return;let i=e.Tables[4].Select("Name='AutoPupulateSuppliers'");if(i.length>0&&""!=i[0].Value.toString()){if(0==parseInt(i[0].Value.toString()))return;let e=null;if(null!=this.Fields){let a,o,n="";if("AddEditLeads"==this.Oparent.Parent.ClassName){if(null!=t.LeadsProduct.ProductColumnSource&&(e=t.LeadsProduct.ProductColumnSource.Where(e=>0!=e.CostCenterID&&e.CostCenterID==parseInt(i[0].Value)).FirstOrDefault(),null==e||null==e.ID))return;for(let s=0;s<t.LeadsProduct.ProductGrid.length;s++)""!=t.LeadsProduct.ProductGrid.Rows[s].ProductID_Key.toString()&&null!=t.LeadsProduct.ProductGrid.Rows[s].ProductID_Key.toString()&&(n+=t.LeadsProduct.ProductGrid.Rows[s][e.ValueMember]+",")}else if("AddEditOpportunity"==this.Oparent.Parent.ClassName){if(null!=s.LeadsProduct.ProductColumnSource&&(e=s.LeadsProduct.ProductColumnSource.Where(e=>0!=e.CostCenterID&&e.CostCenterID==parseInt(i[0].Value)).FirstOrDefault(),null==e||null==e.ID))return;for(let t=0;t<s.LeadsProduct.ProductGrid.length;t++)""!=s.LeadsProduct.ProductGrid.Rows[t].ProductID_Key.toString()&&null!=s.LeadsProduct.ProductGrid.Rows[t].ProductID_Key.toString()&&(n+=s.LeadsProduct.ProductGrid.Rows[t][e.ValueMember]+",")}if(0==n.length)return;for(let e=0;e<this.Fields.length;e++)if(a=this.Fields[e],null!=a&&a instanceof r.b&&a.CCID==parseInt(i[0].Value)){o=a,o.CustomWhere=" a.NodeID  in ("+n.TrimEnd(",")+")",o.Refresh();break}}}}}catch(s){}}catch(a){throw Logger.ErrorLog("FeedbackViewModel:: FeedbackViewModel",a),a}}OnDiscussionClick(e){}OnSave(e){try{if("Cancel"==e.toString())i.a.page.HideDialog();else if("Save"==e.toString()&&(this.Feedback.Visible||(this.Feedback.Text=" "),null!=this.Feedback.Text&&""!=this.Feedback.Text)){if(null!=this.Oparent.SelectedRow&&this.isEdit){this.Oparent.SelectedRow.View="View",this.Oparent.SelectedRow.Date=this.FeedbackDate.Date.ToString("dd/MMM/yyyy hh:mm:ss tt"),this.Oparent.SelectedRow.Date_Key=this.FeedbackDate.Date;let e=null!=this.Feedback.Text?this.Feedback.Text.toString():"";null!=this.Feedback.Tag&&""!=this.Feedback.Tag&&(e=this.Feedback.Tag),this.Oparent.SelectedRow.FeedBack=e,this.Oparent.SelectedRow.CreatedBy=i.a.SessionManager.UserName,this.Oparent.SelectedRow.Imagefilepath=a.e.IsEmpty(i.a.SessionManager.UserPhoto)?"":a.e.GetPath(i.a.SessionManager.UserPhoto);for(let t=0;t<this.Fields.length;t++){let e=this.Fields[t];e instanceof n.d?this.Oparent.SelectedRow[e.SysColumnName]=e.Text:e instanceof l.a?this.Oparent.SelectedRow[e.SysColumnName]=e.Date:e instanceof d.e?this.Oparent.SelectedRow[e.SysColumnName]=e.SelectedValue:e instanceof h.a?this.Oparent.SelectedRow[e.SysColumnName]=e.TextBox.Text:e instanceof n.c?this.Oparent.SelectedRow[e.SysColumnName]=e.Text:e instanceof r.b&&(this.Oparent.SelectedRow[e.SysColumnName+"_Key"]=e.SelectedValue,this.Oparent.SelectedRow[e.SysColumnName]=e.Text)}this.Oparent.FeedBackDataObj.updateRow(this.Oparent.SelectedRow),this.Oparent.SelectedRow=null}else{let e=this.Oparent.FeedBackDataObj.NewRow();e.View="View",e.Date=this.FeedbackDate.Date.ToString("dd/MMM/yyyy hh:mm:ss tt"),e.Date_Key=this.FeedbackDate.Date;let t=null!=this.Feedback.Text?this.Feedback.Text.toString():"";null!=this.Feedback.Tag&&""!=this.Feedback.Tag&&(t=this.Feedback.Tag),e.FeedBack=t,e.CreatedBy=i.a.SessionManager.UserName,e.Imagefilepath=a.e.IsEmpty(i.a.SessionManager.UserPhoto)?"":a.e.GetPath(i.a.SessionManager.UserPhoto);for(let s=0;s<this.Fields.length;s++){let t=this.Fields[s];t instanceof n.d?e[t.SysColumnName]=t.Text:t instanceof l.a?e[t.SysColumnName]=t.Date:t instanceof d.e?e[t.SysColumnName]=t.SelectedValue:t instanceof h.a?e[t.SysColumnName]=t.TextBox.Text:t instanceof n.c?e[t.SysColumnName]=t.Text:t instanceof r.b&&(e[t.SysColumnName+"_Key"]=t.SelectedValue,e[t.SysColumnName]=t.Text)}this.Oparent.FeedBackDataObj.addRow(e)}this.Feedback.Text="",this.FeedbackDate.Date=new Date,this.isEdit=!1,this.ClearFields()}}catch(t){throw Logger.ErrorLog("FeedbackViewModel:: OnSave",t),t}}ClearFields(){for(let e=0;e<this.Fields.length;e++){let t=this.Fields[e];t instanceof n.d&&(this.oText=t,this.oText.Text=""),t instanceof l.a&&(this.oDate=t),t instanceof d.e&&(this.oCombo=t,this.oCombo.SelectedValue=""),t instanceof h.a&&(this.OComboText=t,this.OComboText.TextBox.Text=""),t instanceof n.c&&(this.oTextArea=t,this.oTextArea.Text=""),t instanceof r.b&&(this.oPactCombo=t,this.oPactCombo.SelectedValue=0)}}}},GQfG:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var i=s("Do2H"),a=s("ScVY"),o=s("JIg3"),n=s("r2z3"),l=s("V7Sd");class r extends a.b{constructor(e,t,s){super(),this.CloseDate=new o.c(0),this.NodeID=0,this.CCID=0,this.retuval=0,this.NodeID=e,this.CCID=s,this.CloseDate.Label="Closed Date",this.Parent=t,86==s?this.Title="Close Lead":73==s&&(this.Title="Close Case")}OnClose(e){var t,s;if(null!=e&&"Close"==e.toString()){let e=new n.a;e.LeadID=this.NodeID;let a=e.CloseLead(this.NodeID,this.CCID,this.CloseDate.Date);this.DisplayMessage=a.Message,this.retuval=a.RetValue,this.retuval>0&&(this.Parent instanceof l.TreeViewPageComponent?(this.Parent.DisplayMessage=this.DisplayMessage,this.Parent.Refresh()):null!=this.Parent&&"AddEditLeads"==(null===(t=this.Parent)||void 0===t?void 0:t.ClassName)?(this.Parent.DisplayMessage=this.DisplayMessage,i.a.page.HideDialog()):null!=this.Parent&&"AddEditCasesViewModel"==(null===(s=this.Parent)||void 0===s?void 0:s.ClassName)&&(this.Parent.ButtonSave.Enable=!1,this.Parent.DisplayMessage=this.DisplayMessage,i.a.page.HideDialog()))}else null!=this.Parent&&i.a.page.HideDialog()}}},Hzm0:function(e,t,s){"use strict";s.r(t),s.d(t,"AddEditCasesViewModel",(function(){return x}));var i=s("mrSG"),a=s("Do2H"),o=s("Lp6j"),n=s("eQJW"),l=s("ScVY"),r=s("GQfG"),d=s("W7OG"),h=s("E6JT"),c=s("nFYD"),u=s("NkMH"),C=s("2mtM"),m=s("ockk"),b=s("EQd/"),S=s("JIg3"),D=s("0/4Q"),g=s("DKUf"),p=s("CQvG"),I=s("RJs6"),T=s("xnJf"),y=s("OvA8"),f=s("5DrK"),P=s("VxiT"),O=s("n56n"),V=s("8B8H"),M=s("yJmf"),N=s("4HhE");class L extends l.b{constructor(){super(),this.setGridFocus=!1,this.Width=0,this.GridDataObj=new V.a,this.AccountVisible=!1,this.CRMCustomerVisible=!1,this.ScreenWidth=0,this.ScreenHeight=0,this.SerailNo=new b.d(0),this.BomCode=new b.d(0),this.BomName=new b.d(0),this.Product=new O.b(0),this.Mode=new D.e(0),this.Contracts=new D.e(0),this.Customer=new O.b(0),this.PreCheckContractMandatory=!1,this.prodds=null,this.GridDataObj.Table=[],this.GridDataObj.Columns=[]}get GridData(){return this.GridDataObj.Table}get ColumnSource(){return this.GridDataObj.Columns}get SelectedRow(){return this.GridDataObj.SelectedItem}CaseSearchViewModel_1(e){let t;this.MParent=e,this.BomName.Label="Name",this.BomName.Visible=!0,this.BomCode.Label="Code",this.BomCode.Visible=!0,this.ScreenWidth=900,this.ScreenHeight=400,this.Customer.Visible=!1,this.Product.Visible=!1,this.SerailNo.Visible=!1,this.Contracts.Visible=!1,this.AccountVisible=!0,this.CRMCustomerVisible=!1,t=new m.a,t.Header="#",t.DisplayMember="Sno",t.DataType="TextBlock",t.Width=24,t.IsVisible=!0,t.ReadOnly=!0,t.IsFrozen=!0,this.ColumnSource.push(t),t=new m.a,t.Header="Name",t.DisplayMember="Name",t.DataType="TextBlock",t.Width=150,t.IsVisible=!0,t.ReadOnly=!0,t.IsFrozen=!0,this.ColumnSource.push(t),t=new m.a,t.Header="Code",t.DisplayMember="Code",t.DataType="TextBlock",t.Width=100,t.IsVisible=!0,t.ReadOnly=!0,t.IsFrozen=!0,this.ColumnSource.push(t),this.GridDataObj.TableColumns.push("Sno"),this.GridDataObj.TableColumns.push("BOMID"),this.GridDataObj.TableColumns.push("Name"),this.GridDataObj.TableColumns.push("Code"),this.GridDataObj.Columns=this.ColumnSource}CaseSearchViewModel_2(e){if(this.Parent=e,this.ScreenWidth=900,this.ScreenHeight=400,this.BomName.Visible=!1,this.BomCode.Visible=!1,this.Customer.Visible=!0,this.Product.Visible=!0,this.SerailNo.Visible=!0,this.Contracts.Visible=!0,this.AccountVisible=!0,this.CRMCustomerVisible=!1,this.Customer.Label="Customer",this.Customer.CCID=2,this.Customer.TypeID=2,this.Customer.SelectedValue=0,this.Mode.Label="Mode",this.Mode.Items.Clear(),this.Mode.Items.push(D.d.ComboBoxItems_2("Account","1")),null!=this.Parent&&null!=this.Parent.ScreenObject.Data&&this.Parent.ScreenObject.Data.Tables.length>3&&this.Parent.ScreenObject.Data.Tables[4].length>0){let e=this.Parent.ScreenObject.Data.Tables[4].filter(e=>"CustomerInMode"==e.Name);e.length>0&&""!=e[0].Value.toString()&&Object(n.j)(e[0].Value)&&this.Mode.Items.push(D.d.ComboBoxItems_2("CRM-Customers","2")),e=this.Parent.ScreenObject.Data.Tables[4].filter(e=>"Contractselectionmandatory"==e.Name),e.length>0&&""!=e[0].Value.toString()&&Object(n.j)(e[0].Value)&&(this.PreCheckContractMandatory=!0)}let t;this.Mode.SelectedValue="1",this.Mode.SelectionChangedCommand.Subscribe(this,"onSave"),this.Product.CCID=3,this.Product.TypeID=10,this.SerailNo.Label="Serail No",this.Product.Label="Product",this.Contracts.Label="Contracts",this.Customer.OnPactListBoxValueChanged.Subscribe(this,"CustomerChanged"),t=new m.a,t.Header="#",t.DisplayMember="Sno",t.DataType="TextBlock",t.Width=24,t.IsVisible=!0,t.ReadOnly=!0,t.IsFrozen=!0,this.ColumnSource.push(t),t=new m.a,t.Header="Customer",t.DisplayMember="Customer",t.DataType="TextBlock",t.Width=150,t.IsVisible=!0,t.ReadOnly=!0,t.IsFrozen=!0,this.ColumnSource.push(t),t=new m.a,t.Header="Contract",t.DisplayMember="Contract",t.DataType="TextBlock",t.Width=100,t.IsVisible=!0,t.ReadOnly=!0,t.IsFrozen=!1,this.ColumnSource.push(t),t=new m.a,t.Header="Product",t.DisplayMember="Product",t.DataType="TextBlock",t.Width=150,t.IsVisible=!0,t.ReadOnly=!0,t.IsFrozen=!1,this.ColumnSource.push(t),t=new m.a,t.Header="SerialNo",t.DisplayMember="SerialNo",t.DataType="TextBlock",t.Width=100,t.IsVisible=!0,t.ReadOnly=!0,t.IsFrozen=!1,this.ColumnSource.push(t),this.GridDataObj.TableColumns.push("Sno"),this.GridDataObj.TableColumns.push("ProductID"),this.GridDataObj.TableColumns.push("SerialNo"),this.GridDataObj.TableColumns.push("Product"),this.GridDataObj.TableColumns.push("Contract"),this.GridDataObj.TableColumns.push("Customer"),this.GridDataObj.TableColumns.push("CustomerID"),this.GridDataObj.TableColumns.push("DocID"),this.ProductFields=new Array;let s=a.a.inventory.GetProductSearchFields(161);if(null!=s&&s.Tables.length>0&&!s.Columns[0].Contains("ErrorMessage"))for(let i=0;i<s.Tables[0].length;i++)t=new m.a,t.Header=s.Tables[0][i].ResourceData.toString(),t.DisplayMember="LISTBOX"==s.Tables[0][i].ColumnDataType.toString()?"Name"+s.Tables[0][i].SysColumnName.toString():s.Tables[0][i].SysColumnName.toString(),t.DataType="TextBlock",t.Width=100,t.IsVisible=!0,t.ReadOnly=!0,t.IsFrozen=!1,this.GridDataObj.TableColumns.Contains(s.Tables[0][i].SysColumnName.toString())||(this.ColumnSource.push(t),this.GridDataObj.TableColumns.push(s.Tables[0][i].SysColumnName.toString()),"LISTBOX"==s.Tables[0][i].ColumnDataType.toString()&&this.GridDataObj.TableColumns.push("Name"+s.Tables[0][i].SysColumnName.toString()),this.ProductFields.push(new j(s.Tables[0][i].ColumnDataType.toString(),s.Tables[0][i].SysColumnName.toString(),s.Tables[0][i].ResourceData.toString(),s.Tables[0][i].ColumnCostCenterID.toString(),s.Tables[0][i].ColumnCCListViewTypeID.toString(),Object(n.j)(s.Tables[0][i].iscolumninuse.toString()))));this.GridDataObj.Columns=this.ColumnSource,this.CustomerChanged(null),Logger.InfoLog("CaseSearchViewModel::Exiting CaseSearchViewModel")}CustomerChanged(e){this.Contracts.Items.Clear();let t=this.Parent.Casesmodel.GetCustomerContracts(this.Customer.SelectedValue);if(null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&t.Columns[0].Contains("DocID"))for(let s=0;s<t.Tables[0].length;s++)this.Contracts.Items.push(D.d.ComboBoxItems_2(t.Tables[0][s].VoucherNo.toString(),t.Tables[0][s].DocID.toString()))}onSave(e){if("Clear"==e)this.GridDataObj.Clear(),this.Contracts.SelectedValue="",this.Customer.SelectedValue=0,this.Product.SelectedValue=0,this.SerailNo.Text="",this.BomCode.Text="",this.BomName.Text="";else if("Mode"==e)"2"==this.Mode.SelectedValue?(this.ScreenWidth=320,this.ScreenHeight=400,this.AccountVisible=!1,this.CRMCustomerVisible=!0,this.Product.Visible=!1,this.SerailNo.Visible=!1,this.Contracts.Visible=!1,this.Customer.CCID=83,this.Customer.TypeID=1,this.Customer.Refresh(),this.Customer.SelectedValue=0):(this.Customer.CCID=2,this.Customer.TypeID=2,this.Customer.Refresh(),this.ScreenWidth=900,this.Customer.SelectedValue=0,this.ScreenHeight=400,this.AccountVisible=!0,this.CRMCustomerVisible=!1,this.Product.Visible=!0,this.SerailNo.Visible=!0,this.Contracts.Visible=!0);else if("CustomerOk"==e){if(null!=this.Parent&&null!=this.Parent.ScreenObject.Data&&this.Parent.ScreenObject.Data.Tables.length>4&&this.Parent.ScreenObject.Data.Tables[4].length>0){let e=this.Parent.ScreenObject.Data.Tables[4].filter(e=>"DontAllowInActiveAccountstoCreateCases"==e.Name);if(e.length>0&&""!=e[0].Value.toString()&&Object(n.j)(e[0].Value)){let e=a.a.common.GetDataSet("CRM004",this.Customer.SelectedValue.toString());if(null!=e&&e.Tables.length>0&&e.Tables[0].length>0){if(!a.a.SessionManager.IsActionAssigned(73,"Allow cases for inactive accounts/customers"))return void(this.DisplayMessage="Cannot Create Cases For Inactive Customers");alert("Note: Selected customer instanceof inactive")}}}null!=this.Parent&&this.Customer.SelectedValue>0&&(this.Parent.Customer.CCID=83,this.Parent.Customer.TypeID=1,this.Parent.Customer.Refresh(),this.Parent.CustomerMode=2,this.Parent.Customer.SelectedValue=this.Customer.SelectedValue,this.Parent.Customer.DBColumnName="CustomerID",this.Parent.ScreenObject.OnGetReference(this.Parent.Customer),a.a.page.HideDialog())}else if("Mouse"==e||"OK"==e){if(null!=this.MParent)return void(null!=this.SelectedRow&&""!=this.SelectedRow.BomID.toString()&&null!=this.MParent.SelectedBom&&(this.MParent.SelectedBom.BOM_Key=parseInt(this.SelectedRow.BomID.toString()),this.MParent.SelectedBom.BOM=this.SelectedRow.Name.toString()));if(null!=this.Parent&&null!=this.Parent.ScreenObject.Data&&this.Parent.ScreenObject.Data.Tables[4].length>0){let e=this.Parent.ScreenObject.Data.Tables[4].filter(e=>"DontAllowInActiveAccountstoCreateCases"==e.Name);if(e.length>0&&""!=e[0].Value.toString()&&Object(n.j)(e[0].Value)){let e=0;this.Customer.SelectedValue>0?e=this.Customer.SelectedValue:null!=this.SelectedRow&&""!=this.SelectedRow.CustomerID.toString()&&(e=parseInt(this.SelectedRow.CustomerID));let t=a.a.common.GetDataSet("CRM005",e.toString());if(null!=t&&t.Tables.length>0&&t.Tables[0].length>0){if(!a.a.SessionManager.IsActionAssigned(73,"Allow cases for inactive accounts/customers"))return void(this.DisplayMessage="Cannot Create Cases For Inactive Accounts");alert("Note: Selected account instanceof inactive")}}let t=!1;if(t=a.a.SessionManager.IsActionAssigned(73,"Contract Selection Mandatory"),this.PreCheckContractMandatory&&t&&null==this.Contracts.SelectedValue&&"1"!=a.a.SessionManager.RoleID)return void(this.DisplayMessage="Contract selection mandatory")}if(null!=this.Parent&&(this.Parent.Customer.CCID=2,this.Parent.Customer.TypeID=2,this.Parent.Customer.Refresh(),this.Parent.CustomerMode=1),null!=this.SelectedRow){if(null!=this.Parent){""!=this.SelectedRow.CustomerID.toString()&&(this.Parent.Customer.SelectedValue=parseInt(this.SelectedRow.CustomerID.toString())),this.Parent.Customer.SelectedValue>0&&(this.Parent.Customer.DBColumnName="AccountID",this.Parent.ScreenObject.OnGetReference(this.Parent.Customer));for(let e=0;e<this.Parent.ScreenObject.HeaderFields.length;e++)if(this.Parent.ScreenObject.HeaderFields[e]instanceof O.e){this.Parent.ScreenObject.HeaderFields[e].Customer.SelectedValue=this.Customer.SelectedValue,this.Parent.ScreenObject.HeaderFields[e].Customer.TypeID=this.Customer.TypeID,this.Parent.ScreenObject.HeaderFields[e].Customer.CCID=this.Customer.CCID,this.Parent.ScreenObject.HeaderFields[e].Customer.DBColumnName=this.Customer.DBColumnName,this.Parent.ScreenObject.HeaderFields[e].Customer.Label=this.Customer.Label,this.Parent.ScreenObject.HeaderFields[e].Customer.IsReadOnly=!0,this.Parent.ScreenObject.HeaderFields[e].Customer.IsEnabled=!1,this.Parent.ScreenObject.HeaderFields[e].Customer.RefreshDataDel.Call();break}if(""!=this.SelectedRow.ProductID.toString()&&(0==this.Parent.Product.Items.filter(e=>e.Value==this.SelectedRow.ProductID.toString()).length&&this.Parent.Product.Items.push(D.d.ComboBoxItems_2(this.SelectedRow.Product.toString(),this.SelectedRow.ProductID.toString())),this.Parent.Product.SelectedValue=this.SelectedRow.ProductID.toString()),""!=this.SelectedRow.Contract.toString()&&(0==this.Parent.Contract.Items.filter(e=>e.Value==this.SelectedRow.DocID.toString()).length&&this.Parent.Contract.Items.push(D.d.ComboBoxItems_2(this.SelectedRow.Contract.toString(),this.SelectedRow.DocID.toString())),this.Parent.Contract.SelectedValue=this.SelectedRow.DocID.toString()),""!=this.SelectedRow.SerialNo.toString()&&(this.Parent.SerialNumber.Text=this.SelectedRow.SerialNo.toString()),null!=this.prodds&&"0"!=this.SelectedRow.DocID.toString()){let e=this.prodds.Tables[0].filter(e=>e.DocID==this.SelectedRow.DocID.toString());if(e.length>0){if(this.prodds.Columns[0].Contains("CaseType")){let t=0,s=0;this.prodds.Columns[0].Contains("CaseCount")&&o.e.IsNum(e[0].CaseCount)&&(s=parseInt(e[0].CaseCount.toString())),this.prodds.Columns[0].Contains("AllotedCases")&&o.e.IsNum(e[0].AllotedCases)&&(t=parseInt(e[0].AllotedCases.toString())),this.Parent.Billing.SelectedValue=s>=t||"10001"==e[0].CaseType.toString()&&this.prodds.Columns[0].Contains("MonthCases")&&""!=e[0].MonthCases.toString()&&parseFloat(e[0].MonthCases.toString())>0?"139":"138"}if(this.prodds.Tables.length>1){let t=this.prodds.Tables[1].filter(t=>t.CostCenterID==e[0].Costcenterid.toString());t.length>0&&o.e.Int(t[0].PrefValue.toString())>5e4&&this.Parent.ScreenObject.CustomTab.Pages.forEach(s=>{s.Fields.forEach(s=>{s instanceof O.b&&s.CCID==parseInt(t[0].PrefValue.toString())&&""!=e[0]["dcCCNID"+(s.CCID-5e4)].toString()&&(s.SelectedValue=parseInt(e[0]["dcCCNID"+(s.CCID-5e4)].toString()))})})}if(this.prodds.Tables.length>2&&this.prodds.Columns[2].Contains("CostCenterIDLinked")&&this.prodds.Columns[2].Contains("DocumentLinkDefID")){let t=this.prodds.Tables[2].filter(t=>t.CostCenterIDLinked==e[0].Costcenterid.toString());if(t.length>0&&this.prodds.Columns[0].Contains("InvDocDetailsID")){let s=this.Parent.Casesmodel.GetDocDetails(t[0].DocumentLinkDefID.toString(),e[0].InvDocDetailsID.toString());if(null!=s&&s.Tables.length>1&&s.Tables[1].length>0)for(let e=0;e<s.Tables[0].length;e++){let t="",i=s.Tables[0][e].BASECOL.toString();s.Columns[1].Contains(s.Tables[0][e].LINKCOL.toString())&&(t=s.Tables[1][0][s.Tables[0][e].LINKCOL.toString()].toString());let a=!1;if(this.Parent.ScreenObject.CustomTab.Pages.forEach(e=>{e.Fields.forEach(e=>{e instanceof N.c&&e.DBColumnName.toLowerCase()==i.toLowerCase()&&(a=!0,this.FillValue(e,t))})}),!a)for(const e in this.Parent){let s=this.Parent[e];if(s instanceof N.c||s instanceof O.b||s instanceof S.a){let e=s;null==e&&(e=s),null!=e&&e instanceof N.c&&null!=e.DBColumnName&&e.DBColumnName.toLowerCase()==i.toLowerCase()&&(a=!0,this.FillValue(e,t))}}}}}}}}}else if(null!=this.Parent&&this.Customer.SelectedValue>0){this.Parent.Customer.SelectedValue=this.Customer.SelectedValue,this.Parent.Customer.SelectedValue>0&&(this.Parent.Customer.DBColumnName="AccountID",this.Parent.ScreenObject.OnGetReference(this.Parent.Customer));for(let e=0;e<this.Parent.ScreenObject.HeaderFields.length;e++)if(this.Parent.ScreenObject.HeaderFields[e]instanceof O.e){this.Parent.ScreenObject.HeaderFields[e].Customer.SelectedValue=this.Customer.SelectedValue,this.Parent.ScreenObject.HeaderFields[e].Customer.TypeID=this.Customer.TypeID,this.Parent.ScreenObject.HeaderFields[e].Customer.CCID=this.Customer.CCID,this.Parent.ScreenObject.HeaderFields[e].Customer.DBColumnName=this.Customer.DBColumnName,this.Parent.ScreenObject.HeaderFields[e].Customer.Label=this.Customer.Label,this.Parent.ScreenObject.HeaderFields[e].Customer.SelectedIndex=this.Customer.SelectedIndex,this.Parent.ScreenObject.HeaderFields[e].Customer.IsReadOnly=!0,this.Parent.ScreenObject.HeaderFields[e].Customer.IsEnabled=!1,this.Parent.ScreenObject.HeaderFields[e].Customer.RefreshData=!this.Parent.ScreenObject.HeaderFields[e].Customer.RefreshData,this.Parent.ScreenObject.HeaderFields[e].Customer.Text=this.Customer.Text;break}}if(null!=this.Parent&&0==this.Parent.Customer.SelectedValue)return this.DisplayMessage="Select Customer",void(this.MessageVisibility=!0);a.a.page.HideDialog()}else if("Filter"==e){this.GridDataObj.Clear();let e=this.GetQuery();if(null!=this.Parent){this.prodds=this.Parent.Casesmodel.SearchCases(this.Customer.SelectedValue,this.Contracts.SelectedValue,this.SerailNo.Text,this.Product.SelectedValue,this.Parent.CaseDate.Date,e),Logger.InfoLog("AddEditCaseViewModel:: AddEditCasesVieModel onSave, SearchCases");try{if(null!=this.prodds&&this.prodds.Tables.length>0&&this.prodds.Columns[0].Contains("ErrorMessage"))Logger.ErrorLog("AddEditCaseViewModel:: AddEditCasesVieModel onSave, error message ="+this.prodds.Tables[0][0].ErrorMessage.toString());else if(null!=this.prodds&&this.prodds.Tables.length>0&&!this.prodds.Columns[0].Contains("ErrorMessage")){Logger.InfoLog("AddEditCaseViewModel:: AddEditCasesVieModel onSave, sender=Filter, rowcount "+this.prodds.Tables[0].length);for(let e=0;e<this.prodds.Tables[0].length;e++){let t=this.GridDataObj.NewRow();t.Sno=(e+1).toString();for(let s=0;s<this.GridDataObj.TableColumns.length;s++)"SNO"!=this.GridDataObj.TableColumns[s]&&(this.GridDataObj.TableColumns[s].Contains("Date")?null!=this.prodds.Tables[0][e][this.GridDataObj.TableColumns[s]]&&(t[this.GridDataObj.TableColumns[s]]=new Date(this.prodds.Tables[0][e][this.GridDataObj.TableColumns[s]]).ToString(a.a.SessionManager.Preferences["Date Format"])):this.prodds.Columns[0].Contains(this.GridDataObj.TableColumns[s])&&(t[this.GridDataObj.TableColumns[s]]=this.prodds.Tables[0][e][this.GridDataObj.TableColumns[s]]));t.ProductID=this.prodds.Tables[0][e].ProductID,t.CustomerID=this.prodds.Tables[0][e].creditAccount,this.prodds.Columns[0].Contains("dcAlpha6")&&(t.SerialNo=this.prodds.Tables[0][e].dcAlpha6),t.Product=this.prodds.Tables[0][e].ProductName,t.Contract=this.prodds.Tables[0][e].VoucherNo,t.Customer=this.prodds.Tables[0][e].AccountName,t.DocID=this.prodds.Tables[0][e].DocID,this.GridDataObj.addRow(t)}}}catch(t){throw Logger.ErrorLog("AddEditCaseViewModel:: AddEditCasesVieModel onSave, sender=Filter ",t),t}}else if(null!=this.MParent){let e="Select BOMID,BOMCode,BOMName from PRD_BillOfMaterial  WITH(NOLOCK)";if(""!=this.BomName.Text&&(e+=" where BOMName like '%"+this.BomName.Text+"%'"),""!=this.BomCode.Text&&(e+=""!=this.BomName.Text?" and BOMCode like '%"+this.BomCode.Text+"%'":" where BOMCode like '%"+this.BomCode.Text+"%'"),this.prodds=a.a.report.DataSet("RPT022",e),null!=this.prodds&&this.prodds.Tables.length>0&&!this.prodds.Columns[0].Contains("ErrorMessage"))for(let t=0;t<this.prodds.Tables[0].length;t++){let e=this.GridDataObj.NewRow();e.Sno=(t+1).toString(),e.BomID=this.prodds.Tables[0][t].BOMID,e.Code=this.prodds.Tables[0][t].BOMCode,e.Name=this.prodds.Tables[0][t].BOMName,this.GridDataObj.addRow(e)}}}else"Close"==e&&(null!=this.Parent&&(this.Parent.Customer.CCID=2,this.Parent.Customer.TypeID=2,this.Parent.Customer.Refresh(),this.Parent.CustomerMode=1),a.a.page.HideDialog(),null!=this.Parent&&(this.Parent.isClose=!0));"AddEditCasesViewModel"==this.Parent.ClassName&&(2==this.Parent.Customer.CCID?this.Parent.ScreenObject.GetLinkReferenceData(27304,73,this.Parent.Customer.SelectedValue):83==this.Parent.Customer.CCID&&this.Parent.ScreenObject.GetLinkReferenceData(27303,73,this.Parent.Customer.SelectedValue))}GetQuery(){if(null==this.ProductFields||0==this.ProductFields.length)return"";let e="",t="";for(let s=0;s<this.ProductFields.length;s++){if(this.ProductFields[s].CC.Visible){if(!(this.ProductFields[s].CC.SelectedValue>0))continue;if(!this.ProductFields[s].IsColumnInuse)continue;t="="+this.ProductFields[s].CC.SelectedValue}else{if(null==this.ProductFields[s].FromValue.Text||""==this.ProductFields[s].FromValue.Text.Trim())continue;if(this.ProductFields[s].DataType.toUpperCase().Contains("DATE"))t=" ='"+this.ProductFields[s].FromValue.Text+"' ";else switch(this.ProductFields[s].Condition.SelectedValue){case"1":t=" ='"+this.ProductFields[s].FromValue.Text+"' ";break;case"2":t=" <>'"+this.ProductFields[s].FromValue.Text+"' ";break;case"3":t=" like '"+this.ProductFields[s].FromValue.Text+"%' ";break;case"4":t=" like '%"+this.ProductFields[s].FromValue.Text+"' ";break;case"5":t=" like '%"+this.ProductFields[s].FromValue.Text+"%' ";break;case"6":t=" not like '%"+this.ProductFields[s].FromValue.Text+"%' "}}"description"==this.ProductFields[s].ColumnName.toLowerCase()?e+=" p."+this.ProductFields[s].ColumnName+t+" and ":this.ProductFields[s].DataType.toLowerCase().Contains("date")?e+=" CONVERT(DATETIME,Cases."+this.ProductFields[s].ColumnName+")"+t+" and ":e+=this.ProductFields[s].ColumnName+t+" and "}return e.length>5?e.substring(1,e.length-4):""}FillValue(e,t){e instanceof O.b&&o.e.IsNum(t)?e.SelectedValue=parseInt(t):e instanceof b.d?e.Text=t:e instanceof D.e?e.SelectedValue=t:(e instanceof S.a&&o.e.isValidDate(t)||e instanceof S.c&&o.e.isValidDate(t))&&(e.Date=new Date(t))}}class j{constructor(e,t,s,i,n,l){this.IsColumnInuse=!1,this.IsColumnInuse=l,this.DataType=e,this.ColumnName=t,this.Header=s,this.Condition=new D.e(0),this.FromValue=new b.d(0),this.CC=new O.b(0);let r=o.e.Int(i);r>0?(this.CC.CCID=r,r=o.e.Int(n),this.CC.TypeID=r,this.CC.Visible=!0,this.Condition.Visible=!1,this.FromValue.Visible=!1):(this.CC.Visible=!1,this.Condition.Visible=!0,this.FromValue.Visible=!0),this.Condition.Label=a.a.GetResource("Reports_Condition"),this.FromValue.Label=a.a.GetResource("Reports_FromValue"),this.LoadConditions(this.DataType)}LoadConditions(e){this.Condition.Items.Clear(),this.Condition.Items.push(D.d.ComboBoxItems_2(a.a.GetResource("Com_Equals"),"1")),this.Condition.Items.push(D.d.ComboBoxItems_2(a.a.GetResource("Com_NotEquals"),"2")),this.Condition.Items.push(D.d.ComboBoxItems_2(a.a.GetResource("Com_BeginsWith"),"3")),this.Condition.Items.push(D.d.ComboBoxItems_2(a.a.GetResource("Com_EndsWith"),"4")),this.Condition.Items.push(D.d.ComboBoxItems_2(a.a.GetResource("Com_Contains"),"5")),this.Condition.Items.push(D.d.ComboBoxItems_2(a.a.GetResource("Com_NotContains"),"6")),this.Condition.SelectedValue="5"}}var w=s("/aGy"),R=s("THE7"),B=s("2Dtv"),A=s("sDFv"),F=s("ouML"),G=s("vgHJ"),v=s("Jnyl"),E=s("Huqd"),k=s("bwbx");class x extends l.b{constructor(e,t,s){if(super(),this._ContactVisibility=!1,this._DetailsVisibility=!1,this.ReportInfoVisibility=!0,this.EnableSearch=!0,this.ReportsList=[],this._CloseVisiblity=!1,this.ParentId=0,this.PrintVisible=!1,this.ButtonWaive=new u.a,this.RejectVisiblity=!1,this.btnHistoryVisible=!1,this.AutoActivity=!1,this.BtnApprove=new u.a,this.PrintViewVisible=!1,this.WFDocLevelList=[],this.dsLoad=null,this.CaseID=0,this.AssignVisiblity=!1,this.WaiveVisibility=!1,this.RetValue=0,this.ChangeVisible=!1,this.CName=new b.a(24234),this.CaseDate=new S.a(24233),this.Status=new D.e(24235),this.Customer=new O.b(24238),this.ContractLine=new D.e(24241),this.Product=new D.e(24240),this.Contract=new D.e(24239),this.ServiceLevel=new D.e(24243),this.Group=new O.b(24398),this.CaseType=new O.b(24397),this.CaseOrigin=new O.b(24237),this.CasePriority=new O.b(24236),this.Mode=new D.e(53516),this._CDate=Date.Today(),this.Billing=new D.e(25891),this.AssignedBy=new b.d(24246),this.User=new D.e(0),this.WaiveOffDate=new b.d(0),this.Comments=new b.d(0),this.AssignedDate=new b.d(24247),this.SerialNumber=new b.d(24242),this.CreatedDate=new b.d(24245),this.Owner=new b.d(24244),this.Subject=new b.d(27293),this.ReasonsObj=new V.a,this.NodeID=0,this.CostCenterID=0,this.DocumentType=0,this.Casesmodel=new f.a,this.ServiceDriven=!0,this.lstatusid="",this.AllowCreationofCase=!1,this.ActMandatory=!1,this.AutoAssign=!0,this.ColLists=new Array,this.CustomerMode=1,this.RefCCID=0,this.RefNodeID=0,this.isClose=!1,this.ActVisibility=!1,this.AttachmentVisibility=!1,this.NoteVisibility=!0,this.FeedbackVisibility=!1,this.prevstatus="",this.AssignStatus="",this.CloseStatus="",this.ErrorMessage="Missing Report Parameter ' ",this.dvContractProducts=null,this.dvServiceTypes=null,this.dvTechnicians=null,this.dvTechnicianData=null,this.ClassName="AddEditCasesViewModel",this.ParentId=t,this.Group.SelectionChangedCommand.Subscribe(this,"OnGroupSelectionChanged"),this.Status.SelectionChangedCommand.Subscribe(this,"onStatusChanged"),this.Customer.OnChangeCase=new N.b,this.Customer.OnChangeCase.Subscribe(this,"OnSave"),this.Customer.CCID=2,this.Customer.TypeID=2,this.CostCenterID=73,this.NodeID=e,this.CaseID=e,this.CaseID=e,this.ViewAssignHistroy=new C.a(this),this.ProductGrid=new d.a(this,73),this.ViewFeedback=new c.a(this),this.ViewNotes=new I.a(this),this.ViewAttachments=new y.ViewAttachmentViewModel(this),this.ViewActivities=new p.b(this),this.Activities=new g.a(this,!1),this.ViewContacts=new R.a(this),this.ViewActivities.Activities=this.Activities,this.ScreenObject=new P.a,this.ScreenObject.LoadScreen_2(this,73),this.AddCustomer(),this.Customer.OnPactListBoxValueChanged.Subscribe(this.ScreenObject,"OnGetReference"),this.ChangeVisible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Change Customer"),null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>7&&this.ScreenObject.Data.Columns[7].Contains("IsParentCodeInherited")&&this.ScreenObject.Data.Tables[7].length>0){this.ScreenObject.InitAutoCode(this.ScreenObject.Data.Tables[7],this.Casesmodel.IsGroup);let e=this.ScreenObject.Data.Tables[4].filter(e=>"DefaultAssignStatus"==e.Name);e.length>0&&(this.AssignStatus=e[0].Value.toString()),e=this.ScreenObject.Data.Tables[4].filter(e=>"DefaultCloseStatus"==e.Name),e.length>0&&(this.CloseStatus=e[0].Value.toString())}this.Mode.Items.push(D.d.ComboBoxItems_2("Manual","Manual")),this.Mode.Items.push(D.d.ComboBoxItems_2("PM","PM")),this.Mode.SelectedValue="Manual",this.Customer.CCID=2,this.ButtonEmail=new u.a,this.ButtonSave=new u.a,this.ButtonClose=new u.a,this.ButtonAssign=new u.a,a.a.SessionManager.HideUnathorizedAccess?this.ButtonAssign.Visible=a.a.SessionManager.IsActionAssigned(73,"Assign"):this.ButtonAssign.Enable=a.a.SessionManager.IsActionAssigned(73,"Assign"),this.ChangeVisible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Change Customer"),e>0?(this.DisplayName=a.a.GetResource("CRMCase_EditCase"),this.PrintVisible=!0,this.PrintViewVisible=!0,a.a.SessionManager.HideUnathorizedAccess?this.ButtonWaive.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Waive Off"):this.ButtonWaive.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Waive Off"),a.a.SessionManager.HideUnathorizedAccess?this.ButtonEmail.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Email"):this.ButtonEmail.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Email")):(this.DisplayName=a.a.GetResource("CRMCase_AddCase"),this.ButtonWaive.Visible=!1,this.ButtonEmail.Visible=!1),this.Title=this.DisplayName,this.BtnApprove.Visible=!1,this.AssignedBy.Enable=!1,this.CaseID=e,this.Casesmodel.SelectedNodeID=this.ParentId,this.dsLoad=this.Casesmodel.GetCaseScreenDetails(this.CaseID);let i,l=this.ScreenObject.Data.Tables[4].filter(e=>"ServiceDriven"==e.Name);if(this.ServiceDriven=!(l.length>0&&""!=o.e.String(l[0].Value))||Object(n.j)(l[0].Value),null!=this.ScreenObject.HeaderFields&&this.ScreenObject.HeaderFields.length>0){this.ScreenObject.HeaderFields[0].Visible=this.ServiceDriven,this.ScreenObject.HeaderFields[0].Row=3,this.ScreenObject.HeaderFields[0].ColumnSpan=4;let e=this.ScreenObject.HeaderFields[0];this.ScreenObject.HeaderFields=this.ScreenObject.HeaderFields.slice(1),this.ScreenObject.HeaderFields.InsertAt(e,this.ScreenObject.HeaderFields.length+1)}l=this.ScreenObject.Data.Tables[4].filter(e=>"AutoAssign"==e.Name),this.AutoAssign=!(l.length>0&&""!=o.e.String(l[0].Value)&&Object(n.j)(l[0].Value)),l=this.ScreenObject.Data.Tables[4].filter(e=>"AllowCreationofCase"==e.Name),this.AllowCreationofCase=l.length>0&&""!=l[0].Value.toString()&&Object(n.j)(l[0].Value),this.AllowCreationofCase&&(l=this.ScreenObject.Data.Tables[4].filter(e=>"StatusDuplicateCreationofCases"==e.Name),l.length>0&&""!=l[0].Value.toString()&&(this.lstatusid=l[0].Value.toString())),l=this.ScreenObject.Data.Tables[4].filter(e=>"Activitymandatorywhilecreatingcase"==e.Name),this.ActMandatory=l.length>0&&""!=l[0].Value.toString()&&Object(n.j)(l[0].Value),i=this.ScreenObject.Data.Tables[4].filter(e=>"AutoActivity"==e.Name),i.length>0&&!o.e.IsEmpty(i[0].Value)&&(this.AutoActivity=Object(n.j)(i[0].Value)),i=this.ScreenObject.Data.Tables[4].filter(e=>"EnableSearch"==e.Name),i.length>0&&""!=i[0].Value.toString()&&(this.EnableSearch=Object(n.j)(i[0].Value)),0==e&&this.ScreenObject.SetAutoCode(this.CName,this.Casesmodel.IsGroup,this.ParentId,this.ScreenObject.Data.Tables[7]),this.ScreenObject.Data.Tables[5].forEach(e=>{(!o.e.hasprop(e,"IsVisible")||o.e.IsEmpty(e.IsVisible)||Object(n.j)(e.IsVisible))&&this.Status.Items.push(D.d.ComboBoxItems_2(e.Name.toString(),e.NodeID.toString())),o.e.hasprop(e,"IsDefault")&&!o.e.IsEmpty(e.IsDefault)&&Object(n.j)(e.IsDefault)&&(this.Status.SelectedValue=e.NodeID.toString())}),this.ScreenObject.Data.Tables[6].forEach(e=>{this.Billing.Items.push(D.d.ComboBoxItems_2(e.Name.toString(),e.NodeID.toString()))}),this.OnLoad(),this.AddGridColumns(),this.ScreenObject.StaticFields.sort((e,t)=>e.Row>t.Row||e.Row==t.Row&&e.Column>t.Column?1:-1),this.ScreenObject.HeaderFields.sort((e,t)=>e.Row>t.Row||e.Row==t.Row&&e.Column>t.Column?1:-1),0==this.CaseID&&this.EnableSearch?(this.CaseSearch=new L,this.CaseSearch.CaseSearchViewModel_2(this),a.a.page.ShowDialog(this.CaseSearch,w.a,{ShowCenter:!0,Title:"Search"})):this.CaseID>0?(this.Casesmodel.CaseID=this.CaseID,this.LoadData(),this.Status.SelectedValue!=this.CloseStatus&&"1001"!=this.Status.SelectedValue&&"1002"!=this.Status.SelectedValue&&"1003"!=this.Status.SelectedValue?a.a.SessionManager.HideUnathorizedAccess?this.ButtonClose.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Close"):this.ButtonClose.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Close"):(this.ButtonClose.Visible=!1,this.Status.Enable=!1)):(i=this.ScreenObject.Data.Tables[4].filter(e=>"DefaultModeSelection"==e.Name),i.length>0&&""!=i[0].Value.toString()?(this.CustomerMode=parseInt(i[0].Value.toString()),2==this.CustomerMode?(this.Customer.CCID=83,this.Customer.TypeID=1,this.Customer.DBColumnName="CustomerID"):(this.Customer.CCID=2,this.Customer.TypeID=2,this.Customer.DBColumnName="AccountID")):(this.Customer.CCID=83,this.CustomerMode=2,this.Customer.TypeID=1,this.Customer.DBColumnName="CustomerID"),this.Customer.Refresh()),null!=this.ScreenObject.CustomTab.SelectedTab&&this.onTabSelectionChanged(this.ScreenObject.CustomTab.SelectedTab),this.ReportView(),this.setVisibilityoff(),this.ReportInfoVisibility=!0}get ContactVisibility(){return this._CloseVisiblity}set ContactVisibility(e){e!=this._ContactVisibility&&(this._ContactVisibility=e,this._ContactVisibility&&(this.PrintVisible=!1,this.DetailsVisibility=!1,this.FeedbackVisibility=!1))}get DetailsVisibility(){return this._DetailsVisibility}set DetailsVisibility(e){e!=this._DetailsVisibility&&(this._DetailsVisibility=e,this._DetailsVisibility&&(this.NoteVisibility=!1,this.AttachmentVisibility=!1))}get CloseVisiblity(){return this._CloseVisiblity}set CloseVisiblity(e){e!=this._CloseVisiblity&&(this._CloseVisiblity=e,this._CloseVisiblity&&(this.ContactVisibility=!1,this.NoteVisibility=!1,this.AttachmentVisibility=!1,this.ActVisibility=!1,this.ContactVisibility=!1,this.FeedbackVisibility=!1,this.WaiveVisibility=!1))}get Contact(){return this._Contact}set Contact(e){e!=this._Contact&&(this._Contact=e)}get CDate(){return this._CDate}set CDate(e){e!=this._CDate&&(this._CDate=e,this.CaseDate.Date=e,this.CheckIsBillable(),this.onDateChanged(this.CDate),this.CreatedDate.Text=this.AssignedDate.Text=this.CaseDate.Text)}get Reasons(){return this.ReasonsObj.Table}OnAddAttachment(){this.Attachment=new T.AddAttachmentViewModel,this.Attachment.AddAttachmentViewModel_2(this)}ReportView(){this.ReportDimension=new O.b(0),this.ReportDimension.CCID=this.CostCenterID,this.ReportDimension.TypeID=1,this.ReportDimension.SelectedValue=this.CaseID,this.ReportsList=[],this.ReportDimension.OnPactListBoxValueChanged.Subscribe(this,"OnReportsLinkClick");let e=[];null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>8&&this.ScreenObject.Data.Tables[8].forEach(t=>{let s=new u.a;s.DBColumnID=parseInt(t.ReportID),s.Label=t.ReportName.toString(),this.ScreenObject.Data.Columns[8].Contains("Shortcut")&&(s.KeyTip=t.Shortcut.toString()),this.ScreenObject.Data.Columns[8].Contains("DisplayAsPopup")&&""!=t.DisplayAsPopup.toString()&&(s.Dependantinuse="1"==t.DisplayAsPopup.toString()),this.ScreenObject.Data.Columns[8].Contains("Width")&&""!=t.Width.toString()&&(s.Width=t.Width.toString()),this.ScreenObject.Data.Columns[8].Contains("Height")&&""!=t.Height.toString()&&(s.Length=t.Height.toString()),this.ScreenObject.Data.Columns[8].Contains("DocumentField")&&""!=t.DocumentField.toString()&&(s.Formula=t.DocumentField.toString()),this.ScreenObject.Data.Columns[8].Contains("mapxml")&&""!=t.mapxml.toString()&&(s.ToolTipDescription=t.mapxml.toString()),e.Contains(parseInt(t.ReportID))||(e.push(parseInt(t.ReportID)),this.ReportsList.push(s))})}OnReportsLinkClick(e){return Object(i.b)(this,void 0,void 0,(function*(){const{ReportViewModel:t}=yield Promise.all([s.e(2),s.e(1),s.e(3),s.e(5),s.e(4),s.e(6),s.e(7),s.e(10),s.e(9),s.e(8),s.e(12),s.e(11),s.e(13),s.e(19),s.e(15),s.e(21),s.e(20),s.e(16),s.e(14),s.e(18),s.e(17),s.e(22),s.e(23),s.e(24),s.e(25),s.e(28),s.e(30),s.e(29),s.e(32),s.e(31),s.e(27),s.e(26),s.e(35),s.e(37),s.e(38),s.e(36),s.e(33),s.e(34),s.e(39),s.e(40),s.e(41),s.e(212)]).then(s.bind(null,"ThYU")),{ReportViewComponent:i}=yield Promise.all([s.e(32),s.e(37)]).then(s.bind(null,"YU11"));let n,l={strXML:""},r=new t;if(this.ReportDimension.SelectedValue=this.CaseID,this.DisplayMessage=this.GetReportFilterXML(e,l),n=l.strXML,0==this.DisplayMessage.length){var d=this.ReportsList.find(t=>t.DBColumnID==parseInt(e)).FirstOrDefault();if(null!=d&&d.Dependantinuse)r.ReportViewModel_Document(this.CostCenterID,n,parseInt(e),!0,null,null),!o.e.IsEmpty(d.Width)&&parseFloat(d.Width)>0&&(r.RptWidth=parseFloat(d.Width)),!o.e.IsEmpty(d.length)&&parseFloat(d.length)>0&&(r.RptHeight=parseFloat(d.length)),r.DocumentObject=this,a.a.page.HideDialog(),a.a.page.ShowDialog(r,i,{Title:"",HideClose:!0,ShowCenter:!0});else{let s=new t;s.ReportViewModel_Document(this.CostCenterID,n,parseInt(e),!1,null,null),s.DocumentObject=this,a.a.page.HideDialog(),a.a.page.addNewTab({component:i,params:{obj:s}})}}}))}GetReportFilterXML(e,t){let s="";t.strXML="";let i=this.ScreenObject.Data.Tables[8];i=i.filter(t=>t.ReportID==e);let a,o=!1;i.forEach(e=>{Object(n.j)(e.GroupLevel)&&(o=!0)}),s+="<XML",o&&(s+=' GroupLevel="1"'),s+=" >";for(let n=0;n<i.length;n++){a=i[n].ReportField.toString(),s+="<Row ",s+='ColID ="'+a+'" ';for(let e=0;e<this.ScreenObject.HeaderFields.length;e++)if(this.ScreenObject.HeaderFields[e].DBColumnID==parseInt(i[n].DocumentField.toString()))if(this.ScreenObject.HeaderFields[e]instanceof O.e){if(""==this.Customer.Text)return alert(this.ErrorMessage+this.Customer.Label+" '"),"Empty Value";s+='Value ="'+this.Customer.SelectedValue+'" '}else if(this.ScreenObject.HeaderFields[e]instanceof b.d){if(""==this.ScreenObject.HeaderFields[e].Text)return alert(this.ErrorMessage+this.ScreenObject.HeaderFields[e].Label+" '"),"Empty Value";"SNO"==i[n].SysColumnName.toString()?s+='Value ="'+this.ReportDimension.SelectedValue+'" ':s+='Value ="'+this.ScreenObject.HeaderFields[e].Text+'" '}else if(this.ScreenObject.HeaderFields[e]instanceof v.a){if(""==this.ScreenObject.HeaderFields[e].TextBox.Text||""==this.ScreenObject.HeaderFields[e].ComboBox.SelectedValue)return alert(this.ErrorMessage+this.ScreenObject.HeaderFields[e].Label+" '"),"Empty Value";s+='Value ="'+this.ScreenObject.HeaderFields[e].ComboBox.SelectedValue+'" '}else if(this.ScreenObject.HeaderFields[e]instanceof b.c){if(""==this.ScreenObject.HeaderFields[e].Text)return alert(this.ErrorMessage+this.ScreenObject.HeaderFields[e].Label+" '"),"Empty Value";s+='Value ="'+this.ScreenObject.HeaderFields[e].Text+'" '}else if(this.ScreenObject.HeaderFields[e]instanceof S.a||this.ScreenObject.HeaderFields[e]instanceof S.d||this.ScreenObject.HeaderFields[e]instanceof S.c){if(this.ScreenObject.HeaderFields[e]instanceof S.a||this.ScreenObject.HeaderFields[e]instanceof S.d){if(""==this.ScreenObject.HeaderFields[e].Text)return alert(this.ErrorMessage+this.ScreenObject.HeaderFields[e].Label+" '"),"Empty Value";s+='Value ="'+this.ScreenObject.HeaderFields[e].Date.ToString("dd/MMM/yyyy")+'" '}else if(this.ScreenObject.HeaderFields[e]instanceof S.c){if(!this.ScreenObject.HeaderFields[e].Date)return alert(this.ErrorMessage+this.ScreenObject.HeaderFields[e].Label+" '"),"Empty Value";s+='Value ="'+this.ScreenObject.HeaderFields[e].Date.ToString("dd/MMM/yyyy")+'" '}}else if(this.ScreenObject.HeaderFields[e]instanceof O.b){if(""==this.ScreenObject.HeaderFields[e].Text)return alert(this.ErrorMessage+this.ScreenObject.HeaderFields[e].Label+" '"),"Empty Value";s+='Value ="'+this.ScreenObject.HeaderFields[e].SelectedValue+'" '}else if(this.ScreenObject.HeaderFields[e]instanceof E.a){if(""==this.ScreenObject.HeaderFields[e].Text)return alert(this.ErrorMessage+this.ScreenObject.HeaderFields[e].Label+" '"),"Empty Value";s+='Value ="'+this.ScreenObject.HeaderFields[e].SelectedValue+'" '}this.ScreenObject.CustomTab.Pages.forEach(e=>{e.Fields.forEach(e=>{if(null!=e&&(e instanceof b.d||e instanceof v.a||e instanceof b.c||e instanceof S.a||e instanceof S.d||e instanceof S.c||e instanceof O.b||e instanceof E.a)&&e.DBColumnID==parseInt(i[n].DocumentField.toString()))if(e instanceof b.d){if(""==e.Text)return alert(this.ErrorMessage+e.Label+" '"),"Empty Value";s+='Value ="'+e.Text+'" '}else if(e instanceof v.a){if(""==e.TextBox.Text||""==e.ComboBox.SelectedValue)return alert(this.ErrorMessage+e.Label+" '"),"Empty Value";s+='Value ="'+e.TextBox.Text+'" '}else if(e instanceof b.c){if(""==e.Text)return alert(this.ErrorMessage+e.Label+" '"),"Empty Value";s+='Value ="'+e.Text+'" '}else if(e instanceof S.a||e instanceof S.d||e instanceof S.c){if(e||e){if(""==e.Text)return alert(this.ErrorMessage+e.Label+" '"),"Empty Value";s+='Value ="'+e.Date.ToString("dd/MMM/yyyy")+'" '}else if(e instanceof S.c){if(!e.Date)return alert(this.ErrorMessage+e.Label+" '"),"Empty Value";s+='Value ="'+e.Date.ToString("dd/MMM/yyyy")+'" '}}else if(e instanceof O.b){if(""==e.Text&&0==e.SelectedValue)return alert(this.ErrorMessage+e.Label+" '"),"Empty Value";s+='Value ="'+e.SelectedValue+'" '}else if(e instanceof E.a){if(""==e.Text)return alert(this.ErrorMessage+e.Label+" '"),"Empty Value";s+='Value ="'+e.SelectedValue+'" '}})}),s+=" />"}return s+="</XML>",t.strXML=s.toString(),""}OnShowContact(){}OnAddContact(){}AddCustomer(){this.ScreenObject.HeaderFields.Remove(this.Customer);let e=new O.e;e.SectionSeqNo=this.Customer.SectionSeqNo,e.Row=this.Customer.Row,e.Column=this.Customer.Column,e.ColumnSpan=this.Customer.ColumnSpan,e.DBColumnID=this.Customer.DBColumnID,this.ScreenObject.HeaderFields.push(e),this.ReportInfoVisibility=!1}onStatusChanged(e){return this.Status.SelectedValue==this.CloseStatus?(this.DisplayMessage="Use close process",void(this.Status.SelectedValue=this.prevstatus)):this.Status.SelectedValue==this.AssignStatus?(this.DisplayMessage="Use assign process",void(this.Status.SelectedValue=this.prevstatus)):void(this.prevstatus=this.Status.SelectedValue)}OnContractLineChange(e){if(Logger.InfoLog("AddEditCaseViewModel:: OnContractLineChange Begin"),null!=this.ContractLine&&this.ContractLine.Items.length>0&&"0"!=this.ContractLine.SelectedValue&&null!=this.dsetContract&&this.dsetContract.length>0){let e=this.dsetContract.filter(e=>e.ContractLineID==this.ContractLine.SelectedValue);e.length>0&&(this.Product.SelectedValue=e[0].ProductID.toString(),this.SerialNumber.Text=e[0].SerialNumber.toString(),this.CheckWarranty())}Logger.InfoLog("AddEditCaseViewModel:: OnContractLineChange End")}OnSerialNo_LostFoucs(e){this.CheckWarranty()}CheckWarranty(){}OnLoad(){this.AssignRowColumns();for(let e=this.ScreenObject.CustomTab.Pages.length-1;e>=0;e--){let t=this.ScreenObject.CustomTab.Pages[e];switch(t.Name){case"Contacts":t.Fields.push(this.ViewContacts);break;case"Products":t.Fields.push(this.ProductGrid);break;case"Activities":t.Fields.push(this.ViewActivities);break;case"History":t.Fields.push(this.ViewAssignHistroy.ListObj);break;case"Notes":t.Fields.push(this.ViewNotes);break;case"Attachments":t.Fields.push(this.ViewAttachments);break;case"Follow Up":t.Fields.push(this.ViewFeedback)}}}AssignRowColumns(){let e=this.ScreenObject.CustomFields.length;for(let t=0;t<e;t++)this.ScreenObject.CustomFields[t].Row=t/4,this.ScreenObject.CustomFields[t].Column=t%4}AddActivity(){null!=this.Activities.CRMCustomer&&(this.Activities.CRMCustomer.Text=this.Customer.Text),0!=this.CustomerMode&&(null!=this.Activities.CRMCustomer&&(this.Activities.CRMCustomer.Code.CCID=this.Customer.CCID,this.Activities.CRMCustomer.Code.TypeID=this.Customer.TypeID),this.Activities.CRMCustomer.Text=this.Customer.Text,this.Activities.CRMCustomer.Code.SelectedValue=this.Customer.SelectedValue,this.Activities.onCustomerSelectionChange("Customer")),null!=this.Activities.Location&&(this.Activities.Location.Text=a.a.SessionManager.LocationName)}onTabSelectionChanged(e){null!=this.ScreenObject.CustomTab.SelectedTab&&("Activities"==this.ScreenObject.CustomTab.SelectedTab.Name?(this.ScreenObject.CustomTab.ColumnSpan=4,this.setVisibilityoff(),this.Activities.IsPopup||(this.ActVisibility=!0),this.AddActivity(),this.Activities.Location.Enable=!1,this.Activities.AssignVisiblity=!1,this.Activities.CRMCustomer.Enable=!1):"Notes"==this.ScreenObject.CustomTab.SelectedTab.Name?(this.ViewNotes.OnShowNewNote(null),this.setVisibilityoff(),this.NoteVisibility=!0):"Contacts"==this.ScreenObject.CustomTab.SelectedTab.Name?(this.ScreenObject.CustomTab.ColumnSpan=4,this.setVisibilityoff(),this.ContactVisibility=!0,this.ViewContacts.OnShowNewContact(null)):"Attachments"==this.ScreenObject.CustomTab.SelectedTab.Name?(this.setVisibilityoff(),this.ViewAttachments.ButtonAdd.Enable&&this.ViewAttachments.ButtonAdd.Visible&&(this.ViewAttachments.OnShowNewAttachment(null),this.AttachmentVisibility=!0)):"Follow Up"==this.ScreenObject.CustomTab.SelectedTab.Name?(this.ScreenObject.CustomTab.ColumnSpan=4,this.Feedback=new h.a(this.ViewFeedback),this.setVisibilityoff()):this.setVisibilityoff())}LoadData(){if(this.RefCCID=0,this.RefNodeID=0,(this.ScreenObject.InheritParentCode||this.ScreenObject.IsAutoCode)&&(this.CName.Enable=!1),this.dsLoad.Tables.length>4&&this.dsLoad.Tables[4].length>0){if(this.Casesmodel.GUID=this.dsLoad.Tables[4][0].GUID.toString(),this.dsLoad.Columns[4].Contains("RefCCID")&&""!=this.dsLoad.Tables[4][0].RefCCID.toString()&&(this.RefCCID=parseInt(this.dsLoad.Tables[4][0].RefCCID.toString())),this.dsLoad.Columns[4].Contains("RefNodeID")&&""!=this.dsLoad.Tables[4][0].RefNodeID.toString()&&(this.RefNodeID=parseInt(this.dsLoad.Tables[4][0].RefNodeID.toString())),this.CName.PrefixVisibility=!1,this.CName.SuffixVisibility=!1,this.CDate=new Date(this.dsLoad.Tables[4][0].CDAte),this.CName.Text=this.dsLoad.Tables[4][0].CaseNumber.toString(),null!=this.dsLoad.Tables[4][0].StatusID.toString()&&""!=this.dsLoad.Tables[4][0].StatusID.toString()&&(this.ScreenObject.Data.Tables[5].forEach(e=>{"1001"!=this.dsLoad.Tables[4][0].StatusID.toString()&&"1002"!=this.dsLoad.Tables[4][0].StatusID.toString()&&"1003"!=this.dsLoad.Tables[4][0].StatusID.toString()||!e.Table.Columns.Contains("IsVisible")||""==e.IsVisible.toString()||Object(n.j)(e.IsVisible)||this.Status.Items.push(D.d.ComboBoxItems_2(e.Name.toString(),e.NodeID.toString()))}),this.Status.SelectedValue=this.dsLoad.Tables[4][0].StatusID.toString(),this.prevstatus=this.Status.SelectedValue),null!=this.Status.SelectedValue&&""!=this.Status.SelectedValue&&this.Status.SelectedValue==this.CloseStatus&&(a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Allow Edit For Close Tickets")||(this.ButtonSave.Enable=!1,this.DisplayMessage="Case is closed cannot be edited")),this.Group.SelectedValue=parseInt(this.dsLoad.Tables[4][0].ParentID),this.dsLoad.Columns[4].Contains("CustomerMode")&&null!=this.dsLoad.Tables[4][0].CustomerMode.toString()&&""!=this.dsLoad.Tables[4][0].CustomerMode.toString()?(this.CustomerMode=""!=this.dsLoad.Tables[4][0].CustomerMode.toString()&&"0"!=this.dsLoad.Tables[4][0].CustomerMode.toString()?parseInt(this.dsLoad.Tables[4][0].CustomerMode):1,1==this.CustomerMode?(this.Customer.CCID=2,this.Customer.TypeID=2,this.Customer.Refresh(),this.Customer.DBColumnName="AccountID"):2==this.CustomerMode&&(this.Customer.CCID=83,this.Customer.TypeID=1,this.Customer.Refresh(),this.Customer.DBColumnName="CustomerID")):(this.Customer.CCID=2,this.Customer.TypeID=2,this.Customer.Refresh(),this.Customer.DBColumnName="AccountID"),null!=this.dsLoad.Tables[4][0].CustomerID.toString()&&""!=this.dsLoad.Tables[4][0].CustomerID.toString()&&(this.Customer.SelectedValue=parseInt(this.dsLoad.Tables[4][0].CustomerID)),this.Customer.SelectedValue>0&&this.ScreenObject.OnGetReference(this.Customer),o.e.IsEmpty(this.dsLoad.Tables[4][0].SerialNumber)||(this.SerialNumber.Text=this.dsLoad.Tables[4][0].SerialNumber.toString()),o.e.IsEmpty(this.dsLoad.Tables[4][0].SvcContractID)||(this.Contract.Items.push(D.d.ComboBoxItems_2(o.e.StringValue(this.dsLoad.Tables[4][0].VoucherNo),this.dsLoad.Tables[4][0].SvcContractID.toString())),this.Contract.SelectedValue=this.dsLoad.Tables[4][0].SvcContractID.toString()),o.e.IsEmpty(this.dsLoad.Tables[4][0].ContractLineID)||null!=this.ContractLine&&(this.ContractLine.SelectedValue=this.dsLoad.Tables[4][0].ContractLineID.toString()),o.e.IsEmpty(this.dsLoad.Tables[4][0].CaseTypeLookupID)||(this.CaseType.SelectedValue=this.dsLoad.Tables[4][0].CaseTypeLookupID.toString()),o.e.IsEmpty(this.dsLoad.Tables[4][0].ProductID)||(this.Product.Items.push(D.d.ComboBoxItems_2(this.dsLoad.Tables[4][0].ProductName.toString(),this.dsLoad.Tables[4][0].ProductID.toString())),this.Product.SelectedValue=this.dsLoad.Tables[4][0].ProductID.toString()),o.e.IsEmpty(this.dsLoad.Tables[4][0].CaseOriginLookupID)||(this.CaseOrigin.SelectedValue=this.dsLoad.Tables[4][0].CaseOriginLookupID.toString()),null!=this.dsLoad.Tables[4][0].BillingMethod.toString()&&""!=this.dsLoad.Tables[4][0].BillingMethod.toString()&&(this.Billing.SelectedValue=this.dsLoad.Tables[4][0].BillingMethod.toString()),"140"==this.Billing.SelectedValue&&(this.Casesmodel.User=parseInt(this.dsLoad.Tables[4][0].WaiveBy),o.e.isValidDate(this.dsLoad.Tables[4][0].WaiveDate1)&&(this.Casesmodel.WaveDate=new Date(this.dsLoad.Tables[4][0].WaiveDate1)),this.Casesmodel.Comments=this.dsLoad.Tables[4][0].Comments.toString()),o.e.IsEmpty(this.dsLoad.Tables[4][0].Mode)||(this.Mode.SelectedValue=this.dsLoad.Tables[4][0].Mode.toString()),o.e.IsEmpty(this.dsLoad.Tables[4][0].ServiceLvlLookupID.toString())||(this.ServiceLevel.SelectedValue=this.dsLoad.Tables[4][0].ServiceLvlLookupID),o.e.IsEmpty(this.dsLoad.Tables[4][0].CreatedBy)||(this.Owner.Text=this.dsLoad.Tables[4][0].CreatedBy.toString()),o.e.IsEmpty(this.dsLoad.Tables[4][0].CreatedDate1)||(this.CreatedDate.Text=new Date(this.dsLoad.Tables[4][0].CreatedDate1.toString()).ToString(a.a.SessionManager.Preferences["Date Format"].toString())),o.e.IsEmpty(this.dsLoad.Tables[4][0].Subject)||(this.Subject.Text=this.dsLoad.Tables[4][0].Subject.toString()),o.e.IsEmpty(this.dsLoad.Tables[4][0].AssignedUser)||(this.AssignedBy.Text=this.dsLoad.Tables[4][0].AssignedUser.toString()),o.e.IsEmpty(this.dsLoad.Tables[4][0].ADate)||(this.AssignedDate.Text=new Date(this.dsLoad.Tables[4][0].ADate.toString()).ToString(a.a.SessionManager.Preferences["Date Format"].toString())),this.dsLoad.Tables.length>5&&this.dsLoad.Tables[5].length>0)for(let e=0;e<this.dsLoad.Tables[5].length;e++){let t=this.ReasonsObj.NewRow();t.ServiceTypeID=this.dsLoad.Tables[5][e].ServiceTypeID.toString(),t.ServiceReasonID=this.dsLoad.Tables[5][e].ServiceReasonID.toString(),t.ServiceReasonID_Key=this.dsLoad.Tables[5][e].Reason.toString(),t.VoiceOfCustomer=this.dsLoad.Tables[5][e].VoiceOfCustomer.toString(),t.NODEID=this.dsLoad.Tables[5][e].Techincian.toString(),t.NODEID_Key=this.dsLoad.Tables[5][e].NODEID_Key.toString(),t.TechComments=this.dsLoad.Tables[5][e].TechinicianComments.toString(),this.ReasonsObj.addRow(t)}if(null!=this.dsLoad&&this.dsLoad.Tables.length>6&&this.dsLoad.Tables[6].length>0&&this.ScreenObject.LoadCustomFieldsData(this.dsLoad.Tables[6]),this.ViewAssignHistroy.LoadHistroy_1(73,this.Casesmodel.CaseID),null!=this.dsLoad&&this.dsLoad.Tables.length>7&&this.dsLoad.Tables[7].length>0&&this.ViewActivities.LoadActivityData(this.dsLoad.Tables[7]),null!=this.dsLoad&&this.dsLoad.Tables.length>8&&this.dsLoad.Tables[8].length>0&&this.ScreenObject.LoadCustomFieldsCCData(this.dsLoad.Tables[8]),null!=this.dsLoad&&this.dsLoad.Tables.length>9&&this.dsLoad.Tables[9].length>0&&this.ProductGrid.LoadProductData(this.dsLoad.Tables[9],this.dsLoad.Columns[9]),null!=this.dsLoad&&this.dsLoad.Tables.length>10&&this.dsLoad.Tables[10].length>0&&this.ViewNotes.LoadNotes(this.dsLoad.Tables[10]),null!=this.dsLoad&&this.dsLoad.Tables.length>11&&this.dsLoad.Tables[11].length>0&&this.ViewAttachments.LoadAttachments(this.dsLoad.Tables[11]),null!=this.dsLoad&&this.dsLoad.Tables.length>12&&this.dsLoad.Tables[12].length>0&&this.ViewFeedback.LoadData(this.dsLoad.Tables[12]),null!=this.dsLoad&&this.dsLoad.Tables.length>13&&this.dsLoad.Tables[13].length>0&&this.ViewContacts.LoadContacts_1(this.dsLoad.Tables[13]),a.a.SessionManager.IsWebApplication||this.LoadReport(),this.dsLoad.Columns[4].Contains("WorkFlowID")&&this.dsLoad.Tables[4].length>0&&null!=this.dsLoad.Tables[4][0].WorkFlowID&&parseInt(this.dsLoad.Tables[4][0].WorkFlowID.toString())>0&&(this.Casesmodel.Wid=parseInt(this.dsLoad.Tables[4][0].WorkFlowID.toString()),this.btnHistoryVisible=!0,""!=this.dsLoad.Tables[4][0].canApprove.toString()&&Object(n.j)(this.dsLoad.Tables[4][0].canApprove.toString())&&(this.BtnApprove.Visible=!0,this.ButtonSave.Enable=!1),""!=this.dsLoad.Tables[4][0].canEdit.toString()&&Object(n.j)(this.dsLoad.Tables[4][0].canEdit.toString())&&(this.ButtonSave.Enable=!!a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Approved Contracts")),"1002"!=this.Status.SelectedValue&&"1001"!=this.Status.SelectedValue&&"1003"!=this.Status.SelectedValue||(this.PrintVisible=!1,this.PrintViewVisible=!1,this.ButtonAssign.Visible=!1,this.ButtonClose.Visible=!1,this.ButtonEmail.Visible=!1,this.ButtonWaive.Visible=!1,this.Status.IsReadOnly=!0),this.dsLoad.Tables.length>14&&this.dsLoad.Columns[14].Contains("WorkFlowLevel"))){let e,t;e=this.dsLoad.Tables[15],t=this.dsLoad.Tables[14];let s,i=0;""!=this.dsLoad.Tables[4][0].WorkFlowLevel.toString()&&(i=parseInt(this.dsLoad.Tables[4][0].WorkFlowLevel.toString())),t.length>0&&(s=parseInt(t[t.length-1].StatusID));let o=t.length>0?parseInt(t[0].WorkFlowLevel)-1:0;for(let a=0;a<e.length;a++){let t=new A.a(parseInt(e[0].WID),parseInt(e[a].LevelID),e[a].LevelName.toString(),this.CostCenterID,this.CostCenterID,this.CaseDate.Date);a==o&&(t.IsPending=!0,t.Label="C"),0==a&&(t.LeftLineBrush="#FFFFFFFF"),a==e.length-1&&(t.RightLineBrush="#FFFFFFFF"),this.WFDocLevelList.push(t)}for(let n=t.length-1;n>=0;n--){let e=parseInt(t[n].WorkFlowLevel);if(e<=i&&e<=this.WFDocLevelList.length&&!this.WFDocLevelList[e-1].IsSet){this.WFDocLevelList[e-1].IsSet=!0,this.WFDocLevelList[e-1].ModifiedBy=t[n].Status.toString()+" By "+t[n].CreatedBy.toString(),t[n].FirstName.toString().length>0&&(this.WFDocLevelList[e-1].ModifiedBy+="("+t[n].FirstName.toString()+")");let s=new Date(t[n].Date);this.WFDocLevelList[e-1].ModifiedBy+=" On "+s.ToString(a.a.SessionManager.Preferences["Date Format"]);let i=parseInt(t[n].StatusID);1003==i?this.WFDocLevelList[e-1].IsRejected=!0:1002==i?this.WFDocLevelList[e-1].IsApproved=!0:426!=i&&427!=i||(this.WFDocLevelList[e-1].IsPending=!0,this.WFDocLevelList[e-1].Label=" P")}}}}}setVisibilityoff(){this.AttachmentVisibility=!1,this.FeedbackVisibility=!1,this.NoteVisibility=!1,this.WaiveVisibility=!1,this.ActVisibility=!1,this.ContactVisibility=!1,this.CloseVisiblity=!1,this.AssignVisiblity=!1}OnSave(e){return Object(i.b)(this,void 0,void 0,(function*(){const{CloseLeadComponent:t}=yield s.e(112).then(s.bind(null,"wunX")),{AssignFeatureComponent:i}=yield Promise.resolve().then(s.bind(null,"yWgc")),{SendEmailSMSViewModel:n}=yield Promise.resolve().then(s.bind(null,"wnwj")),{SendEmailSMSComponent:l}=yield Promise.resolve().then(s.bind(null,"7i9q")),{VoucherExportExcel:d}=yield Promise.resolve().then(s.bind(null,"5FTv"));if("Assign"==e.toString()&&(this.setVisibilityoff(),(this.CaseID>0||null==this.AssignFeature)&&(this.AssignVisiblity=!0),this.AssignFeature=new B.AssignFeatureViewModel,this.AssignFeature.AssignFeatureViewModel_1(this,this.CaseID,73),a.a.page.ShowDialog(this.AssignFeature,i)),"ChangeCustomer"==e.toString())this.CaseSearch=new L,this.CaseSearch.CaseSearchViewModel_2(this),a.a.page.ShowDialog(this.CaseSearch,w.a,{ShowCenter:!0,Title:"Search"});else if(("Print"==e||"PrintPreview"==e)&&this.CaseID>0){let t=d.GetLocationPrintLayouts(this.CostCenterID,1,this.CaseID);a.a.report.ExportPDF_Masters(this.CostCenterID,this.CaseID.toString(),parseInt(t.Tables[0].DocPrintLayoutID),"PDF").subscribe(t=>{console.log(t),"Print"!=e&&"PrintPreview"!=e||setTimeout(()=>{a.a.SessionManager.printTab(t.FileName)},500)},e=>{console.log(e)})}else if("Close"==e&&this.CaseID>0){let e=a.a.common.GetDataSet("CRM003",this.CaseID.toString());if(!(null!=e&&e.Tables.length>0&&0==e.Tables[0].length))return this.DisplayMessage="Activities are pending, Close all activities to close Case",void(this.ReportInfoVisibility=!1);this.CloseCase=new r.a(this.CaseID,this,73),a.a.page.ShowDialog(this.CloseCase,t,{ShowCenter:!0,NoWidth:!0}),this.ReportInfoVisibility=!1}else if("WaiveOff"==e.toString())this.setVisibilityoff(),this.WaiveVisibility=!0,this.Comments=new b.d(0),this.Comments.Label="Comments",this.User.SelectedValue=a.a.SessionManager.UserID.toString(),this.WaiveOffDate.Text=(new Date).ToString(a.a.SessionManager.Preferences["Date Format"].toString()),a.a.page.ShowDialog(this,M.a,{ShowCenter:!1,NoWidth:!0,Title:"Waive Off"});else if("Report"==e.toString())this.setVisibilityoff(),this.ReportInfoVisibility=!0,a.a.page.ShowDialog(this,k.a,{Title:"Reports"});else if("Cancel"==e.toString())this.ReportInfoVisibility=!1;else if("SaveWave"==e.toString()){if(""==this.User.SelectedValue)return void(this.DisplayMessage="Please Select User");this.Billing.SelectedValue="140",this.Casesmodel.User=parseInt(this.User.SelectedValue),this.Casesmodel.Comments=this.Comments.Text,this.Casesmodel.WaveDate=new Date(this.WaiveOffDate.Text),this.WaiveVisibility=!1,a.a.page.HideDialog()}else if("CancelWave"==e.toString())this.User.SelectedValue=a.a.SessionManager.UserID.toString(),this.WaiveVisibility=!1,a.a.page.HideDialog();else if("Save"==e)try{if(0==this.Customer.SelectedValue)return this.DisplayMessage="Select "+this.Customer.Label,void(this.MessageVisibility=!0);if(this.Casesmodel.CaseID=this.CaseID,0==this.Casesmodel.CaseID&&this.AllowCreationofCase&&!o.e.IsEmpty(this.lstatusid)){let e=0,t=0,s="";2==this.Customer.CCID?t=1:83==this.Customer.CCID&&(t=2);let i=a.a.common.GetDataSet3("CRM002",this.lstatusid.toString().Replace(";",","),t.toString(),this.Customer.SelectedValue.toString());if(null!=i&&i.Tables.length>0&&i.Tables[0].length>0&&""!=i.Tables[0][0][0].toString()&&(e=parseInt(i.Tables[0][0][1].toString()),s=i.Tables[0][0][0].toString(),e>0&&!confirm("Case already opened with Customer and Case Number is "+s+", Are you sure you want to continue?")))return}if(0==this.Casesmodel.CaseID&&null!=this.ViewActivities&&this.ActMandatory&&0==this.ViewActivities.ActivityGridData.length)return void alert("Activity is mandatory");let e,t=this.ScreenObject.ValidateData();if(!o.e.IsEmpty(t))return void(this.DisplayMessage=t);if(0==this.Casesmodel.CaseID){let e={StrCode:this.Casesmodel.CaseNumber,CodePrefix:this.Casesmodel.CodePrefix,CodeNumber:this.Casesmodel.CodeNumber};if(this.DisplayMessage=this.ScreenObject.SetAutoCodeParams_2(this.CName,this.ParentId,this.ScreenObject.Data.Tables[7],this.CDate,e),this.Casesmodel.CaseNumber=e.StrCode,this.Casesmodel.CodePrefix=e.CodePrefix,this.Casesmodel.CodeNumber=e.CodeNumber,this.DisplayMessage.length>0)return}else this.Casesmodel.CaseNumber=this.CName.Text;if(null==this.CaseDate.Date)return void(this.DisplayMessage="Please Enter Case Date");if(this.Casesmodel.CaseDate=new Date(this.CaseDate.Date.ToString("dd/MMM/yyyy")),this.Casesmodel.StatusID=""!=this.Status.SelectedValue?parseInt(this.Status.SelectedValue):0,this.Casesmodel.Group=this.Group.SelectedValue,this.Casesmodel.IsGroup=!1,this.Casesmodel.Customer=this.Customer.SelectedValue,this.Casesmodel.CaseTypeID=this.CaseType.SelectedValue,this.Casesmodel.CaseOriginID=this.CaseOrigin.SelectedValue,this.Casesmodel.CasePriorityID=this.CasePriority.SelectedValue,this.Casesmodel.Mode=""!=this.Mode.SelectedValue?this.Mode.SelectedValue:"Manual",this.Casesmodel.ServiceLevelID=parseInt(this.ServiceLevel.SelectedValue),this.Casesmodel.SVCContractID="0"!=this.Contract.SelectedValue&&null!=this.Contract.SelectedValue&&""!=this.Contract.SelectedValue?parseInt(this.Contract.SelectedValue):0,this.Casesmodel.ContractID=""!=this.ContractLine.SelectedValue?parseInt(this.ContractLine.SelectedValue):0,this.Casesmodel.ProductID=""!=this.Product.SelectedValue?parseInt(this.Product.SelectedValue):1,this.Casesmodel.ProductXML=this.ProductGrid.GetProductXML(),this.Casesmodel.FeedbackXML=this.ViewFeedback.GetXML(),this.Casesmodel.Billing=""!=this.Billing.SelectedValue?parseInt(this.Billing.SelectedValue):0,this.Casesmodel.SerialNo=this.SerialNumber.Text,this.Casesmodel.Description="",this.Casesmodel.Subject=this.Subject.Text,this.Casesmodel.CustomFieldsQuery=this.ScreenObject.GetCustomFieldsQuery(),this.Casesmodel.CustomCCQuery=this.ScreenObject.GetCustomCostCenterFieldsQuery(),this.Reasons.length>0){let e="";e+="<XML>";for(let t=0;t<this.Reasons.length;t++)e+="<Row Rowno='"+t.toString()+"'",e+=" SeviceType='"+this.Reasons[t].ServiceTypeID.toString()+"'",e+=" ServiceReasonID='"+this.Reasons[t].ServiceReasonID.toString()+"'",e+=" VoiceOfCustomer='"+this.Reasons[t].VoiceOfCustomer.toString()+"'",e+=" NODEID='"+this.Reasons[t].NODEID.toString()+"'",e+=" TechComments='"+this.Reasons[t].TechComments.toString()+"' />";e+="</XML>",this.Casesmodel.ServiceXML=e.toString()}if(this.Casesmodel.ActivityXml=this.ViewActivities.ActivitiesXML(),this.AutoActivity&&0==this.CaseID&&(o.e.IsEmpty(this.Casesmodel.ActivityXml)||"<ScheduleActivityXml></ScheduleActivityXml>"==this.Casesmodel.ActivityXml)&&(this.AddActivity(),null!=this.Activities.Subject&&null!=this.Subject&&(this.Activities.Subject.Text=this.Subject.Text),null!=this.Activities.Status&&o.e.IsEmpty(this.Activities.Status.SelectedValue)&&(this.Activities.Status.SelectedValue="412"),this.Activities.onSaveActivity("Save"),this.Casesmodel.ActivityXml=this.ViewActivities.ActivitiesXML()),this.Casesmodel.NoteXML=this.ViewNotes.GetXML(),this.Casesmodel.AttachmentXML=this.ViewAttachments.GetXML(),this.Casesmodel.CustomerMode=this.CustomerMode,this.Casesmodel.CaseContacts=this.ViewContacts.GetXML(),this.Casesmodel.AssignXML=0==this.CaseID&&null!=this.AssignFeature?this.AssignFeature.AssignXML:"",0==this.CaseID&&(this.Casesmodel.Wid=this.ScreenObject.CheckWorkFlow()),!this.ScreenObject.ValidateDataonSave())return;let s=this.Casesmodel.SaveCase(this.RefCCID,this.RefNodeID);e=s.RetValue,this.DisplayMessage=s.Message,this.RetValue=e,e>0&&(this.MessageVisibility=!0,this.ClearFields(),this.ScreenObject.IsAutoCode&&this.AutoGenerateCode(),this.ProductGrid.ClearGrid(),this.ViewFeedback.FeedBackDataObj.Table.Clear(),this.ViewActivities.ActivityGridDataObj.Clear(),this.ViewAssignHistroy.ListObj.Clear())}catch(h){}else if("Email"==e)this.CaseID>0&&a.a.page.ShowDialog(new n(!0,this.CostCenterID,this.CaseID,this),l);else if("RejectVisiblity"==e.toString())this.setVisibilityoff(),this.RejectVisiblity=!0,this.RejectRemarks="";else if("Approve"==e.toString()){a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save Cases on approve")&&this.OnSave("Save");let t,s=0;t=this.ScreenObject.SetComStatus(this.CaseID,"Approve"==e,this.RejectRemarks,this.Casesmodel.GUID,this.CostCenterID),s=t.RetValue,this.DisplayMessage=t.Message,s>0&&(this.BtnApprove.Visible=!1,this.BtnApprove.Visible=!1,this.RejectVisiblity=!1,this.ClearFields()),this.MessageVisibility=!0}else"Cancel"==e.toString()?this.setVisibilityoff():"ViewHistory"==e.toString()&&a.a.page.ShowDialog(new F.DocumentDraftsViewModel(this,3),G.DocumentDraftsComponent);Logger.InfoLog("AddEditCaseViewModel:: OnSave End")}))}OnGroupSelectionChanged(e){this.Group.SelectedValue>0&&(this.ParentId=this.Group.SelectedValue,this.AutoGenerateCode())}AutoGenerateCode(){0==this.CaseID&&(this.Casesmodel.SelectedNodeID=this.Group.SelectedValue>0?this.Group.SelectedValue:this.ParentId,null!=this.CDate.Date?this.ScreenObject.SetAutoCode(this.CName,this.Casesmodel.IsGroup,this.ParentId,this.ScreenObject.Data.Tables[7],this.CDate):this.ScreenObject.SetAutoCode(this.CName,this.Casesmodel.IsGroup,this.ParentId,this.ScreenObject.Data.Tables[7]))}ClearFields(){this.ButtonWaive.Visible=!1,this.CName.Text="",this.CaseDate.Text=(new Date).ToString(a.a.SessionManager.Preferences["Date Format"].toString()),this.Customer.SelectedValue=0,this.Contract.SelectedValue="0",this.ContractLine.SelectedValue="0",this.Mode.SelectedValue="Manual",this.SerialNumber.Text="",this.Casesmodel.CaseID=0,this.Product.SelectedValue="0",this.CaseType.SelectedValue=0,this.CaseOrigin.SelectedValue=0,this.CasePriority.SelectedValue=0,this.AssignedDate.Text="",this.ReasonsObj.Clear(),this.Owner.Text=a.a.SessionManager.UserName,this.CreatedDate.Text=this.AssignedDate.Text=this.CaseDate.Text,this.Billing.SelectedValue="139",this.Group.SelectedValue=1,this.ViewActivities.Activity.SelectedValue="-1",this.ViewActivities.ActivityGridDataObj.Clear(),this.ViewActivities.ActivityGridDataObj.addEmptyRow(),this.ViewActivities.ActivityGridDataObj.addEmptyRow(),this.ScreenObject.Clear(),this.Casesmodel.Comments="",this.Casesmodel.User=0,this.ViewAssignHistroy.ListObj.Clear(),this.ViewNotes.NotesListObj.Clear(),this.ViewAttachments.AttachmentsList.Clear(),this.CaseID=0,this.Casesmodel.Wid=0,this.WFDocLevelList.Clear(),this.btnHistoryVisible=!1,this.BtnApprove.Visible=!1}OnServiceContractChange(e){if("Account"==e.toString()){if(0!=this.Customer.SelectedValue){let e=this.Casesmodel.GetServiceDetailsAtCases(this.Customer.SelectedValue);if(this.Contract.Items.Clear(),this.Product.Items.Clear(),null!=e&&e.Columns[0].Contains("VOUCHERNO")&&e.Tables[0].length>0){for(let t=0;t<e.Tables[0].length;t++)this.Contract.Items.push(D.d.ComboBoxItems_2(e.Tables[0][t].VOUCHERNO.toString(),e.Tables[0][t].DOCID.toString()));this.dvContractProducts=e.Tables[1]}}}else"Contract"==e.toString()&&"0"!=this.Contract.SelectedValue&&null!=this.Contract.SelectedValue&&this.LoadProducts()}LoadProducts(){if("0"!=this.Contract.SelectedValue&&null!=this.Contract.SelectedValue&&(this.Product.Items.Clear(),null!=this.dvContractProducts&&this.dvContractProducts.length>0)){let e=this.dvContractProducts.filter(e=>e.DocID==this.Contract.SelectedValue);for(let t=0;t<e.length;t++)this.Product.Items.push(D.d.ComboBoxItems_2(e[t].ProductName.toString(),e[t].ProductID.toString()))}}OnCellEditEnding(e){try{let t=e.item;t.ServiceTypeID.toString().length>0&&(this.dvServiceTypes.filter(e=>e.ServiceTypeID=t.ServiceTypeID.toString()),this.dvTechnicians.filter(e=>e.ServiceTypeID=t.ServiceTypeID.toString()))}catch(t){Logger.InfoLog("AddEditCaseViewModel:: OnCellEditEnding Exception")}}AddGridColumns(){this.BuildTempDataTable();let e=new m.a;this.dsLoad.Tables.length>3&&(this.dvServiceTypes=this.dsLoad.Tables[3]),e.ValueBinding="ServiceTypeID",e.Header=a.a.GetResource("CRMCases_Service"),e.DataType="ComboBox",e.DisplayMember="ServiceName",e.ValueMember="ServiceTypeID",e.Width=150,e.ComboData=this.dsLoad.Tables[0],this.ColLists.push(e),e=new m.a,e.ValueBinding="ServiceReasonID",e.Header=a.a.GetResource("CRMCases_Reason"),e.DataType="PactComboBox",e.DisplayMember="Reason",e.ValueMember="ServiceReasonID",e.FilterCondition="ServiceTypeID={0}",e.FilterColumn="ServiceTypeID",e.Width=150,e.ComboData=this.dvServiceTypes,this.ColLists.push(e),this.dsLoad.Tables.Count>1&&(this.dvServiceTypes=this.dsLoad.Tables[1]),e=new m.a,e.DisplayMember="VoiceOfCustomer",e.Header=a.a.GetResource("CRMCases_VoiceOfCustomer"),e.DataType="TextBlock",e.Width=300,e.IsVisible=!0,this.ColLists.push(e),this.dsLoad.Tables.length>2&&(this.dvTechnicians=this.dsLoad.Tables[2]),e=new m.a,e.ValueBinding="NODEID",e.Header=a.a.GetResource("CRMCases_Technician"),e.DataType="PactComboBox",e.DisplayMember="Technician",e.ValueMember="NODEID",e.FilterCondition="ServiceTypeID={0}",e.FilterColumn="ServiceTypeID",e.Width=150,e.ComboData=this.dvTechnicians,this.ColLists.push(e),e=new m.a,e.DisplayMember="TechComments",e.Header=a.a.GetResource("CRMCases_TechComments"),e.DataType="TextBlock",e.Width=400,e.IsVisible=!0,this.ColLists.push(e),this.ColumnSource=this.ColLists,this.ReasonsObj.Columns=this.ColLists;for(let t=0;t<this.dsLoad.Tables[3].length;t++)this.User.Items.push(D.d.ComboBoxItems_2(this.dsLoad.Tables[3][t].UserName.toString(),this.dsLoad.Tables[3][t].UserID.toString()));this.Group.SelectedValue=0==this.Casesmodel.SelectedNodeID?1:this.Casesmodel.SelectedNodeID,this.Owner.Text=a.a.SessionManager.UserName,this.CreatedDate.Text=(new Date).ToString(a.a.SessionManager.Preferences["Date Format"].toString()),this.AssignedDate.Text=this.CreatedDate.Text,Logger.InfoLog("AddEditCaseViewModel:: AddGridColumns Leave")}BuildTempDataTable(){this.ReasonsObj.Table=[],this.ReasonsObj.TableColumns.push("ServiceTypeID"),this.ReasonsObj.TableColumns.push("ServiceReasonID"),this.ReasonsObj.TableColumns.push("ServiceReasonID_Key"),this.ReasonsObj.TableColumns.push("VoiceOfCustomer"),this.ReasonsObj.TableColumns.push("NODEID"),this.ReasonsObj.TableColumns.push("NODEID_Key"),this.ReasonsObj.TableColumns.push("TechComments")}CheckIsBillable(){if(this.CaseID>0)return;let e=this.Casesmodel.SearchCases(0,this.Contract.SelectedValue,"",0,this.CaseDate.Date,"");if(e.Columns[0].Contains("DocID")){let t=e.Tables[0].filter(e=>e.DocID==this.Contract.SelectedValue);if(t.length>0&&e.Columns[0].Contains("CaseType")){let s=0,i=0;e.Columns[0].Contains("CaseCount")&&o.e.IsNum(t[0].CaseCount)&&(i=parseInt(t[0].CaseCount.toString())),e.Columns[0].Contains("AllotedCases")&&o.e.IsNum(t[0].AllotedCases)&&(s=parseInt(t[0].AllotedCases.toString())),this.Billing.SelectedValue=i>s||"10001"==t[0].CaseType.toString()&&e.Columns[0].Contains("MonthCases")&&""!=t[0].MonthCases.toString()&&parseFloat(t[0].MonthCases.toString())>0?"139":"138"}}}LoadReport(){let e=this.ScreenObject.CustomTab.Pages.find(e=>"Documents"==e.Name);if(null!=e&&null!=this.dsLoad){let t=this.dsLoad.Tables[1].filter(e=>"LinkDimension"==e.Name);if(t.length>0&&""!=t[0].Value.toString()&&this.dsLoad.Tables[10].length>0){let s=0,i=0,a=0,n=parseInt(t[0].Value)-5e4;a=o.e.Int(this.dsLoad.Tables[10][0].CCCaseID),0==a&&(a=-123);let l=" AND DCC.dcCCNID"+n+"="+a,r="";if(t=this.ScreenObject.Data.Tables[4].filter(e=>"CreateDocuments"==e.Name),t.length>0&&""!=t[0].Value.toString()&&(r=t[0].Value.toString().Replace(";",",")),s=o.e.Int(this.dsLoad.Tables[4][0].RefCCID),i=o.e.Int(this.dsLoad.Tables[4][0].RefNodeID),r.length>0){let t="<XML><Row ColID='300' Value='"+r+"'/>";t+="<Row ColID='CRM_Cases_DocumentsTab' Value='"+l+"'/>",0!=i&&0!=s||(i=-1234),t+='<Row ColID="CRM_CasesRef_DocumentsTab" Value=" AND INV.DocID='+i+'"/>',t+="</XML>",null==this.Report?(this.Report.ShowHeaderButtons=!1,this.Report.ShowRightPanel=!1,this.Report.SearchVisibility=!1,e.Fields.Clear(),e.Fields.push(this.Report)):(this.Report.LoadDocFilterXML(t),this.Report.OnReportClick(this.Report.ReportID,0))}}}}onDateChanged(e){this.AutoGenerateCode()}}},W7OG:function(e,t,s){"use strict";s.d(t,"a",(function(){return M}));var i=s("mrSG"),a=s("Do2H"),o=s("Lp6j"),n=s("eQJW"),l=s("ScVY"),r=s("NkMH"),d=s("8B8H"),h=s("ockk"),c=s("r2z3"),u=s("CUWK"),C=s("EQd/"),m=s("0/4Q"),b=s("n56n"),S=s("4HhE"),D=s("JIg3"),g=s("Jnyl"),p=s("Huqd"),I=s("MCKn"),T=s("vTM8"),y=s("uMy8"),f=s("lUlH"),P=s("pcVU");class O extends l.b{constructor(e,t,s){super(),this.Save=new S.b,this.ds=null,this.ProductGridObj=new d.a,this.CustomerChecked=new S.b,this.ccid=0,this.CCNodeID=0,this.Title=this.DisplayName="Email Templates",this.Save.Subscribe(this,"OnSave"),this.ccid=t,this.CCNodeID=s,this.Parent=e;let i,o=null;if(o="1"==a.a.SessionManager.UserID||"1"==a.a.SessionManager.RoleID?a.a.common.GetDataSet("CRM005",t.toString()):a.a.common.GetDataSet3("CRM006",t.toString(),a.a.SessionManager.UserID,a.a.SessionManager.RoleID),this.ColumnSource=[],i=new h.a,i.Header="Select",i.DisplayMember="isChecked",i.DataType="CheckBox",i.Width=50,i.IsVisible=!0,this.ColumnSource.push(i),i=new h.a,i.Header="TemplateName",i.DisplayMember="TemplateName",i.Width=180,i.IsVisible=!0,i.ReadOnly=!0,this.ColumnSource.push(i),this.ProductGridObj.Table=[],this.ProductGridObj.TableColumns.push("isChecked"),this.ProductGridObj.TableColumns.push("TemplateName"),this.ProductGridObj.TableColumns.push("TemplateID"),this.ProductGridObj.Columns=this.ColumnSource,null!=o&&o.Tables[0].length>0)for(let a=0;a<o.Tables[0].length;a++){let e=this.ProductGridObj.NewRow();e[a][0]=!1,e[a][1]=o.Tables[0][a].TemplateName.toString(),e[a][2]=o.Tables[0][a].TemplateID.toString(),this.ProductGridObj.addRow(e)}}get angularGrid(){return this.ProductGridObj.angularGrid}get ProductGrid(){return this.ProductGridObj.Table}get ProductColumnSource(){return this.ProductGridObj.Columns}OnSave(e){if("Cancel"==e)a.a.page.HideDialog();else{if(this.DisplayMessage="",this.MessageVisibility=!1,0==this.CCNodeID)return;let e="";if(null!=this.ProductGrid&&this.ProductGrid.length>0)for(let t=0;t<this.ProductGrid.length;t++)null!=this.ProductGrid[t].isChecked.toString()&&Object(n.j)(this.ProductGrid[t].isChecked)&&""!=this.ProductGrid[t].TemplateID.toString()&&(e+=this.ProductGrid[t].TemplateID.toString()+",");if(e.length>0){let t,s="",i="",o=null;("AddEditLeads"==this.Parent.ClassName||"AddEditCasesViewModel"==this.Parent.ClassName||"AddEditOpportunity"==this.Parent.ClassName)&&(o=this.Parent.ViewFeedback.FeedBackGrid.Table),null!=o&&o.forEach(e=>{o.Columns.Contains("Print")&&"TRUE"==e.Print.toString().toUpperCase()&&e.NodeID.toString().length>0&&parseInt(e.NodeID)>0&&(i.length>0&&(i+=","),i+=e.NodeID.toString())}),i.length>0&&(s+="<LeadFollowUp>",s+=" NodeID NOT IN ("+i+")",s+="</LeadFollowUp>"),s.length>0&&(s="<XML>"+s+"</XML>"),this.DisplayMessage=(new c.a).SetEmailTemplatesForProduct(this.ccid,this.CCNodeID,e.Trim(","),s.toString()),t>0&&a.a.page.HideDialog()}else this.DisplayMessage="Please select atleast one email template";this.MessageVisibility=!0}}}var V=s("cxZg");class M extends l.b{constructor(e,t){super(),this.Module="CRM",this.Visible=!0,this.CostCenter=new m.e,this.Leadid=0,this.ColumnSpan="4",this.RowIndex=0,this.ProductGridObj=new d.a,this._SelectAll=!1,this.SerialNo=0,this.lstProducts=new Array,this.ProdID=0,this.bOnClick=!1,this.CRMProductCCID=0,this.CostCenterID=0,this.SrcProductValueMapping="",this.DestProductValueMapping="",this.DS=null,this.dbCRMProduct=null,this.SelectUnCheck=0,this.parent=e,this.CostCenterID=t,this.ClassName="LeadsProductViewModel",this.CostCenter.Label=a.a.GetResource("Preferences_CreateDocuments"),this.CostCenter.LblWidth="120",this.ProductGridObj.SelectAll.Visible=!0,this.ButtonEmail=new r.a,a.a.SessionManager.HideUnathorizedAccess?this.ButtonEmail.Visible=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Product_Email"):this.ButtonEmail.Enable=a.a.SessionManager.IsActionAssigned(this.CostCenterID,"Product_Email"),this.ProductGridObj.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.ProductGridObj.BeginEdit.Subscribe(this,"onBeginEdit"),this.CRMProductCCID="0"!=a.a.SessionManager.Preferences["CRM-Products"].toString()&&o.e.IsNum(a.a.SessionManager.Preferences["CRM-Products"])?parseInt(a.a.SessionManager.Preferences["CRM-Products"].toString()):3;let s,i=a.a.cases.GetPreferencesatCRM(t);if(null!=i&&i.Tables.length>0&&i.Tables[0].length>0)for(let a=0;a<i.Tables[0].length;a++)this.CostCenter.Items.push(m.d.ComboBoxItems_2(i.Tables[0][a].DOCNAME.toString(),i.Tables[0][a].DOCID.toString()));this.ProductGridObj.Table=[],this.ProductGridObj.TableColumns.push("isChecked"),this.ProductGridObj.TableColumns.push("ProductName"),this.ProductGridObj.TableColumns.push("ProductCode"),this.ProductGridObj.TableColumns.push("ProductID_Key"),this.ProductGridObj.TableColumns.push("Description"),this.ProductGridObj.TableColumns.push("CRMProduct"),this.ProductGridObj.TableColumns.push("CRMProduct_Key"),this.ProductGridObj.TableColumns.push("Qty"),this.ProductGridObj.TableColumns.push("UOM"),this.ProductGridObj.TableColumns.push("UOM_Key"),this.ProductGridObj.TableColumns.push("isEdit"),this.ProductGridObj.TableColumns.push("CurrencyID"),this.ProductGridObj.TableColumns.push("CurrencyID_Key");for(let a=1;a<=50;a++)this.ProductGridObj.TableColumns.push("Alpha"+a),this.ProductGridObj.TableColumns.push("CCNID"+a),this.ProductGridObj.TableColumns.push("CCNID"+a+"_Key");this.ProductColumnSource=new Array,86==t?this.DS=a.a.crmService.GetFeedbackDetails(115):73==t?this.DS=a.a.crmService.GetFeedbackDetails(156):89==t?this.DS=a.a.crmService.GetFeedbackDetails(154):88==t&&(this.DS=a.a.crmService.GetFeedbackDetails(155)),s=new h.a,s.Header="Select",s.DisplayMember="isChecked",s.DataType="CheckBox",s.Width=50,s.IsVisible=!0,s.CheckedChanged.Subscribe(this,"OnCheckedChanged"),this.ProductColumnSource.push(s),this.dvCnt=this.DS.Tables[0],this.dvCntTable=this.DS.Tables[0];try{let e=null,t=null,i="",l=null,r=null,d=0;for(let c=0;c<this.DS.Tables[0].length;c++)if("Description"==this.DS.Tables[0][c].SysColumnName.toString())s=new h.a,s.Header="Description",s.DisplayMember="Description",s.Width=o.e.IsEmpty(this.DS.Tables[0][c].Width)?150:parseInt(this.DS.Tables[0][c].Width.toString()),s.IsVisible=!0,s.ReadOnly=!Object(n.j)(this.DS.Tables[0][c].IsEditable),this.ProductColumnSource.push(s);else if("ProductID"==this.DS.Tables[0][c].SysColumnName.toString())s=new h.a,s.Header="Product",s.DisplayMember="ProductName",s.ValueMember="ProductID_Key",s.DataType="LISTBOX",s.Width=o.e.IsEmpty(this.DS.Tables[0][c].Width)?230:parseInt(this.DS.Tables[0][c].Width.toString()),s.CostCenterID=3,s.TypeID=10,s.ID=this.DS.Tables[0][c].CostCenterColID.toString(),s.IsVisible=!0,s.ReadOnly=!Object(n.j)(this.DS.Tables[0][c].IsEditable),this.ProductColumnSource.push(s);else if("Quantity"==this.DS.Tables[0][c].SysColumnName.toString())s=new h.a,s.Header="Qty",s.DisplayMember="Qty",s.DataType="INT",s.Width=o.e.IsEmpty(this.DS.Tables[0][c].Width)?150:parseInt(this.DS.Tables[0][c].Width.toString()),s.IsVisible=!0,s.ReadOnly=!Object(n.j)(this.DS.Tables[0][c].IsEditable),this.ProductColumnSource.push(s);else if("UOM"==this.DS.Tables[0][c].SysColumnName.toString())s=new h.a,s.Header="UOM",s.DisplayMember="UOM",s.ValueMember="UOM_Key",s.DataType="LISTBOX",s.IsVisible=!0,s.Width=o.e.IsEmpty(this.DS.Tables[0][c].Width)?230:parseInt(this.DS.Tables[0][c].Width.toString()),s.ID=this.DS.Tables[0][c].CostCenterColID.toString(),s.CostCenterID=11,s.TypeID=1,s.ReadOnly=!Object(n.j)(this.DS.Tables[0][c].IsEditable),this.ProductColumnSource.push(s);else if("CurrencyID"==this.DS.Tables[0][c].SysColumnName.toString())s=new h.a,s.Header="Currency",s.DisplayMember="CurrencyID",s.ValueMember="CurrencyID_Key",s.DataType="LISTBOX",s.IsVisible=!0,s.Width=o.e.IsEmpty(this.DS.Tables[0][c].Width)?80:parseInt(this.DS.Tables[0][c].Width.toString()),s.ID=this.DS.Tables[0][c].CostCenterColID.toString(),s.CostCenterID=12,s.TypeID=1,s.ReadOnly=!Object(n.j)(this.DS.Tables[0][c].IsEditable),this.ProductColumnSource.push(s);else if("CRMProduct"==this.DS.Tables[0][c].SysColumnName.toString()&&""!=a.a.SessionManager.Preferences["CRM-Products"].toString()&&"0"!=a.a.SessionManager.Preferences["CRM-Products"].toString())s=new h.a,null!=this.DS&&this.DS.Tables.length>1&&this.DS.Tables[2].length>0&&(s.ComboData=this.DS.Tables[2]),s.DisplayMember="CRMProduct",s.ValueMember="CRMProduct_Key",s.DataType="LISTBOX",s.Header="CRM-Products",s.Width=o.e.IsEmpty(this.DS.Tables[0][c].Width)?230:parseInt(this.DS.Tables[0][c].Width.toString()),s.ID=this.DS.Tables[0][c].CostCenterColID.toString(),s.CostCenterID=parseInt(a.a.SessionManager.Preferences["CRM-Products"].toString()),s.TypeID=1,s.ReadOnly=!Object(n.j)(this.DS.Tables[0][c].IsEditable),s.IsVisible=!0,this.ProductColumnSource.push(s);else if(this.DS.Tables[0][c].IsVisible&&this.DS.Tables[0][c].SysColumnName.toString().Contains("Alpha")){if(s=new h.a,s.Header=this.DS.Tables[0][c].UserColumnName.toString(),s.DefaultValue=this.DS.Tables[0][c].UserDefaultValue.toString(),"Date"==this.DS.Tables[0][c].UserColumnType.toString())s.DisplayMember=this.DS.Tables[0][c].SysColumnName.toString(),s.DataType="DATE",this.ProductGridObj.TableColumns.push(this.DS.Tables[0][c].SysColumnName.toString()+"_Key");else if("DateTime"==this.DS.Tables[0][c].UserColumnType.toString())s.DisplayMember=this.DS.Tables[0][c].SysColumnName.toString(),s.DataType="DATETIME",this.ProductGridObj.TableColumns.push(this.DS.Tables[0][c].SysColumnName.toString()+"_Key");else if("LISTBOX"==this.DS.Tables[0][c].UserColumnType.toString())s.DisplayMember=this.DS.Tables[0][c].SysColumnName.toString(),s.ValueMember=this.DS.Tables[0][c].SysColumnName.toString()+"_Key",s.DataType="LISTBOX",s.CostCenterID=parseInt(this.DS.Tables[0][c].ColumnCostCenterID),s.TypeID=0==this.DS.Tables[0][c].ColumnCCListViewTypeID.toString().Trim().length?1:parseInt(this.DS.Tables[0][c].ColumnCCListViewTypeID),this.ProductGridObj.TableColumns.push(this.DS.Tables[0][c].SysColumnName.toString()+"_Key");else if("Time"==this.DS.Tables[0][c].UserColumnType.toString())s.DisplayMember=this.DS.Tables[0][c].SysColumnName.toString(),s.DataType="TIME",this.ProductGridObj.TableColumns.push(this.DS.Tables[0][c].SysColumnName.toString()+"_Key");else if("Numeric"==this.DS.Tables[0][c].UserColumnType.toString())s.DisplayMember=this.DS.Tables[0][c].SysColumnName.toString(),s.DataType="FLOAT";else if("COMBOBOX"==this.DS.Tables[0][c].UserColumnType.toString()){if(s.ValueBinding=this.DS.Tables[0][c].SysColumnName.toString(),s.DataType="ComboBox",s.DisplayMember="Name",s.ValueMember="Value",e=[],i=this.DS.Tables[0][c].UserProbableValues.toString().Trim(),i.length>0)for(t=i.split(";"),d=0;d<t.length;d++)e.push(m.d.ComboBoxItems_2(t[d],t[d]));s.ComboData=e,this.ProductGridObj.TableColumns.push(this.DS.Tables[0][c].SysColumnName.toString()+"_Key")}else if("DATE"==this.DS.Tables[0][c].UserColumnType.toString())s.DataType="DATE",s.DisplayMember=this.DS.Tables[0][c].SysColumnName.toString(),this.ProductGridObj.TableColumns.push(this.DS.Tables[0][c].SysColumnName.toString()+"_Key");else if("LOOKUP"==this.DS.Tables[0][c].UserColumnType.toString()){if(s.ValueBinding=this.DS.Tables[0][c].SysColumnName.toString(),s.DataType="ComboBox",s.DisplayMember="Name",s.ValueMember="Value",r=f.a.GetLookupData(parseInt(this.DS.Tables[0][c].ColumnCCListViewTypeID)),null!=r){for(e=[],d=0;d<r.length;d++)e.push(m.d.ComboBoxItems_2(r[d].Name.toString(),r[d].NodeID.toString()));s.ComboData=e}this.ProductGridObj.TableColumns.push(this.DS.Tables[0][c].SysColumnName.toString()+"_Key")}else s.DisplayMember=this.DS.Tables[0][c].SysColumnName.toString(),s.DataType="TEXTBOX";this.DS.Columns[0].Contains("Cformula")&&!o.e.IsEmpty(this.DS.Tables[0][c].Cformula)&&(s.Formula=this.DS.Tables[0][c].Cformula.toString()),s.Width=o.e.IsEmpty(this.DS.Tables[0][c].Width)?150:parseInt(this.DS.Tables[0][c].Width.toString()),s.IsVisible=!0,s.ReadOnly=!Object(n.j)(this.DS.Tables[0][c].IsEditable),s.ExcludeFilter=!1,this.ProductColumnSource.push(s)}else this.DS.Tables[0][c].IsVisible&&this.DS.Tables[0][c].SysColumnName.toString().Contains("Alpha")&&"LISTBOX"==this.DS.Tables[0][c].UserColumnType.toString().toUpperCase()?(s=new h.a,s.Header=this.DS.Tables[0][c].UserColumnName.toString(),s.DisplayMember=this.DS.Tables[0][c].SysColumnName.toString(),s.ValueMember=this.DS.Tables[0][c].SysColumnName.toString()+"_Key",s.DataType="LISTBOX",s.Width=o.e.IsEmpty(this.DS.Tables[0][c].Width)?150:parseInt(this.DS.Tables[0][c].Width.toString()),s.CostCenterID=parseInt(this.DS.Tables[0][c].ColumnCostCenterID),this.ProductGridObj.TableColumns.Contains(s.ValueMember)||this.ProductGridObj.TableColumns.push(s.ValueMember),s.TypeID=0==this.DS.Tables[0][c].ColumnCCListViewTypeID.toString().Trim().length?1:parseInt(this.DS.Tables[0][c].ColumnCCListViewTypeID),s.ExcludeFilter=this.DS.Tables[0][c].Filter.toString().Trim().length>0&&"0"==this.DS.Tables[0][c].Filter.toString(),s.ReadOnly=!Object(n.j)(this.DS.Tables[0][c].IsEditable),this.ProductColumnSource.push(s)):this.DS.Tables[0][c].IsVisible&&this.DS.Tables[0][c].SysColumnName.toString().Contains("CCNID")&&"LISTBOX"==this.DS.Tables[0][c].UserColumnType.toString().toUpperCase()&&(s=new h.a,s.ID=this.DS.Tables[0][c].CostCenterColID.toString(),s.Header=this.DS.Tables[0][c].UserColumnName.toString(),s.DisplayMember=this.DS.Tables[0][c].SysColumnName.toString(),s.ValueMember=this.DS.Tables[0][c].SysColumnName.toString()+"_Key",s.DataType="LISTBOX",s.Width=o.e.IsEmpty(this.DS.Tables[0][c].Width)?150:parseInt(this.DS.Tables[0][c].Width.toString()),s.CostCenterID=parseInt(this.DS.Tables[0][c].ColumnCostCenterID),s.TypeID=0==this.DS.Tables[0][c].ColumnCCListViewTypeID.toString().Trim().length?1:parseInt(this.DS.Tables[0][c].ColumnCCListViewTypeID),s.ExcludeFilter=this.DS.Tables[0][c].Filter.toString().Trim().length>0&&"0"==this.DS.Tables[0][c].Filter.toString(),s.ReadOnly=!Object(n.j)(this.DS.Tables[0][c].IsEditable),this.DS.Columns[0].Contains("dependanton")&&"0"!=o.e.String(this.DS.Tables[0][c].dependanton)&&(l=this.DS.Tables[0].Select("ColumnCostCenterID="+this.DS.Tables[0][c].dependanton.toString()),null!=l&&l.length>0&&(s.DependantOn=l[0].SysColumnName.toString(),this.DS.Columns[0].Contains("dependancy")&&!o.e.IsEmpty(this.DS.Tables[0][c].dependancy)&&(s.Dependancy=parseInt(this.DS.Tables[0][c].dependancy.toString())),this.DS.Columns[0].Contains("filterinuse")&&!o.e.IsEmpty(this.DS.Tables[0][c].filterinuse)&&(s.Dependantinuse=Object(n.j)(this.DS.Tables[0][c].filterinuse.toString())))),this.ProductColumnSource.push(s))}catch(c){}for(let a=0;a<15;a++)this.ProductGridObj.addEmptyRow(),this.ProductGrid[a][0]=!1;this.ConstructFormula();let l=null;"AddEditLeads"==this.parent.ClassName?l=a.a.crmService.GetProductValueMapping(86):"AddEditOpportunity"==this.parent.ClassName&&(l=a.a.crmService.GetProductValueMapping(89)),null!=l&&l.Tables.length>0&&l.Tables[0].length>0&&l.Columns[0].Contains("SOURCE")&&(this.SrcProductValueMapping=l.Tables[0][0].SOURCE.toString(),this.DestProductValueMapping=l.Tables[0][0].DESTINATION.toString())}get angularGrid(){return this.ProductGridObj.angularGrid}get ProductGrid(){return this.ProductGridObj.Table}get ProductColumnSource(){return this.ProductGridObj.Columns}set ProductColumnSource(e){this.ProductGridObj.Columns=e}get SelectedRow(){return this.ProductGridObj.SelectedItem}set SelectedRow(e){this.ProductGridObj.SelectedItem=e}get SelectAll(){return this._SelectAll}set SelectAll(e){e!=this._SelectAll&&(this._SelectAll=e,this.SelectUnselectAll(e))}OnMessageCallBack(){this.res="Yes"}OnClick(e){if("Email"==e.toString()){let e=-1,t=-1;"AddEditLeads"==this.parent.ClassName?(e=this.parent.LeadID,t=86):"AddEditCasesViewModel"==this.parent.ClassName?(e=this.parent.CaseID,t=73):"AddEditOpportunity"==this.parent.ClassName&&(e=this.parent.OppID,t=89);let s=new O(this.parent,t,e);a.a.page.ShowDialog(s,V.a,{ShowCenter:!0,NoWidth:!0})}else if(!o.e.IsEmpty(this.CostCenter.SelectedValue)){if(!Object(n.j)(c.a.ReturnValidPermission(parseInt(this.CostCenter.SelectedValue),"Create")))return void alert("Access Denied! ");this.res="No";for(let a=0;a<this.ProductGrid.length;a++)if(""==o.e.StringValue(this.ProductGrid[a].isEdit)&&Object(n.j)(this.ProductGrid[a].isChecked)&&!o.e.IsEmpty(this.ProductGrid[a].ProductID_Key)){this.bOnClick=!0,"AddEditLeads"==this.parent.ClassName&&this.parent.OnSave("Save"),"AddEditOpportunity"==this.parent.ClassName&&this.parent.OnSave("Save"),"AddEditCasesViewModel"==this.parent.ClassName&&this.parent.OnSave("Save");break}let e=-1,t=-1;if("AddEditLeads"==this.parent.ClassName){e=this.parent.LeadID,t=86;let s=(new c.a).GetLead(e);if(null!=s&&s.Tables.length>1&&s.Tables[0].length>0&&s.Columns[0].Contains("IsApproved")&&(""==s.Tables[0][0].IsApproved.toString()||!Object(n.j)(s.Tables[0][0].IsApproved)))return void alert("Lead should be in approved status! ")}else"AddEditCasesViewModel"==this.parent.ClassName?(e=this.parent.CaseID,t=73):"AddEditOpportunity"==this.parent.ClassName&&(e=this.parent.OppID,t=89);if(e<=0)return;let s=c.a.GetLeadScrenDetails(t);console.log("CostCenterid"),console.log(s.Tables[4]);let i=s.Tables[4].filter(e=>e.Costcenterid==this.CostCenter.SelectedValue),l=!1,r=null;this.ProductGrid.length>0&&null!=this.ProductGrid&&u.RibbonExtViewModel.GetDocumentObject(parseInt(this.CostCenter.SelectedValue),this.CostCenter.GetText(),!1).then(s=>{s.ScreenObject.RefCCId=t,s.ScreenObject.RefNodeID=e,a.a.page.addNewTab({title:s.DisplayName,component:I.AddEditDocumentComponent,params:{obj:s}});let d=0;for(let e=0;e<this.ProductGrid.length;e++)if(Object(n.j)(this.ProductGrid[e].isChecked)&&!o.e.IsEmpty(this.ProductGrid[e].ProductID_Key)&&!o.e.IsEmpty(this.ProductGrid[e].isEdit)){d++,d>9&&s.ScreenObject.GridDataObj.addEmptyRow(),s.ScreenObject.GridData.forEach(e=>{});for(let e=0;e<s.ScreenObject.GridData.length;e++){let t=s.ScreenObject.GridData[e];if(o.e.IsEmpty(t.ProductID_Key)){r=t;break}}if(null==r&&(l=!0,r=s.ScreenObject.GridDataObj.NewRow()),s.ScreenObject.GridDataColumns.Contains("ProductName")&&this.ProductGridObj.TableColumns.Contains("ProductName")&&(r.ProductName=this.ProductGrid[e].ProductName.toString()),s.ScreenObject.GridDataColumns.Contains("ProductCode")&&this.ProductGridObj.TableColumns.Contains("ProductCode")&&(r.ProductCode=this.ProductGrid[e].ProductCode.toString()),r.ProductID_Key=this.ProductGrid[e].ProductID_Key.toString(),s.AddProductData(r,!1,!1),r.Quantity=o.e.IsEmpty(this.ProductGrid[e].Qty)?"1":this.ProductGrid[e].Qty.toString(),d>9&&(r.DocSeqNo=d),"AddEditLeads"==this.parent.ClassName){let t=this.parent;if(null!=t.ScreenObject)for(let o=0;o<i.length;o++)if(s.ScreenObject.GridDataColumns.Contains(i[o].LSysColumnName.toString()))if(i[o].BSysColumnName.toString().toUpperCase().Contains("LDALPHA")&&"86"==i[o].BCostcenterid.toString())t.ds.Columns[4].Contains(i[o].BSysColumnName.toString())&&(r[i[o].LSysColumnName.toString()]=t.ds.Tables[4][0][i[o].BSysColumnName.toString()].toString());else if(i[o].BSysColumnName.toString().toUpperCase().Contains("CCNID")&&"115"!=i[o].BCostcenterid.toString())t.ds.Columns[11].Contains(i[o].BSysColumnName.toString())&&(r[i[o].LSysColumnName.toString()+"_Key"]=t.ds.Tables[11][0][i[o].BSysColumnName.toString()].toString());else if(i[o].BSysColumnName.toString().toUpperCase().Contains("CCNID")&&"115"==i[o].BCostcenterid.toString())this.ProductGridObj.TableColumns.Contains(i[o].BSysColumnName.toString())&&(r[i[o].LSysColumnName.toString()+"_Key"]=this.ProductGrid[e][i[o].BSysColumnName.toString()+"_Key"].toString());else if(i[o].BSysColumnName.toString().toLowerCase().Contains("alpha")&&"115"==i[o].BCostcenterid.toString()){if(this.ProductGridObj.TableColumns.Contains(i[o].BSysColumnName.toString()))try{r[i[o].LSysColumnName.toString()]=this.ProductGrid[e][i[o].BSysColumnName.toString()].toString()}catch(c){r[i[o].LSysColumnName.toString()]="0.0"}}else i[o].BSysColumnName.toString().toLowerCase().Contains("description")&&"115"==i[o].BCostcenterid.toString()?this.ProductGridObj.TableColumns.Contains(i[o].BSysColumnName.toString())&&(r[i[o].LSysColumnName.toString()]=this.ProductGrid[e][i[o].BSysColumnName.toString()].toString()):i[o].BSysColumnName.toString().toLowerCase().Contains("crmproduct")&&"115"==i[o].BCostcenterid.toString()&&""!=a.a.SessionManager.Preferences["CRM-Products"].toString()&&"0"!=a.a.SessionManager.Preferences["CRM-Products"].toString()&&this.ProductGridObj.TableColumns.Contains(i[o].BSysColumnName.toString())&&(r[i[o].LSysColumnName.toString()+"_Key"]=this.ProductGrid[e][i[o].BSysColumnName.toString()+"_Key"].toString());else"DebitAccount"!=i[o].LSysColumnName.toString()&&"CreditAccount"!=i[o].LSysColumnName.toString()||(s.ScreenObject.GridDataColumns.Contains(i[o].LUserColumnName.toString())?s.ScreenObject.GridDataColumns.Contains(i[o].LSysColumnName.toString()+"_Key")&&(r[i[o].LUserColumnName.toString()]=t.ds.Tables[0][0][i[o].BSysColumnName.toString()].toString(),r[i[o].LSysColumnName.toString()+"_Key"]=t.ds.Tables[0][0].SelectedModeID.toString()):"DebitAccount"==i[o].LSysColumnName.toString()?s.ScreenObject.DebitAccount.SelectedValue=parseInt(t.ds.Tables[0][0].SelectedModeID.toString()):"CreditAccount"==i[o].LSysColumnName.toString()&&(s.ScreenObject.CreditAccount.SelectedValue=parseInt(t.ds.Tables[0][0].SelectedModeID.toString())))}if("AddEditOpportunity"==this.parent.ClassName){let t=this.parent;if(null!=t.ScreenObject)for(let o=0;o<i.length;o++)if(s.ScreenObject.GridDataColumns.Contains(i[o].LSysColumnName.toString()))if(i[o].BSysColumnName.toString().toUpperCase().Contains("LDALPHA")&&"89"==i[o].BCostcenterid.toString())t.ds.Columns[8].Contains(i[o].BSysColumnName.toString())&&(r[i[o].LSysColumnName.toString()]=t.ds.Tables[8][0][i[o].BSysColumnName.toString()].toString());else if(i[o].BSysColumnName.toString().toUpperCase().Contains("CCNID")&&"154"!=i[o].BCostcenterid.toString())t.ds.Columns[11].Contains(i[o].BSysColumnName.toString())&&(r[i[o].LSysColumnName.toString()+"_Key"]=t.ds.Tables[11][0][i[o].BSysColumnName.toString()].toString());else if(i[o].BSysColumnName.toString().toUpperCase().Contains("CCNID")&&"154"==i[o].BCostcenterid.toString())this.ProductGridObj.TableColumns.Contains(i[o].BSysColumnName.toString())&&(r[i[o].LSysColumnName.toString()+"_Key"]=this.ProductGrid[e][i[o].BSysColumnName.toString()+"_Key"].toString());else if(i[o].BSysColumnName.toString().toLowerCase().Contains("alpha")&&"154"==i[o].BCostcenterid.toString()){if(this.ProductGridObj.TableColumns.Contains(i[o].BSysColumnName.toString()))try{r[i[o].LSysColumnName.toString()]=this.ProductGrid[e][i[o].BSysColumnName.toString()].toString()}catch(c){r[i[o].LSysColumnName.toString()]="0.0"}}else i[o].BSysColumnName.toString().toUpperCase().Contains("QUANTITY")&&"89"==i[o].BCostcenterid.toString()?this.ProductGridObj.TableColumns.Contains("Qty")&&(r[i[o].LSysColumnName.toString()]=this.ProductGrid[e].Qty.toString()):i[o].BSysColumnName.toString().toLowerCase().Contains("description")&&"154"==i[o].BCostcenterid.toString()?this.ProductGridObj.TableColumns.Contains(i[o].BSysColumnName.toString())&&(r[i[o].LSysColumnName.toString()]=this.ProductGrid[e][i[o].BSysColumnName.toString()].toString()):i[o].BSysColumnName.toString().toLowerCase().Contains("crmproduct")&&"154"==i[o].BCostcenterid.toString()&&""!=a.a.SessionManager.Preferences["CRM-Products"].toString()&&"0"!=a.a.SessionManager.Preferences["CRM-Products"].toString()&&this.ProductGridObj.TableColumns.Contains(i[o].BSysColumnName.toString())&&(r[i[o].LSysColumnName.toString()+"_Key"]=this.ProductGrid[e][i[o].BSysColumnName.toString()+"_Key"].toString());else"DebitAccount"!=i[o].LSysColumnName.toString()&&"CreditAccount"!=i[o].LSysColumnName.toString()||(s.ScreenObject.GridDataColumns.Contains(i[o].LUserColumnName.toString())?s.ScreenObject.GridDataColumns.Contains(i[o].LSysColumnName.toString()+"_Key")&&(r[i[o].LUserColumnName.toString()]=t.ds.Tables[1][0][i[o].BSysColumnName.toString()].toString(),r[i[o].LSysColumnName.toString()+"_Key"]=t.ds.Tables[1][0].SelectedModeID.toString()):"DebitAccount"==i[o].LSysColumnName.toString()?s.ScreenObject.DebitAccount.SelectedValue=parseInt(t.ds.Tables[1][0].SelectedModeID.toString()):"CreditAccount"==i[o].LSysColumnName.toString()&&(s.ScreenObject.CreditAccount.SelectedValue=parseInt(t.ds.Tables[1][0].SelectedModeID.toString())))}if("AddEditCasesViewModel"==this.parent.ClassName){let t=this.parent;if(null!=t.ScreenObject)for(let o=0;o<i.length;o++)s.ScreenObject.GridDataColumns.Contains(i[o].LSysColumnName.toString())&&(i[o].BSysColumnName.toString().toUpperCase().Contains("LDALPHA")&&"73"==i[o].BCostcenterid.toString()?t.dsLoad.Columns[6].Contains(i[o].BSysColumnName.toString())&&(r[i[o].LSysColumnName.toString()]=t.dsLoad.Tables[6][0][i[o].BSysColumnName.toString()].toString()):i[o].BSysColumnName.toString().toUpperCase().Contains("CCNID")&&"156"!=i[o].BCostcenterid.toString()?t.dsLoad.Columns[8].Contains(i[o].BSysColumnName.toString())&&(r[i[o].LSysColumnName.toString()+"_Key"]=t.dsLoad.Tables[8][0][i[o].BSysColumnName.toString()].toString()):i[o].BSysColumnName.toString().toUpperCase().Contains("CCNID")&&"156"==i[o].BCostcenterid.toString()?this.ProductGridObj.TableColumns.Contains(i[o].BSysColumnName.toString())&&(r[i[o].LSysColumnName.toString()+"_Key"]=this.ProductGrid[e][i[o].BSysColumnName.toString()+"_Key"].toString()):i[o].BSysColumnName.toString().toLowerCase().Contains("alpha")&&"156"==i[o].BCostcenterid.toString()||i[o].BSysColumnName.toString().toLowerCase().Contains("description")&&"156"==i[o].BCostcenterid.toString()?this.ProductGridObj.TableColumns.Contains(i[o].BSysColumnName.toString())&&(r[i[o].LSysColumnName.toString()]=this.ProductGrid[e][i[o].BSysColumnName.toString()].toString()):i[o].BSysColumnName.toString().toLowerCase().Contains("crmproduct")&&"156"==i[o].BCostcenterid.toString()&&""!=a.a.SessionManager.Preferences["CRM-Products"].toString()&&"0"!=a.a.SessionManager.Preferences["CRM-Products"].toString()&&this.ProductGridObj.TableColumns.Contains(i[o].BSysColumnName.toString())&&(r[i[o].LSysColumnName.toString()+"_Key"]=this.ProductGrid[e][i[o].BSysColumnName.toString()+"_Key"].toString()))}l&&s.ScreenObject.GridDataObj.addRow(r),s.CalculateTotals(r,!1)}if(s.RefreshGrid=!s.RefreshGrid,null!=i&&i.length>0){if("AddEditLeads"==this.parent.ClassName){let e=null,t=null,a=null,l=this.parent;if(null!=l.ScreenObject){if(this.ProductColumnSource.find(e=>12==e.CostCenterID)){let e=0;for(let t=0;t<this.ProductGrid.length;t++)if(!o.e.IsEmpty(this.ProductGrid[t].ProductID_Key)&&Object(n.j)(this.ProductGrid[t].isChecked)){e=t;break}try{null!=s.Currency&&(s.Currency.Currency.SelectedValue=o.e.IsEmpty(this.ProductGrid[e].CurrencyID_Key)?"1":this.ProductGrid[e].CurrencyID_Key.toString(),s.Currency.ExchangeRate.Text=s.ScreenObject.GetExchangeRate(parseInt(s.Currency.Currency.SelectedValue),s.DocumentDate).toString())}catch(u){}}for(let r=0;r<i.length;r++)for(let d=0;d<s.ScreenObject.CustomTab.Pages.length;d++)for(let u=0;u<s.ScreenObject.CustomTab.Pages[d].Fields.length;u++){let D=s.ScreenObject.CustomTab.Pages[d].Fields[u];if(D instanceof S.c&&null!=D.DBColumnName)if(D instanceof C.d)e=D,l.ds.Columns[4].Contains(i[r].BSysColumnName.toString())&&e.DBColumnID==parseInt(i[r].CostCenterColIDLinked)?e.Text=l.ds.Tables[4][0][i[r].BSysColumnName.toString()].toString():l.ds.Columns[0].Contains(i[r].BSysColumnName.toString())&&e.DBColumnID==parseInt(i[r].CostCenterColIDLinked)?e.Text=l.ds.Tables[0][0][i[r].BSysColumnName.toString()].toString():l.ds.Columns[3].Contains(i[r].BSysColumnName.toString())&&e.DBColumnID==parseInt(i[r].CostCenterColIDLinked)&&(e.Text="SalutationID"==i[r].BSysColumnName.toString()&&l.ds.Columns[3].Contains("Salutation")?l.ds.Tables[3][0].Salutation.toString():("FirstName"==i[r].BSysColumnName.toString()&&l.ds.Columns[3].Contains("FirstName")||"MiddleName"==i[r].BSysColumnName.toString()&&l.ds.Columns[3].Contains("MiddleName ")||"LastName"==i[r].BSysColumnName.toString()&&l.ds.Columns[3].Contains("LastName")||"JobTitle"==i[r].BSysColumnName.toString()&&l.ds.Columns[3].Contains("JobTitle")||"Email"==i[r].BSysColumnName.toString()&&l.ds.Columns[3].Contains("Email")||"Phone1"==i[r].BSysColumnName.toString()&&l.ds.Columns[3].Contains("Phone1")||"Phone2"==i[r].BSysColumnName.toString()&&l.ds.Columns[3].Contains("Phone2"),l.ds.Tables[3][0][i[r].BSysColumnName.toString()].toString()));else if(D instanceof m.e)t=D,l.ds.Columns[4].Contains(i[r].BSysColumnName.toString())&&t.DBColumnID==parseInt(i[r].CostCenterColIDLinked)?D.SelectedValue=l.ds.Tables[4][0][i[r].BSysColumnName.toString()].toString():l.ds.Columns[0].Contains(i[r].BSysColumnName.toString())&&t.DBColumnID==parseInt(i[r].CostCenterColIDLinked)?D.SelectedValue=l.ds.Tables[0][0][i[r].BSysColumnName.toString()].toString():l.ds.Columns[3].Contains(i[r].BSysColumnName.toString())&&t.DBColumnID==parseInt(i[r].CostCenterColIDLinked)&&(D.SelectedValue=l.ds.Tables[3][0][i[r].BSysColumnName.toString()].toString());else if(D instanceof b.b)if(a=D,l.ds.Columns[11].Contains(i[r].BSysColumnName.toString())&&a.DBColumnID==parseInt(i[r].CostCenterColIDLinked)){var h=this.ProductColumnSource.find(e=>e.CostCenterID==a.CCID);if(a.IsAutoLoad=!1,h){let e=0;for(let t=0;t<this.ProductGrid.length;t++)if(!o.e.IsEmpty(this.ProductGrid[t].ProductID_Key)&&null!=this.ProductGrid[t].isChecked.toString()&&Object(n.j)(this.ProductGrid[t].isChecked)){e=t;break}try{a.SelectedValue=parseInt(this.ProductGrid[e][i[r].BSysColumnName.toString()+"_Key"].toString())}catch(c){a.SelectedValue=parseInt(l.ds.Tables[11][0][i[r].BSysColumnName.toString()])}}else a.SelectedValue=parseInt(l.ds.Tables[11][0][i[r].BSysColumnName.toString()])}else if("26636"==i[r].CostCenterColIDBase.toString()&&a.DBColumnID==parseInt(i[r].CostCenterColIDLinked))a.IsAutoLoad=!1,a.SelectedValue=null!=this.parent.ContactList&&null!=this.parent.ContactList.SelectedValue&&""!=this.parent.ContactList.SelectedValue?parseInt(this.parent.ContactList.SelectedValue):o.e.IsEmpty(l.ds.Tables[0][0].ContactID)?0:parseInt(l.ds.Tables[0][0].ContactID.toString());else if(l.ds.Columns[4].Contains(i[r].BSysColumnName.toString())&&a.DBColumnID==parseInt(i[r].CostCenterColIDLinked))a.IsAutoLoad=!1,a.SelectedValue=o.e.IsEmpty(l.ds.Tables[4][0][i[r].BSysColumnName.toString()])?0:parseInt(l.ds.Tables[4][0][i[r].BSysColumnName.toString()]);else if(l.ds.Columns[0].Contains(i[r].BSysColumnName.toString())&&a.DBColumnID==parseInt(i[r].CostCenterColIDLinked)){a.IsAutoLoad=!1;try{a.SelectedValue=l.ds.Columns[0].Contains("SelectedModeID")&&l.ds.Columns[0].Contains("Mode")&&"3"==l.ds.Tables[0][0].Mode.toString()?o.e.IsEmpty(l.ds.Tables[0][0].SelectedModeID)?0:parseInt(l.ds.Tables[0][0].SelectedModeID):0,44==a.CCID&&(a.SelectedValue=l.ds.Columns[0].Contains(i[r].BSysColumnName.toString())?o.e.IsEmpty(l.ds.Tables[0][0][i[r].BSysColumnName.toString()])?0:parseInt(l.ds.Tables[0][0][i[r].BSysColumnName.toString()]):0)}catch(c){a.SelectedValue=0}}}}}if("AddEditOpportunity"==this.parent.ClassName){let e=null,t=null,a=null,l=this.parent;if(null!=l.ScreenObject){if(this.ProductColumnSource.find(e=>12==e.CostCenterID)){let e=0;for(let t=0;t<this.ProductGrid.length;t++)if(!o.e.IsEmpty(this.ProductGrid[t].ProductID_Key)&&Object(n.j)(this.ProductGrid[t].isChecked)){e=t;break}try{null!=s.Currency&&(s.Currency.Currency.SelectedValue=o.e.IsEmpty(this.ProductGrid[e].CurrencyID_Key)?"1":this.ProductGrid[e].CurrencyID_Key.toString(),s.Currency.ExchangeRate.Text=s.ScreenObject.GetExchangeRate(parseInt(s.Currency.Currency.SelectedValue),s.DocumentDate).toString())}catch(p){}}for(let r=0;r<i.length;r++)for(let d=0;d<s.ScreenObject.CustomTab.Pages.length;d++)for(let u=0;u<s.ScreenObject.CustomTab.Pages[d].Fields.length;u++){let D=s.ScreenObject.CustomTab.Pages[d].Fields[u];if(D instanceof S.c&&null!=D.DBColumnName)if(D instanceof C.d)e=D,l.ds.Columns[8].Contains(i[r].BSysColumnName.toString())&&e.DBColumnID==parseInt(i[r].CostCenterColIDLinked)?e.Text=l.ds.Tables[8][0][i[r].BSysColumnName.toString()].toString():l.ds.Columns[13].Contains(i[r].BSysColumnName.toString())&&e.DBColumnID==parseInt(i[r].CostCenterColIDLinked)?e.Text=null!=l.ds&&l.ds.Tables[13].length>0&&("FirstName"==i[r].BSysColumnName.toString()&&l.ds.Columns[13].Contains("FirstName")||"MiddleName"==i[r].BSysColumnName.toString()&&l.ds.Columns[13].Contains("MiddleName ")||"LastName"==i[r].BSysColumnName.toString()&&l.ds.Columns[13].Contains("LastName")||"JobTitle"==i[r].BSysColumnName.toString()&&l.ds.Columns[13].Contains("JobTitle")||"Email"==i[r].BSysColumnName.toString()&&l.ds.Columns[13].Contains("Email")||"Phone1"==i[r].BSysColumnName.toString()&&l.ds.Columns[13].Contains("Phone1")||"Phone2"==i[r].BSysColumnName.toString()&&l.ds.Columns[13].Contains("Phone2"))?l.ds.Tables[13][0][i[r].BSysColumnName.toString()].toString():"SalutationID"==i[r].BSysColumnName.toString()&&l.ds.Columns[13].Contains("Salutation")?l.ds.Tables[13][0].Salutation.toString():l.ds.Tables[13][0][i[r].BSysColumnName.toString()].toString():(l.ds.Columns[1].Contains(i[r].BSysColumnName.toString())&&e.DBColumnID==parseInt(i[r].CostCenterColIDLinked)&&"Subject"==i[r].BSysColumnName.toString()&&l.ds.Columns[1].Contains("Subject")||l.ds.Columns[1].Contains(i[r].BSysColumnName.toString())&&e.DBColumnID==parseInt(i[r].CostCenterColIDLinked))&&(e.Text=l.ds.Tables[1][0][i[r].BSysColumnName.toString()].toString());else if(D instanceof m.e)t=D,l.ds.Columns[8].Contains(i[r].BSysColumnName.toString())&&e.DBColumnID==parseInt(i[r].CostCenterColIDLinked)&&(D.SelectedValue=l.ds.Tables[8][0][i[r].BSysColumnName.toString()].toString());else if(D instanceof b.b)if(a=D,l.ds.Columns[11].Contains(i[r].BSysColumnName.toString())&&a.DBColumnID==parseInt(i[r].CostCenterColIDLinked))if(h=this.ProductColumnSource.find(e=>e.CostCenterID==a.CCID),a.IsAutoLoad=!1,h){let e=0;for(let t=0;t<this.ProductGrid.length;t++)if(!o.e.IsEmpty(this.ProductGrid[t].ProductID_Key)&&Object(n.j)(this.ProductGrid[t].isChecked)){e=t;break}try{a.SelectedValue=parseInt(this.ProductGrid[e][i[r].BSysColumnName.toString()+"_Key"].toString()),s.ScreenObject.GetLinkReferenceData(a.DBColumnID,s.CostCenterID,a.SelectedValue,s.DocumentDate,a.DBColumnName,a.CCID,null)}catch(c){a.SelectedValue=parseInt(l.ds.Tables[11][0][i[r].BSysColumnName.toString()])}}else a.SelectedValue=parseInt(l.ds.Tables[11][0][i[r].BSysColumnName.toString()]);else if("25402"==i[r].CostCenterColIDBase.toString()&&a.DBColumnID==parseInt(i[r].CostCenterColIDLinked))a.IsAutoLoad=!1,a.SelectedValue=null!=this.parent.ContactCombo&&null!=this.parent.ContactCombo.SelectedValue&&""!=this.parent.ContactCombo.SelectedValue?parseInt(this.parent.ContactCombo.SelectedValue):o.e.IsEmpty(l.ds.Tables[1][0].ContactID)?0:parseInt(l.ds.Tables[1][0].ContactID.toString());else if(l.ds.Columns[8].Contains(i[r].BSysColumnName.toString())&&a.DBColumnID==parseInt(i[r].CostCenterColIDLinked))a.IsAutoLoad=!1,a.SelectedValue=o.e.IsEmpty(l.ds.Tables[8][0][i[r].BSysColumnName.toString()])?0:parseInt(l.ds.Tables[8][0][i[r].BSysColumnName.toString()]);else if(l.ds.Columns[1].Contains(i[r].BSysColumnName.toString())&&a.DBColumnID==parseInt(i[r].CostCenterColIDLinked)){a.IsAutoLoad=!1;try{a.SelectedValue=l.ds.Columns[1].Contains("CustomerID")||l.ds.Columns[1].Contains("SelectedModeID")?l.ds.Columns[1].Contains("Mode")&&"4"==l.ds.Tables[1][0].Mode.toString()?o.e.IsEmpty(l.ds.Tables[1][0].CustomerID)?0:parseInt(l.ds.Tables[1][0].CustomerID):l.ds.Columns[1].Contains("Mode")&&"3"==l.ds.Tables[1][0].Mode.toString()?o.e.IsEmpty(l.ds.Tables[1][0].SelectedModeID)?0:parseInt(l.ds.Tables[1][0].SelectedModeID):0:0,44==a.CCID&&(a.SelectedValue=l.ds.Columns[1].Contains(i[r].BSysColumnName.toString())&&""!=l.ds.Tables[1][0][i[r].BSysColumnName.toString()].toString()?parseInt(l.ds.Tables[1][0][i[r].BSysColumnName.toString()]):0)}catch(c){a.SelectedValue=0}}}}}if("AddEditCasesViewModel"==this.parent.ClassName&&null!=this.parent.ScreenObject)for(let e=0;e<i.length;e++){for(let t=0;t<s.ScreenObject.CustomTab.Pages.length;t++)s.ScreenObject.CustomTab.Pages[t].Fields.forEach(t=>{t instanceof S.c&&null!=t.DBColumnName&&this.mapCaseField(t,i,e)});s.ScreenObject.HeaderFields.forEach(t=>{t instanceof S.c&&null!=t.DBColumnName&&this.mapCaseField(t,i,e)})}}s.ScreenObject.HeaderFields.forEach(e=>{e instanceof D.d?e.SetFocus=!0:e instanceof g.a&&e.TextBox.SetFocus?e.TextBox.SetFocus=!1:e instanceof S.c&&e.SetFocus&&(e.SetFocus=!1)}),s.ScreenObject.SetDefaultValuesforCostCenters(0);for(let e=0;e<s.ScreenObject.GridData.length;e++)o.e.IsEmpty(s.ScreenObject.GridData[e].ProductID_Key)||s.CalculateTotals(s.ScreenObject.GridData[e],!1)})}}mapCaseField(e,t,s){let i=null,n=null,l=null,r=null,d=this.parent;e instanceof C.d?(i=e,"assigneddate"!=t[s].BSysColumnName.toString().toLowerCase()&&"createddate"!=t[s].BSysColumnName.toString().toLowerCase()&&"assignedto"!=t[s].BSysColumnName.toString().toLowerCase()&&"customerid"!=t[s].BSysColumnName.toString().toLowerCase()||i.DBColumnID!=parseInt(t[s].CostCenterColIDLinked)?d.dsLoad.Columns[6].Contains(t[s].BSysColumnName.toString())&&i.DBColumnID==parseInt(t[s].CostCenterColIDLinked)?i.Text=d.dsLoad.Tables[6][0][t[s].BSysColumnName.toString()].toString():d.dsLoad.Columns[9].Contains(t[s].BSysColumnName.toString())&&i.DBColumnID==parseInt(t[s].CostCenterColIDLinked)?i.Text=d.dsLoad.Tables[9][0][t[s].BSysColumnName.toString()].toString():d.dsLoad.Columns[4].Contains(t[s].BSysColumnName.toString())&&i.DBColumnID==parseInt(t[s].CostCenterColIDLinked)&&(i.Text=d.dsLoad.Tables[4][0][t[s].BSysColumnName.toString()].toString()):"assigneddate"==t[s].BSysColumnName.toString().toLowerCase()?o.e.IsEmpty(d.dsLoad.Tables[4][0].ADate)||(i.Text=new Date(d.dsLoad.Tables[4][0].ADate.toString()).ToString(a.a.SessionManager.Preferences["Date Format"])):"createddate"==t[s].BSysColumnName.toString().toLowerCase()?o.e.IsEmpty(d.dsLoad.Tables[4][0].CDAte)||(i.Text=new Date(d.dsLoad.Tables[4][0].CDAte.toString()).ToString(a.a.SessionManager.Preferences["Date Format"])):"assignedto"==t[s].BSysColumnName.toString().toLowerCase()?o.e.IsEmpty(d.dsLoad.Tables[4][0].AssignedUser)||(i.Text=d.dsLoad.Tables[4][0].AssignedUser.toString()):"customerid"==t[s].BSysColumnName.toString().toLowerCase()&&(o.e.IsEmpty(d.dsLoad.Tables[4][0].Customer)||(i.Text=d.dsLoad.Tables[4][0].Customer.toString()))):e instanceof m.e?(n=e,d.dsLoad.Columns[6].Contains(t[s].BSysColumnName.toString())&&n.DBColumnID==parseInt(t[s].CostCenterColIDLinked)?e.SelectedValue=d.dsLoad.Tables[6][0][t[s].BSysColumnName.toString()].toString():d.dsLoad.Columns[9].Contains(t[s].BSysColumnName.toString())&&n.DBColumnID==parseInt(t[s].CostCenterColIDLinked)?e.SelectedValue=d.dsLoad.Tables[9][0][t[s].BSysColumnName.toString()].toString():d.dsLoad.Columns[4].Contains(t[s].BSysColumnName.toString())&&n.DBColumnID==parseInt(t[s].CostCenterColIDLinked)&&(e.SelectedValue=d.dsLoad.Tables[4][0][t[s].BSysColumnName.toString()].toString())):e instanceof b.b?(l=e,d.dsLoad.Columns[8].Contains(t[s].BSysColumnName.toString())&&l.DBColumnID==parseInt(t[s].CostCenterColIDLinked)?(l.IsAutoLoad=!1,l.SelectedValue=parseInt(d.dsLoad.Tables[8][0][t[s].BSysColumnName.toString()])):d.dsLoad.Columns[6].Contains(t[s].BSysColumnName.toString())&&l.DBColumnID==parseInt(t[s].CostCenterColIDLinked)&&""!=d.dsLoad.Tables[12][0][t[s].BSysColumnName.toString()].toString()?o.e.IsNum(d.dsLoad.Tables[6][0][t[s].BSysColumnName.toString()])&&(l.IsAutoLoad=!1,l.SelectedValue=parseInt(d.dsLoad.Tables[6][0][t[s].BSysColumnName.toString()].toString())):d.dsLoad.Columns[4].Contains(t[s].BSysColumnName.toString())&&l.DBColumnID==parseInt(t[s].CostCenterColIDLinked)&&o.e.IsNum(d.dsLoad.Tables[4][0][t[s].BSysColumnName.toString()])&&(l.IsAutoLoad=!1,l.SelectedValue=parseInt(d.dsLoad.Tables[4][0][t[s].BSysColumnName.toString()]))):e instanceof p.a&&(r=e,d.dsLoad.Columns[8].Contains(t[s].BSysColumnName.toString())&&r.DBColumnID==parseInt(t[s].CostCenterColIDLinked)?r.SelectedValue=parseInt(d.dsLoad.Tables[8][0][t[s].BSysColumnName.toString()]):d.dsLoad.Columns[6].Contains(t[s].BSysColumnName.toString())&&r.DBColumnID==parseInt(t[s].CostCenterColIDLinked)&&""!=d.dsLoad.Tables[6][0][t[s].BSysColumnName.toString()].toString()?o.e.IsNum(d.dsLoad.Tables[6][0][t[s].BSysColumnName.toString()])&&(r.SelectedValue=parseInt(d.dsLoad.Tables[6][0][t[s].BSysColumnName.toString()].toString())):d.dsLoad.Columns[4].Contains(t[s].BSysColumnName.toString())&&r.DBColumnID==parseInt(t[s].CostCenterColIDLinked)&&o.e.IsNum(d.dsLoad.Tables[4][0][t[s].BSysColumnName.toString()])&&(r.SelectedValue=parseInt(d.dsLoad.Tables[4][0][t[s].BSysColumnName.toString()])))}onCopy(e){e.Column.DataGridOwner.CommitEdit();let t="";t=e.column.field;for(let i=0;i<this.ProductGrid.length;i++)if(o.e.Int(this.ProductGrid[i].ProductID_Key)>0||o.e.Int(this.ProductGrid[i].CRMProduct_Key)>0){if(this.ProductGrid[i][t]=o.e.String(e.Item.Row[t]),"DataGridDateColumn"==e.column.className&&this.ProductGridObj.TableColumns.Contains(t+"_key"))this.ProductGrid[i][t+"_key"]=e.Item.Row[t+"_key"].toString();else if("DataGridPactListBoxColumn"==e.column.className){var s=this.ProductColumnSource.find(e=>e.DisplayMember==t);s&&(this.ProductGrid[i][s.ValueMember]=e.Item.Row[s.ValueMember].toString())}this.CalculateTotals(this.ProductGrid[i])}}onSearchProduct(e){return Object(i.b)(this,void 0,void 0,(function*(){if("DataGridPactListBoxColumn"==e.column.className&&3==e.column.CostCenterID){const{ProductSearchCatalogViewModel:e}=yield Promise.resolve().then(s.bind(null,"JUeo")),{ProductSearchCatalogComponent:t}=yield Promise.resolve().then(s.bind(null,"V52s"));a.a.page.ShowDialog(new e(this,268,3,null,null),t)}}))}static GetValidXml(e){return(e=(e=(e=e.Replace("&","&amp;")).Replace("'","&apos;&apos;")).Replace('"',"&quot;")).Replace("<","&lt;")}ConstructFormula(){this.eval=new y.b,this.fldDict=new T.a;let e=new y.c;e=new y.c,e.setFieldDetails("RATE",3,1,"",0,!1,!1),this.fldDict.push("RATE",e),e=new y.c,e.setFieldDetails("QTY",3,1,"",0,!1,!1),this.fldDict.push("QTY",e),this.ProductColumnSource.forEach(t=>{this.fldDict.ContainsKey(t.Header)||(e=new y.c,e.setFieldDetails(t.Header,3,1,"",0,!1,!1),this.fldDict.push(t.Header,e))})}static GetValidXmlReserve(e){return(e=(e=(e=e.Replace("&amp;","&")).Replace("''","'")).Replace("&quot;",'"')).Replace("&lt;","<")}GetProductXML(){let e="";for(let t=0;t<this.ProductGrid.length;t++)if(!o.e.IsEmpty(this.ProductGrid[t].ProductID_Key)){e+="<Row ",e+=' Product="'+this.ProductGrid[t].ProductID_Key.toString()+'"',""!=a.a.SessionManager.Preferences["CRM-Products"].toString()&&"0"!=a.a.SessionManager.Preferences["CRM-Products"].toString()?e+=' CRMProduct="'+this.ProductGrid[t].CRMProduct_Key.toString()+'"':e+=' CRMProduct="0"',e+=' Desc="'+M.GetValidXml(o.e.StringValue(this.ProductGrid[t].Description))+'"',e+=' UOM="'+o.e.String(this.ProductGrid[t].UOM_Key)+'"',e+=' Qty="'+o.e.String(this.ProductGrid[t].Qty)+'" ',o.e.IsEmpty(this.ProductGrid[t].CurrencyID_Key)?e+=' Currency="1" ':e+=' Currency="'+o.e.String(this.ProductGrid[t].CurrencyID_Key)+'" ';for(let s=0;s<this.ProductColumnSource.length;s++)"DATE"==this.ProductColumnSource[s].DataType&&this.ProductColumnSource[s].DisplayMember.toLowerCase().Contains("alpha")?o.e.IsEmpty(this.ProductGrid[t][this.ProductColumnSource[s].DisplayMember+"_Key"])||(e+=this.ProductColumnSource[s].DisplayMember+'="'+new Date(this.ProductGrid[t][this.ProductColumnSource[s].DisplayMember+"_Key"].toString()).ToString("dd/MMM/yyyy")+'" '):"DATETIME"!=this.ProductColumnSource[s].DataType&&"TIME"!=this.ProductColumnSource[s].DataType||!this.ProductColumnSource[s].DisplayMember.toLowerCase().Contains("alpha")?"ComboBox"==this.ProductColumnSource[s].DataType&&this.ProductColumnSource[s].ValueBinding.toLowerCase().Contains("alpha")?e+=this.ProductColumnSource[s].ValueBinding+'="'+C.d.GetValidXml(this.ProductGrid[t][this.ProductColumnSource[s].ValueBinding].toString())+'" ':"PactComboBox"==this.ProductColumnSource[s].DataType&&this.ProductColumnSource[s].ValueBinding.toLowerCase().Contains("alpha")?e+=this.ProductColumnSource[s].ValueBinding+'="'+C.d.GetValidXml(this.ProductGrid[t][this.ProductColumnSource[s].ValueBinding+"_Key"].toString())+'" ':"LISTBOX"==this.ProductColumnSource[s].DataType&&0!=this.ProductColumnSource[s].CostCenterID&&this.ProductColumnSource[s].DisplayMember.toLowerCase().Contains("alpha")?e+=this.ProductColumnSource[s].DisplayMember+'="'+this.ProductGrid[t][this.ProductColumnSource[s].ValueMember].toString()+'" ':this.ProductColumnSource[s].DisplayMember.toLowerCase().Contains("alpha")&&(e+=this.ProductColumnSource[s].DisplayMember+'="'+C.d.GetValidXml(this.ProductGrid[t][this.ProductColumnSource[s].DisplayMember].toString())+'" '):o.e.IsEmpty(this.ProductGrid[t][this.ProductColumnSource[s].DisplayMember+"_Key"])||(e+=this.ProductColumnSource[s].DisplayMember+'="'+new Date(this.ProductGrid[t][this.ProductColumnSource[s].DisplayMember+"_Key"].toString()).ToString("dd/MMM/yyyy hh:mm:ss tt")+'" ');for(let s=1;s<=50;s++)o.e.IsEmpty(this.ProductGrid[t]["CCNID"+s+"_Key"])||"0"==this.ProductGrid[t]["CCNID"+s+"_Key"].toString()?e+=" CCNID"+s+'="1"':e+=" CCNID"+s+'="'+this.ProductGrid[t]["CCNID"+s+"_Key"].toString()+'"';e+="/>"}return e.length>0&&(e="<XML>"+e+"</XML>"),Logger.InfoLog("OpportunityProductXML::Exiting GetXML which RETURN XML="+e),e.toString()}GetCRMProductName(){let e=null;""!=a.a.SessionManager.Preferences["CRM-Products"].toString()&&"0"!=a.a.SessionManager.Preferences["CRM-Products"].toString()&&(e=a.a.admin.GetTableData(parseInt(a.a.SessionManager.Preferences["CRM-Products"].toString())),null!=e&&(this.dbCRMProduct=e.Tables[0]))}LoadProductData(e,t){if(null==e&&0==e.length)return;this.ProductGridObj.Clear(),this.GetCRMProductName();let s=null;for(let r=0;r<e.length;r++){let d=e[r];if(s=this.ProductGridObj.NewRow(),s.ProductID_Key=d.ProductID,s.isChecked=!1,s.CRMProduct_Key=d.CRMProduct,null!=this.dbCRMProduct){let e=this.dbCRMProduct.filter(e=>e.NODEID==d.CRMProduct);e.length>0&&(s.CRMProduct=e[0].Name)}s.ProductName=d.ProductName,s.ProductCode=d.ProductCode,s.Description=M.GetValidXmlReserve(d.Description.toString()),s.Qty=d.Quantity,s.UOM=d.UnitName,s.isEdit=!0,s.UOM_Key=d.UOMID,s.CurrencyID=d.CurrName,s.CurrencyID_Key=d.CurrencyID;for(let e=0;e<this.ProductColumnSource.length;e++)if(this.ProductColumnSource[e].CostCenterID>0)this.ProductColumnSource[e].DisplayMember.toLowerCase().Contains("alpha")&&o.e.IsNum(d[this.ProductColumnSource[e].DisplayMember])&&(s[this.ProductColumnSource[e].DisplayMember+"_Key"]=d[this.ProductColumnSource[e].DisplayMember]);else if("DATE"==this.ProductColumnSource[e].DataType||"DATETIME"==this.ProductColumnSource[e].DataType||"TIME"==this.ProductColumnSource[e].DataType){if(!o.e.IsEmpty(d[this.ProductColumnSource[e].DisplayMember]))if("DATETIME"==this.ProductColumnSource[e].DataType)try{s[this.ProductColumnSource[e].DisplayMember]=new Date(d[this.ProductColumnSource[e].DisplayMember].toString()).ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss tt"),s[this.ProductColumnSource[e].DisplayMember+"_Key"]=d[this.ProductColumnSource[e].DisplayMember].toString()}catch(i){}else if("TIME"==this.ProductColumnSource[e].DataType)try{s[this.ProductColumnSource[e].DisplayMember]=new Date(d[this.ProductColumnSource[e].DisplayMember].toString()).ToString("hh:mm:ss tt"),s[this.ProductColumnSource[e].DisplayMember+"_Key"]=d[this.ProductColumnSource[e].DisplayMember].toString()}catch(n){}else try{s[this.ProductColumnSource[e].DisplayMember]=new Date(d[this.ProductColumnSource[e].DisplayMember].toString()).ToString(a.a.SessionManager.Preferences["Date Format"]),s[this.ProductColumnSource[e].DisplayMember+"_Key"]=new Date(d[this.ProductColumnSource[e].DisplayMember].toString())}catch(l){}}else"ComboBox"==this.ProductColumnSource[e].DataType?s[this.ProductColumnSource[e].ValueBinding]=d[this.ProductColumnSource[e].ValueBinding]:"PactComboBox"==this.ProductColumnSource[e].DataType?(s[this.ProductColumnSource[e].ValueBinding]=d[this.ProductColumnSource[e].ValueBinding],s[this.ProductColumnSource[e].ValueBinding+"_Key"]=d[this.ProductColumnSource[e].ValueBinding]):"FLOAT"==this.ProductColumnSource[e].DataType?o.e.IsNum(d[this.ProductColumnSource[e].DisplayMember])&&(s[this.ProductColumnSource[e].DisplayMember]=d[this.ProductColumnSource[e].DisplayMember]):t.Contains(this.ProductColumnSource[e].DisplayMember)&&(s[this.ProductColumnSource[e].DisplayMember]=d[this.ProductColumnSource[e].DisplayMember]);for(let e=1;e<=50;e++)o.e.IsEmpty(d["CCNID"+e+"_Key"])||(s["CCNID"+e+"_Key"]=d["CCNID"+e+"_Key"].toString(),s["CCNID"+e]=d["CCNID"+e].toString());this.ProductGridObj.addRow(s)}this.CalculateProductvalue();for(let a=e.length;a<15;a++)this.ProductGridObj.addEmptyRow(),this.ProductGrid[a][0]=!1;this.ProductGridObj.refreshDataView()}FillDefaultValues(e){this.ProductColumnSource.forEach(t=>{!o.e.IsEmpty(t.DefaultValue)&&null!=t.ValueBinding&&""!=t.ValueBinding&&t.ValueBinding.toLowerCase().Contains("alpha")?""==e[t.ValueBinding].toString()&&(e[t.ValueBinding]=t.DefaultValue):!o.e.IsEmpty(t.DefaultValue)&&null!=t.DisplayMember&&""!=t.DisplayMember&&t.DisplayMember.toLowerCase().Contains("alpha")&&""==e[t.DisplayMember].toString()&&(o.e.IsEmpty(t.DefaultValue)||"today"!=t.DefaultValue.toLowerCase()?e[t.DisplayMember]=t.DefaultValue:"DATETIME"==t.DataType?(e[t.DisplayMember+"_Key"]=new Date,e[t.DisplayMember]=e[t.DisplayMember+"_Key"].ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss tt")):"TIME"==t.DataType?(e[t.DisplayMember+"_Key"]=new Date,e[t.DisplayMember]=e[t.DisplayMember+"_Key"].ToString("hh:mm:ss tt")):"DATE"==t.DataType&&(e[t.DisplayMember]=Date.Today().ToString(a.a.SessionManager.Preferences["Date Format"]),e[t.DisplayMember+"_Key"]=Date.Today()))})}PopulateSuppliersBasedOnCRMProduct(e){if(""!=e.CRMProduct_Key.toString()&&0!=parseInt(e.CRMProduct_Key.toString())&&!(e.Table.Select("CRMProduct_Key="+e.CRMProduct_Key.toString()).length>1||null==this.parent||"AddEditLeads"!=this.parent.ClassName&&"AddEditOpportunity"!=this.parent.ClassName)){let i=null;if("AddEditLeads"==this.parent.ClassName){let e=this.parent;null!=e.ScreenObject&&(i=e.ScreenObject.Data)}else if("AddEditOpportunity"==this.parent.ClassName){let e=this.parent;null!=e.ScreenObject&&(i=e.ScreenObject.Data)}let l=null;if(null!=i){if(0==i.Tables.length)return;let r=i.Tables[4].Select("Name='DimensionMappingProfileName'");if(r.length>0&&!o.e.IsEmpty(r[0].Value)){if(0==parseInt(r[0].Value.toString()))return;let d=i.Tables[4].Select("Name='EnableAutoPopulateSuppliers'");if(d.length>0&&!o.e.IsEmpty(d[0].Value)&&!Object(n.j)(d[0].Value.toString()))return;null!=this.ProductColumnSource&&(d=i.Tables[4].Select("Name='AutoPupulateSuppliers'"),d.length>0&&!o.e.IsEmpty(d[0].Value)&&(l=this.ProductColumnSource.find(e=>0!=e.CostCenterID&&e.CostCenterID==parseInt(d[0].Value))));let c=[];c.push(this.CRMProductCCID),c.push(e.CRMProduct_Key.toString()),c.push(r[0].Value),c.push(a.a.SessionManager.UserID),c.push(a.a.SessionManager.LanguageID);let u=a.a.admin.GetDimensionMappingByFilter(c);if(null!=u&&u.Tables.length>0&&u.Tables[0].length>0){let i=u.Tables[0],n=u.Columns[0],r=new Array,d=null,c=null,C=new Array;if(u.Columns[0].Contains("DefXml")){d=new o.f,d.LoadXml(i[0].DefXml.toString()),c=d.SelectNodes("XML/Row");for(let e=0;e<c.length;e++)null!=c[e].attributes.cols&&""!=c[e].attributes.cols.value&&parseInt(c[e].attributes.cols.value)!=this.CRMProductCCID&&r.push(parseInt(c[e].attributes.cols.value))}let m=this.ProductGrid.indexOf(e);for(let u=0;u<i.length;u++){m>=this.ProductGrid.length&&this.ProductGridObj.addEmptyRow(),this.ProductGrid[m].CRMProduct=e.CRMProduct.toString(),o.e.IsEmpty(e.CRMProduct_Key)||(this.ProductGrid[m].CRMProduct_Key=e.CRMProduct_Key.toString()),o.e.IsEmpty(e.ProductID_Key)||(this.ProductGrid[m].ProductID_Key=e.ProductID_Key.toString()),this.ProductGrid[m].ProductName=e.ProductName.toString(),this.ProductGrid[m].ProductCode=e.ProductCode.toString(),this.ProductGrid[m].UOM=e.UOM.toString(),this.ProductGrid[m].UOM_Key=e.UOM_Key.toString();for(let e=0;e<n.length;e++)if(this.ProductGridObj.TableColumns.Contains(n[e].toLowerCase())&&n[e].Contains("CCNID")){if(0==r.length)break;if(0==r.find(t=>t==5e4+parseInt(n[e].Replace("CCNID",""))))continue;try{C.push(n[e]),C.push(n[e]+"_key"),this.ProductGrid[m][n[e]+"_key"]=i[u][n[e]].toString(),this.ProductGrid[m][n[e]]=i[u]["CC"+n[e].Replace("CCNID","")].toString()}catch(s){}}for(let t=0;t<this.ProductGridObj.TableColumns.length;t++)this.ProductGridObj.TableColumns[t].toLowerCase().Contains("ccnid")?this.ProductGridObj.TableColumns[t]!=l.DisplayMember&&this.ProductGridObj.TableColumns[t]!=l.ValueMember&&0==C.filter(e=>e.toString().toLowerCase()==this.ProductGridObj.TableColumns[t].toLowerCase()).length&&(this.ProductGrid[m][this.ProductGridObj.TableColumns[t]]=e[this.ProductGridObj.TableColumns[t]].toString()):o.e.IsEmpty(e[this.ProductGridObj.TableColumns[t]])||(this.ProductGrid[m][this.ProductGridObj.TableColumns[t]]=e[this.ProductGridObj.TableColumns[t]].toString());e.Table.Columns.Contains("Description")&&(this.ProductGrid[m].Description=e.Description.toString()),this.FillDefaultValues(this.ProductGrid[m]),null==l&&(l=new h.a);var t=this.ProductColumnSource.find(e=>null!=e.DisplayMember&&e.DisplayMember==l.DisplayMember);if(t&&null!=t.ID){let e=0;86==this.CostCenterID?e=115:73==this.CostCenterID?e=156:89==this.CostCenterID?e=154:88==this.CostCenterID&&(e=155),this.dvCnt=this.dvCntTable.filter(e=>null!=e.LocalReference&&(e.LocalReference==t.ID||26642==e.LocalReference)),this.dvCnt.length>0&&""!=t.ValueMember&&!o.e.IsEmpty(this.ProductGrid[m][t.ValueMember])&&a.a.common.GetLinkReferenceData(parseInt(t.ID),e,parseInt(this.ProductGrid[m][t.ValueMember].toString()),this.ProductGrid[m])}m++}}}}}}OnCellEditEnding(e){let t=e.item;if("DataGridComboBoxColumn"!=e.column.className){if("DataGridPactListBoxColumn"==e.column.className){let n=e.column.field;var s=this.ProductColumnSource.find(e=>null!=e.DisplayMember&&e.DisplayMember==n);if(null!=s&&null!=s.ValueMember&&o.e.IsNum(t[s.ValueMember])&&parseInt(t[s.ValueMember])>0&&parseInt(t[s.ValueMember])==this.ProdID)return;this.CRMProductCCID>0&&(3!=this.CRMProductCCID||"ProductName"!=n||o.e.IsEmpty(t.ProductID_Key)?this.CRMProductCCID>5e4&&"CRMProduct"==n&&!o.e.IsEmpty(t.CRMProduct_Key)&&this.LoadCRMProductData(t,parseInt(t.CRMProduct_Key)):this.LoadCRMProductData(t,parseInt(t.ProductID_Key)));let l=0;if(86==this.CostCenterID?l=115:73==this.CostCenterID?l=156:89==this.CostCenterID?l=154:88==this.CostCenterID&&(l=155),this.FillDefaultValues(t),null==t.ProductID_Key&&""==t.ProductID_Key.toString()&&""!=a.a.SessionManager.Preferences["CRM-Products"].toString()&&"0"!=a.a.SessionManager.Preferences["CRM-Products"].toString()&&null!=this.DS&&this.DS.Tables.length>3&&this.DS.Tables[3].length>0&&this.DS.Tables[3].length>0&&this.DS.Columns[3].Contains("NAME")&&!o.e.IsEmpty(this.DS.Tables[3][0].NAME)&&(this.DS.Tables.length>4&&this.DS.Tables[4].length>0?(t.ProductID_Key=this.DS.Tables[4][0].ProductID.toString(),t.ProductName=this.DS.Tables[4][0].PRODUCTNAME.toString(),t.ProductCode=this.DS.Tables[4][0].PRODUCTCODE.toString()):(t.ProductID_Key="0",t.ProductName="DynamicSet",t.ProductCode="DynamicSet"),this.Load(t,parseInt(t.ProductID_Key))),"ProductName"==n)this.Load(t,parseInt(t.ProductID_Key)),null!=this.dvCnt&&(i=this.ProductColumnSource.find(e=>null!=e.DisplayMember&&e.DisplayMember==n))&&null!=i.ID&&(this.dvCnt=this.dvCntTable.filter(e=>null!=e.LocalReference&&(e.LocalReference==i.ID||26658==e.LocalReference)),this.dvCnt.length>0&&""!=i.ValueMember&&!o.e.IsEmpty(t[i.ValueMember])&&a.a.common.GetLinkReferenceData(26658,l,parseInt(t.ProductID_Key.toString()),t));else if("CRMProduct"==n)null!=this.dvCnt&&(i=this.ProductColumnSource.find(e=>null!=e.DisplayMember&&e.DisplayMember==n))&&null!=i.ID&&(this.dvCnt=this.dvCntTable.filter(e=>null!=e.LocalReference&&(e.LocalReference==i.ID||26642==e.LocalReference)),this.dvCnt.length>0&&""!=i.ValueMember&&!o.e.IsEmpty(t[i.ValueMember])&&a.a.common.GetLinkReferenceData(26642,l,parseInt(t.CRMProduct_Key.toString()),t)),this.PopulateSuppliersBasedOnCRMProduct(t);else if(null!=this.dvCnt){var i;(i=this.ProductColumnSource.find(e=>null!=e.DisplayMember&&e.DisplayMember==n))&&null!=i.ID&&i.CostCenterID>5e4&&(this.dvCnt=this.dvCntTable.filter(e=>null!=e.LocalReference&&e.LocalReference==i.ID),this.dvCnt.length>0&&""!=i.ValueMember&&!o.e.IsEmpty(t[i.ValueMember])&&a.a.common.GetLinkReferenceData(parseInt(i.ID),l,parseInt(t[i.ValueMember]),t))}}this.CalculateProductvalue(),this.CalculateTotals(t),this.ProductGridObj.updateRow(t)}}CalculateProductvalue(){let e=0;if(0!=this.SrcProductValueMapping.length){if(this.SrcProductValueMapping.length>0&&this.ProductGridObj.TableColumns.Contains(this.SrcProductValueMapping))for(let t=0;t<this.ProductGrid.length;t++)!o.e.IsEmpty(this.ProductGrid[t].ProductID_Key)&&o.e.IsNum(this.ProductGrid[t][this.SrcProductValueMapping])&&(e+=parseFloat(this.ProductGrid[t][this.SrcProductValueMapping]));if(this.DestProductValueMapping.length>0){let s=!1;if("AddEditLeads"==this.parent.ClassName){let i=this.parent;if(null!=i.ScreenObject){if(!s){let t=i.ScreenObject.StaticFields.find(e=>e instanceof S.c&&null!=e.DBColumnName&&e.DBColumnName.toLowerCase()==this.DestProductValueMapping.toString().toLowerCase());t instanceof C.d&&(s=!0,t.Text=e.ToString("N2"))}if(!s)for(let s=0;s<i.ScreenObject.CustomTab.Pages.length;s++)if((t=i.ScreenObject.CustomTab.Pages[s].Fields.find(e=>e instanceof S.c&&null!=e.DBColumnName&&e.DBColumnName.toLowerCase()==this.DestProductValueMapping.toString().toLowerCase()))instanceof C.d){t.Text=e.ToString("N2");break}}}else if("AddEditOpportunity"==this.parent.ClassName){let i=this.parent;if(null!=i.ScreenObject&&(s||(t=i.ScreenObject.StaticFields.find(e=>e instanceof S.c&&null!=e.DBColumnName&&e.DBColumnName.toLowerCase()==this.DestProductValueMapping.toString().toLowerCase()))instanceof C.d&&(s=!0,t.Text=e.ToString("N2")),!s))for(let s=0;s<i.ScreenObject.CustomTab.Pages.length;s++){var t;if((t=i.ScreenObject.CustomTab.Pages[s].Fields.find(e=>e instanceof S.c&&null!=e.DBColumnName&&e.DBColumnName.toLowerCase()==this.DestProductValueMapping.toString().toLowerCase()))instanceof C.d){t.Text=e.ToString("N2");break}}}}}}Load(e,t){let s=a.a.inventory.GetProductData(parseInt(e.ProductID_Key.toString()));s.Tables.length>0&&s.Tables[0].length>0&&s.Columns[0].Contains("UOMID")&&!o.e.IsEmpty(s.Tables[0][0].UOMID)&&(e.UOM=s.Tables[0][0].UnitName.toString(),e.UOM_Key=s.Tables[0][0].UOMID.toString()),null==this.ProductColumnSource.find(e=>"Description"==e.Header)||o.e.IsEmpty(e.ProductID_Key)||s.Tables.length>0&&s.Tables[0].length>0&&s.Columns[0].Contains("Description")&&!o.e.IsEmpty(s.Tables[0][0].uomid)&&(e.Description=s.Tables[0][0].Description.toString())}LoadCRMProductData(e,t){let s=null;this.CRMProductCCID>5e4&&(s=a.a.common.GetCostCenterDetails(0,this.CRMProductCCID,t,0));let i=new P.a;i.ProductID=t,s=i.GetCopyProductDetails(t),null!=s&&s.Tables.length>7&&(this.ProductColumnSource.forEach(t=>{if(t.CostCenterID>5e4&&t.CostCenterID!=this.CRMProductCCID&&this.ProductGridObj.TableColumns.Contains("CCNID"+(t.CostCenterID-5e4))){let i="CCNID"+(t.CostCenterID-5e4);e[i+"_Key"]=o.e.StringValue(s.Tables[7][0][i].toString()),e[i]=o.e.StringValue(s.Tables[7][0][i.Replace("CCNID","NAME")])}}),this.ProductGridObj.updateRow(e))}AddProductToGrid(e){let t=a.a.inventory.GetProductData(e);if(null!=t&&t.Tables.length>0&&t.Tables[0].length>0){let s=t.Tables[0][0],i=this.ProductGridObj.NewRow();this.ProductGrid.InsertAt(i,this.RowIndex),i.ProductID_Key=e,i.ProductName=s.ProductName,i.Description=s.Description,i.Qty="1",i.UOM=s.UnitName,i.UOM_Key=s.UOMID}}FillDictionary(e){let t=this.ProductColumnSource;this.fldDict.keys.forEach(s=>{let i=s;var a=t.filter(e=>e.Header==this.fldDict[i].getFieldName());a.length>0&&"ComboBox"==a[0].DataType&&!o.e.IsEmpty(e[a[0].ValueBinding])?this.fldDict[i].setFieldValue(e[a[0].ValueBinding]):a.length>0&&"PactComboBox"==a[0].DataType&&!o.e.IsEmpty(e[a[0].ValueBinding+"_Key"])?this.fldDict[i].setFieldValue(e[a[0].ValueBinding+"_Key"]):a.length>0&&("DATE"==a[0].DataType||"DATETIME"==a[0].DataType||"TIME"==a[0].DataType)&&!o.e.IsEmpty(e[a[0].DisplayMember+"_Key"])?this.fldDict[i].setFieldValue(e[a[0].DisplayMember+"_Key"]):a.length>0&&"ComboBox"!=a[0].DataType&&"DATE"!=a[0].DataType&&"DATETIME"!=a[0].DataType&&"TIME"!=a[0].DataType&&"PactComboBox"!=a[0].DataType&&!o.e.IsEmpty(e[a[0].DisplayMember])?o.e.IsNum(e[a[0].DisplayMember])?this.fldDict[i].setFieldValue(null!=a[0].DecimalPoints&&""!=a[0].DecimalPoints?parseFloat(e[a[0].DisplayMember].toString()).ToString("N"+a[0].DecimalPoints):e[a[0].DisplayMember]):this.fldDict[i].setFieldValue(e[a[0].DisplayMember]):this.fldDict[i].setFieldValue(a.length>0&&("STRING"==a[0].DataType||"TEXT"==a[0].DataType||"LINK"==a[0].DataType)?"":0)}),this.ProductGridObj.TableColumns.Contains("Rate")&&!o.e.IsEmpty(e.Rate)?this.fldDict.RATE.setFieldValue(e.Rate):this.fldDict.RATE.setFieldValue(0),this.ProductGridObj.TableColumns.Contains("Qty")&&!o.e.IsEmpty(e.Qty)?this.fldDict.QTY.setFieldValue(e.Qty):this.fldDict.QTY.setFieldValue(0)}CalculateTotals(e){this.FillDictionary(e);let t,s=this.ProductColumnSource;for(let a=0;a<s.length;a++)if(null!=s[a].Formula&&""!=s[a].Formula&&4!=s[a].SectionID){try{t=this.eval.EvaluateExpression(s[a].Formula,this.fldDict).toString(),o.e.IsNum(t)&&(null!=s[a].DecimalPoints&&""!=s[a].DecimalPoints?e[s[a].DisplayMember]=parseFloat(t.toString()).ToString("N"+s[a].DecimalPoints):null!=t&&(e[s[a].DisplayMember]=t.toString())),this.CalculateProductvalue()}catch(i){Logger.ErrorLog("","Formua evaluation calculate totals",i)}"Qty"==s[a].DisplayMember?this.fldDict.QTY.setFieldValue(e.Qty):"Rate"==s[a].DisplayMember&&this.fldDict.RATE.setFieldValue(e.Rate)}}onBeginEdit(e){let t=e.args;if("DataGridPactListBoxColumn"==e.args.column.className){let n=t.column.internalColumnEditor.collection;var s=this.ProductColumnSource.find(t=>null!=t.DisplayMember&&t.DisplayMember==e.args.column.field);let l=e.args.item;if(this.ProdID=null!=s&&null!=s.ValueMember&&this.ProductGridObj.TableColumns.Contains(s.ValueMember)&&o.e.Int(l[s.ValueMember])>0?parseInt(l[s.ValueMember]):0,11==n.CostCenterID){let e="";this.ProductGridObj.TableColumns.Contains("ProductID_Key")&&(e=l.ProductID_Key.toString());let t=" (BaseID IN ";t+=" (SELECT     BaseID ",t+=" FROM          COM_UOM AS COM_UOM_1 with(nolock) ",t=t+" WHERE      (UOMID =(select UOMID from inv_product with(nolock) where productid="+e+") ))) ",""==e&&(t=" (BaseID IN ",t+=" (SELECT     BaseID ",t+=" FROM          COM_UOM AS COM_UOM_1 with(nolock) ",t+=" WHERE      (UOMID =-1 ))) "),n.FilterCondition=t}else if(3==n.CostCenterID)""!=a.a.SessionManager.Preferences["CRM-Products"].toString()&&"0"!=a.a.SessionManager.Preferences["CRM-Products"].toString()&&null!=this.DS&&this.DS.Tables.length>3&&this.DS.Tables[3].length>0&&this.DS.Tables[3].length>0&&this.DS.Columns[3].Contains("NAME")&&!o.e.IsEmpty(this.DS.Tables[3][0].NAME)&&(this.DS.Tables.length>4&&this.DS.Tables[4].length>0?(l.ProductID_Key=this.DS.Tables[4][0].ProductID.toString(),l.ProductName=this.DS.Tables[4][0].PRODUCTNAME.toString(),l.ProductCode=this.DS.Tables[4][0].PRODUCTCODE.toString()):(l.ProductID_Key="0",l.ProductName="DynamicSet",l.ProductCode="DynamicSet"),this.Load(l,parseInt(l.ProductID_Key)),t.Cancel=!0);else if(n.CostCenterID>5e4&&""!=s.DependantOn){let e="";if(s.Dependantinuse)this.ProductGridObj.TableColumns.Contains(s.DependantOn+"_Key")&&o.e.Int(l[s.DependantOn+"_Key"])>1&&(e="("+s.DependantOn+"="+l[s.DependantOn+"_Key"].toString(),1==s.Dependancy&&(e+=" OR "+s.DisplayMember.Replace("dc","")+"=1 "),e+=")");else if(this.ProductGridObj.TableColumns.Contains(s.DependantOn+"_Key")&&o.e.Int(l[s.DependantOn+"_Key"])>1){var i=this.ProductColumnSource.find(e=>null!=e.DisplayMember&&e.DisplayMember.toLowerCase()==s.DependantOn.toLowerCase());i&&(n.Join=5==s.Dependancy?" join COM_CostCenterCostCenterMap DCCM with(nolock) on a.NodeID=DCCM.NodeID and DCCM.CostCenterID="+s.CostCenterID+" and  DCCM.ParentCostCenterID="+i.CostCenterID+" and DCCM.ParentNodeID="+l[s.DependantOn+"_Key"].toString():" join COM_CostCenterCostCenterMap DCCM with(nolock) on a.NodeID=DCCM.ParentNodeID and DCCM.ParentCostCenterID="+s.CostCenterID+" and  DCCM.CostCenterID="+i.CostCenterID+" and DCCM.NodeID="+l[s.DependantOn+"_Key"].toString())}n.Where=null!=n.FilterCondition&&""!=n.FilterCondition?"and "+e:e}}}ClearGrid(){if(this.bOnClick){for(let e=0;e<this.ProductGrid.length;e++)""!=this.ProductGrid[e].isEdit.toString()&&null!=this.ProductGrid[e].isEdit.toString()||!Object(n.j)(this.ProductGrid[e].isChecked)||o.e.IsEmpty(this.ProductGrid[e].ProductID_Key)||(this.ProductGrid[e].isEdit=!0);this.ProductGridObj.refreshDataView()}else{this.ProductGridObj.Clear();for(let e=0;e<15;e++)this.ProductGridObj.addEmptyRow(),this.ProductGrid[e][0]=!1}}SelectUnselectAll(e){for(let t=0;t<this.ProductGrid.length;t++)0==this.SelectUnCheck&&(this.ProductGridObj.TableColumns.Contains("ProductID_Key")&&o.e.Int(this.ProductGrid[t].ProductID_Key)>0||this.ProductGridObj.TableColumns.Contains("CRMProduct_Key")&&o.e.Int(this.ProductGrid[t].CRMProduct_Key)>0)&&(this.ProductGrid[t].isChecked=e);this.SelectUnCheck=0}OnCheckedChanged(e,t){t||1==this.SelectAll&&(this.SelectUnCheck=1,this.SelectAll=!1)}}},cxZg:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var i=s("fXoL"),a=s("sYmb");let o=(()=>{class e{constructor(e){this.translate=e}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)(i.Tb(a.e))},e.\u0275cmp=i.Nb({type:e,selectors:[["app-view-email-templates"]],decls:29,vars:7,consts:[[1,"master-screen",2,"width","300px"],[1,"PACTHeaderFields","dialogSubBody"],[1,"row","form-row"],[1,"form-group","col-xl-12","col-md-12","col-sm-12","col-xs-12","PACTControl",2,"height","180px"],["FieldDirective","",3,"obj"],[1,"Pactdailogfooter"],[1,"primary-btn-wicon",3,"click"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-rectangle-xmark"]],template:function(e,t){1&e&&(i.Zb(0,"div",0),i.Wc(1,"\n    "),i.Zb(2,"div",1),i.Wc(3,"\n\n        "),i.Zb(4,"div",2),i.Wc(5,"\n            "),i.Zb(6,"div",3),i.Wc(7,"\n                "),i.Vb(8,4),i.Wc(9,"\n            "),i.Yb(),i.Wc(10,"\n        "),i.Yb(),i.Wc(11,"\n\n    "),i.Yb(),i.Wc(12,"\n    "),i.Zb(13,"div",5),i.Wc(14,"\n      "),i.Zb(15,"div"),i.Wc(16,"\n        "),i.Zb(17,"button",6),i.hc("click",(function(){return t.obj.OnSave("OK")})),i.Wc(18),i.mc(19,"translate"),i.Yb(),i.Wc(20,"\n        "),i.Zb(21,"button",7),i.hc("click",(function(){return t.obj.OnSave("Cancel")})),i.Ub(22,"i",8),i.Wc(23),i.mc(24,"translate"),i.Yb(),i.Wc(25,"\n      "),i.Yb(),i.Wc(26,"\n  "),i.Yb(),i.Wc(27,"\n"),i.Yb(),i.Wc(28,"\n")),2&e&&(i.Db(8),i.tc("obj",t.obj.ProductGridObj),i.Db(10),i.Xc(i.nc(19,3,"Com_OK")),i.Db(5),i.Xc(i.nc(24,5,"Cancel")))},encapsulation:2}),e})()},nFYD:function(e,t,s){"use strict";s.d(t,"a",(function(){return D}));var i=s("Do2H"),a=s("Lp6j"),o=s("ScVY"),n=s("VxiT"),l=s("8B8H"),r=s("NkMH"),d=s("ockk"),h=s("EQd/"),c=s("JIg3"),u=s("n56n"),C=s("0/4Q"),m=s("Jnyl"),b=s("z5gp"),S=s("E6JT");class D extends o.b{constructor(e){super(),this.Module="CRM",this.Visible=!0,this.ScreenObject=new n.a,this.ColumnSpan="4",this.FeedBackDataObj=new l.a,this.ButtonAdd=new r.a,this.res="";try{let t;this.ClassName="ViewFeedbackViewModel",this.Parent=e,this.ScreenObject.Data=i.a.crmService.GetFeedbackDetails(114),i.a.SessionManager.HideUnathorizedAccess?this.ButtonAdd.Visible=i.a.SessionManager.IsActionAssigned(this.Parent.CostCenterID,"FollowUp_Create"):this.ButtonAdd.Enable=i.a.SessionManager.IsActionAssigned(this.Parent.CostCenterID,"FollowUp_Create"),this.FeedBackDataObj.CanUserAddRows=!0,i.a.SessionManager.IsActionAssigned(this.Parent.CostCenterID,"FollowUp_Delete")&&(this.FeedBackDataObj.CanUserDeleteRows=!0),this.FeedBackDataObj.CanUserResizeColumns=!0,this.FeedBackDataObj.OnLinkClick.Subscribe(this,"OnGridLinkClick"),this.FeedBackDataObj.ContextMenu=[],i.a.SessionManager.IsActionAssigned(this.Parent.CostCenterID,"FollowUp_Update")&&this.FeedBackDataObj.ContextMenu.push("EDIT","EDIT"),i.a.SessionManager.IsActionAssigned(this.Parent.CostCenterID,"FollowUp_Delete")&&this.FeedBackDataObj.ContextMenu.push("DELETE","DELETE"),this.FeedBackDataObj.Table=[],this.FeedBackDataObj.TableColumns.push("NodeID"),this.FeedBackDataObj.TableColumns.push("FeedBack"),this.FeedBackDataObj.TableColumns.push("Date"),this.FeedBackDataObj.TableColumns.push("Date_Key"),this.FeedBackDataObj.TableColumns.push("CreatedBy"),this.FeedBackDataObj.TableColumns.push("View"),this.FeedBackDataObj.TableColumns.push("Imagefilepath"),this.FeedBackDataObj.RowHeight=30,this.FeedBackDataObj.Columns=new Array,t=new d.a,t.Header=i.a.GetResource("View"),t.DisplayMember="View",t.DataType="LINK",t.Width=50,t.IsVisible=!0,t.ReadOnly=!0,this.FeedBackDataObj.Columns.push(t),t=new d.a,t.Header=i.a.GetResource("Feed_Date"),t.DisplayMember="Date",t.DataType="TEXTBOX",t.Width=150,t.IsVisible=!0,t.ReadOnly=!0,this.FeedBackDataObj.Columns.push(t),t=new d.a,t.Header=i.a.GetResource("UserName"),t.DisplayMember="CreatedBy",t.DataType="TEXTBOX",t.Width=150,t.IsVisible=!0,t.ReadOnly=!0,this.FeedBackDataObj.Columns.push(t),t=new d.a,t.Header=i.a.GetResource("Image"),t.DisplayMember="Imagefilepath",t.DataType="IMAGE",t.Width=75,t.ReadOnly=!0,this.FeedBackDataObj.Columns.push(t),t=new d.a,t.Header=i.a.GetResource("Feed_Diss"),t.DisplayMember="FeedBack",t.DataType="TEXTBOX",t.Width=350,t.IsVisible=!0,t.ReadOnly=!0,this.FeedBackDataObj.Columns.push(t);for(let e=0;e<this.ScreenObject.Data.Tables[0].length;e++)"True"==this.ScreenObject.Data.Tables[0][e].IsVisible.toString()&&this.ScreenObject.Data.Tables[0][e].SysColumnName.toString().Contains("CCNID")?(t=new d.a,t.Header=this.ScreenObject.Data.Tables[0][e].UserColumnName.toString(),t.CostCenterID=parseInt(this.ScreenObject.Data.Tables[0][e].ColumnCostCenterID),t.TypeID=1,t.DataType="LISTBOX",t.DisplayMember=this.ScreenObject.Data.Tables[0][e].SysColumnName.toString(),t.ValueMember=this.ScreenObject.Data.Tables[0][e].SysColumnName.toString()+"_Key",t.Width=170,t.IsVisible=!0,t.ReadOnly=!0,this.FeedBackDataObj.Columns.push(t),this.FeedBackDataObj.TableColumns.push(t.DisplayMember),this.FeedBackDataObj.TableColumns.push(t.ValueMember)):"True"==this.ScreenObject.Data.Tables[0][e].IsVisible.toString()&&this.ScreenObject.Data.Tables[0][e].SysColumnName.toString().Contains("Alpha")&&(t=new d.a,t.Header=this.ScreenObject.Data.Tables[0][e].UserColumnName.toString(),t.DisplayMember=this.ScreenObject.Data.Tables[0][e].SysColumnName.toString(),t.DataType="TEXTBOX",t.Width=150,t.IsVisible=!0,t.ReadOnly=!0,this.FeedBackDataObj.Columns.push(t),this.FeedBackDataObj.TableColumns.push(t.DisplayMember))}catch(t){throw Logger.ErrorLog("ViewFeedbackViewModel:: ViewFeedbackViewModel",t),t}Logger.InfoLog("ViewFeedbackViewModel::Exiting ViewFeedbackViewModel")}get angularGrid(){return this.FeedBackDataObj.angularGrid}get SelectedRow(){return this.FeedBackDataObj.SelectedItem}set SelectedRow(e){this.FeedBackDataObj.SelectedItem=e}get FeedBackData(){return this.FeedBackDataObj.Table}OnGridLinkClick(e,t,s){if("View"==t){this.OnCmnItem_Click("EDIT"),this.Parent.Feedback.FeedbackDate.Enable=!1,this.Parent.Feedback.Feedback.Enable=!1;for(let e=0;e<this.Parent.Feedback.Fields.length;e++)this.Parent.Feedback.Fields[e].Enable=!1;this.Parent.Feedback.ButtonSave.Enable=!1,this.Parent.Feedback.isView=!0}}ViewFeedbackViewModel(){}OnNewClick(e){73==this.Parent.CostCenterID&&(this.Parent.ReportInfoVisibility=!1),this.Parent.Feedback=new S.a(this),this.Parent.Feedback.isView=!1,i.a.page.ShowDialog(this.Parent.Feedback,b.a,{ShowCenter:!0,NoWidth:!0}),this.Parent.FeedbackVisibility=!0}OnCmnItem_Click(e){if(Logger.InfoLog("ViewFeedbackViewModel::Entering OnCmnItem_Click"),null!=e&&"EDIT"==e.toString()){if(!i.a.SessionManager.IsActionAssigned(this.Parent.CostCenterID,"FollowUp_Update")&&!i.a.SessionManager.IsActionAssigned(this.Parent.CostCenterID,"FollowUp_Read"))return;if(null!=this.FeedBackDataObj.SelectedItem&&(this.SelectedRow=this.FeedBackDataObj.SelectedItem,""!=this.SelectedRow.Date.toString())){this.OnNewClick(""),this.Parent.Feedback.FeedbackDate.Date=new Date(this.SelectedRow.Date),this.Parent.Feedback.Feedback.Text=this.SelectedRow.FeedBack.toString(),this.Parent.Feedback.isEdit=!0;for(let e=0;e<this.Parent.Feedback.Fields.length;e++){let t=this.Parent.Feedback.Fields[e];t instanceof h.d?t.Text=this.SelectedRow[t.SysColumnName].toString():t instanceof c.a?t.Date=new Date(this.SelectedRow[t.SysColumnName].toString()):t instanceof C.e?t.SelectedValue=this.SelectedRow[t.SysColumnName].toString():t instanceof m.a?t.TextBox.Text=this.SelectedRow[t.SysColumnName].toString():t instanceof h.c?t.Text=this.SelectedRow[t.SysColumnName].toString():t instanceof u.b&&""!=this.SelectedRow[t.SysColumnName].toString()&&null!=this.SelectedRow[t.SysColumnName]&&(t.SelectedValue=parseInt(this.SelectedRow[t.SysColumnName+"_Key"]))}}}else if(null!=e&&"DELETE"==e.toString()){if(!i.a.SessionManager.IsActionAssigned(this.Parent.CostCenterID,"FollowUp_Delete"))return;null!=this.FeedBackDataObj.SelectedItem&&(this.SelectedRow=this.FeedBackDataObj.SelectedItem,this.FeedBackDataObj.removeRow(this.SelectedRow))}Logger.InfoLog("ViewFeedbackViewModel::Exiting OnCmnItem_Click")}OnMessageCallBack(){this.res="Yes"}GetXML(){try{let e="";e+="<XML>";for(let t=0;t<this.FeedBackDataObj.Table.length;t++)""!=this.FeedBackDataObj.Table[t].Date.toString()&&(e+="<Row ",e+=' Date="'+this.FeedBackDataObj.Table[t].Date+'"',e+=' FeedBack="'+h.d.GetValidXml(this.FeedBackDataObj.Table[t].FeedBack.toString())+'"',e+=' CreatedBy="'+this.FeedBackDataObj.Table[t].CreatedBy.toString()+'" ',this.FeedBackDataObj.Columns.forEach(s=>{s.DisplayMember.Contains("CCNID")?e+=s.DisplayMember+'="'+this.FeedBackDataObj.Table[t][s.ValueMember].toString()+'" ':s.DisplayMember.Contains("Alpha")&&(e+=s.DisplayMember+'="'+h.d.GetValidXml(this.FeedBackDataObj.Table[t][s.DisplayMember].toString())+'"')}),e+="></Row>  ");return e+="</XML>",e.toString()}catch(e){return""}}static GetValidXmlReserve(e){return null==e||null==e?"":e=(e=(e=(e=e.Replace("&amp;","&")).Replace("''","'")).Replace("&quot;",'"')).Replace("&lt;","<")}LoadData(e){this.FeedBackDataObj.Table.Clear();try{for(let t=0;t<e.length;t++){let s=this.FeedBackDataObj.NewRow();s.NodeID=e[t].NodeID,s.View="View",s.Date=new Date(e[t].CDate).ToString("dd/MMM/yyyy hh:mm:ss tt"),s.Date_Key=new Date(e[t].CDate),s.FeedBack=D.GetValidXmlReserve(e[t].Feedback),s.CreatedBy=e[t].CreatedBy.toString(),s.Imagefilepath=a.e.IsEmpty(e[t].Imagefilepath)?"":a.e.GetPath(e[t].Imagefilepath.toString()),this.FeedBackDataObj.Columns.forEach(i=>{i.DisplayMember.Contains("CCNID")?s[i.ValueMember]=e[t][i.DisplayMember]:i.DisplayMember.Contains("Alpha")&&(s[i.DisplayMember]=D.GetValidXmlReserve(e[t][i.DisplayMember].toString()))}),this.FeedBackDataObj.addRow(s),this.FeedBackDataObj.RefreshGrid=!this.FeedBackDataObj.RefreshGrid}}catch(t){Logger.ErrorLog("ViewFeedbackViewModel:: LoadData",t)}}}},yJmf:function(e,t,s){"use strict";s.d(t,"a",(function(){return l}));var i=s("vfbs"),a=s("fXoL"),o=s("sYmb");function n(e,t){if(1&e){const e=a.ac();a.Zb(0,"div",1),a.Wc(1,"\n    \n    "),a.Zb(2,"div",2),a.Wc(3,"\n        "),a.Zb(4,"div",3),a.Wc(5,"\n            "),a.Vb(6,4),a.Wc(7,"\n        "),a.Yb(),a.Wc(8,"\n        "),a.Zb(9,"div",3),a.Wc(10,"\n            "),a.Vb(11,4),a.Wc(12,"\n        "),a.Yb(),a.Wc(13,"\n        "),a.Zb(14,"div",3),a.Wc(15,"\n            "),a.Vb(16,4),a.Wc(17,"\n        "),a.Yb(),a.Wc(18,"\n        \n        \n  "),a.Yb(),a.Wc(19,"\n  "),a.Zb(20,"div",5),a.Wc(21,"\n    "),a.Zb(22,"div"),a.Wc(23,"\n        "),a.Zb(24,"button",6),a.hc("click",(function(){return a.Ic(e),a.lc().obj.OnSave("SaveWave")})),a.Wc(25,"Ok"),a.Yb(),a.Wc(26,"\n        "),a.Zb(27,"button",7),a.hc("click",(function(){return a.Ic(e),a.lc().obj.OnSave("CancelWave")})),a.Ub(28,"i",8),a.Wc(29),a.mc(30,"translate"),a.Yb(),a.Wc(31,"\n    "),a.Yb(),a.Wc(32,"      \n  "),a.Yb(),a.Wc(33,"\n"),a.Yb()}if(2&e){const e=a.lc();a.Db(6),a.tc("obj",e.obj.User)("group",e.group),a.Db(5),a.tc("obj",e.obj.WaiveOffDate)("group",e.group),a.Db(5),a.tc("obj",e.obj.Comments)("group",e.group),a.Db(13),a.Xc(a.nc(30,7,"Cancel"))}}let l=(()=>{class e extends i.a{constructor(e){super(),this.translate=e}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)(a.Tb(o.e))},e.\u0275cmp=a.Nb({type:e,selectors:[["app-quick-waive"]],features:[a.Ab],decls:1,vars:1,consts:[["class","master-screen","style","width: 300px;",4,"ngIf"],[1,"master-screen",2,"width","300px"],[1,"PACTHeaderFields","dialogSubBody"],[1,"form-group","row","PACTControl"],["FieldDirective","",3,"obj","group"],[1,"Pactdailogfooter"],[1,"primary-btn-wicon",3,"click"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-rectangle-xmark"]],template:function(e,t){1&e&&a.Uc(0,n,34,9,"div",0),2&e&&a.tc("ngIf",t.obj.WaiveVisibility)},encapsulation:2}),e})()},z5gp:function(e,t,s){"use strict";s.d(t,"a",(function(){return h}));var i=s("vfbs"),a=s("fXoL"),o=s("sYmb");function n(e,t){if(1&e&&(a.Zb(0,"div",9),a.Wc(1,"\n          "),a.Vb(2,10),a.Wc(3,"\n        "),a.Yb()),2&e){const e=a.lc();a.Db(2),a.tc("obj",e.obj.FeedbackDate)("group",e.obj.ScreenObject.form)}}function l(e,t){if(1&e&&(a.Zb(0,"div",9),a.Wc(1,"\n            "),a.Vb(2,10),a.Wc(3,"\n        "),a.Yb()),2&e){const e=a.lc();a.Db(2),a.tc("obj",e.obj.Feedback)("group",e.obj.ScreenObject.form)}}function r(e,t){if(1&e&&(a.Zb(0,"div",9),a.Wc(1,"\n                "),a.Vb(2,10),a.Wc(3,"\n            "),a.Yb()),2&e){const e=a.lc().$implicit,t=a.lc();a.Db(2),a.tc("obj",e)("group",t.obj.ScreenObject.form)}}function d(e,t){if(1&e&&(a.Xb(0),a.Wc(1,"\n            "),a.Uc(2,r,4,2,"div",2),a.Wc(3,"\n        "),a.Wb()),2&e){const e=t.$implicit;a.Db(2),a.tc("ngIf",e.Visible)}}let h=(()=>{class e extends i.a{constructor(e){super(),this.translate=e}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)(a.Tb(o.e))},e.\u0275cmp=a.Nb({type:e,selectors:[["app-feed-back"]],features:[a.Ab],decls:28,vars:10,consts:[[1,"master-screen",3,"formGroup"],[1,"PACTHeaderFields","dialogSubBody"],["class","form-group col PACTControl",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"Pactdailogfooter"],[1,"primary-btn-wicon",3,"click"],[1,"fa-light","fa-floppy-disk"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-rectangle-xmark"],[1,"form-group","col","PACTControl"],["FieldDirective","",3,"obj","group"]],template:function(e,t){1&e&&(a.Zb(0,"div",0),a.Wc(1,"\n    "),a.Zb(2,"div",1),a.Wc(3,"\n        "),a.Uc(4,n,4,2,"div",2),a.Wc(5,"\n        "),a.Uc(6,l,4,2,"div",2),a.Wc(7,"\n        "),a.Uc(8,d,4,1,"ng-container",3),a.Wc(9,"\n        \n    "),a.Yb(),a.Wc(10,"\n    "),a.Zb(11,"div",4),a.Wc(12,"\n      "),a.Zb(13,"div"),a.Wc(14,"\n            "),a.Zb(15,"button",5),a.hc("click",(function(){return t.obj.OnSave("Save")})),a.Ub(16,"i",6),a.Wc(17),a.mc(18,"translate"),a.Yb(),a.Wc(19,"\n             "),a.Zb(20,"button",7),a.hc("click",(function(){return t.obj.OnSave("Cancel")})),a.Ub(21,"i",8),a.Wc(22),a.mc(23,"translate"),a.Yb(),a.Wc(24,"\n        "),a.Yb(),a.Wc(25,"      \n      "),a.Yb(),a.Wc(26,"\n  "),a.Yb(),a.Wc(27,"\n  \n  \n  ")),2&e&&(a.tc("formGroup",t.obj.ScreenObject.form),a.Db(4),a.tc("ngIf",t.obj.FeedbackDate.Visible),a.Db(2),a.tc("ngIf",t.obj.Feedback.Visible),a.Db(2),a.tc("ngForOf",t.obj.Fields),a.Db(9),a.Xc(a.nc(18,6,"Save")),a.Db(5),a.Xc(a.nc(23,8,"cancel")))},encapsulation:2}),e})()}}]);
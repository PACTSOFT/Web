(window.webpackJsonp=window.webpackJsonp||[]).push([[83],{"2Ofj":function(e,t,s){"use strict";s.r(t),s.d(t,"INV_ComparisonReport",(function(){return f}));var i=s("mrSG"),o=s("Do2H"),l=s("Lp6j"),n=s("1xwR"),a=s("8B8H"),r=s("mvPR"),h=s("uMy8"),d=s("vTM8"),u=s("ScVY"),c=s("0/4Q"),C=s("EQd/"),p=s("ockk"),D=s("MCLT"),w=s("D9Bi"),m=s("CUWK"),I=s("MCKn"),R=s("4HhE");class T{constructor(){this.DocSeqNo=0,this.InvID_QTN=0,this.InvID_MRN=0,this.UsedQty=0,this.ReqQty=0}}class f extends n.b{constructor(e){super(e),this.i=0,this.k=0,this.ds=null,this.AttachReportWithPO=!1,this.CanApproveAll=!1,this.dvQuotations=null,this.dvQuotationsTable=null,this.EnquiryVoucher="",this.strLinkedInvDocDetailsIDs="",this.QuotationDocument=0,this.PurchaseOrderDocument=0,this.QuotationComparisonDocument=0,this.Userlevel=0,this.ccid=0,this.docid=0,this.WID=0,this.QtnIDs="",this.cntGroups=0,this.cntCols=0,this.cntHiddenCols=0,this.cntHiddenGroups=0,this.cntVisibleGroups=0,this.Quotations=new Array,this.QuotationDate=new Array,this.strQuotationNumericFields="",this.AllProductRows=new Array,this.TagID=0,this.IsAvgRate=0,this.fldDict=new d.a,this.ComparisonDocID=0,this.ComparisonQtyField="",this.ComparisonStatusField="",this.QtnCols=new Array,this.isConfirm_Web="No",this.oDocument=null}get Grid(){return this.ViewModel.ComparisonGrid}set Grid(e){this.ViewModel.ComparisonGrid=e}LoadReport(){if(this.EnquiryVoucher=this.ViewModel.Preferences.EnquiryNo,this.QuotationDocument=parseInt(this.ViewModel.Preferences.QuotationDocument),!this.ViewModel.ButtonAction.Visible&&"DONE"!=this.ViewModel.ButtonAction.SysColumnName){this.ViewModel.ButtonAction.SysColumnName="DONE";let e=o.a.report.ReportDataTable("RPT022",this.ViewModel.IsReportDB,"select PrefValue from com_documentpreferences with(nolock) where CostCenterID="+this.QuotationDocument+" and PrefName='ApprOnComparitiveAnalysis' and PrefValue='True'");e.length>0&&e.Columns.Contains("PrefValue")&&(this.ViewModel.ButtonAction.AccDimInUse=!0)}if(this.ViewModel.DocumentFiltersIDs.ContainsKey("23148")&&(this.strLinkedInvDocDetailsIDs=this.ViewModel.DocumentFiltersIDs[23148]),this.ViewModel.Preferences.ContainsKey("PurchaseOrderDocument")&&this.ViewModel.Preferences.PurchaseOrderDocument.length>0&&(this.PurchaseOrderDocument=parseInt(this.ViewModel.Preferences.PurchaseOrderDocument)),this.ViewModel.Preferences.ContainsKey("QuotationComparisonDocument")&&this.ViewModel.Preferences.QuotationComparisonDocument.length>0&&(this.QuotationComparisonDocument=parseInt(this.ViewModel.Preferences.QuotationComparisonDocument),this.ComparisonQtyField=this.ViewModel.Preferences.ContainsKey("QTNComp_Qty")?this.ViewModel.Preferences.QTNComp_Qty:"",this.ComparisonStatusField=this.ViewModel.Preferences.ContainsKey("QTNComp_Status")?this.ViewModel.Preferences.QTNComp_Status:""),this.ViewModel.Preferences.ContainsKey("QuotationNumericFields")&&this.ViewModel.Preferences.QuotationNumericFields.length>0)this.strQuotationNumericFields=this.ViewModel.Preferences.QuotationNumericFields,this.NumericFields=this.ViewModel.Preferences.QuotationNumericFields.split(","),this.NumericFieldsBold=new Array(this.NumericFields.length).fill(!1),this.NumericFieldsIgnoreTotal=new Array(this.NumericFields.length).fill(!1);else if(this.ViewModel.Preferences.ContainsKey("QuotationNumericFieldsXML")&&this.ViewModel.Preferences.QuotationNumericFieldsXML.length>0){let e=new l.f;e.LoadXml("<xml>"+this.ViewModel.Preferences.QuotationNumericFieldsXML+"</xml>"),this.NumericFields=new Array(e.DocumentElement.children.length),this.NumericFieldsBold=new Array(this.NumericFields.length).fill(!1),this.NumericFieldsIgnoreTotal=new Array(this.NumericFields.length).fill(!1);let t=0;for(let s=0;s<e.DocumentElement.children.length;s++){let i=e.DocumentElement.children[s];this.NumericFields[t]=i.attributes.ID.value,this.strQuotationNumericFields.length>0&&(this.strQuotationNumericFields+=","),this.strQuotationNumericFields+=i.attributes.ID.value,null!=i.attributes.Bold&&"1"==i.attributes.Bold.value&&(this.NumericFieldsBold[t]=!0),null!=i.attributes.IgnoreAtTotal&&"1"==i.attributes.IgnoreAtTotal.value&&(this.NumericFieldsIgnoreTotal[t]=!0),t++}}else this.NumericFields=[];this.TextFields=this.ViewModel.Preferences.QuotationTextFields.length>0?this.ViewModel.Preferences.QuotationTextFields.split(","):[],this.IsAvgRate=this.ViewModel.ColumnSource.filter(e=>"AvgRate"==e.ID).length,o.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&(this.TagID=l.e.Int(o.a.SessionManager.Preferences["Maintain Dimensionwise stock"])),0==this.TagID&&"True"==o.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==o.a.SessionManager.Preferences["LW Reports"]&&(this.TagID=50002),this.AttachReportWithPO=!(!this.ViewModel.Preferences.ContainsKey("AttachReportWithPO")||"1"!=this.ViewModel.Preferences.AttachReportWithPO),this.RateKPIColumn=this.ViewModel.Preferences.ContainsKey("RateKPIColumn")?this.ViewModel.Preferences.RateKPIColumn:"",this.RateKPIColumnColor=this.ViewModel.Preferences.ContainsKey("RateKPIColumnColor")?this.ViewModel.Preferences.RateKPIColumnColor:"Green",this.ExecutedClr=this.ViewModel.Preferences.ContainsKey("ExecutedClr")?this.ViewModel.Preferences.ExecutedClr:"#FFC4BFC0",this.PartialExecutedClr=this.ViewModel.Preferences.ContainsKey("PartialExecutedClr")?this.ViewModel.Preferences.PartialExecutedClr:"#FFE6E6FA",this.FullSelectedClr=this.ViewModel.Preferences.ContainsKey("FullSelectedClr")?this.ViewModel.Preferences.FullSelectedClr:"",this.PartialSelectedClr=this.ViewModel.Preferences.ContainsKey("PartialSelectedClr")?this.ViewModel.Preferences.PartialSelectedClr:"",this.GrandTotalColumnID=this.ViewModel.Preferences.ContainsKey("GrandTotalColumn")?this.ViewModel.Preferences.GrandTotalColumn:"",this.ViewModel.Preferences.ContainsKey("HideRegenerate")&&(this.ViewModel.RegenerateVisibility=!1),this.LoadDataSet().then(()=>{if(null==this.ds)return;this.Quotations.Clear(),this.QuotationDate.Clear(),this.ds.Tables[1].forEach(e=>{this.Quotations.Contains(e.VoucherNo.toString())||(this.Quotations.push(e.VoucherNo.toString()),this.QuotationDate.push(new Date(e.DocDate).ToString(o.a.SessionManager.Preferences["Date Format"])))}),this.cntCols=0,this.cntGroups=0,this.cntHiddenCols=0,this.cntHiddenGroups=0,this.QtnCols.Clear();let e,t=new Array;for(let o=0;o<this.ViewModel.ColumnSource.length;o++)o>=this.ViewModel.RepeatStartIndex&&o<=this.ViewModel.RepeatStartIndex+this.ViewModel.RepeatNextCols?(this.cntCols++,this.QtnCols.push(this.ViewModel.ColumnSource[o]),this.ViewModel.ColumnSource[o].HeaderAppearance.IsVisible||this.cntHiddenCols++):(this.cntGroups++,t.push(this.ViewModel.ColumnSource[o].Clone()),this.ViewModel.ColumnSource[o].HeaderAppearance.IsVisible||this.cntHiddenGroups++);this.cntVisibleGroups=this.cntGroups-this.cntHiddenGroups;for(let o=0;o<this.Quotations.length;o++)for(let e=0;e<this.QtnCols.length;e++)t.push(this.QtnCols[e].Clone()),t[t.length-1].MatixRepeatID=o.toString();this.ViewModel.ConstructFormulaFields(!1),this.eval=new h.b,this.eval.ThrowException=!1,this.eval.SetKeyWords("REPORT"),this.QtnCols.forEach(t=>{this.fldDict.ContainsKey(t.ID)||(e=new h.c,e.setFieldDetails(t.ID,3,1,"",0,!1,!1),this.fldDict.push(t.ID,e))});let s=this.NewReportRow_3(r.f.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance,t.length),i=this.NewReportRow_3(r.f.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance,t.length),n=this.NewReportRow_3(r.f.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance,t.length),a=this.ViewModel.Preferences.ContainsKey("ShowStatus")?this.NewReportRow_3(r.f.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance,t.length):null,d=this.ViewModel.Preferences.ContainsKey("ShowApprovalRemarks")?this.NewReportRow_3(r.f.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance,t.length):null;for(let r=0;r<this.Quotations.length;r++)this.dvQuotations=this.dvQuotationsTable.filter(e=>e.VoucherNo==this.Quotations[r]),this.dvQuotations.length>0&&(s.Cells[this.cntGroups+r*this.cntCols].Text=this.dvQuotations[0].CreditAccountName.toString(),this.ViewModel.ButtonPost.Visible&&(s.Cells[this.cntGroups+r*this.cntCols].CellAppearance.ColumnType="LINK_VENDOR"),null!=a&&(a.Cells[this.cntGroups+r*this.cntCols].Text="Posted"==l.e.String(this.dvQuotations[0].QTNStatus)?o.a.GetResource("Reports_LblPosted"):"Un Approved"==l.e.String(this.dvQuotations[0].QTNStatus)?o.a.GetResource("Reports_LblUnApproved"):"Approved"==l.e.String(this.dvQuotations[0].QTNStatus)?o.a.GetResource("Reports_LblApproved"):"Rejected"==l.e.String(this.dvQuotations[0].QTNStatus)?o.a.GetResource("Reports_LblRjected"):l.e.String(this.dvQuotations[0].QTNStatus),a.Cells[this.cntGroups+r*this.cntCols].Value=this.dvQuotations[0].DocID,a.Cells[this.cntGroups+r*this.cntCols].CellAppearance.Alignment="Left",a.Cells[this.cntGroups+r*this.cntCols].ColSpan=this.cntCols-this.cntHiddenCols,a.Cells[this.cntGroups+r*this.cntCols].CellAppearance.IsBold=!1,a.Cells[this.cntGroups+r*this.cntCols].CellAppearance.ColumnType="LINK_STATUS",a.Cells[this.cntGroups+r*this.cntCols].Text.startsWith("Rejected")&&(a.Cells[this.cntGroups+r*this.cntCols].CellAppearance.ForeColor="Red")),null!=d&&(d.Cells[this.cntGroups+r*this.cntCols].Text=this.dvQuotations[0].QTNApprovalRemarks.toString(),d.Cells[this.cntGroups+r*this.cntCols].CellAppearance.Alignment="Left",d.Cells[this.cntGroups+r*this.cntCols].ColSpan=this.cntCols-this.cntHiddenCols,d.Cells[this.cntGroups+r*this.cntCols].CellAppearance.IsBold=!1)),s.Cells[this.cntGroups+r*this.cntCols].CellAppearance.Alignment="Left",s.Cells[this.cntGroups+r*this.cntCols].ColSpan=this.cntCols-this.cntHiddenCols,s.Cells[this.cntGroups+r*this.cntCols].CellAppearance.IsBold=!1,i.Cells[this.cntGroups+r*this.cntCols].Text=this.QuotationDate[r],i.Cells[this.cntGroups+r*this.cntCols].CellAppearance.Alignment="Left",i.Cells[this.cntGroups+r*this.cntCols].ColSpan=this.cntCols-this.cntHiddenCols,i.Cells[this.cntGroups+r*this.cntCols].CellAppearance.IsBold=!1,n.Cells[this.cntGroups+r*this.cntCols].Text=this.Quotations[r],n.Cells[this.cntGroups+r*this.cntCols].CellAppearance.Alignment="Left",n.Cells[this.cntGroups+r*this.cntCols].CellAppearance.ColumnType="LINK_DOCUMENT",n.Cells[this.cntGroups+r*this.cntCols].ColSpan=this.cntCols-this.cntHiddenCols,n.Cells[this.cntGroups+r*this.cntCols].CellAppearance.IsBold=!1;let u=this.cntGroups-this.cntHiddenGroups>3?2:1;s.Cells[u].Text=o.a.GetResource("Reports_LblNameofthesupplier"),i.Cells[u].Text=o.a.GetResource("Reports_LblDocDate"),n.Cells[u].Text=o.a.GetResource("Reports_LblDocNo"),this.cntGroups-this.cntHiddenGroups>3?(s.Cells[2].ColSpan=i.Cells[2].ColSpan=n.Cells[2].ColSpan=this.cntGroups-(2+this.cntHiddenGroups),s.Cells[2].CellAppearance.Alignment=i.Cells[2].CellAppearance.Alignment=n.Cells[2].CellAppearance.Alignment="Left",this.ds.Tables[0].length>0&&(i.Cells[0].Text=new Date(this.ds.Tables[0][0].DocDate).ToString(o.a.SessionManager.Preferences["Date Format"]),i.Cells[0].CellAppearance.IsBold=!1,n.Cells[0].Text=this.ds.Tables[0][0].VoucherNo.toString(),n.Cells[0].CellAppearance.ColumnType="LINK_DOCUMENT",n.Cells[0].CellAppearance.IsBold=!1),s.Cells[0].ColSpan=i.Cells[0].ColSpan=n.Cells[0].ColSpan=2,null!=a&&(a.Cells[0].ColSpan=2),null!=d&&(d.Cells[0].ColSpan=2)):(s.Cells[1].ColSpan=i.Cells[1].ColSpan=n.Cells[1].ColSpan=this.cntGroups-(1+this.cntHiddenGroups),s.Cells[1].CellAppearance.Alignment=i.Cells[1].CellAppearance.Alignment=n.Cells[1].CellAppearance.Alignment="Left",null!=a&&(a.Cells[1].ColSpan=this.cntGroups-(1+this.cntHiddenGroups),a.Cells[1].CellAppearance.Alignment="Left"),null!=d&&(d.Cells[1].ColSpan=this.cntGroups-(1+this.cntHiddenGroups),d.Cells[1].CellAppearance.Alignment="Left"),i.Cells[0].Text=new Date(this.ds.Tables[0][0].DocDate).ToString(o.a.SessionManager.Preferences["Date Format"]),i.Cells[0].CellAppearance.IsBold=!1,n.Cells[0].Text=this.ds.Tables[0][0].VoucherNo.toString(),n.Cells[0].CellAppearance.IsBold=!1),null!=a&&(a.Cells[u].Text=o.a.GetResource("Reports_LblDocStatus"),a.Cells[u].ColSpan=n.Cells[u].ColSpan,a.Cells[u].CellAppearance.Alignment="Left"),null!=d&&(d.Cells[u].Text="Approval Remarks",d.Cells[u].ColSpan=n.Cells[u].ColSpan,d.Cells[u].CellAppearance.Alignment="Left"),this.oHeadiQtyRate=new r.d(t.length,this.ViewModel.RowHeight+2),this.oHeadiQtyRate.Type=r.f.Header;for(let o=0;o<t.length;o++)this.oHeadiQtyRate.Cells[o].Text=t[o].HeaderText,this.oHeadiQtyRate.Cells[o].CellAppearance=t[o].HeaderAppearance,this.oHeadiQtyRate.Cells[o].IsNormal=!1;for(let o=0;o<t.length;o++)t[o].HeaderText="";this.oColumns=t,this.ViewModel.ReportColumns=t,this.ViewModel.colSNoIndex=this.ViewModel.ReportColumns.indexOf(this.ViewModel.ReportColumns.find(e=>0==l.e.stringCompare(e.Formula,"SNO",!0))),this.ViewModel.IsTotalColsAdded=!0,this.ViewModel.totals=l.e.NumArray(this.oColumns.length,this.Quotations.length+1),this.ViewModel.Preferences.ContainsKey("HideSupplier")&&"0"!=this.ViewModel.Preferences.HideSupplier||this.ViewModel.addRow(s),this.ViewModel.addRow(i),null!=a&&this.ViewModel.addRow(a),null!=d&&this.ViewModel.addRow(d),this.ViewModel.addRow(n),this.ViewModel.addRow(this.oHeadiQtyRate),this.AddRows(),this.AllProductRows.forEach(e=>{this.ViewModel.addRow(e)}),this.ViewModel.AddSubtotals_RT(this.ViewModel.GrpReportTotal,0),this.ViewModel.Preferences.ContainsKey("HideBasicTotal")&&"0"!=this.ViewModel.Preferences.HideBasicTotal||this.ViewModel.addRow(this.oBasicValueRow);for(let o=0;o<this.NumericRows.length;o++)this.ViewModel.addRow(this.NumericRows[o]);this.ViewModel.Preferences.ContainsKey("HideGrandTotal")&&"0"!=this.ViewModel.Preferences.HideGrandTotal||this.ViewModel.addRow(this.oTotalRow);for(let o=0;o<this.TextRows.length;o++)this.ViewModel.addRow(this.TextRows[o]);if(this.ViewModel.Preferences.ContainsKey("ShowPTProfile")&&"1"==this.ViewModel.Preferences.ShowPTProfile){this.oRow=this.NewReportRow(),this.oRow.Cells[0].Text="Payment Terms",this.oRow.Cells[0].ColSpan=this.cntGroups-this.cntHiddenGroups,this.oRow.Cells[0].IsNormal=!1,this.oRow.Cells[0].CellAppearance=this.ViewModel.GrpReportTotal.SubTotalAppearance_Data.Clone(),this.oRow.Cells[0].CellAppearance.Alignment="Left";for(let e=0;e<this.Quotations.length;e++){let t=this.oRow.Cells[this.cntGroups+e*this.cntCols];t.IsNormal=!1,t.ColSpan=this.cntCols-this.cntHiddenCols,t.CellAppearance=this.ViewModel.ReportColumns[1+e*this.cntCols].DataAppearance.Clone(),t.CellAppearance.Alignment="Left",this.dvQuotations=this.dvQuotationsTable.filter(t=>t.VoucherNo==this.Quotations[e]),this.dvQuotations.length>0&&(t.Text=l.e.String(this.dvQuotations[0].PayTermProfile),t.Text.length>0&&(t.Value=this.Quotations[e],t.CellAppearance.ColumnType="LINK_PAYTERM"))}this.ViewModel.addRow(this.oRow)}if(this.ViewModel.Preferences.ContainsKey("ShowAttachments")){this.oRow=this.NewReportRow(),this.oRow.Cells[0].Text=o.a.GetResource("Reports_LblAttachments"),this.oRow.Cells[0].ColSpan=this.cntGroups-this.cntHiddenGroups,this.oRow.Cells[0].IsNormal=!1,this.oRow.Cells[0].CellAppearance=this.ViewModel.GrpReportTotal.SubTotalAppearance_Data.Clone(),this.oRow.Cells[0].CellAppearance.Alignment="Left";for(let e=0;e<this.Quotations.length;e++){let t=this.oRow.Cells[this.cntGroups+e*this.cntCols];t.IsNormal=!1,t.ColSpan=this.cntCols-this.cntHiddenCols,this.dvQuotations=this.dvQuotationsTable.filter(t=>t.VoucherNo==this.Quotations[e]),this.dvQuotations.length>0&&(t.Text=l.e.String(this.dvQuotations[0].QTNAttachments),t.Value=l.e.String(this.dvQuotations[0].QTNAttachments_ID)),t.CellAppearance=this.ViewModel.ReportColumns[1+e*this.cntCols].DataAppearance.Clone(),t.CellAppearance.Alignment="Left",t.CellAppearance.ColumnType="LINK_ATTACHMENT"}this.ViewModel.addRow(this.oRow)}this.QuotationComparisonDocument>4e4&&this.InitGrid()}).then(()=>{this.ViewModel.process_RunWorkerCompleted()})}LoadDataSet(){let e=this.strQuotationNumericFields;this.ViewModel.Preferences.QuotationTextFields.length>0&&(e.length>0&&(e+=","),e+=this.ViewModel.Preferences.QuotationTextFields),e="'"+e.Replace(",","','")+"'",this.ViewModel.FromTag.Contains("DCC.")&&(this.ViewModel.FromTag=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID "+this.ViewModel.FromTag);let t,s,i=this.ViewModel.SelectTag,n=this.ViewModel.FromTag,a=new Array;var r=this.ViewModel.BaseReportColumns.find(e=>!l.e.IsEmpty(e.RepeatType.SelectedValue)&&parseInt(e.RepeatType.SelectedValue)>0);let h=this.ViewModel.BaseReportColumns.indexOf(r);if(-1!=h)for(let o=h;o<=h+this.ViewModel.RepeatNextCols;o++)a.push(this.ViewModel.BaseReportColumns[o]);this.ViewModel.Entities.Clear(),this.ViewModel.Entities.push("Documents","D"),this.ViewModel.SetQuery(a,!0),this.ViewModel.FromTag.Contains("DCC.")&&(this.ViewModel.FromTag=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID "+this.ViewModel.FromTag),t=this.ViewModel.SelectTag,s=this.ViewModel.FromTag,this.ViewModel.Preferences.ContainsKey("ShowPTProfile")&&"1"==this.ViewModel.Preferences.ShowPTProfile&&(t+=",(SELECT top 1 PD.ProfileName PaymentTerm_ProfileName FROM COM_DocPayTerms P with(nolock) \nleft join Acc_PaymentDiscountProfile PD with(nolock) on P.ProfileID=PD.ProfileID WHERE VoucherNo=D.VoucherNo) PayTermProfile"),this.ViewModel.Preferences.ContainsKey("ShowAttachments")&&(t+=",stuff((select ','+[GUID]+'.'+FileExtension from COM_Files WITH(NOLOCK) WHERE FeatureID=D.CostCenterID AND FeaturePK=D.DocID FOR XML PATH('')),1,1,'') QTNAttachments_ID,stuff((select ', '+ActualFileName from COM_Files WITH(NOLOCK) WHERE FeatureID=D.CostCenterID AND FeaturePK=D.DocID FOR XML PATH('')),1,2,'') QTNAttachments"),this.ViewModel.Preferences.ContainsKey("ShowStatus")&&(t+=",S.Status+case when W.LevelName is null then '' else ' ('+W.LevelName+')' end QTNStatus",s+=" left join COM_Status S with(nolock) on S.StatusID=D.StatusID",s+=" left join COM_WorkFlow W with(nolock) on W.WorkFlowID=D.WorkFlowID and W.LevelID=D.WorkFlowLevel"),this.ViewModel.Preferences.ContainsKey("ShowApprovalRemarks")&&(t+=",(select Remarks from COM_Approvals with(nolock) where ApprovalID IN (select top 1 ApprovalID\nfrom COM_Approvals with(nolock) where RowType=1 and this.ccid=D.costcenterid and ccnodeid=D.DocID AND (DocDetID=0 OR DocDetID=D.InvDocDetailsID) order by ApprovalID desc)) QTNApprovalRemarks"),this.ViewModel.Preferences.ContainsKey("QTNSelect")&&(t+=this.ViewModel.Preferences.QTNSelect),this.ViewModel.Preferences.ContainsKey("QTNJoin")&&(!s.Contains("COM_DocCCData")&&this.ViewModel.Preferences.QTNJoin.Contains("dcCCNID")&&(s+=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID"),s+=this.ViewModel.Preferences.QTNJoin),t=t.Replace("@CCWHERE@","");let d="";this.TagID>5e4&&o.a.SessionManager.LocationID>0&&(d=" AND DCC.DCCCNID"+(this.TagID-5e4).toString()+" IN ("+o.a.SessionManager.LocationID+")");let u=this.GetDimensionFilter("DCC.dcCCNID");var c=this.ViewModel.oReportDialog.CostCenterFilters.find(e=>3==e.CostCenterID);if(c&&null!=c.SelectedNodes&&c.SelectedNodes.length>0)if(1==c.SelectedNodes.length)u+=" AND D.ProductID="+c.SelectedNodes[0].Id;else{u+=" AND D.ProductID IN (";for(let e=0;e<c.SelectedNodes.length;e++)e>0&&(u+=","),u+=c.SelectedNodes[e].Id;u+=")"}let C,p="";this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(p=l.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?" AND dcCCNID"+(this.ViewModel.oReportDialog.Locations.DBColumnID-5e4)+" IN (-1)":" AND dcCCNID"+(this.ViewModel.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),C=i.Replace("@CCWHERE@",p.length>0?" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON A.InvDocDetailsID=DCC.InvDocDetailsID "+p:"");let D=[];return D.push(this.EnquiryVoucher),D.push(C),D.push(n),D.push(u),D.push(this.QuotationDocument),D.push(this.QuotationComparisonDocument),D.push(this.PurchaseOrderDocument),D.push(t),D.push(s),this.ComparisonQtyField.startsWith("dcNum")?D.push(",N."+this.ComparisonQtyField+" SelectedQty"):D.push(0==this.ComparisonQtyField.length?"":",D."+this.ComparisonQtyField+" SelectedQty"),this.ComparisonStatusField.startsWith("dcAlpha")?D.push("TXT."+this.ComparisonStatusField):D.push(""),D.push(e),D.push(this.IsAvgRate),D.push(d),D.push(this.strLinkedInvDocDetailsIDs),D.push(this.ViewModel.Preferences.ContainsKey("ShowQtnAddOns")),D.push(o.a.SessionManager.LanguageID),o.a.report.GetComperativeStmt(D,this.ViewModel.IsReportDB).then(e=>{if(this.ds=e,this.dvQuotations=this.dvQuotationsTable=this.ds.Tables[1],this.ViewModel.Preferences.ContainsKey("ShowLinkedPrds")&&"1"==this.ViewModel.Preferences.ShowLinkedPrds)for(let i=this.ds.Tables[0].length-1;i>=0;i--)0==this.ds.Tables[1].filter(e=>e.LinkedInvDocDetailsID==parseInt(this.ds.Tables[0][i].InvDocDetailsID)).length&&this.ds.Tables[0].RemoveAt(i);if(this.dvFields=this.dvFieldsTable=this.ds.Tables[3],this.IsAvgRate>0){let e;this.ds.Columns[0].push("AvgRate"),this.ds.Tables[0].forEach(t=>{e=this.ds.Tables[4].filter(e=>e.ProductID==t.ProductID),e.length>0&&(t.AvgRate=e[0].AvgRate)})}let t=null;if(this.ViewModel.ButtonAction.AccDimInUse){this.ViewModel.ButtonPost.Visible=!1,this.docid=parseInt(this.ds.Tables[0][0].docid.toString()),this.ccid=parseInt(this.ds.Tables[0][0].costcenterid.toString());var s=this.dvQuotations.ToTable(!0,["DocID"]);this.QtnIDs="";for(let e=0;e<s.length;e++)e>0&&(this.QtnIDs+=","),this.QtnIDs+=s[e].DocID.toString();0==this.QtnIDs.length?this.ViewModel.ButtonAction.Visible=!1:(t=o.a.report.GetWorkflowCanApprove(this.docid,this.ccid,this.dvQuotations[0].InvDocDetailsID.toString(),this.QtnIDs),""!=t.Tables[0][0].userlevel.toString()&&(this.Userlevel=parseInt(t.Tables[0][0].userlevel.toString()),""!=t.Tables[0][0].WorkFlowID.toString()&&(this.WID=parseInt(t.Tables[0][0].WorkFlowID.toString())),this.ViewModel.ButtonAction.Visible="1"==t.Tables[0][0].canApprove.toString(),"1"==t.Tables[0][0].canPost.toString()&&(this.ViewModel.ButtonPost.Visible=!0),this.Userlevel>1&&"1"==t.Tables[0][0].Appall.toString()&&(this.CanApproveAll=!0)))}this.QuotationComparisonDocument>4e4&&(this.ViewModel.ComparisonQuotationVisible=!(this.ViewModel.ButtonPost.Visible||null==t||!t.Columns[0].Contains("StatusID")||"369"!=t.Tables[0][0].StatusID.toString())||this.ViewModel.ButtonPost.Visible)})}LoadReportWithPostFilters(e){}InitGrid(){let e;this.Grid=new a.a,this.Grid.CanEvaluateFormulas=!1,this.Grid.Width="",this.Grid.HeaderHeight=40,this.Grid.Table=[],this.Grid.OnBeginEdit.Subscribe(this,"Grid_BeginEdit"),this.Grid.OnCellEditEnding.Subscribe(this,"Grid_EndEdit");let t=new Array,s=0,i=0;for(s=0;s<this.cntVisibleGroups;s++){let o=this.ViewModel.ReportColumns[s];e=new p.a,e.Header=o.HeaderText,e.Header=this.oHeadiQtyRate.Cells[s].Text,e.DisplayMember="C"+s,e.ReadOnly=!0,i+=parseInt(o.width),e.IsFrozen=s<this.cntVisibleGroups&&i<600,e.Width=parseInt(o.width),e.DisableTab=!0,"FLOAT"==o.ColumnType?(s>=this.cntVisibleGroups&&(e.ReadOnly=!1),e.DataType="FLOAT",e.DecimalPoints=o.DataFormat.DecimalsPoints.toString(),this.Grid.TableColumns.push(e.DisplayMember)):this.Grid.TableColumns.push(e.DisplayMember),t.push(e)}let l=o.a.SessionManager.Preferences.DecimalsinQty;var n=this.ViewModel.BaseReportColumns.find(e=>null!=e.CDGDO&&"1"==e.Visibility.SelectedValue&&"Quantity"==e.CDGDO.Column);if(n){let e=this.ViewModel.ReportColumns.find(e=>e.ID==n.ID);e&&(l=e.DataFormat.DecimalsPoints.toString())}for(s=0;s<this.Quotations.length;s++)e=new p.a,e.Header=o.a.GetResource("Reports_LblReqQty")+" ["+this.Quotations[s]+"]",this.dvQuotations=this.dvQuotationsTable.filter(e=>e.VoucherNo==this.Quotations[s]),this.dvQuotations.length>0&&(e.Header+="\r\n"+this.dvQuotations[0].CreditAccountName.toString()),e.DisplayMember="ReqQty"+s,e.ReadOnly=!0,e.Width=180,e.DisableTab=!1,e.DataType="FLOAT",e.DecimalPoints=l,this.Grid.TableColumns.push(e.DisplayMember),this.Grid.TableColumns.push("ExeQty"+s),t.push(e);this.Grid.TableColumns.push("ReportRowId"),this.Grid.Columns=t,this.ds.Tables[2].length>0?(this.ComparisonDocID=parseInt(this.ds.Tables[2][0].DocID),this.ds.Columns[2].Contains("VoucherNo")&&(this.ViewModel.ComparisonINTERQTN=this.ds.Tables[2][0].VoucherNo.toString())):(this.ComparisonDocID=0,this.ViewModel.ComparisonINTERQTN="");for(let o=0;o<this.ViewModel.Data.length;o++){let e=this.ViewModel.Data[o];if(null==e.DataRow)continue;let t=!1,i=this.Grid.NewRow();for(i.ReportRowId=o,s=0;s<this.Quotations.length;s++)if(null!=e.DataRow["InvDocDetailsID_QTN"+s]){let o=this.ds.Tables[2].filter(t=>t.SelectedQty>0&&t.LinkedInvDocDetailsID==e.DataRow["InvDocDetailsID_QTN"+s]);0==o.length?i["ReqQty"+s]=0:(i["ExeQty"+s]=o[0].POQty,this.ds.Columns[2].Contains("SelectedQty")&&(i["ReqQty"+s]=o[0].SelectedQty),t=!0)}if(t){for(s=0;s<this.cntVisibleGroups;s++)if(null!=e.Cells[s].Text)try{i[this.Grid.TableColumns[s]]="FLOAT"==this.ViewModel.ReportColumns[s].ColumnType?e.Cells[s].Value:e.Cells[s].Text}catch(r){}this.Grid.addRow(i),this.SetSelectedColor(i)}}this.Grid.Height=160,console.log(this.Grid)}AddRows(){let e,t,s,i,n=1;for(let o=this.cntGroups;o<=this.cntGroups+this.ViewModel.RepeatNextCols;o++)"Gross"==this.ViewModel.ColumnSource[o].ID&&(n=o-this.cntGroups);if(this.ViewModel.Preferences.ContainsKey("ShowQtnAddOns"))for(let o=0;o<this.ds.Tables[1].length;o++){let e=this.ds.Tables[1][o];if(null!=e.LinkedInvDocDetailsID)continue;let t=this.ds.Tables[0].filter(t=>t.ProductID==e.ProductID&&t.InvDocDetailsID==-parseInt(e.InvDocDetailsID));if(0==t.length)if(0!=t.length)parseFloat(t[0].Quantity)<parseFloat(e.Quantity)&&(t[0].Quantity=e.Quantity),e.LinkedInvDocDetailsID=t[0].InvDocDetailsID;else{let t={};this.ds.Tables[0].length>0&&(t.CostCenterID=this.ds.Tables[0][0].CostCenterID),this.ds.Columns[0].forEach(s=>{this.ds.Columns[1].Contains(s)&&(t[s]=e[s])}),t.InvDocDetailsID=-parseInt(t.InvDocDetailsID),e.LinkedInvDocDetailsID=t.InvDocDetailsID,this.ds.Tables[0].push(t)}}this.NumericRows=new Array(this.NumericFields.length),this.TextRows=new Array(this.TextFields.length),this.ProductRows=new Array(this.ds.Tables[0].length),this.oBasicValueRow=this.NewReportRow_2(r.f.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance_Data),this.oBasicValueRow.Cells[0].Text=o.a.GetResource("Reports_LblTotalBasicValue"),this.oBasicValueRow.Cells[0].ColSpan=this.cntGroups-this.cntHiddenGroups,this.oBasicValueRow.Cells[0].CellAppearance.Alignment="Left",this.oTotalRow=this.NewReportRow_2(r.f.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance_Data),this.oTotalRow.Cells[0].Text=o.a.GetResource("Reports_LblTotal"),this.oTotalRow.Cells[0].ColSpan=this.cntGroups-this.cntHiddenGroups,this.oTotalRow.Cells[0].CellAppearance.Alignment="Left",this.ViewModel.SNo=0;let a,h,u=new Array(this.Quotations.length).fill(0),c=new Array(this.Quotations.length).fill(0),C=l.e.NumArray(this.NumericFields.length,this.Quotations.length),p=new d.c,w=new d.c;for(this.ds.Columns[0].push("KPICols"),this.i=0;this.i<this.Quotations.length;this.i++)this.ds.Columns[0].push("InvDocDetailsID_QTN"+this.i);let m=new Array,I=this.ds.Tables[0];for(this.i=0;this.i<I.length;this.i++){m.Clear(),m.push(new r.d(this.oColumns.length,this.ViewModel.RowHeight)),m[0].DataRow=I[this.i];for(let e=0;e<this.cntGroups;e++){if(this.oColumns[e].Row>0){if(m.length-1<this.oColumns[e].Row)for(let t=0;t<=this.oColumns[e].Row;t++)m.length-1<t&&(m.push(new r.d(this.oColumns.length,this.ViewModel.SubRowHeight)),m[m.length-1].Type=r.f.Detail);a=this.oColumns[e].Row,h=this.oColumns[e].Column,m[a].Cells[h].IsNormal=!1,m[a].Cells[h].CellAppearance=this.oColumns[e].DataAppearance}else a=0,h=e;let t="";""!=this.oColumns[e].Formula&&"LATEST"!=this.oColumns[e].Formula&&"OLDEST"!=this.oColumns[e].Formula?t=this.ViewModel.CalculateFormula_1(this.oColumns[e].Formula,I[this.i],m):this.ds.Columns[0].Contains(this.oColumns[e].ID)&&(t=l.e.String(I[this.i][this.oColumns[e].ID])),""!=t&&(this.ViewModel.SetCellValue(t,this.oColumns[e].DataFormat,this.oColumns[e].ColumnType,m[a].Cells[h]),this.ViewModel.TotalCols.Contains(this.oColumns[e].ID)&&(this.ViewModel.totals[e][0]+=l.e.Double(t)))}if(-1!=this.ViewModel.colSNoIndex&&(m[0].Cells[this.ViewModel.colSNoIndex].Value=++this.ViewModel.SNo,m[0].Cells[this.ViewModel.colSNoIndex].Text=this.ViewModel.SNo.toString()),this.PurchaseOrderDocument>0){let e=parseFloat(I[this.i].Quantity),t=parseFloat(I[this.i].ExeQty);if(0!=t)for(let s=0;s<this.ViewModel.ReportColumns.length;s++)null==m[0].Cells[s].CellAppearance&&(m[0].Cells[s].CellAppearance=this.ViewModel.ReportColumns[s].DataAppearance.Clone()),m[0].Cells[s].IsNormal=!1,m[0].Cells[s].CellAppearance.BackColor=e<=t?this.ExecutedClr:this.PartialExecutedClr}this.oRow=m[0],p.Clear(),w.Clear();for(let e=0;e<this.Quotations.length;e++)if(this.dvQuotations=this.dvQuotationsTable.filter(t=>t.VoucherNo==this.Quotations[e]&&t.LinkedInvDocDetailsID==this.ds.Tables[0][this.i].InvDocDetailsID),this.dvQuotations.length>0){m[0].DataRow["InvDocDetailsID_QTN"+e]=this.dvQuotations[0].InvDocDetailsID;for(let t=this.cntGroups;t<=this.cntGroups+this.ViewModel.RepeatNextCols;t++){if(this.oColumns[t].Row>0){if(m.length-1<this.oColumns[t].Row)for(let e=0;e<=this.oColumns[t].Row;e++)m.length-1<e&&(m.push(new r.d(this.oColumns.length,this.ViewModel.SubRowHeight)),m[m.length-1].Type=r.f.Detail);a=this.oColumns[t].Row,h=this.oColumns[t].Column,m[a].Cells[h+e*this.cntCols].IsNormal=!1,m[a].Cells[h+e*this.cntCols].CellAppearance=this.oColumns[t].DataAppearance.Clone()}else a=0,h=t;let s="";""!=this.oColumns[t].Formula&&this.CalculateFormula(this.oColumns[t],this.dvQuotations[0]),Object(D.isNullOrUndefined)(this.dvQuotations[0][this.oColumns[t].ID])||(s=this.dvQuotations[0][this.oColumns[t].ID].toString()),""!=s&&(i=m[a].Cells[h+e*this.cntCols],this.ViewModel.SetCellValue(s,this.oColumns[t].DataFormat,"FLOAT",i),this.ViewModel.TotalCols.Contains(this.oColumns[t].ID)&&(this.ViewModel.totals[t][0]+=l.e.Double(s)),this.oColumns[t].ID==this.GrandTotalColumnID&&(c[e]+=l.e.Double(s)),this.oColumns[t].ID==this.RateKPIColumn&&(p.push(h+e*this.cntCols,parseFloat(s)),w.push(h+e*this.cntCols,i)))}u[e]+=parseFloat(this.dvQuotations[0].Gross)}if(this.ProductRows[this.i]=m[0],m.forEach(e=>{this.AllProductRows.push(e)}),p.length>0){var R=p.values.filter(e=>0!=e);if(R.length>0){let e=Math.min.apply(null,R);p.keys.forEach(t=>{e==p[t]&&(null==w[t].CellAppearance&&(w[t].CellAppearance=this.ViewModel.ReportColumns[t].DataAppearance.Clone()),w[t].IsNormal=!1,w[t].CellAppearance.BackColor=this.RateKPIColumnColor,w[t].CellAppearance.ForeColor="White",this.oRow.Cells.Contains(w[t])&&(this.oRow.DataRow.KPICols=l.e.IsEmpty(this.oRow.DataRow.KPICols)?t:l.e.String(this.oRow.DataRow.KPICols)+","+t))})}}}for(let o=0;o<this.Quotations.length;o++)this.ViewModel.SetCellValue(u[o],this.oColumns[this.cntGroups+o*this.cntCols+n].DataFormat,"FLOAT",this.oBasicValueRow.Cells[this.cntGroups+o*this.cntCols+n]);for(this.i=0;this.i<this.NumericFields.length;this.i++){this.NumericRows[this.i]=this.NewReportRow(),this.dvFields=this.dvFieldsTable.filter(e=>e.SysColumnName==this.NumericFields[this.i]),this.NumericRows[this.i].Cells[0].Text=this.dvFields.length>0?this.dvFields[0].UserColumnName.toString():this.NumericFields[this.i],this.NumericRows[this.i].Cells[0].ColSpan=this.cntGroups-this.cntHiddenGroups,this.NumericFieldsBold[this.i]&&(this.NumericRows[this.i].Cells[0].IsNormal=!1,this.NumericRows[this.i].Cells[0].CellAppearance=this.oColumns[0].DataAppearance.Clone(),this.NumericRows[this.i].Cells[0].CellAppearance.IsBold=!0);let e=new Array;for(let o=0;o<this.Quotations.length;o++){for(s=0,e.Clear(),this.dvQuotations=this.dvQuotationsTable.filter(e=>e.VoucherNo==this.Quotations[o]),this.k=0;this.k<this.dvQuotations.length;this.k++)t=l.e.Double(this.dvQuotations[this.k][this.NumericFields[this.i].Insert(2,"Calc")]),C[o]+=t,t=l.e.Double(this.dvQuotations[this.k][this.NumericFields[this.i]]),s+=t,e.Contains(t)||e.push(t);if(this.NumericFieldsIgnoreTotal[this.i]||(u[o]+=C[this.i][o]),this.ViewModel.SetCellValue(C[o],this.oColumns[this.cntGroups+o*this.cntCols+1].DataFormat,"FLOAT",this.NumericRows[this.i].Cells[this.cntGroups+o*this.cntCols+n]),this.NumericFieldsBold[this.i]&&(this.NumericRows[this.i].Cells[this.cntGroups+o*this.cntCols+n].IsNormal=!1,this.NumericRows[this.i].Cells[this.cntGroups+o*this.cntCols+n].CellAppearance=this.oColumns[this.cntGroups+o*this.cntCols+n].DataAppearance.Clone(),this.NumericRows[this.i].Cells[this.cntGroups+o*this.cntCols+n].CellAppearance.IsBold=!0),Math.abs(s-C[this.i][o])>.001&&(i=this.NumericRows[this.i].Cells[this.cntGroups+o*this.cntCols+n-1],i.IsNormal=!1,i.CellAppearance=this.ViewModel.ReportColumns[this.cntGroups+n].DataAppearance.Clone(),i.CellAppearance.Alignment="Left",this.NumericFieldsBold[this.i]&&(i.CellAppearance.IsBold=!0),e.length>0)){let t="";e.sort((e,t)=>e-t);for(let s=0;s<e.length;s++)t.length>0&&(t+=", "),t+=e[s].toString();i.Text="@"+t}}}let T=new Array;for(this.i=0;this.i<this.TextFields.length;this.i++){this.TextRows[this.i]=this.NewReportRow(),this.dvFields=this.dvFieldsTable.filter(e=>e.SysColumnName==this.TextFields[this.i]),this.TextRows[this.i].Cells[0].Text=this.dvFields.length>0?this.dvFields[0].UserColumnName.toString():this.TextFields[this.i],this.TextRows[this.i].Cells[0].ColSpan=this.cntGroups-this.cntHiddenGroups;for(let t=0;t<this.Quotations.length;t++)for(i=this.TextRows[this.i].Cells[this.cntGroups+t*this.cntCols],i.IsNormal=!1,i.ColSpan=this.cntCols-this.cntHiddenCols,i.Text="",i.CellAppearance=this.ViewModel.ReportColumns[1+t*this.cntCols].DataAppearance.Clone(),i.CellAppearance.Alignment="Left",T.Clear(),this.dvQuotations=this.dvQuotationsTable.filter(e=>e.VoucherNo==this.Quotations[t]),this.k=0;this.k<this.dvQuotations.length;this.k++)e=this.TextFields[this.i].startsWith("dcAlpha")?l.e.String(this.dvQuotations[this.k][this.TextFields[this.i]]):l.e.String(this.dvQuotations[this.k][this.TextFields[this.i]+"Name"]),e.length>0&&!T.Contains(e)&&(T.push(e),i.Text.length>0&&(i.Text+=","),i.Text+=e)}if(u.length>0)if(l.e.IsEmpty(this.GrandTotalColumnID)){let e=Math.min.apply(null,u);for(let t=0;t<this.Quotations.length;t++)this.ViewModel.SetCellValue(u[t],this.oColumns[this.cntGroups+t*this.cntCols+n].DataFormat,"FLOAT",this.oTotalRow.Cells[this.cntGroups+t*this.cntCols+n]),e==u[t]&&(this.oTotalRow.Cells[this.cntGroups+t*this.cntCols+n].CellAppearance.BackColor=this.RateKPIColumnColor,this.oTotalRow.Cells[this.cntGroups+t*this.cntCols+n].CellAppearance.ForeColor="White")}else{let e=Math.min.apply(null,c);for(let t=0;t<this.Quotations.length;t++)this.ViewModel.SetCellValue(c[t],this.oColumns[this.cntGroups+t*this.cntCols+n].DataFormat,"FLOAT",this.oTotalRow.Cells[this.cntGroups+t*this.cntCols+n]),e==c[t]&&(this.oTotalRow.Cells[this.cntGroups+t*this.cntCols+n].CellAppearance.BackColor=this.RateKPIColumnColor,this.oTotalRow.Cells[this.cntGroups+t*this.cntCols+n].CellAppearance.ForeColor="White")}}CalculateFormula(e,t){let s=this.fldDict;for(let o=0;o<this.fldDict.keys.length;o++){let e={Key:this.fldDict.keys[o]};Object(D.isNullOrUndefined)(t[e.Key])?this.fldDict[e.Key].setFieldValue(0):this.fldDict[e.Key].setFieldValue(null!=t[e.Key]?t[e.Key]:"")}if(!l.e.IsEmpty(e.Formula))try{t[e.ID]=this.eval.EvaluateExpression(e.Formula,s).toString()}catch(i){}return!1}RowDblClick(e,t){if(parseFloat(e.DataRow.Quantity)!=parseFloat(e.DataRow.ExeQty))if(0!=this.QuotationComparisonDocument){let s,i=this.ViewModel.Data.indexOf(e);if(-1==i)return void(this.ViewModel.DisplayMessage="Product Row Not Found");{let n="";-1!=t&&t>=this.cntVisibleGroups&&!l.e.IsEmpty(this.ViewModel.ReportColumns[t].MatixRepeatID)&&(n=this.Quotations[parseInt(this.ViewModel.ReportColumns[t].MatixRepeatID)]);let a=new V(this,n,e.DataRow,i);if(0==a.VendorsList.Items.length)return void(this.ViewModel.DisplayMessage="No quotations raised for selected product");o.a.page.ShowDialog(a,w.a,{ShowCenter:!0}).subscribe(()=>{if(!a.IsOkClick)return;let t,o=!1,l=this.Grid.Table.filter(e=>e.ReportRowId==i);if(0==l.length?(o=!0,t=this.Grid.NewRow(),t.ReportRowId=this.ViewModel.Data.indexOf(e)):t=l[0],t["ReqQty"+this.Quotations.indexOf(a.VendorsList.SelectedValue)]=a.Quantity.Text,o){for(s=0;s<this.cntVisibleGroups;s++)if(null!=e.Cells[s].Text)try{t[s]="FLOAT"==this.ViewModel.ReportColumns[s].ColumnType?e.Cells[s].Value:e.Cells[s].Text}catch(n){}this.Grid.addRow(t)}this.SetSelectedColor(t)})}}else{let t=l.e.String(e.DataRow.KPICols).split(",");e.IsSelected=!e.IsSelected;for(let s=0;s<e.Cells.length;s++)t.Contains(s.toString())||(null==e.Cells[s].CellAppearance&&(e.Cells[s].CellAppearance=this.ViewModel.ReportColumns[s].DataAppearance.Clone()),e.Cells[s].IsNormal=!1,e.Cells[s].CellAppearance.ForeColor=e.IsSelected?"#FF00A9DA":"Black");this.ViewModel.updateRow(e),this.ViewModel.refreshDataView(e),this.ViewModel.SelectedRow=e}}SelectAllRows(e){if(0==this.QuotationComparisonDocument)return;this.ViewModel.ReportColumns.indexOf(e);let t="";if(l.e.IsEmpty(e.MatixRepeatID)||(t=this.Quotations[parseInt(e.MatixRepeatID)]),""==t)return void(this.ViewModel.DisplayMessage="Please Click On Quotation Columns");if(this.Grid.Table.length>0){if(!confirm("Quoation already selected. Do you want to change?"))return;this.Grid.Clear()}let s=parseInt(e.MatixRepeatID);for(let o=0;o<this.ViewModel.Data.length;o++){if(this.oRow=this.ViewModel.Data[o],null==this.oRow.DataRow)continue;if(null==this.oRow.DataRow["InvDocDetailsID_QTN"+s])continue;let e,t=!1,l=this.Grid.Table.filter(e=>e.ReportRowId==o);if(0==l.length?(t=!0,e=this.Grid.NewRow(),e.ReportRowId=o):e=l[0],this.dvQuotations=this.dvQuotationsTable.filter(e=>e.InvDocDetailsID==this.oRow.DataRow["InvDocDetailsID_QTN"+s]),0!=this.dvQuotations.length&&(e["ReqQty"+s]=this.dvQuotations[0].Quantity.toString(),t)){for(let t=0;t<this.cntVisibleGroups;t++)if(null!=this.oRow.Cells[t].Text)try{e[t]="FLOAT"==this.ViewModel.ReportColumns[t].ColumnType?this.oRow.Cells[t].Value:this.oRow.Cells[t].Text}catch(i){}this.Grid.addRow(e)}}this.ViewModel.DisplayMessage=t+" - All Rows Added"}Grid_BeginEdit(e,t,s){if((t=e.args.column.field).startsWith("ReqQty")){let s=parseInt(t.Replace("ReqQty","")),i=parseInt(e.ReportRowId);if(null==this.ViewModel.Data[i].DataRow["InvDocDetailsID_QTN"+s])return e.args.Cancel=!0,!0}return e.args.Cancel=!1,!1}Grid_EndEdit(e,t,s){if(t.startsWith("ReqQty")){this.ViewModel.DisplayMessage="";let s=parseInt(t.Replace("ReqQty",""));parseFloat(e["ReqQty"+s])<parseFloat(e["ExeQty"+s])&&(e["ReqQty"+s]=e["ExeQty"+s],this.ViewModel.DisplayMessage="Please enter required qty greater than executed qty")}}Post(){if(null!=this.ProductRows)if(0==this.ProductRows.length)this.ViewModel.DisplayMessage="No products found";else if(0==this.Quotations.length)this.ViewModel.DisplayMessage="No vendors found to post";else if(this.QuotationComparisonDocument>4e4){if(0==this.Grid.Table.length)return void(this.ViewModel.DisplayMessage="Select products to post");this.PostQuotationComparison()}else{let e=new V(this,"",null,0);o.a.page.ShowDialog(e,w.a,{ShowCenter:!0,Title:"Post",NoWidth:!0}).subscribe(()=>{e.IsOkClick&&this.PostPO(e)})}}PostPO(e){return Object(i.b)(this,void 0,void 0,(function*(){let t=this.ProductRows.filter(e=>1==e.IsSelected);0==t.length&&(t=this.ProductRows);let s=0;if(this.ViewModel.Preferences.ContainsKey("PurchaseOrderDocument")&&this.ViewModel.Preferences.PurchaseOrderDocument.length>0&&(s=parseInt(this.ViewModel.Preferences.PurchaseOrderDocument)),0==s)this.ViewModel.DisplayMessage="Purchase Order document is not configured";else{o.a.page.ShowLoading=!0;let i="",l=new Array;null==e.VendorsList.SelectedIndex&&(e.VendorsList.SelectedIndex=0);let n="InvDocDetailsID_QTN"+e.VendorsList.SelectedIndex;t.forEach(e=>{null!=e.DataRow[n]&&(0==i.length&&(i=e.DataRow[n].toString()),l.push(e.DataRow[n].toString()))});let a=null;i.length>0&&(a=o.a.report.ReportDataTable("RPT045",this.ViewModel.IsReportDB,i),0==a.length&&(a=null)),m.RibbonExtViewModel.GetDocumentObject(s,"",null==a,a).then(t=>{var s=t.ScreenObject.Link.LinkCombo.Items.find(e=>e.Parent==this.QuotationDocument.toString());if(s){var i=e.VendorsList.GetselectedItem();null!=i&&null!=t.ScreenObject.CreditAccount&&(t.ScreenObject.CreditAccount.SelectedValue=i.CurrID);let n=t.ScreenObject.GetLinkDocDetails(e.VendorsList.SelectedValue,parseInt(s.Value));for(let e=0;e<n.Tables[0].length;e++)if(l.Contains(n.Tables[0][e].DocDetailsID.toString())){let t=n.Tables[0].filter(t=>t.DynamicInvDocDetailsID==n.Tables[0][e].DocDetailsID);e+=t.length}else{let t=n.Tables[0].filter(t=>t.DynamicInvDocDetailsID==n.Tables[0][e].DocDetailsID);for(let s=0;s<t.length;s++)n.Tables[0].RemoveAt(e),n.Tables[1].RemoveAt(e),n.Tables[2].RemoveAt(e),n.Tables[3].RemoveAt(e);n.Tables[0].RemoveAt(e),n.Tables[1].RemoveAt(e),n.Tables[2].RemoveAt(e),n.Tables[3].RemoveAt(e),e--,e-=t.length}t.LoadLinkData(n,new Array,0,new Array,null),o.a.page.addNewTab({component:I.AddEditDocumentComponent,params:{obj:t}})}else this.ViewModel.DisplayMessage="Please place linking between Quotation and Purchase Order Docuemnt"})}}))}PostQuotationComparison(){let e=this.ViewModel.Preferences.ContainsKey("PQDCIPostOnlySelected"),t=this.ProductRows.filter(e=>1==e.IsSelected);0==t.length&&(t=this.ProductRows);let s=null;0==this.ComparisonDocID&&this.Quotations.length>0&&(s=o.a.report.ReportDataTable("RPT022",this.ViewModel.IsReportDB,"select top  1 DCC.* from inv_docdetails D with(nolock) join com_docccdata DCC with(nolock) on DCC.InvDocDetailsID=D.InvDocDetailsID where D.VoucherNo='"+this.Quotations[0]+"'"),0==s.length&&(s=null)),m.RibbonExtViewModel.GetDocumentObject(this.QuotationComparisonDocument,"Post Document",this.ComparisonDocID>0,s).then(t=>{if(this.oDocument=t,0==this.ComparisonDocID&&!this.oDocument.DialogResult)return!1;this.oDocument.SaveCallBack=new R.b,this.oDocument.SaveCallBack.Subscribe(this,"OnSaveCallBack");var s=this.oDocument.ScreenObject.Link.LinkCombo.Items.find(e=>e.Parent==this.QuotationDocument.toString());if(s){let t,o="",n=new Array,a=new Array;for(let s=0;s<this.Grid.Table.length;s++){let i=this.Grid.Table[s];for(let s=0;s<this.Quotations.length;s++){if(null==i["ReqQty"+s])continue;if(t=parseFloat(i["ReqQty"+s]),t<=0)continue;let o=parseInt(i.ReportRowId),l=this.ViewModel.Data[o].DataRow,r={};r[0]=parseInt(l["InvDocDetailsID_QTN"+s]),e&&n.push(r);let h=new T;h.InvID_QTN=parseInt(l["InvDocDetailsID_QTN"+s]),h.UsedQty=0,h.ReqQty=t,a.push(h)}}for(let e=0;e<this.Quotations.length;e++)e>0&&(o+=","),o+="'"+this.Quotations[e]+"'";if(this.ComparisonDocID>0&&m.RibbonExtViewModel.OnDocPrefixChanged(this.oDocument,this.ComparisonDocID),o.length>0){let e,t,r=new Array;for(let s=0;s<this.oDocument.GRIDTABLE.length;s++)null!=this.oDocument.GRIDTABLE[s].LinkedInvDocDetailsID&&0!=parseInt(this.oDocument.GRIDTABLE[s].LinkedInvDocDetailsID)&&r.push(s);o=o.Trim("'"),this.oDocument.FillLink(o,parseInt(s.Value),n,new Array);for(let s=0;s<this.oDocument.GRIDTABLE.length;s++)if(r.Contains(s)){e=this.oDocument.GRIDTABLE[s];for(let i=s+1;i<this.oDocument.GRIDTABLE.length;i++)t=this.oDocument.GRIDTABLE[i],null!=t.LinkedInvDocDetailsID&&parseInt(e.LinkedInvDocDetailsID)==parseInt(t.LinkedInvDocDetailsID)&&this.oDocument.GRIDTABLE.RemoveAt(i)}for(let s=0;s<this.oDocument.GRIDTABLE.length;s++){let e=this.oDocument.GRIDTABLE[s];if(e[this.ComparisonQtyField]=0,e[this.ComparisonStatusField]="",null!=e.LinkedInvDocDetailsID){var i=a.find(t=>t.InvID_QTN==parseInt(e.LinkedInvDocDetailsID));i&&(this.ComparisonQtyField.length>0&&this.oDocument.ScreenObject.GridDataColumns.Contains(this.ComparisonQtyField)&&(e[this.ComparisonQtyField]=i.ReqQty+i.UsedQty),this.ComparisonStatusField.length>0&&this.oDocument.ScreenObject.GridDataColumns.Contains(this.ComparisonStatusField)&&(e[this.ComparisonStatusField]="SELECTED"))}}let h=new Array,d=this.ds.Tables[1];d.Sort="LinkedInvDocDetailsID";for(let s=0;s<d.length;s++){let e=d[s];if(null==e.LinkedInvDocDetailsID)continue;let t=new T;t.InvID_QTN=parseInt(e.InvDocDetailsID),t.InvID_MRN=parseInt(e.LinkedInvDocDetailsID),h.push(t)}for(let s=0;s<this.oDocument.GRIDTABLE.length;s++){let e=this.oDocument.GRIDTABLE[s];e.IndentID=0,null!=e.LinkedInvDocDetailsID&&0!=parseInt(e.LinkedInvDocDetailsID)&&(this.dvQuotations=this.dvQuotationsTable.filter(t=>t.InvDocDetailsID==e.LinkedInvDocDetailsID),this.dvQuotations.length>0&&(e.IndentID=this.dvQuotations[0].LinkedInvDocDetailsID))}let u=this.oDocument.GRIDTABLE.filter(e=>l.e.IsNum(e.ProductID_Key)&&0!=e.ProductID_Key);u.SortBy(["IndentID"]);for(let s=0;s<u.length;s++)u[s].DocSeqNo=s+1;let c=!1;return c=this.oDocument.SaveInventoryDocument(0!=this.oDocument.DocID?"Revise":"Save",!0,!0,"SYNC_SAVE"),c}return this.ViewModel.DisplayMessage="Please enter PO Qty.",!1}return this.ViewModel.DisplayMessage="Please place linking between Quotation and Comparison Docuemnt",!1})}OnSaveCallBack(e,t){return null!=this.oDocument&&(this.ComparisonDocID=t,this.ViewModel.ComparisonINTERQTN=this.oDocument.ScreenObject.VoucherNo,this.ViewModel.DisplayMessage=this.oDocument.DisplayMessage,this.ViewModel.ShowMessageBox(this.oDocument.DisplayMessage,"Alert")),""}SetSelectedColor(e,t=!1){if(0==this.FullSelectedClr.length&&0==this.PartialSelectedClr.length)return;let s=0;if(!t)for(let n=0;n<this.Quotations.length;n++)null!=e["ReqQty"+n]&&(s+=parseFloat(e["ReqQty"+n]));let i=parseInt(e.ReportRowId),o=this.ViewModel.Data[i],l=parseFloat(o.DataRow.Quantity);for(let n=0;n<this.ViewModel.ReportColumns.length;n++)null==o.Cells[n].CellAppearance&&(o.Cells[n].CellAppearance=this.ViewModel.ReportColumns[n].DataAppearance.Clone()),o.Cells[n].IsNormal=!1,0==s?o.Cells[n].CellAppearance.ForeColor=this.ViewModel.ReportColumns[n].DataAppearance.ForeColor:s<l&&this.PartialSelectedClr.length>0?o.Cells[n].CellAppearance.ForeColor=this.PartialSelectedClr:s>=l&&this.FullSelectedClr.length>0&&(o.Cells[n].CellAppearance.ForeColor=this.FullSelectedClr);this.ViewModel.Data.RemoveAt(i),this.ViewModel.Data.Insert(i,o),this.ViewModel.SelectedRow==o&&(this.ViewModel.SelectedRow=null,this.ViewModel.SelectedRow=o)}}class V extends u.b{constructor(e,t,s,i){super(),this.IsOkClick=!1,this.iRowId=0,this.QTNCol="",this.MRNQty=0,this.oComp=e,this.VendorsList=new c.e,this.Quantity=new C.d,this.VendorsList.Label="Select Vendor",this.Quantity.Label="Select Quantity";for(let o=0;o<e.Quotations.length;o++)e.dvQuotations=e.dvQuotationsTable.filter(t=>t.VoucherNo==e.Quotations[o]),null!=s&&null==s["InvDocDetailsID_QTN"+o]||(null!=s&&(this.MRNQty=parseFloat(s.Quantity)),this.VendorsList.Items.push(c.d.ComboBoxItems_3(e.dvQuotations[0].CreditAccountName.toString()+" ["+e.Quotations[o]+"]",e.Quotations[o],o.toString())),this.VendorsList.Items[this.VendorsList.Items.length-1].CurrID=parseInt(e.dvQuotations[0].CreditAccount),null!=s&&null!=s["InvDocDetailsID_QTN"+o]&&(e.dvQuotations=e.dvQuotationsTable.filter(e=>e.InvDocDetailsID==s["InvDocDetailsID_QTN"+o]),e.dvQuotations.length>0&&(this.VendorsList.Items[this.VendorsList.Items.length-1].Aliasname=e.dvQuotations[0].Quantity.toString())));this.VendorsList.SelectedValue=!l.e.IsEmpty(t)&&this.VendorsList.Items.find(e=>e.Value==t)?t:this.VendorsList.Items[0].Value,0==e.QuotationComparisonDocument?this.Quantity.Visible=!1:(this.Quantity.Text="0",this.iRowId=i,this.VendorsList.SelectionChangedCommand.Subscribe(this,"OnVendorChange"),this.OnVendorChange(null)),e.ViewModel.Preferences.ContainsKey("RestrictQTNQtyEdit")&&(this.Quantity.Enable=!1)}OnVendorChange(e){let t=0;var s=this.VendorsList.GetselectedItem();let i=this.oComp.Grid.Table.filter(e=>e.ReportRowId==this.iRowId);this.QTNCol=s.Parent,i.length>0&&(t=null!=i[0]["ReqQty"+s.Parent]?parseFloat(i[0]["ReqQty"+s.Parent]):0),0!=t||null==s||l.e.IsEmpty(s.Aliasname)||(t=parseFloat(s.Aliasname)),this.Quantity.Text=t.ToString("N"+o.a.SessionManager.Preferences.DecimalsinQty)}OnButtonClick(e){if(this.oComp.ViewModel.DisplayMessage="","Cancel"==e)o.a.page.HideDialog();else if("OK"==e){if(this.oComp.QuotationComparisonDocument>4e4){let e=l.e.Double(this.Quantity.Text),s=0,i=this.oComp.Grid.Table.filter(e=>e.ReportRowId==this.iRowId);if(i.length>0&&(s=null!=i[0]["ExeQty"+this.QTNCol]?parseFloat(i[0]["ExeQty"+this.QTNCol]):0),e<0)return void(this.oComp.ViewModel.DisplayMessage="Please enter valid quantity");if(0==e){if(0==i.length)return void(this.oComp.ViewModel.DisplayMessage="Please enter valid quantity");{let e=!1;for(let t=0;t<this.oComp.Quotations.length;t++)if(t.toString()!=this.QTNCol&&null!=i[0]["ReqQty"+t]&&parseFloat(i[0]["ReqQty"+t])>0){e=!0;break}if(!e)return this.oComp.SetSelectedColor(i[0],!0),this.oComp.Grid.removeRow(i[0]),this.IsOkClick=!1,void o.a.page.HideDialog()}}else{if(e<s)return void(this.oComp.ViewModel.DisplayMessage="Quantity should not be less than executed quantity");var t=this.VendorsList.GetselectedItem();if(null!=t&&!l.e.IsEmpty(t.Aliasname)&&this.oComp.ViewModel.Preferences.ContainsKey("QTNC_MRNQtyCheck")&&"1"==this.oComp.ViewModel.Preferences.QTNC_MRNQtyCheck){let t=e;if(i.length>0)for(let e=0;e<this.oComp.Quotations.length;e++)e.toString()!=this.QTNCol&&null!=i[0]["ReqQty"+e]&&parseFloat(i[0]["ReqQty"+e])>0&&(t+=parseFloat(i[0]["ReqQty"+e]));if(this.MRNQty<t)return void(this.oComp.ViewModel.DisplayMessage="Quantity should not be greater than requisition quantity")}}}this.IsOkClick=!0,o.a.page.HideDialog()}}}}}]);
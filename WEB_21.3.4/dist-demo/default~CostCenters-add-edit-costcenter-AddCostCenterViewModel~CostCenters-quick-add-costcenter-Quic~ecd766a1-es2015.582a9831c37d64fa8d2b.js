(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{"2pkr":function(t,e,s){"use strict";s.r(e),s.d(e,"AddCostCenterViewModel",(function(){return R}));var i=s("Do2H"),n=s("Lp6j"),a=s("eQJW"),o=s("THE7"),r=s("RJs6"),l=s("OvA8"),h=s("INyF"),c=s("vVAv"),C=s("n56n"),d=s("EQd/"),u=s("0/4Q"),b=s("knKa"),m=s("c6C+"),S=s("iqoD"),g=s("NkMH"),D=s("xnJf"),p=s("bgvB"),I=s("4ADR"),A=s("4HhE"),T=s("ru5v"),V=s("VxiT"),M=s("vTM8"),N=s("JIg3"),y=s("ScVY"),P=s("x68t"),f=s("wJuo"),j=s("CNN3"),O=s("NXvD"),L=s("4k0m"),w=s("++IR"),E=s("V7Sd"),G=s("JJ8n"),x=s("Tvp0"),F=s("8B8H"),v=s("ockk");class R extends y.b{constructor(t){super(),this.IsAttachmentMandatory=!1,this.PactScreenID="0",this.ht=new M.a,this.NextPrevID=0,this.SaveCostCenter=new A.b,this.CustomizeExtraFields=new A.b,this.onGetData=new A.b,this.TempscreenTitle="",this.ButtonEnable=!0,this.NextPreviousVisibility=!0,this.ScreenObject=new V.a,this.Name=d.d.PactTextBoxData_1(0),this.CurrencyID=C.b.PactListBoxData_1(0),this.Code=d.a.PactCodeData_1(0),this.AliasName=d.d.PactTextBoxData_1(0),this.Status=u.g.PactStausComboData_1(0),this.Group=C.b.PactListBoxData_1(0),this.CreditLimit=d.d.PactTextBoxData_1(0),this.CreditDays=d.d.PactTextBoxData_1(0),this.DebitDays=d.d.PactTextBoxData_1(0),this.DebitLimit=d.d.PactTextBoxData_1(0),this.AddressTypes=[],this.Address1="",this.Address2="",this.Address3="",this.City="",this.State="",this.Country="",this.Pin="",this.Phone1="",this.Phone2="",this.Fax="",this.Enable="",this.Email1="",this.Email2="",this.ActualFileName="",this.ThumbnailPhoto="",this.SalesAccount=C.b.PactListBoxData_1(270),this.PurchaseAccount=C.b.PactListBoxData_1(271),this.ButtonSaveMultiple=new g.a,this.ButtonSave=new g.a,this.ButtonCustomize=new g.a,this.FileExtension="",this.FileDescription="",this.RetValue=0,this.ProfileID=-1,this.ds=null,this.IsMRP2MachineDim=!1,this.dsProjWOffHol=null,this.ClassName="AddCostCenterViewModel",this.CostCenterID=t,this.objCostCenter=new T.a,this.ViewContacts=new o.a(this),this.ViewNotes=new r.a(this),this.ViewAttachments=new l.ViewAttachmentViewModel(this),this.ViewAddress=new h.a(this),this.ViewCCMapping=new c.a(this),this.Address=new S.a,this.Address.AddAddressViewModel_2(this)}AddCostCenterViewModel_1(t,e,s,n,a){if(this.CostCenterID=e,i.a.SessionManager.Logger.InfoLog("AddCostCenterViewModel::Entering AddCostCenterViewModel With ID="+t+"CostCenterID"+e+"Parent"+s+"Name"+n),this.objCostCenter=new T.a,this.ViewCCMapping=new c.a(this),this.ViewCCMapping.ViewCCMappingViewModel_1(this,e,t),this.TempscreenTitle=n,0==t?i.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=i.a.SessionManager.IsActionAssigned(e,"Create"):this.ButtonSave.Enable=i.a.SessionManager.IsActionAssigned(e,"Create"):(this.ScreenObject.IsEdit=!0,i.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=i.a.SessionManager.IsActionAssigned(e,"Update"):this.ButtonSave.Enable=i.a.SessionManager.IsActionAssigned(e,"Update")),i.a.SessionManager.HideUnathorizedAccess?this.ButtonCustomize.Visible=i.a.SessionManager.IsActionAssigned(e,"Customize"):this.ButtonCustomize.Enable=i.a.SessionManager.IsActionAssigned(e,"Customize"),this.PrintVisible=i.a.SessionManager.IsActionAssigned(e,"PrintVPT"),this.objCostCenter.CostCenterID=e,this.objCostCenter.IsGroup=a,this.CostCenterID=e,this.PactScreenID=e.toString(),this.ScreenData=this.BuildControls(),i.a.SessionManager.Preferences.ContainsKey("ProjectManagementDimension")&&this.PactScreenID==i.a.SessionManager.Preferences.ProjectManagementDimension&&(this.StartVisible=!0,this.StopVisible=!0,this.HoldVisible=!0,this.ViewProgress=new r.a(this),this.ViewProgress.IsProgress=!0,this.ViewProgress.ProgressWidth="150",this.ViewProgress.NotesWidth="650",this.ViewProgress.LoadStaticColumns()),this.TypeID=3,this.NodeID=t,this.RefreshTitle(),this.GroupID=s,this.ScreenName=n,this.DetailsVisibility=!0,this.IsPhotoChanged=!1,this.PhotoTextVisibility=!0,this.AccountPhoto="",this.ActualFileName="",this.onGetData.Subscribe(this,"GetRecords"),this.SaveCostCenter.Subscribe(this,"OnSaveCostCenter"),this.CustomizeExtraFields.Subscribe(this,"OnCustomize"),this.Name.LostFocusCommand.Subscribe(this,"OnNameLostFocus"),this.ViewContacts=new o.a(this),this.ViewNotes=new r.a(this),this.ViewAttachments=new l.ViewAttachmentViewModel(this),this.ViewAddress=new h.a(this),this.ScreenObject.StatusAssignGrid=new O.a,this.Status.ClickCommand.Subscribe(this.ScreenObject,"OnStatusLinkClick"),i.a.SessionManager.Preferences.ContainsKey("MRP2Version")){let t=i.a.common.GetDataSet("AECC001","");null!=t&&t.Tables.length>0&&""!=t.Tables[0][0][t.Columns[0][0]].toString()&&"0"!=t.Tables[0][0][t.Columns[0][0]].toString()&&parseInt(t.Tables[0][0][t.Columns[0][0]])==e&&(this.IsMRP2MachineDim=!0)}if(this.OnLoad(),this.ContactVisibility=!1,this.DetailsVisibility=!1,this.AttachmentVisibility=!1,null!=this.PContact&&(this.PrimaryVisibility=!0),this.AddressVisibility=!1,this.CCMapVisibility=!1,this.Group.SelectionChangedCommand.Subscribe(this,"OnGroupSelectionChanged"),0==this.NodeID&&(this.Group.SelectedValue=0!=s?s:2,this.NextPreviousVisibility=!1),0!=this.NodeID&&this.ScreenObject.IsAutoCode&&(this.Code.Enable=parseInt(this.ds.Tables[0][0].Depth)<=1&&!this.ScreenObject.IsRootAutoCode),i.a.SessionManager.Preferences.PosCoupons==e.toString())this.ButtonSaveMultiple.Visible=!0;else if(this.ScreenObject.IsAutoCode&&this.ScreenObject.IsAutoName){let t=this.ScreenObject.Data.Tables[5].filter(t=>"BinsDimension"==t.Name);this.ButtonSaveMultiple.Visible=t.length>0&&t[0].Value.toString()==e.toString()}else this.ButtonSaveMultiple.Visible=!1;this.Address=new S.a,this.Address.AddAddressViewModel_2(this),Logger.InfoLog("AddCostCenterViewModel::Exiting AddCostCenterViewModel")}OnGroupSelectionChanged(t){null!=t&&("Group"==t.toString()||"PACT.COMMON.PactListBoxData"==t.toString()&&"IsGroup"==t.DBColumnName)&&this.Group.SelectedValue>0&&(this.Group.DefaultValue=this.Group.SelectedValue.toString(),this.AutoGenerateCode(),this.LoadParentData())}GetRecords(t){this.ButtonSave.Enable||(this.ButtonSave.Enable=!0);let e=0,s=!1;"NEXT"==t.toString().toUpperCase()?s=!0:"PREVIOUS"==t.toString().toUpperCase()&&(s=!1);let n=i.a.common.GetNextPreviousRecords(this.CostCenterID,this.NextPrevID,s,0,this.objCostCenter.IsGroup?1:0);null!=n&&n.Tables.length>0&&n.Tables[0].length>0&&(e=parseInt(n.Tables[0][0].NodeID),0!=e&&(this.NextPrevID=e,this.NodeID=e,this.objCostCenter.IsGroup=Object(a.j)(n.Tables[0][0].IsGroup),this.ScreenObject.IsGroup=Object(a.j)(n.Tables[0][0].IsGroup),this.RefreshTitle(),this.ScreenObject.ClearStatusItems(),this.FillControls(),this.PNodeID=e,this.RefreshControls(),null!=this.MappingVM&&(this.MappingVM.MessageVisibility=!1,this.MappingVM.DisplayMessage="",this.MappingVM.CCID=this.CostCenterID,this.MappingVM.NodeID=this.NodeID,this.MappingVM.Mapping(this.ProfileID,this.CostCenterID,this.NodeID))))}RefreshControls(){this.NoteVisibility?this.ViewNotes.OnShowNewNotes(null):this.AttachmentVisibility?this.ViewAttachments.OnShowNewAttachment(null):this.ContactVisibility?(this.Contact=null,this.ViewContacts.OnShowNewContact(null)):this.AddressVisibility?(this.Address=null,this.ViewAddress.OnShowNewAddress(null)):this.CCMapVisibility&&this.ViewCCMapping.OnShowCC(null)}onTabSelectionChanged(t){null!=this.ScreenObject.CustomTab.SelectedTab&&("Notes"==this.ScreenObject.CustomTab.SelectedTab.Name?(this.AttachmentVisibility=!1,this.ContactVisibility=!1,this.AddressVisibility=!1,this.CCMapVisibility=!1,this.PrimaryVisibility=!1,this.ViewNotes.OnShowNewNotes(null)):"Attachments"==this.ScreenObject.CustomTab.SelectedTab.Name?(this.ViewAttachments.OnShowNewAttachment(null),this.NoteVisibility=!1,this.ContactVisibility=!1,this.AddressVisibility=!1,this.CCMapVisibility=!1,this.PrimaryVisibility=!1):"Contacts"==this.ScreenObject.CustomTab.SelectedTab.Name?(this.NoteVisibility=!1,this.AttachmentVisibility=!1,this.AddressVisibility=!1,this.CCMapVisibility=!1,this.PrimaryVisibility=!1,this.ViewContacts.OnShowNewContact(null)):"Address"==this.ScreenObject.CustomTab.SelectedTab.Name?(this.NoteVisibility=!1,this.AttachmentVisibility=!1,this.ContactVisibility=!1,this.CCMapVisibility=!1,this.PrimaryVisibility=!1,this.ViewAddress.OnShowNewAddress(null)):"Assign"==this.ScreenObject.CustomTab.SelectedTab.Name?(this.NoteVisibility=!1,this.AttachmentVisibility=!1,this.ContactVisibility=!1,this.AddressVisibility=!1,this.ViewCCMapping.OnShowCC(null),this.PrimaryVisibility=!1):(this.NoteVisibility=!1,this.AttachmentVisibility=!1,this.ContactVisibility=!1,this.AddressVisibility=!1,this.CCMapVisibility=!1,this.PrimaryVisibility="General"==this.ScreenObject.CustomTab.SelectedTab.Name&&null!=this.PContact))}HideControls(){this.ContactVisibility=!1,this.NoteVisibility=!1,this.AttachmentVisibility=!1,this.DetailsVisibility=!1}OnAddContact(){Logger.InfoLog("AddCostCenterViewModel::Entering AddContact"),this.Contact=new b.a,Logger.InfoLog("AddCostCenterViewModel::Entering AddContact")}OnAddAddress(){Logger.InfoLog("AddCostCenterViewModel::Entering AddAddress"),this.Address=new S.a,Logger.InfoLog("AddCostCenterViewModel::Entering AddAddress")}OnShowNote(){Logger.InfoLog("AddCostCenterViewModel::Entering OnShowNote"),Logger.InfoLog("AddCostCenterViewModel::Exiting OnShowNote")}OnAddNote(){Logger.InfoLog("AddCostCenterViewModel::Entering AddNote"),this.Note=new m.AddNoteViewModel,this.Note.AddNoteViewModel_2(this),Logger.InfoLog("AddCostCenterViewModel::Entering AddNote")}UpdateProgress(t){if("475"==this.Status.SelectedValue){let e;this.ScreenObject.CustomTab.Pages.forEach(e=>{let s=e.Fields.find(t=>t instanceof d.d&&"ccalpha19"==t.DBColumnName.toLowerCase());null!=s&&(s.Text=t.Progress.Text)}),e=n.e.StringIsNullOrEmpty(t.Note.Text)?'<XML progress="'+t.Progress.Text+'"  NoteID=" '+t.NoteID.toString()+'"  Note=""></XML>':'<XML progress="'+t.Progress.Text+'" NoteID=" '+t.NoteID.toString()+'"  Note="'+t.Note.Text+'" ></XML>';let s=0,i=this.ScreenObject.SettaskStatus(this.CostCenterID,this.NodeID,"Progress",e,Date.Today,0,0,0);return this.DisplayMessage=i.obj.MessageText,s=i.obj.RetValue,s>1&&(t.NoteID=s,!0)}return this.DisplayMessage="Progress can be updated while activity in process.",this.MessageVisibility=!0,!1}OnShowAttachment(){Logger.InfoLog("AddEditAccountScreenViewModel::Entering OnShowAttachment"),Logger.InfoLog("AddEditAccountScreenViewModel::Exiting OnShowAttachment")}OnDropPhoto(t){}onCanDropPhoto(t){return!0}OnAddAttachment(){Logger.InfoLog("AddEditAccountScreenViewModel::Entering AddAttachment"),this.Attachment=new D.AddAttachmentViewModel,this.Attachment.AddAttachmentViewModel_2(this),Logger.InfoLog("AddEditAccountScreenViewModel::Entering AddAttachment")}OnSaveCostCenter(t){if(Logger.InfoLog("OnSaveCostCenter::Entering OnSaveCostCenter"),"Contact"==t.toString())this.ContactExpanded=!this.ContactExpanded;else if("Note"==t.toString())this.NoteExpanded=!this.NoteExpanded;else if("Attachment"==t.toString())this.AttachmentExpanded=!this.AttachmentExpanded;else if("NewContact"==t.toString())this.ContactVisibility=!0;else if("NewAttachment"==t.toString())this.AttachmentVisibility=!0;else if("NewNote"==t.toString())this.NoteVisibility=!0;else if("Start"==t.toString()||"Stop"==t.toString()||"Hold"==t.toString()||"ReOpen"==t.toString()){if("Stop"==t.toString()&&1==this.objCostCenter.DebitDays){let t=this.ViewAttachments.AttachmentsList.find(t=>t.AttachmentID>0);if(n.e.IsEmpty(t))return this.DisplayMessage="Mandatory attachments before completion.",void(this.MessageVisibility=!0)}let e=new Date;if("Hold"!=t.toString()){let s=new G.a;s.GoToLineViewModel_1(this,1),i.a.page.ShowDialog(s,x.a,{ShowCenter:!0,NoWidth:!0},()=>{if(!s.DailogResult)return;n.e.IsEmpty(s.FromDate.Date)||(e=s.FromDate.Date);let i,o=0,r=0,l=0,h=0;if("Stop"==t.toString()&&null!=this.ds&&this.ds.Tables.length>0&&this.ds.Tables[0].length>0&&null!=this.ds.Tables[0][0].ccAlpha22&&null!=this.ds.Tables[0][0].ccAlpha22&&""!=this.ds.Tables[0][0].ccAlpha22.toString().Trim()){let t=new Date(this.ds.Tables[0][0].ccAlpha22);this.InitProjWOffsHolidays(t);let s=!1;null!=this.dsProjWOffHol&&this.dsProjWOffHol.Tables[2].length>0&&(s=Object(a.j)(this.dsProjWOffHol.Tables[2][0].PrefValue));let i=null;null!=this.dsProjWOffHol.Tables[3]&&this.dsProjWOffHol.Tables[3].length>0&&(i=this.dsProjWOffHol.Tables[3][0]),o=r=l=h=0;let c={odWHrs:o,odHrsPerDay:r};h=n.e.GetNoOfDays(this.dsProjWOffHol,t,e,s,i,t,c,!0),o=c.odWHrs,r=c.odHrsPerDay,l=parseFloat((o/r).ToString("00.00"))}this.DisplayMessage=this.ScreenObject.SettaskStatus(this.CostCenterID,this.NodeID,t.toString(),"",e,h,o,l),i={}.rid,this.MessageVisibility=!0,i>0&&("Start"==t.toString()?this.Status.SelectedValue="475":"Stop"==t.toString()?this.Status.SelectedValue="473":"Hold"==t.toString()?this.Status.SelectedValue="474":"ReOpen"==t.toString()&&(this.Status.SelectedValue="472"),this.SetProjectActions())})}}else if("ShowApprove"==t.toString()){let t=new L.a(this.CostCenterID,this.objCostCenter.NodeID,this.ScreenObject,this);i.a.page.ShowDialog(t,w.a,{ShowCenter:!0,Title:i.a.GetResource("ApproveReject")})}else if("DeletePhoto"==t.toString())1==this.DialogResult&&(this.IsPhotoDelete=!0,this.AccountPhoto="",this.ThumbnailPhoto="",this.DialogResult=!1,this.ActualFileName="",this.IsPhotoChanged=!1,this.PhotoTextVisibility=!0,this.DisplayMessage="");else if("PopUp"==t.toString())null!=this.ds&&this.ds.Tables[3].filter(t=>"jpg"==t.FileExtension||"png"==t.FileExtension).forEach(t=>{});else if("UploadPhoto"==t.toString()){let t=new f.a;t.PopupAttachmentsViewModel_1(this.CostCenterID,this.NodeID,this),i.a.page.ShowDialog(t,P.a,{ShowCenter:!0,Title:"Add Images"})}else if("CapturePhoto"==t.toString())null==this.Attachment&&this.OnAddAttachment();else if("MouseDown"==t.toString());else{if(this.objCostCenter.CustomFieldsQuery="",this.IsAttachmentMandatory&&null!=this.ViewAttachments){let t=0;if(this.ViewAttachments.AttachmentsList.length>0&&this.ViewAttachments.AttachmentsList.forEach(e=>{e.IsProductImage||t++}),0==t)return this.DisplayMessage="Attachment is mandatory",void(this.MessageVisibility=!0)}if(0==this.NodeID){this.ScreenObject.IsName=!1;let t=[];if(t=this.ScreenObject.Data.Tables[7],t=t.filter(t=>0==t.IsName),this.ScreenObject.SetAutoCodeParams_3(this.Code,this.GroupID,t,{StrCode:this.objCostCenter.Code,CodePrefix:this.objCostCenter.CodePrefix,CodeNumber:this.objCostCenter.CodeNumber}),this.DisplayMessage.length>0)return}else if(this.NodeID>0&&!this.Code.Enable&&!this.ScreenObject.CodeSeqExist){this.ScreenObject.IsName=!1;let t=[];if(t=this.ScreenObject.Data.Tables[7],t=t.filter(t=>0==t.IsName),this.ScreenObject.SetAutoCodeParams_3(this.Code,this.GroupID,t,{StrCode:this.objCostCenter.Code,CodePrefix:this.objCostCenter.CodePrefix,CodeNumber:this.objCostCenter.CodeNumber}),this.DisplayMessage.length>0)return}else this.objCostCenter.Code=this.Code.Text,this.Code.Code=this.Code.Text;if(this.ScreenObject.IsAutoName&&!this.Name.Enable){this.ScreenObject.IsNameAutoGenerate=!0,this.Name.Enable=!1;let t=this.ScreenObject.Data.Tables[7];t=t.filter(t=>1==t.IsName),this.ScreenObject.IsName=!0,t.length>0&&(this.Name.Text=this.ScreenObject.SetAutoCodeParams_1(this.Name,this.GroupID,t),this.objCostCenter.Name=this.Name.Text)}let s,o=this.ScreenObject.ValidateData();if(o.length>0)return this.MessageVisibility=!0,void(this.DisplayMessage=o);if(0==this.NodeID){if(50002==this.CostCenterID&&i.a.SessionManager.LicenseSettings.ContainsKey("MaxLocations")){let t;t=n.e.IntTryParse(i.a.SessionManager.LicenseSettings.MaxLocations);let e=i.a.common.GetDataTable("ACCVM001","");if(t>0&&t<=n.e.IntTryParse(e.Rows[0][0]))return this.DisplayMessage="Maximum "+t.toString()+" Locations Allowed",void(this.MessageVisibility=!0)}let t=this.ScreenObject.Data.Tables[7];t=t.filter(t=>0==t.IsName);let e={StrCode:this.objCostCenter.Code,CodePrefix:this.objCostCenter.CodePrefix,CodeNumber:this.objCostCenter.CodeNumber};if(this.DisplayMessage=this.ScreenObject.SetAutoCodeParams_3(this.Code,this.GroupID,t,e),this.objCostCenter.Code=e.StrCode,this.objCostCenter.CodePrefix=n.e.String(e.CodePrefix),this.objCostCenter.CodeNumber=e.CodeNumber,this.DisplayMessage.length>0)return void(this.MessageVisibility=!0)}else this.objCostCenter.Code=this.Code.Text;if(this.Name.Visible&&(this.objCostCenter.Name=this.Name.Text),this.AliasName.Enable&&(this.objCostCenter.AliasName=n.e.StringIsNullOrEmpty(this.AliasName.Text)?this.Name.Text:this.AliasName.Text),(i.a.SessionManager.Preferences.ContainsKey("ProjectManagementDimension")&&i.a.SessionManager.Preferences.ProjectManagementDimension==this.CostCenterID.toString()&&!n.e.IsEmpty(this.Status.SelectedValue)||this.Status.Enable)&&(this.objCostCenter.Status=n.e.IntTryParse(this.Status.SelectedValue)),this.SalesAccount.Enable&&(this.objCostCenter.SalesAccount=this.SalesAccount.SelectedValue),this.PurchaseAccount.Enable&&(this.objCostCenter.PurchaseAccount=this.PurchaseAccount.SelectedValue),this.CreditDays.Enable&&null!=this.CreditDays.Text&&""!=this.CreditDays.Text&&(this.objCostCenter.CreditDays=n.e.DoubleTryParse(this.CreditDays.Text)),this.CreditLimit.Enable&&null!=this.CreditLimit.Text&&""!=this.CreditLimit.Text&&(this.objCostCenter.CreditLimit=n.e.DoubleTryParse(this.CreditLimit.Text)),this.DebitDays.Enable&&null!=this.DebitDays.Text&&""!=this.DebitDays.Text&&(this.objCostCenter.DebitDays=n.e.DoubleTryParse(this.DebitDays.Text)),this.DebitLimit.Enable&&null!=this.DebitLimit.Text&&""!=this.DebitLimit.Text&&(this.objCostCenter.DebitLimit=n.e.DoubleTryParse(this.DebitLimit.Text)),this.Name.Visible||(this.objCostCenter.Name=this.Code.Text),this.AliasName.Visible||(this.objCostCenter.AliasName=n.e.StringIsNullOrEmpty(this.AliasName.Text)?this.Name.Text:this.AliasName.Text),0==this.objCostCenter.NodeID&&(this.Status.Visible||(this.objCostCenter.Status=n.e.IntTryParse(this.Status.DefaultValue))),this.SalesAccount.Visible||n.e.StringIsNullOrEmpty(this.SalesAccount.DefaultValue)||(this.objCostCenter.SalesAccount=n.e.IntTryParse(this.SalesAccount.DefaultValue)),this.PurchaseAccount.Visible||n.e.StringIsNullOrEmpty(this.PurchaseAccount.DefaultValue)||(this.objCostCenter.PurchaseAccount=n.e.IntTryParse(this.PurchaseAccount.DefaultValue)),this.DebitDays.Visible||i.a.SessionManager.Preferences.ContainsKey("ProjectManagementDimension")&&this.PactScreenID==i.a.SessionManager.Preferences.ProjectManagementDimension||(this.objCostCenter.DebitDays=0),this.CreditDays.Visible||(this.objCostCenter.CreditDays=0),this.DebitLimit.Visible||(this.objCostCenter.DebitLimit=0),this.CreditLimit.Visible||(this.objCostCenter.CreditLimit=0),this.Group.Enable&&(this.objCostCenter.SelectedGroup=this.Group.SelectedValue),this.objCostCenter.SelectedNode=this.Group.SelectedValue,this.CurrencyID.SelectedValue>0&&(this.objCostCenter.CustomFieldsQuery="CurrencyID='"+this.CurrencyID.SelectedValue+"',"),this.objCostCenter.CustomFieldsQuery=this.objCostCenter.CustomFieldsQuery+this.ScreenObject.GetCustomFieldsQuery(),this.objCostCenter.CustomCostCenterFieldsQuery=this.ScreenObject.GetCustomCostCenterFieldsQuery(),this.objCostCenter.ContactsXML=this.ViewContacts.GetXML(),this.objCostCenter.AddressXML=this.ViewAddress.GetXML(),this.objCostCenter.NotesXML=this.ViewNotes.GetXML(),null!=this.ViewProgress){let t=this.ViewProgress.GetXML();""!=t&&(this.objCostCenter.NotesXML=""!=this.objCostCenter.NotesXML?this.objCostCenter.NotesXML.replace("</NotesXML>","")+t.replace("<NotesXML>",""):t)}if(this.objCostCenter.AttachmetsXML=this.ViewAttachments.GetXML(),this.objCostCenter.HistoryXML=this.ScreenObject.HistoryCCXML,this.objCostCenter.StatusXML=null!=this.ScreenObject.StatusAssignGrid?this.ScreenObject.StatusAssignGrid.GetXML():"",null==this.JobsOutput)this.objCostCenter.JobsProductXML="";else if(this.objCostCenter.JobsProductXML=this.JobsOutput.GetXML(),!this.objCostCenter.JobsProductXML.Contains("<XML>"))return""==this.objCostCenter.JobsProductXML?(this.DisplayMessage="Select at least one BOM",void(this.MessageVisibility=!0)):(this.DisplayMessage="Select Product at Row "+this.objCostCenter.JobsProductXML,void(this.MessageVisibility=!0));0==this.NodeID&&null!=this.MappingVM&&(this.objCostCenter.MappingXML=this.MappingVM.GetXML());try{let t="";this.IsPhotoChanged&&!n.e.StringIsNullOrEmpty(this.AccountPhoto)?(t+=0==this.FileID?'<Row Action="NEW"':'<Row Action="MODIFY"',i.a.SessionManager.IsWebApplication&&(t+=' AttachmentID="'+this.FileID+'"',t+=' FilePath="'+this.AccountPhoto+'"',t+=' ActualFileName="'+this.AccountPhoto.substr(this.AccountPhoto.lastIndexOf("\\")+1)+'"',t+=' RelativeFileName="'+this.AccountPhoto+'"',t+=' FileExtension="'+this.FileExtension+'"',t+=' FileDescription="'+d.d.GetValidXml(this.FileDescription)+'"',t+=' IsProductImage="1"',t+=' IsDefaultImage="1"',t+=' GUID="'+this.guid+'"',t+="/>")):this.IsPhotoDelete&&this.FileID>0&&(t+='<Row Action="DELETE"',t+=' AttachmentID="'+this.FileID+'"/>'),t.length>0&&(t="<AttachmentsXML>"+t,t+="</AttachmentsXML>",this.objCostCenter.AttachmetsXML=this.objCostCenter.AttachmetsXML+t.toString())}catch(e){return this.DisplayMessage=i.a.GetResource("Upload_Path_notExists"),void(this.MessageVisibility=!0)}if(null!=this.PContact&&this.PContact.CheckPrimaryDuplicateContact())return this.DisplayMessage="Duplicate Contact[s] in Contacts DB",void(this.MessageVisibility=!0);this.objCostCenter.PrimaryContactQuery=null!=this.PContact?this.PContact.GetXML():"";let r=[];if(this.DisplayMessage=this.ViewCCMapping.GetXML(r),s=r.strXML,!n.e.StringIsNullOrEmpty(this.DisplayMessage))return;if(this.objCostCenter.CCXML=s,!this.ScreenObject.ValidateDataonSave())return;this.objCostCenter.WID=this.ScreenObject.CheckWorkFlow(),this.objCostCenter.DocXML=this.GetDocumentActivityXML(),this.objCostCenter.CalendarXML="",this.IsMRP2MachineDim&&(this.objCostCenter.CalendarXML=this.GetCalendarXML()),"SaveMultiple"==t.toString()||i.a.common.SaveCostCenter(this.objCostCenter,"SaveCostCenter").subscribe(t=>{if(this.DisplayMessage=t.Message,this.RetValue=t.RetValue,this.MessageVisibility=!0,this.RetValue>0||this.RetValue<-1e4){i.a.page.tabs.forEach(t=>{t.instance instanceof E.TreeViewPageComponent&&t.instance.obj&&t.instance.CostCenterID>5e4&&(t.instance.obj.SetFocusNodeID=t.instance.obj.SelectedNode.Id,t.instance.Refresh())}),this.NodeID=0,this.ScreenObject.Clear(),this.ViewContacts.ContactsListObj.Clear(),this.ViewNotes.NotesListObj.Clear(),this.ViewAttachments.AttachmentsListObj.Clear(),this.ViewAddress.ContactsListObj.Clear(),this.IsPhotoDelete=!1,this.ViewAttachments.OnShowNewAttachment(null),this.ViewContacts.DeletedContacts.Clear(),this.ViewNotes.DeletedNotes.Clear(),this.ViewAttachments.DeletedAttachments.Clear(),this.ViewAddress.DeletedAddress.Clear(),null!=this.JobsOutput&&this.JobsOutput.JobsGrid.Table.Clear(),null!=this.MappingVM&&this.MappingVM.MappingGrid.Table.Clear(),this.PhotoTextVisibility=!0,this.Code.Text="",this.Code.Code="",this.AccountPhoto="",this.ActualFileName="",this.ThumbnailPhoto="",this.AutoGenerateCode(),this.ViewCCMapping.Clear(),null!=this.ViewCCMapping.TempData&&this.ViewCCMapping.TempData.Clear(),this.CCMapVisibility=!1,this.HideControls(),this.Group.SelectedValue=this.GroupID,this.Group.SelectedValue=0!=this.GroupID?this.GroupID:2,null!=this.PContact&&this.PContact.ClearFields(),this.RefreshTitle();let t=this.ScreenObject.Data.Tables[5].filter(t=>"ShowCurrentSavedData"==t.Name);t.length>0&&""!=t[0].Value.toString()&&Object(a.j)(t[0].Value)&&(this.NodeID=this.RetValue,this.RefreshTitle(),this.FillControls())}null!=this.Parent&&this.Parent.Refresh(),Logger.InfoLog("AddCostCenterViewModel::Exiting OnSaveCostCenter")},t=>{alert(JSON.stringify(t)),console.log("Quick Account Save : "+JSON.stringify(t))})}}GetCalendarXML(){let t="";if(null!=this.dgvCalendar&&this.dgvCalendar.Table.length>0){let e;for(let s=0;s<this.dgvCalendar.Table.length;s++)e=this.dgvCalendar.Table[s],null!=e.FromDate_Key&&null!=e.FromDate_Key&&""!=e.FromDate_Key.toString()&&null!=e.ToDate_Key&&null!=e.ToDate_Key&&""!=e.ToDate_Key.toString()&&null!=e.Calendar&&null!=e.Calendar&&""!=e.Calendar.toString()&&(t+="<Row ",t+='SNo="'+e.SNo.toString()+'" ',t+='FromDate="'+new Date(e.FromDate_Key).ToString("dd MMM yyyy")+'" ',t+='ToDate="'+new Date(e.ToDate_Key).ToString("dd MMM yyyy")+'" ',t+='CalendarID="'+e.Calendar.toString()+'" ',t+=" />")}return t.length>0&&(t.Insert(0,"<Rows>"),t+="</Rows>"),t.toString()}InitProjWOffsHolidays(t){this.dsProjWOffHol=[],this.dsProjWOffHol=i.a.common.GetDataSet3("DOC067",t.Date.ToString("dd MMM yyyy"),this.CostCenterID.toString(),this.NodeID.toString())}GetDocumentActivityXML(){let t="";if(50073==this.CostCenterID){if(i.a.SessionManager.Preferences.ContainsKey("GeneralTimingsBasedOn")&&""!=i.a.SessionManager.Preferences.GeneralTimingsBasedOn&&!i.a.SessionManager.Preferences.GeneralTimingsBasedOn.split(",").Contains(this.CostCenterID.toString()))return"";let s,a=-100;null!=i.a.SessionManager.Preferences.PayrollProduct&&""!=i.a.SessionManager.Preferences.PayrollProduct&&(a=parseInt(i.a.SessionManager.Preferences.PayrollProduct)),t+="<XML>";let o="",r="",l="",h="",c="",C="",u="";var e=this.ScreenObject.GetPactControlField("Name");if(null!=e&&e instanceof d.d&&(o=e.Text),null!=(e=this.ScreenObject.GetPactControlField("ccAlpha2"))&&e instanceof N.b&&(r="01/Jan/1900 "+e.Date.ToString("HH:mm")),null!=(e=this.ScreenObject.GetPactControlField("ccAlpha3"))&&e instanceof N.b&&(l="01/Jan/1900 "+e.Date.ToString("HH:mm")),h=c=C=u="",this.NodeID>0){let t=i.a.common.GetDataTable("ACCVM002",this.NodeID.toString());null!=t&&t.length>0&&(h=t[0].DocID.toString(),c=t[0].InvDocDetailsID.toString())}null!=i.a.SessionManager.dtDocDefAccs&&(s=i.a.SessionManager.dtDocDefAccs.filter(t=>40052==t.CostCenterID&&"CreditAccount"==t.SysColumnName),null!=s&&s.length>0&&!n.e.IsEmpty(s[0].UserDefaultValue)&&""!=s[0].UserDefaultValue.toString().Trim()&&(C=s[0].UserDefaultValue.toString()),s=i.a.SessionManager.dtDocDefAccs.filter(t=>40052==t.CostCenterID&&"DebitAccount"==t.SysColumnName),null!=s&&s.length>0&&!n.e.IsEmpty(s[0].UserDefaultValue)&&""!=s[0].UserDefaultValue.toString().Trim()&&(u=s[0].UserDefaultValue.toString())),t+='<GeneralTimingsXML DocID="'+h+'" DocDetIDs="'+c+'" WorkFlowID="0" >',t+="<DOCXML>",t+="<RowHead/>",t+="<Row>",t+="<AccountsXML></AccountsXML>",t+='<Transactions DocSeqNo="1"  DocDetailsID="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="TIMINGS DUPMED FROM PAYROLL SHIFTS MASTER" CommonNarration="'+o,t+='" ProductID="'+a+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1',t+='" Rate="0" Gross="0" RefNO="0" IsQtyIgnored="1" AverageRate="0',t+='" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+u+'"  CreditAccount="'+C+'"  ></Transactions>',t+='<Numeric Query="" ></Numeric>',t+="<Alpha Query=\"dcAlpha1=N'"+r+"',dcAlpha2=N'"+l+"',dcAlpha3=N'"+i.a.SessionManager.AccountingDate.ToString("dd/MMM/yyyy")+"', \" ></Alpha>",t+='<CostCenters Query="dcCCNID73=DIM73NodeID, " ></CostCenters>',t+="<EXTRAXML></EXTRAXML>",t+="</Row>",t+="</DOCXML>",t+="<BillXML></BillXML></GeneralTimingsXML>";let b="",m="",S="",g="",D="",p="",I="",A="",T="",V="",M="";if(null!=(e=this.ScreenObject.GetPactControlField("Name"))&&e instanceof d.d&&(o=e.Text),null!=(e=this.ScreenObject.GetPactControlField("ccAlpha20"))&&e instanceof N.b&&(b=e.Date.ToString("HH:mm").toString().replace(":",".")),null!=(e=this.ScreenObject.GetPactControlField("ccAlpha21"))&&e instanceof N.b&&(m=e.Date.ToString("HH:mm").toString().replace(":",".")),null!=(e=this.ScreenObject.GetPactControlField("ccAlpha8"))&&e instanceof N.b&&(S=e.Date.ToString("HH:mm").toString().replace(":",".")),null!=(e=this.ScreenObject.GetPactControlField("ccAlpha9"))&&e instanceof N.b&&(g=e.Date.ToString("HH:mm").toString().replace(":",".")),D="24",p=i.a.SessionManager.AccountingDate.ToString("dd/MMM/yyyy"),null!=(e=this.ScreenObject.GetPactControlField("ccAlpha11"))&&e instanceof N.b&&(I=e.Date.ToString("HH:mm").toString().replace(":",".")),null!=(e=this.ScreenObject.GetPactControlField("ccAlpha13"))&&e instanceof N.b&&(A=e.Date.ToString("HH:mm").toString().replace(":",".")),null!=(e=this.ScreenObject.GetPactControlField("ccAlpha15"))&&e instanceof N.b&&(T=e.Date.ToString("HH:mm").toString().replace(":",".")),null!=(e=this.ScreenObject.GetPactControlField("ccAlpha17"))&&e instanceof N.b&&(V=e.Date.ToString("HH:mm").toString().replace(":",".")),null!=(e=this.ScreenObject.GetPactControlField("ccAlpha19"))&&e instanceof N.b&&(M=e.Date.ToString("HH:mm").toString().replace(":",".")),h=c=C=u="",this.NodeID>0){let t=i.a.common.GetDataTable("ACCVM003",this.NodeID.toString());null!=t&&t.length>0&&(h=t[0].DocID.toString(),c=t[0].InvDocDetailsID.toString())}null!=i.a.SessionManager.dtDocDefAccs&&(s=i.a.SessionManager.dtDocDefAccs.filter(t=>40066==t.CostCenterID&&"CreditAccount"==t.SysColumnName),null!=s&&s.length>0&&!n.e.IsEmpty(s[0].UserDefaultValue)&&""!=s[0].UserDefaultValue.toString().Trim()&&(C=s[0].UserDefaultValue.toString()),s=i.a.SessionManager.dtDocDefAccs.filter(t=>40066==t.CostCenterID&&"DebitAccount"==t.SysColumnName),null!=s&&s.length>0&&!n.e.IsEmpty(s[0].UserDefaultValue)&&""!=s[0].UserDefaultValue.toString().Trim()&&(u=s[0].UserDefaultValue.toString())),t+='<HoursDefChartXML DocID="'+h+'" DocDetIDs="'+c+'" WorkFlowID="0" >',t+="<DOCXML>",t+="<RowHead/>",t+="<Row>",t+="<AccountsXML></AccountsXML>",t+='<Transactions DocSeqNo="1"  DocDetailsID="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="HOURS DUPMED FROM PAYROLL SHIFTS MASTER" CommonNarration="'+o,t+='" ProductID="'+a+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1',t+='" Rate="0" Gross="0" RefNO="0" IsQtyIgnored="1" AverageRate="0',t+='" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+u+'"  CreditAccount="'+C+'"  ></Transactions>',t+='<Numeric Query="" ></Numeric>',t+="<Alpha Query=\"dcAlpha1=N'"+b+"',dcAlpha2=N'"+m+"',dcAlpha3=N'"+S+"',dcAlpha4=N'"+g+"',dcAlpha5=N'"+D+"',dcAlpha6=N'"+p+"',dcAlpha8=N'"+I+"',dcAlpha9=N'"+A+"',dcAlpha10=N'"+T+"',dcAlpha11=N'"+V+"',dcAlpha12=N'"+M+"', ",t+='" ></Alpha>',t+='<CostCenters Query="dcCCNID73=DIM73NodeID, " ></CostCenters>',t+="<EXTRAXML></EXTRAXML>",t+="</Row>",t+="</DOCXML>",t+="<BillXML></BillXML></HoursDefChartXML>",t+="</XML>"}return t.toString()}OnCanCostCenter(t){return Logger.InfoLog("OnCanCostCenter::Entering OnCanCostCenter"),Logger.InfoLog("OnCanCostCenter::Leaving OnCanCostCenter"),!0}OnCustomize(t){}AssignRowColumns(){let t;t=this.ScreenObject.CustomFields.length;for(let e=0;e<t;e++)this.ScreenObject.CustomFields[e].Row=e/4,this.ScreenObject.CustomFields[e].Column=e%4}OnLoad(){Logger.InfoLog("OnLoad::Entering OnLoad"),this.GetColumnDefDataset(this.CostCenterID);let t=[];if(null!=this.ht.Name&&""!=this.ht.Name.toString()&&(this.Name.DBColumnID=parseInt(this.ht.Name.toString())),null!=this.ht.Code&&""!=this.ht.Code.toString()&&(this.Code.DBColumnID=parseInt(this.ht.Code.toString())),null!=this.ht.AliasName&&""!=this.ht.AliasName.toString()&&(this.AliasName.DBColumnID=parseInt(this.ht.AliasName.toString())),null!=this.ht.StatusID&&""!=this.ht.StatusID.toString()&&(this.Status.DBColumnID=parseInt(this.ht.StatusID.toString())),null!=this.ht.CreditLimit&&""!=this.ht.CreditLimit.toString()&&(this.CreditLimit.DBColumnID=parseInt(this.ht.CreditLimit.toString())),null!=this.ht.CreditDays&&""!=this.ht.CreditDays.toString()&&(this.CreditDays.DBColumnID=parseInt(this.ht.CreditDays.toString())),null!=this.ht.DebitLimit&&""!=this.ht.DebitLimit.toString()&&(this.DebitLimit.DBColumnID=parseInt(this.ht.DebitLimit.toString())),null!=this.ht.DebitDays&&""!=this.ht.DebitDays.toString()&&(this.DebitDays.DBColumnID=parseInt(this.ht.DebitDays.toString())),null!=this.ht.PurchaseAccount&&""!=this.ht.PurchaseAccount.toString()&&(this.PurchaseAccount.DBColumnID=parseInt(this.ht.PurchaseAccount.toString())),null!=this.ht.SalesAccount&&""!=this.ht.SalesAccount.toString()&&(this.SalesAccount.DBColumnID=parseInt(this.ht.SalesAccount.toString())),null!=this.ht.IsGroup&&""!=this.ht.IsGroup.toString()&&(this.Group.DBColumnID=parseInt(this.ht.IsGroup.toString())),null!=this.ht.CurrencyID&&""!=this.ht.CurrencyID.toString()&&(this.CurrencyID.DBColumnID=parseInt(this.ht.CurrencyID.toString())),this.ScreenObject.LoadScreen_1(this,this.CostCenterID,this.objCostCenter.IsGroup),this.ScreenObject.CustomTab.OnTabChange.Subscribe(this,"onTabSelectionChanged"),this.LoadImageDimensions(),this.ScreenObject.CustomTab.Pages.forEach(t=>{"Contacts"==t.Name&&(this.PContact=new b.a,this.PContact.QuickAddContactViewModel_2(this),this.PContact.IsPrimaryContact=!0,this.PContact.Visiblebtns=!1,this.PContact.Countryvisible=!0,this.PrimaryVisibility=!0)}),null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>7&&this.ScreenObject.Data.Columns[7].Contains("IsParentCodeInherited")&&this.ScreenObject.Data.Tables[7].length>0&&(this.ScreenObject.InitAutoCode(this.ScreenObject.Data.Tables[7],this.objCostCenter.IsGroup),t=this.ScreenObject.Data.Tables[5].filter(t=>"CapsLock"==t.Name),t.length>0&&Object(a.j)(t[0].Value)&&(this.Name.IsAllCaps=!0),t=this.ScreenObject.Data.Tables[5].filter(t=>"CapsToFirstLetter"==t.Name),t.length>0&&Object(a.j)(t[0].Value)&&(this.Name.IsFirstLetterCaps=!0),t=this.ScreenObject.Data.Tables[5].filter(t=>"AttachmentMandatory"==t.Name),t.length>0&&""!=t[0].Value.toString()&&Object(a.j)(t[0].Value)&&(this.IsAttachmentMandatory=!0),t=this.ScreenObject.Data.Tables[5].filter(t=>"AttachementThumbnail"==t.Name),t.length>0&&Object(a.j)(t[0].Value)&&(this.ViewAttachments.GridView=!0)),this.AssignRowColumns(),this.ScreenObject.CustomTab.Pages.forEach(t=>{switch(t.Name){case"Notes":t.Fields.push(this.ViewNotes);break;case"Contacts":t.Fields.push(this.ViewContacts);break;case"Address":t.Fields.push(this.ViewAddress);break;case"Attachments":t.Fields.push(this.ViewAttachments);break;case"Assign":t.Fields.push(this.ViewCCMapping)}}),null!=this.ViewProgress){let t=new I.b;t.Name="Progress",t.Header="Progress",t.DBColumnID=-1e3,t.Fields.push(this.ViewProgress),this.ScreenObject.CustomTab.Pages.push(t)}if(this.ScreenObject.Data.Tables.length>9&&this.ScreenObject.Data.Columns[8].Contains("StatusID")&&this.ScreenObject.Data.Columns[9].Contains("Value")){let t=new I.b;t.Name="Output",t.Header="Output",t.DBColumnID=-1e3,this.JobsOutput=new j.a(this.CostCenterID,this.NodeID,this.ScreenObject.Data),this.JobsOutput.JobsGrid.ColumnSpan=4,t.Fields.push(this.JobsOutput.JobsGrid),t.TabType=2,this.ScreenObject.CustomTab.Pages.push(t),this.ScreenObject.CustomTab.Visible||(this.ScreenObject.CustomTab.Visible=!0,this.ScreenObject.CustomTab.SelectedTab=t)}if(Logger.InfoLog("AddCostCenterViewModel::BuildControls Success"),null!=this.ScreenData&&this.ScreenData.Tables.length>2&&(this.ScreenObject.Data.Tables[3].forEach(t=>{this.Status.Items.push(u.d.ComboBoxItems_2(n.e.StringValue(t[this.ScreenObject.Data.Columns[3][1]]),n.e.StringValue(t[this.ScreenObject.Data.Columns[3][0]])))}),n.e.StringIsNullOrEmpty(this.Status.DefaultValue)||(this.Status.SelectedValue=this.Status.DefaultValue)),50002==this.CostCenterID&&i.a.SessionManager.Preferences.ContainsKey("LWAccPeriod")&&"TRUE"==i.a.SessionManager.Preferences.LWAccPeriod.toUpperCase()){let t=this.ScreenObject.HeaderFields.find(t=>t instanceof u.e&&"ccAlpha41"==t.DBColumnName);if(null==t&&(t=this.ScreenObject.GetCustomField("ccAlpha41")),null!=t){let e=new Date((new Date).getFullYear(),0,1);for(let s=1;s<=12;s++)t.Items.push(u.d.ComboBoxItems_2(e.ToString("MMMM"),s.toString())),e=e.AddMonths(1);t.SelectedValue="1"}}if(this.IsMRP2MachineDim){let t=new I.b;t.Name="Calendar",t.Header="Calendar",t.DBColumnID=-2001,this.ScreenObject.CustomTab.Pages.push(t),this.dgvCalendar=new F.a,this.dgvCalendar.CanUserAddRows=!0,this.dgvCalendar.Columns=[],this.dgvCalendar.Height=200,this.dgvCalendar.Width="",this.dgvCalendar.DBColumnName="ProdCalendar",this.dgvCalendar.OnCellEditEnding.Subscribe(this,"dgvCal_EndEdit");let e=new v.a;e.Header=i.a.GetResource("SNo"),e.DisplayMember="Sno",e.ReadOnly=!0,e.Width=80,e.DataType="INT",this.dgvCalendar.Columns.push(e),e=new v.a,e.Header="From Date",e.DisplayMember="FromDate",e.Width=150,e.DataType="DATE",this.dgvCalendar.Columns.push(e),e=new v.a,e.Header="To Date",e.DisplayMember="ToDate",e.Width=150,e.DataType="DATE",this.dgvCalendar.Columns.push(e),e=new v.a,e.Header="Calendar",e.ValueBinding="Calendar",e.DataType="ComboBox",e.DisplayMember="Name",e.ValueMember="Value",e.Width=200;let s=[],n=i.a.common.GetDataTable("AECC002","");if(null!=n&&n.length>0)for(let i=0;i<n.length;i++)s.push(u.d.ComboBoxItems_2(n[i].Name.toString(),n[i].ProfileID.toString()));e.ComboData=s,this.dgvCalendar.Columns.push(e),this.dgvCalendar.Column=0,this.dgvCalendar.Row=0,this.dgvCalendar.ColumnSpan=4,this.dgvCalendar.RowSpan=5,this.dgvCalendar.Table=[],this.dgvCalendar.TableColumns.push("Sno"),this.dgvCalendar.TableColumns.push("FromDate"),this.dgvCalendar.TableColumns.push("FromDate_Key"),this.dgvCalendar.TableColumns.push("ToDate"),this.dgvCalendar.TableColumns.push("ToDate_Key"),this.dgvCalendar.TableColumns.push("Calendar"),this.dgvCalendar.TableColumns.push("Calendar_Key"),this.AddEmptyRows(this.dgvCalendar);let a=this.ScreenObject.CustomTab.Pages.find(t=>-2001==t.DBColumnID),o=this.ScreenObject.CustomTab.Pages.indexOf(a);this.ScreenObject.CustomTab.Pages[o].Fields.push(this.dgvCalendar)}if(this.FillControls(),i.a.SessionManager.Preferences.ContainsKey("Report Template Dimension")&&""!=i.a.SessionManager.Preferences["Report Template Dimension"]&&this.CostCenterID==parseInt(i.a.SessionManager.Preferences["Report Template Dimension"])&&"TRUE"==i.a.SessionManager.Preferences.WEFINReportTemplate.toUpperCase()){let t=this.ScreenObject.GetCustomField("ccAlpha44");if(null!=t){var e=t.Items.find(t=>"Show Closing"==t.Value);null!=e&&t.Items.Remove(e)}}else if(i.a.SessionManager.Preferences.ContainsKey("PackDimension")&&""!=i.a.SessionManager.Preferences.PackDimension&&this.CostCenterID==parseInt(i.a.SessionManager.Preferences.PackDimension)){if(t=this.ScreenObject.Data.Tables[0].filter(t=>"ccalpha46"==t.SysColumnName),t.length>0&&(this.DimLength=this.GetCustomField(parseInt(t[0].CostCenterColID)),null!=this.DimLength)){this.DimLength.TextChangedCommand.Subscribe(this,"onTextValueChanged");let t=0,e=this.ScreenObject.Data.Tables[5].filter(t=>"LengthDecimals"==t.Name);null!=e&&e.length>0&&(t=n.e.IntTryParse(e[0].Value.toString())),this.DimLength.DecimalPoints=t.toString(),this.DimLength.LostFocusCommand.Subscribe(this,"onLostFocus")}if(t=this.ScreenObject.Data.Tables[0].filter(t=>"ccalpha47"==t.SysColumnName),t.length>0&&(this.DimWidth=this.GetCustomField(parseInt(t[0].CostCenterColID)),null!=this.DimWidth)){this.DimWidth.TextChangedCommand.Subscribe(this,"onTextValueChanged");let t=0,e=this.ScreenObject.Data.Tables[5].filter(t=>"WidthDecimals"==t.Name);null!=e&&e.length>0&&(t=n.e.IntTryParse(e[0].Value.toString())),this.DimWidth.DecimalPoints=t.toString(),this.DimWidth.LostFocusCommand.Subscribe(this,"onLostFocus")}if(t=this.ScreenObject.Data.Tables[0].filter(t=>"ccalpha48"==t.SysColumnName),t.length>0&&(this.DimHeight=this.GetCustomField(parseInt(t[0].CostCenterColID)),null!=this.DimHeight)){this.DimHeight.TextChangedCommand.Subscribe(this,"onTextValueChanged");let t=0,e=this.ScreenObject.Data.Tables[5].filter(t=>"HeightDecimals"==t.Name);null!=e&&e.length>0&&(t=n.e.IntTryParse(e[0].Value.toString())),this.DimHeight.DecimalPoints=t.toString(),this.DimHeight.LostFocusCommand.Subscribe(this,"onLostFocus")}if(t=this.ScreenObject.Data.Tables[0].filter(t=>"ccalpha49"==t.SysColumnName),t.length>0&&(this.DimVolume=this.GetCustomField(parseInt(t[0].CostCenterColID)),null!=this.DimVolume)){let t=0,e=this.ScreenObject.Data.Tables[5].filter(t=>"VolumeDecimals"==t.Name);null!=e&&e.length>0&&(t=n.e.IntTryParse(e[0].Value.toString())),this.DimVolume.DecimalPoints=t.toString(),this.DimVolume.LostFocusCommand.Subscribe(this,"onLostFocus")}if(t=this.ScreenObject.Data.Tables[0].filter(t=>"ccalpha50"==t.SysColumnName),t.length>0&&(this.DimWeight=this.GetCustomField(parseInt(t[0].CostCenterColID)),null!=this.DimWeight)){let t=0,e=this.ScreenObject.Data.Tables[5].filter(t=>"WeightDecimals"==t.Name);null!=e&&e.length>0&&(t=n.e.IntTryParse(e[0].Value.toString())),this.DimWeight.DecimalPoints=t.toString(),this.DimWeight.LostFocusCommand.Subscribe(this,"onLostFocus")}}if(t=this.ScreenObject.Data.Tables[5].filter(t=>"BinsDimension"==t.Name),t.length>0&&t[0].Value.toString()==this.CostCenterID.toString()){if(t=this.ScreenObject.Data.Tables[0].filter(t=>"ccalpha47"==t.SysColumnName),t.length>0&&(this.DimLength=this.GetCustomField(parseInt(t[0].CostCenterColID)),null!=this.DimLength)){this.DimLength.TextChangedCommand.Subscribe(this,"onTextValueChanged");let t=0,e=this.ScreenObject.Data.Tables[5].filter(t=>"LengthDecimals"==t.Name);null!=e&&e.length>0&&(t=n.e.IntTryParse(e[0].Value.toString())),this.DimLength.DecimalPoints=t.toString(),this.DimLength.LostFocusCommand.Subscribe(this,"onLostFocus")}if(t=this.ScreenObject.Data.Tables[0].filter(t=>"ccalpha48"==t.SysColumnName),t.length>0&&(this.DimWidth=this.GetCustomField(parseInt(t[0].CostCenterColID)),null!=this.DimWidth)){this.DimWidth.TextChangedCommand.Subscribe(this,"onTextValueChanged");let t=0,e=this.ScreenObject.Data.Tables[5].filter(t=>"WidthDecimals"==t.Name);null!=e&&e.length>0&&(t=n.e.IntTryParse(e[0].Value.toString())),this.DimWidth.DecimalPoints=t.toString(),this.DimWidth.LostFocusCommand.Subscribe(this,"onLostFocus")}if(t=this.ScreenObject.Data.Tables[0].filter(t=>"ccalpha49"==t.SysColumnName),t.length>0&&(this.DimHeight=this.GetCustomField(parseInt(t[0].CostCenterColID)),null!=this.DimHeight)){this.DimHeight.TextChangedCommand.Subscribe(this,"onTextValueChanged");let t=0,e=this.ScreenObject.Data.Tables[5].filter(t=>"HeightDecimals"==t.Name);null!=e&&e.length>0&&(t=n.e.IntTryParse(e[0].Value.toString())),this.DimHeight.DecimalPoints=t.toString(),this.DimHeight.LostFocusCommand.Subscribe(this,"onLostFocus")}if(t=this.ScreenObject.Data.Tables[0].filter(t=>"ccalpha50"==t.SysColumnName),t.length>0&&(this.DimVolume=this.GetCustomField(parseInt(t[0].CostCenterColID)),null!=this.DimVolume)){let e=0,s=this.ScreenObject.Data.Tables[5].filter(t=>t.Name="VolumeDecimals");null!=s&&t.length>0&&(e=n.e.IntTryParse(s[0].Value.toString())),this.DimVolume.DecimalPoints=e.toString(),this.DimVolume.LostFocusCommand.Subscribe(this,"onLostFocus")}}if(""!=i.a.SessionManager.Preferences["CRM-Products"].toString()&&"0"!=i.a.SessionManager.Preferences["CRM-Products"].toString()&&parseInt(i.a.SessionManager.Preferences["CRM-Products"])==this.CostCenterID){let t=i.a.common.GetDataSet("ACCVM004","");if(null==t||0==t.Tables.length||0==t.Tables[0].length||"0"==t.Tables[0][0][0].toString())return;this.ProfileID=parseInt(t.Tables[0][0][0]);let e=new I.b;e.Name="Mapping",e.Header="Mapping",e.DBColumnID=-2e3,this.ScreenObject.CustomTab.Pages.push(e),this.ScreenObject.CustomTab.Pages.forEach(t=>{switch(t.Name){case"Mapping":t.Fields.push(this.MappingVM)}})}Logger.InfoLog("OnLoad::Leaving OnLoad")}AddEmptyRows(t){for(let e=0;e<=10;e++){let s=t.NewRow();s.SNo=(e+1).toString(),t.Table.push(s)}}dgvCal_EndEdit(t,e,s){}GetCustomField(t){return this.ScreenObject.CustomTab.Pages.forEach(e=>{var s=e.Fields.find(e=>e instanceof A.c&&e.DBColumnID==t);if(null!=s&&s instanceof d.d)return s}),null}onTextValueChanged(t){let e=0,s=0,i=0;null!=this.DimLength&&(e=n.e.DoubleTryParse(this.DimLength.Text)),null!=this.DimWidth&&(s=n.e.DoubleTryParse(this.DimWidth.Text)),null!=this.DimHeight&&(i=n.e.DoubleTryParse(this.DimHeight.Text)),null!=this.DimVolume&&(this.DimVolume.Text=(e*s*i).toString())}onLostFocus(t){let e=0;e=n.e.DoubleTryParse(t.Text),t.Text=e.ToString("N"+t.DecimalPoints),this.ScreenObject.onTextBoxLostFocus(t)}LoadImageDimensions(){let t=new p.b;t.Row=0;let e=90,s=this.ScreenObject.Data.Tables[5].filter(t=>"ImageDimensions"==t.Name);if(s.length>0&&""!=s[0].Value.toString()&&s[0].Value.toString().Trim(" ").startsWith("<")){let i=new n.f;i.LoadXml(s[0].Value.toString()),this.ImageVisibility=null==i.DocumentElement.attributes.ShowImage||"0"!=i.DocumentElement.attributes.ShowImage.value,t.RowSpan=null!=i.DocumentElement.attributes.RowSpan&&""!=i.DocumentElement.attributes.RowSpan.value?i.DocumentElement.attributes.RowSpan.value:"3",t.ColumnSpan=null!=i.DocumentElement.attributes.ColumnSpan&&""!=i.DocumentElement.attributes.ColumnSpan.value?i.DocumentElement.attributes.ColumnSpan.value:"1",t.Column=1==t.ColumnSpan?3:2==t.ColumnSpan?2:3==t.ColumnSpan?1:4==t.ColumnSpan?0:3,e=this.AccountPhoto.length>0?45*t.RowSpan:45*t.RowSpan-20,t.ImageHeight=e.toString()}else t.RowSpan=3,t.Column=3,t.ColumnSpan=1,t.ImageHeight=e.toString()}AutoGenerateCode(){if(0==this.NodeID)if(this.Group.SelectedValue>0&&(this.GroupID=this.Group.SelectedValue),null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>7){if(this.ScreenObject.SetAutoCode(this.Code,this.objCostCenter.IsGroup,this.GroupID,this.ScreenObject.Data.Tables[7]),this.ScreenObject.IsAutoName){this.ScreenObject.IsNameAutoGenerate=!0,this.Name.Enable=!1;let t=this.ScreenObject.Data.Tables[7];t=t.filter(t=>1==t.IsName),this.ScreenObject.IsName=!0,t.length>0&&(this.Name.Text=this.ScreenObject.SetAutoCodeParams_1(this.Name,this.GroupID,t))}}else this.ScreenObject.GetCodeParams(this.ScreenObject.Data.Tables[7])}FillControls(){if(Logger.InfoLog("AddEditAccountScreenViewModel::Entering FillData"),0!=this.NodeID){if(this.NextPrevID=this.NodeID,this.objCostCenter.NodeID=this.NodeID,this.ds=i.a.common.GetCostCenterDetails(0,this.CostCenterID,this.objCostCenter.NodeID,0),Object.assign(this.objCostCenter,this.ds.obj),this.AccountPhoto="",this.ActualFileName="",this.ThumbnailPhoto="",this.Code.Text=this.objCostCenter.Code,this.Code.Code=this.objCostCenter.Code,this.ScreenObject.IsAutoName&&(this.Name.Enable=!1),this.Name.Text=this.objCostCenter.Name,this.AliasName.Text=this.objCostCenter.AliasName,this.Status.SelectedValue=this.objCostCenter.Status.toString(),this.CreditDays.Text=this.objCostCenter.CreditDays.toString(),this.CreditLimit.Text=this.objCostCenter.CreditLimit.toString(),this.DebitDays.Text=this.objCostCenter.DebitDays.toString(),this.DebitLimit.Text=this.objCostCenter.DebitLimit.toString(),this.SalesAccount.SelectedValue=this.objCostCenter.SalesAccount,this.PurchaseAccount.SelectedValue=this.objCostCenter.PurchaseAccount,this.Group.SelectedValue=this.objCostCenter.ParentID,this.Group.Enable=!1,this.CurrencyID.SelectedValue=this.objCostCenter.CurrencyID>0?this.objCostCenter.CurrencyID:0,this.ScreenObject.LoadCustomFieldsData(this.ds.Tables[0],!1,this.ds.Tables[13]),this.ds.Tables.length>7?this.ScreenObject.LoadCustomFieldsCCData(this.ds.Tables[7],this.ds.Tables[13]):this.ScreenObject.LoadCustomFieldsCCData(this.ds.Tables[5]),null!=this.PContact&&this.PContact.LoadContacts(this.ds.Tables[4]),this.ViewCCMapping.LoadData(this.ds.Tables[5],this.ds.Columns[5]),this.ViewContacts.LoadContacts(this.ds.Tables[1],this.ds.Columns[1]),this.ViewAttachments.LoadAttachments(this.ds.Tables[3]),this.ViewNotes.LoadNotes(this.ds.Tables[2]),this.ViewAddress.LoadContacts(this.ds.Tables[6]),null!=this.ScreenObject.StatusAssignGrid&&this.ScreenObject.StatusAssignGrid.Load(this.ds.Tables[14]),this.ScreenObject.CanApprove(this.ds.Tables[0][0],this.ds.Tables[11][0],this.ButtonSave),1004==this.objCostCenter.Status&&null==this.Status.Items.find(t=>"1004"==t.Value)&&(this.Status.Items.push(u.d.ComboBoxItems_2("Suspended","1004")),this.Status.Enable=!1,this.Status.SelectedValue="",this.Status.SelectedValue=this.objCostCenter.Status.toString()),i.a.SessionManager.Preferences.ContainsKey("ProjectManagementDimension")&&this.PactScreenID==i.a.SessionManager.Preferences.ProjectManagementDimension&&(this.SetProjectActions(),this.Status.Enable=!1,this.ViewProgress.LoadNotes(this.ds.Tables[2])),null!=this.JobsOutput&&this.JobsOutput.LoadData(this.ds.Tables[12],this.ds.Columns[12]),this.IsMRP2MachineDim&&null!=this.dgvCalendar){this.dgvCalendar.Table.Clear();let t=i.a.common.GetDataTable("AECC003",this.NodeID.toString());if(null!=t&&t.length>0){let e;for(let s=0;s<t.length;s++)e=this.dgvCalendar.NewRow(),e.SNo=(s+1).toString(),e.FromDate=new Date(t[s].FromDate).ToString(i.a.SessionManager.Preferences["Date Format"]),e.FromDate_Key=new Date(t[s].FromDate),e.ToDate=new Date(t[s].ToDate).ToString(i.a.SessionManager.Preferences["Date Format"]),e.ToDate_Key=new Date(t[s].ToDate),e.Calendar=parseInt(t[s].CalendarProfileID),this.dgvCalendar.Table.push(e)}this.dgvCalendar.AddExtraEmptyRows(5)}let t=this.ds.Tables[3].filter(t=>"true"==t.IsProductImage&&"true"==t.IsDefaultImage);t.length>0?(this.PhotoTextVisibility=!1,this.FileID=parseInt(t[0].FileID),this.AccountPhoto=n.e.GetPath(t[0].GUID.toString()+"."+t[0].FileExtension.toString()),this.ActualFileName=t[0].ActualFileName.toString()):(this.FileID=0,this.PhotoTextVisibility=!0),i.a.SessionManager.IsOffline&&this.NodeID>0&&(this.ButtonSave.Visible=!1)}else this.objCostCenter.GUID="";this.AutoGenerateCode(),Logger.InfoLog("AddEditAccountScreenViewModel::Exiting FillData")}SetProjectActions(){"472"==this.Status.SelectedValue?(this.StartVisible=!0,this.StopVisible=!1,this.HoldVisible=!1,this.ReOpenVisible=!1):"473"==this.Status.SelectedValue?(this.StartVisible=!1,this.StopVisible=!1,this.HoldVisible=!1,i.a.SessionManager.IsActionAssigned(this.CostCenterID,"Re-Open")&&(this.ReOpenVisible=!0)):"474"==this.Status.SelectedValue?(this.StartVisible=!0,this.StopVisible=!1,this.HoldVisible=!1,this.ReOpenVisible=!1):"475"==this.Status.SelectedValue&&(this.StartVisible=!1,this.StopVisible=!0,this.HoldVisible=!0,this.ReOpenVisible=!1)}GetColumnDefDataset(t){try{let t=this.objCostCenter.GetColumnDefination(this.PactScreenID,i.a.SessionManager.CompanyIndex);if(null!=t&&t.Tables[0].length>0)for(let e=0;e<t.Tables[0].length;e++)this.ht.ContainsKey(t.Tables[0][e].SYSCOLUMNNAME.toString())||this.ht.Add(t.Tables[0][e].SYSCOLUMNNAME.toString(),t.Tables[0][e].COSTCENTERCOLID.toString())}catch(e){Logger.ErrorLog("AddCostCenterViewModel:: GetColumnDefination "+e.stack)}}BuildControls(){Logger.InfoLog("AddCostCenterViewModel::Entering BuildControls");try{return(new V.a).GetControls(this.PactScreenID,i.a.SessionManager.CompanyIndex)}catch(t){return Logger.ErrorLog("AddCostCenterViewModel:: BuildControls"+t.stack),null}}OnShowCC(){Logger.InfoLog("AddProductViewModel::Entering OnShowNote"),Logger.InfoLog("AddProductViewModel::Exiting OnShowNote")}onSave(){Logger.InfoLog("AddProductViewModel::Entering onSavecc"),Logger.InfoLog("AddProductViewModel::Entering onSavecc")}OnNameLostFocus(t){if(!n.e.StringIsNullOrEmpty(this.Name.Text)){let t=i.a.accounting.CheckDuplicateName(this.CostCenterID,this.NodeID,this.Name.Text,0,this.objCostCenter.IsGroup);t.length>0&&(this.DisplayMessage=t)}this.ScreenObject.onTextBoxLostFocus(t)}LoadParentData(){if(0!=this.NodeID||0==this.GroupID||this.objCostCenter.IsGroup)return;let t=this.ScreenObject.Data.Tables[5].filter(t=>"Copygroupdatatonode"==t.Name);if(0==t.length||""==t[0].Value.toString()||!Object(a.j)(t[0].Value))return;let e=i.a.common.GetCopyNodeDetails(this.objCostCenter.CostCenterID,this.GroupID);0!=e.Tables[0].length&&(this.Status.SelectedValue=e.Tables[0][0].StatusID.toString(),this.CreditDays.Text=e.Tables[0][0].CreditDays.toString(),this.CreditLimit.Text=e.Tables[0][0].CreditLimit.toString(),this.DebitDays.Text=null!=e.Tables[0][0].DebitDays&&""!=e.Tables[0][0].DebitDays.toString()?e.Tables[0][0].DebitDays.toString():"0",this.DebitLimit.Text=null!=e.Tables[0][0].DebitLimit&&""!=e.Tables[0][0].DebitLimit.toString()?e.Tables[0][0].DebitLimit.toString():"0",""!=e.Tables[0][0].SalesAccount.toString()&&(this.SalesAccount.SelectedValue=parseInt(e.Tables[0][0].SalesAccount.toString())),""!=e.Tables[0][0].PurchaseAccount.toString()&&(this.PurchaseAccount.SelectedValue=parseInt(e.Tables[0][0].PurchaseAccount.toString())),""!=n.e.StringValue(e.Tables[0][0].CurrencyID)&&(this.CurrencyID.SelectedValue=parseInt(e.Tables[0][0].CurrencyID.toString())),this.ScreenObject.LoadCustomFieldsData(e.Tables[0]),this.ScreenObject.LoadCustomFieldsCCData(e.Tables.length>7?e.Tables[7]:e.Tables[5]))}OnDeleteCallBack(){}RefreshTitle(){this.objCostCenter.IsGroup?(this.ScreenName=0==this.NodeID?this.TempscreenTitle.Contains("Add")?this.TempscreenTitle+" Group":"Add "+this.TempscreenTitle+" Group":this.TempscreenTitle.Contains("Edit")?this.TempscreenTitle+" Group":"Edit "+this.TempscreenTitle+" Group",i.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=i.a.SessionManager.IsActionAssigned(this.CostCenterID,"Create Group"):this.ButtonSave.Enable=i.a.SessionManager.IsActionAssigned(this.CostCenterID,"Create Group")):0==this.NodeID?(this.ScreenName=this.TempscreenTitle.Contains("Add")?this.TempscreenTitle:"Add "+this.TempscreenTitle,i.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=i.a.SessionManager.IsActionAssigned(this.CostCenterID,"Create"):this.ButtonSave.Enable=i.a.SessionManager.IsActionAssigned(this.CostCenterID,"Create")):(this.ScreenName=this.TempscreenTitle.Contains("Edit")?this.TempscreenTitle:"Edit "+this.TempscreenTitle,i.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=i.a.SessionManager.IsActionAssigned(this.CostCenterID,"Update"):this.ButtonSave.Enable=i.a.SessionManager.IsActionAssigned(this.CostCenterID,"Update")),this.DisplayName=this.ScreenName}}}}]);
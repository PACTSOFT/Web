(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{sBST:function(e,t,i){"use strict";i.r(t),i.d(t,"RibbonExtPrd",(function(){return f}));var s=i("Do2H"),a=i("V7Sd"),r=i("Lp6j"),n=i("eQJW"),o=i("VxiT"),l=i("ScVY"),u=i("NkMH"),h=i("0/4Q"),d=i("EQd/"),c=i("n56n"),p=i("JIg3"),I=i("8B8H");class b{constructor(){this.ColumnSpan="4",this.BomGrid=new I.a}}var m=i("ockk");class g{constructor(e,t){let i;this.ColumnSpan="4",this.SNO=1,this.Bparent=e,this.Mparent=t,this.ProductionMethodGridDataObj=new I.a,this.ProductionMethodGridDataObj.TableColumns.push("Sno"),this.ProductionMethodGridDataObj.TableColumns.push("BOMID"),this.ProductionMethodGridDataObj.TableColumns.push("BOMName"),this.ProductionMethodGridDataObj.TableColumns.push("Particulars"),this.ProductionMethodGridDataObj.Columns=[],i=new m.a,i.Header=s.a.GetResource("Sno"),i.DisplayMember="Sno",i.DataType="TEXTBOX",i.Width=50,i.IsVisible=!0,i.ReadOnly=!0,this.ProductionMethodGridDataObj.Columns.push(i),this.ProductionMethodGridDataObj.TableNewRow.Subscribe(this,"ProductionMethodGridData_TableNewRow"),null!=this.Mparent&&null==this.Bparent&&(i=new m.a,i.Header=s.a.GetResource("MO_BOMName"),i.DisplayMember="BOMName",i.DataType="TEXTBOX",i.Width=150,i.IsVisible=!0,i.ReadOnly=!0,this.ProductionMethodGridDataObj.Columns.push(i)),i=new m.a,i.Header=s.a.GetResource("Deposits_Particulars"),i.DisplayMember="Particulars",i.DataType="TEXTBOX",i.Width=500,i.IsVisible=!0,this.ProductionMethodGridDataObj.Columns.push(i);for(let s=0;s<10;s++)this.ProductionMethodGridDataObj.addEmptyRow()}get angularGrid(){return this.ProductionMethodGridDataObj.angularGrid}get ProductionMethodGridData(){return this.ProductionMethodGridDataObj.Table}get ProductionMethodColumnSource(){return this.ProductionMethodGridDataObj.Columns}ProductionMethodGridData_TableNewRow(e,t){this.UpdateSequence()}UpdateSequence(){this.SNO=1,this.ProductionMethodGridData.forEach(e=>{e.Sno=this.SNO++}),this.ProductionMethodGridDataObj.refreshDataView()}GETXML(){let e="";e+="<XML>";for(let t=0;t<this.ProductionMethodGridData.length;t++)r.e.IsEmpty(this.ProductionMethodGridData[t].Particulars)||(e+="<Row ",e+=' SequenceNo="'+t+'1"',null!=this.Mparent&&null==this.Bparent&&(e+=' BOMID="'+this.ProductionMethodGridData[t].BOMID.toString()+'"'),e+=' Particulars="'+this.ProductionMethodGridData[t].Particulars.toString()+'"',e+="/>");return e+="</XML>",e.toString()}Load(e){let t=0;if(null!=this.Mparent&&null==this.Bparent)for(let i=0;i<this.ProductionMethodGridData.length;i++)"0"!=r.e.String(this.ProductionMethodGridData[i].BOMID)?(this.ProductionMethodGridDataObj.removeRowAt(i),i--):t++;if(null!=e&&e.length>0){for(let i=0;i<e.length;i++)this.ProductionMethodGridDataObj.addEmptyRow(),null!=this.Mparent&&null==this.Bparent&&(this.ProductionMethodGridData[t].BOMName=e[i].BOMName.toString(),this.ProductionMethodGridData[t].BOMID=e[i].BOMID.toString()),this.ProductionMethodGridData[t].Particulars=e[i].Particulars.toString(),t++;this.SequenceNo(),this.ProductionMethodGridDataObj.refreshDatawithIDs()}}SequenceNo(){let e=1;if(this.ProductionMethodGridDataObj.TableColumns.Contains("Sno"))for(let t=0;t<this.ProductionMethodGridData.length;t++)this.ProductionMethodGridData[t].Sno=e.toString(),e++}}var S=i("vTM8"),D=i("uMy8");class T{constructor(){this.Code="",this.Name="",this.Desc="",this.BOMProductXML="",this.BOMExpenseXML="",this.BOMResourceXML="",this.GUID="",this.CustomFieldsQuery="",this.CustomCCQuery="",this.ProductionMethod="",this.ProductionXML="",this.StageXML="",this.Packing="",this.ProductID=0,this.LocationID=0,this.DivisionID=0,this.StatusID=0,this.UOMID=0,this.WID=0,this.BOMID=0,this.selectednodeid=0,this.group=!1,this.FPQty=1}GetAvgSales(e,t,i,a,r){Logger.InfoLog("BOM:: Inside GetBOMDetails");let n=[];n.push(e),n.push(t),n.push("1/"+a.ToString("MMM/yyyy")),n.push(r.DaysInMonth()+"/"+r.ToString("MMM/yyyy")),n.push(r.iMonth()-a.iMonth()+1),n.push(i),n.push(s.a.SessionManager.UserID),n.push(s.a.SessionManager.LanguageID);try{return s.a.inventory.GetAvgSales(n)}catch(o){return Logger.ErrorLog("BOM:: GetBOMDetails"+o.stack),null}}GetProductionPlan(e,t,i,a){Logger.InfoLog("BOM:: Inside GetProductionPlan");let r=[];r.push(e),r.push("1/"+i.ToString("MMM/yyyy")),r.push(a.DaysInMonth()+"/"+a.ToString("MMM/yyyy")),r.push(i.iMonth()-a.iMonth()+1),r.push(t),r.push(s.a.SessionManager.UserID),r.push(s.a.SessionManager.LanguageID);try{return s.a.inventory.GetProductionPlan(r)}catch(n){return Logger.ErrorLog("BOM:: GetProductionPlan"+n.stack),null}}GetAllProducts(e){Logger.InfoLog("BOM:: Inside GetAllProducts");let t=[];t.push(e),t.push(s.a.SessionManager.UserID),t.push(s.a.SessionManager.LanguageID);try{return s.a.inventory.GetAllProducts(t)}catch(i){return Logger.ErrorLog("BOM:: GetAllProducts"+i.stack),null}}GetProductsExtraNumericFields(){Logger.InfoLog("BOM:: Inside GetProductsExtraNumericFields");let e=[];e.push(s.a.SessionManager.UserID),e.push(s.a.SessionManager.LanguageID);try{return s.a.inventory.GetProductsExtraNumericFields(e)}catch(t){return Logger.ErrorLog("BOM:: GetProductsExtraNumericFields"+t.stack),null}}SearchProduct(e,t,i){Logger.InfoLog("BOM:: Inside SearchProduct");let a=[];a.push(e),a.push(t),a.push(i),a.push(s.a.SessionManager.UserID),a.push(s.a.SessionManager.LanguageID);try{return s.a.inventory.SearchProduct(a)}catch(r){return Logger.ErrorLog("BOM:: SearchProduct"+r.stack),null}}GetBOMDetails(e){Logger.InfoLog("BOM:: Inside GetBOMDetails");let t=[];t.push(e),t.push(s.a.SessionManager.UserID),t.push(s.a.SessionManager.LanguageID),t.push(s.a.SessionManager.RoleID);try{let e=s.a.inventory.GetBOM(t);return e.Tables.length>0&&e.Tables[0].length>0&&(this.Code=e.Tables[0][0].BOMCode.toString(),this.Name=e.Tables[0][0].BOMName.toString(),this.StatusID=parseInt(e.Tables[0][0].StatusID.toString()),this.Desc=e.Tables[0][0].Description.toString(),this.GUID=e.Tables[0][0].GUID.toString(),this.ProductID=parseInt(e.Tables[0][0].ProductID.toString()),this.LocationID=parseInt(e.Tables[0][0].LocationID.toString()),this.DivisionID=parseInt(e.Tables[0][0].DivisionID.toString()),this.group=Object(n.j)(e.Tables[0][0].IsGroup.toString()),this.selectednodeid=parseInt(e.Tables[0][0].ParentID.toString()),this.ProductionMethod=r.e.String(e.Tables[0][0].ProductionMethod)),e}catch(i){return Logger.ErrorLog("BOM:: GetBOMDetails"+i.stack),null}}AddBOM(e){Logger.InfoLog("SaveBOM:: Inside OnSave");try{let e=[];e.push(this.BOMID),e.push(this.Code),e.push(this.Name),e.push(this.ProductID),e.push(this.UOMID),e.push(this.FPQty),e.push(this.LocationID),e.push(this.DivisionID),e.push(this.Desc),e.push(this.StatusID),e.push(1),e.push("General"),e.push(this.group),e.push(this.selectednodeid),e.push(this.Date.ToString("dd/MMM/yyyy")),e.push(this.BOMProductXML),e.push(this.BOMExpenseXML),e.push(this.BOMResourceXML),e.push(this.CustomFieldsQuery),e.push(this.CustomCCQuery),e.push(this.ProductionXML),e.push(s.a.SessionManager.CompanyGUID),e.push(null!=this.GUID?this.GUID:""),e.push(s.a.SessionManager.UserName),e.push(this.WID),e.push(s.a.SessionManager.RoleID),e.push(s.a.SessionManager.UserID),e.push(s.a.SessionManager.LanguageID);let t="not Implemented";return Logger.InfoLog("SaveBOM:: Success: DBH.OnSave "+(0).toString()),t}catch(t){let e="ERROR";return Logger.ErrorLog("SaveBOM:: OnSave"+t.stack),e}}AddMultiStageBOM(e){Logger.InfoLog("SaveBOM:: Inside OnSave");try{let e=[];e.push(this.BOMID),e.push(this.Code),e.push(this.Name),e.push(this.ProductID),e.push(this.UOMID),e.push(this.FPQty),e.push(this.LocationID),e.push(this.DivisionID),e.push(this.Desc),e.push(this.StatusID),e.push(2),e.push("Multi-Stage"),e.push(this.group),e.push(this.selectednodeid),e.push(this.Date.ToString("dd/MMM/yyyy")),e.push(this.Packing),e.push(this.StageXML),e.push(this.BOMProductXML),e.push(this.BOMExpenseXML),e.push(this.BOMResourceXML),e.push(this.CustomFieldsQuery),e.push(this.CustomCCQuery),e.push(this.ProductionXML),e.push(s.a.SessionManager.CompanyGUID),e.push(null!=this.GUID?this.GUID:""),e.push(s.a.SessionManager.UserName),e.push(this.WID),e.push(s.a.SessionManager.RoleID),e.push(s.a.SessionManager.UserID),e.push(s.a.SessionManager.LanguageID);let t="not Implemented";return Logger.InfoLog("SaveBOM:: Success: DBH.OnSave "+(0).toString()),t}catch(t){let e="ERROR";return Logger.ErrorLog("SaveBOM:: OnSave"+t.stack),e}}DeleteBOM(e,t){let i=[];return i.push(e),i.push(s.a.SessionManager.UserID),i.push(s.a.SessionManager.LanguageID),Logger.InfoLog("DeleteBOM ::  DBH.DeleteBOM "+e.toString()),"Not Implemented"}getMachineCostHr(e,t){let i,a,n,o,l=s.a.report.GetTableColumns(e);if(n=l.ColumnName,a=l.PrimaryKey,i=l.TableName,!r.e.IsEmpty(i)){o="select ccAlpha47 from "+i+" WITH(NOLOCK) where NodeID="+t;let e=[];e.push(o),e.push(s.a.SessionManager.UserID),e.push(s.a.SessionManager.LanguageID);let a=s.a.common.GetDataSet("BOM002",i+"~"+t);if(a.length>0&&!r.e.IsEmpty(a[0].ccAlpha47))try{return parseFloat(a[0].ccAlpha47.toString())}catch(u){}}return 0}GetProductUnits(e){try{return s.a.common.GetDataSet("BOM001",e.toString())}catch(t){return Logger.ErrorLog("BOM:: GetProductUnits"+t.stack),null}}MoveMultipleBOMs(e,t){try{let i="";if(!(e.length>1))return 1==e.length?this.MoveBOM(e[0],t):s.a.GetResource("Account_NoSelected");i+="<XML>",e.forEach(e=>{i+='<Row BOMID="'+e.toString()+'" ></Row>'}),i+="</XML>";let a=[];a.push(t),a.push(i.toString()),a.push(s.a.SessionManager.UserID),a.push(s.a.SessionManager.LanguageID);let r="Not Implemented";return Logger.InfoLog("CostCenter:: Success: DBH.MoveCostCenter "+(0).toString()),r}catch(i){return Logger.ErrorLog("BOM:: MoveMultipleBOMs"+i.stack),null}}MoveBOM(e,t){try{let i=[];i.push(e),i.push(t),i.push(s.a.SessionManager.UserID),i.push(s.a.SessionManager.LanguageID);let a="Not Implemented";return Logger.InfoLog("CostCenter:: Success: DBH.MoveCostCenter "+e.toString()),a}catch(i){return Logger.ErrorLog("BOM:: MoveBOM"+i.stack),null}}static ReplaceBOMs(e,t,i,a,r){try{let r=[];return r.push(e),r.push(t),r.push(i),r.push(a),r.push(s.a.SessionManager.CompanyGUID),r.push(s.a.SessionManager.UserName),r.push(s.a.SessionManager.RoleID),r.push(s.a.SessionManager.UserID),r.push(s.a.SessionManager.LanguageID),"Not Implemented"}catch(n){let e="ERROR";return Logger.ErrorLog("SaveBOM:: OnSave"+n.stack),e}}}class C extends l.b{constructor(e,t){super(),this.BID=0,this.parentid=0,this.objBOM=new T,this._ScreenObject=new o.a,this.Title="",this.txtCode=new d.d(555025),this.txtName=new d.d(555026),this.txtCost=new d.d(0),this.txtUsage=new d.d(0),this.txtCapacity=new d.d(0),this.txtEffeciency=new d.d(0),this.Description=new d.d(23903),this.MStatus=new h.e(23898),this.Group=new h.e(23897),this.Location=new c.b(23900),this.Division=new c.b(23901),this.Product=new c.b(23899),this.UOM=new h.e(109),this.FPQty=new d.d(27269),this.Date=new p.a(23902),this.txtDesc=new d.d(23903),this.FilterCCID=0,this.MachineCCID=0,this.SNo=0,this.MachineID=0,Logger.InfoLog("AddEditBOMViewModel::Entering AddEditBOMViewModel "),this.ButtonSave=new u.a,this.parentid=t,this.BID=e,this.MessageVisibility=!1,this.InputGrid=new b,this.ExpenseGrid=new b,this.ResourcesGrid=new b,this.OutputGrid=new b,this.ProductionsMethod=new g(this,null),this._ScreenObject.LoadScreen_2(this,76),this.Product.SelectionChangedCommand.Subscribe(this,"OnProductChange"),0==e?s.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=s.a.SessionManager.IsActionAssigned(76,"Create"):this.ButtonSave.Enable=s.a.SessionManager.IsActionAssigned(76,"Create"):(this.ScreenObject.IsEdit=!0,s.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=s.a.SessionManager.IsActionAssigned(76,"Update"):this.ButtonSave.Enable=s.a.SessionManager.IsActionAssigned(76,"Update"));let i=this.ScreenObject.StaticFields.find(e=>23899==e.DBColumnID);null!=i?(this.Product.CCID=i.CCID,this.Product.TypeID=i.TypeID,0==this.Product.CCID&&(this.Product.CCID=3),0==this.Product.TypeID&&(this.Product.TypeID=10)):(this.Product.CCID=3,this.Product.TypeID=10),this.LoadData(),this.FPQty.Text="1",Logger.InfoLog("AddEditBOMViewModel::Exiting AddEditBOMViewModel "),this.loadtabs();let a=this.objBOM.GetBOMDetails(this.BID),r=this.ScreenObject.Data.Tables[4].filter(e=>"CapsLock"==e.Name);if(r.length>0&&Object(n.j)(r[0].Value)&&(this.txtName.IsAllCaps=!0),r=this.ScreenObject.Data.Tables[4].filter(e=>"CapsToFirstLetter"==e.Name),r.length>0&&Object(n.j)(r[0].Value)&&(this.txtName.IsFirstLetterCaps=!0),this.BID>0?(this.OnLoad(this.BID),this.OnProductChange(null),this.UOM.SelectedValue=a.Tables[0][0].UOMID.toString(),this.objBOM.GUID=a.Tables[0][0].GUID.toString(),this.Title=s.a.GetResource("BOM_EditBOM")):(this.Title=s.a.GetResource("BOM_AddBOM"),this.objBOM.GUID="GUID",this.AutoGenerateCode()),this.DisplayName=this.Title,a.Tables[4].length>0){for(let e=0;e<a.Tables[4].length;e++)this.Group.Items.push(h.d.ComboBoxItems_2(a.Tables[4][e].BOMName.toString(),a.Tables[4][e].BOMID.toString()));this.Group.SelectedValue=0==this.BID?a.Tables[4][0].BOMID.toString():this.parentid.toString()}this.CheckViewForUser(),this.InputGrid.BomGrid.ColumnSpan=4,this.ExpenseGrid.BomGrid.ColumnSpan=4,this.ResourcesGrid.BomGrid.ColumnSpan=4,this.OutputGrid.BomGrid.ColumnSpan=4,this.ProductionsMethod.ProductionMethodGridDataObj.ColumnSpan=4}get ScreenObject(){return this._ScreenObject}CheckViewForUser(){this.InputGrid.BomGrid.Columns.forEach(e=>{null!=e.ID&&this.ScreenObject.SetView(e,this.BID>0)}),this.ExpenseGrid.BomGrid.Columns.forEach(e=>{null!=e.ID&&this.ScreenObject.SetView(e,this.BID>0)}),this.ResourcesGrid.BomGrid.Columns.forEach(e=>{null!=e.ID&&this.ScreenObject.SetView(e,this.BID>0)}),this.OutputGrid.BomGrid.Columns.forEach(e=>{null!=e.ID&&this.ScreenObject.SetView(e,this.BID>0)})}loadtabs(){this.AssignRowColumns();let e=null;for(let t=this._ScreenObject.CustomTab.Pages.length-1;t>=0;t--){let i=this._ScreenObject.CustomTab.Pages[t];switch(i.Name){case"Production Method":i.Fields.push(this.ProductionsMethod.ProductionMethodGridDataObj);break;case"Raw Materials":i.Fields.push(this.InputGrid.BomGrid);break;case"Stages":e=i;break;case"Expenses":i.Fields.push(this.ExpenseGrid.BomGrid);break;case"Machines":i.Fields.push(this.ResourcesGrid.BomGrid);break;case"Other Outputs":i.Fields.push(this.OutputGrid.BomGrid)}}this.ScreenObject.CustomTab.Pages.Remove(e),this.ScreenObject.CustomTab.SelectedTab=this.ScreenObject.CustomTab.Pages[0]}AutoGenerateCode(){this.objBOM.GetBOMDetails(this.BID);let e=s.a.common.GetAutoSequence(76,"","76",s.a.SessionManager.CompanyIndex.toString()),t=this.ScreenObject.Data.Tables[4].filter(e=>"CodeAutoGen"==e.Name);t.length>0&&(Object(n.j)(t[0].Value)?(this.txtCode.Enable=!1,this.txtCode.Mandatory=!1,0==this.BID&&(this.txtCode.Text=e)):this.txtCode.Enable=!0),t=this.ScreenObject.Data.Tables[4].filter(e=>"CapsLock"==e.Name),t.length>0&&Object(n.j)(t[0].Value)&&(this.txtName.IsAllCaps=!0),t=this.ScreenObject.Data.Tables[4].filter(e=>"CapsToFirstLetter"==e.Name),t.length>0&&Object(n.j)(t[0].Value)&&(this.txtName.IsFirstLetterCaps=!0)}AssignRowColumns(){let e;e=this._ScreenObject.CustomFields.length;for(let t=0;t<e;t++)this._ScreenObject.CustomFields[t].Row=t/4,this._ScreenObject.CustomFields[t].Column=t%4}LoadData(){let e,t;this.InputGrid.BomGrid.Table=[],this.InputGrid.BomGrid.Columns=[],this.InputGrid.BomGrid.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.InputGrid.BomGrid.BeginEdit.Subscribe(this,"onBeginEdit"),this.InputGrid.BomGrid.CanUserAddRows=!0,this.InputGrid.BomGrid.CanUserDeleteRows=!0,this.InputGrid.BomGrid.TableColumns.push("Sno"),this.InputGrid.BomGrid.TableColumns.push("ProductCode"),this.InputGrid.BomGrid.TableColumns.push("ProductCode_Key"),this.InputGrid.BomGrid.TableColumns.push("ProductName"),this.InputGrid.BomGrid.TableColumns.push("ProductName_Key"),this.InputGrid.BomGrid.TableColumns.push("Qty"),this.InputGrid.BomGrid.TableColumns.push("UOM"),this.InputGrid.BomGrid.TableColumns.push("UOM_Key"),this.InputGrid.BomGrid.TableColumns.push("UnitPrice"),this.InputGrid.BomGrid.TableColumns.push("Value"),this.InputGrid.BomGrid.TableColumns.push("Wastage"),this.InputGrid.BomGrid.TableColumns.push("BOMProductID"),t=new m.a,t.Header="#",t.DisplayMember="Sno",t.DataType="TextBlock",t.Width=23,t.IsVisible=!0,t.ReadOnly=!0,this.InputGrid.BomGrid.Columns.push(t),this.ScreenObject.Data.Tables.length>4&&(e=this.ScreenObject.Data.Tables[4].filter(e=>"BomFilterDimension"==e.Name),e.length>0&&!r.e.IsEmpty(e[0].Value)&&r.e.Int(e[0].Value)>0&&parseInt(e[0].Value.toString())>0&&(this.FilterCCID=parseInt(e[0].Value.toString()),t=new m.a,t.Header="FilterOn",t.DisplayMember="FilterOn",t.ValueMember="FilterOn_Key",t.DataType="LISTBOX",t.Width=230,t.CostCenterID=parseInt(e[0].Value.toString()),t.TypeID=3==parseInt(e[0].Value.toString())?12:1,t.IsVisible=!0,this.InputGrid.BomGrid.Columns.push(t),this.InputGrid.BomGrid.TableColumns.push("FilterOn"),this.InputGrid.BomGrid.TableColumns.push("FilterOn_Key"))),t=new m.a,t.Header=s.a.GetResource("BOM_ProductCOde"),t.DisplayMember="ProductCode",t.ValueMember="ProductName_Key",t.DataType="LISTBOX",t.CostCenterID=3,t.TypeID=100,e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMProducts"==e.SysTableName&&"ProductCode"==e.SysColumnName&&1==e.LinkData),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):150,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.InputGrid.BomGrid.Columns.push(t),t=new m.a,t.Header=s.a.GetResource("BOM_ProductName"),t.DisplayMember="ProductName",t.ValueMember="ProductName_Key",t.DataType="LISTBOX",t.CostCenterID=3,t.TypeID=10,t.IsFrozen=!0,e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMProducts"==e.SysTableName&&"ProductID"==e.SysColumnName&&1==e.LinkData),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):220,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.InputGrid.BomGrid.Columns.push(t),t=new m.a,t.Header=s.a.GetResource("Quantity"),t.DisplayMember="Qty",t.DataType="INT",e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMProducts"==e.SysTableName&&"Quantity"==e.ysColumnName&&1==e.LinkData),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):90,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=s.a.SessionManager.Preferences.DecimalsinQty&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinQty),this.InputGrid.BomGrid.Columns.push(t),t=new m.a,t.Header=s.a.GetResource("UOM"),t.DisplayMember="UOM",t.ValueMember="UOM_Key",t.DataType="LISTBOX",t.CostCenterID=11,t.TypeID=1,e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMProducts"==e.SysTableName&&"UOMID"==e.SysColumnName&&1==e.LinkData),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.InputGrid.BomGrid.Columns.push(t),t=new m.a,t.Header=s.a.GetResource("UnitPrice"),t.DisplayMember="UnitPrice",t.DataType="FLOAT",e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMProducts"==e.SysTableName&&"UnitPrice"==e.SysColumnName&&1==e.LinkData),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=s.a.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinRate),this.InputGrid.BomGrid.Columns.push(t),t=new m.a,t.Header=s.a.GetResource("Value"),t.DisplayMember="Value",t.DataType="FLOAT",e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMProducts"==e.SysTableName&&"Value"==e.SysColumnName&&1==e.LinkData),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=s.a.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinRate),this.InputGrid.BomGrid.Columns.push(t),t=new m.a,t.Header=s.a.GetResource("Waistage"),t.DisplayMember="Wastage",t.DataType="FLOAT",e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMProducts"==e.SysTableName&&"Wastage"==e.SysColumnName&&1==e.LinkData),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.InputGrid.BomGrid.Columns.push(t),this.ExpenseGrid.BomGrid.Table=[],this.ExpenseGrid.BomGrid.Columns=[],this.ExpenseGrid.BomGrid.CanUserAddRows=!0,this.ExpenseGrid.BomGrid.CanUserDeleteRows=!0,t=new m.a,t.Header="#",t.DisplayMember="Sno",t.DataType="TextBlock",t.Width=23,t.IsVisible=!0,t.ReadOnly=!0,this.ExpenseGrid.BomGrid.Columns.push(t),t=new m.a,t.Header="Name",t.DisplayMember="Name",t.DataType="TextBlock",e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_Expenses"==e.SysTableName&&"Name"==e.SysColumnName),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):200,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.ExpenseGrid.BomGrid.Columns.push(t),t=new m.a,t.Header="Debit",t.DisplayMember="Expense",t.ValueMember="Expense_Key",t.DataType="LISTBOX",t.CostCenterID=2,e=this.ScreenObject.Data.Tables[4].filter(e=>"DrAccListview"==e.Name),t.TypeID=null!=e&&e.length>0?parseInt(e[0].Value.toString()):2,e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_Expenses"==e.SysTableName&&"DebitAccountID"==e.SysColumnName),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):200,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.ExpenseGrid.BomGrid.Columns.push(t),t=new m.a,t.Header="Credit",t.DisplayMember="AccountName",t.ValueMember="AccountName_Key",t.DataType="LISTBOX",t.CostCenterID=2,e=this.ScreenObject.Data.Tables[4].filter(e=>"CrAccListview"==e.Name),t.TypeID=null!=e&&e.length>0?parseInt(e[0].Value.toString()):2,e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_Expenses"==e.SysTableName&&"CreditAccountID"==e.SysColumnName),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):200,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.ExpenseGrid.BomGrid.Columns.push(t),t=new m.a,t.Header=s.a.GetResource("Value"),t.DisplayMember="Value",t.DataType="FLOAT",e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_Expenses"==e.SysTableName&&"Value"==e.SysColumnName),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):90,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=s.a.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinRate),this.ExpenseGrid.BomGrid.Columns.push(t),this.ExpenseGrid.BomGrid.TableColumns.push("Sno"),this.ExpenseGrid.BomGrid.TableColumns.push("Name"),this.ExpenseGrid.BomGrid.TableColumns.push("AccountName"),this.ExpenseGrid.BomGrid.TableColumns.push("AccountName_Key"),this.ExpenseGrid.BomGrid.TableColumns.push("Expense"),this.ExpenseGrid.BomGrid.TableColumns.push("Expense_Key"),this.ExpenseGrid.BomGrid.TableColumns.push("Value"),this.ExpenseGrid.BomGrid.TableColumns.push("ExpenseID"),this.ResourcesGrid.BomGrid.Table=[],this.ResourcesGrid.BomGrid.Columns=[],this.ResourcesGrid.BomGrid.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.ResourcesGrid.BomGrid.BeginEdit.Subscribe(this,"onBeginEdit"),this.ResourcesGrid.BomGrid.CanUserAddRows=!0,this.ResourcesGrid.BomGrid.CanUserDeleteRows=!0,t=new m.a,t.Header="#",t.DisplayMember="Sno",t.DataType="TextBlock",t.Width=23,t.IsVisible=!0,t.ReadOnly=!0,t.IsFrozen=!0,this.ResourcesGrid.BomGrid.Columns.push(t),t=new m.a,t.Header=s.a.GetResource("Machine"),t.DisplayMember="Machine",t.DataType="LISTBOX",e=this.ScreenObject.Data.Tables[4].filter(e=>"MachineDimension"==e.Name),e.length>0&&e[0].Value.toString().length>0&&(this.MachineCCID=parseInt(e[0].Value),t.CostCenterID=parseInt(e[0].Value)),t.TypeID=3,e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMResources"==e.SysTableName&&"ResourceID"==e.SysColumnName),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):200,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.ResourcesGrid.BomGrid.Columns.push(t),t=new m.a,t.Header=s.a.GetResource("HRS"),t.DisplayMember="Hrs",t.DataType="FLOAT",t.IsFrozen=!0,e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMResources"==e.SysTableName&&"Hours"==e.SysColumnName),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),t=new m.a,t.Header="Cost/Hr",t.DisplayMember="Value",t.DataType="FLOAT",e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMResources"===e.SysTableName&&"Value"==e.SysColumnName),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=s.a.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinRate),this.ResourcesGrid.BomGrid.Columns.push(t),this.ResourcesGrid.BomGrid.TableColumns.push("Sno"),this.ResourcesGrid.BomGrid.TableColumns.push("Machine"),this.ResourcesGrid.BomGrid.TableColumns.push("Machine_Key"),this.ResourcesGrid.BomGrid.TableColumns.push("Hrs"),this.ResourcesGrid.BomGrid.TableColumns.push("Value"),this.ResourcesGrid.BomGrid.TableColumns.push("BOMResourceID"),this.OutputGrid.BomGrid.Table=[],this.OutputGrid.BomGrid.Columns=[],this.OutputGrid.BomGrid.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.OutputGrid.BomGrid.CanUserAddRows=!0,this.OutputGrid.BomGrid.CanUserDeleteRows=!0,t=new m.a,t.Header="#",t.DisplayMember="Sno",t.DataType="TextBlock",t.Width=23,t.IsVisible=!0,t.ReadOnly=!0,t.IsFrozen=!0,this.OutputGrid.BomGrid.Columns.push(t),t=new m.a,t.Header=s.a.GetResource("BOM_ProductCOde"),t.DisplayMember="ProductCode",t.ValueMember="ProductName_Key",t.DataType="LISTBOX",t.CostCenterID=3,t.TypeID=100,e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMProducts"==e.SysTableName&&"ProductCode"==e.SysColumnName&&2==e.LinkData),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):200,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.OutputGrid.BomGrid.Columns.push(t),t=new m.a,t.Header=s.a.GetResource("BOM_ProductName"),t.DisplayMember="ProductName",t.ValueMember="ProductName_Key",t.DataType="LISTBOX",t.CostCenterID=3,t.TypeID=10,e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMProducts"==e.SysTableName&&"ProductID"==e.SysColumnName&&2==e.LinkData),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):220,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.OutputGrid.BomGrid.Columns.push(t),t=new m.a,t.Header="Qty",t.DisplayMember="Qty",t.DataType="INT",e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMProducts"==e.SysTableName&&"Quantity"==e.SysColumnName&&2==e.LinkData),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):90,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=s.a.SessionManager.Preferences.DecimalsinQty&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinQty),this.OutputGrid.BomGrid.Columns.push(t),t=new m.a,t.Header="UnitPrice",t.DisplayMember="UnitPrice",t.DataType="FLOAT",e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMProducts"==e.SysTableName&&"UnitPrice"==e.SysColumnName&&2==e.LinkData),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=s.a.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinRate),this.OutputGrid.BomGrid.Columns.push(t),t=new m.a,t.Header="Value",t.DisplayMember="Value",t.DataType="FLOAT",e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMProducts"==e.SysTableName&&"Value"==e.SysColumnName&&2==e.LinkData),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=s.a.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinRate),this.OutputGrid.BomGrid.Columns.push(t),this.OutputGrid.BomGrid.TableColumns.push("Sno"),this.OutputGrid.BomGrid.TableColumns.push("ProductCode"),this.OutputGrid.BomGrid.TableColumns.push("ProductName"),this.OutputGrid.BomGrid.TableColumns.push("ProductName_Key"),this.OutputGrid.BomGrid.TableColumns.push("Qty"),this.OutputGrid.BomGrid.TableColumns.push("UnitPrice"),this.OutputGrid.BomGrid.TableColumns.push("Value"),this.OutputGrid.BomGrid.TableColumns.push("BOMProductID"),this.FillEmptyRows(),this._ScreenObject.Data.Tables[3].forEach(e=>{this.MStatus.Items.push(h.d.ComboBoxItems_2(e[Object.keys(e)[1]].toString(),e[Object.keys(e)[0]].toString()))}),"1"!=s.a.SessionManager.RoleID&&s.a.SessionManager.IsActionAssigned(76,"Save as UnApproved")&&(this.MStatus.SelectedValue="464",this.MStatus.Visible=!1)}FillEmptyRows(){for(let e=0;e<8;e++)this.InputGrid.BomGrid.addEmptyRow();for(let e=0;e<5;e++)this.ExpenseGrid.BomGrid.addEmptyRow();for(let e=0;e<5;e++)this.ResourcesGrid.BomGrid.addEmptyRow();for(let e=0;e<5;e++)this.OutputGrid.BomGrid.addEmptyRow();this.UpdateSequence()}BOMExpenseXML(e){Logger.InfoLog("AddEditBOMViewModel::Entering BOMExpenseXML ");let t="";t+="<BOMExpenseXML>";for(let i=0;i<this.ExpenseGrid.BomGrid.Table.length;i++)r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[i].AccountName_Key)||(t+="<Row ",null!=e&&(null==e||"SaveAs"==e.toString())||r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[i].ExpenseID)?t+=" ExpenseID='0'":t+=" ExpenseID='"+this.ExpenseGrid.BomGrid.Table[i].ExpenseID.toString()+"'",t+=" Name='"+this.ExpenseGrid.BomGrid.Table[i].Name+"'",t+=" ResourceID='1'",t+=" CreditAccountID='"+this.ExpenseGrid.BomGrid.Table[i].AccountName_Key+"'",r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[i].Expense_Key)||(t+=" DebitAccountID='"+this.ExpenseGrid.BomGrid.Table[i].Expense_Key+"'"),t+=" Action='New'",t+=" Value='"+this.ExpenseGrid.BomGrid.Table[i].Value+"'/>");return t+="</BOMExpenseXML>",Logger.InfoLog("AddEditBOMViewModel::Exiting BOMExpenseXML"),t.toString()}BOMResourceXML(e){Logger.InfoLog("AddEditBOMViewModel::Entering BOMResourceXML ");let t="";t+="<BOMResourceXML>";for(let i=0;i<this.ResourcesGrid.BomGrid.Table.length;i++)r.e.IsEmpty(this.ResourcesGrid.BomGrid.Table[i].Machine_Key)||(t+="<Row ",null!=e&&(null==e||"SaveAs"==e.toString())||r.e.IsEmpty(this.ResourcesGrid.BomGrid.Table[i].BOMResourceID)?t+=" BOMResourceID='0'":t+=" BOMResourceID='"+this.ResourcesGrid.BomGrid.Table[i].BOMResourceID.toString()+"'",t+=" ResourceID='"+this.ResourcesGrid.BomGrid.Table[i].Machine_Key+"'",t+=" Hours='1' ",t+=" Action='New'",t+=" Value='"+this.ResourcesGrid.BomGrid.Table[i].Value+"'/>");return t+="</BOMResourceXML>",Logger.InfoLog("AddEditBOMViewModel::Exiting BOMResourceXML"),t.toString()}BOMProductXML(e){Logger.InfoLog("AddEditBOMViewModel::Entering MachineXML ");let t="";t+="<BOMProductXML>";for(let i=0;i<this.InputGrid.BomGrid.Table.length;i++)r.e.IsEmpty(this.InputGrid.BomGrid.Table[i].ProductName_Key)||(t+="<Row ",null!=e&&(null==e||"SaveAs"==e.toString())||r.e.IsEmpty(this.InputGrid.BomGrid.Table[i].BOMProductID)?t+=" BOMProductID='0'":t+=" BOMProductID='"+this.InputGrid.BomGrid.Table[i].BOMProductID.toString()+"'",t+=" ProductID='"+this.InputGrid.BomGrid.Table[i].ProductName_Key+"'",t+=" Quantity='"+r.e.String(this.InputGrid.BomGrid.Table[i].Qty)+"'",t+=" UOMID='"+r.e.String(this.InputGrid.BomGrid.Table[i].UOM_Key)+"'",t+=" UnitPrice='"+r.e.String(this.InputGrid.BomGrid.Table[i].UnitPrice)+"'",this.InputGrid.BomGrid.TableColumns.Contains("FilterOn_Key")&&!r.e.IsEmpty(this.InputGrid.BomGrid.Table[i].FilterOn_Key)&&(t+=" FilterOn='"+this.InputGrid.BomGrid.Table[i].FilterOn_Key.toString()+"'"),t+=" ProductUse='1'",t+=" Action='New'",t+=" Wastage='"+this.InputGrid.BomGrid.Table[i].Wastage+"'",t+=" Value='"+this.InputGrid.BomGrid.Table[i].Value+"'/>");for(let i=0;i<this.OutputGrid.BomGrid.Table.length;i++)r.e.IsEmpty(this.OutputGrid.BomGrid.Table[i].ProductName_Key)||(t+="<Row ",null!=e&&(null==e||"SaveAs"==e.toString())||r.e.IsEmpty(this.OutputGrid.BomGrid.Table[i].BOMProductID)?t+=" BOMProductID='0'":t+=" BOMProductID='"+this.OutputGrid.BomGrid.Table[i].BOMProductID.toString()+"'",t+=" ProductID='"+this.OutputGrid.BomGrid.Table[i].ProductName_Key+"'",t+=" Quantity='"+r.e.String(this.OutputGrid.BomGrid.Table[i].Qty)+"'",t+=" UnitPrice='"+r.e.String(this.OutputGrid.BomGrid.Table[i].UnitPrice)+"'",t+=" ProductUse='2'",t+=" Action='New'",t+=" Value='"+this.OutputGrid.BomGrid.Table[i].Value+"'/>");return t+="</BOMProductXML>",Logger.InfoLog("AddEditBOMViewModel::Exiting MachineXML"),t.toString()}ValidateGrids(){for(let e=0;e<this.ExpenseGrid.BomGrid.Table.length;e++)if(r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].AccountName_Key))if(r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Expense_Key))if(r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Value))if(r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Name));else{if(r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].AccountName_Key))return"Incomplete Expenses Information at Row :"+(e+1).toString();if(r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Expense_Key))return"Incomplete Expenses Information at Row :"+(e+1).toString();if(r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Value))return"Incomplete Expenses Information at Row :"+(e+1).toString()}else{if(r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].AccountName_Key))return"Incomplete Expenses Information at Row :"+(e+1).toString();if(r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Expense_Key))return"Incomplete Expenses Information at Row :"+(e+1).toString();if(r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Name))return"Incomplete Expenses Information at Row :"+(e+1).toString()}else{if(r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].AccountName_Key))return"Incomplete Expenses Information at Row :"+(e+1).toString();if(r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Value))return"Incomplete Expenses Information at Row :"+(e+1).toString();if(r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Name))return"Incomplete Expenses Information at Row :"+(e+1).toString()}else{if(r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Expense_Key))return"Incomplete Expenses Information at Row :"+(e+1).toString();if(r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Value))return"Incomplete Expenses Information at Row :"+(e+1).toString();if(r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Name))return"Incomplete Expenses Information at Row :"+(e+1).toString()}return""}OnSaveBOM(e){if(Logger.InfoLog("AddEditBOMViewModel::Entering OnSaveMachine "),"Save"==e.toString()||"SaveAs"==e.toString())try{let t,i=this._ScreenObject.ValidateData();if(!r.e.IsEmpty(i))return this.DisplayMessage=i,void(this.MessageVisibility=!0);if(i=this.ValidateGrids(),!r.e.IsEmpty(i))return this.DisplayMessage=i,void(this.MessageVisibility=!0);if(!this.ScreenObject.ValidateDataonSave())return;this.objBOM.BOMID=null!=e&&"SaveAs"==e.toString()?0:this.BID,this.objBOM.Code=this.txtCode.Text,this.objBOM.Name=this.txtName.Text,this.objBOM.Date=new Date,this.objBOM.ProductID=this.Product.SelectedValue,this.objBOM.UOMID=r.e.IsEmpty(this.UOM.SelectedValue)?0:parseInt(this.UOM.SelectedValue),this.objBOM.FPQty=r.e.Double(this.FPQty.Text),this.objBOM.FPQty<=0&&(this.objBOM.FPQty=1),this.objBOM.LocationID=this.Location.SelectedValue,this.objBOM.DivisionID=this.Division.SelectedValue,this.objBOM.group=!1,this.objBOM.selectednodeid=parseInt(this.Group.SelectedValue),this.objBOM.Desc=this.txtDesc.Text,this.objBOM.StatusID=parseInt(this.MStatus.SelectedValue),this.objBOM.BOMProductXML=this.BOMProductXML(e),this.objBOM.BOMExpenseXML=this.BOMExpenseXML(e),this.objBOM.BOMResourceXML=this.BOMResourceXML(e),this.objBOM.CustomFieldsQuery=this._ScreenObject.GetCustomFieldsQuery(),this.objBOM.CustomCCQuery=this._ScreenObject.GetCustomCostCenterFieldsQuery(),this.objBOM.ProductionXML=this.ProductionsMethod.GETXML(),this.objBOM.WID=464==this.objBOM.StatusID?0:this.ScreenObject.CheckWorkFlow(),s.a.inventory.SaveBOM(this.objBOM,"SaveBOM").subscribe(e=>{this.DisplayMessage=e.Message,this.MessageVisibility=!0,t=e.RetValue,t>0&&(this.txtCode.Text="",this.txtName.Text="",this.InputGrid.BomGrid.Table.Clear(),this.ExpenseGrid.BomGrid.Table.Clear(),this.OutputGrid.BomGrid.Table.Clear(),this.ResourcesGrid.BomGrid.Table.Clear(),this.FillEmptyRows(),this.Date.Date=new Date,this.Product.SelectedValue=0,this.Location.SelectedValue=0,this.Division.SelectedValue=0,this.txtDesc.Text="",this.FPQty.Text="1",this.BID=0,this.objBOM.BOMID=this.BID,this.AutoGenerateCode())},e=>{console.log(" BOM Save : "+JSON.stringify(e))})}catch(t){Logger.ErrorLog("AddEditBOMViewModel:: OnSAVE"+t.stack)}else e.toString();Logger.InfoLog("AddEditBOMViewModel::Exiting OnSaveMachine ")}UpdateSequence(){this.SNo=1,this.InputGrid.BomGrid.Table.forEach(e=>{e.Sno=this.SNo++}),this.SNo=1,this.OutputGrid.BomGrid.Table.forEach(e=>{e.Sno=this.SNo++}),this.SNo=1,this.ExpenseGrid.BomGrid.Table.forEach(e=>{e.Sno=this.SNo++}),this.SNo=1,this.ResourcesGrid.BomGrid.Table.forEach(e=>{e.Sno=this.SNo++}),this.InputGrid.BomGrid.refreshDataView(),this.OutputGrid.BomGrid.refreshDataView(),this.ExpenseGrid.BomGrid.refreshDataView(),this.ResourcesGrid.BomGrid.refreshDataView()}OnCellEditEnding(e){let t=e.item,i=e.column.field;if(Object.keys(t).Contains("Machine_Key")){if("Machine"==i&&""!=t.Machine_Key.toString()){if(this.MachineID==parseInt(t.Machine_Key.toString()))return;t.Value=this.objBOM.getMachineCostHr(this.MachineCCID,parseInt(t.Machine_Key.toString())),this.ResourcesGrid.BomGrid.updateRow(t)}}else{if("DataGridComboBoxColumn"==e.column.className)return;if(Object.keys(t).Contains("UOM")&&"ProductName"==i&&!r.e.IsEmpty(t.ProductName_Key)){let e=0;"UOM"!=i||r.e.IsEmpty(t.UOM_Key)||(e=parseInt(t.UOM_Key.toString()));let s=o.a.GetProductTypeDetails(parseInt(t.ProductName_Key.toString()),this.Date.Date,e,78,"",!1,!1,!1,!1,!1,!1,!1,!1,!1);s.Tables.length>0&&s.Columns[0].Contains("uomid")&&!r.e.IsEmpty(s.Tables[0][0].uomid)&&(t.UOM=s.Tables[0][0].UnitName.toString(),t.UOM_Key=s.Tables[0][0].uomid.toString(),s.Tables.length>3&&s.Tables[3].length>0&&s.Columns[3].Contains("SellingRate")&&""!=s.Tables[3][0].SellingRate.toString()?t.UnitPrice=s.Tables[3][0].SellingRate.toString():s.Tables.length>0&&s.Tables[0].length>0&&s.Columns[0].Contains("SellingRate")&&""!=s.Tables[0][0].SellingRate.toString()&&(t.UnitPrice=s.Tables[0][0].SellingRate.toString()))}this.CalculateTotals(t)}}CalculateTotals(e){let t=new S.a,i=new D.c;i.setFieldDetails("RATE",1,1,"",1,!1,!1),t.push("RATE",i),i=new D.c,i.setFieldDetails("QTY",4,1,"",1,!1,!1),t.push("QTY",i),r.e.IsEmpty(e.UnitPrice)?t.RATE.setFieldValue(0):t.RATE.setFieldValue(e.UnitPrice),r.e.IsEmpty(e.Qty)?t.QTY.setFieldValue(0):t.QTY.setFieldValue(e.Qty),e.Value=s.a.eval.EvaluateExpression("QTY*RATE",t).toString()}onBeginEdit(e){let t=e.args.item,i=e.args.column,s=i.DgCol,a=(r.e.IsEmpty(s.ValueBinding),r.e.IsEmpty(s.ValueBinding)?s.ValueMember:s.ValueBinding);if(Object.keys(t).Contains("Machine_Key")||"Machine_Key"==a)this.MachineID=r.e.IsEmpty(t.Machine_Key)?0:parseInt(t.Machine_Key.toString());else{let s=e.args;if("DataGridPactListBoxColumn"==i.className){let e=s.model;if(11==e.CostCenterID){let i=" (BaseID IN ";i+=" (SELECT BaseID ",i+=" FROM COM_UOM AS COM_UOM_1 with(nolock) ",i=i+" WHERE      (UOMID ="+t.UOM_Key.toString()+" ))) ",""==t.UOM_Key.toString()&&(i=" (BaseID IN ",i+=" (SELECT BaseID ",i+=" FROM COM_UOM AS COM_UOM_1 with(nolock) ",i+=" WHERE (UOMID =-1 ))) "),e.FilterCondition=i}3==e.CostCenterID&&"ProductName_Key"==e.SelectedValueBinding&&this.FilterCCID>0&&Object.keys(t).Contains("FilterOn_Key")&&!r.e.IsEmpty(t.FilterOn_Key)&&parseInt(t.FilterOn_Key.toString())>0&&(3==this.FilterCCID?e.Where=" ParentID="+t.FilterOn_Key.toString()+" ":50006==this.FilterCCID?e.Where=" CategoryID="+t.FilterOn_Key.toString()+" ":50004==this.FilterCCID?e.Where=" DepartmentID="+t.FilterOn_Key.toString()+" ":this.FilterCCID>5e4&&(e.Where=" a.ProductID IN (select NodeID from COM_CCCCData with(nolock) where CostCenterID=3 and ",e.Where+=" CCNID"+this.FilterCCID.toString()+"="+t.FilterOn_Key.toString()+" )"))}}}OnCustomizeExtraFields(e){}OnProductChange(e){if(this.UOM.Length!=this.Product.SelectedValue.toString()&&(this.UOM.Items.Clear(),this.UOM.Length=this.Product.SelectedValue.toString(),this.UOM.SelectedValue=null,this.Product.SelectedValue>0)){let e=this.objBOM.GetProductUnits(this.Product.SelectedValue);e.Tables[0].length>0&&(e.Tables[0].forEach(e=>{this.UOM.Items.push(h.d.ComboBoxItems_2(e.UnitName.toString(),e.UOMID.toString()))}),e.Columns[0].Contains("DefaultUOM")&&(this.UOM.SelectedValue=e.Tables[0][0].DefaultUOM.toString()))}}OnLoad(e){let t=this.objBOM.GetBOMDetails(e);if(t.Tables.length>5){if(t.Tables[0].length>0&&(this.txtCode.Text=t.Tables[0][0].BOMCode.toString(),this.txtName.Text=t.Tables[0][0].BOMName.toString(),this.Group.SelectedValue=t.Tables[0][0].ParentID.toString(),this.MStatus.SelectedValue=t.Tables[0][0].StatusID.toString(),this.txtDesc.Text=t.Tables[0][0].Description.toString(),r.e.IsEmpty(t.Tables[0][0].ProductID)||(this.Product.SelectedValue=parseInt(t.Tables[0][0].ProductID.toString())),r.e.IsEmpty(t.Tables[0][0].LocationID)||(this.Location.SelectedValue=parseInt(t.Tables[0][0].LocationID.toString())),r.e.IsEmpty(t.Tables[0][0].DivisionID)||(this.Division.SelectedValue=parseInt(t.Tables[0][0].DivisionID.toString())),r.e.IsEmpty(t.Tables[0][0].Date)||(this.Date.Date=new Date(t.Tables[0][0].Date.toString())),this.FPQty.Text=t.Tables[0][0].FPQty.toString()),t.Tables.length>8&&t.Tables[8].length>0&&this.ProductionsMethod.Load(t.Tables[8]),this.ScreenObject.LoadCustomFieldsData(t.Tables[6]),this.ScreenObject.LoadCustomFieldsCCData(t.Tables[7]),this.ScreenObject.CanApprove(t.Tables[0][0],t.Tables[10][0],this.ButtonSave),this.InputGrid.BomGrid.Table.Clear(),this.ExpenseGrid.BomGrid.Table.Clear(),this.ResourcesGrid.BomGrid.Table.Clear(),this.OutputGrid.BomGrid.Table.Clear(),t.Tables[1].length>0)for(let e=0;e<t.Tables[1].length;e++){let i=this.InputGrid.BomGrid.NewRow();i.ProductCode=t.Tables[1][e].ProductCode.toString(),i.ProductName=t.Tables[1][e].ProductName.toString(),i.ProductName_Key=t.Tables[1][e].ProductID.toString(),i.Qty=t.Tables[1][e].Quantity.toString(),t.Columns[1].Contains("UOM")&&(i.UOM=t.Tables[1][e].UOM.toString()),i.UOM_Key=t.Tables[1][e].UOMID.toString(),i.UnitPrice=t.Tables[1][e].UnitPrice.toString(),i.Wastage=t.Tables[1][e].Wastage.toString(),i.Value=t.Tables[1][e].Value.toString(),i.BOMProductID=t.Tables[1][e].BOMProductID.toString(),this.InputGrid.BomGrid.TableColumns.Contains("FilterOn_Key")&&!r.e.IsEmpty(t.Tables[1][e].FilterOn)&&(i.FilterOn_Key=t.Tables[1][e].FilterOn.toString()),this.InputGrid.BomGrid.addRow(i)}if(t.Tables[2].length>0)for(let e=0;e<t.Tables[2].length;e++){let i=this.ExpenseGrid.BomGrid.NewRow();i.Name=t.Tables[2][e].Name.toString(),i.AccountName=t.Tables[2][e].CRAccountName.toString(),r.e.IsEmpty(t.Tables[2][e].CreditAccountID)||(i.AccountName_Key=t.Tables[2][e].CreditAccountID.toString()),i.Expense=t.Tables[2][e].DRAccountName.toString(),r.e.IsEmpty(t.Tables[2][e].DebitAccountID)||(i.Expense_Key=t.Tables[2][e].DebitAccountID.toString()),i.Value=t.Tables[2][e].Value.toString(),i.ExpenseID=t.Tables[2][e].ExpenseID.toString(),this.ExpenseGrid.BomGrid.addRow(i)}if(t.Tables[3].length>0)for(let e=0;e<t.Tables[3].length;e++){let i=this.ResourcesGrid.BomGrid.NewRow();i.Machine=t.Tables[3][e].ResourceName.toString(),i.Machine_Key=t.Tables[3][e].ResourceID.toString(),i.Hrs=t.Tables[3][e].Hours.toString(),i.Value=t.Tables[3][e].Value.toString(),i.BOMResourceID=t.Tables[3][e].BOMResourceID.toString(),this.ResourcesGrid.BomGrid.addRow(i)}if(t.Tables[5].length>0)for(let e=0;e<t.Tables[5].length;e++){let i=this.OutputGrid.BomGrid.NewRow();i.ProductCode=t.Tables[5][e].ProductCode.toString(),i.ProductName=t.Tables[5][e].ProductName.toString(),i.ProductName_Key=t.Tables[5][e].ProductID.toString(),i.Qty=t.Tables[5][e].Quantity.toString(),i.UnitPrice=t.Tables[5][e].UnitPrice.toString(),i.Value=t.Tables[5][e].Value.toString(),i.BOMProductID=t.Tables[5][e].BOMProductID.toString(),this.OutputGrid.BomGrid.addRow(i)}this.FillEmptyRows()}this.InputGrid.BomGrid.RefreshGrid=this.ExpenseGrid.BomGrid.RefreshGrid=this.ResourcesGrid.BomGrid.RefreshGrid=this.OutputGrid.BomGrid.RefreshGrid=!0}OnShowContact(){Logger.InfoLog("AddEditAccountScreenViewModel::Entering OnShowContact"),Logger.InfoLog("AddEditAccountScreenViewModel::Exiting OnShowContact")}OnShowAddress(){Logger.InfoLog("AddEditAccountScreenViewModel::Entering OnShowAddress"),Logger.InfoLog("AddEditAccountScreenViewModel::Exiting OnShowAddress")}OnAddContact(){Logger.InfoLog("AddEditAccountScreenViewModel::Entering AddContact"),Logger.InfoLog("AddEditAccountScreenViewModel::Exiting AddContact")}OnShowNote(){Logger.InfoLog("AddEditAccountScreenViewModel::Entering OnShowNote"),Logger.InfoLog("AddEditAccountScreenViewModel::Exiting OnShowNote")}}var O=i("8LsI"),M=i("6z9j");class y{constructor(){this.ColumnSpan="4",this.Tree=new M.a}}var G=i("FWvQ"),B=i("ZDA+"),P=i("PDNK");class E extends l.b{constructor(e,t,i,a){super(),this.StageID=0,this.parentid=0,this.FilterCCID=0,this.MachineCCID=0,this.MachineID=0,this.SNo=0,this.objBOM=new T,this._ScreenObject=new o.a,this.Title="",this.Stage=new c.b(0),this.Code="",this.Name="",this.StageNodeID=0,this.txtCost=new d.d(0),this.txtUsage=new d.d(0),this.txtDuration=new d.d(0),this.txtEffeciency=new d.d(0),this.Description=new d.d(0),this.MStatus=new h.e(23898),this.Group=new h.e(23897),this.Location=new c.b(23900),this.Division=new c.b(23901),this.UOM=new h.e(109),this.Date=new p.a(23902),this.txtDesc=new d.d(23903),this.Pickrate=new P.b("Pickrate"),this.CancelVisible=!1,this.TreeObject=null,this.Childrens=new Array,this.Parent=null,this.InputYes=!1,this.OutputYes=!1,this.ExpenseYes=!1,this.ResourceYes=!1,this.PrevValue="",this.parentid=t,this.Parent=i,this.StageID=e,this.TreeObject=a,this.MessageVisibility=!1,this.Pickrate.IsHorizontalOrientation=!0,this._ScreenObject.Data=a.ScreenObject.Data;let r=this.ScreenObject.Data.Tables[4].filter(e=>"StageDimension"==e.Name);r.length>0&&r[0].Value.toString().length>0&&(this.Stage.CCID=parseInt(r[0].Value),this.Stage.TypeID=1),r=this.ScreenObject.Data.Tables[4].filter(e=>"EnableDuration"==e.Name),r.length>0&&Object(n.j)(r[0].Value.toString())?(this.txtDuration.Visible=!0,this.txtDuration.Label="Duration"):this.txtDuration.Visible=!1,this.Pickrate.Label="Pick rate for issue products";let l=new P.a("Master",1);l.Label="Product master",l.Group=this.Pickrate,r=this.ScreenObject.Data.Tables[4].filter(e=>"BomDefaultRate"==e.Name),(0==r.length||r.length>0&&"0"==r[0].Value.toString())&&(l.IsChecked=!0),this.Pickrate.Items.push(l),l=new P.a("Chart",1),l.Label="Price chart",l.Group=this.Pickrate,r.length>0&&"1"==r[0].Value.toString()&&(l.IsChecked=!0),this.Pickrate.Items.push(l),l=new P.a("AvgRate",1),l.Label="Avg. Rate",l.Group=this.Pickrate,r.length>0&&"2"==r[0].Value.toString()&&(l.IsChecked=!0),this.Pickrate.Items.push(l),this.Pickrate.Enable=!s.a.SessionManager.IsActionAssigned(76,"Do not allow to change Pick Rate"),this.LoadData(),this.MStatus.SelectedValue="1",this.loadtabs(),e>0?this.Title="Edit Stage":(this.Title="Add Stage",this.objBOM.GUID="GUID"),this.DisplayName=this.Title,this.CheckViewForUser(),this.Stage.Label="Stage"}get ScreenObject(){return this._ScreenObject}CheckViewForUser(){this.InputGrid.Columns.forEach(e=>{null!=e.ID&&this.ScreenObject.SetView(e,this.TreeObject.BID>0)}),this.ExpenseGrid.Columns.forEach(e=>{null!=e.ID&&this.ScreenObject.SetView(e,this.TreeObject.BID>0)}),this.ResourcesGrid.Columns.forEach(e=>{null!=e.ID&&this.ScreenObject.SetView(e,this.TreeObject.BID>0)}),this.OutputGrid.Columns.forEach(e=>{null!=e.ID&&this.ScreenObject.SetView(e,this.TreeObject.BID>0)})}loadtabs(){this.AssignRowColumns();for(let e=this._ScreenObject.CustomTab.Pages.length-1;e>=0;e--){let t=this._ScreenObject.CustomTab.Pages[e];switch(t.Name){case"Production Method":t.Fields.push(g)}}}AssignRowColumns(){let e;e=this._ScreenObject.CustomFields.length;for(let t=0;t<e;t++)this._ScreenObject.CustomFields[t].Row=t/4,this._ScreenObject.CustomFields[t].Column=t%4}LoadData(){let e,t;this.InputGrid=new I.a,this.InputGrid.Table=[],this.InputGrid.Columns=[],this.InputGrid.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.InputGrid.BeginEdit.Subscribe(this,"onBeginEdit"),this.InputGrid.CanUserAddRows=!0,this.InputGrid.CanUserDeleteRows=!0,this.InputGrid.Height=230,this.InputGrid.Width="880",this.InputGrid.TableColumns.push("Sno"),this.InputGrid.TableColumns.push("ProductCode"),this.InputGrid.TableColumns.push("ProductName"),this.InputGrid.TableColumns.push("ProductName_Key"),this.InputGrid.TableColumns.push("Qty"),this.InputGrid.TableColumns.push("UOM"),this.InputGrid.TableColumns.push("UOM_Key"),this.InputGrid.TableColumns.push("UnitPrice"),this.InputGrid.TableColumns.push("Value"),this.InputGrid.TableColumns.push("Wastage"),this.InputGrid.TableColumns.push("BOMProductID"),this.InputGrid.TableColumns.push("IncludeinStage"),this.InputGrid.TableColumns.push("IncludeinFinal"),this.InputGrid.TableColumns.push("Stage"),this.InputGrid.TableColumns.push("Stage_Key"),this.InputGrid.TableColumns.push("Remarks"),t=new m.a,t.Header="#",t.DisplayMember="Sno",t.DataType="TextBlock",t.Width=23,t.IsVisible=!0,t.ReadOnly=!0,this.InputGrid.Columns.push(t),this.ScreenObject.Data.Tables.length>4&&(e=this.ScreenObject.Data.Tables[4].filter(e=>"BomFilterDimension"==e.Name),e.length>0&&!r.e.IsEmpty(e[0].Value)&&r.e.Int(e[0].Value.toString())>0&&parseInt(e[0].Value.toString())>0&&(this.FilterCCID=parseInt(e[0].Value.toString()),t=new m.a,t.Header="FilterOn",t.DisplayMember="FilterOn",t.ValueMember="FilterOn_Key",t.DataType="LISTBOX",t.Width=230,t.CostCenterID=parseInt(e[0].Value.toString()),t.TypeID=3==parseInt(e[0].Value.toString())?12:1,t.IsVisible=!0,this.InputGrid.Columns.push(t),this.InputGrid.TableColumns.push("FilterOn"),this.InputGrid.TableColumns.push("FilterOn_Key"))),t=new m.a,t.Header=s.a.GetResource("BOM_ProductCOde"),t.DisplayMember="ProductCode",t.ValueMember="ProductName_Key",t.DataType="LISTBOX",t.CostCenterID=3,t.TypeID=100,e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMProducts"==e.SysTableName&&"ProductCode"==e.SysColumnName&&1==e.LinkData),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):150,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.InputGrid.Columns.push(t),t=new m.a,t.Header=s.a.GetResource("BOM_ProductName"),t.DisplayMember="ProductName",t.ValueMember="ProductName_Key",t.DataType="LISTBOX",t.CostCenterID=3,t.TypeID=10,e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMProducts"==e.SysTableName&&"ProductID"==e.SysColumnName&&1==e.LinkData),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):220,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.InputGrid.Columns.push(t),t=new m.a,t.Header=s.a.GetResource("Quantity"),t.DisplayMember="Qty",t.DataType="INT",e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMProducts"==e.SysTableName&&"Quantity"==e.SysColumnName&&1==e.LinkData),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):90,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&!r.e.IsEmpty(s.a.SessionManager.Preferences.DecimalsinQty)&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinQty),this.InputGrid.Columns.push(t),t=new m.a,t.Header=s.a.GetResource("UOM"),t.DisplayMember="UOM",t.ValueMember="UOM_Key",t.DataType="LISTBOX",t.CostCenterID=11,t.TypeID=1,e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMProducts"==e.SysTableName&&"UOMID"==e.SysColumnName&&1==e.LinkData),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.InputGrid.Columns.push(t),t=new m.a,t.Header=s.a.GetResource("UnitPrice"),t.DisplayMember="UnitPrice",t.DataType="FLOAT",e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMProducts"==e.SysTableName&&"UnitPrice"==e.SysColumnName&&1==e.LinkData),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=s.a.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinRate),this.InputGrid.Columns.push(t),t=new m.a,t.Header=s.a.GetResource("Value"),t.DisplayMember="Value",t.DataType="FLOAT",e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMProducts"==e.SysTableName&&"Value"==e.SysColumnName&&1==e.LinkData),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=s.a.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinRate),this.InputGrid.Columns.push(t),t=new m.a,t.Header=s.a.GetResource("Waistage"),t.DisplayMember="Wastage",t.DataType="FLOAT",e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMProducts"==e.SysTableName&&"Wastage"==e.SysColumnName&&1==e.LinkData),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.InputGrid.Columns.push(t);let i,a=new Array;if(a.push(h.d.ComboBoxItems_2("No","0")),a.push(h.d.ComboBoxItems_2("Yes","1")),t=new m.a,t.Header="Incl. in Final Cost",t.ValueBinding="IncludeinFinal",t.ValueMember="Value",t.DisplayMember="Name",t.DataType="ComboBox",t.ComboData=a,e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMProducts"==e.SysTableName&&"IncInFinalCost"==e.SysColumnName&&1==e.LinkData),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.InputGrid.Columns.push(t),t=new m.a,t.Header="Incl. in Stage Cost",t.ValueBinding="IncludeinStage",t.DataType="ComboBox",t.ValueMember="Value",t.DisplayMember="Name",e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMProducts"==e.SysTableName&&"IncInStageCost"==e.SysColumnName&&1==e.LinkData),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),t.ComboData=a,this.InputGrid.Columns.push(t),s.a.SessionManager.Preferences.ContainsKey("AutoProduceDoc")&&""!=s.a.SessionManager.Preferences.AutoProduceDoc&&this.Stage.Visible&&this.Stage.CCID>5e4&&"0"!=s.a.SessionManager.Preferences.AutoProduceDoc&&parseInt(s.a.SessionManager.Preferences.AutoProduceDoc)>4e4&&(t=new m.a,t.Header="Auto Produce",t.DisplayMember="Stage",t.ValueMember="Stage_Key",t.DataType="LISTBOX",t.Width=150,t.CostCenterID=this.Stage.CCID,t.TypeID=this.Stage.TypeID,t.IsVisible=!0,this.InputGrid.Columns.push(t)),t=new m.a,t.Header=s.a.GetResource("Remarks"),t.DisplayMember="Remarks",t.DataType="TextBlock",e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMProducts"==e.SysTableName&&"Remarks"==e.SysColumnName&&1==e.LinkData),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):75,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.InputGrid.Columns.push(t),this.ExpenseGrid=new I.a,this.ExpenseGrid.Table=[],this.ExpenseGrid.Columns=[],this.ExpenseGrid.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.ExpenseGrid.CanUserAddRows=!0,this.ExpenseGrid.CanUserDeleteRows=!0,this.ExpenseGrid.Height=230,this.ExpenseGrid.Width="880",t=new m.a,t.Header="#",t.DisplayMember="Sno",t.DataType="TextBlock",t.Width=23,t.IsVisible=!0,t.ReadOnly=!0,this.ExpenseGrid.Columns.push(t),t=new m.a,t.Header="Name",t.DisplayMember="Name",t.DataType="TextBlock",e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_Expenses"==e.SysTableName&&"Name"==e.SysColumnName),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):200,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.ExpenseGrid.Columns.push(t),t=new m.a,t.Header="Debit",t.DisplayMember="Expense",t.ValueMember="Expense_Key",t.DataType="LISTBOX",t.CostCenterID=2,e=this.ScreenObject.Data.Tables[4].filter(e=>"DrAccListview"==e.Name),t.TypeID=null!=e&&e.length>0?parseInt(e[0].Value.toString()):2,e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_Expenses"==e.SysTableName&&"DebitAccountID"==e.SysColumnName),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):200,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.ExpenseGrid.Columns.push(t),t=new m.a,t.Header="Credit",t.DisplayMember="AccountName",t.ValueMember="AccountName_Key",t.DataType="LISTBOX",t.CostCenterID=2,e=this.ScreenObject.Data.Tables[4].filter(e=>"CrAccListview"==e.Name),t.TypeID=null!=e&&e.length>0?parseInt(e[0].Value.toString()):2,e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_Expenses"==e.SysTableName&&"CreditAccountID"==e.SysColumnName),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):200,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.ExpenseGrid.Columns.push(t),t=new m.a,t.Header=s.a.GetResource("Value"),t.DisplayMember="Value",t.DataType="FLOAT",e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_Expenses"==e.SysTableName&&"Value"==e.SysColumnName),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):90,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=s.a.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinRate),this.ExpenseGrid.Columns.push(t),t=new m.a,t.Header="Incl. in Final Cost",t.ValueBinding="IncludeinFinal",t.ValueMember="Value",t.DisplayMember="Name",t.DataType="ComboBox",t.ComboData=a,e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_Expenses"==e.SysTableName&&"IncInFinalCost"==e.SysColumnName),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):107,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.ExpenseGrid.Columns.push(t),t=new m.a,t.Header="Incl. in Stage Cost",t.ValueBinding="IncludeinStage",t.DataType="ComboBox",t.ValueMember="Value",t.DisplayMember="Name",t.ComboData=a,e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_Expenses"==e.SysTableName&&"IncInStageCost"==e.SysColumnName),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):114,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.ExpenseGrid.Columns.push(t),this.ExpenseGrid.TableColumns.push("Sno"),this.ExpenseGrid.TableColumns.push("Name"),this.ExpenseGrid.TableColumns.push("AccountName"),this.ExpenseGrid.TableColumns.push("AccountName_Key"),this.ExpenseGrid.TableColumns.push("Expense"),this.ExpenseGrid.TableColumns.push("Expense_Key"),this.ExpenseGrid.TableColumns.push("Value"),this.ExpenseGrid.TableColumns.push("ExpenseID"),this.ExpenseGrid.TableColumns.push("IncludeinStage"),this.ExpenseGrid.TableColumns.push("IncludeinFinal"),this.ResourcesGrid=new I.a,this.ResourcesGrid.Table=[],this.ResourcesGrid.Columns=[],this.ResourcesGrid.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.ResourcesGrid.BeginEdit.Subscribe(this,"onBeginEdit"),this.ResourcesGrid.CanUserAddRows=!0,this.ResourcesGrid.CanUserDeleteRows=!0,this.ResourcesGrid.Height=230,this.ResourcesGrid.Width="880",t=new m.a,t.Header="#",t.DisplayMember="Sno",t.DataType="TextBlock",t.Width=40,t.IsVisible=!0,t.ReadOnly=!0,this.ResourcesGrid.Columns.push(t),e=this.ScreenObject.Data.Tables[4].filter(e=>"EnableMachineoptions"==e.Name),e.length>0&&e[0].Value.toString().length>0&&Object(n.j)(e[0].Value.toString())){t=new m.a,t.Header="Options",t.DisplayMember="Sno",t.Width=80,t.ValueBinding="Options",t.ValueMember="Value",t.DisplayMember="Name",t.DataType="ComboBox";let e=new Array;for(let t=1;t<10;t++)e.push(h.d.ComboBoxItems_2("Option "+t,t.toString()));t.ComboData=e,this.ResourcesGrid.Columns.push(t),this.ResourcesGrid.TableColumns.push("Options")}if(t=new m.a,t.Header=s.a.GetResource("Machine"),t.DisplayMember="Machine",t.DataType="LISTBOX",e=this.ScreenObject.Data.Tables[4].filter(e=>"MachineDimension"==e.Name),e.length>0&&e[0].Value.toString().length>0&&(this.MachineCCID=parseInt(e[0].Value),t.CostCenterID=parseInt(e[0].Value)),t.TypeID=3,e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMResources"==e.SysTableName&&"ResourceID"==e.SysColumnName),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):200,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.ResourcesGrid.Columns.push(t),t=new m.a,t.Header=s.a.GetResource("HRS"),t.DisplayMember="Hrs",t.DataType="FLOAT",e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMResources"==e.SysTableName&&"Hours"==e.SysColumnName),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.ResourcesGrid.Columns.push(t),t=new m.a,t.Header="Cost/Hr",t.DisplayMember="Value",t.DataType="FLOAT",e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMResources"==e.SysTableName&&"Value"==e.SysColumnName),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=s.a.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinRate),this.ResourcesGrid.Columns.push(t),e=this._ScreenObject.Data.Tables[4].filter(e=>"MachineDim1"==e.Name),e.length>0&&!r.e.IsEmpty(e[0].Value)&&r.e.Int(e[0].Value.toString())>5e4){i=r.e.Int(e[0].Value.toString());let s=this._ScreenObject.GetfeatureNames(i.toString());t=new m.a,t.Header=s.Tables[0][0].Name.toString(),t.DisplayMember="MachineDim1",t.DataType="LISTBOX",t.CostCenterID=i,t.TypeID=1,t.Width=200,this.ResourcesGrid.Columns.push(t),this.ResourcesGrid.TableColumns.push("MachineDim1"),this.ResourcesGrid.TableColumns.push("MachineDim1_Key")}if(e=this._ScreenObject.Data.Tables[4].filter(e=>"MachineDim2"==e.Name),e.length>0&&!r.e.IsEmpty(e[0].Value)&&r.e.Int(e[0].Value.toString())>5e4){i=r.e.Int(e[0].Value.toString());let s=this._ScreenObject.GetfeatureNames(i.toString());t=new m.a,t.Header=s.Tables[0][0].Name.toString(),t.DisplayMember="MachineDim2",t.DataType="LISTBOX",t.CostCenterID=i,t.TypeID=1,t.Width=200,this.ResourcesGrid.Columns.push(t),this.ResourcesGrid.TableColumns.push("MachineDim2"),this.ResourcesGrid.TableColumns.push("MachineDim2_Key")}t=new m.a,t.Header="Incl. in Final Cost",t.ValueBinding="IncludeinFinal",t.ValueMember="Value",t.DisplayMember="Name",t.DataType="ComboBox",t.ComboData=a,e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMResources"==e.SysTableName&&"IncInFinalCost"==e.SysColumnName),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):107,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.ResourcesGrid.Columns.push(t),t=new m.a,t.Header="Incl. in Stage Cost",t.ValueBinding="IncludeinStage",t.DataType="ComboBox",t.ValueMember="Value",t.DisplayMember="Name",t.ComboData=a,e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMResources"==e.SysTableName&&"IncInStageCost"==e.SysColumnName),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):114,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.ResourcesGrid.Columns.push(t),this.ResourcesGrid.TableColumns.push("Sno"),this.ResourcesGrid.TableColumns.push("Machine"),this.ResourcesGrid.TableColumns.push("Machine_Key"),this.ResourcesGrid.TableColumns.push("Hrs"),this.ResourcesGrid.TableColumns.push("Value"),this.ResourcesGrid.TableColumns.push("BOMResourceID"),this.ResourcesGrid.TableColumns.push("IncludeinStage"),this.ResourcesGrid.TableColumns.push("IncludeinFinal"),this.OutputGrid=new I.a,this.OutputGrid.Table=[],this.OutputGrid.Columns=[],this.OutputGrid.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.OutputGrid.BeginEdit.Subscribe(this,"onBeginEdit"),this.OutputGrid.CanUserAddRows=!0,this.OutputGrid.CanUserDeleteRows=!0,this.OutputGrid.Height=230,this.OutputGrid.Width="880",t=new m.a,t.Header="#",t.DisplayMember="Sno",t.DataType="TextBlock",t.Width=23,t.IsVisible=!0,t.ReadOnly=!0,this.OutputGrid.Columns.push(t),t=new m.a,t.Header=s.a.GetResource("BOM_ProductCOde"),t.DisplayMember="ProductCode",t.ValueMember="ProductName_Key",t.DataType="LISTBOX",t.CostCenterID=3,t.TypeID=100,e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMProducts"==e.SysTableName&&"ProductCode"==e.SysColumnName&&2==e.LinkData),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):200,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.OutputGrid.Columns.push(t),t=new m.a,t.Header=s.a.GetResource("BOM_ProductName"),t.DisplayMember="ProductName",t.ValueMember="ProductName_Key",t.DataType="LISTBOX",t.CostCenterID=3,t.TypeID=10,e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMProducts"==e.SysTableName&&"ProductID"==e.SysColumnName&&2==e.LinkData),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):220,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.OutputGrid.Columns.push(t),t=new m.a,t.Header="Qty",t.DisplayMember="Qty",t.DataType="INT",e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMProducts"==e.SysTableName&&"Quantity"==e.SysColumnName&&2==e.LinkData),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):90,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=s.a.SessionManager.Preferences.DecimalsinQty&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinQty),this.OutputGrid.Columns.push(t),t=new m.a,t.Header=s.a.GetResource("UOM"),t.DisplayMember="UOM",t.ValueMember="UOM_Key",t.DataType="LISTBOX",t.CostCenterID=11,t.TypeID=1,e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMProducts"==e.SysTableName&&"UOMID"==e.SysColumnName&&2==e.LinkData),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.OutputGrid.Columns.push(t),t=new m.a,t.Header="UnitPrice",t.DisplayMember="UnitPrice",t.DataType="FLOAT",e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMProducts"==e.SysTableName&&"UnitPrice"==e.SysColumnName&&2==e.LinkData),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=s.a.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinRate),this.OutputGrid.Columns.push(t),t=new m.a,t.Header="Value",t.DisplayMember="Value",t.DataType="FLOAT",e=this._ScreenObject.Data.Tables[0].filter(e=>"PRD_BOMProducts"==e.SysTableName&&"Value"==e.SysColumnName&&2==e.LinkData),e.length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(n.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=s.a.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinRate),this.OutputGrid.Columns.push(t),this.OutputGrid.TableColumns.push("Sno"),this.OutputGrid.TableColumns.push("ProductCode"),this.OutputGrid.TableColumns.push("ProductName"),this.OutputGrid.TableColumns.push("ProductName_Key"),this.OutputGrid.TableColumns.push("Qty"),this.OutputGrid.TableColumns.push("UnitPrice"),this.OutputGrid.TableColumns.push("Value"),this.OutputGrid.TableColumns.push("BOMProductID"),this.OutputGrid.TableColumns.push("UOM_Key"),this.OutputGrid.TableColumns.push("UOM"),this.FillEmptyRows(),this.MStatus.Items.push(h.d.ComboBoxItems_2("Active","1")),this.MStatus.Items.push(h.d.ComboBoxItems_2("InActive","2"))}FillEmptyRows(){for(let e=0;e<10;e++)this.InputGrid.addEmptyRow();for(let e=0;e<10;e++)this.ExpenseGrid.addEmptyRow();for(let e=0;e<10;e++)this.ResourcesGrid.addEmptyRow();for(let e=0;e<10;e++)this.OutputGrid.addEmptyRow();this.UpdateSequence()}ValidateGrids(){let e=0,t=!0,i=this.ScreenObject.Data.Tables[4].filter(e=>"DontSaveIf_QtyIsZero"==e.Name);i.length>0&&(t=r.e.DoubleBool(i[0].Value.toString()));for(let s=0;s<this.OutputGrid.Table.length;s++)if(!r.e.IsEmpty(this.OutputGrid.Table[s].ProductName_Key)&&parseInt(this.OutputGrid.Table[s].ProductName_Key.toString())>0){if(""==r.e.String(this.OutputGrid.Table[s].Qty)||0==parseFloat(r.e.String(this.OutputGrid.Table[s].Qty)))return"Enter Output product Qty at Row :"+(s+1).toString();e++}if(0==e&&!confirm("Output products not defined.\nDo you want to continue?"))return"Output products not defined.";for(let s=0;s<this.InputGrid.Table.length;s++)if(!r.e.IsEmpty(this.InputGrid.Table[s].ProductName_Key)&&parseInt(this.InputGrid.Table[s].ProductName_Key.toString())>0&&(""==r.e.String(this.InputGrid.Table[s].Qty)||0==parseFloat(r.e.String(this.InputGrid.Table[s].Qty))&&t))return"Enter Input product Qty at Row :"+(s+1).toString();for(let s=0;s<this.ExpenseGrid.Table.length;s++)if(r.e.IsEmpty(this.ExpenseGrid.Table[s].AccountName_Key))if(r.e.IsEmpty(this.ExpenseGrid.Table[s].Expense_Key))if(r.e.IsEmpty(this.ExpenseGrid.Table[s].Value))if(r.e.IsEmpty(this.ExpenseGrid.Table[s].Name));else{if(r.e.IsEmpty(this.ExpenseGrid.Table[s].AccountName_Key))return"Incomplete Expenses Information at Row :"+(s+1).toString();if(r.e.IsEmpty(this.ExpenseGrid.Table[s].Expense_Key))return"Incomplete Expenses Information at Row :"+(s+1).toString();if(r.e.IsEmpty(this.ExpenseGrid.Table[s].Value))return"Incomplete Expenses Information at Row :"+(s+1).toString()}else{if(r.e.IsEmpty(this.ExpenseGrid.Table[s].AccountName_Key))return"Incomplete Expenses Information at Row :"+(s+1).toString();if(r.e.IsEmpty(this.ExpenseGrid.Table[s].Expense_Key))return"Incomplete Expenses Information at Row :"+(s+1).toString();if(r.e.IsEmpty(this.ExpenseGrid.Table[s].Name))return"Incomplete Expenses Information at Row :"+(s+1).toString()}else{if(r.e.IsEmpty(this.ExpenseGrid.Table[s].AccountName_Key))return"Incomplete Expenses Information at Row :"+(s+1).toString();if(r.e.IsEmpty(this.ExpenseGrid.Table[s].Value))return"Incomplete Expenses Information at Row :"+(s+1).toString();if(r.e.IsEmpty(this.ExpenseGrid.Table[s].Name))return"Incomplete Expenses Information at Row :"+(s+1).toString()}else{if(r.e.IsEmpty(this.ExpenseGrid.Table[s].Expense_Key))return"Incomplete Expenses Information at Row :"+(s+1).toString();if(r.e.IsEmpty(this.ExpenseGrid.Table[s].Value))return"Incomplete Expenses Information at Row :"+(s+1).toString();if(r.e.IsEmpty(this.ExpenseGrid.Table[s].Name))return"Incomplete Expenses Information at Row :"+(s+1).toString()}return""}OnSaveBOM(e){var t;if("Save"==e.toString())try{let e="";if(this.DisplayMessage="",0==this.Stage.SelectedValue)return this.DisplayMessage="Please select stage",void(this.MessageVisibility=!0);if(this.TreeObject.BOMNodes.forEach(e=>{if(this.IsStageExists(this.Stage.SelectedValue,e))return this.DisplayMessage="Stage already exists",void(this.MessageVisibility=!0)}),this.StageNodeID!=this.Stage.SelectedValue){let e=s.a.common.GetCodeName(this.Stage.CCID,this.Stage.SelectedValue).Tables[0];null!=e&&e.length>0&&(this.Code=e[0].Code.toString(),this.Name=e[0].Name.toString())}if(e=this.ValidateGrids(),!r.e.IsEmpty(e))return this.DisplayMessage=e,void(this.MessageVisibility=!0);this.CancelVisible&&(null!=this.Parent?this.Parent.Childrens.push(this):this.TreeObject.BOMNodes.push(this)),this.TreeObject.RefreshBOMTree(),null==this.TreeObject.Tree.SelectedNode&&(this.TreeObject.Tree.SelectedNode=this.TreeObject.Tree[0]),(null===(t=this.TreeObject.Tree.treecomp)||void 0===t?void 0:t.angularGrid)&&(this.TreeObject.Tree.treecomp.gridObj.getData().setItems(this.TreeObject.Tree.Rows),this.TreeObject.Tree.treecomp.gridObj.getData().refresh(),this.TreeObject.Tree.treecomp.gridObj.invalidate()),s.a.page.HideDialog()}catch(i){Logger.ErrorLog("MultiBOMAddEditViewModel:: OnSAVE"+i.stack)}else if("Cancel"==e)s.a.page.HideDialog();else if("Pickrate"==e){if("AvgRate"==this.Pickrate.CheckedItem.DBColumnName){let e=new Array,t=0;s.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise AverageRate")&&r.e.Int(s.a.SessionManager.Preferences["Maintain Dimensionwise AverageRate"])>5e4&&(t=r.e.Int(s.a.SessionManager.Preferences["Maintain Dimensionwise AverageRate"]),e.push(t)),s.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&Object(n.j)(s.a.SessionManager.Preferences.EnableLocationWise)&&s.a.SessionManager.Preferences.ContainsKey("Location AverageRate")&&Object(n.j)(s.a.SessionManager.Preferences["Location AverageRate"])&&e.push(50002),s.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&Object(n.j)(s.a.SessionManager.Preferences.EnableDivisionWise)&&s.a.SessionManager.Preferences.ContainsKey("Division AverageRate")&&Object(n.j)(s.a.SessionManager.Preferences["Division AverageRate"])&&e.push(50001);let i="";i+="<PXML>";let a="";null!=this.TreeObject.Location&&this.TreeObject.Location.SelectedValue>0&&e.Contains(50002)&&(a+=" and dcCCNID2="+this.TreeObject.Location.SelectedValue.toString()+" "),null!=this.TreeObject.Division&&this.TreeObject.Division.SelectedValue>0&&e.Contains(50001)&&(a+=" and dcCCNID1="+this.TreeObject.Division.SelectedValue.toString()+" ");for(let s=0;s<this.InputGrid.Table.length;s++)if(!r.e.IsEmpty(this.InputGrid.Table[s].ProductName_Key)){let e="",t=1;t=r.e.Double(this.InputGrid.Table[s].Qty),0==t&&(t=1),i+="<Row ",i+=' ProductID="'+this.InputGrid.Table[s].ProductName_Key.toString()+'" ',i+=' QTY="'+t+'" ',i+=' DETAILSID="0" ',i+=' avgwhere="'+e+a+'" ></Row> '}i+="</PXML>";let o=this.ScreenObject.GetReconcileAvgRate(i.toString(),new Date);if(null!=o&&o.Tables.length>0&&o.Columns[0].Contains("invid"))for(let s=0;s<this.InputGrid.Table.length;s++)if(!r.e.IsEmpty(this.InputGrid.Table[s].ProductName_Key)){let e=o.Tables[0].filter(e=>e.PID==this.InputGrid.Table[s].ProductName_Key.toString());e.length>0&&(this.InputGrid.Table[s].UnitPrice=r.e.IsEmpty(e[0].AvgRate)?0:r.e.String(e[0].AvgRate),this.CalculateTotals(this.InputGrid.Table[s]),this.InputGrid.updateRow(this.InputGrid.Table[s]))}}else{let e="<XML>",t="";null!=this.TreeObject.Location&&this.TreeObject.Location.SelectedValue>0&&(e+='<Row CostCenterID="50002" NODEID="'+this.TreeObject.Location.SelectedValue.toString()+'" />'),null!=this.TreeObject.Division&&this.TreeObject.Division.SelectedValue>0&&(e+='<Row CostCenterID="50001" NODEID="'+this.TreeObject.Division.SelectedValue.toString()+'" />'),e+="</XML>";for(let s=0;s<this.InputGrid.Table.length;s++)r.e.IsEmpty(this.InputGrid.Table[s].ProductName_Key)||(t+=this.InputGrid.Table[s].ProductName_Key.toString()+",");t.length>1&&(t=t.substr(0,t.length-1));let i=this.ScreenObject.GetProductDetails(t,e);if(null!=i&&i.Tables.length>0&&i.Columns[0].Contains("ProductID")){let e="PurchaseRate",t=null;for(let s=0;s<this.InputGrid.Table.length;s++)r.e.IsEmpty(this.InputGrid.Table[s].ProductName_Key)||(t=null,"Master"==this.Pickrate.CheckedItem.DBColumnName?i.Tables.length>0&&i.Tables[0].filter(e=>e.ProductID==this.InputGrid.Table[s].ProductName_Key.toString()).length>0&&(t=i.Tables[0].filter(e=>e.ProductID==this.InputGrid.Table[s].ProductName_Key.toString())):"Chart"==this.Pickrate.CheckedItem.DBColumnName&&(i.Tables.length>1&&i.Tables[1].filter(e=>e.ProductID==this.InputGrid.Table[s].ProductName_Key.toString()).length>0?t=i.Tables[1].filter(e=>e.ProductID==this.InputGrid.Table[s].ProductName_Key.toString()):i.Tables.length>2&&i.Tables[2].filter(e=>e.ProductID==this.InputGrid.Table[s].ProductName_Key.toString()).length>0&&(t=i.Tables[2].filter(e=>e.ProductID==this.InputGrid.Table[s].ProductName_Key.toString()))),""!=e&&(this.InputGrid.Table[s].UnitPrice=null!=t&&t.length>0&&!r.e.IsEmpty(t[0][e])?r.e.String(t[0][e]):0,this.CalculateTotals(this.InputGrid.Table[s]),this.InputGrid.updateRow(this.InputGrid.Table[s])))}}if(this.TreeObject.CalcOutputProductRate)for(let e=0;e<this.OutputGrid.Table.length;e++)if(!r.e.IsEmpty(this.OutputGrid.Table[e].ProductName_Key)&&parseInt(this.OutputGrid.Table[e].ProductName_Key.toString())>0){this.OutputGrid.Table[e].Value=parseInt(this.OutputGrid.Table[e].ProductName_Key.toString())==this.TreeObject.Product.SelectedValue?this.CalcValue(!0):this.CalcValue(!1),this.CalculateTotals(this.OutputGrid.Table[e]),this.OutputGrid.updateRow(this.OutputGrid.Table[e]);break}}}IsStageExists(e,t){if(t!=this&&t.Stage.SelectedValue==e)return!0;if(t.Childrens.length>0)for(let i=0;i<t.Childrens.length;i++)if(this.IsStageExists(e,t.Childrens[i]))return!0;return!1}UpdateSequence(){this.SNo=1,this.InputGrid.Table.forEach(e=>{e.Sno=this.SNo++}),this.SNo=1,this.OutputGrid.Table.forEach(e=>{e.Sno=this.SNo++}),this.SNo=1,this.ExpenseGrid.Table.forEach(e=>{e.Sno=this.SNo++}),this.SNo=1,this.ResourcesGrid.Table.forEach(e=>{e.Sno=this.SNo++}),this.InputGrid.refreshDataView(),this.OutputGrid.refreshDataView(),this.ExpenseGrid.refreshDataView(),this.ResourcesGrid.refreshDataView()}CalculateFooter(e){let t,i=0,a=0,n="2";if(s.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&!r.e.IsEmpty(s.a.SessionManager.Preferences.DecimalsinRate)&&(n=s.a.SessionManager.Preferences.DecimalsinRate),this.ExpenseYes){for(let e=0;e<this.ExpenseGrid.Table.length;e++)r.e.IsEmpty(this.ExpenseGrid.Table[e].Value)||r.e.IsEmpty(this.ExpenseGrid.Table[e].AccountName_Key)||r.e.IsEmpty(this.ExpenseGrid.Table[e].Expense_Key)||(i+=parseFloat(this.ExpenseGrid.Table[e].Value.toString()));t=this.ExpenseGrid.Columns.find(e=>"Value"==e.DisplayMember),null!=t&&(t.footer=i.ToString("N"+n))}else if(this.InputYes){for(let e=0;e<this.InputGrid.Table.length;e++)r.e.IsEmpty(this.InputGrid.Table[e].ProductName_Key)||(r.e.IsEmpty(this.InputGrid.Table[e].Qty)||(a+=parseFloat(this.InputGrid.Table[e].Qty.toString())),r.e.IsEmpty(this.InputGrid.Table[e].Value)||(i+=parseFloat(this.InputGrid.Table[e].Value.toString())));t=this.InputGrid.Columns.find(e=>"Value"==e.DisplayMember),null!=t&&(t.footer=i.ToString("N"+n)),t=this.InputGrid.Columns.find(e=>"Qty"==e.DisplayMember),null!=t&&(t.footer=a.ToString("N"+n))}else if(this.ResourceYes){for(let e=0;e<this.ResourcesGrid.Table.length;e++)r.e.IsEmpty(this.ResourcesGrid.Table[e].Value)||r.e.IsEmpty(this.ResourcesGrid.Table[e].Machine_Key)||(i+=parseFloat(this.ResourcesGrid.Table[e].Value.toString()));t=this.ResourcesGrid.Columns.find(e=>"Value"==e.DisplayMember),null!=t&&(t.footer=i.ToString("N"+n))}else if(this.OutputYes){for(let e=0;e<this.OutputGrid.Table.length;e++)r.e.IsEmpty(this.OutputGrid.Table[e].ProductName_Key)||(r.e.IsEmpty(this.OutputGrid.Table[e].Qty)||(a+=parseFloat(this.OutputGrid.Table[e].Qty.toString())),r.e.IsEmpty(this.OutputGrid.Table[e].Value)||(i+=parseFloat(this.OutputGrid.Table[e].Value.toString())));t=this.OutputGrid.Columns.find(e=>"Value"==e.DisplayMember),null!=t&&(t.footer=i.ToString("N"+n)),t=this.OutputGrid.Columns.find(e=>"Qty"==e.DisplayMember),null!=t&&(t.footer=a.ToString("N"+n))}this.InputGrid.UpdateFooter(),this.ExpenseGrid.UpdateFooter(),this.ResourcesGrid.UpdateFooter(),this.OutputGrid.UpdateFooter()}changeVal(){this.InputYes=!1,this.OutputYes=!1,this.ExpenseYes=!1,this.ResourceYes=!1}FindRow(e){let t=this.InputGrid.Table.find(t=>t==e);t?(this.changeVal(),this.InputYes=!0):(t=this.OutputGrid.Table.find(t=>t==e),t?(this.changeVal(),this.OutputYes=!0):(t=this.ExpenseGrid.Table.find(t=>t==e),t?(this.changeVal(),this.ExpenseYes=!0):(t=this.ResourcesGrid.Table.find(t=>t==e),t&&(this.changeVal(),this.ResourceYes=!0))))}OnCellEditEnding(e){if("DataGridComboBoxColumn"==e.column.className)return;let t=e.item,i=e.column.field;if(this.FindRow(t),Object.keys(t).Contains("Machine_Key")){if("Machine"==i&&!r.e.IsEmpty(t.Machine_Key)){if(this.MachineID==parseInt(t.Machine_Key.toString()))return;if(t.Value=this.objBOM.getMachineCostHr(this.MachineCCID,parseInt(t.Machine_Key)),""==r.e.String(t.Options)){let e=this.ResourcesGrid.Table.indexOf(t);e>0&&!r.e.IsEmpty(this.ResourcesGrid.Table[e-1].Options)&&(t.Options=this.ResourcesGrid.Table[e-1].Options),this.ResourcesGrid.updateRow(t)}}}else if(this.InputYes||this.OutputYes){if(("ProductCode"==i||"ProductName"==i)&&!r.e.IsEmpty(t.ProductName_Key)&&t.ProductName_Key.toString()!=this.PrevValue){let e=0;Object.keys(t).Contains("UOM")&&"UOM"==i&&!r.e.IsEmpty(t.UOM_Key)&&(e=parseInt(t.UOM_Key.toString()));let s=!1;"AvgRate"!=this.Pickrate.CheckedItem.DBColumnName||this.OutputYes||(s=!0);let a=o.a.GetProductTypeDetails(parseInt(t.ProductName_Key.toString()),this.Date.Date,e,76,"",s,!1,!1,!1,!1,!1,!1,!1,!1);""==r.e.String(t.Qty)&&(t.Qty="1"),a.Tables.length>0&&a.Columns[0].Contains("uomid")&&!r.e.IsEmpty(a.Tables[0][0].uomid)&&(t.UOM=a.Tables[0][0].UnitName.toString(),t.UOM_Key=a.Tables[0][0].uomid.toString(),this.InputGrid.Table==t.Table&&("AvgRate"==this.Pickrate.CheckedItem.DBColumnName&&a.Columns[0].Contains("AvgRate")&&!r.e.IsEmpty(a.Tables[0][0].AvgRate)&&(t.UnitPrice=a.Tables[0][0].AvgRate.toString()),"Master"==this.Pickrate.CheckedItem.DBColumnName&&a.Tables.length>0&&a.Tables[0].length>0&&a.Columns[0].Contains("PurchaseRate")&&!r.e.IsEmpty(a.Tables[0][0].PurchaseRate)&&(t.UnitPrice=a.Tables[0][0].PurchaseRate.toString()),"Chart"==this.Pickrate.CheckedItem.DBColumnName&&a.Tables.length>3&&a.Tables[3].length>0&&a.Columns[3].Contains("PurchaseRate")&&!r.e.IsEmpty(a.Tables[3][0].PurchaseRate)&&(t.UnitPrice=a.Tables[3][0].PurchaseRate.toString())))}this.CalculateTotals(t),this.InputYes?this.InputGrid.updateRow(t):this.OutputYes&&this.OutputGrid.updateRow(t)}if(this.TreeObject.CalcOutputProductRate)for(let s=0;s<this.OutputGrid.Table.length;s++)if(!r.e.IsEmpty(this.OutputGrid.Table[s].ProductName_Key)&&parseInt(this.OutputGrid.Table[s].ProductName_Key.toString())>0){this.OutputGrid.Table[s].Value=parseInt(this.OutputGrid.Table[s].ProductName_Key.toString())==this.TreeObject.Product.SelectedValue?this.CalcValue(!0):this.CalcValue(!1),this.CalculateTotals(this.OutputGrid.Table[s]),this.OutputGrid.updateRow(this.OutputGrid.Table[s]);break}this.CalculateFooter(t.Table)}CalcValue(e){let t=0,i=0;for(let s=0;s<this.InputGrid.Table.length;s++)!r.e.IsEmpty(this.InputGrid.Table[s].ProductName_Key)&&parseInt(this.InputGrid.Table[s].ProductName_Key.toString())>0&&!r.e.IsEmpty(this.InputGrid.Table[s].Value)&&("1"==r.e.String(this.InputGrid.Table[s].IncludeinFinal)&&(t+=parseFloat(this.InputGrid.Table[s].Value.toString())),"1"==r.e.String(this.InputGrid.Table[s].IncludeinStage)&&(i+=parseFloat(this.InputGrid.Table[s].Value.toString())));for(let s=0;s<this.ExpenseGrid.Table.length;s++)r.e.IsEmpty(this.ExpenseGrid.Table[s].AccountName_Key)||r.e.IsEmpty(this.ExpenseGrid.Table[s].Expense_Key)||r.e.IsEmpty(this.ExpenseGrid.Table[s].Value)||("1"==r.e.String(this.ExpenseGrid.Table[s].IncludeinFinal)&&(t+=parseFloat(this.ExpenseGrid.Table[s].Value.toString())),"1"==r.e.String(this.ExpenseGrid.Table[s].IncludeinStage)&&(i+=parseFloat(this.ExpenseGrid.Table[s].Value.toString())));for(let s=0;s<this.ResourcesGrid.Table.length;s++)r.e.IsEmpty(this.ResourcesGrid.Table[s].Machine_Key)||r.e.IsEmpty(this.ResourcesGrid.Table[s].Value)||r.e.IsEmpty(this.ResourcesGrid.Table[s].Hrs)||("1"==r.e.String(this.ResourcesGrid.Table[s].IncludeinFinal)&&(t+=parseFloat(this.ResourcesGrid.Table[s].Value.toString())*parseFloat(this.ResourcesGrid.Table[s].Hrs.toString())),"1"==r.e.String(this.ResourcesGrid.Table[s].IncludeinStage)&&(i+=parseFloat(this.ResourcesGrid.Table[s].Value.toString())*parseFloat(this.ResourcesGrid.Table[s].Hrs.toString())));if(e){for(let e=0;e<this.TreeObject.BOMNodes.length;e++){const i=this.TreeObject.BOMNodes[e];if(i!=this){for(let e=0;e<i.InputGrid.Table.length;e++)!r.e.IsEmpty(i.InputGrid.Table[e].ProductName_Key)&&parseInt(i.InputGrid.Table[e].ProductName_Key.toString())>0&&!r.e.IsEmpty(i.InputGrid.Table[e].Value)&&"1"==r.e.String(i.InputGrid.Table[e].IncludeinFinal)&&(t+=parseFloat(i.InputGrid.Table[e].Value.toString()));for(let e=0;e<i.ExpenseGrid.Table.length;e++)r.e.IsEmpty(i.ExpenseGrid.Table[e].AccountName_Key)||r.e.IsEmpty(i.ExpenseGrid.Table[e].Expense_Key)||r.e.IsEmpty(i.ExpenseGrid.Table[e].Value)||"1"==r.e.String(i.ExpenseGrid.Table[e].IncludeinFinal)&&(t+=parseFloat(i.ExpenseGrid.Table[e].Value.toString()));for(let e=0;e<i.ResourcesGrid.Table.length;e++)r.e.IsEmpty(i.ResourcesGrid.Table[e].Machine_Key)||r.e.IsEmpty(i.ResourcesGrid.Table[e].Value)||r.e.IsEmpty(i.ResourcesGrid.Table[e].Hrs)||"1"==r.e.String(i.ResourcesGrid.Table[e].IncludeinFinal)&&(t+=parseFloat(i.ResourcesGrid.Table[e].Value.toString())*parseFloat(i.ResourcesGrid.Table[e].Hrs.toString()))}}return t.toString()}return i.toString()}CalculateTotals(e){let t=new S.a,i=new D.c;i.setFieldDetails("RATE",1,1,"",1,!1,!1),t.push("RATE",i),i=new D.c,i.setFieldDetails("QTY",4,1,"",1,!1,!1),t.push("QTY",i),i=new D.c,i.setFieldDetails("Value",4,1,"",1,!1,!1),t.push("Value",i),r.e.IsEmpty(e.UnitPrice)?t.RATE.setFieldValue(0):t.RATE.setFieldValue(e.UnitPrice),r.e.IsEmpty(e.Qty)?t.QTY.setFieldValue(0):t.QTY.setFieldValue(e.Qty),r.e.IsEmpty(e.Value)?t.Value.setFieldValue(0):t.Value.setFieldValue(e.Value);let a=t;this.OutputGrid.Table.find(t=>t==e)&&this.TreeObject.CalcOutputProductRate?e.UnitPrice=s.a.eval.EvaluateExpression("Value/QTY",a).toString():e.Value=s.a.eval.EvaluateExpression("QTY*RATE",a).toString()}onBeginEdit(e){let t=e.args.item,i=e.args.column,s=i.DgCol;if(r.e.IsEmpty(s.ValueBinding),r.e.IsEmpty(s.ValueBinding),Object.keys(t).Contains("Machine_Key"))this.MachineID=r.e.IsEmpty(t.Machine_Key)?0:parseInt(t.Machine_Key.toString());else{let s=e.args;if("DataGridPactListBoxColumn"==i.className){let e=s.model;if(11==e.CostCenterID){let i="";Object.keys(t).Contains("ProductName_Key")&&(i=t.ProductName_Key.toString());let s=" (BaseID IN ";s+=" (SELECT     BaseID ",s+=" FROM          COM_UOM AS COM_UOM_1 with(nolock) ",s=s+" WHERE      (UOMID =(select UOMID from inv_product with(nolock) where productid="+i+") ))) ",""==i&&(s=" (BaseID IN ",s+=" (SELECT BaseID ",s+=" FROM COM_UOM AS COM_UOM_1 with(nolock) ",s+=" WHERE (UOMID =-1 ))) "),e.FilterCondition=s}else e.CostCenterID==this.Stage.CCID&&(e.FilterCondition="a.NodeID in(-1",null!=this.Parent?this.Parent.Childrens.forEach(i=>{i!=this&&i.Stage.SelectedValue>0&&!r.e.IsEmpty(t.ProductName_Key)&&i.OutputGrid.Table.filter(e=>e.ProductName_Key==t.ProductName_Key.toString()).length>0&&(e.FilterCondition+=","+i.Stage.SelectedValue)}):this.TreeObject.BOMNodes.forEach(i=>{i!=this&&i.Stage.SelectedValue>0&&!r.e.IsEmpty(t.ProductName_Key)&&i.OutputGrid.Table.filter(e=>e.ProductName_Key==t.ProductName_Key.toString()).length>0&&(e.FilterCondition+=","+i.Stage.SelectedValue)}),e.FilterCondition+=")");3==e.CostCenterID&&"ProductName_Key"==e.SelectedValueBinding&&(this.PrevValue=r.e.String(t.ProductName_Key)),3==e.CostCenterID&&"ProductName_Key"==e.SelectedValueBinding&&this.FilterCCID>0&&Object.keys(t).Contains("FilterOn_Key")&&!r.e.IsEmpty(t.FilterOn_Key)&&parseInt(t.FilterOn_Key.toString())>0&&(3==this.FilterCCID?e.Where=" ParentID="+t.FilterOn_Key.toString()+" ":50006==this.FilterCCID?e.Where=" CategoryID="+t.FilterOn_Key.toString()+" ":50004==this.FilterCCID?e.Where=" DepartmentID="+t.FilterOn_Key.toString()+" ":this.FilterCCID>5e4&&(e.Where=" a.ProductID IN (select NodeID from COM_CCCCData with(nolock) where CostCenterID=3 and ",e.Where+=" CCNID"+this.FilterCCID.toString()+"="+t.FilterOn_Key.toString()+" )"))}}}OnCustomizeExtraFields(e){}LoadBOM(e){let t;this.InputGrid.Table.Clear(),this.ExpenseGrid.Table.Clear(),this.ResourcesGrid.Table.Clear(),this.OutputGrid.Table.Clear(),t=e.Tables[1],t=t.filter(e=>e.StageID==this.StageID),t.forEach(e=>{let t=this.InputGrid.NewRow();t.ProductCode=e.ProductCOde.toString(),t.ProductName=e.ProductName.toString(),t.ProductName_Key=e.ProductID.toString(),t.Qty=e.Quantity.toString(),Object.keys(e).Contains("UOM")&&(t.UOM=e.UOM.toString()),t.UOM_Key=e.UOMID.toString(),t.UnitPrice=e.UnitPrice.toString(),t.Wastage=e.Wastage.toString(),t.Value=e.Value.toString(),t.BOMProductID=e.BOMProductID.toString(),t.IncludeinFinal=!r.e.IsEmpty(e.IncInFinalCost)&&Object(n.j)(e.IncInFinalCost.toString())?"1":"0",t.IncludeinStage=!r.e.IsEmpty(e.IncInStageCost)&&Object(n.j)(e.IncInStageCost.toString())?"1":"0",this.InputGrid.TableColumns.Contains("FilterOn_Key")&&!r.e.IsEmpty(e.FilterOn)&&(t.FilterOn_Key=e.FilterOn.toString()),this.InputGrid.TableColumns.Contains("Stage_Key")&&!r.e.IsEmpty(e.AutoStage)&&(t.Stage_Key=e.AutoStage.toString()),t.Remarks=e.Remarks.toString(),this.InputGrid.addRow(t)}),this.changeVal(),this.InputYes=!0,this.CalculateFooter(this.InputGrid.Table),t=e.Tables[2],t=t.filter(e=>e.StageID==this.StageID),t.forEach(e=>{let t=this.ExpenseGrid.NewRow();t.Name=e.Name.toString(),t.AccountName=e.CRAccountName.toString(),r.e.IsEmpty(e.CreditAccountID)||(t.AccountName_Key=e.CreditAccountID.toString()),t.Expense=e.DRAccountName.toString(),r.e.IsEmpty(e.DebitAccountID)||(t.Expense_Key=e.DebitAccountID.toString()),t.Value=e.Value.toString(),t.ExpenseID=e.ExpenseID.toString(),t.IncludeinFinal=!r.e.IsEmpty(e.IncInFinalCost)&&Object(n.j)(e.IncInFinalCost.toString())?"1":"0",t.IncludeinStage=!r.e.IsEmpty(e.IncInStageCost)&&Object(n.j)(e.IncInStageCost.toString())?"1":"0",this.ExpenseGrid.addRow(t)}),this.changeVal(),this.ExpenseYes=!0,this.CalculateFooter(this.ExpenseGrid.Table),t=e.Tables[3],t=t.filter(e=>e.StageID==this.StageID),t.forEach(e=>{let t=this.ResourcesGrid.NewRow();t.Machine=e.ResourceName.toString(),t.Machine_Key=e.ResourceID.toString(),t.Hrs=e.Hours.toString(),t.Value=e.Value.toString(),t.BOMResourceID=e.BOMResourceID.toString(),this.ResourcesGrid.TableColumns.Contains("MachineDim1_Key")&&!r.e.IsEmpty(e.MachineDim1)&&(t.MachineDim1_Key=e.MachineDim1.toString()),this.ResourcesGrid.TableColumns.Contains("MachineDim2_Key")&&!r.e.IsEmpty(e.MachineDim2)&&(t.MachineDim2_Key=e.MachineDim2.toString()),this.ResourcesGrid.TableColumns.Contains("Options")&&r.e.IsEmpty(e.Options)&&(t.Options=e.Options.toString()),t.IncludeinFinal=!r.e.IsEmpty(e.IncInFinalCost)&&Object(n.j)(e.IncInFinalCost.toString())?"1":"0",t.IncludeinStage=!r.e.IsEmpty(e.IncInStageCost)&&Object(n.j)(e.IncInStageCost.toString())?"1":"0",this.ResourcesGrid.addRow(t)}),this.changeVal(),this.ResourceYes=!0,this.CalculateFooter(this.ResourcesGrid.Table),t=e.Tables[5],t=t.filter(e=>e.StageID==this.StageID),t.forEach(e=>{let t=this.OutputGrid.NewRow();t.ProductCode=e.ProductCode.toString(),t.ProductName=e.ProductName.toString(),t.ProductName_Key=e.ProductID.toString(),t.Qty=e.Quantity.toString(),t.UnitPrice=e.UnitPrice.toString(),t.Value=e.Value.toString(),Object.keys(e).Contains("UnitName")&&(t.UOM=r.e.String(e.UnitName)),r.e.IsEmpty(e.UOMID)||(t.UOM_Key=e.UOMID.toString()),t.BOMProductID=r.e.String(e.BOMProductID),this.OutputGrid.addRow(t)}),this.changeVal(),this.OutputYes=!0,this.CalculateFooter(this.OutputGrid.Table),this.FillEmptyRows(),this.InputGrid.RefreshGrid=this.ExpenseGrid.RefreshGrid=this.ResourcesGrid.RefreshGrid=this.OutputGrid.RefreshGrid=!0}}var R=i("LI34");class V extends l.b{constructor(e,t){super(),this.BID=0,this.parentid=0,this.iCntBOM=-1,this.objBOM=new T,this._ScreenObject=new o.a,this.Title="",this.Packing=new d.d(27305),this.txtCode=new d.d(555025),this.txtName=new d.d(555026),this.txtCost=new d.d(0),this.txtUsage=new d.d(0),this.txtCapacity=new d.d(0),this.txtEffeciency=new d.d(0),this.Description=new d.d(23903),this.MStatus=new h.e(23898),this.Group=new h.e(23897),this.Location=new c.b(23900),this.Division=new c.b(23901),this.Product=new c.b(23899),this.UOM=new h.e(109),this.FPQty=new d.d(27269),this.Date=new p.a(23902),this.txtDesc=new d.d(23903),this.MoveSelectedBomStageVisibility=!1,this.brush="Red",this.TreeFlds=null,this.BOMNodes=new Array,this.CalcOutputProductRate=!1,this.IsMultiBom=!0,this.ButtonSave=new u.a,Logger.InfoLog("MultiBOMTreeViewModel::Entering MultiBOMTreeViewModel "),this.parentid=t,this.BID=e,this.MessageVisibility=!1,this._ScreenObject.LoadScreen_2(this,76),this.Product.SelectionChangedCommand.Subscribe(this,"OnProductChange"),0==e?s.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=s.a.SessionManager.IsActionAssigned(76,"Create"):this.ButtonSave.Enable=s.a.SessionManager.IsActionAssigned(76,"Create"):(this.ScreenObject.IsEdit=!0,s.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=s.a.SessionManager.IsActionAssigned(76,"Update"):this.ButtonSave.Enable=s.a.SessionManager.IsActionAssigned(76,"Update"));let i=this.ScreenObject.StaticFields.find(e=>23899==e.DBColumnID);null!=i?(this.Product.CCID=i.CCID,this.Product.TypeID=i.TypeID,0==this.Product.CCID&&(this.Product.CCID=3),0==this.Product.TypeID&&(this.Product.TypeID=10)):(this.Product.CCID=3,this.Product.TypeID=10),this._ScreenObject.Data.Tables[3].forEach(e=>{this.MStatus.Items.push(h.d.ComboBoxItems_2(e[Object.keys(e)[1]].toString(),e[Object.keys(e)[0]].toString()))}),"1"!=s.a.SessionManager.RoleID&&s.a.SessionManager.IsActionAssigned(76,"Save as UnApproved")&&(this.MStatus.SelectedValue="464",this.MStatus.Visible=!1),this.FPQty.Text="1";let a=this.ScreenObject.Data.Tables[4].filter(e=>"CapsLock"==e.Name);a.length>0&&Object(n.j)(a[0].Value)&&(this.txtName.IsAllCaps=!0),a=this.ScreenObject.Data.Tables[4].filter(e=>"CapsToFirstLetter"==e.Name),a.length>0&&Object(n.j)(a[0].Value)&&(this.txtName.IsFirstLetterCaps=!0),a=this.ScreenObject.Data.Tables[4].filter(e=>"CalcOutputProductRate"==e.Name),a.length>0&&Object(n.j)(a[0].Value)&&(this.CalcOutputProductRate=!0),a=this.ScreenObject.Data.Tables[4].filter(e=>"BomTreeFields"==e.Name),a.length>0&&!r.e.IsEmpty(a[0].Value)&&(this.TreeFlds=a[0].Value.toString().split(",")),this.InitTree(),this.BOMTreeControl=new y,this.BOMTreeControl.Tree=this.Tree,this.BOMTreeControl.Parent=this,this.BOMTreeControl.Tree.ClassName="TreeViewModel",this.loadtabs(),this.BID>0?(this.OnLoad(this.BID),this.Title=s.a.GetResource("BOM_EditBOM")):(this.Title=s.a.GetResource("BOM_AddBOM"),this.objBOM.GUID="GUID",this.AutoGenerateCode()),this.DisplayName=this.Title,this.Group.SelectedValue=this.parentid.toString(),null==this.BOMTreeControl.Tree.SelectedNode&&(this.BOMTreeControl.Tree.SelectedNode=this.BOMTreeControl.Tree.Rows[0])}get ScreenObject(){return this._ScreenObject}OnNodeSelected(e){var t,i;null!=this.SelectedNodeObj&&(null===(t=this.BOMTreeControl.Tree.SelectedNode)||void 0===t?void 0:t.Tag)==this.SelectedNodeObj||(null!=this.SelectedNodeObj&&(null===(i=s.a.page.ActiveTab.grids)||void 0===i?void 0:i.length)>0&&(s.a.page.ActiveTab.grids.Remove(this.SelectedNodeObj.InputGrid),s.a.page.ActiveTab.grids.Remove(this.SelectedNodeObj.ExpenseGrid),s.a.page.ActiveTab.grids.Remove(this.SelectedNodeObj.ResourcesGrid),s.a.page.ActiveTab.grids.Remove(this.SelectedNodeObj.OutputGrid)),this.SelectedNodeObj=null,setTimeout(()=>{var e;this.SelectedNodeObj=null===(e=this.BOMTreeControl.Tree.SelectedNode)||void 0===e?void 0:e.Tag},5))}AssignRowColumns(){let e;e=this._ScreenObject.CustomFields.length;for(let t=0;t<e;t++)this._ScreenObject.CustomFields[t].Row=t/4,this._ScreenObject.CustomFields[t].Column=t%4}loadtabs(){this.AssignRowColumns();let e=null,t=null,i=null,s=null,a=null;for(let r=this._ScreenObject.CustomTab.Pages.length-1;r>=0;r--){let n=this._ScreenObject.CustomTab.Pages[r];switch(n.Name){case"Production Method":a=n;break;case"Raw Materials":e=n;break;case"Expenses":t=n;break;case"Machines":i=n;break;case"Other Outputs":s=n;break;case"Stages":n.Fields.push(this.BOMTreeControl.Tree)}}this.ScreenObject.CustomTab.Pages.Remove(e),this.ScreenObject.CustomTab.Pages.Remove(a),this.ScreenObject.CustomTab.Pages.Remove(t),this.ScreenObject.CustomTab.Pages.Remove(i),this.ScreenObject.CustomTab.Pages.Remove(s)}InitTree(){this.Tree=new M.a,this.Tree.ColumnsSource=new Array;let e="STRING";if(null!=this.TreeFlds){let t=1;if(this.TreeFlds.Contains("ProductCode")&&this.TreeFlds.Contains("ProductName")){let t=new G.a;t.DataType=e,t.HeaderText="Code-Name",t.DisplayMember="Text[0]",t.DisplayIndex="0",t.width="240",this.Tree.ColumnsSource.push(t)}else if(this.TreeFlds.Contains("ProductCode")){let t=new G.a;t.DataType=e,t.HeaderText="Code",t.DisplayMember="Text[0]",t.DisplayIndex="0",t.width="120",this.Tree.ColumnsSource.push(t)}else{let t=new G.a;t.DataType=e,t.HeaderText="Name",t.DisplayMember="Text[0]",t.DisplayIndex="0",t.width="120",this.Tree.ColumnsSource.push(t)}let i=0;if(this.TreeFlds.Contains("Qty")||this.TreeFlds.Contains("Hrs")){let s=new G.a;s.DataType=e,s.HeaderText="Qty/Hrs",i=t++,s.DisplayMember="Text["+i+"]",s.DisplayIndex=i.toString(),s.width="120",this.Tree.ColumnsSource.push(s)}if(this.TreeFlds.Contains("UOM")||this.TreeFlds.Contains("Debit")){let s=new G.a;s.DataType=e,s.HeaderText="UOM/Debit",i=t++,s.DisplayMember="Text["+i+"]",s.DisplayIndex=i.toString(),s.width="120",this.Tree.ColumnsSource.push(s)}if(this.TreeFlds.Contains("UnitPrice")||this.TreeFlds.Contains("Credit")){let s=new G.a;s.DataType=e,s.HeaderText="UnitPrice/Credit",i=t++,s.DisplayMember="Text["+i+"]",s.DisplayIndex=i.toString(),s.width="120",this.Tree.ColumnsSource.push(s)}if(this.TreeFlds.Contains("Value")){let s=new G.a;s.DataType=e,s.HeaderText="Value",i=t++,s.DisplayMember="Text["+i+"]",s.DisplayIndex=i.toString(),s.width="120",this.Tree.ColumnsSource.push(s)}if(this.TreeFlds.Contains("IncludeinFinal")){let s=new G.a;s.DataType=e,s.HeaderText="Incl. in Final Cost",i=t++,s.DisplayMember="Text["+i+"]",s.DisplayIndex=i.toString(),s.width="120",this.Tree.ColumnsSource.push(s)}if(this.TreeFlds.Contains("IncludeinStage")){let s=new G.a;s.DataType=e,s.HeaderText="Incl. in Stage Cost",i=t++,s.DisplayMember="Text["+i+"]",s.DisplayIndex=i.toString(),s.width="120",this.Tree.ColumnsSource.push(s)}}else{let t=new G.a;t.DataType=e,t.HeaderText="Code",t.DisplayMember="Text[0]",t.DisplayIndex="0",t.width="380",this.Tree.ColumnsSource.push(t),t=new G.a,t.DataType=e,t.HeaderText="Name",t.DisplayMember="Text[0]",t.DisplayIndex="1",t.width="420",this.Tree.ColumnsSource.push(t)}this.Tree.Rows=[],this.Tree.AllNodes=new Array,this.Tree.Root=new B.a,this.Tree.Root.Tree=this.Tree,this.Tree.Root.Children=(new B.a.NodeCollection).NodeCollection_1(this.Tree.Root),this.Tree.Root.Nodes=this.Tree.Root.Children,this.Tree.lstParents=new Array;let t=new B.a;t.IsGroup=!0,t.LevelNo=0,t.Tree=this.Tree,t.Children=(new B.a.NodeCollection).NodeCollection_1(t),t.Nodes=t.Children,t.IsExpandedOnce=!0,t.AssignIsExpanded(!0),t.Text.push("All Stages"),t.Text.push(""),t.Id=1,t.id=1,t.CallPropertyChange(),this.Tree.Rows.push(t),this.Tree.Root.Children.push(t),this.Tree.BtnSelectionVisibility=!0}AutoGenerateCode(){this.objBOM.GetBOMDetails(this.BID);let e=s.a.common.GetAutoSequence(76,"","76",s.a.SessionManager.CompanyIndex.toString()),t=this.ScreenObject.Data.Tables[4].filter(e=>"CodeAutoGen"==e.Name);t.length>0&&(Object(n.j)(t[0].Value)?(this.txtCode.Enable=!1,this.txtCode.Mandatory=!1,0==this.BID&&(this.txtCode.Text=e)):this.txtCode.Enable=!0),t=this.ScreenObject.Data.Tables[4].filter(e=>"CapsLock"==e.Name),t.length>0&&Object(n.j)(t[0].Value)&&(this.txtName.IsAllCaps=!0),t=this.ScreenObject.Data.Tables[4].filter(e=>"CapsToFirstLetter"==e.Name),t.length>0&&Object(n.j)(t[0].Value)&&(this.txtName.IsFirstLetterCaps=!0)}OnLoad(e){let t=this.objBOM.GetBOMDetails(e);t.Tables[0].length>0&&(this.txtCode.Text=r.e.String(t.Tables[0][0].BOMCode),this.txtName.Text=r.e.String(t.Tables[0][0].BOMName),this.Group.SelectedValue=r.e.String(t.Tables[0][0].ParentID),this.MStatus.SelectedValue=r.e.String(t.Tables[0][0].StatusID),this.txtDesc.Text=r.e.String(t.Tables[0][0].Description),r.e.IsEmpty(t.Tables[0][0].ProductID)||(this.Product.SelectedValue=parseInt(t.Tables[0][0].ProductID.toString())),r.e.IsEmpty(t.Tables[0][0].LocationID)||(this.Location.SelectedValue=parseInt(t.Tables[0][0].LocationID.toString())),r.e.IsEmpty(t.Tables[0][0].DivisionID)||(this.Division.SelectedValue=parseInt(t.Tables[0][0].DivisionID.toString())),r.e.IsEmpty(t.Tables[0][0].Date)||(this.Date.Date=new Date(t.Tables[0][0].Date.toString())),this.FPQty.Text=r.e.String(t.Tables[0][0].FPQty),this.OnProductChange(null),this.UOM.SelectedValue=r.e.String(t.Tables[0][0].UOMID),t.Columns[0].Contains("Packing")&&(this.Packing.Text=r.e.String(t.Tables[0][0].Packing)),this.objBOM.GUID=r.e.String(t.Tables[0][0].GUID)),this.ScreenObject.LoadCustomFieldsData(t.Tables[6]),this.ScreenObject.LoadCustomFieldsCCData(t.Tables[7]),this.ScreenObject.CanApprove(t.Tables[0][0],t.Tables[10][0],this.ButtonSave),t.Tables[9].forEach(e=>{let i=new E(parseInt(e.StageID),parseInt(e.ParentID),null,this);i.Code=r.e.String(e.Code),i.Name=r.e.String(e.Name),i.StageNodeID=parseInt(e.StageNodeID),i.Stage.SelectedValue=parseInt(e.StageNodeID),t.Columns[9].Contains("Duration")&&!r.e.IsEmpty(e.Duration)&&(i.txtDuration.Text=e.Duration.toString()),i.LoadBOM(t),1!=i.parentid?(i.Parent=this.GetParent(this.BOMNodes,i.parentid),i.Parent.Childrens.push(i)):this.BOMNodes.push(i)}),this.RefreshBOMTree()}GetParent(e,t){let i=e.find(e=>e.StageID==t);return null!=i&&null!=i?i:(e.forEach(e=>{if(e.Childrens.length>0)return this.GetParent(e.Childrens,t)}),null)}OnSaveBOM(e){if("AddStage"==e){let e=1,t=null;null!=this.BOMTreeControl.Tree.SelectedNode&&null!=this.BOMTreeControl.Tree.SelectedNode.Tag?(e=this.BOMTreeControl.Tree.SelectedNode.Parent.Id,1!=e&&(t=this.BOMTreeControl.Tree.SelectedNode.Parent.Tag)):null!=this.BOMTreeControl.Tree.SelectedNode&&null!=this.BOMTreeControl.Tree.SelectedNode.Parent&&null!=this.BOMTreeControl.Tree.SelectedNode.Parent.Tag&&(e=this.BOMTreeControl.Tree.SelectedNode.Parent.Id,t=this.BOMTreeControl.Tree.SelectedNode.Parent.Tag);let i=new E(--this.iCntBOM,e,t,this);i.CancelVisible=!0,s.a.page.ShowDialog(i,R.a,{HideClose:!1,HideHeader:!0,ShowCenter:!0})}else if("EditStage"==e)null!=this.BOMTreeControl.Tree.SelectedNode&&null!=this.BOMTreeControl.Tree.SelectedNode.Tag?(this.BOMTreeControl.Tree.SelectedNode.Tag.CancelVisible=!1,s.a.page.ShowDialog(this.BOMTreeControl.Tree.SelectedNode.Tag,R.a,{HideClose:!1,HideHeader:!0,ShowCenter:!0})):this.DisplayMessage="Please Select Stage";else if("DeleteStage"==e)if(this.DisplayMessage="",null!=this.BOMTreeControl.Tree.SelectedNode&&null!=this.BOMTreeControl.Tree.SelectedNode.Tag){let e=this.BOMTreeControl.Tree.SelectedNode.Tag;null!=e.Parent?e.Parent.Childrens.Remove(e):this.BOMNodes.Remove(e),this.RefreshBOMTree()}else this.DisplayMessage="Please Select Stage";else if("Save"==e||"SaveAs"==e)try{let t,i=this._ScreenObject.ValidateData();if(!r.e.IsEmpty(i))return this.DisplayMessage=i,void(this.MessageVisibility=!0);if(!r.e.IsEmpty(i))return this.DisplayMessage=i,void(this.MessageVisibility=!0);if(!this.ScreenObject.ValidateDataonSave())return;this.objBOM.BOMID=null!=e&&"SaveAs"==e.toString()?0:this.BID,this.objBOM.Code=this.txtCode.Text,this.objBOM.Name=this.txtName.Text,this.objBOM.Date=this.Date.Date,this.objBOM.ProductID=this.Product.SelectedValue,this.objBOM.Packing=r.e.IsEmpty(this.Packing.Text)?"":this.Packing.Text,this.objBOM.UOMID=r.e.IsEmpty(this.UOM.SelectedValue)?0:parseInt(this.UOM.SelectedValue),this.objBOM.FPQty=r.e.Double(this.FPQty.Text),this.objBOM.FPQty<=0&&(this.objBOM.FPQty=1),this.objBOM.LocationID=this.Location.SelectedValue,this.objBOM.DivisionID=this.Division.SelectedValue,this.objBOM.group=!1,this.objBOM.selectednodeid=parseInt(this.Group.SelectedValue),this.objBOM.Desc=this.txtDesc.Text,this.objBOM.StatusID=parseInt(this.MStatus.SelectedValue);let a="";a+="<Stages>";let n=1,o=new Array;this.BOMTreeControl.Tree.AllNodes.forEach(t=>{if(null!=t.Tag){let i=t.Tag;"SaveAs"==e.toString()&&(i.StageID=--this.iCntBOM),a+='<Stage ID="'+i.StageID,a+='" StageNodeID="'+i.Stage.SelectedValue,r.e.IsEmpty(i.txtDuration.Text)||""!=i.txtDuration.ValidateData()?a+='" Duration="0':a+='" Duration="'+i.txtDuration.Text,a+='" Parent="'+t.Parent.Id,a+='" lft="'+n,a+='" Depth="'+t.LevelNo+'" />',o.push(i),n++}}),a+="</Stages>",this.objBOM.StageXML=a.toString(),this.objBOM.BOMProductXML=this.BOMProductXML(o,e),this.objBOM.BOMExpenseXML=this.BOMExpenseXML(o,e),this.objBOM.BOMResourceXML=this.BOMResourceXML(o,e),this.objBOM.CustomFieldsQuery=this._ScreenObject.GetCustomFieldsQuery(),this.objBOM.CustomCCQuery=this._ScreenObject.GetCustomCostCenterFieldsQuery(),this.objBOM.WID=464==this.objBOM.StatusID?0:this.ScreenObject.CheckWorkFlow(),s.a.inventory.AddMultiStageBOM(this.objBOM,"AddMultiStageBOM").subscribe(e=>{this.DisplayMessage=e.Message,this.MessageVisibility=!0,t=e.RetValue,t>0&&(this.BID=t,this.objBOM.BOMID=t)},e=>{console.log(" BOM Save : "+JSON.stringify(e))})}catch(t){Logger.ErrorLog("MultiBOMTreeViewModel:: OnSAVE"+t.stack)}else e.toString()}BOMProductXML(e,t){Logger.InfoLog("MultiBOMAddEditViewModel::Entering MachineXML ");let i="";return i+="<BOMProductXML>",e.forEach(e=>{for(let s=0;s<e.InputGrid.Table.length;s++)r.e.IsEmpty(e.InputGrid.Table[s].ProductName_Key)||(i+="<Row ",null!=t&&(null==t||"SaveAs"==t.toString())||r.e.IsEmpty(e.InputGrid.Table[s].BOMProductID)?i+=" BOMProductID='0'":i+=" BOMProductID='"+e.InputGrid.Table[s].BOMProductID.toString()+"'",i+=' StageID="'+e.StageID+'"',i+=" ProductID='"+e.InputGrid.Table[s].ProductName_Key+"'",i+=" Quantity='"+r.e.String(e.InputGrid.Table[s].Qty)+"'",i+=" UOMID='"+r.e.String(e.InputGrid.Table[s].UOM_Key)+"'",i+=" UnitPrice='"+r.e.String(e.InputGrid.Table[s].UnitPrice)+"'",e.InputGrid.TableColumns.Contains("FilterOn_Key")&&!r.e.IsEmpty(e.InputGrid.Table[s].FilterOn_Key)&&(i+=" FilterOn='"+e.InputGrid.Table[s].FilterOn_Key.toString()+"'"),i+=" ProductUse='1'",i+=" Wastage='"+r.e.String(e.InputGrid.Table[s].Wastage)+"'",i+=" IncInStageCost='"+r.e.String(e.InputGrid.Table[s].IncludeinStage)+"'",i+=" IncInFinalCost='"+r.e.String(e.InputGrid.Table[s].IncludeinFinal)+"'",r.e.IsEmpty(e.InputGrid.Table[s].Stage_Key)||(i+=" AutoStage='"+e.InputGrid.Table[s].Stage_Key+"'"),i+=" Value='"+r.e.String(e.InputGrid.Table[s].Value)+"'",i+=" Remarks='"+r.e.String(e.InputGrid.Table[s].Remarks).Replace("&","&am;").Replace("<","&lt;").Replace(">","&gt;").Replace('"',"&quot;")+"'/>");for(let s=0;s<e.OutputGrid.Table.length;s++)r.e.IsEmpty(e.OutputGrid.Table[s].ProductName_Key)||(i+="<Row ",null!=t&&(null==t||"SaveAs"==t.toString())||r.e.IsEmpty(e.OutputGrid.Table[s].BOMProductID)?i+=" BOMProductID='0'":i+=" BOMProductID='"+e.OutputGrid.Table[s].BOMProductID.toString()+"'",i+=' StageID="'+e.StageID+'"',i+=" ProductID='"+e.OutputGrid.Table[s].ProductName_Key+"'",i+=" Quantity='"+r.e.String(e.OutputGrid.Table[s].Qty)+"'",i+=" UnitPrice='"+r.e.String(e.OutputGrid.Table[s].UnitPrice)+"'",i+=" UOMID='"+r.e.String(e.OutputGrid.Table[s].UOM_Key)+"'",i+=" ProductUse='2'",i+=" Value='"+r.e.String(e.OutputGrid.Table[s].Value)+"'/>")}),i+="</BOMProductXML>",Logger.InfoLog("MultiBOMAddEditViewModel::Exiting MachineXML"),i.toString()}BOMExpenseXML(e,t){let i="";return i+="<BOMExpenseXML>",e.forEach(e=>{for(let s=0;s<e.ExpenseGrid.Table.length;s++)r.e.IsEmpty(e.ExpenseGrid.Table[s].AccountName_Key)||(i+="<Row ",null!=t&&(null==t||"SaveAs"==t.toString())||r.e.IsEmpty(e.ExpenseGrid.Table[s].ExpenseID)?i+=" ExpenseID='0'":i+=" ExpenseID='"+e.ExpenseGrid.Table[s].ExpenseID.toString()+"'",i+=' StageID="'+e.StageID+'"',i+=" Name='"+r.e.String(e.ExpenseGrid.Table[s].Name)+"'",i+=" ResourceID='1'",i+=" CreditAccountID='"+e.ExpenseGrid.Table[s].AccountName_Key+"'",r.e.IsEmpty(e.ExpenseGrid.Table[s].Expense_Key)||(i+=" DebitAccountID='"+e.ExpenseGrid.Table[s].Expense_Key+"'"),i+=" IncInStageCost='"+r.e.String(e.ExpenseGrid.Table[s].IncludeinStage)+"'",i+=" IncInFinalCost='"+r.e.String(e.ExpenseGrid.Table[s].IncludeinFinal)+"'",i+=" Value='"+r.e.String(e.ExpenseGrid.Table[s].Value)+"'/>")}),i+="</BOMExpenseXML>",i.toString()}BOMResourceXML(e,t){let i="";return i+="<BOMResourceXML>",e.forEach(e=>{for(let s=0;s<e.ResourcesGrid.Table.length;s++)r.e.IsEmpty(e.ResourcesGrid.Table[s].Machine_Key)||(i+="<Row ",null!=t&&(null==t||"SaveAs"==t.toString())||r.e.IsEmpty(e.ResourcesGrid.Table[s].BOMResourceID)?i+=" BOMResourceID='0'":i+=" BOMResourceID='"+e.ResourcesGrid.Table[s].BOMResourceID.toString()+"'",i+=' StageID="'+e.StageID+'"',i+=" ResourceID='"+e.ResourcesGrid.Table[s].Machine_Key+"'",e.ResourcesGrid.TableColumns.Contains("MachineDim1_Key")&&!r.e.IsEmpty(e.ResourcesGrid.Table[s].MachineDim1_Key)&&(i+=" MachineDim1='"+e.ResourcesGrid.Table[s].MachineDim1_Key+"'"),e.ResourcesGrid.TableColumns.Contains("MachineDim2_Key")&&!r.e.IsEmpty(e.ResourcesGrid.Table[s].MachineDim2_Key)&&(i+=" MachineDim2='"+e.ResourcesGrid.Table[s].MachineDim2_Key+"'"),e.ResourcesGrid.TableColumns.Contains("Options")&&!r.e.IsEmpty(e.ResourcesGrid.Table[s].Options)&&(i+=" Options='"+e.ResourcesGrid.Table[s].Options+"'"),r.e.IsEmpty(e.ResourcesGrid.Table[s].hrs)?i+=" Hours='1' ":i+=" Hours='"+e.ResourcesGrid.Table[s].hrs.toString()+"'",i+=" IncInStageCost='"+r.e.String(e.ResourcesGrid.Table[s].IncludeinStage)+"'",i+=" IncInFinalCost='"+r.e.String(e.ResourcesGrid.Table[s].IncludeinFinal)+"'",i+=" Value='"+r.e.String(e.ResourcesGrid.Table[s].Value)+"'/>")}),i+="</BOMResourceXML>",i.toString()}DeleteNode(e){e.Children.forEach(e=>{this.DeleteNode(e)}),this.BOMTreeControl.Tree.Rows.Remove(e),this.BOMTreeControl.Tree.AllNodes.Remove(e),this.BOMTreeControl.Tree.Root.Children[0].Children.Contains(e)&&this.BOMTreeControl.Tree.Root.Children[0].Children.Remove(e)}OnProductChange(e){if(this.UOM.Length!=this.Product.SelectedValue.toString()&&(this.UOM.Items.Clear(),this.UOM.Length=this.Product.SelectedValue.toString(),this.UOM.SelectedValue=null,this.Product.SelectedValue>0)){let e=this.objBOM.GetProductUnits(this.Product.SelectedValue);null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&(e.Tables[0].forEach(e=>{this.UOM.Items.push(h.d.ComboBoxItems_2(e.UnitName.toString(),e.UOMID.toString()))}),e.Columns[0].Contains("DefaultUOM")&&(this.UOM.SelectedValue=r.e.String(e.Tables[0][0].DefaultUOM))),null!=e&&e.Tables.length>1&&e.Columns[1].Contains("Packing")&&e.Tables[1].length>0&&(this.Packing.Text=r.e.String(e.Tables[1][0].Packing))}}OnAddEditSatge(e){let t,i=this.BOMTreeControl.Tree.SelectedNode,s=0,a=null,r=null;if(null!=i&&i.Tag==e){for(;i.Children.length>0&&null==i.Children[0].Tag;)this.BOMTreeControl.Tree.Rows.Remove(i.Children[0]),this.BOMTreeControl.Tree.AllNodes.Remove(i.Children[0]),i.Children.Remove(i.Children[0]);t=i,t.Text.Clear(),t.Text.push(e.Code),t.Text.push(e.Name),t.CallPropertyChange()}else{if(t=new B.a,t.IsGroup=!0,t.LevelNo=1,t.Tree=this.BOMTreeControl.Tree,t.Children=(new B.a.NodeCollection).NodeCollection_1(t),t.Nodes=t.Children,t.Text.push(e.Code),t.Text.push(e.Name),t.IsExpandedOnce=!0,t.AssignIsExpanded(!0),t.CallPropertyChange(),null!=i&&null!=i.Tag){a=i,r=a.Parent,t.LevelNo=a.Level;let e=this.BOMTreeControl.Tree.Rows.indexOf(i);this.BOMTreeControl.Tree.Rows.Insert(e,t),e=this.BOMTreeControl.Tree.AllNodes.indexOf(i),this.BOMTreeControl.Tree.AllNodes.Insert(e-1,t),r.Children.Insert(r.Children.indexOf(a),t)}else if(null!=i&&null!=i.Parent&&null!=i.Parent.Tag){if(a=i.Parent,t.LevelNo=a.Level+1,null!=a.NextNode){let e=this.BOMTreeControl.Tree.Rows.indexOf(a.NextNode);this.BOMTreeControl.Tree.Rows.Insert(e,t),this.BOMTreeControl.Tree.AllNodes.Insert(e-1,t)}else this.BOMTreeControl.Tree.Rows.push(t),this.BOMTreeControl.Tree.AllNodes.push(t);a.Children.push(t)}else this.BOMTreeControl.Tree.Rows.push(t),this.BOMTreeControl.Tree.AllNodes.push(t),this.BOMTreeControl.Tree.Root.Children[0].Children.push(t);t.Tag=e}t.Id=e.StageID,t.id=e.StageID,s=this.BOMTreeControl.Tree.Rows.indexOf(t)}RefreshBOMTree(){for(let e=this.BOMTreeControl.Tree.Rows.length-1;e>0;e--)this.BOMTreeControl.Tree.Rows.RemoveAt(e);this.BOMTreeControl.Tree.AllNodes.Clear(),this.BOMTreeControl.Tree.Root.Children[0].Children.Clear(),this.BOMNodes.forEach(e=>{this.RecursuveAdd(e)})}RecursuveAdd(e){1!=e.parentid?(this.BOMTreeControl.Tree.SelectedNode=this.BOMTreeControl.Tree.AllNodes.find(t=>t.Id==e.parentid),null!=this.BOMTreeControl.Tree.SelectedNode&&this.BOMTreeControl.Tree.SelectedNode.Children.length>0&&(this.BOMTreeControl.Tree.SelectedNode=this.BOMTreeControl.Tree.SelectedNode.Children[0])):this.BOMTreeControl.Tree.SelectedNode=null,this.OnAddEditSatge(e),e.Childrens.forEach(e=>{this.RecursuveAdd(e)})}OnCustomizeExtraFields(e){}}var N=i("1X8t");class f{static AddPage(e,t,i,a,r,n){let o=e.obj;if(76==o.CostCenterID)if(s.a.page.ShowLoading=!0,null==o.SelectedNode&&null==o.SelectedNode||1!=o.SelectedNode.TypeID||-999!=a)if(null==o.SelectedNode&&null==o.SelectedNode||2!=o.SelectedNode.TypeID){let e=new C(a,r);s.a.page.addNewTab({component:O.a,params:{obj:e}})}else{let e=new V(a,r);s.a.page.addNewTab({component:N.a,params:{obj:e}})}else{let e=new V(0,r);s.a.page.addNewTab({component:N.a,params:{obj:e}})}}static LoadPRDScreen(e,t){switch(e.FeatureActionID.toString()){case"6334":case"6327":case"6354":break;case"6389":return{component:a.TreeViewPageComponent,params:{ScreenName:e.ScreenName,FeatureActionID:e.FeatureActionID,CostCenterID:e.FeatureID,Call:"C3"},basedon:"CostCenterID"}}}}}}]);
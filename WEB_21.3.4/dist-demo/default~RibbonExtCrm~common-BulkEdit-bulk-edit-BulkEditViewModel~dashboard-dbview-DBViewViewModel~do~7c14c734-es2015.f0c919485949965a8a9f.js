(window.webpackJsonp=window.webpackJsonp||[]).push([[41,211],{"/nZE":function(e,t,s){"use strict";s.d(t,"a",(function(){return c}));var o=s("Do2H"),i=s("Lp6j"),l=s("eQJW"),a=s("1xwR"),n=s("vTM8"),r=s("mvPR"),h=s("dH+5"),u=s("MCLT"),D=s("4HhE"),d=s("8iaB");class c extends a.b{constructor(e){super(e),this.i=0,this.k=0,this.iMainRow=0,this.GroupRowsCount=0,this.AccountGroupIndex=0,this.SlabSize=0,this.iMainRowAccountID=0,this.dvPaymentTerms=null,this.dv=null,this.dvFPaymentTerms=null,this.dvPDCSeperate=null,this.dvPaymentTermsTable=null,this.dvTable=null,this.dvPDCSeperateTable=null,this.colAmountIndex=-1,this.colAdjustedIndex=-1,this.colHiddenAdjustedIndex=-1,this.colBalanceIndex=-1,this.colBalanceCumIndex=-1,this.colSlabIndex=-1,this.colMonthSlabIndex=-1,this.CntMonths=0,this.colUnAdjustedIndex=-1,this.colNetBalanceIndex=-1,this.colBillAmtIndex=-1,this.colLOBPDCIndex=-1,this.colTotalSaleIndex=-1,this.colPrevYearSaleIndex=-1,this.colPeriodSaleIndex=-1,this.colReceiptsAmtIndex=-1,this.colChqBounceAmtIndex=-1,this.colPDCIndex=-1,this.colLOBAgeingPDCIndex=-1,this.colIncludingPDCIndex=-1,this.colPaidByDaysIndex=-1,this.colUnDueIndex=-1,this.colTempIndex=-1,this.colFutureTrDr=-1,this.colFutureTrCr=-1,this.CurrencyType=0,this.colRefAccount=-1,this.Slabs=new Array,this.FSlabs=new Array,this.cqSlabs=new Array,this.MonthSlabs=new Array,this.Slabs_MMMYY=new Array,this.iSlabs=new Array,this.ShowLevelTree=!1,this.AccountsWithOutTransactions=!1,this.AccountsWithZeroBalance=!1,this.ShowMonthWise=!1,this.IsPaymentTermWise=!1,this.IsDueDateWise=!1,this.PDCSeperate=!1,this.HidePDCAdjustments=!1,this.DontShowBillAdjustments=!1,this.FilterPDCOnMaturityDate=!1,this.BWPerformance=!1,this.GroupTotalsAtEnd=!1,this.PDCOnConvresionDate=!1,this.HideSectionSubTotal=!1,this.AllowFromDateFilter=!1,this.UnPostedDocsSeparately=!1,this.UnAppsDocsAdjustSeperate=!1,this.FutureSlabs=!1,this.dblAmount=0,this.dblPaidTotal=0,this.dblBalance=0,this.dblBalanceCum=0,this.dblPaidDaysTotal=0,this.dtMonthWiseEndData=null,this.ShowMonthWiseFromDatePicker=!1,this.ShowDrCrSeperately=!1,this.UnAdjusted=!1,this.SemiAdjusted=!1,this.Adjusted=!1,this.IsDocDateWise=!1,this.GroupByDocNo=!1,this.arrUnPostedStatuses=new n.c,this.lstGroup=null,this.sbSubQuery="",this.dvChild=null,this.dvChildTable=null,this.PrintAgeingAnalysis=!1,this.BWAgeingShowOnlyDocsType="",this.BWAgeingShowOnlyDocs=!1,this.IsReceivable=!1,this.IsConsolidated=!1,this.FIFO=!1,this.ShowPreviousAdjustment=!1,this.ShowFutureAdjustment=!1,this.LOBAgeingReport=0,this.BlankRowHeight=0,this.AdjustmentRoundOff=.099,this.LOBAgeingColumns=new Array,this.lstRecPayUnadjusted=new n.c,this.arrPDCStatus=null,this.tempTotals=null,this.tempHiddenTotals=null,this.AddPDCSubTotal=!1,this.ClubByVoucherNo=!1,this.StatusID=0,this.ParentRow=null,this.LevelNo=0,this.dbl1=0,this.dbl2=0,this.TempOutValue=0,this.dblReceivable=0,this.dblPayable=0,this.dblAmount_ForUnDue=0,this.dblBillAmount=0,this.lstTotal=null,this.drRows=null,this.drFRows=null,this.arrMonthSlabAmounts=new n.a,this.IgnoreRow=!1,this.IsCQDate=!1,this.cmpValue=1/Math.pow(10,parseFloat(o.a.SessionManager.Preferences.DecimalsinAmount)),this.lstParents=new Array}LoadReport(){if(this.ViewModel.SubTotalCallBack=null,this.lstGroup=this.ViewModel.lstGroup,this.AccountGroupIndex=-1,this.colMonthSlabIndex=-1,this.ViewModel.lstGroupIndex.Clear(),this.ViewModel.SNo=0,this.ViewModel.Preferences.ContainsKey("DisplayBills")&&(this.UnAdjusted=this.ViewModel.Preferences.DisplayBills.Contains("<UnAdjusted"),this.SemiAdjusted=this.ViewModel.Preferences.DisplayBills.Contains("<SemiAdjusted"),this.Adjusted=this.ViewModel.Preferences.DisplayBills.Contains("<Adjusted")),this.GroupByDocNo=!(!this.ViewModel.Preferences.ContainsKey("GroupByDocNo")||"1"!=this.ViewModel.Preferences.GroupByDocNo),this.IsDocDateWise="DocDate"==this.ViewModel.Preferences.Date,this.IsPaymentTermWise="PaymentTerm"==this.ViewModel.Preferences.Date,this.IsDueDateWise="DocDueDate"==this.ViewModel.Preferences.Date,this.PDCInclude=!(!this.ViewModel.Preferences.ContainsKey("IncludePDCs")||"1"!=this.ViewModel.Preferences.IncludePDCs),this.IncludeTerminatedPDC=!this.ViewModel.Preferences.ContainsKey("IncludeTerminatedPDC")||"0"!=this.ViewModel.Preferences.IncludeTerminatedPDC,this.UnPostedDocsInclude=!(!this.ViewModel.Preferences.ContainsKey("IncludeUnPostedDocs")||"1"!=this.ViewModel.Preferences.IncludeUnPostedDocs),this.UnPostedDocsList=this.UnPostedDocsInclude&&this.ViewModel.Preferences.ContainsKey("IncludeUnPostedDocsList")?this.ViewModel.Preferences.IncludeUnPostedDocsList:"",this.PrintAgeingAnalysis=!(!this.ViewModel.Preferences.ContainsKey("PrintAgeingAnalysis")||"1"!=this.ViewModel.Preferences.PrintAgeingAnalysis),this.AccountsWithOutTransactions=!(!this.ViewModel.Preferences.ContainsKey("WantAccountsWithoutTransactions")||"1"!=this.ViewModel.Preferences.WantAccountsWithoutTransactions),this.AccountsWithZeroBalance=!(!this.ViewModel.Preferences.ContainsKey("WantAccountsWithZeroBalances")||"1"!=this.ViewModel.Preferences.WantAccountsWithZeroBalances),this.PDCSeperate=!(!this.PDCInclude||!this.ViewModel.Preferences.ContainsKey("PDCsSeparately")||"1"!=this.ViewModel.Preferences.PDCsSeparately),9==this.ViewModel.StaticReportType?this.DontShowBillAdjustments=!(!this.ViewModel.Preferences.ContainsKey("DontShowBillAdjustments")||"1"!=this.ViewModel.Preferences.DontShowBillAdjustments):10==this.ViewModel.StaticReportType&&(this.HidePDCAdjustments=!(!this.ViewModel.Preferences.ContainsKey("DontShowBillAdjustments")||"1"!=this.ViewModel.Preferences.DontShowBillAdjustments),this.ClubByVoucherNo=this.ViewModel.Preferences.ContainsKey("ClubByVoucherNo")),this.FilterPDCOnMaturityDate=!(!this.ViewModel.Preferences.ContainsKey("FilterPDCOnMaturityDate")||"1"!=this.ViewModel.Preferences.FilterPDCOnMaturityDate),this.BWAgeingShowOnlyDocs=this.ViewModel.Preferences.ContainsKey("BWAgeingShowOnlyDocs"),this.BWAgeingShowOnlyDocsType=this.ViewModel.Preferences.ContainsKey("BWAgeingShowOnlyDocs")?this.ViewModel.Preferences.BWAgeingShowOnlyDocs:"",this.BWPerformance=!(!this.ViewModel.Preferences.ContainsKey("BWPerformance")||"1"!=this.ViewModel.Preferences.BWPerformance),this.PDCOnConvresionDate=!(!this.ViewModel.Preferences.ContainsKey("BWPDCOnConvresionDate")||"1"!=this.ViewModel.Preferences.BWPDCOnConvresionDate),this.FIFO=!(!this.ViewModel.Preferences.ContainsKey("FIFO")||"1"!=this.ViewModel.Preferences.FIFO),this.HideSectionSubTotal=!!this.ViewModel.Preferences.ContainsKey("HideSectionSubTotal"),this.ViewModel.Preferences.ContainsKey("IncludeBills")&&"Both"==this.ViewModel.Preferences.IncludeBills&&(this.ShowDrCrSeperately=!(!this.ViewModel.Preferences.ContainsKey("ShowRecPaySeperately")||"1"!=this.ViewModel.Preferences.ShowRecPaySeperately)),this.AllowFromDateFilter=!(!this.ViewModel.Preferences.ContainsKey("AllowFromDateFilter")||"1"!=this.ViewModel.Preferences.AllowFromDateFilter),12==this.ViewModel.StaticReportType&&(this.AdjustmentRoundOff=0),this.ViewModel.Preferences.ContainsKey("AdjustmentRoundOff")&&(this.AdjustmentRoundOff=i.e.Double(this.ViewModel.Preferences.AdjustmentRoundOff)),this.UnPostedDocsSeparately=this.ViewModel.Preferences.ContainsKey("UnPostedDocsSeparately"),this.DontApplyLocationWiseAccountsFilter=!(!this.ViewModel.Preferences.ContainsKey("DontApplyLocationWiseAccountsFilter")||"1"!=this.ViewModel.Preferences.DontApplyLocationWiseAccountsFilter),this.DontApplyLocationWiseAccountsFilter||(this.ApplyLWAccountLFilterWhenIgnoreLoc=!(!this.ViewModel.Preferences.ContainsKey("ApplyLWAccountLFilterWhenIgnoreLoc")||"1"!=this.ViewModel.Preferences.ApplyLWAccountLFilterWhenIgnoreLoc)),this.AgeingBasedOnMaturityDate=!(this.IsPaymentTermWise||!this.PDCInclude||!this.ViewModel.Preferences.ContainsKey("AgeingBasedOnMaturityDate")||"1"!=this.ViewModel.Preferences.AgeingBasedOnMaturityDate),this.UnPostedDocsInclude&&this.UnPostedDocsList.length>0&&this.UnPostedDocsSeparately){let e=this.UnPostedDocsList.split(",");new Array(e.length);for(let t=0;t<e.length;t++)"371"==e[t]?this.arrUnPostedStatuses.push(371,"Un-Approved Documents"):"376"==e[t]?this.arrUnPostedStatuses.push(376,"Cancelled Documents"):"372"==e[t]?this.arrUnPostedStatuses.push(372,"Rejected Documents"):"441"==e[t]?this.arrUnPostedStatuses.push(441,"Approved Documents"):this.arrUnPostedStatuses.push(parseInt(e[t]),"Other Status("+e[t]+") Documents");this.arrUnPostedStatuses.push(429,"Bounced Documents"),this.UnAppsDocsAdjustSeperate=!(!this.ViewModel.Preferences.ContainsKey("UnAppsDocsAdjustSeperate")||"1"!=this.ViewModel.Preferences.UnAppsDocsAdjustSeperate)}if(this.arrPDCStatus=this.PDCInclude?this.IncludeTerminatedPDC?[370,439,452]:[370,439]:[],this.CurrencyType=0,this.ForeignCurrencyID=0,this.ViewModel.Preferences.ContainsKey("ForeignCurrency")){let e=new i.f;e.LoadXml("<XML>"+this.ViewModel.Preferences.ForeignCurrency+"</XML>");let t=i.f.SelectSingleNode(e.DocumentElement,"IsChecked");null!=t&&"1"==t.innerHTML&&(t=i.f.SelectSingleNode(e.DocumentElement,"Value"),this.ForeignCurrencyID=parseInt(t.innerHTML))}else if(this.ViewModel.Preferences.ContainsKey("Currency")){let e=new i.f;e.LoadXml("<XML>"+this.ViewModel.Preferences.Currency+"</XML>"),this.CurrencyType=parseInt(i.f.SelectSingleNode(e.DocumentElement,"Type").innerHTML),1==this.CurrencyType?(i.e.IsEmpty(o.a.SessionManager.Preferences.DimensionwiseCurrency)||0==parseInt(o.a.SessionManager.Preferences.DimensionwiseCurrency))&&(this.CurrencyType=0):2==this.CurrencyType&&(this.ForeignCurrencyID=parseInt(i.f.SelectSingleNode(e.DocumentElement,"Value").innerHTML))}if(this.GroupTotalsAtEnd=!(!this.ViewModel.Preferences.ContainsKey("GroupTotalsAtEnd")||"1"!=this.ViewModel.Preferences.GroupTotalsAtEnd),this.ShowMonthWiseFromDatePicker=!(!this.ViewModel.Preferences.ContainsKey("ShowMonthWiseFromDatePicker")||"1"!=this.ViewModel.Preferences.ShowMonthWiseFromDatePicker),this.FutureSlabs=!(!this.ViewModel.Preferences.ContainsKey("ShowFutureSlabs")||"1"!=this.ViewModel.Preferences.ShowFutureSlabs),this.SlabSize=4,this.ViewModel.Preferences.ContainsKey("SlabSize")&&(this.SlabSize=i.e.Int(this.ViewModel.Preferences.SlabSize),this.SlabSize<=0&&(this.SlabSize=4)),this.ViewModel.Preferences.ContainsKey("Slabs")){let e=new i.f;e.LoadXml("<XML>"+this.ViewModel.Preferences.Slabs+"</XML>"),this.Slabs.Clear(),this.iSlabs.Clear(),this.FSlabs.Clear();for(let t=0;t<e.DocumentElement.children.length;t++)this.iSlabs.push(parseInt(e.DocumentElement.children[t].innerHTML)),this.Slabs.push(this.ViewModel.oReportDialog.ToDate.Date.AddDays(-this.iSlabs[this.iSlabs.length-1])),this.AgeingBasedOnMaturityDate&&this.cqSlabs.push(this.ViewModel.oReportDialog.ToDate.Date.AddDays(this.iSlabs[this.iSlabs.length-1])),this.FutureSlabs&&this.FSlabs.push(this.ViewModel.oReportDialog.ToDate.Date.AddDays(this.iSlabs[this.iSlabs.length-1]))}if(this.ShowMonthWise=!1,this.ViewModel.Preferences.ContainsKey("MonthWiseMonths")){let e=new i.f;e.LoadXml("<XML>"+this.ViewModel.Preferences.MonthWiseMonths+"</XML>");let t=i.f.SelectSingleNode(e.DocumentElement,"IsChecked");if(null!=t&&"1"==t.innerHTML){this.ShowMonthWise=!0,t=i.f.SelectSingleNode(e.DocumentElement,"Text"),this.CntMonths=i.e.Int(t.innerHTML),this.CntMonths<=0&&(this.ShowMonthWise=!1);let s=new Date(this.ViewModel.ToDatePicker.Date.getFullYear(),this.ViewModel.ToDatePicker.Date.getMonth(),this.ViewModel.ToDatePicker.Date.getDay());if(this.ShowMonthWiseFromDatePicker){for(let e=0;e<this.CntMonths;e++)this.MonthSlabs.push(s),this.arrMonthSlabAmounts.push(s.ToString("MMMyy"),0),this.Slabs_MMMYY.push(s.ToString("MMMyy")),s=s.AddMonths(1);this.dtMonthWiseEndData=s.AddDays(-1)}else for(let e=0;e<this.CntMonths;e++)this.MonthSlabs.InsertAt(s,0),this.arrMonthSlabAmounts.push(s.ToString("MMMyy"),0),this.Slabs_MMMYY.push(s.ToString("MMMyy")),s=s.AddMonths(-1);this.Slabs_MMMYY.push("MonthSlab"),this.arrMonthSlabAmounts.push("MonthSlab",0)}}let e=null,t=null;for(let o=this.ViewModel.ColumnSource.length-1;o>=0;o--)this.ViewModel.ColumnSource[o].DataFormat.ShowDefaultSign=0,"Slab"==this.ViewModel.ColumnSource[o].ID?(e=this.ViewModel.ColumnSource[o],this.colSlabIndex=o):"MonthSlab"==this.ViewModel.ColumnSource[o].ID&&(t=this.ViewModel.ColumnSource[o],this.colMonthSlabIndex=o,this.ViewModel.ColumnSource[this.colMonthSlabIndex].HeaderAppearance.IsVisible=!!this.ShowMonthWise);this.TempCols=new Array;for(let o=0;o<this.ViewModel.ColumnSource.length;o++)this.TempCols.push(this.ViewModel.ColumnSource[o]);if(160==this.ViewModel.StaticReportType&&null!=t){t.HeaderAppearance.IsVisible=!0,this.TempCols.Remove(t);var s=t.Clone();s.HeaderText="TOTAL",s.DataAppearance.IsBold=!0,this.TempCols.push(s);let e=new Date(this.ViewModel.FromDatePicker.Date.getFullYear(),this.ViewModel.FromDatePicker.Date.getMonth(),this.ViewModel.FromDatePicker.Date.Day),o=0;do{this.MonthSlabs.push(e),this.arrMonthSlabAmounts.push(e.ToString("MMMyy"),0);let s=t.Clone();s.ID=e.ToString("MMMyy"),s.HeaderText=e.ToString("MMM-yy").toUpperCase(),this.TempCols.InsertAt(s,this.colMonthSlabIndex+o),e=e.AddMonths(1),o++}while(e<=this.ViewModel.ToDatePicker.Date)}if(-1!=this.colSlabIndex){this.Slabs.length>0&&(this.TempCols[this.colSlabIndex].HeaderText=">"+this.iSlabs[this.iSlabs.length-1]);for(let t=0;t<this.Slabs.length;t++){let s=e.Clone();s.ID=s.ID+(t+1).toString(),s.HeaderText=0==t?"0-"+(this.iSlabs[t]-1):this.iSlabs[t-1]+"-"+(this.iSlabs[t]-1),0==this.iSlabs[t]&&(s.HeaderAppearance.IsVisible=!1),this.TempCols.InsertAt(s,this.colSlabIndex+t)}if(this.FSlabs.length>0){let t=e.Clone();t.ID="F"+t.ID,t.HeaderText=">"+this.iSlabs[this.iSlabs.length-1]+" (F)",this.TempCols.Insert(this.colSlabIndex+this.Slabs.length+1,t)}for(let t=0;t<this.FSlabs.length;t++){let s=e.Clone();s.ID="F"+s.ID+(t+1).toString(),s.HeaderText=0==t?"0-"+(this.iSlabs[t]-1)+" (F)":this.iSlabs[t-1]+"-"+(this.iSlabs[t]-1)+" (F)",0==this.iSlabs[t]&&(s.HeaderAppearance.IsVisible=!1),this.TempCols.Insert(this.colSlabIndex+this.Slabs.length+t+1,s)}}else this.Slabs.Clear(),this.FSlabs.Clear();if(null==t&&(this.ShowMonthWise=!1),this.ShowMonthWise){t.HeaderText="Last Year",-1!=this.colSlabIndex&&(this.colSlabIndex<this.colMonthSlabIndex?this.colMonthSlabIndex+=this.SlabSize:this.colSlabIndex+=this.CntMonths);for(let e=0;e<this.MonthSlabs.length;e++){let s=t.Clone();s.ID=this.MonthSlabs[e].ToString("MMMyy"),s.HeaderText=this.MonthSlabs[e].ToString("MMM yyyy"),this.TempCols.Insert("ASC"==t.DataFormat.Sort?this.colMonthSlabIndex:this.colMonthSlabIndex+e+1,s)}}for(let o=this.TempCols.length-1;o>=0;o--)this.TempCols[o].DataFormat.ShowDefaultSign=0,"Amount"==this.TempCols[o].ID?this.colAmountIndex=o:"AdjustmentAmount"==this.TempCols[o].ID||"AdjAmount"==this.TempCols[o].ID?this.colAdjustedIndex=o:"Balance"==this.TempCols[o].ID?this.colBalanceIndex=o:"UnAdjusted"==this.TempCols[o].ID?this.colUnAdjustedIndex=o:"NetBalance"==this.TempCols[o].ID?this.colNetBalanceIndex=o:"BalanceCumulative"==this.TempCols[o].ID?this.colBalanceCumIndex=o:"TotalPDC"==this.TempCols[o].ID?this.colPDCIndex=o:"LOBPDC"==this.TempCols[o].ID?this.colLOBPDCIndex=o:"BalanceInclPDC"==this.TempCols[o].ID?this.colIncludingPDCIndex=o:"TotalSale"==this.TempCols[o].ID?this.colTotalSaleIndex=o:"UnDueAmount"==this.TempCols[o].ID?11==this.ViewModel.StaticReportType?this.IsDueDateWise&&(this.colUnDueIndex=o):(this.IsPaymentTermWise||this.IsDueDateWise||this.IsDocDateWise&&12==this.ViewModel.StaticReportType)&&(this.colUnDueIndex=o):"BillAmount"==this.TempCols[o].ID?this.colBillAmtIndex=o:"PrevYearSale"==this.TempCols[o].ID?this.colPrevYearSaleIndex=o:"PeriodSale"==this.TempCols[o].ID?this.colPeriodSaleIndex=o:"ReceiptsAmount"==this.TempCols[o].ID?this.colReceiptsAmtIndex=o:"ChequeBounceAmount"==this.TempCols[o].ID?this.colChqBounceAmtIndex=o:"PaidByDays"==this.TempCols[o].ID?this.colPaidByDaysIndex=o:"FutureTrDedit"==this.TempCols[o].ID?this.colFutureTrDr=o:"FutureTrCredit"==this.TempCols[o].ID?this.colFutureTrCr=o:"RefAccount"==this.TempCols[o].ID?this.colRefAccount=o:0==i.e.stringCompare(this.TempCols[o].Formula,"SNO",!0)&&(this.ViewModel.colSNoIndex=o);if(-1!=this.colBalanceIndex?this.colTempIndex=this.colBalanceIndex:-1!=this.colAmountIndex?this.colTempIndex=this.colAmountIndex:-1!=this.colAdjustedIndex?this.colTempIndex=this.colAdjustedIndex:-1!=this.colUnAdjustedIndex?this.colTempIndex=this.colUnAdjustedIndex:-1!=this.colNetBalanceIndex?this.colTempIndex=this.colNetBalanceIndex:-1!=this.colBalanceCumIndex&&(this.colTempIndex=this.colBalanceCumIndex),this.PrintAgeingAnalysis){let e;if(this.ViewModel.Preferences.ContainsKey("LOBAgeingReport")&&!i.e.IsEmpty(this.ViewModel.Preferences.LOBAgeingReport)&&(this.LOBAgeingReport=parseInt(this.ViewModel.Preferences.LOBAgeingReport)),this.ViewModel.Preferences.ContainsKey("BlankRowHeight")&&(this.BlankRowHeight=i.e.Double(this.ViewModel.Preferences.BlankRowHeight)),this.LOBAgeingReport>0){e=o.a.report.ReportDataSet("RPT022",this.ViewModel.IsReportDB,"SELECT DefaultPreferences,ReportDefnXML FROM ADM_RevenUReports with(nolock) WHERE ReportID="+this.LOBAgeingReport);try{let t=new i.f;t.LoadXml(e.Tables[0][0].ReportDefnXML.toString());let s=t.SelectNodes("PactRevenURpts/PactRevenURptDef/Columns/ColumnDef");for(let e=0;e<s.length;e++){let t=s[e],o=new h.b;o.ID=this.ViewModel.GetNodeValue(t,"Identity/ID"),o.FieldName=this.ViewModel.GetNodeValue(t,"Identity/Field"),o.HeaderText=this.ViewModel.GetNodeValue(t,"Identity/Caption"),o.HeaderAppearance=this.ViewModel.GetAppearance(t.SelectSingleNode("HeaderAppearance")),o.DataAppearance=this.ViewModel.GetAppearance(t.SelectSingleNode("DataAppearance")),o.Row=i.e.Int(this.ViewModel.GetNodeValue(t,"HeaderAppearance/Row")),o.Column=i.e.Int(this.ViewModel.GetNodeValue(t,"HeaderAppearance/Column")),null!=t.SelectSingleNode("Format")&&(o.DataFormat=this.ViewModel.GetFormat(t.SelectSingleNode("Format"))),o.ColumnType=this.ViewModel.GetNodeValue(t,"Identity/Type").toUpperCase(),o.Formula=this.ViewModel.GetNodeValue(t,"Identity/Expression");let l=this.ViewModel.GetNodeValue(t,"Identity/FormulaEvaluateAtEnd");o.EvaluateAtEnd="0"==l?0:"2"==l?2:1,o.ColumnFilterExpression=this.ViewModel.GetNodeValue(t,"Format/ColumnFilterExpression");let a=this.ViewModel.GetNodeValue(t,"Identity/UseOnce");if(o.UseOnce="1"==a?1:"2"==a?2:"-1"==a?-1:0,o.HeaderAppearance.IsVisible){if("MonthSlab"==o.ID)continue;this.LOBAgeingColumns.push(o),o.Row>0&&o.Column>=0&&(o.HeaderAppearance.IsVisible=!1),"UnDueAmount"==o.ID&&o.HeaderAppearance.IsVisible&&(this.IsPaymentTermWise||this.IsDueDateWise)&&(this.colUnDueIndex=this.LOBAgeingColumns.length)}}}catch(n){this.LOBAgeingReport=0}}else e=o.a.report.ReportDataSet("RPT022",this.ViewModel.IsReportDB,"SELECT DefaultPreferences FROM ADM_RevenUReports with(nolock) WHERE ReportID=13");let t=new i.f;t.LoadXml(e.Tables[0][0].DefaultPreferences.toString()),this.Slabs.Clear(),this.iSlabs.Clear();let s=i.f.SelectSingleNode(t.DocumentElement,"Slabs").childNodes;for(let o=0;o<s.length;o++)this.iSlabs.push(parseInt(s[o].innerHTML)),this.Slabs.push(this.ViewModel.oReportDialog.ToDate.Date.AddDays(-this.iSlabs[this.iSlabs.length-1]));if(this.SlabSize=this.Slabs.length,0==this.LOBAgeingReport){let e=new h.b;e.ID="Balance",e.HeaderText="Balance",e.DataFormat=new r.b,e.DataFormat.Commas=1,e.DataFormat.DecimalsPoints=parseInt(o.a.SessionManager.Preferences.DecimalsinAmount),e.DataFormat.NegativeNumber=4,e.ColumnType="FLOAT",e.DataAppearance=new r.a,e.DataAppearance.Alignment="Center",this.LOBAgeingColumns.push(e),e=new h.b,e.ID="UnAdjusted",e.HeaderText="UnAdjusted",e.DataFormat=new r.b,e.DataFormat.Commas=1,e.DataFormat.DecimalsPoints=parseInt(o.a.SessionManager.Preferences.DecimalsinAmount),e.DataFormat.NegativeNumber=4,e.ColumnType="FLOAT",e.DataAppearance=new r.a,e.DataAppearance.Alignment="Center",this.LOBAgeingColumns.push(e),e=new h.b,e.ID="NetBalance",e.HeaderText="NetBalance",e.DataFormat=new r.b,e.DataFormat.Commas=1,e.DataFormat.DecimalsPoints=parseInt(o.a.SessionManager.Preferences.DecimalsinAmount),e.DataFormat.NegativeNumber=4,e.ColumnType="FLOAT",e.DataAppearance=new r.a,e.DataAppearance.Alignment="Center",this.LOBAgeingColumns.push(e),e=new h.b,e.ID="Slab",e.HeaderText="Slab",e.DataFormat=new r.b,e.DataFormat.Commas=1,e.DataFormat.DecimalsPoints=parseInt(o.a.SessionManager.Preferences.DecimalsinAmount),e.DataFormat.NegativeNumber=4,e.ColumnType="FLOAT",e.DataAppearance=new r.a,e.DataAppearance.Alignment="Center",this.LOBAgeingColumns.push(e)}var l=this.LOBAgeingColumns.find(e=>"Slab"==e.ID);l&&(this.colSlabIndex=this.LOBAgeingColumns.indexOf(l)),this.Slabs.length>0&&(this.LOBAgeingColumns[this.colSlabIndex].HeaderText=">"+this.iSlabs[this.iSlabs.length-1]);for(let o=0;o<this.Slabs.length;o++){let e=l.Clone();e.ID=e.ID+(o+1).toString(),e.HeaderText=0==o?"1-"+this.iSlabs[o]:this.iSlabs[o-1]+1+"-"+this.iSlabs[o],0==this.iSlabs[o]&&e.HeaderAppearance&&(e.HeaderAppearance.IsVisible=!1),this.LOBAgeingColumns.Insert(this.colSlabIndex+o,e)}for(let o=this.TempCols.length;o<this.LOBAgeingColumns.length;o++){let e=this.TempCols[this.colTempIndex].Clone();e.ID="AG"+o,e.HeaderText="",this.TempCols.push(e)}}if(11==this.ViewModel.StaticReportType||12==this.ViewModel.StaticReportType){this.ViewModel.GrpReportTotal.TotalCols.Clear(),this.ViewModel.TotalCols.Clear(),this.ViewModel.lstGroup.forEach(e=>{e.TotalCols.Clear()}),this.ViewModel.GrpReportTotal.TempTotalCols.keys.forEach(e=>{var t=this.TempCols.find(t=>t.ID==e);if(t){let s=this.TempCols.indexOf(t);this.ViewModel.TotalCols.Contains(e)||this.ViewModel.TotalCols.push(e),this.ViewModel.GrpReportTotal.TotalCols.push(e,s)}}),this.ViewModel.lstGroup.forEach(e=>{e.TempTotalCols.keys.forEach(t=>{var s=this.TempCols.find(e=>e.ID==t);if(s){let o=this.TempCols.indexOf(s);this.ViewModel.TotalCols.Contains(t)||this.ViewModel.TotalCols.push(t),e.TotalCols.push(t,o)}})});for(let e=0;e<this.TempCols.length;e++)"FLOAT"==this.TempCols[e].ColumnType&&(this.TempCols[e].ID.startsWith("Slab")||this.TempCols[e].ID.startsWith("FSlab")||this.Slabs_MMMYY.Contains(this.TempCols[e].ID))&&(this.ViewModel.TotalCols.Contains(this.TempCols[e].ID)||this.ViewModel.TotalCols.push(this.TempCols[e].ID),this.ViewModel.GrpReportTotal.TotalCols.ContainsKey(this.TempCols[e].ID)||this.ViewModel.GrpReportTotal.TotalCols.push(this.TempCols[e].ID,e),this.ViewModel.lstGroup.forEach(t=>{t.TotalCols.ContainsKey(this.TempCols[e].ID)||t.TotalCols.push(this.TempCols[e].ID,e)}))}this.AggTotal=i.e.NumArray(this.oColumns.length+this.Slabs.length,2),this.ViewModel.ReportColumns=this.TempCols,this.oColumns=this.ViewModel.ReportColumns,this.ViewModel.IsTotalColsAdded=!0,this.ViewModel.totals=i.e.NumArray(this.oColumns.length,this.lstGroup.length+1),this.ViewModel.CumulativeIndex=this.colBalanceCumIndex,-1!=this.colBalanceCumIndex&&(this.ViewModel.CumulativeColumn=this.oColumns[this.colBalanceCumIndex].ID+"CUMULATIVE"),-1!=this.colSlabIndex&&this.ViewModel.RefreshPostFilters();let a=this.ViewModel.oReportDialog.GetSeqNosListWithRoots();if(this.ViewModel.HideCostCenterTree||!i.e.IsEmpty(a))if(9!=this.ViewModel.StaticReportType&&10!=this.ViewModel.StaticReportType||this.Adjusted||this.SemiAdjusted||this.UnAdjusted)if(160==this.ViewModel.StaticReportType){this.IsConsolidated="1"==this.ViewModel.Preferences.Consolidated,this.ShowPreviousAdjustment="1"==this.ViewModel.Preferences.ShowPreviousAdjustment,this.ShowFutureAdjustment="1"==this.ViewModel.Preferences.ShowFutureAdjustment,this.IsReceivable="Receivables"==this.ViewModel.Preferences.Bills;let e="",t="",s="";this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(e=i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")");let l="StatusID=369";this.UnPostedDocsList.length>0&&this.UnPostedDocsList.split(",").forEach(e=>{l+=" or StatusID="+e}),l=" and ("+l+")",this.ViewModel.HideCostCenterTree||this.ViewModel.oReportDialog.IsZeroSelected||this.ViewModel.oReportDialog.IsOneSelected||(this.ViewModel.oReportDialog.IsGroupExists?(t="AccountID=GTP.GTID",s=a.Contains(",")?",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID IN ("+a+") group by T.AccountID) AS GTP ":",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID="+a+" group by T.AccountID) AS GTP "):t=a.Contains(",")?"AccountID IN ("+a+")":"AccountID="+a);let n=[];if(n.push(this.IsReceivable),n.push(this.IsConsolidated),n.push(this.ShowPreviousAdjustment&&this.ShowFutureAdjustment?3:this.ShowFutureAdjustment?2:this.ShowPreviousAdjustment?1:0),n.push(this.ViewModel.oReportDialog.FromDate.Date),n.push(this.ViewModel.oReportDialog.ToDate.Date),n.push(s),n.push(t),n.push(l),n.push(e+this.GetDimensionFilter("B.dcCCNID")),n.push(this.PDCInclude),n.push(this.IncludeTerminatedPDC),n.push(this.PDCOnConvresionDate),n.push(this.ViewModel.Preferences.Date),n.push(o.a.SessionManager.LanguageID),this.dsMain=o.a.report.GetARALAnalysis(n,this.ViewModel.IsReportDB),this.dvAmt=this.dvAmtTable=this.dsMain.Tables[0],this.dvUnAdj=this.dvUnAdjTable=this.dsMain.Tables[1],this.dvCollect=this.dvCollectTable=this.dsMain.Tables[2],this.IsConsolidated)this.AddARAPRowSet();else{for(this.i=0;this.i<this.dsMain.Tables[3].length;this.i++)this.drMainRow=this.dsMain.Tables[3][this.i],this.dvAmt=this.dvAmtTable.filter(e=>e.AccountID==this.drMainRow.AccountID.toString()),this.dvUnAdj=this.dvUnAdjTable.filter(e=>e.AccountID==this.drMainRow.AccountID.toString()),this.dvCollect=this.dvCollectTable.filter(e=>e.AccountID==this.drMainRow.AccountID.toString()),(this.dvAmt.length>0||this.dvUnAdj.length>0||this.dvCollect.length>0)&&this.AddARAPRowSet();this.dsMain.Tables[3].length>1&&(this.row=this.NewReportRow_2(r.f.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance_Data),this.row.LevelNo=0,this.row.Cells[0].Text=o.a.GetResource("Reports_ReportTotal"),this.row.Cells[0].CellAppearance.Alignment="Left",this.i=0,this.arrMonthSlabAmounts.forEach(e=>{this.ViewModel.SetCellValue(e.Value,this.oColumns[this.colMonthSlabIndex+this.i].DataFormat,"FLOAT",this.row.Cells[this.colMonthSlabIndex+this.i]),this.i++}),this.ViewModel.addRow(this.row))}}else this.dsMain=null,this.GetDataSet(this.ViewModel.StaticReportType,a).then(e=>{if(e&&(this.dsMain=e,this.GroupByDocNo&&(this.dsMain.Columns[0].Contains("DocNo")?this.GroupbyDocNo(this.dsMain.Tables[0],"DocNo",this.dsMain.Columns[0]):this.dsMain.Columns[0].Contains("VoucherNo")&&this.GroupbyDocNo(this.dsMain.Tables[0],"VoucherNo",this.dsMain.Columns[0]),this.dsMain.Tables.length>1&&this.dsMain.Columns[0].Contains("DocNo")&&this.dsMain.Columns[1].Contains("RefDocNo")&&this.GroupbyDocNo(this.dsMain.Tables[1],"DocNo~RefDocNo",this.dsMain.Columns[1]))),this.dv=this.dvTable=this.dsMain.Tables[0],12==this.ViewModel.StaticReportType&&(-1!=this.colFutureTrDr||-1!=this.colFutureTrCr)){var t=this.ViewModel.BaseReportColumns.find(e=>"FutureTrDedit"==e.ID),s=this.ViewModel.BaseReportColumns.find(e=>"FutureTrCredit"==e.ID);let e=null==t||i.e.IsEmpty(t.CDGDO.ExecutedDocument)?"":t.CDGDO.ExecutedDocument,l=null==s||i.e.IsEmpty(s.CDGDO.ExecutedDocument)?"":s.CDGDO.ExecutedDocument,a=null,n=null;if(-1!=this.colFutureTrDr&&-1!=this.colFutureTrCr)if(e==l){let t=this.GetFutureTransactionDrCrQuery(e,0);a=o.a.report.ReportDataSet("RPT022",this.ViewModel.IsReportDB,t),n=a}else{let t=this.GetFutureTransactionDrCrQuery(e,1);a=o.a.report.ReportDataSet("RPT022",this.ViewModel.IsReportDB,t),t=this.GetFutureTransactionDrCrQuery(l,2),n=o.a.report.ReportDataSet("RPT022",this.ViewModel.IsReportDB,t)}else if(-1!=this.colFutureTrDr){let t=this.GetFutureTransactionDrCrQuery(e,1);a=o.a.report.ReportDataSet("RPT022",this.ViewModel.IsReportDB,t)}else if(-1!=this.colFutureTrCr){let e=this.GetFutureTransactionDrCrQuery(l,2);n=o.a.report.ReportDataSet("RPT022",this.ViewModel.IsReportDB,e)}-1!=this.colFutureTrDr&&this.dsMain.Columns[0].push("FutureTrDedit"),-1!=this.colFutureTrCr&&this.dsMain.Columns[0].push("FutureTrCredit");let r=null;this.dsMain.Tables[0].forEach(e=>{-1!=this.colFutureTrDr&&(r=a.Tables[0].filter(t=>t.AccountID==e.AccountID),r.length>0&&(e.FutureTrDedit=r[0].Dr)),-1!=this.colFutureTrCr&&(n!=a&&(r=n.Tables[0].filter(t=>t.AccountID==e.AccountID)),r.length>0&&(e.FutureTrCredit=r[0].Cr))})}if(!this.PrintAgeingAnalysis||9!=this.ViewModel.StaticReportType&&10!=this.ViewModel.StaticReportType)this.BWCallBack();else{if(this.ViewModel.SelectTag=this.ViewModel.FromTag="",!i.e.IsEmpty(this.lstGroup[0].Formula)&&"AccountName"==this.lstGroup[0].ID){let e=this.ViewModel.StaticReportType;this.ViewModel.StaticReportType=12,this.ViewModel.SetQueryXMLTags(),this.ViewModel.StaticReportType=e}let e=this.colPDCIndex;var l=this.LOBAgeingColumns.find(e=>"TotalPDC"==e.ID||"BalanceInclPDC"==this.TempCols[this.i].ID);l&&(this.colLOBAgeingPDCIndex=this.LOBAgeingColumns.indexOf(l)),this.colPDCIndex=this.colLOBAgeingPDCIndex,this.GetDataSet(12,a).then(t=>{this.dsSubAgeing=t,this.ViewModel.SubTotalCallBack=new D.b,this.ViewModel.SubTotalCallBack.Subscribe(this,"AddAgeingData"),this.colPDCIndex=e,this.BWCallBack()},e=>{this.ViewModel.process_RunWorkerCompleted(),this.ViewModel.DisplayMessage="Error",console.log(e)})}},e=>{this.ViewModel.process_RunWorkerCompleted(),this.ViewModel.DisplayMessage="Error",console.log(e)});else this.ViewModel.process_RunWorkerCompleted();else this.ViewModel.process_RunWorkerCompleted()}BWCallBack(){if(9==this.ViewModel.StaticReportType||10==this.ViewModel.StaticReportType){if(9==this.ViewModel.StaticReportType)this.dvChild=this.dvChildTable=this.dsMain.Tables[1];else if(this.UnAppsDocsAdjustSeperate){let e,t;for(let s=0;s<this.dsMain.Tables[0].length;s++){e=this.dsMain.Tables[0][s];for(let o=s+1;o<this.dsMain.Tables[0].length;o++)t=this.dsMain.Tables[0][o],1!=parseInt(t.IsUnappAdj)||parseInt(t.AccountID)!=parseInt(e.AccountID)||t.DocNo.toString()!=e.DocNo.toString()||this.ClubByVoucherNo&&t.Narration.toString()!=e.Narration.toString()||(e.Amount=parseFloat(e.Amount)+parseFloat(t.Amount),this.dsMain.Tables[0].RemoveAt(o),o--)}}if(this.dsMain.Columns[0].push("Debit"),this.dsMain.Columns[0].push("Credit"),this.dsMain.Columns[0].Contains("Balance")||this.dsMain.Columns[0].push("Balance"),-1!=this.colBalanceCumIndex&&this.dsMain.Columns[0].push(this.oColumns[this.colBalanceCumIndex].ID+"CUMULATIVE"),this.ViewModel.SubTotalBeforeCallBack=new D.b,this.ViewModel.SubTotalBeforeCallBack.Subscribe(this,"LOBSubTotalCallBack"),!this.FIFO&&("Receivables"==this.ViewModel.Preferences.IncludeBills||"Payables"==this.ViewModel.Preferences.IncludeBills)){let e,t,s="Receivables"==this.ViewModel.Preferences.IncludeBills,o="",i=0,l=0,a=new Array,n=new Array;for(this.i=this.dsMain.Tables[0].length-1;this.i>=0;this.i--)t=this.dsMain.Tables[0][this.i],o!=t.AccountID.toString()&&(o.length>0&&((s||i+l>=0)&&(n.forEach(e=>{this.dsMain.Tables[0].Remove(e)}),0!=l&&i+l>0&&this.lstRecPayUnadjusted.push(parseInt(o),l)),(!s||i+l<=0)&&(a.forEach(e=>{this.dsMain.Tables[0].Remove(e)}),0!=i&&i+l<0&&this.lstRecPayUnadjusted.push(parseInt(o),i))),i=0,l=0,o=t.AccountID.toString(),a.Clear(),n.Clear()),this.dblAmount=parseFloat(t.Amount),e=null==this.dsMain.Tables[0][this.i].Adjusted?0:parseFloat(this.dsMain.Tables[0][this.i].Adjusted),0!=e?(this.dblBalance=this.dblAmount+e,this.dblAmount>=0?this.dblBalance<0&&(this.dblBalance=0):this.dblBalance>0&&(this.dblBalance=0)):this.dblBalance=this.dblAmount,this.dblAmount>=0?(i+=this.dblBalance,a.push(t)):(l+=this.dblBalance,n.push(t));o.length>0&&((s||i+l>=0)&&(n.forEach(e=>{this.dsMain.Tables[0].Remove(e)}),0!=l&&i+l>0&&this.lstRecPayUnadjusted.push(parseInt(o),l)),(!s||i+l<=0)&&(a.forEach(e=>{this.dsMain.Tables[0].Remove(e)}),0!=i&&i+l<0&&this.lstRecPayUnadjusted.push(parseInt(o),i)))}if(this.ViewModel.ReportData=this.dsMain.Tables[0],this.ViewModel.ReportDataColumns=this.dsMain.Columns[0],this.ViewModel.ConstructFormulaFields(!0),this.PrintAgeingAnalysis&&null!=this.dsSubAgeing&&(i.e.IsEmpty(this.lstGroup[0].Formula)||"AccountName"!=this.lstGroup[0].ID||this.dsSubAgeing.Tables[0].forEach(e=>{this.ViewModel.CalculateFormula_2(this.lstGroup[0],e)})),this.dvPDCSeperate=this.dvPDCSeperateTable=this.dsMain.Tables[0],(this.PDCSeperate||this.UnPostedDocsInclude&&this.UnPostedDocsSeparately)&&(this.tempTotals=new Array(this.oColumns.length).fill(0),this.tempHiddenTotals=new Array(this.ViewModel.HiddenNumericColumns.length).fill(0),this.colHiddenAdjustedIndex=this.ViewModel.HiddenNumericColumns.indexOf(this.ViewModel.HiddenNumericColumns.find(e=>"AdjAmount"==e.ID))),this.ClubByVoucherNo){this.dsMain.Columns[0].push("RType");let e,t,s,o=null,i=new Array,l=!1;e=null,t=null;for(let a=1;a<this.dsMain.Tables[0].length;a++)if(e=this.dsMain.Tables[0][a-1],t=this.dsMain.Tables[0][a],l=!1,parseInt(e.AccountID)==parseInt(t.AccountID)&&e.DocNo.toString()==t.DocNo.toString()&&(l=!0),!l&&null==o&&this.IsDocDateWise&&(s=e.Narration.toString(),s.length>0&&s.Contains("/")&&(o=null,t=e,l=!0)),l){if(null==o){o=this.dsMain.Tables[0].NewRow();for(let t=0;t<this.dsMain.Columns[0].length;t++)o[t]=e[t];o.RType=1,e.RType=2,this.IsDocDateWise&&(o.Adjusted=e.AdjustedBillAmount,o.Amount=e.BillAmount),this.dsMain.Tables[0].InsertAt(o,a-1),a++}t==e?o=null:(t.RType=2,i.forEach(e=>{null==o[e]?o[e]=t[e]:null!=t[e]&&(o[e]=parseFloat(o[e])+parseFloat(t[e]))}))}else o=null;if(this.dsMain.Tables[0].length>0&&(t=this.dsMain.Tables[0][this.dsMain.Tables[0].length-1],this.dsMain.Tables[0].length>1&&(e=this.dsMain.Tables[0][this.dsMain.Tables[0].length-2]),(1==this.dsMain.Tables[0].length||parseInt(e.AccountID)!=parseInt(t.AccountID)||e.DocNo.toString()!=t.DocNo.toString())&&(e=t,s=e.Narration.toString(),s.length>0&&s.Contains("/")))){o=this.dsMain.Tables[0].NewRow();for(let t=0;t<this.dsMain.Columns[0].length;t++)o[t]=e[t];o.RType=1,e.RType=2,this.IsDocDateWise&&(o.Adjusted=e.AdjustedBillAmount,o.Amount=e.BillAmount),this.dsMain.Tables[0].InsertAt(o,this.dsMain.Tables[0].length-1)}}for(this.iMainRow=0;this.iMainRow<this.dv.length;this.iMainRow++){if(this.ViewModel.process.CancellationPending)return void(this.ViewModel.processArgs.Cancel=!0);this.drMainRow=this.dv[this.iMainRow],-1!=this.colPaidByDaysIndex&&1==this.ViewModel.lstGroup.length&&this.ViewModel.Groupstr[this.lstGroup[0].ID]!=this.drMainRow[this.lstGroup[0].ID].toString()&&(0!=this.AggTotal[this.colPaidByDaysIndex][1]&&(this.dblPaidDaysTotal+=this.ViewModel.totals[this.colPaidByDaysIndex][1],this.ViewModel.totals[this.colPaidByDaysIndex][1]/=this.AggTotal[this.colPaidByDaysIndex][1],this.AggTotal[this.colPaidByDaysIndex][0]+=this.AggTotal[this.colPaidByDaysIndex][1]),this.AggTotal[this.colPaidByDaysIndex][1]=0),this.ViewModel.AddGroupRows(this.dv,this.iMainRow),this.addRows()}if(-1!=this.colPaidByDaysIndex&&1==this.ViewModel.lstGroup.length&&0!=this.AggTotal[this.colPaidByDaysIndex][1]&&(this.dblPaidDaysTotal+=this.ViewModel.totals[this.colPaidByDaysIndex][1],this.ViewModel.totals[this.colPaidByDaysIndex][1]/=this.AggTotal[this.colPaidByDaysIndex][1],this.AggTotal[this.colPaidByDaysIndex][0]+=this.AggTotal[this.colPaidByDaysIndex][1]),-1!=this.colBalanceCumIndex)for(let e=0;e<this.lstGroup.length;e++)this.ViewModel.totals[this.colBalanceCumIndex][e]=0;this.ViewModel.CheckAndAddTotals(this.dsMain.Tables[0]),-1!=this.colPaidByDaysIndex&&this.ViewModel.GrpReportTotal.SubTotalAppearance.IsVisible&&this.AggTotal[this.colPaidByDaysIndex][0]>0&&(this.ViewModel.totals[this.colPaidByDaysIndex][0]=this.dblPaidDaysTotal/this.AggTotal[this.colPaidByDaysIndex][0],this.ViewModel.SetCellValue(this.ViewModel.totals[this.colPaidByDaysIndex][0],this.oColumns[this.colPaidByDaysIndex].DataFormat,"FLOAT",this.ViewModel.Data[this.ViewModel.Data.length-1].Cells[this.colPaidByDaysIndex]))}else 11==this.ViewModel.StaticReportType?(this.ViewModel.ReportData=this.dsMain.Tables[0],this.ViewModel.ReportDataColumns=this.dsMain.Columns[0],this.ViewModel.ConstructFormulaFields(!0),this.ViewModel.FormulasCalculated=!1,this.addBillWiseAgeing(),this.ViewModel.FormulasCalculated=!0):12==this.ViewModel.StaticReportType&&(this.ViewModel.ReportData=this.dsMain.Tables[0],this.ViewModel.ReportDataColumns=this.dsMain.Columns[0],this.ViewModel.ConstructFormulaFields(!0),this.ViewModel.FormulasCalculated=!1,this.ShowLevelTree||(this.GroupTotalsAtEnd=!1),this.lstGroup.length<=1?this.AddRow_AgeingAnalysis():this.AddRow_AgeingAnalysisWithGroups(),this.ViewModel.FormulasCalculated=!0);this.ViewModel.process_RunWorkerCompleted()}GroupbyDocNo(e,t,s){let o=new Array;for(let i=0;i<e.length;i++)if(!o.Contains(e[i])){let l=0,a=0,n=0,r=0,h=0,u=t.split("~"),D=e;if(u.length>0)for(let t=0;t<u.length;t++)D=D.filter(s=>s[u[t]]=e[i][u[t]].toString());if(D.length>1){for(let e=1;e<D.length;e++)s.Contains("Amount")&&""!=D[e].Amount.toString()&&(l+=parseFloat(D[e].Amount.toString())),s.Contains("BillAmount")&&""!=D[e].BillAmount.toString()&&(a+=parseFloat(D[e].BillAmount.toString())),s.Contains("Adjusted")&&""!=D[e].Adjusted.toString()&&(n+=parseFloat(D[e].Adjusted.toString())),s.Contains("AdjAmount")&&""!=D[e].AdjAmount.toString()&&(r+=parseFloat(D[e].AdjAmount.toString())),s.Contains("Paid")&&""!=D[e].Paid.toString()&&(h+=parseFloat(D[e].Paid.toString())),o.push(D[e]);s.Contains("Amount")&&(D[0].Amount=""!=D[0].Amount.toString()?parseFloat(D[0].Amount.toString())+l:l),s.Contains("BillAmount")&&(D[0].BillAmount=""!=D[0].BillAmount.toString()?parseFloat(D[0].BillAmount.toString())+a:a),s.Contains("Adjusted")&&(D[0].Adjusted=""!=D[0].Adjusted.toString()?parseFloat(D[0].Adjusted.toString())+n:n),s.Contains("AdjAmount")&&(D[0].AdjAmount=""!=D[0].AdjAmount.toString()?parseFloat(D[0].AdjAmount.toString())+r:r),s.Contains("Paid")&&(D[0].Paid=""!=D[0].Paid.toString()?parseFloat(D[0].Paid.toString())+h:h)}}for(let i=0;i<o.length;i++)e.Remove(o[i])}LoadReportWithPostFilters(e){if(this.GrdRow=-1,this.dblBalanceCum=0,this.dblPaidDaysTotal=0,this.AggTotal=i.e.NumArray(this.oColumns.length+this.Slabs.length,2),this.ViewModel.totals=i.e.NumArray(this.oColumns.length,this.lstGroup.length+1),this.ViewModel.ClearRows(),this.ViewModel.lstGroupIndex.Clear(),null!=this.dsMain){if(this.dv=d.a.FilterData(this.dvTable,this.ViewModel.PostDataFetchFilterFields),9==this.ViewModel.StaticReportType||10==this.ViewModel.StaticReportType){for(9==this.ViewModel.StaticReportType&&(this.dvChild=this.dvChildTable=this.dsMain.Tables[1]),this.iMainRow=0;this.iMainRow<this.dv.length;this.iMainRow++)this.drMainRow=this.dv[this.iMainRow],this.ViewModel.AddGroupRows(this.dv,this.iMainRow),this.addRows();this.ViewModel.CheckAndAddTotals(this.dv)}else 11==this.ViewModel.StaticReportType?this.addBillWiseAgeing():12==this.ViewModel.StaticReportType&&(this.dsMain.Columns[0].Contains("TotalPDC")&&this.dsMain.Tables[0].map(e=>e.TotalPDC=0),0==this.lstGroup.length?this.AddRow_AgeingAnalysis():this.AddRow_AgeingAnalysisWithGroups());this.ViewModel.process_RunWorkerCompleted()}}GetDataSet(e,t){if(this.FIFO)return this.GetDataSetFIFO(e,t);if(this.BWPerformance)return this.GetDataSetNew(e,t);let s,l,a,n,r="",h="",D="",d="",c="",C="",p=!1,T=!1;p=0!=this.oColumns.filter(e=>"BillNo"==e.ID).length,T=0!=this.oColumns.filter(e=>"BillDate"==e.ID).length;let _="";this.UnPostedDocsList.length>0&&this.UnPostedDocsList.split(",").forEach(e=>{d+=" or StatusID="+e});let m="(StatusID=370 OR StatusID=439"+d+(this.IncludeTerminatedPDC?" OR StatusID=452":"")+")";d=" and (StatusID=369 or StatusID=429"+d+")";let I=this.GetAccountWiseLocationWhere("A"),R=this.GetDimensionFilter("B.dcCCNID"),S=!1;this.ViewModel.HideCostCenterTree||this.ViewModel.oReportDialog.IsZeroSelected||this.ViewModel.oReportDialog.IsOneSelected||(S=!0,this.ViewModel.oReportDialog.IsGroupExists?(D="AccountID=GTP.GTID",h=t.Contains(",")?",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID IN ("+t+") group by T.AccountID) AS GTP ":",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID="+t+" group by T.AccountID) AS GTP "):D=t.Contains(",")?"AccountID IN ("+t+")":"AccountID="+t),this.ForeignCurrencyID>0?(l="B.AmountFC",a="CB.AmountFC",s="AmountFC",n="/B.AdjExchRT"):(1==this.CurrencyType?(s="isnull(AmountBC,0)",l="isnull(B.AmountBC,0)",a="isnull(CB.AmountBC,0)"):(s="AdjAmount",l="B.AdjAmount",a="CB.AdjAmount"),n=""),_=this.GetAccountTypeWhere("A"),this.sbSubQuery="",this.GroupRowsCount=0;let A="",M="";if(this.strOrder="",this.ViewModel.ReportGroups.forEach(t=>{2==t.CDGDO.ColumnCostCenterID?(A+="A."+t.CDGDO.Column+" AS "+t.ID+",A.AccountID AS "+t.ID+"_ID,","1"!=t.ShowAsColumn.SelectedValue&&(this.AccountGroupIndex=this.GroupRowsCount),!this.ViewModel.Preferences.ContainsKey("TreeSortOn")||9!=e&&10!=e||("Code"==this.ViewModel.Preferences.TreeSortOn?(A+="A.AccountCode AccOrder,",this.strOrder+="AccOrder,"):"TreeOrder"==this.ViewModel.Preferences.TreeSortOn&&(A+="A.lft AccOrder,",this.strOrder+="AccOrder,"))):t.CDGDO.ColumnCostCenterID>5e4&&400==t.CDGDO.CategoryValue&&(t.CDGDO.ParentTableAlias="C"+t.CDGDO.ColumnCostCenterID,A+=t.CDGDO.ParentTableAlias+"."+t.CDGDO.Column+" AS "+t.ID+","+t.CDGDO.ParentTableAlias+".NodeID AS "+t.ID+"_ID,",11!=this.ViewModel.StaticReportType&&12!=this.ViewModel.StaticReportType&&50002==t.CDGDO.ColumnCostCenterID||(M+=" INNER JOIN "+t.CDGDO.ParentCostCenterSysName+" AS "+t.CDGDO.ParentTableAlias,M+=" WITH(NOLOCK) ON "+t.CDGDO.ParentTableAlias+".NodeID=B."+t.CDGDO.ParentColumn)),this.strOrder+=t.ID+",","1"!=t.ShowAsColumn.SelectedValue&&this.GroupRowsCount++}),p||T){let e=o.a.report.ReportDataTable("RPT022",this.ViewModel.IsReportDB,"select CostCenterID from ADM_CostCenterDef where SysColumnName='BillNo' and IsVisible=1 and SysTableName='ACC_DocDetails'");p&&(c=null!=e&&e.length>0&&i.e.hasprop(e[0],"CostCenterID")&&!Object(u.isUndefined)(e[0].CostCenterID)?",case when B.DocType=16 then (SELECT TOP 1 BillNo FROM ACC_DocDetails WITH(NOLOCK) WHERE B.DocNo=VoucherNo and B.DocSeqNo=DocSeqNo) else (SELECT TOP 1 BillNo FROM INV_DocDetails WITH(NOLOCK) WHERE B.DocNo=VoucherNo) end BillNo":",(SELECT TOP 1 BillNo FROM INV_DocDetails WITH(NOLOCK) WHERE B.DocNo=VoucherNo) BillNo"),T&&(C=null!=e&&e.length>0&&i.e.hasprop(e[0],"CostCenterID")&&!Object(u.isUndefined)(e[0].CostCenterID)?",case when B.DocType=16 then (SELECT TOP 1 CONVERT(DATETIME, BillDate) FROM ACC_DocDetails WITH(NOLOCK) WHERE B.DocNo=VoucherNo and B.DocSeqNo=DocSeqNo) else (SELECT TOP 1 CONVERT(DATETIME, BillDate) FROM INV_DocDetails WITH(NOLOCK) WHERE B.DocNo=VoucherNo) end BillDate":",(SELECT TOP 1 CONVERT(DATETIME, BillDate) FROM INV_DocDetails WITH(NOLOCK) WHERE B.DocNo=VoucherNo) BillDate")}if(9==e||10==e){let t="";t=this.PDCInclude?this.HidePDCAdjustments||!this.PDCSeperate&&!this.FilterPDCOnMaturityDate?" AND  ((SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo and "+m+")=1 OR (DocType<>14 AND DocType<>19 AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo"+d+")=1))":" AND  (DocType<>14 AND DocType<>19 AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo"+d+")=1)":" AND  DocType<>14 AND DocType<>19 AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo"+d+")=1",this.sbSubQuery+="DECLARE @To FLOAT\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",this.AllowFromDateFilter&&(this.sbSubQuery+="\ndeclare @From float SET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))"),this.sbSubQuery+="\nSELECT *,case when Amount>0 then 1 else 0 end AmtOrder FROM (",this.IsPaymentTermWise?(this.sbSubQuery+="\tSELECT A.AccountID,B.DocSeqNo,"+A+"\nCASE WHEN EXISTS (select * from COM_DocPayTerms WITH(NOLOCK) where VoucherNo=B.DocNo)\nTHEN (select CONVERT(DATETIME,max(DueDate)) from COM_DocPayTerms WITH(NOLOCK) where VoucherNo=B.DocNo and DueDate<=@To)\nELSE CONVERT(DATETIME,ISNULL(B.DocDueDate,B.DocDate)) END DocDate, \nCONVERT(DATETIME,B.DocDueDate) DueDate,CONVERT(DATETIME,B.DocDate) VoucherDate,B.DocNo,\nCASE WHEN EXISTS (select * from COM_DocPayTerms WITH(NOLOCK) where VoucherNo=B.DocNo)\nTHEN (select sum(amount)*sign(B.AdjAmount)"+n+" from COM_DocPayTerms WITH(NOLOCK) where VoucherNo=B.DocNo and DueDate<=@To)\nELSE "+s+" END Amount,\n"+s+" BillAmount",p&&(this.sbSubQuery+=c),T&&(this.sbSubQuery+=C),this.sbSubQuery+=",C50002.Name AS Location,    \n(SELECT SUM("+s+") Adjusted FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND ",this.sbSubQuery+=this.PDCOnConvresionDate?"isnull(CB.ConvertedDate,CB.DocDate)<=@To":"CB.DocDate<=@To",this.sbSubQuery+=" AND CB.AccountID=B.AccountID AND CB.RefDocNo=B.DocNo"+t+" AND CB.RefDocSeqNo=B.DocSeqNo)",this.sbSubQuery+=" Adjusted"+this.ViewModel.SelectTag+"\n,(B.DocDueDate-B.DocDate) CreditDays\n,@To-(CASE WHEN EXISTS (select * from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo)\nTHEN (select max(DueDate) from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo and DueDate<=@To)\nELSE B.DocDueDate END) OverDue\n,DocType,(SELECT TOP 1 ACC.StatusID FROM ACC_DocDetails ACC with(nolock) WHERE ACC.VoucherNo=B.DocNo) StatusID",this.ClubByVoucherNo&&(this.sbSubQuery+=",B.Narration"),this.UnAppsDocsAdjustSeperate&&(this.sbSubQuery+=",0 IsUnappAdj"),this.PDCSeperate&&(this.sbSubQuery+=",case when DocType=14 or DocType=19 then 1 else 0 end IsPDC,null AgainstVoucher"),-1!=this.colLOBPDCIndex&&(this.sbSubQuery+=",(SELECT abs(SUM("+a+")) FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@To AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo and "+m+")=1)  LOBPDC"),this.sbSubQuery+=" \nFROM COM_Billwise B with(nolock) INNER JOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID     \nINNER JOIN COM_Location AS C50002 ON B.dcCCNID2 = C50002.NodeID ",this.ViewModel.SelectTag.length>0&&this.ViewModel.SelectTag.Contains("AT.AccountType")&&(this.sbSubQuery+=" INNER JOIN ACC_ACCOUNTTYPES AT WITH(NOLOCK) ON AT.AccountTypeID=A.AccountTypeID "),this.sbSubQuery+=M+this.ViewModel.FromTag,S&&(this.sbSubQuery+=h),this.sbSubQuery+=" WHERE B.IsNewReference=1 "):(this.sbSubQuery+="\tSELECT A.AccountID,B.DocSeqNo,"+A,this.sbSubQuery+=this.GetDateColumn("B",""),this.sbSubQuery+=",CONVERT(DATETIME,B.DocDueDate) DueDate,CONVERT(DATETIME,B.DocDate) VoucherDate,B.DocNo,\n"+s+" Amount,",this.ClubByVoucherNo?(this.sbSubQuery+="(select sum("+s+") from COM_Billwise CB with(nolock) where CB.AccountID=B.AccountID AND CB.DocNo=B.DocNo and IsNewReference=1) BillAmount",this.sbSubQuery+=",(SELECT SUM("+s+") Adjusted FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND ",this.sbSubQuery+=this.PDCOnConvresionDate?"isnull(CB.ConvertedDate,CB.DocDate)<=@To":"CB.DocDate<=@To",this.sbSubQuery+=" AND CB.AccountID=B.AccountID AND CB.RefDocNo=B.DocNo"+t+")",this.UnAppsDocsAdjustSeperate&&(this.sbSubQuery+="+(case when ((B.DocType>=14 and B.DocType<=23) or B.DocType=28 or B.DocType=29) and B.StatusID=371 then AdjAmount else isnull((SELECT -SUM(AdjAmount) Adjusted \nFROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND isnull(CB.ConvertedDate,CB.DocDate)<=@To AND CB.AccountID=B.AccountID AND CB.RefDocNo=B.DocNo\nand CB.StatusID=371 and ((CB.DocType>=14 and CB.DocType<=23) or CB.DocType=28 or CB.DocType=29)),0)\nend)"),this.sbSubQuery+=" AdjustedBillAmount"):this.sbSubQuery+=s+" BillAmount",p&&(this.sbSubQuery+=c),T&&(this.sbSubQuery+=C),this.sbSubQuery+=",C50002.Name AS Location,    \n(SELECT SUM("+s+") Adjusted FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND ",this.sbSubQuery+=this.PDCOnConvresionDate?"isnull(CB.ConvertedDate,CB.DocDate)<=@To":"CB.DocDate<=@To",this.sbSubQuery+=" AND CB.AccountID=B.AccountID AND CB.RefDocNo=B.DocNo"+t+" AND CB.RefDocSeqNo=B.DocSeqNo)",this.UnAppsDocsAdjustSeperate&&(this.sbSubQuery+="+(case when ((B.DocType>=14 and B.DocType<=23) or B.DocType=28 or B.DocType=29) and B.StatusID=371 then AdjAmount else isnull((SELECT -SUM(AdjAmount) Adjusted \nFROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND isnull(CB.ConvertedDate,CB.DocDate)<=@To AND CB.AccountID=B.AccountID AND CB.RefDocNo=B.DocNo and CB.RefDocSeqNo=B.DocSeqNo\nand CB.StatusID=371 and ((CB.DocType>=14 and CB.DocType<=23) or CB.DocType=28 or CB.DocType=29)),0)\nend)"),this.sbSubQuery+=" Adjusted"+this.ViewModel.SelectTag+",(B.DocDueDate-B.DocDate) CreditDays\n,@To-B."+this.ViewModel.Preferences.Date+" OverDue\n,DocType,(SELECT TOP 1 ACC.StatusID FROM ACC_DocDetails ACC with(nolock) WHERE ACC.VoucherNo=B.DocNo) StatusID",this.ClubByVoucherNo&&(this.sbSubQuery+=",B.Narration"),this.UnAppsDocsAdjustSeperate&&(this.sbSubQuery+=",0 IsUnappAdj"),this.PDCSeperate&&(this.sbSubQuery+=",case when DocType=14 or DocType=19 then 1 else 0 end IsPDC,null AgainstVoucher"),-1!=this.colLOBPDCIndex&&(this.sbSubQuery+=",(SELECT abs(SUM("+a+")) FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@To AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo and "+m+")=1)  LOBPDC"),this.sbSubQuery+=" \nFROM COM_Billwise B with(nolock) INNER JOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID     \nINNER JOIN COM_Location AS C50002 with(nolock) ON B.dcCCNID2 = C50002.NodeID ",this.ViewModel.SelectTag.length>0&&this.ViewModel.SelectTag.Contains("AT.AccountType")&&(this.sbSubQuery+=" INNER JOIN ACC_ACCOUNTTYPES AT WITH(NOLOCK) ON AT.AccountTypeID=A.AccountTypeID "),this.sbSubQuery+=M+this.ViewModel.FromTag,S&&(this.sbSubQuery+=h),this.sbSubQuery+=" WHERE B.IsNewReference=1",this.sbSubQuery+=this.GetDateColumn("B","@To"));let l="";l+=R,S&&(l+=" AND A."+D),l+=I,l+=_,this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?l+=" AND 1<>1":l+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),this.ForeignCurrencyID>0&&(l+=" AND B.AdjCurrID="+this.ForeignCurrencyID),l+=this.GetDocumentTypeFilter(),this.sbSubQuery+=l.toString(),this.sbSubQuery+=" ) AS T ";let u="";if(this.UnAdjusted&&(u="Adjusted IS NULL"),this.SemiAdjusted&&(u.length>0&&(u+=" OR "),u+="abs(Amount+Adjusted)>"+this.AdjustmentRoundOff),this.Adjusted&&(u.length>0&&(u+=" OR "),u+="abs(Amount+Adjusted)<"+this.AdjustmentRoundOff),this.UnAppsDocsAdjustSeperate&&(u+=" or StatusID=371"),u="("+u+")",this.IsPaymentTermWise&&(u+=" AND DocDate<=@To AND Amount IS NOT NULL"),u+=this.PDCInclude?this.PDCSeperate||this.FilterPDCOnMaturityDate?" AND (DocType<>14 AND DocType<>19"+d+")":" AND ("+m+" OR (DocType<>14 AND DocType<>19"+d+"))":" AND DocType<>14 AND DocType<>19"+d,u.length>0&&(this.sbSubQuery+=" WHERE "+u),this.PDCSeperate||this.FilterPDCOnMaturityDate){let e,t="PaymentTerm"==this.ViewModel.Preferences.Date?"B.DocDate":"B."+this.ViewModel.Preferences.Date;this.FilterPDCOnMaturityDate?(e="CM.ChequeMaturityDate",t="CM.ChequeMaturityDate"):e=t,this.sbSubQuery+="\nUNION ALL  SELECT *,case when Amount>0 then 1 else 0 end AmtOrder FROM (",this.sbSubQuery+="\tSELECT A.AccountID,B.DocSeqNo,"+A+"CONVERT(DATETIME,"+t+") DocDate,CONVERT(DATETIME,B.DocDueDate) DueDate,CONVERT(DATETIME,B.DocDate) VoucherDate,B.DocNo,\n"+s+" Amount,"+s+" BillAmount",this.ClubByVoucherNo&&(this.sbSubQuery+=",0 AdjustedBillAmount"),p&&(this.sbSubQuery+=c),T&&(this.sbSubQuery+=C),this.sbSubQuery+=",C50002.Name AS Location,0 Adjusted"+this.ViewModel.SelectTag+"\n,(B.DocDueDate-B.DocDate) CreditDays\n,@To-"+t+" OverDue\n,DocType,(SELECT TOP 1 ACC.StatusID FROM ACC_DocDetails ACC with(nolock) WHERE ACC.VoucherNo=B.DocNo) StatusID",this.ClubByVoucherNo&&(this.sbSubQuery+=",B.Narration"),this.UnAppsDocsAdjustSeperate&&(this.sbSubQuery+=",0 IsUnappAdj"),this.PDCSeperate&&(this.sbSubQuery+=",1 IsPDC,case when B.IsNewReference=0 then B.RefDocNo else null end AgainstVoucher"),-1!=this.colLOBPDCIndex&&(this.sbSubQuery+=",(SELECT abs(SUM("+a+")) FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@To AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo and "+m+")=1) LOBPDC"),this.sbSubQuery+=" \nFROM COM_Billwise B with(nolock) INNER JOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID     \nINNER JOIN COM_Location AS C50002 with(nolock) ON B.dcCCNID2 = C50002.NodeID ",this.ViewModel.SelectTag.length>0&&this.ViewModel.SelectTag.Contains("AT.AccountType")&&(this.sbSubQuery+=" INNER JOIN ACC_ACCOUNTTYPES AT WITH(NOLOCK) ON AT.AccountTypeID=A.AccountTypeID "),this.sbSubQuery+=M+this.ViewModel.FromTag,this.FilterPDCOnMaturityDate&&(this.sbSubQuery+=" \nINNER JOIN (select VoucherNo,max(ChequeMaturityDate) ChequeMaturityDate from acc_docdetails with(nolock) where "+m+" group by VoucherNo) as CM\nON CM.VoucherNo=B.DocNo "),S&&(this.sbSubQuery+=h),this.sbSubQuery+=" WHERE (B.DocType=19 or B.DocType=14)",this.AllowFromDateFilter&&(this.sbSubQuery+=" and "+e+">=@From "),this.sbSubQuery+=" and "+e+"<=@To ",this.sbSubQuery+=l.toString(),this.sbSubQuery+=" ) AS T ",u="",this.UnAdjusted&&(u="Adjusted IS NULL"),this.SemiAdjusted&&(u.length>0&&(u+=" OR "),u+="abs(Amount+Adjusted)>"+this.AdjustmentRoundOff),this.Adjusted&&(u.length>0&&(u+=" OR "),u+="abs(Amount+Adjusted)<"+this.AdjustmentRoundOff),u="("+u+")",u+=" AND "+m,u.length>0&&(this.sbSubQuery+=" WHERE "+u)}if(10==e&&this.UnAppsDocsAdjustSeperate&&(this.sbSubQuery+="\nUNION ALL ",this.sbSubQuery+="\nSELECT *,case when Amount>0 then 1 else 0 end AmtOrder FROM (",this.sbSubQuery+="\tSELECT A.AccountID,B.DocSeqNo,"+A,this.sbSubQuery+=this.GetDateColumn("B",""),this.sbSubQuery+=",CONVERT(DATETIME,B.DocDueDate) DueDate,CONVERT(DATETIME,B.DocDate) VoucherDate,B.DocNo,\n"+s+" Amount,",this.ClubByVoucherNo?(this.sbSubQuery+="(select sum("+s+") from COM_Billwise CB with(nolock) where CB.AccountID=B.AccountID AND CB.DocNo=B.DocNo and IsNewReference=1) BillAmount",this.sbSubQuery+=",(SELECT SUM("+s+") Adjusted FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND ",this.sbSubQuery+=this.PDCOnConvresionDate?"isnull(CB.ConvertedDate,CB.DocDate)<=@To":"CB.DocDate<=@To",this.sbSubQuery+=" AND CB.AccountID=B.AccountID AND CB.RefDocNo=B.DocNo"+t+") AdjustedBillAmount"):this.sbSubQuery+=s+" BillAmount",p&&(this.sbSubQuery+=c),T&&(this.sbSubQuery+=C),this.sbSubQuery+=",C50002.Name AS Location,null Adjusted\n"+this.ViewModel.SelectTag+",(B.DocDueDate-B.DocDate) CreditDays\n,@To-B."+this.ViewModel.Preferences.Date+" OverDue\n,DocType,B.StatusID StatusID",this.ClubByVoucherNo&&(this.sbSubQuery+=",B.Narration"),this.UnAppsDocsAdjustSeperate&&(this.sbSubQuery+=",1 IsUnappAdj"),this.PDCSeperate&&(this.sbSubQuery+=",case when DocType=14 or DocType=19 then 1 else 0 end IsPDC,null AgainstVoucher"),-1!=this.colLOBPDCIndex&&(this.sbSubQuery+=",null  LOBPDC"),this.sbSubQuery+=" \nFROM COM_Billwise B with(nolock) INNER JOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID     \nINNER JOIN COM_Location AS C50002 with(nolock) ON B.dcCCNID2 = C50002.NodeID ",this.ViewModel.SelectTag.length>0&&this.ViewModel.SelectTag.Contains("AT.AccountType")&&(this.sbSubQuery+=" INNER JOIN ACC_ACCOUNTTYPES AT WITH(NOLOCK) ON AT.AccountTypeID=A.AccountTypeID "),this.sbSubQuery+=M+this.ViewModel.FromTag,S&&(this.sbSubQuery+=h),this.sbSubQuery+=" WHERE B.IsNewReference=0 and (B.StatusID=371 or B.RefStatusID=371)",this.sbSubQuery+=this.GetDateColumn("B","@To"),l="",l+=R,S&&(l+=" AND A."+D),l+=I,l+=_,this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?l+=" AND 1<>1":l+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),this.ForeignCurrencyID>0&&(l+=" AND B.AdjCurrID="+this.ForeignCurrencyID),l+=this.GetDocumentTypeFilter(),this.sbSubQuery+=l.toString(),this.sbSubQuery+=" ) AS T ",u="",this.IsPaymentTermWise&&(u+=" AND DocDate<=@To AND Amount IS NOT NULL"),u.length>0&&(this.sbSubQuery+=" WHERE "+u)),this.sbSubQuery+=" ORDER BY "+this.strOrder,this.PDCSeperate&&(this.sbSubQuery+="IsPDC,"),this.UnPostedDocsSeparately&&(this.sbSubQuery+="StatusID,"),this.sbSubQuery+="DocDate,AmtOrder,DocNo",this.UnAppsDocsAdjustSeperate&&(this.sbSubQuery+=",IsUnappAdj"),9==e){let e="";-1!=this.colRefAccount&&(e=o.a.report.GetReportData(18,0,"").Tables[0][0].RefAccount.toString()),this.sbSubQuery+="\nSELECT ",this.sbSubQuery+=this.PDCOnConvresionDate?"CONVERT(DATETIME,isnull(B.ConvertedDate,B.DocDate)) DocDate":"CONVERT(DATETIME, B.DocDate) DocDate",this.sbSubQuery+=",B.DocNo,B.RefDocSeqNo,"+s+" AS AdjAmount",p&&(this.sbSubQuery+=c),T&&(this.sbSubQuery+=C),this.sbSubQuery+=this.ViewModel.SelectTag+e,this.sbSubQuery+=",RefDocNo,DATEDIFF(day,CONVERT(DATETIME,RefDocDate),CONVERT(DATETIME, B.DocDate)) PaidByDays\nFROM COM_Billwise B WITH(NOLOCK) INNER JOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID",this.ViewModel.SelectTag.length>0&&this.ViewModel.SelectTag.Contains("AT.AccountType")&&(this.sbSubQuery+=" INNER JOIN ACC_ACCOUNTTYPES AT WITH(NOLOCK) ON AT.AccountTypeID=A.AccountTypeID "),this.sbSubQuery+=this.ViewModel.FromTag,S&&(this.sbSubQuery+=h),this.sbSubQuery+=" WHERE IsNewReference=0",this.sbSubQuery+=this.PDCOnConvresionDate?" AND isnull(B.ConvertedDate,B.DocDate)<=@To ":" AND B.DocDate<=@To ",this.sbSubQuery+=t.Replace("CB.","B."),S&&(this.sbSubQuery+=" AND B."+D),this.sbSubQuery+=I}r=this.sbSubQuery.toString()}else if(11==e){let e="";e=this.PDCInclude?" AND  ((SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo and "+m+")=1 OR (DocType<>14 AND DocType<>19 AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo"+d+")=1))":" AND  DocType<>14 AND DocType<>19 AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo"+d+")=1",this.sbSubQuery+=this.dtMonthWiseEndData?"DECLARE @AsOn FLOAT SET @AsOn=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.dtMonthWiseEndData.ToString("dd MMM yyyy")+"'))":"DECLARE @AsOn FLOAT SET @AsOn=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",this.AllowFromDateFilter&&(this.sbSubQuery+="\ndeclare @From float SET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))"),this.IsPaymentTermWise?(this.sbSubQuery+=" SELECT * FROM (SELECT "+A+"B.DocNo VoucherNo,"+s+" BillAmount"+this.ViewModel.SelectTag,this.sbSubQuery+=",CASE WHEN EXISTS (select * from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo)\nTHEN (select CONVERT(DATETIME,max(DueDate)) from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo and DueDate<=@AsOn)\nELSE CONVERT(DATETIME,ISNULL(B.DocDueDate,B.DocDate)) END DocDate, \nCONVERT(DATETIME,B.DocDueDate) DueDate,\nCASE WHEN EXISTS (select * from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo)\nTHEN (select sum(amount)*sign(B.AdjAmount)"+n+" from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo and DueDate<=@AsOn)\nELSE "+s+" END AdjAmount, @AsOn-B.DocDueDate OverDue"):(this.sbSubQuery+="\tSELECT "+A+"B.DocNo VoucherNo,"+s+" BillAmount"+this.ViewModel.SelectTag,this.sbSubQuery+=","+this.GetDateColumn("B",""),this.sbSubQuery+=",CONVERT(DATETIME,B.DocDueDate) DueDate,"+s+" AdjAmount,@AsOn-B."+this.ViewModel.Preferences.Date+" OverDue"),this.sbSubQuery+=",ISNULL((SELECT SUM("+a+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0",this.sbSubQuery+=this.PDCOnConvresionDate?" AND ISNULL(CB.ConvertedDate,CB.DocDate)<=@AsOn":" AND CB.DocDate<=@AsOn",this.sbSubQuery+=e+"),0) Paid",this.sbSubQuery+=",(B.DocDueDate-B.DocDate) CreditDays",p&&(this.sbSubQuery+=c),T&&(this.sbSubQuery+=C),-1==this.colPDCIndex&&-1==this.colNetBalanceIndex||(this.colPDCIndex=0,this.sbSubQuery+=",(SELECT abs(SUM("+a+")) FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@AsOn AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo and "+m+")=1)  TotalPDC",this.PDCInclude&&(this.sbSubQuery+=",(SELECT TOP 1 ACC.StatusID FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo) Status")),this.sbSubQuery+=",case when AdjAmount>0 then 1 else 0 end AmtOrder",this.BWAgeingShowOnlyDocs&&(this.sbSubQuery+=",DType.IsInventory",this.ViewModel.FromTag.Contains("DType")||(this.ViewModel.FromTag=" INNER JOIN (SELECT DocumentType,IsInventory FROM ADM_DocumentTypes with(nolock) Group By DocumentType,IsInventory) AS DType ON  DType.DocumentType=B.DocType "+this.ViewModel.FromTag)),this.sbSubQuery+=" FROM COM_Billwise B with(nolock) INNER JOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID ",this.ViewModel.SelectTag.length>0&&this.ViewModel.SelectTag.Contains("AT.AccountType")&&(this.sbSubQuery+=" INNER JOIN ACC_ACCOUNTTYPES AT WITH(NOLOCK) ON AT.AccountTypeID=A.AccountTypeID "),this.sbSubQuery+=M+this.ViewModel.FromTag,S&&(this.sbSubQuery+=h),this.sbSubQuery+=" WHERE B.IsNewReference=1",this.IsPaymentTermWise||(this.sbSubQuery+=this.GetDateColumn("B","@AsOn")),this.sbSubQuery+=R,"Receivables"==this.ViewModel.Preferences.IncludeBills?this.sbSubQuery+=" AND "+l+">0":"Payables"==this.ViewModel.Preferences.IncludeBills&&(this.sbSubQuery+=" AND "+l+"<0"),this.sbSubQuery+=this.GetDocumentTypeFilter(),this.sbSubQuery+=this.PDCInclude?" AND ((SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo and "+m+")=1 OR (DocType<>14 AND DocType<>19 AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo"+d+")=1))":" AND DocType<>14 AND DocType<>19 AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo"+d+")=1",S&&(this.sbSubQuery+=" AND A."+D),this.sbSubQuery+=I,this.sbSubQuery+=_,this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?this.sbSubQuery+=" AND 1<>1":this.sbSubQuery+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),this.ForeignCurrencyID>0&&(this.sbSubQuery+=" AND B.AdjCurrID="+this.ForeignCurrencyID),this.IsPaymentTermWise?(this.sbSubQuery+=" ) AS T WHERE DocDate<=@AsOn AND AdjAmount IS NOT NULL ",this.sbSubQuery+=" ORDER BY "+this.strOrder+"DocDate,AmtOrder,VoucherNo",this.sbSubQuery+="\nSELECT PT.VoucherNo,PT.Amount"+n+" Amount,CONVERT(DATETIME,PT.DueDate) DueDate\nFROM  COM_Billwise B with(nolock) INNER JOIN COM_DocPayTerms PT with(nolock) ON PT.VoucherNo=B.DocNo",I.length>0&&(this.sbSubQuery+=" INNER JOIN ACC_Accounts A ON A.AccountID=B.AccountID"),S&&(this.sbSubQuery+=h),this.sbSubQuery+=" WHERE B.IsNewReference=1 and B.AccountID=PT.AccountID AND PT.DueDate<=@AsOn ",S&&(this.sbSubQuery+=" AND B."+D),this.sbSubQuery+=I,this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?this.sbSubQuery+=" AND 1<>1":this.sbSubQuery+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")")):this.sbSubQuery+=" ORDER BY "+this.strOrder+"DocDate,AmtOrder,DocNo",r=this.sbSubQuery.toString()}else if(12==e){let e="";e=this.PDCInclude?" AND  ((SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo and "+m+")=1 OR (DocType<>14 AND DocType<>19 AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo"+d+")=1))":" AND  DocType<>14 AND DocType<>19 AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo"+d+")=1";let t=this.ViewModel.Preferences.ContainsKey("SalesDocs")?this.ViewModel.Preferences.SalesDocs:"",u=this.ViewModel.Preferences.ContainsKey("ReceiptDocs")?this.ViewModel.Preferences.ReceiptDocs:"",c=this.ViewModel.Preferences.ContainsKey("ChequeBounceDocs")?this.ViewModel.Preferences.ChequeBounceDocs:"";if(this.lstGroup.length<=1){let C="";if(t.length>0?(-1!=this.colTotalSaleIndex&&(C=",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+t+") AND SALE.DocDate>=@AccountingDate AND SALE.DocDate<=@AsOnDate"+d+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+t+") AND SALE.DocDate>=@AccountingDate AND SALE.DocDate<=@AsOnDate"+d+"),0)  TotalSale"),-1!=this.colPrevYearSaleIndex&&(C=C+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+t+") AND SALE.DocDate<@AccountingDate"+d+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+t+") AND SALE.DocDate<@AccountingDate"+d+"),0)  PrevYearSale"),-1!=this.colPeriodSaleIndex&&(C=C+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) \njoin com_docccdata b on SALE.ACCDocDetailsid=b.ACCDocDetailsid\nWHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+t+") AND SALE.DocDate>=@FromDate AND SALE.DocDate<=@AsOnDate"+d+R+"),0) \n+ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) \njoin com_docccdata b on SALE.INVDocDetailsid=b.INVDocDetailsid\nWHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+t+") AND SALE.DocDate>=@FromDate AND SALE.DocDate<=@AsOnDate"+d+R+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) \njoin com_docccdata b on SALE.ACCDocDetailsid=b.ACCDocDetailsid\nWHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+t+") AND SALE.DocDate>=@FromDate AND SALE.DocDate<=@AsOnDate"+d+R+"),0)\n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) \njoin com_docccdata b on SALE.INVDocDetailsid=b.INVDocDetailsid\nWHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+t+") AND SALE.DocDate>=@FromDate AND SALE.DocDate<=@AsOnDate"+d+R+"),0) PeriodSale")):(this.colTotalSaleIndex=-1,this.colPrevYearSaleIndex=-1,this.colPeriodSaleIndex=-1),u.length>0&&-1!=this.colReceiptsAmtIndex?(C=C+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) \njoin com_docccdata b on SALE.ACCDocDetailsid=b.ACCDocDetailsid\nWHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+u+")",this.ViewModel.oReportDialog.FromDate.Visible&&(C+=" AND SALE.DocDate>=@FromDate"),C=C+" AND SALE.DocDate<=@AsOnDate"+d+R+"),0) \n+ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) \njoin com_docccdata b on SALE.INVDocDetailsid=b.INVDocDetailsid\nWHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+u+")",this.ViewModel.oReportDialog.FromDate.Visible&&(C+=" AND SALE.DocDate>=@FromDate"),C=C+" AND SALE.DocDate<=@AsOnDate"+d+R+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) \njoin com_docccdata b on SALE.ACCDocDetailsid=b.ACCDocDetailsid\nWHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+u+")",this.ViewModel.oReportDialog.FromDate.Visible&&(C+=" AND SALE.DocDate>=@FromDate"),C=C+" AND SALE.DocDate<=@AsOnDate"+d+R+"),0)\n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) \njoin com_docccdata b on SALE.INVDocDetailsid=b.INVDocDetailsid\nWHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+u+")",this.ViewModel.oReportDialog.FromDate.Visible&&(C+=" AND SALE.DocDate>=@FromDate"),C=C+" AND SALE.DocDate<=@AsOnDate"+d+R+"),0) ReceiptsAmount"):this.colReceiptsAmtIndex=-1,c.length>0&&-1!=this.colChqBounceAmtIndex?(C=C+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) \njoin com_docccdata b on SALE.ACCDocDetailsid=b.ACCDocDetailsid\nWHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+c+")",this.ViewModel.oReportDialog.FromDate.Visible&&(C+=" AND SALE.DocDate>=@FromDate"),C=C+" AND SALE.DocDate<=@AsOnDate"+d+R+"),0)\n+ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) \njoin com_docccdata b on SALE.INVDocDetailsid=b.INVDocDetailsid\nWHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+c+")",this.ViewModel.oReportDialog.FromDate.Visible&&(C+=" AND SALE.DocDate>=@FromDate"),C=C+" AND SALE.DocDate<=@AsOnDate"+d+R+"),0)\n\n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) \njoin com_docccdata b on SALE.ACCDocDetailsid=b.ACCDocDetailsid\nWHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+c+")",this.ViewModel.oReportDialog.FromDate.Visible&&(C+=" AND SALE.DocDate>=@FromDate"),C=C+" AND SALE.DocDate<=@AsOnDate"+d+R+"),0)\n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) \njoin com_docccdata b on SALE.INVDocDetailsid=b.INVDocDetailsid\nWHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+c+")",this.ViewModel.oReportDialog.FromDate.Visible&&(C+=" AND SALE.DocDate>=@FromDate"),C=C+" AND SALE.DocDate<=@AsOnDate"+d+R+"),0) ChequeBounceAmount"):this.colChqBounceAmtIndex=-1,-1!=this.colUnDueIndex&&(this.IsDocDateWise?(C=C+",(select sum(AMT) from (select "+l+"+ISNULL((SELECT SUM("+a+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND CB.IsNewReference=0",C+=this.PDCOnConvresionDate?" AND isnull(CB.ConvertedDate,CB.DocDate)<=@AsOnDate":" AND CB.DocDate<=@AsOnDate",C+=e+"),0)+case when B.DocDueDate is not null and B.DocDueDate >@AsOnDate then "+l+" else 0 end\n        AMT FROM COM_Billwise B WITH(NOLOCK) WHERE B.IsNewReference=1 AND B.AccountID=A.AccountID"):C=C+",(select sum(AMT) from (select "+l+" \n+(case when isnull(B.DocDueDate,B.DocDate)<=@AsOnDate then ISNULL((SELECT SUM("+a+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND CB.IsNewReference=0"+e+"),0) else 0 end)\nAMT FROM COM_Billwise B WITH(NOLOCK) WHERE B.IsNewReference=1 AND B.AccountID=A.AccountID AND isnull(B.DocDueDate,B.DocDate)<=@AsOnDate",C+=R,C+=this.PDCInclude?" AND ((SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo and "+m+")=1 OR (DocType<>14 AND DocType<>19 AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo"+d+")=1))":" AND DocType<>14 AND DocType<>19 AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo"+d+")=1",this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?C+=" AND 1<>1":C+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),this.ForeignCurrencyID>0&&(C+=" AND B.AdjCurrID="+this.ForeignCurrencyID),C+=") as T) ActualBill"),-1==this.colPDCIndex&&-1==this.colIncludingPDCIndex||(C+=",ISNULL((SELECT SUM("+a+") FROM COM_Billwise CB with(nolock) WHERE CB.AccountID=A.AccountID AND IsNewReference=1 AND CB.DocDate<=@AsOnDate AND "+m.Replace("StatusID","CB.StatusID")+R.Replace("B.","CB."),this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.StringIsNullOrEmpty(this.ViewModel.oReportDialog.LocationWhere)||(C+=" AND CB.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")")),C+="),0) TotalPDC "),this.lstGroup.length>0&&(this.lstGroup[0].ID="AccountName",this.ViewModel.Groupstr.Clear(),this.ViewModel.Groupstr.push("AccountName","")),this.LevelNo=0,this.ShowLevelTree=!1,this.ViewModel.Preferences.ContainsKey("ShowLevel")){let e=new i.f;e.LoadXml("<XML>"+this.ViewModel.Preferences.ShowLevel+"</XML>");let t=i.f.SelectSingleNode(e.DocumentElement,"IsChecked");null!=t&&"1"==t.innerHTML&&(this.ShowLevelTree=!0,t=i.f.SelectSingleNode(e.DocumentElement,"Text"),this.LevelNo=parseInt(t.innerHTML))}this.sbSubQuery="",this.sbSubQuery+="DECLARE @AccountingDate FLOAT,@AsOnDate FLOAT\nSET @AccountingDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+o.a.SessionManager.AccountingDate.ToString("dd MMM yyyy")+"'))",this.AllowFromDateFilter&&(this.sbSubQuery+="\ndeclare @From float SET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))"),this.sbSubQuery+=this.dtMonthWiseEndData?" SET @AsOnDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.dtMonthWiseEndData.ToString("dd MMM yyyy")+"'))":" SET @AsOnDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",(this.ViewModel.oReportDialog.FromDate.Visible||-1!=this.colPeriodSaleIndex)&&(this.sbSubQuery+="\ndeclare @FromDate float SET @FromDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"')) "),this.ShowLevelTree?(this.sbSubQuery+="SELECT A.AccountID,A.AccountName,A.lft,A.rgt,A.IsGroup,A.Depth"+C+this.ViewModel.SelectTag+" FROM ACC_Accounts A with(nolock)",this.ViewModel.SelectTag.length>0&&this.ViewModel.SelectTag.Contains("AT.AccountType")&&(this.sbSubQuery+=" INNER JOIN ACC_ACCOUNTTYPES AT WITH(NOLOCK) ON AT.AccountTypeID=A.AccountTypeID "),this.sbSubQuery+=this.ViewModel.FromTag,S&&(this.sbSubQuery+=h),this.sbSubQuery+=" WHERE A.Depth>0",S&&(this.sbSubQuery+=" AND A."+D),this.sbSubQuery+=I,_.length>0&&(this.sbSubQuery+=_),this.sbSubQuery+=" ORDER BY A.lft"):(this.sbSubQuery+="SELECT A.AccountID,A.AccountName"+C+this.ViewModel.SelectTag+" FROM ACC_Accounts A with(nolock)",this.ViewModel.SelectTag.length>0&&this.ViewModel.SelectTag.Contains("AT.AccountType")&&(this.sbSubQuery+=" INNER JOIN ACC_ACCOUNTTYPES AT WITH(NOLOCK) ON AT.AccountTypeID=A.AccountTypeID "),this.sbSubQuery+=this.ViewModel.FromTag,S&&(this.sbSubQuery+=h),this.sbSubQuery+=" WHERE A.Depth>0",S&&(this.sbSubQuery+=" AND A."+D),this.sbSubQuery+=I,this.sbSubQuery+=_,this.sbSubQuery+=" ORDER BY A.AccountName");let p="";this.IsPaymentTermWise?(p+="\nSELECT *,Amount+Paid AdjAmount FROM (SELECT B.DocNo,"+s+" BillAmount,CASE WHEN EXISTS (select * from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo)\nTHEN (select CONVERT(DATETIME,max(DueDate)) from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo and DueDate<=@AsOnDate)\nELSE CONVERT(DATETIME,ISNULL(B.DocDueDate,B.DocDate)) END DocDate,B.AccountID\n,CASE WHEN EXISTS (select * from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo)\nTHEN (select sum(amount)*sign(B.AdjAmount)"+n+" from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo and DueDate<=@AsOnDate)\nELSE "+s+" END Amount,\nISNULL(\n(SELECT SUM("+a+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND ",p+=this.PDCOnConvresionDate?"isnull(CB.ConvertedDate,CB.DocDate)<=@AsOnDate":"CB.DocDate<=@AsOnDate",p+=e+"),0) Paid"):(p+=" SELECT * from (",p+=" SELECT ",p+=this.GetDateColumn("B",""),-1!=this.colUnDueIndex&&(p+=",AdjAmount Amount"),-1!=this.colBillAmtIndex&&(p+=","+s+" BillAmount"),p+=",B.AccountID,"+s+"+ISNULL((SELECT SUM("+a+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND CB.IsNewReference=0",p+=this.PDCOnConvresionDate?" AND isnull(CB.ConvertedDate,CB.DocDate)<=@AsOnDate":" AND CB.DocDate<=@AsOnDate",p+=e+"),0) AdjAmount",this.AgeingBasedOnMaturityDate&&(p+=",convert(datetime,CM.ChequeMaturityDate) CqMaturityDate")),-1==this.colPDCIndex&&-1==this.colIncludingPDCIndex||(this.colPDCIndex=0,p+=",ISNULL((SELECT SUM("+a+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@AsOnDate"+R.Replace("B.","CB.")+" AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo and "+m+")=1),0) TotalPDC "),(-1!=this.colPDCIndex||-1!=this.colIncludingPDCIndex||this.AgeingBasedOnMaturityDate)&&this.PDCInclude&&(p+=",(SELECT TOP 1 ACC.StatusID FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo) Status"),p+=" FROM COM_Billwise B WITH(NOLOCK)",(_.length>0||I.length>0)&&(p+=" INNER JOIN ACC_Accounts A ON A.AccountID=B.AccountID"+_),S&&(p+=h),this.AgeingBasedOnMaturityDate&&(p+=" \nINNER JOIN (select VoucherNo,max(ChequeMaturityDate) ChequeMaturityDate from acc_docdetails with(nolock) where "+m+" group by VoucherNo) as CM\nON CM.VoucherNo=B.DocNo "),p+=" WHERE B.IsNewReference=1",this.IsPaymentTermWise||(p+=this.GetDateColumn("B","@AsOnDate")),p+=R,p+=this.PDCInclude?" AND ((SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo and "+m+")=1 OR (DocType<>14 AND DocType<>19 AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo"+d+")=1))":" AND DocType<>14 AND DocType<>19 AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo"+d+")=1",S&&(p+=" AND B."+D),p+=I,this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?p+=" AND 1<>1":p+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),this.ForeignCurrencyID>0&&(p+=" AND B.AdjCurrID="+this.ForeignCurrencyID),this.IsPaymentTermWise?(p+=" ) AS T WHERE DocDate<=@AsOnDate AND Amount IS NOT NULL ",p+="\nSELECT PT.VoucherNo,PT.Amount"+n+" Amount,CONVERT(DATETIME,PT.DueDate) DueDate\nFROM  COM_Billwise B with(nolock) INNER JOIN COM_DocPayTerms PT with(nolock) ON PT.VoucherNo=B.DocNo",I.length>0&&(p+=" INNER JOIN ACC_Accounts A ON A.AccountID=B.AccountID"),S&&(p+=h),p+=" WHERE B.IsNewReference=1 and B.AccountID=PT.AccountID AND PT.DueDate<=@AsOnDate ",S&&(p+=" AND B."+D),p+=I,this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?p+=" AND 1<>1":p+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")")):(p+=this.AdjustmentRoundOff>0?" ) AS T WHERE abs(AdjAmount)>"+this.AdjustmentRoundOff:" ) AS T WHERE AdjAmount!=0",-1!=this.colPDCIndex&&(p+=" or TotalPDC!=0")),r=this.sbSubQuery.toString()+p.toString(),this.FutureSlabs&&(r+=p.toString().Replace("<=@AsOnDate",">@AsOnDate"))}else{this.LevelNo=0,this.ShowLevelTree=!1,this.ViewModel.FormulaObjects.Clear(),this.ViewModel.BaseReportColumns.forEach(e=>{i.e.IsEmpty(e.Formula.Text)||this.ViewModel.ParseFormula(e,!0)}),this.ViewModel.ReportGroups.forEach(e=>{i.e.IsEmpty(e.Formula.Text)||this.ViewModel.ParseFormula(e,!0)}),this.sbSubQuery="",A="",M="",this.strOrder="";let l=new Array,C=new Array;this.ViewModel.ReportGroups.forEach(e=>{(2==e.CDGDO.ColumnCostCenterID||e.CDGDO.ColumnCostCenterID>5e4)&&(2==e.CDGDO.CategoryValue?(e.CDGDO.ParentTableAlias="CC"+e.CDGDO.ColumnCostCenterID,i.e.IsEmpty(e.FormulaExpression)&&(A+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+" AS "+e.ID+","),C.Contains(e.CDGDO.ColumnCostCenterID)||(C.push(e.CDGDO.ColumnCostCenterID),M.Contains("CCD"+e.CDGDO.CategoryValue+".CostCenterID="+e.CDGDO.CategoryValue)||(M+=" INNER JOIN "+e.CDGDO.ParentTable+" AS CCD"+e.CDGDO.CategoryValue,M+=" WITH(NOLOCK) ON CCD"+e.CDGDO.CategoryValue+".NodeID=A.AccountID AND CCD"+e.CDGDO.CategoryValue+".CostCenterID="+e.CDGDO.CategoryValue),M+=" INNER JOIN "+e.CDGDO.ParentCostCenterSysName+" AS "+e.CDGDO.ParentTableAlias,M+=" WITH(NOLOCK) ON "+e.CDGDO.ParentTableAlias+".NodeID=CCD"+e.CDGDO.CategoryValue+"."+e.CDGDO.ParentColumn,this.strOrder+=e.ID+",")):(e.CDGDO.ParentTableAlias="C"+e.CDGDO.ColumnCostCenterID,i.e.IsEmpty(e.FormulaExpression)&&(A+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+" AS "+e.ID+","),l.Contains(e.CDGDO.ColumnCostCenterID)||(l.push(e.CDGDO.ColumnCostCenterID),M+=" INNER JOIN "+e.CDGDO.ParentCostCenterSysName+" AS "+e.CDGDO.ParentTableAlias,M+=2==e.CDGDO.ColumnCostCenterID?" with(nolock) ON "+e.CDGDO.ParentTableAlias+".AccountID=B.AccountID":" with(nolock) ON "+e.CDGDO.ParentTableAlias+".NodeID=B."+e.CDGDO.ParentColumn,this.strOrder+=e.ID+",")))}),this.ViewModel.BaseReportColumns.forEach(e=>{"0"==e.ShowAsColumn.SelectedValue&&(2==e.CDGDO.ColumnCostCenterID||e.CDGDO.ColumnCostCenterID>5e4)&&(2==e.CDGDO.CategoryValue?(e.CDGDO.ParentTableAlias="CC"+e.CDGDO.ColumnCostCenterID,A+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+" AS "+e.ID+",",C.Contains(e.CDGDO.ColumnCostCenterID)||(C.push(e.CDGDO.ColumnCostCenterID),M.Contains("CCD"+e.CDGDO.CategoryValue+".CostCenterID="+e.CDGDO.CategoryValue)||(M+=" INNER JOIN "+e.CDGDO.ParentTable+" AS CCD"+e.CDGDO.CategoryValue,M+=" WITH(NOLOCK) ON CCD"+e.CDGDO.CategoryValue+".NodeID=A.AccountID AND CCD"+e.CDGDO.CategoryValue+".CostCenterID="+e.CDGDO.CategoryValue),M+=" INNER JOIN "+e.CDGDO.ParentCostCenterSysName+" AS "+e.CDGDO.ParentTableAlias,M+=" WITH(NOLOCK) ON "+e.CDGDO.ParentTableAlias+".NodeID=CCD"+e.CDGDO.CategoryValue+"."+e.CDGDO.ParentColumn)):(e.CDGDO.ParentTableAlias="C"+e.CDGDO.ColumnCostCenterID,A+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+" AS "+e.ID+",",l.Contains(e.CDGDO.ColumnCostCenterID)||(l.push(e.CDGDO.ColumnCostCenterID),M+=" INNER JOIN "+e.CDGDO.ParentCostCenterSysName+" AS "+e.CDGDO.ParentTableAlias,M+=2==e.CDGDO.ColumnCostCenterID?" ON "+e.CDGDO.ParentTableAlias+".AccountID=B.AccountID":" ON "+e.CDGDO.ParentTableAlias+".NodeID=B."+e.CDGDO.ParentColumn)))}),l.Contains(2)?(this.ViewModel.SelectTag=this.ViewModel.SelectTag.Replace("A.","C2."),this.ViewModel.FromTag=this.ViewModel.FromTag.Replace("A.","C2."),M=M.Replace("A.","C2.")):(this.ViewModel.SelectTag="",this.ViewModel.FromTag="");let p="";if(t.length>0){let e="";l.forEach(t=>{t>=5e4&&(e+=" AND DCC.dcCCNID"+(t-5e4)+"=B.dcCCNID"+(t-5e4))}),-1!=this.colTotalSaleIndex&&(p=",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=SALE.InvDocDetailsID WHERE SALE.DebitAccount=B.AccountID "+e+" AND SALE.CostCenterID IN ("+t+") AND SALE.DocDate>=@AccountingDate AND SALE.DocDate<=@AsOnDate"+d+'),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=SALE.InvDocDetailsID WHERE SALE.CreditAccount=B.AccountID " + ccwhere + " AND SALE.CostCenterID IN ('+t+") AND SALE.DocDate>=@AccountingDate AND SALE.DocDate<=@AsOnDate"+d+"),0)  TotalSale"),-1!=this.colPrevYearSaleIndex&&(p=p+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=SALE.InvDocDetailsID WHERE SALE.DebitAccount=B.AccountID "+e+" AND SALE.CostCenterID IN ("+t+") AND SALE.DocDate<@AccountingDate"+d+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=SALE.InvDocDetailsID WHERE SALE.CreditAccount=B.AccountID "+e+" AND SALE.CostCenterID IN ("+t+") AND SALE.DocDate<@AccountingDate"+d+"),0)  PrevYearSale"),-1!=this.colPeriodSaleIndex&&(p=p+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=SALE.InvDocDetailsID WHERE SALE.DebitAccount=B.AccountID "+e+" AND SALE.CostCenterID IN ("+t+") AND SALE.DocDate>=@FromDate AND SALE.DocDate<=@AsOnDate"+d+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=SALE.InvDocDetailsID WHERE SALE.CreditAccount=B.AccountID "+e+" AND SALE.CostCenterID IN ("+t+") AND SALE.DocDate>=@FromDate AND SALE.DocDate<=@AsOnDate"+d+"),0) PeriodSale")}else this.colTotalSaleIndex=-1,this.colPrevYearSaleIndex=-1,this.colPeriodSaleIndex=-1;u.length>0&&-1!=this.colReceiptsAmtIndex?(p=p+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+u+")",this.ViewModel.oReportDialog.FromDate.Visible&&(p+=" AND SALE.DocDate>=@FromDate"),p=p+" AND SALE.DocDate<=@AsOnDate"+d+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+u+")",this.ViewModel.oReportDialog.FromDate.Visible&&(p+=" AND SALE.DocDate>=@FromDate"),p=p+" AND SALE.DocDate<=@AsOnDate"+d+"),0) ReceiptsAmount",p=p+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+u+") AND SALE.DocDate>=@FromDate AND SALE.DocDate<=@AsOnDate"+d+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+u+") AND SALE.DocDate>=@FromDate AND SALE.DocDate<=@AsOnDate"+d+"),0) ReceiptsAmount"):this.colReceiptsAmtIndex=-1,c.length>0&&-1!=this.colChqBounceAmtIndex?(p=p+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+c+")",this.ViewModel.oReportDialog.FromDate.Visible&&(p+=" AND SALE.DocDate>=@FromDate"),p=p+" AND SALE.DocDate<=@AsOnDate"+d+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+c+")",this.ViewModel.oReportDialog.FromDate.Visible&&(p+=" AND SALE.DocDate>=@FromDate"),p=p+" AND SALE.DocDate<=@AsOnDate"+d+"),0) ChequeBounceAmount"):this.colChqBounceAmtIndex=-1,this.colUnDueIndex=-1,this.sbSubQuery+="DECLARE @AccountingDate FLOAT,@AsOnDate FLOAT\nSET @AccountingDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+o.a.SessionManager.AccountingDate.ToString("dd MMM yyyy")+"'))",this.AllowFromDateFilter&&(this.sbSubQuery+="\ndeclare @From float SET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))"),this.sbSubQuery+=this.dtMonthWiseEndData?" SET @AsOnDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.dtMonthWiseEndData.ToString("dd MMM yyyy")+"'))":" SET @AsOnDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",(this.ViewModel.oReportDialog.FromDate.Visible||-1!=this.colPeriodSaleIndex)&&(this.sbSubQuery+="\ndeclare @FromDate float SET @FromDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"')) ");let T="";this.IsPaymentTermWise?(T+="\nSELECT *,Amount+Paid AdjAmount FROM (SELECT "+A+"B.DocNo, CASE WHEN EXISTS (select * from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo)\nTHEN (select CONVERT(DATETIME,max(DueDate)) from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo and DueDate<=@AsOnDate)\nELSE CONVERT(DATETIME,ISNULL(B.DocDueDate,B.DocDueDate)) END DocDate,B.AccountID\n\n,CASE WHEN EXISTS (select * from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo)\nTHEN (select sum(amount)*sign(B.AdjAmount)"+n+" from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo and DueDate<=@AsOnDate)\nELSE "+s+" END Amount,\nISNULL(\n(SELECT SUM("+a+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND ",T+=this.PDCOnConvresionDate?"isnull(CB.ConvertedDate,CB.DocDate)<=@AsOnDate":"CB.DocDate<=@AsOnDate",T+=e+"),0) Paid"):(T+=" SELECT * from (",T+=" SELECT "+A,T+="B.AccountID,",T+=this.GetDateColumn("B",""),-1!=this.colUnDueIndex&&(T+=",0 UnDueAmount"),T+=",B.DocNo,"+s+" + ISNULL((SELECT SUM("+a+") FROM COM_Billwise CB WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0",T+=this.PDCOnConvresionDate?" AND isnull(CB.ConvertedDate,CB.DocDate)<=@AsOnDate":" AND CB.DocDate<=@AsOnDate",T+=e+"),0) AdjAmount ",this.AgeingBasedOnMaturityDate&&(T+=",convert(datetime,CM.ChequeMaturityDate) CqMaturityDate")),-1==this.colPDCIndex&&-1==this.colIncludingPDCIndex||(this.colPDCIndex=0,T+=",ISNULL((SELECT SUM("+a+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@AsOnDate"+R.Replace("B.","CB.")+" AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo and "+m+")=1),0) TotalPDC "),(-1!=this.colPDCIndex||-1!=this.colIncludingPDCIndex||this.AgeingBasedOnMaturityDate)&&this.PDCInclude&&(T+=",(SELECT TOP 1 ACC.StatusID FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo) Status"),T+=p,T+=this.ViewModel.SelectTag,T+=" FROM COM_Billwise B with(nolock)"+M+this.ViewModel.FromTag,S&&(T+=h),this.AgeingBasedOnMaturityDate&&(T+=" \nINNER JOIN (select VoucherNo,max(ChequeMaturityDate) ChequeMaturityDate from acc_docdetails with(nolock) where "+m+" group by VoucherNo) as CM\nON CM.VoucherNo=B.DocNo "),T+=" WHERE B.IsNewReference=1",l.Contains(2)&&_.length>0&&(T+=_.Replace("A.","C2.")),this.IsPaymentTermWise||(T+=this.GetDateColumn("B","@AsOnDate")),T+=R,T+=this.PDCInclude?" AND ((SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo and "+m+")=1 OR (DocType<>14 AND DocType<>19 AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo"+d+")=1))":" AND DocType<>14 AND DocType<>19 AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo"+d+")=1",S&&(T+=" AND B."+D),this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?T+=" AND 1<>1":T+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),this.ForeignCurrencyID>0&&(T+=" AND B.AdjCurrID="+this.ForeignCurrencyID),this.IsPaymentTermWise?(T+=" ) AS T WHERE DocDate<=@AsOnDate AND Amount IS NOT NULL ",T+="\nSELECT PT.VoucherNo,PT.Amount"+n+" Amount,CONVERT(DATETIME,PT.DueDate) DueDate\nFROM  COM_Billwise B with(nolock) INNER JOIN COM_DocPayTerms PT with(nolock) ON PT.VoucherNo=B.DocNo",S&&(T+=h),T+=" WHERE B.IsNewReference=1 and B.AccountID=PT.AccountID AND PT.DueDate<=@AsOnDate ",S&&(T+=" AND B."+D),this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?T+=" AND 1<>1":T+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")")):(T+=this.AdjustmentRoundOff>0?" ) AS T WHERE abs(AdjAmount)>"+this.AdjustmentRoundOff:" ) AS T WHERE AdjAmount!=0",-1!=this.colPDCIndex&&(T+=" or TotalPDC!=0")),r=this.sbSubQuery.toString()+T.toString(),this.FutureSlabs&&(r+=T.toString().Replace("<=@AsOnDate",">@AsOnDate"))}}return o.a.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,r)}GetDataSetNew(e,t){let s,l,a,n,r="",h="",u="",D="",d="",c="";a=0!=this.oColumns.filter(e=>"BillNo"==e.ID).length,n=0!=this.oColumns.filter(e=>"BillDate"==e.ID).length;let C="";this.UnPostedDocsList.length>0&&this.UnPostedDocsList.split(",").forEach(e=>{D+=" or StatusID="+e});let p="(StatusID=370 OR StatusID=439"+D+(this.IncludeTerminatedPDC?" OR StatusID=452":"")+")";D="StatusID=369 or StatusID=429"+D,d=D.Replace("StatusID","CB.StatusID"),d="("+d+")",c=d.Replace("CB.","B."),D=" and ("+D+")";let T=this.GetAccountWiseLocationWhere("A"),_=this.GetDimensionFilter("B.dcCCNID"),m=!1;this.ViewModel.HideCostCenterTree||this.ViewModel.oReportDialog.IsZeroSelected||this.ViewModel.oReportDialog.IsOneSelected||(m=!0,this.ViewModel.oReportDialog.IsGroupExists?(u="AccountID=GTP.GTID",h=t.Contains(",")?",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID IN ("+t+") group by T.AccountID) AS GTP ":",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID="+t+" group by T.AccountID) AS GTP "):u=t.Contains(",")?"AccountID IN ("+t+")":"AccountID="+t),this.ForeignCurrencyID>0?(s="AmountFC",l="/B.AdjExchRT"):(s=1==this.CurrencyType?"isnull(AmountBC,0)":"AdjAmount",l=""),C=this.GetAccountTypeWhere("A"),this.sbSubQuery="",this.GroupRowsCount=0;let I="",R="";if(this.strOrder="",this.ViewModel.ReportGroups.forEach(t=>{2==t.CDGDO.ColumnCostCenterID?(I+="A."+t.CDGDO.Column+" AS "+t.ID+",A.AccountID AS "+t.ID+"_ID,","1"!=t.ShowAsColumn.SelectedValue&&(this.AccountGroupIndex=this.GroupRowsCount),!this.ViewModel.Preferences.ContainsKey("TreeSortOn")||9!=e&&10!=e||("Code"==this.ViewModel.Preferences.TreeSortOn?(I+="A.AccountCode AccOrder,",this.strOrder+="AccOrder,"):"TreeOrder"==this.ViewModel.Preferences.TreeSortOn&&(I+="A.lft AccOrder,",this.strOrder+="AccOrder,"))):t.CDGDO.ColumnCostCenterID>5e4&&400==t.CDGDO.CategoryValue&&(t.CDGDO.ParentTableAlias="C"+t.CDGDO.ColumnCostCenterID,I+=t.CDGDO.ParentTableAlias+"."+t.CDGDO.Column+" AS "+t.ID+","+t.CDGDO.ParentTableAlias+".NodeID AS "+t.ID+"_ID,",11!=this.ViewModel.StaticReportType&&12!=this.ViewModel.StaticReportType&&50002==t.CDGDO.ColumnCostCenterID||(R+=" INNER JOIN "+t.CDGDO.ParentCostCenterSysName+" AS "+t.CDGDO.ParentTableAlias,R+=" WITH(NOLOCK) ON "+t.CDGDO.ParentTableAlias+".NodeID=B."+t.CDGDO.ParentColumn)),this.strOrder+=t.ID+",","1"!=t.ShowAsColumn.SelectedValue&&this.GroupRowsCount++}),9==e||10==e){let t="";t=this.PDCInclude?this.HidePDCAdjustments||!this.PDCSeperate&&!this.FilterPDCOnMaturityDate?" AND ("+p.Replace("StatusID","CB.StatusID")+" OR (DocType<>14 AND DocType<>19 AND "+d+"))":" AND  (DocType<>14 AND DocType<>19 AND "+d+")":" AND DocType<>14 AND DocType<>19 AND "+d,this.sbSubQuery+="DECLARE @To FLOAT\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",this.AllowFromDateFilter&&(this.sbSubQuery+="\ndeclare @From float SET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))"),this.sbSubQuery+="\nSELECT *,case when Amount>0 then 1 else 0 end AmtOrder FROM (",this.IsPaymentTermWise?(this.sbSubQuery+="\tSELECT A.AccountID,B.DocSeqNo,"+I+"\nCASE WHEN EXISTS (select * from COM_DocPayTerms WITH(NOLOCK) where VoucherNo=B.DocNo)\nTHEN (select CONVERT(DATETIME,max(DueDate)) from COM_DocPayTerms WITH(NOLOCK) where VoucherNo=B.DocNo and DueDate<=@To)\nELSE CONVERT(DATETIME,ISNULL(B.DocDueDate,B.DocDate)) END DocDate, \nCONVERT(DATETIME,B.DocDueDate) DueDate,CONVERT(DATETIME,B.DocDate) VoucherDate,B.DocNo,\nCASE WHEN EXISTS (select * from COM_DocPayTerms WITH(NOLOCK) where VoucherNo=B.DocNo)\nTHEN (select sum(amount)*sign(B.AdjAmount)"+l+" from COM_DocPayTerms WITH(NOLOCK) where VoucherNo=B.DocNo and DueDate<=@To)\nELSE "+s+" END Amount,\n"+s+" BillAmount",a&&(this.sbSubQuery+=",B.BillNo"),n&&(this.sbSubQuery+=",CONVERT(DATETIME,B.BillDate) BillDate"),this.sbSubQuery+=",C50002.Name AS Location,    \n(SELECT SUM("+s+") Adjusted FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND ",this.sbSubQuery+=this.PDCOnConvresionDate?"isnull(CB.ConvertedDate,CB.DocDate)<=@To":"CB.DocDate<=@To",this.sbSubQuery+=" AND CB.AccountID=B.AccountID AND CB.RefDocNo=B.DocNo"+t+" AND CB.RefDocSeqNo=B.DocSeqNo) Adjusted\n"+this.ViewModel.SelectTag+"\n,(B.DocDueDate-B.DocDate) CreditDays\n,@To-(CASE WHEN EXISTS (select * from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo)\nTHEN (select max(DueDate) from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo and DueDate<=@To)\nELSE B.DocDueDate END) OverDue\n,DocType,B.StatusID",this.ClubByVoucherNo&&(this.sbSubQuery+=",B.Narration"),this.PDCSeperate&&(this.sbSubQuery+=",case when DocType=14 or DocType=19 then 1 else 0 end IsPDC,null AgainstVoucher"),-1!=this.colLOBPDCIndex&&(this.sbSubQuery+=",(SELECT abs(SUM("+s+")) FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@To AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo and "+p+")=1)  LOBPDC"),this.sbSubQuery+=" \nFROM COM_Billwise B with(nolock) INNER JOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID     \nINNER JOIN COM_Location AS C50002 ON B.dcCCNID2 = C50002.NodeID ",this.ViewModel.SelectTag.length>0&&this.ViewModel.SelectTag.Contains("AT.AccountType")&&(this.sbSubQuery+=" INNER JOIN ACC_ACCOUNTTYPES AT WITH(NOLOCK) ON AT.AccountTypeID=A.AccountTypeID "),this.sbSubQuery+=R+this.ViewModel.FromTag,m&&(this.sbSubQuery+=h),this.sbSubQuery+=" WHERE B.IsNewReference=1 "):(this.sbSubQuery+="\tSELECT A.AccountID,B.DocSeqNo,"+I,this.sbSubQuery+=this.GetDateColumn("B",""),this.sbSubQuery+=",CONVERT(DATETIME,B.DocDueDate) DueDate,CONVERT(DATETIME,B.DocDate) VoucherDate,B.DocNo,\n"+s+" Amount,",this.ClubByVoucherNo?(this.sbSubQuery+="(select sum("+s+") from COM_Billwise CB with(nolock) where CB.AccountID=B.AccountID AND CB.DocNo=B.DocNo and IsNewReference=1) BillAmount",this.sbSubQuery+=",(SELECT SUM("+s+") Adjusted FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND ",this.sbSubQuery+=this.PDCOnConvresionDate?"isnull(CB.ConvertedDate,CB.DocDate)<=@To":"CB.DocDate<=@To",this.sbSubQuery+=" AND CB.AccountID=B.AccountID AND CB.RefDocNo=B.DocNo"+t+") AdjustedBillAmount"):this.sbSubQuery+=s+" BillAmount",a&&(this.sbSubQuery+=",B.BillNo"),n&&(this.sbSubQuery+=",CONVERT(DATETIME,B.BillDate) BillDate"),this.sbSubQuery+=",C50002.Name AS Location,    \n(SELECT SUM("+s+") Adjusted FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND ",this.sbSubQuery+=this.PDCOnConvresionDate?"isnull(CB.ConvertedDate,CB.DocDate)<=@To":"CB.DocDate<=@To",this.sbSubQuery+=" AND CB.AccountID=B.AccountID AND CB.RefDocNo=B.DocNo"+t+" AND CB.RefDocSeqNo=B.DocSeqNo) Adjusted\n"+this.ViewModel.SelectTag+",(B.DocDueDate-B.DocDate) CreditDays\n,@To-B."+this.ViewModel.Preferences.Date+" OverDue\n,DocType,B.StatusID",this.ClubByVoucherNo&&(this.sbSubQuery+=",B.Narration"),this.PDCSeperate&&(this.sbSubQuery+=",case when DocType=14 or DocType=19 then 1 else 0 end IsPDC,null AgainstVoucher"),-1!=this.colLOBPDCIndex&&(this.sbSubQuery+=",(SELECT abs(SUM("+s+")) FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@To AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo and "+p+")=1)  LOBPDC"),this.sbSubQuery+=" \nFROM COM_Billwise B with(nolock) INNER JOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID     \nINNER JOIN COM_Location AS C50002 with(nolock) ON B.dcCCNID2 = C50002.NodeID ",this.ViewModel.SelectTag.length>0&&this.ViewModel.SelectTag.Contains("AT.AccountType")&&(this.sbSubQuery+=" INNER JOIN ACC_ACCOUNTTYPES AT WITH(NOLOCK) ON AT.AccountTypeID=A.AccountTypeID "),this.sbSubQuery+=R+this.ViewModel.FromTag,m&&(this.sbSubQuery+=h),this.sbSubQuery+=" WHERE B.IsNewReference=1",this.sbSubQuery+=this.GetDateColumn("B","@To"));let c="";c+=_,m&&(c+=" AND A."+u),c+=T,c+=C,this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?c+=" AND 1<>1":c+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),this.ForeignCurrencyID>0&&(c+=" AND B.AdjCurrID="+this.ForeignCurrencyID),c+=this.GetDocumentTypeFilter(),this.sbSubQuery+=c.toString(),this.sbSubQuery+=" ) AS T ";let S="";if(this.UnAdjusted&&(S="Adjusted IS NULL"),this.SemiAdjusted&&(S.length>0&&(S+=" OR "),S+="abs(Amount+Adjusted)>"+this.AdjustmentRoundOff),this.Adjusted&&(S.length>0&&(S+=" OR "),S+="abs(Amount+Adjusted)<="+this.AdjustmentRoundOff),S="("+S+")",this.IsPaymentTermWise&&(S+=" AND DocDate<=@To AND Amount IS NOT NULL"),S+=this.PDCInclude?this.PDCSeperate||this.FilterPDCOnMaturityDate?" AND (DocType<>14 AND DocType<>19"+D+")":" AND ("+p+" OR (DocType<>14 AND DocType<>19"+D+"))":" AND DocType<>14 AND DocType<>19"+D,S.length>0&&(this.sbSubQuery+=" WHERE "+S),this.PDCSeperate||this.FilterPDCOnMaturityDate){let e,t="PaymentTerm"==this.ViewModel.Preferences.Date?"B.DocDate":"B."+this.ViewModel.Preferences.Date;this.FilterPDCOnMaturityDate?(e="CM.ChequeMaturityDate",t="CM.ChequeMaturityDate"):e=t,this.sbSubQuery+="\nUNION ALL  SELECT *,case when Amount>0 then 1 else 0 end AmtOrder FROM (",this.sbSubQuery+="\tSELECT A.AccountID,B.DocSeqNo,"+I+"CONVERT(DATETIME,"+t+") DocDate,CONVERT(DATETIME,B.DocDueDate) DueDate,CONVERT(DATETIME,B.DocDate) VoucherDate,B.DocNo,\n"+s+" Amount,"+s+" BillAmount",this.ClubByVoucherNo&&(this.sbSubQuery+=",0 AdjustedBillAmount"),a&&(this.sbSubQuery+=",B.BillNo"),n&&(this.sbSubQuery+=",CONVERT(DATETIME,B.BillDate) BillDate"),this.sbSubQuery+=",C50002.Name AS Location,0 Adjusted"+this.ViewModel.SelectTag+"\n,(B.DocDueDate-B.DocDate) CreditDays\n,@To-"+t+" OverDue\n,DocType,B.StatusID",this.ClubByVoucherNo&&(this.sbSubQuery+=",B.Narration"),this.UnAppsDocsAdjustSeperate&&(this.sbSubQuery+=",0 IsUnappAdj"),this.PDCSeperate&&(this.sbSubQuery+=",1 IsPDC,case when B.IsNewReference=0 then B.RefDocNo else null end AgainstVoucher"),-1!=this.colLOBPDCIndex&&(this.sbSubQuery+=",(SELECT abs(SUM("+s+")) FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@To AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo and "+p+")=1) LOBPDC"),this.sbSubQuery+=" \nFROM COM_Billwise B with(nolock) INNER JOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID     \nINNER JOIN COM_Location AS C50002 with(nolock) ON B.dcCCNID2 = C50002.NodeID ",this.ViewModel.SelectTag.length>0&&this.ViewModel.SelectTag.Contains("AT.AccountType")&&(this.sbSubQuery+=" INNER JOIN ACC_ACCOUNTTYPES AT WITH(NOLOCK) ON AT.AccountTypeID=A.AccountTypeID "),this.sbSubQuery+=R+this.ViewModel.FromTag,this.FilterPDCOnMaturityDate&&(this.sbSubQuery+=" \nINNER JOIN (select VoucherNo,max(ChequeMaturityDate) ChequeMaturityDate from acc_docdetails with(nolock) where "+p+" group by VoucherNo) as CM\nON CM.VoucherNo=B.DocNo "),m&&(this.sbSubQuery+=h),this.sbSubQuery+=" WHERE (B.DocType=19 or B.DocType=14)",this.AllowFromDateFilter&&(this.sbSubQuery+=" and "+e+">=@From "),this.sbSubQuery+=" and "+e+"<=@To ",this.sbSubQuery+=c.toString(),this.sbSubQuery+=" ) AS T ",S="",this.UnAdjusted&&(S="Adjusted IS NULL"),this.SemiAdjusted&&(S.length>0&&(S+=" OR "),S+="abs(Amount+Adjusted)>"+this.AdjustmentRoundOff),this.Adjusted&&(S.length>0&&(S+=" OR "),S+="abs(Amount+Adjusted)<="+this.AdjustmentRoundOff),S="("+S+")",S+=" AND "+p,S.length>0&&(this.sbSubQuery+=" WHERE "+S)}if(this.sbSubQuery+=" ORDER BY "+this.strOrder,this.PDCSeperate&&(this.sbSubQuery+="IsPDC,"),this.UnPostedDocsSeparately&&(this.sbSubQuery+="StatusID,"),this.sbSubQuery+="DocDate,AmtOrder,DocNo",9==e){let e="";-1!=this.colRefAccount&&(e=o.a.report.GetReportData(18,0,"").Tables[0][0].RefAccount.toString()),this.sbSubQuery+="\nSELECT ",this.sbSubQuery+=this.PDCOnConvresionDate?"CONVERT(DATETIME,isnull(B.ConvertedDate,B.DocDate)) DocDate":"CONVERT(DATETIME, B.DocDate) DocDate",this.sbSubQuery+=",B.DocNo,B.RefDocSeqNo,"+s+" AS AdjAmount",a&&(this.sbSubQuery+=",B.BillNo"),n&&(this.sbSubQuery+=",CONVERT(DATETIME,B.BillDate) BillDate"),this.sbSubQuery+=this.ViewModel.SelectTag+e,this.sbSubQuery+=",RefDocNo,DATEDIFF(day,CONVERT(DATETIME,RefDocDate),CONVERT(DATETIME, B.DocDate)) PaidByDays\nFROM COM_Billwise B WITH(NOLOCK) INNER JOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID",this.ViewModel.SelectTag.length>0&&this.ViewModel.SelectTag.Contains("AT.AccountType")&&(this.sbSubQuery+=" INNER JOIN ACC_ACCOUNTTYPES AT WITH(NOLOCK) ON AT.AccountTypeID=A.AccountTypeID "),this.sbSubQuery+=this.ViewModel.FromTag,m&&(this.sbSubQuery+=h),this.sbSubQuery+=" WHERE IsNewReference=0",this.sbSubQuery+=this.PDCOnConvresionDate?" AND isnull(B.ConvertedDate,B.DocDate)<=@To ":" AND B.DocDate<=@To ",this.sbSubQuery+=t.Replace("CB.","B."),m&&(this.sbSubQuery+=" AND B."+u),this.sbSubQuery+=T}r=this.sbSubQuery.toString()}else if(11==e){let e="";e=this.PDCInclude?" AND ("+p.Replace("StatusID","CB.StatusID")+" OR (DocType<>14 AND DocType<>19 AND "+d+"))":" AND DocType<>14 AND DocType<>19 AND "+d,this.sbSubQuery+=this.dtMonthWiseEndData?"DECLARE @AsOn FLOAT SET @AsOn=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.dtMonthWiseEndData.ToString("dd MMM yyyy")+"'))":"DECLARE @AsOn FLOAT SET @AsOn=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",this.AllowFromDateFilter&&(this.sbSubQuery+="\ndeclare @From float SET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))"),this.IsPaymentTermWise?(this.sbSubQuery+=" SELECT * FROM (SELECT "+I+"B.DocNo VoucherNo,"+s+" BillAmount"+this.ViewModel.SelectTag,this.sbSubQuery+=",CASE WHEN EXISTS (select * from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo)\nTHEN (select CONVERT(DATETIME,max(DueDate)) from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo and DueDate<=@AsOn)\nELSE CONVERT(DATETIME,ISNULL(B.DocDueDate,B.DocDate)) END DocDate, \nCONVERT(DATETIME,B.DocDueDate) DueDate,\nCASE WHEN EXISTS (select * from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo)\nTHEN (select sum(amount)*sign(B.AdjAmount)"+l+" from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo and DueDate<=@AsOn)\nELSE "+s+" END AdjAmount, @AsOn-B.DocDueDate OverDue"):(this.sbSubQuery+="\tSELECT "+I+"B.DocNo VoucherNo,"+s+" BillAmount"+this.ViewModel.SelectTag,this.sbSubQuery+=","+this.GetDateColumn("B",""),this.sbSubQuery+=",CONVERT(DATETIME,B.DocDueDate) DueDate,"+s+" AdjAmount,@AsOn-B."+this.ViewModel.Preferences.Date+" OverDue"),this.sbSubQuery+=",ISNULL((SELECT SUM(CB."+s+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0",this.sbSubQuery+=this.PDCOnConvresionDate?" AND ISNULL(CB.ConvertedDate,CB.DocDate)<=@AsOn":" AND CB.DocDate<=@AsOn",this.sbSubQuery+=e+"),0) Paid",this.sbSubQuery+=",(B.DocDueDate-B.DocDate) CreditDays",a&&(this.sbSubQuery+=",B.BillNo"),n&&(this.sbSubQuery+=",CONVERT(DATETIME,B.BillDate) BillDate"),-1==this.colPDCIndex&&-1==this.colNetBalanceIndex||(this.colPDCIndex=0,this.sbSubQuery+=",(SELECT abs(SUM(CB."+s+")) FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@AsOn AND "+d+_.Replace("B.","CB.")+") TotalPDC",this.PDCInclude&&(this.sbSubQuery+=",B.StatusID Status")),this.sbSubQuery+=",case when AdjAmount>0 then 1 else 0 end AmtOrder",this.BWAgeingShowOnlyDocs&&(this.sbSubQuery+=",DType.IsInventory",this.ViewModel.FromTag.Contains("DType")||(this.ViewModel.FromTag=" INNER JOIN (SELECT DocumentType,IsInventory FROM ADM_DocumentTypes with(nolock) Group By DocumentType,IsInventory) AS DType ON  DType.DocumentType=B.DocType "+this.ViewModel.FromTag)),this.sbSubQuery+=" FROM COM_Billwise B with(nolock) INNER JOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID ",this.ViewModel.SelectTag.length>0&&this.ViewModel.SelectTag.Contains("AT.AccountType")&&(this.sbSubQuery+=" INNER JOIN ACC_ACCOUNTTYPES AT WITH(NOLOCK) ON AT.AccountTypeID=A.AccountTypeID "),this.sbSubQuery+=R+this.ViewModel.FromTag,m&&(this.sbSubQuery+=h),this.sbSubQuery+=" WHERE B.IsNewReference=1",this.IsPaymentTermWise||(this.sbSubQuery+=this.GetDateColumn("B","@AsOn")),this.sbSubQuery+=_,"Receivables"==this.ViewModel.Preferences.IncludeBills?this.sbSubQuery+=" AND B."+s+">0":"Payables"==this.ViewModel.Preferences.IncludeBills&&(this.sbSubQuery+=" AND B."+s+"<0"),this.sbSubQuery+=this.GetDocumentTypeFilter(),this.sbSubQuery+=this.PDCInclude?" AND ("+p.Replace("StatusID","B.StatusID")+" OR (DocType<>14 AND DocType<>19 AND "+c+"))":" AND DocType<>14 AND DocType<>19 AND "+c,m&&(this.sbSubQuery+=" AND A."+u),this.sbSubQuery+=T,this.sbSubQuery+=C,this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?this.sbSubQuery+=" AND 1<>1":this.sbSubQuery+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),this.ForeignCurrencyID>0&&(this.sbSubQuery+=" AND B.AdjCurrID="+this.ForeignCurrencyID),this.IsPaymentTermWise?(this.sbSubQuery+=" ) AS T WHERE DocDate<=@AsOn AND AdjAmount IS NOT NULL ",this.sbSubQuery+=" ORDER BY "+this.strOrder+"DocDate,AmtOrder,VoucherNo",this.sbSubQuery+="\nSELECT PT.VoucherNo,PT.Amount"+l+" Amount,CONVERT(DATETIME,PT.DueDate) DueDate\nFROM  COM_Billwise B with(nolock) INNER JOIN COM_DocPayTerms PT with(nolock) ON PT.VoucherNo=B.DocNo",T.length>0&&(this.sbSubQuery+=" INNER JOIN ACC_Accounts A ON A.AccountID=B.AccountID"),m&&(this.sbSubQuery+=h),this.sbSubQuery+=" WHERE B.IsNewReference=1 and B.AccountID=PT.AccountID AND PT.DueDate<=@AsOn ",m&&(this.sbSubQuery+=" AND B."+u),this.sbSubQuery+=T,this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?this.sbSubQuery+=" AND 1<>1":this.sbSubQuery+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")")):this.sbSubQuery+=" ORDER BY "+this.strOrder+"DocDate,AmtOrder,DocNo",r=this.sbSubQuery.toString()}else if(12==e){let e="";e=this.PDCInclude?" AND ("+p.Replace("StatusID","CB.StatusID")+" OR (DocType<>14 AND DocType<>19 AND "+d+"))":" AND DocType<>14 AND DocType<>19 AND "+d;let t=this.ViewModel.Preferences.ContainsKey("SalesDocs")?this.ViewModel.Preferences.SalesDocs:"",a=this.ViewModel.Preferences.ContainsKey("ReceiptDocs")?this.ViewModel.Preferences.ReceiptDocs:"",n=this.ViewModel.Preferences.ContainsKey("ChequeBounceDocs")?this.ViewModel.Preferences.ChequeBounceDocs:"";if(this.lstGroup.length<=1){let d="";if(t.length>0?(-1!=this.colTotalSaleIndex&&(d=",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+t+") AND SALE.DocDate>=@AccountingDate AND SALE.DocDate<=@AsOnDate"+D+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+t+") AND SALE.DocDate>=@AccountingDate AND SALE.DocDate<=@AsOnDate"+D+"),0)  TotalSale"),-1!=this.colPrevYearSaleIndex&&(d=d+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+t+") AND SALE.DocDate<@AccountingDate"+D+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+t+") AND SALE.DocDate<@AccountingDate"+D+"),0)  PrevYearSale"),-1!=this.colPeriodSaleIndex&&(d=d+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+t+") AND SALE.DocDate>=@FromDate AND SALE.DocDate<=@AsOnDate"+D+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+t+") AND SALE.DocDate>=@FromDate AND SALE.DocDate<=@AsOnDate"+D+"),0) PeriodSale")):(this.colTotalSaleIndex=-1,this.colPrevYearSaleIndex=-1,this.colPeriodSaleIndex=-1),a.length>0&&-1!=this.colReceiptsAmtIndex?(d=d+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+a+")",this.ViewModel.oReportDialog.FromDate.Visible&&(d+=" AND SALE.DocDate>=@FromDate"),d=d+" AND SALE.DocDate<=@AsOnDate"+D+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+a+")",this.ViewModel.oReportDialog.FromDate.Visible&&(d+=" AND SALE.DocDate>=@FromDate"),d=d+" AND SALE.DocDate<=@AsOnDate"+D+"),0) ReceiptsAmount"):this.colReceiptsAmtIndex=-1,n.length>0&&-1!=this.colChqBounceAmtIndex?(d=d+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+n+")",this.ViewModel.oReportDialog.FromDate.Visible&&(d+=" AND SALE.DocDate>=@FromDate"),d=d+" AND SALE.DocDate<=@AsOnDate"+D+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+n+")",this.ViewModel.oReportDialog.FromDate.Visible&&(d+=" AND SALE.DocDate>=@FromDate"),d=d+" AND SALE.DocDate<=@AsOnDate"+D+"),0) ChequeBounceAmount"):this.colChqBounceAmtIndex=-1,-1!=this.colUnDueIndex&&(d=this.IsDocDateWise?d+",(select sum(AMT) from (select B."+s+"+case when B.DocDueDate is not null and B.DocDueDate >@AsOnDate then B."+s+" else 0 end\nAMT FROM COM_Billwise B WITH(NOLOCK) WHERE B.IsNewReference=1 AND B.AccountID=A.AccountID":d+",(select sum(AMT) from (select B."+s+" \n+(case when isnull(B.DocDueDate,B.DocDate)>@AsOnDate then ISNULL((SELECT SUM(CB."+s+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND CB.IsNewReference=0"+e+"),0) else 0 end)\nAMT FROM COM_Billwise B WITH(NOLOCK) WHERE B.IsNewReference=1 AND B.AccountID=A.AccountID",d+=_,d+=this.PDCInclude?" AND ("+p.Replace("StatusID","B.StatusID")+" OR (DocType<>14 AND DocType<>19 AND "+c+"))":" AND DocType<>14 AND DocType<>19 AND "+c,this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?d+=" AND 1<>1":d+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),this.ForeignCurrencyID>0&&(d+=" AND B.AdjCurrID="+this.ForeignCurrencyID),d+=") as T) ActualBill"),-1==this.colPDCIndex&&-1==this.colIncludingPDCIndex||(d+=",ISNULL((SELECT SUM(CB."+s+") FROM COM_Billwise CB with(nolock) WHERE CB.AccountID=A.AccountID AND IsNewReference=1 AND CB.DocDate<=@AsOnDate AND "+p.Replace("StatusID","CB.StatusID")+_.Replace("B.","CB.")+"),0) TotalPDC "),this.lstGroup.length>0&&(this.lstGroup[0].ID="AccountName",this.ViewModel.Groupstr.Clear(),this.ViewModel.Groupstr.push("AccountName","")),this.LevelNo=0,this.ShowLevelTree=!1,this.ViewModel.Preferences.ContainsKey("ShowLevel")){let e=new i.f;e.LoadXml("<XML>"+this.ViewModel.Preferences.ShowLevel+"</XML>");let t=i.f.SelectSingleNode(e.DocumentElement,"IsChecked");null!=t&&"1"==t.innerHTML&&(this.ShowLevelTree=!0,t=i.f.SelectSingleNode(e.DocumentElement,"Text"),this.LevelNo=parseInt(t.innerHTML))}this.sbSubQuery="",this.sbSubQuery+="DECLARE @AccountingDate FLOAT,@AsOnDate FLOAT\nSET @AccountingDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+o.a.SessionManager.AccountingDate.ToString("dd MMM yyyy")+"'))",this.AllowFromDateFilter&&(this.sbSubQuery+="\ndeclare @From float SET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))"),this.sbSubQuery+=this.dtMonthWiseEndData?" SET @AsOnDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.dtMonthWiseEndData.ToString("dd MMM yyyy")+"'))":" SET @AsOnDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",(this.ViewModel.oReportDialog.FromDate.Visible||-1!=this.colPeriodSaleIndex)&&(this.sbSubQuery+="\ndeclare @FromDate float SET @FromDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"')) "),this.ShowLevelTree?(this.sbSubQuery+="SELECT A.AccountID,A.AccountName,A.lft,A.rgt,A.IsGroup,A.Depth"+d+this.ViewModel.SelectTag+" FROM ACC_Accounts A with(nolock)",this.ViewModel.SelectTag.length>0&&this.ViewModel.SelectTag.Contains("AT.AccountType")&&(this.sbSubQuery+=" INNER JOIN ACC_ACCOUNTTYPES AT WITH(NOLOCK) ON AT.AccountTypeID=A.AccountTypeID "),this.sbSubQuery+=this.ViewModel.FromTag,m&&(this.sbSubQuery+=h),this.sbSubQuery+=" WHERE A.Depth>0",m&&(this.sbSubQuery+=" AND A."+u),this.sbSubQuery+=T,C.length>0&&(this.sbSubQuery+=C),this.sbSubQuery+=" ORDER BY A.lft"):(this.sbSubQuery+="SELECT A.AccountID,A.AccountName"+d+this.ViewModel.SelectTag+" FROM ACC_Accounts A with(nolock)",this.ViewModel.SelectTag.length>0&&this.ViewModel.SelectTag.Contains("AT.AccountType")&&(this.sbSubQuery+=" INNER JOIN ACC_ACCOUNTTYPES AT WITH(NOLOCK) ON AT.AccountTypeID=A.AccountTypeID "),this.sbSubQuery+=this.ViewModel.FromTag,m&&(this.sbSubQuery+=h),this.sbSubQuery+=" WHERE A.Depth>0",m&&(this.sbSubQuery+=" AND A."+u),this.sbSubQuery+=T,this.sbSubQuery+=C,this.sbSubQuery+=" ORDER BY A.AccountName");let I="";this.IsPaymentTermWise?(I+="\nSELECT *,Amount+Paid AdjAmount FROM (SELECT B.DocNo,"+s+" BillAmount, CASE WHEN EXISTS (select * from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo)\nTHEN (select CONVERT(DATETIME,max(DueDate)) from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo and DueDate<=@AsOnDate)\nELSE CONVERT(DATETIME,ISNULL(B.DocDueDate,B.DocDate)) END DocDate,B.AccountID\n\n,CASE WHEN EXISTS (select * from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo)\nTHEN (select sum(amount)*sign(B.AdjAmount)"+l+" from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo and DueDate<=@AsOnDate)\nELSE "+s+" END Amount,\nISNULL(\n(SELECT SUM(CB."+s+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND ",I+=this.PDCOnConvresionDate?"isnull(CB.ConvertedDate,CB.DocDate)<=@AsOnDate":"CB.DocDate<=@AsOnDate",I+=e+"),0) Paid"):(I+=" SELECT * from (",I+=" SELECT ",I+=this.GetDateColumn("B",""),-1!=this.colUnDueIndex&&(I+=",AdjAmount Amount"),-1!=this.colBillAmtIndex&&(I+=","+s+" BillAmount"),I+=",B.AccountID,"+s+"+ISNULL((SELECT SUM(CB."+s+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND CB.IsNewReference=0",I+=this.PDCOnConvresionDate?" AND isnull(CB.ConvertedDate,CB.DocDate)<=@AsOnDate":" AND CB.DocDate<=@AsOnDate",I+=e+"),0) AdjAmount",this.AgeingBasedOnMaturityDate&&(I+=",convert(datetime,CM.ChequeMaturityDate) CqMaturityDate")),-1==this.colPDCIndex&&-1==this.colIncludingPDCIndex||(this.colPDCIndex=0,I+=",ISNULL((SELECT SUM(CB."+s+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@AsOnDate AND "+p.Replace("StatusID","CB.StatusID")+_.Replace("B.","CB.")+"),0) TotalPDC "),(-1!=this.colPDCIndex||-1!=this.colIncludingPDCIndex||this.AgeingBasedOnMaturityDate)&&this.PDCInclude&&(I+=",B.StatusID Status"),I+=" FROM COM_Billwise B WITH(NOLOCK)",(C.length>0||T.length>0)&&(I+=" INNER JOIN ACC_Accounts A ON A.AccountID=B.AccountID"+C),m&&(I+=h),this.AgeingBasedOnMaturityDate&&(I+=" \nINNER JOIN (select VoucherNo,max(ChequeMaturityDate) ChequeMaturityDate from acc_docdetails with(nolock) where "+p+" group by VoucherNo) as CM\nON CM.VoucherNo=B.DocNo "),I+=" WHERE B.IsNewReference=1",this.IsPaymentTermWise||(I+=this.GetDateColumn("B","@AsOnDate")),I+=_,I+=this.PDCInclude?" AND ("+p.Replace("StatusID","B.StatusID")+" OR (DocType<>14 AND DocType<>19 AND "+c+"))":" AND DocType<>14 AND DocType<>19 AND "+c,m&&(I+=" AND B."+u),I+=T,this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?I+=" AND 1<>1":I+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),this.ForeignCurrencyID>0&&(I+=" AND B.AdjCurrID="+this.ForeignCurrencyID),this.IsPaymentTermWise?(I+=" ) AS T WHERE DocDate<=@AsOnDate AND Amount IS NOT NULL ",I+="\nSELECT PT.VoucherNo,PT.Amount"+l+" Amount,CONVERT(DATETIME,PT.DueDate) DueDate\nFROM  COM_Billwise B with(nolock) INNER JOIN COM_DocPayTerms PT with(nolock) ON PT.VoucherNo=B.DocNo",T.length>0&&(I+=" INNER JOIN ACC_Accounts A ON A.AccountID=B.AccountID"),m&&(I+=h),I+=" WHERE B.IsNewReference=1 and B.AccountID=PT.AccountID AND PT.DueDate<=@AsOnDate ",m&&(I+=" AND B."+u),I+=T,this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?I+=" AND 1<>1":I+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")")):(I+=this.AdjustmentRoundOff>0?" ) AS T WHERE abs(AdjAmount)>"+this.AdjustmentRoundOff:" ) AS T WHERE AdjAmount!=0",-1!=this.colPDCIndex&&(I+=" or TotalPDC!=0")),r=this.sbSubQuery.toString()+I.toString(),this.FutureSlabs&&(r+=I.toString().Replace("<=@AsOnDate",">@AsOnDate"))}else{this.LevelNo=0,this.ShowLevelTree=!1,this.ViewModel.FormulaObjects.Clear(),this.ViewModel.BaseReportColumns.forEach(e=>{i.e.IsEmpty(e.Formula.Text)||this.ViewModel.ParseFormula(e,!0)}),this.ViewModel.ReportGroups.forEach(e=>{i.e.IsEmpty(e.Formula.Text)||this.ViewModel.ParseFormula(e,!0)}),this.sbSubQuery="",I="",R="",this.strOrder="";let d=new Array,T=new Array;this.ViewModel.ReportGroups.forEach(e=>{(2==e.CDGDO.ColumnCostCenterID||e.CDGDO.ColumnCostCenterID>5e4)&&(2==e.CDGDO.CategoryValue?(e.CDGDO.ParentTableAlias="CC"+e.CDGDO.ColumnCostCenterID,i.e.IsEmpty(e.FormulaExpression)&&(I+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+" AS "+e.ID+","),T.Contains(e.CDGDO.ColumnCostCenterID)||(T.push(e.CDGDO.ColumnCostCenterID),R.Contains("CCD"+e.CDGDO.CategoryValue+".CostCenterID="+e.CDGDO.CategoryValue)||(R+=" INNER JOIN "+e.CDGDO.ParentTable+" AS CCD"+e.CDGDO.CategoryValue,R+=" WITH(NOLOCK) ON CCD"+e.CDGDO.CategoryValue+".NodeID=A.AccountID AND CCD"+e.CDGDO.CategoryValue+".CostCenterID="+e.CDGDO.CategoryValue),R+=" INNER JOIN "+e.CDGDO.ParentCostCenterSysName+" AS "+e.CDGDO.ParentTableAlias,R+=" WITH(NOLOCK) ON "+e.CDGDO.ParentTableAlias+".NodeID=CCD"+e.CDGDO.CategoryValue+"."+e.CDGDO.ParentColumn,this.strOrder+=e.ID+",")):(e.CDGDO.ParentTableAlias="C"+e.CDGDO.ColumnCostCenterID,i.e.IsEmpty(e.FormulaExpression)&&(I+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+" AS "+e.ID+","),d.Contains(e.CDGDO.ColumnCostCenterID)||(d.push(e.CDGDO.ColumnCostCenterID),R+=" INNER JOIN "+e.CDGDO.ParentCostCenterSysName+" AS "+e.CDGDO.ParentTableAlias,R+=2==e.CDGDO.ColumnCostCenterID?" with(nolock) ON "+e.CDGDO.ParentTableAlias+".AccountID=B.AccountID":" with(nolock) ON "+e.CDGDO.ParentTableAlias+".NodeID=B."+e.CDGDO.ParentColumn,this.strOrder+=e.ID+",")))}),this.ViewModel.BaseReportColumns.forEach(e=>{"0"==e.ShowAsColumn.SelectedValue&&(2==e.CDGDO.ColumnCostCenterID||e.CDGDO.ColumnCostCenterID>5e4)&&(2==e.CDGDO.CategoryValue?(e.CDGDO.ParentTableAlias="CC"+e.CDGDO.ColumnCostCenterID,I+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+" AS "+e.ID+",",T.Contains(e.CDGDO.ColumnCostCenterID)||(T.push(e.CDGDO.ColumnCostCenterID),R.Contains("CCD"+e.CDGDO.CategoryValue+".CostCenterID="+e.CDGDO.CategoryValue)||(R+=" INNER JOIN "+e.CDGDO.ParentTable+" AS CCD"+e.CDGDO.CategoryValue,R+=" WITH(NOLOCK) ON CCD"+e.CDGDO.CategoryValue+".NodeID=A.AccountID AND CCD"+e.CDGDO.CategoryValue+".CostCenterID="+e.CDGDO.CategoryValue),R+=" INNER JOIN "+e.CDGDO.ParentCostCenterSysName+" AS "+e.CDGDO.ParentTableAlias,R+=" WITH(NOLOCK) ON "+e.CDGDO.ParentTableAlias+".NodeID=CCD"+e.CDGDO.CategoryValue+"."+e.CDGDO.ParentColumn)):(e.CDGDO.ParentTableAlias="C"+e.CDGDO.ColumnCostCenterID,I+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+" AS "+e.ID+",",d.Contains(e.CDGDO.ColumnCostCenterID)||(d.push(e.CDGDO.ColumnCostCenterID),R+=" INNER JOIN "+e.CDGDO.ParentCostCenterSysName+" AS "+e.CDGDO.ParentTableAlias,R+=2==e.CDGDO.ColumnCostCenterID?" ON "+e.CDGDO.ParentTableAlias+".AccountID=B.AccountID":" ON "+e.CDGDO.ParentTableAlias+".NodeID=B."+e.CDGDO.ParentColumn)))}),d.Contains(2)?(this.ViewModel.SelectTag=this.ViewModel.SelectTag.Replace("A.","C2."),this.ViewModel.FromTag=this.ViewModel.FromTag.Replace("A.","C2."),R=R.Replace("A.","C2.")):(this.ViewModel.SelectTag="",this.ViewModel.FromTag="");let S="";if(t.length>0){let e="";d.forEach(t=>{t>=5e4&&(e+=" AND DCC.dcCCNID"+(t-5e4)+"=B.dcCCNID"+(t-5e4))}),-1!=this.colTotalSaleIndex&&(S=",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=SALE.InvDocDetailsID WHERE SALE.DebitAccount=B.AccountID "+e+" AND SALE.CostCenterID IN ("+t+") AND SALE.DocDate>=@AccountingDate AND SALE.DocDate<=@AsOnDate"+D+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=SALE.InvDocDetailsID WHERE SALE.CreditAccount=B.AccountID "+e+" AND SALE.CostCenterID IN ("+t+") AND SALE.DocDate>=@AccountingDate AND SALE.DocDate<=@AsOnDate"+D+"),0)  TotalSale"),-1!=this.colPrevYearSaleIndex&&(S=S+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=SALE.InvDocDetailsID WHERE SALE.DebitAccount=B.AccountID "+e+" AND SALE.CostCenterID IN ("+t+") AND SALE.DocDate<@AccountingDate"+D+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=SALE.InvDocDetailsID WHERE SALE.CreditAccount=B.AccountID "+e+" AND SALE.CostCenterID IN ("+t+") AND SALE.DocDate<@AccountingDate"+D+"),0)  PrevYearSale"),-1!=this.colPeriodSaleIndex&&(S=S+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=SALE.InvDocDetailsID WHERE SALE.DebitAccount=B.AccountID "+e+" AND SALE.CostCenterID IN ("+t+") AND SALE.DocDate>=@FromDate AND SALE.DocDate<=@AsOnDate"+D+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=SALE.InvDocDetailsID WHERE SALE.CreditAccount=B.AccountID "+e+" AND SALE.CostCenterID IN ("+t+") AND SALE.DocDate>=@FromDate AND SALE.DocDate<=@AsOnDate"+D+"),0) PeriodSale")}else this.colTotalSaleIndex=-1,this.colPrevYearSaleIndex=-1,this.colPeriodSaleIndex=-1;a.length>0&&-1!=this.colReceiptsAmtIndex?(S=S+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+a+")",this.ViewModel.oReportDialog.FromDate.Visible&&(S+=" AND SALE.DocDate>=@FromDate"),S=S+" AND SALE.DocDate<=@AsOnDate"+D+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+a+")",this.ViewModel.oReportDialog.FromDate.Visible&&(S+=" AND SALE.DocDate>=@FromDate"),S=S+" AND SALE.DocDate<=@AsOnDate"+D+"),0) ReceiptsAmount"):this.colReceiptsAmtIndex=-1,n.length>0&&-1!=this.colChqBounceAmtIndex?(S=S+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+n+")",this.ViewModel.oReportDialog.FromDate.Visible&&(S+=" AND SALE.DocDate>=@FromDate"),S=S+" AND SALE.DocDate<=@AsOnDate"+D+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+n+")",this.ViewModel.oReportDialog.FromDate.Visible&&(S+=" AND SALE.DocDate>=@FromDate"),S=S+" AND SALE.DocDate<=@AsOnDate"+D+"),0) ChequeBounceAmount"):this.colChqBounceAmtIndex=-1,this.colUnDueIndex=-1,this.sbSubQuery+="DECLARE @AccountingDate FLOAT,@AsOnDate FLOAT\nSET @AccountingDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+o.a.SessionManager.AccountingDate.ToString("dd MMM yyyy")+"'))",this.AllowFromDateFilter&&(this.sbSubQuery+="\ndeclare @From float SET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))"),this.sbSubQuery+=this.dtMonthWiseEndData?" SET @AsOnDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.dtMonthWiseEndData.ToString("dd MMM yyyy")+"'))":" SET @AsOnDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",(this.ViewModel.oReportDialog.FromDate.Visible||-1!=this.colPeriodSaleIndex)&&(this.sbSubQuery+="\ndeclare @FromDate float SET @FromDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"')) ");let A="";this.IsPaymentTermWise?(A+="\nSELECT *,Amount+Paid AdjAmount FROM (SELECT "+I+"B.DocNo, CASE WHEN EXISTS (select * from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo)\nTHEN (select CONVERT(DATETIME,max(DueDate)) from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo and DueDate<=@AsOnDate)\nELSE CONVERT(DATETIME,ISNULL(B.DocDueDate,B.DocDueDate)) END DocDate,B.AccountID\n\n,CASE WHEN EXISTS (select * from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo)\nTHEN (select sum(amount)*sign(B.AdjAmount)"+l+" from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo and DueDate<=@AsOnDate)\nELSE "+s+" END Amount,\nISNULL(\n(SELECT SUM(CB."+s+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND ",A+=this.PDCOnConvresionDate?"isnull(CB.ConvertedDate,CB.DocDate)<=@AsOnDate":"CB.DocDate<=@AsOnDate",A+=e+"),0) Paid"):(A+=" SELECT * from (",A+=" SELECT "+I,A+="B.AccountID,",A+=this.GetDateColumn("B",""),A+=",B.DocNo,"+s+" + ISNULL((SELECT SUM(CB."+s+") FROM COM_Billwise CB WHERE CB.RefDocNo=B.DocNo AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0",A+=this.PDCOnConvresionDate?" AND isnull(CB.ConvertedDate,CB.DocDate)<=@AsOnDate":" AND CB.DocDate<=@AsOnDate",A+=e+"),0) AdjAmount ",this.AgeingBasedOnMaturityDate&&(A+=",convert(datetime,CM.ChequeMaturityDate) CqMaturityDate")),-1==this.colPDCIndex&&-1==this.colIncludingPDCIndex||(this.colPDCIndex=0,A+=",ISNULL((SELECT SUM(CB."+s+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@AsOnDate AND "+p.Replace("StatusID","CB.StatusID")+_.Replace("B.","CB.")+"),0) TotalPDC "),(-1!=this.colPDCIndex||-1!=this.colIncludingPDCIndex||this.AgeingBasedOnMaturityDate)&&this.PDCInclude&&(A+=",B.StatusID Status"),A+=S,A+=this.ViewModel.SelectTag,A+=" FROM COM_Billwise B with(nolock)"+R+this.ViewModel.FromTag,m&&(A+=h),this.AgeingBasedOnMaturityDate&&(A+=" \nINNER JOIN (select VoucherNo,max(ChequeMaturityDate) ChequeMaturityDate from acc_docdetails with(nolock) where "+p+" group by VoucherNo) as CM\nON CM.VoucherNo=B.DocNo "),A+=" WHERE B.IsNewReference=1",d.Contains(2)&&C.length>0&&(A+=C.Replace("A.","C2.")),this.IsPaymentTermWise||(A+=this.GetDateColumn("B","@AsOnDate")),A+=_,A+=this.PDCInclude?" AND ("+p.Replace("StatusID","B.StatusID")+" OR (DocType<>14 AND DocType<>19 AND "+c+"))":" AND DocType<>14 AND DocType<>19 AND "+c,m&&(A+=" AND B."+u),this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?A+=" AND 1<>1":A+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),this.ForeignCurrencyID>0&&(A+=" AND B.AdjCurrID="+this.ForeignCurrencyID),this.IsPaymentTermWise?(A+=" ) AS T WHERE DocDate<=@AsOnDate AND Amount IS NOT NULL ",A+="\nSELECT PT.VoucherNo,PT.Amount"+l+" Amount,CONVERT(DATETIME,PT.DueDate) DueDate\nFROM  COM_Billwise B with(nolock) INNER JOIN COM_DocPayTerms PT with(nolock) ON PT.VoucherNo=B.DocNo",m&&(A+=h),A+=" WHERE B.IsNewReference=1 and B.AccountID=PT.AccountID AND PT.DueDate<=@AsOnDate ",m&&(A+=" AND B."+u),this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?A+=" AND 1<>1":A+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")")):(A+=this.AdjustmentRoundOff>0?" ) AS T WHERE abs(AdjAmount)>"+this.AdjustmentRoundOff:" ) AS T WHERE AdjAmount!=0",-1!=this.colPDCIndex&&(A+=" or TotalPDC!=0")),r=this.sbSubQuery.toString()+A.toString(),this.FutureSlabs&&(r+=A.toString().Replace("<=@AsOnDate",">@AsOnDate"))}}return o.a.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,r)}GetDataSetFIFO(e,t){let s,l,a,n="",r="",h="",u="",D=0;l=0!=this.oColumns.filter(e=>"BillNo"==e.ID).length,a=0!=this.oColumns.filter(e=>"BillDate"==e.ID).length;let d="";h="B.StatusID=369 or B.StatusID=429",this.UnPostedDocsList.length>0&&this.UnPostedDocsList.split(",").forEach(e=>{h+=" or B.StatusID="+e}),h=" and ("+h+")";let c="";this.UnPostedDocsList.length>0&&this.UnPostedDocsList.split(",").forEach(e=>{c+=" or StatusID="+e});let C="(StatusID=370 OR StatusID=439"+c+(this.IncludeTerminatedPDC?" OR StatusID=452":"")+")";s=this.ForeignCurrencyID>0?"AmountFC":1==this.CurrencyType?"isnull(AmountBC,0)":"Amount",this.ViewModel.HideCostCenterTree||this.ViewModel.oReportDialog.IsZeroSelected||this.ViewModel.oReportDialog.IsOneSelected||(this.ViewModel.oReportDialog.IsGroupExists?(r="AccountID=GTP.GTID",n=t.Contains(",")?",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID IN ("+t+") group by T.AccountID) AS GTP ":",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID="+t+" group by T.AccountID) AS GTP "):r=t.Contains(",")?"AccountID IN ("+t+")":"AccountID="+t),d=this.GetAccountTypeWhere("A"),this.sbSubQuery="",this.GroupRowsCount=0;let p="",T="",_="";this.strOrder="",this.ViewModel.ReportGroups.forEach(e=>{2==e.CDGDO.ColumnCostCenterID?(p+="A."+e.CDGDO.Column+" AS "+e.ID+",A.AccountID AS "+e.ID+"_ID,","1"!=e.ShowAsColumn.SelectedValue&&(this.AccountGroupIndex=this.GroupRowsCount)):e.CDGDO.ColumnCostCenterID>5e4&&400==e.CDGDO.CategoryValue&&(e.CDGDO.ParentTableAlias="C"+e.CDGDO.ColumnCostCenterID,p+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+" AS "+e.ID+","+e.CDGDO.ParentTableAlias+".NodeID AS "+e.ID+"_ID,",_+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+","+e.CDGDO.ParentTableAlias+".NodeID,",11!=this.ViewModel.StaticReportType&&12!=this.ViewModel.StaticReportType&&50002==e.CDGDO.ColumnCostCenterID||(T+=" INNER JOIN "+e.CDGDO.ParentCostCenterSysName+" AS "+e.CDGDO.ParentTableAlias,T+=" WITH(NOLOCK) ON "+e.CDGDO.ParentTableAlias+".NodeID=DCC."+e.CDGDO.ParentColumn),D=e.CDGDO.ColumnCostCenterID,u=e.ID+"_ID,"),this.strOrder+=e.ID+",","1"!=e.ShowAsColumn.SelectedValue&&this.GroupRowsCount++});let m="";if(12==e){if(this.ShowLevelTree=!1,this.ViewModel.Preferences.ContainsKey("ShowLevel")){let e=new i.f;e.LoadXml("<XML>"+this.ViewModel.Preferences.ShowLevel+"</XML>");let t=i.f.SelectSingleNode(e.DocumentElement,"IsChecked");null!=t&&"1"==t.innerHTML&&(this.ShowLevelTree=!0,t=i.f.SelectSingleNode(e.DocumentElement,"Text"),this.LevelNo=parseInt(t.innerHTML))}let e=this.ViewModel.Preferences.ContainsKey("SalesDocs")?this.ViewModel.Preferences.SalesDocs:"";if(this.lstGroup.length<=1)e.length>0?(-1!=this.colTotalSaleIndex&&(m=",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+e+") AND SALE.DocDate>=@AccountingDate AND SALE.DocDate<=@To),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+e+") AND SALE.DocDate>=@AccountingDate AND SALE.DocDate<=@To),0)  TotalSale"),-1!=this.colPrevYearSaleIndex&&(m=m+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+e+") AND SALE.DocDate<@AccountingDate),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+e+") AND SALE.DocDate<@AccountingDate),0)  PrevYearSale")):(this.colTotalSaleIndex=-1,this.colPrevYearSaleIndex=-1),-1==this.colPDCIndex&&-1==this.colIncludingPDCIndex||(this.colPDCIndex=0,p+="ISNULL(sum(case when "+C.Replace("StatusID","B.StatusID")+" then B."+s+" else 0 end),0) TotalPDC,",this.PDCInclude&&(p+="B.StatusID Status,"));else{p="",T="",this.strOrder="";let t=new Array,o=new Array;if(this.ViewModel.ReportGroups.forEach(e=>{(2==e.CDGDO.ColumnCostCenterID||e.CDGDO.ColumnCostCenterID>5e4)&&(2==e.CDGDO.CategoryValue?(e.CDGDO.ParentTableAlias="CC"+e.CDGDO.ColumnCostCenterID,i.e.IsEmpty(e.FormulaExpression)&&(p+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+" AS "+e.ID+","),o.Contains(e.CDGDO.ColumnCostCenterID)||(o.push(e.CDGDO.ColumnCostCenterID),T.Contains("CCD"+e.CDGDO.CategoryValue+".CostCenterID="+e.CDGDO.CategoryValue)||(T+=" INNER JOIN "+e.CDGDO.ParentTable+" AS CCD"+e.CDGDO.CategoryValue,T+=" WITH(NOLOCK) ON CCD"+e.CDGDO.CategoryValue+".NodeID=A.AccountID AND CCD"+e.CDGDO.CategoryValue+".CostCenterID="+e.CDGDO.CategoryValue),T+=" INNER JOIN "+e.CDGDO.ParentCostCenterSysName+" AS "+e.CDGDO.ParentTableAlias,T+=" WITH(NOLOCK) ON "+e.CDGDO.ParentTableAlias+".NodeID=CCD"+e.CDGDO.CategoryValue+"."+e.CDGDO.ParentColumn,this.strOrder+=e.ID+",")):(e.CDGDO.ParentTableAlias="C"+e.CDGDO.ColumnCostCenterID,i.e.IsEmpty(e.FormulaExpression)&&(p+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+" AS "+e.ID+","),t.Contains(e.CDGDO.ColumnCostCenterID)||(t.push(e.CDGDO.ColumnCostCenterID),T+=" INNER JOIN "+e.CDGDO.ParentCostCenterSysName+" AS "+e.CDGDO.ParentTableAlias,T+=2==e.CDGDO.ColumnCostCenterID?" with(nolock) ON "+e.CDGDO.ParentTableAlias+".AccountID=B.AccountID":" with(nolock) ON "+e.CDGDO.ParentTableAlias+".NodeID=B."+e.CDGDO.ParentColumn,this.strOrder+=e.ID+",")))}),this.ViewModel.BaseReportColumns.forEach(e=>{"0"==e.ShowAsColumn.SelectedValue&&(2==e.CDGDO.ColumnCostCenterID||e.CDGDO.ColumnCostCenterID>5e4)&&(2==e.CDGDO.CategoryValue?(e.CDGDO.ParentTableAlias="CC"+e.CDGDO.ColumnCostCenterID,p+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+" AS "+e.ID+",",o.Contains(e.CDGDO.ColumnCostCenterID)||(o.push(e.CDGDO.ColumnCostCenterID),T.Contains("CCD"+e.CDGDO.CategoryValue+".CostCenterID="+e.CDGDO.CategoryValue)||(T+=" INNER JOIN "+e.CDGDO.ParentTable+" AS CCD"+e.CDGDO.CategoryValue,T+=" WITH(NOLOCK) ON CCD"+e.CDGDO.CategoryValue+".NodeID=A.AccountID AND CCD"+e.CDGDO.CategoryValue+".CostCenterID="+e.CDGDO.CategoryValue),T+=" INNER JOIN "+e.CDGDO.ParentCostCenterSysName+" AS "+e.CDGDO.ParentTableAlias,T+=" WITH(NOLOCK) ON "+e.CDGDO.ParentTableAlias+".NodeID=CCD"+e.CDGDO.CategoryValue+"."+e.CDGDO.ParentColumn)):(e.CDGDO.ParentTableAlias="C"+e.CDGDO.ColumnCostCenterID,p+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+" AS "+e.ID+",",t.Contains(e.CDGDO.ColumnCostCenterID)||(t.push(e.CDGDO.ColumnCostCenterID),T+=" INNER JOIN "+e.CDGDO.ParentCostCenterSysName+" AS "+e.CDGDO.ParentTableAlias,T+=2==e.CDGDO.ColumnCostCenterID?" ON "+e.CDGDO.ParentTableAlias+".AccountID=B.AccountID":" ON "+e.CDGDO.ParentTableAlias+".NodeID=B."+e.CDGDO.ParentColumn)))}),t.Contains(2)?(this.ViewModel.SelectTag=this.ViewModel.SelectTag.Replace("A.","C2."),this.ViewModel.FromTag=this.ViewModel.FromTag.Replace("A.","C2."),T=T.Replace("A.","C2.")):(this.ViewModel.SelectTag="",this.ViewModel.FromTag=""),e.length>0){let s="";t.forEach(e=>{e>=5e4&&(s+=" AND DCC.dcCCNID"+(e-5e4)+"=B.dcCCNID"+(e-5e4))}),-1!=this.colTotalSaleIndex&&(m=",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=SALE.InvDocDetailsID WHERE SALE.DebitAccount=B.AccountID "+s+" AND SALE.CostCenterID IN ("+e+") AND SALE.DocDate>=@AccountingDate AND SALE.DocDate<=@To),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=SALE.InvDocDetailsID WHERE SALE.CreditAccount=B.AccountID "+s+" AND SALE.CostCenterID IN ("+e+") AND SALE.DocDate>=@AccountingDate AND SALE.DocDate<=@To),0)  TotalSale"),-1!=this.colPrevYearSaleIndex&&(m=m+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=SALE.InvDocDetailsID WHERE SALE.DebitAccount=B.AccountID "+s+" AND SALE.CostCenterID IN ("+e+") AND SALE.DocDate<@AccountingDate),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=SALE.InvDocDetailsID WHERE SALE.CreditAccount=B.AccountID "+s+" AND SALE.CostCenterID IN ("+e+") AND SALE.DocDate<@AccountingDate),0)  PrevYearSale")}else this.colTotalSaleIndex=-1,this.colPrevYearSaleIndex=-1;-1==this.colPDCIndex&&-1==this.colIncludingPDCIndex||(this.colPDCIndex=0,p+="ISNULL(sum(case when "+C.Replace("StatusID","B.StatusID")+" then B."+s+" else 0 end),0) TotalPDC,",this.PDCInclude&&(p+="B.StatusID Status,"))}}else this.ViewModel.FromTag=this.ViewModel.FromTag+T;if(10==e||11==e||12==e){let t="";t+=this.GetDimensionFilter("DCC.dcCCNID"),t+=d,this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?t+=" AND 1<>1":t+=" AND DCC.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")");let s=[];return s.push(e),s.push(n),s.push(r),s.push(12==e?o.a.SessionManager.AccountingDate:this.ViewModel.oReportDialog.ToDate.Date),s.push(this.ViewModel.oReportDialog.ToDate.Date),s.push(this.ViewModel.Preferences.Date),s.push("Payables"==this.ViewModel.Preferences.IncludeBills?0:1),s.push(h),s.push(t.toString()),s.push(this.PDCInclude),s.push(this.PDCSeperate),s.push(this.FilterPDCOnMaturityDate),s.push(this.CurrencyType),s.push(this.ForeignCurrencyID),s.push(12==e?this.ShowLevelTree:l),s.push(a),s.push(m),s.push(12==e?d:""),s.push(p),s.push(D),s.push(u),s.push(_),s.push(this.ViewModel.SelectTag),s.push(this.ViewModel.SelectTagAliasOnly),s.push(this.ViewModel.FromTag),s.push(12==e&&this.FutureSlabs),s.push(o.a.SessionManager.LanguageID),o.a.report.GetLOBFIFO(s,this.ViewModel.IsReportDB).then(t=>{let s=t;this.dsMain=s,"Payables"==this.ViewModel.Preferences.IncludeBills&&(10==e?s.Tables[0].forEach(e=>{null!=e.Amount&&(e.Amount=-parseFloat(e.Amount)),null!=e.BillAmount&&(e.BillAmount=-parseFloat(e.BillAmount)),null!=e.Adjusted&&(e.Adjusted=-parseFloat(e.Adjusted))}):11==e?s.Tables[0].forEach(e=>{null!=e.AdjAmount&&(e.AdjAmount=-parseFloat(e.AdjAmount)),null!=e.BillAmount&&(e.BillAmount=-parseFloat(e.BillAmount)),null!=e.Paid&&(e.Paid=-parseFloat(e.Paid))}):12==e&&(s.Tables[1].forEach(e=>{null!=e.Amount&&(e.Amount=-parseFloat(e.Amount)),null!=e.UnAdjustedAmount&&(e.UnAdjustedAmount=-parseFloat(e.UnAdjustedAmount))}),s.Tables[2].forEach(e=>{null!=e.AdjAmount&&(e.AdjAmount=-parseFloat(e.AdjAmount))}),s.Tables.Count>3&&s.Tables[3].Rows.Count>0&&s.Tables[3].forEach(e=>{null!=e.AdjAmount&&(e.AdjAmount=-parseFloat(e.AdjAmount))})))})}return new Promise((e,t)=>{})}GetDateColumn(e,t){let s="";return 0==t.length?s=this.PDCOnConvresionDate?"DocDueDate"==this.ViewModel.Preferences.Date?"CONVERT(DATETIME,isnull("+e+".ConvertedDate,isnull("+e+".DocDueDate,"+e+".DocDate))) DocDate":"CONVERT(DATETIME,isnull("+e+".ConvertedDate,"+e+"."+this.ViewModel.Preferences.Date+")) DocDate":"DocDueDate"==this.ViewModel.Preferences.Date?"CONVERT(DATETIME,isnull("+e+".DocDueDate,"+e+".DocDate)) DocDate":"CONVERT(DATETIME,"+e+"."+this.ViewModel.Preferences.Date+") DocDate":(this.AllowFromDateFilter&&(s=this.PDCOnConvresionDate?"DocDueDate"==this.ViewModel.Preferences.Date?" AND ISNULL(B.ConvertedDate,isnull("+e+".DocDueDate,"+e+".DocDate))>=@From":" AND ISNULL(B.ConvertedDate,"+e+"."+this.ViewModel.Preferences.Date+")>=@From":"DocDueDate"==this.ViewModel.Preferences.Date?" AND isnull("+e+".DocDueDate,"+e+".DocDate)>=@From":" AND "+e+"."+this.ViewModel.Preferences.Date+">=@From"),s+=this.PDCOnConvresionDate?"DocDueDate"==this.ViewModel.Preferences.Date?11==this.ViewModel.StaticReportType&&-1!=this.colUnDueIndex?" AND ISNULL(B.ConvertedDate,"+e+".DocDate)<="+t:" AND ISNULL(B.ConvertedDate,isnull("+e+".DocDueDate,"+e+".DocDate))<="+t:" AND ISNULL(B.ConvertedDate,"+e+"."+this.ViewModel.Preferences.Date+")<="+t:"DocDueDate"==this.ViewModel.Preferences.Date?11==this.ViewModel.StaticReportType&&-1!=this.colUnDueIndex?" AND "+e+".DocDate<="+t:" AND isnull("+e+".DocDueDate,"+e+".DocDate)<="+t:" AND "+e+"."+this.ViewModel.Preferences.Date+"<="+t),s}GetDocumentTypeFilter(){let e=this.GetFilterByDimension_1(300);return e.length>0&&(e=e.Contains(",")?" AND (SELECT top(1) CostCenterID FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo) IN ("+e+")":" AND (SELECT top(1) CostCenterID FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo)="+e),e}addRows(){let e=0;if(-1!=this.AccountGroupIndex){let e=this.ViewModel.Data.length-(this.GroupRowsCount-this.AccountGroupIndex);if(e>=0&&!this.ViewModel.lstGroupIndex.Contains(e)&&this.ViewModel.Data[this.ViewModel.Data.length-1].Type==r.f.Group&&this.ViewModel.Data[e].Type==r.f.Group&&(this.ViewModel.Data[e].NodeID=parseInt(this.drMainRow.AccountID),this.ViewModel.lstGroupIndex.push(e),null!=this.tempTotals)){for(let e=0;e<this.tempTotals.length;e++)this.tempTotals[e]=this.ViewModel.totals[e][this.lstGroup.length];for(let e=0;e<this.tempHiddenTotals.length;e++)this.tempHiddenTotals[e]=this.ViewModel.hiddenTotals[e][this.lstGroup.length]}}if(0==this.ViewModel.IsNewGroupIndex&&(this.dblBalanceCum=0),this.StatusID=parseInt(this.drMainRow.StatusID),this.UnPostedDocsInclude&&this.UnPostedDocsSeparately&&369!=this.StatusID&&439!=this.StatusID&&370!=this.StatusID){let e=!0;if(this.ViewModel.Data.length>0&&null!=this.ViewModel.Data[this.ViewModel.Data.length-1].DataRow&&parseInt(this.ViewModel.Data[this.ViewModel.Data.length-1].DataRow.StatusID)==this.StatusID&&(e=!1),e){this.AddSubTotal("",!1,!0);for(let e=0;e<this.tempTotals.length;e++)this.tempTotals[e]=this.ViewModel.totals[e][this.lstGroup.length];for(let e=0;e<this.tempHiddenTotals.length;e++)this.tempHiddenTotals[e]=this.ViewModel.hiddenTotals[e][this.lstGroup.length];this.row=this.NewReportRow_2(r.f.GrossTotal,this.GrossTotalAppearance),this.row.LevelNo=this.ViewModel.lstGroup.length,this.row.Cells[0].ColSpan=this.ViewModel.ReportColumns.length,this.row.Cells[0].Text=this.arrUnPostedStatuses[this.StatusID],this.ViewModel.addRow(this.row)}}let t=!(!this.PDCSeperate||1!=parseInt(this.drMainRow.IsPDC));if(this.PDCSeperate&&t){let e=!0;if(this.ViewModel.Data.length>0&&null!=this.ViewModel.Data[this.ViewModel.Data.length-1].DataRow&&1==parseInt(this.ViewModel.Data[this.ViewModel.Data.length-1].DataRow.IsPDC)&&(e=!1),e){this.ViewModel.Data.length>0&&this.ViewModel.Data[this.ViewModel.Data.length-1].Type==r.f.Detail?(this.AddPDCSubTotal=!0,this.AddSubTotal("",!1,!0)):this.AddPDCSubTotal=!1;for(let t=0;t<this.tempTotals.length;t++)this.tempTotals[t]=this.ViewModel.totals[t][this.lstGroup.length];for(let t=0;t<this.tempHiddenTotals.length;t++)this.tempHiddenTotals[t]=this.ViewModel.hiddenTotals[t][this.lstGroup.length];let e;this.row=this.NewReportRow_2(r.f.GrossTotal,this.GrossTotalAppearance),this.row.LevelNo=this.ViewModel.lstGroup.length,this.row.Cells[0].ColSpan=this.ViewModel.ReportColumns.length,this.row.Cells[0].Text=o.a.GetResource("Reports_PDCList"),this.ViewModel.addRow(this.row),this.dvPDCSeperate=this.dvPDCSeperateTable.filter(e=>1==e.IsPDC),this.ViewModel.ReportGroups.forEach(e=>{this.ViewModel.ReportGroups.length>1&&this.ViewModel.ReportGroups[1]==e?e.CDGDO.IsForeignKey&&(this.dvPDCSeperate=this.dvPDCSeperate.filter(t=>t[e.ID+"_ID"]==this.drMainRow[e.ID+"_ID"])):this.dvPDCSeperate=this.dvPDCSeperate.filter(t=>t[e.ID+"_ID"]==this.drMainRow[e.ID+"_ID"])}),this.dvPDCSeperate.SortBy(["DocNo"]);for(let t=0;t<this.dvPDCSeperate.length;t++)e!=this.dvPDCSeperate[t].DocNo.toString()?(e=this.dvPDCSeperate[t].DocNo.toString(),this.HidePDCAdjustments&&null!=this.dvPDCSeperate[t].AgainstVoucher&&(this.dvPDCSeperate[t].Adjusted=-parseFloat(this.dvPDCSeperate[t].Amount))):(this.HidePDCAdjustments&&(this.dvPDCSeperate[t-1].Adjusted=parseFloat(this.dvPDCSeperate[t-1].Adjusted)-parseFloat(this.dvPDCSeperate[t].Amount)),this.dvPDCSeperate[t-1].Amount=parseFloat(this.dvPDCSeperate[t-1].Amount)+parseFloat(this.dvPDCSeperate[t].Amount),this.dvPDCSeperate[t-1].BillAmount=parseFloat(this.dvPDCSeperate[t-1].BillAmount)+parseFloat(this.dvPDCSeperate[t].BillAmount),null!=this.dvPDCSeperate[t].AgainstVoucher&&(this.dvPDCSeperate[t-1].AgainstVoucher=null==this.dvPDCSeperate[t-1].AgainstVoucher?this.dvPDCSeperate[t].AgainstVoucher:this.dvPDCSeperate[t-1].AgainstVoucher.toString()+", "+this.dvPDCSeperate[t].AgainstVoucher.toString()),this.dvPDCSeperateTable.Remove(this.dvPDCSeperate[t]),this.dsMain.Tables[0].Remove(this.dvPDCSeperate[t]),this.dvPDCSeperate.Remove(this.dvPDCSeperate[t]),t--)}}else this.AddPDCSubTotal=!1;this.dblBalance=parseFloat(this.drMainRow.Amount),this.dblPaidTotal=i.e.Double(this.drMainRow.Adjusted),this.MainRow=this.NewReportRow(),this.MainRow.LevelNo=this.ViewModel.lstGroup.length;let s=0;if(this.ClubByVoucherNo)if(null!=this.drMainRow.RType&&(s=parseInt(this.drMainRow.RType)),2==s){this.drMainRow.DocNo="   "+this.drMainRow.Narration.toString(),this.MainRow.LevelNo=this.ViewModel.lstGroup.length-1,this.MainRow.Visible=!1,this.MainRow.Parent=this.ParentRow;for(let e=0;e<this.ViewModel.ReportColumns.length;e++)this.MainRow.Cells[e].IsNormal=!1,this.MainRow.Cells[e].CellAppearance=this.ViewModel.ReportColumns[e].DataAppearance.Clone(),this.MainRow.Cells[e].CellAppearance.BackColor="#fff8f8f8"}else 1==s&&(this.ParentRow=this.MainRow,this.MainRow.IsGroup=!0,this.MainRow.IsExpanded=!1);if(this.MainRow.DataRow=this.drMainRow,this.dblBalance=this.dblBalance+this.dblPaidTotal,!(10==this.ViewModel.StaticReportType&&Math.abs(this.dblBalance)<this.AdjustmentRoundOff)||this.HidePDCAdjustments&&this.PDCSeperate&&t||this.UnAppsDocsAdjustSeperate&&371==this.StatusID){this.drMainRow.Balance=this.dblBalance,this.dblBalance>0?(this.drMainRow.Credit=null,this.drMainRow.Debit=this.dblBalance):this.dblBalance<0&&(this.drMainRow.Debit=null,this.drMainRow.Credit=-this.dblBalance);for(let o=0;o<this.oColumns.length;o++)if(!Object(u.isUndefined)(this.drMainRow[this.oColumns[o].ID])){if("FLOAT"==this.oColumns[o].ColumnType)try{i.e.IsEmpty(this.drMainRow[this.oColumns[o].ID])||2==s||(e=parseFloat(this.drMainRow[this.oColumns[o].ID]),this.ViewModel.totals[o][this.lstGroup.length]+=e)}catch(l){}this.ViewModel.SetCellValue(this.HidePDCAdjustments&&this.PDCSeperate&&t&&o==this.colBalanceIndex?this.drMainRow.Amount:this.drMainRow[this.oColumns[o].ID],this.oColumns[o].DataFormat,this.oColumns[o].ColumnType,this.MainRow.Cells[o])}for(let t=0;t<this.ViewModel.HiddenNumericColumns.length;t++)if(!Object(u.isUndefined)(this.drMainRow[this.ViewModel.HiddenNumericColumns[t].ID]))try{i.e.IsEmpty(this.drMainRow[this.ViewModel.HiddenNumericColumns[t].ID])||2==s||(e=parseFloat(this.drMainRow[this.ViewModel.HiddenNumericColumns[t].ID]),this.ViewModel.hiddenTotals[t][this.lstGroup.length]+=e)}catch(a){}if(0!=this.dblPaidTotal&&(10==this.ViewModel.StaticReportType||9==this.ViewModel.StaticReportType&&this.DontShowBillAdjustments)&&(-1!=this.colAdjustedIndex?(this.HidePDCAdjustments&&this.PDCSeperate&&t||this.ViewModel.SetCellValue(this.dblPaidTotal,this.oColumns[this.colAdjustedIndex].DataFormat,"FLOAT",this.MainRow.Cells[this.colAdjustedIndex]),2!=s&&(this.ViewModel.totals[this.colAdjustedIndex][this.lstGroup.length]+=this.dblPaidTotal)):-1!=this.colHiddenAdjustedIndex&&2!=s&&(this.ViewModel.hiddenTotals[this.colHiddenAdjustedIndex][this.lstGroup.length]+=this.dblPaidTotal),2!=s&&(this.dblBalanceCum+=this.dblPaidTotal)),2!=s&&(Object(u.isNullOrUndefined)(this.drMainRow.Amount)||(this.dblBalanceCum+=parseFloat(this.drMainRow.Amount)),-1!=this.colBalanceCumIndex&&(this.drMainRow[this.oColumns[this.colBalanceCumIndex].ID+"CUMULATIVE"]=this.dblBalance,this.ViewModel.totals[this.colBalanceCumIndex][this.lstGroup.length]=this.dblBalanceCum,this.HidePDCAdjustments&&this.PDCSeperate&&t||this.ViewModel.SetCellValue(this.dblBalanceCum,this.oColumns[this.colBalanceCumIndex].DataFormat,"FLOAT",this.MainRow.Cells[this.colBalanceCumIndex]))),this.ViewModel.IsSummary||(-1!=this.ViewModel.colSNoIndex&&(this.MainRow.Cells[this.ViewModel.colSNoIndex].Value=++this.ViewModel.SNo,this.MainRow.Cells[this.ViewModel.colSNoIndex].Text=this.ViewModel.SNo.toString()),this.ViewModel.ApplyKPI(this.MainRow),this.ViewModel.addRow(this.MainRow)),9==this.ViewModel.StaticReportType&&!this.DontShowBillAdjustments){this.dvChild=this.dvChildTable.filter(e=>e.RefDocNo==this.drMainRow.DocNo.toString().Replace("'","''")&&e.RefDocSeqNo==this.drMainRow.DocSeqNo.toString()),-1!=this.colPaidByDaysIndex&&(this.AggTotal[this.colPaidByDaysIndex][1]+=this.dvChild.length),this.dblPaidTotal=0;let e=0;for(this.k=0;this.k<this.dvChild.length;this.k++){this.row=this.NewReportRow(),this.row.LevelNo=this.ViewModel.lstGroup.length,this.dblAmount=parseFloat(this.dvChild[this.k].AdjAmount),this.dblPaidTotal+=this.dblAmount,this.dblBalance+=this.dblAmount,this.dblBalanceCum+=this.dblAmount,-1!=this.colAdjustedIndex&&(this.AggTotal[this.colAdjustedIndex][1]+=this.dblAmount,this.ViewModel.totals[this.colAdjustedIndex][this.lstGroup.length]+=this.dblAmount),i.e.IsEmpty(this.drMainRow.BillNo)||i.e.IsEmpty(this.dvChild[this.k].BillNo)||(this.dvChild[this.k].BillNo=this.drMainRow.BillNo);for(let e=0;e<this.oColumns.length;e++)Object(u.isUndefined)(this.dvChild[this.k][this.oColumns[e].ID])?"AgainstVoucher"==this.oColumns[e].ID?this.row.Cells[e].Text=this.drMainRow.DocNo.toString():"AgainstVoucherDate"==this.oColumns[e].ID&&this.ViewModel.SetCellValue(this.drMainRow.DocDate,this.oColumns[e].DataFormat,this.oColumns[e].ColumnType,this.row.Cells[e]):this.ViewModel.SetCellValue(this.dvChild[this.k][this.oColumns[e].ID],this.oColumns[e].DataFormat,this.oColumns[e].ColumnType,this.row.Cells[e]);-1!=this.colPaidByDaysIndex&&null!=this.dvChild[this.k].PaidByDays&&(e+=parseFloat(this.dvChild[this.k].PaidByDays),this.ViewModel.totals[this.colPaidByDaysIndex][1]+=parseFloat(this.dvChild[this.k].PaidByDays)),-1!=this.colBalanceCumIndex&&(this.drMainRow[this.oColumns[this.colBalanceCumIndex].ID+"CUMULATIVE"]=this.dblBalanceCum,this.ViewModel.totals[this.colBalanceCumIndex][this.lstGroup.length]=this.dblBalanceCum,0!=this.dblBalanceCum&&this.ViewModel.SetCellValue(this.dblBalanceCum,this.oColumns[this.colBalanceCumIndex].DataFormat,"FLOAT",this.row.Cells[this.colBalanceCumIndex])),this.ViewModel.IsSummary||this.ViewModel.addRow(this.row)}if(-1!=this.colPaidByDaysIndex&&e>0){this.drMainRow.PaidByDays=e/this.dvChild.length,this.ViewModel.SetCellValue(e/this.dvChild.length,this.oColumns[this.colPaidByDaysIndex].DataFormat,"FLOAT",this.MainRow.Cells[this.colPaidByDaysIndex]);let t=this.ViewModel.Data.indexOf(this.MainRow);t>=0&&(this.ViewModel.Data.RemoveAt(t),this.ViewModel.Data.Insert(t,this.MainRow))}}}}LOBSubTotalCallBack(e){if(this.UnPostedDocsInclude&&!this.AddPDCSubTotal&&369!=this.StatusID&&0!=this.StatusID&&e==this.lstGroup.length&&this.ViewModel.Data.length>0&&this.ViewModel.Data[this.ViewModel.Data.length-1].Type==r.f.Detail&&this.AddSubTotal("",!1,!0),this.PDCSeperate&&this.AddPDCSubTotal&&e==this.lstGroup.length&&this.ViewModel.Data.length>0&&this.ViewModel.Data[this.ViewModel.Data.length-1].Type==r.f.Detail&&(this.AddSubTotal("PDC",!0),this.HidePDCAdjustments)){let e=Math.min.apply(null,this.ViewModel.lstGroup[this.ViewModel.lstGroup.length-1].TotalCols.values);if(e>=0&&(-1!=this.colAmountIndex||-1!=this.colBalanceIndex)){let t,s,o=-1!=this.colAmountIndex?this.colAmountIndex:this.colBalanceIndex;if(-1!=this.colAmountIndex)t=this.ViewModel.totals[this.colAmountIndex][this.lstGroup.length]-this.tempTotals[this.colAmountIndex];else{let e=this.ViewModel.HiddenNumericColumns.indexOf(this.ViewModel.HiddenNumericColumns.find(e=>"Amount"==e.ID));t=this.ViewModel.hiddenTotals[e][this.lstGroup.length]-this.tempHiddenTotals[e]}s=t,s+=-1!=this.colAdjustedIndex?this.ViewModel.totals[this.colAdjustedIndex][this.lstGroup.length]-this.tempTotals[this.colAdjustedIndex]:this.ViewModel.hiddenTotals[this.colHiddenAdjustedIndex][this.lstGroup.length]-this.tempHiddenTotals[this.colHiddenAdjustedIndex],this.GrdRow++,this.row=this.NewReportRow(),this.row.Height+=2,this.row.Type=r.f.GrossTotal,this.row.LevelNo=this.ViewModel.lstGroup.length,this.row.Cells[0].IsNormal=!1,this.row.Cells[0].CellAppearance=this.GrossTotalAppearance,this.row.Cells[0].Text="PostDated Cheques",this.row.Cells[0].ColSpan=e,this.row.Cells[o].IsNormal=!1,this.row.Cells[o].CellAppearance=this.GrossTotalAppearance_Data,this.ViewModel.SetCellValue(t,this.ViewModel.ReportColumns[o].DataFormat,"FLOAT",this.row.Cells[o]),this.ViewModel.addRow(this.row),this.GrdRow++,this.row=this.NewReportRow(),this.row.Height+=2,this.row.Type=r.f.GrossTotal,this.row.LevelNo=this.ViewModel.lstGroup.length,this.row.Cells[0].IsNormal=!1,this.row.Cells[0].CellAppearance=this.GrossTotalAppearance,this.row.Cells[0].Text="Total PostDated New Reference",this.row.Cells[0].ColSpan=e,this.row.Cells[o].IsNormal=!1,this.row.Cells[o].CellAppearance=this.GrossTotalAppearance_Data,this.ViewModel.SetCellValue(s,this.ViewModel.ReportColumns[o].DataFormat,"FLOAT",this.row.Cells[o]),this.ViewModel.addRow(this.row);let i=this.ViewModel.HiddenNumericColumns.indexOf(this.ViewModel.HiddenNumericColumns.find(e=>"Balance"==e.ID)),l=-1!=this.colBalanceIndex?this.ViewModel.totals[this.colBalanceIndex][this.lstGroup.length]:this.ViewModel.hiddenTotals[i][this.lstGroup.length];this.GrdRow++,this.row=this.NewReportRow(),this.row.Height+=2,this.row.Type=r.f.GrossTotal,this.row.LevelNo=this.ViewModel.lstGroup.length,this.row.Cells[0].IsNormal=!1,this.row.Cells[0].CellAppearance=this.GrossTotalAppearance,this.row.Cells[0].Text="Ouststanding Balance",this.row.Cells[0].ColSpan=e,this.row.Cells[o].IsNormal=!1,this.row.Cells[o].CellAppearance=this.GrossTotalAppearance_Data,this.ViewModel.SetCellValue(l,this.ViewModel.ReportColumns[o].DataFormat,"FLOAT",this.row.Cells[o]),this.ViewModel.addRow(this.row),l=-1!=this.colBalanceIndex?this.tempTotals[this.colBalanceIndex]:this.tempHiddenTotals[i],this.GrdRow++,this.row=this.NewReportRow(),this.row.Height+=2,this.row.Type=r.f.GrossTotal,this.row.LevelNo=this.ViewModel.lstGroup.length,this.row.Cells[0].IsNormal=!1,this.row.Cells[0].CellAppearance=this.GrossTotalAppearance,this.row.Cells[0].Text="Total Ouststanding Balance",this.row.Cells[0].ColSpan=e,this.row.Cells[o].IsNormal=!1,this.row.Cells[o].CellAppearance=this.GrossTotalAppearance_Data,this.ViewModel.SetCellValue(l-t+s,this.ViewModel.ReportColumns[o].DataFormat,"FLOAT",this.row.Cells[o]),this.ViewModel.addRow(this.row)}}this.FIFO||"Receivables"!=this.ViewModel.Preferences.IncludeBills&&"Payables"!=this.ViewModel.Preferences.IncludeBills||this.AddUnadjustedReceivablesPayables(e)}AddSubTotal(e,t,s=!1){if(this.HideSectionSubTotal)return;let i=Math.min.apply(null,this.ViewModel.lstGroup[this.ViewModel.lstGroup.length-1].TotalCols.values);if(i>=0){this.GrdRow++,this.row=this.NewReportRow_2(r.f.SubTotal,this.ViewModel.lstGroup[0].SubTotalAppearance),this.row.LevelNo=this.ViewModel.lstGroup.length;for(let e=0;e<this.oColumns.length;e++)this.ViewModel.lstGroup[0].TotalCols.ContainsKey(this.oColumns[e].ID)&&(t?this.HidePDCAdjustments&&this.PDCSeperate&&(e==this.colAdjustedIndex||e==this.colBalanceIndex)||this.ViewModel.SetCellValue(this.ViewModel.totals[e][this.lstGroup.length]-this.tempTotals[e],this.oColumns[e].DataFormat,"FLOAT",this.row.Cells[e]):s&&null!=this.tempTotals?e!=this.colAdjustedIndex&&e!=this.colBalanceIndex&&this.ViewModel.SetCellValue(this.ViewModel.totals[e][this.lstGroup.length]-this.tempTotals[e],this.oColumns[e].DataFormat,"FLOAT",this.row.Cells[e]):this.ViewModel.SetCellValue(this.ViewModel.totals[e][this.lstGroup.length],this.oColumns[e].DataFormat,"FLOAT",this.row.Cells[e]),this.row.Cells[e].CellAppearance.Alignment="Right");let l=this.row.Cells[0];l.Text=e.length>0?o.a.GetResource("Reports_SubTotal")+" ("+e+")":o.a.GetResource("Reports_SubTotal"),l.ColSpan=i,this.ViewModel.addRow(this.row)}}AddUnadjustedReceivablesPayables(e){if(this.ViewModel.Data.length>0&&this.ViewModel.Data[this.ViewModel.Data.length-1].Type==r.f.Detail&&this.iMainRow>0&&this.lstRecPayUnadjusted.ContainsKey(parseInt(this.dv[this.iMainRow-1].AccountID))){let e=this.lstRecPayUnadjusted[parseInt(this.dv[this.iMainRow-1].AccountID)];this.row=this.NewReportRow_2(r.f.BalanceBF,this.BalanceBFAppearance_Data),this.row.LevelNo=this.ViewModel.lstGroup.length,this.row.Cells[0].Text="Receivables"==this.ViewModel.Preferences.IncludeBills?"Un Adjusted Payable Amount":"Un Adjusted Receivable Amount",this.row.Cells[0].CellAppearance.Alignment="Left";let t=1;-1!=this.colAmountIndex?(t=this.colAmountIndex,this.ViewModel.totals[this.colAmountIndex][this.lstGroup.length]+=e):-1!=this.colBalanceIndex&&(t=this.colBalanceIndex),-1!=this.colBalanceIndex&&(this.ViewModel.totals[this.colBalanceIndex][this.lstGroup.length]+=e,this.ViewModel.SetCellValue(e,this.oColumns[t].DataFormat,this.oColumns[this.colBalanceIndex].ColumnType,this.row.Cells[this.colBalanceIndex])),-1!=this.colBalanceCumIndex&&(this.dblBalanceCum+=e,this.ViewModel.totals[this.colBalanceCumIndex][this.lstGroup.length]=this.dblBalanceCum,this.ViewModel.SetCellValue(this.dblBalanceCum,this.oColumns[t].DataFormat,this.oColumns[this.colBalanceCumIndex].ColumnType,this.row.Cells[this.colBalanceCumIndex])),this.row.Cells[0].ColSpan=t,this.ViewModel.SetCellValue(this.lstRecPayUnadjusted[parseInt(this.dv[this.iMainRow-1].AccountID)],this.oColumns[t].DataFormat,this.oColumns[t].ColumnType,this.row.Cells[t]),this.ViewModel.addRow(this.row)}}AddReportTotal(){this.row=this.NewReportRow_2(r.f.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance),this.ViewModel.GrpReportTotal.Height>0&&(this.row.Height=this.ViewModel.GrpReportTotal.Height),this.row.LevelNo=1;let e=-1;for(this.k=0;this.k<this.oColumns.length;this.k++)this.ViewModel.GrpReportTotal.TotalCols.ContainsKey(this.oColumns[this.k].ID)&&(-1==e&&(e=this.k),this.ViewModel.SetCellValue(this.AggTotal[this.k][0],this.oColumns[this.k].DataFormat,"FLOAT",this.row.Cells[this.k]));this.row.Cells[0].Text=o.a.GetResource("Reports_ReportTotal"),e>0&&(this.row.Cells[0].ColSpan=e,this.ViewModel.addRow(this.row))}addBillWiseAgeing(){let e,t;if(!this.dsMain.Columns[0].Contains("Balance")){if(this.dsMain.Columns[0].push("Balance"),this.dsMain.Columns[0].push("NetBalance"),-1==this.colUnDueIndex||this.dsMain.Columns[0].Contains("UnDueAmount")||this.dsMain.Columns[0].push("UnDueAmount"),-1!=this.colBalanceCumIndex&&this.dsMain.Columns[0].push(this.oColumns[this.colBalanceCumIndex].ID+"CUMULATIVE"),-1!=this.colSlabIndex){for(let e=1;e<=this.SlabSize;e++)this.dsMain.Columns[0].push("Slab"+e);this.dsMain.Columns[0].push("Slab")}this.Slabs_MMMYY.forEach(e=>{this.dsMain.Columns[0].push(e)})}for(this.IsPaymentTermWise&&(this.dvPaymentTerms=this.dvPaymentTermsTable=this.dsMain.Tables[1],this.dvPaymentTerms.SortBy(["DueDate"])),this.arrSlabAmounts=new Array(this.Slabs.length+1).fill(0),this.dblBalanceCum=0,this.iMainRow=0;this.iMainRow<this.dv.length;this.iMainRow++){if(this.ViewModel.process.CancellationPending)return void(this.ViewModel.processArgs.Cancel=!0);if(this.drMainRow=this.dv[this.iMainRow],this.ViewModel.AddGroupRows(this.dv,this.iMainRow),this.GroupRowsCount>0){let e=this.ViewModel.Data.length-this.GroupRowsCount;if(e<this.ViewModel.Data.length&&this.ViewModel.Data[e].Type==r.f.Group&&(this.ViewModel.Data[e].NodeID=parseInt(this.drMainRow[this.ViewModel.ReportGroups[0].ID+"_ID"]),0!=this.ViewModel.lstGroupIndex.length&&this.ViewModel.lstGroupIndex[this.ViewModel.lstGroupIndex.length-1]==e||this.ViewModel.lstGroupIndex.push(e)),this.BWAgeingShowOnlyDocs&&-1!=this.ViewModel.IsNewGroupIndex){t=this.dvTable.filter(2==this.lstGroup.length?e=>e[this.lstGroup[0].ID+"_ID"]==this.drMainRow[this.lstGroup[0].ID+"_ID"].toString()&&e[this.lstGroup[1].ID+"_ID"]==this.drMainRow[this.lstGroup[1].ID+"_ID"].toString():e=>e[this.lstGroup[0].ID+"_ID"]==this.drMainRow[this.lstGroup[0].ID+"_ID"].toString());let e=null;for(let o=0;o<t.length;o++)Object(l.j)(t[o].IsInventory)&&null==e&&parseFloat(t[o].AdjAmount)>0&&(e=t[o]);let s=0;for(let o=t.length-1;o>=0;o--)Object(l.j)(t[o].IsInventory)||parseFloat(t[o].AdjAmount)>0&&null!=e&&(s=parseFloat(t[o].AdjAmount)-parseFloat(t[o].Paid),null!=e&&s<=Math.abs(parseFloat(e.Paid))&&(e.Paid=parseFloat(e.Paid)+s,this.dvTable.Remove(t[o])));this.drMainRow=this.dv[this.iMainRow]}}if(0==this.ViewModel.IsNewGroupIndex&&(this.dblBalanceCum=0),this.oRow=this.NewReportRow(),this.oRow.LevelNo=this.ViewModel.lstGroup.length,2==this.ViewModel.ReportGroups.length&&2==this.ViewModel.ReportGroups[1].CDGDO.ColumnCostCenterID&&(this.oRow.NodeID=parseInt(this.drMainRow[this.ViewModel.ReportGroups[1].ID+"_ID"])),this.oRow.DataRow=this.drMainRow,this.dblAmount=parseFloat(this.drMainRow.AdjAmount),this.dblPaidTotal=parseFloat(this.drMainRow.Paid),this.dtDocDate=new Date(this.drMainRow.DocDate.toString()),this.dblBalance=this.dblAmount+this.dblPaidTotal,this.dblPaidTotal=Math.abs(this.dblPaidTotal),this.drMainRow.Balance=this.dblBalance,!(Math.abs(this.dblBalance)<.099)){if(this.PDCInclude?(this.drMainRow.NetBalance=this.drMainRow.Balance,-1!=this.colPDCIndex&&this.arrPDCStatus.Contains(parseInt(this.drMainRow.Status))&&(this.drMainRow.TotalPDC=this.drMainRow.Balance)):-1!=this.colPDCIndex?(this.dbl1=i.e.Double(this.drMainRow.TotalPDC),this.drMainRow.NetBalance=Math.abs(this.dblBalance)-this.dbl1):this.drMainRow.NetBalance=this.dblBalance,this.ShowMonthWise&&this.Slabs_MMMYY.forEach(e=>{this.arrMonthSlabAmounts[e]=0}),this.IsPaymentTermWise)if(this.dvPaymentTerms=this.dvPaymentTermsTable.filter(e=>e.VoucherNo==this.drMainRow.VoucherNo.toString()),this.dvPaymentTerms.length>0){for(let e=0;e<this.arrSlabAmounts.length;e++)this.arrSlabAmounts[e]=0;if(this.dvPaymentTerms.forEach(t=>{if(this.dbl1=parseFloat(t.Amount),this.dtDocDate=new Date(t.DueDate),this.dbl1=this.dbl1-this.dblPaidTotal,this.dbl1<0)this.dblPaidTotal=-this.dbl1;else if(this.dbl1>0){if(this.dblPaidTotal=0,-1!=this.colSlabIndex){for(this.i=0;this.i<this.Slabs.length&&!(this.dtDocDate>this.Slabs[this.i]);this.i++);this.arrSlabAmounts[this.i]+=this.dbl1}this.ShowMonthWise&&(e=this.dtDocDate.ToString("MMMyy"),this.arrMonthSlabAmounts.ContainsKey(e)?this.arrMonthSlabAmounts[e]+=this.dbl1:this.arrMonthSlabAmounts.MonthSlab+=this.dbl1)}else this.dblPaidTotal=0}),-1!=this.colSlabIndex)for(let e=0;e<this.arrSlabAmounts.length;e++)this.arrSlabAmounts[e]>0&&(this.dblAmount<0&&(this.arrSlabAmounts[e]=-this.arrSlabAmounts[e]),e==this.SlabSize?this.drMainRow.Slab=this.arrSlabAmounts[e]:this.drMainRow["Slab"+(e+1)]=this.arrSlabAmounts[e])}else{if(-1!=this.colSlabIndex){for(this.i=0;this.i<this.Slabs.length&&!(this.dtDocDate>this.Slabs[this.i]);this.i++);this.i==this.SlabSize?this.drMainRow.Slab=this.dblBalance:this.drMainRow["Slab"+(this.i+1)]=this.dblBalance}this.ShowMonthWise&&(e=this.dtDocDate.ToString("MMMyy"),this.arrMonthSlabAmounts.ContainsKey(e)?this.arrMonthSlabAmounts[e]+=this.dblBalance:this.arrMonthSlabAmounts.MonthSlab+=this.dblBalance)}else{if(-1!=this.colUnDueIndex&&this.dtDocDate>this.ViewModel.ToDatePicker.Date)this.drMainRow.UnDueAmount=this.dblBalance;else if(-1!=this.colSlabIndex){for(this.i=0;this.i<this.Slabs.length&&!(this.dtDocDate>this.Slabs[this.i]);this.i++);this.i==this.SlabSize?this.drMainRow.Slab=this.dblBalance:this.drMainRow["Slab"+(this.i+1)]=this.dblBalance}this.ShowMonthWise&&(e=this.dtDocDate.ToString("MMMyy"),this.arrMonthSlabAmounts.ContainsKey(e)?this.arrMonthSlabAmounts[e]+=this.dblBalance:this.arrMonthSlabAmounts.MonthSlab+=this.dblBalance)}if(this.ShowMonthWise&&this.Slabs_MMMYY.forEach(e=>{this.drMainRow[e]=this.arrMonthSlabAmounts[e]}),this.IgnoreRow=!1,this.ViewModel.FormulaColumns.length>0){for(let e=0;e<this.ViewModel.FormulaColumns.length;e++)if(this.ViewModel.CalculateFormula_2(this.ViewModel.FormulaColumns[e],this.drMainRow)){this.IgnoreRow=!0;break}if(this.IgnoreRow)continue}for(let e=0;e<this.oColumns.length;e++)this.CellValue=null,Object(u.isNullOrUndefined)(this.drMainRow[this.oColumns[e].ID])||(this.CellValue=this.drMainRow[this.oColumns[e].ID]),null!=this.CellValue&&(this.ViewModel.SetCellValue(this.CellValue,this.oColumns[e].DataFormat,this.oColumns[e].ColumnType,this.oRow.Cells[e]),this.ViewModel.TotalCols.Contains(this.oColumns[e].ID)&&i.e.IsNum(this.CellValue)&&(this.ViewModel.totals[e][this.lstGroup.length]+=i.e.Double(this.CellValue)));-1!=this.colBalanceCumIndex&&(this.dblBalanceCum+=this.dblBalance,this.drMainRow[this.oColumns[this.colBalanceCumIndex].ID+"CUMULATIVE"]=this.dblBalance,this.ViewModel.totals[this.colBalanceCumIndex][this.lstGroup.length]=this.dblBalanceCum,this.ViewModel.SetCellValue(this.dblBalanceCum,this.oColumns[this.colBalanceCumIndex].DataFormat,"FLOAT",this.oRow.Cells[this.colBalanceCumIndex])),-1!=this.ViewModel.colSNoIndex&&(this.oRow.Cells[this.ViewModel.colSNoIndex].Value=++this.ViewModel.SNo,this.oRow.Cells[this.ViewModel.colSNoIndex].Text=this.ViewModel.SNo.toString()),this.ViewModel.ApplyKPI(this.oRow),this.ViewModel.addRow(this.oRow)}}this.ViewModel.CheckAndAddTotals(this.dsMain.Tables[0])}AddRow_AgeingAnalysis(){if(!this.dsMain.Columns[0].Contains("Balance")){if(this.dsMain.Columns[0].push("Balance"),this.dsMain.Columns[0].push("UnAdjusted"),this.dsMain.Columns[0].push("NetBalance"),-1==this.colUnDueIndex||this.dsMain.Columns[0].Contains("UnDueAmount")||this.dsMain.Columns[0].push("UnDueAmount"),-1!=this.colBillAmtIndex&&this.dsMain.Columns[0].push("BillAmount"),-1!=this.colPDCIndex&&(this.dsMain.Columns[0].Contains("TotalPDC")||this.dsMain.Columns[0].push("TotalPDC"),this.dsMain.Columns[0].push("BalanceInclPDC")),-1!=this.colSlabIndex){for(let e=1;e<=this.SlabSize;e++)this.dsMain.Columns[0].push("Slab"+e),this.dsMain.Columns[0].push("FSlab"+e);this.dsMain.Columns[0].push("Slab"),this.dsMain.Columns[0].push("FSlab")}this.Slabs_MMMYY.forEach(e=>{this.dsMain.Columns[0].push(e)})}for(this.IsPaymentTermWise&&(this.dvPaymentTerms=this.dvPaymentTerms=this.dsMain.Tables[2],this.dvPaymentTerms.SortBy(["DueDate"]),this.FutureSlabs&&this.dsMain.Tables.length>4&&(this.dvFPaymentTerms=this.dsMain.Tables[4],this.dvFPaymentTerms.SortBy(["DueDate"]))),this.iMainRow=0;this.iMainRow<this.dv.length;this.iMainRow++)if(this.drMainRow=this.dv[this.iMainRow],this.iMainRowAccountID=parseInt(this.drMainRow[this.dsMain.Columns[0][0]]),!this.ShowLevelTree||!Object(l.j)(this.drMainRow.IsGroup)){if(this.FIFO){this.drRows=this.dsMain.Tables[2].filter(e=>e.AccountID==this.iMainRowAccountID),this.dblReceivable=this.dblPayable=0;let e=this.dsMain.Tables[1].filter(e=>e.AccountID==this.iMainRowAccountID);if(e.length>0&&(this.dblReceivable=parseFloat(e[0].Amount),this.dblPayable=parseFloat(e[0].UnAdjustedAmount)),!this.AccountsWithZeroBalance&&parseFloat(Math.abs(this.dblReceivable+this.dblPayable).ToString("N"+o.a.SessionManager.Preferences.DecimalsinAmount))<this.cmpValue)continue;if(0==this.drRows.length)continue;this.dbl1=this.dblReceivable,this.dbl2=this.dblPayable}else{if(this.drRows=this.dsMain.Tables[1].filter(e=>e.AccountID==this.iMainRowAccountID),!this.AccountsWithOutTransactions&&0==this.drRows.length&&(-1==this.colUnDueIndex||null==this.drMainRow.ActualBill||Math.abs(parseFloat(this.drMainRow.ActualBill))<this.cmpValue)){if(!(-1!=this.colPDCIndex&&null==this.drMainRow.TotalPDC&&Math.abs(parseFloat(this.drMainRow.TotalPDC))>=this.cmpValue))continue;this.drMainRow.ActualBill=0}if(this.UpdateAmounts(),!this.AccountsWithZeroBalance&&parseFloat(Math.abs(this.dblReceivable+this.dblPayable).ToString("N "+o.a.SessionManager.Preferences.DecimalsinAmount))<this.cmpValue&&(this.drMainRow.Balance=0,-1==this.colUnDueIndex||null==this.drMainRow.ActualBill||Math.abs(this.dblAmount_ForUnDue-parseFloat(this.drMainRow.ActualBill))<this.cmpValue)){if(!(-1!=this.colPDCIndex&&null==this.drMainRow.TotalPDC&&Math.abs(parseFloat(this.drMainRow.TotalPDC))>=this.cmpValue))continue;this.drMainRow.ActualBill=0}if("Receivables"==this.ViewModel.Preferences.IncludeBills){if(this.dbl1=this.dblReceivable,this.dbl2=this.dblPayable,this.dblReceivable+this.dblPayable<0)continue}else if("Payables"==this.ViewModel.Preferences.IncludeBills){if(this.dbl1=this.dblPayable,this.dbl2=this.dblReceivable,this.dblReceivable+this.dblPayable>0)continue}else this.dbl1=this.dblReceivable+this.dblPayable,this.dbl2=0}this.drMainRow.Balance=this.dbl1,this.drMainRow.UnAdjusted=this.dbl2,this.drMainRow.NetBalance=this.dblReceivable+this.dblPayable,-1!=this.colUnDueIndex&&null!=this.drMainRow.ActualBill&&(this.drMainRow.UnDueAmount=parseFloat(this.drMainRow.ActualBill)-this.dblAmount_ForUnDue),-1!=this.colBillAmtIndex&&(this.drMainRow.BillAmount=this.dblBillAmount)}let e=this.dv.Copy();this.ShowDrCrSeperately&&(this.dv=e.filter(this.ShowLevelTree?e=>e.IsGroup=1:e=>e.Balance<0),this.row=this.NewReportRow_2(r.f.GrossTotal,this.GrossTotalAppearance),this.row.LevelNo=this.ViewModel.lstGroup.length,this.row.Cells[0].ColSpan=this.oColumns.length,this.row.Cells[0].Text=o.a.GetResource("Reports_Receipts"),this.ViewModel.addRow(this.row)),this.AddRow_AgeingAnalysisSection(),this.ShowDrCrSeperately&&(this.dv=e.filter(this.ShowLevelTree?e=>e.IsGroup=1:e=>e.Balance>0),this.row=this.NewReportRow_2(r.f.GrossTotal,this.GrossTotalAppearance),this.row.LevelNo=this.ViewModel.lstGroup.length,this.row.Cells[0].ColSpan=this.oColumns.length,this.row.Cells[0].Text=o.a.GetResource("Reports_Payments"),this.ViewModel.addRow(this.row),this.AddRow_AgeingAnalysisSection())}AddRow_AgeingAnalysisSection(){let e,t,s,a;if(this.lstTotal=new Array,this.lstTotal.push(new Array(this.oColumns.length).fill(0)),this.arrSlabAmounts=new Array(this.Slabs.length+1).fill(0),this.arrFSlabAmounts=new Array(this.Slabs.length+1).fill(0),this.ShowLevelTree&&this.dv.length>0)for(let o=0;o<parseInt(this.dv[0].Depth);o++)this.lstParents.push(this.NewReportRow()),this.lstTotal.push(new Array(this.oColumns.length).fill(0));for(this.iMainRow=0;this.iMainRow<this.dv.length;this.iMainRow++){if(this.ViewModel.process.CancellationPending)return void(this.ViewModel.processArgs.Cancel=!0);if(this.IgnoreRow=!1,this.drMainRow=this.dv[this.iMainRow],this.iMainRowAccountID=parseInt(this.drMainRow[this.dsMain.Columns[0][0]]),this.oRow=this.NewReportRow(),this.oRow.Cells[0].Text=this.drMainRow[this.dsMain.Columns[0][1]].toString(),this.oRow.DataRow=this.drMainRow,this.oRow.NodeID=this.iMainRowAccountID,this.ShowLevelTree&&(this.oRow.LevelNo=parseInt(this.drMainRow.Depth)-1,this.UpdateTreeTotals(this.oRow.LevelNo),Object(l.j)(this.drMainRow.IsGroup)&&(this.oRow.Type=r.f.BalanceBF,this.oRow.IsGroup=!0),this.oRow.Cells[0].IsNormal=!1,this.oRow.Cells[0].level=this.oRow.LevelNo,Object(l.j)(this.drMainRow.IsGroup))){if(this.oRow.LevelNo>this.LevelNo)continue;this.lstParents.push(this.oRow),this.lstTotal.push(new Array(this.oColumns.length).fill(0)),this.oRow.Type=r.f.BalanceBF;for(let e=0;e<this.oRow.Cells.length;e++)this.oRow.Cells[e].IsNormal=!1,this.oRow.Cells[e].CellAppearance=this.BalanceBFAppearance_Data;this.oRow.Cells[0].CellAppearance=this.BalanceBFAppearance}if(!this.ShowLevelTree||!Object(l.j)(this.drMainRow.IsGroup)){if(this.FIFO){this.drRows=this.dsMain.Tables[2].filter(e=>e.AccountID==this.iMainRowAccountID),this.FutureSlabs&&this.dsMain.Tables.length>3&&(this.drFRows=this.dsMain.Tables[3].filter(e=>e.AccountID==this.iMainRowAccountID)),this.dblReceivable=this.dblPayable=0;let e=this.dsMain.Tables[1].filter(e=>e.AccountID==this.iMainRowAccountID);if(e.length>0&&(this.dblReceivable=parseFloat(e[0].Amount),this.dblPayable=parseFloat(e[0].UnAdjustedAmount)),!this.AccountsWithZeroBalance&&parseFloat(Math.abs(this.dblReceivable+this.dblPayable).ToString("N"+o.a.SessionManager.Preferences.DecimalsinAmount))<this.cmpValue)continue;if(0==this.drRows.length)continue;this.dbl1=this.dblReceivable,this.dbl2=this.dblPayable}else{if(this.drRows=this.dsMain.Tables[1].filter(e=>e.AccountID==this.iMainRowAccountID),this.FutureSlabs&&(this.dsMain.Tables.Count>2&&!this.IsPaymentTermWise?this.drFRows=this.dsMain.Tables[2].filter(e=>e.AccountID==this.iMainRowAccountID):this.dsMain.Tables.Count>3&&(this.drFRows=this.dsMain.Tables[3].filter(e=>e.AccountID==this.iMainRowAccountID))),!this.AccountsWithOutTransactions&&0==this.drRows.length&&(-1==this.colUnDueIndex||null==this.drMainRow.UnDueAmount||Math.abs(parseFloat(this.drMainRow.UnDueAmount))<this.cmpValue)&&(-1==this.colPDCIndex||null==this.drMainRow.TotalPDC||Math.abs(parseFloat(this.drMainRow.TotalPDC))<this.cmpValue))continue;if(this.UpdateAmounts(),!this.AccountsWithZeroBalance&&parseFloat(Math.abs(this.dblReceivable+this.dblPayable).ToString("N"+o.a.SessionManager.Preferences.DecimalsinAmount))<this.cmpValue&&(-1==this.colUnDueIndex||null==this.drMainRow.UnDueAmount||Math.abs(parseFloat(this.drMainRow.UnDueAmount))<this.cmpValue)&&(-1==this.colPDCIndex||null==this.drMainRow.TotalPDC||Math.abs(parseFloat(this.drMainRow.TotalPDC))<this.cmpValue))continue;if("Receivables"==this.ViewModel.Preferences.IncludeBills){if(this.dbl1=this.dblReceivable,this.dbl2=this.dblPayable,this.dblReceivable+this.dblPayable<0)continue}else if("Payables"==this.ViewModel.Preferences.IncludeBills){if(this.dbl1=this.dblPayable,this.dbl2=this.dblReceivable,this.dblReceivable+this.dblPayable>0)continue}else this.dbl1=this.dblReceivable+this.dblPayable,this.dbl2=0}for(this.drMainRow.Balance=this.dbl1,this.drMainRow.UnAdjusted=this.dbl2,this.drMainRow.NetBalance=this.dblReceivable+this.dblPayable,this.k=0;this.k<=this.Slabs.length;this.k++)this.arrSlabAmounts[this.k]=0,this.arrFSlabAmounts[this.k]=0;this.Slabs_MMMYY.forEach(e=>{this.arrMonthSlabAmounts[e]=0}),s=-1!=this.colPDCIndex&&null!=this.drMainRow.TotalPDC?parseFloat(this.drMainRow.TotalPDC):0;for(let o=0;o<this.drRows.length;o++){let i=this.drRows[o];if(this.IsCQDate=!1,a=new Date(i.DocDate),this.AgeingBasedOnMaturityDate&&this.PDCInclude&&null!=i.CqMaturityDate&&this.arrPDCStatus.Contains(parseInt(i.Status))&&(this.ViewModel.Preferences.ContainsKey("PDCSlabBasedOnMatDate")&&"1"==this.ViewModel.Preferences.PDCSlabBasedOnMatDate&&(this.IsCQDate=!0),a=new Date(i.CqMaturityDate)),this.dblAmount=parseFloat(i.AdjAmount),"Receivables"==this.ViewModel.Preferences.IncludeBills){if(this.dblAmount<0)continue}else if("Payables"==this.ViewModel.Preferences.IncludeBills&&this.dblAmount>0)continue;if(this.IsPaymentTermWise)if(this.dvPaymentTerms=this.dvPaymentTermsTable.filter(e=>e.VoucherNo==i.DocNo.toString()),this.dvPaymentTerms.length>0){this.dblPaidTotal=Math.abs(parseFloat(i.Paid));for(let t=0;t<this.dvPaymentTerms.length;t++){let s=this.dvPaymentTerms[t];if(this.dbl2=parseFloat(s.Amount),a=new Date(s.DueDate),this.dbl2=this.dbl2-this.dblPaidTotal,this.dbl2<0)this.dblPaidTotal=-this.dbl2;else if(this.dbl2>0){if(this.dblPaidTotal=0,this.dblAmount<0&&(this.dbl2=-this.dbl2),-1!=this.colSlabIndex){for(this.i=0;this.i<this.Slabs.length&&!(a>this.Slabs[this.i]);this.i++);this.arrSlabAmounts[this.i]=this.arrSlabAmounts[this.i]+this.dbl2}this.ShowMonthWise&&(e=a.ToString("MMMyy"),this.arrMonthSlabAmounts.ContainsKey(e)?this.arrMonthSlabAmounts[e]+=this.dbl2:this.arrMonthSlabAmounts.MonthSlab+=this.dbl2)}else this.dblPaidTotal=0}}else{if(-1!=this.colSlabIndex){for(t=0;t<this.Slabs.length&&!(a>this.Slabs[t]);t++);this.arrSlabAmounts[t]+=this.dblAmount}this.ShowMonthWise&&(e=a.ToString("MMMyy"),this.arrMonthSlabAmounts.ContainsKey(e)?this.arrMonthSlabAmounts[e]+=this.dblAmount:this.arrMonthSlabAmounts.MonthSlab+=this.dblAmount)}else{if(-1!=this.colSlabIndex){if(this.IsCQDate)for(t=0;t<this.cqSlabs.length&&!(a<this.cqSlabs[t]);t++);else for(t=0;t<this.Slabs.length&&!(a>this.Slabs[t]);t++);this.arrSlabAmounts[t]+=this.dblAmount}this.ShowMonthWise&&(e=a.ToString("MMMyy"),this.arrMonthSlabAmounts.ContainsKey(e)?this.arrMonthSlabAmounts[e]+=this.dblAmount:this.arrMonthSlabAmounts.MonthSlab+=this.dblAmount)}-1!=this.colPDCIndex&&(s+=parseFloat(i.TotalPDC),this.PDCInclude&&this.arrPDCStatus.Contains(parseInt(i.Status))&&(s+=this.dblAmount))}if(null!=this.drFRows&&this.drFRows.forEach(e=>{if(a=new Date(e.DocDate),this.dblAmount=parseFloat(e.AdjAmount),"Receivables"==this.ViewModel.Preferences.IncludeBills){if(this.dblAmount<0)return}else if("Payables"==this.ViewModel.Preferences.IncludeBills&&this.dblAmount>0)return;if(this.IsPaymentTermWise){let s=this.dvFPaymentTerms.filter(t=>t.VoucherNo==e.DocNo.toString());if(s.length>0)this.dblPaidTotal=Math.abs(parseFloat(e.Paid)),s.forEach(e=>{if(this.dbl2=parseFloat(e.Amount),a=new Date(e.DueDate),this.dbl2=this.dbl2-this.dblPaidTotal,this.dbl2<0)this.dblPaidTotal=-this.dbl2;else if(this.dbl2>0){if(this.dblPaidTotal=0,this.dblAmount<0&&(this.dbl2=-this.dbl2),-1!=this.colSlabIndex){for(this.i=0;this.i<this.FSlabs.length&&!(a<this.FSlabs[this.i]);this.i++);this.arrFSlabAmounts[this.i]=this.arrFSlabAmounts[this.i]+this.dbl2}}else this.dblPaidTotal=0});else if(-1!=this.colSlabIndex){for(t=0;t<this.FSlabs.length&&!(a<this.FSlabs[t]);t++);this.arrFSlabAmounts[t]+=this.dblAmount}}else if(-1!=this.colSlabIndex){for(t=0;t<this.FSlabs.length&&!(a<this.FSlabs[t]);t++);this.arrFSlabAmounts[t]+=this.dblAmount}}),-1!=this.colPDCIndex&&(this.drMainRow.TotalPDC=s,this.drMainRow.BalanceInclPDC=this.PDCInclude?parseFloat(this.drMainRow.Balance):parseFloat(this.drMainRow.Balance)+s),this.ViewModel.FormulaColumns.length>0){for(let e=0;e<this.ViewModel.FormulaColumns.length;e++)if(this.ViewModel.CalculateFormula_2(this.ViewModel.FormulaColumns[e],this.drMainRow)){this.IgnoreRow=!0;break}if(this.IgnoreRow)continue}if(-1!=this.colSlabIndex)for(this.k=0;this.k<=this.Slabs.length;this.k++)this.k==this.SlabSize?(this.drMainRow.Slab=this.arrSlabAmounts[this.k],this.drMainRow.FSlab=this.arrFSlabAmounts[this.k]):(this.drMainRow["Slab"+(this.k+1)]=this.arrSlabAmounts[this.k],this.drMainRow["FSlab"+(this.k+1)]=this.arrFSlabAmounts[this.k]);this.ShowMonthWise&&this.Slabs_MMMYY.forEach(e=>{this.drMainRow[e]=this.arrMonthSlabAmounts[e]});for(let e=0;e<this.oColumns.length;e++)this.CellValue=null,Object(u.isNullOrUndefined)(this.drMainRow[this.oColumns[e].ID])||(this.CellValue=this.drMainRow[this.oColumns[e].ID]),null!=this.CellValue&&(this.ViewModel.SetCellValue(this.CellValue,this.oColumns[e].DataFormat,this.oColumns[e].ColumnType,this.oRow.Cells[e]),this.ViewModel.TotalCols.Contains(this.oColumns[e].ID)&&i.e.IsNum(this.CellValue)&&(this.lstTotal[this.lstTotal.length-1][e]+=i.e.Double(this.CellValue)))}this.oRow.LevelNo<=this.LevelNo&&(this.oRow.IsGroup||(-1!=this.ViewModel.colSNoIndex&&(this.oRow.Cells[this.ViewModel.colSNoIndex].Value=++this.ViewModel.SNo,this.oRow.Cells[this.ViewModel.colSNoIndex].Text=this.ViewModel.SNo.toString()),this.ViewModel.ApplyKPI(this.oRow)),1==this.lstGroup.length&&this.ViewModel.AddGroupRows(this.dv,this.iMainRow),this.ViewModel.addRow(this.oRow))}this.ShowLevelTree&&this.UpdateTreeTotals(0),1==this.lstGroup.length&&null!=this.ViewModel.ParentReport?this.ViewModel.CheckAndAddTotals(this.dv):this.AddReportTotal_AgeingAnalysis()}AddRow_AgeingAnalysisWithGroups(){let e,t,s;if(this.lstTotal=new Array,this.lstTotal.push(new Array(this.oColumns.length).fill(0)),this.ViewModel.ReportData=this.dsMain.Tables[0],this.ViewModel.ReportDataColumns=this.dsMain.Columns[0],!this.dsMain.Columns[0].Contains("Balance")){if(!this.AccountsWithZeroBalance)for(let e=this.dsMain.Tables[0].length-1;e>=0;e--)0==parseFloat(this.dsMain.Tables[0][e].AdjAmount)&&this.dsMain.Tables[0].RemoveAt(e);if(-1!=this.colSlabIndex){for(let e=1;e<=this.SlabSize;e++)this.dsMain.Columns[0].push("Slab"+e),this.dsMain.Columns[0].push("FSlab"+e);this.dsMain.Columns[0].push("Slab"),this.dsMain.Columns[0].push("FSlab")}this.dsMain.Columns[0].push("Balance"),this.dsMain.Columns[0].push("UnAdjusted"),this.dsMain.Columns[0].push("NetBalance"),-1!=this.colPDCIndex&&this.dsMain.Columns[0].push("BalanceInclPDC"),this.Slabs_MMMYY.forEach(e=>{this.dsMain.Columns[0].push(e)})}for(this.IsPaymentTermWise&&(this.dvPaymentTerms=this.dvPaymentTermsTable=this.dsMain.Tables[1],this.dvPaymentTerms.SortBy(["DueDate"])),this.k=0;this.k<this.dv.length;this.k++){if(this.ViewModel.process.CancellationPending)return void(this.ViewModel.processArgs.Cancel=!0);if(this.IgnoreRow=!1,this.ViewModel.AddGroupRows(this.dv,this.k),this.dblAmount=parseFloat(this.dv[this.k].AdjAmount),0!=this.dblAmount){if(this.dblPayable=this.dblReceivable=0,this.dblAmount<0?this.dblPayable=this.dblAmount:this.dblReceivable=this.dblAmount,this.dv[this.k].NetBalance=this.dblAmount,"Receivables"==this.ViewModel.Preferences.IncludeBills?(this.dv[this.k].Balance=this.dblReceivable,this.dv[this.k].UnAdjusted=this.dblPayable):"Payables"==this.ViewModel.Preferences.IncludeBills?(this.dv[this.k].Balance=this.dblPayable,this.dv[this.k].UnAdjusted=this.dblReceivable):(this.dv[this.k].Balance=this.dblAmount,this.dv[this.k].UnAdjusted=0),s=new Date(this.dv[this.k].DocDate),"Receivables"==this.ViewModel.Preferences.IncludeBills&&this.dblAmount<0||"Payables"==this.ViewModel.Preferences.IncludeBills&&this.dblAmount>0);else if(this.IsPaymentTermWise)if(this.dvPaymentTerms=this.dvPaymentTerms.filter(e=>e.VoucherNo==this.dv[this.k].DocNo.toString()),this.dvPaymentTerms.length>0){this.dblPaidTotal=Math.abs(parseFloat(this.dv[this.k].Paid));for(let o=0;o<this.dvPaymentTerms.length;o++){let l=this.dvPaymentTerms[o];if(this.dbl2=parseFloat(l.Amount),s=new Date(l.DueDate),this.dbl2=this.dbl2-this.dblPaidTotal,this.dbl2<0)this.dblPaidTotal=-this.dbl2;else if(this.dbl2>0){if(this.dblPaidTotal=0,parseFloat(this.dv[this.k].Amount)<0&&(this.dbl2=-this.dbl2),-1!=this.colSlabIndex){for(e=0;e<this.Slabs.length;e++)if(s>this.Slabs[e]){this.dbl1=i.e.Double(this.dv[this.k]["Slab"+(e+1)]),this.dv[this.k]["Slab"+(e+1)]=this.dbl1+this.dbl2;break}e==this.Slabs.length&&(this.dbl1=i.e.Double(this.dv[this.k].Slab),this.dv[this.k].Slab=this.dbl1+this.dbl2)}this.ShowMonthWise&&(t=s.ToString("MMMyy"),this.Slabs_MMMYY.Contains(t)?(this.dbl1=i.e.Double(this.dv[this.k][t]),this.dv[this.k][t]=this.dbl1+this.dbl2):(this.dbl1=i.e.Double(this.dv[this.k].MonthSlab),this.dv[this.k].MonthSlab=this.dbl1+this.dbl2))}else this.dblPaidTotal=0}}else{if(-1!=this.colSlabIndex){for(e=0;e<this.Slabs.length;e++)if(s>this.Slabs[e]){this.dv[this.k]["Slab"+(e+1)]=this.dblAmount;break}e==this.Slabs.length&&(this.dv[this.k].Slab=this.dblAmount)}this.ShowMonthWise&&(this.Slabs_MMMYY.Contains(s.ToString("MMMyy"))?this.dv[this.k][s.ToString("MMMyy")]=this.dblAmount:this.dv[this.k].MonthSlab=this.dblAmount)}else{if(-1!=this.colSlabIndex){for(e=0;e<this.Slabs.length;e++)if(s>this.Slabs[e]){this.dv[this.k]["Slab"+(e+1)]=this.dblAmount;break}e==this.Slabs.length&&(this.dv[this.k].Slab=this.dblAmount)}this.ShowMonthWise&&(this.Slabs_MMMYY.Contains(s.ToString("MMMyy"))?this.dv[this.k][s.ToString("MMMyy")]=this.dblAmount:this.dv[this.k].MonthSlab=this.dblAmount)}if(-1!=this.colPDCIndex&&(this.PDCInclude?(this.dv[this.k].BalanceInclPDC=this.dv[this.k].Balance,this.arrPDCStatus.Contains(parseInt(this.dv[this.k].Status))&&(this.dv[this.k].TotalPDC=this.dv[this.k].Balance)):this.dv[this.k].BalanceInclPDC=parseFloat(this.dv[this.k].Balance)+parseFloat(this.dv[this.k].TotalPDC)),this.GroupRowsCount>0){let e=this.ViewModel.Data.length-this.GroupRowsCount;e>=0&&this.ViewModel.Data[e].Type==r.f.Group&&(2==this.ViewModel.ReportGroups[0].CDGDO.ColumnCostCenterID&&(this.ViewModel.Data[e].NodeID=parseInt(this.dv[this.k].AccountID)),this.ViewModel.lstGroupIndex.Contains(e)||this.ViewModel.lstGroupIndex.push(e))}if(this.ViewModel.FormulaColumns.length>0){for(let e=0;e<this.ViewModel.FormulaColumns.length;e++)if(this.ViewModel.CalculateFormula_2(this.ViewModel.FormulaColumns[e],this.dv[this.k])){this.IgnoreRow=!0;break}if(this.IgnoreRow)continue}this.oRow=this.NewReportRow(),this.oRow.LevelNo=this.ViewModel.lstGroup.length,2==this.ViewModel.ReportGroups[1].CDGDO.ColumnCostCenterID&&(this.oRow.NodeID=parseInt(this.dv[this.k].AccountID));for(let e=0;e<this.oColumns.length;e++)this.CellValue=null,Object(u.isNullOrUndefined)(this.dv[this.oColumns[e].ID])||(this.CellValue=this.dv[this.k][this.oColumns[e].ID]),null!=this.CellValue&&(this.ViewModel.SetCellValue(this.CellValue,this.oColumns[e].DataFormat,this.oColumns[e].ColumnType,this.oRow.Cells[e]),e==this.colTotalSaleIndex||e==this.colPrevYearSaleIndex?this.ViewModel.totals[e][this.lstGroup.length]=parseFloat(this.CellValue):this.ViewModel.TotalCols.Contains(this.oColumns[e].ID)&&i.e.IsNum(this.CellValue)&&(0!=this.oColumns[e].UseOnce?this.ViewModel.totals[e][this.lstGroup.length]=parseFloat(this.CellValue):this.ViewModel.totals[e][this.lstGroup.length]+=parseFloat(this.CellValue)));this.ViewModel.IsSummary||(-1!=this.ViewModel.colSNoIndex&&(this.oRow.Cells[this.ViewModel.colSNoIndex].Value=++this.ViewModel.SNo,this.oRow.Cells[this.ViewModel.colSNoIndex].Text=this.ViewModel.SNo.toString()),this.ViewModel.ApplyKPI(this.oRow),this.ViewModel.addRow(this.oRow))}}this.ViewModel.CheckAndAddTotals(this.dv)}UpdateTreeTotals(e){for(let t=this.lstTotal.length-1;t>e;t--){if(t>0)for(let e=0;e<this.lstTotal[t].length;e++)this.lstTotal[t-1][e]+=this.lstTotal[t][e];if(!this.GroupTotalsAtEnd)for(let e=0;e<this.oColumns.length;e++)"FLOAT"==this.oColumns[e].ColumnType&&e!=this.ViewModel.colSNoIndex&&this.ViewModel.SetCellValue(this.lstTotal[t][e],this.oColumns[e].DataFormat,"FLOAT",this.lstParents[t-1].Cells[e]);if(e<=this.LevelNo){if(this.lstParents.length>0){let e=this.ViewModel.Data.indexOf(this.lstParents[this.lstParents.length-1]);if(e>=0&&(this.ViewModel.Data.RemoveAt(e),(0!=this.lstTotal[t][1]||0!=this.lstTotal[t][3]||this.AccountsWithZeroBalance||-1!=this.colBalanceIndex&&0!=this.lstTotal[t][this.colBalanceIndex]||-1!=this.colNetBalanceIndex&&0!=this.lstTotal[t][this.colNetBalanceIndex])&&(this.ViewModel.Data.Insert(e,this.lstParents[this.lstParents.length-1]),this.GroupTotalsAtEnd))){let e=this.NewReportRow();e.Type=r.f.BalanceBF,e.Parent=this.lstParents[t-1].Parent,e.LevelNo=this.lstParents[t-1].LevelNo,e.Cells[0].IsNormal=!1,e.IsGroup=!0,e.Visible=this.lstParents[t-1].Visible,e.Cells[0].level=this.lstParents[t-1].LevelNo,e.Cells[0].Text=this.lstParents[t-1].Cells[0].Text+" - Total ",e.Cells[0].CellAppearance=this.GrossTotalAppearance_Data.Clone(),e.Cells[0].CellAppearance.Alignment=this.oColumns[0].DataAppearance.Alignment;for(let s=0;s<this.oColumns.length;s++)"FLOAT"==this.oColumns[s].ColumnType&&s!=this.ViewModel.colSNoIndex&&(e.Cells[s].IsNormal=!1,e.Cells[s].CellAppearance=this.GrossTotalAppearance_Data.Clone(),e.Cells[s].CellAppearance.Alignment=this.oColumns[s].DataAppearance.Alignment,this.ViewModel.SetCellValue(this.lstTotal[t][s],this.oColumns[s].DataFormat,"FLOAT",e.Cells[s]));this.ViewModel.addRow(e)}this.lstParents.RemoveAt(this.lstParents.length-1)}this.lstTotal.RemoveAt(this.lstTotal.length-1)}}}UpdateAmounts(){for(this.dblReceivable=0,this.dblPayable=0,this.dblAmount_ForUnDue=0,this.dblBillAmount=0,this.i=0;this.i<this.drRows.length;this.i++)this.dblAmount=parseFloat(this.drRows[this.i].AdjAmount),this.dblAmount<0?this.dblPayable+=this.dblAmount:this.dblReceivable+=this.dblAmount,-1!=this.colUnDueIndex&&parseFloat(Math.abs(this.dblAmount).ToString("N"+o.a.SessionManager.Preferences.DecimalsinAmount))>this.cmpValue&&(this.dblAmount_ForUnDue+=parseFloat(this.drRows[this.i].Amount)),-1!=this.colBillAmtIndex&&(this.dblBillAmount+=parseFloat(this.drRows[this.i].BillAmount))}AddReportTotal_AgeingAnalysis(){this.row=this.NewReportRow_2(r.f.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance_Data),this.row.LevelNo=0;let e=-1;for(this.k=0;this.k<this.oColumns.length;this.k++)(this.ViewModel.GrpReportTotal.TotalCols.ContainsKey(this.oColumns[this.k].ID)||this.oColumns[this.k].ID.startsWith("Slab")&&this.ViewModel.GrpReportTotal.TotalCols.ContainsKey("Slab"))&&(-1==e&&(e=this.k),this.ViewModel.SetCellValue(this.lstTotal[0][this.k],this.oColumns[this.k].DataFormat,"FLOAT",this.row.Cells[this.k]));e>=0&&(e>0&&(this.row.Cells[0].Text=o.a.GetResource("Reports_ReportTotal"),this.row.Cells[0].CellAppearance.Alignment="Left",this.row.Cells[0].ColSpan=e),this.ViewModel.addRow(this.row))}AddAgeingData(e){if(e!=this.lstGroup.length)return;if(!this.dsSubAgeing.Columns[0].Contains("Balance")){if(this.dsSubAgeing.Columns[0].push("Balance"),this.dsSubAgeing.Columns[0].push("UnAdjusted"),this.dsSubAgeing.Columns[0].push("NetBalance"),-1!=this.colLOBAgeingPDCIndex&&(this.dsSubAgeing.Columns[0].Contains("TotalPDC")||this.dsSubAgeing.Columns[0].push("TotalPDC"),this.dsSubAgeing.Columns[0].Contains("BalanceInclPDC")||this.dsSubAgeing.Columns[0].push("BalanceInclPDC")),-1!=this.colSlabIndex){for(let e=1;e<=this.SlabSize;e++)this.dsSubAgeing.Columns[0].push("Slab"+e),this.dsSubAgeing.Columns[0].push("FSlab"+e);this.dsSubAgeing.Columns[0].push("Slab"),this.dsSubAgeing.Columns[0].push("FSlab")}this.Slabs_MMMYY.forEach(e=>{this.dsSubAgeing.Columns[0].push(e)})}this.BlankRowHeight>0&&(this.ViewModel.addRow(this.NewReportRow()),this.ViewModel.Data[this.ViewModel.Data.length-1].Type=r.f.BlankRow,this.ViewModel.Data[this.ViewModel.Data.length-1].Height=this.BlankRowHeight/10),this.row=this.NewReportRow_2(r.f.Header,this.HeaderAppearance),this.row.LevelNo=this.ViewModel.lstGroup.length;for(let i=0;i<this.LOBAgeingColumns.length;i++)this.row.Cells[i].Text=this.LOBAgeingColumns[i].HeaderText;let t;this.ViewModel.addRow(this.row);let s=this.dsSubAgeing.Tables[0];for(let i=0;i<e;i++)s=s.filter(e=>e[this.lstGroup[i].ID]==this.ViewModel.Groupstr[this.lstGroup[i].ID]);if(0==s.length)return;if(this.drRows=this.dsSubAgeing.Tables[1].filter(e=>e.AccountID==s[0].AccountID),0==this.drRows.length)return;this.UpdateAmounts(),"Receivables"==this.ViewModel.Preferences.IncludeBills?(this.dbl1=this.dblReceivable,this.dbl2=this.dblPayable):"Payables"==this.ViewModel.Preferences.IncludeBills?(this.dbl1=this.dblPayable,this.dbl2=this.dblReceivable):(this.dbl1=this.dblReceivable+this.dblPayable,this.dbl2=0),s[0].Balance=this.dbl1,s[0].UnAdjusted=this.dbl2,s[0].NetBalance=this.dblReceivable+this.dblPayable,this.arrSlabAmounts=new Array(this.Slabs.length+1).fill(0),this.arrFSlabAmounts=new Array(this.Slabs.length+1).fill(0);let o=0;for(let i=0;i<this.drRows.length;i++){let e=this.drRows[i];if(this.dtDocDate=new Date(e.DocDate),this.dbl1=parseFloat(e.AdjAmount),"Receivables"==this.ViewModel.Preferences.IncludeBills){if(this.dbl1<0)continue}else if("Payables"==this.ViewModel.Preferences.IncludeBills&&this.dbl1>0)continue;for(t=0;t<this.Slabs.length&&!(this.dtDocDate>this.Slabs[t]);t++);this.arrSlabAmounts[t]+=this.dbl1,-1!=this.colLOBAgeingPDCIndex&&(o+=parseFloat(e.TotalPDC),this.PDCInclude&&this.arrPDCStatus.Contains(parseInt(e.Status))&&(o+=this.dblAmount))}if(-1!=this.colLOBAgeingPDCIndex&&(s[0].TotalPDC=o,s[0].BalanceInclPDC=this.PDCInclude?parseFloat(s[0].Balance):parseFloat(s[0].Balance)+o),-1!=this.colSlabIndex)for(this.k=0;this.k<=this.Slabs.length;this.k++)this.k==this.SlabSize?(s[0].Slab=this.arrSlabAmounts[this.k],s[0].FSlab=this.arrFSlabAmounts[this.k]):(s[0]["Slab"+(this.k+1)]=this.arrSlabAmounts[this.k],s[0]["FSlab"+(this.k+1)]=this.arrFSlabAmounts[this.k]);this.row=this.NewReportRow(),this.row.LevelNo=this.ViewModel.lstGroup.length;for(let i=0;i<this.LOBAgeingColumns.length;i++)this.CellValue=null,Object(u.isNullOrUndefined)(s[0][this.LOBAgeingColumns[i].ID])||(this.CellValue=s[0][this.LOBAgeingColumns[i].ID]),null!=this.CellValue&&(this.row.Cells[i].CellAppearance=this.LOBAgeingColumns[i].DataAppearance.Clone(),this.row.Cells[i].IsNormal=!1,this.row.Cells[i].CellAppearance.Alignment="Center",this.ViewModel.SetCellValue(this.CellValue,this.LOBAgeingColumns[i].DataFormat,this.LOBAgeingColumns[i].ColumnType,this.row.Cells[i]));this.ViewModel.addRow(this.row)}AddARAPRowSet(){let e=new n.a,t=this.NewReportRow_2(r.f.GrossTotal,this.GrossTotalAppearance_Data);t.Cells[0].Text="AMOUNT",t.Cells[0].CellAppearance.Alignment="Left",t.LevelNo=1;let s=this.NewReportRow_2(r.f.GrossTotal,this.GrossTotalAppearance_Data);s.Cells[0].Text="Total Collected",s.Cells[0].CellAppearance.Alignment="Left",s.LevelNo=1;let o=this.NewReportRow_2(r.f.GrossTotal,this.GrossTotalAppearance_Data);o.Cells[0].Text="Un Adjusted",o.Cells[0].CellAppearance.Alignment="Left",o.LevelNo=1;let l,a,h=this.NewReportRow_2(r.f.GrossTotal,this.GrossTotalAppearance_Data);h.Cells[0].Text="Net Balance",h.Cells[0].CellAppearance.Alignment="Left",h.LevelNo=1,this.ShowPreviousAdjustment&&(this.row=this.NewReportRow_2(r.f.GrossTotal,this.GrossTotalAppearance_Data),this.row.Cells[0].Text="Adjustments Of Previous Months",this.row.Cells[0].CellAppearance.Alignment="Left",this.row.LevelNo=1,e.push("PreviousAdj",this.row)),this.MonthSlabs.forEach(t=>{this.row=this.NewReportRow(),this.row.Cells[0].Text=t.ToString("MMM-yy").toUpperCase(),this.row.LevelNo=1,e.push(t.ToString("MMMyy"),this.row)}),this.ShowFutureAdjustment&&(this.row=this.NewReportRow_2(r.f.GrossTotal,this.GrossTotalAppearance_Data),this.row.Cells[0].Text="Adjustments Of Future Months",this.row.Cells[0].CellAppearance.Alignment="Left",this.row.LevelNo=1,e.push("FutureAdj",this.row));let u,D,d,c,C=0;if(this.IsConsolidated)this.MonthSlabs.forEach(n=>{D=0,d=0,c=0,l=n.ToString("MMMyy"),this.dvAmt=this.dvAmtTable.filter(e=>e.Yr==n.getFullYear()&&e.Mn==n.iMonth()),this.dvUnAdj=this.dvUnAdjTable.filter(e=>e.Yr==n.getFullYear()&&e.Mn==n.iMonth()),this.dvCollect=this.dvCollectTable.filter(e=>e.Yr==n.getFullYear()&&e.Mn==n.iMonth()),1==this.dvAmt.length&&(D=parseFloat(this.dvAmt[0].Amount),this.ViewModel.SetCellValue(this.dvAmt[0].Amount,this.oColumns[this.colMonthSlabIndex+C].DataFormat,"FLOAT",t.Cells[this.colMonthSlabIndex+C])),1==this.dvUnAdj.length&&(d=parseFloat(this.dvUnAdj[0].Amount),this.ViewModel.SetCellValue(this.dvUnAdj[0].Amount,this.oColumns[this.colMonthSlabIndex+C].DataFormat,"FLOAT",o.Cells[this.colMonthSlabIndex+C])),this.dvCollect.length>0&&this.dvCollect.forEach(t=>{a=new Date(parseInt(t.CYr),parseInt(t.CMn),1),c+=parseFloat(t.Amount),a<this.ViewModel.oReportDialog.FromDate.Date?(u=i.e.Double(e.PreviousAdj.Cells[this.colMonthSlabIndex+C].Value),u+=parseFloat(t.Amount),this.ViewModel.SetCellValue(u,this.oColumns[this.colMonthSlabIndex+C].DataFormat,"FLOAT",e.PreviousAdj.Cells[this.colMonthSlabIndex+C])):a>this.ViewModel.oReportDialog.ToDate.Date?(u=i.e.Double(e.FutureAdj.Cells[this.colMonthSlabIndex+C].Value),u+=parseFloat(t.Amount),this.ViewModel.SetCellValue(u,this.oColumns[this.colMonthSlabIndex+C].DataFormat,"FLOAT",e.FutureAdj.Cells[this.colMonthSlabIndex+C])):this.ViewModel.SetCellValue(t.Amount,this.oColumns[this.colMonthSlabIndex+C].DataFormat,"FLOAT",e[a.ToString("MMMyy")].Cells[this.colMonthSlabIndex+C])}),this.ViewModel.SetCellValue(c,this.oColumns[this.colMonthSlabIndex+C].DataFormat,"FLOAT",s.Cells[this.colMonthSlabIndex+C]),u=D-(c+d),this.ViewModel.SetCellValue(u,this.oColumns[this.colMonthSlabIndex+C].DataFormat,"FLOAT",h.Cells[this.colMonthSlabIndex+C]),this.arrMonthSlabAmounts[l]+=u,C++});else{this.row=this.NewReportRow_2(r.f.Group,this.ViewModel.lstGroup[0].GroupAppearance),this.ViewModel.lstGroup[0].Height>0&&(this.row.Height=this.ViewModel.lstGroup[0].Height),this.row.PrintVisible=this.ViewModel.lstGroup[0].GroupAppearance.IsPrintVisible,this.row.Cells[0].Text=this.drMainRow.AccountName.toString(),this.row.Cells[0].ColSpan=this.row.Cells.length,this.ViewModel.addRow(this.row);for(let n=0;n<this.MonthSlabs.length;n++){let r=this.MonthSlabs[n];D=0,d=0,c=0,l=r.ToString("MMMyy"),this.arrRows=this.dvCollectTable.filter(e=>e.AccountID==this.drMainRow.AccountID.toString()&&e.Yr==r.getFullYear()&&e.Mn==r.iMonth());for(let e=0;e<this.dvAmt.length;e++){let s=this.dvAmt[e];if(parseInt(s.Yr)==r.getFullYear()&&parseInt(s.Mn)==r.iMonth()){D=parseFloat(s.Amount),this.ViewModel.SetCellValue(s.Amount,this.oColumns[this.colMonthSlabIndex+C].DataFormat,"FLOAT",t.Cells[this.colMonthSlabIndex+C]);break}}for(let e=0;e<this.dvUnAdj.length;e++){let t=this.dvUnAdj[e];if(parseInt(t.Yr)==r.getFullYear()&&parseInt(t.Mn)==r.iMonth()){d=parseFloat(t.Amount),this.ViewModel.SetCellValue(t.Amount,this.oColumns[this.colMonthSlabIndex+C].DataFormat,"FLOAT",o.Cells[this.colMonthSlabIndex+C]);break}}this.arrRows.length>0&&this.arrRows.forEach(t=>{a=new Date(parseInt(t.CYr),parseInt(t.CMn),1),c+=parseFloat(t.Amount),a<this.ViewModel.oReportDialog.FromDate.Date?(u=i.e.Double(e.PreviousAdj.Cells[this.colMonthSlabIndex+C].Value),u+=parseFloat(t.Amount),this.ViewModel.SetCellValue(u,this.oColumns[this.colMonthSlabIndex+C].DataFormat,"FLOAT",e.PreviousAdj.Cells[this.colMonthSlabIndex+C])):a>this.ViewModel.oReportDialog.ToDate.Date?(u=i.e.Double(e.FutureAdj.Cells[this.colMonthSlabIndex+C].Value),u+=parseFloat(t.Amount),this.ViewModel.SetCellValue(u,this.oColumns[this.colMonthSlabIndex+C].DataFormat,"FLOAT",e.FutureAdj.Cells[this.colMonthSlabIndex+C])):this.ViewModel.SetCellValue(t.Amount,this.oColumns[this.colMonthSlabIndex+C].DataFormat,"FLOAT",e[a.ToString("MMMyy")].Cells[this.colMonthSlabIndex+C])}),this.ViewModel.SetCellValue(c,this.oColumns[this.colMonthSlabIndex+C].DataFormat,"FLOAT",s.Cells[this.colMonthSlabIndex+C]),u=D-(c+d),this.ViewModel.SetCellValue(u,this.oColumns[this.colMonthSlabIndex+C].DataFormat,"FLOAT",h.Cells[this.colMonthSlabIndex+C]),this.arrMonthSlabAmounts[l]+=u,C++}}this.CalculateARAPRowTotal(t),this.ViewModel.addRow(t),e.forEach(e=>{this.CalculateARAPRowTotal(e.Value),this.ViewModel.addRow(e.Value)}),this.CalculateARAPRowTotal(s),this.CalculateARAPRowTotal(o),this.CalculateARAPRowTotal(h),this.ViewModel.addRow(s),this.ViewModel.addRow(o),this.ViewModel.addRow(h)}CalculateARAPRowTotal(e){let t=0;for(let s=1;s<e.Cells.length;s++)t+=i.e.Double(e.Cells[s].Value);this.ViewModel.SetCellValue(t,this.oColumns[e.Cells.length-1].DataFormat,"FLOAT",e.Cells[e.Cells.length-1])}GetFutureTransactionDrCrQuery(e,t){let s=this.GetDimensionFilter("DCC.dcCCNID");this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?s+=" AND 1<>1":s+=" AND DCC.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")");let o,l="";0==this.UnPostedDocsList.length?l=" AND (ACC.StatusID=369 or ACC.StatusID=429)":l+=" AND ACC.StatusID IN (369,429,"+this.UnPostedDocsList+")",o=this.PDCInclude?" AND ACC.DocumentType<>16 AND ((ACC.StatusID=370 OR ACC.StatusID=439"+(this.IncludeTerminatedPDC?" OR ACC.StatusID=452":"")+") OR (ACC.DocumentType<>14 AND ACC.DocumentType<>19"+l+"))":" AND ACC.DocumentType NOT IN (16,14,19)"+l,e.length>0&&(e.Contains(",")?o+=" and ACC.CostCenterID in ("+e+")":o+=" and ACC.CostCenterID="+e);let a="";return a+="declare @AsOnDate float\nSET @AsOnDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",a+="\nSELECT AccountID,sum(Dr) Dr,sum(Cr) Cr\nFROM (\nSELECT VoucherNo,AccountID\n,case when sum(Dr)>=sum(Cr) then sum(Dr)-sum(Cr) else null end Dr\n,case when sum(Dr)<sum(Cr) then sum(Cr)-sum(Dr) else null end Cr\nFROM (\nselect A.AccountID,ACC.VoucherNo,Amount Dr,0 Cr\nfrom ACC_DocDetails ACC with(nolock)\ninner join ACC_Accounts A with(nolock) ON ACC.DebitAccount=A.AccountID\ninner join COM_DocCCData DCC with(nolock) ON ACC.AccDocDetailsID=DCC.AccDocDetailsID\nwhere A.AccountID>1 AND (ACC.StatusID=369 or ACC.StatusID=429 or ACC.StatusID=439) AND ACC.DocDate>@AsOnDate"+s+o+"\nUNION ALL\nselect A.AccountID,ACC.VoucherNo,0 Dr,Amount Cr\nfrom ACC_DocDetails ACC with(nolock)\ninner join ACC_Accounts A with(nolock) ON ACC.CreditAccount=A.AccountID\ninner join COM_DocCCData DCC with(nolock) ON ACC.AccDocDetailsID=DCC.AccDocDetailsID\nwhere A.AccountID>1 AND ACC.DocDate>@AsOnDate"+s+o+"\nUNION ALL\nselect A.AccountID,ACC.VoucherNo,Amount Dr,0 Cr\nfrom ACC_DocDetails ACC with(nolock)\ninner join ACC_Accounts A with(nolock) ON ACC.DebitAccount=A.AccountID\ninner join COM_DocCCData DCC with(nolock) ON ACC.InvDocDetailsID=DCC.InvDocDetailsID\nwhere A.AccountID>1 AND (ACC.StatusID=369) AND ACC.DocDate>@AsOnDate"+s+o+"\nUNION ALL\nselect A.AccountID,ACC.VoucherNo,0 Dr,Amount Cr\nfrom ACC_DocDetails ACC with(nolock)\ninner join ACC_Accounts A with(nolock) ON ACC.CreditAccount=A.AccountID\ninner join COM_DocCCData DCC with(nolock) ON ACC.InvDocDetailsID=DCC.InvDocDetailsID"+s+o+"\nwhere A.AccountID>1 AND (ACC.StatusID=369) AND ACC.DocDate>@AsOnDate\n) AS T\nGROUP BY VoucherNo,AccountID\n) AS T\nGROUP BY AccountID",1==t?a+=" HAVING sum(Dr) is not null and sum(Dr)>0":2==t&&(a+=" HAVING sum(Cr) is not null and sum(Cr)>0"),a.toString()}}},"4Moq":function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var o=s("Do2H"),i=s("Lp6j"),l=s("1xwR"),a=s("vTM8"),n=s("mvPR");class r extends l.b{constructor(e){super(e),this.DaysCol=0,this.MonthCols=0,this.tempCnt=0,this.UnitTypeID=0,this.Groupname=new Array,this.CurrRowsCount=0,this.FirstRow=new Array,this.PartTotals=new a.c,this.RentTotals=new a.c,this.CashTotals=new a.a,this.PartGroupTotals=new a.c,this.TempCols=new Array,this.index=0,this.rows=new Array,this.StrWhere="",this.ViewModel=e,this.oColumns=e.ReportColumns}GetPropertyProfitSummaryAll(){let e="",t=this.ViewModel.GetCostCenterFilter(92,"T0.NodeID");(!this.ViewModel.HideCostCenterTree&&!this.ViewModel.oReportDialog.IsOneSelected||"1"!=o.a.SessionManager.UserID&&"1"!=o.a.SessionManager.RoleID&&o.a.SessionManager.Preferences["Dimension List"].split(",").Contains("92"))&&(e=t),e+=this.ViewModel.GetDimensionFilter("CCD.CCNID"),o.a.report.GetRentalReports(113,this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,e,"").then(e=>{let t,s,l;this.ViewModel.GrpReportTotal.TotalCols.Clear(),this.ViewModel.lstGroup.forEach(e=>{e.TotalCols.Clear()}),this.index=-1;for(let o=0;o<this.ViewModel.ColumnSource.length;o++)this.TempCols.push(this.ViewModel.ColumnSource[o]),"26000"==this.ViewModel.ColumnSource[o].FieldName&&(this.index=o);if(null!=e&&e.Tables.length>0){let i=e.Tables[0];if(i.length>0){let a,n;i.Columns.push("ActiveRent");let r,h,u,D=null,d=this.index;if(-1!=this.index){let t=this.TempCols[this.index];t.ColumnType="FLOAT",o.a.SessionManager.Preferences.DecimalsinAmount.length>0&&(t.DataFormat.DecimalsPoints=parseInt(o.a.SessionManager.Preferences.DecimalsinAmount)),t.DataFormat.Commas="Millions"==o.a.SessionManager.Preferences.Commas?1:2;let s=e.Tables[1].ToTable(!0,["PartID"]);for(let o=0;o<e.Tables[2].length;o++){let l=e.Tables[2][o];if(0==s.filter(e=>e.PartID==l.NodeID).length)continue;r="P"+l.NodeID.toString();let a=t.Clone();a.ID=r,a.HeaderText=l.Name.toString(),this.TempCols.InsertAt(a,++this.index),i.Columns.push(r),this.ViewModel.TotalCols.Contains(a.ID)||this.ViewModel.TotalCols.push(a.ID),this.ViewModel.GrpReportTotal.TotalCols.ContainsKey(a.ID)?(this.ViewModel.GrpReportTotal.TotalCols[a.ID]=this.index-1,this.ViewModel.lstGroup.forEach(e=>{e.TotalCols[a.ID]=this.index-1})):(this.ViewModel.GrpReportTotal.TotalCols.push(a.ID,this.index-1),this.ViewModel.lstGroup.forEach(e=>{e.TotalCols.push(a.ID,this.index-1)}))}}for(let o=0;o<i.length;o++){if(h=i[o],e.Tables.length>1&&e.Tables[1].length>0&&-1!=this.index){n=e.Tables[1].filter(e=>e.ContractID==h.ContractID);for(let e=0;e<n.length;e++){r=n[e].PartID.toString(),a=0;for(let e=0;e<n.length;e++)n[e].PartID.toString()==r&&(a+=parseFloat(n[e].Amount));i[o]["P"+r]=a}}if(i[o].SNO=(o+1).toString(),i[o].ToDate=this.ViewModel.oReportDialog.ToDate.Date.toString(),""!=h.StartDate.toString()&&""!=h.EndDate.toString()){t=i[o].TerminationDate?new Date(i[o].TerminationDate):new Date(i[o].EndDate),u.dtCalCulateRentFrom=s,u.dtCalCulateRentTo=l,i[o].ReportDays=this.GetReportDays(new Date(h.StartDate),t,u),s=u.dtCalCulateRentFrom,l=u.dtCalCulateRentTo,i[o].RentDay=parseFloat(h.TotalAmount)/this.CalculateDays(new Date(h.StartDate),new Date(h.EndDate));let e,a=this.CalculateMonths(new Date(h.StartDate),new Date(h.EndDate));if(e=0==a?30*parseFloat(i[o].RentDay):parseFloat(h.TotalAmount)/a,i[o].Rent=this.CalculateRentPaid(s,l,e),parseFloat(h.TotalAmount)<parseFloat(i[o].Rent)&&(i[o].Rent=h.TotalAmount),null!=this.ViewModel.oReportDialog.ToDate.Date){let l=0;if(l=this.CalculateDays(s>=this.ViewModel.oReportDialog.ToDate.Date?s.AddDays(-1):this.ViewModel.oReportDialog.ToDate.Date,t),l>0){i[o].UnearnedDays=l-1;let t=0;s>new Date(i[o].StartDate)&&(t=this.CalculateRentPaid(new Date(i[o].StartDate),s.AddDays(-1),e));let a=parseFloat(h.TotalAmount)-parseFloat(i[o].Rent)-t;a>0&&(i[o].UnearnedAmount=a)}}}D!=i[o].Unit.toString()&&(i[o].ActiveRent=""!=i[o].TerminationDate.toString()?i[o].UnearnedAmount:"450"==i[o].StatusID.toString()||"0"==i[o].StatusID.toString()?0:i[o].TotalAmount,D=i[o].Unit.toString())}d>0&&(this.ViewModel.GrpReportTotal.TotalCols.Remove("Particular"),this.TempCols.RemoveAt(d))}}this.ViewModel.totals=i.e.NumArray(this.TempCols.length,this.ViewModel.lstGroup.length+1),this.ViewModel.ReportColumns=this.TempCols,this.ViewModel.Refresh_lstSummaryData(),this.ViewModel.GrpReportTotal.TempTotalCols.keys.forEach(e=>{var t=this.TempCols.find(t=>t.ID==e);t&&(this.ViewModel.GrpReportTotal.TotalCols.push(t.ID,this.TempCols.indexOf(t)),this.ViewModel.lstGroup.forEach(e=>{e.TotalCols.push(t.ID,this.TempCols.indexOf(t))}))}),this.ViewModel.LoadDynamicReportFromSP_CallBack(e)})}GetPropertyProfitSummary(){let e=this.ViewModel.oReportDialog.GetSeqNosList(),t="";this.ViewModel.HideCostCenterTree||this.ViewModel.oReportDialog.IsOneSelected?"1"!=o.a.SessionManager.UserID&&"1"!=o.a.SessionManager.RoleID&&o.a.SessionManager.Preferences["Dimension List"].split(",").Contains("92")&&e.length>0&&(t+=" AND P.NodeID IN ("+e+")"):e.length>0&&(t+=" AND P.NodeID IN ("+e+")");let s="";for(let o=0;o<this.ViewModel.ReportColumns.length;o++)"Unit"==this.ViewModel.ReportColumns[o].ID&&"TREE ASC"==this.ViewModel.ReportColumns[o].DataFormat.Sort.toUpperCase()&&(s+=",U.Lft ASC");o.a.report.GetRentalReportsNew(73,this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,t,"",this.ViewModel.FromTag,this.ViewModel.SelectTag,"",s).then(e=>{let t,s,o;if(null!=e&&e.Tables.length>0){let i=e.Tables[0];if(i.length>0){let e=i;for(let l=0;l<e.length;l++){t=i[l].TerminationDate?new Date(i[l].TerminationDate):new Date(i[l].EndDate);let a={dtCalCulateRentFrom:s,dtCalCulateRentTo:o};i[l].ReportDays=this.GetReportDays(new Date(e[l].StartDate),t,a),s=a.dtCalCulateRentFrom,o=a.dtCalCulateRentTo,i[l].RentTotMonths=this.GetReportMonths(new Date(e[l].StartDate),new Date(e[l].EndDate),this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date).split(".")[0];let n=this.CalculateDays(new Date(e[l].StartDate),new Date(e[l].EndDate));i[l].RentDay=n>0?parseFloat(e[l].TotalAmount)/n:0,n=this.CalculateMonths(new Date(e[l].StartDate),new Date(e[l].EndDate)),i[l].RentMonth=n>0?parseFloat(e[l].TotalAmount)/n:0,i[l].Rent=this.CalculateRentPaid(s,o,parseFloat(i[l].RentMonth)),""!=i[l].RentMonth.toString()&&(i[l].RentAmountMonth=Math.round(parseFloat(this.GetReportAmountMonths(new Date(e[l].StartDate),new Date(e[l].EndDate),this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,parseFloat(i[l].RentMonth)))))}}}this.ViewModel.LoadDynamicReportFromSP_CallBack(e)})}GetDailyVacantReport(){let e=this.ViewModel.oReportDialog.GetSeqNosList(),t="  SELECT distinct 1 ROWNO, T0.Name AS [Unit] ,T0.UnitID  UnitID,  T1.ContractNumber AS [ContractNumber]  , CONVERT(DATETIME,T1.ContractDate) AS [ContractDate],\n            T2.Name AS [Property] , 0 Occupied ,  T2.NodeId AS PropertyId, ( select count( Unt.UnitID ) from REN_Units Unt with(nolock) join REN_Property Prt with(nolock) on Unt.PropertyID=Prt.NodeID   and Prt.NodeId =  T2.nodeid WHERE  Prt.NodeId =  T2.nodeid and Unt.Unitid= T0.UnitID  GROUP BY Prt.NodeID ) VacantCount\n            FROM REN_Units T0 with(nolock),REN_Contract T1 with(nolock),REN_Property T2 with(nolock)   where T1.UnitID=T0.UnitID AND T1.PropertyID=T2.NodeID  and T0.Name is not null and T0.Name <>'' \n            AND T1.IsGroup <> 1    and T0.ContractID=0  AND CONVERT(DATETIME,T1.ContractDate) <= '"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'\n            AND CONVERT(DATETIME,T1.ContractDate)  >= '"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'";!this.ViewModel.HideCostCenterTree&&e.length>0&&(t+=" AND T0.NodeID IN ("+e+")"),t+=" ORDER BY T2.Name ",o.a.report.DataSetAsyn("RPT022",t).then(e=>{let t=[],s=0;if(null!=e&&e.Tables.length>0&&e.Tables[0].length>0){this.DaysCol=this.ViewModel.oReportDialog.ToDate.Date.Subtract(this.ViewModel.oReportDialog.FromDate.Date).Days;let o=this.ViewModel.oReportDialog.FromDate.Date;t=e.Tables[0];for(let e=0;e<this.ViewModel.ColumnSource.length;e++)this.TempCols.push(this.ViewModel.ColumnSource[e]);for(let e=0;e<=this.DaysCol;e++)this.AddColumns(o.toString(),o.getDate().toString()+"-"+this.GetMonth(o.Month),"Right",80,"",!1),o=o.AddDays(1);for(let e=0;e<t.length;e++){let i=t[e].PropertyId.toString(),l=t[e].UnitID.toString();o=this.ViewModel.oReportDialog.FromDate.Date;for(let a=0;a<=this.DaysCol;a++){let a=this.GetVacantFlatCount(o,i,l);null!=a?a.length>0?null!=t[e].VacantCount&&null!=a[0].Occupied&&(s=parseInt(t[e].VacantCount)-parseInt(a[0].Occupied)):null!=t[e].VacantCount&&(s=parseInt(t[e].VacantCount)):s=null!=t[e].VacantCount?parseInt(t[e].VacantCount):0,t[e][o.toString()]=s,o=o.AddDays(1)}}this.ViewModel.totals=i.e.NumArray(this.TempCols.length,this.ViewModel.lstGroup.length+1),this.ViewModel.ReportColumns=this.TempCols}this.ViewModel.LoadDynamicReportFromSP_CallBack(e)})}GetStatisticalReport(){let e=this.ViewModel.oReportDialog.GetSeqNosList(),t="  \tSELECT PROP.NODEID ,PROP.CODE , PROP.NAME  Property ,Lckup.Name  Category    \n            FROM  REN_Contract CONT with(nolock)\n            JOIN REN_PROPERTY PROP with(nolock) ON CONT.PROPERTYID = PROP.NODEID\n            LEFT JOIN COM_LOOKUP LCKUP with(nolock) ON PROP.PROPERTYCATEGORYLOOKUPID = LCKUP.NODEID\n             AND CONT.IsGroup <> 1 AND CONVERT(DATETIME,CONT.ContractDate) <= '"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'\n            AND CONVERT(DATETIME,CONT.ContractDate)  >= '"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"' \n            GROUP BY PROP.PROPERTYCATEGORYLOOKUPID ,PROP.CODE , PROP.NAME ,LCKUP.NAME , PROP.NODEID   ORDER BY Lckup.NAME, PROP.NAME  ";return!this.ViewModel.HideCostCenterTree&&e.length>0&&(t+=" AND T0.NodeID IN ("+e+")"),o.a.report.DataSetAsyn("RPT022",t).then(e=>{t="  DECLARE @TBLNAME NVARCHAR(50) ,@QRY NVARCHAR (MAX)\n                 SELECT @TBLNAME = TABLENAME FROM  dbo.ADM_Features with(nolock) WHERE FEATUREID in ( select value from dbo.ADM_GlobalPreferences with(nolock) where name  = 'UnitLinkDimension')    \n                 IF(@TBLNAME is not null and @TBLNAME <>'')\n                 BEGIN\n                  SET @QRY = ' select NodeID , Name  from ' + @TBLNAME+'  with(nolock)'\n                  EXEC (@QRY)\n                 END ",o.a.report.DataSetAsyn("RPT022",t).then(t=>{if(null!=t&&t.Tables.length>0&&t.Tables[0].length>0)for(let o=0;o<t.Tables[0].length;o++)e.Columns[0].Contains(t.Tables[0][o][1].toString())||(e.Columns[0].push(t.Tables[0][o][0].toString()),e.Columns[0].push(t.Tables[0][o][1].toString()));let s=[];s.push(this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")),s.push(this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")),s.push("Stat"),o.a.report.GetStatisticRpt(s).then(s=>{if(null!=e&&e.Tables.length>0&&e.Tables[0].length>0)for(let t=0;t<e.Tables[0].length;t++){let o=s.Tables[0].filter(s=>s.TowerNodeno==e.Tables[0][t].NODEID);if(o.length>0)for(let s=0;s<o.length;s++)e.Tables[0][t][o[s].NAME.toString()]=o[s].Occupied.toString()}if(null!=e&&e.Tables.length>0&&e.Tables[0].length>0){for(let e=0;e<this.ViewModel.ColumnSource.length;e++)this.TempCols.push(this.ViewModel.ColumnSource[e]);if(null!=t&&t.Tables.length>0&&t.Tables[0].length>0)for(let e=0;e<t.Tables[0].length;e++)this.AddColumns(t.Tables[0][e].Name.toString(),t.Tables[0][e].Name.toString(),"Right",80,"",!1);this.ViewModel.ReportColumns=this.TempCols}this.ViewModel.LoadDynamicReportFromSP_CallBack(e)})})})}GetEmailDetails(){this.ViewModel.oReportDialog.GetSeqNosList();let e=" SELECT CostcenterID , NodeID,  [TO], CC ,[Subject] , [From],\n            ISNULL((SELECT TOP 1 VOUCHERNO FROM INV_DOCDETAILS with(nolock) WHERE COSTCENTERID =  His.CostcenterID AND DOCID  = His.NodeID ),(SELECT TOP 1 VOUCHERNO FROM ACC_DOCDETAILS with(nolock) WHERE COSTCENTERID =  His.CostcenterID AND DOCID  = His.NodeID ) )\n            AS VoucherNo , CONVERT(DATETIME , CREATEDDATE) CREATEDATE  FROM COM_Notif_History His with(nolock) WHERE His.STATUSID = 2 and CONVERT(DATETIME,CREATEDDATE) <= '"+this.ViewModel.oReportDialog.ToDate.Date.AddDays(1).ToString("dd MMM yyyy")+"'\n            AND CONVERT(DATETIME,CREATEDDATE)  >= '"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'  ORDER BY  [From] desc ";return o.a.report.DataSetAsyn("RPT022",e)}TowerWisePropertyRpt(e,t,s,o){let i=e.Tables[1].ToTable(!0,["PARTNAME"]),l=0;o>0&&(this.CurrRowsCount=t.Tables[0].length-1,this.FirstRow.push(this.CurrRowsCount));for(let n=0;n<5;n++)t.Tables[0].push({});if(t.Tables[0][0+this.CurrRowsCount][0]=e.Tables[0][0].PropertyName.toString(),t.Tables[0][1+this.CurrRowsCount][0]="Total No of Sold Units",t.Tables[0][2+this.CurrRowsCount][0]="Total No of Rentable Units",t.Tables[0][3+this.CurrRowsCount][0]="Rent",t.Tables[0][4+this.CurrRowsCount][0]="Total Rent",null!=e&&e.Tables.length>0&&e.Tables[0].length>0){let o,a=e.Tables[0],n=e.Tables[0];if(a=n.filter(e=>"Sold"==e.SoldStatus),a.length>0)for(let e=0;e<a.length;e++)""!=a[e].NodeID.toString()&&"0"!=a[e].NodeID.toString()&&(t.Tables[0][1+this.CurrRowsCount][a[e].NodeID.toString()]=a[e].Total.toString());if(a=n.filter(e=>"Not Sold"==e.SoldStatus),a.length>0)for(let e=0;e<a.length;e++)""!=a[e].NodeID.toString()&&"0"!=a[e].NodeID.toString()&&t.Columns[0].Contains(a[e].NodeID.toString())&&(t.Tables[0][2+this.CurrRowsCount][a[e].NodeID.toString()]=a[e].Total.toString());for(let e=0;e<a.length;e++)""!=a[e].NodeID.toString()&&"0"!=a[e].NodeID.toString()&&t.Columns[0].Contains(a[e].NodeID.toString())&&(t.Tables[0][3+this.CurrRowsCount][a[e].NodeID.toString()]=a[e].Rent.toString(),t.Tables[0][4+this.CurrRowsCount][a[e].NodeID.toString()]=a[e].Rent.toString(),this.RentTotals.ContainsKey(parseInt(a[e].NodeID))||this.RentTotals.push(parseInt(a[e].NodeID),parseFloat(a[e].Rent)));if(null!=s&&s.Tables.length>0&&s.Tables[0].length>0){a=s.Tables[0];for(let s=0;s<i.length;s++){t.Tables[0].push({}),t.Tables[0][5+this.CurrRowsCount+s][0]=i[s].PARTNAME.toString();for(let l=0;l<a.length;l++){let n=e.Tables[1].filter(e=>e.UnitTypeID==a[l].NodeID&&e.PARTNAME==i[s].PARTNAME.toString());n.length>0&&(o=parseInt(n[0].UnitTypeID),this.PartTotals.ContainsKey(o)||this.PartTotals.push(o,0),t.Tables[0][5+this.CurrRowsCount+s][a[l].NodeID.toString()]=n[0].AMOUNT.toString(),this.PartTotals[o]=this.PartTotals[o]+parseFloat(n[0].AMOUNT))}}if(t.Tables[0].push({}),l=t.Tables[0].length-1,t.Tables[0][l][0]="Total Other Income",t.Tables[0].push({}),t.Tables[0][l+1][0]="Total Net Rent",this.PartTotals.length>0&&this.PartTotals.keys.forEach(e=>{let s={Key:e,Value:this.PartTotals[e]};t.Tables[0][l][s.Key.toString()]=s.Value.toString()}),this.RentTotals.length>0){let e=0;this.RentTotals.keys.forEach(s=>{let o={Key:s,Value:this.PartTotals[s]};e=0,null!=t.Tables[0][l][o.Key.toString()]&&(e=parseFloat(t.Tables[0][l][o.Key.toString()])),null!=t.Tables[0][4+this.CurrRowsCount][o.Key.toString()]&&(t.Tables[0][l+1][o.Key.toString()]=e+parseFloat(o.Value))})}}}if(null!=e&&e.Tables.length>2&&e.Tables[2].length>0&&(t.Tables[0].push({}),l=t.Tables[0].length-1,t.Tables[0].push({}),t.Tables[0].push({}),t.Tables[0][l][0]="Vacant Units in Nos",t.Tables[0][l+1][0]="Vacant Unit Amount",t.Tables[0][l+2][0]="Total Net Income",null!=s&&s.Tables.length>0&&s.Tables[0].length>0)){let o=s.Tables[0];for(let s=0;s<o.length;s++){let i=e.Tables[2].filter(e=>e.UnitTypeID==o[s].NodeID);i.length>0&&(this.PartTotals.ContainsKey(parseInt(o[s].NodeID))||this.PartTotals.push(parseInt(o[s].NodeID),0),t.Tables[0][l][o[s].NodeID.toString()]=i[0].Vacant.toString(),t.Tables[0][l+1][o[s].NodeID.toString()]=i[0].Rent.toString()),i=e.Tables[0].filter(e=>e.UnitTypeID==o[s].NodeID),i.length>0&&(this.PartTotals.ContainsKey(parseInt(o[s].NodeID))||this.PartTotals.push(parseInt(o[s].NodeID),0))}}let a=t.Tables[0].length-1;if(null!=s&&s.Tables.length>0&&s.Tables[0].length>0){let e=s.Tables[0];for(let s=0;s<e.length;s++){let o=0,i=0;null!=t.Tables[0][a-3][e[s].NodeID.toString()]&&(o=parseFloat(t.Tables[0][a-3][e[s].NodeID.toString()])),null!=t.Tables[0][a-1][e[s].NodeID.toString()]&&(i=parseFloat(t.Tables[0][a-1][e[s].NodeID.toString()])),t.Tables[0][a][e[s].NodeID.toString()]=o-i}}return t.Tables[0].push({}),t}GetVacantFlatCount(e,t,s){let i=o.a.report.DataSet("RPT022","\" SELECT  COUNT(PROP.NodeId) Occupied ,PROP.NodeID PropertID  \n        from  REN_Contract T1 with(nolock)\n        join REN_Property  PROP with(nolock) on PROP.NodeID = T1.PropertyID\n        JOIN REN_Units UNIT with(nolock) ON UNIT.UnitID = T1.UnitID\n        left join   ( SELECT distinct   b.Name,b.NODEID     from REN_Units  a with(nolock)\n        inner join REN_Property  b with(nolock)  on b.NodeId = a.PropertyID \n        where a.Name is not null and a.Name <>''    ) as Tow on  \n        Tow.NODEID = PROP.NodeID WHERE    (Convert(datetime,T1.StartDate) <=  '"+e+"'  AND  CONVERT(DATETIME, T1.ENDDATE) >= '"+e+"') and T1.PropertyID = '"+t+"'  and T1.UnitId = '"+s+"' GROUP BY PROP.NodeID    ");return null!=i&&i.Tables.length>0&&i.Tables[0].length>0?i.Tables[0].AsDataView():null}GetFiltersData(e,t){let s="";for(let o=0;o<this.ViewModel.oReportDialog.CostCenterFilters.length;o++){let i=this.ViewModel.oReportDialog.CostCenterFilters[o];if(i.SelectedNodes.length>0||!i.DeleteButtonVisibility)if(50002==i.CostCenterID&&50002==t){this.StrWhere.Contains("WHERE")?s+=" AND ":s+=" WHERE ",s+=e+"   IN (";for(let e=0;e<i.SelectedNodes.length;e++)e>0&&(s+=","),s+=i.SelectedNodes[e].Id;s+=")"}else if(i.CostCenterID>5e4&&t>5e4&&50002!=t)if(this.StrWhere.Contains("WHERE")?s+=" AND ":s+=" WHERE ",1==i.SelectedNodes.length)s+=e+"="+i.SelectedNodes[0].Id;else{s+=e+" IN (";for(let e=0;e<i.SelectedNodes.length;e++)e>0&&(s+=","),s+=i.SelectedNodes[e].Id;s+=")"}else if(92==i.CostCenterID&&92==t){s+="  WHERE "+e+"   IN (";for(let e=0;e<i.SelectedNodes.length;e++)e>0&&(s+=","),s+=i.SelectedNodes[e].Id;s+=")"}}return s.toString()}UnitWiseContractExp(){let e=" SELECT  VALUE FROM COM_COSTCENTERPREFERENCES with(nolock) WHERE COSTCENTERID = 92 AND NAME  = 'Landlord' ";o.a.report.DataSetAsyn("RPT022",e).then(t=>{e="";let s="",l=!1;s=this.GetFiltersData("UNT.PropertyID",92),this.ViewModel.oReportDialog.CostCenterFilters.forEach(e=>{(e.SelectedNodes.length>0||!e.DeleteButtonVisibility)&&(50002==e.CostCenterID?(l=!0,s+=this.GetFiltersData("UNT.LocationID",50002)):null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&e.CostCenterID==parseInt(t.Tables[0][0][0])&&(s+=this.GetFiltersData("PROP.LandlordID",e.CostCenterID)))}),l||""==o.a.SessionManager.LocationWhere||(s.Contains("WHERE")?s+=" AND ":s+=" WHERE ",s=this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&!i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?s+" UNT.LOCATIONID IN ("+this.ViewModel.oReportDialog.LocationWhere+")":s+" UNT.LOCATIONID   IN ("+o.a.SessionManager.LocationWhere+")"),this.ViewModel.oReportDialog.GetSeqNosList(),this.StrWhere=this.GetFiltersData("UNT.PropertyID",92);let a=!1;this.ViewModel.oReportDialog.CostCenterFilters.forEach(e=>{(e.SelectedNodes.length>0||!e.DeleteButtonVisibility)&&(50002==e.CostCenterID?(a=!0,this.StrWhere=this.StrWhere+this.GetFiltersData("CNT.LOCATIONID",50002)):null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&e.CostCenterID==parseInt(t.Tables[0][0][0])&&(this.StrWhere=this.StrWhere+this.GetFiltersData("PROP.LandlordID",e.CostCenterID)))}),a||""==o.a.SessionManager.LocationWhere||(this.StrWhere=this.StrWhere.Contains("WHERE")?this.StrWhere+" AND ":this.StrWhere+" WHERE ",this.StrWhere=this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&!i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?this.StrWhere+" CNT.LOCATIONID IN ("+this.ViewModel.oReportDialog.LocationWhere+")":this.StrWhere+" CNT.LOCATIONID   IN ("+o.a.SessionManager.LocationWhere+")"),o.a.report.GetRentalReports(140,this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,s,this.StrWhere).then(e=>{this.ViewModel.LoadDynamicReportFromSP_CallBack(e)})})}UnitRenewalReport(){this.ViewModel.oReportDialog.GetSeqNosList();let e="   SELECT P.NAME PROPERTYNAME ,U.NAME UNITNAME ,Te.FirstName ,CONVERT(DATETIME,R.ENDDATE) ENDDATE , R.TOTALAMOUNT Rent FROM REN_Contract R with(nolock)\n        INNER JOIN (\tselect  PROPERTYID , UNITID  , max(ENDDATE) ENDDATE  from REN_Contract with(nolock)\n        GROUP BY PROPERTYID , UNITID HAVING max(CONVERT(DATETIME,ENDDATE))<=  '"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"' and \n        max(CONVERT(DATETIME,ENDDATE))>= '"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"' ) AS T ON R.PROPERTYID=T.PROPERTYID AND R.UNITID=T.UNITID \t\n        AND R.ENDDATE=T.ENDDATE   LEFT JOIN REN_PROPERTY P ON R.PROPERTYID = P.NODEID  LEFT JOIN REN_UNITS  U with(nolock) ON R.UNITID = U.UNITID\n        LEFT JOIN REN_Tenant Te with(nolock) ON R.TENANTID = Te.TENANTID WHERE R.StatusID IN (426,427) ORDER BY P.NAME,CONVERT(DATETIME,R.ENDDATE)";return o.a.report.DataSetAsyn("RPT022",e)}UnitVacant(){let e=this.ViewModel.GetCostCenterFilter(92,"PROP.NodeID");e+=this.ViewModel.GetDimensionFilter("CCD.CCNID");let t="",s=this.ViewModel.oReportDialog.CostCenterFilters.find(e=>44==e.CostCenterID&&46==e.LookupTypeID);s&&s.SelectedNodes.forEach(e=>{t=t+e.Id+","}),""!=t&&(e+=" AND UNT.UnitStatus IN ("+t.TrimEnd(",")+")");let i="";return this.ViewModel.Preferences.ContainsKey("IncludeUnUsedUnitsAtContract")&&"1"==this.ViewModel.Preferences.IncludeUnUsedUnitsAtContract&&(i="1"),o.a.report.GetRentalReports(127,this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,e,i)}GetRentalReportsNew(){let e=this.ViewModel.oReportDialog.GetSeqNosList(),t="";this.ViewModel.HideCostCenterTree||this.ViewModel.oReportDialog.IsZeroSelected||this.ViewModel.oReportDialog.IsOneSelected?"1"!=o.a.SessionManager.UserID&&"1"!=o.a.SessionManager.RoleID&&!this.ViewModel.oReportDialog.IsZeroSelected&&o.a.SessionManager.Preferences["Dimension List"].split(",").Contains("92")&&e.length>0&&(t+=" AND P.NodeID IN ("+e+")"):e.length>0&&(t+=" AND P.NodeID IN ("+e+")"),e=this.ViewModel.GetCostCenterFilter(93,"U.UnitID"),e+=this.ViewModel.GetCostCenterFilter(94,"T.TenantID "),e.length>0&&(t+=e);let s="";for(let o=0;o<this.ViewModel.ReportColumns.length;o++)"Unit"==this.ViewModel.ReportColumns[o].ID&&"TREE ASC"==this.ViewModel.ReportColumns[o].DataFormat.Sort.toUpperCase()&&(s+=",U.Lft ASC");let l=this.ViewModel.GroupSelectTag;if(214==this.ViewModel.StaticReportType)l=this.ViewModel.SelectTagAliasOnly;else if(210==this.ViewModel.StaticReportType&&this.ViewModel.Preferences.ContainsKey("Days")){let e=i.e.Int(this.ViewModel.Preferences.Days);e<=0&&(e=90),l=e.toString()}return o.a.report.GetRentalReportsNew(this.ViewModel.StaticReportType,this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,t,"",this.ViewModel.FromTag,this.ViewModel.SelectTag,l,s)}CalculateRentPaid(e,t,s){let o,i=0,l=0,a=e;for(1!=a.getDate()?(l=a.DaysInMonth(),o=new Date(a.getFullYear(),a.getMonth(),l),o>t&&(o=t),i=s*(1+o.getDate()-a.getDate())/l,o=o.AddDays(1)):o=e;o<=t;)l=o.DaysInMonth(),o=new Date(o.getFullYear(),o.getMonth(),l),o>t?(o=t,i+=s*o.getDate()/l):i+=s,o=o.AddDays(1);return Math.round(i)}GetReportAmountMonths(e,t,s,o,i){return e>=s?o<=t?this.CalculateReportAmount(e,o,i).toString():this.CalculateReportAmount(e,t,i).toString():o<=t?this.CalculateReportAmount(s,o,i).toString():this.CalculateReportAmount(s,t,i).toString()}CalculateReportAmount(e,t,s){let o=0,i=0,l=e;for(l=l.AddMonths(1),l=l.AddDays(-(l.getDate()-1));t>l;)o+=s,l=l.AddMonths(1);return e.getDate()>1?(i=e.getDate(),o+=s/e.DaysInMonth()*(e.DaysInMonth()-i+1)):1==e.getDate()&&(o+=s),l.Date>t.Date?o-=s/t.DaysInMonth()*(t.DaysInMonth()-t.getDate()):l.Date==t.Date&&(o+=s),o.toString()}GetReportDays(e,t,s){let o=this.ViewModel.oReportDialog.FromDate.Date,i=this.ViewModel.oReportDialog.ToDate.Date;return s.dtCalCulateRentFrom=e>=o?e:o,s.dtCalCulateRentTo=i<=t?i<=e?e.AddDays(-1):i:t,this.CalculateDays(s.dtCalCulateRentFrom,s.dtCalCulateRentTo)}GetReportMonths(e,t,s,o){return e>=s?o<=t?this.CalculateMonths(e,o).toString():this.CalculateMonths(e,t).toString():o<=t?this.CalculateMonths(s,o).toString():this.CalculateMonths(s,t).toString()}CalculateMonths(e,t){try{let s=0,o=e,i=e.DaysInMonth()-e.getDate();if(i<4)for(i+=1;t>o;)s++,o=o.AddMonths(1),o=o.DaysInMonth()>=e.getDate()?new Date(o.getFullYear(),o.getMonth(),e.getDate()-1):new Date(o.getFullYear(),o.getMonth(),o.DaysInMonth()-i);else for(;t>o;)s++,o=o.AddMonths(1);return s}catch(s){return 0}}CalculateDays(e,t){try{let s=0;return s=t.Subtract(e).Days+1}catch(s){return 0}}GetMonth(e){switch(e){case 1:return"Jan";case 2:return"Feb";case 3:return"Mar";case 4:return"Apr";case 5:return"May";case 6:return"June";case 7:return"July";case 8:return"Aug";case 9:return"Sep";case 10:return"Oct";case 11:return"Nov";case 12:return"Dec";default:return""}}AddColumns(e,t,s,i,l,a){let n=this.ViewModel.ColumnSource[this.ViewModel.ColumnSource.length-1].Clone();n.ID=e,n.FieldName=e,n.HeaderText=t,n.width=i,"Right"==s?(n.DataAppearance.Alignment="Right",n.DataFormat.DecimalsPoints=null!=o.a.SessionManager.Preferences.DecimalsinAmount&&""!=o.a.SessionManager.Preferences.DecimalsinAmount.toString()?parseInt(o.a.SessionManager.Preferences.DecimalsinAmount):3,n.ColumnType="FLOAT",n.DataFormat.Commas=1):"Left"==s&&(n.DataAppearance.Alignment="Left"),n.Formula="",this.TempCols.Contains(n)||this.TempCols.push(n)}AddReportRows(e,t){this.oColumns[0].DataAppearance.IsBold=!0;let s,o=0;for(let i=0;i<e.Tables[0].length;i++){if(s=new n.d(this.oColumns.length),o=0,"CashFlow"==t||"TowerWise"==t||"RentUnits"==t){for(let t=1;t<e.Columns[0].length-1;t++)null!=e.Tables[0][i][t]&&"0"!=e.Tables[0][i][t].toString()&&(o+=parseFloat(e.Tables[0][i][t]));e.Tables[0][i].TotalRow=o.toString()}for(let o=0;o<this.oColumns.length;o++){let l="";if(""!=this.oColumns[o].Formula||e.Columns[0].Contains(this.oColumns[o].ID)&&(l=e.Tables[0][i][this.oColumns[o].ID].toString()),""!=l&&(this.ViewModel.SetCellValue(l,this.oColumns[o].DataFormat,this.oColumns[o].ColumnType,s.Cells[o]),this.FirstRow.Contains(i)&&0==o)){if("RentUnits"==t){s.Cells[0].ColSpan=this.oColumns.length;break}s.Cells[0].ColSpan=this.oColumns.length-1}}"TowerWise"==t&&null!=s.Cells[0].Text&&"Total No of Sold Units"==s.Cells[0].Text.toString()&&this.ViewModel.Preferences.ContainsKey("HideTotalNoofSoleUnits")&&"1"==this.ViewModel.Preferences.HideTotalNoofSoleUnits.toString()||(this.ViewModel.ApplyKPI(s),this.ViewModel.addRow(s))}}GetTowerWiseRentAnalysis(){let e=this.ViewModel.GetCostCenterFilter(92,"PROP.NodeID");e+=this.ViewModel.GetDimensionFilter("CCD.CCNID");let t=[];t.push(this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")),t.push(this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")),t.push(e),o.a.report.GetTowerwiseRentRpt(t).then(e=>{let t=[];o.a.report.DataSetAsyn("RPT022","  DECLARE @TBLNAME NVARCHAR(50) ,@QRY NVARCHAR (MAX)\n                 SELECT @TBLNAME = TABLENAME FROM  dbo.ADM_Features with(nolock) WHERE FEATUREID in ( select value from dbo.ADM_GlobalPreferences with(nolock) where name  = 'UnitLinkDimension')    \n                 IF(@TBLNAME is not null and @TBLNAME <>'')\n                 BEGIN\n                  SET @QRY = ' select NodeID , Name  from ' + @TBLNAME+'  with(nolock)'\n                  EXEC (@QRY)\n                 END ").then(s=>{if(null!=e&&e.Tables.length>0&&e.Tables[0].length>0)for(let e=0;e<this.ViewModel.ColumnSource.length;e++)this.TempCols.push(this.ViewModel.ColumnSource[e]),"26000"==this.ViewModel.ColumnSource[e].FieldName&&(this.index=e);if(t.Tables.push([]),t.Columns.push([]),t.Columns[0].push("Property"),null!=s&&s.Tables.length>0&&s.Tables[0].length>0)for(let e=0;e<s.Tables[0].length;e++)t.Columns[0].Contains(s.Tables[0][e][0].toString())||t.Columns[0].push(s.Tables[0][e][0].toString()),t.Columns[0].Contains(s.Tables[0][e][1].toString())||t.Columns[0].push(s.Tables[0][e][1].toString());let o,i=e.Tables[0].DefaultView.ToTable(!0,"PropertyID"),l=new a.c,n=new Array;for(let a=0;a<i.length;a++){o={};let r=e.Tables[0].filter(e=>e.PropertyID==i[a].PropertyID);o.Tables.push(r);let h=e.Tables[1].filter(e=>e.PropertyID==i[a].PropertyID);if(o.Tables.push(h),e.Tables.length>2&&e.Tables[2].length>0){let t=e.Tables[2].filter(e=>e.PropertyID==i[a].PropertyID);o.Tables.push(t)}this.FirstRow.push(0),this.RentTotals.Clear(),this.PartTotals.Clear(),t=this.TowerWisePropertyRpt(o,t,s,a),null!=this.PartTotals&&this.PartTotals.length>0&&(s.Tables[0].forEach(e=>{l.ContainsKey(parseInt(e.NodeId))||l.push(parseInt(e.NodeId),e.Name.toString())}),this.PartTotals.keys.forEach(e=>{n.Contains(e.toString())||(n.push(e.toString()),this.AddColumns(e.toString(),l[e],"Right",80,"",!1))}))}this.AddColumns("TotalRow","TOTAL","Right",80,"",!1),t.Columns[0].push("TotalRow"),this.index>0&&(this.ViewModel.GrpReportTotal.TotalCols.Remove("Particular"),this.TempCols.RemoveAt(this.index)),this.ViewModel.ReportColumns=this.TempCols,this.oColumns=this.ViewModel.ReportColumns,this.AddReportRows(t,"TowerWise"),this.ViewModel.process_RunWorkerCompleted()})})}GetCashFlowTowerwise(){this.FirstRow.Clear(),this.FirstRow.push(0);let e=this.ViewModel.oReportDialog.GetSeqNosList(),t=[];t.push(this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")),t.push(this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")),t.push(e),this.ViewModel.Preferences.ContainsKey("ParticularsDetails")?t.push(this.ViewModel.Preferences.ParticularsDetails):t.push(0),o.a.report.GetCashFlowRpt(t).then(e=>{let t,s={Tables:[],Columns:[]},o=e.Tables[0].ToTable(!0,["PropertyID"]);this.MonthCols=this.CalculateMonths(this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date);let i=this.ViewModel.oReportDialog.FromDate.Date;s.Tables.push([]),s.Columns.push([]),s.Columns[0].push("Property"),s.Columns[0].push("ParticularNodeID");for(let l=0;l<this.ViewModel.ColumnSource.length;l++)this.TempCols.push(this.ViewModel.ColumnSource[l]),"26000"==this.ViewModel.ColumnSource[l].FieldName&&(this.index=l);for(let l=0;l<=this.MonthCols;l++)this.AddColumns(i.toString(),this.GetMonth(i.iMonth())+"-"+i.getFullYear().toString(),"Right",80,"",!1),s.Columns[0].push(i.toString()),i=i.AddMonths(1);this.AddColumns("TotalRow","TOTAL","Right",80,"",!1),s.Columns[0].push("TotalRow");for(let l=0;l<o.length;l++){if(this.CashTotals.Clear(),l>0&&(this.CurrRowsCount=s.Tables[0].length-1,this.FirstRow.push(this.CurrRowsCount)),null!=e&&e.Tables.length>0&&e.Tables[0].length>0){t=e.Tables[0].filter(e=>e.PropertyID==o[l].PropertyID);for(let e=0;e<3;e++)s.Tables[0].push({});s.Tables[0][0+this.CurrRowsCount][0]=t[0].PropertyName.toString(),s.Tables[0][1+this.CurrRowsCount][0]="No of Units to be Renewed",s.Tables[0][2+this.CurrRowsCount][0]="Monthwise Rent to be renewed ";let i=t[0].PropertyId.toString();this.MonthCols>0&&this.GetVacantFlat(this.ViewModel.oReportDialog.FromDate.Date,i,e,this.MonthCols,this.CurrRowsCount,s)}s.Tables[0].push({})}this.index>0&&(this.ViewModel.GrpReportTotal.TotalCols.Remove("Particular"),this.TempCols.RemoveAt(this.index)),this.ViewModel.ReportColumns=this.TempCols,this.oColumns=this.ViewModel.ReportColumns,this.AddReportRows(s,"CashFlow"),this.ViewModel.process_RunWorkerCompleted()})}GetTigerReconRpt(e){this.FirstRow.Clear(),this.FirstRow.push(0);let t=0,s=0,i=0,l=this.ViewModel.oReportDialog.GetSeqNosList(),n=-1,r=[];r.push(this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")),r.push(this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")),r.push(l),r.push(125==e?1:2),o.a.report.GetTigerReconRpt(r).then(e=>{let o={Tables:[],Columns:[]},l=new a.a;this.MonthCols=this.CalculateMonths(this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date);let r=this.ViewModel.oReportDialog.FromDate.Date;o.Tables.push([]),o.Columns.push([]),o.Columns[0].push("Property"),o.Columns[0].push("ParticularNodeID");for(let t=0;t<this.ViewModel.ColumnSource.length;t++)this.TempCols.push(this.ViewModel.ColumnSource[t]),"26000"==this.ViewModel.ColumnSource[t].FieldName&&(this.index=t);for(let t=0;t<=this.MonthCols;t++)this.AddColumns(r.toString(),this.GetMonth(r.Month)+"-"+r.getFullYear().toString(),"Right",80,"",!1),o.Columns[0].push(r.toString()),this.CashTotals.ContainsKey(r.toString())||this.CashTotals.push(r.toString(),0),l.ContainsKey(r.toString())||l.push(r.toString(),0),r=r.AddMonths(1);if(this.AddColumns("TowerTotal","Tower Total","Right",80,"",!1),o.Columns[0].push("TowerTotal"),this.AddColumns("TowerCount","Tower Count","Right",80,"",!1),o.Columns[0].push("TowerCount"),null!=e&&e.Tables.length>0&&e.Tables[0].length>0){let i=e.Tables[0].ToTable(!0,["PropertyID","PropertyName","GroupName"]),a=e.Tables[0].ToTable(!0,["PropertyName"]),r=e.Tables[0],h=this.ViewModel.oReportDialog.FromDate.Date;for(let u=0;u<i.length;u++){t=0,s=0,this.Groupname.Contains(i[u].GroupName.toString())||(u>0&&(o.Tables[0].push({}),n++,o.Tables[0][n][0]="GROUP TOTAL",this.CashTotals.keys.forEach(e=>{l[e]=l[e]+this.CashTotals[e.toString()],o.Tables[0][n][e.toString()]=this.CashTotals[e.toString()].toString(),s+=parseFloat(this.CashTotals[e.toString()])}),o.Tables[0][n].TowerTotal=s.toString(),this.CashTotals.Clear()),this.Groupname.push(i[u].GroupName.toString()),o.Tables[0].push({}),n++,o.Tables[0][n][0]=i[u].GroupName.toString(),this.FirstRow.push(n)),o.Tables[0].push({}),n++,o.Tables[0][n][0]=a[u].PropertyName.toString(),h=this.ViewModel.oReportDialog.FromDate.Date;for(let s=0;s<=this.MonthCols;s++)this.CashTotals.ContainsKey(h.toString())||this.CashTotals.push(h.toString(),0),r=e.Tables[0].filter(e=>e.PropertyID==i[u].PropertyID&&e.monthdate==h.iMonth()+" - "+h.getFullYear()),r.length>0&&(r.length>0&&null!=r[0].Rent?(o.Tables[0][n][h.toString()]=parseInt(r[0].Rent),this.CashTotals[h.toString()]=this.CashTotals[h.toString()]+parseInt(r[0].Rent),t+=parseInt(r[0].Rent)):o.Tables[0][n][h.toString()]=0),h=h.AddMonths(1);if(o.Tables[0][n].TowerTotal=t,null!=e&&e.Tables.length>1&&e.Tables[1].length>0){let t=e.Tables[1].filter(e=>e.PropertyID==i[u].PropertyID);t.length>0&&(o.Tables[0][n].TowerCount=t[0].UnitCount.toString())}}s=0,n>=0&&(o.Tables[0].push({}),n++,o.Tables[0][n][0]="GROUP TOTAL",this.CashTotals.keys.forEach(e=>{l[e]=l[e]+this.CashTotals[e],o.Tables[0][n][e.toString()]=this.CashTotals[e].toString(),s+=parseFloat(this.CashTotals[e.toString()])}),o.Tables[0][n].TowerTotal=s.toString()),o.Tables[0].push({}),n++,o.Tables[0].push({}),n++,o.Tables[0][n][0]="TOTAL"}null!=l&&l.length>0&&(l.keys.forEach(e=>{n>=0&&(o.Tables[0][n][e.toString()]=l[e].toString(),i+=parseFloat(l[e]))}),n>=0&&(o.Tables[0][n].TowerTotal=i.toString())),this.index>0&&(this.ViewModel.GrpReportTotal.TotalCols.Remove("Particular"),this.TempCols.RemoveAt(this.index)),this.ViewModel.ReportColumns=this.TempCols,this.oColumns=this.ViewModel.ReportColumns,this.AddReportRows(o,"TigerRecon"),this.ViewModel.process_RunWorkerCompleted()})}GetVacantFlat(e,t,s,o,i,l){let a=s.Tables[0],n=s.Tables[1];n=s.Tables[1].filter(e=>e.PropertyID==t);let r=n.ToTable(!0,["ParticularName"]),h=n.ToTable(!0,["PARTNODEID"]);n=s.Tables[1];let u,D=0,d=0;D=l.Tables[0].length-1;for(let c=0;c<r.length;c++)l.Tables[0].push({}),l.Tables[0][3+i+c][0]=r[c].ParticularName.toString(),l.Tables[0][3+i+c].ParticularNodeID=h[c].PARTNODEID.toString();d=l.Tables[0].length-1;for(let c=0;c<o;c++){if(u=e.toString(),this.CashTotals.ContainsKey(u)||this.CashTotals.push(u,0),a=s.Tables[0].filter(s=>s.PropertyID==t&&s.monthdate==e.iMonth()+" - "+e.getFullYear()),a.length>0&&(l.Tables[0][1+i][e.toString()]=a.length>0&&null!=a[0].UnitCount?parseInt(a[0].UnitCount):0,a.length>0&&null!=a[0].Rent?(l.Tables[0][2+i][e.toString()]=parseInt(a[0].Rent),this.CashTotals[u]=this.CashTotals[u]+parseInt(a[0].Rent)):l.Tables[0][2+i][e.toString()]=0),n=s.Tables[1].filter(s=>s.PropertyID==t&&s.monthdate==e.iMonth()+" - "+e.getFullYear()),n.length>0){let o=0;for(let a=D;a<d;a++)n=s.Tables[1].filter(s=>s.PropertyID==t&&s.monthdate==e.iMonth()+" - "+e.getFullYear()&&s.PARTNODEID==h[o].PARTNODEID),n.length>0&&(l.Tables[0][3+i+o][e.toString()]=n[0].Rent.toString(),this.CashTotals[u]=this.CashTotals[u]+parseInt(n[0].Rent)),o++}if(0==c&&(l.Tables[0].push({}),this.tempCnt=l.Tables[0].length-1,l.Tables[0].push({}),l.Tables[0].push({}),l.Tables[0][this.tempCnt][0]="Total Cash Inflow",l.Tables[0][this.tempCnt+1][0]="Less tiger Against Liabilities",l.Tables[0][this.tempCnt+2][0]="Staff Flat"),l.Tables[0][this.tempCnt][e.toString()]=this.CashTotals[u].toString(),s.Tables[3].length>0){let o=s.Tables[3].filter(s=>s.PropertyID==t&&s.monthdate==e.iMonth()+" - "+e.getFullYear());o.length>0&&(l.Tables[0][this.tempCnt+1][e.toString()]=o[0].Rent.toString())}if(s.Tables[2].length>0){let o=s.Tables[2].filter(s=>s.PropertyID==t&&s.monthdate==e.iMonth()+" - "+e.getFullYear());o.length>0&&(l.Tables[0][this.tempCnt+2][e.toString()]=o[0].Rent.toString())}if(0==c&&l.Tables[0].push({}),l.Tables[0][this.tempCnt+3][0]="Vacant Flats",s.Tables[4].length>0){let o=s.Tables[4].filter(s=>s.PropertyID==t&&(null==s.monthdate||s.monthdate==e.iMonth()+" - "+e.getFullYear()));if(o.length>0){let t=0;o.forEach(e=>{null!=e.Rent&&(t+=parseFloat(e.Rent))}),l.Tables[0][this.tempCnt+3][e.toString()]=t.toString()}}0==c&&l.Tables[0].push({}),l.Tables[0][this.tempCnt+4][0]="Net Cash Flow";let o=0,r=0,C=0,p=0,T=0;if(o=null!=l.Tables[0][this.tempCnt][e.toString()]&&""!=l.Tables[0][this.tempCnt][e.toString()].toString()?parseFloat(l.Tables[0][this.tempCnt][e.toString()]):0,r=null!=l.Tables[0][this.tempCnt+1][e.toString()]&&""!=l.Tables[0][this.tempCnt+1][e.toString()].toString()?parseFloat(l.Tables[0][this.tempCnt+1][e.toString()]):0,C=null!=l.Tables[0][this.tempCnt+2][e.toString()]&&""!=l.Tables[0][this.tempCnt+2][e.toString()].toString()?parseFloat(l.Tables[0][this.tempCnt+2][e.toString()]):0,l.Tables[0][this.tempCnt+4][e.toString()]=o-r-C,T=o-r-C,0==c&&l.Tables[0].push({}),l.Tables[0][this.tempCnt+5][0]="Last Year Expenses",s.Tables.length>5&&s.Tables[5].length>0){let o=s.Tables[5].filter(s=>s.PropertyID==t&&s.monthdate==e.iMonth()+"-"+e.getFullYear());o.length>0&&(l.Tables[0][this.tempCnt+5][e.toString()]=o[0].Rent.toString())}p=null!=l.Tables[0][this.tempCnt+5][e.toString()]&&"0"!=l.Tables[0][this.tempCnt+5][e.toString()].toString()?parseFloat(l.Tables[0][this.tempCnt+5][e.toString()]):0,0==c&&l.Tables[0].push({}),l.Tables[0][this.tempCnt+6][0]="TOTAL NET CASH FLOW",l.Tables[0][this.tempCnt+6][e.toString()]=T-p,e=e.AddMonths(1)}}GetRentUnitsRpt(){let e,t=0,s=this.ViewModel.oReportDialog.GetSeqNosList(),i=[];i.push(1),this.ViewModel.Preferences.ContainsKey("Data")&&"Assigned"==this.ViewModel.Preferences.Data?i.push(2):i.push(1),i.push(this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")),i.push(this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")),i.push(s),o.a.report.GetRentUnitsRpt(i).then(s=>{let o=s.Tables[0],i=s.Tables[1],l=i;if(0==i.length)return;let a={Tables:[],Columns:[]};a.Tables.push([]),a.Columns.push([]),a.Columns[0].push("Property"),a.Columns[0].push("ParticularNodeID"),(void 0)[s.Columns[0][0]]=-1,(void 0)[s.Columns[0][1]]="TOTAL",o.push(void 0);for(let e=0;e<o.length;e++)a.Columns[0].Contains(o[e][0].toString())||a.Columns[0].push(o[e][0].toString()),a.Columns[0].Contains(o[e][1].toString())||a.Columns[0].push(o[e][1].toString());for(let e=0;e<this.ViewModel.ColumnSource.length;e++)this.TempCols.push(this.ViewModel.ColumnSource[e]),"26000"==this.ViewModel.ColumnSource[e].FieldName&&(this.index=e);let n=i.ToTable(!0,["PropertyID","GroupName"]),r=i.ToTable(!0,["PropertyName"]);t=-1;for(let h=0;h<n.length;h++){this.Groupname.Contains(n[h].GroupName.toString())||(h>0&&(a.Tables[0].push({}),t++,a.Tables[0][t][0]="GROUP TOTAL",this.PartTotals.keys.forEach(e=>{this.PartGroupTotals[e]=this.PartGroupTotals[e]+this.PartTotals[e],a.Tables[0][t][e.toString()]=this.PartTotals[e].toString()}),this.PartTotals.Clear()),this.Groupname.push(n[h].GroupName.toString()),a.Tables[0].push({}),t++,a.Tables[0][t][0]=n[h].GroupName.toString(),this.FirstRow.push(t)),a.Tables[0].push({}),t++,a.Tables[0][t][0]=r[h].PropertyName.toString(),e=0;for(let s=0;s<o.length;s++)l=i.filter(e=>e.UnitTypeID==o[s].NodeID&&e.PropertyID==n[h].PropertyID),l.length>0&&(this.UnitTypeID=parseInt(l[0].UnitTypeID),this.PartTotals.ContainsKey(this.UnitTypeID)||this.PartTotals.push(this.UnitTypeID,0),this.PartGroupTotals.ContainsKey(this.UnitTypeID)||this.PartGroupTotals.push(this.UnitTypeID,0),a.Tables[0][t][o[s].NodeID.toString()]=l[0].UnitCount.toString(),this.PartTotals[this.UnitTypeID]=this.PartTotals[this.UnitTypeID]+parseFloat(l[0].UnitCount),e+=parseFloat(l[0].UnitCount));a.Tables[0][t][-1]=e,this.PartTotals.ContainsKey(-1)||this.PartTotals.push(-1,0),this.PartGroupTotals.ContainsKey(-1)||this.PartGroupTotals.push(-1,0),this.PartTotals[-1]=this.PartTotals[-1]+e}t>=0&&(a.Tables[0].push({}),t++,a.Tables[0][t][0]="GROUP TOTAL",this.PartTotals.keys.forEach(e=>{this.PartGroupTotals[e]=this.PartGroupTotals[e]+this.PartTotals[e],a.Tables[0][t][e.toString()]=this.PartTotals[e].toString()})),a.Tables[0].push({}),t++,this.FirstRow.push(t),a.Tables[0].push({}),t++,a.Tables[0][t][0]="TOTAL",null!=this.PartGroupTotals&&this.PartGroupTotals.length>0&&o.forEach(e=>{this.PartGroupTotals.ContainsKey(parseInt(e.NodeId))&&(this.AddColumns(e.NodeId.toString(),e.Name.toString(),"Right",80,"",!1),this.TempCols[this.TempCols.length-1].DataFormat.DecimalsPoints=0,a.Tables[0][t][e.NodeId.toString()]=this.PartGroupTotals[parseInt(e.NodeId)])}),this.index>0&&(this.ViewModel.GrpReportTotal.TotalCols.Remove("Particular"),this.TempCols.RemoveAt(this.index)),this.ViewModel.ReportColumns=this.TempCols,this.oColumns=this.ViewModel.ReportColumns,this.AddReportRows(a,"RentinUnits"),this.ViewModel.process_RunWorkerCompleted()})}GetRentUnitAmtRpt(){let e=0,t=this.ViewModel.oReportDialog.GetSeqNosList(),s=[];s.push(2),this.ViewModel.Preferences.ContainsKey("Data")&&"Assigned"==this.ViewModel.Preferences.Data?s.push(2):s.push(1),s.push(this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")),s.push(this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")),s.push(t),o.a.report.GetRentUnitsRpt(s).then(t=>{let s=t.Tables[0],o=t.Tables[1],i=o;if(0==o.length)return void this.ViewModel.process_RunWorkerCompleted();let l={Tables:[],Columns:[]};l.Tables.push([]),l.Columns.push([]),l.Columns[0].push("Property"),l.Columns[0].push("ParticularNodeID");for(let e=0;e<s.length;e++)l.Columns[0].Contains(s[e][0].toString())||l.Columns[0].push(s[e][0].toString()),l.Columns[0].Contains(s[e][1].toString())||l.Columns[0].push(s[e][1].toString());for(let e=0;e<this.ViewModel.ColumnSource.length;e++)this.TempCols.push(this.ViewModel.ColumnSource[e]),"26000"==this.ViewModel.ColumnSource[e].FieldName&&(this.index=e);let a=o.ToTable(!0,["PropertyID","GroupName"]),n=o.ToTable(!0,["PropertyName"]);e=-1;for(let r=0;r<a.length;r++){this.Groupname.Contains(a[r].GroupName.toString())||(r>0&&(l.Tables[0].push({}),e++,l.Tables[0][e][0]="GROUP TOTAL",this.PartTotals.keys.forEach(t=>{this.PartGroupTotals[t]=this.PartGroupTotals[t]+this.PartTotals[t],l.Tables[0][e][t.toString()]=this.PartTotals[t].toString()}),this.PartTotals.Clear()),this.Groupname.push(a[r].GroupName.toString()),l.Tables[0].push({}),e++,l.Tables[0][e][0]=a[r].GroupName.toString(),this.FirstRow.push(e)),l.Tables[0].push({}),e++,l.Tables[0][e][0]=n[r].PropertyName.toString();for(let t=0;t<s.length;t++)i=o.filter(e=>e.UnitTypeID==s[t].NodeID&&e.PropertyID==a[r].PropertyID),i.length>0&&(this.UnitTypeID=parseInt(i[0].UnitTypeID),this.PartTotals.ContainsKey(this.UnitTypeID)||this.PartTotals.push(this.UnitTypeID,0),this.PartGroupTotals.ContainsKey(this.UnitTypeID)||this.PartGroupTotals.push(this.UnitTypeID,0),l.Tables[0][e][s[t].NodeID.toString()]=i[0].UnitCount.toString(),this.PartTotals[this.UnitTypeID]=this.PartTotals[this.UnitTypeID]+parseFloat(i[0].UnitCount))}e>=0&&(l.Tables[0].push({}),e++,l.Tables[0][e][0]="GROUP TOTAL",this.PartTotals.keys.forEach(t=>{this.PartGroupTotals[t]=this.PartGroupTotals[t]+this.PartTotals[t],l.Tables[0][e][t.toString()]=this.PartTotals[t].toString()})),l.Tables[0].push({}),e++,this.FirstRow.push(e),l.Tables[0].push({}),e++,l.Tables[0][e][0]="TOTAL",null!=this.PartGroupTotals&&this.PartGroupTotals.length>0&&s.forEach(t=>{this.PartGroupTotals.ContainsKey(parseInt(t.NodeId))&&(this.AddColumns(t.NodeId.toString(),t.Name.toString(),"Right",80,"",!1),l.Tables[0][e][t.NodeId.toString()]=this.PartGroupTotals[parseInt(t.NodeId)])}),this.AddColumns("TotalRow","TOTAL","Right",80,"",!1),l.Columns[0].push("TotalRow"),this.index>0&&(this.ViewModel.GrpReportTotal.TotalCols.Remove("Particular"),this.TempCols.RemoveAt(this.index)),this.ViewModel.ReportColumns=this.TempCols,this.oColumns=this.ViewModel.ReportColumns,this.AddReportRows(l,"RentUnits"),this.ViewModel.process_RunWorkerCompleted()})}GetShareHolders(){let e="";this.ViewModel.Preferences.ContainsKey("PropertyLinkDimension")&&(e=this.GetFilterByDimension_1(parseInt(this.ViewModel.Preferences.PropertyLinkDimension)));let t=this.GetFilterByDimension_1(2);o.a.report.GetRentalReports(168,this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,e,t).then(e=>{let t,s,o,l=e.Tables[0],a=e.Tables[1],r=e.Tables[2],h=r.DefaultView.ToTable(!0,["AccountID","AccountName"]),u=null,D=new Array;for(let i=0;i<this.ViewModel.ColumnSource.length;i++)"Share"!=this.ViewModel.ColumnSource[i].ID?D.push(this.ViewModel.ColumnSource[i]):u=this.ViewModel.ColumnSource[i].Clone();this.ViewModel.TotalCols.Clear(),this.ViewModel.GrpReportTotal.TotalCols.Clear(),this.ViewModel.AddTotalColumnsToGroup(this.ViewModel.GrpReportTotal,this.ViewModel.ReportDoc.SelectSingleNode("PactRevenURpts/PactRevenURptDef/ReportTotal/Columns"));for(let i=0;i<h.length;i++){l.Columns.push(h[i].AccountID.toString()),a.Columns.push(h[i].AccountID.toString());let e=u.Clone();e.HeaderText=h[i].AccountName.toString(),e.ID=h[i].AccountID.toString(),this.ViewModel.TotalCols.push(e.ID),this.ViewModel.GrpReportTotal.TotalCols.push(e.ID,D.length-1),D.push(e)}this.ViewModel.ReportColumns=D,this.oColumns=this.ViewModel.ReportColumns;let d=new Array(this.oColumns.length),c=new Array(this.oColumns.length),C=new Array(this.oColumns.length);for(o=this.NewReportRow_2(n.f.BalanceBF,this.GrossTotalAppearance_Data),o.LevelNo=0,o.Cells[0].CellAppearance=this.GrossTotalAppearance,o.Cells[0].Text="Opening Balance",t=2;t<this.oColumns.length;t++){let e=r.filter(e=>e.AccountID==this.oColumns[t].ID).Compute("sum","OpBalance");null!=e&&(d[t]=parseFloat(e),this.ViewModel.SetCellValue(e,this.oColumns[t].DataFormat,this.oColumns[t].ColumnType,o.Cells[t]))}for(this.ViewModel.addRow(o),t=0;t<l.length;t++){s=parseFloat(l[t].Balance);let e=r.filter(e=>e.PID==l[t].PID);for(let o=0;o<e.length;o++)l[t][e[o].AccountID.toString()]=parseFloat(e[o].Income)*s/100;o=this.NewReportRow(),o.DataRow=l[t];for(let a=0;a<this.oColumns.length;a++)this.CellValue=null,l.Columns.Contains(this.oColumns[a].ID)&&(this.CellValue=l[t][this.oColumns[a].ID]),null!=this.CellValue&&(this.ViewModel.SetCellValue(this.CellValue,this.oColumns[a].DataFormat,this.oColumns[a].ColumnType,o.Cells[a]),s=i.e.Double(this.CellValue),d[a]+=s);-1==this.ViewModel.colSNoIndex||o.IsGroup||(o.Cells[this.ViewModel.colSNoIndex].Value=++this.ViewModel.SNo,o.Cells[this.ViewModel.colSNoIndex].Text=this.ViewModel.SNo.toString()),o.IsGroup||this.ViewModel.ApplyKPI(o),this.ViewModel.addRow(o)}for(o=this.NewReportRow_2(n.f.BalanceBF,this.GrossTotalAppearance_Data),o.LevelNo=0,o.Cells[0].CellAppearance=this.GrossTotalAppearance,o.Cells[0].Text="Net Income",t=0;t<this.oColumns.length;t++)this.ViewModel.TotalCols.Contains(this.oColumns[t].ID)&&this.ViewModel.SetCellValue(d[t],this.oColumns[t].DataFormat,this.oColumns[t].ColumnType,o.Cells[t]);for(this.ViewModel.addRow(o),t=0;t<a.length;t++){s=parseFloat(a[t].Balance);let e=r.filter(e=>e.PID==a[t].PID);for(let o=0;o<e.length;o++)a[t][e[o].AccountID.toString()]=parseFloat(e[o].Expenses)*s/100;for(let o=0;o<this.oColumns.length;o++)"FLOAT"==this.oColumns[o].ColumnType&&l.Columns.Contains(this.oColumns[o].ID)&&null!=a[t][this.oColumns[o].ID]&&(s=i.e.Double(a[t][this.oColumns[o].ID]),c[o]+=s)}for(o=this.NewReportRow(),o.LevelNo=0,o.Cells[0].CellAppearance=this.GrossTotalAppearance,o.Cells[0].Text="Share of Expense",t=0;t<this.oColumns.length;t++)this.ViewModel.TotalCols.Contains(this.oColumns[t].ID)&&this.ViewModel.SetCellValue(c[t],this.oColumns[t].DataFormat,this.oColumns[t].ColumnType,o.Cells[t]);for(this.ViewModel.addRow(o),o=this.NewReportRow(),o.LevelNo=0,o.Cells[0].CellAppearance=this.GrossTotalAppearance,o.Cells[0].Text="Drawings/Payable to Share Holder",t=2;t<this.oColumns.length;t++){let e=r.filter(e=>e.AccountID==this.oColumns[t].ID);e.length>0&&null!=e[0].Balance&&(C[t]=parseFloat(e[0].Balance),this.ViewModel.SetCellValue(e[0].Balance,this.oColumns[t].DataFormat,this.oColumns[t].ColumnType,o.Cells[t]))}for(this.ViewModel.addRow(o),o=this.NewReportRow_2(n.f.BalanceBF,this.GrossTotalAppearance_Data),o.LevelNo=0,o.Cells[0].CellAppearance=this.GrossTotalAppearance,o.Cells[0].Text="Net Payable/Receviable",t=0;t<this.oColumns.length;t++)this.ViewModel.TotalCols.Contains(this.oColumns[t].ID)&&this.ViewModel.SetCellValue(-d[t]+C[t]-c[t],this.oColumns[t].DataFormat,this.oColumns[t].ColumnType,o.Cells[t]);this.ViewModel.addRow(o),this.ViewModel.process_RunWorkerCompleted()})}LoadReportWithPostFilters(e){}LoadReport(){121==this.ViewModel.StaticReportType?this.GetTowerWiseRentAnalysis():122==this.ViewModel.StaticReportType?this.GetCashFlowTowerwise():123==this.ViewModel.StaticReportType?this.GetRentUnitsRpt():124==this.ViewModel.StaticReportType||124==this.ViewModel.StaticReportType?this.GetRentUnitAmtRpt():125==this.ViewModel.StaticReportType?this.GetTigerReconRpt(125):126==this.ViewModel.StaticReportType?this.GetTigerReconRpt(126):168==this.ViewModel.StaticReportType&&this.GetShareHolders()}}},"8GKY":function(e,t,s){"use strict";s.r(t),s.d(t,"DocumentViewerComponent",(function(){return r}));var o=s("3Pt+"),i=s("fXoL"),l=s("ofXK"),a=s("towX");function n(e,t){if(1&e&&(i.Xb(0),i.Wc(1,"\n            "),i.Vb(2,7),i.Wc(3,"\n        "),i.Wb()),2&e){const e=t.$implicit,s=i.lc();i.Db(2),i.tc("obj",e)("group",s.form)}}let r=(()=>{class e{constructor(){this.form=new o.j({})}ngOnInit(){var e;(null===(e=this.params)||void 0===e?void 0:e.obj)&&(this.obj=this.params.obj)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i.Nb({type:e,selectors:[["app-document-viewer"]],inputs:{obj:"obj"},decls:18,vars:1,consts:[[2,"height","100%"],[2,"position","absolute","left","7px","top","48%","cursor","pointer","background-color","var(--menu-bgcolor)","width","30px","height","30px","border-radius","15px",3,"click"],[1,"fa-light","fa-angle-left",2,"font-size","19px","position","absolute","left","0","top","48%","cursor","pointer","color","#fff","left","10px","top","5px"],[2,"position","absolute","right","7px","top","48%","cursor","pointer","background-color","var(--menu-bgcolor)","width","30px","height","30px","border-radius","15px",3,"click"],[1,"fa-light","fa-angle-right",2,"font-size","19px","position","absolute","left","0","top","48%","cursor","pointer","color","#fff","left","10px","top","5px"],[2,"height","calc(100% - 0px)","width","calc(100% - 40px)","margin","auto"],[4,"ngFor","ngForOf"],["ScreenDirective","",3,"obj","group"]],template:function(e,t){1&e&&(i.Zb(0,"div",0),i.Wc(1,"\n    "),i.Zb(2,"span",1),i.hc("click",(function(){return t.obj.OnButtonClick("PREVIOUS")})),i.Wc(3,"\n        "),i.Ub(4,"i",2),i.Wc(5,"\n    "),i.Yb(),i.Wc(6,"\n    "),i.Zb(7,"span",3),i.hc("click",(function(){return t.obj.OnButtonClick("NEXT")})),i.Wc(8,"\n        "),i.Ub(9,"i",4),i.Wc(10,"\n    "),i.Yb(),i.Wc(11,"\n    \n    "),i.Zb(12,"div",5),i.Wc(13,"\n        "),i.Uc(14,n,4,2,"ng-container",6),i.Wc(15,"\n    "),i.Yb(),i.Wc(16,"\n    "),i.Wc(17,"\n"),i.Yb()),2&e&&(i.Db(14),i.tc("ngForOf",t.obj.Screen))},directives:[l.s,a.a],encapsulation:2}),e})()},"Br+L":function(e,t,s){"use strict";s.d(t,"a",(function(){return D}));var o=s("3Pt+"),i=s("fXoL");function l(e,t){if(1&e){const e=i.ac();i.Zb(0,"button",6),i.hc("click",(function(){return i.Ic(e),i.lc().obj.OnButtonClick("ApproveAll")})),i.Wc(1,"Approve All"),i.Yb()}}function a(e,t){if(1&e){const e=i.ac();i.Zb(0,"button",6),i.hc("click",(function(){return i.Ic(e),i.lc().obj.OnButtonClick("RejectAll")})),i.Wc(1,"Reject All"),i.Yb()}}function n(e,t){if(1&e){const e=i.ac();i.Zb(0,"button",6),i.hc("click",(function(){return i.Ic(e),i.lc().obj.OnButtonClick("ApproveAllforward")})),i.Wc(1,"Approve All & forward"),i.Yb()}}function r(e,t){if(1&e){const e=i.ac();i.Zb(0,"button",6),i.hc("click",(function(){return i.Ic(e),i.lc().obj.OnButtonClick("forward")})),i.Wc(1,"Move forward"),i.Yb()}}function h(e,t){if(1&e){const e=i.ac();i.Zb(0,"button",6),i.hc("click",(function(){return i.Ic(e),i.lc().obj.OnButtonClick("SuspendAll")})),i.Wc(1,"Suspend All"),i.Yb()}}function u(e,t){if(1&e){const e=i.ac();i.Zb(0,"button",6),i.hc("click",(function(){return i.Ic(e),i.lc().obj.OnButtonClick("SuspendPR")})),i.Wc(1,"Suspend PR"),i.Yb()}}let D=(()=>{class e{constructor(){this.form=new o.j({})}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i.Nb({type:e,selectors:[["app-approve"]],decls:29,vars:7,consts:[[1,"master-screen",2,"padding-bottom","4px","min-width","400px"],[1,"PACTHeaderFields","dialogSubBody"],[1,"form-group","row","form-row","col-xl-12","col-md-12","col-sm-12","col-xs-12","PACTControl"],["FieldDirective","",3,"obj"],[1,"Pactdailogfooter"],["class","primary-btn-wicon",3,"click",4,"ngIf"],[1,"primary-btn-wicon",3,"click"]],template:function(e,t){1&e&&(i.Zb(0,"div",0),i.Wc(1,"\n    "),i.Zb(2,"div",1),i.Wc(3,"\n        "),i.Zb(4,"div",2),i.Wc(5,"\n            "),i.Vb(6,3),i.Wc(7,"\n        "),i.Yb(),i.Wc(8,"\n    "),i.Yb(),i.Wc(9,"\n    "),i.Zb(10,"div",4),i.Wc(11,"\n      "),i.Zb(12,"div"),i.Wc(13,"\n        "),i.Uc(14,l,2,0,"button",5),i.Wc(15,"\n        "),i.Uc(16,a,2,0,"button",5),i.Wc(17,"\n        "),i.Uc(18,n,2,0,"button",5),i.Wc(19,"\n        "),i.Uc(20,r,2,0,"button",5),i.Wc(21,"\n        "),i.Uc(22,h,2,0,"button",5),i.Wc(23,"\n        "),i.Uc(24,u,2,0,"button",5),i.Wc(25,"\n      "),i.Yb(),i.Wc(26,"\n  "),i.Yb(),i.Wc(27,"\n"),i.Yb(),i.Wc(28,"\n")),2&e&&(i.Db(6),i.tc("obj",t.obj.Remarks),i.Db(8),i.tc("ngIf",t.obj.AppAllVisible),i.Db(2),i.tc("ngIf",t.obj.RejectAllVisible),i.Db(2),i.tc("ngIf",t.obj.ApproveAllforwardVisible),i.Db(2),i.tc("ngIf",t.obj.forwardVisible),i.Db(2),i.tc("ngIf",t.obj.SuspendVisiblity),i.Db(2),i.tc("ngIf",t.obj.SuspendPRVisiblity))},encapsulation:2}),e})()},Cma4:function(e,t,s){"use strict";s.d(t,"a",(function(){return C}));var o=s("Do2H"),i=s("Lp6j"),l=s("eQJW"),a=s("1xwR"),n=s("mvPR"),r=s("vTM8"),h=s("uMy8"),u=s("MCLT");class D{constructor(e,t){this.ShowTotal=!1,this.TotalAtEnd=!1,this.TotalBorder=0,this.Row=e,this.Total=new Array(t).fill(0)}}var d=function(e){return e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal",e[e.Plain=2]="Plain",e}({}),c=function(e){return e[e.None=0]="None",e[e.MonthWise=1]="MonthWise",e[e.YearWise=3]="YearWise",e[e.TagWise=2]="TagWise",e}({});class C extends a.b{constructor(e){super(e),this.Show=c.None,this.k=0,this.BalIndex=0,this.LevelNo=0,this.CountMonths=0,this.ForeignCurrencyID=0,this.CurrencyType=0,this.InActiveStatusID=0,this.GroupTotalIndex=0,this.YTDIndex=0,this.YTD_LYIndex=0,this.BAL_LYIndex=0,this.TotalBudgetIndex=1,this.VariancePercentIndex=1,this.BAL_LMIndex=-1,this.ColumnSize=0,this.AccNameIndex=0,this.TagID=0,this.dbl=0,this.dblTemp=0,this.dblVariance=0,this.lstLevelGroups=new Array,this.IncludeOpeningStock=!1,this.IncludeClosingStock=!1,this.CumulativeByMn=!1,this.ShowForecast=!1,this.GroupTotalsAtEnd=!1,this.GroupTotalsSeperate=!1,this.DontShowSummaryGroupTotals=!1,this.ShowCarryForward=!1,this.ShowNetProfitBeforeAndAfter=!1,this.ClubIncomeExpenseInPlainReport=!1,this.ShowTotalBudget=!1,this.ShowBudget=!1,this.ShowBudgetVariance=!1,this.ShowBudgetVariancePercent=!1,this.ShowAllAccounts=!1,this.AddGrossToVariance=!1,this.IncludeOpeningBalance=!1,this.IsWEF=!1,this.UseWEFNewCode=!1,this.dvYTD=null,this.dvBAL_LM=null,this.dvBAL_LY=null,this.dvYTD_LY=null,this.dvYTDTable=null,this.dvBAL_LMTable=null,this.dvBAL_LYTable=null,this.dvYTD_LYTable=null,this.sbSpaces="",this.ReportFormat=d.Vertical,this.IncomeExpenseHeader=new n.a,this.GroupRowAppearance=new n.a,this.AccountID=0,this.CurrentBudgetID=0,this.PreviousBudgetID=0,this.LocationWhere="",this.dsTree=null,this.dsBudget=null,this.dtAccount=null,this.dtAccOpening=null,this.dtAccountColumns=null,this.dtAccOpeningColumns=null,this.dvPrevBudget=null,this.dvCurrentBudget=null,this.dvPrevBudgetTable=null,this.dvCurrentBudgetTable=null,this.dvPrevBudgetColumns=null,this.dvCurrentBudgetColumns=null,this.dsList=new Array,this.lstTags=new Array,this.dblClosingStock=0,this.dblOpeningStock=0,this.ShowDetailReport=!1,this.ShowDetailReport_Tree=!1,this.ShowAccountWithZeroBalance=!0,this.LastColumn=null,this.TemplateID=0,this.TemplateCCID=0,this.LevelColsCnt=0,this.dtDetails=null,this.DetailRows=new r.c,this.DetailRowsWEFAccounts=new r.c,this.eval=new h.b,this.fldDict=new r.a,this.YearMonthColIDs=new Array,this.lstBorder=new Array,this.lstCustomCols=new Array,this.HideTagWiseBudget=!1,this.HideEmptyDimensions=!1,this.IsTemplateBudget=!1,this.dtRetainedEarning=new r.a,this.dicPeriods=new r.a,this.IncomeExpenseHeader.IsBold=!0,this.IncomeExpenseHeader.FontSize=14,this.IncomeExpenseHeader.ForeColor="#FF00465A",this.IncomeExpenseHeader.BackColor="White",this.IncomeExpenseHeader.FontFamilyName="Arial",this.GroupRowAppearance.IsBold=!1,this.GroupRowAppearance.FontSize=12,this.GroupRowAppearance.ForeColor="#FF00465A",this.GroupRowAppearance.BackColor="White",this.GroupRowAppearance.FontFamilyName="Arial",this.lstBorder.push("None"),this.lstBorder.push("All Borders"),this.lstBorder.push("Bottom Border"),this.lstBorder.push("Up Border"),this.lstBorder.push("Left Border"),this.lstBorder.push("Right Border"),this.lstBorder.push("Double Border Bottom"),this.lstBorder.push("Top and Bottom Border"),this.lstBorder.push("Top and Double Bottom Border"),this.lstBorder.push("Thick Box Border"),this.lstBorder.push("Thick Bottom Border"),this.lstBorder.push("Double Top and Double Bottom Border")}LoadReport(){if(this.GrdRow=-1,this.CountMonths=0,this.Show=c.None,!this.ViewModel.Preferences.ContainsKey("Template"))return;if(!(o.a.SessionManager.Preferences.ContainsKey("Report Template Dimension")&&parseInt(o.a.SessionManager.Preferences["Report Template Dimension"])>5e4))return;if(this.TemplateCCID=parseInt(o.a.SessionManager.Preferences["Report Template Dimension"]),this.TemplateID=parseInt(this.ViewModel.Preferences.Template),this.LevelNo=10,this.ReportFormat=d.Plain,this.ViewModel.Preferences.ContainsKey("IncludeStock")&&(this.IncludeOpeningStock=this.ViewModel.Preferences.IncludeStock.Contains("<OpeningStock />"),this.IncludeClosingStock=this.ViewModel.Preferences.IncludeStock.Contains("<ClosingStock />")),this.PDCInclude=!(!this.ViewModel.Preferences.ContainsKey("IncludePDCs")||"1"!=this.ViewModel.Preferences.IncludePDCs),this.IncludeTerminatedPDC=!this.ViewModel.Preferences.ContainsKey("IncludeTerminatedPDC")||"0"!=this.ViewModel.Preferences.IncludeTerminatedPDC,this.UnPostedDocsInclude=!(!this.ViewModel.Preferences.ContainsKey("IncludeUnPostedDocs")||"1"!=this.ViewModel.Preferences.IncludeUnPostedDocs),this.UnPostedDocsList=this.UnPostedDocsInclude&&this.ViewModel.Preferences.ContainsKey("IncludeUnPostedDocsList")?this.ViewModel.Preferences.IncludeUnPostedDocsList:"",this.IncludeOpeningBalance=!(!this.ViewModel.Preferences.ContainsKey("IncludeOpeningBalance")||"1"!=this.ViewModel.Preferences.IncludeOpeningBalance),this.DateFormat=this.ViewModel.Preferences.ContainsKey("DateFormat")?this.ViewModel.Preferences.DateFormat:"",this.CumulativeByMn=!(!this.ViewModel.Preferences.ContainsKey("CumulativeMnWise")||"1"!=this.ViewModel.Preferences.CumulativeMnWise),this.ForeignCurrencyID=0,this.ViewModel.Preferences.ContainsKey("ForeignCurrency")){let e=new i.f;e.LoadXml("<XML>"+this.ViewModel.Preferences.ForeignCurrency+"</XML>");let t=i.f.SelectSingleNode(e.DocumentElement,"IsChecked");null!=t&&"1"==t.innerHTML&&(t=i.f.SelectSingleNode(e.DocumentElement,"Value"),this.ForeignCurrencyID=parseInt(t.innerHTML))}else if(this.ViewModel.Preferences.ContainsKey("Currency")){let e=new i.f;e.LoadXml("<XML>"+this.ViewModel.Preferences.Currency+"</XML>"),this.CurrencyType=parseInt(i.f.SelectSingleNode(e.DocumentElement,"Type").innerHTML),1==this.CurrencyType?(i.e.IsEmpty(o.a.SessionManager.Preferences.DimensionwiseCurrency)||0==parseInt(o.a.SessionManager.Preferences.DimensionwiseCurrency))&&(this.CurrencyType=0):2==this.CurrencyType&&(this.ForeignCurrencyID=parseInt(i.f.SelectSingleNode(e.DocumentElement,"Value").innerHTML))}if(this.GroupTotalsAtEnd=!(!this.ViewModel.Preferences.ContainsKey("GroupTotalsAtEnd")||"1"!=this.ViewModel.Preferences.GroupTotalsAtEnd),this.GroupTotalsSeperate=!(!this.ViewModel.Preferences.ContainsKey("GroupTotalsSeperate")||"1"!=this.ViewModel.Preferences.GroupTotalsSeperate),this.DontShowSummaryGroupTotals=!(!this.ViewModel.Preferences.ContainsKey("DontShowSummaryGroupTotals")||"1"!=this.ViewModel.Preferences.DontShowSummaryGroupTotals),this.ClubIncomeExpenseInPlainReport=!0,this.ShowCarryForward=!(!this.ViewModel.Preferences.ContainsKey("ShowCarryForward")||"1"!=this.ViewModel.Preferences.ShowCarryForward),this.ShowNetProfitBeforeAndAfter=!(!this.ViewModel.Preferences.ContainsKey("ShowNetProfit")||"BeforeAndAfter"!=this.ViewModel.Preferences.ShowNetProfit),this.ShowAllAccounts=!(!this.ViewModel.Preferences.ContainsKey("ShowAllAccounts")||"1"!=this.ViewModel.Preferences.ShowAllAccounts),this.ShowAccountWithZeroBalance=!(!this.ViewModel.Preferences.ContainsKey("WantAccountsWithZeroBalances")||"1"!=this.ViewModel.Preferences.WantAccountsWithZeroBalances),this.ViewModel.Preferences.ContainsKey("ShowDetailReport"))if("0"==this.ViewModel.Preferences.ShowDetailReport)this.ShowDetailReport=!1;else if("1"==this.ViewModel.Preferences.ShowDetailReport)this.ShowDetailReport=!0;else{let e=new i.f;e.LoadXml("<XML>"+this.ViewModel.Preferences.ShowDetailReport+"</XML>"),"1"==i.f.SelectSingleNodeText(e.DocumentElement,"IsChecked")&&("Tree"==i.f.SelectSingleNodeText(e.DocumentElement,"Value")?this.ShowDetailReport_Tree=!0:this.ShowDetailReport=!0)}this.AddGrossToVariance=!(!this.ViewModel.Preferences.ContainsKey("AddGrossToVariance")||"1"!=this.ViewModel.Preferences.AddGrossToVariance),this.IsWEF="TRUE"==o.a.SessionManager.Preferences.WEFINReportTemplate.toString().toUpperCase(),this.UseWEFNewCode=!(!this.ViewModel.Preferences.ContainsKey("UseWEFNewCode")||"1"!=this.ViewModel.Preferences.UseWEFNewCode),this.ShowBudget=!1,this.ShowBudgetVariance=!1,this.CurrentBudgetID=0,this.PreviousBudgetID=0,this.ViewModel.Preferences.ContainsKey("HideTagWiseBudget")&&"1"==this.ViewModel.Preferences.HideTagWiseBudget&&(this.HideTagWiseBudget=!0),this.ViewModel.Preferences.ContainsKey("CurrentBudget")&&(this.CurrentBudgetID=i.e.Int(this.ViewModel.Preferences.CurrentBudget)),this.ViewModel.Preferences.ContainsKey("PreviousBudget")&&(this.PreviousBudgetID=i.e.Int(this.ViewModel.Preferences.PreviousBudget)),this.ViewModel.Preferences.ContainsKey("ShowActualBudget")&&"1"==this.ViewModel.Preferences.ShowActualBudget&&(this.CurrentBudgetID>0||this.PreviousBudgetID>0)&&(this.ShowBudget=!0),this.ViewModel.Preferences.ContainsKey("ShowVariance")&&"1"==this.ViewModel.Preferences.ShowVariance&&(this.CurrentBudgetID>0||this.PreviousBudgetID>0)&&(this.ShowBudgetVariance=!0),this.ViewModel.Preferences.ContainsKey("ShowVariancePercent")&&"1"==this.ViewModel.Preferences.ShowVariancePercent&&(this.VariancePercentIndex=1==this.ShowBudgetVariance?2:1,(this.CurrentBudgetID>0||this.PreviousBudgetID>0)&&(this.ShowBudgetVariancePercent=!0)),this.ViewModel.Preferences.ContainsKey("ShowTotalBudget")&&"1"==this.ViewModel.Preferences.ShowTotalBudget&&(this.TotalBudgetIndex=1==this.ShowBudget?2:1,(this.CurrentBudgetID>0||this.PreviousBudgetID>0)&&(this.ShowTotalBudget=!0)),this.ShowForecast=this.ViewModel.Preferences.ContainsKey("ShowForecast")&&"1"==this.ViewModel.Preferences.ShowForecast,this.ShowForecast&&this.ShowBudget?(this.ShowBudgetVariance=!1,this.ShowBudgetVariancePercent=!1):this.ShowForecast=!1;{let e="0";this.ViewModel.Preferences.ContainsKey("FinalReportsShow")&&(e=this.ViewModel.Preferences.FinalReportsShow),"1"==e?(this.Show=c.MonthWise,this.ViewModel.oReportDialog.FromDate.Date.getMonth()!=this.ViewModel.oReportDialog.ToDate.Date.getMonth()||this.ViewModel.oReportDialog.FromDate.Date.getFullYear()!=this.ViewModel.oReportDialog.ToDate.Date.getFullYear()||this.ShowForecast||(this.Show=c.None)):"3"==e?(this.Show=c.YearWise,this.ViewModel.oReportDialog.FromDate.Date.getFullYear()==this.ViewModel.oReportDialog.ToDate.Date.getFullYear()&&(this.Show=c.None)):"2"==e&&(this.Show=c.TagWise,this.TagID=parseInt(this.ViewModel.Preferences.FinalReportsShowTag),this.ViewModel.Preferences.ContainsKey("FinalReportsShowTagHideColumns")&&(this.HideEmptyDimensions=!0),this.TagColumnName="Name",this.ViewModel.Preferences.ContainsKey("FinalReportsShowTagColumn")&&("0"==this.ViewModel.Preferences.FinalReportsShowTagColumn?this.TagColumnName="Code":"2"==this.ViewModel.Preferences.FinalReportsShowTagColumn&&(this.TagColumnName="Code+'-'+Name")))}this.Show!=c.MonthWise&&(this.ShowForecast=!1),this.BalIndex=this.YTDIndex=this.YTD_LYIndex=this.BAL_LYIndex=this.BAL_LMIndex=-1;let e=null,t=null,s=null,a=null;for(let o=0;o<this.ViewModel.ColumnSourceALL.length;o++)"Bud_Budget"==this.ViewModel.ColumnSourceALL[o].ID?(s=this.ViewModel.ColumnSourceALL[o].Clone(),s.HeaderAppearance.IsVisible=s.DataAppearance.IsVisible=!0,this.ViewModel.ColumnSourceALL[o].HeaderAppearance.IsVisible=!1):"Bud_TotalBudget"==this.ViewModel.ColumnSourceALL[o].ID?(a=this.ViewModel.ColumnSourceALL[o].Clone(),a.HeaderAppearance.IsVisible=a.DataAppearance.IsVisible=!0,this.ViewModel.ColumnSourceALL[o].HeaderAppearance.IsVisible=!1):"Bud_Variance"==this.ViewModel.ColumnSourceALL[o].ID?(e=this.ViewModel.ColumnSourceALL[o].Clone(),e.HeaderAppearance.IsVisible=e.DataAppearance.IsVisible=!0,this.ViewModel.ColumnSourceALL[o].HeaderAppearance.IsVisible=!1):"Bud_VariancePerc"==this.ViewModel.ColumnSourceALL[o].ID&&(t=this.ViewModel.ColumnSourceALL[o].Clone(),t.HeaderAppearance.IsVisible=t.DataAppearance.IsVisible=!0,this.ViewModel.ColumnSourceALL[o].HeaderAppearance.IsVisible=!1);let D=new Array;for(let o=0;o<this.ViewModel.ColumnSource.length;o++)if(D.push(this.ViewModel.ColumnSource[o].Clone()),"Balance"==this.ViewModel.ColumnSource[o].ID){if(this.BalIndex=D.length-1,this.ShowTotalBudget){let e=null!=a?a.Clone():D[D.length-1].Clone();e.HeaderText="Total Budget",e.ID="TotalBudget",e.DataFormat.NegativeNumber=0,D.Insert(D.length-1,e),this.ViewModel.GrpReportTotal.TotalCols.ContainsKey(e.ID)||this.ViewModel.GrpReportTotal.TotalCols.push(e.ID,this.BalIndex-1),this.BalIndex=this.BalIndex+1}if(this.ShowBudget){let e=null!=s?s.Clone():D[D.length-1].Clone();e.HeaderText="Budget",e.ID="BudgetBalance",e.DataFormat.NegativeNumber=0,D.Insert(D.length-1,e),this.ViewModel.GrpReportTotal.TotalCols.ContainsKey(e.ID)||this.ViewModel.GrpReportTotal.TotalCols.push(e.ID,this.BalIndex-1)}if(this.BalIndex=D.length-1,this.ShowBudgetVariance){let t=null!=e?e.Clone():D[this.BalIndex].Clone();t.HeaderText="Variance",t.ID="VarianceBalance",t.DataFormat.NegativeNumber=0,D.push(t)}if(this.ShowBudgetVariancePercent){let e=null!=t?t.Clone():D[this.BalIndex].Clone();e.DataFormat.PercentageOn="BudgetBalance",e.HeaderText="Variance %",e.ID="PercentVarianceBalance",e.DataFormat.NegativeNumber=0,D.push(e)}}else if("YTD"==this.ViewModel.ColumnSource[o].ID){if(this.ShowBudget){let e=null!=s?s.Clone():D[D.length-1].Clone();e.HeaderText="Budget",e.ID="BudgetYTD",e.DataFormat.NegativeNumber=0,D.Insert(D.length-1,e)}if(this.YTDIndex=D.length-1,this.ShowBudgetVariance){let t=null!=e?e.Clone():D[this.YTDIndex].Clone();t.HeaderText="Variance",t.ID="VarianceYTD",t.DataFormat.NegativeNumber=0,D.push(t)}if(this.ShowBudgetVariancePercent){let e=null!=t?t.Clone():D[this.YTDIndex].Clone();e.DataFormat.PercentageOn="BudgetYTD",e.HeaderText="Variance %",e.ID="PercentVarianceYTD",e.DataFormat.NegativeNumber=0,D.push(e)}}else if("LastMonthBalance"==this.ViewModel.ColumnSource[o].ID)this.BAL_LMIndex=D.length-1;else if("LastYearBalance"==this.ViewModel.ColumnSource[o].ID){if(this.ShowBudget){let e=null!=s?s.Clone():D[D.length-1].Clone();e.HeaderText="Budget",e.ID="BudgetLastYearBalance",e.DataFormat.NegativeNumber=0,D.Insert(D.length-1,e)}if(this.BAL_LYIndex=D.length-1,this.ShowBudgetVariance){let t=null!=e?e.Clone():D[this.BAL_LYIndex].Clone();t.HeaderText="Variance",t.ID="VarianceLastYearBalance",t.DataFormat.NegativeNumber=0,D.push(t)}if(this.ShowBudgetVariancePercent){let e=null!=t?t.Clone():D[this.BAL_LYIndex].Clone();e.DataFormat.PercentageOn="BudgetLastYearBalance",e.HeaderText="Variance %",e.ID="PercentVarianceLastYearBalance",e.DataFormat.NegativeNumber=0,D.push(e)}}else if("LastYearYTD"==this.ViewModel.ColumnSource[o].ID){if(this.ShowBudget){let e=null!=s?s.Clone():D[D.length-1].Clone();e.HeaderText="Budget",e.ID="BudgetLastYearYTD",e.DataFormat.NegativeNumber=0,D.Insert(D.length-1,e)}if(this.YTD_LYIndex=D.length-1,this.ShowBudgetVariance){let t=null!=e?e.Clone():D[this.YTD_LYIndex].Clone();t.HeaderText="Variance",t.ID="VarianceLastYearYTD",t.DataFormat.NegativeNumber=0,D.push(t)}if(this.ShowBudgetVariancePercent){let e=null!=t?t.Clone():D[this.YTD_LYIndex].Clone();e.DataFormat.PercentageOn="BudgetLastYearYTD",e.HeaderText="Variance %",e.ID="PercentVarianceLastYearYTD",e.DataFormat.NegativeNumber=0,D.push(e)}}if(this.AccNameIndex=this.BalIndex>0?this.BalIndex-1:0,this.ShowBudget&&this.AccNameIndex--,this.ReportFormat==d.Plain&&(this.ClubIncomeExpenseInPlainReport?this.GroupTotalIndex=this.ViewModel.ColumnSource.length:(this.GroupTotalIndex=this.ViewModel.ColumnSource.length+1,D.push(this.ViewModel.ColumnSource[this.BalIndex].Clone()))),this.GroupTotalsSeperate){let e=this.ViewModel.ColumnSource[this.BalIndex].Clone();e.HeaderText="TOTAL",D.Insert(this.BalIndex+1,e),-1!=this.YTDIndex&&this.YTDIndex++,-1!=this.BAL_LMIndex&&this.BAL_LMIndex++,-1!=this.BAL_LYIndex&&this.BAL_LYIndex++,-1!=this.YTD_LYIndex&&this.YTD_LYIndex++}this.ColumnSize=D.length;let C=new r.a;if(this.ForeCastStart=this.ViewModel.oReportDialog.FromDate.Date,this.ForeCastEnd=this.ViewModel.oReportDialog.ToDate.Date,this.ShowForecast&&(this.ForeCastStart=new Date(this.ViewModel.oReportDialog.FromDate.Date.getFullYear(),this.ViewModel.oReportDialog.FromDate.Date.getMonth(),1),this.ForeCastEnd=new Date(this.ViewModel.oReportDialog.ToDate.Date.getFullYear(),this.ViewModel.oReportDialog.ToDate.Date.getMonth(),1),this.ForeCastEnd=this.ForeCastEnd.AddMonths(1).AddDays(-1),this.ForeCastEnd<this.ForeCastStart.AddYears(1).AddDays(-1)&&(this.ForeCastEnd=this.ForeCastStart.AddYears(1).AddDays(-1)),this.ForeCastStart=new Date(this.ViewModel.oReportDialog.ToDate.Date.getFullYear(),this.ViewModel.oReportDialog.ToDate.Date.getMonth(),1),this.ForeCastStart=this.ForeCastStart.AddMonths(1)),this.Show==c.MonthWise){let o=new Date(this.ViewModel.oReportDialog.FromDate.Date.getFullYear(),this.ViewModel.oReportDialog.FromDate.Date.getMonth(),1),i=D[D.length-1];for(-1!=this.BalIndex&&(i=D[this.BalIndex]);o<=this.ForeCastEnd;){let l=i.Clone();if(this.Show==c.MonthWise?(l.HeaderText=o.ToString("MMM yy"),l.ID="Y"+o.getFullYear()+"M"+o.iMonth(),this.YearMonthColIDs.push(l.ID)):(l.HeaderText=o.ToString("yyyy"),l.ID="Y"+o.getFullYear()),this.ShowForecast&&o>this.ViewModel.oReportDialog.ToDate.Date&&(l.HeaderAppearance.IsVisible=!1),D.push(l),++this.CountMonths,this.ShowBudget&&!this.HideTagWiseBudget){let e=null!=s?s.Clone():i.Clone();e.HeaderText="Budget-"+l.HeaderText,e.ID="Budget"+l.ID,this.ShowForecast&&o<=this.ViewModel.oReportDialog.ToDate.Date&&(e.HeaderAppearance.IsVisible=!1),D.Insert(D.length-1,e),++this.CountMonths}if(this.ShowBudgetVariance&&!this.HideTagWiseBudget){let t=null!=e?e.Clone():i.Clone();t.HeaderText="Variance-"+l.HeaderText,t.ID="Variance"+l.ID,D.push(t),++this.CountMonths}if(this.ShowBudgetVariancePercent&&!this.HideTagWiseBudget){let e=null!=t?t.Clone():i.Clone();e.DataFormat.PercentageOn=l.ID,e.HeaderText="Variance %-"+l.HeaderText,e.ID="PercentVariance"+l.ID,D.push(e),++this.CountMonths}o=this.Show==c.MonthWise?o.AddMonths(1):o.AddYears(1),C.push(l.ID,o)}}else if(this.Show==c.YearWise){this.HideTagWiseBudget=!0;let l,a,n=D[D.length-1];-1!=this.BalIndex&&(n=D[this.BalIndex]),o.a.report.DataSet("RPT022","declare @From float,@To float\nset @From=convert(float,convert(datetime,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))\nset @To=convert(float,convert(datetime,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))\nselect CONVERT(DATETIME,FromDate) FromDate,CONVERT(DATETIME,ToDate) ToDate from ADM_FinancialYears with(nolock)\nwhere (FromDate>=@From and ToDate<=@To) or (@From>=FromDate and @From<=ToDate) or (@To>=FromDate and @To<=ToDate)\norder by FromDate").Tables[0].forEach(o=>{l=new Date(o.FromDate),a=new Date(o.ToDate);let r=n.Clone();if(l.getFullYear()==a.getFullYear()?(r.ID="Y"+l.getFullYear()+"M"+l.iMonth(),r.HeaderText=l.getFullYear().toString()):(r.ID="Y"+l.getFullYear()+"M"+l.iMonth(),r.HeaderText=i.e.IsEmptySpace(this.DateFormat)?l.getFullYear()+"-"+a.getFullYear().toString().substr(2):l.ToString(this.DateFormat)+"-"+a.ToString(this.DateFormat)),this.YearMonthColIDs.push(r.ID),C.push(r.ID,a),D.push(r),++this.CountMonths,this.ShowBudget&&!this.HideTagWiseBudget){let e=null!=s?s.Clone():r.Clone();e.HeaderText="Budget-"+r.HeaderText,e.ID="Budget"+r.ID,D.Insert(D.length-1,e),++this.CountMonths}if(this.ShowBudgetVariance&&!this.HideTagWiseBudget){let t=null!=e?e.Clone():r.Clone();t.HeaderText="Variance-"+r.HeaderText,t.ID="Variance"+r.ID,D.push(t),++this.CountMonths}if(this.ShowBudgetVariancePercent&&!this.HideTagWiseBudget){let e=null!=t?t.Clone():r.Clone();e.DataFormat.PercentageOn=r.ID,e.HeaderText="Variance %-"+r.HeaderText,e.ID="PercentVariance"+r.ID,D.push(e),++this.CountMonths}this.lstTags.push(r.ID)})}else if(this.Show==c.TagWise){let i=D[D.length-1];-1!=this.BalIndex&&(i=D[this.BalIndex]);let l=this.GetTagWiseQuery(this.TagID,this.TagColumnName,"Name");o.a.report.DataSet("RPT022",l).Tables[0].forEach(o=>{let l=i.Clone();if(l.HeaderText=o.Name.toString(),l.ID=o.NodeID.toString(),D.push(l),++this.CountMonths,this.ShowBudget&&!this.HideTagWiseBudget){let e=null!=s?s.Clone():l.Clone();e.HeaderText="Budget-"+l.HeaderText,e.ID="Budget"+l.ID,D.Insert(D.length-1,e),++this.CountMonths}if(this.ShowBudgetVariance&&!this.HideTagWiseBudget){let t=null!=e?e.Clone():l.Clone();t.HeaderText="Variance-"+l.HeaderText,t.ID="Variance"+l.ID,D.push(t),++this.CountMonths}if(this.ShowBudgetVariancePercent&&!this.HideTagWiseBudget){let e=null!=t?t.Clone():l.Clone();e.DataFormat.PercentageOn=l.ID,e.HeaderText="Variance %-"+l.HeaderText,e.ID="PercentVariance"+l.ID,D.push(e),++this.CountMonths}this.lstTags.push(l.ID)})}if(this.ViewModel.Preferences.ContainsKey("PLRepeatColsTotal")&&this.Show!=c.None&&-1!=this.BalIndex){let e=this.BalIndex,t=this.BalIndex;this.ShowTotalBudget&&e--,this.ShowBudget&&e--,this.ShowBudgetVariance&&t++,this.ShowBudgetVariancePercent&&t++;for(let s=0;s<=t-e;s++){var p=D[e];D.RemoveAt(e),D.push(p)}this.ColumnSize-=t-e+1}this.oColumns=D,this.LocationWhere="",this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(this.LocationWhere=i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),this.dsList.Clear();let T="";this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(T=i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?"-1":this.ViewModel.oReportDialog.LocationWhere),this.arrPromise=new r.a,this.IncludeOpeningStock&&this.arrPromise.push("dblOpeningStock",o.a.report.GetStockBalance(1,T,this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,this.UnPostedDocsInclude,this.CurrencyType,this.ForeignCurrencyID,this.ViewModel.IsReportDB)),this.IncludeClosingStock&&this.arrPromise.push("dblClosingStock",o.a.report.GetStockBalance(0,T,this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,this.UnPostedDocsInclude,this.CurrencyType,this.ForeignCurrencyID,this.ViewModel.IsReportDB)),this.SetDataSet().then(e=>{i.e.IsEmptySpace(this.DateFormat)||this.Show!=c.None||(-1!=this.BalIndex&&(this.IncludeOpeningBalance?D[this.BalIndex].HeaderText+=" "+this.ViewModel.oReportDialog.ToDate.Date.ToString(this.DateFormat):(D[this.BalIndex].HeaderText+=" "+this.ViewModel.oReportDialog.FromDate.Date.ToString(this.DateFormat),this.ViewModel.oReportDialog.FromDate.Date.getFullYear()==this.ViewModel.oReportDialog.ToDate.Date.getFullYear()&&this.ViewModel.oReportDialog.FromDate.Date.getMonth()==this.ViewModel.oReportDialog.ToDate.Date.getMonth()||(D[this.BalIndex].HeaderText+="-"+this.ViewModel.oReportDialog.ToDate.Date.ToString(this.DateFormat)))),-1!=this.YTDIndex&&(D[this.YTDIndex].HeaderText+=this.IncludeOpeningBalance?" "+this.ViewModel.oReportDialog.ToDate.Date.ToString(this.DateFormat):" "+this.dtYearStart.ToString(this.DateFormat)+"-"+this.ViewModel.oReportDialog.ToDate.Date.ToString(this.DateFormat)),-1!=this.BAL_LMIndex&&(D[this.BAL_LMIndex].HeaderText+=" "+this.ViewModel.oReportDialog.FromDate.Date.AddMonths(-1).ToString(this.DateFormat)),-1!=this.BAL_LYIndex&&(this.IncludeOpeningBalance?D[this.BAL_LYIndex].HeaderText+=" "+this.ViewModel.oReportDialog.ToDate.Date.AddYears(-1).ToString(this.DateFormat):(D[this.BAL_LYIndex].HeaderText+=" "+this.ViewModel.oReportDialog.FromDate.Date.AddYears(-1).ToString(this.DateFormat),this.ViewModel.oReportDialog.FromDate.Date.getFullYear()==this.ViewModel.oReportDialog.ToDate.Date.getFullYear()&&this.ViewModel.oReportDialog.FromDate.Date.getMonth()==this.ViewModel.oReportDialog.ToDate.Date.getMonth()||(D[this.BAL_LYIndex].HeaderText+="-"+this.ViewModel.oReportDialog.ToDate.Date.AddYears(-1).ToString(this.DateFormat)))),-1!=this.YTD_LYIndex&&(D[this.YTD_LYIndex].HeaderText+=this.IncludeOpeningBalance?" "+this.ViewModel.oReportDialog.ToDate.Date.AddYears(-1).ToString(this.DateFormat):" "+this.dtYearStart.AddYears(-1).ToString(this.DateFormat)+"-"+this.ViewModel.oReportDialog.ToDate.Date.AddYears(-1).ToString(this.DateFormat))),this.ViewModel.ReportColumns=D,this.ShowDetailReport_Tree&&this.dsTree.Tables[0].forEach(e=>{Object(l.j)(e.IsGroup)||(e.ShowDetail=!0)}),this.dsTree.Columns[0].push("Balance"),this.dsTree.Columns[1].push("IsRead");let t=0;for(t=0;t<this.dtAccountColumns.length&&this.dtAccountColumns[t]!=this.LastColumn;t++);for(;t<this.dtAccountColumns.length;t++)this.dsTree.Columns[0].push(this.dtAccountColumns[t]);let s=!1;if(this.oColumns.forEach(e=>{33!=e.ID.length||i.e.IsEmpty(e.Formula)||(s=!0,e.Formula=e.Formula.Replace("Bud_",""),this.dsTree.Columns[0].Contains(e.ID)||(this.dsTree.Columns[0].push(e.ID),this.dsTree.Columns[2].push(e.ID)))}),s){this.ViewModel.ConstructFormulaFields(!1);var o=[];this.ViewModel.fldDict.keys.filter(e=>e.startsWith("Bud_")).forEach(e=>{o.push({Key:e,Value:this.ViewModel.fldDict[e]})});for(let e=0;e<o.length;e++)this.ViewModel.fldDict.push(o[e].Key.Replace("Bud_",""),o[e].Value),this.ViewModel.fldDict.Remove(o[e].Key);this.ViewModel.fldDict.ContainsKey("BudgetBalance")||this.ViewModel.fldDict.push("BudgetBalance",new h.c("BudgetBalance",0))}let a,r,d,p,T,_,m,I,R=!1,S=!1,A=0,M=0,g=0,w=0,E=0;if(this.dtDetails=[],this.eval.ThrowException=!1,this.eval.SetKeyWords("REPORT"),this.IsWEF){let e,t=new Array(this.oColumns.length).fill(0),s=0;this.dsTree.Columns[1].push("TOWEF"),this.dsTree.Columns[2].push("WEFDate"),this.dsTree.Columns[2].push("WEFBalance"),this.dsTree.Tables[2].forEach(e=>{this.strTemp=e.WEFMn.toString(),e.WEFBalance=e.Balance,this.strTemp.length>0&&(e.WEFDate=new Date(parseInt(this.strTemp.substr(1,4)),parseInt(this.strTemp.substr(6)),1))}),this.dicPeriods.push("Balance",[this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date]),this.dicPeriods.push("YTD",[this.dtYearStart,this.ViewModel.oReportDialog.ToDate.Date]),this.dicPeriods.push("LastYearBalance",[this.ViewModel.oReportDialog.FromDate.Date.AddYears(-1),this.ViewModel.oReportDialog.ToDate.Date.AddYears(-1)]),this.dicPeriods.LastYearBalance[1].Subtract(this.dicPeriods.LastYearBalance[0]).TotalDays>366&&(this.dicPeriods.LastYearBalance[1]=this.ViewModel.oReportDialog.FromDate.Date.AddDays(-1)),this.dicPeriods.push("LastYearYTD",[this.dtYearStart.AddYears(-1),this.ViewModel.oReportDialog.ToDate.Date.AddYears(-1)]);let o=new Date(this.ViewModel.oReportDialog.FromDate.Date.getFullYear(),this.ViewModel.oReportDialog.FromDate.Date.getMonth(),1);if(o=o.AddMonths(-1),this.dicPeriods.push("LastMonthBalance",[o,o.AddMonths(1).AddDays(-1)]),this.UseWEFNewCode){for(let e=0;e<this.dsTree.Tables[1].length;e++)this.AccountID=parseInt(this.dsTree.Tables[1][e].AccountID),this.AccountID!=s?s=this.AccountID:null!=this.dsTree.Tables[1][e].WEF&&this.dsTree.Tables[1][e-1].RTGroup.toString()==this.dsTree.Tables[1][e].RTGroup.toString()&&(this.dsTree.Tables[1][e-1].TOWEF=new Date(this.dsTree.Tables[1][e].WEF).AddDays(-1));this.Show==c.MonthWise?C.keys.forEach(e=>{this.dicPeriods.push(e,[C[e].AddMonths(-1),C[e].AddDays(-1)])}):this.Show==c.YearWise&&C.keys.forEach(e=>{this.dicPeriods.push(e,[C[e].AddYears(-1).AddDays(1),C[e]])});for(let o=0;o<this.dsTree.Tables[0].length;o++){let i=this.dsTree.Tables[0][o];a=Object(l.j)(i.IsGroup),A=parseInt(i.Depth),d=i.Name.toString().Replace(" ",""),R="Show Opening"==i.Opening.toString(),r=!this.ShowDetailReport&&"True"==i.ShowDetail.toString();let n=R||this.IncludeOpeningBalance;if(this.fldObj=new h.c,this.fldObj.setFieldDetails(d,3,1,"",0,!1,!1),this.fldDict.ContainsKey(d))return this.ViewModel.DisplayMessage="Dulpicate Template Node : "+i.Name.toString(),void this.ViewModel.process_RunWorkerCompleted();if(this.fldDict.push(d,this.fldObj),!a){M=parseInt(i.NodeID);let o=this.dsTree.Tables[1].filter(e=>Object(u.isNullOrUndefined)(e.IsRead)&&(e.DrNodeID==i.NodeID||e.CrNodeID==i.NodeID));for(let a=0;a<o.length;a++){let h=o[a];h.IsRead=1,_=Object(l.j)(h.IsGroup)?this.dtAccount.filter(e=>e.IsGroup=0):this.dtAccount.filter(e=>e.AccountID==h.AccountID),g=parseInt(h.DrNodeID),w=parseInt(h.CrNodeID);let u=[],D=[];0!=w&&w!=M?u=this.dsTree.Tables[0].filter(e=>e.NodeID==w):0!=g&&g!=M&&(D=this.dsTree.Tables[0].filter(e=>e.NodeID==g));let d=null,C=null;null!=h.WEF&&(d=new Date(h.WEF)),null!=h.TOWEF&&(C=new Date(h.TOWEF)),s=0;for(let o=0;o<_.length;o++){for(let e=0;e<this.oColumns.length;e++)t[e]=0;let l=_[o];s=parseInt(_[o].AccountID);for(let i=0;o<_.length;o++,i++){let i=_[o];if(this.AccountID=parseInt(i.AccountID),this.AccountID!=s)break;if(null==i.WEFDate)continue;let l=new Date(i.WEFDate);for(this.k=0;this.k<this.oColumns.length;this.k++){let s=this.oColumns[this.k];if(p=s.ID,"FLOAT"==s.ColumnType&&null!=i.WEFBalance&&(e=parseFloat(i.WEFBalance),0!=e))if(n){if(this.Show==c.TagWise&&"Balance"!=p&&"LastYearBalance"!=p&&"LastYearYTD"!=p&&"YTD"!=p&&"LastMonthBalance"!=p){if(i.Mn.toString()!=p)continue;p="Balance"}l<this.dicPeriods[p][0]?(!C||C>=this.dicPeriods[p][0]&&this.dicPeriods[p][0]<=this.dicPeriods[p][1])&&(!d||d<=this.dicPeriods[p][0])&&(t[this.k]+=parseFloat(i.WEFBalance)):l<=this.dicPeriods[p][1]&&(d?C?(l>=d||d<=this.dicPeriods[p][0])&&l<=C&&(t[this.k]+=parseFloat(i.WEFBalance)):(l>=d||d<=this.dicPeriods[p][0])&&(t[this.k]+=parseFloat(i.WEFBalance)):C?C>=this.dicPeriods[p][0]&&C<=this.dicPeriods[p][1]&&l<=C&&(t[this.k]+=parseFloat(i.WEFBalance)):t[this.k]+=parseFloat(i.WEFBalance))}else{if(this.Show==c.TagWise&&"Balance"!=p&&"LastYearBalance"!=p&&"LastYearYTD"!=p&&"YTD"!=p&&"LastMonthBalance"!=p){if(i.Mn.toString()!=p)continue;p="Balance"}if(l<this.dicPeriods[p][0])continue;l<=this.dicPeriods[p][1]&&(d?C?(l>=d||d<=this.dicPeriods[p][0])&&l<=C&&(t[this.k]+=parseFloat(i.WEFBalance)):(l>=d||d<=this.dicPeriods[p][0])&&(t[this.k]+=parseFloat(i.WEFBalance)):C?C>=this.dicPeriods[p][0]&&C<=this.dicPeriods[p][1]&&l<=C&&(t[this.k]+=parseFloat(i.WEFBalance)):t[this.k]+=parseFloat(i.WEFBalance))}}}let a=null,h=!1,m=!1;for(this.k=0;this.k<this.oColumns.length;this.k++)if("FLOAT"==this.oColumns[this.k].ColumnType&&(p=this.oColumns[this.k].ID,(this.ShowAccountWithZeroBalance||0!=parseFloat(t[this.k].ToString("N"+this.oColumns[this.k].DataFormat.DecimalsPoints)))&&(T=null,E=M,m=r,t[this.k]<0&&0!=w&&w!=M?u.length>0&&(T=u[0],E=w,m=!this.ShowDetailReport&&"True"==u[0].ShowDetail.toString()):t[this.k]>0&&0!=g&&g!=M&&D.length>0&&(T=D[0],E=g,m=!this.ShowDetailReport&&"True"==D[0].ShowDetail.toString()),null==T&&(T=i),T[p]=null==T[p]?t[this.k]:parseFloat(T[p])+t[this.k],this.ShowDetailReport||m)))if(this.DetailRows.ContainsKey(E)||(this.DetailRows.push(E,new Array),this.DetailRowsWEFAccounts.push(E,new Array)),this.DetailRowsWEFAccounts[E].Contains(s)){let e=this.DetailRowsWEFAccounts[E].indexOf(s);a=this.DetailRows[E][e],a[p]=h||0==t[this.k]||null==a[p]?t[this.k]:parseFloat(a[p])+t[this.k]}else{a={};for(let e=0;e<this.dtAccountColumns.length;e++)a[this.dtAccountColumns[e]]=l[this.dtAccountColumns[e]];for(let e=0;e<this.oColumns.length;e++)"FLOAT"==this.oColumns[e].ColumnType&&(a[this.oColumns[e].ID]=null);a[p]=t[this.k],h=!0,this.DetailRows[E].push(a),this.DetailRowsWEFAccounts[E].push(s)}}}}}}else{for(let e=0;e<this.dsTree.Tables[1].length;e++)this.AccountID=parseInt(this.dsTree.Tables[1][e].AccountID),this.AccountID!=s?s=this.AccountID:null!=this.dsTree.Tables[1][e].WEF&&(this.dsTree.Tables[1][e-1].TOWEF=new Date(this.dsTree.Tables[1][e].WEF).AddDays(-1));this.Show==c.MonthWise?C.keys.forEach(e=>{this.dicPeriods.push(e,[C[e].AddMonths(-1),C[e].AddDays(-1)])}):this.Show==c.YearWise&&C.keys.forEach(e=>{this.dicPeriods.push(e,[C[e].AddYears(-1),C[e]])});for(let n=0;n<this.dsTree.Tables[0].length;n++){let D=this.dsTree.Tables[0][n];if(a=Object(l.j)(D.IsGroup),A=parseInt(D.Depth),d=D.Name.toString().Replace(" ",""),R="Show Opening"==D.Opening.toString(),r=!this.ShowDetailReport&&"True"==D.ShowDetail.toString(),R||this.IncludeOpeningBalance?(this.dicPeriods.Balance[0]=new Date(1900,0,1),this.dicPeriods.YTD[0]=this.dicPeriods.Balance[0],this.dicPeriods.LastYearBalance[0]=this.dicPeriods.Balance[0],this.dicPeriods.LastYearYTD[0]=this.dicPeriods.Balance[0],this.dicPeriods.LastMonthBalance[0]=this.dicPeriods.Balance[0],C.keys.forEach(e=>{this.dicPeriods[e][0]=new Date(1900,0,1)})):(this.dicPeriods.Balance[0]=this.ViewModel.oReportDialog.FromDate.Date,this.dicPeriods.YTD[0]=this.dtYearStart,this.dicPeriods.LastYearBalance[0]=this.ViewModel.oReportDialog.FromDate.Date.AddYears(-1),this.dicPeriods.LastYearYTD[0]=this.dtYearStart.AddYears(-1),this.dicPeriods.LastMonthBalance[0]=o),this.fldObj=new h.c,this.fldObj.setFieldDetails(d,3,1,"",0,!1,!1),this.fldDict.ContainsKey(d))return void(this.ViewModel.DisplayMessage="Dulpicate Template Node : "+D.Name.toString());if(this.fldDict.push(d,this.fldObj),!a){M=parseInt(D.NodeID);let o=this.dsTree.Tables[1].filter(e=>Object(u.isNullOrUndefined)(e.IsRead)&&(e.DrNodeID==D.NodeID||e.CrNodeID==D.NodeID));for(let a=0;a<o.length;a++){let n=o[a];n.IsRead=1,_=Object(l.j)(n.IsGroup)?this.dtAccount.filter(e=>e.IsGroup=0):this.dtAccount.filter(e=>e.AccountID==n.AccountID),g=parseInt(n.DrNodeID),w=parseInt(n.CrNodeID);let h=[],u=[];0!=w&&w!=M?h=this.dsTree.Tables[0].filter(e=>e.NodeID==w):0!=g&&g!=M&&(u=this.dsTree.Tables[0].filter(e=>e.NodeID==g));let d=null,C=null;null!=n.WEF&&(d=new Date(n.WEF)),null!=n.TOWEF&&(C=new Date(n.TOWEF)),s=0;for(let o=0;o<_.length;o++){for(let e=0;e<this.oColumns.length;e++)t[e]=0;let l=_[o];s=parseInt(_[o].AccountID);for(let i=0;o<_.length;o++,i++){let i=_[o];if(this.AccountID=parseInt(i.AccountID),this.AccountID!=s)break;if(!i.WEFDate)continue;let l=new Date(i.WEFDate);for(this.k=0;this.k<this.oColumns.length;this.k++){let s=this.oColumns[this.k];if(p=s.ID,"FLOAT"==s.ColumnType&&i.WEFBalance&&(e=parseFloat(i.WEFBalance),0!=e))if("LastYearBalance"==p||"LastYearYTD"==p||"YTD"==p||"LastMonthBalance"==p)l<this.dicPeriods[p][0]?(R||this.IncludeOpeningBalance)&&(t[this.k]+=parseFloat(i.WEFBalance)):l<=this.dicPeriods[p][1]&&(d?l>=d&&(!C||l<=C)&&(t[this.k]+=parseFloat(i.WEFBalance)):(!C||l<=C)&&(t[this.k]+=parseFloat(i.WEFBalance)));else{if("Balance"!=p&&this.Show!=c.None)if(i.Mn.toString()!=p){if(!R&&!this.IncludeOpeningBalance||this.Show==c.TagWise)continue}else(R||this.IncludeOpeningBalance)&&this.Show!=c.TagWise||(p="Balance");l<this.dicPeriods[p][0]?(R||this.IncludeOpeningBalance)&&(t[this.k]+=parseFloat(i.WEFBalance)):l<=this.dicPeriods[p][1]&&(d?l>=d&&(!C||l<=C)&&(t[this.k]+=parseFloat(i.WEFBalance)):(!C||l<=C)&&(t[this.k]+=parseFloat(i.WEFBalance)))}}}let a=null,n=!1,m=!1;for(this.k=0;this.k<this.oColumns.length;this.k++)if("FLOAT"==this.oColumns[this.k].ColumnType&&(p=this.oColumns[this.k].ID,(this.ShowAccountWithZeroBalance||0!=parseFloat(t[this.k].ToString("N"+this.oColumns[this.k].DataFormat.DecimalsPoints)))&&(T=null,E=M,m=r,t[this.k]<0&&0!=w&&w!=M?h.length>0&&(T=h[0],E=w,m=!this.ShowDetailReport&&"True"==h[0].ShowDetail.toString()):t[this.k]>0&&0!=g&&g!=M&&u.length>0&&(T=u[0],E=g,m=!this.ShowDetailReport&&"True"==u[0].ShowDetail.toString()),null==T&&(T=D),T[p]=i.e.Double(T[p])+t[this.k],this.ShowDetailReport||m)))if(this.DetailRows.ContainsKey(E)||(this.DetailRows.push(E,new Array),this.DetailRowsWEFAccounts.push(E,new Array)),this.DetailRowsWEFAccounts[E].Contains(s)){let e=this.DetailRowsWEFAccounts[E].indexOf(s);a=this.DetailRows[E][e],a[p]=n||0==t[this.k]||null==a[p]?t[this.k]:parseFloat(a[p])+t[this.k]}else{a={};for(let e=0;e<this.dtAccountColumns.length;e++)a[this.dtAccountColumns[e]]=l[this.dtAccountColumns[e]];for(let e=0;e<this.oColumns.length;e++)"FLOAT"==this.oColumns[e].ColumnType&&(a[this.oColumns[e].ID]=null);a[p]=t[this.k],n=!0,this.DetailRows[E].push(a),this.DetailRowsWEFAccounts[E].push(s)}}}}}}}else{for(let e=0;e<this.dsTree.Tables[0].length;e++){let t=this.dsTree.Tables[0][e];if(a=Object(l.j)(t.IsGroup),A=parseInt(t.Depth),d=t.Name.toString().Replace(" ",""),this.IncludeOpeningBalance||(R="Show Opening"==t.Opening.toString(),S="Show Closing"==t.Opening.toString()),r=!this.ShowDetailReport&&"True"==t.ShowDetail.toString(),this.fldObj=new h.c,this.fldObj.setFieldDetails(d,3,1,"",0,!1,!1),this.fldDict.ContainsKey(d))return void(this.ViewModel.DisplayMessage="Dulpicate Template Node : "+t.Name.toString());if(this.fldDict.push(d,this.fldObj),!a){M=parseInt(t.NodeID);let e=this.dsTree.Tables[1].filter(e=>Object(u.isNullOrUndefined)(e.IsRead)&&(e.DrNodeID==t.NodeID||e.CrNodeID==t.NodeID));for(let s=0;s<e.length;s++){let o=e[s];if(o.IsRead=1,this.IncludeOpeningBalance||!R){let e;m=Object(l.j)(o.IsGroup)?this.dtAccount.filter(e=>e.IsGroup=0):this.dtAccount.filter(e=>e.AccountID==o.AccountID),_=new Array(m.length);for(let t=0;t<m.length;t++){e={};for(let s=0;s<e.ItemArray.length;s++)e[s]=m[t][s];_[t]=e}if(S){I=Object(l.j)(o.IsGroup)?this.dtAccOpening.filter(e=>e.IsGroup=0):this.dtAccOpening.filter(e=>e.AccountID==o.AccountID),m=_,_=new Array(m.length+I.length);for(let e=0;e<m.length;e++)_[e]=m[e];for(let t=0;t<I.length;t++)e=_.find(e=>null!=e&&e.AccountID.toString()==I[t].AccountID.toString()),e?(e.Balance=parseFloat(e.Balance)+parseFloat(I[t].Balance),this.Show==c.TagWise&&this.lstTags.forEach(s=>{null!=I[t][s]&&(e[s]=null!=e[s]?parseFloat(e[s])+parseFloat(I[t][s]):parseFloat(I[t][s]))})):(e={},this.dtAccOpeningColumns.forEach(s=>{e[s]=I[t][s]}),_[m.length+t]=e)}if(this.YearMonthColIDs.length>0&&(this.CumulativeByMn||S))for(let t=0;t<_.length;t++){let e=_[t];if(null!=e){this.dblTemp=0,(this.IncludeOpeningBalance||S)&&null!=e.OpBalance&&(this.dblTemp=parseFloat(e.OpBalance));for(let t=0;t<this.YearMonthColIDs.length;t++)null!=e[this.YearMonthColIDs[t]]?(this.dblTemp+=parseFloat(e[this.YearMonthColIDs[t]]),e[this.YearMonthColIDs[t]]=this.dblTemp):e[this.YearMonthColIDs[t]]=this.dblTemp}}}else if(this.YearMonthColIDs.length>0){let e,t;e=Object(l.j)(o.IsGroup)?this.dtAccount.filter(e=>e.IsGroup=0):this.dtAccount.filter(e=>e.AccountID==o.AccountID);for(let s=0;s<e.length;s++){let t=this.dtAccOpening.filter(t=>t.AccountID==e[s].AccountID);if(0==t.length){let t={};t.Code=e[s].Code,t.Name=e[s].Name,t.Balance=0,t.AccountID=e[s].AccountID,t.IsGroup=e[s].IsGroup,t.lft=e[s].lft,t.rgt=e[s].rgt;for(let o=1;o<this.YearMonthColIDs.length;o++)t[this.YearMonthColIDs[o]]=e[s][this.YearMonthColIDs[o-1]];this.dtAccOpening.push(t)}else for(let o=1;o<this.YearMonthColIDs.length;o++)t[0][this.YearMonthColIDs[o]]=e[s][this.YearMonthColIDs[o-1]]}I=Object(l.j)(o.IsGroup)?this.dtAccOpening.filter(e=>e.IsGroup=0):this.dtAccOpening.filter(e=>e.AccountID==o.AccountID),_=new Array(I.length);for(let s=0;s<I.length;s++)t={},this.dtAccOpeningColumns.forEach(e=>{t[e]=I[s][e]}),_[s]=t;_.forEach(e=>{this.dblTemp=0;for(let t=0;t<this.YearMonthColIDs.length;t++)0==t?(e[this.YearMonthColIDs[0]]=e.Balance,this.dblTemp=null!=e.Balance?parseFloat(e.Balance):0):null!=e[this.YearMonthColIDs[t]]?(this.dblTemp+=parseFloat(e[this.YearMonthColIDs[t]]),e[this.YearMonthColIDs[t]]=this.dblTemp):e[this.YearMonthColIDs[t]]=this.dblTemp})}else _=Object(l.j)(o.IsGroup)?this.dtAccOpening.filter(e=>e.IsGroup=0):this.dtAccOpening.filter(e=>e.AccountID==o.AccountID);for(let e=0;e<_.length;e++){let s=_[e];if(null!=s){g=parseInt(o.DrNodeID),w=parseInt(o.CrNodeID);for(let e=0;e<this.oColumns.length;e++){let o=this.oColumns[e];if("FLOAT"==o.ColumnType&&(p=o.ID,this.dbl=0,Object(u.isNullOrUndefined)(s[p])||(this.dbl=parseFloat(s[p])),this.ShowAccountWithZeroBalance||0!=parseFloat(this.dbl.ToString("N"+o.DataFormat.DecimalsPoints)))){if(T=null,E=M,this.dbl<0&&0!=w&&w!=M){let e=this.dsTree.Tables[0].filter(e=>e.NodeID==w);e.length>0&&(T=e[0],E=w)}else if(this.dbl>0&&0!=g&&g!=M){let e=this.dsTree.Tables[0].filter(e=>e.NodeID==g);e.length>0&&(T=e[0],E=g)}null==T&&(T=t),T[p]=i.e.Double(T[p])+this.dbl,(this.ShowDetailReport||r)&&(this.DetailRows.ContainsKey(E)||this.DetailRows.push(E,new Array),this.DetailRows[E].Contains(s)||this.DetailRows[E].push(s))}}}}}}}if(this.IsTemplateBudget){let e,t,s;for(let o=0;o<this.dsTree.Tables[0].length;o++)if(this.drAccount=this.dsTree.Tables[0][o],this.strAccountID=this.drAccount.NodeID.toString(),!Object(l.j)(this.drAccount.IsGroup)&&(e=!1,null!=this.dvCurrentBudget&&(this.dvCurrentBudget=this.dvCurrentBudgetTable.filter(e=>e.AccountID==this.strAccountID),this.dvCurrentBudget.length>0&&(e=!0)),e))if(this.Show==c.MonthWise){if(null!=this.dvCurrentBudget){let e,o=this.ShowForecast?this.ForeCastStart:new Date(this.ViewModel.oReportDialog.FromDate.Date.getFullYear(),this.ViewModel.oReportDialog.FromDate.Date.getMonth(),1);if(this.dvCurrentBudget.length>0)for(;o<=this.ForeCastEnd;)this.strTemp=o.ToString("MMMyyyy"),e="Y"+o.getFullYear()+"M"+o.iMonth(),this.dvCurrentBudgetColumns.Contains(this.strTemp)&&(t=parseFloat(this.dvCurrentBudget[0][this.strTemp]),this.ShowBudget&&!this.HideTagWiseBudget&&(this.drAccount["Budget"+e]=t),this.ShowBudgetVariance&&!this.HideTagWiseBudget&&(s=i.e.Double(this.drAccount[e]),this.drAccount["Variance"+e]=t-Math.abs(s)),this.ShowBudgetVariancePercent&&!this.HideTagWiseBudget&&(s=i.e.Double(this.drAccount[e]),this.drAccount["PercentVariance"+e]=0!=t?100*(t-Math.abs(s))/t:0)),o=o.AddMonths(1)}}else this.Show==c.TagWise&&null!=this.dvCurrentBudget&&this.lstTags.forEach(e=>{this.dvCurrentBudget=this.dvCurrentBudgetTable.filter(e=>e.AccountID==this.strAccountID),t=this.GetBudgetAmount(this.dvCurrentBudget,this.ViewModel.FromDatePicker.Date,this.ViewModel.ToDatePicker.Date),this.ShowBudget&&!this.HideTagWiseBudget&&(this.drAccount["Budget"+e]=t),this.ShowBudgetVariance&&!this.HideTagWiseBudget&&(s=i.e.Double(this.drAccount[e]),this.drAccount["Variance"+e]=t-Math.abs(s)),this.ShowBudgetVariancePercent&&!this.HideTagWiseBudget&&(s=i.e.Double(this.drAccount[e]),this.drAccount["PercentVariance"+e]=0!=t?100*(t-Math.abs(s))/t:0)});this.RefreshBudgetData(this.dsTree.Tables[0])}}if(this.AddRows(this.dsTree.Tables[0]),this.Show==c.TagWise&&this.HideEmptyDimensions)try{let e=!1;if(this.lstTags.forEach(t=>{var s=this.ViewModel.ReportColumns.find(e=>e.ID==t);let o=this.ViewModel.ReportColumns.indexOf(s);-1!=o&&null==this.ViewModel.Data.find(e=>(e.Type==n.f.Detail||e.Type==n.f.BalanceBF)&&null!=e.Cells[o].Value&&0!=parseFloat(e.Cells[o].Value))&&(s.HeaderAppearance.IsVisible=!1,null!=(s=this.ViewModel.ReportColumns.find(e=>e.ID=="Budget"+t))&&(s.HeaderAppearance.IsVisible=!1),null!=(s=this.ViewModel.ReportColumns.find(e=>e.ID=="Variance"+t))&&(s.HeaderAppearance.IsVisible=!1),null!=(s=this.ViewModel.ReportColumns.find(e=>e.ID=="PercentVariance"+t))&&(s.HeaderAppearance.IsVisible=!1),e=!0)}),e){let e=new Array;this.oColumns.forEach(t=>{e.push(t)}),this.ViewModel.ReportColumns=e}}catch(P){}}).then(e=>{this.ViewModel.process_RunWorkerCompleted()})}SetDataSet(){let e="";this.ViewModel.oReportDialog.GetSeqNosList(),this.ViewModel.ReportColumns.filter(e=>33==e.ID.length&&!i.e.IsEmpty(e.Formula)&&e.Formula.Contains(",")).forEach(t=>{let s=t.Formula.split(",");if(2==s.length){let o,l;i.e.isValidDate(s[0])&&i.e.isValidDate(s[1])&&(o=new Date(s[0]),l=new Date(s[1]),e+='<Row ID="'+t.ID+'" From="'+o.ToString("dd MMM yyyy")+'" To="'+l.ToString("dd MMM yyyy")+'"/>',this.lstCustomCols.push(t))}}),e.length>0&&(e="<XML>"+e+"</XML>");let t=this.GetDimensionFilter("DCC.dcCCNID"),s=[];return s.push(this.TemplateID),s.push(a.b.GetTagTableName(this.TemplateCCID)),s.push(this.IsWEF),s.push(this.ViewModel.oReportDialog.FromDate.Date.ToString("dd/MMM/yyyy")),s.push(this.ViewModel.oReportDialog.ToDate.Date.ToString("dd/MMM/yyyy")),s.push(this.IncludeOpeningBalance),s.push(this.Show==c.MonthWise?1:this.Show==c.YearWise?2:this.Show==c.TagWise?this.TagID:0),s.push(this.YTDIndex),s.push(this.BAL_LMIndex),s.push(this.BAL_LYIndex),s.push(this.YTD_LYIndex),s.push(e),s.push(this.UnPostedDocsList),s.push(this.LocationWhere+t),s.push(this.GetAccountWiseLocationWhere("A")),s.push(this.ShowAccountWithZeroBalance),s.push(this.PDCInclude),s.push(this.IncludeTerminatedPDC),s.push(this.CurrencyType),s.push(this.ForeignCurrencyID),s.push(o.a.SessionManager.LanguageID),this.arrPromise.push("dsTree",o.a.report.RPT_PLTemplate(s,this.ViewModel.IsReportDB)),Promise.all(this.arrPromise.values).then(e=>{let s;for(s=this.arrPromise.keys.indexOf("dblOpeningStock"),0!=s&&(this.dblOpeningStock=parseFloat(e[s])),s=this.arrPromise.keys.indexOf("dblClosingStock"),0!=s&&(this.dblClosingStock=parseFloat(e[s])),s=this.arrPromise.keys.indexOf("dsTree"),this.dsTree=e[s],this.dtYearStart=this.dsTree.Tables[7].length>0?new Date(this.dsTree.Tables[7][0].YearStart):this.ViewModel.oReportDialog.FromDate.Date;this.dtYearStart.AddYears(1)<=this.ViewModel.oReportDialog.FromDate.Date;)this.dtYearStart=this.dtYearStart.AddYears(1);this.dtAccount=this.dsTree.Tables[2],this.dtAccountColumns=this.dsTree.Columns[2],this.dv=this.dsTree.Tables[2],this.LastColumn=this.dsTree.Columns[2][this.dtAccountColumns.length-1],this.dsTree.Columns[8].length>1?(this.dtAccOpening=this.dsTree.Tables[8],this.dtAccOpeningColumns=this.dsTree.Columns[8]):this.dtAccOpening=null;for(let t=3;t<7;t++)this.dsTree.Tables[t].forEach(e=>{if(0==this.dtAccount.filter(t=>t.AccountID==e.AccountID).length){let t={};for(let s=0;s<this.dtAccountColumns.length;s++)t[this.dtAccountColumns[s]]=e[this.dtAccountColumns[s]];t.Balance=null,this.dtAccount.push(t)}});-1!=this.YTDIndex&&(this.dvYTD=this.dsTree.Tables[3],this.dtAccountColumns.push("YTD")),-1!=this.BAL_LYIndex&&(this.dvBAL_LY=this.dsTree.Tables[4],this.dtAccountColumns.push("LastYearBalance")),-1!=this.YTD_LYIndex&&(this.dvYTD_LY=this.dsTree.Tables[5],this.dtAccountColumns.push("LastYearYTD")),-1!=this.BAL_LMIndex&&(this.dvBAL_LM=this.dsTree.Tables[6],this.dtAccountColumns.push("LastMonthBalance")),this.lstCustomCols.forEach(e=>{this.dtAccountColumns.push(e.ID)}),this.dsTree.Tables[9].length>0&&(this.InActiveStatusID=parseInt(this.dsTree.Tables[9][0].InActiveStatus)),this.SetBudgetDataSet("",this.LocationWhere+t),this.SetBudgetDataSet_Complete();for(let t=0;t<this.CountMonths;t++)this.dtAccountColumns.push(this.oColumns[this.ColumnSize+t].ID),null!=this.dtAccOpening&&this.dtAccOpeningColumns.push(this.oColumns[this.ColumnSize+t].ID);this.IsWEF?this.RefreshTagWiseData_WEF():this.RefreshTagWiseData(),this.IsTemplateBudget||this.RefreshBudgetData(this.dtAccount)})}SetBudgetDataSet(e,t){if(this.dvPrevBudget=null,this.dvCurrentBudget=null,(this.ShowBudget||this.ShowBudgetVariance||this.ShowBudgetVariancePercent||this.ShowTotalBudget)&&null==this.dsBudget){let e,t="",i="",l="";var s=this.ViewModel.oReportDialog.CostCenterFilters.filter(e=>e.CostCenterID>5e4&&e.SelectedNodes.length>0);if(s.length>0){let e="SELECT CostCenterID FROM COM_BudgetDefDims with(nolock) WHERE BudgetDefID="+this.CurrentBudgetID+" and CostCenterID>50000";this.PreviousBudgetID>0&&(-1!=this.BAL_LYIndex||-1!=this.YTD_LYIndex)&&(e+=" SELECT CostCenterID FROM COM_BudgetDefDims with(nolock) WHERE BudgetDefID="+this.PreviousBudgetID+" and CostCenterID>50000");let t=o.a.report.ReportDataSet("RPT022",this.ViewModel.IsReportDB,e);t.Tables[0].forEach(e=>{if(s.find(t=>t.CostCenterID==parseInt(e.CostCenterID))){let t=this.GetFilterByDimension_1(parseInt(e.CostCenterID));t.length>0&&(i+=" AND CCNID"+(parseInt(e.CostCenterID)-5e4)+" IN ("+t+")")}}),t.Tables.length>1&&t.Tables[1].forEach(e=>{if(s.find(t=>t.CostCenterID==parseInt(e.CostCenterID))){let t=this.GetFilterByDimension_1(parseInt(e.CostCenterID));t.length>0&&(l+=" AND CCNID"+(parseInt(e.CostCenterID)-5e4)+" IN ("+t+")")}})}if(this.Show==c.TagWise){t+="SELECT AccountID,CCNID"+(this.TagID-5e4)+" TagID,SUM(AnnualAmount) AnnualAmount",e=this.dtYearStart;for(let s=1;s<=12;s++)t+=",SUM(Month"+s+"Amount) "+e.ToString("MMMyyyy"),e=e.AddMonths(1);if(t+=" FROM COM_BudgetAlloc with(nolock) WHERE BudgetDefID="+this.CurrentBudgetID,t+=i.toString(),t+=" GROUP BY AccountID,CCNID"+(this.TagID-5e4),this.PreviousBudgetID>0&&(-1!=this.BAL_LYIndex||-1!=this.YTD_LYIndex)){t+=" SELECT AccountID,CCNID"+(this.TagID-5e4)+" TagID,SUM(AnnualAmount) AnnualAmount",e=this.dtYearStart;for(let s=1;s<=12;s++)t+=",SUM(Month"+s+"Amount) "+e.ToString("MMMyyyy"),e=e.AddMonths(1);t+=" FROM COM_BudgetAlloc with(nolock) WHERE BudgetDefID="+this.PreviousBudgetID,t+=l.toString(),t+=" GROUP BY AccountID,CCNID"+(this.TagID-5e4)}}else{let s="AccountID";this.dsBudget=o.a.report.ReportDataSet("RPT022",this.ViewModel.IsReportDB,"SELECT CostCenterID FROM COM_BudgetDefDims with(nolock) WHERE BudgetDefID="+this.CurrentBudgetID+" and CostCenterID="+this.TemplateCCID),this.dsBudget.Tables[0].length>0&&(this.IsTemplateBudget=!0,s="CCNID"+(this.TemplateCCID-5e4)),t+="SELECT "+s+" AccountID,SUM(AnnualAmount) AnnualAmount",e=this.dtYearStart;for(let o=1;o<=12;o++)t+=",SUM(Month"+o+"Amount) "+e.ToString("MMMyyyy"),e=e.AddMonths(1);if(t+=" FROM COM_BudgetAlloc with(nolock) WHERE BudgetDefID="+this.CurrentBudgetID,t+=i.toString(),t+=" GROUP BY "+s,this.PreviousBudgetID>0&&(-1!=this.BAL_LYIndex||-1!=this.YTD_LYIndex)){t+=" SELECT "+s+" AccountID,SUM(AnnualAmount) AnnualAmount",e=this.dtYearStart;for(let s=1;s<=12;s++)t+=",SUM(Month"+s+"Amount) "+e.ToString("MMMyyyy"),e=e.AddMonths(1);t+=l.toString(),t+=" GROUP BY "+s}}this.dsBudget=o.a.report.ReportDataSet("RPT022",this.ViewModel.IsReportDB,t.toString())}}SetBudgetDataSet_Complete(){this.dvCurrentBudget=this.dvCurrentBudgetTable=this.dsBudget.Tables[0],this.dvCurrentBudgetColumns=this.dsBudget.Columns[0],this.dsBudget.Tables.length>1&&(this.dvPrevBudget=this.dvPrevBudgetTable=this.dsBudget.Tables[1],this.dvPrevBudgetColumns=this.dsBudget.Columns[1]),this.dsTree.Columns[2].push("BudgetBalance"),this.dsTree.Columns[2].push("VarianceBalance"),this.dsTree.Columns[2].push("PercentVarianceBalance"),this.dsTree.Columns[2].push("TotalBudget"),-1!=this.YTDIndex&&(this.dsTree.Columns[2].push("BudgetYTD"),this.dsTree.Columns[2].push("VarianceYTD"),this.dsTree.Columns[2].push("PercentVarianceYTD")),-1!=this.BAL_LYIndex&&(this.dsTree.Columns[2].push("BudgetLastYearBalance"),this.dsTree.Columns[2].push("VarianceLastYearBalance"),this.dsTree.Columns[2].push("PercentVarianceLastYearBalance")),-1!=this.YTD_LYIndex&&(this.dsTree.Columns[2].push("BudgetLastYearYTD"),this.dsTree.Columns[2].push("VarianceLastYearYTD"),this.dsTree.Columns[2].push("PercentVarianceLastYearYTD")),-1!=this.BAL_LMIndex&&(this.dsTree.Columns[2].push("BudgetLastMonthBalance"),this.dsTree.Columns[2].push("VarianceLastMonthBalance"),this.dsTree.Columns[2].push("PercentVarianceLastMonthBalance"))}SetRetainedEarning(e,t){if("Show Opening"!=t&&"Show Closing"!=t&&(t="Period"),!this.dtRetainedEarning.ContainsKey(t)){let e,s,i="",l="";this.ForeignCurrencyID>0?(e="AmountFC",s=" AND ACC.CurrencyID="+this.ForeignCurrencyID):(e=1==this.CurrencyType?"AmountBC":"Amount",s="");let a,n="",r="",h="",u="",D=this.GetDimensionFilter("DCC.dcCCNID");(this.LocationWhere.length>0||this.Show==c.TagWise||D.length>0)&&(r=" JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.AccDocDetailsID=ACC.AccDocDetailsID ",h=" JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=ACC.InvDocDetailsID ");let d="",C="",p="";this.Show==c.MonthWise?(d="CONVERT(DATETIME,DocDate) DocDate,",C="'Y'+CONVERT(NVARCHAR,YEAR(DocDate))+'M'+ CONVERT(NVARCHAR,Month(DocDate)) Mn,",p="YEAR(DocDate), MONTH(DocDate)"):this.Show==c.YearWise?(d="CONVERT(DATETIME,FY.FromDate) DocDate,",C="'Y'+CONVERT(NVARCHAR,YEAR(DocDate))+'M'+ CONVERT(NVARCHAR,Month(DocDate)) Mn,",p="YEAR(DocDate),Month(DocDate)",u+=" join ADM_FinancialYears FY with(nolock) on ACC.DocDate between FY.FromDate and FY.ToDate"):this.Show==c.TagWise&&(d="DCC.dcCCNID"+(this.TagID-5e4)+" TagID,",C="TagID,",p="TagID"),l="";let T="";0==this.UnPostedDocsList.length?T=" AND (ACC.StatusID=369 or ACC.StatusID=429)":T+=" AND ACC.StatusID IN (369,429,"+this.UnPostedDocsList+")";let _="(ACC.StatusID=370 OR ACC.StatusID=439"+(this.IncludeTerminatedPDC?" OR ACC.StatusID=452":"")+")";this.PDCInclude?(i=" AND ACC.DocumentType<>16 AND ("+_+" OR (ACC.DocumentType<>14 AND ACC.DocumentType<>19"+T+"))",l+=" AND ("+_+" OR (ACC.DocumentType<>14 AND ACC.DocumentType<>19"+T+"))"):(i=" AND ACC.DocumentType NOT IN (16,14,19)"+T,l+=" AND ACC.DocumentType<>14 AND ACC.DocumentType<>19"+T);let m="";this.PDCInclude&&(m=" OR (DocDate<=@To AND (ACC.DocumentType=14 OR ACC.DocumentType=19) AND "+_+")",i=" AND ACC.DocumentType NOT IN (16,14,19) "+T),a="Show Opening"==t?"DocDate<@From":"Show Closing"==t?"DocDate<=@To":"DocDate BETWEEN @From AND @To",n+="DECLARE @From FLOAT,@To FLOAT\nSET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))\n",n+="\nSELECT "+C+"SUM(TR_Dr)-SUM(TR_Cr) Balance\nFROM (",n+="\n--Transaction Dr\nSELECT ACC.DebitAccount AccountID,"+d+"ACC."+e+" TR_Dr,0 TR_Cr\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+r+u+"\nWHERE ((("+a+")"+i+")"+m+")"+s+this.LocationWhere+D+" AND ACC.DebitAccount>1\nUNION ALL--Transaction Cr\nSELECT ACC.CreditAccount,"+d+"0 TR_Dr,ACC."+e+" TR_Cr\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+r+u+"\nWHERE ((("+a+")"+i+")"+m+")"+s+this.LocationWhere+D+" AND ACC.CreditAccount>1",h.length>0&&(n+="\n--INEVENTORY DATA\nUNION ALL--Transaction Dr\nSELECT ACC.DebitAccount,"+d+"ACC."+e+" TR_Dr,0 TR_Cr\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+h+u+"\nWHERE ("+a+")"+i+s+this.LocationWhere+D+" AND ACC.DebitAccount>1\nUNION ALL--Transaction Cr\nSELECT ACC.CreditAccount,"+d+"0 TR_Dr,ACC."+e+" TR_Cr\nFROM ACC_DocDetails ACC  WITH(NOLOCK)"+h+u+"\nWHERE ("+a+")"+i+s+this.LocationWhere+D+" AND ACC.CreditAccount>1"),n+="\n) AS T1 JOIN ACC_Accounts A WITH(NOLOCK) ON A.AccountID=T1.AccountID\nwhere A.AccountTypeID IN (4,8,11,5,9,12)",n+=this.GetAccountWiseLocationWhere("A"),p.length>0&&(n+=" GROUP BY "+p);let I=o.a.report.ReportDataSet("RPT022",this.ViewModel.IsReportDB,n);this.dtRetainedEarning.push(t,I.Tables[0])}if(this.dtRetainedEarning[t].length>0&&(e.Balance=this.dtRetainedEarning[t].Compute("sum","Balance"),this.Show!=c.None)){let s=0,o=this.Show==c.TagWise?"TagID":"Mn";if(this.dtRetainedEarning[t].forEach(i=>{Object(u.isUndefined)(e[i[o].toString()])?"Show Closing"==t&&(s+=parseFloat(i.Balance)):e[i[o].toString()]=i.Balance}),this.YearMonthColIDs.length>0&&(this.CumulativeByMn||"Show Closing"==t)){this.dblTemp=s;for(let t=0;t<this.YearMonthColIDs.length;t++)null!=e[this.YearMonthColIDs[t]]?(this.dblTemp+=parseFloat(e[this.YearMonthColIDs[t]]),e[this.YearMonthColIDs[t]]=this.dblTemp):e[this.YearMonthColIDs[t]]=this.dblTemp}}}LoadReportWithPostFilters(e){this.GrdRow=-1,this.ViewModel.Data.Clear()}RefreshTagWiseData(){if(this.IsWEF)return;let e,t=!1,s=0,o=0;if(this.Show!=c.None||-1!=this.YTDIndex||-1!=this.BAL_LMIndex||-1!=this.BAL_LYIndex||-1!=this.YTD_LYIndex){this.Show==c.YearWise&&this.dtAccountColumns.push("Mn"),this.Show!=c.YearWise&&this.Show!=c.MonthWise||(this.dtAccountColumns.push("OpBalance"),null!=this.dtAccOpening&&this.dtAccOpeningColumns.push("OpBalance"));for(let a=0;a<this.dtAccount.length;a++)if(this.drAccount=this.dtAccount[a],this.strAccountID=this.drAccount.AccountID.toString(),Object(l.j)(this.drAccount.IsGroup))this.dbl=0,this.UpdateTableWithPreviousYears();else{if(this.Show!=c.None){this.dblTemp=0;let t=0;if(this.AccountID=parseInt(this.drAccount.AccountID),this.Show==c.YearWise&&this.drAccount.FromDate){let e=new Date(this.drAccount.FromDate);this.drAccount.Mn="Y"+e.getFullYear()+"M"+e.iMonth()}for(this.strTemp=this.drAccount.Mn.toString(),this.strTemp.length>0&&(this.dblTemp=i.e.Double(this.drAccount.Balance),this.dtAccountColumns.Contains(this.strTemp)?this.drAccount[this.strTemp]=this.drAccount.Balance:t+=null!=this.drAccount.Balance?parseFloat(this.drAccount.Balance):0);a+1<this.dv.length&&this.AccountID==parseInt(this.dv[a+1].AccountID);){if(this.Show==c.YearWise){let e=new Date(this.dv[a+1].FromDate);this.dv[a+1].Mn="Y"+e.getFullYear()+"M"+e.iMonth()}this.strTemp=this.dv[a+1].Mn.toString(),this.strTemp.length>0&&(this.dblTemp=this.dblTemp+parseFloat(this.dv[a+1].Balance),this.dtAccountColumns.Contains(this.strTemp)?this.drAccount[this.strTemp]=this.dv[a+1].Balance:t+=null!=this.dv[a+1].Balance?parseFloat(this.dv[a+1].Balance):0),this.dvTable.Remove(this.dv[a+1].Row)}this.drAccount.Balance=this.dblTemp,this.Show!=c.YearWise&&this.Show!=c.MonthWise||(null!=this.dtAccOpening?(e=this.dtAccOpening.filter(e=>e.AccountID==this.AccountID),e.length>0&&(this.drAccount.OpBalance=e[0].Balance)):this.drAccount.OpBalance=t)}if(t=!1,null==this.dvCurrentBudget||this.IsTemplateBudget||(this.dvCurrentBudget=this.dvCurrentBudgetTable.filter(e=>e.AccountID==this.strAccountID),this.dvCurrentBudget.length>0&&(t=!0)),t)if(this.Show==c.MonthWise){if(null!=this.dvCurrentBudget){let e,t=this.ShowForecast?this.ForeCastStart:new Date(this.ViewModel.oReportDialog.FromDate.Date.getFullYear(),this.ViewModel.oReportDialog.FromDate.Date.getMonth(),1);if(this.dvCurrentBudget.length>0)for(;t<=this.ForeCastEnd;)this.strTemp=t.ToString("MMMyyyy"),e="Y"+t.getFullYear()+"M"+t.iMonth(),this.dvCurrentBudgetColumns.Contains(this.strTemp)&&(s=parseFloat(this.dvCurrentBudget[0][this.strTemp]),this.ShowBudget&&!this.HideTagWiseBudget&&(this.drAccount["Budget"+e]=s),this.ShowBudgetVariance&&!this.HideTagWiseBudget&&(o=i.e.Double(this.drAccount[e]),this.drAccount["Variance"+e]=s-Math.abs(o)),this.ShowBudgetVariancePercent&&!this.HideTagWiseBudget&&(o=i.e.Double(this.drAccount[e]),this.drAccount["PercentVariance"+e]=0!=s?100*(s-Math.abs(o))/s:0)),t=t.AddMonths(1)}}else this.Show==c.TagWise&&null!=this.dvCurrentBudget&&this.lstTags.forEach(e=>{this.dvCurrentBudget=this.dvCurrentBudgetTable.filter(t=>t.AccountID==this.strAccountID&&t.TagID==e),s=this.GetBudgetAmount(this.dvCurrentBudget,this.ViewModel.FromDatePicker.Date,this.ViewModel.ToDatePicker.Date),this.ShowBudget&&!this.HideTagWiseBudget&&(this.drAccount["Budget"+e]=s),this.ShowBudgetVariance&&!this.HideTagWiseBudget&&(o=i.e.Double(this.drAccount[e]),this.drAccount["Variance"+e]=s-Math.abs(o)),this.ShowBudgetVariancePercent&&!this.HideTagWiseBudget&&(o=i.e.Double(this.drAccount[e]),this.drAccount["PercentVariance"+e]=0!=s?100*(s-Math.abs(o))/s:0)});this.UpdateTableWithPreviousYears()}if(this.Show==c.TagWise&&null!=this.dtAccOpening)for(let e=0;e<this.dtAccOpening.length;e++)if(this.drAccount=this.dtAccOpening[e],this.strAccountID=this.drAccount.AccountID.toString(),!Object(l.j)(this.drAccount.IsGroup)){for(this.dblTemp=0,this.AccountID=parseInt(this.drAccount.AccountID),this.strTemp=this.drAccount.Mn.toString(),this.strTemp.length>0&&(this.dblTemp=i.e.Double(this.drAccount.Balance),this.dtAccountColumns.Contains(this.strTemp)&&(this.drAccount[this.strTemp]=this.drAccount.Balance));e+1<this.dtAccOpening.length&&this.AccountID==parseInt(this.dtAccOpening[e+1].AccountID);)this.strTemp=this.dtAccOpening[e+1].Mn.toString(),this.strTemp.length>0&&(this.dblTemp=this.dblTemp+parseFloat(this.dtAccOpening[e+1].Balance),this.dtAccountColumns.Contains(this.strTemp)&&(this.drAccount[this.strTemp]=this.dtAccOpening[e+1].Balance)),this.dtAccOpening.RemoveAt(e+1);this.drAccount.Balance=this.dblTemp}}}RefreshTagWiseData_WEF(){if(this.Show==c.YearWise){this.dtAccountColumns.push("Mn");for(let e=0;e<this.dtAccount.length;e++)if(this.drAccount=this.dtAccount[e],this.strAccountID=this.drAccount.AccountID.toString(),!Object(l.j)(this.drAccount.IsGroup)&&0!=this.Show&&(this.dblTemp=0,this.AccountID=parseInt(this.drAccount.AccountID),this.Show==c.YearWise&&null!=this.drAccount.FromDate)){let e=new Date(this.drAccount.FromDate);this.drAccount.Mn="Y"+e.getFullYear()+"M"+e.iMonth()}}}RefreshBudgetData(e){if(null==this.dvCurrentBudget)return;let t=e==this.dsTree.Tables[0]?"NodeID":"AccountID",s=this.ViewModel.FromDatePicker.Date.AddMonths(-1).ToString("MMMyyyy");for(let o=0;o<e.length;o++)if(this.drAccount=e[o],this.strAccountID=this.drAccount[t].toString(),!Object(l.j)(this.drAccount.IsGroup)){this.dvCurrentBudget=this.dvCurrentBudgetTable.filter(e=>e.AccountID==this.strAccountID);let e=this.GetBudgetAmount(this.dvCurrentBudget,this.ForeCastStart,this.ForeCastEnd);if(this.ShowBudget&&(this.drAccount.BudgetBalance=e),this.ShowTotalBudget&&(this.dblTemp=this.GetBudgetAmount_dv(this.dvCurrentBudget),this.drAccount.TotalBudget=this.dblTemp),this.ShowBudgetVariance||this.ShowBudgetVariancePercent){this.dbl=null!=this.drAccount.Balance?parseFloat(this.drAccount.Balance):0;let t=0;t=e-Math.abs(this.dbl),this.drAccount.VarianceBalance=t,this.ShowBudgetVariancePercent&&(this.dblTemp=0!=e?100*t/e:0,this.drAccount.PercentVarianceBalance=this.dblTemp)}if(-1!=this.YTDIndex&&(e=this.GetBudgetAmount(this.dvCurrentBudget,this.dtYearStart,this.ViewModel.ToDatePicker.Date),this.ShowBudget&&(this.drAccount.BudgetYTD=e),this.ShowBudgetVariance||this.ShowBudgetVariancePercent)){this.dbl=null!=this.drAccount.YTD?parseFloat(this.drAccount.YTD):0;let t=0;t=e-Math.abs(this.dbl),this.drAccount.VarianceYTD=t,this.ShowBudgetVariancePercent&&(this.dblTemp=0!=e?100*t/e:0,this.drAccount.PercentVarianceYTD=this.dblTemp)}if(-1!=this.BAL_LMIndex&&(e=this.dvCurrentBudgetColumns.Contains(s)?this.GetBudgetAmount(this.dvCurrentBudget,this.ViewModel.FromDatePicker.Date.AddMonths(-1),this.ViewModel.FromDatePicker.Date.AddDays(-1)):null!=this.dvPrevBudget&&this.dvPrevBudgetColumns.Contains(s)?this.GetBudgetAmount(this.dvPrevBudget,this.ViewModel.FromDatePicker.Date.AddMonths(-1),this.ViewModel.FromDatePicker.Date.AddDays(-1)):0,this.ShowBudget&&(this.drAccount.BudgetLastMonthBalance=e),this.ShowBudgetVariance||this.ShowBudgetVariancePercent)){this.dbl=null!=this.drAccount.LastMonthBalance?parseFloat(this.drAccount.LastMonthBalance):0;let t=0;t=e-Math.abs(this.dbl),this.drAccount.VarianceLastMonthBalance=t,this.ShowBudgetVariancePercent&&(this.dblTemp=0!=e?100*t/e:0,this.drAccount.PercentVarianceLastMonthBalance=this.dblTemp)}if(-1!=this.BAL_LYIndex&&(this.dvBAL_LY=this.dvBAL_LYTable.filter(e=>e.AccountID==this.strAccountID),this.dvBAL_LY.length>0&&null!=this.dvPrevBudget&&(this.dvPrevBudget=this.dvPrevBudgetTable.filter(e=>e.AccountID==this.strAccountID),e=this.GetBudgetAmount(this.dvPrevBudget,this.ViewModel.FromDatePicker.Date,this.ViewModel.ToDatePicker.Date),this.ShowBudget&&(this.drAccount.BudgetLastYearBalance=e),this.ShowBudgetVariance||this.ShowBudgetVariancePercent))){this.dbl=null!=this.drAccount.LastYearBalance?parseFloat(this.drAccount.LastYearBalance):0;let t=0;t=e-Math.abs(this.dbl),this.drAccount.VarianceLastYearBalance=t,this.ShowBudgetVariancePercent&&(this.dblTemp=0!=e?100*t/e:0,this.drAccount.PercentVarianceLastYearBalance=this.dblTemp)}if(-1!=this.YTD_LYIndex&&(this.dvYTD_LY=this.dvYTD_LYTable.filter(e=>e.AccountID==this.strAccountID),this.dvYTD_LY.length>0&&null!=this.dvPrevBudget&&(this.dvPrevBudget=this.dvPrevBudgetTable.filter(e=>e.AccountID==this.strAccountID),e=this.GetBudgetAmount(this.dvPrevBudget,this.dtYearStart,this.ViewModel.ToDatePicker.Date),this.ShowBudget&&(this.drAccount.BudgetLastYearYTD=e),this.ShowBudgetVariance||this.ShowBudgetVariancePercent))){this.dbl=null!=this.drAccount.LastYearYTD?parseFloat(this.drAccount.LastYearYTD):0;let t=0;t=e-Math.abs(this.dbl),this.drAccount.VarianceLastYearYTD=t,this.ShowBudgetVariancePercent&&(this.dblTemp=0!=e?100*t/e:0,this.drAccount.PercentVarianceLastYearYTD=this.dblTemp)}}}UpdateTableWithPreviousYears(){-1!=this.YTDIndex&&(this.dvYTD=this.dvYTDTable.filter(e=>e.AccountID==this.strAccountID),this.dvYTD.length>0&&(this.dblTemp=i.e.Double(this.dvYTD[0].Balance),this.drAccount.YTD=this.dblTemp)),-1!=this.BAL_LMIndex&&(this.dvBAL_LM=this.dvBAL_LMTable.filter(e=>e.AccountID==this.strAccountID),this.dvBAL_LM.length>0&&(this.dblTemp=i.e.Double(this.dvBAL_LM[0].Balance),this.drAccount.LastMonthBalance=this.dblTemp)),-1!=this.BAL_LYIndex&&(this.dvBAL_LY=this.dvBAL_LYTable.filter(e=>e.AccountID==this.strAccountID),this.dvBAL_LY.length>0&&(this.dblTemp=i.e.Double(this.dvBAL_LY[0].Balance),this.drAccount.LastYearBalance=this.dblTemp)),-1!=this.YTD_LYIndex&&(this.dvYTD_LY=this.dvYTD_LYTable.filter(e=>e.AccountID==this.strAccountID),this.dvYTD_LY.length>0&&(this.dblTemp=i.e.Double(this.dvYTD_LY[0].Balance),this.drAccount.LastYearYTD=this.dblTemp));let e=11;this.lstCustomCols.forEach(t=>{let s=this.dsTree.Tables[e](e=>e.AccountID==this.strAccountID);s.length>0&&(this.dblTemp=i.e.Double(s[0].Balance),this.drAccount[t.ID]=this.dblTemp),e++})}AddRows(e){if(this.lstLevelGroups=new Array,this.lstLevelGroups.push(new D(new n.d(this.oColumns.length,this.ViewModel.RowHeight),this.oColumns.length)),e.length>0)for(let i=0;i<parseInt(e[0].Depth)-1;i++)this.lstLevelGroups.push(new D(new n.d(this.oColumns.length,this.ViewModel.RowHeight),this.oColumns.length));let t,s,o,a,r,h=0,d=this.fldDict,c=!1;for(this.LevelColsCnt=0;this.LevelColsCnt<this.oColumns.length&&"FLOAT"!=this.oColumns[this.LevelColsCnt].ColumnType;this.LevelColsCnt++);for(let p=0;p<e.length;p++)if(s=e[p].F.toString().Trim(),(this.ShowAllAccounts||0!=s.length||Object(l.j)(e[p].IsGroup)||this.oColumns.find(t=>"FLOAT"==t.ColumnType&&!i.e.IsEmpty(e[p][t.ID])))&&(this.oRow=new n.d(this.oColumns.length,this.ViewModel.RowHeight),this.oRow.DataRow=e[p],r=parseInt(e[p].StatusID)==this.InActiveStatusID,this.oRow.LevelNo=parseInt(e[p].Depth)-1,this.oRow.IsGroup=Object(l.j)(e[p].IsGroup),this.oRow.NodeID=parseInt(e[p].NodeID),a="True"==e[p].Bold.toString(),c=!1,!this.ShowDetailReport&&this.DetailRows.ContainsKey(this.oRow.NodeID)&&(this.oRow.IsGroup=!0,c=!0),this.ShowAllAccounts||0!=s.length||this.oRow.IsGroup||this.ShowAccountWithZeroBalance||this.oColumns.find(t=>"FLOAT"==t.ColumnType&&!i.e.IsEmpty(e[p][t.ID])&&0!=parseFloat(parseFloat(e[p][t.ID]).ToString("N"+t.DataFormat.DecimalsPoints))))){if(this.UpdateTreeTotals(this.oRow.LevelNo),s.length>0)if(0==i.e.stringCompare(s,"PactRetainedEarning",!0))this.SetRetainedEarning(e[p],e[p].Opening.toString());else for(let t=0;t<this.oColumns.length;t++)if("FLOAT"==this.oColumns[t].ColumnType){for(let s=0;s<p;s++)Object(u.isNullOrUndefined)(e[s][this.oColumns[t].ID])?this.fldDict[e[s].Name.toString().Replace(" ","")].setFieldValue(0):this.fldDict[e[s].Name.toString().Replace(" ","")].setFieldValue(e[s][this.oColumns[t].ID]);try{e[p][this.oColumns[t].ID]=this.eval.EvaluateExpression(s,d)}catch(C){}}if(this.oRow.IsGroup){this.lstLevelGroups.push(new D(this.oRow,this.oColumns.length)),"False"!=e[p].TotShow.toString()&&(this.lstLevelGroups[this.lstLevelGroups.length-1].ShowTotal=!0,"At End"==e[p].TotShow.toString()&&(this.lstLevelGroups[this.lstLevelGroups.length-1].TotalAtEnd=!0,this.lstLevelGroups[this.lstLevelGroups.length-1].TotalCaption=i.e.String(e[p].TotText))),this.lstLevelGroups[this.lstLevelGroups.length-1].TotalBackground="Yes"==e[p].TotalBg.toString(),this.lstLevelGroups[this.lstLevelGroups.length-1].TotalBorder=this.lstBorder.indexOf(e[p].TotalBor.toString()),-1==this.lstLevelGroups[this.lstLevelGroups.length-1].TotalBorder&&(this.lstLevelGroups[this.lstLevelGroups.length-1].TotalBorder=0),"Yes"==e[p].TotalBorRow.toString()&&(this.lstLevelGroups[this.lstLevelGroups.length-1].TotalBorder=-this.lstLevelGroups[this.lstLevelGroups.length-1].TotalBorder);for(let e=0;e<this.oRow.Cells.length;e++)this.oRow.Cells[e].IsNormal=!1,this.oRow.Cells[e].CellAppearance=this.oColumns[e].DataAppearance.Clone(),this.oRow.Cells[e].CellAppearance.ForeColor="#FF0081A6",a&&(this.oRow.Cells[e].CellAppearance.IsBold=!0);if(this.oRow.PrintVisible=this.ViewModel.TreeGroupPrint,this.lstLevelGroups[this.lstLevelGroups.length-1].TotalBackground&&!this.lstLevelGroups[this.lstLevelGroups.length-1].TotalAtEnd)for(let e=0;e<this.oRow.Cells.length;e++)null==this.oRow.Cells[e].CellAppearance&&(this.oRow.Cells[e].IsNormal=!1,this.oRow.Cells[e].CellAppearance=this.oColumns[e].DataAppearance.Clone()),this.oRow.Cells[e].CellAppearance.BackColor="#FFD8D8D8"}else{let t=this.lstBorder.indexOf(e[p].TotalBor.toString());if(-1==t&&(t=0),a||0!=t)for(let e=0;e<this.oRow.Cells.length;e++)this.oRow.Cells[e].IsNormal=!1,this.oRow.Cells[e].CellAppearance=this.oColumns[e].DataAppearance.Clone(),this.oRow.Cells[e].CellAppearance.IsBold=!0,"FLOAT"==this.oColumns[e].ColumnType&&(this.oRow.Cells[e].Border=t)}if(this.ShowDetailReport)for(let e=0;e<this.oRow.Cells.length;e++)this.oRow.Cells[e].IsNormal=!1,this.oRow.Cells[e].CellAppearance=this.ViewModel.lstGroup[0].GroupAppearance;if(!this.ShowDetailReport||!(this.oRow.IsGroup||s.length>0)){for(let s=0;s<this.oColumns.length;s++)if(o=this.oColumns[s],!this.ShowDetailReport&&s<this.LevelColsCnt&&(this.oRow.Cells[s].IsNormal=!1,this.oRow.Cells[s].level=this.oRow.LevelNo-1),!this.ShowBudgetVariancePercent||i.e.IsEmpty(o.DataFormat.PercentageOn))Object(u.isUndefined)(e[p][this.oColumns[s].ID])||(i.e.IsEmpty(this.oColumns[s].Formula)||this.ViewModel.CalculateFormula_2(this.oColumns[s],e[p]),t=e[p][o.ID].toString(),""!=t&&("FLOAT"==o.ColumnType&&i.e.IsNum(t)?(h=i.e.Double(t),c||this.ShowDetailReport||this.FormatData(h,this.oRow,s),r||this.lstLevelGroups.length>0&&(this.lstLevelGroups[this.lstLevelGroups.length-1].Total[s]+=h)):this.ViewModel.SetCellValue(t,o.DataFormat,o.ColumnType,this.oRow.Cells[s])));else{let t=this.oColumns[s-this.VariancePercentIndex].ID;this.dbl=null!=e[p]["Budget"+t]?parseFloat(e[p]["Budget"+t]):0,this.ShowBudgetVariance?this.dblVariance=null!=e[p]["Variance"+t]?parseFloat(e[p]["Variance"+t]):0:(this.dblTemp=null!=e[p][t]?parseFloat(e[p][t]):0,this.dblVariance=this.dbl-Math.abs(this.dblTemp)),this.dblTemp=0!=this.dbl?100*this.dblVariance/this.dbl:0,e[p]["PercentVariance"+t]=this.dblTemp,c||this.oRow.IsGroup||this.ShowDetailReport||this.FormatData(this.dblTemp,this.oRow,s),r||this.lstLevelGroups.length>0&&(this.lstLevelGroups[this.lstLevelGroups.length-1].Total[s]+=this.dblVariance)}this.oRow.LevelNo<=this.LevelNo&&(this.lstLevelGroups.length>1&&(this.oRow.IsExpanded=!0,this.oRow.IsExpanded&&(this.oRow.Type=n.f.Detail),this.oRow.IsGroup?this.lstLevelGroups.length>2&&(this.oRow.Parent=this.lstLevelGroups[this.lstLevelGroups.length-2].Row):this.oRow.Parent=this.lstLevelGroups[this.lstLevelGroups.length-1].Row,null==this.oRow.Parent||this.oRow.Parent.IsExpanded&&this.oRow.Parent.Visible||(this.oRow.Visible=!1)),r||(this.ViewModel.addRow(this.oRow),this.ShowDetailReport&&this.DetailRows.ContainsKey(this.oRow.NodeID)&&(this.oRow.Type=n.f.Group,this.oRow.LevelNo=0,this.AddDetailRows(this.oRow)),!this.ShowDetailReport&&this.DetailRows.ContainsKey(this.oRow.NodeID)&&this.AddNodeDetailRows(this.oRow)))}}this.UpdateTreeTotals(0)}AddNodeDetailRows(e){let t,s,o,l=0,a=new n.d(this.oColumns.length,this.ViewModel.RowHeight);for(let r=0;r<this.DetailRows[e.NodeID].length;r++){s=this.DetailRows[e.NodeID][r],a=new n.d(this.oColumns.length,this.ViewModel.RowHeight),a.LevelNo=e.LevelNo,a.DataRow=s,this.dtAccountColumns.Contains("Positive")||(this.dtAccountColumns.push("Positive"),this.dtAccountColumns.push("Negative")),s.Positive=e.DataRow.Positive,s.Negative=e.DataRow.Negative;for(let e=0;e<this.oColumns.length;e++)t=this.oColumns[e],!this.ShowDetailReport&&e<this.LevelColsCnt&&(a.Cells[e].IsNormal=!1,a.Cells[e].level=a.LevelNo),this.dtAccountColumns.Contains(this.oColumns[e].ID)&&(i.e.IsEmpty(this.oColumns[e].Formula)||this.ViewModel.CalculateFormula_2(this.oColumns[e],s),o=i.e.String(s[t.ID]),""!=o&&("FLOAT"==t.ColumnType&&i.e.IsNum(o)?(l=i.e.Double(o),this.FormatData(l,a,e)):this.ViewModel.SetCellValue(o,t.DataFormat,t.ColumnType,a.Cells[e])));a.LevelNo<=this.LevelNo&&(this.lstLevelGroups.length>1&&(a.IsExpanded=!0,a.IsExpanded&&(a.Type=n.f.Detail),a.IsGroup?this.lstLevelGroups.length>2&&(a.Parent=this.lstLevelGroups[this.lstLevelGroups.length-2].Row):a.Parent=this.lstLevelGroups[this.lstLevelGroups.length-1].Row,null==a.Parent||a.Parent.IsExpanded&&a.Parent.Visible||(a.Visible=!1)),this.ViewModel.addRow(a))}}AddDetailRows(e){let t,s,o,l=0;for(let a=0;a<this.DetailRows[e.NodeID].length;a++){s=this.DetailRows[e.NodeID][a],this.oRow=new n.d(this.oColumns.length,this.ViewModel.RowHeight),this.oRow.LevelNo=1,this.oRow.DataRow=e.DataRow;for(let e=0;e<this.oColumns.length;e++)t=this.oColumns[e],Object(u.isNullOrUndefined)(s[t.ID])||(o=s[t.ID].toString(),""!=o&&("FLOAT"==t.ColumnType&&i.e.IsNum(o)?(l=i.e.Double(o),this.FormatData(l,this.oRow,e)):this.ViewModel.SetCellValue(o,t.DataFormat,t.ColumnType,this.oRow.Cells[e])));this.ViewModel.addRow(this.oRow)}this.oRow=new n.d(this.oColumns.length,this.ViewModel.RowHeight),this.oRow.Type=n.f.SubTotal,this.oRow.DataRow=e.DataRow,this.oRow.Cells[0].IsNormal=!1,this.oRow.LevelNo=1,this.oRow.Cells[0].Text=this.ViewModel.lstGroup[0].SubTotalPrefix[0],this.oRow.Cells[0].CellAppearance=this.ViewModel.lstGroup[0].GroupAppearance.Clone(),this.oRow.Cells[0].CellAppearance.BackColor="#FFFFFF",this.oRow.Cells[0].ColSpan=this.LevelColsCnt;for(let a=0;a<this.oColumns.length;a++)t=this.oColumns[a],Object(u.isNullOrUndefined)(e.DataRow[t.ID])||(o=e.DataRow[t.ID].toString(),""!=o&&"FLOAT"==t.ColumnType&&i.e.IsNum(o)&&(l=i.e.Double(o),this.oRow.Cells[a].DataFormat=this.ViewModel.lstGroup[0].SubTotalFormat,this.oRow.Cells[a].CellAppearance=this.ViewModel.lstGroup[0].SubTotalAppearance_Data,this.oRow.Cells[a].Border=this.ViewModel.lstGroup[0].SubTotalBorder,this.oRow.Cells[a].IsNormal=!1,this.FormatData(l,this.oRow,a)));this.ViewModel.addRow(this.oRow)}UpdateTreeTotals(e){for(let t=this.lstLevelGroups.length-1;t>e;t--){if(t>0)for(let e=0;e<this.lstLevelGroups[t].Total.length;e++)this.lstLevelGroups[t-1].Total[e]+=this.lstLevelGroups[t].Total[e],null!=this.lstLevelGroups[t].Row.DataRow&&"FLOAT"==this.oColumns[e].ColumnType&&(this.lstLevelGroups[t].Row.DataRow[this.oColumns[e].ID]=this.lstLevelGroups[t].Total[e]);if(!this.lstLevelGroups[t].TotalAtEnd&&this.lstLevelGroups[t].ShowTotal)for(let e=0;e<this.oColumns.length;e++)if("FLOAT"==this.oColumns[e].ColumnType){if(this.ShowBudgetVariancePercent&&!i.e.IsEmpty(this.oColumns[e].DataFormat.PercentageOn)){let s=e-this.VariancePercentIndex,o=0;this.lstLevelGroups[t].Total[s-1]>0&&0!=this.lstLevelGroups[t].Total[s-1]&&(o=100*this.lstLevelGroups[t].Total[s+this.VariancePercentIndex]/this.lstLevelGroups[t].Total[s-1]),this.FormatData(o,this.lstLevelGroups[t].Row,s+this.VariancePercentIndex);continue}this.FormatData(this.lstLevelGroups[t].Total[e],this.lstLevelGroups[t].Row,e)}if(e<=this.LevelNo){let e=this.ViewModel.Data.indexOf(this.lstLevelGroups[t].Row);if(e>=0)if(this.lstLevelGroups[t].TotalAtEnd){this.oSubTotal=this.NewReportRow(),this.oSubTotal.Type=n.f.BalanceBF,this.oSubTotal.Parent=this.lstLevelGroups[t].Row.Parent,this.oSubTotal.LevelNo=this.lstLevelGroups[t].Row.LevelNo,this.oSubTotal.DataRow=this.lstLevelGroups[t].Row.DataRow,this.oSubTotal.Cells[0].IsNormal=!1,this.oSubTotal.IsGroup=!0,this.oSubTotal.Visible=this.lstLevelGroups[t].Row.Visible,this.oSubTotal.Cells[0].level=this.lstLevelGroups[t].Row.LevelNo,this.oSubTotal.Cells[0].Text=this.lstLevelGroups[t].TotalCaption,this.oSubTotal.Cells[0].CellAppearance=this.ViewModel.ReportColumns[0].DataAppearance.Clone(),this.oSubTotal.Cells[0].CellAppearance.IsBold=!0,this.oSubTotal.Cells[0].CellAppearance.Alignment=this.oColumns[0].DataAppearance.Alignment;for(let e=0;e<this.oColumns.length;e++)"FLOAT"==this.oColumns[e].ColumnType&&(this.oSubTotal.Cells[e].IsNormal=!1,this.oSubTotal.Cells[e].CellAppearance=this.ViewModel.ReportColumns[e].DataAppearance.Clone(),this.oSubTotal.Cells[e].CellAppearance.IsBold=!0,this.oSubTotal.Cells[e].CellAppearance.Alignment=this.oColumns[e].DataAppearance.Alignment,this.oSubTotal.Cells[e].Border=this.ViewModel.TreeTotalBorder,0!=this.lstLevelGroups[t].TotalBorder&&(this.oSubTotal.Cells[e].Border=this.lstLevelGroups[t].TotalBorder),this.FormatData(this.lstLevelGroups[t].Total[e],this.oSubTotal,e)),(this.lstLevelGroups[t].TotalBackground||this.ViewModel.TreeTotalBorder<0||this.lstLevelGroups[t].TotalBorder<0)&&(null==this.oSubTotal.Cells[e].CellAppearance&&(this.oSubTotal.Cells[e].IsNormal=!1,this.oSubTotal.Cells[e].CellAppearance=this.oColumns[e].DataAppearance.Clone()),this.lstLevelGroups[t].TotalBackground&&(this.oSubTotal.Cells[e].CellAppearance.BackColor="#FFD8D8D8"),this.ViewModel.TreeTotalBorder<0&&this.oSubTotal.Cells.forEach(e=>{e.Border=this.ViewModel.TreeTotalBorder}),this.lstLevelGroups[t].TotalBorder<0&&this.oSubTotal.Cells.forEach(e=>{e.Border=this.lstLevelGroups[t].TotalBorder}));if(this.ShowBudgetVariancePercent){let e=0;this.lstLevelGroups[t].Total[this.BalIndex-1]>0&&0!=this.lstLevelGroups[t].Total[this.BalIndex-1]&&(e=100*this.lstLevelGroups[t].Total[this.BalIndex+this.VariancePercentIndex]/this.lstLevelGroups[t].Total[this.BalIndex-1]),this.FormatData(e,this.oSubTotal,this.BalIndex+this.VariancePercentIndex)}this.GrdRow++,this.ViewModel.addRow(this.oSubTotal)}else this.ViewModel.Data.Remove(this.lstLevelGroups[t].Row),this.ViewModel.Data.Insert(e,this.lstLevelGroups[t].Row)}this.lstLevelGroups.RemoveAt(t)}}GetBudgetAmount(e,t,s){let o,l=0,a=t;return e.forEach(e=>{for(a=t;a<=s;)o=a.ToString("MMMyyyy"),l+=i.e.Double(e[o]),a=a.AddMonths(1)}),l}GetBudgetAmount_dv(e){let t=0;return e.forEach(e=>{t+=parseFloat(e.AnnualAmount)}),t}FormatData(e,t,s){if(null==t.DataRow)return;let o=this.oColumns[s].DataFormat;o.ShowDefaultSign=-1,o.NegativeNumber=0,e<0?(this.formatNo=t.DataRow.Negative.toString(),o.NegativeNumber="-"==this.formatNo?0:"+"==this.formatNo?8:"Cr"==this.formatNo?4:"Dr"==this.formatNo?5:"(123)"==this.formatNo?2:12):(this.formatNo=t.DataRow.Positive.toString(),"-"==this.formatNo?(o.NegativeNumber=8,o.ShowDefaultSign=0):"+"==this.formatNo?(o.ShowDefaultSign=0,o.NegativeNumber=6):o.NegativeNumber="Cr"==this.formatNo?4:"Dr"==this.formatNo?5:"(123)"==this.formatNo?2:0),this.ViewModel.SetCellValue(e,o,this.oColumns[s].ColumnType,t.Cells[s])}}},OHLA:function(e,t,s){"use strict";s.d(t,"a",(function(){return g}));var o=s("Do2H"),i=s("Lp6j"),l=s("eQJW"),a=s("4HhE"),n=s("0/4Q"),r=s("PDNK"),h=s("wlFP"),u=s("n56n"),D=s("6z9j"),d=s("EQd/"),c=s("c9yc"),C=s("JIg3"),p=s("AGpa"),T=s("XPEG"),_=s("w8Sz"),m=s("dH+5"),I=s("8iaB"),R=s("vTM8"),S=s("7JXL"),A=s("MCLT");class M extends a.c{constructor(){super(),this.IsHorizontalOrientation=!1,this.CheckBox=new r.a,this.ComboBox=new n.e(0)}}class g extends I.a{constructor(e){super(),this.DefaultTreeSelectedNodes=null,this.Locations=new n.b,this.LocationWhere="",this.TreeID=0,this.TreeCCID=0,this.StockDimensionID=0,this.IsZeroSelected=!1,this.IsOneSelected=!1,this.IsGroupExists=!1,this.IsUserAllLocationsAssigned=!1,this.TreeVisibility=!1,this.DefaultVisible=!1,this.ParentReportDateFilter=null,this.MrpFromDate=new C.a(0),this.MrpToDate=new C.a(0),this.FromDate=new C.a(0),this.ToDate=new C.a(0),this.IsFirstLoaded=!1,this.FinalReportsShowVisibility=!1,this.FinalReportsShowEnable=!0,this.HideTagWiseBudget=!1,this.ButtonHeaderVis=!0,this.FCVisibility=!1,this.CompanyCurrency=new r.a,this.FCGUID=null,this.TagWiseGUID=null,this.TblProperties={Rows:new R.c},this.LockCheckedChanged=!1,this.ClassName="StaticReportFilterViewModel",this.MrpFromDate.Visible=!1,this.MrpToDate.Visible=!1;let t=i.e.String(e.Reportds.Tables[0][0].TreeXML);if(this.TreeCCID=this.TreeID=0,this.StaticTreeFilter="",this.Locations=new n.b,this.Locations.Height=100,this.ViewModel=e,this.CostCenterFilters=[],this.DefaultVisible=!!o.a.SessionManager.IsActionAssigned(200,"Set Defaults"),t.length>0){let e=new i.f;e.LoadXml(t);let s=e.SelectSingleNode("Tree/CCID");this.TreeCCID=null!=s?parseInt(s.innerHTML):0,s=e.SelectSingleNode("Tree/TreeID"),this.TreeID=null!=s?parseInt(s.innerHTML):0,s=e.SelectSingleNode("Tree/Filter"),this.StaticTreeFilter=null!=s?s.innerHTML:""}if(this.TreeCCID>0){if(e.HideCostCenterTree||(this.TreeVisibility=!0),this.CostCenters=new n.e(0),this.CostCenters.Label=o.a.GetResource("Reports_SelectCostCenter"),this.CostCenters.LblWidth="160",this.CostCenters.SelectionChangedCommand.Subscribe(this,"OnCostCenterChange"),e.FieldsDialog&&e.FieldsDialog.ReportFilterCostCenterList){let t,s=e.FieldsDialog.ReportFilterCostCenterList;if(e.Preferences.ContainsKey("TreeDimensionsFilter")){let t=[],o=new i.f;o.LoadXml("<XML>"+e.Preferences.TreeDimensionsFilter+"</XML>");for(let e=0;e<o.DocumentElement.children.length;e++){let i=o.DocumentElement.children[e],l=s.filter(e=>e.FeatureID==i.attributes.CCID.value);if(l.length>0){let e={};e.Name=l[0].Name,e.FeatureID=l[0].FeatureID,null!=i.attributes.Mandatory&&(e.Mandatory=i.attributes.Mandatory.value),t.push(e)}}s=t}if(s.forEach(s=>{t=null;let l=parseInt(s.FeatureID);73==e.StaticReportType||e.StaticReportType>=209&&e.StaticReportType<=215?92==l||93==l||l>5e4?t=n.d.ComboBoxItems_2(o.a.GetResource(s.Name.toString()),s.FeatureID.toString()):94!=l||73!=e.StaticReportType&&209!=e.StaticReportType&&210!=e.StaticReportType&&211!=e.StaticReportType||(t=n.d.ComboBoxItems_2(o.a.GetResource(s.Name.toString()),s.FeatureID.toString())):(2==l||3==l||113==l||l==this.TreeCCID||l>5e4)&&(t=n.d.ComboBoxItems_2(o.a.GetResource(s.Name.toString()),s.FeatureID.toString())),143==e.StaticReportType&&61==l?t=n.d.ComboBoxItems_2(o.a.GetResource(s.Name.toString()),s.FeatureID.toString()):16!=l||81!=e.StaticReportType&&158!=e.StaticReportType?(300==l&&(e.StaticReportType>=9&&e.StaticReportType<=11||e.StaticReportType>=13&&e.StaticReportType<=16||156==e.StaticReportType||171==e.StaticReportType||198==e.StaticReportType||200==e.StaticReportType)||503==l&&e.StaticReportType>=13&&e.StaticReportType<=16||7==l&&150==e.StaticReportType)&&(t=n.d.ComboBoxItems_2(o.a.GetResource(s.Name.toString()),s.FeatureID.toString())):t=n.d.ComboBoxItems_2(o.a.GetResource(s.Name.toString()),s.FeatureID.toString()),null!=t&&(e.Preferences.ContainsKey("TreeDimensionsFilter")&&(t.Aliasname=i.e.String(s.Mandatory)),this.CostCenters.Items.push(t))}),e.Preferences.ContainsKey("ShowLookups")&&e.Preferences.ShowLookups.length>0){let t=new i.f;t.LoadXml("<XML>"+e.Preferences.ShowLookups+"</XML>");for(let e=0;e<t.DocumentElement.children.length;e++){let s=t.DocumentElement.children[e];this.CostCenters.Items.push(n.d.ComboBoxItems_3(s.attributes.Name.value,"44",s.attributes.ID.value))}}}this.CostCenters.Visible=!1,(e.StaticReportType>=1&&e.StaticReportType<=16||[-2,73,81,82,83,84,86,89,90,97,98,99,100,111,115,127,140,143,150,155,156,157,158,160,168,171,190,195,198,200,203,204,209,210,211,212,213,214,215,286,288,289,306,307].Contains(e.StaticReportType))&&(this.CostCenters.Visible=!0),this.LoadTreeData()}else this.TreeVisibility=!1;if(168==e.StaticReportType){let t=o.a.report.DataSet("RPT002","").Tables[0];null!=t&&t.length>0&&e.Preferences.push("PropertyLinkDimension",t[0].value.toString())}if(this.DefaultProperties=[],this.SetDateFilters(),e.StaticReportType>=4&&e.StaticReportType<=8||14==e.StaticReportType||15==e.StaticReportType||97==e.StaticReportType||98==e.StaticReportType&&this.FromDate.Visible)if(this.FinalReportsShowVisibility=!0,this.TagWiseGUID=i.e.NewGuid(),this.FinalReportsShowNone=new r.a("None",0),this.FinalReportsShowNone.Label=o.a.GetResource("DocumentDesigner_None"),this.FinalReportsShowNone.IsChecked=!0,this.FinalReportsShowNone.GroupName="FinalReportsShow",this.FinalReportsShowMonthWise=new r.a("MonthWise",1),this.FinalReportsShowMonthWise.Label=o.a.GetResource("Reports_LblMonthWise"),this.FinalReportsShowMonthWise.Dependantinuse=!1,this.FinalReportsShowMonthWise.GroupName="FinalReportsShow",5!=e.StaticReportType&&6!=e.StaticReportType&&8!=e.StaticReportType||(this.FinalReportsShowMonthWise.Dependantinuse=!0,this.FinalReportsShowMonthWise.IsReadOnly=!1,this.FinalReportsShowMonthWise.Enable=!1,this.FinalReportsShowMonthWise.IsColumnUserDefined=!1),this.FinalReportsShowQtrWise=new r.a("QtrWise",1),this.FinalReportsShowQtrWise.Label=o.a.GetResource("Reports_LblQuarterWise"),this.FinalReportsShowQtrWise.Dependantinuse=!1,this.FinalReportsShowQtrWise.GroupName="FinalReportsShow",5==e.StaticReportType||6==e.StaticReportType||8==e.StaticReportType?(this.FinalReportsShowQtrWise.Dependantinuse=!0,this.FinalReportsShowQtrWise.IsReadOnly=!1,this.FinalReportsShowQtrWise.Enable=!1,this.FinalReportsShowQtrWise.IsColumnUserDefined=!1):98==e.StaticReportType&&this.FromDate.Visible||4==e.StaticReportType||7==e.StaticReportType||(this.FinalReportsShowQtrWise.Visible=!1),this.FinalReportsShowHYWise=new r.a("HYWise",1),this.FinalReportsShowHYWise.Label=o.a.GetResource("Reports_LblHalfYearWise"),this.FinalReportsShowHYWise.Dependantinuse=!1,this.FinalReportsShowHYWise.GroupName="FinalReportsShow",8==e.StaticReportType?(this.FinalReportsShowHYWise.Dependantinuse=!0,this.FinalReportsShowHYWise.IsReadOnly=!1,this.FinalReportsShowHYWise.Enable=!1,this.FinalReportsShowHYWise.IsColumnUserDefined=!1):this.FinalReportsShowHYWise.Visible=!1,this.FinalReportsShowYearWise=new r.a("YearWise",1),this.FinalReportsShowYearWise.Label=o.a.GetResource("Reports_LblYearWise"),this.FinalReportsShowYearWise.Dependantinuse=!1,this.FinalReportsShowYearWise.GroupName="FinalReportsShow",5!=e.StaticReportType&&6!=e.StaticReportType&&8!=e.StaticReportType||(this.FinalReportsShowYearWise.Dependantinuse=!0,this.FinalReportsShowYearWise.IsReadOnly=!1,this.FinalReportsShowYearWise.Enable=!1,this.FinalReportsShowYearWise.IsColumnUserDefined=!1),this.FinalReportsShowTagWise=new M,this.FinalReportsShowTagWise.GroupName="FinalReportsShow",this.FinalReportsShowTagWise.ComboBox.SysTableName="0",14==e.StaticReportType||98==e.StaticReportType&&this.FromDate.Visible?this.FinalReportsShowTagWise.Visible=!1:(this.FinalReportsShowTagWise.CheckBox.Label=o.a.GetResource("Reports_LblTagWise"),this.LoadDropDownData(this.FinalReportsShowTagWise.ComboBox,"TagWise")),4==e.StaticReportType&&(this.FinalReportsShowYearWise.Visible=!1),15==e.StaticReportType&&(this.FinalReportsShowNone.CheckedChangedCommand.Subscribe(this,"OnRadioChecked"),this.FinalReportsShowMonthWise.CheckedChangedCommand.Subscribe(this,"OnRadioChecked"),this.FinalReportsShowYearWise.CheckedChangedCommand.Subscribe(this,"OnRadioChecked")),this.FinalReportsShow={Items:[]},this.FinalReportsShow.Items.push(this.FinalReportsShowNone),this.FinalReportsShow.Items.push(this.FinalReportsShowHYWise),this.FinalReportsShow.Items.push(this.FinalReportsShowMonthWise),this.FinalReportsShow.Items.push(this.FinalReportsShowQtrWise),this.FinalReportsShow.Items.push(this.FinalReportsShowTagWise.CheckBox),this.FinalReportsShow.Items.push(this.FinalReportsShowYearWise),this.FinalReportsShowNone.Group=this.FinalReportsShow,this.FinalReportsShowHYWise.Group=this.FinalReportsShow,this.FinalReportsShowMonthWise.Group=this.FinalReportsShow,this.FinalReportsShowQtrWise.Group=this.FinalReportsShow,this.FinalReportsShowTagWise.CheckBox.Group=this.FinalReportsShow,this.FinalReportsShowYearWise.Group=this.FinalReportsShow,this.CurrentBudget=new n.e(0),8==e.StaticReportType||97==e.StaticReportType&&"TRUE"!=o.a.SessionManager.Preferences.WEFINReportTemplate.toString().toUpperCase()){this.CurrentBudget.Visible=!0,this.CurrentBudget.DBColumnName="CurrentBudgets",this.CurrentBudget.Label=o.a.GetResource("Reports_CurrentYear"),this.PreviousBudget=new n.e(0),this.PreviousBudget.DBColumnName="PreviousBudgets",this.PreviousBudget.Label=o.a.GetResource("Reports_PreviousYear");let e=o.a.report.DataSet("RPT003","");this.CurrentBudget.Items.push(n.d.ComboBoxItems_2(o.a.GetResource("Reports_None"),"0")),this.PreviousBudget.Items.push(n.d.ComboBoxItems_2(o.a.GetResource("Reports_None"),"0")),e.Tables[0].forEach(e=>{this.CurrentBudget.Items.push(n.d.ComboBoxItems_2(e.BudgetName.toString(),e.BudgetDefID.toString())),this.PreviousBudget.Items.push(n.d.ComboBoxItems_2(e.BudgetName.toString(),e.BudgetDefID.toString()))}),this.CurrentBudget.SelectedItem=this.CurrentBudget.Items[0],this.CurrentBudget.SelectedValue=this.CurrentBudget.Items[0].Value,this.PreviousBudget.SelectedItem=this.PreviousBudget.Items[0],this.PreviousBudget.SelectedValue=this.PreviousBudget.Items[0].Value,this.ShowActualBudget=new h.a(0),this.ShowVariance=new h.a(0),this.ShowVariancePercent=new h.a(0),this.ShowTotalBudget=new h.a(0),this.ShowActualBudget.Label=o.a.GetResource("Reports_ShowActualBudget"),this.ShowVariance.Label=o.a.GetResource("Reports_ShowVaraince"),this.ShowVariancePercent.Label=o.a.GetResource("Reports_ShowVaraince%"),this.ShowTotalBudget.Label=o.a.GetResource("Reports_ShowTotalBudget")}else this.CurrentBudget.Visible=!1;else this.FinalReportsShowVisibility=!1;this.Locations.CheckedChangedCommand.Subscribe(this,"OnCheckedChanged"),this.Locations.Row=15,this.Locations.Visible=!1,this.Locations.Label="Location",this.Locations.Width="320",this.Locations.ColumnSpan=2,this.Locations.DBColumnID=50002,this.Locations.DBColumnName="DEFAULT_LOCATION",(e.StaticReportType>=13&&e.StaticReportType<=16||81==e.StaticReportType||82==e.StaticReportType||83==e.StaticReportType||84==e.StaticReportType||111==e.StaticReportType||114==e.StaticReportType||115==e.StaticReportType||158==e.StaticReportType||159==e.StaticReportType||195==e.StaticReportType)&&o.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&i.e.IsNum(o.a.SessionManager.Preferences["Maintain Dimensionwise stock"])&&(this.StockDimensionID=i.e.Int(o.a.SessionManager.Preferences["Maintain Dimensionwise stock"]),this.StockDimensionID>0&&(this.Locations.DBColumnID=this.StockDimensionID));let s=!1;if("True"==o.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==o.a.SessionManager.Preferences["LW Reports"]&&(s=!0),e.Preferences.ContainsKey("DontApplyLocationFilter")&&"1"==e.Preferences.DontApplyLocationFilter&&(this.StockDimensionID=0,s=!1),s&&50002==this.Locations.DBColumnID){this.StockDimensionID=50002;let t=[-2,62,63,65,72,73,81,82,83,84,90,91,92,93,98,99,100,111,114,115,116,117,118,120,129,130,131,133,134,135,136,137,138,139,140,145,150,152,153,155,157,158,159,198,200];(e.StaticReportType>=1&&e.StaticReportType<=16||t.Contains(e.StaticReportType))&&(this.Locations.Visible=!0);let s=[];s.push(50002),s.push(o.a.SessionManager.LanguageID);let i=o.a.admin.getLocationRoles(s);this.Locations.Items.push(n.c.CheckedListBoxItem_4("All","All","DEFAULT_LOCATION")),i.Tables[0].SortBy(["Name"]);let a=i.Tables[0],r=o.a.SessionManager.LocationWhere.split(",");for(let e=0;e<a.length;e++)r.Contains(a[e].NodeID.toString())&&"86"!=a[e].StatusID.toString()&&(Object(l.j)(a[e].IsGroup)||(this.Locations.Items.push(n.c.CheckedListBoxItem_4(a[e].Name.toString(),a[e].NodeID.toString(),"DEFAULT_LOCATION")),parseInt(this.Locations.Items[this.Locations.Items.length-1].Value)==o.a.SessionManager.LocationID&&(this.Locations.Items[this.Locations.Items.length-1].IsChecked=!0)));let h=o.a.report.DataSet("RPT004",this.Locations.DBColumnID.toString(),o.a.SessionManager.LanguageID);if(this.Locations.Label=h.Tables[0][0].Name.toString(),0==o.a.SessionManager.LocationID)for(let e=0;e<this.Locations.Items.length;e++)this.Locations.Items[e].IsChecked=!0}else if(this.StockDimensionID>0){this.Locations.Visible=!0;let e=!1;if("1"!=o.a.SessionManager.UserID&&"1"!=o.a.SessionManager.RoleID){let t=o.a.SessionManager.Preferences["Dimension List"].split(",");for(let s=0;s<t.length;s++)if(t[s]==this.StockDimensionID.toString()){e=!0;break}}let t=o.a.report.DataSet("RPT005",this.StockDimensionID.toString(),e?"1":"0",o.a.SessionManager.UserID);null!=t&&t.Tables.length>1&&(this.Locations.Items.push(n.c.CheckedListBoxItem_4("All","All","DEFAULT_LOCATION")),this.Locations.Items[0].IsChecked=!0,t.Tables[1].sort((e,t)=>e.Name>t.Name?1:-1),t.Tables[1].forEach(e=>{this.Locations.Items.push(n.c.CheckedListBoxItem_4(e.Name.toString(),e.NodeID.toString(),"DEFAULT_LOCATION")),this.Locations.Items[this.Locations.Items.length-1].IsChecked=!0}),this.Locations.Label=t.Tables[0][0].Name.toString(),e&&t.Tables.length>2&&0==parseInt(t.Tables[2][0].CNT)&&(this.IsUserAllLocationsAssigned=!0))}if(this.Locations.Visible&&e.Preferences.ContainsKey("SelectAllLocations")&&"1"==e.Preferences.SelectAllLocations)for(let o=0;o<this.Locations.Items.length;o++)this.Locations.Items[o].IsChecked=!0;this.DefaultProperties.push(this.Locations),this.LoadProperties()}GetSeqNosList(){if(this.IsZeroSelected=this.IsOneSelected=!1,null==this.DefaultTreeSelectedNodes)return this.IsZeroSelected=!0,"0";let e="";return this.DefaultTreeSelectedNodes.forEach(t=>{e+=t.Id+","}),e.length>0?(e=e.substr(0,e.length-1),this.DefaultTreeSelectedNodes.filter(e=>1==e.Id).length>0&&(this.IsOneSelected=!0)):this.CostCenterFilters.find(e=>e.SelectedNodes==this.DefaultTreeSelectedNodes&&!e.DeleteButtonVisibility)?e+="-12345":(this.IsZeroSelected=!0,e+=0),e}GetSeqNosListWithRoots(){if(this.IsZeroSelected=this.IsOneSelected=this.IsGroupExists=!1,null==this.DefaultTreeSelectedNodes)return this.IsZeroSelected=!0,"0";this.IsDynamicTree=!1;let e="";return""!=o.a.SessionManager.Preferences.DynamicTrees&&o.a.SessionManager.Preferences.DynamicTrees.split(",").Contains(this.TreeCCID.toString())&&(this.IsDynamicTree=!0),this.DefaultTreeSelectedNodes.forEach(this.IsDynamicTree?t=>{t.IsGroup&&(this.IsGroupExists=!0),e+=t.Id+","}:t=>{null!=t.Parent&&t.Parent.IsSelected?this.IsGroupExists=!0:(t.IsGroup&&(this.IsGroupExists=!0),e+=t.Id+",")}),e.length>0?(e=e.substr(0,e.length-1),this.DefaultTreeSelectedNodes.filter(e=>1==e.Id).length>0&&(this.IsOneSelected=!0)):(this.IsZeroSelected=!0,e+=0),e.toString()}SetDateFilters(){this.FromDate.Date=this.ViewModel.ReportViewType==m.e.General?o.a.SessionManager.ReportsFromDate:"FinancialYear"==o.a.SessionManager.Preferences.ReportDate?o.a.SessionManager.FinancialYearStartDate:o.a.SessionManager.AccountingDate;let e=this.ViewModel.ReportDoc.SelectNodes("PactRevenURpts/Filters/PreDataFetch/FieldFilter/FilterDef");for(let t=0;t<e.length;t++){let s=e[t];if(23145==parseInt(i.f.SelectSingleNodeText(s,"CCColID"))){let e=i.f.SelectSingleNode(s,"DefaultFromVal");null!=e&&(this.FromDate.Date=T.a.GetDateFromKeyWord(e.innerHTML)),e=i.f.SelectSingleNode(s,"DefaultToVal"),null!=e&&(this.ToDate.Date=T.a.GetDateFromKeyWord(e.innerHTML))}}if(this.FromDate.Label=o.a.GetResource("Reports_LblFromDate"),this.ToDate.Label=o.a.GetResource("Reports_LblToDate"),this.MrpDateRanges=this.DateRanges=_.a.getDateRanges(),this.DateRanges.SelectionChangedCommand.Subscribe(this,"OnDateRangesSelectionChanged"),this.MrpDateRanges.SelectionChangedCommand.Subscribe(this,"OnDateRangesSelectionChanged"),this.MrpDateRanges.Visible=!1,this.ViewModel.StaticReportType>=9&&this.ViewModel.StaticReportType<=12||this.ViewModel.StaticReportType>=81&&this.ViewModel.StaticReportType<=84||16==this.ViewModel.StaticReportType||71==this.ViewModel.StaticReportType||31==this.ViewModel.StaticReportType||87==this.ViewModel.StaticReportType||91==this.ViewModel.StaticReportType||98==this.ViewModel.StaticReportType||127==this.ViewModel.StaticReportType||148==this.ViewModel.StaticReportType||159==this.ViewModel.StaticReportType||168==this.ViewModel.StaticReportType||140==this.ViewModel.StaticReportType||171==this.ViewModel.StaticReportType||195==this.ViewModel.StaticReportType||203==this.ViewModel.StaticReportType||204==this.ViewModel.StaticReportType||212==this.ViewModel.StaticReportType||288==this.ViewModel.StaticReportType||287==this.ViewModel.StaticReportType||303==this.ViewModel.StaticReportType)this.FromDate.Visible=!1,this.ToDate.Visible=!0,this.ToDate.Label=o.a.GetResource("AsOn"),11==this.ViewModel.StaticReportType||12==this.ViewModel.StaticReportType?(this.ViewModel.Preferences.ContainsKey("ShowMonthWiseFromDatePicker")&&"1"==this.ViewModel.Preferences.ShowMonthWiseFromDatePicker&&(this.ToDate.Label=o.a.GetResource("Reports_LblFromDate")),12==this.ViewModel.StaticReportType&&this.ViewModel.ReportColumns.find(e=>"PeriodSale"==e.ID)&&(this.FromDate.Visible=!0)):171==this.ViewModel.StaticReportType?this.ViewModel.Preferences.ContainsKey("ToDateVal")||(this.ToDate.Visible=!1):288==this.ViewModel.StaticReportType||289==this.ViewModel.StaticReportType?(this.ToDate.CustomFormat="MMM-yyyy",this.ToDate.Label="Payroll Month"):190==this.ViewModel.StaticReportType?this.ToDate.Label="Day":212==this.ViewModel.StaticReportType&&(this.ToDate.Label="Date"),this.ViewModel.Preferences.ContainsKey("AllowFromDateFilter")&&"1"==this.ViewModel.Preferences.AllowFromDateFilter&&(this.FromDate.Visible=!0);else if(15==this.ViewModel.StaticReportType)this.ViewModel.Preferences.ContainsKey("SalesDocs")&&this.ViewModel.Preferences.SalesDocs.length>0?(this.FromDate.Visible=!0,this.ToDate.Visible=!0):(this.FromDate.Visible=!1,this.ToDate.Visible=!0,this.ToDate.Label=o.a.GetResource("AsOn"));else if(89==this.ViewModel.StaticReportType)this.FromDate.Date=Date.Today(),this.ToDate.Date=Date.Today();else if(146==this.ViewModel.StaticReportType)this.FromDate.Date=Date.Today().AddMonths(-1),this.ToDate.Date=Date.Today();else if(149==this.ViewModel.StaticReportType)this.FromDate.Date=Date.Today().AddDays(-7),this.ToDate.Date=Date.Today();else if(65==this.ViewModel.StaticReportType||111==this.ViewModel.StaticReportType||120==this.ViewModel.StaticReportType||196==this.ViewModel.StaticReportType||202==this.ViewModel.StaticReportType||210==this.ViewModel.StaticReportType||214==this.ViewModel.StaticReportType||215==this.ViewModel.StaticReportType||287==this.ViewModel.StaticReportType||294==this.ViewModel.StaticReportType||303==this.ViewModel.StaticReportType)this.FromDate.Visible=!1,this.ToDate.Visible=!1;else if(114==this.ViewModel.StaticReportType&&Object(l.j)(o.a.SessionManager.Preferences.OpenCompany)){let e=o.a.report.DataSet("RPT006","");null!=e&&e.length>0&&e.Columns.Contains("ToDate")&&e[0].ToDate&&(this.FromDate.Date=new Date(e[0].ToDate).AddDays(1),this.FromDate.Date>Date.Today()&&(this.FromDate.Date=this.FromDate.Date.AddYears(-1)))}if(this.DateRanges.Visible=!(!this.FromDate.Visible||!this.ToDate.Visible),this.ToDate.Visible&&this.ViewModel.Preferences.ContainsKey("ToDateVal")){let e=new i.f;e.LoadXml("<XML>"+this.ViewModel.Preferences.ToDateVal+"</XML>");let t=e.SelectSingleNodeText("XML/Cond");if("PAST"==t||"FUTURE"==t){let s=i.e.Int(e.SelectSingleNodeText("XML/Days"));"PAST"==t&&(s=-s),this.ToDate.Date=Date.Today().AddDays(s)}else this.ToDate.Date=T.a.GetDateFromKeyWord(t)}if(this.FromDate.Visible&&this.ViewModel.Preferences.ContainsKey("FromDateVal")){let e=new i.f;e.LoadXml("<XML>"+this.ViewModel.Preferences.FromDateVal+"</XML>");let t=e.SelectSingleNodeText("XML/Cond");this.FromDate.Date=T.a.GetDateFromKeyWord(t)}this.FromDate.Visible&&this.ViewModel.Preferences.ContainsKey("ShowDateMonthYear")&&(this.FromDate.ShowMonthYear=!0),this.ToDate.Visible&&this.ViewModel.Preferences.ContainsKey("ShowDateMonthYear")&&(this.ToDate.IsFromDate=!1,this.ToDate.ShowMonthYear=!0),this.ToDate_PropertyChanged(null,null)}LoadTreeData(){let e=null,t=null;this.tree=[];let s,l=this.ViewModel.ReportDoc.SelectSingleNode("PactRevenURpts/Filters/PreDataFetch/TreeFilter"),a=!1;if(i.f.SelectNodes(l,"FilterDef").forEach(e=>{i.f.SelectSingleNodeText(e,"CCID")==this.TreeCCID.toString()&&(a=!0)}),a||this.ViewModel.ReportDoc.AppendChild(l,"<FilterDef><CCID>"+this.TreeCCID+"</CCID><GridViewID>"+this.TreeID+"</GridViewID><DefaultValues></DefaultValues></FilterDef>"),this.ViewModel.ReportViewType!=m.e.Export&&!o.a.SessionManager.IsWinServiceCall){let e=50002;if((this.ViewModel.StaticReportType>=13&&this.ViewModel.StaticReportType<=16||81==this.ViewModel.StaticReportType||82==this.ViewModel.StaticReportType||83==this.ViewModel.StaticReportType||84==this.ViewModel.StaticReportType||111==this.ViewModel.StaticReportType||114==this.ViewModel.StaticReportType||115==this.ViewModel.StaticReportType||158==this.ViewModel.StaticReportType||159==this.ViewModel.StaticReportType||195==this.ViewModel.StaticReportType)&&o.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&i.e.IsNum(o.a.SessionManager.Preferences["Maintain Dimensionwise stock"])&&(this.StockDimensionID=i.e.Int(o.a.SessionManager.Preferences["Maintain Dimensionwise stock"]),this.StockDimensionID>0&&(e=this.StockDimensionID)),50002!=e&&"True"==o.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==o.a.SessionManager.Preferences["LW Reports"]){var n=this.CostCenters.Items.find(e=>"50002"==e.Value);null!=n&&(n.Aliasname="");let e=null;if(i.f.SelectNodes(l,"FilterDef").forEach(t=>{"50002"!=i.f.SelectSingleNode(t,"CCID").innerHTML||(e=t)}),null==e){let e=0==i.f.SelectNodes(l,"FilterDef").length?"1":"0";e=this.ViewModel.Preferences.ContainsKey("SelectAllLocations")||0==o.a.SessionManager.LocationID?"<CCID>50002</CCID><GridViewID>0</GridViewID><IsDefaultCC>"+e+"</IsDefaultCC><DefaultValues>"+o.a.SessionManager.LocationWhere+"</DefaultValues>":"<CCID>50002</CCID><GridViewID>0</GridViewID><IsDefaultCC>"+e+"</IsDefaultCC><DefaultValues>"+o.a.SessionManager.LocationID+"</DefaultValues>",e="<FilterDef>"+e+"</FilterDef>",i.f.AppendChild(l,e)}else{let t=i.f.SelectSingleNode(e,"DefaultValues");if(null!=t)if(this.ViewModel.Preferences.ContainsKey("SelectAllLocations")&&"1"==this.ViewModel.Preferences.SelectAllLocations)t.innerHTML=o.a.SessionManager.LocationWhere;else if(0==t.innerHTML.length)t.innerHTML=0!=o.a.SessionManager.LocationID?o.a.SessionManager.LocationID.toString():o.a.SessionManager.LocationWhere;else{let e=t.innerHTML.split(","),s=o.a.SessionManager.LocationWhere.split(","),i="";e.forEach(e=>{s.Contains(e)&&(i.length>0&&(i+=","),i+=e)}),t.innerHTML=i}}}}if("1"!=o.a.SessionManager.UserID&&"1"!=o.a.SessionManager.RoleID){let e=o.a.SessionManager.Preferences.ContainsKey("Dimension List")?o.a.SessionManager.Preferences["Dimension List"].split(","):[],t=this.CostCenters.Items.filter(e=>"1"==e.Aliasname);for(let s=0;s<t.length;s++){let a=t[s],n="",r="";if(e.Contains(a.Value)&&parseInt(a.Value)>5e4){let e=o.a.report.IsGroupNode(parseInt(a.Value),0),t=o.a.report.GetDataTable("RPT027",e.TableName,o.a.SessionManager.UserID,a.Value);r=n="",t.forEach(e=>{n.length>0&&(n+=","),n+=e.NodeID.toString()})}let h=null,u=i.f.SelectNodes(l,"FilterDef");for(let e=0;e<u.length;e++){let t=u[e];if(i.f.SelectSingleNodeText(t,"CCID")==a.Value){h=t;break}}if(null==h){let e;e=0==i.f.SelectNodes(l,"FilterDef").length?"<CCID>"+a.Value+"</CCID><GridViewID>0</GridViewID><IsDefaultCC>1</IsDefaultCC><DefaultValues>"+n+"</DefaultValues>":"<CCID>"+a.Value+"</CCID><GridViewID>0</GridViewID><IsDefaultCC>0</IsDefaultCC><DefaultValues>"+n+"</DefaultValues>",e="<FilterDef>"+e+"</FilterDef>",this.ViewModel.ReportDoc.AppendChild(l,e)}else{let e=i.f.SelectSingleNode(h,"DefaultValues");null!=e&&0==e.innerHTML.length&&(e.innerHTML=n)}}}if(o.a.SessionManager.RoleType>0){let e=null,t="2";1==o.a.SessionManager.RoleType?t="50051":o.a.SessionManager.LoginDimension>0&&(t=o.a.SessionManager.LoginDimension.toString());let s=i.f.SelectNodes(l,"FilterDef");for(let o=0;o<s.length;o++){let l=s[o];if(i.f.SelectSingleNodeText(l,"CCID")==t){e=l;break}}if(null==e){let e;e=0==i.f.SelectNodes(l,"FilterDef").length?"<CCID>"+t+"</CCID><GridViewID>0</GridViewID><IsDefaultCC>1</IsDefaultCC><DefaultValues>"+o.a.SessionManager.ESSID+"</DefaultValues>":"<CCID>"+t+"</CCID><GridViewID>0</GridViewID><IsDefaultCC>0</IsDefaultCC><DefaultValues>"+o.a.SessionManager.ESSID+"</DefaultValues>",e="<FilterDef>"+e+"</FilterDef>",this.ViewModel.ReportDoc.AppendChild(l,e)}else{let t=i.f.SelectSingleNode(e,"DefaultValues");null!=t&&(t.innerHTML=o.a.SessionManager.ESSID.toString())}}this.ViewModel.IgnoreTreeLoad=!(this.ViewModel.ReportViewType==m.e.General&&!this.ViewModel.HideCostCenterTree);let r=i.f.SelectNodes(l,"FilterDef");for(let o=0;o<r.length;o++){let l=r[o],a=i.f.SelectSingleNodeText(l,"CCID"),n=this.CostCenters.Items.find(e=>e.Value==a);if(!n)continue;if(s="44"==a&&null!=i.f.SelectSingleNode(l,"LookupTypeID")?parseInt(i.f.SelectSingleNodeText(l,"LookupTypeID")):0,"44"==n.Value&&n.Parent!=s.toString())continue;let h=new S.a(parseInt(a),s.toString(),n.Name,this);h.SetSelectedNodes(l),h.IsVisible||this.CostCenters.Items.Remove(n);let u=null!=i.f.SelectSingleNode(l,"IsDefaultCC")&&"1"==i.f.SelectSingleNodeText(l,"IsDefaultCC");u&&(n.ExchgRate=1,0==this.TreeCCID&&(this.TreeCCID=parseInt(a))),this.TreeCCID==parseInt(a)&&(this.DefaultTreeSelectedNodes=h.SelectedNodes),this.ViewModel.IgnoreTreeLoad||(u&&(this.CostCenters.SelectedValue=a.toString(),this.CostCenters.SelectedItem=n,this.LoadCostCenterTree(parseInt(a),s,0,h.SelectedNodes),this.tree.length>0&&(e=this.tree[0])),this.TreeCCID==parseInt(a)&&(u||this.LoadCostCenterTree(parseInt(a),s,0,h.SelectedNodes),this.tree.length>0&&(t=this.tree[0]))),"1"==n.Aliasname&&(h.DeleteButtonVisibility=!1),this.CostCenterFilters.push(h)}if(null!=e)this.tree[0]!=e&&(this.tree.Clear(),this.tree.push(e),this.SelectedNodes=e.SelectedNodes,this.SelectedNode=e.SelectedNode);else if(null!=t){let e=this.CostCenters.Items.find(e=>parseInt(e.Value)==this.TreeCCID);e&&(this.CostCenters.SelectedValue=this.TreeCCID.toString(),this.CostCenters.SelectedItem=e),this.tree[0]!=t&&(this.tree.Clear(),this.tree.push(t),this.SelectedNodes=t.SelectedNodes,this.SelectedNode=t.SelectedNode)}o.a.SessionManager.RoleType>0&&(this.TreeVisibility=!1,this.CostCenterFilters.map(e=>e.IsVisible=!1))}LoadProperties(){let e=i.e.StringValue(this.ViewModel.Reportds.Tables[0][0].DefaultPreferences).toString(),t=this.GetPropertiesUIXML();if(t.length>0){let s=new i.f,l=new i.f;if(e.length>0&&s.LoadXml(e),l.LoadXml(t),0!=l.DocumentElement.children.length){let t,a=null;for(let D=0;D<l.DocumentElement.children.length;D++){let T=l.DocumentElement.children[D];if(e.length>0&&(a=i.f.SelectSingleNode(s.DocumentElement,T.nodeName)),t=null,"CheckBox"==T.attributes.Type.value){let e=new h.a(0);e.Label=o.a.GetResource("Reports_Lbl"+T.nodeName,T.nodeName),e.DBColumnName=T.nodeName,e.CheckedChangedCommand.Subscribe(this,"OnCheckBoxChecked"),null!=a&&"1"==a.innerHTML&&(e.IsChecked=!0),t=e}else if("TextBox"==T.attributes.Type.value){let e=new d.d(0);e.DisableLbl=!1,e.Label=o.a.GetResource("Reports_Lbl"+T.nodeName,T.nodeName),e.Width=T.attributes.Width.value,null!=T.attributes.IsHorizontal&&"1"==T.attributes.IsHorizontal.value&&(e.IsHorizontalOrientation=!0),null==a||i.e.IsEmpty(a.innerHTML)?null!=T.attributes.Text&&(e.Text=T.attributes.Text.value):e.Text=a.innerHTML,t=e}else if("Radio"==T.attributes.Type.value){let e=new r.b(o.a.GetResource("Reports_Lbl"+T.nodeName,T.nodeName));null!=T.attributes.IsHorizontal&&"1"==T.attributes.IsHorizontal.value&&(e.IsHorizontalOrientation=!0);let s=T.attributes.Items.value.split("~"),i=T.attributes.Values.value.split("~");for(let t=0;t<s.length;t++){let l=new r.a("A",0);l.DBColumnName=i[t],l.Label=o.a.GetResource("Reports_Lbl"+s[t],s[t]),l.CheckedChangedCommand.Subscribe(this,"OnRadioChecked"),l.Group=e,e.Items.push(l),null!=a&&i[t]==a.innerHTML&&(l.IsChecked=!0)}if(null==e.CheckedItem&&null!=T.attributes.DefaultValue)for(let t=0;t<e.Items.length;t++){let s=e.Items[t];if(T.attributes.DefaultValue.value==s.DBColumnName){s.IsChecked=!0;break}}t=e}else if("CheckList"==T.attributes.Type.value){let e=new c.a(o.a.GetResource("Reports_Lbl"+T.nodeName,T.nodeName));null!=T.attributes.IsHorizontal&&"1"==T.attributes.IsHorizontal.value&&(e.IsHorizontalOrientation=!0);let s=T.attributes.Items.value.split("~"),l=T.attributes.Values.value.split("~");for(let t=0;t<s.length;t++){let n=h.a.PactCheckBoxData_1("A",0);n.DBColumnName=l[t],n.Label=o.a.GetResource("Reports_Lbl"+s[t],s[t]),e.Items.push(n),null!=a&&null!=i.f.SelectSingleNode(a,l[t])&&(n.IsChecked=!0)}t=e}else if("TextList"==T.attributes.Type.value){let e=new p.c(o.a.GetResource("Reports_Lbl"+T.nodeName,T.nodeName));if(null!=T.attributes.IsHorizontal&&"1"==T.attributes.IsHorizontal.value&&(e.IsHorizontalOrientation=!0),"Slabs"==T.nodeName){let t=4;this.ViewModel.Preferences.ContainsKey("SlabSize")&&(t=i.e.Int(this.ViewModel.Preferences.SlabSize),t<=0&&(t=4));for(let s=1;s<=t;s++){let t=d.d.PactTextBoxData_2("A",0);t.DisableLbl=!1,t.DBColumnName="Slab"+s,t.Label=o.a.GetResource("Reports_LblSlab","Slab")+" "+s,e.Items.push(t),t.Width="40",t.Text=null!=a&&null!=i.f.SelectSingleNode(a,"Slab"+s)?i.f.SelectSingleNodeText(a,"Slab"+s):"0"}}t=e}else if("CheckedTextBox"==T.attributes.Type.value){let e=new p.b;if(e.CheckBox.Label=o.a.GetResource("Reports_Lbl"+T.nodeName,T.nodeName),null!=T.attributes.CheckWidth){let t=i.e.Int(T.attributes.CheckWidth.value)+15;e.CheckBox.Width=t.toString()}if(e.TextBox.Width=T.attributes.TextWidth.value,null!=T.attributes.IsHorizontal&&"1"==T.attributes.IsHorizontal.value&&(e.IsHorizontalOrientation=!0),null!=T.attributes.Text&&(e.TextBox.Text=T.attributes.Text.value),null!=a){let t=i.f.SelectSingleNode(a,"IsChecked");null!=t&&"1"==t.innerHTML&&(e.CheckBox.IsChecked=!0),t=i.f.SelectSingleNode(a,"Text"),null==t||i.e.IsEmpty(t.innerHTML)||(e.TextBox.Text=t.innerHTML)}t=e}else if("CheckedComboBox"==T.attributes.Type.value||"TagWiseComboBox"==T.attributes.Type.value){let e=new p.a;if(e.DataType=T.attributes.Type.value,"TagWiseComboBox"==e.DataType?(e.IsColumnUserDefined=!0,e.ComboBox.SelectedIndex=1,e.ComboBox.IsReadOnly=!1):e.IsColumnUserDefined=!1,e.CheckBox.Label=o.a.GetResource("Reports_Lbl"+T.nodeName,T.nodeName),null!=T.attributes.CheckWidth&&(e.CheckBox.Width=(i.e.Int(T.attributes.CheckWidth.value)+20).toString()),e.ComboBox.Width=T.attributes.ComboWidth.value,null!=T.attributes.IsHorizontal&&"1"==T.attributes.IsHorizontal.value&&(e.IsHorizontalOrientation=!0),this.LoadDropDownData(e.ComboBox,T.nodeName),null!=a){let t=i.f.SelectSingleNode(a,"IsChecked");(null!=t&&"1"==t.innerHTML||"1"==a.innerHTML)&&(e.CheckBox.IsChecked=!0),t=i.f.SelectSingleNode(a,"Value"),null==t||i.e.IsEmpty(t.innerHTML)||(e.ComboBox.SelectedValue=t.innerHTML),"TagWiseComboBox"==e.DataType&&(t=i.f.SelectSingleNode(a,"Column"),null==t||i.e.IsEmpty(t.innerHTML)||(e.ComboBox.SelectedIndex=parseInt(t.innerHTML)),t=i.f.SelectSingleNode(a,"HideColumns"),null==t||i.e.IsEmpty(t.innerHTML)||(e.ComboBox.IsReadOnly=!0))}t=e}else if("ComboBox"==T.attributes.Type.value){let e=new n.e(0);if(e.DisableLbl=!1,e.Label=o.a.GetResource("Reports_Lbl"+T.nodeName,T.nodeName),null!=T.attributes.Width&&(e.Width=T.attributes.Width.value),e.KeyTip=null!=T.attributes.LabelWidth?T.attributes.LabelWidth.value:"",this.LoadDropDownData(e,T.nodeName),null!=T.attributes.Values){let t=T.attributes.Items.value.split("~"),s=T.attributes.Values.value.split("~");for(let i=0;i<t.length;i++){let l=n.d.ComboBoxItems_2(o.a.GetResource("Reports_Lbl"+t[i],t[i]),s[i]);e.Items.push(l),null!=a&&s[i]==a.innerHTML&&(e.SelectedValue=a.innerHTML)}null==e.SelectedValue&&null!=T.attributes.DefaultValue&&(e.SelectedValue=T.attributes.DefaultValue.value)}t=e}else if("PactListBoxData"==T.attributes.Type.value){let s=new u.b(0);if(s.DisableLbl=!1,s.CCID=parseInt(T.attributes.CostCenter.value),s.TypeID=parseInt(T.attributes.TypeID.value),null!=T.attributes.CustomWhere&&(s.CustomWhere=T.attributes.CustomWhere.value),s.Width="250",s.Label="EnquiryNo"==T.nodeName?o.a.GetResource("Reports_LblDocNo"):"SerialNo"==T.nodeName?o.a.GetResource("Reports_LblSerialNumber"):o.a.GetResource("Reports_Lbl"+T.nodeName,T.nodeName),s.Width=T.attributes.Width.value,t=s,87==this.ViewModel.StaticReportType&&"Property"==T.nodeName&&"1"!=o.a.SessionManager.RoleID&&parseInt(o.a.SessionManager.UserID)>1){let t=o.a.report.ReportDataSet("RPT001",this.ViewModel.IsReportDB,o.a.SessionManager.UserID);e="";for(let s=0;s<t.Tables[0].length;s++)e+=t.Tables[0][s].PropertyID.toString(),s<t.Tables[0].length-1&&(e+=" , ");s.CustomWhere=e.length>0?" a.NodeID in ( "+e+") ":" 1<>1 "}if("EnquiryNo"==T.nodeName&&this.ViewModel.DocumentFilters.ContainsKey("23148")&&this.ViewModel.DocumentFilters[23148].length>0){let e;i.e.IsNum(this.ViewModel.DocumentFilters[23148])?(e=i.e.Int(this.ViewModel.DocumentFilters[23148]),s.SelectedValue=e,this.ViewModel.DocumentFiltersText.ContainsKey("23148")&&(s.SelectedValueText=s.Text=this.ViewModel.DocumentFiltersText[23148])):s.Text=this.ViewModel.DocumentFiltersText.ContainsKey("23148")&&this.ViewModel.DocumentFiltersText[23148].length>0?this.ViewModel.DocumentFiltersText[23148]:this.ViewModel.DocumentFilters[23148]}}else if("CheckedListBox"==T.attributes.Type.value){let e=new n.b;e.Label=o.a.GetResource("Reports_Lbl"+T.nodeName,T.nodeName),e.Width=T.attributes.Width.value,e.DBColumnName=T.nodeName,this.LoadListBoxData(e,T.nodeName),t=e}else if("DatePicker"==T.attributes.Type.value){let e=new C.a(0);e.DisableLbl=!1,e.Label=o.a.GetResource("Reports_Lbl"+T.nodeName,T.nodeName),t=e}null!=t&&(t.DBColumnName=T.nodeName,t.Column=T.attributes.Column.value,t.Row=T.attributes.Row.value,null!=T.attributes.ColSpan&&(t.ColumnSpan=T.attributes.ColSpan.value),null!=T.attributes.RowSpan&&(t.RowSpan=T.attributes.RowSpan.value),this.DefaultProperties.push(t))}}if(this.SetFC(s),this.FCWithExchRate=new p.a,this.FCWithExchRate.Visible=!1,this.ViewModel.StaticReportType>=5&&this.ViewModel.StaticReportType<=8||4==this.ViewModel.StaticReportType){this.FCWithExchRate.Visible=!0,this.LoadDropDownData(this.FCWithExchRate.ComboBox,"ForeignCurrency"),this.FCWithExchRate.ComboBox.Label="1",this.FCWithExchRate.CheckBox.Label=o.a.GetResource("PLTA_ShowAllTransactions");let e=i.f.SelectSingleNode(s.DocumentElement,"FCWithExchRate");if(null!=e){let t=i.f.SelectSingleNode(e,"IsChecked");null!=t&&"1"==t.innerHTML&&(this.FCWithExchRate.CheckBox.IsChecked=!0),t=i.f.SelectSingleNode(e,"ComboValue"),null==t||i.e.IsEmpty(t.innerHTML)||(this.FCWithExchRate.ComboBox.SelectedValue=t.innerHTML);let s=0;t=i.f.SelectSingleNode(e,"TextValue"),null==t||i.e.IsEmpty(t.innerHTML)||(s=i.e.Double(t.innerHTML)),this.FCWithExchRate.ComboBox.Label=s.toString()}}if(this.FinalReportsShowVisibility){this.FinalReportsShowTagWise.ComboBox.SysTableName="1";let e=null!=s.DocumentElement?i.f.SelectSingleNode(s.DocumentElement,"FinalReportsShow"):null;if(null!=e)"1"==e.innerHTML?(this.FinalReportsShowNone.IsChecked=!1,this.FinalReportsShowMonthWise.IsChecked=!0,this.FinalReportsShowMonthWise.Dependantinuse&&(null!=i.f.SelectSingleNode(s.DocumentElement,"FinalReportsShowPrevMn")&&(this.FinalReportsShowMonthWise.IsReadOnly=!0),null!=i.f.SelectSingleNode(s.DocumentElement,"FinalReportsShowDifference")&&(this.FinalReportsShowMonthWise.Enable=!0),null!=i.f.SelectSingleNode(s.DocumentElement,"FinalReportsShowVarPer")&&(this.FinalReportsShowMonthWise.IsColumnUserDefined=!0)),15==this.ViewModel.StaticReportType&&this.OnRadioChecked(this.FinalReportsShowMonthWise)):"4"==e.innerHTML?(this.FinalReportsShowNone.IsChecked=!1,this.FinalReportsShowQtrWise.IsChecked=!0,this.FinalReportsShowQtrWise.Dependantinuse&&(null!=i.f.SelectSingleNode(s.DocumentElement,"FinalReportsShowPrevMn")&&(this.FinalReportsShowQtrWise.IsReadOnly=!0),null!=i.f.SelectSingleNode(s.DocumentElement,"FinalReportsShowDifference")&&(this.FinalReportsShowQtrWise.Enable=!0),null!=i.f.SelectSingleNode(s.DocumentElement,"FinalReportsShowVarPer")&&(this.FinalReportsShowQtrWise.IsColumnUserDefined=!0))):"5"==e.innerHTML?(this.FinalReportsShowNone.IsChecked=!1,this.FinalReportsShowHYWise.IsChecked=!0,this.FinalReportsShowHYWise.Dependantinuse&&(null!=i.f.SelectSingleNode(s.DocumentElement,"FinalReportsShowPrevMn")&&(this.FinalReportsShowHYWise.IsReadOnly=!0),null!=i.f.SelectSingleNode(s.DocumentElement,"FinalReportsShowDifference")&&(this.FinalReportsShowHYWise.Enable=!0),null!=i.f.SelectSingleNode(s.DocumentElement,"FinalReportsShowVarPer")&&(this.FinalReportsShowHYWise.IsColumnUserDefined=!0))):"3"==e.innerHTML?(this.FinalReportsShowNone.IsChecked=!1,this.FinalReportsShowYearWise.IsChecked=!0,this.FinalReportsShowYearWise.Dependantinuse&&(null!=i.f.SelectSingleNode(s.DocumentElement,"FinalReportsShowPrevMn")&&(this.FinalReportsShowYearWise.IsReadOnly=!0),null!=i.f.SelectSingleNode(s.DocumentElement,"FinalReportsShowDifference")&&(this.FinalReportsShowYearWise.Enable=!0),null!=i.f.SelectSingleNode(s.DocumentElement,"FinalReportsShowVarPer")&&(this.FinalReportsShowYearWise.IsColumnUserDefined=!0)),15==this.ViewModel.StaticReportType&&this.OnRadioChecked(this.FinalReportsShowYearWise)):"2"==e.innerHTML&&(this.FinalReportsShowNone.IsChecked=!1,this.FinalReportsShowTagWise.CheckBox.IsChecked=!0,this.FinalReportsShowTagWise.ComboBox.SelectedValue=i.f.SelectSingleNodeText(s.DocumentElement,"FinalReportsShowTag"),e=i.f.SelectSingleNode(s.DocumentElement,"FinalReportsShowTagColumn"),null==e||i.e.IsEmpty(e.innerHTML)||(this.FinalReportsShowTagWise.ComboBox.SysTableName=e.innerHTML),e=i.f.SelectSingleNode(s.DocumentElement,"FinalReportsShowTagHideColumns"),null==e||i.e.IsEmpty(e.innerHTML)||(this.FinalReportsShowTagWise.ComboBox.IsReadOnly=!0));else if(null==e&&(4==this.ViewModel.StaticReportType||15==this.ViewModel.StaticReportType)&&(e=i.f.SelectSingleNode(s.DocumentElement,"TagWise"),null!=e)){let t=i.f.SelectSingleNode(e,"IsChecked");null!=t&&"1"==t.innerHTML&&(this.FinalReportsShowNone.IsChecked=!1,this.FinalReportsShowTagWise.CheckBox.IsChecked=!0,t=i.f.SelectSingleNode(e,"Value"),null==t||i.e.IsEmpty(t.innerHTML)||(this.FinalReportsShowTagWise.ComboBox.SelectedValue=t.innerHTML),t=i.f.SelectSingleNode(e,"Column"),null==t||i.e.IsEmpty(t.innerHTML)||(this.FinalReportsShowTagWise.ComboBox.SysTableName=t.innerHTML),t=i.f.SelectSingleNode(e,"HideColumns"),null==t||i.e.IsEmpty(t.innerHTML)||(this.FinalReportsShowTagWise.ComboBox.IsReadOnly=!0))}this.CurrentBudget.Visible&&(e=i.f.SelectSingleNode(s.DocumentElement,"HideTagWiseBudget"),null!=e&&"1"==e.innerHTML&&(this.HideTagWiseBudget=!0),e=i.f.SelectSingleNode(s.DocumentElement,"CurrentBudget"),this.CurrentBudget.SelectedValue=null!=e?e.innerHTML:"0",e=i.f.SelectSingleNode(s.DocumentElement,"PreviousBudget"),this.PreviousBudget.SelectedValue=null!=e?e.innerHTML:"0",e=i.f.SelectSingleNode(s.DocumentElement,"ShowActualBudget"),this.ShowActualBudget.IsChecked=null!=e&&"1"==e.innerHTML,e=i.f.SelectSingleNode(s.DocumentElement,"ShowVariance"),this.ShowVariance.IsChecked=null!=e&&"1"==e.innerHTML,e=i.f.SelectSingleNode(s.DocumentElement,"ShowVariancePercent"),this.ShowVariancePercent.IsChecked=null!=e&&"1"==e.innerHTML,e=i.f.SelectSingleNode(s.DocumentElement,"ShowTotalBudget"),this.ShowTotalBudget.IsChecked=null!=e&&"1"==e.innerHTML)}this.ViewModel.StaticReportType>=5&&this.ViewModel.StaticReportType<=8&&this.DefaultProperties.forEach(e=>{e instanceof r.b&&this.OnRadioChecked(e.CheckedItem)})}switch(this.ViewModel.StaticReportType){case 10:case 11:case 12:let e=this.DefaultProperties.find(e=>e instanceof h.a&&"FIFO"==e.DBColumnName);if(e&&this.OnCheckBoxChecked(e),12==this.ViewModel.StaticReportType){let e=this.DefaultProperties.find(e=>e instanceof r.b&&"IncludeBills"==e.DBColumnName);this.OnRadioChecked(e.CheckedItem)}}if(this.ViewModel.Preferences.ContainsKey("DisableDefaults")&&"1"==this.ViewModel.Preferences.DisableDefaults)this.DefaultProperties.filter(e=>"DEFAULT_LOCATION"!=e.DBColumnName).forEach(e=>{e.Enable=!1}),this.FCWithExchRate.Enable=!1,this.FinalReportsShowEnable=!1;else if(this.ViewModel.Preferences.ContainsKey("DisableLevel")&&"1"==this.ViewModel.Preferences.DisableLevel){var s=this.DefaultProperties.find(e=>"Level"==e.DBColumnName||"ShowLevel"==e.DBColumnName);s&&(s.Enable=!1)}this.DefaultProperties.sort((e,t)=>e.Row>t.Row||e.Row==t.Row&&e.Column>t.Column?1:-1),this.DefaultProperties.forEach(e=>{e.Visible&&(this.TblProperties.Rows.ContainsKey(e.Row)||this.TblProperties.Rows.Add(e.Row,[null,null]),this.TblProperties.Rows[e.Row][e.Column]=e)})}LoadDropDownData(e,t){let s=null,i="",l="";"TagWise"==t?(i="NAME",l="FEATUREID",s=o.a.report.DataSet("RPT007",o.a.SessionManager.LanguageID)):"ForeignCurrency"==t?(i="Name",l="CurrencyID",s=o.a.report.DataSet("RPT008","")):"EnquiryNo"==t?(i="VoucherNo",l="VoucherNo",s=o.a.report.DataSet("RPT009",this.ViewModel.Preferences.EnquiryDocument)):"ShowSalesPercentage"==t?(i="Name",l="Name",s={Tables:[],Columns:[]},s.Tables.push([]),s.Columns.push([]),s.Columns[0].push("Name"),s.Tables[0].push({Name:"Repeat None"}),s.Tables[0].push({Name:"Repeat Tag Wise"})):"Budgets"==t?(i="BudgetName",l="BudgetDefID",s=o.a.report.DataSet("SELECT BudgetDefID,BudgetName FROM COM_BudgetDef WITH(NOLOCK) WHERE StatusID=1 AND IsGroup=0 ORDER BY BudgetName",""),s.Tables[0].InsertAt({BudgetDefID:0,BudgetName:"None"},0)):"ShowDetailReport"==t?(i="Name",l="Value",s={Tables:[],Columns:[]},s.Tables.push([]),s.Columns.push([]),s.Columns[0].push("Name"),s.Columns[0].push("Value"),s.Tables[0].push({Name:"Group Format",Value:"Group"}),s.Tables[0].push({Name:"Tree Format",Value:"Tree"})):87==this.ViewModel.StaticReportType&&"Status"==t&&(i="Name",l="NodeID",s=o.a.report.GetReport(1,this.ViewModel.ReportID),s.Tables[0].InsertAt({Name:"All",NodeID:"0"},0)),null!=s&&s.Tables[0].forEach(t=>{e.Items.push(n.d.ComboBoxItems_2(t[i].toString(),t[l].toString()))}),e.Items.length>0&&(e.SelectedValue=e.Items[0].Value)}LoadListBoxData(e,t){if("RatioList"!=t);else{let s=new i.f;s.LoadXml(this.ViewModel.Reportds.Tables[0][0].CustomPreferences.toString());let o=i.f.SelectSingleNode(s.DocumentElement,"RatioAnalysisXml/RatiosList");e.Items.push(n.c.CheckedListBoxItem_5("All","All",!0)),e.Items[0].Parent=t;for(let i=0;i<o.childNodes.length;i++){let s=o.childNodes[i];e.Items.push(n.c.CheckedListBoxItem_5(s.attributes.Name.value,s.attributes.Name.value,!0)),e.Items[e.Items.length-1].Parent=t}}}GetPropertiesUIXML(){if(1==this.ViewModel.StaticReportType)return"<XML>\n            <PrintEachAccountOnSeparatePage Type='CheckBox' Row='0' Column='0' ColSpan='2'/>\n<WantAccountsWithoutTransactions Type='CheckBox' Row='1' Column='0' ColSpan='2'/>\n<WantAccountsWithZeroBalances Type='CheckBox' Row='2' Column='0' ColSpan='2'/>\n<WantAccountsWithOnlyOPB Type='CheckBox' Row='3' Column='0' ColSpan='2'/>\n<PrintAccountIndex Type='CheckBox' Row='4' Column='0' ColSpan='2'/>\n<TagWise Type='TagWiseComboBox' Row='5' Column='0' ColSpan='2' CheckWidth='120' ComboWidth='120' IsHorizontal='1'/>\n<CurrencyWise Type='CheckBox' Row='6' Column='0'/><HideEmptyCurrencies Type='CheckBox' Row='6' Column='1'/>\n<ShowDetailReportINV Type='CheckBox' Row='7' Column='0'/>\n<ShowDetailReportACC Type='CheckBox' Row='8' Column='0'/>\n<GroupByParticular Type='CheckBox' Row='8' Column='1'/>\n<TreeSortOn Type='Radio' Column='0' Row='9' ColSpan='2' Items='Code~Name~TreeOrder' Values='Code~Name~TreeOrder' DefaultValue='Name' IsHorizontal='1'/>\n            </XML>";if(2==this.ViewModel.StaticReportType||3==this.ViewModel.StaticReportType){let e="<XML>\n<ShowDetailReportINV Type='CheckBox' Row='7' Column='0'/>\n<ShowDetailReportACC Type='CheckBox' Row='8' Column='0'/>\n<PrintEachAccountOnSeparatePage Type='CheckBox' Row='0' Column='0' ColSpan='2'/>";return 3==this.ViewModel.StaticReportType&&(e+="<DateFilter Type='Radio' Row='9' Column='0' ColSpan='2' Items='VoucherDate~ChequeDate~MaturityDate' Values='DocDate~ChequeDate~MaturityDate' DefaultValue='DocDate' IsHorizontal='1'/>"),e+="</XML>",e}if(86==this.ViewModel.StaticReportType)return"<XML>\n            <PrintEachAccountOnSeparatePage Type='CheckBox' Row='0' Column='0' ColSpan='2'/>\n<WantAccountsWithoutTransactions Type='CheckBox' Row='1' Column='0' ColSpan='2'/>\n<WantAccountsWithZeroBalances Type='CheckBox' Row='2' Column='0' ColSpan='2'/>\n<PrintAccountIndex Type='CheckBox' Row='3' Column='0' ColSpan='2'/>\n<ShowTransactionsDrCrSeperately Type='CheckBox' Row='4' Column='0' ColSpan='2'/>\n<TreeSortOn Type='Radio' Column='0' Row='8' ColSpan='2' Items='Code~Name~TreeOrder' Values='Code~Name~TreeOrder' DefaultValue='Name' IsHorizontal='1'/>\n            </XML>";if(156==this.ViewModel.StaticReportType)return"<XML>\n<WantDimensionsWithoutTransactions Type='CheckBox' Row='1' Column='0' ColSpan='2'/>\n<WantDimensionsWithZeroBalances Type='CheckBox' Row='2' Column='0' ColSpan='2'/>\n<ShowDetailReportINV Type='CheckBox' Row='7' Column='0'/>\n<ShowDetailReportACC Type='CheckBox' Row='8' Column='0'/>\n<TreeSortOn Type='Radio' Column='0' Row='9' ColSpan='2' Items='Code~Name~TreeOrder' Values='Code~Name~TreeOrder' DefaultValue='Name' IsHorizontal='1'/>\n            </XML>";if(169==this.ViewModel.StaticReportType)return"<XML>\n<ShowNarration Type='CheckBox' Row='1' Column='0' ColSpan='2'/>\n            </XML>";if(4==this.ViewModel.StaticReportType)return"<XML>\n<WantAccountsWithoutTransactions Type='CheckBox' Row='2' Column='0' ColSpan='2'/>\n<WantAccountsWithZeroBalances Type='CheckBox' Row='3' Column='0' ColSpan='2'/>\n<ShowOpeningDrCrSeperately Type='CheckBox' Row='4' Column='0' ColSpan='2'/>\n<ShowTransactionsDrCrSeperately Type='CheckBox' Row='5' Column='0' ColSpan='2'/>\n<ShowdetailsofControlGroups Type='CheckBox' Row='6' Column='0' ColSpan='2'/>\n<AccountWise Type='CheckBox' Row='8' Column='0' ColSpan='1'/>\n<Level Type='TextBox' Row='8' Column='1' Text='6' Width='35' IsHorizontal='1'/>\n<TreeSortOn Type='Radio' Column='0' Row='9' Items='Code~Name~TreeOrder' Values='Code~Name~TreeOrder' DefaultValue='Name' IsHorizontal='1'/>\n<TType Type='CheckBox' Row='9' Column='1'/>\n            </XML>";if(5==this.ViewModel.StaticReportType||6==this.ViewModel.StaticReportType||7==this.ViewModel.StaticReportType){let e="<XML>                \n<AccountWise Type='CheckBox' Row='0' Column='0' ColSpan='2'/>\n<Level Type='TextBox' Row='0' Column='1' Text='6' Width='35' IsHorizontal='1'/>\n<TreeSortOn Type='Radio' Column='0' Row='1' Items='Code~Name~TreeOrder' Values='Code~Name~TreeOrder' DefaultValue='Name' IsHorizontal='1' ColSpan='2'/>\n<ReportFormat Type='Radio' Row='2' Column='0' Items='Vertical~Horizontal~Plain' Values='Vertical~Horizontal~Plain'/>";return"1"!=o.a.SessionManager.Preferences.StockBasedON&&(e+=7==this.ViewModel.StaticReportType?"<IncludeStock Type='CheckList' Row='2' Column='1' Items='ClosingStock' Values='ClosingStock'/>":"<IncludeStock Type='CheckList' Row='2' Column='1' Items='OpeningStock~ClosingStock' Values='OpeningStock~ClosingStock' IsHorizontal='0'/>"),e+="<ShowAllAccounts Type='CheckBox' Row='3' Column='0' ColSpan='1'/>"+(6==this.ViewModel.StaticReportType?"<ShowSalesPercentage Type='CheckedComboBox' Row='5' Column='0' ColSpan='2' CheckWidth='170' ComboWidth='120' IsHorizontal='1'/>":"")+"</XML>",e}if(8==this.ViewModel.StaticReportType){let e="<XML>                \n<AccountWise Type='CheckBox' Row='0' Column='0' ColSpan='2'/>\n<Level Type='TextBox' Row='0' Column='1' Text='6' Width='35' IsHorizontal='1'/>\n<TreeSortOn Type='Radio' Column='0' Row='1' Items='Code~Name~TreeOrder' Values='Code~Name~TreeOrder' DefaultValue='Name' IsHorizontal='1' ColSpan='2'/>\n<ReportFormat Type='Radio' Row='2' Column='0' Items='Vertical~Horizontal' Values='Vertical~Horizontal'/>";return"1"!=o.a.SessionManager.Preferences.StockBasedON&&(e+="<IncludeStock Type='CheckList' Row='2' Column='1' Items='OpeningStock~ClosingStock' Values='OpeningStock~ClosingStock' IsHorizontal='0'/>"),e+="<ShowAllAccounts Type='CheckBox' Row='3' Column='0' ColSpan='1'/>\n<HideZeroBudgetAccounts Type='CheckBox' Row='3' Column='1' ColSpan='1'/>\n<ShowSalesPercentage Type='CheckedComboBox' Row='5' Column='0' ColSpan='2' CheckWidth='170' ComboWidth='120' IsHorizontal='1'/>\n            </XML>",e}if(97==this.ViewModel.StaticReportType)return"<XML>\n<ShowDetailReport Type='CheckedComboBox' Row='0' Column='0' ColSpan='2' CheckWidth='130' ComboWidth='105' IsHorizontal='1'/>\n<ShowAllAccounts Type='CheckBox' Row='1' Column='0' ColSpan='1'/>\n<WantAccountsWithZeroBalances Type='CheckBox' Row='2' Column='0' ColSpan='2'/>\n<CumulativeMnWise Type='CheckBox' Row='3' Column='0' ColSpan='2'/>\n</XML>";if(9==this.ViewModel.StaticReportType)return"<XML>\n            <Date Type='Radio' Row='0' Column='0' ColSpan='2' Items='VoucherDate~DueDate' Values='DocDate~DocDueDate' IsHorizontal='1'/>\n            <IncludeBills Type='Radio' Row='1' Column='0' Items='Receivables~Payables~Both' Values='Receivables~Payables~Both'/>\n            <DisplayBills Type='CheckList' Row='1' Column='1' Items='UnAdjusted~SemiAdjusted~Adjusted' Values='UnAdjusted~SemiAdjusted~Adjusted'/>\n            <PrintAccountIndex Type='CheckBox' Row='5' Column='0'/><GroupByDocNo Type='CheckBox' Row='5' Column='1'/>\n            <PrintEachAccountOnSeparatePage Type='CheckBox' Row='6' Column='0' ColSpan='2'/>\n<TreeSortOn Type='Radio' Column='0' Row='9' ColSpan='2' Items='Code~Name~TreeOrder' Values='Code~Name~TreeOrder' DefaultValue='Name' IsHorizontal='1'/>\n           </XML>";if(10==this.ViewModel.StaticReportType)return"<XML>\n            <Date Type='Radio' Row='0' Column='0' ColSpan='2' Items='VoucherDate~DueDate~PaymentTerm' Values='DocDate~DocDueDate~PaymentTerm' IsHorizontal='1'/>\n            <IncludeBills Type='Radio' Row='1' Column='0' Items='Receivables~Payables~Both' Values='Receivables~Payables~Both'/>\n            <DisplayBills Type='CheckList' Row='1' Column='1' Items='UnAdjusted~SemiAdjusted' Values='UnAdjusted~SemiAdjusted'/>\n<FilterPDCOnMaturityDate Type='CheckBox' Row='2' Column='0'/> <FIFO Type='CheckBox' Row='2' Column='1'/>\n            <PrintAccountIndex Type='CheckBox' Row='5' Column='0'/><GroupByDocNo Type='CheckBox' Row='5' Column='1'/>\n            <PrintEachAccountOnSeparatePage Type='CheckBox' Row='6' Column='0' ColSpan='2'/>\n            <PrintAgeingAnalysis Type='CheckBox' Row='7' Column='0' ColSpan='2'/>\n<TreeSortOn Type='Radio' Column='0' Row='9' ColSpan='2' Items='Code~Name~TreeOrder' Values='Code~Name~TreeOrder' DefaultValue='Name' IsHorizontal='1'/>\n            </XML>";if(11==this.ViewModel.StaticReportType)return"<XML>\n            <Date Type='Radio' Row='0' Column='0' ColSpan='2' Items='VoucherDate~DueDate~PaymentTerm' Values='DocDate~DocDueDate~PaymentTerm' IsHorizontal='1'/>\n            <IncludeBills Type='Radio' Row='1' Column='0' Items='Receivables~Payables~Both' Values='Receivables~Payables~Both'/>\n<FIFO Type='CheckBox' Row='1' Column='1'/>\n            <Slabs Type='TextList' Row='2' Column='0' ColSpan='2' IsHorizontal='1'/>\n            <MonthWiseMonths Type='CheckedTextBox' Row='3' Column='0' Text='3' CheckWidth='195' TextWidth='28' IsHorizontal='1'/>\n            <PrintAccountIndex Type='CheckBox' Row='5' Column='0' ColSpan='2'/>\n            <GroupByDocNo Type='CheckBox' Row='5' Column='2' ColSpan='2'/>\n            <PrintEachAccountOnSeparatePage Type='CheckBox' Row='6' Column='0' ColSpan='2'/>\n            </XML>";if(12==this.ViewModel.StaticReportType)return"<XML>\n            <Date Type='Radio' Row='0' Column='0' ColSpan='2' Items='VoucherDate~DueDate~PaymentTerm' Values='DocDate~DocDueDate~PaymentTerm' IsHorizontal='1'/>\n            <IncludeBills Type='Radio' Row='1' Column='0' RowSpan='4' Items='Receivables~Payables~Both' Values='Receivables~Payables~Both'/>\n<FIFO Type='CheckBox' Row='1' Column='1'/>\n<ShowLevel Type='CheckedTextBox' Row='2' Column='1' Text='6' CheckWidth='95' TextWidth='35' IsHorizontal='1'/>\n<MonthWiseMonths Type='CheckedTextBox' Row='3' Column='1' Text='3' CheckWidth='195' TextWidth='28' IsHorizontal='1'/>                \n<ShowRecPaySeperately Type='CheckBox' Row='4' Column='1'/>\n            <Slabs Type='TextList' Row='5' Column='0' ColSpan='2' IsHorizontal='1'/>\n            <PrintAccountIndex Type='CheckBox' Row='6' Column='0'/> <AgeingBasedOnMaturityDate Type='CheckBox' Row='6' Column='1'/>\n            <PrintEachAccountOnSeparatePage Type='CheckBox' Row='7' Column='0'/> <PDCSlabBasedOnMatDate Type='CheckBox' Row='7' Column='2'/>\n            <WantAccountsWithoutTransactions Type='CheckBox' Row='8' Column='0' ColSpan='2'/>\n            <WantAccountsWithZeroBalances Type='CheckBox' Row='9' Column='0' ColSpan='2'/>\n            </XML>";if(13==this.ViewModel.StaticReportType)return"<XML>\n<MultipleUnits Type='ComboBox' Row='0' Column='0' Width='60' Items='None~Both~Max~Min' Values='0~1~2~3' DefaultValue='0' IsHorizontal='1'/>\n<ShowMultipleUnitNames Type='CheckBox' Row='0' Column='1'/>\n<ShowProductsWithoutTransactions Type='CheckBox' Row='1' Column='0' ColSpan='2'/>                \n<ValuationMethod Type='ComboBox' Column='0' Row='2' ColSpan='1' Items='Default~FIFO~LIFO~WeightedAvg~LastPurchaseRate~LastLadingRate~PeriodicMonthly~InvoiceRate' Values='0~1~2~3~4~5~6~7' DefaultValue='0' IsHorizontal='0' Width='130'/>\n<TreeSortOn Type='Radio' Column='0' Row='4' Items='Code~Name~TreeOrder' Values='Code~Name~TreeOrder' DefaultValue='Name' IsHorizontal='0'/>\n            </XML>";if(14==this.ViewModel.StaticReportType)return"<XML>\n            <ShowLevel Type='CheckedTextBox' Row='0' Column='0' Text='6' TextWidth='35' CheckWidth='95' IsHorizontal='1'/>\n<ShowCollapse Type='CheckBox' Row='0' Column='1'/>\n<MultipleUnits Type='ComboBox' Row='1' Column='0' Width='60' Items='None~Both~Max~Min' Values='0~1~2~3' DefaultValue='0' IsHorizontal='1'/>\n<ShowMultipleUnitNames Type='CheckBox' Row='1' Column='1'/>\n<ShowProductsWithoutTransactions Type='CheckBox' Row='2' Column='0' ColSpan='2'/>                \n<ValuationMethod Type='ComboBox' Column='0' Row='3' ColSpan='1' Items='Default~FIFO~LIFO~WeightedAvg~LastPurchaseRate~LastLadingRate~PeriodicMonthly~InvoiceRate' Values='0~1~2~3~4~5~6~7' DefaultValue='0' IsHorizontal='0' Width='130'/>\n<DisplayStock Type='CheckList' Row='4' Column='0' Items='Zero~Positive~Negative' Values='Zero~Positive~Negative'/>\n<TreeSortOn Type='Radio' Column='1' Row='4' Items='Code~Name~TreeOrder' Values='Code~Name~TreeOrder' DefaultValue='Name' IsHorizontal='0'/>\n            </XML>";if(15==this.ViewModel.StaticReportType)return"<XML>\n            <ShowLevel Type='CheckedTextBox' Row='0' Column='0' Text='6' TextWidth='35' CheckWidth='95' IsHorizontal='1'/>\n<ShowCollapse Type='CheckBox' Row='0' Column='1'/>\n<MultipleUnits Type='ComboBox' Row='1' Column='0' Width='60' Items='None~Both~Max~Min' Values='0~1~2~3' DefaultValue='0' IsHorizontal='1'/>\n<ShowMultipleUnitNames Type='CheckBox' Row='1' Column='1'/>\n<ShowAllProducts Type='CheckBox' Row='2' Column='0' ColSpan='2'/>\n<ShowProductsWithoutTransactions Type='CheckBox' Row='3' Column='0' ColSpan='2'/>\n<ValuationMethod Type='ComboBox' Column='0' Row='4' ColSpan='1' Items='Default~FIFO~LIFO~WeightedAvg~LastPurchaseRate~LastLadingRate~PeriodicMonthly~InvoiceRate' Values='0~1~2~3~4~5~6~7' DefaultValue='0' IsHorizontal='0' Width='130'/>\n<DisplayStock Type='CheckList' Row='5' Column='0' Items='Zero~Positive~Negative' Values='Zero~Positive~Negative'/>\n<TreeSortOn Type='Radio' Column='1' Row='5' Items='Code~Name~TreeOrder' Values='Code~Name~TreeOrder' DefaultValue='Name' IsHorizontal='0'/>\n            </XML>";if(16==this.ViewModel.StaticReportType)return"<XML>\n            <ShowLevel Type='CheckedTextBox' Row='0' Column='0' Text='6' TextWidth='35' CheckWidth='95' IsHorizontal='1'/>\n<ShowCollapse Type='CheckBox' Row='0' Column='1'/>\n<MultipleUnits Type='ComboBox' Row='1' Column='0' Width='60' Items='None~Both~Max~Min' Values='0~1~2~3' DefaultValue='0' IsHorizontal='1'/>\n<ShowMultipleUnitNames Type='CheckBox' Row='1' Column='1'/>\n<ShowProductsWithoutTransactions Type='CheckBox' Row='2' Column='0' ColSpan='2'/>\n<TagWise Type='TagWiseComboBox' Row='3' Column='0' ColSpan='2' CheckWidth='125' ComboWidth='120' IsHorizontal='1'/>\n<DisplayStock Type='CheckList' Row='4' Column='0' Items='Zero~Positive~Negative' Values='Zero~Positive~Negative'/>\n<TreeSortOn Type='Radio' Column='1' Row='4' Items='Code~Name~TreeOrder' Values='Code~Name~TreeOrder' DefaultValue='Name' IsHorizontal='0'/>\n            </XML>";if(159==this.ViewModel.StaticReportType)return"<XML>                \n            <ValuationMethod Type='ComboBox' Column='0' Row='3' ColSpan='1' Items='Default~FIFO~LIFO~WeightedAvg' Values='0~1~2~3' DefaultValue='0' IsHorizontal='0' Width='130'/>\n            <TreeSortOn Type='Radio' Column='1' Row='4' Items='Code~Name~TreeOrder' Values='Code~Name~TreeOrder' DefaultValue='Name' IsHorizontal='0'/>\n            </XML>";if(95==this.ViewModel.StaticReportType)return"<XML>\n            <StatusType Type='ComboBox' Column='0' Row='1' ColSpan='2' Items='Pending~Completed~Both' Values='1~2~-1' DefaultValue='1' IsHorizontal='0' Width='130'/>\n            </XML>";if(72==this.ViewModel.StaticReportType)return"<XML>\n<DateWiseDrCr Type='CheckBox' Row='0' Column='0' ColSpan='1'/>\n<ShowReconciledEntries Type='CheckBox' Row='1' Column='0' ColSpan='1'/>\n<ForeignCurrency Type='CheckedComboBox' Row='2' Column='0' ColSpan='2' CheckWidth='110' ComboWidth='120' IsHorizontal='1'/>\n            </XML>";if(81==this.ViewModel.StaticReportType)return"<XML>\n            <ConsolidatedBatches Type='CheckBox' Row='1' Column='0'/>\n            <Filter Type='Radio' Column='0' Row='2' Items='All~Current~Expired' Values='All~Current~Expired' DefaultValue='All' IsHorizontal='0'/>               \n            </XML>";if(82==this.ViewModel.StaticReportType)return"<XML>\n<ConsolidatedBatches Type='CheckBox' Row='0' Column='0'/>\n<BinDetail Type='CheckBox' Row='0' Column='1'/>\n<MonthWiseMonths Type='CheckedTextBox' Row='1' Column='0' Text='4' CheckWidth='175' TextWidth='28' IsHorizontal='1' ColSpan='2'/>\n<Slabs Type='TextList' Row='3' Column='0' ColSpan='2' IsHorizontal='1'/>\n<Filter Type='Radio' Column='0' Row='4' Items='All~Expired~Active~SelectedSlabActive' Values='All~Expired~Active~SelectedSlabActive' DefaultValue='All' IsHorizontal='0'/>\n</XML>";if(83==this.ViewModel.StaticReportType)return"<XML>\n            <Slabs Type='TextList' Row='2' Column='0' ColSpan='2' IsHorizontal='1'/>\n            </XML>";if(84==this.ViewModel.StaticReportType)return"<XML>\n            <ShowLevel Type='CheckedTextBox' Row='0' Column='0' ColSpan='2' Text='6' CheckWidth='90' TextWidth='28' IsHorizontal='1'/>                \n            <ShowYearWise Type='CheckedTextBox' Row='1' Column='0' ColSpan='2' Text='5' CheckWidth='165' TextWidth='28' IsHorizontal='1'/>\n            <ValuationMethod Type='ComboBox' Column='0' Row='2' ColSpan='1' Items='Default~FIFO~LIFO~WeightedAvg~LastPurchaseRate~LastLadingRate~PeriodicMonthly' Values='0~1~2~3~4~5~6' DefaultValue='0' IsHorizontal='0' Width='130'/>\n            <DisplayStock Type='CheckList' Row='3' Column='0' Items='Zero~Positive~Negative' Values='Zero~Positive~Negative'/>                \n            <Slabs Type='TextList' Row='5' Column='0' ColSpan='2' IsHorizontal='1'/>                \n            </XML>";if(87==this.ViewModel.StaticReportType)return"<XML>\n            <Property Type='PactListBoxData' Row='0' Column='0' ColSpan='1' CostCenter='92' TypeID='2' CustomWhere='' IsHorizontal='0' Width='220'/>\n            <Status Type='ComboBox' Column='0' Row='1' ColSpan='1' DefaultValue='0' IsHorizontal='0' Width='130'/>\n            <ExpiryIn Type='TextBox' Column='1' Row='1' ColSpan='1' Text='0' IsHorizontal='1' Width='50'/></XML>";if(98==this.ViewModel.StaticReportType)return"<XML>\n            <RatioList Type='CheckedListBox' Row='5' Column='0' ColSpan='2' Width='160'/>\n<ShowYearWise Type='CheckedTextBox' Row='1' Column='0'  Text='3' CheckWidth='170' TextWidth='28' IsHorizontal='1'/>\n<Sort Type='ComboBox' Column='1' Row='1'  Items='Ascending~Descending' Values='ASC~DESC' DefaultValue='DESC' Width='100'/>\n           </XML>";if(99==this.ViewModel.StaticReportType)return"<XML>\n            <MonthWiseData Type='CheckBox' Row='0' Column='0'/>\n            <ShowProjections Type='CheckBox' Row='1' Column='0'/>\n            </XML>";if(111==this.ViewModel.StaticReportType){let e="<XML>\n<Show Type='Radio' Row='0' Column='0' Items='All~Pending~Executed~Closed' Values='All~Pending~Executed~Closed' DefaultValue='Pending' IsHorizontal='1'/>\n<EnquiryNo Type='PactListBoxData' Row='1' Column='0' ColSpan='1' CostCenter='400' TypeID='2' CustomWhere='CostCenterID="+this.ViewModel.Preferences.EnquiryDocument;return this.ViewModel.Preferences.ContainsKey("PurchaseOrderDocument")&&this.ViewModel.Preferences.PurchaseOrderDocument.length>0&&parseInt(this.ViewModel.Preferences.PurchaseOrderDocument)>0&&(this.ViewModel.Preferences.ContainsKey("Show")&&"Pending"!=this.ViewModel.Preferences.Show?"Executed"==this.ViewModel.Preferences.Show&&(e+=" and Quantity=dbo.[fnRPT_ExeQtyByDoc](a.CostCenterID,a.InvDocDetailsID,"+this.ViewModel.Preferences.PurchaseOrderDocument+",null,0)"):e+=" and Quantity!=dbo.[fnRPT_ExeQtyByDoc](a.CostCenterID,a.InvDocDetailsID,"+this.ViewModel.Preferences.PurchaseOrderDocument+",null,0)"),this.ViewModel.Preferences.ContainsKey("Show")&&"Closed"==this.ViewModel.Preferences.Show?e+=" and LinkStatusID=445'":e+=" and LinkStatusID!=445'",e+=" IsHorizontal='1' Width='220'/>",e+="<ShowLinkedPrds Type='CheckBox' Row='2' Column='0'/>",e+="<ShowPOPendingPrds Type='CheckBox' Row='3' Column='0'/>",e+="</XML>",e}if(114==this.ViewModel.StaticReportType)return"<XML><ShowDetailReport Type='CheckBox' Row='1' Column='0'/>\n<Level Type='TextBox' Row='1' Column='1' Text='6' Width='35' IsHorizontal='1'/>\n<ShowMonths Type='TextBox' Row='3' Column='0' Text='0' Width='28' IsHorizontal='1'/>\n</XML>";if(91==this.ViewModel.StaticReportType)return"<XML>\n<DisplayBills Type='Radio' Row='0' Column='0' Items='All~Due~OverDue' Values='All~Due~OverDue'/>\n</XML>";if(120==this.ViewModel.StaticReportType)return"<XML>\n<Status Type='Radio' Column='0' Row='2' Items='All~Active~Dispose' Values='All~Active~Dispose' DefaultValue='All' IsHorizontal='1'/>\n</XML>";if(123==this.ViewModel.StaticReportType||124==this.ViewModel.StaticReportType)return"<XML>\n<Data Type='Radio' Column='0' Row='2' Items='Mapped~Assigned' Values='Mapped~Assigned' DefaultValue='Mapped' IsHorizontal='1'/>\n</XML>";if(150==this.ViewModel.StaticReportType)return"<XML>\n<Filter Type='Radio' Column='0' Row='2' Items='DocDate~ModifiedDate' Values='DocDate~ModifiedDate' DefaultValue='DocDate' IsHorizontal='0'/>\n</XML>";if(202==this.ViewModel.StaticReportType)return"<XML>\n<Filter Type='Radio' Column='0' Row='2' Items='All~Web~Mobile' Values='All~Web~Mobile' DefaultValue='All'/>\n</XML>";if(146==this.ViewModel.StaticReportType||148==this.ViewModel.StaticReportType||149==this.ViewModel.StaticReportType){let e="",t="",s=o.a.report.DataSet("RPT016",o.a.SessionManager.UserID);if(e="ALL~",t="0~",null!=s&&s.Tables.length>0&&s.Tables[0].length>0&&s.Columns[0].Contains("UserName"))for(let o=0;o<s.Tables[0].length;o++)e+=s.Tables[0][o].UserName.toString()+"~",t+=s.Tables[0][o].UserName.toString()+"~";return e=e.Trim("~"),t=t.Trim("~"),"<XML>\n<Feature Type='ComboBox' Column='0' Row='0' ColSpan='3' Items='Calendar~Leads~Cases~Opportunity~CRM-Customers~Contacts~FollowUp~Sales Contract' LabelWidth='60' Values='1000~86~73~89~83~65~122~95' DefaultValue='86' IsHorizontal='0' Width='130'/>\n<Status Type='ComboBox' Row='0' Column='1' ColSpan='1' Items='All~Open~Closed~Re-Schedule~Confirmed' Values='0~412~413~414~8' DefaultValue='0' IsHorizontal='0' Width='130' LabelWidth='60'/>\n<CreatedBy Type='ComboBox' Row='1' Column='0' ColSpan='1' Items='"+e+"' Values='"+t+"' DefaultValue='0' IsHorizontal='0' Width='130' LabelWidth='60'/>\n<Assigned Type='ComboBox' Row='1' Column='1' ColSpan='1' Items='"+e+"' Values='"+t+"' DefaultValue='0' IsHorizontal='0' Width='130' LabelWidth='60'/>\n<Account Type='PactListBoxData' Row='2' Column='0' ColSpan='1' CostCenter='2' TypeID='2' CustomWhere='' IsHorizontal='0' Width='220'/>\n<Location Type='PactListBoxData' Row='2' Column='1' ColSpan='1' CostCenter='50002' TypeID='1' CustomWhere='' IsHorizontal='0' Width='220'/>\n<Customer Type='PactListBoxData' Row='3' Column='0' ColSpan='1' CostCenter='83' TypeID='2' CustomWhere='' IsHorizontal='0' Width='220'/>\n</XML>"}return 154==this.ViewModel.StaticReportType?"<XML>\n<StatusType Type='ComboBox' Column='0' Row='1' Items='All~Pending~Completed~Rejected' Values='0~1~2~-1' DefaultValue='1' IsHorizontal='0' Width='130' LabelWidth='80'/>\n<Show Type='ComboBox' Column='0' Row='2' Items='All~Email~SMS' Values='0~1~2' DefaultValue='0' IsHorizontal='0' Width='130' LabelWidth='80'/>\n<History Type='CheckBox' Row='1' Column='1'/>\n            </XML>":157==this.ViewModel.StaticReportType?"<XML>\n<ShowLevel Type='CheckedTextBox' Row='0' Column='0' Text='6' CheckWidth='95' TextWidth='35' IsHorizontal='1'/>\n<MonthWiseData Type='CheckBox' Row='1' Column='0'/>    \n            </XML>":160==this.ViewModel.StaticReportType?"<XML>\n<Bills Type='Radio' Row='1' Column='0' Items='Receivables~Payables' Values='Receivables~Payables'/>\n<Date Type='Radio' Row='1' Column='1' Items='VoucherDate~MaturityDate' Values='DocDate~ChequeMaturityDate'/>\n<Consolidated Type='CheckBox' Row='2' Column='0'/>\n<ShowPreviousAdjustment Type='CheckBox' Row='3' Column='0'/>\n<ShowFutureAdjustment Type='CheckBox' Row='4' Column='0'/>                \n            </XML>":185==this.ViewModel.StaticReportType?"<XML>\n<SerialNo Type='PactListBoxData' Row='0' Column='0' ColSpan='1' CostCenter='42' TypeID='1' IsHorizontal='1' Width='220'/> </XML>":210==this.ViewModel.StaticReportType?"<XML>\n<Days Type='TextBox' Row='0' Column='0' Text='90' Width='35' IsHorizontal='1'/> </XML>":288==this.ViewModel.StaticReportType?"<XML>                \n<ReportFormat Type='Radio' Row='2' Column='0' Items='Vertical~Horizontal' Values='Vertical~Horizontal'/>\n</XML>":298==this.ViewModel.StaticReportType?"<XML>                \n<ShowFields Type='CheckList' Row='1' Column='0' Items='Common~Numeric~CostCenter~Alpha' Values='Common~Numeric~CostCenter~Alpha'/>\n</XML>":303==this.ViewModel.StaticReportType?"<XML>                \n<CalculateBasedOnLastSalary Type='CheckBox' Row='1' Column='0'/>\n</XML>":this.ViewModel.StaticReportType>=172&&this.ViewModel.StaticReportType<=175||this.ViewModel.StaticReportType>=180&&this.ViewModel.StaticReportType<=183?"<XML>                \n<ProductsNotInBOM Type='CheckBox' Row='1' Column='0'/>\n</XML>":"<XML></XML>"}GetPropertiesSaveXML(){let e="";e+="<XML>";for(let t=0;t<this.DefaultProperties.length;t++){let s=this.DefaultProperties[t];if(!i.e.IsEmpty(s.DBColumnName)){if(e+="<"+s.DBColumnName+">",s instanceof h.a)e+=s.IsChecked?"1":"0";else if(s instanceof r.b){let t=s;for(let s=0;s<t.Items.length;s++){let o=t.Items[s];if(o.IsChecked){e+=o.DBColumnName;break}}}else if(s instanceof d.d)e+=s.Text;else if(s instanceof c.a){let t=s;for(let s=0;s<t.Items.length;s++){let o=t.Items[s];o.IsChecked&&(e+="<"+o.DBColumnName+"/>")}}else if(s instanceof p.c)s.Items.forEach(t=>{i.e.IsEmpty(t.Text)||(e+="<"+t.DBColumnName+">",e+=t.Text,e+="</"+t.DBColumnName+">")});else if(s instanceof p.b)e+="<IsChecked>"+(s.CheckBox.IsChecked?1:0)+"</IsChecked>",e+="<Text>"+s.TextBox.Text+"</Text>";else if(s instanceof u.b)e+="EnquiryNo"==s.DBColumnName?"'"+s.Text+"'":"SerialNo"==s.DBColumnName?s.Text:s.SelectedValue;else if(s instanceof n.e)e+=s.SelectedValue;else if(s instanceof p.a){let t=s;e+="<IsChecked>"+(t.CheckBox.IsChecked?1:0)+"</IsChecked>",e+="<Value>"+t.ComboBox.SelectedValue+"</Value>","TagWiseComboBox"==t.DataType&&(1!=t.ComboBox.SelectedIndex&&-1!=t.ComboBox.SelectedIndex&&(e+="<Column>"+t.ComboBox.SelectedIndex+"</Column>"),t.ComboBox.IsReadOnly&&(e+="<HideColumns>1</HideColumns>"))}else s instanceof C.a&&(e+=s.Date.ToString("dd MMM yyyy"));e+="</"+s.DBColumnName+">"}}if(this.FCVisibility){this.ViewModel.Preferences.ContainsKey("ForeignCurrency")&&this.ViewModel.Preferences.Remove("ForeignCurrency"),e+="<Currency>";let t="";this.CompanyCurrency.IsChecked?t="<Type>1</Type>":this.FCCurrency.Visible&&this.FCCurrency.CheckBox.IsChecked&&!i.e.IsEmpty(this.FCCurrency.ComboBox.SelectedValue)?(t="<Type>2</Type>",t+="<Value>"+this.FCCurrency.ComboBox.SelectedValue+"</Value>"):this.LCCurrency.Visible&&this.LCCurrency.CheckBox.IsChecked&&(t="<Type>3</Type>"),0==t.length&&(t="<Type>1</Type>"),e+=t,e+="</Currency>"}if(this.FCWithExchRate.Visible){if(e+="<FCWithExchRate>",this.FCWithExchRate.CheckBox.IsChecked&&(e+="<IsChecked>1</IsChecked>"),i.e.IsEmpty(this.FCWithExchRate.ComboBox.SelectedValue)||(e+="<ComboValue>"+this.FCWithExchRate.ComboBox.SelectedValue+"</ComboValue>"),!i.e.IsEmpty(this.FCWithExchRate.ComboBox.Label)){let t=i.e.Double(this.FCWithExchRate.ComboBox.Label);t<=0&&(t=1),e+="<TextValue>"+t.toString()+"</TextValue>"}e+="</FCWithExchRate>"}return this.FinalReportsShowVisibility&&(this.FinalReportsShowNone.IsChecked?e+="<FinalReportsShow>0</FinalReportsShow>":this.FinalReportsShowMonthWise.IsChecked?(e+="<FinalReportsShow>1</FinalReportsShow>",this.FinalReportsShowMonthWise.Dependantinuse&&(this.FinalReportsShowMonthWise.IsReadOnly?e+="<FinalReportsShowPrevMn>1</FinalReportsShowPrevMn>":this.ViewModel.Preferences.ContainsKey("FinalReportsShowPrevMn")&&this.ViewModel.Preferences.Remove("FinalReportsShowPrevMn"),this.FinalReportsShowMonthWise.Enable?e+="<FinalReportsShowDifference>1</FinalReportsShowDifference>":this.ViewModel.Preferences.ContainsKey("FinalReportsShowDifference")&&this.ViewModel.Preferences.Remove("FinalReportsShowDifference"),this.FinalReportsShowMonthWise.IsColumnUserDefined?e+="<FinalReportsShowVarPer>1</FinalReportsShowVarPer>":this.ViewModel.Preferences.ContainsKey("FinalReportsShowVarPer")&&this.ViewModel.Preferences.Remove("FinalReportsShowVarPer"))):this.FinalReportsShowQtrWise.IsChecked?(e+="<FinalReportsShow>4</FinalReportsShow>",this.FinalReportsShowQtrWise.Dependantinuse&&(this.FinalReportsShowQtrWise.IsReadOnly?e+="<FinalReportsShowPrevMn>1</FinalReportsShowPrevMn>":this.ViewModel.Preferences.ContainsKey("FinalReportsShowPrevMn")&&this.ViewModel.Preferences.Remove("FinalReportsShowPrevMn"),this.FinalReportsShowQtrWise.Enable?e+="<FinalReportsShowDifference>1</FinalReportsShowDifference>":this.ViewModel.Preferences.ContainsKey("FinalReportsShowDifference")&&this.ViewModel.Preferences.Remove("FinalReportsShowDifference"),this.FinalReportsShowQtrWise.IsColumnUserDefined?e+="<FinalReportsShowVarPer>1</FinalReportsShowVarPer>":this.ViewModel.Preferences.ContainsKey("FinalReportsShowVarPer")&&this.ViewModel.Preferences.Remove("FinalReportsShowVarPer"))):this.FinalReportsShowHYWise.IsChecked?(e+="<FinalReportsShow>5</FinalReportsShow>",this.FinalReportsShowHYWise.Dependantinuse&&(this.FinalReportsShowHYWise.IsReadOnly?e+="<FinalReportsShowPrevMn>1</FinalReportsShowPrevMn>":this.ViewModel.Preferences.ContainsKey("FinalReportsShowPrevMn")&&this.ViewModel.Preferences.Remove("FinalReportsShowPrevMn"),this.FinalReportsShowHYWise.Enable?e+="<FinalReportsShowDifference>1</FinalReportsShowDifference>":this.ViewModel.Preferences.ContainsKey("FinalReportsShowDifference")&&this.ViewModel.Preferences.Remove("FinalReportsShowDifference"),this.FinalReportsShowHYWise.IsColumnUserDefined?e+="<FinalReportsShowVarPer>1</FinalReportsShowVarPer>":this.ViewModel.Preferences.ContainsKey("FinalReportsShowVarPer")&&this.ViewModel.Preferences.Remove("FinalReportsShowVarPer"))):this.FinalReportsShowYearWise.IsChecked?(e+="<FinalReportsShow>3</FinalReportsShow>",this.FinalReportsShowYearWise.Dependantinuse&&(this.FinalReportsShowYearWise.IsReadOnly?e+="<FinalReportsShowPrevMn>1</FinalReportsShowPrevMn>":this.ViewModel.Preferences.ContainsKey("FinalReportsShowPrevMn")&&this.ViewModel.Preferences.Remove("FinalReportsShowPrevMn"),this.FinalReportsShowYearWise.Enable?e+="<FinalReportsShowDifference>1</FinalReportsShowDifference>":this.ViewModel.Preferences.ContainsKey("FinalReportsShowDifference")&&this.ViewModel.Preferences.Remove("FinalReportsShowDifference"),this.FinalReportsShowYearWise.IsColumnUserDefined?e+="<FinalReportsShowVarPer>1</FinalReportsShowVarPer>":this.ViewModel.Preferences.ContainsKey("FinalReportsShowVarPer")&&this.ViewModel.Preferences.Remove("FinalReportsShowVarPer"))):this.FinalReportsShowTagWise.CheckBox.IsChecked&&(i.e.IsEmpty(this.FinalReportsShowTagWise.ComboBox.SelectedValue)?e+="<FinalReportsShow>0</FinalReportsShow>":(e+="<FinalReportsShow>2</FinalReportsShow>",e+="<FinalReportsShowTag>"+this.FinalReportsShowTagWise.ComboBox.SelectedValue+"</FinalReportsShowTag>","1"==this.FinalReportsShowTagWise.ComboBox.SysTableName||Object(A.isNullOrUndefined)(this.FinalReportsShowTagWise.ComboBox.SysTableName)||(e+="<FinalReportsShowTagColumn>"+this.FinalReportsShowTagWise.ComboBox.SysTableName+"</FinalReportsShowTagColumn>"),this.FinalReportsShowTagWise.ComboBox.IsReadOnly?e+="<FinalReportsShowTagHideColumns>1</FinalReportsShowTagHideColumns>":this.ViewModel.Preferences.ContainsKey("FinalReportsShowTagHideColumns")&&this.ViewModel.Preferences.Remove("FinalReportsShowTagHideColumns"))),this.CurrentBudget.Visible&&(e+=this.HideTagWiseBudget&&!this.FinalReportsShowNone.IsChecked?"<HideTagWiseBudget>1</HideTagWiseBudget>":"<HideTagWiseBudget>0</HideTagWiseBudget>",e+="<CurrentBudget>"+this.CurrentBudget.SelectedValue+"</CurrentBudget>",e+="<PreviousBudget>"+this.PreviousBudget.SelectedValue+"</PreviousBudget>",e+="<ShowActualBudget>"+(this.ShowActualBudget.IsChecked?"1":"0")+"</ShowActualBudget>",e+="<ShowVariance>"+(this.ShowVariance.IsChecked?"1":"0")+"</ShowVariance>",e+="<ShowVariancePercent>"+(this.ShowVariancePercent.IsChecked?"1":"0")+"</ShowVariancePercent>",e+="<ShowTotalBudget>"+(this.ShowTotalBudget.IsChecked?"1":"0")+"</ShowTotalBudget>")),e+="</XML>",e.toString()}SetFC(e){if(this.CurrencyList=new r.b,this.ViewModel.StaticReportType>=1&&this.ViewModel.StaticReportType<=16||[84,86,97,98,99,156,169].Contains(this.ViewModel.StaticReportType)){this.FCGUID=i.e.NewGuid(),this.FCCurrency=new M,this.FCCurrency.ComboBox.LblWidth="1",this.LCCurrency=new M,this.CompanyCurrency.IsChecked=!0;let t=null!=e.DocumentElement?i.f.SelectSingleNode(e.DocumentElement,"Currency"):null;if(this.CompanyCurrency.Group=this.CurrencyList,this.CurrencyList.Items.push(this.CompanyCurrency),this.FCCurrency.CheckBox.Group=this.CurrencyList,this.CurrencyList.Items.push(this.FCCurrency.CheckBox),this.LCCurrency.CheckBox.Group=this.CurrencyList,this.CurrencyList.Items.push(this.LCCurrency.CheckBox),Object(l.j)(o.a.SessionManager.Preferences["Use Foreign Currency"]))if(this.LoadDropDownData(this.FCCurrency.ComboBox,"ForeignCurrency"),null!=t)"2"==i.f.SelectSingleNodeText(t,"Type")&&(this.CompanyCurrency.IsChecked=!1,this.FCCurrency.CheckBox.IsChecked=!0,this.FCCurrency.ComboBox.SelectedValue=i.f.SelectSingleNodeText(t,"Value"));else{let t=null!=e.DocumentElement?i.f.SelectSingleNode(e.DocumentElement,"ForeignCurrency"):null;null!=t&&null!=i.f.SelectSingleNode(t,"IsChecked")&&"1"==i.f.SelectSingleNodeText(t,"IsChecked")&&(this.FCCurrency.CheckBox.IsChecked=!0,this.FCCurrency.ComboBox.SelectedValue=i.f.SelectSingleNodeText(t,"Value"))}else this.FCCurrency.Visible=!1;!i.e.IsEmpty(o.a.SessionManager.Preferences.DimensionwiseCurrency)&&parseInt(o.a.SessionManager.Preferences.DimensionwiseCurrency)>5e4?null!=t&&"3"==t.SelectSingleNodeText("Type")&&(this.CompanyCurrency.IsChecked=!1,this.LCCurrency.CheckBox.IsChecked=!0):this.LCCurrency.Visible=!1,this.FCVisibility=!(!this.LCCurrency.Visible&&!this.FCCurrency.Visible)}}OnChange(e,t,s){t.CheckBox.IsChecked=!t.CheckBox.IsChecked,t.CheckBox.IsChecked&&(this.CompanyCurrency.IsChecked=!1,s.forEach(e=>{"true"==e.tostring()?e=!1:e instanceof p.a&&(e.CheckBox.IsChecked=!1)}))}FromDate_PropertyChanged(e,t){"Date"==t.PropertyName&&("1"!=o.a.SessionManager.RoleID&&o.a.SessionManager.Preferences.ContainsKey("DoNotAllowFutureDateInReports")&&"True"==o.a.SessionManager.Preferences.DoNotAllowFutureDateInReports&&null!=this.FromDate&&this.FromDate.Date&&this.FromDate.Date>Date.Today()&&(this.FromDate.Date=Date.Today()),o.a.SessionManager.ReportsFromDate=new Date(this.FromDate.Date.getFullYear(),this.FromDate.Date.getMonth(),this.FromDate.Date.getDate()))}ToDate_PropertyChanged(e,t){(null!=t&&"Date"==t.PropertyName||null==e&&null==t)&&"1"!=o.a.SessionManager.RoleID&&o.a.SessionManager.Preferences.ContainsKey("DoNotAllowFutureDateInReports")&&"True"==o.a.SessionManager.Preferences.DoNotAllowFutureDateInReports&&null!=this.ToDate&&this.ToDate.Date&&this.ToDate.Date>Date.Today()&&(this.ToDate.Date=Date.Today())}OnCheckedChanged(e){if(!this.LockCheckedChanged&&e.item instanceof n.c){let t=e.item,s=this.DefaultProperties.find(e=>e instanceof n.b&&e.DBColumnName==t.Parent);if(s instanceof n.b){if("All"==t.Value){this.LockCheckedChanged=!0;for(let e=1;e<s.Items.length;e++)s.Items[e].IsChecked=t.IsChecked;this.LockCheckedChanged=!1}else{if(this.LockCheckedChanged=!0,t.IsChecked){s.Items[0].IsChecked=!0;for(let e=1;e<s.Items.length;e++)if(!s.Items[e].IsChecked){s.Items[0].IsChecked=!1;break}}else s.Items[0].IsChecked=!1;this.LockCheckedChanged=!1}this.LockCheckedChanged=!1}}}OnOkClick(e){if(this.DisplayMessage="",this.FromDate.Visible&&this.ToDate.Visible&&new Date(this.FromDate.Date.getFullYear(),this.FromDate.Date.getMonth(),this.FromDate.Date.getDate())>new Date(this.ToDate.Date.getFullYear(),this.ToDate.Date.getMonth(),this.ToDate.Date.getDate()))return this.MessageVisibility=!0,void(this.DisplayMessage=o.a.GetResource("DateValidation"));this.SetLocationWhere(),this.IsFirstLoaded=!0,this.ViewModel.ShowStaticFilter=!1,this.ViewModel.ShowReport=!0,this.ViewModel.Reportds.Tables[0][0].DefaultPreferences=this.GetPropertiesSaveXML(),this.ViewModel.UpdateDefaultPreferences(),this.ViewModel.SetQueryXMLTags(),this.ViewModel.LoadData()}SetLocationWhere(){if(this.Locations.Items.length>0&&this.Locations.Items[0].IsChecked&&("1"==o.a.SessionManager.RoleID||this.IsUserAllLocationsAssigned))this.LocationWhere=null;else{this.LocationWhere="";for(let e=1;e<this.Locations.Items.length;e++)this.Locations.Items[e].IsChecked&&(this.LocationWhere.length>0&&(this.LocationWhere+=","),this.LocationWhere+=this.Locations.Items[e].Value)}}OnCancelClick(e){this.DisplayMessage="",this.ViewModel.ShowStaticFilter=!1,this.ViewModel.ShowReport=!0}OnButtonClick(e){if("SetDefault"==e){let e=this.GetPropertiesSaveXML(),t=o.a.report.SetReportDefaultProperties(this.ViewModel.ReportID,e),s=i.e.Int(t.obj);t.Tables.length>0&&t.Tables[0].length>0&&(this.DisplayMessage=t.Tables[0][0].ErrorMessage.toString()),s>0&&this.ViewModel.ReportID>0&&(this.ViewModel.Reportds.Tables[0][0].DefaultPreferences=e)}}OnRadioChecked(e){if(e instanceof r.a){let t=e;if(null!=this.ViewModel&&15==this.ViewModel.StaticReportType&&(this.FinalReportsShowMonthWise==t||this.FinalReportsShowYearWise==t?this.FromDate.Visible=!0:this.ViewModel.Preferences.ContainsKey("SalesDocs")&&0!=this.ViewModel.Preferences.SalesDocs.length||(this.FromDate.Visible=!1)),null==t.Group)return;if("ReportFormat"==t.Group.DBColumnName)this.ViewModel.StaticReportType>=5&&this.ViewModel.StaticReportType<=8&&(this.FinalReportsShowEnable="Vertical"==t.Group.CheckedItem.DBColumnName);else if(12==this.ViewModel.StaticReportType&&"IncludeBills"==t.Group.DBColumnName){let e=this.DefaultProperties.find(e=>"ShowRecPaySeperately"==e.DBColumnName);e instanceof h.a&&(e.Enable="Both"==t.Group.CheckedItem.DBColumnName)}else if(111==this.ViewModel.StaticReportType&&"Show"==t.Group.DBColumnName){let e=this.DefaultProperties.find(e=>e instanceof u.b&&"EnquiryNo"==e.DBColumnName);e.CustomWhere="CostCenterID="+this.ViewModel.Preferences.EnquiryDocument,e.CustomWhere+="Closed"==t.Group.CheckedItem.DBColumnName?" and LinkStatusID=445":" and LinkStatusID!=445",this.ViewModel.Preferences.ContainsKey("PurchaseOrderDocument")&&this.ViewModel.Preferences.PurchaseOrderDocument.length>0&&parseInt(this.ViewModel.Preferences.PurchaseOrderDocument)>0&&("Pending"==t.Group.CheckedItem.DBColumnName?e.CustomWhere+=" and Quantity!=dbo.[fnRPT_ExeQtyByDoc](a.CostCenterID,a.InvDocDetailsID,"+this.ViewModel.Preferences.PurchaseOrderDocument+",null,0)":"Executed"==t.Group.CheckedItem.DBColumnName&&(e.CustomWhere+=" and Quantity=dbo.[fnRPT_ExeQtyByDoc](a.CostCenterID,a.InvDocDetailsID,"+this.ViewModel.Preferences.PurchaseOrderDocument+",null,0)"))}}}OnCheckBoxChecked(e){if(e instanceof h.a){let t=e;if("FIFO"==t.DBColumnName&&(10==this.ViewModel.StaticReportType||11==this.ViewModel.StaticReportType||12==this.ViewModel.StaticReportType)){let e=this.DefaultProperties.find(e=>e instanceof r.b&&"IncludeBills"==e.DBColumnName);if(e instanceof r.b){t.IsChecked&&e.Items[2].IsChecked&&(e.Items[0].IsChecked=!0),e.Items[2].Visible=!t.IsChecked;let s=this.DefaultProperties.find(e=>"ShowRecPaySeperately"==e.DBColumnName);s instanceof h.a&&(s.Visible=!t.IsChecked)}let s=this.DefaultProperties.find(e=>e instanceof c.a&&"DisplayBills"==e.DBColumnName);s instanceof c.a&&(s.Visible=!t.IsChecked)}}}OnCostCenterChange(e){if(!i.e.IsEmpty(this.CostCenters.SelectedValue)&&null!=e&&-1!=parseInt(e)){let e=0;null==this.CostCenters.SelectedItem||i.e.IsEmpty(this.CostCenters.SelectedItem.Parent)||(e=i.e.Int(this.CostCenters.SelectedItem.Parent)),this.LoadCostCenterTree(parseInt(this.CostCenters.SelectedValue),e,0,null)}}LoadCostCenterTree(e,t,s,l){if(o.a.SessionManager.RoleType>0)return;this.tree.Clear();let n,r="";if(e==this.TreeCCID&&(r=this.StaticTreeFilter),300==e&&this.ViewModel.StaticReportType>=13&&this.ViewModel.StaticReportType<=16&&(r="i.IsInventory=1 and exists (select PrefValue from com_documentpreferences with(nolock) where Prefname='DonotupdateInventory' and CostCenterID=i.CostCenterID and PrefValue='False')"),2==e?this.ViewModel.Preferences.ContainsKey("AccountTypesFilter")&&this.ViewModel.Preferences.AccountTypesFilter.length>0&&(r=o.a.SessionManager.Preferences.ContainsKey("IsControlAccounts")&&"TRUE"==o.a.SessionManager.Preferences.IsControlAccounts.toUpperCase()?"6,7"==this.ViewModel.Preferences.AccountTypesFilter||"7,6"==this.ViewModel.Preferences.AccountTypesFilter?"#DEBITORCREDITORTEE#":this.ViewModel.Preferences.AccountTypesFilter.Contains(",")?"A.AccountTypeID IN ("+this.ViewModel.Preferences.AccountTypesFilter+")":"7"==this.ViewModel.Preferences.AccountTypesFilter?"(#DEBTORTEE# or (A.IsDrCr=1 and A.AccountTypeID=6))":"6"==this.ViewModel.Preferences.AccountTypesFilter?"(#CREDITORTEE# or (A.IsDrCr=1 and A.AccountTypeID=7))":"A.AccountTypeID="+this.ViewModel.Preferences.AccountTypesFilter:this.ViewModel.Preferences.AccountTypesFilter.Contains(",")?"A.AccountTypeID IN ("+this.ViewModel.Preferences.AccountTypesFilter+")":"A.AccountTypeID="+this.ViewModel.Preferences.AccountTypesFilter):50002==e&&"1"!=o.a.SessionManager.RoleID&&"True"==o.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==o.a.SessionManager.Preferences["LW Reports"]&&(r=i.e.IsEmpty(o.a.SessionManager.LocationWhere)?"A.NodeID IN (-1234)":"A.NodeID IN ("+o.a.SessionManager.LocationWhere+")"),null==l)for(let o=0;o<this.CostCenterFilters.length;o++){let s=this.CostCenterFilters[o];if(s.CostCenterID==e&&s.LookupTypeID==t){l=s.SelectedNodes;break}}44==e&&t>0&&(r="A.LookupType="+t);let h="";if(null!=this.ViewModel&&this.ViewModel.Preferences.ContainsKey("GridViewFilter")&&this.ViewModel.Preferences.GridViewFilter.length>0){alert("check:2946");let t=new i.f;t.LoadXml("<GridViewFilter>"+this.ViewModel.Preferences.GridViewFilter+"</GridViewFilter>"),i.f.SelectNodes(t.DocumentElement.children[0],"Row").forEach(t=>{t.attributes.CCID.value==e&&(h+=t.attributes.GID.value+",")})}if(n=new D.a,null==l?n.TreeViewModel_5(e,this,s,r,h):n.TreeViewModel_6(e,this,s,r,l,h),n.LookupTypeID=t,n.HeaderVisiblity=!1,n.OnNodeSelected||(n.OnNodeSelected=new a.b,n.OnNodeSelected.Subscribe(this,"OnNodeSelected")),this.tree.push(n),this.TreeCCID==e&&this.DefaultTreeSelectedNodes!=n.SelectedNodes&&(this.DefaultTreeSelectedNodes=n.SelectedNodes),null!=l&&l.length>0&&null!=n&&null!=n.AllNodes){n.SelectedNode=null;var u=n.AllNodes.find(e=>e.Id==l[0].Id);u&&n.SelectSearchNode(u)}}OnDateRangesSelectionChanged(e){"MRP"==e&&null!=this.MrpDateRanges.SelectedValue?_.a.SetDateRanges(this.MrpDateRanges.SelectedValue,this.MrpFromDate,this.MrpToDate):null!=this.DateRanges.SelectedValue&&_.a.SetDateRanges(this.DateRanges.SelectedValue,this.FromDate,this.ToDate)}}},RiXB:function(e,t,s){"use strict";s.d(t,"a",(function(){return d}));var o=s("Do2H"),i=s("Lp6j"),l=s("vTM8"),a=s("ScVY"),n=s("0/4Q"),r=s("wlFP"),h=s("dH+5"),u=s("mvPR");class D{constructor(){this.Value=null,this.ColSpan=0,this.ReportTotal=-1,this.Children=new Array}}class d extends a.b{constructor(e,t){super(),this.k=0,this.g=0,this.ColumnGroupsCnt=0,this.lstSb=new Array,this.ActualReportColumns=null,this.flgFirst=!1,this.iCol=0,this.iSameRowsCnt=0,this.iFirst_k=0,this.iCellCounter=0,this.dblTemp=0,this.AllowToSave=!1,this.LockCheckedChanged=!1,this.Report=e,this.ReportViewModel=t,this.MatrixAddTo=new n.e,this.MatrixAddTo.Label=o.a.GetResource("Matrix_AddTo"),this.MatrixAddTo.LblWidth="55",this.MatrixFields=new n.b,this.MatrixFields.LblWidth="0",this.MatrixFields.CheckedChangedCommand.Subscribe(this,"OnCheckedChanged"),this.MatrixRows=new n.e,this.MatrixRows.OptionsSize=4,this.MatrixRows.Label=o.a.GetResource("Rows"),this.MatrixColumns=new n.e,this.MatrixColumns.OptionsSize=4,this.MatrixColumns.Label=o.a.GetResource("Reports_Columns"),this.MatrixValues=new n.e,this.MatrixValues.OptionsSize=4,this.MatrixValues.Label=o.a.GetResource("Matrix_Values"),this.MatrixColFields=new n.e,this.MatrixColFields.OptionsSize=4,this.MatrixColFields.Label="Row Fields",this.ShowColumnSubTotal=new r.a,this.ShowColumnSubTotal.Label=o.a.GetResource("Matrix_ShowColumnReportTotal"),this.ShowColumnReportTotal=new r.a,this.ShowColumnReportTotal.Label=o.a.GetResource("Matrix_ShowColumnSubTotal"),this.ShowColumnReportTotal.IsChecked=!0,this.MatrixAddTo.Items.push(n.d.ComboBoxItems_2(o.a.GetResource("Rows"),"Rows")),this.MatrixAddTo.Items.push(n.d.ComboBoxItems_2(o.a.GetResource("Reports_Columns"),"Columns")),this.MatrixAddTo.Items.push(n.d.ComboBoxItems_2(o.a.GetResource("Matrix_Values"),"Values")),this.MatrixAddTo.Items.push(n.d.ComboBoxItems_2("Column Fields","ColFields")),this.MatrixAddTo.SelectedValue="Values",this.MatrixAddTo.SelectionChangedCommand.Subscribe(this,"OnAddToChange")}LoadFields(e){let t,s=new Array;this.Report.ColumnSource.forEach(e=>{t=n.c.CheckedListBoxItem_3(e.HeaderText,e.ID),"FLOAT"==e.ColumnType||"INT"==e.ColumnType||"TIME"==e.ColumnType?(t.IsReadOnly=!0,s.push(t)):(t.IsReadOnly=!1,this.MatrixFields.Items.push(t))}),s.forEach(e=>{this.MatrixFields.Items.push(e)});let o=i.e.String(e.MatrixXML);if(o.length>0){let e=new i.f;e.LoadXml(o),this.LockCheckedChanged=!0;let t=i.f.SelectSingleNodeText(e.DocumentElement,"Rows");i.e.IsEmpty(t)||t.split(",").forEach(e=>{var t=this.MatrixFields.Items.find(t=>t.Value==e);t&&this.MatrixRows.Items.push(n.d.ComboBoxItems_2(t.Name,t.Value))}),t=i.f.SelectSingleNodeText(e.DocumentElement,"Columns"),i.e.IsEmpty(t)||t.split(",").forEach(e=>{var t=this.MatrixFields.Items.find(t=>t.Value==e);t&&this.MatrixColumns.Items.push(n.d.ComboBoxItems_2(t.Name,t.Value))}),t=i.f.SelectSingleNodeText(e.DocumentElement,"Values"),i.e.IsEmpty(t)||t.split(",").forEach(e=>{var t=s.find(t=>t.Value==e);t&&this.MatrixValues.Items.push(n.d.ComboBoxItems_2(t.Name,t.Value))}),t=i.f.SelectSingleNodeText(e.DocumentElement,"ColFields"),i.e.IsEmpty(t)||t.split(",").forEach(e=>{var t=this.MatrixFields.Items.find(t=>t.Value==e);t&&this.MatrixColFields.Items.push(n.d.ComboBoxItems_2(t.Name,t.Value))}),this.ShowColumnSubTotal.IsChecked=null!=i.f.SelectSingleNode(e.DocumentElement,"ColumnTotals"),this.ShowColumnReportTotal.IsChecked=null==i.f.SelectSingleNode(e.DocumentElement,"HideColumnReportTotals"),this.LockCheckedChanged=!1}this.OnAddToChange(null)}MoveDirection(e){let t=-1,s=null;if("RowsUp"==e||"RowsDown"==e?s=this.MatrixRows:"ColumnsUp"==e||"ColumnsDown"==e?s=this.MatrixColumns:"ValuesUp"==e||"ValuesDown"==e?s=this.MatrixValues:"ColFieldsUp"!=e&&"ColFieldsDown"!=e||(s=this.MatrixColFields),e.endsWith("Up")){if(0!=s.SelectedIndex&&-1!=s.SelectedIndex){t=s.SelectedIndex;let e=s.SelectedItem;s.Items.RemoveAt(t),s.Items.InsertAt(e,t-1),s.SelectedIndex=t-1,this.LoadMatrixReportByThread()}}else if(-1!=s.SelectedIndex&&s.SelectedIndex<s.Items.length-1){t=s.SelectedIndex;let e=s.SelectedItem;s.Items.InsertAt(e,t+2),s.Items.RemoveAt(t),s.SelectedIndex=s.Items.indexOf(e),this.LoadMatrixReportByThread()}}OnAddToChange(e){this.LockCheckedChanged=!0,this.MatrixFields.Items.forEach(e=>{e.IsChecked=!1,"ColFields"==this.MatrixAddTo.SelectedValue?(e.Enable=!0,this.MatrixColFields.Items.filter(t=>t.Value==e.Value).length>0&&(e.IsChecked=!0)):"Values"==this.MatrixAddTo.SelectedValue?(e.Enable=e.IsReadOnly,this.MatrixValues.Items.filter(t=>t.Value==e.Value).length>0&&(e.IsChecked=!0)):(e.Enable=!e.IsReadOnly,"Rows"==this.MatrixAddTo.SelectedValue?this.MatrixRows.Items.filter(t=>t.Value==e.Value).length>0&&(e.IsChecked=!0):"Columns"==this.MatrixAddTo.SelectedValue&&this.MatrixColumns.Items.filter(t=>t.Value==e.Value).length>0&&(e.IsChecked=!0))});let t=this.MatrixFields.Items;this.MatrixFields.Items=null,this.MatrixFields.Items=t,this.LockCheckedChanged=!1}SaveMatrixReport(e,t){let s={};e?(s.ReportID=this.Report.ReportID,s.SaveAsReportID=t.SaveAsID,s.ReportName=t.Name.Text):(s.ReportID=this.Report.ReportID,s.ReportName=this.Report.ScreenName);let l="";if(this.MatrixRows.Items.length>0||this.MatrixColumns.Items.length>0||this.MatrixValues.Items.length>0){l+="<Matrix>",l+="<Rows>";for(let e=0;e<this.MatrixRows.Items.length;e++)e>0&&(l+=","),l+=this.MatrixRows.Items[e].Value;l+="</Rows>",l+="<Columns>";for(let e=0;e<this.MatrixColumns.Items.length;e++)e>0&&(l+=","),l+=this.MatrixColumns.Items[e].Value;l+="</Columns>",l+="<Values>";for(let e=0;e<this.MatrixValues.Items.length;e++)e>0&&(l+=","),l+=this.MatrixValues.Items[e].Value;l+="</Values>",l+="<ColFields>";for(let e=0;e<this.MatrixColFields.Items.length;e++)e>0&&(l+=","),l+=this.MatrixColFields.Items[e].Value;l+="</ColFields>",this.ShowColumnSubTotal.IsChecked&&this.MatrixColumns.Items.length>1&&(l+="<ColumnTotals>"+this.MatrixColumns.Items[0].Value+"</ColumnTotals>"),this.ShowColumnReportTotal.IsChecked||(l+="<HideColumnReportTotals>"+this.MatrixColumns.Items[0].Value+"</HideColumnReportTotals>"),l+="</Matrix>"}s.MatrixXML=l.toString(),s.GUID=i.e.NewGuid(),o.a.report.SetMatrixReport(s,e).subscribe(e=>{this.Report.DisplayMessage=e.Message})}OnCheckedChanged(e){if(!this.LockCheckedChanged&&null!=e){let s=e.item,o=null,i=null;var t;"Values"==this.MatrixAddTo.SelectedValue?o=this.MatrixValues:"ColFields"==this.MatrixAddTo.SelectedValue?o=this.MatrixColFields:"Rows"==this.MatrixAddTo.SelectedValue?(o=this.MatrixRows,i=this.MatrixColumns):"Columns"==this.MatrixAddTo.SelectedValue&&(o=this.MatrixColumns,i=this.MatrixRows),s.IsChecked?(o.Items.push(n.d.ComboBoxItems_2(s.Name,s.Value)),o==this.MatrixColFields?((t=this.MatrixValues.Items.find(e=>e.Value==s.Value))&&this.MatrixValues.Items.Remove(t),(t=this.MatrixRows.Items.find(e=>e.Value==s.Value))&&this.MatrixRows.Items.Remove(t),(t=this.MatrixColumns.Items.find(e=>e.Value==s.Value))&&this.MatrixColumns.Items.Remove(t)):((t=this.MatrixColFields.Items.find(e=>e.Value==s.Value))&&this.MatrixColFields.Items.Remove(t),i&&(t=i.Items.find(e=>e.Value==s.Value))&&i.Items.Remove(t))):(t=o.Items.find(e=>e.Value==s.Value))&&o.Items.Remove(t),this.LoadMatrixReportByThread()}}GetColumnObject(e){return this.Report.ColumnSource.find(t=>t.ID==e)}LoadMatrixReportByThread(){this.process_DoWork(null,null)}process_DoWork(e,t){null!=this.Report.ReportData&&0!=this.Report.ReportData.length?this.LoadMatrixReport(this.Report.ReportData,this.Report.ReportDataColumns):this.Report.DisplayMessage="No data exists."}Reset(){if(this.MatrixRows.Items.Clear(),this.MatrixColumns.Items.Clear(),this.MatrixValues.Items.Clear(),this.MatrixColFields.Items.Clear(),this.OnAddToChange(null),null!=this.ActualReportColumns){let e=new Array;this.ActualReportColumns.forEach(t=>{t.HeaderHeight=this.Report.HeaderHeight,e.push(t)}),this.Report.ReportColumns=e,this.Report.FilterorClear("ClearFilter")}}LoadMatrixReport(e,t){this.objColGroups=new Array(this.MatrixColumns.Items.length),this.objRowGroups=new Array(this.MatrixRows.Items.length),this.objValueColumns=new Array(this.MatrixValues.Items.length),this.objColFields=new Array(this.MatrixColFields.Items.length),this.arrColGroups=new Array(this.MatrixColumns.Items.length),this.arrRowGroups=new Array(this.MatrixRows.Items.length),this.arrColumns=new Array(this.MatrixValues.Items.length),this.arrColFields=new Array(this.MatrixColFields.Items.length);let s=new Array;if(this.Groupstr=new l.a,this.Report.DisplayMessage="",null==this.ActualReportColumns&&(this.ActualReportColumns=new Array,this.Report.ReportColumns.forEach(e=>{this.ActualReportColumns.push(e)})),0==this.objValueColumns.length)return void(this.Report.DisplayMessage="Please select atleast one value field");if(0==e.length)return void(this.Report.DisplayMessage="No data exists.");this.strColGroups="";for(let i=0;i<this.MatrixColumns.Items.length;i++)this.arrColGroups[i]=this.MatrixColumns.Items[i].Value,this.objColGroups[i]=this.GetColumnObject(this.MatrixColumns.Items[i].Value).Clone(),s.push(this.MatrixColumns.Items[i].Value),this.Groupstr.push(this.MatrixColumns.Items[i].Value,null),this.strColGroups.length>0&&(this.strColGroups+=","),this.objColGroups[i].Formula.Contains("DATENAME")&&(a=this.Report.ColumnSourceALL.find(e=>"DATE"==e.ColumnType&&this.objColGroups[i].Formula.Contains(e.ID)))?this.strColGroups+=a.ID:this.strColGroups+=this.MatrixColumns.Items[i].Value;let o="";this.strRowGroups="";for(let i=0;i<this.MatrixRows.Items.length;i++){var a;this.arrRowGroups[i]=this.MatrixRows.Items[i].Value,this.objRowGroups[i]=this.GetColumnObject(this.MatrixRows.Items[i].Value).Clone(),s.push(this.MatrixRows.Items[i].Value),this.Groupstr.push(this.MatrixRows.Items[i].Value,null),this.strRowGroups.length>0&&(this.strRowGroups+=",",o+=","),this.objRowGroups[i].Formula.Contains("DATENAME")&&(a=this.Report.ColumnSourceALL.find(e=>"DATE"==e.ColumnType&&this.objRowGroups[i].Formula.Contains(e.ID)))?(this.strRowGroups+=this.MatrixRows.Items[i].Value,o+=a.ID):(this.strRowGroups+=this.MatrixRows.Items[i].Value,o+=this.MatrixRows.Items[i].Value)}this.arrColumns=new Array(this.MatrixValues.Items.length);for(let i=0;i<this.MatrixValues.Items.length;i++)this.arrColumns[i]=this.MatrixValues.Items[i].Value,this.objValueColumns[i]=this.GetColumnObject(this.MatrixValues.Items[i].Value).Clone(),this.objValueColumns[i].FieldName=this.objValueColumns[i].ID;for(let i=0;i<this.MatrixColFields.Items.length;i++)this.arrColFields[i]=this.MatrixColFields.Items[i].Value,this.objColFields[i]=this.GetColumnObject(this.MatrixColFields.Items[i].Value).Clone();if(this.Report.SNo=0,this.Report.colSNoIndex=this.Report.ColumnSourceALL.indexOf(this.Report.ColumnSourceALL.find(e=>0==i.e.stringCompare(e.Formula,"SNO",!0))),this.lstNodes=new Array,this.stkNodes=new Array,this.stkNodes_Summary=new Array,this.dv=e.Copy(),this.strColGroups.length>0&&this.dv.SortBy(this.strColGroups.split(",")),this.ColumnGroupsCnt=0,this.lstSb.Clear(),this.Report.ClearRows(),this.oColumns=new Array,this.k=0,this.arrColGroups.length>0&&(this.AddColumnNode(0,null),this.ShowColumnReportTotal.IsChecked&&(this.objTempNode=new D,this.objTempNode.Value=this.Report.GrpReportTotal.SubTotalPrefix[0],this.objTempNode.ReportTotal=100,this.lstNodes.push(this.objTempNode))),this.objRowGroups.length>0){let e=this.objRowGroups[0].Clone(),t=0;this.objRowGroups.forEach(e=>{e.width>t&&(t=e.width)}),e.width=t+15*(this.objRowGroups.length-1),e.HeaderText="",e.HeaderHeight=1,e.LinkType=h.a.None,this.oColumns.push(e),this.objColFields.forEach(t=>{e=t.Clone(),e.HeaderText="",e.HeaderHeight=1,e.FieldName=e.ID,this.oColumns.push(e)})}else this.objColFields=[],this.arrColFields=[];if(0==this.arrColGroups.length)this.objValueColumns.forEach(e=>{let t=e.Clone();t.HeaderText="",t.HeaderHeight=1,this.oColumns.push(t)});else{for(let e=0;e<this.ColumnGroupsCnt;e++)this.objValueColumns.forEach(t=>{let s=t.Clone();s.HeaderText="",s.ID=s.ID+"_"+e,s.HeaderHeight=1,s.MatixRepeatID=e.toString(),this.oColumns.push(s)});this.ShowColumnReportTotal.IsChecked&&this.objValueColumns.forEach(e=>{let t=e.Clone();t.HeaderText="",t.ID=t.ID+"_"+i.e.NewGuid(),t.HeaderHeight=1,t.DataAppearance=this.Report.GrpReportTotal.SubTotalAppearance_Data.Clone(),t.DataAppearance.FontSize=t.DataAppearance.FontSize-1,this.Report.GrpReportTotal.TotalCols.ContainsKey(e.FieldName)||(t.HeaderAppearance.IsVisible=!1),this.oColumns.push(t)})}this.Report.ReportColumns=this.oColumns;for(let i=0;i<this.arrColGroups.length;i++)this.oRow=new u.d(this.Report.ReportColumns.length),this.Report.RowHeight>0&&(this.oRow.Height=this.Report.RowHeight+4),this.lstSb.push(this.oRow);if(this.oRow=new u.d(this.Report.ReportColumns.length),this.Report.RowHeight>0&&(this.oRow.Height=this.Report.RowHeight+4),this.lstSb.push(this.oRow),0==this.arrColGroups.length)for(let i=0;i<this.objValueColumns.length;i++)this.oCell=this.arrRowGroups.length>0?this.lstSb[0].Cells[1+this.arrColFields.length+i]:this.lstSb[0].Cells[this.arrRowGroups.length+this.arrColFields.length+i],this.oCell.Text=this.objValueColumns[i].HeaderText,this.oCell.Value=this.objValueColumns[i].HeaderText,this.oCell.IsNormal=!1,this.oCell.CellAppearance=this.objValueColumns[i].HeaderAppearance;else{this.lstsbCounter=new Array(this.lstSb.length).fill(0);for(let e=0;e<this.lstsbCounter.length;e++)this.lstsbCounter[e]=this.arrRowGroups.length>0?1+this.arrColFields.length:0+this.arrColFields.length;for(this.k=0;this.k<this.lstNodes.length;this.k++)0==this.lstNodes[this.k].Children.length?this.lstNodes[this.k].ColSpan=this.arrColumns.length:this.SetColumnsSpan(this.lstNodes[this.k]),this.FillColumnsData(this.lstNodes[this.k],0)}for(let i=0;i<this.objColFields.length;i++)this.oCell=this.arrRowGroups.length>0?this.lstSb[this.lstSb.length-1].Cells[1+i]:this.lstSb[this.lstSb.length-1].Cells[i],this.oCell.Text=this.objColFields[i].HeaderText,this.oCell.Value=this.objColFields[i].HeaderText,this.oCell.IsNormal=!1,this.oCell.CellAppearance=this.objColFields[i].HeaderAppearance;this.objRowGroups.length>0&&(this.oCell=this.lstSb[this.lstSb.length-1].Cells[0],this.oCell.Text=this.objRowGroups[0].HeaderText,this.oCell.Value=this.objRowGroups[0].HeaderText,this.oCell.IsNormal=!1,this.oCell.CellAppearance=this.objRowGroups[0].HeaderAppearance,this.oCell.CellAppearance.Alignment="Left");for(let i=0;i<this.lstSb.length;i++)this.lstSb[i].Type=u.f.Header,this.Report.addRow(this.lstSb[i]);this.Report.refreshDataView();let n=this.strRowGroups;n.length>0&&this.strColGroups.length>0&&(n+=","),n+=this.strColGroups,n.length>0&&this.dv.SortBy(n.split(","));let r=[],d=t.Copy(),c=!1,C=0,p=null,T=new Array(this.objValueColumns.length).fill(0),_=new Array(this.objColFields.length).fill(0);for(let l=0;l<this.dv.length;l++){for(c=!1,this.g=0;this.g<s.length;this.g++)this.Groupstr[s[this.g]]!=this.dv[l][s[this.g]].toString()&&(this.Groupstr[s[this.g]]=this.dv[l][s[this.g]].toString(),c=!0);if(c||0==l){for(let e=0;e<this.objValueColumns.length;e++)T[e]=i.e.Double(this.dv[l][this.objValueColumns[e].ID]);for(let e=0;e<this.objColFields.length;e++)"FLOAT"!=this.objColFields[e].ColumnType&&"TIME"!=this.objColFields[e].ColumnType||(_[e]=i.e.Double(this.dv[l][this.objColFields[e].ID]));p={},d.forEach(e=>{p[e]=this.dv[l][e]}),r.push(p)}else{for(let e=0;e<this.objValueColumns.length;e++)C=i.e.Double(this.dv[l][this.objValueColumns[e].ID]),"TIME"==this.objValueColumns[e].DataAppearance.ColumnType||"$TOTALHOURS$"==this.objValueColumns[e].Formula?T[e]=this.ReportViewModel.GetHoursSum(C,T[e]):T[e]+=C,p[this.objValueColumns[e].ID]=T[e];for(let e=0;e<this.objColFields.length;e++)"FLOAT"!=this.objColFields[e].ColumnType&&"TIME"!=this.objColFields[e].ColumnType||(C=i.e.Double(this.dv[l][this.objColFields[e].ID]),"TIME"==this.objColFields[e].DataAppearance.ColumnType||"$TOTALHOURS$"==this.objColFields[e].Formula?_[e]=this.ReportViewModel.GetHoursSum(C,_[e]):_[e]+=C,p[this.objColFields[e].ID]=_[e])}}this.dv=r;var m=this.objValueColumns.filter(e=>!i.e.IsEmptySpace(e.Formula)&&2==e.EvaluateAtEnd);if(m.length>0)for(let i=r.length-1;i>=0;i--)for(let e=0;e<m.length;e++)if(this.Report.CalculateFormula_2(m[e],r[i])){r.RemoveAt(i);break}if(this.strRowGroups!=o&&(n=o,n.length>0&&this.strColGroups.length>0&&(n+=","),n+=this.strColGroups,this.dv.SortBy(n.split(","))),this.k=0,this.g=0,this.iFirst_k=0,this.lstLabels=new Array,this.lstLabels_Summary=new Array,this.RowTotals=new Array(this.oColumns.length).fill(0),this.ColumnTotals=new Array(this.objValueColumns.length).fill(0),this.PrevColumnTotals=new Array(this.objValueColumns.length).fill(0),this.iCellCounter=this.arrColFields.length,this.oRow=null,this.arrRowGroups.length>0){if(this.addData(0),null!=this.oRow&&this.Report.addRow(this.oRow),this.Report.GrpReportTotal.SubTotalAppearance.IsVisible){this.oRow=new u.d(this.oColumns.length),this.oRow.Type=u.f.ReportTotal,this.oRow.Cells[0].Text=this.Report.GrpReportTotal.SubTotalPrefix[0],this.oRow.Cells[0].DataFormat=this.Report.GrpReportTotal.GroupFormat,this.oRow.Cells[0].CellAppearance=this.Report.GrpReportTotal.GroupAppearance,this.oRow.Cells[0].IsNormal=!1,this.Report.GrpReportTotal.SubTotalHeight>0&&(this.oRow.Height=this.Report.GrpReportTotal.SubTotalHeight);for(let e=1;e<this.oColumns.length;e++)if(this.oRow.Cells[e].DataFormat=this.oColumns[e].DataFormat,this.oRow.Cells[e].CellAppearance=this.Report.GrpReportTotal.SubTotalAppearance_Data,this.oRow.Cells[e].Border=this.Report.GrpReportTotal.SubTotalBorder,this.oRow.Cells[e].IsNormal=!1,this.Report.GrpReportTotal.TotalCols.ContainsKey(this.oColumns[e].FieldName))if(i.e.IsEmpty(this.oColumns[e].DataFormat.PercentageOn))this.ReportViewModel.SetCellValue(this.RowTotals[e],this.oColumns[e].DataFormat,this.oColumns[e].ColumnType,-1,this.oRow.Cells[e]);else{let t=0,s=this.RowTotals[e];if("REPORT_TOTAL"==this.oColumns[e].DataFormat.PercentageOn)t=0;else{let s=-1;for(s=e-1;s>=1;s--)if(0==this.arrColGroups.length){if(this.oColumns[s].ID==this.oColumns[e].DataFormat.PercentageOn)break}else if(this.oColumns[s].ID.startsWith(this.oColumns[e].DataFormat.PercentageOn+"_"))break;s>1&&(t=this.RowTotals[s])}if(s<=0||0==t)continue;t=100*s/t,this.ReportViewModel.SetCellValue(t,this.oColumns[e].DataFormat,this.oColumns[e].ColumnType,-1,this.oRow.Cells[e])}this.Report.addRow(this.oRow)}}else this.oRow=new u.d(this.oColumns.length),this.Report.RowHeight>0&&(this.oRow.Height=this.Report.RowHeight),this.k=this.dv.length-1,this.FillData(this.k),this.Report.addRow(this.oRow);this.Report.refreshDataView()}AddColumnNode(e,t){if(e<this.arrColGroups.length-1)this.objTempNode=new D,this.objTempNode.Value=this.dv[this.k][this.arrColGroups[e]].toString(),0==e?this.lstNodes.push(this.objTempNode):t.Children.push(this.objTempNode),this.stkNodes.push(this.objTempNode),this.AddColumnNode(e+1,this.objTempNode);else if(e==this.arrColGroups.length-1){for(let s=0;this.k<this.dv.length;this.k++,s++){if(0==s&&(this.objTempNode=new D,this.objTempNode.Value=this.dv[this.k][this.arrColGroups[e]].toString(),this.ColumnGroupsCnt++,0==e?this.lstNodes.push(this.objTempNode):t.Children.push(this.objTempNode)),this.k!=this.dv.length-1)for(this.g=0;this.g<=e&&this.dv[this.k+1][this.arrColGroups[this.g]].toString()==this.dv[this.k][this.arrColGroups[this.g]].toString();this.g++);if(this.g<e){this.k++;break}this.g==e&&(s=-1)}if(this.ShowColumnSubTotal.IsChecked&&(0==this.g||this.k==this.dv.length)&&this.arrColGroups.length>1){let e=new D;e.Value="TOTAL",e.ReportTotal=99,this.lstNodes.push(e),this.ColumnGroupsCnt++}if(this.k!=this.dv.length){for(let t=this.g;t<e;t++)this.objTempNode=this.stkNodes.pop();0==this.g?this.AddColumnNode(0,null):(this.objTempNode=this.stkNodes.pop(),this.stkNodes.push(this.objTempNode),this.AddColumnNode(this.g,this.objTempNode))}}else this.AddColumnNode(e+1,this.objTempNode)}SetColumnsSpan(e){e.Children.forEach(t=>{0==t.Children.length?(t.ColSpan=this.arrColumns.length,e.ColSpan+=this.arrColumns.length):(this.SetColumnsSpan(t),e.ColSpan+=t.ColSpan)})}FillColumnsData(e,t){if(this.oCell=this.lstSb[t].Cells[this.lstsbCounter[t]],this.oCell.Text=e.Value,this.oCell.Value=e.Value,e.ColSpan>1&&(this.oCell.ColSpan=e.ColSpan),e.ReportTotal>0?99==e.ReportTotal?(this.oCell.IsNormal=!1,this.oCell.CellAppearance=this.objColGroups[t].DataAppearance):(t=this.objColGroups.length-1,this.oCell.IsNormal=!1,this.oCell.CellAppearance=this.oColumns[this.lstsbCounter[t]].DataAppearance.Clone(),this.oCell.CellAppearance.Alignment="Left"):(this.oCell.IsNormal=!1,this.oCell.CellAppearance=this.objColGroups[t].DataAppearance,this.objColGroups[t].LinkType==h.a.Document&&(this.oCell.CellAppearance.ColumnType="LINK_DOCUMENT")),t+1==this.arrColGroups.length)for(let s=0;s<this.MatrixValues.Items.length;s++)this.oCell=this.lstSb[t+1].Cells[this.lstsbCounter[t]+s],this.oCell.Text=this.MatrixValues.Items[s].Name,this.oCell.Value=this.MatrixValues.Items[s].Name,this.oCell.IsNormal=!1,this.oCell.CellAppearance=this.objValueColumns[s].HeaderAppearance.Clone();if(this.lstsbCounter[t]+=e.ColSpan,99==e.ReportTotal){for(let e=0;e<this.MatrixValues.Items.length;e++)this.oCell=this.lstSb[this.arrColGroups.length].Cells[this.lstsbCounter[this.arrColGroups.length-1]+e],this.oCell.Text=this.MatrixValues.Items[e].Name,this.oCell.Value=this.MatrixValues.Items[e].Name,this.oCell.IsNormal=!1,this.oCell.CellAppearance=this.objValueColumns[e].HeaderAppearance.Clone();for(let t=1;t<this.lstsbCounter.length;t++)this.lstsbCounter[t]+=e.ColSpan}e.Children.forEach(e=>{this.FillColumnsData(e,t+1)})}addData(e){if(this.iCellCounter=1+this.objColFields.length,this.oRow=new u.d(this.oColumns.length),this.oRow.LevelNo=e,this.oRow.Cells[0].level=this.oRow.LevelNo,this.oRow.Cells[0].IsNormal=!1,this.Report.RowHeight>0&&(this.oRow.Height=this.Report.RowHeight),this.objRowGroups[e].LinkType==h.a.Document&&e==this.arrRowGroups.length-1&&(null==this.oRow.Cells[0].CellAppearance&&(this.oRow.Cells[0].CellAppearance=this.Report.ReportColumns[0].DataAppearance.Clone()),this.oRow.Cells[0].CellAppearance.ColumnType="LINK_DOCUMENT"),this.ReportViewModel.SetCellValue(this.dv[this.k][this.arrRowGroups[e]],this.objRowGroups[e].DataFormat,this.objRowGroups[e].ColumnType,-1,this.oRow.Cells[0]),e<this.arrRowGroups.length-1&&(this.ApplyGroupStyle(this.oRow),this.objRowGroups[e].LinkType==h.a.Document&&(this.oRow.Cells[0].CellAppearance.ColumnType="LINK_DOCUMENT"),this.oRow.Type=u.f.Group,this.FillData_Summary(e),this.Report.addRow(this.oRow)),e==this.arrRowGroups.length-1){this.flgFirst=0!=e;for(let t=0;this.k<this.dv.length;this.k++,t++){if(0==t)if(this.flgFirst)this.flgFirst=!1,this.ReportViewModel.SetCellValue(this.dv[this.k][this.arrRowGroups[e]],this.objRowGroups[e].DataFormat,this.objRowGroups[e].ColumnType,-1,this.oRow.Cells[0]),-1!=this.Report.colSNoIndex&&(this.oRow.Cells[0].Text=++this.Report.SNo+". "+this.oRow.Cells[0].Text);else{for(this.iCellCounter=1+this.objColFields.length,this.oRow=new u.d(this.oColumns.length),this.oRow.LevelNo=e,this.oRow.Cells[0].IsNormal=!1,this.oRow.Cells[0].level=this.oRow.LevelNo,this.Report.RowHeight>0&&(this.oRow.Height=this.Report.RowHeight),this.iCol=0;this.iCol<=e;this.iCol++)this.iCol==e&&(this.objRowGroups[e].LinkType==h.a.Document&&(null==this.oRow.Cells[0].CellAppearance&&(this.oRow.Cells[0].CellAppearance=this.Report.ReportColumns[0].DataAppearance.Clone()),this.oRow.Cells[0].CellAppearance.ColumnType="LINK_DOCUMENT"),this.ReportViewModel.SetCellValue(this.dv[this.k][this.arrRowGroups[e]],this.objRowGroups[e].DataFormat,this.objRowGroups[e].ColumnType,-1,this.oRow.Cells[0]));-1!=this.Report.colSNoIndex&&e==this.arrRowGroups.length-1&&(this.oRow.Cells[0].Text=++this.Report.SNo+". "+this.oRow.Cells[0].Text)}if(this.k!=this.dv.length-1){for(this.g=0;this.g<=e&&i.e.String(this.dv[this.k+1][this.arrRowGroups[this.g]])==i.e.String(this.dv[this.k][this.arrRowGroups[this.g]]);this.g++);if(this.g<e){this.FillData(t),this.k++,this.Report.addRow(this.oRow);break}this.g==e&&(this.FillData(t),this.Report.addRow(this.oRow),t=-1)}else this.FillData(t)}this.k!=this.dv.length&&(this.iFirst_k=this.g,this.addData(this.g))}else this.addData(e+1)}FillData(e){for(let t=0;t<this.ColumnTotals.length;t++)this.ColumnTotals[t]=0,this.PrevColumnTotals[t]=0;this.iSameRowsCnt=e+1;for(let t=0;t<this.lstNodes.length;t++)this.lstLabels.Clear(),this.FillCellData(this.lstNodes[t],0);if(0==this.lstNodes.length){let e,t;for(e=0;e<this.iSameRowsCnt;e++)for(t=0;t<this.objValueColumns.length;t++,this.iCellCounter++){if(i.e.IsEmpty(this.objValueColumns[t].DataFormat.PercentageOn))this.ReportViewModel.SetCellValue(this.dv[this.k-e][this.objValueColumns[t].ID],this.objValueColumns[t].DataFormat,this.objValueColumns[t].ColumnType,-1,this.oRow.Cells[this.iCellCounter]),this.Report.ApplyKPI_Matrix(this.dv[this.k-e],this.oRow.Cells[this.iCellCounter],this.objValueColumns[t],this.iCellCounter);else{let s=0,o=0;if(o=i.e.Double(this.dv[this.k-e][this.objValueColumns[t].ID]),s="REPORT_TOTAL"==this.objValueColumns[t].DataFormat.PercentageOn?0:i.e.Double(this.dv[this.k-e][this.objValueColumns[t].DataFormat.PercentageOn]),o<=0||0==s)continue;s=100*o/s,this.ReportViewModel.SetCellValue(s,this.objValueColumns[t].DataFormat,this.objValueColumns[t].ColumnType,-1,this.oRow.Cells[this.iCellCounter])}i.e.IsNum(this.dv[this.k-e][this.objValueColumns[t].ID])&&(this.dblTemp=i.e.Double(this.dv[this.k-e][this.objValueColumns[t].ID]),"TIME"==this.objValueColumns[t].DataAppearance.ColumnType||"$TOTALHOURS$"==this.objValueColumns[t].Formula?(this.RowTotals[this.iCellCounter]=this.ReportViewModel.GetHoursSum(this.dblTemp,this.RowTotals[this.iCellCounter]),this.ColumnTotals[t]=this.ReportViewModel.GetHoursSum(this.dblTemp,this.ColumnTotals[t])):(this.RowTotals[this.iCellCounter]+=this.dblTemp,this.ColumnTotals[t]+=this.dblTemp))}}if(this.objColFields.length>0){let e,t,s=new Array(this.objColFields.length).fill(0);for(e=0;e<this.iSameRowsCnt;e++)for(t=0;t<this.objColFields.length;t++)this.ReportViewModel.SetCellValue(this.dv[this.k-e][this.objColFields[t].ID],this.objColFields[t].DataFormat,this.objColFields[t].ColumnType,-1,this.oRow.Cells[1+t]),"FLOAT"==this.objColFields[t].ColumnType?(this.dblTemp=i.e.Double(this.dv[this.k-e][this.objColFields[t].ID]),this.dblTemp=this.Report.RoundOff_2(this.dblTemp,this.objColFields[t].DataFormat),0==this.objColFields[t].UseOnce?(this.RowTotals[1+t]+=this.dblTemp,s[t]+=this.dblTemp,this.ReportViewModel.SetCellValue(s[t],this.objColFields[t].DataFormat,this.objColFields[t].ColumnType,-1,this.oRow.Cells[1+t])):0==e&&(this.RowTotals[1+t]+=this.dblTemp)):"TIME"!=this.objColFields[t].DataAppearance.ColumnType&&"$TOTALHOURS$"!=this.objColFields[t].Formula||i.e.IsNum(this.dv[this.k-e][this.objColFields[t].ID])&&(this.dblTemp=i.e.Double(this.dv[this.k-e][this.objColFields[t].ID]),this.dblTemp=this.Report.RoundOff_2(this.dblTemp,this.objColFields[t].DataFormat),this.RowTotals[1+t]=this.ReportViewModel.GetHoursSum(this.dblTemp,this.RowTotals[1+t]))}}FillCellData(e,t){if(100==e.ReportTotal)for(let s=0;s<this.objValueColumns.length;s++,this.iCellCounter++){if(i.e.IsEmpty(this.objValueColumns[s].DataFormat.PercentageOn))this.ReportViewModel.SetCellValue(this.ColumnTotals[s],this.objValueColumns[s].DataFormat,this.objValueColumns[s].ColumnType,-1,this.oRow.Cells[this.iCellCounter]);else{let e=0,t=this.ColumnTotals[s];if("REPORT_TOTAL"==this.objValueColumns[s].DataFormat.PercentageOn)e=0;else{let t=-1;for(t=0;t<this.objValueColumns.length&&this.objValueColumns[t].ID!=this.objValueColumns[s].DataFormat.PercentageOn;t++);t<this.objValueColumns.length&&(e=this.ColumnTotals[t])}if(t<=0||0==e)continue;e=100*t/e,this.ReportViewModel.SetCellValue(e,this.objValueColumns[s].DataFormat,this.objValueColumns[s].ColumnType,-1,this.oRow.Cells[this.iCellCounter])}"TIME"==this.objValueColumns[s].DataAppearance.ColumnType||"$TOTALHOURS$"==this.objValueColumns[s].Formula?this.RowTotals[this.iCellCounter]=this.ReportViewModel.GetHoursSum(this.ColumnTotals[s],this.RowTotals[this.iCellCounter]):this.RowTotals[this.iCellCounter]+=this.ColumnTotals[s]}else if(99==e.ReportTotal)for(let s=0;s<this.objValueColumns.length;s++,this.iCellCounter++)"TIME"==this.objValueColumns[s].DataAppearance.ColumnType||"$TOTALHOURS$"==this.objValueColumns[s].Formula?(this.dblTemp=this.ReportViewModel.GetHoursSum(this.ColumnTotals[s],-this.PrevColumnTotals[s]),this.ReportViewModel.SetCellValue(this.dblTemp,this.objValueColumns[s].DataFormat,this.objValueColumns[s].ColumnType,-1,this.oRow.Cells[this.iCellCounter]),this.RowTotals[this.iCellCounter]=this.ReportViewModel.GetHoursSum(this.dblTemp,this.RowTotals[this.iCellCounter])):(this.ReportViewModel.SetCellValue(this.ColumnTotals[s]-this.PrevColumnTotals[s],this.objValueColumns[s].DataFormat,this.objValueColumns[s].ColumnType,-1,this.oRow.Cells[this.iCellCounter]),this.RowTotals[this.iCellCounter]+=this.ColumnTotals[s]-this.PrevColumnTotals[s]),this.PrevColumnTotals[s]=this.ColumnTotals[s];else{if(this.lstLabels.push(e.Value),0==e.Children.length){let e,t;for(e=0;e<this.iSameRowsCnt;e++){for(t=0;t<this.arrColGroups.length&&this.lstLabels[t]==this.dv[this.k-e][this.arrColGroups[t]].toString();t++);if(t==this.arrColGroups.length)break}if(e!=this.iSameRowsCnt)for(t=0;t<this.objValueColumns.length;t++,this.iCellCounter++){if(i.e.IsEmpty(this.objValueColumns[t].DataFormat.PercentageOn))this.ReportViewModel.SetCellValue(this.dv[this.k-e][this.objValueColumns[t].ID],this.objValueColumns[t].DataFormat,this.objValueColumns[t].ColumnType,-1,this.oRow.Cells[this.iCellCounter]),this.Report.ApplyKPI_Matrix(this.dv[this.k-e],this.oRow.Cells[this.iCellCounter],this.objValueColumns[t],this.iCellCounter);else{let s=0,o=0;if(o=i.e.Double(this.dv[this.k-e][this.objValueColumns[t].ID]),s="REPORT_TOTAL"==this.objValueColumns[t].DataFormat.PercentageOn?0:i.e.Double(this.dv[this.k-e][this.objValueColumns[t].DataFormat.PercentageOn]),o<=0||0==s)continue;s=100*o/s,this.ReportViewModel.SetCellValue(s,this.objValueColumns[t].DataFormat,this.objValueColumns[t].ColumnType,-1,this.oRow.Cells[this.iCellCounter])}i.e.IsNum(this.dv[this.k-e][this.objValueColumns[t].ID])&&(this.dblTemp=i.e.Double(this.dv[this.k-e][this.objValueColumns[t].ID]),"TIME"==this.objValueColumns[t].DataAppearance.ColumnType||"$TOTALHOURS$"==this.objValueColumns[t].Formula?(this.RowTotals[this.iCellCounter]=this.ReportViewModel.GetHoursSum(this.dblTemp,this.RowTotals[this.iCellCounter]),this.ColumnTotals[t]=this.ReportViewModel.GetHoursSum(this.dblTemp,this.ColumnTotals[t])):(this.dblTemp=this.Report.RoundOff_2(this.dblTemp,this.objValueColumns[t].DataFormat),this.RowTotals[this.iCellCounter]+=this.dblTemp,this.ColumnTotals[t]+=this.dblTemp))}else this.iCellCounter+=this.objValueColumns.length}e.Children.forEach(e=>{this.FillCellData(e,t+1),this.lstLabels.RemoveAt(this.lstLabels.length-1)})}}FillData_Summary(e){if(0==this.lstNodes.length){let t,s,o=new Array(this.objValueColumns.length).fill(0),l=new Array(this.objColFields.length).fill(0);for(s=0;s<=e;s++)this.Groupstr[this.arrRowGroups[s]]=this.dv[this.k][this.arrRowGroups[s]].toString();for(t=this.k;t<this.dv.length;t++){for(s=0;s<=e&&this.Groupstr[this.arrRowGroups[s]]==this.dv[t][this.arrRowGroups[s]].toString();s++);if(s<=e)break;if(t==this.k){for(let e=0;e<this.objValueColumns.length;e++)o[e]=i.e.Double(this.dv[t][this.objValueColumns[e].ID]);for(let e=0;e<this.objColFields.length;e++)"FLOAT"!=this.objColFields[e].ColumnType&&"TIME"!=this.objColFields[e].ColumnType&&"$TOTALHOURS$"!=this.objColFields[e].Formula||(l[e]=i.e.Double(this.dv[t][this.objColFields[e].ID]))}else{for(let e=0;e<this.objValueColumns.length;e++)this.dblTemp=i.e.Double(this.dv[t][this.objValueColumns[e].ID]),"TIME"==this.objValueColumns[e].ColumnType||"$TOTALHOURS$"==this.objValueColumns[e].Formula?o[e]=this.ReportViewModel.GetHoursSum(this.dblTemp,o[e]):(this.dblTemp=this.Report.RoundOff_2(this.dblTemp,this.objValueColumns[e].DataFormat),o[e]+=this.dblTemp);for(let e=0;e<this.objColFields.length;e++)"FLOAT"==this.objColFields[e].ColumnType?(this.dblTemp=i.e.Double(this.dv[t][this.objColFields[e].ID]),this.dblTemp=this.Report.RoundOff_2(this.dblTemp,this.objColFields[e].DataFormat),l[e]+=this.dblTemp):"TIME"!=this.objColFields[e].ColumnType&&"$TOTALHOURS$"!=this.objColFields[e].Formula||(this.dblTemp=i.e.Double(this.dv[t][this.objColFields[e].ID]),this.dblTemp=this.Report.RoundOff_2(this.dblTemp,this.objColFields[e].DataFormat),l[e]=this.ReportViewModel.GetHoursSum(this.dblTemp,l[e]))}}for(s=0;s<this.objValueColumns.length;s++)if(i.e.IsEmpty(this.objValueColumns[s].DataFormat.PercentageOn))this.ReportViewModel.SetCellValue(o[s],this.objValueColumns[s].DataFormat,this.objValueColumns[s].ColumnType,-1,this.oRow.Cells[s+1+this.arrColFields.length]);else{let e=0,t=o[s];if("REPORT_TOTAL"==this.objValueColumns[s].DataFormat.PercentageOn)e=0;else{let t=-1;for(t=0;t<this.objValueColumns.length&&this.objValueColumns[t].ID!=this.objValueColumns[s].DataFormat.PercentageOn;t++);t<this.objValueColumns.length&&(e=o[t])}if(t<=0||0==e)continue;e=100*t/e,this.ReportViewModel.SetCellValue(e,this.objValueColumns[s].DataFormat,this.objValueColumns[s].ColumnType,-1,this.oRow.Cells[s+1+this.arrColFields.length])}for(s=0;s<this.objColFields.length;s++)if("FLOAT"==this.objColFields[s].ColumnType||"TIME"==this.objColFields[s].ColumnType||"$TOTALHOURS$"==this.objColFields[s].Formula)if(i.e.IsEmpty(this.objColFields[s].DataFormat.PercentageOn))this.ReportViewModel.SetCellValue(l[s],this.objColFields[s].DataFormat,this.objColFields[s].ColumnType,-1,this.oRow.Cells[s+1]);else{let e=0,t=l[s];if("REPORT_TOTAL"==this.objColFields[s].DataFormat.PercentageOn)e=0;else{let t=-1;for(t=0;t<this.objColFields.length&&this.objColFields[t].ID!=this.objColFields[s].DataFormat.PercentageOn;t++);t<this.objColFields.length&&(e=l[t])}if(t<=0||0==e)continue;e=100*t/e,this.ReportViewModel.SetCellValue(e,this.objColFields[s].DataFormat,this.objColFields[s].ColumnType,-1,this.oRow.Cells[s+1])}}else{for(let e=0;e<this.ColumnTotals.length;e++)this.ColumnTotals[e]=0,this.PrevColumnTotals[e]=0;for(let t=0;t<this.lstNodes.length;t++)this.lstLabels_Summary.Clear(),this.FillCellData_Summary(this.lstNodes[t],e,0)}}FillCellData_Summary(e,t,s){if(100==e.ReportTotal)for(let o=0;o<this.objValueColumns.length;o++,this.iCellCounter++)if(i.e.IsEmpty(this.objValueColumns[o].DataFormat.PercentageOn))this.ReportViewModel.SetCellValue(this.ColumnTotals[o],this.objValueColumns[o].DataFormat,this.objValueColumns[o].ColumnType,-1,this.oRow.Cells[this.iCellCounter]);else{let e=0,t=this.ColumnTotals[o];if("REPORT_TOTAL"==this.objValueColumns[o].DataFormat.PercentageOn)e=0;else{let t=-1;for(t=0;t<this.objValueColumns.length&&this.objValueColumns[t].ID!=this.objValueColumns[o].DataFormat.PercentageOn;t++);t<this.objValueColumns.length&&(e=this.ColumnTotals[t])}if(t<=0||0==e)continue;e=100*t/e,this.ReportViewModel.SetCellValue(e,this.objValueColumns[o].DataFormat,this.objValueColumns[o].ColumnType,-1,this.oRow.Cells[this.iCellCounter])}else if(99==e.ReportTotal)for(let o=0;o<this.objValueColumns.length;o++,this.iCellCounter++)this.ReportViewModel.SetCellValue(this.ColumnTotals[o]-this.PrevColumnTotals[o],this.objValueColumns[o].DataFormat,this.objValueColumns[o].ColumnType,-1,this.oRow.Cells[this.iCellCounter]),this.PrevColumnTotals[o]=this.ColumnTotals[o];else if(this.stkNodes_Summary.push(e),this.lstLabels_Summary.push(e.Value),0==e.Children.length){new Array(this.objValueColumns.length).fill(0);let e,s=this.dv;for(e=0;e<this.lstLabels_Summary.length;e++)s=s.filter(t=>t[this.arrColGroups[e]]==this.lstLabels_Summary[e].toString().Replace("'","''"));for(e=0;e<=t;e++)s=s.filter(t=>t[this.arrRowGroups[e]]==this.dv[this.k][this.arrRowGroups[e]].toString().Replace("'","''"));for(e=0;e<this.objValueColumns.length;e++,this.iCellCounter++){let t;if("TIME"==this.objValueColumns[e].ColumnType||"$TOTALHOURS$"==this.objValueColumns[e].Formula){let s=0;this.dv.forEach(t=>{null!=t[this.objValueColumns[e].ID]&&(this.dblTemp=i.e.Double(t[this.objValueColumns[e].ID]),s=this.ReportViewModel.GetHoursSum(this.dblTemp,s))}),t=s}else t=s.Compute("sum",this.objValueColumns[e].ID);if(null!=t){if(i.e.IsEmpty(this.objValueColumns[e].DataFormat.PercentageOn))this.ReportViewModel.SetCellValue(t,this.objValueColumns[e].DataFormat,this.objValueColumns[e].ColumnType,-1,this.oRow.Cells[this.iCellCounter]);else{let s=0,o=parseFloat(t);if("REPORT_TOTAL"==this.objValueColumns[e].DataFormat.PercentageOn)s=0;else{let t=-1;for(t=0;t<this.objValueColumns.length&&this.objValueColumns[t].ID!=this.objValueColumns[e].DataFormat.PercentageOn;t++);if(t<this.objValueColumns.length){t++;let e=this.oRow.Cells[this.iCellCounter-(this.objValueColumns.length-t)].Value;null!=e&&(s=i.e.Double(e))}}if(o<=0||0==s)continue;s=100*o/s,this.ReportViewModel.SetCellValue(s,this.objValueColumns[e].DataFormat,this.objValueColumns[e].ColumnType,-1,this.oRow.Cells[this.iCellCounter])}"TIME"==this.objValueColumns[e].ColumnType||"$TOTALHOURS$"==this.objValueColumns[e].Formula?this.ColumnTotals[e]=this.ReportViewModel.GetHoursSum(parseFloat(t),this.ColumnTotals[e]):this.ColumnTotals[e]+=parseFloat(t)}else this.ReportViewModel.SetCellValue(0,this.objValueColumns[e].DataFormat,this.objValueColumns[e].ColumnType,-1,this.oRow.Cells[this.iCellCounter])}}e.Children.forEach(e=>{this.FillCellData_Summary(e,t,s+1),this.lstLabels_Summary.RemoveAt(this.lstLabels_Summary.length-1)})}ApplyGroupStyle(e){let t=new u.a;t.IsBold=!1,t.ForeColor="#FF0081A6",t.BackColor="White",t.FontFamilyName="Arial",t.FontSize=12,t.Alignment="Right",e.Cells.forEach(e=>{e.IsNormal=!1,e.CellAppearance=t.Clone()}),this.objRowGroups.length>0&&(e.Cells[0].CellAppearance.Alignment="Left")}}},ThYU:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"ReportViewModel",(function(){return ReportViewModel})),__webpack_require__.d(__webpack_exports__,"Group",(function(){return Group}));var tslib__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("mrSG"),_services_base_service__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("Do2H"),_services_formula_service__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("uMy8"),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("Lp6j"),_util_dictionary__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("vTM8"),angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("eQJW"),_IPrefetchFilter__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("/G+I"),_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("mvPR"),_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("dH+5"),_shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("0/4Q"),_shared_models_controls_PactButtonData__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("NkMH"),_shared_models_controls_PactRadioButtonData__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("PDNK"),_shared_models_controls_PactDatePickerData__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("JIg3"),_shared_models_controls_PactControlData__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("4HhE"),_shared_models_controls_PactListBoxData__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("n56n"),_shared_models_controls_PactLinkData__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("FruK"),_shared_models_controls_PactTextBlockData__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("Agar"),_Models_PostDataField__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("x+Dt"),_vptdialog_VPTDialogViewModel__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("ia84"),_add_edit_filter_AddEditFilterViewModel__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("XPEG"),_static_report_filter_StaticReportFilterViewModel__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("OHLA"),_Models_ReportColumnProperties__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("USNh"),_costcenter_picker_CostCenterPicker__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__("ktgv"),_StaticReports_ACC_GeneralLedger__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__("WqAs"),util__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__("MCLT"),util__WEBPACK_IMPORTED_MODULE_24___default=__webpack_require__.n(util__WEBPACK_IMPORTED_MODULE_24__),_shared_models_controls_PactTextBoxData__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__("EQd/"),_services_session_manager_service__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__("7N07"),_shared_controls_tree_TreeNode__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__("ZDA+"),_pages_home_RibbonExtViewModel__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__("CUWK"),_costcenter_filter_CostCenterFilter__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__("7JXL"),_MatrixReport__WEBPACK_IMPORTED_MODULE_30__=__webpack_require__("RiXB"),_document_viewer_DocumentViewerViewModel__WEBPACK_IMPORTED_MODULE_31__=__webpack_require__("RQ5z"),_document_viewer_document_viewer_component__WEBPACK_IMPORTED_MODULE_32__=__webpack_require__("8GKY"),_StaticReports_StaticReportsViewModel__WEBPACK_IMPORTED_MODULE_33__=__webpack_require__("1xwR"),_send_email_sms_send_email_sms_component__WEBPACK_IMPORTED_MODULE_34__=__webpack_require__("7i9q"),_send_email_sms_SendEmailSMSViewModel__WEBPACK_IMPORTED_MODULE_35__=__webpack_require__("wnwj"),_StaticReports_INV_StockLedger__WEBPACK_IMPORTED_MODULE_36__=__webpack_require__("Zgxw"),_StaticReports_REN_Property__WEBPACK_IMPORTED_MODULE_37__=__webpack_require__("4Moq"),_StaticReports_ACC_BillWiseReports__WEBPACK_IMPORTED_MODULE_38__=__webpack_require__("/nZE"),_StaticReportsTemp_ACC_PLTemplate__WEBPACK_IMPORTED_MODULE_39__=__webpack_require__("Cma4"),_re_order_level_ReOrderLevelNewViewModel__WEBPACK_IMPORTED_MODULE_40__=__webpack_require__("BBu9"),_re_order_level_re_order_level_component__WEBPACK_IMPORTED_MODULE_41__=__webpack_require__("TacQ"),_document_document_flow_chart_DocumentFlowChartViewModel__WEBPACK_IMPORTED_MODULE_42__=__webpack_require__("d36O"),_document_document_flow_chart_document_flow_chart_component__WEBPACK_IMPORTED_MODULE_43__=__webpack_require__("oiZC"),_report_view_component__WEBPACK_IMPORTED_MODULE_44__=__webpack_require__("YU11"),_row_details_RowDetailsDialogViewModel__WEBPACK_IMPORTED_MODULE_45__=__webpack_require__("2BcO"),_row_details_row_details_component__WEBPACK_IMPORTED_MODULE_46__=__webpack_require__("7ODK"),_save_as_dialog_SaveAsDialogViewModel__WEBPACK_IMPORTED_MODULE_47__=__webpack_require__("l3BA"),_save_as_dialog_save_as_dialog_component__WEBPACK_IMPORTED_MODULE_48__=__webpack_require__("jp4k"),_approve_approve_component__WEBPACK_IMPORTED_MODULE_49__=__webpack_require__("Br+L"),_approve_ApproveViewModel__WEBPACK_IMPORTED_MODULE_50__=__webpack_require__("zQUM"),_static_report_filter_ReportFilterDialog__WEBPACK_IMPORTED_MODULE_51__=__webpack_require__("8iaB"),_StaticReports_PAY_Reports__WEBPACK_IMPORTED_MODULE_52__=__webpack_require__("nif3"),_send_email_sms_Notifications__WEBPACK_IMPORTED_MODULE_53__=__webpack_require__("/EUh");class ReportViewModel extends _IPrefetchFilter__WEBPACK_IMPORTED_MODULE_6__.IPrefetchFilter{constructor(){super(),this.Data=[],this.slickrowid=0,this.AgGridEnable=!1,this.HideReportAtLoad=!1,this.RptListShow=!0,this.PrintCallBack=new _shared_models_controls_PactControlData__WEBPACK_IMPORTED_MODULE_13__.b,this.SubTotalCallBack=null,this.SubTotalBeforeCallBack=null,this.ContextMenuItems=[],this.RefreshGridColumns=new _shared_models_controls_PactControlData__WEBPACK_IMPORTED_MODULE_13__.b,this.AllowDrop=!1,this._ShowReportFilter=!1,this._ReportFilterSelectAll=!0,this.ShowMatrixPanel=!1,this.ShowMatrixButtonVisible=!0,this.ShowExport=!1,this.RptHeight=NaN,this.RptWidth=NaN,this.ShowQuery=!1,this.ShowTransactionQuery=!1,this.ShowLinkingQuery=!1,this.SearchVisibility=!0,this.ColumnSpan="4",this._SelectedRow=null,this.SearchColumns=new _shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__.e(0),this.AccountDrillDownObject=null,this.ShowAccountDrillDown=!1,this._LoadingVisibility=!1,this.IsReportLoad=!1,this.OptionIndexObj=new _shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__.e,this.SaveWord=new _shared_models_controls_PactRadioButtonData__WEBPACK_IMPORTED_MODULE_11__.a("LW Document",10,"LW Document"),this.SaveXLS=new _shared_models_controls_PactRadioButtonData__WEBPACK_IMPORTED_MODULE_11__.a("LW Document",10,"LW Document"),this.SaveXLSX=new _shared_models_controls_PactRadioButtonData__WEBPACK_IMPORTED_MODULE_11__.a("LW Document",10,"LW Document"),this.SaveHTML=new _shared_models_controls_PactRadioButtonData__WEBPACK_IMPORTED_MODULE_11__.a("LW Document",10,"LW Document"),this.SavePDF=new _shared_models_controls_PactRadioButtonData__WEBPACK_IMPORTED_MODULE_11__.a("LW Document",10,"LW Document"),this.SaveText=_shared_models_controls_PactTextBoxData__WEBPACK_IMPORTED_MODULE_25__.d.PactTextBoxData_2("LW Document",10),this.SaveToExistXLS=new _shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__.e,this.PreProcessReport=new _shared_models_controls_PactRadioButtonData__WEBPACK_IMPORTED_MODULE_11__.a("LW Document",10,"LW Document"),this.MSAccessExport=new _shared_models_controls_PactRadioButtonData__WEBPACK_IMPORTED_MODULE_11__.a("LW Document",10,"LW Document"),this.ExportList=new _shared_models_controls_PactRadioButtonData__WEBPACK_IMPORTED_MODULE_11__.b,this.hiddenTotals=[],this.PercentTotals=null,this.IsSummary=!1,this.IsReportCollapsable=!0,this.IsTotalColsAdded=!1,this.PercentColumnExists=!1,this.HidePrefetch=!1,this.FormulasCalculated=!1,this.IsTreeDataCalculated=!1,this.IsFilterRendering=!1,this.TreeGroupPrint=!0,this.IsDocMapXMLExists=!1,this.HideRightNavigation=!1,this.IsReportDB=!1,this.CanSelectRows=!1,this.lstGroup=[],this.Groupstr=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a,this.TotalCols=[],this.RowHeight=0,this.SubRowHeight=0,this.HeaderHeight=1,this.ShowGridLines="",this.VerticalAlignment="Bottom",this.ReportID=0,this.ReturnType=0,this.SNo=0,this.colSNoIndex=-1,this.StatusDocID=0,this.TotalRowCount=0,this.MaxRowsUnder=0,this.STMaxRowsUnder=[0,0,0,0,0],this.TopRecords=0,this.CumulativeIndex=-1,this.PrintonLang=0,this.TreeTotalBorder=0,this.GrpReportTotal=new Group,this._ReportData=[],this.ReportDataColumns=[],this.ReportNoDataGroups=null,this.ReportNoDataGroupColumnss=null,this.ReportDoc=null,this.eval=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.b,this.FromDatePicker=null,this.ToDatePicker=null,this.BackTrackType="",this.CumulativeColumn="",this.ReportQuery=null,this.ReportDims="",this.FormulaColumns=[],this.ColumnFilters=[],this.HiddenNumericColumns=[],this.process=new _shared_models_controls_PactControlData__WEBPACK_IMPORTED_MODULE_13__.a,this.processArgs={},this.ShowHeaderButtons=!1,this.HidePostFilters=!1,this.DispayAsPopup=!1,this.QueryProductID=0,this.QueryProductCCWhere="",this.QueryProductCCXML="",this.QueryTimer=null,this.QueryReportPref=null,this.QueryDocumentsVisibility=!1,this.QueryMastersVisibility=!1,this.QueryFieldsVisibility=!1,this.dvQueryFields=null,this.dvQueryFieldsTable=null,this.sbQueryFields="",this.FilterText=[],this.DBPanel=null,this.ComparisonQuotationVisible=!1,this.ComparisonINTERQTN="",this.ComparisonGrid=null,this._RefreshVisibility=!0,this.RegenerateVisibility=!0,this.PriceChartVisibility=!1,this.Chart=null,this.xDocMap=null,this.xMapXML=null,this.ChildReports=[],this.dicColumnIndex=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a,this.kpiList=[],this.kpiListSrc=[],this.dicRepeatColsMap=null,this.IsProductGroupLevel=!1,this.IsSummaryGroupsExists=!1,this.DocumentObject=null,this.sbSummaryDimensions="",this.lstSummaryDistinctNumeric=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a,this.lstSummaryAplha=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a,this.lstSummaryCells=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a,this.lstRepeatSummaryAplha=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a,this.dicSubReportStart=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.c,this.IsDefaultSortColumnExists=!1,this.GrandTotalTextInSubReports="",this.MergeChildReport=!1,this.ShowReportTitleInSubReports=!1,this.ShowGrandTotalInSubReports=!1,this.PrintSeperateInSubReports=!1,this.childReportTitle=null,this.childReportColumnHeader=null,this.POSExitViewModel=null,this.TransferData=null,this.SystemDate=Date.Today(),this.SystemDateTime=new Date,this.CURRENT_MONTHSTART=new Date(Date.Today().getFullYear(),Date.Today().getMonth(),1),this.PRV_MONTHSTART=new Date(Date.Today().getFullYear(),Date.Today().getMonth(),1),this.PRV_MONTHEND=new Date(Date.Today().getFullYear(),Date.Today().getMonth(),1),this.Current_YearStartDate=new Date(Date.Today().getFullYear(),0,1),this.PRV_YEARSTART=new Date(Date.Today().getFullYear(),0,1),this.PRV_YEARFROMDATE=new Date(Date.Today().getFullYear(),0,1),this.PRV_YEARTODATE=new Date(Date.Today().getFullYear(),0,1),this.iCurrGroupDetailRows=0,this.DocsLanding=null,this.IsFirstCall=!1,this.HideCostCenterTree=!1,this.HideEmptyRows=!1,this.lstGroupIndex=[],this.Preferences=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a,this.ColumnSource=null,this.ColumnSourceALL=null,this.StaticReportObject=null,this.callbackDel=new _shared_models_controls_PactControlData__WEBPACK_IMPORTED_MODULE_13__.b,this.childReportIndex=0,this.evalFormula=null,this.dicFieldText=[],this.dicTreeText=[],this.iGroupRowsAdded=0,this.iTopGroupSummaryConsider=!1,this.IsNewGroupIndex=-1,this.LevelNo=0,this.GroupTotalsAtEnd=!1,this.DontShowSummaryGroupTotals=!1,this.lstTotal=null,this.lstParents=[],this.oBody=null,this.PrintEachAccountIDForNotif=0,this.IsSortAscending=!0,this.ClassName="ReportViewModel",this.OptionIndexObj.Items.push(_shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__.d.ComboBoxItems_2(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Com_Equals"),"0")),this.OptionIndexObj.Items.push(_shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__.d.ComboBoxItems_2(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Com_NotEquals"),"1")),this.OptionIndexObj.Items.push(_shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__.d.ComboBoxItems_2(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Com_BeginsWith"),"2")),this.OptionIndexObj.Items.push(_shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__.d.ComboBoxItems_2(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Com_EndsWith"),"3")),this.OptionIndexObj.Items.push(_shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__.d.ComboBoxItems_2(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Com_Contains"),"4")),this.OptionIndexObj.Items.push(_shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__.d.ComboBoxItems_2(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Com_NotContains"),"5")),this.OptionIndexObj.SelectedValue="4"}addRow(e){Object(util__WEBPACK_IMPORTED_MODULE_24__.isUndefined)(e.id)&&(e.id=null==this.ParentReport?++this.slickrowid:++this.ParentReport.slickrowid),this.Data.push(e),this.Data.length%500==0&&this.refreshDataView()}addRows(e){e.forEach(e=>{this.addRow(e)})}removeRow(e){this.Data.Remove(e)}removeRowAt(e){let t;t=this.Data[e],this.Data.Remove(t)}insertRowAt(e,t){Object(util__WEBPACK_IMPORTED_MODULE_24__.isUndefined)(e.id)&&(e.id=++this.slickrowid),this.Data.splice(t,0,e)}updateRow(e){if(this.angularGrid&&this.Data.Contains(e))try{this.angularGrid.gridService.updateItem(e,{highlightRow:!1,triggerEvent:!1})}catch(t){console.log("updateRow")}}ClearRows(){this.Data.Clear(),this.refreshDataView()}refreshDataView(){this.angularGrid&&this.angularGrid.dataView.refresh()}refreshUI(){this.angularGrid&&this.angularGrid.resizerService.resizeGrid()}get ReportColumns(){return this._ReportColumns}set ReportColumns(e){null!=this.PostDataFetchFilterFields&&this.PostDataFetchFilterFields.filter(e=>!e.ShowColumn).forEach(t=>{var s=e.find(e=>e.ID==t.ColumnName);s&&(s.HeaderAppearance.IsVisible=!1)}),this._ReportColumns=e,this.RefreshGridColumns.Call(),this._ReportColumns.forEach(e=>{e.DataFormat.CumTotal>=0&&!this.TotalCols.Contains(e.ID)&&this.TotalCols.push(e.ID)});for(let t=0;t<this._ReportColumns.length;t++)this._ReportColumns[t].Index=t;if(this.RepeatType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.None&&null!=this.dicRepeatColsMap&&(this.kpiList.Clear(),this.kpiListSrc.forEach(e=>{if(this.dicRepeatColsMap.keys.Contains(e.ID)){let t=0;this.dicRepeatColsMap[e.ID].forEach(s=>{let o=new _StaticReports_StaticReportsViewModel__WEBPACK_IMPORTED_MODULE_33__.a;o.KPI_2(e,t),this.kpiList.push(o),t++})}else this.kpiList.push(e)})),this.kpiList.forEach(e=>{e.RefreshColumnIndex()}),this.HiddenNumericColumns.length>0){let t=Math.max.apply(Math,e.map((function(e){return e.Row}))),s=Math.max.apply(Math,this.HiddenNumericColumns.map((function(e){return e.Row})));this.MaxRowsUnder=Math.max(t,s)}else e.length>0&&(this.MaxRowsUnder=Math.max.apply(Math,e.map((function(e){return e.Row}))));if(null!=this.childReportTitle&&null==this.ParentReport){let e=this.Data.indexOf(this.childReportTitle);this.AddReportTitleRow(this.Reportds.Tables[0][0].ReportName.toString(),!1),-1!=e&&(this.removeRowAt(e),this.insertRowAt(this.childReportTitle,e))}if(null!=this.childReportColumnHeader&&null!=this.ParentReport){let e=this.Data.indexOf(this.childReportColumnHeader);this.AddReportColumnRow(!1),-1!=e&&(this.removeRowAt(e),this.insertRowAt(this.childReportColumnHeader,e))}this.ChildReports.forEach(e=>{e.RefreshChildReportColumns()})}get ShowReportFilter(){return this._ShowReportFilter}set ShowReportFilter(e){e!=(this._ShowReportFilter||this.HidePostFilters)&&(this._ShowReportFilter=e)}get ReportFilterSelectAll(){return this._ReportFilterSelectAll}set ReportFilterSelectAll(e){e!=this._ReportFilterSelectAll&&(this._ReportFilterSelectAll=e,this.PostDataFetchFilterFields.forEach(t=>{t.ShowColumn=e,this.onColumnCheckedChanged(t)}))}get SerachValue(){return this._SerachValue}set SerachValue(e){e!=this._SerachValue&&(this._SerachValue=e,this.Search())}get SelectedRow(){return this._SelectedRow}set SelectedRow(e){e!=this._SelectedRow&&(this._SelectedRow=e,this.LoadQueryDataOnRowSelection())}get LoadingVisibility(){return this._LoadingVisibility}set LoadingVisibility(e){e!=this._LoadingVisibility&&(null!=this.Chart&&(this.Chart.LoadingVisibility=e),this._LoadingVisibility=e)}get ReportData(){return this._ReportData}set ReportData(e){this._ReportData=e,null==e&&(this.ReportDataColumns=null)}get RefreshVisibility(){return this._RefreshVisibility}set RefreshVisibility(e){e!=this._RefreshVisibility&&(this._RefreshVisibility=e,this.RegenerateVisibility=e)}Refresh_lstSummaryData(){this.lstSummaryAplha.Clear(),this.lstSummaryDistinctNumeric.Clear(),this.lstSummaryCells.Clear(),this.ReportColumns.forEach(e=>{this.lstSummaryAplha.push(e.ID,[]),-1==e.UseOnce&&"FLOAT"==e.ColumnType&&this.lstSummaryDistinctNumeric.push(e.ID,[]),this.lstSummaryCells.push(e.ID,[])})}static ReportViewModel(){ReportViewModel.evalNumFormat=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.b,ReportViewModel.evalNumFormat.ThrowException=!1,ReportViewModel.evalNumFormat.SetKeyWords("REPORT"),ReportViewModel.fldDictNumFormat=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a,ReportViewModel.fldDictNumFormat.push("value",new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("value",0)),ReportViewModel.fldDictNumFormat.push("Value",new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("Value",0)),ReportViewModel.fldDictNumFormat.push("VALUE",new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("VALUE",0))}ReportViewModel_1(e){this.ReportViewModel_2(e,_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.General,null,null,null)}ReportViewModel_2(e,t,s,o,i,l=0){try{if(Logger.InfoLog("ReportViewModel::Entring Constructor"),this.PayrollWidgetEmpID=l,this.ReturnType=0,t!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.ExternalQuery){let s=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetReportType(e);if(112==s||165==s){this.ReturnType=s;let t=new _re_order_level_ReOrderLevelNewViewModel__WEBPACK_IMPORTED_MODULE_40__.ReOrderLevelNewViewModel("",e,null);return void _services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.addNewTab({component:_re_order_level_re_order_level_component__WEBPACK_IMPORTED_MODULE_41__.ReOrderLevelComponent,params:{obj:t}})}if(257==s)return this.ReportID=e,this.ShowReportFilter=!1,void(this.ReportViewType=t)}if(this.ReportID=e,this.ShowReportFilter=!_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.IsMobile,this.ReportViewType=t,this.InitCommands(),this.LoadReportXML(s),this.FieldsDialog=new _costcenter_picker_CostCenterPicker__WEBPACK_IMPORTED_MODULE_22__.CostCenterPicker("Field"),this.FieldsView=this.FieldsViewTbl=this.FieldsDialog.grData.Table,this.Filter=new _add_edit_filter_AddEditFilterViewModel__WEBPACK_IMPORTED_MODULE_19__.a,this.Filter.AddEditFilterViewModel_1(this),null!=this.Reportds&&this.Reportds.Tables.length>0&&this.Reportds.Tables[0].length>0&&this.Filter.LoadXml(this.Reportds.Tables[0][0]),null!=o&&(this.DBPanel=o,this.TopRecords<=0&&o.TopRecords>0&&(this.TopRecords=o.TopRecords)),0==this.StaticReportType||-1==this.StaticReportType){if(this.ShowFilter=!0,!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(i)){let e,s=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f;s.LoadXml(i);for(let t=0;t<this.Filter.Fields.length;t++){let s=this.Filter.Fields[t];if("DATE"==s.CDGDO.DataType){e=s;break}}if(e){let t=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(s.DocumentElement,"Row[ColID='FROMDATE']"),o=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(s.DocumentElement,"Row[ColID='TODATE']"),i=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(s.DocumentElement,"Row[ColID='ASONDATE']");t&&o?(e.Condition.SetSelectedItem("Between"),e.FromDatePicker.Date=new Date(t.attributes.Value.value),e.ToDatePicker.Date=new Date(o.attributes.Value.value)):i&&(e.Condition.SetSelectedItem("LessthanOrEqual"),e.FromDatePicker.Date=new Date(i.attributes.Value.value))}t!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.LandingPage&&this.Filter.OnButtonClick("OK")}if(t==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DashBoard||t==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Export||t==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.LoadDataOnly||t==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.PreProcessQuery||this.HidePrefetch){if(t==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Export||t==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.PreProcessQuery)for(let e=this.Filter.CostCenterFilters.length-1;e>=0;e--)null!=this.Filter.CostCenterFilters[e].SelectedNodes&&0!=this.Filter.CostCenterFilters[e].SelectedNodes.length||this.Filter.CostCenterFilters.RemoveAt(e);t!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DashBoard&&t!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Export&&t!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.LoadDataOnly||(this.ShowHeaderButtons=!1,this.ShowRightPanel=!1,this.ShowReportFilter=!1),this.ShowFilter=!1,this.ShowExport=!1,this.ShowReport=!0,this.SetQueryXMLTags(),t==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.PreProcessQuery?this.Filter.OnButtonClick("PrProcessQuery"):t!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.LoadDataOnly&&this.LoadData()}}else if(110==this.StaticReportType||144==this.StaticReportType);else{if(this.oReportDialog=new _static_report_filter_StaticReportFilterViewModel__WEBPACK_IMPORTED_MODULE_20__.a(this),this.ShowStaticFilter=!0,!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(i)){let e=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f;if(e.LoadXml(i),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(e.DocumentElement,"PreDataFetch/DefaultFromVal").length>0&&(this.oReportDialog.FromDate.Date=new Date(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(e.DocumentElement,"PreDataFetch/DefaultFromVal"))),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(e.DocumentElement,"PreDataFetch/DefaultToVal").length>0&&(this.oReportDialog.ToDate.Date=new Date(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(e.DocumentElement,"PreDataFetch/DefaultToVal"))),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(e.DocumentElement,"PreDataFetch/CCSelected").length>0&&(this.oReportDialog.CostCenters.SelectedValue=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(e.DocumentElement,"PreDataFetch/CCSelected")),this.oReportDialog.CostCenterFilters.Clear(),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(e.DocumentElement,"PreDataFetch/TreeFilters/TreeFilter").length>0){let t=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(e.DocumentElement,"PreDataFetch/TreeFilters/TreeFilter");for(let e=0;e<t.length;e++){let s=t[e],o=parseInt(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(s,"CCID")),i=null!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(s,"CCName")?_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(s,"CCName"):"",l=null!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(s,"LookupTypeID")?_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(s,"LookupTypeID"):"",a=new _costcenter_filter_CostCenterFilter__WEBPACK_IMPORTED_MODULE_29__.a(o,l,i,this.Filter);if(null!=a){let e,t;null==a.SelectedNodes&&(a.SelectedNodes=[]),e=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(s,"DefaultValues").length>0?_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(s,"DefaultValues").split(","):[];for(let s=0;s<e.length;s++)t=new _shared_controls_tree_TreeNode__WEBPACK_IMPORTED_MODULE_27__.a,t.Id=parseInt(e[s]),a.SelectedNodes.push(t);this.oReportDialog.CostCenterFilters.push(a),this.oReportDialog.TreeCCID==a.CostCenterID&&(this.oReportDialog.DefaultTreeSelectedNodes=a.SelectedNodes)}}}else this.oReportDialog.DefaultTreeSelectedNodes=[],this.oReportDialog.CostCenterFilters.Clear();if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(e.DocumentElement,"PreDataFetch/FieldFilters/FieldFilter").length>0){let t=[],s=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(e.DocumentElement,"PreDataFetch/FieldFilters/FieldFilter");for(let e=0;e<s.length;e++){let o=s[e],i=this.Filter.Fields.find(e=>e.CDGDO.FieldValue==parseInt(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(o,"CCColID")));if(null!=i){t.push(parseInt(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(o,"CCColID")));let e=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(o,"Condition");if(null!=e&&(i.Condition.SelectedValue=e,i.Condition.SetSelectedItem(i.Condition.SelectedValue),i.OnConditionSelectionChanged(i.Condition.SelectedValue)),"DATE"==i.CDGDO.DataType)"FUTURE"==i.Condition.SelectedValue||"PAST"==i.Condition.SelectedValue?i.FromValue.TextBox.Text=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(o,"DefaultFromVal"):(null!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(o,"DefaultFromVal")&&(i.FromDatePicker.Date=new Date(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(o,"DefaultFromVal"))),null==_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(o,"DefaultToVal")||"Between"!=i.Condition.SelectedValue&&"NotBetween"!=i.Condition.SelectedValue||(i.ToDatePicker.Date=new Date(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(o,"DefaultToVal"))));else{if(i.FromList.Visible){let e;e=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IntTryParse(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(o,"DefaultFromVal")),i.FromList.SelectedValue=e}else i.FromValue.TextBox.Text=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(o,"DefaultFromVal");if("Between"==i.Condition.SelectedValue||"NotBetween"==i.Condition.SelectedValue)if(i.ToList.Visible){let e;e=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IntTryParse(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(o,"DefaultToVal")),i.ToList.SelectedValue=e}else i.ToValue.Text=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(o,"DefaultToVal")}}else if("23148"==_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(o,"CCColID")){var a=this.oReportDialog.DefaultProperties.find(e=>"EnquiryNo"==e.DBColumnName);a instanceof _shared_models_controls_PactListBoxData__WEBPACK_IMPORTED_MODULE_14__.b&&(a.Text=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(o,"DefaultFromVal"))}}for(let e=this.Filter.Fields.length-1;e>=0;e--){let s=this.Filter.Fields[e];if(0==t.filter(e=>e==s.CDGDO.FieldValue).length){if(this.RepeatEmptyColumns>0&&this.Filter.Fields[e].FromDatePicker.Visible)continue;this.Filter.Fields.RemoveAt(e)}}}else for(let t=this.Filter.Fields.length-1;t>=0;t--)if(this.Filter.Fields[t].IsVisible){if(this.RepeatEmptyColumns>0&&this.Filter.Fields[t].FromDatePicker.Visible)continue;this.Filter.Fields.RemoveAt(t)}var n;n=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(e.DocumentElement,"PreDataFetch/DefaultProperties").length>0?"<DefaultProperties>"+_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(e.DocumentElement,"PreDataFetch/DefaultProperties")+"</DefaultProperties>":this.oReportDialog.GetPropertiesSaveXML();let s="";this.oReportDialog.Locations.Visible&&(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(e.DocumentElement,"PreDataFetch/DefaultProperties/DEFAULT_LOCATION").length>0?(s=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(e.DocumentElement,"PreDataFetch/DefaultProperties/DEFAULT_LOCATION"),s.Contains("All")&&"1"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.RoleID?this.oReportDialog.LocationWhere=null:(s.Contains("All")&&(s=s.Remove(0,4)),this.oReportDialog.LocationWhere=s)):this.oReportDialog.SetLocationWhere()),this.DisplayMessage="",t==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.VPT&&(this.oReportDialog.Locations.Visible=!1,this.oReportDialog.SetLocationWhere()),this.oReportDialog.IsFirstLoaded=!0,this.ShowStaticFilter=!1,this.ShowReport=!0,this.Reportds.Tables[0][0].DefaultPreferences=n,this.UpdateDefaultPreferences(),this.SetQueryXMLTags(),this.LoadData()}(t==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DashBoard||t==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Export||t==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.LoadDataOnly||this.HidePrefetch)&&(t==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Export&&(this.oReportDialog.Locations.Visible=!1),this.oReportDialog.SetLocationWhere(),t!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DashBoard&&t!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Export&&t!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.LoadDataOnly||(this.ShowHeaderButtons=!1,this.ShowRightPanel=!1,this.ShowReportFilter=!1),this.ShowExport=!1,this.ShowReport=!0,this.Reportds.Tables[0][0].DefaultPreferences=this.oReportDialog.GetPropertiesSaveXML(),this.UpdateDefaultPreferences(),this.SetQueryXMLTags(),t!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.LoadDataOnly&&(this.LoadData(),this.oReportDialog.IsFirstLoaded=!0))}Logger.InfoLog("ReportViewModel::Exiting Constructor")}catch(r){Logger.ErrorLog("ReportViewModel::Exiting Error",r)}}ReportViewModel_Query(e,t,s,o,i,l=!1,a=!1){if(this.IsFirstCall=a,this.DispayAsPopup=l,this.ReportViewType=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Query,this.ShowQuery=!this.IsMobile,this.ShowReport=!0,this.IgnoreTreeLoad=!1,this.RefreshVisibility=!0,this.LabelName=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Reports_LblQuery"),this.InitCommands(),this.QueryReports=[],this.QueryTimer=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.d,this.QueryTimer.Elapsed(this,"QueryTimer_Elapsed"),this.QueryDocuments=[],this.QueryMasterScreen=[],this.QueryMastersVisibility=!1,this.QueryDimension=new _shared_models_controls_PactListBoxData__WEBPACK_IMPORTED_MODULE_14__.b(0),this.QueryDimension.SelectionChangedCommand.Subscribe(this,"OnQueryDimensionSelectionChanged"),this.QueryDimension.CCID=e,this.QueryDimension.SelectedValue=t,this.QueryDimension.SelectedValue=l&&0==t&&3==e?-1:t,2==e)this.QueryDimension.TypeID=100,this.QueryDimension.Label=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("DocumentDesigner_Account");else if(3==e)this.QueryDimension.TypeID=10,this.QueryDimension.Label=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("DocumentDesigner_Product");else if(92==e){if(this.QueryMastersVisibility=!0,this.QueryDimension.TypeID=2,this.DisplayName=this.LabelName=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("REN_RentalConsole"),this.QueryDimension.Label=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Rentals_UnitsProperty"),parseInt(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.UserID)>1){let e=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSet("RPT019",this.IsReportDB,_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.UserID),t="";for(let s=0;s<e.Tables[0].length;s++)t+=e.Tables[0][s].PropertyID.toString(),s<e.Tables[0].length-1&&(t+=" , ");this.QueryDimension.CustomWhere=t.length>0?" NodeID in ( "+t+") ":" 1<>1 "}}else this.QueryDimension.TypeID=1,this.QueryDimension.Label=s;this.DocumentFilters.push(e.toString(),""),"TRUE"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["LW  Login"].toString().toUpperCase()&&0!=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID&&this.DocumentFilters.push("50002",_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID.toString());let n=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetQueryDefnScreenDetails(5,e,0);if(null!=n&&n.Tables.length>0&&(n.Tables[0].forEach(e=>{let t=new _shared_models_controls_PactButtonData__WEBPACK_IMPORTED_MODULE_10__.a;t.DBColumnID=parseInt(e.ReportID),t.Label=e.ReportName.toString(),t.Action=parseInt(e.StaticReportType),t.GroupName=Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(e.GroupLevel)?"1":"0",t.IsReadOnly=!0,this.QueryReports.push(t)}),n.Tables[2].forEach(e=>{let t=new _shared_models_controls_PactLinkData__WEBPACK_IMPORTED_MODULE_15__.a(0);t.DBColumnID=parseInt(e.CostCenterID),t.Label=e.DocumentName.toString(),this.QueryDocuments.push(t)}),this.QueryDocumentsVisibility=this.QueryDocuments.length>0,n.Tables[0].length>0)){this.PriceChartVisibility=Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(n.Tables[0][0].ShowPriceChart);let e=parseInt(n.Tables[0][0].ListViewID);if(e>0&&(this.QueryDimension.TypeID=e),this.LoadQueryHeaderFields(n.Tables[1]),null!=i&&null!=this.QueryFilterFields&&null!=i.QueryFilterFields&&this.QueryFilterFields.length==i.QueryFilterFields.length)for(let t=0;t<this.QueryFilterFields.length;t++)this.QueryFilterFields[t].SelectedValue=i.QueryFilterFields[t].SelectedValue}if(this.QueryReports.length>0){var r=this.QueryReports.find(e=>o>0&&e.DBColumnID==o);r?(r.CrFilter=1,this.OnQueryReportClick(r),r.CrFilter=0):(this.QueryReports[0].CrFilter=1,this.OnQueryReportClick(this.QueryReports[0]),this.QueryReports[0].CrFilter=0)}if(this.QueryFieldFilters=new Array,this.Filter){let e=0;this.Filter.Fields.forEach(t=>{t.QuerySearchField.IsChecked&&(t.Row=e/3,t.Column=e%3,this.QueryFieldFilters.push(t),e++,t.IsVisible=!1)})}}ReportViewModel_Document(e,t,s,o,i,l,a=null){if(this.xMapXML=l,this.DocumentObject=a,i instanceof ReportViewModel?this.ReportViewFrom=i:null!=i&&"ReOrderLevelNewViewModel"==i.ClassName?this.ReportViewFromReorder=i:null!=i&&"POSExitViewModel"==i.ClassName&&(this.POSExitViewModel=i),this.DispayAsPopup=o,this.ShowReport=!0,e>4e4&&e<5e4?(this.CostCenterID=e,this.ReportViewType=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DocumentQuery,this.ShowQuery=!this.IsMobile,this.IgnoreTreeLoad=!1,this.RefreshVisibility=!0):(this.ReportViewType=50==e?_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DocumentQuery:_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.TransactionQuery,112==e&&(this.CostCenterID=e),this.ShowQuery=!1,this.IgnoreTreeLoad=!1,this.RefreshVisibility=!0,this.OnButtonClick("ShowReportFilter")),this.LabelName=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("DocumentDesigner_DocReports"),this.InitCommands(),this.QueryDimension=new _shared_models_controls_PactListBoxData__WEBPACK_IMPORTED_MODULE_14__.b(0),this.QueryDimension.Visible=!1,this.LoadDocFilterXML(t),(98==e||this.DocumentFilters.ContainsKey("3")&&!this.DocumentFilters[3].startsWith("'")&&!this.DocumentFilters[3].endsWith("'")||null!=this.DocumentObject&&this.DocumentObject.ScreenObject.IsInventory)&&(this.ReportViewType=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DocumentQuery,this.QueryDimension.CCID=3,this.DocumentFilters.ContainsKey("3")&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNum(this.DocumentFilters[3])&&(this.QueryDimension.SelectedValue=parseInt(this.DocumentFilters[3]))),this.QueryReports=[],this.ShowQuery){let t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetQueryDefnScreenDetails(6,e,0);if(null!=t&&t.Tables.length>0){let e=[];t.Tables[0].forEach(t=>{if(!e.Contains(t.ReportName.toString())){e.push(t.ReportName.toString());let s=new _shared_models_controls_PactButtonData__WEBPACK_IMPORTED_MODULE_10__.a;s.DBColumnID=parseInt(t.ReportID),s.Label=t.ReportName.toString(),s.Action=parseInt(t.StaticReportType),s.IsReadOnly=!1,this.QueryReports.push(s)}});try{this.LoadQueryHeaderFields(t.Tables[0])}catch(r){}}}if(this.QueryReports.length>0||!this.ShowQuery){var n=this.QueryReports.find(e=>s>0&&e.DBColumnID==s);if(n)n.CrFilter=1,this.OnQueryReportClick(n),n.CrFilter=0;else{if(null!=this.POSExitViewModel&&(this.ReportViewType=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Export),0==this.QueryReports.length){let e=new _shared_models_controls_PactButtonData__WEBPACK_IMPORTED_MODULE_10__.a;e.DBColumnID=s,this.QueryReports.push(e)}this.QueryReports[0].CrFilter=1,this.OnQueryReportClick(this.QueryReports[0]),this.QueryReports[0].CrFilter=0}}if(this.QueryFieldFilters=new Array,null!=this.Filter){let e=0;this.Filter.Fields.forEach(t=>{t.QuerySearchField.IsChecked&&(t.IsVisible=!1,t.Row=e/3,t.Column=e%3,this.QueryFieldFilters.push(t),this.QueryFieldsVisibility=!0,e++)})}}ReportViewModel_SubReport(e,t,s){try{this.ParentReport=e,this.ReturnType=0,this.ReportID=parseInt(s.Tables[0][0].ReportID),this.ShowReportFilter=!_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.IsMobile,this.ReportViewType=t,this.InitCommands(),this.process=e.process,this.LoadReportXML(s),this.FieldsDialog=new _costcenter_picker_CostCenterPicker__WEBPACK_IMPORTED_MODULE_22__.CostCenterPicker("Field"),this.FieldsView=this.FieldsViewTbl=this.FieldsDialog.grData.Table,this.Filter=new _add_edit_filter_AddEditFilterViewModel__WEBPACK_IMPORTED_MODULE_19__.a,this.Filter.AddEditFilterViewModel_1(this),null!=this.Reportds&&this.Reportds.Tables.length>0&&this.Reportds.Tables[0].length>0&&this.Filter.LoadXml(this.Reportds.Tables[0][0]),this.lstGroup.length>0&&"Detailed"==this.lstGroup[0].DisplayMode&&!this.lstGroup[0].ShowAsColumn&&e.lstGroup.length>0&&"Detailed"==e.lstGroup[0].DisplayMode&&!e.lstGroup[0].ShowAsColumn?this.MergeChildReport=!0:(this.MergeChildReport=!1,this.Data=this.ParentReport.Data,this.angularGrid=this.ParentReport.angularGrid),0==this.StaticReportType||-1==this.StaticReportType||110==this.StaticReportType||144==this.StaticReportType||(this.oReportDialog=new _static_report_filter_StaticReportFilterViewModel__WEBPACK_IMPORTED_MODULE_20__.a(this),this.oReportDialog.Locations.Visible&&this.oReportDialog.Locations.Items.map(e=>e.IsChecked=!0),this.ShowStaticFilter=!0),Logger.InfoLog("ReportViewModel::Exiting Constructor")}catch(o){Logger.ErrorLog("ReportViewModel::Exiting Error",o.stack)}}ReportViewModel_MRP(e){this.ReportID=257,this.MRPFilter=e,this.InitCommands(),this.LoadReportXML(null),this.ShowReport=!0}InitCommands(){this.ShowHeaderButtons=!0,this.ShowRightPanel=!0,this.ShowExport=!1,this.SavePDF.IsChecked=!0,this.SavePDF.Label="PDF",this.SaveXLS.Label="Spreadsheet (xlsx)",this.SaveXLSX.Label="Spreadsheet (Open xlsx)",this.SaveWord.Label="Document (doc)",this.SaveHTML.Label="Web page (html)",this.SavePDF.Group=this.ExportList,this.SaveXLS.Group=this.ExportList,this.SaveXLSX.Group=this.ExportList,this.SaveWord.Group=this.ExportList,this.SaveHTML.Group=this.ExportList,this.ExportList.Items.push(this.SavePDF),this.ExportList.Items.push(this.SaveXLS),this.ExportList.Items.push(this.SaveXLSX),this.ExportList.Items.push(this.SaveWord),this.ExportList.Items.push(this.SaveHTML),this.process.DoWork(this,"process_DoWork"),this.MatrixObject=new _MatrixReport__WEBPACK_IMPORTED_MODULE_30__.a(this,ReportViewModel),this.ReportID>0&&_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.IsActionAssigned(200,"Update")&&(this.MatrixObject.AllowToSave=!0),this.ButtonPrint=new _shared_models_controls_PactButtonData__WEBPACK_IMPORTED_MODULE_10__.a,this.ButtonExport=new _shared_models_controls_PactButtonData__WEBPACK_IMPORTED_MODULE_10__.a,this.ButtonEmail=new _shared_models_controls_PactButtonData__WEBPACK_IMPORTED_MODULE_10__.a,this.ButtonSMS=new _shared_models_controls_PactButtonData__WEBPACK_IMPORTED_MODULE_10__.a,this.ButtonPost=new _shared_models_controls_PactButtonData__WEBPACK_IMPORTED_MODULE_10__.a,this.ButtonAction=new _shared_models_controls_PactButtonData__WEBPACK_IMPORTED_MODULE_10__.a,this.ButtonSave=new _shared_models_controls_PactButtonData__WEBPACK_IMPORTED_MODULE_10__.a,this.ButtonLoad=new _shared_models_controls_PactButtonData__WEBPACK_IMPORTED_MODULE_10__.a,this.SetButtonsVisibility(!0),this.ProcessdOn=new _shared_models_controls_PactControlData__WEBPACK_IMPORTED_MODULE_13__.c(0),this.ProcessdOn.Visible=!1,this.ReportDims=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("ReportDims")?_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ReportDims:""}LoadTransactionQueryData(){this.ShowFilter=!1,this.ShowQuery=!1,this.ShowReportFilter=!1,this.ShowReport=!0,this.RefreshVisibility=!1,this.ShowTransactionQuery=!0,this.ShowLinkingQuery=!1,this.TransactionQueryFields=[],110==this.StaticReportType?(this.ReportViewType=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.TransactionQuery,this.QueryLabel=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Rpt_TransactQry")):144==this.StaticReportType&&(this.ReportViewType=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.LinkingQuery,this.QueryLabel=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Rpt_LinkQry")),this.TQDocumentType=new _shared_models_controls_PactListBoxData__WEBPACK_IMPORTED_MODULE_14__.b(0),this.TQDocumentType.SelectionChangedCommand.Subscribe(this,"OnTQDocumentChange"),this.TQDocumentType.Label="Document",this.TQDocumentType.CCID=300,this.TQDocumentType.Mandatory=!1,110==this.StaticReportType?this.TQDocumentType.TypeID=1:144==this.StaticReportType&&(this.TQDocumentType.TypeID=2),this.TQDocPrefix=new _shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__.e(0),this.TQDocPrefix.Label="Doc Prefix",this.TQDocPrefix.SelectionChangedCommand.Subscribe(this,"OnTQDocPrefixChange"),this.TQDocNo_From=new _shared_models_controls_PactTextBoxData__WEBPACK_IMPORTED_MODULE_25__.d(0),this.TQDocNo_From.Label="Doc No",this.TQDocNo_To=new _shared_models_controls_PactTextBoxData__WEBPACK_IMPORTED_MODULE_25__.d(0),this.TQDocNo_To.Label="To",this.Filter.Fields.forEach(e=>{let t=new _Models_PostDataField__WEBPACK_IMPORTED_MODULE_17__.a;t.PostDataField_2(e),this.TransactionQueryFields.push(t)})}SetButtonsVisibility(e){if(null==this.ParentReport){let t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.IsActionAssigned(200,"Report Print");t&&!e&&"1"!=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.RoleID&&"1"!=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.UserID&&0==this.Reportds.Tables[1].filter(e=>2==e.ActionType||0==e.ActionType).length&&(t=!1),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.HideUnathorizedAccess?this.ButtonPrint.Visible=t:this.ButtonPrint.Enable=t,t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.IsActionAssigned(200,"Report Export"),t&&!e&&"1"!=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.RoleID&&"1"!=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.UserID&&0==this.Reportds.Tables[1].filter(e=>3==e.ActionType||0==e.ActionType).length&&(t=!1),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.HideUnathorizedAccess?this.ButtonExport.Visible=t:this.ButtonExport.Enable=t,t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.IsActionAssigned(200,"Report Email"),t&&!e&&"1"!=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.RoleID&&"1"!=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.UserID&&0==this.Reportds.Tables[1].filter(e=>4==e.ActionType||0==e.ActionType).length&&(t=!1),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.HideUnathorizedAccess?this.ButtonEmail.Visible=t:this.ButtonEmail.Enable=t,t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.IsActionAssigned(200,"Report SMS"),t&&!e&&"1"!=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.RoleID&&"1"!=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.UserID&&0==this.Reportds.Tables[1].filter(e=>5==e.ActionType||0==e.ActionType).length&&(t=!1),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.HideUnathorizedAccess?this.ButtonSMS.Visible=t:this.ButtonSMS.Enable=t,this.PreProcessReport.Visible=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.IsActionAssigned(200,"Pre-Process Report"),this.ButtonAction.Visible=!1,this.ButtonPost.Width="36",this.ButtonPost.GroupName="Post",this.ButtonPost.Label=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Post"),111==this.StaticReportType||257==this.StaticReportType||297==this.ReportID||null!=this.Reportds&&this.Reportds.Tables.length>0&&this.Reportds.Columns[0].Contains("DocMapXML")&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(this.Reportds.Tables[0][0].DocMapXML).length>0?(this.Reportds.Columns[0].Contains("DocMapXML")&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(this.Reportds.Tables[0][0].DocMapXML).length>0&&(this.IsDocMapXMLExists=!0),this.ButtonPost.Visible=!0):this.ButtonPost.Visible=!1,this.ButtonSave.Visible=!1,this.ButtonLoad.Visible=!1,this.ButtonSave.Label=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Save"),257==this.StaticReportType?(this.ButtonSave.Visible=!0,this.ButtonLoad.Visible=!0):154==this.StaticReportType&&(this.ButtonSave.Label="Reject")}}LoadDocFilterXML(e){if(this.IsProductGroupLevel=!1,this.DocumentFilters.Clear(),this.DocumentFiltersText.Clear(),!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e)){let t=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f;t.LoadXml(e),t.DocumentElement.childNodes.forEach(e=>{let t=e;this.DocumentFilters.ContainsKey(t.attributes.ColID.value)||null==t.attributes.Value||(this.DocumentFilters.push(t.attributes.ColID.value,t.attributes.Value.value),null!=t.attributes.ValueText&&this.DocumentFiltersText.push(t.attributes.ColID.value,_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.EncodeXML(t.attributes.ValueText.value)),null!=t.attributes.LinkedInvDocDetailsIDs&&this.DocumentFiltersIDs.push(t.attributes.ColID.value,_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.EncodeXML(t.attributes.LinkedInvDocDetailsIDs.value)))}),null!=t.DocumentElement.attributes.GroupLevel&&"1"==t.DocumentElement.attributes.GroupLevel.value&&(this.IsProductGroupLevel=!0)}}LoadReportXML(e){if(this.RepeatType=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.None,this.Reportds=null==e?_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetReport(0,this.ReportID):e,null!=this.Reportds&&this.Reportds.Tables.length>0&&!this.Reportds.Columns[0].Contains("ErrorMessage")&&this.Reportds.Tables[0].length>0){this.StaticReportType=parseInt(this.Reportds.Tables[0][0].StaticReportType),this.ReportQuery=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(this.Reportds.Tables[0][0].Query),this.ReportDoc=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f;try{this.ReportDoc.LoadXml(this.Reportds.Tables[0][0].ReportDefnXML.toString())}catch(t){return this.DisplayMessage="Invalid report",void(this.MessageVisibility=!0)}this.ScreenName="",2==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LanguageID&&(this.ScreenName=this.ReportDoc.SelectSingleNodeText("PactRevenURpts/PactRevenURptDef/ArabicName")),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.ScreenName)&&(this.ScreenName=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource(this.Reportds.Tables[0][0].ReportName)),null!=this.ReportDoc.SelectSingleNode("PactRevenURpts/PactRevenURptDef/ReportType")&&(this.IsSummaryReportType=!0),this.DisplayName=this.ScreenName,this.ShowGridLines=this.ReportDoc.SelectSingleNodeText("PactRevenURpts/PactRevenURptDef/GridLines"),this.VerticalAlignment=this.ReportDoc.SelectSingleNodeText("PactRevenURpts/PactRevenURptDef/VAlign");let e=this.ReportDoc.SelectSingleNodeText("PactRevenURpts/PactRevenURptDef/PrintonLang");null!=e&&"1"==e&&(this.PrintonLang=1);let s=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(this.ReportDoc.SelectSingleNodeText("PactRevenURpts/PactRevenURptDef/TreeTotalBorder"));if(0!=s&&(this.TreeTotalBorder=""!=this.ReportDoc.SelectSingleNodeText("PactRevenURpts/PactRevenURptDef/TreeTotalBorderRow")?-s:s),this.TreeGroupPrint="0"!=this.ReportDoc.SelectSingleNodeText("PactRevenURpts/PactRevenURptDef/TreeGroupPrint"),this.RepeatType=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.None,this.RepeatStartIndex=-1,this.ReportColumns=this.BuildColumns(this.ReportDoc.SelectSingleNode("PactRevenURpts/PactRevenURptDef/Columns")),this.BuildGroups(this.ReportDoc.SelectSingleNode("PactRevenURpts/PactRevenURptDef/Groups")),null!=this.ReportColumns&&(this.totals=new Array(this.ReportColumns.length).fill(0).map(()=>new Array(this.lstGroup.length+1).fill(0)),this.hiddenTotals=new Array(this.HiddenNumericColumns.length).fill(0).map(()=>new Array(this.lstGroup.length+1).fill(0)),this.lstSummaryAplha.Clear(),this.lstSummaryDistinctNumeric.Clear(),this.lstSummaryCells.Clear(),this.ReportColumns.forEach(e=>{this.lstSummaryAplha.push(e.ID,new Array),-1==e.UseOnce&&"FLOAT"==e.ColumnType&&this.lstSummaryDistinctNumeric.push(e.ID,new Array),this.lstSummaryCells.push(e.ID,new Array)})),null!=this.MatrixObject&&this.MatrixObject.LoadFields(this.Reportds.Tables[0][0]),this.kpiList.Clear(),this.kpiListSrc.Clear(),!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.Reportds.Tables[0][0].KPIXML)){let e=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f;e.LoadXml(this.Reportds.Tables[0][0].KPIXML.toString()),e.DocumentElement.childNodes.forEach(e=>{let t=new _StaticReports_StaticReportsViewModel__WEBPACK_IMPORTED_MODULE_33__.a;t.KPI_1(e,this),this.kpiList.push(t),this.kpiListSrc.push(this.kpiList[this.kpiList.length-1])})}let o=this.ReportDoc.SelectSingleNode("PactRevenURpts/PactRevenURptDef/ReportTotal"),i=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(o,"Identity"),l=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(o,"Appearance");this.GrpReportTotal.ID=this.GetNodeValue(i,"ID"),this.GrpReportTotal.SubTotalPrefix=this.GetNodeValue(i,"Prefix").split("~"),this.GrpReportTotal.SubTotalShowUnder=this.GetNodeValue(l,"ShowUnder"),this.GrpReportTotal.SubTotalAppearance=this.GrpReportTotal.GroupAppearance=this.GetAppearance(l),this.GrpReportTotal.SubTotalAppearance_Data=this.GrpReportTotal.SubTotalAppearance.Clone(),this.GrpReportTotal.SubTotalAppearance_Data.Alignment="Right",this.AddTotalColumnsToGroup(this.GrpReportTotal,_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(o,"Columns"));let a=this.GetNodeValue(i,"ShowCaption");a.length>0&&!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNum(a)&&(this.GrpReportTotal.SubTotalShowCaption=parseInt(a),this.GrpReportTotal.SubTotalCaptionID=a,this.GrpReportTotal.SubTotalShowCaption=10),""!=this.GetNodeValue(l,"Width")&&(this.GrpReportTotal.SubTotalWidth=this.GrpReportTotal.Width=parseFloat(this.GetNodeValue(l," Width"))),""!=this.GetNodeValue(l,"Height").Trim()&&(this.GrpReportTotal.SubTotalHeight=this.GrpReportTotal.Height=parseInt(this.GetNodeValue(l,"Height"))),s=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(this.GetNodeValue(l,"Border")),0!=s&&(this.GrpReportTotal.SubTotalBorder=""!=this.GetNodeValue(l,"BorderRow")?-s:s);let n=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(o,"Appearance");null!=n&&(this.GrpReportTotal.SubTotalFormat=this.GetFormat(n)),this.GrpReportTotal.SubTotalAppearance.IsBold=!1,this.GrpReportTotal.SubTotalAppearance.BackColor="#f1f2f5",this.GrpReportTotal.SubTotalAppearance.ForeColor="#ff9700",this.GrpReportTotal.SubTotalAppearance.Alignment="Right",this.GrpReportTotal.SubTotalAppearance.FontSize=12,this.GrpReportTotal.SubTotalAppearance_Data.IsBold=!1,this.GrpReportTotal.SubTotalAppearance_Data.BackColor="#f1f2f5",this.GrpReportTotal.SubTotalAppearance_Data.ForeColor="#ff9700",this.GrpReportTotal.SubTotalAppearance_Data.Alignment="Right",this.GrpReportTotal.SubTotalAppearance_Data.FontSize=12,this.ChildReports.Clear();for(let t=1;t<this.Reportds.Tables[0].length;t++){let e={Tables:[],Columns:[]};e.Tables.push([]),e.Columns.push(this.Reportds.Columns[0].Copy());let s={};for(let i=0;i<this.Reportds.Columns[0].length;i++)s[this.Reportds.Columns[0][i]]=this.Reportds.Tables[0][t][this.Reportds.Columns[0][i]];if(e.Tables[0].push(s),1==t&&this.Reportds.Tables[0][t].MapXML.toString().length>0){let e=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f;e.LoadXml(this.Reportds.Tables[0][t].MapXML.toString()),null!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(e.DocumentElement,"Pref/ShowTitle")&&(this.ShowReportTitleInSubReports=!0),null!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(e.DocumentElement,"Pref/PrintSeperate")&&(this.PrintSeperateInSubReports=!0),null!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(e.DocumentElement,"Pref/ShowGrandTotal")&&(this.ShowGrandTotalInSubReports=!0,this.GrandTotalTextInSubReports=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(e.DocumentElement,"Pref/ShowGrandTotal"),null!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(e.DocumentElement,"Pref/GrandTotalFormula")&&(this.GrandTotalFormulaInSubReports=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(e.DocumentElement,"Pref/GrandTotalFormula")))}let o=new ReportViewModel;o.ReportViewModel_SubReport(this,_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Export,e),this.ChildReports.push(o)}this.PrintSeperateInSubReports&&1!=this.ChildReports.length&&(this.PrintSeperateInSubReports=!1),this.SetButtonsVisibility(!1),this.ShowMatrixButtonVisible=!!(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.IsActionAssigned(200,"Matrix Report")&&this.StaticReportType<=0)}this.LoadPreferences(),this.Preferences.ContainsKey("PreProcessQuery")&&(this.IsPreProcessQuery=!0),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("ReportsFrom")&&(this.IsReportDB="1"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ReportsFrom,this.Preferences.ContainsKey("ReportsFrom")&&("TrDB"==this.Preferences.ReportsFrom?this.IsReportDB=!1:"RptDB"==this.Preferences.ReportsFrom&&(this.IsReportDB=!0)))}BuildGroups(e){try{Logger.InfoLog("ReportViewModel::Entring BuildGroups"),this.lstGroup.Clear(),this.Groupstr.Clear(),this.ReportGroups.Clear();let t=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(e,"GroupDef");for(let e=0;e<t.length;e++){let s=t[e],o=new Group;o.ID=this.GetNodeValue(s,"Identity/ID"),""!=this.GetNodeValue(s,"Appearance/Width")&&(o.Width=parseFloat(this.GetNodeValue(s,"Appearance/Width"))),o.Prefix=this.GetNodeValue(s,"Identity/Prefix"),o.Type=this.GetNodeValue(s,"Identity/Type").toUpperCase(),o.ShowUnder=this.GetNodeValue(s,"Appearance/ShowUnder"),o.Level=parseInt(this.GetNodeValue(s,"Identity/Level")),o.GroupAppearance=this.GetAppearance(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(s,"Appearance")),o.DisplayMode=null!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(s,"Identity/DisplayMode")?_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(s,"Identity/DisplayMode").Trim():"Detailed","1"==this.GetNodeValue(s,"Identity/ShowAsColumn").Trim()&&(o.ShowAsColumn=!0),""!=this.GetNodeValue(s,"Appearance/Height").Trim()&&(o.Height=parseInt(this.GetNodeValue(s,"Appearance/Height"))),null!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(s,"Format")&&(o.GroupFormat=this.GetFormat(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(s,"Format"))),o.Formula=this.GetNodeValue(s,"Identity/Expression"),o.SubTotalPrefix=this.GetNodeValue(s,"SubTotal/Identity/Prefix").split("~");let i=0;""!=this.GetNodeValue(s,"SubTotal/Appearance/Border")&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNum(this.GetNodeValue(s,"SubTotal/Appearance/Border"))&&(i=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(this.GetNodeValue(s,"SubTotal/Appearance/Border")),o.SubTotalBorder=""!=this.GetNodeValue(s,"SubTotal/Appearance/BorderRow")?-i:i),o.SubTotalShowUnder=this.GetNodeValue(s,"SubTotal/Appearance/ShowUnder"),o.SubTotalLevel=parseInt(this.GetNodeValue(s,"SubTotal/Identity/Level")),this.StaticReportType>0?(o.SubTotalAppearance=this.GetAppearance(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(s,"SubTotal/Appearance")),o.SubTotalAppearance_Data=o.SubTotalAppearance.Clone()):(o.SubTotalAppearance=o.GroupAppearance.Clone(),o.SubTotalAppearance_Data=this.GetAppearance(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(s,"SubTotal/Appearance")),o.SubTotalAppearance.Alignment=o.SubTotalAppearance_Data.Alignment,o.SubTotalAppearance.IsVisible=o.SubTotalAppearance_Data.IsVisible,o.SubTotalAppearance.IsPrintVisible=o.SubTotalAppearance_Data.IsPrintVisible),o.SubTotalAppearance_Data.Alignment="Right",o.SubTotalShowAtCollapse="1"==this.GetNodeValue(s,"SubTotal/Appearance/ShowAtCollapse"),this.AddTotalColumnsToGroup(o,_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(s,"SubTotal/Columns"));let l=this.GetNodeValue(s,"SubTotal/Identity/ShowCaption");if(o.SubTotalShowCaption=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(l),l.length>0&&!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNum(l)&&(o.SubTotalCaptionID=l,o.SubTotalShowCaption=10),""!=this.GetNodeValue(s,"SubTotal/Appearance/Width")&&(o.SubTotalWidth=parseFloat(this.GetNodeValue(s,"Appearance/Width"))),""!=this.GetNodeValue(s,"SubTotal/Appearance/Height").Trim()&&(o.SubTotalHeight=parseInt(this.GetNodeValue(s,"SubTotal/Appearance/Height"))),null!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(s,"SubTotal/Format")&&(o.SubTotalFormat=this.GetFormat(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(s,"SubTotal/Format"))),this.StaticReportType>=9&&this.StaticReportType<=12||31==this.StaticReportType||80==this.StaticReportType){let e=new _Models_ReportColumnProperties__WEBPACK_IMPORTED_MODULE_21__.b(null,!0);e.ID=o.ID,e.CDGDO.CategoryValue=parseInt(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(s,"Identity/Category")),e.CDGDO.FieldValue=parseInt(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(s,"Identity/Field")),null==this.FieldsView&&(this.FieldsDialog=new _costcenter_picker_CostCenterPicker__WEBPACK_IMPORTED_MODULE_22__.CostCenterPicker("Field"),this.FieldsView=this.FieldsViewTbl=this.FieldsDialog.grData.Table);let t="";null!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(s,"Identity/SelectedField")&&(l=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(s,"Identity/SelectedField")),this.FieldsDialog.SetCDGDO_ColID(e.CDGDO,t),0==e.CDGDO.FieldValue&&(e.CDGDO.DataType=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(s,"Identity/Type")),e.SetDataType(),this.ReportGroups.push(e)}this.lstGroup.push(o),this.Groupstr.push(this.GetNodeValue(s,"Identity/ID"),null)}this.IsSummaryGroupsExists=!1,this.lstGroup.find(e=>"Summary"==e.DisplayMode)&&(this.IsSummaryGroupsExists=!0);for(let e=0;e<this.lstGroup.length;e++)this.lstGroup[e].GroupAppearance.IsBold=!1,this.lstGroup[e].GroupAppearance.BackColor="#3498FB",this.lstGroup[e].GroupAppearance.ForeColor="white",this.lstGroup[e].GroupAppearance.FontSize=12,this.lstGroup[e].SubTotalAppearance.IsBold=!1,this.lstGroup[e].SubTotalAppearance.BackColor="#f1f2f5",this.lstGroup[e].SubTotalAppearance.ForeColor="#ff9700",this.lstGroup[e].SubTotalAppearance.Alignment="Right",this.lstGroup[e].SubTotalAppearance.FontSize=12,this.lstGroup[e].SubTotalAppearance_Data.IsBold=!1,this.lstGroup[e].SubTotalAppearance_Data.BackColor="#f1f2f5",this.lstGroup[e].SubTotalAppearance_Data.ForeColor="#ff9700",this.lstGroup[e].SubTotalAppearance_Data.FontSize=12;Logger.InfoLog("ReportViewModel::Exiting BuildGroups")}catch(t){Logger.ErrorLog("ReportViewModel::Error BuildGroups",t.stack)}}BuildColumns(e){this.ColumnSource=[],this.ColumnSourceALL=[],this.DisplayedCols=[],this.HiddenNumericColumns=[],this.SearchColumns.Items.Clear(),this.SearchColumns.Items.push(_shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__.d.ComboBoxItems_3(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Tree_Fulltext"),"FullText","String")),this.SearchColumns.SelectedValue="FullText",this.SearchColumns.SelectedIndex=0,this.PostDataFetchFilterFields=[];let t=null;_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(this.Reportds.Tables[0][0].RowColumnReportsMap).length>0&&(t=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f,t.LoadXml(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(this.Reportds.Tables[0][0].RowColumnReportsMap)));try{Logger.InfoLog("ReportViewModel::Entring BuildColumns"),""!=this.GetNodeValue(e,"HeaderHeight")&&(this.HeaderHeight=parseFloat(this.GetNodeValue(e,"HeaderHeight"))),""!=this.GetNodeValue(e,"RowHeight")&&(this.RowHeight=parseFloat(this.GetNodeValue(e,"RowHeight"))),this.SubRowHeight=""!=this.GetNodeValue(e,"SubRowHeight")?parseFloat(this.GetNodeValue(e,"SubRowHeight")):this.RowHeight;let o=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(e,"ColumnDef");for(let e=0;e<o.length;e++){let i=o[e],l=new _Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.b;""!=this.ShowGridLines&&(l.gridLines=parseInt(this.ShowGridLines)),l.VAlign="Top"==this.VerticalAlignment?"Top":"Center"==this.VerticalAlignment?"Center":"Bottom",l.ID=this.GetNodeValue(i,"Identity/ID"),l.FieldName=this.GetNodeValue(i,"Identity/Field"),l.HeaderText="2"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LangID?""!=this.GetNodeValue(i,"Identity/ArabicCaption")?this.GetNodeValue(i,"Identity/ArabicCaption"):_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource(this.GetNodeValue(i,"Identity/Caption")):this.GetNodeValue(i,"Identity/Caption"),l.HeaderAppearance=this.GetAppearance(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(i,"HeaderAppearance")),l.DataAppearance=this.GetAppearance(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(i,"DataAppearance")),l.HeaderHeight=this.HeaderHeight,l.Row=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(this.GetNodeValue(i,"HeaderAppearance/Row")),l.Column=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(this.GetNodeValue(i,"HeaderAppearance/Column")),""!=this.GetNodeValue(i,"Width")&&(l.width=parseFloat(this.GetNodeValue(i,"Width"))),null!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(i,"Format")&&(l.DataFormat=this.GetFormat(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(i,"Format"))),l.ColumnType=this.GetNodeValue(i,"Identity/Type").toUpperCase(),null!=l.DataAppearance&&(l.DataAppearance.ColumnType=l.ColumnType),l.Formula=this.GetNodeValue(i,"Identity/Expression"),"LATEST"!=l.Formula&&"OLDEST"!=l.Formula||(l.Formula="");let a=this.GetNodeValue(i,"Identity/FormulaEvaluateAtEnd");l.EvaluateAtEnd="0"==a?0:"2"==a?2:"3"==a?3:1,l.ColumnFilterExpression=this.GetNodeValue(i,"Format/ColumnFilterExpression");let n=this.GetNodeValue(i,"Identity/FiltersXML");_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(n)||(l.ColumnFilters=_Models_ReportColumnProperties__WEBPACK_IMPORTED_MODULE_21__.d.GetColumnFilter(n,this.IncludeLFTColumn)),l.PrintChars=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(this.GetNodeValue(i,"Format/PrintChars")),l.RepeatOn=this.GetNodeValue(i,"Identity/RepeatOn"),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(l.RepeatOn)||(l.RepeatType=parseInt(this.GetNodeValue(i,"Identity/RepeatType")),l.RepeatNext=parseInt(this.GetNodeValue(i,"Identity/RepeatNext")),l.RepeatEmptyColumns=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(this.GetNodeValue(i,"Identity/RepeatEmptyColumns")),l.RepeatType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Monthly&&l.RepeatType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Yearly||l.HeaderAppearance.IsVisible&&this.GetNodeValue(i,"Identity/RepeatPrevData").length>0&&(this.RepeatShowPrevMn=!0,this.RepeatPrevData=parseInt(this.GetNodeValue(i,"Identity/RepeatPrevData")),this.RepeatPrevNextCols=this.RepeatPrevData+1,"1"==this.GetNodeValue(i,"Identity/RepeatPrevDataFull")&&(this.RepeatPrevDataFull=!0),"1"==this.GetNodeValue(i,"Identity/RepeatPrevDiff")&&(this.RepeatPrevNextCols++,this.RepeatPrevDiff=!0),"1"==this.GetNodeValue(i,"Identity/RepeatPrevPercent")&&(""==this.GetNodeValue(i,"Identity/RepeatPrevDiff")&&this.RepeatPrevNextCols++,this.RepeatPrevNextCols++,this.RepeatPrevPercent=!0),"1"==this.GetNodeValue(i,"Identity/RepeatPrevDataSeperately")&&(this.RepeatPrevDataSeperately=!0),l.RepeatType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Yearly&&"1"==this.GetNodeValue(i,"Identity/RepeatPrevDataOfCurrYr")&&(this.RepeatPrevDataOfCurrYr=!0)));let r=this.GetNodeValue(i,"Identity/UseOnce");l.UseOnce="1"==r?1:"2"==r?2:"-1"==r?-1:0;let h=this.GetNodeValue(i,"Identity/ShowLevel");if("1"!=h&&"2"!=h||(l.ShowLevel=!0,"2"==h&&(this.GroupTotalsAtEnd=!0)),null!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(i,"Linking/Type"))try{l.LinkType=parseInt(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(i,"Linking/Type")),l.LinkType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.Document||l.MenuItems.ContainsKey("Map")||l.MenuItems.push("Map","Map"),null!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(i,"Linking/Dimension")?l.LinkDimension=parseInt(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(i,"Linking/Dimension")):l.LinkType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.Report&&null!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(i,"Linking/Report")&&(l.LinkDimension=parseInt(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(i,"Linking/Report"))),null!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(i,"Linking/DimensionView")&&(l.LinkDimensionView=parseInt(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(i,"Linking/DimensionView")))}catch(s){}if(l.HeaderAppearance.BackColor="#E4F1FF",l.HeaderAppearance.ForeColor="#033D6F",l.HeaderAppearance.FontSize=12,l.HeaderAppearance.IsBold=!0,l.DataAppearance.BackColor="#ffffff",l.DataAppearance.FontSize=12,l.DataAppearance.IsBold=!1,l.LinkType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.Document&&l.LinkType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.Dimension&&l.LinkType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.Attachment||(l.DataAppearance.ForeColor="#017EFA"),l.HeaderAppearance.IsVisible){l.RepeatType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.None&&-1==this.RepeatStartIndex&&(this.RepeatStartIndex=this.ColumnSource.length,this.RepeatNextCols=l.RepeatNext,this.RepeatType=l.RepeatType,this.RepeatOn=l.RepeatOn,this.RepeatEmptyColumns=l.RepeatEmptyColumns),this.ColumnSource.push(l),this.SearchColumns.Items.push(_shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__.d.ComboBoxItems_3(l.HeaderText,l.ID,l.ColumnType)),this.DisplayedCols.push(_shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__.c.CheckedListBoxItem_5(l.HeaderText,l.ID,!0));let e=new _Models_PostDataField__WEBPACK_IMPORTED_MODULE_17__.a;if(e.PostDataField_1(l,this),this.PostDataFetchFilterFields.push(e),l.Row>0&&l.Column>=0&&(l.HeaderAppearance.IsVisible=!1),null!=t){let e=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(t.DocumentElement,"Column").filter(e=>e.attributes.ID.value==l.ID);e.length>0&&(l.MappedColumnReports=e),e=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(t.DocumentElement,"RowReport"),e.length>0&&(l.MappedRowReports=e)}}this.ColumnSourceALL.push(l),l.HeaderAppearance.IsVisible||"FLOAT"!=l.ColumnType||this.HiddenNumericColumns.push(l)}-1!=this.RepeatStartIndex&&this.RepeatNextCols>this.ColumnSource.length-(this.RepeatStartIndex+1)&&(this.RepeatNextCols=this.ColumnSource.length-(this.RepeatStartIndex+1)),Logger.InfoLog("ReportViewModel::Exiting BuildColumns")}catch(o){Logger.ErrorLog("ReportViewModel::Error BuildColumns",o.stack)}if(null!=this.ParentReport&&!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.Reportds.Tables[0][0].MapXML)){this.xDocMap=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f,this.xDocMap.LoadXml(this.Reportds.Tables[0][0].MapXML.toString());let e=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(this.xDocMap.DocumentElement,"Columns/Field");if(e.length>0){let t=new Array(this.ParentReport.ColumnSource.length);e.forEach(e=>{var s=this.ParentReport.ColumnSource.find(t=>t.ID==e.attributes.PID.value),o=this.ColumnSource.find(t=>t.ID==e.attributes.CID.value);s&&o&&(t[this.ParentReport.ColumnSource.indexOf(s)]=this.ColumnSource[this.ColumnSource.indexOf(o)])});let s=[];for(let e=0;e<t.length;e++)null!=t[e]?s.push(t[e]):(s.push(e<this.ColumnSource.length?this.ColumnSource[e].Clone():this.ParentReport.ColumnSource[e].Clone()),s[e].ID="MT"+s[e].ID+"MT",s[e].DataFormat.DateType="TEXT",s[e].HeaderText="");this.ColumnSource=s}else if(this.ParentReport.ColumnSource.length>this.ColumnSource.length)for(let t=this.ColumnSource.length;t<this.ParentReport.ColumnSource.length;t++)this.ColumnSource.push(this.ParentReport.ColumnSource[t].Clone()),this.ColumnSource[t].ID="MT"+this.ColumnSource[t].ID+"MT",this.ColumnSource[t].DataFormat.DateType="TEXT",this.ColumnSource[t].HeaderText=""}return this.ColumnSource}RefreshChildReportColumns(){if(this.ParentReport.RepeatType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.None||190==this.ParentReport.StaticReportType)for(let e=this.ColumnSource.length-1;e>=0;e--)this.ColumnSource[e].ID.startsWith("MT")&&this.ColumnSource[e].ID.endsWith("MT")&&this.ColumnSource.RemoveAt(e);if(this.ParentReport.ReportColumns.length>this.ReportColumns.length){if(this.StaticReportType==this.ParentReport.StaticReportType&&this.StaticReportType>0)return;for(let e=this.ColumnSource.length;e<this.ParentReport.ReportColumns.length;e++)this.ColumnSource.push(this.ParentReport.ReportColumns[e].Clone()),this.ColumnSource[e].ID="MT"+this.ColumnSource[e].ID+"MT",this.ColumnSource[e].DataFormat.DateType="TEXT",this.ColumnSource[e].HeaderText="";this.ReportColumns!=this.ColumnSource&&(this.ReportColumns=this.ColumnSource)}else this.ParentReport.ReportColumns.length<this.ColumnSource.length&&this.ReportColumns!=this.ColumnSource&&(this.ReportColumns=this.ColumnSource)}RefreshPostFilters(e=!0){if(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.IsWebApplication)return;let t,s;if(e){for(t=0;t<this.PostDataFetchFilterFields.length&&t<this.ReportColumns.length&&this.PostDataFetchFilterFields[t].ColumnName==this.ReportColumns[t].ID&&this.PostDataFetchFilterFields[t].Header==this.ReportColumns[t].HeaderText;t++);for(s=this.PostDataFetchFilterFields.length-1;s>=t;s--)this.PostDataFetchFilterFields.RemoveAt(s);for(s=t;s<this.ReportColumns.length;s++){let e=new _Models_PostDataField__WEBPACK_IMPORTED_MODULE_17__.a;e.PostDataField_1(this.ReportColumns[s],this),this.PostDataFetchFilterFields.push(e)}}else{let e=this.ReportColumns.filter(e=>e.HeaderAppearance.IsVisible);for(t=0;t<this.PostDataFetchFilterFields.length&&t<e.length&&this.PostDataFetchFilterFields[t].ColumnName==e[t].ID&&this.PostDataFetchFilterFields[t].Header==e[t].HeaderText;t++);for(s=this.PostDataFetchFilterFields.length-1;s>=t;s--)this.PostDataFetchFilterFields.RemoveAt(s);for(s=t;s<e.length;s++){let t=new _Models_PostDataField__WEBPACK_IMPORTED_MODULE_17__.a;t.PostDataField_1(e[s],this),this.PostDataFetchFilterFields.push(t)}}}RefreshReportTotals(e){this.totals=new Array(e.length).fill(0).map(()=>new Array(this.lstGroup.length+1).fill(0)),this.GrpReportTotal.TotalCols.Clear(),this.TotalCols.Clear(),this.lstGroup.forEach(e=>{e.TotalCols.Clear()}),this.GrpReportTotal.TempTotalCols.keys.forEach(t=>{let s={Key:t};var o=e.find(e=>e.ID==s.Key);if(o){let t=e.indexOf(o);this.TotalCols.Contains(s.Key)||this.TotalCols.push(s.Key),this.GrpReportTotal.TotalCols.push(s.Key,t)}}),this.lstGroup.forEach(t=>{t.TempTotalCols.keys.forEach(s=>{var o=e.find(e=>e.ID==s);if(o){let i=e.indexOf(o);this.TotalCols.Contains(s)||this.TotalCols.push(s),t.TotalCols.push(s,i)}})}),this.totals=new Array(e.length).fill(0).map(()=>new Array(this.lstGroup.length+1).fill(0)),this.ReportColumns=e}AddTotalColumnsToGroup(e,t){try{e.TotalCols=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a,e.TempTotalCols=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a,_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(t,"Column").forEach(t=>{var s=this.ReportColumns.find(e=>e.ID==t.innerHTML);null!=s?(e.TotalCols.push(s.ID,this.ReportColumns.indexOf(s)),e.TempTotalCols.push(s.ID,this.ReportColumns.indexOf(s)),this.TotalCols.Contains(t.innerHTML)||this.TotalCols.push(t.innerHTML)):(s=this.HiddenNumericColumns.find(e=>e.ID==t.innerHTML))&&s.Row>0&&(e.TotalCols.push(s.ID,this.HiddenNumericColumns.indexOf(s)),e.TempTotalCols.push(s.ID,this.HiddenNumericColumns.indexOf(s)),this.TotalCols.Contains(t.innerHTML)||this.TotalCols.push(t.innerHTML))})}catch(s){Logger.ErrorLog("ReportViewModel::Error AddTotalColumnsToGroup",s.stack)}}GetNodeValue(e,t){if(null==e)return"";let s=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(e,t);return s.length>0&&(s.Contains("&amp;")&&(s=s.Replace("&amp;","&")),s.Contains("&gt;")&&(s=s.Replace("&gt;",">")),s.Contains("&lt;")&&(s=s.Replace("&lt;","<")),s.Contains("&quot;")&&(s=s.Replace("&quot;",'"')),s.Contains("&apos;")&&(s=s.Replace("&apos;","'"))),s}GetFormat(e){let t=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.b;try{let s=this.GetNodeValue(e,"Decimals").Trim();if(""!=s&&(t.DecimalsPoints=parseInt(s),-1==t.DecimalsPoints&&(t.DecimalsPoints=parseInt(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.DecimalsinAmount))),s=this.GetNodeValue(e,"RoundOff").Trim(),""!=s&&(t.RoundOff=parseFloat(s)),s=this.GetNodeValue(e,"RoundOff_RT"),""!=s&&(t.RoundOff_RT=parseFloat(s)),s=this.GetNodeValue(e,"RoundOff_ST"),""!=s){let e,o=s.split(";");t.RoundOff_ST=new Array(o.length).fill(0);for(let s=0;s<o.length;s++)e=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(o[s]),t.RoundOff_ST[s]=e}else t.RoundOff_ST=[];let o=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(e,"SubTotalUnder");if(null!=o){t.STUnder=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.c;let e=0;o.childNodes.forEach(s=>{e=parseInt(s.attributes.ID.value);let o=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.e;o.Row=parseInt(s.attributes.R.value),o.Column=parseInt(s.attributes.C.value),o.Caption=s.innerHTML,t.STUnder.push(e,o),this.STMaxRowsUnder[e]<parseInt(s.attributes.R.value)&&(this.STMaxRowsUnder[e]=parseInt(s.attributes.R.value))})}""!=this.GetNodeValue(e,"Commas").Trim()&&(t.Commas=parseInt(this.GetNodeValue(e,"Commas")),-1==t.Commas&&(t.Commas=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("Commas")&&"Lakhs"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.Commas?2:1)),"1"==this.GetNodeValue(e,"Currency").Trim()&&(t.Currency=!0),""!=this.GetNodeValue(e,"NegativeNumber").Trim()&&(t.NegativeNumber=parseInt(this.GetNodeValue(e,"NegativeNumber"))),t.Sort=this.GetNodeValue(e,"Sort"),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.GetNodeValue(e,"SuppressZero"))||(t.SuppressZero=!0),"1"==this.GetNodeValue(e,"WrapText")&&(t.WrapText=!0),"0"==this.GetNodeValue(e,"WrapTextPrint")&&(t.WrapTextPrint=!1),"1"==this.GetNodeValue(e,"PrintOnce")&&(t.PrintOnce=!0),t.PercentageOn=this.GetNodeValue(e,"PercentageOn");let i=this.GetNodeValue(e,"CumulativeTotals");t.CumTotal=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(i)?-1:parseInt(i),t.PrevRowValue=this.GetNodeValue(e,"PrevRowValue"),t.DateType=this.GetNodeValue(e,"DateType"),t.Expression=this.GetNodeValue(e,"Expression"),t.NumberFormat=this.GetNodeValue(e,"NumberFormat").Trim(),"1"==this.GetNodeValue(e,"ShowAvg")&&(t.ShowAvg=!0)}catch(s){Logger.ErrorLog("ReportViewModel::Error GetFormat",s.stack)}return t}GetAppearance(e){let t=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.a;try{if(Logger.InfoLog("ReportViewModel::Entring GetAppearance"),t.Alignment=this.GetNodeValue(e,"Alignment"),t.FontFamilyName=this.GetNodeValue(e,"Font"),""!=this.GetNodeValue(e,"FontSize").Trim()){let s=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(this.GetNodeValue(e,"FontSize"));s<=0&&(s=12),t.FontSize=s}"1"!=this.GetNodeValue(e,"FontBold")&&"True"!=this.GetNodeValue(e,"FontBold")&&"True"!=this.GetNodeValue(e,"FontBold_Header")&&"True"!=this.GetNodeValue(e,"FontBold_Group")&&"True"!=this.GetNodeValue(e,"FontBold_Report")||(t.IsBold=!0),"True"==this.GetNodeValue(e,"FontItalics")&&(t.IsItalics=!0),"True"==this.GetNodeValue(e,"Underline")&&(t.IsUnderline=!0),""!=this.GetNodeValue(e,"BackGrndColor").Trim()&&(t.BackColor=this.GetNodeValue(e,"BackGrndColor")),""!=this.GetNodeValue(e,"ForeGrndColor").Trim()&&(t.ForeColor=this.GetNodeValue(e,"ForeGrndColor")),t.IsVisible="0"!=this.GetNodeValue(e,"Visibility").Trim(),t.IsPrintVisible="0"!=this.GetNodeValue(e,"PrintVisibility").Trim(),Logger.InfoLog("ReportViewModel::Exiting GetAppearance")}catch(s){Logger.ErrorLog("ReportViewModel::Error GetAppearance",s.stack)}return t}LoadPreferences(){this.Preferences.Clear();let e=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f,t=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(this.Reportds.Tables[0][0].CustomPreferences);if(t.length>0&&(e.LoadXml(t),e.DocumentElement.childNodes.forEach(e=>{this.Preferences.ContainsKey(e.nodeName)||this.Preferences.push(e.nodeName,_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.getNodeData(e))})),t=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(this.Reportds.Tables[0][0].DefaultPreferences),t.length>0&&(e.LoadXml(t),e.DocumentElement.childNodes.forEach(e=>{this.Preferences.ContainsKey(e.nodeName)||this.Preferences.push(e.nodeName,_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.getNodeData(e))})),this.HideCostCenterTree=!(!this.Preferences.ContainsKey("HideCostCenterTree")||"1"!=this.Preferences.HideCostCenterTree),this.DontApplyDateFilter=!(!this.Preferences.ContainsKey("DontApplyDateFilter")||"1"!=this.Preferences.DontApplyDateFilter),this.HideEmptyRows=!(!this.Preferences.ContainsKey("HideEmptyRows")||"1"!=this.Preferences.HideEmptyRows),this.HidePrefetch=!(!this.Preferences.ContainsKey("HidePrefetch")||"1"!=this.Preferences.HidePrefetch),this.HideRightNavigation=!(!this.Preferences.ContainsKey("HideRightNavigation")||"1"!=this.Preferences.HideRightNavigation),this.HidePostFilters=!(!this.Preferences.ContainsKey("HidePostFilters")||"1"!=this.Preferences.HidePostFilters),this.HideReportAtLoad=!(!this.Preferences.ContainsKey("HideReportAtLoad")||"1"!=this.Preferences.HideReportAtLoad),this.HidePostFilters&&(this.ShowReportFilter=!1,this.HideRightNavigation=!0),this.Preferences.ContainsKey("SelectTOP")){this.TopRecords=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(this.Preferences.SelectTOP);let e=-1;for(let t=0;t<this.lstGroup.length;t++)if("Summary"==this.lstGroup[t].DisplayMode){e=t-1,this.iTopGroupSummaryConsider=!0;break}}else this.TopRecords=0;this.PDCInclude=!(!this.Preferences.ContainsKey("IncludePDCs")||"1"!=this.Preferences.IncludePDCs),this.UnPostedDocsInclude=!(!this.Preferences.ContainsKey("IncludeUnPostedDocs")||"1"!=this.Preferences.IncludeUnPostedDocs),this.UnPostedDocsList=this.UnPostedDocsInclude&&this.Preferences.ContainsKey("IncludeUnPostedDocsList")?this.Preferences.IncludeUnPostedDocsList:"",this.UnPostedDocsReserveQtyInclude=!(!this.Preferences.ContainsKey("IncludeUnPostedDocsReserveQty")||"1"!=this.Preferences.IncludeUnPostedDocsReserveQty),this.UnPostedDocsHoldQtyInclude=!(!this.Preferences.ContainsKey("IncludeUnPostedDocsHoldQty")||"1"!=this.Preferences.IncludeUnPostedDocsHoldQty),this.IsDefaultSortColumnExists=!(!this.Preferences.ContainsKey("DefaultSortColumn")||_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(this.Preferences.DefaultSortColumn)),this.ShowOnlyAccountingData=!(!this.Preferences.ContainsKey("ShowOnlyAccountingData")||_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(this.Preferences.ShowOnlyAccountingData)),this.Preferences.ContainsKey("IncludeNonAccDocs")&&(this.IncludeNonAccDocs=this.Preferences.IncludeNonAccDocs.split(",")),this.ShowUnAppDocsToApprove=!(!this.Preferences.ContainsKey("ShowUnAppDocsToApprove")||_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(this.Preferences.ShowUnAppDocsToApprove)),this.ShowUnAppDocsToApprove&&(this.ShowUnAppDocsToApprove_UseFuncCall=!(!this.Preferences.ContainsKey("UnAppDocs_UseFunc")||_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(this.Preferences.UnAppDocs_UseFunc))),this.ShowMyUnAppDocsToBeApproved=!(!this.Preferences.ContainsKey("ShowMyUnAppDocsToBeApproved")||_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(this.Preferences.ShowMyUnAppDocsToBeApproved)),111==this.StaticReportType&&this.Preferences.ContainsKey("QuotationComparisonDocument")&&this.Preferences.QuotationComparisonDocument.length>0&&parseInt(this.Preferences.QuotationComparisonDocument)>4e4&&(this.ComparisonQuotationVisible=!0),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("SSRSServerURL")&&!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.SSRSServerURL)&&this.Preferences.ContainsKey("SSRSReport")&&(this.IsSSRS=!0,this.SSRSReportName=this.Preferences.SSRSReport)}UpdateDefaultPreferences(){let e=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(this.Reportds.Tables[0][0].DefaultPreferences);if(e.length>0){let t=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f;t.LoadXml(e);for(let e=0;e<t.DocumentElement.children.length;e++){let s=t.DocumentElement.children[e];this.Preferences.ContainsKey(s.nodeName)?this.Preferences[s.nodeName]=s.innerHTML:this.Preferences.push(s.nodeName,s.innerHTML)}}}LoadData(e=!0){this.HideReportAtLoad&&(this.RptListShow=!1),!this.IsSSRS&&e&&this.ReportViewType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Export&&this.ReportViewType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.LoadDataOnly&&this.ReportViewType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.VPT&&null==this.BulkEdit?((this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DashBoard||this.DispayAsPopup)&&(this.LoadingVisibility=!0),null!=this.PrefetchReportTreeFilter&&(this.PrefetchReportTreeFilter.ReportLoaded=!1),this.DisplayName=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Loading"),this.IsReportLoad=!0,this.Clear(),this.PostDataFetchFilterFields.forEach(e=>{e.Clear()}),310==this.ReportID?this.process_DoWork(null,null):setTimeout(()=>{this.process_DoWork(null,null),306!=this.ReportID&&307!=this.ReportID||(this.LoadingVisibility=!1)},50)):this.IsSSRS||(this.IsReportLoad=!0,this.LoadingVisibility=!0,this.Clear(),this.process_DoWork(null,null))}LoadChildReportData(e,t){this.MergeChildReport&&this.Data.Clear(),null!=this.oReportDialog&&null!=this.ParentReport.oReportDialog&&"APPLYDATEFILTER"==this.oReportDialog.FromDate.ExternExpression&&(this.oReportDialog.FromDate.Date=this.ParentReport.oReportDialog.FromDate.Date,this.oReportDialog.ToDate.Date=this.ParentReport.oReportDialog.ToDate.Date),Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(this.Reportds.Tables[0][0].ShowTitle)&&this.AddReportTitleRow(this.Reportds.Tables[0][0].ReportTitle.toString(),!0),Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(this.Reportds.Tables[0][0].ShowColumns)&&this.AddReportColumnRow(!0),0==this.StaticReportType||-1==this.StaticReportType?(this.ShowFilter=!1,this.ShowReportFilter=!1,this.ShowExport=!1,this.ShowHeaderButtons=!1,this.ShowRightPanel=!1,this.ShowReport=!0,this.SetQueryXMLTags(),this.process_DoWork(e,t)):110==this.StaticReportType||144==this.StaticReportType||(this.oReportDialog.SetLocationWhere(),this.SetQueryXMLTags(),this.process_DoWork(e,t))}LoadChildReportCall(e){e.refreshDataView(),e.childReportIndex++,e.ChildReports[e.childReportIndex-1].LoadChildReportData(null,null)}process_RunWorkerCompleted(e,t){if(this.RptListShow=!0,null!=this.ParentReport){if(this.ParentReport.childReportIndex<this.ParentReport.ChildReports.length)return void this.LoadChildReportCall(this.ParentReport);if(this.childReportIndex>=this.ChildReports.length)return void this.ParentReport.process_RunWorkerCompleted()}else if(this.childReportIndex<this.ChildReports.length)return void this.LoadChildReportCall(this);if(this.process_DoWork_Complete(),this.refreshDataView(),null!=this.ReportSummaryData&&(113!=this.StaticReportType&&(this.ReportData=this.ReportSummaryData,this.ReportDataColumns=this.ReportSummaryDataColumns),this.ReportSummaryData=null,this.ReportSummaryDataColumns=null),null!=this.Chart)return this.Chart.RefreshChart(),void(this.LoadingVisibility=!1);if(this.ApplyDefaultSort(),this.DisplayName=this.ScreenName,this.LoadingVisibility=!1,this.IsReportLoad=!1,this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DashBoard&&this.ShowRightPanel&&this.ShowReportFilter&&(this.FilterorClear("FILTER"),this.MessageVisibility=!1),null!=this.BulkEdit&&this.BulkEdit.RefreshData(),null!=this.PrefetchReportTreeFilter){this.PrefetchReportTreeFilter.ReportLoaded=!0;var s=this.PrefetchReportTreeFilter.CostCenterFilters.find(e=>50==e.CostCenterID&&e.LookupTypeID==this.ReportID);s&&s.OnButtonClick("Delete")}304!=this.ReportID&&305!=this.ReportID||this.Data.forEach(e=>{var t,s;_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(null===(t=e.DataRow)||void 0===t?void 0:t.EmpImg)?e.DataRow.imgUrl=".\\assets\\images\\BlankProfileImage.png":(null==e?void 0:e.DataRow)&&(e.DataRow.imgUrl=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.GetPath(null===(s=e.DataRow)||void 0===s?void 0:s.EmpImg))}),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.EnableMat&&this.callbackDel.IsSubscribed&&this.callbackDel.Call()}process_DoWork(e,t){return Object(tslib__WEBPACK_IMPORTED_MODULE_0__.b)(this,void 0,void 0,(function*(){if(Logger.InfoLog("ReportViewModel::Entering process_DoWork"),this.IsFilterRendering=!1,this.ReportSummaryData=null,this.ReportSummaryDataColumns=null,this.PostFilterData=null,this.dicSubReportStart.Clear(),this.SetDatePickers(),this.RecordCount="",this.childReportIndex=0,this.ColumnSourceALL.filter(e=>!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Formula)&&e.Formula.toUpperCase().Contains("SYSTEMDATE")).length>0||this.lstGroup.filter(e=>!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Formula)&&e.Formula.toUpperCase().Contains("SYSTEMDATE")).length>0)try{this.SystemDate=new Date(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetDataTable("RPT023","")[0].date),this.SystemDateTime=this.SystemDate,this.SystemDate=new Date(this.SystemDate.getFullYear(),this.SystemDate.getMonth(),this.SystemDate.getDate())}catch(e){Logger.ErrorLog("Year:"+this.SystemDate.getFullYear()+",Mn:"+this.SystemDate.getMonth()+",Day:"+this.SystemDate.getDate()),Logger.ErrorLog("Date Error",e),this.SystemDateTime=new Date,this.SystemDate=Date.Today()}if(this.Current_YearStartDate=new Date(this.ToDatePicker.Date.getFullYear(),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.AccountingFromMonth-1,1),this.Current_YearStartDate>this.ToDatePicker.Date&&(this.Current_YearStartDate=this.Current_YearStartDate.AddYears(-1)),this.PRV_YEARSTART=this.Current_YearStartDate.AddYears(-1),1!=this.ToDatePicker.Date.getFullYear()&&(this.PRV_YEARTODATE=this.ToDatePicker.Date.AddYears(-1)),1!=this.FromDatePicker.Date.getFullYear()?this.PRV_YEARFROMDATE=this.FromDatePicker.Date.AddYears(-1):1!=this.PRV_YEARTODATE.getFullYear()&&(this.PRV_YEARFROMDATE=this.PRV_YEARTODATE.AddYears(-1)),this.CURRENT_MONTHSTART=new Date(this.ToDatePicker.Date.getFullYear(),this.ToDatePicker.Date.getMonth(),1),this.PRV_MONTHSTART=this.CURRENT_MONTHSTART.AddMonths(-1),this.PRV_MONTHEND=this.CURRENT_MONTHSTART.AddDays(-1),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("ReportsFrom")&&(this.IsReportDB="1"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ReportsFrom,this.Preferences.ContainsKey("ReportsFrom")&&("TrDB"==this.Preferences.ReportsFrom?this.IsReportDB=!1:"RptDB"==this.Preferences.ReportsFrom&&(this.IsReportDB=!0))),this.ShowReportTitleInSubReports&&null==this.ParentReport&&!this.MergeChildReport&&this.AddReportTitleRow(this.Reportds.Tables[0][0].ReportName.toString(),!0),this.StaticReportType>=1&&this.StaticReportType<=4||86==this.StaticReportType||156==this.StaticReportType||157==this.StaticReportType||169==this.StaticReportType||200==this.StaticReportType)this.BackTrackType="Account",this.StaticReportObject=new _StaticReports_ACC_GeneralLedger__WEBPACK_IMPORTED_MODULE_23__.a(this),this.StaticReportObject.LoadReport();else if(this.StaticReportType>=5&&this.StaticReportType<=8){const{ACC_TradingReports:e}=yield __webpack_require__.e(81).then(__webpack_require__.bind(null,"0T9g"));this.BackTrackType="Account",this.StaticReportObject=new e(this),this.StaticReportObject.LoadReport()}else if(97==this.StaticReportType)this.StaticReportObject=new _StaticReportsTemp_ACC_PLTemplate__WEBPACK_IMPORTED_MODULE_39__.a(this),this.StaticReportObject.LoadReport();else if(this.StaticReportType>=9&&this.StaticReportType<=12||160==this.StaticReportType)this.StaticReportType>=9&&this.StaticReportType<=12&&(this.BackTrackType="Account"),this.StaticReportObject=new _StaticReports_ACC_BillWiseReports__WEBPACK_IMPORTED_MODULE_38__.a(this),this.StaticReportObject.LoadReport();else if(this.StaticReportType>=13&&this.StaticReportType<=16||159==this.StaticReportType)this.BackTrackType="Product",this.StaticReportObject=new _StaticReports_INV_StockLedger__WEBPACK_IMPORTED_MODULE_36__.a(this),this.StaticReportObject.LoadReport();else if(72==this.StaticReportType){const{ACC_BRSReport:e}=yield __webpack_require__.e(58).then(__webpack_require__.bind(null,"8mzQ"));this.StaticReportObject=new e(this),this.StaticReportObject.LoadReport()}else if(this.StaticReportType>=82&&this.StaticReportType<=84||88==this.StaticReportType||114==this.StaticReportType||115==this.StaticReportType){const{INV_Ageing:e}=yield __webpack_require__.e(82).then(__webpack_require__.bind(null,"Pi/L"));this.BackTrackType="Product",this.StaticReportObject=new e(this),this.StaticReportObject.LoadReport()}else if(87==this.StaticReportType){const{REN_FloorWiseExpiry:e}=yield __webpack_require__.e(84).then(__webpack_require__.bind(null,"eoN1"));this.StaticReportObject=new e(this),this.StaticReportObject.LoadReport()}else if(111==this.StaticReportType){const{INV_ComparisonReport:e}=yield Promise.all([__webpack_require__.e(0),__webpack_require__.e(83)]).then(__webpack_require__.bind(null,"2Ofj"));this.StaticReportObject=new e(this),this.StaticReportObject.LoadReport()}else if(116==this.StaticReportType||117==this.StaticReportType||118==this.StaticReportType||120==this.StaticReportType){const{ACC_Asset:e}=yield __webpack_require__.e(79).then(__webpack_require__.bind(null,"g9Ew"));this.StaticReportObject=new e(this),this.StaticReportObject.LoadReport()}else if(98==this.StaticReportType||99==this.StaticReportType){const{ACC_CashFlow:e}=yield __webpack_require__.e(80).then(__webpack_require__.bind(null,"LOar"));this.BackTrackType="Account",this.StaticReportObject=new e(this),this.StaticReportObject.LoadReport()}else if(121==this.StaticReportType)this.StaticReportObject=new _StaticReports_REN_Property__WEBPACK_IMPORTED_MODULE_37__.a(this),this.StaticReportObject.LoadReport();else if(122==this.StaticReportType||123==this.StaticReportType||124==this.StaticReportType||125==this.StaticReportType||126==this.StaticReportType||168==this.StaticReportType)this.StaticReportObject=new _StaticReports_REN_Property__WEBPACK_IMPORTED_MODULE_37__.a(this),this.StaticReportObject.LoadReport();else if(286==this.StaticReportType||306==this.StaticReportType||307==this.StaticReportType)this.StaticReportObject=new _StaticReports_PAY_Reports__WEBPACK_IMPORTED_MODULE_52__.a(this),this.StaticReportObject.LoadReport();else if(this.StaticReportType>=5&&this.StaticReportType<=8){const{ACC_TradingReports:e}=yield __webpack_require__.e(81).then(__webpack_require__.bind(null,"0T9g"));this.BackTrackType="Account",this.StaticReportObject=new e(this),this.StaticReportObject.LoadReport()}else-2==this.StaticReportType||0!=this.StaticReportType&&-1!=this.StaticReportType&&this.ReportViewType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.TransactionQuery&&this.ReportViewType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.LinkingQuery?this.LoadDynmicReportFromSP():this.LoadDynamicReport()}))}process_DoWork_Complete(){if(this.ShowGrandTotalInSubReports&&null==this.ParentReport&&0!=this.ChildReports.length)try{if(!this.MergeChildReport){if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(this.GrandTotalFormulaInSubReports))this.ChildReports.forEach(e=>{this.GrpReportTotal.TotalCols.keys.forEach(t=>{let s=this.GrpReportTotal.TotalCols[t];if(null!=e.StaticReportObject){if(e.Data.length>0&&e.Data[e.Data.length-1].Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.ReportTotal){let t=e.Data[e.Data.length-1];t.Cells.length>s&&null!=t.Cells[s].Value&&(this.totals[s][0]+=parseFloat(t.Cells[s].Value))}}else e.totals.length>=s&&(this.totals[s][0]+=e.totals[s][0])})});else{let e=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a,t=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("R","");e.push("R",t);for(let s=0;s<this.ChildReports.length;s++)t=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("R"+(s+1),""),e.push("R"+(s+1),t);this.GrpReportTotal.TotalCols.keys.forEach(t=>{let s=this.GrpReportTotal.TotalCols[t];e.R.setFieldValue(this.totals[s][0]);let o=1;this.ChildReports.forEach(t=>{if(e["R"+o].setFieldValue(0),null!=t.StaticReportObject){if(t.Data.length>0&&t.Data[t.Data.length-1].Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.ReportTotal){let i=t.Data[t.Data.length-1];i.Cells.length>s&&null!=i.Cells[s].Value&&e["R"+o].setFieldValue(parseFloat(i.Cells[s].Value))}}else t.totals.length>=s&&e["R"+o].setFieldValue(t.totals[s][0]);o++});let i=this.eval.EvaluateExpression(this.GrandTotalFormulaInSubReports,e).toString();try{let e=parseFloat(i);this.totals[s][0]=e}catch(l){this.totals[s][0]=0}})}this.AddSubtotals_RT(this.GrpReportTotal,-100)}}catch(e){Logger.ErrorLog("Sub Report Totals: ",e)}this.RecordCount=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Displaying")+" "+this.Data.length.toString()+" "+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Rows"),this.IsReportLoad=!1,Logger.InfoLog("ReportViewModel::Exiting process_DoWork")}LoadDynmicReportFromSP(){let e=null,t=null,s="",o="";if(-2==this.StaticReportType){let e=0,l=0,a=!1,n=!0;for(let t=0;t<this.ReportColumns.length;t++){let e=this.ReportColumns[t];if(e.HeaderAppearance.IsVisible&&e.ID.startsWith("Ref")){a=!0;break}}switch(this.ReportID){case 25:e=40009,l=-1;break;case 26:e=40009,l=1;break;case 27:e=40009,l=0;break;case 66:e=40009,l=2;break;case 106:e=40027,l=-1,n=!1;break;case 107:e=40027,l=1,n=!1;break;case 108:e=40027,l=0,n=!1;break;case 109:e=40027,l=2,n=!1;break;case 28:e=40007,l=-1;break;case 29:e=40007,l=1;break;case 30:e=40007,l=0;break;case 67:e=40007,l=2;break;case 32:e=40012,l=-1;break;case 33:e=40012,l=1;break;case 34:e=40012,l=0;break;case 68:e=40012,l=2;break;case 35:e=40002,l=-1,n=!1;break;case 36:e=40002,l=1,n=!1;break;case 37:e=40002,l=0,n=!1;break;case 69:e=40002,l=2,n=!1;break;case 38:e=40004,l=-1,n=!1;break;case 39:e=40004,l=1,n=!1;break;case 40:e=40004,l=0,n=!1;break;case 70:e=40004,l=2,n=!1;break;case 101:e=40025,l=-1,n=!1;break;case 102:e=40025,l=1,n=!1;break;case 103:e=40025,l=0,n=!1;break;case 104:e=40025,l=2,n=!1;break;case 105:e=40025,l=3,n=!1}let r=[],h=this.oReportDialog.GetSeqNosList();if(""==h){let t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSet("RPT038",this.IsReportDB,e.toString());null!=t&&t.Tables.length>0&&(t.Tables[0].forEach(e=>{h+=e.CostCenterID.toString()+","}),h.length>0&&(h=h.substr(0,h.length-1))),0==h.length&&(h=e.toString())}r.push(h),r.push(l),r.push(this.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")),r.push(this.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")),r.push(a),this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere?_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?r.push("-1"):r.push(this.oReportDialog.LocationWhere):r.push(null),r.push(this.SelectTag),r.push(this.FromTag),r.push(this.SelectTagAliasOnly);let u="";var i=this.oReportDialog.CostCenterFilters.find(e=>3==e.CostCenterID);if(i&&null!=i.SelectedNodes&&i.SelectedNodes.length>0){let e=i.GetSeqNosListWithRoots();i.IsOneSelected||(i.IsGroupExists?(o=" AND D.ProductID=GTP.GTID",s=e.Contains(",")?",(select T.ProductID GTID from INV_Product T with(nolock),INV_Product GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.ProductID IN ("+e+") group by T.ProductID) AS GTP ":",(select T.ProductID GTID from INV_Product T with(nolock),INV_Product GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.ProductID="+e+" group by T.ProductID) AS GTP "):o=e.Contains(",")?" AND D.ProductID IN ("+e+")":" AND D.ProductID="+e)}u+=this.GetCostCenterFilter(2,n?"D.DebitAccount":"D.CreditAccount"),u+=this.GetDimensionFilter_Str("DCC.dcCCNID"),r.push(u.toString()),r.push(s),r.push(o),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ListOfQuotations(r,this.IsReportDB).then(e=>{if(t=e,a&&null!=t&&t.Tables.length>1&&!t.Columns[0].Contains("ErrorMessage")&&t.Tables[0].length>0){let e,s=t.Tables[1];for(let o=t.Tables[0].length-1;o>=0;o--){s=t.Tables[1].filter(e=>e.LinkedInvDocDetailsID==t.Tables[0][o].InvDocDetailsID);for(let i=s.length-1;i>=0;i--)e=0==i?t.Tables[0][o]:{},e.RefDocDate=s[i].RefDocDate,e.RefDocNo=s[i].RefDocNo,e.RefQty=s[i].RefQty,e.RefRate=s[i].RefRate,e.RefAccount1=s[i].RefAccount1,0!=i&&t.Tables[0].InsertAt(e,o+1)}}this.LoadDynamicReportFromSP_CallBack(t)})}else if(100==this.StaticReportType){let t=0,s=this.oReportDialog.GetSeqNosList();for(let e=0;e<this.ColumnSource.length;e++)"MissingDocuments"==this.ColumnSource[e].ID&&(t=1);let o="",i="";this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(o=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?" AND 1<>1":" AND def.dcCCNID2 IN ("+this.oReportDialog.LocationWhere+")"),i=" D.COSTCENTERID IN ("+s+")  AND CONVERT(DATETIME, D.DocDate) BETWEEN '"+this.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"' AND '"+this.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'",i+=o+this.GetDimensionFilter_Str("def.dcCCNID"),e=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPTST_001",this.IsReportDB,t.toString(),i)}else if(65==this.StaticReportType){let t="";this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(t+=" AND ",_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?t+=" 1<>1":t+=" L.NodeID IN ("+this.oReportDialog.LocationWhere+")"),t+=" GROUP BY L.Name) AS T",e=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPTST_65",this.IsReportDB,t)}else if(71==this.StaticReportType){let t=this.oReportDialog.GetSeqNosListWithRoots();this.oReportDialog.IsZeroSelected||this.oReportDialog.IsOneSelected||(this.oReportDialog.IsGroupExists?(o=" AND A.AccountID=GTP.GTID",s=t.Contains(",")?",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID IN ("+t+") group by T.AccountID) AS GTP ":",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID="+t+" group by T.AccountID) AS GTP "):o=t.Contains(",")?" AND A.AccountID IN ("+t+")":" AND A.AccountID="+t),e=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPTST_71",this.IsReportDB,s,o,this.oReportDialog.ToDate.Date.ToString("dd MMM yyyy"))}else if(113==this.StaticReportType)e=new _StaticReports_REN_Property__WEBPACK_IMPORTED_MODULE_37__.a(this).GetPropertyProfitSummaryAll();else if(73==this.StaticReportType||this.StaticReportType>=209&&this.StaticReportType<=215)e=new _StaticReports_REN_Property__WEBPACK_IMPORTED_MODULE_37__.a(this).GetRentalReportsNew();else if(79==this.StaticReportType)t=new _StaticReports_REN_Property__WEBPACK_IMPORTED_MODULE_37__.a(this).GetDailyVacantReport();else if(85==this.StaticReportType)t=new _StaticReports_REN_Property__WEBPACK_IMPORTED_MODULE_37__.a(this).GetStatisticalReport();else if(89==this.StaticReportType){let t=this.Preferences.SalesDocs,s=this.Preferences.SalesReturnDocs;if(t.length>0||s.length>0){0==t.length&&(t="-1"),0==s.length&&(s="-1");let o="",i=this.GetDimensionFilter_Str("DCC.dcCCNID");i.length>0&&(o=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID"),e=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPTST_89",this.IsReportDB,this.FromDatePicker.Date.ToString("dd MMM yyyy")+"~"+this.ToDatePicker.Date.ToString("dd MMM yyyy"),t+"~"+s+"~"+o,i)}}else if(90==this.StaticReportType){let t=this.oReportDialog.GetSeqNosList();t=t.length>2?" AND D.CostCenterID IN ("+t+")":"";let s="",o="",i="";this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(i=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID"+(this.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.oReportDialog.LocationWhere+")"),o+=i+this.GetDimensionFilter_Str("DCC.dcCCNID"),o.length>0&&(s=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID "),e=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPTST_90",this.IsReportDB,this.FromDatePicker.Date.ToString("dd MMM yyyy")+"~"+this.ToDatePicker.Date.AddDays(1).ToString("dd MMM yyyy")+"~"+t,s,o)}else if(150==this.StaticReportType){let e=this.oReportDialog.GetSeqNosList();e=e.length>2?" AND Acc.CostCenterID IN ("+e+")":"";let s="",o="",i="";this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(i=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID"+(this.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.oReportDialog.LocationWhere+")"),o+=i+this.GetDimensionFilter_Str("DCC.dcCCNID"),(o.length>0||this.FromTag.Contains("DCC."))&&(s=" INNER JOIN COM_DocCCData_History DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=ACC.InvDocDetailsID AND ACC.ModifiedDate=DCC.ModifiedDate "),s+=this.FromTag,o+=this.GetCostCenterFilter(7,"MU.UserID"),o.Contains("MU.UserID")&&(s+=" LEFT JOIN ADM_Users MU WITH(NOLOCK) ON MU.UserName=ACC.ModifiedBy");let l=[];l.push(this.oReportDialog.FromDate.Date.ToString("dd/MMM/yyyy")),l.push(this.oReportDialog.ToDate.Date.ToString("dd/MMM/yyyy")),l.push(this.StaticReportType),l.push(e),l.push(this.SelectTag),l.push(this.DbSelectTag),l.push(s),l.push(o),l.push(this.Preferences.ContainsKey("Filter")?this.Preferences.Filter:""),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetCommonReport(l).then(e=>{if(t=e,null!=t){if(!this.ReportColumns.find(e=>e.ID.endsWith("_OLD"))){let e=new Array;for(let t=0;t<this.ColumnSource.length;t++)if(33==this.ColumnSource[t].ID.length){let s=this.ColumnSource[t].Clone();s.ID=s.ID+"_OLD",s.HeaderText="["+s.HeaderText+"]",e.push(s),e.push(this.ColumnSource[t])}else e.push(this.ColumnSource[t]);this.ReportColumns=e}let e=new Array;this.ReportColumns.forEach(s=>{33==s.ID.length&&(t.Tables[0].Columns.push(s.ID+"_OLD"),e.push(s.ID))});let s="",o="",i="";if(t.Tables.length>0&&t.Tables[0].length>0){let l;for(let a=0;a<t.Tables[0].length;a++)if(s=t.Tables[0][a].DOCID.toString(),0==a&&"Add"!=t.Tables[0][a].HistoryStatus.toString()&&(o=t.Tables[0][a].DOCID.toString()),s==o){if("Add"!=t.Tables[0][a].HistoryStatus.toString()){i=t.Tables[0][a].docseqno.toString(),l=t.Tables[0].filter(e=>e.DocID==s&&e.DocSeqNo==i&&e.SLNO<a+1);let o=l.length-1;l.length>0&&(t.Columns[0].Contains("NewProductCode")&&(t.Tables[0][a].OldProductCode=l[o].NewProductCode),t.Columns[0].Contains("NewProductName")&&(t.Tables[0][a].OldProductName=l[o].NewProductName),t.Tables[0][a].DebitAccountNameOldvalue=l[o].DebitAccountNamenewvalue,t.Tables[0][a].DebitAccountOldvalue=l[o].DebitAccountnewvalue,t.Tables[0][a].OldAmount=l[o].NewAmount,t.Tables[0][a].OldQuantity=l[o].NewQuantity,t.Tables[0][a].CreditAccountNameOldvalue=l[o].CreditAccountNamenewvalue,t.Tables[0][a].CreditAccountOldvalue=l[o].CreditAccountnewvalue,e.forEach(e=>{t.Tables[0][a][e+"_OLD"]=l[o][e]}))}}else o=t.Tables[0][a].DOCID.toString()}}this.LoadDynamicReportFromSP_CallBack(t)})}else if(151==this.StaticReportType)_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.document.GetDocumentDrafts(0,0,2,!0).subscribe(e=>{let s=e[0].Copy();t={Tables:[]},t.Tables.push(s),this.LoadDynamicReportFromSP_CallBack(t)});else if(91==this.StaticReportType){let t="",i=this.oReportDialog.GetSeqNosListWithRoots();this.oReportDialog.IsZeroSelected||this.oReportDialog.IsOneSelected||(this.oReportDialog.IsGroupExists?(o=" AND A.AccountID=GTP.GTID",s=i.Contains(",")?",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID IN ("+i+") group by T.AccountID) AS GTP ":",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID="+i+" group by T.AccountID) AS GTP "):o=i.Contains(",")?" AND A.AccountID IN ("+i+")":" AND A.AccountID="+i),t=" WHERE B.IsNewReference=1 AND B.DocDate<=@To ",t+=o,this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?t+=" AND 1<>1":t+=" AND B.dcCCNID"+(this.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.oReportDialog.LocationWhere+")"),t+="\n) AS T  \nWHERE (Adjusted IS NULL OR Amount<>-Adjusted) ","Due"==this.Preferences.DisplayBills?t+=" AND OverDue<=0":"OverDue"==this.Preferences.DisplayBills&&(t+=" AND OverDue>0"),t+=" --AND  (StatusID=370 OR (DocType<>14 AND DocType<>19) ) \nORDER BY AccountName,DocDate,Amount",e=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPTST_91",this.IsReportDB,this.ToDatePicker.Date.ToString("dd MMM yyyy"),s,t)}else if(92==this.StaticReportType){let t=this.GetDimensionFilter_Str("DCC.dcCCNID");this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?t+=" AND 1<>1":t+=" AND DCC.dcCCNID"+(this.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.oReportDialog.LocationWhere+")"),e=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPTST_92",this.IsReportDB,this.FromDatePicker.Date.ToString("dd MMM yyyy"),t,this.ToDatePicker.Date.ToString("dd MMM yyyy"))}else if(143==this.StaticReportType){let e="",t=this.GetDimensionFilter_Str("POCC.dcCCNID"),s="";if("2"==this.oReportDialog.CostCenters.SelectedValue||"3"==this.oReportDialog.CostCenters.SelectedValue||"61"==this.oReportDialog.CostCenters.SelectedValue)for(let i=0;i<this.oReportDialog.CostCenterFilters.length;i++){let t=this.oReportDialog.CostCenterFilters[i];if((t.SelectedNodes.length>0||!t.DeleteButtonVisibility)&&(2==t.CostCenterID||3==t.CostCenterID||61==t.CostCenterID)&&(2==t.CostCenterID?s="PO.CreditAccount":3==t.CostCenterID?s="PO.ProductID":61==t.CostCenterID&&(s="POCC.VehicleID"),t.SelectedNodes.length>0))if(e+=" AND ",1==t.SelectedNodes.length)e+=s+"="+t.SelectedNodes[0].Id;else{e+=s+" IN (";for(let s=0;s<t.SelectedNodes.length;s++)s>0&&(e+=","),e+=t.SelectedNodes[s].Id;e+=")"}}t=t+" "+e.toString(),this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?t+=" AND 1<>1":t+=" AND POLoc.NodeID IN ("+this.oReportDialog.LocationWhere+")");let o=[];o.push(this.FromDatePicker.Date.ToString("dd/MMM/yyyy")),o.push(this.ToDatePicker.Date.ToString("dd/MMM/yyyy")),o.push(t),o.push(143),""!=this.oReportDialog.CostCenters.SelectedValue&&o.push(this.oReportDialog.CostCenters.SelectedValue)}else if(94==this.StaticReportType)_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPTST_94",this.IsReportDB,this.FromDatePicker.Date.ToString("dd MMM yyyy")+"~"+this.ToDatePicker.Date.ToString("dd MMM yyyy")+"~"+(this.IsReportDB?"1":"0"),this.SelectTag,this.FromTag).then(e=>{let t,s=e.Tables[0],o=[],i=[];s.Sort="DocNo";let l=null;for(let a=0;a<s.length;)l==s[a].DocNo.toString()?(s[a-1].Amount=parseFloat(s[a-1].Amount)+parseFloat(s[a].Amount),t=s[a].DebitAccount.toString(),t.length>0&&(o.Contains(t)||(s[a-1].DebitAccount=0==o.length?s[a].DebitAccount.toString():s[a-1].DebitAccount.toString()+","+s[a].DebitAccount.toString(),o.push(t))),t=s[a].CreditAccount.toString(),t.length>0&&(i.Contains(t)||(s[a-1].CreditAccount=0==i.length?s[a].CreditAccount.toString():s[a-1].CreditAccount.toString()+","+s[a].CreditAccount.toString(),i.push(t))),e.Tables[0].Remove(s[a])):(o.Clear(),i.Clear(),l=s[a].DocNo.toString(),t=s[a].DebitAccount.toString(),t.length>0&&o.push(t),t=s[a].CreditAccount.toString(),t.length>0&&i.push(t),a++);this.LoadDynamicReportFromSP_CallBack(e)});else if(95==this.StaticReportType)e=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPTST_95",this.IsReportDB,this.FromTag,this.Preferences.StatusType+"~"+(this.IsReportDB?"1":"0")+"~"+this.FromDatePicker.Date.ToString("dd MMM yyyy")+"~"+this.ToDatePicker.Date.AddDays(1).ToString("dd MMM yyyy"),this.SelectTag);else if(127==this.StaticReportType)e=new _StaticReports_REN_Property__WEBPACK_IMPORTED_MODULE_37__.a(this).UnitVacant();else if(140==this.StaticReportType)new _StaticReports_REN_Property__WEBPACK_IMPORTED_MODULE_37__.a(this).UnitWiseContractExp();else if(141==this.StaticReportType)e=new _StaticReports_REN_Property__WEBPACK_IMPORTED_MODULE_37__.a(this).GetEmailDetails();else if(142==this.StaticReportType)e=new _StaticReports_REN_Property__WEBPACK_IMPORTED_MODULE_37__.a(this).UnitRenewalReport();else if(31==this.StaticReportType){let t=this.oReportDialog.GetSeqNosListWithRoots();this.oReportDialog.IsZeroSelected||this.oReportDialog.IsOneSelected||(this.oReportDialog.IsGroupExists?(o=" AND A.AccountID=GTP.GTID",s=t.Contains(",")?",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID IN ("+t+") group by T.AccountID) AS GTP ":",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID="+t+" group by T.AccountID) AS GTP "):o=t.Contains(",")?" AND A.AccountID IN ("+t+")":" AND A.AccountID="+t);let i="",l="",a="";this.ReportGroups.find(e=>e.CDGDO.ColumnCostCenterID>5e4)&&(l+=" INNER JOIN COM_DocCCData AS CCMAP with(nolock) ON CCMAP.AccDocDetailsID=ACC.AccDocDetailsID"),this.ReportGroups.forEach(e=>{(2==e.CDGDO.ColumnCostCenterID||e.CDGDO.ColumnCostCenterID>5e4)&&(e.CDGDO.ParentTableAlias="C"+e.CDGDO.ColumnCostCenterID,i+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+" AS "+e.ID+",",a+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+",",l+=" INNER JOIN "+e.CDGDO.ParentCostCenterSysName+" AS "+e.CDGDO.ParentTableAlias,l+=2==e.CDGDO.ColumnCostCenterID?" with(nolock) ON "+e.CDGDO.ParentTableAlias+".AccountID=ACC.AccountID":" with(nolock) ON "+e.CDGDO.ParentTableAlias+".NodeID=CCMAP."+e.CDGDO.ParentColumn)});let n="SELECT AccDocDetailsID,DebitAccount AccountID,Amount DebitAmount,0 CreditAmount FROM ACC_DocDetails WITH(NOLOCK)"+s;n+=" WHERE DocumentType = 16 AND DebitAccount>0 AND CONVERT(DATETIME, DocDate)<='"+this.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'",o.length>0&&(n+=o.Replace("A.AccountID","DebitAccount")),n+=" UNION ALL ",n+="SELECT AccDocDetailsID,CreditAccount AccountID,0 DebitAmount,Amount CreditAmount FROM ACC_DocDetails WITH(NOLOCK)"+s,n+=" WHERE DocumentType = 16 AND CreditAccount>0 AND CONVERT(DATETIME, DocDate)<='"+this.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'",o.length>0&&(n+=o.Replace("A.AccountID","CreditAccount")),n="SELECT "+i+"SUM(DebitAmount) DebitAmount,SUM(CreditAmount) CreditAmount FROM ("+n+") AS ACC",n+=l,a.length>0&&(n+=" GROUP BY "+a.TrimEnd(",")),e=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPT022",this.IsReportDB,n)}else if(80==this.StaticReportType){let t=this.oReportDialog.GetSeqNosListWithRoots();this.oReportDialog.IsZeroSelected||this.oReportDialog.IsOneSelected||(this.oReportDialog.IsGroupExists?(o=" AND A.AccountID=GTP.GTID",s=t.Contains(",")?",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID IN ("+t+") group by T.AccountID) AS GTP ":",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID="+t+" group by T.AccountID) AS GTP "):o=t.Contains(",")?" AND A.AccountID IN ("+t+")":" AND A.AccountID="+t);let i="",l="",a="";this.ReportGroups.find(e=>e.CDGDO.ColumnCostCenterID>5e4)&&(l+=" INNER JOIN COM_DocCCData AS CCMAP with(nolock) ON CCMAP.AccDocDetailsID=ACC.AccDocDetailsID");let n=[];this.ReportGroups.forEach(e=>{(2==e.CDGDO.ColumnCostCenterID||e.CDGDO.ColumnCostCenterID>5e4)&&(e.CDGDO.ParentTableAlias="C"+e.CDGDO.ColumnCostCenterID,i+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+" AS "+e.ID+",",a+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+",",n.Contains(e.CDGDO.ColumnCostCenterID)||(n.push(e.CDGDO.ColumnCostCenterID),l+=" INNER JOIN "+e.CDGDO.ParentCostCenterSysName+" AS "+e.CDGDO.ParentTableAlias,l+=2==e.CDGDO.ColumnCostCenterID?" with(nolock) ON "+e.CDGDO.ParentTableAlias+".AccountID=ACC.AccountID":" with(nolock) ON "+e.CDGDO.ParentTableAlias+".NodeID=CCMAP."+e.CDGDO.ParentColumn))});let r="SELECT AccDocDetailsID,DebitAccount AccountID,VoucherNo DocNo,DocDate,DueDate,Amount DebitAmount,0 CreditAmount FROM ACC_DocDetails WITH(NOLOCK)"+s;r+=" WHERE DocumentType = 16 AND DebitAccount>0 AND CONVERT(DATETIME, DocDate)<='"+this.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'",o.length>0&&(r+=o.Replace("A.AccountID","DebitAccount")),r+=" UNION ALL ",r+="SELECT AccDocDetailsID,CreditAccount AccountID,VoucherNo DocNo,DocDate,DueDate,0 DebitAmount,Amount CreditAmount FROM ACC_DocDetails WITH(NOLOCK)"+s,r+=" WHERE DocumentType = 16 AND CreditAccount>0 AND CONVERT(DATETIME, DocDate)<='"+this.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'",o.length>0&&(r+=o.Replace("A.AccountID","CreditAccount")),r="SELECT "+i+"DocNo,CONVERT(DATETIME,DocDate) DocDate,CONVERT(DATETIME,DueDate) DueDate,SUM(DebitAmount) DebitAmount,SUM(CreditAmount) CreditAmount FROM ("+r+") AS ACC",r+=l,a+="DocNo,DocDate,DueDate",a.length>0&&(r+=" GROUP BY "+a),e=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPT022",this.IsReportDB,r)}else if(81==this.StaticReportType){let e,t=this.oReportDialog.GetSeqNosListWithRoots();this.oReportDialog.IsZeroSelected||this.oReportDialog.IsOneSelected||(this.oReportDialog.IsGroupExists?(o=" AND B.ProductID=GTP.GTID",s=t.Contains(",")?",(select T.ProductID GTID from INV_Product T with(nolock),INV_Product GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.ProductID IN ("+t+") group by T.ProductID) AS GTP ":",(select T.ProductID GTID from INV_Product T with(nolock),INV_Product GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.ProductID="+t+" group by T.ProductID) AS GTP "):o=t.Contains(",")?" AND B.ProductID IN ("+t+")":" AND B.ProductID="+t);let i="TRUE"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataTable("RPT039",this.IsReportDB,"")[0].Value.toString().toUpperCase(),l="",a="",n="",r="",h="",u="";this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(u=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID"+(this.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.oReportDialog.LocationWhere+")"),l+=u+this.GetDimensionFilter_Str("DCC.dcCCNID"),(l.length>0||this.FromTag.Contains("DCC."))&&(a=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID "),l+=this.GetCostCenterFilter(16,"D.BatchID"),this.ReportGroups.forEach(e=>{33==e.ID.length&&(400==e.CDGDO.CategoryValue&&e.CDGDO.ColumnCostCenterID>5e4&&0==a.length&&(a=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID "),r+=e.ID+",")}),n=this.GetCostCenterFilter(113,"D.StatusID"),0==n.length&&(n=" and D.StatusID=369"),e="\ndeclare @To float\nset @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))\n            SELECT P.ProductID,P.ProductName,B.BatchNumber,B.BatchID"+(i?"":",D.InvDocDetailsID")+",CONVERT(DATETIME,B.ExpiryDate) ExpDate,CONVERT(DATETIME,B.MfgDate) MfgDate,D.UOMConvertedQty Quantity,D.Rate,D.VoucherNo DocNo,CONVERT(DATETIME,D.DocDate) DocDate"+this.SelectTag+this.GroupSelectTag+"\nFROM [INV_DocDetails] D with(nolock)\nINNER JOIN INV_Batches B with(nolock) ON D.BatchID=B.BatchID\nINNER JOIN [INV_Product] P with(nolock) ON B.ProductID=P.ProductID"+a+this.FromTag+this.GroupFromTag+s+"\nWHERE D.BatchID>1 and D.VoucherType=1 AND D.IsQtyIgnored=0",e+=o,e+=n,l.length>0&&(e+=l.toString()),"Current"==this.Preferences.Filter?e+=" AND B.ExpiryDate>=@To":"Expired"==this.Preferences.Filter&&(e+=" AND B.ExpiryDate<@To"),e+=" AND D.DocDate<=@To",e+=" Order By "+r+"P.ProductName,BatchNumber,B.BatchID,B.MfgDate,D.DocDate,D.Rate",h=e;let D="";o.length>0&&(D=" inner join INV_Batches B with(nolock) on B.BatchID=D.BatchID "),l.length>0&&(D+=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID "),i?(e+="\tselect D.BatchID,sum(D.UOMConvertedQty) Qty from INV_DocDetails D with(nolock)"+D+s+" where D.BatchID>1 and D.VoucherType=-1 AND D.IsQtyIgnored=0"+n+l.toString()+o,e+=" AND D.DocDate<=@To",e+=" group by D.BatchID"):(e+="\tselect D.RefInvDocDetailsID,sum(D.UOMConvertedQty) Qty from INV_DocDetails D with(nolock)"+D+s+" where D.BatchID>1 and D.VoucherType=-1 AND D.IsQtyIgnored=0"+n+l.toString()+o,e+=" AND D.DocDate<=@To",e+=" group by D.RefInvDocDetailsID"),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPTST_81",this.IsReportDB,e,(i?"1":"0")+"~"+this.Preferences.ConsolidatedBatches).then(e=>{if(e.Tables[0].length>0&&this.ColumnSource.find(e=>"AvgRate"==e.ID&&e.HeaderAppearance.IsVisible)){let t=e.Tables[0].ToTable(!0,["ProductID"]),s=[];s.push(""),s.push(0),s.push(""),s.push(this.oReportDialog.StockDimensionID),this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere?_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?s.push(-1):s.push(this.oReportDialog.LocationWhere):s.push(null),s.push(u+this.GetDimensionFilter_Str("DCC.dcCCNID")),s.push(""),s.push(this.oReportDialog.ToDate.Date),s.push(this.UnPostedDocsInclude),s.push(0),s.push(0),s.push(0),s.push(""),s.push(""),s.push(0),s.push(0),s.push(""),s.push(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.UserID),s.push(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LanguageID);let o=25,i=null,l="";for(let e=0;e<t.length;e+=o){l="";for(let s=e;s<t.length&&s-e<o;s++)l.length>0&&(l+=","),l+=t[s].ProductID.toString();s[0]=l.toString();let a=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetStockValuation(s,this.IsReportDB);null==i?i=a:i.Merge(a)}e.Tables[0].Columns.push("AvgRate");let a=i.Tables[0];e.Tables[0].forEach(e=>{a.RowFilter!="ProductID="+e.ProductID.toString()&&(a.RowFilter="ProductID="+e.ProductID.toString()),e.AvgRate=0==a.length?0:a[0].AvgRate})}this.LoadDynamicReportFromSP_CallBack(e)})}else if(146==this.StaticReportType||148==this.StaticReportType||149==this.StaticReportType){let t=[];t.push(this.StaticReportType),t.push(this.Preferences.Location.toString()),t.push(this.oReportDialog.FromDate.Date),t.push(this.oReportDialog.ToDate.Date),t.push(this.Preferences.Feature.toString()),t.push(this.Preferences.Account.toString()),t.push(this.Preferences.Customer.toString()),t.push(this.Preferences.CreatedBy.toString()),t.push(this.Preferences.Assigned.toString()),t.push(this.Preferences.Status.toString()),e=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetFeatureWiseCalendar(t)}else if(154==this.StaticReportType){let t="";this.ButtonSave.Visible=!1;let s=this.Preferences.ContainsKey("History")&&"1"==this.Preferences.History;"1"==this.Preferences.StatusType?s?t=" AND H.StatusID=1":(t=" AND E.StatusID=1 and E.FailureCount<5",this.ButtonSave.Visible=!0):"2"==this.Preferences.StatusType?t=s?" AND H.StatusID=2":" AND E.StatusID=2":"-1"==this.Preferences.StatusType&&(t=s?" AND H.StatusID=3":" AND (E.StatusID=3 or (E.StatusID=1 and E.FailureCount>=5))"),!this.Preferences.ContainsKey("Show")||"1"!=this.Preferences.Show&&"2"!=this.Preferences.Show||(t+=s?" AND H.TemplateType="+this.Preferences.Show:" AND T.TemplateType="+this.Preferences.Show),"1"!=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.RoleID&&"TRUE"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.EnableLocationWise.toUpperCase()&&_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("LWEmailSMS")&&"TRUE"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.LWEmailSMS.toUpperCase()&&(t+=" AND TL.NodeID in ("+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationWhere+",0)"),e=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPTST_154",this.IsReportDB,this.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"~"+this.oReportDialog.ToDate.Date.AddDays(1).ToString("dd MMM yyyy"),s?"1":"0",t)}else if(158==this.StaticReportType){let t=this.oReportDialog.GetSeqNosListWithRoots();this.oReportDialog.IsZeroSelected||this.oReportDialog.IsOneSelected||(this.oReportDialog.IsGroupExists?(o=" AND B.ProductID=GTP.GTID",s=t.Contains(",")?",(select T.ProductID GTID from INV_Product T with(nolock),INV_Product GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.ProductID IN ("+t+") group by T.ProductID) AS GTP ":",(select T.ProductID GTID from INV_Product T with(nolock),INV_Product GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.ProductID="+t+" group by T.ProductID) AS GTP "):o=t.Contains(",")?" AND B.ProductID IN ("+t+")":" AND B.ProductID="+t);let i="",l="",a="",n="";this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(n=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID"+(this.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.oReportDialog.LocationWhere+")"),l+=n+this.GetDimensionFilter_Str("DCC.dcCCNID"),(l.length>0||this.FromTag.Contains("DCC."))&&(a=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID ");let r=_StaticReports_StaticReportsViewModel__WEBPACK_IMPORTED_MODULE_33__.b.GetFilterByDimension_3(16,this.oReportDialog.CostCenterFilters);r.length>0&&(r.Contains(",")?l+=" AND B.BatchID IN ("+r+")":l+=" AND B.BatchID="+r);let h=this.GetCostCenterFilter(113,"D.StatusID");0==h.length&&(h=" and D.StatusID=369"),l+=h,l+=" AND D.IsQtyIgnored=0 AND D.DocDate BETWEEN @From AND @To",l+=o,i+="DECLARE @From FLOAT,@To FLOAT SET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",i+="\nSELECT B.ProductID,B.BatchID,P.ProductName, B.BatchNumber,D.VoucherNo DocNo,'' AdjustedDocNo,CONVERT(DATETIME,D.DocDate) DocDate,A.AccountName CustomerName,CONVERT(DATETIME,B.ExpiryDate) ExpDate,CONVERT(DATETIME,B.MfgDate) MfgDate,D.UOMConvertedQty RecQty,null IssQty\n,D.VoucherType,case when D.DocumentType=5 then 1 else 2 end ST"+this.SelectTag+this.GroupSelectTag+"\nFROM [INV_DocDetails] D with(nolock) \nINNER JOIN INV_Batches B with(nolock) ON B.BatchID=D.BatchID\nINNER JOIN [INV_Product] P with(nolock) ON B.ProductID=P.ProductID\nINNER JOIN ACC_Accounts A WITH(NOLOCK) ON A.AccountID=D.CreditAccount"+a+this.FromTag+this.GroupFromTag+s+"\nWHERE D.BatchID>1 AND D.VoucherType=1 AND D.IsQtyIgnored=0"+l.toString()+"\nUNION ALL\nSELECT B.ProductID,B.BatchID,P.ProductName, B.BatchNumber,D.VoucherNo DocNo,S.VoucherNo AdjustedDocNo,CONVERT(DATETIME,D.DocDate) DocDate,A.AccountName CustomerName,CONVERT(DATETIME,B.ExpiryDate) ExpDate,CONVERT(DATETIME,B.MfgDate) MfgDate,null RecQty,D.UOMConvertedQty IssQty\n,D.VoucherType,case when D.DocumentType=5 then 1 else 0 end ST"+this.SelectTag+this.GroupSelectTag+"\nFROM [INV_DocDetails] D with(nolock) \nINNER JOIN INV_Batches B with(nolock) ON B.BatchID=D.BatchID\nINNER JOIN [INV_Product] P with(nolock) ON B.ProductID=P.ProductID\nINNER JOIN ACC_Accounts A WITH(NOLOCK) ON A.AccountID=D.DebitAccount"+a+this.FromTag+this.GroupFromTag+s+"\nLEFT JOIN [INV_DocDetails] S with(nolock) ON S.InvDocDetailsID=D.RefInvDocDetailsID\nWHERE D.BatchID>1 AND D.VoucherType=-1 AND D.IsQtyIgnored=0"+l.toString()+"\nORDER BY ProductID,BatchID,DocDate,ST DESC,VoucherNo,VoucherType DESC",e=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPT022",this.IsReportDB,i)}else if(171==this.StaticReportType){let t=this.oReportDialog.GetSeqNosListWithRoots(),i="",l="",a="",n="",r="";this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(r=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID"+(this.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.oReportDialog.LocationWhere+")"),l+=r+this.GetDimensionFilter_Str("DCC.dcCCNID"),n=this.GetCostCenterFilter(300,"D.CostCenterID"),(l.length>0||this.FromTag.Contains("DCC."))&&(a=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID ");let h="",u="";0==this.UnPostedDocsList.length?h=" AND (D.StatusID=369)":h+=" AND D.StatusID IN (369,"+this.UnPostedDocsList+")",u=h,u=this.PDCInclude?" AND D.DocumentType<>16 AND ((D.StatusID=370 or D.StatusID=439) OR (D.DocumentType<>14 AND D.DocumentType<>19"+u+"))":" AND D.DocumentType NOT IN (16,14,19)"+u,!this.oReportDialog.IsZeroSelected&&!this.oReportDialog.IsOneSelected&&t.length>0&&(this.oReportDialog.IsGroupExists?(o="=GTP.GTID",s=t.Contains(",")?",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID IN ("+t+") group by T.AccountID) AS GTP ":",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID="+t+" group by T.AccountID) AS GTP "):o=t.Contains(",")?" IN ("+t+")":"="+t),i+="select A.AccountName,A.AccountID,P.Remarts Description,P.Amount,convert(datetime,P.DueDate) DueDate,P.VoucherNo PTVoucherNo,P.Percentage",this.SelectTag.length>0&&(i+=this.SelectTag),i+="\nfrom COM_DocPayTerms P with(nolock)\ninner join acc_accounts A with(nolock) on P.AccountID=A.AccountID",(a.length>0||l.length>0||this.SelectTag.length>0||n.length>0)&&(i+=" inner join INV_DocDetails D with(nolock) ON D.VoucherNo=P.VoucherNo and D.DocSeqNo=1 "+a+this.FromTag),i+=s,i+="\nwhere 1=1",this.oReportDialog.ToDate.Visible&&(i+=" AND P.DueDate<=convert(float,convert(datetime,'"+this.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))"),o.length>0&&(i+=" AND A.AccountID"+o),l.length>0&&(i+=l.toString()),n.length>0&&(i+=n),i+=h,i+="\nORDER BY AccountName,P.DueDate\n\nselect CreditAccount AccountID,VoucherNo,convert(datetime,D.DocDate) DocDate,Amount,A.AccountName Particulars,D.ChequeNumber,convert(datetime,D.ChequeDate) ChequeDate,convert(datetime,D.ChequeMaturityDate) ChequeMaturityDate\nfrom Acc_DocDetails D with(nolock)\ninner join acc_accounts A with(nolock) on D.DebitAccount=A.AccountID\n",l.toString().Contains("DCC.")&&(i+=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.AccDocDetailsID=D.AccDocDetailsID"),i+=s,i+="\nWHERE 1=1",o.length>0&&(i+=" AND D.CreditAccount"+o),i+=l.toString(),i+=u,i+="\nORDER BY DocDate,DocPrefix,DocNumber",i+="\nselect D.DebitAccount AccountID,sum(D.Amount) Amount from acc_docdetails D with(nolock)",l.toString().Contains("DCC.")&&(i+=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.AccDocDetailsID=D.AccDocDetailsID"),i+=s,i+="\nWHERE documenttype=16 ",o.length>0&&(i+=" AND D.DebitAccount"+o),i+=l.toString(),i+=" GROUP BY D.DebitAccount HAVING sum(D.Amount)>0",e=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSet("RPT022",this.IsReportDB,i)}else if(this.StaticReportType>=172&&this.StaticReportType<=175||this.StaticReportType>=180&&this.StaticReportType<=183){let t=this.StaticReportType>=180&&this.StaticReportType<=183,s="",o="",i=this.oReportDialog.GetSeqNosListWithRoots();t?this.oReportDialog.IsZeroSelected||this.oReportDialog.IsGroupExists&&"1"==i||(i.Contains(",")?o+=" AND JO.ProductID IN ("+i+")":o+=" AND JO.ProductID="+i):this.oReportDialog.IsZeroSelected||this.oReportDialog.IsGroupExists&&"2"==i||(i.Contains(",")?o+=" AND JO.NodeID IN ("+i+")":o+=" AND JO.NodeID="+i);let l="";this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(l=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID"+(this.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.oReportDialog.LocationWhere+")"),s+=l+this.GetDimensionFilter_Str("DCC.dcCCNID");let a=33,n=1;switch(this.StaticReportType){case 172:case 180:a=33,n=1;break;case 173:case 181:a=33,n=2;break;case 174:case 182:a=34,n=1;break;case 175:case 183:a=34,n=2}let r=[];r.push(a),r.push(n),r.push(t),r.push(s.toString()),r.push(o.toString()),r.push(this.Preferences.ContainsKey("ProductsNotInBOM")&&"1"==this.Preferences.ProductsNotInBOM?1:0),r.push(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LanguageID),e=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.PRDJobWiseVariance(r)}else if(185==this.StaticReportType){let t=this.oReportDialog.GetSeqNosListWithRoots();this.oReportDialog.IsZeroSelected||this.oReportDialog.IsOneSelected||(this.oReportDialog.IsGroupExists?(o=" AND P.ProductID=GTP.GTID",s=t.Contains(",")?",(select T.ProductID GTID from INV_Product T with(nolock),INV_Product GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.ProductID IN ("+t+") group by T.ProductID) AS GTP ":",(select T.ProductID GTID from INV_Product T with(nolock),INV_Product GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.ProductID="+t+" group by T.ProductID) AS GTP "):o=t.Contains(",")?" AND P.ProductID IN ("+t+")":" AND P.ProductID="+t);let i="",l="",a="",n="";this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(n=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID"+(this.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.oReportDialog.LocationWhere+")"),l+=n+this.GetDimensionFilter_Str("DCC.dcCCNID"),(l.length>0||this.FromTag.Contains("DCC."))&&(a=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID "),l+=" WHERE D.DocDate BETWEEN @From AND @To",this.Preferences.ContainsKey("SerialNo")&&!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(this.Preferences.SerialNo)&&(l+=" AND S.SerialNumber='"+this.Preferences.SerialNo.Replace("'","''")+"'"),l+=o,i+="DECLARE @From FLOAT,@To FLOAT SET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",i+="\nselect S.SerialNumber,P.ProductCode,P.ProductName,convert(datetime,DocDate) DocDate,D.VoucherNo,D.Rate,'Receipt' VType,D.VoucherType,1 IssQty,null RecQty\n"+this.SelectTag+this.GroupSelectTag+"\nfrom INV_SerialStockProduct S with(nolock)\ninner join Inv_DocDetails D with(nolock) on D.InvDocDetailsID=S.InvDocDetailsID\ninner join Inv_Product P with(nolock) on P.ProductID=D.ProductID",this.GroupSelectTag.Contains("A.")&&(i+=" INNER JOIN ACC_Accounts A WITH(NOLOCK) ON A.AccountID=D.CreditAccount"),i+=a+this.FromTag+s,i+=l.toString()+" and D.VoucherType=1",i+="\nunion all\nselect S.SerialNumber,P.ProductCode,P.ProductName,convert(datetime,DocDate) DocDate,D.VoucherNo,D.Rate,'Issue' VType,D.VoucherType,null IssQty,1 RecQty\n"+this.SelectTag+this.GroupSelectTag+"\nfrom INV_SerialStockProduct S with(nolock)\ninner join Inv_DocDetails D with(nolock) on D.InvDocDetailsID=S.InvDocDetailsID\ninner join Inv_Product P with(nolock) on P.ProductID=D.ProductID",this.GroupSelectTag.Contains("A.")&&(i+=" INNER JOIN ACC_Accounts A WITH(NOLOCK) ON A.AccountID=D.DebitAccount"),i+=a+this.FromTag+s,i+=l.toString()+" and D.VoucherType=-1\norder by ProductName,SerialNumber,DocDate,VoucherType desc",e=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPT022",this.IsReportDB,i)}else{if(190==this.StaticReportType){let e;e=null!=this.POSExitViewModel?this.POSExitViewModel.GetReportDataTable():_pages_home_RibbonExtViewModel__WEBPACK_IMPORTED_MODULE_28__.RibbonExtViewModel.GetposDayclose(this);let s=[],o=[];for(let t=0;t<this.ColumnSource.length;t++)if("StyleIsBold"!=this.ColumnSource[t].ID)if("Value"==this.ColumnSource[t].ID){let e=this.oReportDialog.FromDate.Date;for(;e<=this.oReportDialog.ToDate.Date;){let o=this.ColumnSource[t].Clone();o.HeaderText=e.ToString("dd-MMM-yy"),o.ID=e.ToString("ddMMMyyyy"),s.push(o),e=e.AddDays(1)}}else s.push(this.ColumnSource[t].Clone());for(let t=0;t<s.length;t++)o.push(s[t].ID);return this.ReportColumns=s,t={Tables:[],Columns:[]},t.Columns.push(o),t.Tables.push(e),void this.LoadDynamicReportFromSP_CallBack(t)}if(195==this.StaticReportType){let t="",s="";this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(s=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID"+(this.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.oReportDialog.LocationWhere+")"),t+=s+this.GetDimensionFilter_Str("DCC.dcCCNID");let o=this.GetCostCenterFilter(3,"P.ProductID"),i=_StaticReports_StaticReportsViewModel__WEBPACK_IMPORTED_MODULE_33__.b.GetFilterByDimension_3(300,this.oReportDialog.CostCenterFilters),l="";l+='<XML ToDate="'+this.oReportDialog.ToDate.Date.ToString("dd MMM yyyy"),l+='" POFilter="'+(this.Preferences.ContainsKey("POConsiderDueDate")&&"1"==this.Preferences.POConsiderDueDate?"DueDate":"DocDate"),l+='" PODocs="'+(this.Preferences.ContainsKey("ExpectedDocs")?this.Preferences.ExpectedDocs:""),l+='">',l+="<Select>"+this.SelectTag+"</Select>",l+="<Join>"+this.FromTag+"</Join>",l+="<CCWhere>"+t.toString()+"</CCWhere>",o.length>0&&(l+="<ProductWhere>"+o+"</ProductWhere>"),l+="</XML>";let a=this.Preferences.ContainsKey("POConsiderInQOH")&&"1"==this.Preferences.POConsiderInQOH?"1":"0";e=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetMRP_Param195(11,0,l.toString(),i,null,a)}else if(198==this.StaticReportType){let t=this.oReportDialog.GetSeqNosListWithRoots();this.oReportDialog.IsZeroSelected||this.oReportDialog.IsOneSelected||(this.oReportDialog.IsGroupExists?(o=" AND B.AccountID=GTP.GTID",s=t.Contains(",")?",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID IN ("+t+") group by T.AccountID) AS GTP ":",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID="+t+" group by T.AccountID) AS GTP "):o=t.Contains(",")?" AND B.AccountID IN ("+t+")":" AND B.AccountID="+t);let i="",l="",a="";this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(a=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?" AND 1<>1":" AND B.dcCCNID"+(this.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.oReportDialog.LocationWhere+")"),l+=a+this.GetDimensionFilter_Str("B.dcCCNID");let n=this.GetCostCenterFilter(300,"CostCenterID"),r="";this.ReportGroups.forEach(e=>{r+=e.ID+","}),i+="DECLARE @From FLOAT,@To FLOAT SET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+'\'))\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,\'" + oReportDialog.ToDate.Date.ToString("dd MMM yyyy") + "\'))";\n\n            sb+=@"\nselect A.AccountID,0 IsAdjustment,B.DocNo MainDocNo,B.DocSeqNo MainDocSeqNo,convert(datetime,B.DocDate) DocDate,abs(B.AdjAmount) Amount,CONVERT(FLOAT,null) AdjAmount,A.AccountName\n,case when B.BillNo is not null then  B.BillNo else (select Top 1 BillNo from INV_DocDetails where VoucherNo=B.RefDocNo) end BillNo\n,convert(datetime,(case when B.BillDate is not null then  B.BillDate else (select Top 1 BillDate from INV_DocDetails where VoucherNo=B.RefDocNo) end)) BillDate\n,B.RefDocNo,convert(datetime,B.RefDocDate) RefDocDate\n'+this.SelectTag+"from com_billwise B with(nolock) \ninner join ACC_Accounts A with(nolock) on B.AccountID=A.AccountID\ninner join (select VoucherNo,DocPrefix,DocNumber from acc_docdetails with(nolock) where 1=1 "+n+" Group by VoucherNo,DocPrefix,DocNumber) as T on T.VoucherNo=B.Docno\n"+this.FromTag+s+"\n--where (B.Docno='PMT-600')\nwhere B.DocDate between @From and @To "+l.toString()+o+"\norder by "+r+"T.DocPrefix,convert(int,T.DocNumber),MainDocSeqNo,A.AccountID\n\nselect A.AccountID,1 IsAdjustment,B.RefDocNo MainDocNo,B.RefDocSeqNo MainDocSeqNo,null DocDate,abs(B.AdjAmount) Amount,abs(B.AdjAmount) AdjAmount,A.AccountName\n,case when B.BillNo is not null then  B.BillNo else (select Top 1 BillNo from INV_DocDetails where VoucherNo=B.RefDocNo) end BillNo\n,convert(datetime,(case when B.BillDate is not null then  B.BillDate else (select Top 1 BillDate from INV_DocDetails where VoucherNo=B.RefDocNo) end)) BillDate\n,B.DocNo RefDocNo,convert(datetime,B.DocDate) RefDocDate\n"+this.SelectTag+"\nfrom com_billwise B with(nolock) \ninner join ACC_Accounts A with(nolock) on B.AccountID=A.AccountID\ninner join (select VoucherNo from acc_docdetails with(nolock) where 1=1 "+n+" Group by VoucherNo) as T on T.VoucherNo=B.RefDocno\n"+this.FromTag+s+"\n--where (B.RefDocno='PMT-600')\nwhere B.RefDocDate between @From and @To "+o;let h="";this.ReportGroups.forEach(e=>{h+=e.ID+","}),h=h.TrimEnd(","),e=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPTST_198",this.IsReportDB,i,h)}else if(202==this.StaticReportType)e=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPTST_202",this.IsReportDB,this.Preferences.Filter);else if(207==this.StaticReportType){let e="",t="",s="";this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(s=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID"+(this.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.oReportDialog.LocationWhere+")"),t+=s+this.GetDimensionFilter_Str("DCC.dcCCNID"),(t.length>0||this.FromTag.Contains("DCC."))&&(e=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.AccDocDetailsID=D.AccDocDetailsID"),e+=this.FromTag;let o=this.GetCostCenterFilter(300,"CostCenterID"),i=[];i.push(this.FromDatePicker.Date),i.push(this.ToDatePicker.Date),i.push(this.StaticReportType),i.push(o),i.push(this.SelectTag),i.push(""),i.push(e),i.push(t),i.push(""),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetCommonReport(i).then(e=>{e.Tables[0].Columns.push("AccountName"),e.Tables[0].Columns.push("DrAccName"),e.Tables[0].Columns.push("CrAccName"),e.Tables[0].Columns.push("Amount"),this.TotalCols.Clear(),this.GrpReportTotal.TotalCols.Clear(),this.ReportParams.ContainsKey("TotalAmountIndex")||this.ReportParams.push("TotalAmountIndex","");let t=[];for(let o=0;o<this.ColumnSource.length;o++)"Slab"!=this.ColumnSource[o].ID&&(t.push(this.ColumnSource[o].Clone()),this.GrpReportTotal.TempTotalCols.ContainsKey(this.ColumnSource[o].ID)&&(this.TotalCols.push(this.ColumnSource[o].ID),this.GrpReportTotal.TotalCols.push(this.ColumnSource[o].ID,o),"Amount"!=this.ColumnSource[o].ID&&"TotalAmount"!=this.ColumnSource[o].ID||(this.ReportParams.TotalAmountIndex=o.toString())));let s=this.ColumnSource.find(e=>"Slab"==e.ID);if(e.Tables[0].length>0&&null!=s){this.ReportParams.ContainsKey("SlabIndex")||this.ReportParams.push("SlabIndex",""),this.ReportParams.SlabIndex=t.length.toString();let o=Math.min.apply(Math,e.Tables[0].map((function(e){return e.StartDate}))),i=new Date(o);o=Math.min.apply(Math,e.Tables[0].map((function(e){return e.EndDate})));let l,a=new Date(o),n=new Date(i.getFullYear(),i.getMonth(),1);for(;n<=a;){let o=s.Clone();o.HeaderText=n.ToString("MMM-yyyy"),o.ID=n.ToString("yyyy-MM"),t.push(o),n=n.AddMonths(1),e.Tables[0].Columns.push(o.ID),this.TotalCols.push(o.ID),this.GrpReportTotal.TotalCols.push(o.ID,t.length-1)}let r,h,u,D,d=!1,c=0,C=null,p=null;for(let t=0;t<e.Tables[0].length;t++)if(h=e.Tables[0][t],l=parseInt(h.DocumentType),d=18==l||22==l,h.AccountName=d?h.CrMainAccName.toString():h.DrMainAccName.toString(),D=e.Tables[1].filter(e=>e.AccDocDetailsID==h.AccDocDetailsID),D.length>0)for(let s=0;s<D.length;s++)u=D[s],C==u.DrAccName.toString()&&p==u.CrAccName.toString()||(s>0&&(h=e.Tables[0].NewRow(),t++,e.Tables[0].InsertAt(h,t)),C=u.DrAccName.toString(),p=u.CrAccName.toString(),h.DrAccName=C,h.CrAccName=p,c=0),r=new Date(u.DocDate).ToString("yyyy-MM"),null==h[r]&&(h[r]=u.Amount),c+=parseFloat(u.Amount),h.Amount=c}this.totals=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.NumArray(t.length,this.lstGroup.length+1),this.ReportColumns=t,this.LoadDynamicReportFromSP_CallBack(e)})}else if(203==this.StaticReportType||204==this.StaticReportType){let t=this.oReportDialog.GetSeqNosListWithRoots();this.oReportDialog.IsZeroSelected||this.oReportDialog.IsOneSelected||(this.oReportDialog.IsGroupExists?(o=" AND D.ProductID=GTP.GTID",s=t.Contains(",")?",(select T.ProductID GTID from INV_Product T with(nolock),INV_Product GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.ProductID IN ("+t+") group by T.ProductID) AS GTP ":",(select T.ProductID GTID from INV_Product T with(nolock),INV_Product GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.ProductID="+t+" group by T.ProductID) AS GTP "):o=t.Contains(",")?" AND D.ProductID IN ("+t+")":" AND D.ProductID="+t);let i="",l="",a="";this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(a=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID"+(this.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.oReportDialog.LocationWhere+")"),l+=a+this.GetDimensionFilter_Str("DCC.dcCCNID"),(l.length>0||this.FromTag.Contains("DCC."))&&(i=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID"),i+=this.FromTag;let n=this.GetCostCenterFilter(113,"D.StatusID");0==n.length&&(n=" and D.StatusID=369"),l+=n;let r="";this.ReportGroups.forEach(e=>{r.length>0&&(r+=","),r+=e.ID});let h=[];h.push(this.FromDatePicker.Date),h.push(this.ToDatePicker.Date),h.push(this.StaticReportType),h.push(""),h.push(this.SelectTag+this.GroupSelectTag),h.push(this.DbSelectTag+this.DbGroupSelectTag),h.push(i+s+this.GroupFromTag),h.push(o+l),h.push(r),e=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetCommonReport(h)}else if(294==this.StaticReportType){let t=this.oReportDialog.GetSeqNosList(),i="";t.length>0&&!this.oReportDialog.IsZeroSelected&&!this.oReportDialog.IsOneSelected&&(i+=" and B.BOMID IN ("+t+")");let l=[];l.push(this.StaticReportType),l.push(""),l.push(s),l.push(o+i),e=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetProductionReport(l,this.IsReportDB)}else if(296==this.StaticReportType){if(this.oReportDialog.CostCenterFilters.length>0)for(let e=0;e<this.oReportDialog.CostCenterFilters.length;e++)if(50051==this.oReportDialog.CostCenterFilters[e].CostCenterID){let t="";for(let s=0;s<this.oReportDialog.CostCenterFilters[e].SelectedNodes.length;s++)t.length>0&&(t+=","),t+=this.oReportDialog.CostCenterFilters[e].SelectedNodes[s].Id.toString();t.length>0&&_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPTST_296",this.IsReportDB,t,this.oReportDialog.FromDate.Date.ToString("dd/MMM/yyyy"),this.oReportDialog.ToDate.Date.ToString("dd/MMM/yyyy"))}}else if(298==this.StaticReportType){let e=this.oReportDialog.GetSeqNosList();if(e=e.length>2?" AND Curr.CostCenterID IN ("+e+")":"",this.Preferences.ContainsKey("ShowFields")&&!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.Preferences.ShowFields)){e+=" AND (";let t=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f;t.LoadXml("<XML>"+this.Preferences.ShowFields+"</XML>"),t.DocumentElement.childNodes.forEach(t=>{"Common"==t.nodeName?e+=" ([Nxt].SysTableName='INV_DocDetails' OR [Nxt].SysTableName='ACC_DocDetails') OR ":"Numeric"==t.nodeName?e+=" [Nxt].SysColumnName LIKE 'dcNum%' OR ":"CostCenter"==t.nodeName?e+=" [Nxt].SysColumnName LIKE 'dcCCNID%' OR ":"Alpha"==t.nodeName&&(e+=" [Nxt].SysColumnName LIKE 'dcAlpha%' OR ")}),e=e.Remove(e.length-3)+" )"}let t=[];t.push(400),t.push(e),t.push(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.UserID),t.push(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.RoleID),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetAuditData(t,this.IsReportDB).then(e=>{let t=null,s=[];for(let i=0;i<this.ColumnSource.length;i++)"RepeatCol"==this.ColumnSource[i].ID?t=this.ColumnSource[i].Clone():s.push(this.ColumnSource[i].Clone());let o="";for(let i=0;i<e.Tables[0].Columns.length;i++)e.Tables[0].Columns[i].Caption.startsWith("diff")&&(0==e.Tables[0].filter(e=>e.ds.Tables[0].Columns[i].Caption+"=1").length?(e.Tables[0].Columns.RemoveAt(i),e.Tables[0].Columns.RemoveAt(i-1),e.Tables[0].Columns.RemoveAt(i-2),i--):(s.push(t.Clone()),s[s.length-1].HeaderText="Old "+e.Tables[0].Columns[i].Caption.substr(4),s[s.length-1].ID="old"+e.Tables[0].Columns[i].Caption.substr(4),s.push(t.Clone()),s[s.length-1].HeaderText="New "+e.Tables[0].Columns[i].Caption.substr(4),s[s.length-1].ID="new"+e.Tables[0].Columns[i].Caption.substr(4),o+='<Row ID="old'+e.Tables[0].Columns[i].Caption.substr(4)+'" Formula="if('+e.Tables[0].Columns[i].Caption+'==1) 1 else 0" Expression=" if ('+e.Tables[0].Columns[i].Caption+'==1)1 else 0" BackColor="#FFFFB5B6" ForeColor="" Img="" Text="" />',o+='<Row ID="new'+e.Tables[0].Columns[i].Caption.substr(4)+'" Formula="if('+e.Tables[0].Columns[i].Caption+'==1) 1 else 0" Expression=" if ('+e.Tables[0].Columns[i].Caption+'==1)1 else 0" BackColor="#FFFFB5B6" ForeColor="" Img="" Text="" />',i+=2));if(this.ReportColumns=s,this.kpiList.Clear(),this.kpiListSrc.Clear(),o.length>0){o="<XML>"+o,o+="</XML>";let e=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f;e.LoadXml(o.toString()),e.DocumentElement.childNodes.forEach(e=>{let t=new _StaticReports_StaticReportsViewModel__WEBPACK_IMPORTED_MODULE_33__.a;t.KPI_1(e,this),this.kpiList.push(t),this.kpiListSrc.push(this.kpiList[this.kpiList.length-1])})}this.LoadDynamicReportFromSP_CallBack(e)})}else if(299==this.StaticReportType){let t=this.GetCostCenterFilter(300,"C.CostCenterID"),s=[];s.push(this.FromDatePicker.Date),s.push(this.ToDatePicker.Date),s.push(this.StaticReportType),s.push(""),s.push(null),s.push(null),s.push(null),s.push(t),s.push(null),e=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetCommonReport(s)}}e&&e.then(e=>{this.LoadDynamicReportFromSP_CallBack(e)},e=>{})}LoadDynamicReportFromSP_CallBack(e){this.ClearRows();for(let s=this.totals.length-1;s>=0;s--)for(let e=this.totals[0].length-1;e>=0;e--)this.totals[s][e]=0;this.hiddenTotals=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.NumArray(this.HiddenNumericColumns.length,this.lstGroup.length+1);let t=null;if(null!=e&&e.Tables.length>0&&!e.Columns[0].Contains("ErrorMessage")&&e.Tables[0].length>0){if(this.ReportData=e.Tables[0],this.ReportDataColumns=e.Columns[0],this.ConstructFormulaFields(!0),this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.LoadDataOnly||null!=this.Chart)return;if(this.SNo=0,this.colSNoIndex=this.ReportColumns.indexOf(this.ReportColumns.find(e=>0==_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.stringCompare(e.Formula,"SNO",!0))),null!=this.MatrixObject&&(this.MatrixObject.MatrixRows.Items.length>0||this.MatrixObject.MatrixColumns.Items.length>0||this.MatrixObject.MatrixValues.Items.length>0))return void this.MatrixObject.LoadMatrixReport(e.Tables[0],e.Columns[0]);this.RenderData(e.Tables[0],e.Columns[0]),e.Tables[0].length>0&&(t=e.Tables[0][e.Tables[0].length-1])}for(let s=this.lstGroup.length;s>0;s--)null!=t&&this.AddSubtotals(t,this.lstGroup[s-1],s),this.Groupstr[this.lstGroup[s-1].ID]=null;if(this.GrpReportTotal.SubTotalAppearance.IsVisible&&(this.AddSubtotals_RT(this.GrpReportTotal,0),207==this.StaticReportType)){let e=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(this.ReportColumns.length),t=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.a;t.IsBold=!0,t.ForeColor="#FF000000",t.BackColor="White",t.FontFamilyName="Arial",t.FontSize=12,t.Alignment="Right",e.Cells[0].ColSpan=parseInt(this.ReportParams.SlabIndex),e.Cells[0].Text=" Closing balance",e.Cells[0].CellAppearance=t,e.Cells[0].DataFormat=this.GrpReportTotal.SubTotalFormat,e.Cells[0].IsNormal=!1,this.GrpReportTotal.SubTotalHeight>0&&(e.Cells[0].height=this.GrpReportTotal.SubTotalHeight);let s=this.totals[parseInt(this.ReportParams.TotalAmountIndex)][0];for(let o=parseInt(this.ReportParams.SlabIndex);o<this.ReportColumns.length;o++)s-=this.totals[o][0],ReportViewModel.SetCellValue(s,this.ReportColumns[o].DataFormat,"FLOAT",0,e.Cells[o]),e.Cells[o].CellAppearance=t,e.Cells[o].DataFormat=this.GrpReportTotal.SubTotalFormat,e.Cells[o].IsNormal=!1,this.GrpReportTotal.SubTotalHeight>0&&(e.Cells[o].height=this.GrpReportTotal.SubTotalHeight);this.addRow(e)}this.process_RunWorkerCompleted(null,null)}LoadAPIReportData(e,t){if(-1==this.StaticReportType&&this.Reportds.Tables.length>2&&this.Reportds.Tables[2].length>0){let o="",i="",l="",a="",n=null,r=null;for(let h=0;h<this.Reportds.Tables[2].length;h++)try{if(i="1"==this.Reportds.Tables[2][h].Format.toString()?"XML":"2"==this.Reportds.Tables[2][h].Format.toString()||"3"==this.Reportds.Tables[2][h].Format.toString()?"JSON":"",a="",o=this.Reportds.Tables[2][h].Params.toString(),!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(o)&&(n=o.split(","),n.length>0))for(let o=0;o<n.length-1;o++)if(r=n[o].split("~"),r.length>1)if(r.length>2&&"ARRAY"==r[2])for(let s=0;s<e.length;s++)a+=r[0]+"~",t.Contains(r[1])?a+=e[s][r[1]].toString():a+=r[1],a+=",";else a+=r[0]+"~",t.Contains(r[1])?a+=e[0][r[1]].toString():a+=r[1],a+=",";if(l="",o=this.Reportds.Tables[2][h].Body.toString(),!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(o)&&(n=o.split(","),n.length>0)){"JSON"==i&&("2"==this.Reportds.Tables[2][h].Format.toString()&&(l+="["),l+="{");for(let s=0;s<n.length-1;s++){if(r=n[s].split("~"),l+='"'+r[0]+'":',r.length>1)if(r.length>2&&"ARRAY"==r[2]){l+="[";for(let s=0;s<e.length;s++)l+='"',t.Contains(r[1])?l+=e[s][r[1]].toString():l+=r[1],l+='"',s!=e.length-1&&(l+=",");l+="]"}else l+='"',t.Contains(r[1])?l+=e[0][r[1]].toString():l+=r[1],l+='"';s!=n.length-2&&(l+=",")}"JSON"==i&&(l+="}","2"==this.Reportds.Tables[2][h].Format.toString()&&(l+="]"))}o="",o=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.common.InvokeWebAPI(this.Reportds.Tables[2][h].ActionType.toString(),this.Reportds.Tables[2][h].Url.toString(),a.toString(),this.Reportds.Tables[2][h].Headers.toString(),"",l.toString(),i,this.Reportds.Tables[2][h].Client.toString(),!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.Reportds.Tables[2][h].Audit.toString())&&"YES"==this.Reportds.Tables[2][h].Audit.toString(),50,this.ReportID,parseInt(this.Reportds.Tables[2][h].MapID.toString()));let s=o;_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(o)||(console.log("APIResponse "),console.log(s.Tables[0]),this.ReportData=s.Tables[0],this.ReportDataColumns=s.Columns[0])}catch(s){return!1}return!0}return!1}LoadDynamicReport(){Logger.DebugLog("ReportViewModel::LoadDynamicReport::Query :::: \r\n"+this.FinalQuery+"\r\n\r\n"),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPT022",this.IsReportDB,this.FinalQuery,this.ReportID.toString()).then(e=>{let t=e;if(null!=t&&t.Tables.length>0&&!t.Columns[0].Contains("ErrorMessage")&&(t.Tables[0].length>0||this.IsNoDataGroups||null!=this.LevelColumn)){if(this.LoadAPIReportData(t.Tables[0],t.Columns[0])||(this.ReportData=t.Tables[0],this.ReportDataColumns=t.Columns[0]),this.IsRevision){let e=this.ReportData,t=null,s=null,o=null;for(let i=e.length-1;i>=0;i--)t!=e[i].RevDocNo.toString()||s!=e[i].RevVersionNo.toString()?(t=e[i].RevDocNo.toString(),s=e[i].RevVersionNo.toString(),o=e[i].RevModDate.toString()):o!=e[i].RevModDate.toString()&&this.ReportData.Remove(e[i])}if(null!=this.earningfields&&this.earningfields.length>0){let e=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a;this.BaseReportColumns.forEach(t=>{this.earningfields.find(e=>e==t.CDGDO)&&(405==t.CDGDO.ColumnCostCenterID?t.CDGDO.Column.startsWith("dcNum")||t.CDGDO.Column.startsWith("dcCalcNum")||t.CDGDO.Column.startsWith("dcExchRT")?t.CDGDO.Column.startsWith("dcNum")?e.push(t.ID,"Earning"+t.CDGDO.Column.Replace("dcNum","")):t.CDGDO.Column.startsWith("dcCalcNum")?e.push(t.ID,"Earning"+t.CDGDO.Column.Replace("dcCalcNum","")):t.CDGDO.Column.startsWith("dcCalcNumFC")?e.push(t.ID,"EarEarning"+t.CDGDO.Column.Replace("dcCalcNumFC","")):e.push(t.ID,"Earning"+t.CDGDO.Column.Replace("dcExchRT","")):e.push("DATE"==t.CDGDO.DataType?t.ID+"_DATE":t.ID,t.CDGDO.Column):406==t.CDGDO.ColumnCostCenterID?(t.CDGDO.Column.startsWith("dcNum")||t.CDGDO.Column.startsWith("dcCalcNum")||t.CDGDO.Column.startsWith("dcExchRT"))&&(t.CDGDO.Column.startsWith("dcNum")?e.push(t.ID,"Deduction"+t.CDGDO.Column.Replace("dcNum","")):t.CDGDO.Column.startsWith("dcCalcNum")?e.push(t.ID,"Deduction"+t.CDGDO.Column.Replace("dcCalcNum","")):t.CDGDO.Column.startsWith("dcCalcNumFC")?e.push(t.ID,"EarDeduction"+t.CDGDO.Column.Replace("dcCalcNumFC","")):e.push(t.ID,"Deduction"+t.CDGDO.Column.Replace("dcExchRT",""))):410==t.CDGDO.ColumnCostCenterID&&e.push(t.ID,t.CDGDO.Column),this.ReportDataColumns.push(t.ID))});let s,o=null,i=null,l=null,a="";for(let t=0;t<this.ReportData.length;t++)a.length>0&&(a+=","),a+=this.ReportData[t].XEmpIDX;if(a.length>0){let e=new Date;if(null!=this.Filter)for(let t=0;t<this.Filter.Fields.length;t++){let s=this.Filter.Fields[t];"DATE"==s.CDGDO.DataType&&50051==s.CDGDO.CategoryValue&&-601==s.CDGDO.FieldValue&&(e=s.FromDatePicker.Date)}l=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetDataTable("RPT051",a,e.ToString("dd MMM yyyy"))}for(let n=0;n<t.Tables.length;n++)t.Columns[n].Contains("BasicMonthly")&&(i=t.Tables[n]);this.ReportData.forEach(t=>{s=i.filter(e=>e.EmployeeID==t.XEmpIDX),s.length>0&&e.keys.forEach(i=>{let a={Key:i,Value:e[i]};a.Key.Contains("_DATE")?t[a.Key.Replace("_DATE","")]=new Date(s[0][a.Value].toString()):null!=l&&l.length>0?(o=null,a.Value.Contains("Earning")||a.Value.Contains("dcAlpha")?o=l.filter(e=>e.EmployeeID==t.XEmpIDX.toString()&&11==e.VoucherType):a.Value.Contains("Deduction")&&(o=l.filter(e=>e.EmployeeID==t.XEmpIDX.toString()&&12==e.VoucherType)),null!=o&&o.length>0?t[a.Key]=a.Value.startsWith("EarEarning")?o[0]["dcCalcNum"+a.Value.Replace("EarEarning","")]:a.Value.startsWith("EarDeduction")?o[0]["dcCalcNum"+a.Value.Replace("EarDeduction","")]:a.Value.startsWith("Earning")?o[0]["dcNum"+a.Value.Replace("Earning","")]:a.Value.startsWith("Deduction")?o[0]["dcNum"+a.Value.Replace("Deduction","")]:a.Value.startsWith("dcAlpha")?o[0][a.Value]:s[0][a.Value]:a.Value.startsWith("EarEarning")||a.Value.startsWith("EarDeduction")||a.Value.startsWith("dcAlpha")||(t[a.Key]=s[0][a.Value])):a.Value.startsWith("EarEarning")||a.Value.startsWith("EarDeduction")||a.Value.startsWith("dcAlpha")||(t[a.Key]=s[0][a.Value])})})}if(null!=this.Vacationfields&&this.Vacationfields.length>0){let e=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a;this.BaseReportColumns.forEach(t=>{null!=this.Vacationfields.find(e=>e==t.CDGDO)&&(411==t.CDGDO.ColumnCostCenterID&&e.push(t.ID,t.CDGDO.Column),this.ReportDataColumns.push(t.ID))});let t="";for(let s=0;s<this.ReportData.length;s++)t.length>0&&(t+=","),t+=this.ReportData[s].XEmpIDX;if(t.length>0){let s=new Date;if(null!=this.Filter){let e;for(let t=0;t<this.Filter.Fields.length;t++)"DATE"==e.CDGDO.DataType&&50051==e.CDGDO.CategoryValue&&-601==e.CDGDO.FieldValue&&(s=e.FromDatePicker.Date)}let o="'"+s.ToString("dd MMM yyyy")+"','"+t+"',2,1,1",i=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.DataSet("RPT116",o);this.ReportData.forEach(t=>{let s=i.Tables[0].filter(e=>e.EmployeeID==t.XEmpIDX);if(s.length>0)for(const o in e)"keys"!=o&&"values"!=o&&(t[o]=s[0][e[o]])})}}var s=this.BaseReportColumns.find(e=>-602==e.CDGDO.FieldValue);if(null!=s&&this.ReportDataColumns.Contains(s.ID)){let e=0;this.ReportData.forEach(t=>{e=0;let o=t[s.ID].toString().Trim().split(";");if(o.length>0)for(let s=0;s<o.length;s++)""!=o[s].toString().Trim()&&(e+=parseFloat(o[s]));t[s.ID]=e})}var o=this.BaseReportColumns.find(e=>400==e.CDGDO.CategoryValue&&202==e.CDGDO.FieldValue);if(null!=o&&this.ReportDataColumns.Contains(o.ID)){let e,t,s,i="N"+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.DecimalsinAmount;this.ReportData.forEach(l=>{if(null!=l[o.ID]&&l[o.ID].toString().length>0){s="",e=l[o.ID].toString().split(",");for(let o=0;o<e.length;o++)t=e[o].split("~"),3==t.length&&(s.length>0&&(s+=", "),s+="["+t[0]+", "+new Date(t[1]).ToString(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Date Format"])+", "+parseFloat(t[2]).ToString(i)+"]");l[o.ID]=s}})}if(this.IsBudgetFound&&this.UpdateBudgetUtilized(),this.IsAuthLevelReport&&this.UpdateLevelFields(t),this.CheckAndAddStockBalances(),this.ReportNoDataGroups=this.IsNoDataGroups?t.Tables[t.Tables.length-1]:null,this.ConstructFormulaFields(!0),this.IsKANBAN?this.CheckAndUpdateKANBAN(this.ReportData):this.CheckAndUpdateRepeatData(this.ReportData,this.ReportDataColumns),null!=this.LevelColumn&&(this.IsTreeDataCalculated=!1,this.RepeatType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.None?(this.ReportTransactionData=this.ReportData,this.ReportTransactionDataColumns=this.ReportDataColumns,this.ReportData=t.Tables[1],this.ReportDataColumns=t.Columns[1]):(this.ReportData=t.Tables[1],this.ReportDataColumns=t.Columns[1],this.ReportTransactionData=t.Tables[0],this.ReportTransactionDataColumns=t.Columns[0]),this.LevelSubGroup.length>0)){this.ReportDataColumns.Contains(this.LevelSubGroup)||this.ReportDataColumns.push(this.LevelSubGroup);let e=this.ReportTransactionData.ToTable(!0,["TreeNodeID",this.LevelSubGroup]);for(let t=0;t<this.ReportData.length;t++){if(Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(this.ReportData[t].IsGroup))continue;this.ReportData[t].IsGroup=!0;let s=e.filter(e=>e.TreeNodeID==this.ReportData[t].TreeNodeID);if(s.length>0){let e=parseInt(this.ReportData[t].Depth);for(let o=0;o<s.length;o++){let i={};i.TreeNodeID=this.ReportData[t].TreeNodeID,i.IsGroup=!1,i.Depth=e+1,i.ParentID=this.ReportData[t].TreeNodeID,i[this.LevelSubGroup]=s[o][this.LevelSubGroup],i[this.LevelColumn.ID]=s[o][this.LevelSubGroup],this.ReportData.InsertAt(i,t+1),t++}}}}if((this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.LoadDataOnly||null!=this.Chart)&&0==this.lstGroup.filter(e=>"Summary"==e.DisplayMode).length&&"KPIViewViewModel"!=this.Chart.ClassName)return;if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.ReportData)||(this.TotalRowCount=this.ReportData.length),this.RecordCount=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Displaying")+" "+this.TotalRowCount.toString()+" "+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Rows"),null!=this.ReportColumns&&(this.totals=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.NumArray(this.ReportColumns.length,this.lstGroup.length+1),this.hiddenTotals=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.NumArray(this.HiddenNumericColumns.length,this.lstGroup.length+1)),this.SNo=0,this.colSNoIndex=this.ReportColumns.indexOf(this.ReportColumns.find(e=>0==_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.stringCompare(e.Formula,"SNO",!0))),null!=this.MatrixObject&&(this.MatrixObject.MatrixRows.Items.length>0||this.MatrixObject.MatrixColumns.Items.length>0||this.MatrixObject.MatrixValues.Items.length>0))return void this.MatrixObject.LoadMatrixReport(this.ReportData,this.ReportDataColumns);if(this.RenderData(this.ReportData,this.ReportDataColumns),null!=this.LevelColumn){if(this.UpdateTreeTotals(0),this.GrpReportTotal.SubTotalAppearance.IsVisible&&this.lstTotal.length>0){this.totals=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.NumArray(this.lstTotal[0].length,1);for(let e=0;e<this.lstTotal[0].length;e++)this.totals[e][0]=this.lstTotal[0][e];this.AddSubtotals_RT(this.GrpReportTotal,0)}}else this.CheckAndAddTotals(this.ReportData)}else null!=t&&t.Tables.Count>0&&!t.Tables[0].Columns.Contains("ErrorMessage")&&(this.LoadAPIReportData(t.Tables[0],t.Columns[0])||(this.ReportData=t.Tables[0],this.ReportDataColumns=t.Columns[0])),null!=this.ReportColumns&&(this.totals=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.NumArray(this.ReportColumns.length,this.lstGroup.length+1),this.hiddenTotals=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.NumArray(this.HiddenNumericColumns.length,this.lstGroup.length+1)),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.ReportData)&&(this.ReportData=[])},e=>{}).then(e=>{this.process_RunWorkerCompleted(null,null)})}ConstructFormulaFields(IncludeEvaluation){let ExcludeFormulaKeywords=["LATEST","OLDEST","H","$TOTALHOURS$"];this.eval=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.b,this.eval.ThrowException=!1,this.eval.SetKeyWords("REPORT"),this.fldDict=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a;let fldObj=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c;if(Object(util__WEBPACK_IMPORTED_MODULE_24__.isNullOrUndefined)(this.ReportData)?this.ColumnSourceALL.forEach(e=>{this.fldDict.ContainsKey(e.ID)||(fldObj=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c,fldObj.setFieldDetails(e.ID,3,1,"",0,!1,!1),this.fldDict.push(e.ID,fldObj))}):(this.ReportDataColumns.forEach(e=>{this.fldDict.ContainsKey(e)||(fldObj=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c,fldObj.setFieldDetails(e,3,1,"",0,!1,!1),this.fldDict.push(e,fldObj))}),null==this.ParentReport?this.ReportColumns.forEach(e=>{this.fldDict.ContainsKey(e.ID)||(fldObj=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c,fldObj.setFieldDetails(e.ID,3,1,"",0,!1,!1),this.fldDict.push(e.ID,fldObj))}):this.ColumnSourceALL.forEach(e=>{this.fldDict.ContainsKey(e.ID)||(fldObj=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c,fldObj.setFieldDetails(e.ID,3,1,"",0,!1,!1),this.fldDict.push(e.ID,fldObj))})),this.lstGroup.forEach(e=>{this.fldDict.ContainsKey(e.ID)||(fldObj=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c,fldObj.setFieldDetails(e.ID,3,1,"",0,!1,!1),this.fldDict.push(e.ID,fldObj))}),this.PercentColumnExists=!1,this.ReportColumns.forEach(e=>{"REPORT_TOTAL"==e.DataFormat.PercentageOn||"SUB_TOTAL"==e.DataFormat.PercentageOn?this.PercentColumnExists=!0:_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.DataFormat.PercentageOn)||0==this.ReportColumns.filter(t=>t.ID==e.DataFormat.PercentageOn).length&&0==this.HiddenNumericColumns.filter(t=>t.ID==e.DataFormat.PercentageOn).length&&(e.DataFormat.PercentageOn="")}),this.IsAvgRateExists&&null!=this.ReportData){var avgcol=this.BaseReportColumns.find(e=>11511==e.CDGDO.FieldValue),OpQtycol=this.BaseReportColumns.find(e=>11512==e.CDGDO.FieldValue),OpValuecol=this.BaseReportColumns.find(e=>11513==e.CDGDO.FieldValue),OpStockcol=this.BaseReportColumns.find(e=>11512==e.CDGDO.FieldValue||11513==e.CDGDO.FieldValue);if(null!=avgcol||null!=OpStockcol){let e="",t="",s,o=new Array,i;s=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Maintain Dimensionwise AverageRate"]),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise AverageRate")&&s>5e4&&o.push(parseInt(s)),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.EnableLocationWise)&&_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("Location AverageRate")&&Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Location AverageRate"])&&o.push(50002),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.EnableDivisionWise)&&_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("Division AverageRate")&&Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Division AverageRate"])&&o.push(50001),s=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Maintain Dimensionwise stock"]),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&s>5e4&&o.push(parseInt(s)),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.EnableLocationWise)&&_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("Location Stock")&&Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Location Stock"])&&o.push(50002),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.EnableDivisionWise)&&_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("Division Stock")&&Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Division Stock"])&&o.push(50001),o.forEach(e=>{let s=_StaticReports_StaticReportsViewModel__WEBPACK_IMPORTED_MODULE_33__.b.GetFilterByDimension_3(e,this.Filter.CostCenterFilters);s.length>0&&(t+=" AND DCC.dcCCNID"+(e-5e4),s.Contains(",")?t+=" IN ("+s+")":t+="="+s)});let l=[],a=0,n=0,r,h=[];h.AddRange(this.ReportData),h.sort((e,t)=>e.AvgRateOpStkDate>t.AvgRateOpStkDate?1:-1);let u=[];for(u.push(""),u.push(0),u.push(t),u.push(!1),u.push(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.UserID),u.push(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LanguageID),a=0;a<h.length;){for(n=a,r=0,l.Clear(),e="";a<h.length&&50!=r;a++)i=h[a].AvgRateOpStkPID+"~"+h[a].AvgRateOpStkDate,l.Contains(i)||(r>0&&(e+=","),e+=i,l.push(i),r++);if(u[0]=e.toString(),null!=avgcol){let e;u[1]=0;for(let t=n;t<a;t++){i=h[t].AvgRateOpStkPID+"~"+h[t].AvgRateOpStkDate;let s=e.Tables[0].filter(e=>e.Product==i);s.length>0&&(h[t][avgcol.ID]=s[0].AvgRate)}}if(null!=OpStockcol){let e;u[1]=1;for(let t=n;t<a;t++){i=h[t].AvgRateOpStkPID+"~"+h[t].AvgRateOpStkDate;let s=e.Tables[0].filter(e=>e.Product==i);s.length>0&&(null!=OpQtycol&&(h[t][OpQtycol.ID]=s[0].BalQty),null!=OpValuecol&&(h[t][OpValuecol.ID]=s[0].BalValue))}}}}}this.FormulaColumns.Clear(),this.ColumnFilters.Clear();for(let e=0;e<this.ColumnSourceALL.length;e++)_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.ColumnSourceALL[e].Formula)||ExcludeFormulaKeywords.Contains(this.ColumnSourceALL[e].Formula)||this.ColumnSourceALL[e].Formula.startsWith("LEVEL")||this.ColumnSourceALL[e].Formula.startsWith("SNO")||(this.FormulaColumns.push(this.ColumnSourceALL[e]),null==this.ReportData||this.ReportDataColumns.Contains(this.ColumnSourceALL[e].ID)||(this.ReportDataColumns.push(this.ColumnSourceALL[e].ID),this.fldDict.ContainsKey(this.ColumnSourceALL[e].ID)||(fldObj=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c,fldObj.setFieldDetails(this.ColumnSourceALL[e].ID,3,1,"",0,!1,!1),this.fldDict.push(this.ColumnSourceALL[e].ID,fldObj)))),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.ColumnSourceALL[e].ColumnFilterExpression)||(this.FormulaColumns.Contains(this.ColumnSourceALL[e])||this.FormulaColumns.push(this.ColumnSourceALL[e]),null==this.ReportData||this.ReportDataColumns.Contains("COLFILTER"+this.ColumnSourceALL[e].ID)||this.ReportDataColumns.push("COLFILTER"+this.ColumnSourceALL[e].ID)),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.ColumnSourceALL[e].ColumnFilters)||this.ColumnFilters.Contains(this.ColumnSourceALL[e])||this.ColumnFilters.push(this.ColumnSourceALL[e]),-1==this.ColumnSourceALL[e].UseOnce&&"FLOAT"==this.ColumnSourceALL[e].ColumnType&&(null==this.ReportData||this.ReportDataColumns.Contains("DISTINCT"+this.ColumnSourceALL[e].ID)||this.ReportDataColumns.push("DISTINCT"+this.ColumnSourceALL[e].ID)),-1==this.ColumnSourceALL[e].UseOnce&&"FLOAT"==this.ColumnSourceALL[e].ColumnType&&(null==this.ReportData||this.ReportDataColumns.Contains("DISTINCT"+this.ColumnSourceALL[e].ID)||this.ReportDataColumns.push("DISTINCT"+this.ColumnSourceALL[e].ID)),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.ColumnSourceALL[e].DataFormat.PrevRowValue)||null==this.ReportData||this.ReportDataColumns.Contains(this.ColumnSourceALL[e].ID)||this.ReportDataColumns.push(this.ColumnSourceALL[e].ID);if(null!=this.ReportData)for(let e=0;e<this.lstGroup.length;e++)_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.lstGroup[e].Formula)||(this.ReportDataColumns.Contains(this.lstGroup[e].ID)||this.ReportDataColumns.push(this.lstGroup[e].ID),0==this.FormulaColumns.filter(t=>t.ID==this.lstGroup[e].ID).length&&this.FormulaColumns.push(this.lstGroup[e]));if(fldObj=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("FROMDATE",""),this.fldDict.push("FROMDATE",fldObj),fldObj=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("TODATE",""),this.fldDict.push("TODATE",fldObj),fldObj=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("SYSTEMDATE",""),this.fldDict.push("SYSTEMDATE",fldObj),fldObj=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("SYSTEMDATETIME",""),this.fldDict.push("SYSTEMDATETIME",fldObj),fldObj=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("CURRENT_YEARSTART",""),this.fldDict.push("CURRENT_YEARSTART",fldObj),this.fldDict.push("PRV_YEARSTART",new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("PRV_YEARSTART","")),this.fldDict.push("PRV_YEARFROMDATE",new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("PRV_YEARFROMDATE","")),this.fldDict.push("PRV_YEARTODATE",new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("PRV_YEARTODATE","")),this.fldDict.push("CURRENT_MONTHSTART",new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("CURRENT_MONTHSTART","")),this.fldDict.push("PRV_MONTHSTART",new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("PRV_MONTHSTART","")),this.fldDict.push("PRV_MONTHEND",new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("PRV_MONTHEND","")),fldObj=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("LOGIN_USER",""),this.fldDict.push("LOGIN_USER",fldObj),IncludeEvaluation){if(this.FormulasCalculated=!0,this.IsBudgetNewFound&&(this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Monthly||this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Quaterly||this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.HalfYearly||this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Yearly)){let e,t=new Date(this.ReportDataDataSet.Tables[1][0].StartDate),s=new Array;this.ReportDataDataSet.Tables[1].forEach(e=>{s.push(parseInt(e.CostCenterID))});var obj=this.BaseReportColumns.find(e=>11406==e.CDGDO.FieldValue),objRate=this.BaseReportColumns.find(e=>11408==e.CDGDO.FieldValue),objExtra=this.BaseReportColumns.filter(e=>e.CDGDO.FieldValue>=11485&&e.CDGDO.FieldValue<=11489);if(objExtra.forEach(e=>{11485==e.CDGDO.FieldValue?e.CDGDO.Column="dcNumField1":11486==e.CDGDO.FieldValue?e.CDGDO.Column="dcNumField2":11487==e.CDGDO.FieldValue?e.CDGDO.Column="dcNumField3":11488==e.CDGDO.FieldValue?e.CDGDO.Column="dcNumField4":11489==e.CDGDO.FieldValue&&(e.CDGDO.Column="dcNumField5")}),null!=obj){obj=this.BaseReportColumns.find(e=>11406==e.CDGDO.FieldValue&&"0"!=e.RepeatType.SelectedValue);var objBudgetAmount=this.BaseReportColumns.find(e=>11406==e.CDGDO.FieldValue&&"0"==e.RepeatType.SelectedValue);null!=objBudgetAmount&&null!=obj&&objBudgetAmount.ID==obj.ID&&(objBudgetAmount=null),this.ReportDataDataSet.Tables[2].forEach(o=>{let i=this.ReportData;for(let e=0;e<s.length;e++)i=i.filter(2==s[e]?e=>e.BUD_2==o.AccountID:3==s[e]?e=>e.BUD_3==o.ProductID:t=>t["BUD_"+s[e]]==o["CCNID"+(s[e]-5e4)]);if(i.length>0&&(null!=objRate&&i.forEach(e=>{e[objRate.ID]=o.Rate}),objExtra.length>0&&objExtra.forEach(e=>{i[0][e.ID]=o[e.CDGDO.Column]}),null!=objBudgetAmount&&(i[0][objBudgetAmount.ID]=o.AnnualAmount),null!=obj))if(this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Monthly){e=t;for(let t=1;t<=12;t++){let s=i.filter(t=>t[this.RepeatOn]>=e&&t[this.RepeatOn]<e.AddMonths(1));s.length>0&&(s[0][obj.ID]=o["Month"+t+"Amount"]),e=e.AddMonths(1)}}else if(this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Quaterly){e=t;for(let t=1;t<=4;t++){let s=i.filter(t=>t[this.RepeatOn]>=e&&t[this.RepeatOn]<e.AddMonths(3));s.length>0&&(s[0][obj.ID]=o["Qtr"+t+"Amount"]),e=e.AddMonths(3)}}else if(this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.HalfYearly){e=t;for(let t=1;t<=2;t++){let s=i.filter(t=>t[this.RepeatOn]>=e&&t[this.RepeatOn]<e.AddMonths(6));s.length>0&&(s[0][obj.ID]=o["YearH"+t+"Amount"]),e=e.AddMonths(6)}}else this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Yearly&&i.length>0&&(i[0][obj.ID]=o.AnnualAmount)})}}if(null!=this.ReportNoDataGroups){let e=0;this.lstGroup.length>1&&"Summary"==this.lstGroup[1].DisplayMode&&(e=1);let t=this.lstGroup[0].ID+"_ID";this.ReportNoDataGroups.forEach(s=>{if(0==this.ReportData.filter(this.lstGroup[e].ID=s[0].toString().Replace("'","''")).length){let o={};o[this.lstGroup[e].ID]=s[0].toString(),Object(util__WEBPACK_IMPORTED_MODULE_24__.isUndefined)(s[t])||(o[t]=s[t].toString()),1==e&&this.ReportData.length>0&&(o[this.lstGroup[0].ID]=this.ReportData[this.ReportData.length-1][this.lstGroup[0].ID].ToString()),this.ReportData.push(o)}})}if(this.ColumnFilters.length>0)for(let p=0;p<this.ColumnFilters.length;p++){let c=this.ColumnFilters[p];if(this.ReportDataColumns.Contains(c.ID))try{let strFilter=c.ColumnFilters,ind=0,endInd;do{if(ind=strFilter.indexOf("@XTODATEX_",ind),ind>=0){endInd=strFilter.indexOf("@",ind+10);let e=parseInt(strFilter.substr(ind+10,endInd-(ind+10)));strFilter=strFilter.Remove(ind,endInd+1-ind),strFilter=strFilter.Insert(ind,this.ToDatePicker.Date.AddDays(-e).ToString("dd MMM yyyy"))}}while(-1!=ind);if(strFilter=strFilter.Replace("@TODATE@",this.ToDatePicker.Date.ToString("dd MMM yyyy")),strFilter=strFilter.Replace("@FROMDATE@",this.FromDatePicker.Date.ToString("dd MMM yyyy")),strFilter.Contains("CURRENT_YEARSTART")&&(strFilter=strFilter.Replace("CURRENT_YEARSTART",this.Current_YearStartDate.ToString("dd MMM yyyy"))),strFilter.Contains("PRV_YEARSTART")&&(strFilter=strFilter.Replace("PRV_YEARSTART",this.PRV_YEARSTART.ToString("dd MMM yyyy"))),strFilter.Contains("PRV_YEARFROMDATE")&&(strFilter=strFilter.Replace("PRV_YEARFROMDATE",this.PRV_YEARFROMDATE.ToString("dd MMM yyyy"))),strFilter.Contains("PRV_YEARTODATE")&&(strFilter=strFilter.Replace("PRV_YEARTODATE",this.PRV_YEARTODATE.ToString("dd MMM yyyy"))),strFilter.Contains("CURRENT_MONTHSTART")&&(strFilter=strFilter.Replace("CURRENT_MONTHSTART",this.CURRENT_MONTHSTART.ToString("dd MMM yyyy"))),strFilter.Contains("PRV_MONTHSTART")&&(strFilter=strFilter.Replace("PRV_MONTHSTART",this.PRV_MONTHSTART.ToString("dd MMM yyyy"))),strFilter.Contains("PRV_MONTHEND")&&(strFilter=strFilter.Replace("PRV_MONTHEND",this.PRV_MONTHEND.ToString("dd MMM yyyy"))),strFilter.length>0){let drr=this.ReportData.filter(eval("x=>"+strFilter));drr.map(e=>e[c.ID]=null)}}catch(exf){Logger.ErrorLog("Column Filters Error",exf)}}if(this.FormulaColumns.length>0){for(let e=this.ReportData.length-1;e>=0;e--)for(let t=0;t<this.FormulaColumns.length;t++){let s=this.FormulaColumns[t];if(this.CalculateFormula_2(s,this.ReportData[e])){this.ReportData.RemoveAt(e);break}}if(this.ReportGroups.filter(e=>0==_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.FormulaExpression)).length>0){let e=[],t=!1;this.ReportGroups.forEach(s=>{t=!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(s.Sort.SelectedValue)&&("DESC"==s.Sort.SelectedValue||s.Sort.SelectedValue.startsWith("DESC")),s.Sort.SelectedValue.startsWith("NUM")?e.push({name:s.ID,parser:parseFloat,desc:t}):0==this.StaticReportType&&"VoucherNo"==s.CDGDO.Column&&0==s.CDGDO.IsForeignKey?(e.push({name:s.ID+"Abr",desc:t}),e.push({name:s.ID+"prf",desc:t}),e.push({name:s.ID+"dno",desc:t})):_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(s.FormulaExpression)?e.push({name:s.ID,desc:t}):e.push({name:this.GetSortColumnForFormula(s),desc:t})}),this.BaseReportColumns.forEach(s=>{if(!s.IsGroup&&!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(s.Sort.SelectedValue))if(t=!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(s.Sort.SelectedValue)&&("DESC"==s.Sort.SelectedValue||s.Sort.SelectedValue.startsWith("DESC")),s.Sort.SelectedValue.startsWith("NUM"))e.push({name:s.ID,parser:parseFloat,desc:t});else if(0==this.StaticReportType&&"VoucherNo"==s.CDGDO.Column&&0==s.CDGDO.IsForeignKey&&""!=s.Sort.SelectedValue)e.push({name:s.ID+"Abr",desc:t}),e.push({name:s.ID+"prf",desc:t}),e.push({name:s.ID+"dno",desc:t});else{let o=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(s.FormulaExpression)?s.ID:this.GetSortColumnForFormula(s);this.ReportDataColumns.Contains(o)&&e.push({name:o,desc:t})}}),e.length>0&&this.ReportData.SortBy(e)}}}}Clear(){this.ClearRows()}UpdateBudgetUtilized(){let e,t=0,s="",o=this.ReportData.ToTable(!0,["BudgetDefID"]),i=[],l=[],a=[],n=[],r=[],h=[],u=[],D=[],d=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.c,c=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.c;this.BaseReportColumns.filter(e=>11342==e.CDGDO.FieldValue).forEach(e=>{i.push(e.ID)}),this.BaseReportColumns.filter(e=>11343==e.CDGDO.FieldValue).forEach(e=>{l.push(e.ID)}),this.BaseReportColumns.filter(e=>11344==e.CDGDO.FieldValue).forEach(e=>{a.push(e.ID)}),this.BaseReportColumns.filter(e=>11345==e.CDGDO.FieldValue).forEach(e=>{n.push(e.ID)}),this.BaseReportColumns.filter(e=>11346==e.CDGDO.FieldValue).forEach(e=>{r.push(e.ID)}),this.BaseReportColumns.filter(e=>11347==e.CDGDO.FieldValue).forEach(e=>{h.push(e.ID)}),this.BaseReportColumns.filter(e=>11348==e.CDGDO.FieldValue).forEach(e=>{u.push(e.ID)});for(let p=11349,T=1;p<=11360;p++,T++)(C=this.BaseReportColumns.filter(e=>e.CDGDO.FieldValue==p)).length>0&&d.push(T,C[0].ID);this.BaseReportColumns.filter(e=>11617==e.CDGDO.FieldValue).forEach(e=>{D.push(e.ID)});for(let p=11618,T=1;p<=11629;p++,T++){var C;(C=this.BaseReportColumns.filter(e=>e.CDGDO.FieldValue==p)).length>0&&c.push(T,C[0].ID)}for(let p=0;p<o.length;p++){e=parseInt(o[p].BudgetDefID);let C=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetBudgetUtilized(e,this.IsReportDB);if(null!=C&&C.Tables.length>1&&C.Columns[1].Contains("BudgetAllocID")){C.Columns[1].push("Month");let o,p,T,_=this.ReportData.filter(t=>t.BudgetDefID==e),m=new Date(C.Tables[0][0].WEF);for(let e=0;e<_.length;e++){let I=_[e];if(o=p=C.Tables[1].filter(e=>e.BudgetAllocID==I.BudgetAllocID),o.length>0){if(o.forEach(e=>{e.Month=new Date(parseInt(e.YYYY),parseInt(e.MM),1)}),i.length>0&&(t=this.GetBudgetTotal(o),i.forEach(e=>{I[e]=t})),l.length>0&&(T=m.AddMonths(6),o=p.filter(e=>e.Month<T),t=this.GetBudgetTotal(o),l.forEach(e=>{I[e]=t})),a.length>0&&(T=m.AddMonths(6),o=p.filter(e=>e.Month>=T),t=this.GetBudgetTotal(o),a.forEach(e=>{I[e]=t})),n.length>0&&(T=m.AddMonths(3),o=p.filter(e=>e.Month<T),t=this.GetBudgetTotal(o),n.forEach(e=>{I[e]=t})),r.length>0&&(T=m.AddMonths(3),o=p.filter(e=>e.Month>=T&&e.Month<T.AddMonths(3)),t=this.GetBudgetTotal(o),r.forEach(e=>{I[e]=t})),h.length>0&&(T=m.AddMonths(6),o=p.filter(e=>e.Month>=T&&e.Month<T.AddMonths(3)),t=this.GetBudgetTotal(o),h.forEach(e=>{I[e]=t})),u.length>0&&(T=m.AddMonths(9),o=p.filter(e=>e.Month>=T.AddMonths(3)),t=this.GetBudgetTotal(o),u.forEach(e=>{I[e]=t})),d.length>0){T=m;for(let e=1;e<=12;e++)d.ContainsKey(e)&&(o=p.filter(e=>e.Month>=T&&e.Month<T.AddMonths(1)),I[d[e]]=this.GetBudgetTotal(o)),T=T.AddMonths(1)}if(C.Columns[1].Contains("BudgetTransfer0")){if(i.length>0){o=p;for(let e=0;e<=4;e++)s="BudgetTransfer"+e,C.Columns[1].Contains(s)&&(t=this.GetBudgetTotal(o,s),this.ReportDataColumns.Contains(s)||this.ReportDataColumns.push(s),I[s]=t)}if(d.length>0){T=m;for(let e=1;e<=12;e++){if(d.ContainsKey(e)){o=p.filter(e=>e.Month>=T&&e.Month<T.AddMonths(1));for(let i=0;i<=4;i++)s="BudgetTransfer"+i,C.Columns[1].Contains(s)&&(t=this.GetBudgetTotal(o,s),s="M"+e+s,this.ReportDataColumns.Contains(s)||this.ReportDataColumns.push(s),I[s]=t)}T=T.AddMonths(1)}}}if(C.Columns[1].Contains("NonAccBalance")){if(D.length>0){o=p,t=this.GetBudgetTotal(o,"NonAccBalance"),D.forEach(e=>{I[e]=t});for(let e=1;e<=2;e++)s="D"+e+"NonAccBalance",C.Columns[1].Contains(s)&&(t=this.GetBudgetTotal(o,s),this.ReportDataColumns.Contains(s)||this.ReportDataColumns.push(s),I[s]=t)}if(c.length>0){T=m;for(let e=1;e<=12;e++){if(c.ContainsKey(e)){o=p.filter(e=>e.Month>=T&&e.Month<T.AddMonths(1)),I[c[e]]=this.GetBudgetTotal(o,"NonAccBalance");for(let i=1;i<=2;i++)s="D"+i+"NonAccBalance",C.Columns[1].Contains(s)&&(t=this.GetBudgetTotal(o,s),s="M"+e+s,this.ReportDataColumns.Contains(s)||this.ReportDataColumns.push(s),I[s]=t)}T=T.AddMonths(1)}}}}}}}}GetBudgetTotal(e,t="Balance"){let s=0;return e.forEach(e=>{s+=parseFloat(e[t])}),s}CheckAndAddStockBalances(){if(this.IsOpeningStockExists||this.IsClosingStockExists){let e=null,t=null,s="",o="";for(let l=0;l<this.Filter.CostCenterFilters.length;l++){let e=this.Filter.CostCenterFilters[l];if(e.SelectedNodes.length>0||!e.DeleteButtonVisibility)if(3==e.CostCenterID)for(let t=0;t<e.SelectedNodes.length;t++)t>0&&(s+=","),s+=e.SelectedNodes[t].Id;else if(50002==e.CostCenterID)if(o+=" AND ",1==e.SelectedNodes.length)o+="DCC.DCCCNID2="+e.SelectedNodes[0].Id;else{o+="DCC.DCCCNID2 IN (";for(let t=0;t<e.SelectedNodes.length;t++)t>0&&(o+=","),o+=e.SelectedNodes[t].Id;0==e.SelectedNodes.length&&(o+="-123"),o+=")"}}let i=[];i.push(1),i.push(s.toString()),i.push(o.toString()),i.push(this.FromDatePicker.Date),i.push(this.ToDatePicker.Date),i.push(0),this.IsOpeningStockExists&&(e=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetStockOpeingClosing(i,this.IsReportDB)),this.IsClosingStockExists&&(i[0]=0,t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetStockOpeingClosing(i,this.IsReportDB)),this.BaseReportColumns.forEach(s=>{11371==s.CDGDO.FieldValue?this.ReportDataColumns.Contains(s.ID)&&this.ReportData.forEach(t=>{t[s.ID]=e[0].Qty}):11372==s.CDGDO.FieldValue?this.ReportDataColumns.Contains(s.ID)&&this.ReportData.forEach(t=>{t[s.ID]=e[0].Value}):11373==s.CDGDO.FieldValue?this.ReportDataColumns.Contains(s.ID)&&this.ReportData.forEach(e=>{e[s.ID]=t[0].Qty}):11374==s.CDGDO.FieldValue&&this.ReportDataColumns.Contains(s.ID)&&this.ReportData.forEach(e=>{e[s.ID]=t[0].Value})})}}GetDimensionFilter_Str(e){let t="";for(let s=0;s<this.oReportDialog.CostCenterFilters.length;s++){let o=this.oReportDialog.CostCenterFilters[s];if((o.SelectedNodes.length>0||!o.DeleteButtonVisibility)&&o.CostCenterID>5e4)if(o.SelectedNodes.length>0)if(t+=" AND ",1==o.SelectedNodes.length)t+=e+(o.CostCenterID-5e4)+"="+o.SelectedNodes[0].Id;else{t+=e+(o.CostCenterID-5e4)+" IN (";for(let e=0;e<o.SelectedNodes.length;e++)e>0&&(t+=","),t+=o.SelectedNodes[e].Id;t+=")"}else t+=" AND ",t+=e+(o.CostCenterID-5e4)+"=-12912"}return t}GetCostCenterFilter(e,t){let s="",o=this.oReportDialog.CostCenterFilters.find(t=>t.CostCenterID==e);if(!o)return"";if(o.SelectedNodes.length>0||!o.DeleteButtonVisibility)if(o.SelectedNodes.length>0)if(s+=" AND ",1==o.SelectedNodes.length)s+=t+"="+o.SelectedNodes[0].Id;else{s+=t+" IN (";for(let e=0;e<o.SelectedNodes.length;e++)e>0&&(s+=","),s+=o.SelectedNodes[e].Id;s+=")"}else s+=" AND ",s+=t+"=-12912";return s.toString()}GetSortColumnForFormula(e){let t=!1,s="",o=[];this.evalFormula||(this.evalFormula=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.a,this.evalFormula.SetKeyWords("REPORT")),this.evalFormula.ParseFormula(e.FormulaExpression,o);for(let i=0;i<o.length;i++){let e=o[i];if(t){if(e.getTokenType()==_services_formula_service__WEBPACK_IMPORTED_MODULE_2__.e.REFERENCE&&this.ReportDataColumns.Contains(e.getTokenValue().toString())){s=e.getTokenValue().toString();break}}else e.getTokenType()==_services_formula_service__WEBPACK_IMPORTED_MODULE_2__.e.KEYWORD&&"DATENAME"==e.getTokenName()&&(t=!0)}return""!=s?s:e.ID}UpdateLevelFields(e){let t,s=0,o=0,i=[],l=[];for(let a=0;a<this.ColumnSourceALL.length;a++)if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.ColumnSourceALL[a].Formula)&&this.ColumnSourceALL[a].Formula.startsWith("LEVEL")){let e=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(this.ColumnSourceALL[a].Formula.substr(5));_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNum(this.ColumnSourceALL[a].Formula.substr(5))&&(l.push(e),i.push(this.ColumnSourceALL[a].ID),this.ReportDataColumns.push(this.ColumnSourceALL[a].ID))}for(let a=this.ReportData.length-1;a>=0;a--)if(t=e.Tables[1].filter(e=>e.WorkFlowID==this.ReportData[a].WorkFlowID),t.length>0){s=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(this.ReportData[a].WorkFlowLevel),o=parseInt(t[0].Levels);for(let e=0;e<i.length;e++)l[e]<=s?this.ReportData[a][i[e]]="YES":l[e]<=o&&(this.ReportData[a][i[e]]="NO")}}CheckAndUpdateRepeatData(e,t){if(this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.None)return;let s,o,i,l=null;this.dtRepeatColumns=[];let a=e.Copy();this.dtTempColumnsRepeat=t.Copy();let n=[...a],r=new Array;this.lstRepeatSummaryAplha.Clear();var h=this.BaseReportColumns.find(e=>e.ID==this.RepeatOn);if(this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Daily||this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Dimension||(this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Monthly?(this.dtTempColumnsRepeat.push("RPTYR"),this.dtTempColumnsRepeat.push("RPTMN"),a.forEach(e=>{if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e[this.RepeatOn]))e.RPTYR=0,e.RPTMN=0;else{let t=new Date(e[this.RepeatOn]);e.RPTYR=t.getFullYear(),e.RPTMN=t.getMonth()}})):this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Hourly12||this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Hourly24?(this.dtTempColumnsRepeat.push("RPTHr"),a.forEach(e=>{if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e[this.RepeatOn]))e.RPTHr=0;else{let t=new Date(e[this.RepeatOn]);e.RPTHr=t.getHours()}})):this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Yearly&&(this.dtTempColumnsRepeat.push("RPTYR"),a.forEach(e=>{let t=new Date(e[this.RepeatOn]);e.RPTYR=t.getFullYear()}))),(this.RepeatShowPrevMn||this.PrevDateColumsUsed)&&(n=a.filter(e=>e[this.RepeatOn].ToServerDate()>=this.FromDatePicker.Date&&e[this.RepeatOn].ToServerDate()<=this.ToDatePicker.Date)),this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Dimension){let e=this.RepeatOn;null!=h&&h.Sort.SelectedValue.startsWith("TREE")&&(e=this.RepeatOn+"SORT"),n.sort((t,s)=>t[e]>s[e]?1:-1);let t=0,i=null;if(0!=this.RepeatEmptyColumns&&null!=h&&(h.CDGDO.IsForeignKey?t=h.CDGDO.ColumnCostCenterID:(t=h.CDGDO.CategoryValue,h.CDGDO.ParentCostCenterSysName=h.CDGDO.Table,this.FieldsDialog.drrCT=this.FieldsDialog.CostCenterTables.filter(e=>e.FeatureID==h.CDGDO.CategoryValue),h.CDGDO.ParentCostCenterColSysName=this.FieldsDialog.drrCT[0].PK.toString()),t>5e4)){let e="SELECT";h.Sort.SelectedValue.startsWith("TREE")||(e+=" DISTINCT"),e+=" LT."+h.CDGDO.Column+" AS "+h.ID+" FROM "+h.CDGDO.ParentCostCenterSysName+" LT WITH(NOLOCK)",e+=" WHERE 1=1",2==this.RepeatEmptyColumns&&(e+=" AND LT.IsGroup=0");var u=this.Filter.CostCenterFilters.find(e=>e.CostCenterID==t);if(u&&(u.SelectedNodes.length>0||!u.DeleteButtonVisibility)){e+=" AND "+h.CDGDO.ParentCostCenterColSysName+" IN (";for(let t=0;t<u.SelectedNodes.length;t++)t>0&&(e+=","),e+=u.SelectedNodes[t].Id;0==u.SelectedNodes.length&&(e+=-12912),e+=")"}e+=" ORDER BY ",h.Sort.SelectedValue.startsWith("TREE")?e+="LT.lft ASC":h.Sort.SelectedValue.Contains("DESC")?e+=h.ID+" DESC":e+=h.ID;try{if(i=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataTable("RPT022",this.IsReportDB,e),h.Sort.SelectedValue.startsWith("TREE"))for(s=i.length-1;s>0;s--){let e=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(i[s][h.ID]);for(o=s-1;o>=0;o--)if(0==_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.stringCompare(e,_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(i[o][h.ID]),!0)){i.RemoveAt(s);break}}}catch(O){Logger.ErrorLog("REPEAT EMPTY COL QRY: "+e)}}null==i?(this.dtRepeatColumns.push(this.RepeatOn),l=n.ToTable(!0,[this.RepeatOn])):(this.dtRepeatColumns.push(h.ID),l=i)}else if(this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Daily){if(n=n.sort((e,t)=>e[this.RepeatOn]>t[this.RepeatOn]?1:-1),l=n.ToTable(!0,[this.RepeatOn]),this.dtRepeatColumns.push(this.RepeatOn),0!=this.RepeatEmptyColumns){let e=!1,t=this.FromDatePicker.Date;for(;t<=this.ToDatePicker.Date;){if(0==l.filter(e=>e[this.RepeatOn]==t).length){let s={};s[this.RepeatOn]=t,l.push(s),e=!0}t=t.AddDays(1)}e&&(l=l.sort((e,t)=>e[this.RepeatOn]>t[this.RepeatOn]?1:-1))}}else if(this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Monthly){if(n=n.sort((e,t)=>e.RPTYR>t.RPTYR||e.RPTYR==t.RPTYR&&e.RPTMN>t.RPTMN?1:-1),l=n.ToTable(!0,["RPTYR","RPTMN"]),this.dtRepeatColumns.push("RPTYR"),this.dtRepeatColumns.push("RPTMN"),0!=this.RepeatEmptyColumns)if(this.RepeatShowPrevMn){let e,t=1;this.dtRepeatColumns.push("Sno"),this.dtRepeatColumns.push("PrevMonth"),this.dtRepeatColumns.push("ColID");let s=new Date(this.FromDatePicker.Date.getFullYear(),this.FromDatePicker.Date.getMonth(),1);for(;s<=this.ToDatePicker.Date;){let o=l.filter(e=>e.RPTYR==s.getFullYear()&&e.RPTMN==s.getMonth());0==o.length?(e={},e.RPTYR=s.getFullYear(),e.RPTMN=s.getMonth(),e.Sno=t,e.PrevMonth=0,l.push(e)):(o[0].Sno=t,o[0].PrevMonth=0),this.AddPrevMnInfo(l,t,s),s=s.AddMonths(1),t++}l=null!=h.Sort.SelectedValue&&h.Sort.SelectedValue.Contains("ASC")?l.sort((e,t)=>e.Sno>t.Sno||e.Sno==t.Sno&&e.PrevMonth>t.PrevMonth?1:-1):l.sort((e,t)=>e.Sno>t.Sno||e.Sno==t.Sno&&e.PrevMonth<t.PrevMonth?1:-1)}else{let e=!1,t=new Date(this.FromDatePicker.Date.getFullYear(),this.FromDatePicker.Date.getMonth(),1);for(;t<=this.ToDatePicker.Date;){if(0==l.filter(e=>e.RPTYR==t.getFullYear()&&e.RPTMN==t.getMonth()).length){let s={};s.RPTYR=t.getFullYear(),s.RPTMN=t.getMonth(),l.push(s),e=!0}t=t.AddMonths(1)}e&&(l=l.sort((e,t)=>e.RPTYR>t.RPTYR||e.RPTYR==t.RPTYR&&e.RPTMN>t.RPTMN?1:-1))}}else if(this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Quaterly){l=[],this.dtRepeatColumns.push("ID"),this.dtRepeatColumns.push("Name"),this.dtRepeatColumns.push("No"),this.dtRepeatColumns.push("StDate"),this.dtRepeatColumns.push("EndDate");let e,t=new Date(this.FromDatePicker.Date.getFullYear(),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.AccountingFromMonth-1,1);t>this.FromDatePicker.Date&&(t=t.AddYears(-1));let s=1,o=t.getFullYear();for(;t.AddMonths(3)<=this.FromDatePicker.Date;)s++,o=t.getFullYear(),t=t.AddMonths(3);for(r.push(t),e=1==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.AccountingFromMonth?t.getFullYear().toString():t.iMonth()>=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.AccountingFromMonth?t.getFullYear().toString()+"-"+((t.getFullYear()+1)%100).toString():(t.getFullYear()-1).toString()+"-"+(t.getFullYear()%100).toString(),l.push({}),l[l.length-1].ID="Q"+s+o,l[l.length-1].No=s,l[l.length-1].Name="Q"+s+" "+e,l[l.length-1].StDate=t.ToString("dd MMM yyyy"),l[l.length-1].EndDate=t.AddMonths(3).AddDays(-1).ToString("dd MMM yyyy");t.AddMonths(3)<=this.ToDatePicker.Date;)s++,5==s&&(s=1),t=t.AddMonths(3),r.push(t),e=1==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.AccountingFromMonth?t.getFullYear().toString():t.iMonth()>=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.AccountingFromMonth?t.getFullYear().toString()+"-"+((t.getFullYear()+1)%100).toString():(t.getFullYear()-1).toString()+"-"+(t.getFullYear()%100).toString(),l.push({}),l[l.length-1].ID="Q"+s+t.getFullYear(),l[l.length-1].No=s,l[l.length-1].Name="Q"+s+" "+e,l[l.length-1].StDate=t.ToString("dd MMM yyyy"),l[l.length-1].EndDate=t.AddMonths(3).AddDays(-1).ToString("dd MMM yyyy")}else if(this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.HalfYearly){l=[],this.dtRepeatColumns.push("ID"),this.dtRepeatColumns.push("Name"),this.dtRepeatColumns.push("No"),this.dtRepeatColumns.push("StDate"),this.dtRepeatColumns.push("EndDate");let e,t=new Date(this.FromDatePicker.Date.getFullYear(),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.AccountingFromMonth-1,1);t>this.FromDatePicker.Date&&(t=t.AddYears(-1));let s=1,o=t.getFullYear();for(;t.AddMonths(6)<=this.FromDatePicker.Date;)s++,o=t.getFullYear(),t=t.AddMonths(6);for(r.push(t),e=1==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.AccountingFromMonth?t.getFullYear().toString():t.iMonth()>=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.AccountingFromMonth?t.getFullYear().toString()+"-"+((t.getFullYear()+1)%100).toString():(t.getFullYear()-1).toString()+"-"+(t.getFullYear()%100).toString(),l.push({}),l[l.length-1].ID="H"+s+o,l[l.length-1].No=s,l[l.length-1].Name="H"+s+" "+e,l[l.length-1].StDate=t.ToString("dd MMM yyyy"),l[l.length-1].EndDate=t.AddMonths(6).AddDays(-1).ToString("dd MMM yyyy");t.AddMonths(6)<=this.ToDatePicker.Date;)s++,3==s&&(s=1),t=t.AddMonths(6),r.push(t),e=1==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.AccountingFromMonth?t.getFullYear().toString():t.iMonth()>=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.AccountingFromMonth?t.getFullYear().toString()+"-"+((t.getFullYear()+1)%100).toString():(t.getFullYear()-1).toString()+"-"+(t.getFullYear()%100).toString(),l.push({}),l[l.length-1].ID="H"+s+t.getFullYear(),l[l.length-1].No=s,l[l.length-1].Name="H"+s+" "+e,l[l.length-1].StDate=t.ToString("dd MMM yyyy"),l[l.length-1].EndDate=t.AddMonths(6).AddDays(-1).ToString("dd MMM yyyy")}else if(this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Weekly){l=[],this.dtRepeatColumns.push("ID"),this.dtRepeatColumns.push("Name"),this.dtRepeatColumns.push("No"),this.dtRepeatColumns.push("StDate"),this.dtRepeatColumns.push("EndDate");let e,t,o=new Array,i=this.FromDatePicker.Date,a=this.ToDatePicker.Date;e=new Date(i.getFullYear(),i.getMonth(),1);do{let n=e.DaysInMonth();for(t=new Date(e.getFullYear(),e.getMonth(),n);e<=t;)o.push(new Array(2));for(s=0;s<o.length;s++)o[s][1]>=i&&o[s][0]<=a&&(l.push({}),r.push(o[s][0]),l[l.length-1].ID="W"+(s+1)+t.ToString("MMMyy"),l[l.length-1].No=s+1,l[l.length-1].Name="W"+(s+1)+" "+t.ToString("MMM"),l[l.length-1].StDate=o[s][0].ToString("dd MMM yyyy"),l[l.length-1].EndDate=o[s][1].ToString("dd MMM yyyy"));e=t.AddDays(1),o.Clear()}while(e<=a)}else if(this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Yearly){if(n=n.sort((e,t)=>e.RPTYR>t.RPTYR?1:-1),l=n.ToTable(!0,["RPTYR"]),this.dtRepeatColumns.push("RPTYR"),0!=this.RepeatEmptyColumns)if(this.RepeatShowPrevMn){let e,t=1;this.dtRepeatColumns.push("Sno"),this.dtRepeatColumns.push("PrevMonth"),this.dtRepeatColumns.push("ColID");let s=0,o=new Date(this.FromDatePicker.Date.getFullYear(),this.FromDatePicker.Date.getMonth(),1);for(;o<=this.ToDatePicker.Date;){if(s==o.getFullYear()){o=o.AddMonths(1);continue}let i=l.filter(e=>e.RPTYR==o.getFullYear());0==i.length?(e={},e.RPTYR=o.getFullYear(),e.Sno=t,e.PrevMonth=0,l.push(e)):(i[0].Sno=t,i[0].PrevMonth=0),this.AddPrevMnInfo(l,t,o),s=o.getFullYear(),o=o.AddMonths(1),t++}l=null!=h.Sort.SelectedValue&&h.Sort.SelectedValue.Contains("ASC")?l.sort((e,t)=>e.RPTYR>t.RPTYR?1:-1):l.sort((e,t)=>e.Sno>t.Sno||e.Sno==t.Sno&&e.PrevMonth<t.PrevMonth?1:-1)}else{let e=!1,t=new Date(this.FromDatePicker.Date.getFullYear(),this.FromDatePicker.Date.getMonth(),1);for(;t<=this.ToDatePicker.Date;){if(0==l.filter(e=>e.RPTYR==t.getFullYear()).length){let s={};s.RPTYR=t.getFullYear(),l.push(s),e=!0}t=t.AddMonths(1)}e&&(l=l.sort((e,t)=>e.RPTYR>t.RPTYR?1:-1))}}else if((this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Hourly12||this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Hourly24)&&(n=n.sort((e,t)=>e.RPTHr>t.RPTHr?1:-1),l=n.ToTable(!0,["RPTHr"]),this.dtRepeatColumns.push("RPTHr"),0!=this.RepeatEmptyColumns&&l.length>0)){let e=!1,t=0,s=0,o=l.Compute("min","RPTHr");if(null!=o){for(t=parseInt(o),s=0,o=l.Compute("max","RPTHr"),s=parseInt(o);t<s;){if(0==l.filter(e=>e.RPTHr==t).length){let s={};s.RPTHr=t,l.push(s),e=!0}t++}e&&(l=l.sort((e,t)=>e.RPTHr>t.RPTHr?1:-1))}}if(l.length>0&&0==_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(l[0][this.dtRepeatColumns[0]]).length&&l.RemoveAt(0),0==l.length)return;let D=[],d=[],c=new Array,C=new Array;for(null==this.dicRepeatColsMap?this.dicRepeatColsMap=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a:this.dicRepeatColsMap.Clear(),this.GrpReportTotal.TotalCols.Clear(),this.lstGroup.forEach(e=>{e.TotalCols.Clear()}),s=0;s<this.RepeatStartIndex;s++)D.push(this.ColumnSource[s]),"FLOAT"!=this.ColumnSource[s].ColumnType&&"INT"!=this.ColumnSource[s].ColumnType?d.push(this.ColumnSource[s].ID):C.push(this.ColumnSource[s]),this.GrpReportTotal.TempTotalCols.ContainsKey(this.ColumnSource[s].ID)&&this.GrpReportTotal.TotalCols.push(this.ColumnSource[s].ID,s),this.lstGroup.forEach(e=>{e.TempTotalCols.ContainsKey(this.ColumnSource[s].ID)&&e.TotalCols.push(this.ColumnSource[s].ID,s)});for(s=this.RepeatStartIndex+1,o=1;o<=this.RepeatNextCols;s++,o++)if(this.ColumnSource.length<=s){this.RepeatNextCols=o-1;break}i=l.length-1,this.RepeatSets=l.length-1;let p=!1,T=new Array;for(null!=h&&("ASC"==h.Sort.SelectedValue||"NUM ASC"==h.Sort.SelectedValue||"TREE ASC"==h.Sort.SelectedValue||this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Dimension&&""==h.Sort.SelectedValue)&&(p=!0,i=0),s=this.RepeatStartIndex,o=0;o<=this.RepeatNextCols;s++,o++)this.dicRepeatColsMap.push(this.ColumnSource[s].ID,[]);if(this.RepeatShowPrevMn&&this.RepeatPrevDataSeperately){let e="",t=null;for(let r=0;r<=this.RepeatPrevData;r++)for(r>0&&(t=l.filter(e=>e.Sno=0==e.PrevMonth),e=t[0].ColID.toString().substr(t[0].ColID.toString().indexOf("_")+1)),s=this.RepeatStartIndex,o=0;o<=this.RepeatNextCols;s++,o++)0==r?this.AddRepeatCol(s,i,l,a,n,D,c,C):(t[0].ColID="R"+s+"_"+e,this.AddRepeatCol(s,p?i+r:i-r,l,a,n,D,c,C))}else for(;;){if(p){if(i>l.length-1)break}else if(i<0)break;for(s=this.RepeatStartIndex,o=0;o<=this.RepeatNextCols;s++,o++)if(this.AddRepeatCol(s,i,l,a,n,D,c,C),this.RepeatShowPrevMn){let e=0;for(let t=1;t<=this.RepeatPrevData;t++)e=p?i+t:i-t,this.AddRepeatCol(s,e,l,a,n,D,c,C);if(this.RepeatPrevDiff||this.RepeatPrevPercent){let t;e=p?i+this.RepeatPrevData+1:i-(this.RepeatPrevData+1),t=this.AddRepeatCol(s,e,l,a,n,D,c,C),this.RepeatPrevDiff||(t.HeaderAppearance.IsVisible=!1),T.push(t)}this.RepeatPrevPercent&&(e=p?i+this.RepeatPrevData+2:i-(this.RepeatPrevData+2),this.AddRepeatCol(s,e,l,a,n,D,c,C))}p?i+=this.RepeatPrevNextCols:i-=this.RepeatPrevNextCols}let _=D.length-1;for(s=this.RepeatStartIndex+this.RepeatNextCols+1;s<this.ColumnSource.length;s++)D.push(this.ColumnSource[s]),this.ColumnSource[s].ID.startsWith("MT")&&this.ColumnSource[s].ID.endsWith("MT")||("FLOAT"!=this.ColumnSource[s].ColumnType&&"INT"!=this.ColumnSource[s].ColumnType?d.push(this.ColumnSource[s].ID):C.push(this.ColumnSource[s]),this.GrpReportTotal.TempTotalCols.ContainsKey(this.ColumnSource[s].ID)&&this.GrpReportTotal.TotalCols.push(this.ColumnSource[s].ID,D.length-1),this.lstGroup.forEach(e=>{e.TempTotalCols.ContainsKey(this.ColumnSource[s].ID)&&e.TotalCols.push(this.ColumnSource[s].ID,D.length-1)}));this.lstGroup.forEach(e=>{d.Contains(e.ID)||d.push(e.ID)}),this.ReportColumns=D,this.RefreshPostFilters();let m,I=0,R=!1,S=0,A=0,M=new Array,g=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.c,w=[];for(o=d.length-1;o>=0;o--)w.push(d[o]);if(n=[...a],n.SortBy(w),n.length>0)for(o=0;o<C.length;o++)-1==C[o].UseOnce&&(m=C[o].ID,Object(util__WEBPACK_IMPORTED_MODULE_24__.isNullOrUndefined)(n[0][m])||(A=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(n[0][m]),this.lstSummaryDistinctNumeric["DISTINCT"+m].push(A),this.SetCellValue(A,C[o].DataFormat,"FLOAT",g),n[0]["DISTINCT"+m]=g.Text));for(s=1;s<n.length;s++){for(R=!1,o=0;o<d.length;o++)if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(n[s][d[o]])!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(n[s-1][d[o]])){R=!0;break}if(R)for(I=s,o=0;o<C.length;o++)-1==C[o].UseOnce&&(m=C[o].ID,this.lstSummaryDistinctNumeric["DISTINCT"+m].Clear(),Object(util__WEBPACK_IMPORTED_MODULE_24__.isNullOrUndefined)(n[s][m])||(A=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(n[s][m]),this.lstSummaryDistinctNumeric["DISTINCT"+m].push(A),this.SetCellValue(A,C[o].DataFormat,"FLOAT",g),n[s]["DISTINCT"+m]=g.Text));else{for(o=0;o<C.length;o++)if(m=C[o].ID,0==C[o].UseOnce)Object(util__WEBPACK_IMPORTED_MODULE_24__.isNullOrUndefined)(n[s][m])||(A=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(n[s][m]),S=0,Object(util__WEBPACK_IMPORTED_MODULE_24__.isNullOrUndefined)(n[I][m])||(S=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(n[I][m])),n[I][m]=S+A);else if(-1==C[o].UseOnce){if(!Object(util__WEBPACK_IMPORTED_MODULE_24__.isNullOrUndefined)(n[s][m])&&(A=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(n[s][m]),m="DISTINCT"+m,!this.lstSummaryDistinctNumeric[m].Contains(A))){this.lstSummaryDistinctNumeric[m].push(A);let e="";Object(util__WEBPACK_IMPORTED_MODULE_24__.isNullOrUndefined)(n[I][m])||(e=n[I][m].toString()+","),this.SetCellValue(A,C[o].DataFormat,"FLOAT",g),n[I][m]=e+g.Text}}else Object(util__WEBPACK_IMPORTED_MODULE_24__.isNullOrUndefined)(n[I][m])&&!Object(util__WEBPACK_IMPORTED_MODULE_24__.isNullOrUndefined)(n[s][m])&&(n[I][m]=n[s][m]);for(o=0;o<c.length;o++)m=c[o].ID,Object(util__WEBPACK_IMPORTED_MODULE_24__.isNullOrUndefined)(n[I][m])&&!Object(util__WEBPACK_IMPORTED_MODULE_24__.isNullOrUndefined)(n[s][m])&&(n[I][m]=n[s][m]);M.push(n[s])}}M.forEach(e=>{a.Remove(e)});var E=this.FormulaColumns.filter(e=>2==e.EvaluateAtEnd);if(E.length>0){let e=new Array;for(s=0;s<E.length;s++)if(this.dicRepeatColsMap.ContainsKey(E[s].ID))for(o=0;o<this.dicRepeatColsMap[E[s].ID].length;o++){var P=D.find(e=>e.ID==this.dicRepeatColsMap[E[s].ID][o]);this.dicRepeatColsMap.keys.forEach(e=>{P.Formula.Contains(e)&&(P.Formula=P.Formula.Replace(e,this.dicRepeatColsMap[e][o]),this.fldDict.ContainsKey(this.dicRepeatColsMap[e][o])||this.fldDict.push(this.dicRepeatColsMap[e][o],new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c(this.dicRepeatColsMap[e][o],0)))}),e.push(P)}else e.push(E[s]);for(let t=a.length-1;t>=0;t--)for(let s=0;s<e.length;s++)if(this.CalculateFormulaForSummary(e[s],a[t])){a.RemoveAt(t);break}}if(T.length>0)for(let y=a.length-1;y>=0;y--)T.forEach(e=>{null==a[y][e.Formula]&&null==a[y][e.ColumnFilterExpression]||(A=S=0,null!=a[y][e.Formula]&&(A=parseFloat(a[y][e.Formula])),null!=a[y][e.ColumnFilterExpression]&&(S=parseFloat(a[y][e.ColumnFilterExpression])),A-=S,a[y][e.ID]=A,this.RepeatPrevPercent&&(a[y][e.Formula+"_30"]=A))});if(C.find(e=>-2==e.DataFormat.CumTotal)){let e=new Array(this.RepeatNextCols+1);for(s=0;s<n.length;s++)for(let t=this.RepeatStartIndex,i=0;t<=this.RepeatStartIndex+this.RepeatNextCols;t++,i++)if(-2==D[t].DataFormat.CumTotal)for(e[i]=0,o=t;o<=_;o=o+this.RepeatNextCols+1)S=0,Object(util__WEBPACK_IMPORTED_MODULE_24__.isNullOrUndefined)(n[s][D[o].ID])||(S=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(n[s][D[o].ID])),e[i]+=S,n[s][D[o].ID]=e[i]}this.ReportData=a,this.ReportDataColumns=this.dtTempColumnsRepeat}AddPrevMnInfo(e,t,s){let o;for(let i=1;i<=this.RepeatPrevData;i++)o={},this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Yearly?o.RPTYR=s.AddYears(-i).getFullYear():this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Monthly&&(this.RepeatPrevDataOfCurrYr?(o.RPTYR=s.AddMonths(-i).getFullYear(),o.RPTMN=s.AddMonths(-i).getMonth()):(o.RPTYR=s.AddYears(-i).getFullYear(),o.RPTMN=s.AddYears(-i).getMonth())),o.Sno=t,o.PrevMonth=i,e.push(o);(this.RepeatPrevDiff||this.RepeatPrevPercent)&&(o={},this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Yearly?o.RPTYR=s.AddYears(-1).getFullYear():this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Monthly&&(o.RPTYR=s.AddYears(-1).getFullYear(),o.RPTMN=s.AddYears(-1).getMonth()),o.Sno=t,o.PrevMonth=20,e.push(o),this.RepeatPrevPercent&&(o={},this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Yearly?o.RPTYR=s.AddYears(-1).getFullYear():this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Monthly&&(this.RepeatPrevDataOfCurrYr?(o.RPTYR=s.AddMonths(-1).getFullYear(),o.RPTMN=s.AddMonths(-1).getMonth()):(o.RPTYR=s.AddYears(-1).getFullYear(),o.RPTMN=s.AddYears(-1).getMonth())),o.Sno=t,o.PrevMonth=30,e.push(o)))}AddRepeatCol(e,t,s,o,i,l,a,n){let r,h,u=this.dtRepeatColumns[0],D=this.dtRepeatColumns[1],d=this.RepeatShowPrevMn?parseInt(s[t].PrevMonth):0;d<20&&(this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Daily?h=o.filter(e=>e[this.RepeatOn]=new Date(s[t][u])):this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Monthly?h=o.filter(e=>e.RPTYR==s[t][u]&&e.RPTMN==s[t][D]):this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Weekly||this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Quaterly||this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.HalfYearly?h=o.filter(e=>e[this.RepeatOn]>=s[t].StDate&&e[this.RepeatOn]<=s[t].EndDate):this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Yearly?h=o.filter(e=>e.RPTYR==s[t][u]):this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Dimension?h=o.filter(e=>e[this.RepeatOn]==s[t][u]):this.RepeatType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Hourly12&&this.RepeatType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Hourly24||(h=o.filter(e=>e.RPTHr==s[t][u])));let c=this.ColumnSource[e].Clone();if(l.push(c),this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Daily)r=new Date(s[t][u]),c.ID="R"+e+"_"+r.ToString("ddMMMyy"),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(c.HeaderText)||(c.HeaderText+="\r\n"),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(c.DataFormat.DateType)?c.HeaderText+=r.ToString(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Date Format"]):c.HeaderText+=r.ToString(c.DataFormat.DateType);else if(this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Monthly)if(0!=parseInt(s[t][u])){let o="MMM-yy";var C=this.BaseReportColumns.find(e=>e.ID==this.RepeatOn);C&&""!=C.DateType.Text&&C.DateType.Text.length>0&&!C.DateType.Text.Contains("dd")&&!C.DateType.Text.Contains("hh")&&(o=C.DateType.Text),r=new Date(parseInt(s[t][u]),parseInt(s[t][D]),1),c.ID="R"+e+"_"+r.ToString("ddMMMyy"),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(c.HeaderText)||(c.HeaderText+="\r\n"),c.HeaderText+=r.ToString(o)}else c.ID="R"+e+"_NULL",_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(c.HeaderText)||(c.HeaderText+="\r\n"),c.HeaderText+="";else if(this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Weekly||this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Quaterly||this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.HalfYearly)c.ID="R"+e+"_"+s[t].ID.toString(),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(c.HeaderText)||(c.HeaderText+="\r\n"),c.HeaderText+=s[t].Name.toString();else if(this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Yearly)r=new Date(parseInt(s[t][u]),0,1),c.ID="R"+e+"_"+r.ToString("ddMMMyy"),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(c.HeaderText)||(c.HeaderText+="\r\n"),c.HeaderText+=r.ToString("yyyy");else if(this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Hourly12||this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Hourly24){let o=parseInt(s[t][u]);c.ID="R"+e+"_"+s[t][u].toString(),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(c.HeaderText)||(c.HeaderText+="\r\n"),c.HeaderText+=this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Hourly12?o<11?o+"AM - "+(o+1)+"AM":11==o?o+"AM - 12PM":12==o?o+"PM - 1PM":23==o?o+"PM - "+(o+1)+"AM":o-12+"PM - "+(o+1-12)+"PM":o.ToString("00")+":00 - "+(o+1).ToString("00")+":00"}else c.ID="R"+e+"_"+s[t][u].toString(),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(c.HeaderText)||(c.HeaderText+="\r\n"),c.HeaderText+=s[t][u].toString();if(d>0&&!this.RepeatPrevDataSeperately){let e=s.filter(e=>e.Sno==s[t].Sno&&0==e.PrevMonth);c.ID=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.StringValue(e[0].ColID).toString()+"_"+d,20==d?(c.HeaderText="Diff",c.Formula=e[0].ColID.toString(),c.ColumnFilterExpression=e[0].ColID.toString()+"_1"):30==d&&(c.HeaderText="%",c.DataFormat.PercentageOn=e[0].ColID.toString()+"_1")}return this.RepeatShowPrevMn&&(s[t].ColID=c.ID),"FLOAT"==c.ColumnType||"INT"==c.ColumnType?this.dtTempColumnsRepeat.Contains(c.ID)||(this.dtTempColumnsRepeat.push(c.ID),-1==c.UseOnce&&(this.dtTempColumnsRepeat.Contains("DISTINCT"+c.ID)||this.dtTempColumnsRepeat.push("DISTINCT"+c.ID),this.lstSummaryDistinctNumeric.ContainsKey("DISTINCT"+c.ID)?this.lstSummaryDistinctNumeric["DISTINCT"+c.ID].Clear():this.lstSummaryDistinctNumeric.push("DISTINCT"+c.ID,new Array)),this.TotalCols.Contains(this.ColumnSource[e].ID)&&this.TotalCols.push(c.ID),this.GrpReportTotal.TempTotalCols.ContainsKey(this.ColumnSource[e].ID)&&this.GrpReportTotal.TotalCols.push(c.ID,l.length-1),this.lstGroup.forEach(t=>{t.TempTotalCols.ContainsKey(this.ColumnSource[e].ID)&&t.TotalCols.push(c.ID,l.length-1)}),n.push(c)):(this.dtTempColumnsRepeat.push(c.ID),a.push(c)),d<20&&h.forEach(t=>{t[c.ID]=t[this.ColumnSource[e].ID]}),!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(c.DataFormat.PercentageOn)&&this.dicRepeatColsMap.ContainsKey(c.DataFormat.PercentageOn)&&this.dicRepeatColsMap[c.DataFormat.PercentageOn].length>0&&(c.DataFormat.PercentageOn=this.dicRepeatColsMap[c.DataFormat.PercentageOn].Last()),this.dicRepeatColsMap[this.ColumnSource[e].ID].push(c.ID),this.lstRepeatSummaryAplha.push(c.ID,[]),c}GetBudgetIndex(e,t){let s=0;if(e.Subtract(t).TotalDays<=0){let o=new Date(e.getFullYear(),e.getMonth(),e.getDate());for(;o<=t&&s<=13;)o=o.AddMonths(1),s++}return s>12&&(s=0),s}CheckAndUpdateKANBAN(e){let t,s,o,i=null,l=[],a=[];new Array,this.RepeatOn=this.BaseReportColumns[0].ID;var n=this.BaseReportColumns.find(e=>e.ID==this.RepeatOn);a.push(this.RepeatOn);let r=e.Copy();r=r.sort((e,t)=>e[this.RepeatOn]>t[this.RepeatOn]?1:-1),i=r.ToTable(!0,[this.RepeatOn]);let h=this.RepeatOn,u=[];this.GrpReportTotal.TotalCols.Clear();let D=new Array,d=new Array;null==this.dicRepeatColsMap?this.dicRepeatColsMap=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a:this.dicRepeatColsMap.Clear(),this.RepeatSets=i.length-1;let c=!0;for(new Array,o=0,"DESC"==n.Sort.SelectedValue&&(c=!1,o=i.length-1),s=1;s<this.ColumnSource.length;s++)this.dicRepeatColsMap.push(this.ColumnSource[s].ID,[]);this.RepeatStartIndex=1,this.RepeatNextCols=this.ColumnSource.length-2;let C,p=1;for(;;){if(c){if(o>i.length-1)break}else if(o<0)break;for(t=this.RepeatStartIndex,s=0;s<=this.RepeatNextCols;t++,s++){let e=this.ColumnSource[t].Clone();u.push(e),e.ID="KAN"+this.ColumnSource[t].ID+"_"+i[o][h].toString(),s>0?(e.Row=s,e.Column=p,e.HeaderAppearance.IsVisible=!1):p=u.length-1,e.HeaderText=i[o][h].toString(),a.Contains(e.ID)||("FLOAT"==e.ColumnType||"INT"==e.ColumnType?(a.push(e.ID),d.push(e)):(a.push(e.ID),D.push(e))),this.dicRepeatColsMap[this.ColumnSource[t].ID].push(e.ID)}c?o+=1:o-=1}for(o=0,"DESC"==n.Sort.SelectedValue&&(c=!1,o=i.length-1);;){if(c){if(o>i.length-1)break}else if(o<0)break;let s=e.filter(e=>e[this.RepeatOn]==i[o][h].toString());var T=u.find(e=>e.ID=="KAN"+this.ColumnSource[1].ID+"_"+i[o][h].toString());let a;for(T&&(T.HeaderText+=" ("+s.length+")"),t=0;t<s.length;t++)l.length<=t?(a={},l.push(a)):a=l[t],this.dicRepeatColsMap.keys.forEach(e=>{C="KAN"+e+"_"+i[o][h].toString(),a[C]=s[t][e]});c?o+=1:o-=1}console.log(u),console.log(a),this.ReportColumns=u,this.ReportDataColumns=a,this.RefreshPostFilters(!1),this.ReportData=l}SetDatePickers(){let e=!1;if(this.FromDatePicker=new _shared_models_controls_PactDatePickerData__WEBPACK_IMPORTED_MODULE_12__.a(0),this.FromDatePicker.Visible=!1,this.ToDatePicker=new _shared_models_controls_PactDatePickerData__WEBPACK_IMPORTED_MODULE_12__.a(0),this.ToDatePicker.Visible=!1,this.oReportDialog instanceof _static_report_filter_StaticReportFilterViewModel__WEBPACK_IMPORTED_MODULE_20__.a)this.FromDatePicker=this.oReportDialog.FromDate,this.ToDatePicker=this.oReportDialog.ToDate;else if(null!=this.MRPFilter)this.FromDatePicker=this.MRPFilter.FromDate,this.ToDatePicker=this.MRPFilter.ToDate;else if(null!=this.Filter)for(let t=0;t<this.Filter.Fields.length;t++){let s=this.Filter.Fields[t];if("DATE"==s.CDGDO.DataType){"FUTURE"!=s.Condition.SelectedValue&&"PAST"!=s.Condition.SelectedValue||(e=!0),this.FromDatePicker=s.FromDatePicker,this.ToDatePicker=s.ToDatePicker,this.FromDatePicker.Dependantinuse=!0,this.ToDatePicker.Dependantinuse=!0;break}}this.DateFilter="",this.FromDatePicker.Visible&&this.ToDatePicker.Visible||e?_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("Hijri Date")&&""!=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Hijri Date"]&&Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Hijri Date"])?(this.DateFilter=_services_session_manager_service__WEBPACK_IMPORTED_MODULE_26__.a.ConvertGregtoHijri(this.FromDatePicker.Date),this.DateFilter+=" "+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("To")+" "+_services_session_manager_service__WEBPACK_IMPORTED_MODULE_26__.a.ConvertGregtoHijri(this.ToDatePicker.Date)):(this.DateFilter=this.FromDatePicker.Date.ToString(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Date Format"]),this.DateFilter+=" "+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("To")+" "+this.ToDatePicker.Date.ToString(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Date Format"])):this.ToDatePicker.Visible?this.DateFilter=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("Hijri Date")&&""!=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Hijri Date"]&&Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Hijri Date"])?this.ToDatePicker.Label+"  "+_services_session_manager_service__WEBPACK_IMPORTED_MODULE_26__.a.ConvertGregtoHijri(this.ToDatePicker.Date):this.ToDatePicker.Label+"  "+this.ToDatePicker.Date.ToString(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Date Format"]):this.FromDatePicker.Visible&&(this.DateFilter=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("Hijri Date")&&""!=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Hijri Date"]&&Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Hijri Date"])?_services_session_manager_service__WEBPACK_IMPORTED_MODULE_26__.a.ConvertGregtoHijri(this.FromDatePicker.Date):this.FromDatePicker.Date.ToString(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Date Format"])),this.SetFilterText()}SetFilterText(){if(!this.Preferences.ContainsKey("ShowFilterText"))return;let e;if(0==this.dicFieldText.length&&0==this.dicTreeText.length){let e=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f;e.LoadXml("<XML>"+this.Preferences.ShowFilterText+"</XML>");for(let t=0;t<e.DocumentElement.children.length;t++){let s=e.DocumentElement.children[t];s.attributes.Filter.value.startsWith("CC_")?this.dicTreeText.push(s.attributes.Filter.value.substr(3)):this.dicFieldText.push(s.attributes.Filter.value)}}if(this.dicFieldText.length>0)if(this.StaticReportType>0)null!=this.DBPanel&&(e=this.FilterText.find(e=>"xDATEFILTER"==e.DBColumnName),e||(e=new _shared_models_controls_PactTextBlockData__WEBPACK_IMPORTED_MODULE_16__.a,e.Label="Date Filter",e.DBColumnName="xDATEFILTER",this.FilterText.push(e)),e.Text=this.DateFilter);else for(let t=0;t<this.Filter.Fields.length;t++){let s=this.Filter.Fields[t];if(this.dicFieldText.Contains(s.ID))if(e=this.FilterText.find(e=>e.DBColumnName==s.ID),e||(e=new _shared_models_controls_PactTextBlockData__WEBPACK_IMPORTED_MODULE_16__.a,e.Label=s.Caption.Text,e.DBColumnName=s.ID,this.FilterText.push(e)),"DATE"==s.CDGDO.DataType)e.Text="Between"==s.Condition.SelectedValue?s.FromDatePicker.Date.ToString(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Date Format"])+" To "+s.ToDatePicker.Date.ToString(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Date Format"]):"NotBetween"==s.Condition.SelectedValue?"Not Between"+s.FromDatePicker.Date.ToString(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Date Format"])+" And "+s.ToDatePicker.Date.ToString(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Date Format"]):"FUTURE"==s.Condition.SelectedValue||"PAST"==s.Condition.SelectedValue?s.FromDatePicker.Date.ToString(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Date Format"])+" And "+s.ToDatePicker.Date.ToString(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Date Format"]):s.FromDatePicker.Date.ToString(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Date Format"]);else if("Between"==s.Condition.SelectedValue||"NotBetween"==s.Condition.SelectedValue)if(s.FromValue.Visible){if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(s.FromValue.TextBox.Text)&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(s.ToValue.Text))continue;e.Text=s.Condition.SelectedItem.Name+" "+s.FromValue.TextBox.Text+" And "+s.ToValue.Text}else{if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(s.FromList.Text)&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(s.ToList.Text))continue;e.Text=s.Condition.SelectedItem.Name+" "+s.FromList.Text+" And "+s.ToList.Text}else if("Contains"==s.Condition.SelectedValue||"NotContain"==s.Condition.SelectedValue){if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(s.FromValue.TextBox.Text))continue;e.Text=s.Condition.SelectedItem.Name+" "+s.FromValue.TextBox.Text}else if(s.FromValue.Visible){if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(s.FromValue.TextBox.Text))continue;e.Text=s.Condition.SelectedItem.Name+" "+s.FromValue.TextBox.Text}else if(s.FromList.CCID>0&&0==s.FromList.SelectedValue&&3!=s.FromList.CCID)continue}if(this.dicTreeText.length>0){let t,s=0;if(null!=this.oReportDialog&&this.oReportDialog.Locations.Visible&&this.dicTreeText.Contains(this.oReportDialog.Locations.DBColumnID.toString())){let t="";for(let e=1;e<this.oReportDialog.Locations.Items.length;e++)this.oReportDialog.Locations.Items[e].IsChecked&&(t.length>0&&(t+=","),t+=this.oReportDialog.Locations.Items[e].Name);s=this.oReportDialog.Locations.DBColumnID,e=new _shared_models_controls_PactTextBlockData__WEBPACK_IMPORTED_MODULE_16__.a,e.Label=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Location"),e.Text=t.toString(),this.FilterText.push(e)}t=null!=this.oReportDialog?this.oReportDialog.CostCenterFilters:this.Filter.CostCenterFilters;for(let o=0;o<t.length;o++){let i=t[o];if(e=this.FilterText.find(e=>e.DBColumnName=="CC"+i.CostCenterID),i.SelectedNodes.length>0&&i.CostCenterID!=s){if(!(this.dicTreeText.Contains(i.CostCenterID.toString())||44==i.CostCenterID&&this.dicTreeText.Contains("44_"+i.LookupTypeID.toString())))continue;if(null==e&&(e=new _shared_models_controls_PactTextBlockData__WEBPACK_IMPORTED_MODULE_16__.a,e.Label=i._CostCenter,e.DBColumnName="CC"+i.CostCenterID,this.FilterText.push(e)),"[FILTER]"==i.SelectedNodesTag){let t="";for(let e=0;e<i.SelectedNodes.length&&e<15;e++)t.length>0&&(t+=","),t+=i.SelectedNodes[e].Id.toString();let s=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetNodeNames(i.CostCenterID,t);if(null!=s&&s.length>0){t="";for(let e=0;e<s.length;e++)t.length>0&&(t+=", "),t+=s[e].Name.toString();i.SelectedNodes.length>15&&(t+=",..."),e.Text=t}}else e.Text=i.SelectedNodesTag}else null!=e&&this.FilterText.Remove(e)}}}AddReportTitleRow(e,t){let s=null==this.ParentReport?this.ReportColumns.length:this.ParentReport.ReportColumns.length;this.childReportTitle=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(s,this.RowHeight+4),this.childReportTitle.LevelNo=-2,this.childReportTitle.Cells[0].IsNormal=!1,this.childReportTitle.Type=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Header,this.childReportTitle.Cells[0].Text=e,this.childReportTitle.Cells[0].CellAppearance=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.a,this.childReportTitle.Cells[0].CellAppearance.IsBold=!0,this.childReportTitle.Cells[0].CellAppearance.FontSize=14,this.childReportTitle.Cells[0].CellAppearance.ForeColor="#FF00465A",this.childReportTitle.Cells[0].CellAppearance.BackColor="#FFD5D5D5",this.childReportTitle.Cells[0].CellAppearance.FontFamilyName="Arial",this.childReportTitle.Cells[0].CellAppearance.Alignment="Left",this.childReportTitle.Cells[0].ColSpan=s,t&&(this.MergeChildReport||this.addRow(this.childReportTitle))}AddReportColumnRow(e){this.childReportColumnHeader=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(this.ReportColumns.length,this.ReportColumns[0].HeaderHeight),this.childReportColumnHeader.LevelNo=-1,this.childReportColumnHeader.Type=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Header;for(let t=0;t<this.ReportColumns.length;t++)this.childReportColumnHeader.Cells[t].IsNormal=!1,this.childReportColumnHeader.Cells[t].Text=this.ReportColumns[t].HeaderText,this.childReportColumnHeader.Cells[t].CellAppearance=this.ReportColumns[t].HeaderAppearance;e&&(this.MergeChildReport||this.addRow(this.childReportColumnHeader))}RenderData(e,t){try{Logger.InfoLog("ReportViewModel::Entring RenderData");let a,n=0,r=0,h=[],u=0,D=0,d="";if(this.iGroupRowsAdded=0,this.iCurrGroupDetailRows=0,null==this.ReportSummaryData&&!this.IsFilterRendering)for(let e=0;e<this.lstGroup.length;e++)if("Summary"==this.lstGroup[e].DisplayMode){this.ReportSummaryData=[],this.ReportSummaryDataColumns=this.ReportDataColumns.Copy();break}for(let e=0;e<this.ReportColumns.length;e++){let t=this.ReportColumns[e];if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(t.DataFormat.PrevRowValue)){t.PrevRowValueInd=-1;var s=this.ReportColumns.find(e=>e.ID==t.DataFormat.PrevRowValue);s&&(t.PrevRowValueInd=this.ReportColumns.indexOf(s))}}if(null==this.LevelColumn){if(this.PercentColumnExists){this.PercentTotals=new Array(this.ReportColumns.length).fill(0);for(let t=0;t<this.ReportColumns.length;t++)if(this.PercentTotals[t]=0,"FLOAT"==this.ReportColumns[t].ColumnType||"INT"==this.ReportColumns[t].ColumnType||!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.ReportColumns[t].Formula))try{let s;_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.ReportColumns[t].Formula)?this.PercentTotals[t]=parseFloat(s):e.forEach(e=>{n=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(e[this.ReportColumns[t].ID]),this.PercentTotals[t]+=n})}catch(o){}}for(let s=0;s<e.length;s++)if(this.AddGroupRows(e,s),!(this.TopRecords>0&&!this.IsDefaultSortColumnExists&&this.iGroupRowsAdded>=this.TopRecords)){h.Clear(),h.push(new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(this.ReportColumns.length,this.RowHeight)),h[0].DataRow=e[s];for(let o=0;o<this.ReportColumns.length;o++){if(a=this.ReportColumns[o],a.Row>0){if(h.length-1<a.Row)for(let e=0;e<=a.Row;e++)h.length-1<e&&(h.push(new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(this.ReportColumns.length,this.SubRowHeight)),h[h.length-1].Type=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.SubDetail);u=a.Row,D=a.Column}else u=0,D=o;if(t.Contains(a.ID)){if(-1==a.UseOnce){this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.None?_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNum(e[s][a.ID])&&(n=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(e[s][a.ID]),this.lstSummaryDistinctNumeric[a.ID].Contains(n)||this.lstSummaryDistinctNumeric[a.ID].push(n)):(d=e[s]["DISTINCT"+a.ID].toString(),this.SetCellValue(d,a.DataFormat,"",h[u].Cells[D]));continue}if(-1!=a.PrevRowValueInd)if(0==this.Data.length)e[s][a.ID]="0";else if(this.Data[this.Data.length-1].Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Detail)e[s][a.ID]=this.Data[this.Data.length-1].Cells[a.PrevRowValueInd].Value;else if(e[s][a.ID]="0",0==this.ReportColumns[a.PrevRowValueInd].DataFormat.CumTotal)for(let t=this.Data.length-2;t>=0;t--)if(this.Data[t].Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Detail){e[s][a.ID]=this.Data[t].Cells[a.PrevRowValueInd].Value;break}if(d=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(e[s][a.ID]),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(a.DataFormat.PercentageOn)){if(this.TotalCols.Contains(a.ID)&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNum(d))if(n=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(d),1==a.UseOnce)this.totals[o][this.lstGroup.length]=n;else if(2==a.UseOnce)this.totals[o][this.lstGroup.length]+=n;else if(a.DataFormat.CumTotal>-1)for(let e=0;e<=this.lstGroup.length;e++)this.totals[o][e]+=n;else"$TOTALHOURS$"==a.Formula?this.totals[o][this.lstGroup.length]=ReportViewModel.GetHoursSum(this.totals[o][this.lstGroup.length],n):this.totals[o][this.lstGroup.length]+=n;a.DataFormat.CumTotal>-1&&(d=this.totals[o][this.lstGroup.length].toString())}else{if(n=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(d),r="REPORT_TOTAL"==this.ReportColumns[o].DataFormat.PercentageOn?this.PercentTotals[o]:_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(e[s][a.DataFormat.PercentageOn]),0==n||0==r)continue;r=100*n/r,d=r.toString(),this.TotalCols.Contains(this.ReportColumns[o].ID)&&(this.totals[o][this.lstGroup.length]+=n)}""!=d&&(this.SetCellValue(d,a.DataFormat,a.ColumnType,h[u].Cells[D]),u>0&&D<this.ReportColumns.length&&(this.IsKANBAN||this.ReportColumns[D].ColumnType!=a.ColumnType)&&(h[u].Cells[D].IsNormal=!1,h[u].Cells[D].CellAppearance=a.DataAppearance.Clone()),a.DataFormat.PrintOnce&&!this.IsSummary&&this.Data.length>0&&this.iGroupRowsAdded>0&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(h[u].Cells[D].Value)==_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(this.Data[this.Data.length-1].Cells[D].Value)&&(h[u].Cells[D].Text=""),this.IsSummary&&"FLOAT"!=a.ColumnType&&"INT"!=a.ColumnType&&("DATE"==a.ColumnType?_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(h[u].Cells[D].Text)||0!=this.lstSummaryCells[a.ID].filter(e=>e.Text==h[u].Cells[D].Text).length||this.lstSummaryCells[a.ID].push(h[u].Cells[D]):this.lstSummaryAplha.ContainsKey(a.ID)&&!this.lstSummaryAplha[a.ID].Contains(d)?this.lstSummaryAplha[a.ID].push(d):this.lstRepeatSummaryAplha.ContainsKey(a.ID)&&!this.lstRepeatSummaryAplha[a.ID].Contains(d)&&this.lstRepeatSummaryAplha[a.ID].push(d)))}}for(let o=0;o<this.HiddenNumericColumns.length;o++)if(a=this.HiddenNumericColumns[o],t.Contains(a.ID)&&(d=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(e[s][a.ID]),""!=d&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNum(d)))if(n=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(d),1==a.UseOnce)this.hiddenTotals[o][this.lstGroup.length]=n;else if(2==a.UseOnce)this.hiddenTotals[o][this.lstGroup.length]+=n;else if(a.DataFormat.CumTotal>-1)for(let e=0;e<=this.lstGroup.length;e++)this.hiddenTotals[o][e]+=n;else this.hiddenTotals[o][this.lstGroup.length]+=n;if(!this.IsSummary){-1!=this.colSNoIndex&&(h[0].Cells[this.colSNoIndex].Value=++this.SNo,h[0].Cells[this.colSNoIndex].Text=this.SNo.toString()),this.ApplyKPI(h[0]);for(let e=0;e<h.length;e++){let t=h[e];t.LevelNo=this.lstGroup.length,this.HideEmptyRows&&!t.Cells.find(e=>!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(e.Text))||this.IsNoDataGroups&&!t.Cells.find(e=>!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(e.Text))||this.addRow(t)}this.IsKANBAN&&(this.addRow(new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(this.ReportColumns.length,this.RowHeight)),this.Data[this.Data.length-1].Cells[0].ColSpan=this.ReportColumns.length),this.iGroupRowsAdded++,this.iCurrGroupDetailRows++}}}else{if(!this.IsTreeDataCalculated){for(let e=0;e<this.ReportColumns.length;e++)t.Contains(this.ReportColumns[e].ID)||e==this.colSNoIndex||t.push(this.ReportColumns[e].ID);for(let e=0;e<this.HiddenNumericColumns.length;e++)t.Contains(this.HiddenNumericColumns[e].ID)||t.push(this.HiddenNumericColumns[e].ID)}if(this.PercentColumnExists){this.PercentTotals=new Array(this.ReportColumns.length).fill(0);for(let e=0;e<this.ReportColumns.length;e++)if(this.PercentTotals[e]=0,"FLOAT"==this.ReportColumns[e].ColumnType||"INT"==this.ReportColumns[e].ColumnType||!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.ReportColumns[e].Formula))try{let t;_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.ReportColumns[e].Formula)?(t=this.ReportTransactionData.Compute("sum",this.ReportColumns[e].ID),this.PercentTotals[e]=parseFloat(t)):this.ReportTransactionData.forEach(t=>{n=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(t[this.ReportColumns[e].ID]),this.PercentTotals[e]+=n})}catch(i){}}let s=0,o=0,c=[];if(this.LevelNo=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(this.Filter.ShowLevel.Text),-1==this.LevelNo?this.LevelNo=50:-2==this.LevelNo&&(this.LevelNo=51),this.lstParents=[],this.lstTotal=[],this.lstParents.push(new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(this.ReportColumns.length,this.RowHeight)),this.lstTotal.push(new Array(this.ReportColumns.length+this.HiddenNumericColumns.length).fill(0)),e.length>0)for(let t=0;t<parseInt(e[0].Depth);t++)this.lstParents.push(new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(this.ReportColumns.length,this.RowHeight)),this.lstTotal.push(new Array(this.ReportColumns.length+this.HiddenNumericColumns.length).fill(0));let C=0;for(let i=0;i<e.length;i++){if(h.Clear(),h.push(new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(this.ReportColumns.length,this.RowHeight)),this.RowHeight>0&&(h[0].Height=this.RowHeight),h[0].DataRow=e[i],h[0].LevelNo=parseInt(e[i].Depth),h[0].IsGroup=Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(e[i].IsGroup),this.UpdateTreeTotals(h[0].LevelNo),h[0].IsGroup){for(this.lstParents.push(h[0]),this.lstTotal.push(new Array(this.ReportColumns.length+this.HiddenNumericColumns.length).fill(0)),C=0;C<h[0].Cells.length;C++)h[0].Cells[C].IsNormal=!1,h[0].Cells[C].CellAppearance=this.ReportColumns[C].DataAppearance.Clone(),h[0].Cells[C].CellAppearance.ForeColor="#FF0081A6";h[0].PrintVisible=this.TreeGroupPrint}else if(c=this.ReportTransactionData.filter(this.LevelSubGroup.length>0?t=>t.TreeNodeID==e[i].TreeNodeID&&t.LevelSubGroup==e[i][this.LevelSubGroup].toString().Replace("'","''"):t=>t.TreeNodeID==e[i].TreeNodeID),!this.Filter.ShowAllTreeData.IsChecked&&0==c.length)continue;for(let l=0;l<this.HiddenNumericColumns.length;l++)a=this.HiddenNumericColumns[l],t.Contains(a.ID)&&(h[0].IsGroup||c.length>0&&(s=0,"FLOAT"!=a.ColumnType&&"INT"!=a.ColumnType||(c.forEach(e=>{_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNum(e[a.ID])&&(o=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(e[a.ID]),s+=o)}),e[i][a.ID]=s)),d=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(e[i][a.ID]),""!=d&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNum(d)&&(n=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(d),this.lstTotal[this.lstTotal.length-1][this.ReportColumns.length+l]+=n));for(C=0;C<this.ReportColumns.length;C++)if(a=this.ReportColumns[C],!h[0].IsGroup&&t.Contains(this.ReportColumns[C].ID)){if(c.length>0){if(-1==this.ReportColumns[C].UseOnce)continue;if(s=0,"FLOAT"==a.ColumnType||"INT"==a.ColumnType)a.UseOnce>0?s=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(c[0][a.ID]):c.forEach(e=>{_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNum(e[a.ID])&&(o=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(e[a.ID]),"$TOTALHOURS$"==a.Formula?s=ReportViewModel.GetHoursSum(s,o):s+=o)}),e[i][a.ID]=s;else if("DATE"==a.ColumnType)try{e[i][a.ID]=c[0][a.ID]}catch(l){}else e[i][a.ID]=c[0][a.ID]}if(3==a.EvaluateAtEnd&&(""!=a.Formula||""!=a.ColumnFilterExpression)&&this.CalculateFormula_2(a,e[i],!0))break}if(!(C<this.ReportColumns.length)){for(C=0;C<this.ReportColumns.length;C++){if(a=this.ReportColumns[C],a.Row>0){if(h.length-1<this.ReportColumns[C].Row)for(let e=0;e<=this.ReportColumns[C].Row;e++)h.length-1<e&&h.push(new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(this.ReportColumns.length,this.SubRowHeight));u=this.ReportColumns[C].Row,D=this.ReportColumns[C].Column}else u=0,D=C;if(a.ID==this.LevelColumn.ID&&(h[u].Cells[D].IsNormal=!1,h[u].Cells[D].level=h[0].LevelNo,this.LevelSubGroup.length>0&&!h[0].IsGroup))this.SetCellValue(e[i][this.ReportColumns[C].ID],a.DataFormat,a.ColumnType,h[u].Cells[D]);else if(t.Contains(this.ReportColumns[C].ID)){if(!h[0].IsGroup&&c.length>0&&-1==this.ReportColumns[C].UseOnce){if(this.sbSummaryDimensions="",this.lstSummaryDistinctNumeric.ContainsKey(a.ID)){let e=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.c;this.lstSummaryDistinctNumeric[a.ID].Clear(),c.forEach(t=>{_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNum(t[a.ID])&&(o=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(t[a.ID]),this.lstSummaryDistinctNumeric[a.ID].Contains(o)||(this.lstSummaryDistinctNumeric[a.ID].push(o),this.SetCellValue(o,a.DataFormat,"FLOAT",e),this.sbSummaryDimensions.length>0&&(this.sbSummaryDimensions+=","),this.sbSummaryDimensions+=e.Text))}),this.SetCellValue(this.sbSummaryDimensions.toString(),a.DataFormat,"",h[u].Cells[D])}continue}if(""!=a.Formula&&2==a.EvaluateAtEnd&&this.CalculateFormula_2(a,e[i]),d=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(e[i][a.ID]),""!=d){if(h[0].IsGroup&&("FLOAT"==a.ColumnType||"INT"==a.ColumnType))continue;if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.ReportColumns[C].DataFormat.PercentageOn))this.TotalCols.Contains(a.ID)&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNum(d)&&(n=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(d),this.lstTotal.length>0&&("$TOTALHOURS$"==a.Formula?this.lstTotal[this.lstTotal.length-1][C]=ReportViewModel.GetHoursSum(this.lstTotal[this.lstTotal.length-1][C],n):this.lstTotal[this.lstTotal.length-1][C]+=n));else{if(n=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(d),r="REPORT_TOTAL"==this.ReportColumns[C].DataFormat.PercentageOn?this.PercentTotals[C]:_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(e[i][this.ReportColumns[C].DataFormat.PercentageOn]),0==n||0==r)continue;r=100*n/r,d=r.toString(),this.TotalCols.Contains(this.ReportColumns[C].ID)&&(this.lstTotal[this.lstTotal.length-1][C]+=n)}this.SetCellValue(d,a.DataFormat,a.ColumnType,h[u].Cells[D])}}}h[0].LevelNo<=this.LevelNo&&(this.lstParents.length>1&&(h[0].IsExpanded=!0,h[0].IsExpanded&&(h[0].Type=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Detail),h[0].IsGroup?this.lstParents.length>2&&(h[0].Parent=this.lstParents[this.lstParents.length-2]):h[0].Parent=this.lstParents[this.lstParents.length-1],null==h[0].Parent||h[0].Parent.IsExpanded&&h[0].Parent.Visible||(h[0].Visible=!1)),-1!=this.colSNoIndex&&(h[0].IsGroup||(h[0].Cells[this.colSNoIndex].Value=++this.SNo,h[0].Cells[this.colSNoIndex].Text=this.SNo.toString())),h[0].IsGroup||this.ApplyKPI(h[0]),h[0].IsGroup||50!=this.LevelNo||(h[0].Visible=!1),this.addRow(h[0]))}}if(50==this.LevelNo)for(let e=this.Data.length-1;e>=0;e--)this.Data[e].Visible||this.Data[e].IsGroup||this.removeRowAt(e)}Logger.InfoLog("ReportViewModel::Exiting RenderData")}catch(a){Logger.ErrorLog("ReportViewModel::Error RenderData",a.stack)}}AddGroupRows(e,t){let s=!1;this.IsNewGroupIndex=-1;for(let l=0;l<this.lstGroup.length;l++)if(!Object(util__WEBPACK_IMPORTED_MODULE_24__.isUndefined)(e[t][this.lstGroup[l].ID])&&this.Groupstr[this.lstGroup[l].ID]!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(e[t][this.lstGroup[l].ID])){if(this.IsNewGroupIndex=l,t>0&&!s){s=!0;for(let s=this.lstGroup.length;s>=l+1;s--)this.AddSubtotals(e[t-1],this.lstGroup[s-1],s),this.Groupstr[this.lstGroup[s-1].ID]=null}this.IsSummary="Summary"==this.lstGroup[l].DisplayMode;let a=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(this.ReportColumns.length,this.RowHeight);this.lstGroup[l].Height>0&&(a.Height=this.lstGroup[l].Height),a.Type=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Group,a.LevelNo=l;var o=this.ReportColumns.find(e=>e.ID==this.lstGroup[l].ShowUnder);let n=0;if(o&&-1==this.lstGroup[l].Width&&(n=this.ReportColumns.indexOf(o)),-1==this.lstGroup[l].Width&&null==o&&(a.Cells[0].ColSpan=this.ReportColumns.length),null!=this.lstGroup[l].Type&&""!=this.lstGroup[l].Type&&"DATE"==this.lstGroup[l].Type)try{this.SetCellValue(this.lstGroup[l].Prefix+new Date(e[t][this.lstGroup[l].ID]).ToString(this.lstGroup[l].GroupFormat.DateType),this.lstGroup[l].GroupFormat,this.lstGroup[l].Type,a.Cells[n])}catch(i){this.SetCellValue(this.lstGroup[l].Prefix+e[t][this.lstGroup[l].ID].toString(),this.lstGroup[l].GroupFormat,this.lstGroup[l].Type,a.Cells[n])}else this.SetCellValue(this.lstGroup[l].Prefix+e[t][this.lstGroup[l].ID].toString(),this.lstGroup[l].GroupFormat,this.lstGroup[l].Type,a.Cells[n]);a.Cells[n].DataFormat=this.lstGroup[l].GroupFormat,this.Groupstr[this.lstGroup[l].ID]=e[t][this.lstGroup[l].ID].toString(),a.Cells[n].CellAppearance=this.lstGroup[l].GroupAppearance,a.Cells[n].IsNormal=!1,a.Cells[n].level=0,this.lstGroup[l].Height>0&&(a.Cells[n].height=this.lstGroup[l].Height),a.PrintVisible=this.lstGroup[l].GroupAppearance.IsPrintVisible,this.lstGroup[l].ShowAsColumn||(this.iGroupRowsAdded=0,this.lstGroup[l].GroupAppearance.IsVisible&&this.addRow(a)),this.iTopGroupSummaryConsider||(this.iGroupRowsAdded=0)}}CheckAndAddSubTotals(e){for(let t=this.lstGroup.length;t>0;t--)e.length>0&&this.AddSubtotals(e[e.length-1],this.lstGroup[t-1],t),this.Groupstr[this.lstGroup[t-1].ID]=null}CheckAndAddTotals(e){for(let t=this.lstGroup.length;t>0;t--)e.length>0&&this.AddSubtotals(e[e.length-1],this.lstGroup[t-1],t),this.Groupstr[this.lstGroup[t-1].ID]=null;this.GrpReportTotal.SubTotalAppearance.IsVisible&&this.AddSubtotals_RT(this.GrpReportTotal,0)}UpdateTreeTotals(e){for(let s=this.lstTotal.length-1;s>e;s--){if(this.FormulaColumns.length>0&&null!=this.lstParents[s].DataRow)for(let e=0;e<this.ReportColumns.length;e++)"FLOAT"==this.ReportColumns[e].ColumnType&&e!=this.colSNoIndex&&Object.keys(this.lstParents[s].DataRow).Contains(this.ReportColumns[e].ID)&&(this.lstParents[s].DataRow[this.ReportColumns[e].ID]=this.lstTotal[s][e]);if(s>0)for(let e=0;e<this.lstTotal[s].length;e++)this.lstTotal[s-1][e]+=this.lstTotal[s][e];if(!this.GroupTotalsAtEnd||this.DontShowSummaryGroupTotals&&!this.lstParents[s].IsExpanded)for(let e=0;e<this.ReportColumns.length;e++)if("FLOAT"==this.ReportColumns[e].ColumnType&&e!=this.colSNoIndex)if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.ReportColumns[e].DataFormat.PercentageOn))this.SetCellValue(2==this.ReportColumns[e].EvaluateAtEnd&&""!=this.ReportColumns[e].Formula&&this.FormulaColumns.length>0&&null!=this.lstParents[s].DataRow?this.CalculateFormula_1(this.ReportColumns[e].Formula,this.lstParents[s].DataRow,[]):this.lstTotal[s][e],this.ReportColumns[e].DataFormat,"FLOAT",this.lstParents[s].Cells[e]);else{let o=0,i=this.lstTotal[s][e];if("REPORT_TOTAL"==this.ReportColumns[e].DataFormat.PercentageOn)o=this.PercentTotals[e];else if(this.GrpReportTotal.TotalCols.ContainsKey(this.ReportColumns[e].DataFormat.PercentageOn))o=this.lstTotal[s][this.GrpReportTotal.TotalCols[this.ReportColumns[e].DataFormat.PercentageOn]];else{var t=this.HiddenNumericColumns.find(t=>t.ID==this.ReportColumns[e].DataFormat.PercentageOn);t&&(o=this.lstTotal[s][this.ReportColumns.length+this.HiddenNumericColumns.indexOf(t)])}if(0==i||0==o)continue;o=100*i/o,null!=this.lstParents[s].DataRow&&Object.keys(this.lstParents[s].DataRow).Contains(this.ReportColumns[e].ID)&&(this.lstParents[s].DataRow[this.ReportColumns[e].ID]=o),this.SetCellValue(o,this.ReportColumns[e].DataFormat,"FLOAT",this.lstParents[s].Cells[e])}if(e<=this.LevelNo){let e=!1;if(!this.Filter.ShowAllTreeData.IsChecked){let t;for(t=0;t<this.ReportColumns.length&&0==this.lstTotal[s][t];t++);t==this.ReportColumns.length&&(e=!0,this.removeRow(this.lstParents[s]))}if(!e){let e=this.Data.indexOf(this.lstParents[s]);if(e>=0)if(!this.GroupTotalsAtEnd||this.DontShowSummaryGroupTotals&&!this.lstParents[s].IsExpanded)this.removeRow(this.lstParents[s]),this.insertRowAt(this.lstParents[s],e);else{let e=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(this.ReportColumns.length,this.RowHeight);this.RowHeight>0&&(e.Height=this.RowHeight);for(let t=0;t<e.Cells.length;t++)e.Cells[t].IsNormal=!1,e.Cells[t].CellAppearance=this.ReportColumns[t].DataAppearance.Clone(),e.Cells[t].CellAppearance.IsBold=!0;e.Type=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.BalanceBF,e.Parent=this.lstParents[s].Parent,e.LevelNo=this.lstParents[s].LevelNo,e.Cells[1].IsNormal=!1,e.IsGroup=!0,e.Visible=this.lstParents[s].Visible,e.Cells[0].level=this.lstParents[s].LevelNo,e.Cells[0].Text=this.lstParents[s].Cells[1].Text+" - Total ",e.Cells[0].CellAppearance.Alignment="Right",e.Cells[0].ColSpan=0,this.TreeTotalBorder<0&&e.Cells.map(e=>e.Border=this.TreeTotalBorder);for(let t=0;t<this.ReportColumns.length;t++)"FLOAT"==this.ReportColumns[t].ColumnType&&(0==e.Cells[0].ColSpan&&(e.Cells[0].ColSpan=t),e.Cells[t].IsNormal=!1,e.Cells[t].Border=this.TreeTotalBorder,this.SetCellValue(2==this.ReportColumns[t].EvaluateAtEnd&&""!=this.ReportColumns[t].Formula&&this.FormulaColumns.length>0&&null!=this.lstParents[s].DataRow?this.CalculateFormula_1(this.ReportColumns[t].Formula,this.lstParents[s].DataRow,[]):this.lstTotal[s][t],this.ReportColumns[t].DataFormat,"FLOAT",e.Cells[t]));0==e.Cells[0].ColSpan&&(e.Cells[0].ColSpan=1),this.addRow(e)}}}this.lstParents.RemoveAt(s),this.lstTotal.RemoveAt(s)}}CalculateFormula_1(e,t,s){try{for(let e=0;e<this.fldDict.keys.length;e++){let i={Key:this.fldDict.keys[e]};if(Object(util__WEBPACK_IMPORTED_MODULE_24__.isNullOrUndefined)(t[i.Key])){var o=this.ReportColumns.find(e=>e.ID==i.Key);if(o){let e=0;o.Row>0&&s.length>=o.Row&&(e=o.Row),e<s.length&&!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(s[e].Cells[this.ReportColumns.indexOf(o)].Text)?this.fldDict[i.Key].setFieldValue(s[e].Cells[this.ReportColumns.indexOf(o)].Text):this.fldDict[i.Key].setFieldValue("FLOAT"==o.ColumnType?0:"")}else this.fldDict[i.Key].setFieldValue("")}else this.fldDict[i.Key].setFieldValue(t[i.Key])}return this.fldDict.FROMDATE.setFieldValue(this.FromDatePicker.Date),this.fldDict.TODATE.setFieldValue(this.ToDatePicker.Date),this.fldDict.SYSTEMDATE.setFieldValue(this.SystemDate),this.fldDict.SYSTEMDATETIME.setFieldValue(this.SystemDateTime),this.fldDict.CURRENT_YEARSTART.setFieldValue(this.Current_YearStartDate),this.fldDict.PRV_YEARSTART.setFieldValue(this.PRV_YEARSTART),this.fldDict.PRV_YEARFROMDATE.setFieldValue(this.PRV_YEARFROMDATE),this.fldDict.PRV_YEARTODATE.setFieldValue(this.PRV_YEARTODATE),this.fldDict.CURRENT_MONTHSTART.setFieldValue(this.CURRENT_MONTHSTART),this.fldDict.PRV_MONTHSTART.setFieldValue(this.PRV_MONTHSTART),this.fldDict.PRV_MONTHEND.setFieldValue(this.PRV_MONTHEND),this.fldDict.LOGIN_USER.setFieldValue(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.UserName),this.eval.EvaluateExpression(e,this.fldDict).toString()}catch(i){Logger.ErrorLog("ReportViewModel::Error CalculateFormula",i)}return""}CalculateFormula_2(e,t,s=!1){let o=this.fldDict;for(let l=0;l<this.fldDict.keys.length;l++){let e={Key:this.fldDict.keys[l]};Object.keys(t).Contains(e.Key)?this.fldDict[e.Key].setFieldValue(null!=t[e.Key]?t[e.Key]:""):this.fldDict[e.Key].setFieldValue(0)}if(this.fldDict.FROMDATE.setFieldValue(this.FromDatePicker.Date),this.fldDict.TODATE.setFieldValue(this.ToDatePicker.Date),this.fldDict.SYSTEMDATE.setFieldValue(this.SystemDate),this.fldDict.SYSTEMDATETIME.setFieldValue(this.SystemDateTime),this.fldDict.CURRENT_YEARSTART.setFieldValue(this.Current_YearStartDate),this.fldDict.PRV_YEARSTART.setFieldValue(this.PRV_YEARSTART),this.fldDict.PRV_YEARFROMDATE.setFieldValue(this.PRV_YEARFROMDATE),this.fldDict.PRV_YEARTODATE.setFieldValue(this.PRV_YEARTODATE),this.fldDict.CURRENT_MONTHSTART.setFieldValue(this.CURRENT_MONTHSTART),this.fldDict.PRV_MONTHSTART.setFieldValue(this.PRV_MONTHSTART),this.fldDict.PRV_MONTHEND.setFieldValue(this.PRV_MONTHEND),this.fldDict.LOGIN_USER.setFieldValue(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.UserName),!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Formula))try{t[e.ID]=this.eval.EvaluateExpression(e.Formula,o).toString()}catch(i){console.log("Formula Error: ",i)}if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.ColumnFilterExpression)&&(s||(!this.IsSummaryGroupsExists||0==e.EvaluateAtEnd)&&2!=e.EvaluateAtEnd&&3!=e.EvaluateAtEnd)){this.fldDict.ContainsKey(e.ID)&&this.fldDict[e.ID].setFieldValue(t[e.ID]);try{if("0"==this.eval.EvaluateExpression(e.ColumnFilterExpression,o).toString())return!0}catch(i){console.log("Formula Column expr Error: ",i)}}return!1}CalculateFormulaForSummary(e,t){let s=this.fldDict;for(let l=0;l<this.fldDict.keys.length;l++){let e={Key:this.fldDict.keys[l]};Object(util__WEBPACK_IMPORTED_MODULE_24__.isUndefined)(t[e.Key])?this.fldDict[e.Key].setFieldValue(0):this.fldDict[e.Key].setFieldValue(null!=t[e.Key]?t[e.Key]:"")}if(this.fldDict.FROMDATE.setFieldValue(this.FromDatePicker.Date),this.fldDict.TODATE.setFieldValue(this.ToDatePicker.Date),this.fldDict.SYSTEMDATE.setFieldValue(this.SystemDate),this.fldDict.SYSTEMDATETIME.setFieldValue(this.SystemDateTime),this.fldDict.CURRENT_YEARSTART.setFieldValue(this.Current_YearStartDate),this.fldDict.PRV_YEARSTART.setFieldValue(this.PRV_YEARSTART),this.fldDict.PRV_YEARFROMDATE.setFieldValue(this.PRV_YEARFROMDATE),this.fldDict.PRV_YEARTODATE.setFieldValue(this.PRV_YEARTODATE),this.fldDict.CURRENT_MONTHSTART.setFieldValue(this.CURRENT_MONTHSTART),this.fldDict.PRV_MONTHSTART.setFieldValue(this.PRV_MONTHSTART),this.fldDict.PRV_MONTHEND.setFieldValue(this.PRV_MONTHEND),this.fldDict.LOGIN_USER.setFieldValue(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.UserName),!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Formula))try{t[e.ID]=this.eval.EvaluateExpression(e.Formula,s).toString()}catch(o){}if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.ColumnFilterExpression)){this.fldDict.ContainsKey(e.ID)&&this.fldDict[e.ID].setFieldValue(t[e.ID]);try{if("0"==this.eval.EvaluateExpression(e.ColumnFilterExpression,s).toString())return!0}catch(i){}}return!1}CalculateFormula_out_int(e,t,s){let o=this.fldDict;s.result=0;for(let a=0;a<this.fldDict.keys.length;a++){let e={Key:this.fldDict.keys[a]};t.ContainsKey(e.Key)?this.fldDict[e.Key].setFieldValue(t[e.Key]):this.fldDict[e.Key].setFieldValue(0)}if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Formula))try{s.result=parseFloat(this.eval.EvaluateExpression(e.Formula,o)),this.fldDict.ContainsKey(e.ID)&&this.fldDict[e.ID].setFieldValue(s.result)}catch(i){}if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.ColumnFilterExpression))try{if("0"==this.eval.EvaluateExpression(e.ColumnFilterExpression,o).toString())return!0}catch(l){}return!1}CalculateFormula_out_obj(e,t,s){let o=this.fldDict;s.result=null;for(let l=0;l<this.fldDict.keys.length;l++){let e={Key:this.fldDict.keys[l]};t.ContainsKey(e.Key)?this.fldDict[e.Key].setFieldValue(t[e.Key]):this.fldDict[e.Key].setFieldValue(0)}if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Formula)||(s.result=this.eval.EvaluateExpression(e.Formula,o),this.fldDict.ContainsKey(e.ID)&&this.fldDict[e.ID].setFieldValue(s.result)),!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.ColumnFilterExpression))try{if("0"==this.eval.EvaluateExpression(e.ColumnFilterExpression,o).toString())return!0}catch(i){}return!1}SetCellValue(e,t,s,o){ReportViewModel.SetCellValue(e,t,s,-1,o)}static SetCellValue(e,t,s,o,i){try{let l;i.IsNegativeRed=!1;let a=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(e);if("FLOAT"!=s&&"INT"!=s||!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNum(a))if(0==a.length||a.startsWith("<FlowDocument"))i.Text=a,i.Value=a;else if("DATE"==s)if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.isValidDate(a)&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.isDateOrNum(a))i.Value=new Date(a),i.Text=ReportViewModel.GetFormattedDate(i.Value,t.DateType);else if(a.Contains(",")){let e=a.split(",");i.Text="",i.Value=a;for(let s=0;s<e.length;s++){let o=e[s];0!=o.length&&(i.Text.length>0&&(i.Text+=", "),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.isValidDate(o)?i.Text+=ReportViewModel.GetFormattedDate(new Date(o),t.DateType):i.Text+=o)}}else i.Text=a,i.Value=a;else i.Text=a,i.Value=a;else{let e;if(l=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(a),e=-1==o?t.RoundOff:0==o?t.RoundOff_RT:t.RoundOff_ST.length>=o?t.RoundOff_ST[o-1]:0,e>0){let t=l%e;t<e/2?l-=t:l=l+e-t}if(t.SuppressZero&&0==l)return i.Text=null,void(i.Value=0);let s="";if(t.NumberFormat.length>0)if(s=ReportViewModel.NumbetFormatted(l,t),l<0)switch(t.NegativeNumber){case 1:i.IsNegativeRed=!0;break;case 2:s="("+s+")";break;case 3:i.IsNegativeRed=!0,s="("+s+")";break;case 4:case 7:s+=" Cr";break;case 5:s+=" Dr";break;case 8:s="+"+s}else if(0!=t.ShowDefaultSign)switch(t.NegativeNumber){case 4:s+=" Dr";break;case 5:s+=" Cr"}else switch(t.NegativeNumber){case 2:s="("+s+")";break;case 6:s="+"+s;break;case 7:s+=" Dr";break;case 8:s="-"+s}else{let e="";if(e=t.DecimalsPoints>0?"N"+t.DecimalsPoints.toString():"N0",l<0)switch(t.NegativeNumber){case 1:i.IsNegativeRed=!0,s=l.Commas(e).Replace("-","");break;case 2:s="("+l.Commas(e).Replace("-","")+")";break;case 3:i.IsNegativeRed=!0,s="("+l.Commas(e).Replace("-","")+")";break;case 4:case 7:s=(-l).Commas(e)+"Cr";break;case 5:s=(-l).Commas(e)+"Dr";break;case 8:s="+"+(-l).Commas(e);break;case 12:s=(-l).Commas(e)}else if(0!=t.ShowDefaultSign)switch(t.NegativeNumber){case 4:s=l.Commas(e)+"Dr";break;case 5:s=l.Commas(e)+"Cr"}else switch(t.NegativeNumber){case 2:s="("+l.Commas(e)+")";break;case 6:s="+"+l.Commas(e);break;case 7:s=l.Commas(e)+"Dr";break;case 8:s="-"+l.Commas(e)}_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(s)&&(s=l.Commas(e))}i.Value=l,_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(t.PercentageOn)||(s+="%"),i.Text=s}}catch(l){Logger.ErrorLog("ReportViewModel::Error GetFormattedData",l.stack)}}RoundOff_2(e,t){return 0==e?e:this.RoundOff_3(e,t,-1)}RoundOff_3(e,t,s){if(0==e)return e;let o=0;if(o=-1==s?t.RoundOff:0==s?t.RoundOff_RT:t.RoundOff_ST.length>=s?t.RoundOff_ST[s-1]:0,o>0){let t=e%o;t<o/2?e-=t:e=e+o-t}return t.NumberFormat.length>0?e:e=t.DecimalsPoints>0?parseFloat(e.ToString("N"+t.DecimalsPoints.toString())):parseFloat(e.ToString("N0"))}static NumbetFormatted(e,t){ReportViewModel.fldDictNumFormat||ReportViewModel.ReportViewModel();let s=ReportViewModel.fldDictNumFormat,o=e;e<0&&(t.NegativeNumber>=1&&t.NegativeNumber<=5||7==t.NegativeNumber||8==t.NegativeNumber||12==t.NegativeNumber)&&(o=-o),ReportViewModel.fldDictNumFormat.value.setFieldValue(o),ReportViewModel.fldDictNumFormat.Value.setFieldValue(o),ReportViewModel.fldDictNumFormat.VALUE.setFieldValue(o);try{return ReportViewModel.evalNumFormat.EvaluateExpression(t.NumberFormat,s).toString()}catch(i){return"#"}}static GetFormattedDate(e,t){return _services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("Hijri Date")&&""!=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Hijri Date"]&&Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Hijri Date"])?_services_session_manager_service__WEBPACK_IMPORTED_MODULE_26__.a.ConvertGregtoHijri(e):e.ToString(""!=t?t:_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Date Format"])}AddSubtotals(e,t,s){try{let a,n,r=0,h=0,u=0,D=0,d="";_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(t.SubTotalCaptionID)?_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e[t.ID])||(d=e[t.ID].toString()):(t.SubTotalShowCaption=10,_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e[t.SubTotalCaptionID])||(d=e[t.SubTotalCaptionID].toString())),null!=this.SubTotalBeforeCallBack&&this.SubTotalBeforeCallBack.Call(s),n=new Array(s-1<this.STMaxRowsUnder.length&&this.MaxRowsUnder<this.STMaxRowsUnder[s-1]?this.STMaxRowsUnder[s-1]+1:this.MaxRowsUnder+1);let c=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(this.ReportColumns.length,t.SubTotalHeight);if(t.SubTotalBorder<0&&c.Cells.forEach(e=>{e.Border=t.SubTotalBorder}),c.LevelNo=s,n[0]=c,"Detailed"==t.DisplayMode){t.SubTotalShowAtCollapse&&c.LevelNo--;var o=this.ReportColumns.find(e=>e.ID==t.SubTotalShowUnder);if(o&&(r=this.ReportColumns.indexOf(o)),t.TotalCols.length>0){let e=Math.min.apply(null,t.TotalCols.values);c.Cells[r].ColSpan=e-r,c.Cells[r].ColSpan<=0&&(c.Cells[r].ColSpan=1)}for(let e=0;e<=this.MaxRowsUnder;e++)null==n[e]&&(n[e]=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(this.ReportColumns.length,t.SubTotalHeight),t.SubTotalBorder<0&&n[e].Cells.forEach(e=>{e.Border=t.SubTotalBorder}),n[e].Type=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.SubTotal,n[e].LevelNo=s,n[e].Cells[r].ColSpan=c.Cells[r].ColSpan,t.SubTotalShowAtCollapse&&n[e].LevelNo--),a=n[e],a.Type=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.SubTotal,0!=t.SubTotalShowCaption&&e<t.SubTotalPrefix.length&&(1==t.SubTotalShowCaption?(this.SetCellValue(d,t.GroupFormat,t.Type,a.Cells[r]),a.Cells[r].Text=t.SubTotalPrefix[e]+a.Cells[r].Text):2==t.SubTotalShowCaption?a.Cells[r].Text=t.SubTotalPrefix[e]:10==t.SubTotalShowCaption&&this.SetCellValue(d,t.GroupFormat,t.Type,a.Cells[r]),a.Cells[r].DataFormat=t.GroupFormat,a.Cells[r].CellAppearance=t.SubTotalAppearance,a.Cells[r].IsNormal=!1,a.Cells[r].level=s);for(let e=0;e<t.TotalCols.keys.length;e++){let o={Key:t.TotalCols.keys[e],Value:t.TotalCols.values[e]};var i=this.ReportColumns.find(e=>e.ID==o.Key);if(i?u=this.totals[o.Value][s]:(i=this.HiddenNumericColumns.find(e=>e.ID==o.Key),u=this.hiddenTotals[o.Value][s]),!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(i.DataFormat.PercentageOn)){if(D=0,"REPORT_TOTAL"==i.DataFormat.PercentageOn?D=this.PercentTotals[o.Value]:t.TotalCols.ContainsKey(i.DataFormat.PercentageOn)&&(D=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(this.totals[t.TotalCols[i.DataFormat.PercentageOn]][s])),0==u||0==D)continue;u=100*u/D}if(null!=i.DataFormat.STUnder&&i.DataFormat.STUnder.ContainsKey(s-1)?(h=i.DataFormat.STUnder[s-1].Row,r=i.DataFormat.STUnder[s-1].Column):(h=i.Row,r=0==i.Row?o.Value:i.Column),null==n[h]&&(n[h]=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(this.ReportColumns.length,t.SubTotalHeight),t.SubTotalBorder<0&&n[h].Cells.forEach(e=>{e.Border=t.SubTotalBorder}),n[h].Type=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.SubTotal,n[h].LevelNo=s,null!=i.DataFormat.STUnder&&i.DataFormat.STUnder.ContainsKey(s-1)&&ReportViewModel.SetCellValue(i.DataFormat.STUnder[s-1].Caption,i.DataFormat,"STRING",s,n[h].Cells[r-1])),i.DataFormat.ShowAvg){if(!(this.iCurrGroupDetailRows>0))continue;u/=this.iCurrGroupDetailRows}a=n[h],ReportViewModel.SetCellValue(u,i.DataFormat,"FLOAT",s,a.Cells[r]),a.Cells[r].DataFormat=t.SubTotalFormat,this.ReportColumns[r].DataAppearance.Alignment==t.SubTotalAppearance_Data.Alignment?a.Cells[r].CellAppearance=t.SubTotalAppearance_Data:(a.Cells[r].CellAppearance=t.SubTotalAppearance_Data.Clone(),a.Cells[r].CellAppearance.Alignment=this.ReportColumns[r].DataAppearance.Alignment),a.Cells[r].Border=t.SubTotalBorder,a.Cells[r].IsNormal=!1,t.SubTotalHeight>0&&(a.Cells[r].height=t.SubTotalHeight)}this.iCurrGroupDetailRows=0}else{if(this.TopRecords>0&&!this.IsDefaultSortColumnExists&&this.iGroupRowsAdded>=this.TopRecords){for(let e=0;e<this.ReportColumns.length;e++)this.totals[e][s-1]+=this.totals[e][s],this.totals[e][s]=0;for(let e=0;e<this.HiddenNumericColumns.length;e++)this.hiddenTotals[e][s-1]+=this.hiddenTotals[e][s],this.hiddenTotals[e][s]=0;return this.lstSummaryAplha.values.map(e=>e.Clear()),this.lstSummaryDistinctNumeric.values.map(e=>e.Clear()),void this.lstSummaryCells.values.map(e=>e.Clear())}let o;c.Type=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Detail;let i=null;if(null!=this.ReportSummaryData){i={};for(let t=0;t<this.lstGroup.length;t++)Object(util__WEBPACK_IMPORTED_MODULE_24__.isUndefined)(e[this.lstGroup[t].ID])||(i[this.lstGroup[t].ID]=e[this.lstGroup[t].ID]);this.ColumnSourceALL.forEach(t=>{"FLOAT"==t.ColumnType||Object(util__WEBPACK_IMPORTED_MODULE_24__.isUndefined)(e[t.ID])||(i[t.ID]=e[t.ID],Object(util__WEBPACK_IMPORTED_MODULE_24__.isUndefined)(e[t.ID+"_ID"])||(i[t.ID+"_ID"]=e[t.ID+"_ID"]),Object(util__WEBPACK_IMPORTED_MODULE_24__.isUndefined)(e[t.ID+"_DID"])||(i[t.ID+"_DID"]=e[t.ID+"_DID"]))})}if(!this.IsFilterRendering&&this.FormulaColumns.length>0){let o,i=!1;for(let l=0;l<this.FormulaColumns.length;l++){let a=this.FormulaColumns[l];if((""!=a.Formula||""!=a.ColumnFilterExpression)&&1==a.EvaluateAtEnd){u=0,o=null;for(let o=0;o<this.ReportColumns.length;o++)(t.TotalCols.ContainsKey(this.ReportColumns[o].ID)||"FLOAT"==this.ReportColumns[o].ColumnType||"INT"==this.ReportColumns[o].ColumnType)&&(Object(util__WEBPACK_IMPORTED_MODULE_24__.isUndefined)(e[this.ReportColumns[o].ID])||(e[this.ReportColumns[o].ID]=this.totals[o][s]));for(let t=0;t<this.HiddenNumericColumns.length;t++)e[this.HiddenNumericColumns[t].ID]=this.hiddenTotals[t][s];if(i=this.CalculateFormulaForSummary(a,e),i){for(let e=0;e<this.ReportColumns.length;e++)this.totals[e][s]=0;for(let e=0;e<this.HiddenNumericColumns.length;e++)this.hiddenTotals[e][s]=0;return this.lstSummaryAplha.values.map(e=>e.Clear()),this.lstSummaryDistinctNumeric.values.map(e=>e.Clear()),void this.lstSummaryCells.values.map(e=>e.Clear())}_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(a.Formula)||t.TotalCols.ContainsKey(a.ID)&&(u=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(e[a.ID]),this.totals[t.TotalCols[a.ID]][s]=u)}}}for(let l=0;l<this.ReportColumns.length;l++){if(null==n[this.ReportColumns[l].Row]&&(n[this.ReportColumns[l].Row]=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(this.ReportColumns.length,t.SubTotalHeight),n[this.ReportColumns[l].Row].Type=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.SubTotal,n[this.ReportColumns[l].Row].LevelNo=s),a=n[this.ReportColumns[l].Row],r=0==this.ReportColumns[l].Row?l:this.ReportColumns[l].Column,o=null,t.TotalCols.ContainsKey(this.ReportColumns[l].ID)?o=this.totals[t.TotalCols[this.ReportColumns[l].ID]][s]:Object(util__WEBPACK_IMPORTED_MODULE_24__.isUndefined)(e[this.ReportColumns[l].ID])||(o=e[this.ReportColumns[l].ID]),"DATE"==this.ReportColumns[l].ColumnType){if(this.lstSummaryCells.ContainsKey(this.ReportColumns[l].ID)&&this.lstSummaryCells[this.ReportColumns[l].ID].length>0&&(0==this.ReportColumns[l].EvaluateAtEnd||_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.ReportColumns[l].Formula))){if(o=this.lstSummaryCells[this.ReportColumns[l].ID][0].Value,this.lstSummaryCells[this.ReportColumns[l].ID].Count>1){null!=i&&(i[this.ReportColumns[l].ID]=o),this.sbSummaryDimensions="";for(let e=0;e<this.lstSummaryCells[this.ReportColumns[l].ID].length;e++)e>0&&(this.sbSummaryDimensions+=","),this.sbSummaryDimensions+=this.lstSummaryCells[this.ReportColumns[l].ID][e].Value.toString();this.lstSummaryCells[this.ReportColumns[l].ID].Clear(),o=this.sbSummaryDimensions.toString(),ReportViewModel.SetCellValue(o,this.ReportColumns[l].DataFormat,this.ReportColumns[l].ColumnType,s,a.Cells[r]);continue}this.lstSummaryCells[this.ReportColumns[l].ID].Clear()}}else if(this.lstSummaryAplha.ContainsKey(this.ReportColumns[l].ID)&&this.lstSummaryAplha[this.ReportColumns[l].ID].length>0||this.lstRepeatSummaryAplha.ContainsKey(this.ReportColumns[l].ID)&&this.lstRepeatSummaryAplha[this.ReportColumns[l].ID].length>0){let e;if(e=this.lstSummaryAplha.ContainsKey(this.ReportColumns[l].ID)&&this.lstSummaryAplha[this.ReportColumns[l].ID].length>0?this.lstSummaryAplha[this.ReportColumns[l].ID]:this.lstRepeatSummaryAplha[this.ReportColumns[l].ID],"FLOAT"!=this.ReportColumns[l].ColumnType&&"INT"!=this.ReportColumns[l].ColumnType&&(0==this.ReportColumns[l].EvaluateAtEnd||_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.ReportColumns[l].Formula))){this.sbSummaryDimensions="";for(let t=0;t<e.length;t++)t>0&&(this.sbSummaryDimensions+=","),this.sbSummaryDimensions+=e[t];o=this.sbSummaryDimensions.toString(),e.Clear()}}else if(-1==this.ReportColumns[l].UseOnce&&this.lstSummaryDistinctNumeric.ContainsKey(this.ReportColumns[l].ID)&&this.lstSummaryDistinctNumeric[this.ReportColumns[l].ID].length>0&&(0==this.ReportColumns[l].EvaluateAtEnd||_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.ReportColumns[l].Formula))){this.sbSummaryDimensions="";let e=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.c;for(let t=0;t<this.lstSummaryDistinctNumeric[this.ReportColumns[l].ID].length;t++)t>0&&(this.sbSummaryDimensions+=","),this.SetCellValue(this.lstSummaryDistinctNumeric[this.ReportColumns[l].ID][t],this.ReportColumns[l].DataFormat,"FLOAT",e),this.sbSummaryDimensions+=e.Text;o=this.sbSummaryDimensions.toString(),this.lstSummaryDistinctNumeric[this.ReportColumns[l].ID].Clear()}if(-1!=this.ReportColumns[l].DataFormat.CumTotal){let e=0;e=this.totals[t.TotalCols[this.ReportColumns[l].ID]][s-1],u=e,o=e}if(-1!=this.ReportColumns[l].PrevRowValueInd&&(o=0==this.Data.length||this.Data[this.Data.length-1].Type!=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Detail?"0.0":this.Data[this.Data.length-1].Cells[this.ReportColumns[l].PrevRowValueInd].Value),null!=o&&null!=o){if(-1==this.ReportColumns[l].UseOnce){null!=i&&(i["DISTINCT"+this.ReportColumns[l].ID]=o),ReportViewModel.SetCellValue(o,this.ReportColumns[l].DataFormat,"",s,a.Cells[r]);continue}_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.ReportColumns[l].DataFormat.PercentageOn)||(u=this.totals[t.TotalCols[this.ReportColumns[l].ID]][s],D="REPORT_TOTAL"==this.ReportColumns[l].DataFormat.PercentageOn?this.PercentTotals[l]:_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(this.totals[t.TotalCols[this.ReportColumns[l].DataFormat.PercentageOn]][s]),0!=u&&0!=D?this.IsFilterRendering?(o=u,u=D*this.totals[t.TotalCols[this.ReportColumns[l].ID]][s]/100,this.totals[t.TotalCols[this.ReportColumns[l].ID]][s]=u):(u=100*u/D,o=u):o=null),null!=i&&(i[this.ReportColumns[l].ID]=o),ReportViewModel.SetCellValue(o,this.ReportColumns[l].DataFormat,this.ReportColumns[l].ColumnType,s,a.Cells[r]),this.ReportColumns[l].DataFormat.PrintOnce&&this.Data.length>0&&this.Data[this.Data.length-1].LevelNo==a.LevelNo&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(a.Cells[r].Value)==_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(this.Data[this.Data.length-1].Cells[l].Value)&&(a.Cells[r].Text="")}}null!=i?(n[0].DataRow=i,t.SubTotalAppearance.IsVisible&&this.ReportSummaryData.push(i)):null!=e&&(n[0].DataRow=e)}if(this.Data.length>0&&this.Data[this.Data.length-1].Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Group&&"Detailed"==t.DisplayMode)this.IsNoDataGroups||this.removeRowAt(this.Data.length-1);else{if(t.SubTotalAppearance.IsVisible&&(this.iGroupRowsAdded++,"Summary"==t.DisplayMode&&(this.iCurrGroupDetailRows++,-1!=this.colSNoIndex&&(n[0].Cells[this.colSNoIndex].Value=++this.SNo,n[0].Cells[this.colSNoIndex].Text=this.SNo.toString()),this.ApplyKPI(n[0])),-1!=t.SubTotalHeight&&(1==n.length?null!=n[0]&&(n[0].PrintVisible=t.SubTotalAppearance.IsPrintVisible,this.addRow(n[0])):n.forEach(e=>{e&&e.Cells.find(e=>!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Text))&&(e.PrintVisible=t.SubTotalAppearance.IsPrintVisible,this.addRow(e))}))),this.MergeChildReport&&this.Data[0].Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Group&&"Summary"!=t.DisplayMode&&1==s){var l=this.ParentReport.Data.find(e=>e.Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Group&&e.Cells[0].Text==this.Data[0].Cells[0].Text);if(null!=this.childReportColumnHeader&&(this.childReportColumnHeader.LevelNo=this.Data[0].LevelNo+1,this.insertRowAt(this.childReportColumnHeader,1)),null!=this.childReportTitle&&(this.childReportTitle.LevelNo=this.Data[0].LevelNo+1,this.insertRowAt(this.childReportTitle,1)),null!=l){this.removeRow(this.Data[0]);let e=this.ParentReport.Data.indexOf(l)+1;for(;e<this.ParentReport.Data.length&&!(this.ParentReport.Data[e].LevelNo<=l.LevelNo);e++);this.ParentReport.PrintSeperateInSubReports&&this.ParentReport.dicSubReportStart.push(e,this.Data.length),this.Data.forEach(t=>{t.Parent=l,this.ParentReport.insertRowAt(t,e),e++})}else if(this.ParentReport.GrpReportTotal.SubTotalAppearance.IsVisible){let e=this.ParentReport.Data.length-1;e>=0&&this.Data.forEach(t=>{this.ParentReport.insertRowAt(t,e),e++})}else this.Data.forEach(e=>{this.ParentReport.addRow(e)});this.Data.Clear()}null!=this.SubTotalCallBack&&this.SubTotalCallBack.Call(s)}if(this.IsSummary=!1,s>0){for(let e=0;e<this.ReportColumns.length;e++)this.ReportColumns[e].DataFormat.CumTotal<0?("$TOTALHOURS$"==this.ReportColumns[e].Formula&&0!=this.totals[e][s-1]?this.totals[e][s-1]=ReportViewModel.GetHoursSum(this.totals[e][s-1],this.totals[e][s]):this.totals[e][s-1]+=this.totals[e][s],this.totals[e][s]=0):(s==this.ReportColumns[e].DataFormat.CumTotal&&(this.totals[e][this.lstGroup.length]=0),s==this.ReportColumns[e].DataFormat.CumTotal-1&&(this.totals[e][s]=0));for(let e=0;e<this.HiddenNumericColumns.length;e++)this.HiddenNumericColumns[e].DataFormat.CumTotal<0?(this.hiddenTotals[e][s-1]+=this.hiddenTotals[e][s],this.hiddenTotals[e][s]=0):(s==this.HiddenNumericColumns[e].DataFormat.CumTotal&&(this.hiddenTotals[e][this.lstGroup.length]=0),s==this.HiddenNumericColumns[e].DataFormat.CumTotal-1&&(this.hiddenTotals[e][s]=0))}}catch(a){Logger.ErrorLog("ReportViewModel::Error AddSubtotals",a.stack)}}AddSubtotals_RT(e,t){try{let a,n=!1,r=0,h=0;-100==t&&(t=0,n=!0);let u=new Array(this.MaxRowsUnder+1),D=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(this.ReportColumns.length,24);u[0]=D,e.SubTotalBorder<0&&D.Cells.map(t=>t.Border=e.SubTotalBorder);var s=this.ReportColumns.find(t=>t.ID==e.SubTotalShowUnder);let d=0;if(s&&(d=this.ReportColumns.indexOf(s)),e.TotalCols.length>0){let t=Math.min.apply(null,e.TotalCols.values);D.Cells[d].ColSpan=t-d,D.Cells[d].ColSpan<=0&&(D.Cells[d].ColSpan=1)}for(let s=0;s<=this.MaxRowsUnder;s++)null==u[s]&&(u[s]=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(this.ReportColumns.length,24),u[s].Type=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.SubTotal,u[s].LevelNo=t+1,u[s].Cells[d].ColSpan=D.Cells[d].ColSpan,e.SubTotalBorder<0&&u[s].Cells.map(t=>t.Border=e.SubTotalBorder)),a=u[s],e.SubTotalHeight>0&&(u[s].Height=e.SubTotalHeight),a.Type=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.ReportTotal,n?(a.Cells[d].Text=this.GrandTotalTextInSubReports,a.Cells[d].DataFormat=e.GroupFormat,a.Cells[d].CellAppearance=e.GroupAppearance,a.Cells[d].IsNormal=!1,a.Cells[d].level=0):s<e.SubTotalPrefix.length&&(a.Cells[d].Text=e.SubTotalPrefix[s],a.Cells[d].DataFormat=e.GroupFormat,a.Cells[d].CellAppearance=e.GroupAppearance,a.Cells[d].IsNormal=!1,a.Cells[d].level=0);for(let s=0;s<e.TotalCols.length;s++){let n={Key:e.TotalCols.keys[s],Value:e.TotalCols.values[s]};var o=this.ReportColumns.find(e=>e.ID==n.Key);if(o?r=this.totals[n.Value][t]:(o=this.HiddenNumericColumns.find(e=>e.ID==n.Key),r=this.hiddenTotals[n.Value][t]),!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(o.DataFormat.PercentageOn))if("REPORT_TOTAL"==o.DataFormat.PercentageOn)r=100;else{if(h=0,e.TotalCols.ContainsKey(o.DataFormat.PercentageOn))h=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(this.totals[e.TotalCols[o.DataFormat.PercentageOn]][t]);else{var i=this.HiddenNumericColumns.find(e=>e.ID==o.DataFormat.PercentageOn);if(i)try{h=this.totals[this.ReportColumns.length+this.HiddenNumericColumns.indexOf(i)][t]}catch(l){}}if(0==r||0==h)continue;r=100*r/h}if(null==u[o.Row]&&(u[o.Row]=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(this.ReportColumns.length,e.SubTotalHeight),e.SubTotalBorder<0&&u[o.Row].Cells.map(t=>t.Border=e.SubTotalBorder),u[o.Row].Type=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.ReportTotal,u[o.Row].LevelNo=0),a=u[o.Row],d=0==o.Row?n.Value:o.Column,o.DataFormat.ShowAvg){if(!(this.iCurrGroupDetailRows>0))continue;r/=this.iCurrGroupDetailRows}ReportViewModel.SetCellValue(r,o.DataFormat,"FLOAT",0,a.Cells[d]),a.Cells[d].DataFormat=e.SubTotalFormat,this.ReportColumns[d].DataAppearance.Alignment==e.SubTotalAppearance_Data.Alignment?a.Cells[d].CellAppearance=e.SubTotalAppearance_Data:(a.Cells[d].CellAppearance=e.SubTotalAppearance_Data.Clone(),a.Cells[d].CellAppearance.Alignment=this.ReportColumns[d].DataAppearance.Alignment),a.Cells[d].Border=e.SubTotalBorder,a.Cells[d].IsNormal=!1,e.SubTotalHeight>0&&(a.Cells[d].height=e.SubTotalHeight)}if((e.SubTotalAppearance.IsVisible||n)&&(null==this.ParentReport||Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(this.Reportds.Tables[0][0].ShowTotals))&&(0==this.MaxRowsUnder?(D.PrintVisible=e.SubTotalAppearance.IsPrintVisible,this.addRow(D)):u.forEach(t=>{t&&t.Cells.find(e=>!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Text))&&(t.PrintVisible=e.SubTotalAppearance.IsPrintVisible,this.addRow(t))})),this.IsSummary=!1,t>0)for(let e=0;e<this.ReportColumns.length;e++)this.totals[e][t-1]+=this.totals[e][t],this.totals[e][t]=0;return D}catch(a){return Logger.ErrorLog("ReportViewModel::Error Report Totals",a.stack),null}}static GetHoursSum(e,t){if(0==e)return t;let s=0,o=e.ToString("0.00").split(".");o.length>1&&(s=parseInt(o[1]));let i=t.ToString("0.00").split(".");return i.length>1&&(s+=parseInt(i[1])),parseFloat(o[0])+parseFloat(i[0])+s/60+parseFloat("0."+(s%60).ToString("00"))}ApplyKPI(e){0!=this.kpiList.length&&this.kpiList.forEach(t=>{t.Apply(e)})}ApplyKPI_Matrix(e,t,s,o){0!=this.kpiList.length&&this.kpiList.forEach(i=>{i.ID==s.ID&&i.Apply_Matrix(e,t,s,this.ReportColumns[o])})}OnButtonClick(e){return Object(tslib__WEBPACK_IMPORTED_MODULE_0__.b)(this,void 0,void 0,(function*(){if(this.DisplayMessage="","Refresh"==e)this.Refresh();else if("OK_CLICK"==e)null!=this.oReportDialog?this.oReportDialog.OnOkClick("OK"):this.Filter.OnButtonClick("OK");else if("Regenerate"==e)null!=this.MRPFilter?this.MRPFilter.OnButtonClick("BACK"):this.RefreshVisibility&&(0==this.StaticReportType||-1==this.StaticReportType?this.ShowFilter=!0:this.ShowStaticFilter=!0);else if("ShowReportFilter"==e)this.ShowExport=!1,this.ShowQuery=!1,this.ShowTransactionQuery=!1,this.ShowLinkingQuery=!1,this.ShowMatrixPanel=!1,this.ShowReportFilter=!0;else if("CancelFilter"==e)this.ShowReportFilter=!1,this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Query||this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DocumentQuery?this.ShowQuery=!this.IsMobile:this.ReportViewType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.TransactionQuery&&this.ReportViewType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.LinkingQuery||(this.ShowTransactionQuery=!0);else if("Filter"==e||"ClearFilter"==e)null!=this.PostDataFetchFilterFields&&this.FilterorClear(e);else if("TransactionQuery"==e);else if("CancelLinkingSubQuery"==e)this.ShowLinkingQuery=!1,this.ShowTransactionQuery=!0;else if("ShowExportScreen"==e)this.ButtonExport.Visible&&this.ButtonExport.Enable&&(this.ShowReportFilter=!1,this.ShowQuery=!1,this.ShowTransactionQuery=!1,this.ShowLinkingQuery=!1,this.ShowMatrixPanel=!1,this.ShowExport=!0,""==this.SaveText.Text&&(this.SaveText.Text=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.PersonalSettings.ContainsKey("ReportTxtDelimiter")?"\t"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.PersonalSettings.ReportTxtDelimiter?"\\t":_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.PersonalSettings.ReportTxtDelimiter:","));else if("Export"==e)this.Export();else if("Print"==e)this.ExportFile("Print");else if("Email"==e){if(this.Data.length>0){let e=new _send_email_sms_SendEmailSMSViewModel__WEBPACK_IMPORTED_MODULE_35__.SendEmailSMSViewModel(!0,50,this.ReportID,this);e.Subject.Text=this.ScreenName,_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.ShowDialog(e,_send_email_sms_send_email_sms_component__WEBPACK_IMPORTED_MODULE_34__.SendEmailSMSComponent)}}else if("SMS"==e){if(this.Data.length>0){let e=new _send_email_sms_SendEmailSMSViewModel__WEBPACK_IMPORTED_MODULE_35__.SendEmailSMSViewModel(!1,50,this.ReportID,this);e.Template.Items.length>0?(e.Subject.Text=this.ScreenName,_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.ShowDialog(e,_send_email_sms_send_email_sms_component__WEBPACK_IMPORTED_MODULE_34__.SendEmailSMSComponent)):this.DisplayMessage="No SMS Templates Defined."}}else if("ShowMatrix"==e)this.ShowExport=!1,this.ShowQuery=!1,this.ShowTransactionQuery=!1,this.ShowLinkingQuery=!1,this.ShowReportFilter=!1,this.ShowMatrixPanel=!0;else if("SaveMatrix"==e)this.MatrixObject.SaveMatrixReport(!1,null);else if("SaveAsMatrix"==e){let e=new _save_as_dialog_SaveAsDialogViewModel__WEBPACK_IMPORTED_MODULE_47__.a(this);_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.ShowDialog(e,_save_as_dialog_save_as_dialog_component__WEBPACK_IMPORTED_MODULE_48__.a,{ShowCenter:!0}).subscribe(t=>{e.IsOkClick&&this.MatrixObject.SaveMatrixReport(!0,e)})}else if("ResetMatrix"==e)this.MatrixObject.Reset();else if("CancelExport"==e||"CancelMatrix"==e)this.ShowExport=!1,this.ShowMatrixPanel=!1,this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Query||this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DocumentQuery?this.ShowQuery=!this.IsMobile:this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.TransactionQuery||this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.LinkingQuery?this.ShowTransactionQuery=!0:this.ReportViewType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DashBoard&&(this.ShowReportFilter=!_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.IsMobile);else if("Post"==e)if(111==this.StaticReportType)this.StaticReportObject.Post();else if(297==this.ReportID)if(null==this.TransferData);else{const{TransferaccountComponent:e}=yield __webpack_require__.e(0).then(__webpack_require__.bind(null,"Uj+z"));_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.ShowDialog(this.TransferData,e,{Title:this.TransferData.lblText})}else if(this.IsDocMapXMLExists){let e=!1,t=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f;t.LoadXml(this.Reportds.Tables[0][0].DocMapXML.toString());let s=t.SelectNodes("xml/AccMapPayJV");null!=s&&s.length>0&&null!=s[0].attributes.IsMapAccForPayrollJV&&"TRUE"==s[0].attributes.IsMapAccForPayrollJV.value.toUpperCase()&&(e=!0)}else this.CanSelectRows&&(this.ReturnType=1,_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.HideDialog());else if("SLReconcile"==e)this.StaticReportObject.Reconcile();else if("Approve"==e)_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.ShowDialog(new _approve_ApproveViewModel__WEBPACK_IMPORTED_MODULE_50__.a(this),_approve_approve_component__WEBPACK_IMPORTED_MODULE_49__.a,{Title:_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("ApproveReject"),ShowCenter:!0});else if(154==this.StaticReportType){if(!confirm("Do you really want to reject notification events."))return;let e="";if(this.Data.forEach(t=>{e.length>0&&(e+=","),e+=t.DataRow.SchEventID.toString()}),e.length>0){let t=_send_email_sms_Notifications__WEBPACK_IMPORTED_MODULE_53__.a.GetEmailSMS(10,0,e.toString());this.DisplayMessage=t.Tables.length>0&&t.Tables[t.Tables.length-1].Columns.Contains("Saved")?"Rejected Successfully.":"Error in reject."}}else"Close"==e?(null!=this.QueryTimer&&(this.QueryTimer.Enabled=!1,this.QueryTimer=null),this.process.IsBusy&&(this.process.Cancel=!0),this.CanSelectRows&&(this.ReturnType=2),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.HideDialog()):"ComparisonINTERQTN"==e?_pages_home_RibbonExtViewModel__WEBPACK_IMPORTED_MODULE_28__.RibbonExtViewModel.LoadDocument_VoucherNo(this.ComparisonINTERQTN):"QueryFieldRefresh"==e&&(this.QueryDimension.SelectedValue=-1,this.QueryTimer_Elapsed())}))}Refresh(e=!0){0==this.StaticReportType||-1==this.StaticReportType||257==this.StaticReportType?this.LoadData(e):110==this.StaticReportType||this.oReportDialog.OnOkClick(null)}FilterorClear_NewCode(e){try{this.MessageVisibility=!1;let s="";if(this.IsFilterRendering=!0,this.PostFilterData=null,"ClearFilter"!=e){for(let e=0;e<this.PostDataFetchFilterFields.length;e++){let t=this.PostDataFetchFilterFields[e];if("None"!=t.Condition.SelectedValue)if("DATE"==t.DataType)"Between"==t.Condition.SelectedValue||"NotBetween"==t.Condition.SelectedValue?("NotBetween"==t.Condition.SelectedValue&&(s+=" not ("),s+="["+t.ColumnName+"] >=  convert('"+t.FromDate.Date.ToString("dd MMM yyyy")+"',System.DateTime) and  ["+t.ColumnName+"] <=  convert('"+t.ToDate.Date.ToString("dd MMM yyyy")+"',System.DateTime) ","NotBetween"==t.Condition.SelectedValue&&(s+=" ) "),s+=" and "):s+="["+t.ColumnName+"]"+t.Condition.SelectedItem.Parent+" convert('"+t.FromDate.Date.ToString("dd MMM yyyy")+"',System.DateTime) and ";else if("Between"==t.Condition.SelectedValue||"NotBetween"==t.Condition.SelectedValue)s+=this.strGetFilterText(t);else if(t.FromDropDown.Visible)if(t.FromDropDown.Items[0].IsChecked)s+=" 1=1 and ";else{let e="";e+="(",t.FromDropDown.Items.forEach(s=>{s.IsChecked&&("Equal"==t.Condition.SelectedValue?(e.length>1&&(e+=" OR "),e+=""==s.Name?"(["+t.ColumnName+"] is null or ["+t.ColumnName+"]='')":"["+t.ColumnName+"]='"+this.EscapeCharsInText(s.Name)+"'"):(e.length>1&&(e+=" and "),e+="[NULL]"==s.Name?"(["+t.ColumnName+"] is not null and ["+t.ColumnName+"]<>'')":"["+t.ColumnName+"]<>'"+this.EscapeCharsInText(s.Name)+"'"))}),1==e.length&&(e+="1!=1"),e+=") and ",s+=e.toString()}else null!=t.FromValue.TextBox.Text&&""!=t.FromValue.TextBox.Text.Trim()&&(s+="Contains"==t.Condition.SelectedValue||"NotContain"==t.Condition.SelectedValue?"["+t.ColumnName+"]"+t.Condition.SelectedItem.Parent+" '%"+this.EscapeCharsInText(t.FromValue.TextBox.Text)+"%'  and ":"BeginsWith"==t.Condition.SelectedValue?"["+t.ColumnName+"] LIKE '"+this.EscapeCharsInText(t.FromValue.TextBox.Text)+"%'  and ":"EndsWith"==t.Condition.SelectedValue?"["+t.ColumnName+"] LIKE '%"+this.EscapeCharsInText(t.FromValue.TextBox.Text)+"'  and ":this.strGetFilterText(t))}0==s.length&&(this.MessageVisibility=!0,this.DisplayMessage="Please choose at least one condition to filter")}if(""!=s&&s.length>4||"ClearFilter"==e)if(null==this.StaticReportObject){if(null==this.ReportData)return;this.PostFilterData=this.ReportData.Copy(),"ClearFilter"==e?(this.PostDataFetchFilterFields.map(e=>e.Clear()),this.PostFilterData=this.ReportData):(s=s.substr(0,s.length-4),null!=this.LevelColumn&&(s="("+s+") or IsGroup=1"),this.PostFilterData=_static_report_filter_ReportFilterDialog__WEBPACK_IMPORTED_MODULE_51__.a.FilterData(this.PostFilterData,this.PostDataFetchFilterFields),s=s.substr(0,s.length-4),null!=this.LevelColumn&&(s="("+s+") or IsGroup=1"),this.PostFilterData=_static_report_filter_ReportFilterDialog__WEBPACK_IMPORTED_MODULE_51__.a.FilterData(this.PostFilterData,this.PostDataFetchFilterFields)),this.RecordCount="Displaying "+this.PostFilterData.length.toString()+" of "+this.TotalRowCount.toString()+" Rows",this.Data.Clear(),this.totals=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.NumArray(this.ReportColumns.length,this.lstGroup.length+1),this.hiddenTotals=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.NumArray(this.HiddenNumericColumns.length,this.lstGroup.length+1);for(let e=this.lstGroup.length;e>0;e--)this.Groupstr[this.lstGroup[e-1].ID]=null;if(this.FormulasCalculated=!0,this.SNo=0,null!=this.MatrixObject&&(this.MatrixObject.MatrixRows.Items.length>0||this.MatrixObject.MatrixColumns.Items.length>0||this.MatrixObject.MatrixValues.Items.length>0))return void this.MatrixObject.LoadMatrixReport(this.PostFilterData,this.ReportDataColumns);if(this.RenderData(this.PostFilterData,this.ReportDataColumns),null!=this.LevelColumn){if(this.UpdateTreeTotals(0),this.GrpReportTotal.SubTotalAppearance.IsVisible&&this.lstTotal.length>0){this.totals=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.NumArray(this.lstTotal[0].length,1);for(let e=0;e<this.lstTotal[0].length;e++)this.totals[e][0]=this.lstTotal[0][e];this.AddSubtotals_RT(this.GrpReportTotal,0)}}else{for(let e=this.lstGroup.length;e>0;e--)this.PostFilterData.length>0&&this.AddSubtotals(this.PostFilterData[this.PostFilterData.length-1],this.lstGroup[e-1],e),this.Groupstr[this.lstGroup[e-1].ID]=null;this.GrpReportTotal.SubTotalAppearance.IsVisible&&this.AddSubtotals_RT(this.GrpReportTotal,0)}this.ApplyDefaultSort(),this.refreshDataView()}else{"ClearFilter"==e?(this.PostDataFetchFilterFields.map(e=>e.Clear()),s=""):s=s.substr(0,s.length-4),this.SNo=0;try{this.StaticReportObject.LoadReportWithPostFilters(s),this.RecordCount=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Displaying")+" "+this.Data.length.toString()+" "+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Rows")}catch(t){this.DisplayMessage="Post Filter Error",Logger.ErrorLog("PostFilter Error::",t)}}}catch(t){this.DisplayMessage="Post Filter Error",Logger.ErrorLog("PostFilter Error::",t)}}FilterorClear(e){this.MessageVisibility=!1;let t="";if(this.IsFilterRendering=!0,this.PostFilterData=null,"ClearFilter"!=e){for(let e=0;e<this.PostDataFetchFilterFields.length;e++){let s=this.PostDataFetchFilterFields[e];if("None"!=s.Condition.SelectedValue)if("DATE"==s.DataType)"Between"==s.Condition.SelectedValue||"NotBetween"==s.Condition.SelectedValue?("NotBetween"==s.Condition.SelectedValue&&(t+=" not ("),t+="["+s.ColumnName+"] >=  convert('"+s.FromDate.Date.ToString("dd MMM yyyy")+"',System.DateTime) and  ["+s.ColumnName+"] <=  convert('"+s.ToDate.Date.ToString("dd MMM yyyy")+"',System.DateTime) ","NotBetween"==s.Condition.SelectedValue&&(t+=" ) "),t+=" and "):t+="["+s.ColumnName+"]"+s.Condition.SelectedItem.Parent+" convert('"+s.FromDate.Date.ToString("dd MMM yyyy")+"',System.DateTime) and ";else if("Between"==s.Condition.SelectedValue||"NotBetween"==s.Condition.SelectedValue)t+=this.strGetFilterText(s);else if(s.FromDropDown.Visible)if(s.FromDropDown.Items[0].IsChecked)t+=" 1=1 and ";else{let e="";e+="(",s.FromDropDown.Items.forEach(t=>{t.IsChecked&&("Equal"==s.Condition.SelectedValue?(e.length>1&&(e+=" OR "),e+=""==t.Name?"(["+s.ColumnName+"] is null or ["+s.ColumnName+"]='')":"["+s.ColumnName+"]='"+this.EscapeCharsInText(t.Name)+"'"):(e.length>1&&(e+=" and "),e+="[NULL]"==t.Name?"(["+s.ColumnName+"] is not null and ["+s.ColumnName+"]<>'')":"["+s.ColumnName+"]<>'"+this.EscapeCharsInText(t.Name)+"'"))}),1==e.length&&(e+="1!=1"),e+=") and ",t+=e.toString()}else null!=s.FromValue.TextBox.Text&&""!=s.FromValue.TextBox.Text.Trim()&&(t+="Contains"==s.Condition.SelectedValue||"NotContain"==s.Condition.SelectedValue?"["+s.ColumnName+"]"+s.Condition.SelectedItem.Parent+" '%"+this.EscapeCharsInText(s.FromValue.TextBox.Text)+"%'  and ":"BeginsWith"==s.Condition.SelectedValue?"["+s.ColumnName+"] LIKE '"+this.EscapeCharsInText(s.FromValue.TextBox.Text)+"%'  and ":"EndsWith"==s.Condition.SelectedValue?"["+s.ColumnName+"] LIKE '%"+this.EscapeCharsInText(s.FromValue.TextBox.Text)+"'  and ":this.strGetFilterText(s))}0==t.length&&(this.MessageVisibility=!0,this.DisplayMessage="Please choose at least one condition to filter")}if(""!=t&&t.length>4||"ClearFilter"==e)if(null==this.StaticReportObject){if(null==this.ReportData)return;this.PostFilterData=this.ReportData.Copy(),"ClearFilter"==e?this.PostDataFetchFilterFields.map(e=>e.Clear()):(t=t.substr(0,t.length-4),null!=this.LevelColumn&&(t="("+t+") or IsGroup=1"),this.PostFilterData=_static_report_filter_ReportFilterDialog__WEBPACK_IMPORTED_MODULE_51__.a.FilterData(this.PostFilterData,this.PostDataFetchFilterFields)),this.RecordCount="Displaying "+this.PostFilterData.length.toString()+" of "+this.TotalRowCount.toString()+" Rows",this.Data.Clear(),this.totals=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.NumArray(this.ReportColumns.length,this.lstGroup.length+1),this.hiddenTotals=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.NumArray(this.HiddenNumericColumns.length,this.lstGroup.length+1);for(let e=this.lstGroup.length;e>0;e--)this.Groupstr[this.lstGroup[e-1].ID]=null;if(this.FormulasCalculated=!0,this.SNo=0,null!=this.MatrixObject&&(this.MatrixObject.MatrixRows.Items.length>0||this.MatrixObject.MatrixColumns.Items.length>0||this.MatrixObject.MatrixValues.Items.length>0))return void this.MatrixObject.LoadMatrixReport(this.PostFilterData,this.ReportDataColumns);if(this.RenderData(this.PostFilterData,this.ReportDataColumns),null!=this.LevelColumn){if(this.UpdateTreeTotals(0),this.GrpReportTotal.SubTotalAppearance.IsVisible&&this.lstTotal.length>0){this.totals=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.NumArray(this.lstTotal[0].length,1);for(let e=0;e<this.lstTotal[0].length;e++)this.totals[e][0]=this.lstTotal[0][e];this.AddSubtotals_RT(this.GrpReportTotal,0)}}else{for(let e=this.lstGroup.length;e>0;e--)this.PostFilterData.length>0&&this.AddSubtotals(this.PostFilterData[this.PostFilterData.length-1],this.lstGroup[e-1],e),this.Groupstr[this.lstGroup[e-1].ID]=null;this.GrpReportTotal.SubTotalAppearance.IsVisible&&this.AddSubtotals_RT(this.GrpReportTotal,0)}this.ApplyDefaultSort(),this.refreshDataView()}else{"ClearFilter"==e?(this.PostDataFetchFilterFields.map(e=>e.Clear()),t=""):t=t.substr(0,t.length-4),this.SNo=0;try{this.StaticReportObject.LoadReportWithPostFilters(t),this.RecordCount=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Displaying")+" "+this.Data.length.toString()+" "+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Rows")}catch(s){this.DisplayMessage="Post Filter Error",Logger.ErrorLog("PostFilter Error::",s)}}}strGetFilterText(e){let t=e.FromValue.TextBox.Text;"FLOAT"==e.DataType||"INT"==e.DataType?"FLOAT"!=e.DataType||t.Contains(".")||(t+=".0"):t="'"+t+"' ";let s="["+e.ColumnName+"]",o="";if("Between"==e.Condition.SelectedValue||"NotBetween"==e.Condition.SelectedValue){let i=e.ToValue.Text;"FLOAT"==e.DataType||"INT"==e.DataType?"FLOAT"!=e.DataType||i.Contains(".")||(i+=".0"):i="'"+i+"' ","NotBetween"==e.Condition.SelectedValue&&(o+=" not ("),null!=e.FromValue.TextBox.Text&&""!=e.FromValue.TextBox.Text.Trim()&&(o+=s+">=",o+=t),null!=e.ToValue.Text&&""!=e.ToValue.Text.Trim()&&(null!=e.FromValue.TextBox.Text&&""!=e.FromValue.TextBox.Text.Trim()&&(o+=" and "),o+=s+"<=",o+=i),"NotBetween"==e.Condition.SelectedValue&&(o+=" ) "),o+=" and "}else o+=s+e.Condition.SelectedItem.Parent+" ",o+=t,o+=" and ";return o}EscapeCharsInText(e){return e.Replace("'","''")}onColumnCheckedChanged(e){try{if(null!=e){var t=this.ReportColumns.find(t=>t.ID==e.ColumnName);null!=t&&(t.HeaderAppearance.IsVisible=!!e.ShowColumn,this.Column==t&&(this.Column=null),this.Column=t,this.RefreshGridColumns.Call())}}catch(s){Logger.ErrorLog("ReportViewModel::Error onColumnCheckedChanged",s.stack)}}onsearch(e){try{Logger.InfoLog("ReportViewModel::Entering onsearch"),null!=e&&(e.keyCode!=angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.g.ENTER&&"F3"!=e.key||""==this.SerachValue||this.Search()),Logger.InfoLog("ReportViewModel::Exiting onsearch")}catch(t){Logger.ErrorLog("ReportViewModel::Error onsearch",t.stack)}}Search(){try{Logger.InfoLog("ReportViewModel::Entring Search");let e=this.SerachValue.toLowerCase(),t=!1,s=null,o=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(this.OptionIndexObj.SelectedValue),i=0;null!=this.SelectedRow&&(i=this.Data.indexOf(this.SelectedRow)),-1==i&&(i=0);for(let l=0;l<this.Data.length;l++)if(i<this.Data.length-1?i++:i=0,this.SearchColumns.SelectedIndex>0)switch(o){case 0:if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.Data[i].Cells[this.SearchColumns.SelectedIndex-1].Text)&&this.Data[i].Cells[this.SearchColumns.SelectedIndex-1].Text.toLowerCase()==e)return void this.SelectSearchNode(this.Data[i],this.SearchColumns.SelectedIndex-1);break;case 1:if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.Data[i].Cells[this.SearchColumns.SelectedIndex-1].Text)&&this.Data[i].Cells[this.SearchColumns.SelectedIndex-1].Text.toLowerCase()!=e)return void this.SelectSearchNode(this.Data[i],this.SearchColumns.SelectedIndex-1);break;case 2:if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.Data[i].Cells[this.SearchColumns.SelectedIndex-1].Text)&&this.Data[i].Cells[this.SearchColumns.SelectedIndex-1].Text.toLowerCase().startsWith(e))return void this.SelectSearchNode(this.Data[i],this.SearchColumns.SelectedIndex-1);break;case 3:if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.Data[i].Cells[this.SearchColumns.SelectedIndex-1].Text)&&this.Data[i].Cells[this.SearchColumns.SelectedIndex-1].Text.toLowerCase().endsWith(e))return void this.SelectSearchNode(this.Data[i],this.SearchColumns.SelectedIndex-1);break;case 4:if(t){if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.Data[i].Cells[this.SearchColumns.SelectedIndex-1].Text)&&s.IsMatch(this.Data[i].Cells[this.SearchColumns.SelectedIndex-1].Text.toLowerCase()))return void this.SelectSearchNode(this.Data[i],this.SearchColumns.SelectedIndex-1)}else if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.Data[i].Cells[this.SearchColumns.SelectedIndex-1].Text)&&this.Data[i].Cells[this.SearchColumns.SelectedIndex-1].Text.toLowerCase().Contains(e))return void this.SelectSearchNode(this.Data[i],this.SearchColumns.SelectedIndex-1);break;case 5:if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.Data[i].Cells[this.SearchColumns.SelectedIndex-1].Text)&&!this.Data[i].Cells[this.SearchColumns.SelectedIndex-1].Text.toLowerCase().Contains(e))return void this.SelectSearchNode(this.Data[i],this.SearchColumns.SelectedIndex-1)}else switch(o){case 0:if(this.Data[i].Cells.find(t=>!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(t.Text)&&t.Text.toLowerCase()==e)){for(let t=0;t<this.Data[i].Cells.length;t++)if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.Data[i].Cells[t].Text)&&this.Data[i].Cells[t].Text.toLowerCase()==e){this.SelectSearchNode(this.Data[i],t);break}return}break;case 1:if(this.Data[i].Cells.find(t=>!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(t.Text)&&t.Text.toLowerCase()!=e)){for(let t=0;t<this.Data[i].Cells.length;t++)if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.Data[i].Cells[t].Text)&&this.Data[i].Cells[t].Text.toLowerCase()!=e){this.SelectSearchNode(this.Data[i],t);break}return}break;case 2:if(this.Data[i].Cells.find(t=>!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(t.Text)&&t.Text.toLowerCase().startsWith(e))){for(let t=0;t<this.Data[i].Cells.length;t++)if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.Data[i].Cells[t].Text)&&this.Data[i].Cells[t].Text.toLowerCase().startsWith(e)){this.SelectSearchNode(this.Data[i],t);break}return}break;case 3:if(this.Data[i].Cells.find(t=>!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(t.Text)&&t.Text.toLowerCase().endsWith(e))){for(let t=0;t<this.Data[i].Cells.length;t++)if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.Data[i].Cells[t].Text)&&this.Data[i].Cells[t].Text.toLowerCase().endsWith(e)){this.SelectSearchNode(this.Data[i],t);break}return}break;case 4:if(t){if(this.Data[i].Cells.find(e=>!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Text)&&s.IsMatch(e.Text.toLowerCase()))){for(let e=0;e<this.Data[i].Cells.length;e++)if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.Data[i].Cells[e].Text)&&s.IsMatch(this.Data[i].Cells[e].Text.toLowerCase())){this.SelectSearchNode(this.Data[i],e);break}return}}else if(this.Data[i].Cells.find(t=>!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(t.Text)&&t.Text.toLowerCase().Contains(e))){for(let t=0;t<this.Data[i].Cells.length;t++)if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.Data[i].Cells[t].Text)&&this.Data[i].Cells[t].Text.toLowerCase().Contains(e)){this.SelectSearchNode(this.Data[i],t);break}return}break;case 5:if(!this.Data[i].Cells.find(t=>!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(t.Text)&&t.Text.toLowerCase().Contains(e))){for(let t=0;t<this.Data[i].Cells.length;t++)if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.Data[i].Cells[t].Text)&&this.Data[i].Cells[t].Text.toLowerCase().Contains(e)){this.SelectSearchNode(this.Data[i],t);break}return}}Logger.InfoLog("ReportViewModel::Exiting Search")}catch(e){Logger.ErrorLog("ReportViewModel::Error Search",e)}}SelectSearchNode(e,t){this.AllowDrop=!0,e.Cells[t].IsSelected=!0,this.SelectedRow=e;let s=this.Data.indexOf(e);this.angularGrid&&this.angularGrid.slickGrid.setActiveCell(s,t)}Export(){this.DisplayMessage="",this.Reportds.Tables[0][0].ReportName=this.ScreenName,this.SaveXLS.IsChecked?this.ExportFile("Excel"):this.SaveXLSX.IsChecked?this.ExportFile("OpenXML"):this.SavePDF.IsChecked&&this.ExportFile("PDF")}AuditLog(e){}ExportFile(e){this.DisplayMessage="Print"==e?"Printing data please wait...":"Exporting data please wait...";let t,s={};this.InitPrintOrExport(s),s.Type=e,s.PrintDataOnSeperatePageBy=this.Preferences.ContainsKey("PrintDataOnSeperatePageBy")?this.Preferences.PrintDataOnSeperatePageBy:"","PDF"==e?s.lst=this.Get_lstGroupIndex():"Print"==e?(s.lst=this.Get_lstGroupIndex(),s.Type="PDF"):"Excel"!=e&&"OpenXML"!=e||(s.lst=this.lstGroupIndex),this.ReportColumns.forEach(e=>{this.angularGrid.slickGrid.getColumns().filter(t=>t.id==e.ID).length>0&&(e.width=this.angularGrid.slickGrid.getColumns().find(t=>t.id==e.ID).width)});let o=[];if(this.Data.filter(e=>null!=e.DataRow).length>0){t=this.Data.filter(e=>null!=e.DataRow);for(let e=0;e<t.length;e++)o.push(t[e].DataRow),o[e].Row_Seq=t[e].id}_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ExportReport(this.Data.filter(e=>e.Visible),this.ReportColumns,s,this.ScreenName,this.ColumnSourceALL,o).subscribe(t=>{console.log(t),"Print"==e?_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.printTab(t.FileName):(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Download(t.FileName,"khasim"),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(t.Message)&&!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(t.FileName)&&(this.DisplayMessage="Exported Successfully","OpenXML"==e&&(e="Excel"),this.AuditLog(e)))},e=>{console.log(e)})}EmailSMSReport(e){this.DisplayMessage="Sending "+e.Type+" please wait...",this.InitPrintOrExport(e),e.ReportID=this.Reportds.Tables[0][0].ReportID,e.PrintDataOnSeperatePageBy=this.Preferences.ContainsKey("PrintDataOnSeperatePageBy")?this.Preferences.PrintDataOnSeperatePageBy:"",e.lst=this.lstGroupIndex,_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.EmailSMSReport(this.Data.filter(e=>e.Visible),this.ReportColumns,e).subscribe(e=>{console.log(e),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Message)||(this.DisplayMessage=e.Message),e.IsSuccess&&_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.HideDialog()},e=>{console.log(e)})}InitPrintOrExport(e){e.ReportID=this.Reportds.Tables[0][0].ReportID,1==this.PrintonLang&&2==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LanguageID&&(e.IsRTL=!0);let t=null;t=this.oReportDialog instanceof _static_report_filter_StaticReportFilterViewModel__WEBPACK_IMPORTED_MODULE_20__.a?this.oReportDialog:null!=this.MRPFilter?this.MRPFilter:this.Filter;let s=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.c;if(null!=this.Filter&&t.CostCenterFilters.forEach(e=>{if(e.SelectedNodes.length>0&&e.CostCenterID>5e4){let t="";for(let s=0;s<e.SelectedNodes.length;s++)s>0&&(t+=","),t+=e.SelectedNodes[s].Id;s.Add(e.CostCenterID,t)}}),e.DimensionFiltersKeys=s.keys,e.DimensionFiltersValues=s.values,this.oReportDialog instanceof _static_report_filter_StaticReportFilterViewModel__WEBPACK_IMPORTED_MODULE_20__.a){if(e.FromDate=this.oReportDialog.FromDate.Date.ToString("dd/MMM/yyyy"),e.ToDate=this.oReportDialog.ToDate.Date.ToString("dd/MMM/yyyy"),this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere){if(e.DimensionFiltersKeys.Contains(this.oReportDialog.Locations.DBColumnID)){let t=0;t=s.keys.indexOf(this.oReportDialog.Locations.DBColumnID),e.DimensionFiltersKeys.Remove(this.oReportDialog.Locations.DBColumnID),e.DimensionFiltersValues.RemoveAt(t),s.keys.Remove(this.oReportDialog.Locations.DBColumnID),s.values.RemoveAt(t)}_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?s.Add(this.oReportDialog.Locations.DBColumnID,"-1"):s.Add(this.oReportDialog.Locations.DBColumnID,this.oReportDialog.LocationWhere),e.DimensionFiltersKeys=s.keys,e.DimensionFiltersValues=s.values}}else if("MRPViewModel"==(null==t?void 0:t.ClassName))e.FromDate=this.MRPFilter.FromDate.Date.ToString("dd/MMM/yyyy"),e.ToDate=this.MRPFilter.ToDate.Date.ToString("dd/MMM/yyyy");else if(null!=this.Filter)for(let o=0;o<this.Filter.Fields.length;o++){let t=this.Filter.Fields[o];if("DATE"==t.CDGDO.DataType){t.FromDatePicker.Visible&&(e.FromDate=t.FromDatePicker.Date.ToString("dd/MMM/yyyy")),t.ToDatePicker.Visible&&(e.ToDate=t.ToDatePicker.Date.ToString("dd/MMM/yyyy"));break}}if(this.Preferences.ContainsKey("PrintEachAccountOnSeparatePage")&&"1"==this.Preferences.PrintEachAccountOnSeparatePage){e.PrintAccountOnSeperatePage=!0;let s=null==t?void 0:t.CostCenterFilters.find(e=>2==e.CostCenterID);s&&1==s.SelectedNodes.length&&(e.DimensionFiltersKeys.push(s.CostCenterID),e.DimensionFiltersValues.push(s.SelectedNodes[0].Id.toString()))}this.Preferences.ContainsKey("PrintAccountIndex")&&"1"==this.Preferences.PrintAccountIndex&&(e.PrintPageIndex=!0),this.MatrixObject&&this.MatrixObject.MatrixValues.Items.length>0&&(e.MatrixValuesCount=this.MatrixObject.MatrixValues.Items.length,this.MatrixObject.MatrixColumns.Items.length>0&&(e.MatrixColumnsCount=this.MatrixObject.MatrixColumns.Items.length))}Get_lstGroupIndex(){let e=[],t=this.Preferences.ContainsKey("PrintDataOnSeperatePageBy")?this.Preferences.PrintDataOnSeperatePageBy:"";if("ROW"==t)for(let s=0;s<this.Data.length;s++)this.Data[s].Visible&&this.Data[s].PrintVisible&&e.push(s);else if("GROUP"==t||"GROUP2"==t){let s="GROUP2"==t?1:0;for(let t=0;t<this.Data.length;t++)this.Data[t].Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Group&&this.Data[t].LevelNo==s&&this.Data[t].Visible&&this.Data[t].PrintVisible&&e.push(t)}else for(let s=0;s<this.lstGroupIndex.length;s++)e.push(this.lstGroupIndex[s]);return e}OnQueryReportClick(e){if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNum(e)&&(e=this.QueryReports.find(t=>t.DBColumnID==parseInt(e))),e instanceof _shared_models_controls_PactButtonData__WEBPACK_IMPORTED_MODULE_10__.a){let t=e;this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Query&&(this.IsProductGroupLevel="1"==t.GroupName),112==t.Action||165==t.Action?(this.ReportID=t.DBColumnID,this.StaticReportType=t.Action,this.DisplayName=t.Label,this.ShowReorderReportFromQuery(t.DBColumnID)):1!=t.CrFilter&&null!=this.QueryReportPref&&this.QueryReportPref.ContainsKey(t.DBColumnID)?this.QueryReportPref[t.DBColumnID].ContainsKey("OpenIn")&&"1"==this.QueryReportPref[t.DBColumnID].OpenIn?this.ShowInPopup(t):this.QueryReportPref[t.DBColumnID].ContainsKey("OpenIn")&&"2"==this.QueryReportPref[t.DBColumnID].OpenIn?this.ShowInNewTab(t):this.OnReportClick(t.DBColumnID,t.Action):this.OnReportClick(t.DBColumnID,t.Action)}}ShowInPopup(e){}ShowInNewTab(e){}QueryTimer_Elapsed(){if(null!=this.QueryReports){var e=this.QueryReports.find(e=>e.DBColumnID==this.ReportID);e&&(e.CrFilter=1,this.OnQueryReportClick(e),e.CrFilter=0)}}ShowReorderReportFromQuery(e){let t;null==this.QueryMasterScreen&&(this.QueryMasterScreen=new Array),1==this.QueryMasterScreen.length&&this.QueryMasterScreen[0]instanceof _re_order_level_ReOrderLevelNewViewModel__WEBPACK_IMPORTED_MODULE_40__.ReOrderLevelNewViewModel?t=this.QueryMasterScreen[0]:(t=new _re_order_level_ReOrderLevelNewViewModel__WEBPACK_IMPORTED_MODULE_40__.ReOrderLevelNewViewModel("",e,null),this.QueryMasterScreen.push(t)),this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Query&&(this.QueryDimension.LocationID=this.QueryDimension.SelectedValue,this.DocumentFilters[this.QueryDimension.CCID.toString()]=this.QueryDimension.SelectedValue.toString()),this.ShowMasters=!0}OnReportClick(e,t){if(this.ReportVisibility=!0,this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Query&&(this.DocumentFilters.Clear(),this.DocumentFilters.push(this.QueryDimension.CCID.toString(),""),"TRUE"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["LW  Login"].toString().toUpperCase()&&0!=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID&&this.DocumentFilters.push("50002",_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID.toString()),this.QueryDimension.LocationID=this.QueryDimension.SelectedValue,3==this.QueryDimension.CCID?0!=this.QueryDimension.SelectedValue&&(this.DocumentFilters[this.QueryDimension.CCID.toString()]=this.QueryDimension.SelectedValue.toString()):this.DocumentFilters[this.QueryDimension.CCID.toString()]=this.QueryDimension.SelectedValue.toString(),null!=this.QueryFilterFields&&this.QueryFilterFields.length>0&&this.QueryReportPref.ContainsKey(parseInt(e))&&this.QueryFilterFields.forEach(t=>{0!=t.SelectedValue&&this.QueryReportPref[parseInt(e)].ContainsKey("D"+t.CCID)&&(this.DocumentFilters.ContainsKey(t.CCID.toString())?this.DocumentFilters[t.CCID.toString()]=t.SelectedValue.toString():this.DocumentFilters.push(t.CCID.toString(),t.SelectedValue.toString()))})),parseInt(e)!=this.ReportID){if(this.DisplayMessage="",null!=this.MatrixObject&&this.MatrixObject.Reset(),null!=this.QueryTimer&&(this.QueryTimer.Enabled=!1),null!=this.DocumentObject){let t={strXML:""};if(this.DisplayMessage=this.DocumentObject.GetReportFilterXML(e,t),this.DisplayMessage.length>0)return;this.LoadDocFilterXML(t.strXML)}this.ReportID=parseInt(e),this.ReportData=null,this.oReportDialog=null,this.LoadReportXML(null),this.Preferences.ContainsKey("SelectAllLocations")&&this.DocumentFilters.ContainsKey("50002")&&this.DocumentFilters.Remove("50002"),null==this.FieldsDialog&&(this.FieldsDialog=new _costcenter_picker_CostCenterPicker__WEBPACK_IMPORTED_MODULE_22__.CostCenterPicker("Field"),this.FieldsView=this.FieldsViewTbl=this.FieldsDialog.grData.Table),(this.StaticReportType>0||-2==this.StaticReportType)&&(this.oReportDialog=new _static_report_filter_StaticReportFilterViewModel__WEBPACK_IMPORTED_MODULE_20__.a(this)),this.Filter=new _add_edit_filter_AddEditFilterViewModel__WEBPACK_IMPORTED_MODULE_19__.a,this.Filter.AddEditFilterViewModel_1(this),null!=this.Reportds&&this.Reportds.Tables.length>0&&this.Reportds.Tables[0].length>0&&this.Filter.LoadXml(this.Reportds.Tables[0][0]);let t=this.ReportDoc.SelectSingleNode("PactRevenURpts/Filters/PreDataFetch/TreeFilter");if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(t,"FilterDef").forEach(e=>{this.QueryDimension.CCID.toString()==_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(e,"CCID")&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(e,"DefaultValues")}),0==this.StaticReportType||-1==this.StaticReportType){if(this.ShowFilter=!1,this.StaticReportObject=null,"1"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.RoleID&&50002!=this.QueryDimension.CCID&&!this.DocumentFilters.ContainsKey("50002"))for(let e=this.Filter.CostCenterFilters.length-1;e>=0;e--)if(50002==this.Filter.CostCenterFilters[e].CostCenterID){this.Filter.CostCenterFilters.RemoveAt(e);break}}else{if(this.oReportDialog.Locations.Visible&&50002==this.oReportDialog.Locations.DBColumnID)if(this.DocumentFilters.ContainsKey("50002")){this.oReportDialog.Locations.Items.map(e=>e.IsChecked=!1);for(let e=0;e<this.oReportDialog.Locations.Items.length;e++){let t=this.oReportDialog.Locations.Items[e];if(t.Value==this.DocumentFilters[50002]){t.IsChecked=!0;break}}}else this.oReportDialog.Locations.Items.map(e=>e.IsChecked=!0);this.DocumentFilters.ContainsKey("FROMDATE")&&(this.oReportDialog.FromDate.Date=new Date(this.DocumentFilters.FROMDATE)),this.DocumentFilters.ContainsKey("TODATE")&&(this.oReportDialog.ToDate.Date=new Date(this.DocumentFilters.TODATE)),null==this.ReportViewFrom&&(this.HideCostCenterTree=!this.DocumentFilters.ContainsKey(this.oReportDialog.TreeCCID.toString()))}null!=this.QueryTimer&&null!=this.QueryReportPref&&this.QueryReportPref.ContainsKey(this.ReportID)&&this.QueryReportPref[this.ReportID].ContainsKey("Refresh")&&(this.QueryTimer.Interval=60*parseFloat(this.QueryReportPref[this.ReportID].Refresh)*1e3,this.QueryTimer.Enabled=!0)}else this.Preferences.ContainsKey("SelectAllLocations")&&this.DocumentFilters.ContainsKey("50002")&&this.DocumentFilters.Remove("50002"),null!=this.oReportDialog?this.oReportDialog.CostCenterFilters.forEach(e=>{3==e.CostCenterID&&this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DocumentQuery&&(e.IsGroupLevel=!1)}):this.Filter.CostCenterFilters.forEach(e=>{3==e.CostCenterID&&this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DocumentQuery&&(e.IsGroupLevel=!1)});if(0!=this.ReportID)if(this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Query?(this.QueryProductID=0,this.QueryProductCCWhere="",this.LoadQueryHeaderData(this.QueryDimension.SelectedValue),3==this.QueryDimension.CCID&&this.QueryDimension.SelectedValue>0&&!this.DispayAsPopup?(this.ScreenName=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetProductParentCode(this.QueryDimension.SelectedValue),this.ScreenName=this.ScreenName.length>0?this.ScreenName+" - "+this.Reportds.Tables[0][0].ReportName.toString():this.Reportds.Tables[0][0].ReportName.toString()):this.ScreenName=this.Reportds.Tables[0][0].ReportName.toString()):this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DocumentQuery&&3==this.QueryDimension.CCID&&(this.QueryProductID=0,this.QueryProductCCWhere="",this.LoadQueryHeaderData(this.QueryDimension.SelectedValue)),null!=this.QueryFilterFields&&this.QueryFilterFields.length>0&&this.QueryReportPref.ContainsKey(parseInt(e))&&this.DocumentFilters.keys.forEach(e=>{let t=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(e);t>0&&(this.StaticReportType>0||-2==this.StaticReportType?null==this.oReportDialog||this.oReportDialog.CostCenterFilters.find(e=>e.CostCenterID==t)||this.oReportDialog.AddCostCenterFilter(t):null==this.Filter||this.Filter.CostCenterFilters.find(e=>e.CostCenterID==t)||this.Filter.AddCostCenterFilter(t))}),0==this.StaticReportType||-1==this.StaticReportType)this.Filter.CostCenterFilters.forEach(e=>{if(this.DocumentFilters.ContainsKey(e.CostCenterID.toString())){null==e.SelectedNodes?e.SelectedNodes=[]:e.SelectedNodes.Clear();let t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetNames(e.CostCenterID,this.DocumentFilters[e.CostCenterID.toString()]);if(null!=t){let s="",o=null;if(!this.DocumentFilters[e.CostCenterID.toString()].Contains(",")){let i=t.filter(t=>t.PK==this.DocumentFilters[e.CostCenterID.toString()]);i.length>0&&(o=new _shared_controls_tree_TreeNode__WEBPACK_IMPORTED_MODULE_27__.a,o.Id=parseInt(i[0].PK),o.Text.push(i[0].Name.toString()),o.IsSelected=!0,e.SelectedNodesTag=o.Text[0],e.SelectedNodes.push(o),s=o.Text[0],t.Remove(i[0]))}t.forEach(t=>{let i=new _shared_controls_tree_TreeNode__WEBPACK_IMPORTED_MODULE_27__.a;i.Id=parseInt(t.PK),i.Text.push(t.Name.toString()),i.IsSelected=!0,i.Parent=o,e.SelectedNodesTag=i.Text[0],e.SelectedNodes.push(i),s.length<146&&(s.length>0&&(s+=", "),s+=t.Name.toString(),s.length>140&&(s+=" . . ."))}),e.SelectedNodesTag=s}3!=e.CostCenterID||this.ReportViewType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DocumentQuery&&this.ReportViewType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Query||(e.IsGroupLevelVisible=!0,e.IsGroupLevel=this.IsProductGroupLevel)}}),this.AssignStaticFiletersFromQuery(),this.IsFirstCall||(this.SetQueryXMLTags(),this.LoadData()),this.IsFirstCall=!1;else if(110==this.StaticReportType||144==this.StaticReportType)this.LoadTransactionQueryData(),this.TQDocumentType.Refresh(),this.TQDocumentType.SelectedValue=this.CostCenterID;else{if(this.DocumentFilters.ContainsKey(this.oReportDialog.TreeCCID.toString())){var s=this.oReportDialog.CostCenterFilters.find(e=>e.CostCenterID==this.oReportDialog.TreeCCID);null==this.oReportDialog.DefaultTreeSelectedNodes?(this.oReportDialog.DefaultTreeSelectedNodes=[],null!=s&&(s.SelectedNodes=this.oReportDialog.DefaultTreeSelectedNodes)):this.oReportDialog.DefaultTreeSelectedNodes.Clear();let e=null;if(null!=this.oReportDialog.tree&&this.oReportDialog.tree.length>0){var o=this.oReportDialog.tree[0].AllNodes.filter(e=>e.Id==parseInt(this.DocumentFilters[this.oReportDialog.TreeCCID.toString()]));o.length>0&&(e=o[0])}null==e&&(this.DocumentFilters[this.oReportDialog.TreeCCID.toString()].startsWith("'")&&this.DocumentFilters[this.oReportDialog.TreeCCID.toString()].endsWith("'")?(this.DocumentFilters[this.oReportDialog.TreeCCID.toString()].Replace("'","").split(",").forEach(t=>{e=new _shared_controls_tree_TreeNode__WEBPACK_IMPORTED_MODULE_27__.a,e.Id=parseInt(t),this.oReportDialog.DefaultTreeSelectedNodes.push(e)}),e.Text.push("[FILTER]")):(e=new _shared_controls_tree_TreeNode__WEBPACK_IMPORTED_MODULE_27__.a,e.Id=parseInt(this.DocumentFilters[this.oReportDialog.TreeCCID.toString()]),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.QueryDimension.Text)?e.Text.push("[FILTER]"):e.Text.push(this.QueryDimension.Text))),e.IsSelected=!0,this.oReportDialog.DefaultTreeSelectedNodes.push(e),null!=this.oReportDialog.tree&&this.oReportDialog.tree.length>0?this.oReportDialog.OnNodeSelected():null!=s&&(s.SelectedNodesTag=e.Text[0])}for(let e=0;e<this.oReportDialog.CostCenterFilters.length;e++){let t=this.oReportDialog.CostCenterFilters[e];if(this.DocumentFilters.ContainsKey(t.CostCenterID.toString())){if(3!=t.CostCenterID||this.ReportViewType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DocumentQuery&&this.ReportViewType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Query||(t.IsGroupLevelVisible=!0,t.IsGroupLevel=this.IsProductGroupLevel),t.CostCenterID==this.oReportDialog.TreeCCID)continue;null==t.SelectedNodes?t.SelectedNodes=[]:t.SelectedNodes.Clear();let e=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetNames(t.CostCenterID,this.DocumentFilters[t.CostCenterID.toString()]);if(null!=e){let s="",o=null;if(!this.DocumentFilters[t.CostCenterID.toString()].Contains(",")){let i=e.filter(e=>e.PK==this.DocumentFilters[t.CostCenterID.toString()]);i.length>0&&(o=new _shared_controls_tree_TreeNode__WEBPACK_IMPORTED_MODULE_27__.a,o.Id=parseInt(i[0].PK),o.Text.push(i[0].Name.toString()),o.IsSelected=!0,t.SelectedNodesTag=o.Text[0],t.SelectedNodes.push(o),s=o.Text[0],e.Remove(i[0]))}e.forEach(e=>{let i=new _shared_controls_tree_TreeNode__WEBPACK_IMPORTED_MODULE_27__.a;i.Id=parseInt(e.PK),i.Text.push(e.Name.toString()),i.IsSelected=!0,i.Parent=o,t.SelectedNodesTag=i.Text[0],t.SelectedNodes.push(i),s.length<146&&(s.length>0&&(s+=", "),s+=e.Name.toString(),s.length>140&&(s+=" . . ."))}),t.SelectedNodesTag=s}}}this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Query&&50002==this.QueryDimension.CCID&&(this.oReportDialog.Locations.Visible=!0,this.oReportDialog.Locations.Items.Clear(),this.oReportDialog.Locations.Items.push(_shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__.c.CheckedListBoxItem_5(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("All"),"0",!1)),this.oReportDialog.Locations.Items.push(_shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__.c.CheckedListBoxItem_5(this.QueryDimension.Text,this.QueryDimension.SelectedValue.toString(),!0))),this.oReportDialog.OnOkClick(null)}}AssignStaticFiletersFromQuery(){this.Filter.Fields.forEach(e=>{if(this.DocumentFilters.ContainsKey(e.CDGDO.FieldValue.toString()))if("DATE"==e.CDGDO.DataType)e.FromDatePicker.Date=new Date(this.DocumentFilters[e.CDGDO.FieldValue.toString()]),e.ToDatePicker.Date=new Date(this.DocumentFilters[e.CDGDO.FieldValue.toString()]);else if(e.FromValue.Visible&&(e.FromValue.TextBox.Text=this.DocumentFilters[e.CDGDO.FieldValue.toString()]),e.ToValue.Visible&&(e.ToValue.Text=this.DocumentFilters[e.CDGDO.FieldValue.toString()]),e.FromList.Visible){let t=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(this.DocumentFilters[e.CDGDO.FieldValue.toString()]);t>0&&(e.FromList.SelectedValue=t)}})}OnQueryMasterClick(e){let t;if(t=e instanceof _shared_models_controls_PactLinkData__WEBPACK_IMPORTED_MODULE_15__.a?e.DBColumnID:parseInt(e),t>=4e4&&t<5e4){let s={};_pages_home_RibbonExtViewModel__WEBPACK_IMPORTED_MODULE_28__.RibbonExtViewModel.DocumentObj(s,t,e.Label).then(e=>{_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.addNewTab(s)})}else 41==t&&this.QueryTimer_Elapsed()}LoadQueryHeaderFields(e){{let t=e.filter(e=>!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.ReportXML));if(t.length>0){let e=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f;e.LoadXml(t[0].ReportXML.toString());let s=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(e.DocumentElement,"Row");if(s.length>0){this.QueryReportPref=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.c;for(let e=0;e<s.length;e++){let t=parseInt(s[e].attributes.ReportID.value);this.QueryReportPref.ContainsKey(t)||this.QueryReportPref.push(t,new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a)}}if(s=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(e.DocumentElement,"Filter"),s.length>0){this.QueryFilterFields=new Array,this.QueryFieldsVisibility=!0;for(let e=0,t=0,o=0;e<s.length;e++){let i=new _vptdialog_VPTDialogViewModel__WEBPACK_IMPORTED_MODULE_18__.PactQueryListBoxData(parseInt(s[e].attributes.CostCenter.value));i.Label=s[e].attributes.Caption.value,o+1>3&&(t++,o=0),i.CCID=parseInt(s[e].attributes.CostCenter.value),i.TypeID=parseInt(s[e].attributes.TypeID.value),i.Row=t,i.Column=o,null!=s[e].attributes.PickBasedOn&&(i.DependantOn=s[e].attributes.PickBasedOn.value),i.OnPactListBoxValueChanged.Subscribe(this,"OnFilterSelectionChanged"),i.LblWidth="110",this.QueryFilterFields.push(i),o+=1}this.QueryFilterFields.forEach(e=>{this.RefreshQueryFiltersWhere(e)})}}}if(3!=this.QueryDimension.CCID)return;let t="",s=e.filter(e=>!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.HeaderFields));if(s.length>0&&(t=s[0].HeaderFields.toString()),t.length>0){this.dvQueryFieldsTable=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetReportFields(this.QueryDimension.CCID,0).Tables[0],this.dvQueryFields=this.dvQueryFieldsTable;let e=0,s=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f;if(s.LoadXml(t),3==this.QueryDimension.CCID){let t=null;for(let o=s.DocumentElement.children.length-1;o>=0;o--)if("26428"==s.DocumentElement.children[o].attributes.FIELDNAME.value&&null!=s.DocumentElement.children[o].attributes.VoucherXML&&s.DocumentElement.children[o].attributes.VoucherXML.value.Contains(",")){if(null==t&&(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&(e=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Maintain Dimensionwise stock"])),e>0)){let s=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetTableColumns(e);t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataTable("RPT028",this.IsReportDB,s.TableName)}s.DocumentElement.children[o].attributes.VoucherXML.value.split(",").forEach(e=>{let i=s.DocumentElement.children[o].cloneNode(!0);i.attributes.VoucherXML.value=e;let l="#";if(null!=t){let s=t.filter(t=>t.NodeID==e);s.length>0&&(l=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(s[0].Name))}i.setAttribute("DimName",l),o+1<s.DocumentElement.children.length?s.DocumentElement.insertBefore(i,s.DocumentElement.children[o+1]):s.DocumentElement.appendChild(i)}),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.RemoveChild(s.DocumentElement,s.DocumentElement.children[o])}}this.QueryFields=new Array,this.QueryFieldsVisibility=!0;let o=s.SelectNodes("XML/Row"),i=0;for(let t=0,l=0,a=0;t<o.length;t++){let s=new _shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__.e(parseInt(o[t].attributes.FIELDNAME.value));s.Label=o[t].attributes.Header.value,3==this.QueryDimension.CCID&&26428==s.DBColumnID&&null!=o[t].attributes.VoucherXML&&o[t].attributes.VoucherXML.value.length>0&&(s.Label.length>0&&(s.Label+=" "),s.Label+=o[t].attributes.DimName.value,s.Dependancy=e),i=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(o[t].attributes.ColSpan.value),0==i?i=1:i>4&&(i=3),a+i>3&&(l++,a=0),s.Row=l,s.Column=a,s.ColumnSpan=i,s.IsReadOnly=!0,s.DBColumnName="C"+t.toString(),s.GroupName=o[t].attributes.VoucherXML.value,null!=o[t].attributes.DimensionsXML&&(s.DependantOn=o[t].attributes.DimensionsXML.value),null!=o[t].attributes.ExcludeUnApprovedQty&&(s.Dependantinuse=!0),this.dvQueryFields=this.dvQueryFieldsTable.filter(e=>e.CostCenterColID==s.DBColumnID),s.DataType=this.dvQueryFields.length>0?_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(this.dvQueryFields[0].ColumnDataType).toUpperCase():"FLOAT","FLOAT"==s.DataType&&(s.Align="Right"),268==s.DBColumnID?(s.Visible=!1,s.IsColumnUserDefined=!1,s.Enable=!0,s.SelectionChangedCommand.Subscribe(this,"OnQueryHeaderUOMChange","Condition")):"IMAGE"==s.DataType?(s.Visible=!1,s.IsColumnUserDefined=!0,s.Enable=!1):(s.Visible=!0,s.IsColumnUserDefined=!1,s.Enable=!1),s.LblWidth="110",this.QueryFields.push(s),a+=i}}console.log(this.QueryFields)}RefreshQueryFiltersWhere(e){let t=null;this.QueryFilterFields.filter(t=>t.DependantOn==e.CCID.toString()).forEach(s=>{let o="";if(e.SelectedValue>0)if(s.CCID>5e4){if(null==t&&(t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataTable("RPT029",this.IsReportDB,e.CCID.toString(),e.SelectedValue.toString())),o="(",o+=2==e.CCID?"CC.AccountID="+e.SelectedValue.toString():"CC.CCNID"+(e.CCID-5e4)+"="+e.SelectedValue.toString(),o+=" or a.NodeID IN (select CCNID"+(s.CCID-5e4)+" from COM_CCCCData WHERE CostCenterID="+e.CCID+" and NodeID="+e.SelectedValue+") ",o+=" or a.NodeID in (select NodeID from COM_CostCenterCostCenterMap with(nolock) where CostCenterID="+s.CCID+" and ParentCostCenterID="+e.CCID+" and ParentNodeID="+e.SelectedValue.toString()+")",o+=" or a.NodeID in (select ParentNodeID from COM_CostCenterCostCenterMap with(nolock) where ParentCostCenterID="+s.CCID+" and CostCenterID="+e.CCID+" and NodeID="+e.SelectedValue.toString()+")",o+=")",t.length>0&&(s.SelectedValue=parseInt(t[0]["CCNID"+(s.CCID-5e4)]),1==s.SelectedValue)){let o=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSet("RPT030",this.IsReportDB,s.CCID.toString(),e.CCID.toString(),e.SelectedValue.toString());(1==o.Tables[0].length||1==o.Tables[1].length)&&(s.SelectedValue=parseInt(t[0].NodeID))}}else 2==s.CCID&&(o="(",o+="CC.CCNID"+(e.CCID-5e4)+"="+e.SelectedValue.toString(),o+=" or a.NodeID IN (select CCNID"+(s.CCID-5e4)+" from COM_CCCCData WHERE CostCenterID="+e.CCID+" and NodeID="+e.SelectedValue+")",o+=" or (a.NodeID in (select NodeID from COM_CostCenterCostCenterMap with(nolock) where CostCenterID="+s.CCID+" and ParentCostCenterID="+e.CCID+" and ParentNodeID="+e.SelectedValue.toString()+"))",o+=" or (a.NodeID in (select ParentNodeID from COM_CostCenterCostCenterMap with(nolock) where ParentCostCenterID="+s.CCID+" and CostCenterID="+e.CCID+" and NodeID="+e.SelectedValue.toString()+"))",o+=")");s.CustomWhere=o})}LoadQueryHeaderData(e){let t="",s="",o=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.c;if(this.QueryFieldsVisibility&&null!=this.QueryFields&&this.QueryFields.length>0&&null!=this.dvQueryFieldsTable){let e=0;if(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&(e=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Maintain Dimensionwise stock"])),0==e&&"True"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["LW Reports"]&&(e=50002),0==e&&"True"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.EnableDivisionWise.toString()&&"True"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["DW Reports"]&&(e=50001),e>0&&o.push(e,""),this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Query)if(0==this.StaticReportType){var i=null!=this.QueryFilterFields&&this.QueryFilterFields.length>0&&this.QueryReportPref.ContainsKey(this.ReportID)?this.QueryFilterFields.find(t=>t.CCID==e):null;null!=i?(t=" AND DCC.dcCCNID"+(e-5e4)+"="+i.SelectedValue,s='<Row CostCenterID="'+e+'" NODEID="'+i.SelectedValue+'"/>'):(a=this.Filter.CostCenterFilters.find(t=>t.CostCenterID==e))?(a.SelectedNodes.forEach(e=>{t.length>0&&(t+=","),t+=e.Id}),t.length>0&&(t=" AND DCC.dcCCNID"+(e-5e4)+" IN ("+t+")")):50002==e&&_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID>0?(t=" AND DCC.dcCCNID2="+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID,s='<Row CostCenterID="50002" NODEID="'+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID+'"/>'):50001==e&&_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.DivisionID>0&&(t=" AND DCC.dcCCNID1="+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.DivisionID,s='<Row CostCenterID="50001" NODEID="'+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.DivisionID+'"/>')}else 50002==e&&_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID>0?(t=" AND DCC.dcCCNID2="+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID,s='<Row CostCenterID="50002" NODEID="'+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID+'"/>'):50001==e&&_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.DivisionID>0&&(t=" AND DCC.dcCCNID1="+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.DivisionID,s='<Row CostCenterID="50001" NODEID="'+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.DivisionID+'"/>');else this.DocumentFilters.ContainsKey(e.toString())?(t=this.DocumentFilters[e.toString()],t.length>0&&(t=" AND DCC.dcCCNID"+(e-5e4)+" IN ("+t+")")):50002==e&&_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID>0?(t=" AND DCC.dcCCNID2="+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID,s='<Row CostCenterID="50002" NODEID="'+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID+'"/>'):50001==e&&_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.DivisionID>0&&(t=" AND DCC.dcCCNID1="+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.DivisionID,s='<Row CostCenterID="50001" NODEID="'+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.DivisionID+'"/>');e>0&&(o[e]=t),null!=this.QueryFilterFields&&this.QueryFilterFields.length>0&&this.QueryReportPref.ContainsKey(this.ReportID)&&this.QueryFilterFields.forEach(i=>{i.CCID>5e4&&i.CCID!=e?i.SelectedValue>0?(this.QueryReportPref[this.ReportID].ContainsKey("D"+i.CCID)&&(t+=" AND DCC.dcCCNID"+(i.CCID-5e4)+"="+i.SelectedValue,s+='<Row CostCenterID="'+i.CCID+'" NODEID="'+i.SelectedValue+'"/>'),o.ContainsKey(i.CCID)||o.push(i.CCID,""),o[i.CCID]=" AND DCC.dcCCNID"+(i.CCID-5e4)+"="+i.SelectedValue):50002==i.CCID&&"True"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["LW Reports"]?_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID>0&&(this.QueryReportPref[this.ReportID].ContainsKey("D"+i.CCID)&&(t+=" AND DCC.dcCCNID2="+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID,s='<Row CostCenterID="50002" NODEID="'+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID+'"/>'),o.ContainsKey(50002)||o.push(50002,""),o[50002]=" AND DCC.dcCCNID2="+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID):50001==i.CCID&&"True"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.EnableDivisionWise.toString()&&"True"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["DW Reports"]&&_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.DivisionID>0&&(this.QueryReportPref[this.ReportID].ContainsKey("D"+i.CCID)&&(t+=" AND DCC.dcCCNID1="+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.DivisionID,s='<Row CostCenterID="50001" NODEID="'+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.DivisionID+'"/>'),o.ContainsKey(50001)||o.push(50001,""),o[50001]=" AND DCC.dcCCNID1="+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.DivisionID):2==i.CCID&&i.SelectedValue>0&&(this.QueryReportPref[this.ReportID].ContainsKey("D"+i.CCID)&&(s+='<Row CostCenterID="'+i.CCID+'" NODEID="'+i.SelectedValue+'"/>'),o.ContainsKey(2)||o.push(2,""),o[2]=i.SelectedValue.toString())})}if(this.QueryProductID!=e||t!=this.QueryProductCCWhere)if(this.QueryProductID=e,this.QueryProductCCWhere=t,this.QueryProductCCXML=s,null==this.QueryFields||0!=e&&-1!=e){if(this.QueryFieldsVisibility&&null!=this.QueryFields&&this.QueryFields.length>0&&null!=this.dvQueryFields){var l=this.QueryFields.find(e=>268==e.DBColumnID);l&&l.GroupName!=e.toString()&&(l.ToolTipFooterDescription="IGNORE",l.Items.Clear(),l.GroupName=e.toString());let t,i,n,r=null==l||_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(l.SelectedValue)?"1":l.SelectedValue,h="",u="",D="";this.sbQueryFields="",this.sbQueryFields+="DECLARE @ID BIGINT,@Query NVARCHAR(MAX),@CCWHERE NVARCHAR(MAX),@ToDate DATETIME,@AvgRate FLOAT,@Temp1 FLOAT,@Temp2 FLOAT,@Temp3 FLOAT\nDECLARE @TblPendingOrders AS TABLE(ProductID BIGINT,Qty FLOAT)\nset @ToDate=getdate()\nset @ID="+e+"\n",this.sbQueryFields+=this.QueryProductCCWhere.length>0?" set @CCWHERE=' INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON A.InvDocDetailsID=DCC.InvDocDetailsID "+this.QueryProductCCWhere+"'":" set @CCWHERE=''",D+="\nSELECT 1 QRYDONE",u+="INV_Product P",null==this.Entities?this.Entities=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a:this.Entities.Clear(),this.Entities.push("Product","P");let d=0,c=0,C=null,p=null,T=null;for(let e=0;e<this.QueryFields.length;e++){let l=this.QueryFields[e];if(11387!=l.DBColumnID){if(11388!=l.DBColumnID)if(11389!=l.DBColumnID)if(25900!=l.DBColumnID)if(26428!=l.DBColumnID)if(11393==l.DBColumnID||l.DBColumnID>=11398&&l.DBColumnID<=11402){if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(l.GroupName)){let e="";_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(l.DependantOn)||l.DependantOn.split(",").forEach(t=>{o.ContainsKey(parseInt(t))&&(e+=o[parseInt(t)])}),this.sbQueryFields+="\nDECLARE @"+l.DBColumnName+" FLOAT,@"+l.DBColumnName+"WHERE NVARCHAR(MAX) ",this.sbQueryFields+=e.length>0?" set @"+l.DBColumnName+"WHERE=' INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON A.InvDocDetailsID=DCC.InvDocDetailsID "+e+"'":" set @"+l.DBColumnName+"WHERE=''",this.sbQueryFields+="\ndelete from @TblPendingOrders\nSET @Query=dbo.fnGetPendingOrders('"+l.GroupName+"',@ID,@"+l.DBColumnName+"WHERE,'',"+(l.Dependantinuse?"1":"0")+") \nINSERT INTO @TblPendingOrders(ProductID,Qty)\nEXEC(@Query)\nselect @"+l.DBColumnName+"=sum(Qty) from @TblPendingOrders ",D+=",@"+l.DBColumnName+" "+l.DBColumnName}}else if(283!=l.DBColumnID)if(268!=l.DBColumnID){if(l.DBColumnID<0&&(Math.abs(l.DBColumnID)>=22786&&Math.abs(l.DBColumnID)<=22821||-276==l.DBColumnID||-277==l.DBColumnID)){if(this.dvQueryFields=this.dvQueryFieldsTable.filter(e=>e.CostCenterColID==Math.abs(l.DBColumnID)),0==this.dvQueryFields.length)continue;let e=null,t="<XML>"+s+"</XML>";-276==l.DBColumnID||-277==l.DBColumnID?(t=r+"~3#"+t,null==T&&(T=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.inventory.GetPriceChart(8,this.QueryProductID,t)),e=T):Math.abs(l.DBColumnID)>=22793&&Math.abs(l.DBColumnID)<=22799||22821==Math.abs(l.DBColumnID)?(t=r+"~1#"+t,null==C&&(C=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.inventory.GetPriceChart(8,this.QueryProductID,t)),e=C):(t=r+"~2#"+t,null==p&&(p=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.inventory.GetPriceChart(8,this.QueryProductID,t)),e=p);let o=this.dvQueryFields[0].SysColumnName.toString();e.Tables.length>1&&e.Columns[1].Contains(o)&&e.Tables[1].length>0?(c=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(e.Tables[1][0][o]),D+=0!=c?","+c.ToString("N"+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.DecimalsinRate)+" "+l.DBColumnName:",P."+o+" "+l.DBColumnName):D+=",P."+o+" "+l.DBColumnName}else if(this.dvQueryFields=this.dvQueryFieldsTable.filter(e=>e.CostCenterColID==l.DBColumnID),0!=this.dvQueryFields.length)if(t=this.dvQueryFields[0].SysTableName.toString(),i=this.dvQueryFields[0].SysColumnName.toString(),"INV_ProductExtended"==this.dvQueryFields[0].SysTableName.toString())if(this.Entities.ContainsKey(t)||(this.Entities.push(t,"PRODEXT"),u+=" LEFT JOIN INV_ProductExtended AS "+this.Entities[t]+" ON P.ProductID=PRODEXT.ProductID"),Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(this.dvQueryFields[0].IsForeignKey)){if(n=this.dvQueryFields[0].CostCenterName.toString()+"."+this.dvQueryFields[0].UserColumnName.toString(),!this.Entities.ContainsKey(n)){if(this.Entities.push(n,"T"+ ++d),u+=" LEFT JOIN "+this.dvQueryFields[0].ParentCostCenterSysName.toString()+" AS "+this.Entities[n]+" ON "+this.Entities[n]+"."+this.dvQueryFields[0].ParentCostCenterColSysName.toString()+"=PRODEXT."+this.dvQueryFields[0].SysColumnName.toString(),this.dvQueryFields=this.dvQueryFieldsTable.filter(e=>e.CostCenterColID==this.dvQueryFields[0].ParentCCDefaultColID),0==this.dvQueryFields.length)continue;i=this.dvQueryFields[0].SysColumnName.toString(),D+=","+this.Entities[n]+"."+i+" "+l.DBColumnName}}else D+=",PRODEXT."+this.dvQueryFields[0].SysColumnName.toString()+" "+l.DBColumnName;else if(Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(this.dvQueryFields[0].IsForeignKey)){if(n=this.dvQueryFields[0].CostCenterName.toString()+"."+this.dvQueryFields[0].UserColumnName.toString(),this.Entities.ContainsKey(n)||(this.Entities.push(n,"T"+ ++d),0==_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.stringCompare(t,"COM_CCCCData",!0)?(this.Entities.ContainsKey("CC")||(this.Entities.push("CC","CC"),u+=" LEFT JOIN COM_CCCCData CC WITH(NOLOCK) ON CC.NodeID=P.ProductID AND CC.CostCenterID="+this.QueryDimension.CCID),u+=" LEFT JOIN "+this.dvQueryFields[0].ParentCostCenterSysName.toString()+" "+this.Entities[n]+" ON "+this.Entities[n]+"."+this.dvQueryFields[0].ParentCostCenterColSysName.toString()+"=CC."+this.dvQueryFields[0].SysColumnName.toString()):u+=" LEFT JOIN "+this.dvQueryFields[0].ParentCostCenterSysName.toString()+" AS "+this.Entities[n]+" ON "+this.Entities[n]+"."+this.dvQueryFields[0].ParentCostCenterColSysName.toString()+"="+this.Entities.Product+"."+this.dvQueryFields[0].SysColumnName.toString()),0==_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.stringCompare(t,"COM_CCCCData",!0))i="Name";else{if(this.dvQueryFields=this.dvQueryFieldsTable.filter(e=>e.CostCenterColID==this.dvQueryFields[0].ParentCCDefaultColID),0==this.dvQueryFields.length)continue;i=this.dvQueryFields[0].SysColumnName.toString()}D+=","+this.Entities[n]+"."+i+" "+l.DBColumnName}else D+="DATE"==l.DataType?",convert(datetime,P."+i+") "+l.DBColumnName:",P."+i+" "+l.DBColumnName}else D+=",P.UOMID "+l.DBColumnName;else D+=",(SELECT top 1 [GUID]+'.'+FileExtension FROM  COM_Files WITH(NOLOCK) WHERE FeatureID=3 and  FeaturePK=@ID and IsProductImage=1) "+l.DBColumnName;else _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(l.GroupName)||0==l.Dependancy?D+=",(SELECT ISNULL(SUM(UOMConvertedQty*VoucherType),0) FROM INV_DocDetails A WITH(NOLOCK) WHERE A.ProductID=@ID AND (VoucherType=1 OR VoucherType=-1) AND IsQtyIgnored=0) "+l.DBColumnName:D+=",(SELECT ISNULL(SUM(UOMConvertedQty*VoucherType),0) FROM INV_DocDetails A WITH(NOLOCK) \njoin COM_DocCCDATA ADCC with(nolock) on ADCC.InvDocDetailsID=A.InvDocDetailsID\nWHERE A.ProductID=@ID AND (VoucherType=1 OR VoucherType=-1) AND IsQtyIgnored=0 and ADCC.dcCCNID"+(l.Dependancy-5e4)+"="+l.GroupName+") "+l.DBColumnName;else{let e="";this.QueryProductCCWhere.length>0&&(e=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON A.InvDocDetailsID=DCC.InvDocDetailsID "+this.QueryProductCCWhere),D+=",(SELECT ISNULL(SUM(A.UOMConvertedQty*A.VoucherType),0) FROM INV_DocDetails A WITH(NOLOCK)"+e+"\nWHERE A.ProductID=@ID AND (A.VoucherType=1 OR A.VoucherType=-1) AND A.IsQtyIgnored=0) "+l.DBColumnName}else{let e=0;var a;"TRUE"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Division AverageRate"].toUpperCase()?e=50001:"TRUE"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Location AverageRate"].toUpperCase()?e=50002:_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Maintain Dimensionwise AverageRate"].length>0&&(e=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Maintain Dimensionwise AverageRate"])),this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Query?0==this.StaticReportType?(a=this.Filter.CostCenterFilters.find(t=>t.CostCenterID==e))?(a.SelectedNodes.forEach(e=>{h.length>0&&(h+=","),h+=e.Id}),h.length>0&&(h=" AND DCC.dcCCNID"+(e-5e4)+" IN ("+h+")")):50002==e&&(h=" AND DCC.dcCCNID2="+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID):"TRUE"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Division AverageRate"].toUpperCase()&&50001==this.oReportDialog.Locations.DBColumnID?h=" AND DCC.dcCCNID2="+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.DivisionID:"TRUE"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Location AverageRate"].toUpperCase()&&50002==e?h=" AND DCC.dcCCNID2="+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID:"50001"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Maintain Dimensionwise AverageRate"]?h=" AND DCC.dcCCNID2="+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.DivisionID:"50002"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Maintain Dimensionwise AverageRate"]&&(h=" AND DCC.dcCCNID2="+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID):this.DocumentFilters.ContainsKey(e.toString())&&(h=this.DocumentFilters[e.toString()],h.length>0&&(h=" AND DCC.dcCCNID"+(e-5e4)+" IN ("+h+")")),this.sbQueryFields+="\nEXEC [spRPT_AvgRate] 0,@ID,'"+h+"','',@ToDate,@ToDate,0,0,0,0,'',0,@Temp1 OUTPUT,@AvgRate OUTPUT,@Temp2 OUTPUT,@Temp3 OUTPUT",D+=",@AvgRate "+l.DBColumnName}else if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(l.GroupName)){let e="";_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(l.DependantOn)||l.DependantOn.split(",").forEach(t=>{o.ContainsKey(parseInt(t))&&(e+="2"==t?" AND A.DebitAccount="+o[parseInt(t)]:o[parseInt(t)])}),D+=",(select TOP 1 Rate/UOMConversion from inv_docdetails A with(nolock)",e.Contains("DCC.dcCCNID")&&(D+=" inner join COM_DocCCData DCC WITH(NOLOCK) ON A.InvDocDetailsID=DCC.InvDocDetailsID"),D+=" where A.productid= @ID AND A.costcenterid IN ("+l.GroupName+") "+e+" order by A.DocDate desc) "+l.DBColumnName}}else if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(l.GroupName)){let e="";_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(l.DependantOn)||l.DependantOn.split(",").forEach(t=>{o.ContainsKey(parseInt(t))&&(e+="2"==t?" AND A.CreditAccount="+o[parseInt(t)]:o[parseInt(t)])}),D+=",(select TOP 1 Rate/UOMConversion from inv_docdetails A with(nolock)",e.Contains("DCC.dcCCNID")&&(D+=" inner join COM_DocCCData DCC WITH(NOLOCK) ON A.InvDocDetailsID=DCC.InvDocDetailsID"),D+=" where A.productid= @ID AND A.costcenterid IN ("+l.GroupName+") order by A.DocDate desc) "+l.DBColumnName}}this.sbQueryFields+=D.toString()+" FROM "+u.toString(),this.sbQueryFields+=" WHERE P.ProductID="+e;let _=[11387,11388,11389],m=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSet("RPT022",this.IsReportDB,this.sbQueryFields);null!=m&&m.Tables.length>0&&m.Columns[0].Contains("QRYDONE")&&m.Tables[0].length>0?this.QueryFields.forEach(e=>{if(m.Columns[0].Contains(e.DBColumnName)&&!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(m.Tables[0][0][e.DBColumnName]))if(268==e.DBColumnID);else if("FLOAT"==e.DataType&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNum(m.Tables[0][0][e.DBColumnName]))c=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(m.Tables[0][0][e.DBColumnName]),e.Text=_.Contains(e.DBColumnID)||Math.abs(e.DBColumnID)>=22786&&Math.abs(e.DBColumnID)<=22821||-276==e.DBColumnID||-277==e.DBColumnID?c.ToString("N"+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.DecimalsinRate):c.ToString("N"+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.DecimalsinQty);else if("DATE"==e.DataType)try{e.Text=new Date(m.Tables[0][0][e.DBColumnName]).ToString(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Date Format"])}catch(t){e.Text=m.Tables[0][0][e.DBColumnName].toString()}else"IMAGE"==e.DataType?e.ToolTipDescription=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.b.GetLogPath(m.Tables[0][0][e.DBColumnName].toString()):e.Text=m.Tables[0][0][e.DBColumnName].toString();else"IMAGE"==e.DataType?e.ToolTipDescription="":e.Text=""}):this.QueryFields.forEach(e=>{e.Text="#"})}}else this.QueryFields.forEach(e=>{"IMAGE"==e.DataType?e.ToolTipDescription="":e.Text=""})}LoadQueryDataOnRowSelection(){if(this.QueryFieldsVisibility&&null!=this._SelectedRow&&null!=this._SelectedRow.DataRow)if(null!=this.QueryReportPref&&this.QueryReportPref.ContainsKey(this.ReportID)){let e="";if(Object.keys(this._SelectedRow.DataRow).Contains("ProductID"))e="ProductID";else{let t=this.BaseReportColumns.find(e=>("3"==e.LinkType.SelectedValue||"4"==e.LinkType.SelectedValue)&&3==(e.CDGDO.IsForeignKey?e.CDGDO.ParentCostCenterID:e.CDGDO.CategoryValue));t&&(e=t.ID+"_ID")}if(e.length>0&&Object.keys(this._SelectedRow.DataRow).Contains(e)&&null!=this._SelectedRow.DataRow[e]){let t=parseInt(this._SelectedRow.DataRow[e]);this.QueryReportPref[this.ReportID].ContainsKey("RefreshHeader")&&(null!=this.QueryFilterFields&&this.QueryFilterFields.length>0&&this.QueryReportPref.ContainsKey(this.ReportID)&&null!=this.QueryFilterFields&&this.QueryFilterFields.length>0&&this.QueryFilterFields.forEach(t=>{if(this.QueryReportPref[this.ReportID].ContainsKey("D"+t.CCID)){let s=this.BaseReportColumns.find(e=>("3"==e.LinkType.SelectedValue||"4"==e.LinkType.SelectedValue)&&(e.CDGDO.IsForeignKey?e.CDGDO.ParentCostCenterID:e.CDGDO.CategoryValue)==t.CCID);if(null!=s){e=s.ID+"_ID";let o=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(this._SelectedRow.DataRow[e]);o>0&&t.SelectedValue!=o&&(t.SelectedValue=o)}}}),null!=this.QueryFields&&this.QueryFields.length>0&&this.LoadQueryHeaderData(t)),this.QueryReportPref[this.ReportID].ContainsKey("ProductFromReport")&&(this.QueryDimension.IsAutoLoad=!0,this.QueryDimension.SelectedValue=t)}}else if(null!=this.DocumentObject&&null!=this.QueryFields&&this.QueryFields.length>0){let e="";if(Object.keys(this._SelectedRow.DataRow).Contains("ProductID"))e="ProductID";else{let t=this.BaseReportColumns.find(e=>("3"==e.LinkType.SelectedValue||"4"==e.LinkType.SelectedValue)&&3==(e.CDGDO.IsForeignKey?e.CDGDO.ParentCostCenterID:e.CDGDO.CategoryValue));null!=t&&(e=t.ID+"_ID")}if(e.length>0&&Object.keys(this._SelectedRow.DataRow).Contains(e)){let t=parseInt(this._SelectedRow.DataRow[e]);this.LoadQueryHeaderData(t)}}}OnQueryHeaderUOMChange(e){var t=this.QueryFields.find(e=>268==e.DBColumnID);if("IGNORE"==t.ToolTipFooterDescription||0==this.QueryProductID)return;let s=0,o=null,i=null,l=null;for(let a=0;a<this.QueryFields.length;a++){let e=this.QueryFields[a];if(e.DBColumnID<0&&(Math.abs(e.DBColumnID)>=22786&&Math.abs(e.DBColumnID)<=22821||-276==e.DBColumnID||-277==e.DBColumnID)){if(this.dvQueryFields=this.dvQueryFieldsTable.filter(t=>t.CostCenterColID==Math.abs(e.DBColumnID)),0==this.dvQueryFields.length)continue;let a=null,n="<XML>"+this.QueryProductCCXML+"</XML>";-276==e.DBColumnID||-277==e.DBColumnID?(n=t.SelectedValue+"~3#"+n,null==l&&(l=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.inventory.GetPriceChart(8,this.QueryProductID,n)),a=l):Math.abs(e.DBColumnID)>=22793&&Math.abs(e.DBColumnID)<=22799||22821==Math.abs(e.DBColumnID)?(n=t.SelectedValue+"~1#"+n,null==o&&(o=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.inventory.GetPriceChart(8,this.QueryProductID,n)),a=o):(n=t.SelectedValue+"~2#"+n,null==i&&(i=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.inventory.GetPriceChart(8,this.QueryProductID,n)),a=i);let r=this.dvQueryFields[0].SysColumnName.toString();if(a.Tables.length>1&&a.Columns[1].Contains(r)&&a.Tables[1].length>0&&(s=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(a.Tables[1][0][r]),0!=s)){e.Text=s.ToString("N"+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.DecimalsinRate);continue}a.Tables.length>0&&a.Columns[0].Contains(r)&&a.Tables[0].length>0&&(s=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(a.Tables[0][0][r]),e.Text=s.ToString("N"+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.DecimalsinRate))}}}OnDataClick(e){return Object(tslib__WEBPACK_IMPORTED_MODULE_0__.b)(this,void 0,void 0,(function*(){if(e.Column.LinkType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.Document||e.Column.LinkType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.DocumentID||e.Column.LinkType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.DocumentDetailID||null!=e.Row.Cells[e.ColumnIndex].CellAppearance&&"LINK_DOCUMENT"==e.Row.Cells[e.ColumnIndex].CellAppearance.ColumnType)if(-1==e.Column.LinkDimension)null==e.Row.DataRow||Object(util__WEBPACK_IMPORTED_MODULE_24__.isUndefined)(e.Row.DataRow[e.Column.ID+"_ID"])||(this.StatusDocID=parseInt(e.Row.DataRow[e.Column.ID+"_ID"]));else if(-4==e.Column.LinkDimension)e.Row.DataRow&&!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.StringIsNullOrEmpty(e.Row.DataRow[e.Column.ID])&&_pages_home_RibbonExtViewModel__WEBPACK_IMPORTED_MODULE_28__.RibbonExtViewModel.PrintVoucher(this,e.Row.DataRow[e.Column.ID].toString());else{this._SelectedRow=e.Row;let t=new _document_viewer_DocumentViewerViewModel__WEBPACK_IMPORTED_MODULE_31__.DocumentViewerViewModel;t.DocumentViewerViewModel_Report(this,e,0),t.IsDocumentFound&&(-3==e.Column.LinkDimension?_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.ShowDialog(t,_document_viewer_document_viewer_component__WEBPACK_IMPORTED_MODULE_32__.DocumentViewerComponent):_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.addNewTab({component:_document_viewer_document_viewer_component__WEBPACK_IMPORTED_MODULE_32__.DocumentViewerComponent,params:{obj:t}}))}else{if(e.Column.LinkType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.Attachment||null!=e.Row.Cells[e.ColumnIndex].CellAppearance&&"LINK_ATTACHMENT"==e.Row.Cells[e.ColumnIndex].CellAppearance.ColumnType){this.DisplayMessage="";let t="";if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(e.Content)?e.Row.DataRow&&!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.StringIsNullOrEmpty(e.Row.DataRow[e.Column.ID+"_ID"])?t=e.Row.DataRow[e.Column.ID+"_ID"].toString():e.Row.Cells[e.ColumnIndex].Value&&(t=e.Row.Cells[e.ColumnIndex].Value.toString()):t=e.Content,t.length>0){let s=this.BaseReportColumns.find(t=>t.ID==e.Column.ID);if(s&&11691==s.CDGDO.FieldValue){if(t.length>1){let o="",i=t.split("*"),l=0,a=0;for(let e=0;e<i.length;e++){let t=i[e].split("~");t.length>0&&(0==e?(l=parseInt(t[0]),a=parseInt(t[1])):(o.length>0&&(o+=" and "),o+="ccnid"+(parseInt(t[0])-5e4)+"_Key="+t[1]))}let n=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.c;this.ReportColumns.forEach(t=>{if(s=this.BaseReportColumns.find(e=>e.ID==t.ID),s){let o;o=null!=s.CDGDO.ChildCDGDO&&s.CDGDO.ChildCDGDO.IsForeignKey?s.CDGDO.ChildCDGDO.ParentCostCenterID:s.CDGDO.IsForeignKey?s.CDGDO.ParentCostCenterID:s.CDGDO.CategoryValue,o>0&&!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Row.DataRow[t.ID+"_ID"])&&o>5e4&&!n.ContainsKey(o)&&n.push(o,parseInt(e.Row.DataRow[t.ID+"_ID"].toString()))}})}}else if(t.Contains(","));else{let e=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.GetPath(t);window.open(e)}}}else if(e.Column.LinkType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.Dimension){if(null!=e.Row.DataRow||e.Column.LinkDimension>0){let t=this.BaseReportColumns.find(t=>t.ID==e.Column.ID);if(t){let s;s=null!=t.CDGDO.ChildCDGDO&&t.CDGDO.ChildCDGDO.IsForeignKey?t.CDGDO.ChildCDGDO.ParentCostCenterID:t.CDGDO.IsForeignKey?t.CDGDO.ParentCostCenterID:t.CDGDO.CategoryValue;let o=new _document_viewer_DocumentViewerViewModel__WEBPACK_IMPORTED_MODULE_31__.DocumentViewerViewModel;o.DocumentViewerViewModel_Report(this,e,s),o.IsDocumentFound&&(-4==e.Column.LinkDimensionView?_pages_home_RibbonExtViewModel__WEBPACK_IMPORTED_MODULE_28__.RibbonExtViewModel.PrintMaster(this,"Preview",s,o.NodeID,0,!1):_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.addNewTab({component:_document_viewer_document_viewer_component__WEBPACK_IMPORTED_MODULE_32__.DocumentViewerComponent,params:{obj:o}}))}}}else if(e.Column.LinkType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.Report){if(this._SelectedRow=e.Row,null!=e.Row.DataRow&&e.Column.LinkDimension>0){let t=!1;if(null!=e.Column.MappedColumnReports)for(let s=0;s<e.Column.MappedColumnReports.length;s++){let o=e.Column.MappedColumnReports[s];if(e.Column.LinkDimension.toString()==o.attributes.ReportID.value){this.OnContextMenuClick(e.Column.ID,o,e.Column),t=!0;break}}if(!t&&null!=e.Column.MappedRowReports)for(let s=0;s<e.Column.MappedRowReports.length;s++){let o=e.Column.MappedRowReports[s];if(e.Column.LinkDimension.toString()==o.attributes.ReportID.value){this.OnContextMenuClick(e.Column.ID,o,e.Column),t=!0;break}}}}else if(e.Column.LinkType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.Add&&e.Column.LinkDimension>0){let t=0,s=0,o=this.ReportColumns.find(e=>e.LinkType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.Document);if(null!=e&&null!=e.Row&&null!=e.Row.DataRow&&""!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(e.Row.DataRow[o.ID])){let i=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetDocumentDetailsByVoucherNo(e.Row.DataRow[o.ID].toString());s=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(i.obj),s>0&&(i.Columns[0].Contains("CostCenterID")&&i.Tables[0].length>0?(t=parseInt(i.Tables[0][0].CostCenterID.toString()),s=parseInt(i.Tables[0][0].DocID.toString())):i.Tables.length>1&&i.Columns[1].Contains("CostCenterID")&&i.Tables[1].length>0&&(t=parseInt(i.Tables[1][0].CostCenterID.toString()),s=parseInt(i.Tables[1][0].DocID.toString())))}if(t>0&&s>0)if(1==e.Column.LinkDimension){let t=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.c;this.ReportColumns.forEach(s=>{let o=this.BaseReportColumns.find(e=>e.ID==s.ID);if(null!=o){let i;i=null!=o.CDGDO.ChildCDGDO&&o.CDGDO.ChildCDGDO.IsForeignKey?o.CDGDO.ChildCDGDO.ParentCostCenterID:o.CDGDO.IsForeignKey?o.CDGDO.ParentCostCenterID:o.CDGDO.CategoryValue,i>0&&""!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(e.Row.DataRow[s.ID+"_ID"])&&i>5e4&&!t.ContainsKey(i)&&t.push(i,parseInt(e.Row.DataRow[s.ID+"_ID"].toString()))}})}else if(2==e.Column.LinkDimension){const{ReportAttachmentViewModel:o}=yield Promise.resolve().then(__webpack_require__.bind(null,"OvA8"));(new o).ReportAttachmentViewModel(t,s,e.Row.DataRow,this.ReportColumns)}}else if(e.Column.LinkType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.Url)_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNullOrWhiteSpace(e.Row.Cells[e.ColumnIndex].Text)||window.open(e.Row.Cells[e.ColumnIndex].Text);else if(null!=e.Row.Cells[e.ColumnIndex].CellAppearance);else if("LEAVE_BAR"==e.Column.ColumnType&&!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Content)){let t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetDocumentDetailsByVoucherNo(e.Content);if(!(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(t.obj)>0))return;t.Tables[0].length>0?_pages_home_RibbonExtViewModel__WEBPACK_IMPORTED_MODULE_28__.RibbonExtViewModel.LoadDocument(t.Tables[0][0]):t.Tables[1].length>0&&_pages_home_RibbonExtViewModel__WEBPACK_IMPORTED_MODULE_28__.RibbonExtViewModel.LoadDocument(t.Tables[1][0])}this.SelectedRow=e.Row}}))}OnRowDoubleClick(e,t){var s;return Object(tslib__WEBPACK_IMPORTED_MODULE_0__.b)(this,void 0,void 0,(function*(){if(null!=this.DocumentObject){var o=this.DocumentObject.ReportsList.find(e=>e.DBColumnID==this.ReportID);if(o&&!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(o.ToolTipFooterDescription))return _services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.HideDialog(),!0}if(e.NodeID>0&&!e.IsGroup&&!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.BackTrackType)){if(null==this.AccountDrillDownObject){const{AccountDrillDownViewModel:e}=yield __webpack_require__.e(59).then(__webpack_require__.bind(null,"APT5"));this.AccountDrillDownObject=new e(this),this.AccountDrillDownObject.Parent=this}let t=0,s="",o="";if("ACC_TradingReports"==this.StaticReportObject.ClassName){let i=this.StaticReportObject;1==i.ReportFormat&&null!=e.Tag&&(t=parseInt(e.Tag),s=e.Cells[i.AccNameIndex].Text,o=e.Cells[i.ColumnSize+i.AccNameIndex].Text)}return this.AccountDrillDownObject.ReLoadData(e.NodeID,t,s,o),this.ShowAccountDrillDown=!0,!0}if(111==this.StaticReportType){if(null!=e.DataRow)return this.StaticReportObject.RowDblClick(e,t),!0}else{if(this.IsDocMapXMLExists||this.CanSelectRows)return this.Reorder_DoubleClick_Index(t,e,null,null,null),!0;if(null!=this.PrefetchReportTreeFilter){let s=this.PrefetchReportTreeFilter;var i=this.BaseReportColumns.find(e=>"VoucherNo"==e.CDGDO.Column),l=this.BaseReportColumns.find(e=>"VoucherNo"==e.CDGDO.Column&&"8"==e.LinkType.SelectedValue);let o;if(112==this.PrefetchReportTreeFilter.PrefetchReportType||257==this.PrefetchReportTreeFilter.PrefetchReportType)o=this.BaseReportColumns.find(e=>!("3"!=e.LinkType.SelectedValue&&"4"!=e.LinkType.SelectedValue||3!=e.CDGDO.ColumnCostCenterID&&3!=e.CDGDO.CategoryValue));else if(o=this.BaseReportColumns.find(e=>("3"==e.LinkType.SelectedValue||"4"==e.LinkType.SelectedValue)&&(e.CDGDO.ColumnCostCenterID==s.CostCenters.SelectedItem.Seq||e.CDGDO.CategoryValue==s.CostCenters.SelectedItem.Seq||null!=e.CDGDO.ChildCDGDO&&e.CDGDO.ChildCDGDO.ColumnCostCenterID==s.CostCenters.SelectedItem.Seq)),null==o){var a=s.CostCenters.Items.find(e=>e.Value==s.CostCenters.SelectedItem.Seq.toString());return this.DisplayMessage=null!=a?"Please Set '"+a.Name+"' Column As 'Link Column' in report - "+s.CostCenters.SelectedItem.Name:"'Link Column' not found in report-"+s.CostCenters.SelectedItem.Name,!0}if(o||l){var n=null!=o?this.ReportColumns.find(e=>e.ID==o.ID):null,r=null!=i?this.ReportColumns.find(e=>e.ID==i.ID):null,h=null!=l?this.ReportColumns.find(e=>e.ID==l.ID):null;if(n||h){var u=s.CostCenterFilters.find(e=>50==e.CostCenterID&&e.LookupTypeID==this.ReportID);if(!u){if(u=new _costcenter_filter_CostCenterFilter__WEBPACK_IMPORTED_MODULE_29__.a(50,this.ReportID.toString(),null!=s.CostCenters?s.CostCenters.SelectedItem.Name:"",s),!(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(s.CostCenters.SelectedItem.Aliasname)||112!=this.PrefetchReportTreeFilter.PrefetchReportType&&257!=this.PrefetchReportTreeFilter.PrefetchReportType||_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.StringIsNullOrEmpty(s.CostCenters.SelectedItem.Aliasname))){let e=s.CostCenters.SelectedItem.Aliasname.split("\x11"),t=new Array(e.length);u.Tag=t;for(let s=0;s<e.length;s++){let o=e[s].split("~"),i=this.ReportColumns.find(e=>e.ID==o[0]);t[s]=new _re_order_level_ReOrderLevelNewViewModel__WEBPACK_IMPORTED_MODULE_40__.PrefetchReportCells,t[s].indReport=this.ReportColumns.indexOf(i),t[s].ROColID=o.length>1?o[1]:o[0]}}u.SelectedNodes=new Array,s.CostCenterFilters.push(u)}this.Reorder_DoubleClick_Index(t,e,n,null!=h?h:r,u)}}else this.DisplayMessage="Product Column Not Found. Please Set Product Column As 'Link Column'";return!0}if(null!=this.MRPII&&(null===(s=this.MRPII)||void 0===s?void 0:s.ShowAllRows)){i=this.BaseReportColumns.find(e=>"VoucherNo"==e.CDGDO.Column),l=this.BaseReportColumns.find(e=>"VoucherNo"==e.CDGDO.Column&&"8"==e.LinkType.SelectedValue);let s=this.BaseReportColumns.find(e=>!("3"!=e.LinkType.SelectedValue&&"4"!=e.LinkType.SelectedValue||3!=e.CDGDO.ColumnCostCenterID&&3!=e.CDGDO.CategoryValue));return null==s?this.DisplayMessage="Product Column Not Found. Please Set Product Column As 'Link Column'":(n=this.ReportColumns.find(e=>e.ID==s.ID),r=null!=i?this.ReportColumns.find(e=>e.ID==i.ID):null,h=null!=l?this.ReportColumns.find(e=>e.ID==l.ID):null,null==n&&null==h||this.Reorder_DoubleClick_Index(t,e,n,null!=h?h:r,null)),e.IsSelected?this.MRPII.selectedRows.push(e):this.MRPII.selectedRows.Contains(e)&&this.MRPII.selectedRows.Remove(e),!0}}if(this.IsReportCollapsable){if(this.IsReportLoad)return this.OnRowDoubleClick_false(t),!1;if(e.IsGroup)e.IsExpanded?(e.IsExpanded=!1,this.CollapseGroup(e)):(e.IsExpanded=!0,this.ExpandGroup(e));else if(e.Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Group)if(e.IsExpanded){e.IsExpanded=!1;let t=this.Data.indexOf(e)+1;for(;t<this.Data.length&&this.Data[t].LevelNo>e.LevelNo;t++)this.Data[t].Visible=!1}else{e.IsExpanded=!0;let t=this.Data.indexOf(e)+1;for(;t<this.Data.length&&this.Data[t].LevelNo>e.LevelNo;t++)this.Data[t].Visible=!0}this.refreshDataView()}return this.OnRowDoubleClick_false(t),!1}))}OnRowDoubleClick_false(e){if(-1!=e){let t=this.ReportColumns[e],s=null!=t.MappedColumnReports?t.MappedColumnReports.length:0;s+=null!=t.MappedRowReports?t.MappedRowReports.length:0,1==s&&this.ContextMenuItems.forEach(e=>{var s;(null===(s=e.Tag)||void 0===s?void 0:s.attributes)&&t.ID==e.colID&&this.OnContextMenuClick(t.ID,e.Tag,t)})}}CollapseGroup(e){this.Data.filter(t=>t.Parent==e).forEach(e=>{e.Visible=!1,e.IsGroup&&this.CollapseGroup(e)})}ExpandGroup(e){this.Data.filter(t=>t.Parent==e).forEach(e=>{e.Visible=!0,e.IsGroup&&e.IsExpanded&&this.ExpandGroup(e)})}Reorder_DoubleClick_Index(e,t,s,o,i){if(-100==e||-101==e||-102==e)if(-100==e){let e=this.Data.filter(e=>e.Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Detail&&e.IsSelected);if(e.length>0)e.forEach(e=>{this.Reorder_DoubleClick(e,s,o,i,!0)});else for(let t=0;t<this.Data.length;t++)this.Data[t].Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Detail&&this.Reorder_DoubleClick(this.Data[t],s,o,i,!0)}else-101==e?this.Data.forEach(e=>{e.IsSelected||e.Type!=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Detail||this.Reorder_DoubleClick(e,s,o,i,!0)}):-102==e&&this.Data.forEach(e=>{e.IsSelected&&e.Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Detail&&this.Reorder_DoubleClick(e,s,o,i,!0)});else if(t.Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Detail)this.Reorder_DoubleClick(t,s,o,i);else if(t.Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Group){let e=this.Data.indexOf(t)+1;for(this.Reorder_DoubleClick(t,s,o,i);e<this.Data.length&&this.Data[e].LevelNo>t.LevelNo&&this.Data[e].Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Detail;e++)this.Reorder_DoubleClick(this.Data[e],s,o,i);return void(this.angularGrid&&this.angularGrid.slickGrid.invalidate())}this.angularGrid&&this.angularGrid.slickGrid.invalidate()}Reorder_DoubleClick(e,t,s,o,i=!1){let l=!1,a=null!=t?this.ReportColumns.indexOf(t):-1,n=null!=s?this.ReportColumns.indexOf(s):-1;var r;if(e.IsSelected)null!=o&&(r=o.SelectedNodes.find(t=>t.Tag==e),o.SelectedNodes.Remove(r)),e.IsSelected=!1,l=!0;else if(null==o)e.IsSelected=!0,l=!0;else if(!(r=o.SelectedNodes.find(t=>t.Tag==e))){let i=new _shared_controls_tree_TreeNode__WEBPACK_IMPORTED_MODULE_27__.a;if(i.Tag=e,i.IsGroup=e.Type!=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Detail,!i.IsGroup&&(-1!=a?(i.Id=parseInt(e.DataRow[t.ID+"_ID"]),i.Text.push(e.Cells[a].Text)):(o.IsGroupExists=!0,i.Id=parseInt(e.DataRow[s.ID+"_DID"]),i.Text.push(e.Cells[n].Text)),i.Text.push(-1!=n?e.Cells[n].Text:null),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.hasprop(e.DataRow,"ReorderDetailsID")&&e.DataRow.ReorderDetailsID.toString().length>0?i.Text.push(e.DataRow.ReorderDetailsID.toString()):i.Text.push("0"),null!=o.Tag)){let t=o.Tag,s=new Array;t.forEach(t=>{if(t.indReport>=0){let i=new _re_order_level_ReOrderLevelNewViewModel__WEBPACK_IMPORTED_MODULE_40__.PrefetchReportCells;if(i.ROColID=t.ROColID,i.value=e.Cells[t.indReport].Value,i.Type=this.ReportColumns[t.indReport].ColumnType,this.ReportColumns[t.indReport].LinkType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.Dimension||this.ReportColumns[t.indReport].LinkType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.DimensionNode)try{i.IsDimension=!0,_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.hasprop(e.DataRow,this.ReportColumns[t.indReport].ID+"_ID")&&(i.DimensionID=parseInt(e.DataRow[this.ReportColumns[t.indReport].ID+"_ID"]))}catch(o){}s.push(i)}}),s.length>0&&(i.Tree=s)}o.SelectedNodes.push(i),e.IsSelected=!0,l=!0}if(l){null!=o&&o.RefreshSelectedNodesText();for(let t=0;t<e.Cells.length;t++)null==e.Cells[t].CellAppearance&&(e.Cells[t].CellAppearance=this.ReportColumns[t].DataAppearance.Clone()),e.Cells[t].IsNormal=!1,e.Cells[t].CellAppearance.IsBold=!!e.IsSelected;if(!i){let t=this.Data.indexOf(e);t>=0&&(this.removeRowAt(t),this.insertRowAt(e,t),this.SelectedRow=null,this.SelectedRow=e)}}}OnContextMenuClick(e,t,s){switch(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(t)){case"Map":return void(null!=this.SelectedRow&&null!=this.SelectedRow.DataRow&&(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.SelectedRow.DataRow[e])||_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.ShowDialog(new _document_document_flow_chart_DocumentFlowChartViewModel__WEBPACK_IMPORTED_MODULE_42__.DocumentFlowChartViewModel(!0,this.SelectedRow.DataRow[e].toString()),_document_document_flow_chart_document_flow_chart_component__WEBPACK_IMPORTED_MODULE_43__.DocumentFlowChartComponent)));case"RowDetails":if(null==this.SelectedRow||this.SelectedRow.Type!=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Detail)return;return void _services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.ShowDialog(new _row_details_RowDetailsDialogViewModel__WEBPACK_IMPORTED_MODULE_45__.a(this),_row_details_row_details_component__WEBPACK_IMPORTED_MODULE_46__.a);case"SelectAll":return void(111==this.StaticReportType?this.StaticReportObject.SelectAllRows(s):this.OnRowDoubleClick(new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(1),-101));case"UnSelectAll":return void this.OnRowDoubleClick(new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(1),-102);case"export-excel":case"EditCreatedDate":return}if(null==this.SelectedRow||null==this.SelectedRow.DataRow)return;let o=t,i="";i+="<XML",this.SelectedRow.IsGroup&&(i+=' GroupLevel="1"'),i+=">";let l,a=0,n=!1;if("Column"==o.tagName){if(a=parseInt(o.attributes.ReportID.value),null!=o.attributes.IsPopup&&(n="1"==o.attributes.IsPopup.value),o.attributes.MapFilter.value.length>0)if(l=e+"_ID",Object.keys(this.SelectedRow.DataRow).Contains(l)||(this.StaticReportType>0&&("AccountCode"==e||"AccountName"==e)?l="AccountID":this.StaticReportType>0&&("ProductCode"==e||"ProductName"==e)&&(l="ProductID")),"EnquiryNo"==o.attributes.MapFilter.value){let t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataTable("RPT022",this.IsReportDB,"select ID from COM_DocID with(nolock) where Docno='"+this.SelectedRow.DataRow[e].toString()+"'");t.length>0&&(i+="<Row ColID='23148' Value='"+t[0].ID.toString()+"' ValueText='"+this.SelectedRow.DataRow[e].toString()+"'/>")}else Object.keys(this.SelectedRow.DataRow).Contains(l)?i+="<Row ColID='"+o.attributes.MapFilter.value+"' Value='"+_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(this.SelectedRow.DataRow[l])+"'/>":Object.keys(this.SelectedRow.DataRow).Contains(e)&&(i+="<Row ColID='"+o.attributes.MapFilter.value+"' Value='"+_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(this.SelectedRow.DataRow[e])+"'/>")}else"RowReport"==o.tagName&&(a=parseInt(o.attributes.ID.value),null!=o.attributes.IsPopup&&(n="1"==o.attributes.IsPopup.value),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(o,"Filters/ColumnFilter").forEach(e=>{l=e.attributes.PID.value+"_ID",_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.hasprop(this.SelectedRow.DataRow,l)||this.StaticReportType>0&&("AccountCode"==e.attributes.PID.value||"AccountName"==e.attributes.PID.value?l="AccountID":"ProductCode"==e.attributes.PID.value||"ProductName"==e.attributes.PID.value?l="ProductID":"DocumentName"==e.attributes.PID.value&&(l="TAG")),Object(util__WEBPACK_IMPORTED_MODULE_24__.isNullOrUndefined)(this.SelectedRow.DataRow[l])?Object(util__WEBPACK_IMPORTED_MODULE_24__.isNullOrUndefined)(this.SelectedRow.DataRow[e.attributes.PID.value])||(i+="<Row ColID='"+e.attributes.CID.value+"' Value='"+this.SelectedRow.DataRow[e.attributes.PID.value].toString()+"'/>"):i+="<Row ColID='"+e.attributes.CID.value+"' Value='"+this.SelectedRow.DataRow[l].toString()+"'/>"}));i+="</XML>";let r=new ReportViewModel;r.ReportViewModel_Document(50,i.toString(),a,n,this,o),n?_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.ShowDialog(r,_report_view_component__WEBPACK_IMPORTED_MODULE_44__.ReportViewComponent,{ShowCenter:!0,HideHeader:!0}):_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.addNewTab({component:_report_view_component__WEBPACK_IMPORTED_MODULE_44__.ReportViewComponent,params:{obj:r}})}SortList(e,t){if(!this.IsReportLoad){if(![9,11,121,122,123,124,125,126,127,257].Contains(this.StaticReportType)&&null==this.LevelColumn){let a=new Array,n=new Array;this.Data.forEach(e=>{n.push(e)}),this.Data.Clear();let r,h=0,u=0,D=0,d=null,c=!1,C=!1,p=!1,T=0,_=0,m=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.NumArray(this.ReportColumns.length,2),I=new Date(1900,1,1);if("FLOAT"==this.ReportColumns[e].ColumnType?c=!0:"DATE"==this.ReportColumns[e].ColumnType&&(C=!0),this.SNo=0,10==this.StaticReportType)"DocNo"==this.ReportColumns[e].ID&&(p=!0);else if(this.ReportColumns[e].LinkType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.Document||this.ReportColumns[e].LinkType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.DocumentID||this.ReportColumns[e].LinkType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.DocumentDetailID)p=!0;else{let t=this.BaseReportColumns.find(t=>t.ID==this.ReportColumns[e].ID);null!=t&&"VoucherNo"==t.CDGDO.Column&&0==t.CDGDO.IsForeignKey&&(p=!0)}p&&(d=this.ReportColumns[e].ID+"Ver");for(let i=0;i<n.length;i++){let l=n[i];if(l.Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Detail)a.push(l);else{if(a.length>0){let i;if(c)try{a.map(t=>t.SortData=Object(util__WEBPACK_IMPORTED_MODULE_24__.isUndefined)(t.Cells[e].Value)?0:t.Cells[e].Value),a.SortBy([{name:"SortData",parser:parseFloat,desc:!this.IsSortAscending}]),i=a}catch(s){a.map(t=>t.SortData=t.Cells[e].Text),a.SortBy([{name:"SortData",desc:!this.IsSortAscending}]),i=a}else if(C)try{a.map(t=>t.SortData=Object(util__WEBPACK_IMPORTED_MODULE_24__.isUndefined)(t.Cells[e].Value)?I:t.Cells[e].Value),a.SortBy([{name:"SortData",desc:!this.IsSortAscending}]),i=a}catch(o){a.map(t=>t.SortData=t.Cells[e].Text),a.SortBy([{name:"SortData",desc:!this.IsSortAscending}]),i=a}else if(p){let t=new Array;for(let s=0;s<a.length;s++){let o=a[s],i=new SortVouchers;if(i.Row=o,!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(o.Cells[e].Text)){for(r=o.Cells[e].Text,null!=o.DataRow&&(u=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(o.DataRow[d]),u>1&&!r.Contains(",")&&(D=r.LastIndexOf("/"),D>0&&(r=r.substr(0,D)))),h=r.length-1;h>=0&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsDigit(r[h]);h--);i.Prefix=r.substr(0,h+1),h<r.length-1&&(i.no=parseInt(r.substr(h+1)))}t.push(i)}for(t.SortBy([{name:"Prefix",desc:!this.IsSortAscending},{name:"no",desc:!this.IsSortAscending}]),i=new Array(t.length),h=0;h<t.length;h++)i[h]=t[h].Row}else a.map(t=>t.SortData=t.Cells[e].Text),a.SortBy([{name:"SortData",desc:!this.IsSortAscending}]),i=a;if(-1!=this.colSNoIndex&&i.forEach(e=>{e.Cells[this.colSNoIndex].Value=++this.SNo,e.Cells[this.colSNoIndex].Text=this.SNo.toString()}),-1!=this.CumulativeIndex&&(10==this.StaticReportType&&(_=0),i.forEach(e=>{null!=e.DataRow&&Object.keys(e.DataRow).Contains(this.CumulativeColumn)&&(T=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(e.DataRow[this.CumulativeColumn]),_+=T,this.SetCellValue(_,this.ReportColumns[this.CumulativeIndex].DataFormat,"FLOAT",e.Cells[this.CumulativeIndex]))})),this.TopRecords>0&&this.IsDefaultSortColumnExists&&!t&&this.TopRecords<i.length){for(h=0;h<this.ReportColumns.length;h++)m[h][1]=0;for(let e=0;e<this.TopRecords&&e<i.length;e++)if(this.addRow(i[e]),l.Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.SubTotal||l.Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.ReportTotal){for(h=0;h<this.ReportColumns.length;h++)this.TotalCols.Contains(this.ReportColumns[h].ID)&&null!=i[e].Cells[h].Value&&(m[h][1]+=parseFloat(i[e].Cells[h].Value));for(h=0;h<this.ReportColumns.length;h++)this.TotalCols.Contains(this.ReportColumns[h].ID)&&null!=l.Cells[h].Value&&ReportViewModel.SetCellValue(m[h][1],this.ReportColumns[h].DataFormat,"FLOAT",h,l.Cells[h])}for(h=0;h<this.ReportColumns.length;h++)m[h][0]+=m[h][1]}else t||this.ReportViewType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DashBoard&&this.ReportViewType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.LoadDataOnly?this.Data.InsertRange(this.Data.length,i):i.forEach(e=>{this.addRow(e)});a.Clear()}this.addRow(l)}}if(a.length>0){let s;if(c)try{a.map(t=>t.SortData=Object(util__WEBPACK_IMPORTED_MODULE_24__.isUndefined)(t.Cells[e].Value)?0:t.Cells[e].Value),a.SortBy([{name:"SortData",parser:parseFloat,desc:!this.IsSortAscending}]),s=a}catch(i){a.map(t=>t.SortData=t.Cells[e].Text),a.SortBy([{name:"SortData",desc:!this.IsSortAscending}]),s=a}else if(C)try{a.map(t=>t.SortData=Object(util__WEBPACK_IMPORTED_MODULE_24__.isUndefined)(t.Cells[e].Value)?0:t.Cells[e].Value),a.SortBy([{name:"SortData",desc:!this.IsSortAscending}]),s=a}catch(l){a.map(t=>t.SortData=t.Cells[e].Text),a.SortBy([{name:"SortData",desc:!this.IsSortAscending}]),s=a}else if(p){let t=new Array;for(let s=0;s<a.length;s++){let o=a[s],i=new SortVouchers;if(i.Row=o,!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(o.Cells[e].Text)){for(r=o.Cells[e].Text,null!=o.DataRow&&(u=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(o.DataRow[d]),u>1&&!r.Contains(",")&&(D=r.LastIndexOf("/"),D>0&&(r=r.substr(0,D)))),h=r.length-1;h>=0&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsDigit(r[h]);h--);i.Prefix=r.substr(0,h+1),h<r.length-1&&(i.no=parseInt(r.substr(h+1)))}t.push(i)}for(t.SortBy([{name:"Prefix",desc:!this.IsSortAscending},{name:"no",desc:!this.IsSortAscending}]),s=new Array(t.length),h=0;h<t.length;h++)s[h]=t[h].Row}else a.map(t=>t.SortData=t.Cells[e].Text),a.SortBy([{name:"SortData",desc:!this.IsSortAscending}]),s=a;if(-1!=this.colSNoIndex&&s.forEach(e=>{e.Cells[this.colSNoIndex].Value=++this.SNo,e.Cells[this.colSNoIndex].Text=this.SNo.toString()}),-1!=this.CumulativeIndex&&(10==this.StaticReportType&&(_=0),s.forEach(e=>{null!=e.DataRow&&(T=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(e.DataRow[this.CumulativeColumn]),_+=T,this.SetCellValue(_,this.ReportColumns[this.CumulativeIndex].DataFormat,"FLOAT",e.Cells[this.CumulativeIndex]))})),this.TopRecords>0&&this.IsDefaultSortColumnExists&&!t)for(let e=0;e<this.TopRecords&&e<s.length;e++)this.addRow(s[e]);else t||this.ReportViewType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DashBoard&&this.ReportViewType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.LoadDataOnly?this.Data.InsertRange(this.Data.length,s):s.forEach(e=>{this.addRow(e)});a.Clear()}}this.refreshDataView()}}ApplyDefaultSort(){if(this.Preferences.ContainsKey("DefaultSortColumn")&&!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.Preferences.DefaultSortColumn))for(let e=0;e<this.ReportColumns.length;e++)if(this.ReportColumns[e].ID==this.Preferences.DefaultSortColumn){this.IsSortAscending="DESC"!=this.Preferences.DefaultSortOrder,this.SortList(e,!1);break}}}class SortVouchers{}class Group extends _Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.c{constructor(){super(...arguments),this.ShowAsColumn=!1,this.Level=0,this.Width=0,this.Height=0,this.Row=0,this.Column=0,this.SubTotalShowCaption=1,this.SubTotalLevel=0,this.SubTotalWidth=0,this.SubTotalHeight=0,this.SubTotalBorder=0,this.SubTotalShowAtCollapse=!1,this.TotalCols=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a,this.TempTotalCols=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a}}},WqAs:function(e,t,s){"use strict";s.d(t,"a",(function(){return c}));var o=s("Do2H"),i=s("Lp6j"),l=s("eQJW"),a=s("dH+5"),n=s("mvPR"),r=s("vTM8"),h=s("MCLT"),u=s("1xwR"),D=s("8iaB"),d=function(e){return e[e.None=0]="None",e[e.MonthWise=1]="MonthWise",e[e.QtrWise=4]="QtrWise",e[e.HalfYearWise=5]="HalfYearWise",e[e.YearWise=3]="YearWise",e[e.TagWise=2]="TagWise",e}({});class c extends u.b{constructor(e){super(e),this.Show=d.None,this.i=0,this.k=0,this.jAccount=0,this.GLClubTranBy=0,this.dsAccount=null,this.Balance=0,this.OpBalance=0,this.exchRate=0,this.IsSalesContractLedger=!1,this.ShowMonthWise=!1,this.IsRetainedEarning=!1,this.colBalanceIndex=-1,this.colDebitIndex=-1,this.colCreditIndex=-1,this.colSpanBF=-1,this.colSubTotalStartIndex=0,this.GroupTotalIndex=0,this.colLocalAmtInd=-1,this.colPDCInd=-1,this.colTBOp_DrIndex=-1,this.colTBOp_CrIndex=-1,this.colTBTr_DrIndex=-1,this.colTBTr_CrIndex=-1,this.colTBCl_DrIndex=-1,this.colTBCl_CrIndex=-1,this.colOpBalanceIndex=-1,this.colParticularIndex=-1,this.IncludeBFInTotals=!1,this.AccountsWithOutTransactions=!1,this.AccountsWithZeroBalance=!1,this.HideEmptyDimensions=!1,this.PDCSeperate=!1,this.PDCDrCrSeperate=!1,this.STAccountWise=!1,this.STMonthWise=!1,this.STDayWise=!1,this.ShowGL_INVDetailReport=!1,this.AccountsWithOnlyOPB=!1,this.TBIsAccountWise=!1,this.TBOpeningDrCrSeperately=!1,this.TBTransactionsDrCrSeperately=!1,this.OpenCompany=!1,this.ShowTagWise=!1,this.DontShowREforPeriodInAssignedAccount=!1,this.TBShowdetailsofControlGroups=!1,this.UnPostedDocsSeparately=!1,this.UnPostedDocsSeparatelyByStatus=!1,this.AllowAddRows=!1,this.GLJVDetails=!1,this.HideSectionSubTotal=!1,this.ShowUnInvoicedAmount=!1,this.GroupTotalsAtEnd=!1,this.GroupTotalsSeperate=!1,this.DontShowSummaryGroupTotals=!1,this.GLSortTransactions=!1,this.ExcludeOpBalance=!1,this.ShowGroupHighLowValues=!1,this.ExcludeClBalance=!1,this.OpDrCrInOpDr=!1,this.IsFCClosingDebitExists=!1,this.TagID=0,this.ForeignCurrencyID=0,this.CurrencyType=0,this.YTDIndex=0,this.YTD_LYIndex=0,this.BAL_LYIndex=0,this.BalIndex=0,this.TTColumnSize=0,this.TTReportTotalIndex=0,this.TTAccNameIndex=0,this.ShowGL_ACCDetailReport=0,this.TagTableName=null,this.GLSortTransactionsBy="",this.dvYTD=null,this.dvBAL_LY=null,this.dvYTD_LY=null,this.dvYTDTable=null,this.dvBAL_LYTable=null,this.dvYTD_LYTable=null,this.dtOpenCompanyYearStart=null,this.CountMonths=0,this.CADimension=0,this.strRetainedAccounts="",this.GLRetainedAccounts=new r.a,this.IsNewAccount=!0,this.HideOpeningProfitAndLoss=!1,this.HideOpeningBalanceDifference=!1,this.IsTTypeTB=!1,this.IsControlAccounts=!1,this.IsCurrentControlAccount=!1,this.ShowPDCPaymentsFirst=!1,this.dec="",this.LocationWhere="",this.filter="",this.oLocalAmount=null,this.TagCols=[],this.dbl=0,this.Row=0,this.Col=0,this.rows=[],this.arrUnPostedStatusesID=[],this.arrUnPostedStatuses=[],this.colIndex=new r.c,this.GTPQuery="",this.GTPWhere="",this.strOrder="",this.TBGroupID="",this.ExcludeTreeTotalCols=[],this.lstTags=[],this.lstParticularID=[],this.dtParticulars=null,this.dtParticularsColumns=null,this.iDataSetCollection=[],this.dicInvRows=new r.a,this.al=[],this.aldim=[],this.TempChunkSize=0,this.iLoop=0,this.oCBCell=new n.c,this.oCBFormat=new n.b,this.dblCBMin=0,this.dblCBMax=0,this.LevelNo=0,this.dsOpenCompany=null,this.dvOpenCompany=null,this.dvOpenCompanyTable=null,this.lstTotal=null,this.arrTBTotals=null,this.dblDrOpenCompany=0,this.dblCrOpenCompany=0,this.dblMissingOpeningDr=0,this.dblMissingOpeningCr=0,this.lstParents=[],this.IsFirstCall=!1,this.FirstTypeEndIndex=0,this.CellStartPos=0,this.CallFrom=0}LoadReport(){new Promise((e,t)=>{this.resolve=e,this.LoadReport_Promise()}).then(()=>{this.ViewModel.process_RunWorkerCompleted()})}LoadReport_Promise(){if((this.ViewModel.StaticReportType>=1||this.ViewModel.StaticReportType<=4)&&"True"==o.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==o.a.SessionManager.Preferences["LW Reports"]&&"True"==o.a.SessionManager.Preferences.LWAccPeriod&&(1==this.ViewModel.StaticReportType&&this.ViewModel.Preferences.ContainsKey("ExcludeOpBalance")&&"1"==this.ViewModel.Preferences.ExcludeOpBalance||this.CheckLWAccountingDate(),!i.e.IsEmpty(this.ViewModel.DisplayMessage)))return;this.promiseRE=null,this.GrdRow=-1,this.GroupTotalIndex=-1,this.colSubTotalStartIndex=-1,this.YTDIndex=this.YTD_LYIndex=this.BAL_LYIndex=-1,this.IsSalesContractLedger=!1,this.oColumns=this.ViewModel.ColumnSource,2==this.ViewModel.StaticReportType||3==this.ViewModel.StaticReportType?this.AggTotal=i.e.NumArray(this.oColumns.length+1,2):1!=this.ViewModel.StaticReportType&&86!=this.ViewModel.StaticReportType||(this.AggTotal=i.e.NumArray(this.oColumns.length,5)),this.lstTotal=new Array,this.DataSetCollection.Clear(),this.iDataSetCollection.Clear(),this.ViewModel.lstGroupIndex.Clear(),this.ViewModel.SNo=0,this.OpenCompany=Object(l.j)(o.a.SessionManager.Preferences.OpenCompany);for(let o=0;o<this.oColumns.length;o++)if("Debit"==this.oColumns[o].ID||"Credit"==this.oColumns[o].ID||"Balance"==this.oColumns[o].ID){this.colSpanBF=o;break}if(this.ViewModel.lstGroup.length>0)for(this.k=0;this.k<this.oColumns.length;this.k++)if(this.ViewModel.lstGroup[0].TotalCols.ContainsKey(this.oColumns[this.k].ID)){this.colSubTotalStartIndex=this.k;break}for(let o=this.oColumns.length-1;o>=0;o--)"Balance"==this.oColumns[o].ID||"NetBalance"==this.oColumns[o].ID?this.colBalanceIndex=o:"Debit"==this.oColumns[o].ID?this.colDebitIndex=o:"Credit"==this.oColumns[o].ID?this.colCreditIndex=o:"LastYearBalance"==this.oColumns[o].ID?this.BAL_LYIndex=o:"LastYearYTD"==this.oColumns[o].ID?this.YTD_LYIndex=o:"OP_Dr"==this.oColumns[o].ID?this.colTBOp_DrIndex=o:"OP_Cr"==this.oColumns[o].ID?this.colTBOp_CrIndex=o:"TR_Dr"==this.oColumns[o].ID?this.colTBTr_DrIndex=o:"TR_Cr"==this.oColumns[o].ID?this.colTBTr_CrIndex=o:"CL_Dr"==this.oColumns[o].ID?this.colTBCl_DrIndex=o:"CL_Cr"==this.oColumns[o].ID?this.colTBCl_CrIndex=o:"OpBalance"==this.oColumns[o].ID?this.colOpBalanceIndex=o:"TotalPDC"==this.oColumns[o].ID?this.colPDCInd=o:0==i.e.stringCompare(this.oColumns[o].Formula,"SNO",!0)&&(this.ViewModel.colSNoIndex=o);let e="",t=this.ViewModel.oReportDialog.GetSeqNosList();if(this.LocationWhere="",this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(this.LocationWhere=i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?" AND 1!=1":" AND DCC.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),this.ChunkSize=this.ViewModel.Preferences.ContainsKey("ChunkSize")?parseInt(this.ViewModel.Preferences.ChunkSize):1,this.CurrencyType=0,this.ForeignCurrencyID=0,this.ViewModel.Preferences.ContainsKey("ForeignCurrency")){let e=new i.f;e.LoadXml("<XML>"+this.ViewModel.Preferences.ForeignCurrency+"</XML>");let t=i.f.SelectSingleNode(e.DocumentElement,"IsChecked");null!=t&&"1"==t.innerHTML&&(this.ForeignCurrencyID=parseInt(i.f.SelectSingleNodeText(e.DocumentElement,"Value")))}else if(this.ViewModel.Preferences.ContainsKey("Currency")){let e=new i.f;e.LoadXml("<XML>"+this.ViewModel.Preferences.Currency+"</XML>"),this.CurrencyType=parseInt(i.f.SelectSingleNodeText(e.DocumentElement,"Type")),1==this.CurrencyType?(i.e.IsEmpty(o.a.SessionManager.Preferences.DimensionwiseCurrency)||0==parseInt(o.a.SessionManager.Preferences.DimensionwiseCurrency))&&(this.CurrencyType=0):2==this.CurrencyType&&(this.ForeignCurrencyID=parseInt(i.f.SelectSingleNodeText(e.DocumentElement,"Value")))}if(this.ViewModel.ConstructFormulaFields(!1),this.ViewModel.FormulasCalculated=!1,this.ShowGL_INVDetailReport=!(!this.ViewModel.Preferences.ContainsKey("ShowDetailReportINV")||"1"!=this.ViewModel.Preferences.ShowDetailReportINV),this.ShowGL_ACCDetailReport=this.ViewModel.Preferences.ContainsKey("ShowDetailReportACC")&&"1"==this.ViewModel.Preferences.ShowDetailReportACC?1:0,1==this.ShowGL_ACCDetailReport&&this.ViewModel.Preferences.ContainsKey("GroupByParticular")&&"1"==this.ViewModel.Preferences.GroupByParticular&&(this.ShowGL_ACCDetailReport=2),this.UnPostedDocsInclude=!(!this.ViewModel.Preferences.ContainsKey("IncludeUnPostedDocs")||"1"!=this.ViewModel.Preferences.IncludeUnPostedDocs),this.UnPostedDocsList=this.UnPostedDocsInclude&&this.ViewModel.Preferences.ContainsKey("IncludeUnPostedDocsList")?this.ViewModel.Preferences.IncludeUnPostedDocsList:"",this.IncludeUnApprovedPDC=!(!this.ViewModel.Preferences.ContainsKey("IncludeUnApprovedPDC")||"1"!=this.ViewModel.Preferences.IncludeUnApprovedPDC),this.IncludeTerminatedPDC=!this.ViewModel.Preferences.ContainsKey("IncludeTerminatedPDC")||"0"!=this.ViewModel.Preferences.IncludeTerminatedPDC,this.HideOpeningProfitAndLoss=!(!this.ViewModel.Preferences.ContainsKey("HideOpeningProfitAndLoss")||"1"!=this.ViewModel.Preferences.HideOpeningProfitAndLoss),this.HideOpeningBalanceDifference=!(!this.ViewModel.Preferences.ContainsKey("HideOpeningBalanceDifference")||"1"!=this.ViewModel.Preferences.HideOpeningBalanceDifference),this.DontShowREforPeriodInAssignedAccount=!(!this.ViewModel.Preferences.ContainsKey("DontShowREforPeriodInAssignedAccount")||"1"!=this.ViewModel.Preferences.DontShowREforPeriodInAssignedAccount),this.GLSortTransactions=!(!this.ViewModel.Preferences.ContainsKey("SortTransactions")||"1"!=this.ViewModel.Preferences.SortTransactions),this.GLSortTransactionsBy=this.ViewModel.Preferences.ContainsKey("SortTransactionsBy")?this.ViewModel.Preferences.SortTransactionsBy:"",this.HideSectionSubTotal=!!this.ViewModel.Preferences.ContainsKey("HideSectionSubTotal"),this.DontApplyLocationWiseAccountsFilter=!(!this.ViewModel.Preferences.ContainsKey("DontApplyLocationWiseAccountsFilter")||"1"!=this.ViewModel.Preferences.DontApplyLocationWiseAccountsFilter),this.DontApplyLocationWiseAccountsFilter||(this.ApplyLWAccountLFilterWhenIgnoreLoc=!(!this.ViewModel.Preferences.ContainsKey("ApplyLWAccountLFilterWhenIgnoreLoc")||"1"!=this.ViewModel.Preferences.ApplyLWAccountLFilterWhenIgnoreLoc)),this.ShowGroupHighLowValues=!(!this.ViewModel.Preferences.ContainsKey("ShowGroupHighLowValues")||"1"!=this.ViewModel.Preferences.ShowGroupHighLowValues),this.ShowGroupHighLowValues&&("Monthly"==this.ViewModel.Preferences.Balancing&&(this.ShowGroupHighLowValues=!1),this.oCBFormat.DecimalsPoints=parseInt(o.a.SessionManager.Preferences.DecimalsinAmount),this.oCBFormat.NegativeNumber=4,this.oCBFormat.ShowDefaultSign=0,"Millions"==o.a.SessionManager.Preferences.Commas?this.oCBFormat.Commas=1:"Lakhs"==o.a.SessionManager.Preferences.Commas&&(this.oCBFormat.Commas=2)),this.TagCols.Clear(),156!=this.ViewModel.StaticReportType&&t.length>0&&(this.ViewModel.oReportDialog.IsZeroSelected||this.ViewModel.oReportDialog.IsOneSelected||(t=this.ViewModel.oReportDialog.GetSeqNosListWithRoots(),this.ViewModel.oReportDialog.IsGroupExists?(this.GTPWhere="A1.AccountID=GTP.GTID",this.GTPQuery=t.Contains(",")?",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID IN ("+t+") group by T.AccountID) AS GTP ":",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID="+t+" group by T.AccountID) AS GTP "):this.GTPWhere=t.Contains(",")?"A1.AccountID IN ("+t+")":"A1.AccountID="+t),0!=this.GTPWhere.length&&this.OpenCompany)){this.OpenCompany=!1;let e=this.ViewModel.oReportDialog.FromDate.Date;if(this.DontShowREforPeriodInAssignedAccount&&(e=new Date(this.ViewModel.oReportDialog.FromDate.Date.getFullYear(),this.AccountingFromMonth-1,1),e>this.ViewModel.oReportDialog.FromDate.Date&&(e=e.AddYears(-1))),null!=this.ViewModel.oReportDialog.DefaultTreeSelectedNodes){let t=o.a.report.ReportDataTable("RPT021",this.ViewModel.IsReportDB,e.ToString("dd MMM yyyy"));for(let e=0;e<t.length;e++){let s=t[e];if(this.ViewModel.oReportDialog.DefaultTreeSelectedNodes.find(e=>e.Id==parseInt(s.AccountID))){this.OpenCompany=!0;break}}}4!=this.ViewModel.StaticReportType||this.OpenCompany||(this.OpenCompany=!0,this.DontShowREforPeriodInAssignedAccount=!0)}if(1==this.ViewModel.StaticReportType){if(this.STAccountWise=this.ViewModel.Preferences.SubTotals.Contains("AccountWise"),this.STMonthWise=this.ViewModel.Preferences.SubTotals.Contains("MonthWise"),this.STDayWise=this.ViewModel.Preferences.SubTotals.Contains("DayWise"),this.IncludeBFInTotals="1"==this.ViewModel.Preferences.AddOpeningBalance,this.ExcludeOpBalance=!(!this.ViewModel.Preferences.ContainsKey("ExcludeOpBalance")||"1"!=this.ViewModel.Preferences.ExcludeOpBalance),this.AccountsWithOutTransactions="1"==this.ViewModel.Preferences.WantAccountsWithoutTransactions,this.AccountsWithOnlyOPB=!(!this.ViewModel.Preferences.ContainsKey("WantAccountsWithOnlyOPB")||"1"!=this.ViewModel.Preferences.WantAccountsWithOnlyOPB),this.AccountsWithZeroBalance="1"==this.ViewModel.Preferences.WantAccountsWithZeroBalances,this.PDCInclude="1"==this.ViewModel.Preferences.IncludePDCs,this.PDCSeperate="1"==this.ViewModel.Preferences.PDCsSeparately,this.ShowPDCPaymentsFirst=!(!this.ViewModel.Preferences.ContainsKey("PDCPaymentsFirst")||"1"!=this.ViewModel.Preferences.PDCPaymentsFirst),this.PDCDrCrSeperate="1"==this.ViewModel.Preferences.ShowDebitCreditSeparated,this.UnPostedDocsSeparately=!(!this.ViewModel.Preferences.ContainsKey("UnPostedDocsSeparately")||"1"!=this.ViewModel.Preferences.UnPostedDocsSeparately),this.UnPostedDocsSeparatelyByStatus=!(!this.ViewModel.Preferences.ContainsKey("UnPostedDocsSeparatelyByStatus")||"1"!=this.ViewModel.Preferences.UnPostedDocsSeparatelyByStatus),this.GLJVDetails=!(!this.ViewModel.Preferences.ContainsKey("GLJVDetails")||"1"!=this.ViewModel.Preferences.GLJVDetails),this.ViewModel.DocumentFilters.ContainsKey("CONTRACTNODEID")&&(this.ShowUnInvoicedAmount=!(!this.ViewModel.Preferences.ContainsKey("ShowUnInvoicedAmount")||"1"!=this.ViewModel.Preferences.ShowUnInvoicedAmount)),this.UnPostedDocsSeparatelyByStatus&&this.UnPostedDocsList.length>0){let e=this.UnPostedDocsList.split(",");new Array(e.length);for(let t=0;t<e.length;t++)this.arrUnPostedStatusesID.push(e[t]),this.arrUnPostedStatuses.push("371"==e[t]?"Un-Approved Documents":"376"==e[t]?"Cancelled Documents":"372"==e[t]?"Rejected Documents":"441"==e[t]?"Approved Documents":"Other Status("+e[t]+") Documents");this.PDCInclude&&!this.PDCSeperate&&(this.arrUnPostedStatusesID.push("370"),this.arrUnPostedStatuses.push("PDC Documents"),this.arrUnPostedStatusesID.push("439"),this.arrUnPostedStatuses.push("PDC Discounted"),this.IncludeTerminatedPDC&&(this.arrUnPostedStatusesID.push("452"),this.arrUnPostedStatuses.push("Terminated PDC Documents")))}if(this.TagID=0,this.ShowTagWise=!1,2==this.ViewModel.lstGroup.length){if(this.ViewModel.ReportGroups[1].CDGDO.ColumnCostCenterID>5e4&&(this.TagID=this.ViewModel.ReportGroups[1].CDGDO.ColumnCostCenterID),this.ViewModel.Preferences.ContainsKey("TagWise")){let e=new i.f;e.LoadXml("<XML>"+this.ViewModel.Preferences.TagWise+"</XML>");let t=i.f.SelectSingleNode(e.DocumentElement,"IsChecked");null!=t&&"1"==t.innerHTML&&(t=i.f.SelectSingleNode(e.DocumentElement,"Value"),this.TagID=parseInt(t.innerHTML))}}else if(this.ViewModel.Preferences.ContainsKey("TagWise")){let e=new i.f;e.LoadXml("<XML>"+this.ViewModel.Preferences.TagWise+"</XML>");let t=i.f.SelectSingleNode(e.DocumentElement,"IsChecked");null!=t&&"1"==t.innerHTML&&(this.ShowTagWise=!0,t=i.f.SelectSingleNode(e.DocumentElement,"Value"),this.TagID=parseInt(t.innerHTML),this.TagTableName=c.GetTagTableName(this.TagID),this.HideEmptyDimensions=null!=i.f.SelectSingleNode(e.DocumentElement,"HideColumns"),this.TagColumnName="Name",t=i.f.SelectSingleNode(e.DocumentElement,"Column"),null!=t&&("0"==t.innerHTML?this.TagColumnName="Code":"2"==t.innerHTML&&(this.TagColumnName="Code+'-'+Name")))}if(this.ViewModel.Preferences.ContainsKey("CurrencyWise")&&"1"==this.ViewModel.Preferences.CurrencyWise&&(this.CurrencyType=-1,this.ViewModel.Preferences.ContainsKey("HideEmptyCurrencies")&&"1"==this.ViewModel.Preferences.HideEmptyCurrencies&&(this.HideEmptyDimensions=!0)),1==this.ViewModel.StaticReportType&&!this.ViewModel.DocumentFilters.ContainsKey("CONTRACTNODEID")&&o.a.SessionManager.Preferences.ContainsKey("IsControlAccounts")&&"TRUE"==o.a.SessionManager.Preferences.IsControlAccounts.toUpperCase()&&this.ViewModel.Preferences.ContainsKey("AccountTypesFilter")&&this.ViewModel.Preferences.AccountTypesFilter.length>0&&this.ViewModel.Preferences.AccountTypesFilter.Contains(",")){let e=this.ViewModel.Preferences.AccountTypesFilter.split(",");e.Contains("6")||e.Contains("7")||(this.IsControlAccounts=!0)}if(e="SELECT A1.AccountID,A1.AccountTypeID,A1.AccountName,A1.GLClubTranBy"+this.ViewModel.GroupSelectTag,this.IsControlAccounts&&("Code"==this.ViewModel.Preferences.TreeSortOn?e+=",A1.AccountCode":"TreeOrder"==this.ViewModel.Preferences.TreeSortOn&&(e+=",A1.lft"),o.a.SessionManager.Preferences.ContainsKey("ControlAccDimension")&&(this.CADimension=i.e.Int(o.a.SessionManager.Preferences.ControlAccDimension)),e+=0==this.CADimension?",0 IsControl":",A1CC.CCNID"+(this.CADimension-5e4)+" CAD"),e+="",this.ShowUnInvoicedAmount&&(e+=",dbo.fnREN_UnInvoicedAmount("+this.ViewModel.DocumentFilters.CONTRACTNODEID+",A1.AccountID) UnInvoicedAmount"),e+=" FROM ACC_Accounts A1 with(nolock)",this.CADimension>0&&(e+=" join COM_CCCCDATA A1CC with(nolock) on A1CC.CostCenterID=2 and A1CC.NodeID=A1.AccountID"),e+=this.ViewModel.GroupFromTag+this.GTPQuery,e+=" WHERE (A1.IsGroup=0 and A1.AccountID>1 ",this.ViewModel.Preferences.ContainsKey("IncludeIntPDCsInBank")){this.ViewModel.kpiList.Clear(),this.ViewModel.kpiListSrc.Clear();let t="";t+='<Row ID="ROW_KPI" Formula="if(StatusID==-1) 1 else 0" Expression=" if (StatusID==-1)1 else 0" BackColor="#FFEEF7EA" ForeColor="" Img="" Text="" />',t+='<Row ID="ROW_KPI" Formula="if(StatusID==-2) 1 else 0" Expression=" if (StatusID==-2)1 else 0" BackColor="#FFE9EFF4" ForeColor="" Img="" Text="" />',t="<XML>"+t,t+="</XML>";let s=new i.f;s.LoadXml(t.toString()),s.DocumentElement.childNodes.forEach(e=>{let t=new u.a;t.KPI_1(e,this.ViewModel),this.ViewModel.kpiList.push(t),this.ViewModel.kpiListSrc.push(this.ViewModel.kpiList[this.ViewModel.kpiList.length-1])}),e+=" and A1.AccountTypeID=2"}else e+=this.GetAccountTypeWhere("A1");e+=this.GetAccountWiseLocationWhere("A1"),this.GTPWhere.length>0&&(e+=" AND "+this.GTPWhere);let t="",s="",l="";this.ViewModel.DocumentFilters.ContainsKey("CONTRACTNODEID")?(t=" D.RefCCID= "+this.ViewModel.DocumentFilters.CONTRACTRefCCID+" AND D.RefNodeid="+this.ViewModel.DocumentFilters.CONTRACTNODEID,e+=" AND A1.AccountID IN (select DebitAccount from ACC_DocDetails D with(nolock) where "+t+"\nunion select CreditAccount from ACC_DocDetails D with(nolock) where "+t+"\nunion select DebitAccount from ACC_DocDetails D with(nolock)\ninner join (select AccDocDetailsID from ACC_DocDetails D with(nolock) where "+t+") t on t.AccDocDetailsID=D.RefNodeid and  D.RefCCID=400 \nunion select CreditAccount from ACC_DocDetails D with(nolock)\ninner join (select AccDocDetailsID from ACC_DocDetails D with(nolock) where "+t+") t on t.AccDocDetailsID=D.RefNodeid and  D.RefCCID=400)"):(this.SetRetainedEarnings(),this.LocationWhere.length>0&&(s=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.AccDocDetailsID=ACC.AccDocDetailsID "+this.LocationWhere,l=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=ACC.InvDocDetailsID "+this.LocationWhere),t=" WHERE DocDate BETWEEN CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"')) AND CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",e+=" AND (",this.AccountsWithOutTransactions||this.AccountsWithOnlyOPB?(this.CADimension>0&&(e+="A1CC.CCNID"+(this.CADimension-5e4)+">1 or "),e+="A1.AccountID IN (SELECT CreditAccount FROM ACC_DocDetails AS Cr with(nolock) UNION SELECT DebitAccount FROM ACC_DocDetails AS Dr with(nolock))"):(this.CADimension>0&&(e+="A1CC.CCNID"+(this.CADimension-5e4)+">1 or "),e+="A1.AccountID IN (SELECT CreditAccount FROM ACC_DocDetails ACC WITH(NOLOCK) "+s+t,e+=" UNION SELECT DebitAccount FROM ACC_DocDetails ACC WITH(NOLOCK) "+s+t,l.length>0&&(e+=" UNION SELECT CreditAccount FROM ACC_DocDetails ACC WITH(NOLOCK) "+l+t,e+=" UNION SELECT DebitAccount FROM ACC_DocDetails ACC WITH(NOLOCK) "+l+t),e+=")"),e+=")"),e+=")",this.ViewModel.DocumentFilters.ContainsKey("CONTRACTNODEID")||(e+="^strRetainedAccounts^"),this.IsControlAccounts&&0==this.CADimension&&(e+="\nunion all\nSELECT A1.AccountID,A1.AccountTypeID,A1.AccountName,A1.GLClubTranBy"+this.ViewModel.GroupSelectTag,this.IsControlAccounts&&("Code"==this.ViewModel.Preferences.TreeSortOn?e+=",A1.AccountCode":"TreeOrder"==this.ViewModel.Preferences.TreeSortOn&&(e+=",A1.lft"),e+=",1 IsControl"),e+=" FROM ACC_Accounts A1 with(nolock) join ACC_Accounts CA with(nolock) on A1.lft between CA.lft and CA.rgt\njoin (select ParentID from ACC_Accounts with(nolock) where AccountTypeID in (6,7) group by ParentID) as DCA on DCA.ParentID=A1.AccountID"+this.ViewModel.GroupFromTag+this.GTPQuery+"\nWHERE A1.IsGroup=1 and A1.AccountID>1 and (CA.AccountID="+o.a.SessionManager.Preferences.DebtorsControlGroup+" or CA.AccountID="+o.a.SessionManager.Preferences.CreditorsControlGroup+")",e+=this.GetAccountTypeWhere("A1"),this.GTPWhere.length>0&&(e+=" AND "+this.GTPWhere)),e+="Code"==this.ViewModel.Preferences.TreeSortOn?" Order By A1.AccountCode":"TreeOrder"==this.ViewModel.Preferences.TreeSortOn?" Order By A1.lft":" Order By A1.AccountName";let r=new Array;for(let e=0;e<this.ViewModel.ColumnSource.length;e++)r.push(this.ViewModel.ColumnSource[e].Clone());if(this.ShowTagWise){let e;this.ViewModel.TotalCols.Clear(),this.ViewModel.GrpReportTotal.TotalCols.Clear(),this.ViewModel.AddTotalColumnsToGroup(this.ViewModel.GrpReportTotal,this.ViewModel.ReportDoc.SelectSingleNode("PactRevenURpts/PactRevenURptDef/ReportTotal/Columns")),this.ViewModel.lstGroup.forEach(e=>{e.TotalCols.Clear(),this.ViewModel.AddTotalColumnsToGroup(e,this.ViewModel.ReportDoc.SelectSingleNode("PactRevenURpts/PactRevenURptDef/ReportTotal/Columns"))}),-1!=this.colBalanceIndex?e=r[this.colBalanceIndex].Clone():-1!=this.colDebitIndex?e=r[this.colDebitIndex].Clone():-1!=this.colCreditIndex?e=r[this.colCreditIndex].Clone():(e=new a.b,e.DataFormat=new n.b),e.DataFormat.NegativeNumber=4,e.DataFormat.ShowDefaultSign=0;let t=this.GetTagWiseQuery(this.TagID,this.TagColumnName,"Name");o.a.report.DataSet("RPT022",t).Tables[0].forEach(t=>{{let s=e.Clone();s.HeaderText=t.Name.toString(),s.ID="TAG"+t.NodeID.toString(),r.push(s),++this.CountMonths,this.TagCols.push(s),this.ViewModel.TotalCols.push(s.ID),this.ViewModel.GrpReportTotal.TotalCols.push(s.ID,this.TagCols.length-1),this.ViewModel.lstGroup[0].TotalCols.push(s.ID,this.TagCols.length-1)}})}else if(-1==this.CurrencyType&&-1!=this.colBalanceIndex){r.Clear(),this.ViewModel.TotalCols.Clear(),this.ViewModel.GrpReportTotal.TotalCols.Clear(),this.ViewModel.AddTotalColumnsToGroup(this.ViewModel.GrpReportTotal,this.ViewModel.ReportDoc.SelectSingleNode("PactRevenURpts/PactRevenURptDef/ReportTotal/Columns")),this.ViewModel.lstGroup.forEach(e=>{e.TotalCols.Clear(),this.ViewModel.AddTotalColumnsToGroup(e,this.ViewModel.ReportDoc.SelectSingleNode("PactRevenURpts/PactRevenURptDef/ReportTotal/Columns"))});for(let e=0;e<this.ViewModel.ColumnSource.length;e++)if(r.push(this.ViewModel.ColumnSource[e].Clone()),this.colBalanceIndex==e){let e;o.a.report.DataSet("ACC101","").Tables[0].forEach(t=>{-1!=this.colDebitIndex&&(e=r[this.colDebitIndex].Clone(),e.HeaderText=t.Name.ToString()+"\r\n"+e.HeaderText,e.ID="CURRDR"+t.NodeID.ToString(),r.push(e),this.TagCols.push(e),this.ViewModel.TotalCols.push(e.ID),this.ViewModel.GrpReportTotal.TotalCols.push(e.ID,this.TagCols.length-1),this.ViewModel.lstGroup[0].TotalCols.push(e.ID,this.TagCols.length-1)),-1!=this.colCreditIndex&&(e=r[this.colCreditIndex].Clone(),e.HeaderText=t.Name.ToString()+"\r\n"+e.HeaderText,e.ID="CURRCR"+t.NodeID.ToString(),r.push(e),this.TagCols.push(e),this.ViewModel.TotalCols.push(e.ID),this.ViewModel.GrpReportTotal.TotalCols.push(e.ID,this.TagCols.length-1),this.ViewModel.lstGroup[0].TotalCols.push(e.ID,this.TagCols.length-1)),-1!=this.colBalanceIndex&&(e=r[this.colBalanceIndex].Clone(),e.HeaderText=t.Name.ToString()+"\r\n"+e.HeaderText,e.ID="CURRBL"+t.NodeID.ToString(),r.push(e),this.TagCols.push(e),this.ViewModel.TotalCols.push(e.ID),this.ViewModel.GrpReportTotal.TotalCols.push(e.ID,this.TagCols.length-1),this.ViewModel.lstGroup[0].TotalCols.push(e.ID,this.TagCols.length-1))}),-1!=this.colDebitIndex&&(r[this.colDebitIndex].HeaderAppearance.IsVisible=!1),-1!=this.colCreditIndex&&(r[this.colCreditIndex].HeaderAppearance.IsVisible=!1),-1!=this.colBalanceIndex&&(r[this.colBalanceIndex].HeaderAppearance.IsVisible=!1)}r[0].HeaderHeight<40&&r.forEach(e=>e.HeaderHeight=45)}this.oLocalAmount=r.find(e=>"LocalAmount"==e.ID),this.oLocalAmount&&(0==this.ForeignCurrencyID?this.oLocalAmount.HeaderAppearance.IsVisible=!1:(this.colLocalAmtInd=r.indexOf(this.oLocalAmount),this.ViewModel.ColumnSource.find(e=>"LocalAmount"==e.ID&&e.HeaderAppearance.IsVisible)&&(this.oLocalAmount.HeaderAppearance.IsVisible=!0))),this.ViewModel.ReportColumns=r,this.oColumns=this.ViewModel.ReportColumns,this.AggTotal=i.e.NumArray(this.oColumns.length,5)}else if(2==this.ViewModel.StaticReportType||3==this.ViewModel.StaticReportType)this.IncludeBFInTotals=!this.ViewModel.Preferences.ContainsKey("AddOpeningBalance")||"0"!=this.ViewModel.Preferences.AddOpeningBalance,this.GLJVDetails=!(!this.ViewModel.Preferences.ContainsKey("GLJVDetails")||"1"!=this.ViewModel.Preferences.GLJVDetails),2==this.ViewModel.StaticReportType?this.strAccountType="AND A1.AccountTypeID=1":3==this.ViewModel.StaticReportType&&(this.strAccountType="AND (A1.AccountTypeID=2 OR A1.AccountTypeID=3)"),e="SELECT A1.AccountID,A1.AccountTypeID,A1.AccountName,A1.GLClubTranBy"+this.ViewModel.GroupSelectTag+" FROM ACC_Accounts A1 with(nolock)"+this.ViewModel.GroupFromTag+this.GTPQuery+" WHERE A1.IsGroup=0 "+this.strAccountType,e+=this.GetAccountWiseLocationWhere("A1"),this.GTPWhere.length>0&&(e+=" AND "+this.GTPWhere),e+=" Order By A1.AccountName";else if(4==this.ViewModel.StaticReportType){if(-1!=this.colBalanceIndex?this.oColumns[this.colBalanceIndex].DataFormat.DecimalsPoints>0&&(this.dec="N"+this.oColumns[this.colBalanceIndex].DataFormat.DecimalsPoints.toString()):this.dec="N"+o.a.SessionManager.Preferences.DecimalsinAmount,this.Show=d.None,this.ViewModel.Preferences.ContainsKey("FinalReportsShow")){let e=this.ViewModel.Preferences.FinalReportsShow;"1"==e?(this.Show=d.MonthWise,this.ViewModel.oReportDialog.FromDate.Date.getMonth()==this.ViewModel.oReportDialog.ToDate.Date.getMonth()&&(this.ViewModel.oReportDialog.FromDate.Date.getFullYear(),this.ViewModel.oReportDialog.ToDate.Date.getFullYear()),-1!=this.colTBTr_CrIndex&&-1!=this.colTBTr_DrIndex&&-1!=this.colTBOp_DrIndex&&-1!=this.colBalanceIndex||(this.Show=d.None)):"2"==e&&(this.Show=d.TagWise,this.TagID=parseInt(this.ViewModel.Preferences.FinalReportsShowTag),this.ViewModel.Preferences.ContainsKey("FinalReportsShowTagHideColumns")&&(this.HideEmptyDimensions=!0),this.TagColumnName="Name",this.ViewModel.Preferences.ContainsKey("FinalReportsShowTagColumn")&&("0"==this.ViewModel.Preferences.FinalReportsShowTagColumn?this.TagColumnName="Code":"2"==this.ViewModel.Preferences.FinalReportsShowTagColumn&&(this.TagColumnName="Code+'-'+Name")))}else if(this.ViewModel.Preferences.ContainsKey("TagWise")){let e=new i.f;e.LoadXml("<XML>"+this.ViewModel.Preferences.TagWise+"</XML>");let t=i.f.SelectSingleNode(e.DocumentElement,"IsChecked");null!=t&&"1"==t.innerHTML&&(this.Show=d.TagWise,t=i.f.SelectSingleNode(e.DocumentElement,"Value"),this.TagID=parseInt(t.innerHTML),this.TagTableName=c.GetTagTableName(this.TagID),this.HideEmptyDimensions=null!=i.f.SelectSingleNode(e.DocumentElement,"HideColumns"),this.TagColumnName="Name",t=i.f.SelectSingleNode(e.DocumentElement,"Column"),null!=t&&("0"==t.innerHTML?this.TagColumnName="Code":"2"==t.innerHTML&&(this.TagColumnName="Code+'-'+Name")))}this.AccountsWithOutTransactions="1"==this.ViewModel.Preferences.WantAccountsWithoutTransactions,this.AccountsWithZeroBalance="1"==this.ViewModel.Preferences.WantAccountsWithZeroBalances,this.TBIsAccountWise="1"==this.ViewModel.Preferences.AccountWise,this.TBOpeningDrCrSeperately="1"==this.ViewModel.Preferences.ShowOpeningDrCrSeperately,this.TBTransactionsDrCrSeperately="1"==this.ViewModel.Preferences.ShowTransactionsDrCrSeperately,this.TBShowdetailsofControlGroups=!(!this.ViewModel.Preferences.ContainsKey("ShowdetailsofControlGroups")||"1"!=this.ViewModel.Preferences.ShowdetailsofControlGroups),this.LevelNo=parseInt(this.ViewModel.Preferences.Level),this.PDCInclude=!(!this.ViewModel.Preferences.ContainsKey("IncludePDCs")||"1"!=this.ViewModel.Preferences.IncludePDCs),this.GroupTotalsAtEnd=!(!this.ViewModel.Preferences.ContainsKey("GroupTotalsAtEnd")||"1"!=this.ViewModel.Preferences.GroupTotalsAtEnd),this.GroupTotalsSeperate=!(!this.ViewModel.Preferences.ContainsKey("GroupTotalsSeperate")||"1"!=this.ViewModel.Preferences.GroupTotalsSeperate),this.DontShowSummaryGroupTotals=!(!this.ViewModel.Preferences.ContainsKey("DontShowSummaryGroupTotals")||"1"!=this.ViewModel.Preferences.DontShowSummaryGroupTotals),this.IsTTypeTB=!(!this.ViewModel.Preferences.ContainsKey("TType")||"1"!=this.ViewModel.Preferences.TType),this.IsTTypeTB||(this.OpDrCrInOpDr=!(!this.ViewModel.Preferences.ContainsKey("OpDrCrInOpDr")||"1"!=this.ViewModel.Preferences.OpDrCrInOpDr)),this.dtYearStartMonth=new Date((new Date).getFullYear(),this.AccountingFromMonth-1,1),this.dtYearStartMonth>Date.Today()&&(this.dtYearStartMonth=this.dtYearStartMonth.AddYears(-1))}else if(86==this.ViewModel.StaticReportType){this.STAccountWise=!0,this.STMonthWise=!1,this.STDayWise=!1,this.IncludeBFInTotals=!(!this.ViewModel.Preferences.ContainsKey("AddOpeningBalance")||"1"!=this.ViewModel.Preferences.AddOpeningBalance),this.AccountsWithOutTransactions="1"==this.ViewModel.Preferences.WantAccountsWithoutTransactions,this.AccountsWithZeroBalance="1"==this.ViewModel.Preferences.WantAccountsWithZeroBalances,this.TBTransactionsDrCrSeperately=!(!this.ViewModel.Preferences.ContainsKey("ShowTransactionsDrCrSeperately")||"1"!=this.ViewModel.Preferences.ShowTransactionsDrCrSeperately),this.PDCInclude=!(!this.ViewModel.Preferences.ContainsKey("IncludeUnPostedDocsList")||"1"!=this.ViewModel.Preferences.IncludePDCs),this.PDCSeperate=!1,this.PDCDrCrSeperate=!1,this.UnPostedDocsSeparately=!1,this.ExcludeOpBalance=!(!this.ViewModel.Preferences.ContainsKey("ExcludeOpBalance")||"1"!=this.ViewModel.Preferences.ExcludeOpBalance),this.TagID=0;var s=this.ViewModel.BaseReportColumns.find(e=>"DocumentName"==e.ID);if(s)if(s.CDGDO.ColumnCostCenterID>5e4)this.TagID=s.CDGDO.ColumnCostCenterID,this.TagTableName=c.GetTagTableName(this.TagID);else if(400==s.CDGDO.CategoryValue&&"DocDate"==s.CDGDO.Column&&null!=s.CDGDO.Formula&&(s.CDGDO.Formula.toUpperCase().Contains("MMM")||s.CDGDO.Formula.toUpperCase().Contains("MONTH"))){this.TagID=-100;var r=this.oColumns.find(e=>"DocumentName"==e.ID);r&&(r.Formula="")}e="SELECT A1.AccountID,A1.AccountTypeID,A1.AccountName"+this.ViewModel.GroupSelectTag+" FROM ACC_Accounts A1 with(nolock)"+this.ViewModel.GroupFromTag+this.GTPQuery+" WHERE A1.IsGroup=0 and A1.AccountID>1 ",e+=this.GetAccountWiseLocationWhere("A1"),this.GTPWhere.length>0&&(e+=" AND "+this.GTPWhere);let t="",o="",i="";this.LocationWhere.length>0&&(o=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.AccDocDetailsID=ACC.AccDocDetailsID "+this.LocationWhere,i=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=ACC.InvDocDetailsID "+this.LocationWhere),t=" WHERE DocDate BETWEEN CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"')) AND CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",this.AccountsWithOutTransactions?e+=" AND A1.AccountID IN (SELECT CreditAccount FROM ACC_DocDetails AS Cr with(nolock) UNION SELECT DebitAccount FROM ACC_DocDetails AS Dr with(nolock))":(e+=" AND A1.AccountID IN (SELECT CreditAccount FROM ACC_DocDetails ACC WITH(NOLOCK) "+o+t,e+=" UNION SELECT DebitAccount FROM ACC_DocDetails ACC WITH(NOLOCK) "+o+t,i.length>0&&(e+=" UNION SELECT CreditAccount FROM ACC_DocDetails ACC WITH(NOLOCK) "+i+t,e+=" UNION SELECT DebitAccount FROM ACC_DocDetails ACC WITH(NOLOCK) "+i+t),e+=")"),this.SetRetainedEarnings(),e+="^strRetainedAccounts^",e+="Code"==this.ViewModel.Preferences.TreeSortOn?" Order By A1.AccountCode":"TreeOrder"==this.ViewModel.Preferences.TreeSortOn?" Order By A1.lft":" Order By A1.AccountName"}else if(156==this.ViewModel.StaticReportType){if(this.STAccountWise=this.ViewModel.Preferences.SubTotals.Contains("AccountWise"),this.STMonthWise=this.ViewModel.Preferences.SubTotals.Contains("MonthWise"),this.STDayWise=this.ViewModel.Preferences.SubTotals.Contains("DayWise"),this.IncludeBFInTotals="1"==this.ViewModel.Preferences.AddOpeningBalance,this.AccountsWithOutTransactions="1"==this.ViewModel.Preferences.WantDimensionsWithoutTransactions,this.AccountsWithZeroBalance=!(!this.ViewModel.Preferences.ContainsKey("WantDimensionsWithZeroBalances")||"1"!=this.ViewModel.Preferences.WantDimensionsWithZeroBalances),this.PDCInclude="1"==this.ViewModel.Preferences.IncludePDCs,this.PDCSeperate="1"==this.ViewModel.Preferences.PDCsSeparately,this.PDCDrCrSeperate="1"==this.ViewModel.Preferences.ShowDebitCreditSeparated,this.UnPostedDocsSeparately=!(!this.ViewModel.Preferences.ContainsKey("UnPostedDocsSeparately")||"1"!=this.ViewModel.Preferences.UnPostedDocsSeparately),this.TagID=0,this.ShowTagWise=!1,1==this.ViewModel.lstGroup.length&&this.ViewModel.ReportGroups[0].CDGDO.ColumnCostCenterID>5e4&&(this.TagID=this.ViewModel.ReportGroups[0].CDGDO.ColumnCostCenterID,this.TagTableName=c.GetTagTableName(this.TagID)),e="SELECT A1.NodeID,A1.Name TagName"+this.ViewModel.GroupSelectTag+" FROM "+this.TagTableName+" A1 with(nolock)"+this.ViewModel.GroupFromTag+" WHERE A1.IsGroup=0 ",!this.ViewModel.HideCostCenterTree)if(this.TagID<5e4||this.TagID==this.ViewModel.oReportDialog.TreeCCID){let s=t.split(",");s.Contains("1")||s.Contains("0")||(e+=" AND A1.NodeID IN ("+t+")")}else{let t=this.GetFilterByDimension_1(this.TagID);t.length>0&&(e+=" AND A1.NodeID IN ("+t+")")}e+="Code"==this.ViewModel.Preferences.TreeSortOn?" Order By A1.Code":"TreeOrder"==this.ViewModel.Preferences.TreeSortOn?" Order By A1.lft":" Order By A1.Name",this.AggTotal=i.e.NumArray(this.oColumns.length,5)}else 169==this.ViewModel.StaticReportType&&(this.GLJVDetails=!(!this.ViewModel.Preferences.ContainsKey("GLJVDetails")||"1"!=this.ViewModel.Preferences.GLJVDetails),e="SELECT A1.AccountID,A1.AccountName FROM ACC_Accounts A1 with(nolock)"+this.GTPQuery+" WHERE A1.IsGroup=0 ",e+=this.GetAccountTypeWhere("A1"),e+=this.GetAccountWiseLocationWhere("A1"),this.GTPWhere.length>0&&(e+=" AND "+this.GTPWhere),e+=" Order By A1.AccountName");if(1==this.ViewModel.StaticReportType)this.promiseRE?this.promiseRE.then(()=>{this.GLStart(e)}):this.GLStart(e);else if(2==this.ViewModel.StaticReportType||3==this.ViewModel.StaticReportType)o.a.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,e).then(e=>{this.dsAccount=e,this.al=[],this.al.push(""),this.al.push(""),this.al.push(null),this.al.push(0),this.al.push(this.GLClubTranBy),this.al.push(this.ViewModel.oReportDialog.FromDate.Date),this.al.push(this.ViewModel.oReportDialog.ToDate.Date),this.al.push(this.UnPostedDocsList),this.al.push(this.PDCInclude),this.al.push(!1),this.al.push(!0),this.al.push(!1),this.al.push(!1),this.al.push(""),this.al.push(""),this.al.push(0),this.al.push(this.ViewModel.StaticReportType),this.al.push(""),this.al.push(3!=this.ViewModel.StaticReportType||"ChequeDate"!=this.ViewModel.Preferences.DateFilter&&"MaturityDate"!=this.ViewModel.Preferences.DateFilter?"":this.ViewModel.Preferences.DateFilter),this.al.push(this.RoundOff),this.al.push(0),this.al.push(""),this.al.push(0),this.al.push(this.LocationWhere+this.GetDimensionFilter("DCC.dcCCNID")),this.al.push(this.ShowGL_INVDetailReport),this.al.push(this.ShowGL_ACCDetailReport),this.al.push(this.CurrencyType),this.al.push(this.ForeignCurrencyID),this.al.push(this.GLJVDetails),this.al.push(""),this.al.push(this.ViewModel.SelectTag+this.ViewModel.GroupSelectTag),this.al.push(this.ViewModel.FromTag+this.ViewModel.GroupFromTag);let t=this.ViewModel.SelectTagAliasOnly+this.ViewModel.GroupSelectTagAlias;if(t.length>0&&!this.ShowGL_INVDetailReport&&0==this.ShowGL_ACCDetailReport){let e=t.Trim(",").split(",");t="";for(let s=0;s<e.length;s++)t+=",MAX("+e[s]+") "+e[s]}this.al.push(t),this.al.push(o.a.SessionManager.LanguageID),this.ViewModel.DisplayMessage="",this.TempChunkSize=0,this.GLClubTranBy=0,this.iLoop=0,this.CBCallBack()});else if(4==this.ViewModel.StaticReportType)this.IsTTypeTB?(this.YTDIndex=-1,this.BAL_LYIndex=-1,this.YTD_LYIndex=-1,this.Show=d.None,this.GroupTotalsSeperate=!1,this.GroupTotalsAtEnd=!1,this.TBOpeningDrCrSeperately=!1,this.TBTransactionsDrCrSeperately=!1,this.ViewModel.IsReportCollapsable=!1):this.ViewModel.IsReportCollapsable=!0,this.SetTrialBalanceDataSet(t).then(e=>{this.dv=this.ds.Tables[0],this.dvTable=this.ds.Tables[0],this.dvColumns=this.ds.Columns[0],this.ds.Columns[0].push("CL_Dr"),this.ds.Columns[0].push("CL_Cr"),this.ds.Columns[0].push("NetBalance"),this.IsFCClosingDebitExists&&(this.ds.Columns[0].push("FCClosingDebit"),this.ds.Columns[0].push("FCClosingCredit"));let t=new Array;if(this.IsTTypeTB){this.BalIndex=-1,this.CellStartPos=0;for(let e=0;e<this.ViewModel.ColumnSource.length;e++)"AccountCode"==this.ViewModel.ColumnSource[e].ID?t.push(this.ViewModel.ColumnSource[e]):"AccountName"==this.ViewModel.ColumnSource[e].ID&&(t.push(this.ViewModel.ColumnSource[e]),this.TTAccNameIndex=t.length-1);if(-1==this.colTBCl_DrIndex)return void(this.ViewModel.DisplayMessage="Please Enable Closing Debit Column");if(-1==this.colTBCl_CrIndex)return void(this.ViewModel.DisplayMessage="Please Enable Closing Credit Column");t.push(this.ViewModel.ColumnSource[this.colTBCl_DrIndex].Clone()),this.BalIndex=t.length-1,this.TTColumnSize=t.length;for(let e=0;e<this.TTColumnSize-1;e++)t.push(t[e].Clone());t.push(this.ViewModel.ColumnSource[this.colTBCl_CrIndex].Clone())}else{for(let e=0;e<this.ViewModel.ColumnSource.length;e++)t.push(this.ViewModel.ColumnSource[e]);if(this.GroupTotalsSeperate){let e=this.ViewModel.ColumnSource[this.ViewModel.ColumnSource.length-1].Clone();e.HeaderText="TOTAL",e.ID="GroupTotal",t.push(e),this.GroupTotalIndex=t.length-1}if(this.ViewModel.lstGroup.length>0&&(this.ViewModel.GrpReportTotal.TotalCols.Clear(),this.ViewModel.TotalCols.Clear(),this.ViewModel.lstGroup.forEach(e=>{e.TotalCols.Clear()}),this.ViewModel.GrpReportTotal.TempTotalCols.keys.forEach(e=>{var s=t.find(t=>t.ID==e);if(s){let o=t.indexOf(s);this.ViewModel.TotalCols.Contains(e)||this.ViewModel.TotalCols.push(e),this.ViewModel.GrpReportTotal.TotalCols.push(e,o)}}),this.ViewModel.lstGroup.forEach(e=>{e.TempTotalCols.forEach(s=>{var o=t.find(e=>e.ID==s.Key);if(o){let i=t.indexOf(o);this.ViewModel.TotalCols.Contains(s.Key)||this.ViewModel.TotalCols.push(s.Key),e.TotalCols.push(s.Key,i)}})})),this.Show!=d.None){let e=t.length,s=t[t.length-1].Clone();if(this.Show==d.TagWise){let e=this.GetTagWiseQuery(this.TagID,this.TagColumnName,"Name");o.a.report.DataSet("RPT022",e).Tables[0].forEach(e=>{if(this.dv=this.dvTable.filter(t=>t.Tag==e.NodeID),this.dv.length>0){let o=s.Clone();o.HeaderText=e.Name.toString(),o.ID=e.NodeID.toString(),t.push(o),++this.CountMonths,this.ds.Columns[0].push(o.ID)}}),this.dv=this.dvTable}else if(this.Show==d.MonthWise){let e=new Date(this.ViewModel.oReportDialog.FromDate.Date.getFullYear(),this.ViewModel.oReportDialog.FromDate.Date.getMonth(),1);for(;e<=this.ViewModel.oReportDialog.ToDate.Date;){let o;o=s.Clone(),o.HeaderText=e.ToString(" MMM-yy")+"\r\n"+this.ViewModel.ReportColumns[this.colTBOp_DrIndex].HeaderText,o.ID="OpDr"+e.getFullYear()+"-"+e.iMonth(),t.push(o),this.ds.Columns[0].push(o.ID),o=s.Clone(),o.HeaderText=e.ToString(" MMM-yy")+"\r\n"+this.ViewModel.ReportColumns[this.colTBTr_DrIndex].HeaderText,o.ID="TrDr"+e.getFullYear()+"-"+e.iMonth(),o.DataFormat.NegativeNumber=0,t.push(o),this.ds.Columns[0].push(o.ID),o=s.Clone(),o.HeaderText=e.ToString(" MMM-yy")+"\r\n"+this.ViewModel.ReportColumns[this.colTBTr_CrIndex].HeaderText,o.ID="TrCr"+e.getFullYear()+"-"+e.iMonth(),o.DataFormat.NegativeNumber=0,t.push(o),this.ds.Columns[0].push(o.ID),o=s.Clone(),o.HeaderText=e.ToString(" MMM-yy")+"\r\n"+this.ViewModel.ReportColumns[this.colBalanceIndex].HeaderText,o.ID="Net"+e.getFullYear()+"-"+e.iMonth(),t.push(o),this.ds.Columns[0].push(o.ID),this.lstTags.push(e.getFullYear()+"-"+e.iMonth()),++this.CountMonths,e=this.Show==d.MonthWise?e.AddMonths(1):e.AddYears(1)}t[0].HeaderHeight<40&&(t.forEach(e=>{e.HeaderHeight=45}),s.HeaderHeight=45)}if(this.ViewModel.lstGroup.length>0)for(let o=e;o<t.length;o++)"FLOAT"==t[o].ColumnType&&(this.ViewModel.TotalCols.Contains(t[o].ID)||this.ViewModel.TotalCols.push(t[o].ID),this.ViewModel.GrpReportTotal.TotalCols.ContainsKey(t[o].ID)||this.ViewModel.GrpReportTotal.TotalCols.push(t[o].ID,o),this.ViewModel.lstGroup.forEach(e=>{e.TotalCols.ContainsKey(t[o].ID)||e.TotalCols.push(t[o].ID,o)}))}}this.ViewModel.ReportColumns=t,this.oColumns=this.ViewModel.ReportColumns,this.TBIsAccountWise&&this.UpdateDataTableWithGroups(),this.IsTTypeTB?this.addTrialBalanceTType():this.addTrialBalance(),this.LoadReportComplete()});else if(86==this.ViewModel.StaticReportType)this.promiseRE?this.promiseRE.then(()=>{this.GLSummaryStart(e)}):this.GLSummaryStart(e);else if(156==this.ViewModel.StaticReportType)o.a.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,e).then(e=>{this.dsAccount=e,this.al=[],this.al.push(this.ViewModel.Preferences.ContainsKey("AccountTypesFilter")?this.ViewModel.Preferences.AccountTypesFilter:""),this.al.push(this.ViewModel.oReportDialog.FromDate.Date),this.al.push(this.ViewModel.oReportDialog.ToDate.Date),this.al.push(this.UnPostedDocsList),this.al.push(this.PDCInclude),this.al.push(this.IncludeUnApprovedPDC),this.al.push(this.IncludeTerminatedPDC),this.al.push(this.PDCSeperate),this.al.push(this.PDCDrCrSeperate),this.al.push(this.ViewModel.Preferences.FilterOn),this.al.push(this.ViewModel.Preferences.SortOn),this.al.push(this.TagID),this.al.push(c.GetTagTableName(this.TagID));let t,s=this.LocationWhere+this.GetDimensionFilter("DCC.dcCCNID");t=this.GetFilterByDimension_1(300),t.length>0&&(s+=" AND D.CostCenterID IN ("+t+")"),t=this.GetFilterByDimension_1(2),t.length>0&&(s+=" AND A.AccountID IN ("+t+")"),this.al.push(s),this.al.push(this.ShowGL_INVDetailReport),this.al.push(this.ShowGL_ACCDetailReport),this.al.push(this.CurrencyType),this.al.push(this.ForeignCurrencyID),this.al.push(this.ViewModel.SelectTag+this.ViewModel.GroupSelectTag),this.ViewModel.DocumentFilters.ContainsKey("CONTRACTNODEID")?(this.IsSalesContractLedger=!0,this.al.push("AND D.RefCCID="+this.ViewModel.DocumentFilters.CONTRACTRefCCID+" AND D.RefNodeid='"+this.ViewModel.DocumentFilters.CONTRACTNODEID+"' "+this.ViewModel.FromTag+this.ViewModel.GroupFromTag)):this.al.push(this.ViewModel.FromTag+this.ViewModel.GroupFromTag);let i=this.ViewModel.SelectTagAliasOnly+this.ViewModel.GroupSelectTagAlias;if(i.length>0&&!this.ShowGL_INVDetailReport&&0==this.ShowGL_ACCDetailReport){let e=i.Trim(",").split(",");i="";for(let t=0;t<e.length;t++)i+=",MAX("+e[t]+") "+e[t]}this.al.push(i),this.al.push(0),this.al.push(o.a.SessionManager.LanguageID),this.ViewModel.DisplayMessage="",o.a.report.GetGLOnlyDimension(this.al,this.ViewModel.IsReportDB).then(e=>{for(this.ds=e,this.DataSetCollection.push(this.ds),this.dvAccount=this.ds.Tables[0],this.dvAccountTable=this.ds.Tables[0],this.dvAccountColumns=this.ds.Columns[0],this.jAccount=0;this.jAccount<this.dsAccount.Tables[0].length;this.jAccount++){if(this.ViewModel.process.CancellationPending)return void(this.ViewModel.processArgs.Cancel=!0);this.strAccountID=this.dsAccount.Tables[0][this.jAccount].NodeID.toString(),this.strAccountFilterObj={},this.strAccountFilterObj.TAG=this.strAccountID,this.strAccountName=this.dsAccount.Tables[0][this.jAccount].TagName.toString(),this.dv=this.ds.Tables[1],this.dvTable=this.ds.Tables[1],this.dvColumns=this.ds.Columns[1],this.dvAccount=this.dvAccountTable.fill(e=>e.TAG==this.strAccountID),this.dv=this.dvTable.fill(e=>e.TAG==this.strAccountID),this.ds.Tables.length>2&&(this.dvTbl2=this.ds.Tables[2].filter(e=>e.TAG==this.strAccountID),this.dvTbl2Table=this.ds.Tables[2],this.dvTbl2Columns=this.ds.Columns[2]),this.AllowAddRows=!!(this.dv.length>0||this.AccountsWithOutTransactions||this.ds.Tables.length>2&&this.dvTbl2.length>0),this.UnPostedDocsInclude&&this.UnPostedDocsSeparately&&(this.strAccountFilterObj.StatusID=[369,429],this.dv=this.dv.filter(e=>369==e.StatusID||429==e.StatusID)),this.OpBalance=this.dvAccount.length>0?parseFloat(this.dvAccount[0].BF):0,this.AllowAddRows&&(this.AccountsWithZeroBalance||0!=this.GetBalance())&&(this.IsNewAccount=!0,this.addGeneralLedger())}}).then(e=>{this.LoadReportComplete()})});else if(157==this.ViewModel.StaticReportType&&this.ViewModel.Preferences.ContainsKey("VerticalReport")){this.PDCInclude="1"==this.ViewModel.Preferences.IncludePDCs,this.ShowMonthWise="1"==this.ViewModel.Preferences.MonthWiseData,this.ExcludeOpBalance=!(!this.ViewModel.Preferences.ContainsKey("ExcludeOpBalance")||"1"!=this.ViewModel.Preferences.ExcludeOpBalance),this.PDCSeperate=!(!this.ViewModel.Preferences.ContainsKey("PDCsSeparately")||"1"!=this.ViewModel.Preferences.PDCsSeparately),this.ExcludeClBalance=!(!this.ViewModel.Preferences.ContainsKey("ExcludeClBalance")||"1"!=this.ViewModel.Preferences.ExcludeClBalance),this.LevelNo=0;let e=!1;this.ViewModel.HideCostCenterTree||(this.ViewModel.oReportDialog.IsOneSelected||this.ViewModel.oReportDialog.IsZeroSelected)&&(t="");let s=[];s.push(!0),s.push(this.GTPQuery),s.push(this.GTPWhere),s.push(this.ViewModel.oReportDialog.FromDate.Date),s.push(this.ViewModel.oReportDialog.ToDate.Date),s.push(this.UnPostedDocsList),s.push(this.PDCSeperate),s.push(this.PDCInclude),s.push(this.IncludeTerminatedPDC),s.push(this.LocationWhere+this.GetDimensionFilter("DCC.dcCCNID")),s.push(e),s.push(this.ShowMonthWise),s.push(o.a.SessionManager.LanguageID),o.a.report.GetReceiptsPayments(s,this.ViewModel.IsReportDB).then(e=>{this.ds=e;let t=0,s=0,l=[],a=new Array;var r=this.ViewModel.ColumnSource.find(e=>"Rec_Name"==e.ID).Clone(),h=this.ViewModel.ColumnSource.find(e=>"Rec_Amount"==e.ID).Clone();if(r.ID="Account",r.HeaderText="",h.ID="Amount",a.push(r),a.push(h),s=1,this.ShowMonthWise){h.HeaderText="TOTAL";let e,s=new Date(this.ViewModel.FromDatePicker.Date.getFullYear(),this.ViewModel.FromDatePicker.Date.getMonth(),1);for(;s<=this.ViewModel.ToDatePicker.Date;){t++;let e=h.Clone();e.HeaderText=s.ToString("MMM yyyy"),e.ID=s.getFullYear()+"_"+s.getMonth(),l.push(e.ID),this.ds.Columns[0].push(e.ID),this.ds.Columns[1].push(e.ID),this.ds.Columns[2].push(e.ID),a.InsertAt(e,t),s=s.AddMonths(1)}let o,i=null;for(let t=0;t<this.ds.Tables[1].length;t++)o=this.ds.Tables[1][t],e=o.YM.toString(),i!=o.AccountID.toString()?(i=o.AccountID.toString(),e.length>0&&this.ds.Columns[1].Contains(e)&&(o[e]=o.Amount)):(e.length>0&&this.ds.Columns[1].Contains(e)&&(this.ds.Tables[1][t-1][e]=o.Amount,null!=o.Amount&&(this.ds.Tables[1][t-1].Amount=null!=this.ds.Tables[1][t-1][e]?parseFloat(this.ds.Tables[1][t-1].Amount)+parseFloat(o.Amount):parseFloat(o.Amount))),this.ds.Tables[1].RemoveAt(t),t--);for(let t=0;t<this.ds.Tables[2].length;t++)o=this.ds.Tables[2][t],e=o.YM.toString(),e.length>0&&this.ds.Columns[2].Contains(e)&&(t>0?(this.ds.Tables[2][0][e]=o.Amount,this.ds.Tables[2].RemoveAt(t),t--):o[e]=o.Amount)}if(this.ViewModel.ReportColumns=a,this.oColumns=this.ViewModel.ReportColumns,this.AggTotal=i.e.NumArray(this.oColumns.length,6),this.ds.Columns[0].push("Amount"),!this.ExcludeOpBalance){this.oRow=this.NewReportRow_2(n.f.BalanceBF,this.GrossTotalAppearance_Data),this.oRow.Cells[0].Text=o.a.GetResource("Reports_OpeningBalance"),this.oRow.Cells[0].CellAppearance.Alignment="Left",this.ViewModel.addRow(this.oRow);let e=0;if(this.ds.Tables[0].length>0&&this.ds.Columns[0].Contains("OpAmount")&&null!=this.ds.Tables[0][0].OpAmount&&(e=parseFloat(this.ds.Tables[0][0].OpAmount)),this.ShowMonthWise){let t=e;for(let e=0;e<l.length;e++)this.AggTotal[1+e][0]=t,this.ds.Tables[0][0][l[e]]=t,null!=this.ds.Tables[2][0][l[e]]&&(t+=parseFloat(this.ds.Tables[2][0][l[e]])),this.ds.Tables[2][0][l[e]]=t;this.AggTotal[1+l.length][0]=e}else this.AggTotal[1][0]=e;for(let t=0;t<this.oColumns.length;t++)"FLOAT"==this.oColumns[t].ColumnType&&this.ViewModel.SetCellValue(this.AggTotal[t][0],this.oColumns[t].DataFormat,this.oColumns[t].ColumnType,this.oRow.Cells[t])}this.dv=this.ds.Tables[1],this.dvTable=this.ds.Tables[1],this.dvColumns=this.ds.Columns[1],this.dv=this.dvTable.filter(this.PDCSeperate?e=>e.Amount>0&&370!=e.StatusID&&439!=e.StatusID:e=>e.Amount>0),this.AddSection_RPVertical(1),this.PDCSeperate&&(this.dv=this.dvTable.filter(e=>e.Amount>0&&(370==e.StatusID||439==e.StatusID)),this.AddSection_RPVertical(3)),this.dv=this.dvTable.filter(this.PDCSeperate?e=>e.Amount<0&&370!=e.StatusID&&439!=e.StatusID:e=>e.Amount<0),this.AddSection_RPVertical(2),this.PDCSeperate&&(this.dv=this.dvTable.filter(e=>e.Amount<0&&(370==e.StatusID||439==e.StatusID)),this.AddSection_RPVertical(4)),this.oRow=this.NewReportRow_2(n.f.BalanceBF,this.GrossTotalAppearance_Data),this.oRow.Cells[0].Text=o.a.GetResource("Reports_ClosingBalance"),this.oRow.Cells[0].CellAppearance.Alignment="Left",this.ViewModel.addRow(this.oRow);for(let o=0;o<this.oColumns.length;o++)"FLOAT"==this.oColumns[o].ColumnType&&this.ViewModel.SetCellValue(this.AggTotal[o][0]+this.AggTotal[o][1]+this.AggTotal[o][3]+this.AggTotal[o][2]+this.AggTotal[o][4],this.oColumns[o].DataFormat,this.oColumns[o].ColumnType,this.oRow.Cells[o])}).then(e=>{this.LoadReportComplete()})}else if(157==this.ViewModel.StaticReportType){this.PDCInclude="1"==this.ViewModel.Preferences.IncludePDCs,this.ExcludeClBalance=!(!this.ViewModel.Preferences.ContainsKey("ExcludeClBalance")||"1"!=this.ViewModel.Preferences.ExcludeClBalance),this.ShowMonthWise="1"==this.ViewModel.Preferences.MonthWiseData,this.ShowMonthWise=!1,this.LevelNo=0;let e=!1;if(this.ViewModel.Preferences.ContainsKey("ShowLevel")){let t=new i.f;t.LoadXml("<XML>"+this.ViewModel.Preferences.ShowLevel+"</XML>");let s=i.f.SelectSingleNode(t.DocumentElement,"IsChecked");null!=s&&"1"==s.innerHTML&&(e=!0,s=i.f.SelectSingleNode(t.DocumentElement,"Text"),this.LevelNo=i.e.Int(s.innerHTML))}this.ViewModel.HideCostCenterTree||(this.ViewModel.oReportDialog.IsOneSelected||this.ViewModel.oReportDialog.IsZeroSelected)&&(t="");let s=[];s.push(!1),s.push(this.GTPQuery),s.push(this.GTPWhere),s.push(this.ViewModel.oReportDialog.FromDate.Date),s.push(this.ViewModel.oReportDialog.ToDate.Date),s.push(this.UnPostedDocsList),s.push(!1),s.push(this.PDCInclude),s.push(this.IncludeTerminatedPDC),s.push(this.LocationWhere+this.GetDimensionFilter("DCC.dcCCNID")),s.push(e),s.push(this.ShowMonthWise),s.push(o.a.SessionManager.LanguageID),o.a.report.GetReceiptsPayments(s,this.ViewModel.IsReportDB).then(t=>{this.ds=t;let s,l=0,a=[],r=this.ViewModel.ColumnSource[1],h=new Array;for(let e=0;e<this.ViewModel.ColumnSource.length;e++)h.push(this.ViewModel.ColumnSource[e]);if(this.ShowMonthWise){let e=new Date(this.ViewModel.FromDatePicker.Date.getFullYear(),this.ViewModel.FromDatePicker.Date.getMonth(),1);for(;e<=this.ViewModel.ToDatePicker.Date;){a.push("R"+e.getMonth()+"_"+e.getFullYear()),l++;let t=r.Clone();t.HeaderText=e.ToString("MMM yyyy"),t.ID="R"+e.getFullYear()+"_"+e.getMonth(),this.ds.Columns[0].push(t.ID),this.ds.Columns[1].push(t.ID),this.ds.Columns[2].push(t.ID),h.InsertAt(t,l),t=r.Clone(),t.HeaderText=e.ToString("MMM yyyy"),t.ID="P"+e.getFullYear()+"_"+e.getMonth(),this.ds.Columns[0].push(t.ID),this.ds.Columns[1].push(t.ID),this.ds.Columns[2].push(t.ID),h.InsertAt(t,h.length-1),e=e.AddMonths(1)}}if(this.ViewModel.ReportColumns=h,this.oColumns=this.ViewModel.ReportColumns,this.AggTotal=i.e.NumArray(this.oColumns.length,4),this.ds.Columns[0].push("Rec_Amount"),this.ds.Columns[0].push("Pay_Amount"),this.oRow=this.NewReportRow_2(n.f.BalanceBF,this.GrossTotalAppearance),this.oRow.Cells[0].ColSpan=this.oColumns.length,this.oRow.Cells[0].Text=o.a.GetResource("Reports_OpeningBalance"),this.ViewModel.addRow(this.oRow),this.ShowMonthWise){let e,t,s=this.ds.Tables[0],o=null;for(let i=this.ds.Tables[2].length-1;i>=0;i--){if(e=this.ds.Tables[2][i],t=e.YM.toString(),this.dbl=parseFloat(e.Amount),o!=e.AccountID.toString()){if(o=e.AccountID.toString(),s=this.ds.Tables[0].filter(e=>e.AccountID==o),0==s.length){let t={};t.AccountID=e.AccountID,t.Rec_Name=e.Rec_Name.toString(),t.Amount=0,s.push(t)}}else this.ds.Tables[2].RemoveAt(i),e=this.ds.Tables[2][i+1];this.dbl>0?(e["R"+t]=this.dbl,e.Rec_Amount=this.dbl):(e["P"+t]=-this.dbl,e.Pay_Amount=-this.dbl)}o=null;for(let i=0;i<this.ds.Tables[0].length;i++)e=this.ds.Tables[0][i],t=e.YM.toString(),this.dbl=parseFloat(e.Amount),o!=e.AccountID.toString()?(e.AccountID.toString(),o=e.AccountID.toString()):(this.ds.Tables[2].RemoveAt(i),e=this.ds.Tables[2][i+1]),this.dbl>0?(e["R"+t]=this.dbl,e.Rec_Amount=this.dbl):(e["P"+t]=-this.dbl,e.Pay_Amount=-this.dbl)}else if(e){this.CallFrom=1,this.GrdRow=this.ViewModel.Data.length-1;let e=this.ds.Tables[0];e.Columns=this.ds.Columns,e.Columns.Rec_Name.ColumnName="Account",e.Merge(this.ds.Tables[3]),this.dv=e.AsDataView(),this.dv.SortBy(["lft"]),this.IsFirstCall=!0,this.FirstTypeEndIndex=0,this.CellStartPos=0,this.GrdRow=this.ViewModel.Data.length-1,this.dv.forEach(e=>{this.AddRow_RP(e)}),this.UpdateTreeTotals_RP(0)}else this.ds.Tables[0].forEach(e=>{this.dbl=parseInt(e.Amount),Math.abs(this.dbl)>=.001&&(this.oRow=new n.d(this.oColumns.length,this.ViewModel.RowHeight),this.oRow.Type=n.f.Detail,this.oRow.DataRow=e,this.oRow.NodeID=parseInt(e.AccountID),this.ViewModel.SetCellValue(e.Rec_Name,this.oColumns[0].DataFormat,this.oColumns[0].ColumnType,this.oRow.Cells[0]),this.dbl>0?s=l+1:(this.dbl=-this.dbl,s=l+3),this.AggTotal[s][1]+=this.dbl,this.ViewModel.SetCellValue(this.dbl,this.oColumns[s].DataFormat,this.oColumns[s].ColumnType,this.oRow.Cells[s]),this.ViewModel.addRow(this.oRow))});if(this.oRow=this.NewReportRow_2(n.f.BalanceBF,this.GrossTotalAppearance),this.oRow.Cells[0].ColSpan=this.oColumns.length,this.ViewModel.addRow(this.oRow),e){this.CallFrom=2,this.dv=this.ds.Tables[1],this.dvTable=this.ds.Tables[1],this.dv=this.dvTable.filter(e=>e.Amount>0||1==e.IsGroup),this.IsFirstCall=!0,this.FirstTypeEndIndex=0,this.CellStartPos=0;let e=this.ViewModel.Data.length;this.GrdRow=this.ViewModel.Data.length-1,this.dv.forEach(e=>{this.AddRow_RP(e)}),this.UpdateTreeTotals_RP(0),this.dv=this.dvTable.filter(e=>e.Amount<0||1==e.IsGroup),this.IsFirstCall=!1,this.FirstTypeEndIndex=this.ViewModel.Data.length,this.CellStartPos=2,this.GrdRow=e-1,this.dv.forEach(e=>{this.AddRow_RP(e)}),this.GrdRow+1<this.ViewModel.Data.length&&(this.ViewModel.Data[this.GrdRow+1].Cells[this.CellStartPos].Text="",this.ViewModel.Data[this.GrdRow+1].Cells[this.CellStartPos+1].Text=""),this.UpdateTreeTotals_RP(0)}else{let e=new Array;this.dv=this.ds.Tables[1],this.dvTable=this.ds.Tables[1],this.dv=this.dvTable.filter(e=>e.Amount>0),this.dv.forEach(t=>{this.oRow=new n.d(this.oColumns.length,this.ViewModel.RowHeight),this.oRow.Type=n.f.Detail,this.oRow.DataRow=t,this.oRow.NodeID=parseInt(t.AccountID),this.dbl=parseFloat(t.Amount),this.ViewModel.SetCellValue(t.Account,this.oColumns[0].DataFormat,this.oColumns[0].ColumnType,this.oRow.Cells[0]),this.ViewModel.SetCellValue(this.dbl,this.oColumns[1].DataFormat,this.oColumns[1].ColumnType,this.oRow.Cells[1]),this.AggTotal[1][2]+=this.dbl,e.push(this.oRow)}),this.dv=this.dvTable.filter(e=>e.Amount<0),this.GrdRow=0,this.dv.forEach(t=>{this.GrdRow>=e.length?(this.oRow=new n.d(this.oColumns.length,this.ViewModel.RowHeight),this.oRow.Type=n.f.Detail,this.oRow.DataRow=t,this.oRow.NodeID=parseInt(t.AccountID),e.push(this.oRow)):this.oRow=e[this.GrdRow],this.dbl=parseFloat(t.Amount),this.dbl=-this.dbl,this.ViewModel.SetCellValue(t.Account,this.oColumns[2].DataFormat,this.oColumns[2].ColumnType,this.oRow.Cells[2]),this.ViewModel.SetCellValue(this.dbl,this.oColumns[3].DataFormat,this.oColumns[1].ColumnType,this.oRow.Cells[3]),this.dbl=this.ViewModel.RoundOff(this.dbl,this.oColumns[3].DataFormat),this.AggTotal[3][2]+=this.dbl,this.GrdRow++}),e.forEach(e=>{this.ViewModel.addRow(e)})}if(this.oRow=this.NewReportRow_2(n.f.BalanceBF,this.GrossTotalAppearance),this.oRow.Cells[0].Text="Receipts & Payments Total",this.oRow.Cells[1].CellAppearance=this.GrossTotalAppearance_Data,this.oRow.Cells[3].CellAppearance=this.GrossTotalAppearance_Data,this.ViewModel.SetCellValue(this.AggTotal[1][2],this.oColumns[1].DataFormat,this.oColumns[1].ColumnType,this.oRow.Cells[1]),this.ViewModel.SetCellValue(this.AggTotal[3][2],this.oColumns[3].DataFormat,this.oColumns[1].ColumnType,this.oRow.Cells[3]),this.ViewModel.addRow(this.oRow),!this.ExcludeClBalance){let t,s;this.oRow=this.NewReportRow_2(n.f.BalanceBF,this.GrossTotalAppearance),this.oRow.Cells[0].ColSpan=this.oColumns.length,this.oRow.Cells[0].Text=o.a.GetResource("Reports_ClosingBalance"),this.ViewModel.addRow(this.oRow),this.ds.Tables[0].length>this.ds.Tables[2].length?(t=this.ds.Tables[0],s=this.ds.Tables[2]):(t=this.ds.Tables[2],s=this.ds.Tables[0]),this.dv=t,this.dvTable=t,s.forEach(t=>{if(this.dv=this.dvTable.filter(e=>e.AccountID==t.AccountID),this.dv.length>0)this.dv[0].Amount=parseFloat(this.dv[0].Amount)+parseFloat(t.Amount);else{let s={};s.AccountID=t.AccountID,s.Rec_Name=t.Rec_Name.toString(),s.Amount=parseFloat(t.Amount),e&&(s.Depth=t.Depth,s.lft=t.lft,s.IsGroup=t.IsGroup),this.dvTable.push(s)}}),t.forEach(e=>{this.dbl=parseFloat(e.Amount),Math.abs(this.dbl)>=.001&&(this.oRow=new n.d(this.oColumns.length,this.ViewModel.RowHeight),this.oRow.Type=n.f.Detail,this.oRow.DataRow=e,this.oRow.NodeID=parseInt(e.AccountID),this.ViewModel.SetCellValue(e.Rec_Name,this.oColumns[0].DataFormat,this.oColumns[0].ColumnType,this.oRow.Cells[0]),this.dbl>0?(this.ViewModel.SetCellValue(this.dbl,this.oColumns[1].DataFormat,this.oColumns[1].ColumnType,this.oRow.Cells[3]),this.AggTotal[3][3]+=this.dbl):(this.dbl=-this.dbl,this.ViewModel.SetCellValue(this.dbl,this.oColumns[3].DataFormat,this.oColumns[3].ColumnType,this.oRow.Cells[1]),this.AggTotal[1][3]+=this.dbl),this.ViewModel.addRow(this.oRow))}),e?(this.CallFrom=3,this.GrdRow=this.ViewModel.Data.length-1,t.Columns.Rec_Name.ColumnName="Account",t.Merge(this.ds.Tables[3]),this.dv=t.AsDataView(),this.dv.SortBy(["lft"]),this.IsFirstCall=!0,this.FirstTypeEndIndex=0,this.CellStartPos=0,this.GrdRow=this.ViewModel.Data.length-1,this.dv.forEach(e=>{this.AddRow_RP(e)}),this.UpdateTreeTotals_RP(0)):t.forEach(e=>{this.dbl=parseFloat(e.Amount),Math.abs(this.dbl)>=.001&&(this.oRow=new n.d(this.oColumns.length,this.ViewModel.RowHeight),this.oRow.Type=n.f.Detail,this.oRow.DataRow=e,this.oRow.NodeID=parseInt(e.AccountID),this.ViewModel.SetCellValue(e.Rec_Name,this.oColumns[0].DataFormat,this.oColumns[0].ColumnType,this.oRow.Cells[0]),this.dbl>0?(this.ViewModel.SetCellValue(this.dbl,this.oColumns[1].DataFormat,this.oColumns[1].ColumnType,this.oRow.Cells[3]),this.AggTotal[3][3]+=this.dbl):(this.dbl=-this.dbl,this.ViewModel.SetCellValue(this.dbl,this.oColumns[3].DataFormat,this.oColumns[3].ColumnType,this.oRow.Cells[1]),this.AggTotal[1][3]+=this.dbl),this.ViewModel.addRow(this.oRow))})}this.AggTotal[1][0]=this.AggTotal[1][1]+this.AggTotal[1][2]+this.AggTotal[1][3],this.AggTotal[3][0]=this.AggTotal[3][1]+this.AggTotal[3][2]+this.AggTotal[3][3]}).then(e=>{this.LoadReportComplete()})}else if(169==this.ViewModel.StaticReportType)o.a.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,e).then(e=>{this.dsAccount=e,this.sbChunks="";for(let o=this.i;o<this.dsAccount.Tables[0].length;o++)this.sbChunks.length>0&&(this.sbChunks+=","),this.sbChunks+=this.dsAccount.Tables[0][o][this.dsAccount.Columns[0][0]].toString();if(this.ViewModel.Preferences.ContainsKey("ShowNarration")&&"1"==this.ViewModel.Preferences.ShowNarration){this.ViewModel.SelectTag=",D.CommonNarration AS CommonNarration",this.ViewModel.SelectTagAliasOnly=",CommonNarration";var t=this.ViewModel.ColumnSource.find(e=>"Particular"==e.ID);this.colParticularIndex=null!=t?this.ViewModel.ColumnSource.indexOf(t):this.ViewModel.ColumnSource.length-2}this.ShowGL_INVDetailReport=!1,this.ShowGL_ACCDetailReport=1;let s=[];s.push(this.sbChunks.toString()),s.push(""),s.push(null),s.push(0),s.push(this.GLClubTranBy),s.push(this.ViewModel.oReportDialog.FromDate.Date),s.push(this.ViewModel.oReportDialog.ToDate.Date),s.push(this.UnPostedDocsList),s.push(this.PDCInclude),s.push(this.IncludeUnApprovedPDC),s.push(this.IncludeTerminatedPDC),s.push(!1),s.push(!1),s.push(""),s.push(""),s.push(0),s.push(this.ViewModel.StaticReportType),s.push(""),s.push(""),s.push(this.RoundOff),s.push(0),s.push(""),s.push(0),s.push(this.LocationWhere+this.GetDimensionFilter("DCC.dcCCNID")),s.push(this.ShowGL_INVDetailReport),s.push(this.ShowGL_ACCDetailReport),s.push(this.CurrencyType),s.push(this.ForeignCurrencyID),s.push(this.GLJVDetails),s.push(""),s.push(this.ViewModel.SelectTag+this.ViewModel.GroupSelectTag),s.push(this.ViewModel.FromTag+this.ViewModel.GroupFromTag);let i=this.ViewModel.SelectTagAliasOnly+this.ViewModel.GroupSelectTagAlias;if(i.length>0&&!this.ShowGL_INVDetailReport&&0==this.ShowGL_ACCDetailReport){let e=i.Trim(",").split(",");i="";for(let t=0;t<e.length;t++)i+=",MAX("+e[t]+") "+e[t]}s.push(i),s.push(o.a.SessionManager.LanguageID),this.ViewModel.DisplayMessage="",s[0]=this.sbChunks.toString(),o.a.report.GetGeneralLedger(s,this.ViewModel.IsReportDB).then(e=>{this.ds=e;let t=new Array;for(let i=0;i<this.ViewModel.ColumnSource.length-1;i++)t.push(this.ViewModel.ColumnSource[i].Clone());for(let i=0;i<this.ViewModel.ColumnSource.length-1;i++)t.push(this.ViewModel.ColumnSource[i].Clone());let s,o=this.ViewModel.ColumnSource[this.ViewModel.ColumnSource.length-1];for(let i=0;i<this.dsAccount.Tables[0].length;i++)s=o.Clone(),s.HeaderText=this.dsAccount.Tables[0][i].AccountName.toString(),s.ID="R_"+this.dsAccount.Tables[0][i].AccountID.toString(),t.InsertAt(s,this.ViewModel.ColumnSource.length+i-1),this.colIndex.push(parseInt(this.dsAccount.Tables[0][i].AccountID),this.ViewModel.ColumnSource.length+i-1),s=o.Clone(),s.HeaderText=this.dsAccount.Tables[0][i].AccountName.toString(),s.ID="P_"+this.dsAccount.Tables[0][i].AccountID.toString(),t.push(s);this.ViewModel.ReportColumns=t,this.oColumns=this.ViewModel.ReportColumns,this.ColumnnarCashBank()}).then(e=>{this.LoadReportComplete()})});else if(200==this.ViewModel.StaticReportType){let e="",t=this.ViewModel.SelectTagAliasOnly+this.ViewModel.GroupSelectTagAlias;if(t.length>0){let s=t.Trim(",").split(",");e="";for(let t=0;t<s.length;t++){var h=this.ViewModel.BaseReportColumns.find(e=>e.ID==s[t]);e+=null==h||400!=h.CDGDO.CategoryValue||"Amount"!=h.CDGDO.Column&&"AmountFC"!=h.CDGDO.Column?",MAX("+s[t]+") "+s[t]:",SUM("+s[t]+") "+s[t]}}let s="",i="",l=this.GetDimensionFilter("DCC.dcCCNID");(this.LocationWhere.length>0||l.length>0||this.ViewModel.FromTag.Contains("DCC."))&&(s=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.AccDocDetailsID=D.AccDocDetailsID "+this.LocationWhere+l,i=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID "+this.LocationWhere+l);let a="",n="Amount",r="",u="";0==this.UnPostedDocsList.length?u=" AND (D.StatusID=369 or D.StatusID=429)":u+=" AND D.StatusID IN (369,429,"+this.UnPostedDocsList+")",a+="DECLARE @From FLOAT,@To FLOAT\nSET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))\n",a+="\nSELECT isnull(SUM(TR_Dr)-SUM(TR_Cr),0) this.Balance\nFROM (",a+="\n--Opening Dr\nSELECT VoucherNo,DebitAccount AccountID,D."+n+" TR_Dr,0 TR_Cr\nFROM ACC_DocDetails D WITH(NOLOCK)"+s+"\ninner join ACC_Accounts A with(nolock) on A.AccountID=D.DebitAccount\nWHERE A.AccountID>1 and (A.AccountTypeID=1 or A.AccountTypeID=10) and (DocDate<@From or DocumentType=16)"+u+r+"\nUNION ALL--Opening Cr\nSELECT VoucherNo,CreditAccount AccountID,0 TR_Dr,D."+n+" TR_Cr\nFROM ACC_DocDetails D WITH(NOLOCK)"+s+"\ninner join ACC_Accounts A with(nolock) on A.AccountID=D.CreditAccount\nWHERE A.AccountID>1 and (A.AccountTypeID=1 or A.AccountTypeID=10) and (DocDate<@From or DocumentType=16)"+u+r,i.length>0&&(a+="\n--INEVENTORY DATA\nUNION ALL--Opening Dr\nSELECT VoucherNo,DebitAccount AccountID,D."+n+" TR_Dr,0 TR_Cr\nFROM ACC_DocDetails D WITH(NOLOCK)"+i+"\ninner join ACC_Accounts A with(nolock) on A.AccountID=D.DebitAccount\nWHERE A.AccountID>1 and (A.AccountTypeID=1 or A.AccountTypeID=10) and DocDate<@From"+u+r+"\nUNION ALL--Opening Cr\nSELECT VoucherNo,CreditAccount AccountID,0 TR_Dr,D."+n+" TR_Cr\nFROM ACC_DocDetails D WITH(NOLOCK)"+i+"\ninner join ACC_Accounts A with(nolock) on A.AccountID=D.CreditAccount\nWHERE A.AccountID>1 and (A.AccountTypeID=1 or A.AccountTypeID=10) and DocDate<@From"+u+r),a+=") AS T\n",a+="\nSELECT convert(datetime,DocDate) DocDate,VoucherNo,AccountID,AccountName,this.Balance, case when this.Balance<=0 then -this.Balance else null end Debit, case when this.Balance>0 then this.Balance else null end Credit\n,VoucherNoAbr,VoucherNoprf,VoucherNodno\n"+t+"\nfrom(\nSELECT DocDate,VoucherNo,max(VoucherNoAbr) VoucherNoAbr,max(VoucherNoprf) VoucherNoprf,max(VoucherNodno) VoucherNodno,T.AccountID,T.AccountName,SUM(TR_Dr)-SUM(TR_Cr) this.Balance"+e+"\nFROM (";let D=this.GetFilterByDimension_1(300);D.length>0&&(r+=" AND D.CostCenterID IN ("+D+")"),a+="\n--Tr Dr\nSELECT DocDate,VoucherNo,D.DocAbbr VoucherNoAbr,D.DocPrefix VoucherNoprf,CONVERT(BIGINT,D.DocNumber) VoucherNodno,DebitAccount AccountID,A1.AccountName,D."+n+" TR_Dr,0 TR_Cr"+this.ViewModel.SelectTag+this.ViewModel.GroupSelectTag+"\nFROM ACC_DocDetails D WITH(NOLOCK)"+s+"\ninner join ACC_Accounts A1 with(nolock) on A1.AccountID=D.DebitAccount"+this.ViewModel.FromTag+this.ViewModel.GroupFromTag+"\nWHERE DocDate BETWEEN @From AND @To and A1.AccountID>1 and A1.AccountTypeID!=1 and A1.AccountTypeID!=10"+u+r+"\nUNION ALL--Tr Cr\nSELECT DocDate,VoucherNo,D.DocAbbr VoucherNoAbr,D.DocPrefix VoucherNoprf,CONVERT(BIGINT,D.DocNumber) VoucherNodno,CreditAccount AccountID,A1.AccountName,0 TR_Dr,D."+n+" TR_Cr"+this.ViewModel.SelectTag+this.ViewModel.GroupSelectTag+"\nFROM ACC_DocDetails D WITH(NOLOCK)"+s+"\ninner join ACC_Accounts A1 with(nolock) on A1.AccountID=D.CreditAccount"+this.ViewModel.FromTag+this.ViewModel.GroupFromTag+"\nWHERE DocDate BETWEEN @From AND @To and A1.AccountID>1 and A1.AccountTypeID!=1 and A1.AccountTypeID!=10"+u+r,i.length>0&&(a+="\n--INEVENTORY DATA\nUNION ALL--Tr Dr\nSELECT AD.DocDate,AD.VoucherNo,D.DocAbbr VoucherNoAbr,D.DocPrefix VoucherNoprf,CONVERT(BIGINT,D.DocNumber) VoucherNodno,AD.DebitAccount AccountID,A1.AccountName,AD."+n+" TR_Dr,0 TR_Cr"+this.ViewModel.SelectTag+this.ViewModel.GroupSelectTag+"\nFROM ACC_DocDetails AD with(nolock)\nINNER JOIN INV_DocDetails D with(nolock) ON D.InvDocDetailsID=AD.InvDocDetailsID"+i+"\ninner join ACC_Accounts A1 with(nolock) on A1.AccountID=AD.DebitAccount"+this.ViewModel.FromTag+this.ViewModel.GroupFromTag+"\nWHERE AD.DocDate BETWEEN @From AND @To and A1.AccountID>1 and A1.AccountTypeID!=1 and A1.AccountTypeID!=10"+u+r+"\nUNION ALL--Tr Cr\nSELECT AD.DocDate,AD.VoucherNo,D.DocAbbr VoucherNoAbr,D.DocPrefix VoucherNoprf,CONVERT(BIGINT,D.DocNumber) VoucherNodno,AD.CreditAccount AccountID,A1.AccountName,0 TR_Dr,AD."+n+" TR_Cr"+this.ViewModel.SelectTag+this.ViewModel.GroupSelectTag+"\nFROM ACC_DocDetails AD with(nolock)\nINNER JOIN INV_DocDetails D with(nolock) ON D.InvDocDetailsID=AD.InvDocDetailsID"+i+"\ninner join ACC_Accounts A1 with(nolock) on A1.AccountID=AD.CreditAccount"+this.ViewModel.FromTag+this.ViewModel.GroupFromTag+"\nWHERE AD.DocDate BETWEEN @From AND @To and A1.AccountID>1 and A1.AccountTypeID!=1 and A1.AccountTypeID!=10"+u+r),a+=") AS T\nwhere 1=1\nGROUP BY DocDate,VoucherNo,AccountID,AccountName\n) AS T\n--order by DocDate,VoucherNo,AccountName,this.Balance desc",o.a.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,a).then(e=>{this.ds=e,this.ds.Tables[1].SortBy(["DocDate","VoucherNoAbr","VoucherNoprf","VoucherNodno",{name:"Credit",desc:!0},{name:"Debit",desc:!0}]),this.AddDayBook(),this.LoadReportComplete()})}}LoadReportComplete(){this.AddReportTotals(),this.ViewModel.FormulasCalculated=!0,this.ViewModel.process_RunWorkerCompleted()}GLStart(e){e=e.replace("^strRetainedAccounts^",this.strRetainedAccounts.length>0?" OR A1.AccountID IN ("+this.strRetainedAccounts+")":""),o.a.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,e).then(e=>{this.dsAccount=e,this.al=[],this.IncomeExpAccounts=["4","8","11","5","9","12"],this.ProductQuery="",this.ViewModel.ReportParams.ContainsKey("ProductSelect")&&this.ViewModel.ReportParams.ProductSelect.length>0&&(this.ProductQuery="Select D.VoucherNo"+this.ViewModel.ReportParams.ProductSelect+" from INV_DocDetails D with(nolock) LEFT JOIN INV_Product P with(nolock) ON P.ProductID=D.ProductID"+this.ViewModel.ReportParams.ProductFrom,this.ViewModel.SelectTag+=",convert(int,DT.IsInventory) IsInvDoc",this.ViewModel.FromTag+=" left join ADM_DocumentTypes DT with(nolock) on DT.CostCenterID=D.CostCenterID",this.ViewModel.SelectTagAliasOnly+=",IsInvDoc"),this.al.push(""),this.al.push(""),this.al.push(this.dtOpenCompanyYearStart?this.dtOpenCompanyYearStart:null),this.al.push(0),1==this.ViewModel.lstGroup.length&&this.al.push(this.GLClubTranBy),this.al.push(this.ViewModel.oReportDialog.FromDate.Date),this.al.push(this.ViewModel.oReportDialog.ToDate.Date),this.al.push(this.UnPostedDocsList),this.al.push(this.PDCInclude),this.al.push(this.IncludeUnApprovedPDC),this.al.push(this.IncludeTerminatedPDC),this.al.push(this.PDCSeperate),this.al.push(this.PDCDrCrSeperate),this.al.push(this.ViewModel.Preferences.FilterOn),this.al.push(this.ViewModel.Preferences.SortOn),2==this.ViewModel.lstGroup.length?(this.al.push(this.TagID),this.al.push(c.GetTagTableName(this.TagID))):(this.al.push(this.TagID),this.al.push(this.ViewModel.StaticReportType),this.ViewModel.DocumentFilters.ContainsKey("CONTRACTNODEID")?(this.IsSalesContractLedger=!0,this.al.push(" AND ((D.RefCCID="+this.ViewModel.DocumentFilters.CONTRACTRefCCID+"  AND D.RefNodeid='"+this.ViewModel.DocumentFilters.CONTRACTNODEID+"') \nor (D.RefCCID=400 and D.RefNodeid IN (select AccDocDetailsID from Acc_DocDetails DS where D.RefCCID= "+this.ViewModel.DocumentFilters.CONTRACTRefCCID+" AND DS.RefNodeid='"+this.ViewModel.DocumentFilters.CONTRACTNODEID+"')))")):this.al.push(""),this.al.push(""),this.al.push(this.RoundOff),this.al.push(this.ViewModel.Preferences.ContainsKey("IncludeIntPDCsInBank")),this.al.push(this.ViewModel.Preferences.ContainsKey("NonAccDocs")?this.ViewModel.Preferences.NonAccDocs:""),this.al.push(this.ViewModel.Preferences.ContainsKey("IncludePDCsInOPB"))),this.al.push(this.LocationWhere+this.GetDimensionFilter("DCC.dcCCNID")),this.al.push(this.ShowGL_INVDetailReport),this.al.push(this.ShowGL_ACCDetailReport),this.al.push(this.CurrencyType),this.al.push(this.ForeignCurrencyID),this.al.push(this.GLJVDetails),this.al.push(i.e.IsEmpty(this.GLSortTransactionsBy)?"":",D."+this.GLSortTransactionsBy+"  SortDate"),this.al.push(this.ViewModel.SelectTag+this.ViewModel.GroupSelectTag),this.al.push(this.ViewModel.FromTag+this.ViewModel.GroupFromTag);let t=this.ViewModel.SelectTagAliasOnly+this.ViewModel.GroupSelectTagAlias;if(t.length>0&&!this.ShowGL_INVDetailReport&&0==this.ShowGL_ACCDetailReport){let e=t.Trim(",").split(",");t="";for(let o=0;o<e.length;o++){var s=this.ViewModel.BaseReportColumns.find(t=>t.ID==e[o]);t+=null==s||400!=s.CDGDO.CategoryValue||"Amount"!=s.CDGDO.Column&&"AmountFC"!=s.CDGDO.Column?",MAX("+e[o]+") "+e[o]:",SUM("+e[o]+") "+e[o]}}if(this.al.push(t),this.al.push(o.a.SessionManager.LanguageID),this.CADimension){let e;this.aldim=[],this.aldim.push("6,7"),this.aldim.push(this.ViewModel.oReportDialog.FromDate.Date),this.aldim.push(this.ViewModel.oReportDialog.ToDate.Date),this.aldim.push(this.UnPostedDocsList),this.aldim.push(this.PDCInclude),this.aldim.push(this.IncludeUnApprovedPDC),this.aldim.push(this.IncludeTerminatedPDC),this.aldim.push(this.PDCSeperate),this.aldim.push(this.PDCDrCrSeperate),this.aldim.push(this.ViewModel.Preferences.FilterOn),this.aldim.push(this.ViewModel.Preferences.SortOn),this.aldim.push(this.CADimension),this.aldim.push(c.GetTagTableName(this.CADimension)),this.aldimWHERE=this.LocationWhere+this.GetDimensionFilter("DCC.dcCCNID"),e=this.GetFilterByDimension_1(300),e.length>0&&(this.aldimWHERE+=" AND D.CostCenterID IN ("+e+")"),this.aldimWHERE+="  AND DCC.dcCCNID"+(this.CADimension-5e4)+"=",e=this.GetFilterByDimension_1(2),this.aldim.push("aldim"),this.aldim.push(this.ShowGL_INVDetailReport),this.aldim.push(this.ShowGL_ACCDetailReport),this.aldim.push(this.CurrencyType),this.aldim.push(this.ForeignCurrencyID),this.aldim.push(this.ViewModel.SelectTag.Replace("A1.","A.")+this.ViewModel.GroupSelectTag.Replace("A1.","A.")),this.ViewModel.DocumentFilters.ContainsKey("CONTRACTNODEID")?(this.IsSalesContractLedger=!0,this.aldim.push("AND D.RefCCID="+this.ViewModel.DocumentFilters.CONTRACTRefCCID+" AND D.RefNodeid='"+this.ViewModel.DocumentFilters.CONTRACTNODEID+"' "+this.ViewModel.FromTag+this.ViewModel.GroupFromTag)):this.aldim.push(this.ViewModel.FromTag.Replace("A1.","A.")+this.ViewModel.GroupFromTag.Replace("A1.","A.")),this.aldim.push(t),this.aldim.push(1),this.aldim.push(o.a.SessionManager.LanguageID)}this.ViewModel.DisplayMessage="",this.GLClubTranBy=0,this.iLoop=0,this.GLCallBack()})}GLCallBack(){let e,t,s="",l=[];if(this.iLoop>=this.dsAccount.Tables[0].length)this.GLCallBack_Complete();else if(this.ViewModel.process.CancellationPending)this.ViewModel.processArgs.Cancel=!0;else{if(this.sbChunks="",this.IsCurrentControlAccount=!1,this.TempChunkSize=0,null==this.dtOpenCompanyYearStart)for(let e=this.iLoop;e<this.dsAccount.Tables[0].length&&e-this.iLoop<this.ChunkSize;e++){if(1==this.ViewModel.lstGroup.length){if(this.sbChunks.length>0&&this.GLClubTranBy!=parseInt(this.dsAccount.Tables[0][e].GLClubTranBy))break;this.GLClubTranBy=parseInt(this.dsAccount.Tables[0][e].GLClubTranBy)}if(this.IsControlAccounts){if(0==this.CADimension&&1==parseInt(this.dsAccount.Tables[0][e].IsControl)){if(this.sbChunks.length>0)break;this.IsCurrentControlAccount=!0,this.sbChunks+=this.dsAccount.Tables[0][e][this.dsAccount.Columns[0][0]].toString(),this.TempChunkSize++;break}if(0!=this.CADimension&&1!=parseInt(this.dsAccount.Tables[0][e].CAD)){if(this.sbChunks.length>0)break;this.IsCurrentControlAccount=!0,this.sbChunks+=this.dsAccount.Tables[0][e][this.dsAccount.Columns[0][0]].toString(),this.TempChunkSize++;break}}this.sbChunks.length>0&&(this.sbChunks+=","),this.sbChunks+=this.dsAccount.Tables[0][e][this.dsAccount.Columns[0][0]].toString(),this.TempChunkSize++}else{s="";for(let e=this.iLoop;e<this.dsAccount.Tables[0].length&&e-this.iLoop<this.ChunkSize;e++){if(1==this.ViewModel.lstGroup.length){if(this.sbChunks.length>0&&this.GLClubTranBy!=parseInt(this.dsAccount.Tables[0][e].GLClubTranBy))break;this.GLClubTranBy=parseInt(this.dsAccount.Tables[0][e].GLClubTranBy)}if(this.IsControlAccounts){if(0==this.CADimension&&1==parseInt(this.dsAccount.Tables[0][e].IsControl)){if(this.sbChunks.length>0||s.length>0)break;this.IsCurrentControlAccount=!0,this.sbChunks+=this.dsAccount.Tables[0][e][this.dsAccount.Columns[0][0]].toString(),this.TempChunkSize++;break}if(0!=this.CADimension&&1!=parseInt(this.dsAccount.Tables[0][e].CAD)){if(this.sbChunks.length>0||s.length>0)break;this.IsCurrentControlAccount=!0,this.sbChunks+=this.dsAccount.Tables[0][e][this.dsAccount.Columns[0][0]].toString(),this.TempChunkSize++;break}}this.strAccountType=i.e.StringValue(this.dsAccount.Tables[0][e].AccountTypeID),this.IncomeExpAccounts.Contains(this.strAccountType)?(s.length>0&&(s+=","),s+=this.dsAccount.Tables[0][e][this.dsAccount.Columns[0][0]].toString()):(this.sbChunks.length>0&&(this.sbChunks+=","),this.sbChunks+=this.dsAccount.Tables[0][e][this.dsAccount.Columns[0][0]].toString()),this.TempChunkSize++}}if(this.al[0]=this.sbChunks.toString(),this.al[1]=s.toString(),this.al[3]=this.IsCurrentControlAccount,1==this.ViewModel.lstGroup.length&&(this.al[4]=this.GLClubTranBy),1==this.ViewModel.lstGroup.length){let s;this.IsCurrentControlAccount?(this.aldim[13]=this.aldimWHERE+this.dsAccount.Tables[0][this.iLoop].CAD.toString(),s=o.a.report.GetGLOnlyDimension(this.aldim,this.ViewModel.IsReportDB)):s=o.a.report.GetGeneralLedger(this.al,this.ViewModel.IsReportDB),s.then(s=>{if(this.ds=s,this.IsCurrentControlAccount&&(this.ds.Tables[0].forEach(e=>{e.AccountID=e.TAG,e.AccountName=e.Name}),this.ds.Tables[1].forEach(e=>{e.ParticularID=e.AccountID,e.Particular=e.AccountName,e.AccountID=e.TAG,e.AccountName=e.Name}),this.ds.Tables.Count>2&&this.ds.Tables[2].forEach(e=>{e.ParticularID=e.AccountID,e.Particular=e.AccountName,e.AccountID=e.TAG,e.AccountName=e.Name}),this.ds.Tables.forEach(e=>{e.forEach(e=>{e.AccountID=this.dsAccount.Tables[0][this.iLoop].AccountID})})),this.SetParticularsData(this.ds),this.DataSetCollection.push(this.ds),this.ProductQuery.length>0&&(e="",l.Clear(),this.ds.Tables[1].filter(e=>1==e.IsInvDoc).forEach(s=>{t=s.VoucherNo.toString(),this.dicInvRows.ContainsKey(t)||l.Contains(t)||(e.length>0&&(e+=","),e+="'"+t+"'",l.push(t))}),e.length>0)){let t=o.a.report.GetDataTable("RPT022",this.ProductQuery+" WHERE D.VoucherNo in ("+e+")");l.forEach(e=>{this.dicInvRows.push(e,t.filter(t=>t.VoucherNo==e))})}if(this.ViewModel.FormulaColumns.length>0&&this.ViewModel.FormulaColumns.forEach(e=>{this.ds.Columns[1].Contains(e.ID)||this.ds.Columns[1].push(e.ID),this.ds.Tables.length>2&&!this.ds.Columns[2].Contains(e.ID)&&this.ds.Columns[2].push(e.ID)}),this.ShowTagWise||-1==this.CurrencyType)for(let e=0;e<this.ds.Tables.length;e++)this.TagCols.forEach(t=>{this.ds.Columns[e].push(t.ID)});for(this.dvAccount=this.ds.Tables[0],this.dvAccountTable=this.ds.Tables[0],this.dvAccountColumns=this.ds.Columns[0],this.jAccount=this.iLoop;this.jAccount<this.dsAccount.Tables[0].length&&this.jAccount-this.iLoop<this.TempChunkSize;this.jAccount++){if(this.strAccountID=this.dsAccount.Tables[0][this.jAccount].AccountID.toString(),this.dvAccount=this.dvAccountTable.filter(e=>e.AccountID==this.strAccountID),this.dv=this.ds.Tables[1],this.dvTable=this.ds.Tables[1],this.dvColumns=this.ds.Columns[1],this.strAccountFilterObj={},this.strAccountName=this.dsAccount.Tables[0][this.jAccount].AccountName.toString(),this.IsCurrentControlAccount?this.dv=this.dv:(this.strAccountFilterObj.AccountID=this.strAccountID,this.dv=this.dv.filter(e=>e.AccountID==this.strAccountID)),this.ds.Tables.length>2&&(this.dvTbl2=this.IsCurrentControlAccount?this.ds.Tables[2]:this.ds.Tables[2].filter(e=>e.AccountID==this.strAccountFilterObj.AccountID),this.dvTbl2Table=this.ds.Tables[2],this.dvTbl2Columns=this.ds.Columns[2]),this.strAccountType=this.dsAccount.Tables[0][this.jAccount].AccountTypeID.toString(),this.AllowAddRows=this.dv.length>0||this.ds.Tables.length>2&&this.dvTbl2.length>0,this.IsRetainedEarning=!1,this.OpenCompany&&this.GLRetainedAccounts.ContainsKey(this.strAccountID)&&(this.AllowAddRows=!0,this.IsRetainedEarning=!0),this.UnPostedDocsInclude&&this.UnPostedDocsSeparately&&(this.strAccountFilterObj.StatusID=[369,429],this.dv=this.dv.filter(e=>369==e.StatusID||429==e.StatusID)),this.ShowTagWise){let e,t=0,s=0,o=0;for(e=i.e.String(this.dvAccount[o].TagID),e.length>0&&(t=i.e.Double(this.dvAccount[o].BF),this.dvAccount[o]["TAG"+e]=t,s=t);o+1<this.dvAccount.length;)e=i.e.String(this.dvAccount[o+1].TagID),e.length>0&&(t=i.e.Double(this.dvAccount[o+1].BF),s+=t,this.dvAccount[o]["TAG"+e]=t),this.dvAccount.Remove(this.dvAccount[o+1]),this.dvAccountTable.Remove(this.dvAccount[o+1]);this.dvAccount[o].BF=s}else if(-1==this.CurrencyType){let e,t=0,s=0,o=0;for(e=this.dvAccount[o].CurrencyID.ToString(),e.Length>0&&(t=this.dvAccount[o].BF.ToString(),this.dvAccount[o]["CURRBL"+e]=t,s=t);o+1<this.dvAccount.length;)e=this.dvAccount[o+1].CurrencyID.ToString(),e.Length>0&&(t=this.dvAccount[o+1].BF.ToString(),s+=t,this.dvAccount[o]["CURRBL"+e]=t),this.dvAccount.Remove(this.dvAccount[o+1]);this.dvAccount[o].BF=s}this.OpenCompany&&null==this.dtOpenCompanyYearStart&&this.IncomeExpAccounts.Contains(this.strAccountType)&&(this.dvAccount[0].BF=0),this.OpBalance=parseFloat(this.dvAccount[0].BF),this.AllowAddRows||(this.AccountsWithOutTransactions||this.AccountsWithOnlyOPB&&0!=this.OpBalance)&&(this.AllowAddRows=!0),this.ExcludeOpBalance&&(this.OpBalance=0),0==this.OpBalance&&-1!=this.colLocalAmtInd&&this.dvAccountColumns.Contains("LocalAmount")&&(this.dvAccount[0].LocalAmount=0),this.AllowAddRows&&(this.AccountsWithZeroBalance||0!=this.GetBalance()||this.IsRetainedEarning)&&(this.IsNewAccount=!0,this.addGeneralLedger())}this.ViewModel.refreshDataView(),this.iLoop+=this.TempChunkSize,this.GLCallBack()},e=>{this.GLCallBack_Complete()})}else o.a.report.GetGLDimensionWise(this.al,this.ViewModel.IsReportDB).then(e=>{let t;for(this.ds=e,this.SetParticularsData(this.ds),this.DataSetCollection.push(this.ds),this.iDataSetCollection.push(this.TempChunkSize),this.ViewModel.FormulaColumns.length>0&&this.ViewModel.FormulaColumns.forEach(e=>{this.ds.Columns[1].Contains(e.ID)||this.ds.Columns[1].push(e.ID),this.ds.Tables.length>2&&!this.ds.Columns[2].Contains(e.ID)&&this.ds.Columns[2].push(e.ID)}),this.dvAccount=this.ds.Tables[0],this.dvAccountTable=this.ds.Tables[0],this.dvAccountColumns=this.ds.Columns[0],this.jAccount=this.iLoop;this.jAccount<this.dsAccount.Tables[0].length&&this.jAccount-this.iLoop<this.TempChunkSize;this.jAccount++){if(this.strAccountID=this.dsAccount.Tables[0][this.jAccount][this.dsAccount.Columns[0][0]].toString(),this.dv=this.ds.Tables[1],this.dvTable=this.ds.Tables[1],this.dvColumns=this.ds.Columns[1],this.strAccountFilter="AccountID="+this.strAccountID,this.strAccountFilterObj={AccountID:this.strAccountID},this.IsCurrentControlAccount&&(this.strAccountFilter="1=1"),this.dv=this.dvTable.filter(e=>e.AccountID==this.strAccountID),this.dvAccount=this.dvAccountTable.filter(e=>e.AccountID==this.strAccountID),this.ds.Tables.length>2&&(this.dvTbl2=this.ds.Tables[2].filter(e=>e.AccountID==this.strAccountID),this.dvTbl2Table=this.ds.Tables[2],this.dvTbl2Columns=this.ds.Columns[2]),0==this.dvAccount.length&&0==this.dv.length){if(2==this.ds.Tables.length)continue;if(this.ds.Tables.length>2&&0==this.dvTbl2.length)continue}for(let e=0;e<this.oColumns.length;e++)this.AggTotal[e][4]=0;this.dvAccount.sort((e,t)=>e.Name>t.Name?1:-1),t=this.dv.ToTable(!0,["TAG","Name"]),this.ds.Tables.length>2&&(this.dvTbl2=this.dvTbl2Table.filter(e=>e.AccountID==this.strAccountID),this.dvTbl2.length>0&&this.dvTbl2.ToTable(!0,["TAG","Name"]).forEach(e=>{0==t.filter(t=>t.TAG==e.TAG).length&&t.push([e.TAG.toString(),e.Name.toString()])})),t.forEach(e=>{if(0==this.dvAccount.filter(t=>t.Name==i.e.String(e.Name)).length){let t={};this.dvAccount.length>0?(t.AccountID=this.dvAccount[0].AccountID.toString(),t.AccountName=this.dvAccount[0].AccountName.toString(),t.AccountTypeID=this.dvAccount[0].AccountTypeID.toString()):(t.AccountName=this.dv.length>0?this.dv[0].AccountName.toString():this.dvTbl2[0].AccountName.toString(),t.AccountID=this.dsAccount.Tables[0][this.jAccount].AccountID.toString(),t.AccountTypeID=this.dsAccount.Tables[0][this.jAccount].AccountTypeID.toString()),t.TAG=i.e.StringValue(e.TAG),t.Name=i.e.StringValue(e.Name),t.BF=0,this.dvAccount.push(t),this.dvAccountTable.push(t)}}),this.IsNewAccount=!0,this.dvAccount.forEach(e=>{this.strTagID=e.TAG.toString(),this.strTagName=e.Name.toString(),this.strAccountType=this.dsAccount.Tables[0][this.jAccount].AccountTypeID.toString(),this.strAccountName=this.dsAccount.Tables[0][this.jAccount].AccountName.toString(),this.strAccountFilterObj={},this.IsCurrentControlAccount?this.strAccountFilterObj.TAG=this.strTagID:(this.strAccountFilterObj.TAG=this.strTagID,this.strAccountFilterObj.AccountID=this.strAccountID),this.dv=this.ds.Tables[1],this.dvTable=this.ds.Tables[1],this.dvColumns=this.ds.Columns[1],this.dv=this.dv.filter(e=>e.TAG==this.strTagID),this.IsCurrentControlAccount||(this.dv=this.dv.filter(e=>e.AccountID==this.strAccountID)),this.ds.Tables.length>2&&(this.dvTbl2=this.ds.Tables[2],this.dvTbl2Table=this.ds.Tables[2],this.dvTbl2Columns=this.ds.Columns[2],this.dv=this.dv.filter(e=>e.TAG==this.strTagID),this.IsCurrentControlAccount||(this.dvTbl2=this.dvTbl2.filter(e=>e.AccountID==this.strAccountID)),this.IsCurrentControlAccount||(this.dvTbl2=this.dvTbl2.filter(e=>e.AccountID==this.strAccountID))),this.OpenCompany&&null==this.dtOpenCompanyYearStart&&this.IncomeExpAccounts.Contains(this.strAccountType)&&(e.BF=0),this.OpBalance=parseFloat(e.BF),this.ExcludeOpBalance&&(this.OpBalance=0),this.AllowAddRows=!!(this.dv.length>0||this.AccountsWithOutTransactions||this.AccountsWithOnlyOPB&&0!=this.OpBalance||this.ds.Tables.length>2&&this.dvTbl2.length>0),this.UnPostedDocsInclude&&this.UnPostedDocsSeparately&&(this.strAccountFilterObj.StatusID=[369,429],this.dv=this.dv.filter(e=>369==e.StatusID||429==e.StatusID)),this.AllowAddRows&&(this.AccountsWithZeroBalance||0!=this.GetBalance())&&this.addGeneralLedger()}),this.ViewModel.lstGroup[0].SubTotalAppearance.IsVisible&&this.AddSubTotal(this.strAccountName,4)}this.ViewModel.refreshDataView(),this.iLoop+=this.TempChunkSize,this.GLCallBack()},e=>{this.GLCallBack_Complete()})}}GLCallBack_Complete(){if(1==this.ViewModel.lstGroup.length&&this.HideEmptyDimensions&&(this.ShowTagWise||-1==this.CurrencyType)){try{let e=!1,t=-1;if(this.ShowTagWise?this.TagCols.forEach(s=>{t=this.ViewModel.ReportColumns.IndexOf(s),-1!=t&&null==this.ViewModel.Data.find(e=>(e.Type==n.f.Detail||e.Type==n.f.BalanceBF)&&null!=e.Cells[t].Value&&0!=parseInt(e.Cells[t].Value))&&(s.HeaderAppearance.IsVisible=!1,e=!0)}):-1==this.CurrencyType&&this.TagCols.forEach(s=>{if(s.ID.startsWith("CURRBL")&&(t=this.ViewModel.ReportColumns.IndexOf(s),-1!=t&&null==this.ViewModel.Data.find(e=>(e.Type==n.f.Detail||e.Type==n.f.BalanceBF)&&null!=e.Cells[t].Value&&0!=parseInt(e.Cells[t].Value)))){s.HeaderAppearance.IsVisible=!1;var o=this.TagCols.find(e=>e.ID==s.ID.Replace("CURRBL","CURRDR"));null!=o&&(o.HeaderAppearance.IsVisible=!1),null!=(o=this.TagCols.find(e=>e.ID==s.ID.Replace("CURRBL","CURRCR")))&&(o.HeaderAppearance.IsVisible=!1),e=!0}}),e){let e=[];this.oColumns.forEach(t=>{e.push(t)}),this.ViewModel.ReportColumns=e}}catch(e){}this.ViewModel.RefreshPostFilters(!1)}else this.ViewModel.RefreshPostFilters();this.LoadReportComplete()}CBCallBack(){if(this.iLoop>=this.dsAccount.Tables[0].length)this.LoadReportComplete();else if(this.ViewModel.process.CancellationPending)this.ViewModel.processArgs.Cancel=!0;else{this.sbChunks="",this.TempChunkSize=0;for(let e=this.iLoop;e<this.dsAccount.Tables[0].length&&e-this.iLoop<this.ChunkSize&&!(this.sbChunks.length>0&&this.GLClubTranBy!=parseInt(this.dsAccount.Tables[0][e].GLClubTranBy));e++)this.GLClubTranBy=parseInt(this.dsAccount.Tables[0][e].GLClubTranBy),this.sbChunks.length>0&&(this.sbChunks+=","),this.sbChunks+=this.dsAccount.Tables[0][e][this.dsAccount.Columns[0][0]].toString(),this.TempChunkSize++;this.al[0]=this.sbChunks.toString(),this.al[4]=this.GLClubTranBy,o.a.report.GetGeneralLedger(this.al,this.ViewModel.IsReportDB).then(e=>{this.ds=e,this.SetParticularsData(this.ds),this.DataSetCollection.push(this.ds),this.dvAccount=this.ds.Tables[0],this.dvAccountTable=this.ds.Tables[0],this.dvAccountColumns=this.ds.Columns[0],this.dv=this.ds.Tables[1],this.dvTable=this.ds.Tables[1],this.dvColumns=this.ds.Columns[1];for(let t=this.iLoop;t<this.dsAccount.Tables[0].length&&t-this.iLoop<this.TempChunkSize;t++)this.strAccountID=this.dsAccount.Tables[0][t][this.dsAccount.Columns[0][0]].toString(),this.strAccountFilterObj={AccountID:this.strAccountID},this.dvAccount=this.dvAccountTable.filter(e=>e.AccountID==this.strAccountID),this.strAccountName=this.dsAccount.Tables[0][t].AccountName.toString(),this.strAccountType=this.dsAccount.Tables[0][t].AccountTypeID.toString(),this.dv=this.dvTable.filter(e=>e.AccountID==this.strAccountID),this.OpBalance=parseFloat(this.dvAccount[0].BF),(this.dv.length>0||0!=this.OpBalance)&&(i.e.IsEmpty(this.ViewModel.lstGroup[0].Formula)||(this.ViewModel.CalculateFormula_2(this.ViewModel.lstGroup[0],this.dsAccount.Tables[0][t]),this.strAccountName=i.e.String(this.dsAccount.Tables[0][t][this.ViewModel.lstGroup[0].ID])),this.addCashBookAndBankBook());this.ViewModel.refreshDataView(),this.iLoop+=this.TempChunkSize,this.CBCallBack()},e=>{this.LoadReportComplete()})}}GLSummaryCallBack(){{if(this.iLoop>=this.dsAccount.Tables[0].length)return void this.LoadReportComplete();if(this.ViewModel.process.CancellationPending)return void(this.ViewModel.processArgs.Cancel=!0);let e="";if(this.sbChunks="",null==this.dtOpenCompanyYearStart)for(let t=this.iLoop;t<this.dsAccount.Tables[0].length&&t-this.iLoop<this.ChunkSize;t++)this.sbChunks.length>0&&(this.sbChunks+=","),this.sbChunks+=this.dsAccount.Tables[0][t][this.dsAccount.Columns[0][0]].toString();else{e="";for(let t=this.iLoop;t<this.dsAccount.Tables[0].length&&t-this.iLoop<this.ChunkSize;t++)this.strAccountType=this.dsAccount.Tables[0][t].AccountTypeID.toString(),this.IncomeExpAccounts.Contains(this.strAccountType)?(e.length>0&&(e+=","),e+=this.dsAccount.Tables[0][t][this.dsAccount.Columns[0][0]].toString()):(this.sbChunks.length>0&&(this.sbChunks+=","),this.sbChunks+=this.dsAccount.Tables[0][t][this.dsAccount.Columns[0][0]].toString())}this.al[0]=this.sbChunks.toString(),this.al[1]=e.toString(),o.a.report.GetGeneralLedgerSummary(this.al,this.ViewModel.IsReportDB).then(e=>{if(this.ds=e,this.DataSetCollection.push(this.ds),-1!=this.colOpBalanceIndex&&this.ds.Columns[1].Contains("Balance")&&!this.AccountsWithZeroBalance){let e=1e-4;this.colBalanceIndex>=0&&(2==this.oColumns[this.colBalanceIndex].DataFormat.DecimalsPoints?e=.0099:3==this.oColumns[this.colBalanceIndex].DataFormat.DecimalsPoints&&(e=99e-5));for(let t=this.ds.Tables[1].length-1;t>=0;t--)(null==this.ds.Tables[1][t].Balance||Math.abs(parseFloat(this.ds.Tables[1][t].Balance))<e)&&this.ds.Tables[1].RemoveAt(t)}for(this.dvAccount=this.ds.Tables[0],this.dvAccountTable=this.ds.Tables[0],this.dvAccountColumns=this.ds.Columns[0],this.jAccount=this.iLoop;this.jAccount<this.dsAccount.Tables[0].length&&this.jAccount-this.iLoop<this.ChunkSize;this.jAccount++)this.strAccountID=this.dsAccount.Tables[0][this.jAccount][this.dsAccount.Columns[0][0]].toString(),this.dvAccount=this.dvAccountTable.filter(e=>e.AccountID==this.strAccountID),this.strAccountFilter="AccountID="+this.strAccountID,this.dv=this.ds.Tables[1],this.dvTable=this.ds.Tables[1],this.dvColumns=this.ds.Columns[1],this.strAccountFilterObj={AccountID:this.strAccountID},this.dv=this.dv.filter(e=>e.AccountID==this.strAccountID),this.ds.Tables.length>2&&(this.dvTbl2=this.ds.Tables[2].filter(e=>e.AccountID==this.strAccountFilterObj.AccountID),this.dvTbl2Table=this.ds.Tables[2],this.dvTbl2Columns=this.ds.Columns[2]),this.strAccountType=this.dsAccount.Tables[0][this.jAccount].AccountTypeID.toString(),this.strAccountName=this.dsAccount.Tables[0][this.jAccount].AccountName.toString(),this.OpenCompany&&null!=this.dtOpenCompanyYearStart&&this.IncomeExpAccounts.Contains(this.strAccountType)&&(this.dvAccount[0].BF=0),this.OpBalance=parseFloat(this.dvAccount[0].BF),this.ExcludeOpBalance&&(this.OpBalance=0),this.AllowAddRows=!!(this.dv.length>0||this.AccountsWithOutTransactions&&0!=this.OpBalance||this.ds.Tables.length>2&&this.dvTbl2.length>0),this.UnPostedDocsInclude&&this.UnPostedDocsSeparately&&(this.strAccountFilterObj.StatusID=[369,429],this.dv=this.dv.filter(e=>369==e.StatusID||429==e.StatusID)),this.AllowAddRows&&(-1==this.colOpBalanceIndex?(this.AccountsWithZeroBalance||0!=this.GetBalance())&&(this.IsNewAccount=!0,this.addGeneralLedger()):(this.AccountsWithZeroBalance||0!=this.GetBalance_GLSummary())&&(this.IsNewAccount=!0,this.addGL_DimWiseSummary()));this.ViewModel.refreshDataView(),this.iLoop+=this.ChunkSize,this.GLSummaryCallBack()},e=>{this.LoadReportComplete()})}}GLSummaryStart(e){e=e.replace("^strRetainedAccounts^",this.strRetainedAccounts.length>0?" OR A1.AccountID IN ("+this.strRetainedAccounts+")":""),o.a.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,e).then(e=>{this.dsAccount=e,this.IncomeExpAccounts=["4","8","11","5","9","12"],this.al=[],this.al.push(""),this.al.push(""),this.al.push(this.dtOpenCompanyYearStart?this.dtOpenCompanyYearStart:null),this.al.push(this.ViewModel.oReportDialog.FromDate.Date),this.al.push(this.ViewModel.oReportDialog.ToDate.Date),this.al.push(this.UnPostedDocsList),this.al.push(this.PDCInclude),this.al.push(this.IncludeTerminatedPDC),this.al.push(this.TagID),this.al.push(this.TagTableName),this.al.push(this.LocationWhere+this.GetDimensionFilter("DCC.dcCCNID")),this.al.push(-1==this.colOpBalanceIndex?0:1),this.al.push(this.CurrencyType),this.al.push(this.ForeignCurrencyID),this.al.push(this.ViewModel.SelectTag+this.ViewModel.GroupSelectTag),this.al.push(this.ViewModel.FromTag+this.ViewModel.GroupFromTag),this.al.push(this.ViewModel.SelectTagAliasOnly+this.ViewModel.GroupSelectTagAlias),this.al.push(o.a.SessionManager.LanguageID),this.ViewModel.DisplayMessage="",this.iLoop=0,this.GLSummaryCallBack()})}SetTrialBalanceDataSet(e){let t,s,l,a="",n="",h="",u="",D="",c="",C="",p="",T="",_="",m="",I="",R="",S="",A="",M="",g="",w="",E="",P="";this.strOrder="";let O=o.a.report.GetCloseDate(this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.IsReportDB);if(this.exchRate=0,this.ForeignCurrencyID>0)s="AmountFC",l=" AND ACC.CurrencyID="+this.ForeignCurrencyID;else if(s=1==this.CurrencyType?"AmountBC":"Amount",l="",this.ViewModel.Preferences.ContainsKey("FCWithExchRate")){let e=new i.f;e.LoadXml("<XML>"+this.ViewModel.Preferences.FCWithExchRate+"</XML>");let t=i.f.SelectSingleNode(e.DocumentElement,"IsChecked");null!=t&&"1"==t.innerHTML&&(t=i.f.SelectSingleNode(e.DocumentElement,"TextValue"),this.exchRate=i.e.Double(t.innerHTML),this.exchRate<=0&&(this.exchRate=1),s="Amount/"+this.exchRate.toString())}"Amount"==s&&null!=this.ViewModel.ReportColumns.find(e=>"FCClosingDebit"==e.ID&&e.HeaderAppearance.IsVisible)&&(this.IsFCClosingDebitExists=!0,this.ExcludeTreeTotalCols.push("FCClosingDebit"),this.ExcludeTreeTotalCols.push("FCClosingCredit"),n=",sum(ACC.AmountFC) FCOP_Dr,0 FCOP_Cr,0 FCTR_Dr,0 FCTR_Cr,ACC.CurrencyID",h=",0 FCOP_Dr,sum(ACC.AmountFC) FCOP_Cr,0 FCTR_Dr,0 FCTR_Cr,ACC.CurrencyID",u=",0 FCOP_Dr,0 FCOP_Cr,sum(ACC.AmountFC) FCTR_Dr,0 FCTR_Cr,ACC.CurrencyID",D=",0 FCOP_Dr,0 FCOP_Cr,0 FCTR_Dr,sum(ACC.AmountFC) FCTR_Cr,ACC.CurrencyID",c=",CASE WHEN SUM(FCOP_Dr)-SUM(FCOP_Cr)>0 THEN SUM(FCOP_Dr)-SUM(FCOP_Cr) ELSE 0 END FCOP_Dr,\nCASE WHEN SUM(FCOP_Dr)-SUM(FCOP_Cr)<0 THEN SUM(FCOP_Cr)-SUM(FCOP_Dr) ELSE 0 END FCOP_Cr,\nCASE WHEN SUM(FCTR_Dr)-SUM(FCTR_Cr)>0 THEN SUM(FCTR_Dr)-SUM(FCTR_Cr) ELSE 0 END FCTR_Dr,\nCASE WHEN SUM(FCTR_Dr)-SUM(FCTR_Cr)<0 THEN SUM(FCTR_Cr)-SUM(FCTR_Dr) ELSE 0 END FCTR_Cr,\nmax(CurrencyID) CurrencyID",C=",SUM(FCOP_Dr) FCOP_Dr,SUM(FCTR_Dr) FCTR_Dr,SUM(FCOP_Cr) FCOP_Cr,SUM(FCTR_Cr) FCTR_Cr,max(CurrencyID) CurrencyID",p=",FCOP_Dr,FCOP_Cr,FCTR_Dr,FCTR_Cr,C.Name Currency",T+=",ACC.CurrencyID");for(let o=0;o<this.ViewModel.ReportGroups.length;o++){let e=this.ViewModel.ReportGroups[o];if(e.CDGDO.ColumnCostCenterID>5e4){this.TBIsAccountWise=!0,this.TBGroupID=e.ID,e.CDGDO.ParentTableAlias="C"+e.CDGDO.ColumnCostCenterID,e.CDGDO.ActualColumn=e.CDGDO.ParentTableAlias+e.CDGDO.Column,M+=","+e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+" "+e.ID,g+=",DCC.dcCCNID"+(e.CDGDO.ColumnCostCenterID-5e4)+" AS "+e.ID+"_ID",T+=",DCC.dcCCNID"+(e.CDGDO.ColumnCostCenterID-5e4),E+=","+e.ID+"_ID",this.strOrder+=e.ID+",",P+=" INNER JOIN "+e.CDGDO.ParentCostCenterSysName+" AS "+e.CDGDO.ParentTableAlias,P+=" WITH(NOLOCK) ON "+e.CDGDO.ParentTableAlias+".NodeID=ACC."+e.ID+"_ID";break}}let y=this.GetDimensionFilter_2("DCC.dcCCNID","ACC.CNID");w=g,_=T,this.Show==d.TagWise?(M+=",TagID Tag",E+=",TagID",this.ViewModel.ReportDims.Contains(this.TagID.toString())?(g+=",ACC.CNID"+(this.TagID-5e4)+" TagID",T+=",ACC.CNID"+(this.TagID-5e4)):(g+=",DCC.dcCCNID"+(this.TagID-5e4)+" TagID",T+=",DCC.dcCCNID"+(this.TagID-5e4)),w=g,_=T):this.Show==d.MonthWise&&(M+=",CONVERT(NVARCHAR,YEAR(TagID))+'-'+ CONVERT(NVARCHAR,Month(TagID)) Tag",g+=",convert(datetime,DocDate+1-day(convert(datetime,DocDate))) TagID",w+=",convert(datetime,convert(int,@From)+1-day(@From)) TagID",E+=",TagID",T+=",convert(datetime,DocDate+1-day(convert(datetime,DocDate)))"),o.a.SessionManager.Preferences.ContainsKey("ControlAccDimension")&&(this.CADimension=i.e.Int(o.a.SessionManager.Preferences.ControlAccDimension)),this.CADimension>0&&(M+=",CADID,A1CC.CCNID"+(this.CADimension-5e4)+" CAD",E+=",CADID",g+=",DCC.dcCCNID"+(this.CADimension-5e4)+" CADID",T+=",DCC.dcCCNID"+(this.CADimension-5e4),this.Show==d.MonthWise?(w+=",DCC.dcCCNID"+(this.CADimension-5e4)+" CADID",_+=",DCC.dcCCNID"+(this.CADimension-5e4)):(w=g,_=T)),(this.LocationWhere.length>0||g.Contains("dcCCNID")||y.Contains("dcCCNID"))&&(m=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.AccDocDetailsID=ACC.AccDocDetailsID",I=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=ACC.InvDocDetailsID"),l+=y+this.LocationWhere,S="DocDate<@From",O&&O.AddDays(1)<this.ViewModel.oReportDialog.FromDate.Date&&(S+=" and DocDate>@Close");let N="";if(0==this.UnPostedDocsList.length?N=" AND (ACC.StatusID=369 or ACC.StatusID=429)":N+=" AND ACC.StatusID IN (369,429,"+this.UnPostedDocsList+")",this.PDCInclude){let e="(ACC.StatusID=370 OR ACC.StatusID=439"+(this.IncludeTerminatedPDC?" OR ACC.StatusID=452":"")+(this.IncludeUnApprovedPDC?" OR ACC.StatusID=371 OR ACC.StatusID=441":"")+")";R=" AND ACC.DocumentType!=16 AND ("+e+" OR (ACC.DocumentType!=14 AND ACC.DocumentType!=19"+N+"))",S+=" AND ("+e+" OR (ACC.DocumentType!=14 AND ACC.DocumentType!=19"+N+"))"}else R=" AND ACC.DocumentType NOT IN (16,14,19)"+N,S+=" AND ACC.DocumentType!=14 AND ACC.DocumentType!=19"+N;A=O&&O.AddDays(1)<this.ViewModel.oReportDialog.FromDate.Date?S:"((ACC.DocumentType=16"+N+") OR ("+S+"))";let b=!1,f="",V="",L="",B="",F="",v="",G=this.ViewModel.oReportDialog.FromDate.Date;this.OpenCompany&&this.DontShowREforPeriodInAssignedAccount&&(b=!0,G=new Date(this.ViewModel.oReportDialog.FromDate.Date.getFullYear(),this.AccountingFromMonth-1,1),G>this.ViewModel.oReportDialog.FromDate.Date&&(G=G.AddYears(-1)),G==this.ViewModel.oReportDialog.FromDate.Date&&(b=!1)),a+="DECLARE @From FLOAT,@To FLOAT\nSET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",O&&(a+="\nDECLARE @Close FLOAT\nSET @Close=CONVERT(FLOAT,CONVERT(DATETIME,'"+O.ToString("dd MMM yyyy")+"'))"),b&&(a+="\nDECLARE @YrStart FLOAT\nSET @YrStart=CONVERT(FLOAT,CONVERT(DATETIME,'"+G.ToString("dd MMM yyyy")+"'))",f=",sum(case when ACC.DocDate>=@YrStart and ACC.DocDate<@From then ACC."+s+" else 0 end) PeriodOpDr,0 PeriodOpCr",V=",0,sum(case when ACC.DocDate>=@YrStart and ACC.DocDate<@From then ACC."+s+" else 0 end)",L=",0.0,0.0",B=",CASE WHEN SUM(PeriodOpDr)-SUM(PeriodOpCr)>0 THEN SUM(PeriodOpDr)-SUM(PeriodOpCr) ELSE 0 END PeriodOpDr,\nCASE WHEN SUM(PeriodOpDr)-SUM(PeriodOpCr)<0 THEN SUM(PeriodOpCr)-SUM(PeriodOpDr) ELSE 0 END PeriodOpCr",F=",SUM(PeriodOpDr) PeriodOpDr,SUM(PeriodOpCr) PeriodOpCr",v=",PeriodOpDr,PeriodOpCr"),t="",-1!=this.colPDCInd&&(t+=",(select sum(Amount) from(\nSELECT sum(Amount) Amount FROM ACC_DocDetails ACC WITH(NOLOCK)"+m+" WHERE DebitAccount=A1.AccountID and DocDate<=@To and (ACC.StatusID=370 OR ACC.StatusID=439)"+l+"\nunion all\nSELECT -sum(Amount) FROM ACC_DocDetails ACC WITH(NOLOCK)"+m+"\nWHERE CreditAccount=A1.AccountID and DocDate<=@To and (ACC.StatusID=370 OR ACC.StatusID=439"+(this.IncludeUnApprovedPDC?" OR ACC.StatusID=371 OR ACC.StatusID=441":"")+")"+l,t+=") AS TPDC) TotalPDC"),a+="\nSELECT A1.AccountCode,A1.AccountName,OP_Dr,OP_Cr,TR_Dr,TR_Cr,A1.AccountID"+M+this.ViewModel.SelectTag+p+v+t+",A1.IsGroup,A1.lft,A1.rgt,A1.AccountTypeID,A1.Depth,A1.ParentID,A1.TB_INT IsSummary\nFROM (\nSELECT AccountID"+E+",SUM(OP_Dr) OP_Dr,SUM(OP_Cr) OP_Cr,SUM(TR_Dr) TR_Dr,SUM(TR_Cr) TR_Cr"+C+F+"\nFROM(\nSELECT T1.AccountID,VoucherNo"+E.Replace(",CADID",",case when CA.AccountTypeID=6 or CA.AccountTypeID=7 then CADID else 1 end CADID")+",",a+=this.RoundOff.length>0?"\nCASE WHEN SUM(OP_Dr)-SUM(OP_Cr)>0 THEN round(convert(decimal(18,5),SUM(OP_Dr)-SUM(OP_Cr)),"+this.RoundOff+") ELSE 0 END OP_Dr,\nCASE WHEN SUM(OP_Dr)-SUM(OP_Cr)<0 THEN round(convert(decimal(18,5),SUM(OP_Cr)-SUM(OP_Dr)),"+this.RoundOff+") ELSE 0 END OP_Cr,\nCASE WHEN SUM(TR_Dr)-SUM(TR_Cr)>0 THEN round(convert(decimal(18,5),SUM(TR_Dr)-SUM(TR_Cr)),"+this.RoundOff+") ELSE 0 END TR_Dr,\nCASE WHEN SUM(TR_Dr)-SUM(TR_Cr)<0 THEN round(convert(decimal(18,5),SUM(TR_Cr)-SUM(TR_Dr)),"+this.RoundOff+") ELSE 0 END TR_Cr":"CASE WHEN SUM(OP_Dr)-SUM(OP_Cr)>0 THEN SUM(OP_Dr)-SUM(OP_Cr) ELSE 0 END OP_Dr,\nCASE WHEN SUM(OP_Dr)-SUM(OP_Cr)<0 THEN SUM(OP_Cr)-SUM(OP_Dr) ELSE 0 END OP_Cr,\nCASE WHEN SUM(TR_Dr)-SUM(TR_Cr)>0 THEN SUM(TR_Dr)-SUM(TR_Cr) ELSE 0 END TR_Dr,\nCASE WHEN SUM(TR_Dr)-SUM(TR_Cr)<0 THEN SUM(TR_Cr)-SUM(TR_Dr) ELSE 0 END TR_Cr",a+=c+B+"\nFROM (",O&&(a+="\n--Opening Dr Close\nSELECT AccountID AccountID,'' VoucherNo\n,CASE WHEN sum(DCC."+s+")>0 then sum(DCC."+s+") else 0.0 end OP_Dr,CASE WHEN sum(DCC."+s+")<0 then -sum(DCC."+s+") else 0.0 end OP_Cr\n,0 TR_Dr,0 TR_Cr",n.length>0&&(a+=",CASE WHEN sum(DCC.AmountFC)>0 then sum(DCC.AmountFC) else 0.0 end FCOP_Dr,CASE WHEN sum(DCC.AmountFC)<0 then -sum(DCC.AmountFC) else 0.0 end FCOP_Cr,0 FCTR_Dr,0 FCTR_Cr,1 CurrencyID"),b&&(a+=",0.0 PeriodOpDr,0.0 PeriodOpCr"),a+="\nFROM ACC_AccountsClose DCC WITH(NOLOCK)\nWHERE CloseDate=@Close "+y+this.LocationWhere,this.ForeignCurrencyID>0&&(a+=" and CurrencyID="+this.ForeignCurrencyID),a+="\ngroup by AccountID"),O&&O.AddDays(1)==this.ViewModel.oReportDialog.FromDate.Date||(O&&(a+="\nUNION ALL"),a+="\n--Opening Dr\nSELECT DebitAccount AccountID,VoucherNo"+w+",sum(ACC."+s+") OP_Dr,0 OP_Cr,0 TR_Dr,0 TR_Cr"+n+f+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+m+"\nWHERE "+A+l+"\ngroup by DebitAccount,VoucherNo"+_+"\nUNION ALL--Opening Cr\nSELECT CreditAccount AccountID,VoucherNo"+w+",0 OP_Dr,sum(ACC."+s+") OP_Cr,0 TR_Dr, 0 TR_Cr"+h+V+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+m+"\nWHERE "+A+l+"\ngroup by CreditAccount,VoucherNo"+_),a+="\nUNION ALL--Transaction Dr\nSELECT DebitAccount AccountID,VoucherNo"+g+",0 OP_Dr,0 OP_Cr,sum("+s+") TR_Dr,0 TR_Cr"+u+L+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+m+"\nWHERE (DocDate BETWEEN @From AND @To)"+R+l+"\ngroup by DebitAccount,VoucherNo"+T+"\nUNION ALL--Transaction Cr\nSELECT CreditAccount AccountID,VoucherNo"+g+",0 OP_Dr,0 OP_Cr,0 TR_Dr,sum("+s+") TR_Cr"+D+L+"\nFROM ACC_DocDetails ACC  WITH(NOLOCK)"+m+"\nWHERE (DocDate BETWEEN @From AND @To)"+R+l+"\ngroup by CreditAccount,VoucherNo"+T,I.length>0&&(O&&O.AddDays(1)==this.ViewModel.oReportDialog.FromDate.Date||(a+="\n--INEVENTORY DATA\nUNION ALL--Opening Dr\nSELECT DebitAccount AccountID,VoucherNo"+w+",sum(ACC."+s+") OP_Dr,0 OP_Cr,0 TR_Dr,0 TR_Cr"+n+f+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+I+"\nWHERE "+A+l+"\ngroup by DebitAccount,VoucherNo"+_+"\nUNION ALL--Opening Cr\nSELECT CreditAccount AccountID,VoucherNo"+w+",0 OP_Dr,sum(ACC."+s+") OP_Cr,0 TR_Dr, 0 TR_Cr"+h+V+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+I+"\nWHERE "+A+l+"\ngroup by CreditAccount,VoucherNo"+_),a+="\nUNION ALL--Transaction Dr\nSELECT DebitAccount AccountID,VoucherNo"+g+",0 OP_Dr,0 OP_Cr,sum("+s+") TR_Dr,0 TR_Cr"+u+L+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+I+"\nWHERE (DocDate BETWEEN @From AND @To)"+R+l+"\ngroup by DebitAccount,VoucherNo"+T+"\nUNION ALL--Transaction Cr\nSELECT CreditAccount AccountID,VoucherNo"+g+",0 OP_Dr,0 OP_Cr,0 TR_Dr,sum("+s+") TR_Cr"+D+L+"\nFROM ACC_DocDetails ACC  WITH(NOLOCK)"+I+"\nWHERE (DocDate BETWEEN @From AND @To)"+R+l+"\ngroup by CreditAccount,VoucherNo"+T),a+="\n) AS T1 "+(this.CADimension>0?" JOIN ACC_Accounts CA WITH(NOLOCK) ON CA.AccountID=T1.AccountID":"")+" GROUP BY T1.AccountID,VoucherNo"+E+(this.CADimension>0?",CA.AccountTypeID":"")+"\n) AS T2 GROUP BY AccountID"+E+"\n) AS ACC",n.length>0&&(a+=" inner join COM_Currency C with(nolock) on C.CurrencyID=ACC.CurrencyID"),a+=" RIGHT JOIN ACC_Accounts A1 WITH(NOLOCK) ON A1.AccountID=ACC.AccountID\n"+this.ViewModel.FromTag,this.CADimension>0&&(a+=" left JOIN COM_CCCCDATA A1CC WITH(NOLOCK) ON A1CC.CostCenterID=2 and A1CC.NodeID=A1.AccountID"),a+=P+this.GTPQuery+"\nWHERE A1.AccountID>1",a+=this.GetAccountTypeWhere("A1"),a+=this.GetAccountWiseLocationWhere("A1"),this.GTPWhere.length>0&&(a+=" AND "+this.GTPWhere),this.TBIsAccountWise?(a+=" AND A1.IsGroup=0",this.strOrder+="Code"==this.ViewModel.Preferences.TreeSortOn?"A1.AccountCode":"TreeOrder"==this.ViewModel.Preferences.TreeSortOn?"A1.lft":"A1.AccountName",a+=" Order By "+this.strOrder,this.Show==d.MonthWise&&(a+=",TagID"),a+=" select AccountID,AccountCode,AccountName,AccountTypeID,TB_INT TB,lft,Depth,ParentID from acc_accounts with(nolock) where IsGroup=1 Order By Depth"):(a+=" Order By A1.lft",this.Show==d.MonthWise&&(a+=",TagID"));let x=new r.a;if(x.push("ds",o.a.report.ReportDataSet("RPT022",this.ViewModel.IsReportDB,a.toString())),-1!=this.YTDIndex||-1!=this.BAL_LYIndex||-1!=this.YTD_LYIndex){if(a="",a+="\nSELECT AccountID,ISNULL(SUM(DR),0)-IsNULL(SUM(CR),0) Balance FROM (",a+="\n--Opening Dr\nSELECT DebitAccount AccountID,ACC."+s+" DR,0 CR\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+m+"\nWHERE ((ACC.DocumentType=16"+N+" AND DocDate<=@To) OR ((DocDate BETWEEN @From AND @To) "+R+"))"+l+"\nUNION ALL--Opening Cr\nSELECT CreditAccount AccountID,0 DR,ACC."+s+" CR\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+m+"\nWHERE ((ACC.DocumentType=16"+N+" AND DocDate<=@To) OR ((DocDate BETWEEN @From AND @To) "+R+"))"+l,I.length>0&&(a+="\n--INEVENTORY DATA\nUNION ALL--Opening Dr\nSELECT DebitAccount AccountID,ACC."+s+" DR,0 CR\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+I+"\nWHERE ((ACC.DocumentType=16"+N+" AND DocDate<=@To) OR ((DocDate BETWEEN @From AND @To) "+R+"))"+l+"\nUNION ALL--Opening Cr\nSELECT CreditAccount AccountID,0 DR,ACC."+s+" CR\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+I+"\nWHERE ((ACC.DocumentType=16"+N+" AND DocDate<=@To) OR ((DocDate BETWEEN @From AND @To) "+R+"))"+l),a+=") AS T1 GROUP BY AccountID",!i.e.IsEmpty(e)){let t=e.split(",");t.Contains("1")||t.Contains("0")||(a+=" HAVING AccountID IN ("+e+")")}-1!=this.BAL_LYIndex&&x.push("dvBAL_LYTable",o.a.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,"DECLARE @From FLOAT,@To FLOAT\nSET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.AddYears(-1).ToString("dd MMM yyyy")+"'))\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.AddYears(-1).ToString("dd MMM yyyy")+"'))\n"+a)),-1!=this.YTD_LYIndex&&x.push("dvYTD_LY",o.a.report.ReportDataTable("RPT022",this.ViewModel.IsReportDB,"DECLARE @From FLOAT,@To FLOAT\nSET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.dtYearStartMonth.AddYears(-1).ToString("dd MMM yyyy")+"'))\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.AddYears(-1).ToString("dd MMM yyyy")+"'))\n"+a))}return this.dvOpenCompany=null,this.dvOpenCompanyTable=null,this.dsOpenCompany=null,0==this.TBGroupID.length&&this.OpenCompany?x.push("dsOpenCompany",o.a.report.GetOpenCompanyData(this.ViewModel.StaticReportType,G,this.ViewModel.oReportDialog.ToDate.Date,this.TagID,this.LocationWhere+y,!0,this.UnPostedDocsList,this.PDCInclude,this.IncludeTerminatedPDC,"",this.CurrencyType,this.ForeignCurrencyID,this.exchRate,this.ViewModel.IsReportDB)):this.OpenCompany=!1,Promise.all(x.values).then(e=>{let t;if(this.ds=e[0],x.ContainsKey("dvBAL_LYTable")&&(t=x.keys.indexOf("dvBAL_LYTable"),this.dvBAL_LYTable=e[t].Tables[0],this.ds.Columns[0].push("LastYearBalance")),x.ContainsKey("dvYTD_LY")&&(t=x.keys.indexOf("dvYTD_LY"),this.dvYTD_LY=e[t].Tables[0],this.ds.Columns[0].push("LastYearYTD")),x.ContainsKey("dsOpenCompany")&&(t=x.keys.indexOf("dsOpenCompany"),this.dsOpenCompany=e[t],this.dvOpenCompany=this.dvOpenCompanyTable=this.dsOpenCompany.Tables[0]),this.CADimension>0){let e=new r.c,t=this.ds.Tables[0];for(let s=t.length-1;s>=0;s--)if(null!=t[s].CADID&&parseInt(t[s].CADID)>1){let o=parseInt(t[s].CADID);if(!e.ContainsKey(o)){let s=t.filter(e=>e.CAD==o);s.length>0&&e.push(o,s[0])}e.ContainsKey(o)&&(null!=t[s].OP_Dr&&(e[o].OP_Dr=null==e[o].OP_Dr?t[s].OP_Dr:parseFloat(e[o].OP_Dr)+parseFloat(t[s].OP_Dr)),null!=t[s].OP_Cr&&(e[o].OP_Cr=null==e[o].OP_Cr?t[s].OP_Cr:parseFloat(e[o].OP_Cr)+parseFloat(t[s].OP_Cr)),null!=t[s].TR_Dr&&(e[o].TR_Dr=null==e[o].TR_Dr?t[s].TR_Dr:parseFloat(e[o].TR_Dr)+parseFloat(t[s].TR_Dr)),null!=t[s].TR_Cr&&(e[o].TR_Cr=null==e[o].TR_Cr?t[s].TR_Cr:parseFloat(e[o].TR_Cr)+parseFloat(t[s].TR_Cr)),e.values.Contains(t[s])||t.RemoveAt(s))}}})}AddReportTotals(){if(4==this.ViewModel.StaticReportType){let e=0,t=0;if(this.IsTTypeTB){if(!this.HideOpeningProfitAndLoss&&this.OpenCompany){let s=this.dsOpenCompany.Tables[0].Compute("sum","Dr");e=null!=s?parseFloat(s):0,s=this.dsOpenCompany.Tables[0].Compute("sum","Cr"),t=null!=s?parseFloat(s):0,e>0&&(e-=this.dblDrOpenCompany,e<0&&(e=0)),t>0&&(t-=this.dblCrOpenCompany,t<0&&(t=0)),0==e&&0==t||(this.row=this.NewReportRow_2(n.f.BalanceBF,this.GrossTotalAppearance_Data),this.row.LevelNo=0,this.row.Cells[0].CellAppearance=this.GrossTotalAppearance,this.row.Cells[0].ColSpan=this.BalIndex,this.row.Cells[0].Text=o.a.GetResource("Reports_OpeningProfitAndLossBalance"),e>t?(this.dbl=e-t,this.dbl=this.ViewModel.RoundOff(this.dbl,this.oColumns[this.BalIndex].DataFormat),this.ReportTotal[0]+=this.dbl,this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.row.Cells[this.BalIndex])):(this.dbl=t-e,this.dbl=this.ViewModel.RoundOff(this.dbl,this.oColumns[this.CellStartPos+this.BalIndex].DataFormat),this.ReportTotal[1]+=this.dbl,this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.CellStartPos+this.BalIndex].DataFormat,"FLOAT",this.row.Cells[this.CellStartPos+this.BalIndex])),this.GrdRow++,this.ViewModel.addRow(this.row))}this.HideOpeningBalanceDifference||(e=this.arrTBTotals[0]+this.dblMissingOpeningDr,t=this.arrTBTotals[1]+this.dblMissingOpeningCr,parseFloat(Math.abs(t-e).ToString("N1"))>.1&&(this.row=this.NewReportRow_2(n.f.BalanceBF,this.GrossTotalAppearance_Data),this.row.LevelNo=0,this.row.Cells[0].CellAppearance=this.GrossTotalAppearance,this.row.Cells[0].ColSpan=this.BalIndex,this.row.Cells[0].Text=o.a.GetResource("Reports_OpeningBalanceDifference"),e>t?(this.dbl=e-t,this.dbl=this.ViewModel.RoundOff(this.dbl,this.oColumns[this.CellStartPos+this.BalIndex].DataFormat),this.ReportTotal[1]+=this.dbl,this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.CellStartPos+this.BalIndex].DataFormat,"FLOAT",this.row.Cells[this.CellStartPos+this.BalIndex])):(this.dbl=t-e,this.dbl=this.ViewModel.RoundOff(this.dbl,this.oColumns[this.BalIndex].DataFormat),this.ReportTotal[0]+=this.dbl,this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.row.Cells[this.BalIndex])),this.GrdRow++,this.ViewModel.addRow(this.row))),this.row=this.NewReportRow_2(n.f.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance),this.ViewModel.GrpReportTotal.Height>0&&(this.row.Height=this.ViewModel.GrpReportTotal.Height),this.row.LevelNo=0,this.row.Cells[this.BalIndex].CellAppearance.Alignment="Right",this.row.Cells[this.BalIndex+this.TTColumnSize].CellAppearance.Alignment="Right",this.ViewModel.SetCellValue(this.ReportTotal[0],this.oColumns[this.BalIndex].DataFormat,this.oColumns[this.BalIndex].ColumnType,this.row.Cells[this.BalIndex]),this.ViewModel.SetCellValue(this.ReportTotal[1],this.oColumns[this.BalIndex].DataFormat,this.oColumns[this.BalIndex+this.TTColumnSize].ColumnType,this.row.Cells[this.BalIndex+this.TTColumnSize]),this.row.Cells[0].Text=o.a.GetResource("Reports_ReportTotal"),this.BalIndex>0&&(this.row.Cells[0].ColSpan=this.BalIndex),this.GrdRow++,this.ViewModel.addRow(this.row)}else{if(this.UpdateTreeTotals(0),!this.HideOpeningProfitAndLoss&&this.OpenCompany){let s=this.dsOpenCompany.Tables[0].Compute("sum","Dr");e=null!=s?parseFloat(s):0,s=this.dsOpenCompany.Tables[0].Compute("sum","Cr"),t=null!=s?parseFloat(s):0,e>0&&(e-=this.dblDrOpenCompany,(e<0||e<1e-4)&&(e=0)),t>0&&(t-=this.dblCrOpenCompany,t<0&&(t=0)),0==e&&0==t||(this.row=this.NewReportRow_2(n.f.BalanceBF,this.GrossTotalAppearance_Data),this.row.LevelNo=0,this.row.Cells[0].CellAppearance=this.GrossTotalAppearance,this.row.Cells[0].ColSpan=2,this.row.Cells[0].Text=o.a.GetResource("Reports_OpeningProfitAndLossBalance"),!this.OpDrCrInOpDr&&e>t?(this.dbl=e-t,-1!=this.colTBOp_DrIndex&&(this.lstTotal[0][this.colTBOp_DrIndex]+=this.dbl,this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.colTBOp_DrIndex].DataFormat,"FLOAT",this.row.Cells[this.colTBOp_DrIndex])),-1!=this.colTBCl_DrIndex&&(this.lstTotal[0][this.colTBCl_DrIndex]+=this.dbl,this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.colTBCl_DrIndex].DataFormat,"FLOAT",this.row.Cells[this.colTBCl_DrIndex]))):(this.dbl=t-e,-1!=this.colTBOp_CrIndex&&(this.lstTotal[0][this.colTBOp_CrIndex]+=this.dbl,this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.colTBOp_CrIndex].DataFormat,"FLOAT",this.row.Cells[this.colTBOp_CrIndex])),-1!=this.colTBCl_CrIndex&&(this.lstTotal[0][this.colTBCl_CrIndex]+=this.dbl,this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.colTBCl_CrIndex].DataFormat,"FLOAT",this.row.Cells[this.colTBCl_CrIndex]))),-1!=this.colBalanceIndex&&(this.lstTotal[0][this.colBalanceIndex]+=e-t,this.ViewModel.SetCellValue(e-t,this.oColumns[this.colBalanceIndex].DataFormat,"FLOAT",this.row.Cells[this.colBalanceIndex])),this.GrdRow++,this.ViewModel.addRow(this.row))}this.HideOpeningBalanceDifference||(e=this.arrTBTotals[0]+this.dblMissingOpeningDr,t=this.arrTBTotals[1]+this.dblMissingOpeningCr,parseFloat(Math.abs(t-e).ToString("N1"))>.1&&(this.row=this.NewReportRow_2(n.f.BalanceBF,this.GrossTotalAppearance_Data),this.row.LevelNo=0,this.row.Cells[0].CellAppearance=this.GrossTotalAppearance,this.row.Cells[0].ColSpan=2,this.row.Cells[0].Text=o.a.GetResource("Reports_OpeningBalanceDifference"),!this.OpDrCrInOpDr&&e>t?(this.dbl=e-t,-1!=this.colTBOp_CrIndex&&(this.lstTotal[0][this.colTBOp_CrIndex]+=this.dbl,this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.colTBOp_CrIndex].DataFormat,"FLOAT",this.row.Cells[this.colTBOp_CrIndex])),-1!=this.colTBCl_CrIndex&&(this.lstTotal[0][this.colTBCl_CrIndex]+=this.dbl,this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.colTBCl_CrIndex].DataFormat,"FLOAT",this.row.Cells[this.colTBCl_CrIndex]))):(this.dbl=t-e,-1!=this.colTBOp_DrIndex&&(this.lstTotal[0][this.colTBOp_DrIndex]+=this.dbl,this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.colTBOp_DrIndex].DataFormat,"FLOAT",this.row.Cells[this.colTBOp_DrIndex])),-1!=this.colTBCl_DrIndex&&(this.lstTotal[0][this.colTBCl_DrIndex]+=this.dbl,this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.colTBCl_DrIndex].DataFormat,"FLOAT",this.row.Cells[this.colTBCl_DrIndex]))),-1!=this.colBalanceIndex&&(this.lstTotal[0][this.colBalanceIndex]+=t-e,this.ViewModel.SetCellValue(t-e,this.oColumns[this.colBalanceIndex].DataFormat,"FLOAT",this.row.Cells[this.colBalanceIndex])),this.GrdRow++,this.ViewModel.addRow(this.row))),this.row=this.NewReportRow_2(n.f.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance),this.ViewModel.GrpReportTotal.Height>0&&(this.row.Height=this.ViewModel.GrpReportTotal.Height),this.row.LevelNo=0;let s=-1;for(this.k=0;this.k<this.ViewModel.ColumnSource.length;this.k++)this.ViewModel.GrpReportTotal.TotalCols.ContainsKey(this.oColumns[this.k].ID)&&(-1==s&&(s=this.k),this.row.Cells[this.k].CellAppearance.Alignment="Right",this.ViewModel.SetCellValue(this.lstTotal[0][this.k].toString(),this.oColumns[this.k].DataFormat,this.oColumns[this.k].ColumnType,this.row.Cells[this.k]));for(this.k=this.ViewModel.ColumnSource.length;this.k<this.oColumns.length;this.k++)-1==s&&(s=this.k),this.row.Cells[this.k].CellAppearance.Alignment="Right",this.ViewModel.SetCellValue(this.lstTotal[0][this.k].toString(),this.oColumns[this.k].DataFormat,this.oColumns[this.k].ColumnType,this.row.Cells[this.k]);this.row.Cells[0].Text=o.a.GetResource("Reports_ReportTotal"),s>0&&(this.GrdRow++,this.row.Cells[0].ColSpan=s,this.ViewModel.addRow(this.row))}}else if(169==this.ViewModel.StaticReportType);else if(this.ViewModel.totals=this.AggTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance.IsVisible){this.GrdRow++,this.row=this.NewReportRow_2(n.f.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance),this.ViewModel.GrpReportTotal.Height>0&&(this.row.Height=this.ViewModel.GrpReportTotal.Height),this.row.LevelNo=0;let e=-1;for(this.k=0;this.k<this.oColumns.length;this.k++)this.ViewModel.GrpReportTotal.TotalCols.ContainsKey(this.oColumns[this.k].ID)&&(-1==e&&(e=this.k),this.row.Cells[this.k].CellAppearance.Alignment="Right",this.ViewModel.SetCellValue(this.AggTotal[this.k][0].toString(),this.oColumns[this.k].DataFormat,"FLOAT",this.row.Cells[this.k]));this.row.Cells[0].Text=o.a.GetResource("Reports_ReportTotal"),e>0&&(this.row.Cells[0].ColSpan=e,this.ViewModel.addRow(this.row))}}LoadReportWithPostFilters(e){if(this.GrdRow=-1,this.IsRetainedEarning=!1,2==this.ViewModel.StaticReportType||3==this.ViewModel.StaticReportType?this.AggTotal=new Array(this.oColumns.length).fill(0).map(()=>new Array(2).fill(0)):1!=this.ViewModel.StaticReportType&&86!=this.ViewModel.StaticReportType||(this.AggTotal=new Array(this.oColumns.length).fill(0).map(()=>new Array(5).fill(0))),this.ViewModel.ClearRows(),this.ViewModel.lstGroupIndex.Clear(),1==this.ViewModel.StaticReportType||86==this.ViewModel.StaticReportType){if(null==this.dsAccount)return;if(e.length>0?(e=" AND "+e,this.AccountsWithOutTransactions=!1):this.AccountsWithOutTransactions="1"==this.ViewModel.Preferences.WantAccountsWithoutTransactions,this.filter=e,1==this.ViewModel.StaticReportType&&2==this.ViewModel.lstGroup.length){let e,t=this.ChunkSize;for(this.iLoop=0,e=0;this.iLoop<this.dsAccount.Tables[0].length;this.iLoop+=t,e++)for(this.ds=this.DataSetCollection[e],this.dvAccount=this.ds.Tables[0],this.IsControlAccounts?(this.IsCurrentControlAccount=!1,t=this.iDataSetCollection[e],1==parseInt(this.dsAccount.Tables[0][this.iLoop].IsControl)&&(this.IsCurrentControlAccount=!0)):t=this.ChunkSize,this.jAccount=this.iLoop;this.jAccount<this.dsAccount.Tables[0].length&&this.jAccount-this.iLoop<t;this.jAccount++)if(this.strAccountID=this.dsAccount.Tables[0][this.jAccount][this.dsAccount.Columns[0][0]].toString(),this.dv=this.ds.Tables[1],this.dvTable=this.ds.Tables[1],this.dvColumns=this.ds.Columns[1],this.strAccountFilter="AccountID="+this.strAccountID,this.strAccountFilterObj={AccountID:this.strAccountID},this.IsCurrentControlAccount&&(this.strAccountFilter="1=1"),this.dv=this.dvTable.filter(e=>e.AccountID==this.strAccountID),this.dv=D.a.FilterData(this.dv,this.ViewModel.PostDataFetchFilterFields),this.dvAccount=this.dvAccountTable.filter(e=>e.AccountID==this.strAccountID),this.ds.Tables.length>2&&(this.dvTbl2=this.ds.Tables[2].filter(e=>e.AccountID==this.strAccountID),this.dvTbl2=D.a.FilterData(this.dvTbl2,this.ViewModel.PostDataFetchFilterFields),this.dvTbl2Table=this.ds.Tables[2],this.dvTbl2Columns=this.ds.Columns[2]),0!=this.dvAccount.length||0!=this.dv.length){for(let e=0;e<this.oColumns.length;e++)this.AggTotal[e][4]=0;this.IsNewAccount=!0,this.dvAccount.forEach(e=>{this.strTagID=e.TAG.toString(),this.strTagName=e.Name.toString(),this.strAccountType=this.dsAccount.Tables[0][this.jAccount].AccountTypeID.toString(),this.strAccountName=this.dsAccount.Tables[0][this.jAccount].AccountName.toString(),this.strAccountFilterObj={},this.IsCurrentControlAccount?this.strAccountFilterObj.TAG=this.strTagID:(this.strAccountFilterObj.TAG=this.strTagID,this.strAccountFilterObj.AccountID=this.strAccountID),this.dv=this.ds.Tables[1],this.dvTable=this.ds.Tables[1],this.dvColumns=this.ds.Columns[1],this.dv=this.dv.filter(e=>e.TAG==this.strTagID),this.IsCurrentControlAccount||(this.dv=this.dv.filter(e=>e.AccountID==this.strAccountID)),this.dv=D.a.FilterData(this.dv,this.ViewModel.PostDataFetchFilterFields),this.ds.Tables.length>2&&(this.dvTbl2=this.ds.Tables[2].filter(e=>e.TAG==this.strAccountID),this.dvTbl2=D.a.FilterData(this.dvTbl2,this.ViewModel.PostDataFetchFilterFields)),this.OpBalance=parseFloat(e.BF),this.ExcludeOpBalance&&(this.OpBalance=0),this.AllowAddRows=!!(this.dv.length>0||this.AccountsWithOutTransactions||this.ds.Tables.length>2&&this.dvTbl2.length>0),this.UnPostedDocsInclude&&this.UnPostedDocsSeparately&&(this.strAccountFilterObj.StatusID=[369,429],this.dv=this.dv.filter(e=>369==e.StatusID||429==e.StatusID)),this.AllowAddRows&&(this.AccountsWithZeroBalance||0!=this.GetBalance())&&this.addGeneralLedger()}),this.ViewModel.lstGroup[0].SubTotalAppearance.IsVisible&&this.AddSubTotal(this.strAccountName,4)}}else{let e,t=0;for(this.iLoop=0,e=0;this.iLoop<this.dsAccount.Tables[0].length;this.iLoop+=t,e++)for(this.ds=this.DataSetCollection[e],this.dvAccount=this.ds.Tables[0],this.IsControlAccounts?(this.IsCurrentControlAccount=!1,t=this.ds.Tables[0].length,1==parseInt(this.dsAccount.Tables[0][this.iLoop].IsControl)&&(this.IsCurrentControlAccount=!0)):t=this.ChunkSize,this.jAccount=this.iLoop;this.jAccount<this.dsAccount.Tables[0].length&&this.jAccount-this.iLoop<t;this.jAccount++)this.strAccountID=this.dsAccount.Tables[0][this.jAccount].AccountID.toString(),this.dvAccount=this.ds.Tables[0].filter(e=>e.AccountID==this.strAccountID),this.dv=this.ds.Tables[1],this.dvTable=this.ds.Tables[1],this.dvColumns=this.ds.Columns[1],this.strAccountFilterObj={},this.strAccountName=this.dsAccount.Tables[0][this.jAccount].AccountName.toString(),this.IsCurrentControlAccount?this.dv=this.dv:(this.strAccountFilterObj.AccountID=this.strAccountID,this.dv=this.dv.filter(e=>e.AccountID==this.strAccountID)),this.dv=D.a.FilterData(this.dv,this.ViewModel.PostDataFetchFilterFields),this.OpBalance=parseFloat(this.dvAccount[0].BF),this.strAccountType=this.dsAccount.Tables[0][this.jAccount].AccountTypeID.toString(),this.strAccountName=this.dsAccount.Tables[0][this.jAccount].AccountName.toString(),this.AllowAddRows=!!(this.dv.length>0||this.AccountsWithOutTransactions||this.ds.Tables.length>2&&this.dvTbl2.length>0),this.ExcludeOpBalance&&(this.OpBalance=0),this.UnPostedDocsInclude&&this.UnPostedDocsSeparately&&(this.strAccountFilterObj.StatusID=[369,429],this.dv=this.dv.filter(e=>369==e.StatusID||429==e.StatusID)),this.AllowAddRows&&(this.AccountsWithZeroBalance||0!=this.GetBalance())&&(this.IsNewAccount=!0,-1==this.colOpBalanceIndex?this.addGeneralLedger():this.addGL_DimWiseSummary())}}else if(2==this.ViewModel.StaticReportType||3==this.ViewModel.StaticReportType){if(null==this.dsAccount)return;let t;for(e.length>0&&(e=" AND "+e),this.filter=e,this.iLoop=0,t=0;this.iLoop<this.dsAccount.Tables[0].length;this.iLoop+=this.ChunkSize,t++){this.ds=this.DataSetCollection[t],this.dvAccount=this.ds.Tables[0].DefaultView;for(let e=this.iLoop;e<this.dsAccount.Tables[0].length&&e-this.iLoop<this.ChunkSize;e++)this.strAccountID=this.dsAccount.Tables[0][e][this.dsAccount.Columns[0][0]].toString(),this.strAccountFilterObj={AccountID:this.strAccountID},this.dvAccount=this.dvAccountTable.filter(e=>e.AccountID==this.strAccountID),this.strAccountName=this.dsAccount.Tables[0][e].AccountName.toString(),this.strAccountType=this.dsAccount.Tables[0][e].AccountTypeID.toString(),this.dv=this.dvTable.filter(e=>e.AccountID==this.strAccountID),this.dv=D.a.FilterData(this.dv,this.ViewModel.PostDataFetchFilterFields),this.OpBalance=parseFloat(this.dvAccount[0].BF),(this.dv.length>0||0!=this.OpBalance)&&this.addCashBookAndBankBook()}}else if(156==this.ViewModel.StaticReportType){if(null==this.dsAccount)return;e.length>0&&(e=" AND "+e),this.filter=e,this.ds=this.DataSetCollection[0],this.dvAccount=this.ds.Tables[0];for(let e=this.i;e<this.dsAccount.Tables[0].length;e++)this.strAccountID=this.dsAccount.Tables[0][this.jAccount].NodeID.toString(),this.strAccountFilterObj={},this.strAccountFilterObj.TAG=this.strAccountID,this.strAccountName=this.dsAccount.Tables[0][this.jAccount].TagName.toString(),this.dvAccount=this.dvAccountTable.fill(e=>e.TAG==this.strAccountID),this.dv=this.dvTable.fill(e=>e.TAG==this.strAccountID),this.dv=D.a.FilterData(this.dv,this.ViewModel.PostDataFetchFilterFields),this.ds.Tables.length>2&&(this.dvTbl2=this.ds.Tables[2].filter(e=>e.TAG==this.strAccountID),this.dvTbl2=D.a.FilterData(this.dvTbl2,this.ViewModel.PostDataFetchFilterFields)),this.OpBalance=this.dvAccount.length>0?parseFloat(this.dvAccount[0].BF):0,this.strAccountName=this.dsAccount.Tables[0][e].TagName.toString(),this.AllowAddRows=!!(this.dv.length>0||this.AccountsWithOutTransactions||this.ds.Tables.length>2&&this.dvTbl2.length>0),this.UnPostedDocsInclude&&this.UnPostedDocsSeparately&&(this.strAccountFilterObj.StatusID=[369,429],this.dv=this.dv.filter(e=>369==e.StatusID||429==e.StatusID)),this.AllowAddRows&&(this.AccountsWithZeroBalance||0!=this.GetBalance())&&(this.IsNewAccount=!0,this.addGeneralLedger())}else this.filter=e,this.IsTTypeTB?this.addTrialBalanceTType():(this.dv=D.a.FilterData(this.ds.Tables[0],this.ViewModel.PostDataFetchFilterFields),this.addTrialBalance());this.LoadReportComplete()}addGeneralLedger(){for(let e=0;e<this.oColumns.length;e++)this.AggTotal[e][1]=0,this.AggTotal[e][2]=0,this.AggTotal[e][3]=0;if(this.k=0,this.IsNewAccount&&this.ViewModel.lstGroup.length>0&&this.ViewModel.lstGroup[0].GroupAppearance.IsVisible&&(this.GrdRow++,this.ViewModel.lstGroupIndex.push(this.GrdRow),this.row=this.NewReportRow_2(n.f.Group,this.ViewModel.lstGroup[0].GroupAppearance),this.ViewModel.lstGroup[0].Height>0&&(this.row.Height=this.ViewModel.lstGroup[0].Height),this.row.PrintVisible=this.ViewModel.lstGroup[0].GroupAppearance.IsPrintVisible,this.row.NodeID=parseInt(this.strAccountID),this.ViewModel.FormulasCalculated||i.e.IsEmpty(this.ViewModel.lstGroup[0].Formula)||(this.ViewModel.CalculateFormula_2(this.ViewModel.lstGroup[0],this.dsAccount.Tables[0][this.jAccount]),this.strAccountName=i.e.String(this.dsAccount.Tables[0][this.jAccount][this.ViewModel.lstGroup[0].ID])),this.row.Cells[0].Text=this.strAccountName,this.row.Cells[0].ColSpan=this.row.Cells.length,this.row.LevelNo=0,this.Balance=0,this.ViewModel.addRow(this.row),this.IsNewAccount=!1),this.ViewModel.lstGroup.length>1&&(this.GrdRow++,this.row=this.NewReportRow_2(n.f.Group,this.ViewModel.lstGroup[1].GroupAppearance),this.ViewModel.lstGroup[1].Height>0&&(this.row.Height=this.ViewModel.lstGroup[1].Height),this.row.PrintVisible=this.ViewModel.lstGroup[1].GroupAppearance.IsPrintVisible,this.row.Cells[0].Text=this.ViewModel.lstGroup[1].Prefix+this.strTagName,this.row.Cells[0].ColSpan=this.row.Cells.length,this.row.LevelNo=1,this.Balance=0,this.ViewModel.addRow(this.row)),this.Balance=0,0!=this.OpBalance){let e;this.GrdRow++,this.Balance=this.OpBalance,this.row=this.NewReportRow_2(n.f.BalanceBF,this.BalanceBFAppearance),this.row.LevelNo=this.ViewModel.lstGroup.length,e=this.row.Cells[0],e.ColSpan=this.colSpanBF,e.Text=o.a.GetResource("Reports_OpeningBalance"),-1!=this.colBalanceIndex?(this.AggTotal[this.colBalanceIndex][1]=this.OpBalance,this.row.Cells[this.colBalanceIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(this.Balance,this.oColumns[this.colBalanceIndex].DataFormat,"FLOAT",this.row.Cells[this.colBalanceIndex])):this.AggTotal[this.AggTotal.length-1][1]=this.OpBalance,this.colDebitIndex>-1&&this.OpBalance>0&&(this.row.Cells[this.colDebitIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(this.OpBalance,this.oColumns[this.colDebitIndex].DataFormat,"FLOAT",this.row.Cells[this.colDebitIndex]),this.IncludeBFInTotals&&(this.AggTotal[this.colDebitIndex][1]=this.OpBalance)),this.colCreditIndex>-1&&this.OpBalance<0&&(this.row.Cells[this.colCreditIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(-this.OpBalance,this.oColumns[this.colCreditIndex].DataFormat,"FLOAT",this.row.Cells[this.colCreditIndex]),this.IncludeBFInTotals&&(this.AggTotal[this.colCreditIndex][1]=-this.OpBalance)),-1!=this.colLocalAmtInd&&this.dvAccount.length>0&&!i.e.IsEmpty(this.dvAccount[0].LocalAmount)&&(this.dbl=parseFloat(this.dvAccount[0].LocalAmount),this.AggTotal[this.colLocalAmtInd][1]=this.dbl,this.row.Cells[this.colLocalAmtInd].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.colLocalAmtInd].DataFormat,"FLOAT",this.row.Cells[this.colLocalAmtInd])),this.ShowTagWise?this.TagCols.forEach(e=>{let t=this.oColumns.indexOf(e);this.dvAccount[0][e.ID]&&(this.dbl=parseFloat(this.dvAccount[0][e.ID]),this.row.Cells[t].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(this.dbl,this.oColumns[t].DataFormat,"FLOAT",this.row.Cells[t]),this.IncludeBFInTotals&&(this.AggTotal[t][1]=this.dbl))}):-1==this.CurrencyType&&this.TagCols.forEach(e=>{let t=this.oColumns.indexOf(e);null!=this.dvAccount[0][e.ID]&&(this.dbl=parseInt(this.dvAccount[0][e.ID]),this.dbl=this.ViewModel.RoundOff(this.dbl,this.oColumns[t].DataFormat),this.row.Cells[t].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(this.dbl,this.oColumns[t].DataFormat,"FLOAT",this.row.Cells[t]),this.IncludeBFInTotals&&(this.AggTotal[t][1]=this.dbl),this.dbl>0&&(t-=2,this.dbl=this.ViewModel.RoundOff(this.dbl,this.oColumns[t].DataFormat),this.row.Cells[t].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(this.dbl,this.oColumns[t].DataFormat,"FLOAT",this.row.Cells[t]),this.IncludeBFInTotals&&(this.AggTotal[t][1]=this.dbl)),this.dbl<0&&(t-=1,this.dbl=this.ViewModel.RoundOff(this.dbl,this.oColumns[t].DataFormat),this.row.Cells[t].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(-this.dbl,this.oColumns[t].DataFormat,"FLOAT",this.row.Cells[t]),this.IncludeBFInTotals&&(this.AggTotal[t][1]=-this.dbl)))}),this.ViewModel.addRow(this.row)}if(1==this.ViewModel.StaticReportType&&(this.UnPostedDocsInclude&&this.UnPostedDocsSeparately||this.PDCInclude&&this.PDCSeperate)?this.dv.length>0&&this.AddRowsWithSubTotal(""):this.AddRows(),this.UnPostedDocsInclude&&this.UnPostedDocsSeparately)if(this.UnPostedDocsSeparatelyByStatus)for(let e=0;e<this.arrUnPostedStatuses.length;e++)this.dv=this.dvTable.filter(t=>(Object(h.isUndefined)(this.strAccountFilterObj.AccountID)||t.AccountID==this.strAccountFilterObj.AccountID)&&t.StatusID==this.arrUnPostedStatusesID[e]),this.dv.length>0&&(this.GrdRow++,this.row=this.NewReportRow_2(n.f.GrossTotal,this.GrossTotalAppearance),this.row.LevelNo=this.ViewModel.lstGroup.length,this.row.Cells[0].ColSpan=this.ViewModel.ReportColumns.length,this.row.Cells[0].Text=this.arrUnPostedStatuses[e],this.ViewModel.addRow(this.row),this.AddRowsWithSubTotal(this.row.Cells[0].Text));else this.dv=this.dvTable.filter(e=>(Object(h.isUndefined)(this.strAccountFilterObj.AccountID)||e.AccountID==this.strAccountFilterObj.AccountID)&&369!=e.StatusID&&429!=e.StatusID),this.dv.length>0&&(this.GrdRow++,this.row=this.NewReportRow_2(n.f.GrossTotal,this.GrossTotalAppearance),this.row.LevelNo=this.ViewModel.lstGroup.length,this.row.Cells[0].ColSpan=this.ViewModel.ReportColumns.length,this.row.Cells[0].Text=o.a.GetResource("Reports_LblUnPostedDocs"),this.ViewModel.addRow(this.row),this.AddRowsWithSubTotal(this.row.Cells[0].Text));if(this.PDCInclude&&this.PDCSeperate&&(this.AddPDCRows(370),this.IncludeTerminatedPDC&&this.AddPDCRows(452)),this.Balance=0,this.IsRetainedEarning){let e;this.GrdRow++,this.row=this.NewReportRow_2(n.f.BalanceBF,this.BalanceBFAppearance),this.row.LevelNo=this.ViewModel.lstGroup.length,e=this.row.Cells[0],e.ColSpan=this.colSpanBF,e.Text="Retained Earning For The Priod",-1!=this.colBalanceIndex?(this.AggTotal[this.colBalanceIndex][1]+=this.GLRetainedAccounts[this.strAccountID],this.row.Cells[this.colBalanceIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(this.AggTotal[this.colBalanceIndex][1],this.oColumns[this.colBalanceIndex].DataFormat,"FLOAT",this.row.Cells[this.colBalanceIndex])):this.AggTotal[this.AggTotal.length-1][1]+=this.GLRetainedAccounts[this.strAccountID],this.colDebitIndex>-1&&this.GLRetainedAccounts[this.strAccountID]>0&&(this.row.Cells[this.colDebitIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(this.GLRetainedAccounts[this.strAccountID],this.oColumns[this.colDebitIndex].DataFormat,"FLOAT",this.row.Cells[this.colDebitIndex]),this.AggTotal[this.colDebitIndex][1]+=this.GLRetainedAccounts[this.strAccountID]),this.colCreditIndex>-1&&this.GLRetainedAccounts[this.strAccountID]<0&&(this.row.Cells[this.colCreditIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(-this.GLRetainedAccounts[this.strAccountID],this.oColumns[this.colCreditIndex].DataFormat,"FLOAT",this.row.Cells[this.colCreditIndex]),this.AggTotal[this.colCreditIndex][1]=this.AggTotal[this.colCreditIndex][1]-this.GLRetainedAccounts[this.strAccountID]),this.ViewModel.addRow(this.row)}if(this.ShowUnInvoicedAmount&&null!=this.dsAccount.Tables[0][this.jAccount].UnInvoicedAmount){let e;this.GrdRow++,this.row=this.NewReportRow_2(n.f.BalanceBF,this.BalanceBFAppearance),this.row.LevelNo=this.ViewModel.lstGroup.length,e=this.row.Cells[0],e.ColSpan=this.colSpanBF,e.Text="Un-Invoiced Amount",this.dbl=parseFloat(this.dsAccount.Tables[0][this.jAccount].UnInvoicedAmount),this.colDebitIndex>-1&&(this.row.Cells[this.colDebitIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.colDebitIndex].DataFormat,"FLOAT",this.row.Cells[this.colDebitIndex])),this.ViewModel.addRow(this.row)}for(let e=0;e<this.oColumns.length;e++)"INT"!=this.oColumns[e].ColumnType&&"FLOAT"!=this.oColumns[e].ColumnType||(this.AggTotal[e][0]+=this.AggTotal[e][1],this.AggTotal[e][4]+=this.AggTotal[e][1]);return 2==this.ViewModel.lstGroup.length?this.ViewModel.lstGroup[1].SubTotalAppearance.IsVisible&&this.AddSubTotal(this.strTagName,1):this.STAccountWise&&this.AddSubTotal(this.strAccountName,1),0}addGL_DimWiseSummary(){for(let e=0;e<this.oColumns.length;e++)this.AggTotal[e][1]=0,this.AggTotal[e][2]=0,this.AggTotal[e][3]=0;for(this.k=0,this.IsNewAccount&&this.ViewModel.lstGroup.length>0&&this.ViewModel.lstGroup[0].GroupAppearance.IsVisible&&(this.GrdRow++,this.ViewModel.lstGroupIndex.push(this.GrdRow),this.row=this.NewReportRow_2(n.f.Group,this.ViewModel.lstGroup[0].GroupAppearance),this.row.PrintVisible=this.ViewModel.lstGroup[0].GroupAppearance.IsPrintVisible,this.row.NodeID=parseInt(this.strAccountID),this.ViewModel.FormulasCalculated||i.e.IsEmpty(this.ViewModel.lstGroup[0].Formula)||(this.ViewModel.CalculateFormula_2(this.ViewModel.lstGroup[0],this.dsAccount.Tables[0][this.jAccount]),this.strAccountName=i.e.String(this.dsAccount.Tables[0][this.jAccount][this.ViewModel.lstGroup[0].ID])),this.row.Cells[0].Text=this.strAccountName,this.row.Cells[0].ColSpan=this.row.Cells.length,this.row.LevelNo=0,this.Balance=0,this.ViewModel.addRow(this.row),this.IsNewAccount=!1),this.ViewModel.lstGroup.length>1&&(this.GrdRow++,this.row=this.NewReportRow_2(n.f.Group,this.ViewModel.lstGroup[1].GroupAppearance),this.row.PrintVisible=this.ViewModel.lstGroup[1].GroupAppearance.IsPrintVisible,this.row.Cells[0].Text=this.ViewModel.lstGroup[1].Prefix+this.strTagName,this.row.Cells[0].ColSpan=this.row.Cells.length,this.row.LevelNo=1,this.Balance=0,this.ViewModel.addRow(this.row)),this.k=0;this.k<this.dv.length;this.k++){this.TBTransactionsDrCrSeperately||this.dvColumns.Contains("Debit")&&this.dvColumns.Contains("Credit")&&(i.e.IsNum(this.dv[this.k].Debit)&&(this.dbl=i.e.Double(this.dv[this.k].Debit),this.dbl<0&&(this.dv[this.k].Debit=null,this.dv[this.k].Credit=-this.dbl)),i.e.IsNum(this.dv[this.k].Credit)&&(this.dbl=i.e.Double(this.dv[this.k].Credit),this.dbl<0&&(this.dv[this.k].Debit=-this.dbl,this.dv[this.k].Credit=null))),this.rows.Clear(),this.GrdRow++,this.rows.push(new n.d(this.oColumns.length,this.ViewModel.RowHeight)),this.rows[this.rows.length-1].Type=n.f.Detail,this.rows[0].DataRow=this.dv[this.k],this.rows[0].NodeID=86==this.ViewModel.StaticReportType?parseInt(this.dv[this.k].AccountID):parseInt(this.dv[this.k].ParticularID);for(let e=0;e<this.oColumns.length;e++){if(this.oColumns[e].Row>0){if(this.rows.length-1<this.oColumns[e].Row)for(let t=0;t<=this.oColumns[e].Row;t++)this.rows.length-1<t&&(this.GrdRow++,this.rows.push(new n.d(this.oColumns.length,this.ViewModel.RowHeight)),this.rows[this.rows.length-1].Type=n.f.Detail);this.Row=this.oColumns[e].Row,this.Col=this.oColumns[e].Column}else this.Row=0,this.Col=e;let t="";""!=this.oColumns[e].Formula?t=this.ViewModel.CalculateFormula_1(this.oColumns[e].Formula,this.dv[this.k],this.rows):this.dvColumns.Contains(this.oColumns[e].ID)&&(t=i.e.String(this.dv[this.k][this.oColumns[e].ID])),""!=t&&(this.ViewModel.SetCellValue(t,this.oColumns[e].DataFormat,this.oColumns[e].ColumnType,this.rows[this.Row].Cells[this.Col]),this.ViewModel.TotalCols.Contains(this.oColumns[e].ID)&&i.e.IsNum(t)&&(this.dbl=i.e.Double(t),this.AggTotal[e][1]+=this.dbl,this.AggTotal[e][2]+=this.dbl,this.AggTotal[e][3]+=this.dbl))}-1!=this.ViewModel.colSNoIndex&&(this.rows[0].Cells[this.ViewModel.colSNoIndex].Value=++this.ViewModel.SNo,this.rows[0].Cells[this.ViewModel.colSNoIndex].Text=this.ViewModel.SNo.toString()),this.ViewModel.ApplyKPI(this.rows[0]);for(let e=0;e<this.rows.length;e++){let t=this.rows[e];this.ViewModel.HideEmptyRows&&!t.Cells.find(e=>!i.e.IsEmptySpace(e.Text))||(t.LevelNo=this.ViewModel.lstGroup.length,this.ViewModel.addRow(t))}}for(let e=0;e<this.oColumns.length;e++)"INT"!=this.oColumns[e].ColumnType&&"FLOAT"!=this.oColumns[e].ColumnType||(this.AggTotal[e][0]+=this.AggTotal[e][1],this.AggTotal[e][4]+=this.AggTotal[e][1]);return this.STAccountWise&&this.AddSubTotal(this.strAccountName,1),0}AddRows(){let e,t=Date.Today();if(86==this.ViewModel.StaticReportType&&-100==this.TagID)this.dv.SortBy(["DocumentName"]);else if(!this.GLSortTransactions&&0==this.GLClubTranBy){let e;"6"==this.strAccountType?this.dvColumns.Contains("IsDr")?(e=["DocDate",{name:"IsDr",parser:l.j},"VoucherNo"],this.dvColumns.Contains("DocSeqNo")&&e.push("DocSeqNo")):e=["DocDate","DiffDrCr"]:"1"!=this.strAccountType&&"2"!=this.strAccountType&&"3"!=this.strAccountType&&"7"!=this.strAccountType&&"10"!=this.strAccountType&&"13"!=this.strAccountType||(this.dvColumns.Contains("IsDr")?(e=["DocDate",{name:"IsDr",parser:l.j,desc:!0},"VoucherNo"],this.dvColumns.Contains("DocSeqNo")&&e.push("DocSeqNo")):e=["DocDate",{name:"DiffDrCr",desc:!0}]),e&&this.dv.SortBy(e)}let s="";for(this.k=0;this.k<this.dv.length;this.k++){if(this.dv[this.k].DocDate?(e=new Date(this.dv[this.k].DocDate),1==this.GLClubTranBy?this.dv[this.k].Particular=e.ToString("dd-MMM-yyyy"):2==this.GLClubTranBy&&(this.dv[this.k].Particular=e.ToString("MMM-yyyy"))):e=new Date(1900,0,1),this.k>0&&(this.STDayWise&&e!=t&&this.AddSubTotal(t.ToString(o.a.SessionManager.Preferences["Date Format"]),3),this.STMonthWise&&(e.getMonth()==t.getMonth()&&e.getFullYear()==t.getFullYear()||this.AddSubTotal(t.ToString("MMM yy"),2))),t=e,this.dbl=i.e.Double(this.dv[this.k].DiffDrCr),this.ShowTagWise)try{this.dv[this.k]["TAG"+i.e.String(this.dv[this.k].TagID)]=this.dbl}catch(a){}else if(-1==this.CurrencyType)try{this.dbl>0?(this.dv[this.k]["CURRDR"+this.dv[this.k].CurrencyID.ToString()]=this.dbl,this.dv[this.k]["CURRCR"+this.dv[this.k].CurrencyID.ToString()]=null):(this.dv[this.k]["CURRDR"+this.dv[this.k].CurrencyID.ToString()]=null,this.dv[this.k]["CURRCR"+this.dv[this.k].CurrencyID.ToString()]=-this.dbl),this.TagCols.forEach(e=>{let t=this.oColumns.indexOf(e);e.ID=="CURRBL"+this.dv[this.k].CurrencyID.ToString()?(this.dv[this.k][e.ID]=this.AggTotal[t][1]+this.dbl,this.AggTotal[t][1]=this.AggTotal[t][1]+this.dbl,this.AggTotal[t][2]=this.AggTotal[t][2]+this.dbl,this.AggTotal[t][3]=this.AggTotal[t][3]+this.dbl):e.ID.startsWith("CURRBL")&&(this.dv[this.k][e.ID]=this.AggTotal[t][1])})}catch(r){}this.TBTransactionsDrCrSeperately||(this.dbl>0?(this.dv[this.k].Debit=this.dbl,this.dv[this.k].Credit=null):(this.dv[this.k].Debit=null,this.dv[this.k].Credit=-this.dbl)),this.Balance=this.Balance+this.dbl,this.colBalanceIndex>=0&&(this.dv[this.k].Balance=this.Balance,this.AggTotal[this.colBalanceIndex][1]=this.Balance,this.AggTotal[this.colBalanceIndex][2]=this.Balance,this.AggTotal[this.colBalanceIndex][3]=this.Balance),this.rows.Clear(),this.GrdRow++,this.rows.push(new n.d(this.oColumns.length,this.ViewModel.RowHeight)),this.rows[this.rows.length-1].Type=n.f.Detail,this.rows[0].DataRow=this.dv[this.k],86==this.ViewModel.StaticReportType||156==this.ViewModel.StaticReportType?this.rows[0].NodeID=parseInt(this.dv[this.k].AccountID):null!=this.dv[this.k].ParticularID&&(this.rows[0].NodeID=parseInt(this.dv[this.k].ParticularID));for(let e=0;e<this.oColumns.length;e++){if(this.oColumns[e].Row>0){if(this.rows.length-1<this.oColumns[e].Row)for(let t=0;t<=this.oColumns[e].Row;t++)this.rows.length-1<t&&(this.GrdRow++,this.rows.push(new n.d(this.oColumns.length,this.ViewModel.SubRowHeight)),this.rows[this.rows.length-1].Type=n.f.Detail);this.Row=this.oColumns[e].Row,this.Col=this.oColumns[e].Column}else this.Row=0,this.Col=e;s="",""!=this.oColumns[e].Formula?(s=this.ViewModel.CalculateFormula_1(this.oColumns[e].Formula,this.dv[this.k],this.rows),""!=s&&this.dvColumns.Contains(this.oColumns[e].ID)&&(this.dv[this.k][this.oColumns[e].ID]=s)):this.dvColumns.Contains(this.oColumns[e].ID)&&(s=i.e.String(this.dv[this.k][this.oColumns[e].ID])),""!=s&&("Balance"!=this.oColumns[e].ID&&!this.oColumns[e].ID.startsWith("CURRBL")&&this.ViewModel.TotalCols.Contains(this.oColumns[e].ID)&&i.e.IsNum(s)&&(this.dbl=i.e.Double(s),this.AggTotal[e][1]+=this.dbl,this.AggTotal[e][2]+=this.dbl,this.AggTotal[e][3]+=this.dbl),-1!=this.oColumns[e].DataFormat.CumTotal&&(s=this.AggTotal[e][1].toString()),this.ViewModel.SetCellValue(s,this.oColumns[e].DataFormat,this.oColumns[e].ColumnType,this.rows[this.Row].Cells[this.Col]))}if(-1!=this.ViewModel.colSNoIndex&&(this.rows[0].Cells[this.ViewModel.colSNoIndex].Value=++this.ViewModel.SNo,this.rows[0].Cells[this.ViewModel.colSNoIndex].Text=this.ViewModel.SNo.toString()),this.ViewModel.ApplyKPI(this.rows[0]),1==this.ViewModel.StaticReportType&&this.dicInvRows.length>0&&this.dicInvRows.ContainsKey(this.dv[this.k].VoucherNo.toString())){let e=this.dicInvRows[this.dv[this.k].VoucherNo.toString()];for(let t=0;t<e.length;t++){t>=this.rows.length&&(this.GrdRow++,this.rows.push(new n.d(this.oColumns.length,this.ViewModel.SubRowHeight)),this.rows[this.rows.length-1].Type=n.f.Detail);for(let s=0;s<this.oColumns.length;s++){let o="";"VoucherNo"!=this.oColumns[s].ID&&(o=i.e.String(e[t][this.oColumns[s].ID])),""!=o&&this.ViewModel.SetCellValue(o,this.oColumns[s].DataFormat,this.oColumns[s].ColumnType,this.rows[t].Cells[s])}}}for(let e=0;e<this.rows.length;e++){let t=this.rows[e];!this.ViewModel.HideEmptyRows||t.Cells.find(e=>!i.e.IsEmptySpace(e.Text))?(t.LevelNo=this.ViewModel.lstGroup.length,this.ViewModel.addRow(t)):this.GrdRow--}}this.dv.length>0&&(this.STMonthWise||this.STDayWise)&&(this.STDayWise&&this.AddSubTotal(t.ToString(o.a.SessionManager.Preferences["Date Format"]),3),this.STMonthWise&&this.AddSubTotal(t.ToString("MMM yy"),2))}GetBalance(){let e=this.OpBalance;if(this.dv.length>0){let t=this.dv.Compute("sum","Debit");null!=t&&(e+=parseFloat(t)),t=this.dv.Compute("sum","Credit"),null!=t&&(e-=parseFloat(t))}if(this.dvTbl2&&this.dvTbl2.length>0){let t=this.dvTbl2.Compute("sum","Debit");null!=t&&(e+=parseFloat(t)),t=this.dvTbl2.Compute("sum","Credit"),null!=t&&(e-=parseFloat(t))}return parseFloat(Math.abs(e).ToString("N2"))<.01&&(e=0),e}GetBalance_GLSummary(){let e=0;for(let t=1;t<this.ds.Tables.length;t++){let s=this.ds.Tables[t].Compute("sum","Balance",this.strAccountFilter);null!=s&&(e+=parseFloat(s))}return parseFloat(Math.abs(e).ToString("N2"))<.01&&(e=0),e}AddSubTotal(e,t){if(this.colSubTotalStartIndex>=0&&this.ViewModel.lstGroup[0].SubTotalAppearance.IsVisible){this.GrdRow++,this.row=this.NewReportRow_2(n.f.SubTotal,this.ViewModel.lstGroup[0].SubTotalAppearance),this.row.LevelNo=1;for(let e=0;e<this.oColumns.length;e++)this.ViewModel.lstGroup[0].TotalCols.ContainsKey(this.oColumns[e].ID)&&(this.ViewModel.SetCellValue(this.AggTotal[e][t],this.oColumns[e].DataFormat,"FLOAT",this.row.Cells[e]),this.row.Cells[e].CellAppearance.Alignment="Right",this.AggTotal[e][t]=0);let s=this.row.Cells[0];1==t&&this.ViewModel.lstGroup.length>0?1==this.ViewModel.lstGroup[0].SubTotalShowCaption?s.Text=o.a.GetResource("Reports_SubTotal")+" ("+e+")":2==this.ViewModel.lstGroup[0].SubTotalShowCaption?s.Text=o.a.GetResource("Reports_SubTotal"):10==this.ViewModel.lstGroup[0].SubTotalShowCaption&&(s.Text=e):s.Text=o.a.GetResource("Reports_SubTotal")+" ("+e+")",this.colSubTotalStartIndex>=0&&(s.ColSpan=this.colSubTotalStartIndex),this.ViewModel.addRow(this.row)}}SetRetainedEarnings(){if(this.strRetainedAccounts="",this.OpenCompany){for(let t=0;t<this.ViewModel.oReportDialog.CostCenterFilters.length;t++){let e=this.ViewModel.oReportDialog.CostCenterFilters[t];if(e.CostCenterID>5e4&&50002!=e.CostCenterID&&e.SelectedNodes.length>0&&0==e.SelectedNodes.filter(e=>0==e.Id||1==e.Id).length)return}let e=this.ViewModel.oReportDialog.FromDate.Date;this.DontShowREforPeriodInAssignedAccount&&(e=new Date(this.ViewModel.oReportDialog.FromDate.Date.getFullYear(),this.AccountingFromMonth-1,1),e>this.ViewModel.oReportDialog.FromDate.Date&&(e=e.AddYears(-1))),this.promiseRE=o.a.report.GetOpenCompanyData(this.ViewModel.StaticReportType,e,this.ViewModel.oReportDialog.ToDate.Date,0,this.LocationWhere,!1,this.UnPostedDocsList,this.PDCInclude,this.IncludeTerminatedPDC,"",this.CurrencyType,this.ForeignCurrencyID,this.exchRate,this.ViewModel.IsReportDB).then(e=>{if(this.dsOpenCompany=e,this.dsOpenCompany.Columns[this.dsOpenCompany.Tables.length-1].Contains("PreviousYearEndDate")&&this.dsOpenCompany.Tables[this.dsOpenCompany.Tables.length-1].length>0&&this.dsOpenCompany.Tables[this.dsOpenCompany.Tables.length-1][0].PreviousYearEndDate&&(this.dtOpenCompanyYearStart=new Date(this.dsOpenCompany.Tables[this.dsOpenCompany.Tables.length-1][0].PreviousYearEndDate),this.dtOpenCompanyYearStart=this.dtOpenCompanyYearStart.AddDays(1),this.ViewModel.oReportDialog.FromDate.Date.Subtract(this.dtOpenCompanyYearStart).Days<1&&(this.dtOpenCompanyYearStart=null)),this.dsOpenCompany.Tables[0].forEach(e=>{this.strAccountID=e.AccountID.toString(),this.dbl=parseFloat(e.Dr)-parseFloat(e.Cr),this.GLRetainedAccounts.ContainsKey(this.strAccountID)?this.GLRetainedAccounts[this.strAccountID]+=this.dbl:this.GLRetainedAccounts.push(this.strAccountID,this.dbl)}),!this.ViewModel.oReportDialog.IsZeroSelected&&!this.ViewModel.oReportDialog.IsOneSelected&&null!=this.ViewModel.oReportDialog.DefaultTreeSelectedNodes)for(let t=this.GLRetainedAccounts.keys.length-1;t>=0;t--)0==this.ViewModel.oReportDialog.DefaultTreeSelectedNodes.filter(e=>e.Id==parseInt(this.GLRetainedAccounts.keys[t])).length&&this.GLRetainedAccounts.Remove(this.GLRetainedAccounts.keys[t]);for(let t=this.GLRetainedAccounts.keys.length-1;t>=0;t--)this.strRetainedAccounts.length>0&&(this.strRetainedAccounts+=","),this.strRetainedAccounts+=this.GLRetainedAccounts.keys[t]})}else Object(l.j)(o.a.SessionManager.Preferences.OpenCompany)&&(this.dtOpenCompanyYearStart=new Date(this.ViewModel.oReportDialog.FromDate.Date.getFullYear(),this.AccountingFromMonth-1,1),this.dtOpenCompanyYearStart>this.ViewModel.oReportDialog.FromDate.Date&&(this.dtOpenCompanyYearStart=this.dtOpenCompanyYearStart.AddYears(-1)))}AddPDCRows(e){this.dvTbl2=this.ds.Tables[2].filter(370==e?e=>(Object(h.isUndefined)(this.strAccountFilterObj.AccountID)||e.AccountID==this.strAccountFilterObj.AccountID)&&452!=e.StatusID:t=>(Object(h.isUndefined)(this.strAccountFilterObj.AccountID)||t.AccountID==this.strAccountFilterObj.AccountID)&&t.StatusID==e),this.dvTbl2.length>0&&(this.GrdRow++,this.row=this.NewReportRow_2(n.f.GrossTotal,this.GrossTotalAppearance),this.row.LevelNo=this.ViewModel.lstGroup.length,this.row.Cells[0].ColSpan=this.ViewModel.ReportColumns.length,this.row.Cells[0].Text=o.a.GetResource(452==e?"Reports_TerminatedPDCList":"Reports_PDCList"),this.ViewModel.addRow(this.row),this.dv=this.dvTbl2,this.dvColumns=this.dvTbl2Columns,this.PDCDrCrSeperate?(this.ShowPDCPaymentsFirst?["Payments","Receipts"]:["Receipts","Payments"]).forEach(e=>{this.dv=this.dvTbl2.filter("Receipts"==e?e=>19==e.VType:e=>14==e.VType),this.dv.length>0&&(this.GrdRow++,this.row=this.NewReportRow_2(n.f.GrossTotal,this.GrossTotalAppearance),this.row.LevelNo=this.ViewModel.lstGroup.length,this.row.Cells[0].ColSpan=this.oColumns.length,this.row.Cells[0].Text=o.a.GetResource("Reports_"+e),this.ViewModel.addRow(this.row),this.AddRowsWithSubTotal(o.a.GetResource("Reports_PDC"+e)))}):this.AddRowsWithSubTotal(this.row.Cells[0].Text))}AddRowsWithSubTotal(e){if(this.HideSectionSubTotal)this.AddRows();else{let t=new Array(this.AggTotal.length).fill(0);for(let e=0;e<t.length;e++)t[e]=this.AggTotal[e][1];this.AddRows();for(let e=0;e<t.length;e++)t[e]=this.AggTotal[e][1]-t[e];if(this.colSubTotalStartIndex>=0){this.GrdRow++,this.row=this.NewReportRow_2(n.f.SubTotal,this.ViewModel.lstGroup[0].SubTotalAppearance),this.row.LevelNo=1;for(let e=0;e<this.oColumns.length;e++)this.ViewModel.lstGroup[0].TotalCols.ContainsKey(this.oColumns[e].ID)&&(this.ViewModel.SetCellValue("Balance"==this.oColumns[e].ID?this.Balance:t[e],this.oColumns[e].DataFormat,"FLOAT",this.row.Cells[e]),this.row.Cells[e].CellAppearance.Alignment="Right");this.row.Cells[0].Text=e.length>0?o.a.GetResource("Reports_SubTotal")+" ("+e+")":o.a.GetResource("Reports_SubTotal"),this.colSubTotalStartIndex>=0&&(this.row.Cells[0].ColSpan=this.colSubTotalStartIndex),this.ViewModel.addRow(this.row)}}}SetParticularsData(e){e.Tables.length>1&&e.Columns[1].Contains("Debit")&&e.Columns[1].Contains("DiffDrCr")&&(e.Columns[1].push("IsDr"),e.Tables[1].forEach(e=>{this.dbl=i.e.Double(e.DiffDrCr),e.IsDr=this.dbl>0})),e.Tables.length>2&&e.Columns[2].Contains("Debit")&&e.Columns[2].Contains("DiffDrCr")&&(e.Columns[2].push("IsDr"),e.Tables[2].forEach(e=>{this.dbl=i.e.Double(e.DiffDrCr),e.IsDr=this.dbl>0}));try{if(!this.ViewModel.DocumentFilters.ContainsKey("GLParticularSelect")||0==this.ViewModel.DocumentFilters.GLParticularSelect.length)return;let t="";if(e.Tables[1].forEach(e=>{this.lstParticularID.Contains(parseInt(e.ParticularID))||(t.length>0&&(t+=","),t+=e.ParticularID.toString(),this.lstParticularID.push(parseInt(e.ParticularID)))}),e.Tables.length>2&&e.Tables[2].forEach(e=>{this.lstParticularID.Contains(parseInt(e.ParticularID))||(t.length>0&&(t+=","),t+=e.ParticularID.toString(),this.lstParticularID.push(parseInt(e.ParticularID)))}),t.length>0){let e=o.a.report.ReportDataSet("RTP022",this.ViewModel.IsReportDB,"select "+this.ViewModel.DocumentFilters.GLParticularSelect+" from "+this.ViewModel.DocumentFilters.GLParticularFrom+" where A.accountid in ("+t+")");null==this.dtParticulars?(this.dtParticulars=e.Tables[0],this.dtParticularsColumns=e.Columns[0]):this.dtParticulars.AddRange(e.Tables[0])}if(null!=this.dtParticulars){for(let s=1;s<this.dtParticularsColumns.length;s++)e.Columns[1].Contains(this.dtParticularsColumns[s])||e.Columns[1].push(this.dtParticularsColumns[s]),e.Tables.length>2&&(e.Columns[2].Contains(this.dtParticularsColumns[s])||e.Columns[2].push(this.dtParticularsColumns[s]));let t;e.Tables[1].forEach(e=>{if(t=this.dtParticulars.filter(t=>t.AccountID==e.ParticularID),t.length>0)for(let s=1;s<this.dtParticularsColumns.length;s++)e[this.dtParticularsColumns[s]]=t[0][this.dtParticularsColumns[s]]}),e.Tables.length>2&&e.Tables[2].forEach(e=>{if(t=this.dtParticulars.filter(t=>t.AccountID==e.ParticularID),t.length>0)for(let s=1;s<this.dtParticularsColumns.length;s++)e[this.dtParticularsColumns[s]]=t[0][this.dtParticularsColumns[s]]})}}catch(t){Logger.ErrorLog("SetParticularsData: ",t)}}addCashBookAndBankBook(){try{for(let t=0;t<this.oColumns.length;t++)this.AggTotal[t][1]=0;"Monthly"==this.ViewModel.Preferences.Balancing&&this.UpdateCashBookDateByMonthly();let e=-1;if(this.ViewModel.lstGroup.length>0&&(this.GrdRow++,this.ViewModel.lstGroupIndex.push(this.ViewModel.Data.length),this.row=this.NewReportRow_2(n.f.Group,this.ViewModel.lstGroup[0].GroupAppearance),this.ViewModel.lstGroup[0].Height>0&&(this.row.Height=this.ViewModel.lstGroup[0].Height),this.row.LevelNo=0,this.row.Cells[0].Text=this.strAccountName,this.row.NodeID=parseInt(this.strAccountID),this.row.Cells[0].ColSpan=5,this.ViewModel.addRow(this.row),e=this.ViewModel.Data.length-1,this.Balance=0),this.Balance=0,0!=this.OpBalance&&(this.GrdRow++,this.Balance=this.OpBalance,this.row=this.NewReportRow_2(n.f.BalanceBF,this.BalanceBFAppearance),this.row.LevelNo=1,this.row.Cells[0].ColSpan=this.colSpanBF,this.row.Cells[0].Text=o.a.GetResource("Reports_OpeningBalance"),-1!=this.colBalanceIndex?(this.AggTotal[this.colBalanceIndex][1]=this.OpBalance,this.row.Cells[this.colBalanceIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(this.Balance,this.oColumns[this.colBalanceIndex].DataFormat,"FLOAT",this.row.Cells[this.colBalanceIndex])):this.AggTotal[this.AggTotal.length-1][1]=this.OpBalance,this.colDebitIndex>-1&&this.OpBalance>0&&(this.row.Cells[this.colDebitIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(this.OpBalance,this.oColumns[this.colDebitIndex].DataFormat,"FLOAT",this.row.Cells[this.colDebitIndex]),this.IncludeBFInTotals&&(this.AggTotal[this.colDebitIndex][1]=this.OpBalance)),this.colCreditIndex>-1&&this.OpBalance<0&&(this.row.Cells[this.colCreditIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(-this.OpBalance,this.oColumns[this.colCreditIndex].DataFormat,"FLOAT",this.row.Cells[this.colCreditIndex]),this.IncludeBFInTotals&&(this.AggTotal[this.colCreditIndex][1]=-this.OpBalance)),this.ViewModel.addRow(this.row)),this.k=0,!this.GLSortTransactions&&0==this.GLClubTranBy){let e;"6"==this.strAccountType?this.dvColumns.Contains("IsDr")?(e=["DocDate",{name:"IsDr",parser:l.j},"VoucherNo"],this.dvColumns.Contains("DocSeqNo")&&e.push("DocSeqNo")):e=["DocDate","DiffDrCr"]:"1"!=this.strAccountType&&"2"!=this.strAccountType&&"3"!=this.strAccountType&&"7"!=this.strAccountType&&"10"!=this.strAccountType&&"13"!=this.strAccountType||(this.dvColumns.Contains("IsDr")?(e=["DocDate",{name:"IsDr",parser:l.j,desc:!0},"VoucherNo"],this.dvColumns.Contains("DocSeqNo")&&e.push("DocSeqNo")):e=["DocDate",{name:"DiffDrCr",desc:!0}]),e&&this.dv.SortBy(e)}do{this.addCashBankRecords()}while(this.k<this.dv.length);if(this.ShowGroupHighLowValues&&this.dv.length>0&&e>=0){this.row=this.ViewModel.Data[e];let t=this.row.Cells[0].Text+"   [Low: ";this.ViewModel.SetCellValue(this.dblCBMin,this.oCBFormat,"FLOAT",this.oCBCell),t+=this.oCBCell.Text,t+=" ("+this.dtCBMin.ToString(o.a.SessionManager.Preferences["Date Format"])+")",t+=",   High: ",this.ViewModel.SetCellValue(this.dblCBMax,this.oCBFormat,"FLOAT",this.oCBCell),t+=this.oCBCell.Text,t+=" ("+this.dtCBMax.ToString(o.a.SessionManager.Preferences["Date Format"])+")",t+="]",this.row.Cells[0].Text=t,this.ViewModel.Data.RemoveAt(e),this.ViewModel.insertRowAt(this.row,e)}for(let t=0;t<this.oColumns.length;t++)"FLOAT"==this.oColumns[t].ColumnType&&(this.AggTotal[t][0]+=this.AggTotal[t][1]);return 0}catch(e){return Logger.ErrorLog("ACC_GeneralLedger::Error addCashBookAndBankBook",e),0}}addCashBankRecords(){for(;this.k<this.dv.length;this.k++){if(0==this.k)this.dtDocDate=new Date(this.dv[this.k].DocDate);else if("Daily"==this.ViewModel.Preferences.Balancing){if(+this.dtDocDate!=+new Date(this.dv[this.k].DocDate)){this.dtDocDate=new Date(this.dv[this.k].DocDate);break}}else if("MonthlyDetail"==this.ViewModel.Preferences.Balancing&&+this.dtDocDate.getMonth()!=+new Date(this.dv[this.k].DocDate).getMonth()){this.dtDocDate=new Date(this.dv[this.k].DocDate);break}if(this.GLClubTranBy>0&&(1==this.GLClubTranBy?this.dv[this.k].Particular=this.dtDocDate.ToString("dd-MMM-yyyy"):2==this.GLClubTranBy&&(this.dv[this.k].Particular=this.dtDocDate.ToString("MMM-yyyy"))),this.GrdRow++,"Monthly"==this.ViewModel.Preferences.Balancing){let e=0;this.dbl=i.e.Double(this.dv[this.k].Debit),e=i.e.Double(this.dv[this.k].Credit),this.dbl=this.dbl-e}else this.dbl=i.e.Double(this.dv[this.k].DiffDrCr);this.dbl>0?(this.dv[this.k].Debit=this.dbl,this.dv[this.k].Credit=null):(this.dv[this.k].Debit=null,this.dv[this.k].Credit=-this.dbl),this.Balance=this.Balance+this.dbl,this.dv[this.k].Balance=this.Balance,this.ShowGroupHighLowValues&&(0==this.k?(this.dblCBMin=this.dblCBMax=this.Balance,this.dtCBMin=this.dtCBMax=this.dtDocDate):(this.dblCBMin>this.Balance&&(this.dblCBMin=this.Balance,this.dtCBMin=new Date(this.dv[this.k].DocDate)),this.dblCBMax<this.Balance&&(this.dblCBMax=this.Balance,this.dtCBMax=new Date(this.dv[this.k].DocDate)))),this.rows.Clear(),this.GrdRow++,this.rows.push(new n.d(this.oColumns.length,this.ViewModel.RowHeight)),this.rows[this.rows.length-1].Type=n.f.Detail,this.rows[this.rows.length-1].DataRow=this.dv[this.k],null!=this.dv[this.k].ParticularID&&(this.rows[this.rows.length-1].NodeID=parseInt(this.dv[this.k].ParticularID));for(let e=0;e<this.oColumns.length;e++){if(this.oColumns[e].Row>0&&this.rows.length-1<this.oColumns[e].Row){for(let t=0;t<=this.oColumns[e].Row;t++)this.rows.length-1<t&&(this.GrdRow++,this.rows.push(new n.d(this.oColumns.length,this.ViewModel.SubRowHeight)),this.rows[this.rows.length-1].Type=n.f.Detail,this.rows[this.rows.length-1].DataRow=this.dv[this.k]);this.Row=this.oColumns[e].Row,this.Col=this.oColumns[e].Column}else this.Row=0,this.Col=e;let t="";""!=this.oColumns[e].Formula?t=this.ViewModel.CalculateFormula_1(this.oColumns[e].Formula,this.dv[this.k],this.rows):this.dvColumns.Contains(this.oColumns[e].ID)&&(t=i.e.String(this.dv[this.k][this.oColumns[e].ID])),""!=t&&(this.ViewModel.SetCellValue(t,this.oColumns[e].DataFormat,this.oColumns[e].ColumnType,this.rows[this.Row].Cells[this.Col]),"Balance"!=this.oColumns[e].ID&&this.ViewModel.TotalCols.Contains(this.oColumns[e].ID)&&(this.dbl=i.e.Double(t),this.AggTotal[e][1]+=this.dbl))}-1!=this.ViewModel.colSNoIndex&&(this.rows[0].Cells[this.ViewModel.colSNoIndex].Value=++this.ViewModel.SNo,this.rows[0].Cells[this.ViewModel.colSNoIndex].Text=this.ViewModel.SNo.toString()),this.ViewModel.ApplyKPI(this.rows[0]);for(let e=0;e<this.rows.length;e++){let t=this.rows[e];this.ViewModel.HideEmptyRows&&!t.Cells.find(e=>!i.e.IsEmptySpace(e.Text))||(t.LevelNo=1,this.ViewModel.addRow(t))}this.AggTotal[this.colBalanceIndex][1]=this.Balance}if(this.colSubTotalStartIndex>=0){for(this.GrdRow++,this.row=this.NewReportRow_2(n.f.SubTotal,this.ViewModel.lstGroup[0].SubTotalAppearance),this.row.LevelNo=1,this.i=0;this.i<this.oColumns.length;this.i++)this.ViewModel.lstGroup[0].TotalCols.ContainsKey(this.oColumns[this.i].ID)&&(this.ViewModel.SetCellValue(this.AggTotal[this.i][1],this.oColumns[this.i].DataFormat,"FLOAT",this.row.Cells[this.i]),this.row.Cells[this.i].CellAppearance.Alignment="Right",this.IncludeBFInTotals||(this.AggTotal[this.i][1]=0));this.row.Cells[0].Text=o.a.GetResource("Reports_SubTotal"),this.row.Cells[0].ColSpan=4,this.colSubTotalStartIndex>=0&&(this.row.Cells[0].ColSpan=this.colSubTotalStartIndex),this.ViewModel.addRow(this.row)}2!=this.ViewModel.StaticReportType&&3!=this.ViewModel.StaticReportType||0==this.Balance||(this.GrdRow++,this.row=this.NewReportRow_2(n.f.BalanceBF,this.BalanceBFAppearance),this.row.LevelNo=1,this.row.Cells[0].ColSpan=this.colSpanBF,this.row.Cells[0].Text=o.a.GetResource("Reports_BalanceCF"),this.Balance<0&&(this.row.Cells[0].Text+="*******"),this.colDebitIndex>-1&&this.Balance<0&&(this.row.Cells[this.colDebitIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(-this.Balance,this.oColumns[this.colDebitIndex].DataFormat,"FLOAT",this.row.Cells[this.colDebitIndex])),this.colCreditIndex>-1&&this.Balance>0&&(this.row.Cells[this.colCreditIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(this.Balance,this.oColumns[this.colCreditIndex].DataFormat,"FLOAT",this.row.Cells[this.colCreditIndex])),this.ViewModel.addRow(this.row)),2!=this.ViewModel.StaticReportType&&3!=this.ViewModel.StaticReportType||0==this.Balance||(this.GrdRow++,this.row=this.NewReportRow_2(n.f.BalanceBF,this.BalanceBFAppearance),this.row.LevelNo=1,this.row.Cells[0].ColSpan=this.colSpanBF,this.row.Cells[0].Text=o.a.GetResource("Reports_BalanceBF"),this.colDebitIndex>-1&&this.Balance>0&&(this.row.Cells[this.colDebitIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(this.Balance,this.oColumns[this.colDebitIndex].DataFormat,"FLOAT",this.row.Cells[this.colDebitIndex])),this.colCreditIndex>-1&&this.Balance<0&&(this.row.Cells[this.colCreditIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(-this.Balance,this.oColumns[this.colCreditIndex].DataFormat,"FLOAT",this.row.Cells[this.colCreditIndex])),this.ViewModel.addRow(this.row))}UpdateCashBookDateByMonthly(){let e,t=null;this.dv.length>0&&(this.dtDocDate=new Date(this.dv[this.dv.length-1].DocDate),this.dv[this.dv.length-1].Particular=this.dtDocDate.ToString("MMM-yyyy"),t=new Array(this.oColumns.length).fill(0));for(let o=this.dv.length-2;o>=0;o--)if(e=new Date(this.dv[o].DocDate),this.dtDocDate.getMonth()==e.getMonth()&&e.getFullYear()==this.dtDocDate.getFullYear()){for(let e=0;e<this.oColumns.length;e++)if("FLOAT"==this.oColumns[e].ColumnType)try{this.CellValue=i.e.String(this.dv[o][this.oColumns[e].ID]),""!=this.CellValue&&(t[e]=t[e]+parseFloat(this.CellValue),this.dv[o+1][this.oColumns[e].ID]=t[e])}catch(s){}this.ds.Tables[1].Remove(this.dv[o])}else{this.dtDocDate=e,this.dv[o].Particular=this.dtDocDate.ToString("MMM-yyyy");for(let e=0;e<this.oColumns.length;e++)t[e]=0,"FLOAT"==this.oColumns[e].ColumnType&&(this.CellValue=i.e.String(this.dv[o][this.oColumns[e].ID]),""!=this.CellValue&&(t[e]=parseFloat(this.CellValue)))}}addTrialBalance(){let e,t,s,o,a,r,h,u,D,c,C=0,p=null,T=!1,_=0;for(this.dblMissingOpeningDr=0,this.dblMissingOpeningCr=0,this.lstParents.Clear(),this.lstTotal.Clear(),this.lstParents.push(this.NewReportRow()),this.lstTotal.push(new Array(this.oColumns.length).fill(0)),this.arrTBTotals=new Array(6).fill(0),this.ViewModel.totals=i.e.NumArray(this.oColumns.length,this.ViewModel.lstGroup.length+1),this.k=0;this.k<this.dv.length;this.k++){if(this.strAccountType=this.dv[this.k].AccountTypeID.toString(),!Object(l.j)(this.dv[this.k].IsGroup))if(this.Show==d.TagWise){if(r=0,C=parseInt(this.dv[this.k].AccountID),e=i.e.String(this.dv[this.k].Tag),this.TBGroupID.length>0&&(p=i.e.String(this.dv[this.k][this.TBGroupID])),T=!0,this.TBIsAccountWise&&"-999"==e&&(T=!1,e="",this.dv[this.k].Tag=null),T){for(h=u=D=c=0,e.length>0&&(h=i.e.Double(this.dv[this.k].OP_Dr),u=i.e.Double(this.dv[this.k].OP_Cr),D=i.e.Double(this.dv[this.k].TR_Dr),c=i.e.Double(this.dv[this.k].TR_Cr),r=h+D-(u+c),this.dvColumns.Contains(e)&&(this.dv[this.k][e]=r,this.OpenCompany&&("4"!=this.strAccountType&&"5"!=this.strAccountType&&"8"!=this.strAccountType&&"9"!=this.strAccountType&&"11"!=this.strAccountType&&"12"!=this.strAccountType||(this.dv[this.k][e]=D-c))));this.k+1<this.dv.length&&C==parseInt(this.dv[this.k+1].AccountID)&&(0==this.TBGroupID.length||p==this.dv[this.k+1][this.TBGroupID].toString());)e=this.dv[this.k+1].Tag.toString(),e.length>0&&(t=i.e.Double(this.dv[this.k+1].OP_Dr),s=i.e.Double(this.dv[this.k+1].OP_Cr),o=i.e.Double(this.dv[this.k+1].TR_Dr),a=i.e.Double(this.dv[this.k+1].TR_Cr),r=t+o-(s+a),this.dvColumns.Contains(e)&&(this.dv[this.k][e]=r,this.OpenCompany&&("4"!=this.strAccountType&&"5"!=this.strAccountType&&"8"!=this.strAccountType&&"9"!=this.strAccountType&&"11"!=this.strAccountType&&"12"!=this.strAccountType||(this.dv[this.k][e]=o-a))),h+=t,u+=s,D+=o,c+=a),this.dvTable.Remove(this.dv[this.k+1]);this.dv[this.k].OP_Dr=h,this.dv[this.k].OP_Cr=u,this.dv[this.k].TR_Dr=D,this.dv[this.k].TR_Cr=c}}else if(this.Show==d.MonthWise&&(r=0,C=parseInt(this.dv[this.k].AccountID),e=i.e.String(this.dv[this.k].Tag),this.TBGroupID.length>0&&(p=i.e.String(this.dv[this.k][this.TBGroupID])),T=!0,this.TBIsAccountWise&&"-999"==e&&(T=!1,e="",this.dv[this.k].Tag=null),T)){h=u=D=c=0;let l=0,n=this.lstTags.length-1;for(e.length>0&&(h=i.e.Double(this.dv[this.k].OP_Dr),u=i.e.Double(this.dv[this.k].OP_Cr),D=i.e.Double(this.dv[this.k].TR_Dr),c=i.e.Double(this.dv[this.k].TR_Cr),r=h+D-(u+c),this.dv[this.k]["OPDr"+e]=h-u,this.dv[this.k]["TRDr"+e]=this.dv[this.k].TR_Dr,this.dv[this.k]["TRCr"+e]=this.dv[this.k].TR_Cr,this.OpenCompany&&("4"!=this.strAccountType&&"5"!=this.strAccountType&&"8"!=this.strAccountType&&"9"!=this.strAccountType&&"11"!=this.strAccountType&&"12"!=this.strAccountType||(r=D-c,this.dv[this.k]["OPDr"+e]=null)),this.dv[this.k]["Net"+e]=r,l=r,n=this.lstTags.indexOf(e));this.k+1<this.dv.length&&C==parseInt(this.dv[this.k+1].AccountID)&&(0==this.TBGroupID.length||p==this.dv[this.k+1][this.TBGroupID].toString());){if(e=this.dv[this.k+1].Tag.toString(),n+1<this.lstTags.indexOf(e))for(let o=n+1;o<this.lstTags.indexOf(e);o++)t=l,s=0,this.dv[this.k]["OPDr"+this.lstTags[o]]=t,!this.OpenCompany||"4"!=this.strAccountType&&"5"!=this.strAccountType&&"8"!=this.strAccountType&&"9"!=this.strAccountType&&"11"!=this.strAccountType&&"12"!=this.strAccountType||(this.dv[this.k]["OPDr"+this.lstTags[o]]=null),this.dv[this.k]["Net"+this.lstTags[o]]=l;e.length>0&&(t=l,s=0,o=i.e.Double(this.dv[this.k+1].TR_Dr),a=i.e.Double(this.dv[this.k+1].TR_Cr),this.dv[this.k]["OPDr"+e]=t,this.dv[this.k]["TRDr"+e]=this.dv[this.k+1].TR_Dr,this.dv[this.k]["TRCr"+e]=this.dv[this.k+1].TR_Cr,r=t+o-(s+a),this.dv[this.k]["Net"+e]=r,l=r,D+=o,c+=a,n=this.lstTags.indexOf(e)),this.dvTable.Remove(this.dv[this.k+1])}this.dv[this.k].TR_Dr=D,this.dv[this.k].TR_Cr=c,this.dv[this.k].NetBalance=l;for(let e=n+1;e<this.lstTags.length;e++)t=l,s=0,this.dv[this.k]["OPDr"+this.lstTags[e]]=t,this.dv[this.k]["Net"+this.lstTags[e]]=l}if(-1!=this.YTDIndex&&(this.dvYTD=this.dvYTDTable.filter(e=>e.AccountID==this.dv[this.k].AccountID),this.dvYTD.length>0&&(r=i.e.Double(this.dvYTD[0].Balance),this.dv[this.k].YTD=r)),-1!=this.BAL_LYIndex&&(this.dvBAL_LY=this.dvBAL_LYTable.filter(e=>e.AccountID==this.dv[this.k].AccountID),this.dvBAL_LY.length>0&&(r=i.e.Double(this.dvBAL_LY[0].Balance),this.dv[this.k].LastYearBalance=r)),-1!=this.YTD_LYIndex&&(this.dvYTD_LY=this.dvYTD_LYTable.filter(e=>e.AccountID==this.dv[this.k].AccountID),this.dvYTD_LY.length>0&&(r=i.e.Double(this.dvYTD_LY[0].Balance),this.dv[this.k].LastYearYTD=r)),!Object(l.j)(this.dv[this.k].IsGroup)){if(t=i.e.Double(this.dv[this.k].OP_Dr),s=i.e.Double(this.dv[this.k].OP_Cr),o=i.e.Double(this.dv[this.k].TR_Dr),a=i.e.Double(this.dv[this.k].TR_Cr),this.OpenCompany&&("4"!=this.strAccountType&&"5"!=this.strAccountType&&"8"!=this.strAccountType&&"9"!=this.strAccountType&&"11"!=this.strAccountType&&"12"!=this.strAccountType||(this.dvColumns.Contains("PeriodOpDr")?(t=i.e.Double(this.dv[this.k].PeriodOpDr),s=i.e.Double(this.dv[this.k].PeriodOpCr)):(t=0,s=0,this.dv[this.k].OP_Dr=null,this.dv[this.k].OP_Cr=null,this.IsFCClosingDebitExists&&(this.dv[this.k].FCOP_Dr=null,this.dv[this.k].FCOP_Cr=null))),null!=this.dvOpenCompanyTable&&(this.dvOpenCompany=this.dvOpenCompanyTable.filter(e=>e.AccountID==this.dv[this.k].AccountID),this.dvOpenCompany.length>0&&(this.Show==d.TagWise?this.dvOpenCompany.forEach(e=>{this.dbl=parseFloat(e.Dr),this.dblDrOpenCompany+=this.dbl,t+=this.dbl,this.dbl=parseFloat(e.Cr),this.dblCrOpenCompany+=this.dbl,s+=this.dbl,this.dvColumns.Contains(e.TagID.toString())&&(this.dbl=i.e.Double(this.dv[this.k][e.TagID.toString()]),this.dv[this.k][e.TagID.toString()]=this.dbl+parseFloat(e.Dr)-parseFloat(e.Cr))}):(this.dbl=parseFloat(this.dvOpenCompany[0].Dr)-parseFloat(this.dvOpenCompany[0].Cr),this.dbl>0?(this.dblDrOpenCompany+=this.dbl,t+=this.dbl):(this.dblCrOpenCompany+=-this.dbl,s+=-this.dbl)),this.dv[this.k].OP_Dr=t,this.dv[this.k].OP_Cr=s))),this.OpDrCrInOpDr?(this.dv[this.k].OP_Cr=null,this.dv[this.k].OP_Dr=t-s):(this.TBOpeningDrCrSeperately||(t>s?(t-=s,s=0,this.dv[this.k].OP_Dr=t):(s-=t,t=0,this.dv[this.k].OP_Cr=s)),0==t&&(this.dv[this.k].OP_Dr=null),0==s&&(this.dv[this.k].OP_Cr=null)),this.TBTransactionsDrCrSeperately||(o>a?(o-=a,a=0,this.dv[this.k].TR_Dr=o):(a-=o,o=0,this.dv[this.k].TR_Cr=a)),0==o&&(this.dv[this.k].TR_Dr=null),0==a&&(this.dv[this.k].TR_Cr=null),0==this.AccountsWithOutTransactions&&0==t&&0==s&&0==o&&0==a)continue;if(this.arrTBTotals[0]+=t,this.arrTBTotals[1]+=s,this.arrTBTotals[2]+=o,this.arrTBTotals[3]+=a,this.arrTBTotals[4]+=_,this.arrTBTotals[5]+=s,_=t+o-(s+a),_=parseFloat(_.ToString(this.dec)),_>0?(this.dv[this.k].CL_Dr=_,this.arrTBTotals[4]+=_):_<0&&(this.dv[this.k].CL_Cr=-_,this.arrTBTotals[5]+=-_),this.dv[this.k].NetBalance=_,!this.AccountsWithZeroBalance&&0==_){this.dblMissingOpeningDr+=t,this.dblMissingOpeningCr+=s;continue}this.IsFCClosingDebitExists&&(this.dbl=0,null!=this.dv[this.k].FCOP_Dr&&(this.dbl=parseFloat(this.dv[this.k].FCOP_Dr)),null!=this.dv[this.k].FCOP_Cr&&(this.dbl-=parseFloat(this.dv[this.k].FCOP_Cr)),null!=this.dv[this.k].FCTR_Dr&&(this.dbl+=parseFloat(this.dv[this.k].FCTR_Dr)),null!=this.dv[this.k].FCTR_Cr&&(this.dbl-=parseFloat(this.dv[this.k].FCTR_Cr)),this.dbl>0?this.dv[this.k].FCClosingDebit=this.dbl:this.dbl<0&&(this.dv[this.k].FCClosingCredit=-this.dbl))}if(this.TBGroupID.length>0&&this.ViewModel.AddGroupRows(this.dv,this.k),this.oRow=this.NewReportRow(),this.oRow.LevelNo=parseInt(this.dv[this.k].Depth)-1,this.oRow.Cells[1].IsNormal=!1,this.oRow.IsGroup=Object(l.j)(this.dv[this.k].IsGroup),this.oRow.DataRow=this.dv[this.k],this.oRow.NodeID=parseInt(this.dv[this.k].AccountID),!this.TBIsAccountWise&&(this.oRow.Cells[1].level=this.oRow.LevelNo,this.UpdateTreeTotals(this.oRow.LevelNo),Object(l.j)(this.dv[this.k].IsGroup))){this.lstParents.push(this.oRow),this.lstTotal.push(new Array(this.oColumns.length).fill(0));for(let e=this.lstTotal.length-1;e<=this.oRow.LevelNo;e++)this.lstParents.InsertAt(this.NewReportRow(),0),this.lstTotal.InsertAt(new Array(this.oColumns.length).fill(0),0);this.oRow.Type=n.f.BalanceBF,this.oRow.PrintVisible=this.ViewModel.TreeGroupPrint;for(let e=0;e<this.oRow.Cells.length;e++)this.oRow.Cells[e].IsNormal=!1,this.oRow.Cells[e].CellAppearance=this.BalanceBFAppearance_Data.Clone(),this.oRow.Cells[e].CellAppearance.Alignment=this.oColumns[e].DataAppearance.Alignment}for(let e=0;e<this.oColumns.length;e++){let t="";""!=this.oColumns[e].Formula?(t=this.ViewModel.CalculateFormula_1(this.oColumns[e].Formula,this.dv[this.k],this.rows),this.oRow.IsGroup&&this.GroupTotalsAtEnd&&"FLOAT"==this.oColumns[e].ColumnType&&(t="")):this.dvColumns.Contains(this.oColumns[e].ID)&&(t=i.e.String(this.dv[this.k][this.oColumns[e].ID])),""!=t&&(this.ViewModel.SetCellValue(t,this.oColumns[e].DataFormat,this.oColumns[e].ColumnType,this.oRow.Cells[e]),i.e.IsNum(t)&&(this.dbl=i.e.Double(t),this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][e]+=this.dbl,this.ViewModel.totals[e][this.ViewModel.lstGroup.length]+=this.dbl)))}this.oRow.LevelNo<=this.LevelNo&&(!this.TBShowdetailsofControlGroups&&this.lstParents.length>1&&(this.oRow.IsExpanded=!Object(l.j)(this.dv[this.k].IsSummary),Object(l.j)(this.dv[this.k].IsSummary)&&(this.oRow.Type=n.f.Detail),this.oRow.IsGroup?this.lstParents.length>2&&(this.oRow.Parent=this.lstParents[this.lstParents.length-2]):this.oRow.Parent=this.lstParents[this.lstParents.length-1],null==this.oRow.Parent||this.oRow.Parent.IsExpanded&&this.oRow.Parent.Visible||(this.oRow.Visible=!1)),-1==this.ViewModel.colSNoIndex||this.oRow.IsGroup||(this.oRow.Cells[this.ViewModel.colSNoIndex].Value=++this.ViewModel.SNo,this.oRow.Cells[this.ViewModel.colSNoIndex].Text=this.ViewModel.SNo.toString()),this.oRow.IsGroup||this.ViewModel.ApplyKPI(this.oRow),this.GrdRow++,this.ViewModel.addRow(this.oRow))}if(this.TBGroupID.length>0)for(let i=this.ViewModel.lstGroup.length;i>0;i--)this.ViewModel.AddSubtotals(this.dv[this.dv.length-1],this.ViewModel.lstGroup[i-1],i),this.ViewModel.Groupstr[this.ViewModel.lstGroup[i-1].ID]=null}UpdateTreeTotals(e){for(let t=this.lstTotal.length-1;t>e;t--){if(this.ViewModel.FormulaColumns.length>0&&null!=this.lstParents[t].DataRow){2==parseInt(this.lstParents[t].DataRow.IsSummary)&&-1!=this.colTBCl_DrIndex&&-1!=this.colTBCl_CrIndex&&(this.lstTotal[t][this.colTBCl_DrIndex]>=this.lstTotal[t][this.colTBCl_CrIndex]?(this.lstTotal[t][this.colTBCl_DrIndex]=this.lstTotal[t][this.colTBCl_DrIndex]-this.lstTotal[t][this.colTBCl_CrIndex],this.lstTotal[t][this.colTBCl_CrIndex]=0):(this.lstTotal[t][this.colTBCl_CrIndex]=this.lstTotal[t][this.colTBCl_CrIndex]-this.lstTotal[t][this.colTBCl_DrIndex],this.lstTotal[t][this.colTBCl_DrIndex]=0));for(let e=0;e<this.oColumns.length;e++)"FLOAT"==this.oColumns[e].ColumnType&&e!=this.ViewModel.colSNoIndex&&i.e.hasprop(this.lstParents[t].DataRow,this.oColumns[e].ID)&&(this.lstParents[t].DataRow[this.oColumns[e].ID]=this.lstTotal[t][e])}if(t>0)for(let e=0;e<this.lstTotal[t].length;e++)this.lstTotal[t-1][e]+=this.lstTotal[t][e];if(!this.GroupTotalsAtEnd||this.DontShowSummaryGroupTotals&&!this.lstParents[t].IsExpanded)for(let e=0;e<this.oColumns.length;e++)"FLOAT"!=this.oColumns[e].ColumnType||e==this.ViewModel.colSNoIndex||this.ExcludeTreeTotalCols.Contains(this.oColumns[e].ID)||this.ViewModel.SetCellValue(""!=this.oColumns[e].Formula&&1==this.oColumns[e].EvaluateAtEnd&&this.ViewModel.FormulaColumns.length>0&&null!=this.lstParents[t].DataRow?this.ViewModel.CalculateFormula_1(this.oColumns[e].Formula,this.lstParents[t].DataRow,[]):this.lstTotal[t][e],this.oColumns[e].DataFormat,"FLOAT",this.lstParents[t].Cells[e]);if(e<=this.LevelNo){let e=!1;if(0==this.AccountsWithOutTransactions&&(-1!=this.colTBOp_DrIndex&&-1!=this.colTBOp_CrIndex&&-1!=this.colTBTr_DrIndex&&-1!=this.colTBTr_CrIndex?0==this.lstTotal[t][this.colTBOp_DrIndex]&&0==this.lstTotal[t][this.colTBOp_CrIndex]&&0==this.lstTotal[t][this.colTBTr_DrIndex]&&0==this.lstTotal[t][this.colTBTr_CrIndex]&&(this.GrdRow--,e=!0,this.ViewModel.removeRow(this.lstParents[t])):-1!=this.colTBCl_DrIndex&&-1!=this.colTBCl_CrIndex?0==this.lstTotal[t][this.colTBCl_DrIndex]&&0==this.lstTotal[t][this.colTBCl_CrIndex]&&(this.GrdRow--,e=!0,this.ViewModel.removeRow(this.lstParents[t])):-1!=this.colBalanceIndex&&0==this.lstTotal[t][this.colBalanceIndex]&&(this.GrdRow--,e=!0,this.ViewModel.removeRow(this.lstParents[t]))),this.AccountsWithZeroBalance||e||(-1!=this.colTBCl_DrIndex&&-1!=this.colTBCl_CrIndex?0==this.lstTotal[t][this.colTBCl_DrIndex]&&0==this.lstTotal[t][this.colTBCl_CrIndex]&&(this.GrdRow--,e=!0,this.ViewModel.removeRow(this.lstParents[t])):-1!=this.colBalanceIndex&&0==this.lstTotal[t][this.colBalanceIndex]&&(this.GrdRow--,e=!0,this.ViewModel.removeRow(this.lstParents[t]))),!e){let e=this.ViewModel.Data.indexOf(this.lstParents[t]);if(e>=0)if(!this.GroupTotalsAtEnd||this.DontShowSummaryGroupTotals&&!this.lstParents[t].IsExpanded)this.GroupTotalsSeperate&&-1!=this.colBalanceIndex&&(this.lstParents[t].Cells[this.GroupTotalIndex].Text=this.lstParents[t].Cells[this.colBalanceIndex].Text,this.lstParents[t].Cells[this.colBalanceIndex].Text=""),this.ViewModel.removeRow(this.lstParents[t]),this.ViewModel.insertRowAt(this.lstParents[t],e);else{this.oSubTotal=this.NewReportRow(),this.oSubTotal.Type=n.f.BalanceBF,this.oSubTotal.Parent=this.lstParents[t].Parent,this.oSubTotal.LevelNo=this.lstParents[t].LevelNo,this.oSubTotal.Cells[1].IsNormal=!1,this.oSubTotal.IsGroup=!0,this.oSubTotal.Visible=this.lstParents[t].Visible,this.oSubTotal.Cells[1].level=this.lstParents[t].LevelNo,this.oSubTotal.Cells[1].Text=this.lstParents[t].Cells[0].Text+"-"+this.lstParents[t].Cells[1].Text+" - Total ",this.oSubTotal.Cells[1].CellAppearance=this.GrossTotalAppearance_Data.Clone(),this.oSubTotal.Cells[1].CellAppearance.Alignment=this.oColumns[1].DataAppearance.Alignment,this.ViewModel.TreeTotalBorder<0&&this.oSubTotal.Cells.forEach(e=>{e.Border=this.ViewModel.TreeTotalBorder});for(let e=0;e<this.oColumns.length;e++)"FLOAT"!=this.oColumns[e].ColumnType||e==this.ViewModel.colSNoIndex||this.ExcludeTreeTotalCols.Contains(this.oColumns[e].ID)||(this.oSubTotal.Cells[e].IsNormal=!1,this.oSubTotal.Cells[e].CellAppearance=this.GrossTotalAppearance_Data.Clone(),this.oSubTotal.Cells[e].CellAppearance.Alignment=this.oColumns[e].DataAppearance.Alignment,this.oSubTotal.Cells[e].Border=this.ViewModel.TreeTotalBorder,this.ViewModel.SetCellValue(""!=this.oColumns[e].Formula&&1==this.oColumns[e].EvaluateAtEnd&&this.ViewModel.FormulaColumns.length>0&&null!=this.lstParents[t].DataRow?this.ViewModel.CalculateFormula_1(this.oColumns[e].Formula,this.lstParents[t].DataRow,[]):this.lstTotal[t][e],this.oColumns[e].DataFormat,"FLOAT",this.oSubTotal.Cells[e]));this.GroupTotalsSeperate&&-1!=this.colBalanceIndex&&(this.oSubTotal.Cells[this.GroupTotalIndex].IsNormal=!1,this.oSubTotal.Cells[this.GroupTotalIndex].CellAppearance=this.GrossTotalAppearance_Data.Clone(),this.oSubTotal.Cells[this.GroupTotalIndex].CellAppearance.Alignment=this.oColumns[this.GroupTotalIndex].DataAppearance.Alignment,this.oSubTotal.Cells[this.GroupTotalIndex].Border=this.ViewModel.TreeTotalBorder,this.oSubTotal.Cells[this.GroupTotalIndex].Text=this.oSubTotal.Cells[this.colBalanceIndex].Text,this.oSubTotal.Cells[this.colBalanceIndex].Text=""),this.GrdRow++,this.ViewModel.addRow(this.oSubTotal)}}}this.lstParents.RemoveAt(t),this.lstTotal.RemoveAt(t)}}UpdateDataTableWithGroups(){let e,t,s,o,a,n,r,h,u,D,c,C=this.ds.Tables[1],p=this.ds.Columns[1],T=this.ds.Tables[1],_=this.ds.Tables[1];p.push("OP_Dr"),p.push("OP_Cr"),p.push("TR_Dr"),p.push("TR_Cr");for(let i=0;i<C.length;i++)Object(l.j)(C[i].TB)?(T=_.filter(e=>e.ParentID==C[i].AccountID),T.forEach(e=>{e.TB=1})):(C.RemoveAt(i),i--);for(let i=0;i<this.CountMonths;i++)p.push(this.oColumns[this.ViewModel.ColumnSource.length+i].ID);for(let l=this.ds.Tables[0].length-1;l>=0;l--)T=_.filter(e=>e.AccountID==this.ds.Tables[0][l].ParentID&&1==e.TB),T.length>0&&(t=this.ds.Tables[0][l],s=i.e.Double(t.OP_Dr),o=i.e.Double(t.OP_Cr),a=i.e.Double(t.TR_Dr),n=i.e.Double(t.TR_Cr),this.OpenCompany&&(this.strAccountType=t.AccountTypeID.toString(),"4"!=this.strAccountType&&"5"!=this.strAccountType&&"8"!=this.strAccountType&&"9"!=this.strAccountType&&"11"!=this.strAccountType&&"12"!=this.strAccountType||(s=0,o=0,t.OP_Dr=null,t.OP_Cr=null),null!=this.dvOpenCompany&&(this.dvOpenCompany=this.dvOpenCompanyTable.filter(e=>e.AccountID==t.AccountID),this.dvOpenCompany.length>0&&(this.dbl=parseFloat(this.dvOpenCompany[0].Dr),this.dblDrOpenCompany+=this.dbl,s+=this.dbl,t.OP_Dr=s,this.dbl=parseFloat(this.dvOpenCompany[0].Cr),this.dblCrOpenCompany+=this.dbl,o+=this.dbl,t.OP_Cr=o))),r=s+a-(o+n),r=parseFloat(r.ToString(this.dec)),(this.AccountsWithZeroBalance||r>0)&&(h=i.e.Double(T[0].OP_Dr),u=i.e.Double(T[0].OP_Cr),D=i.e.Double(T[0].TR_Dr),c=i.e.Double(T[0].TR_Cr),T[0].OP_Dr=h+s,T[0].OP_Cr=u+o,T[0].TR_Dr=D+a,T[0].TR_Cr=c+n,this.Show==d.TagWise&&(e=this.ds.Tables[0][l].Tag.toString(),e.length>0&&(this.dbl=i.e.Double(T[0][e]),T[0][e]=r+this.dbl))),this.ds.Tables[0].RemoveAt(l));for(let l=C.length-1;l>=0;l--)if(T=_.filter(e=>e.AccountID==C[l].ParentID),T.length>0)s=i.e.Double(C[l].OP_Dr),o=i.e.Double(C[l].OP_Cr),a=i.e.Double(C[l].TR_Dr),n=i.e.Double(C[l].TR_Cr),h=i.e.Double(T[0].OP_Dr),u=i.e.Double(T[0].OP_Cr),D=i.e.Double(T[0].TR_Dr),c=i.e.Double(T[0].TR_Cr),T[0].OP_Dr=h+s,T[0].OP_Cr=u+o,T[0].TR_Dr=D+a,T[0].TR_Cr=c+n,C.RemoveAt(l);else{let t={};if(t.AccountCode=C[l].AccountCode,t.AccountName=C[l].AccountName,t.AccountID=C[l].AccountID,t.AccountTypeID=0,t.OP_Dr=C[l].OP_Dr,t.OP_Cr=C[l].OP_Cr,t.TR_Dr=C[l].TR_Dr,t.TR_Cr=C[l].TR_Cr,t.lft=C[l].lft,t.Depth=C[l].Depth,t.IsGroup=!1,this.Show==d.TagWise){t.Tag="-999";for(let s=0;s<this.CountMonths;s++)e=this.oColumns[this.ViewModel.ColumnSource.length+s].ID,t[e]=C[l][e]}this.ds.Tables[0].push(t)}}addTrialBalanceTType(){let e,t,s,o,a=0;for(this.dblMissingOpeningDr=0,this.dblMissingOpeningCr=0,this.lstParents.Clear(),this.lstTotal.Clear(),this.lstParents.push(this.NewReportRow()),this.lstTotal.push(new Array(this.oColumns.length).fill(0)),this.arrTBTotals=new Array(6).fill(0),this.ViewModel.totals=i.e.NumArray(this.oColumns.length,this.ViewModel.lstGroup.length+1),this.k=0;this.k<this.dv.length;this.k++)if(this.strAccountType=this.dv[this.k].AccountTypeID.toString(),!Object(l.j)(this.dv[this.k].IsGroup)){if(e=i.e.Double(this.dv[this.k].OP_Dr),t=i.e.Double(this.dv[this.k].OP_Cr),s=i.e.Double(this.dv[this.k].TR_Dr),o=i.e.Double(this.dv[this.k].TR_Cr),this.OpenCompany&&("4"!=this.strAccountType&&"5"!=this.strAccountType&&"8"!=this.strAccountType&&"9"!=this.strAccountType&&"11"!=this.strAccountType&&"12"!=this.strAccountType||(e=0,t=0,this.dv[this.k].OP_Dr=null,this.dv[this.k].OP_Cr=null),null!=this.dvOpenCompanyTable&&(this.dvOpenCompany=this.dvOpenCompanyTable.filter(e=>e.AccountID==this.dv[this.k].AccountID),this.dvOpenCompany.length>0&&(this.dbl=parseFloat(this.dvOpenCompany[0].Dr),this.dblDrOpenCompany+=this.dbl,e+=this.dbl,this.dv[this.k].OP_Dr=e,this.dbl=parseFloat(this.dvOpenCompany[0].Cr),this.dblCrOpenCompany+=this.dbl,t+=this.dbl,this.dv[this.k].OP_Cr=t))),this.TBOpeningDrCrSeperately||(e>t?(e-=t,t=0,this.dv[this.k].OP_Dr=e):(t-=e,e=0,this.dv[this.k].OP_Cr=t)),0==e&&(this.dv[this.k].OP_Dr=null),0==t&&(this.dv[this.k].OP_Cr=null),this.TBTransactionsDrCrSeperately||(s>o?(s-=o,o=0,this.dv[this.k].TR_Dr=s):(o-=s,s=0,this.dv[this.k].TR_Cr=o)),0==s&&(this.dv[this.k].TR_Dr=null),0==o&&(this.dv[this.k].TR_Cr=null),0==this.AccountsWithOutTransactions&&0==e&&0==t&&0==s&&0==o)continue;if(this.arrTBTotals[0]+=e,this.arrTBTotals[1]+=t,this.arrTBTotals[2]+=s,this.arrTBTotals[3]+=o,this.arrTBTotals[4]+=a,this.arrTBTotals[5]+=t,a=e+s-(t+o),a=parseFloat(a.ToString(this.dec)),a>0?(this.dv[this.k].CL_Dr=a,this.arrTBTotals[4]+=a):a<0&&(this.dv[this.k].CL_Cr=-a,this.arrTBTotals[5]+=-a),this.dv[this.k].NetBalance=a,!this.AccountsWithZeroBalance&&0==a){this.dblMissingOpeningDr+=e,this.dblMissingOpeningCr+=t;continue}}this.ReportTotal=new Array(2).fill(0),this.CellStartPos=0,this.AddSection(!0,!0),this.AddSection(!1,!1)}AddSection(e,t){this.IsFirstCall=t,this.lstParents.Clear(),this.lstTotal.Clear(),t||(this.FirstTypeEndIndex=this.GrdRow,this.GrdRow=-1,this.CellStartPos=this.CellStartPos+this.TTColumnSize),e?(this.dv=this.dvTable.filter(this.TBIsAccountWise?e=>i.e.Double(e.NetBalance)>=0:e=>e.IsGroup=1),this.TTReportTotalIndex=0):(this.dv=this.dvTable.filter(this.TBIsAccountWise?e=>e.NetBalance<0:e=>e.IsGroup=1),this.TTReportTotalIndex=1);let s=!1,o=!1;for(let a=0;a<this.dv.length;a++)this.drAccount=this.dv[a],this.strAccountID=this.drAccount.AccountID.toString(),o=!1,Object(l.j)(this.drAccount.IsGroup)?(this.dbl=0,this.AddRow()):(this.dbl=i.e.Double(this.drAccount.NetBalance),this.dbl<0&&(this.dbl=-this.dbl),s=!1,(Math.abs(this.dbl)>.01||this.AccountsWithOutTransactions||s||o)&&this.AddRow());!t&&this.GrdRow+1<this.ViewModel.Data.length&&(this.ViewModel.Data[this.GrdRow+1].Cells[this.CellStartPos].Text="",this.ViewModel.Data[this.GrdRow+1].Cells[this.CellStartPos+1].Text="",this.ViewModel.ColumnSource.length>2&&(this.ViewModel.Data[this.GrdRow+1].Cells[this.CellStartPos+2].Text="")),this.TTUpdateTreeTotals(0)}AddRow(){if(this.IsAddRow=0,this.oRow=this.NewReportRow(),this.oRow.LevelNo=parseInt(this.drAccount.Depth)-1,this.TBIsAccountWise||this.TTUpdateTreeTotals(this.oRow.LevelNo),this.oRow.NodeID=parseInt(this.drAccount.AccountID),this.oRow.LevelNo<=this.LevelNo&&(this.GrdRow++,this.IsFirstCall||this.GrdRow>this.FirstTypeEndIndex?this.IsAddRow=1:(this.IsAddRow=2,this.oRow=this.ViewModel.Data[this.GrdRow])),this.IsFirstCall||(this.oRow.Tag=parseInt(this.drAccount.AccountID)),this.oRow.IsGroup=Object(l.j)(this.drAccount.IsGroup),this.TBIsAccountWise||(this.oRow.Cells[this.CellStartPos+this.TTAccNameIndex].level=parseInt(this.drAccount.Depth)-1),Object(l.j)(this.drAccount.IsGroup)){this.lstParents.push(this.oRow),this.lstTotal.push(new Array(this.oColumns.length).fill(0));for(let e=this.CellStartPos;e<this.CellStartPos+this.TTColumnSize;e++)this.oRow.Cells[e].IsNormal=!1,this.oRow.Cells[e].CellAppearance=this.BalanceBFAppearance.Clone(),this.oRow.Cells[e].CellAppearance.Alignment=this.ViewModel.ReportColumns[e].DataAppearance.Alignment;this.oRow.Type=n.f.BalanceBF}else{this.ReportTotal[this.TTReportTotalIndex]+=this.dbl;for(let e=this.CellStartPos;e<this.CellStartPos+this.TTColumnSize;e++)this.oRow.Cells[e].IsNormal=!0,this.oRow.Cells[e].CellAppearance=null}if(this.oRow.Cells[this.CellStartPos].Text=this.drAccount.AccountCode.toString(),this.oRow.Cells[this.CellStartPos].Value=this.oRow.Cells[this.CellStartPos].Text,this.oRow.Cells[this.CellStartPos+this.TTAccNameIndex].Text=this.drAccount.AccountName.toString(),this.oRow.Cells[this.CellStartPos+this.TTAccNameIndex].Value=this.oRow.Cells[this.CellStartPos+this.TTAccNameIndex].Text,this.oRow.Cells[this.CellStartPos+this.TTAccNameIndex].IsNormal=!1,this.oRow.IsGroup||(this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.CellStartPos+this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.BalIndex]+=this.dbl),this.ViewModel.ApplyKPI(this.oRow)),1==this.IsAddRow){if(!(this.TBShowdetailsofControlGroups||(this.oRow.IsExpanded=!Object(l.j)(this.drAccount.IsSummary),Object(l.j)(this.drAccount.IsSummary)&&(this.oRow.Type=n.f.Detail),this.oRow.IsGroup?this.lstParents.length>1&&(this.oRow.Parent=this.lstParents[this.lstParents.length-2]):this.lstParents.length>0&&(this.oRow.Parent=this.lstParents[this.lstParents.length-1]),null==this.oRow.Parent||this.oRow.Parent.IsExpanded&&this.oRow.Parent.Visible)))return this.oRow.Visible=!1,void this.GrdRow--;this.ViewModel.addRow(this.oRow)}else if(2==this.IsAddRow){if(!this.TBShowdetailsofControlGroups){this.oRow.IsExpanded=!Object(l.j)(this.drAccount.IsSummary),this.oRow.IsGroup?this.lstParents.length>1&&(this.oRow.Parent=this.lstParents[this.lstParents.length-2]):this.lstParents.length>0&&(this.oRow.Parent=this.lstParents[this.lstParents.length-1]);for(let e=0;e<this.lstParents.length;e++){let t=this.lstParents[e];if(!t.IsExpanded&&t!=this.oRow)return void this.GrdRow--}}this.ViewModel.removeRow(this.oRow),this.ViewModel.insertRowAt(this.oRow,this.GrdRow)}}TTUpdateTreeTotals(e){for(let t=this.lstTotal.length-1;t>=e;t--){if(t>0)for(let e=0;e<this.lstTotal[t].length;e++)this.lstTotal[t-1][e]+=this.lstTotal[t][e];if((!this.GroupTotalsAtEnd||this.DontShowSummaryGroupTotals&&!this.lstParents[t].IsExpanded)&&this.ViewModel.SetCellValue(this.lstTotal[t][this.BalIndex],this.oColumns[this.CellStartPos+this.BalIndex].DataFormat,"FLOAT",this.GroupTotalsSeperate?this.lstParents[t].Cells[this.CellStartPos+this.BalIndex+1]:this.lstParents[t].Cells[this.CellStartPos+this.BalIndex]),e<=this.LevelNo){let e=this.ViewModel.Data.indexOf(this.lstParents[t]);if(e>=0)if(this.ViewModel.Data.RemoveAt(e),this.IsValueExists(this.lstTotal[t])||(0==this.CellStartPos||this.FirstTypeEndIndex<e?e=-1:this.GrdRow--),-1!=e){if(this.ViewModel.insertRowAt(this.lstParents[t],e),this.IsValueExists(this.lstTotal[t]))if(!this.GroupTotalsAtEnd||this.DontShowSummaryGroupTotals&&!this.lstParents[t].IsExpanded);else{this.GrdRow++,this.oSubTotal=this.ViewModel.Data.length<=this.GrdRow?this.NewReportRow():this.ViewModel.Data[this.GrdRow],this.oSubTotal.Type=n.f.BalanceBF,this.oSubTotal.Parent=this.lstParents[t].Parent,this.oSubTotal.LevelNo=this.lstParents[t].LevelNo,this.oSubTotal.IsGroup=!0,this.oSubTotal.Visible=this.lstParents[t].Visible,this.oSubTotal.Cells[this.CellStartPos].Text="";let e=this.oSubTotal.Cells[this.CellStartPos+this.TTAccNameIndex];e.IsNormal=!1,e.level=this.lstParents[t].LevelNo,e.Text=this.lstParents[t].Cells[this.CellStartPos+this.TTAccNameIndex].Text+" - TOTAL",e.CellAppearance=this.GrossTotalAppearance_Data.Clone(),e.CellAppearance.Alignment=this.oColumns[this.TTAccNameIndex].DataAppearance.Alignment,this.GroupTotalsSeperate?(this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+1].IsNormal=!1,this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+1].CellAppearance=this.GrossTotalAppearance_Data.Clone(),this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+1].CellAppearance.Alignment=this.oColumns[this.BalIndex].DataAppearance.Alignment,this.ViewModel.SetCellValue(this.lstTotal[t][this.BalIndex],this.oColumns[this.CellStartPos+this.BalIndex].DataFormat,"FLOAT",this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+1])):(this.oSubTotal.Cells[this.CellStartPos+this.BalIndex].IsNormal=!1,this.oSubTotal.Cells[this.CellStartPos+this.BalIndex].CellAppearance=this.GrossTotalAppearance_Data.Clone(),this.oSubTotal.Cells[this.CellStartPos+this.BalIndex].CellAppearance.Alignment=this.oColumns[this.BalIndex].DataAppearance.Alignment,this.ViewModel.SetCellValue(this.lstTotal[t][this.BalIndex],this.oColumns[this.CellStartPos+this.BalIndex].DataFormat,"FLOAT",this.oSubTotal.Cells[this.CellStartPos+this.BalIndex])),this.ViewModel.Data.length<=this.GrdRow?this.ViewModel.addRow(this.oSubTotal):(this.ViewModel.Data.RemoveAt(this.GrdRow),this.ViewModel.insertRowAt(this.oSubTotal,this.GrdRow))}}else this.GrdRow--}this.lstParents.RemoveAt(t),this.lstTotal.RemoveAt(t)}}IsValueExists(e){return!!e.find(e=>0!=e)}AddRow_RP(e){if(this.IsAddRow=0,this.oRow=this.NewReportRow(),this.oRow.LevelNo=parseInt(e.Depth)-1,this.UpdateTreeTotals_RP(this.oRow.LevelNo),this.oRow.NodeID=parseInt(e.AccountID),this.oRow.LevelNo<=this.LevelNo&&(this.GrdRow++,this.IsFirstCall||this.GrdRow>=this.FirstTypeEndIndex?this.IsAddRow=1:(this.IsAddRow=2,this.oRow=this.ViewModel.Data[this.GrdRow])),this.oRow.IsGroup=Object(l.j)(e.IsGroup),this.oRow.Cells[this.CellStartPos+0].level=parseInt(e.Depth)-1,this.oRow.IsGroup){this.lstParents.push(this.oRow),this.lstTotal.push(new Array(this.oColumns.length).fill(0));for(let e=this.CellStartPos;e<this.CellStartPos+2;e++)this.oRow.Cells[e].IsNormal=!1,this.oRow.Cells[e].CellAppearance=this.BalanceBFAppearance.Clone(),this.oRow.Cells[e].CellAppearance.Alignment=this.ViewModel.ReportColumns[e].DataAppearance.Alignment;this.oRow.Type=n.f.BalanceBF}else for(let t=this.CellStartPos;t<this.oRow.Cells.length;t++)this.oRow.Cells[t].IsNormal=!0,this.oRow.Cells[t].CellAppearance=null;if(this.ViewModel.SetCellValue(e.Account,this.oColumns[this.CellStartPos+0].DataFormat,this.oColumns[this.CellStartPos+0].ColumnType,this.oRow.Cells[this.CellStartPos+0]),this.oRow.Cells[this.CellStartPos].IsNormal=!1,!this.oRow.IsGroup)if(this.dbl=parseInt(e.Amount),1==this.CallFrom||3==this.CallFrom)if(this.dbl>0){let e=1==this.CallFrom?1:3;this.ViewModel.SetCellValue(this.dbl,this.oColumns[e].DataFormat,this.oColumns[e].ColumnType,this.oRow.Cells[e]),this.AggTotal[this.CallFrom]+=this.dbl,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][e]+=this.dbl)}else{this.dbl=-this.dbl;let e=1==this.CallFrom?3:1;this.ViewModel.SetCellValue(this.dbl,this.oColumns[e].DataFormat,this.oColumns[e].ColumnType,this.oRow.Cells[e]),this.AggTotal[this.CallFrom]+=this.dbl,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][e]+=this.dbl)}else this.IsFirstCall||(this.dbl=-this.dbl),this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.CellStartPos+1].DataFormat,this.oColumns[this.CellStartPos+1].ColumnType,this.oRow.Cells[this.CellStartPos+1]),this.dbl=this.ViewModel.RoundOff(this.dbl,this.oColumns[this.CellStartPos+1].DataFormat),this.AggTotal[2]+=this.dbl,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.CellStartPos+1]+=this.dbl);1==this.IsAddRow?this.ViewModel.addRow(this.oRow):2==this.IsAddRow&&(this.ViewModel.removeRow(this.oRow),this.ViewModel.insertRowAt(this.oRow,this.GrdRow))}UpdateTreeTotals_RP(e){if(!(e<0))for(let t=this.lstTotal.length-1;t>=e;t--){if(t>0)for(let e=0;e<this.lstTotal[t].length;e++)this.lstTotal[t-1][e]+=this.lstTotal[t][e];if(this.ViewModel.SetCellValue(this.lstTotal[t][this.CellStartPos+1],this.oColumns[this.CellStartPos+1].DataFormat,"FLOAT",this.lstParents[t].Cells[this.CellStartPos+1]),e<=this.LevelNo){let e=this.ViewModel.Data.indexOf(this.lstParents[t]);e>=0&&(this.ViewModel.Data.RemoveAt(e),0==this.lstTotal[t][this.CellStartPos+1]&&(0==this.CellStartPos||this.FirstTypeEndIndex<e?e=-1:this.GrdRow--),-1!=e?this.ViewModel.insertRowAt(this.lstParents[t],e):this.GrdRow--)}this.lstParents.RemoveAt(t),this.lstTotal.RemoveAt(t)}}AddSection_RPVertical(e){if(0!=this.dv.length){for(this.oRow=this.NewReportRow_2(n.f.SubReportHeader,this.GrossTotalAppearance),this.oRow.Cells[0].CellAppearance.BackColor="#FFF0EEF9",this.oRow.Cells[0].ColSpan=this.oColumns.length,1==e?this.oRow.Cells[0].Text="RECEIPTS":2==e?this.oRow.Cells[0].Text="PAYMENTS":3==e?this.oRow.Cells[0].Text="PDC Receipts":4==e&&(this.oRow.Cells[0].Text="PDC Payments"),this.ViewModel.addRow(this.oRow),this.k=0;this.k<this.dv.length;this.k++){this.oRow=new n.d(this.oColumns.length,this.ViewModel.RowHeight),this.oRow.Type=n.f.Detail,this.oRow.DataRow=this.dv[this.k],this.oRow.NodeID=parseInt(this.dv[this.k].AccountID);for(let t=0;t<this.oColumns.length;t++){let s="";this.dvColumns.Contains(this.oColumns[t].ID)&&(s=i.e.String(this.dv[this.k][this.oColumns[t].ID])),""!=s&&("FLOAT"==this.oColumns[t].ColumnType&&(this.dbl=i.e.Double(s),this.AggTotal[t][e]+=this.dbl),this.ViewModel.SetCellValue(s,this.oColumns[t].DataFormat,this.oColumns[t].ColumnType,this.oRow.Cells[t]))}this.ViewModel.addRow(this.oRow)}this.oRow=this.NewReportRow_2(n.f.SubTotal,this.GrossTotalAppearance_Data),this.oRow.Cells[0].Text="Total",this.oRow.Cells[0].CellAppearance.Alignment="Left";for(let t=0;t<this.oColumns.length;t++)"FLOAT"==this.oColumns[t].ColumnType&&this.ViewModel.SetCellValue(this.AggTotal[t][e],this.oColumns[t].DataFormat,this.oColumns[t].ColumnType,this.oRow.Cells[t]),this.oRow.Cells[t].CellAppearance.ForeColor="Red",this.oRow.Cells[t].CellAppearance.IsBold=!1;this.ViewModel.addRow(this.oRow)}}ColumnnarCashBank(){let e=this.ViewModel.ColumnSource.length-1+this.colIndex.length,t=!(!this.ViewModel.Preferences.ContainsKey("ShowNarration")||"1"!=this.ViewModel.Preferences.ShowNarration);this.AggTotal=i.e.NumArray(this.oColumns.length,2);let s=new n.a;s.IsBold=!0,s.FontSize=14,s.ForeColor="#FF00465A",s.BackColor="White",s.FontFamilyName="Arial",s.Alignment="Center",this.oRow=this.NewReportRow_2(n.f.Header,s),this.ViewModel.RowHeight<30&&(this.oRow.Height=30),this.oRow.Cells[0].ColSpan=e,this.oRow.Cells[0].Text="Receipts",this.oRow.Cells[e].Text="Payments",this.oRow.Cells[e].ColSpan=e,this.ViewModel.addRow(this.oRow),this.oRow=this.NewReportRow_2(n.f.BalanceBF,this.GrossTotalAppearance_Data),this.oRow.Cells[0].ColSpan=this.ViewModel.ColumnSource.length-1,this.oRow.Cells[0].CellAppearance.Alignment="Left",this.oRow.Cells[0].Text=o.a.GetResource("Reports_OpeningBalance");let l=0;this.ds.Tables[0].forEach(t=>{this.dbl=parseFloat(t.BF),0!=this.dbl&&(l=this.colIndex[parseInt(t.AccountID)],this.dbl<0&&(l+=e),this.AggTotal[l][0]=Math.abs(this.dbl),this.ViewModel.SetCellValue(this.AggTotal[l][0],this.oColumns[l].DataFormat,this.oColumns[l].ColumnType,this.oRow.Cells[l]))}),this.ViewModel.addRow(this.oRow);let a=this.ds.Tables[1].filter(e=>e.DiffDrCr>0),r=this.ds.Tables[1].filter(e=>e.DiffDrCr<0),h=Math.max(a.length,r.length),u=null;for(this.i=0;this.i<h;this.i++)this.oRow=new n.d(this.oColumns.length,this.ViewModel.RowHeight),this.oRow.Type=n.f.Detail,t&&(u=new n.d(this.oColumns.length,this.ViewModel.RowHeight),u.Type=n.f.Detail),this.i<a.length&&(l=this.colIndex[parseInt(a[this.i].AccountID)],this.AddRow_ColumnnarCashBank(a[this.i],0,this.oRow,u)),this.i<r.length&&(l=this.colIndex[parseInt(r[this.i].AccountID)]+e,this.AddRow_ColumnnarCashBank(r[this.i],e,this.oRow,u)),this.ViewModel.addRow(this.oRow),t&&this.ViewModel.addRow(u);for(this.oRow=this.NewReportRow_2(n.f.BalanceBF,this.GrossTotalAppearance_Data),this.oRow.Cells[0].ColSpan=this.ViewModel.ColumnSource.length-1,this.oRow.Cells[0].CellAppearance.Alignment="Left",this.oRow.Cells[0].Text=o.a.GetResource("Reports_ReportTotal"),this.i=this.ViewModel.ColumnSource.length-1;this.i<e;this.i++)this.ViewModel.SetCellValue(this.AggTotal[this.i][1],this.oColumns[this.i].DataFormat,this.oColumns[this.i].ColumnType,this.oRow.Cells[this.i]),this.ViewModel.SetCellValue(this.AggTotal[this.i+e][1],this.oColumns[this.i].DataFormat,this.oColumns[this.i].ColumnType,this.oRow.Cells[this.i+e]);for(this.ViewModel.addRow(this.oRow),this.oRow=this.NewReportRow_2(n.f.BalanceBF,this.GrossTotalAppearance_Data),this.oRow.Cells[0].ColSpan=this.ViewModel.ColumnSource.length-1,this.oRow.Cells[0].CellAppearance.Alignment="Left",this.oRow.Cells[0].Text=o.a.GetResource("Reports_ClosingBalance"),this.i=this.ViewModel.ColumnSource.length-1;this.i<e;this.i++)this.ViewModel.SetCellValue(this.AggTotal[this.i][0]+this.AggTotal[this.i][1],this.oColumns[this.i].DataFormat,this.oColumns[this.i].ColumnType,this.oRow.Cells[this.i]),this.ViewModel.SetCellValue(this.AggTotal[this.i+e][0]+this.AggTotal[this.i+e][1],this.oColumns[this.i].DataFormat,this.oColumns[this.i].ColumnType,this.oRow.Cells[this.i+e]);for(this.ViewModel.addRow(this.oRow),this.oRow=this.NewReportRow_2(n.f.BalanceBF,this.GrossTotalAppearance_Data),this.oRow.Cells[0].ColSpan=e+this.ViewModel.ColumnSource.length-1,this.oRow.Cells[0].CellAppearance.Alignment="Left",this.oRow.Cells[0].Text="Net Balance",this.i=this.ViewModel.ColumnSource.length-1;this.i<e;this.i++)this.ViewModel.SetCellValue(this.AggTotal[this.i][0]+this.AggTotal[this.i][1]-(this.AggTotal[this.i+e][0]+this.AggTotal[this.i+e][1]),this.oColumns[this.i].DataFormat,this.oColumns[this.i].ColumnType,this.oRow.Cells[this.i+e]);this.ViewModel.addRow(this.oRow)}AddRow_ColumnnarCashBank(e,t,s,o){for(let l=0;l<this.ViewModel.ColumnSource.length-1;l++)this.CellValue=null,this.Col=l+t,Object(h.isUndefined)(e[this.oColumns[l].ID])||(this.CellValue=e[this.oColumns[l].ID]),null!=this.CellValue&&this.ViewModel.SetCellValue(this.CellValue,this.oColumns[l].DataFormat,this.oColumns[l].ColumnType,s.Cells[this.Col]);let i=this.colIndex[parseInt(e.AccountID)]+t;this.dbl=Math.abs(parseFloat(e.DiffDrCr)),this.AggTotal[i][1]+=Math.abs(this.dbl),this.ViewModel.SetCellValue(this.dbl,this.oColumns[i].DataFormat,this.oColumns[i].ColumnType,s.Cells[i]),null!=o&&(o.Cells[this.colParticularIndex+t].Text=e.CommonNarration.toString(),o.Cells[this.colParticularIndex+t].Value=e.CommonNarration.toString())}AddDayBook(){if(this.AggTotal=i.e.NumArray(this.oColumns.length,this.ViewModel.lstGroup.length+1),this.ViewModel.totals=i.e.NumArray(this.oColumns.length,this.ViewModel.lstGroup.length+1),this.OpBalance=parseFloat(this.ds.Tables[0][0].Balance),0!=this.OpBalance){this.Balance=this.OpBalance,this.row=this.NewReportRow_2(n.f.BalanceBF,this.BalanceBFAppearance),this.row.LevelNo=this.ViewModel.lstGroup.length;let e=this.row.Cells[0];e.ColSpan=this.colSpanBF,e.Text=o.a.GetResource("Reports_OpeningBalance"),this.colDebitIndex>-1&&this.OpBalance>0&&(this.row.Cells[this.colDebitIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(this.OpBalance,this.oColumns[this.colDebitIndex].DataFormat,"FLOAT",this.row.Cells[this.colDebitIndex]),this.AggTotal[0]=this.OpBalance),this.colCreditIndex>-1&&this.OpBalance<0&&(this.row.Cells[this.colCreditIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(-this.OpBalance,this.oColumns[this.colCreditIndex].DataFormat,"FLOAT",this.row.Cells[this.colCreditIndex]),this.AggTotal[0]=-this.OpBalance),this.ViewModel.addRow(this.row)}this.ViewModel.RenderData(this.ds.Tables[1].DefaultView);for(let e=0;e<this.oColumns.length;e++)this.AggTotal[e][0]+=this.ViewModel.totals[e][0];if(-1!=this.colDebitIndex&&-1!=this.colCreditIndex&&(this.Balance=this.AggTotal[0]-this.AggTotal[0],0!=this.Balance)){this.row=this.NewReportRow_2(n.f.BalanceBF,this.BalanceBFAppearance),this.row.LevelNo=this.ViewModel.lstGroup.length;let e=this.row.Cells[0];e.ColSpan=this.colSpanBF,e.Text=o.a.GetResource("Reports_ClosingBalance"),this.Balance<0?(this.Balance=-this.Balance,this.row.Cells[this.colDebitIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(this.Balance,this.oColumns[this.colDebitIndex].DataFormat,"FLOAT",this.row.Cells[this.colDebitIndex]),this.AggTotal[0]+=this.Balance):this.Balance>0&&(this.row.Cells[this.colCreditIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(this.Balance,this.oColumns[this.colCreditIndex].DataFormat,"FLOAT",this.row.Cells[this.colCreditIndex]),this.AggTotal[0]+=this.Balance),this.ViewModel.addRow(this.row)}}}},XPEG:function(e,t,s){"use strict";s.d(t,"a",(function(){return I}));var o=s("mrSG"),i=s("Do2H"),l=s("Lp6j"),a=s("eQJW"),n=s("wlFP"),r=s("w8Sz"),h=s("dH+5"),u=s("EQd/"),D=s("0/4Q"),d=s("USNh"),c=s("VxiT"),C=s("8iaB"),p=s("6z9j"),T=s("4HhE"),_=s("7JXL"),m=s("vTM8");class I extends C.a{constructor(){super(),this.SelectAll=!1,this.IsReportViewScreen=!1,this.oReport=null,this.DefaultVisibility=!1,this.OKVisibility=!1,this.TreeVisibility=!0,this.RowFiltersVisible=!1,this.IsPreProcessQueryVisible=!1,this.IsEnable=!0,this.MaxDlgWidth=0,this.lstPreFetchReportCC=new m.c,this.GridViewID=0,this.TreeCCID=0,this.LookupTypeID=0,this.ClassName="AddEditFilterViewModel"}AddEditFilterViewModel_1(e){if(this.ParentViewModel=e,"ReportViewModel"==e.ClassName?(this.oReport=e,this.IsReportViewScreen=!0,this.OKVisibility=!0,this.DefaultVisibility=!1,this.TreeVisibility=!this.oReport.HideCostCenterTree,this.DisplayName=this.Title=this.oReport.ScreenName,e.IsPreProcessQuery&&i.a.SessionManager.IsActionAssigned(200,"Pre-Process Query")&&(this.IsPreProcessQueryVisible=!0),this.MaxDlgWidth=900,this.DynamicGroup=[]):(this.SelectAllDocVisible=!1,this.IsReportViewScreen=!1,this.OKVisibility=!1,this.DefaultVisibility=!0,this.MaxDlgWidth=790,this.DisplayName=this.Title=i.a.GetResource("Reports_Filters")),this.QuickSearch=new u.d,this.QuickSearch.Text="",this.QuickSearch.Visible=!1,this.ShowLevel=new u.d(0),this.ShowLevel.Visible=!1,this.ShowLevel.Text="7",this.ShowLevel.LblWidth="70",this.ShowLevel.Label=i.a.GetResource("Reports_LblShowLevel"),this.ShowAllTreeData=new n.a(0),this.ShowAllTreeData.Visible=!1,this.ShowAllTreeData.IsChecked=!0,this.ShowAllTreeData.Label=i.a.GetResource("Reports_LblShowAll"),this.ShowArchive=new n.a(0),this.ShowArchive.Visible=!1,this.ShowArchive.IsChecked=!0,this.ShowArchive.Label="Archive Data",this.Budget=new D.e(0),this.Budget.Visible=!1,this.Budget.Label="Budget",this.Budget.LblWidth="60",this.ActivityTypes=new D.b(0),this.ActivityTypes.Visible=!1,this.ActivityTypes.Label="Activity Features",this.UsersList=new D.b(0),this.UsersList.Visible=!1,this.UsersList.Label="Users",this.Fields=[],this.CostCenterFilters=[],this.tree=[],this.DisplayMessage="",this.TreeFilter="",this.ParentViewModel.StaticReportType<=0&&(this.CostCenters=new D.e(0),this.CostCenters.Label=i.a.GetResource("Reports_SelectCostCenter"),this.CostCenters.LblWidth="160",this.CostCenters.SelectionChangedCommand.Subscribe(this,"OnCostCenterChange"),null!=this.ParentViewModel.FieldsDialog&&null!=this.ParentViewModel.FieldsDialog.ReportFilterCostCenterList)){let e=this.ParentViewModel.FieldsDialog.ReportFilterCostCenterList,t={FeatureID:-100,Name:"Bill Of Material Documents"};e.push(t),e.sort((e,t)=>e.Name>t.Name?1:-1);let s=new m.c;if(this.IsReportViewScreen&&this.oReport.Preferences.ContainsKey("TreeDimensionsFilter")){let o=[],a=new l.f;a.LoadXml("<XML>"+this.oReport.Preferences.TreeDimensionsFilter+"</XML>");for(let l=0;l<a.DocumentElement.childNodes.length;l++){let n=a.DocumentElement.childNodes[l],r=e.filter(e=>e.FeatureID==n.attributes.CCID.value);r.length>0&&(t={},t.Name=r[0].Name,t.FeatureID=r[0].FeatureID,null!=n.attributes.Mandatory&&(t.Mandatory="1"!=i.a.SessionManager.UserID&&"1"!=i.a.SessionManager.RoleID||this.ParentViewModel.ReportViewType!=h.e.DashBoard&&this.ParentViewModel.ReportViewType!=h.e.Export?n.attributes.Mandatory.value:null),null!=n.attributes.PRID&&(s.push(parseInt(t.FeatureID),n),this.lstPreFetchReportCC.ContainsKey(parseInt(n.attributes.PRID.value))||this.lstPreFetchReportCC.push(parseInt(n.attributes.PRID.value),parseInt(t.FeatureID))),o.push(t))}e=o}if(this.IsReportViewScreen&&-1==this.oReport.StaticReportType){if(this.oReport.Preferences.Filters.length>0){let t=new l.f;t.LoadXml("<XML>"+this.oReport.Preferences.Filters+"</XML>");for(let s=0;s<t.DocumentElement.childNodes.length;s++){let o=l.f.SelectNodes(t.DocumentElement.childNodes[s],"Filter");for(let t=0;t<o.length;t++){let s=o[t];if(s.attributes.MapField.value.startsWith("CC_")){let t=0,o=0;if(s.attributes.MapField.value.startsWith("CC_44_")?(t=44,o=l.e.Int(s.attributes.MapField.value.substr(6))):t=l.e.Int(s.attributes.MapField.value.substr(3)),t>0&&44!=t){if(0==this.CostCenters.Items.filter(e=>e.Value==t.toString()).length){let s=e.filter(e=>e.FeatureID==t);s.length>0&&(this.CostCenters.Items.push(D.d.ComboBoxItems_2(s[0].Name.toString(),s[0].FeatureID.toString())),this.IsReportViewScreen&&this.oReport.Preferences.ContainsKey("TreeDimensionsFilter")&&(this.CostCenters.Items[this.CostCenters.Items.length-1].Aliasname=l.e.String(s[0].Mandatory)))}if(null!=s.attributes.PRID){null==this.Report&&(this.Report=[]);let e=this.CostCenters.Items.find(e=>"50"==e.Value&&e.Parent==s.attributes.PRID.value);null!=e||(e=D.d.ComboBoxItems_3(s.attributes.PRName.value,"50",s.attributes.PRID.value),e.Seq=t,this.CostCenters.Items.push(e))}}}}}}}else s.keys.forEach(e=>{null==this.Report&&(this.Report=[]);let t=this.CostCenters.Items.find(t=>"50"==t.Value&&t.Parent==s[e].attributes.PRID.value);null!=t||(t=D.d.ComboBoxItems_3(s[e].attributes.PRName.value,"50",s[e].attributes.PRID.value),t.Seq=e,this.CostCenters.Items.push(t))}),e.forEach(e=>{this.CostCenters.Items.push(D.d.ComboBoxItems_2(i.a.GetResource(e.Name.toString()),e.FeatureID.toString())),this.IsReportViewScreen&&this.oReport.Preferences.ContainsKey("TreeDimensionsFilter")&&(this.CostCenters.Items[this.CostCenters.Items.length-1].Aliasname=l.e.String(e.Mandatory))})}}LoadEditData(e){let t=null,s=l.f.SelectSingleNode(e,"TreeFilter");if(this.IsReportViewScreen&&(0==this.ParentViewModel.StaticReportType||-1==this.ParentViewModel.StaticReportType)&&this.ParentViewModel.ReportViewType!=h.e.Export&&!i.a.SessionManager.IsWinServiceCall){if("True"==i.a.SessionManager.Preferences.EnableDivisionWise.toString()&&"True"==i.a.SessionManager.Preferences["DW Reports"]){let t=this.CostCenters.Items.find(e=>"50001"==e.Value);t&&(t.Aliasname="");let o=null,a=l.f.SelectNodes(e,"TreeFilter/FilterDef");for(let e=0;e<a.length;e++){let t=a[e];if("50001"==l.f.SelectSingleNodeText(t,"CCID")){o=t;break}}if(null==o){let e=0==l.f.SelectNodes(s,"FilterDef").length?"1":"0";e=0==i.a.SessionManager.DivisionID?"<CCID>50001</CCID><GridViewID>0</GridViewID><IsDefaultCC>"+e+"</IsDefaultCC><DefaultValues>"+i.a.SessionManager.DivisionWhere+"</DefaultValues>":"<CCID>50001</CCID><GridViewID>0</GridViewID><IsDefaultCC>"+e+"</IsDefaultCC><DefaultValues>"+i.a.SessionManager.DivisionID+"</DefaultValues>",e="<FilterDef>"+e+"</FilterDef>",l.f.AppendChild(s,e)}else{let e=l.f.SelectSingleNode(o,"DefaultValues");if(null!=e)if(0==e.innerHTML.length)e.innerHTML=0!=i.a.SessionManager.DivisionID?i.a.SessionManager.DivisionID.toString():i.a.SessionManager.DivisionWhere;else{let t=e.innerHTML.split(","),s=i.a.SessionManager.DivisionWhere.split(","),o="";t.forEach(e=>{s.Contains(e)&&(o.length>0&&(o+=","),o+=e)}),e.innerHTML=o}}}if("True"==i.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==i.a.SessionManager.Preferences["LW Reports"]){let t=this.CostCenters.Items.find(e=>"50002"==e.Value);t&&(t.Aliasname="");let o=null,a=l.f.SelectNodes(e,"TreeFilter/FilterDef");for(let e=0;e<a.length;e++){let t=a[e];if("50002"==l.f.SelectSingleNodeText(t,"CCID")){o=t;break}}if(null==o){let e=0==l.f.SelectNodes(s,"FilterDef").length?"1":"0";e=this.ParentViewModel.Preferences.ContainsKey("SelectAllLocations")||0==i.a.SessionManager.LocationID?"<CCID>50002</CCID><GridViewID>0</GridViewID><IsDefaultCC>"+e+"</IsDefaultCC><DefaultValues>"+i.a.SessionManager.LocationWhere+"</DefaultValues>":"<CCID>50002</CCID><GridViewID>0</GridViewID><IsDefaultCC>"+e+"</IsDefaultCC><DefaultValues>"+i.a.SessionManager.LocationID+"</DefaultValues>",e="<FilterDef>"+e+"</FilterDef>",l.f.AppendChild(s,e)}else{let e=l.f.SelectSingleNode(o,"DefaultValues");if(null!=e)if(this.ParentViewModel.Preferences.ContainsKey("SelectAllLocations")&&"1"==this.ParentViewModel.Preferences.SelectAllLocations)e.innerHTML=i.a.SessionManager.LocationWhere;else if(0==e.innerHTML.length)e.innerHTML=0!=i.a.SessionManager.LocationID?i.a.SessionManager.LocationID.toString():i.a.SessionManager.LocationWhere;else{let t=e.innerHTML.split(","),s=i.a.SessionManager.LocationWhere.split(","),o="";t.forEach(e=>{s.Contains(e)&&(o.length>0&&(o+=","),o+=e)}),e.innerHTML=o}}}}if(this.IsReportViewScreen&&"1"!=i.a.SessionManager.UserID&&"1"!=i.a.SessionManager.RoleID&&null!=this.CostCenters){let t=i.a.SessionManager.Preferences.ContainsKey("Dimension List")?i.a.SessionManager.Preferences["Dimension List"].split(","):[],o=this.CostCenters.Items.filter(e=>"1"==e.Aliasname);for(let a=0;a<o.length;a++){let n=o[a],r="",h="";if(t.Contains(n.Value)&&parseInt(n.Value)>5e4){let e=i.a.report.IsGroupNode(parseInt(n.Value),0),t=i.a.report.DataSet("RPT017",e.TableName,n.Value,i.a.SessionManager.UserID);h=r="",t.Tables[0].forEach(e=>{r.length>0&&(r+=","),r+=e.NodeID.toString()})}let u=null,D=l.f.SelectNodes(e,"TreeFilter/FilterDef");for(let e=0;e<D.length;e++){let t=D[e];if(l.f.SelectSingleNodeText(t,"CCID")==n.Value){u=t;break}}if(null==u){let e;e=0==l.f.SelectNodes(s,"FilterDef").length?"<CCID>"+n.Value+"</CCID><GridViewID>0</GridViewID><IsDefaultCC>1</IsDefaultCC><DefaultValues>"+r+"</DefaultValues>":"<CCID>"+n.Value+"</CCID><GridViewID>0</GridViewID><IsDefaultCC>0</IsDefaultCC><DefaultValues>"+r+"</DefaultValues>",e="<FilterDef>"+e+"</FilterDef>",l.f.AppendChild(s,e)}else{let e=l.f.SelectSingleNode(u,"DefaultValues");null!=e&&0==e.innerHTML.length&&(e.innerHTML=r)}}}if(i.a.SessionManager.LoginDimension>0){let e=null,t="2";i.a.SessionManager.LoginDimension>0&&(t=i.a.SessionManager.LoginDimension.toString());let o=l.f.SelectNodes(s,"FilterDef");for(let s=0;s<o.length;s++){let i=o[s];if(l.f.SelectSingleNodeText(i,"CCID")==t){e=i;break}}if(null==e){let e;e=0==l.f.SelectNodes(s,"FilterDef").length?"<CCID>"+t+"</CCID><GridViewID>0</GridViewID><IsDefaultCC>1</IsDefaultCC><DefaultValues>"+i.a.SessionManager.ESSID+"</DefaultValues>":"<CCID>"+t+"</CCID><GridViewID>0</GridViewID><IsDefaultCC>0</IsDefaultCC><DefaultValues>"+i.a.SessionManager.ESSID+"</DefaultValues>",e="<FilterDef>"+e+"</FilterDef>",l.f.AppendChild(s,e)}else{let t=l.f.SelectSingleNode(e,"DefaultValues");null!=t&&(t.innerHTML=i.a.SessionManager.ESSID.toString())}}if(this.IsReportViewScreen&&this.oReport.Preferences.ContainsKey("SelectAllWFDocs")){let t=i.a.report.GetDataTable("RPT018",this.oReport.Preferences.SelectAllWFDocs,i.a.SessionManager.RoleID,i.a.SessionManager.UserID),o="";t.forEach(e=>{o.length>0&&(o+=","),o+=e.CostCenterID.toString()});let a=null,n=l.f.SelectNodes(e,"TreeFilter/FilterDef");for(let e=0;e<n.length;e++){let t=n[e];if("300"==l.f.SelectSingleNodeText(t,"CCID")){a=t;break}}if(null==a)l.f.AppendChild(s,"<FilterDef><CCID>300</CCID><GridViewID>0</GridViewID><IsDefaultCC>0</IsDefaultCC><DefaultValues>"+o+"</DefaultValues></FilterDef>");else{let e=a.SelectSingleNode("DefaultValues");null!=e&&(e.innerHTML=o)}}this.CostCenterFilters.Clear(),this.ParentViewModel.IgnoreTreeLoad=this.ParentViewModel.ReportViewType!=h.e.General&&this.ParentViewModel.ReportViewType!=h.e.LoadWebReport;let o=!1,a=l.f.SelectNodes(e,"TreeFilter/FilterDef/IsDefaultCC");if(a.length>0){for(let e=0;e<a.length;e++)if("1"==a[e].innerHTML){o=!0;break}o||(a[0].innerHTML="1")}let n=l.f.SelectNodes(e,"TreeFilter/FilterDef");for(let i=0;i<n.length;i++){let e=n[i],s=l.f.SelectSingleNodeText(e,"CCID"),o=this.CostCenters.Items.find(e=>e.Value==s);if(!o)continue;if(this.LookupTypeID="44"==s&&null!=l.f.SelectSingleNode(e,"LookupTypeID")?parseInt(l.f.SelectSingleNodeText(e,"LookupTypeID")):0,"44"==o.Value&&o.Parent!=this.LookupTypeID.toString())continue;let a=new _.a(parseInt(s),this.LookupTypeID.toString(),o.Name,this);a.SetSelectedNodes(e),a.IsVisible||this.CostCenters.Items.Remove(o),"1"==l.f.SelectSingleNodeText(e,"IsDefaultCC")&&(o.ExchgRate=1,this.TreeCCID=parseInt(s),this.GridViewID=null!=l.f.SelectSingleNode(e,"GridViewID")?parseInt(l.f.SelectSingleNodeText(e,"GridViewID")):0),this.ParentViewModel.IgnoreTreeLoad||"1"==l.f.SelectSingleNodeText(e,"IsDefaultCC")&&(this.CostCenters.SelectedValue=s,this.CostCenters.SelectedItem=o,this.LoadCostCenterTree(this.TreeCCID,this.LookupTypeID,this.GridViewID,a.SelectedNodes),this.tree.length>0&&(t=this.tree[0])),"1"==o.Aliasname&&(a.DeleteButtonVisibility=!1),this.CostCenterFilters.push(a)}null!=t&&this.tree[0]!=t&&(this.tree.Clear(),this.tree.push(t),this.SelectedNodes=t.SelectedNodes,this.SelectedNode=t.SelectedNode);let u=l.f.SelectNodes(e,"FieldFilter/FilterDef");for(let h=0;h<u.length;h++){let e=u[h],t=new r.a(this);t.ID=null!=l.f.SelectSingleNode(e,"ID")?l.f.SelectSingleNodeText(e,"ID"):"F"+l.e.NewGuid().Replace("-","");let s=new d.a;s.CategoryValue=parseInt(l.f.SelectSingleNodeText(e,"CCID")),s.FieldValue=parseInt(l.f.SelectSingleNodeText(e,"CCColID"));let o="";null!=l.f.SelectSingleNode(e,"SelectedField")&&(o=l.f.SelectSingleNodeText(e,"SelectedField")),this.ParentViewModel.FieldsDialog.SetCDGDO_ColID(s,o),t.CallBackFieldSelection(s),null!=l.f.SelectSingleNode(e,"Caption")&&(t.Caption.Text=i.a.GetResource(l.f.SelectSingleNodeText(e,"Caption")));let a=l.f.SelectSingleNode(e,"Condition");if(null==a&&(a=l.f.SelectSingleNode(e,"IsRange")),t.Condition.SelectedValue=a.innerHTML,t.Condition.SetSelectedItem(t.Condition.SelectedValue),t.OnConditionSelectionChanged(t.Condition.SelectedValue),null!=l.f.SelectSingleNode(e,"HideInReport")&&"1"==l.f.SelectSingleNodeText(e,"HideInReport")?(t.HideFilter.IsChecked=!0,this.IsReportViewScreen&&(t.IsVisible=!1)):t.HideFilter.IsChecked=!1,this.IsReportViewScreen?this.ParentViewModel.IsPreProcessQuery&&(null!=l.f.SelectSingleNode(e,"IsPrePocessFilter")?t.IsPrePocessFilter=!0:t.IsVisible=!1):null!=l.f.SelectSingleNode(e,"IsPrePocessFilter")&&(t.IsPrePocessFilter=!0),null!=l.f.SelectSingleNode(e,"QuickSearchField")?(t.QuickSearchField.IsChecked=!0,this.IsReportViewScreen&&(t.IsVisible=!1)):t.QuickSearchField.IsChecked=!1,t.QuerySearchField.IsChecked=null!=l.f.SelectSingleNode(e,"QuerySearchField"),"DATE"==t.CDGDO.DataType)"FUTURE"==a.innerHTML||"PAST"==a.innerHTML?(t.FromValue.TextBox.Text=l.f.SelectSingleNodeText(e,"DefaultFromVal"),t.FromValue.ComboBox.SelectedValue=null!=l.f.SelectSingleNode(e,"DefaultFromDateVal")?l.f.SelectSingleNodeText(e,"DefaultFromDateVal"):"Days",304!=this.oReport.ReportID&&305!=this.oReport.ReportID||!i.a.IsMobile||(t.FromValue.TextBox.Text="1",t.FromValue.ComboBox.SelectedValue="Weeks")):this.IsReportViewScreen?(t.FromDatePicker.Date=I.GetDateFromKeyWord(l.f.SelectSingleNodeText(e,"DefaultFromVal")),"Between"!=a.innerHTML&&"NotBetween"!=a.innerHTML||(t.ToDatePicker.Date=I.GetDateFromKeyWord(l.f.SelectSingleNodeText(e,"DefaultToVal"))),t.FromDatePicker.Visible&&null!=l.f.SelectSingleNode(e,"ShowDateMonthYear")&&(t.FromDatePicker.ShowMonthYear=!0),t.ToDatePicker.Visible&&null!=l.f.SelectSingleNode(e,"ShowDateMonthYear")&&(t.ToDatePicker.IsFromDate=!1,t.ToDatePicker.ShowMonthYear=!0)):(t.FromDate.SelectedValue=l.f.SelectSingleNodeText(e,"DefaultFromVal"),"Between"!=a.innerHTML&&"NotBetween"!=a.innerHTML||(t.ToDate.SelectedValue=l.f.SelectSingleNodeText(e,"DefaultToVal")),t.FromDate.Visible&&null!=l.f.SelectSingleNode(e,"ShowDateMonthYear")&&(t.FromDate.IsColumnUserDefined=!0));else{if(t.FromList.Visible){let s=l.e.Int(l.f.SelectSingleNodeText(e,"DefaultFromVal"));t.FromList.SelectedValue=s}else t.FromValue.TextBox.Text=l.f.SelectSingleNodeText(e,"DefaultFromVal");if("Between"==a.innerHTML||"NotBetween"==a.innerHTML)if(t.ToList.Visible){let s=l.e.Int(l.f.SelectSingleNodeText(e,"DefaultToVal"));t.ToList.SelectedValue=s}else t.ToValue.Text=l.f.SelectSingleNodeText(e,"DefaultToVal")}this.IsReportViewScreen&&t.QuickSearchField.IsChecked&&(this.QuickSearch.Visible=!0,t.FromValue.TextBox=this.QuickSearch),this.Fields.push(t)}i.a.SessionManager.RoleType>0&&(this.TreeVisibility=!1,this.CostCenterFilters.map(e=>e.IsVisible=!1))}LoadXml(e){let t=new l.f;if(t.LoadXml(e.ReportDefnXML.toString()),this.ParentViewModel.BaseReportColumns.Clear(),this.ParentViewModel.ReportGroups.Clear(),this.IsReportViewScreen&&null!=this.CostCenters&&this.oReport.Preferences.ContainsKey("ShowLookups")&&this.oReport.Preferences.ShowLookups.length>0){let e=new l.f;e.LoadXml("<XML>"+this.oReport.Preferences.ShowLookups+"</XML>");for(let t=0;t<e.DocumentElement.children.length;t++){let s=e.DocumentElement.children[t];this.CostCenters.Items.push(D.d.ComboBoxItems_3(s.attributes.Name.value,"44",s.attributes.ID.value))}}if(null!=t.SelectSingleNode("PactRevenURpts/PactRevenURptDef/ShowLevel")){this.ShowLevel.Text=t.SelectSingleNodeText("PactRevenURpts/PactRevenURptDef/ShowLevel"),this.ShowLevel.Visible=!0;let e=t.SelectSingleNode("PactRevenURpts/PactRevenURptDef/ShowAllTreeData");this.ShowAllTreeData.IsChecked=!(!e||"1"!=e.innerHTML),this.ShowAllTreeData.Visible=!0}null!=t.SelectSingleNode("PactRevenURpts/PactRevenURptDef/ShowArchive")&&(this.ShowArchive.Visible=!0,this.ShowArchive.IsChecked="1"==t.SelectSingleNodeText("PactRevenURpts/PactRevenURptDef/ShowArchive")),null!=t.SelectSingleNode("PactRevenURpts/PactRevenURptDef/BudgetReport")&&this.ShowBudgetData(t.SelectSingleNodeText("PactRevenURpts/PactRevenURptDef/BudgetReport"));let s=t.SelectNodes("PactRevenURpts/PactRevenURptDef/Columns/ColumnDef");for(let i=0;i<s.length;i++){let e=s[i],t=new d.b(null,!1);t.Caption.Text=l.f.SelectSingleNodeText(e,"Identity/Caption"),t.ID=l.f.SelectSingleNodeText(e,"Identity/ID"),t.CDGDO.CategoryValue=parseInt(l.f.SelectSingleNodeText(e,"Identity/Category")),t.CDGDO.FieldValue=parseInt(l.f.SelectSingleNodeText(e,"Identity/Field")),null!=l.f.SelectSingleNode(e,"Identity/Formula")&&(t.Formula.Text=l.f.SelectSingleNodeText(e,"Identity/Formula")),null!=l.f.SelectSingleNode(e,"Identity/Expression")&&(t.FormulaExpression=l.f.SelectSingleNodeText(e,"Identity/Expression")),null!=l.f.SelectSingleNode(e,"Identity/FormulaEvaluateAtEnd")&&(t.FormulaEvaluateAtEnd.SelectedValue=l.f.SelectSingleNodeText(e,"Identity/FormulaEvaluateAtEnd")),null!=l.f.SelectSingleNode(e,"Identity/ShowAssigned")&&(t.ShowAssigned.SelectedValue=l.f.SelectSingleNodeText(e,"Identity/ShowAssigned"),t.CDGDO.AssignedDimID=l.e.Int(t.ShowAssigned.SelectedValue));let o="";if(null!=l.f.SelectSingleNode(e,"Identity/SelectedField")&&(o=l.f.SelectSingleNodeText(e,"Identity/SelectedField")),this.ParentViewModel.FieldsDialog.SetCDGDO_ColID(t.CDGDO,o),0==t.CDGDO.FieldValue&&(t.CDGDO.DataType=l.f.SelectSingleNodeText(e,"Identity/Type")),t.SetDataType(),t.ALLOtherDocsVisible&&null!=l.f.SelectSingleNode(e,"Identity/ALLOtherDocuments")&&(t.CDGDO.ALLOtherDocuments=l.f.SelectSingleNodeText(e,"Identity/ALLOtherDocuments")),t.ExecutedDocument.Visible&&null!=l.f.SelectSingleNode(e,"Identity/ExecutedDocument")){t.CDGDO.ExecutedDocument=l.f.SelectSingleNodeText(e,"Identity/ExecutedDocument"),"0"==t.CDGDO.ExecutedDocument&&(t.CDGDO.ExecutedDocument="");let s=t.CDGDO.ExecutedDocument.split(",");t.ExecutedDocument.Items.forEach(e=>{e.IsChecked=!!s.Contains(e.Value)})}if(t.DimensionsFilterVisible&&null!=l.f.SelectSingleNode(e,"Identity/DimensionsFilter")&&(t.CDGDO.DimensionsFilter=l.f.SelectSingleNodeText(e,"Identity/DimensionsFilter")),t.AccountingDocument.Visible&&null!=l.f.SelectSingleNode(e,"Identity/AccountingDocument")){t.CDGDO.ExecutedDocument=l.f.SelectSingleNodeText(e,"Identity/AccountingDocument"),"0"==t.CDGDO.ExecutedDocument&&(t.CDGDO.ExecutedDocument="");let s=t.CDGDO.ExecutedDocument.split(",");t.AccountingDocument.Items.forEach(e=>{e.IsChecked=!!s.Contains(e.Value)})}if(null!=l.f.SelectSingleNode(e,"Identity/RepeatType")&&(t.RepeatType.SelectedValue=l.f.SelectSingleNodeText(e,"Identity/RepeatType"),null!=t.RepeatType.SelectedValue&&(t.RepeatNext.Text=l.f.SelectSingleNodeText(e,"Identity/RepeatNext"),t.RepeatOn.SelectedValue=l.f.SelectSingleNodeText(e,"Identity/RepeatOn"),t.RepeatEmptyColumns.SelectedValue=null!=l.f.SelectSingleNode(e,"Identity/RepeatEmptyColumns")&&"1"==l.f.SelectSingleNodeText(e,"Identity/RepeatEmptyColumns")?"1":"0",null!=l.f.SelectSingleNode(e,"Identity/RepeatPrevData")&&(t.RepeatPrevData.SelectedValue=l.f.SelectSingleNodeText(e,"Identity/RepeatPrevData"),null!=l.f.SelectSingleNode(e,"Identity/RepeatPrevDataFull")&&(t.RepeatPrevDataFull=!0),null!=l.f.SelectSingleNode(e,"Identity/RepeatPrevDiff")&&(t.RepeatPrevDiff=!0),null!=l.f.SelectSingleNode(e,"Identity/RepeatPrevPercent")&&(t.RepeatPrevPercent=!0),null!=l.f.SelectSingleNode(e,"Identity/RepeatPrevDataSeperately")&&(t.RepeatPrevDataSeperately=!0),null!=l.f.SelectSingleNode(e,"Identity/RepeatPrevDataOfCurrYr")&&(t.RepeatPrevDataOfCurrYr=!0)))),null!=l.f.SelectSingleNode(e,"Identity/UseOnce")&&(t.UseOnce.SelectedValue=l.f.SelectSingleNodeText(e,"Identity/UseOnce")),null!=l.f.SelectSingleNode(e,"Identity/ShowLevel")&&(t.ShowLevel.SelectedValue=l.f.SelectSingleNodeText(e,"Identity/ShowLevel")),this.IsReportViewScreen){let e=this.oReport.ColumnSourceALL.find(e=>e.ID==t.ID);if(e)if(null!=e.MappedColumnReports)t.IsReportMappingFilter=!0;else if(null!=e.MappedRowReports)for(let s=0;s<e.MappedRowReports.length;s++)if(l.f.SelectNodes(e.MappedRowReports[s],"Filters/ColumnFilter").find(e=>e.attributes.PID.value==t.ID)){t.IsReportMappingFilter=!0;break}}t.Width.Text=l.f.SelectSingleNodeText(e,"Width"),""!=l.f.SelectSingleNodeText(e,"HeaderAppearance/Alignment").Trim()&&(t.Alignment_Header.SelectedValue=l.f.SelectSingleNodeText(e,"HeaderAppearance/Alignment")),t.Font_Header.SelectedValue=l.f.SelectSingleNodeText(e,"HeaderAppearance/Font"),""!=l.f.SelectSingleNodeText(e,"HeaderAppearance/FontSize").Trim()&&(t.FontSize_Header.Text=l.f.SelectSingleNodeText(e,"HeaderAppearance/FontSize")),null!=l.f.SelectSingleNode(e,"HeaderAppearance/BackGrndColor")&&(t.BackgroundClr_Header.Text=l.f.SelectSingleNodeText(e,"HeaderAppearance/BackGrndColor")),null!=l.f.SelectSingleNode(e,"HeaderAppearance/ForeGrndColor")&&(t.ForegroundClr_Header.Text=l.f.SelectSingleNodeText(e,"HeaderAppearance/ForeGrndColor")),null!=l.f.SelectSingleNode(e,"HeaderAppearance/Visibility")&&(t.Visibility.SelectedValue=l.f.SelectSingleNodeText(e,"HeaderAppearance/Visibility")),null!=l.f.SelectSingleNode(e,"HeaderAppearance/PrintVisibility")&&(t.PrintVisibility.SelectedValue=l.f.SelectSingleNodeText(e,"HeaderAppearance/PrintVisibility")),null!=l.f.SelectSingleNode(e,"HeaderAppearance/Row")&&(t.Row.Text=l.f.SelectSingleNodeText(e,"HeaderAppearance/Row"),t.Column.Text=l.f.SelectSingleNodeText(e,"HeaderAppearance/Column")),t.Bold_Header.Enable=null!=l.f.SelectSingleNode(e,"HeaderAppearance/FontBold")&&Object(a.j)(l.f.SelectSingleNodeText(e,"HeaderAppearance/FontBold")),t.Italic_Header.Enable=null!=l.f.SelectSingleNode(e,"HeaderAppearance/FontItalics")&&Object(a.j)(l.f.SelectSingleNodeText(e,"HeaderAppearance/FontItalics")),t.Underline_Header.Enable=null!=l.f.SelectSingleNode(e,"HeaderAppearance/Underline")&&Object(a.j)(l.f.SelectSingleNodeText(e,"HeaderAppearance/Underline")),""!=l.f.SelectSingleNodeText(e,"DataAppearance/Alignment")&&(t.Alignment.SelectedValue=l.f.SelectSingleNodeText(e,"DataAppearance/Alignment")),""!=l.f.SelectSingleNodeText(e,"DataAppearance/FontSize")&&(t.FontSize.Text=l.f.SelectSingleNodeText(e,"DataAppearance/FontSize")),t.Font.SelectedValue=l.f.SelectSingleNodeText(e,"DataAppearance/Font"),null!=l.f.SelectSingleNode(e,"DataAppearance/BackGrndColor")&&(t.BackgroundClr.Text=l.f.SelectSingleNodeText(e,"DataAppearance/BackGrndColor")),null!=l.f.SelectSingleNode(e,"DataAppearance/ForeGrndColor")&&(t.ForegroundClr.Text=l.f.SelectSingleNodeText(e,"DataAppearance/ForeGrndColor")),t.Bold.Enable=null!=l.f.SelectSingleNode(e,"DataAppearance/FontBold")&&Object(a.j)(l.f.SelectSingleNodeText(e,"DataAppearance/FontBold")),t.Italic.Enable=null!=l.f.SelectSingleNode(e,"DataAppearance/FontItalics")&&Object(a.j)(l.f.SelectSingleNodeText(e,"DataAppearance/FontItalics")),t.Underline.Enable=null!=l.f.SelectSingleNode(e,"DataAppearance/Underline")&&Object(a.j)(l.f.SelectSingleNodeText(e,"DataAppearance/Underline")),null!=l.f.SelectSingleNode(e,"Format/Decimals")&&(t.Decimals.SelectedValue=l.f.SelectSingleNodeText(e,"Format/Decimals")),null!=l.f.SelectSingleNode(e,"Format/RoundOff")&&(t.RoundOff.Text=l.f.SelectSingleNodeText(e,"Format/RoundOff")),null!=l.f.SelectSingleNode(e,"Format/RoundOff_RT")&&(t.RoundOff_RT.Text=l.f.SelectSingleNodeText(e,"Format/RoundOff_RT")),null!=l.f.SelectSingleNode(e,"Format/RoundOff_ST")&&(t.SubTotalRoundOffs=l.f.SelectSingleNodeText(e,"Format/RoundOff_ST").split(";")),null!=l.f.SelectSingleNode(e,"Format/Commas")&&(t.Commas.SelectedValue=l.f.SelectSingleNodeText(e,"Format/Commas")),null!=l.f.SelectSingleNode(e,"Format/Currency")&&(t.Currency.SelectedValue=l.f.SelectSingleNodeText(e,"Format/Currency")),null!=l.f.SelectSingleNode(e,"Format/NegativeNumber")&&(t.NegativeNumber.SelectedIndex=parseInt(l.f.SelectSingleNodeText(e,"Format/NegativeNumber"))),null!=l.f.SelectSingleNode(e,"Format/PercentageOn")&&(t.PercentageOn.SelectedValue=l.f.SelectSingleNodeText(e,"Format/PercentageOn")),null!=l.f.SelectSingleNode(e,"Format/PrevRowValue")&&(t.PrevRowValue.SelectedValue=l.f.SelectSingleNodeText(e,"Format/PrevRowValue")),null!=l.f.SelectSingleNode(e,"Format/Sort")&&(t.Sort.SelectedValue=l.f.SelectSingleNodeText(e,"Format/Sort")),null!=l.f.SelectSingleNode(e,"Format/SuppressZero")&&(t.SuppressZero.SelectedValue=l.f.SelectSingleNodeText(e,"Format/SuppressZero")),null!=l.f.SelectSingleNode(e,"Format/Expression")&&(t.Expression.Text=l.f.SelectSingleNodeText(e,"Format/Expression")),null!=l.f.SelectSingleNode(e,"Format/ColumnFilterExpression")&&(t.ColumnFilterExpression=l.f.SelectSingleNodeText(e,"Format/ColumnFilterExpression")),null!=l.f.SelectSingleNode(e,"Format/WrapText")&&(t.WrapText.SelectedValue=l.f.SelectSingleNodeText(e,"Format/WrapText")),null!=l.f.SelectSingleNode(e,"Format/WrapTextPrint")&&(t.WrapTextPrint.SelectedValue=l.f.SelectSingleNodeText(e,"Format/WrapTextPrint")),null!=l.f.SelectSingleNode(e,"Format/DateType")&&(t.DateType.Text=l.f.SelectSingleNodeText(e,"Format/DateType")),null!=l.f.SelectSingleNode(e,"Format/PrintChars")&&(t.PrintChars.Text=l.f.SelectSingleNodeText(e,"Format/PrintChars")),null!=l.f.SelectSingleNode(e,"Format/PrintOnce")&&(t.PrintOnce.SelectedValue=l.f.SelectSingleNodeText(e,"Format/PrintOnce")),null!=l.f.SelectSingleNode(e,"Linking/Type")&&(t.LinkType.SelectedValue=l.f.SelectSingleNodeText(e,"Linking/Type")),t.OnSelectionChanged("LinkType"),null!=l.f.SelectSingleNode(e,"Linking/Dimension")?t.LinkDimension.SelectedValue=l.f.SelectSingleNodeText(e,"Linking/Dimension"):"6"==t.LinkType.SelectedValue&&(t.LinkReport.Visible=!0,null!=l.f.SelectSingleNode(e,"Linking/Report")&&(t.LinkReport.SelectedValue=l.f.SelectSingleNodeText(e,"Linking/Report"))),this.ParentViewModel.BaseReportColumns.push(t)}let o=t.SelectNodes("PactRevenURpts/PactRevenURptDef/Groups/GroupDef");for(let i=0;i<o.length;i++){let e=o[i],t=null;if("1"==l.f.SelectSingleNodeText(e,"Identity/ShowAsColumn"))for(let o=0;o<this.ParentViewModel.BaseReportColumns.length;o++){let s=this.ParentViewModel.BaseReportColumns[o];if(s.ID==l.f.SelectSingleNodeText(e,"Identity/ID")){t=s,t.IsGroup=!0,t.ShowAsColumn.SelectedValue="1";break}}null==t&&(t=new d.b(null,!0),t.ShowAsColumn.SelectedValue="0"),t.ID=l.f.SelectSingleNodeText(e,"Identity/ID"),t.Type.Text="Group",t.CDGDO.CategoryValue=parseInt(l.f.SelectSingleNodeText(e,"Identity/Category")),t.CDGDO.FieldValue=parseInt(l.f.SelectSingleNodeText(e,"Identity/Field"));let s="";if(null!=l.f.SelectSingleNode(e,"Identity/SelectedField")&&(s=l.f.SelectSingleNodeText(e,"Identity/SelectedField")),this.ParentViewModel.FieldsDialog.SetCDGDO_ColID(t.CDGDO,s),0==t.CDGDO.FieldValue&&(t.CDGDO.DataType=l.f.SelectSingleNodeText(e,"Identity/Type")),t.SetDataType(),""!=l.f.SelectSingleNodeText(e,"Identity/Prefix").Trim()&&(t.Prefix.Text=l.f.SelectSingleNodeText(e,"Identity/Prefix")),null!=l.f.SelectSingleNode(e,"Identity/Formula")&&(t.Formula.Text=l.f.SelectSingleNodeText(e,"Identity/Formula")),null!=l.f.SelectSingleNode(e,"Identity/Expression")&&(t.FormulaExpression=l.f.SelectSingleNodeText(e,"Identity/Expression")),""!=l.f.SelectSingleNodeText(e,"Appearance/Alignment").Trim()&&(t.Alignment.SelectedValue=l.f.SelectSingleNodeText(e,"Appearance/Alignment")),""!=l.f.SelectSingleNodeText(e,"Appearance/FontSize").Trim()&&(t.FontSize.Text=l.f.SelectSingleNodeText(e,"Appearance/FontSize")),null!=l.f.SelectSingleNode(e,"Appearance/BackGrndColor")&&(t.BackgroundClr.Text=l.f.SelectSingleNodeText(e,"Appearance/BackGrndColor")),null!=l.f.SelectSingleNode(e,"Appearance/ForeGrndColor")&&(t.ForegroundClr.Text=l.f.SelectSingleNodeText(e,"Appearance/ForeGrndColor")),null!=l.f.SelectSingleNode(e,"Appearance/Visibility")&&(t.Visibility.SelectedValue=l.f.SelectSingleNodeText(e,"Appearance/Visibility")),null!=l.f.SelectSingleNode(e,"Appearance/PrintVisibility")&&(t.PrintVisibility.SelectedValue=l.f.SelectSingleNodeText(e,"Appearance/PrintVisibility")),""!=l.f.SelectSingleNodeText(e,"Appearance/Width").Trim()&&(t.Width.Text=l.f.SelectSingleNodeText(e,"Appearance/Width")),""!=l.f.SelectSingleNodeText(e,"Appearance/Height").Trim()&&(t.Height.Text=l.f.SelectSingleNodeText(e,"Appearance/Height")),null!=l.f.SelectSingleNode(e,"Appearance/FontBold")&&(t.Bold.Enable=Object(a.j)(l.f.SelectSingleNodeText(e,"Appearance/FontBold"))),null!=l.f.SelectSingleNode(e,"Appearance/FontItalics")&&(t.Italic.Enable=Object(a.j)(l.f.SelectSingleNodeText(e,"Appearance/FontItalics"))),null!=l.f.SelectSingleNode(e,"Appearance/Underline")&&(t.Underline.Enable=Object(a.j)(l.f.SelectSingleNodeText(e,"Appearance/Underline"))),t.Font.SelectedValue=l.f.SelectSingleNodeText(e,"Appearance/Font"),null!=l.f.SelectSingleNode(e,"Format/Decimals")&&(t.Decimals.SelectedValue=l.f.SelectSingleNodeText(e,"Format/Decimals")),null!=l.f.SelectSingleNode(e,"Format/RoundOff")&&(t.RoundOff.Text=l.f.SelectSingleNodeText(e,"Format/RoundOff")),null!=l.f.SelectSingleNode(e,"Format/Commas")&&(t.Commas.SelectedValue=l.f.SelectSingleNodeText(e,"Format/Commas")),null!=l.f.SelectSingleNode(e,"Format/Currency")&&(t.Currency.SelectedValue=l.f.SelectSingleNodeText(e,"Format/Currency")),null!=l.f.SelectSingleNode(e,"Format/NegativeNumber")&&(t.NegativeNumber.SelectedIndex=parseInt(l.f.SelectSingleNodeText(e,"Format/NegativeNumber"))),null!=l.f.SelectSingleNode(e,"Format/Expression")&&(t.Expression.Text=l.f.SelectSingleNodeText(e,"Format/Expression")),null!=l.f.SelectSingleNode(e,"Format/ColumnFilterExpression")&&(t.ColumnFilterExpression=l.f.SelectSingleNodeText(e,"Format/ColumnFilterExpression")),null!=l.f.SelectSingleNode(e,"Format/Sort")&&(t.Sort.SelectedValue=l.f.SelectSingleNodeText(e,"Format/Sort")),null!=l.f.SelectSingleNode(e,"Format/WrapText")&&(t.WrapText.SelectedValue=l.f.SelectSingleNodeText(e,"Format/WrapText")),null!=l.f.SelectSingleNode(e,"Format/WrapTextPrint")&&(t.WrapTextPrint.SelectedValue=l.f.SelectSingleNodeText(e,"Format/WrapTextPrint")),null!=l.f.SelectSingleNode(e,"Format/SuppressZero")&&(t.SuppressZero.SelectedValue=l.f.SelectSingleNodeText(e,"Format/SuppressZero")),null!=l.f.SelectSingleNode(e,"Format/DateType")&&(t.DateType.Text=l.f.SelectSingleNodeText(e,"Format/DateType")),null!=l.f.SelectSingleNode(e,"Linking/Type")&&(t.LinkType.SelectedValue=l.f.SelectSingleNodeText(e,"Linking/Type")),this.ParentViewModel.ReportGroups.push(t),this.oReport.Preferences.ContainsKey("AllowGroupChange")){let e=new d.c(this.oReport,t);e.Caption="Group "+(this.DynamicGroup.length+1),this.DynamicGroup.push(e)}}if(this.ParentViewModel.BaseReportColumns.filter(e=>144==e.CDGDO.CategoryValue).length>0||this.ParentViewModel.ReportGroups.filter(e=>144==e.CDGDO.CategoryValue).length>0){let t=(new c.a).GetScreenInfo(1e3);this.ActivityTypes.Visible=!0;let s=null;if(null!=t&&t.Tables.length>4){let o=t.Tables[4].filter(e=>"CalendarFeaturesList"==e.Name);if(o.length>0){let e=null;for(let s=8;s<t.Tables.length;s++)if(t.Columns[s].Contains("DocumentName")&&t.Columns[s].Contains("CostCenterID")){e=t.Tables[s];break}if(this.ActivityTypes.Items.push(D.c.CheckedListBoxItem_3("Calendar","1000")),""!=o[0].Value.toString()&&(s=o[0].Value.toString().split(";"),null!=s&&s.length>0))for(let t=0;t<s.length;t++)if("86"==s[t].toString())this.ActivityTypes.Items.push(D.c.CheckedListBoxItem_3("Leads","86"));else if("73"==s[t].toString())this.ActivityTypes.Items.push(D.c.CheckedListBoxItem_3("Cases","73"));else if("88"==s[t].toString())this.ActivityTypes.Items.push(D.c.CheckedListBoxItem_3("Campaign","88"));else if("89"==s[t].toString())this.ActivityTypes.Items.push(D.c.CheckedListBoxItem_3("Opportunity","89"));else if("83"==s[t].toString())this.ActivityTypes.Items.push(D.c.CheckedListBoxItem_3("CRM-Customers","83"));else if("65"==s[t].toString())this.ActivityTypes.Items.push(D.c.CheckedListBoxItem_3("Contacts","65"));else if("122"==s[t].toString())this.ActivityTypes.Items.push(D.c.CheckedListBoxItem_3("FollowUp","122"));else if("95"==s[t].toString())this.ActivityTypes.Items.push(D.c.CheckedListBoxItem_3("Sales Contract","95"));else if("128"==s[t].toString())this.ActivityTypes.Items.push(D.c.CheckedListBoxItem_3("Campaign Events","128"));else if(null!=e){let o=e.filter(e=>e.CostCenterID==s[t]);o.length>0&&this.ActivityTypes.Items.push(D.c.CheckedListBoxItem_3(o[0].DocumentName.toString(),o[0].CostCenterID.toString()))}}if(this.ActivityTypes.Visible){let t=new l.f;if(""!=e.DefaultPreferences.toString()&&(t.LoadXml(e.DefaultPreferences.toString()),!l.e.IsEmpty(t.SelectSingleNodeText("XML/ActivityTypes")))){let e=l.f.SelectSingleNode(t,"XML/ActivityTypes");if(null!=e&&e.length>0){let t=e.split(",");for(let e=0;e<t.length;e++){let s=this.ActivityTypes.Items.find(s=>s.Value==t[e].toString().Trim());s&&(s.IsChecked=!0)}}}}}}if(this.ParentViewModel.BaseReportColumns.filter(e=>25144==e.CDGDO.FieldValue).length>0||this.ParentViewModel.BaseReportColumns.filter(e=>25144==e.CDGDO.ParentCCDefaultColID).length>0||this.ParentViewModel.ReportGroups.filter(e=>25144==e.CDGDO.FieldValue).length>0||this.ParentViewModel.ReportGroups.filter(e=>25144==e.CDGDO.ParentCCDefaultColID).length>0){let e=null;if(e="1"==i.a.SessionManager.UserID?i.a.report.DataSet("RPT012",""):i.a.report.DataSet("RPT013",i.a.SessionManager.UserID),"1"!=i.a.SessionManager.UserID&&this.UsersList.Items.push(D.c.CheckedListBoxItem_3(i.a.SessionManager.UserName,i.a.SessionManager.UserID.toString())),null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&e.Columns[0].Contains("UserName"))for(let t=0;t<e.Tables[0].length;t++)i.a.SessionManager.UserID.toString(),e.Tables[0][t].UserID.toString(),this.UsersList.Items.push(D.c.CheckedListBoxItem_5(e.Tables[0][t].UserName.toString(),e.Tables[0][t].UserID.toString(),!0));this.UsersList.Visible=!0}if((this.ParentViewModel.StaticReportType<=0||110==this.ParentViewModel.StaticReportType||144==this.ParentViewModel.StaticReportType)&&this.LoadEditData(t.SelectSingleNode("PactRevenURpts/Filters/PreDataFetch")),this.IsReportViewScreen){let e=t.SelectSingleNode("PactRevenURpts/Filters/PreDataFetch/RowFiltersXML");null!=e&&(this.ParentViewModel.RowFiltersXML=e.OuterXml,this.ParentViewModel.RowFiltersWhere=d.d.GetRowFilter(this.ParentViewModel.RowFiltersXML,this.ParentViewModel.StaticReportType))}if(this.IsReportViewScreen){for(let e=0;e<this.oReport.ChildReports.length;e++){let t=this.oReport.ChildReports[e];if(null!=t.xDocMap){if(null==this.ParentViewModel.oReportDialog){let e=l.f.SelectNodes(t.xDocMap.DocumentElement,"Filters/FieldFilter");for(let s=0;s<e.length;s++){let o=e[s],i=t.ParentReport.Filter.Fields.find(e=>e.CDGDO.FieldValue==parseInt(o.attributes.PID.value));if(i)if(null!=t.oReportDialog)"1"==o.attributes.CID.value&&(t.oReportDialog.ParentReportDateFilter=i);else{let e=t.Filter.Fields.find(e=>e.CDGDO.FieldValue==parseInt(o.attributes.CID.value));e&&(e.ParentReportFilter=i,e.Condition=e.ParentReportFilter.Condition,e.FromValue=e.ParentReportFilter.FromValue,e.ToValue=e.ParentReportFilter.ToValue,e.FromDate=e.ParentReportFilter.FromDate,e.ToDate=e.ParentReportFilter.ToDate,e.FromDatePicker=e.ParentReportFilter.FromDatePicker,e.ToDatePicker=e.ParentReportFilter.ToDatePicker,e.FromList=e.ParentReportFilter.FromList,e.ToList=e.ParentReportFilter.ToList)}else if("1"==o.attributes.PID.value&&this.ParentViewModel.StaticReportType>0){null!=t.oReportDialog&&(t.oReportDialog.FromDate.ExternExpression="APPLYDATEFILTER");let e=t.Filter.Fields.find(e=>e.CDGDO.FieldValue==parseInt(o.attributes.CID.value));e&&(e.Temp="STATIC DATE FILTER")}}}else{let e=l.f.SelectNodes(t.xDocMap.DocumentElement,"Filters/FieldFilter");for(let s=0;s<e.length;s++){let o=e[s];if(null!=t.oReportDialog)t.oReportDialog.FromDate=this.ParentViewModel.oReportDialog.FromDate,t.oReportDialog.ToDate=this.ParentViewModel.oReportDialog.ToDate;else{let e=t.Filter.Fields.find(e=>e.CDGDO.FieldValue==parseInt(o.attributes.CID.value));e&&(e.FromDatePicker=this.ParentViewModel.oReportDialog.FromDate,e.ToDatePicker=this.ParentViewModel.oReportDialog.ToDate)}}}null!=t.oReportDialog&&(t.Filter.CostCenterFilters=t.oReportDialog.CostCenterFilters);let e=l.f.SelectNodes(t.xDocMap.DocumentElement,"Filters/TreeFilter");for(let s=0;s<e.length;s++){let o=e[s],i=t.Filter.CostCenterFilters.find(e=>e.CostCenterID==parseInt(o.attributes.CID.value));i&&(i.ParentReportFilterCostCenterID=parseInt(o.attributes.PID.value))}}}if(null!=this.oReport.ReportViewFrom){if(null==this.oReport.ReportViewFrom.oReportDialog){let e=l.f.SelectNodes(this.oReport.xMapXML,"Filters/FieldFilter");for(let t=0;t<e.length;t++){let s=e[t],o=this.oReport.ReportViewFrom.Filter.Fields.find(e=>e.CDGDO.FieldValue==parseInt(s.attributes.PID.value));if(o)if(null!=this.oReport.oReportDialog)"1"==s.attributes.CID.value&&(this.oReport.oReportDialog.FromDate.Date=o.FromDatePicker.Date,this.oReport.oReportDialog.ToDate.Date=o.ToDatePicker.Date);else{let e=this.oReport.Filter.Fields.find(e=>e.CDGDO.FieldValue==parseInt(s.attributes.CID.value));e&&(e.Condition.SelectedValue=o.Condition.SelectedValue,e.Condition.SelectedItem=o.Condition.SelectedItem,e.OnConditionSelectionChanged(null),e.FromValue.TextBox.Text=o.FromValue.TextBox.Text,e.ToValue.Text=o.ToValue.Text,e.FromDatePicker.Date=o.FromDatePicker.Date,e.ToDatePicker.Date=o.ToDatePicker.Date,e.FromList.SelectedValue=o.FromList.SelectedValue,e.ToList.SelectedValue=o.ToList.SelectedValue)}}}else{null!=this.oReport.oReportDialog&&(this.oReport.oReportDialog.FromDate=this.oReport.ReportViewFrom.oReportDialog.FromDate,this.oReport.oReportDialog.ToDate=this.oReport.ReportViewFrom.oReportDialog.ToDate);let e=l.f.SelectNodes(this.oReport.xMapXML,"Filters/FieldFilter");for(let t=0;t<e.length;t++){let s=e[t];if(null!=this.oReport.oReportDialog)this.oReport.oReportDialog.FromDate=this.oReport.ReportViewFrom.oReportDialog.FromDate,this.oReport.oReportDialog.ToDate=this.oReport.ReportViewFrom.oReportDialog.ToDate;else{let e=this.oReport.ReportViewFrom.Filter.Fields.FIND(e=>e.CDGDO.FieldValue==parseInt(s.attributes.CID.value));e&&(e.FromDatePicker=this.oReport.ReportViewFrom.oReportDialog.FromDate,e.ToDatePicker=this.oReport.ReportViewFrom.oReportDialog.ToDate)}}}null!=this.oReport.oReportDialog&&(this.oReport.Filter.CostCenterFilters=this.oReport.oReportDialog.CostCenterFilters);let e=l.f.SelectNodes(this.oReport.xMapXML,"Filters/TreeFilter");for(let t=0;t<e.length;t++){let s=e[t],o=this.oReport.ReportViewFrom.Filter.CostCenterFilters.find(e=>e.CostCenterID==parseInt(s.attributes.PID.value));null==o&&null!=this.oReport.ReportViewFrom.oReportDialog&&(o=this.oReport.ReportViewFrom.oReportDialog.CostCenterFilters.find(e=>e.CostCenterID==parseInt(s.attributes.PID.value)));let i=this.oReport.Filter.CostCenterFilters.find(e=>e.CostCenterID==parseInt(s.attributes.CID.value));o&&i&&(i.SelectedNodes=o.SelectedNodes,i.SelectedNodesTag=o.SelectedNodesTag,null!=this.oReport.oReportDialog&&this.oReport.oReportDialog.TreeCCID==i.CostCenterID&&(this.oReport.oReportDialog.DefaultTreeSelectedNodes=i.SelectedNodes))}}else if(null!=this.oReport.ReportViewFromReorder){null!=this.oReport.oReportDialog&&(this.oReport.Filter.CostCenterFilters=this.oReport.oReportDialog.CostCenterFilters);let e=l.f.SelectNodes(this.oReport.xMapXML,"Filters/TreeFilter");for(let t=0;t<e.length;t++){let s=e[t],o=this.oReport.ReportViewFromReorder.CostCenterFilters.find(e=>e.CostCenterID==parseInt(s.attributes.PID.value)),i=this.oReport.Filter.CostCenterFilters.find(e=>e.CostCenterID==parseInt(s.attributes.CID.value));o&&i&&(i.SelectedNodes=o.SelectedNodes,i.SelectedNodesTag=o.SelectedNodesTag,null!=this.oReport.oReportDialog&&this.oReport.oReportDialog.TreeCCID==i.CostCenterID&&(this.oReport.oReportDialog.DefaultTreeSelectedNodes=i.SelectedNodes))}}}}static GetDateFromKeyWord(e){let t=Date.Today();switch(t.getDay(),new Date,e){case"DEFAULT_DATE":t=i.a.SessionManager.ReportsFromDate;break;case"YESTERDAY":t=t.AddDays(-1);break;case"ACCOUNTING_DATE":t=i.a.SessionManager.AccountingDate;break;case"WEEK_START":case"WEEK_END":break;case"MONTH_START":t=new Date(t.getFullYear(),t.getMonth(),1);break;case"MONTH_END":t=new Date(t.getFullYear(),t.getMonth(),1),t=t.AddMonths(1).AddDays(-1);break;case"QUARTER_START":t=new Date(t.getFullYear(),t.getMonth()-(t.getMonth()-1)%3,1);break;case"QUARTER_END":t=new Date(t.getFullYear(),t.getMonth()-(t.getMonth()-1)%3,1),t=t.AddMonths(3).AddDays(-1);break;case"YEAR_START":t=new Date(t.getFullYear(),0,1);break;case"YEAR_END":t=new Date(t.getFullYear(),11,31);break;case"FISCAL_YEAR_START":t=new Date(Date.Today().getFullYear(),i.a.SessionManager.AccountingFromMonth-1,1),t>Date.Today()&&(t=t.AddYears(-1));break;case"FISCAL_YEAR_END":t=new Date(Date.Today().getFullYear(),i.a.SessionManager.AccountingFromMonth-1,1),t>Date.Today()&&(t=t.AddYears(-1)),t=t.AddYears(1).AddDays(-1);break;case"YEAR_END(DEFAULT_DATE)":t=new Date(i.a.SessionManager.ReportsFromDate.getFullYear(),i.a.SessionManager.AccountingFromMonth-1,1),t>i.a.SessionManager.ReportsFromDate&&(t=t.AddYears(-1)),t=t.AddYears(1).AddDays(-1);break;case"PAYROLL_MONTH":t=new Date(i.a.SessionManager.PayrollMonth.getFullYear(),i.a.SessionManager.PayrollMonth.getMonth(),1);break;case"PAYROLL_MONTH_START":t=i.a.SessionManager.PayrollMonthStart;break;case"PAYROLL_MONTH_END":t=i.a.SessionManager.PayrollMonthEnd}return t}ShowBudgetData(e){this.Budget.Visible=!0,0==this.Budget.Items.length&&(i.a.report.DataSet("RPT014","").Tables[0].forEach(t=>{this.Budget.Items.push(D.d.ComboBoxItems_2(t.BudgetName.toString(),t.BudgetDefID.toString())),e==t.BudgetDefID.toString()&&(this.Budget.SelectedItem=this.Budget.Items[this.Budget.Items.length-1],this.Budget.SelectedValue=e)}),this.Budget.Items.length>0&&l.e.IsEmpty(this.Budget.SelectedValue)&&(this.Budget.SelectedItem=this.Budget.Items[0],this.Budget.SelectedValue=this.Budget.Items[0].Value))}GetPropertiesSaveXML(){let e="",t=this.ActivityTypes.GetSelectedSting();return t.length>0?(t=t.substr(0,t.length-1),e="<XML><ActivityTypes>"+t+"</ActivityTypes></XML>"+e,e.toString()):""}OnButtonClick(e){if(this.DisplayMessage="","Cancel"==e)this.ParentViewModel.ShowStaticFilter=!1,null!=this.ParentViewModel.BulkEdit?this.ParentViewModel.BulkEdit.ShowEditGrid():this.ParentViewModel.ShowReport=!0;else if("BACK"==e){for(let e=0;e<this.Fields.length;e++){let t=this.Fields[e];if(0==t.CDGDO.FieldValue)return void(this.DisplayMessage="Select "+t.Member.Label)}null!=this.ParentViewModel.BulkEdit?this.ParentViewModel.BulkEdit.ShowEditGrid():this.ParentViewModel.ShowReport=!0}else if("OK"==e)this.ParentViewModel.SetQueryXMLTags(),this.ParentViewModel.ShowReport=!0,this.ParentViewModel.DocsLanding?this.ParentViewModel.DocsLanding.OnButtonClick("Refresh"):this.ParentViewModel.LoadData();else if("PrProcessQuery"==e)this.ParentViewModel.IsPreProcessQueryClick=!0,this.ParentViewModel.SetQueryXMLTags(),this.ParentViewModel.IsPreProcessQueryClick=!1,Logger.DebugLog("ReportViewModel::LoadDynamicReport::Query :::: \r\n"+this.ParentViewModel.FinalQuery+"\r\n\r\n"),this.IsEnable=!1,this.DisplayMessage="Pre-process executing, Please wait...",i.a.report.PreProcessQuery(this.ParentViewModel.ReportID,this.ParentViewModel.FinalQuery).subscribe(e=>{this.IsEnable=!0,this.DisplayMessage=e.Message});else if("Default"==e){if(this.ActivityTypes.Visible){let e=this.GetPropertiesSaveXML(),t=i.a.report.SetReportDefaultProperties(this.oReport.ReportID,e),s=l.e.Int(t.obj);t.Tables.length>0&&t.Tables[0].length>0&&(this.DisplayMessage=t.Tables[0][0].ErrorMessage.toString()),s>0&&this.oReport.ReportID>0&&(this.oReport.Reportds.Tables[0][0].DefaultPreferences=e)}}else if("SetDefault"==e)1==this.CostCenters.SelectedItem.ExchgRate?(this.CostCenters.SelectedItem.ExchgRate=0,this.DisplayMessage='"'+this.CostCenters.SelectedItem.Name+'" Removed As Default',this.TreeCCID=0,this.LookupTypeID=0,this.GridViewID=0):(this.CostCenters.Items.map(e=>e.ExchgRate=0),this.CostCenters.SelectedItem.ExchgRate=1,this.DisplayMessage='"'+this.CostCenters.SelectedItem.Name+'" Set As Default',this.TreeCCID=parseInt(this.CostCenters.SelectedValue),this.LookupTypeID=null==this.CostCenters.SelectedItem||l.e.IsEmpty(this.CostCenters.SelectedItem.Parent)?0:parseInt(this.CostCenters.SelectedItem.Parent),this.GridViewID=50==this.TreeCCID?this.LookupTypeID:this.tree[0].GridViewID);else if("SelectFilter"==e){if(null==this.tree||0==this.tree.length)return;let e=this.CostCenterFilters.find(e=>e.CostCenterID==this.tree[0].CostCenterID&&e.LookupTypeID==this.tree[0].LookupTypeID);null==e?(e=new _.a(parseInt(this.CostCenters.SelectedItem.Value),this.CostCenters.SelectedItem.Parent,this.CostCenters.SelectedItem.Name,this),null==this.tree[0].SelectedNodes&&(this.tree[0].SelectedNodes=[]),e.SelectedNodes=this.tree[0].SelectedNodes,this.CostCenterFilters.push(e)):null==e.SelectedNodes||0==e.SelectedNodes.length?this.CostCenterFilters.Remove(e):e.OnButtonClick("Delete")}else"AddFilterField"==e&&this.Fields.push(new r.a(this))}OnCostCenterChange(e){return Object(o.b)(this,void 0,void 0,(function*(){if(!l.e.IsEmpty(this.CostCenters.SelectedValue)&&null!=e&&-1!=parseInt(e))if(null!=this.CostCenters.SelectedItem&&50==parseInt(this.CostCenters.SelectedValue)){if(this.ReportWidth="450",this.ReportHeight="400",0==this.Report.length||this.Report[0].ReportID!=parseInt(this.CostCenters.SelectedItem.Parent)){this.ReportLoaded=!1;const{ReportViewModel:e}=yield Promise.resolve().then(s.bind(null,"ThYU"));let t=new e;t.ReportViewModel_Document(112,"<XML></XML>",parseInt(this.CostCenters.SelectedItem.Parent),!1,null,null),t.ShowHeaderButtons=!1,t.ShowRightPanel=!1,t.SearchVisibility=!1,t.PrefetchReportTreeFilter=this,t.PrefetchReportTreeFilter.PrefetchReportType=this.oReport.StaticReportType,this.Report.Clear(),this.Report.push(t)}this.TreeVisibility=!1}else{this.TreeVisibility=!0;let e=0;null==this.CostCenters.SelectedItem||l.e.IsEmpty(this.CostCenters.SelectedItem.Parent)||(e=l.e.Int(this.CostCenters.SelectedItem.Parent)),this.LoadCostCenterTree(parseInt(this.CostCenters.SelectedValue),e,0,null)}}))}LoadCostCenterTree(e,t,s,o){if(i.a.SessionManager.RoleType>0)return;if(this.tree.Clear(),this.TreeFilter="",300==e&&"AddEditReportViewModel"==this.ParentViewModel.ClassName){let e=this.ParentViewModel.StaticReportType;e>=13&&e<=16&&(this.TreeFilter="i.IsInventory=1 and exists (select PrefValue from com_documentpreferences with(nolock) where Prefname='DonotupdateInventory' and CostCenterID=i.CostCenterID and PrefValue='False')")}if(this.IsReportViewScreen){if(2==e){let e=this.ParentViewModel;e.Preferences.ContainsKey("AccountTypesFilter")&&e.Preferences.AccountTypesFilter.length>0&&(this.TreeFilter=i.a.SessionManager.Preferences.ContainsKey("IsControlAccounts")&&"TRUE"==i.a.SessionManager.Preferences.IsControlAccounts.toUpperCase()?"6,7"==e.Preferences.AccountTypesFilter||"7,6"==e.Preferences.AccountTypesFilter?"#DEBITORCREDITORTEE#":e.Preferences.AccountTypesFilter.Contains(",")?"A.AccountTypeID IN ("+e.Preferences.AccountTypesFilter+")":"7"==e.Preferences.AccountTypesFilter?"(#DEBTORTEE# or (A.IsDrCr=1 and A.AccountTypeID=6))":"6"==e.Preferences.AccountTypesFilter?"(#CREDITORTEE# or (A.IsDrCr=1 and A.AccountTypeID=7))":"A.AccountTypeID="+e.Preferences.AccountTypesFilter:e.Preferences.AccountTypesFilter.Contains(",")?"A.AccountTypeID IN ("+e.Preferences.AccountTypesFilter+")":"A.AccountTypeID="+e.Preferences.AccountTypesFilter)}50002==e&&"1"!=i.a.SessionManager.RoleID&&"True"==i.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==i.a.SessionManager.Preferences["LW Reports"]&&(this.TreeFilter=l.e.IsEmpty(i.a.SessionManager.LocationWhere)?"A.NodeID IN (-1234)":"A.NodeID IN ("+i.a.SessionManager.LocationWhere+")")}let a;if(null==o)for(let i=0;i<this.CostCenterFilters.length;i++){let s=this.CostCenterFilters[i];if(s.CostCenterID==e&&s.LookupTypeID==t){o=s.SelectedNodes;break}}44==e&&t>0&&(this.TreeFilter="A.LookupType="+t);let n="";if(null!=this.oReport&&this.oReport.Preferences.ContainsKey("GridViewFilter")&&this.oReport.Preferences.GridViewFilter.length>0){let t=new l.f;t.LoadXml("<GridViewFilter>"+this.oReport.Preferences.GridViewFilter+"</GridViewFilter>"),l.f.SelectNodes(t.DocumentElement.children[0],"Row").forEach(t=>{t.attributes.CCID.value==e&&(n+=t.attributes.GID.value+",")})}if(a=new p.a,null==o?a.TreeViewModel_5(e,this,s,this.TreeFilter,n):a.TreeViewModel_6(e,this,s,this.TreeFilter,o,n),a.LookupTypeID=t,a.HeaderVisiblity=!1,a.OnNodeSelected||(a.OnNodeSelected=new T.b,a.OnNodeSelected.Subscribe(this,"OnNodeSelected")),this.tree.push(a),null!=o&&o.length>0&&null!=a&&null!=a.AllNodes){a.SelectedNode=null;let e=a.AllNodes.find(e=>e.Id==o[0].Id);null!=e&&a.SelectSearchNode(e)}}}},Zgxw:function(e,t,s){"use strict";s.d(t,"a",(function(){return d}));var o=s("Do2H"),i=s("Lp6j"),l=s("eQJW"),a=s("1xwR"),n=s("mvPR"),r=s("vTM8"),h=s("8iaB"),u=function(e){return e[e.None=0]="None",e[e.MonthWise=1]="MonthWise",e[e.YearWise=3]="YearWise",e[e.TagWise=2]="TagWise",e}({}),D=function(e){return e[e.None=0]="None",e[e.Both=1]="Both",e[e.Max=2]="Max",e[e.Min=3]="Min",e}({});class d extends a.b{constructor(e){super(e),this.Show=u.None,this.MultipleUnitType=D.Both,this.dtBins=null,this.k=0,this.drMain=null,this.OpBalanceQty=0,this.OpBalanceValue=0,this.colCOGSIndex=-1,this.colBalanceQtyIndex=-1,this.colBalanceRateIndex=-1,this.colBalanceValueIndex=-1,this.colGLCOGSIndex=-1,this.colSpanBF=-1,this.colBalanceQtyMaxIndex=-1,this.colBalanceQtyMinIndex=-1,this.Display_Positive=!1,this.Display_Negative=!1,this.Display_Zero=!1,this.ExcludeReserveQty=!1,this.IsReconcile=!1,this.ShowSLasSV=!1,this.dblQty=0,this.dblValue=0,this.dblAvgRate=0,this.dblBalQty=0,this.ShowLevelTree=!1,this.ShowCollapse=!1,this.ShowProductsWithoutTransactions=!1,this.ShowProductsWithZeroBalances=!1,this.HideEmptyDimensions=!1,this.ProductGroupFirst=!1,this.ShowGroupHighLowValues=!1,this.ShowMultipleUnitNames=!1,this.SortTransactions=!1,this.DimWiseRepeatQty=!0,this.DimWiseRepeatRate=!1,this.DimWiseRepeatReserveQty=!1,this.DimWiseRepeatHoldQty=!1,this.DimWiseRepeatValue=!1,this.IsSaleQty=!1,this.IsSaleValue=!1,this.IsMultipleUnits=!1,this.LevelNo=0,this.TagWiseColStart=0,this.DefValuation=0,this.ValuationID=0,this.TagID=0,this.ForeignCurrencyID=0,this.CurrencyType=0,this.CountMonths=0,this.RepeatCols=1,this.strProductID=null,this.TagTableName=null,this.TagColumnName=null,this.TagsList=null,this.strProductName=null,this.SortTransactionsBy="",this.Valuation=null,this.ExtraColumns=new Array,this.TemporaryTableName="",this.DocumentTypesWhere="",this.dicPeriodicAvgRate=new r.a,this.dtNonInvDocs=null,this.iLoop=0,this.MultipleUnitSelect="",this.MultipleUnitJoin="",this.dbl=0,this.dblUOMRate=0,this.dblCOGS=0,this.dblMaxConv=0,this.dblMinConv=0,this.Row=0,this.Col=0,this.GroupRowIndex=0,this.rows=new Array,this.lstRecQty=new Array,this.lstRecRate=new Array,this.oCBCell=new n.c,this.oCBFormat=new n.b,this.dblCBMin=0,this.dblCBMax=0,this.lstTotal=null,this.lstParents=new Array,this.R=0}LoadReport(){this.iLoop=0,this.GrdRow=-1,this.TagID=0,this.TagsList=null,this.dtBins=null,this.colSubTotalStartIndex=-1,this.AggTotal=i.e.NumArray(this.oColumns.length,2),this.ViewModel.totals=i.e.NumArray(this.oColumns.length,this.ViewModel.lstGroup.length+1),this.ViewModel.SNo=0;for(let o=0;o<this.oColumns.length;o++)if("FLOAT"==this.oColumns[o].ColumnType){this.colSpanBF=o;break}if(this.ViewModel.lstGroup.length>0)for(this.k=0;this.k<this.oColumns.length;this.k++)if(this.ViewModel.lstGroup[0].TotalCols.ContainsKey(this.oColumns[this.k].ID)){this.colSubTotalStartIndex=this.k;break}this.RefreshColumnIndexes();let e="";if(this.lstPCRates=new Array,this.ViewModel.BaseReportColumns.filter(e=>33==e.ID.length).forEach(t=>{40==t.CDGDO.ParentCostCenterID&&(e.length>0&&(e+=","),e+=t.CDGDO.Column,this.lstPCRates.push(t.ID))}),this.LevelNo=0,this.ShowLevelTree=!1,this.ViewModel.Preferences.ContainsKey("ShowLevel")){let e=new i.f;e.LoadXml("<XML>"+this.ViewModel.Preferences.ShowLevel+"</XML>");let t=i.f.SelectSingleNode(e.DocumentElement,"IsChecked");null!=t&&"1"==t.innerHTML&&(this.ShowLevelTree=!0,this.LevelNo=parseInt(i.f.SelectSingleNodeText(e.DocumentElement,"Text")),-1==this.LevelNo&&(this.LevelNo=50),this.ShowCollapse=!(!this.ViewModel.Preferences.ContainsKey("ShowCollapse")||"1"!=this.ViewModel.Preferences.ShowCollapse))}if(this.DefValuation=0,this.ViewModel.Preferences.ContainsKey("ValuationMethod")&&(this.DefValuation=i.e.Int(this.ViewModel.Preferences.ValuationMethod)),this.UnPostedDocsInclude=!(!this.ViewModel.Preferences.ContainsKey("IncludeUnPostedDocs")||"1"!=this.ViewModel.Preferences.IncludeUnPostedDocs),this.UnPostedDocsReserveQtyInclude=!(!this.ViewModel.Preferences.ContainsKey("IncludeUnPostedDocsReserveQty")||"1"!=this.ViewModel.Preferences.IncludeUnPostedDocsReserveQty),this.UnPostedDocsHoldQtyInclude=!(!this.ViewModel.Preferences.ContainsKey("IncludeUnPostedDocsHoldQty")||"1"!=this.ViewModel.Preferences.IncludeUnPostedDocsHoldQty),this.ShowProductsWithoutTransactions=!(!this.ViewModel.Preferences.ContainsKey("ShowProductsWithoutTransactions")||"1"!=this.ViewModel.Preferences.ShowProductsWithoutTransactions),this.ShowProductsWithZeroBalances=!(!this.ViewModel.Preferences.ContainsKey("ShowProductsWithZeroBalances")||"1"!=this.ViewModel.Preferences.ShowProductsWithZeroBalances),this.SortTransactions=!(!this.ViewModel.Preferences.ContainsKey("SortTransactions")||"1"!=this.ViewModel.Preferences.SortTransactions),this.SortTransactionsBy=this.ViewModel.Preferences.ContainsKey("SortTransactionsBy")?this.ViewModel.Preferences.SortTransactionsBy:"",this.IsReconcile=this.ViewModel.Preferences.ContainsKey("Reconcile"),this.ShowSLasSV=this.ViewModel.Preferences.ContainsKey("ShowSLasSV"),this.ViewModel.Preferences.ContainsKey("DisplayStock")&&(this.ViewModel.Preferences.DisplayStock.Contains("Zero")&&(this.Display_Zero=!0),this.ViewModel.Preferences.DisplayStock.Contains("Positive")&&(this.Display_Positive=!0),this.ViewModel.Preferences.DisplayStock.Contains("Negative")&&(this.Display_Negative=!0),this.Display_Positive||this.Display_Negative||this.Display_Zero||(this.Display_Positive=this.Display_Negative=this.Display_Zero=!0)),this.ViewModel.Preferences.ContainsKey("FinalReportsShow")){let e=this.ViewModel.Preferences.FinalReportsShow;"1"==e?this.Show=u.MonthWise:"3"==e?this.Show=u.YearWise:"2"==e&&(this.Show=u.TagWise,this.TagID=parseInt(this.ViewModel.Preferences.FinalReportsShowTag),this.ViewModel.Preferences.ContainsKey("FinalReportsShowTagHideColumns")&&(this.HideEmptyDimensions=!0),this.TagColumnName="Name",this.ViewModel.Preferences.ContainsKey("FinalReportsShowTagColumn")&&("0"==this.ViewModel.Preferences.FinalReportsShowTagColumn?this.TagColumnName="Code":"2"==this.ViewModel.Preferences.FinalReportsShowTagColumn&&(this.TagColumnName="Code+'-'+Name")))}else if(this.ViewModel.Preferences.ContainsKey("TagWise")){let e=new i.f;e.LoadXml("<XML>"+this.ViewModel.Preferences.TagWise+"</XML>");let t=i.f.SelectSingleNode(e.DocumentElement,"IsChecked");null!=t&&"1"==t.innerHTML&&(this.Show=u.TagWise,t=i.f.SelectSingleNode(e.DocumentElement,"Value"),this.TagID=parseInt(t.innerHTML),this.TagTableName=d.GetTagTableName(this.TagID),t=i.f.SelectSingleNode(e.DocumentElement,"HideColumns"),(null!=t||this.ViewModel.Preferences.ContainsKey("HideEmptyDimensions")&&"1"==this.ViewModel.Preferences.HideEmptyDimensions)&&(this.HideEmptyDimensions=!0),this.TagColumnName=14==this.ViewModel.StaticReportType||15==this.ViewModel.StaticReportType?"T.Name":"Name",t=i.f.SelectSingleNode(e.DocumentElement,"Column"),null!=t&&("0"==t.innerHTML?this.TagColumnName=14==this.ViewModel.StaticReportType||15==this.ViewModel.StaticReportType?"T.Code":"Code":"2"==t.innerHTML&&(this.TagColumnName=14==this.ViewModel.StaticReportType||15==this.ViewModel.StaticReportType?"T.Code+'-'+T.Name":"Code+'-'+Name")))}if(this.ChunkSize=this.ViewModel.Preferences.ContainsKey("ChunkSize")?parseInt(this.ViewModel.Preferences.ChunkSize):1,this.CurrencyType=0,this.ForeignCurrencyID=0,this.ViewModel.Preferences.ContainsKey("ForeignCurrency")){let e=new i.f;e.LoadXml("<XML>"+this.ViewModel.Preferences.ForeignCurrency+"</XML>");let t=i.f.SelectSingleNode(e.DocumentElement,"IsChecked");null!=t&&"1"==t.innerHTML&&(this.ForeignCurrencyID=parseInt(i.f.SelectSingleNodeText(e.DocumentElement,"Value")))}else if(this.ViewModel.Preferences.ContainsKey("Currency")){let e=new i.f;e.LoadXml("<XML>"+this.ViewModel.Preferences.Currency+"</XML>"),this.CurrencyType=parseInt(i.f.SelectSingleNodeText(e.DocumentElement,"Type")),1==this.CurrencyType?(i.e.IsEmpty(o.a.SessionManager.Preferences.DimensionwiseCurrency)||0==parseInt(o.a.SessionManager.Preferences.DimensionwiseCurrency))&&(this.CurrencyType=0):2==this.CurrencyType&&(this.ForeignCurrencyID=parseInt(i.f.SelectSingleNodeText(e.DocumentElement,"Value")))}if(this.ExcludeReserveQty=!(!this.ViewModel.Preferences.ContainsKey("ExcludeReserveQty")||"1"!=this.ViewModel.Preferences.ExcludeReserveQty),this.ShowGroupHighLowValues=!(!this.ViewModel.Preferences.ContainsKey("ShowGroupHighLowValues")||"1"!=this.ViewModel.Preferences.ShowGroupHighLowValues),this.ShowGroupHighLowValues&&(this.oCBFormat.DecimalsPoints=parseInt(o.a.SessionManager.Preferences.DecimalsinAmount),this.oCBFormat.ShowDefaultSign=0,"Millions"==o.a.SessionManager.Preferences.Commas?this.oCBFormat.Commas=1:"Lakhs"==o.a.SessionManager.Preferences.Commas&&(this.oCBFormat.Commas=2)),this.IsMultipleUnits=!1,this.MultipleUnitType=D.None,this.ViewModel.Preferences.ContainsKey("MultipleUnits")&&"0"!=this.ViewModel.Preferences.MultipleUnits&&(this.IsMultipleUnits=!0,this.MultipleUnitType=parseInt(this.ViewModel.Preferences.MultipleUnits)),this.IsMultipleUnits&&-1==this.colBalanceQtyIndex&&(this.IsMultipleUnits=!1),this.IsMultipleUnits&&(this.ShowMultipleUnitNames=!(!this.ViewModel.Preferences.ContainsKey("ShowMultipleUnitNames")||"1"!=this.ViewModel.Preferences.ShowMultipleUnitNames),this.SetMultipleUnitsQry()),this.Show==u.TagWise&&14==this.ViewModel.StaticReportType)this.RepeatCols=1;else if(this.Show!=u.None&&(14==this.ViewModel.StaticReportType||15==this.ViewModel.StaticReportType)&&(this.RepeatCols=3,this.DimWiseRepeatQty=!0,this.DimWiseRepeatRate=!0,this.DimWiseRepeatValue=!0,this.ViewModel.Preferences.ContainsKey("DimensionWiseRepeat"))){this.RepeatCols=0,this.DimWiseRepeatQty=!1,this.DimWiseRepeatRate=!1,this.DimWiseRepeatValue=!1;let e=this.ViewModel.Preferences.DimensionWiseRepeat.split(",");e.Contains("Qty")&&(this.DimWiseRepeatQty=!0,this.RepeatCols++),e.Contains("Rate")&&(this.DimWiseRepeatRate=!0,this.RepeatCols++),e.Contains("Value")&&(this.DimWiseRepeatValue=!0,this.RepeatCols++)}try{let r="",h="",c="",C=this.ViewModel.oReportDialog.GetSeqNosListWithRoots();if(this.ViewModel.oReportDialog.IsZeroSelected||this.ViewModel.oReportDialog.IsOneSelected||(this.ViewModel.oReportDialog.IsGroupExists?(c="P.ProductID=GTP.GTID",h=C.Contains(",")?",(select T.ProductID GTID from INV_Product T with(nolock),INV_Product GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.ProductID IN ("+C+") group by T.ProductID) AS GTP ":",(select T.ProductID GTID from INV_Product T with(nolock),INV_Product GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.ProductID="+C+" group by T.ProductID) AS GTP "):c=C.Contains(",")?"P.ProductID IN ("+C+")":"P.ProductID="+C),0==c.length&&this.ViewModel.Preferences.ContainsKey("ProductGroupIds")&&!i.e.IsEmpty(this.ViewModel.Preferences.ProductGroupIds)&&(c="P.ProductID=GTP.GTID",h=this.ViewModel.Preferences.ProductGroupIds.Contains(",")?",(select T.ProductID GTID from INV_Product T with(nolock),INV_Product GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.ProductID IN ("+this.ViewModel.Preferences.ProductGroupIds+") group by T.ProductID) AS GTP ":",(select T.ProductID GTID from INV_Product T with(nolock),INV_Product GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.ProductID="+this.ViewModel.Preferences.ProductGroupIds+" group by T.ProductID) AS GTP "),13==this.ViewModel.StaticReportType){if(r="SELECT P.ProductID,P.ProductName,P.ValuationID"+this.ViewModel.GroupSelectTag+this.MultipleUnitSelect,r+=" FROM INV_Product P WITH(NOLOCK)",r+=this.MultipleUnitJoin+this.ViewModel.GroupFromTag+h,r+=" WHERE P.IsGroup=0 AND P.ProductTypeId<>6 AND P.ProductTypeId!=10",c.length>0&&(r+=" AND "+c),r+=this.GetProductWiseLocationWhere("P",!1),r+=" AND P.ProductID IN ("+this.GetUsedProductsQuery()+")",r+="Code"==this.ViewModel.Preferences.TreeSortOn?" Order By P.ProductCode":"TreeOrder"==this.ViewModel.Preferences.TreeSortOn?" Order By P.lft":" Order By P.ProductName",this.IsMultipleUnits){let e=new Array;for(let t=0;t<this.ViewModel.ColumnSource.length;t++)e.push(this.ViewModel.ColumnSource[t]);this.AddMultipleUnitCols(e),this.ViewModel.RefreshReportTotals(e),this.ViewModel.RefreshPostFilters(),this.oColumns=this.ViewModel.ReportColumns,this.AggTotal=i.e.NumArray(this.oColumns.length,2),this.RefreshColumnIndexes()}if(this.ViewModel.Preferences.ContainsKey("EditCreatedDate")&&!this.oColumns[0].MenuItems.ContainsKey("EditCreatedDate")){let e=new Array;this.oColumns.forEach(t=>{t.MenuItems.ContainsKey("EditCreatedDate")||t.MenuItems.push("EditCreatedDate","Edit Date"),e.push(t)}),this.ViewModel.RefreshReportTotals(e),this.ViewModel.RefreshPostFilters(),this.oColumns=this.ViewModel.ReportColumns,this.AggTotal=i.e.NumArray(this.oColumns.length,2),this.RefreshColumnIndexes(),this.oColumns.forEach(e=>{e.MenuItems.ContainsKey("EditCreatedDate")||e.MenuItems.push("EditCreatedDate","Edit Date")})}}else if(14==this.ViewModel.StaticReportType||15==this.ViewModel.StaticReportType){if(0==this.ViewModel.ReportGroups.length){let e=new Array;for(let s=0;s<this.ViewModel.ColumnSource.length;s++)e.push(this.ViewModel.ColumnSource[s]);if(this.Show!=u.None){this.TagsList="";let t,s=this.ViewModel.ColumnSource.IndexOf(this.ViewModel.ColumnSource.find(e=>"RecQty"==e.ID)),i=this.ViewModel.ColumnSource.IndexOf(this.ViewModel.ColumnSource.find(e=>"IssQty"==e.ID)),l=this.ViewModel.ColumnSource.indexOf(this.ViewModel.ColumnSource.find(e=>"BalQty"==e.ID));if(this.Show==u.TagWise){let e=this.HideEmptyDimensions?this.GetUsedProductsByTagQuery(h,c,this.TagColumnName):this.GetTagWiseQuery(this.TagID,this.TagColumnName.Replace("T.",""),"Name");t=o.a.report.GetDataTable("RPT022",e)}else{t=[];let e=1;if(this.TagsList='<R D="'+this.ViewModel.oReportDialog.FromDate.Date.AddDays(-1).ToString("dd MMM yyyy")+'"/>',this.Show==u.MonthWise){let s=this.ViewModel.oReportDialog.FromDate.Date.MonthsFirst();for(;s<=this.ViewModel.oReportDialog.ToDate.Date;)t.push({NodeID:e.toString(),Name:s.Date.ToString("MMM yy"),Tag:s.Date.AddMonths(1).AddDays(-1).ToString("dd MMM yyyy")}),s=s.AddMonths(1),e++}else{let s=new Date(this.ViewModel.oReportDialog.FromDate.Date.getFullYear(),this.AccountingFromMonth-1,1);for(s>this.ViewModel.oReportDialog.FromDate.Date&&(s=s.AddYears(-1));s<=this.ViewModel.oReportDialog.ToDate.Date;)t.push(1==this.AccountingFromMonth?{NodeID:e.toString(),Name:s.getFullYear().toString(),Tag:s.AddYears(1).AddDays(-1).ToString("dd MMM yyyy")}:{NodeID:e.toString(),Name:s.getFullYear().toString()+"-"+s.AddYears(1).ToString("yy"),Tag:s.AddYears(1).AddDays(-1).ToString("dd MMM yyyy")}),s=s.AddYears(1),e++}}t.forEach(t=>{if(14==this.ViewModel.StaticReportType){if(this.DimWiseRepeatQty){let o=this.ViewModel.ColumnSource[s].Clone();o.HeaderText=o.HeaderText+"\n"+t.Name.toString(),o.ID=o.ID+t.NodeID.toString(),e.push(o),this.ViewModel.GrpReportTotal.TempTotalCols.ContainsKey(o.ID)||(this.ViewModel.GrpReportTotal.TempTotalCols.push(o.ID,e.length-1),this.ViewModel.lstGroup.forEach(t=>t.TempTotalCols.push(o.ID,e.length-1)))}if(this.DimWiseRepeatValue){let o=this.ViewModel.ColumnSource[s+1].Clone();o.HeaderText=o.HeaderText+"\n"+t.Name.toString(),o.ID=o.ID+t.NodeID.toString(),e.push(o),this.ViewModel.GrpReportTotal.TempTotalCols.ContainsKey(o.ID)||(this.ViewModel.GrpReportTotal.TempTotalCols.push(o.ID,e.length-1),this.ViewModel.lstGroup.forEach(t=>t.TempTotalCols.push(o.ID,e.length-1)))}if(this.DimWiseRepeatQty){let s=this.ViewModel.ColumnSource[i].Clone();s.HeaderText=s.HeaderText+"\n"+t.Name.toString(),s.ID=s.ID+t.NodeID.toString(),e.push(s),this.ViewModel.GrpReportTotal.TempTotalCols.ContainsKey(s.ID)||(this.ViewModel.GrpReportTotal.TempTotalCols.push(s.ID,e.length-1),this.ViewModel.lstGroup.forEach(t=>t.TempTotalCols.push(s.ID,e.length-1)))}if(this.DimWiseRepeatValue){let s=this.ViewModel.ColumnSource[i+1].Clone();s.HeaderText=s.HeaderText+"\n"+t.Name.toString(),s.ID=s.ID+t.NodeID.toString(),e.push(s),this.ViewModel.GrpReportTotal.TempTotalCols.ContainsKey(s.ID)||(this.ViewModel.GrpReportTotal.TempTotalCols.push(s.ID,e.length-1),this.ViewModel.lstGroup.forEach(t=>t.TempTotalCols.push(s.ID,e.length-1)))}}if(this.DimWiseRepeatQty){let s=this.ViewModel.ColumnSource[l].Clone();s.HeaderText=s.HeaderText+"\r\n"+t.Name.toString(),s.ID=s.ID+t.NodeID.toString(),e.push(s),this.ViewModel.GrpReportTotal.TempTotalCols.ContainsKey(s.ID)||(this.ViewModel.GrpReportTotal.TempTotalCols.push(s.ID,e.length-1),this.ViewModel.lstGroup.forEach(t=>{t.TempTotalCols.push(s.ID,e.length-1)}))}if(this.DimWiseRepeatRate){let s=this.ViewModel.ColumnSource[l+1].Clone();s.HeaderText=s.HeaderText+"\r\n"+t.Name.toString(),s.ID=s.ID+t.NodeID.toString(),e.push(s),this.ViewModel.GrpReportTotal.TempTotalCols.ContainsKey(s.ID)||(this.ViewModel.GrpReportTotal.TempTotalCols.push(s.ID,e.length-1),this.ViewModel.lstGroup.forEach(t=>{t.TempTotalCols.push(s.ID,e.length-1)}))}if(this.DimWiseRepeatValue){let s=this.ViewModel.ColumnSource[l+2].Clone();s.HeaderText=s.HeaderText+"\r\n"+t.Name.toString(),s.ID=s.ID+t.NodeID.toString(),e.push(s),this.ViewModel.GrpReportTotal.TempTotalCols.ContainsKey(s.ID)||(this.ViewModel.GrpReportTotal.TempTotalCols.push(s.ID,e.length-1),this.ViewModel.lstGroup.forEach(t=>{t.TempTotalCols.push(s.ID,e.length-1)}))}this.TagsList+=this.Show==u.TagWise?t.NodeID.toString()+",":'<R D="'+t.Tag.toString()+'"/>',++this.CountMonths}),this.TagsList=this.Show==u.TagWise?this.TagsList.TrimEnd(","):"<X>"+this.TagsList+"</X>"}this.IsMultipleUnits&&this.AddMultipleUnitCols(e),e.forEach(e=>{e.HeaderHeight<44&&(e.HeaderHeight=44)}),this.ViewModel.RefreshReportTotals(e),this.ViewModel.RefreshPostFilters(),this.oColumns=this.ViewModel.ReportColumns,this.ViewModel.IsTotalColsAdded=!0,this.lstTotal=new Array,this.lstTotal.push(new Array(this.oColumns.length).fill(0)),this.lstParents.push(new n.d(this.oColumns.length,this.ViewModel.RowHeight));let t=this.ViewModel.Preferences.ContainsKey("SalesDocs")?this.ViewModel.Preferences.SalesDocs:"";if(t.length>0){let s=this.GetDimensionFilterForStock("DCC.dcCCNID"),o="";this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?s+=" AND 1<>1":s+=" AND DCC.dcCCNID"+(this.ViewModel.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),s.length>0&&(o=" join COM_DocCCDATA DCC with(nolock) on D.InvDocDetailsID=DCC.InvDocDetailsID"),e.find(e=>"SaleQty"==e.ID)&&(this.IsSaleQty=!0,this.ViewModel.SelectTag+=",(SELECT SUM(D.UOMConvertedQty*-D.VoucherType) FROM INV_DocDetails D WITH(NOLOCK)"+o+"\nWHERE D.ProductID=P.ProductID and D.CostCenterID IN("+t+") AND D.DocDate BETWEEN CONVERT(float,CONVERT(datetime,'"+this.ViewModel.FromDatePicker.Date.ToString("dd MMM yyyy")+"')) and CONVERT(float,CONVERT(datetime,'"+this.ViewModel.ToDatePicker.Date.ToString("dd MMM yyyy")+"')) AND D.StatusID=369"+s+") SaleQty"),e.find(e=>"SaleValue"==e.ID)&&(this.IsSaleValue=!0,this.ViewModel.SelectTag+=",(SELECT SUM(D.StockValue*-D.VoucherType) FROM INV_DocDetails D WITH(NOLOCK)"+o+"\nWHERE D.ProductID=P.ProductID and D.CostCenterID IN("+t+") AND D.DocDate BETWEEN CONVERT(float,CONVERT(datetime,'"+this.ViewModel.FromDatePicker.Date.ToString("dd MMM yyyy")+"')) and CONVERT(float,CONVERT(datetime,'"+this.ViewModel.ToDatePicker.Date.ToString("dd MMM yyyy")+"')) AND D.StatusID=369"+s+") SaleValue")}this.ShowLevelTree?(r="SELECT P.ProductID,P.ProductCode,P.ProductName,P.lft,P.rgt,P.IsGroup,P.Depth"+this.ViewModel.SelectTag+this.MultipleUnitSelect,r+=" FROM INV_Product P WITH(NOLOCK)",r+=this.MultipleUnitJoin+this.ViewModel.FromTag+h,r+=" WHERE P.Depth>0 AND P.ProductTypeId<>6 AND P.ProductTypeId!=10",c.length>0&&(r+=" AND "+c),r+=this.GetProductWiseLocationWhere("P",!1),this.ViewModel.Preferences.ContainsKey("ShowAllProducts")&&"0"!=this.ViewModel.Preferences.ShowAllProducts||(r+=" AND (P.IsGroup=1 OR P.ProductID IN ("+this.GetUsedProductsQuery()+"))"),r+=" UNION ALL \nSELECT P.ProductID,P.ProductCode,P.ProductName,P.lft,P.rgt,P.IsGroup,P.Depth"+this.ViewModel.SelectTag,this.IsMultipleUnits&&(r+=",1 MaxConv,1 MinConv",this.ShowMultipleUnitNames&&(r+=",null,null")),r+=" FROM INV_Product P WITH(NOLOCK)"+this.ViewModel.FromTag+" WHERE P.IsGroup=1",r+=" Order By lft"):(r="SELECT P.ProductID,P.ProductCode,P.ProductName"+this.ViewModel.SelectTag+this.MultipleUnitSelect,r+=" FROM INV_Product P WITH(NOLOCK)",r+=this.MultipleUnitJoin+this.ViewModel.FromTag+h,r+=" WHERE P.IsGroup=0 AND P.ProductTypeId<>6 AND P.ProductTypeId!=10",c.length>0&&(r+=" AND "+c),r+=this.GetProductWiseLocationWhere("P",!1),this.ViewModel.Preferences.ContainsKey("ShowAllProducts")&&"0"!=this.ViewModel.Preferences.ShowAllProducts||(r+=" AND P.ProductID IN ("+this.GetUsedProductsQuery()+")"),r+="Code"==this.ViewModel.Preferences.TreeSortOn?" Order By P.ProductCode":"TreeOrder"==this.ViewModel.Preferences.TreeSortOn?" Order By P.lft":" Order By P.ProductName")}else if(2==this.ViewModel.ReportGroups.length){3==this.ViewModel.ReportGroups[0].CDGDO.ColumnCostCenterID?(this.ProductGroupFirst=!0,this.ViewModel.ReportGroups[1].CDGDO.ColumnCostCenterID>5e4&&(this.TagID=this.ViewModel.ReportGroups[1].CDGDO.ColumnCostCenterID)):(this.ProductGroupFirst=!1,this.ViewModel.ReportGroups[0].CDGDO.ColumnCostCenterID>5e4&&(this.TagID=this.ViewModel.ReportGroups[0].CDGDO.ColumnCostCenterID)),r="SELECT P.ProductID,DCC.dcCCNID"+(this.TagID-5e4)+" TagID,max(P.ProductCode) ProductCode,max(P.ProductName) ProductName",r+=this.ViewModel.GroupSelectTag+this.MultipleUnitSelect,"TreeOrder"==this.ViewModel.Preferences.TreeSortOn&&(r+=",max(P.lft) lft"),r+=" FROM INV_Product P WITH(NOLOCK)",r+=this.MultipleUnitJoin+this.ViewModel.FromTag;let e="";if(50002==this.TagID&&this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(e=i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID"+(this.TagID-5e4)+" IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),""==e){var t=this.ViewModel.oReportDialog.CostCenterFilters.find(e=>e.CostCenterID==this.TagID);if(null!=t&&t.SelectedNodes.length>0)if(1==t.SelectedNodes.length)e=" AND DCC.dcCCNID"+(this.TagID-5e4)+"="+t.SelectedNodes[0].Id;else{e=" AND DCC.dcCCNID"+(this.TagID-5e4)+" IN (";for(let s=0;s<t.SelectedNodes.length;s++)s>0&&(e+=","),e+=t.SelectedNodes[s].Id;e+=")"}}if(r+=" INNER JOIN Inv_DocDetails D WITH(NOLOCK) ON P.ProductID=D.ProductID AND D.IsQtyIgnored=0 INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID",r+=e,r+=h,r+=" WHERE P.IsGroup=0 AND P.ProductTypeId<>6 AND P.ProductTypeId!=10 and DCC.dcCCNID"+(this.TagID-5e4)+" is not null",c.length>0&&(r+=" AND "+c),r+=this.GetProductWiseLocationWhere("P",!1),r+=" GROUP BY P.ProductID,DCC.dcCCNID"+(this.TagID-5e4),this.ProductGroupFirst?r+="Code"==this.ViewModel.Preferences.TreeSortOn?" Order By ProductCode":"TreeOrder"==this.ViewModel.Preferences.TreeSortOn?" Order By lft":" Order By ProductName":(r+=" Order By ",r+="TagID,",r+="Code"==this.ViewModel.Preferences.TreeSortOn?"ProductCode":"TreeOrder"==this.ViewModel.Preferences.TreeSortOn?"lft":"ProductName"),this.TagID>0&&(r+="\r\n "+this.GetTagWiseQuery(this.TagID),this.ViewModel.ReportParams.ContainsKey("BinDimension")&&(r+="\r\n SELECT NodeID,Location,BinNodeID FROM [INV_ProductBins] WITH(NOLOCK)"+h,r+=" WHERE CostCenterID=3",h.length>0?r+=" AND NodeID=GTP.GTID ":c.length>0&&(r+=" AND "+c.Replace("P.ProductID","NodeID")),r+="\r\n SELECT Value FROM COM_CostCenterPreferences WITH(NOLOCK) WHERE CostCenterID=3 AND Name='BinsDimension'")),this.IsMultipleUnits){let e=new Array;for(let t=0;t<this.ViewModel.ColumnSource.length;t++)e.push(this.ViewModel.ColumnSource[t]);this.AddMultipleUnitCols(e),this.ViewModel.RefreshReportTotals(e),this.ViewModel.RefreshPostFilters(),this.oColumns=this.ViewModel.ReportColumns,this.AggTotal=i.e.NumArray(this.oColumns.length,2)}}}else if(16==this.ViewModel.StaticReportType){if(0==this.ViewModel.ReportGroups.length){let e=new Array;for(let t=0;t<this.ViewModel.ColumnSource.length;t++)e.push(this.ViewModel.ColumnSource[t]);if(this.IsMultipleUnits&&this.AddMultipleUnitCols(e),this.TagWiseColStart=e.length,this.Show==u.TagWise){if(this.DimWiseRepeatQty=!0,this.RepeatCols=1,this.ViewModel.Preferences.ContainsKey("DimensionWiseRepeat")){let e=this.ViewModel.Preferences.DimensionWiseRepeat.split(",");e.Contains("ReserveQty")&&(this.DimWiseRepeatReserveQty=!0,this.RepeatCols++),e.Contains("HoldQty")&&(this.DimWiseRepeatHoldQty=!0,this.RepeatCols++)}let t=this.ViewModel.ColumnSource.indexOf(this.ViewModel.ColumnSource.find(e=>"BalQty"==e.ID));this.TagsList="";let s=this.GetTagWiseQuery(this.TagID,this.TagColumnName,"Name");o.a.report.DataSet("RPT022",s).Tables[0].forEach(s=>{let o=this.ViewModel.ColumnSource[t].Clone();o.HeaderText=o.HeaderText+"\r\n"+s.Name.toString(),o.ID=o.ID+s.NodeID.toString(),e.push(o),this.ViewModel.GrpReportTotal.TempTotalCols.ContainsKey(o.ID)||(this.ViewModel.GrpReportTotal.TempTotalCols.push(o.ID,e.length-1),this.ViewModel.lstGroup.forEach(t=>{t.TempTotalCols.push(o.ID,e.length-1)})),this.DimWiseRepeatReserveQty&&(o=this.ViewModel.ColumnSource[t].Clone(),o.HeaderText="Reserve Qty\r\n"+s.Name.toString(),o.ID="ReserveQty"+s.NodeID.toString(),e.push(o),this.ViewModel.GrpReportTotal.TempTotalCols.ContainsKey(o.ID)||(this.ViewModel.GrpReportTotal.TempTotalCols.push(o.ID,e.length-1),this.ViewModel.lstGroup.forEach(t=>{t.TempTotalCols.push(o.ID,e.length-1)}))),this.DimWiseRepeatHoldQty&&(o=this.ViewModel.ColumnSource[t].Clone(),o.HeaderText="Hold Qty\r\n"+s.Name.toString(),o.ID="HoldQty"+s.NodeID.toString(),e.push(o),this.ViewModel.GrpReportTotal.TempTotalCols.ContainsKey(o.ID)||(this.ViewModel.GrpReportTotal.TempTotalCols.push(o.ID,e.length-1),this.ViewModel.lstGroup.forEach(t=>{t.TempTotalCols.push(o.ID,e.length-1)}))),this.TagsList+=s.NodeID.toString()+",",++this.CountMonths}),e.forEach(e=>{e.HeaderHeight<44&&(e.HeaderHeight=44)}),this.TagsList.length>0&&(this.TagsList=this.TagsList.TrimEnd(","))}this.ViewModel.RefreshReportTotals(e),e.length<50&&this.ViewModel.RefreshPostFilters(),this.oColumns=this.ViewModel.ReportColumns,this.ViewModel.IsTotalColsAdded=!0,this.lstTotal=new Array,this.lstTotal.push(new Array(this.oColumns.length).fill(0)),this.lstParents.push(new n.d(this.oColumns.length,this.ViewModel.RowHeight)),this.ShowLevelTree?(r="SELECT P.ProductID,P.ProductCode,P.ProductName,P.lft,P.rgt,P.IsGroup,P.Depth"+this.ViewModel.SelectTag+this.MultipleUnitSelect,r+=" FROM INV_Product P WITH(NOLOCK)",r+=this.MultipleUnitJoin+this.ViewModel.FromTag+h,r+=" WHERE P.Depth>0 AND P.ProductTypeId<>6 AND P.ProductTypeId!=10",c.length>0&&(r+=" AND "+c),r+=this.GetProductWiseLocationWhere("P",!1),r+=" and  P.IsGroup=0 AND P.ProductID IN ("+this.GetUsedProductsQuery()+")",r+="\nUNION all\nSELECT P.ProductID,P.ProductCode,P.ProductName,P.lft,P.rgt,P.IsGroup,P.Depth"+this.ViewModel.SelectTag,this.IsMultipleUnits&&(r+=",1 MaxConv,1 MinConv",this.ShowMultipleUnitNames&&(r+=",null,null")),r+=" FROM INV_Product P WITH(NOLOCK)"+this.ViewModel.FromTag+" WHERE P.IsGroup=1",r+=" Order By lft"):(r="SELECT P.ProductID,P.ProductCode,P.ProductName"+this.ViewModel.SelectTag+this.MultipleUnitSelect,r+=" FROM INV_Product P WITH(NOLOCK)",r+=this.MultipleUnitJoin+this.ViewModel.FromTag+h,r+=" WHERE P.IsGroup=0 AND P.ProductTypeId<>6 AND P.ProductTypeId!=10",c.length>0&&(r+=" AND "+c),r+=this.GetProductWiseLocationWhere("P",!1),this.ShowProductsWithoutTransactions||(r+=" AND P.ProductID IN ("+this.GetUsedProductsQuery()+")"),r+="Code"==this.ViewModel.Preferences.TreeSortOn?" Order By P.ProductCode":"TreeOrder"==this.ViewModel.Preferences.TreeSortOn?" Order By P.lft":" Order By P.ProductName")}else if(2==this.ViewModel.ReportGroups.length&&(this.Show=u.None,3==this.ViewModel.ReportGroups[0].CDGDO.ColumnCostCenterID?(this.ProductGroupFirst=!0,this.ViewModel.ReportGroups[1].CDGDO.ColumnCostCenterID>5e4&&(this.TagID=this.ViewModel.ReportGroups[1].CDGDO.ColumnCostCenterID)):(this.ProductGroupFirst=!1,this.ViewModel.ReportGroups[0].CDGDO.ColumnCostCenterID>5e4&&(this.TagID=this.ViewModel.ReportGroups[0].CDGDO.ColumnCostCenterID)),r="SELECT P.ProductID,P.ProductCode,P.ProductName"+this.ViewModel.SelectTag+this.MultipleUnitSelect,r+=" FROM INV_Product P WITH(NOLOCK)",r+=this.MultipleUnitJoin+this.ViewModel.FromTag+h,r+=" WHERE P.IsGroup=0 AND P.ProductTypeId<>6 AND P.ProductTypeId!=10",c.length>0&&(r+=" AND "+c),r+=this.GetProductWiseLocationWhere("P",!1),this.ShowProductsWithoutTransactions||(r+=" AND P.ProductID IN (SELECT ProductID FROM Inv_DocDetails WITH(NOLOCK) WHERE (VoucherType=1 OR VoucherType=-1) AND IsQtyIgnored=0 GROUP BY ProductID)"),r+="Code"==this.ViewModel.Preferences.TreeSortOn?" Order By P.ProductCode":"TreeOrder"==this.ViewModel.Preferences.TreeSortOn?" Order By P.lft":" Order By P.ProductName",this.TagID>0&&(r+="\r\n "+this.GetTagWiseQuery(this.TagID),this.ViewModel.ReportParams.ContainsKey("BinDimension")&&(r+="\r\n SELECT NodeID,Location,BinNodeID FROM [INV_ProductBins] WITH(NOLOCK)"+h,r+=" WHERE CostCenterID=3",h.length>0?r+=" AND NodeID=GTP.GTID ":c.length>0&&(r+=" AND "+c.Replace("P.ProductID","NodeID")),r+="\r\n SELECT Value FROM COM_CostCenterPreferences WITH(NOLOCK) WHERE CostCenterID=3 AND Name='BinsDimension'")),this.IsMultipleUnits)){let e=new Array;for(let t=0;t<this.ViewModel.ColumnSource.length;t++)e.push(this.ViewModel.ColumnSource[t]);this.AddMultipleUnitCols(e),this.ViewModel.RefreshReportTotals(e),this.ViewModel.RefreshPostFilters(),this.oColumns=this.ViewModel.ReportColumns,this.AggTotal=i.e.NumArray(this.oColumns.length,2)}}else if(159==this.ViewModel.StaticReportType){this.lstTotal=new Array,this.lstTotal.push(new Array(this.oColumns.length).fill(0)),this.lstParents.push(new n.d(this.oColumns.length,this.ViewModel.RowHeight));var s=this.ViewModel.BaseReportColumns.find(e=>("Code"==e.ID||"Name"==e.ID)&&"1"==e.Visibility.SelectedValue);if(s&&(this.TagID=s.CDGDO.CategoryValue>5e4?s.CDGDO.CategoryValue:s.CDGDO.ColumnCostCenterID),this.TagID<5e4)return void Logger.ErrorLog("LoadReport: Tag Column Not Found");if(this.TagTableName=d.GetTagTableName(this.TagID),r="SELECT T.NodeID,T.Code,T.Name"+this.ViewModel.SelectTag+" FROM "+this.TagTableName+" T WITH(NOLOCK)"+this.ViewModel.FromTag,r+=" WHERE T.IsGroup=0",!this.ViewModel.HideCostCenterTree){var a=this.ViewModel.oReportDialog.CostCenterFilters.find(e=>e.CostCenterID==this.TagID);if(null!=a){let e="";a.SelectedNodes.forEach(t=>{e+=t.Id+","}),e.length>0&&(e=e.Remove(e.length-1,1),r+=" AND T.NodeID IN ("+e.toString()+")")}}let e=null;this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(e=i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?"-1":this.ViewModel.oReportDialog.LocationWhere,this.TagID==this.ViewModel.oReportDialog.Locations.DBColumnID&&(r+=" AND T.NodeID IN ("+e+")")),r+="Code"==this.ViewModel.Preferences.TreeSortOn?" Order By T.Code":"TreeOrder"==this.ViewModel.Preferences.TreeSortOn?" Order By T.lft":" Order By T.Name"}if(r.Contains("@CCWHERE@")){let e="";this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(e=i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?" AND dcCCNID"+(this.ViewModel.oReportDialog.Locations.DBColumnID-5e4)+" IN (-1)":" AND dcCCNID"+(this.ViewModel.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),r=r.Replace("@CCWHERE@",e)}o.a.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,r).then(t=>{if(this.dsMain=t,null!=this.Valuation){let e="Default",t=this.ViewModel.oReportDialog.DefaultProperties.find(e=>"ValuationMethod"==e.DBColumnName);t&&(e=t.GetText()),this.dsMain.Tables[0].forEach(t=>{t.Valuation=e})}this.ViewModel.ConstructFormulaFields(!1),this.ViewModel.FormulasCalculated=!1;let s=new Date;if(13==this.ViewModel.StaticReportType){let e="";if(-1!=this.colGLCOGSIndex&&this.ViewModel.Preferences.ContainsKey("COGS")&&this.ViewModel.Preferences.COGS.length>0){let t=this.ViewModel.Preferences.COGS;t=t.Contains(",")?" in ("+t+")":"="+t,e=",case when D.VoucherType=-1 or D.DocumentType=6 then (select top 1 sum(Dr)-sum(Cr) Bal from (\n        select sum(Amount) Dr,0 Cr from Acc_docDetails COGSD with(nolock) where COGSD.InvDocDetailsID=D.InvDocDetailsID and COGSD.DebitAccount"+t+"\n        union all\n        select 0 Dr,sum(Amount) Cr from Acc_docDetails COGSD with(nolock) where COGSD.InvDocDetailsID=D.InvDocDetailsID and COGSD.CreditAccount"+t+")AS T) else null end GLCOGS",this.ViewModel.ReportColumns.find(e=>"GLCOGSAccount"==e.ID)&&(e+=",case when D.VoucherType=-1 or D.DocumentType=6 then (\n        select AccountName from ACC_accounts with(nolock) where AccountID IN (\n        select top 1 AccountID from (\n        select COGSD.DebitAccount AccountID from Acc_docDetails COGSD with(nolock) where COGSD.InvDocDetailsID=D.InvDocDetailsID and COGSD.DebitAccount"+t+"\n        union all\n        select COGSD.CreditAccount from Acc_docDetails COGSD with(nolock) where COGSD.InvDocDetailsID=D.InvDocDetailsID and COGSD.CreditAccount"+t+"\n        )AS T) ) else null end GLCOGSAccount"),this.IsReconcile&&(this.ViewModel.ButtonPost.Width="54",this.ViewModel.ButtonPost.GroupName="SLReconcile",this.ViewModel.ButtonPost.Label="Reconcile",this.ViewModel.ButtonPost.Visible=!0,e+=",D.CostCenterID,D.DocID")}else this.IsReconcile=!1;this.al=[],this.al.push(""),this.al.push(this.ViewModel.oReportDialog.StockDimensionID),this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere?i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?this.al.push(-1):this.al.push(this.ViewModel.oReportDialog.LocationWhere):this.al.push(null),this.al.push(this.GetDimensionFilterForStock("DCC.dcCCNID")),this.al.push(d.GetExcludeStockTransfer(this.ViewModel)),this.al.push(this.ViewModel.oReportDialog.FromDate.Date),this.al.push(this.ViewModel.oReportDialog.ToDate.Date),this.al.push(this.UnPostedDocsInclude),this.al.push(this.DefValuation),this.al.push(this.CurrencyType),this.al.push(this.ForeignCurrencyID),this.al.push(this.ViewModel.SelectTag+e),this.al.push(this.ViewModel.FromTag),this.al.push(this.SortTransactionsBy),this.al.push(o.a.SessionManager.UserID),this.al.push(o.a.SessionManager.LanguageID),this.dsMain.Columns[0].Contains(this.ViewModel.lstGroup[0].ID)||this.dsMain.Columns[0].push(this.ViewModel.lstGroup[0].ID),this.oColumns.forEach(e=>{33==e.ID.length&&this.dsMain.Columns[0].Contains(e.ID)&&this.ExtraColumns.push(e)}),this.SLCallBack()}else if(14==this.ViewModel.StaticReportType||15==this.ViewModel.StaticReportType)if(0==this.ViewModel.ReportGroups.length){if(this.al=[],this.al.push(""),this.al.push(this.TagID),this.al.push(this.TagsList),this.al.push(this.ViewModel.oReportDialog.StockDimensionID),this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere?i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?this.al.push(-1):this.al.push(this.ViewModel.oReportDialog.LocationWhere):this.al.push(null),this.al.push(this.GetDimensionFilterForStock("DCC.dcCCNID")),this.al.push(d.GetExcludeStockTransfer(this.ViewModel)),14==this.ViewModel.StaticReportType&&this.al.push(this.ViewModel.oReportDialog.FromDate.Date),this.al.push(this.ViewModel.oReportDialog.ToDate.Date),this.al.push(this.UnPostedDocsInclude),this.al.push(this.DefValuation),15==this.ViewModel.StaticReportType){let e=i.e.Int(o.a.SessionManager.Preferences["Maintain Dimensionwise AverageRate"]);this.al.push(this.Show==u.TagWise?1:0),this.al.push(this.Show==u.TagWise&&!this.DimWiseRepeatRate&&!this.DimWiseRepeatValue||0==e)}this.al.push(e),this.al.push(e.length>0?this.GetPriceFilter():""),this.al.push(this.CurrencyType),this.al.push(this.ForeignCurrencyID),this.al.push(this.SortTransactionsBy),this.al.push(o.a.SessionManager.UserID),this.al.push(o.a.SessionManager.LanguageID),this.oColumns.forEach(e=>{33==e.ID.length&&this.dsMain.Columns[0].Contains(e.ID)&&this.ExtraColumns.push(e)}),this.SV0CallBack()}else{if(this.ViewModel.ReportParams.ContainsKey("BinDimension")&&this.dsMain.Tables[3].length>0){let e=i.e.Int(this.dsMain.Tables[3][0].Value);if(e>0){d.GetTagTableName(e);let t=o.a.report.ReportDataSet("RPT022",this.ViewModel.IsReportDB,"SELECT NodeID,Name FROM "+d.GetTagTableName(e)+" with(nolock) where IsGroup=0 ");t.Tables.length>0&&t.Columns[0].Contains("Name")&&(this.dtBins=t.Tables[0])}}let t=[];if(t.push(""),t.push(this.TagID),t.push(""),t.push(this.ViewModel.oReportDialog.StockDimensionID),this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere?i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?t.push(-1):t.push(this.ViewModel.oReportDialog.LocationWhere):t.push(null),t.push(this.GetDimensionFilterForStock("DCC.dcCCNID")),t.push(d.GetExcludeStockTransfer(this.ViewModel)),14==this.ViewModel.StaticReportType&&t.push(this.ViewModel.oReportDialog.FromDate.Date),t.push(this.ViewModel.oReportDialog.ToDate.Date),t.push(this.UnPostedDocsInclude),t.push(this.DefValuation),15==this.ViewModel.StaticReportType&&t.push(this.Show==u.TagWise?1:0),14==this.ViewModel.StaticReportType&&(t.push(e),t.push(e.length>0?this.GetPriceFilter():"")),t.push(this.CurrencyType),t.push(this.ForeignCurrencyID),t.push(this.SortTransactionsBy),t.push(o.a.SessionManager.UserID),t.push(o.a.SessionManager.LanguageID),0==this.dsMain.Tables[0].length||0==this.dsMain.Tables[1].length)return;this.dsMerge=null,this.R=0,this.SV1CallBack()}else if(16==this.ViewModel.StaticReportType)this.GetStockListQuery(h,c).then(e=>{if(this.ds=e,s=new Date,0==this.ViewModel.ReportGroups.length){if(this.oColumns.forEach(e=>{33==e.ID.length&&this.dsMain.Columns[0].Contains(e.ID)&&this.ExtraColumns.push(e)}),this.ExtraColumns.forEach(e=>{this.dsMain.Columns[0].Contains(e.ID),this.ds.Columns[0].push(e.ID)}),this.Show==u.TagWise){let e=new Array,t=!1;for(let s=this.TagWiseColStart;s<this.oColumns.length;s++)this.ds.Columns[0].push(this.oColumns[s].ID),this.oColumns[s].ID.startsWith("BalQty")&&this.HideEmptyDimensions&&0==this.ds.Tables[0].filter(e=>e.TagID==this.oColumns[s].ID.Replace("BalQty","")).length&&(this.oColumns[s].HeaderAppearance.IsVisible=!1,t=!0);t&&(this.oColumns.forEach(t=>{e.push(t)}),this.ViewModel.ReportColumns=e)}this.ds.Columns[0].Contains("BalQty_Max")||(this.ds.Columns[0].push("BalQty_Max"),this.ds.Columns[0].push("BalQty_Min")),this.DataSetCollection.push(this.ds),this.dsSource=this.dsMain.Tables[0].length-this.ds.Tables[0].length>1e4&&this.ShowProductsWithoutTransactions?{Tables:[],Columns:this.ds.Columns.Copy()}:this.ds;for(let e=0;e<this.dsMain.Tables[0].length;e++)if(this.drMain=this.dsMain.Tables[0][e],this.strProductID=this.drMain[this.dsMain.Columns[0][0]].toString(),this.ShowLevelTree&&Object(l.j)(this.drMain.IsGroup))this.drRecord={},this.drRecord.ProductCode=this.drMain.ProductCode.toString(),this.drRecord.ProductName=this.drMain.ProductName.toString(),this.ExtraColumns.forEach(e=>{this.drRecord[e.ID]=this.drMain[e.ID]}),this.addStockList(!1);else{if(this.drr=this.dsSource.Tables[0].filter(e=>e.ProductID==this.strProductID),0==this.drr.length&&this.ShowProductsWithoutTransactions){let e={};e.ProductID=this.strProductID,e.ProductCode=this.drMain.ProductCode.toString(),e.ProductName=this.drMain.ProductName.toString(),this.ds.Tables[0].push(e),this.drr=[e]}if(this.drr.length>0){let e=new Array;for(let t=0;t<this.drr.length;t++){if(this.dblBalQty=this.GetAbsoluteQty(this.drr[t].BalQty),0==this.dblBalQty){if(!this.Display_Zero)continue}else if(this.dblBalQty>=0){if(!this.Display_Positive)continue}else if(!this.Display_Negative)continue;e.push(this.drr[t])}if(this.drr=e,0==this.drr.length)continue;this.drRecord=this.drr[0],this.ExtraColumns.forEach(e=>{i.e.IsEmpty(this.drMain[e.ID])||(this.drr[0][e.ID]=this.drMain[e.ID])}),this.IsMultipleUnits&&(this.dblMaxConv=parseFloat(this.drMain.MaxConv),this.dblMinConv=parseFloat(this.drMain.MinConv),this.MultipleUnitType==D.Max?this.drRecord.BalQty_Max=this.dblBalQty/this.dblMaxConv:this.MultipleUnitType==D.Min?this.drRecord.BalQty_Min=this.dblBalQty/this.dblMinConv:this.dblBalQty>=0?(this.drRecord.BalQty_Max=Math.floor(this.dblBalQty/this.dblMaxConv),this.drRecord.BalQty_Min=Math.floor(this.dblBalQty%this.dblMaxConv/this.dblMinConv)):(this.drRecord.BalQty_Max=Math.ceil(this.dblBalQty/this.dblMaxConv),this.drRecord.BalQty_Min=Math.ceil(this.dblBalQty%this.dblMaxConv/this.dblMinConv))),this.addStockList(!1),this.Show==u.TagWise&&(this.drRecord.TagID=null)}}if(this.AddReportTotal_StockMovement(),50==this.LevelNo)for(let e=this.ViewModel.Data.length-1;e>=0;e--)this.ViewModel.Data[e].Visible||this.ViewModel.Data[e].IsGroup||this.ViewModel.Data.RemoveAt(e);this.LoadReportComplete()}else{if(this.ViewModel.ReportParams.ContainsKey("BinDimension")&&this.dsMain.Tables[3].length>0){let e=i.e.Int(this.dsMain.Tables[3][0].Value);if(e>0){d.GetTagTableName(e);let t=o.a.report.ReportDataSet("RPT022",this.ViewModel.IsReportDB,"SELECT NodeID,Name FROM "+d.GetTagTableName(e)+" with(nolock) where IsGroup=0 ");t.Tables.length>0&&t.Columns[0].Contains("Name")&&(this.dtBins=t.Tables[0])}}let e,t;if(this.ProductGroupFirst?(e=this.dsMain.Tables[0],t=this.dsMain.Tables[1]):(e=this.dsMain.Tables[1],t=this.dsMain.Tables[0]),0==e.length||0==t.length)return;this.dsMerge=null,this.R=0,this.ds.Columns[0].push(this.ViewModel.ReportGroups[0].ID),this.ds.Columns[0].push(this.ViewModel.ReportGroups[1].ID),null!=this.dtBins&&this.ds.Columns[0].push(this.ViewModel.ReportParams.BinDimension),this.dsMain.Columns[0].forEach(e=>{this.ds.Columns[0].Contains(e)||this.ds.Columns[0].push(e)}),this.IsMultipleUnits&&!this.ds.Columns[0].Contains("BalQty_Max")&&(this.ds.Columns[0].push("BalQty_Max"),this.ds.Columns[0].push("BalQty_Min")),null==this.dsMerge?this.dsMerge=this.ds:this.dsMerge.Merge(this.ds),this.DataSetCollection.push(this.ds),this.RenderData(this.dsMerge.Tables[0]),this.ViewModel.CheckAndAddTotals(this.dsMerge.Tables[0]),this.LoadReportComplete()}});else if(159==this.ViewModel.StaticReportType){this.al=[],this.al.push(0),this.al.push(""),this.al.push(this.TagID),this.al.push(" inner join com_docccdata DCC with(nolock) on DCC.InvDocDetailsID=D.InvDocDetailsID");let e="";if(!this.ViewModel.HideCostCenterTree){var a=this.ViewModel.oReportDialog.CostCenterFilters.find(e=>e.CostCenterID==this.TagID);if(null!=a){let t="";a.SelectedNodes.forEach(e=>{t+=e.Id+","}),t.length>0&&(t=t.Remove(t.length-1,1),e+=" AND DCC.DCCCNID"+(a.CostCenterID-5e4)+" IN ("+t.toString()+")")}}let t=null;this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(t=i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?"-1":this.ViewModel.oReportDialog.LocationWhere,e+=" AND DCC.DCCCNID"+(this.ViewModel.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+t+")"),this.al.push(e),this.al.push(this.ViewModel.oReportDialog.FromDate.Date),this.al.push(this.ViewModel.oReportDialog.ToDate.Date),this.al.push(this.UnPostedDocsInclude),this.al.push(o.a.SessionManager.UserName),o.a.report.SetAvgRateTempTable(this.al,this.ViewModel.IsReportDB).then(e=>{if(this.TemporaryTableName=e.Tables.length>0&&e.Tables[0].length>0&&e.Columns[0].Contains("TABLENAME")?e.Tables[0][0].TABLENAME.toString():"",0==this.TemporaryTableName.length)return this.ViewModel.DisplayMessage="Setting Temporary Table Error.",void this.LoadReportComplete();this.al=[],this.al.push(this.TemporaryTableName),this.al.push(this.TagID),this.al.push(""),this.al.push(this.ViewModel.oReportDialog.StockDimensionID),this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere?i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?this.al.push(-1):this.al.push(this.ViewModel.oReportDialog.LocationWhere):this.al.push(null),this.al.push(this.ViewModel.oReportDialog.ToDate.Date),this.al.push(this.DefValuation),this.al.push(o.a.SessionManager.LanguageID),this.oColumns.forEach(e=>{33==e.ID.length&&this.dsMain.Columns[0].Contains(e.ID)&&this.ExtraColumns.push(e)}),this.SBCallBack()})}})}catch(r){Logger.ErrorLog("INV_StockLedger:: LoadReport",r)}}LoadReportComplete(){this.TemporaryTableName.length>0&&o.a.report.ReportDataSet("RPT022",this.ViewModel.IsReportDB,"USE PACT2C\n            IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].["+this.TemporaryTableName+"]') AND type in (N'U'))\nDROP TABLE "+this.TemporaryTableName+"\nDELETE FROM RPT_TempTables WHERE TempTableName='"+this.TemporaryTableName+"'"),this.ViewModel.FormulasCalculated=!0,this.ViewModel.process_RunWorkerCompleted()}SLCallBack(){if(this.iLoop>=this.dsMain.Tables[0].length)this.SLCallBack_Complete();else if(this.ViewModel.process.CancellationPending)this.ViewModel.processArgs.Cancel=!0;else{this.sbChunks="";for(let e=this.iLoop;e<this.dsMain.Tables[0].length&&e-this.iLoop<this.ChunkSize;e++)this.sbChunks.length>0&&(this.sbChunks+=","),this.sbChunks+=this.dsMain.Tables[0][e][this.dsMain.Columns[0][0]].toString();this.al[0]=this.sbChunks.toString(),o.a.report.GetStockLedger(this.al,this.ViewModel.IsReportDB).then(e=>{this.ds=e,this.DataSetCollection.push(this.ds),this.ExtraColumns.forEach(e=>{this.dsMain.Columns[0].Contains(e.ID),this.ds.Columns[0].push(e.ID)}),this.ds.Columns[0].Contains("BalanceQty")||(this.ds.Columns[0].push("BalanceQty"),this.ds.Columns[0].push("AvgRate"),this.ds.Columns[0].push("BalanceValue"),this.ds.Columns[0].push("COGS"),this.IsMultipleUnits&&(this.ds.Columns[0].push("BalanceQty_Max"),this.ds.Columns[0].push("BalanceQty_Min"))),this.dv=this.dvTable=this.ds.Tables[0],this.dvOpen=this.dvOpenTable=this.ds.Tables[1],this.dvOpenTrans=this.dvOpenTransTable=this.ds.Tables[2];for(let t=this.iLoop;t<this.dsMain.Tables[0].length&&t-this.iLoop<this.ChunkSize;t++)if(this.drMain=this.dsMain.Tables[0][t],this.strProductID=this.drMain[this.dsMain.Columns[0][0]].toString(),this.strProductName=this.drMain.ProductName.toString(),this.ValuationID=0==this.DefValuation?parseInt(this.drMain.ValuationID):this.DefValuation,this.IsMultipleUnits&&(this.dblMaxConv=parseFloat(this.drMain.MaxConv),this.dblMinConv=parseFloat(this.drMain.MinConv)),this.dv=this.dvTable.filter(e=>e.ProductID==this.strProductID),this.dvOpen=this.dvOpenTable.filter(e=>e.ProductID==this.strProductID),this.dvOpenTrans=this.dvOpenTransTable.filter(e=>e.ProductID==this.strProductID),(0!=this.dv.length||this.ShowProductsWithoutTransactions)&&(this.dv.length>0||this.dvOpen.length>0)){if(0==this.dv.length&&this.dvOpen.length>0&&null!=this.dvOpen[0].OpQty&&0==parseFloat(this.dvOpen[0].OpQty))continue;this.ExtraColumns.forEach(e=>{for(this.k=0;this.k<this.dv.length;this.k++)this.dv[this.k][e.ID]=this.drMain[e.ID]}),this.addRows()}this.ViewModel.refreshDataView(),this.iLoop+=this.ChunkSize,this.SLCallBack()},e=>{this.LoadReportComplete()})}}SLCallBack_Complete(){if(this.AddReportTotal(),this.IsReconcile){let t=this.ViewModel.Preferences.COGS;t=t.Contains(",")?" in ("+t+")":"="+t,this.sbChunks="",this.sbChunks+="DECLARE @From FLOAT,@To FLOAT\n        SET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))\n        SET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))\n        select VoucherNo,convert(datetime,DocDate) DocDate,sum(Dr)-sum(Cr) GLCOGS\n        from\n        (\n        select VoucherNo,DocDate,sum(Amount) Dr,0 Cr\n        from Acc_docDetails D with(nolock)\n        where D.InvDocDetailsID is null and  DocDate BETWEEN @From AND @To AND (D.DocumentType<>14 AND D.DocumentType<>19 AND (D.StatusID=369 or D.StatusID=429))\n        and D.DebitAccount"+t+"\n        group by VoucherNo,DocDate\n        union all\n        select VoucherNo,DocDate,0 Dr,sum(Amount) Cr from Acc_docDetails D with(nolock)\n        where D.InvDocDetailsID is null and  DocDate BETWEEN @From AND @To AND (D.DocumentType<>14 AND D.DocumentType<>19 AND (D.StatusID=369 or D.StatusID=429))\n        and D.CreditAccount"+t+"\n        group by VoucherNo,DocDate\n        ) AS T\n        group by VoucherNo,DocDate\n        order by DocDate,VoucherNo";let s=o.a.report.ReportDataTable("RPT022",this.ViewModel.IsReportDB,this.sbChunks);if(s.length>0){this.row=this.NewReportRow_2(n.f.Group,this.GrossTotalAppearance),this.row.LevelNo=1,this.row.Cells[0].ColSpan=this.row.Cells.length,this.row.Cells[0].Text="Non-Inventory Documents",this.ViewModel.addRow(this.row);var e=this.oColumns.find(e=>"VoucherNo"==e.ID);let t=null!=e?this.oColumns.indexOf(e):0,o=null!=(e=this.oColumns.find(e=>"DocDate"==e.ID))?this.oColumns.indexOf(e):-1;this.AggTotal[this.colGLCOGSIndex][1]=0,this.AggTotal[this.colGLCOGSIndex][0]=0,s.forEach(e=>{this.row=this.NewReportRow(),this.dbl=i.e.Double(e.GLCOGS),this.AggTotal[this.colGLCOGSIndex][1]+=this.dbl,this.AggTotal[this.colGLCOGSIndex][0]+=this.dbl,-1!=o&&this.ViewModel.SetCellValue(e.DocDate,this.oColumns[o].DataFormat,this.oColumns[o].ColumnType,this.row.Cells[o]),this.ViewModel.SetCellValue(e.VoucherNo,this.oColumns[t].DataFormat,this.oColumns[t].ColumnType,this.row.Cells[t]),this.ViewModel.SetCellValue(e.GLCOGS,this.oColumns[this.colGLCOGSIndex].DataFormat,this.oColumns[this.colGLCOGSIndex].ColumnType,this.row.Cells[this.colGLCOGSIndex]),-1!=this.ViewModel.colSNoIndex&&(this.row.Cells[this.ViewModel.colSNoIndex].Value=++this.ViewModel.SNo,this.row.Cells[this.ViewModel.colSNoIndex].Text=this.ViewModel.SNo.toString()),this.ViewModel.addRow(this.row)}),this.row=this.NewReportRow_2(n.f.SubTotal,this.GrossTotalAppearance_Data),this.row.Cells[0].Text="Non-Inventory Documents Total",this.row.Cells[0].ColSpan=this.colGLCOGSIndex,this.row.Cells[0].CellAppearance.Alignment="Left",this.ViewModel.SetCellValue(this.AggTotal[this.colGLCOGSIndex][0],this.oColumns[this.colGLCOGSIndex].DataFormat,this.oColumns[this.colGLCOGSIndex].ColumnType,this.row.Cells[this.colGLCOGSIndex]),this.ViewModel.addRow(this.row)}}this.LoadReportComplete()}SV0CallBack(){{if(this.iLoop>=this.dsMain.Tables[0].length)return void this.SV0CallBack_Complete();if(this.ViewModel.process.CancellationPending)return void(this.ViewModel.processArgs.Cancel=!0);this.sbChunks="";for(let t=this.iLoop;t<this.dsMain.Tables[0].length&&t-this.iLoop<this.ChunkSize;t++)this.ShowLevelTree&&Object(l.j)(this.dsMain.Tables[0][t].IsGroup)||(this.sbChunks.length>0&&(this.sbChunks+=","),this.sbChunks+=this.dsMain.Tables[0][t][this.dsMain.Columns[0][0]].toString());let e;0==this.sbChunks.length&&(0==this.DataSetCollection.length?this.sbChunks+=this.dsMain.Tables[0][this.iLoop][this.dsMain.Columns[0][0]].toString():(this.ds={Tables:[],Columns:this.DataSetCollection[this.DataSetCollection.length-1].Columns.Copy()},e=new Promise((e,t)=>{e(this.ds)}))),this.sbChunks.length>0&&(this.al[0]=this.sbChunks.toString(),14==this.ViewModel.StaticReportType?e=o.a.report.GetStockMovement(this.al,this.ViewModel.IsReportDB):15==this.ViewModel.StaticReportType&&(e=o.a.report.GetStockValuation(this.al,this.ViewModel.IsReportDB))),e&&e.then(e=>{if(this.ds=e,this.ds.Columns[0].Contains("ProductCode")||(this.ds.Columns[0].push("ProductCode"),this.ds.Tables[0].push("ProductName")),this.ds.Columns[0].Contains("BalQty_Max")||(this.ds.Columns[0].push("BalQty_Max"),this.ds.Columns[0].push("BalQty_Min")),this.ExtraColumns.forEach(e=>{this.ds.Columns[0].Contains(e.ID)||(this.dsMain.Columns[0].Contains(e.ID),this.ds.Columns[0].push(e.ID))}),this.ViewModel.FormulaColumns.forEach(e=>{this.ds.Columns[0].Contains(e.ID)||this.ds.Columns[0].push(e.ID)}),this.lstPCRates.length>0&&this.ds.Columns[0].Contains("PCxml")){let e;this.lstPCRates.forEach(e=>{this.ds.Columns[0].Contains(e)||this.ds.Columns[0].push(e)});for(let t=0;t<this.ds.Tables[0].length;t++){e=this.ds.Tables[0][t].PCxml.toString().split(",");for(let s=0;s<this.lstPCRates.length&&s<e.length;s++)this.ds.Tables[0][t][this.lstPCRates[s]]=e[s]}}if(this.IsSaleQty&&!this.ds.Columns[0].Contains("SaleQty")&&this.ds.Columns[0].push("SaleQty"),this.IsSaleValue&&!this.ds.Columns[0].Contains("SaleValue")&&this.ds.Columns[0].push("SaleValue"),this.Show!=u.None)for(let t=this.ViewModel.ColumnSource.length;t<this.oColumns.length;t++)this.ds.Columns[0].Contains(this.oColumns[t].ID)||this.ds.Columns[0].push(this.oColumns[t].ID);this.DataSetCollection.push(this.ds),this.dv=this.ds.Tables[0],this.dvTable=this.ds.Tables[0];for(let t=this.iLoop;t<this.dsMain.Tables[0].length&&t-this.iLoop<this.ChunkSize;t++)if(this.drMain=this.dsMain.Tables[0][t],this.strProductID=this.drMain[this.dsMain.Columns[0][0]].toString(),this.ShowLevelTree&&Object(l.j)(this.drMain.IsGroup))this.drRecord={},this.drRecord.ProductCode=this.drMain.ProductCode.toString(),this.drRecord.ProductName=this.drMain.ProductName.toString(),this.ExtraColumns.forEach(e=>{this.drRecord[e.ID]=this.drMain[e.ID]}),this.addStockMovement();else{if(this.dv=this.dvTable.filter(e=>e.ProductID==this.strProductID),0==this.dv.length&&this.ShowProductsWithoutTransactions){let e={};e.ProductID=this.strProductID,this.ds.Tables[0].push(e)}if(this.dv.length>0){if(this.drRecord=this.dv[0],this.drRecord.ProductCode=this.drMain.ProductCode.toString(),this.drRecord.ProductName=this.drMain.ProductName.toString(),this.ExtraColumns.forEach(e=>{this.drRecord[e.ID]=this.drMain[e.ID]}),this.IsSaleQty&&(this.drRecord.SaleQty=this.drMain.SaleQty),this.IsSaleValue&&(this.drRecord.SaleValue=this.drMain.SaleValue),this.dblBalQty=this.GetAbsoluteQty(this.dv[0].BalQty),0==this.dblBalQty){if(!this.Display_Zero)continue}else if(this.dblBalQty>=0){if(!this.Display_Positive)continue}else if(!this.Display_Negative)continue;this.IsMultipleUnits&&(this.dblMaxConv=parseFloat(this.drMain.MaxConv),this.dblMinConv=parseFloat(this.drMain.MinConv)),this.addStockMovement()}}this.ViewModel.refreshDataView(),this.iLoop+=this.ChunkSize,this.SV0CallBack()},e=>{this.LoadReportComplete()})}}SV0CallBack_Complete(){this.AddReportTotal_StockMovement(),this.LoadReportComplete()}SV1CallBack(){{if(this.iLoop>=this.dsMain.Tables[0].length)return void this.SV0CallBack_Complete();if(this.ViewModel.process.CancellationPending)return void(this.ViewModel.processArgs.Cancel=!0);this.sbChunks="";for(let t=this.iLoop;t<this.dsMain.Tables[0].length&&t-this.iLoop<this.ChunkSize;t++)this.sbChunks.length>0&&(this.sbChunks+=","),this.sbChunks+=this.dsMain.Tables[0][t].ProductID.toString()+"~"+this.dsMain.Tables[0][t].TagID.toString();let e;this.al[2]=this.sbChunks.toString(),14==this.ViewModel.StaticReportType?e=o.a.report.GetStockMovement(this.al,this.ViewModel.IsReportDB):15==this.ViewModel.StaticReportType&&(e=o.a.report.GetStockValuation2(this.al,this.ViewModel.IsReportDB)),e.then(e=>{this.ds=e,this.ds.Columns[0].push(this.ViewModel.ReportGroups[0].ID),this.ds.Columns[0].push(this.ViewModel.ReportGroups[1].ID),null!=this.dtBins&&this.ds.Columns[0].push(this.ViewModel.ReportParams.BinDimension),this.dsMain.Columns[0].forEach(e=>{this.ds.Columns[0].Contains(e)||this.ds.Columns[0].push(e)}),this.IsMultipleUnits&&!this.ds.Columns[0].Contains("BalQty_Max")&&(this.ds.Columns[0].push("BalQty_Max"),this.ds.Columns[0].push("BalQty_Min")),null==this.dsMerge?this.dsMerge=this.ds:this.dsMerge.Merge(this.ds),this.DataSetCollection.push(this.ds),this.RenderData(this.dsMerge.Tables[0]),this.ViewModel.refreshDataView(),this.iLoop+=this.ChunkSize,this.SV1CallBack()},e=>{this.LoadReportComplete()})}}SV1CallBack_Complete(){this.ViewModel.CheckAndAddTotals(this.dsMerge.Tables[0]),this.LoadReportComplete()}SBCallBack(){if(this.iLoop>=this.dsMain.Tables[0].length)this.SBCallBack_Complete();else if(this.ViewModel.process.CancellationPending)this.ViewModel.processArgs.Cancel=!0;else{this.sbChunks="";for(let e=this.iLoop;e<this.dsMain.Tables[0].length&&e-this.iLoop<this.ChunkSize;e++)this.ShowLevelTree&&Object(l.j)(this.dsMain.Tables[0][e].IsGroup)||(this.sbChunks.length>0&&(this.sbChunks+=","),this.sbChunks+=this.dsMain.Tables[0][e][this.dsMain.Columns[0][0]].toString());this.al[2]=this.sbChunks.toString(),o.a.report.GetStockBalancesTagWise(this.al,this.ViewModel.IsReportDB).then(e=>{this.ds=e,this.ds.Columns[0].push("Code"),this.ds.Columns[0].push("Name"),this.ExtraColumns.forEach(e=>{this.dsMain.Columns[0].Contains(e.ID),this.ds.Columns[0].push(e.ID)}),this.DataSetCollection.push(this.ds),this.dv=this.ds.Tables[0],this.dvTable=this.ds.Tables[0];for(let t=this.iLoop;t<this.dsMain.Tables[0].length&&t-this.iLoop<this.ChunkSize;t++)this.drMain=this.dsMain.Tables[0][t],this.strProductID=this.drMain[this.dsMain.Columns[0][0]].toString(),this.ShowLevelTree&&Object(l.j)(this.drMain.IsGroup)?(this.drRecord={},this.drRecord.Code=this.drMain.Code.toString(),this.drRecord.Name=this.drMain.Name.toString(),this.ExtraColumns.forEach(e=>{this.drRecord[e.ID]=this.drMain[e.ID]}),this.addStockMovement()):(this.dv=this.dvTable.filter(e=>e.TagID==this.strProductID),this.dv.length>0&&(this.drRecord=this.dv[0],this.drRecord.Code=this.drMain.Code.toString(),this.drRecord.Name=this.drMain.Name.toString(),this.ExtraColumns.forEach(e=>{this.drRecord[e.ID]=this.drMain[e.ID]}),this.addStockMovement()));this.ViewModel.refreshDataView(),this.iLoop+=this.ChunkSize,this.SV1CallBack()},e=>{this.LoadReportComplete()})}}SBCallBack_Complete(){this.AddReportTotal_StockMovement(),this.LoadReportComplete()}RefreshColumnIndexes(){for(let e=this.oColumns.length-1;e>=0;e--)"BalanceQty"==this.oColumns[e].ID||"BalQty"==this.oColumns[e].ID?this.colBalanceQtyIndex=e:"AvgRate"==this.oColumns[e].ID?this.colBalanceRateIndex=e:"BalanceValue"==this.oColumns[e].ID?this.colBalanceValueIndex=e:"COGS"==this.oColumns[e].ID?this.colCOGSIndex=e:"GLCOGS"==this.oColumns[e].ID?this.colGLCOGSIndex=e:0==i.e.stringCompare(this.oColumns[e].Formula,"SNO",!0)?this.ViewModel.colSNoIndex=e:"Valuation"==this.oColumns[e].ID&&(this.Valuation=this.oColumns[e],this.ExtraColumns.push(this.Valuation))}SetMultipleUnitsQry(){let e=!1;14!=this.ViewModel.StaticReportType&&15!=this.ViewModel.StaticReportType||2!=this.ViewModel.ReportGroups.length||(e=!0),this.MultipleUnitSelect=this.MultipleUnitJoin="",e?this.IsMultipleUnits&&(this.MultipleUnitSelect=",max(MU.MaxConv) MaxConv,max(MU.MinConv) MinConv",this.ShowMultipleUnitNames&&(this.MultipleUnitSelect+=",max(MU.MaxUnit) C693051cdb2b34db6aca385c6aMaxUnit,max(MU.MinUnit) C693051cdb2b34db6aca385c6aMinUnit")):this.IsMultipleUnits&&(this.MultipleUnitSelect=",MU.MaxConv,MU.MinConv",this.ShowMultipleUnitNames&&(this.MultipleUnitSelect+=",MU.MaxUnit C693051cdb2b34db6aca385c6aMaxUnit,MU.MinUnit C693051cdb2b34db6aca385c6aMinUnit")),this.IsMultipleUnits&&(this.MultipleUnitJoin=this.ShowMultipleUnitNames?" inner join COM_UOM PU with(nolock) ON P.UOMID=PU.UOMID\ninner join (select BaseID,max(MaxUnit) MaxUnit,max(MaxConv) MaxConv,max(MinUnit) MinUnit,max(MinConv) MinConv from\n(\nselect X1.BaseID,X1.UnitName MaxUnit,XT1.MaxConv,null MinUnit,null MinConv from COM_UOM X1\njoin (select BaseID,max(Conversion) MaxConv from COM_UOM group by BaseID) as XT1 on XT1.BaseID=X1.BaseID and XT1.MaxConv=X1.Conversion\nunion all\nselect X1.BaseID,null MaxUnit,null MaxConv,X1.UnitName MinUnit,XT1.MinConv from COM_UOM X1\njoin (select BaseID,min(Conversion) MinConv from COM_UOM group by BaseID) as XT1 on XT1.BaseID=X1.BaseID and XT1.MinConv=X1.Conversion\n) AS MT\ngroup by BaseID\n) as MU on PU.BaseID=MU.BaseID":" inner join COM_UOM PU with(nolock) ON P.UOMID=PU.UOMID\ninner join (select BaseID,max(Conversion) MaxConv,min(Conversion) MinConv from COM_UOM group by BaseID) as MU on PU.BaseID=MU.BaseID")}AddMultipleUnitCols(e){try{let t=!1;13!=this.ViewModel.StaticReportType&&16!=this.ViewModel.StaticReportType||(t=!0);let s,o=0;this.MultipleUnitType!=D.Both&&this.MultipleUnitType!=D.Max||(s=this.ViewModel.ColumnSource[this.colBalanceQtyIndex].Clone(),s.HeaderText="Max. "+s.HeaderText,s.ID=s.ID+"_Max",t?(e.InsertAt(s,this.colBalanceQtyIndex+ ++o),this.colBalanceQtyMaxIndex=this.colBalanceQtyIndex+o,this.ViewModel.GrpReportTotal.TempTotalCols.ContainsKey(s.ID)||this.ViewModel.lstGroup.forEach(e=>{this.ViewModel.GrpReportTotal.TempTotalCols.Add(s.ID,this.colBalanceQtyMaxIndex),e.TempTotalCols.ContainsKey(s.ID)||e.TempTotalCols.push(s.ID,this.colBalanceQtyMaxIndex)})):(e.push(s),this.colBalanceQtyMaxIndex=e.length,this.ViewModel.GrpReportTotal.TempTotalCols.ContainsKey(s.ID)||(this.ViewModel.GrpReportTotal.TempTotalCols.push(s.ID,e.length-1),this.ViewModel.lstGroup.forEach(t=>{t.TempTotalCols.ContainsKey(s.ID)||t.TempTotalCols.push(s.ID,e.length-1)}))),this.ShowMultipleUnitNames&&(s=this.ViewModel.ColumnSource[this.colBalanceQtyIndex].Clone(),s.ColumnType="",s.width=80,s.HeaderText="Max Unit",s.DataAppearance.Alignment="Left",s.ID="C693051cdb2b34db6aca385c6aMaxUnit",t?e.InsertAt(s,this.colBalanceQtyIndex+ ++o):e.push(s))),this.MultipleUnitType!=D.Both&&this.MultipleUnitType!=D.Min||(s=this.ViewModel.ColumnSource[this.colBalanceQtyIndex].Clone(),s.HeaderText="Min. "+s.HeaderText,s.ID=s.ID+"_Min",t?(e.InsertAt(s,this.colBalanceQtyIndex+ ++o),this.colBalanceQtyMinIndex=this.colBalanceQtyIndex+o,this.ViewModel.GrpReportTotal.TempTotalCols.ContainsKey(s.ID)||this.ViewModel.lstGroup.forEach(t=>{t.TempTotalCols.ContainsKey(s.ID)||t.TempTotalCols.push(s.ID,e.length-1)})):(e.push(s),this.colBalanceQtyMinIndex=e.length,this.ViewModel.GrpReportTotal.TempTotalCols.ContainsKey(s.ID)||(this.ViewModel.GrpReportTotal.TempTotalCols.push(s.ID,e.length-1),this.ViewModel.lstGroup.forEach(t=>{t.TempTotalCols.ContainsKey(s.ID)||t.TempTotalCols.push(s.ID,e.length-1)}))),this.ShowMultipleUnitNames&&(s=this.ViewModel.ColumnSource[this.colBalanceQtyIndex].Clone(),s.ColumnType="",s.width=80,s.HeaderText="Min Unit",s.DataAppearance.Alignment="Left",s.ID="C693051cdb2b34db6aca385c6aMinUnit",t?e.InsertAt(s,this.colBalanceQtyIndex+ ++o):e.push(s)))}catch(t){}}GetAbsoluteQty(e){let t=i.e.Double(e);return 0!=t&&Math.abs(t)<=1e-6&&(t=0),t}LoadReportWithPostFilters(e){if(this.GrdRow=-1,this.AggTotal=i.e.NumArray(this.oColumns.length,2),this.ViewModel.ClearRows(),null!=this.lstTotal&&(this.lstTotal.Clear(),this.lstParents.Clear(),this.lstParents.push(this.NewReportRow()),this.lstTotal.push(new Array(this.oColumns.length).fill(0))),13==this.ViewModel.StaticReportType){e.length>0&&(e=" AND "+e);for(let e=0,t=0;e<this.dsMain.Tables[0].length;e+=this.ChunkSize,t++){this.ds=this.DataSetCollection[t],this.dv=this.dvTable=this.ds.Tables[0],this.dvOpen=this.dvOpenTable=this.ds.Tables[1];for(let t=e;t<this.dsMain.Tables[0].length&&t-e<this.ChunkSize;t++)this.drMain=this.dsMain.Tables[0][t],this.strProductID=this.drMain[this.dsMain.Columns[0][0]].toString(),this.strProductName=this.drMain.ProductName.toString(),this.ValuationID=0==this.DefValuation?parseInt(this.drMain.ValuationID):this.DefValuation,this.dv=this.dvTable.filter(e=>e.ProductID==this.strProductID),this.dvOpen=this.dvOpenTable.filter(e=>e.ProductID==this.strProductID),this.dv=h.a.FilterData(this.dv,this.ViewModel.PostDataFetchFilterFields),this.dvOpen=h.a.FilterData(this.dvOpen,this.ViewModel.PostDataFetchFilterFields),(0!=this.dv.length||this.ShowProductsWithoutTransactions)&&(this.dv.length>0||this.dvOpen.length>0)&&this.addRows()}}else if(16==this.ViewModel.StaticReportType){e.length>0&&(e=" AND "+e),this.ds=this.DataSetCollection[0],this.dv=this.ds.Tables[0];for(let e=0;e<this.dsMain.Tables[0].length;e++)this.drMain=this.dsMain.Tables[0][e],this.strProductID=this.drMain[this.dsMain.Columns[0][0]].toString(),this.ShowLevelTree&&Object(l.j)(this.drMain.IsGroup)?(this.drRecord={},this.drRecord.ProductCode=this.drMain.ProductCode.toString(),this.drRecord.ProductName=this.drMain.ProductName.toString(),this.addStockList(!0)):(this.drr=this.ds.Tables[0].filter(e=>e.ProductID==this.strProductID),this.drr=h.a.FilterData(this.drr,this.ViewModel.PostDataFetchFilterFields),this.drr.length>0&&(this.drRecord=this.drr[0],this.drRecord.ProductCode=this.drMain.ProductCode.toString(),this.drRecord.ProductName=this.drMain.ProductName.toString(),this.addStockList(!0)))}else for(let t=0,s=0;t<this.dsMain.Tables[0].length;t+=this.ChunkSize,s++){this.ds=this.DataSetCollection[s],this.dv=this.dvTable=this.ds.Tables[0];for(let e=t;e<this.dsMain.Tables[0].length&&e-t<this.ChunkSize;e++)this.drMain=this.dsMain.Tables[0][e],this.strProductID=this.drMain[this.dsMain.Columns[0][0]].toString(),this.ShowLevelTree&&Object(l.j)(this.drMain.IsGroup)?(this.drRecord={},this.drRecord.ProductCode=this.drMain.ProductCode.toString(),this.drRecord.ProductName=this.drMain.ProductName.toString(),this.addStockMovement()):(this.dv=this.dvTable.filter(e=>e.ProductID==this.strProductID),this.dv=h.a.FilterData(this.dv,this.ViewModel.PostDataFetchFilterFields),this.dv.length>0&&(this.drRecord=this.dv[0],this.drRecord.ProductCode=this.drMain.ProductCode.toString(),this.drRecord.ProductName=this.drMain.ProductName.toString(),this.addStockMovement()))}13==this.ViewModel.StaticReportType?this.AddReportTotal():14!=this.ViewModel.StaticReportType&&15!=this.ViewModel.StaticReportType&&16!=this.ViewModel.StaticReportType||this.AddReportTotal_StockMovement(),this.ViewModel.process_RunWorkerCompleted()}GetStockListQuery(e,t){let s=0;o.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&(s=i.e.Int(o.a.SessionManager.Preferences["Maintain Dimensionwise stock"])),0==s&&"True"==o.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==o.a.SessionManager.Preferences["LW Reports"]&&(s=50002),0==s&&(s=50002);let a="",n="",r="",h="",D="";this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(a=i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?"-1":this.ViewModel.oReportDialog.LocationWhere);let c=this.GetDimensionFilterForStock("DCC.dcCCNID");""==a&&""==c||(n=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID",""!=a&&(n+=" AND DCC.DCCCNID"+(s-5e4)+" IN ("+a+") "),""!=c&&(n+=c)),r=this.UnPostedDocsInclude?" AND D.StatusID<>376 and D.StatusID<>372":" AND D.StatusID=369",h=!i.e.IsEmpty(o.a.SessionManager.Preferences.ConsiderUnAppInHold)&&Object(l.j)(o.a.SessionManager.Preferences.ConsiderUnAppInHold)?" AND DX.StatusID in (371,441,369)":this.UnPostedDocsInclude?" AND DX.StatusID<>376 and DX.StatusID<>372":" AND DX.StatusID=369",this.ForeignCurrencyID>0&&(D=" AND D.CurrencyID="+this.ForeignCurrencyID);let C=d.GetExcludeStockTransfer(this.ViewModel),p="",T="",_="",m="";if(p+="DECLARE @TODATE FLOAT\nSET @TODATE=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",this.TagID>0){if(i.e.IsEmpty(this.TagsList)){this.TagsList="";for(let e=0;e<this.dsMain.Tables[1].length;e++)this.TagsList.length>0&&(this.TagsList+=","),this.TagsList+=this.dsMain.Tables[1][e][0].toString()}p+="\nDECLARE @TblTags AS TABLE(ID INT IDENTITY(1,1) NOT NULL,NodeID BIGINT)\nINSERT INTO @TblTags(NodeID)\nEXEC SPSplitString '"+this.TagsList+"',','",0==n.length&&(n=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID"),T=",T.NodeID AS TagID",_="INNER JOIN @TblTags T ON DCC.DCCCNID"+(this.TagID-5e4)+"=T.NodeID ",m=",T.NodeID"}let I="",R="",S="",A="",M="",g="";var w=this.ViewModel.BaseReportColumns.find(e=>26419==e.CDGDO.FieldValue),E=this.ViewModel.BaseReportColumns.find(e=>26420==e.CDGDO.FieldValue);if(this.DimWiseRepeatReserveQty&&this.Show==u.TagWise||null!=E&&this.TagID>0&&this.Show!=u.TagWise){let e;e=i.e.IsEmpty(o.a.SessionManager.Preferences.HoldResCancelledDocs)?"l.IsQtyIgnored=0":"(l.IsQtyIgnored=0 or l.Costcenterid in("+o.a.SessionManager.Preferences.HoldResCancelledDocs+"))",M="case when D.IsQtyIgnored=1 then -D.ReserveQuantity+(select case when release>D.ReserveQuantity then D.ReserveQuantity else release end from (\nSELECT isnull(sum(case when DCCXL.InvDocDetailsID is not null and "+e+" then l.UOMConvertedQty when DCCXL.InvDocDetailsID is not null THEN l.ReserveQuantity else 0 end),0) release\nFROM INV_DocDetails l WITH(NOLOCK)\nleft JOIN COM_DocCCData DCCXL WITH(NOLOCK)  ON DCCXL.InvDocDetailsID=l.InvDocDetailsID AND DCCXL.dcCCNID"+(this.TagID-5e4)+"=DCC.dcCCNID"+(this.TagID-5e4)+"\nwhere D.InvDocDetailsID=l.LinkedInvDocDetailsID and l.DocDate<=@TODATE\n) as T )\nelse 0 end"}if(M.length>0){this.ExcludeReserveQty&&(A="+"+M);let s=E.ID;this.DimWiseRepeatReserveQty&&this.Show==u.TagWise&&(s="ReserveQty"),p+="\nselect ProductID,MAX(ProductName) ProductName,MAX(ProductCode) ProductCode,TagID,sum(BalQty) BalQty,sum(abs("+s+")) "+s+"\nFROM (\nselect P.ProductID,P.ProductName,ProductCode"+T+",case when ReserveQuantity=0 then ISNULL(D.UOMConvertedQty*D.VoucherType,0) else 0 end"+A+" BalQty,"+M+" "+s+"\nFROM INV_DocDetails D WITH(NOLOCK)"+n+"\nINNER JOIN INV_Product P WITH(NOLOCK) ON P.ProductID=D.ProductID\n"+_+e+"\nWHERE D.ProductID=P.ProductID AND (D.VoucherType=1 OR D.VoucherType=-1)",p+=" AND (D.IsQtyIgnored=0 or (D.ReserveQuantity>0 and D.IsQtyIgnored=1 and D.VoucherType=-1  and D.DocumentType in (7,9,11,12,24)))",p+=" AND D.DocDate<=@TODATE"+r+D+C,p+=" AND P.ProductTypeId<>6 AND P.ProductTypeId!=10",t.length>0&&(p+=" AND "+t),p+=") AS T\nGROUP BY ProductID,TagID",this.HideEmptyDimensions&&this.Show==u.TagWise&&(p+=" having sum(BalQty)!=0 or sum("+s+")!=0"),m.length>0&&(m=",TagID",p+=this.ProductGroupFirst?" Order BY ProductID"+m:" Order BY "+m.Trim(",")+",ProductID")}else{var P=this.ViewModel.BaseReportColumns.find(e=>148==e.CDGDO.FieldValue);null!=P&&(I=",STUFF(\n(select ', '+B.BatchNumber+'-'+convert(nvarchar,sum(D.Quantity*D.VoucherType))\nfrom INV_DocDetails D with(nolock)"+n+"\ninner join INV_Batches B with(nolock) on B.BatchID=D.BatchID \nwhere D.ProductID=P.ProductID and D.IsQtyIgnored=0 and D.BatchID>1 and D.DocDate<=@TODATE"+r+D+C+"\ngroup by B.BatchNumber \nhaving sum(Quantity*VoucherType)>0\nFOR XML PATH('')\n)\n,1,2,'') as ["+P.ID+"]");var O=this.ViewModel.BaseReportColumns.find(e=>181==e.CDGDO.FieldValue);if(null!=O){let e="Code"==O.CDGDO.Column?"Code":"Name";R=",STUFF(\n(select ', '+B."+e,"2"!=O.FormulaEvaluateAtEnd.SelectedValue&&(R+="+'-'+convert(nvarchar,sum(BD.Quantity*D.VoucherType))"),R+=" \nfrom INV_DocDetails D with(nolock)"+n+"\ninner join INV_BinDetails BD with(nolock) on BD.InvDocDetailsID=D.InvDocDetailsID \ninner join "+O.CDGDO.ParentCostCenterSysName+" B with(nolock) ON B.NodeID=BD.BinID\nwhere D.ProductID=P.ProductID and D.IsQtyIgnored=0 and D.DocDate<=@TODATE"+r+D+C,_.length>0&&this.Show!=u.TagWise&&(R+=" and DCC.DCCCNID"+(this.TagID-5e4)+"=T.NodeID"),R+=" group by B."+e+" \nhaving sum(BD.Quantity*D.VoucherType)>0\nFOR XML PATH('')\n)\n,1,2,'') as ["+O.ID+"]"}var y=this.ViewModel.BaseReportColumns.find(e=>204==e.CDGDO.FieldValue);if(null!=y&&(S=",STUFF(\n(\nselect ', '+[SerialNumber] from INV_SerialStockProduct a with(nolock)\njoin INV_DocDetails d with(nolock) on a.InvDocDetailsID=d.InvDocDetailsID"+n+"\nwhere a.productid=P.ProductID and D.IsQtyIgnored=0 and D.DocDate<=@TODATE"+r+D+C,_.length>0&&(S+=" and DCC.DCCCNID"+(this.TagID-5e4)+"=T.NodeID"),S+="\ngroup by [SerialNumber]\nhaving sum(voucherType)>0\nFOR XML PATH('')\n)\n,1,2,'') as ["+y.ID+"]"),this.DimWiseRepeatHoldQty){let e=w.ID;this.Show==u.TagWise&&(e="HoldQty"),g=",(select isnull(sum(HoldQuantity-rel),0)  Qty\nfrom (\nselect HoldQuantity,case when release>HoldQuantity then HoldQuantity else release end rel from \n(\n    SELECT DX.HoldQuantity\n       ,isnull((select sum(case when l.IsQtyIgnored=0 then l.UOMConvertedQty else l.ReserveQuantity end) from INV_DocDetails l WITH(NOLOCK) where DX.InvDocDetailsID=l.LinkedInvDocDetailsID ),0) release\n    FROM INV_DocDetails DX WITH(NOLOCK)\n    left join COM_DocCCDATA dccX  WITH(NOLOCK) on DX.InvDocDetailsID=dccX.InvDocDetailsID \n    WHERE DX.ProductID=P.ProductID and dccX.DCCCNID"+(this.TagID-5e4)+"=T.NodeID and DX.IsQtyIgnored=1"+h+" and DX.DocumentType in (7,9,11,12,24) and DX.VoucherType=-1  \n) as t\n)as temp) "+e}if(this.ExcludeReserveQty){let e;e=i.e.IsEmpty(o.a.SessionManager.Preferences.HoldResCancelledDocs)?"l.IsQtyIgnored=0":"(l.IsQtyIgnored=0 or l.Costcenterid in("+o.a.SessionManager.Preferences.HoldResCancelledDocs+"))",A=this.TagID>5e4?"-(select isnull(sum(HoldQuantity-rel),0) from (select HoldQuantity,case when release>HoldQuantity then HoldQuantity else release end rel from\n    (SELECT DX.ReserveQuantity HoldQuantity\n,isnull((select sum(case when "+e+" then l.UOMConvertedQty else l.ReserveQuantity end) from INV_DocDetails l WITH(NOLOCK) where DX.InvDocDetailsID=l.LinkedInvDocDetailsID and l.DocDate<=@TODATE),0) release\nFROM INV_DocDetails DX WITH(NOLOCK) INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=DX.InvDocDetailsID\nWHERE DX.ProductID=P.ProductID and DCC.DCCCNID"+(this.TagID-5e4)+"=T.NodeID and DX.DocDate<=@TODATE AND DX.IsQtyIgnored=1"+h+" and DX.DocumentType in (7,9,11,12,24) and DX.VoucherType=-1  \n) as t)as temp)":"-(select isnull(sum(HoldQuantity-rel),0) from (select HoldQuantity,case when release>HoldQuantity then HoldQuantity else release end rel from\n    (SELECT DX.ReserveQuantity HoldQuantity\n,isnull((select sum(case when "+e+" then l.UOMConvertedQty else l.ReserveQuantity end) from INV_DocDetails l WITH(NOLOCK) where DX.InvDocDetailsID=l.LinkedInvDocDetailsID and l.DocDate<=@TODATE),0) release\nFROM INV_DocDetails DX WITH(NOLOCK)\nWHERE DX.ProductID=P.ProductID and DX.DocDate<=@TODATE AND DX.IsQtyIgnored=1"+h+"  and DX.DocumentType in (7,9,11,12,24) and DX.VoucherType=-1  \n) as t)as temp)"}p+="\nselect P.ProductID,MAX(P.ProductName) ProductName,MAX(ProductCode) ProductCode"+T+",ISNULL(SUM(D.UOMConvertedQty*D.VoucherType),0)"+A+" BalQty"+M+g+I+R+S+"\nFROM INV_DocDetails D WITH(NOLOCK)"+n+"\nINNER JOIN INV_Product P WITH(NOLOCK) ON P.ProductID=D.ProductID\n"+_+e+"\nWHERE D.ProductID=P.ProductID AND D.IsQtyIgnored=0 AND (D.VoucherType=1 OR D.VoucherType=-1)",p+=" AND D.DocDate<=@TODATE"+r+D+C,p+=" AND P.ProductTypeId<>6 AND P.ProductTypeId!=10",t.length>0&&(p+=" AND "+t),p+=" GROUP BY P.ProductID"+m,this.HideEmptyDimensions&&this.Show==u.TagWise&&(p+=" having ISNULL(SUM(D.UOMConvertedQty*D.VoucherType),0)!=0"),m.length>0&&(p+=this.ProductGroupFirst?" Order BY P.ProductID"+m:" Order BY "+m.Trim(",")+",P.ProductID")}return o.a.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,p)}GetUsedProductsQuery(){let e="",t="";return this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(t=" AND DCC.dcCCNID"+(this.ViewModel.oReportDialog.Locations.DBColumnID-5e4),i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?t+="=-1":this.ViewModel.oReportDialog.LocationWhere.Contains(",")?t+=" IN ("+this.ViewModel.oReportDialog.LocationWhere+")":t+="="+this.ViewModel.oReportDialog.LocationWhere),t+=this.GetDimensionFilterForStock("DCC.dcCCNID"),e+="SELECT D.ProductID FROM Inv_DocDetails D WITH(NOLOCK)",t.length>0&&(e+="inner join COM_DocCCDATA DCC with(nolock) on DCC.InvDocDetailsID=D.InvDocDetailsID"),e+=" WHERE (D.VoucherType=1 OR D.VoucherType=-1) AND D.IsQtyIgnored=0",e+=" AND D.DocDate<=convert(float,convert(datetime,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",e+=t,e+=d.GetExcludeStockTransfer(this.ViewModel),e+=" GROUP BY D.ProductID",e.toString()}GetUsedProductsByTagQuery(e,t,s){let o="";t=t.Replace("P.ProductID","D.ProductID");let l="";return this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(l=" AND DCC.dcCCNID"+(this.ViewModel.oReportDialog.Locations.DBColumnID-5e4),i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?l+="=-1":this.ViewModel.oReportDialog.LocationWhere.Contains(",")?l+=" IN ("+this.ViewModel.oReportDialog.LocationWhere+")":l+="="+this.ViewModel.oReportDialog.LocationWhere),l+=this.GetDimensionFilterForStock("DCC.dcCCNID"),o+="SELECT DCC.dcCCNID"+(this.TagID-5e4)+" NodeID,max("+s+") Name FROM Inv_DocDetails D WITH(NOLOCK)",o+=" inner join COM_DocCCDATA DCC with(nolock) on DCC.InvDocDetailsID=D.InvDocDetailsID",o+=" inner join "+d.GetTagTableName(this.TagID)+" T with(nolock) on T.NodeID=DCC.dcCCNID"+(this.TagID-5e4),o+=" inner join INV_Product P with(nolock) on P.ProductID=D.ProductID",o+=e,o+=" WHERE (D.VoucherType=1 OR D.VoucherType=-1) AND D.IsQtyIgnored=0",o+=" AND D.DocDate<=convert(float,convert(datetime,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",o+=l,t.length>0&&(o+=" AND "+t),o+=d.GetExcludeStockTransfer(this.ViewModel),o+=this.GetProductWiseLocationWhere("P",!1),o+=" GROUP BY DCC.dcCCNID"+(this.TagID-5e4),o.toString()}addRows(){let e="";for(let s=0;s<this.oColumns.length;s++)this.AggTotal[s][1]=0;this.k=0,this.lstRecQty.Clear(),this.lstRecRate.Clear(),this.dblAvgRate=0,this.OpBalanceQty=0,this.OpBalanceValue=0,this.dvOpen.length>0&&(this.OpBalanceQty=parseFloat(this.dvOpen[0].OpQty),null!=this.dvOpen[0].OpValue&&(this.OpBalanceValue=parseFloat(this.dvOpen[0].OpValue)),null!=this.dvOpen[0].AvgRate&&(this.dblAvgRate=parseFloat(this.dvOpen[0].AvgRate))),this.IsReconcile||this.ShowSLasSV||(this.GrdRow++,this.row=this.NewReportRow_2(n.f.Group,this.ViewModel.lstGroup[0].GroupAppearance),this.ViewModel.lstGroup[0].Height>0&&(this.row.Height=this.ViewModel.lstGroup[0].Height),this.row.LevelNo=0,this.ViewModel.FormulasCalculated||i.e.IsEmpty(this.ViewModel.lstGroup[0].Formula)||(this.ViewModel.CalculateFormula_2(this.ViewModel.lstGroup[0],this.drMain),this.strProductName=this.drMain[this.ViewModel.lstGroup[0].ID].toString()),this.row.Cells[0].Text=this.strProductName,this.row.Cells[0].ColSpan=this.ViewModel.ColumnSource.length,this.ViewModel.addRow(this.row),this.GroupRowIndex=this.ViewModel.Data.length-1),0!=this.OpBalanceQty&&(this.GrdRow++,this.row=this.NewReportRow_2(n.f.BalanceBF,this.BalanceBFAppearance_Data),this.row.LevelNo=1,this.row.Cells[0].ColSpan=this.colSpanBF,this.row.Cells[0].Text=o.a.GetResource("Reports_BalanceBF"),this.row.Cells[0].CellAppearance.Alignment="Left",-1!=this.colBalanceQtyIndex&&(this.IsReconcile||(this.AggTotal[this.colBalanceQtyIndex][1]=this.OpBalanceQty),this.ViewModel.SetCellValue(this.OpBalanceQty,this.oColumns[this.colBalanceQtyIndex].DataFormat,"FLOAT",this.row.Cells[this.colBalanceQtyIndex])),null!=this.dvOpen[0].AvgRate&&(this.dblAvgRate=parseFloat(this.dvOpen[0].AvgRate)),-1!=this.colBalanceRateIndex&&(this.AggTotal[this.colBalanceRateIndex][1]=this.dblAvgRate,this.ViewModel.SetCellValue(this.dblAvgRate,this.oColumns[this.colBalanceRateIndex].DataFormat,"FLOAT",this.row.Cells[this.colBalanceRateIndex])),-1!=this.colBalanceValueIndex&&(this.IsReconcile||(this.AggTotal[this.colBalanceValueIndex][1]=this.OpBalanceValue),this.ViewModel.SetCellValue(this.OpBalanceValue,this.oColumns[this.colBalanceValueIndex].DataFormat,"FLOAT",this.row.Cells[this.colBalanceValueIndex])),this.IsMultipleUnits&&(this.MultipleUnitType==D.Max?this.ViewModel.SetCellValue(this.OpBalanceQty/this.dblMaxConv,this.oColumns[this.colBalanceQtyIndex].DataFormat,"FLOAT",this.row.Cells[this.colBalanceQtyIndex+1]):this.MultipleUnitType==D.Min?this.ViewModel.SetCellValue(this.OpBalanceQty/this.dblMinConv,this.oColumns[this.colBalanceQtyIndex].DataFormat,"FLOAT",this.row.Cells[this.colBalanceQtyIndex+1]):this.OpBalanceQty>=0?(this.ViewModel.SetCellValue(Math.floor(this.OpBalanceQty/this.dblMaxConv),this.oColumns[this.colBalanceQtyIndex].DataFormat,"FLOAT",this.row.Cells[this.colBalanceQtyIndex+1]),this.ViewModel.SetCellValue(Math.floor(this.OpBalanceQty%this.dblMaxConv/this.dblMinConv),this.oColumns[this.colBalanceQtyIndex].DataFormat,"FLOAT",this.row.Cells[this.colBalanceQtyIndex+(this.ShowMultipleUnitNames?3:2)])):(this.ViewModel.SetCellValue(Math.ceil(this.OpBalanceQty/this.dblMaxConv),this.oColumns[this.colBalanceQtyIndex].DataFormat,"FLOAT",this.row.Cells[this.colBalanceQtyIndex+1]),this.ViewModel.SetCellValue(Math.ceil(this.OpBalanceQty%this.dblMaxConv/this.dblMinConv),this.oColumns[this.colBalanceQtyIndex].DataFormat,"FLOAT",this.row.Cells[this.colBalanceQtyIndex+(this.ShowMultipleUnitNames?3:2)]))),this.IsReconcile||this.ShowSLasSV||this.ViewModel.addRow(this.row),1!=this.ValuationID&&2!=this.ValuationID||this.dvOpenTrans.forEach(e=>{this.lstRecQty.InsertAt(0,parseFloat(e.Qty)),this.lstRecRate.InsertAt(0,parseFloat(e.Rate))}));let t=!(!o.a.SessionManager.Preferences.ContainsKey("ShowNegativeStockInReports")||"TRUE"!=o.a.SessionManager.Preferences.ShowNegativeStockInReports.toUpperCase());if(4==this.ValuationID||5==this.ValuationID){for(this.k=this.dv.length-1;this.k>=0;this.k--)if(1==parseInt(this.dv[this.k].VoucherType)&&(this.dblQty=i.e.Double(this.dv[this.k].UOMConvertedQty),this.dblQty>0)){4==this.ValuationID?this.dblValue=parseFloat(this.dv[this.k].Gross):5==this.ValuationID&&(this.dblValue=parseFloat(this.dv[this.k].RecValue)),this.dblAvgRate=this.dblValue/this.dblQty;break}}else if(6==this.ValuationID){let t=null;this.dicPeriodicAvgRate.Clear();let s=0,o=0,l=this.dblAvgRate;for(this.dblQty=this.OpBalanceQty,s=this.OpBalanceValue,this.k=0;this.k<this.dv.length;this.k++)e=new Date(this.dv[this.k].DocDate).ToString("MMMyyyy"),t!=e&&(this.k>0&&(this.dblQty>0?(l=(s+this.dblValue)/this.dblQty,this.dicPeriodicAvgRate.push(t,l)):this.dicPeriodicAvgRate.push(t,l),this.dblQty=this.dblQty-o,s=this.dblQty*this.dicPeriodicAvgRate[t]),t=e,o=0,this.dblValue=0),i.e.String(this.dv[this.k].RecQty).length>0?6!=parseInt(this.dv[this.k].DocumentType)&&39!=parseInt(this.dv[this.k].DocumentType)&&(this.dblQty+=parseFloat(this.dv[this.k].UOMConvertedQty),this.dblValue+=parseFloat(this.dv[this.k].RecValue)):o+=parseFloat(this.dv[this.k].UOMConvertedQty);this.dv.length>0&&this.dicPeriodicAvgRate.push(t,this.dblQty>0?(s+this.dblValue)/this.dblQty:l)}for(this.k=0;this.k<this.dv.length;this.k++){if(this.GrdRow++,this.row=this.NewReportRow(),this.row.DataRow=this.dv[this.k],this.row.LevelNo=0,this.dblQty=i.e.Double(this.dv[this.k].UOMConvertedQty),i.e.String(this.dv[this.k].RecQty).length>0)this.dblValue=parseFloat(this.dv[this.k].RecValue),this.dblUOMRate=this.dblValue/this.dblQty,this.OpBalanceQty<0?(this.OpBalanceQty=this.dblQty+this.OpBalanceQty,Math.abs(this.OpBalanceQty)<1e-8&&(this.OpBalanceQty=0),t||(this.dblQty=this.OpBalanceQty>0?this.OpBalanceQty:0)):this.OpBalanceQty+=this.dblQty,4==this.ValuationID||5==this.ValuationID?this.dblUOMRate=this.dblAvgRate:6==this.ValuationID&&(e=new Date(this.dv[this.k].DocDate).ToString("MMMyyyy"),this.dblUOMRate=this.dblAvgRate=this.dicPeriodicAvgRate[e]),this.dblQty>0&&(6!=parseInt(this.dv[this.k].DocumentType)&&39!=parseInt(this.dv[this.k].DocumentType)||(7==this.ValuationID?this.dblAvgRate=this.dblUOMRate:this.dblUOMRate=this.dblAvgRate,this.dv[this.k].COGS=this.dblQty*this.dblAvgRate),t||this.OpBalanceValue<0&&(this.OpBalanceValue=0),this.OpBalanceValue+=this.dblQty*this.dblUOMRate),4!=this.ValuationID&&5!=this.ValuationID&&6!=this.ValuationID&&(t?0!=this.OpBalanceQty&&(this.dblAvgRate=this.OpBalanceValue/this.OpBalanceQty):this.OpBalanceQty>0?this.dblAvgRate=this.OpBalanceValue/this.OpBalanceQty:(this.dblAvgRate=0,this.OpBalanceValue=0)),this.dblQty>0&&(1==this.ValuationID?(this.lstRecQty.InsertAt(0,this.dblQty),this.lstRecRate.InsertAt(0,this.dblUOMRate)):2==this.ValuationID&&(this.lstRecQty.push(this.dblQty),this.lstRecRate.push(this.dblUOMRate)));else if(this.OpBalanceQty-=this.dblQty,3==this.ValuationID||4==this.ValuationID||5==this.ValuationID)this.OpBalanceValue=this.dblAvgRate*this.OpBalanceQty,this.dv[this.k].COGS=this.dblQty*this.dblAvgRate;else if(6==this.ValuationID)e=new Date(this.dv[this.k].DocDate).ToString("MMMyyyy"),this.dblUOMRate=this.dblAvgRate=this.dicPeriodicAvgRate[e],this.OpBalanceValue=this.dblAvgRate*this.OpBalanceQty,this.dv[this.k].COGS=this.dblQty*this.dblAvgRate;else if(7==this.ValuationID)this.OpBalanceValue=this.OpBalanceValue-parseFloat(this.dv[this.k].IssValue),this.OpBalanceValue<0&&(this.OpBalanceValue=0),0==this.OpBalanceQty?(this.dblAvgRate=0,this.OpBalanceValue=0):this.dblAvgRate=this.OpBalanceValue/this.OpBalanceQty,this.dv[this.k].COGS=this.dv[this.k].IssValue;else if(1==this.ValuationID||2==this.ValuationID){this.dblCOGS=0;for(let e=this.lstRecQty.length-1;e>=0;e--){if(this.dblQty=this.dblQty-this.lstRecQty[e],this.dblQty<0){this.dblCOGS+=(this.lstRecQty[e]+this.dblQty)*this.lstRecRate[e],this.lstRecQty[e]=-this.dblQty;break}if(this.dblCOGS+=this.lstRecQty[e]*this.lstRecRate[e],this.lstRecQty.RemoveAt(e),this.lstRecRate.RemoveAt(e),0==this.dblQty)break}this.OpBalanceValue=this.OpBalanceValue-this.dblCOGS,this.OpBalanceValue<0&&(this.OpBalanceValue=0),this.dv[this.k].COGS=this.dblCOGS}if(0==this.OpBalanceQty&&(this.OpBalanceValue=0),this.dv[this.k].BalanceQty=this.OpBalanceQty,this.dv[this.k].AvgRate=this.dblAvgRate,this.dv[this.k].BalanceValue=this.OpBalanceValue,this.IsMultipleUnits&&(this.MultipleUnitType==D.Max?this.dv[this.k].BalanceQty_Max=this.OpBalanceQty/this.dblMaxConv:this.MultipleUnitType==D.Min?this.dv[this.k].BalanceQty_Min=this.OpBalanceQty/this.dblMinConv:this.OpBalanceQty>=0?(this.dv[this.k].BalanceQty_Max=Math.floor(this.OpBalanceQty/this.dblMaxConv),this.dv[this.k].BalanceQty_Min=Math.floor(this.OpBalanceQty%this.dblMaxConv/this.dblMinConv)):(this.dv[this.k].BalanceQty_Max=Math.ceil(this.OpBalanceQty/this.dblMaxConv),this.dv[this.k].BalanceQty_Min=Math.ceil(this.OpBalanceQty%this.dblMaxConv/this.dblMinConv))),this.ShowGroupHighLowValues&&(0==this.k?(this.dblCBMin=this.dblCBMax=this.OpBalanceQty,this.dtCBMin=this.dtCBMax=new Date(this.dv[this.k].DocDate)):(this.dblCBMin>this.OpBalanceQty&&(this.dblCBMin=this.OpBalanceQty,this.dtCBMin=new Date(this.dv[this.k].DocDate)),this.dblCBMax<this.OpBalanceQty&&(this.dblCBMax=this.OpBalanceQty,this.dtCBMax=new Date(this.dv[this.k].DocDate)))),!this.IsReconcile||null!=this.dv[this.k].GLCOGS&&null!=this.dv[this.k].COGS&&Math.abs(Math.abs(parseFloat(this.dv[this.k].GLCOGS))-parseFloat(this.dv[this.k].COGS))>.01){this.rows.Clear(),this.GrdRow++,this.rows.push(new n.d(this.oColumns.length,this.ViewModel.RowHeight)),this.rows[this.rows.length-1].Type=n.f.Detail;for(let e=0;e<this.oColumns.length;e++)if(!(this.oColumns[e].DataFormat.PrintOnce&&this.k>0)){if(this.oColumns[e].Row>0&&this.rows.length-1<this.oColumns[e].Row){for(let t=0;t<=this.oColumns[e].Row;t++)this.rows.length-1<t&&(this.GrdRow++,this.rows.push(new n.d(this.oColumns.length,this.ViewModel.SubRowHeight)),this.rows[this.rows.length-1].Type=n.f.Detail);this.Row=this.oColumns[e].Row,this.Col=this.oColumns[e].Column}else this.Row=0,this.Col=e;this.CellValue="",this.CellValue=""!=this.oColumns[e].Formula?this.ViewModel.CalculateFormula_1(this.oColumns[e].Formula,this.dv[this.k],this.rows):i.e.String(this.dv[this.k][this.oColumns[e].ID]),""!=this.CellValue&&((this.IsReconcile||!this.oColumns[e].ID.startsWith("Balance"))&&this.ViewModel.TotalCols.Contains(this.oColumns[e].ID)&&i.e.IsNum(this.CellValue)&&(this.dbl=i.e.Double(this.CellValue),this.AggTotal[e][1]+=this.dbl),this.oColumns[e].DataFormat.CumTotal>-1&&(this.CellValue=this.AggTotal[e][1].toString()),this.ViewModel.SetCellValue(this.CellValue,this.oColumns[e].DataFormat,this.oColumns[e].ColumnType,this.rows[this.Row].Cells[this.Col]))}-1!=this.ViewModel.colSNoIndex&&(this.rows[0].Cells[this.ViewModel.colSNoIndex].Value=++this.ViewModel.SNo,this.rows[0].Cells[this.ViewModel.colSNoIndex].Text=this.ViewModel.SNo.toString()),this.ViewModel.ApplyKPI(this.rows[0]);for(let e=0;e<this.rows.length;e++){let t=this.rows[e];this.ViewModel.HideEmptyRows&&!t.Cells.find(e=>!i.e.IsEmptySpace(e.Text))||(t.LevelNo=this.ViewModel.lstGroup.length,t.DataRow=this.dv[this.k],this.ShowSLasSV||this.ViewModel.addRow(t))}}}if(this.IsReconcile||(-1!=this.colBalanceQtyIndex&&(this.AggTotal[this.colBalanceQtyIndex][1]=this.OpBalanceQty),-1!=this.colBalanceValueIndex&&(this.AggTotal[this.colBalanceValueIndex][1]=this.OpBalanceValue),-1!=this.colBalanceQtyMaxIndex&&(this.AggTotal[this.colBalanceQtyMaxIndex][1]=parseFloat(this.rows[0].Cells[this.colBalanceQtyMaxIndex].Value)),-1!=this.colBalanceQtyMinIndex&&(this.AggTotal[this.colBalanceQtyMinIndex][1]=parseFloat(this.rows[0].Cells[this.colBalanceQtyMinIndex].Value))),this.ShowGroupHighLowValues&&this.dv.length>0){this.row=this.ViewModel.Data[this.GroupRowIndex];let e=this.strProductName+"   [Low: ";this.ViewModel.SetCellValue(this.dblCBMin,this.oCBFormat,"FLOAT",this.oCBCell),e+=this.oCBCell.Text,e+=" ("+this.dtCBMin.ToString(o.a.SessionManager.Preferences["Date Format"])+")",e+=",   High: ",this.ViewModel.SetCellValue(this.dblCBMax,this.oCBFormat,"FLOAT",this.oCBCell),e+=this.oCBCell.Text,e+=" ("+this.dtCBMax.ToString(o.a.SessionManager.Preferences["Date Format"])+")",e+="]",this.row.Cells[0].Text=e,this.ViewModel.Data.RemoveAt(this.GroupRowIndex),this.ViewModel.Data.Insert(this.GroupRowIndex,this.row)}return this.AddSubTotal(),0}AddSubTotal(){if(!this.IsReconcile&&this.colSubTotalStartIndex>=0){for(this.GrdRow++,this.row=this.NewReportRow_2(n.f.SubTotal,this.ViewModel.lstGroup[0].SubTotalAppearance_Data),this.row.LevelNo=this.ViewModel.lstGroup.length,this.row.Cells[0].CellAppearance=this.ViewModel.lstGroup[0].SubTotalAppearance,this.row.Cells[0].Text=this.ShowSLasSV?this.strProductName:o.a.GetResource("Reports_SubTotal"),this.row.Cells[0].ColSpan=this.colSubTotalStartIndex,this.k=0;this.k<this.oColumns.length;this.k++)this.ViewModel.lstGroup[0].TotalCols.ContainsKey(this.oColumns[this.k].ID)&&this.ViewModel.SetCellValue(this.AggTotal[this.k][1],this.oColumns[this.k].DataFormat,"FLOAT",this.row.Cells[this.k]);this.ViewModel.addRow(this.row)}for(let e=0;e<this.AggTotal.length;e++)this.AggTotal[e][0]+=this.AggTotal[e][1],this.AggTotal[e][1]=0}AddReportTotal(){this.GrdRow++,this.row=this.NewReportRow_2(n.f.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance_Data);let e=-1;for(this.k=0;this.k<this.oColumns.length;this.k++)this.ViewModel.GrpReportTotal.TotalCols.ContainsKey(this.oColumns[this.k].ID)&&(-1==e&&(e=this.k),this.ViewModel.SetCellValue(this.AggTotal[this.k][0],this.oColumns[this.k].DataFormat,"FLOAT",this.row.Cells[this.k]));this.row.Cells[0].CellAppearance=this.ViewModel.GrpReportTotal.SubTotalAppearance,this.row.Cells[0].Text=o.a.GetResource("Reports_ReportTotal"),e>0&&(this.GrdRow++,this.row.Cells[0].ColSpan=e,this.ViewModel.addRow(this.row))}Reconcile(){let e=[],t=new Array;this.ViewModel.Data.forEach(s=>{null!=s.DataRow&&i.e.IsNum(s.DataRow.DocID)&&(t.Contains(parseInt(s.DataRow.DocID))||(t.push(parseInt(s.DataRow.DocID)),e.push({CostCenterID:parseInt(s.DataRow.CostCenterID),DocID:parseInt(s.DataRow.DocID)})))})}addStockMovement(){if(this.oRow=this.NewReportRow(),this.oRow.NodeID=parseInt(this.strProductID),this.oRow.DataRow=this.drMain,this.ShowLevelTree&&(this.oRow.LevelNo=parseInt(this.drMain.Depth)-1,this.oRow.Cells[1].level=this.oRow.LevelNo+1,this.oRow.Cells[1].IsNormal=!1,this.UpdateTreeTotals(this.oRow.LevelNo),this.RemoveGroups(this.oRow.LevelNo),Object(l.j)(this.drMain.IsGroup))){this.lstParents.push(this.oRow);let e=new Array(this.oColumns.length);e.fill(0),this.lstTotal.push(e),this.oRow.Type=n.f.BalanceBF,this.oRow.IsGroup=!0;for(let t=0;t<this.oRow.Cells.length;t++)this.oRow.Cells[t].IsNormal=!1,this.oRow.Cells[t].CellAppearance=this.BalanceBFAppearance_Data.Clone(),this.oRow.Cells[t].CellAppearance.Alignment=this.oColumns[t].DataAppearance.Alignment}if(this.Show!=u.None&&!this.oRow.IsGroup){let e=0,t=0,s=0,o=0,l=this.dv[0].TagID.toString();if(this.Show==u.MonthWise||this.Show==u.YearWise)for(this.k=2;this.k<this.dv.length;)null==this.dv[this.k].BalQty&&null!=this.dv[this.k-1].BalQty&&(this.dv[this.k].BalQty=this.dv[this.k-1].BalQty,this.dv[this.k].AvgRate=this.dv[this.k-1].AvgRate,this.dv[this.k].BalValue=this.dv[this.k-1].BalValue),2==this.k&&"0"==i.e.String(this.dv[this.k-1].TagID)?this.dvTable.Remove(this.dv[this.k-1]):this.k++;for(this.k=-1;this.k+1<this.dv.length;)l=i.e.String(this.dv[this.k+1].TagID),l.length>0&&(e=i.e.Double(this.dv[this.k+1].BalQty),this.DimWiseRepeatQty&&(this.dv[0]["RecQty"+l]=i.e.String(this.dv[this.k+1].RecQty),this.dv[0]["IssQty"+l]=i.e.String(this.dv[this.k+1].IssQty),this.dv[0]["BalQty"+l]=e),o+=e,this.DimWiseRepeatRate&&(t=i.e.Double(this.dv[this.k+1].AvgRate),this.dv[0]["AvgRate"+l]=t),this.DimWiseRepeatValue&&(this.dv[0]["RecValue"+l]=i.e.String(this.dv[this.k+1].RecValue),this.dv[0]["IssValue"+l]=i.e.String(this.dv[this.k+1].IssValue),s=i.e.Double(this.dv[this.k+1].BalValue),this.dv[0]["BalValue"+l]=s)),-1==this.k?this.k=0:this.dvTable.Remove(this.dv[this.k+1]);16==this.ViewModel.StaticReportType&&this.dv.length>0&&(this.dv[0].BalQty=o)}this.IsMultipleUnits&&this.dv.length>0&&(this.dblQty=parseFloat(this.dv[0].BalQty),this.MultipleUnitType==D.Max?this.dv[this.k].BalQty_Max=this.dblQty/this.dblMaxConv:this.MultipleUnitType==D.Min?this.dv[this.k].BalQty_Min=this.dblQty/this.dblMinConv:this.dblQty>=0?(this.dv[this.k].BalQty_Max=Math.floor(this.dblQty/this.dblMaxConv),this.dv[this.k].BalQty_Min=Math.floor(this.dblQty%this.dblMaxConv/this.dblMinConv)):(this.dv[this.k].BalQty_Max=Math.ceil(this.dblQty/this.dblMaxConv),this.dv[this.k].BalQty_Min=Math.ceil(this.dblQty%this.dblMaxConv/this.dblMinConv)));for(let e=0;e<this.oColumns.length;e++){if(this.CellValue="",""!=this.oColumns[e].Formula?(this.CellValue=this.ViewModel.CalculateFormula_1(this.oColumns[e].Formula,this.drRecord,this.rows),this.drRecord[this.oColumns[e].ID]=this.CellValue):this.CellValue=i.e.String(this.drRecord[this.oColumns[e].ID]),!i.e.IsEmpty(this.oColumns[e].ColumnFilterExpression)&&"0"==this.ViewModel.CalculateFormula_1(this.oColumns[e].ColumnFilterExpression,this.drRecord,this.rows).toString())return;""!=this.CellValue&&(this.ViewModel.SetCellValue(this.CellValue,this.oColumns[e].DataFormat,this.oColumns[e].ColumnType,this.oRow.Cells[e]),"Balance"!=this.oColumns[e].ID&&this.ViewModel.TotalCols.Contains(this.oColumns[e].ID)&&i.e.IsNum(this.CellValue)&&(this.dbl=i.e.Double(this.CellValue),this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][e]+=this.dbl)))}if(this.oRow.LevelNo<=this.LevelNo)if(this.GrdRow++,this.lstParents.length>1&&(this.oRow.IsExpanded=!0,this.oRow.IsGroup?this.lstParents.length>2&&(this.oRow.Parent=this.lstParents[this.lstParents.length-2]):this.oRow.Parent=this.lstParents[this.lstParents.length-1]),this.ShowCollapse&&(0==this.oRow.LevelNo&&(this.oRow.IsExpanded=!1),null==this.oRow.Parent||this.oRow.Parent.IsExpanded&&this.oRow.Parent.Visible||(this.oRow.IsExpanded=!1,this.oRow.Visible=!1)),-1==this.ViewModel.colSNoIndex||this.oRow.IsGroup||(this.oRow.Cells[this.ViewModel.colSNoIndex].Value=++this.ViewModel.SNo,this.oRow.Cells[this.ViewModel.colSNoIndex].Text=this.ViewModel.SNo.toString()),this.oRow.IsGroup||this.ViewModel.ApplyKPI(this.oRow),this.oRow.IsGroup||50!=this.LevelNo)this.ViewModel.addRow(this.oRow);else if(this.oRow.Visible=!1,this.ViewModel.addRow(this.oRow),null!=this.oRow.Parent&&this.oRow.Parent.Type!=n.f.Detail){for(let e=0;e<this.oRow.Parent.Cells.length;e++)this.oRow.Parent.Cells[e].CellAppearance=this.oColumns[e].DataAppearance.Clone();this.oRow.Parent.Type=n.f.Detail}}UpdateTreeTotals(e){for(let t=this.lstTotal.length-1;t>e;t--){if(t>0)for(let e=0;e<this.lstTotal[t].length;e++)this.lstTotal[t-1][e]+=this.lstTotal[t][e];for(let e=0;e<this.oColumns.length;e++)"FLOAT"==this.oColumns[e].ColumnType&&e!=this.ViewModel.colSNoIndex&&this.ViewModel.SetCellValue(this.lstTotal[t][e],this.oColumns[e].DataFormat,"FLOAT",this.lstParents[t].Cells[e]);e<=this.LevelNo&&this.RefreshRow(this.lstParents[t]),this.lstParents.RemoveAt(t),this.lstTotal.RemoveAt(t)}}RefreshRow(e){let t=this.ViewModel.Data.indexOf(e);t>=0&&(this.ViewModel.Data.Remove(e),this.ViewModel.Data.Insert(t,e))}RemoveGroups(e){let t=!1;if(t=-1==e||Object(l.j)(this.drMain.IsGroup),t){if(this.GrdRow>-1&&this.ViewModel.Data[this.GrdRow].Level>=e)for(let t=this.ViewModel.Data[this.GrdRow].Level;t>=e&&this.ViewModel.Data[this.GrdRow].Type==n.f.BalanceBF;t--){for(let e=0;e<this.oColumns.length;e++)if("FLOAT"==this.oColumns[e].ColumnType&&!i.e.IsEmpty(this.ViewModel.Data[this.GrdRow].Cells[e].Text)&&0!=parseFloat(this.ViewModel.Data[this.GrdRow].Cells[e].Text))return;if(this.ViewModel.Data.RemoveAt(this.GrdRow),this.GrdRow--,-1==this.GrdRow)break}}else for(;this.GrdRow>=0&&this.ViewModel.Data[this.GrdRow].Type==n.f.BalanceBF&&this.ViewModel.Data[this.GrdRow].Level>=e;){for(let e=0;e<this.oColumns.length;e++)if("FLOAT"==this.oColumns[e].ColumnType&&!i.e.IsEmpty(this.ViewModel.Data[this.GrdRow].Cells[e].Text)&&0!=parseFloat(this.ViewModel.Data[this.GrdRow].Cells[e].Text))return;this.ViewModel.Data.RemoveAt(this.GrdRow),this.GrdRow--}}AddReportTotal_StockMovement(){this.UpdateTreeTotals(0),this.RemoveGroups(-1),this.row=this.NewReportRow_2(n.f.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance_Data),this.row.LevelNo=0;let e=-1;for(this.k=0;this.k<this.oColumns.length;this.k++)this.ViewModel.GrpReportTotal.TotalCols.ContainsKey(this.oColumns[this.k].ID)&&(-1==e&&(e=this.k),this.ViewModel.SetCellValue(this.lstTotal[0][this.k],this.oColumns[this.k].DataFormat,"FLOAT",this.row.Cells[this.k]));this.row.Cells[0].Text=o.a.GetResource("Reports_ReportTotal"),this.row.Cells[0].CellAppearance.Alignment="Left",e>0&&(this.GrdRow++,this.row.Cells[0].ColSpan=e,this.ViewModel.addRow(this.row))}addStockList(e){if(this.oRow=this.NewReportRow(),this.oRow.NodeID=parseInt(this.strProductID),this.oRow.DataRow=this.drMain,this.ShowLevelTree&&(this.oRow.LevelNo=parseInt(this.drMain.Depth)-1,this.oRow.Cells[1].level=this.oRow.LevelNo+1,this.oRow.Cells[1].IsNormal=!1,this.UpdateTreeTotals(this.oRow.LevelNo),this.RemoveGroups(this.oRow.LevelNo),Object(l.j)(this.drMain.IsGroup))){this.lstParents.push(this.oRow),this.lstTotal.push(new Array(this.oColumns.length).fill(0)),this.oRow.Type=n.f.BalanceBF,this.oRow.IsGroup=!0;for(let e=0;e<this.oRow.Cells.length;e++)this.oRow.Cells[e].IsNormal=!1,this.oRow.Cells[e].CellAppearance=this.BalanceBFAppearance_Data.Clone(),this.oRow.Cells[e].CellAppearance.Alignment=this.oColumns[e].DataAppearance.Alignment}if(this.Show==u.TagWise&&!this.oRow.IsGroup){let t,s,o,l,a=i.e.String(this.drr[0].TagID);for(t=s=o=l=0,this.k=0;this.k<this.drr.length;this.k++)a=i.e.String(this.drr[this.k].TagID),a.length>0&&(t=i.e.Double(this.drr[this.k].BalQty),this.drr[0]["BalQty"+a]=t,l+=t,this.DimWiseRepeatReserveQty&&(t=i.e.Double(this.drr[this.k].ReserveQty),this.drr[0]["ReserveQty"+a]=t),this.DimWiseRepeatHoldQty&&(t=i.e.Double(this.drr[this.k].HoldQty),this.drr[0]["HoldQty"+a]=t)),this.k>0&&this.dsSource.Tables[0].Remove(this.drr[this.k]);e||this.drr.length>0&&(this.drr[0].BalQty=l)}for(let t=0;t<this.oColumns.length;t++){if(this.CellValue="",this.CellValue=""!=this.oColumns[t].Formula?this.ViewModel.CalculateFormula_1(this.oColumns[t].Formula,this.drRecord,this.rows):i.e.String(this.drRecord[this.oColumns[t].ID]),!i.e.IsEmpty(this.oColumns[t].ColumnFilterExpression)&&"0"==this.ViewModel.CalculateFormula_1(this.oColumns[t].ColumnFilterExpression,this.drRecord,this.rows).toString())return;""!=this.CellValue&&(this.ViewModel.SetCellValue(this.CellValue,this.oColumns[t].DataFormat,this.oColumns[t].ColumnType,this.oRow.Cells[t]),"Balance"!=this.oColumns[t].ID&&this.ViewModel.TotalCols.Contains(this.oColumns[t].ID)&&i.e.IsNum(this.CellValue)&&(this.dbl=i.e.Double(this.CellValue),this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][t]+=this.dbl)))}if(this.oRow.LevelNo<=this.LevelNo)if(this.GrdRow++,this.lstParents.length>1&&(this.oRow.IsExpanded=!0,this.oRow.IsGroup?this.lstParents.length>2&&(this.oRow.Parent=this.lstParents[this.lstParents.length-2]):this.oRow.Parent=this.lstParents[this.lstParents.length-1]),this.ShowCollapse&&(0==this.oRow.LevelNo&&(this.oRow.IsExpanded=!1),null==this.oRow.Parent||this.oRow.Parent.IsExpanded&&this.oRow.Parent.Visible||(this.oRow.IsExpanded=!1,this.oRow.Visible=!1)),-1==this.ViewModel.colSNoIndex||this.oRow.IsGroup||(this.oRow.Cells[this.ViewModel.colSNoIndex].Value=++this.ViewModel.SNo,this.oRow.Cells[this.ViewModel.colSNoIndex].Text=this.ViewModel.SNo.toString()),this.oRow.IsGroup||this.ViewModel.ApplyKPI(this.oRow),this.oRow.IsGroup||50!=this.LevelNo)this.ViewModel.addRow(this.oRow);else if(this.oRow.Visible=!1,this.ViewModel.addRow(this.oRow),null!=this.oRow.Parent&&this.oRow.Parent.Type!=n.f.Detail){for(let e=0;e<this.oRow.Parent.Cells.length;e++)this.oRow.Parent.Cells[e].CellAppearance=this.oColumns[e].DataAppearance.Clone();this.oRow.Parent.Type=n.f.Detail}}RenderData(e){for(;this.R<e.length;this.R++){if(this.dblBalQty=this.GetAbsoluteQty(e[this.R].BalQty),0==this.dblBalQty){if(!this.Display_Zero)continue}else if(this.dblBalQty>=0){if(!this.Display_Positive)continue}else if(!this.Display_Negative)continue;if(0!=i.e.String(e[this.R].TagID).length&&(this.drr0=this.dsMain.Tables[0].filter(t=>t.ProductID==e[this.R].ProductID),0!=this.drr0.length)){this.drr1=this.dsMain.Tables[1].filter(t=>t.NodeID==e[this.R].TagID),this.ProductGroupFirst?(e[this.R][this.ViewModel.ReportGroups[0].ID]="ProductCode"==this.ViewModel.ReportGroups[0].CDGDO.Column?this.drr0[0].ProductCode.toString():this.drr0[0].ProductName.toString(),this.drr1.length>0&&(e[this.R][this.ViewModel.ReportGroups[1].ID]=i.e.String(this.drr1[0].Name))):(e[this.R][this.ViewModel.ReportGroups[1].ID]="ProductCode"==this.ViewModel.ReportGroups[1].CDGDO.Column?this.drr0[0].ProductCode.toString():this.drr0[0].ProductName.toString(),this.drr1.length>0&&(e[this.R][this.ViewModel.ReportGroups[0].ID]=i.e.String(this.drr1[0].Name))),this.IsMultipleUnits&&(this.dblMaxConv=parseFloat(this.drr0[0].MaxConv),this.dblMinConv=parseFloat(this.drr0[0].MinConv),this.MultipleUnitType==D.Max?e[this.R].BalQty_Max=this.dblBalQty/this.dblMaxConv:this.MultipleUnitType==D.Min?e[this.R].BalQty_Min=this.dblBalQty/this.dblMinConv:this.dblBalQty>=0?(e[this.R].BalQty_Max=Math.floor(this.dblBalQty/this.dblMaxConv),e[this.R].BalQty_Min=Math.floor(this.dblBalQty%this.dblMaxConv/this.dblMinConv)):(e[this.R].BalQty_Max=Math.ceil(this.dblBalQty/this.dblMaxConv),e[this.R].BalQty_Min=Math.ceil(this.dblBalQty%this.dblMaxConv/this.dblMinConv))),null!=this.dtBins&&(this.drr2=this.dsMain.Tables[2].filter(t=>t.Location==e[this.R].TagID&&t.NodeID==e[this.R].ProductID),this.drr2.length>0&&(this.drrBin=this.dtBins.filter(e=>e.NodeID==this.drr2[0].BinNodeID),this.drrBin.length>0&&(e[this.R][this.ViewModel.ReportParams.BinDimension]=this.drrBin[0].Name.toString()))),this.dsMain.Columns[0].forEach(t=>{this.ds.Columns[0].Contains(t)&&(e[this.R][t]=this.drr0[0][t])}),this.ViewModel.AddGroupRows(e,this.R),this.oRow=this.NewReportRow(),this.oRow.LevelNo=this.ViewModel.lstGroup.length,this.oRow.DataRow=e[this.R];for(let t=0;t<this.oColumns.length;t++)this.CellValue="",""!=this.oColumns[t].Formula?this.CellValue=this.ViewModel.CalculateFormula_1(this.oColumns[t].Formula,e[this.R],this.rows):i.e.IsEmpty(e[this.R][this.oColumns[t].ID])||(this.CellValue=e[this.R][this.oColumns[t].ID].toString()),""!=this.CellValue&&(this.ViewModel.SetCellValue(this.CellValue,this.oColumns[t].DataFormat,this.oColumns[t].ColumnType,this.oRow.Cells[t]),this.ViewModel.TotalCols.Contains(this.oColumns[t].ID)&&i.e.IsNum(this.CellValue)&&(this.ViewModel.totals[t][this.ViewModel.lstGroup.length]+=parseFloat(this.CellValue)));this.ViewModel.ApplyKPI(this.oRow),this.ViewModel.addRow(this.oRow)}}}GetDimensionFilterForStock(e){let t="";for(let s=0;s<this.ViewModel.oReportDialog.CostCenterFilters.length;s++){let i=this.ViewModel.oReportDialog.CostCenterFilters[s];if((i.CostCenterID!=this.ViewModel.oReportDialog.StockDimensionID||0!=i.SelectedNodes.length)&&i.CostCenterID>5e4&&(i.SelectedNodes.length>0||!i.DeleteButtonVisibility))if(i.SelectedNodes.length>0)if(1==i.SelectedNodes.length)t+=" AND ",t+=e+(i.CostCenterID-5e4)+"="+i.SelectedNodes[0].Id;else{let s=null,l="1"==o.a.SessionManager.UserID||"1"==o.a.SessionManager.RoleID;if(s=i.DeleteButtonVisibility||l?i.SelectedNodes.find(e=>2==e.Id&&e.IsGroup):null,null==s){t+=" AND ",t+=e+(i.CostCenterID-5e4)+" IN (";for(let e=0;e<i.SelectedNodes.length;e++)e>0&&(t+=","),t+=i.SelectedNodes[e].Id;t+=")"}}else i.DeleteButtonVisibility||(t+=" AND ",t+=e+(i.CostCenterID-5e4)+"=-12912")}return t.toString()}static GetExcludeStockTransfer(e){let t="";if(e.Preferences.ContainsKey("ExcludeStockTransfer")&&e.Preferences.ExcludeStockTransfer.length>0){let s=!1;if(e.oReportDialog.Locations.Visible&&!i.e.IsEmpty(e.oReportDialog.LocationWhere)&&(s=!0),e.oReportDialog.StockDimensionID>0){let t=e.oReportDialog.CostCenterFilters.find(t=>t.CostCenterID==e.oReportDialog.StockDimensionID);t&&null!=t.SelectedNodes&&t.SelectedNodes.length>0&&t.SelectedNodes.find(e=>2==e.Id)&&(s=!0)}t=s?"":" and D.CostCenterID NOT IN ("+e.Preferences.ExcludeStockTransfer+")"}let s=a.b.GetFilterByDimension_3(300,e.oReportDialog.CostCenterFilters);return i.e.IsEmpty(s)||(t+=" and D.CostCenterID IN ("+s+")"),t}}},jp4k:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var o=s("3Pt+"),i=s("fXoL");function l(e,t){if(1&e&&(i.Zb(0,"div",8),i.Wc(1,"\n            "),i.Vb(2,9),i.Wc(3,"\n        "),i.Yb()),2&e){const e=i.lc();i.Db(2),i.tc("obj",e.obj.Name)}}function a(e,t){if(1&e&&(i.Zb(0,"div",8),i.Wc(1,"\n            "),i.Vb(2,9),i.Wc(3,"\n        "),i.Yb()),2&e){const e=i.lc();i.Db(2),i.tc("obj",e.obj.List)}}function n(e,t){if(1&e&&(i.Zb(0,"div",10),i.Wc(1,"\n            "),i.Ub(2,"app-PactGridView",11),i.Wc(3,"  \n        "),i.Yb()),2&e){const e=i.lc();i.Db(2),i.tc("obj",e.obj.OpenGrid)("group",e.form)}}let r=(()=>{class e{constructor(){this.foorm=new o.j({})}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i.Nb({type:e,selectors:[["app-save-as-dialog"]],decls:26,vars:9,consts:[[1,"master-screen"],[1,"PACTHeaderFields","dialogSubBody"],["class","form-group col PACTControl",4,"ngIf"],["class","documentgrid row form-row","style","width: 100%;",4,"ngIf"],[1,"Pactdailogfooter"],[1,"primary-btn-wicon",3,"click"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-rectangle-xmark"],[1,"form-group","col","PACTControl"],["FieldDirective","",3,"obj"],[1,"documentgrid","row","form-row",2,"width","100%"],[2,"width","100%",3,"obj","group"]],template:function(e,t){1&e&&(i.Zb(0,"div",0),i.Wc(1,"\n    "),i.Zb(2,"div",1),i.Wc(3,"\n        "),i.Uc(4,l,4,1,"div",2),i.Wc(5,"\n        "),i.Uc(6,a,4,1,"div",2),i.Wc(7,"\n        "),i.Uc(8,n,4,2,"div",3),i.Wc(9,"\n  "),i.Yb(),i.Wc(10,"\n\n  "),i.Zb(11,"div",4),i.Wc(12,"\n    "),i.Zb(13,"div"),i.Wc(14,"\n        "),i.Zb(15,"button",5),i.hc("click",(function(){return t.obj.OnButtonClick("AddDeclinedJobs")})),i.Wc(16),i.mc(17,"translate"),i.Yb(),i.Wc(18,"\n        "),i.Zb(19,"button",6),i.hc("click",(function(){return t.obj.OnButtonClick("Cancel")})),i.Ub(20,"i",7),i.Wc(21),i.mc(22,"translate"),i.Yb(),i.Wc(23,"\n    "),i.Yb(),i.Wc(24,"      \n  "),i.Yb(),i.Wc(25,"\n"),i.Yb()),2&e&&(i.Db(4),i.tc("ngIf",t.obj.Name.Visible),i.Db(2),i.tc("ngIf",t.obj.List.Visible),i.Db(2),i.tc("ngIf",t.obj.GridVisibility),i.Db(8),i.Xc(i.nc(17,5,"Com_OK")),i.Db(5),i.Xc(i.nc(22,7,"Cancel")))},encapsulation:2}),e})()},l3BA:function(e,t,s){"use strict";s.d(t,"a",(function(){return u}));var o=s("Do2H"),i=s("Lp6j"),l=s("ScVY"),a=s("EQd/"),n=s("0/4Q"),r=s("8B8H"),h=s("ockk");class u extends l.b{constructor(e){super(),this.IsOkClick=!1,this.SaveAsID=0,this.DeleteButtonVisibility=!1,this.GridVisibility=!1,this.Parent=e,this.Title=o.a.GetResource("SaveAs"),this.List=new n.e(0),this.List.Label="Over write existing",this.List.LblWidth="130",this.List.Items.push(n.d.ComboBoxItems_2("","0")),this.List.SelectionChangedCommand.Subscribe(this,"OnListChange"),"ReportViewModel"==e.ClassName?(this.Name=new a.d(0),this.Name.Text=e.ScreenName,this.Name.Enable=!0,this.Name.LblWidth="130",o.a.report.GetReportData(1,e.StaticReportType,null).Tables[0].forEach(e=>{this.List.Items.push(n.d.ComboBoxItems_2(e.ReportName.toString(),e.ReportID.toString()))})):"ReOrderLevelNewViewModel"==e.ClassName&&(this.Name=new a.d(0),this.Name.Text=e.Title,this.Name.Enable=!0,this.Name.LblWidth="130","Open"==e.DialogAction?(this.GridVisibility=!0,this.Name.Visible=!1,this.List.Visible=!1,this.DeleteButtonVisibility=!0,this.Title=o.a.GetResource("CRMOpportunity_Open"),this.InitOpenGrid(e.ReportID)):o.a.report.GetReportData(4,e.ReportID,null).Tables[0].forEach(e=>{this.List.Items.push(n.d.ComboBoxItems_3(e.FileDescription.toString(),e.FileID.toString(),e.GUID.toString()))})),this.Name.Label=o.a.GetResource("AccountCreate_Name")}InitOpenGrid(e){this.OpenGrid=new r.a,this.OpenGrid.Width="",this.OpenGrid.SearchVisible=!0,this.OpenGrid.FilterVisible=!0,this.OpenGrid.SearchOptions.Width="110",this.OpenGrid.SearchText.Width="100";let t=o.a.report.GetReportData(4,e,null);t.Columns[0].push("Delete"),t.Tables[0].forEach(e=>{e.Delete="Delete"}),this.OpenGrid.Table=t.Tables[0];let s=new Array,i=new h.a;i.Header="Profile Name",i.DisplayMember="FileDescription",i.Width=220,i.ReadOnly=!0,s.push(i),i=new h.a,i.Header="Action",i.DisplayMember="Delete",i.Width=70,i.DataType="LINK",i.ReadOnly=!0,s.push(i),this.OpenGrid.Columns=s,this.OpenGrid.SearchCols.SelectedValue="FileDescription",this.OpenGrid.SearchCols.Visible=!1,this.OpenGrid.OnLinkClick.Subscribe(this,"OnOpenGridLinkClick")}OnOpenGridLinkClick(e,t,s){confirm("Do you really want to Delete?")&&(o.a.report.GetReportData(6,parseInt(e.FileID),null),this.DisplayMessage="Deleted Successfully",this.OpenGrid.removeRow(e))}OnButtonClick(e){var t;if("Cancel"==e.toString())o.a.page.HideDialog();else if("Delete"==e.toString())null!=this.List.SelectedValue&&parseInt(this.List.SelectedValue);else try{if(this.IsOkClick=!0,"ReOrderLevelNewViewModel"==this.Parent.ClassName){if(null!=this.OpenGrid){if(null==this.OpenGrid.SelectedItem)return void(this.DisplayMessage="Please select profile");this.SaveAsID=parseInt(this.OpenGrid.SelectedItem.FileID),this.Name.Text=this.OpenGrid.SelectedItem.FileDescription.toString()}else if(null!=this.List.SelectedValue&&parseInt(this.List.SelectedValue)>0)this.SaveAsID=parseInt(this.List.SelectedValue),this.Name.Text=this.List.SelectedItem.Name;else if("ReOrderLevelNewViewModel"==this.Parent.ClassName&&this.List.Items.find(e=>0==i.e.stringCompare(e.Name,this.Name.Text,!0)))return void(this.DisplayMessage="Duplicate Name");this.Name.Enable=!0}else if("AddEditReportViewModel"==this.Parent.ClassName||"ReportViewModel"==this.Parent.ClassName||"AddEmailSMSViewModel"==(null===(t=this.Parent)||void 0===t?void 0:t.ClassName)){if(null!=this.List.SelectedValue&&parseInt(this.List.SelectedValue)>0)this.SaveAsID=parseInt(this.List.SelectedValue),this.Name.Text=this.List.SelectedItem.Name;else if("ReOrderLevelNewViewModel"==this.Parent.ClassName&&this.List.Items.find(e=>0==i.e.stringCompare(e.Name,this.Name.Text,!0)))return void(this.DisplayMessage="Duplicate Name");this.Name.Enable=!0}o.a.page.HideDialog()}catch(s){}}OnListChange(e){this.Name.Enable=null==this.List.SelectedValue||"0"==this.List.SelectedValue}}},nif3:function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var o=s("1xwR"),i=s("Lp6j"),l=s("Do2H");class a extends o.b{constructor(e){super(e),this.ds=null}LoadReport(){let e="",t="",s="";s=this.ViewModel.PayrollWidgetEmpID>0&&(307==this.ViewModel.ReportID||306==this.ViewModel.ReportID)?this.ViewModel.PayrollWidgetEmpID.toString():this.ViewModel.oReportDialog.GetSeqNosList(),s.length>0&&(this.ViewModel.oReportDialog.IsZeroSelected||this.ViewModel.oReportDialog.IsOneSelected||(s=this.ViewModel.PayrollWidgetEmpID>0&&(307==this.ViewModel.ReportID||306==this.ViewModel.ReportID)?this.ViewModel.PayrollWidgetEmpID.toString():this.ViewModel.oReportDialog.GetSeqNosListWithRoots(),this.ViewModel.oReportDialog.IsGroupExists?(e="C51.NodeID=GTP.GTID",t=s.Contains(",")?",(select T.NodeID GTID from COM_CC50051 T with(nolock),COM_CC50051 GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.NodeID IN ("+s+") group by T.NodeID) AS GTP ":",(select T.NodeID GTID from COM_CC50051 T with(nolock),COM_CC50051 GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.NodeID="+s+" group by T.NodeID) AS GTP "):e=s.Contains(",")?"C51.NodeID IN ("+s+")":"C51.NodeID="+s));let o="";this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(o=i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),this.ChunkSize=this.ViewModel.Preferences.ContainsKey("ChunkSize")?parseInt(this.ViewModel.Preferences.ChunkSize):1;let a=null;if(286==this.ViewModel.StaticReportType){let s="\nSELECT C51.NODEID\n ,C51.CODE\n ,C51.NAME\n ,CASE \n     WHEN convert(DATETIME, OPLeavesAsOn) <> '01 Jan 1900'\n         THEN convert(DATETIME, OPLeavesAsOn)\n     ELSE CONVERT(DATETIME, C51.DOJ)\n     END\n ,CC.CCNID53\n ,DATEDIFF(D, CONVERT(DATETIME, C51.DOJ), CONVERT(DATETIME, '"+this.ViewModel.FromDatePicker.Date.ToString("dd MMM yyyy")+"'))\n ,DATEDIFF(MONTH, CONVERT(DATETIME, CASE \n             WHEN convert(DATETIME, OPLeavesAsOn) <> '01 Jan 1900'\n                 THEN convert(DATETIME, OPLeavesAsOn)\n             ELSE CONVERT(DATETIME, C51.DOJ)\n             END), CONVERT(DATETIME, '"+this.ViewModel.ToDatePicker.Date.ToString("dd MMM yyyy")+"'))\n ,0\n ,ISNULL(C51.OpVacationDays, 0)\n ,convert(DATETIME, OPLeavesAsOn)\n ,CONVERT(DATETIME, C51.DOJ)\n ,C51.VACDAYSPERIOD\n ,C51.VACDAYSPERMONTH\nFROM COM_CC50051 C51 WITH (NOLOCK)\nJOIN COM_CCCCDATA CC WITH (NOLOCK) ON CC.NODEID = C51.NODEID\n"+t+" \nWHERE CC.COSTCENTERID = 50051\n AND C51.IsGroup=0 AND C51.NODEID > 2 ";e.length>0&&(s+="AND "+e),a=l.a.report.DataSet("RPT022",s),this.ViewModel.totals=i.e.NumArray(this.ViewModel.ReportColumns.length,this.ViewModel.lstGroup.length+1),this.ViewModel.hiddenTotals=i.e.NumArray(this.ViewModel.HiddenNumericColumns.length,this.ViewModel.lstGroup.length+1);let n=[];n.push(""),n.push(this.ViewModel.FromDatePicker.Date.ToString("dd MMM yyyy")),n.push(this.ViewModel.ToDatePicker.Date.ToString("dd MMM yyyy")),n.push(o+this.GetDimensionFilter("CC.CCNID",[50051]));for(let e=0;e<a.Tables[0].length;e+=this.ChunkSize){if(this.ViewModel.process.CancellationPending)return void(this.ViewModel.processArgs.Cancel=!0);this.sbChunks="";for(let t=e;t<a.Tables[0].length&&t-e<this.ChunkSize;t++)this.sbChunks.length>0&&(this.sbChunks+=","),this.sbChunks+=a.Tables[0][t][a.Columns[0][0]].toString();n[0]=this.sbChunks.toString(),this.ds=l.a.empService.GetData(n,"spPAY_RptGetVacationLedger"),this.DataSetCollection.push(this.ds),this.ViewModel.ReportData=this.ds.Tables[0],this.ViewModel.ReportDataSet=this.ds.Tables[0],this.ViewModel.ReportDataColumns=this.ds.Columns[0],this.ViewModel.ConstructFormulaFields(!0),this.ViewModel.RenderData(this.ds.Tables[0],this.ViewModel.ReportDataColumns),this.ViewModel.CheckAndAddSubTotals(this.ds.Tables[0])}this.ViewModel.GrpReportTotal.SubTotalAppearance.IsVisible&&this.ViewModel.AddSubtotals_RT(this.ViewModel.GrpReportTotal,0),this.ViewModel.ReportData=null}else if(306==this.ViewModel.StaticReportType){let s="\n\nSELECT C51.NODEID,C51.CODE,C51.NAME FROM \nCOM_CC50051 C51 WITH(NOLOCK) \nLEFT JOIN COM_CCCCDATA CC WITH (NOLOCK) ON CC.NodeID=C51.NodeID AND CC.CostCenterID=50051\n"+t+" \nWHERE C51.IsGroup=0 AND C51.NodeID>1 AND C51.StatusID=250 \nAND DATEDIFF(day,ISNULL(CONVERT(DATETIME,C51.DORelieve),'01-Jan-2200'),CONVERT(DATETIME, '"+this.ViewModel.ToDatePicker.Date.ToString("dd MMM yyyy")+"'))<=0  ";e.length>0&&(s+="AND "+e),a=l.a.report.DataSet("RPT022",s),this.ViewModel.totals=i.e.NumArray(this.ViewModel.ReportColumns.length,this.ViewModel.lstGroup.length+1),this.ViewModel.hiddenTotals=i.e.NumArray(this.ViewModel.HiddenNumericColumns.length,this.ViewModel.lstGroup.length+1);let n=[];n.push(""),n.push(this.ViewModel.FromDatePicker.Date.ToString("dd MMM yyyy")),n.push(this.ViewModel.ToDatePicker.Date.ToString("dd MMM yyyy")),n.push(o+this.GetDimensionFilter("CC.CCNID",[50051]));for(let e=0;e<a.Tables[0].length;e+=this.ChunkSize){if(this.ViewModel.process.CancellationPending)return void(this.ViewModel.processArgs.Cancel=!0);this.sbChunks="";for(let t=e;t<a.Tables[0].length&&t-e<this.ChunkSize;t++)this.sbChunks.length>0&&(this.sbChunks+=","),this.sbChunks+=a.Tables[0][t][a.Columns[0][0]].toString();n[0]=this.sbChunks.toString(),this.ds=l.a.empService.GetData(n,"spPAY_RptGetAttendanceCalendar"),this.DataSetCollection.push(this.ds),this.ViewModel.ReportData=this.ds.Tables[0],this.ViewModel.ReportDataSet=JSON.parse(JSON.stringify(this.ds.Tables[0])),this.ViewModel.ReportDataColumns=this.ds.Columns[0],this.ViewModel.ConstructFormulaFields(!0),this.ViewModel.CheckAndUpdateRepeatData(this.ViewModel.ReportData,this.ViewModel.ReportDataColumns),this.ViewModel.RenderData(this.ViewModel.ReportData,this.ViewModel.ReportDataColumns),this.ViewModel.CheckAndAddSubTotals(this.ViewModel.ReportData)}this.ViewModel.GrpReportTotal.SubTotalAppearance.IsVisible&&this.ViewModel.AddSubtotals_RT(this.ViewModel.GrpReportTotal,0),this.ViewModel.ReportData=null}else if(307==this.ViewModel.StaticReportType){let s="\n\nSELECT C51.NODEID,C51.CODE,C51.NAME FROM \nCOM_CC50051 C51 WITH(NOLOCK) \nLEFT JOIN COM_CCCCDATA CC WITH (NOLOCK) ON CC.NodeID=C51.NodeID AND CC.CostCenterID=50051\n"+t+" \nWHERE C51.IsGroup=0 AND C51.NodeID>1 AND C51.StatusID=250 \nAND DATEDIFF(day,ISNULL(CONVERT(DATETIME,C51.DORelieve),'01-Jan-2200'),CONVERT(DATETIME, '"+this.ViewModel.ToDatePicker.Date.ToString("dd MMM yyyy")+"'))<=0  ";e.length>0&&(s+="AND "+e),a=l.a.report.DataSet("RPT022",s),this.ViewModel.totals=i.e.NumArray(this.ViewModel.ReportColumns.length,this.ViewModel.lstGroup.length+1),this.ViewModel.hiddenTotals=i.e.NumArray(this.ViewModel.HiddenNumericColumns.length,this.ViewModel.lstGroup.length+1);let n=[];n.push(""),n.push(this.ViewModel.FromDatePicker.Date.ToString("dd MMM yyyy")),n.push(this.ViewModel.ToDatePicker.Date.ToString("dd MMM yyyy")),n.push(o+this.GetDimensionFilter("CC.CCNID",[50051]));for(let e=0;e<a.Tables[0].length;e+=this.ChunkSize){if(this.ViewModel.process.CancellationPending)return void(this.ViewModel.processArgs.Cancel=!0);this.sbChunks="";for(let t=e;t<a.Tables[0].length&&t-e<this.ChunkSize;t++)this.sbChunks.length>0&&(this.sbChunks+=","),this.sbChunks+=a.Tables[0][t][a.Columns[0][0]].toString();n[0]=this.sbChunks.toString(),this.ds=l.a.empService.GetData(n,"spPAY_RptGetDailyAttendanceCalendar"),this.DataSetCollection.push(this.ds),this.ViewModel.ReportData=this.ds.Tables[0],this.ViewModel.ReportDataSet=[],this.ViewModel.ReportDataSet=JSON.parse(JSON.stringify(this.ds.Tables[0])),this.ViewModel.ReportDataColumns=this.ds.Columns[0],this.ViewModel.ConstructFormulaFields(!0),this.ViewModel.CheckAndUpdateRepeatData(this.ViewModel.ReportData,this.ViewModel.ReportDataColumns),this.ViewModel.RenderData(this.ViewModel.ReportData,this.ViewModel.ReportDataColumns),this.ViewModel.CheckAndAddSubTotals(this.ViewModel.ReportData)}this.ViewModel.GrpReportTotal.SubTotalAppearance.IsVisible&&this.ViewModel.AddSubtotals_RT(this.ViewModel.GrpReportTotal,0),this.ViewModel.ReportData=null}}LoadReportWithPostFilters(e){}}},zQUM:function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var o=s("Do2H"),i=s("ScVY"),l=s("EQd/");class a extends i.b{constructor(e){super(),this.SuspendVisiblity=!1,this.AppAllVisible=!1,this.SuspendPRVisiblity=!1,this.forwardVisible=!1,this.ApproveAllforwardVisible=!1,this.RejectAllVisible=!1,this.Remarks=new l.d(0),this.RemarksApprove=!1,this.RemarksReject=!1,this.RemarksSuspend=!1,this.Parent=e;let t=e;t.StaticReportObject.CanApproveAll&&(this.AppAllVisible=o.a.SessionManager.IsActionAssigned(200,"Approve all"),this.RejectAllVisible=o.a.SessionManager.IsActionAssigned(200,"Reject All"),this.ApproveAllforwardVisible=o.a.SessionManager.IsActionAssigned(200,"Approve all and forward")),this.forwardVisible=o.a.SessionManager.IsActionAssigned(200,"Move forward"),o.a.SessionManager.IsActionAssigned(t.StaticReportObject.QuotationDocument,"Suspend")&&(this.SuspendVisiblity=o.a.SessionManager.IsActionAssigned(200,"Suspend All"),this.SuspendPRVisiblity=o.a.SessionManager.IsActionAssigned(200,"Suspend PR"))}OnButtonClick(e){if(this.DisplayMessage="","Close"==e)o.a.page.HideDialog();else{let t=0;"ApproveAll"==e?t=1:"RejectAll"==e?t=2:"ApproveAllforward"==e?t=3:"forward"==e?t=4:"SuspendAll"==e?t=5:"SuspendPR"==e&&(t=6);let s=this.Parent;o.a.report.SaveApprovals(s.StaticReportObject.ccid,s.StaticReportObject.QuotationDocument,s.StaticReportObject.docid,new Date,this.Remarks.Text,t,s.StaticReportObject.Userlevel,s.StaticReportObject.WID,s.StaticReportObject.QtnIDs).then(e=>{this.DisplayMessage=e.Message,e.RetValue>0&&(s.DisplayMessage=this.DisplayMessage,1!=t&&(s.ButtonAction.Visible=!1),o.a.page.HideDialog())})}}}}}]);
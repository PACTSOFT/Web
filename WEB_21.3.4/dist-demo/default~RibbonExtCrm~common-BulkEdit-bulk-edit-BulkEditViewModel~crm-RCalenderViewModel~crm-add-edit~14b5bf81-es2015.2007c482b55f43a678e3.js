(window.webpackJsonp=window.webpackJsonp||[]).push([[23,133,134],{"F+4J":function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var s=i("Do2H");class a{constructor(){this.TeamID=0,this.Status=0,this.IsGroup=!1,this.FetaureID=0,this.FeatureNodeID=0,this.TeamNodeID=0,this.UserID=0,this.ActivityID=0,this.isTeam=0,this.isRole=0,this.isGroup=0}GetAssignedDetails(t,e,i){let a=[];a.push(t),a.push(e),a.push(i),a.push(s.a.SessionManager.UserID),a.push(s.a.SessionManager.LanguageID);let n="?CompanyIndex="+s.a.SessionManager.CompanyIndex+"&param="+JSON.stringify(a);return s.a.crmService.GetAssignedList(n)}GetCRMHistoryDetails(t,e){Logger.InfoLog("Team:: Inside GetCRMHistoryDetails");let i=[];i.push(t),i.push(e),i.push(s.a.SessionManager.UserID),i.push(s.a.SessionManager.LanguageID);let a="?param="+JSON.stringify(i);return Logger.InfoLog("Team:: Success: DBH.GetCRMHistoryDetails "+t.ToString()),s.a.crmService.GetCRMHistoryDetails(a)}FeatureAssign(){let t=[];return t.push(this.FetaureID),t.push(this.FeatureNodeID),t.push(this.TeamNodeID),t.push(this.UserID),t.push(this.isTeam),t.push(this.UsersXML),t.push(this.RolesXML),t.push(this.GroupXML),t.push(s.a.SessionManager.CompanyGUID),t.push(s.a.SessionManager.UserName),t.push(s.a.SessionManager.LanguageID),s.a.crmService.AssignFeature(t)}ActivityAssign(){let t=[];return t.push(this.FetaureID),t.push(this.FeatureNodeID),t.push(this.TeamNodeID),t.push(this.UserID),t.push(this.isTeam),t.push(this.UsersXML),t.push(this.RolesXML),t.push(this.GroupXML),t.push(s.a.SessionManager.CompanyGUID),t.push(s.a.SessionManager.UserName),t.push(s.a.SessionManager.LanguageID),t.push(this.ActivityID),s.a.crmService.ActivityAssign(t)}SetInvite(){let t=[];return t.push(this.FetaureID),t.push(this.FeatureNodeID),t.push(this.TeamNodeID),t.push(this.UserID),t.push(this.isTeam),t.push(this.UsersXML),t.push(this.RolesXML),t.push(this.GroupXML),t.push(s.a.SessionManager.CompanyGUID),t.push(s.a.SessionManager.UserName),t.push(s.a.SessionManager.LanguageID),t.push(this.InviteComments),s.a.crmService.SetInvite(t)}SetInviteStatus(t){Logger.InfoLog("Team::Entering SetInviteStatus");try{let e=[];e.push(t),e.push(s.a.SessionManager.UserName),e.push(s.a.SessionManager.UserID),e.push(s.a.SessionManager.LanguageID);let i=s.a.crmService.SetInviteStatus(e);return Logger.InfoLog("Team::Exiting SetInviteStatus"),i}catch(e){return Logger.ErrorLog("Team::SetInviteStatus"+e.stack),""}}AssignMultipleFeature(){let t=[];return t.push(this.FetaureID),t.push(this.NodesXML),t.push(this.TeamNodeID),t.push(this.UserID),t.push(this.isTeam),t.push(this.UsersXML),t.push(this.RolesXML),t.push(this.GroupXML),t.push(s.a.SessionManager.CompanyGUID),t.push(s.a.SessionManager.UserName),t.push(s.a.SessionManager.LanguageID),s.a.crmService.AssignMultipleFeature(t)}}},UlzB:function(t,e,i){"use strict";i.r(e),i.d(e,"InvitesViewModel",(function(){return c}));var s=i("Do2H"),a=i("Lp6j"),n=i("ScVY"),l=i("4HhE"),r=i("8B8H"),o=i("JIg3"),h=i("ockk"),u=i("F+4J");class c extends n.b{constructor(){super(),this.SaveInvite=new l.b,this._ActivityID=0,this._SearchDate=new o.a(0),this.dset=[]}get ActivityID(){}set ActivityID(t){this._ActivityID=t}get SearchDate(){return this._SearchDate}set SearchDate(t){this._SearchDate=t}InvitesViewModel_1(t,e,i){Logger.InfoLog("InvitesViewModel :: entering "),this.IsInvite=i,this.InviteGrid=new r.a,this.dset=e,this.IsInvite?(this.LblText="Invities",this.Title="Invities",this.CancelVisibility=!0,this.Width="1000",this.SaveVisibility=!0,this.SearchVisibility=!0,this.AddGridColumns()):(this.LblText="Attendies",this.Title="Attendies",this.CancelVisibility=!0,this.Width="600",this.SaveVisibility=!1,this.SearchVisibility=!1,this.AddAttendiesGridColumns()),this.LoadData(),this.SaveInvite.Subscribe(this,"onSaveInvite"),Logger.InfoLog("InvitesViewModel :: exiting ")}InvitesViewModel_2(t,e,i,s){this.InvitesViewModel_1(t,e,i),Logger.InfoLog("InvitesViewModel :: entering "),this.ActivityID=s,Logger.InfoLog("InvitesViewModel :: exiting ")}BuildTempTable(){Logger.InfoLog("InvitesViewModel :: entering BuildTempTable "),this.InviteGrid.Table=[],this.InviteGrid.Width=(parseInt(this.Width)-25).toString(),this.InviteGrid.Height=300,this.InviteGrid.TableColumns.push("SNo"),this.InviteGrid.TableColumns.push("ActivityID"),this.InviteGrid.TableColumns.push("Customer"),this.InviteGrid.TableColumns.push("Subject"),this.InviteGrid.TableColumns.push("StartDate"),this.InviteGrid.TableColumns.push("EndDate"),this.InviteGrid.TableColumns.push("RequestedBy"),this.InviteGrid.TableColumns.push("RequestedDate"),this.InviteGrid.TableColumns.push("InviteComments"),this.InviteGrid.TableColumns.push("InviteStatus"),Logger.InfoLog("InvitesViewModel :: exiting BuildTempTable ")}AddGridColumns(){Logger.InfoLog("InvitesViewModel :: entering AddGridColumns "),this.BuildTempTable();let t=[],e=new h.a;e=new h.a,e.DisplayMember="SNo",e.Header=s.a.GetResource("UOM_Sno"),e.DataType="TextBlock",e.Width=50,e.ReadOnly=!0,e.IsVisible=!0,t.push(e),e=new h.a,e.ComboData=this.ReturnStatus(),e.DisplayMember="InviteStatus",e.ValueMember="Value",e.ValueBinding="InviteStatus",e.Header="Status",e.DataType="ComboBox",e.Width=100,e.IsVisible=!0,t.push(e),e=new h.a,e.DisplayMember="Customer",e.Header="Customer",e.DataType="TextBlock",e.Width=150,e.IsVisible=!0,t.push(e),e=new h.a,e.DisplayMember="Subject",e.Header="Subject",e.DataType="TextBlock",e.Width=150,e.IsVisible=!0,t.push(e),e=new h.a,e.DisplayMember="StartDate",e.Header="Start Date",e.DataType="TextBlock",e.Width=150,e.IsVisible=!0,t.push(e),e=new h.a,e.DisplayMember="EndDate",e.Header="End Date",e.DataType="TextBlock",e.Width=150,e.IsVisible=!0,t.push(e),e=new h.a,e.DisplayMember="RequestedBy",e.Header="Requested By",e.DataType="TextBlock",e.Width=80,e.IsVisible=!0,t.push(e),e=new h.a,e.DisplayMember="RequestedDate",e.Header="Requested Date",e.DataType="TextBlock",e.Width=150,e.IsVisible=!0,t.push(e),e=new h.a,e.DisplayMember="InviteComments",e.Header="Comments",e.DataType="TextBlock",e.Width=150,e.IsVisible=!0,t.push(e),this.InviteGrid.Columns=t,this.InviteGrid.OnCellEditEnding.Subscribe(this,"OnGridCellEditEnding"),Logger.InfoLog("InvitesViewModel :: exiting AddGridColumns ")}BuildAttendiesTempTable(){Logger.InfoLog("InvitesViewModel :: entering BuildTempTable "),this.InviteGrid.Table=[],this.InviteGrid.Width=(parseInt(this.Width)-25).toString(),this.InviteGrid.Height=300,this.InviteGrid.TableColumns.push("SNo"),this.InviteGrid.TableColumns.push("ActivityID"),this.InviteGrid.TableColumns.push("CreatedBy"),this.InviteGrid.TableColumns.push("UserName"),this.InviteGrid.TableColumns.push("InviteStatus"),this.InviteGrid.TableColumns.push("InvAtt"),Logger.InfoLog("InvitesViewModel :: exiting BuildTempTable ")}AddAttendiesGridColumns(){Logger.InfoLog("InvitesViewModel :: entering AddGridColumns "),this.BuildAttendiesTempTable();let t=[],e=new h.a;e=new h.a,e.DisplayMember="SNo",e.Header=s.a.GetResource("UOM_Sno"),e.DataType="TextBlock",e.Width=50,e.ReadOnly=!0,e.IsVisible=!0,t.push(e),e=new h.a,e.DisplayMember="UserName",e.Header="User",e.DataType="TextBlock",e.Width=150,e.IsVisible=!0,t.push(e),e=new h.a,e.DisplayMember="InviteStatus",e.Header="Status",e.DataType="TextBlock",e.Width=150,e.IsVisible=!0,t.push(e),e=new h.a,e.DisplayMember="InvAtt",e.Header="Invite / Attendies",e.DataType="TextBlock",e.Width=150,e.IsVisible=!0,t.push(e),this.InviteGrid.Columns=t,Logger.InfoLog("InvitesViewModel :: exiting AddGridColumns ")}ReturnStatus(){let t=[];return t.push({InviteStatus:"",Value:""}),t.push({InviteStatus:"Accepted",Value:"Accepted"}),t.push({InviteStatus:"Rejected",Value:"Rejected"}),t.push({InviteStatus:"Cancelled",Value:"Cancelled"}),t}OnGridCellEditEnding(t,e,i){if("InviteStatus"==e){if(Logger.InfoLog("InvitesViewModel::Entering OnGridCellEditEnding ColName="+e.toString()),"Cancelled"==t.InviteStatus.toString())t.InviteStatus="",this.DisplayMessage="Select Accepted/Rejected",this.MessageVisibility=!0;else{let e=s.a.common.GetDataSetQuery("SELECT statusid from crm_activities WITH(NOLOCK) where activityid in (select inviterefactid from crm_activities WITH(NOLOCK) where activityid="+t.ActivityID.toString()+")");null!=e&&e.Tables.length>0&&e.Tables[0].forEach(e=>{if("413"==e.statusid.toString())return this.DisplayMessage="Activity is Closed, click on save to update status",t.InviteStatus="Cancelled",void(this.MessageVisibility=!0)})}Logger.InfoLog("InvitesViewModel::Exiting OnGridCellEditEnding ColName="+e.toString())}}LoadData(){if(Logger.InfoLog("InvitesViewModel :: entering LoadData "),null!=this.dset&&this.dset.Tables.length>0){this.InviteGrid.Clear();let t=0;this.IsInvite?this.dset.Tables[0].length>0&&this.dset.Tables[0].forEach(e=>{let i=[];t+=1,i.SNo=t,a.e.hasprop(e,"CustomerID")&&(i.Customer=e.CustomerID),a.e.hasprop(e,"ActSubject")&&(i.Subject=e.ActSubject),a.e.hasprop(e,"InviteComments")&&(i.InviteComments=e.InviteComments),a.e.hasprop(e,"InviteStatus")&&(i.InviteStatus=e.InviteStatus),a.e.hasprop(e,"ActStartDate")&&(i.StartDate=e.ActStartDate.toString()+" "+new Date(e.ActStartTime.toString()).ToString("hh:mm:ss tt")),a.e.hasprop(e,"ActEndDate")&&(i.EndDate=e.ActEndDate+" "+new Date(e.ActEndTime.toString()).ToString("hh:mm:ss tt")),a.e.hasprop(e,"UserName")&&(i.RequestedBy=e.UserName),a.e.hasprop(e,"CreatedDate")&&(i.RequestedDate=e.CreatedDate),i.ActivityID=e.ActivityID,this.InviteGrid.addRow(i)}):this.dset.Tables[0].length>0&&this.dset.Tables[0].forEach(e=>{let i=[];t+=1,i.SNo=t,a.e.hasprop(e,"ActivityID")&&(i.ActivityID=e.ActivityID),a.e.hasprop(e,"CreatedBy")&&(i.CreatedBy=e.CreatedBy),a.e.hasprop(e,"UserName")&&(i.UserName=e.UserName),a.e.hasprop(e,"InviteStatus")&&(i.InviteStatus=e.InviteStatus),a.e.hasprop(e,"InvAtt")&&(i.InvAtt=e.InvAtt),this.InviteGrid.addRow(i)})}Logger.InfoLog("InvitesViewModel :: exiting LoadData ")}onSaveInvite(t){if(null!=t){if(Logger.InfoLog("InvitesViewModel :: entering onSaveInvite, sender "+t.toString()),"Cancel"==t.toString())s.a.page.HideDialog();else if("Search"==t.toString()){if(null!=this.SearchDate.Date){this.DisplayMessage="",this.MessageVisibility=!1;let t=s.a.cases.GetInvities(-100,-100,-100,0,this.SearchDate.Date);null!=t&&t.Tables.length>0&&(t.Tables[0].length>0?(this.dset=t,this.LoadData()):(this.DisplayMessage="No invitations",this.InviteGrid.Clear(),this.MessageVisibility=!0))}}else if("Clear"==t.toString())this.InviteGrid.Clear();else try{let t="";if(t=this.GetInviteXML(),""!=t.toString()){let e=new u.a,i=-1,s=e.SetInviteStatus(t);this.DisplayMessage=s.message,i=s.RetValue,i>0&&(this.DisplayMessage="Saved Successfully",this.MessageVisibility=!0,Logger.InfoLog("InvitesViewModel :: Exiting onSaveInvite set invite error "))}}catch(e){throw Logger.ErrorLog("InvitesViewModel :: Exiting onSaveInvite set invite error "+e.Message),""}Logger.InfoLog("InvitesViewModel :: exiting onSaveInvite ")}}GetInviteXML(){Logger.InfoLog("InvitesViewModel :: entering GetInviteXML ");let t="";try{for(let e=0;e<this.InviteGrid.Table.length;e++)""!=this.InviteGrid.Table[e].InviteStatus.toString()&&(t+="<Row  ",t+=' ActivityID="'+this.InviteGrid.Table[e].ActivityID.toString()+'"',t+=' InviteComments="'+this.InviteGrid.Table[e].InviteComments.toString()+'"',t+=' InviteStatus="'+this.InviteGrid.Table[e].InviteStatus.toString()+'"',t+=" />");t.length>0&&(t="<XML>"+t+"</XML>")}catch(e){return Logger.ErrorLog("InvitesViewModel :: exiting GetInviteXML error message is "+e.Message),this.DisplayMessage=e,this.MessageVisibility=!0,""}return Logger.InfoLog("InvitesViewModel :: exiting GetInviteXML "),t.toString()}}},dvUr:function(t,e,i){"use strict";i.r(e),i.d(e,"InvitesComponent",(function(){return r}));var s=i("3Pt+"),a=i("fXoL");function n(t,e){if(1&t){const t=a.ac();a.Zb(0,"button",6),a.hc("click",(function(){return a.Ic(t),a.lc().obj.onSaveInvite("Save")})),a.Ub(1,"i",11),a.Wc(2),a.mc(3,"translate"),a.Yb()}2&t&&(a.Db(2),a.Xc(a.nc(3,1,"Save")))}function l(t,e){if(1&t){const t=a.ac();a.Zb(0,"button",12),a.hc("click",(function(){return a.Ic(t),a.lc().obj.onSaveInvite("Cancel")})),a.Ub(1,"i",13),a.Wc(2),a.mc(3,"translate"),a.Yb()}2&t&&(a.Db(2),a.Xc(a.nc(3,1,"Cancel")))}let r=(()=>{class t{constructor(){this.group=new s.j({})}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=a.Nb({type:t,selectors:[["app-invites"]],decls:44,vars:15,consts:[[1,"master-screen",3,"formGroup"],[1,"PACTHeaderFields","dialogSubBody"],[1,"page-title"],[2,"margin","6px"],["FieldDirective","",3,"obj"],[2,"margin","6px","margin-right","0px"],[1,"primary-btn-wicon",3,"click"],[1,"form-group","row","form-row","PACTControl"],[1,"Pactdailogfooter"],["class","primary-btn-wicon",3,"click",4,"ngIf"],["class","secondary-btn-wicon",3,"click",4,"ngIf"],[1,"fa-light","fa-floppy-disk"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-rectangle-xmark"]],template:function(t,e){1&t&&(a.Zb(0,"div",0),a.Wc(1,"\n    "),a.Zb(2,"div",1),a.Wc(3,"\n        "),a.Zb(4,"label",2),a.Wc(5),a.Yb(),a.Wc(6,"\n        \n        "),a.Zb(7,"div",3),a.Wc(8,"\n            "),a.Zb(9,"span"),a.Wc(10),a.mc(11,"translate"),a.Yb(),a.Wc(12,"\n           "),a.Vb(13,4),a.Wc(14,"\n        "),a.Yb(),a.Wc(15,"\n        "),a.Zb(16,"div",5),a.Wc(17,"\n            "),a.Zb(18,"button",6),a.hc("click",(function(){return e.obj.onSaveInvite("Search")})),a.Wc(19),a.mc(20,"translate"),a.Yb(),a.Wc(21,"\n            "),a.Zb(22,"button",6),a.hc("click",(function(){return e.obj.onSaveInvite("Clear")})),a.Wc(23),a.mc(24,"translate"),a.Yb(),a.Wc(25,"  \n        "),a.Yb(),a.Wc(26,"\n        "),a.Zb(27,"div",7),a.Wc(28,"\n            "),a.Vb(29,4),a.Wc(30,"\n        "),a.Yb(),a.Wc(31,"\n  "),a.Yb(),a.Wc(32,"\n\n  "),a.Zb(33,"div",8),a.Wc(34,"\n    "),a.Zb(35,"div"),a.Wc(36,"\n        "),a.Uc(37,n,4,3,"button",9),a.Wc(38,"\n        "),a.Uc(39,l,4,3,"button",10),a.Wc(40,"\n    "),a.Yb(),a.Wc(41,"      \n  "),a.Yb(),a.Wc(42,"\n"),a.Yb(),a.Wc(43,"\n")),2&t&&(a.tc("formGroup",e.obj.group),a.Db(5),a.Yc("\n            ",e.obj.LblText,"   \n        "),a.Db(5),a.Xc(a.nc(11,9,"Service_ExpiryDate")),a.Db(3),a.tc("obj",e.obj.SearchDate),a.Db(6),a.Xc(a.nc(20,11,"Search")),a.Db(4),a.Xc(a.nc(24,13,"Clear")),a.Db(6),a.tc("obj",e.obj.InviteGrid),a.Db(8),a.tc("ngIf",e.obj.SaveVisibility),a.Db(2),a.tc("ngIf",e.obj.CancelVisibility))},styles:[""]}),t})()},"m+Ff":function(t,e,i){"use strict";i.r(e),i.d(e,"RCalenderViewModel",(function(){return L})),i.d(e,"DayTemplate",(function(){return N})),i.d(e,"ViewColumn",(function(){return F})),i.d(e,"CalenderReportFilterViewModel",(function(){return E})),i.d(e,"CalCostCenterFilter",(function(){return R}));var s=i("mrSG"),a=i("Do2H"),n=i("Lp6j"),l=i("eQJW"),r=i("dH+5"),o=i("mvPR"),h=i("0/4Q"),u=i("CQvG"),c=i("C58A"),d=i("DKUf"),S=i("VxiT"),C=i("xnJf"),m=i("EQd/"),D=i("OQq8"),g=i("4HhE"),I=i("ScVY"),p=i("JIg3"),T=i("n56n"),y=i("Jnyl"),b=i("31sV"),A=i("r2z3"),v=i("UlzB"),V=i("dvUr"),w=i("NkMH"),f=i("ZDA+"),M=i("6z9j");class L extends I.b{constructor(){super(),this.DataClick=new g.b,this._ButtonInvite=new w.a,this._ButtonAppointment=new w.a,this.DisplayDate=null,this._DayColumns=[],this._MonthlyData=[],this.CCFilter="",this._DayTemplateList=[],this.Features=new h.e(0),this.ViewType=new h.e(0),this.Userlist=new h.e(0),this._SelectedDate=Date.Today(),this.ShowType=new h.e(0),this.Status=new h.e(0),this.CalendarSource=[],this.GoToDate=new p.a(0),this.UIDate=Date.Today(),this.onCheck=new g.b,this.cmnItem_Click=new g.b,this.CellEditEnding=new g.b,this.ColLists=[],this.SelectionChanged=new g.b,this.DayviewRadioChanged=new g.b,this.Move=new g.b,this.ActVisibility=!1,this.CustomizeVisibility=!1,this.TempCurrDate=new Date,this.dset=null,this.TempCurrMonth=new Date,this.TempCurrWeek=new Date,this.EventData=[],this._ScreenObject=new S.a,this._WeekData=[],this.ActivityID=0,this.CCID=-100,this.FeatureID=-100,this.iStatus=0,this.Type=0,this.Subject="",this._FSubject=new m.d(0),this.arrWeekName=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],this.LoadUICallBack=new g.b,this.RefreshMonthView=new g.b,this.res="No",this.IgnoreSelectionChange=!1,this._myAppointmentsList=[],this.CalendarSource=[],this.CostCenterID=0,this.ViewActivities=new u.b(this),this.ClassName="RCalenderViewModel"}get ButtonInvite(){return this._ButtonInvite}set ButtonInvite(t){this._ButtonInvite=t}get ButtonAppointment(){return this._ButtonAppointment}set ButtonAppointment(t){this._ButtonAppointment=t}get DayColumns(){return this._DayColumns}set DayColumns(t){this._DayColumns!=t&&(this._DayColumns=t)}get MonthlyData(){return this._MonthlyData}set MonthlyData(t){this._MonthlyData!=t&&(this._MonthlyData=t)}get DayTemplates(){return this._DayTemplateList}get SelectedDate(){return this._SelectedDate}set SelectedDate(t){t!=this._SelectedDate&&(this._SelectedDate=t)}ReturnDataset(t,e,i,s,n,l,r,o){null!=n&&(this.UIDate=n),t=parseInt(t),null!=this.Activities&&-100!=t&&this.Activities.LoadCustomFields(t);let h=a.a.cases.GetActivities(t,e,i,s,n,l,r,o);return-100==t&&null!=this.Activities&&this.Activities.LoadCustomFields(1e3),h}OnCmnItem_Click(t){return Object(s.b)(this,void 0,void 0,(function*(){if(267!=this.FeatureID){switch(Logger.InfoLog("RCalenderViewModel::Entering OnCmnItem_Click strcommand is "+t),t){case"Add":this.ActivitiesPopup=null,this.Activities.ViewAttachments.AttachmentsList.Clear(),this.ActVisibility=!this.Activities.IsPopup,this.Activities.Recur=new c.RecurAppointmentViewModel(this.Activities),this.Activities.AssignUserList.SelectedValue=a.a.SessionManager.UserID.toString(),this.Activities.ActivitiesVisibility=!0,this.Activities.Subject.Text="",this.Activities.AssignVisiblity=!1,this.Activities.Location.Text="",this.Activities.CustomerType.Visible=!0,this.Activities.CRMCustomer.Text="",this.Activities.CRMCustomer.Code.SelectedValue=0,this.Activities.CRMCustomer.Code.Text="",this.Activities.Remarks.Text="",this.Activities.Remarks.Xaml="",this.Activities.CRMContactPerson.SelectedValue=0,this.Activities.Remarks.Tag="","-100"==this.CCID.toString()?this.Activities.LoadCustomFields(1e3):this.Activities.LoadCustomFields(this.CCID),this.Activities.InviteLabel.Visible=!1,null!=this.SelectedVoucher&&(this.Activities.StartTime.SelectedValue=this.SelectedVoucher.Time.toString(),this.Activities.EndTime.SelectedValue=this.SelectedVoucher.Time.toString()),this.Activities.ActivityID=0,this.ActivityID=0,this.CustomizeVisibility=!1,this.Activities.ButtonSave.Visible=a.a.SessionManager.IsActionAssigned(1e3,"Activity_Create"),this.Activities.IsPopup?(this.ActivitiesPopup=this.Activities,this.ActVisibility=!1,this.CustomizeVisibility=!1,this.ActivitiesPopup.AssignVisiblity=!1,a.a.page.ShowDialog(this.ActivitiesPopup,b.ActivitiesComponent,{ShowCenter:!0})):(a.a.page.ShowDialog(this.Activities,b.ActivitiesComponent,{}),this.ActVisibility=!0,this.CustomizeVisibility=!1,this.Activities.AssignVisiblity=!1);break;case"ShowInvites":let t=a.a.cases.GetInvities(-100,-100,-100,0,Date.Today());if(null!=t&&t.Tables.length>0){if(!(t.Tables[0].length>0))return void alert("No Intivitations");{let e=new v.InvitesViewModel;e.InvitesViewModel_1(a.a.SessionManager.UserID,t,!0),a.a.page.ShowDialog(e,V.InvitesComponent),this.ActVisibility=!1,this.CustomizeVisibility=!1,this.Activities.AssignVisiblity=!1}}break;case"Customize":this.ActVisibility=!1,this.CustomizeVisibility=!0,this.Activities.AssignVisiblity=!1;break;case"Delete":if(null==this.SelectedVoucher)return;let e=[];null!=this.dset&&this.dset.Tables.length>0&&this.dset.Tables[0].length>0&&(e=this.dset.Tables[0].DefaultView),e.filter(t=>t.ActStartTime=="1/1/1900 "+this.SelectedVoucher.Time&&t.ActStartDate==this.UIDate),null!=e&&e.length>0&&(this.DeleteData(e),null!=this.LoadUICallBack&&this.LoadUICallBack.Call(!0));break;case"Assign":this.CustomizeVisibility=!1,this.Activities.AssignVisiblity=!0,this.Activities.ActivitiesVisibility=!1;break;case"SetAsDefault":a.a.common.GetDataSet3("RCV001",this.ViewType.SelectedValue,this.Features.SelectedValue,this.Status.SelectedValue+","+a.a.SessionManager.UserID),this.DisplayMessage=" User Updated Successfully  ",this.MessageVisibility=!0;break;case"Filter":null==this.ReportFilter&&(this.ReportFilter=new E,this.ReportFilter.CalenderReportFilterViewModel_1(this)),this.ShowReportFilter=!0}Logger.InfoLog("RCalenderViewModel::Exiting OnCmnItem_Click")}}))}onCanCmnItem_Click(t){return!0}OnSave(){}get ScreenObject(){return this._ScreenObject}get WeekData(){return this._WeekData}get SelectedVoucher(){return this._SelectedVoucher}set SelectedVoucher(t){t!=this._SelectedVoucher&&(this._SelectedVoucher=t)}get FSubject(){return this._FSubject}set FSubject(t){t!=this._FSubject&&(this._FSubject=t)}getEvents(){this.EventData=[];for(let t=0;t<this._myAppointmentsList.length;t++){const e=this._myAppointmentsList[t];let i={},s=new Date(e.StartTime.ToString("dd/MMM/yyyy")+" "+new Date(e.stTime).ToString("hh:mm:ss"));i.id=e.AppointmentID,i.title=new Date(e.stTime).ToString("hh:mm:ss a")+" "+e.Subject,i.start=s,this.EventData.push(i)}}_RCalenderViewModel(t,e=-100){this.FeatureID=e,this.DataClick.Subscribe(this,"OnDataClick"),this.CalendarSource=[],this.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.AppointmentColor="#FFE6F2FB",this.Subject="",this.SelectionChanged.Subscribe(this,"onSelectionChanged"),this.Userlist.SelectionChangedCommand.Subscribe(this,"onSelectionChanged"),this.Status.SelectionChangedCommand.Subscribe(this,"onSelectionChanged"),this.ShowType.SelectionChangedCommand.Subscribe(this,"onSelectionChanged"),this.Features.SelectionChangedCommand.Subscribe(this,"onSelectionChanged"),this.FSubject.TextChangedCommand.Subscribe(this,"onSelectionChanged"),this.cmnItem_Click.Subscribe(this,"OnCmnItem_Click"),this.DayviewRadioChanged.Subscribe(this,"RadioButtonChanged"),null!=this.GoToDate&&this.GoToDate.SelectedDateChanged.Subscribe(this,"OnDateChanged"),267==this.FeatureID?(this.DisplayName=a.a.GetResource("Attendance Calendar"),this.Title=a.a.GetResource("Attendance Calendar"),this.ButtonInvite.Visible=!1,this.ButtonAppointment.Visible=!1):(this.DisplayName=a.a.GetResource("Calendar"),this.Title=a.a.GetResource("Calendar")),this.Move.Subscribe(this,"MoveItem"),this.Activities=new d.a(this,!0),null!=this.Activities&&(this.Activities.AssignVisiblity=!1),this.TempCurrDate=Date.Today(),(new Date).getDayName();let i=Date.Today().getDate()-0;this.TempCurrWeek=Date.Today().AddDays(-i),this.TempCurrMonth=Date.Today(),this.CostCenterID=89,this.CurrDate=this.TempCurrDate.getDayName().toString()+", "+this.TempCurrDate.getMonthName()+" "+this.TempCurrDate.getDate()+", "+this.TempCurrDate.getFullYear(),this.CurrMonth=this.TempCurrDate.getMonth()+" - "+this.TempCurrDate.getFullYear(),this.MonthViewVisibility=!0,this.DayViewVisibility=!1,this.WeekViewVisibility=!1,this.dtEndDate=this.TempCurrWeek.AddDays(6),this.CurrWeek=this.TempCurrWeek.toLocaleDateString()+"  -  "+this.dtEndDate.toLocaleDateString(),this.LoadDayViewData(),this.BuildTempDataTable(),this.onCheck.Subscribe(this,"onCheckChange"),this.LoadUICallBack.Subscribe(this,"ReLoad"),this.ViewType.Label=a.a.GetResource("Cal_ViewType"),this.ViewType.Enable=!0,this.ViewType.SelectionChangedCommand.Subscribe(this,"onViewTypeChange"),this.ShowType.Label=a.a.GetResource("Cal_Events"),this.ShowType.Enable=!0,this.Features.Label=a.a.GetResource("Feature"),this.Features.Enable=!0,this.Status.Label=a.a.GetResource("Status"),this.Status.Enable=!0,this.Userlist.Label="Assigned to",this.Userlist.Enable=!0,this.FSubject.Label=a.a.GetResource("Subject"),this.FSubject.Enable=!0}onViewTypeChange(t){this.onCheckChange("")}AssignFeatureData(t){return Object(s.b)(this,void 0,void 0,(function*(){if(this.Activities.ActivityID=parseInt(t[0].ActivityID.toString()),"413"==t[0].ActStatus.toString())return alert("Activity is closed"),this.AssignVisiblity=!1,this.CustomizeVisibility=!1,void(this.Activities.IsPopup||(this.ActVisibility=!0));{this.AssignVisiblity=!0,this.CustomizeVisibility=!1,this.ActVisibility=!1,this.Activities.ActivityType.SelectedValue=t[0].ActivityTypeID.toString(),this.ActivityID=this.Activities.ActivityID,this.CCID=parseInt(t[0].CostCenterID);const{AssignFeatureViewModel:e}=yield i.e(109).then(i.bind(null,"2Dtv")),{AssignFeatureComponent:s}=yield Promise.resolve().then(i.bind(null,"yWgc"));this.AssignFeature=new e,this.AssignFeature.AssignFeatureViewModel_1(this,this.ActivityID,this.CCID),a.a.page.ShowDialog(this.AssignFeature,s)}}))}LoadData(t){if(null==this.Activities)return;if(this.Activities.ViewAttachments.AttachmentsList.Clear(),this.Activities.MessageVisibility=!1,this.Activities.DisplayMessage="",this.Activities.FeatureLable="",null!=t&&n.e.hasprop(t[0],"DocNo")&&""!=n.e.StringValue(t[0].DocNo).toString()&&(this.Activities.FeatureLable="("+t[0].DocNo.toString()+")",this.Activities.FeatureWiseLable.FeatureID=128==parseInt(t[0].CostCenterID)?88:parseInt(t[0].CostCenterID),this.Activities.FeatureWiseLable.DBColumnID=parseInt(t[0].NodeID),n.e.hasprop(t[0],"DocumentName")&&n.e.hasprop(t[0],"DocPrefix")&&(this.Activities.FeatureWiseLable.DBColumnName=t[0].DocumentName.toString(),this.Activities.FeatureWiseLable.GroupName=t[0].DocPrefix.toString(),this.Activities.FeatureWiseLable.ScreenName=t[0].DocNumber.toString())),this.Activities.ActivityID=parseInt(t[0].ActivityID.toString()),this.Activities.ActivityType.SelectedValue=t[0].ActivityTypeID.toString(),this.ActivityID=this.Activities.ActivityID,this.Activities.InviteLabel.Visible=this.Activities.ActivityID>0,this.CCID=parseInt(t[0].CostCenterID),128==this.CCID&&(this.CCID=88),"3"!=this.Activities.ActivityType.SelectedValue&&"4"!=this.Activities.ActivityType.SelectedValue||t.forEach(t=>{parseInt(t.ScheduleID.toString())>0&&this.Activities.Recur.LoadEditData(t)}),null!=t[0].FreqType&&""!=t[0].FreqType.toString()){let e=parseInt(t[0].FreqType.toString());1==e?this.Activities.ActivityText.Text="Once":4==e?this.Activities.ActivityText.Text="Daily":8==e?this.Activities.ActivityText.Text="Weekly":e>=16&&(this.Activities.ActivityText.Text="Monthly")}"1"==this.Activities.ActivityType.SelectedValue||"2"==this.Activities.ActivityType.SelectedValue?this.Activities.Exp.Visible=!1:"3"!=this.Activities.ActivityType.SelectedValue&&"4"!=this.Activities.ActivityType.SelectedValue||(this.Activities.Exp.Visible=!0),this.Activities.Status.SelectedValue=n.e.StringValue(t[0].ActStatus),this.Activities.StatusSelectedValue=n.e.StringValue(t[0].ActStatus),this.Activities.Subject.Text=n.e.StringValue(t[0].ActSubject),this.Activities.Priority.SelectedValue=n.e.StringValue(t[0].Priority),this.Activities.PctComplete.Text=n.e.StringValue(t[0].PctComplete),this.Activities.Location.Text=n.e.StringValue(t[0].Location),this.Activities.IsAllDayActivity.IsChecked="0"!=t[0].IsAllDayActivity.toString(),n.e.IsEmpty(t[0].ActualCloseDate)||(this.Activities.ActualCloseDate.Date=new Date(t[0].ActualCloseDate.toString())),n.e.IsEmpty(t[0].ActualCloseTime)?this.Activities.ActualCloseTime.SelectedIndex=0:this.Activities.ActualCloseTime.SelectedValue=new Date(t[0].ActualCloseTime.toString()).ToString("hh:mm:ss a"),1e3==this.CCID?(this.Activities.CustomerType.Visible=!0,""!=t[0].CustomerType.toString()&&null!=t[0].CustomerType.toString()?(this.Activities.CustomerType.SelectedValue="None"==t[0].CustomerType.toString()?"0":"Account"==t[0].CustomerType.toString()?"1":"CRM-Customers"==t[0].CustomerType.toString()?"2":"0",this.Activities.OnCustomerTypeChange(null),this.Activities.CRMCustomer.Code.SelectedValue=""!=t[0].AccountID.toString()?parseInt(t[0].AccountID):0,this.Activities.CRMCustomer.Code.Text=t[0].CustomerID.toString()):(this.Activities.CustomerType.SelectedValue="0",this.Activities.OnCustomerTypeChange(null))):this.Activities.CustomerType.Visible=!1,this.Activities.CRMCustomer.Text=t[0].CustomerID.toString(),this.Activities.CRMContactPerson.SelectedValue=n.e.hasprop(t[0],"ContactID")&&!n.e.IsEmpty(t[0].ContactID)?parseInt(t[0].ContactID.toString()):0,this.Activities.Remarks.Text=t[0].Remarks.toString(),this.Activities.StartDate.Date=new Date(t[0].ActStartDate),this.Activities.EndDate.Date=new Date(t[0].ActEndDate),this.Activities.StartTime.SelectedValue=n.e.diffparseDate(t[0].ActStartTime.toString()).ToString("hh:mm:ss a"),this.Activities.EndTime.SelectedValue=n.e.diffparseDate(t[0].ActEndTime.toString()).ToString("hh:mm:ss a"),this.Activities.AssignUserList.SelectedValue=t[0].AssignUserID.toString(),n.e.hasprop(t[0],"StartDateTime")&&!n.e.IsEmpty(t[0].StartDateTime)&&(this.Activities.ActStartDate.Date=new Date(t[0].StartDateTime.toString()).Date(),this.Activities.ActStartTime.AddItem(new Date(t[0].StartDateTime.toString()).ToString("hh:mm:ss a"),new Date(t[0].StartDateTime.toString()).ToString("hh:mm:ss a")),this.Activities.ActStartTime.SelectedValue=new Date(t[0].StartDateTime.toString()).ToString("hh:mm:ss a")),n.e.hasprop(t[0],"EndDateTime")&&!n.e.IsEmpty(t[0].EndDateTime)&&(this.Activities.ActEndDate.Date=new Date(t[0].EndDateTime.toString()).Date(),this.Activities.ActEndTime.AddItem(new Date(t[0].EndDateTime.toString()).ToString("hh:mm:ss a"),new Date(t[0].EndDateTime.toString()).ToString("hh:mm:ss a")),this.Activities.ActEndTime.SelectedValue=new Date(t[0].EndDateTime.toString()).ToString("hh:mm:ss a")),this.Activities.StartStopVisible=this.Activities.EnableStart=!(!n.e.hasprop(t[0],"PrefVal")||"True"!=t[0].PrefVal.toString()),n.e.hasprop(t[0],"TotalDuration")&&!n.e.IsEmpty(t[0].TotalDuration)&&(this.Activities.TotalDuration=parseInt(t[0].TotalDuration.toString())),this.Activities.laststartdate=n.e.hasprop(t[0],"LastStartDate")&&!n.e.IsEmpty(t[0].LastStartDate)?new Date(t[0].LastStartDate.toString()):null,this.Activities.ViewAttachVisible=!1;try{let e=a.a.common.GetDataSet("RCV002",t[0].ActivityID);if(null!=e&&e.Tables.length>0&&e.Tables[0].length>0){let t;this.Activities.ViewAttachVisible=!0,this.Activities.ViewAttachments.AttachmentsList.Clear();for(let i=0;i<e.Tables[0].length;i++)Object(l.j)(e.Tables[0][i].IsProductImage)||(t=new C.AddAttachmentViewModel,t.AddAttachmentViewModel_2(this.Activities),t.AttachmentID=parseInt(e.Tables[0][i].FileID),t.ActualFileName=e.Tables[0][i].ActualFileName.toString(),t.FileExtension=e.Tables[0][i].FileExtension.toString(),t.FileDescription=e.Tables[0][i].FileDescription.toString(),t.FilePath=n.e.GetPath(e.Tables[0][i].GUID.toString()+"."+e.Tables[0][i].FileExtension.toString()),t.Guid=e.Tables[0][i].GUID.toString(),t.RelativeFileName=e.Tables[0][i].RelativeFileName.toString(),t.IsProductImage=Object(l.j)(e.Tables[0][i].IsProductImage),e.Columns[0].Contains("LocationID")&&(t.Location.SelectedValue=parseInt(null==e.Tables[0][i].LocationID?0:e.Tables[0][i].LocationID)),e.Columns[0].Contains("cValidtill")&&""!=e.Tables[0][i].cValidtill.toString()&&(t.Validtill.Date=new Date(e.Tables[0][i].cValidtill),t.ValidTillText=new Date(e.Tables[0][i].cValidtill).ToString(a.a.SessionManager.Preferences["Date Format"])),e.Columns[0].Contains("cIssDate")&&""!=e.Tables[0][i].cIssDate.toString()&&(t.IssueDate.Date=new Date(e.Tables[0][i].cIssDate)),e.Columns[0].Contains("Remarks")&&(t.Remarks.Text=e.Tables[0][i].Remarks.toString()),e.Columns[0].Contains("RefNum")&&(t.RefNum.Text=e.Tables[0][i].RefNum.toString()),e.Columns[0].Contains("DocNo")&&(t.DocNo.Text=e.Tables[0][i].DocNo.toString()),e.Columns[0].Contains("Type")&&""!=e.Tables[0][i].Type.toString()&&(t.AttType.SelectedValue=parseInt(e.Tables[0][i].Type.toString())),e.Columns[0].Contains("status")&&""!=e.Tables[0][i].status.toString()&&(t.stat.SelectedValue=e.Tables[0][i].status.toString()),e.Columns[0].Contains("DivisionID")&&(t.Division.SelectedValue=parseInt(null==e.Tables[0][i].DivisionID?0:e.Tables[0][i].DivisionID)),e.Columns[0].Contains("CreatedBy")&&""!=e.Tables[0][i].CreatedBy.toString()&&(t.CreatedBy=e.Tables[0][i].CreatedBy.toString()),e.Columns[0].Contains("CreatedDate")&&!n.e.IsEmpty(e.Tables[0][i].CreatedDate)&&n.e.isValidDate(e.Tables[0][i].cCreatedDate.toString())&&(t.CreatedDate=new Date(e.Tables[0][i].cCreatedDate.toString()).ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss tt")),e.Columns[0].Contains("ModifiedBy")&&!n.e.IsEmpty(e.Tables[0][i].ModifiedBy)&&(t.ModifiedBy=e.Tables[0][i].ModifiedBy.toString()),e.Columns[0].Contains("ModifiedDate")&&!n.e.IsEmpty(e.Tables[0][i].ModifiedDate)&&n.e.isValidDate(e.Tables[0][i].cModifiedDate.toString())&&(t.ModifiedDate=new Date(e.Tables[0][i].cModifiedDate.toString()).ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss tt")),e.Columns[0].Contains("IsDefaultImage")&&""!=e.Tables[0][i].IsDefaultImage.toString()&&(t.IsDefaultImage=Object(l.j)(e.Tables[0][i].IsDefaultImage)),e.Columns[0].Contains("IsDefaultImage")&&""!=e.Tables[0][i].IsDefaultImage.toString()&&(t.IsDefaultImage=Object(l.j)(e.Tables[0][i].IsDefaultImage)),e.Columns[0].Contains("HasThumb")&&(t.HasThumb=Object(l.j)(e.Tables[0][i].HasThumb)),this.Activities.ViewAttachments.AttachmentsList.push(t))}}catch(d){}this.Activities.ButtonReschedule.Visible="413"!=t[0].ActStatus.toString(),this.Activities.Fields.Clear(),this.Activities.LoadCustomFields(this.CCID),this.Activities.ButtonSave.Visible=t[0].UserName.toString().toLowerCase()!=a.a.SessionManager.UserName.toLowerCase()?a.a.SessionManager.IsActionAssigned(1e3,"Can_edit_All_Activities"):a.a.SessionManager.IsActionAssigned(1e3,"Activity_Edit");let e,i=null,s=null,r=null,o=null,u=null,c=null;for(let a=0;a<this.Activities.Fields.length;a++){let l=this.Activities.Fields[a];if(l instanceof m.d&&(i=l,i.Text=t[0][i.SysColumnName].toString()),l instanceof p.b){u=l;try{u.Date=new Date(t[0][u.SysColumnName].toString())}catch(d){let t=new Date;u.Date=new Date(1900,1,1,t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds())}}else if(l instanceof p.a){let e;s=l,""!=t[0][s.SysColumnName].toString()&&n.e.isValidDate(t[0][s.SysColumnName].toString())&&(e=t[0][s.SysColumnName].toString(),s.Date=e)}l instanceof h.e&&(r=l,r.SelectedValue=t[0][r.SysColumnName].toString()),l instanceof y.a&&(c=l,c.TextBox.Text=t[0][c.SysColumnName].toString()),l instanceof m.c&&(o=l,o.Text=t[0][o.SysColumnName].toString()),l instanceof T.b&&(e=l,e.SelectedValue=n.e.hasprop(t[0],e.SysColumnName+"_Key")&&null!=t[0][e.SysColumnName+"_Key"]&&""!=t[0][e.SysColumnName+"_Key"].toString()?parseInt(t[0][e.SysColumnName+"_Key"]):0)}this.Activities.IsPopup?(this.ActVisibility=!1,this.ActivitiesPopup=this.Activities,a.a.page.ShowDialog(this.ActivitiesPopup,b.ActivitiesComponent,{ShowCenter:!0})):(this.ActVisibility=!0,a.a.page.ShowDialog(this.Activities,b.ActivitiesComponent,{})),this.Activities.SetActions();try{""!=t[0].NodeID.toString()&&0!=parseInt(t[0].NodeID)&&this.Activities.FilterSupplierBasedonCRMProduct(this.CCID,parseInt(t[0].NodeID))}catch(S){}}DeleteData(t){if(null!=t){this.Activities.ActivityID=parseInt(t[0].ActivityID.toString()),this.Activities.ActivityType.SelectedValue=t[0].ActivityTypeID.toString(),this.ActivityID=this.Activities.ActivityID,this.CCID=parseInt(t[0].CostCenterID);let e=!1;if(e=a.a.SessionManager.IsActionAssigned(1e3,"Activity_Delete"),!e)return;if(this.res=confirm("Are you Sure You Want To Delete this Activity ?")?"Yes":"No","Yes"==this.res){let t=(new A.a).DeleteActivity(this.ActivityID,this.CCID);this.MessageVisibility=!0,this.DisplayMessage=t.RetValue>0?t.Message:"",this.ActivityID=0,this.res=""}else this.DisplayMessage=""}}OnMessageCallBack(){this.res="Yes"}RadioButtonChanged(t){let e=this.MonthlyData;for(let i=0;i<e.length;i++)if(e[i].Visible=!1,"Summary"==t.toString()){if(e[i].Cells.length>1)for(let t=1;t<e[i].Cells.length;t++)if(null!=e[i].Cells[t].Value&&!n.e.IsEmpty(e[i].Cells[t].Value.toString())){e[i].Visible=!0;break}}else e[i].Visible=!0;this.MonthlyData=e}getToday(t){if("timeGridDay"==t.toString()){this.TempCurrDate=new Date;try{this.BuildFilter(),this.dset=this.ReturnDataset(this.CCID,this.iStatus,this.Type,0,this.TempCurrDate,null,null,this.Subject)}catch(e){}this.CurrDate=this.TempCurrDate.getDayName.toString()+", "+this.TempCurrDate.getMonth()+" "+this.TempCurrDate.getDate()+", "+this.TempCurrDate.getFullYear(),this.UIDate=this.TempCurrDate,this.GoToDate.Date=this.TempCurrDate,this.LoadDayViewData()}else if("dayGridMonth"==t.toString())this.TempCurrMonth=new Date,this.BuildFilter(),this.dset=this.ReturnDataset(this.CCID,this.iStatus,this.Type,0,this.TempCurrMonth,null,null,this.Subject),this.MonthViewData();else if("timeGridWeek"==t.toString()){this.TempCurrWeek=(new Date).AddDays(7),this.dtEndDate=(new Date).AddDays(6);try{this.BuildFilter(),this.dset=this.ReturnDataset(this.CCID,this.iStatus,this.Type,0,this.TempCurrWeek,this.TempCurrWeek,this.dtEndDate,this.Subject)}catch(i){}this.CurrWeek=this.TempCurrWeek.toLocaleDateString()+"  -  "+this.dtEndDate.toLocaleDateString(),this.WeekViewData()}}onCheckChange(t,e=-1){if("timeGridDay"==t.toString()&&1==e){this.TempCurrDate=this.TempCurrDate.AddDays(1);try{this.BuildFilter(),this.dset=this.ReturnDataset(this.CCID,this.iStatus,this.Type,0,this.TempCurrDate,null,null,this.Subject)}catch(i){}this.CurrDate=this.TempCurrDate.getDayName.toString()+", "+this.TempCurrDate.getMonth()+" "+this.TempCurrDate.getDate()+", "+this.TempCurrDate.getFullYear(),this.UIDate=this.TempCurrDate,this.GoToDate.Date=this.TempCurrDate,this.LoadDayViewData()}else if("timeGridDay"==t.toString()&&-1==e){this.TempCurrDate=this.TempCurrDate.AddDays(-1);try{this.BuildFilter(),this.dset=this.ReturnDataset(this.CCID,this.iStatus,this.Type,0,this.TempCurrDate,null,null,this.Subject)}catch(s){}this.CurrDate=this.TempCurrDate.getDayName.toString()+", "+this.TempCurrDate.getMonth()+" "+this.TempCurrDate.getDate()+", "+this.TempCurrDate.getFullYear(),this.LoadDayViewData(),this.UIDate=this.TempCurrDate,this.GoToDate.Date=this.TempCurrDate}else if("dayGridMonth"==t.toString())this.TempCurrMonth=this.TempCurrMonth.AddMonths(e),this.BuildFilter(),this.dset=this.ReturnDataset(this.CCID,this.iStatus,this.Type,0,this.TempCurrMonth,null,null,this.Subject),this.MonthViewData();else if("timeGridWeek"==t.toString()&&1==e){this.TempCurrWeek=this.TempCurrWeek.AddDays(7),this.dtEndDate=this.TempCurrWeek.AddDays(6);try{this.BuildFilter(),this.dset=this.ReturnDataset(this.CCID,this.iStatus,this.Type,0,this.TempCurrWeek,this.TempCurrWeek,this.dtEndDate,this.Subject)}catch(a){}this.CurrWeek=this.TempCurrWeek.toLocaleDateString()+"  -  "+this.dtEndDate.toLocaleDateString(),this.WeekViewData()}else if("timeGridWeek"==t.toString()&&-1==e){this.TempCurrWeek=this.TempCurrWeek.AddDays(-7),this.dtEndDate=this.TempCurrWeek.AddDays(6);try{this.BuildFilter(),this.dset=this.ReturnDataset(this.CCID,this.iStatus,this.Type,0,this.TempCurrWeek,this.TempCurrWeek,this.dtEndDate,this.Subject)}catch(n){}this.CurrWeek=this.TempCurrWeek.toLocaleDateString()+"  -  "+this.dtEndDate.toLocaleDateString(),this.WeekViewData()}else if("Refresh"==t.toString()){this.TempCurrWeek=this.TempCurrWeek.AddDays(-7),this.dtEndDate=this.TempCurrWeek.AddDays(6);try{this.TempCurrWeek.getMonth()!=this.dtEndDate.getMonth()&&(this.BuildFilter(),this.dset=this.ReturnDataset(this.CCID,this.iStatus,this.Type,0,this.TempCurrWeek,this.TempCurrWeek,this.dtEndDate,this.Subject))}catch(l){}this.CurrWeek=this.TempCurrWeek.toLocaleDateString()+"  -  "+this.dtEndDate.toLocaleDateString(),this.WeekViewData()}}OnDateChanged(t){if(this.GoToDate.Date!=this.UIDate){this.TempCurrDate=this.GoToDate.Date;try{this.BuildFilter(),this.dset=this.ReturnDataset(this.CCID,this.iStatus,this.Type,0,this.TempCurrDate,null,null,this.Subject)}catch(e){}this.CurrDate=this.TempCurrDate.getDayName.toString()+", "+this.TempCurrDate.getMonth()+" "+this.TempCurrDate.getDate()+", "+this.TempCurrDate.getFullYear(),this.UIDate=this.TempCurrDate,this.LoadDayViewData()}}onSelectionChanged(t){if(Logger.InfoLog("RCalenderViewModel:: onSelectionChanged Begin"),!this.IgnoreSelectionChange)try{this.CostCenterID=parseInt(this.Features.SelectedValue),this.BuildFilter(),this.dset=this.ReturnDataset(this.CCID,this.iStatus,this.Type,0,this.UIDate,null,null,this.Subject),this.LoadDayViewData(),this.WeekViewData(),this.MonthViewData(),this.ActivityID=0,this.Activities.ClearFields(),this.Activities.Recur=new c.RecurAppointmentViewModel(this.Activities),this.ActVisibility=!this.Activities.IsPopup,1e3==parseInt(this.Features.SelectedValue)?this.Activities.CustomerType.Visible=!0:(this.Activities.CustomerType.Visible=!1,null!=this.Activities.CRMCustomer.Code&&this.Activities.CRMCustomer.Code.Visible&&(this.Activities.CRMCustomer.Code.Visible=!1,this.Activities.CRMCustomer.TextVisible=!0))}catch(e){Logger.InfoLog("RCalenderViewModel:: onSelectionChanged Exception"+e)}}OnCellEditEnding(t){}customQueryFilter(t){let e=t;if(null!=this.Userlist&&null!=this.Userlist.SelectedValue&&"-100"!=this.Userlist.SelectedValue){let i=this.dset.Tables[1].filter(t=>t.USERID==this.Userlist.SelectedValue);e=t.filter(i.length>0?t=>t.ActStartDate>=new Date(this.CurrDate).ToString("dd/MMM/yyyy")&&t.ActStartDate<new Date(this.CurrDate).AddDays(1).ToString("dd/MMM/yyyy")&&t.AssignUserID==this.Userlist.SelectedValue&&i.map(t=>t.ISFROMACTIVITY).some(e=>e.Contains(t.ActivityId)):t=>t.ActStartDate>=new Date(this.CurrDate).ToString("dd/MMM/yyyy")&&t.ActStartDate<new Date(this.CurrDate).AddDays(1).ToString("dd/MMM/yyyy")&&t.AssignUserID==this.Userlist.SelectedValue)}else e=t.filter(t=>t.ActStartDate>=new Date(this.CurrDate).ToString("dd/MMM/yyyy")&&t.ActStartDate<new Date(this.CurrDate).AddDays(1).ToString("dd/MMM/yyyy"));return e}LoadDayViewData(){let t="",e="",i=!1,s=!1,a=0,r=[];if(null!=this.Userlist&&null!=this.Userlist.SelectedValue&&"-100"!=this.Userlist.SelectedValue){let t=this.dset.Tables[1].filter(t=>t.USERID==this.Userlist.SelectedValue);if(t.length>0){let i="";t.forEach(t=>{0==i.length?(r=this.dset.Tables[0].filter(e=>e.ActivityId==t.ISFROMACTIVITY),i="(ActivityId ='"+t.ISFROMACTIVITY+"'"):(r=this.dset.Tables[0].filter(e=>e.ActivityId==t.ISFROMACTIVITY),i=i+" or ActivityId ='"+t.ISFROMACTIVITY+"' ")}),i.length>0&&(i+=")"),e=" AND "+i}else e=" AND  AssignUserID='"+this.Userlist.SelectedValue+"' "}t=""!=e?"ActStartDate>='"+new Date(this.CurrDate).ToString("dd/MMM/yyyy")+"' AND ActStartDate<'"+new Date(this.CurrDate).AddDays(1).ToString("dd/MMM/yyyy")+"'"+e:"ActStartDate>='"+new Date(this.CurrDate).ToString("dd/MMM/yyyy")+"' AND ActStartDate<'"+new Date(this.CurrDate).AddDays(1).ToString("dd/MMM/yyyy")+"'",this.DayColumns.Clear();let h={Alignment:"Left",FontFamilyName:"Arial",FontSize:12,BackColor:"White",ForeColor:"Black"},u=[];u.push(this.GetColumn("C0","Time Of Day","STRING",h,100)),e="";let c=0,d="08:00:00 AM",S="08:00:00 AM";if(null!=this._ScreenObject.Data&&this._ScreenObject.Data.Tables.length>4){let t=this.ScreenObject.Data.Tables[4].filter(t=>"ActivityDuration"==t.Name);null!=t&&t.length>0&&!n.e.IsEmpty(t[0].Value.toString())&&(c=parseInt(t[0].Value.toString())),t=this.ScreenObject.Data.Tables[4].filter(t=>"DayViewRepeatOn"==t.Name),null!=t&&t.length>0&&!n.e.IsEmpty(t[0].Value.toString())&&parseInt(t[0].Value.toString())>5e4&&(e="CCNID"+(parseInt(t[0].Value.toString())-5e4)),t=this.ScreenObject.Data.Tables[4].filter(t=>"ShowAllRepeatNodes"==t.Name),null!=t&&t.length>0&&!n.e.IsEmpty(t[0].Value.toString())&&(i=Object(l.j)(t[0].Value.toString())),t=this.ScreenObject.Data.Tables[4].filter(t=>"DonotOverlapActivities"==t.Name),null!=t&&t.length>0&&!n.e.IsEmpty(t[0].Value.toString())&&(s=Object(l.j)(t[0].Value.toString())),t=this.ScreenObject.Data.Tables[4].filter(t=>"DayViewColumnWidth"==t.Name),null!=t&&t.length>0&&!n.e.IsEmpty(t[0].Value.toString())&&(a=parseInt(t[0].Value.toString())),t=this.ScreenObject.Data.Tables[4].filter(t=>"ActivityStartTime"==t.Name),null!=t&&t.length>0&&!n.e.IsEmpty(t[0].Value.toString())&&(d=t[0].Value.toString()),t=this.ScreenObject.Data.Tables[4].filter(t=>"ActivityEndTime"==t.Name),null!=t&&t.length>0&&!n.e.IsEmpty(t[0].Value.toString())&&(S=t[0].Value.toString()),a>0||(a=150)}n.e.IsEmpty(e)?""==e&&u.push(this.GetColumn("C2","Activity","CONTROL",h,150)):i&&null!=this._ScreenObject.Data&&this._ScreenObject.Data.Tables.length>6&&this._ScreenObject.Data.Tables[6].length>0?this._ScreenObject.Data.Tables[6].forEach(t=>u.push(this.GetColumn("C"+t.NodeID.toString(),t.Name.toString(),"CONTROL",h,a))):null!=this.dset&&this.dset.Tables.length>0&&this.dset.Tables[0].length>0&&this.customQueryFilter(this.dset.Tables[0]).length>0&&this.customQueryFilter(this.dset.Tables[0]).ToTable(!0,e+"_Key",e).Rows.forEach(t=>u.push(this.GetColumn("C"+t[e+"_Key"].toString(),t[e].toString(),"CONTROL",h,a))),this.DayColumns=u,this.MonthlyData.Clear();let C=null,m=null;0==c&&(c=30);let D=n.e.diffparseDate(Date.Today().ToString("dd/MMM/yyyy")+" "+S).Subtract(n.e.diffparseDate(Date.Today().ToString("dd/MMM/yyyy")+" "+d)).TotalMinutes/c;D<=0&&(D=1440/c+D);for(let l=0;l<D;l++)C=new o.d(this.DayColumns.length,30),C.Cells[0].Text=n.e.diffparseDate(Date.Today().ToString("dd/MMM/yyyy")+" "+d).AddMinutes(l*c).ToString("hh:mm:ss ss"),this.MonthlyData.push(C);if(null!=this.dset&&this.dset.Tables.length>0&&this.dset.Tables[0].length>0){let t=[];if(t=this.customQueryFilter(this.dset.Tables[0]),t.length>0)for(let i=0;i<t.length;i++)if(s){var g=this.MonthlyData.filter(e=>new Date("01-JAN-1900 "+e.Cells[0].Text)>=new Date(t[i].ActStartTime)&&new Date("01-JAN-1900 "+e.Cells[0].Text)<new Date(t[i].ACTEndTime));g.forEach(s=>{C=s,C.DataRow=t[0],C.Cells.length>2?(m=this.DayColumns.find(s=>s.ID=="C"+t[i][e+"_Key"].toString()),C.Cells[this.DayColumns.indexOf(m)].Value+=","+t[i].ActivityID.toString(),g.First()==s&&(C.Cells[this.DayColumns.indexOf(m)].Text+=",0~"+t[i].ActivityID.toString())):(C.Cells[1].Value+=","+t[i].ActivityID.toString(),g.First()==s&&(C.Cells[1].Text+=",0~"+t[i].ActivityID.toString()))}),null==g&&(C=new o.d(this.DayColumns.length,80),C.Cells[0].Text=new Date(t[i].ActStartTime).ToString("hh:mm:ss ss"),C.Cells.length>2?(m=this.DayColumns.find(s=>s.ID=="C"+t[i][e+"_Key"].toString()),C.Cells[this.DayColumns.indexOf(m)].Value+=","+t[i].ActivityID.toString(),C.Cells[this.DayColumns.indexOf(m)].Text+=",0~"+t[i].ActivityID.toString()):(C.Cells[1].Value+=","+t[i].ActivityID.toString(),C.Cells[1].Text+=",0~"+t[i].ActivityID.toString()),this.MonthlyData.push(C))}else C=this.MonthlyData.find(e=>e.Cells[0].Text==new Date(t[i].ActStartTime).ToString("hh:mm:ss ss")),C.DataRow=t[0],null!=C?C.Cells.length>2?(m=this.DayColumns.find(s=>s.ID=="C"+t[i][e+"_Key"].toString()),C.Cells[this.DayColumns.indexOf(m)].Value+=","+t[i].ActivityID.toString(),C.Cells[this.DayColumns.indexOf(m)].Text+=",0~"+t[i].ActivityID.toString()):(C.Cells[1].Value+=","+t[i].ActivityID.toString(),C.Cells[1].Text+=",0~"+t[i].ActivityID.toString()):(C=new o.d(this.DayColumns.length,80),C.Cells[0].Text=new Date(t[i].ActStartTime).ToString("hh:mm:ss ss"),C.Cells.length>2?(m=this.DayColumns.find(s=>s.ID=="C"+t[i][e+"_Key"].toString()),C.Cells[this.DayColumns.indexOf(m)].Value+=","+t[i].ActivityID.toString(),C.Cells[this.DayColumns.indexOf(m)].Text+=",0~"+t[i].ActivityID.toString()):(C.Cells[1].Value+=","+t[i].ActivityID.toString(),C.Cells[1].Text+=",0~"+t[i].ActivityID.toString()),this.MonthlyData.push(C))}}GetColumn(t,e,i,s,n){let l=new o.b;l.DateType=a.a.SessionManager.Preferences["Date Format"];let h=new r.b;return h.gridLines=3,h.ID=t,h.FieldName=t,h.HeaderText=a.a.GetResource(e),h.HeaderAppearance={Alignment:"Center",FontFamilyName:"Arial",FontSize:12,IsBold:!0,BackColor:"White",ForeColor:"Black"},h.DataAppearance=s,h.HeaderHeight=22,h.width=n,h.DataFormat=l,h.ColumnType=i,h}MoveItem(t){switch(t){case"Left1":-1!=this.LOSelectedIndex&&(this.lstOwnersRight.Insert(this.lstOwnersRight.length,this.lstOwnersLeft[this.LOSelectedIndex]),this.lstOwnersLeft.RemoveAt(this.LOSelectedIndex));break;case"Right1":-1!=this.ROSelectedIndex&&(this.lstOwnersLeft.Insert(this.lstOwnersLeft.length,this.lstOwnersRight[this.ROSelectedIndex]),this.lstOwnersRight.RemoveAt(this.ROSelectedIndex))}}FillOwnersLeftList(){this.lstOwnersLeft=[],this.lstOwnersRight=[];let t=new F;t.SysColumn="Customer",t.UserColumnName="Customer",this.lstOwnersLeft.push(t),t=new F,t.SysColumn="Subject",t.UserColumnName="Subject",this.lstOwnersLeft.push(t),t=new F,t.SysColumn="Status",t.UserColumnName="Status",this.lstOwnersLeft.push(t),t=new F,t.SysColumn="Location",t.UserColumnName="Location",this.lstOwnersLeft.push(t),t=new F,t.SysColumn="Remarks",t.UserColumnName="Remarks",this.lstOwnersLeft.push(t),t=new F,t.SysColumn="StartTime",t.UserColumnName="StartTime",this.lstOwnersLeft.push(t),t=new F,t.SysColumn="EndTime",t.UserColumnName="EndTime",this.lstOwnersLeft.push(t)}BuildTempDataTable(){this.ScreenObject.LoadScreen_2(this,1e3),267==this.FeatureID?this.ViewType.Items.push(h.d.ComboBoxItems_2("MonthView","1")):(this.ViewType.Items.push(h.d.ComboBoxItems_2("MonthView","1")),this.ViewType.Items.push(h.d.ComboBoxItems_2("DayView","2")),this.ViewType.Items.push(h.d.ComboBoxItems_2("WeekView","3"))),this.ViewType.SelectedValue="1";let t=null,e=this.ScreenObject.Data.Tables[4].filter(t=>"CalendarFeaturesList"==t.Name);if(null!=e&&e.length>0&&null!=e&&e.length>0&&(t=e[0].Value.toString().split(";")),e=this.ScreenObject.Data.Tables[4].filter(t=>"ActivityAsPopup"==t.Name),null!=e&&e.length>0&&(this.Activities.IsPopup=""!=e[0].Value.toString()&&"True"==e[0].Value.toString(),this.ActVisibility=!this.Activities.IsPopup),267==this.FeatureID){let t=a.a.common.GetDataTable("RCAL001","");if(null!=t&&t.length>0)for(let e=0;e<t.length;e++)this.Features.Items.push(h.d.ComboBoxItems_2(t[e].Name.toString(),t[e].FeatureID.toString()));this.Features.SelectedValue="40089"}else{if(this.Features.Items.push(h.d.ComboBoxItems_2("All","-100")),this.Features.Items.push(h.d.ComboBoxItems_2("Calendar","1000")),null!=t&&t.length>0)for(let e=0;e<t.length;e++)"86"==t[e].toString()?this.Features.Items.push(h.d.ComboBoxItems_2("Leads","86")):"73"==t[e].toString()?this.Features.Items.push(h.d.ComboBoxItems_2("Cases","73")):"88"==t[e].toString()?this.Features.Items.push(h.d.ComboBoxItems_2("Campaign","88")):"89"==t[e].toString()?this.Features.Items.push(h.d.ComboBoxItems_2("Opportunity","89")):"83"==t[e].toString()?this.Features.Items.push(h.d.ComboBoxItems_2("CRM-Customers","83")):"65"==t[e].toString()?this.Features.Items.push(h.d.ComboBoxItems_2("Contacts","65")):"122"==t[e].toString()?this.Features.Items.push(h.d.ComboBoxItems_2("FollowUp","122")):"94"==t[e].toString()?this.Features.Items.push(h.d.ComboBoxItems_2("Tenant","94")):"95"==t[e].toString()?this.Features.Items.push(h.d.ComboBoxItems_2("Sales Contract","95")):"128"==t[e].toString()?this.Features.Items.push(h.d.ComboBoxItems_2("Campaign Events","128")):this.ScreenObject.Data.Tables[8].length>0&&this.ScreenObject.Data.Tables[8].forEach(i=>{t[e].toString()!=i.CostCenterID.toString()||this.Features.Items.push(h.d.ComboBoxItems_2(i.DocumentName.toString(),i.CostCenterID.toString()))});this.Features.SelectedValue="-100"}if(this.Status.Items.push(h.d.ComboBoxItems_2("All","-100")),this.Status.Items.push(h.d.ComboBoxItems_2("Open","412")),this.Status.Items.push(h.d.ComboBoxItems_2("Confirmed","8")),this.Status.Items.push(h.d.ComboBoxItems_2("Close","413")),this.Status.Items.push(h.d.ComboBoxItems_2("Re-Schedule","414")),this.Status.Items.push(h.d.ComboBoxItems_2("Open/Re-Schedule","-101")),this.Status.SelectedValue="-101",this.ScreenObject.Data.Columns[7].Contains("CalendarXML")&&this.ScreenObject.Data.Tables[7].length>0&&""!=n.e.StringValue(this.ScreenObject.Data.Tables[7][0][this.ScreenObject.Data.Columns[7][0]])){new n.f;let t=new n.f;t.LoadXml(this.ScreenObject.Data.Tables[7][0][this.ScreenObject.Data.Columns[7][0]].toString()),null!=t&&("DefaultView"==t.DocumentElement.children[0].attributes[0].name&&(this.ViewType.SelectedValue=t.DocumentElement.children[0].attributes[0].value,this.onCheckChange("")),"FeatureDefaultView"==t.DocumentElement.children[0].attributes[1].name&&(this.Features.SelectedValue=267==this.FeatureID?"40089":t.DocumentElement.children[0].attributes[1].value),"DefaultStatus"==t.DocumentElement.children[0].attributes[2].name&&(this.Status.SelectedValue=t.DocumentElement.children[0].attributes[2].value))}else e=this.ScreenObject.Data.Tables[4].filter(t=>"CalendarDefaultView"==t.Name),null!=e&&e.length>0&&(this.ViewType.SelectedValue=null!=e[0].Value&&""!=e[0].Value.toString()?e[0].Value.toString():"1",this.onCheckChange("")),e=this.ScreenObject.Data.Tables[4].filter(t=>"DefaultStatus"==t.Name),null!=e&&e.length>0&&(this.Status.SelectedValue=null!=e[0].Value&&""!=e[0].Value.toString()?e[0].Value.toString():"101"),e=this.ScreenObject.Data.Tables[4].filter(t=>"FeatureDefaultView"==t.Name),null!=e&&e.length>0&&(this.Features.SelectedValue=267==this.FeatureID?null!=e[0].Value&&""!=e[0].Value.toString()?e[0].Value.toString():"40089":null!=e[0].Value&&""!=e[0].Value.toString()?e[0].Value.toString():"-100");this.ShowType.Items.push(h.d.ComboBoxItems_2("All","-100")),this.ShowType.Items.push(h.d.ComboBoxItems_2("All Appointments","-200")),this.ShowType.Items.push(h.d.ComboBoxItems_2("All Tasks","-300")),this.ShowType.Items.push(h.d.ComboBoxItems_2("My Appointments","-400")),this.ShowType.Items.push(h.d.ComboBoxItems_2("My Tasks","-500")),this.ShowType.Items.push(h.d.ComboBoxItems_2("Assigned Appointments","-600")),this.ShowType.Items.push(h.d.ComboBoxItems_2("Assigned Tasks ","-700")),this.ShowType.SelectedValue="-100",this.CustomizeVisibility=!1;let i=a.a.common.GetDataSetQuery(" EXEC spADM_GetUserNameIDbyOwner "+a.a.SessionManager.UserID+" ");if(this.Userlist.Items.push(h.d.ComboBoxItems_2("All","-100")),null!=i&&i.Tables.length>0&&i.Tables[0].length>0&&i.Columns[0].Contains("UserName"))for(let s=0;s<i.Tables[0].length;s++)this.Userlist.Items.push(h.d.ComboBoxItems_2(i.Tables[0][s].UserName.toString(),i.Tables[0][s].UserID.toString()));this.Userlist.SelectedValue="-100",this.FillOwnersLeftList(),this.onSelectionChanged("")}WeekViewData(){let t=null;this.WeekData.Clear();let e=[];null!=this.dset&&this.dset.Tables.length>0&&this.dset.Tables[0].length>0&&(e=this.dset.Tables[0]);let i=0,s=0,a=this.dtEndDate.getDate()-this.TempCurrWeek.getDate()+1,n=this.TempCurrWeek,l="";for(let r=1;r<=a;r++){if(t={},t.Label=this.arrWeekName[i]+"  "+n.toLocaleDateString(),t.Column="0",t.Row=s.toString(),t.LabelCollection=[],l="ActStartDate>='"+new Date(n).ToString("dd/MMM/yyyy")+"' AND  ActStartDate<'"+new Date(n).AddDays(1).ToString("dd/MMM/yyyy")+"' ",null!=this.Userlist&&null!=this.Userlist.SelectedValue&&"-100"!=this.Userlist.SelectedValue&&(l+=" AND AssignUserID='"+this.Userlist.SelectedValue+"'"),e.length>0)for(let i=0;i<e.length;i++){let s=new D.a;s.Row=i.toString(),s.Column="0",s.ColumnSpan="3",s.Label=e[i].ActSubject.toString()+", Customer:"+e[i].CustomerID.toString()+", Time:"+e[i].ActStartTime.toString(),s.ClickCommand.Subscribe(this,"onClick"),s.DBColumnName=e[i].ActivityID.toString(),t.LabelCollection.push(s)}else{let e=new D.a;e.Row="0",e.Column="0",e.Label=" No Appointments ",t.LabelCollection.push(e)}s++,i++,this.WeekData.push(t),n=n.AddDays(1)}}onClick_1(t){if(null!=t){let e=[];null!=this.dset&&this.dset.Tables.length>0&&this.dset.Tables[0].length>0&&(e=this.dset.Tables[0].DefaultView),e.filter(e=>e.ActivityID==t.toString()),e.length>0&&this.LoadData(e)}}onClick(){if(null!=this.SelectedVoucher){let t=[];null!=this.dset&&this.dset.Tables.length>0&&this.dset.Tables[0].length>0&&(t=this.dset.Tables[0].DefaultView),t.filter(t=>t.ActivityID==this.SelectedVoucher.ActivityID),t.length>0&&this.LoadData(t)}}OnDataClick(t){if(null!=t.Content&&"Delete"==t.Content){let e=[];null!=this.dset&&this.dset.Tables.length>0&&this.dset.Tables[0].length>0&&(e=this.dset.Tables[0].DefaultView),e.filter(e=>e.ActivityID==t.ColumnIndex),null!=e&&e.length>0&&(this.DeleteData(e),null!=this.LoadUICallBack&&this.LoadUICallBack.Call(!0))}else this.onClick_1(t.Content)}BuildFilter(){n.e.IsEmpty(this.Features.SelectedValue)||"0"==this.Features.SelectedValue.toString()||(this.CCID=parseInt(this.Features.SelectedValue)),n.e.IsEmpty(this.Status.SelectedValue)||"0"==this.Status.SelectedValue.toString()||(this.iStatus=parseInt(this.Status.SelectedValue)),n.e.IsEmpty(this.ShowType.SelectedValue)||"0"==this.ShowType.SelectedValue.toString()||(this.Type=parseInt(this.ShowType.SelectedValue)),null!=this.FSubject&&null!=this.FSubject.Text&&(this.Subject=this.FSubject.Text)}MonthViewData(){let t;if(this._myAppointmentsList.Clear(),this.CurrMonth=this.TempCurrMonth.getMonthName()+" - "+this.TempCurrMonth.getFullYear(),267!=this.FeatureID){if(null!=this.dset&&this.dset.Tables.length>0){var e=this.dset.Tables[0].filter(t=>"1=1"+this.CCFilter);let i;if(i=e.length>0?e:this.dset.Tables[0],null!=this.Userlist.SelectedValue&&"-100"!=this.Userlist.SelectedValue){let t=this.dset.Tables[1];if(t=t.filter(t=>t.USERID==this.Userlist.SelectedValue),t.length>0){let e="";t.forEach(t=>{e=0==e.length?t.ISFROMACTIVITY:e+","+t.ISFROMACTIVITY}),i=i.filter(e=>t.map(t=>t.ISFROMACTIVITY).Contains(e.ActivityID))}else i=i.filter(t=>t.AssignUserID==this.Userlist.SelectedValue||t.UserName==this.Userlist.Items.find(t=>t.Value==this.Userlist.SelectedValue).Name)}if(i.forEach(e=>{t=null!=e.ActStartDate&&""!=e.ActStartDate.toString()&&null!=e.ActStartDate.toString()?new Date(e.ActStartDate):new Date;let i={};i.AppointmentID=parseInt(e.ActivityID),i.StartTime=t,this.dset.Columns[0].Contains("UserName")&&(i.UserName=n.e.StringValue(e.UserName)),i.stDate=n.e.StringValue(e.ActStartDate),i.stTime=n.e.StringValue(e.ActStartTime),i.enDate=n.e.StringValue(e.ActEndDate),i.enTime=n.e.StringValue(e.ActEndTime),i.Status=n.e.StringValue(e.ActStatus),"412"==i.Status?i.StatusText="Open":"413"==i.Status?i.StatusText="Close":"414"==i.Status?i.StatusText="Re-Schedule":"Confirmed"==i.Status&&(i.StatusText="Confirmed"),i.Location=n.e.StringValue(e.Location),i.Subject=n.e.StringValue(e.ActSubject),i.Customer=n.e.StringValue(e.CustomerID),this._myAppointmentsList.push(i)}),this.dset.Tables.length>2)for(let t=0;t<this.dset.Tables[2].length;t++){let e={};e.AppointmentID=parseInt(this.dset.Tables[2][t].NodeID.toString()),e.StartTime=new Date(this.dset.Tables[2][t].startdate.toString()),e.IsProjectActivity=!0,e.UserName=a.a.SessionManager.UserName,e.stDate=n.e.StringValue(this.dset.Tables[2][t].startdate),e.stTime=Date.Today().toString(),e.enDate=n.e.StringValue(this.dset.Tables[2][t].enddate),e.enTime=Date.Today().toString(),e.Status=n.e.StringValue(this.dset.Tables[2][t].StatusID),"475"==e.Status?e.StatusText="In Process":"473"==e.Status?e.StatusText="Close":"474"==e.Status?e.StatusText="Hold":"472"==e.Status&&(e.StatusText="Open"),e.Location="",e.Subject=n.e.StringValue(this.dset.Tables[2][t].Code),e.Customer="",e.CCID=parseInt(this.dset.Tables[2][t].ccid.toString()),this._myAppointmentsList.push(e)}}if(null!=this.RefreshMonthView&&this.RefreshMonthView.Call(),this.getEvents(),!n.e.IsEmpty(this.CalenderControl)){let t=this.CalenderControl.calendarComponent.getApi();t.removeAllEventSources(),t.addEventSource(this.EventData),Array.from(this.CalenderControl.elementref.nativeElement.getElementsByClassName("fc-daygrid-event-harness")).forEach(t=>{t.addEventListener("contextmenu",this.CalenderControl.onRightClick.bind(this.CalenderControl)),t.addEventListener("dblclick",this.CalenderControl.ondblClick.bind(this.CalenderControl))})}}else{let t=a.a.common.GetDataTable("RCAL002","");if(null!=t&&t.length>0)for(let e=0;e<t.length;e++){let i={};i.AppointmentID=parseInt(t[e].InvDocDetailsID),n.e.IsEmpty(t[e].dcAlpha1)||(i.StartTime=new Date(t[e].dcAlpha1)),i.UserName=t[e].CreatedBy.toString(),n.e.IsEmpty(t[e].dcAlpha1)||(i.stDate=new Date(t[e].dcAlpha1).ToString(a.a.SessionManager.Preferences["Date Format"]),i.stTime=new Date(t[e].dcAlpha2).ToString("HH:mm")),n.e.IsEmpty(t[e].dcAlpha3)||(i.enDate=new Date(t[e].dcAlpha3).ToString(a.a.SessionManager.Preferences["Date Format"]),i.enTime=new Date(t[e].dcAlpha4).ToString("HH:mm")),i.Status=t[e].StatusID.toString(),i.StatusText=t[e].Status.toString(),i.Subject="Attendance",i.Customer=t[e].EmpCode.toString()+" - "+t[e].EmpName.toString(),i.CCID=40089,this._myAppointmentsList.push(i)}}}ReLoad(t){return t&&this.onSelectionChanged(""),!1}}class N extends I.b{constructor(){super(),this.ButtonClick=new g.b,this.CheckedChanged=new g.b}get DayNumberLabel(){return this._DayNumberLabel}set DayNumberLabel(t){t!=this._DayNumberLabel&&(this._DayNumberLabel=t)}get DayAppointmentsStack(){return this._DayAppointmentsStack}set DayAppointmentsStack(t){t!=this._DayAppointmentsStack&&(this._DayAppointmentsStack=t)}DayTemplate_1(t,e){this.DayNumberLabel=t,this.Parent=e}DayTemplate_2(t,e,i){this.DayAppointmentsStack=t,this.Parent=i}}class F{}class x extends I.b{constructor(){super(),this.CheckChanged=new g.b,this.SelectedNodes=null,this.SelectedNode=null,this.SelectAllDocuments=!1,this.SelectAllDocVisible=!0,this.NodeSelectedCallBack=null}set ClearSelectedNodes(t){this.tree.length>0&&(this.tree[0].ClearAllSelectedNodes=!this.tree[0].ClearAllSelectedNodes)}CommandController(t){"MouseDoubleClick"==t.toString()&&(null==this.SelectedNode||this.SelectedNode.IsGroup||this.tree[0].SelectNode())}Refresh(){null!=this.tree&&this.tree.length>0&&(this.tree[0].RefreshData=!0)}OnNodeSelected(){let t=null;this.CostCenterFilters.forEach(e=>{e.CostCenterID==this.tree[0].CostCenterID&&(t=e)});try{if(null==t&&(t=new R,t.CalCostCenterFilter_1(this.tree[0].CostCenterID,this.CostCenters.SelectedItem.Name,this),this.CostCenterFilters.push(t)),0==this.SelectedNodes.length)t.SelectedNodesTag="";else{t.SelectedNodes=this.SelectedNodes;let e="";this.SelectedNodes.forEach(t=>{t.Text.length>0&&!n.e.IsEmpty(t.Text[0])&&(e=""!=e?e+", "+t.Text[0]:t.Text[0],e.length>140)&&(e+=" . . .")}),0==e.length&&(e="["+a.a.GetResource("Filter").toString().toUpperCase()+"]"),t.SelectedNodesTag=e}}catch(e){}null!=this.NodeSelectedCallBack&&this.NodeSelectedCallBack.Call()}AddCostCenterFilter(t){try{let e=this.CostCenters.Items.find(e=>e.Value==t.toString()),i=null!=e?e.Name:"",s=new R;s.CalCostCenterFilter_1(t,i,this),this.CostCenterFilters.push(s)}catch(e){}}}class E extends x{constructor(){super(...arguments),this.CCFilter="",this.FilterColName=""}CalenderReportFilterViewModel_1(t){this.Parent=t,this.LoadData(this.Parent.ScreenObject.Data.Tables[9])}CalenderReportFilterViewModel_2(t,e){this.OParent=t,this.FilterColName=e,this.LoadData([].Tables[0])}LoadData(t){this.tree=[],this.CostCenterFilters=[],this.CostCenters=new h.e(0),null!=t&&t.length>0&&t.forEach(t=>{""!=t.FeatureID.toString()&&parseInt(t.FeatureID.toString())>5e4&&this.CostCenters.Items.push(h.d.ComboBoxItems_2(t.Name.toString(),t.FeatureID.toString()))}),this.CostCenters.SelectionChangedCommand.Subscribe(this,"OnCostCenterChange")}RefreshCostCenterItems(){this.CostCenters.Items.Clear(),this.CostCenters.SelectedIndex=-1,this.CostCenterFilters.Clear(),null!=this.tree&&this.tree.Clear()}FillCostCenterItems(t){t.Items.forEach(t=>{null==this.CostCenters.Items.find(e=>e.Value==t.Value&&e.Parent==t.Parent)&&this.CostCenters.Items.push(t)})}OnButtonClick(t){"FilterOK"==t?null!=this.Parent?(this.Parent.CCFilter=this.GetDimensionFilter("CCNID",!0),this.Parent.onSelectionChanged(""),this.Parent.ShowReportFilter=!1):this.CCFilter=n.e.IsEmpty(this.FilterColName)?this.GetDimensionFilter(this.FilterColName,!1):this.GetDimensionFilter("dcccnid",!1):"FilterCancel"==t&&null!=this.Parent&&(this.Parent.ShowReportFilter=!1)}GetDimensionFilter(t,e){let i="";return this.CostCenterFilters.forEach(s=>{if((s.SelectedNodes.length>0||!s.DeleteButtonVisibility)&&s.CostCenterID>5e4&&s.SelectedNodes.length>0)if(i+=" AND ",1==s.SelectedNodes.length)i+=t+(s.CostCenterID-5e4)+e?"_Key=":"="+s.SelectedNodes[0].Id;else{i+=t+(s.CostCenterID-5e4)+e?"_Key":" IN (";for(let t=0;t<s.SelectedNodes.length;t++)t>0&&(i+=","),i+=s.SelectedNodes[t].Id;i+=")"}}),i.toString()}SetCCFilters(t){this.CostCenterFilters.forEach(e=>{if(e.SelectedNodes.length>0&&null!=t.CostCenters.Items.find(t=>parseInt(t.Value)==e.CostCenterID)){let i=t.CostCenterFilters.find(t=>t.CostCenterID==e.CostCenterID);null!=i?(i.SelectedNodes=e.SelectedNodes,i.SelectedNodesTag=e.SelectedNodesTag):(i=(new R).CalCostCenterFilter_1(e.CostCenterID,e.CostCenter,t),i.SelectedNodes=e.SelectedNodes,i.SelectedNodesTag=e.SelectedNodesTag,t.CostCenterFilters.push(i))}})}OnCostCenterChange(t){if(!n.e.IsEmpty(this.CostCenters.SelectedValue)&&null!=t&&-1!=parseInt(t)){let t=0;null==this.CostCenters.SelectedItem||n.e.IsEmpty(this.CostCenters.SelectedItem.Parent)||(t=n.e.Int(this.CostCenters.SelectedItem.Parent)),this.LoadCostCenterTree(parseInt(this.CostCenters.SelectedValue),t,0,null)}}LoadCostCenterTree(t,e,i,s){this.tree.Clear();let l,r="";50002==this.CostCenterID&&"True"==a.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==a.a.SessionManager.Preferences["LW Reports"]&&(r=n.e.IsEmpty(a.a.SessionManager.LocationWhere)?"NodeID IN (-1234)":"NodeID IN ("+a.a.SessionManager.LocationWhere+")"),null==s&&this.CostCenterFilters.forEach(e=>{e.CostCenterID!=t||(s=e.SelectedNodes)}),null==s?(l=new M.a,l.TreeViewModel_5(t,this,i,r,"")):(l=new M.a,l.TreeViewModel_6(t,this,i,r,s,"")),l.LookupTypeID=e,l.HeaderVisiblity=!1,l.OnNodeSelected||(l.OnNodeSelected=new g.b,l.OnNodeSelected.Subscribe(this,"OnNodeSelected")),this.tree.push(l)}}class R extends I.b{constructor(){super(...arguments),this.ParentReportFilterCostCenterID=0,this.Tag=null,this.SelectedNodes=null,this.ViewModel=null,this._DeleteButtonVisibility=!0,this.IsVisible=!0,this._IsGroupLevel=!1,this.IsGroupLevelVisible=!1,this.IsDynamicTree=!1}get CostCenter(){return this._CostCenter.toUpperCase()}set CostCenter(t){t!=this._CostCenter&&(this._CostCenter=t)}get DeleteButtonVisibility(){return this._DeleteButtonVisibility}set DeleteButtonVisibility(t){t!=this._DeleteButtonVisibility&&(this._DeleteButtonVisibility=t)}get IsGroupLevel(){return this._IsGroupLevel}set IsGroupLevel(t){if(this._IsGroupLevel=t,t&&3==this.CostCenterID&&1==this.SelectedNodes.length){let t,e=a.a.report.GetSubNodeNames(this.CostCenterID,this.SelectedNodes[0].Id.toString()),i="";this.SelectedNodes.Clear(),null!=e&&e.Columns.Contains("PK")&&(e.forEach(e=>{t=new f.a,t.Id=parseInt(e.PK),t.Text.push(e.Name.toString()),this.SelectedNodes.push(t),i.length<140&&(""!=i&&(i+=", "),i+=t.Text[0])}),i.length>=140&&(i+=" . . .")),null==this.SelectedNodes&&(t=new f.a,t.Id=-12342,t.Text.push("["+a.a.GetResource("Filter").toString().toUpperCase()+"]"),this.SelectedNodes.push(t)),this.SelectedNodesTag=i}}CalCostCenterFilter_1(t,e,i){this.CostCenterID=t,this.CostCenter=e,this.ViewModel=i,""!=a.a.SessionManager.Preferences.DynamicTrees&&a.a.SessionManager.Preferences.DynamicTrees.Split(",").Contains(t.toString())&&(this.IsDynamicTree=!0)}CalCostCenterFilter(){}OnButtonClick(t){if("Delete"==t){let t=0;null==this.ViewModel.CostCenters.SelectedItem||n.e.StringIsNullOrEmpty(this.ViewModel.CostCenters.SelectedItem.Parent)||(t=n.e.Int(this.ViewModel.CostCenters.SelectedItem.Parent)),parseInt(this.ViewModel.CostCenters.SelectedValue)==this.CostCenterID&&this.ViewModel.tree.length>0?(null!=this.ViewModel.tree[0].SelectedNodes&&this.ViewModel.tree[0].SelectedNodes.Clear(),this.SelectedNodesTag="",this.ViewModel.tree[0].RefreshData=!0):this.ViewModel.CostCenterFilters.Remove(this)}else{let t=0;if(null==this.ViewModel.CostCenters.SelectedItem||n.e.StringIsNullOrEmpty(this.ViewModel.CostCenters.SelectedItem.Parent)||(t=n.e.Int(this.ViewModel.CostCenters.SelectedItem.Parent)),parseInt(this.ViewModel.CostCenters.SelectedValue)!=this.CostCenterID)this.ViewModel.CostCenters.SelectedValue=this.CostCenterID.toString();else if(null!=this.SelectedNodes&&this.SelectedNodes.length>0&&null!=this.ViewModel.tree&&this.ViewModel.tree.length>0){this.ViewModel.tree[0].SelectedNode=null;var e=this.ViewModel.tree[0].AllNodes.find(t=>t.Id==this.SelectedNodes[0].Id);null!=e&&this.ViewModel.tree[0].SelectSearchNode(e)}}}RefreshSelectedNodesText(){let t="";this.SelectedNodes.forEach(e=>{e.Text.length>0&&!n.e.IsEmpty(e.Text[0])&&(t=""!=t?t+", "+e.Text[0]:e.Text[0],t.length>140)&&(t+=" . . .")}),this.SelectedNodesTag=t}GetSeqNosListWithRoots(){if(this.IsOneSelected=this.IsGroupExists=!1,null==this.SelectedNodes)return"";let t="";return this.SelectedNodes.forEach(this.IsDynamicTree?e=>{e.IsGroup&&(this.IsGroupExists=!0),t+=e.Id+","}:e=>{null!=e.Parent&&e.Parent.IsSelected?this.IsGroupExists=!0:t+=e.Id+","}),t.length>0&&(t=t.Remove(t.length-1,1),this.SelectedNodes.filter(t=>1==t.Id).length>0&&(this.IsOneSelected=!0)),t.toString()}SetSelectedNodes(t){let e;if(this.SelectedNodes=[],t.SelectSingleNode("DefaultValues").InnerText.Length>0){e=t.SelectSingleNode("DefaultValues").InnerText.Split(",");let i,s=t.SelectSingleNode("GroupNodes"),n=null;null!=s?(i=s.InnerText.Split(","),null==s.Attributes.IsStatic&&(n=a.a.report.GetGrouplft_rgt(this.CostCenterID,t.SelectSingleNode("GroupNodes").InnerText))):i=[];for(let t=0;t<e.length;t++){let s=new f.a;if(s.Id=parseInt(e[t]),s.IsSelected=!0,i.Contains(e[t])&&(s.IsGroup=!0,null!=n)){let i=n.filter(i=>i.ID==e[t]);i.Length>0&&(s.lft=parseInt(i[0].lft),s.rgt=parseInt(i[0].rgt))}s.Text.push(e[t]),this.SelectedNodes.push(s)}}else e=[];if(this.SelectedNodes.length>0&&(this.SelectedNodesTag="["+a.a.GetResource("Filter").toString().toUpperCase()+"]",7==this.CostCenterID&&t.SelectSingleNode("DefaultValues").InnerText.Length>0)){let e=a.a.report.GetUsers(t.SelectSingleNode("DefaultValues").InnerText);this.SelectedNodes.Clear(),e.forEach(t=>{let e=new f.a;e.Id=parseInt(t.UserID),e.IsSelected=!0,e.Text.push(t.UserName.toString()),this.SelectedNodes.push(e)}),this.RefreshSelectedNodesText()}}}}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{JJ8n:function(e,t,n){"use strict";n.d(t,"a",(function(){return C}));var i=n("mrSG"),a=n("Do2H"),r=n("Lp6j"),s=n("eQJW"),o=n("ScVY"),c=n("n56n"),l=n("0/4Q"),b=n("JIg3"),D=n("8B8H"),u=n("ockk"),S=n("MCKn"),d=n("4HhE");class C extends o.b{constructor(){super(),this.InProgress=null,this.ProgressMessage=null,this.ProgressValue=0,this.ProgressMax=0,this.DimVisibility=!1,this.TextVisibility=!1,this.FromDate=new b.b,this.LineNo=1,this.Label=null,this.GridVisibility=!1,this.DocVisibility=!1,this.LineVisibility=!0,this.calltype=0,this.DailogResult=!1,this.FromDate.Visible=!1}GoToLineViewModel_1(e,t){this.ButtonClick=new d.b,this.oParent=e,this.calltype=t,this.DimVisibility=!1,0==this.calltype?(this.TextVisibility=!0,this.Title="Add "+e.TempscreenTitle.replace("Add ","").replace("Edit ",""),this.Label="No. of "+e.TempscreenTitle.replace("Add ","").replace("Edit ","")):1==this.calltype&&(this.TextVisibility=!1,this.Title="Date",this.Label="Date",this.FromDate.Visible=!0,this.FromDate.Date=Date.Today(),this.FromDate.CustomFormat=a.a.SessionManager.Preferences["Date Format"]+" hh:mm tt"),this.ButtonClick.Subscribe(this,"OnButtonClick")}GoToLineViewModel_2(e){Logger.InfoLog("GoToLineViewModel:: Entering GoToLineViewModel"),this.Parent=e,this.Title="Go to line",this.DimVisibility=!1,this.TextVisibility=!0,this.Label="Line Number(1-"+(e.ScreenObject.GridData.length-1).toString()+"):",Logger.InfoLog("GoToLineViewModel:: Entering GoToLineViewModel")}GoToLineViewModel_3(e,t,n){let i;this.Parent=e,this.Title="Select Document",this.GridVisibility=!0,this.LineVisibility=!1,this.calltype=n,this.Documents=new D.a,this.Documents.OnLinkClick.Subscribe(this,"OnGridLinkClick"),this.Documents.Table=[],this.Documents.TableColumns.push("CostCenterID"),this.Documents.TableColumns.push("DocName"),this.Documents.Columns=[],i=new u.a,i.Header="Document Nme",i.DisplayMember="DocName",i.DataType="LINK",i.ReadOnly=!0,i.IsFrozen=!0,i.Width=270,this.Documents.Columns.push(i),t.forEach(e=>{let t=this.Documents.NewRow();t.CostCenterID=e.CostCenterIDBase.toString(),t.DocName=e.DocName.toString(),this.Documents.Table.push(t)});for(let a=this.Documents.Table.length;a<5;a++)this.Documents.addEmptyRow()}GoToLineViewModel_4(e,t,n){if(Logger.InfoLog("GoToLineViewModel:: Entering GoToLineViewModel"),this.Parent=e,this.DimVisibility=!0,this.TextVisibility=!1,400==t)this.Title="Select Document",this.Label="Doc No",this.Dimension=new c.b(0),this.Dimension.CCID=t,this.Dimension.TypeID=2,this.Dimension.CustomWhere=" a.CostCenterID="+e.CostCenterID.toString();else if(2==t)this.Title="Select Account",this.Label="Account",this.Dimension=new c.b(0),this.Dimension.CCID=t,this.Dimension.TypeID=2,this.Options=new l.e,this.Options.Visible=!1;else{this.Title="Stock Posting",this.Label="Post based on",this.Options=new l.e(0),this.Options.Visible=!0,this.Dimension=new c.b(0),this.Dimension.Visible=!1;let t="";var i=this.Parent.ScreenObject.ColumnSource.find(e=>e.ID==this.Parent.ScreenObject.Preferences.QOHField);if(i&&(t=i.DisplayMember),e.ScreenObject.ColumnSource.forEach(e=>{!r.e.StringIsNullOrEmpty(e.DisplayMember)&&e.DisplayMember.toLowerCase().Contains("dcnum")&&e.DisplayMember!=t&&this.Options.Items.push(l.d.ComboBoxItems_2(e.Header,e.DisplayMember))}),this.Parent.ScreenObject.Preferences.ContainsKey("StockPostingAll")&&Object(s.j)(this.Parent.ScreenObject.Preferences.StockPostingAll)){let e=this.Parent.ScreenObject.GetPSPProducts(this.Parent.ScreenObject.DocID,this.Parent.DocumentDate,"",0);if(null!=e&&e.Tables.length>0&&e.Tables[0].length>0){let t;this.DocVisibility=!0,this.Documents=new D.a,this.Documents.Table=[],this.Documents.TableColumns.push("CostCenterID"),this.Documents.TableColumns.push("DocName"),this.Documents.Columns=[],this.Documents.Height=200,t=new u.a,t.Header="Open Documents",t.DisplayMember="DocName",t.DataType="LINK",t.ReadOnly=!0,t.IsFrozen=!0,t.Width=270,this.Documents.Columns.push(t);for(let n=0;n<e.Tables[0].length;n++){let t=this.Documents.NewRow();t.CostCenterID=e.Tables[0][n].Costcenterid.toString(),t.DocName=e.Tables[0][n].Voucherno.toString(),this.Documents.Table.push(t)}for(let e=this.Documents.Table.length;e<5;e++)this.Documents.addEmptyRow()}}}Logger.InfoLog("GoToLineViewModel:: Entering GoToLineViewModel")}OnGridLinkClick(e,t,n){e.CostCenterID.toString().length>0&&(a.a.page.HideDialog(),1==this.calltype?this.Parent.GenerateDocfromProject(parseInt(e.CostCenterID.toString())):this.Parent.GenerateLinkDocument(parseInt(e.CostCenterID.toString())))}OnButtonClick(e){if(null!=e&&"Cancel"==e.toString())this.DailogResult=!1,a.a.page.HideDialog();else if(null!=e&&"OK"==e.toString())if(null!=this.oParent)0==this.calltype?(this.ProgressMessage="Adding Bins.Please wait...",a.a.page.HideDialog()):1==this.calltype&&(this.DailogResult=!0,a.a.page.HideDialog());else if(a.a.page.HideDialog(),this.DimVisibility){if(null!=this.Options){if(r.e.StringIsNullOrEmpty(this.Options.SelectedValue))return this.DisplayMessage="select post on",void(this.MessageVisibility=!0);this.PostDocumentObj()}else if(null!=this.Dimension){let e=Date.Today();this.Dimension.SelectedValue>0&&this.Parent.ScreenObject.OnDocPrefixChanged("lostFocus",0,this.Dimension.SelectedValue,e,!0)}}else this.Parent.LineNo=this.LineNo}PostDocumentObj(){return Object(i.b)(this,void 0,void 0,(function*(){const{AddEditDocumentViewModel:e}=yield Promise.all([n.e(2),n.e(1),n.e(3),n.e(5),n.e(4),n.e(6),n.e(7),n.e(10),n.e(9),n.e(12),n.e(11),n.e(13),n.e(19),n.e(15),n.e(21),n.e(20),n.e(16),n.e(14),n.e(18),n.e(17),n.e(22),n.e(148)]).then(n.bind(null,"1Cra"));let t,i=new e(parseInt(this.Parent.ScreenObject.Preferences.PostingDOC),"",!1);i.CheckStockDimensions(),i.DocumentDate=this.Parent.DocumentDate,i.ScreenObject._CCFields.forEach(e=>{if(e instanceof c.b){var t=this.Parent.ScreenObject._CCFields.find(t=>t instanceof c.b&&t.CCID==e.CCID);t&&(e.PreviousSelectedValue=t.SelectedValue,e.SelectedValue=t.SelectedValue)}});let o=i.ScreenObject.ColumnSource.find(e=>e.CostCenterID.toString()==a.a.SessionManager.Preferences.POSItemCodeDimension),l="";var b=i.ScreenObject.ColumnSource.find(e=>e.ID==i.ScreenObject.Preferences.CntField);b&&(l=b.DisplayMember);let D="";(b=this.Parent.ScreenObject.ColumnSource.find(e=>e.ID==this.Parent.ScreenObject.Preferences.QOHField))&&(D=b.DisplayMember);let u,d="";(b=i.ScreenObject.ColumnSource.find(e=>e.ID==i.ScreenObject.Preferences.VarienceField))&&(d=b.DisplayMember),i.ScreenObject.GridData.Clear();let C=new r.f;for(let n=0;n<this.Parent.ScreenObject.GridData.length;n++)if(!r.e.StringIsNullOrEmpty(this.Parent.ScreenObject.GridData[n].ProductID_Key)){if(u="",t=i.ScreenObject.GridDataObj.NewRow(),i.ScreenObject.ColumnSource.forEach(e=>{if(e.CostCenterID>5e4)if(this.Parent.ScreenObject.GridDataColumns.Contains("dcCCNID"+(e.CostCenterID-5e4)))r.e.StringIsNullOrEmpty(this.Parent.ScreenObject.GridData[n]["dcCCNID"+(e.CostCenterID-5e4)+"_Key"])||(t["dcCCNID"+(e.CostCenterID-5e4)+"_Key"]=this.Parent.ScreenObject.GridData[n]["dcCCNID"+(e.CostCenterID-5e4)+"_Key"].toString(),t["dcCCNID"+(e.CostCenterID-5e4)]=this.Parent.ScreenObject.GridData[n]["dcCCNID"+(e.CostCenterID-5e4)].toString());else{var i=this.Parent.ScreenObject._CCFields.find(t=>t instanceof c.b&&t.CCID==e.CostCenterID);i&&(t["dcCCNID"+(e.CostCenterID-5e4)]=i.SelectedValue)}}),t.ProductID_Key=this.Parent.ScreenObject.GridData[n].ProductID_Key.toString(),i.ScreenObject.GridDataColumns.Contains("ProductCode")&&(t.ProductCode=this.Parent.ScreenObject.GridData[n].ProductCode),i.ScreenObject.GridDataColumns.Contains("ProductName")&&(t.ProductName=this.Parent.ScreenObject.GridData[n].ProductName),t.Rate=this.Parent.ScreenObject.GridData[n].Rate,t.Type=this.Parent.ScreenObject.GridData[n].Type,t.Unit=this.Parent.ScreenObject.GridData[n].Unit,t.Unit_key=this.Parent.ScreenObject.GridData[n].Unit_key,!this.Parent.ScreenObject.Preferences.ContainsKey("DontCalcQOH")||r.e.StringIsNullOrEmpty(this.Parent.ScreenObject.Preferences.DontCalcQOH)||i.ScreenObject.Preferences.ContainsKey("DontCalcQOH")||i.ScreenObject.Preferences.push("DontCalcQOH",this.Parent.ScreenObject.Preferences.DontCalcQOH),this.Parent.ScreenObject.Preferences.ContainsKey("DontCalcQOH")&&!r.e.StringIsNullOrEmpty(this.Parent.ScreenObject.Preferences.DontCalcQOH)&&Object(s.j)(this.Parent.ScreenObject.Preferences.DontCalcQOH)){if("5"==this.Parent.ScreenObject.GridData[n].Type.toString()&&!r.e.StringIsNullOrEmpty(this.Parent.ScreenObject.GridData[n].ExtraXML)){C.LoadXml(this.Parent.ScreenObject.GridData[n].ExtraXML.toString());let e=C.SelectNodes("xml/Row");e.length>0&&null!=e[0].attributes.BatchID&&!r.e.StringIsNullOrEmpty(e[0].attributes.BatchID.value)&&(u=e[0].attributes.BatchID.value)}""!=D&&(t.QOH=this.Parent.ScreenObject.GridData[n][D]),t.UOMConversion=this.Parent.ScreenObject.GridData[n].UOMConversion;var h=i.ScreenObject.ColumnSource.find(e=>"Quantity"==e.DisplayMember);t.Quantity=h&&!r.e.StringIsNullOrEmpty(h.DefaultValue)&&isFinite(h.DefaultValue)?h.DefaultValue:1,r.e.StringIsNullOrEmpty(t.UOMConversion)||(t.UOMConvertedQty=parseFloat(t.UOMConversion.toString())*parseFloat(t.Quantity.toString()));let e=i.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&25398==e.LinkData);e.length>0&&i.ScreenObject.GridDataColumns.Contains(e[0].SysColumnName.toString())&&(t[e[0].SysColumnName.toString()]=this.Parent.ScreenObject.GridData[n][D])}else if("5"==this.Parent.ScreenObject.GridData[n].Type.toString()){if(!r.e.StringIsNullOrEmpty(this.Parent.ScreenObject.GridData[n].ExtraXML)){C.LoadXml(this.Parent.ScreenObject.GridData[n].ExtraXML.toString());let e=C.SelectNodes("xml/Row");if(e.length>0&&null!=e[0].attributes.BatchID&&!r.e.StringIsNullOrEmpty(e[0].attributes.BatchID.value)){u=e[0].attributes.BatchID.value,t.QOH=i.ScreenObject.GetBatchWiseQOH(t.ProductID_Key.toString(),u,t);let n=i.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&25398==e.LinkData);n.length>0&&i.ScreenObject.GridDataColumns.Contains(n[0].SysColumnName.toString())&&(t[n[0].SysColumnName.toString()]=t.QOH)}}}else i.AddProductData(t,!1,!0,!1,null,null,o);if(""!=l&&(t[l]=this.Parent.ScreenObject.GridData[n][this.Options.SelectedValue]),i.ScreenObject.GridDataColumns.Contains("DueDate")&&this.Parent.ScreenObject.GridDataColumns.Contains("DueDate")&&!r.e.StringIsNullOrEmpty(this.Parent.ScreenObject.GridData[n].DueDate_Key)&&(t.DueDate=this.Parent.ScreenObject.GridData[n].DueDate.toString(),t.DueDate_Key=this.Parent.ScreenObject.GridData[n].DueDate_Key.toString()),i.ScreenObject.GridDataColumns.Contains("LinkedInvDocDetailsID")&&(t.LinkedInvDocDetailsID=this.Parent.ScreenObject.GridData[n].DocDetailsID),i.ScreenObject.GridDataColumns.Contains("RefNo")&&(t.RefNo=this.Parent.ScreenObject.VoucherNo),i.ScreenObject.GridData.push(t),i.CalculateTotals(t,!1),"5"==this.Parent.ScreenObject.GridData[n].Type.toString()&&""!=u&&""!=d&&i.ScreenObject.GridDataColumns.Contains(d)&&!r.e.StringIsNullOrEmpty(i.ScreenObject.GridData[n][d])&&0!=parseFloat(i.ScreenObject.GridData[n][d].toString())){let e=parseFloat(i.ScreenObject.GridData[n][d].toString().replace("-",""));t.ExtraXML='<xml><Row  ProductID="'+t.ProductID_Key.toString()+'"  BatchID="'+u+'"  Quantity="'+e+'"  Hold="0" Release="'+e+'"  ></Row></xml>'}if("2"==r.e.String(this.Parent.ScreenObject.GridData[n].Type)&&!r.e.IsEmpty(this.Parent.ScreenObject.GridData[n].ExtraXML)&&""!=d&&i.ScreenObject.GridDataColumns.Contains(d)&&!r.e.IsEmpty(i.ScreenObject.GridData[n][d])&&0!=parseFloat(i.ScreenObject.GridData[n][d].toString())){let e=0,o=0;a.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&Object(s.j)(a.a.SessionManager.Preferences.EnableDivisionWise)&&a.a.SessionManager.Preferences.ContainsKey("DW SNOS")&&Object(s.j)(a.a.SessionManager.Preferences["DW SNOS"])&&(null!=(m=this.Parent.ScreenObject._CCFields.find(e=>"dcccnid1"==e.DBColumnName.toLowerCase()))&&null!=m&&m instanceof c.b&&m.SelectedValue>0?e=m.SelectedValue:null!=t&&i.ScreenObject.GridDataColumns.Contains("dcCCNID1_Key")&&!r.e.IsEmpty(t.dcCCNID1_Key)&&(e=parseInt(t.dcCCNID1_Key.toString()))),a.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&Object(s.j)(a.a.SessionManager.Preferences.EnableLocationWise)&&a.a.SessionManager.Preferences.ContainsKey("LW SNOS")&&Object(s.j)(a.a.SessionManager.Preferences["LW SNOS"])&&(null!=(m=this.Parent.ScreenObject._CCFields.find(e=>"dcccnid2"==e.DBColumnName.toLowerCase()))&&null!=m&&m instanceof c.b&&m.SelectedValue>0?o=m.SelectedValue:null!=t&&i.ScreenObject.GridDataColumns.Contains("dcCCNID2_Key")&&!r.e.IsEmpty(t.dcCCNID2_Key)&&(o=parseInt(t.dcCCNID2_Key.toString())));let l,b=a.a.document.GetSerialNumberScreenDetails(parseInt(t.ProductID_Key),0,0,e,o,!1),D=parseFloat(i.ScreenObject.GridData[n][d].toString());C.LoadXml(this.Parent.ScreenObject.GridData[n].ExtraXML.toString());let u=C.SelectNodes("xml/Row"),S="";if(S+="<xml>",D>0)for(let t=0;t<u.length;t++)null==u[t].attributes.SerialNumber||r.e.IsEmpty(u[t].attributes.SerialNumber.value)||(l=b.Tables[1].filter(e=>e.SerialNumber==u[t].attributes.SerialNumber.value),0==l.length&&(S+='<Row SerialNumber="'+u[t].attributes.SerialNumber.value+'" Quantity="1"  StatusID="157" ',S+=' RefInvDocDetailsID="0" SerialGUID="'+r.e.NewGuid()+'" IsIssue="0" IsAvailable="1"',S+=" >",S+="</Row>"));else if(D<0){let e=new Array[u.length];for(let t=0;t<u.length;t++)null==u[t].attributes.SerialNumber||r.e.IsEmpty(u[t].attributes.SerialNumber.value)||(e[t]=u[t].attributes.SerialNumber.value);for(let t=0;t<b.Tables[1].length;t++)e.Contains(b.Tables[1][t].SerialNumber.toString())||(S+='<Row SerialNumber="'+b.Tables[1][t].SerialNumber.toString()+'" Quantity="1"  StatusID="158" ',S+=' RefInvDocDetailsID="'+b.Tables[1][t].InvDocDetailsID.toString()+'" SerialGUID="'+b.Tables[1][t].SerialGUID.toString()+'" IsIssue="1" IsAvailable="0"',S+=" >",S+="</Row>")}S+="</xml>",t.ExtraXML=S.toString()}}if(this.Parent.ScreenObject.Preferences.ContainsKey("StockPostingAll")&&Object(s.j)(this.Parent.ScreenObject.Preferences.StockPostingAll)){let e=this.Parent.ScreenObject.GetPSPProducts(this.Parent.ScreenObject.DocID,this.Parent.DocumentDate,l,1);if(null!=e&&e.Tables.length>0&&e.Tables[0].length>0)for(let n=0;n<e.Tables[0].length;n++){u="",t=i.ScreenObject.GridDataObj.NewRow(),t.ProductID_Key=e.Tables[0][n].ProductID.toString(),i.ScreenObject.GridDataColumns.Contains("ProductCode")&&(t.ProductCode=e.Tables[0][n].ProductCode),i.ScreenObject.GridDataColumns.Contains("ProductName")&&(t.ProductName=e.Tables[0][n].ProductName),t.Rate=e.Tables[0][n].Rate,t.Type=e.Tables[0][n].ProductTypeID,t.Unit_key=e.Tables[0][n].Unit,t.QOH=e.Tables[0][n].QOH,t.UOMConversion=e.Tables[0][n].UOMConversion,h=i.ScreenObject.ColumnSource.find(e=>"Quantity"==e.DisplayMember),t.Quantity=h&&!r.e.StringIsNullOrEmpty(h.DefaultValue)&&isFinite(h.DefaultValue)?h.DefaultValue:1,r.e.StringIsNullOrEmpty(t.UOMConversion)||(t.UOMConvertedQty=parseFloat(t.UOMConversion.toString())*parseFloat(t.Quantity.toString()));let b=i.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&25398==e.LinkData);if(b.length>0&&i.ScreenObject.GridDataColumns.Contains(b[0].SysColumnName.toString())&&(t[b[0].SysColumnName.toString()]=e.Tables[0][n].QOH),l&&!r.e.StringIsNullOrEmpty(e.Tables[0][n].cntfld)&&(t[l]=e.Tables[0][n].cntfld.toString()),r.e.hasprop(t,"DueDate")&&!r.e.StringIsNullOrEmpty(e.Tables[0][n].DueDate)&&(t.DueDate=new Date(e.Tables[0][n].DueDate.toString()).ToString(a.a.SessionManager.Preferences["Date Format"]),t.DueDate_Key=new Date(e.Tables[0][n].DueDate.toString())),r.e.StringIsNullOrEmpty(e.Tables[0][n].invdocdetailsid)||"0"==e.Tables[0][n].invdocdetailsid.toString()||(t.LinkedInvDocDetailsID=e.Tables[0][n].invdocdetailsid,i.ScreenObject.GridDataColumns.Contains("RefNo")&&(t.RefNo=e.Tables[0][n].Voucherno.toString())),null!=o&&e.Columns[0].Contains("StkCode")&&(t[o.DisplayMember]=e.Tables[0][n].Code,t[o.ValueMember]=e.Tables[0][n].StkCode),i.ScreenObject.GridDataObj.addRow(t),i.CalculateTotals(t,!1,"",!1),"2"==t.Type.toString()&&""!=d&&i.ScreenObject.GridDataColumns.Contains(d)&&!r.e.IsEmpty(t[d])&&0!=parseInt(t[d].toString())){let e=0,n=0;var m;a.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&Object(s.j)(a.a.SessionManager.Preferences.EnableDivisionWise)&&a.a.SessionManager.Preferences.ContainsKey("DW SNOS")&&Object(s.j)(a.a.SessionManager.Preferences["DW SNOS"])&&(null!=(m=this.Parent.ScreenObject._CCFields.find(e=>"dcccnid1"==e.DBColumnName.toLowerCase()))&&null!=m&&m instanceof c.b&&m.SelectedValue>0?e=m.SelectedValue:null!=t&&t.Table.Columns.Contains("dcCCNID1_Key")&&!r.e.IsEmpty(t.dcCCNID1_Key)&&(e=parseInt(t.dcCCNID1_Key.toString()))),a.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&Object(s.j)(a.a.SessionManager.Preferences.EnableLocationWise)&&a.a.SessionManager.Preferences.ContainsKey("LW SNOS")&&Object(s.j)(a.a.SessionManager.Preferences["LW SNOS"])&&(null!=(m=this.Parent.ScreenObject._CCFields.find(e=>"dcccnid2"==e.DBColumnName.toLowerCase()))&&null!=m&&m instanceof c.b&&m.SelectedValue>0?n=m.SelectedValue:null!=t&&t.Table.Columns.Contains("dcCCNID2_Key")&&!r.e.IsEmpty(t.dcCCNID2_Key)&&(n=parseInt(t.dcCCNID2_Key.toString())));let i=a.a.document.GetSerialNumberScreenDetails(parseInt(t.ProductID_Key),0,0,e,n,!1),o=parseFloat(t[d].toString()),l="";l+="<xml>";for(let t=0;t<i.Tables[1].length&&!(t>=Math.abs(o));t++)l+='<Row SerialNumber="'+i.Tables[1][t].SerialNumber.toString()+'" Quantity="1"  StatusID="158" ',l+=' RefInvDocDetailsID="'+i.Tables[1][t].InvDocDetailsID.toString()+'" SerialGUID="'+i.Tables[1][t].SerialGUID.toString()+'" IsIssue="1" IsAvailable="0"',l+=" >",l+="</Row>";l+="</xml>",t.ExtraXML=l.toString()}else"5"==t.Type.toString()&&""!=d&&i.ScreenObject.GridDataColumns.Contains(d)&&r.e.IsEmpty(t[d])&&0!=parseFloat(t[d].toString())&&i.fillbatches(t,"",!0)}}i.CalculateTotals(null,!1),i.ScreenObject.UpdateSequence(),i.ScreenObject.AvgrateExists&&this.CalcAvgRate(i),a.a.page.addNewTab({component:S.AddEditDocumentComponent,params:{obj:i}}),i.RefreshGrid=!i.RefreshGrid}))}CalcAvgRate(e){let t=[];a.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise AverageRate")&&r.e.IntTryParse(a.a.SessionManager.Preferences["Maintain Dimensionwise AverageRate"])>5e4&&t.push(parseInt(a.a.SessionManager.Preferences["Maintain Dimensionwise AverageRate"])),a.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&Object(s.j)(a.a.SessionManager.Preferences.EnableLocationWise)&&a.a.SessionManager.Preferences.ContainsKey("Location AverageRate")&&Object(s.j)(a.a.SessionManager.Preferences["Location AverageRate"])&&t.push(50002),a.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&Object(s.j)(a.a.SessionManager.Preferences.EnableDivisionWise)&&a.a.SessionManager.Preferences.ContainsKey("Division AverageRate")&&Object(s.j)(a.a.SessionManager.Preferences["Division AverageRate"])&&t.push(50001);let n="";n+="<PXML>";let i="";for(let a=0;a<e.ScreenObject._CCFields.length;a++){let n=e.ScreenObject._CCFields[a];n instanceof c.b&&n.DBColumnName.Contains("TO")&&5==e.ScreenObject.DocumentType||n instanceof c.b&&n.SelectedValue>0&&t.Contains(n.CCID)&&(i+=" and dcCCNID"+(n.CCID-5e4).toString()+"="+n.SelectedValue.toString()+" ")}for(let a=0;a<e.ScreenObject.GridData.length;a++)if(!r.e.StringIsNullOrEmpty(e.ScreenObject.GridData[a].ProductID_Key)){let s="",o=r.e.DoubleTryParse(e.ScreenObject.GridData[a].Quantity);0==o&&(o=1),n+="<Row ",n+=' ProductID="'+e.ScreenObject.GridData[a].ProductID_Key.toString()+'" ',n+=' QTY="'+o+'" ',n+=' DETAILSID="'+e.ScreenObject.GridData[a].DocDetailsID.toString()+'" ',e.ScreenObject.ColumnSource.forEach(n=>{n.CostCenterID>5e4&&t.Contains(n.CostCenterID)&&e.ScreenObject.GridDataColumns.Contains(n.ValueMember)&&!r.e.StringIsNullOrEmpty(e.ScreenObject.GridData[a][n.ValueMember])&&(s+=" and dcCCNID"+(n.CostCenterID-5e4).toString()+"="+e.ScreenObject.GridData[a][n.ValueMember].toString()+"  ")}),n+=' avgwhere="'+s+i+'" ></Row> '}n+="</PXML>";let o=e.ScreenObject.GetReconcileAvgRate(n.toString(),e.DocumentDate);if(null!=o&&o.Tables.length>0&&o.Columns[0].Contains("invid"))for(let a=0;a<e.ScreenObject.GridData.length;a++)if(!r.e.StringIsNullOrEmpty(e.ScreenObject.GridData[a].ProductID_Key)){let t=o.Tables[0].filter(t=>t.invid==e.ScreenObject.GridData[a].DocDetailsID);t.length>0&&(e.ScreenObject.GridData[a].AVGRATE=r.e.StringIsNullOrEmpty(t[0].AvgRate)?0:t[0].AvgRate.toString(),e.CalculateTotals(e.ScreenObject.GridData[a],!0))}}save(){this.ProgressMax=this.LineNo;let e=0,t="",n=1;if(!this.oParent.ScreenObject.IsNameAutoGenerate){let e;t=this.oParent.Name.Text;let i=!1;for(let a=0;a<t.length;a++)if(!r.e.IsDigit(t[t.length-a-1])){if(a<=15&&(i=!0,a>0)){e=t.substr(t.length-a);for(let t=0;t<e.length&&"0"==e[t];t++)a--;n=parseInt(t.substr(t.length-a)),t=t.substr(0,t.length-a),n++}break}if(!i&&null!=t&&""!=t.trim()){let i=t.length;i>15?(i=15,e=t.substr(t.length-i)):e=t;for(let t=0;t<e.length&&"0"==e[t];t++)i--;n=parseInt(t.substr(t.length-i)),t=t.substr(0,t.length-i),n++}}for(let i=0;i<this.LineNo;i++,n++){let i=this.oParent.objCostCenter.SaveCostCenter();this.oParent.objCostCenter.NodeID=0;let a={StrCode:this.oParent.objCostCenter.Code,CodePrefix:this.oParent.objCostCenter.CodePrefix,CodeNumber:this.oParent.objCostCenter.CodeNumber};if(this.DisplayMessage=this.oParent.ScreenObject.SetAutoCodeParams(this.oParent.Code,this.oParent.GroupID,this.oParent.ScreenObject.Data.Tables[7]),this.oParent.objCostCenter.Code=a.StrCode,this.oParent.objCostCenter.CodePrefix=a.CodePrefix,this.oParent.objCostCenter.CodeNumber=a.CodeNumber,this.DisplayMessage.length>0)continue;let r=this.oParent.ScreenObject.Data.Tables[7].filter(e=>1==e.IsName);this.oParent.ScreenObject.IsName=!0,r.length>0&&(this.oParent.Name.Text=this.oParent.ScreenObject.IsNameAutoGenerate?this.oParent.ScreenObject.SetAutoCodeParams(this.oParent.Name,this.oParent.GroupID,r):t+n.toString(),this.oParent.objCostCenter.Name=this.oParent.Name.Text),i<0&&e++,this.ProgressValue++,this.InProgress=this.ProgressValue+" of "+this.ProgressMax}this.LineNo>0&&this.LineNo>e&&(this.oParent.RetValue=1),this.oParent.DisplayMessage=a.a.GetResource("UOM_Saved")+" :"+(this.LineNo-e).toString()}}},Tvp0:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var i=n("fXoL");function a(e,t){if(1&e){const e=i.ac();i.Zb(0,"input",11),i.hc("ngModelChange",(function(t){return i.Ic(e),i.lc(2).obj.LineNo=t})),i.Yb()}if(2&e){const e=i.lc(2);i.tc("ngModel",e.obj.LineNo)}}function r(e,t){if(1&e&&(i.Zb(0,"div",12),i.Wc(1,"\n                "),i.Vb(2,13),i.Wc(3,"\n            "),i.Yb()),2&e){const e=i.lc(2);i.Db(2),i.tc("obj",e.obj.FromDate)}}function s(e,t){if(1&e&&(i.Zb(0,"div",12),i.Wc(1,"\n                "),i.Vb(2,13),i.Wc(3,"\n                "),i.Vb(4,13),i.Wc(5,"\n            "),i.Yb()),2&e){const e=i.lc(2);i.Db(2),i.tc("obj",e.obj.Dimension),i.Db(2),i.tc("obj",e.obj.Options)}}function o(e,t){if(1&e&&(i.Zb(0,"div"),i.Wc(1,"\n            "),i.Zb(2,"label",8),i.Wc(3),i.Yb(),i.Wc(4,"\n            "),i.Uc(5,a,1,1,"input",9),i.Wc(6,"\n            "),i.Uc(7,r,4,1,"div",10),i.Wc(8,"\n            "),i.Uc(9,s,6,2,"div",10),i.Wc(10,"\n        "),i.Yb()),2&e){const e=i.lc();i.Db(3),i.Yc("",e.obj.Label," "),i.Db(2),i.tc("ngIf",e.obj.TextVisibility),i.Db(2),i.tc("ngIf",e.obj.FromDate.Visible),i.Db(2),i.tc("ngIf",e.obj.DimVisibility)}}function c(e,t){if(1&e&&(i.Zb(0,"div",14),i.Wc(1,"\n            "),i.Ub(2,"app-PactGridView",15),i.Wc(3,"  \n        "),i.Yb()),2&e){const e=i.lc();i.Db(2),i.tc("obj",e.obj.Documents)("group",e.form)}}let l=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i.Nb({type:e,selectors:[["app-go-to-line"]],inputs:{obj:"obj"},decls:25,vars:8,consts:[[1,"master-screen",2,"padding-bottom","4px","width","300px"],[1,"PACTHeaderFields","row","form-row","dialogSubBody"],[4,"ngIf"],["class","row form-row","style","width: 100%;",4,"ngIf"],[1,"Pactdailogfooter"],[1,"primary-btn-wicon",3,"click"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-rectangle-xmark"],[1,"input_cntrl_label"],["autocomplete","off","class","input_cntrl",3,"ngModel","ngModelChange",4,"ngIf"],["class","form-group col-xl-12 col-md-12 col-sm-12 col-xs-12 PACTControl",4,"ngIf"],["autocomplete","off",1,"input_cntrl",3,"ngModel","ngModelChange"],[1,"form-group","col-xl-12","col-md-12","col-sm-12","col-xs-12","PACTControl"],["FieldDirective","",3,"obj"],[1,"row","form-row",2,"width","100%"],[2,"width","100%",3,"obj","group"]],template:function(e,t){1&e&&(i.Zb(0,"div",0),i.Wc(1,"\n    "),i.Zb(2,"div",1),i.Wc(3,"\n        "),i.Uc(4,o,11,4,"div",2),i.Wc(5,"\n        "),i.Uc(6,c,4,2,"div",3),i.Wc(7,"\n    "),i.Yb(),i.Wc(8,"\n    "),i.Zb(9,"div",4),i.Wc(10,"\n      "),i.Zb(11,"div"),i.Wc(12,"\n        "),i.Zb(13,"button",5),i.hc("click",(function(){return t.obj.OnButtonClick("OK")})),i.Wc(14),i.mc(15,"translate"),i.Yb(),i.Wc(16,"\n        "),i.Zb(17,"button",6),i.hc("click",(function(){return t.obj.OnButtonClick("Cancel")})),i.Ub(18,"i",7),i.Wc(19),i.mc(20,"translate"),i.Yb(),i.Wc(21,"\n      "),i.Yb(),i.Wc(22,"\n  "),i.Yb(),i.Wc(23,"\n"),i.Yb(),i.Wc(24,"\n")),2&e&&(i.Db(4),i.tc("ngIf",t.obj.LineVisibility),i.Db(2),i.tc("ngIf",t.obj.GridVisibility),i.Db(8),i.Xc(i.nc(15,4,"Ok")),i.Db(5),i.Xc(i.nc(20,6,"Cancel")))},encapsulation:2}),e})()}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{"6l4u":function(e,t,s){"use strict";s.d(t,"a",(function(){return D}));var i=s("Do2H"),a=s("Lp6j"),n=s("ScVY"),r=s("ockk"),o=s("EQd/"),l=s("0/4Q"),h=s("8B8H"),c=s("n56n"),d=s("ouML"),u=s("vgHJ");class D extends n.b{constructor(e,t,s,n,r,d,u){var D,m,b,S;if(super(),this.FilterDim=new c.b,this.ImportVisiblity=!1,this.Width=700,this.Height=700,this.IsTransfer=!1,this.Scan=new o.d,this.batchNo=new o.d,this.NoofBins=new o.d,this.ProductName=new o.d,this.ProductCode=new o.d,this.WareHouse=new o.d,this.FromTO=new l.e,this.SortCols=new l.e,this.SortOrder=new l.e,this._ChkFifo=!1,this.DocId=0,this.DocDetailsId=0,this.ProductID=0,this.Div=0,this.Loc=0,this.ProdName="",this.Qty=0,this.InvQty=0,this.Tot=0,this.vol=0,this.Waist=0,this.dttemp=null,this.drSel=null,this.Parent=null,this.ParentDOc=null,this.dsBins=null,this.VoucherType=0,this.cnt=0,this.DimensionID=0,this.dimccid=0,this.batchid=0,this.dsBins=d,this.ProductID=n,this.ProdName=r,this.Qty=s,i.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=i.a.SessionManager.Preferences.DecimalsinQty){let e=this.Qty.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty);this.Qty=parseFloat(e)}this.Scan.Label="Scan",this.Scan.TextChangedCommand.Subscribe(this,"OnScan"),this.VoucherType=t,this.Parent=e,this.QtyAddMessage=a.e.Format(i.a.GetResource("Bins_AddMessage"),(0).ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty),this.Qty.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty),this.ProdName.toString()),this.Title="Bins";let C=0;this.IsTransfer=!1,this.FromTO.Visible=!1,this.WareHouse.Visible=!1,this.ProductCode.Visible=!1,this.ProductName.Visible=!1,this.batchNo.Visible=!1,this.NoofBins.Visible=!1,this.NoofBins.Label="No. Of Bins",this.SortCols.Items.push(l.d.ComboBoxItems_2("Bin No","Name")),this.SortCols.Items.push(l.d.ComboBoxItems_2("Available","Available")),this.SortCols.SelectedValue="Name",this.SortOrder.Items.push(l.d.ComboBoxItems_2("Ascending","Asc")),this.SortOrder.Items.push(l.d.ComboBoxItems_2("Descinding","Desc")),this.SortOrder.SelectedValue="Asc",this.BinsGrid=new h.a,this.BinsGrid.SearchVisible=!0,"AddEditDocumentViewModel"==(null===(D=this.Parent)||void 0===D?void 0:D.ClassName)?this.ParentDOc=this.Parent:"BatchNumberViewModel"==(null===(m=this.Parent)||void 0===m?void 0:m.ClassName)&&"AddEditDocumentViewModel"==(null===(b=this.Parent.Parent)||void 0===b?void 0:b.ClassName)&&(this.ParentDOc=this.Parent.Parent),null!=this.ParentDOc&&(this.ParentDOc.ScreenObject.Preferences.ContainsKey("BinFilterinPopup")&&"true"==this.ParentDOc.ScreenObject.Preferences.BinFilterinPopup.toLowerCase()&&this.ParentDOc.ScreenObject.Preferences.ContainsKey("BinFilterDim")&&""!=this.ParentDOc.ScreenObject.Preferences.BinFilterDim.toString()?(this.dimccid=a.e.Int(this.ParentDOc.ScreenObject.Preferences.BinFilterDim),this.dimccid>5e4?(this.FilterDim.CCID=this.dimccid,this.FilterDim.TypeID=1,this.FilterDim.Label=this.ParentDOc.ScreenObject.GetCostcenterName(this.FilterDim.CCID)):this.FilterDim.Visible=!1):this.FilterDim.Visible=!1,5!=this.ParentDOc.ScreenObject.DocumentType||this.ParentDOc.ScreenObject.GridDataColumns.Contains("RecievedQty")||(this.WareHouse.Visible=!0,this.FromTO.Visible=!0,this.FromTO.SelectionChangedCommand.Subscribe(this,"OnTypeChanged"),this.WareHouse.Label="WareHouse",this.FromTO.Label="Type",1==this.VoucherType?(this.FromTO.Items.push(l.d.ComboBoxItems_2("To","1")),this.FromTO.SelectedValue="1"):(this.FromTO.Items.push(l.d.ComboBoxItems_2("From","-1")),this.ParentDOc.IsToBinwise=null,this.ParentDOc.IsWarehouseBinwise(this.ParentDOc.ScreenObject.SelectedGridRowIndex,1,{DimensionID:0})&&this.FromTO.Items.push(l.d.ComboBoxItems_2("To","1")),this.FromTO.SelectedValue="AddEditDocumentViewModel"==(null===(S=this.Parent)||void 0===S?void 0:S.ClassName)&&!a.e.IsEmpty(u.BinsXML)&&a.e.String(u.TOBinsXML)?"1":"-1"),this.IsTransfer=!0),null!=u&&(this.drSel=u),null!=this.drSel&&(a.e.IsEmpty(this.drSel.DocDetailsID)||(this.DocDetailsId=parseInt(this.drSel.DocDetailsID)),a.e.IsEmpty(this.drSel.ProductName)||(this.ProductName.Visible=!0,this.ProductName.Label="Product Name",this.ProductName.Text=this.drSel.ProductName.toString()),a.e.IsEmpty(this.drSel.ProductCode)||(this.ProductCode.Visible=!0,this.ProductCode.Label="Product Code",this.ProductCode.Text=this.drSel.ProductCode.toString())),this.DocId=this.ParentDOc.ScreenObject.DocID,this.docdate=this.ParentDOc.DocumentDate),this.Refresh(!1)}get ChkFifo(){return this._ChkFifo}set ChkFifo(e){e!=this._ChkFifo&&(this._ChkFifo=e,this.AutoAdjust())}Refresh(e){var t,s;if(5==this.ParentDOc.ScreenObject.DocumentType&&(this.FromTO.Visible&&1==this.FromTO.Items.length&&"1"==this.FromTO.SelectedValue||1==this.VoucherType)){null!=this.drSel&&!a.e.IsEmpty(this.drSel.ToDocDetailsID)&&a.e.IsNum(this.drSel.ToDocDetailsID)&&(this.DocDetailsId=parseInt(this.drSel.ToDocDetailsID.toString()));let t=0,s=0;if(null!=this.ParentDOc&&i.a.SessionManager.Preferences.ContainsKey("DimensionwiseBins")&&!a.e.IsEmpty(i.a.SessionManager.Preferences.DimensionwiseBins)){let e=!1;if(t=a.e.IntTryParse(i.a.SessionManager.Preferences.DimensionwiseBins),t>0){this.DimensionID=1;for(let s=0;s<this.ParentDOc.ScreenObject._CCFields.length;s++){let i=this.ParentDOc.ScreenObject._CCFields[s];if(i instanceof c.b&&i.CCID==t){if(i.DBColumnName.Contains("TO"))i.SelectedValue>0&&(this.DimensionID=i.SelectedValue,this.WareHouse.Visible&&(this.WareHouse.Label=i.Label,this.WareHouse.Text=i.Text));else{var n=this.ParentDOc.ScreenObject._CCFields.find(e=>e.DBColumnName=="TO"+i.DBColumnName);null!=n&&n instanceof c.b?(n.SelectedValue>0&&(this.DimensionID=n.SelectedValue),this.WareHouse.Visible&&(this.WareHouse.Label=n.Label,this.WareHouse.Text=n.Text)):(i.SelectedValue>0&&(this.DimensionID=i.SelectedValue),this.WareHouse.Visible&&(this.WareHouse.Label=i.Label,this.WareHouse.Text=i.Text))}e=!0;break}}e||null!=this.drSel&&t>5e4&&this.Parent.ScreenObject.GridDataColumns.Contains("dcCCNID"+(t-5e4).toString()+"_Key")&&(this.Parent.ScreenObject.GridDataColumns.Contains("TOdcCCNID"+(t-5e4).toString()+"_Key")?a.e.IntTryParse(this.drSel["TOdcCCNID"+(t-5e4).toString()+"_Key"])>0&&(this.DimensionID=parseInt(this.drSel["TOdcCCNID"+(t-5e4).toString()+"_Key"].toString()),this.WareHouse.Visible&&(null!=(r=this.ParentDOc.ScreenObject.ColumnSource.find(e=>e.DisplayMember.toLowerCase()=="todcccnid"+(t-5e4).toString()))&&(this.WareHouse.Label=r.Header),this.WareHouse.Text=this.drSel["todcCCNID"+(t-5e4).toString()].toString())):a.e.IntTryParse(this.drSel["dcCCNID"+(t-5e4).toString()+"_Key"])>0&&(this.DimensionID=parseInt(this.drSel["dcCCNID"+(t-5e4).toString()+"_Key"].toString()),this.WareHouse.Visible&&(null!=(r=this.ParentDOc.ScreenObject.ColumnSource.find(e=>e.DisplayMember.toLowerCase()=="dcccnid"+(t-5e4).toString()))&&(this.WareHouse.Label=r.Header),this.WareHouse.Text=this.drSel["dcCCNID"+(t-5e4).toString()].toString())))}}this.ParentDOc.ScreenObject.Preferences.ContainsKey("BinFilterDim")&&!a.e.IsEmpty(this.ParentDOc.ScreenObject.Preferences.BinFilterDim)&&(this.dimccid=a.e.IntTryParse(this.ParentDOc.ScreenObject.Preferences.BinFilterDim),this.dimccid>0&&(s=this.ParentDOc.GetDimValue(this.dimccid,this.ParentDOc.SelectedRow)));let o=0;null==this.ParentDOc||null==this.drSel||-1!=this.VoucherType||a.e.IsEmpty(this.drSel.LinkedInvDocDetailsID)||(o=a.e.IntTryParse(this.drSel.LinkedInvDocDetailsID)),(null==this.dsBins||e)&&(this.dsBins=this.ParentDOc.ScreenObject.GetProductwiseBins(this.ProductID,this.DocId,this.VoucherType,this.docdate,t,this.DimensionID,this.dimccid,this.FilterDim.Visible?this.FilterDim.SelectedValue:s,o,this.batchid,0,this.ParentDOc.GetBOEIDS(this.ParentDOc.SelectedRow))),this.LoadFields(e)}else if(5==this.ParentDOc.ScreenObject.DocumentType&&this.FromTO.Visible&&2==this.FromTO.Items.length&&"1"==this.FromTO.SelectedValue)this.OnTypeChanged(null);else{let n=0,o=0,l=0;if(this.dimccid=0,null!=this.ParentDOc&&i.a.SessionManager.Preferences.ContainsKey("DimensionwiseBins")&&!a.e.IsEmpty(i.a.SessionManager.Preferences.DimensionwiseBins)){let e=!1;if(n=a.e.IntTryParse(i.a.SessionManager.Preferences.DimensionwiseBins.toString()),n>0){this.DimensionID=1;for(let t=0;t<this.ParentDOc.ScreenObject._CCFields.length;t++){const s=this.ParentDOc.ScreenObject._CCFields[t];if(s instanceof c.b&&s.CCID==n){this.DimensionID=s.SelectedValue,this.WareHouse.Visible&&(this.WareHouse.Label=s.Label,this.WareHouse.Text=s.Text),e=!0;break}}var r;!e&&null!=this.drSel&&n>5e4&&this.Parent.ScreenObject.GridDataColumns.Contains("dcCCNID"+(n-5e4).toString()+"_Key")&&!a.e.IsEmpty(this.drSel["dcCCNID"+(n-5e4).toString()+"_Key"])&&(this.WareHouse.Visible&&(null!=(r=this.ParentDOc.ScreenObject.ColumnSource.find(e=>e.DisplayMember.toLowerCase()=="dcccnid"+(n-5e4).toString()))&&(this.WareHouse.Label=r.Header),this.WareHouse.Text=this.drSel["dcCCNID"+(n-5e4).toString()].toString()),this.DimensionID=parseInt(this.drSel["dcCCNID"+(n-5e4).toString()+"_Key"].toString()))}}"BatchNumberViewModel"==(null===(t=this.Parent)||void 0===t?void 0:t.ClassName)&&null!=this.Parent.SelectedRow&&this.Parent.SelectedRow.TableColumns.Contains("BATCHNUMBER")&&(this.batchNo.Visible=!0,this.batchNo.Label="Batch No.",this.batchNo.Text=this.Parent.SelectedRow.BATCHNUMBER.toString()),-1==this.VoucherType&&"BatchNumberViewModel"==(null===(s=this.Parent)||void 0===s?void 0:s.ClassName)&&null!=this.Parent.SelectedRow&&(this.batchid=parseInt(this.Parent.SelectedRow.batchid.toString()),Object.keys(this.Parent.SelectedRow).Contains("VoucherNo")&&(l=parseInt(this.Parent.SelectedRow.RefInvID.toString()))),this.ParentDOc.ScreenObject.Preferences.ContainsKey("BinFilterDim")&&!a.e.IsEmpty(this.ParentDOc.ScreenObject.Preferences.BinFilterDim)&&(this.dimccid=a.e.IntTryParse(this.ParentDOc.ScreenObject.Preferences.BinFilterDim),this.dimccid>0&&(o=this.ParentDOc.GetDimValue(this.dimccid,this.ParentDOc.SelectedRow)));let h=0;null==this.ParentDOc||null==this.drSel||-1!=this.VoucherType||a.e.IsEmpty(this.drSel.LinkedInvDocDetailsID)||(h=a.e.IntTryParse(this.drSel.LinkedInvDocDetailsID)),(null==this.dsBins||e)&&(this.dsBins=this.ParentDOc.ScreenObject.GetProductwiseBins(this.ProductID,this.DocId,this.VoucherType,this.docdate,n,this.DimensionID,this.dimccid,this.FilterDim.Visible?this.FilterDim.SelectedValue:o,h,this.batchid,l,this.ParentDOc.GetBOEIDS(this.ParentDOc.SelectedRow))),this.LoadFields(e)}1==this.VoucherType&&this.ParentDOc.ScreenObject.Preferences.ContainsKey("NoOfBins")&&a.e.IntTryParse(this.ParentDOc.ScreenObject.Preferences.NoOfBins)>0&&this.cnt>0&&(this.NoofBins.Visible=!0,this.NoofBins.Text=this.cnt.toString())}OnScan(e,t){if(!a.e.IsEmpty(this.Scan.Text)&&"13"==t.keyCode){let e=this.BinsGrid.Table.filter(e=>e.Name=this.Scan.Text);0==e.length&&(e=this.BinsGrid.Table.filter(e=>e.Code==this.Scan.Text)),e.length>0&&(e[0].Allocate=a.e.IsEmpty(e[0].Allocate)?1:parseFloat(e[0].Allocate)+1,this.celledtiend(e[0]),this.Scan.Text="",event.preventDefault())}}OnTypeChanged(e){var t;let s=0,n=0,r=0;if(this.dimccid=0,"-1"==this.FromTO.SelectedValue){if(this.VoucherType=-1,null==this.drSel||null==this.drSel.DocDetailsID||a.e.IsEmpty(this.drSel.DocDetailsID)||(this.DocDetailsId=parseInt(this.drSel.DocDetailsID)),null!=this.ParentDOc&&i.a.SessionManager.Preferences.ContainsKey("DimensionwiseBins")&&""!=i.a.SessionManager.Preferences.DimensionwiseBins.toString()){let e=!1;if(s=a.e.IntTryParse(i.a.SessionManager.Preferences.DimensionwiseBins),s>0){this.DimensionID=1;for(let t=0;t<this.ParentDOc.ScreenObject._CCFields.length;t++){let i=this.ParentDOc.ScreenObject._CCFields[t];if(i instanceof c.b&&i.CCID==s){this.DimensionID=i.SelectedValue,this.WareHouse.Visible&&(this.WareHouse.Label=i.Label,this.WareHouse.Text=i.Text),e=!0;break}}!e&&this.drSel&&s>5e4&&this.Parent.ScreenObject.GridDataColumns.Contains("dcCCNID"+(s-5e4).toString()+"_Key")&&!a.e.IsEmpty(this.drSel["dcCCNID"+(s-5e4).toString()+"_Key"])&&(this.WareHouse.Visible&&((l=this.ParentDOc.ScreenObject.ColumnSource.find(e=>e.DisplayMember.toLowerCase()=="dcccnid"+(s-5e4).toString()))&&(this.WareHouse.Label=l.Header),this.WareHouse.Text=this.drSel["dcCCNID"+(s-5e4).toString()].toString()),this.DimensionID=parseInt(this.drSel["dcCCNID"+(s-5e4).toString()+"_Key"]))}}-1==this.VoucherType&&"BatchNumberViewModel"==(null===(t=this.Parent)||void 0===t?void 0:t.ClassName)&&null!=this.Parent.SelectedRow&&(this.batchid=parseInt(this.Parent.SelectedRow.batchid),this.Parent.SelectedRow.Row.TableColumns.Contains("VoucherNo")&&(n=parseInt(this.Parent.SelectedRow.RefInvID)))}else if(this.VoucherType=1,null!=this.drSel&&a.e.IsNum(this.drSel.ToDocDetailsID)&&(this.DocDetailsId=parseInt(this.drSel.ToDocDetailsID)),null!=this.ParentDOc&&i.a.SessionManager.Preferences.ContainsKey("DimensionwiseBins")&&""!=i.a.SessionManager.Preferences.DimensionwiseBins.toString()){let e=!1;if(s=a.e.IntTryParse(i.a.SessionManager.Preferences.DimensionwiseBins),s>0){this.DimensionID=1;for(let t=0;t<this.ParentDOc.ScreenObject._CCFields.length;t++){let i=this.ParentDOc.ScreenObject._CCFields[t];if(i instanceof c.b&&i.CCID==s){if(i.DBColumnName.Contains("TO"))i.SelectedValue>0&&(this.DimensionID=i.SelectedValue,this.WareHouse.Visible&&(this.WareHouse.Label=i.Label,this.WareHouse.Text=i.Text));else{var o=this.ParentDOc.ScreenObject._CCFields.find(e=>e.DBColumnName=="TO"+i.DBColumnName);o instanceof c.b?(o.SelectedValue>0&&(this.DimensionID=o.SelectedValue),this.WareHouse.Visible&&(this.WareHouse.Label=o.Label,this.WareHouse.Text=o.Text)):(i.SelectedValue>0&&(this.DimensionID=i.SelectedValue),this.WareHouse.Visible&&(this.WareHouse.Label=i.Label,this.WareHouse.Text=i.Text))}e=!0;break}}if(!e&&this.drSel&&s>5e4&&this.Parent.ScreenObject.GridDataColumns.Contains("dcCCNID"+(s-5e4).toString()+"_Key"))if(this.Parent.ScreenObject.GridDataColumns.Contains("TOdcCCNID"+(s-5e4).toString()+"_Key"))a.e.IntTryParse(this.drSel["TOdcCCNID"+(s-5e4).toString()+"_Key"])>0&&(this.DimensionID=parseInt(this.drSel["TOdcCCNID"+(s-5e4).toString()+"_Key"]),this.WareHouse.Visible&&((l=this.ParentDOc.ScreenObject.ColumnSource.find(e=>e.DisplayMember.toLowerCase()=="todcccnid"+(s-5e4).toString()))&&(this.WareHouse.Label=l.Header),this.WareHouse.Text=this.drSel["todcCCNID"+(s-5e4).toString()].toString()));else if(a.e.IntTryParse(this.drSel["dcCCNID"+(s-5e4).toString()+"_Key"])>0){var l;this.DimensionID=parseInt(this.drSel["dcCCNID"+(s-5e4).toString()+"_Key"]),this.WareHouse.Visible&&((l=this.ParentDOc.ScreenObject.ColumnSource.find(e=>e.DisplayMember.toLowerCase()=="dcccnid"+(s-5e4).toString()))&&(this.WareHouse.Label=l.Header),this.WareHouse.Text=this.drSel["dcCCNID"+(s-5e4).toString()].toString())}}}this.ParentDOc.ScreenObject.Preferences.ContainsKey("BinFilterDim")&&""!=this.ParentDOc.ScreenObject.Preferences.BinFilterDim.toString()&&(this.dimccid=a.e.IntTryParse(this.ParentDOc.ScreenObject.Preferences.BinFilterDim),this.dimccid>0&&(r=this.ParentDOc.GetDimValue(this.dimccid,this.ParentDOc.SelectedRow)));let h=0;null==this.ParentDOc||null==this.drSel||-1!=this.VoucherType||a.e.IsEmpty(this.drSel.LinkedInvDocDetailsID)||(h=a.e.IntTryParse(this.drSel.LinkedInvDocDetailsID)),this.dsBins=this.ParentDOc.ScreenObject.GetProductwiseBins(this.ProductID,this.DocId,this.VoucherType,this.docdate,s,this.DimensionID,this.dimccid,this.FilterDim.Visible?this.FilterDim.SelectedValue:r,h,this.batchid,n,this.ParentDOc.GetBOEIDS(this.ParentDOc.SelectedRow)),this.LoadFields(!1),1==this.VoucherType&&this.ParentDOc.ScreenObject.Preferences.ContainsKey("NoOfBins")&&a.e.Int(this.ParentDOc.ScreenObject.Preferences.NoOfBins)>0?(this.NoofBins.Visible=!0,this.NoofBins.Text=this.cnt.toString()):this.NoofBins.Visible=!1}LoadFields(e){var t,s,n;let o,h=[],c=[],d=[];if(d.push("Serialno"),d.push("NodeID"),d.push("Name"),d.push("Code"),d.push("Capacity"),d.push("BalQty"),d.push("Used"),d.push("Available"),d.push("Allocate"),this.ParentDOc.ScreenObject.Preferences.ContainsKey("bincapacityonVolume")&&"true"==this.ParentDOc.ScreenObject.Preferences.bincapacityonVolume.toLowerCase()&&1==this.VoucherType&&d.push("AvailQty"),this.ParentDOc.ScreenObject.Preferences.ContainsKey("ConsolidatedBins")&&"false"==this.ParentDOc.ScreenObject.Preferences.ConsolidatedBins.toLowerCase()&&d.push("Remarks"),this.BinsGrid.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.BinsGrid.OnBeginEdit.Subscribe(this,"OnBeginEdit"),this.BinsGrid.Width="630",null==this.dsBins||0==this.dsBins.Tables.length)return;this.dsBins.Columns[0].Contains("Vol")&&this.dsBins.Tables[0].length>0&&a.e.IsNum(this.dsBins.Tables[0][0].Vol)&&(this.vol=parseFloat(this.dsBins.Tables[0][0].Vol)),this.dsBins.Columns[0].Contains("waist")&&this.dsBins.Tables[0].length>0&&a.e.IsNum(this.dsBins.Tables[0][0].waist)&&(this.Waist=parseFloat(this.dsBins.Tables[0][0].waist));let u=new r.a;u.Header="Sno",u.DisplayMember="Serialno",u.DataType="TextBlock",u.ReadOnly=!0,u.Width=50,u.DisableTab=!0,h.push(u),u=new r.a,u.Header="Bin No",u.DisplayMember="Name",u.ReadOnly=!0,u.Width=150,u.DisableTab=!0,u.DataType="LINK",u.DisableTab=!0,u.Click.Subscribe(this,"onBinClick"),h.push(u),(this.ParentDOc.ScreenObject.Preferences.ContainsKey("ProductWiseBins")&&"true"==this.ParentDOc.ScreenObject.Preferences.ProductWiseBins.toLowerCase()||this.ParentDOc.ScreenObject.Preferences.ContainsKey("bincapacityonVolume")&&"true"==this.ParentDOc.ScreenObject.Preferences.bincapacityonVolume.toLowerCase())&&(u=new r.a,u.Header="Capacity",this.ParentDOc.ScreenObject.Preferences.ContainsKey("bincapacityonVolume")&&"true"==this.ParentDOc.ScreenObject.Preferences.bincapacityonVolume.toLowerCase()&&(1==this.VoucherType?u.Header="Volume":u.IsVisible=!1),u.DisplayMember="Capacity",u.DataType="FLOAT",u.ReadOnly=!0,u.Width=100,u.DisableTab=!0,h.push(u)),1==this.VoucherType&&(u=new r.a,u.Header="Used",u.DisplayMember="Used",u.DataType="FLOAT",u.ReadOnly=!0,u.Width=100,u.DisableTab=!0,h.push(u)),this.ParentDOc.ScreenObject.Preferences.ContainsKey("Waistage")&&"true"==this.ParentDOc.ScreenObject.Preferences.Waistage.toLowerCase()&&1==this.VoucherType&&(u=new r.a,u.Header="Wastage",u.DisplayMember="Waistage",u.ReadOnly=!0,u.DataType="FLOAT",u.Width=100,u.DisableTab=!0,h.push(u),d.push("Waistage")),(this.ParentDOc.ScreenObject.Preferences.ContainsKey("ProductWiseBins")&&"true"==this.ParentDOc.ScreenObject.Preferences.ProductWiseBins.toLowerCase()||this.ParentDOc.ScreenObject.Preferences.ContainsKey("bincapacityonVolume")&&"true"==this.ParentDOc.ScreenObject.Preferences.bincapacityonVolume.toLowerCase()||-1==this.VoucherType)&&(u=new r.a,u.Header="Available",u.DisplayMember="Available",u.ReadOnly=!0,u.DataType="FLOAT",u.Width=100,u.DisableTab=!0,h.push(u)),this.ParentDOc.ScreenObject.Preferences.ContainsKey("bincapacityonVolume")&&"true"==this.ParentDOc.ScreenObject.Preferences.bincapacityonVolume.toLowerCase()&&1==this.VoucherType&&(u=new r.a,u.Header="Qty Available",u.DisplayMember="AvailQty",u.ReadOnly=!0,u.DataType="FLOAT",u.Width=100,u.DisableTab=!0,h.push(u),this.BinsGrid.Width="730",this.Width=780),u=new r.a,u.Header="Allocate",u.DisplayMember="Allocate",u.DataType="FLOAT",u.Width=100,h.push(u),d.Contains("Remarks")&&(-1==this.VoucherType&&(u=new r.a,u.Header="Doc No",u.DisplayMember="DocNo",u.Width=100,u.DisableTab=!0,u.ReadOnly=!0,h.push(u),d.push("DocNo"),d.push("InvID")),u=new r.a,u.Header="Remarks",u.DisplayMember="Remarks",u.Width=100,u.DisableTab=!0,-1==this.VoucherType&&(u.ReadOnly=!0),h.push(u));let D="",m=new a.f;for(let i=0;i<this.ParentDOc.ScreenObject.GridData.length;i++)if(this.ParentDOc.ScreenObject.GridData[i]!=this.drSel&&a.e.String(this.ParentDOc.ScreenObject.GridData[i].ProductId_Key)==a.e.String(this.drSel.ProductId_Key)){if(!(1!=this.VoucherType||this.ParentDOc.ScreenObject.Preferences.ContainsKey("ProductWiseBins")&&"true"==this.ParentDOc.ScreenObject.Preferences.ProductWiseBins.toLowerCase()||this.ParentDOc.ScreenObject.Preferences.ContainsKey("bincapacityonVolume")&&"true"==this.ParentDOc.ScreenObject.Preferences.bincapacityonVolume.toLowerCase()))continue;if(-1==this.VoucherType&&this.batchid>0&&"5"==a.e.String(this.ParentDOc.ScreenObject.GridData[i].Type)&&!a.e.IsEmpty(this.ParentDOc.ScreenObject.GridData[i].ExtraXML)){let e=new a.f;e.LoadXml(this.ParentDOc.ScreenObject.GridData[i].ExtraXML);let t=e.SelectNodes("xml/Row");if(t.length>0&&null!=t[0].attributes.BatchID.value&&t[0].attributes.BatchID.value!=this.batchid.toString())continue}D+=a.e.String(5==this.ParentDOc.ScreenObject.DocumentType&&1==this.VoucherType?this.ParentDOc.ScreenObject.GridData[i].TOBinsXML:this.ParentDOc.ScreenObject.GridData[i].BinsXML)}if("BatchNumberViewModel"==(null===(t=this.Parent)||void 0===t?void 0:t.ClassName))for(let i=0;i<this.Parent.GridData.length;i++)if(this.Parent.GridData[i]!=this.Parent.SelectedRow){if(!(1!=this.VoucherType||this.ParentDOc.ScreenObject.Preferences.ContainsKey("ProductWiseBins")&&"true"==this.ParentDOc.ScreenObject.Preferences.ProductWiseBins.toLowerCase()||this.ParentDOc.ScreenObject.Preferences.ContainsKey("bincapacityonVolume")&&"true"==this.ParentDOc.ScreenObject.Preferences.bincapacityonVolume.toLowerCase()))continue;if(-1==this.VoucherType)continue;D+=5==this.ParentDOc.ScreenObject.DocumentType&&1==this.VoucherType?this.Parent.GridData[i].TOBinsXML.toString():this.Parent.GridData[i].BinsXML.toString()}""!=D&&(D=D.replace("<BinsXML>","").replace("</BinsXML>",""),D="<BinsXML>"+D+"</BinsXML>",m.ReadXml(D));for(let i=0;i<this.dsBins.Tables[0].length;i++){let t=this.BinsGrid.NewRow();if(t.Serialno=(i+1).toString(),t.NodeID=this.dsBins.Tables[0][i].NodeID.toString(),t.Name=this.dsBins.Tables[0][i].Name.toString(),t.Code=this.dsBins.Tables[0][i].Code.toString(),t.Capacity=this.ParentDOc.ScreenObject.Preferences.ContainsKey("bincapacityonVolume")&&"true"==this.ParentDOc.ScreenObject.Preferences.bincapacityonVolume.toLowerCase()&&this.dsBins.Columns[0].Contains("ccAlpha50")?a.e.StringValue(this.dsBins.Tables[0][i].ccAlpha50):a.e.StringValue(this.dsBins.Tables[0][i].Capacity),-1==this.VoucherType&&d.Contains("Remarks")&&this.dsBins.Columns[0].Contains("remarks")&&(t.Remarks=a.e.String(this.dsBins.Tables[0][i].remarks),null!=this.dsBins.Tables[0][i].invdocdetailsid&&(t.InvID=this.dsBins.Tables[0][i].invdocdetailsid),t.DocNo=this.dsBins.Tables[0][i].Voucherno.toString()),m.Tables.length>0){let e,s=0,n=0;e=-1==this.VoucherType&&d.Contains("InvID")&&m.Columns[0].Contains("RefID")&&!a.e.IsEmpty(t.InvID)?m.Tables[0].filter(e=>e.NodeID==this.dsBins.Tables[0][i].NodeID&&e.RefID==t.InvID):m.Tables[0].filter(e=>e.NodeID==this.dsBins.Tables[0][i].NodeID),1==this.VoucherType&&this.ParentDOc.ScreenObject.Preferences.ContainsKey("bincapacityonVolume")&&"true"==this.ParentDOc.ScreenObject.Preferences.bincapacityonVolume.toLowerCase()?e.forEach(e=>{!m.Columns[0].Contains("Vol")||a.e.IsEmpty(e.Allocate)||a.e.IsEmpty(e.Vol)||(s+=parseFloat(e.Allocate)*parseFloat(e.Vol)),!m.Columns[0].Contains("Waist")||a.e.IsEmpty(e.Allocate)||a.e.IsEmpty(e.Waist)||(n+=parseFloat(e.Allocate)*parseFloat(e.Waist))}):e.forEach(e=>{a.e.IsEmpty(e.Allocate)||(s+=parseFloat(e.Allocate))}),1==this.VoucherType?(s>0&&!a.e.IsEmpty(this.dsBins.Tables[0][i].BalQty)&&(this.dsBins.Tables[0][i].BalQty=parseFloat(this.dsBins.Tables[0][i].BalQty)+s),n>0&&this.dsBins.Columns[0].Contains("Waistage")&&!a.e.IsEmpty(this.dsBins.Tables[0][i].Waistage)&&(this.dsBins.Tables[0][i].Waistage=parseFloat(this.dsBins.Tables[0][i].Waistage)+n)):-1==this.VoucherType&&s>0&&!a.e.IsEmpty(this.dsBins.Tables[0][i].BalQty)&&(this.dsBins.Tables[0][i].BalQty=parseFloat(this.dsBins.Tables[0][i].BalQty)-s)}if(t.BalQty=this.dsBins.Tables[0][i].BalQty.toString(),a.e.IsEmpty(this.dsBins.Tables[0][i].BalQty)||(-1==this.VoucherType?t.Available=this.dsBins.Tables[0][i].BalQty.toString():t.Used=this.dsBins.Tables[0][i].BalQty.toString(),d.Contains("Waistage")&&this.dsBins.Columns[0].Contains("Waistage")&&(t.Waistage=this.dsBins.Tables[0][i].Waistage.toString()),1==this.VoucherType&&a.e.IsNum(t.Capacity)&&(this.ParentDOc.ScreenObject.Preferences.ContainsKey("ProductWiseBins")&&"true"==this.ParentDOc.ScreenObject.Preferences.ProductWiseBins.toLowerCase()||this.ParentDOc.ScreenObject.Preferences.ContainsKey("bincapacityonVolume")&&"true"==this.ParentDOc.ScreenObject.Preferences.bincapacityonVolume.toLowerCase())&&(o=parseFloat(t.Capacity)-parseFloat(this.dsBins.Tables[0][i].BalQty),this.dsBins.Columns[0].Contains("Waistage")&&(o-=parseFloat(this.dsBins.Tables[0][i].Waistage)),t.Available=o>0?o:0),d.Contains("AvailQty")&&!a.e.IsEmpty(t.Available)&&this.vol>0&&(t.AvailQty=Math.trunc(parseFloat(t.Available)/this.vol))),this.FilterDim.Visible&&e&&null!=this.dttemp){let e=null;e=this.dsBins.Columns[0].Contains("invdocdetailsid")&&!a.e.IsEmpty(this.dsBins.Tables[0][i].invdocdetailsid)?this.dttemp.filter(e=>e.NodeID==t.NodeID.toString()&&e.InvID==this.dsBins.Tables[0][i].invdocdetailsid.toString()):this.dttemp.filter(e=>e.NodeID==t.NodeID.toString()),null!=e&&e.length>0&&!a.e.IsEmpty(e[0].Allocate)&&(t.Allocate=e[0].Allocate.toString())}c.push(t)}for(let i=c.length;i<15;i++)c.push();if(!e){this.FilterDim.Visible&&this.AddColumns();let e=new a.f;if("AddEditDocumentViewModel"==(null===(s=this.Parent)||void 0===s?void 0:s.ClassName)&&null!=this.drSel){if(5==this.ParentDOc.ScreenObject.DocumentType&&1==this.VoucherType){if(!a.e.IsEmpty(this.drSel.TOBinsXML)){e.LoadXml(this.drSel.TOBinsXML);let t=e.SelectNodes("BinsXML/Row");for(let e=0;e<t.length;e++){this.FilterDim.Visible&&this.AddRow(t[e]);for(let s=0;s<c.length;s++){let i=c[s];if(i.NodeID.toString()==t[e].attributes.NodeID.value.toString()){i.Allocate=t[e].attributes.Allocate.value.toString(),1==this.VoucherType&&d.Contains("Remarks")&&null!=t[e].attributes.Remarks&&!a.e.IsEmpty(t[e].attributes.Remarks.value)&&(i.Remarks=t[e].attributes.Remarks.value);break}}}}}else if(!a.e.IsEmpty(this.drSel.BinsXML)){e.LoadXml(this.drSel.BinsXML);let t=e.SelectNodes("BinsXML/Row");for(let e=0;e<t.length;e++){this.FilterDim.Visible&&this.AddRow(t[e]);for(let s=0;s<c.length;s++){let i=c[s];if(i.NodeID.toString()==t[e].attributes.NodeID.value.toString()&&(!d.Contains("InvID")||null!=t[e].attributes.RefID&&!a.e.IsEmpty(t[e].attributes.RefID.value)&&i.InvID.toString()==t[e].attributes.RefID.value)){i.Allocate=t[e].attributes.Allocate.value.toString(),1==this.VoucherType&&d.Contains("Remarks")&&null!=t[e].attributes.Remarks&&!a.e.IsEmpty(t[e].attributes.Remarks.value)&&(i.Remarks=t[e].attributes.Remarks.value);break}}}}}else if("BatchNumberViewModel"==(null===(n=this.Parent)||void 0===n?void 0:n.ClassName)&&null!=this.Parent.SelectedRow)if(5==this.ParentDOc.ScreenObject.DocumentType&&1==this.VoucherType){if(!a.e.IsEmpty(this.Parent.SelectedRow.TOBinsXML)){e.LoadXml(this.Parent.SelectedRow.TOBinsXML);let t=e.SelectNodes("BinsXML/Row");for(let e=0;e<t.length;e++){this.FilterDim.Visible&&this.AddRow(t[e]);for(let s=0;s<c.length;s++){let i=c[s];if(i.NodeID.toString()==t[e].attributes.NodeID.value){i.Allocate=t[e].attributes.Allocate.value.toString();break}}}}}else if(!a.e.IsEmpty(this.Parent.SelectedRow.BinsXML)){e.LoadXml(this.Parent.SelectedRow.BinsXML);let t=e.SelectNodes("BinsXML/Row");for(let e=0;e<t.length;e++){this.FilterDim.Visible&&this.AddRow(t[e]);for(let s=0;s<c.length;s++){let i=c[s];if(i.NodeID.toString()==t[e].attributes.NodeID.value){i.Allocate=t[e].attributes.Allocate.value.toString();break}}}}}this.BinsGrid.Columns=h,this.BinsGrid.Table=c,this.BinsGrid.TableColumns=d,this.BinsGrid.SearchVisible=!0,this.BinsGrid.SearchText.SetFocus=!0,this.BinsGrid.SearchColStartIndex=1,this.BinsGrid.AddSearchCols(),this.CalcTotal(),this.ImportCols=[],this.DtImport=[],this.DtImportColumns=[],u=new r.a,u.DisplayMember="FieldName",u.Header=i.a.GetResource("Import_FieldName"),u.DataType="TextBlock",u.Width=100,u.ReadOnly=!0,this.ImportCols.push(u),this.DtImportColumns.push("FieldName"),u=new r.a,u.DisplayMember="Name",u.ValueMember="Value",u.ValueBinding="FeatureFieldName",u.Header=i.a.GetResource("Import_FeatureFieldName"),u.DataType="ComboBox",u.Width=120;let b=[];b.push(l.d.ComboBoxItems_2("","")),b.push(l.d.ComboBoxItems_2("Bin No","Bin")),b.push(l.d.ComboBoxItems_2("Product Name","Product")),b.push(l.d.ComboBoxItems_2("Allocate","Qty")),u.ComboData=b,this.ImportCols.push(u),this.DtImportColumns.push("FeatureFieldName")}AddRow(e){let t={};null==e.attributes.NodeID||a.e.IsEmpty(e.attributes.NodeID.value)||(t.NodeID=e.attributes.NodeID.Value),null==e.attributes.Allocate||a.e.IsEmpty(e.attributes.Allocate.value)||(t.Allocate=e.attributes.Allocate.Value),null==e.attributes.Remarks||a.e.IsEmpty(e.attributes.Remarks.value)||(t.Remarks=e.attributes.Remarks.Value),null==e.attributes.RefID||a.e.IsEmpty(e.attributes.RefID.value)||(t.InvID=e.attributes.RefID.Value),this.dttemp.push(t)}onBinClick(e){if(null!=this.BinsGrid.SelectedItem&&!a.e.IsEmpty(this.BinsGrid.SelectedItem.NodeID)){let e=new d.DocumentDraftsViewModel(this,5);{let t=this.ParentDOc.ScreenObject.GetProductsinBin(this.BinsGrid.SelectedItem.NodeID.toString());if(null!=t&&t.Tables.length>0&&t.Columns[0].Contains("ProductCode")){e.ColSource=[],e.Table=[],e.TableColumns=[];let s=new r.a;s.DisplayMember="ProductCode",s.Header=i.a.GetResource("ProductCode"),s.DataType="TextBlock",s.Width=200,s.ReadOnly=!0,s.TextAlign="left",e.ColSource.push(s),e.TableColumns.push("ProductCode"),s=new r.a,s.DisplayMember="ProductName",s.Header=i.a.GetResource("ProductName"),s.DataType="TextBlock",s.Width=200,s.ReadOnly=!0,e.ColSource.push(s),e.TableColumns.push("ProductName"),s=new r.a,s.DisplayMember="Quantity",s.Header=i.a.GetResource("Quantity"),s.DataType="FLOAT",s.Width=70,s.ReadOnly=!0,e.ColSource.push(s),e.TableColumns.push("Quantity"),e.DisplayName="Bins Info ["+this.BinsGrid.SelectedItem.Name.toString()+"]",e.PopupWidth=490;for(let i=0;i<t.Tables[0].length;i++){let s=e.Grid.NewRow();s.ProductCode=t.Tables[0][i].ProductCode.toString(),s.ProductName=t.Tables[0][i].ProductName.toString(),s.Quantity=t.Tables[0][i].Qty.toString(),e.Grid.addRow(s)}i.a.page.ShowDialog(e,u.DocumentDraftsComponent)}}}}OnBeginEdit(e,t,s){if("Allocate"==t){if(i.a.SessionManager.IsActionAssigned(43,"Mandatory Scan Bin"))return!0;this.SelectQty(e)}return!1}SelectQty(e){let t=a.e.DoubleTryParse(e.Allocate);if(a.e.IsEmpty(e.Allocate)||0==t){let t=0,s=new Array;for(let e=0;e<this.BinsGrid.Table.length;e++)a.e.IsEmpty(this.BinsGrid.Table[e].Allocate)||a.e.IsEmpty(this.BinsGrid.Table[e].NodeID)||(s.push(this.BinsGrid.Table[e].NodeID.toString()),t+=parseFloat(this.BinsGrid.Table[e].Allocate));if(null!=this.dttemp)for(let e=0;e<this.dttemp.length;e++)a.e.IsEmpty(this.dttemp[e].NodeID)||s.Contains(this.dttemp[e].NodeID.toString())||(t+=parseFloat(this.dttemp[e].Allocate));t=this.Qty-t,t>0&&(-1==this.VoucherType||this.ParentDOc.ScreenObject.Preferences.ContainsKey("ProductWiseBins")&&"true"==this.ParentDOc.ScreenObject.Preferences.ProductWiseBins.toLowerCase()&&(!this.ParentDOc.ScreenObject.Preferences.ContainsKey("bincapacityonVolume")||"true"!=this.ParentDOc.ScreenObject.Preferences.bincapacityonVolume.toLowerCase())?a.e.IsEmpty(e.Available)||(e.Allocate=t>parseFloat(e.Available)?e.Available:t):e.Allocate=t)}}OnCellEditEnding(e){"DataGridComboBoxColumn"!=e.column.className&&"Allocate"==e.column.field&&this.celledtiend(e.item)}celledtiend(e){let t=!1;(-1==this.VoucherType||this.ParentDOc.ScreenObject.Preferences.ContainsKey("DonotExceedCapacity")&&"true"==this.ParentDOc.ScreenObject.Preferences.DonotExceedCapacity.toLowerCase()&&1==this.VoucherType&&(this.ParentDOc.ScreenObject.Preferences.ContainsKey("ProductWiseBins")&&"true"==this.ParentDOc.ScreenObject.Preferences.ProductWiseBins.toLowerCase()||this.ParentDOc.ScreenObject.Preferences.ContainsKey("bincapacityonVolume")&&"true"==this.ParentDOc.ScreenObject.Preferences.bincapacityonVolume.toLowerCase()))&&(t=!0),!t||a.e.IsEmpty(e.Available)||a.e.IsEmpty(e.Allocate)||(1==this.VoucherType&&this.ParentDOc.ScreenObject.Preferences.ContainsKey("bincapacityonVolume")&&"true"==this.ParentDOc.ScreenObject.Preferences.bincapacityonVolume.toLowerCase()?!a.e.IsEmpty(e.AvailQty)&&parseFloat(e.AvailQty)<parseFloat(e.Allocate)&&(e.Allocate=e.AvailQty.toString(),this.DisplayMessage="Can not enter more than "+e.AvailQty.toString(),this.MessageVisibility=!0,this.BinsGrid.updateRow(e)):parseFloat(e.Available)<parseFloat(e.Allocate)&&(e.Allocate=e.Available,this.DisplayMessage="Can not enter more than "+e.Available.toString(),this.MessageVisibility=!0,this.BinsGrid.updateRow(e))),this.CalcTotal()}CalcTotal(){this.InvQty=0;let e=new Array;for(let t=0;t<this.BinsGrid.Table.length;t++)a.e.IsEmpty(this.BinsGrid.Table[t].Allocate)||a.e.IsEmpty(this.BinsGrid.Table[t].NodeID)||(e.push(this.BinsGrid.Table[t].NodeID.toString()),this.InvQty+=parseFloat(this.BinsGrid.Table[t].Allocate));if(null!=this.dttemp)for(let t=0;t<this.dttemp.length;t++)a.e.IsEmpty(this.dttemp[t].NodeID)||e.Contains(this.dttemp[t].NodeID.toString())||(this.InvQty+=parseFloat(this.dttemp[t].Allocate));this.QtyAddMessage=a.e.Format(i.a.GetResource("Bins_AddMessage"),this.InvQty.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty),this.Qty.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty),this.ProdName.toString())}AddColumns(){this.dttemp=[]}OnSave(e){var t,s,n,r,o,l,h,c;if("Cancel"==e.toString())i.a.page.HideDialog();else if("Refresh"==e.toString())a.e.IntTryParse(this.NoofBins.Text);else if("Load"==e.toString()){null==this.dttemp&&this.AddColumns();for(let e=0;e<this.BinsGrid.Table.length;e++)if(!a.e.IsEmpty(this.BinsGrid.Table[e].NodeID)&&!a.e.IsEmpty(this.BinsGrid.Table[e].Allocate)&&parseFloat(this.BinsGrid.Table[e].Allocate.toString())>0){let t;var d=this.dttemp.filter(t=>t.NodeID==this.BinsGrid.Table[e].NodeID.toString());d.length>0?t=d[0]:(t=this.dttemp.NewRow(),this.dttemp.push(t)),t.NodeID=this.BinsGrid.Table[e].NodeID.toString(),t.Allocate=this.BinsGrid.Table[e].Allocate.toString(),1==this.VoucherType&&this.BinsGrid.TableColumns.Contains("Remarks")?t.Remarks=this.BinsGrid.Table[e].Remarks.toString():-1==this.VoucherType&&this.BinsGrid.TableColumns.Contains("InvID")&&(t.InvID=this.BinsGrid.Table[e].InvID.toString())}this.Refresh(!0)}else if("Sort"==e.toString()){let e="";this.BinsGrid.TableColumns.Contains("EmptySort")||this.BinsGrid.TableColumns.push("EmptySort"),a.e.IsEmpty(this.SortCols.SelectedValue)||(e="EmptySort,",e+=this.SortCols.SelectedValue,a.e.IsEmpty(this.SortOrder.SelectedValue)||(e+=" "+this.SortOrder.SelectedValue))}else if("ImportVisiblity"==e.toString())this.Width=this.BinsGrid.TableColumns.Contains("AvailQty")?1030:950,this.ImportVisiblity=!0;else if("CancelImport"==e.toString())this.ImportVisiblity=!1,this.Width=this.BinsGrid.TableColumns.Contains("AvailQty")?780:700;else if("Import"==e.toString())this.ImportData();else if("Open"==e.toString());else if("openfile"==e.toString());else if("Save"==e.toString()||"AutoSave"==e.toString()||"OK"==e.toString()){let d=0,u=new Array;for(let e=0;e<this.BinsGrid.Table.length;e++)a.e.IsEmpty(this.BinsGrid.Table[e].NodeID)||a.e.IsNum(this.BinsGrid.Table[e].Allocate)&&(u.push(this.BinsGrid.Table[e].NodeID.toString()),d+=parseFloat(this.BinsGrid.Table[e].Allocate));if(null!=this.dttemp)for(let e=0;e<this.dttemp.length;e++)a.e.IsEmpty(this.dttemp[e].NodeID)||u.Contains(this.dttemp[e].NodeID.toString())||(d+=parseFloat(this.dttemp[e].Allocate));if(i.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=i.a.SessionManager.Preferences.DecimalsinQty){let e=d.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty);d=parseFloat(e)}if(this.ParentDOc.ScreenObject.GridDataColumns.Contains("BinStatus")){if(d>this.Qty)return this.DisplayMessage="Can not adjust more than product qty.",void(this.MessageVisibility=!0)}else if(d!=this.Qty)return this.DisplayMessage="Qty not equal",void(this.MessageVisibility=!0);let D="",m="";m+="<BinsXML>";for(let e=0;e<this.BinsGrid.Table.length;e++)!a.e.IsEmpty(this.BinsGrid.Table[e].NodeID)&&!a.e.IsEmpty(this.BinsGrid.Table[e].Allocate)&&parseFloat(this.BinsGrid.Table[e].Allocate)>0&&(m+="<Row ",m+=' NodeID="'+this.BinsGrid.Table[e].NodeID.toString()+'" ',m+=' Allocate="'+this.BinsGrid.Table[e].Allocate.toString()+'" ',this.DimensionID>0&&(m+=' Warehouse="'+this.DimensionID+'" '),1==this.VoucherType&&(m+=' Vol="'+this.vol+'" ',m+=' Waist="'+this.Waist+'" '),1==this.VoucherType&&this.BinsGrid.TableColumns.Contains("Remarks")?m+=' Remarks="'+a.e.String(this.BinsGrid.Table[e].Remarks)+'" ':-1==this.VoucherType&&this.BinsGrid.TableColumns.Contains("InvID")&&(m+=' RefID="'+this.BinsGrid.Table[e].InvID.toString()+'" '),m+=" ></Row>",""!=D&&(D=", "),D+=this.BinsGrid.Table[e].Name.toString());if(null!=this.dttemp)for(let e=0;e<this.dttemp.length;e++)a.e.IsEmpty(this.dttemp[e].NodeID)||u.Contains(this.dttemp[e].NodeID.toString())||(m+="<Row ",m+=' NodeID="'+this.dttemp[e].NodeID.toString()+'" ',m+=' Allocate="'+this.dttemp[e].Allocate.toString()+'" ',this.DimensionID>0&&(m+=' Warehouse="'+this.DimensionID+'" '),1==this.VoucherType&&(m+=' Vol="'+this.vol+'" ',m+=' Waist="'+this.Waist+'" '),1==this.VoucherType&&this.BinsGrid.TableColumns.Contains("Remarks")?m+=' Remarks="'+this.dttemp[e].Remarks.toString()+'" ':-1==this.VoucherType&&this.BinsGrid.TableColumns.Contains("InvID")&&(m+=' RefID="'+this.dttemp[e].InvID.toString()+'" '),m+=" ></Row>");if(m+="</BinsXML>",5==this.ParentDOc.ScreenObject.DocumentType&&1==this.VoucherType)"AddEditDocumentViewModel"==(null===(t=this.Parent)||void 0===t?void 0:t.ClassName)?this.drSel.TOBinsXML=m:"BatchNumberViewModel"==(null===(s=this.Parent)||void 0===s?void 0:s.ClassName)&&null!=this.Parent.SelectedRow&&(this.Parent.SelectedRow.TOBinsXML=m);else if("AddEditDocumentViewModel"==(null===(n=this.Parent)||void 0===n?void 0:n.ClassName)){this.drSel.BinsXML=m,this.ParentDOc.ScreenObject.GridDataColumns.Contains("BinStatus")&&(0==d?(this.drSel.BinStatus="UnAdjusted",this.drSel.BinStatus_COLOR="RED"):d==this.Qty?(this.drSel.BinStatus="Adjusted",this.drSel.BinStatus_COLOR="GREEN"):(this.drSel.BinStatus="Partial",this.drSel.BinStatus_COLOR="ORANGE"));let e=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&55494==e.LinkData);e.length>0&&this.Parent.ScreenObject.GridDataColumns.Contains(e[0].SysColumnName.toString())&&(this.drSel[e[0].SysColumnName.toString()]=D)}else"BatchNumberViewModel"==(null===(r=this.Parent)||void 0===r?void 0:r.ClassName)&&null!=this.Parent.SelectedRow&&(this.Parent.SelectedRow.BinsXML=m,this.Parent.SelectedRow.strBins=D);if("AutoSave"!=e.toString()&&"OK"!=e.toString()){if(5==this.ParentDOc.ScreenObject.DocumentType&&this.FromTO.Items.length>1){let e="";if(1==this.VoucherType?"AddEditDocumentViewModel"==(null===(o=this.Parent)||void 0===o?void 0:o.ClassName)?e=this.drSel.BinsXML.toString():"BatchNumberViewModel"==(null===(l=this.Parent)||void 0===l?void 0:l.ClassName)&&null!=this.Parent.SelectedRow&&(e=this.Parent.SelectedRow.BinsXML.toString()):-1==this.VoucherType&&("AddEditDocumentViewModel"==(null===(h=this.Parent)||void 0===h?void 0:h.ClassName)?e=this.drSel.TOBinsXML.toString():"BatchNumberViewModel"==(null===(c=this.Parent)||void 0===c?void 0:c.ClassName)&&null!=this.Parent.SelectedRow&&(e=this.Parent.SelectedRow.TOBinsXML.toString())),d=0,""!=e){let t=new a.f;t.LoadXml(e);let s=t.SelectNodes("BinsXML/Row");for(let e=0;e<s.length;e++)null!=s[e].attributes.Allocate&&a.e.IsNum(s[e].attributes.Allocate.value)&&(d+=parseFloat(s[e].attributes.Allocate.value))}if(i.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=i.a.SessionManager.Preferences.DecimalsinQty){let e=d.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty);d=parseFloat(e)}if(d!=this.Qty)return this.DisplayMessage=1==this.VoucherType?"Select from bins":"Select to bins",void(this.MessageVisibility=!0)}i.a.page.HideDialog()}}}AutoAdjust(){if(this.ChkFifo)this.BinsGrid.Table.forEach(e=>{a.e.IsEmpty(e.NodeID)||(this.SelectQty(e),this.celledtiend(e),this.BinsGrid.updateRow(e))});else for(let e=0;e<this.BinsGrid.Table.length;e++)a.e.IsEmpty(this.BinsGrid.Table[e].NodeID)||(this.BinsGrid.Table[e].Allocate=0,this.BinsGrid.updateRow(this.BinsGrid.Table[e]));this.CalcTotal()}ImportData(){for(let e=0;e<this.ExcelTable.length;e++){let t=0,s="";for(let i=0;i<this.DtImport.length;i++){let n=this.DtImport[i];a.e.String(n[1])||"0"==a.e.String(n[1])||("Qty"==n[1].toString()&&(t=0,a.e.IsNum(this.ExcelTable[e][n[0].toString()])&&(t=parseFloat(this.ExcelTable[e][n[0].toString()]))),"Bin"==n[1].toString()&&(s=this.ExcelTable[e][n[0].toString()].toString()),"Product"!=n[1].toString()||this.ExcelTable[e][n[0].toString()].toString())}if(""!=s&&t>0){let e=this.BinsGrid.Table.filter(e=>e.Name=s);e.length>0&&(e[0].Allocate=t,this.celledtiend(e[0]))}}}}},"7eIC":function(e,t,s){"use strict";s.d(t,"a",(function(){return D}));var i=s("Do2H"),a=s("Lp6j"),n=s("eQJW"),r=s("ScVY"),o=s("6z9j"),l=s("NkMH"),h=s("gqOg"),c=s("WJZp"),d=s("ZDA+"),u=s("EQd/");class D extends r.b{constructor(){super(),this.ClearSelectedNodes=!1,this._SelectAll=!1,this.ScanText=new u.d(0),this.ButtonSearch=new l.a,this.PendingList=!1,this.ScanText.Visible=!1,this.ClassName="SearchDocumentViewModel"}get SelectAll(){return this._SelectAll}set SelectAll(e){e!=this._SelectAll&&(this._SelectAll=e,this.selectRecords(e))}selectRecords(e){this.tree[0].Rows.forEach(t=>{this.tree[0].SelectNode_1(t,e)}),this.tree[0].RefreshSelectionText(),this.tree[0].treecomp.gridObj.invalidate()}GetSeqNosList(){if(null==this.SelectedNodes)return"";let e="";return this.SelectedNodes.forEach(t=>{e+=t.Id+","}),e.length>0?e=e.Remove(e.length-1,1):e+="0",e}SearchDocumentViewModel_3(e,t){this.JVParent=e,this.ButtonSearch.Enable=!0,this.tree=[];let s=new o.a;this.Where="  a.StatusID =(Select StatusID from Com_status with(nolock) where status='Active' and costcenterid="+t+")";let i=new Array;for(let n=0;n<e.JVGrid.Table.length;n++)if(!a.e.IsEmpty(e.JVGrid.Table[n].DimID_Key)){let t=new d.a;t.Id=parseInt(e.JVGrid.Table[n].DimID_Key.toString()),i.push(t)}s.TreeViewModel_7(t,this,this.Where,i),s.HeaderVisiblity=!1,s.ViewsVisible=!1,this.tree.push(s)}SearchDocumentViewModel_1(e,t,s,a,n,r,l,h,c,d){this.Parent=e,this.ButtonSearch.Enable=!0,this.docdate=a,this.duedate=n,this.Loc=r,this.div=l,this.Where=h,this.selectedDocs=c,this.LinkDefID=t,this.PendingList=d,this.tree=[];let u=new o.a;e.ScreenObject.Preferences.ContainsKey("jobCCID")&&""!=e.ScreenObject.Preferences.jobCCID.toString()&&parseInt(e.ScreenObject.Preferences.jobCCID.toString())>5e4&&"158"==s?(h="  a.Isgroup=0 and a.StatusID =(Select StatusID from Com_status with(nolock) where status='Active' and costcenterid="+e.ScreenObject.Preferences.jobCCID.toString()+")",u.TreeViewModel(parseInt(e.ScreenObject.Preferences.jobCCID.toString()),this,0,h,a,n,r,l,t,c)):u.TreeViewModel(parseInt(s),this,this.PendingList&&parseInt(this.Parent.ScreenObject.Data.Tables[6].filter(e=>e.CostCenterIDLinked==s)[0].ViewID.toString())>0?parseInt(this.Parent.ScreenObject.Data.Tables[6].filter(e=>e.CostCenterIDLinked==s)[0].ViewID.toString()):278,h,a,n,r,l,t,c),u.HeaderVisiblity=!1,u.ViewsVisible=!1,this.tree.push(u),this.Title=i.a.GetResource("Search"),e.ScreenObject.Preferences.ContainsKey("PendingListScan")&&"True"==e.ScreenObject.Preferences.PendingListScan.toString()&&(this.ScanText.Visible=!0,this.ScanText.SetFocus=!0,this.ScanText.TextChangedCommand.Subscribe(this,"onScanKeyDown"))}onScanKeyDown(e,t){if("13"==t.keyCode){for(let e=0;e<this.tree[0].AllNodes.length;e++)if(this.tree[0].AllNodes[e].Text[0].toLowerCase()==this.ScanText.Text.toLowerCase()){this.tree[0].SelectSearchNode(this.tree[0].AllNodes[e]),this.tree[0].SelectNode_1(this.tree[0].AllNodes[e],!0),a.e.PlaySound("beep-02.wav"),this.ScanText.Text="";break}""!=this.ScanText.Text&&a.e.PlaySound("beep-01.wav")}}Refresh(){null!=this.tree&&this.tree.length>0&&(this.tree[0].RefreshData=!0)}OnSearch(e){if("OK"==e.toString())this.SelectDcument();else if("Cancel"==e.toString())null!=this.Parent&&(this.Parent.DialogResult=!1),i.a.page.HideDialog();else if("SearchProd"==e.toString()){this.ButtonSearch.Enable=!1,this.tree.Clear();let e=new o.a;e.TreeViewModel(40011,this,280,this.Where,this.docdate,this.duedate,this.Loc,this.div,this.LinkDefID,this.selectedDocs),e.HeaderVisiblity=!1,e.ViewsVisible=!1,this.tree.push(e)}}FillBoms(){let e="";if(null!=this.SelectedNodes&&this.SelectedNodes.length>1)for(let t=0;t<this.SelectedNodes.length;t++)""!=e&&(e+=","),e+=this.SelectedNodes[t].Id}CommandController(e){this.SelectDcument()}Addrows(){if(null!=this.SelectedNodes&&this.SelectedNodes.length>1){for(let e=0;e<this.SelectedNodes.length;e++)if(!this.SelectedNodes[e].IsGroup&&0==this.JVParent.JVGrid.Table.filter(t=>t.DimID_Key==this.SelectedNodes[e].Id).length){let t=this.JVParent.parent.GetEmptyRowPosition(this.JVParent.JVGrid,"DimID_Key");this.JVParent.JVGrid.Table[t].DimID=this.SelectedNodes[e].Text[1],this.JVParent.JVGrid.Table[t].DimID_Key=this.SelectedNodes[e].Id,this.JVParent.JVGrid.updateRow(this.JVParent.JVGrid.Table[t])}}else if(null!=this.SelectedNode&&!this.SelectedNode.IsGroup&&0==this.JVParent.JVGrid.Table.filter(e=>e.DimID_Key==this.SelectedNode.Id).length){let e=this.JVParent.parent.GetEmptyRowPosition(this.JVParent.JVGrid,"DimID_Key");this.JVParent.JVGrid.Table[e].DimID=this.SelectedNode.Text[1],this.JVParent.JVGrid.Table[e].DimID_Key=this.SelectedNode.Id,this.JVParent.JVGrid.updateRow(this.JVParent.JVGrid.Table[e])}}SelectDcument(){if(i.a.page.HideDialog(),null==this.JVParent)if(null==this.MOParent){if(null!=this.SelectedNodes&&this.SelectedNodes.length>1&&this.Parent.ScreenObject.Preferences.ContainsKey("Selective")&&Object(n.j)(this.Parent.ScreenObject.Preferences.Selective)){let e="";for(let t=0;t<this.SelectedNodes.length;t++)for(let s=0;s<this.Parent.ScreenObject.Link.DocumentList.Items.length;s++)parseInt(this.Parent.ScreenObject.Link.DocumentList.Items[s].Value)==this.SelectedNodes[t].Id&&(this.Parent.ScreenObject.Link.DocumentList.Items[s].IsChecked&&this.Parent.ScreenObject.GridData.filter(e=>e.RefNo==this.Parent.ScreenObject.Link.DocumentList.Items[s].Name).length>0||(this.Parent.IsSelectAll=!0,this.Parent.ScreenObject.Link.DocumentList.Items[s].IsChecked=!0,e+=this.Parent.ScreenObject.Link.DocumentList.Items[s].Name,t+1<this.SelectedNodes.length&&(e+="','")),this.Parent.IsSelectAll=!1);i.a.page.ShowDialog(new h.a(this.Parent,e,parseInt(this.Parent.ScreenObject.Link.LinkCombo.SelectedValue),0,!1),c.a)}else if(null!=this.SelectedNodes&&this.SelectedNodes.length>0)this.SelectedNodes.forEach(e=>{for(let t=0;t<this.Parent.ScreenObject.Link.DocumentList.Items.length;t++)parseInt(this.Parent.ScreenObject.Link.DocumentList.Items[t].Value)==e.Id&&(this.Parent.ScreenObject.Link.DocumentList.Items[t].IsChecked||(this.Parent.IsSelectAll=!0,this.Parent.ScreenObject.Link.DocumentList.Items[t].IsChecked=!0),this.Parent.IsSelectAll=!1,this.Parent.OnLinkDocumentCheckedChanged(this.Parent.ScreenObject.Link.DocumentList.Items[t]))});else if(null!=this.SelectedNode)for(let e=0;e<this.Parent.ScreenObject.Link.DocumentList.Items.length;e++)parseInt(this.Parent.ScreenObject.Link.DocumentList.Items[e].Value)==this.SelectedNode.Id&&(this.Parent.ScreenObject.Link.DocumentList.Items[e].IsChecked||(this.Parent.IsSelectAll=!0,this.Parent.ScreenObject.Link.DocumentList.Items[e].IsChecked=!0),this.Parent.IsSelectAll=!1,this.Parent.OnLinkDocumentCheckedChanged(this.Parent.ScreenObject.Link.DocumentList.Items[e]));this.Parent.DialogResult=!0}else this.FillBoms();else this.Addrows()}}},"Ls/t":function(e,t,s){"use strict";s.d(t,"a",(function(){return y}));var i=s("Do2H"),a=s("Lp6j"),n=s("eQJW"),r=s("ScVY"),o=s("EQd/"),l=s("VxiT"),h=s("4HhE"),c=s("ockk"),d=s("n56n"),u=s("JIg3"),D=s("8B8H"),m=s("6l4u"),b=s("Dc+n"),S=s("0/4Q"),C=s("jgdN");class y extends r.b{constructor(e){super(),this.DocId=0,this.DocDetailsId=0,this.HoldRelease=!1,this.ConsolidatedBatches=!1,this.AutoGenerateBatches=!1,this.IsBatchSeqNoExists=!1,this.OnlyMonthYear=!1,this.ProdName="",this.BatchQty=0,this.ShelfLife=0,this.UomConversion=1,this.VarFldName="",this.StaticFields=null,this._SortBatchGrid=!1,this._ChkFifo=!1,this.Width=500,this.BatchScanning=new o.d(0),this._ChkFifoAll=!1,this.FifoVisibility=!1,this.FifoAllVisibility=!1,this.ProdVisibility=!1,this.IsQuickAdd=!1,this.Div=0,this.Loc=0,this.NextSeq=0,this.Seqlen=0,this.InvQty=0,this.Tot=0,this.drSelObj=null,this.xBatchDef=null,this.BNO="",this.dsBatch=null,this.ControlGen=null,this.VoucherType=0,this.ExpanderVisibility=!1,this.SaveVisibility=!0,this.SaveAsVisibility=!0,this.SaveAddVisibility=!0,this.SaveAddMultipleVisibility=!0,this.AddBatchExp="",this.BatchNumber=new o.d(0),this.BatchNo=new o.d(0),this.Isexp=!1,this.BatchCode=new o.a(27184),this.BatMRate=new o.d(0),this.BatRRate=new o.d(0),this.BatSRate=new o.d(0),this.FromDate=null,this.RetestDate=null,this.ExpDate=null,this.SerialNumber=new o.d(0),this.Qty=new o.d(0),this.SearchVisibility=!1,this.AddVisiblility=!1,this.GridDataObj=new D.a,this.dtmap=null,this.count=0,this.objBatch={BatchID:0,IsGroup:!1,CodePrefix:null,CodeNumber:0},this.ClassName="BatchNumberViewModel",this.GridDataObj.Columns=[],this.drSelObj=e}get SelectedProd(){return this._SelectedProd}set SelectedProd(e){e!=this._SelectedProd&&(null!=this._SelectedProd&&""!=this._SelectedProd&&this.FillBatchtoDt(parseInt(this._SelectedProd)),this._SelectedProd=e,this.ProdSelected())}get SortBatchGrid(){return this._SortBatchGrid}set SortBatchGrid(e){!0===e&&(this.GridDataObj.RefreshGrid=!0,this.GridDataObj.RefreshGridView()),this._SortBatchGrid=e}get ChkFifo(){return this._ChkFifo}set ChkFifo(e){e!=this._ChkFifo&&(this._ChkFifo=e,this.AdjusFifo(e))}get ChkFifoAll(){return this._ChkFifoAll}set ChkFifoAll(e){e!=this._ChkFifoAll&&(this._ChkFifoAll=e,this.AdjusFifoAll())}get ScreenObject(){return this.ControlGen}set ScreenObject(e){this.ControlGen=e}set RefreshGrid(e){}get CanRemove(){return null!=this.SelectedRow}get GridData(){return this.GridDataObj.Table}get GridDataColumns(){return this.GridDataObj.TableColumns}get ColumnSource(){return this.GridDataObj.Columns}get SelectedRow(){return this.GridDataObj.SelectedItem}set SelectedRow(e){this.GridDataObj.SelectedItem=e}BatchNumberViewModel_1(e){this.IsQuickAdd=e,this.VoucherType=1,this.docdate=Date.Today(),this.LoadFields()}BatchNumberViewModel_2(e,t,s,i,a,n,r){this.Div=r,this.Loc=n,this.BillNO=a,this.docdate=i,this.VoucherType=t,this.Parent=e,this.batches=s,this.ProdVisibility=!0,this.SelectedProd=s[0].ProductID.toString(),this.LoadFields()}BatchNumberViewModel_3(e,t,s,n,r,o,l,h,c=null){if(this.Parent=e,this.drSel=h,this.drSelTable=null!=c&&c.length>0?c:e.ScreenObject.GridData,this.Div=l,this.Loc=o,this.ProductID=n,this.ProdName=r,this.BatchQty=s,i.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=i.a.SessionManager.Preferences.DecimalsinQty){let e=this.BatchQty.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty);this.BatchQty=parseFloat(e)}this.VoucherType=t,this.QtyAddMessage=a.e.Format(i.a.GetResource("BatchNo_AddMessage"),(0).ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty),this.BatchQty.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty),this.ProdName.toString()),this.LoadFields()}BatchNumberViewModel_4(e,t,s,n,r,o,l,h,c,d=null,u=null){if(this.VarFldName=c,this.Div=h,null!=d?this.drSel=d:"AddEditDocumentViewModel"==e.ClassName&&null!=e.SelectedRow&&(this.drSel=e.SelectedRow),this.drSelTable=null!=u&&u.length>0?u:e.ScreenObject.GridData,this.dsBatch=n,this.Loc=l,this.ProductID=r,this.ProdName=o,this.BatchQty=s,i.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=i.a.SessionManager.Preferences.DecimalsinQty){let e=this.BatchQty.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty);this.BatchQty=parseFloat(e)}this.VoucherType=t,this.Parent=e,this.QtyAddMessage=a.e.Format(i.a.GetResource("BatchNo_AddMessage"),(0).ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty),this.BatchQty.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty),this.ProdName.toString()),this.LoadFields()}LoadStaticFields(){if(this.StaticFields=[],null!=this.dsBatch&&this.dsBatch.Tables.length>5){if(this.ControlGen=new l.a,this.ControlGen.Data=this.dsBatch,this.dsBatch.Tables[5].forEach(e=>{this.ControlGen.GenerateFields(e,this.StaticFields)}),this.ControlGen.StaticFields=this.StaticFields,this.ControlGen.CostCenterID=16,this.dsBatch.Tables.length>7&&this.dsBatch.Columns[7].Contains("CostCenterColID"))for(let s=0;s<this.dsBatch.Tables[7].length;s++){let e=this.StaticFields.find(e=>e.DBColumnID==parseInt(this.dsBatch.Tables[7][s].CostCenterColID.toString()));null!=e&&(1!=parseInt(this.dsBatch.Tables[7][s].Hide.toString())&&2!=parseInt(this.dsBatch.Tables[7][s].Hide.toString())||(e.Visible=!1),1!=parseInt(this.dsBatch.Tables[7][s].Mandatory.toString())&&2!=parseInt(this.dsBatch.Tables[7][s].Mandatory.toString())||(e.Mandatory=!0))}if(this.dsBatch.Tables.length>6&&this.dsBatch.Columns[6].Contains("IsParentCodeInherited")&&this.dsBatch.Tables[6].length>0&&this.ControlGen.InitAutoCode(this.dsBatch.Tables[6],this.objBatch.IsGroup),this.StaticFields.forEach(e=>{e instanceof o.a?this.BatchCode=e:"MfgDate"==e.DBColumnName&&e instanceof u.c?e.SelectedDateChanged.Subscribe(this,"OnDateChanged"):e instanceof o.d&&"BatchNumber"==e.DBColumnName&&(this.BatchNo=e),e instanceof u.c&&("MfgDate"==e.DBColumnName?this.FromDate=e:"ExpiryDate"==e.DBColumnName?this.ExpDate=e:"RetestDate"==e.DBColumnName&&(this.RetestDate=e),this.OnlyMonthYear&&(e.CustomFormat="MMM/yyyy"))}),this.ControlGen.IsAutoCode&&(this.objBatch.BatchGroup=1,this.ControlGen.SetAutoCode(this.BatchCode,this.objBatch.IsGroup,this.objBatch.BatchGroup,this.dsBatch.Tables[6])),("AddEditDocumentViewModel"==this.Parent.ClassName||"POSDocumentViewModel"==this.Parent.ClassName)&&this.Parent.ScreenObject.Preferences.ContainsKey("AutoBatchNo")&&"true"==this.Parent.ScreenObject.Preferences.AutoBatchNo.toLowerCase()&&null!=this.BatchNo){let e=this.NextSeq.toString();for(;e.length<this.Seqlen;)e="0"+e;this.BatchNo.Text=this.BNO.replace("#SEQ#",e),this.BatchNo.Enable=!1,this.Isexp=!0,this.txtqty=new o.d(0),this.txtqty.Label="Qty",this.txtqty.DBColumnName="QTY",this.txtqty.Mandatory=!0,this.txtqty.DataType="FLOAT",this.StaticFields.push(this.txtqty),this.txtqty.Text=this.Parent.ScreenObject.Preferences.ContainsKey("AutoPopulateBatchQty")&&"true"==this.Parent.ScreenObject.Preferences.AutoPopulateBatchQty.toLowerCase()?this.BatchQty.toString():""}let e=0,t=0;for(let s=0;s<this.StaticFields.length;s++)this.StaticFields[s].Row=e,this.StaticFields[s].Column=t,1==t?(e+=1,t=0):t+=1}}OnDateChanged(e){if(e instanceof u.c&&e.Date&&this.ShelfLife>0){var t=this.StaticFields.find(e=>"ExpiryDate"==e.DBColumnName);if(null!=t&&t instanceof u.c)if(this.OnlyMonthYear){let s=e.Date.AddDays(this.ShelfLife);s.getDate()!=s.DaysInMonth()&&(s=new Date(s.getFullYear(),s.getMonth(),s.DaysInMonth())),t.Date=s}else t.Date=e.Date.AddDays(this.ShelfLife)}}LoadFields(){this.BatchScanning.Visible=!("AddEditDocumentViewModel"!=this.Parent.ClassName&&"POSDocumentViewModel"!=this.Parent.ClassName||-1!=this.VoucherType||!this.Parent.ScreenObject.Preferences.ContainsKey("ScanBatches")||""==this.Parent.ScreenObject.Preferences.ScanBatches.toString()||!Object(n.j)(this.Parent.ScreenObject.Preferences.ScanBatches)),this.BatchScanning.Width="200",this.BatchScanning.Label="Scan Batch",this.BatchScanning.TextChangedCommand.Subscribe(this,"OnKeyDown"),this.BatchScanning.DBColumnName="SKU",this.BatchScanning.Visible&&(this.BatchScanning.SetFocus=!0);let e,t=0;if("AddEditDocumentViewModel"==this.Parent.ClassName||"POSDocumentViewModel"==this.Parent.ClassName?(null!=this.drSel&&(a.e.IsEmpty(this.drSel.DocDetailsID)||(this.DocDetailsId=parseInt(this.drSel.DocDetailsID)),0==this.DocDetailsId&&(6==this.Parent.ScreenObject.DocumentType||39==this.Parent.ScreenObject.DocumentType)&&a.e.Int(this.drSel.LinkedInvDocDetailsID)>0&&(this.DocDetailsId=parseInt(this.drSel.LinkedInvDocDetailsID)),a.e.IsEmpty(this.drSel.UOMConversion)||(this.UomConversion=parseFloat(this.drSel.UOMConversion))),this.DocId=this.Parent.ScreenObject.DocID,this.docdate=this.Parent.DocumentDate,t=this.Parent.CostCenterID):"LinkDocument"==this.Parent.ClassName&&(this.DocId=this.Parent.Parent.ScreenObject.DocID,this.docdate=this.Parent.Parent.DocumentDate,t=this.Parent.Parent.CostCenterID),null==this.dsBatch){let e=-1,s=-1,n=0,r=!1;if(("AddEditDocumentViewModel"==this.Parent.ClassName||"POSDocumentViewModel"==this.Parent.ClassName)&&i.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise Batches")&&""!=i.a.SessionManager.Preferences["Maintain Dimensionwise Batches"].toString()&&(n=a.e.Int(i.a.SessionManager.Preferences["Maintain Dimensionwise Batches"]),n>0)){for(let t=0;t<this.Parent.ScreenObject._CCFields.length;t++){let s=this.Parent.ScreenObject._CCFields[t];if(s instanceof d.b&&s.CCID==n){e=s.SelectedValue,r=!0;break}}r||null!=this.drSel&&n>5e4&&this.drSelObj.TableColumns.Contains("dcCCNID"+(n-5e4).toString()+"_Key")&&!a.e.IsEmpty(this.drSel["dcCCNID"+(n-5e4).toString()+"_Key"])&&(e=parseInt(this.drSel["dcCCNID"+(n-5e4).toString()+"_Key"]))}if(("AddEditDocumentViewModel"==this.Parent.ClassName||"POSDocumentViewModel"==this.Parent.ClassName)&&this.Parent.ScreenObject.Preferences.ContainsKey("BatchFilterDim")&&(n=a.e.Int(this.Parent.ScreenObject.Preferences.BatchFilterDim),r=!1,n>0)){for(let e=0;e<this.Parent.ScreenObject._CCFields.length;e++){let t=this.Parent.ScreenObject._CCFields[e];if(t instanceof d.b&&t.CCID==n){s=t.SelectedValue>0?t.SelectedValue:1,r=!0;break}}r||null!=this.drSel&&n>5e4&&this.drSelObj.TableColumns.Contains("dcCCNID"+(n-5e4).toString()+"_Key")&&(r=!0,s=a.e.IsEmpty(this.drSel["dcCCNID"+(n-5e4).toString()+"_Key"])?1:parseInt(this.drSel["dcCCNID"+(n-5e4).toString()+"_Key"]))}if(this.dsBatch=(new p).GetProductwiseBatches(this.ProductID,this.DocDetailsId,this.DocId,this.VoucherType,this.docdate,this.Div,this.Loc,t,e,s),this.dsBatch.Tables.length>1&&this.dsBatch.Tables[1].length>0&&this.dsBatch.Columns[1].Contains("ErrorMessage"))return void("AddEditDocumentViewModel"!=this.Parent.ClassName&&"POSDocumentViewModel"!=this.Parent.ClassName||(this.Parent.DisplayMessage=this.dsBatch.Tables[1][0].ErrorMessage.toString()));if(this.dsBatch.Tables[0].length>0&&this.dsBatch.Columns[0].Contains("ErrorMessage"))return void("AddEditDocumentViewModel"!=this.Parent.ClassName&&"POSDocumentViewModel"!=this.Parent.ClassName||(this.Parent.DisplayMessage=i.a.GetResource("Batch_PrdNoBtch").toString()))}if(this.dsBatch.Tables.length>2&&this.dsBatch.Columns[2].Contains("Name")){let e=this.dsBatch.Tables[2].filter(e=>"HoldandReleaseQTY"==e.Name);e.length>0&&(this.HoldRelease=Object(n.j)(e[0].Value)),e=this.dsBatch.Tables[2].filter(e=>"ConsolidatedBatches"==e.Name),e.length>0&&(this.ConsolidatedBatches=Object(n.j)(e[0].Value)),e=this.dsBatch.Tables[2].filter(e=>"AutoGenerateBatches"==e.Name),e.length>0&&(this.AutoGenerateBatches=Object(n.j)(e[0].Value)),e=this.dsBatch.Tables[2].filter(e=>"OnlyMonthYear"==e.Name),e.length>0&&(this.OnlyMonthYear=Object(n.j)(e[0].Value)),e=this.dsBatch.Tables[2].filter(e=>"SortBatchGrid"==e.Name),e.length>0&&(this.SortBatchGrid=Object(n.j)(e[0].Value))}if(this.dsBatch.Tables.length>2&&this.dsBatch.Columns[2].Contains("ShelfLife")&&this.dsBatch.Tables[2].length>0&&!a.e.IsEmpty(this.dsBatch.Tables[2][0].ShelfLife)&&(this.ShelfLife=parseFloat(this.dsBatch.Tables[2][0].ShelfLife.toString())),1==this.VoucherType&&this.LoadStaticFields(),this.dsBatch.Tables.length>6&&this.dsBatch.Tables[6].length>0){let e=this.dsBatch.Tables[6].filter(e=>1==e.IsName);if(e.length>0){if(!a.e.IsEmpty(e[0].PrefixContent))try{this.GetBatchNo(e[0].PrefixContent.toString())}catch(h){Logger.ErrorLog("error reading PrefixContent xml")}this.dsBatch.Tables[6].Remove(e[0])}}this.dtmap=[],this.dtmapColumns=[],this.dtmapColumns.push("BaseCol"),this.dtmapColumns.push("BatchCol"),this.GridDataColumns.push("Sno"),this.GridDataColumns.push("BatchCode"),this.GridDataColumns.push("BATCHNUMBER"),this.GridDataColumns.push("RefInvID");for(let i=0;i<this.dsBatch.Tables[4].length;i++)this.GridDataColumns.Contains(this.dsBatch.Tables[4][i].Name.toString())||("SRate"==this.dsBatch.Tables[4][i].Name.toString()||"MRate"==this.dsBatch.Tables[4][i].Name.toString()||"RRate"==this.dsBatch.Tables[4][i].Name.toString()||"Release"==this.dsBatch.Tables[4][i].Name.toString()||"Hold"==this.dsBatch.Tables[4][i].Name.toString()||"BalQty"==this.dsBatch.Tables[4][i].Name.toString()||"QtyUom"==this.dsBatch.Tables[4][i].Name.toString()||"Quantity"==this.dsBatch.Tables[4][i].Name.toString()?this.GridDataColumns.push(this.dsBatch.Tables[4][i].Name):this.dsBatch.Tables[4][i].Name.toString().toLowerCase().Contains("ccnid")?(this.GridDataColumns.push(this.dsBatch.Tables[4][i].Name),this.GridDataColumns.push(this.dsBatch.Tables[4][i].Name.toString()+"_Key")):this.GridDataColumns.push(this.dsBatch.Tables[4][i].Name));if(this.GridDataColumns.Contains("BalQty")||this.GridDataColumns.push("BalQty"),this.GridDataColumns.Contains("ExpDate")||this.GridDataColumns.push("ExpDate"),this.GridDataColumns.Contains("MfgDate")||this.GridDataColumns.push("MfgDate"),this.GridDataColumns.Contains("Quantity")||this.GridDataColumns.push("Quantity"),this.GridDataColumns.Contains("SRate")||this.GridDataColumns.push("SRate"),this.GridDataColumns.Contains("MRate")||this.GridDataColumns.push("MRate"),this.GridDataColumns.Contains("RRate")||this.GridDataColumns.push("RRate"),this.GridDataColumns.Contains("Hold")||this.GridDataColumns.push("Hold"),this.GridDataColumns.Contains("Release")||this.GridDataColumns.push("Release"),"AddEditDocumentViewModel"==this.Parent.ClassName&&this.Parent.ScreenObject.Preferences.ContainsKey("ConsBatch")&&"True"==this.Parent.ScreenObject.Preferences.ConsBatch&&(this.GridDataColumns.push("DetID"),this.GridDataColumns.push("LinkedID")),this.FifoVisibility=-1==this.VoucherType&&!this.BatchScanning.Visible,this.FifoAllVisibility="IWODetailsViewModel"==this.Parent.ClassName,this.BatMRate.DataType="FLOAT",this.BatRRate.DataType="FLOAT",this.BatSRate.DataType="FLOAT",this.BatchNo.Mandatory=!0,this.Qty.DataType="FLOAT",this.GridDataObj.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.GridDataObj.BeginEdit.Subscribe(this,"OnBeginEdit"),this.Qty.Visible=!0,this.AddVisiblility=!0,this.SearchVisibility=!1,this.Title=i.a.GetResource("BatchlNo_Title"),this.IsQuickAdd?(this.Title="Add Batch",this.ExpanderVisibility=!0,this.Isexp=!0,this.SaveVisibility=!1,this.SaveAsVisibility=!1,this.SaveAddVisibility=!1):1!=this.VoucherType||!("AddEditDocumentViewModel"!=this.Parent.ClassName&&"POSDocumentViewModel"!=this.Parent.ClassName||6!=this.Parent.ScreenObject.DocumentType&&39!=this.Parent.ScreenObject.DocumentType)&&a.e.Int(this.drSel.LinkedInvDocDetailsID)>0?this.ExpanderVisibility=!1:(this.ExpanderVisibility=!0,this.SaveVisibility=i.a.SessionManager.IsActionAssigned(43,"EnableBatchSave"),this.SaveAsVisibility=i.a.SessionManager.IsActionAssigned(43,"EnableBatchSaveAs"),this.SaveAddVisibility=i.a.SessionManager.IsActionAssigned(43,"EnableBatchSaveAdd")),this.SaveAddMultipleVisibility=!(!this.SaveAddVisibility||!this.GridDataColumns.Contains("DetID")),this.dtmap.Clear(),this.dsBatch.Tables.length>3)for(let i=0;i<this.dsBatch.Tables[3].length;i++){let e={};e.BatchCol=this.dsBatch.Tables[3][i].BatchCol.toString(),e.BaseCol=this.dsBatch.Tables[3][i].BaseCol.toString(),this.dtmap.push(e),this.GridDataColumns.Contains(this.dsBatch.Tables[3][i].BatchCol.toString())||(this.GridDataColumns.push(this.dsBatch.Tables[3][i].BatchCol.toString()),this.dsBatch.Tables[3][i].BatchCol.toString().toLowerCase().Contains("ccnid")&&this.GridDataColumns.push(this.dsBatch.Tables[3][i].BatchCol.toString()+"_Key"))}if(e=new c.a,e.Header="#",e.DisplayMember="Sno",e.DataType="TextBlock",e.ReadOnly=!0,e.Width=50,e.DisableTab=!0,this.ColumnSource.push(e),i.a.SessionManager.IsActionAssigned(43,"EditBatchDetails")&&(e=new c.a,e.Header="Edit",e.DisplayMember="Edit",e.ReadOnly=!0,e.DataType="LINK",e.DisableTab=!0,e.Click.Subscribe(this,"onEditClick"),e.Width=100,this.ColumnSource.push(e),this.GridDataColumns.push("Edit")),null!=this.drSel&&"True"==this.drSel.BinWise.toString()){let t=0,n=0,r=!1;if(i.a.SessionManager.Preferences.ContainsKey("DimensionwiseBins")&&""!=i.a.SessionManager.Preferences.DimensionwiseBins.toString()&&(n=a.e.Int(i.a.SessionManager.Preferences.DimensionwiseBins),n>0)){t=1;for(let e=0;e<this.Parent.ScreenObject._CCFields.length;e++){let s=this.Parent.ScreenObject._CCFields[e];if(s instanceof d.b&&s.CCID==n){s.SelectedValue>0&&(t=s.SelectedValue),r=!0;break}}r||null!=this.SelectedRow&&n>5e4&&this.drSelObj.TableColumns.Contains("dcCCNID"+(n-5e4).toString()+"_Key")&&a.e.Int(this.drSel["dcCCNID"+(n-5e4).toString()+"_Key"])>0&&(t=parseInt(this.drSel["dcCCNID"+(n-5e4).toString()+"_Key"]))}if(n>5e4&&!this.Parent.ScreenObject.IsBinWise(n,t)){if(5==this.Parent.ScreenObject.DocumentType&&n>0){t=1;for(let e=0;e<this.Parent.ScreenObject._CCFields.length;e++){let i=this.Parent.ScreenObject._CCFields[e];if(i instanceof d.b&&i.CCID==n){if(i.DBColumnName.Contains("TO"))i.SelectedValue>0&&(t=i.SelectedValue);else{var s=this.Parent.ScreenObject._CCFields.find(e=>e.DBColumnName=="TO"+i.DBColumnName);s?s.SelectedValue>0&&(t=s.SelectedValue):i.SelectedValue>0&&(t=i.SelectedValue)}r=!0;break}}r||null!=this.SelectedRow&&n>5e4&&this.drSelObj.TableColumns.Contains("dcCCNID"+(n-5e4).toString()+"_Key")&&(this.drSelObj.TableColumns.Contains("TOdcCCNID"+(n-5e4).toString()+"_Key")?a.e.Int(this.drSel["TOdcCCNID"+(n-5e4).toString()+"_Key"])>0&&(t=parseInt(this.drSel["TOdcCCNID"+(n-5e4).toString()+"_Key"])):a.e.Int(this.drSel["dcCCNID"+(n-5e4).toString()+"_Key"])>0&&(t=parseInt(this.drSel["dcCCNID"+(n-5e4).toString()+"_Key"]))),n>5e4&&!this.Parent.ScreenObject.IsBinWise(n,t)||(e=new c.a,e.Header="Bins",e.DisplayMember="Bins",e.ReadOnly=!0,e.DataType="LINK",e.DisableTab=!0,e.Click.Subscribe(this,"onBinCLick"),e.Width=100,this.ColumnSource.push(e),this.GridDataColumns.push("Bins"),this.GridDataColumns.push("BinsXML"),this.GridDataColumns.push("strBins"),5==this.Parent.ScreenObject.DocumentType&&this.GridDataColumns.push("TOBinsXML"))}}else e=new c.a,e.Header="Bins",e.DisplayMember="Bins",e.ReadOnly=!0,e.DataType="LINK",e.DisableTab=!0,e.Click.Subscribe(this,"onBinCLick"),e.Width=100,this.ColumnSource.push(e),this.GridDataColumns.push("Bins"),this.GridDataColumns.push("BinsXML"),this.GridDataColumns.push("strBins"),5==this.Parent.ScreenObject.DocumentType&&this.GridDataColumns.push("TOBinsXML")}e=new c.a,e.Header=i.a.GetResource("Batch_BatchNo"),this.dvCombo=this.dsBatch.Tables[0],this.dvComboTable=this.dsBatch.Tables[0],this.dvComboColumns=this.dsBatch.Columns[0],e.ComboData=this.dsBatch.Tables[0],e.DisplayMember="BATCHNUMBER",e.ValueMember="BatchID",e.ValueBinding="BatchID",e.DataType="ComboBox",e.Width=150,-1!=this.VoucherType&&("AddEditDocumentViewModel"!=this.Parent.ClassName&&"POSDocumentViewModel"!=this.Parent.ClassName||6!=this.Parent.ScreenObject.DocumentType&&39!=this.Parent.ScreenObject.DocumentType||a.e.IsEmpty(this.drSel.LinkedInvDocDetailsID)||!(parseInt(this.drSel.LinkedInvDocDetailsID)>0))||(e.ReadOnly=!0),this.GridDataColumns.Contains("BatchID")||this.GridDataColumns.push("BatchID"),this.ColumnSource.push(e),this.ConsolidatedBatches||-1!=this.VoucherType||(e=new c.a,e.Header="Voucher No",e.DisplayMember="VoucherNo",e.DataType="TextBlock",e.ReadOnly=!0,e.Width=100,e.DisableTab=!0,this.ColumnSource.push(e),this.GridDataColumns.push("VoucherNo"),e=new c.a,e.Header="Doc Date",e.DisplayMember="DocDate",e.DataType="TextBlock",e.ReadOnly=!0,e.Width=100,e.DisableTab=!0,this.ColumnSource.push(e),this.GridDataColumns.push("DocDate"));let r=0;if(this.dsBatch.Tables.length>0){for(let t=0;t<this.dsBatch.Tables[4].length;t++)if("BatchNumber"!=this.dsBatch.Tables[4][t].Name.toString())e=new c.a,e.Header=this.dsBatch.Tables[4][t].UserColumnName.toString(),e.DisplayMember=this.dsBatch.Tables[4][t].Name.toString(),e.DataType=this.dsBatch.Tables[4][t].UserColumnType.toString(),a.e.IsEmpty(this.dsBatch.Tables[4][t].ColumnWidth)||(e.Width=parseInt(this.dsBatch.Tables[4][t].ColumnWidth)),e.ReadOnly=!0,"Hold"!=e.DisplayMember.toString()&&"Release"!=e.DisplayMember.toString()||(e.IsVisible=1==this.VoucherType&&this.HoldRelease),"BalQty"==e.DisplayMember.toString()&&-1==this.VoucherType?e.IsVisible=!0:"BalQty"==e.DisplayMember.toString()&&1==this.VoucherType&&(e.IsVisible=!1),"Quantity"==e.DisplayMember.toString()||"QOH"==e.DisplayMember.toString()||"Release"==e.DisplayMember.toString()||"Hold"==e.DisplayMember.toString()||"BalQty"==e.DisplayMember.toString()||"QtyUom"==e.DisplayMember.toString()?(i.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=i.a.SessionManager.Preferences.DecimalsinQty&&(e.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinQty),"BalQty"==e.DisplayMember.toString()||this.BatchScanning.Visible||(e.ReadOnly=!1),e.DataType="FLOAT","QtyUom"==e.DisplayMember.toString()&&(e.ReadOnly=!1)):!this.OnlyMonthYear||"ExpDate"!=e.DisplayMember&&"MfgDate"!=e.DisplayMember||(e.FixedDateFormat="MMM/yyyy"),this.ColumnSource.push(e);else{var o=this.ColumnSource.find(e=>null!=e.ValueBinding&&"BatchID"==e.ValueBinding);o&&(o.Header=this.dsBatch.Tables[4][t].UserColumnName.toString(),a.e.IsEmpty(this.dsBatch.Tables[4][t].ColumnWidth)||(o.Width=parseInt(this.dsBatch.Tables[4][t].ColumnWidth)))}if(-1==this.VoucherType)for(let e=0;e<this.dsBatch.Tables[0].length;e++){let t=this.GridDataObj.NewRow();t.Sno=e+1,this.GridDataColumns.Contains("Edit")&&(t.Edit="Edit"),this.GridDataColumns.Contains("Bins")&&(t.Bins="Bins"),this.ConsolidatedBatches||(t.RefInvID=this.dsBatch.Tables[0][e].InvDocDetailsID.toString(),this.dsBatch.Columns[0].Contains("VoucherNo")&&(t.VoucherNo=this.dsBatch.Tables[0][e].VoucherNo.toString()),this.dsBatch.Columns[0].Contains("DocDate")&&!a.e.IsEmpty(this.dsBatch.Tables[0][e].DocDate)&&(t.DocDate=new Date(this.dsBatch.Tables[0][e].DocDate).ToString(i.a.SessionManager.Preferences["Date Format"]))),t.BatchID=this.dsBatch.Tables[0][e].BatchID.toString(),this.dsBatch.Columns[0].Contains("BatchCode")&&(t.BatchCode=this.dsBatch.Tables[0][e].BatchCode.toString()),this.dsBatch.Columns[0].Contains("BATCHNUMBER")&&(t.BATCHNUMBER=this.dsBatch.Tables[0][e].BATCHNUMBER.toString()),a.e.isValidDate(this.dsBatch.Tables[0][e].MfgDate)&&(t.MfgDate=this.OnlyMonthYear?new Date(this.dsBatch.Tables[0][e].MfgDate).ToString("MMM/yyyy"):new Date(this.dsBatch.Tables[0][e].MfgDate).ToString(i.a.SessionManager.Preferences["Date Format"])),a.e.isValidDate(this.dsBatch.Tables[0][e].ExpiryDate)&&(t.ExpDate=this.OnlyMonthYear?new Date(this.dsBatch.Tables[0][e].ExpiryDate).ToString("MMM/yyyy"):new Date(this.dsBatch.Tables[0][e].ExpiryDate).ToString(i.a.SessionManager.Preferences["Date Format"])),this.GridDataColumns.Contains("BalQty")&&(t.BalQty=this.dsBatch.Columns[0].Contains("BalQty")&&a.e.IsNum(this.dsBatch.Tables[0][e].BalQty)?parseFloat(this.dsBatch.Tables[0][e].BalQty).ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty):0),this.dsBatch.Columns[0].Contains("BillNo")&&this.GridDataColumns.Contains("BillNo")&&(t.BillNo=this.dsBatch.Tables[0][e].BillNo.toString()),this.dsBatch.Columns[0].Contains("BillDate")&&this.GridDataColumns.Contains("BillDate")&&a.e.isValidDate(this.dsBatch.Tables[0][e].BillDate)&&(t.BillDate=new Date(this.dsBatch.Tables[0][e].BillDate).ToString(i.a.SessionManager.Preferences["Date Format"])),a.e.IsNum(this.dsBatch.Tables[0][e].MRATE)&&(t.MRate=this.dsBatch.Tables[0][e].MRATE.toString()),a.e.IsNum(this.dsBatch.Tables[0][e].RRATE)&&(t.RRate=this.dsBatch.Tables[0][e].RRATE.toString()),a.e.IsNum(this.dsBatch.Tables[0][e].SRATE)&&(t.SRate=this.dsBatch.Tables[0][e].SRATE.toString());for(let s=0;s<this.dtmap.length;s++)this.dtmap[s].BatchCol.toString().toLowerCase().Contains("ccnid")&&this.dtmap[s].BaseCol.toString().toLowerCase().Contains("ccnid")&&this.GridDataColumns.Contains(this.dtmap[s].BatchCol.toString()+"_Key")&&!a.e.IsEmpty(this.dsBatch.Tables[0][e][this.dtmap[s].BatchCol.toString()])?(t[this.dtmap[s].BatchCol.toString()]=this.dsBatch.Tables[0][e][this.dtmap[s].BatchCol.toString()+"_Key"].toString(),t[this.dtmap[s].BatchCol.toString()+"_Key"]=this.dsBatch.Tables[0][e][this.dtmap[s].BatchCol.toString()].toString()):this.dsBatch.Columns[0].Contains(this.dtmap[s].BatchCol.toString())&&this.GridDataColumns.Contains(this.dtmap[s].BatchCol.toString())&&this.dsBatch.Columns[0].Contains(this.dtmap[s].BatchCol.toString())&&(t[this.dtmap[s].BatchCol.toString()]=this.dsBatch.Tables[0][e][this.dtmap[s].BatchCol.toString()].toString());if(null!=this.dsBatch.Tables[4]&&this.dsBatch.Tables[4].length>0)for(let s=0;s<this.dsBatch.Tables[4].length;s++)if(!a.e.IsEmpty(this.dsBatch.Tables[4][s].CostcenterColID)&&parseInt(this.dsBatch.Tables[4][s].CostcenterColID)<53692&&parseInt(this.dsBatch.Tables[4][s].CostcenterColID)>1572){let n=this.dsBatch.Tables[4][s].Name.toString();this.dsBatch.Tables[4][s].Name.toString().toLowerCase().Contains("ccnid")?(this.dsBatch.Columns[0].Contains(n+"_Key")&&(t[this.dsBatch.Tables[4][s].Name.toString()]=this.dsBatch.Tables[0][e][n+"_Key"].toString()),this.GridDataColumns.Contains(n+"_Key")&&(t[n+"_Key"]=this.dsBatch.Tables[0][e][n].toString())):""!=n&&"retestdate"==n.toLowerCase()&&this.dsBatch.Columns[0].Contains(n)?a.e.isValidDate(this.dsBatch.Tables[0][e][n])&&(t[this.dsBatch.Tables[4][s].Name.toString()]=new Date(this.dsBatch.Tables[0][e][n]).ToString(i.a.SessionManager.Preferences["Date Format"])):""!=n&&this.dsBatch.Columns[0].Contains(n)&&"MfgDate"!=n&&"ExpiryDate"!=n&&(t[this.dsBatch.Tables[4][s].Name.toString()]=this.dsBatch.Tables[0][e][n].toString())}else if(!a.e.IsEmpty(this.dsBatch.Tables[4][s].CostcenterColID)&&(parseInt(this.dsBatch.Tables[4][s].CostcenterColID)<1251&&parseInt(this.dsBatch.Tables[4][s].CostcenterColID)>1100||53732==parseInt(this.dsBatch.Tables[4][s].CostcenterColID))&&this.dsBatch.Columns[0].Contains(this.dsBatch.Tables[4][s].Name.toString()))t[this.dsBatch.Tables[4][s].Name.toString()]=this.dsBatch.Tables[0][e][this.dsBatch.Tables[4][s].Name.toString()].toString();else if(!a.e.IsEmpty(this.dsBatch.Tables[4][s].CostcenterColID)&&parseInt(this.dsBatch.Tables[4][s].CostcenterColID)<1311&&parseInt(this.dsBatch.Tables[4][s].CostcenterColID)>1260&&this.dsBatch.Columns[0].Contains(this.dsBatch.Tables[4][s].Name.toString())){let i=this.dsBatch.Tables[4][s].Name.toString();this.dsBatch.Columns[0].Contains(i+"_Key")&&(t[this.dsBatch.Tables[4][s].Name.toString()]=this.dsBatch.Tables[0][e][i+"_Key"].toString()),this.GridDataColumns.Contains(i+"_Key")&&(t[i+"_Key"]=this.dsBatch.Tables[0][e][i].toString())}this.GridDataObj.addRow(t)}}let l=new a.f;if(("AddEditDocumentViewModel"==this.Parent.ClassName||"POSDocumentViewModel"==this.Parent.ClassName)&&null!=this.drSel)if(a.e.IsEmpty(this.drSel.ExtraXML))this.QtyAddMessage=a.e.Format(i.a.GetResource("BatchNo_AddMessage"),(0).ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty),this.BatchQty.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty),this.ProdName.toString());else{let e=0;l.LoadXml(this.drSel.ExtraXML);let t=l.SelectNodes("xml/Row");for(let s=0;s<t.length;s++){let n;if(n=!1,1==this.VoucherType){for(let e=0;e<this.GridData.length;e++)if(this.GridData[e].BatchID.toString()==t[s].attributes.BatchID.value){n=!0;break}let o,l;o=0;for(let e=0;e<this.GridData.length;e++)if(this.GridData[e].BatchID.toString()==t[s].attributes.BatchID.value){o=e,n=!0;break}if(n?l=this.GridData[o]:(l=this.GridDataObj.NewRow(),this.GridDataObj.addRow(l)),this.GridDataColumns.Contains("Edit")&&(l.Edit="Edit"),this.GridDataColumns.Contains("Bins")&&(l.Bins="Bins"),this.GridDataColumns.Contains("DetID")&&null!=t[s].attributes.DocDetailsID&&""!=t[s].attributes.DocDetailsID.value&&(l.DetID=t[s].attributes.DocDetailsID.value),this.GridDataColumns.Contains("LinkedID")&&null!=t[s].attributes.LinkedID&&""!=t[s].attributes.LinkedID.value&&(l.LinkedID=t[s].attributes.LinkedID.value),l.BatchID=t[s].attributes.BatchID.value,a.e.IsNum(t[s].attributes.Quantity.value)&&(r=parseFloat(t[s].attributes.Quantity.value),l.Quantity=t[s].attributes.Quantity.value,this.GridDataColumns.Contains("QtyUom")&&(l.QtyUom=r/this.UomConversion),e+=r),1==this.VoucherType&&null!=t[s].attributes.Hold&&a.e.IsNum(t[s].attributes.Hold.value)&&this.GridDataObj.TableColumns.Contains("Hold")?l.Hold=t[s].attributes.Hold.value:this.GridDataObj.TableColumns.Contains("Hold")&&(l.Hold=0),1==this.VoucherType&&null!=t[s].attributes.Release&&a.e.IsNum(t[s].attributes.Release.value)&&this.GridDataObj.TableColumns.Contains("Release")&&(l.Release=t[s].attributes.Release.value),this.dvCombo=this.dvComboTable.filter(e=>e.BatchID==t[s].attributes.BatchID.value),this.dvCombo.length>0){a.e.isValidDate(this.dvCombo[0].MfgDate)&&(l.MfgDate=this.OnlyMonthYear?new Date(this.dvCombo[0].MfgDate).ToString("MMM/yyyy"):new Date(this.dvCombo[0].MfgDate).ToString(i.a.SessionManager.Preferences["Date Format"])),a.e.isValidDate(this.dvCombo[0].ExpiryDate)&&(l.ExpDate=this.OnlyMonthYear?new Date(this.dvCombo[0].ExpiryDate).ToString("MMM/yyyy"):new Date(this.dvCombo[0].ExpiryDate).ToString(i.a.SessionManager.Preferences["Date Format"])),a.e.IsNum(this.dvCombo[0].MRATE)&&(l.MRate=this.dvCombo[0].MRATE.toString()),a.e.IsNum(this.dvCombo[0].RRATE)&&(l.RRate=this.dvCombo[0].RRATE.toString()),a.e.IsNum(this.dvCombo[0].SRATE)&&(l.SRate=this.dvCombo[0].SRATE.toString());for(let e=0;e<this.dtmap.length;e++)this.dvComboColumns.Contains(this.dtmap[e].BatchCol.toString())&&this.GridDataColumns.Contains(this.dtmap[e].BatchCol.toString())&&(l[this.dtmap[e].BatchCol.toString()]=this.dvCombo[0][this.dtmap[e].BatchCol.toString()].toString());if(null!=this.dsBatch.Tables[4]&&this.dsBatch.Tables[4].length>0)for(let e=0;e<this.dsBatch.Tables[4].length;e++)if(!a.e.IsEmpty(this.dsBatch.Tables[4][e].CostcenterColID)&&parseInt(this.dsBatch.Tables[4][e].CostcenterColID)<53692&&parseInt(this.dsBatch.Tables[4][e].CostcenterColID)>1572){let t=this.dsBatch.Tables[4][e].Name.toString();this.dsBatch.Tables[4][e].Name.toString().toLowerCase().Contains("ccnid")?(this.dvComboColumns.Contains(t+"_Key")&&(l[this.dsBatch.Tables[4][e].Name.toString()]=this.dvCombo[0][t+"_Key"].toString()),this.GridDataColumns.Contains(t+"_Key")&&(l[t+"_Key"]=this.dvCombo[0][t].toString())):""!=t&&"retestdate"==t.toLowerCase()&&this.dvComboColumns.Contains(t)?a.e.isValidDate(this.dvCombo[0][t])&&(l[this.dsBatch.Tables[4][e].Name.toString()]=new Date(this.dvCombo[0][t]).ToString(i.a.SessionManager.Preferences["Date Format"])):""!=t&&this.dvComboColumns.Contains(t)&&"MfgDate"!=t&&"ExpiryDate"!=t&&(l[this.dsBatch.Tables[4][e].Name.toString()]=this.dvCombo[0][t].toString())}}if(null!=this.drSel&&"True"==this.drSel.BinWise.toString()){if(this.GridDataColumns.Contains("BinsXML")){l.BinsXML=this.drSel.BinsXML.toString();let e=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&55494==e.LinkData);e.length>0&&this.drSelObj.TableColumns.Contains(e[0].SysColumnName.toString())&&(l.strBins=this.drSel[e[0].SysColumnName.toString()].toString())}this.GridDataColumns.Contains("TOBinsXML")&&(l.TOBinsXML=this.drSel.TOBinsXML.toString())}this.dvCombo=this.dvComboTable}else{let i=this.GridData.filter(e=>e.BatchID==t[s].attributes.BatchID.value);if(this.ConsolidatedBatches||null==t[s].attributes.RefInvID||a.e.IsEmpty(t[s].attributes.RefInvID.value)||(i=this.GridData.filter(e=>e.RefInvID==t[s].attributes.RefInvID.value)),i.length>0){this.GridDataColumns.Contains("Edit")&&(i[0].Edit="Edit"),this.GridDataColumns.Contains("Bins")&&(i[0].Bins="Bins"),this.GridDataColumns.Contains("DetID")&&null!=t[s].attributes.DocDetailsID&&""!=t[s].attributes.DocDetailsID.value&&(i[0].DetID=t[s].attributes.DocDetailsID.value),this.GridDataColumns.Contains("LinkedID")&&null!=t[s].attributes.LinkedID&&""!=t[s].attributes.LinkedID.value&&(i[0].LinkedID=t[s].attributes.LinkedID.value),r=0;let n=a.e.Double(t[s].attributes.Quantity.value);if(e+=n,i[0].Quantity=n,this.GridDataColumns.Contains("QtyUom")&&(i[0].QtyUom=n/this.UomConversion),null!=this.drSel&&"True"==this.drSel.BinWise.toString()){if(this.GridDataColumns.Contains("BinsXML")){i[0].BinsXML=this.drSel.BinsXML.toString();let e=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&55494==e.LinkData);e.length>0&&this.drSelObj.TableColumns.Contains(e[0].SysColumnName.toString())&&(i[0].strBins=this.drSel[e[0].SysColumnName.toString()].toString())}this.GridDataColumns.Contains("TOBinsXML")&&(i[0].TOBinsXML=this.drSel.TOBinsXML.toString())}}}}this.QtyAddMessage=a.e.Format(i.a.GetResource("BatchNo_AddMessage"),e.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty),this.BatchQty.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty),this.ProdName.toString())}if(this.GridDataObj.SearchVisible=!0,this.FillEmptyRows(),this.BatchNo.Enable=!0,1==this.VoucherType){if(this.AutoGenerateBatches){this.BatchNo.Enable=!1;let e=0;("AddEditDocumentViewModel"==this.Parent.ClassName||"POSDocumentViewModel"==this.Parent.ClassName&&null!=this.Parent.SelectedRow)&&(e=this.Parent.CostCenterID);let t=(new p).GetBatchDefn(e);t.length>0&&t[0].Filter.toString().length>0&&(this.xBatchDef=new a.f,this.xBatchDef.LoadXml(t[0].Filter))}else"AddEditDocumentViewModel"==this.Parent.ClassName&&this.Parent.ScreenObject.Preferences.ContainsKey("AutoBatchNo")&&"true"==this.Parent.ScreenObject.Preferences.AutoBatchNo.toLowerCase()&&(this.BatchNo.Enable=!1);this.ResetBatchNo(0)}-1==this.VoucherType&&this.SetBalQty()}GetBatchNo(e){this.BNO="";let t=0;if(this.Parent.ScreenObject.Preferences.ContainsKey("AutoBatchNo")&&"true"==this.Parent.ScreenObject.Preferences.AutoBatchNo.toLowerCase()){let n=new a.f;n.LoadXml(e);let r=n.SelectNodes("XML/Row");for(let e=0;e<r.length;e++){let n=r[e];if(t=null!=n.attributes.Length?a.e.Int(n.attributes.Length.value):0,null!=n.attributes.CCCID&&!a.e.IsEmpty(n.attributes.CCCID.value)&&"53730"==n.attributes.CCCID.value&&this.drSelObj.TableColumns.Contains("ProductName"))null!=n.attributes.Length&&a.e.IsNum(n.attributes.Length.value)&&-1!=t&&this.drSel.ProductName.toString().length>t?this.BNO+=this.drSel.ProductName.toString().substr(0,t):this.BNO+=this.drSel.ProductName.toString();else if(null!=n.attributes.CCCID&&!a.e.IsEmpty(n.attributes.CCCID.value)&&"53731"==n.attributes.CCCID.value&&this.drSelObj.TableColumns.Contains("ProductCode"))null!=n.attributes.Length&&a.e.IsNum(n.attributes.Length.value)&&-1!=t&&this.drSel.ProductCode.toString().length>t?this.BNO+=this.drSel.ProductCode.toString().substr(0,t):this.BNO+=this.drSel.ProductCode.toString();else if(null!=n.attributes.Name&&!a.e.IsEmpty(n.attributes.Name.value)&&n.attributes.Name.value.toLowerCase().Contains("ccnid")){var s=this.StaticFields.find(e=>e.DBColumnName.toLowerCase()==n.attributes.Name.value.toLowerCase());if(this.drSelObj.TableColumns.Contains("dc"+n.attributes.Name.value)&&!a.e.IsEmpty(this.drSel["dc"+n.attributes.Name.value]))null!=n.attributes.Length&&a.e.IsNum(n.attributes.Length.value)&&-1!=t&&this.drSel["dc"+n.attributes.Name.value].toString().length>t?this.BNO+=this.drSel["dc"+n.attributes.Name.value].toString().substr(0,t):this.BNO+=this.drSel["dc"+n.attributes.Name.value].toString(),s&&!a.e.IsEmpty(this.drSel["dc"+n.attributes.Name.value+"_key"])&&(s.DefaultValue=this.drSel["dc"+n.attributes.Name.value+"_key"].toString(),s.SelectedValue=parseInt(this.drSel["dc"+n.attributes.Name.value+"_key"]),s.Enable=!1);else{var i=this.Parent.ScreenObject._CCFields.find(e=>e.DBColumnName.toLowerCase()=="dc"+n.attributes.Name.value.toLowerCase());i&&i.SelectedValue>0&&!a.e.IsEmpty(i.Text)&&(null!=n.attributes.Length&&a.e.IsNum(n.attributes.Length.value)&&-1!=t&&i.Text.length>t?this.BNO+=i.Text.substr(0,t):this.BNO+=i.Text,s&&(s.DefaultValue=i.SelectedValue.toString(),s.SelectedValue=i.SelectedValue,s.Enable=!1))}}else null==n.attributes.Name||a.e.IsEmpty(n.attributes.Name.value)||"SEQUENCE_NO"!=n.attributes.Name.value||(this.NextSeq=this.Parent.ScreenObject.getBatchSeq(this.BNO),this.BNO+="#SEQ#",null==n.attributes.Length||a.e.IsEmpty(n.attributes.Length.value)||(this.Seqlen=a.e.Int(n.attributes.Length.value)));null==n.attributes.Delimiter||a.e.IsEmpty(n.attributes.Delimiter.value)||(this.BNO+=n.attributes.Delimiter.value)}}return this.BNO}OnKeyDown(e,t){if(this.BatchScanning.Visible&&"13"==t.keyCode){var s=this.Parent.ScreenObject.ColumnSource.find(e=>null!=e.DisplayMember&&"ProductCode"==e.DisplayMember);if(s&&s.UseBarcode){let e,t=this.BatchScanning.Text;if(""!=s.BarcodeProp){e=new a.f,e.LoadXml(s.BarcodeProp);let i=e.SelectSingleNode("BarCodeBody/IsFixedBarcodeLength");if(null!=i&&"true"==i.InnerText.toLowerCase()&&(i=e.SelectSingleNode("BarCodeBody/FixedBarcodeChar"),null!=i&&""!=i.InnerText.Trim())){let s=i.InnerText[0];if(i=e.SelectSingleNode("BarCodeBody/IsFixedBarcodePrefix"),null!=i&&"true"==i.InnerText.Trim())for(let e=0;e<t.length&&t[e]==s;e++)t=t.Remove(0,1),e--;else for(let e=t.length-1;e>=0&&t[e]==s;e--)t=t.substr(0,t.length-1)}i=e.SelectSingleNode("BarCodeBody/IncludeChecksum"),null!=i&&"true"==i.InnerText.toLowerCase()&&(t=t.substr(0,t.length-1))}if(""!=s.BarcodeDef){let n=1,r="";e=new a.f,e.LoadXml(s.BarcodeDef);let o=e.SelectNodes("Definition/Field");for(let e=0;e<o.length;e++){let s="",i="",l="",h="",c=0,d=0;if(null!=o[e].SelectSingleNode("DataSource")&&(s=o[e].SelectSingleNode("DataSource").InnerText),null!=o[e].SelectSingleNode("SysColumn")&&(i=o[e].SelectSingleNode("SysColumn").InnerText),null!=o[e].SelectSingleNode("Delimiter")&&(l=o[e].SelectSingleNode("Delimiter").InnerText),null!=o[e].SelectSingleNode("Width")&&a.e.IsNum(o[e].SelectSingleNode("Width").InnerText)&&(c=parseInt(o[e].SelectSingleNode("Width").InnerText)),null!=o[e].SelectSingleNode("Decimals")&&a.e.IsNum(o[e].SelectSingleNode("Decimals").InnerText)&&(d=parseInt(o[e].SelectSingleNode("Decimals").InnerText)),-1==c&&""!=l){let e=t.indexOf(l);e>0&&e<t.length&&(h=t.substr(0,e),t=t.Remove(0,e))}else-1!=c&&t.length>=c?(h=t.substr(0,c),t=t.Remove(0,c)):-1==c&&e==o.length-1&&(h=t);""!=l&&t.length>l.length&&(t=t.Remove(0,l.length)),"Document"==s&&"Batch_No"==i?r=h:"Document"==s&&"Quantity"==i&&(n=a.e.IsNum(h)?a.e.Double(h):1)}if(""!=r){let e=this.dsBatch.Tables[0].filter(e=>e.BATCHNUMBER==r);if(e.length>0){let t=this.GridData.filter(t=>t.BatchID==e[0].BatchID);if(t.length>0){if(a.e.IsEmpty(t[0].Quantity))t[0].Quantity="1";else{if(a.e.IsEmpty(t[0].BalQty)||!(parseFloat(t[0].Quantity)<parseFloat(t[0].BalQty)))return void(this.DisplayMessage="Can not enter more than "+t[0].BalQty.toString());t[0].Quantity=parseFloat(t[0].Quantity)+1}return this.GridDataColumns.Contains("QtyUom")&&(t[0].QtyUom=a.e.IsEmpty(t[0].Quantity)?0:parseFloat(t[0].Quantity)/this.UomConversion),this.BatchScanning.Text="",event.preventDefault(),void(this.QtyAddMessage=a.e.Format(i.a.GetResource("BatchNo_AddMessage"),this.InvQty.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty),this.BatchQty.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty),this.ProdName.toString()))}}}}}event.preventDefault()}}onBinCLick(e){let t;if(("AddEditDocumentViewModel"==this.Parent.ClassName||"POSDocumentViewModel"==this.Parent.ClassName)&&this.SelectedRow&&!a.e.IsEmpty(this.SelectedRow.BatchID)&&a.e.Double(this.SelectedRow.Quantity)>0){t=parseFloat(this.SelectedRow.Quantity);let n=0,r=0,o=0,l=0,h=0,c=0;if(i.a.SessionManager.Preferences.ContainsKey("DimensionwiseBins")&&""!=i.a.SessionManager.Preferences.DimensionwiseBins.toString()){let e=!1;if(r=a.e.Int(i.a.SessionManager.Preferences.DimensionwiseBins),r>0){n=1;for(let t=0;t<this.Parent.ScreenObject._CCFields.length;t++){let s=this.Parent.ScreenObject._CCFields[t];if(s instanceof d.b&&s.CCID==r){s.SelectedValue>0&&(n=s.SelectedValue),e=!0;break}}e||null!=this.drSel&&r>5e4&&this.drSelObj.TableColumns.Contains("dcCCNID"+(r-5e4).toString()+"_Key")&&a.e.Int(this.drSel["dcCCNID"+(r-5e4).toString()+"_Key"])>0&&(n=parseInt(this.drSel["dcCCNID"+(r-5e4).toString()+"_Key"]))}}if(-1==this.VoucherType&&null!=this.SelectedRow&&(o=parseInt(this.SelectedRow.batchid),this.GridDataColumns.Contains("VoucherNo")&&(l=parseInt(this.SelectedRow.RefInvID))),this.Parent.ScreenObject.Preferences.ContainsKey("BinFilterDim")&&""!=this.Parent.ScreenObject.Preferences.BinFilterDim.toString()&&(c=a.e.Int(this.Parent.ScreenObject.Preferences.BinFilterDim),c>0&&(h=this.Parent.GetDimValue(c,this.Parent.SelectedRow))),r>5e4&&!this.Parent.ScreenObject.IsBinWise(r,n)){if(5==this.Parent.ScreenObject.DocumentType&&!this.Parent.ScreenObject.GridDataColumns.Contains("RecievedQty")&&r>0){let e=!1;n=1;for(let t=0;t<this.Parent.ScreenObject._CCFields.length;t++){let i=this.Parent.ScreenObject._CCFields[t];if(i instanceof d.b&&i.CCID==r){if(i.DBColumnName.Contains("TO"))i.SelectedValue>0&&(n=i.SelectedValue);else{var s=this.Parent.ScreenObject._CCFields.find(e=>e.DBColumnName=="TO"+i.DBColumnName);s instanceof d.b?s.SelectedValue>0&&(n=s.SelectedValue):i.SelectedValue>0&&(n=i.SelectedValue)}e=!0;break}}if(e||null!=this.drSel&&r>5e4&&this.drSelObj.TableColumns.Contains("dcCCNID"+(r-5e4).toString()+"_Key")&&(this.drSelObj.TableColumns.Contains("TOdcCCNID"+(r-5e4).toString()+"_Key")?a.e.Int(this.drSel["TOdcCCNID"+(r-5e4).toString()+"_Key"])>0&&(n=parseInt(this.drSel["TOdcCCNID"+(r-5e4).toString()+"_Key"])):a.e.Int(this.drSel["dcCCNID"+(r-5e4).toString()+"_Key"])>0&&(n=parseInt(this.drSel["dcCCNID"+(r-5e4).toString()+"_Key"]))),!(r>5e4)||this.Parent.ScreenObject.IsBinWise(r,n)){a.e.IsEmpty(this.drSel.TODocDetailsID)||(this.DocDetailsId=parseInt(this.drSel.TODocDetailsID));let e=this.Parent.ScreenObject.GetProductwiseBins(parseInt(this.drSel.ProductID_Key),this.Parent.ScreenObject.DocID,1,this.Parent.DocumentDate,r,n,c,h,0,0,0,this.Parent.GetBOEIDS(this.drSel)),s=new m.a(this,1,t,parseInt(this.drSel.ProductID_Key),this.drSel.ProductName.toString(),e,this.drSel);this.Parent.ScreenObject.Preferences.ContainsKey("AutoSelectBins")&&"true"==this.Parent.ScreenObject.Preferences.AutoSelectBins.toLowerCase()&&null!=e&&e.Tables.length>0&&1==e.Tables[0].length&&s.BinsGrid.Table.length>0?(s.BinsGrid.Table[0].Allocate=t,s.celledtiend(s.BinsGrid.Table[0]),s.DisplayMessage="",s.OnSave("AutoSave"),""!=s.DisplayMessage&&i.a.page.ShowDialog(s,b.a)):i.a.page.ShowDialog(s,b.a)}}}else{let s=0;-1!=this.VoucherType||a.e.IsEmpty(this.drSel.LinkedInvDocDetailsID)||(s=a.e.Int(this.drSel.LinkedInvDocDetailsID));let d=this.Parent.ScreenObject.GetProductwiseBins(this.ProductID,this.DocId,this.VoucherType,this.docdate,r,n,c,h,s,o,l,this.Parent.GetBOEIDS(this.drSel)),u=new m.a(this,this.VoucherType,t,this.ProductID,this.ProdName,d,this.drSel);"Auto"==e&&this.Parent.ScreenObject.Preferences.ContainsKey("AutoSelectBins")&&"true"==this.Parent.ScreenObject.Preferences.AutoSelectBins.toLowerCase()&&null!=d&&d.Tables.length>0&&1==d.Tables[0].length&&u.BinsGrid.Table.length>0?(u.BinsGrid.Table[0].Allocate=t,u.celledtiend(u.BinsGrid.Table[0]),u.DisplayMessage="",u.OnSave("AutoSave")):i.a.page.ShowDialog(u,b.a)}}}onEditClick(e){if(("AddEditDocumentViewModel"==this.Parent.ClassName||"POSDocumentViewModel"==this.Parent.ClassName)&&null!=this.SelectedRow&&!a.e.IsEmpty(this.SelectedRow.BatchID)){this.ExpanderVisibility=!0,this.Isexp=!0,null==this.StaticFields&&this.LoadStaticFields();let e=this.Parent.ScreenObject.GetBatchDetails(this.SelectedRow.BatchID.toString());if(e.Tables.length>0&&e.Tables[0].length>0){this.FromDate&&!a.e.IsEmpty(e.Tables[0][0].MfgDate)&&(this.FromDate.Date=new Date(e.Tables[0][0].MfgDate)),this.ExpDate&&!a.e.IsEmpty(e.Tables[0][0].ExpiryDate)&&(this.ExpDate.Date=new Date(e.Tables[0][0].ExpiryDate)),this.objBatch.BatchID=parseInt(e.Tables[0][0].BatchID),this.BatchNo.Text=e.Tables[0][0].BatchNumber.toString(),this.BatMRate.Text=e.Tables[0][0].MRPRate.toString(),this.BatSRate.Text=e.Tables[0][0].StockistRate.toString(),this.BatRRate.Text=e.Tables[0][0].RetailRate.toString(),this.objBatch.GUID=e.Tables[0][0].GUID.toString(),this.RetestDate&&!a.e.IsEmpty(e.Tables[0][0].RetestDate)&&(this.RetestDate.Date=new Date(e.Tables[0][0].RetestDate));for(let t=0;t<this.StaticFields.length;t++){let s=this.StaticFields[t];s instanceof h.c&&null!=s.DBColumnName&&(e.Columns[0].Contains(s.DBColumnName)?s instanceof o.d?s.Text=e.Tables[0][0][s.DBColumnName].toString():s instanceof S.e?s.SelectedValue=e.Tables[0][0][s.DBColumnName].toString():s instanceof o.c?s.Text=e.Tables[0][0][s.DBColumnName].toString():s instanceof u.b||s instanceof u.c||s instanceof u.a?a.e.isValidDate(e.Tables[0][0][s.DBColumnName])&&(s.Date=new Date(e.Tables[0][0][s.DBColumnName])):s instanceof C.a?s.Text=e.Tables[0][0][s.DBColumnName].toString():s instanceof d.b?a.e.IsNum(e.Tables[0][0][s.DBColumnName])&&(s.SelectedValue=parseInt(e.Tables[0][0][s.DBColumnName])):s instanceof o.a&&(s.Text=e.Tables[0][0].BatchCode.toString(),a.e.IsEmpty(e.Tables[0][0].CodePrefix)||(s.SuffixCode=e.Tables[0][0].CodePrefix.toString()),a.e.IsEmpty(e.Tables[0][0].CodeNumber)||(s.PrefixCode=e.Tables[0][0].CodeNumber.toString())):e.Columns[5].Contains(s.DBColumnName)&&a.e.IsNum(e.Tables[5][0][s.DBColumnName])&&(s.SelectedValue=parseInt(e.Tables[5][0][s.DBColumnName])))}}}}SetBalQty(){if(("AddEditDocumentViewModel"==this.Parent.ClassName||"POSDocumentViewModel"==this.Parent.ClassName)&&null!=this.drSel&&!a.e.IsEmpty(this.drSel.ProductID_Key)){let e;if(e=30==this.Parent.ScreenObject.DocumentType&&this.Parent.ScreenObject.GridDataColumns.Contains("VoucherType")&&!a.e.IsEmpty(this.drSel.VoucherType)?this.Parent.ScreenObject.GridData.filter(e=>e.ProductID_Key==this.drSel.ProductID_Key&&e.VoucherType==this.drSel.VoucherType):this.Parent.ScreenObject.GridData.filter(e=>e.ProductID_Key==this.drSel.ProductID_Key),i.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise Batches")&&!a.e.IsEmpty(i.a.SessionManager.Preferences["Maintain Dimensionwise Batches"])){let t=0;t=a.e.Int(i.a.SessionManager.Preferences["Maintain Dimensionwise Batches"].toString()),t>0&&null!=this.drSel&&t>5e4&&!a.e.IsEmpty(this.drSel["dcCCNID"+(t-5e4).toString()+"_Key"])&&(e=e.filter(e=>e["dcCCNID"+(t-5e4).toString()+"_Key"]==this.drSel["dcCCNID"+(t-5e4).toString()+"_Key"].toString()))}if(e.length>0){let t=[];if(e.forEach(e=>{if(!a.e.IsEmpty(e.ExtraXML)&&this.drSel!=e){let s=new a.f;if(s.ReadXml(e.ExtraXML),s.Tables.length>0&&s.Tables[0].length>0&&s.Columns[0].Contains("BatchID")&&s.Columns[0].Contains("Quantity"))for(let e=0;e<s.Tables[0].length;e++){let i={};i.BatchID=s.Tables[0][e].BatchID.toString(),i.Qty=s.Tables[0][e].Quantity.toString(),s.Columns[0].Contains("RefInvID")&&!a.e.IsEmpty(s.Tables[0][e].RefInvID)&&(i.RefINvID=s.Tables[0][e].RefInvID.toString()),t.push(i)}}}),t.length>0)for(let s=0;s<this.GridData.length;s++)if(a.e.Int(this.GridData[s].BatchID)>0&&(e=t.filter(this.ConsolidatedBatches?e=>e.BatchID==this.GridData[s].BatchID:e=>e.BatchID==this.GridData[s].BatchID&&e.RefINvID==this.GridData[s].RefInvID),e.length>0)){let t=0,n=0;t=a.e.Double(this.GridData[s].BalQty);let r=t.toString();i.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=i.a.SessionManager.Preferences.DecimalsinQty&&(r=t.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty)),t=parseFloat(r),e.forEach(e=>{a.e.IsEmpty(e.Qty)||(n+=parseFloat(e.Qty))}),t-=n,this.GridData[s].BalQty=i.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=i.a.SessionManager.Preferences.DecimalsinQty?t.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty):t}}}}OnComboCellEditEnding(e){if("BatchID"==e.column.field){let t=a.e.Int(e.item.BatchID);t>0&&this.OnBatchSelected(e.item,t)}}OnBatchSelected(e,t){if(this.dvCombo=this.dvComboTable.filter(e=>e.BatchID==t),null!=this.dvCombo&&this.dvCombo.length>0){this.GridDataColumns.Contains("Edit")&&(e.Edit="Edit"),this.GridDataColumns.Contains("Bins")&&(e.Bins="Bins"),this.dvComboColumns.Contains("BatchCode")&&(e.BatchCode=this.dvCombo[0].BatchCode.toString()),e.BATCHNUMBER=this.dvCombo[0].BATCHNUMBER.toString(),e.MfgDate=a.e.isValidDate(this.dvCombo[0].MfgDate)?this.OnlyMonthYear?new Date(this.dvCombo[0].MfgDate).ToString("MMM/yyyy"):new Date(this.dvCombo[0].MfgDate).ToString(i.a.SessionManager.Preferences["Date Format"]):"",e.ExpDate=a.e.isValidDate(this.dvCombo[0].ExpiryDate)?this.OnlyMonthYear?new Date(this.dvCombo[0].ExpiryDate).ToString("MMM/yyyy"):new Date(this.dvCombo[0].ExpiryDate).ToString(i.a.SessionManager.Preferences["Date Format"]):"",e.MRate=a.e.IsEmpty(this.dvCombo[0].MRATE)?"":this.dvCombo[0].MRATE.toString(),e.RRate=a.e.IsEmpty(this.dvCombo[0].RRATE)?"":this.dvCombo[0].RRATE.toString(),a.e.IsEmpty(this.dvCombo[0].SRATE)||(e.SRate=this.dvCombo[0].SRATE.toString());for(let t=0;t<this.dtmap.length;t++)this.dtmap[t].BatchCol.toString().toLowerCase().Contains("ccnid")&&this.dtmap[t].BaseCol.toString().toLowerCase().Contains("ccnid")&&this.GridDataColumns.Contains(this.dtmap[t].BatchCol.toString()+"_Key")&&this.dvComboColumns.Contains(this.dtmap[t].BatchCol.toString())&&!a.e.IsEmpty(this.dvCombo[0][this.dtmap[t].BatchCol.toString()])?(e[this.dtmap[t].BatchCol.toString()]=this.dvCombo[0][this.dtmap[t].BatchCol.toString()+"_Key"].toString(),e[this.dtmap[t].BatchCol.toString()+"_Key"]=this.dvCombo[0][this.dtmap[t].BatchCol.toString()].toString()):this.dvComboColumns.Contains(this.dtmap[t].BatchCol.toString())&&this.GridDataColumns.Contains(this.dtmap[t].BatchCol.toString())&&(e[this.dtmap[t].BatchCol.toString()]=this.dvCombo[0][this.dtmap[t].BatchCol.toString()].toString());if(null!=this.dsBatch.Tables[4]&&this.dsBatch.Tables[4].length>0)for(let t=0;t<this.dsBatch.Tables[4].length;t++)if(!a.e.IsEmpty(this.dsBatch.Tables[4][t].CostcenterColID)&&parseInt(this.dsBatch.Tables[4][t].CostcenterColID)<53692&&parseInt(this.dsBatch.Tables[4][t].CostcenterColID)>1572){let s=this.dsBatch.Tables[4][t].Name.toString();this.dsBatch.Tables[4][t].Name.toString().toLowerCase().Contains("ccnid")?(this.dvComboColumns.Contains(s+"_Key")&&(e[this.dsBatch.Tables[4][t].Name.toString()]=this.dvCombo[0][s+"_Key"].toString()),this.GridDataColumns.Contains(s+"_Key")&&(e[s+"_Key"]=this.dvCombo[0][s].toString())):""!=s&&"retestdate"==s.toLowerCase()&&this.dvComboColumns.Contains(s)?a.e.isValidDate(this.dvCombo[0][s])?e[this.dsBatch.Tables[4][t].Name.toString()]=new Date(this.dvCombo[0][s]).ToString(i.a.SessionManager.Preferences["Date Format"]):e[this.dsBatch.Tables[4][t].Name.toString()]="":""!=s&&this.dvComboColumns.Contains(s)&&"MfgDate"!=s&&"ExpiryDate"!=s&&(e[this.dsBatch.Tables[4][t].Name.toString()]=this.dvCombo[0][s].toString())}this.GridDataObj.updateRow(e)}}OnBeginEdit(e){let t=e.args;"Quantity"==t.column.field&&this.SelectQty(t.item)}SelectQty(e){let t=a.e.Double(e.Quantity);if(a.e.IsEmpty(e.Quantity)||0==t){let t=0,s=this.GridData.Compute("sum","Quantity");null!=s&&(t=a.e.Double(s)),t=this.BatchQty-t,-1==this.VoucherType&&t>0&&(a.e.IsEmpty(e.BalQty)||(e.Quantity=t>parseFloat(e.BalQty)?e.BalQty:t,this.GridDataColumns.Contains("QtyUom")&&(e.QtyUom=a.e.IsEmpty(e.Quantity)?0:parseFloat(e.Quantity)/this.UomConversion)))}}OnCellEditEnding(e){if("BatchID"==e.column.field){let t=a.e.Int(e.item.BatchID);t>0&&this.OnBatchSelected(e.item,t)}else{let t=e.item;if("DataGridComboBoxColumn"==e.column.className)return;let s=e.column.field;if("QtyUom"==s&&(t.Quantity=a.e.IsEmpty(t.QtyUom)?0:parseFloat(t.QtyUom)*this.UomConversion,s="Quantity"),"Quantity"==s){if(-1==this.VoucherType&&!a.e.IsEmpty(t.BalQty)&&!a.e.IsEmpty(t.Quantity)){let e=!1;("AddEditDocumentViewModel"==this.Parent.ClassName||"POSDocumentViewModel"==this.Parent.ClassName)&&this.Parent.ScreenObject.Preferences.ContainsKey("AllowNegativebatches")&&Object(n.j)(this.Parent.ScreenObject.Preferences.AllowNegativebatches)&&(e="AddEditDocumentViewModel"!=this.Parent.ClassName&&"POSDocumentViewModel"!=this.Parent.ClassName||!this.Parent.ScreenObject.Preferences.ContainsKey("DontAllowNegative")||!Object(n.j)(this.Parent.ScreenObject.Preferences.DontAllowNegative)),31==this.Parent.DocumentType&&(e=!0),!e&&parseFloat(t.BalQty)<parseFloat(t.Quantity)&&(t.Quantity=t.BalQty,this.DisplayMessage="Can not enter more than "+t.BalQty.toString())}this.GridDataColumns.Contains("Release")?a.e.IsEmpty(t.Quantity)||(a.e.IsEmpty(t.Release)||a.e.IsEmpty(t.Hold)||!a.e.IsEmpty(t.Hold)&&0==parseFloat(t.Hold))&&(t.Release=t.Quantity.toString(),t.Hold=0):(a.e.IsEmpty(t.Quantity)||!a.e.IsEmpty(t.Quantity)&&0==parseFloat(t.Quantity))&&(this.GridDataColumns.Contains("Release")&&(t.Release=""),this.GridDataColumns.Contains("Hold")&&(t.Hold="")),this.GridDataColumns.Contains("QtyUom")&&(t.QtyUom=a.e.IsEmpty(t.Quantity)?0:parseFloat(t.Quantity)/this.UomConversion),this.InvQty=0;for(let e=0;e<this.GridData.length;e++)a.e.IsEmpty(this.GridData[e].Quantity)||a.e.IsEmpty(this.GridData[e].BatchID)||(this.InvQty+=parseFloat(this.GridData[e].Quantity));this.Parent.ScreenObject.Preferences.ContainsKey("AutoPopulateBatchQty")&&"true"==this.Parent.ScreenObject.Preferences.AutoPopulateBatchQty.toLowerCase()&&null!=this.txtqty&&(this.txtqty.Text=(this.BatchQty-this.InvQty).toString()),this.GridDataColumns.Contains("BinsXML")&&this.Parent.ScreenObject.Preferences.ContainsKey("AutoSelectBins")&&"true"==this.Parent.ScreenObject.Preferences.AutoSelectBins.toLowerCase()&&this.onBinCLick("Auto")}if(1==this.VoucherType&&this.HoldRelease&&!a.e.IsEmpty(t.Release)&&"Release"==s&&(a.e.IsEmpty(t.Hold)&&(t.Hold=0),this.Tot=parseFloat(t.Hold)+parseFloat(t.Release),this.Tot!=parseFloat(t.Quantity)))return void(this.DisplayMessage=i.a.GetResource("Batch_QtySum").toString());this.GridDataObj.updateRow(t),this.QtyAddMessage=a.e.Format(i.a.GetResource("BatchNo_AddMessage"),this.InvQty.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty),this.BatchQty.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty),this.ProdName.toString()),Logger.InfoLog("OnCellEditEnding:: Exiting OnCellEditEnding")}}FillEmptyRows(){if(null!=this.GridData&&this.GridDataColumns.Contains("Sno")){for(let e=0;e<this.GridData.length;e++)this.GridData[e].Sno=e+1;for(let e=this.GridData.length;e<8;e++){let t=this.GridDataObj.NewRow();t.Sno=e+1,this.GridDataObj.addRow(t)}}}GridData_RowDeleted(e){let t=1;this.GridData.forEach(e=>{"DELETED"!=e.RowState.toString().toUpperCase()&&(e.Sno=t++)}),this.QtyAddMessage=a.e.Format(i.a.GetResource("BatchNo_AddMessage"),(t-1).ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty),this.BatchQty.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty),this.ProdName.toString())}Validate(){if(null!=this.FromDate&&null!=this.ExpDate&&this.FromDate.Date>this.ExpDate.Date)return this.DisplayMessage="Expiry Date cannot be less than Manufacturing Date",!0;let e=this.BatMRate.ValidateData();return a.e.IsEmpty(e)?(e=this.BatRRate.ValidateData(),a.e.IsEmpty(e)?(e=this.BatSRate.ValidateData(),a.e.IsEmpty(e)?(e=this.BatchNo.ValidateData(),!a.e.IsEmpty(e)&&(this.DisplayMessage=e+" BatchNo",!0)):(this.DisplayMessage=e+" SRate",!0)):(this.DisplayMessage=e+" RRate",!0)):(this.DisplayMessage=e+" MRate ",!0)}AddRow(e){let t=this.Parent.GetEmptyRowPosition(this.GridDataObj,"BatchID");this.GridData[t].BatchID=e,this.OnBatchSelected(this.GridData[t],e),this.GridData[t].Quantity=null==this.txtqty||a.e.IsEmpty(this.txtqty.Text)||""!=this.txtqty.ValidateData()?1:this.txtqty.Text,this.GridDataColumns.Contains("QtyUom")&&(this.GridData[t].QtyUom=a.e.IsEmpty(this.GridData[t].Quantity)?0:parseFloat(this.GridData[t].Quantity)/this.UomConversion),this.GridDataObj.updateRow(this.GridData[t])}OnSave(e){if(this.GridDataObj.commitEdit(),"Fifo"==e.toString())this.ChkFifo=!this.ChkFifo;else if("Fifoall"==e.toString())this.ChkFifoAll=!this.ChkFifoAll;else if("AddBatch"==e.toString()||"SaveAddBatch"==e.toString()||"SaveAddMultiple"==e.toString()||"SaveAsBatch"==e.toString()||this.IsQuickAdd&&"Save"==e.toString()){let s="";if(0==this.objBatch.BatchID&&null!=this.txtqty&&""!=this.txtqty.ValidateData())return void(this.DisplayMessage=this.txtqty.ValidateData());if(0==this.objBatch.BatchID&&null!=this.txtqty&&"SaveAddBatch"==e.toString()&&0==parseFloat(this.txtqty.Text))return void(this.DisplayMessage="Enter Qty.");for(let e=0;e<this.StaticFields.length;e++){let t=this.StaticFields[e],i="";if(t instanceof h.c&&null!=t.DBColumnName&&!t.IsColumnUserDefined)if(t instanceof o.d)if(i=t.Text,a.e.IsEmpty(i)&&(i=""),"BatchNumber"==t.DBColumnName&&""!=i)this.BatchNo.Text=i.replace("'","''");else{if("BatchNumber"==t.DBColumnName&&""==i)return void(this.DisplayMessage="Enter Batch No");"MRPRate"==t.DBColumnName?this.BatMRate.Text=i.toString():"StockistRate"==t.DBColumnName?this.BatSRate.Text=i.toString():"RetailRate"==t.DBColumnName?this.BatRRate.Text=i.toString():t!=this.txtqty&&(s+=t.DBColumnName+"=N'"+i.replace("'","''")+"',")}else if(t instanceof u.c){if(t.Mandatory&&!t.Date)return void(this.DisplayMessage="select "+t.Label)}else t instanceof d.b?null==t.DBColumnName||t.DBColumnName.toLowerCase().Contains("ccnid")||(s+=t.DBColumnName+"='"+t.SelectedValue+"',"):t instanceof o.c?(i=t.Text,a.e.IsEmpty(i)&&(i=""),s+=t.DBColumnName+"=N'"+i.replace("&","&am;").replace("'","''")+"',"):t instanceof S.e&&(i=t.SelectedValue,a.e.IsEmpty(i)&&(i=""),s+=t.DBColumnName+"='"+i.replace("&","&am;").replace("'","''")+"',")}if(!this.Validate())try{let n=0;n=this.objBatch.BatchID;let r=[];if(0==this.objBatch.BatchID&&null!=this.ControlGen){let e={StrCode:this.objBatch.BatchCode,CodePrefix:this.objBatch.CodePrefix,CodeNumber:this.objBatch.CodeNumber};if(this.DisplayMessage=this.ControlGen.SetAutoCodeParams_3(this.BatchCode,this.objBatch.BatchGroup,this.dsBatch.Tables[6],e),this.objBatch.BatchCode=e.StrCode,this.objBatch.CodePrefix=e.CodePrefix,this.objBatch.CodeNumber=e.CodeNumber,this.DisplayMessage.length>0)return}else this.objBatch.BatchCode=this.BatchCode.PrefixVisibility||this.BatchCode.SuffixVisibility?this.BatchCode.PrefixCode+this.BatchCode.Text+this.BatchCode.SuffixCode:this.BatchCode.Text;r.push(this.BatchNo.Text.toString()),r.push(null!=this.FromDate&&this.FromDate.Date?this.FromDate.Date.ToString("dd/MMM/yyyy"):"1/JAN/1900"),null!=this.ExpDate&&this.ExpDate.Date?(this.OnlyMonthYear&&this.ExpDate.Date.getDate()!=this.ExpDate.Date.DaysInMonth()&&(this.ExpDate.Date=new Date(this.ExpDate.Date.getFullYear(),this.ExpDate.Date.getMonth(),this.ExpDate.Date.DaysInMonth())),r.push(this.ExpDate.Date.ToString("dd/MMM/yyyy"))):r.push("1/JAN/1900"),null==this.BatMRate.Text||""==this.BatMRate.Text.Trim()?r.push(0):r.push(this.BatMRate.Text),null==this.BatRRate.Text||""==this.BatRRate.Text.Trim()?r.push(0):r.push(this.BatRRate.Text),null==this.BatSRate.Text||""==this.BatSRate.Text.Trim()?r.push(0):r.push(this.BatSRate.Text),r.push(this.ProductID),r.push(null!=this.RetestDate&&this.RetestDate.Date?this.RetestDate.Date.ToString("dd/MMM/yyyy"):"1/JAN/1900"),r.push(0),this.objBatch.StaticFieldsQuery=s.toString(),this.objBatch.CustomFieldsQuery=this.GetCustomFieldsQuery(),this.objBatch.CustomCostCenterFieldsQuery=this.GetCustomCostCenterFieldsQuery(),"SaveAsBatch"==e.toString()&&(this.objBatch.BatchID=0);let o,l=null;if("SaveAddMultiple"==e.toString()?(r.push(this.BatchQty/parseFloat(this.txtqty.Text)),r.push(this.BNO),r.push(this.NextSeq),r.push(this.Seqlen),l=p.QuickAddBatchMultple(this.objBatch,r,this.IsBatchSeqNoExists),console.log(l),o={},o.RetValue=l.obj):o=p.QuickAddBatch(this.objBatch,r,this.IsBatchSeqNoExists),this.DisplayMessage=o.Message,o.RetValue>0){if(this.IsQuickAdd)return this.DocId=o.RetValue,void i.a.page.HideDialog();let s=0;"AddEditDocumentViewModel"!=this.Parent.ClassName&&"POSDocumentViewModel"!=this.Parent.ClassName||(s=this.Parent.CostCenterID);let r=-1,h=-1,c=0,u=!1;if(("AddEditDocumentViewModel"==this.Parent.ClassName||"POSDocumentViewModel"==this.Parent.ClassName)&&i.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise Batches")&&""!=i.a.SessionManager.Preferences["Maintain Dimensionwise Batches"].toString()&&(c=a.e.Int(i.a.SessionManager.Preferences["Maintain Dimensionwise Batches"]),c>0)){for(let e=0;e<this.Parent.ScreenObject._CCFields.length;e++){let t=this.Parent.ScreenObject._CCFields[e];if(t instanceof d.b&&t.CCID==c){r=t.SelectedValue,u=!0;break}}u||null!=this.drSel&&c>5e4&&this.drSelObj.TableColumns.Contains("dcCCNID"+(c-5e4).toString()+"_Key")&&!a.e.IsEmpty(this.drSel["dcCCNID"+(c-5e4).toString()+"_Key"])&&(r=parseInt(this.drSel["dcCCNID"+(c-5e4).toString()+"_Key"]))}if(("AddEditDocumentViewModel"==this.Parent.ClassName||"POSDocumentViewModel"==this.Parent.ClassName)&&this.Parent.ScreenObject.Preferences.ContainsKey("BatchFilterDim")&&(u=!1,c=a.e.Int(this.Parent.ScreenObject.Preferences.BatchFilterDim),c>0)){for(let e=0;e<this.Parent.ScreenObject._CCFields.length;e++){let t=this.Parent.ScreenObject._CCFields[e];if(t instanceof d.b&&t.CCID==c){h=t.SelectedValue>0?t.SelectedValue:1,u=!0;break}}u||null!=this.drSel&&c>5e4&&this.drSelObj.TableColumns.Contains("dcCCNID"+(c-5e4).toString()+"_Key")&&(u=!0,h=a.e.IsEmpty(this.drSel["dcCCNID"+(c-5e4).toString()+"_Key"])?1:parseInt(this.drSel["dcCCNID"+(c-5e4).toString()+"_Key"]))}let D=(new p).GetProductwiseBatches(this.ProductID,this.DocDetailsId,this.DocId,this.VoucherType,this.docdate,this.Div,this.Loc,s,r,h);if(D.Tables.length>1){var t=this.ColumnSource.find(e=>null!=e.ValueBinding&&"BatchID"==e.ValueBinding);if(t&&(t.ComboData=D.Tables[0]),this.dvCombo=D.Tables[0],this.dvComboTable=D.Tables[0],this.dvComboColumns=D.Columns[0],n>0)this.GridData.filter(e=>e.BatchID==o.RetValue).forEach(e=>{this.OnBatchSelected(e,o.RetValue),this.GridDataObj.updateRow(e)});else if("SaveAddMultiple"!=e.toString()||null==l||l.Tables[l.Tables.length-1].Columns.Contains("ErrorMessage")){if("SaveAddBatch"==e.toString()&&D.Tables[0].filter(e=>e.BatchID==o.RetValue).length>0){this.AddRow(o.RetValue),this.InvQty=0;let e=this.GridData.Compute("sum","Quantity");null!=e&&(this.InvQty=a.e.Double(e)),this.InvQty=this.BatchQty-this.InvQty,this.QtyAddMessage=a.e.Format(i.a.GetResource("BatchNo_AddMessage"),this.InvQty.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty),this.BatchQty.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty),this.ProdName.toString())}}else{let e=l.Tables.length-1;for(let s=0;s<l.Tables[e].length;s++){let t=l.Columns[e][0];D.Tables[0].filter(i=>i.BatchID==l.Tables[e][s][t]).length>0&&this.AddRow(parseInt(l.Tables[e][s][t]))}this.InvQty=0;let t=this.GridData.Compute("sum","Quantity");null!=t&&(this.InvQty=a.e.Double(t)),this.InvQty=this.BatchQty-this.InvQty,this.QtyAddMessage=a.e.Format(i.a.GetResource("BatchNo_AddMessage"),this.InvQty.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty),this.BatchQty.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty),this.ProdName.toString())}}if(this.dtmap.Clear(),D.Tables.length>3)for(let e=0;e<D.Tables[3].length;e++){let t={};t.BatchCol=D.Tables[3][e].BatchCol.toString(),t.BaseCol=D.Tables[3][e].BaseCol.toString(),this.dtmap.push(t)}this.GridDataObj.RefreshGrid=!this.GridDataObj.RefreshGrid,this.ResetBatchNo(n),this.objBatch.GUID="",this.objBatch.BatchID=0,this.BatMRate.Text="",this.BatRRate.Text="",this.BatSRate.Text="",this.GridDataObj.gridObj&&this.GridDataObj.gridObj.invalidate()}}catch(r){Logger.InfoLog("BatchNumberViewModel:: OnSave"+r.stack)}}else if("Save"==e.toString()||"AutoSave"==e.toString()||"AutoSaveScan"==e.toString()){if("IWODetailsViewModel"==this.Parent.ClassName)return void this.SaveWO();let t="",r="",o="";if(i.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=i.a.SessionManager.Preferences.DecimalsinQty){let e=this.InvQty.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty);this.InvQty=parseFloat(e)}let l=!1;if(this.Parent.ScreenObject.Preferences.ContainsKey("QtyonBatch")&&""!=this.Parent.ScreenObject.Preferences.QtyonBatch&&Object(n.j)(this.Parent.ScreenObject.Preferences.QtyonBatch)&&(l=!0),this.InvQty>this.BatchQty&&!l)return void(this.DisplayMessage=i.a.GetResource("Batch_QtyMisMatch"));if(1==this.VoucherType&&this.HoldRelease)for(let e=0;e<this.GridData.length;e++)if(!a.e.IsEmpty(this.GridData[e].BatchID)&&!a.e.IsEmpty(this.GridData[e].Release)&&!a.e.IsEmpty(this.GridData[e].Quantity)&&parseFloat(this.GridData[e].Hold)+parseFloat(this.GridData[e].Release)!=parseFloat(this.GridData[e].Quantity))return void(this.DisplayMessage=i.a.GetResource("Batch_QtySumRow").toString()+e+1);let h=0;for(let e=0;e<this.GridData.length;e++)if(!a.e.IsEmpty(this.GridData[e].BatchID)&&a.e.IsNum(this.GridData[e].Quantity)){if(h+=parseFloat(this.GridData[e].Quantity),this.GridDataColumns.Contains("QOH")&&a.e.IsNum(this.GridData[e].QOH)&&parseFloat(this.GridData[e].Quantity)>parseFloat(this.GridData[e].QOH))return void(this.DisplayMessage="Can not enter more than "+this.GridData[e].QOH.toString()+" ,at row no:"+this.GridData[e].Sno.toString());let t=!1;if("AddEditDocumentViewModel"!=this.Parent.ClassName&&"POSDocumentViewModel"!=this.Parent.ClassName||this.Parent.DonotUpdateInventory||(t=!0),("AddEditDocumentViewModel"==this.Parent.ClassName||"POSDocumentViewModel"==this.Parent.ClassName)&&this.Parent.ScreenObject.Preferences.ContainsKey("ExcludeHoldBins")&&""!=this.Parent.ScreenObject.Preferences.ExcludeHoldBins.toString()&&Object(n.j)(this.Parent.ScreenObject.Preferences.ExcludeHoldBins)&&(this.Parent.ScreenObject.GridDataColumns.Contains("ReserveQuantity")||this.Parent.ScreenObject.GridDataColumns.Contains("HoldQuantity"))&&(t=!0),this.GridDataColumns.Contains("BinsXML")&&t&&parseFloat(this.GridData[e].Quantity)>0&&this.Parent.ScreenObject.GridDataColumns.Contains("BinWise")&&"True"==this.drSel.BinWise.toString()&&this.Parent.IsWarehouseBinwise(this.Parent.ScreenObject.SelectedGridRowIndex,0,{DimensionID:0})){let t=!1;if((this.Parent.ScreenObject.GridDataColumns.Contains("BinStatus")||this.Parent.ScreenObject.Preferences.ContainsKey("AutoSelectBins")&&"true"==this.Parent.ScreenObject.Preferences.AutoSelectBins.toLowerCase())&&(t=!0),!this.Parent.ScreenObject.Preferences.ContainsKey("AutoAdjustBins")||a.e.IsEmpty(this.Parent.ScreenObject.Preferences.AutoAdjustBins)||!Object(n.j)(this.Parent.ScreenObject.Preferences.AutoAdjustBins)||""!=a.e.String(this.drSel.DocDetailsID)&&0!=parseInt(a.e.String(this.drSel.DocDetailsID))||(t=!0),a.e.IsEmpty(this.GridData[e].BinsXML)&&!t)return void(this.DisplayMessage=i.a.GetResource("Doc_BinsMissMatch")+" "+this.GridData[e].Sno.toString());let s=0;if(""!=this.GridData[e].BinsXML.toString()){let t=new a.f;t.LoadXml(this.GridData[e].BinsXML);let i=t.SelectNodes("BinsXML/Row");for(let e=0;e<i.length;e++)null!=i[e].attributes.Allocate.value&&""!=i[e].attributes.Allocate.value&&(s+=parseFloat(i[e].attributes.Allocate.value))}if(s!=parseFloat(this.GridData[e].Quantity)&&!t)return void(this.DisplayMessage=i.a.GetResource("Doc_BinsMissMatch")+" "+this.GridData[e].Sno.toString())}if(this.GridDataColumns.Contains("ToBinsXML")&&t&&parseFloat(this.GridData[e].Quantity)>0&&!this.Parent.ScreenObject.GridDataColumns.Contains("RecievedQty")&&this.Parent.ScreenObject.GridDataColumns.Contains("BinWise")&&"True"==this.drSel.BinWise.toString()&&this.Parent.IsWarehouseBinwise(this.Parent.ScreenObject.SelectedGridRowIndex,1,{DimensionID:0})){if(a.e.IsEmpty(this.GridData[e].ToBinsXML)&&!this.Parent.ScreenObject.GridDataColumns.Contains("BinStatus"))return void(this.DisplayMessage=i.a.GetResource("Doc_BinsMissMatch")+" "+this.GridData[e].Sno.toString());let t=0;if(""!=this.GridData[e].BinsXML.toString()){let s=new a.f;s.LoadXml(this.GridData[e].BinsXML);let i=s.SelectNodes("BinsXML/Row");for(let e=0;e<i.length;e++)null!=i[e].attributes.Allocate.value&&""!=i[e].attributes.Allocate.value&&(t+=parseFloat(i[e].attributes.Allocate.value))}if(t!=parseFloat(this.GridData[e].Quantity)&&!this.Parent.ScreenObject.GridDataColumns.Contains("BinStatus"))return void(this.DisplayMessage=i.a.GetResource("Doc_BinsMissMatch")+" "+this.GridData[e].Sno.toString())}}if(i.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=i.a.SessionManager.Preferences.DecimalsinQty){let e=h.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty);h=parseFloat(e)}if(h!=this.BatchQty&&!l)return void(this.DisplayMessage="Qty not equal");let c="";this.count=0;let d=!1;this.Parent.ScreenObject.Preferences.ContainsKey("ConsBatch")&&"True"==this.Parent.ScreenObject.Preferences.ConsBatch&&(d=!0);let u=0;for(let n=0;n<this.GridData.length;n++)if(!a.e.IsEmpty(this.GridData[n].BatchID)&&a.e.Double(this.GridData[n].Quantity)>0&&(this.count++,"AddEditDocumentViewModel"==this.Parent.ClassName||"POSDocumentViewModel"==this.Parent.ClassName)){let l=0;if(null!=this.drSel&&(l=this.drSelObj.Table.indexOf(this.drSel)),this.dvCombo=this.dvComboTable.filter(e=>e.BatchID==this.GridData[n].BatchID),this.dvCombo.length>0&&(t=this.dvCombo[0].BATCHNUMBER.toString()),this.dvCombo=this.dvComboTable,a.e.IsEmpty(this.GridData[n].MfgDate)||(r=this.GridData[n].MfgDate.toString()),a.e.IsEmpty(this.GridData[n].ExpDate)||(o=this.GridData[n].ExpDate.toString()),d&&1!=this.count||(c="",c+="<xml>"),c+="<Row ",c+=' ProductID="'+this.ProductID.toString()+'" ',c+=' BatchID="'+this.GridData[n].BatchID.toString()+'" ',c+=' Quantity="'+this.GridData[n].Quantity.toString()+'" ',"AddEditDocumentViewModel"==this.Parent.ClassName&&""!=this.VarFldName&&31==this.Parent.DocumentType||32==this.Parent.DocumentType?c+=' Hold="0" Release="'+this.GridData[n].Quantity.toString()+'" ':1==this.VoucherType?this.HoldRelease?(c+=' Hold="'+this.GridData[n].Hold.toString()+'" ',c+=' Release="'+this.GridData[n].Release.toString()+'" '):(c+=' Hold="0" ',c+=' Release="'+this.GridData[n].Quantity.toString()+'" '):-1!=this.VoucherType||this.ConsolidatedBatches||(c+=' RefInvID="'+this.GridData[n].RefInvID.toString()+'" '),d&&(a.e.IsEmpty(this.GridData[n].DetID)?c+=' DocDetailsID="0" ':c+=' DocDetailsID="'+this.GridData[n].DetID.toString()+'" ',a.e.IsEmpty(this.GridData[n].LinkedID)?c+=' LinkedID="0" ':c+=' LinkedID="'+this.GridData[n].LinkedID.toString()+'" ',c+=' Seq="'+this.count+'" '),c+=" ></Row>",!d){if(c+="</xml>",this.count>1){"AutoSaveScan"==e.toString()&&!a.e.IsEmpty(this.GridData[u].BalQty)&&!a.e.IsEmpty(this.GridData[u].Quantity)&&parseFloat(this.GridData[u].BalQty.toString())<=parseFloat(this.GridData[u].Quantity.toString())&&(this.Parent.ScreenObject.GridDataColumns.Contains("IsFullBatchScanned")||this.Parent.ScreenObject.GridDataColumns.push("IsFullBatchScanned"),this.drSelTable[l].IsFullBatchScanned="1"),l=l+this.count-1;let t=this.drSelObj.NewRow();for(let e=0;e<this.drSelObj.TableColumns.length;e++){let s=this.drSelObj.TableColumns[e];"IsFullBatchScanned"!=s&&(t[s]="DocDetailsID"==s||"TODocDetailsID"==s?0:this.drSel[s])}this.drSelObj.insertRowAt(t,l)}if(u=n,""!=this.VarFldName&&31==this.Parent.DocumentType||32==this.Parent.DocumentType){this.drSelObj.Table[l][this.VarFldName]=parseFloat(this.GridData[n].Quantity),this.drSelObj.Table[l].QOH=this.Parent.ScreenObject.GetBatchWiseQOH(this.ProductID.toString(),this.GridData[n].BatchID.toString(),this.drSelObj.Table[l]);let e=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&25398==e.LinkData);e.length>0&&this.drSelObj.TableColumns.Contains(e[0].SysColumnName.toString())&&(this.drSelObj.Table[l][e[0].SysColumnName.toString()]=this.drSelObj.Table[l].QOH)}else a.e.Int(this.drSelObj.Table[l].SchemeID)>0&&"Y"==this.drSelObj.Table[l].IsScheme.toString()?(this.drSelObj.Table[l].FreeQTY=a.e.IsEmpty(this.drSelObj.Table[l].UOMConversion)?this.GridData[n].Quantity.toString():parseFloat(this.GridData[n].Quantity)/parseFloat(this.drSelObj.Table[l].UOMConversion),a.e.IsEmpty(this.drSelObj.Table[l].UOMConversion)||a.e.IsEmpty(this.drSelObj.Table[l].Quantity)||(this.drSelObj.Table[l].UOMConvertedQty=parseFloat(this.drSelObj.Table[l].Quantity)*parseFloat(this.drSelObj.Table[l].UOMConversion))):(this.drSelObj.Table[l].Quantity=a.e.IsEmpty(this.drSelObj.Table[l].UOMConversion)?this.GridData[n].Quantity.toString():parseFloat(this.GridData[n].Quantity)/parseFloat(this.drSelObj.Table[l].UOMConversion),a.e.IsEmpty(this.drSelObj.Table[l].UOMConversion)||a.e.IsEmpty(this.drSelObj.Table[l].Quantity)||(this.drSelObj.Table[l].UOMConvertedQty=parseFloat(this.drSelObj.Table[l].Quantity)*parseFloat(this.drSelObj.Table[l].UOMConversion)),38==this.Parent.DocumentType&&1==this.VoucherType&&(a.e.IsEmpty(this.drSelTable[l].UOMConvertedQty)||(this.drSelTable[l].UOMConvertedQty=-1*parseFloat(this.drSelTable[l].UOMConvertedQty)),a.e.IsEmpty(this.drSelTable[l].Quantity)||(this.drSelTable[l].Quantity=-1*parseFloat(this.drSelTable[l].Quantity))));if(this.drSelObj.Table[l].ExtraXML=c.toString(),this.GridDataColumns.Contains("BinsXML")&&("AddEditDocumentViewModel"==this.Parent.ClassName||"POSDocumentViewModel"==this.Parent.ClassName)&&this.drSelObj.TableColumns.Contains("BinWise")&&"True"==this.drSelObj.Table[l].BinWise.toString()){this.drSelObj.Table[l].BinsXML=this.GridData[n].BinsXML.toString();let e=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&55494==e.LinkData);e.length>0&&this.drSelObj.TableColumns.Contains(e[0].SysColumnName.toString())&&(this.drSelObj.Table[l][e[0].SysColumnName.toString()]=this.GridData[n].strBins.toString())}let h;5==this.Parent.ScreenObject.DocumentType&&this.GridDataColumns.Contains("TOBinsXML")&&(this.drSelObj.Table[l].TOBinsXML=this.GridData[n].TOBinsXML.toString()),this.drSelObj.Table[l].MRate=this.GridData[n].MRate.toString(),this.drSelObj.Table[l].RRate=this.GridData[n].RRate.toString(),this.drSelObj.Table[l].SRate=this.GridData[n].SRate.toString();for(let e=0;e<this.dtmap.length;e++)if(this.drSelObj.TableColumns.Contains(this.dtmap[e].BaseCol.toString())&&this.GridDataColumns.Contains(this.dtmap[e].BatchCol.toString())&&!a.e.IsEmpty(this.GridData[n][this.dtmap[e].BatchCol.toString()]))if(this.drSelObj.DataTypes.Double.Contains(this.dtmap[e].BaseCol.toString()))a.e.IsNum(this.GridData[n][this.dtmap[e].BatchCol.toString()])&&(this.drSelObj.Table[l][this.dtmap[e].BaseCol.toString()]=this.GridData[n][this.dtmap[e].BatchCol.toString()].toString());else if(this.drSelObj.TableColumns.Contains(this.dtmap[e].BaseCol.toString()+"_key")&&this.drSelObj.DataTypes.Date.Contains(this.dtmap[e].BaseCol.toString()+"_key")){if(a.e.isValidDate(this.GridData[n][this.dtmap[e].BatchCol.toString()])){let t=new Date(this.GridData[n][this.dtmap[e].BatchCol.toString()]);this.drSelObj.Table[l][this.dtmap[e].BaseCol.toString()+"_key"]=t,this.drSelObj.Table[l][this.dtmap[e]["B=aseCol"].toString()]=t.ToString(i.a.SessionManager.Preferences["Date Format"])}}else if(this.drSelObj.DataTypes.Date.Contains(this.dtmap[e].BaseCol.toString()))a.e.isValidDate(this.GridData[n][this.dtmap[e].BatchCol.toString()])&&(this.drSelObj.Table[l][this.dtmap[e].BaseCol.toString()]=this.GridData[n][this.dtmap[e].BatchCol.toString()].toString());else if(this.dtmap[e].BaseCol.toString().toLowerCase().Contains("dcccnid")&&this.dtmap[e].BatchCol.toString().toLowerCase().Contains("ccnid")&&!a.e.IsEmpty(this.GridData[n][this.dtmap[e].BatchCol.toString()+"_Key"])){this.drSelObj.Table[l][this.dtmap[e].BaseCol.toString()]=this.GridData[n][this.dtmap[e].BatchCol.toString()].toString(),this.drSelObj.Table[l][this.dtmap[e].BaseCol.toString()+"_Key"]=this.GridData[n][this.dtmap[e].BatchCol.toString()+"_Key"].toString();var s=this.Parent.ScreenObject.ColumnSource.find(t=>!a.e.IsEmpty(t.ValueMember)&&t.ValueMember.toLowerCase()==this.dtmap[e].BaseCol.toString().toLowerCase()+"_key");s&&(h=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&e.LocalReference==s.ID),h.length>0&&this.Parent.ScreenObject.GetLinkReferenceData(parseInt(s.ID),this.Parent.DocumentID,parseInt(this.drSelObj.Table[l][s.ValueMember]),Date.Today(),this.dtmap[e].BatchCol.toString(),s.CostCenterID,this.drSelObj.Table[l]))}else this.drSelObj.Table[l][this.dtmap[e].BaseCol.toString()]=this.GridData[n][this.dtmap[e].BatchCol.toString()].toString();h=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&-100==e.LinkData),h.length>0&&this.drSelObj.TableColumns.Contains(h[0].SysColumnName.toString())&&(this.drSelObj.Table[l][h[0].SysColumnName.toString()]=t),h=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&-101==e.LinkData),h.length>0&&this.drSelObj.TableColumns.Contains(h[0].SysColumnName.toString())&&(this.drSelObj.Table[l][h[0].SysColumnName.toString()]=r,this.drSelObj.TableColumns.Contains(h[0].SysColumnName.toString()+"_Key")&&this.drSelObj.DataTypes.Int.Contains(h[0].SysColumnName.toString()+"_Key")&&(this.dvCombo=this.dvComboTable.filter(e=>e.BatchID==this.GridData[n].BatchID),null!=this.dvCombo&&this.dvCombo.length>0&&!a.e.IsEmpty(this.dvCombo[0].MfgDate)&&(this.drSelObj.Table[l][h[0].SysColumnName.toString()+"_Key"]=this.dvCombo[0].MfgDate.toString()))),h=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&-102==e.LinkData),h.length>0&&this.drSelObj.TableColumns.Contains(h[0].SysColumnName.toString())&&(this.drSelObj.Table[l][h[0].SysColumnName.toString()]=o,this.drSelObj.TableColumns.Contains(h[0].SysColumnName.toString()+"_Key")&&this.drSelObj.DataTypes.Int.Contains(h[0].SysColumnName.toString()+"_Key")&&(this.dvCombo=this.dvComboTable.filter(e=>e.BatchID==this.GridData[n].BatchID),null!=this.dvCombo&&this.dvCombo.length>0&&!a.e.IsEmpty(this.dvCombo[0].ExpiryDate)&&(this.drSelObj.Table[l][h[0].SysColumnName.toString()+"_Key"]=this.dvCombo[0].ExpiryDate.toString()))),h=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&53737==e.LinkData),h.length>0&&this.drSelObj.TableColumns.Contains(h[0].SysColumnName.toString())&&(this.drSelObj.Table[l][h[0].SysColumnName.toString()]=this.GridData[n].MRate.toString()),h=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&53738==e.LinkData),h.length>0&&this.drSelObj.TableColumns.Contains(h[0].SysColumnName.toString())&&(this.drSelObj.Table[l][h[0].SysColumnName.toString()]=this.GridData[n].RRate.toString()),h=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&53739==e.LinkData),h.length>0&&this.drSelObj.TableColumns.Contains(h[0].SysColumnName.toString())&&(this.drSelObj.Table[l][h[0].SysColumnName.toString()]=this.GridData[n].SRate.toString()),this.Parent.CalculateTotals(this.drSelObj.Table[l],!1,"Quantity"),this.drSelObj.updateRow(this.drSelObj.Table[l])}}d&&(c+="</xml>",this.drSel.ExtraXML=c.toString()),"AutoSave"!=e.toString()&&i.a.page.HideDialog()}else"Cancel"==e.toString()&&("AddEditDocumentViewModel"!=this.Parent.ClassName&&"POSDocumentViewModel"!=this.Parent.ClassName||(this.Parent.DialogResult=!1),i.a.page.HideDialog())}GetCustomFieldsQuery(){let e,t,s="";for(let i=0;i<=this.StaticFields.length;i++){let n=this.StaticFields[i];n instanceof h.c&&null!=n.DBColumnName&&n.DBColumnName.toLowerCase().Contains("alpha")&&(n instanceof o.d?(e=n.Text,a.e.IsEmpty(e)&&(e="",t=null),s+=n.DBColumnName+"=N'"+e.replace("'","''")+"',"):n instanceof o.c?(e=n.Text,a.e.IsEmpty(e)&&(e="",t=null),s+=n.DBColumnName+"=N'"+e.replace("&","&am;").replace("'","''")+"',"):n instanceof S.e?(e=n.SelectedValue,a.e.IsEmpty(e)&&(e=""),s+=n.DBColumnName+"='"+e.replace("&","&am;").replace("'","''")+"',"):n instanceof u.c?(e=n.Date?n.Date.ToString("dd/MMM/yyyy"):"",a.e.IsEmpty(e)&&(e=""),s+=n.DBColumnName+"='"+e+"',"):n instanceof u.a?(e=n.Date.ToString("dd/MMM/yyyy"),a.e.IsEmpty(e)&&(e=""),s+=n.DBColumnName+"='"+e+"',"):n instanceof C.a?(e=n.Text,a.e.IsEmpty(e)&&(e=""),s+=n.DBColumnName+"='"+e+"',"):n instanceof d.b&&(s+=n.DBColumnName+"='"+n.SelectedValue+"',"))}return s.toString()}GetCustomCostCenterFieldsQuery(){let e="",t=[];for(let s=0;s<this.StaticFields.length;s++){let i=this.StaticFields[s];if(i instanceof d.b&&(null!=i.DBColumnName&&i.DBColumnName.toLowerCase().Contains("ccnid")||null!=i.DBColumnName&&("accountid"==i.DBColumnName.toLowerCase()||"productid"==i.DBColumnName.toLowerCase()))){let s=i;0!=s.SelectedValue&&(e+=s.DBColumnName+"='"+s.SelectedValue+"',",t.push(s.CCID))}}if("AddEditDocumentViewModel"==this.Parent.ClassName||"POSDocumentViewModel"==this.Parent.ClassName){let s=0,n=!1;if(i.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise Batches")&&""!=i.a.SessionManager.Preferences["Maintain Dimensionwise Batches"].toString()&&(s=a.e.Int(i.a.SessionManager.Preferences["Maintain Dimensionwise Batches"]),s>0&&!t.Contains(s))){for(let i=0;i<this.Parent.ScreenObject._CCFields.length;i++){let a=this.Parent.ScreenObject._CCFields[i];if(a instanceof d.b&&a.CCID==s){e+="CCNID"+(s-5e4)+"='"+a.SelectedValue+"',",t.push(s),n=!0;break}}n||null!=this.drSel&&s>5e4&&this.drSelObj.TableColumns.Contains("dcCCNID"+(s-5e4).toString()+"_Key")&&!a.e.IsEmpty(this.drSel["dcCCNID"+(s-5e4).toString()+"_Key"])&&(e+="CCNID"+(s-5e4)+"='"+this.drSel["dcCCNID"+(s-5e4).toString()+"_Key"].toString()+"',",t.push(s))}if(this.Parent.ScreenObject.Preferences.ContainsKey("BatchFilterDim")&&(s=a.e.Int(this.Parent.ScreenObject.Preferences.BatchFilterDim),n=!1,s>0&&!t.Contains(s)&&!e.toString().Contains("CCNID"+(s-5e4)+"="))){for(let i=0;i<this.Parent.ScreenObject._CCFields.length;i++){let a=this.Parent.ScreenObject._CCFields[i];if(a instanceof d.b&&a.CCID==s){a.SelectedValue>0&&(e+="CCNID"+(s-5e4)+"='"+a.SelectedValue+"',",t.push(s)),n=!0;break}}n||null!=this.drSel&&s>5e4&&this.drSelObj.TableColumns.Contains("dcCCNID"+(s-5e4).toString()+"_Key")&&!a.e.IsEmpty(this.drSel["dcCCNID"+(s-5e4).toString()+"_Key"])&&(e+="CCNID"+(s-5e4)+"='"+this.drSel["dcCCNID"+(s-5e4).toString()+"_Key"].toString()+"',",t.push(s))}!e.toString().Contains("CCNID2=")&&!t.Contains(50002)&&this.Loc>0&&(e+="CCNID2='"+this.Loc+"',"),!e.toString().Contains("CCNID1=")&&!t.Contains(50001)&&this.Div>0&&(e+="CCNID1='"+this.Div+"',")}return e.toString()}FillBatchtoDt(e){let t=this.batches.filter(t=>t.ProductID==e);if(t.length>0){let e=0,s="";s+="<xml>";for(let t=0;t<this.GridData.length;t++)!a.e.IsEmpty(this.GridData[t].BatchID)&&a.e.Double(this.GridData[t].Quantity)>0&&(e++,s+="<Row ",s+=' BatchID="'+this.GridData[t].BatchID.toString()+'" ',s+=' Quantity="'+this.GridData[t].Quantity.toString()+'" ',this.ConsolidatedBatches||(s+=' RefInvID="'+this.GridData[t].RefInvID.toString()+'" '),s+=' Hold="0" ',s+=' Release="0" ',s+=" ></Row>");s+="</xml>",e>0&&(t[0].Batch=s.toString())}}SaveWO(){if(null!=this.SelectedProd&&""!=this.SelectedProd&&this.FillBatchtoDt(parseInt(this.SelectedProd)),this.CheckAll()){this.Parent.dtbatches=this.batches,this.Parent.DialogResult=!0;let e,t="",s=0,n=0;for(let i=0;i<this.Parent.MaterialGridData.length;i++){let e=0,r=0;if(!a.e.IsEmpty(this.Parent.MaterialGridData[i].ProductName_Key)&&a.e.Double(this.Parent.MaterialGridData[i].QTY)>0){s=0,n=0;let l=this.batches.filter(e=>e.ProductID==this.Parent.MaterialGridData[i].ProductName_Key),h=new a.f,c=null;l.length>0&&!a.e.IsEmpty(l[0].Batch)&&(h.LoadXml(l[0].Batch),c=h.SelectNodes("xml/Row"),s=c.length);do{if(n++,r=null!=c&&c.length>n-1?parseFloat(c[n-1].attributes.Quantity.value):parseFloat(this.Parent.MaterialGridData[i].QTY),r>0){let s=0;a.e.IsNum(this.Parent.MaterialGridData[i].Wastage)&&(s=r*parseFloat(this.Parent.MaterialGridData[i].Wastage)/100),this.Parent.Parent.deductWaisatge?r-=s:this.Parent.Parent.AddWaistage&&(r+=s),t+="\x11",t+="<Row><Transactions ",t+=' DocDetailsID="0" ',t+=' ProductID="'+this.Parent.MaterialGridData[i].ProductName_Key+'" ',t+=' Quantity="'+r+'" ',a.e.Double(this.Parent.MaterialGridData[i].UnitPrice),t+=' Rate="'+this.Parent.MaterialGridData[i].UnitPrice+'" ',t+=' Unit="'+this.Parent.MaterialGridData[i].UOMID+'" ',a.e.IsEmpty(this.Parent.MaterialGridData[i].UnitPrice)?(t+=' Gross="0" ',t+=' StockValue="0" '):(e=parseFloat(this.Parent.MaterialGridData[i].UnitPrice)*r,t+=' Gross="'+e+'" ',t+=' StockValue="'+e+'" '),t+='AverageRate="'+this.Parent.MaterialGridData[i].AvgRate.toString()+'" ',t+=' IsQtyIgnored="0" ';let n=this.Parent.Parent.objMO.GetLinkReferenceData(this.Parent.Parent.IssProdCOlID,this.Parent.Parent.IssCCID,parseInt(this.Parent.MaterialGridData[i].ProductName_Key),this.Parent.ActionDate.Date,this.Parent.Parent.IssDr),l=" ",h=" ";for(let e=0;e<n.Tables[0].Columns.length;e++)n.Tables[0].Columns[e].toLowerCase().Contains("dcalpha")&&(l+=n.Tables[0].Columns[e]+"=N'"+o.d.GetValidTextXml(n.Tables[0][0][n.Tables[0].Columns[e]].toString())+"', "),n.Tables[0].Columns[e].toUpperCase().Contains("CCNID")&&!a.e.IsEmpty(n.Tables[0][0][n.Tables[0].Columns[e]])&&a.e.IsDigit(n.Tables[0].Columns[e].ToCharArray().Last())&&(h+=n.Tables[0].Columns[e]+"="+n.Tables[0][0][n.Tables[0].Columns[e]].toString()+", ");if(this.Parent.Location.SelectedValue>0&&!h.Contains("dcCCNID2=")&&(h+=" dcCCNID2="+this.Parent.Location.toString()+", "),this.Parent.Parent.ScreenObject.CustomTab.Pages.forEach(e=>{e.Fields.forEach(e=>{e instanceof d.b&&null!=e.DBColumnName&&0!=e.SelectedValue&&e.DBColumnName.toLowerCase().Contains("ccnid")&&!h.toLowerCase().Contains("dc"+e.DBColumnName.toLowerCase()+"=")&&(h+="dc"+e.DBColumnName+" ="+e.SelectedValue.toString()+", ")})}),t+=' DocSeqNo="'+(i*this.count).toString()+'" ',t+="/> <Numeric /> <Alpha "+l+' /> <CostCenters Query="'+h+'" />',null!=c&&c.length>this.count-1&&(t+="<EXTRAXML><xml>"+c[this.count-1].OuterXml+"</xml></EXTRAXML>"),null!=this.Parent.Parent.IssProdCol){let s=this.Parent.GetAccountsXML(parseInt(this.Parent.MaterialGridData[i].ProductName_Key),e.toString(),this.Parent.Parent.IssProdCol,this.Parent.Parent.IssDr,this.Parent.Parent.IssCr);""!=s&&(t+="<AccountsXML>"+s+"</AccountsXML>")}t+=" </Row>"}}while(n<s)}}e=this.Parent.IssueWo(t.toString(),this.BillNO),e>0&&(this.Parent.SetWos(e),this.Parent.this.Parent.OnSave("NoValidation"),this.Parent.LoadBomDetails(this.Parent.Parent.SelectedWO),i.a.page.HideDialog())}}CheckAll(){for(let e=0;e<this.batches.length;e++){if(a.e.IsEmpty(this.batches[e].Batch))return this.DisplayMessage="Batches not defined for "+this.batches[e].ProductName.toString(),!1;{let t=new a.f;t.LoadXml(this.batches[e].Batch);let s=t.SelectNodes("xml/Row"),n=0,r=0;for(let e=0;e<s.length;e++)r=a.e.Double(s[e].attributes.Quantity.value),n+=r;if(r=a.e.Double(this.batches[e].QTY),i.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=i.a.SessionManager.Preferences.DecimalsinQty){let t=r.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty);if(r=parseFloat(t),t=n.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty),n=parseFloat(t),r!=n)return this.DisplayMessage="Qty not equal for "+this.batches[e].ProductName.toString(),!1}else if(r!=n)return this.DisplayMessage="Qty not equal for "+this.batches[e].ProductName.toString(),!1}}return!0}ProdSelected(){let e=null!=this.SelectedProd?this.batches.filter(e=>e.ProductID==this.SelectedProd):[];if(e.length>0){if(this.GridData.Clear(),this.BatchQty=parseFloat(e[0].QTY),i.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=i.a.SessionManager.Preferences.DecimalsinQty){let e=this.BatchQty.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty);this.BatchQty=parseFloat(e)}this.ProdName=e[0].ProductName.toString(),this.ProductID=parseInt(this.SelectedProd);let t=0;"AddEditDocumentViewModel"!=this.Parent.ClassName&&"POSDocumentViewModel"!=this.Parent.ClassName||(t=this.Parent.CostCenterID);let s,n=(new p).GetProductwiseBatches(this.ProductID,this.DocDetailsId,this.DocId,this.VoucherType,this.docdate,this.Div,this.Loc,t,-1,-1);if(n.Tables.length>1&&null!=this.ColumnSource&&this.ColumnSource.length>1&&(this.ColumnSource[1].ComboData=n.Tables[0],this.dvCombo=n.Tables[0],this.dvComboTable=n.Tables[0],this.dvComboColumns=n.Columns[0]),this.RefreshGrid=!this.RefreshGrid,n.Tables.length>0&&!n.Columns[0].Contains("ErrorMessage")&&null!=this.ColumnSource&&this.ColumnSource.length>1)for(let e=0;e<n.Tables[0].length;e++){let t=this.GridDataObj.NewRow();t.Sno=e+1,this.ConsolidatedBatches||(t.RefInvID=n.Tables[0][e].InvDocDetailsID.toString()),t.BatchID=n.Tables[0][e].BatchID.toString(),a.e.isValidDate(n.Tables[0][e].MfgDate)&&(t.MfgDate=new Date(n.Tables[0][e].MfgDate).ToString(i.a.SessionManager.Preferences["Date Format"])),a.e.isValidDate(n.Tables[0][e].ExpiryDate)&&(t.ExpDate=new Date(n.Tables[0][e].ExpiryDate).ToString(i.a.SessionManager.Preferences["Date Format"])),a.e.Double(n.Tables[0][e].BalQty)&&(t.BalQty=n.Tables[0][e].BalQty.toString()),a.e.Double(n.Tables[0][e].MRate)&&(t.MRate=n.Tables[0][e].MRate.toString()),a.e.Double(n.Tables[0][e].RRate)&&(t.RRate=n.Tables[0][e].RRate.toString()),a.e.Double(n.Tables[0][e].SRate)&&(t.SRate=n.Tables[0][e].SRate.toString()),this.GridDataObj.addRow(t)}if(this.InvQty=0,!a.e.IsEmpty(e[0].Batch)){let t=new a.f;t.LoadXml(e[0].Batch);let i=t.SelectNodes("xml/Row");for(let e=0;e<i.length;e++){let t=this.GridData.filter(t=>t.BatchID==i[e].attributes.BatchID.value);if(this.ConsolidatedBatches||""==i[e].attributes.RefInvID.value||(t=this.GridData.filter(t=>t.RefInvID==i[e].attributes.RefInvID.value)),t.length>0){s=0;let n=a.e.Double(i[e].attributes.Quantity.value);t[0].Quantity=n,this.GridDataColumns.Contains("QtyUom")&&(t[0].QtyUom=a.e.IsEmpty(t[0].Quantity)?0:parseFloat(t[0].Quantity)/this.UomConversion),this.InvQty+=n}}}this.QtyAddMessage=a.e.Format(i.a.GetResource("BatchNo_AddMessage"),this.InvQty.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty),this.BatchQty.toString(),this.ProdName.toString()),this.FillEmptyRows()}else this.QtyAddMessage=""}AdjusFifo(e){let t=this.BatchQty;if(e){let e;for(let s=0;s<this.GridData.length;s++)if(!a.e.IsEmpty(this.GridData[s].BatchID)){let n=a.e.Double(this.GridData[s].BalQty),r=n.toString();this.GridDataColumns.Contains("QOH")&&null!=this.GridData[s].QOH&&parseFloat(this.GridData[s].QOH.toString())&&n>e&&(n=e),i.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=i.a.SessionManager.Preferences.DecimalsinQty&&(r=n.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty)),n=parseFloat(r),t>=n?(this.GridData[s].Quantity=n,this.GridDataColumns.Contains("BinsXML")&&this.Parent.ScreenObject.Preferences.ContainsKey("AutoSelectBins")&&"true"==this.Parent.ScreenObject.Preferences.AutoSelectBins.toLowerCase()&&(this.Setselectedrow(s),this.onBinCLick("Auto")),t-=n):(this.GridData[s].Quantity=t,this.GridDataColumns.Contains("BinsXML")&&this.Parent.ScreenObject.Preferences.ContainsKey("AutoSelectBins")&&"true"==this.Parent.ScreenObject.Preferences.AutoSelectBins.toLowerCase()&&(this.Setselectedrow(s),this.onBinCLick("Auto")),t=0),this.GridDataColumns.Contains("QtyUom")&&(this.GridData[s].QtyUom=a.e.IsEmpty(this.GridData[s].Quantity)?0:parseFloat(this.GridData[s].Quantity)/this.UomConversion)}}else for(let s=0;s<this.GridData.length;s++)a.e.IsEmpty(this.GridData[s].BatchID)||(this.GridData[s].Quantity=0),this.GridDataColumns.Contains("QtyUom")&&(this.GridData[s].QtyUom=0);this.GridDataObj.gridObj&&this.GridDataObj.gridObj.invalidate(),t=this.BatchQty-t,this.QtyAddMessage=a.e.Format(i.a.GetResource("BatchNo_AddMessage"),t.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty),this.BatchQty.ToString("N"+i.a.SessionManager.Preferences.DecimalsinQty),this.ProdName.toString())}Setselectedrow(e){this.GridDataObj.SelectedItem=this.GridData[e]}AdjusFifoAll(){if(null==this.batches)return;let e=this.SelectedProd;for(let t=0;t<this.batches.length;t++)this.SelectedProd=this.batches[t].ProductID.toString(),this.AdjusFifo(this.ChkFifoAll);this.SelectedProd=e}ResetBatchNo(e){if(null!=this.StaticFields)for(let s=0;s<this.StaticFields.length;s++){let e=this.StaticFields[s];e instanceof h.c&&(e instanceof o.d?e.Text=""!=e.DefaultValue?e.DefaultValue:"":e instanceof S.e?e.SelectedValue="":e instanceof o.c?e.Text="":e instanceof u.b?e.Date=null:e instanceof u.c?("SYSDATE"==e.DefaultValue&&a.e.isValidDate(this.Parent.fldDict.ServerDate.fieldResult)?e.Date=new Date(this.Parent.fldDict.ServerDate.fieldResult):"TODAY"==e.DefaultValue?e.Date=Date.Today():"DOCDATE"!=e.DefaultValue||"AddEditDocumentViewModel"!=this.Parent.ClassName&&"POSDocumentViewModel"!=this.Parent.ClassName?"ExpiryDate"==e.DBColumnName&&this.ShelfLife>0||(e.Date=null):e.Date=this.Parent.DocumentDate,"MfgDate"==e.DBColumnName&&this.OnDateChanged(e)):e instanceof u.a?(e.Date="SYSDATE"==e.DefaultValue&&a.e.isValidDate(this.Parent.fldDict.ServerDate.fieldResult)?new Date(this.Parent.fldDict.ServerDate.fieldResult):"DOCDATE"!=e.DefaultValue||"AddEditDocumentViewModel"!=this.Parent.ClassName&&"POSDocumentViewModel"!=this.Parent.ClassName?Date.Today():this.Parent.DocumentDate,"MfgDate"==e.DBColumnName&&this.OnDateChanged(e)):e instanceof C.a?e.Text="":e instanceof d.b?e.SelectedValue=!a.e.IsEmpty(e.DefaultValue)&&a.e.IsNum(e.DefaultValue)?parseInt(e.DefaultValue):0:e instanceof o.a&&(e.Text="",e.SuffixCode="",e.PrefixCode="",null!=this.ControlGen&&this.ControlGen.IsAutoCode&&null!=this.BatchCode&&(this.objBatch.BatchGroup=1,this.ControlGen.SetAutoCode(this.BatchCode,this.objBatch.IsGroup,this.objBatch.BatchGroup,this.dsBatch.Tables[6]))))}if(this.BatchNo.Text="",null!=this.txtqty){0==e&&this.NextSeq++;let t=this.NextSeq.toString();for(;t.length<this.Seqlen;)t="0"+t;if(this.BatchNo.Text=this.BNO.replace("#SEQ#",t),this.Parent.ScreenObject.Preferences.ContainsKey("AutoPopulateBatchQty")&&"true"==this.Parent.ScreenObject.Preferences.AutoPopulateBatchQty.toLowerCase()){let e=0,t=this.GridData.Compute("sum","Quantity");null!=t&&(e=a.e.Double(t)),e=this.BatchQty-e,this.txtqty.Text=e.toString()}else this.txtqty.Text=""}if(this.IsBatchSeqNoExists=!1,this.AutoGenerateBatches){let e,s,i,n="";if(null!=this.xBatchDef){let r=null,l=null;"AddEditDocumentViewModel"!=this.Parent.ClassName&&"POSDocumentViewModel"!=this.Parent.ClassName&&"POSDocumentViewModel"!=this.Parent.ClassName||(l=this.Parent,null!=l.SelectedRow&&(r=l.SelectedRow));for(let h=0;h<this.xBatchDef.DocumentElement.children.length;h++){let c=this.xBatchDef.DocumentElement.children[h];if(e=c.attributes.Name.value.toUpperCase(),"SEQUENCE_NO"==e)if(this.IsBatchSeqNoExists=!0,s=(new p).GetNextBatchSeqNo(),i=a.e.Int(c.attributes.ColumnWidth.value),i>0){for(let e=i-s.toString().length;e>0;e--)n+="0";n+=s}else n+=s.toString();else if("CUSTOM_TEXT"==e)n+=c.attributes.ColumnWidth.value;else if("DOCDATE"==e)n+=y.GetDateString(this.docdate,c.attributes.ColumnWidth.value);else if(null!=r&&l.ScreenObject.GridDataObj.TableColumns.Contains(e)){let t=r[e].toString();i=a.e.Int(c.attributes.ColumnWidth.value),n+=i>0&&i<t.length?t.substr(0,i):t}else if(null!=l){var t=l.ScreenObject._TextFields.find(t=>t.DBColumnName.toLowerCase()==e.toLowerCase());if(t||(t=l.ScreenObject._StaticFields.find(t=>t.DBColumnName.toLowerCase()==e.toLowerCase())),t)if("DATE"==c.attributes.Type.value.toUpperCase()){if(t instanceof u.c){let e=t.Date;null!=e&&(n+=y.GetDateString(e,c.attributes.ColumnWidth.value))}}else{i=a.e.Int(c.attributes.ColumnWidth.value);let e="";t instanceof o.d&&(e=t.Text),null!=e&&(n+=i>0&&i<e.length?e.substr(0,i):e)}}n+=c.attributes.Delimiter.value}}0==n.length&&(this.IsBatchSeqNoExists=!0,n=(new p).GetNextBatchSeqNo().toString()),this.BatchNo.Text=n}}static GetDateString(e,t){return"Y"==t?e.getFullYear().toString().substr(3):"YY"==t?e.getFullYear().toString().substr(2):"YYYY"==t?e.getFullYear().toString():"Name"==t?e.ToString("MMMM"):"MMM"==t?e.ToString("MMM"):"MM"==t?e.getMonth().PrefixZero(2):"DD"==t?e.getDate().PrefixZero(2):""}}class p{GetBatchDefn(e){return i.a.common.GetDataSet("INV001",e.toString()).Tables[0]}GetNextBatchSeqNo(){return i.a.common.GetDataSet("INV002","").Tables[0][0].SeqNo}GetProductwiseBatches(e,t,s,a,r,o,l,h,c,d){let u=[];return u.push(e),u.push(t),u.push(s),u.push(a),u.push(r.ToString("dd/MMM/yyyy")),i.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&Object(n.j)(i.a.SessionManager.Preferences.EnableDivisionWise)&&i.a.SessionManager.Preferences.ContainsKey("DW Batches")&&Object(n.j)(i.a.SessionManager.Preferences["DW Batches"])?u.push(o):u.push(0),i.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&Object(n.j)(i.a.SessionManager.Preferences.EnableLocationWise)&&i.a.SessionManager.Preferences.ContainsKey("LW Batches")&&Object(n.j)(i.a.SessionManager.Preferences["LW Batches"])?u.push(l):u.push(0),u.push(h),u.push(c),u.push(d),u.push(i.a.SessionManager.UserID),u.push(i.a.SessionManager.RoleID),u.push(i.a.SessionManager.LangID),i.a.document.GetTempBatches(u)}static QuickAddBatch(e,t,s){let n=[];return n.push(e.BatchID),n.push(s),n.AddRange(t),n.push(e.IsGroup),n.push(e.StaticFieldsQuery),n.push(e.CustomFieldsQuery),n.push(e.CustomCostCenterFieldsQuery),n.push(a.e.String(e.BatchCode)),n.push(a.e.String(e.CodePrefix)),n.push(e.CodeNumber),n.push(i.a.SessionManager.CompanyGUID),null==e.GUID&&(e.GUID=""),n.push(e.GUID),n.push(i.a.SessionManager.UserName),n.push(i.a.SessionManager.UserID),n.push(i.a.SessionManager.RoleID),n.push(i.a.SessionManager.LanguageID),i.a.inventory.SetQuickBatch(n)}static QuickAddBatchMultple(e,t,s){let n=[];return n.push(e.BatchID),n.push(s),n.AddRange(t),n.push(e.IsGroup),n.push(e.StaticFieldsQuery),n.push(e.CustomFieldsQuery),n.push(e.CustomCostCenterFieldsQuery),n.push(a.e.String(e.BatchCode)),n.push(a.e.String(e.CodePrefix)),n.push(e.CodeNumber),n.push(i.a.SessionManager.CompanyGUID),null==e.GUID&&(e.GUID=""),n.push(e.GUID),n.push(i.a.SessionManager.UserName),n.push(i.a.SessionManager.UserID),n.push(i.a.SessionManager.RoleID),n.push(i.a.SessionManager.LanguageID),i.a.inventory.SetQuickBatchMumtiple(n)}}},Z9XZ:function(e,t,s){"use strict";s.r(t),s.d(t,"ShowJVViewModel",(function(){return S}));var i=s("Do2H"),a=s("Lp6j"),n=s("eQJW"),r=s("ScVY"),o=s("EQd/"),l=s("8B8H"),h=s("ockk"),c=s("0/4Q"),d=s("n56n"),u=s("Huqd"),D=s("HNy5"),m=s("7eIC"),b=s("R1nY");class S extends r.b{constructor(){super(),this.AddVisible=!1,this.IsPopup=!0,this.MapVisible=!1,this.okVisible=!1,this.Amount=new o.d(0),this.AccountName=new o.d(0),this.JVGrid=new l.a,this.colname="",this.decimalpoints="2",this.StrCC="",this.AccountID=0,this.parent=null,this.Type=0,this.currencyid=1,this.TotAmt=0,this.exchrate=1,this.Mdeci=2,this.Name=new o.d(0),this.Profile=new c.e(0),this.Amount.Visible=!1,this.AccountName.Visible=!1}get Refresh(){return!0}ShowJVViewModel_1(e,t,s=0){this.parent=e,this.Type=s,"pdcGenerateChequeViewModel"==this.parent.ClassName&&(this.Title="Distribute"),this.JVGrid.Columns=[],this.JVGrid.Table=[],this.JVGrid.Height=200,this.JVGrid.Width="500",4==s?this.InitQtyAdjGrid():"pdcGenerateChequeViewModel"==this.parent.ClassName?this.FillGenerateCheques():this.FillGridCols(t,e)}PrefGrid(){this.JVGrid.Height=200,this.JVGrid.Width="800",this.okVisible=!0,this.JVGrid.TableColumns.push("Sno"),this.JVGrid.TableColumns.push("CostCenterId"),this.JVGrid.TableColumns.push("NodeName"),this.JVGrid.TableColumns.push("NodeID"),this.JVGrid.TableColumns.push("Imagefilepath"),this.JVGrid.TableColumns.push("ImageFile"),this.JVGrid.TableColumns.push("ActualFileName"),this.JVGrid.TableColumns.push("FilePath"),this.JVGrid.TableColumns.push("IsModified"),this.JVGrid.TableColumns.push("FileExtension"),this.JVGrid.TableColumns.push("DisplayText"),this.JVGrid.TableColumns.push("GUID"),this.JVGrid.TableColumns.push("RemImg"),this.JVGrid.CanUserDeleteRows=!0,this.JVGrid.CanUserAddRows=!0,this.JVGrid.OnLinkClick.Subscribe(this,"OnGridLinkClick"),this.JVGrid.BeginEdit.Subscribe(this,"BeginningEditEvent");let e=new h.a;e.Header="Sno",e.Width=50,e.DisplayMember="Sno",e.ReadOnly=!0,this.JVGrid.Columns.push(e),e=new h.a,e.Header="Dimension",e.ValueBinding="CostCenterId",e.DataType="ComboBox",e.DisplayMember="Name",e.ValueMember="Value",e.Width=100,e.ComboData=[],this.JVGrid.Columns.push(e),e=new h.a,e.Header="Data",e.DataType="LISTBOX",e.DisplayMember="NodeName",e.ValueMember="NodeID",e.TypeID=1,e.Width=150,this.JVGrid.Columns.push(e),e=new h.a,e.Header="Text",e.Width=100,e.DisplayMember="DisplayText",this.JVGrid.Columns.push(e),e=new h.a,e.Header=i.a.GetResource("Image"),e.DisplayMember="Imagefilepath",e.DataType="IMAGE_BUTTON",e.Width=60,e.ReadOnly=!0,this.JVGrid.Columns.push(e),e=new h.a,e.Header=i.a.GetResource("Com_Attachments_FileName"),e.DisplayMember="ActualFileName",e.DataType="LINK",e.Width=130,e.ReadOnly=!0,this.JVGrid.Columns.push(e),e=new h.a,e.Header=i.a.GetResource("Select_Image"),e.DisplayMember="ImageFile",e.DataType="LINK",e.Width=100,e.ReadOnly=!0,this.JVGrid.Columns.push(e),e=new h.a,e.Header="Remove",e.DisplayMember="RemImg",e.DataType="LINK",e.Width=100,e.ReadOnly=!0,this.JVGrid.Columns.push(e)}BeginningEditEvent(e){}OnGridLinkClick(e,t,s){}onClick(e){}OpenImage(e){}FillGenerateCheques(){this.JVGrid.OnCellEditEnding.Subscribe(this,"OnGridCellEditEnding"),this.okVisible=!0;let e=new h.a;e.Width=150,e.DisplayMember="Date",e.Header="Date",e.ReadOnly=!0,this.JVGrid.Columns.push(e),e=new h.a,e.Width=200,e.DataType="FLOAT",e.DisplayMember="Amount",e.Header="Amount",this.JVGrid.Columns.push(e),this.JVGrid.TableColumns.push("Amount"),this.JVGrid.TableColumns.push("Date_Key"),this.JVGrid.TableColumns.push("Date"),e=this.parent.parent.ScreenObject.ColumnSource.find(e=>"amount"==e.DisplayMember.toLowerCase()),e&&""!=e.DecimalPoints&&(this.Mdeci=parseInt(e.DecimalPoints));var t=this.parent.GrBody.SelectedItem;let s=this.parent.CheqStartDate.Date,n=new a.f;""!=t.Detailsxml.toString()&&n.ReadXml(t.Detailsxml);let r=0;null!=this.parent.Repeat.SelectedValue&&""!=this.parent.Repeat.SelectedValue&&parseInt(this.parent.Repeat.SelectedValue)>0&&parseInt(this.parent.Repeat.SelectedValue);let o=0,l=0,c=parseFloat(this.parent.Amount.Text)/(this.parent.CheqEndDate.Date.Subtract(this.parent.CheqStartDate.Date).Days+1);"1"==this.parent.Repeat.SelectedValue&&(l=this.parent.CalculateMonths()>0?a.e.Round(parseFloat(this.parent.Amount.Text)/this.parent.CalculateMonths(),this.Mdeci):parseFloat(this.parent.Amount.Text));let d=0,u=0;for(;s<=this.parent.CheqEndDate.Date;){r=0==d?s.getMonth()==this.parent.CheqEndDate.Date.Month&&s.getFullYear()==this.parent.CheqEndDate.Date.Year?parseFloat(this.Amount.Text):1==s.getDate()?"1"==this.parent.Repeat.SelectedValue?l:a.e.Round(c*s.DaysInMonth(),this.Mdeci):a.e.Round(c*(s.DaysInMonth()-s.getDate()+1),this.Mdeci):s.AddMonths(1)>this.parent.CheqEndDate.Date?parseFloat(this.parent.Amount.Text)-o:"1"==this.parent.Repeat.SelectedValue?l:a.e.Round(c*s.DaysInMonth(),this.Mdeci),o+=r;let e=this.JVGrid.NewRow();e.Date=s.ToString(i.a.SessionManager.Preferences["Date Format"]),e.Date_Key=s,e.Amount=n.Tables.length>0&&n.Columns[0].Contains("Amount")&&n.Tables[0].length>d?n.Tables[0][d].Amount.toString():a.e.Round(r*parseFloat(t.Percentage.toString())/100,this.Mdeci),s=0==d?s.AddDays(s.DaysInMonth()-s.getDate()+1):s.AddMonths(1),this.JVGrid.Table.push(e),""!=e.Amount.toString()&&(u+=parseFloat(e.Amount.toString())),d++}this.JVGrid.Columns[1].footer=u.ToString("N"+this.Mdeci),this.JVGrid.UpdateFooter()}FillGridCols(e,t){}ShowJVViewModel_2(e,t,s){this.okVisible=!0,e.ScreenObject.Preferences.ContainsKey("DecimalsBillWise")&&""!=e.ScreenObject.Preferences.DecimalsBillWise&&a.e.IntTryParse(e.ScreenObject.Preferences.DecimalsBillWise)>0?this.decimalpoints=e.ScreenObject.Preferences.DecimalsBillWise:i.a.SessionManager.Preferences.ContainsKey("DecimalsinAmount")&&(this.decimalpoints=i.a.SessionManager.Preferences.DecimalsinAmount),this.parent=e,this.Type=s,this.colname=t,7==this.Type?this.InitDistGrid(e):1==this.Type||2==this.Type?this.InitArAPGrid(e):this.InitPostingGrid(e),5==s&&this.FillProfiles()}ShowJVViewModel_4(){this.IsPopup=!1,this.okVisible=!0,this.MapVisible=!0,i.a.SessionManager.Preferences.ContainsKey("DecimalsinAmount")&&(this.decimalpoints=i.a.SessionManager.Preferences.DecimalsinAmount),this.InitPostingGrid(null),this.FillProfiles(),this.JVGrid.SearchVisible=!0,this.JVGrid.AddSearchCols(),this.DisplayName=this.Title}ShowJVViewModel_5(e){this.Type=e,this.IsPopup=!1,this.okVisible=!0,this.Profile.Visible=!1,this.Name.Visible=!1,i.a.SessionManager.Preferences.ContainsKey("DecimalsinAmount")&&(this.decimalpoints=i.a.SessionManager.Preferences.DecimalsinAmount),this.InitMapGrid(),this.JVGrid.SearchVisible=!0,this.JVGrid.AddSearchCols(),this.DisplayName=this.Title}FillProfiles(){this.Profile.Visible=!0,this.Name.Visible=5!=this.Type,this.Profile.Items.Clear();let e=i.a.admin.GetAndDeleteDistCosts(0,1);5!=this.Type&&this.Profile.Items.push(c.d.ComboBoxItems_2("New","-1")),null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&e.Tables[0].forEach(e=>{0==this.Profile.Items.filter(t=>t.Value==e.ProfileID.toString()).length&&this.Profile.Items.push(c.d.ComboBoxItems_2(e.ProfileName.toString(),e.ProfileID.toString()))})}InitQtyAdjGrid(){this.JVGrid.CanUserAddRows=!1,this.JVGrid.CanUserDeleteRows=!1,this.JVGrid.CanUserResizeColumns=!0}InitMapGrid(){let e;this.Title="Map Distribute Cost",this.JVGrid.Columns=[],this.JVGrid.Table=[],this.JVGrid.Height=150,this.JVGrid.CanUserAddRows=!0,this.JVGrid.OnCellEditEnding.Subscribe(this,"OnGridCellEditEnding");let t=i.a.admin.GetfeatureNames(i.a.SessionManager.Preferences.CostBasedONDims);if(i.a.SessionManager.Preferences.CostBasedONDims.split(","),null!=t&&t.Tables.length>0&&t.Columns[0].Contains("Name")&&t.Tables[0].length>0)for(let i=0;i<t.Tables[0].length;i++){e=new h.a;let s=parseInt(t.Tables[0][i].FeatureID);e.Header=t.Tables[0][i].Name.toString(),e.Width=150,e.DataType="LISTBOX",e.CostCenterID=s,e.TypeID=1,s>5e4?(s-=5e4,e.DisplayMember="DCCCNID"+s):2==s?e.DisplayMember="AccountID":502==s&&(e.DisplayMember="AccountTypeID"),e.ValueMember=e.DisplayMember+"_Key",this.JVGrid.Columns.push(e),this.JVGrid.TableColumns.push(e.DisplayMember),this.JVGrid.TableColumns.push(e.ValueMember)}e=new h.a,e.Header="Profile",e.ValueBinding="ProfileID",e.DataType="ComboBox",e.DisplayMember="Name",e.ValueMember="Value",e.Width=100;let s=[],n=i.a.admin.GetAndDeleteDistCosts(0,1);null!=n&&n.Tables.length>0&&n.Tables[0].length>0&&n.Tables[0].forEach(e=>{0==this.Profile.Items.filter(t=>t.Value==e.ProfileID.toString()).length&&s.push(c.d.ComboBoxItems_2(e.ProfileName.toString(),e.ProfileID.toString()))}),e.ComboData=s,this.JVGrid.Columns.push(e),this.JVGrid.TableColumns.push("ProfileID"),this.JVGrid.TableColumns.push("CostID");let r=i.a.admin.GetAndDeleteDistCosts(0,2);if(null!=r&&r.Tables.length>0&&r.Tables[0].length>0){for(let e=0;e<r.Tables[0].length;e++){let t=this.JVGrid.NewRow();t.ProfileID=r.Tables[0][e].ProfileID,t.CostID=r.Tables[0][e].CostID,this.JVGrid.Columns.forEach(s=>{!s.DisplayMember.startsWith("DCCCNID")&&"AccountTypeID"!=s.DisplayMember&&"AccountID"!=s.DisplayMember||!r.Columns[0].Contains(s.DisplayMember)||a.e.IsEmpty(r.Tables[0][e][s.DisplayMember])||(t[s.ValueMember]=r.Tables[0][e][s.DisplayMember])}),this.JVGrid.addRow(t)}this.JVGrid.RefreshGrid=!0}for(let i=this.JVGrid.Table.length;i<10;i++){let e=this.JVGrid.NewRow();this.JVGrid.addRow(e)}}InitPostingGrid(e){let t;if(this.Title="Distribute Cost",this.JVGrid.Columns=[],this.JVGrid.Table=[],this.JVGrid.Height=150,null!=e&&(this.JVGrid.Width="700"),this.JVGrid.CanUserAddRows=!0,this.JVGrid.CellEditEnding.Subscribe(this,"OnGridCellEditEnding"),null!=e){if(e.IsInventoryVoucher){let t=e.BillWisedt.find(e=>e.AccountID==this.colname);a.e.IsEmpty(t[0].Amount)||(this.TotAmt=parseFloat(t[0].Amount.toString())),a.e.IsEmpty(t[0].CurrencyID)||(this.currencyid=parseInt(t[0].CurrencyID.toString())),a.e.IsEmpty(t[0].ExchangeRate)||(this.exchrate=parseFloat(t[0].ExchangeRate.toString())),this.Amount.Text=this.TotAmt.toString(),null!=e.ScreenObject.CreditAccount&&e.ScreenObject.CreditAccount.SelectedValue==parseInt(this.colname)?this.AccountName.Text=e.ScreenObject.CreditAccount.Name.Text:null!=e.ScreenObject.DebitAccount&&e.ScreenObject.DebitAccount.SelectedValue==parseInt(this.colname)&&(this.AccountName.Text=e.ScreenObject.DebitAccount.Name.Text)}this.AccountName.Visible=!0,this.Amount.Visible=!0,this.AccountName.Label="Account",this.Amount.Label+="Amount";let t=new h.a;t.Header="Account",t.Width=250,t.DisplayMember="AccountID",t.ValueMember="AccountID_Key",t.DataType="LISTBOX",t.CostCenterID=2,t.TypeID=2,this.JVGrid.Columns.push(t),t=new h.a,t.DataType="FLOAT",t.Header="Amount",t.Width=100,t.DisplayMember="Amount",t.DecimalPoints=this.decimalpoints,t.ShowTotal=!0,t.IsCalculated=1,this.JVGrid.Columns.push(t)}this.JVGrid.TableColumns.push("AccountID"),this.JVGrid.TableColumns.push("AccountID_Key"),this.JVGrid.TableColumns.push("Amount");let s=null,n=null;if(3==this.Type&&null!=e&&e.ScreenObject.Preferences.ContainsKey("DistributeCostDims")&&""!=e.ScreenObject.Preferences.DistributeCostDims?(s=e.ScreenObject.GetCCNames(e.ScreenObject.Preferences.DistributeCostDims),n=e.ScreenObject.Preferences.DistributeCostDims.Split(",")):i.a.SessionManager.Preferences.ContainsKey("DistributeCostDims")&&""!=i.a.SessionManager.Preferences.DistributeCostDims&&(s=i.a.admin.GetfeatureNames(i.a.SessionManager.Preferences.DistributeCostDims),n=i.a.SessionManager.Preferences.DistributeCostDims.Split(",")),null!=s&&s.Tables.length>0&&s.Columns[0].Contains("Name")&&s.Tables[0].length>0)for(let i=0;i<s.Tables[0].length;i++){t=new h.a;let e=parseInt(s.Tables[0][i].FeatureID.toString());t.Header=s.Tables[0][i].Name.toString(),t.Width=150,t.DataType="LISTBOX",t.CostCenterID=e,t.TypeID=1,e-=5e4,t.DisplayMember="DCCCNID"+e,t.ValueMember=t.DisplayMember+"_Key",this.JVGrid.Columns.push(t),this.JVGrid.TableColumns.push(t.DisplayMember),this.JVGrid.TableColumns.push(t.ValueMember)}if(null!=e){let t="";if(e.ScreenObject._CCFields.forEach(e=>{(e instanceof d.b&&e.SelectedValue>0&&!n.Contains(e.CCID.toString())||e instanceof u.a&&e.SelectedValue>0&&!n.Contains(e.CCID.toString()))&&(t+=e.DBColumnName+"="+e.SelectedValue+", ")}),this.StrCC=t.toString(),""==this.StrCC&&(this.StrCC=e.ScreenObject.strCCFields),e.ScreenObject.DocID>0&&!a.e.IsEmpty(e.ScreenObject.DistributeCostXML)){let t=new a.f;if(t.ReadXml("<XML>"+e.ScreenObject.DistributeCostXML+"</XML>"),t.Tables.length>0&&t.Tables[0].length>0&&t.Columns[0].Contains("Amount")){for(let e=0;e<t.Tables[0].length;e++){let s=this.JVGrid.NewRow();s.Amount=t.Tables[0][e].Amount.toString(),s.AccountID_Key=t.Tables[0][e].AccountID.toString();for(let i=2;i<this.JVGrid.Columns.length;i++)t.Columns[0].Contains("cc"+this.JVGrid.Columns[i].CostCenterID.toString())&&!a.e.IsEmpty(t.Tables[0][e]["cc"+this.JVGrid.Columns[i].CostCenterID])&&(s[this.JVGrid.Columns[i].ValueMember]=t.Tables[0][e]["cc"+this.JVGrid.Columns[i].CostCenterID].toString());this.JVGrid.Table.push(s)}this.JVGrid.RefreshGrid=!0,this.JVGrid.UpdateTotals()}}else 0==e.ScreenObject.DocID&&a.e.IsEmpty(e.ScreenObject.DistributeCostXML)}else t=new h.a,t.DataType="FLOAT",t.Header="Amount",t.Width=100,t.DisplayMember="Amount",t.DecimalPoints=this.decimalpoints,t.ShowTotal=!0,t.IsCalculated=1,this.JVGrid.Columns.push(t),t=new h.a,t.DataType="FLOAT",t.Header="Percent",t.Width=100,t.DisplayMember="Percent",t.DecimalPoints=this.decimalpoints,t.ShowTotal=!0,t.IsCalculated=1,this.JVGrid.Columns.push(t),this.JVGrid.TableColumns.push("Percent");for(let i=this.JVGrid.Table.length;i<10;i++)this.JVGrid.Table.push({})}InitDistGrid(e){this.Title="Distribute Cost",this.JVGrid.Columns=[],this.JVGrid.Table=[],this.JVGrid.Height=150,this.JVGrid.Width="700",this.JVGrid.CanUserAddRows=!0,this.JVGrid.OnCellEditEnding.Subscribe(this,"OnGridCellEditEnding"),this.AddVisible=!0;let t,s=e.ScreenObject.ColumnSource.find(e=>e.DisplayMember==this.colname);this.Profile.Visible=!1,null!=e&&(t=new h.a,t.Header="Distribute",t.Width=250,t.DisplayMember="DimID",t.ValueMember="DimID_Key",t.DataType="LISTBOX",t.CostCenterID=s.distDim,t.TypeID=1,this.JVGrid.Columns.push(t),t=new h.a,t.DataType="FLOAT",t.Header="Percentage",t.Width=100,t.DisplayMember="Amount",t.DecimalPoints=this.decimalpoints,t.ShowTotal=!0,s.distequally&&(t.IsVisible=!1),this.JVGrid.Columns.push(t)),this.JVGrid.TableColumns.push("DimID"),this.JVGrid.TableColumns.push("DimID_Key"),this.JVGrid.TableColumns.push("Amount");let i=new a.f;s.distLineWise&&!a.e.IsEmpty(this.parent.SelectedRow[s.DisplayMember+"DistXML"])?i.LoadXml(this.parent.SelectedRow[s.DisplayMember+"DistXML"].toString()):a.e.IsEmpty(s.distxml)||i.LoadXml(s.distxml);let n=i.SelectNodes("XML/Rows");for(let a=0;a<n.length;a++)if(null!=n[a].attributes["DCCCNID"+(this.JVGrid.Columns[0].CostCenterID-5e4)]){let e=this.parent.GetEmptyRowPosition(this.JVGrid,"DimID_Key");this.JVGrid.Table[e].DimID_Key=parseInt(n[a].attributes["DCCCNID"+(this.JVGrid.Columns[0].CostCenterID-5e4)].value),s.distequally||null==n[a].attributes.Percent||(this.JVGrid.Table[e].Amount=n[a].attributes.Percent.value)}n.length>0&&(this.JVGrid.RefreshGrid=!0);for(let a=this.JVGrid.Table.length;a<10;a++){let e=this.JVGrid.NewRow();this.JVGrid.addRow(e)}}InitArAPGrid(e){this.Title=38==e.DocumentType?"Advances":"Down Payments",this.JVGrid.Columns=[],this.JVGrid.Table=[],this.JVGrid.Height=150,this.JVGrid.Width="500",this.Profile.Visible=!1;let t=new h.a;t.Header="Doc No.",t.ReadOnly=!0,t.Width=150,t.DisplayMember="DocNo",this.JVGrid.Columns.push(t),t=new h.a,t.DataType="FLOAT",t.Header="Total",t.ReadOnly=!0,t.Width=100,t.DisplayMember="Total",t.DecimalPoints=this.decimalpoints,this.JVGrid.Columns.push(t),t=new h.a,t.DataType="FLOAT",t.Header="Balance",t.ReadOnly=!0,t.Width=100,t.DisplayMember="Balance",t.DecimalPoints=this.decimalpoints,this.JVGrid.Columns.push(t),t=new h.a,t.DataType="FLOAT",t.Header="Amount",t.Width=100,t.DisplayMember="Amount",t.DecimalPoints=this.decimalpoints,this.JVGrid.Columns.push(t),this.JVGrid.TableColumns.push("DocNo"),this.JVGrid.TableColumns.push("Total"),this.JVGrid.TableColumns.push("Balance"),this.JVGrid.TableColumns.push("Amount"),this.JVGrid.CellEditEnding.Subscribe(this,"OnGridCellEditEnding"),this.JVGrid.BeginEdit.Subscribe(this,"onBeginEdit"),11==e.DocumentType&&null!=e.ScreenObject.DebitAccount&&e.ScreenObject.DebitAccount.SelectedValue>0?this.AccountID=e.ScreenObject.DebitAccount.SelectedValue:1==e.DocumentType&&null!=e.ScreenObject.CreditAccount&&e.ScreenObject.CreditAccount.SelectedValue>0&&(this.AccountID=e.ScreenObject.CreditAccount.SelectedValue);let s=e.ScreenObject.GetArApDetails(this.AccountID,e.DocumentDate,1==this.Type);if(null!=s&&s.Tables.length>0&&s.Columns[0].Contains("DocNo")&&s.Tables[0].length>0){let t=new a.f;""!=e.ArApBills&&t.ReadXml("<bills>"+e.ArApBills+"</bills>");for(let a=0;a<s.Tables[0].length;a++){let n=this.JVGrid.NewRow();if(n.DocNo=s.Tables[0][a].DocNo.toString(),n.Total=s.Tables[0][a].Amount.toString(),n.Balance=s.Tables[0][a].Bal.toString(),null!=t&&t.Tables.length>0&&t.Columns[0].Contains("RefDocNo")&&t.Tables[0].length>0)(i=t.Tables[0].filter(e=>e.RefDocNo==n.DocNo.toString())).length>0&&(38==e.DocumentType||i[0].AccountID.toString()==this.AccountID.toString())&&(n.Amount=i[0].Amount.toString());else if(s.Tables.length>1&&s.Columns[1].Contains("DocNo")&&s.Tables[1].length>0){var i;(i=s.Tables[1].filter(e=>e.DocNo==n.DocNo.toString())).length>0&&(n.Amount=n.Balance.toString())}this.JVGrid.addRow(n)}}}onBeginEdit(e,t,s){if("Amount"==t){let t=a.e.Double(e.Amount);""!=e.Amount.toString()&&0!=t||(e.Amount=e.Balance)}return!1}OnGridCellEditEnding(e,t,s){var i;if("pdcGenerateChequeViewModel"!=(null===(i=this.parent)||void 0===i?void 0:i.ClassName))3!=this.Type?"Amount"==t&&this.JVGrid.TableColumns.Contains("Balance")&&parseFloat(e.Amount)>parseFloat(e.Balance)&&(e.Amount=parseFloat(e.Balance),this.JVGrid.updateRow(e)):this.JVGrid.UpdateTotals();else{let e=0;for(let t=0;t<this.JVGrid.Table.length;t++)a.e.IsEmpty(this.JVGrid.Table[t].Amount)||(e+=parseFloat(this.JVGrid.Table[t].Amount.toString()));this.JVGrid.Columns[1].footer=e.ToString("N"+this.Mdeci)}}ShowJVViewModel_3(e){let t="";for(let i=0;i<e.length;i++)0==i?t=e[i].CurrencyID.toString():t!=e[i].CurrencyID.toString()&&(t="FC"),e[i].CRAmtFC=parseFloat(e[i].CRAmt.toString())*parseFloat(e[i].ExchangeRate.toString()),e[i].DBAmtFC=parseFloat(e[i].DBAmt.toString())*parseFloat(e[i].ExchangeRate.toString());this.Profile.Visible=!1,this.Title=i.a.GetResource("Inventory_JournalVoucher"),this.JVGrid.Columns=[],this.JVGrid.Table=e,this.JVGrid.Height=200,this.JVGrid.Width="700",this.JVGrid.Table.sort((e,t)=>e.DBAmt-t.DBAmt);let s=new h.a;s.Header="Account Code",s.ReadOnly=!0,s.Width=200,s.DisplayMember="AccountCode",this.JVGrid.Columns.push(s),s=new h.a,s.Header="Account Name",s.ReadOnly=!0,s.Width=250,s.DisplayMember="AccountID",this.JVGrid.Columns.push(s),s=new h.a,s.DataType="FLOAT",s.Header="Debit",s.ReadOnly=!0,s.Width=100,s.DisplayMember="FC"==t?"DBAmtFC":"DBAmt",s.footer=e.Compute("sum","DBAmtFC"),s.ShowTotal=!0,this.JVGrid.Columns.push(s),s=new h.a,s.DataType="FLOAT",s.Header="Credit",s.ReadOnly=!0,s.Width=100,s.DisplayMember="FC"==t?"CRAmtFC":"CRAmt",s.footer=e.Compute("sum","CRAmtFC").toString(),s.ShowTotal=!0,this.JVGrid.Columns.push(s)}OnProfileSelection(){if("-1"==this.Profile.SelectedValue)this.Name.Enable=!0,this.Name.Text="",this.JVGrid.Clear();else if(null!=this.Profile.SelectedValue){this.Name.Enable=!1;let e=i.a.admin.GetAndDeleteDistCosts(parseInt(this.Profile.SelectedValue),0);this.Name.Text=this.Profile.GetText(),this.JVGrid.Clear(),null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&this.fillpostinggrid(e)}for(let e=0;e<10;e++){let e=this.JVGrid.NewRow();this.JVGrid.addRow(e)}}fillpostinggrid(e){this.JVGrid.Clear();for(let t=0;t<e.Tables[0].length;t++){let s=this.JVGrid.NewRow();5==this.Type?a.e.Double(e.Tables[0][t].Percent)>0?s.Amount=this.TotAmt*parseFloat(e.Tables[0][t].Percent)/100:a.e.Double(e.Tables[0][t].Amount)>0&&(s.Amount=e.Tables[0][t].Amount):(s.Amount=e.Tables[0][t].Amount,s.Percent=e.Tables[0][t].Percent),this.JVGrid.Columns.forEach(i=>{i.DisplayMember.startsWith("DCCCNID")&&e.Columns[0].Contains(i.DisplayMember)&&!a.e.IsEmpty(e.Tables[0][t][i.DisplayMember])&&(s[i.ValueMember]=e.Tables[0][t][i.DisplayMember])}),this.JVGrid.addRow(s)}this.JVGrid.RefreshGrid=!0;for(let t=0;t<10;t++){let e=this.JVGrid.NewRow();this.JVGrid.addRow(e)}}OnSave(e){var t,s;if("AddRows"==e.toString()){let e=new m.a;return e.SearchDocumentViewModel_3(this,this.JVGrid.Columns[0].CostCenterID),void i.a.page.ShowDialog(e,b.a,{HideHeader:!0})}if("OK"==e.toString()){if((null===(t=this.JVGrid.angularGrid)||void 0===t?void 0:t.slickGrid)&&(null===(s=this.JVGrid.angularGrid)||void 0===s?void 0:s.slickGrid.getActiveCellNode())&&this.JVGrid.angularGrid.slickGrid.getEditorLock().commitCurrentEdit(),null==parent){if(6==this.Type){let e="",t="",s="",n="",r=0;for(let i=0;i<this.JVGrid.Table.length;i++)a.e.IsEmpty(this.JVGrid.Table[i].ProfileID)||(e+='<Row ProfileID="'+this.JVGrid.Table[i].ProfileID.toString()+'" ',a.e.IsEmpty(this.JVGrid.Table[i].CostID)?e+=' CostID="0" ':e+=' CostID="'+this.JVGrid.Table[i].CostID.toString()+'" ',this.JVGrid.Columns.forEach(o=>{o.DisplayMember.startsWith("DCCCNID")?(0==r&&(t+=o.DisplayMember+",",s+="X.value('@"+o.DisplayMember+"','BIGINT'),",n+=","+o.DisplayMember+"=X.value('@"+o.DisplayMember+"','BIGINT')"),a.e.IsEmpty(this.JVGrid.Table[i][o.ValueMember])||(e+=o.DisplayMember+'="'+this.JVGrid.Table[i][o.ValueMember].toString()+'" ')):("AccountTypeID"!=o.DisplayMember||a.e.IsEmpty(this.JVGrid.Table[i][o.ValueMember]))&&("AccountID"!=o.DisplayMember||a.e.IsEmpty(this.JVGrid.Table[i][o.ValueMember]))||(e+=o.DisplayMember+'="'+this.JVGrid.Table[i][o.ValueMember].toString()+'" ')}),r++,e+="/>");e.length>0&&(e="<XML>"+e,e+="</XML>",i.a.admin.SaveDistCosts(2,0,n,e.toString(),t,s).subscribe(e=>{this.DisplayMessage=e.Message},e=>{console.log(e),this.DisplayMessage="Error in save"}))}else{if(a.e.IsEmpty(this.Name.Text))return this.DisplayMessage="Enter profile name.",void(this.MessageVisibility=!0);let e="",t="",s="",n=0;for(let i=0;i<this.JVGrid.Table.length;i++)(""!=this.JVGrid.Table[i].Amount.toString()&&parseFloat(this.JVGrid.Table[i].Amount.toString())>0||""!=this.JVGrid.Table[i].Percent.toString()&&parseFloat(this.JVGrid.Table[i].Percent.toString())>0)&&(e+='<Row Amount="'+this.JVGrid.Table[i].Amount.toString()+'" ',e+='Percent="'+this.JVGrid.Table[i].Percent.toString()+'" ',this.JVGrid.Columns.forEach(r=>{r.DisplayMember.startsWith("DCCCNID")&&(0==n&&(t+=r.DisplayMember+",",s+="X.value('@"+r.DisplayMember+"','BIGINT'),"),a.e.IsEmpty(this.JVGrid.Table[i][r.ValueMember])||(e+=r.DisplayMember+'="'+this.JVGrid.Table[i][r.ValueMember].toString()+'" '))}),n++,e+="/>");e.length>0&&(e="<XML>"+e,e+="</XML>",i.a.admin.SaveDistCosts(1,parseInt(this.Profile.SelectedValue),this.Name.Text,e.toString(),t,s).subscribe(e=>{this.DisplayMessage=e.Message,parseInt(e.RetValue)>0&&(this.FillProfiles(),this.JVGrid.Clear())},e=>{console.log(e),this.DisplayMessage="Error in save"}))}return}if("AddEditDocumentViewModel"==this.parent.ClassName)if(7==this.Type){let e=0;for(let t=0;t<this.JVGrid.Table.length;t++)a.e.IsEmpty(this.JVGrid.Table[t].DimID_Key)||e++;if(!(e>0))return this.DisplayMessage="Select "+this.JVGrid.Columns[0].Header,void(this.MessageVisibility=!0);{let t=this.parent.ScreenObject.ColumnSource.find(e=>e.DisplayMember==this.colname),s="";e=100/e;let i="",n=[];i+="<XML>";for(let r=0;r<this.JVGrid.Table.length;r++)if(!a.e.IsEmpty(this.JVGrid.Table[r].DimID_Key)){if(n.Contains(parseInt(this.JVGrid.Table[r].DimID_Key.toString())))return this.DisplayMessage="Duplicate "+this.JVGrid.Columns[0].Header+" :"+this.JVGrid.Table[r].DimID.toString(),void(this.MessageVisibility=!0);i+="<Rows  DCCCNID"+(this.JVGrid.Columns[0].CostCenterID-5e4)+'="'+this.JVGrid.Table[r].DimID_Key.toString(),this.JVGrid.Columns[1].IsVisible&&!a.e.IsEmpty(this.JVGrid.Table[r].Amount)?i+='" Percent="'+this.JVGrid.Table[r].Amount.toString()+'" />':i+='" Percent="'+e+'" />',a.e.IsEmpty(t.DefaultValueText)||(s+=this.JVGrid.Table[r].DimID.toString()+", ")}if(i+="</XML>",t.distLineWise?this.parent.SelectedRow[t.DisplayMember+"DistXML"]=i.toString():t.distxml=i.toString(),!a.e.IsEmpty(t.DefaultValueText))if(s.length>2&&(s=s.substr(0,s.length-2)),this.parent.ScreenObject.GridDataColumns.Contains(t.DefaultValueText))this.parent.SelectedRow[t.DefaultValueText]=s;else{let e=this.parent.ScreenObject._TextFields.find(e=>e.DBColumnName.toLowerCase()==t.DefaultValueText.toLowerCase());(null!=e&&e instanceof o.d||null!=e&&e instanceof o.c)&&(e.Text=s)}}}else if(3==this.Type||5==this.Type){let e;if(e=3==this.Type?this.JVGrid.Table.filter(e=>e.AccountID_Key>0).Compute("sum","Amount"):this.JVGrid.Table.Compute("sum","Amount"),null==e||parseFloat(e).ToString("N"+this.decimalpoints)!=this.TotAmt.ToString("N"+this.decimalpoints))return void(this.DisplayMessage="Amount not equal.");this.parent.DialogResult=!0}else{let e="",t=0;for(let s=0;s<this.JVGrid.Table.length;s++)!a.e.IsEmpty(this.JVGrid.Table[s].Amount)&&parseFloat(this.JVGrid.Table[s].Amount.toString())>0&&(t+=parseFloat(this.JVGrid.Table[s].Amount.toString()),e+='<NonAccRows  RefDocNo="'+this.JVGrid.Table[s].DocNo.toString()+'" Amount="',e+=this.JVGrid.Table[s].Amount.toString()+'" ',38!=this.parent.DocumentType&&(e+=' AccountID="'+this.AccountID+'" '),e+="      />");if(38!=this.parent.DocumentType){if((r=this.parent.ScreenObject.FooterGridData.find(e=>e.ColumnName==this.colname)).length>0)r[0].Amount=t,r[0].ReadOnly="True";else{let e=this.parent.ScreenObject.FooterGridDataObj.NewRow();(r=this.parent.ScreenObject.FooterColumnSource[1].ComboData.filter(e=>e.ColumnName==this.colname)).length>0&&(e.Sno=this.parent.ScreenObject.FooterGridData.length+1,e.Name=a.e.String(r[0].Name),e.ColumnName=a.e.String(r[0].ColumnName),e.PostingType=a.e.String(r[0].PostingType),e.IsCalculated=a.e.String(r[0].IsCalculated),e.CrRefColName=a.e.String(r[0].CrRefColName),e.CrRefColID=a.e.String(r[0].CrRefColID),e.CrRefID=a.e.String(r[0].CrRefID),e.CrRefSection=a.e.String(r[0].CrRefSection),e.DrRefColName=a.e.String(r[0].DrRefColName),e.DrRefColID=a.e.String(r[0].DrRefColID),e.DrRefID=a.e.String(r[0].DrRefID),e.DrRefSection=a.e.String(r[0].DrRefSection),e.DebitAccount=a.e.String(r[0].DebitAccount),e.CreditAccount=a.e.String(r[0].CreditAccount),e.Formula=a.e.String(r[0].Formula),e.dcCurrID_Key=a.e.String(r[0].Currency),e.dcCurrID=a.e.String(r[0].CurrencyName),e.ReadOnly="True",e.IsVisible=a.e.String(r[0].IsVisible),e.BasedOnXML=a.e.String(r[0].BasedOnXML),e.Amount=t,this.parent.ScreenObject.FooterGridDataObj.TableColumns.Contains("StyleHeightZero")&&(e.StyleHeightZero=Object(n.j)(e.IsVisible.toString())?0:1),this.parent.ScreenObject.FooterGridDataObj.addRow(e))}this.parent.CalculateFooter(-1)}else{let e=this.parent.POSPayModes.GridData;var r;if((r=e.filter(e=>e.ColumnName==this.colname)).length>0){r[0].Amount=t,this.parent.POSPayModes.GridDataObj.updateRow(r[0]),t=0;for(let i=0;i<e.length;i++)a.e.IsEmpty(e[i].ColumnName)||a.e.IsEmpty(e[i].Amount)||(t+=parseFloat(e[i].Amount.toString()));let s="2";this.parent.ScreenObject.Preferences.ContainsKey("DecimalsNetAmount")&&""!=this.parent.ScreenObject.Preferences.DecimalsNetAmount&&(s=this.parent.ScreenObject.Preferences.DecimalsNetAmount),this.parent.Bal=parseFloat((this.parent.GridNetTotal+this.parent.FooterGridNetTotal-t).ToString("N"+s)),this.parent.Bal<0&&(this.parent.Bal=0)}}this.parent.ArApBills=e.toString()}else if("pdcGenerateChequeViewModel"==this.parent.ClassName){let e=0;for(let s=0;s<this.JVGrid.Table.length;s++)a.e.IsEmpty(this.JVGrid.Table[s].Amount)||(e+=parseFloat(this.JVGrid.Table[s].Amount.toString()));if(parseFloat(this.parent.GrBody.SelectedItem.Amount.toString()).ToString("N0")!=e.ToString("N0"))return void(this.DisplayMessage="Amount MisMatch.");let t="";for(let s=0;s<this.JVGrid.Table.length;s++)a.e.IsEmpty(this.JVGrid.Table[s].Date_Key)||"0"==this.JVGrid.Table[s].Amount.toString()||a.e.IsEmpty(this.JVGrid.Table[s].Amount)||(t+="<Row  Amount='"+this.JVGrid.Table[s].Amount.toString()+"' Date='",t+=this.JVGrid.Table[s].Date_Key.toString()+"' />");t.length>0?(t="<XML>"+t+"</XML>",this.parent.GrBody.SelectedItem.Detailsxml=t.toString()):this.parent.GrBody.SelectedItem.Detailsxml=null}}else{if("Map"==e.toString()){let e=new S;e.ShowJVViewModel_5(6);let t={component:D.ShowJVComponent};return t.params.obj=e,void i.a.page.addNewTab(t)}if("SelectionChange"==e.toString())return void this.OnProfileSelection();if("Delete"==e.toString()){if("-1"==this.Profile.SelectedValue)this.DisplayMessage="Cannot Delete New";else{let e=i.a.admin.GetAndDeleteDistCosts(parseInt(this.Profile.SelectedValue),3);null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&(this.DisplayMessage=e.Tables[0][0].ErrorMessage.toString(),"Deleted Successfully"==this.DisplayMessage&&(this.Name.Text="",this.JVGrid.Clear(),this.FillProfiles()))}return}if(null!=this.parent&&a.e.IsType(this.parent,"AddEditDocumentViewModel")&&4!=this.Type){let e="";if("Order"==this.JVGrid.Columns[0].Header){let t=this.JVGrid.Table.sort((e,t)=>e.DocField>t.DocField?1:-1);for(let s=0;s<t.length;s++)a.e.IsEmpty(t[s].ReportCol)||"0"==t[s].ReportCol.toString()||(e+=t[s].ReportCol.toString()+",")}else{for(let t=0;t<this.JVGrid.Table.length;t++)a.e.IsEmpty(this.JVGrid.Table[t].ReportCol)||"0"==this.JVGrid.Table[t].ReportCol.toString()||(e+="<Row  ColID='"+this.JVGrid.Table[t].ColID.toString()+"' SysColName='",e+=this.JVGrid.Table[t].SysColName.toString()+"'  ReportCol='"+this.JVGrid.Table[t].ReportCol.toString()+"' />");e.length>0&&(e="<XML>"+e+"</XML>")}}}i.a.page.HideDialog()}getxml(e){let t=this.parent.BillWisedt.filter(e=>e.AccountID==this.colname),s="",i=0;for(let r=0;r<this.JVGrid.Table.length;r++)if(a.e.Double(this.JVGrid.Table[r].Amount)>0&&(5==this.Type||a.e.Int(this.JVGrid.Table[r].AccountID_Key)>0)){i=parseFloat(this.JVGrid.Table[r].Amount),s+="\x11",s+='<Row><Transactions DocDetailsID="0" IsQtyIgnored="1" DocSeqNo="'+this.parent.ScreenObject.GridData.length+'" ',s+='Quantity="" UOMConversion="1" UOMConvertedQty="1" Unit="1" Rate="'+i+'" ',s+=' CurrencyID="'+this.currencyid+'" ExchangeRate="'+this.exchrate+'" ',s+='Gross="'+i+'" StockValue="'+(i*this.exchrate).ToString("N"+this.decimalpoints).Replace(",","")+'" ',s+=' StockValueFC="'+i+'" ',s+=' DynamicInvDocDetailsID="-1" ProductID="'+e+'" ',Object(n.j)(t[0].IsCredit.toString())?(s+='  CreditAccount="'+this.colname+'" ',s+=5==this.Type?'  DebitAccount="'+this.AccountID.toString()+'" ':'  DebitAccount="'+this.JVGrid.Table[r].AccountID_Key.toString()+'" ',s+=" ></Transactions>",s+="<AccountsXML><Accounts ",s+=' CreditAccount="'+this.colname+'" ',s+=5==this.Type?'  DebitAccount="'+this.AccountID.toString()+'" ':' DebitAccount="'+this.JVGrid.Table[r].AccountID_Key.toString()+'" ',this.parent.ScreenObject.FillBillWiseDt(this.parent.BillWisedt,5==this.Type?this.AccountID.toString():this.JVGrid.Table[r].AccountID_Key.toString(),i.toString(),!1,this.currencyid,this.exchrate,0,this.decimalpoints,1)):(s+=' DebitAccount="'+this.colname+'" ',s+=5==this.Type?'  CreditAccount="'+this.AccountID.toString()+'" ':' CreditAccount="'+this.JVGrid.Table[r].AccountID_Key.toString()+'" ',s+=" ></Transactions>",s+="<AccountsXML><Accounts ",s+=' DebitAccount="'+this.colname+'" ',s+=5==this.Type?'  CreditAccount="'+this.AccountID.toString()+'" ':' CreditAccount="'+this.JVGrid.Table[r].AccountID_Key.toString()+'" ',this.parent.ScreenObject.FillBillWiseDt(this.parent.BillWisedt,5==this.Type?this.AccountID.toString():this.JVGrid.Table[r].AccountID_Key.toString(),i.toString(),!0,this.currencyid,this.exchrate,0,this.decimalpoints,1)),s+=' CurrencyID="'+this.currencyid+'" ExchangeRate="'+this.exchrate+'" ',s+='Amount="'+(i*this.exchrate).ToString("N"+this.decimalpoints).Replace(",","")+'" AmtFc="'+i+'" ></Accounts></AccountsXML>',s+="<EXTRAXML></EXTRAXML>",s+="<Numeric /><Alpha />",s+='<CostCenters Query="'+this.StrCC;for(let e=2;e<this.JVGrid.Columns.length;e++)a.e.IsEmpty(this.JVGrid.Table[r][this.JVGrid.Columns[e].ValueMember])||(s+=this.JVGrid.Columns[e].DisplayMember+"="+this.JVGrid.Table[r][this.JVGrid.Columns[e].ValueMember].toString()+",");s+='" ></CostCenters>',s+="</Row>"}return s.toString()}}},gqOg:function(e,t,s){"use strict";s.d(t,"a",(function(){return S}));var i=s("Do2H"),a=s("Lp6j"),n=s("eQJW"),r=s("ScVY"),o=s("EQd/"),l=s("8B8H"),h=s("0/4Q"),c=s("ockk"),d=s("MCLT"),u=s("n56n"),D=s("4HhE"),m=s("Ls/t"),b=s("vTM8");class S extends r.b{constructor(e,t,s,a,n){super(),this.lblVouchNO=null,this.VoucherNo=null,this.ScanText=new o.d(0),this.GridObj=new l.a,this.DynamicColumnSource=[],this.AddedGridObj=new l.a,this.IsJob=!1,this.AddGridVisbility=!1,this.Parent=null,this.RemaingQuantity=0,this.ds=null,this.JobNodeID=0,this.IsBom=!1,this.packs=null,this.Scannedpacks=null,this.batchqty=new b.a,this.ClassName="LinkDocument",this.Title=i.a.GetResource("LinkTitle"),this.GridObj.Columns=[],this.GridObj.Table=[],this.GridObj.SearchVisible=!0,this.GridObj.SelectAll.Visible=!0,this.AddedGridObj.Columns=[],this.AddedGridObj.Table=[],this.IsBom=n,this.Parent=e,this.JobNodeID=a;var r=this.Parent.ScreenObject.ColumnSource.find(e=>null!=e.DisplayMember&&"quantity"==e.DisplayMember.toLowerCase());this.decimalpoints=r&&""!=r.DecimalPoints?r.DecimalPoints:i.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=i.a.SessionManager.Preferences.DecimalsinQty?i.a.SessionManager.Preferences.DecimalsinQty:"2";let d=this.Parent.ScreenObject.Data.Tables[7];null!=this.Parent.ScreenObject&&null!=this.Parent.ScreenObject.Data&&this.Parent.ScreenObject.Data.Tables.length>6&&(d=this.Parent.ScreenObject.Data.Tables[7].filter(e=>"GroupCheckBox"==e.PrefValueType)),this.GridObj.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.GridObj.BeginEdit.Subscribe(this,"OnBeginEdit"),this.GridObj.OnPreviewKeyDown.Subscribe(this,"OnKeyDown"),this.VoucherNo=t,this.GridObj.TableColumns.push("TobeUsed"),this.GridObj.TableColumns.push("ProductType"),this.GridObj.TableColumns.push("BatchNo"),this.GridObj.TableColumns.push("BatchCode"),this.GridObj.TableColumns.push("DocSeqNo"),this.GridObj.TableColumns.push("Select"),this.GridObj.TableColumns.push("DocDetailsID"),this.GridObj.TableColumns.push("ProductName"),this.GridObj.TableColumns.push("ProductCode"),this.GridObj.TableColumns.push("ProductID_Key"),this.GridObj.TableColumns.push("linkFieldName");let u=new c.a;u.Header="#",u.DisplayMember="DocSeqNo",u.DataType="TextBlock",u.ReadOnly=!0,u.Width=25,u.DisableTab=!0,this.ColumnSource.push(u),u=new c.a,u.Header="\u221a",u.DisplayMember="Select",u.DataType="CheckBox",u.Width=25,this.ColumnSource.push(u),this.JobNodeID>0?(this.IsJob=!0,this.AddGridVisbility=!0,this.Boms=new h.e(0),this.Stages=new h.e(0),this.QTY=new o.d(0),this.RemQTY=new o.d(0),this.IO=new h.e(0),36==this.Parent.ScreenObject.DocumentType||37==this.Parent.ScreenObject.DocumentType?(this.RemQTY.Visible=!1,this.QTY.Visible=!1,this.IO.Visible=!1):this.Parent.ScreenObject.IsPurchase?(this.RemQTY.Visible=!1,this.QTY.Visible=!1,this.IO.Visible=!0,this.IO.Items.push(h.d.ComboBoxItems_2("Output","Output")),this.IO.Items.push(h.d.ComboBoxItems_2("Input","Input")),this.IO.SelectedValue=this.IO.Items[0].Value,this.IO.SelectionChangedCommand.Subscribe(this,"onIoChanged")):(this.QTY.Visible=!0,this.IO.Visible=!1,this.QTY.Enable=!1),this.IO.Label="Input/Output",this.QTY.Label="Quantity",this.RemQTY.Label="Remaining Qty",this.QTY.DataType="FLOAT",this.Boms.Label="Boms",this.Stages.Label="Stages",this.Boms.SelectionChangedCommand.Subscribe(this,"onBomChanged"),this.Stages.SelectionChangedCommand.Subscribe(this,"onStageChanged"),i.a.SessionManager.IsActionAssigned(43,"Donot Allow to change Yield Qty")&&(this.RemQTY.Enable=!1),this.FillJobDetails()):(this.lblVouchNO=i.a.GetResource("VoucherNo"),this.ds=e.ScreenObject.GetLinkDocDetails(this.VoucherNo,s),this.Title+=" - "+this.VoucherNo,this.VoucherNo.Contains("','")&&(this.lblVouchNO="",this.VoucherNo="",u=new c.a,u.Header="Voucher No",u.DisplayMember="VoucherNo",u.DataType="TextBlock",u.Width=100,u.ReadOnly=!0,this.ColumnSource.InsertAt(u,2),this.GridObj.TableColumns.Contains("VoucherNo")||this.GridObj.TableColumns.push("VoucherNo")),this.FillLinkDocDetails(d)),this.RefreshGrid=!0}set RefreshGrid(e){}get ColumnSource(){return this.GridObj.Columns}set ColumnSource(e){this.GridObj.Columns=e}get GridData(){return this.GridObj.Table}set GridData(e){this.GridObj.Table=e}get SelectedRow(){return this.GridObj.SelectedItem}set SelectedRow(e){this.GridObj.SelectedItem=e}get AddedColumnSource(){return this.AddedGridObj.Columns}set AddedColumnSource(e){this.AddedGridObj.Columns=e}get AddGridData(){return this.AddedGridObj.Table}set AddGridData(e){this.AddedGridObj.Table=e}OnKeyDown(e,t){"F6"==t.key&&(t.preventDefault(),this.onCopy(e))}onCopy(e){if(e.column.DgCol.IsReadOnly)return;"DataGridPactListBoxColumn"!=e.column.className&&this.GridObj.commitEdit();let t="";if(t=e.column.field,!confirm("Do you want to override all?\nNo to copy blank."))return;let s=confirm("Do you want to override all?");for(let n=0;n<this.GridData.length;n++)if("DataGridPactListBoxColumn"==e.column.className&&this.GridObj.commitEdit(),0!=s||a.e.IsEmpty(this.GridData[n][t])||this.GridObj.DataTypes.Double.Contains(t)||a.e.IsEmpty(this.GridData[n][t])||0!=parseFloat(this.GridData[n][t]))if(this.GridData[n][t]=e.Item.Row[t].toString(),"DataGridDateTimeColumn"==e.column.className&&this.GridObj.TableColumns.Contains(t+"_key"))this.GridData[n][t+"_key"]=e.Item.Row[t+"_key"].toString();else if("DataGridPactListBoxColumn"==e.column.className){var i=this.ColumnSource.find(e=>e.DisplayMember==t);i&&(this.GridData[n][i.ValueMember]=e.Item.Row[i.ValueMember].toString())}}onScanKeyDown(e,t){"13"==t.keyCode&&(this.GridObj.TableColumns.Contains("ScanProduct")?this.onScan(this.ScanText.Text,null):this.onScanPack(this.ScanText.Text))}onScanPack(e){if(this.DisplayMessage="",null==this.packs&&this.Parent.DtPack&&this.Parent.DtPack.length>0){this.packs=[];for(let e=0;e<this.Parent.DtPack.length;e++)a.e.IsEmpty(this.Parent.DtPack[e].Label)||this.packs.push(this.Parent.DtPack[e].Label.toString())}var t=e.split("/");if(t.length>1){if(null!=this.packs&&this.packs.Contains(t[1]))return a.e.PlaySound("beep-03.wav"),void(this.DisplayMessage="Already Scanned");let e=this.Parent.ScreenObject.GetPackInfo(t[1],t[0]),s=!1;if(null!=e&&e.Tables.length>0&&e.Columns[0].Contains("InvDocDetailsID")&&e.Tables[0].length>0)for(let t=0;t<e.Tables[0].length;t++){let i=this.GridData.filter(s=>s.DocDetailsID==e.Tables[0][t].InvDocDetailsID);i.length>0&&(i[0].Select=!0,s=!0,i[0].TobeUsed=!a.e.IsEmpty(i[0].TobeUsed)&&isFinite(i[0].TobeUsed)?parseFloat(i[0].TobeUsed)+parseFloat(e.Tables[0][t].Quantity):e.Tables[0][t].Quantity,this.ValidateQty(i[0]))}s?(a.e.PlaySound("beep-01.wav"),null==this.packs&&(this.packs=[]),null==this.Scannedpacks&&(this.Scannedpacks=[]),this.packs.push(t[1]),this.RemovePack(t[1]),this.Scannedpacks.push(t[1]),this.ScanText.Text=""):a.e.PlaySound("beep-02.wav")}}onScan(e,t){this.DisplayMessage="";var s=this.Parent.ScreenObject.ColumnSource.find(e=>null!=e.DisplayMember&&"ProductCode"==e.DisplayMember);if(s&&s.UseBarcode){let r={PID:0};if(!this.Parent.ReadBarcode(s.BarcodeDef,s.BarcodeProp,null,null,e,r)){if(null!=this.Parent.barcodeValues&&1==this.Parent.barcodeValues.length){let e=this.ds.Tables[4].filter(e=>e.BASECOL==this.Parent.barcodeValues.ElementAt(0).Key);if(e.length>0&&this.ds.Columns[3].Contains(e[0].LINKCOL.toString())&&(e=this.ds.Tables[3].filter(t=>t[e[0].LINKCOL]==this.Parent.barcodeValues.ElementAt(0).Value),e.length>0&&(e=this.GridData.filter(t=>t.DocDetailsID==e[0].InvDocDetailsID.toString()),e.length>0)))return""==a.e.String(e[0].TobeUsed)||!a.e.IsEmpty(e[0].Balance)&&!a.e.IsEmpty(e[0].TobeUsed)&&parseFloat(e[0].Balance.toString())>parseFloat(e[0].TobeUsed.toString())?(e[0].TobeUsed=a.e.IsEmpty(e[0].TobeUsed)?1:parseFloat(e[0].TobeUsed.toString())+1,e[0].ScanProduct=this.ScanText.Text,e[0].ScannedBarcodes=a.e.IsEmpty(e[0].ScannedBarcodes)?e[0].ScanProduct.toString():e[0].ScannedBarcodes.toString()+","+e[0].ScanProduct.toString(),e[0].Select=!0,e[0].ScanProduct="",a.e.PlaySound("beep-02.wav"),void(this.ScanText.Text="")):(a.e.PlaySound("beep-01.wav"),this.DisplayMessage="Item already scanned",void(this.MessageVisibility=!0))}return this.ScanText.Text="",this.DisplayMessage="Item not found",void a.e.PlaySound("beep-01.wav")}if(null==t){let e,s,i;if(this.Parent.ScreenObject.Preferences.ContainsKey("CopyBatches")&&!a.e.IsEmpty(this.Parent.ScreenObject.Preferences.CopyBatches)&&Object(n.j)(this.Parent.ScreenObject.Preferences.CopyBatches)&&(null!=this.Parent.barcodeValues&&this.Parent.barcodeValues.ContainsKey("Batch_No")&&this.GridObj.TableColumns.Contains("BatchNo")?e=this.Parent.barcodeValues.Batch_No:null!=this.Parent.barcodeValues&&this.Parent.barcodeValues.ContainsKey("Batch_Code")&&this.GridObj.TableColumns.Contains("BatchCode")&&(s=this.Parent.barcodeValues.Batch_Code)),null!=this.Parent.barcodeValues&&this.Parent.barcodeValues.ContainsKey("INVID")&&this.ds.Tables.length>13&&this.ds.Tables[13].length>0){let e=this.ds.Tables[13].filter(e=>1==e.Type&&e.RefID==this.Parent.barcodeValues.INVID);e.length>0&&!a.e.IsEmpty(e[0].InvDocDetailsID)&&(i=e[0].InvDocDetailsID)}let o=this.GridData.filter(t=>t.ProductID_Key==r.PID&&(Object(d.isUndefined)(e)||t.BatchNo==e)&&(Object(d.isUndefined)(s)||t.BatchCode==s)&&(Object(d.isUndefined)(i)||t.DocDetailsID==i));if(o.length>0){for(let e=0;e<o.length;e++){let s=o[e];if(a.e.IsEmpty(s.TobeUsed)||!a.e.IsEmpty(s.Balance)&&!a.e.IsEmpty(s.TobeUsed)&&parseFloat(s.Balance)>parseFloat(s.TobeUsed)){t=s;break}}if(null==t)return a.e.PlaySound("beep-01.wav"),void(this.DisplayMessage="Item already scanned");t.ScanProduct=this.ScanText.Text,this.ScanText.Text=""}}if(null!=t&&r.PID==parseInt(t.ProductID_Key)){let e;if(e=null!=this.Parent.barcodeValues&&this.Parent.barcodeValues.ContainsKey("Quantity")&&!a.e.IsEmpty(this.Parent.barcodeValues.Quantity)&&isFinite(this.Parent.barcodeValues.Quantity)?parseFloat(this.Parent.barcodeValues.Quantity):1,!this.Parent.ScreenObject.Preferences.ContainsKey("CopyBatches")||""==this.Parent.ScreenObject.Preferences.CopyBatches.toString()||!Object(n.j)(this.Parent.ScreenObject.Preferences.CopyBatches))if(null!=this.Parent.barcodeValues&&this.Parent.barcodeValues.ContainsKey("Batch_No")){let s=e;this.batchqty.ContainsKey(this.Parent.barcodeValues.Batch_No)&&(s+=this.batchqty[this.Parent.barcodeValues.Batch_No]);let n=new m.a(this.Parent.ScreenObject.GridDataObj);n.BatchNumberViewModel_3(this.Parent,-1,s,r.PID,"",this.Parent.ScreenObject.LocationID,this.Parent.ScreenObject.DivisionID,null);{if(n.GridDataColumns.Contains("QtyUom")){var i=this.ds.Tables[0].filter(e=>e.DocDetailsID==t.DocDetailsID.toString());i.length>0&&!a.e.IsEmpty(i[0].UomConversion)&&(s*=parseFloat(i[0].UomConversion.toString()))}let r=n.GridData.filter(e=>e.BATCHNUMBER==this.Parent.barcodeValues.Batch_No);if(!(r.length>0&&!a.e.IsEmpty(r[0].BalQty)&&parseFloat(r[0].BalQty)>=s))return this.DisplayMessage=r.length>0?"batch qty not available":"batch does not exists",this.MessageVisibility=!0,t.ScanProduct=null,void a.e.PlaySound("beep-01.wav");this.GridObj.TableColumns.Contains("BatchXML")||this.GridObj.TableColumns.push("BatchXML"),this.batchqty.ContainsKey(this.Parent.barcodeValues.Batch_No)?this.batchqty[this.Parent.barcodeValues.Batch_No]+=e:this.batchqty.push(this.Parent.barcodeValues.Batch_No,e),t.BatchXML=a.e.StringValue(t.BatchXML)+" <Row BatchNo='"+this.Parent.barcodeValues.Batch_No+"' QTY='"+e+"' />"}}else if(null!=this.Parent.barcodeValues&&this.Parent.barcodeValues.ContainsKey("Batch_Code")){let s=e;this.batchqty.ContainsKey(this.Parent.barcodeValues.Batch_Code)&&(s+=this.batchqty[this.Parent.barcodeValues.Batch_Code]);let i=new m.a(this.Parent.ScreenObject.GridDataObj);i.BatchNumberViewModel_3(this.Parent,-1,s,r.PID,"",this.Parent.ScreenObject.LocationID,this.Parent.ScreenObject.DivisionID,null);{let n=i.GridData.filter(e=>e.BATCHNUMBER==this.Parent.barcodeValues.Batch_Code);if(!(n.length>0&&""!=n[0].BalQty.toString()&&parseFloat(n[0].BalQty.toString())>=s))return this.DisplayMessage=n.length>0?"batch qty not available":"batch does not exists",this.MessageVisibility=!0,t.ScanProduct=null,void a.e.PlaySound("beep-01.wav");this.GridObj.TableColumns.Contains("BatchXML")||this.GridObj.TableColumns.push("BatchXML"),this.batchqty.ContainsKey(this.Parent.barcodeValues.Batch_No)?this.batchqty[this.Parent.barcodeValues.Batch_No]+=e:this.batchqty.push(this.Parent.barcodeValues.Batch_No,e),t.BatchXML=t.BatchXML.toString()+" <Row BatchCode='"+this.Parent.barcodeValues.Batch_Code+"' QTY='"+e+"' />"}}(a.e.IsEmpty(t.TobeUsed)||!a.e.IsEmpty(t.Balance)&&!a.e.IsEmpty(t.TobeUsed)&&parseFloat(t.Balance)>parseFloat(t.TobeUsed))&&(t.TobeUsed=a.e.IsEmpty(t.TobeUsed)?e:parseFloat(t.TobeUsed)+e,t.ScannedBarcodes=a.e.IsEmpty(t.ScannedBarcodes)?t.ScanProduct.toString():t.ScannedBarcodes+","+t.ScanProduct.toString(),t.Select=!0,t.ScanProduct="",a.e.PlaySound("beep-02.wav"),this.GridObj.updateRow(t))}}}onIoChanged(e){this.FillJobProducts()}onBomChanged(e){if(!a.e.IsEmpty(this.Boms.SelectedValue))if(this.Stages.Items.Clear(),this.ds.Tables.length>3&&this.ds.Columns[3].Contains("BOMID")&&this.ds.Tables[3].length>0){let e=this.ds.Tables[3].filter(e=>e.BOMID==this.Boms.SelectedValue);if(e.length>0){for(let t=0;t<e.length;t++){let s=e[t];if(0==this.Stages.Items.filter(e=>null!=e.Value&&e.Value==s.StageID).length){let e=this.ds.Tables[0].filter(e=>e.BOMID==this.Boms.SelectedValue&&e.StageID==s.StageID);if(0==e.length&&i.a.SessionManager.Preferences.ContainsKey("ShowOnlySelectedStages")&&""!=i.a.SessionManager.Preferences.ShowOnlySelectedStages&&Object(n.j)(i.a.SessionManager.Preferences.ShowOnlySelectedStages))continue;let t=0;do{let i=h.d.ComboBoxItems_2(s.Name.toString(),s.StageID.toString());this.ds.Columns[0].Contains("DimName")&&(e.length>1||e.length>t&&!a.e.IsEmpty(e[t].DimID)&&parseInt(e[t].DimID)>1)&&(i.Name+=" "+e[t].DimName.toString(),i.Aliasname=e[t].DimID.toString()),this.Stages.Items.push(i),t++}while(t<e.length)}}1==this.Stages.Items.length&&(this.Stages.SelectedValue=this.Stages.Items[0].Value,this.FillJobProducts())}else this.FillJobProducts()}else this.FillJobProducts()}FillJobProducts(){if(this.GridObj.SelectAll.IsChecked=!1,this.GridData.Clear(),null!=this.Boms.SelectedValue&&""!=this.Boms.SelectedValue&&this.ds.Tables.length>1&&this.ds.Columns[1].Contains("BOMID")&&this.ds.Tables[1].length>0){let e,t;if(null!=this.Stages.SelectedValue&&""!=this.Stages.SelectedValue&&"0"!=this.Stages.SelectedValue&&(e=this.Stages.SelectedValue,null==this.Stages.SelectedItem||a.e.IsEmpty(this.Stages.SelectedItem.Aliasname)||(t=this.Stages.SelectedItem.Aliasname)),36==this.Parent.ScreenObject.DocumentType){let s=this.ds.Tables[1].filter(s=>s.BOMID==this.Boms.SelectedValue&&(Object(d.isUndefined)(e)||s.StageID==e)&&(Object(d.isUndefined)(t)||s.DimID==t));if(s.length>0)for(let e=0;e<s.length;e++){let t=s[e],i=this.GridObj.NewRow();if(i.DocSeqNo=this.GridData.length+1,i.Select=!1,i.DocDetailsID="0",!a.e.IsEmpty(t.StageID)&&this.ds.Tables.length>3&&this.ds.Columns[3].Contains("BOMID")){let e=this.ds.Tables[3].filter(e=>e.BOMID==this.Boms.SelectedValue&&e.StageID==t.StageID);e.length>0&&(i.StageID=e[0].StageID,i.StageNodeID=e[0].StageNodeID,i.StageName=e[0].Name)}i.Machine=t.ResourceName.toString(),i.MachineID=t.ResourceID.toString(),this.ds.Columns[1].Contains("CrAccountID")&&(i.CrAccountID=t.CrAccountID.toString()),this.ds.Columns[1].Contains("CrAccount")&&(i.CrAccount=t.CrAccount.toString()),this.ds.Columns[1].Contains("DrAccountID")&&(i.DrAccountID=t.DrAccountID.toString()),this.ds.Columns[1].Contains("DrAccount")&&(i.DrAccount=t.DrAccount.toString()),this.GridObj.TableColumns.Contains("MachineDim1")&&!a.e.IsEmpty(t.MachineDim1)&&(i.MachineDim1=t.MachineDim1.toString()),this.GridObj.TableColumns.Contains("MachineDim2")&&!a.e.IsEmpty(t.MachineDim2)&&(i.MachineDim2=t.MachineDim2.toString()),i.TotalHrs=t.Hours.toString(),i.Used=t.Used.toString(),i.Balance=a.e.IsEmpty(i.Used)||a.e.IsEmpty(i.TotalHrs)?t.Value:parseFloat(i.TotalHrs)-parseFloat(i.Used),i.Hrs=i.Balance,i.Cost=t.Value,a.e.IsEmpty(i.Cost)||a.e.IsEmpty(i.Hrs)||(i.Value=parseFloat(i.Cost)*parseFloat(i.Hrs)),this.GridObj.addRow(i)}}else if(37==this.Parent.ScreenObject.DocumentType){let s=this.ds.Tables[1].filter(s=>s.BOMID==this.Boms.SelectedValue&&(Object(d.isUndefined)(e)||s.StageID==e)&&(Object(d.isUndefined)(t)||s.DimID==t));if(s.length>0)for(let e=0;e<s.length;e++){let t=s[e],i=this.GridObj.NewRow();if(i.DocSeqNo=this.GridData.length+1,i.Select=!1,i.DocDetailsID="0",!a.e.IsEmpty(t.StageID)&&this.ds.Tables.length>3&&this.ds.Columns[3].Contains("BOMID")){let e=this.ds.Tables[3].filter(e=>e.BOMID==this.Boms.SelectedValue&&e.StageID==t.StageID);e.length>0&&(i.StageID=e[0].StageID,i.StageNodeID=e[0].StageNodeID,i.StageName=e[0].Name)}i.Name=t.Name.toString(),i.Credit=t.CRAccountName.toString(),i.CreditAccountID=t.CreditAccountID.toString(),i.DebitAccountID=t.DebitAccountID.toString(),i.Debit=t.DRAccountName.toString(),i.Amt=t.Value.toString(),i.Used=t.Used.toString(),i.Balance=a.e.IsEmpty(i.Used)||a.e.IsEmpty(i.Amt)?t.Value:parseFloat(i.Amt)-parseFloat(i.Used),i.Value=i.Balance,this.GridObj.addRow(i)}}else{let s,i=0;s=this.Parent.ScreenObject.IsPurchase&&"Output"==this.IO.SelectedValue?2:1;let r=this.ds.Tables[1].filter(i=>i.BOMID==this.Boms.SelectedValue&&(Object(d.isUndefined)(e)||i.StageID==e)&&(Object(d.isUndefined)(t)||i.DimID==t)&&i.ProductUse==s);if(r.length>0){for(let s=0;s<r.length;s++){let o=r[s],l=this.GridObj.NewRow();if(l.DocSeqNo=this.GridData.length+1,l.Select=!1,l.DocDetailsID="0",l.ProductType=o.ProductTypeID,l.AutoStage=o.AutoStage,this.ds.Columns[1].Contains("RemainingQty")&&!a.e.IsEmpty(o.RemainingQty)&&parseFloat(o.RemainingQty)>0&&(i=parseFloat(o.RemainingQty)),this.Parent.ScreenObject.IsPurchase){l.ActualQty=o.Quantity,l.OPQTY=o.Quantity;let e=this.ds.Tables[0].filter(e=>e.BOMID==this.Boms.SelectedValue&&(Object(d.isUndefined)(t)||e.DimID==t));l.BatchSize=e.length>0&&this.ds.Columns[0].Contains("FPQty")&&!a.e.IsEmpty(e[0].FPQty)?e[0].FPQty:0}else{l.IPQTY=o.Quantity;let s=this.ds.Tables[1].filter(s=>s.BOMID==this.Boms.SelectedValue&&(Object(d.isUndefined)(e)||s.StageID==e)&&(Object(d.isUndefined)(t)||s.DimID==t)&&2==s.ProductUse),i=this.ds.Tables[1].filter(e=>e.BOMID==this.Boms.SelectedValue);l.BatchSize=i.length>0&&this.ds.Columns[0].Contains("FPQty")&&!a.e.IsEmpty(i[0].FPQty)?i[0].FPQty:0,l.OPQTY=s.length>0&&!a.e.IsEmpty(s[0].Quantity)?s[0].Quantity:0,i=this.ds.Tables[0].filter(s=>s.BOMID==this.Boms.SelectedValue&&(Object(d.isUndefined)(e)||s.StageID==e)&&(Object(d.isUndefined)(t)||s.DimID==t)),l.ActualQty=i.length>0&&this.ds.Columns[0].Contains("IsBom")&&!a.e.IsEmpty(i[0].IsBom)&&Object(n.j)(i[0].IsBom)||this.ds.Tables.length>2&&this.ds.Tables[2].length>0&&this.ds.Columns[2].Contains("ccAlpha41")&&"BOM"==this.ds.Tables[2][0].ccAlpha41?o.Quantity:s.length>0&&!a.e.IsEmpty(s[0].Quantity)&&1!=parseFloat(s[0].Quantity)&&!a.e.IsEmpty(o.Quantity)?parseFloat(o.Quantity)/parseFloat(s[0].Quantity):o.Quantity}if(!a.e.IsEmpty(o.StageID)&&this.ds.Tables.length>3&&this.ds.Columns[3].Contains("BOMID")){let e=this.ds.Tables[3].filter(e=>e.BOMID==this.Boms.SelectedValue&&e.StageID==o.StageID);e.length>0&&(l.StageID=e[0].StageID,l.StageNodeID=e[0].StageNodeID,l.StageName=e[0].Name)}if(l.UnitPrice=o.UnitPrice,a.e.IsEmpty(o.QOH)||(l.QOH=parseFloat(o.QOH).ToString("N"+this.decimalpoints)),l.Used=a.e.IsEmpty(o.Conversion)||a.e.IsEmpty(o.Used)||1==parseFloat(o.Conversion)?o.Used:parseFloat(o.Used)/parseFloat(o.Conversion),l.Wastage=o.Wastage,l.ProductName=o.ProductName,l.ProductCode=o.ProductCode,l.ProductID_Key=o.ProductID,l.Remarks=o.Remarks,l.UOMID_Key=o.UOMID,l.UOMID=o.UnitName,l.BaseConversion=o.Conversion,this.Parent.ScreenObject.IsPurchase)if("Output"==this.IO.SelectedValue){let s=this.ds.Tables[0].filter(s=>s.BOMID==this.Boms.SelectedValue&&s.ProductID==o.ProductID&&(Object(d.isUndefined)(e)||s.StageID==e)&&(Object(d.isUndefined)(t)||s.DimID==t));s.length>0?(l.Qty=s[0].Qty,this.ds.Columns[0].Contains("IsBom")&&!a.e.IsEmpty(s[0].IsBom)&&!this.IsBom&&Object(n.j)(s[0].IsBom)&&(l.Qty=parseFloat(l.Qty)*parseFloat(o.Quantity))):this.ds.Tables.length>2&&this.ds.Tables[2].length>0&&this.ds.Columns[2].Contains("ccAlpha50")&&(l.Qty=this.ds.Tables[2][0].ccAlpha50,this.ds.Columns[2].Contains("ccAlpha41")&&"BOM"==this.ds.Tables[2][0].ccAlpha41&&(l.Qty=parseFloat(l.Qty)*parseFloat(o.Quantity)));let i=a.e.DoubleTryParse(l.Used),r=a.e.DoubleTryParse(l.Qty);0!=r&&i>0?(i=r-i,l.Balance=i>0?i.ToString("N"+this.decimalpoints):0):l.Balance=l.Qty,l.Value=l.Balance}else{this.ds.Columns[1].Contains("Issued")&&(l.Qty=o.Issued.toString());let e=a.e.DoubleTryParse(l.Used),t=a.e.DoubleTryParse(l.Qty);0!=t&&e>0?(e=t-e,l.Balance=e>0?e.ToString("N"+this.decimalpoints):0):l.Balance=l.Qty,l.Value="0"}this.GridObj.addRow(l)}if(!this.Parent.ScreenObject.IsPurchase){if(r=this.ds.Tables[0].filter(s=>s.BOMID==this.Boms.SelectedValue&&(Object(d.isUndefined)(e)||s.StageID==e)&&(Object(d.isUndefined)(t)||s.DimID==t)),r.length>0?this.QTY.Text=r[0].Qty:this.ds.Tables.length>2&&this.ds.Tables[2].length>0&&this.ds.Columns[2].Contains("ccAlpha50")&&(this.QTY.Text=this.ds.Tables[2][0].ccAlpha50.toString()),i>0){if(a.e.IsNum(this.QTY.Text)){let e=parseFloat(this.QTY.Text)-i;this.RemQTY.Text=e>0?e.ToString("N"+this.decimalpoints):"0"}}else{let e=0,t=0;this.GridData.length>0&&a.e.DoubleTryParse(this.GridData[0].Used)>0&&a.e.DoubleTryParse(this.QTY.Text)>0?(a.e.IsNum(this.GridData[0].ActualQty)&&(e=parseFloat(this.GridData[0].ActualQty)*parseFloat(this.QTY.Text)),t=a.e.DoubleTryParse(this.GridData[0].Wastage),0!=t&&(t=e*t/100),e+=t,t=a.e.DoubleTryParse(this.GridData[0].Used),0!=t&&(t/=parseFloat(e.ToString("N"+this.decimalpoints))),t=parseFloat(this.QTY.Text)-parseFloat(this.QTY.Text)*t,this.RemQTY.Text=t>0?t.ToString("N"+this.decimalpoints):"0"):this.RemQTY.Text=this.QTY.Text}this.CalcQty()}}}}}CalcRemQty(){if(a.e.IsNum(this.RemQTY.Text)){this.RemaingQuantity=parseFloat(this.RemQTY.Text);for(let e=0;e<this.GridData.length;e++)a.e.IsNum(this.GridData[e].ActualQty)&&(this.GridData[e].Value=parseFloat(this.GridData[e].ActualQty)*this.RemaingQuantity)}}CalcQty(){let e;if(a.e.IsNum(this.QTY.Text)){this.RemaingQuantity=a.e.DoubleTryParse(this.QTY.Text);for(let t=0;t<this.GridData.length;t++){let s=0;a.e.IsNum(this.GridData[t].ActualQty)&&(s=parseFloat(this.GridData[t].ActualQty),this.GridData[t].Qty=(s*this.RemaingQuantity).ToString("N"+this.decimalpoints),s*=this.RemaingQuantity),e=a.e.DoubleTryParse(this.GridData[t].Wastage),0!=e&&(e=s*e/100),s+=e,this.GridData[t].Net=s.ToString("N"+this.decimalpoints),a.e.IsNum(this.GridData[t].Used)?(e=parseFloat(this.GridData[t].Used),e=s-e,this.GridData[t].Balance=e>0?e.ToString("N"+this.decimalpoints):0):this.GridData[t].Balance=this.GridData[t].Net,this.GridData[t].Value=this.GridData[t].Balance}}}onStageChanged(e){this.FillJobProducts()}FillJobDetails(){let e=a.e.IntTryParse(i.a.SessionManager.Preferences["Maintain Dimensionwise stock"]),t=!1,s="";var r;let o;if(e>0&&(r=this.Parent.ScreenObject._CCFields.find(t=>t.DBColumnName.toLowerCase()=="dcccnid"+(e-5e4)))&&r instanceof u.b&&r.SelectedValue>0&&(s+=" dcCCNID"+(e-5e4)+"="+r.SelectedValue+" and "),i.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==i.a.SessionManager.Preferences.EnableLocationWise&&i.a.SessionManager.Preferences.ContainsKey("Location Stock")&&Object(n.j)(i.a.SessionManager.Preferences["Location Stock"])&&((r=this.Parent.ScreenObject._CCFields.find(e=>"dcccnid2"==e.DBColumnName.toLowerCase()))&&r instanceof u.b?r.SelectedValue>0&&(s+=" dcCCNID2="+r.SelectedValue+" and "):this.Parent.ScreenObject.LocationID>0?s+=" dcCCNID2="+this.Parent.ScreenObject.LocationID+" and ":i.a.SessionManager.LocationID>0&&(s+=" dcCCNID2="+i.a.SessionManager.LocationID+" and ")),t=!1,i.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"true"==i.a.SessionManager.Preferences.EnableDivisionWise.toLowerCase()&&i.a.SessionManager.Preferences.ContainsKey("Division Stock")&&Object(n.j)(i.a.SessionManager.Preferences["Division Stock"])&&((r=this.Parent.ScreenObject._CCFields.find(e=>"dcccnid1"==e.DBColumnName.toLowerCase()))&&r instanceof u.b?r.SelectedValue>0&&(s+=" dcCCNID1="+r.SelectedValue+" and "):this.Parent.ScreenObject.DivisionID>0?s+=" dcCCNID1="+this.Parent.ScreenObject.DivisionID+" and ":i.a.SessionManager.DivisionID>0&&(s+=" dcCCNID1="+i.a.SessionManager.DivisionID+" and ")),this.ds=this.Parent.ScreenObject.GetjobDetails(this.JobNodeID,s,this.Parent.DocumentDate,this.IsBom),null!=this.ds&&this.ds.Tables.length>0&&!this.ds.Columns[0].Contains("ErrorMessage")&&this.ds.Tables[0].length>0){if(36==this.Parent.ScreenObject.DocumentType){o=new c.a,o.Header=i.a.GetResource("Machine"),o.DisplayMember="Machine",o.Width=120,o.ReadOnly=!0,this.ColumnSource.push(o),o=new c.a,o.Header="Total Hrs",o.DisplayMember="TotalHrs",o.DataType="FLOAT",o.Width=54,o.ReadOnly=!0,o.IsVisible=!0,this.ColumnSource.push(o),o=new c.a,o.Header="Used",o.DisplayMember="Used",o.DataType="FLOAT",o.Width=54,o.ReadOnly=!0,o.IsVisible=!0,this.ColumnSource.push(o),o=new c.a,o.Header="Balance",o.DisplayMember="Balance",o.DataType="FLOAT",o.Width=54,o.ReadOnly=!0,o.IsVisible=!0,this.ColumnSource.push(o),o=new c.a,o.Header="value",o.DisplayMember="Hrs",o.DataType="FLOAT",o.Width=54,o.IsVisible=!0,this.ColumnSource.push(o),o=new c.a,o.Header="Cost/Hr",o.DisplayMember="Cost",o.DataType="FLOAT",o.Width=70,o.ReadOnly=!0,o.IsVisible=!0,i.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=i.a.SessionManager.Preferences.DecimalsinRate&&(o.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinRate),this.ColumnSource.push(o),this.GridObj.TableColumns.push("Machine"),this.GridObj.TableColumns.push("MachineID"),this.GridObj.TableColumns.push("Hrs"),this.GridObj.TableColumns.push("Value"),this.GridObj.TableColumns.push("Cost"),this.GridObj.TableColumns.push("Balance"),this.GridObj.TableColumns.push("Used"),this.GridObj.TableColumns.push("TotalHrs"),this.GridObj.TableColumns.push("CrAccountID"),this.GridObj.TableColumns.push("CrAccount"),this.GridObj.TableColumns.push("DrAccountID"),this.GridObj.TableColumns.push("DrAccount");let e=this.Parent.ScreenObject.getmachinePref();if(null!=e&&e.Tables.length>0&&e.Columns[0].Contains("Name"))for(let t=0;t<e.Tables[0].length;t++)!a.e.IsEmpty(e.Tables[0][t].Value)&&a.e.Int(e.Tables[0][t].Value)>0&&(this.AddedGridObj.TableColumns.push(e.Tables[0][t].Name.toString()),this.GridObj.TableColumns.push(e.Tables[0][t].Name.toString()),this.Parent.ScreenObject.Preferences.ContainsKey(e.Tables[0][t].Name.toString())||this.Parent.ScreenObject.Preferences.push(e.Tables[0][t].Name.toString(),e.Tables[0][t].Value.toString()));o=new c.a,o.Header=i.a.GetResource("Machine"),o.DisplayMember="Machine",o.Width=120,this.AddedColumnSource.push(o),o=new c.a,o.Header=i.a.GetResource("HRS"),o.DisplayMember="Hrs",o.DataType="FLOAT",o.Width=54,o.IsVisible=!0,this.AddedColumnSource.push(o),o=new c.a,o.Header="Cost/Hr",o.DisplayMember="Cost",o.DataType="FLOAT",o.Width=70,o.IsVisible=!0,i.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=i.a.SessionManager.Preferences.DecimalsinRate&&(o.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinRate),this.AddedColumnSource.push(o),o=new c.a,o.Header="Value",o.DisplayMember="Value",o.DataType="FLOAT",o.Width=70,o.IsVisible=!0,i.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=i.a.SessionManager.Preferences.DecimalsinRate&&(o.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinRate),this.AddedColumnSource.push(o),this.AddedGridObj.TableColumns.push("Machine"),this.AddedGridObj.TableColumns.push("MachineID"),this.AddedGridObj.TableColumns.push("Hrs"),this.AddedGridObj.TableColumns.push("Value"),this.AddedGridObj.TableColumns.push("Cost"),this.AddedGridObj.TableColumns.push("CrAccountID"),this.AddedGridObj.TableColumns.push("CrAccount"),this.AddedGridObj.TableColumns.push("DrAccountID"),this.AddedGridObj.TableColumns.push("DrAccount")}else 37==this.Parent.ScreenObject.DocumentType?(o=new c.a,o.Header="Name",o.DisplayMember="Name",o.DataType="TextBlock",o.Width=140,this.ColumnSource.push(o),o=new c.a,o.Header="Debit",o.DisplayMember="Debit",o.Width=155,o.IsVisible=!0,this.ColumnSource.push(o),o=new c.a,o.Header="Credit",o.DisplayMember="Credit",o.Width=155,o.IsVisible=!0,this.ColumnSource.push(o),o=new c.a,o.Header="Total Amount",o.DisplayMember="Amt",o.DataType="FLOAT",o.Width=85,o.IsVisible=!0,i.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=i.a.SessionManager.Preferences.DecimalsinRate&&(o.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinRate),this.ColumnSource.push(o),o=new c.a,o.Header="Used",o.DisplayMember="Used",o.DataType="FLOAT",o.Width=85,o.IsVisible=!0,i.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=i.a.SessionManager.Preferences.DecimalsinRate&&(o.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinRate),this.ColumnSource.push(o),o=new c.a,o.Header="Balance",o.DisplayMember="Balance",o.DataType="FLOAT",o.Width=85,o.IsVisible=!0,i.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=i.a.SessionManager.Preferences.DecimalsinRate&&(o.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinRate),this.ColumnSource.push(o),o=new c.a,o.Header=i.a.GetResource("Value"),o.DisplayMember="Value",o.DataType="FLOAT",o.Width=85,o.IsVisible=!0,i.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=i.a.SessionManager.Preferences.DecimalsinRate&&(o.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinRate),this.ColumnSource.push(o),this.GridObj.TableColumns.push("Name"),this.GridObj.TableColumns.push("Credit"),this.GridObj.TableColumns.push("CreditAccountID"),this.GridObj.TableColumns.push("DebitAccountID"),this.GridObj.TableColumns.push("Debit"),this.GridObj.TableColumns.push("Value"),this.GridObj.TableColumns.push("Amt"),this.GridObj.TableColumns.push("Used"),this.GridObj.TableColumns.push("Balance"),o=new c.a,o.Header="Name",o.DisplayMember="Name",o.DataType="TextBlock",o.Width=140,this.AddedColumnSource.push(o),o=new c.a,o.Header="Debit",o.DisplayMember="Debit",o.Width=155,o.IsVisible=!0,this.AddedColumnSource.push(o),o=new c.a,o.Header="Credit",o.DisplayMember="Credit",o.Width=155,o.IsVisible=!0,this.AddedColumnSource.push(o),o=new c.a,o.Header=i.a.GetResource("Value"),o.DisplayMember="Value",o.DataType="FLOAT",o.Width=85,o.IsVisible=!0,i.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=i.a.SessionManager.Preferences.DecimalsinRate&&(o.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinRate),this.AddedColumnSource.push(o),this.AddedGridObj.TableColumns.push("Name"),this.AddedGridObj.TableColumns.push("Credit"),this.AddedGridObj.TableColumns.push("CreditAccountID"),this.AddedGridObj.TableColumns.push("DebitAccountID"),this.AddedGridObj.TableColumns.push("Debit"),this.AddedGridObj.TableColumns.push("Value")):(o=new c.a,o.Header="Product Code",o.DisplayMember="ProductCode",o.DataType="TextBlock",o.Width=100,o.ReadOnly=!0,this.ColumnSource.push(o),o=new c.a,o.Header="Product Name",o.DisplayMember="ProductName",o.DataType="TextBlock",o.Width=180,o.ReadOnly=!0,this.ColumnSource.push(o),o=new c.a,o.Header="QOH",o.DisplayMember="QOH",o.DataType="TextBlock",o.Width=80,o.ReadOnly=!0,this.ColumnSource.push(o),o=new c.a,o.Header="Qty",o.DisplayMember="Qty",o.DataType="TextBlock",o.Width=80,o.ReadOnly=!0,this.ColumnSource.push(o),this.Parent.ScreenObject.IsPurchase||(o=new c.a,o.Header="Wastage",o.DisplayMember="Wastage",o.DataType="TextBlock",o.Width=70,o.ReadOnly=!0,this.ColumnSource.push(o),o=new c.a,o.Header="Net Qty",o.DisplayMember="Net",o.DataType="TextBlock",o.Width=80,o.ReadOnly=!0,this.ColumnSource.push(o)),o=new c.a,o.Header=this.Parent.ScreenObject.IsPurchase?"Recieved":"Issued",o.DisplayMember="Used",o.DataType="TextBlock",o.Width=80,o.ReadOnly=!0,this.ColumnSource.push(o),o=new c.a,o.Header="Balance",o.DisplayMember="Balance",o.DataType="TextBlock",o.Width=80,o.ReadOnly=!0,this.ColumnSource.push(o),o=new c.a,o.Header=this.Parent.ScreenObject.IsPurchase?"Yield/Recieve Qty":"Yield/Issue Qty",o.DisplayMember="Value",o.DataType="TextBlock",o.Width=80,i.a.SessionManager.IsActionAssigned(43,"Donot Allow to change Yield Qty")&&(o.ReadOnly=!0),this.ColumnSource.push(o),o=new c.a,o.Header="Units",o.Width=80,o.DisplayMember="UOMID",o.ValueMember="UOMID_Key",o.DataType="LISTBOX",o.CostCenterID=11,o.TypeID=1,this.Parent.ScreenObject.IsPurchase?i.a.SessionManager.IsActionAssigned(43,"Donot Allow to change Yield Qty")&&(o.ReadOnly=!0):o.ReadOnly=!0,this.ColumnSource.push(o),this.GridObj.TableColumns.push("UnitPrice"),this.GridObj.TableColumns.push("ActualQty"),this.GridObj.TableColumns.push("Wastage"),this.GridObj.TableColumns.push("Qty"),this.GridObj.TableColumns.push("Net"),this.GridObj.TableColumns.push("Balance"),this.GridObj.TableColumns.push("Used"),this.GridObj.TableColumns.push("QOH"),this.GridObj.TableColumns.push("Value"),this.GridObj.TableColumns.push("UOMID"),this.GridObj.TableColumns.push("UOMID_Key"),this.GridObj.TableColumns.push("BaseConversion"),this.GridObj.TableColumns.push("AutoStage"),this.GridObj.TableColumns.push("Remarks"),this.AddedGridObj.TableColumns.push("Qty"),this.AddedGridObj.TableColumns.push("ProductName"),this.AddedGridObj.TableColumns.push("ProductCode"),this.AddedGridObj.TableColumns.push("ProductID_Key"),this.AddedGridObj.TableColumns.push("IsOutput"),this.AddedGridObj.TableColumns.push("ProductType"),this.AddedGridObj.TableColumns.push("UOMID"),this.AddedGridObj.TableColumns.push("UOMID_Key"),this.AddedGridObj.TableColumns.push("Net"),this.AddedGridObj.TableColumns.push("AutoStage"),this.AddedGridObj.TableColumns.push("UnitPrice"),this.AddedGridObj.TableColumns.push("Remarks"),o=new c.a,o.Header="Bom",o.DisplayMember="BomName",o.DataType="TextBlock",o.Width=100,o.ReadOnly=!0,this.AddedColumnSource.push(o),this.ds.Tables.length>2&&this.ds.Tables[2].length>0&&!a.e.IsEmpty(this.ds.Tables[2][0].StageCCID)&&parseInt(this.ds.Tables[2][0].StageCCID)>0&&(o=new c.a,o.Header="Stage",o.DisplayMember="StageName",o.DataType="TextBlock",o.Width=60,o.ReadOnly=!0,this.AddedColumnSource.push(o)),o=new c.a,o.Header="Product Code",o.DisplayMember="ProductCode",o.DataType="TextBlock",o.Width=100,o.ReadOnly=!0,this.AddedColumnSource.push(o),o=new c.a,o.Header="Product Name",o.DisplayMember="ProductName",o.DataType="TextBlock",o.Width=180,o.ReadOnly=!0,this.AddedColumnSource.push(o),o=new c.a,o.Header="Qty",o.DisplayMember="Qty",o.DataType="TextBlock",o.Width=50,o.ReadOnly=!0,this.AddedColumnSource.push(o),o=new c.a,o.Header="Units",o.DisplayMember="UOMID",o.DataType="TextBlock",o.Width=80,o.ReadOnly=!0,this.AddedColumnSource.push(o),!this.Parent.ScreenObject.IsPurchase&&this.Parent.ScreenObject.Preferences.ContainsKey("JobRemainingQty")&&this.AddedGridObj.TableColumns.push("RemainingQty"));this.GridObj.TableColumns.push("StageNodeID"),this.GridObj.TableColumns.push("StageName"),this.GridObj.TableColumns.push("StageID"),this.GridObj.TableColumns.push("IPQTY"),this.GridObj.TableColumns.push("OPQTY"),this.GridObj.TableColumns.push("BatchSize"),this.AddedGridObj.TableColumns.push("StageNodeID"),this.AddedGridObj.TableColumns.push("StageID"),this.AddedGridObj.TableColumns.push("BomID"),this.AddedGridObj.TableColumns.push("BomNodeID"),this.AddedGridObj.TableColumns.push("StageName"),this.AddedGridObj.TableColumns.push("BomName"),this.AddedGridObj.TableColumns.push("IPQTY"),this.AddedGridObj.TableColumns.push("OPQTY"),this.AddedGridObj.TableColumns.push("BatchSize"),this.AddedGridObj.TableColumns.push("RemQty"),this.AddedGridObj.TableColumns.push("ActualQty");for(let e=0;e<this.ds.Tables[0].length;e++)0==this.Boms.Items.filter(t=>null!=t.Value&&t.Value==this.ds.Tables[0][e].BOMID).length&&this.Boms.Items.push(h.d.ComboBoxItems_4(this.ds.Tables[0][e].BomName.toString(),this.ds.Tables[0][e].BOMID,this.ds.Tables[0][e].CCID,this.ds.Tables[0][e].CCNodeID));1==this.Boms.Items.length&&(this.Boms.SelectedValue=this.Boms.Items[0].Value,this.onBomChanged(""))}}FillLinkDocDetails(e){let t,s=[],r=[],o=e;if(this.Parent.ScreenObject.Preferences.ContainsKey("StaticLinkingColumns")&&""!=this.Parent.ScreenObject.Preferences.StaticLinkingColumns){let e=new a.f;e.LoadXml(this.Parent.ScreenObject.Preferences.StaticLinkingColumns);for(let t=0;t<e.DocumentElement.children.length;t++){let i=e.DocumentElement.children[t],a=new c.a;a.Header=i.attributes.Header.value,a.DisplayMember=i.attributes.Name.value,a.DisplayIndex=parseInt(i.attributes.index.value),a.Width=parseInt(i.attributes.WIDTH.value),s.push(a)}}if(this.ColumnSource.forEach(e=>{r.push(e)}),["ProductCode","ProductName"].forEach(i=>{var a=this.Parent.ScreenObject.ColumnSource.find(e=>e.DisplayMember==i);if(a){t=new c.a,t.Header=a.Header,t.DisplayMember=a.DisplayMember,t.DataType=a.DataType,t.Width=a.Width,t.ValueMember=a.ValueMember,t.CostCenterID=a.CostCenterID,t.TypeID=a.TypeID,t.ReadOnly=!0,null!=e&&o.length>0&&"ProductCode"==a.DisplayMember&&(e=o.filter(e=>"GroupCheckBox"==e.PrefValueType&&"ProductCode"==e.PrefName),this.JobNodeID>0?t.IsVisible=!0:e.length>0&&(t.IsVisible=Object(n.j)(e[0].PrefValue))),null!=e&&o.length>0&&"ProductName"==a.DisplayMember&&(e=o.filter(e=>"GroupCheckBox"==e.PrefValueType&&"ProductName"==e.PrefName),this.JobNodeID>0?t.IsVisible=!0:e.length>0&&(t.IsVisible=Object(n.j)(e[0].PrefValue)));var l=s.find(e=>e.DisplayMember==t.DisplayMember);l&&(t.DisplayIndex=l.DisplayIndex,t.Width=l.Width),r.Contains(t)||r.push(t)}}),null!=this.ds&&this.ds.Tables.length>5&&this.ds.Tables[5].length>0&&(this.ds.Columns[5].Contains("IsQtyIgnored")&&"1"==this.ds.Tables[5][0].IsQtyIgnored.toString()||this.Parent.ScreenObject.Preferences.ContainsKey("CopyBatches")&&!a.e.IsEmpty(this.Parent.ScreenObject.Preferences.CopyBatches)&&Object(n.j)(this.Parent.ScreenObject.Preferences.CopyBatches))&&(t=new c.a,t.Header="Batch",t.DisplayMember="BatchNo",t.DataType="TextBlock",t.Width=100,t.ReadOnly=!0,r.push(t)),null!=this.ds&&this.ds.Tables.length>0&&!this.ds.Columns[0].Contains("ErrorMessage")&&this.ds.Tables[0].length>0){var l;this.GridObj.TableColumns.Contains(this.ds.Tables[0][0][this.ds.Columns[0][1]].toString())||(this.GridObj.TableColumns.push(this.ds.Tables[0][0][this.ds.Columns[0][1]].toString()),t=new c.a,t.Header=this.ds.Tables[0][0][this.ds.Columns[0][2]].toString(),t.DisplayMember=this.ds.Tables[0][0][this.ds.Columns[0][1]].toString(),t.DataType="FLOAT",t.Width=100,t.ReadOnly=!0,null!=e&&o.length>0&&(e=o.filter(e=>"GroupCheckBox"==e.PrefValueType&&"Qty"==e.PrefName)).length>0&&(t.IsVisible=Object(n.j)(e[0].PrefValue)),(l=s.find(e=>"Qty"==e.DisplayMember))&&(t.DisplayIndex=l.DisplayIndex,t.Width=l.Width),r.Contains(t)||r.push(t)),this.GridObj.TableColumns.push("Executed"),null!=e&&o.length>0&&(e=o.filter(e=>"GroupCheckBox"==e.PrefValueType&&"QOH"==e.PrefName)).length>0&&Object(n.j)(e[0].PrefValue)&&(this.GridObj.TableColumns.push("QOH"),t=new c.a,t.Header="QOH",t.DisplayMember="QOH",t.DataType="FLOAT",t.Width=100,t.ReadOnly=!0,(l=s.find(e=>e.DisplayMember==t.DisplayMember))&&(t.DisplayIndex=l.DisplayIndex,t.Width=l.Width),r.push(t)),t=new c.a,t.Header=i.a.GetResource("Doc_Executed")+" "+this.ds.Tables[0][0][this.ds.Columns[0][2]].toString(),t.DisplayMember="Executed",t.DataType="FLOAT",t.Width=100,t.ReadOnly=!0,null!=e&&o.length>0&&(e=o.filter(e=>"GroupCheckBox"==e.PrefValueType&&"ExecutedQty"==e.PrefName)).length>0&&(t.IsVisible=Object(n.j)(e[0].PrefValue));var h=s.find(e=>"ExecutedQty"==e.DisplayMember);h&&(t.DisplayIndex=h.DisplayIndex,t.Width=h.Width),r.Contains(t)||r.push(t),this.GridObj.TableColumns.push("Balance"),t=new c.a,t.Header=i.a.GetResource("Doc_Balance")+" "+this.ds.Tables[0][0][this.ds.Columns[0][2]].toString(),t.DisplayMember="Balance",t.DataType="FLOAT",t.Width=100,t.ReadOnly=!0,null!=e&&o.length>0&&(e=o.filter(e=>"GroupCheckBox"==e.PrefValueType&&"BalanceQty"==e.PrefName)).length>0&&(t.IsVisible=Object(n.j)(e[0].PrefValue)),(h=s.find(e=>"BalanceQty"==e.DisplayMember))&&(t.DisplayIndex=h.DisplayIndex,t.Width=h.Width),r.Contains(t)||r.push(t),t=new c.a,t.Header=this.Parent.ScreenObject.Preferences.ContainsKey("LinkHeaderText")&&!a.e.IsEmpty(this.Parent.ScreenObject.Preferences.LinkHeaderText)?this.Parent.ScreenObject.Preferences.LinkHeaderText:i.a.GetResource("Doc_LinkQty"),t.DisplayMember="TobeUsed",t.DataType="FLOAT",t.Width=100,null!=e&&o.length>0&&(e=o.filter(e=>"GroupCheckBox"==e.PrefValueType&&"LinkValue"==e.PrefName)).length>0&&(t.IsVisible=Object(n.j)(e[0].PrefValue)),(h=s.find(e=>"LinkValue"==e.DisplayMember))&&(t.DisplayIndex=h.DisplayIndex,t.Width=h.Width),r.Contains(t)||r.push(t),this.ds.Tables.length>6&&!this.ds.Columns[6].Contains("ErrorMessage")&&(this.GenerateColumns(r,s),this.ColumnSource=[],r.sort((e,t)=>e.DisplayIndex-t.DisplayIndex).forEach(e=>{this.ColumnSource.push(e)})),this.AssignValues()}if(this.Parent.ScreenObject.Preferences.ContainsKey("MandatoryScanning")&&""!=this.Parent.ScreenObject.Preferences.MandatoryScanning.toString()&&Object(n.j)(this.Parent.ScreenObject.Preferences.MandatoryScanning)||this.Parent.ScreenObject.Preferences.ContainsKey("EnableScanning")&&""!=this.Parent.ScreenObject.Preferences.EnableScanning.toString()&&Object(n.j)(this.Parent.ScreenObject.Preferences.EnableScanning)){this.ScanText.Visible=!0,this.ScanText.SetFocus=!0,this.GridObj.TableColumns.push("ScanProduct"),this.GridObj.TableColumns.push("ScannedBarcodes"),t=new c.a,t.Header="Scan Product",t.DisplayMember="ScanProduct",t.DataType="TextBlock",t.Width=100,t.ReadOnly=!1,this.ColumnSource.push(t),this.Parent.ScreenObject.Preferences.ContainsKey("MandatoryScanning")&&""!=this.Parent.ScreenObject.Preferences.MandatoryScanning.toString()&&Object(n.j)(this.Parent.ScreenObject.Preferences.MandatoryScanning)&&(d=this.ColumnSource.find(e=>null!=e.DisplayMember&&"TobeUsed"==e.DisplayMember))&&(d.ReadOnly=!0);for(let e=0;e<this.GridData.length;e++)a.e.IsEmpty(this.GridData[e].ProductID_Key)||(this.GridData[e].TobeUsed=null)}else this.ScanText.Visible=!1;if(this.Parent.ScreenObject.Preferences.ContainsKey("ScanPack")&&""!=this.Parent.ScreenObject.Preferences.ScanPack.toString()&&Object(n.j)(this.Parent.ScreenObject.Preferences.ScanPack)){var d;this.ScanText.Visible=!0,(d=this.ColumnSource.find(e=>null!=e.DisplayMember&&"TobeUsed"==e.DisplayMember))&&(d.ReadOnly=!0);for(let e=0;e<this.GridData.length;e++)a.e.IsEmpty(this.GridData[e].ProductID_Key)||(this.GridData[e].TobeUsed=null);this.AddGridVisbility=!0,t=new c.a,t.Header="#",t.DisplayMember="Sno",t.DataType="TextBlock",t.Width=25,t.ReadOnly=!0,this.AddedColumnSource.push(t),t=new c.a,t.Header="Pending Packs",t.DisplayMember="PackName",t.DataType="TextBlock",t.Width=100,t.ReadOnly=!0,this.AddedColumnSource.push(t),t=new c.a,t.Header="Label",t.DisplayMember="Packs",t.DataType="TextBlock",t.Width=100,t.ReadOnly=!0,this.AddedColumnSource.push(t),this.AddedGridObj.TableColumns.push("Sno"),this.AddedGridObj.TableColumns.push("Packs"),this.AddedGridObj.TableColumns.push("RefID"),this.AddedGridObj.TableColumns.push("PackName"),this.FillPacks()}this.ScanText.Label="Scan"}sort(){this.Parent.ScreenObject.Preferences.ContainsKey("linksortcols")&&""!=this.Parent.ScreenObject.Preferences.linksortcols&&(this.Parent.ScreenObject.Preferences.linksortcols.split(",").forEach(e=>{let t=e.Replace(" ASC","").Replace(" DESC","");if(t.startsWith("sort_")){let e=t.Replace("sort_","");if(this.GridObj.TableColumns.Contains(e)){this.GridObj.TableColumns.push("tempcolname");for(let s=0;s<this.GridData.length;s++)!a.e.IsEmpty(this.GridData[s][e])&&a.e.Double(this.GridData[s][e])>0&&(this.GridData[s][t]=parseFloat(this.GridData[s][e].toString()))}else this.GridObj.TableColumns.push(e)}else this.GridObj.TableColumns.Contains(t)||this.GridObj.TableColumns.push(t)}),this.RefreshSno())}RemovePack(e){let t=this.AddGridData.filter(t=>t.Packs==e);if(t.length>0){this.AddGridData.Remove(t[0]);let e=1;for(let t=0;t<this.AddGridData.length;t++)this.AddGridData[t].Sno=e.toString(),e++}}FillPacks(){let e,t=this.Parent.ScreenObject.GetScannedPacks(this.VoucherNo);if(null!=t&&t.Tables.length>0&&t.Columns[0].Contains("label"))for(let i=0;i<t.Tables[0].length;i++)null==this.packs&&(this.packs=[]),this.packs.Contains(t.Tables[0][i].label.toString())||this.packs.push(t.Tables[0][i].label.toString());if(null!=this.Parent.DtPack&&this.Parent.DtPack.length>0){null==this.packs&&(this.packs=[]);for(let e=0;e<this.Parent.DtPack.length;e++)a.e.IsEmpty(this.Parent.DtPack[e].Label)||this.packs.push(this.Parent.DtPack[e].Label.toString())}null==this.packs&&(this.packs=[]);let s="";for(let i=0;i<this.GridData.length;i++)e=this.ds.Tables[13].filter(e=>2==e.Type&&e.InvDocDetailsID==this.GridData[i].DocDetailsID),e.length>0&&e.forEach(e=>{if(!this.packs.Contains(e.Label.toString())&&0==this.AddGridData.filter(t=>t.Packs==e.Label.toString()).length){let t=this.AddedGridObj.NewRow();t.Sno=this.AddGridData.length+1,t.Packs=e.Label.toString(),t.RefID=e.RefID.toString(),s.Contains(","+e.RefID.toString()+",")||(s+=e.RefID.toString()+","),this.AddedGridObj.addRow(t)}});if(""!=s&&i.a.SessionManager.Preferences.ContainsKey("PackDimension")){let e=this.Parent.ScreenObject.GetdimensionNames(i.a.SessionManager.Preferences.PackDimension,s.substr(0,s.length-1));if(null!=e&&e.Tables.length>0&&!this.ds.Columns[0].Contains("ErrorMessage"))for(let t=0;t<this.AddGridData.length;t++){let s=e.Tables[0].filter(e=>e.NodeID==this.AddGridData[t].RefID);s.length>0&&(this.AddGridData[t].PackName=s[0][e.Columns[0][1]].toString())}}}AssignValues(){let e=0,t=this.Parent.ScreenObject.Preferences.DimensionWise;null!=t&&null!=t&&""!==t||(e=0),e=isNaN(t)?0:parseInt(t);let s=1;if(e>0)if(3==e)for(let i=0;i<this.Parent.ScreenObject._TextFields.length;i++){let t=this.Parent.ScreenObject._TextFields[i];if(t instanceof u.b&&t.CCID==e){t.SelectedValue>0&&(s=t.SelectedValue);break}}else if(e>5e4)for(let i=0;i<this.Parent.ScreenObject._CCFields.length;i++){let t=this.Parent.ScreenObject._CCFields[i];if(t instanceof u.b&&t.CCID==e){t.SelectedValue>0&&(s=t.SelectedValue);break}}this.ds.Columns[0].push("Executed");let r="",o="2";i.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=i.a.SessionManager.Preferences.DecimalsinQty&&(o=i.a.SessionManager.Preferences.DecimalsinQty);let l=this.ds.Columns[0][1];if(this.ds.Tables[0].length>0&&!a.e.IsEmpty(this.ds.Tables[0][0][l])&&this.Parent.ScreenObject.GridDataColumns.Contains(this.ds.Tables[0][0][l])){var h=this.Parent.ScreenObject.ColumnSource.find(e=>e.DisplayMember.toLowerCase()==this.ds.Tables[0][0][l].toLowerCase());h&&""!=h.DecimalPoints&&(o=h.DecimalPoints)}for(let d=0;d<this.ds.Tables[0].length;d++){if(!a.e.IsEmpty(this.ds.Tables[0][d].DynamicInvDocDetailsID)&&a.e.IsValidID(parseInt(this.ds.Tables[0][d].DynamicInvDocDetailsID)))continue;if(this.Parent.ScreenObject.Preferences.ContainsKey("LinkOnlyFreeQTY")&&Object(n.j)(this.Parent.ScreenObject.Preferences.LinkOnlyFreeQTY)&&this.ds.Columns[0].Contains("IsQtyFreeOffer")&&a.e.DoubleTryParse(this.ds.Tables[0][d].IsQtyFreeOffer)>0&&!(this.ds.Columns[0].Contains("ParentSchemeID")&&a.e.IntTryParse(this.ds.Tables[0][d].ParentSchemeID)>0))continue;if(3==e){if(this.ds.Columns[0].Contains("ProductColName")&&!a.e.IsEmpty(this.ds.Tables[0][d].ProductColName)&&this.ds.Columns[3].Contains(this.ds.Tables[0][d].ProductColName.toString())&&!a.e.IsEmpty(this.ds.Tables[3][d][this.ds.Tables[0][d].ProductColName.toString()])&&a.e.IsNum(this.ds.Tables[3][d][this.ds.Tables[0][d].ProductColName.toString()])&&parseInt(this.ds.Tables[3][d][this.ds.Tables[0][d].ProductColName])!=s){this.ds.Tables[0].RemoveAt(d),this.ds.Tables[1].RemoveAt(d),this.ds.Tables[2].RemoveAt(d),this.ds.Tables[3].RemoveAt(d),d--;continue}}else if(e>0&&this.ds.Columns[1].Contains("dcCCNID"+(e-5e4))&&!a.e.IsEmpty(this.ds.Tables[1][d]["dcCCNID"+(e-5e4)])&&parseInt(this.ds.Tables[1][d]["dcCCNID"+(e-5e4)])!=s){this.ds.Tables[0].RemoveAt(d),this.ds.Tables[1].RemoveAt(d),this.ds.Tables[2].RemoveAt(d),this.ds.Tables[3].RemoveAt(d),d--;continue}if(!a.e.IsEmpty(this.ds.Tables[0][d].ProductID)&&0==parseInt(this.ds.Tables[0][d].ProductID)&&0==this.ds.Tables[0].filter(e=>e.DynamicInvDocDetailsID==this.ds.Tables[0][d].DocDetailsID).length){this.ds.Tables[0].RemoveAt(d),this.ds.Tables[1].RemoveAt(d),this.ds.Tables[2].RemoveAt(d),this.ds.Tables[3].RemoveAt(d),d--;continue}let t=0,l=this.GridObj.NewRow();if(l.DocSeqNo=this.GridData.length+1,l.Select=!1,l.DocDetailsID=this.ds.Tables[0][d].DocDetailsID,l.ProductType=this.ds.Tables[0][d].ProductTypeID,"5"==l.ProductType.toString()&&this.ds.Tables.length>5&&this.ds.Columns[5].Contains("InvDocDetailsID")){let e=this.ds.Tables[5].filter(e=>e.InvDocDetailsID==l.DocDetailsID||e.DynamicInvDocDetailsID==this.ds.Tables[0][d].DocDetailsID);if(e.length>0&&(l.BatchNo=e[0].BatchNumber.toString(),l.BatchCode=e[0].BatchCode.toString()),e.length>1){for(let s=0;s<e.length;s++)t+=parseFloat(e[s].Quantity);this.ds.Tables[0][d][0]=t}}if(l.ProductName=this.ds.Tables[0][d].ProductName.toString(),l.ProductCode=this.ds.Tables[0][d].ProductCode.toString(),l.ProductID_Key=this.ds.Tables[0][d].ProductID.toString(),l.linkFieldName=this.ds.Tables[0][d][this.ds.Columns[0][1]].toString(),this.GridObj.TableColumns.Contains("VoucherNo")&&(l.VoucherNo=this.ds.Tables[0][d].VoucherNo.toString()),r.length>0&&(r+=","),r+=this.ds.Tables[0][d].ProductID.toString(),t>0)l.Balance=t.ToString("N"+o),l.TobeUsed=t.ToString("N"+o),l.Executed=(0).ToString("N"+o),l[this.ds.Tables[0][d][this.ds.Columns[0][1]].toString()]=t.ToString("N"+o);else{let e=this.ds.Columns[0][3],t=this.Parent.ScreenObject.GridData.filter(e=>e.LinkedInvDocDetailsID==this.ds.Tables[0][d].DocDetailsID);if(t.length>0&&this.Parent.ScreenObject.GridDataColumns.Contains(this.ds.Tables[0][d][e].toString())){let s=0;for(let r=0;r<t.length;r++)a.e.IsNum(t[r][this.ds.Tables[0][d][e]])&&(s+=parseFloat(t[r][this.ds.Tables[0][d][e].toString()]));let i=this.ds.Columns[0][0];if(!(a.e.IsNum(this.ds.Tables[0][d][i])&&parseFloat(this.ds.Tables[0][d][i])-s>0)){this.ds.Tables[0].RemoveAt(d),this.ds.Tables[1].RemoveAt(d),this.ds.Tables[2].RemoveAt(d),this.ds.Tables[3].RemoveAt(d),d--;continue}l.Balance=parseFloat(parseFloat(this.ds.Tables[0][d][i]).ToString("N"+o))-s,l.TobeUsed=parseFloat(parseFloat(this.ds.Tables[0][d][i]).ToString("N"+o))-s;let n=this.ds.Columns[0][1];this.ds.Columns[0].Contains(this.ds.Tables[0][d][n].toString())?l[this.ds.Tables[0][d][n].toString()]=this.ds.Tables[0][d][this.ds.Tables[0][d][n].toString()].toString():this.ds.Columns[2].Contains(this.ds.Tables[0][d][n].toString())&&(l[this.ds.Tables[0][d][n].toString()]=this.ds.Tables[2][d][this.ds.Tables[0][d][n].toString()].toString()),this.Parent.ScreenObject.Preferences.ContainsKey("Checkpackedqty")&&"true"==this.Parent.ScreenObject.Preferences.Checkpackedqty.toLowerCase()&&"true"==this.ds.Tables[0][d].IsPacking.toString().toLowerCase()?(null!=(c=this.ds.Tables[13].filter(e=>2==e.Type&&e.InvDocDetailsID==this.ds.Tables[0][d].DocDetailsID).Compute("sum","Quantity"))&&null!=c||(c=0),l.Executed=(parseFloat(c)-parseFloat(l.Balance)).ToString("N"+o),this.ds.Tables[0][d].Executed=l.Executed):a.e.IsEmpty(l.Balance)||a.e.IsEmpty(l[this.ds.Tables[0][d][n]])||(l.Executed=parseFloat(parseFloat(l[this.ds.Tables[0][d][n].toString()]).ToString("N"+o))-parseFloat(l.Balance),this.ds.Tables[0][d].Executed=l.Executed)}else{let e=this.ds.Columns[0][0],t=this.ds.Columns[0][1];var c;l.Balance=parseFloat(this.ds.Tables[0][d][e]).ToString("N"+o),l.TobeUsed=parseFloat(this.ds.Tables[0][d][e]).ToString("N"+o),this.ds.Columns[0].Contains(this.ds.Tables[0][d][t].toString())?l[this.ds.Tables[0][d][t].toString()]=this.ds.Tables[0][d][this.ds.Tables[0][d][t].toString()].toString():this.ds.Columns[2].Contains(this.ds.Tables[0][d][t].toString())&&(l[this.ds.Tables[0][d][t].toString()]=this.ds.Tables[2][d][this.ds.Tables[0][d][t].toString()].toString()),this.Parent.ScreenObject.Preferences.ContainsKey("Checkpackedqty")&&"true"==this.Parent.ScreenObject.Preferences.Checkpackedqty.toLowerCase()&&"true"==this.ds.Tables[0][d].IsPacking.toString().toLowerCase()?(null!=(c=this.ds.Tables[13].filter(e=>2==e.Type&&e.InvDocDetailsID==this.ds.Tables[0][d].DocDetailsID).Compute("sum","Quantity"))&&null!=c||(c=0),l.Executed=(parseFloat(c)-parseFloat(l.Balance)).ToString("N"+o),this.ds.Tables[0][d].Executed=l.Executed):a.e.IsEmpty(l.Balance)||a.e.IsEmpty(l[this.ds.Tables[0][d][t]])||(l.Executed=(parseFloat(l[this.ds.Tables[0][d][t].toString()])-parseFloat(l.Balance)).ToString("N"+o),this.ds.Tables[0][d].Executed=l.Executed)}}for(let e=0;e<this.DynamicColumnSource.length;e++)if(4!=this.DynamicColumnSource[e].SectionID&&"LinkedInvDocDetailsID"!=this.DynamicColumnSource[e].DisplayMember&&"RefNo"!=this.DynamicColumnSource[e].DisplayMember&&"LinkedFieldName"!=this.DynamicColumnSource[e].DisplayMember&&!this.DynamicColumnSource[e].DisplayMember.toLowerCase().Contains("dccurrid")&&!this.DynamicColumnSource[e].DisplayMember.toLowerCase().Contains("dcexchrt"))if(this.DynamicColumnSource[e].IsColumnUserDefined)if("SELECTIONBOX"==this.DynamicColumnSource[e].DataType)this.ds.Columns[3].Contains(this.DynamicColumnSource[e].DisplayMember)&&(l[this.DynamicColumnSource[e].DisplayMember]=this.ds.Tables[3][d][this.DynamicColumnSource[e].DisplayMember]);else if(null!=this.DynamicColumnSource[e].CostCenterID&&this.DynamicColumnSource[e].CostCenterID>0)this.DynamicColumnSource[e].DisplayMember.Contains("TO")?this.ds.Columns[1].Contains(this.DynamicColumnSource[e].DisplayMember.replace("TO",""))&&this.ds.Tables[1].length>d+1&&this.ds.Columns[1].Contains(this.DynamicColumnSource[e].DisplayMember.replace("TO",""))&&(l[this.DynamicColumnSource[e].DisplayMember+"_Key"]=this.ds.Tables[1][d+1][this.DynamicColumnSource[e].DisplayMember.replace("TO","")]):this.ds.Columns[1].Contains(this.DynamicColumnSource[e].DisplayMember)?l[this.DynamicColumnSource[e].DisplayMember+"_Key"]=this.ds.Tables[1][d][this.DynamicColumnSource[e].DisplayMember]:this.DynamicColumnSource[e].DisplayMember.toLowerCase().Contains("alpha")&&this.ds.Tables[3].length>0&&!a.e.IsEmpty(this.ds.Tables[3][d][this.DynamicColumnSource[e].DisplayMember])&&(l[this.DynamicColumnSource[e].DisplayMember+"_Key"]=this.ds.Tables[3][d][this.DynamicColumnSource[e].DisplayMember]);else if(this.DynamicColumnSource[e].DisplayMember.toLowerCase().Contains("dcnum")&&this.ds.Columns[2].Contains(this.DynamicColumnSource[e].DisplayMember))l[this.DynamicColumnSource[e].DisplayMember]=this.ds.Tables[2][d][this.DynamicColumnSource[e].DisplayMember];else if("DATE"==this.DynamicColumnSource[e].DataType){if(this.ds.Columns[3].Contains(this.DynamicColumnSource[e].DisplayMember)&&!a.e.IsEmpty(this.ds.Tables[3][d][this.DynamicColumnSource[e].DisplayMember])){let t="dd/MMM/yyyy";i.a.SessionManager.Preferences.ContainsKey("Date Format")&&""!=i.a.SessionManager.Preferences["Date Format"]&&(t=i.a.SessionManager.Preferences["Date Format"]),l[this.DynamicColumnSource[e].DisplayMember]=new Date(this.ds.Tables[3][d][this.DynamicColumnSource[e].DisplayMember]).ToString(t),l[this.DynamicColumnSource[e].DisplayMember+"_Key"]=new Date(this.ds.Tables[3][d][this.DynamicColumnSource[e].DisplayMember])}}else"ComboBox"==this.DynamicColumnSource[e].DataType?this.ds.Columns[3].Contains(this.DynamicColumnSource[e].ValueBinding)&&(l[this.DynamicColumnSource[e].ValueBinding]=this.ds.Tables[3][d][this.DynamicColumnSource[e].ValueBinding]):this.ds.Columns[3].Contains(this.DynamicColumnSource[e].DisplayMember)&&(l[this.DynamicColumnSource[e].DisplayMember]=this.ds.Tables[3][d][this.DynamicColumnSource[e].DisplayMember]);else if("AccountID_Key"==this.DynamicColumnSource[e].ValueMember||"DebitAmount"==this.DynamicColumnSource[e].DisplayMember||"CreditAmount"==this.DynamicColumnSource[e].DisplayMember){if("AccountID_Key"==this.DynamicColumnSource[e].ValueMember)continue}else if(null!=this.DynamicColumnSource[e].ValueMember&&this.ds.Columns[0].Contains(this.DynamicColumnSource[e].ValueMember.replace("_Key",""))&&("DebitAccount_Key"==this.DynamicColumnSource[e].ValueMember||"CreditAccount_Key"==this.DynamicColumnSource[e].ValueMember)||"Amount"==this.DynamicColumnSource[e].DisplayMember)null!=this.DynamicColumnSource[e].ValueMember&&"DebitAccount_Key"==this.DynamicColumnSource[e].ValueMember&&(l.DebitAccount_KEY=this.ds.Tables[0][d].DebitAccount),null!=this.DynamicColumnSource[e].ValueMember&&"CreditAccount_Key"==this.DynamicColumnSource[e].ValueMember&&(l.CreditAccount_KEY=this.ds.Tables[0][d].CreditAccount),"Amount"==this.DynamicColumnSource[e].DisplayMember&&(l.Amount=i.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(n.j)(i.a.SessionManager.Preferences["Use Foreign Currency"])&&this.ds.Columns[0].Contains("amountfc")?"-"+this.ds.Tables[0][d].amountfc:"-"+this.ds.Tables[0][d].Amount);else if(3==this.DynamicColumnSource[e].CostCenterID&&this.ds.Columns[0].Contains("ProductID"))l[this.DynamicColumnSource[e].ValueMember]=this.ds.Tables[0][d].ProductID;else if("DocSeqNo"!=this.DynamicColumnSource[e].DisplayMember)if("DATE"==this.DynamicColumnSource[e].DataType){if(this.ds.Columns[0].Contains(this.DynamicColumnSource[e].DisplayMember)&&!a.e.IsEmpty(this.ds.Tables[0][d][this.DynamicColumnSource[e].DisplayMember])){let t="dd/MMM/yyyy";i.a.SessionManager.Preferences.ContainsKey("Date Format")&&""!=i.a.SessionManager.Preferences["Date Format"]&&(t=i.a.SessionManager.Preferences["Date Format"]),l[this.DynamicColumnSource[e].DisplayMember]=new Date(this.ds.Tables[0][d][this.DynamicColumnSource[e].DisplayMember]).ToString(t),this.GridObj.TableColumns.Contains(this.DynamicColumnSource[e].DisplayMember+"_Key")&&(l[this.DynamicColumnSource[e].DisplayMember+"_Key"]=new Date(this.ds.Tables[0][d][this.DynamicColumnSource[e].DisplayMember]))}}else if("gross"==this.DynamicColumnSource[e].DisplayMember.toLowerCase()){if(this.ds.Columns[0].Contains(this.DynamicColumnSource[e].DisplayMember)){let t=this.ds.Columns[0][0];"quantity"!=this.ds.Tables[0][d][this.ds.Columns[0][1]].toString().toLowerCase()||a.e.IsEmpty(this.ds.Tables[0][d].quantity)||a.e.IsEmpty(this.ds.Tables[0][d][t])||parseFloat(this.ds.Tables[0][d][t])==parseFloat(this.ds.Tables[0][d].quantity)?l[this.DynamicColumnSource[e].DisplayMember]=this.ds.Tables[0][d][this.DynamicColumnSource[e].DisplayMember]:a.e.IsEmpty(this.ds.Tables[0][d].Rate)||(l[this.DynamicColumnSource[e].DisplayMember]=parseFloat(this.ds.Tables[0][d].Rate)*parseFloat(this.ds.Tables[0][d][t]))}}else"Amount"==this.DynamicColumnSource[e].DisplayMember?this.ds.Columns[0].Contains("Amount")&&(l.Amount=this.ds.Tables[0][d].Amount):"LISTBOX"==this.DynamicColumnSource[e].DataType.toUpperCase()?this.ds.Columns[0].Contains(this.DynamicColumnSource[e].DisplayMember)&&(l[this.DynamicColumnSource[e].ValueMember]=this.ds.Tables[0][d][this.DynamicColumnSource[e].DisplayMember]):this.ds.Columns[0].Contains(this.DynamicColumnSource[e].DisplayMember)&&this.GridObj.TableColumns.Contains(this.DynamicColumnSource[e].DisplayMember)&&(l[this.DynamicColumnSource[e].DisplayMember]=this.ds.Tables[0][d][this.DynamicColumnSource[e].DisplayMember]);this.GridObj.addRow(l),this.ds.Columns[0].Contains("DocumentType")&&"5"==this.ds.Tables[0][d].DocumentType.toString()&&d++}if(r.length>0&&this.GridObj.TableColumns.Contains("QOH")){let e=this.Parent.ScreenObject.GetProductQtyOnHand(r,this.Parent.DocumentDate);if(null!=e&&e.Tables.length>0&&e.Columns[0].Contains("ProductID")){let t=0;for(let s=0;s<e.Tables[0].length;s++){let i=this.GridData.filter(t=>t.ProductID_Key==e.Tables[0][s].ProductID);i.length>1?i.forEach(i=>{t=a.e.DoubleTryParse(e.Tables[0][s].QOH),i.QOH=t.ToString("N"+o)}):i.length>0&&(t=a.e.DoubleTryParse(e.Tables[0][s].QOH),i[0].QOH=t.ToString("N"+o))}}}this.RefreshGrid=!0}GenerateColumns(e,t){let s,r=0,o=this.ds.Tables[6];o.sort((e,t)=>e.SectionID-t.SectionID),o.sort((e,t)=>e.SectionSeqNumber-t.SectionSeqNumber);for(let u=0;u<o.length;u++){s=new c.a,s.Header=o[u].UserColumnName,s.DisplayMember=o[u].SysColumnName,s.DataType=o[u].ColumnDataType,s.Width=100,s.ValueMember="LISTBOX"==s.DataType?o[u].SysColumnName.toString()+"_Key":o[u].SysColumnName.toString(),a.e.IsEmpty(o[u].IsColumnUserDefined)||(s.IsColumnUserDefined=Object(n.j)(o[u].IsColumnUserDefined)),null==o[u].ColumnCostCenterID||a.e.IsEmpty(o[u].ColumnCostCenterID)||(s.CostCenterID=parseInt(o[u].ColumnCostCenterID)),s.ReadOnly=!0;var l=t.find(e=>e.DisplayMember==s.DisplayMember);if(l?(s.DisplayIndex=l.DisplayIndex,s.Width=l.Width):s.DisplayIndex=100,0==e.filter(e=>e.ValueMember==s.ValueMember&&"LISTBOX"==e.DataType||e.DisplayMember==s.DisplayMember&&"LISTBOX"!=e.DataType).length){let t=o[u];if(!this.GridObj.TableColumns.Contains(s.DisplayMember))switch(this.DynamicColumnSource.push(s),"grossfc"==s.DisplayMember.toLowerCase()&&(r=this.ColumnSource.length),r>0&&"rate"==s.DisplayMember.toLowerCase()?e.InsertAt(s,r):e.push(s),t.ColumnDataType.toString().toUpperCase()){case"BIGINT":this.GridObj.TableColumns.push(t.SysColumnName),s.ShowTotal=!1;break;case"INT":this.GridObj.TableColumns.push(t.SysColumnName),s.ShowTotal=!0;break;case"FLOAT":if(this.GridObj.TableColumns.push(t.SysColumnName),t.SysColumnName.toString().toLowerCase().Contains("dcnum")){s.DefaultValue=t.UserDefaultValue.toString(),this.GridObj.TableColumns.push("dcCalc"+t.SysColumnName);var d=this.Parent.ScreenObject.ColumnSource.find(e=>e.DisplayMember==t.SysColumnName);d?s.DecimalPoints=d.DecimalPoints:i.a.SessionManager.Preferences.ContainsKey("DecimalsinExtraFields")&&""!=i.a.SessionManager.Preferences.DecimalsinExtraFields&&(s.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinExtraFields)}else t.SysColumnName.toString().toLowerCase().Contains("dcexchrt")||("Quantity"==t.SysColumnName.toString()?(this.GridObj.TableColumns.push("Linked"+t.SysColumnName.toString()),i.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=i.a.SessionManager.Preferences.DecimalsinQty&&(s.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinQty)):"Gross"==t.SysColumnName.toString()||"grossfc"==t.SysColumnName.toString().toLowerCase()||"Rate"==t.SysColumnName.toString()?("Gross"==t.SysColumnName.toString()&&this.GridObj.TableColumns.push("Linked"+t.SysColumnName.toString()),i.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=i.a.SessionManager.Preferences.DecimalsinRate&&(s.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinRate)):"Amount"!=t.SysColumnName.toString()&&"DebitAmount"!=t.SysColumnName.toString()&&"CreditAmount"!=t.SysColumnName.toString()||!i.a.SessionManager.Preferences.ContainsKey("DecimalsinAmount")||""==i.a.SessionManager.Preferences.DecimalsinAmount||(s.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinAmount));t.SysColumnName.toString().toLowerCase().Contains("dcexchrt")||"exchangerate"==t.SysColumnName.toString().toLowerCase()||(s.ShowTotal=!0);break;case"LISTBOX":s.ValueMember=t.SysColumnName.toString()+"_Key","unit"==t.SysColumnName.toString().toLowerCase()?(this.GridObj.TableColumns.push(t.SysColumnName.toString()),this.GridObj.TableColumns.push(t.SysColumnName.toString()+"_Key"),this.GridObj.TableColumns.push("UOMConversion"),this.GridObj.TableColumns.push("UOMConvertedQty")):"productid"==t.SysColumnName.toString().toLowerCase()?(s.ValueMember="ProductID_Key",s.DisplayMember=t.UserColumnName.toString().Replace(" ",""),this.GridObj.TableColumns.Contains(s.DisplayMember)||this.GridObj.TableColumns.push(s.DisplayMember),this.GridObj.TableColumns.Contains(s.ValueMember)||this.GridObj.TableColumns.push(s.ValueMember)):"accountid"==t.SysColumnName.toString().toLowerCase()||"debitaccount"==t.SysColumnName.toString().toLowerCase()||"creditaccount"==t.SysColumnName.toString().toLowerCase()?(s.DisplayMember=t.UserColumnName.toString().Replace(" ",""),this.GridObj.TableColumns.push(s.DisplayMember),this.GridObj.TableColumns.Contains(s.ValueMember)||this.GridObj.TableColumns.push(s.ValueMember)):(this.GridObj.TableColumns.push(t.SysColumnName.toString()),this.GridObj.TableColumns.push(t.SysColumnName.toString()+"_Key")),s.CostCenterID=parseInt(t.ColumnCostCenterID),s.TypeID=parseInt(t.ColumnCCListViewTypeID),"ProductID_Key"!=s.ValueMember&&"AccountID"!=s.DisplayMember&&"CreditAccount"!=s.DisplayMember&&"DebitAccount"!=s.DisplayMember||(s.FilterCondition=t.UserProbableValues.toString()),i.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==i.a.SessionManager.Preferences.EnableDivisionWise.toString()&&50001==s.CostCenterID&&(s.ReadOnly=!0),i.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==i.a.SessionManager.Preferences.EnableLocationWise.toString()&&50002==s.CostCenterID&&(s.ReadOnly=!0);break;case"TEXT":case"STRING":if(this.GridObj.TableColumns.push(t.SysColumnName.toString()),s.IsColumnUserDefined)if("Date"==t.UserColumnType.toString())s.DataType="DATE",this.GridObj.TableColumns.push(t.SysColumnName.toString()+"_Key");else if("Numeric"==t.UserColumnType.toString())s.DataType="FLOAT";else if("LISTBOX"==t.UserColumnType.toString())s.DataType="LISTBOX",s.ValueMember=t.SysColumnName.toString()+"_Key",this.GridObj.TableColumns.push(t.SysColumnName.toString()+"_Key"),s.CostCenterID=parseInt(t.ColumnCostCenterID),s.TypeID=parseInt(t.ColumnCCListViewTypeID);else if("Combobox"==t.UserColumnType.toString()){s.ValueBinding=t.SysColumnName.toString(),s.DataType="ComboBox",s.DisplayMember="Name",s.ValueMember="Value";let e=[],i=t.UserProbableValues.toString().Trim();if(i.length>0){let t=i.split(";");for(let s=0;s<t.length;s++)e.push(h.d.ComboBoxItems_2(t[s],t[s]))}s.ComboData=e}break;case"DATE":s.DataType="DATE",this.GridObj.TableColumns.push(t.SysColumnName.toString()),this.GridObj.TableColumns.push(t.SysColumnName.toString()+"_Key");break;case"":s.DataType="TextBlock",this.GridObj.TableColumns.push(t.SysColumnName.toString())}}}}OnBeginEdit(e){let t=e.args;if("DataGridPactListBoxColumn"==t.column.className){let e=t.column.DgCol,s=t.item;if(11==e.CostCenterID){let t="";this.GridObj.TableColumns.Contains("ProductID_Key")&&(t=s.ProductID_Key.toString());let i=" (BaseID IN ";i+=" (SELECT     BaseID ",i+=" FROM          COM_UOM AS COM_UOM_1 with(nolock) ",i=i+" WHERE      (UOMID =(select UOMID from inv_product with(nolock) where productid="+t+") ))) ",""==t&&(i=" (BaseID IN ",i+=" (SELECT     BaseID ",i+=" FROM          COM_UOM AS COM_UOM_1 with(nolock) ",i+=" WHERE      (UOMID =-1 ))) "),e.FilterCondition=i}}}ValidateQty(e){if(this.GridObj.TableColumns.Contains("Gross")){let t;this.GridObj.TableColumns.Contains("Rate")?a.e.IsEmpty(e.TobeUsed)||a.e.IsEmpty(e.Rate)||(e.Gross=parseFloat(e.TobeUsed)*parseFloat(e.Rate)):(t=this.ds.Tables[0].filter(t=>t.DocDetailsID==e.DocDetailsID),t.length>0&&(a.e.IsEmpty(e.TobeUsed)||a.e.IsEmpty(t[0].Rate)||(e.Gross=parseFloat(e.TobeUsed)*parseFloat(t[0].Rate)))),t=this.ds.Tables[0].filter(t=>t.DocDetailsID==e.DocDetailsID),t.length>0&&this.ds.Columns[0].Contains("ExchangeRate")&&!a.e.IsEmpty(t[0].ExchangeRate)&&(e.Gross=parseFloat(e.Gross)*parseFloat(t[0].ExchangeRate)),this.GridObj.updateRow(e)}if(this.GridObj.TableColumns.Contains("GrossFc")){if(this.GridObj.TableColumns.Contains("Rate"))a.e.IsEmpty(e.TobeUsed)||a.e.IsEmpty(e.Rate)||(e.GrossFc=parseFloat(e.TobeUsed)*parseFloat(e.Rate));else{let t=this.ds.Tables[0].filter(t=>t.DocDetailsID==e.DocDetailsID);t.length>0&&(a.e.IsEmpty(e.TobeUsed)||a.e.IsEmpty(t[0].Rate)||(e.GrossFc=parseFloat(e.TobeUsed)*parseFloat(t[0].Rate)))}this.GridObj.updateRow(e)}}OnCellEditEnding(e){let t=e.item,s=e.column.field;if("ScanProduct"==s&&!a.e.IsEmpty(t.ScanProduct)&&!a.e.IsEmpty(t.ProductID_Key))throw this.onScan(t.ScanProduct.toString(),t),new Error("PactException");if("TobeUsed"==s&&"quantity"==t.linkFieldName.toString().toLowerCase())this.ValidateQty(t);else if("UOMID"!=s||a.e.IsEmpty(t.UOMID_Key)){if(this.JobNodeID>0&&"Value"==s&&!a.e.IsEmpty(t.Value)){if(this.Parent.ScreenObject.IsPurchase&&null!=this.IO.SelectedValue&&"Output"==this.IO.SelectedValue&&i.a.SessionManager.Preferences.ContainsKey("DoNotReceiveMoreThanJobQty")&&"true"==i.a.SessionManager.Preferences.DoNotReceiveMoreThanJobQty.toLowerCase()&&a.e.IsNum(t.Qty)&&a.e.IsNum(t.Used)&&a.e.IsNum(t.Value)&&parseFloat(t.Value)+parseFloat(t.Used)>parseFloat(t.Qty))return void(this.DisplayMessage="Can not Receive more Job Qty");if(this.Parent.ScreenObject.IsPurchase&&null!=this.IO.SelectedValue&&"Output"==this.IO.SelectedValue&&this.Parent.ScreenObject.Preferences.ContainsKey("DoNotReceiveMoreThanJobQty")&&"true"==this.Parent.ScreenObject.Preferences.DoNotReceiveMoreThanJobQty.toLowerCase()){if(a.e.IsNum(t.Qty)&&a.e.IsNum(t.Used)&&a.e.IsNum(t.Value)&&parseFloat(t.Value)+parseFloat(t.Used)>parseFloat(t.Qty))return t.Value=parseFloat(t.Qty)-parseFloat(t.Used),void(this.DisplayMessage="Can not Receive more Job Qty")}else if(!this.Parent.ScreenObject.IsPurchase&&i.a.SessionManager.Preferences.ContainsKey("DoNotIssueMoreThanJobQty")&&"true"==i.a.SessionManager.Preferences.DoNotIssueMoreThanJobQty.toLowerCase()&&a.e.IsNum(t.Net)&&a.e.IsNum(t.Used)&&a.e.IsNum(t.Value)&&parseFloat(t.Value)+parseFloat(t.Used)>parseFloat(t.Net))return t.Value=parseFloat(t.Net)-parseFloat(t.Used),void(this.DisplayMessage="Can not Issue more Job Qty")}}else{let e=this.Parent.ScreenObject.GetConversion(t.UOMID_Key.toString());if(e>0){let s=0;a.e.IsNum(t.Qty)&&(s=parseFloat(t.Qty),t.Qty=(s*parseFloat(t.BaseConversion)/e).ToString("N"+this.decimalpoints)),a.e.IsNum(t.Used)&&(s=parseFloat(t.Used),t.Used=(s*parseFloat(t.BaseConversion)/e).ToString("N"+this.decimalpoints)),a.e.IsNum(t.Balance)&&(s=parseFloat(t.Balance),t.Balance.toString()==t.Value.toString()?(t.Balance=(s*parseFloat(t.BaseConversion)/e).ToString("N"+this.decimalpoints),t.Value=t.Balance):t.Balance=(s*parseFloat(t.BaseConversion)/e).ToString("N"+this.decimalpoints)),t.BaseConversion=e,this.GridObj.updateRow(t)}}}OnClick(e){}AddtempProd(e){var t=this.Parent.ScreenObject.ColumnSource.find(e=>null!=e.ValueMember&&"productid_key"==e.ValueMember.toLowerCase());if(t&&null!=t.DefaultValue&&""!=t.DefaultValue&&null!=t.DefaultValueText&&a.e.IntTryParse(t.DefaultValue)>0){let s=t.DefaultValueText.split("\x11");e.ProductID_Key=t.DefaultValue,this.Parent.ScreenObject.GridDataColumns.Contains("ProductCode")&&s.length>1&&(e.ProductCode=s[1]),this.Parent.ScreenObject.GridDataColumns.Contains("ProductName")&&s.length>0&&(e.ProductName=s[0]),this.Parent.AddProductData(e,!1,!1)}}SelectAllBoms(){this.Boms.Items.forEach(e=>{this.Boms.SelectedValue=e.Value,this.SelectAllStages()})}SelectAllStages(){this.Stages.Items.forEach(e=>{this.Stages.SelectedValue=e.Value,this.GridData.forEach(e=>{a.e.IsEmpty(e.Select)||(e.Select=!0)}),this.OnSave("Add")})}RefreshSno(){let e=1;this.GridObj.Table.forEach(t=>{t.DocSeqNo=e,this.GridObj.updateRow(t),e++})}OnSave(e){if("qtychanged"==e.toString())this.CalcQty();else if("RemQTY"==e.toString())this.CalcRemQty();else if("Sort"==e.toString());else if("AllBoms"==e.toString())this.SelectAllBoms();else if("AllStages"==e.toString())this.SelectAllStages();else if("Add"==e.toString()){let e=0;for(let t=0;t<this.GridData.length;t++)if(!a.e.IsEmpty(this.GridData[t].Select)&&Object(n.j)(this.GridData[t].Select)){e++,this.GridData[t].Select=!1;let s=this.AddedGridObj.NewRow();if(s.StageNodeID=this.GridData[t].StageNodeID,s.StageID=this.GridData[t].StageID,s.BomID=this.Boms.SelectedValue,s.BomNodeID=this.Boms.SelectedItem.Aliasname,s.StageName=this.GridData[t].StageName,s.BomName=this.Boms.GetText(),1==e&&this.AddedGridObj.TableColumns.Contains("RemainingQty")&&!a.e.IsEmpty(this.RemQTY.Text)&&(s.RemainingQty=this.RemQTY.Text),null==this.Stages.SelectedItem||a.e.IsEmpty(this.Stages.SelectedItem.Aliasname)||(this.AddedGridObj.TableColumns.Contains("DimID")||this.AddedGridObj.TableColumns.push("DimID"),s.DimID=this.Stages.SelectedItem.Aliasname),s.BatchSize=this.GridData[t].BatchSize,s.OPQTY=this.GridData[t].OPQTY,s.IPQTY=this.GridData[t].IPQTY,36==this.Parent.ScreenObject.DocumentType)s.Cost=this.GridData[t].Cost,s.Hrs=this.GridData[t].Hrs,s.MachineID=this.GridData[t].MachineID,s.Machine=this.GridData[t].Machine,s.CrAccountID=this.GridData[t].CrAccountID,s.CrAccount=this.GridData[t].CrAccount,s.DrAccountID=this.GridData[t].DrAccountID,s.DrAccount=this.GridData[t].DrAccount,a.e.IsEmpty(s.Cost)||a.e.IsEmpty(s.Hrs)||(s.Value=parseFloat(s.Cost)*parseFloat(s.Hrs)),this.GridObj.TableColumns.Contains("MachineDim1")&&!a.e.IsEmpty(this.GridData[t].MachineDim1)&&(s.MachineDim1=this.GridData[t].MachineDim1.toString()),this.GridObj.TableColumns.Contains("MachineDim2")&&!a.e.IsEmpty(this.GridData[t].MachineDim2)&&(s.MachineDim2=this.GridData[t].MachineDim2.toString());else if(37==this.Parent.ScreenObject.DocumentType)s.Name=this.GridData[t].Name.toString(),s.Credit=this.GridData[t].Credit.toString(),s.CreditAccountID=this.GridData[t].CreditAccountID,s.DebitAccountID=this.GridData[t].DebitAccountID,s.Debit=this.GridData[t].Debit,s.Value=this.GridData[t].Value;else if(s.Qty=this.GridData[t].Value,s.ActualQty=this.GridData[t].Qty,s.ProductName=this.GridData[t].ProductName.toString(),s.ProductCode=this.GridData[t].ProductCode.toString(),s.ProductID_Key=this.GridData[t].ProductID_Key,s.ProductType=this.GridData[t].ProductType,s.UOMID=this.GridData[t].UOMID,s.UOMID_Key=this.GridData[t].UOMID_Key,s.AutoStage=this.GridData[t].AutoStage,s.UnitPrice=this.GridData[t].UnitPrice,s.Remarks=a.e.StringValue(this.GridData[t].Remarks),this.Parent.ScreenObject.IsPurchase&&null!=this.IO.SelectedValue&&"Output"==this.IO.SelectedValue?s.IsOutput="1":this.Parent.ScreenObject.IsPurchase||a.e.IsEmpty(this.RemQTY.Text)||(s.RemQty=this.RemQTY.Text),this.Parent.ScreenObject.IsPurchase&&null!=this.IO.SelectedValue&&"Output"==this.IO.SelectedValue&&(i.a.SessionManager.Preferences.ContainsKey("DoNotReceiveMoreThanJobQty")&&"true"==i.a.SessionManager.Preferences.DoNotReceiveMoreThanJobQty.toLowerCase()||this.Parent.ScreenObject.Preferences.ContainsKey("DoNotReceiveMoreThanJobQty")&&"true"==this.Parent.ScreenObject.Preferences.DoNotReceiveMoreThanJobQty.toLowerCase())){if(a.e.IsNum(this.GridData[t].Qty)&&a.e.IsNum(this.GridData[t].BaseConversion)&&(s.Net=parseFloat(this.GridData[t].Qty)*parseFloat(this.GridData[t].BaseConversion)),a.e.IsNum(this.GridData[t].Qty)&&a.e.IsNum(this.GridData[t].Used)&&a.e.IsNum(this.GridData[t].Value)&&parseFloat(this.GridData[t].Value)+parseFloat(this.GridData[t].Used)>parseFloat(this.GridData[t].Qty))return void(this.DisplayMessage="Can not Receive more Job Qty at Row:"+(t+1))}else if(!this.Parent.ScreenObject.IsPurchase&&i.a.SessionManager.Preferences.ContainsKey("DoNotIssueMoreThanJobQty")&&"true"==i.a.SessionManager.Preferences.DoNotIssueMoreThanJobQty.toLowerCase()){let e=0,s=0,i=1;a.e.IsNum(this.GridData[t].BaseConversion)&&(i=parseFloat(this.GridData[t].BaseConversion)),a.e.IsNum(this.GridData[t].Net)&&(e=parseFloat(this.GridData[t].Net)),a.e.IsNum(this.GridData[t].Used)&&(e-=parseFloat(this.GridData[t].Used)),e*=i,a.e.IsNum(this.GridData[t].Value)&&(s=parseFloat(this.GridData[t].Value)),s*=i;let n=this.AddGridData.filter(e=>e.ProductID_Key==this.GridData[t].ProductID_Key&&e.StageID==this.GridData[t].StageID&&e.BomID==this.Boms.SelectedValue);for(let t=0;t<n.length;t++)a.e.IsNum(n[t].Qty)&&(s+=parseFloat(n[t].Qty)*i);if(0==this.Parent.ScreenObject.DocID&&(n=this.Parent.ScreenObject.GridDataColumns.Contains("jobID")&&this.Parent.ScreenObject.GridDataColumns.Contains("StageID")&&this.Parent.ScreenObject.GridDataColumns.Contains("BOMID")?this.Parent.ScreenObject.GridData.filter(e=>e.ProductID_Key==this.GridData[t].ProductID_Key&&e.jobID==this.JobNodeID&&e.StageID==this.GridData[t].StageNodeID&&e.BOMID==this.Boms.SelectedItem.Aliasname):this.Parent.ScreenObject.GridDataColumns.Contains("jobID")&&this.Parent.ScreenObject.GridDataColumns.Contains("StageID")?this.Parent.ScreenObject.GridData.filter(e=>e.ProductID_Key==this.GridData[t].ProductID_Key&&e.jobID==this.JobNodeID&&e.StageID==this.GridData[t].StageNodeID):null,null!=n))for(let t=0;t<n.length;t++)a.e.IsNum(n[t].UOMConvertedQty)&&(s+=parseFloat(n[t].UOMConvertedQty));if(s=parseFloat(s.ToString("N"+this.decimalpoints)),e=parseFloat(e.ToString("N"+this.decimalpoints)),s>e)return void(this.DisplayMessage="Can not Issue more Job Qty at Row:"+(t+1))}this.AddedGridObj.addRow(s),this.GridObj.updateRow(this.GridData[t])}this.GridObj.SelectAll.IsChecked=!1}else if("OK"==e.toString()||"OKNoClose"==e.toString()){if(this.JobNodeID>0){if(0==this.AddGridData.length)return void(this.DisplayMessage="Please add atleast one row");let e=0;for(let t=0;t<this.Parent.ScreenObject.GridData.length;t++)if(a.e.IsEmpty(this.Parent.ScreenObject.GridData[t].ProductID_Key)){e=t;break}let h=0,S=0,C=0,y=0,p=0;this.Parent.ScreenObject.Preferences.ContainsKey("JobUnqCCID")&&(p=parseInt(this.Parent.ScreenObject.Preferences.JobUnqCCID)),this.Boms.Items.length>0&&!a.e.IsEmpty(this.Boms.Items[0].Parent)&&"0"!=this.Boms.Items[0].Parent&&a.e.IsNum(this.Boms.Items[0].Parent)?(y=parseInt(this.Boms.Items[0].Parent),this.Parent.ScreenObject.Preferences.ContainsKey("BomCCID")?this.Parent.ScreenObject.Preferences.BomCCID=y:this.Parent.ScreenObject.Preferences.push("BomCCID",y.toString())):y=0,this.ds.Tables.length>2&&this.ds.Tables[2].length>0&&(this.ds.Columns[2].Contains("jobCCID")&&(h=parseInt(this.ds.Tables[2][0].jobCCID)),this.Parent.ScreenObject.Preferences.ContainsKey("jobCCID")?this.Parent.ScreenObject.Preferences.jobCCID=h.toString():this.Parent.ScreenObject.Preferences.push("jobCCID",h.toString()),a.e.IsEmpty(this.ds.Tables[2][0].StageCCID)||(S=parseInt(this.ds.Tables[2][0].StageCCID),this.Parent.ScreenObject.Preferences.ContainsKey("StageCCID")?this.Parent.ScreenObject.Preferences.StageCCID=S.toString():this.Parent.ScreenObject.Preferences.push("StageCCID",S.toString())),a.e.IsEmpty(this.ds.Tables[2][0].MachineCCID)||(C=parseInt(this.ds.Tables[2][0].MachineCCID),this.Parent.ScreenObject.Preferences.ContainsKey("MachineCCID")?this.Parent.ScreenObject.Preferences.MachineCCID=C.toString():this.Parent.ScreenObject.Preferences.push("MachineCCID",C.toString())));let g=[];for(let D=0;D<this.AddGridData.length;D++,e++){let I,T=0,P=this.Parent.ScreenObject.GridDataObj.NewRow();if(this.Parent.ScreenObject.GridDataObj.insertRowAt(P,e),this.Parent.ScreenObject.GridDataColumns.Contains("dcccnid"+(h-5e4)+"_Key")?(P["dcccnid"+(h-5e4)+"_Key"]=this.JobNodeID,P["dcccnid"+(h-5e4)]=this.VoucherNo):(o=this.Parent.ScreenObject._CCFields.find(e=>e instanceof u.b&&e.CCID==h))instanceof u.b&&(o.SelectedValue=this.JobNodeID,i.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==i.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(o.SelectedValueText=this.VoucherNo)),this.AddedGridObj.TableColumns.Contains("DimID")&&!a.e.IsEmpty(this.AddGridData[D].DimID)&&p>0)if(this.Parent.ScreenObject.GridDataColumns.Contains("JobUnqID")||this.Parent.ScreenObject.GridDataColumns.push("JobUnqID"),P.JobUnqID=this.AddGridData[D].DimID.toString(),this.Parent.ScreenObject.GridDataColumns.Contains("dcccnid"+(p-5e4)+"_Key")){if(P["dcccnid"+(p-5e4)+"_Key"]=this.AddGridData[D].DimID,this.ds.Columns[0].Contains("DimName")){let e=this.ds.Tables[0].filter(e=>e.DimID==this.AddGridData[D].DimID);e.length>0&&(P["dcccnid"+(p-5e4)]=e[0].DimName)}}else if((o=this.Parent.ScreenObject._CCFields.find(e=>e instanceof u.b&&e.CCID==p))instanceof u.b&&(o.SelectedValue=parseInt(this.AddGridData[D].DimID),i.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==i.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&this.ds.Columns[0].Contains("DimName"))){let e=this.ds.Tables[0].filter(e=>e.DimID==this.AddGridData[D].DimID);e.length>0&&(o.SelectedValueText=e[0].DimName.toString())}if(a.e.IsEmpty(this.AddGridData[D].BomNodeID)||(this.Parent.ScreenObject.GridDataColumns.Contains("dcccnid"+(y-5e4)+"_Key")?(P["dcccnid"+(y-5e4)+"_Key"]=this.AddGridData[D].BomNodeID,P["dcccnid"+(y-5e4)]=this.AddGridData[D].BomName.toString()):(o=this.Parent.ScreenObject._CCFields.find(e=>e instanceof u.b&&e.CCID==y))instanceof u.b&&(o.SelectedValue=parseInt(this.AddGridData[D].BomNodeID),i.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==i.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(o.SelectedValueText=this.AddGridData[D].BomName)),this.Parent.ScreenObject.GridDataColumns.Contains("BOMID")||this.Parent.ScreenObject.GridDataColumns.push("BOMID"),P.BOMID=this.AddGridData[D].BomNodeID),this.Parent.ScreenObject.GridDataColumns.Contains("jobID")||this.Parent.ScreenObject.GridDataColumns.push("jobID"),P.jobID=this.JobNodeID,S>0&&!a.e.IsEmpty(this.AddGridData[D].StageNodeID)&&(this.Parent.ScreenObject.GridDataColumns.Contains("dcccnid"+(S-5e4)+"_Key")?(P["dcccnid"+(S-5e4)+"_Key"]=this.AddGridData[D].StageNodeID,P["dcccnid"+(S-5e4)]=this.AddGridData[D].StageName.toString()):((l=this.Parent.ScreenObject._CCFields.find(e=>e instanceof u.b&&e.CCID==S))instanceof u.b&&(l.SelectedValue=parseInt(this.AddGridData[D].StageNodeID),i.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==i.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(l.SelectedValueText=this.AddGridData[D].StageName.toString())),this.Parent.ScreenObject.GridDataColumns.Contains("StageID")||this.Parent.ScreenObject.GridDataColumns.push("StageID"),P.StageID=this.AddGridData[D].StageNodeID)),36==this.Parent.ScreenObject.DocumentType){var t;this.AddtempProd(P),this.Parent.ScreenObject.GridDataColumns.Contains("dcNum3")&&(P.dcNum3=this.AddGridData[D].Value),this.Parent.ScreenObject.GridDataColumns.Contains("dcNum1")&&(P.dcNum1=this.AddGridData[D].Cost),this.Parent.ScreenObject.GridDataColumns.Contains("dcNum2")&&(P.dcNum2=this.AddGridData[D].Hrs),this.Parent.ScreenObject.GridDataColumns.Contains("dcccnid"+(C-5e4)+"_Key")&&(P["dcccnid"+(C-5e4)+"_Key"]=this.AddGridData[D].MachineID,P["dcccnid"+(C-5e4)]=this.AddGridData[D].Machine.toString()),this.Parent.ScreenObject.GridDataColumns.Contains("CreditAccount")&&(a.e.IsEmpty(this.GridData[D].CrAccountID)?(t=this.Parent.ScreenObject.ColumnSource.find(e=>null!=e.ValueMember&&"creditaccount_key"==e.ValueMember.toLowerCase()))&&!a.e.IsEmpty(t.DefaultValue)&&(P.CreditAccount_Key=t.DefaultValue,P.CreditAccount=t.DefaultValueText):(P.CreditAccount=this.AddGridData[D].CrAccount.toString(),P.CreditAccount_Key=this.AddGridData[D].CrAccountID)),this.Parent.ScreenObject.GridDataColumns.Contains("DebitAccount")&&(a.e.IsEmpty(this.GridData[D].DrAccountID)?(t=this.Parent.ScreenObject.ColumnSource.find(e=>null!=e.ValueMember&&"debitaccount_key"==e.ValueMember.toLowerCase()))&&!a.e.IsEmpty(t.DefaultValue)&&(P.DebitAccount_Key=t.DefaultValue,P.DebitAccount=t.DefaultValueText):(P.DebitAccount_Key=this.AddGridData[D].DrAccountID.toString(),P.DebitAccount=this.AddGridData[D].DrAccount));let e=0;var s;this.GridObj.TableColumns.Contains("MachineDim1")&&""!=this.AddGridData[D].MachineDim1.toString()&&this.Parent.ScreenObject.Preferences.ContainsKey("MachineDim1")&&a.e.Int(this.Parent.ScreenObject.Preferences.MachineDim1)>0&&(this.Parent.ScreenObject.GridDataColumns.Contains("dcccnid"+(e-5e4))?P["dcccnid"+(e-5e4)+"_Key"]=this.AddGridData[D].MachineDim1.toString():null!=(s=this.Parent.ScreenObject._CCFields.find(t=>t.DBColumnName.toLowerCase()=="dcccnid"+(e-5e4)))&&null!=s&&s instanceof u.b&&(s.SelectedValue=parseInt(this.AddGridData[D].MachineDim1.toString()))),this.GridObj.TableColumns.Contains("MachineDim2")&&""!=this.AddGridData[D].MachineDim2.toString()&&this.Parent.ScreenObject.Preferences.ContainsKey("MachineDim2")&&a.e.Int(this.Parent.ScreenObject.Preferences.MachineDim2)>0&&(this.Parent.ScreenObject.GridDataColumns.Contains("dcccnid"+(e-5e4))?P["dcccnid"+(e-5e4)+"_Key"]=this.AddGridData[D].MachineDim1.toString():null!=(s=this.Parent.ScreenObject._CCFields.find(t=>t.DBColumnName.toLowerCase()=="dcccnid"+(e-5e4)))&&null!=s&&s instanceof u.b&&(s.SelectedValue=parseInt(this.AddGridData[D].MachineDim2.toString())))}else 37==this.Parent.ScreenObject.DocumentType?(this.AddtempProd(P),this.Parent.ScreenObject.GridDataColumns.Contains("LineNarration")&&(P.LineNarration=this.AddGridData[D].Name.toString()),this.Parent.ScreenObject.GridDataColumns.Contains("CreditAccount")&&(P.CreditAccount=this.AddGridData[D].Credit.toString(),P.CreditAccount_Key=this.AddGridData[D].CreditAccountID),this.Parent.ScreenObject.GridDataColumns.Contains("DebitAccount")&&(P.DebitAccount_Key=this.AddGridData[D].DebitAccountID,P.DebitAccount=this.AddGridData[D].Debit.toString()),this.Parent.ScreenObject.GridDataColumns.Contains("dcNum1")&&(P.dcNum1=this.AddGridData[D].Value)):(P.ProductID_Key=this.AddGridData[D].ProductID_Key,this.Parent.ScreenObject.GridDataColumns.Contains("ProductName")&&(P.ProductName=this.AddGridData[D].ProductName.toString()),this.Parent.ScreenObject.GridDataColumns.Contains("ProductCode")&&(P.ProductCode=this.AddGridData[D].ProductCode.toString()),this.Parent.ScreenObject.GridDataColumns.Contains("Unit")&&(P.Unit=this.AddGridData[D].UOMID.toString()),this.Parent.ScreenObject.GridDataColumns.Contains("Unit_Key")&&(P.Unit_Key=this.AddGridData[D].UOMID_Key),this.Parent.ScreenObject.GridDataColumns.Contains("NetJobQty")||this.Parent.ScreenObject.GridDataColumns.push("NetJobQty"),P.NetJobQty=this.AddGridData[D].Net,a.e.IsEmpty(this.AddGridData[D].Qty)?P.Quantity=1:null!=this.Parent.AutoPostViewModel&&this.Parent.ScreenObject.Preferences.ContainsKey("ExpFPQTY")&&this.Parent.ScreenObject.GridDataColumns.Contains(this.Parent.ScreenObject.Preferences.ExpFPQTY)?P[this.Parent.ScreenObject.Preferences.ExpFPQTY]=this.AddGridData[D].Qty:P.Quantity=this.AddGridData[D].Qty,P.Type=this.AddGridData[D].ProductType,this.Parent.AddProductData(P,!1,!0),!a.e.IsEmpty(this.AddGridData[D].Qty)&&null!=this.Parent.AutoPostViewModel&&this.Parent.ScreenObject.Preferences.ContainsKey("ExpFPQTY")&&this.Parent.ScreenObject.GridDataColumns.Contains(this.Parent.ScreenObject.Preferences.ExpFPQTY)&&(P[this.Parent.ScreenObject.Preferences.ExpFPQTY]=this.AddGridData[D].Qty),this.AddedGridObj.TableColumns.Contains("RemainingQty")&&(this.Parent.ScreenObject.GridDataColumns.Contains("RemQty")||this.Parent.ScreenObject.GridDataColumns.push("RemQty"),P.RemQty=this.AddGridData[D].RemainingQty));var r;if(this.Parent.ScreenObject.GridDataColumns.Contains("RefNo")&&(P.RefNo=this.VoucherNo),this.Parent.ScreenObject.GridDataColumns.Contains("dcccnid"+(h-5e4)+"_Key")?(P["dcccnid"+(h-5e4)+"_Key"]=this.JobNodeID,P["dcccnid"+(h-5e4)]=this.VoucherNo,(r=this.Parent.ScreenObject.ColumnSource.find(e=>e.DisplayMember.toLowerCase()=="dcccnid"+(h-5e4)))&&(I=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&e.LocalReference==r.ID),I.length>0&&this.Parent.ScreenObject.GetLinkReferenceData(parseInt(r.ID),this.Parent.DocumentID,parseInt(P[r.ValueMember]),Date.Today(),"",r.CostCenterID,P))):(o=this.Parent.ScreenObject._CCFields.find(e=>e instanceof u.b&&e.CCID==h))instanceof u.b&&(o.SelectedValue=this.JobNodeID,i.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==i.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(o.SelectedValueText=this.VoucherNo)),a.e.IsEmpty(this.AddGridData[D].BomNodeID)||(this.Parent.ScreenObject.GridDataColumns.Contains("dcccnid"+(y-5e4)+"_Key")?(P["dcccnid"+(y-5e4)+"_Key"]=this.AddGridData[D].BomNodeID,P["dcccnid"+(y-5e4)]=this.AddGridData[D].BomName.toString(),(r=this.Parent.ScreenObject.ColumnSource.find(e=>e.DisplayMember.toLowerCase()=="dcccnid"+(y-5e4)))&&(I=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&e.LocalReference==r.ID),I.length>0&&this.Parent.ScreenObject.GetLinkReferenceData(parseInt(r.ID),this.Parent.DocumentID,parseInt(P[r.ValueMember]),Date.Today(),"",r.CostCenterID,P))):(o=this.Parent.ScreenObject._CCFields.find(e=>e instanceof u.b&&e.CCID==y))instanceof u.b&&(o.SelectedValue=parseInt(this.AddGridData[D].BomNodeID),i.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==i.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(o.SelectedValueText=this.AddGridData[D].BomName.toString())),this.Parent.ScreenObject.GridDataColumns.Contains("BOMID")||this.Parent.ScreenObject.GridDataColumns.push("BOMID"),P.BOMID=this.AddGridData[D].BomNodeID),I=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&55252==e.LinkData),I.length>0&&this.Parent.ScreenObject.GridDataColumns.Contains(I[0].SysColumnName)&&(P[I[0].SysColumnName]=this.AddGridData[D].IPQTY),I=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&54209==e.LinkData),I.length>0&&this.Parent.ScreenObject.GridDataColumns.Contains(I[0].SysColumnName)&&!a.e.IsEmpty(this.AddGridData[D].UnitPrice)&&(P[I[0].SysColumnName]=this.AddGridData[D].UnitPrice),I=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&55253==e.LinkData),I.length>0&&this.Parent.ScreenObject.GridDataColumns.Contains(I[0].SysColumnName)&&(P[I[0].SysColumnName]=this.AddGridData[D].OPQTY),I=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&55254==e.LinkData),I.length>0&&this.Parent.ScreenObject.GridDataColumns.Contains(I[0].SysColumnName)&&(P[I[0].SysColumnName]=this.AddGridData[D].BatchSize),I=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&55474==e.LinkData),this.AddedGridObj.TableColumns.Contains("Remarks")&&I.length>0&&this.Parent.ScreenObject.GridDataColumns.Contains(I[0].SysColumnName)&&(P[I[0].SysColumnName]=this.AddGridData[D].Remarks),I=this.Parent.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&55259==e.LinkData),I.length>0&&this.Parent.ScreenObject.GridDataColumns.Contains(I[0].SysColumnName)&&!a.e.IsEmpty(this.AddGridData[D].Qty)&&(P[I[0].SysColumnName]=this.AddGridData[D].Qty.toString()),this.Parent.ScreenObject.GridDataColumns.Contains("jobID")||this.Parent.ScreenObject.GridDataColumns.push("jobID"),P.jobID=this.JobNodeID,S>0&&!a.e.IsEmpty(this.AddGridData[D].StageNodeID)&&(this.Parent.ScreenObject.GridDataColumns.Contains("dcccnid"+(S-5e4)+"_Key")?(P["dcccnid"+(S-5e4)+"_Key"]=this.AddGridData[D].StageNodeID,P["dcccnid"+(S-5e4)]=this.AddGridData[D].StageName.toString()):((l=this.Parent.ScreenObject._CCFields.find(e=>e instanceof u.b&&e.CCID==S))instanceof u.b&&(l.SelectedValue=parseInt(this.AddGridData[D].StageNodeID),i.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==i.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(l.SelectedValueText=this.AddGridData[D].StageName.toString())),this.Parent.ScreenObject.GridDataColumns.Contains("StageID")||this.Parent.ScreenObject.GridDataColumns.push("StageID"),P.StageID=this.AddGridData[D].StageNodeID)),a.e.IsNum(P.UOMConversion)&&a.e.IsNum(P.Quantity)&&(P.UOMConvertedQty=parseFloat(P.UOMConversion)*parseFloat(P.Quantity)),P.LinkedFieldName=this.IsBom?"BOM":"JOB",!a.e.IsEmpty(P.Type)&&5==parseInt(P.Type)&&!a.e.IsEmpty(P.Quantity)&&parseFloat(P.Quantity)>0)if(-1==this.Parent.VoucherType&&this.Parent.ScreenObject.Preferences.ContainsKey("AutoBatches")&&""!=this.Parent.ScreenObject.Preferences.AutoBatches.toString()&&Object(n.j)(this.Parent.ScreenObject.Preferences.AutoBatches)){let t=0,s=0;s=this.Parent.ScreenObject.LocationID>0?this.Parent.ScreenObject.LocationID:i.a.SessionManager.LocationID,t=this.Parent.ScreenObject.DivisionID>0?this.Parent.ScreenObject.DivisionID:i.a.SessionManager.DivisionID;let n=a.e.DoubleTryParse(P.Quantity);a.e.IsNum(P.UOMConversion)&&(n*=parseFloat(P.UOMConversion));let r=new m.a(this.Parent.ScreenObject.GridDataObj);r.BatchNumberViewModel_3(this.Parent,this.Parent.VoucherType,n,parseInt(P.ProductID_Key),P.ProductName.toString(),s,t,P),r.ChkFifo=!0,r.OnSave("Save"),r.count>1&&(e=e+r.count-1)}else if(1==this.Parent.VoucherType)if("1"!=this.AddGridData[D].IsOutput.toString()||this.Parent.ScreenObject.Preferences.ContainsKey("AutoBatchNoinReciept")&&"True"!=this.Parent.ScreenObject.Preferences.AutoBatchNoinReciept.toString()){if(this.ds.Tables.length>4&&this.ds.Tables[4].length>0&&this.ds.Columns[4].Contains("BatchID")){let e;if(e=this.ds.Tables[4].filter(S>0?e=>e.ProductID==P.ProductID_Key&&e.StageID==this.AddGridData[D].StageNodeID:e=>e.ProductID==P.ProductID_Key),e.length>0){let t=0;a.e.Double(P.Quantity)>0&&(t=parseFloat(P.Quantity)),a.e.IsEmpty(P.UOMConversion)||(t*=parseFloat(P.UOMConversion));let s="";s+="<xml>",s+="<Row ",s+=' BatchID="'+e[0].BatchID.toString()+'" ',s+=' ProductID="'+P.ProductID_Key.toString()+'" ',s+=' Quantity="'+t.toString()+'" ',s+=' Hold="0" ',s+=' Release="'+t.toString()+'" ',s+=" ></Row>",s+="</xml>",P.ExtraXML=s.toString()}}}else{let e=this.VoucherNo,t={BatchID:0},s=this.Parent.ScreenObject.GetBatch(this.VoucherNo,P.ProductID_Key.toString(),t);if(this.Parent.ScreenObject.Preferences.ContainsKey("CreateNewBatchNo")&&"True"==this.Parent.ScreenObject.Preferences.CreateNewBatchNo.toString()&&(t.BatchID=0,s.Tables.length>3&&s.Tables[3].length>0)){let t=s.Tables[3].filter(e=>1==e.IsName);if(t.length>0&&!a.e.IsEmpty(t[0].PrefixContent))try{e=this.GetBatchNo(t[0].PrefixContent.toString(),P)}catch(b){Logger.ErrorLog("error reading PrefixContent xml")}}if(t.BatchID<=0){let n=Date.Today(),r=Date.Today(),o=null,l=0,h=0,c=0,d="",D="";if(o=this.ds.Tables.length>2&&this.ds.Tables[2].length>0&&this.ds.Columns[2].Contains("ccAlpha45")&&a.e.isValidDate(this.ds.Tables[2][0].ccAlpha45)?new Date(this.ds.Tables[2][0].ccAlpha45):null,n=this.ds.Tables.length>2&&this.ds.Tables[2].length>0&&this.ds.Columns[2].Contains("ccAlpha47")&&a.e.isValidDate(this.ds.Tables[2][0].ccAlpha47)?new Date(this.ds.Tables[2][0].ccAlpha47):this.Parent.DocumentDate,r=this.ds.Tables.length>2&&this.ds.Tables[2].length>0&&this.ds.Columns[2].Contains("ccAlpha46")&&a.e.isValidDate(this.ds.Tables[2][0].ccAlpha46)?new Date(this.ds.Tables[2][0].ccAlpha46):s.Tables.length>2&&s.Columns[2].Contains("ShelfLife")&&s.Tables[2].length>0&&!a.e.IsEmpty(s.Tables[2][0].ShelfLife)?n.AddDays(parseInt(s.Tables[2][0].ShelfLife)):Date.Today(),l=this.ds.Tables.length>2&&this.ds.Tables[2].length>0&&this.ds.Columns[2].Contains("ccAlpha44")&&a.e.IsNum(this.ds.Tables[2][0].ccAlpha44)?parseFloat(this.ds.Tables[2][0].ccAlpha44):0,h=this.ds.Tables.length>2&&this.ds.Tables[2].length>0&&this.ds.Columns[2].Contains("ccAlpha43")&&a.e.IsNum(this.ds.Tables[2][0].ccAlpha43)?parseFloat(this.ds.Tables[2][0].ccAlpha43):0,c=this.ds.Tables.length>2&&this.ds.Tables[2].length>0&&this.ds.Columns[2].Contains("ccAlpha42")&&a.e.IsNum(this.ds.Tables[2][0].ccAlpha42)?parseFloat(this.ds.Tables[2][0].ccAlpha42):0,this.ds.Tables.length>2&&this.ds.Tables[2].length>0&&this.ds.Columns[2].Contains("ccAlpha40")&&a.e.IsNum(this.ds.Tables[2][0].ccAlpha40)&&(d=" PreExpiryDays = "+parseInt(this.ds.Tables[2][0].ccAlpha40)+","),a.e.IsType(this.Parent,"AddEditDocumentViewModel")){let e=0,t=!1;if(i.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise Batches")&&""!=i.a.SessionManager.Preferences["Maintain Dimensionwise Batches"].toString()&&(e=a.e.IntTryParse(i.a.SessionManager.Preferences["Maintain Dimensionwise Batches"]),e>0)){for(let s=0;s<this.Parent.ScreenObject._CCFields.length;s++){let i=this.Parent.ScreenObject._CCFields[s];if(i instanceof u.b&&i.CCID==e){D="CCNID"+(e-5e4)+"='"+i.SelectedValue+"',",t=!0;break}}t||null!=P&&e>5e4&&!a.e.IsEmpty(P["dcCCNID"+(e-5e4)+"_Key"])&&(D=D+"CCNID"+(e-5e4)+"='"+P["dcCCNID"+(e-5e4)+"_Key"].toString()+"',")}if(this.Parent.ScreenObject.Preferences.ContainsKey("BatchFilterDim")&&(e=a.e.IntTryParse(this.Parent.ScreenObject.Preferences.BatchFilterDim),t=!1,e>0&&!D.Contains("CCNID"+(e-5e4)+"="))){for(let s=0;s<this.Parent.ScreenObject._CCFields.length;s++){let i=this.Parent.ScreenObject._CCFields[s];if(i instanceof u.b&&i.CCID==e){i.SelectedValue>0&&(D=D+"CCNID"+(e-5e4)+"='"+i.SelectedValue+"',"),t=!0;break}}t||e>5e4&&this.Parent.ScreenObject.GridDataColumns.Contains("dcCCNID"+(e-5e4)+"_Key")&&(t=!0,a.e.IsEmpty(P["dcCCNID"+(e-5e4)+"_Key"])||(D=D+"CCNID"+(e-5e4)+"='"+P["dcCCNID"+(e-5e4)+"_Key"].toString()+"',"))}}t.BatchID=this.Parent.ScreenObject.SaveBatch(e,n,r,o,l,h,c,P.ProductID_Key,d,D)}if(t.BatchID>0){let e=0;!a.e.IsEmpty(P.Quantity)&&parseFloat(P.Quantity)>0&&(e=parseFloat(P.Quantity)),a.e.IsEmpty(P.UOMConversion)||(e*=parseFloat(P.UOMConversion));let s="";s+="<xml>",s+="<Row ",s+=' BatchID="'+t.BatchID+'" ',s+=' ProductID="'+P.ProductID_Key.toString()+'" ',s+=' Quantity="'+e.toString()+'" ',s+=' Hold="0" ',s+=' Release="'+e.toString()+'" ',s+=" ></Row>",s+="</xml>",P.ExtraXML=s.toString()}}if(this.Parent.ScreenObject.GridDataColumns.Contains("NextStageID")&&(P.NextStageID=this.AddGridData[D].StageNodeID.toString()),36!=this.Parent.ScreenObject.DocumentType&&37!=this.Parent.ScreenObject.DocumentType&&!g.Contains(this.AddGridData[D].StageID.toString())&&null!=this.Parent.AutoPostViewModel)if(g.push(this.AddGridData[D].StageID.toString()),this.Parent.ScreenObject.IsPurchase){let e,t;S>0&&(e=this.AddGridData[D].StageID),p>0&&this.AddedGridObj.TableColumns.Contains("DimID")&&(t=this.AddGridData[D].DimID);let s=this.ds.Tables[1].filter(s=>2==s.ProductUse&&s.bomID==this.AddGridData[D].BomID&&s.ProductID==P.ProductID_Key&&(Object(d.isUndefined)(e)||s.StageID==e)&&(Object(d.isUndefined)(t)||s.DimID==t));if(s.length>0&&!a.e.IsEmpty(s[0].Quantity)){let r=parseFloat(s[0].Quantity);if(e=void 0,t=void 0,S>0&&(e=s[0].StageID.toString()),p>0&&this.AddedGridObj.TableColumns.Contains("DimID")&&(t=this.AddGridData[D].DimID.toString()),s=this.ds.Tables[1].filter(s=>1==s.ProductUse&&s.bomID==this.AddGridData[D].BomID&&(Object(d.isUndefined)(e)||s.StageID==e)&&(Object(d.isUndefined)(t)||s.DimID==t)),s.length>0){this.Parent.AutoPostViewModel.ScreenObject._CCFields.forEach(e=>{var t=this.Parent.ScreenObject._CCFields.find(t=>t.DBColumnName==e.DBColumnName);t&&e instanceof u.b&&t instanceof u.b&&(e.SelectedValue=t.SelectedValue,e.SelectedValueText=t.Text)}),this.Parent.AutoPostViewModel.ScreenObject.Preferences.ContainsKey("jobCCID")?this.Parent.AutoPostViewModel.ScreenObject.Preferences.jobCCID=h.toString():this.Parent.AutoPostViewModel.ScreenObject.Preferences.push("jobCCID",h.toString()),a.e.IsEmpty(this.ds.Tables[2][0].StageCCID)||(this.Parent.AutoPostViewModel.ScreenObject.Preferences.ContainsKey("StageCCID")?this.Parent.AutoPostViewModel.ScreenObject.Preferences.StageCCID=S.toString():this.Parent.AutoPostViewModel.ScreenObject.Preferences.push("StageCCID",S.toString())),y>0&&(this.Parent.AutoPostViewModel.ScreenObject.Preferences.ContainsKey("BomCCID")?this.Parent.AutoPostViewModel.ScreenObject.Preferences.BomCCID=y.toString():this.Parent.AutoPostViewModel.ScreenObject.Preferences.push("BomCCID",y.toString()));let e=0;for(let s=0;s<this.Parent.AutoPostViewModel.ScreenObject.GridData.length;s++)if(a.e.IsEmpty(this.Parent.AutoPostViewModel.ScreenObject.GridData[s].ProductID_Key)){e=s;break}let t=a.e.NewGuid();for(let n=0;n<s.length;n++,e++)if(!a.e.IsEmpty(s[n].Quantity)){let c=this.Parent.AutoPostViewModel.ScreenObject.GridDataObj.NewRow();if(this.Parent.AutoPostViewModel.ScreenObject.GridData.InsertAt(c,e),this.AddedGridObj.TableColumns.Contains("DimID")&&!a.e.IsEmpty(this.AddGridData[D].DimID)&&p>0)if(this.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("JobUnqID")||this.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.push("JobUnqID"),c.JobUnqID=this.AddGridData[D].DimID.toString(),this.Parent.ScreenObject.GridDataColumns.Contains("dcccnid"+(p-5e4)+"_Key")){if(c["dcccnid"+(p-5e4)+"_Key"]=this.AddGridData[D].DimID.toString(),this.ds.Columns[0].Contains("DimName")){let e=this.ds.Tables[0].filter(e=>e.DimID==this.AddGridData[D].DimID);e.length>0&&(c["dcccnid"+(p-5e4)]=e[0].DimName)}}else if(0==n&&(o=this.Parent.ScreenObject._CCFields.find(e=>e instanceof u.b&&e.CCID==p))instanceof u.b&&(o.SelectedValue=parseInt(this.AddGridData[D].DimID),i.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==i.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&this.ds.Columns[0].Contains("DimName"))){let e=this.ds.Tables[0].filter(e=>e.DimID==this.AddGridData[D].DimID);e.length>0&&(o.SelectedValueText=e[0].DimName.toString())}if(c.ProductID_Key=s[n].ProductID.toString(),this.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("ProductName")&&(c.ProductName=s[n].ProductName.toString()),this.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("ProductCode")&&(c.ProductCode=s[n].ProductCode.toString()),this.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("Unit")&&(c.Unit=s[n].UnitName.toString()),this.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("Unit_Key")&&(c.Unit_Key=s[n].UOMID.toString()),c.defaultQuantity=parseFloat(s[n].Quantity)/r,c.Quantity=parseFloat(c.defaultQuantity)*parseFloat(this.AddGridData[D].Qty),a.e.IsEmpty(c.Quantity)||(I=this.Parent.AutoPostViewModel.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&55259==e.LinkData),I.length>0&&this.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains(I[0].SysColumnName.toString())&&(c[I[0].SysColumnName.toString()]=c.Quantity.toString())),c.Type=s[n].ProductTypeID,this.Parent.AutoPostViewModel.AddProductData(c,!1,!0),this.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("RefNo")&&(c.RefNo=this.VoucherNo),this.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("dcccnid"+(h-5e4)+"_Key")?(c["dcccnid"+(h-5e4)+"_Key"]=this.JobNodeID,c["dcccnid"+(h-5e4)]=this.VoucherNo):(o=this.Parent.AutoPostViewModel.ScreenObject._CCFields.find(e=>e instanceof u.b&&e.CCID==h))instanceof u.b&&(o.SelectedValue=this.JobNodeID,i.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==i.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(o.SelectedValueText=this.VoucherNo)),this.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("jobID")||this.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.push("jobID"),c.jobID=this.JobNodeID,S>0&&!a.e.IsEmpty(this.AddGridData[D].StageNodeID)&&(this.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("dcccnid"+(S-5e4)+"_Key")?(c["dcccnid"+(S-5e4)+"_Key"]=this.AddGridData[D].StageNodeID.toString(),c["dcccnid"+(S-5e4)]=this.AddGridData[D].StageName.toString(),this.CallReference_3(this.Parent.AutoPostViewModel,S,c)):(0==n&&(l=this.Parent.AutoPostViewModel.ScreenObject._CCFields.find(e=>e instanceof u.b&&e.CCID==S))instanceof u.b&&(l.SelectedValue=parseInt(this.AddGridData[D].StageNodeID),i.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==i.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(l.SelectedValueText=this.AddGridData[D].StageName.toString()),this.CallReference_2(this.Parent.AutoPostViewModel,l)),this.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("StageID")||this.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.push("StageID"),c.StageID=this.AddGridData[D].StageNodeID)),y>0&&!a.e.IsEmpty(this.AddGridData[D].BomNodeID)&&(this.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("dcccnid"+(y-5e4)+"_Key")?(c["dcccnid"+(y-5e4)+"_Key"]=this.AddGridData[D].BomNodeID.toString(),c["dcccnid"+(y-5e4)]=this.AddGridData[D].BomName.toString(),this.CallReference_3(this.Parent.AutoPostViewModel,y,c)):(0==n&&(l=this.Parent.AutoPostViewModel.ScreenObject._CCFields.find(e=>e instanceof u.b&&e.CCID==y))instanceof u.b&&(l.SelectedValue=parseInt(this.AddGridData[D].BomNodeID),i.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==i.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(l.SelectedValueText=this.AddGridData[D].BomName.toString()),this.CallReference_2(this.Parent.AutoPostViewModel,l)),this.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("BOMID")||this.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.push("BOMID"),c.BOMID=this.AddGridData[D].BomNodeID)),a.e.IsNum(c.UOMConversion)&&(c.UOMConvertedQty=parseFloat(c.UOMConversion)*parseFloat(c.Quantity)),this.Parent.AutoPostViewModel.CalculateTotals(c,!1),c.LinkedFieldName=this.IsBom?"BOM":"JOB",a.e.IsEmpty(c.Gross)||(T+=parseFloat(c.Gross)),c.RefSeqNo=t,!a.e.IsEmpty(s[n].AutoStage)&&null!=this.Parent.AutoPostViewModel.AutoProduce){let e;e=p>0&&this.AddedGridObj.TableColumns.Contains("DimID")?this.AutoProduce(this.Parent.AutoPostViewModel.AutoProduce,s[n],h,y,S,p,this.AddGridData[D].DimID.toString(),parseFloat(c.Quantity)):this.AutoProduce(this.Parent.AutoPostViewModel.AutoProduce,s[n],h,y,S,0,"",parseFloat(c.Quantity)),c.AutoRefSeqNo=e}}if(this.Parent.ScreenObject.Preferences.ContainsKey("CalcOpRate")&&""!=this.Parent.ScreenObject.Preferences.CalcOpRate.toString()&&Object(n.j)(this.Parent.ScreenObject.Preferences.CalcOpRate))if(this.Parent.ScreenObject.Preferences.ContainsKey("QtyBasedCost")&&""!=this.Parent.ScreenObject.Preferences.QtyBasedCost.toString()&&Object(n.j)(this.Parent.ScreenObject.Preferences.QtyBasedCost)){let e=0;a.e.IsNum(this.AddGridData[D].ActualQty)&&(e=T/parseFloat(this.AddGridData[D].ActualQty)),P.Rate=e}else P.Rate=(this.Parent.ScreenObject.Preferences.ContainsKey("ExpFPQTY")&&this.Parent.ScreenObject.GridDataColumns.Contains(this.Parent.ScreenObject.Preferences.ExpFPQTY)&&this.Parent.ScreenObject.Preferences.ExpFPQTY.toLowerCase(),T/parseFloat(this.AddGridData[D].Qty));P.RefSeqNo=t}}}else{let e,t;S>0&&(e=this.AddGridData[D].StageID),p>0&&this.AddedGridObj.TableColumns.Contains("DimID")&&(t=this.AddGridData[D].DimID);let s=this.ds.Tables[0].filter(s=>s.BOMID==this.AddGridData[D].BomID&&(Object(d.isUndefined)(e)||s.StageID==e)&&(Object(d.isUndefined)(t)||s.DimID==t));if(s.length>0){this.Parent.AutoPostViewModel.ScreenObject._CCFields.forEach(e=>{var t=this.Parent.ScreenObject._CCFields.find(t=>t.DBColumnName==e.DBColumnName);t&&e instanceof u.b&&t instanceof u.b&&(e.SelectedValue=t.SelectedValue,e.SelectedValueText=t.Text)}),this.Parent.AutoPostViewModel.ScreenObject.Preferences.ContainsKey("jobCCID")?this.Parent.AutoPostViewModel.ScreenObject.Preferences.jobCCID=h.toString():this.Parent.AutoPostViewModel.ScreenObject.Preferences.push("jobCCID",h.toString()),a.e.IsEmpty(this.ds.Tables[2][0].StageCCID)||(this.Parent.AutoPostViewModel.ScreenObject.Preferences.ContainsKey("StageCCID")?this.Parent.AutoPostViewModel.ScreenObject.Preferences.StageCCID=S.toString():this.Parent.AutoPostViewModel.ScreenObject.Preferences.push("StageCCID",S.toString()));let r=0;for(let e=0;e<this.Parent.AutoPostViewModel.ScreenObject.GridData.length;e++)if(a.e.IsEmpty(this.Parent.AutoPostViewModel.ScreenObject.GridData[e].ProductID_Key)){r=e;break}let c=a.e.NewGuid();for(let m=0;m<s.length;m++){e=void 0,t=void 0,S>0&&(e=this.AddGridData[D].StageID),p>0&&this.AddedGridObj.TableColumns.Contains("DimID")&&(t=this.AddGridData[D].DimID);let b=this.ds.Tables[1].filter(i=>i.BOMID==this.AddGridData[D].BomID&&i.ProductID==s[m].ProductID&&(Object(d.isUndefined)(e)||i.StageID==e)&&(Object(d.isUndefined)(t)||i.DimID==t));if(b.length>0){let e=this.Parent.AutoPostViewModel.ScreenObject.GridDataObj.NewRow();var o,l;this.Parent.AutoPostViewModel.ScreenObject.GridData.InsertAt(e,r),e.ProductID_Key=b[0].ProductID.toString(),this.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("ProductName")&&(e.ProductName=b[0].ProductName.toString()),this.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("ProductCode")&&(e.ProductCode=b[0].ProductCode.toString()),this.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("Unit")&&(e.Unit=b[0].UnitName.toString()),this.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("Unit_Key")&&(e.Unit_Key=b[0].UOMID.toString()),e.Quantity=this.ds.Columns[0].Contains("IsBom")&&!a.e.IsEmpty(s[0].IsBom)&&!this.IsBom&&Object(n.j)(s[0].IsBom)?parseFloat(b[0].Quantity)*parseFloat(this.AddGridData[D].RemQty):this.AddGridData[D].RemQty.toString(),e.Type=b[0].ProductTypeID,this.Parent.AutoPostViewModel.AddProductData(e,!1,!0),this.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("RefNo")&&(e.RefNo=this.VoucherNo),this.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("dcccnid"+(h-5e4)+"_Key")?(e["dcccnid"+(h-5e4)+"_Key"]=this.JobNodeID,e["dcccnid"+(h-5e4)]=this.VoucherNo):(o=this.Parent.AutoPostViewModel.ScreenObject._CCFields.find(e=>e instanceof u.b&&e.CCID==h))instanceof u.b&&(o.SelectedValue=this.JobNodeID,i.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==i.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(o.SelectedValueText=this.VoucherNo)),this.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("jobID")||this.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.push("jobID"),e.jobID=this.JobNodeID,S>0&&!a.e.IsEmpty(this.AddGridData[D].StageNodeID)&&(this.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("dcccnid"+(S-5e4)+"_Key")?(e["dcccnid"+(S-5e4)+"_Key"]=this.AddGridData[D].StageNodeID.toString(),e["dcccnid"+(S-5e4)]=this.AddGridData[D].StageName.toString()):((l=this.Parent.AutoPostViewModel.ScreenObject._CCFields.find(e=>e instanceof u.b&&e.CCID==S))instanceof u.b&&(l.SelectedValue=parseInt(this.AddGridData[D].StageNodeID),i.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==i.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(l.SelectedValueText=this.AddGridData[D].StageName.toString())),this.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.Contains("StageID")||this.Parent.AutoPostViewModel.ScreenObject.GridDataObj.TableColumns.push("StageID"),e.StageID=this.AddGridData[D].StageNodeID)),a.e.IsNum(e.UOMConversion)&&(e.UOMConvertedQty=parseFloat(e.UOMConversion)*parseFloat(e.Quantity)),this.Parent.AutoPostViewModel.CalculateTotals(e,!1),e.LinkedFieldName=this.IsBom?"BOM":"JOB",e.RefSeqNo=c}}}}if(this.AddedGridObj.TableColumns.Contains("AutoStage")&&!a.e.IsEmpty(this.AddGridData[D].AutoStage)&&null!=this.Parent.AutoProduce){let e;e=p>0&&this.AddedGridObj.TableColumns.Contains("DimID")?this.AutoProduce(this.Parent.AutoProduce,this.AddGridData[D],h,y,S,p,this.AddGridData[D].DimID.toString(),parseFloat(this.AddGridData[D].Qty)):this.AutoProduce(this.Parent.AutoProduce,this.AddGridData[D],h,y,S,0,"",parseFloat(this.AddGridData[D].Qty)),P.AutoRefSeqNo=e}if(36!=this.Parent.ScreenObject.DocumentType&&37!=this.Parent.ScreenObject.DocumentType&&this.Parent.ScreenObject.IsPurchase&&!a.e.IsEmpty(this.AddGridData[D].Qty)&&this.Parent.ScreenObject.Preferences.ContainsKey("CalcOpRate")&&""!=this.Parent.ScreenObject.Preferences.CalcOpRate.toString()&&Object(n.j)(this.Parent.ScreenObject.Preferences.CalcOpRate))if(this.ds.Tables.length>6){let e=this.ds.Tables[5].filter(e=>e.ProductID==P.ProductID_Key&&e.bomID==this.AddGridData[D].BomID);if(!a.e.IsEmpty(this.AddGridData[D].DimID)&&p>0&&this.ds.Columns[5].Contains("DimID")&&(e=e.filter(e=>e.DimID==this.AddGridData[D].DimID)),e.length>0)if(this.Parent.ScreenObject.Preferences.ContainsKey("QtyBasedCost")&&""!=this.Parent.ScreenObject.Preferences.QtyBasedCost.toString()&&Object(n.j)(this.Parent.ScreenObject.Preferences.QtyBasedCost)){let t=0;a.e.IsEmpty(this.AddGridData[D].ActualQty)||(t=(parseFloat(e[0].AMT)+T)/parseFloat(this.AddGridData[D].ActualQty)),P.Rate=t}else a.e.IsEmpty(e[0].AMT)||(P.Rate=(parseFloat(e[0].AMT)+T)/parseFloat(this.AddGridData[D].Qty));else if(e=this.ds.Tables[6].filter(e=>e.StageID==this.AddGridData[D].StageID&&e.bomID==this.AddGridData[D].BomID),!a.e.IsEmpty(this.AddGridData[D].DimID)&&p>0&&this.ds.Columns[6].Contains("DimID")&&(e=e.filter(e=>e.DimID==this.AddGridData[D].DimID)),e.length>0&&!a.e.IsEmpty(e[0].AMT))if(this.Parent.ScreenObject.Preferences.ContainsKey("QtyBasedCost")&&""!=this.Parent.ScreenObject.Preferences.QtyBasedCost.toString()&&Object(n.j)(this.Parent.ScreenObject.Preferences.QtyBasedCost)){let t=0;a.e.IsEmpty(this.AddGridData[D].ActualQty)||(t=(parseFloat(e[0].AMT)+T)/parseFloat(this.AddGridData[D].ActualQty)),P.Rate=t}else P.Rate=(parseFloat(e[0].AMT)+T)/parseFloat(this.AddGridData[D].Qty)}else{let e=this.Parent.ScreenObject.GetjobExpenses(this.JobNodeID.toString(),this.AddGridData[D].BomNodeID.toString()),t=e.Tables[0].filter(e=>e.ProductID==P.ProductID_Key&&e.bomID==this.AddGridData[D].BomNodeID);if(!a.e.IsEmpty(this.AddGridData[D].DimID)&&p>0&&this.ds.Columns[5].Contains("DimID")&&(t=t.filter(e=>e.DimID==this.AddGridData[D].DimID)),t.length>0)if(this.Parent.ScreenObject.Preferences.ContainsKey("QtyBasedCost")&&""!=this.Parent.ScreenObject.Preferences.QtyBasedCost.toString()&&Object(n.j)(this.Parent.ScreenObject.Preferences.QtyBasedCost)){let e=0;a.e.IsEmpty(t[0].AMT)||a.e.IsEmpty(this.AddGridData[D].ActualQty)||(e=(parseFloat(t[0].AMT)+T)/parseFloat(this.AddGridData[D].ActualQty)),P.Rate=e}else a.e.IsEmpty(t[0].AMT)||(P.Rate=parseFloat(t[0].AMT)/parseFloat(this.AddGridData[D].Qty));else if(t=e.Tables[1].filter(e=>e.StageID==this.AddGridData[D].StageNodeID&&e.bomID==this.AddGridData[D].BomNodeID),!a.e.IsEmpty(this.AddGridData[D].DimID)&&p>0&&e.Columns[1].Contains("DimID")&&(t=t.filter(e=>e.DimID==this.AddGridData[D].DimID)),t.length>0&&!a.e.IsEmpty(t[0].AMT))if(this.Parent.ScreenObject.Preferences.ContainsKey("QtyBasedCost")&&""!=this.Parent.ScreenObject.Preferences.QtyBasedCost.toString()&&Object(n.j)(this.Parent.ScreenObject.Preferences.QtyBasedCost)){let e=0;a.e.IsEmpty(this.AddGridData[D].ActualQty)||(e=(parseFloat(t[0].AMT)+T)/parseFloat(this.AddGridData[D].ActualQty)),P.Rate=e}else P.Rate=(parseFloat(t[0].AMT.toString())+T)/parseFloat(this.AddGridData[D].Qty.toString())}for(let e=0;e<this.Parent.Shortcuts.length;e++)this.Parent.Shortcuts[e]instanceof c.a&&5==this.Parent.Shortcuts[e].Mode&&this.Parent.ValidateData_Column(this.Parent.Shortcuts[e],P,!0)&&this.Parent.ScreenObject.GetExternalFuncData(this.Parent.Shortcuts[e].Mode,this.Parent.Shortcuts[e].SPName,this.Parent.Shortcuts[e].IPParams,this.Parent.Shortcuts[e].OPParams,P);this.Parent.CalculateTotals(P,!1)}this.Parent.ScreenObject.UpdateSequence(),this.Parent.RefreshGrid=!this.Parent.RefreshGrid;for(let t=0;t<this.Parent.Shortcuts.length;t++)this.Parent.Shortcuts[t]instanceof D.c&&5==this.Parent.Shortcuts[t].Mode&&this.Parent.ValidateData(this.Parent.Shortcuts[t],!0)&&this.Parent.ScreenObject.GetExternalFuncData(this.Parent.Shortcuts[t].Mode,this.Parent.Shortcuts[t].ToolTipFooterTitle,this.Parent.Shortcuts[t].ToolTipFooterDescription,this.Parent.Shortcuts[t].ToolTipDescription,null)}else{let e=0;for(let r=0;r<this.GridData.length;r++)if(Object(n.j)(this.GridData[r].Select)&&!a.e.IsEmpty(this.GridData[r].TobeUsed)&&"0"!=this.GridData[r].TobeUsed.toString()){e++;break}if(0==e)return void(this.DisplayMessage="Please select products");let t=0,s=!1;this.ds.Columns[0].Contains("DocumentType")&&this.ds.Tables[0].length>0&&"5"==this.ds.Tables[0][0].DocumentType.toString()&&(s=!0),this.GridObj.TableColumns.Contains("BatchXML")&&this.ds.Columns[0].push("BatchXML");for(let r=0;r<this.GridData.length;r++){let i=this.ds.Tables[0].filter(e=>e.DocDetailsID==this.GridData[r].DocDetailsID);if(i.length>0)if(t+=parseFloat(this.GridData[r].Balance),Object(n.j)(this.GridData[r].Select)&&!a.e.IsEmpty(this.GridData[r].TobeUsed)&&"0"!=this.GridData[r].TobeUsed.toString()){if(this.GridObj.TableColumns.Contains("BatchXML")&&!a.e.IsEmpty(this.GridData[r].BatchXML)&&(i[0].BatchXML=this.GridData[r].BatchXML.toString()),e++,a.e.String(i[0][this.ds.Columns[0][0]])!=this.GridData[r].TobeUsed.toString()&&"3"==i[0].ProductTypeID.toString()){let e=this.ds.Tables[0].filter(e=>e.DynamicInvDocDetailsID==this.GridData[r].DocDetailsID);for(let t=0;t<e.length;t++)if(e[t][1].toString().toLowerCase().Contains("dcnum")){let s=this.ds.Tables[2].filter(s=>s.InvDocDetailsID==e[t].DocDetailsID.toString()),i=this.ds.Tables[2].filter(e=>e.InvDocDetailsID==this.GridData[r].DocDetailsID.toString());i.length>0&&s.length>0&&(e[t][this.ds.Columns[0][0]]=parseFloat(s[0][e[t][this.ds.Columns[0][1]].toString()].toString())/parseFloat(i[0][e[t][this.ds.Columns[0][1]].toString()].toString())*parseFloat(this.GridData[r].TobeUsed.toString()))}else e[t][this.ds.Columns[0][0]]=parseFloat(e[t].Quantity.toString())/parseFloat(i[0].Quantity.toString())*parseFloat(this.GridData[r].TobeUsed.toString())}i[0][this.ds.Columns[0][0]]=this.GridData[r].TobeUsed.toString(),this.GridObj.TableColumns.Contains("ScannedBarcodes")&&!a.e.IsEmpty(this.GridData[r].ScannedBarcodes)&&(this.ds.Columns[0].Contains("ScannedBarcodes")||this.ds.Columns[0].push("ScannedBarcodes"),i[0].ScannedBarcodes=this.GridData[r].ScannedBarcodes.toString())}else{let e,t=this.ds.Tables[0].filter(e=>e.DynamicInvDocDetailsID==this.GridData[r].DocDetailsID);for(let s=0;s<t.length;s++)e=this.ds.Tables[0].indexOf(t[s]),this.ds.Tables[1].RemoveAt(e),this.ds.Tables[2].RemoveAt(e),this.ds.Tables[3].RemoveAt(e),this.ds.Tables[0].RemoveAt(e);let a=i[0].DocSeqNo;e=this.ds.Tables[0].indexOf(i[0]),this.ds.Tables[0].RemoveAt(e),this.ds.Tables[1].RemoveAt(e),this.ds.Tables[2].RemoveAt(e),this.ds.Tables[3].RemoveAt(e),t=this.ds.Tables[7].filter(e=>e.RowSeqNo==a);for(let s=0;s<t.length;s++)e=this.ds.Tables[7].indexOf(t[s]),this.ds.Tables[7].RemoveAt(e);s&&(i=this.ds.Tables[0].filter(e=>e.DocSeqNo==a),i.length>0&&(e=this.ds.Tables[0].indexOf(i[0]),this.ds.Tables[0].RemoveAt(e),this.ds.Tables[1].RemoveAt(e),this.ds.Tables[2].RemoveAt(e),this.ds.Tables[3].RemoveAt(e)))}}if(0==e)return void(this.DisplayMessage="Please select products");let i=0;for(let n=0;n<this.Parent.ScreenObject.GridData.length;n++)if(a.e.IsEmpty(this.Parent.ScreenObject.GridData[n].ProductID_Key)&&a.e.IsEmpty(this.Parent.ScreenObject.GridData[n].LinkedInvDocDetailsID)){i=n;break}this.Parent.LoadLinkData(this.ds,[],i,[],null,this.Scannedpacks)}"OK"==e.toString()&&i.a.page.HideDialog()}else if("Cancel"==e.toString()){if(0==this.JobNodeID){this.Parent.IsSelectAll=!0;let e="";for(let t=0;t<this.ds.Tables[0].length;t++)if(e!=this.ds.Tables[0][t].VoucherNO.toString()){e=this.ds.Tables[0][t].VoucherNO.toString();var h=this.Parent.ScreenObject.Link.DocumentList.Items.find(t=>t.Name.toLowerCase()==e.toLowerCase());null!=h&&(h.IsChecked=!1)}this.Parent.IsSelectAll=!1}this.Parent.DialogResult=!1,i.a.page.HideDialog(),this.Parent.IsFirstCallSelective&&(i.a.page.removeActiveTab(),this.Parent.IsFirstCallSelective=!1)}}chngeRowPOstion(e){let t=0,s=!1;e.Columns[0].Contains("DocumentType")&&e.Tables[0].length>0&&"5"==e.Tables[0][0].DocumentType.toString()&&(s=!0);for(let i=0;i<this.GridData.length;i++){let a=e.Tables[0].filter(e=>e.DocDetailsID==this.GridData[i].DocDetailsID.toString());a.length>0&&(a[0].sno=t++,s&&(a=e.Tables[0].filter(e=>e.DocSeqNo==a[0].DocSeqNo.toString()),a.length>0&&(a[0].sno=t)))}}GetBatchNo(e,t){let s="",i=0,n=new a.f;n.LoadXml(e);let r=n.SelectNodes("XML/Row");for(let l=0;l<r.length;l++){let e=r[l];if(null!=e.attributes.CCCID&&!a.e.IsEmpty(e.attributes.CCCID.value)&&"53730"==e.attributes.CCCID.value&&t.Table.Columns.Contains("ProductName"))i=a.e.Int(e.attributes.Length.value),null!=e.attributes.Length&&!a.e.IsEmpty(e.attributes.Length.value)&&a.e.IsNum(e.attributes.Length.value)&&-1!=i&&a.e.String(t.ProductName).length>i?s+=t.ProductName.toString().substr(0,i):s+=a.e.String(t.ProductName);else if(null!=e.attributes.CCCID&&!a.e.IsEmpty(e.attributes.CCCID.value)&&"53731"==e.attributes.CCCID.value&&t.Table.Columns.Contains("ProductCode"))i=a.e.Int(e.attributes.Length.value),null!=e.attributes.Length&&!a.e.IsEmpty(e.attributes.Length.value)&&a.e.IsNum(e.attributes.Length.value)&&-1!=i&&t.ProductCode.toString().length>i?s+=t.ProductCode.toString().substr(0,i):s+=t.ProductCode.toString();else if(null!=e.attributes.Name&&!a.e.IsEmpty(e.attributes.Name.value)&&e.attributes.Name.value.toLowerCase().Contains("ccnid"))if(t.Table.Columns.Contains("dc"+e.attributes.Name.value)&&""!=t["dc"+e.attributes.Name.value].toString())i=a.e.Int(e.attributes.Length.value),null!=e.attributes.Length&&!a.e.IsEmpty(e.attributes.Length.value)&&a.e.IsNum(e.attributes.Length.value)&&-1!=i&&t["dc"+e.attributes.Name.value].toString().length>i?s+=t["dc"+e.attributes.Name.value].toString().substr(0,i):s+=t["dc"+e.attributes.Name.value].toString();else{var o=this.Parent.ScreenObject._CCFields.find(t=>t.DBColumnName.toLowerCase()=="dc"+e.attributes.Name.value.toLowerCase());o&&o.SelectedValue>0&&!a.e.IsEmpty(o.Text)&&(i=a.e.Int(e.attributes.Length.value),null==e.attributes.CCCID||a.e.IsEmpty(e.attributes.CCCID.value)?null!=e.attributes.Length&&!a.e.IsEmpty(e.attributes.Length.value)&&a.e.IsNum(e.attributes.Length.value)&&-1!=i&&o.Text.length>i?s+=o.Text.substr(0,i):s+=o.Text:null!=e.attributes.Length&&!a.e.IsEmpty(e.attributes.Length.value)&&a.e.IsNum(e.attributes.Length.value)&&-1!=i&&o.Text.length>i?s+=this.Parent.ScreenObject.GetCodeNameString(o.CCID,o.SelectedValue,e.attributes.CCCID.value).substr(0,i):s+=this.Parent.ScreenObject.GetCodeNameString(o.CCID,o.SelectedValue,e.attributes.CCCID.value))}else if(null!=e.attributes.Name&&!a.e.IsEmpty(e.attributes.Name.value)&&"SEQUENCE_NO"==e.attributes.Name.value){let t=0,i=this.Parent.ScreenObject.getBatchSeq(s);s+="#SEQ#",i++,null==e.attributes.Length||a.e.IsEmpty(e.attributes.Length.value)||(t=a.e.Int(e.attributes.Length.value));let n=i.toString();for(;n.length<t;)n="0"+n;s=s.Replace("#SEQ#",n)}null==e.attributes.Delimiter||a.e.IsEmpty(e.attributes.Delimiter.value)||(s+=e.attributes.Delimiter.value)}return s}CallReference_3(e,t,s){var i=e.ScreenObject.ColumnSource.find(e=>e.DisplayMember.toLowerCase()=="dcccnid"+(t-5e4));i&&e.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&e.LocalReference==i.ID).length>0&&e.ScreenObject.GetLinkReferenceData(parseInt(i.ID),e.DocumentID,parseInt(s[i.ValueMember]),Date.Today(),"",i.CostCenterID,s)}CallReference_2(e,t){e.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&e.LocalReference==t.DBColumnID).length>0&&e.ScreenObject.GetLinkReferenceData(t.DBColumnID,e.DocumentID,t.SelectedValue,Date.Today(),"",t.CCID,null)}AutoProduce(e,t,s,n,r,o,l,h){let c,d,D=a.e.NewGuid(),m=0,b="",S=this.ds.Tables[3].filter(e=>e.BOMID==t.BomID&&e.StageNodeID==t.AutoStage);if(S.length>0&&(b=a.e.String(S[0].StageID)),c=a.e.IsEmpty(t.ProductID_Key)?a.e.String(t.ProductID):t.ProductID_Key.toString(),d=this.ds.Tables[1].filter(o>0?e=>2==e.ProductUse&&e.BOMID==t.BomID&&e.StageID==b&&e.ProductID==c&&e.DimID==l:e=>2==e.ProductUse&&e.BOMID==t.BomID&&e.StageID==b&&e.ProductID==c),d.length>0&&!a.e.IsEmpty(d[0].Quantity)){let b=parseFloat(d[0].Quantity);if(d=this.ds.Tables[1].filter(o>0?e=>1==e.ProductUse&&e.BOMID==d[0].BomID&&e.StageID==d[0].StageID&&e.ProductID==c&&e.DimID==l:e=>1==e.ProductUse&&e.BOMID==d[0].BomID&&e.StageID==d[0].StageID&&e.ProductID==c),d.length>0){e.ScreenObject._CCFields.forEach(e=>{var t=this.Parent.ScreenObject._CCFields.find(t=>t.DBColumnName==e.DBColumnName);t&&e instanceof u.b&&t instanceof u.b&&(e.SelectedValue=t.SelectedValue,e.SelectedValueText=t.Text)}),e.ScreenObject.Preferences.ContainsKey("jobCCID")?e.ScreenObject.Preferences.jobCCID=s.toString():e.ScreenObject.Preferences.push("jobCCID",s.toString()),a.e.IsEmpty(this.ds.Tables[2][0].StageCCID)||(e.ScreenObject.Preferences.ContainsKey("StageCCID")?e.ScreenObject.Preferences.StageCCID=r.toString():e.ScreenObject.Preferences.push("StageCCID",r.toString()));let S=0;for(let t=0;t<e.ScreenObject.GridData.length;t++)if(a.e.IsEmpty(e.ScreenObject.GridData[t].ProductID_Key)){S=t;break}if(!e.ScreenObject.GridDataObj.TableColumns.Contains("dcccnid"+(r-5e4)+"_Key")){var C=e.ScreenObject._CCFields.find(e=>e instanceof u.b&&e.CCID==r);C instanceof u.b&&(C.SelectedValue=parseInt(t.AutoStage))}e.ScreenObject.GridDataObj.TableColumns.Contains("dcccnid"+(s-5e4)+"_Key")||(y=e.ScreenObject._CCFields.find(e=>e instanceof u.b&&e.CCID==s))instanceof u.b&&(y.SelectedValue=this.JobNodeID,i.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==i.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&(y.SelectedValueText=this.VoucherNo));for(let c=0;c<d.length;c++,S++)if(!a.e.IsEmpty(d[c].Quantity)){let C=e.ScreenObject.GridDataObj.NewRow();if(e.ScreenObject.GridData.InsertAt(C,S),!a.e.IsEmpty(l)&&o>0)if(e.ScreenObject.GridDataObj.TableColumns.Contains("JobUnqID")||e.ScreenObject.GridDataObj.TableColumns.push("JobUnqID"),C.JobUnqID=l,e.ScreenObject.GridDataObj.TableColumns.Contains("dcccnid"+(o-5e4)+"_Key")){if(C["dcccnid"+(o-5e4)+"_Key"]=l,this.ds.Columns[0].Contains("DimName")){let e=this.ds.Tables[0].filter(e=>e.DimID==l);e.length>0&&(C["dcccnid"+(o-5e4)]=e[0].DimName)}this.CallReference_3(e,o,C)}else if(0==c&&(y=e.ScreenObject._CCFields.find(e=>e instanceof u.b&&e.CCID==o))instanceof u.b&&(y.SelectedValue=parseInt(l),i.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==i.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&this.ds.Columns[0].Contains("DimName"))){let e=this.ds.Tables[0].filter(e=>e.DimID==l);e.length>0&&(y.SelectedValueText=e[0].DimName.toString())}if(this.ds.Columns[1].Contains("CCNodeID")&&!a.e.IsEmpty(d[c].CCNodeID)&&n>0)if(e.ScreenObject.GridDataObj.TableColumns.Contains("BOMID")||e.ScreenObject.GridDataObj.TableColumns.push("BOMID"),C.BOMID=d[c].CCNodeID.toString(),e.ScreenObject.GridDataObj.TableColumns.Contains("dcccnid"+(n-5e4)+"_Key")){if(C["dcccnid"+(n-5e4)+"_Key"]=d[c].CCNodeID.toString(),this.ds.Columns[0].Contains("BomName")){let e=this.ds.Tables[0].filter(e=>e.CCNodeID==d[c].CCNodeID);e.length>0&&(C["dcccnid"+(n-5e4)]=e[0].BomName)}this.CallReference_3(e,n,C)}else if(0==c&&(y=e.ScreenObject._CCFields.find(e=>e instanceof u.b&&e.CCID==n))instanceof u.b&&(y.SelectedValue=parseInt(d[c].CCNodeID),this.CallReference_2(e,y),i.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==i.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&this.ds.Columns[0].Contains("BomName"))){let e=this.ds.Tables[0].filter(e=>e.CCNodeID==d[c].CCNodeID);e.length>0&&(y.SelectedValueText=e[0].BomName.toString())}e.ScreenObject.GridDataObj.TableColumns.Contains("VoucherType")&&(C.VoucherType="-1"),C.ProductID_Key=d[c].ProductID,e.ScreenObject.GridDataObj.TableColumns.Contains("ProductName")&&(C.ProductName=d[c].ProductName.toString()),e.ScreenObject.GridDataObj.TableColumns.Contains("ProductCode")&&(C.ProductCode=d[c].ProductCode.toString()),e.ScreenObject.GridDataObj.TableColumns.Contains("Unit")&&(C.Unit=d[c].UnitName.toString()),e.ScreenObject.GridDataObj.TableColumns.Contains("Unit_Key")&&(C.Unit_Key=d[c].UOMID),C.defaultQuantity=parseFloat(d[c].Quantity)/b,C.Quantity=parseFloat(C.defaultQuantity)*h,a.e.IsEmpty(C.Quantity)||(p=e.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&55259==e.LinkData)).length>0&&e.ScreenObject.GridDataObj.TableColumns.Contains(p[0].SysColumnName.toString())&&(C[p[0].SysColumnName]=C.Quantity),C.Type=d[c].ProductTypeID,e.AddProductData(C,!1,!0),e.ScreenObject.GridDataObj.TableColumns.Contains("RefNo")&&(C.RefNo=this.VoucherNo),e.ScreenObject.GridDataObj.TableColumns.Contains("dcccnid"+(s-5e4)+"_Key")&&(C["dcccnid"+(s-5e4)+"_Key"]=this.JobNodeID,C["dcccnid"+(s-5e4)]=this.VoucherNo),e.ScreenObject.GridDataObj.TableColumns.Contains("jobID")||e.ScreenObject.GridDataObj.TableColumns.push("jobID"),C.jobID=this.JobNodeID,r>0&&!a.e.IsEmpty(t.AutoStage)&&(e.ScreenObject.GridDataObj.TableColumns.Contains("dcccnid"+(r-5e4)+"_Key")&&(C["dcccnid"+(r-5e4)+"_Key"]=t.AutoStage),e.ScreenObject.GridDataObj.TableColumns.Contains("StageID")||e.ScreenObject.GridDataObj.TableColumns.push("StageID"),C.StageID=t.AutoStage),a.e.IsNum(C.UOMConversion)&&(C.UOMConvertedQty=parseFloat(C.UOMConversion)*parseFloat(C.Quantity)),e.CalculateTotals(C,!1),C.LinkedFieldName=this.IsBom?"BOM":"JOB",a.e.IsEmpty(C.Gross)||(m+=parseFloat(C.Gross)),C.AutoRefSeqNo=D}if(e.ScreenObject.GridDataObj.TableColumns.Contains("VoucherType")){d=this.ds.Tables[1].filter(o>0?e=>e.ProductUse=e.BOMID==d[0].BOMID&&e.StageID==d[0].StageID&&e.DimID==l:e=>e.ProductUse=e.BOMID==d[0].BOMID&&e.StageID==d[0].StageID);for(let m=0;m<d.length;m++,S++){let C=e.ScreenObject.GridDataObj.NewRow();if(e.ScreenObject.GridData.InsertAt(C,S),!a.e.IsEmpty(l)&&o>0)if(e.ScreenObject.GridDataObj.TableColumns.Contains("JobUnqID")||e.ScreenObject.GridDataObj.TableColumns.push("JobUnqID"),C.JobUnqID=l,e.ScreenObject.GridDataObj.TableColumns.Contains("dcccnid"+(o-5e4)+"_Key")){if(C["dcccnid"+(o-5e4)+"_Key"]=l,this.ds.Columns[0].Contains("DimName")){let e=this.ds.Tables[0].filter(e=>e.DimID==l);e.length>0&&(C["dcccnid"+(o-5e4)]=e[0].DimName)}}else if(0==m&&(y=e.ScreenObject._CCFields.find(e=>e instanceof u.b&&e.CCID==o))instanceof u.b&&(y.SelectedValue=parseInt(l),i.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==i.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&this.ds.Columns[0].Contains("DimName"))){let e=this.ds.Tables[0].filter(e=>e.DimID==l);e.length>0&&(y.SelectedValueText=e[0].DimName.toString())}if(this.ds.Columns[1].Contains("CCNodeID")&&!a.e.IsEmpty(d[m].CCNodeID)&&n>0)if(e.ScreenObject.GridDataObj.TableColumns.Contains("BOMID")||e.ScreenObject.GridDataObj.TableColumns.push("BOMID"),C.BOMID=d[m].CCNodeID,e.ScreenObject.GridDataObj.TableColumns.Contains("dcccnid"+(n-5e4)+"_Key")){if(C["dcccnid"+(n-5e4)+"_Key"]=d[m].CCNodeID,this.ds.Columns[0].Contains("BomName")){let e=this.ds.Tables[0].filter(e=>e.CCNodeID==d[m].CCNodeID);e.length>0&&(C["dcccnid"+(n-5e4)]=e[0].BomName)}this.CallReference_3(e,n,C)}else if(0==m){var y;if((y=e.ScreenObject._CCFields.find(e=>e instanceof u.b&&e.CCID==n))instanceof u.b&&(y.SelectedValue=parseInt(d[m].CCNodeID),this.CallReference_2(e,y),i.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==i.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()&&this.ds.Columns[0].Contains("BomName"))){let e=this.ds.Tables[0].filter(e=>e.CCNodeID==d[m].CCNodeID);e.length>0&&(y.SelectedValueText=e[0].BomName.toString())}}var p;C.VoucherType="1",C.ProductID_Key=d[m].ProductID,e.ScreenObject.GridDataObj.TableColumns.Contains("ProductName")&&(C.ProductName=d[m].ProductName.toString()),e.ScreenObject.GridDataObj.TableColumns.Contains("ProductCode")&&(C.ProductCode=d[m].ProductCode.toString()),e.ScreenObject.GridDataObj.TableColumns.Contains("Unit")&&(C.Unit=d[m].UnitName.toString()),e.ScreenObject.GridDataObj.TableColumns.Contains("Unit_Key")&&(C.Unit_Key=d[m].UOMID),c==d[m].ProductID?(C.defaultQuantity=h,C.Quantity=h):(C.defaultQuantity=h/b,C.Quantity=parseFloat(C.defaultQuantity)*parseFloat(d[m].Quantity)),a.e.IsEmpty(C.Quantity)||(p=e.ScreenObject.Data.Tables[0].filter(e=>null!=e.LocalReference&&79==e.LocalReference&&55259==e.LinkData)).length>0&&e.ScreenObject.GridDataObj.TableColumns.Contains(p[0].SysColumnName)&&(C[p[0].SysColumnName]=C.Quantity),C.Type=d[m].ProductTypeID,e.AddProductData(C,!1,!0),e.ScreenObject.GridDataObj.TableColumns.Contains("RefNo")&&(C.RefNo=this.VoucherNo),e.ScreenObject.GridDataObj.TableColumns.Contains("dcccnid"+(s-5e4)+"_Key")&&(C["dcccnid"+(s-5e4)+"_Key"]=this.JobNodeID,C["dcccnid"+(s-5e4)]=this.VoucherNo),e.ScreenObject.GridDataObj.TableColumns.Contains("jobID")||e.ScreenObject.GridDataObj.TableColumns.push("jobID"),C.jobID=this.JobNodeID,r>0&&!a.e.IsEmpty(t.AutoStage)&&(e.ScreenObject.GridDataObj.TableColumns.Contains("dcccnid"+(r-5e4)+"_Key")&&(C["dcccnid"+(r-5e4)+"_Key"]=t.AutoStage.toString()),e.ScreenObject.GridDataObj.TableColumns.Contains("StageID")||e.ScreenObject.GridDataObj.TableColumns.push("StageID"),C.StageID=t.AutoStage),a.e.IsNum(C.UOMConversion)&&(C.UOMConvertedQty=parseFloat(C.UOMConversion)*parseFloat(C.Quantity)),e.CalculateTotals(C,!1),C.LinkedFieldName=this.IsBom?"BOM":"JOB",C.AutoRefSeqNo=D}}}}return D}}}}]);
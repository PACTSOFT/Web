function _defineProperties(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var i,s=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;i=Reflect.construct(s,arguments,n)}else i=s.apply(this,arguments);return _possibleConstructorReturn(this,i)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[173],{CxGV:function(e,t,i){"use strict";i.r(t),i.d(t,"DeletedRecords",(function(){return g})),i.d(t,"AddUOMViewModel",(function(){return b}));var s=i("Do2H"),n=i("Lp6j"),a=i("ScVY"),r=i("NkMH"),o=i("0/4Q"),l=i("4HhE"),d=i("Agar"),u=i("8B8H"),h=i("ockk"),c=i("EQd/"),g=function e(t){_classCallCheck(this,e),this.iSeqno=0,this.iSeqno=t},b=function(e){_inherits(i,e);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this)).ScreenName="",e.SaveUOM=new l.b,e.SelectionChangedCommand=new l.b,e.DeleteBase=new l.b,e.NewBase=new l.b,e.cmnItem_Click=new l.b,e.ButtonSave=new r.a,e.lstDeletedRecords=[],e.textChangedUnit=new l.b,e.Units1=new o.e(0),e.PACTControlData=[],e.GridUnitsObj=new u.a,e.BaseTextObj=new c.d(0),e.res="",e.SNO=1,e.RetValue=0,e.Flag=!1,e.textChangedUnit.Subscribe(_assertThisInitialized(e),"ontextChangedUnit"),Logger.InfoLog("AddUOMViewModel::Entering AddUOMViewModel"),e.DisplayName=s.a.GetResource("UOM_ScreenName"),s.a.SessionManager.HideUnathorizedAccess?e.ButtonSave.Visible=s.a.SessionManager.IsActionAssigned(11,"Create"):e.ButtonSave.Enable=s.a.SessionManager.IsActionAssigned(11,"Create"),s.a.SessionManager.HideUnathorizedAccess&&!e.ButtonSave.Visible?e.ButtonSave.Visible=s.a.SessionManager.IsActionAssigned(11,"Update"):e.ButtonSave.Enable||(e.ButtonSave.Enable=s.a.SessionManager.IsActionAssigned(11,"Update")),e.MessageVisibility=!1,e.SaveUOM.Subscribe(_assertThisInitialized(e),"onSaveUOM"),e.NewBase.Subscribe(_assertThisInitialized(e),"NewBase_Click"),e.SelectionChangedCommand.Subscribe(_assertThisInitialized(e),"onSelectionChanged"),e.DeleteBase.Subscribe(_assertThisInitialized(e),"onDeleteBase"),e.cmnItem_Click.Subscribe(_assertThisInitialized(e),"OnCmnItem_Click"),new d.a(0),e.ScreenID="1002",e.PactScreenID="1002",e.ScreenName="Create UOM",e.DetailsVisibility=!0,e.BindBase(),e.BindGridUnits(),Logger.InfoLog("AddUOMViewModel::Exiting AddUOMViewModel"),e}return _createClass(i,[{key:"OnCmnItem_Click",value:function(e){if(Logger.InfoLog("AddUOMViewModel::Entering OnCmnItem_Click"),this.SelectedNode<0)this.DisplayMessage="Please Select Particular cell to remove",this.MessageVisibility=!0;else switch(this.SelectedNode<this.dtTable.length&&(this.res=""),e){case"DELETE":for(var t=0,i=0;i<this.dtTable.length;i++)if(t=parseInt(this.dtTable[i].SNO),this.SelectedNode==t-1&&!n.e.IsEmpty(this.dtTable[i].UnitID)&&!n.e.IsEmpty(this.dtTable[i].PrimayColumn)){if("1"!=this.dtTable[i].UnitID.toString()){confirm("Are you Sure You Want To Delete this Unit ? ")?(this.lstDeletedRecords.push(new g(parseInt(this.dtTable[i].PrimayColumn.toString()))),this.res="Yes"):this.res="No";break}confirm("This Unit will delete Base name:Are you sure ? ")?(this.onDeleteBase(this.dtTable[i].BaseID.toString()),this.res="Yes"):this.res="No";break}this.dtTable.length>0&&"Yes"==this.res&&(this.dtTable.RemoveAt(this.SelectedNode),this.UpdateSequence())}Logger.InfoLog("AddUOMViewModel::Exiting OnCmnItem_Click")}},{key:"OnMessageCallBack",value:function(){this.res="Yes"}},{key:"onCanCmnItem_Click",value:function(e){return!0}},{key:"NewBase_Click",value:function(e){Logger.InfoLog("AddUOMViewModel::Entering NewBase_Click");try{this.SelectedType="0",this.Units1.Items.Clear(),this.SelectedText="",this.GridUnitsObj.Clear(),this.BaseText=""}catch(t){Logger.ErrorLog("AddUOMViewModel:: NewBase_Click"+t.stack)}}},{key:"GridUnits_TableNewRow",value:function(e,t){this.UpdateSequence(),t.Row.SNO=this.SNO}},{key:"UpdateSequence",value:function(){var e=this;this.SNO=1,this.dtTable.forEach((function(t){t.SNO=e.SNO++,e.GridUnitsObj.updateRow(t)}))}},{key:"GetGridHeader",value:function(){this.GridUnitsObj.TableColumns.push("PrimayColumn"),this.GridUnitsObj.TableColumns.push("SNO"),this.GridUnitsObj.TableColumns.push("Unit Name"),this.GridUnitsObj.TableColumns.push("Conversion Rate"),this.GridUnitsObj.TableColumns.push("UnitID"),this.GridUnitsObj.TableColumns.push("BaseID");for(var e=this.dtTable.length;e<10;e++){var t=this.GridUnitsObj.NewRow();t.SNO=e+1,this.GridUnitsObj.addRow(t)}this.Columns=[];var i=new h.a;i.Header="SNO",i.DisplayMember="SNO",i.Width=50,i.ReadOnly=!0,this.Columns.push(i),(i=new h.a).Header=s.a.GetResource("UOM_UnitName"),i.DisplayMember="Unit Name",i.Width=200,this.Columns.push(i),(i=new h.a).Header="Conv. Rate",i.DisplayMember="Conversion Rate",i.DataType="FLOAT",i.Width=150,this.Columns.push(i)}},{key:"BindGridUnits",value:function(){return this.GridUnitsObj.Clear(),this.GetGridHeader(),this.dtTable}},{key:"onDeleteBase",value:function(e){if(null!=this.SelectedType&&"-100"!=this.SelectedType.toString()){Logger.InfoLog("AddUOMViewModel::Entering onDeleteBase");var t,i=[];i.push(this.SelectedType),i.push(0),i.push(s.a.SessionManager.RoleID),i.push(s.a.SessionManager.LanguageID);var n=s.a.inventory.RemoveUOM(this.SelectedType,0),a=n.RetValue;t=n.Message,this.RetValue=a,a>0?(this.SelectedType="0",this.Units1.Items.Clear(),this.SelectedText="",this.GridUnitsObj.Clear(),this.BaseText="",this.BindBase(),this.DisplayMessage=s.a.GetResource("UOM_Del"),this.MessageVisibility=!0,this.BaseVisibility=!1):(this.DisplayMessage=t,this.MessageVisibility=!0),Logger.InfoLog("AddUOMViewModel::Exiting onDeleteBase")}}},{key:"onCanDeleteBase",value:function(e){return!0}},{key:"onSaveUOM",value:function(e){var t=this;Logger.InfoLog("AddUOMViewModel::Entering onSaveUOM");try{this.MessageVisibility=!1;var i={},a="";if(n.e.IsEmpty(this.BaseText))return this.DisplayMessage=s.a.GetResource("CannotSaveBlankUOM"),void(this.MessageVisibility=!0);if(a+="<XML>",null!=this.GridUnits&&this.GridUnits.length>0){for(var r=0;r<this.GridUnits.length;r++)n.e.IsEmpty(this.GridUnits[r]["Unit Name"])?n.e.IsEmpty(this.GridUnits[r].PrimayColumn)?a+="<Row RowNo='"+(r+1)+"' PrimaryKey='0' UName='"+n.e.String(this.GridUnits[r]["Unit Name"])+"'  ConversionRate='"+n.e.String(this.GridUnits[r]["Conversion Rate"])+"' MapAction='DELETE' />":a+="<Row RowNo='"+(r+1)+"' PrimaryKey='"+this.GridUnits[r].PrimayColumn.toString()+"' UName='"+n.e.String(this.GridUnits[r]["Unit Name"])+"'  ConversionRate='"+n.e.String(this.GridUnits[r]["Conversion Rate"])+"' MapAction='DELETE' />":n.e.IsEmpty(this.GridUnits[r].PrimayColumn)?a+="<Row RowNo='"+(r+1)+"' PrimaryKey='0' UName='"+this.GridUnits[r]["Unit Name"].toString()+"'  ConversionRate='"+n.e.String(this.GridUnits[r]["Conversion Rate"])+"' MapAction='NEW' />":a+="<Row RowNo='"+(r+1)+"' PrimaryKey='"+this.GridUnits[r].PrimayColumn.toString()+"' UName='"+this.GridUnits[r]["Unit Name"].toString()+"'  ConversionRate='"+n.e.String(this.GridUnits[r]["Conversion Rate"])+"' MapAction='UPDATE' />";for(var o=0;o<this.lstDeletedRecords.length;o++)a+='<Row MapAction="DELETE"',a+=' PrimaryKey="'+this.lstDeletedRecords[o].iSeqno+'"/>'}else a+="<Row RowNo='1' PrimaryKey='0' UName=''  ConversionRate='' MapAction='NEW' />";a+="</XML>";i.Address1=this.BaseText,i.Address2=n.e.StringIsNullOrEmpty(this.SelectedType)?0:this.SelectedType,i.Address3=a.toString(),i.IsGroup=!1,s.a.inventory.AddUOM(i,"AddUOM").subscribe((function(e){t.DisplayMessage=e.Message,t.RetValue=e.RetValue,t.MessageVisibility=!0,t.RetValue>0?(t.GridUnitsObj.Clear(),t.BindBase(),t.DisplayMessage=s.a.GetResource("UOM_Saved"),t.MessageVisibility=!0,t.BaseVisibility=!1):(t.DisplayMessage=e.Message,t.MessageVisibility=!0)}),(function(e){alert(JSON.stringify(e)),console.log("AddUOMViewModel::Exiting OnSaveUOM"+JSON.stringify(e))})),Logger.InfoLog("AddUOMViewModel::Exiting OnSaveUOM")}catch(l){Logger.ErrorLog("AddUOMViewModel:: OnSaveUOM"+l.stack)}}},{key:"onCanSaveUOM",value:function(e){return!0}},{key:"onSelectionChanged",value:function(e){var t=null;this.DisplayMessage="",this.MessageVisibility=!1,Logger.InfoLog("AddUOMViewModel::Entering SelectionChanged event");try{"-100"==e?(this.GridUnitsObj.Clear(),this.lstDeletedRecords.Clear(),this.BaseText="",this.BaseVisibility=!0):this.BaseVisibility=!0;var i=[];if(i.push(this.SelectedType),i.push(s.a.SessionManager.UserID),i.push(s.a.SessionManager.LanguageID),null!=this.SelectedType&&(t=s.a.inventory.getUOM2(this.ScreenID,i)),this.GridUnitsObj.Clear(),null!=t&&t.Tables.length>0&&t.Tables[0].length>0){this.BaseText=t.Tables[0][0].BaseName.toString();for(var n=0;n<t.Tables[0].length;n++){var a=this.GridUnitsObj.NewRow();a.SNO=n+1,a.PrimayColumn=t.Tables[0][n].UOMID.toString(),a["Unit Name"]=t.Tables[0][n].UnitName.toString(),a["Conversion Rate"]=t.Tables[0][n].Conversion.toString(),a.UnitID=t.Tables[0][n].UNITID.toString(),a.BaseID=null,this.GridUnitsObj.addRow(a)}}for(var r=this.GridUnits.length;r<10;r++){var o=this.GridUnitsObj.NewRow();o.SNO=r+1,this.GridUnitsObj.addRow(o)}}catch(l){Logger.ErrorLog("AddUOMViewModel:: onSelectionChanged"+l.stack)}Logger.InfoLog("AddUOMViewModel::Exiting onSelectionChanged")}},{key:"onCanSelectionChanged",value:function(e){return!0}},{key:"BindBase",value:function(){var e=this;this.Units1.Items.Clear(),this.ScreenData=this.BuildControls(),null!=this.ScreenData&&this.ScreenData.Tables[0].forEach((function(t){e.Units1.Items.push(o.d.ComboBoxItems_2(t[Object.keys(t)[1]].toString(),t[Object.keys(t)[0]].toString()))})),this.Units1.Items.push(o.d.ComboBoxItems_2("New","-100"))}},{key:"BuildControls",value:function(){Logger.InfoLog("AddUOMViewModel::Entering BuildControls");try{var e=[];e.push(0),e.push(s.a.SessionManager.UserID),e.push(s.a.SessionManager.LanguageID);var t=s.a.inventory.getUOM2(this.ScreenID,e);return null!=t&&t.Tables[0].length>0&&t.Tables.length>0?t:null}catch(i){return Logger.ErrorLog("AddUOMViewModel:: BuildControls"+i.stack),null}}},{key:"ontextChangedUnit",value:function(e){}},{key:"BindGrid",value:function(){var e=[],t=[];if(t.push(this.SelectedType),t.push(s.a.SessionManager.UserID),t.push(s.a.SessionManager.LanguageID),null!=this.SelectedType&&(e=s.a.inventory.getUOM2(this.ScreenID,t)),this.dtTable.Clear(),null!=e&&e.Tables.length>0&&e.Tables[0].length>0){this.BaseText=e.Tables[0][0].BaseName.toString();for(var i=0;i<e.Tables[0].length;i++)this.dtTable.push([e.Tables[0][i].UOMID.toString(),i+1,e.Tables[0][i].UnitName.toString(),e.Tables[0][i].Conversion.toString(),e.Tables[0][i].UnitID.toString(),e.Tables[0][i].BaseID.toString()])}for(var n=this.GridUnits.length;n<10;n++){var a=this.GridUnitsObj.NewRow();a.SNO=n+1,this.GridUnitsObj.addRow(a)}}},{key:"dtTable",get:function(){return this.GridUnitsObj.Table}},{key:"BaseVisibility",get:function(){return this._BaseVisibility},set:function(e){this._BaseVisibility=e,e&&(this._DetailsVisibility=!1)}},{key:"DetailsVisibility",get:function(){return this._DetailsVisibility},set:function(e){this._DetailsVisibility=e,e&&(this._BaseVisibility=!1)}},{key:"angularGrid",get:function(){return this.GridUnitsObj.angularGrid}},{key:"GridUnits",get:function(){return this.GridUnitsObj.Table}},{key:"Columns",get:function(){return this.GridUnitsObj.Columns},set:function(e){this.GridUnitsObj.Columns=e}},{key:"GridUnitsColumns",get:function(){return this.GridUnitsObj.TableColumns}},{key:"GridUnitsColumnSource",get:function(){return this.GridUnitsObj.Columns}},{key:"BaseText",get:function(){return this.BaseTextObj.Text},set:function(e){e!=this.BaseTextObj.Text&&(this.BaseTextObj.Text=e)}}]),i}(a.b)}}]);
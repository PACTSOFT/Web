(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{bSOb:function(e,t,s){"use strict";s.r(t),s.d(t,"AddPriceChartNewViewModel",(function(){return y})),s.d(t,"AddGroupViewModel",(function(){return b}));var i=s("8B8H"),r=s("ockk"),l=s("0/4Q"),a=s("Do2H"),n=s("Lp6j"),o=s("eQJW"),h=s("EQd/"),d=s("JIg3"),c=s("ZDA+"),C=s("8iaB"),u=s("7JXL"),D=s("XFVb"),S=s("6z9j"),I=s("n56n"),p=s("/G+I"),m=s("vTM8"),T=s("4HhE"),g=s("J5xz");class y extends C.a{constructor(e,t=0,s=0){super(),this.Module="INV",this.ClassName="AddPriceChartNewViewModel",this.Visible=!0,this.contextVisible=!0,this.ProfileID=0,this.SelectedNodeID=0,this.Mode="",this.DeletedIDs=new Array,this.iRateStartIndex=0,this.oChart=new D.a,this.DisplayName="",this.ScreenName="",this.ColumnSpan="",this.IsFromReport=!1,this.TreeViewModel=null,this.PriceChartAtProduct=!1,this.RightPanelVisibility=!0,this.MessageVisibility=!1,this.Title="",this.DisplayMessage="",this.FilterVisibility=!1,this.IsEdit=!1,this._IsEditFilter=!1,this._GenerateVisibility=!0,this.CopyVisible=!1,this._ChartType_All=!0,this._ChartType_Sale=!1,this._ChartType_Purchase=!1,this._ChartType_Reorder=!1,this.Name=new h.d(0),this.Price=new h.d(0),this.WEF=new d.a(0),this.TillDate=new d.c(0),this.Remarks=new h.d(0),this.UOM=new l.b(0),this.StatusID=1,this.CreatedBy=0,this.HasAccess=!1,this._SelectAll=!1,this.RateColumnCount=0,this.j=0,this.ProductNameIndex=1,this.stkValue="",this.ProductUOM="",this.stkCC=null,this.stkID=null,this.stkName=null,this.stkCode=null,this.dbQuery="",this.dblPrices=null,this.lstTemp=new Array,this.lstTempCC=new Array,this.sbQuery="",this.dicBaseUnits=new m.a,this.ProfileID=t,this.Mode=e,this.SelectedNodeID=s,this.TillDate.Date=null,"ADD"==e||"DOCUMENT"==e||"REPORT"==e?this.ScreenName="Add Price Chart":"EDIT"==e?(this.ScreenName="Edit Price Chart",this.IsEdit=!0,this.IsEditFilter=!0,this.CopyVisible=!0):"SEARCH"==e?(this.ScreenName="Search Price Chart",this.GenerateVisibility=!1,this.CopyVisible=!1):"PRODUCT_SEARCH"==e&&(this.GenerateVisibility=!1,this.CopyVisible=!1,e="SEARCH",this.Title="",this.PriceChartAtProduct=!0,this.Name.Visible=!1),this.Title=this.ScreenName,this.MessageVisibility=!1,this.DisplayMessage="",this.tree=[],this.CostCenters=new l.e(0),this.CostCenterFilters=[],this.CostCenters.SelectionChangedCommand.Subscribe(this,"OnCostCenterChange"),this.NodeSelectedCallBack=new T.b,this.NodeSelectedCallBack.Subscribe(this,"OnNodeSelectedCallBack"),this.Title=this.ScreenName,this.DisplayName=this.ScreenName,this.InitControls(),this.FilterVisibility=!0,null!=this.UOM&&(this.UOM.Label="UOM")}get IsEditFilter(){return this._IsEditFilter}set IsEditFilter(e){e!=this._IsEditFilter&&(e&&(this.GenerateVisibility=!1),this._IsEditFilter=e)}get GenerateVisibility(){return this._GenerateVisibility}set GenerateVisibility(e){e!=this._GenerateVisibility&&(e&&(this.IsEditFilter=!1),this._GenerateVisibility=e)}get ChartType_All(){return this._ChartType_All}set ChartType_All(e){e!=this._ChartType_All&&(e&&(this.ChartType_Sale=!1,this.ChartType_Purchase=!1,this.ChartType_Reorder=!1),this._ChartType_All=e)}get ChartType_Sale(){return this._ChartType_Sale}set ChartType_Sale(e){e!=this._ChartType_Sale&&(e&&(this.ChartType_All=!1,this.ChartType_Purchase=!1,this.ChartType_Reorder=!1),this._ChartType_Sale=e)}get ChartType_Purchase(){return this._ChartType_Purchase}set ChartType_Purchase(e){e!=this._ChartType_Purchase&&(e&&(this.ChartType_All=!1,this.ChartType_Sale=!1,this.ChartType_Reorder=!1),this._ChartType_Purchase=e)}get ChartType_Reorder(){return this._ChartType_Reorder}set ChartType_Reorder(e){e!=this._ChartType_Reorder&&(e&&(this.ChartType_All=!1,this.ChartType_Sale=!1,this.ChartType_Purchase=!1),this._ChartType_Reorder=e)}get SelectAll(){return this._SelectAll}set SelectAll(e){e!=this._SelectAll&&(this._SelectAll=e,this.selectNodes(e))}selectNodes(e){this.tree[0].Rows.forEach(t=>{this.tree[0].SelectNode_1(t,e)}),this.tree[0].RefreshSelectionText(),this.tree[0].OnNodeSelected()}InitControls(){this.Rates=new Array,this.PriceGrid=new i.a,this.PriceGrid.OnLinkClick.Subscribe(this,"OnGridLinkClick"),this.PriceGrid.OnPreviewKeyDown.Subscribe(this,"OnPreviewKeyDown"),this.Name.Label=a.a.GetResource("Com_Contacts_Name"),this.WEF.Label=a.a.GetResource("Service_WEF"),this.TillDate.Label=a.a.GetResource("TillDate"),this.TillDate.Visible=!1,this.Price.Label=a.a.GetResource("Price"),this.CostCenters.Label=a.a.GetResource("CostCenter_CostCenterslist"),this.Remarks.Label=a.a.GetResource("Remarks"),this.Remarks.Visible=!1;let e=a.a.inventory.GetPriceChart(0,this.ProfileID,"");if("EDIT"==this.Mode){let t=new u.a(3,"","Product",this);switch(t.SelectedNodes=[],t.HideFilter.Enable=!1,t.HideFilter.IsChecked=!0,this.CostCenterFilters.push(t),this.Name.Text=e.Tables[1][0].ProfileName.toString(),this.StatusID=parseInt(e.Tables[1][0].StatusID),e.Tables.length>5&&e.Tables[5].length>0&&(this.CreatedBy=parseInt(e.Tables[5][0].UserID),this.HasAccess=Object(o.j)(e.Tables[5][0].HasAccess)),parseInt(e.Tables[1][0].PriceType)){case 0:this.ChartType_All=!0;break;case 1:this.ChartType_Sale=!0;break;case 2:this.ChartType_Purchase=!0;break;case 3:this.ChartType_Reorder=!0}for(let s=0;s<e.Tables[0].length;s++){let t=l.d.ComboBoxItems_2(e.Tables[0][s].NAME.toString(),e.Tables[0][s].ID.toString());if(this.CostCenters.Items.push(t),e.Tables[4].filter(e=>e.CostCenterID==+t.Value).length>0&&(t.Aliasname="BOLD","3"!=t.Value)){let e=new u.a(parseInt(t.Value),"",t.Name,this);e.SelectedNodes=[],this.CostCenterFilters.push(e)}}}else if("SEARCH"==this.Mode){for(let t=0;t<e.Tables[0].length;t++)this.CostCenters.Items.push(l.d.ComboBoxItems_2(e.Tables[0][t].NAME.toString(),e.Tables[0][t].ID.toString())),e.Tables[4].filter(s=>s.CostCenterID==e.Tables[0][t].ID.toString()).length>0&&(this.CostCenters.Items[this.CostCenters.Items.length-1].Aliasname="BOLD");if("True"==n.e.String(a.a.SessionManager.Preferences.EnableLocationWise)&&"True"==a.a.SessionManager.Preferences["LW PChart"]&&"1"!=a.a.SessionManager.RoleID){let e=this.CostCenters.Items.find(e=>"50002"==e.Value);if(null!=e){let t=new u.a(50002,"",e.Name,this);if(t.SelectedNodes=[],0!=a.a.SessionManager.LocationID){let e=new c.a;e.Id=a.a.SessionManager.LocationID,e.IsSelected=!0,e.Text.push(a.a.SessionManager.LocationName),t.SelectedNodes.push(e),t.SelectedNodesTag=a.a.SessionManager.LocationName}else n.e.StringIsNullOrEmpty(a.a.SessionManager.LocationWhere)||(a.a.SessionManager.LocationWhere.split(",").forEach(e=>{let s=new c.a;s.Id=parseInt(e),s.IsSelected=!0,s.Text.push(e),t.SelectedNodes.push(s)}),t.SelectedNodesTag="[FILTER]");t.DeleteButtonVisibility=!1,this.CostCenterFilters.push(t)}}if("True"==a.a.SessionManager.Preferences.EnableDivisionWise.toString()&&"True"==a.a.SessionManager.Preferences["DW PChart"]&&"1"!=a.a.SessionManager.RoleID){let e=this.CostCenters.Items.find(e=>"50001"==e.Value);if(null!=e){let t=new u.a(50001,"",e.Name,this);if(t.SelectedNodes=[],0!=a.a.SessionManager.LocationID){let e=new c.a;e.Id=a.a.SessionManager.DivisionID,e.IsSelected=!0,e.Text.push(a.a.SessionManager.DivisionName),t.SelectedNodes.push(e),t.SelectedNodesTag=a.a.SessionManager.DivisionName}else n.e.StringIsNullOrEmpty(a.a.SessionManager.DivisionWhere)||(a.a.SessionManager.DivisionWhere.split(",").forEach(e=>{let s=new c.a;s.Id=parseInt(e),s.IsSelected=!0,s.Text.push(e),t.SelectedNodes.push(s)}),t.SelectedNodesTag="[FILTER]");t.DeleteButtonVisibility=!1,this.CostCenterFilters.push(t)}}}else for(let t=0;t<e.Tables[0].length;t++)this.CostCenters.Items.push(l.d.ComboBoxItems_2(e.Tables[0][t].NAME.toString(),e.Tables[0][t].ID.toString()));"DOCUMENT"!=this.Mode&&"REPORT"!=this.Mode&&(this.CostCenters.SelectedValue="3",this.OnCostCenterChange(null)),this.RefeshGrid(e.Tables[2],e.Tables[3])}OnPreviewKeyDown(e,t){let s="";if(e.grid.getCellEditor()&&e.grid.getCellEditor().args.column.name&&(s=e.grid.getCellEditor().args.column.name),"F6"==t.Key){if(!confirm(" Are you sure you want to Close Reservation ? "))return!0;let t=this.PriceGrid.Table;for(let i=0;i<t.length;i++)t[i][s]=e[s].toString(),this.oTableColumns.Contains(s+"_Key")&&(t[i][s+"_Key"]=e[s+"_Key"].toString()),this.PriceGrid.updateRow(t[i]);return!0}return!1}RefeshGrid(e,t){let s=e[0][Object.keys(e[0])[0]].toString(),i=120,n=180,o=e.filter(e=>"Price Chart Rates"==e.Name);if(o.length>0&&(s=o[0][Object.keys(o[0])[0]].toString()),o=e.filter(e=>"Price Chart Widths"==e.Name),o.length>0){let e=o[0].Value.toString().split(";");e.length>0&&e[0].Contains("ProductCode")&&(i=parseInt(e[0].replace("ProductCode=",""))),e.length>1&&e[1].Contains("ProductName")&&(n=parseInt(e[1].replace("ProductName=","")))}this.Rates.Clear(),this.oTableColumns=[],this.oTableColumns.push("sno"),this.oTableColumns.push("select"),this.oTableColumns.push("Combination"),this.oTableColumns.push("wef"),this.oTableColumns.push("wef_Key"),this.oTableColumns.push("tillDate"),this.oTableColumns.push("tillDate_Key"),this.oTableColumns.push("Account"),this.oTableColumns.push("Product"),this.oTableColumns.push("ProductCode"),this.oTableColumns.push("Product_Key"),this.oTableColumns.push("UOM"),this.oTableColumns.push("UOM_Key"),this.oTableColumns.push("Query"),this.oTableColumns.push("Action"),this.oTableColumns.push("PriceCCID"),this.oTableColumns.push("ProfileName"),this.oTableColumns.push("PriceType"),this.oTableColumns.push("Remarks"),this.iRateStartIndex=19;let d=[],c=new r.a;c.Header=a.a.GetResource("Service_Sno"),c.DisplayMember="sno",c.ReadOnly=!0,c.IsFrozen=!0,c.Width=40,d.push(c),this.CopyVisible&&(c=new r.a,c.Header="",c.DisplayMember="select",c.DataType="CheckBox",c.IsFrozen=!0,c.Width=30,d.push(c)),this.PriceChartAtProduct||(c=new r.a,c.Header=a.a.GetResource("Service_Action"),c.DisplayMember="Action",c.DataType="LINK",c.ReadOnly=!0,c.IsFrozen=!0,c.Width=60,d.push(c)),c=new r.a,c.Header=a.a.GetResource("Inv_Substitute_ProductCode"),c.DisplayMember="ProductCode",c.ReadOnly=!0,c.IsFrozen=!0,i>0?c.Width=i:c.IsVisible=!1,d.push(c),"SEARCH"==this.Mode&&(c=new r.a,c.Header="ProfileName",c.DisplayMember="ProfileName",c.ReadOnly=!0,c.Width=120,c.IsFrozen=!0,d.push(c)),c=new r.a,c.Header="Product",c.DisplayMember="Product",c.ReadOnly=!0,n>0?c.Width=n:c.IsVisible=!1,c.IsFrozen=!0,d.push(c),c=new r.a,c.Header=a.a.GetResource("UOM"),c.DisplayMember="UOM",c.ReadOnly=!0,c.Width=90,d.push(c);let C,u=t,D=s.split(",");this.RateColumnCount=0;for(let l=0;l<D.length;l++)if(u=t.filter(e=>e.SysColumnName==D[l]),u.length>0){C=u[0].SysColumnName.toString(),this.oTableColumns.push(C),c=new r.a,c.Header=a.a.GetResource(u[0].ResourceData.toString()),c.DisplayMember=C,c.IsCalculated=1,c.DataType="FLOAT",c.DecimalPoints=u[0].DecimalPoints.toString(),c.Width=100,d.push(c);let e=new h.d(0);e.Label=c.Header,e.DBColumnName=C,this.Rates.push(e),this.RateColumnCount++}c=new r.a,c.Header=a.a.GetResource("Service_WEF"),c.DisplayMember="wef",c.DataType="DATE",c.Width=115,d.push(c);for(let l=0;l<D.length;l++)"TillDate"==D[l]&&(this.TillDate.Visible=!0,c=new r.a,c.Header=a.a.GetResource("TillDate"),c.DisplayMember="tillDate",c.DataType="DATE",c.Width=115,d.push(c));D.Contains("Remarks")&&(this.Remarks.Visible=!0,c=new r.a,c.Header=a.a.GetResource("Remarks"),c.DisplayMember="Remarks",c.Width=150,d.push(c)),c=new r.a,c.Header=a.a.GetResource("Service_Combination"),c.DisplayMember="Combination",c.ReadOnly=!0,c.DefaultValue="Select",c.Width=260,d.push(c);let S=new Array;S.push(l.d.ComboBoxItems_2("All","0")),S.push(l.d.ComboBoxItems_2("Sale","1")),S.push(l.d.ComboBoxItems_2("Purchase","2")),S.push(l.d.ComboBoxItems_2("Reorder Level","3")),c=new r.a,c.Header="Type",c.DisplayMember="PriceType",c.Width=100,c.ComboData=S,c.ValueBinding="PriceType",c.DataType="ComboBox",c.DisplayMember="Name",c.ValueMember="Value",d.push(c),this.PriceGrid.SelectAll.Visible=!0,this.PriceGrid.SearchVisible=!0,this.PriceGrid.SortVisible=!0,this.PriceGrid.SearchColStartIndex=3,this.PriceGrid.Columns=d,this.PriceGrid.Table=[]}LoadDefaultProfile(e,t){this.IsFromReport=!0;let s,i=this.oChart.GetPriceChart(6,e,"");if(null==i||i.Tables.length<2||0==i.Tables[0].length)return;let r=n.e.String(i.Tables[0][0][Object.keys(i.Tables[0][0])[0]]).split(","),l="",o="",h=this.oChart.GetProductLocationNames(e,t);if(h.Tables[0].length>0){let e=new u.a(3,"","Product",this);e.SelectedNodes=[],e.HideFilter.Enable=!1,e.HideFilter.IsChecked=!0,this.CostCenterFilters.push(e);let t=new c.a;t.Id=parseInt(h.Tables[0][0].ProductID),t.Text.push(h.Tables[0][0].ProductName.toString()),e.SelectedNodes.push(t),o=h.Tables[0][0].ProductName.toString(),l=h.Tables[0][0].ProductCode.toString(),e.RefreshSelectedNodesText(),this.FillUOM(!1,e.SelectedNodes)}let d=null;for(s=0;s<r.length;s++){let e=this.CostCenters.Items.find(e=>e.Value==r[s]);if(null!=e){let t=new u.a(parseInt(r[s]),"",e.Name,this);t.SelectedNodes=[],this.CostCenterFilters.push(t),50002==t.CostCenterID&&(d=t)}}null!=d&&(h.Tables[1].forEach(e=>{let t=new c.a;t.Id=parseInt(e.NodeID),t.Text.push(e.Name.toString()),d.SelectedNodes.push(t)}),d.RefreshSelectedNodesText());for(let a=1;a<this.CostCenterFilters.length;a++)50002!=this.CostCenterFilters[a].CostCenterID&&2!=this.CostCenterFilters[a].CostCenterID&&(this.oChart.GetTagData(n.e.GetTagTableName(this.CostCenterFilters[a].CostCenterID)).forEach(e=>{let t=new c.a;t.Id=parseInt(e.NodeID),t.Text.push(e.Name.toString()),this.CostCenterFilters[a].SelectedNodes.push(t)}),this.CostCenterFilters[a].RefreshSelectedNodesText());if(h.Tables[0].length>0){let e;this.PriceGrid.Clear();let t,r=1,n=0;for(let h=0;h<i.Tables[1].length;h++){const C=i.Tables[1][h];if(null==d||null==d.SelectedNodes.find(e=>e.Id==parseInt(C.CCNID2))){e=this.PriceGrid.NewRow(),e.sno=r;for(let t=this.iRateStartIndex;t<this.oTableColumns.length;t++)n=parseFloat(C[this.oTableColumns[t]]),e[this.oTableColumns[t]]=n.ToString("N"+this.PriceGrid.Columns.filter(e=>e.DisplayMember==this.oTableColumns[t])[0].DecimalPoints);if(e.Product=o,e.ProductCode=l,e.Product_Key=C.ProductID.toString(),e.PriceCCID=C.PriceCCID,e.wef=new Date(C.WEF_DATE).ToString(a.a.SessionManager.Preferences["Date Format"]),e.wef_Key=C.WEF_DATE,e.PriceType=C.PriceType,e.Action="Delete",this.sbQuery="",this.sbQuery+=' ProductID="'+C.ProductID+'"',parseInt(C.UOMID)>0&&(this.sbQuery+=' UOMID="'+C.UOMID+'"',e.UOM=C.UOMName.toString(),e.UOM_Key=C.UOMID.toString()),parseInt(C.AccountID)>0){this.sbQuery+=' AccountID="'+C.AccountID+'"',e.Account=C.AccountName.toString();let t=this.CostCenterFilters.find(e=>2==e.CostCenterID);if(null!=t&&null!=t.SelectedNodes.find(e=>e.Id==parseInt(C.AccountID))){let e=new c.a;e.Id=parseInt(C.AccountID),e.Text.push(C.AccountName.toString()),t.SelectedNodes.push(e)}}if(parseInt(C.CurrencyID)>0){this.sbQuery+=' CurrencyID="'+C.CurrencyID+'"',e.CurrencyID=C.Currency.toString();let t=this.CostCenterFilters.find(e=>12==e.CostCenterID);if(null!=t&&null!=t.SelectedNodes.find(e=>e.Id==parseInt(C.CurrencyID))){let e=new c.a;e.Id=parseInt(C.CurrencyID),e.Text.push(C.Currency.toString()),t.SelectedNodes.push(e)}}for(t="",s=1;s<=50;s++)if(parseInt(C["CCNID"+s])>0){this.sbQuery+=" CC"+s+'="'+C["CCNID"+s]+'"',t.length>0&&(t+="::");let e=this.CostCenterFilters.find(e=>e.CostCenterID==5e4+s);if(null!=e){let i=e.SelectedNodes.find(e=>e.Id==parseInt(C["CCNID"+s]));null!=i&&(t+=i.Text[0])}}e.Query=this.sbQuery.toString(),e.Combination=t,this.PriceGrid.addRow(e),r++}}}this.PriceGrid.Table.length>0&&(this.FilterVisibility=!1)}LoadFromDocument(e){this.FilterVisibility=!1;let t,s,i,r,l,h="",C="",D=0,S=!1,p=e.ScreenObject.GridData,m=[],T=null,g=new n.f;g.LoadXml(e.ScreenObject.Preferences.PriceChartMapping);let y=g.DocumentElement.SelectSingleNode("WEF");if(null==y||n.e.IsEmpty(y.axttributes.Name.value)||(h=y.axttributes.Name.value.toString(),p.GridDataColumns.Contains(h)||(p.GridDataColumns.push(h),p.GridDataColumns.push(h+"_Key"))),y=g.DocumentElement.SelectSingleNode("TillDate"),null==y||n.e.IsEmpty(y.axttributes.Name.value)||(C=y.axttributes.Name.value.toString(),p.GridDataColumns.Contains(C)||(p.GridDataColumns.push(C),p.GridDataColumns.push(C+"_Key"))),null!=g.DocumentElement.SelectSingleNode("PCSelectedLocation")&&(S=!0),y=g.DocumentElement.SelectSingleNode("PriceType"),null==y)this.ChartType_All=!0;else switch(parseInt(y.axttributes.Name.value)){case 0:this.ChartType_All=!0;break;case 1:this.ChartType_Sale=!0;break;case 2:this.ChartType_Purchase=!0;break;case 3:this.ChartType_Reorder=!0}for(e.ScreenObject.HeaderFields.forEach(t=>{if(t instanceof d.c){let s=t;p.GridDataColumns.Contains(s.DBColumnName)&&p.forEach(t=>{parseInt(t.DocDetailsID)>0&&(t[s.DBColumnName]=s.Text,t[s.DBColumnName+"_Key"]=s.Date,e.ScreenObject.GridDataObj.updateRow(t))})}else if(t instanceof d.d){let s=t;p.GridDataColumns.Contains(s.DBColumnName)&&p.forEach(t=>{parseInt(t.DocDetailsID)>0&&(t[s.DBColumnName]=s.Text,t[s.DBColumnName+"_Key"]=s.Date,e.ScreenObject.GridDataObj.updateRow(t))})}}),e.ScreenObject._TextFields.forEach(t=>{if(t instanceof d.c){let s=t;p.GridDataColumns.Contains(s.DBColumnName)&&p.forEach(t=>{parseInt(t.DocDetailsID)>0&&(t[s.DBColumnName]=s.Text,t[s.DBColumnName+"_Key"]=s.Date,e.ScreenObject.GridDataObj.updateRow(t))})}}),this.Name.Text=e.ScreenObject.VoucherNo,D=0;D<p.length&&0!=n.e.String(p[D].DocDetailsID).length&&0!=parseInt(p[D].DocDetailsID);D++);if(y=g.DocumentElement.SelectSingleNode("Dimensions"),null!=y&&y.InnerText.length>0&&(m=y.InnerText.split(",")),a.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==n.e.String(a.a.SessionManager.Preferences.EnableLocationWise)&&!m.Contains("50002")){let e="";null!=y&&y.InnerText.length>0&&(e=y.InnerText),e.Contains("50002")||(e.length>0&&(e+=","),e+="50002"),m=e.split(",")}T=g.DocumentElement.SelectNodes("Rates/R");let b="",f=new u.a(3,"","Product",this);for(f.SelectedNodes=[],f.HideFilter.Enable=!1,f.HideFilter.IsChecked=!0,this.CostCenterFilters.push(f),t=0;t<D;t++){b=p.GridDataColumns.Contains("ProductName")?p[t].ProductName.toString():p.GridDataColumns.Contains("ProductCode")?p[t].ProductCode.toString():"";let e=new c.a;e.Id=parseInt(p[t].ProductID_Key),e.Text.push(b),f.SelectedNodes.push(e)}f.RefreshSelectedNodesText(),this.FillUOM(!1,f.SelectedNodes);let P=null,N=e.ScreenObject.DocumentType;1==N||2==N||10==N||26==N||27==N||3==N||4==N||25==N||13==N?P=e.ScreenObject.CreditAccount:11!=N&&6!=N&&7!=N&&8!=N&&9!=N&&12!=N&&24!=N||(P=e.ScreenObject.DebitAccount);let M=null,_=null;for(let d=0;d<m.length;d++){let r=this.CostCenters.Items.find(e=>e.Value==m[d]);if(null!=r&&(_=new u.a(parseInt(m[d]),"",r.Name,this),_.SelectedNodes=[],this.CostCenterFilters.push(_)),2!=_.CostCenterID)if(i="dcCCNID"+(_.CostCenterID-5e4),s=i+"_Key",!S&&a.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==n.e.String(a.a.SessionManager.Preferences.EnableLocationWise)&&50002==_.CostCenterID){M=_;let e=a.a.admin.getLocationRoles(["50002",a.a.SessionManager.LangID]).Tables[0];e=e.sort((e,t)=>e.Name-t.Name);let t=a.a.SessionManager.LocationWhere.split(",");for(let s=0;s<e.length;s++)if(t.Contains(e[s][0].toString())&&!Object(o.j)(e[s].IsGroup)){let t=new c.a;t.Id=parseInt(e[s][0]),t.Text.push(e[s][2].toString()),_.SelectedNodes.push(t)}_.RefreshSelectedNodesText()}else if(p.GridDataColumns.Contains(s))for(t=0;t<D;t++){let e=0;if(e=n.e.Int(p[t][s]),e>0&&null==_.SelectedNodes.find(t=>t.Id==e)){let s=new c.a;s.Id=e,s.Text.push(p[t][i].toString()),_.SelectedNodes.push(s)}}else{let t=e.ScreenObject._CCFields.find(e=>e instanceof I.b&&e.CCID==_.CostCenterID);if(null!=t){let e=new c.a;e.Id=t.SelectedValue,e.Text.push(null==t.Text?"[]":t.Text),_.SelectedNodes.push(e)}}else if(null!=P){let e=new c.a;e.Id=P.SelectedValue,e.Text.push(null==P.Text?"[]":P.Text),_.SelectedNodes.push(e)}else p.GridDataColumns.Contains("AccountID_Key");_.RefreshSelectedNodesText()}let R,w,G,E=new Array,k=new Array;null!=T&&T.forEach(e=>{this.oTableColumns.Contains(e.axttributes.Name.value)&&p.GridDataColumns.Contains(e.axttributes.ID.value)&&(E.push(e.axttributes.Name.value),k.push(e.axttributes.ID.value))}),this.PriceGrid.Clear();let O=1,F=!1;for(t=0;t<D;t++){let o=0;do{w=this.PriceGrid.NewRow(),G=p[t],F=!1;for(let e=0;e<E.length;e++)R=n.e.Double(G[k[e]]),R>0&&(w[E[e]]=R.ToString("N"+this.PriceGrid.Columns.filter(t=>t.DisplayMember==E[e])[0].DecimalPoints),F=!0);if(!F)continue;w.sno=O,O++,p.GridDataColumns.Contains("ProductCode")&&(w.ProductCode=G.ProductCode.toString()),p.GridDataColumns.Contains("ProductName")&&(w.Product=G.ProductName.toString()),w.Product_Key=G.ProductID_Key.toString(),""!=h?(w.wef=G[h].toString(),w.wef_Key=G[h+"_Key"].toString()):(w.wef=e.DocumentDate.Date.ToString(a.a.SessionManager.Preferences["Date Format"]),w.wef_Key=e.DocumentDate.Date),""!=C&&(w.tillDate=G[C].toString(),w.tillDate_Key=G[C+"_Key"].toString()),w.Action="Delete";let d=0;this.ChartType_Sale?d=1:this.ChartType_Purchase?d=2:this.ChartType_Reorder&&(d=3),w.PriceType=d,this.sbQuery="",this.sbQuery+=' ProductID="'+G.ProductID_Key.toString()+'"',G.Unit_Key.toString().length>0&&parseInt(G.Unit_Key)>0&&(this.sbQuery+=' UOMID="'+G.Unit_Key+'"',w.UOM=G.Unit.toString(),w.UOM_Key=G.Unit_Key.toString()),l="";for(let t=1;t<this.CostCenterFilters.length;t++)if(r="1",2!=this.CostCenterFilters[t].CostCenterID){if(null!=M&&50002==this.CostCenterFilters[t].CostCenterID&&M.SelectedNodes.length>0)r=M.SelectedNodes[o].Id.toString(),b=M.SelectedNodes[o].Text[0];else if(b="",i="dcCCNID"+(this.CostCenterFilters[t].CostCenterID-5e4),s=i+"_Key",p.Columns.Contains(s))r=G[s].toString(),b=G[i].toString();else{let s=e.ScreenObject._CCFields.find(e=>e instanceof I.b&&e.CCID==this.CostCenterFilters[t].CostCenterID);null!=s&&(b=s.Text,r=s.SelectedValue.toString())}this.sbQuery+=" CC"+(this.CostCenterFilters[t].CostCenterID-5e4)+'="'+r+'"',l.length>0&&(l+="::"),l+=b}else null!=P&&(w.Account=P.Text,P.SelectedValue>0&&(r=P.SelectedValue.toString())),this.sbQuery+=' AccountID="'+r+'"';w.Query=this.sbQuery.toString(),w.Combination=l,this.PriceGrid.addRow(w),o++}while(null!=M&&M.SelectedNodes.length>o)}if(this.PriceGrid.Table.length>0)for(let a=this.iRateStartIndex;a<this.oTableColumns.length;a++)this.Rates[a-this.iRateStartIndex].Text=this.PriceGrid.Table[0][a].toString()}OnButtonClick(e){if(this.DisplayMessage="","FilterCancel"==e)this.FilterVisibility=!1;else if("ShowFilter"==e)this.FilterVisibility=!0;else if("Generate"==e)"EDIT"==this.Mode?this.IsEditFilter?this.LoadEditData():this.GenerateClick():"SEARCH"==this.Mode?this.LoadEditData():this.GenerateClick();else if("Load"==e)g.AddTaxChartNewViewModel.LoadDimensionNodes(this,this.ProfileID);else if("Save"==e)this.IsFromReport?this.ReportSaveClick():this.SaveClick();else if("Customize"==e);else if("CLEAR"==e)this.PriceGrid.Table.Clear();else if("LatestData"==e)this.GetLatestData();else if("Copy"==e){let e=this.PriceGrid.Table.filter(e=>1==e.select),t=this.PriceGrid.Table.length,s=null;e.forEach(e=>{e.select=!1;let t=this.PriceGrid.NewRow();for(let s=0;s<this.oTableColumns.length;s++){const i=this.oTableColumns[s];t[i]=e[i]}t.wef=(new Date).ToString(a.a.SessionManager.Preferences["Date Format"]),t.wef_key=new Date,t.select=!1,t.PriceCCID=null,t.sno=this.PriceGrid.Table.length+1,null==s&&(s=t),this.PriceGrid.addRow(t)}),e.length>0?(this.DisplayMessage="Duplicate rows added at end",this.PriceGrid.SelectedItem=this.PriceGrid.Table[t]):this.DisplayMessage="Please select row to copy"}}LoadEditData(){let e=1,t="",s="",i="";this.CostCenterFilters.forEach(r=>{if(2==r.CostCenterID?(t="AccountID",s="T.AccountID"):3==r.CostCenterID?(t="ProductID",s="T.ProductID"):12==r.CostCenterID?(t="CurrencyID",s="T.CurrencyID"):r.CostCenterID>5e4&&(e=2,t="NodeID",s="T.CCNID"+(r.CostCenterID-5e4)),r.SelectedNodes.length>0){if(1==r.SelectedNodes.length)i+=" AND ",i+=s+"="+r.SelectedNodes[0].Id;else if(null==r.SelectedNodes.find(t=>t.Id==e&&t.IsGroup))if(i+=" AND ",p.IPrefetchFilter.IsGroupTree(r)){let e="";for(let t=0;t<r.SelectedNodes.length;t++)null!=r.SelectedNodes[t].Parent&&r.SelectedNodes[t].Parent.IsSelected||(e.length>0&&(e+=","),e+=r.SelectedNodes[t].Id);0==e.length&&(e+=-12912),i+=s+" IN ",i+=" (select T."+t+" GTID from "+n.e.GetTagTableName(r.CostCenterID)+" T with(nolock),"+n.e.GetTagTableName(r.CostCenterID)+" GTP with(nolock) where T.lft BETWEEN GTP.lft AND GTP.rgt AND GTP."+t+" IN ( "+e.toString()+" )  group by T."+t+")"}else{i+=s+" IN (";for(let e=0;e<r.SelectedNodes.length;e++)e>0&&(i+=","),i+=r.SelectedNodes[e].Id;i+=")"}}else r.DeleteButtonVisibility||(i+=" AND ",i+=s+"=-12912")}),this.LoadProfileData(-1,0,(new Date).Date(),"",i.toString(),null),this.FilterVisibility=!1}OnGridLinkClick(e,t,s){"Action"==t&&(null!=e.PriceCCID&&parseInt(e.PriceCCID)>0&&!this.DeletedIDs.Contains(parseInt(e.PriceCCID))&&this.DeletedIDs.push(parseInt(e.PriceCCID)),this.PriceGrid.removeRow(e),this.PriceGrid.RefreshSno())}SaveClick(){if("SEARCH"!=this.Mode&&"REPORT"!=this.Mode&&n.e.StringIsNullOrEmpty(this.Name.Text))return void(this.DisplayMessage="Select "+this.Name.Label);if(this.ProfileID>0&&1!=this.StatusID&&(a.a.SessionManager.UserID!=this.CreatedBy.toString()||!this.HasAccess))return void(this.DisplayMessage="In-Active profiles can not be modified");let e="",t=!0;this.PriceGrid.Table.forEach(s=>{if(t)if(n.e.StringIsNullOrEmpty(s.Product_Key))t=!1;else{e+="<Row ",n.e.StringIsNullOrEmpty(s.PriceCCID)||(e+=' PriceCCID="'+s.PriceCCID.toString()+'"'),e+=s.Query,!n.e.StringIsNullOrEmpty(s.wef_key)&&n.e.isValidDate(s.wef_key.toString())?e+=' WEF="'+new Date(s.wef_key).ToString("dd/MMM/yyyy")+'"':e+=' WEF="'+this.WEF.Date.ToString("dd/MMM/yyyy")+'"',!n.e.StringIsNullOrEmpty(s.tillDate_key)&&n.e.isValidDate(s.tillDate_key.toString())&&(e+=' TillDate="'+new Date(s.tillDate_key).ToString("dd/MMM/yyyy")+'"'),this.Remarks.Visible&&(e+=' Remarks="'+n.e.EncodeXML(s.Remarks.toString())+'"'),n.e.StringIsNullOrEmpty(s.PriceType)?e+=' Type="0"':e+=' Type="'+s.PriceType.toString()+'"';for(let t=this.iRateStartIndex;t<this.oTableColumns.length;t++)e+=" "+this.oTableColumns[t]+'="'+s[this.oTableColumns[t]]+'"';e+="/>"}});let s="";if(this.DeletedIDs.length>0&&(s+="<XML>",this.DeletedIDs.forEach(e=>{s+='<Row  ID="'+e+'" />'}),s+="</XML>"),e.length>0||s.length>0){e="<XML>"+e+"</XML>";let t=0,i=0;this.ChartType_Sale?i=1:this.ChartType_Purchase?i=2:this.ChartType_Reorder&&(i=3);let r="",l=this.oChart.SetPriceChartNew(this.ProfileID,this.Name.Text,this.SelectedNodeID,!1,e.toString(),s.toString(),i,!1);r=l.Message,t=l.RetValue,t>0&&("EDIT"==this.Mode||(null!=this.TreeViewModel&&this.TreeViewModel.Refresh(),this.Name.Text=""),this.Clear()),this.DisplayMessage=r}}ReportSaveClick(){let e=!1,t=!1;if(this.PriceGrid.Table.forEach(s=>{n.e.StringIsNullOrEmpty(s.PriceCCID)?t=!0:e=!0}),t){if(n.e.StringIsNullOrEmpty(this.Name.Text))return void(this.DisplayMessage="Select "+this.Name.Label);e=!1,this.ProfileID=0,this.SaveClick()}else e&&(this.ProfileID=-100,this.SaveClick())}Clear(){null!=this.PriceGrid&&null!=this.PriceGrid.Table&&this.PriceGrid.Table.Clear(),this.IsFromReport=!1,this.DeletedIDs.Clear()}GenerateClick(){this.DisplayMessage="",this.dblPrices=Array(this.RateColumnCount);for(let a=0;a<this.RateColumnCount;a++)if(!n.e.StringIsNullOrEmpty(this.Rates[a].Text))try{this.dblPrices[a]=parseFloat(this.Rates[a].Text)}catch(l){}var e=this.CostCenterFilters.find(e=>3==e.CostCenterID);if(null==e)return void(this.DisplayMessage="Please Select Product");if(this.ProductNameIndex=1,e.SelectedNodes.length>0&&e.SelectedNodes[0].Tree instanceof S.a){var t=e.SelectedNodes[0].Tree.ColumnsSource;for(let e=0;e<t.length;e++)if("ProductName"==t[e].DBName){this.ProductNameIndex=e;break}}this.lstTemp.Clear(),this.lstTempCC.Clear(),this.lstTempCC.push(3),this.lstTempCC.push(11),this.lstTemp.push(null),this.lstTemp.push(null);let s,i=this.CostCenterFilters.length+1;this.CostCenterFilters=this.CostCenterFilters.sort((e,t)=>e.CostCenterID-t.CostCenterID),this.CostCenterFilters.forEach(e=>{if(e.HideFilter.IsChecked){if(s=e.SelectedNodes.filter(e=>!e.IsGroup),0==s.length)return void(this.DisplayMessage="Please Select "+e.CostCenter)}else{s=new Array;for(let t=0;t<e.SelectedNodes.length;t++)null!=e.SelectedNodes[t].Parent&&e.SelectedNodes[t].Parent.IsSelected||s.push(e.SelectedNodes[t]);if(0==s.length)return void(this.DisplayMessage="Please Select "+e.CostCenter)}3==e.CostCenterID?this.lstTemp[0]=s:(this.lstTemp.push(s),this.lstTempCC.push(e.CostCenterID))});let r=new Array;this.UOM.Items.find(e=>"87"==e.Value),this.UOM.Items.filter(e=>e.IsChecked).forEach(e=>{let t=new c.a;t.Id=parseInt(e.Value),r.push(t),r[r.length-1].Text.push(e.Name)}),this.lstTemp[1]=r,0!=r.length?(this.stkCC=new Array(i),this.stkID=new Array(i),this.stkName=new Array(i),this.stkCode=new Array(i),this.CallRecursive(0),this.FilterVisibility=!1):this.DisplayMessage="Please Select UOM"}CallRecursive(e){for(let t=0;t<this.lstTemp[e].length;t++)if(this.stkName[e]=this.lstTemp[e][t].Text.length>1?0==e?this.lstTemp[e][t].Text[this.ProductNameIndex]:this.lstTemp[e][t].Text[1]:this.lstTemp[e][t].Text[0],this.stkCode[e]=this.lstTemp[e][t].Text[0],this.stkCC[e]=this.lstTempCC[e],this.stkID[e]=this.lstTemp[e][t].Id,0==e&&(this.ProductUOM=this.lstTemp[e][t].Tag.toString()),1!=e||null==this.ProductUOM||this.ProductUOM.split(",").Contains(this.lstTemp[e][t].Id.toString()))if(e==this.lstTemp.length-1){let e=this.PriceGrid.NewRow();for(this.sbQuery="",this.dbQuery="",this.j=0;this.j<this.stkCC.length;this.j++)3==this.stkCC[this.j]?(this.sbQuery+=' ProductID="'+this.stkID[this.j]+'"',this.dbQuery+=" ProductID='"+this.stkID[this.j]+"' and "):2==this.stkCC[this.j]?(this.sbQuery+=' AccountID="'+this.stkID[this.j]+'"',this.dbQuery+=" AccountID='"+this.stkID[this.j]+"' and "):11==this.stkCC[this.j]?(this.sbQuery+=' UOMID="'+this.stkID[this.j]+'"',this.dbQuery+=" UOMID='"+this.stkID[this.j]+"' and "):12==this.stkCC[this.j]?(this.sbQuery+=' CurrencyID="'+this.stkID[this.j]+'"',this.dbQuery+=" CurrencyID='"+this.stkID[this.j]+"' and "):(this.sbQuery+=" CC"+(parseInt(this.stkCC[this.j])-5e4)+'="'+this.stkID[this.j]+'"',this.dbQuery+=" CCNID"+(parseInt(this.stkCC[this.j])-5e4)+"='"+this.stkID[this.j]+"' AND");e.Query=this.sbQuery.toString();let t=0;if(this.ChartType_Sale?t=1:this.ChartType_Purchase?t=2:this.ChartType_Reorder&&(t=3),e.PriceType=t,this.PriceGrid.Table.filter(e=>e.Query==this.sbQuery.toString()&&e.wef_Key==this.WEF.Date.ToString("dd/MMM/yyyy")&&e.PriceType==t.toString()).length>0)return this.DisplayMessage="Data already exists with same combination on wef date",void(this.MessageVisibility=!0);if(this.dbQuery.length>0){let s=a.a.common.GetDataSet3("PTC002",this.dbQuery,this.WEF.Date.ToString("dd/MMM/yyyy"),t.toString());if(null!=s&&s.Tables.length>0&&s.Tables[0].length>0)return this.DisplayMessage="Data already exists with same combination on wef date",void(this.MessageVisibility=!0);this.PriceGrid.addRow(e)}else this.PriceGrid.addRow(e);e[0]=this.PriceGrid.Table.length,e.Product=this.stkName[0],e.Product_Key=this.stkID[0],null!=this.stkCode&&(e.ProductCode=this.stkCode[0]),e.UOM=this.stkName[1],e.UOM_Key=this.stkID[1];for(let s=this.iRateStartIndex;s<this.oTableColumns.length;s++)e[s]=this.dblPrices[s-this.iRateStartIndex];for(e.wef=this.WEF.Date.ToString(a.a.SessionManager.Preferences["Date Format"]),e.wef_key=this.WEF.Date,this.TillDate.Date&&(e.tillDate=this.TillDate.Date.ToString(a.a.SessionManager.Preferences["Date Format"]),e.tillDate_key=this.TillDate.Date),this.Remarks.Visible&&!n.e.IsNullOrWhiteSpace(this.Remarks.Text)&&(e.Remarks=this.Remarks.Text),e.Action=a.a.GetResource("Delete"),this.stkValue="",this.j=2;this.j<this.stkName.length;this.j++)this.stkValue.length>0&&(this.stkValue+="::"),this.stkValue+=this.stkName[this.j];e.Combination=this.stkValue}else this.CallRecursive(e+1)}LoadProfileData(e,t,s,i,r,l){let n,o=a.a.inventory.GetPriceChart(2,this.ProfileID,r),h=[];this.DeletedIDs.Clear();let d,c,C=1,u=0;o.Tables[0].forEach(r=>{if(n={},n.sno=C,n.select=!1,null==l)for(let e=this.iRateStartIndex;e<this.oTableColumns.length;e++)u=parseFloat(r[this.oTableColumns[e]]),0!=u&&(n[this.oTableColumns[e]]=u.ToString("N"+this.PriceGrid.Columns.filter(t=>t.DisplayMember==this.oTableColumns[e])[0].DecimalPoints));else l.forEach(s=>{u=parseFloat(r[s]),1==e?u+=t:2==e?u+=u*t/100:3==e?(u-=t,u<0&&(u=0)):4==e&&(u-=u*t/100,u<0&&(u=0)),0!=u&&(n[s]=u.ToString("N"+this.PriceGrid.Columns.filter(e=>e.DisplayMember==s)[0].DecimalPoints))});for(n.Product=r.ProductName.toString(),n.ProductCode=r.ProductCode.toString(),n.Product_Key=r.ProductID.toString(),"SEARCH"==this.Mode&&(n.ProfileName=r.ProfileName.toString()),-1==e?(n.wef=new Date(r.WEF_DATE).ToString(a.a.SessionManager.Preferences["Date Format"]),n.wef_Key=r.WEF_DATE,n.PriceCCID=r.PriceCCID,null!=r.Till_Date&&(n.tillDate=new Date(r.Till_Date).ToString(a.a.SessionManager.Preferences["Date Format"]),n.tillDate_Key=r.Till_Date),n.Remarks=r.Remarks):(n.wef=s.ToString(a.a.SessionManager.Preferences["Date Format"]),n.wef_Key=s,""!=i&&(n.tillDate=new Date(i).ToString(a.a.SessionManager.Preferences["Date Format"]),n.tillDate_Key=new Date(i)),this.Remarks.Visible&&(n.Remarks=this.Remarks.Text)),n.Action="Delete",n.PriceType=r.PriceType,this.sbQuery="",this.sbQuery+=' ProductID="'+r.ProductID+'"',parseInt(r.UOMID)>0&&(this.sbQuery+=' UOMID="'+r.UOMID+'"',n.UOM=r.UOMName.toString(),n.UOM_Key=r.UOMID.toString()),c="",parseInt(r.AccountID)>0&&(this.sbQuery+=' AccountID="'+r.AccountID+'"',c+=r.AccountName.toString()),parseInt(r.CurrencyID)>0&&(this.sbQuery+=' CurrencyID="'+r.CurrencyID+'"',c.length>0&&(c+="::"),c+=r.Currency.toString()),d=0;d<o.Columns[0].length;d++)if(o.Columns[d].toUpperCase().startsWith("CCNID")&&parseInt(r[o.Columns[d]])>0){let e=parseInt(o.Columns[d].toUpperCase().Replace("CCNID",""));this.sbQuery+=" CC"+e+'="'+r[o.Columns[d]]+'"',c.length>0&&(c+="::"),c+=r["CC"+e].toString()}n.Query=this.sbQuery.toString(),n.Combination=c,h.push(n),C++}),this.PriceGrid.Table=h}GetLatestData(){let e=1,t="";for(let i=0;i<this.PriceGrid.Table.length;i++){const s=this.PriceGrid.Table[i];if(0==n.e.String(s.Product_Key).length)break;t+="<Row ",t+='ID="'+e.toString()+'"',t+=s.Query,t+="/>",e++}t.length>0&&(t="<XML>"+t+"</XML>");let s=this.oChart.GetPriceChartLatestData(t.toString());if(null!=s&&s.Tables.length>0&&s.Columns[0].Contains("SellingRate")){let t;e=0,s.Tables[0].forEach(s=>{t=this.PriceGrid.Table[e];for(let e=this.iRateStartIndex;e<this.oTableColumns.length;e++)n.e.IsEmpty(s[this.oTableColumns[e]])||(t[this.oTableColumns[e]]=s[this.oTableColumns[e]],this.PriceGrid.updateRow(t));e++})}else this.DisplayMessage="Error in loading latest data"}OnCostCenterChange(e){if(!n.e.StringIsNullOrEmpty(this.CostCenters.SelectedValue)&&(0==this.tree.length||this.tree[0].CostCenterID!=parseInt(this.CostCenters.SelectedValue))){let e=0;null==this.CostCenters.SelectedItem||n.e.StringIsNullOrEmpty(this.CostCenters.SelectedItem.Parent)||(e=n.e.Int(this.CostCenters.SelectedItem.Parent)),this.LoadCostCenterTree(parseInt(this.CostCenters.SelectedValue),e,0,null)}}LoadCostCenterTree(e,t,s,i){this.tree.Clear();let r="";50002==e&&"1"!=a.a.SessionManager.RoleID&&"True"==a.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==a.a.SessionManager.Preferences["LW Reports"]&&(r=n.e.StringIsNullOrEmpty(a.a.SessionManager.LocationWhere)?"A.NodeID IN (-1234)":"A.NodeID IN ("+a.a.SessionManager.LocationWhere+")");let l=new S.a;if(null==i)for(let a=0;a<this.CostCenterFilters.length;a++){const s=this.CostCenterFilters[a];if(s.CostCenterID==e&&s.LookupTypeID==t){i=s.SelectedNodes;break}}null==i?l.TreeViewModel_5(e,this,s,r,""):l.TreeViewModel_6(e,this,s,r,i,""),l.LookupTypeID=t,l.HeaderVisiblity=!1,l.OnNodeSelected||(l.OnNodeSelected=new T.b,l.OnNodeSelected.Subscribe(this,"OnNodeSelected")),this.tree.push(l)}OnNodeSelectedCallBack(){if(3==this.tree[0].CostCenterID&&this.tree[0].SelectedNodes.length>0){let e=this.CostCenterFilters.find(e=>3==e.CostCenterID);null!=e&&(e.HideFilter.Enable=!1,e.HideFilter.IsChecked=!0),this.FillUOM(this.tree[0].IsDynamicTree,this.tree[0].SelectedNodes)}}FillUOM(e,t){if(e&&t.filter(e=>e.IsGroup).length>0);else{let e="",s="",i=t.filter(e=>null==e.Tag),r=100,a=i.length;for(let t=0;t<a;t+=r){s="";for(let e=t;e<a&&e-t<r;e++)s.length>0&&(s+=","),s+=i[e].Id.toString();let n=this.oChart.GetProductsUOM(s.toString());if(null!=n&&n.Tables.length>0&&!n.Columns[0].Contains("ErrorMessage"))for(let s=t;s<a&&s-t<r;s++){let t=n.Tables[0].filter(e=>e.ProductID==i[s].Id);if(t.length>0){let r=parseInt(t[0].BaseID);this.dicBaseUnits.ContainsKey(r)||(e="",n.Tables[1].filter(e=>e.BaseID==r.toString()).forEach(s=>{""!=e&&(e+=","),e+=s.UOMID.toString(),0==this.UOM.Items.filter(e=>e.Value==s.UOMID.toString()).length&&this.UOM.Items.push(l.c.CheckedListBoxItem_5(null!=t[0].PCode?s.UnitName.toString()+" ~ "+t[0].PCode.toString():s.UnitName.toString(),s.UOMID.toString(),1==parseInt(s.UnitID.toString())))}),this.dicBaseUnits.push(r,e)),i[s].Tag=this.dicBaseUnits[r]}}}}}}class b{constructor(){this.selectedid=0,this.CostCenterID=0,this.NodeID=0,this.Title="",this.MessageVisibility=!1,this.DisplayMessage="",this.ReportName=new h.d(0),this.Group=new l.e(0)}AddGroupViewModel(e,t,s,i){this.parent=e,this.NodeID=s,this.CostCenterID=t,this.selectedid=i,this.ReportName.Label="Name",this.Group.Label="Group";let r=a.a.common.GetDataSet("PTC003",t.toString());if(r.Tables[0].forEach(e=>{this.Group.Items.push(l.d.ComboBoxItems_2(e.Name.toString(),e.ID.toString()))}),this.Group.SetSelectedItem(i.toString()),null==this.Group.SelectedValue&&(this.Group.SelectedValue=r.Tables[0][0].ID.toString()),this.Group.SelectionChangedCommand.Subscribe(this,"onGroupChange"),0==s)this.Title=a.a.GetResource("RevenUReport_CreateGroup");else if(s>0){this.Title=a.a.GetResource("RevenUReport_EditGroup");let e=r.Tables[0].filter(e=>e.ID==s);e.length>0&&(this.ReportName.Text=e[0].Name.toString(),this.Group.SelectedValue=e[0].ParentID.toString(),this.Group.Enable=!1)}}OnButtonClick(e){if("Cancel"==e.toString())a.a.page.HideDialog();else if("Save"==e.toString()){let e;if(n.e.IsNullOrWhiteSpace(this.ReportName.Text))return this.DisplayMessage="Enter Group Name",void(this.MessageVisibility=!0);if(e=0,40==this.CostCenterID){let t=(new D.a).SetPriceChartNew(this.NodeID,this.ReportName.Text,this.selectedid,!0,"","",0,!1);this.DisplayMessage=t.Message,e=t.RetValue}else 45==this.CostCenterID&&new D.a;e>0&&(this.ReportName.Text="",this.NodeID=0)}}onGroupChange(e){this.selectedid=parseInt(this.Group.SelectedValue)}}}}]);
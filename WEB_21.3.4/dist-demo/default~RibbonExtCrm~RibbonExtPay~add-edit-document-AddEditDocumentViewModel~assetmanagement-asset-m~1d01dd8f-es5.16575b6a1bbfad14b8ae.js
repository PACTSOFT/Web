function _defineProperties(t,e){for(var a=0;a<e.length;a++){var s=e[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function _createClass(t,e,a){return e&&_defineProperties(t.prototype,e),a&&_defineProperties(t,a),t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{hAwP:function(t,e,a){"use strict";a.d(e,"a",(function(){return n})),a.d(e,"b",(function(){return o}));var s=a("Do2H"),r=a("Lp6j"),i=a("eQJW"),l=a("NM0h"),n=function t(){_classCallCheck(this,t),this.IsPercentage=!1,this.Value=0,this.CurrentValue=0,this.ColID="",this.AssetChangeID=0,this.IsDispose=!1},o=function(){function t(e){_classCallCheck(this,t),this.YearlyDpr=0,this.MonthlyDpr=0,this.dblDayDpr=0,this.CallFromAssetSave=!1,this.iCVCount=0,this.ErrorMessage="",this.dtDepr=null,this.NewEsitmateLife="",this.NewEsitmateEndDate=Date.Today(),this.PrevDeprValue=0,this.dsAsset=null,this._DDBRate=0,this.AssetID=e,this.strDecimals="N"+s.a.SessionManager.Preferences.DecimalsinAmount}return _createClass(t,[{key:"GetScheduleData",value:function(t,e,a,o,h,D,d,c,g,u,p,S,A,M){var y=this,F=arguments.length>14&&void 0!==arguments[14]?arguments[14]:"",m=(arguments.length>15&&void 0!==arguments[15]&&arguments[15],1),T=0,b=0,f=0,v=0,C=[];this.ErrorMessage="";var Y=!1,w=!1;this.dsAsset=null;var V=0;if(this.EndDate=A,this._DDBRate=u,this.PrevDeprValue=D,this.ScheduleTable=[],this.ScheduleTableColumns=[],this.ScheduleTableColumns.push("Period"),this.ScheduleTableColumns.push("From"),this.ScheduleTableColumns.push("To"),this.ScheduleTableColumns.push("Depr Amt"),this.ScheduleTableColumns.push("Accm Depr"),this.ScheduleTableColumns.push("Net Value"),this.ScheduleTableColumns.push("ActualDeprAmt"),this.ScheduleTableColumns.push("ScheduleID"),this.ScheduleTableColumns.push("DocID"),!(t<=0)){if(this.AssetID>0){if(this.dsAsset=l.a.GetAssetDeprSchDetails(this.AssetID),this.dtDepr=this.dsAsset.Tables[1],!this.CallFromAssetSave){g=this.dsAsset.Tables[0][0].Period.toString();var I,E=this.NewEsitmateLife.length>0?this.NewEsitmateLife:this.dsAsset.Tables[0][0].EstimateLife.toString();I=E.indexOf("."),e=r.e.Int(-1!=I?E.substr(0,I):E);var N=E.split(".");N.length>1&&(a=r.e.Int(N[1])),N.length>2&&(o=r.e.Int(N[2])),null!=this.dsAsset.Tables[0][0].OriginalDeprStartDate&&(h=new Date(this.dsAsset.Tables[0][0].OriginalDeprStartDate)),Object(i.j)(this.dsAsset.Tables[0][0].IncludeSalvageInDepr)||(d="1"==this.dsAsset.Tables[0][0].SalvageValueType.toString()?parseFloat(this.dsAsset.Tables[0][0].SalvageValue):parseFloat(this.dsAsset.Tables[0][0].SalvageValue)*parseFloat(this.dsAsset.Tables[0][0].DeprStartValue)/100),this.PrevDeprValue=parseFloat(this.dsAsset.Tables[0][0].PreviousDepreciation),c=this.dsAsset.Tables[0][0].DepreciationMethod.toString(),p=this.dsAsset.Tables[0][0].AveragingMethod.toString(),this.NewEsitmateLife.length>0?(S=M.Date,A=this.NewEsitmateEndDate.AddDays(-1)):(S=new Date(this.dsAsset.Tables[0][0].DeprStartDate),A=new Date(this.dsAsset.Tables[0][0].DeprEndDate).AddDays(-1)),this.EndDate=A}"3"==p&&null==M&&1!=S.getDate()&&(w=!0,S.getDate()<=15?(S=S.AddDays(1-S.getDate()),A=A.AddDays(-A.getDate())):(S=S.AddDays(S.DaysInMonth()-S.getDate()+1),A=A.AddDays(A.DaysInMonth()-A.getDate())),this.EndDate=A);var P=null,_=this.dsAsset.Tables[2].filter((function(t){return 25==t.ChangeType}));if(_.sort((function(t,e){return e.Date-t.Date})),_.length>0&&((P=new Date(_[0].Date))>=M.Date&&null!=M))return void(this.ErrorMessage="Date should be greater than previous estimation chang date("+P.ToString(s.a.SessionManager.Preferences["Date Format"])+").");for(var L=this.dsAsset.Tables[2].filter((function(t){return 0==t.ChangeType||5==t.ChangeType})),R=0;R<L.length;R++){var k=L[R],B=new Date(k.Date);if(!(this.NewEsitmateLife.length>0||P&&P>B)){var O=new n;C.push(O),O.Date=B,O.Value+=parseFloat(k.ChangeValue),O.AssetChangeID=parseInt(k.AssetChangeID),5==parseInt(k.ChangeType)&&(O.IsDispose=!0)}}if(null!=M){if(M.Date>this.EndDate)return void(this.ErrorMessage="Date should be less than end date.");if(M.Date<S)return void(this.ErrorMessage="Date should be greater than put to use.");var W=this.dsAsset.Tables[1].filter((function(t){return null!=t.DocID&&(new Date(t.FromDate)>=M.Date||new Date(t.FromDate)<=M.Date&&new Date(t.ToDate)>M.Date)}));if(W.length>0)return void(this.ErrorMessage="Depreciation posting exists for selected date.");var H=new Date(M.Date.getFullYear(),M.Date.getMonth(),M.Date.getDate());if((W=this.dsAsset.Tables[1].filter((function(t){return null==t.DocID&&new Date(t.ToDate)<H}))).length>0)return void(this.ErrorMessage="Clear Pending Depreciation Postings.");0==this.NewEsitmateLife.length&&C.push(M)}if(this.dsAsset.Tables[1].length>0){Y=!0;var Q,j=0;Q=null==this.dsAsset.Tables[0][0].DeprStartValue?parseFloat(this.dsAsset.Tables[0][0].PurchaseValue):parseFloat(this.dsAsset.Tables[0][0].DeprStartValue);for(var G=!1,J=0;J<this.dsAsset.Tables[1].length;J++){var X=this.dsAsset.Tables[1][J];if(0!=this.NewEsitmateLife.length&&null==X.DocID){if(G)continue;var x=0;t=parseFloat(X.NetValue)+parseFloat(X.DeprAmt),new Date(X.FromDate)!=M.Date&&(M.Date.Subtract(new Date(X.FromDate)),x=parseFloat(X.DeprAmt)*M.Date.Subtract(new Date(X.FromDate)).Days/new Date(X.ToDate).Subtract(new Date(X.FromDate)).Days,t-=x=parseFloat(x.ToString(this.strDecimals)),this.ScheduleTableAdd(m,new Date(X.FromDate),M.Date.AddDays(-1),x,j+x,t,x),m++),V=j+x,G=!0}else{var U={};this.ScheduleTable.push(U),U.Period=m,U.From=new Date(X.FromDate),U.To=new Date(X.ToDate),0!=this.NewEsitmateLife.length?(U.ActualDeprAmt=parseFloat(X.DeprAmt),U["Depr Amt"]=parseFloat(X.DeprAmt),j+=parseFloat(X.DeprAmt),U["Accm Depr"]=j,U["Net Value"]=X.NetValue):(U.ActualDeprAmt=parseFloat(X.ActualDeprAmt),U["Depr Amt"]=parseFloat(X.ActualDeprAmt),j+=parseFloat(X.ActualDeprAmt),U["Accm Depr"]=j,U["Net Value"]=Q-j),U.ScheduleID=parseFloat(X.ScheduleID),U.DocID=X.DocID,m++}}}}if("4"==c)c="WDV";else if("5"==c){if(c="WDV_IT_India",p="FP",!r.e.IsEmpty(F)&&parseInt(F)>0){var q=s.a.report.DataSet("RPT022","select BasedOnValue from ACC_DeprBook with(nolock) where DeprBookID="+F);u=parseFloat(q.Tables[0][0].BasedOnValue)}}else c="SLN";var z=p;if("1"==p?p="CD":"3"==p?(1==S.getDate()||w||(S.getDate()<=15?(S=S.AddDays(1-S.getDate()),A=A.AddDays(-A.getDate())):(S=S.AddDays(S.DaysInMonth()-S.getDate()+1),A=A.AddDays(A.DaysInMonth()-A.getDate())),this.EndDate=A),p="FP"):p="FP",g="1"==g?"M":"3"==g?"Q":"4"==g?"H":"Y",!Y||0!=this.NewEsitmateLife.length){if(o>0&&0==this.NewEsitmateLife.length&&"1"!=z&&(null==h||!h))return void(this.ErrorMessage="Select Original Put To Use.");if("WDV_IT_India"==c)this.YearlyDpr=null!=M?t*u/100:(t+this.PrevDeprValue)*u/100;else if(this.PrevDeprValue>0&&o>0&&"CD"!=p){var K,Z;null!=M?(K=t,Z=S):(K=t+this.PrevDeprValue,Z=h);for(var $=0,tt=h.getDate(),et=Z;et<A.AddDays(1);)$++,et=et.AddMonths(1),tt>=29&&et.getDate()<tt&&tt<=et.DaysInMonth()&&(et=new Date(et.getFullYear(),et.getMonth(),tt));this.YearlyDpr=this.CalcDeprPerYear(K,0,$,d,c)}else this.YearlyDpr=this.CalcDeprPerYear(t,e,a,d,c);this.YearlyDpr=parseFloat(this.YearlyDpr.ToString(this.strDecimals)),this.MonthlyDpr=parseFloat((this.YearlyDpr/12).ToString(this.strDecimals)),this.dblDayDpr=0,"CD"==p&&(this.dblDayDpr=this.CalcDeprPerDay(t,d,c,S,A));var at,st,rt=0,it=S.DaysInMonth()-S.getDate()+1,lt=12-S.iMonth();if(1!=s.a.SessionManager.AccountingFromMonth&&(lt=s.a.SessionManager.AccountingFromMonth<=S.iMonth()?15-S.iMonth():3-S.iMonth()),"SLN"==c){if("M"==g){1!=S.getDate()?(st=S.iMonth()<12?new Date(S.getFullYear(),S.getMonth()+1,1):new Date(S.getFullYear()+1,0,1)).AddDays(-1)>A?st=A:(rt="CD"==p?it*this.dblDayDpr:S.AddDays(it).Subtract(S).TotalDays/S.DaysInMonth()*this.MonthlyDpr,rt=parseFloat(rt.ToString(this.strDecimals)),this.ScheduleTableAdd(m,S,S.AddDays(it-1),rt,rt+V,t-rt),m++):st=new Date(S.getFullYear(),S.getMonth(),1);for(var nt=0,ot=0,ht=st;ht.AddMonths(1)<=A;ht=ht.AddMonths(1))ot="CD"==p?parseFloat((st.DaysInMonth()*this.dblDayDpr).ToString(this.strDecimals)):this.MonthlyDpr,rt=parseFloat((rt+ot).ToString(this.strDecimals)),nt=parseFloat((0+t-rt).ToString(this.strDecimals)),this.ScheduleTableAdd(m,st,st.AddMonths(1).AddDays(-1),ot,rt+V,nt),m++,st=st.AddMonths(1);st=new Date(A.getFullYear(),A.getMonth(),1);var Dt=parseFloat((0+t-d-rt).ToString(this.strDecimals));nt=parseFloat((0+t-(rt+Dt)).ToString(this.strDecimals)),Dt>0&&this.ScheduleTableAdd(m,st,A,Dt,rt+Dt+V,nt)}else if("Y"==g){(st=1!=s.a.SessionManager.AccountingFromMonth&&S.iMonth()<s.a.SessionManager.AccountingFromMonth?new Date(S.getFullYear(),s.a.SessionManager.AccountingFromMonth-1,1):new Date(S.getFullYear()+1,s.a.SessionManager.AccountingFromMonth-1,1)).AddDays(-1)>A?st=A:("CD"==p?rt=parseFloat((st.Subtract(S).Days*this.dblDayDpr).ToString(this.strDecimals)):1!=S.getDate()?(rt=S.AddDays(it).Subtract(S).TotalDays/S.DaysInMonth()*this.MonthlyDpr,rt=parseFloat((rt+lt/12*this.YearlyDpr).ToString(this.strDecimals))):rt=parseFloat(((lt+1)/12*this.YearlyDpr).ToString(this.strDecimals)),this.ScheduleTableAdd(m,S,st.AddDays(-1),rt,rt+V,t-rt),m++);for(var dt=0,ct=0,gt=st;gt<A.AddYears(-1);gt=gt.AddYears(1))ct="CD"==p?parseFloat((st.AddYears(1).Subtract(st).Days*this.dblDayDpr).ToString(this.strDecimals)):this.YearlyDpr,rt=parseFloat((rt+ct).ToString(this.strDecimals)),dt=parseFloat((t-rt).ToString(this.strDecimals)),this.ScheduleTableAdd(m,st,st.AddYears(1).AddDays(-1),ct,rt+V,dt),m++,st=st.AddYears(1);st=new Date(A.getFullYear(),s.a.SessionManager.AccountingFromMonth-1,1),1!=s.a.SessionManager.AccountingFromMonth&&st>A&&(st=st.AddYears(-1));var ut=parseFloat((t-d-rt).ToString(this.strDecimals));dt=parseFloat((t-(rt+ut)).ToString(this.strDecimals)),ut>0&&this.ScheduleTableAdd(m,st,A,ut,rt+ut+V,dt)}else if("Q"==g){var pt=[],St=new Date(S.getFullYear(),s.a.SessionManager.AccountingFromMonth-1,1);St>S&&(St=St.AddYears(-1));for(var At=1,Mt=0,yt=0;St.AddMonths(3)<=S;)At++,St=St.AddMonths(3);for(pt.push(S);St.AddMonths(3)<=A;)5==++At&&(At=1),St=St.AddMonths(3),pt.push(St);if(1!=S.getDate()&&((st=new Date(S.getFullYear(),S.getMonth(),1).AddMonths(1)).AddDays(-1)>A?st=A:(rt="CD"==p?parseFloat((it*this.dblDayDpr).ToString(this.strDecimals)):S.AddDays(it).Subtract(S).TotalDays/S.DaysInMonth()*this.MonthlyDpr,rt=parseFloat(rt.ToString(this.strDecimals)),pt[0]=st)),pt.length>1){if(pt[0]==pt[1])this.ScheduleTableAdd(m,S,S.AddDays(it-1),rt,rt+V,t-rt);else{var Ft=1!=S.getDate()?it:0;Ft+=pt[1].Subtract(pt[0]).Days,"CD"==p?yt=parseFloat((pt[1].Subtract(pt[0]).Days*this.dblDayDpr).ToString(this.strDecimals)):(At=pt[1].Subtract(pt[0]).Days/28,yt=this.MonthlyDpr*At),rt=parseFloat((rt+yt).ToString(this.strDecimals)),this.ScheduleTableAdd(m,S,S.AddDays(Ft-1),rt,rt+V,t-rt)}pt.RemoveAt(0)}for(var mt=0;mt<pt.length-1;mt++)yt="CD"==p?parseFloat((pt[mt+1].Subtract(pt[mt]).Days*this.dblDayDpr).ToString(this.strDecimals)):3*this.MonthlyDpr,rt=parseFloat((rt+yt).ToString(this.strDecimals)),Mt=parseFloat((t-rt).ToString(this.strDecimals)),this.ScheduleTableAdd(m,pt[mt],pt[mt+1].AddDays(-1),yt,rt+V,Mt);var Tt=parseFloat((t-d-rt).ToString(this.strDecimals));Mt=parseFloat((t-(rt+Tt)).ToString(this.strDecimals)),Tt>0&&this.ScheduleTableAdd(m,pt[pt.length-1],A,Tt,rt+Tt+V,Mt)}else if("H"==g){var bt=[],ft=new Date(S.getFullYear(),s.a.SessionManager.AccountingFromMonth-1,1);ft>S&&(ft=ft.AddYears(-1));for(var vt=1,Ct=0,Yt=0;ft.AddMonths(6)<=S;)vt++,ft=ft.AddMonths(6);for(bt.push(S);ft.AddMonths(6)<=A;)3==++vt&&(vt=1),ft=ft.AddMonths(6),bt.push(ft);if(1!=S.getDate()&&(st=new Date(S.getFullYear(),S.getMonth(),1).AddMonths(1),1==bt.length?st=A:(rt="CD"==p?parseFloat((it*this.dblDayDpr).ToString(this.strDecimals)):S.AddDays(it).Subtract(S).TotalDays/S.DaysInMonth()*this.MonthlyDpr,rt=parseFloat(rt.ToString(this.strDecimals)),bt[0]=st)),bt.length>1){if(bt[0]==bt[1])this.ScheduleTableAdd(m,S,S.AddDays(it-1),rt,rt+V,t-rt);else{var wt=1!=S.getDate()?it:0;wt+=bt[1].Subtract(bt[0]).Days,"CD"==p?Yt=parseFloat((bt[1].Subtract(bt[0]).Days*this.dblDayDpr).ToString(this.strDecimals)):(vt=bt[1].Subtract(bt[0]).Days/28,Yt=this.MonthlyDpr*vt),rt=parseFloat((rt+Yt).ToString(this.strDecimals)),this.ScheduleTableAdd(m,S,S.AddDays(wt-1),rt,rt+V,t-rt)}bt.RemoveAt(0)}for(var Vt=0;Vt<bt.length-1;Vt++)Yt="CD"==p?parseFloat((bt[Vt+1].Subtract(bt[Vt]).Days*this.dblDayDpr).ToString(this.strDecimals)):6*this.MonthlyDpr,rt=parseFloat((rt+Yt).ToString(this.strDecimals)),Ct=parseFloat((t-rt).ToString(this.strDecimals)),this.ScheduleTableAdd(m,bt[Vt],bt[Vt+1].AddDays(-1),Yt,rt+V,Ct);var It=parseFloat((t-d-rt).ToString(this.strDecimals));Ct=parseFloat((t-(rt+It)).ToString(this.strDecimals)),It>0&&this.ScheduleTableAdd(m,bt[bt.length-1],A,It,rt+It+V,Ct)}}else if("WDV"==c){var Et=t,Nt=0;if(!r.e.StringIsNullOrEmpty(F)&&parseInt(F)>0){var Pt=s.a.common.GetDataSet("DEPSCHE001",F);u=parseFloat(Pt.Tables[0][0].BasedOnValue),this._DDBRate=u}if(it="CD"==p?S.DaysInMonth()-S.getDate()+1:S.DaysInMonth(),this.dblDayDpr=this.CalcDeprePerDay(t,this._DDBRate,c,S,A,e),"M"==g){1!=S.getDate()?(st=S.iMonth()<12?new Date(S.getFullYear(),S.getMonth()+1,1):new Date(S.getFullYear()+1,1,1)).AddDays(-1)>A?st=A:(rt="CD"==p?it*this.dblDayDpr:parseFloat((it*this.dblDayDpr).ToString(this.strDecimals)),rt=parseFloat((rt+Nt).ToString(this.strDecimals)),t=Et=parseFloat((t-rt).ToString(this.strDecimals)),this.ScheduleTableAdd(m,st,st.AddMonths(1).AddDays(-1),Nt,rt+V,Et),m++,T++):st=new Date(S.getFullYear(),S.getMonth(),1);for(var _t=st;_t.AddMonths(1)<=A;_t=_t.AddMonths(1))rt=0,Nt=parseFloat((st.DaysInMonth()*this.dblDayDpr).ToString(this.strDecimals)),rt=parseFloat((rt+Nt).ToString(this.strDecimals)),Et=parseFloat((t-rt).ToString(this.strDecimals)),t=parseFloat(Et.ToString(this.strDecimals)),this.ScheduleTableAdd(m,st,st.AddMonths(1).AddDays(-1),Nt,rt+V,Et),m++,st.getMonth()==s.a.SessionManager.AccountingFromMonth&&T>0&&(T=12),12==++T&&(v=Et*this._DDBRate/100,this.dblDayDpr=this.CalcDeprePerDay(t,v,c,st,A,e),T=0,v=0),st=st.AddMonths(1);st=new Date(A.getFullYear(),A.getMonth(),1);var Lt=0;Lt=parseFloat((st.DaysInMonth()*this.dblDayDpr).ToString(this.strDecimals)),Et=parseFloat((t-rt).ToString(this.strDecimals)),Lt>0&&this.ScheduleTableAdd(m,st,A,Lt,Lt,Et)}else if("Y"==g){(st=1!=s.a.SessionManager.AccountingFromMonth&&S.iMonth()<s.a.SessionManager.AccountingFromMonth?new Date(S.getFullYear(),s.a.SessionManager.AccountingFromMonth-1,1):new Date(S.getFullYear()+1,s.a.SessionManager.AccountingFromMonth-1,1)).AddDays(-1)>A?st=A:("CD"==p?rt=parseFloat((st.Subtract(S).Days*Et*this.dblDayDpr).ToString(this.strDecimals)):1!=S.getDate()?(rt=S.AddDays(it).Subtract(S).TotalDays/S.DaysInMonth()*Et*this.MonthlyDpr,rt=parseFloat((rt+lt/12*Et*this.YearlyDpr).ToString(this.strDecimals))):rt=parseFloat(((lt+1)/12*Et*this.YearlyDpr).ToString(this.strDecimals)),Et-=rt,this.ScheduleTableAdd(m,S,st.AddDays(-1),rt,rt+V,Et),m++);for(var Rt=st;Rt<A.AddYears(-1);Rt=Rt.AddYears(1))Nt="CD"==p?parseFloat((st.AddYears(1).Subtract(st).Days*Et*this.dblDayDpr).ToString(this.strDecimals)):parseFloat((Et*this.YearlyDpr).ToString(this.strDecimals)),rt=parseFloat((rt+Nt).ToString(this.strDecimals)),Et=parseFloat((Et-Nt).ToString(this.strDecimals)),this.ScheduleTableAdd(m,st,st.AddYears(1).AddDays(-1),Nt,rt+V,Et),m++,st=st.AddYears(1);st=new Date(A.getFullYear(),s.a.SessionManager.AccountingFromMonth-1,1),1!=s.a.SessionManager.AccountingFromMonth&&st>A&&(st=st.AddYears(-1));var kt=parseFloat((t-d-rt).ToString(this.strDecimals));Et=parseFloat((t-(rt+kt)).ToString(this.strDecimals)),kt>0&&this.ScheduleTableAdd(m,st,A,kt,rt+kt+V,Et)}else if("Q"==g){var Bt=new Array,Ot=new Date(S.getFullYear(),s.a.SessionManager.AccountingFromMonth-1,1);Ot>S.Date()&&(Ot=Ot.AddYears(-1));for(var Wt=1;Ot.AddMonths(3)<=S;)Wt++,Ot=Ot.AddMonths(3);for(Bt.push(S);Ot.AddMonths(3)<=A;)5==++Wt&&(Wt=1),Ot=Ot.AddMonths(3),Bt.push(Ot);if(1!=S.getDate()&&((st=new Date(S.getFullYear(),S.getMonth(),1).AddMonths(1)).AddDays(-1)>A?st=A:(rt=it*this.dblDayDpr,Bt[0]=st)),Bt.length>1){if(b++,Bt[0]==Bt[1])t=Et=parseFloat((t-rt).ToString(this.strDecimals)),this.ScheduleTableAdd(m,S,S.AddDays(it-1),rt,rt+V,Et);else{var Ht=1!=S.getDate()?it:0;Ht+=Bt[1].Subtract(Bt[0]).Days,Nt=parseFloat((Bt[1].Subtract(Bt[0]).Days*this.dblDayDpr).ToString(this.strDecimals)),rt=parseFloat((rt+Nt).ToString(this.strDecimals)),t=Et=parseFloat((t-rt).ToString(this.strDecimals)),this.ScheduleTableAdd(m,S,S.AddDays(Ht-1),rt,rt+V,Et)}Bt.RemoveAt(0)}for(var Qt=0;Qt<Bt.length-1;Qt++)rt=0,Nt=parseFloat((Bt[Qt+1].Subtract(Bt[Qt]).Days*this.dblDayDpr).ToString(this.strDecimals)),rt=parseFloat((rt+Nt).ToString(this.strDecimals)),t=Et=parseFloat((t-rt).ToString(this.strDecimals)),this.ScheduleTableAdd(m,Bt[Qt],Bt[Qt+1].AddDays(-1),Nt,rt+V,Et),4==++b&&(v=Et*this._DDBRate/100,this.dblDayDpr=this.CalcDeprePerDay(t,v,c,Bt[Qt+1].Date,A,e),b=0,v=0);var jt=A.Subtract(Bt[Bt.length-1]).TotalDays;jt+=1;var Gt=parseFloat((jt*this.dblDayDpr).ToString(this.strDecimals));Et=parseFloat((t-rt).ToString(this.strDecimals)),Gt>0&&this.ScheduleTableAdd(m,Bt[Bt.length-1],A,Gt,Gt,Et)}else if("H"==g){var Jt=new Array,Xt=new Date(S.getFullYear(),s.a.SessionManager.AccountingFromMonth-1,1);Xt>S.Date()&&(Xt=Xt.AddYears(-1));for(var xt=1;Xt.AddMonths(6)<=S;)xt++,Xt=Xt.AddMonths(6);for(Jt.push(S);Xt.AddMonths(6)<=A;)3==++xt&&(xt=1),Xt=Xt.AddMonths(6),Jt.push(Xt);if(1!=S.getDate()&&(st=new Date(S.getFullYear(),S.getMonth(),1).AddMonths(1),1==Jt.length?st=A:(rt=it*this.dblDayDpr,Jt[0]=st)),Jt.length>1){if(f++,Jt[0]==Jt[1])t=Et=parseFloat((t-rt).ToString(this.strDecimals)),this.ScheduleTableAdd(m,S,S.AddDays(it-1),rt,rt+V,Et);else{var Ut=1!=S.getDate()?it:0;Ut+=Jt[1].Subtract(Jt[0]).Days,Nt=parseFloat((Jt[1].Subtract(Jt[0]).Days*this.dblDayDpr).ToString(this.strDecimals)),rt=parseFloat((rt+Nt).ToString(this.strDecimals)),t=Et=parseFloat((t-rt).ToString(this.strDecimals)),this.ScheduleTableAdd(m,S,S.AddDays(Ut-1),rt,rt+V,Et)}Jt.RemoveAt(0)}for(var qt=0;qt<Jt.length-1;qt++)rt=0,Nt=parseFloat((Jt[qt+1].Subtract(Jt[qt]).Days*this.dblDayDpr).ToString(this.strDecimals)),rt=parseFloat((rt+Nt).ToString(this.strDecimals)),t=Et=parseFloat((t-rt).ToString(this.strDecimals)),this.ScheduleTableAdd(m,Jt[qt],Jt[qt+1].AddDays(-1),Nt,rt+V,Et),2==++f&&(v=Et*this._DDBRate/100,this.dblDayDpr=this.CalcDeprePerDay(t,v,c,Jt[qt+1].Date,A,e),f=0,v=0);var zt=A.Subtract(Jt[Jt.length-1]).TotalDays;zt+=1;var Kt=parseFloat((zt*this.dblDayDpr).ToString(this.strDecimals));Et=parseFloat((t-rt).ToString(this.strDecimals)),Kt>0&&this.ScheduleTableAdd(m,Jt[Jt.length-1],A,Kt,Kt,Et)}}else if("WDV_IT_India"==c){var Zt=t,$t=0;for(st=new Date(S.getFullYear(),S.getMonth(),1).AddMonths(1),(st=1!=s.a.SessionManager.AccountingFromMonth&&S.iMonth()<s.a.SessionManager.AccountingFromMonth?new Date(S.getFullYear(),s.a.SessionManager.AccountingFromMonth-1,1):new Date(S.getFullYear()+1,s.a.SessionManager.AccountingFromMonth-1,1)).AddDays(-1)>A?st=A:(Zt-=rt=lt<=5?parseFloat((Zt*u*.5/100).ToString(this.strDecimals)):parseFloat((Zt*u/100).ToString(this.strDecimals)),this.ScheduleTableAdd(m,S,st.AddDays(-1),rt,rt+V,Zt),m++);Zt>=.1;)$t=parseFloat((Zt*u/100).ToString(this.strDecimals)),rt=parseFloat((rt+$t).ToString(this.strDecimals)),Zt=parseFloat((Zt-$t).ToString(this.strDecimals)),this.ScheduleTableAdd(m,st,st.AddYears(1).AddDays(-1),$t,rt+V,Zt),m++,st=st.AddYears(1)}else if("DDB"==c&&"Y"==g){st=new Date(S.getFullYear()+1,1,1);var te=t-(rt=(lt+1)/12*(at=t*u));this.ScheduleTableAdd(m,S,st,rt,rt,te),st=new Date(S.getFullYear()+1,1,1),m++;for(var ee=S;ee<A.AddYears(-1);ee=ee.AddYears(1))(at=.4*te)>t-d-rt&&(at=t-d-rt),te=t-(rt+=at),this.ScheduleTableAdd(m,st,st.AddYears(1).AddDays(-1),at,rt,te),m++,st=st.AddYears(1);if(1==S.getDate()&&1==S.iMonth());else{st=new Date(A.getFullYear(),0,1);var ae=(1==S.getDate()?A.iMonth():A.iMonth()-1)/12*(at=.4*te),se=!1;ae>t-d-rt&&(ae=t-d-rt,se=!0),rt+=ae,(0!=ae||se)&&this.ScheduleTableAdd(m,st,A,ae,rt,t-rt)}}else if("DDB"==c&&"M"==g){var re=0;at=t*u,this.MonthlyDpr=at/12,1!=S.getDate()?(re=t-(rt=S.AddDays(it).Subtract(S).TotalDays/S.DaysInMonth()*this.MonthlyDpr),this.ScheduleTableAdd(m,S,S.AddDays(it-1),rt,rt,re),m++,st=S.iMonth()<12?new Date(S.getFullYear(),S.getMonth()+1,1):new Date(S.getFullYear()+1,0,1)):st=new Date(S.getFullYear(),S.getMonth(),1),A.getDate();for(var ie=st;ie<A.AddMonths(-1);ie=ie.AddMonths(1))m>1&&1==ie.getDate()&&1==ie.iMonth()&&(at=.4*re,this.MonthlyDpr=at/12),this.MonthlyDpr>t-d-rt&&(this.MonthlyDpr=t-d-rt),re=t-(rt+=this.MonthlyDpr),this.ScheduleTableAdd(m,st,st.AddMonths(1).AddDays(-1),this.MonthlyDpr,rt,re),m++,st=st.AddMonths(1);if(1!=S.getDate()){st=new Date(A.getFullYear(),A.getMonth(),1);var le=A.DaysInMonth();this.ScheduleTableAdd(m,st,st.AddDays(A.getDate()-1),A.getDate()/le*this.MonthlyDpr,rt+A.getDate()/le*this.MonthlyDpr,t-(rt+A.getDate()/le*this.MonthlyDpr)),m++}else st=new Date(A.getFullYear(),A.getMonth(),1),this.ScheduleTableAdd(m,st,st.AddMonths(1).AddDays(-1),this.MonthlyDpr,rt+this.MonthlyDpr,t-(rt+this.MonthlyDpr)),m++}this.ScheduleTable.forEach((function(t){t.ActualDeprAmt=t["Depr Amt"]}))}if(this.iCVCount=0,this.ScheduleTableColumns.push("CV"),this.ScheduleTableColumns.push("CVTotal"),C.forEach((function(t){t.ColID="CV"+y.iCVCount,y.ScheduleTableColumns.Contains(t.ColID)&&y.ScheduleTableColumns.Remove(t.ColID),y.ScheduleTableColumns.push(t.ColID),y.iCVCount++,y.SetChangeValueData(t,c,g,p,t.Date)})),C.length>0&&this.ScheduleTable.length>0){var ne=0,oe=0,he=0,De=0;this.ScheduleTable.forEach((function(t){oe+=null!=t.CVTotal?parseFloat(t.CVTotal):0,ne=null!=t.CV?parseFloat(t.CV):0,t["Depr Amt"]=parseFloat((parseFloat(t["Depr Amt"])+ne).ToString(y.strDecimals)),De+=parseFloat(t["Depr Amt"]),t["Accm Depr"]=parseFloat(De.ToString(y.strDecimals)),he+=ne,t["Net Value"]=parseFloat((parseFloat(t["Net Value"])+(oe-he)).ToString(y.strDecimals))}))}}}},{key:"ScheduleTableAdd",value:function(t,e,a,s,r,i){var l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,n={};this.ScheduleTable.push(n),n.Period=t,n.From=e,n.To=a,n["Depr Amt"]=s,n["Accm Depr"]=r,n["Net Value"]=i,n.ActualDeprAmt=l}},{key:"SetChangeValueData",value:function(t,e,a,r,i){for(var l,n=t.Value,o=0,h=i;h<=this.EndDate;)o++,h=h.AddMonths(1);l=Math.floor(o/12),o%=12,this.dblDayDpr=0,this.dblDayDpr=this.CalcDeprPerDay(n,0,e,i,this.EndDate),this.YearlyDpr=this.CalcDeprPerYear(n,l,o,0,e),this.MonthlyDpr=parseFloat((this.YearlyDpr/12).ToString(this.strDecimals));var D,d=0,c=i.DaysInMonth()-i.getDate()+1,g=12-i.iMonth();1!=s.a.SessionManager.AccountingFromMonth&&(g=s.a.SessionManager.AccountingFromMonth<=i.iMonth()?15-i.iMonth():3-i.iMonth());var u=this.ScheduleTable.filter((function(t){return t.From<=i&&t.To>i}));if(u.length>0){var p=t.IsDispose?-t.Value:t.Value;u[0].CVTotal=null==u[0].CVTotal?p:parseFloat(u[0].CVTotal)+p}if("SLN"==e){if("M"==a){1!=i.getDate()?(d="CD"==r?c*this.dblDayDpr:i.AddDays(c).Subtract(i).TotalDays/i.DaysInMonth()*this.MonthlyDpr,d=parseFloat(d.ToString(this.strDecimals)),this.SetCV(t,i,d),D=i.iMonth()<12?new Date(i.getFullYear(),i.getMonth()+1,1):new Date(i.getFullYear()+1,0,1)):D=new Date(i.getFullYear(),i.getMonth(),1);for(var S=0,A=i;A<this.EndDate.AddMonths(-1);A=A.AddMonths(1))S="CD"==r?parseFloat((D.DaysInMonth()*this.dblDayDpr).ToString(this.strDecimals)):this.MonthlyDpr,this.SetCV(t,D,S),d+=S,D=D.AddMonths(1);D=new Date(this.EndDate.getFullYear(),this.EndDate.getMonth(),1);var M=parseFloat((n-d).ToString(this.strDecimals));this.SetCV(t,D,M)}else if("Y"==a){var y;(D=1!=s.a.SessionManager.AccountingFromMonth&&i.iMonth()<s.a.SessionManager.AccountingFromMonth?new Date(i.getFullYear(),s.a.SessionManager.AccountingFromMonth-1,1):new Date(i.getFullYear()+1,s.a.SessionManager.AccountingFromMonth-1,1)).AddDays(-1)>this.EndDate?D=this.EndDate:(D=new Date(i.getFullYear()+1,0,1),"CD"==r?d=parseFloat((D.Subtract(i).Days*this.dblDayDpr).ToString(this.strDecimals)):1!=i.getDate()?(d=i.AddDays(c).Subtract(i).TotalDays/i.DaysInMonth()*this.MonthlyDpr,d=parseFloat((d+g/12*this.YearlyDpr).ToString(this.strDecimals))):d=parseFloat(((g+1)/12*this.YearlyDpr).ToString(this.strDecimals))),this.SetCV(t,i,d),D=1!=s.a.SessionManager.AccountingFromMonth&&i.iMonth()<s.a.SessionManager.AccountingFromMonth?new Date(i.getFullYear(),s.a.SessionManager.AccountingFromMonth-1,1):new Date(i.getFullYear()+1,s.a.SessionManager.AccountingFromMonth-1,1);for(var F=i;F<this.EndDate.AddYears(-1);F=F.AddYears(1))y="CD"==r?parseFloat((D.AddYears(1).Subtract(D).Days*this.dblDayDpr).ToString(this.strDecimals)):this.YearlyDpr,d=parseFloat((d+y).ToString(this.strDecimals)),this.SetCV(t,D,y),D=D.AddYears(1);if(1==i.getDate()&&1==i.iMonth());else{D=new Date(this.EndDate.getFullYear(),1,1);var m=parseFloat((n-d).ToString(this.strDecimals));m>0&&this.SetCV(t,D,m)}}else if("Q"==a){var T=[],b=new Date(i.getFullYear(),s.a.SessionManager.AccountingFromMonth-1,1);b>i&&(b=b.AddYears(-1));for(var f,v=1;b.AddMonths(3)<=i;)v++,b=b.AddMonths(3);for(T.push(i);b.AddMonths(3)<=this.EndDate;)5==++v&&(v=1),b=b.AddMonths(3),T.push(b);if(1!=i.getDate()&&(D=new Date(i.getFullYear(),i.getMonth(),1).AddMonths(1),d="CD"==r?parseFloat((c*this.dblDayDpr).ToString(this.strDecimals)):i.AddDays(c).Subtract(i).TotalDays/i.DaysInMonth()*this.MonthlyDpr,d=parseFloat(d.ToString(this.strDecimals)),T[0]=D),T.length>1){if(T[0]==T[1])this.SetCV(t,i,d);else{i.getDate();T[1].Subtract(T[0]).Days,"CD"==r?f=parseFloat((T[1].Subtract(T[0]).Days*this.dblDayDpr).ToString(this.strDecimals)):(v=T[1].Subtract(T[0]).Days/28,f=this.MonthlyDpr*v),d=parseFloat((d+f).ToString(this.strDecimals)),this.SetCV(t,i,d)}T.RemoveAt(0)}for(var C=0;C<T.length-1;C++)f="CD"==r?parseFloat((T[C+1].Subtract(T[C]).Days*this.dblDayDpr).ToString(this.strDecimals)):3*this.MonthlyDpr,d=parseFloat((d+f).ToString(this.strDecimals)),this.SetCV(t,T[C],d);if(T[T.length-1]<=this.EndDate){var Y=parseFloat((n-d).ToString(this.strDecimals));this.SetCV(t,T[T.length-1],Y)}}else if("H"==a){var w=[],V=new Date(i.getFullYear(),s.a.SessionManager.AccountingFromMonth-1,1);V>i&&(V=V.AddYears(-1));for(var I,E=1;V.AddMonths(6)<=i;)E++,V=V.AddMonths(6);for(w.push(i);V.AddMonths(6)<=this.EndDate;)3==++E&&(E=1),V=V.AddMonths(6),w.push(V);if(1!=i.getDate()&&(D=new Date(i.getFullYear(),i.getMonth(),1).AddMonths(1),d="CD"==r?parseFloat((c*this.dblDayDpr).ToString(this.strDecimals)):i.AddDays(c).Subtract(i).TotalDays/i.DaysInMonth()*this.MonthlyDpr,d=parseFloat(d.ToString(this.strDecimals)),w[0]=D),w.length>1){if(w[0]==w[1])this.SetCV(t,i,d);else{i.getDate();w[1].Subtract(w[0]).Days,"CD"==r?I=parseFloat((w[1].Subtract(w[0]).Days*this.dblDayDpr).ToString(this.strDecimals)):(E=w[1].Subtract(w[0]).Days/28,I=this.MonthlyDpr*E),d=parseFloat((d+I).ToString(this.strDecimals)),this.SetCV(t,i,d)}w.RemoveAt(0)}for(var N=0;N<w.length-1;N++)I="CD"==r?parseFloat((w[N+1].Subtract(w[N]).Days*this.dblDayDpr).ToString(this.strDecimals)):6*this.MonthlyDpr,d=parseFloat((d+I).ToString(this.strDecimals)),this.SetCV(t,w[N],d);if(w[w.length-1]<=this.EndDate){var P=parseFloat((n-d).ToString(this.strDecimals));this.SetCV(t,w[w.length-1],P)}}}else if("WDV_IT_India"==e){var _=n,L=0;for((D=1!=s.a.SessionManager.AccountingFromMonth&&i.iMonth()<s.a.SessionManager.AccountingFromMonth?new Date(i.getFullYear(),s.a.SessionManager.AccountingFromMonth-1,1):new Date(i.getFullYear()+1,s.a.SessionManager.AccountingFromMonth-1,1)).AddDays(-1)>this.EndDate?D=this.EndDate:(_-=d=g<=5?parseFloat((_*this._DDBRate*.5/100).ToString(this.strDecimals)):parseFloat((_*this._DDBRate/100).ToString(this.strDecimals)),this.SetCV(t,i,d));_>=.1;)L=parseFloat((_*this._DDBRate/100).ToString(this.strDecimals)),d=parseFloat((d+L).ToString(this.strDecimals)),_=parseFloat((_-L).ToString(this.strDecimals)),this.SetCV(t,D,L),D=D.AddYears(1);var R=parseFloat((n-d).ToString(this.strDecimals));R>0&&this.SetCV(t,D,R)}}},{key:"SetCV",value:function(t,e,a){var s=this.ScheduleTable.filter((function(t){return t.From<=e&&t.To>e}));s.length>0&&(t.IsDispose&&(a=-a),s[0][t.ColID]=null==s[0][t.ColID]?a:parseFloat(s[0][t.ColID])+a,s[0].CV=null==s[0].CV?a:parseFloat(s[0].CV)+a)}},{key:"CalcDeprPerYear",value:function(t,e,a,s,r){return"SLN"==r?0==e&&0==a?t:a>0?(t-s)/(12*e+a)*12:(t-s)/e:"WDV"==r?0==e&&0==a?1:a>0?12*(1-Math.pow(s/t,1/(12*e+a))):1-Math.pow(s/t,1/e):t}},{key:"CalcDeprPerDay",value:function(t,e,a,s,r){var i=r.Subtract(s).Days+1;return"SLN"==a?i<=0?NaN:(t-e)/i:"WDV"==a?i<=0?NaN:1-Math.pow(e/t,1/i):NaN}},{key:"CalcDeprePerDay",value:function(t,e,a,s,r,i){r.Subtract(s);var l=365,n=(s.AddYears(i),s.DaysInMonth());return s.IsLeapYear()&&(l=366),"WDV"==a?n<=0?Number.NaN:e/l:Number.NaN}},{key:"GetXML",value:function(){var t=this,e="";if(this.ScheduleTable.length>0){for(var a=0;a<this.ScheduleTable.length;a++)a>0&&parseFloat(r.e.String(this.ScheduleTable[a-1]["Net Value"]))<0&&parseFloat(r.e.String(this.ScheduleTable[a]["Net Value"]))<0&&(this.ScheduleTable.RemoveAt(a),a--);var s=0;e+="<XML> ",this.ScheduleTable.forEach((function(a){e+="<Row ",null!=a.ScheduleID&&(e+=' ScheduleID="'+a.ScheduleID.toString()+'"'),e+=' period="'+a.Period.toString()+'"',e+=' From="'+new Date(a.From).ToString("dd/MMM/yyyy")+'"',e+=' To="'+new Date(a.To).ToString("dd/MMM/yyyy")+'"',parseFloat(a["Depr Amt"])<0?e+=' DepAmt="0"':e+=' DepAmt="'+a["Depr Amt"].toString()+'"',parseFloat(a["Net Value"])<0&&(a["Net Value"]=0,s>0&&(a["Accm Depr"]=(parseFloat(t.ScheduleTable[s-1]["Accm Depr"])+parseFloat(t.ScheduleTable[s-1]["Net Value"])).ToString(t.strDecimals))),e+=' NetValue="'+a["Net Value"].toString()+'"',e+=' AccDep="'+a["Accm Depr"].toString()+'"',e+=' ActDepAmt="'+a.ActualDeprAmt.toString()+'"',e+=" />",s++})),e+=" </XML>"}return e.toString()}}],[{key:"CalculateEstimateLife",value:function(t,e){for(var a,s="",r=0,i=0,l=new Date(t.getFullYear(),t.getMonth(),t.getDate());l.AddYears(1)<=e;)r++,l=l.AddYears(1);for(;l.AddMonths(1)<=e;)i++,l=l.AddMonths(1);return a=e.Subtract(l).Days,s=r.toString(),(i>0||a>0)&&(s+="."+i,a>0&&(s+="."+a)),s}}]),t}()}}]);
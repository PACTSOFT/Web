function _classCallCheck(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,s){for(var t=0;t<s.length;t++){var i=s[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,s,t){return s&&_defineProperties(e.prototype,s),t&&_defineProperties(e,t),e}function _inherits(e,s){if("function"!=typeof s&&null!==s)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(s&&s.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),s&&_setPrototypeOf(e,s)}function _setPrototypeOf(e,s){return(_setPrototypeOf=Object.setPrototypeOf||function(e,s){return e.__proto__=s,e})(e,s)}function _createSuper(e){var s=_isNativeReflectConstruct();return function(){var t,i=_getPrototypeOf(e);if(s){var n=_getPrototypeOf(this).constructor;t=Reflect.construct(i,arguments,n)}else t=i.apply(this,arguments);return _possibleConstructorReturn(this,t)}}function _possibleConstructorReturn(e,s){return!s||"object"!=typeof s&&"function"!=typeof s?_assertThisInitialized(e):s}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[109],{"2Dtv":function(e,s,t){"use strict";t.r(s),t.d(s,"AssignFeatureViewModel",(function(){return d}));var i=t("Do2H"),n=t("Lp6j"),a=t("JIg3"),r=t("0/4Q"),o=t("ScVY"),h=t("EQd/"),l=t("DKUf"),m=t("CQvG"),u=t("m+Ff"),c=t("F+4J"),d=function(e){_inherits(t,e);var s=_createSuper(t);function t(){var e;return _classCallCheck(this,t),(e=s.call(this)).LabelVisibility=!1,e.DetailButtonVisibility=!0,e.TeamVisible=!0,e.AssignDate=new a.a(0),e.RolesItemsObj=new r.b,e.UsersItemsObj=new r.b,e.GroupsItemsObj=new r.b,e.TypeOfAssigning=new r.e(0),e.Teams=new r.e(0),e.AssignUser=new r.e(0),e.InviteComments=new h.c(0),e.SelectedNode=new r.b,e.objTeam=new c.a,e.dtUsers=[],e._CCNodeID=0,e._CCID=0,e._ActivityID=0,e.Ret=0,e.userexists=!1,e.AssignXML="",e.Roles="",e.Users="",e.Grps="",e}return _createClass(t,[{key:"AssignFeatureViewModel_1",value:function(e,s,t){this._CCNodeID=s,this.SelectedNode.Visible=!1,this._CCID=t,this.Parent=e,this.Parent instanceof u.RCalenderViewModel||this.Parent instanceof l.a?(this.InviteComments.Visible=!0,this.InviteComments.Label="Comments"):this.InviteComments.Visible=!1,this.onLoadScreen(e)}},{key:"AssignFeatureViewModel_2",value:function(e,s,t){this.SelectedNode.Items=s,this.SelectedNode.Visible=!0,this._CCID=t,this.Parent instanceof u.RCalenderViewModel?(this.InviteComments.Visible=!0,this.InviteComments.Label="Comments"):this.InviteComments.Visible=!1,this.Parent=e,this.onLoadScreen(e)}},{key:"onLoadScreen",value:function(e){this.Title=i.a.GetResource("CRMTeam_Assign"),this.TypeOfAssigning.SelectionChangedCommand.Subscribe(this,"OnTypeChange"),this.Teams.SelectionChangedCommand.Subscribe(this,"OnChange"),this.RolesItemsObj.CheckedChangedCommand.Subscribe(this,"OnCheckedChanged"),this.UsersItemsObj.CheckedChangedCommand.Subscribe(this,"OnCheckedChanged"),this.GroupsItemsObj.CheckedChangedCommand.Subscribe(this,"OnCheckedChanged"),this.TypeOfAssigning.Label="Type",this.OnLoad(),this.Teams.Label=i.a.GetResource("CRMTeam_Title"),this.AssignDate.Label=i.a.GetResource("CRMTeam_AssignDate"),this.AssignUser.Label=i.a.GetResource("CRMTeam_AssignTo"),this.AssignDate.Text=Date.Today().ToString(i.a.SessionManager.Preferences["Date Format"].toString()),this.RolesItems.Visible=!1,this.UsersItems.Visible=!1,this.GroupsItems.Visible=!1;try{if(this._CCNodeID>0&&(this.dset=this.objTeam.GetAssignedDetails(this._CCID,this._CCNodeID,0),null!=this.dset&&this.dset.Tables.length>0)){if(this.dset.Tables[0].length>0){this.TypeOfAssigning.Items.push(r.d.ComboBoxItems_2("Team","1"));for(var s=0;s<this.dset.Tables[0].length;s++)this.Teams.Items.push(r.d.ComboBoxItems_2(this.dset.Tables[0][s].TeamName.toString(),this.dset.Tables[0][s].TeamID.toString()))}this.dset.Tables.length>1&&(this.dtUsers=this.dset.Tables[1]),this.dset.Tables.length>3&&this.dset.Columns[3].Contains("Company")&&this.dset.Tables[3].length>0&&(this.CompanyName=n.e.String(this.dset.Tables[3][0][this.dset.Columns[3][0]])),this.LabelVisibility=!1;var t=0;if(this.dset.Tables.length>4&&this.dset.Columns[4].Contains("UserName")&&this.dset.Tables[4].length>0&&(t=this.dset.Tables[4].filter((function(e){return e.UserName!=i.a.SessionManager.UserName})).length),!(e instanceof m.b)&&this.dset.Tables.length>2&&this.dset.Columns[2].Contains("CCID")&&this.dset.Tables[2].length>0){var a=this.dset.Tables[2].filter((function(e){return e.UserID>1&&0==e.TeamNodeID}));if(a.length>0)for(var o=0;o<a.length;o++)for(var h=0;h<this.UsersItems.Items.length;h++)if(this.UsersItems.Items[h].Value==a[o].UserID.toString()){0==t&&(this.UsersItems.Items[h].Enable=!1),this.UsersItems.Items[h].IsChecked=!0,this.userexists||(this.userexists=!0);break}if((a=this.dset.Tables[2].filter((function(e){return 1==e.IsGroup}))).length>0)for(var l=0;l<a.length;l++)for(var u=0;u<this.GroupsItems.Items.length;u++)if(this.GroupsItems.Items[u].Value==a[l].TeamNodeID.toString()){this.GroupsItems.Items[u].IsChecked=!0,this.userexists||(this.userexists=!0);break}if((a=this.dset.Tables[2].filter((function(e){return 1==e.IsRole}))).length>0)for(var c=0;c<a.length;c++)for(var d=0;d<this.RolesItems.Items.length;d++)if(this.RolesItems.Items[d].Value==a[c].TeamNodeID.toString()){this.RolesItems.Items[d].IsChecked=!0,this.userexists||(this.userexists=!0);break}(a=this.dset.Tables[2].filter((function(e){return e.TeamNodeID>1&&1==e.IsTeam}))).length>0&&(this.Teams.SelectedValue=a[0].TeamNodeID.toString()),(a=this.dset.Tables[2].filter((function(e){return e.TeamNodeID>1&&e.UserID>0}))).length>0&&(this.Teams.SelectedValue=a[0].TeamNodeID.toString(),this.AssignUser.SelectedValue=a[0].UserID.toString())}}}catch(g){throw Logger.ErrorLog("AssignFeatureViewModel::error ",g),g}}},{key:"OnCheckedChanged",value:function(e){var s=e.item;if("0"==(s=e.item).Value){if(this.RolesItems.Items.Contains(s))for(var t=0;t<this.RolesItems.Items.length;t++)this.RolesItems.Items[t].IsChecked=s.IsChecked;if(this.UsersItems.Items.Contains(s))for(var i=0;i<this.UsersItems.Items.length;i++)this.UsersItems.Items[i].IsChecked=s.IsChecked;if(this.GroupsItems.Items.Contains(s))for(var n=0;n<this.GroupsItems.Items.length;n++)this.GroupsItems.Items[n].IsChecked=s.IsChecked}else s.IsChecked||(this.RolesItems.Items.Contains(s)&&(this.RolesItems[0].IsChecked=!1),this.UsersItems.Items.Contains(s)&&(this.UsersItems[0].IsChecked=!1),this.GroupsItems.Items.Contains(s)&&(this.GroupsItems[0].IsChecked=!1))}},{key:"OnLoad",value:function(){var e=i.a.common.GetWorkFlowScreenDetails(!0);if(null!=e){if(e.Tables.length>1){e.Tables[1].length>0&&this.TypeOfAssigning.Items.push(r.d.ComboBoxItems_2("Users","2")),this.UsersItems.Items.push(r.c.CheckedListBoxItem_3("All","0"));for(var s=0;s<e.Tables[1].length;s++)this.UsersItems.Items.push(r.c.CheckedListBoxItem_3(e.Tables[1][s].UserName.toString(),e.Tables[1][s].UserID.toString()))}if(e.Tables.length>0){e.Tables[0].length>0&&this.TypeOfAssigning.Items.push(r.d.ComboBoxItems_2("Roles","3")),this.RolesItems.Items.push(r.c.CheckedListBoxItem_3("All","0"));for(var t=0;t<e.Tables[0].length;t++)this.RolesItems.Items.push(r.c.CheckedListBoxItem_3(e.Tables[0][t].Name.toString(),e.Tables[0][t].RoleID.toString()))}if(e.Tables.length>2){e.Tables[2].length>0&&this.TypeOfAssigning.Items.push(r.d.ComboBoxItems_2("Group","4")),this.GroupsItems.Items.push(r.c.CheckedListBoxItem_3("All","0"));for(var n=0;n<e.Tables[2].length;n++)this.GroupsItems.Items.push(r.c.CheckedListBoxItem_3(e.Tables[2][n].GroupName.toString(),e.Tables[2][n].GroupID.toString()))}}}},{key:"OnSave",value:function(e){if("Cancel"==e.toString())i.a.page.HideDialog(),this.Parent instanceof m.b?this.Parent.Activities.AssignVisiblity=!1:this.Parent instanceof u.RCalenderViewModel?(this.Parent.Activities.IsPopup||(this.Parent.ActVisibility=!0),this.Parent.AssignVisiblity=!1):this.Parent instanceof l.a||"AddEditLeads"==this.Parent.ClassName?("AddEditLeads"==this.Parent.ClassName&&this.Parent.IsAssign&&(this.Parent.Status.SelectedValue="419"),i.a.page.HideDialog()):this.Parent.AssignVisiblity=!1;else if("Search_Roles"==e.toString());else if("Search_Users"==e.toString());else if("Search_Groups"==e.toString());else if("0"==this.TypeOfAssigning.SelectedValue||null==this.TypeOfAssigning.SelectedValue)this.DisplayMessage="Please select type to assign";else{if(this.userexists&&73==this._CCID&&!confirm("Open Activities will trasfer to Assigned users, Are you sure you want to continue?"))return;if(this.Users="",this.Roles="",this.Grps="",null!=this.Parent&&this.Parent instanceof m.b){var s=this.Parent.SelectedRow;if(null!=s){if(this.GetNodeNames(),!n.e.StringIsNullOrEmpty(this.DisplayMessage))return void(this.MessageVisibility=!0);s.UsersXML=this.Users,s.RolesXML=this.Roles,s.isEdited="1",s.GroupXML=this.Grps,s.TeamNodeID=parseInt(this.Teams.SelectedValue),"0"!=this.AssignUser.SelectedValue&&null!=this.AssignUser.SelectedValue?(s.UserID=parseInt(this.AssignUser.SelectedValue),s.isTeam="0"):(s.UserID="0",s.isTeam="1"),this.Parent.ActivityGridDataObj.updateRow(s),i.a.page.HideDialog()}return}if(this.objTeam.FetaureID=this._CCID,this.SelectedNode.Visible){var t="";this.SelectedNode.Items.filter((function(e){return e.IsChecked&&e.Value})).forEach((function(e){t+='<Row NodeID="'+e.toString()+'" ></Row>'})),t.length>0&&(t="<XML>"+t+"</XML>",this.objTeam.NodesXML=t.toString())}else this.objTeam.FeatureNodeID=this._CCNodeID;if(this.GetNodeNames(),!n.e.StringIsNullOrEmpty(this.DisplayMessage))return void(this.MessageVisibility=!0);if(this.objTeam.UsersXML=this.Users,this.objTeam.RolesXML=this.Roles,this.objTeam.GroupXML=this.Grps,this.objTeam.TeamNodeID=parseInt(this.Teams.SelectedValue),"0"!=this.AssignUser.SelectedValue&&null!=this.AssignUser.SelectedValue?(this.objTeam.UserID=parseInt(this.AssignUser.SelectedValue),this.objTeam.isTeam=0):(this.objTeam.UserID=0,this.objTeam.isTeam=1),this.Parent instanceof u.RCalenderViewModel||this.Parent instanceof l.a){this.objTeam.InviteComments=null!=this.InviteComments.Text?this.InviteComments.Text:"";var a=this.objTeam.SetInvite();this.Ret=a.RetValue,this.DisplayMessage=a.Message,this.Ret>0?(this.MessageVisibility=!0,this.Parent instanceof u.RCalenderViewModel&&(this.Parent.ActVisibility=!0,this.Parent.AssignVisiblity=!1),Logger.InfoLog("AssignFeatureViewModel :: Exiting OnSave set invite error ")):this.MessageVisibility=!0}else if(null!=this.Parent&&"PACT.VIEWMODEL.ViewEventsViewModel"==this.Parent.toString()){var r=this.Parent.ActivityData.Rows.indexOf(this.Parent.SelectedRow.Row),o=this.Parent.ActivityGridData.filter(this.Parent.FilterStatus)[r];o.UsersXML=this.Users,o.RolesXML=this.Roles,o.GroupXML=this.Grps,this.Parent.ActivityGridData.AcceptChanges(),this.objTeam.FetaureID=128,this.objTeam.ActivityID=this._ActivityID;var h=this.objTeam.ActivityAssign();this.Ret=h.RetValue,this.DisplayMessage=h.Message}else if(this.SelectedNode.Visible){var c=this.objTeam.AssignMultipleFeature();this.Ret=c.RetValue,this.DisplayMessage=c.Message}else{if(0==this._CCNodeID){var d="";return d+="<XML>",d+="<Row TeamNodeID='"+this.objTeam.TeamNodeID+"'",d+=" UserID='"+this.objTeam.UserID+"'",d+=" isTeam='"+this.objTeam.isTeam+"'",d+=" RolesXML='"+this.objTeam.RolesXML+"'",d+=" UsersXML='"+this.objTeam.UsersXML+"'",d+=" GroupXML='"+this.objTeam.GroupXML+"' />",d+="</XML>",this.AssignXML=d.toString(),this.MessageVisibility=!0,void(this.DisplayMessage=i.a.GetResource("CRMTeam_Save"))}if(this.dset.Tables.length>2&&0==this.dset.Tables[2].length&&""==this.objTeam.RolesXML&&""==this.objTeam.UsersXML&&""==this.objTeam.GroupXML&&0==this.objTeam.TeamNodeID)this.DisplayMessage="There was No Selection";else{var g=this.objTeam.FeatureAssign();this.Ret=g.RetValue,this.DisplayMessage=g.Message}}this.Ret>0?(this.DisplayMessage=this.dset.Tables.length>2&&this.dset.Columns[2].Contains("CCID")&&this.dset.Tables[2].length>0&&""==this.objTeam.RolesXML&&""==this.objTeam.UsersXML&&""==this.objTeam.GroupXML&&0==this.objTeam.TeamNodeID?i.a.GetResource("CRMTeam_UnAssigned"):i.a.GetResource("CRMTeam_Save"),null!=this.Parent&&"AddEditLeads"==this.Parent.ClassName&&(this.Parent.IsAssign=!0)):this.Ret<0&&(this.DisplayMessage=i.a.GetResource("CRMTeam_Error")),this.MessageVisibility=!0,this.LabelVisibility=!1}}},{key:"GetNodeNames",value:function(){this.DisplayMessage="",this.Roles="",this.Users="",this.Grps="";for(var e=0;e<this.RolesItems.Items.length;e++)this.RolesItems.Items[e].IsChecked&&"0"!=this.RolesItems.Items[e].Value&&(this.Roles+=this.RolesItems.Items[e].Value+",");this.Roles=this.Roles.Trim(",");for(var s=0;s<this.UsersItems.Items.length;s++)this.UsersItems.Items[s].IsChecked&&"0"!=this.UsersItems.Items[s].Value&&(this.Users+=this.UsersItems.Items[s].Value+",");this.Users=this.Users.Trim(",");for(var t=0;t<this.GroupsItems.Items.length;t++)this.GroupsItems.Items[t].IsChecked&&"0"!=this.GroupsItems.Items[t].Value&&(this.Grps+=this.GroupsItems.Items[t].Value+",");this.Grps=this.Grps.Trim(",");var n=i.a.SessionManager.GetActionDays(this._CCID,"Assign");if(n>0){if(this.Roles.split(",").length>n)return void(this.DisplayMessage=i.a.GetResource("Only ("+n+") Role(s) can be Assigned"));if(this.Users.split(",").length>n)return void(this.DisplayMessage=i.a.GetResource("Only ("+n+") User(s) can be Assigned"));if(this.Grps.split(",").length>n)return void(this.DisplayMessage=i.a.GetResource("Only ("+n+") Group(s) can be Assigned"));if(this.Roles.split(",").length+this.Users.split(",").length+this.Grps.split(",").length<n)return void(this.DisplayMessage=i.a.GetResource("Assign atleast ("+n+") Role/User/Group"))}}},{key:"OnTypeChange",value:function(e){"0"!=this.TypeOfAssigning.SelectedValue&&null!=this.TypeOfAssigning.SelectedValue&&(this.TeamVisible=!1,this.RolesItems.Visible=!1,this.UsersItems.Visible=!1,this.GroupsItems.Visible=!1,"1"==this.TypeOfAssigning.SelectedValue?this.TeamVisible=!0:"2"==this.TypeOfAssigning.SelectedValue?this.UsersItems.Visible=!0:"3"==this.TypeOfAssigning.SelectedValue?this.RolesItems.Visible=!0:"4"==this.TypeOfAssigning.SelectedValue&&(this.GroupsItems.Visible=!0))}},{key:"OnChange",value:function(e){"0"!=this.Teams.SelectedValue&&null!=this.Teams.SelectedValue&&(this.AssignUser.Items.Clear(),this.LoadUsers())}},{key:"LoadUsers",value:function(){var e=this,s=this.dtUsers.filter((function(s){return s.TeamID==e.Teams.SelectedValue}));if(s.length>0){this.AssignUser.Items.Clear();for(var t=0;t<s.length;t++)this.AssignUser.Items.push(r.d.ComboBoxItems_2(s[t].UserName.toString(),s[t].UserID.toString()))}}},{key:"RolesItems",get:function(){return this.RolesItemsObj}},{key:"UsersItems",get:function(){return this.UsersItemsObj}},{key:"GroupsItems",get:function(){return this.GroupsItemsObj}}]),t}(o.b)}}]);
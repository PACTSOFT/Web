function _toArray(t){return _arrayWithHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,i=new Array(e);a<e;a++)i[a]=t[a];return i}function _iterableToArray(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,a){return e&&_defineProperties(t.prototype,e),a&&_defineProperties(t,a),t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _createSuper(t){var e=_isNativeReflectConstruct();return function(){var a,i=_getPrototypeOf(t);if(e){var s=_getPrototypeOf(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return _possibleConstructorReturn(this,a)}}function _possibleConstructorReturn(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{Rr92:function(t,e,a){"use strict";a.r(e),a.d(e,"UpdatePayTermsViewModel",(function(){return S}));var i=a("Do2H"),s=a("Lp6j"),r=a("eQJW"),o=a("ScVY"),n=a("n56n"),l=a("0/4Q"),u=a("JIg3"),D=a("EQd/"),c=a("8B8H"),h=a("P6ee"),d=a("ockk"),m=a("lUlH"),p=a("CUWK"),b=a("4HhE"),S=function(t){_inherits(a,t);var e=_createSuper(a);function a(t){var i;return _classCallCheck(this,a),(i=e.call(this)).SavePostedDocument=new b.b,i._SelectAll=!1,i.Filter=new l.e,i.CopyRows=new D.d,i.IsCancelVisible=!1,i.Rows=[],i.Calltype=0,i.DocCCID=0,i.CCID=0,i.CompletionDateColName="",i.Columns="",i.Joins="","AddEditRenContractViewModel"==t?_possibleConstructorReturn(i,(i.IsCancelVisible=!1,void(i.Filter.Visible=!1))):(i.IsCancelVisible=!1,i.Filter.Visible=!1,i.DisplayName=t,i.PstDocGrid=new c.a,i.PartGrid=new c.a,i.onLoad(),i.FillSearchDetails(),_possibleConstructorReturn(i))}return _createClass(a,[{key:"UpdatePayTermsViewModel_1",value:function(t,e,a){var i=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.DisplayName=2==s?"Contract History":1==s?"Copy":3==s?"Renew Sub Contracts":4==s?"Terminate Sub Contracts":5==s?"Refund Sub Contracts":6==s?"Close Sub Contracts":null!=e?"Distribute":"Generate Contract",this.Calltype=s,this.oparent=t,this.selectedrow=e,this.Rows=a,this.CopyRows.Visible=!1,2==s||3==s||4==s||5==s||6==s?(this.Filter.Visible=!1,this.PstDocGrid=new c.a,this.PartGrid=new c.a,this.EndDate=new u.b(0),this.Tower=new n.b(0),this.CompletionDate=new u.b(0),this.EndDate.Visible=!1,this.PartGrid.Visible=!1,this.PstDocGrid.Visible=!0,this.Tower.Visible=!1,this.CompletionDate.Visible=!1,this.CopyRows.Label="Copy",this.CopyRows.Visible=!1,this.CopyRows.DataType="INT",this.IsGenerateVisible=!1):1==s?(this.Filter.Visible=!1,this.PstDocGrid=new c.a,this.PartGrid=new c.a,this.EndDate=new u.b(0),this.Tower=new n.b(0),this.CompletionDate=new u.b(0),this.EndDate.Visible=!1,this.PstDocGrid.Visible=!1,this.PartGrid.Visible=!1,this.Tower.Visible=!1,this.CompletionDate.Visible=!1,this.CopyRows.Label="Copy",this.CopyRows.Visible=!0,this.CopyRows.DataType="INT"):null==this.selectedrow?(this.Filter.Visible=!0,this.Filter.Label="Contract for Year",this.Filter.Items.push(l.d.ComboBoxItems_2("ALL","ALL")),this.Rows.forEach((function(t){i.Filter.Items.push(t)})),this.Filter.Width="320",this.Filter.Items.length>0&&(this.Filter.SelectedValue=this.Filter.Items[0].Value,this.Filter.SelectedItem=this.Filter.Items[0])):this.oparent.multiVisi?(this.Filter.Visible=!0,this.Filter.Width="120",this.Filter.Label="Show",this.Filter.Items.push(l.d.ComboBoxItems_2("Both","0")),this.Filter.Items.push(l.d.ComboBoxItems_2("Show only unit","1")),this.Filter.Items.push(l.d.ComboBoxItems_2("Show only Dates","2")),this.Filter.SelectionChangedCommand.Subscribe(this,"ButtonSave"),this.Filter.SelectedValue="0"):this.Filter.Visible=!1,1!=s&&2!=s&&3!=s&&4!=s&&5!=s&&6!=s&&this.AddDateColumns(),this.IsCancelVisible=!0,this.PstDocGridTable.length>0&&(this.PstDocGrid.Height=252,this.PstDocGrid.Width="800"),this.PartGridTable.length>0&&(this.PartGrid.Height=252)}},{key:"onLoad",value:function(){this.InitColumns(),this.SavePostedDocument.Subscribe(this,"ButtonSave")}},{key:"AddDateColumns",value:function(){var t,e=this;if(this.Tower=new n.b(0),this.CompletionDate=new u.b(0),this.CompletionDate.Label="Start date",this.CompletionDate.Enable=!1,this.oparent.StartDate.Date&&(this.CompletionDate.Date=this.oparent.StartDate.Date),this.EndDate=new u.b(0),this.oparent.EndDate.Date&&(this.EndDate.Date=this.oparent.EndDate.Date),this.EndDate.Label="End Date",this.EndDate.Enable=!1,this.Tower.Visible=!1,this.PartGrid=new c.a,this.PartGrid.Visible=!0,this.PstDocGrid=new c.a,this.PstDocGrid.CanUserSortColumns=!1,this.PstDocGrid.CanUserDeleteRows=!0,this.PstDocGrid.RowHeight=25,this.PstDocGrid.Columns=[],this.PstDocGrid.Width="",this.PstDocGrid.CanUserAddRows=!0,this.PstDocGrid.CellEditEnding.Subscribe(this,"OnGridCellEditEnding"),this.PstDocGrid.OnRowSelection.Subscribe(this,"OnRowSelection"),this.PstDocGridTableColumns.push("Sno"),this.PstDocGridTableColumns.push("FromDate"),this.PstDocGridTableColumns.push("FromDate_Key"),this.PstDocGrid.DataTypes.Date.push("FromDate_Key"),this.PstDocGridTableColumns.push("ToDate"),this.PstDocGridTableColumns.push("ToDate_Key"),this.PstDocGrid.DataTypes.Date.push("ToDate_Key"),this.PstDocGridTableColumns.push("Amount"),this.PstDocGrid.DataTypes.Double.push("Amount"),this.PstDocGridTableColumns.push("Unit"),this.PstDocGridTableColumns.push("Unit_key"),this.PstDocGrid.DataTypes.Int.push("Unit_key"),this.PstDocGridTableColumns.push("Period"),this.PstDocGridTableColumns.push("Rate"),this.PstDocGrid.DataTypes.Double.push("Rate"),this.PstDocGridTableColumns.push("Discount"),this.PstDocGrid.DataTypes.Double.push("Discount"),this.PstDocGridTableColumns.push("ActAmount"),this.PstDocGrid.DataTypes.Double.push("ActAmount"),this.PstDocGridTableColumns.push("Narration"),this.PstDocGridTableColumns.push("Percent"),this.PstDocGrid.DataTypes.Double.push("Percent"),this.oparent.DistribtueInvoice&&null!=this.selectedrow&&this.oparent.DataTable.length>0&&this.selectedrow==this.oparent.DataTable[0]&&(this.PstDocGridTableColumns.push("Distribute"),this.PstDocGrid.DataTypes.Int.push("Distribute")),this.oparent.ShowMonthAmountInDistribute&&null!=this.selectedrow&&this.oparent.DataTable.length>0&&this.selectedrow==this.oparent.DataTable[0]&&(this.PstDocGridTableColumns.push("MonthAmount"),this.PstDocGrid.DataTypes.Double.push("MonthAmount")),null!=this.selectedrow?((t=new d.a).Header=i.a.GetResource("DocumentDesigner_Sno"),t.DisplayMember="Sno",t.ReadOnly=!0,t.Width=50,this.PstDocGrid.Columns.push(t)):(this.CompletionDate.Visible=!1,this.EndDate.Visible=!1,this.PstDocGrid.Visible=!1,this.PstDocGrid.Visible=!1,this.IsGenerateVisible=!0),(t=new d.a).Header="From Date",t.DisplayMember="FromDate",t.Width=100,t.DataType="DATE",this.PstDocGrid.Columns.push(t),(t=new d.a).Header="To Date",t.DisplayMember="ToDate",t.Width=100,t.DataType="DATE",this.PstDocGrid.Columns.push(t),null!=this.selectedrow){(t=new d.a).Header="Unit",t.DisplayMember="Unit",t.ValueMember="Unit_key",t.Width=100,t.DataType="LISTBOX",t.CostCenterID=this.oparent.Unit.CCID,t.TypeID=this.oparent.Unit.TypeID,this.oparent.multiVisi?(t.IsVisible=!0,t.FilterCondition=" a.unitid in("+this.oparent.SelectedUnits+")"):t.IsVisible=!1,this.PstDocGrid.Columns.push(t),this.PstDocGridTableColumns.Contains("MonthAmount")&&((t=new d.a).Header="Month Wise",t.DisplayMember="MonthAmount",t.Width=100,t.DataType="FLOAT",t.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinAmount.toString(),this.PstDocGrid.Columns.push(t));var a=this.oparent.ContractParticular.find((function(t){return"Discount"==t.DisplayMember}));null!=a&&a.IsVisible&&((t=new d.a).Header="Amount",t.DisplayMember="ActAmount",t.Width=100,t.DataType="FLOAT",t.IsCalculated=1,t.ShowTotal=!0,t.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinAmount.toString(),this.PstDocGrid.Columns.push(t),(t=new d.a).Header="Discount",t.DisplayMember="Discount",t.Width=100,t.DataType="FLOAT",t.IsCalculated=1,t.ShowTotal=!0,t.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinAmount.toString(),this.PstDocGrid.Columns.push(t)),(t=new d.a).Header=null!=a&&a.IsVisible?"After discount":"Amount",t.DisplayMember="Amount",t.Width=100,t.DataType="FLOAT",t.IsCalculated=1,t.ShowTotal=!0,t.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinAmount.toString(),this.PstDocGrid.Columns.push(t),(t=new d.a).Header="%",t.DisplayMember="Percent",t.Width=100,t.DataType="FLOAT",t.DecimalPoints="0",this.PstDocGrid.Columns.push(t),this.PstDocGridTableColumns.Contains("Distribute")&&((t=new d.a).Header="Distribute",t.DisplayMember="Distribute",t.Width=100,t.DataType="FLOAT",t.DecimalPoints="0",this.PstDocGrid.Columns.push(t)),(t=new d.a).Header="Rate",t.DisplayMember="Rate",t.Width=80,t.DataType="FLOAT",t.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinAmount.toString();var o=this.oparent.ScreenObject.Data.Tables[5].filter((function(t){return"ShowRateInDistribute"==t.Name}));t.IsVisible=!!(o.length>0&&Object(r.j)(o[0].Value)),this.PstDocGrid.Columns.push(t)}(t=new d.a).Header="Period",t.ValueBinding="Period",t.DataType="ComboBox",t.DisplayMember="Name",t.ValueMember="Value",t.Width=100;var D=m.a.GetLookupData(31);if(null!=D){for(var h=[],p=0;p<D.length;p++)h.push(l.d.ComboBoxItems_2(D[p].Name.toString(),D[p].NodeID.toString()));t.ComboData=h}if(this.PstDocGrid.Columns.push(t),(t=new d.a).Header="Narration",t.DisplayMember="Narration",t.DataType="TextBlock",t.Width=150,this.PstDocGrid.Columns.push(t),null==this.selectedrow)this.Rows.forEach((function(t){var a=e.PstDocGrid.NewRow();!s.e.IsEmpty(t.Value)&&s.e.isValidDate(t.Value)&&(s.e.isValidDate(t.Value),a.FromDate=new Date(t.Value).ToString(i.a.SessionManager.Preferences["Date Format"]),a.FromDate_key=new Date(t.Value)),!s.e.IsEmpty(t.Parent)&&s.e.isValidDate(t.Parent)&&(s.e.isValidDate(t.Parent),a.ToDate=new Date(t.Parent).ToString(i.a.SessionManager.Preferences["Date Format"]),a.ToDate_key=new Date(t.Parent)),t.CurrID>0&&(a.Period=t.CurrID),e.PstDocGrid.addRow(a)}));else if(s.e.IsEmpty(this.selectedrow.Xml)){if(this.oparent.EndDate.Date&&this.oparent.StartDate.Date&&!s.e.IsEmpty(this.selectedrow.Amount))if(""!=this.oparent.SelectedUnits)!s.e.IsEmpty(this.oparent.dsPart)&&this.oparent.dsPart.Tables.length>5&&this.oparent.dsPart.Tables[5].length>0&&function(){var t=e.oparent.dsPart.Tables[5].Compute("sum","RENT"),a=e.oparent.SelectedUnits.split(",");if(e.oparent.EndDate.Date>e.oparent.StartDate.Date.AddYears(1)){var r;r=s.e.DoubleTryParse(e.oparent.TotalYears.Text);for(var o=function(o){var n=null;if(null!=e.oparent.dsPart&&e.oparent.dsPart.Tables[5].length>0&&(n=e.oparent.dsPart.Tables[5].filter((function(t){return t.UnitID==a[o]}))),null!=n&&n.length>0){var l=parseFloat(e.selectedrow.Amount.toString())*parseFloat(n[0].RENT);null!=t&&parseFloat(t)>0&&(l/=parseFloat(t));for(var u=l/r,D=0;D<r;D++){var c=e.PstDocGrid.NewRow();c.FromDate=e.oparent.StartDate.Date.AddYears(D).ToString(i.a.SessionManager.Preferences["Date Format"]),c.FromDate_key=e.oparent.StartDate.Date.AddYears(D),D==r-1?(c.ToDate=e.oparent.EndDate.Date.ToString(i.a.SessionManager.Preferences["Date Format"]),c.ToDate_key=e.oparent.EndDate.Date):(c.ToDate=e.oparent.StartDate.Date.AddYears(D+1).AddDays(-1).ToString(i.a.SessionManager.Preferences["Date Format"]),c.ToDate_key=e.oparent.StartDate.Date.AddYears(D+1).AddDays(-1)),c.Unit_key=n[0].UnitID.toString(),s.e.IsEmpty(n[0].RENT)||(c.Amount=u.ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()),c.Rate=(parseFloat(c.Amount)/parseFloat(n[0].RentableArea.toString())).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString())),c.Discount=0,c.ActAmount=c.Amount.toString(),c.Sno=e.PstDocGrid.Table.length+1,e.PstDocGrid.addRow(c)}}},n=0;n<a.length;n++)o(n)}else{e.Filter.SelectedValue="1",e.PstDocGrid.Clear();var l=parseFloat(e.selectedrow.Amount.toString());if(l.ToString("N2")==parseFloat(t).ToString("N2"))for(var u=function(t){var r=e.PstDocGrid.NewRow();r.FromDate=e.oparent.StartDate.Date.ToString(i.a.SessionManager.Preferences["Date Format"]),r.FromDate_key=e.oparent.StartDate.Date,r.ToDate=e.oparent.StartDate.Date.ToString(i.a.SessionManager.Preferences["Date Format"]),r.ToDate_key=e.oparent.StartDate.Date;var o=null;null!=e.oparent.dsPart&&e.oparent.dsPart.Tables[5].length>0&&(o=e.oparent.dsPart.Tables[5].filter((function(e){return e.UnitID==a[t]}))),null!=o&&o.length>0&&(r.Unit_key=o[0].UnitID.toString(),s.e.IsEmpty(o[0].RENT)||(r.Amount=parseFloat(o[0].RENT).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()),r.Rate=(parseFloat(r.Amount)/parseFloat(o[0].RentableArea.toString())).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString())),r.Discount=0,r.ActAmount=r.Amount.toString()),r.Sno=e.PstDocGrid.Table.length+1,e.PstDocGrid.addRow(r)},D=0;D<a.length;D++)u(D);else for(var c=function(r){var o=e.PstDocGrid.NewRow();o.FromDate=e.oparent.StartDate.Date.ToString(i.a.SessionManager.Preferences["Date Format"]),o.FromDate_key=e.oparent.StartDate.Date,o.ToDate=e.oparent.StartDate.Date.ToString(i.a.SessionManager.Preferences["Date Format"]),o.ToDate_key=e.oparent.StartDate.Date;var n=null;null!=e.oparent.dsPart&&e.oparent.dsPart.Tables[5].length>0&&(n=e.oparent.dsPart.Tables[5].filter((function(t){return t.UnitID==a[r]}))),null!=n&&n.length>0&&(o.Unit_key=n[0].UnitID.toString(),s.e.IsEmpty(n[0].RENT)||(o.Amount=null!=t?(l*parseFloat(n[0].RENT)/parseFloat(t)).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()):(l*parseFloat(n[0].RENT)).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()),o.Rate=(parseFloat(o.Amount)/parseFloat(n[0].RentableArea.toString())).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString())),o.Discount=0,o.ActAmount=o.Amount.toString()),o.Sno=e.PstDocGrid.Table.length+1,e.PstDocGrid.addRow(o)},h=0;h<a.length;h++)c(h)}e.PstDocGrid.Columns[3].IsVisible&&!e.PstDocGrid.RefreshGrid&&(e.PstDocGrid.RefreshGrid=!0)}();else if(this.oparent.EndDate.Date>this.oparent.StartDate.Date.AddYears(1)){var b;b=s.e.DoubleTryParse(this.oparent.TotalYears.Text);var S,P=parseFloat(this.selectedrow.Amount.toString())/b;s.e.DoubleTryParse(this.selectedrow.Discount.toString())?(S=s.e.DoubleTryParse(this.selectedrow.Discount.toString()),S/=b):S=0;for(var T=0,g=0,y=0;y<b;y++){var C=this.PstDocGrid.NewRow();C.FromDate=this.oparent.StartDate.Date.AddYears(y).ToString(i.a.SessionManager.Preferences["Date Format"]),C.FromDate_key=this.oparent.StartDate.Date.AddYears(y),y==b-1?(C.ToDate=this.oparent.EndDate.Date.ToString(i.a.SessionManager.Preferences["Date Format"]),C.ToDate_key=this.oparent.EndDate.Date,C.Amount=(parseFloat(this.selectedrow.Amount.toString())-T).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()),S>0?(C.Discount=(parseFloat(this.selectedrow.Discount.toString())-g).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()),C.ActAmount=(parseFloat(C.Amount.toString())+parseFloat(C.Discount.toString())).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString())):(C.Discount=0,C.ActAmount=C.Amount.toString()),null!=this.oparent.dsPart&&this.oparent.dsPart.Tables.length>0&&this.oparent.dsPart.Tables[5].length>0&&(C.Rate=(parseFloat(C.Amount)/parseFloat(this.oparent.dsPart.Tables[5][0].RentableArea.toString())).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()))):(C.ToDate=this.oparent.StartDate.Date.AddYears(y+1).AddDays(-1).ToString(i.a.SessionManager.Preferences["Date Format"]),C.ToDate_key=this.oparent.StartDate.Date.AddYears(y+1).AddDays(-1),C.Amount=P.ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()),S>0?(C.Discount=S.ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()),C.ActAmount=(P+S).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()),g+=parseFloat(C.Discount)):(C.Discount=0,C.ActAmount=C.Amount.toString()),null!=this.oparent.dsPart&&this.oparent.dsPart.Tables.length>0&&this.oparent.dsPart.Tables[5].length>0&&(C.Rate=(parseFloat(C.Amount)/parseFloat(this.oparent.dsPart.Tables[5][0].RentableArea.toString())).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()))),T+=parseFloat(C.Amount.toString()),C.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(C)}}}else{var f=new s.f;if(f.LoadXml(this.selectedrow.Xml.toString()),null!=f){f.DocumentElement.children.length>0&&null!=f.DocumentElement.children[0].attributes&&null!=f.DocumentElement.children[0].attributes.Filter&&!s.e.IsEmpty(f.DocumentElement.children[0].attributes.Filter.value)&&(this.Filter.SelectedValue=f.DocumentElement.children[0].attributes.Filter.value),this.PstDocGrid.Clear();var G=f.SelectNodes("XML/Row");"0"==this.Filter.SelectedValue&&(G=f.SelectNodes("XML/UnitsRow/Row"));for(var A=0;A<G.length;A++){var w=G[A],I=this.PstDocGrid.NewRow();null!=w.attributes.FromDate&&!s.e.IsEmpty(w.attributes.FromDate.value)&&s.e.isValidDate(w.attributes.FromDate.value)&&(s.e.isValidDate(w.attributes.FromDate.value),I.FromDate=new Date(w.attributes.FromDate.value).ToString(i.a.SessionManager.Preferences["Date Format"]),I.FromDate_key=new Date(w.attributes.FromDate.value)),null!=w.attributes.ToDate&&!s.e.IsEmpty(w.attributes.ToDate.value)&&s.e.isValidDate(w.attributes.ToDate.value)&&(s.e.isValidDate(w.attributes.ToDate.value),I.ToDate=new Date(w.attributes.ToDate.value).ToString(i.a.SessionManager.Preferences["Date Format"]),I.ToDate_key=new Date(w.attributes.ToDate.value)),null==w.attributes.Unit||s.e.IsEmpty(w.attributes.Unit.value)||(I.Unit_key=parseInt(w.attributes.Unit.value)),null==w.attributes.Period||s.e.IsEmpty(w.attributes.Period.value)||(I.Period=parseInt(w.attributes.Period.value)),null==w.attributes.Amount||s.e.IsEmpty(w.attributes.Amount.value)||(I.Amount=parseFloat(w.attributes.Amount.value)),null==w.attributes.MonthAmount||s.e.IsEmpty(w.attributes.MonthAmount.value)||(I.MonthAmount=parseFloat(w.attributes.MonthAmount.value)),null==w.attributes.Rate||s.e.IsEmpty(w.attributes.Rate.value)||(I.Rate=parseFloat(w.attributes.Rate.value)),this.PstDocGridTableColumns.Contains("Distribute")&&null!=w.attributes.Distribute&&!s.e.IsEmpty(w.attributes.Distribute.value)&&(I.Distribute=parseFloat(w.attributes.Distribute.value)),this.PstDocGridTableColumns.Contains("ActAmount")&&null!=w.attributes.ActAmount&&!s.e.IsEmpty(w.attributes.ActAmount.value)&&(I.ActAmount=parseFloat(w.attributes.ActAmount.value)),this.PstDocGridTableColumns.Contains("Percent")&&null!=w.attributes.Percent&&!s.e.IsEmpty(w.attributes.Percent.value)&&(I.Percent=parseFloat(w.attributes.Percent.value)),this.PstDocGridTableColumns.Contains("Discount")&&null!=w.attributes.Discount&&!s.e.IsEmpty(w.attributes.Discount.value)&&(I.Discount=parseFloat(w.attributes.Discount.value)),null==w.attributes.Narration||s.e.IsEmpty(w.attributes.Narration.value)||(I.Narration=w.attributes.Narration.value),I.Sno=this.PstDocGridTable.length+1,this.PstDocGrid.addRow(I)}}null!=this.oparent.dsPart&&this.oparent.dsPart.Tables.length>5&&this.oparent.dsPart.Tables[5].length>0||!this.PstDocGrid.Columns[3].IsVisible||(this.PstDocGrid.RefreshGrid=!0)}null!=this.selectedrow&&this.OnGridCellEditEnding(null,"Amount",0);for(var F=0;F<5;F++){var v=this.PstDocGrid.NewRow();this.PstDocGridTableColumns.Contains("select")?v.select=!1:v.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(v)}if(null!=this.selectedrow){this.PartGrid.CanUserSortColumns=!1,this.PartGrid.CanUserDeleteRows=!0,this.PartGrid.RowHeight=25,this.PartGrid.Columns=[],this.PartGrid.Width="",this.PartGrid.CanUserAddRows=!1,this.PartGridTableableColumns.push("Sno"),this.PartGridTableableColumns.push("Part"),this.PartGridTableableColumns.push("Part_Key"),this.PstDocGrid.DataTypes.Int.push("Part_Key"),this.PartGridTableableColumns.push("Amount"),this.PstDocGrid.DataTypes.Double.push("Amount"),(t=new d.a).Header="Particulars",t.DisplayMember="Part",t.Width=100,t.ReadOnly=!0,this.PartGrid.Columns.push(t),(t=new d.a).Header="Amount",t.DisplayMember="Amount",t.Width=100,t.DataType="FLOAT",t.ReadOnly=!0,t.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinAmount.toString(),this.PartGrid.Columns.push(t);for(var M=function(t){if(!s.e.IsEmpty(e.oparent.DataTable[t].NodeID)){var a=e.PartGrid.NewRow();if(a.Part_Key=e.oparent.DataTable[t].NodeID.toString(),s.e.IsEmpty(e.oparent.DataTable[t].Particulars)){if(null!=(R=e.oparent.ContractParticular.find((function(t){return!s.e.StringIsNullOrEmpty(t.ValueBinding)&&"NodeID"==t.ValueBinding})))&&null!=R){var i=e.oparent.ContractParticular[1].ComboData.filter((function(a){return a.NodeID==e.oparent.DataTable[t].NodeID.toString()}));i.length>0&&(a.Part=i[0].Particulars.toString())}}else a.Part=e.oparent.DataTable[t].Particulars.toString();e.PartGrid.addRow(a)}},E=0;E<this.oparent.DataTable.length;E++){var R;M(E)}}}},{key:"OnRowSelection",value:function(t){return null!=t&&this.PopulateParticulars(t),!0}},{key:"PopulateParticulars",value:function(t){var e,a,i=this,r=null,o=null;s.e.IsEmpty(t.ToDate_Key)||(o=new Date(t.ToDate_Key.toString())),s.e.IsEmpty(t.FromDate_Key)||(r=new Date(t.FromDate_Key.toString()));for(var n=function(t){if(!s.e.IsEmpty(i.oparent.DataTable[t].NodeID)){var n=i.PartGrid.Table.filter((function(e){return e.Part_Key==i.oparent.DataTable[t].NodeID.toString()}));if(n.length>0){var l=0;if(i.oparent.DataTable[t]==i.selectedrow)for(var u=0;u<i.PstDocGrid.Table.length;u++)s.e.IsEmpty(i.PstDocGrid.Table[u].Amount)||s.e.IsEmpty(i.PstDocGrid.Table[u].FromDate_Key)||(new Date(i.PstDocGrid.Table[u].FromDate_Key.toString()),l+=parseFloat(i.PstDocGrid.Table[u].Amount.toString()));else if(s.e.IsEmpty(i.oparent.DataTable[t].Xml))s.e.IsEmpty(r)||r.Date!=i.oparent.StartDate.Date||s.e.IsEmpty(i.oparent.DataTable[t].Amount)||(l+=parseFloat(i.oparent.DataTable[t].Amount.toString()));else{var D=new s.f;D.LoadXml(i.oparent.DataTable[t].Xml.toString());var c=-1;if(D.DocumentElement.children.length>0&&null!=D.DocumentElement.children[0].attributes&&null!=D.DocumentElement.children[0].attributes.Filter&&!s.e.IsEmpty(D.DocumentElement.children[0].attributes.Filter.value)&&(c=parseInt(D.DocumentElement.children[0].attributes.Filter.value)),2==c||-1==c)D.DocumentElement.children[0].childNodes.forEach((function(t){e=s.e.isValidDate(t.FromDate.value),a=s.e.isValidDate(t.ToDate.value),s.e.IsEmpty(r)||null==e||r.Date!=e.Date||s.e.IsEmpty(t.Amount.value)||s.e.IsEmpty(o)||null==a||o.Date!=a.Date||(l+=parseFloat(t.Amount.value))}));else if(0==c)for(var h=D.SelectNodes("XML/UnitsRow/Row"),d=0;d<h.length;d++){var m=h[d];e=s.e.isValidDate(m.attributes.FromDate.value),a=s.e.isValidDate(m.attributes.ToDate.value),s.e.IsEmpty(r)||null==e||r.Date!=e.Date||s.e.IsEmpty(m.attributes.Amount.value)||s.e.IsEmpty(o)||null==a||o.Date!=a.Date||(l+=parseFloat(m.attributes.Amount.value))}}n[0].Amount=l,i.PartGrid.updateRow(n[0])}}},l=0;l<this.oparent.DataTable.length;l++)n(l)}},{key:"OnGridCellEditEnding",value:function(t,e,a){if(s.e.IsEmpty(t)||(e=t.column.field,t=t.item),"Percent"==e&&!s.e.IsEmpty(t.Percent)&&parseFloat(t.Percent.toString())>0&&this.PstDocGrid.SelectedIndex>0&&!s.e.IsEmpty(this.PstDocGrid.Table[this.PstDocGrid.SelectedIndex-1].Amount)){var r=parseFloat(this.PstDocGrid.Table[this.PstDocGrid.SelectedIndex-1].Amount.toString());t.Amount=(r+parseFloat(t.Percent)*r/100).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()),e="Amount"}if("MonthAmount"!=e||null==t||s.e.IsEmpty(t.MonthAmount)||s.e.IsEmpty(t.ToDate_Key)||s.e.IsEmpty(t.FromDate_Key)||(t.Amount=parseFloat(t.MonthAmount.toString())*this.oparent.CalculateMonthsbetweenDates(new Date(t.FromDate_Key.toString()),new Date(t.ToDate_Key.toString())),e="Amount"),("Amount"==e||"ActAmount"==e||"Discount"==e||"Rate"==e)&&this.PstDocGrid.Columns.length>4){if("Rate"==e&&null!=t)if(null==this.oparent.dsPart&&this.oparent.validateUnit(!1),s.e.IsEmpty(t.Unit_key))this.oparent.dsPart.Tables[5].length>0&&(t.Amount=(parseFloat(t.Rate)*parseFloat(this.oparent.dsPart.Tables[5].Compute("sum","RentableArea").toString())).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()));else{var o=this.oparent.dsPart.Tables[5].filter((function(e){return e.UnitID==t.Unit_key.toString()}));o.length>0&&(t.Amount=(parseFloat(t.Rate)*parseFloat(o[0].RentableArea.toString())).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()))}var n,l,u;if(null!=t)n=s.e.DoubleTryParse(t.ActAmount),l=s.e.DoubleTryParse(t.Discount),u=s.e.DoubleTryParse(t.Amount),"Amount"!=e&&"Rate"!=e||(t.ActAmount=(u+l).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString())),"ActAmount"!=e&&"Discount"!=e||(0==n&&u>0?t.ActAmount=(u+l).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()):t.Amount=(n-l).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()));if(this.CalculateTotals(t),null!=t){if("Rate"!=e&&(null==this.oparent.dsPart&&this.oparent.validateUnit(!1),!s.e.IsEmpty(t.Amount)))if(s.e.IsEmpty(t.Unit_key))this.oparent.dsPart.Tables[5].length>0&&(t.Rate=(parseFloat(t.Amount)/parseFloat(this.oparent.dsPart.Tables[5].Compute("sum","RentableArea").toString())).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()));else{var D=this.oparent.dsPart.Tables[5].filter((function(e){return e.UnitID==t.Unit_key.toString()}));D.length>0&&(t.Rate=(parseFloat(t.Amount)/parseFloat(D[0].RentableArea.toString())).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()))}this.PstDocGrid.updateRow(t),this.PstDocGrid.UpdateTotals(),this.PopulateParticulars(t)}}}},{key:"CalculateTotals",value:function(t){var e=this.PstDocGrid.Table.Compute("sum","Amount");null!=e&&null!=e||(e=0);var a=this.PstDocGrid.Columns.find((function(t){return"Amount"==t.DisplayMember}));null!=a&&(a.footer=parseFloat(e).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString())),null!=(e=this.PstDocGrid.Table.Compute("sum","ActAmount"))&&null!=e||(e=0),null!=(a=this.PstDocGrid.Columns.find((function(t){return"ActAmount"==t.DisplayMember})))&&(a.footer=parseFloat(e).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString())),null!=(e=this.PstDocGrid.Table.Compute("sum","Discount"))&&null!=e||(e=0),null!=(a=this.PstDocGrid.Columns.find((function(t){return"Discount"==t.DisplayMember})))&&(a.footer=parseFloat(e).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString())),null!=t&&this.PstDocGrid.UpdateFooter()}},{key:"InitColumns",value:function(){var t,e=this;this.Tower=new n.b(0),this.CompletionDate=new u.b(0),this.CompletionDate.Label="New CompletionDate",this.EndDate=new u.b(0),this.EndDate.Visible=!1,this.PartGrid=new c.a,this.PartGrid.Visible=!1,this.PartGrid=new c.a,this.PartGrid.CanUserSortColumns=!0,this.PartGrid.Columns=[],this.PartGrid.Width="",this.PstDocGridTableColumns.push("Sno"),this.PstDocGridTableColumns.push("select"),this.PstDocGrid.DataTypes.Bool.push("select"),this.PstDocGridTableColumns.push("DocNumber"),this.PstDocGridTableColumns.push("DocPrefix"),this.PstDocGridTableColumns.push("DocID"),this.PstDocGridTableColumns.push("CostCenterID"),this.PstDocGridTableColumns.push("VNO"),(t=new d.a).Header=i.a.GetResource("DocumentDesigner_Sno"),t.DisplayMember="Sno",t.ReadOnly=!0,t.Width=50,this.PstDocGrid.Columns.push(t),(t=new d.a).Header="Select",t.DisplayMember="select",t.Width=60,t.DataType="CheckBox",this.PstDocGrid.Columns.push(t);for(var a=i.a.rental.GetPaymentScreenDef(),r=null,o=0;o<a.Tables[0].length;o++)"PaymentTermDocumentName"==a.Tables[0][o].DBText.toString()?s.e.IsEmpty(a.Tables[0][o].Value)||(this.DocCCID=parseInt(a.Tables[0][o].Value.toString())):"PaymentTermCompletionDate"==a.Tables[0][o].DBText.toString()?this.CompletionDateColName=a.Tables[0][o].Value.toString():"LinkDocument"==a.Tables[0][o].DBText.toString()?s.e.IsEmpty(a.Tables[0][o].Value)||(this.CCID=parseInt(a.Tables[0][o].Value.toString())):"PaymentTermFields"==a.Tables[0][o].DBText.toString()&&(r=a.Tables[0][o].Value.toString().split(";"));this.Tower.CCID=this.CCID,this.Tower.TypeID=1,this.Tower.Label="Tower",r.forEach((function(i){var s,r=(_toArray(s=a.Tables[1].filter((function(t){return t.SysColumnName==i}))),s);if(r.length>0)if((t=new d.a).Header=r[0].ResourceData.toString(),t.DisplayMember=r[0].SysColumnName.toString(),"VoucherNo"==t.DisplayMember&&(t.DataType="LINK",t.Click.Subscribe(e,"onClick")),t.ReadOnly=!0,t.Width=100,e.PstDocGrid.Columns.push(t),t.SectionName=r[0].UserColumnType.toString(),e.PstDocGridTableColumns.push(r[0].SysColumnName.toString()),r[0].SysColumnName.toString().toLowerCase().Contains("dcccnid")){var o=parseInt(r[0].SysColumnName.toString().toLowerCase().Replace("dcccnid",""));o+=5e4,e.Joins+=" left Join "+e.GetTableName(o)+" c"+o.toString()+"  WITH(NOLOCK) on c."+r[0].SysColumnName.toString()+"= c"+o.toString()+".NODEID  ",e.Columns+=",c"+o.toString()+".name "+t.DisplayMember}else"debitaccount"==r[0].SysColumnName.toString().toLowerCase()||"creditaccount"==r[0].SysColumnName.toString().toLowerCase()?(e.Joins+=" left Join "+e.GetTableName(2)+" c"+r[0].SysColumnName.toString()+"  WITH(NOLOCK) on a."+r[0].SysColumnName.toString()+"= c"+r[0].SysColumnName.toString()+".AccountID  ",e.Columns+=",c"+r[0].SysColumnName.toString()+".Accountname "+t.DisplayMember):"duedate"==r[0].SysColumnName.toString().toLowerCase()||"docdate"==r[0].SysColumnName.toString().toLowerCase()||"billdate"==r[0].SysColumnName.toString().toLowerCase()?e.Columns+=",Convert(datetime,"+t.DisplayMember+") "+t.DisplayMember:e.Columns+=","+t.DisplayMember;else"PaymentTerm"==i&&((t=new d.a).Header="PaymentTerm",t.DisplayMember="PaymentTerm",t.ReadOnly=!0,t.Width=100,t.SectionName="PaymentTerm",e.PstDocGrid.Columns.push(t),e.PstDocGridTableColumns.push("PaymentTerm"),e.Columns+=",(select top 1 pd.ProfileName from COM_DocPayTerms p ",e.Columns+=" join Acc_PaymentDiscountProfile pd on p.ProfileID=pd.ProfileID  ",e.Columns+=" where p.VoucherNo=a.VoucherNo)  "+t.DisplayMember)}))}},{key:"GetTableName",value:function(t){return 2==t?"ACC_Accounts":3==t?"INV_Product":50001==t?"COM_Division":50002==t?"COM_Location":50003==t?"COM_Branch":50004==t?"COM_Department":50005==t?"COM_Salesman":50006==t?"COM_Category":50007==t?"COM_Area":50008==t?"COM_Teritory":"COM_CC"+t}},{key:"onClick",value:function(){null==this.PstDocGrid.SelectedItem||s.e.IsEmpty(this.PstDocGrid.SelectedItem.CostCenterID)||p.RibbonExtViewModel.LoadDocument(this.PstDocGrid.SelectedItem)}},{key:"SelectAllRows",value:function(){for(var t=0;t<this.PstDocGrid.Table.length;t++)this.PstDocGridTable[t].select=this.SelectAll}},{key:"FillSearchDetails",value:function(){var t=this;this.Options=new l.e(0),this.SearchCols=new l.e(0),this.Options.Items.push(l.d.ComboBoxItems_2(i.a.GetResource("Com_Equals"),"1")),this.Options.Items.push(l.d.ComboBoxItems_2(i.a.GetResource("Com_NotEquals"),"2")),this.Options.Items.push(l.d.ComboBoxItems_2(i.a.GetResource("Com_BeginsWith"),"3")),this.Options.Items.push(l.d.ComboBoxItems_2(i.a.GetResource("Com_EndsWith"),"4")),this.Options.Items.push(l.d.ComboBoxItems_2(i.a.GetResource("Com_Contains"),"5")),this.Options.Items.push(l.d.ComboBoxItems_2(i.a.GetResource("Com_NotContains"),"6")),this.Options.SelectedValue="5",this.PstDocGrid.Columns.forEach((function(e){e.IsVisible&&"Sno"!=e.DisplayMember&&"select"!=e.DisplayMember&&t.SearchCols.Items.push(l.d.ComboBoxItems_2(e.Header,e.DisplayMember))})),this.SearchCols.Items.length>0&&(this.SearchCols.SelectedValue=this.SearchCols.Items[0].Value)}},{key:"LoadData",value:function(){if(null!=this.Tower&&this.Tower.CCID>0&&this.Tower.SelectedValue>0){var t;this.PstDocGrid.Clear();var e=" where c.dcCCNID"+(this.Tower.CCID-5e4).toString()+"="+this.Tower.SelectedValue,a=i.a.rental.GetPayTermsofProperty(e,this.Columns,this.Joins);if(null!=a&&a.Tables.length>0&&a.Columns[0].Contains("DocPrefix")){for(var r=0;r<a.Tables[0].length;r++){(t=this.PstDocGrid.NewRow()).Sno=(r+1).toString(),t.select=!1,t.DocNumber=a.Tables[0][r].DocNumber.toString(),t.DocPrefix=a.Tables[0][r].DocPrefix.toString(),t.DocID=a.Tables[0][r].DocID.toString(),t.CostCenterID=a.Tables[0][r].CostCenterID.toString(),t.VNO=a.Tables[0][r].VNO.toString();for(var o=2;o<this.PstDocGrid.Columns.length;o++)a.Columns[0].Contains(this.PstDocGrid.Columns[o].DisplayMember)?"date"==this.PstDocGrid.Columns[o].SectionName.toLowerCase()&&!s.e.IsEmpty(a.Tables[0][r][this.PstDocGrid.Columns[o].DisplayMember])&&s.e.isValidDate(a.Tables[0][r][this.PstDocGrid.Columns[o].DisplayMember].toString())&&(s.e.isValidDate(a.Tables[0][r][this.PstDocGrid.Columns[o].DisplayMember].toString()),t[this.PstDocGrid.Columns[o].DisplayMember]=new Date(a.Tables[0][r][this.PstDocGrid.Columns[o].DisplayMember].toString()).ToString(i.a.SessionManager.Preferences["Date Format"])):"datetime"==this.PstDocGrid.Columns[o].SectionName.toLowerCase()&&!s.e.IsEmpty(a.Tables[0][r][this.PstDocGrid.Columns[o].DisplayMember])&&s.e.isValidDate(a.Tables[0][r][this.PstDocGrid.Columns[o].DisplayMember].toString())?(s.e.isValidDate(a.Tables[0][r][this.PstDocGrid.Columns[o].DisplayMember].toString()),t[this.PstDocGrid.Columns[o].DisplayMember]=new Date(a.Tables[0][r][this.PstDocGrid.Columns[o].DisplayMember].toString()).ToString(i.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss")):t[this.PstDocGrid.Columns[o].DisplayMember]=a.Tables[0][r][this.PstDocGrid.Columns[o].DisplayMember].toString()}this.PstDocGrid.addRow(t)}}}},{key:"ButtonSave",value:function(t){var e=this;if(this.DisplayMessage="","Save"==t){if(2==this.Calltype)return void i.a.page.HideDialog();if(1==this.Calltype){var a;if(!((a=s.e.IntTryParse(this.CopyRows.Text))>0))return this.DisplayMessage="Enter valid count.",void(this.MessageVisibility=!0);for(var o=["DocID","DocNumber","DocPrefix","DocumentName","CostCenterID","DocumentNo","Status","Xml"],n=this.oparent.DataTable.indexOf(this.selectedrow),l=0;l<a;l++){for(var u=this.oparent.DataTableObj.NewRow(),D=0;D<this.oparent.DataTableObj.Columns.length;D++)this.oparent.DataTableColumns.Contains(o[D])||(u[D]=this.selectedrow[D]);this.oparent.DataTableObj.insertRowAt(u,n)}for(var c=0;c<this.oparent.DataTableObj.Table.length;c++)this.oparent.DataTable[c].SNO=c+1;return}if(3==this.Calltype||4==this.Calltype||5==this.Calltype||6==this.Calltype){for(var d=0;d<this.PstDocGrid.Table.length;d++)if(""!=this.PstDocGrid.Table[d].Select.toString()&&Object(r.j)(this.PstDocGrid.Table[d].Select.toString())){var m=new h.AddEditRenContractViewModel;m.AddEditRenContractViewModel_1(95,parseInt(this.PstDocGrid.Table[d].ContractID.toString()),!1,0,0,""),m.ContractDate.Text=m.ContractDate.Date.ToString("dd/MMM/yyyy"),m.StartDate.Text=m.StartDate.Date.ToString("dd/MMM/yyyy"),m.EndDate.Text=m.EndDate.Date.ToString("dd/MMM/yyyy"),m.Tenant.Text=m.Property.Text=m.Unit.Text="",3==this.Calltype?(m.OnCustomizeExtraFields("AutoRenew"),m.OnSave("AutoSave")):4==this.Calltype?(m.TerminateContracts=this.oparent.TerminateContracts,m.TerminateContract(m.ContractID,this.oparent.cntrct.Reason,this.oparent.cntrct.TerminationDate,1,!0)):5==this.Calltype?(m.TerminateContracts=this.oparent.TerminateContracts,m.TerminateContract(m.ContractID,this.oparent.cntrct.Reason,this.oparent.cntrct.TerminationDate,3,!0)):6==this.Calltype&&(m.TerminateContracts=this.oparent.TerminateContracts,m.TerminateContract(m.ContractID,this.oparent.cntrct.Reason,this.oparent.cntrct.TerminationDate,2,!0))}return void i.a.page.HideDialog()}if(null!=this.oparent&&null!=this.selectedrow){if(this.oparent.IsRecurPosted)return this.DisplayMessage="Can not change as documents posted.",void(this.MessageVisibility=!0);var p=0,b=null,S=null,P=0,T=0,g=0,y=new Array;if(this.Filter.Visible&&"2"!=this.Filter.SelectedValue){if(this.Filter.Visible&&"1"==this.Filter.SelectedValue){for(var C=0;C<this.PstDocGrid.Table.length;C++)if(!s.e.IsEmpty(this.PstDocGrid.Table[C].Unit_key)){if(y.Contains(parseInt(this.PstDocGrid.Table[C].Unit_key.toString())))return this.DisplayMessage="Unit "+this.PstDocGrid.Table[C].Unit.toString()+" is defined more than once.",void(this.MessageVisibility=!0);y.push(parseInt(this.PstDocGrid.Table[C].Unit_key.toString())),s.e.IsEmpty(this.PstDocGrid.Table[C].Amount)||(P+=parseFloat(this.PstDocGrid.Table[C].Amount.toString()),p++),s.e.IsEmpty(this.PstDocGrid.Table[C].ActAmount)||(g+=parseFloat(this.PstDocGrid.Table[C].ActAmount.toString())),s.e.IsEmpty(this.PstDocGrid.Table[C].Discount)||(T+=parseFloat(this.PstDocGrid.Table[C].Discount.toString()))}if(p>0&&y.length!=this.oparent.SelectedUnits.split(",").length)return this.DisplayMessage="Distribution not defined for some units.",void(this.MessageVisibility=!0)}else if(this.Filter.Visible&&"0"==this.Filter.SelectedValue&&(this.oparent.SelectedUnits.split(",").forEach((function(t){var a=e.PstDocGrid.Table.filter((function(e){return e.Unit_key==t}),"FromDate_key");if(b=null,S=null,a.length>0){y.push(parseInt(t));for(var i=0;i<a.length;i++){if(null!=b||s.e.IsEmpty(a[i].FromDate_key)||(b=new Date(a[i].FromDate_key.toString())),null!=S&&!s.e.IsEmpty(a[i].FromDate_key)&&1!=s.e.GetDateDifference(new Date(a[i].FromDate_key),new Date(S)))return e.DisplayMessage="Enter correct from date at row no:"+(e.PstDocGrid.Table.indexOf(a[i])+1),void(e.MessageVisibility=!0);if(s.e.IsEmpty(a[i].Amount)||(P+=parseFloat(a[i].Amount.toString()),p++),s.e.IsEmpty(a[i].ActAmount)||(g+=parseFloat(a[i].ActAmount.toString())),s.e.IsEmpty(a[i].Discount)||(T+=parseFloat(a[i].Discount.toString())),s.e.IsEmpty(a[i].ToDate_key)||(S=new Date(a[i].ToDate_key.toString())),e.PstDocGrid.TableColumns.Contains("Distribute")&&!s.e.IsEmpty(a[i].FromDate_key)&&!s.e.IsEmpty(a[i].ToDate_Key)&&(""==s.e.String(a[i].Distribute)||parseInt(a[i].Distribute.toString())<1))return e.DisplayMessage="Enter Distribute at row no:"+(e.PstDocGrid.Table.indexOf(a[i])+1),void(e.MessageVisibility=!0)}if(null==b||b.toDateString()!=e.CompletionDate.Date.toDateString())return e.DisplayMessage="Contract start date and first date does not match for ."+a[0].Unit.toString(),void(e.MessageVisibility=!0);if(null==S||S.toDateString()!=e.EndDate.Date.toDateString())return e.DisplayMessage="Contract end date and last date does not match for ."+a[0].Unit.toString(),void(e.MessageVisibility=!0)}})),p>0&&y.length!=this.oparent.SelectedUnits.split(",").length))return this.DisplayMessage="Distribution not defined for some units.",void(this.MessageVisibility=!0)}else{for(var f=0;f<this.PstDocGrid.Table.length;f++){if(null!=b||s.e.IsEmpty(this.PstDocGrid.Table[f].FromDate_key)||(b=new Date(this.PstDocGrid.Table[f].FromDate_key.toString())),null!=S&&!s.e.IsEmpty(this.PstDocGrid.Table[f].FromDate_key)&&1!=s.e.GetDateDifference(new Date(this.PstDocGrid.Table[f].FromDate_key),new Date(S)))return this.DisplayMessage="Enter correct from date at row no:"+(f+1),void(this.MessageVisibility=!0);if(s.e.IsEmpty(this.PstDocGrid.Table[f].Amount)||(P+=parseFloat(this.PstDocGrid.Table[f].Amount.toString()),p++),s.e.IsEmpty(this.PstDocGrid.Table[f].ActAmount)||(g+=parseFloat(this.PstDocGrid.Table[f].ActAmount.toString())),s.e.IsEmpty(this.PstDocGrid.Table[f].Discount)||(T+=parseFloat(this.PstDocGrid.Table[f].Discount.toString())),s.e.IsEmpty(this.PstDocGrid.Table[f].ToDate_key)||(S=new Date(this.PstDocGrid.Table[f].ToDate_key.toString())),this.PstDocGrid.TableColumns.Contains("Distribute")&&!s.e.IsEmpty(this.PstDocGrid.Table[f].FromDate_key)&&!s.e.IsEmpty(this.PstDocGrid.Table[f].ToDate_Key)&&(""==s.e.String(this.PstDocGrid.Table[f].Distribute)||parseInt(this.PstDocGrid.Table[f].Distribute.toString())<1))return this.DisplayMessage="Enter Distribute at row no:"+(f+1),void(this.MessageVisibility=!0)}if(p>0&&(null==b||b.toDateString()!=this.CompletionDate.Date.toDateString()))return this.DisplayMessage="Contract start date and first date does not match.",void(this.MessageVisibility=!0);if(p>0&&(null==S||S.toDateString()!=this.EndDate.Date.toDateString()))return this.DisplayMessage="Contract end date and last date does not match.",void(this.MessageVisibility=!0)}if(p>0&&(""==s.e.String(this.selectedrow.Amount)||0==parseFloat(this.selectedrow.Amount.toString()))&&(this.selectedrow.Amount=P.ToString("N"+this.oparent.Mdeci),this.selectedrow.Discount=T.ToString("N"+this.oparent.Mdeci),this.selectedrow.ActAmount=g.ToString("N"+this.oparent.Mdeci),this.oparent.Reevaluate(),this.oparent.CalculateNRec()),p>0&&!s.e.IsEmpty(this.selectedrow.Amount)&&parseFloat(this.selectedrow.Amount.toString()).ToString("N"+this.oparent.Mdeci)!=P.ToString("N"+this.oparent.Mdeci))return this.DisplayMessage="Amount mismatch",void(this.MessageVisibility=!0);var G="";if(p>0){if(G+="<XML",this.Filter.Visible&&(G+=' Filter="'+this.Filter.SelectedValue+'" '),G+=">",this.Filter.Visible&&"0"==this.Filter.SelectedValue)this.oparent.SelectedUnits.split(",").forEach((function(t){var a=e.PstDocGrid.Table.filter((function(e){return e.Unit_key==t}),"FromDate_key");G+='<UnitsRow Unit="'+t+'" Amount="##amt##" >';for(var i=0,r=0;r<a.length;r++)s.e.IsEmpty(a[r].Amount)||(G+="<Row ",G+='FromDate="'+new Date(a[r].FromDate_key).ToString("dd/MMM/yyyy")+'" ',G+='ToDate="'+new Date(a[r].ToDate_key).ToString("dd/MMM/yyyy")+'" ',G+='Unit="'+a[r].Unit_key.toString()+'" ',s.e.IsEmpty(a[r].Period)||(G+='Period="'+a[r].Period.toString()+'" '),s.e.IsEmpty(a[r].Rate)||(G+='Rate="'+a[r].Rate.toString()+'" '),e.PstDocGrid.TableColumns.Contains("MonthAmount")&&!s.e.IsEmpty(a[r].MonthAmount)&&(G+='MonthAmount="'+a[r].MonthAmount.toString()+'" '),e.PstDocGrid.TableColumns.Contains("Distribute")&&!s.e.IsEmpty(a[r].Distribute)&&(G+='Distribute="'+a[r].Distribute.toString()+'" '),s.e.IsEmpty(a[r].Discount)||(G+='Discount="'+a[r].Discount.toString()+'" '),s.e.IsEmpty(a[r].ActAmount)||(G+='ActAmount="'+a[r].ActAmount.toString()+'" '),s.e.IsEmpty(a[r].Percent)||(G+='Percent="'+a[r].Percent.toString()+'" '),G+='Amount="'+a[r].Amount.toString()+'" ',G+='Narration="'+s.e.String(a[r].Narration)+'"/>',i+=parseFloat(a[r].Amount.toString()));G=G.Replace("##amt##",i.toString()),G+="</UnitsRow>"}));else for(var A=0;A<this.PstDocGrid.Table.length;A++)s.e.IsEmpty(this.PstDocGrid.Table[A].Amount)||(G+="<Row ",this.Filter.Visible&&!this.PstDocGrid.Columns[1].IsVisible||(G+='FromDate="'+new Date(this.PstDocGrid.Table[A].FromDate_key).ToString("dd/MMM/yyyy")+'" ',G+='ToDate="'+new Date(this.PstDocGrid.Table[A].ToDate_key).ToString("dd/MMM/yyyy")+'" '),this.Filter.Visible&&this.PstDocGrid.Columns[3].IsVisible&&!s.e.IsEmpty(this.PstDocGrid.Table[A].Unit_key)&&(G+='Unit="'+this.PstDocGrid.Table[A].Unit_key.toString()+'" '),s.e.IsEmpty(this.PstDocGrid.Table[A].Period)||(G+='Period="'+this.PstDocGrid.Table[A].Period.toString()+'" '),s.e.IsEmpty(this.PstDocGrid.Table[A].Rate)||(G+='Rate="'+this.PstDocGrid.Table[A].Rate.toString()+'" '),this.PstDocGrid.TableColumns.Contains("MonthAmount")&&!s.e.IsEmpty(this.PstDocGrid.Table[A].MonthAmount)&&(G+='MonthAmount="'+this.PstDocGrid.Table[A].MonthAmount.toString()+'" '),this.PstDocGrid.TableColumns.Contains("Distribute")&&!s.e.IsEmpty(this.PstDocGrid.Table[A].Distribute)&&(G+='Distribute="'+this.PstDocGrid.Table[A].Distribute.toString()+'" '),this.PstDocGrid.TableColumns.Contains("Discount")&&!s.e.IsEmpty(this.PstDocGrid.Table[A].Discount)&&(G+='Discount="'+this.PstDocGrid.Table[A].Discount.toString()+'" '),this.PstDocGrid.TableColumns.Contains("ActAmount")&&!s.e.IsEmpty(this.PstDocGrid.Table[A].ActAmount)&&(G+='ActAmount="'+this.PstDocGrid.Table[A].ActAmount.toString()+'" '),this.PstDocGrid.TableColumns.Contains("Percent")&&!s.e.IsEmpty(this.PstDocGrid.Table[A].Percent)&&(G+='Percent="'+this.PstDocGrid.Table[A].Percent.toString()+'" '),G+='Amount="'+this.PstDocGrid.Table[A].Amount.toString()+'" ',G+='Narration="'+s.e.String(this.PstDocGrid.Table[A].Narration)+'"/>');G+="</XML>"}return this.selectedrow.Xml=G.toString(),this.oparent.DataTableObj.updateRow(this.selectedrow),void i.a.page.HideDialog()}if(!(null!=this.CompletionDate.Date&&this.CompletionDate.Date&&this.PstDocGrid.Table.length>0))return this.PstDocGrid.Table.length>0?(this.DisplayMessage="can not save blank data ",void(this.MessageVisibility=!0)):(this.DisplayMessage="Select Completion Date",void(this.MessageVisibility=!0));for(var w="",I=0;I<this.PstDocGrid.Table.length;I++)!s.e.IsEmpty(this.PstDocGrid.Table[I].select)&&Object(r.j)(this.PstDocGrid.Table[I].select.toString())&&(w+='<Row ID="'+this.PstDocGrid.Table[I].DocID.toString()+'" ',w+=' CostCenterID="'+this.PstDocGrid.Table[I].CostCenterID.toString()+'" ',w+=' VNO="'+this.PstDocGrid.Table[I].VNO.toString()+'" />');if(!(w.length>0))return this.DisplayMessage="Select data to save",void(this.MessageVisibility=!0);w="<XML>"+w+"</XML>";var F,v=i.a.rental.SaveCompletionDate(w.toString(),this.CompletionDate.Date.Date(),this.Tower.SelectedValue);this.DisplayMessage=v.Message,F=v.RetValue,this.MessageVisibility=!0,F>0&&this.PstDocGrid.Clear()}else if("GenFirst"==t){if(null!=this.oparent&&null==this.selectedrow&&null!=this.Rows){if(s.e.IsEmpty(this.Filter.SelectedValue))return this.DisplayMessage="Select Year",void(this.MessageVisibility=!0);if("ALL"==this.Filter.SelectedValue)this.oparent.GenerateContract();else{var M,E=null,R=0;M=new Date(this.Filter.SelectedValue),s.e.IsEmpty(this.Filter.SelectedItem.Parent)||(E=new Date(this.Filter.SelectedItem.Parent)),this.Filter.SelectedItem.CurrID>0&&(R=parseInt(this.Filter.SelectedItem.CurrID.toString())),this.oparent.GenerateContract(M,E,R)}return void i.a.page.HideDialog()}}else"Search"==t?this.SearchGrid():"OK"==t?this.LoadData():"Close"==t?i.a.page.HideDialog():"Selectionchanged"==t&&("0"==this.Filter.SelectedValue?(this.PstDocGrid.Columns[1].IsVisible=!0,this.PstDocGrid.Columns[2].IsVisible=!0,this.PstDocGrid.Columns[3].IsVisible=!0):"1"==this.Filter.SelectedValue?(this.PstDocGrid.Columns[1].IsVisible=!1,this.PstDocGrid.Columns[2].IsVisible=!1,this.PstDocGrid.Columns[3].IsVisible=!0):"2"==this.Filter.SelectedValue&&(this.PstDocGrid.Columns[1].IsVisible=!0,this.PstDocGrid.Columns[2].IsVisible=!0,this.PstDocGrid.Columns[3].IsVisible=!1),this.LoadDefaultValues(),this.PstDocGrid.UpdateFooter())}},{key:"LoadDefaultValues",value:function(){var t=this;if(null!=this.oparent.dsPart&&this.oparent.dsPart.Tables.length>5&&this.oparent.dsPart.Tables[5].length>0){this.PstDocGrid.Clear();var e,a=this.oparent.dsPart.Tables[5].Compute("sum","RENT"),r=this.oparent.SelectedUnits.split(",");if(e=s.e.DoubleTryParse(this.oparent.TotalYears.Text),"0"==this.Filter.SelectedValue&&this.oparent.EndDate.Date>this.oparent.StartDate.Date.AddYears(1))for(var o=function(o){var n=null;if(null!=t.oparent.dsPart&&t.oparent.dsPart.Tables[5].length>0&&(n=t.oparent.dsPart.Tables[5].filter((function(t){return t.UnitID==r[o]}))),null!=n&&n.length>0){var l=parseFloat(t.selectedrow.Amount.toString())*parseFloat(n[0].RENT);null!=a&&parseFloat(a)>0&&(l/=parseFloat(a));for(var u=l/e,D=0;D<e;D++){var c=t.PstDocGrid.NewRow();c.FromDate=t.oparent.StartDate.Date.AddYears(D).ToString(i.a.SessionManager.Preferences["Date Format"]),c.FromDate_key=t.oparent.StartDate.Date.AddYears(D),D==e-1?(c.ToDate=t.oparent.EndDate.Date.ToString(i.a.SessionManager.Preferences["Date Format"]),c.ToDate_key=t.oparent.EndDate.Date):(c.ToDate=t.oparent.StartDate.Date.AddYears(D+1).AddDays(-1).ToString(i.a.SessionManager.Preferences["Date Format"]),c.ToDate_key=t.oparent.StartDate.Date.AddYears(D+1).AddDays(-1)),c.Unit_key=n[0].UnitID.toString(),s.e.IsEmpty(n[0].RENT)||(c.Amount=u.ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()),c.Rate=(parseFloat(c.Amount)/parseFloat(n[0].RentableArea.toString())).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString())),c.Discount=0,c.ActAmount=c.Amount.toString(),c.Sno=t.PstDocGrid.Table.length+1,t.PstDocGrid.addRow(c)}}},n=0;n<r.length;n++)o(n);else if("1"==this.Filter.SelectedValue){var l=parseFloat(this.selectedrow.Amount.toString());if(l.ToString("N2")==parseFloat(a).ToString("N2"))for(var u=function(e){var a=t.PstDocGrid.NewRow();a.FromDate=t.oparent.StartDate.Date.ToString(i.a.SessionManager.Preferences["Date Format"]),a.FromDate_key=t.oparent.StartDate.Date,a.ToDate=t.oparent.StartDate.Date.ToString(i.a.SessionManager.Preferences["Date Format"]),a.ToDate_key=t.oparent.StartDate.Date;var o=null;null!=t.oparent.dsPart&&t.oparent.dsPart.Tables[5].length>0&&(o=t.oparent.dsPart.Tables[5].filter((function(t){return t.UnitID==r[e]}))),null!=o&&o.length>0&&(a.Unit_key=o[0].UnitID.toString(),s.e.IsEmpty(o[0].RENT)||(a.Amount=parseFloat(o[0].RENT).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()),a.Rate=(parseFloat(a.Amount)/parseFloat(o[0].RentableArea.toString())).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString())),a.Discount=0,a.ActAmount=a.Amount.toString()),a.Sno=t.PstDocGrid.Table.length+1,t.PstDocGrid.addRow(a)},D=0;D<r.length;D++)u(D);else for(var c=function(e){var o=t.PstDocGrid.NewRow();o.FromDate=t.oparent.StartDate.Date.ToString(i.a.SessionManager.Preferences["Date Format"]),o.FromDate_key=t.oparent.StartDate.Date,o.ToDate=t.oparent.StartDate.Date.ToString(i.a.SessionManager.Preferences["Date Format"]),o.ToDate_key=t.oparent.StartDate.Date;var n=null;null!=t.oparent.dsPart&&t.oparent.dsPart.Tables[5].length>0&&(n=t.oparent.dsPart.Tables[5].filter((function(t){return t.UnitID==r[e]}))),null!=n&&n.length>0&&(o.Unit_key=n[0].UnitID.toString(),s.e.IsEmpty(n[0].RENT)||(o.Amount=null!=a?(l*parseFloat(n[0].RENT)/parseFloat(a)).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()):(l*parseFloat(n[0].RENT)).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString()),o.Rate=(parseFloat(o.Amount)/parseFloat(n[0].RentableArea.toString())).ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount.toString())),o.Discount=0,o.ActAmount=o.Amount.toString()),o.Sno=t.PstDocGrid.Table.length+1,t.PstDocGrid.addRow(o)},h=0;h<r.length;h++)c(h)}else if("2"==this.Filter.SelectedValue)for(var d=0;d<e;d++){var m=this.PstDocGrid.NewRow();m.FromDate=this.oparent.StartDate.Date.AddYears(d).ToString(i.a.SessionManager.Preferences["Date Format"]),m.FromDate_key=this.oparent.StartDate.Date.AddYears(d),d==e-1?(m.ToDate=this.oparent.EndDate.Date.ToString(i.a.SessionManager.Preferences["Date Format"]),m.ToDate_key=this.oparent.EndDate.Date):(m.ToDate=this.oparent.StartDate.Date.AddYears(d+1).AddDays(-1).ToString(i.a.SessionManager.Preferences["Date Format"]),m.ToDate_key=this.oparent.StartDate.Date.AddYears(d+1).AddDays(-1)),m.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(m)}this.PstDocGrid.Columns[3].IsVisible&&(this.PstDocGrid.RefreshGrid=!0);for(var p=0;p<5;p++){var b=this.PstDocGrid.NewRow();b.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(b)}}}},{key:"SearchGrid",value:function(){if(!s.e.IsEmpty(this.SearchText)){var t="";if(""!=this.SearchCols.SelectedValue)t=this.SearchCols.SelectedValue;else{if(!(this.SearchCols.Items.length>0))return;t=this.SearchCols.Items[0].Value}if(this.PstDocGridTableColumns.Contains(t)){var e=this.PstDocGrid.SelectedIndex;-1==e&&(e=0);for(var a=0;a<this.PstDocGrid.Table.length;a++)if(e<this.PstDocGrid.Table.length-1?e++:e=0,!s.e.IsEmpty(this.PstDocGrid.Table[e][t]))switch(this.Options.SelectedValue){case"1":if(this.PstDocGrid.Table[e][t].toString().toLowerCase()==this.SearchText.toLowerCase())return void this.Setselectedrow(e);break;case"2":if(this.PstDocGrid.Table[e][t].toString().toLowerCase()!=this.SearchText.toLowerCase())return void this.Setselectedrow(e);break;case"3":if(this.PstDocGrid.Table[e][t].toString().toLowerCase().startsWith(this.SearchText.toLowerCase()))return void this.Setselectedrow(e);break;case"4":if(this.PstDocGrid.Table[e][t].toString().toLowerCase().endsWith(this.SearchText.toLowerCase()))return void this.Setselectedrow(e);break;case"5":if(this.PstDocGrid.Table[e][t].toString().toLowerCase().Contains(this.SearchText.toLowerCase()))return void this.Setselectedrow(e);break;case"6":if(!this.PstDocGrid.Table[e][t].toString().toLowerCase().Contains(this.SearchText.toLowerCase()))return void this.Setselectedrow(e)}}}}},{key:"Setselectedrow",value:function(t){this.PstDocGrid.SelectedItem=this.PstDocGrid.Table[t]}},{key:"SelectAll",get:function(){return this._SelectAll},set:function(t){t!=this._SelectAll&&(this._SelectAll=t,this.SelectAllRows())}},{key:"angularGrid",get:function(){return this.PstDocGrid.angularGrid}},{key:"PstDocGridTable",get:function(){return this.PstDocGrid.Table}},{key:"PstDocGridTableColumns",get:function(){return this.PstDocGrid.TableColumns}},{key:"angularGrid1",get:function(){return this.PartGrid.angularGrid}},{key:"PartGridTable",get:function(){return this.PartGrid.Table}},{key:"PartGridTableableColumns",get:function(){return this.PartGrid.TableColumns}}]),a}(o.b)}}]);
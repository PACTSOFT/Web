function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,s=new Array(t);o<t;o++)s[o]=e[o];return s}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var s=t[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var o,s=_getPrototypeOf(e);if(t){var i=_getPrototypeOf(this).constructor;o=Reflect.construct(s,arguments,i)}else o=s.apply(this,arguments);return _possibleConstructorReturn(this,o)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[41,211],{"/nZE":function(e,t,o){"use strict";o.d(t,"a",(function(){return d}));var s=o("Do2H"),i=o("Lp6j"),l=o("eQJW"),n=o("1xwR"),a=o("vTM8"),r=o("mvPR"),h=o("dH+5"),u=o("MCLT"),c=o("4HhE"),D=o("8iaB"),d=function(e){_inherits(o,e);var t=_createSuper(o);function o(e){var i;return _classCallCheck(this,o),(i=t.call(this,e)).i=0,i.k=0,i.iMainRow=0,i.GroupRowsCount=0,i.AccountGroupIndex=0,i.SlabSize=0,i.iMainRowAccountID=0,i.dvPaymentTerms=null,i.dv=null,i.dvFPaymentTerms=null,i.dvPDCSeperate=null,i.dvPaymentTermsTable=null,i.dvTable=null,i.dvPDCSeperateTable=null,i.colAmountIndex=-1,i.colAdjustedIndex=-1,i.colHiddenAdjustedIndex=-1,i.colBalanceIndex=-1,i.colBalanceCumIndex=-1,i.colSlabIndex=-1,i.colMonthSlabIndex=-1,i.CntMonths=0,i.colUnAdjustedIndex=-1,i.colNetBalanceIndex=-1,i.colBillAmtIndex=-1,i.colLOBPDCIndex=-1,i.colTotalSaleIndex=-1,i.colPrevYearSaleIndex=-1,i.colPeriodSaleIndex=-1,i.colReceiptsAmtIndex=-1,i.colChqBounceAmtIndex=-1,i.colPDCIndex=-1,i.colLOBAgeingPDCIndex=-1,i.colIncludingPDCIndex=-1,i.colPaidByDaysIndex=-1,i.colUnDueIndex=-1,i.colTempIndex=-1,i.colFutureTrDr=-1,i.colFutureTrCr=-1,i.CurrencyType=0,i.colRefAccount=-1,i.Slabs=new Array,i.FSlabs=new Array,i.cqSlabs=new Array,i.MonthSlabs=new Array,i.Slabs_MMMYY=new Array,i.iSlabs=new Array,i.ShowLevelTree=!1,i.AccountsWithOutTransactions=!1,i.AccountsWithZeroBalance=!1,i.ShowMonthWise=!1,i.IsPaymentTermWise=!1,i.IsDueDateWise=!1,i.PDCSeperate=!1,i.HidePDCAdjustments=!1,i.DontShowBillAdjustments=!1,i.FilterPDCOnMaturityDate=!1,i.BWPerformance=!1,i.GroupTotalsAtEnd=!1,i.PDCOnConvresionDate=!1,i.HideSectionSubTotal=!1,i.AllowFromDateFilter=!1,i.UnPostedDocsSeparately=!1,i.UnAppsDocsAdjustSeperate=!1,i.FutureSlabs=!1,i.dblAmount=0,i.dblPaidTotal=0,i.dblBalance=0,i.dblBalanceCum=0,i.dblPaidDaysTotal=0,i.dtMonthWiseEndData=null,i.ShowMonthWiseFromDatePicker=!1,i.ShowDrCrSeperately=!1,i.UnAdjusted=!1,i.SemiAdjusted=!1,i.Adjusted=!1,i.IsDocDateWise=!1,i.GroupByDocNo=!1,i.arrUnPostedStatuses=new a.c,i.lstGroup=null,i.sbSubQuery="",i.dvChild=null,i.dvChildTable=null,i.PrintAgeingAnalysis=!1,i.BWAgeingShowOnlyDocsType="",i.BWAgeingShowOnlyDocs=!1,i.IsReceivable=!1,i.IsConsolidated=!1,i.FIFO=!1,i.ShowPreviousAdjustment=!1,i.ShowFutureAdjustment=!1,i.LOBAgeingReport=0,i.BlankRowHeight=0,i.AdjustmentRoundOff=.099,i.LOBAgeingColumns=new Array,i.lstRecPayUnadjusted=new a.c,i.arrPDCStatus=null,i.tempTotals=null,i.tempHiddenTotals=null,i.AddPDCSubTotal=!1,i.ClubByVoucherNo=!1,i.StatusID=0,i.ParentRow=null,i.LevelNo=0,i.dbl1=0,i.dbl2=0,i.TempOutValue=0,i.dblReceivable=0,i.dblPayable=0,i.dblAmount_ForUnDue=0,i.dblBillAmount=0,i.lstTotal=null,i.drRows=null,i.drFRows=null,i.arrMonthSlabAmounts=new a.a,i.IgnoreRow=!1,i.IsCQDate=!1,i.cmpValue=1/Math.pow(10,parseFloat(s.a.SessionManager.Preferences.DecimalsinAmount)),i.lstParents=new Array,i}return _createClass(o,[{key:"LoadReport",value:function(){var e=this;if(this.ViewModel.SubTotalCallBack=null,this.lstGroup=this.ViewModel.lstGroup,this.AccountGroupIndex=-1,this.colMonthSlabIndex=-1,this.ViewModel.lstGroupIndex.Clear(),this.ViewModel.SNo=0,this.ViewModel.Preferences.ContainsKey("DisplayBills")&&(this.UnAdjusted=this.ViewModel.Preferences.DisplayBills.Contains("<UnAdjusted"),this.SemiAdjusted=this.ViewModel.Preferences.DisplayBills.Contains("<SemiAdjusted"),this.Adjusted=this.ViewModel.Preferences.DisplayBills.Contains("<Adjusted")),this.GroupByDocNo=!(!this.ViewModel.Preferences.ContainsKey("GroupByDocNo")||"1"!=this.ViewModel.Preferences.GroupByDocNo),this.IsDocDateWise="DocDate"==this.ViewModel.Preferences.Date,this.IsPaymentTermWise="PaymentTerm"==this.ViewModel.Preferences.Date,this.IsDueDateWise="DocDueDate"==this.ViewModel.Preferences.Date,this.PDCInclude=!(!this.ViewModel.Preferences.ContainsKey("IncludePDCs")||"1"!=this.ViewModel.Preferences.IncludePDCs),this.IncludeTerminatedPDC=!this.ViewModel.Preferences.ContainsKey("IncludeTerminatedPDC")||"0"!=this.ViewModel.Preferences.IncludeTerminatedPDC,this.UnPostedDocsInclude=!(!this.ViewModel.Preferences.ContainsKey("IncludeUnPostedDocs")||"1"!=this.ViewModel.Preferences.IncludeUnPostedDocs),this.UnPostedDocsList=this.UnPostedDocsInclude&&this.ViewModel.Preferences.ContainsKey("IncludeUnPostedDocsList")?this.ViewModel.Preferences.IncludeUnPostedDocsList:"",this.PrintAgeingAnalysis=!(!this.ViewModel.Preferences.ContainsKey("PrintAgeingAnalysis")||"1"!=this.ViewModel.Preferences.PrintAgeingAnalysis),this.AccountsWithOutTransactions=!(!this.ViewModel.Preferences.ContainsKey("WantAccountsWithoutTransactions")||"1"!=this.ViewModel.Preferences.WantAccountsWithoutTransactions),this.AccountsWithZeroBalance=!(!this.ViewModel.Preferences.ContainsKey("WantAccountsWithZeroBalances")||"1"!=this.ViewModel.Preferences.WantAccountsWithZeroBalances),this.PDCSeperate=!(!this.PDCInclude||!this.ViewModel.Preferences.ContainsKey("PDCsSeparately")||"1"!=this.ViewModel.Preferences.PDCsSeparately),9==this.ViewModel.StaticReportType?this.DontShowBillAdjustments=!(!this.ViewModel.Preferences.ContainsKey("DontShowBillAdjustments")||"1"!=this.ViewModel.Preferences.DontShowBillAdjustments):10==this.ViewModel.StaticReportType&&(this.HidePDCAdjustments=!(!this.ViewModel.Preferences.ContainsKey("DontShowBillAdjustments")||"1"!=this.ViewModel.Preferences.DontShowBillAdjustments),this.ClubByVoucherNo=this.ViewModel.Preferences.ContainsKey("ClubByVoucherNo")),this.FilterPDCOnMaturityDate=!(!this.ViewModel.Preferences.ContainsKey("FilterPDCOnMaturityDate")||"1"!=this.ViewModel.Preferences.FilterPDCOnMaturityDate),this.BWAgeingShowOnlyDocs=this.ViewModel.Preferences.ContainsKey("BWAgeingShowOnlyDocs"),this.BWAgeingShowOnlyDocsType=this.ViewModel.Preferences.ContainsKey("BWAgeingShowOnlyDocs")?this.ViewModel.Preferences.BWAgeingShowOnlyDocs:"",this.BWPerformance=!(!this.ViewModel.Preferences.ContainsKey("BWPerformance")||"1"!=this.ViewModel.Preferences.BWPerformance),this.PDCOnConvresionDate=!(!this.ViewModel.Preferences.ContainsKey("BWPDCOnConvresionDate")||"1"!=this.ViewModel.Preferences.BWPDCOnConvresionDate),this.FIFO=!(!this.ViewModel.Preferences.ContainsKey("FIFO")||"1"!=this.ViewModel.Preferences.FIFO),this.HideSectionSubTotal=!!this.ViewModel.Preferences.ContainsKey("HideSectionSubTotal"),this.ViewModel.Preferences.ContainsKey("IncludeBills")&&"Both"==this.ViewModel.Preferences.IncludeBills&&(this.ShowDrCrSeperately=!(!this.ViewModel.Preferences.ContainsKey("ShowRecPaySeperately")||"1"!=this.ViewModel.Preferences.ShowRecPaySeperately)),this.AllowFromDateFilter=!(!this.ViewModel.Preferences.ContainsKey("AllowFromDateFilter")||"1"!=this.ViewModel.Preferences.AllowFromDateFilter),12==this.ViewModel.StaticReportType&&(this.AdjustmentRoundOff=0),this.ViewModel.Preferences.ContainsKey("AdjustmentRoundOff")&&(this.AdjustmentRoundOff=i.e.Double(this.ViewModel.Preferences.AdjustmentRoundOff)),this.UnPostedDocsSeparately=this.ViewModel.Preferences.ContainsKey("UnPostedDocsSeparately"),this.DontApplyLocationWiseAccountsFilter=!(!this.ViewModel.Preferences.ContainsKey("DontApplyLocationWiseAccountsFilter")||"1"!=this.ViewModel.Preferences.DontApplyLocationWiseAccountsFilter),this.DontApplyLocationWiseAccountsFilter||(this.ApplyLWAccountLFilterWhenIgnoreLoc=!(!this.ViewModel.Preferences.ContainsKey("ApplyLWAccountLFilterWhenIgnoreLoc")||"1"!=this.ViewModel.Preferences.ApplyLWAccountLFilterWhenIgnoreLoc)),this.AgeingBasedOnMaturityDate=!(this.IsPaymentTermWise||!this.PDCInclude||!this.ViewModel.Preferences.ContainsKey("AgeingBasedOnMaturityDate")||"1"!=this.ViewModel.Preferences.AgeingBasedOnMaturityDate),this.UnPostedDocsInclude&&this.UnPostedDocsList.length>0&&this.UnPostedDocsSeparately){var t=this.UnPostedDocsList.split(",");new Array(t.length);for(var o=0;o<t.length;o++)"371"==t[o]?this.arrUnPostedStatuses.push(371,"Un-Approved Documents"):"376"==t[o]?this.arrUnPostedStatuses.push(376,"Cancelled Documents"):"372"==t[o]?this.arrUnPostedStatuses.push(372,"Rejected Documents"):"441"==t[o]?this.arrUnPostedStatuses.push(441,"Approved Documents"):this.arrUnPostedStatuses.push(parseInt(t[o]),"Other Status("+t[o]+") Documents");this.arrUnPostedStatuses.push(429,"Bounced Documents"),this.UnAppsDocsAdjustSeperate=!(!this.ViewModel.Preferences.ContainsKey("UnAppsDocsAdjustSeperate")||"1"!=this.ViewModel.Preferences.UnAppsDocsAdjustSeperate)}if(this.arrPDCStatus=this.PDCInclude?this.IncludeTerminatedPDC?[370,439,452]:[370,439]:[],this.CurrencyType=0,this.ForeignCurrencyID=0,this.ViewModel.Preferences.ContainsKey("ForeignCurrency")){var l=new i.f;l.LoadXml("<XML>"+this.ViewModel.Preferences.ForeignCurrency+"</XML>");var n=i.f.SelectSingleNode(l.DocumentElement,"IsChecked");null!=n&&"1"==n.innerHTML&&(n=i.f.SelectSingleNode(l.DocumentElement,"Value"),this.ForeignCurrencyID=parseInt(n.innerHTML))}else if(this.ViewModel.Preferences.ContainsKey("Currency")){var a=new i.f;a.LoadXml("<XML>"+this.ViewModel.Preferences.Currency+"</XML>"),this.CurrencyType=parseInt(i.f.SelectSingleNode(a.DocumentElement,"Type").innerHTML),1==this.CurrencyType?(i.e.IsEmpty(s.a.SessionManager.Preferences.DimensionwiseCurrency)||0==parseInt(s.a.SessionManager.Preferences.DimensionwiseCurrency))&&(this.CurrencyType=0):2==this.CurrencyType&&(this.ForeignCurrencyID=parseInt(i.f.SelectSingleNode(a.DocumentElement,"Value").innerHTML))}if(this.GroupTotalsAtEnd=!(!this.ViewModel.Preferences.ContainsKey("GroupTotalsAtEnd")||"1"!=this.ViewModel.Preferences.GroupTotalsAtEnd),this.ShowMonthWiseFromDatePicker=!(!this.ViewModel.Preferences.ContainsKey("ShowMonthWiseFromDatePicker")||"1"!=this.ViewModel.Preferences.ShowMonthWiseFromDatePicker),this.FutureSlabs=!(!this.ViewModel.Preferences.ContainsKey("ShowFutureSlabs")||"1"!=this.ViewModel.Preferences.ShowFutureSlabs),this.SlabSize=4,this.ViewModel.Preferences.ContainsKey("SlabSize")&&(this.SlabSize=i.e.Int(this.ViewModel.Preferences.SlabSize),this.SlabSize<=0&&(this.SlabSize=4)),this.ViewModel.Preferences.ContainsKey("Slabs")){var u=new i.f;u.LoadXml("<XML>"+this.ViewModel.Preferences.Slabs+"</XML>"),this.Slabs.Clear(),this.iSlabs.Clear(),this.FSlabs.Clear();for(var D=0;D<u.DocumentElement.children.length;D++)this.iSlabs.push(parseInt(u.DocumentElement.children[D].innerHTML)),this.Slabs.push(this.ViewModel.oReportDialog.ToDate.Date.AddDays(-this.iSlabs[this.iSlabs.length-1])),this.AgeingBasedOnMaturityDate&&this.cqSlabs.push(this.ViewModel.oReportDialog.ToDate.Date.AddDays(this.iSlabs[this.iSlabs.length-1])),this.FutureSlabs&&this.FSlabs.push(this.ViewModel.oReportDialog.ToDate.Date.AddDays(this.iSlabs[this.iSlabs.length-1]))}if(this.ShowMonthWise=!1,this.ViewModel.Preferences.ContainsKey("MonthWiseMonths")){var d=new i.f;d.LoadXml("<XML>"+this.ViewModel.Preferences.MonthWiseMonths+"</XML>");var C=i.f.SelectSingleNode(d.DocumentElement,"IsChecked");if(null!=C&&"1"==C.innerHTML){this.ShowMonthWise=!0,C=i.f.SelectSingleNode(d.DocumentElement,"Text"),this.CntMonths=i.e.Int(C.innerHTML),this.CntMonths<=0&&(this.ShowMonthWise=!1);var p=new Date(this.ViewModel.ToDatePicker.Date.getFullYear(),this.ViewModel.ToDatePicker.Date.getMonth(),this.ViewModel.ToDatePicker.Date.getDay());if(this.ShowMonthWiseFromDatePicker){for(var T=0;T<this.CntMonths;T++)this.MonthSlabs.push(p),this.arrMonthSlabAmounts.push(p.ToString("MMMyy"),0),this.Slabs_MMMYY.push(p.ToString("MMMyy")),p=p.AddMonths(1);this.dtMonthWiseEndData=p.AddDays(-1)}else for(var _=0;_<this.CntMonths;_++)this.MonthSlabs.InsertAt(p,0),this.arrMonthSlabAmounts.push(p.ToString("MMMyy"),0),this.Slabs_MMMYY.push(p.ToString("MMMyy")),p=p.AddMonths(-1);this.Slabs_MMMYY.push("MonthSlab"),this.arrMonthSlabAmounts.push("MonthSlab",0)}}for(var m=null,I=null,R=this.ViewModel.ColumnSource.length-1;R>=0;R--)this.ViewModel.ColumnSource[R].DataFormat.ShowDefaultSign=0,"Slab"==this.ViewModel.ColumnSource[R].ID?(m=this.ViewModel.ColumnSource[R],this.colSlabIndex=R):"MonthSlab"==this.ViewModel.ColumnSource[R].ID&&(I=this.ViewModel.ColumnSource[R],this.colMonthSlabIndex=R,this.ViewModel.ColumnSource[this.colMonthSlabIndex].HeaderAppearance.IsVisible=!!this.ShowMonthWise);this.TempCols=new Array;for(var S=0;S<this.ViewModel.ColumnSource.length;S++)this.TempCols.push(this.ViewModel.ColumnSource[S]);if(160==this.ViewModel.StaticReportType&&null!=I){I.HeaderAppearance.IsVisible=!0,this.TempCols.Remove(I);var A=I.Clone();A.HeaderText="TOTAL",A.DataAppearance.IsBold=!0,this.TempCols.push(A);var M=new Date(this.ViewModel.FromDatePicker.Date.getFullYear(),this.ViewModel.FromDatePicker.Date.getMonth(),this.ViewModel.FromDatePicker.Date.Day),g=0;do{this.MonthSlabs.push(M),this.arrMonthSlabAmounts.push(M.ToString("MMMyy"),0);var w=I.Clone();w.ID=M.ToString("MMMyy"),w.HeaderText=M.ToString("MMM-yy").toUpperCase(),this.TempCols.InsertAt(w,this.colMonthSlabIndex+g),M=M.AddMonths(1),g++}while(M<=this.ViewModel.ToDatePicker.Date)}if(-1!=this.colSlabIndex){this.Slabs.length>0&&(this.TempCols[this.colSlabIndex].HeaderText=">"+this.iSlabs[this.iSlabs.length-1]);for(var f=0;f<this.Slabs.length;f++){var E=m.Clone();E.ID=E.ID+(f+1).toString(),E.HeaderText=0==f?"0-"+(this.iSlabs[f]-1):this.iSlabs[f-1]+"-"+(this.iSlabs[f]-1),0==this.iSlabs[f]&&(E.HeaderAppearance.IsVisible=!1),this.TempCols.InsertAt(E,this.colSlabIndex+f)}if(this.FSlabs.length>0){var P=m.Clone();P.ID="F"+P.ID,P.HeaderText=">"+this.iSlabs[this.iSlabs.length-1]+" (F)",this.TempCols.Insert(this.colSlabIndex+this.Slabs.length+1,P)}for(var y=0;y<this.FSlabs.length;y++){var O=m.Clone();O.ID="F"+O.ID+(y+1).toString(),O.HeaderText=0==y?"0-"+(this.iSlabs[y]-1)+" (F)":this.iSlabs[y-1]+"-"+(this.iSlabs[y]-1)+" (F)",0==this.iSlabs[y]&&(O.HeaderAppearance.IsVisible=!1),this.TempCols.Insert(this.colSlabIndex+this.Slabs.length+y+1,O)}}else this.Slabs.Clear(),this.FSlabs.Clear();if(null==I&&(this.ShowMonthWise=!1),this.ShowMonthWise){I.HeaderText="Last Year",-1!=this.colSlabIndex&&(this.colSlabIndex<this.colMonthSlabIndex?this.colMonthSlabIndex+=this.SlabSize:this.colSlabIndex+=this.CntMonths);for(var b=0;b<this.MonthSlabs.length;b++){var N=I.Clone();N.ID=this.MonthSlabs[b].ToString("MMMyy"),N.HeaderText=this.MonthSlabs[b].ToString("MMM yyyy"),this.TempCols.Insert("ASC"==I.DataFormat.Sort?this.colMonthSlabIndex:this.colMonthSlabIndex+b+1,N)}}for(var V=this.TempCols.length-1;V>=0;V--)this.TempCols[V].DataFormat.ShowDefaultSign=0,"Amount"==this.TempCols[V].ID?this.colAmountIndex=V:"AdjustmentAmount"==this.TempCols[V].ID||"AdjAmount"==this.TempCols[V].ID?this.colAdjustedIndex=V:"Balance"==this.TempCols[V].ID?this.colBalanceIndex=V:"UnAdjusted"==this.TempCols[V].ID?this.colUnAdjustedIndex=V:"NetBalance"==this.TempCols[V].ID?this.colNetBalanceIndex=V:"BalanceCumulative"==this.TempCols[V].ID?this.colBalanceCumIndex=V:"TotalPDC"==this.TempCols[V].ID?this.colPDCIndex=V:"LOBPDC"==this.TempCols[V].ID?this.colLOBPDCIndex=V:"BalanceInclPDC"==this.TempCols[V].ID?this.colIncludingPDCIndex=V:"TotalSale"==this.TempCols[V].ID?this.colTotalSaleIndex=V:"UnDueAmount"==this.TempCols[V].ID?11==this.ViewModel.StaticReportType?this.IsDueDateWise&&(this.colUnDueIndex=V):(this.IsPaymentTermWise||this.IsDueDateWise||this.IsDocDateWise&&12==this.ViewModel.StaticReportType)&&(this.colUnDueIndex=V):"BillAmount"==this.TempCols[V].ID?this.colBillAmtIndex=V:"PrevYearSale"==this.TempCols[V].ID?this.colPrevYearSaleIndex=V:"PeriodSale"==this.TempCols[V].ID?this.colPeriodSaleIndex=V:"ReceiptsAmount"==this.TempCols[V].ID?this.colReceiptsAmtIndex=V:"ChequeBounceAmount"==this.TempCols[V].ID?this.colChqBounceAmtIndex=V:"PaidByDays"==this.TempCols[V].ID?this.colPaidByDaysIndex=V:"FutureTrDedit"==this.TempCols[V].ID?this.colFutureTrDr=V:"FutureTrCredit"==this.TempCols[V].ID?this.colFutureTrCr=V:"RefAccount"==this.TempCols[V].ID?this.colRefAccount=V:0==i.e.stringCompare(this.TempCols[V].Formula,"SNO",!0)&&(this.ViewModel.colSNoIndex=V);if(-1!=this.colBalanceIndex?this.colTempIndex=this.colBalanceIndex:-1!=this.colAmountIndex?this.colTempIndex=this.colAmountIndex:-1!=this.colAdjustedIndex?this.colTempIndex=this.colAdjustedIndex:-1!=this.colUnAdjustedIndex?this.colTempIndex=this.colUnAdjustedIndex:-1!=this.colNetBalanceIndex?this.colTempIndex=this.colNetBalanceIndex:-1!=this.colBalanceCumIndex&&(this.colTempIndex=this.colBalanceCumIndex),this.PrintAgeingAnalysis){var v;if(this.ViewModel.Preferences.ContainsKey("LOBAgeingReport")&&!i.e.IsEmpty(this.ViewModel.Preferences.LOBAgeingReport)&&(this.LOBAgeingReport=parseInt(this.ViewModel.Preferences.LOBAgeingReport)),this.ViewModel.Preferences.ContainsKey("BlankRowHeight")&&(this.BlankRowHeight=i.e.Double(this.ViewModel.Preferences.BlankRowHeight)),this.LOBAgeingReport>0){v=s.a.report.ReportDataSet("RPT022",this.ViewModel.IsReportDB,"SELECT DefaultPreferences,ReportDefnXML FROM ADM_RevenUReports with(nolock) WHERE ReportID="+this.LOBAgeingReport);try{var L=new i.f;L.LoadXml(v.Tables[0][0].ReportDefnXML.toString());for(var B=L.SelectNodes("PactRevenURpts/PactRevenURptDef/Columns/ColumnDef"),F=0;F<B.length;F++){var G=B[F],x=new h.b;x.ID=this.ViewModel.GetNodeValue(G,"Identity/ID"),x.FieldName=this.ViewModel.GetNodeValue(G,"Identity/Field"),x.HeaderText=this.ViewModel.GetNodeValue(G,"Identity/Caption"),x.HeaderAppearance=this.ViewModel.GetAppearance(G.SelectSingleNode("HeaderAppearance")),x.DataAppearance=this.ViewModel.GetAppearance(G.SelectSingleNode("DataAppearance")),x.Row=i.e.Int(this.ViewModel.GetNodeValue(G,"HeaderAppearance/Row")),x.Column=i.e.Int(this.ViewModel.GetNodeValue(G,"HeaderAppearance/Column")),null!=G.SelectSingleNode("Format")&&(x.DataFormat=this.ViewModel.GetFormat(G.SelectSingleNode("Format"))),x.ColumnType=this.ViewModel.GetNodeValue(G,"Identity/Type").toUpperCase(),x.Formula=this.ViewModel.GetNodeValue(G,"Identity/Expression");var W=this.ViewModel.GetNodeValue(G,"Identity/FormulaEvaluateAtEnd");x.EvaluateAtEnd="0"==W?0:"2"==W?2:1,x.ColumnFilterExpression=this.ViewModel.GetNodeValue(G,"Format/ColumnFilterExpression");var k=this.ViewModel.GetNodeValue(G,"Identity/UseOnce");if(x.UseOnce="1"==k?1:"2"==k?2:"-1"==k?-1:0,x.HeaderAppearance.IsVisible){if("MonthSlab"==x.ID)continue;this.LOBAgeingColumns.push(x),x.Row>0&&x.Column>=0&&(x.HeaderAppearance.IsVisible=!1),"UnDueAmount"==x.ID&&x.HeaderAppearance.IsVisible&&(this.IsPaymentTermWise||this.IsDueDateWise)&&(this.colUnDueIndex=this.LOBAgeingColumns.length)}}}catch(le){this.LOBAgeingReport=0}}else v=s.a.report.ReportDataSet("RPT022",this.ViewModel.IsReportDB,"SELECT DefaultPreferences FROM ADM_RevenUReports with(nolock) WHERE ReportID=13");var U=new i.f;U.LoadXml(v.Tables[0][0].DefaultPreferences.toString()),this.Slabs.Clear(),this.iSlabs.Clear();for(var K=i.f.SelectSingleNode(U.DocumentElement,"Slabs").childNodes,H=0;H<K.length;H++)this.iSlabs.push(parseInt(K[H].innerHTML)),this.Slabs.push(this.ViewModel.oReportDialog.ToDate.Date.AddDays(-this.iSlabs[this.iSlabs.length-1]));if(this.SlabSize=this.Slabs.length,0==this.LOBAgeingReport){var Q=new h.b;Q.ID="Balance",Q.HeaderText="Balance",Q.DataFormat=new r.b,Q.DataFormat.Commas=1,Q.DataFormat.DecimalsPoints=parseInt(s.a.SessionManager.Preferences.DecimalsinAmount),Q.DataFormat.NegativeNumber=4,Q.ColumnType="FLOAT",Q.DataAppearance=new r.a,Q.DataAppearance.Alignment="Center",this.LOBAgeingColumns.push(Q),(Q=new h.b).ID="UnAdjusted",Q.HeaderText="UnAdjusted",Q.DataFormat=new r.b,Q.DataFormat.Commas=1,Q.DataFormat.DecimalsPoints=parseInt(s.a.SessionManager.Preferences.DecimalsinAmount),Q.DataFormat.NegativeNumber=4,Q.ColumnType="FLOAT",Q.DataAppearance=new r.a,Q.DataAppearance.Alignment="Center",this.LOBAgeingColumns.push(Q),(Q=new h.b).ID="NetBalance",Q.HeaderText="NetBalance",Q.DataFormat=new r.b,Q.DataFormat.Commas=1,Q.DataFormat.DecimalsPoints=parseInt(s.a.SessionManager.Preferences.DecimalsinAmount),Q.DataFormat.NegativeNumber=4,Q.ColumnType="FLOAT",Q.DataAppearance=new r.a,Q.DataAppearance.Alignment="Center",this.LOBAgeingColumns.push(Q),(Q=new h.b).ID="Slab",Q.HeaderText="Slab",Q.DataFormat=new r.b,Q.DataFormat.Commas=1,Q.DataFormat.DecimalsPoints=parseInt(s.a.SessionManager.Preferences.DecimalsinAmount),Q.DataFormat.NegativeNumber=4,Q.ColumnType="FLOAT",Q.DataAppearance=new r.a,Q.DataAppearance.Alignment="Center",this.LOBAgeingColumns.push(Q)}var j=this.LOBAgeingColumns.find((function(e){return"Slab"==e.ID}));j&&(this.colSlabIndex=this.LOBAgeingColumns.indexOf(j)),this.Slabs.length>0&&(this.LOBAgeingColumns[this.colSlabIndex].HeaderText=">"+this.iSlabs[this.iSlabs.length-1]);for(var Y=0;Y<this.Slabs.length;Y++){var X=j.Clone();X.ID=X.ID+(Y+1).toString(),X.HeaderText=0==Y?"1-"+this.iSlabs[Y]:this.iSlabs[Y-1]+1+"-"+this.iSlabs[Y],0==this.iSlabs[Y]&&X.HeaderAppearance&&(X.HeaderAppearance.IsVisible=!1),this.LOBAgeingColumns.Insert(this.colSlabIndex+Y,X)}for(var q=this.TempCols.length;q<this.LOBAgeingColumns.length;q++){var z=this.TempCols[this.colTempIndex].Clone();z.ID="AG"+q,z.HeaderText="",this.TempCols.push(z)}}if(11==this.ViewModel.StaticReportType||12==this.ViewModel.StaticReportType){this.ViewModel.GrpReportTotal.TotalCols.Clear(),this.ViewModel.TotalCols.Clear(),this.ViewModel.lstGroup.forEach((function(e){e.TotalCols.Clear()})),this.ViewModel.GrpReportTotal.TempTotalCols.keys.forEach((function(t){var o=e.TempCols.find((function(e){return e.ID==t}));if(o){var s=e.TempCols.indexOf(o);e.ViewModel.TotalCols.Contains(t)||e.ViewModel.TotalCols.push(t),e.ViewModel.GrpReportTotal.TotalCols.push(t,s)}})),this.ViewModel.lstGroup.forEach((function(t){t.TempTotalCols.keys.forEach((function(o){var s=e.TempCols.find((function(e){return e.ID==o}));if(s){var i=e.TempCols.indexOf(s);e.ViewModel.TotalCols.Contains(o)||e.ViewModel.TotalCols.push(o),t.TotalCols.push(o,i)}}))}));for(var J=function(t){"FLOAT"==e.TempCols[t].ColumnType&&(e.TempCols[t].ID.startsWith("Slab")||e.TempCols[t].ID.startsWith("FSlab")||e.Slabs_MMMYY.Contains(e.TempCols[t].ID))&&(e.ViewModel.TotalCols.Contains(e.TempCols[t].ID)||e.ViewModel.TotalCols.push(e.TempCols[t].ID),e.ViewModel.GrpReportTotal.TotalCols.ContainsKey(e.TempCols[t].ID)||e.ViewModel.GrpReportTotal.TotalCols.push(e.TempCols[t].ID,t),e.ViewModel.lstGroup.forEach((function(o){o.TotalCols.ContainsKey(e.TempCols[t].ID)||o.TotalCols.push(e.TempCols[t].ID,t)})))},Z=0;Z<this.TempCols.length;Z++)J(Z)}this.AggTotal=i.e.NumArray(this.oColumns.length+this.Slabs.length,2),this.ViewModel.ReportColumns=this.TempCols,this.oColumns=this.ViewModel.ReportColumns,this.ViewModel.IsTotalColsAdded=!0,this.ViewModel.totals=i.e.NumArray(this.oColumns.length,this.lstGroup.length+1),this.ViewModel.CumulativeIndex=this.colBalanceCumIndex,-1!=this.colBalanceCumIndex&&(this.ViewModel.CumulativeColumn=this.oColumns[this.colBalanceCumIndex].ID+"CUMULATIVE"),-1!=this.colSlabIndex&&this.ViewModel.RefreshPostFilters();var $=this.ViewModel.oReportDialog.GetSeqNosListWithRoots();if(this.ViewModel.HideCostCenterTree||!i.e.IsEmpty($))if(9!=this.ViewModel.StaticReportType&&10!=this.ViewModel.StaticReportType||this.Adjusted||this.SemiAdjusted||this.UnAdjusted)if(160==this.ViewModel.StaticReportType){this.IsConsolidated="1"==this.ViewModel.Preferences.Consolidated,this.ShowPreviousAdjustment="1"==this.ViewModel.Preferences.ShowPreviousAdjustment,this.ShowFutureAdjustment="1"==this.ViewModel.Preferences.ShowFutureAdjustment,this.IsReceivable="Receivables"==this.ViewModel.Preferences.Bills;var ee="",te="",oe="";this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(ee=i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")");var se="StatusID=369";this.UnPostedDocsList.length>0&&this.UnPostedDocsList.split(",").forEach((function(e){se+=" or StatusID="+e})),se=" and ("+se+")",this.ViewModel.HideCostCenterTree||this.ViewModel.oReportDialog.IsZeroSelected||this.ViewModel.oReportDialog.IsOneSelected||(this.ViewModel.oReportDialog.IsGroupExists?(te="AccountID=GTP.GTID",oe=$.Contains(",")?",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID IN ("+$+") group by T.AccountID) AS GTP ":",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID="+$+" group by T.AccountID) AS GTP "):te=$.Contains(",")?"AccountID IN ("+$+")":"AccountID="+$);var ie=[];if(ie.push(this.IsReceivable),ie.push(this.IsConsolidated),ie.push(this.ShowPreviousAdjustment&&this.ShowFutureAdjustment?3:this.ShowFutureAdjustment?2:this.ShowPreviousAdjustment?1:0),ie.push(this.ViewModel.oReportDialog.FromDate.Date),ie.push(this.ViewModel.oReportDialog.ToDate.Date),ie.push(oe),ie.push(te),ie.push(se),ie.push(ee+this.GetDimensionFilter("B.dcCCNID")),ie.push(this.PDCInclude),ie.push(this.IncludeTerminatedPDC),ie.push(this.PDCOnConvresionDate),ie.push(this.ViewModel.Preferences.Date),ie.push(s.a.SessionManager.LanguageID),this.dsMain=s.a.report.GetARALAnalysis(ie,this.ViewModel.IsReportDB),this.dvAmt=this.dvAmtTable=this.dsMain.Tables[0],this.dvUnAdj=this.dvUnAdjTable=this.dsMain.Tables[1],this.dvCollect=this.dvCollectTable=this.dsMain.Tables[2],this.IsConsolidated)this.AddARAPRowSet();else{for(this.i=0;this.i<this.dsMain.Tables[3].length;this.i++)this.drMainRow=this.dsMain.Tables[3][this.i],this.dvAmt=this.dvAmtTable.filter((function(t){return t.AccountID==e.drMainRow.AccountID.toString()})),this.dvUnAdj=this.dvUnAdjTable.filter((function(t){return t.AccountID==e.drMainRow.AccountID.toString()})),this.dvCollect=this.dvCollectTable.filter((function(t){return t.AccountID==e.drMainRow.AccountID.toString()})),(this.dvAmt.length>0||this.dvUnAdj.length>0||this.dvCollect.length>0)&&this.AddARAPRowSet();this.dsMain.Tables[3].length>1&&(this.row=this.NewReportRow_2(r.f.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance_Data),this.row.LevelNo=0,this.row.Cells[0].Text=s.a.GetResource("Reports_ReportTotal"),this.row.Cells[0].CellAppearance.Alignment="Left",this.i=0,this.arrMonthSlabAmounts.forEach((function(t){e.ViewModel.SetCellValue(t.Value,e.oColumns[e.colMonthSlabIndex+e.i].DataFormat,"FLOAT",e.row.Cells[e.colMonthSlabIndex+e.i]),e.i++})),this.ViewModel.addRow(this.row))}}else this.dsMain=null,this.GetDataSet(this.ViewModel.StaticReportType,$).then((function(t){if(t&&(e.dsMain=t,e.GroupByDocNo&&(e.dsMain.Columns[0].Contains("DocNo")?e.GroupbyDocNo(e.dsMain.Tables[0],"DocNo",e.dsMain.Columns[0]):e.dsMain.Columns[0].Contains("VoucherNo")&&e.GroupbyDocNo(e.dsMain.Tables[0],"VoucherNo",e.dsMain.Columns[0]),e.dsMain.Tables.length>1&&e.dsMain.Columns[0].Contains("DocNo")&&e.dsMain.Columns[1].Contains("RefDocNo")&&e.GroupbyDocNo(e.dsMain.Tables[1],"DocNo~RefDocNo",e.dsMain.Columns[1]))),e.dv=e.dvTable=e.dsMain.Tables[0],12==e.ViewModel.StaticReportType&&(-1!=e.colFutureTrDr||-1!=e.colFutureTrCr)){var o=e.ViewModel.BaseReportColumns.find((function(e){return"FutureTrDedit"==e.ID})),l=e.ViewModel.BaseReportColumns.find((function(e){return"FutureTrCredit"==e.ID})),n=null==o||i.e.IsEmpty(o.CDGDO.ExecutedDocument)?"":o.CDGDO.ExecutedDocument,a=null==l||i.e.IsEmpty(l.CDGDO.ExecutedDocument)?"":l.CDGDO.ExecutedDocument,r=null,h=null;if(-1!=e.colFutureTrDr&&-1!=e.colFutureTrCr)if(n==a){var u=e.GetFutureTransactionDrCrQuery(n,0);r=s.a.report.ReportDataSet("RPT022",e.ViewModel.IsReportDB,u),h=r}else{var D=e.GetFutureTransactionDrCrQuery(n,1);r=s.a.report.ReportDataSet("RPT022",e.ViewModel.IsReportDB,D),D=e.GetFutureTransactionDrCrQuery(a,2),h=s.a.report.ReportDataSet("RPT022",e.ViewModel.IsReportDB,D)}else if(-1!=e.colFutureTrDr){var d=e.GetFutureTransactionDrCrQuery(n,1);r=s.a.report.ReportDataSet("RPT022",e.ViewModel.IsReportDB,d)}else if(-1!=e.colFutureTrCr){var C=e.GetFutureTransactionDrCrQuery(a,2);h=s.a.report.ReportDataSet("RPT022",e.ViewModel.IsReportDB,C)}-1!=e.colFutureTrDr&&e.dsMain.Columns[0].push("FutureTrDedit"),-1!=e.colFutureTrCr&&e.dsMain.Columns[0].push("FutureTrCredit");var p=null;e.dsMain.Tables[0].forEach((function(t){-1!=e.colFutureTrDr&&((p=r.Tables[0].filter((function(e){return e.AccountID==t.AccountID}))).length>0&&(t.FutureTrDedit=p[0].Dr)),-1!=e.colFutureTrCr&&(h!=r&&(p=h.Tables[0].filter((function(e){return e.AccountID==t.AccountID}))),p.length>0&&(t.FutureTrCredit=p[0].Cr))}))}if(!e.PrintAgeingAnalysis||9!=e.ViewModel.StaticReportType&&10!=e.ViewModel.StaticReportType)e.BWCallBack();else{if(e.ViewModel.SelectTag=e.ViewModel.FromTag="",!i.e.IsEmpty(e.lstGroup[0].Formula)&&"AccountName"==e.lstGroup[0].ID){var T=e.ViewModel.StaticReportType;e.ViewModel.StaticReportType=12,e.ViewModel.SetQueryXMLTags(),e.ViewModel.StaticReportType=T}var _=e.colPDCIndex,m=e.LOBAgeingColumns.find((function(t){return"TotalPDC"==t.ID||"BalanceInclPDC"==e.TempCols[e.i].ID}));m&&(e.colLOBAgeingPDCIndex=e.LOBAgeingColumns.indexOf(m)),e.colPDCIndex=e.colLOBAgeingPDCIndex,e.GetDataSet(12,$).then((function(t){e.dsSubAgeing=t,e.ViewModel.SubTotalCallBack=new c.b,e.ViewModel.SubTotalCallBack.Subscribe(e,"AddAgeingData"),e.colPDCIndex=_,e.BWCallBack()}),(function(t){e.ViewModel.process_RunWorkerCompleted(),e.ViewModel.DisplayMessage="Error",console.log(t)}))}}),(function(t){e.ViewModel.process_RunWorkerCompleted(),e.ViewModel.DisplayMessage="Error",console.log(t)}));else this.ViewModel.process_RunWorkerCompleted();else this.ViewModel.process_RunWorkerCompleted()}},{key:"BWCallBack",value:function(){var e=this;if(9==this.ViewModel.StaticReportType||10==this.ViewModel.StaticReportType){if(9==this.ViewModel.StaticReportType)this.dvChild=this.dvChildTable=this.dsMain.Tables[1];else if(this.UnAppsDocsAdjustSeperate)for(var t,o,s=0;s<this.dsMain.Tables[0].length;s++){t=this.dsMain.Tables[0][s];for(var l=s+1;l<this.dsMain.Tables[0].length;l++)o=this.dsMain.Tables[0][l],1!=parseInt(o.IsUnappAdj)||parseInt(o.AccountID)!=parseInt(t.AccountID)||o.DocNo.toString()!=t.DocNo.toString()||this.ClubByVoucherNo&&o.Narration.toString()!=t.Narration.toString()||(t.Amount=parseFloat(t.Amount)+parseFloat(o.Amount),this.dsMain.Tables[0].RemoveAt(l),l--)}if(this.dsMain.Columns[0].push("Debit"),this.dsMain.Columns[0].push("Credit"),this.dsMain.Columns[0].Contains("Balance")||this.dsMain.Columns[0].push("Balance"),-1!=this.colBalanceCumIndex&&this.dsMain.Columns[0].push(this.oColumns[this.colBalanceCumIndex].ID+"CUMULATIVE"),this.ViewModel.SubTotalBeforeCallBack=new c.b,this.ViewModel.SubTotalBeforeCallBack.Subscribe(this,"LOBSubTotalCallBack"),!this.FIFO&&("Receivables"==this.ViewModel.Preferences.IncludeBills||"Payables"==this.ViewModel.Preferences.IncludeBills)){var n,a,r="Receivables"==this.ViewModel.Preferences.IncludeBills,h="",u=0,D=0,d=new Array,C=new Array;for(this.i=this.dsMain.Tables[0].length-1;this.i>=0;this.i--)h!=(a=this.dsMain.Tables[0][this.i]).AccountID.toString()&&(h.length>0&&((r||u+D>=0)&&(C.forEach((function(t){e.dsMain.Tables[0].Remove(t)})),0!=D&&u+D>0&&this.lstRecPayUnadjusted.push(parseInt(h),D)),(!r||u+D<=0)&&(d.forEach((function(t){e.dsMain.Tables[0].Remove(t)})),0!=u&&u+D<0&&this.lstRecPayUnadjusted.push(parseInt(h),u))),u=0,D=0,h=a.AccountID.toString(),d.Clear(),C.Clear()),this.dblAmount=parseFloat(a.Amount),0!=(n=null==this.dsMain.Tables[0][this.i].Adjusted?0:parseFloat(this.dsMain.Tables[0][this.i].Adjusted))?(this.dblBalance=this.dblAmount+n,this.dblAmount>=0?this.dblBalance<0&&(this.dblBalance=0):this.dblBalance>0&&(this.dblBalance=0)):this.dblBalance=this.dblAmount,this.dblAmount>=0?(u+=this.dblBalance,d.push(a)):(D+=this.dblBalance,C.push(a));h.length>0&&((r||u+D>=0)&&(C.forEach((function(t){e.dsMain.Tables[0].Remove(t)})),0!=D&&u+D>0&&this.lstRecPayUnadjusted.push(parseInt(h),D)),(!r||u+D<=0)&&(d.forEach((function(t){e.dsMain.Tables[0].Remove(t)})),0!=u&&u+D<0&&this.lstRecPayUnadjusted.push(parseInt(h),u)))}for(this.ViewModel.ReportData=this.dsMain.Tables[0],this.ViewModel.ReportDataColumns=this.dsMain.Columns[0],this.ViewModel.ConstructFormulaFields(!0),this.PrintAgeingAnalysis&&null!=this.dsSubAgeing&&(i.e.IsEmpty(this.lstGroup[0].Formula)||"AccountName"!=this.lstGroup[0].ID||this.dsSubAgeing.Tables[0].forEach((function(t){e.ViewModel.CalculateFormula_2(e.lstGroup[0],t)}))),this.dvPDCSeperate=this.dvPDCSeperateTable=this.dsMain.Tables[0],(this.PDCSeperate||this.UnPostedDocsInclude&&this.UnPostedDocsSeparately)&&(this.tempTotals=new Array(this.oColumns.length).fill(0),this.tempHiddenTotals=new Array(this.ViewModel.HiddenNumericColumns.length).fill(0),this.colHiddenAdjustedIndex=this.ViewModel.HiddenNumericColumns.indexOf(this.ViewModel.HiddenNumericColumns.find((function(e){return"AdjAmount"==e.ID})))),this.ClubByVoucherNo&&function(){e.dsMain.Columns[0].push("RType");var t,o,s,i=null,l=new Array,n=!1;t=null,o=null;for(var a=1;a<e.dsMain.Tables[0].length;a++)if(t=e.dsMain.Tables[0][a-1],o=e.dsMain.Tables[0][a],n=!1,parseInt(t.AccountID)==parseInt(o.AccountID)&&t.DocNo.toString()==o.DocNo.toString()&&(n=!0),!n&&null==i&&e.IsDocDateWise&&((s=t.Narration.toString()).length>0&&s.Contains("/")&&(i=null,o=t,n=!0)),n){if(null==i){i=e.dsMain.Tables[0].NewRow();for(var r=0;r<e.dsMain.Columns[0].length;r++)i[r]=t[r];i.RType=1,t.RType=2,e.IsDocDateWise&&(i.Adjusted=t.AdjustedBillAmount,i.Amount=t.BillAmount),e.dsMain.Tables[0].InsertAt(i,a-1),a++}o==t?i=null:(o.RType=2,l.forEach((function(e){null==i[e]?i[e]=o[e]:null!=o[e]&&(i[e]=parseFloat(i[e])+parseFloat(o[e]))})))}else i=null;if(e.dsMain.Tables[0].length>0&&(o=e.dsMain.Tables[0][e.dsMain.Tables[0].length-1],e.dsMain.Tables[0].length>1&&(t=e.dsMain.Tables[0][e.dsMain.Tables[0].length-2]),(1==e.dsMain.Tables[0].length||parseInt(t.AccountID)!=parseInt(o.AccountID)||t.DocNo.toString()!=o.DocNo.toString())&&((s=(t=o).Narration.toString()).length>0&&s.Contains("/")))){i=e.dsMain.Tables[0].NewRow();for(var h=0;h<e.dsMain.Columns[0].length;h++)i[h]=t[h];i.RType=1,t.RType=2,e.IsDocDateWise&&(i.Adjusted=t.AdjustedBillAmount,i.Amount=t.BillAmount),e.dsMain.Tables[0].InsertAt(i,e.dsMain.Tables[0].length-1)}}(),this.iMainRow=0;this.iMainRow<this.dv.length;this.iMainRow++){if(this.ViewModel.process.CancellationPending)return void(this.ViewModel.processArgs.Cancel=!0);this.drMainRow=this.dv[this.iMainRow],-1!=this.colPaidByDaysIndex&&1==this.ViewModel.lstGroup.length&&this.ViewModel.Groupstr[this.lstGroup[0].ID]!=this.drMainRow[this.lstGroup[0].ID].toString()&&(0!=this.AggTotal[this.colPaidByDaysIndex][1]&&(this.dblPaidDaysTotal+=this.ViewModel.totals[this.colPaidByDaysIndex][1],this.ViewModel.totals[this.colPaidByDaysIndex][1]/=this.AggTotal[this.colPaidByDaysIndex][1],this.AggTotal[this.colPaidByDaysIndex][0]+=this.AggTotal[this.colPaidByDaysIndex][1]),this.AggTotal[this.colPaidByDaysIndex][1]=0),this.ViewModel.AddGroupRows(this.dv,this.iMainRow),this.addRows()}if(-1!=this.colPaidByDaysIndex&&1==this.ViewModel.lstGroup.length&&0!=this.AggTotal[this.colPaidByDaysIndex][1]&&(this.dblPaidDaysTotal+=this.ViewModel.totals[this.colPaidByDaysIndex][1],this.ViewModel.totals[this.colPaidByDaysIndex][1]/=this.AggTotal[this.colPaidByDaysIndex][1],this.AggTotal[this.colPaidByDaysIndex][0]+=this.AggTotal[this.colPaidByDaysIndex][1]),-1!=this.colBalanceCumIndex)for(var p=0;p<this.lstGroup.length;p++)this.ViewModel.totals[this.colBalanceCumIndex][p]=0;this.ViewModel.CheckAndAddTotals(this.dsMain.Tables[0]),-1!=this.colPaidByDaysIndex&&this.ViewModel.GrpReportTotal.SubTotalAppearance.IsVisible&&this.AggTotal[this.colPaidByDaysIndex][0]>0&&(this.ViewModel.totals[this.colPaidByDaysIndex][0]=this.dblPaidDaysTotal/this.AggTotal[this.colPaidByDaysIndex][0],this.ViewModel.SetCellValue(this.ViewModel.totals[this.colPaidByDaysIndex][0],this.oColumns[this.colPaidByDaysIndex].DataFormat,"FLOAT",this.ViewModel.Data[this.ViewModel.Data.length-1].Cells[this.colPaidByDaysIndex]))}else 11==this.ViewModel.StaticReportType?(this.ViewModel.ReportData=this.dsMain.Tables[0],this.ViewModel.ReportDataColumns=this.dsMain.Columns[0],this.ViewModel.ConstructFormulaFields(!0),this.ViewModel.FormulasCalculated=!1,this.addBillWiseAgeing(),this.ViewModel.FormulasCalculated=!0):12==this.ViewModel.StaticReportType&&(this.ViewModel.ReportData=this.dsMain.Tables[0],this.ViewModel.ReportDataColumns=this.dsMain.Columns[0],this.ViewModel.ConstructFormulaFields(!0),this.ViewModel.FormulasCalculated=!1,this.ShowLevelTree||(this.GroupTotalsAtEnd=!1),this.lstGroup.length<=1?this.AddRow_AgeingAnalysis():this.AddRow_AgeingAnalysisWithGroups(),this.ViewModel.FormulasCalculated=!0);this.ViewModel.process_RunWorkerCompleted()}},{key:"GroupbyDocNo",value:function(e,t,o){for(var s=new Array,i=function(i){s.Contains(e[i])||function(){var l=0,n=0,a=0,r=0,h=0,u=t.split("~"),c=e;if(u.length>0)for(var D=function(t){c=c.filter((function(o){return o[u[t]]=e[i][u[t]].toString()}))},d=0;d<u.length;d++)D(d);if(c.length>1){for(var C=1;C<c.length;C++)o.Contains("Amount")&&""!=c[C].Amount.toString()&&(l+=parseFloat(c[C].Amount.toString())),o.Contains("BillAmount")&&""!=c[C].BillAmount.toString()&&(n+=parseFloat(c[C].BillAmount.toString())),o.Contains("Adjusted")&&""!=c[C].Adjusted.toString()&&(a+=parseFloat(c[C].Adjusted.toString())),o.Contains("AdjAmount")&&""!=c[C].AdjAmount.toString()&&(r+=parseFloat(c[C].AdjAmount.toString())),o.Contains("Paid")&&""!=c[C].Paid.toString()&&(h+=parseFloat(c[C].Paid.toString())),s.push(c[C]);o.Contains("Amount")&&(c[0].Amount=""!=c[0].Amount.toString()?parseFloat(c[0].Amount.toString())+l:l),o.Contains("BillAmount")&&(c[0].BillAmount=""!=c[0].BillAmount.toString()?parseFloat(c[0].BillAmount.toString())+n:n),o.Contains("Adjusted")&&(c[0].Adjusted=""!=c[0].Adjusted.toString()?parseFloat(c[0].Adjusted.toString())+a:a),o.Contains("AdjAmount")&&(c[0].AdjAmount=""!=c[0].AdjAmount.toString()?parseFloat(c[0].AdjAmount.toString())+r:r),o.Contains("Paid")&&(c[0].Paid=""!=c[0].Paid.toString()?parseFloat(c[0].Paid.toString())+h:h)}}()},l=0;l<e.length;l++)i(l);for(var n=0;n<s.length;n++)e.Remove(s[n])}},{key:"LoadReportWithPostFilters",value:function(e){if(this.GrdRow=-1,this.dblBalanceCum=0,this.dblPaidDaysTotal=0,this.AggTotal=i.e.NumArray(this.oColumns.length+this.Slabs.length,2),this.ViewModel.totals=i.e.NumArray(this.oColumns.length,this.lstGroup.length+1),this.ViewModel.ClearRows(),this.ViewModel.lstGroupIndex.Clear(),null!=this.dsMain){if(this.dv=D.a.FilterData(this.dvTable,this.ViewModel.PostDataFetchFilterFields),9==this.ViewModel.StaticReportType||10==this.ViewModel.StaticReportType){for(9==this.ViewModel.StaticReportType&&(this.dvChild=this.dvChildTable=this.dsMain.Tables[1]),this.iMainRow=0;this.iMainRow<this.dv.length;this.iMainRow++)this.drMainRow=this.dv[this.iMainRow],this.ViewModel.AddGroupRows(this.dv,this.iMainRow),this.addRows();this.ViewModel.CheckAndAddTotals(this.dv)}else 11==this.ViewModel.StaticReportType?this.addBillWiseAgeing():12==this.ViewModel.StaticReportType&&(this.dsMain.Columns[0].Contains("TotalPDC")&&this.dsMain.Tables[0].map((function(e){return e.TotalPDC=0})),0==this.lstGroup.length?this.AddRow_AgeingAnalysis():this.AddRow_AgeingAnalysisWithGroups());this.ViewModel.process_RunWorkerCompleted()}}},{key:"GetDataSet",value:function(e,t){var o=this;if(this.FIFO)return this.GetDataSetFIFO(e,t);if(this.BWPerformance)return this.GetDataSetNew(e,t);var l,n,a,r,h,c,D="",d="",C="",p="",T="",_="";h=0!=this.oColumns.filter((function(e){return"BillNo"==e.ID})).length,c=0!=this.oColumns.filter((function(e){return"BillDate"==e.ID})).length;var m="";this.UnPostedDocsList.length>0&&this.UnPostedDocsList.split(",").forEach((function(e){p+=" or StatusID="+e}));var I="(StatusID=370 OR StatusID=439"+p+(this.IncludeTerminatedPDC?" OR StatusID=452":"")+")";p=" and (StatusID=369 or StatusID=429"+p+")";var R=this.GetAccountWiseLocationWhere("A"),S=this.GetDimensionFilter("B.dcCCNID"),A=!1;this.ViewModel.HideCostCenterTree||this.ViewModel.oReportDialog.IsZeroSelected||this.ViewModel.oReportDialog.IsOneSelected||(A=!0,this.ViewModel.oReportDialog.IsGroupExists?(C="AccountID=GTP.GTID",d=t.Contains(",")?",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID IN ("+t+") group by T.AccountID) AS GTP ":",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID="+t+" group by T.AccountID) AS GTP "):C=t.Contains(",")?"AccountID IN ("+t+")":"AccountID="+t),this.ForeignCurrencyID>0?(n="B.AmountFC",a="CB.AmountFC",l="AmountFC",r="/B.AdjExchRT"):(1==this.CurrencyType?(l="isnull(AmountBC,0)",n="isnull(B.AmountBC,0)",a="isnull(CB.AmountBC,0)"):(l="AdjAmount",n="B.AdjAmount",a="CB.AdjAmount"),r=""),m=this.GetAccountTypeWhere("A"),this.sbSubQuery="",this.GroupRowsCount=0;var M="",g="";if(this.strOrder="",this.ViewModel.ReportGroups.forEach((function(t){2==t.CDGDO.ColumnCostCenterID?(M+="A."+t.CDGDO.Column+" AS "+t.ID+",A.AccountID AS "+t.ID+"_ID,","1"!=t.ShowAsColumn.SelectedValue&&(o.AccountGroupIndex=o.GroupRowsCount),!o.ViewModel.Preferences.ContainsKey("TreeSortOn")||9!=e&&10!=e||("Code"==o.ViewModel.Preferences.TreeSortOn?(M+="A.AccountCode AccOrder,",o.strOrder+="AccOrder,"):"TreeOrder"==o.ViewModel.Preferences.TreeSortOn&&(M+="A.lft AccOrder,",o.strOrder+="AccOrder,"))):t.CDGDO.ColumnCostCenterID>5e4&&400==t.CDGDO.CategoryValue&&(t.CDGDO.ParentTableAlias="C"+t.CDGDO.ColumnCostCenterID,M+=t.CDGDO.ParentTableAlias+"."+t.CDGDO.Column+" AS "+t.ID+","+t.CDGDO.ParentTableAlias+".NodeID AS "+t.ID+"_ID,",11!=o.ViewModel.StaticReportType&&12!=o.ViewModel.StaticReportType&&50002==t.CDGDO.ColumnCostCenterID||(g+=" INNER JOIN "+t.CDGDO.ParentCostCenterSysName+" AS "+t.CDGDO.ParentTableAlias,g+=" WITH(NOLOCK) ON "+t.CDGDO.ParentTableAlias+".NodeID=B."+t.CDGDO.ParentColumn)),o.strOrder+=t.ID+",","1"!=t.ShowAsColumn.SelectedValue&&o.GroupRowsCount++})),h||c){var w=s.a.report.ReportDataTable("RPT022",this.ViewModel.IsReportDB,"select CostCenterID from ADM_CostCenterDef where SysColumnName='BillNo' and IsVisible=1 and SysTableName='ACC_DocDetails'");h&&(T=null!=w&&w.length>0&&i.e.hasprop(w[0],"CostCenterID")&&!Object(u.isUndefined)(w[0].CostCenterID)?",case when B.DocType=16 then (SELECT TOP 1 BillNo FROM ACC_DocDetails WITH(NOLOCK) WHERE B.DocNo=VoucherNo and B.DocSeqNo=DocSeqNo) else (SELECT TOP 1 BillNo FROM INV_DocDetails WITH(NOLOCK) WHERE B.DocNo=VoucherNo) end BillNo":",(SELECT TOP 1 BillNo FROM INV_DocDetails WITH(NOLOCK) WHERE B.DocNo=VoucherNo) BillNo"),c&&(_=null!=w&&w.length>0&&i.e.hasprop(w[0],"CostCenterID")&&!Object(u.isUndefined)(w[0].CostCenterID)?",case when B.DocType=16 then (SELECT TOP 1 CONVERT(DATETIME, BillDate) FROM ACC_DocDetails WITH(NOLOCK) WHERE B.DocNo=VoucherNo and B.DocSeqNo=DocSeqNo) else (SELECT TOP 1 CONVERT(DATETIME, BillDate) FROM INV_DocDetails WITH(NOLOCK) WHERE B.DocNo=VoucherNo) end BillDate":",(SELECT TOP 1 CONVERT(DATETIME, BillDate) FROM INV_DocDetails WITH(NOLOCK) WHERE B.DocNo=VoucherNo) BillDate")}if(9==e||10==e){var f="";f=this.PDCInclude?this.HidePDCAdjustments||!this.PDCSeperate&&!this.FilterPDCOnMaturityDate?" AND  ((SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo and "+I+")=1 OR (DocType<>14 AND DocType<>19 AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo"+p+")=1))":" AND  (DocType<>14 AND DocType<>19 AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo"+p+")=1)":" AND  DocType<>14 AND DocType<>19 AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo"+p+")=1",this.sbSubQuery+="DECLARE @To FLOAT\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",this.AllowFromDateFilter&&(this.sbSubQuery+="\ndeclare @From float SET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))"),this.sbSubQuery+="\nSELECT *,case when Amount>0 then 1 else 0 end AmtOrder FROM (",this.IsPaymentTermWise?(this.sbSubQuery+="\tSELECT A.AccountID,B.DocSeqNo,"+M+"\nCASE WHEN EXISTS (select * from COM_DocPayTerms WITH(NOLOCK) where VoucherNo=B.DocNo)\nTHEN (select CONVERT(DATETIME,max(DueDate)) from COM_DocPayTerms WITH(NOLOCK) where VoucherNo=B.DocNo and DueDate<=@To)\nELSE CONVERT(DATETIME,ISNULL(B.DocDueDate,B.DocDate)) END DocDate, \nCONVERT(DATETIME,B.DocDueDate) DueDate,CONVERT(DATETIME,B.DocDate) VoucherDate,B.DocNo,\nCASE WHEN EXISTS (select * from COM_DocPayTerms WITH(NOLOCK) where VoucherNo=B.DocNo)\nTHEN (select sum(amount)*sign(B.AdjAmount)"+r+" from COM_DocPayTerms WITH(NOLOCK) where VoucherNo=B.DocNo and DueDate<=@To)\nELSE "+l+" END Amount,\n"+l+" BillAmount",h&&(this.sbSubQuery+=T),c&&(this.sbSubQuery+=_),this.sbSubQuery+=",C50002.Name AS Location,    \n(SELECT SUM("+l+") Adjusted FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND ",this.sbSubQuery+=this.PDCOnConvresionDate?"isnull(CB.ConvertedDate,CB.DocDate)<=@To":"CB.DocDate<=@To",this.sbSubQuery+=" AND CB.AccountID=B.AccountID AND CB.RefDocNo=B.DocNo"+f+" AND CB.RefDocSeqNo=B.DocSeqNo)",this.sbSubQuery+=" Adjusted"+this.ViewModel.SelectTag+"\n,(B.DocDueDate-B.DocDate) CreditDays\n,@To-(CASE WHEN EXISTS (select * from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo)\nTHEN (select max(DueDate) from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo and DueDate<=@To)\nELSE B.DocDueDate END) OverDue\n,DocType,(SELECT TOP 1 ACC.StatusID FROM ACC_DocDetails ACC with(nolock) WHERE ACC.VoucherNo=B.DocNo) StatusID",this.ClubByVoucherNo&&(this.sbSubQuery+=",B.Narration"),this.UnAppsDocsAdjustSeperate&&(this.sbSubQuery+=",0 IsUnappAdj"),this.PDCSeperate&&(this.sbSubQuery+=",case when DocType=14 or DocType=19 then 1 else 0 end IsPDC,null AgainstVoucher"),-1!=this.colLOBPDCIndex&&(this.sbSubQuery+=",(SELECT abs(SUM("+a+")) FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@To AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo and "+I+")=1)  LOBPDC"),this.sbSubQuery+=" \nFROM COM_Billwise B with(nolock) INNER JOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID     \nINNER JOIN COM_Location AS C50002 ON B.dcCCNID2 = C50002.NodeID ",this.ViewModel.SelectTag.length>0&&this.ViewModel.SelectTag.Contains("AT.AccountType")&&(this.sbSubQuery+=" INNER JOIN ACC_ACCOUNTTYPES AT WITH(NOLOCK) ON AT.AccountTypeID=A.AccountTypeID "),this.sbSubQuery+=g+this.ViewModel.FromTag,A&&(this.sbSubQuery+=d),this.sbSubQuery+=" WHERE B.IsNewReference=1 "):(this.sbSubQuery+="\tSELECT A.AccountID,B.DocSeqNo,"+M,this.sbSubQuery+=this.GetDateColumn("B",""),this.sbSubQuery+=",CONVERT(DATETIME,B.DocDueDate) DueDate,CONVERT(DATETIME,B.DocDate) VoucherDate,B.DocNo,\n"+l+" Amount,",this.ClubByVoucherNo?(this.sbSubQuery+="(select sum("+l+") from COM_Billwise CB with(nolock) where CB.AccountID=B.AccountID AND CB.DocNo=B.DocNo and IsNewReference=1) BillAmount",this.sbSubQuery+=",(SELECT SUM("+l+") Adjusted FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND ",this.sbSubQuery+=this.PDCOnConvresionDate?"isnull(CB.ConvertedDate,CB.DocDate)<=@To":"CB.DocDate<=@To",this.sbSubQuery+=" AND CB.AccountID=B.AccountID AND CB.RefDocNo=B.DocNo"+f+")",this.UnAppsDocsAdjustSeperate&&(this.sbSubQuery+="+(case when ((B.DocType>=14 and B.DocType<=23) or B.DocType=28 or B.DocType=29) and B.StatusID=371 then AdjAmount else isnull((SELECT -SUM(AdjAmount) Adjusted \nFROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND isnull(CB.ConvertedDate,CB.DocDate)<=@To AND CB.AccountID=B.AccountID AND CB.RefDocNo=B.DocNo\nand CB.StatusID=371 and ((CB.DocType>=14 and CB.DocType<=23) or CB.DocType=28 or CB.DocType=29)),0)\nend)"),this.sbSubQuery+=" AdjustedBillAmount"):this.sbSubQuery+=l+" BillAmount",h&&(this.sbSubQuery+=T),c&&(this.sbSubQuery+=_),this.sbSubQuery+=",C50002.Name AS Location,    \n(SELECT SUM("+l+") Adjusted FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND ",this.sbSubQuery+=this.PDCOnConvresionDate?"isnull(CB.ConvertedDate,CB.DocDate)<=@To":"CB.DocDate<=@To",this.sbSubQuery+=" AND CB.AccountID=B.AccountID AND CB.RefDocNo=B.DocNo"+f+" AND CB.RefDocSeqNo=B.DocSeqNo)",this.UnAppsDocsAdjustSeperate&&(this.sbSubQuery+="+(case when ((B.DocType>=14 and B.DocType<=23) or B.DocType=28 or B.DocType=29) and B.StatusID=371 then AdjAmount else isnull((SELECT -SUM(AdjAmount) Adjusted \nFROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND isnull(CB.ConvertedDate,CB.DocDate)<=@To AND CB.AccountID=B.AccountID AND CB.RefDocNo=B.DocNo and CB.RefDocSeqNo=B.DocSeqNo\nand CB.StatusID=371 and ((CB.DocType>=14 and CB.DocType<=23) or CB.DocType=28 or CB.DocType=29)),0)\nend)"),this.sbSubQuery+=" Adjusted"+this.ViewModel.SelectTag+",(B.DocDueDate-B.DocDate) CreditDays\n,@To-B."+this.ViewModel.Preferences.Date+" OverDue\n,DocType,(SELECT TOP 1 ACC.StatusID FROM ACC_DocDetails ACC with(nolock) WHERE ACC.VoucherNo=B.DocNo) StatusID",this.ClubByVoucherNo&&(this.sbSubQuery+=",B.Narration"),this.UnAppsDocsAdjustSeperate&&(this.sbSubQuery+=",0 IsUnappAdj"),this.PDCSeperate&&(this.sbSubQuery+=",case when DocType=14 or DocType=19 then 1 else 0 end IsPDC,null AgainstVoucher"),-1!=this.colLOBPDCIndex&&(this.sbSubQuery+=",(SELECT abs(SUM("+a+")) FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@To AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo and "+I+")=1)  LOBPDC"),this.sbSubQuery+=" \nFROM COM_Billwise B with(nolock) INNER JOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID     \nINNER JOIN COM_Location AS C50002 with(nolock) ON B.dcCCNID2 = C50002.NodeID ",this.ViewModel.SelectTag.length>0&&this.ViewModel.SelectTag.Contains("AT.AccountType")&&(this.sbSubQuery+=" INNER JOIN ACC_ACCOUNTTYPES AT WITH(NOLOCK) ON AT.AccountTypeID=A.AccountTypeID "),this.sbSubQuery+=g+this.ViewModel.FromTag,A&&(this.sbSubQuery+=d),this.sbSubQuery+=" WHERE B.IsNewReference=1",this.sbSubQuery+=this.GetDateColumn("B","@To"));var E="";E+=S,A&&(E+=" AND A."+C),E+=R,E+=m,this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?E+=" AND 1<>1":E+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),this.ForeignCurrencyID>0&&(E+=" AND B.AdjCurrID="+this.ForeignCurrencyID),E+=this.GetDocumentTypeFilter(),this.sbSubQuery+=E.toString(),this.sbSubQuery+=" ) AS T ";var P="";if(this.UnAdjusted&&(P="Adjusted IS NULL"),this.SemiAdjusted&&(P.length>0&&(P+=" OR "),P+="abs(Amount+Adjusted)>"+this.AdjustmentRoundOff),this.Adjusted&&(P.length>0&&(P+=" OR "),P+="abs(Amount+Adjusted)<"+this.AdjustmentRoundOff),this.UnAppsDocsAdjustSeperate&&(P+=" or StatusID=371"),P="("+P+")",this.IsPaymentTermWise&&(P+=" AND DocDate<=@To AND Amount IS NOT NULL"),(P+=this.PDCInclude?this.PDCSeperate||this.FilterPDCOnMaturityDate?" AND (DocType<>14 AND DocType<>19"+p+")":" AND ("+I+" OR (DocType<>14 AND DocType<>19"+p+"))":" AND DocType<>14 AND DocType<>19"+p).length>0&&(this.sbSubQuery+=" WHERE "+P),this.PDCSeperate||this.FilterPDCOnMaturityDate){var y,O="PaymentTerm"==this.ViewModel.Preferences.Date?"B.DocDate":"B."+this.ViewModel.Preferences.Date;this.FilterPDCOnMaturityDate?(y="CM.ChequeMaturityDate",O="CM.ChequeMaturityDate"):y=O,this.sbSubQuery+="\nUNION ALL  SELECT *,case when Amount>0 then 1 else 0 end AmtOrder FROM (",this.sbSubQuery+="\tSELECT A.AccountID,B.DocSeqNo,"+M+"CONVERT(DATETIME,"+O+") DocDate,CONVERT(DATETIME,B.DocDueDate) DueDate,CONVERT(DATETIME,B.DocDate) VoucherDate,B.DocNo,\n"+l+" Amount,"+l+" BillAmount",this.ClubByVoucherNo&&(this.sbSubQuery+=",0 AdjustedBillAmount"),h&&(this.sbSubQuery+=T),c&&(this.sbSubQuery+=_),this.sbSubQuery+=",C50002.Name AS Location,0 Adjusted"+this.ViewModel.SelectTag+"\n,(B.DocDueDate-B.DocDate) CreditDays\n,@To-"+O+" OverDue\n,DocType,(SELECT TOP 1 ACC.StatusID FROM ACC_DocDetails ACC with(nolock) WHERE ACC.VoucherNo=B.DocNo) StatusID",this.ClubByVoucherNo&&(this.sbSubQuery+=",B.Narration"),this.UnAppsDocsAdjustSeperate&&(this.sbSubQuery+=",0 IsUnappAdj"),this.PDCSeperate&&(this.sbSubQuery+=",1 IsPDC,case when B.IsNewReference=0 then B.RefDocNo else null end AgainstVoucher"),-1!=this.colLOBPDCIndex&&(this.sbSubQuery+=",(SELECT abs(SUM("+a+")) FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@To AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo and "+I+")=1) LOBPDC"),this.sbSubQuery+=" \nFROM COM_Billwise B with(nolock) INNER JOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID     \nINNER JOIN COM_Location AS C50002 with(nolock) ON B.dcCCNID2 = C50002.NodeID ",this.ViewModel.SelectTag.length>0&&this.ViewModel.SelectTag.Contains("AT.AccountType")&&(this.sbSubQuery+=" INNER JOIN ACC_ACCOUNTTYPES AT WITH(NOLOCK) ON AT.AccountTypeID=A.AccountTypeID "),this.sbSubQuery+=g+this.ViewModel.FromTag,this.FilterPDCOnMaturityDate&&(this.sbSubQuery+=" \nINNER JOIN (select VoucherNo,max(ChequeMaturityDate) ChequeMaturityDate from acc_docdetails with(nolock) where "+I+" group by VoucherNo) as CM\nON CM.VoucherNo=B.DocNo "),A&&(this.sbSubQuery+=d),this.sbSubQuery+=" WHERE (B.DocType=19 or B.DocType=14)",this.AllowFromDateFilter&&(this.sbSubQuery+=" and "+y+">=@From "),this.sbSubQuery+=" and "+y+"<=@To ",this.sbSubQuery+=E.toString(),this.sbSubQuery+=" ) AS T ",P="",this.UnAdjusted&&(P="Adjusted IS NULL"),this.SemiAdjusted&&(P.length>0&&(P+=" OR "),P+="abs(Amount+Adjusted)>"+this.AdjustmentRoundOff),this.Adjusted&&(P.length>0&&(P+=" OR "),P+="abs(Amount+Adjusted)<"+this.AdjustmentRoundOff),P="("+P+")",(P+=" AND "+I).length>0&&(this.sbSubQuery+=" WHERE "+P)}if(10==e&&this.UnAppsDocsAdjustSeperate&&(this.sbSubQuery+="\nUNION ALL ",this.sbSubQuery+="\nSELECT *,case when Amount>0 then 1 else 0 end AmtOrder FROM (",this.sbSubQuery+="\tSELECT A.AccountID,B.DocSeqNo,"+M,this.sbSubQuery+=this.GetDateColumn("B",""),this.sbSubQuery+=",CONVERT(DATETIME,B.DocDueDate) DueDate,CONVERT(DATETIME,B.DocDate) VoucherDate,B.DocNo,\n"+l+" Amount,",this.ClubByVoucherNo?(this.sbSubQuery+="(select sum("+l+") from COM_Billwise CB with(nolock) where CB.AccountID=B.AccountID AND CB.DocNo=B.DocNo and IsNewReference=1) BillAmount",this.sbSubQuery+=",(SELECT SUM("+l+") Adjusted FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND ",this.sbSubQuery+=this.PDCOnConvresionDate?"isnull(CB.ConvertedDate,CB.DocDate)<=@To":"CB.DocDate<=@To",this.sbSubQuery+=" AND CB.AccountID=B.AccountID AND CB.RefDocNo=B.DocNo"+f+") AdjustedBillAmount"):this.sbSubQuery+=l+" BillAmount",h&&(this.sbSubQuery+=T),c&&(this.sbSubQuery+=_),this.sbSubQuery+=",C50002.Name AS Location,null Adjusted\n"+this.ViewModel.SelectTag+",(B.DocDueDate-B.DocDate) CreditDays\n,@To-B."+this.ViewModel.Preferences.Date+" OverDue\n,DocType,B.StatusID StatusID",this.ClubByVoucherNo&&(this.sbSubQuery+=",B.Narration"),this.UnAppsDocsAdjustSeperate&&(this.sbSubQuery+=",1 IsUnappAdj"),this.PDCSeperate&&(this.sbSubQuery+=",case when DocType=14 or DocType=19 then 1 else 0 end IsPDC,null AgainstVoucher"),-1!=this.colLOBPDCIndex&&(this.sbSubQuery+=",null  LOBPDC"),this.sbSubQuery+=" \nFROM COM_Billwise B with(nolock) INNER JOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID     \nINNER JOIN COM_Location AS C50002 with(nolock) ON B.dcCCNID2 = C50002.NodeID ",this.ViewModel.SelectTag.length>0&&this.ViewModel.SelectTag.Contains("AT.AccountType")&&(this.sbSubQuery+=" INNER JOIN ACC_ACCOUNTTYPES AT WITH(NOLOCK) ON AT.AccountTypeID=A.AccountTypeID "),this.sbSubQuery+=g+this.ViewModel.FromTag,A&&(this.sbSubQuery+=d),this.sbSubQuery+=" WHERE B.IsNewReference=0 and (B.StatusID=371 or B.RefStatusID=371)",this.sbSubQuery+=this.GetDateColumn("B","@To"),E="",E+=S,A&&(E+=" AND A."+C),E+=R,E+=m,this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?E+=" AND 1<>1":E+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),this.ForeignCurrencyID>0&&(E+=" AND B.AdjCurrID="+this.ForeignCurrencyID),E+=this.GetDocumentTypeFilter(),this.sbSubQuery+=E.toString(),this.sbSubQuery+=" ) AS T ",P="",this.IsPaymentTermWise&&(P+=" AND DocDate<=@To AND Amount IS NOT NULL"),P.length>0&&(this.sbSubQuery+=" WHERE "+P)),this.sbSubQuery+=" ORDER BY "+this.strOrder,this.PDCSeperate&&(this.sbSubQuery+="IsPDC,"),this.UnPostedDocsSeparately&&(this.sbSubQuery+="StatusID,"),this.sbSubQuery+="DocDate,AmtOrder,DocNo",this.UnAppsDocsAdjustSeperate&&(this.sbSubQuery+=",IsUnappAdj"),9==e){var b="";-1!=this.colRefAccount&&(b=s.a.report.GetReportData(18,0,"").Tables[0][0].RefAccount.toString()),this.sbSubQuery+="\nSELECT ",this.sbSubQuery+=this.PDCOnConvresionDate?"CONVERT(DATETIME,isnull(B.ConvertedDate,B.DocDate)) DocDate":"CONVERT(DATETIME, B.DocDate) DocDate",this.sbSubQuery+=",B.DocNo,B.RefDocSeqNo,"+l+" AS AdjAmount",h&&(this.sbSubQuery+=T),c&&(this.sbSubQuery+=_),this.sbSubQuery+=this.ViewModel.SelectTag+b,this.sbSubQuery+=",RefDocNo,DATEDIFF(day,CONVERT(DATETIME,RefDocDate),CONVERT(DATETIME, B.DocDate)) PaidByDays\nFROM COM_Billwise B WITH(NOLOCK) INNER JOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID",this.ViewModel.SelectTag.length>0&&this.ViewModel.SelectTag.Contains("AT.AccountType")&&(this.sbSubQuery+=" INNER JOIN ACC_ACCOUNTTYPES AT WITH(NOLOCK) ON AT.AccountTypeID=A.AccountTypeID "),this.sbSubQuery+=this.ViewModel.FromTag,A&&(this.sbSubQuery+=d),this.sbSubQuery+=" WHERE IsNewReference=0",this.sbSubQuery+=this.PDCOnConvresionDate?" AND isnull(B.ConvertedDate,B.DocDate)<=@To ":" AND B.DocDate<=@To ",this.sbSubQuery+=f.Replace("CB.","B."),A&&(this.sbSubQuery+=" AND B."+C),this.sbSubQuery+=R}D=this.sbSubQuery.toString()}else if(11==e){var N;N=this.PDCInclude?" AND  ((SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo and "+I+")=1 OR (DocType<>14 AND DocType<>19 AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo"+p+")=1))":" AND  DocType<>14 AND DocType<>19 AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo"+p+")=1",this.sbSubQuery+=this.dtMonthWiseEndData?"DECLARE @AsOn FLOAT SET @AsOn=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.dtMonthWiseEndData.ToString("dd MMM yyyy")+"'))":"DECLARE @AsOn FLOAT SET @AsOn=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",this.AllowFromDateFilter&&(this.sbSubQuery+="\ndeclare @From float SET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))"),this.IsPaymentTermWise?(this.sbSubQuery+=" SELECT * FROM (SELECT "+M+"B.DocNo VoucherNo,"+l+" BillAmount"+this.ViewModel.SelectTag,this.sbSubQuery+=",CASE WHEN EXISTS (select * from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo)\nTHEN (select CONVERT(DATETIME,max(DueDate)) from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo and DueDate<=@AsOn)\nELSE CONVERT(DATETIME,ISNULL(B.DocDueDate,B.DocDate)) END DocDate, \nCONVERT(DATETIME,B.DocDueDate) DueDate,\nCASE WHEN EXISTS (select * from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo)\nTHEN (select sum(amount)*sign(B.AdjAmount)"+r+" from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo and DueDate<=@AsOn)\nELSE "+l+" END AdjAmount, @AsOn-B.DocDueDate OverDue"):(this.sbSubQuery+="\tSELECT "+M+"B.DocNo VoucherNo,"+l+" BillAmount"+this.ViewModel.SelectTag,this.sbSubQuery+=","+this.GetDateColumn("B",""),this.sbSubQuery+=",CONVERT(DATETIME,B.DocDueDate) DueDate,"+l+" AdjAmount,@AsOn-B."+this.ViewModel.Preferences.Date+" OverDue"),this.sbSubQuery+=",ISNULL((SELECT SUM("+a+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0",this.sbSubQuery+=this.PDCOnConvresionDate?" AND ISNULL(CB.ConvertedDate,CB.DocDate)<=@AsOn":" AND CB.DocDate<=@AsOn",this.sbSubQuery+=N+"),0) Paid",this.sbSubQuery+=",(B.DocDueDate-B.DocDate) CreditDays",h&&(this.sbSubQuery+=T),c&&(this.sbSubQuery+=_),-1==this.colPDCIndex&&-1==this.colNetBalanceIndex||(this.colPDCIndex=0,this.sbSubQuery+=",(SELECT abs(SUM("+a+")) FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@AsOn AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo and "+I+")=1)  TotalPDC",this.PDCInclude&&(this.sbSubQuery+=",(SELECT TOP 1 ACC.StatusID FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo) Status")),this.sbSubQuery+=",case when AdjAmount>0 then 1 else 0 end AmtOrder",this.BWAgeingShowOnlyDocs&&(this.sbSubQuery+=",DType.IsInventory",this.ViewModel.FromTag.Contains("DType")||(this.ViewModel.FromTag=" INNER JOIN (SELECT DocumentType,IsInventory FROM ADM_DocumentTypes with(nolock) Group By DocumentType,IsInventory) AS DType ON  DType.DocumentType=B.DocType "+this.ViewModel.FromTag)),this.sbSubQuery+=" FROM COM_Billwise B with(nolock) INNER JOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID ",this.ViewModel.SelectTag.length>0&&this.ViewModel.SelectTag.Contains("AT.AccountType")&&(this.sbSubQuery+=" INNER JOIN ACC_ACCOUNTTYPES AT WITH(NOLOCK) ON AT.AccountTypeID=A.AccountTypeID "),this.sbSubQuery+=g+this.ViewModel.FromTag,A&&(this.sbSubQuery+=d),this.sbSubQuery+=" WHERE B.IsNewReference=1",this.IsPaymentTermWise||(this.sbSubQuery+=this.GetDateColumn("B","@AsOn")),this.sbSubQuery+=S,"Receivables"==this.ViewModel.Preferences.IncludeBills?this.sbSubQuery+=" AND "+n+">0":"Payables"==this.ViewModel.Preferences.IncludeBills&&(this.sbSubQuery+=" AND "+n+"<0"),this.sbSubQuery+=this.GetDocumentTypeFilter(),this.sbSubQuery+=this.PDCInclude?" AND ((SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo and "+I+")=1 OR (DocType<>14 AND DocType<>19 AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo"+p+")=1))":" AND DocType<>14 AND DocType<>19 AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo"+p+")=1",A&&(this.sbSubQuery+=" AND A."+C),this.sbSubQuery+=R,this.sbSubQuery+=m,this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?this.sbSubQuery+=" AND 1<>1":this.sbSubQuery+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),this.ForeignCurrencyID>0&&(this.sbSubQuery+=" AND B.AdjCurrID="+this.ForeignCurrencyID),this.IsPaymentTermWise?(this.sbSubQuery+=" ) AS T WHERE DocDate<=@AsOn AND AdjAmount IS NOT NULL ",this.sbSubQuery+=" ORDER BY "+this.strOrder+"DocDate,AmtOrder,VoucherNo",this.sbSubQuery+="\nSELECT PT.VoucherNo,PT.Amount"+r+" Amount,CONVERT(DATETIME,PT.DueDate) DueDate\nFROM  COM_Billwise B with(nolock) INNER JOIN COM_DocPayTerms PT with(nolock) ON PT.VoucherNo=B.DocNo",R.length>0&&(this.sbSubQuery+=" INNER JOIN ACC_Accounts A ON A.AccountID=B.AccountID"),A&&(this.sbSubQuery+=d),this.sbSubQuery+=" WHERE B.IsNewReference=1 and B.AccountID=PT.AccountID AND PT.DueDate<=@AsOn ",A&&(this.sbSubQuery+=" AND B."+C),this.sbSubQuery+=R,this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?this.sbSubQuery+=" AND 1<>1":this.sbSubQuery+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")")):this.sbSubQuery+=" ORDER BY "+this.strOrder+"DocDate,AmtOrder,DocNo",D=this.sbSubQuery.toString()}else if(12==e){var V;V=this.PDCInclude?" AND  ((SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo and "+I+")=1 OR (DocType<>14 AND DocType<>19 AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo"+p+")=1))":" AND  DocType<>14 AND DocType<>19 AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo"+p+")=1";var v=this.ViewModel.Preferences.ContainsKey("SalesDocs")?this.ViewModel.Preferences.SalesDocs:"",L=this.ViewModel.Preferences.ContainsKey("ReceiptDocs")?this.ViewModel.Preferences.ReceiptDocs:"",B=this.ViewModel.Preferences.ContainsKey("ChequeBounceDocs")?this.ViewModel.Preferences.ChequeBounceDocs:"";if(this.lstGroup.length<=1){var F="";if(v.length>0?(-1!=this.colTotalSaleIndex&&(F=",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+v+") AND SALE.DocDate>=@AccountingDate AND SALE.DocDate<=@AsOnDate"+p+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+v+") AND SALE.DocDate>=@AccountingDate AND SALE.DocDate<=@AsOnDate"+p+"),0)  TotalSale"),-1!=this.colPrevYearSaleIndex&&(F=F+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+v+") AND SALE.DocDate<@AccountingDate"+p+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+v+") AND SALE.DocDate<@AccountingDate"+p+"),0)  PrevYearSale"),-1!=this.colPeriodSaleIndex&&(F=F+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) \njoin com_docccdata b on SALE.ACCDocDetailsid=b.ACCDocDetailsid\nWHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+v+") AND SALE.DocDate>=@FromDate AND SALE.DocDate<=@AsOnDate"+p+S+"),0) \n+ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) \njoin com_docccdata b on SALE.INVDocDetailsid=b.INVDocDetailsid\nWHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+v+") AND SALE.DocDate>=@FromDate AND SALE.DocDate<=@AsOnDate"+p+S+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) \njoin com_docccdata b on SALE.ACCDocDetailsid=b.ACCDocDetailsid\nWHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+v+") AND SALE.DocDate>=@FromDate AND SALE.DocDate<=@AsOnDate"+p+S+"),0)\n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) \njoin com_docccdata b on SALE.INVDocDetailsid=b.INVDocDetailsid\nWHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+v+") AND SALE.DocDate>=@FromDate AND SALE.DocDate<=@AsOnDate"+p+S+"),0) PeriodSale")):(this.colTotalSaleIndex=-1,this.colPrevYearSaleIndex=-1,this.colPeriodSaleIndex=-1),L.length>0&&-1!=this.colReceiptsAmtIndex?(F=F+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) \njoin com_docccdata b on SALE.ACCDocDetailsid=b.ACCDocDetailsid\nWHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+L+")",this.ViewModel.oReportDialog.FromDate.Visible&&(F+=" AND SALE.DocDate>=@FromDate"),F=F+" AND SALE.DocDate<=@AsOnDate"+p+S+"),0) \n+ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) \njoin com_docccdata b on SALE.INVDocDetailsid=b.INVDocDetailsid\nWHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+L+")",this.ViewModel.oReportDialog.FromDate.Visible&&(F+=" AND SALE.DocDate>=@FromDate"),F=F+" AND SALE.DocDate<=@AsOnDate"+p+S+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) \njoin com_docccdata b on SALE.ACCDocDetailsid=b.ACCDocDetailsid\nWHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+L+")",this.ViewModel.oReportDialog.FromDate.Visible&&(F+=" AND SALE.DocDate>=@FromDate"),F=F+" AND SALE.DocDate<=@AsOnDate"+p+S+"),0)\n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) \njoin com_docccdata b on SALE.INVDocDetailsid=b.INVDocDetailsid\nWHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+L+")",this.ViewModel.oReportDialog.FromDate.Visible&&(F+=" AND SALE.DocDate>=@FromDate"),F=F+" AND SALE.DocDate<=@AsOnDate"+p+S+"),0) ReceiptsAmount"):this.colReceiptsAmtIndex=-1,B.length>0&&-1!=this.colChqBounceAmtIndex?(F=F+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) \njoin com_docccdata b on SALE.ACCDocDetailsid=b.ACCDocDetailsid\nWHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+B+")",this.ViewModel.oReportDialog.FromDate.Visible&&(F+=" AND SALE.DocDate>=@FromDate"),F=F+" AND SALE.DocDate<=@AsOnDate"+p+S+"),0)\n+ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) \njoin com_docccdata b on SALE.INVDocDetailsid=b.INVDocDetailsid\nWHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+B+")",this.ViewModel.oReportDialog.FromDate.Visible&&(F+=" AND SALE.DocDate>=@FromDate"),F=F+" AND SALE.DocDate<=@AsOnDate"+p+S+"),0)\n\n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) \njoin com_docccdata b on SALE.ACCDocDetailsid=b.ACCDocDetailsid\nWHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+B+")",this.ViewModel.oReportDialog.FromDate.Visible&&(F+=" AND SALE.DocDate>=@FromDate"),F=F+" AND SALE.DocDate<=@AsOnDate"+p+S+"),0)\n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) \njoin com_docccdata b on SALE.INVDocDetailsid=b.INVDocDetailsid\nWHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+B+")",this.ViewModel.oReportDialog.FromDate.Visible&&(F+=" AND SALE.DocDate>=@FromDate"),F=F+" AND SALE.DocDate<=@AsOnDate"+p+S+"),0) ChequeBounceAmount"):this.colChqBounceAmtIndex=-1,-1!=this.colUnDueIndex&&(this.IsDocDateWise?(F=F+",(select sum(AMT) from (select "+n+"+ISNULL((SELECT SUM("+a+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND CB.IsNewReference=0",F+=this.PDCOnConvresionDate?" AND isnull(CB.ConvertedDate,CB.DocDate)<=@AsOnDate":" AND CB.DocDate<=@AsOnDate",F+=V+"),0)+case when B.DocDueDate is not null and B.DocDueDate >@AsOnDate then "+n+" else 0 end\n        AMT FROM COM_Billwise B WITH(NOLOCK) WHERE B.IsNewReference=1 AND B.AccountID=A.AccountID"):F=F+",(select sum(AMT) from (select "+n+" \n+(case when isnull(B.DocDueDate,B.DocDate)<=@AsOnDate then ISNULL((SELECT SUM("+a+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND CB.IsNewReference=0"+V+"),0) else 0 end)\nAMT FROM COM_Billwise B WITH(NOLOCK) WHERE B.IsNewReference=1 AND B.AccountID=A.AccountID AND isnull(B.DocDueDate,B.DocDate)<=@AsOnDate",F+=S,F+=this.PDCInclude?" AND ((SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo and "+I+")=1 OR (DocType<>14 AND DocType<>19 AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo"+p+")=1))":" AND DocType<>14 AND DocType<>19 AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo"+p+")=1",this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?F+=" AND 1<>1":F+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),this.ForeignCurrencyID>0&&(F+=" AND B.AdjCurrID="+this.ForeignCurrencyID),F+=") as T) ActualBill"),-1==this.colPDCIndex&&-1==this.colIncludingPDCIndex||(F+=",ISNULL((SELECT SUM("+a+") FROM COM_Billwise CB with(nolock) WHERE CB.AccountID=A.AccountID AND IsNewReference=1 AND CB.DocDate<=@AsOnDate AND "+I.Replace("StatusID","CB.StatusID")+S.Replace("B.","CB."),this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.StringIsNullOrEmpty(this.ViewModel.oReportDialog.LocationWhere)||(F+=" AND CB.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")")),F+="),0) TotalPDC "),this.lstGroup.length>0&&(this.lstGroup[0].ID="AccountName",this.ViewModel.Groupstr.Clear(),this.ViewModel.Groupstr.push("AccountName","")),this.LevelNo=0,this.ShowLevelTree=!1,this.ViewModel.Preferences.ContainsKey("ShowLevel")){var G=new i.f;G.LoadXml("<XML>"+this.ViewModel.Preferences.ShowLevel+"</XML>");var x=i.f.SelectSingleNode(G.DocumentElement,"IsChecked");null!=x&&"1"==x.innerHTML&&(this.ShowLevelTree=!0,x=i.f.SelectSingleNode(G.DocumentElement,"Text"),this.LevelNo=parseInt(x.innerHTML))}this.sbSubQuery="",this.sbSubQuery+="DECLARE @AccountingDate FLOAT,@AsOnDate FLOAT\nSET @AccountingDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+s.a.SessionManager.AccountingDate.ToString("dd MMM yyyy")+"'))",this.AllowFromDateFilter&&(this.sbSubQuery+="\ndeclare @From float SET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))"),this.sbSubQuery+=this.dtMonthWiseEndData?" SET @AsOnDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.dtMonthWiseEndData.ToString("dd MMM yyyy")+"'))":" SET @AsOnDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",(this.ViewModel.oReportDialog.FromDate.Visible||-1!=this.colPeriodSaleIndex)&&(this.sbSubQuery+="\ndeclare @FromDate float SET @FromDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"')) "),this.ShowLevelTree?(this.sbSubQuery+="SELECT A.AccountID,A.AccountName,A.lft,A.rgt,A.IsGroup,A.Depth"+F+this.ViewModel.SelectTag+" FROM ACC_Accounts A with(nolock)",this.ViewModel.SelectTag.length>0&&this.ViewModel.SelectTag.Contains("AT.AccountType")&&(this.sbSubQuery+=" INNER JOIN ACC_ACCOUNTTYPES AT WITH(NOLOCK) ON AT.AccountTypeID=A.AccountTypeID "),this.sbSubQuery+=this.ViewModel.FromTag,A&&(this.sbSubQuery+=d),this.sbSubQuery+=" WHERE A.Depth>0",A&&(this.sbSubQuery+=" AND A."+C),this.sbSubQuery+=R,m.length>0&&(this.sbSubQuery+=m),this.sbSubQuery+=" ORDER BY A.lft"):(this.sbSubQuery+="SELECT A.AccountID,A.AccountName"+F+this.ViewModel.SelectTag+" FROM ACC_Accounts A with(nolock)",this.ViewModel.SelectTag.length>0&&this.ViewModel.SelectTag.Contains("AT.AccountType")&&(this.sbSubQuery+=" INNER JOIN ACC_ACCOUNTTYPES AT WITH(NOLOCK) ON AT.AccountTypeID=A.AccountTypeID "),this.sbSubQuery+=this.ViewModel.FromTag,A&&(this.sbSubQuery+=d),this.sbSubQuery+=" WHERE A.Depth>0",A&&(this.sbSubQuery+=" AND A."+C),this.sbSubQuery+=R,this.sbSubQuery+=m,this.sbSubQuery+=" ORDER BY A.AccountName");var W="";this.IsPaymentTermWise?(W+="\nSELECT *,Amount+Paid AdjAmount FROM (SELECT B.DocNo,"+l+" BillAmount,CASE WHEN EXISTS (select * from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo)\nTHEN (select CONVERT(DATETIME,max(DueDate)) from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo and DueDate<=@AsOnDate)\nELSE CONVERT(DATETIME,ISNULL(B.DocDueDate,B.DocDate)) END DocDate,B.AccountID\n,CASE WHEN EXISTS (select * from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo)\nTHEN (select sum(amount)*sign(B.AdjAmount)"+r+" from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo and DueDate<=@AsOnDate)\nELSE "+l+" END Amount,\nISNULL(\n(SELECT SUM("+a+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND ",W+=this.PDCOnConvresionDate?"isnull(CB.ConvertedDate,CB.DocDate)<=@AsOnDate":"CB.DocDate<=@AsOnDate",W+=V+"),0) Paid"):(W+=" SELECT * from (",W+=" SELECT ",W+=this.GetDateColumn("B",""),-1!=this.colUnDueIndex&&(W+=",AdjAmount Amount"),-1!=this.colBillAmtIndex&&(W+=","+l+" BillAmount"),W+=",B.AccountID,"+l+"+ISNULL((SELECT SUM("+a+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND CB.IsNewReference=0",W+=this.PDCOnConvresionDate?" AND isnull(CB.ConvertedDate,CB.DocDate)<=@AsOnDate":" AND CB.DocDate<=@AsOnDate",W+=V+"),0) AdjAmount",this.AgeingBasedOnMaturityDate&&(W+=",convert(datetime,CM.ChequeMaturityDate) CqMaturityDate")),-1==this.colPDCIndex&&-1==this.colIncludingPDCIndex||(this.colPDCIndex=0,W+=",ISNULL((SELECT SUM("+a+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@AsOnDate"+S.Replace("B.","CB.")+" AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo and "+I+")=1),0) TotalPDC "),(-1!=this.colPDCIndex||-1!=this.colIncludingPDCIndex||this.AgeingBasedOnMaturityDate)&&this.PDCInclude&&(W+=",(SELECT TOP 1 ACC.StatusID FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo) Status"),W+=" FROM COM_Billwise B WITH(NOLOCK)",(m.length>0||R.length>0)&&(W+=" INNER JOIN ACC_Accounts A ON A.AccountID=B.AccountID"+m),A&&(W+=d),this.AgeingBasedOnMaturityDate&&(W+=" \nINNER JOIN (select VoucherNo,max(ChequeMaturityDate) ChequeMaturityDate from acc_docdetails with(nolock) where "+I+" group by VoucherNo) as CM\nON CM.VoucherNo=B.DocNo "),W+=" WHERE B.IsNewReference=1",this.IsPaymentTermWise||(W+=this.GetDateColumn("B","@AsOnDate")),W+=S,W+=this.PDCInclude?" AND ((SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo and "+I+")=1 OR (DocType<>14 AND DocType<>19 AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo"+p+")=1))":" AND DocType<>14 AND DocType<>19 AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo"+p+")=1",A&&(W+=" AND B."+C),W+=R,this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?W+=" AND 1<>1":W+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),this.ForeignCurrencyID>0&&(W+=" AND B.AdjCurrID="+this.ForeignCurrencyID),this.IsPaymentTermWise?(W+=" ) AS T WHERE DocDate<=@AsOnDate AND Amount IS NOT NULL ",W+="\nSELECT PT.VoucherNo,PT.Amount"+r+" Amount,CONVERT(DATETIME,PT.DueDate) DueDate\nFROM  COM_Billwise B with(nolock) INNER JOIN COM_DocPayTerms PT with(nolock) ON PT.VoucherNo=B.DocNo",R.length>0&&(W+=" INNER JOIN ACC_Accounts A ON A.AccountID=B.AccountID"),A&&(W+=d),W+=" WHERE B.IsNewReference=1 and B.AccountID=PT.AccountID AND PT.DueDate<=@AsOnDate ",A&&(W+=" AND B."+C),W+=R,this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?W+=" AND 1<>1":W+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")")):(W+=this.AdjustmentRoundOff>0?" ) AS T WHERE abs(AdjAmount)>"+this.AdjustmentRoundOff:" ) AS T WHERE AdjAmount!=0",-1!=this.colPDCIndex&&(W+=" or TotalPDC!=0")),D=this.sbSubQuery.toString()+W.toString(),this.FutureSlabs&&(D+=W.toString().Replace("<=@AsOnDate",">@AsOnDate"))}else{this.LevelNo=0,this.ShowLevelTree=!1,this.ViewModel.FormulaObjects.Clear(),this.ViewModel.BaseReportColumns.forEach((function(e){i.e.IsEmpty(e.Formula.Text)||o.ViewModel.ParseFormula(e,!0)})),this.ViewModel.ReportGroups.forEach((function(e){i.e.IsEmpty(e.Formula.Text)||o.ViewModel.ParseFormula(e,!0)})),this.sbSubQuery="",M="",g="",this.strOrder="";var k=new Array,U=new Array;this.ViewModel.ReportGroups.forEach((function(e){(2==e.CDGDO.ColumnCostCenterID||e.CDGDO.ColumnCostCenterID>5e4)&&(2==e.CDGDO.CategoryValue?(e.CDGDO.ParentTableAlias="CC"+e.CDGDO.ColumnCostCenterID,i.e.IsEmpty(e.FormulaExpression)&&(M+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+" AS "+e.ID+","),U.Contains(e.CDGDO.ColumnCostCenterID)||(U.push(e.CDGDO.ColumnCostCenterID),g.Contains("CCD"+e.CDGDO.CategoryValue+".CostCenterID="+e.CDGDO.CategoryValue)||(g+=" INNER JOIN "+e.CDGDO.ParentTable+" AS CCD"+e.CDGDO.CategoryValue,g+=" WITH(NOLOCK) ON CCD"+e.CDGDO.CategoryValue+".NodeID=A.AccountID AND CCD"+e.CDGDO.CategoryValue+".CostCenterID="+e.CDGDO.CategoryValue),g+=" INNER JOIN "+e.CDGDO.ParentCostCenterSysName+" AS "+e.CDGDO.ParentTableAlias,g+=" WITH(NOLOCK) ON "+e.CDGDO.ParentTableAlias+".NodeID=CCD"+e.CDGDO.CategoryValue+"."+e.CDGDO.ParentColumn,o.strOrder+=e.ID+",")):(e.CDGDO.ParentTableAlias="C"+e.CDGDO.ColumnCostCenterID,i.e.IsEmpty(e.FormulaExpression)&&(M+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+" AS "+e.ID+","),k.Contains(e.CDGDO.ColumnCostCenterID)||(k.push(e.CDGDO.ColumnCostCenterID),g+=" INNER JOIN "+e.CDGDO.ParentCostCenterSysName+" AS "+e.CDGDO.ParentTableAlias,g+=2==e.CDGDO.ColumnCostCenterID?" with(nolock) ON "+e.CDGDO.ParentTableAlias+".AccountID=B.AccountID":" with(nolock) ON "+e.CDGDO.ParentTableAlias+".NodeID=B."+e.CDGDO.ParentColumn,o.strOrder+=e.ID+",")))})),this.ViewModel.BaseReportColumns.forEach((function(e){"0"==e.ShowAsColumn.SelectedValue&&(2==e.CDGDO.ColumnCostCenterID||e.CDGDO.ColumnCostCenterID>5e4)&&(2==e.CDGDO.CategoryValue?(e.CDGDO.ParentTableAlias="CC"+e.CDGDO.ColumnCostCenterID,M+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+" AS "+e.ID+",",U.Contains(e.CDGDO.ColumnCostCenterID)||(U.push(e.CDGDO.ColumnCostCenterID),g.Contains("CCD"+e.CDGDO.CategoryValue+".CostCenterID="+e.CDGDO.CategoryValue)||(g+=" INNER JOIN "+e.CDGDO.ParentTable+" AS CCD"+e.CDGDO.CategoryValue,g+=" WITH(NOLOCK) ON CCD"+e.CDGDO.CategoryValue+".NodeID=A.AccountID AND CCD"+e.CDGDO.CategoryValue+".CostCenterID="+e.CDGDO.CategoryValue),g+=" INNER JOIN "+e.CDGDO.ParentCostCenterSysName+" AS "+e.CDGDO.ParentTableAlias,g+=" WITH(NOLOCK) ON "+e.CDGDO.ParentTableAlias+".NodeID=CCD"+e.CDGDO.CategoryValue+"."+e.CDGDO.ParentColumn)):(e.CDGDO.ParentTableAlias="C"+e.CDGDO.ColumnCostCenterID,M+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+" AS "+e.ID+",",k.Contains(e.CDGDO.ColumnCostCenterID)||(k.push(e.CDGDO.ColumnCostCenterID),g+=" INNER JOIN "+e.CDGDO.ParentCostCenterSysName+" AS "+e.CDGDO.ParentTableAlias,g+=2==e.CDGDO.ColumnCostCenterID?" ON "+e.CDGDO.ParentTableAlias+".AccountID=B.AccountID":" ON "+e.CDGDO.ParentTableAlias+".NodeID=B."+e.CDGDO.ParentColumn)))})),k.Contains(2)?(this.ViewModel.SelectTag=this.ViewModel.SelectTag.Replace("A.","C2."),this.ViewModel.FromTag=this.ViewModel.FromTag.Replace("A.","C2."),g=g.Replace("A.","C2.")):(this.ViewModel.SelectTag="",this.ViewModel.FromTag="");var K="";if(v.length>0){var H="";k.forEach((function(e){e>=5e4&&(H+=" AND DCC.dcCCNID"+(e-5e4)+"=B.dcCCNID"+(e-5e4))})),-1!=this.colTotalSaleIndex&&(K=",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=SALE.InvDocDetailsID WHERE SALE.DebitAccount=B.AccountID "+H+" AND SALE.CostCenterID IN ("+v+") AND SALE.DocDate>=@AccountingDate AND SALE.DocDate<=@AsOnDate"+p+'),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=SALE.InvDocDetailsID WHERE SALE.CreditAccount=B.AccountID " + ccwhere + " AND SALE.CostCenterID IN ('+v+") AND SALE.DocDate>=@AccountingDate AND SALE.DocDate<=@AsOnDate"+p+"),0)  TotalSale"),-1!=this.colPrevYearSaleIndex&&(K=K+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=SALE.InvDocDetailsID WHERE SALE.DebitAccount=B.AccountID "+H+" AND SALE.CostCenterID IN ("+v+") AND SALE.DocDate<@AccountingDate"+p+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=SALE.InvDocDetailsID WHERE SALE.CreditAccount=B.AccountID "+H+" AND SALE.CostCenterID IN ("+v+") AND SALE.DocDate<@AccountingDate"+p+"),0)  PrevYearSale"),-1!=this.colPeriodSaleIndex&&(K=K+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=SALE.InvDocDetailsID WHERE SALE.DebitAccount=B.AccountID "+H+" AND SALE.CostCenterID IN ("+v+") AND SALE.DocDate>=@FromDate AND SALE.DocDate<=@AsOnDate"+p+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=SALE.InvDocDetailsID WHERE SALE.CreditAccount=B.AccountID "+H+" AND SALE.CostCenterID IN ("+v+") AND SALE.DocDate>=@FromDate AND SALE.DocDate<=@AsOnDate"+p+"),0) PeriodSale")}else this.colTotalSaleIndex=-1,this.colPrevYearSaleIndex=-1,this.colPeriodSaleIndex=-1;L.length>0&&-1!=this.colReceiptsAmtIndex?(K=K+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+L+")",this.ViewModel.oReportDialog.FromDate.Visible&&(K+=" AND SALE.DocDate>=@FromDate"),K=K+" AND SALE.DocDate<=@AsOnDate"+p+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+L+")",this.ViewModel.oReportDialog.FromDate.Visible&&(K+=" AND SALE.DocDate>=@FromDate"),K=(K=K+" AND SALE.DocDate<=@AsOnDate"+p+"),0) ReceiptsAmount")+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+L+") AND SALE.DocDate>=@FromDate AND SALE.DocDate<=@AsOnDate"+p+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+L+") AND SALE.DocDate>=@FromDate AND SALE.DocDate<=@AsOnDate"+p+"),0) ReceiptsAmount"):this.colReceiptsAmtIndex=-1,B.length>0&&-1!=this.colChqBounceAmtIndex?(K=K+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+B+")",this.ViewModel.oReportDialog.FromDate.Visible&&(K+=" AND SALE.DocDate>=@FromDate"),K=K+" AND SALE.DocDate<=@AsOnDate"+p+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+B+")",this.ViewModel.oReportDialog.FromDate.Visible&&(K+=" AND SALE.DocDate>=@FromDate"),K=K+" AND SALE.DocDate<=@AsOnDate"+p+"),0) ChequeBounceAmount"):this.colChqBounceAmtIndex=-1,this.colUnDueIndex=-1,this.sbSubQuery+="DECLARE @AccountingDate FLOAT,@AsOnDate FLOAT\nSET @AccountingDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+s.a.SessionManager.AccountingDate.ToString("dd MMM yyyy")+"'))",this.AllowFromDateFilter&&(this.sbSubQuery+="\ndeclare @From float SET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))"),this.sbSubQuery+=this.dtMonthWiseEndData?" SET @AsOnDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.dtMonthWiseEndData.ToString("dd MMM yyyy")+"'))":" SET @AsOnDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",(this.ViewModel.oReportDialog.FromDate.Visible||-1!=this.colPeriodSaleIndex)&&(this.sbSubQuery+="\ndeclare @FromDate float SET @FromDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"')) ");var Q="";this.IsPaymentTermWise?(Q+="\nSELECT *,Amount+Paid AdjAmount FROM (SELECT "+M+"B.DocNo, CASE WHEN EXISTS (select * from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo)\nTHEN (select CONVERT(DATETIME,max(DueDate)) from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo and DueDate<=@AsOnDate)\nELSE CONVERT(DATETIME,ISNULL(B.DocDueDate,B.DocDueDate)) END DocDate,B.AccountID\n\n,CASE WHEN EXISTS (select * from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo)\nTHEN (select sum(amount)*sign(B.AdjAmount)"+r+" from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo and DueDate<=@AsOnDate)\nELSE "+l+" END Amount,\nISNULL(\n(SELECT SUM("+a+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND ",Q+=this.PDCOnConvresionDate?"isnull(CB.ConvertedDate,CB.DocDate)<=@AsOnDate":"CB.DocDate<=@AsOnDate",Q+=V+"),0) Paid"):(Q+=" SELECT * from (",Q+=" SELECT "+M,Q+="B.AccountID,",Q+=this.GetDateColumn("B",""),-1!=this.colUnDueIndex&&(Q+=",0 UnDueAmount"),Q+=",B.DocNo,"+l+" + ISNULL((SELECT SUM("+a+") FROM COM_Billwise CB WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0",Q+=this.PDCOnConvresionDate?" AND isnull(CB.ConvertedDate,CB.DocDate)<=@AsOnDate":" AND CB.DocDate<=@AsOnDate",Q+=V+"),0) AdjAmount ",this.AgeingBasedOnMaturityDate&&(Q+=",convert(datetime,CM.ChequeMaturityDate) CqMaturityDate")),-1==this.colPDCIndex&&-1==this.colIncludingPDCIndex||(this.colPDCIndex=0,Q+=",ISNULL((SELECT SUM("+a+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@AsOnDate"+S.Replace("B.","CB.")+" AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo and "+I+")=1),0) TotalPDC "),(-1!=this.colPDCIndex||-1!=this.colIncludingPDCIndex||this.AgeingBasedOnMaturityDate)&&this.PDCInclude&&(Q+=",(SELECT TOP 1 ACC.StatusID FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo) Status"),Q+=K,Q+=this.ViewModel.SelectTag,Q+=" FROM COM_Billwise B with(nolock)"+g+this.ViewModel.FromTag,A&&(Q+=d),this.AgeingBasedOnMaturityDate&&(Q+=" \nINNER JOIN (select VoucherNo,max(ChequeMaturityDate) ChequeMaturityDate from acc_docdetails with(nolock) where "+I+" group by VoucherNo) as CM\nON CM.VoucherNo=B.DocNo "),Q+=" WHERE B.IsNewReference=1",k.Contains(2)&&m.length>0&&(Q+=m.Replace("A.","C2.")),this.IsPaymentTermWise||(Q+=this.GetDateColumn("B","@AsOnDate")),Q+=S,Q+=this.PDCInclude?" AND ((SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo and "+I+")=1 OR (DocType<>14 AND DocType<>19 AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo"+p+")=1))":" AND DocType<>14 AND DocType<>19 AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo"+p+")=1",A&&(Q+=" AND B."+C),this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?Q+=" AND 1<>1":Q+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),this.ForeignCurrencyID>0&&(Q+=" AND B.AdjCurrID="+this.ForeignCurrencyID),this.IsPaymentTermWise?(Q+=" ) AS T WHERE DocDate<=@AsOnDate AND Amount IS NOT NULL ",Q+="\nSELECT PT.VoucherNo,PT.Amount"+r+" Amount,CONVERT(DATETIME,PT.DueDate) DueDate\nFROM  COM_Billwise B with(nolock) INNER JOIN COM_DocPayTerms PT with(nolock) ON PT.VoucherNo=B.DocNo",A&&(Q+=d),Q+=" WHERE B.IsNewReference=1 and B.AccountID=PT.AccountID AND PT.DueDate<=@AsOnDate ",A&&(Q+=" AND B."+C),this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?Q+=" AND 1<>1":Q+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")")):(Q+=this.AdjustmentRoundOff>0?" ) AS T WHERE abs(AdjAmount)>"+this.AdjustmentRoundOff:" ) AS T WHERE AdjAmount!=0",-1!=this.colPDCIndex&&(Q+=" or TotalPDC!=0")),D=this.sbSubQuery.toString()+Q.toString(),this.FutureSlabs&&(D+=Q.toString().Replace("<=@AsOnDate",">@AsOnDate"))}}return s.a.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,D)}},{key:"GetDataSetNew",value:function(e,t){var o,l,n,a,r,h=this,u="",c="",D="",d="",C="";n=0!=this.oColumns.filter((function(e){return"BillNo"==e.ID})).length,a=0!=this.oColumns.filter((function(e){return"BillDate"==e.ID})).length;var p="";this.UnPostedDocsList.length>0&&this.UnPostedDocsList.split(",").forEach((function(e){d+=" or StatusID="+e}));var T="(StatusID=370 OR StatusID=439"+d+(this.IncludeTerminatedPDC?" OR StatusID=452":"")+")";r=(C="("+(C=(d="StatusID=369 or StatusID=429"+d).Replace("StatusID","CB.StatusID"))+")").Replace("CB.","B."),d=" and ("+d+")";var _=this.GetAccountWiseLocationWhere("A"),m=this.GetDimensionFilter("B.dcCCNID"),I=!1;this.ViewModel.HideCostCenterTree||this.ViewModel.oReportDialog.IsZeroSelected||this.ViewModel.oReportDialog.IsOneSelected||(I=!0,this.ViewModel.oReportDialog.IsGroupExists?(D="AccountID=GTP.GTID",c=t.Contains(",")?",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID IN ("+t+") group by T.AccountID) AS GTP ":",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID="+t+" group by T.AccountID) AS GTP "):D=t.Contains(",")?"AccountID IN ("+t+")":"AccountID="+t),this.ForeignCurrencyID>0?(o="AmountFC",l="/B.AdjExchRT"):(o=1==this.CurrencyType?"isnull(AmountBC,0)":"AdjAmount",l=""),p=this.GetAccountTypeWhere("A"),this.sbSubQuery="",this.GroupRowsCount=0;var R="",S="";if(this.strOrder="",this.ViewModel.ReportGroups.forEach((function(t){2==t.CDGDO.ColumnCostCenterID?(R+="A."+t.CDGDO.Column+" AS "+t.ID+",A.AccountID AS "+t.ID+"_ID,","1"!=t.ShowAsColumn.SelectedValue&&(h.AccountGroupIndex=h.GroupRowsCount),!h.ViewModel.Preferences.ContainsKey("TreeSortOn")||9!=e&&10!=e||("Code"==h.ViewModel.Preferences.TreeSortOn?(R+="A.AccountCode AccOrder,",h.strOrder+="AccOrder,"):"TreeOrder"==h.ViewModel.Preferences.TreeSortOn&&(R+="A.lft AccOrder,",h.strOrder+="AccOrder,"))):t.CDGDO.ColumnCostCenterID>5e4&&400==t.CDGDO.CategoryValue&&(t.CDGDO.ParentTableAlias="C"+t.CDGDO.ColumnCostCenterID,R+=t.CDGDO.ParentTableAlias+"."+t.CDGDO.Column+" AS "+t.ID+","+t.CDGDO.ParentTableAlias+".NodeID AS "+t.ID+"_ID,",11!=h.ViewModel.StaticReportType&&12!=h.ViewModel.StaticReportType&&50002==t.CDGDO.ColumnCostCenterID||(S+=" INNER JOIN "+t.CDGDO.ParentCostCenterSysName+" AS "+t.CDGDO.ParentTableAlias,S+=" WITH(NOLOCK) ON "+t.CDGDO.ParentTableAlias+".NodeID=B."+t.CDGDO.ParentColumn)),h.strOrder+=t.ID+",","1"!=t.ShowAsColumn.SelectedValue&&h.GroupRowsCount++})),9==e||10==e){var A="";A=this.PDCInclude?this.HidePDCAdjustments||!this.PDCSeperate&&!this.FilterPDCOnMaturityDate?" AND ("+T.Replace("StatusID","CB.StatusID")+" OR (DocType<>14 AND DocType<>19 AND "+C+"))":" AND  (DocType<>14 AND DocType<>19 AND "+C+")":" AND DocType<>14 AND DocType<>19 AND "+C,this.sbSubQuery+="DECLARE @To FLOAT\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",this.AllowFromDateFilter&&(this.sbSubQuery+="\ndeclare @From float SET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))"),this.sbSubQuery+="\nSELECT *,case when Amount>0 then 1 else 0 end AmtOrder FROM (",this.IsPaymentTermWise?(this.sbSubQuery+="\tSELECT A.AccountID,B.DocSeqNo,"+R+"\nCASE WHEN EXISTS (select * from COM_DocPayTerms WITH(NOLOCK) where VoucherNo=B.DocNo)\nTHEN (select CONVERT(DATETIME,max(DueDate)) from COM_DocPayTerms WITH(NOLOCK) where VoucherNo=B.DocNo and DueDate<=@To)\nELSE CONVERT(DATETIME,ISNULL(B.DocDueDate,B.DocDate)) END DocDate, \nCONVERT(DATETIME,B.DocDueDate) DueDate,CONVERT(DATETIME,B.DocDate) VoucherDate,B.DocNo,\nCASE WHEN EXISTS (select * from COM_DocPayTerms WITH(NOLOCK) where VoucherNo=B.DocNo)\nTHEN (select sum(amount)*sign(B.AdjAmount)"+l+" from COM_DocPayTerms WITH(NOLOCK) where VoucherNo=B.DocNo and DueDate<=@To)\nELSE "+o+" END Amount,\n"+o+" BillAmount",n&&(this.sbSubQuery+=",B.BillNo"),a&&(this.sbSubQuery+=",CONVERT(DATETIME,B.BillDate) BillDate"),this.sbSubQuery+=",C50002.Name AS Location,    \n(SELECT SUM("+o+") Adjusted FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND ",this.sbSubQuery+=this.PDCOnConvresionDate?"isnull(CB.ConvertedDate,CB.DocDate)<=@To":"CB.DocDate<=@To",this.sbSubQuery+=" AND CB.AccountID=B.AccountID AND CB.RefDocNo=B.DocNo"+A+" AND CB.RefDocSeqNo=B.DocSeqNo) Adjusted\n"+this.ViewModel.SelectTag+"\n,(B.DocDueDate-B.DocDate) CreditDays\n,@To-(CASE WHEN EXISTS (select * from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo)\nTHEN (select max(DueDate) from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo and DueDate<=@To)\nELSE B.DocDueDate END) OverDue\n,DocType,B.StatusID",this.ClubByVoucherNo&&(this.sbSubQuery+=",B.Narration"),this.PDCSeperate&&(this.sbSubQuery+=",case when DocType=14 or DocType=19 then 1 else 0 end IsPDC,null AgainstVoucher"),-1!=this.colLOBPDCIndex&&(this.sbSubQuery+=",(SELECT abs(SUM("+o+")) FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@To AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo and "+T+")=1)  LOBPDC"),this.sbSubQuery+=" \nFROM COM_Billwise B with(nolock) INNER JOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID     \nINNER JOIN COM_Location AS C50002 ON B.dcCCNID2 = C50002.NodeID ",this.ViewModel.SelectTag.length>0&&this.ViewModel.SelectTag.Contains("AT.AccountType")&&(this.sbSubQuery+=" INNER JOIN ACC_ACCOUNTTYPES AT WITH(NOLOCK) ON AT.AccountTypeID=A.AccountTypeID "),this.sbSubQuery+=S+this.ViewModel.FromTag,I&&(this.sbSubQuery+=c),this.sbSubQuery+=" WHERE B.IsNewReference=1 "):(this.sbSubQuery+="\tSELECT A.AccountID,B.DocSeqNo,"+R,this.sbSubQuery+=this.GetDateColumn("B",""),this.sbSubQuery+=",CONVERT(DATETIME,B.DocDueDate) DueDate,CONVERT(DATETIME,B.DocDate) VoucherDate,B.DocNo,\n"+o+" Amount,",this.ClubByVoucherNo?(this.sbSubQuery+="(select sum("+o+") from COM_Billwise CB with(nolock) where CB.AccountID=B.AccountID AND CB.DocNo=B.DocNo and IsNewReference=1) BillAmount",this.sbSubQuery+=",(SELECT SUM("+o+") Adjusted FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND ",this.sbSubQuery+=this.PDCOnConvresionDate?"isnull(CB.ConvertedDate,CB.DocDate)<=@To":"CB.DocDate<=@To",this.sbSubQuery+=" AND CB.AccountID=B.AccountID AND CB.RefDocNo=B.DocNo"+A+") AdjustedBillAmount"):this.sbSubQuery+=o+" BillAmount",n&&(this.sbSubQuery+=",B.BillNo"),a&&(this.sbSubQuery+=",CONVERT(DATETIME,B.BillDate) BillDate"),this.sbSubQuery+=",C50002.Name AS Location,    \n(SELECT SUM("+o+") Adjusted FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND ",this.sbSubQuery+=this.PDCOnConvresionDate?"isnull(CB.ConvertedDate,CB.DocDate)<=@To":"CB.DocDate<=@To",this.sbSubQuery+=" AND CB.AccountID=B.AccountID AND CB.RefDocNo=B.DocNo"+A+" AND CB.RefDocSeqNo=B.DocSeqNo) Adjusted\n"+this.ViewModel.SelectTag+",(B.DocDueDate-B.DocDate) CreditDays\n,@To-B."+this.ViewModel.Preferences.Date+" OverDue\n,DocType,B.StatusID",this.ClubByVoucherNo&&(this.sbSubQuery+=",B.Narration"),this.PDCSeperate&&(this.sbSubQuery+=",case when DocType=14 or DocType=19 then 1 else 0 end IsPDC,null AgainstVoucher"),-1!=this.colLOBPDCIndex&&(this.sbSubQuery+=",(SELECT abs(SUM("+o+")) FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@To AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo and "+T+")=1)  LOBPDC"),this.sbSubQuery+=" \nFROM COM_Billwise B with(nolock) INNER JOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID     \nINNER JOIN COM_Location AS C50002 with(nolock) ON B.dcCCNID2 = C50002.NodeID ",this.ViewModel.SelectTag.length>0&&this.ViewModel.SelectTag.Contains("AT.AccountType")&&(this.sbSubQuery+=" INNER JOIN ACC_ACCOUNTTYPES AT WITH(NOLOCK) ON AT.AccountTypeID=A.AccountTypeID "),this.sbSubQuery+=S+this.ViewModel.FromTag,I&&(this.sbSubQuery+=c),this.sbSubQuery+=" WHERE B.IsNewReference=1",this.sbSubQuery+=this.GetDateColumn("B","@To"));var M="";M+=m,I&&(M+=" AND A."+D),M+=_,M+=p,this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?M+=" AND 1<>1":M+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),this.ForeignCurrencyID>0&&(M+=" AND B.AdjCurrID="+this.ForeignCurrencyID),M+=this.GetDocumentTypeFilter(),this.sbSubQuery+=M.toString(),this.sbSubQuery+=" ) AS T ";var g="";if(this.UnAdjusted&&(g="Adjusted IS NULL"),this.SemiAdjusted&&(g.length>0&&(g+=" OR "),g+="abs(Amount+Adjusted)>"+this.AdjustmentRoundOff),this.Adjusted&&(g.length>0&&(g+=" OR "),g+="abs(Amount+Adjusted)<="+this.AdjustmentRoundOff),g="("+g+")",this.IsPaymentTermWise&&(g+=" AND DocDate<=@To AND Amount IS NOT NULL"),(g+=this.PDCInclude?this.PDCSeperate||this.FilterPDCOnMaturityDate?" AND (DocType<>14 AND DocType<>19"+d+")":" AND ("+T+" OR (DocType<>14 AND DocType<>19"+d+"))":" AND DocType<>14 AND DocType<>19"+d).length>0&&(this.sbSubQuery+=" WHERE "+g),this.PDCSeperate||this.FilterPDCOnMaturityDate){var w,f="PaymentTerm"==this.ViewModel.Preferences.Date?"B.DocDate":"B."+this.ViewModel.Preferences.Date;this.FilterPDCOnMaturityDate?(w="CM.ChequeMaturityDate",f="CM.ChequeMaturityDate"):w=f,this.sbSubQuery+="\nUNION ALL  SELECT *,case when Amount>0 then 1 else 0 end AmtOrder FROM (",this.sbSubQuery+="\tSELECT A.AccountID,B.DocSeqNo,"+R+"CONVERT(DATETIME,"+f+") DocDate,CONVERT(DATETIME,B.DocDueDate) DueDate,CONVERT(DATETIME,B.DocDate) VoucherDate,B.DocNo,\n"+o+" Amount,"+o+" BillAmount",this.ClubByVoucherNo&&(this.sbSubQuery+=",0 AdjustedBillAmount"),n&&(this.sbSubQuery+=",B.BillNo"),a&&(this.sbSubQuery+=",CONVERT(DATETIME,B.BillDate) BillDate"),this.sbSubQuery+=",C50002.Name AS Location,0 Adjusted"+this.ViewModel.SelectTag+"\n,(B.DocDueDate-B.DocDate) CreditDays\n,@To-"+f+" OverDue\n,DocType,B.StatusID",this.ClubByVoucherNo&&(this.sbSubQuery+=",B.Narration"),this.UnAppsDocsAdjustSeperate&&(this.sbSubQuery+=",0 IsUnappAdj"),this.PDCSeperate&&(this.sbSubQuery+=",1 IsPDC,case when B.IsNewReference=0 then B.RefDocNo else null end AgainstVoucher"),-1!=this.colLOBPDCIndex&&(this.sbSubQuery+=",(SELECT abs(SUM("+o+")) FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@To AND (SELECT top(1) 1 FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=CB.DocNo and "+T+")=1) LOBPDC"),this.sbSubQuery+=" \nFROM COM_Billwise B with(nolock) INNER JOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID     \nINNER JOIN COM_Location AS C50002 with(nolock) ON B.dcCCNID2 = C50002.NodeID ",this.ViewModel.SelectTag.length>0&&this.ViewModel.SelectTag.Contains("AT.AccountType")&&(this.sbSubQuery+=" INNER JOIN ACC_ACCOUNTTYPES AT WITH(NOLOCK) ON AT.AccountTypeID=A.AccountTypeID "),this.sbSubQuery+=S+this.ViewModel.FromTag,this.FilterPDCOnMaturityDate&&(this.sbSubQuery+=" \nINNER JOIN (select VoucherNo,max(ChequeMaturityDate) ChequeMaturityDate from acc_docdetails with(nolock) where "+T+" group by VoucherNo) as CM\nON CM.VoucherNo=B.DocNo "),I&&(this.sbSubQuery+=c),this.sbSubQuery+=" WHERE (B.DocType=19 or B.DocType=14)",this.AllowFromDateFilter&&(this.sbSubQuery+=" and "+w+">=@From "),this.sbSubQuery+=" and "+w+"<=@To ",this.sbSubQuery+=M.toString(),this.sbSubQuery+=" ) AS T ",g="",this.UnAdjusted&&(g="Adjusted IS NULL"),this.SemiAdjusted&&(g.length>0&&(g+=" OR "),g+="abs(Amount+Adjusted)>"+this.AdjustmentRoundOff),this.Adjusted&&(g.length>0&&(g+=" OR "),g+="abs(Amount+Adjusted)<="+this.AdjustmentRoundOff),g="("+g+")",(g+=" AND "+T).length>0&&(this.sbSubQuery+=" WHERE "+g)}if(this.sbSubQuery+=" ORDER BY "+this.strOrder,this.PDCSeperate&&(this.sbSubQuery+="IsPDC,"),this.UnPostedDocsSeparately&&(this.sbSubQuery+="StatusID,"),this.sbSubQuery+="DocDate,AmtOrder,DocNo",9==e){var E="";-1!=this.colRefAccount&&(E=s.a.report.GetReportData(18,0,"").Tables[0][0].RefAccount.toString()),this.sbSubQuery+="\nSELECT ",this.sbSubQuery+=this.PDCOnConvresionDate?"CONVERT(DATETIME,isnull(B.ConvertedDate,B.DocDate)) DocDate":"CONVERT(DATETIME, B.DocDate) DocDate",this.sbSubQuery+=",B.DocNo,B.RefDocSeqNo,"+o+" AS AdjAmount",n&&(this.sbSubQuery+=",B.BillNo"),a&&(this.sbSubQuery+=",CONVERT(DATETIME,B.BillDate) BillDate"),this.sbSubQuery+=this.ViewModel.SelectTag+E,this.sbSubQuery+=",RefDocNo,DATEDIFF(day,CONVERT(DATETIME,RefDocDate),CONVERT(DATETIME, B.DocDate)) PaidByDays\nFROM COM_Billwise B WITH(NOLOCK) INNER JOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID",this.ViewModel.SelectTag.length>0&&this.ViewModel.SelectTag.Contains("AT.AccountType")&&(this.sbSubQuery+=" INNER JOIN ACC_ACCOUNTTYPES AT WITH(NOLOCK) ON AT.AccountTypeID=A.AccountTypeID "),this.sbSubQuery+=this.ViewModel.FromTag,I&&(this.sbSubQuery+=c),this.sbSubQuery+=" WHERE IsNewReference=0",this.sbSubQuery+=this.PDCOnConvresionDate?" AND isnull(B.ConvertedDate,B.DocDate)<=@To ":" AND B.DocDate<=@To ",this.sbSubQuery+=A.Replace("CB.","B."),I&&(this.sbSubQuery+=" AND B."+D),this.sbSubQuery+=_}u=this.sbSubQuery.toString()}else if(11==e){var P;P=this.PDCInclude?" AND ("+T.Replace("StatusID","CB.StatusID")+" OR (DocType<>14 AND DocType<>19 AND "+C+"))":" AND DocType<>14 AND DocType<>19 AND "+C,this.sbSubQuery+=this.dtMonthWiseEndData?"DECLARE @AsOn FLOAT SET @AsOn=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.dtMonthWiseEndData.ToString("dd MMM yyyy")+"'))":"DECLARE @AsOn FLOAT SET @AsOn=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",this.AllowFromDateFilter&&(this.sbSubQuery+="\ndeclare @From float SET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))"),this.IsPaymentTermWise?(this.sbSubQuery+=" SELECT * FROM (SELECT "+R+"B.DocNo VoucherNo,"+o+" BillAmount"+this.ViewModel.SelectTag,this.sbSubQuery+=",CASE WHEN EXISTS (select * from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo)\nTHEN (select CONVERT(DATETIME,max(DueDate)) from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo and DueDate<=@AsOn)\nELSE CONVERT(DATETIME,ISNULL(B.DocDueDate,B.DocDate)) END DocDate, \nCONVERT(DATETIME,B.DocDueDate) DueDate,\nCASE WHEN EXISTS (select * from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo)\nTHEN (select sum(amount)*sign(B.AdjAmount)"+l+" from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo and DueDate<=@AsOn)\nELSE "+o+" END AdjAmount, @AsOn-B.DocDueDate OverDue"):(this.sbSubQuery+="\tSELECT "+R+"B.DocNo VoucherNo,"+o+" BillAmount"+this.ViewModel.SelectTag,this.sbSubQuery+=","+this.GetDateColumn("B",""),this.sbSubQuery+=",CONVERT(DATETIME,B.DocDueDate) DueDate,"+o+" AdjAmount,@AsOn-B."+this.ViewModel.Preferences.Date+" OverDue"),this.sbSubQuery+=",ISNULL((SELECT SUM(CB."+o+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0",this.sbSubQuery+=this.PDCOnConvresionDate?" AND ISNULL(CB.ConvertedDate,CB.DocDate)<=@AsOn":" AND CB.DocDate<=@AsOn",this.sbSubQuery+=P+"),0) Paid",this.sbSubQuery+=",(B.DocDueDate-B.DocDate) CreditDays",n&&(this.sbSubQuery+=",B.BillNo"),a&&(this.sbSubQuery+=",CONVERT(DATETIME,B.BillDate) BillDate"),-1==this.colPDCIndex&&-1==this.colNetBalanceIndex||(this.colPDCIndex=0,this.sbSubQuery+=",(SELECT abs(SUM(CB."+o+")) FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@AsOn AND "+C+m.Replace("B.","CB.")+") TotalPDC",this.PDCInclude&&(this.sbSubQuery+=",B.StatusID Status")),this.sbSubQuery+=",case when AdjAmount>0 then 1 else 0 end AmtOrder",this.BWAgeingShowOnlyDocs&&(this.sbSubQuery+=",DType.IsInventory",this.ViewModel.FromTag.Contains("DType")||(this.ViewModel.FromTag=" INNER JOIN (SELECT DocumentType,IsInventory FROM ADM_DocumentTypes with(nolock) Group By DocumentType,IsInventory) AS DType ON  DType.DocumentType=B.DocType "+this.ViewModel.FromTag)),this.sbSubQuery+=" FROM COM_Billwise B with(nolock) INNER JOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID ",this.ViewModel.SelectTag.length>0&&this.ViewModel.SelectTag.Contains("AT.AccountType")&&(this.sbSubQuery+=" INNER JOIN ACC_ACCOUNTTYPES AT WITH(NOLOCK) ON AT.AccountTypeID=A.AccountTypeID "),this.sbSubQuery+=S+this.ViewModel.FromTag,I&&(this.sbSubQuery+=c),this.sbSubQuery+=" WHERE B.IsNewReference=1",this.IsPaymentTermWise||(this.sbSubQuery+=this.GetDateColumn("B","@AsOn")),this.sbSubQuery+=m,"Receivables"==this.ViewModel.Preferences.IncludeBills?this.sbSubQuery+=" AND B."+o+">0":"Payables"==this.ViewModel.Preferences.IncludeBills&&(this.sbSubQuery+=" AND B."+o+"<0"),this.sbSubQuery+=this.GetDocumentTypeFilter(),this.sbSubQuery+=this.PDCInclude?" AND ("+T.Replace("StatusID","B.StatusID")+" OR (DocType<>14 AND DocType<>19 AND "+r+"))":" AND DocType<>14 AND DocType<>19 AND "+r,I&&(this.sbSubQuery+=" AND A."+D),this.sbSubQuery+=_,this.sbSubQuery+=p,this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?this.sbSubQuery+=" AND 1<>1":this.sbSubQuery+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),this.ForeignCurrencyID>0&&(this.sbSubQuery+=" AND B.AdjCurrID="+this.ForeignCurrencyID),this.IsPaymentTermWise?(this.sbSubQuery+=" ) AS T WHERE DocDate<=@AsOn AND AdjAmount IS NOT NULL ",this.sbSubQuery+=" ORDER BY "+this.strOrder+"DocDate,AmtOrder,VoucherNo",this.sbSubQuery+="\nSELECT PT.VoucherNo,PT.Amount"+l+" Amount,CONVERT(DATETIME,PT.DueDate) DueDate\nFROM  COM_Billwise B with(nolock) INNER JOIN COM_DocPayTerms PT with(nolock) ON PT.VoucherNo=B.DocNo",_.length>0&&(this.sbSubQuery+=" INNER JOIN ACC_Accounts A ON A.AccountID=B.AccountID"),I&&(this.sbSubQuery+=c),this.sbSubQuery+=" WHERE B.IsNewReference=1 and B.AccountID=PT.AccountID AND PT.DueDate<=@AsOn ",I&&(this.sbSubQuery+=" AND B."+D),this.sbSubQuery+=_,this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?this.sbSubQuery+=" AND 1<>1":this.sbSubQuery+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")")):this.sbSubQuery+=" ORDER BY "+this.strOrder+"DocDate,AmtOrder,DocNo",u=this.sbSubQuery.toString()}else if(12==e){var y;y=this.PDCInclude?" AND ("+T.Replace("StatusID","CB.StatusID")+" OR (DocType<>14 AND DocType<>19 AND "+C+"))":" AND DocType<>14 AND DocType<>19 AND "+C;var O=this.ViewModel.Preferences.ContainsKey("SalesDocs")?this.ViewModel.Preferences.SalesDocs:"",b=this.ViewModel.Preferences.ContainsKey("ReceiptDocs")?this.ViewModel.Preferences.ReceiptDocs:"",N=this.ViewModel.Preferences.ContainsKey("ChequeBounceDocs")?this.ViewModel.Preferences.ChequeBounceDocs:"";if(this.lstGroup.length<=1){var V="";if(O.length>0?(-1!=this.colTotalSaleIndex&&(V=",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+O+") AND SALE.DocDate>=@AccountingDate AND SALE.DocDate<=@AsOnDate"+d+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+O+") AND SALE.DocDate>=@AccountingDate AND SALE.DocDate<=@AsOnDate"+d+"),0)  TotalSale"),-1!=this.colPrevYearSaleIndex&&(V=V+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+O+") AND SALE.DocDate<@AccountingDate"+d+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+O+") AND SALE.DocDate<@AccountingDate"+d+"),0)  PrevYearSale"),-1!=this.colPeriodSaleIndex&&(V=V+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+O+") AND SALE.DocDate>=@FromDate AND SALE.DocDate<=@AsOnDate"+d+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+O+") AND SALE.DocDate>=@FromDate AND SALE.DocDate<=@AsOnDate"+d+"),0) PeriodSale")):(this.colTotalSaleIndex=-1,this.colPrevYearSaleIndex=-1,this.colPeriodSaleIndex=-1),b.length>0&&-1!=this.colReceiptsAmtIndex?(V=V+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+b+")",this.ViewModel.oReportDialog.FromDate.Visible&&(V+=" AND SALE.DocDate>=@FromDate"),V=V+" AND SALE.DocDate<=@AsOnDate"+d+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+b+")",this.ViewModel.oReportDialog.FromDate.Visible&&(V+=" AND SALE.DocDate>=@FromDate"),V=V+" AND SALE.DocDate<=@AsOnDate"+d+"),0) ReceiptsAmount"):this.colReceiptsAmtIndex=-1,N.length>0&&-1!=this.colChqBounceAmtIndex?(V=V+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+N+")",this.ViewModel.oReportDialog.FromDate.Visible&&(V+=" AND SALE.DocDate>=@FromDate"),V=V+" AND SALE.DocDate<=@AsOnDate"+d+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+N+")",this.ViewModel.oReportDialog.FromDate.Visible&&(V+=" AND SALE.DocDate>=@FromDate"),V=V+" AND SALE.DocDate<=@AsOnDate"+d+"),0) ChequeBounceAmount"):this.colChqBounceAmtIndex=-1,-1!=this.colUnDueIndex&&(V=this.IsDocDateWise?V+",(select sum(AMT) from (select B."+o+"+case when B.DocDueDate is not null and B.DocDueDate >@AsOnDate then B."+o+" else 0 end\nAMT FROM COM_Billwise B WITH(NOLOCK) WHERE B.IsNewReference=1 AND B.AccountID=A.AccountID":V+",(select sum(AMT) from (select B."+o+" \n+(case when isnull(B.DocDueDate,B.DocDate)>@AsOnDate then ISNULL((SELECT SUM(CB."+o+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND CB.IsNewReference=0"+y+"),0) else 0 end)\nAMT FROM COM_Billwise B WITH(NOLOCK) WHERE B.IsNewReference=1 AND B.AccountID=A.AccountID",V+=m,V+=this.PDCInclude?" AND ("+T.Replace("StatusID","B.StatusID")+" OR (DocType<>14 AND DocType<>19 AND "+r+"))":" AND DocType<>14 AND DocType<>19 AND "+r,this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?V+=" AND 1<>1":V+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),this.ForeignCurrencyID>0&&(V+=" AND B.AdjCurrID="+this.ForeignCurrencyID),V+=") as T) ActualBill"),-1==this.colPDCIndex&&-1==this.colIncludingPDCIndex||(V+=",ISNULL((SELECT SUM(CB."+o+") FROM COM_Billwise CB with(nolock) WHERE CB.AccountID=A.AccountID AND IsNewReference=1 AND CB.DocDate<=@AsOnDate AND "+T.Replace("StatusID","CB.StatusID")+m.Replace("B.","CB.")+"),0) TotalPDC "),this.lstGroup.length>0&&(this.lstGroup[0].ID="AccountName",this.ViewModel.Groupstr.Clear(),this.ViewModel.Groupstr.push("AccountName","")),this.LevelNo=0,this.ShowLevelTree=!1,this.ViewModel.Preferences.ContainsKey("ShowLevel")){var v=new i.f;v.LoadXml("<XML>"+this.ViewModel.Preferences.ShowLevel+"</XML>");var L=i.f.SelectSingleNode(v.DocumentElement,"IsChecked");null!=L&&"1"==L.innerHTML&&(this.ShowLevelTree=!0,L=i.f.SelectSingleNode(v.DocumentElement,"Text"),this.LevelNo=parseInt(L.innerHTML))}this.sbSubQuery="",this.sbSubQuery+="DECLARE @AccountingDate FLOAT,@AsOnDate FLOAT\nSET @AccountingDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+s.a.SessionManager.AccountingDate.ToString("dd MMM yyyy")+"'))",this.AllowFromDateFilter&&(this.sbSubQuery+="\ndeclare @From float SET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))"),this.sbSubQuery+=this.dtMonthWiseEndData?" SET @AsOnDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.dtMonthWiseEndData.ToString("dd MMM yyyy")+"'))":" SET @AsOnDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",(this.ViewModel.oReportDialog.FromDate.Visible||-1!=this.colPeriodSaleIndex)&&(this.sbSubQuery+="\ndeclare @FromDate float SET @FromDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"')) "),this.ShowLevelTree?(this.sbSubQuery+="SELECT A.AccountID,A.AccountName,A.lft,A.rgt,A.IsGroup,A.Depth"+V+this.ViewModel.SelectTag+" FROM ACC_Accounts A with(nolock)",this.ViewModel.SelectTag.length>0&&this.ViewModel.SelectTag.Contains("AT.AccountType")&&(this.sbSubQuery+=" INNER JOIN ACC_ACCOUNTTYPES AT WITH(NOLOCK) ON AT.AccountTypeID=A.AccountTypeID "),this.sbSubQuery+=this.ViewModel.FromTag,I&&(this.sbSubQuery+=c),this.sbSubQuery+=" WHERE A.Depth>0",I&&(this.sbSubQuery+=" AND A."+D),this.sbSubQuery+=_,p.length>0&&(this.sbSubQuery+=p),this.sbSubQuery+=" ORDER BY A.lft"):(this.sbSubQuery+="SELECT A.AccountID,A.AccountName"+V+this.ViewModel.SelectTag+" FROM ACC_Accounts A with(nolock)",this.ViewModel.SelectTag.length>0&&this.ViewModel.SelectTag.Contains("AT.AccountType")&&(this.sbSubQuery+=" INNER JOIN ACC_ACCOUNTTYPES AT WITH(NOLOCK) ON AT.AccountTypeID=A.AccountTypeID "),this.sbSubQuery+=this.ViewModel.FromTag,I&&(this.sbSubQuery+=c),this.sbSubQuery+=" WHERE A.Depth>0",I&&(this.sbSubQuery+=" AND A."+D),this.sbSubQuery+=_,this.sbSubQuery+=p,this.sbSubQuery+=" ORDER BY A.AccountName");var B="";this.IsPaymentTermWise?(B+="\nSELECT *,Amount+Paid AdjAmount FROM (SELECT B.DocNo,"+o+" BillAmount, CASE WHEN EXISTS (select * from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo)\nTHEN (select CONVERT(DATETIME,max(DueDate)) from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo and DueDate<=@AsOnDate)\nELSE CONVERT(DATETIME,ISNULL(B.DocDueDate,B.DocDate)) END DocDate,B.AccountID\n\n,CASE WHEN EXISTS (select * from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo)\nTHEN (select sum(amount)*sign(B.AdjAmount)"+l+" from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo and DueDate<=@AsOnDate)\nELSE "+o+" END Amount,\nISNULL(\n(SELECT SUM(CB."+o+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND ",B+=this.PDCOnConvresionDate?"isnull(CB.ConvertedDate,CB.DocDate)<=@AsOnDate":"CB.DocDate<=@AsOnDate",B+=y+"),0) Paid"):(B+=" SELECT * from (",B+=" SELECT ",B+=this.GetDateColumn("B",""),-1!=this.colUnDueIndex&&(B+=",AdjAmount Amount"),-1!=this.colBillAmtIndex&&(B+=","+o+" BillAmount"),B+=",B.AccountID,"+o+"+ISNULL((SELECT SUM(CB."+o+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND CB.IsNewReference=0",B+=this.PDCOnConvresionDate?" AND isnull(CB.ConvertedDate,CB.DocDate)<=@AsOnDate":" AND CB.DocDate<=@AsOnDate",B+=y+"),0) AdjAmount",this.AgeingBasedOnMaturityDate&&(B+=",convert(datetime,CM.ChequeMaturityDate) CqMaturityDate")),-1==this.colPDCIndex&&-1==this.colIncludingPDCIndex||(this.colPDCIndex=0,B+=",ISNULL((SELECT SUM(CB."+o+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@AsOnDate AND "+T.Replace("StatusID","CB.StatusID")+m.Replace("B.","CB.")+"),0) TotalPDC "),(-1!=this.colPDCIndex||-1!=this.colIncludingPDCIndex||this.AgeingBasedOnMaturityDate)&&this.PDCInclude&&(B+=",B.StatusID Status"),B+=" FROM COM_Billwise B WITH(NOLOCK)",(p.length>0||_.length>0)&&(B+=" INNER JOIN ACC_Accounts A ON A.AccountID=B.AccountID"+p),I&&(B+=c),this.AgeingBasedOnMaturityDate&&(B+=" \nINNER JOIN (select VoucherNo,max(ChequeMaturityDate) ChequeMaturityDate from acc_docdetails with(nolock) where "+T+" group by VoucherNo) as CM\nON CM.VoucherNo=B.DocNo "),B+=" WHERE B.IsNewReference=1",this.IsPaymentTermWise||(B+=this.GetDateColumn("B","@AsOnDate")),B+=m,B+=this.PDCInclude?" AND ("+T.Replace("StatusID","B.StatusID")+" OR (DocType<>14 AND DocType<>19 AND "+r+"))":" AND DocType<>14 AND DocType<>19 AND "+r,I&&(B+=" AND B."+D),B+=_,this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?B+=" AND 1<>1":B+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),this.ForeignCurrencyID>0&&(B+=" AND B.AdjCurrID="+this.ForeignCurrencyID),this.IsPaymentTermWise?(B+=" ) AS T WHERE DocDate<=@AsOnDate AND Amount IS NOT NULL ",B+="\nSELECT PT.VoucherNo,PT.Amount"+l+" Amount,CONVERT(DATETIME,PT.DueDate) DueDate\nFROM  COM_Billwise B with(nolock) INNER JOIN COM_DocPayTerms PT with(nolock) ON PT.VoucherNo=B.DocNo",_.length>0&&(B+=" INNER JOIN ACC_Accounts A ON A.AccountID=B.AccountID"),I&&(B+=c),B+=" WHERE B.IsNewReference=1 and B.AccountID=PT.AccountID AND PT.DueDate<=@AsOnDate ",I&&(B+=" AND B."+D),B+=_,this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?B+=" AND 1<>1":B+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")")):(B+=this.AdjustmentRoundOff>0?" ) AS T WHERE abs(AdjAmount)>"+this.AdjustmentRoundOff:" ) AS T WHERE AdjAmount!=0",-1!=this.colPDCIndex&&(B+=" or TotalPDC!=0")),u=this.sbSubQuery.toString()+B.toString(),this.FutureSlabs&&(u+=B.toString().Replace("<=@AsOnDate",">@AsOnDate"))}else{this.LevelNo=0,this.ShowLevelTree=!1,this.ViewModel.FormulaObjects.Clear(),this.ViewModel.BaseReportColumns.forEach((function(e){i.e.IsEmpty(e.Formula.Text)||h.ViewModel.ParseFormula(e,!0)})),this.ViewModel.ReportGroups.forEach((function(e){i.e.IsEmpty(e.Formula.Text)||h.ViewModel.ParseFormula(e,!0)})),this.sbSubQuery="",R="",S="",this.strOrder="";var F=new Array,G=new Array;this.ViewModel.ReportGroups.forEach((function(e){(2==e.CDGDO.ColumnCostCenterID||e.CDGDO.ColumnCostCenterID>5e4)&&(2==e.CDGDO.CategoryValue?(e.CDGDO.ParentTableAlias="CC"+e.CDGDO.ColumnCostCenterID,i.e.IsEmpty(e.FormulaExpression)&&(R+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+" AS "+e.ID+","),G.Contains(e.CDGDO.ColumnCostCenterID)||(G.push(e.CDGDO.ColumnCostCenterID),S.Contains("CCD"+e.CDGDO.CategoryValue+".CostCenterID="+e.CDGDO.CategoryValue)||(S+=" INNER JOIN "+e.CDGDO.ParentTable+" AS CCD"+e.CDGDO.CategoryValue,S+=" WITH(NOLOCK) ON CCD"+e.CDGDO.CategoryValue+".NodeID=A.AccountID AND CCD"+e.CDGDO.CategoryValue+".CostCenterID="+e.CDGDO.CategoryValue),S+=" INNER JOIN "+e.CDGDO.ParentCostCenterSysName+" AS "+e.CDGDO.ParentTableAlias,S+=" WITH(NOLOCK) ON "+e.CDGDO.ParentTableAlias+".NodeID=CCD"+e.CDGDO.CategoryValue+"."+e.CDGDO.ParentColumn,h.strOrder+=e.ID+",")):(e.CDGDO.ParentTableAlias="C"+e.CDGDO.ColumnCostCenterID,i.e.IsEmpty(e.FormulaExpression)&&(R+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+" AS "+e.ID+","),F.Contains(e.CDGDO.ColumnCostCenterID)||(F.push(e.CDGDO.ColumnCostCenterID),S+=" INNER JOIN "+e.CDGDO.ParentCostCenterSysName+" AS "+e.CDGDO.ParentTableAlias,S+=2==e.CDGDO.ColumnCostCenterID?" with(nolock) ON "+e.CDGDO.ParentTableAlias+".AccountID=B.AccountID":" with(nolock) ON "+e.CDGDO.ParentTableAlias+".NodeID=B."+e.CDGDO.ParentColumn,h.strOrder+=e.ID+",")))})),this.ViewModel.BaseReportColumns.forEach((function(e){"0"==e.ShowAsColumn.SelectedValue&&(2==e.CDGDO.ColumnCostCenterID||e.CDGDO.ColumnCostCenterID>5e4)&&(2==e.CDGDO.CategoryValue?(e.CDGDO.ParentTableAlias="CC"+e.CDGDO.ColumnCostCenterID,R+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+" AS "+e.ID+",",G.Contains(e.CDGDO.ColumnCostCenterID)||(G.push(e.CDGDO.ColumnCostCenterID),S.Contains("CCD"+e.CDGDO.CategoryValue+".CostCenterID="+e.CDGDO.CategoryValue)||(S+=" INNER JOIN "+e.CDGDO.ParentTable+" AS CCD"+e.CDGDO.CategoryValue,S+=" WITH(NOLOCK) ON CCD"+e.CDGDO.CategoryValue+".NodeID=A.AccountID AND CCD"+e.CDGDO.CategoryValue+".CostCenterID="+e.CDGDO.CategoryValue),S+=" INNER JOIN "+e.CDGDO.ParentCostCenterSysName+" AS "+e.CDGDO.ParentTableAlias,S+=" WITH(NOLOCK) ON "+e.CDGDO.ParentTableAlias+".NodeID=CCD"+e.CDGDO.CategoryValue+"."+e.CDGDO.ParentColumn)):(e.CDGDO.ParentTableAlias="C"+e.CDGDO.ColumnCostCenterID,R+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+" AS "+e.ID+",",F.Contains(e.CDGDO.ColumnCostCenterID)||(F.push(e.CDGDO.ColumnCostCenterID),S+=" INNER JOIN "+e.CDGDO.ParentCostCenterSysName+" AS "+e.CDGDO.ParentTableAlias,S+=2==e.CDGDO.ColumnCostCenterID?" ON "+e.CDGDO.ParentTableAlias+".AccountID=B.AccountID":" ON "+e.CDGDO.ParentTableAlias+".NodeID=B."+e.CDGDO.ParentColumn)))})),F.Contains(2)?(this.ViewModel.SelectTag=this.ViewModel.SelectTag.Replace("A.","C2."),this.ViewModel.FromTag=this.ViewModel.FromTag.Replace("A.","C2."),S=S.Replace("A.","C2.")):(this.ViewModel.SelectTag="",this.ViewModel.FromTag="");var x="";if(O.length>0){var W="";F.forEach((function(e){e>=5e4&&(W+=" AND DCC.dcCCNID"+(e-5e4)+"=B.dcCCNID"+(e-5e4))})),-1!=this.colTotalSaleIndex&&(x=",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=SALE.InvDocDetailsID WHERE SALE.DebitAccount=B.AccountID "+W+" AND SALE.CostCenterID IN ("+O+") AND SALE.DocDate>=@AccountingDate AND SALE.DocDate<=@AsOnDate"+d+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=SALE.InvDocDetailsID WHERE SALE.CreditAccount=B.AccountID "+W+" AND SALE.CostCenterID IN ("+O+") AND SALE.DocDate>=@AccountingDate AND SALE.DocDate<=@AsOnDate"+d+"),0)  TotalSale"),-1!=this.colPrevYearSaleIndex&&(x=x+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=SALE.InvDocDetailsID WHERE SALE.DebitAccount=B.AccountID "+W+" AND SALE.CostCenterID IN ("+O+") AND SALE.DocDate<@AccountingDate"+d+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=SALE.InvDocDetailsID WHERE SALE.CreditAccount=B.AccountID "+W+" AND SALE.CostCenterID IN ("+O+") AND SALE.DocDate<@AccountingDate"+d+"),0)  PrevYearSale"),-1!=this.colPeriodSaleIndex&&(x=x+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=SALE.InvDocDetailsID WHERE SALE.DebitAccount=B.AccountID "+W+" AND SALE.CostCenterID IN ("+O+") AND SALE.DocDate>=@FromDate AND SALE.DocDate<=@AsOnDate"+d+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=SALE.InvDocDetailsID WHERE SALE.CreditAccount=B.AccountID "+W+" AND SALE.CostCenterID IN ("+O+") AND SALE.DocDate>=@FromDate AND SALE.DocDate<=@AsOnDate"+d+"),0) PeriodSale")}else this.colTotalSaleIndex=-1,this.colPrevYearSaleIndex=-1,this.colPeriodSaleIndex=-1;b.length>0&&-1!=this.colReceiptsAmtIndex?(x=x+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+b+")",this.ViewModel.oReportDialog.FromDate.Visible&&(x+=" AND SALE.DocDate>=@FromDate"),x=x+" AND SALE.DocDate<=@AsOnDate"+d+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+b+")",this.ViewModel.oReportDialog.FromDate.Visible&&(x+=" AND SALE.DocDate>=@FromDate"),x=x+" AND SALE.DocDate<=@AsOnDate"+d+"),0) ReceiptsAmount"):this.colReceiptsAmtIndex=-1,N.length>0&&-1!=this.colChqBounceAmtIndex?(x=x+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+N+")",this.ViewModel.oReportDialog.FromDate.Visible&&(x+=" AND SALE.DocDate>=@FromDate"),x=x+" AND SALE.DocDate<=@AsOnDate"+d+"),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+N+")",this.ViewModel.oReportDialog.FromDate.Visible&&(x+=" AND SALE.DocDate>=@FromDate"),x=x+" AND SALE.DocDate<=@AsOnDate"+d+"),0) ChequeBounceAmount"):this.colChqBounceAmtIndex=-1,this.colUnDueIndex=-1,this.sbSubQuery+="DECLARE @AccountingDate FLOAT,@AsOnDate FLOAT\nSET @AccountingDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+s.a.SessionManager.AccountingDate.ToString("dd MMM yyyy")+"'))",this.AllowFromDateFilter&&(this.sbSubQuery+="\ndeclare @From float SET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))"),this.sbSubQuery+=this.dtMonthWiseEndData?" SET @AsOnDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.dtMonthWiseEndData.ToString("dd MMM yyyy")+"'))":" SET @AsOnDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",(this.ViewModel.oReportDialog.FromDate.Visible||-1!=this.colPeriodSaleIndex)&&(this.sbSubQuery+="\ndeclare @FromDate float SET @FromDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"')) ");var k="";this.IsPaymentTermWise?(k+="\nSELECT *,Amount+Paid AdjAmount FROM (SELECT "+R+"B.DocNo, CASE WHEN EXISTS (select * from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo)\nTHEN (select CONVERT(DATETIME,max(DueDate)) from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo and DueDate<=@AsOnDate)\nELSE CONVERT(DATETIME,ISNULL(B.DocDueDate,B.DocDueDate)) END DocDate,B.AccountID\n\n,CASE WHEN EXISTS (select * from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo)\nTHEN (select sum(amount)*sign(B.AdjAmount)"+l+" from COM_DocPayTerms with(nolock) where VoucherNo=B.DocNo and DueDate<=@AsOnDate)\nELSE "+o+" END Amount,\nISNULL(\n(SELECT SUM(CB."+o+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND ",k+=this.PDCOnConvresionDate?"isnull(CB.ConvertedDate,CB.DocDate)<=@AsOnDate":"CB.DocDate<=@AsOnDate",k+=y+"),0) Paid"):(k+=" SELECT * from (",k+=" SELECT "+R,k+="B.AccountID,",k+=this.GetDateColumn("B",""),k+=",B.DocNo,"+o+" + ISNULL((SELECT SUM(CB."+o+") FROM COM_Billwise CB WHERE CB.RefDocNo=B.DocNo AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0",k+=this.PDCOnConvresionDate?" AND isnull(CB.ConvertedDate,CB.DocDate)<=@AsOnDate":" AND CB.DocDate<=@AsOnDate",k+=y+"),0) AdjAmount ",this.AgeingBasedOnMaturityDate&&(k+=",convert(datetime,CM.ChequeMaturityDate) CqMaturityDate")),-1==this.colPDCIndex&&-1==this.colIncludingPDCIndex||(this.colPDCIndex=0,k+=",ISNULL((SELECT SUM(CB."+o+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@AsOnDate AND "+T.Replace("StatusID","CB.StatusID")+m.Replace("B.","CB.")+"),0) TotalPDC "),(-1!=this.colPDCIndex||-1!=this.colIncludingPDCIndex||this.AgeingBasedOnMaturityDate)&&this.PDCInclude&&(k+=",B.StatusID Status"),k+=x,k+=this.ViewModel.SelectTag,k+=" FROM COM_Billwise B with(nolock)"+S+this.ViewModel.FromTag,I&&(k+=c),this.AgeingBasedOnMaturityDate&&(k+=" \nINNER JOIN (select VoucherNo,max(ChequeMaturityDate) ChequeMaturityDate from acc_docdetails with(nolock) where "+T+" group by VoucherNo) as CM\nON CM.VoucherNo=B.DocNo "),k+=" WHERE B.IsNewReference=1",F.Contains(2)&&p.length>0&&(k+=p.Replace("A.","C2.")),this.IsPaymentTermWise||(k+=this.GetDateColumn("B","@AsOnDate")),k+=m,k+=this.PDCInclude?" AND ("+T.Replace("StatusID","B.StatusID")+" OR (DocType<>14 AND DocType<>19 AND "+r+"))":" AND DocType<>14 AND DocType<>19 AND "+r,I&&(k+=" AND B."+D),this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?k+=" AND 1<>1":k+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),this.ForeignCurrencyID>0&&(k+=" AND B.AdjCurrID="+this.ForeignCurrencyID),this.IsPaymentTermWise?(k+=" ) AS T WHERE DocDate<=@AsOnDate AND Amount IS NOT NULL ",k+="\nSELECT PT.VoucherNo,PT.Amount"+l+" Amount,CONVERT(DATETIME,PT.DueDate) DueDate\nFROM  COM_Billwise B with(nolock) INNER JOIN COM_DocPayTerms PT with(nolock) ON PT.VoucherNo=B.DocNo",I&&(k+=c),k+=" WHERE B.IsNewReference=1 and B.AccountID=PT.AccountID AND PT.DueDate<=@AsOnDate ",I&&(k+=" AND B."+D),this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?k+=" AND 1<>1":k+=" AND B.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")")):(k+=this.AdjustmentRoundOff>0?" ) AS T WHERE abs(AdjAmount)>"+this.AdjustmentRoundOff:" ) AS T WHERE AdjAmount!=0",-1!=this.colPDCIndex&&(k+=" or TotalPDC!=0")),u=this.sbSubQuery.toString()+k.toString(),this.FutureSlabs&&(u+=k.toString().Replace("<=@AsOnDate",">@AsOnDate"))}}return s.a.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,u)}},{key:"GetDataSetFIFO",value:function(e,t){var o,l,n,a=this,r="",h="",u="",c="",D=0;l=0!=this.oColumns.filter((function(e){return"BillNo"==e.ID})).length,n=0!=this.oColumns.filter((function(e){return"BillDate"==e.ID})).length;var d;u="B.StatusID=369 or B.StatusID=429",this.UnPostedDocsList.length>0&&this.UnPostedDocsList.split(",").forEach((function(e){u+=" or B.StatusID="+e})),u=" and ("+u+")";var C="";this.UnPostedDocsList.length>0&&this.UnPostedDocsList.split(",").forEach((function(e){C+=" or StatusID="+e}));var p="(StatusID=370 OR StatusID=439"+C+(this.IncludeTerminatedPDC?" OR StatusID=452":"")+")";o=this.ForeignCurrencyID>0?"AmountFC":1==this.CurrencyType?"isnull(AmountBC,0)":"Amount",this.ViewModel.HideCostCenterTree||this.ViewModel.oReportDialog.IsZeroSelected||this.ViewModel.oReportDialog.IsOneSelected||(this.ViewModel.oReportDialog.IsGroupExists?(h="AccountID=GTP.GTID",r=t.Contains(",")?",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID IN ("+t+") group by T.AccountID) AS GTP ":",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID="+t+" group by T.AccountID) AS GTP "):h=t.Contains(",")?"AccountID IN ("+t+")":"AccountID="+t),d=this.GetAccountTypeWhere("A"),this.sbSubQuery="",this.GroupRowsCount=0;var T="",_="",m="";this.strOrder="",this.ViewModel.ReportGroups.forEach((function(e){2==e.CDGDO.ColumnCostCenterID?(T+="A."+e.CDGDO.Column+" AS "+e.ID+",A.AccountID AS "+e.ID+"_ID,","1"!=e.ShowAsColumn.SelectedValue&&(a.AccountGroupIndex=a.GroupRowsCount)):e.CDGDO.ColumnCostCenterID>5e4&&400==e.CDGDO.CategoryValue&&(e.CDGDO.ParentTableAlias="C"+e.CDGDO.ColumnCostCenterID,T+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+" AS "+e.ID+","+e.CDGDO.ParentTableAlias+".NodeID AS "+e.ID+"_ID,",m+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+","+e.CDGDO.ParentTableAlias+".NodeID,",11!=a.ViewModel.StaticReportType&&12!=a.ViewModel.StaticReportType&&50002==e.CDGDO.ColumnCostCenterID||(_+=" INNER JOIN "+e.CDGDO.ParentCostCenterSysName+" AS "+e.CDGDO.ParentTableAlias,_+=" WITH(NOLOCK) ON "+e.CDGDO.ParentTableAlias+".NodeID=DCC."+e.CDGDO.ParentColumn),D=e.CDGDO.ColumnCostCenterID,c=e.ID+"_ID,"),a.strOrder+=e.ID+",","1"!=e.ShowAsColumn.SelectedValue&&a.GroupRowsCount++}));var I="";if(12==e){if(this.ShowLevelTree=!1,this.ViewModel.Preferences.ContainsKey("ShowLevel")){var R=new i.f;R.LoadXml("<XML>"+this.ViewModel.Preferences.ShowLevel+"</XML>");var S=i.f.SelectSingleNode(R.DocumentElement,"IsChecked");null!=S&&"1"==S.innerHTML&&(this.ShowLevelTree=!0,S=i.f.SelectSingleNode(R.DocumentElement,"Text"),this.LevelNo=parseInt(S.innerHTML))}var A=this.ViewModel.Preferences.ContainsKey("SalesDocs")?this.ViewModel.Preferences.SalesDocs:"";if(this.lstGroup.length<=1)A.length>0?(-1!=this.colTotalSaleIndex&&(I=",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+A+") AND SALE.DocDate>=@AccountingDate AND SALE.DocDate<=@To),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+A+") AND SALE.DocDate>=@AccountingDate AND SALE.DocDate<=@To),0)  TotalSale"),-1!=this.colPrevYearSaleIndex&&(I=I+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.DebitAccount=A.AccountID AND SALE.CostCenterID IN ("+A+") AND SALE.DocDate<@AccountingDate),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE with(nolock) WHERE SALE.CreditAccount=A.AccountID AND SALE.CostCenterID IN ("+A+") AND SALE.DocDate<@AccountingDate),0)  PrevYearSale")):(this.colTotalSaleIndex=-1,this.colPrevYearSaleIndex=-1),-1==this.colPDCIndex&&-1==this.colIncludingPDCIndex||(this.colPDCIndex=0,T+="ISNULL(sum(case when "+p.Replace("StatusID","B.StatusID")+" then B."+o+" else 0 end),0) TotalPDC,",this.PDCInclude&&(T+="B.StatusID Status,"));else{T="",_="",this.strOrder="";var M=new Array,g=new Array;if(this.ViewModel.ReportGroups.forEach((function(e){(2==e.CDGDO.ColumnCostCenterID||e.CDGDO.ColumnCostCenterID>5e4)&&(2==e.CDGDO.CategoryValue?(e.CDGDO.ParentTableAlias="CC"+e.CDGDO.ColumnCostCenterID,i.e.IsEmpty(e.FormulaExpression)&&(T+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+" AS "+e.ID+","),g.Contains(e.CDGDO.ColumnCostCenterID)||(g.push(e.CDGDO.ColumnCostCenterID),_.Contains("CCD"+e.CDGDO.CategoryValue+".CostCenterID="+e.CDGDO.CategoryValue)||(_+=" INNER JOIN "+e.CDGDO.ParentTable+" AS CCD"+e.CDGDO.CategoryValue,_+=" WITH(NOLOCK) ON CCD"+e.CDGDO.CategoryValue+".NodeID=A.AccountID AND CCD"+e.CDGDO.CategoryValue+".CostCenterID="+e.CDGDO.CategoryValue),_+=" INNER JOIN "+e.CDGDO.ParentCostCenterSysName+" AS "+e.CDGDO.ParentTableAlias,_+=" WITH(NOLOCK) ON "+e.CDGDO.ParentTableAlias+".NodeID=CCD"+e.CDGDO.CategoryValue+"."+e.CDGDO.ParentColumn,a.strOrder+=e.ID+",")):(e.CDGDO.ParentTableAlias="C"+e.CDGDO.ColumnCostCenterID,i.e.IsEmpty(e.FormulaExpression)&&(T+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+" AS "+e.ID+","),M.Contains(e.CDGDO.ColumnCostCenterID)||(M.push(e.CDGDO.ColumnCostCenterID),_+=" INNER JOIN "+e.CDGDO.ParentCostCenterSysName+" AS "+e.CDGDO.ParentTableAlias,_+=2==e.CDGDO.ColumnCostCenterID?" with(nolock) ON "+e.CDGDO.ParentTableAlias+".AccountID=B.AccountID":" with(nolock) ON "+e.CDGDO.ParentTableAlias+".NodeID=B."+e.CDGDO.ParentColumn,a.strOrder+=e.ID+",")))})),this.ViewModel.BaseReportColumns.forEach((function(e){"0"==e.ShowAsColumn.SelectedValue&&(2==e.CDGDO.ColumnCostCenterID||e.CDGDO.ColumnCostCenterID>5e4)&&(2==e.CDGDO.CategoryValue?(e.CDGDO.ParentTableAlias="CC"+e.CDGDO.ColumnCostCenterID,T+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+" AS "+e.ID+",",g.Contains(e.CDGDO.ColumnCostCenterID)||(g.push(e.CDGDO.ColumnCostCenterID),_.Contains("CCD"+e.CDGDO.CategoryValue+".CostCenterID="+e.CDGDO.CategoryValue)||(_+=" INNER JOIN "+e.CDGDO.ParentTable+" AS CCD"+e.CDGDO.CategoryValue,_+=" WITH(NOLOCK) ON CCD"+e.CDGDO.CategoryValue+".NodeID=A.AccountID AND CCD"+e.CDGDO.CategoryValue+".CostCenterID="+e.CDGDO.CategoryValue),_+=" INNER JOIN "+e.CDGDO.ParentCostCenterSysName+" AS "+e.CDGDO.ParentTableAlias,_+=" WITH(NOLOCK) ON "+e.CDGDO.ParentTableAlias+".NodeID=CCD"+e.CDGDO.CategoryValue+"."+e.CDGDO.ParentColumn)):(e.CDGDO.ParentTableAlias="C"+e.CDGDO.ColumnCostCenterID,T+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+" AS "+e.ID+",",M.Contains(e.CDGDO.ColumnCostCenterID)||(M.push(e.CDGDO.ColumnCostCenterID),_+=" INNER JOIN "+e.CDGDO.ParentCostCenterSysName+" AS "+e.CDGDO.ParentTableAlias,_+=2==e.CDGDO.ColumnCostCenterID?" ON "+e.CDGDO.ParentTableAlias+".AccountID=B.AccountID":" ON "+e.CDGDO.ParentTableAlias+".NodeID=B."+e.CDGDO.ParentColumn)))})),M.Contains(2)?(this.ViewModel.SelectTag=this.ViewModel.SelectTag.Replace("A.","C2."),this.ViewModel.FromTag=this.ViewModel.FromTag.Replace("A.","C2."),_=_.Replace("A.","C2.")):(this.ViewModel.SelectTag="",this.ViewModel.FromTag=""),A.length>0){var w="";M.forEach((function(e){e>=5e4&&(w+=" AND DCC.dcCCNID"+(e-5e4)+"=B.dcCCNID"+(e-5e4))})),-1!=this.colTotalSaleIndex&&(I=",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=SALE.InvDocDetailsID WHERE SALE.DebitAccount=B.AccountID "+w+" AND SALE.CostCenterID IN ("+A+") AND SALE.DocDate>=@AccountingDate AND SALE.DocDate<=@To),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=SALE.InvDocDetailsID WHERE SALE.CreditAccount=B.AccountID "+w+" AND SALE.CostCenterID IN ("+A+") AND SALE.DocDate>=@AccountingDate AND SALE.DocDate<=@To),0)  TotalSale"),-1!=this.colPrevYearSaleIndex&&(I=I+",ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=SALE.InvDocDetailsID WHERE SALE.DebitAccount=B.AccountID "+w+" AND SALE.CostCenterID IN ("+A+") AND SALE.DocDate<@AccountingDate),0) \n- ISNULL((SELECT SUM(SALE.Amount) FROM ACC_DocDetails SALE INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=SALE.InvDocDetailsID WHERE SALE.CreditAccount=B.AccountID "+w+" AND SALE.CostCenterID IN ("+A+") AND SALE.DocDate<@AccountingDate),0)  PrevYearSale")}else this.colTotalSaleIndex=-1,this.colPrevYearSaleIndex=-1;-1==this.colPDCIndex&&-1==this.colIncludingPDCIndex||(this.colPDCIndex=0,T+="ISNULL(sum(case when "+p.Replace("StatusID","B.StatusID")+" then B."+o+" else 0 end),0) TotalPDC,",this.PDCInclude&&(T+="B.StatusID Status,"))}}else this.ViewModel.FromTag=this.ViewModel.FromTag+_;if(10==e||11==e||12==e){var f="";f+=this.GetDimensionFilter("DCC.dcCCNID"),f+=d,this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?f+=" AND 1<>1":f+=" AND DCC.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")");var E=[];return E.push(e),E.push(r),E.push(h),E.push(12==e?s.a.SessionManager.AccountingDate:this.ViewModel.oReportDialog.ToDate.Date),E.push(this.ViewModel.oReportDialog.ToDate.Date),E.push(this.ViewModel.Preferences.Date),E.push("Payables"==this.ViewModel.Preferences.IncludeBills?0:1),E.push(u),E.push(f.toString()),E.push(this.PDCInclude),E.push(this.PDCSeperate),E.push(this.FilterPDCOnMaturityDate),E.push(this.CurrencyType),E.push(this.ForeignCurrencyID),E.push(12==e?this.ShowLevelTree:l),E.push(n),E.push(I),E.push(12==e?d:""),E.push(T),E.push(D),E.push(c),E.push(m),E.push(this.ViewModel.SelectTag),E.push(this.ViewModel.SelectTagAliasOnly),E.push(this.ViewModel.FromTag),E.push(12==e&&this.FutureSlabs),E.push(s.a.SessionManager.LanguageID),s.a.report.GetLOBFIFO(E,this.ViewModel.IsReportDB).then((function(t){var o=t;a.dsMain=o,"Payables"==a.ViewModel.Preferences.IncludeBills&&(10==e?o.Tables[0].forEach((function(e){null!=e.Amount&&(e.Amount=-parseFloat(e.Amount)),null!=e.BillAmount&&(e.BillAmount=-parseFloat(e.BillAmount)),null!=e.Adjusted&&(e.Adjusted=-parseFloat(e.Adjusted))})):11==e?o.Tables[0].forEach((function(e){null!=e.AdjAmount&&(e.AdjAmount=-parseFloat(e.AdjAmount)),null!=e.BillAmount&&(e.BillAmount=-parseFloat(e.BillAmount)),null!=e.Paid&&(e.Paid=-parseFloat(e.Paid))})):12==e&&(o.Tables[1].forEach((function(e){null!=e.Amount&&(e.Amount=-parseFloat(e.Amount)),null!=e.UnAdjustedAmount&&(e.UnAdjustedAmount=-parseFloat(e.UnAdjustedAmount))})),o.Tables[2].forEach((function(e){null!=e.AdjAmount&&(e.AdjAmount=-parseFloat(e.AdjAmount))})),o.Tables.Count>3&&o.Tables[3].Rows.Count>0&&o.Tables[3].forEach((function(e){null!=e.AdjAmount&&(e.AdjAmount=-parseFloat(e.AdjAmount))}))))}))}return new Promise((function(e,t){}))}},{key:"GetDateColumn",value:function(e,t){var o="";return 0==t.length?o=this.PDCOnConvresionDate?"DocDueDate"==this.ViewModel.Preferences.Date?"CONVERT(DATETIME,isnull("+e+".ConvertedDate,isnull("+e+".DocDueDate,"+e+".DocDate))) DocDate":"CONVERT(DATETIME,isnull("+e+".ConvertedDate,"+e+"."+this.ViewModel.Preferences.Date+")) DocDate":"DocDueDate"==this.ViewModel.Preferences.Date?"CONVERT(DATETIME,isnull("+e+".DocDueDate,"+e+".DocDate)) DocDate":"CONVERT(DATETIME,"+e+"."+this.ViewModel.Preferences.Date+") DocDate":(this.AllowFromDateFilter&&(o=this.PDCOnConvresionDate?"DocDueDate"==this.ViewModel.Preferences.Date?" AND ISNULL(B.ConvertedDate,isnull("+e+".DocDueDate,"+e+".DocDate))>=@From":" AND ISNULL(B.ConvertedDate,"+e+"."+this.ViewModel.Preferences.Date+")>=@From":"DocDueDate"==this.ViewModel.Preferences.Date?" AND isnull("+e+".DocDueDate,"+e+".DocDate)>=@From":" AND "+e+"."+this.ViewModel.Preferences.Date+">=@From"),o+=this.PDCOnConvresionDate?"DocDueDate"==this.ViewModel.Preferences.Date?11==this.ViewModel.StaticReportType&&-1!=this.colUnDueIndex?" AND ISNULL(B.ConvertedDate,"+e+".DocDate)<="+t:" AND ISNULL(B.ConvertedDate,isnull("+e+".DocDueDate,"+e+".DocDate))<="+t:" AND ISNULL(B.ConvertedDate,"+e+"."+this.ViewModel.Preferences.Date+")<="+t:"DocDueDate"==this.ViewModel.Preferences.Date?11==this.ViewModel.StaticReportType&&-1!=this.colUnDueIndex?" AND "+e+".DocDate<="+t:" AND isnull("+e+".DocDueDate,"+e+".DocDate)<="+t:" AND "+e+"."+this.ViewModel.Preferences.Date+"<="+t),o}},{key:"GetDocumentTypeFilter",value:function(){var e=this.GetFilterByDimension_1(300);return e.length>0&&(e=e.Contains(",")?" AND (SELECT top(1) CostCenterID FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo) IN ("+e+")":" AND (SELECT top(1) CostCenterID FROM ACC_DocDetails ACC WITH(NOLOCK) WHERE ACC.VoucherNo=B.DocNo)="+e),e}},{key:"addRows",value:function(){var e=this,t=0;if(-1!=this.AccountGroupIndex){var o=this.ViewModel.Data.length-(this.GroupRowsCount-this.AccountGroupIndex);if(o>=0&&!this.ViewModel.lstGroupIndex.Contains(o)&&this.ViewModel.Data[this.ViewModel.Data.length-1].Type==r.f.Group&&this.ViewModel.Data[o].Type==r.f.Group&&(this.ViewModel.Data[o].NodeID=parseInt(this.drMainRow.AccountID),this.ViewModel.lstGroupIndex.push(o),null!=this.tempTotals)){for(var l=0;l<this.tempTotals.length;l++)this.tempTotals[l]=this.ViewModel.totals[l][this.lstGroup.length];for(var n=0;n<this.tempHiddenTotals.length;n++)this.tempHiddenTotals[n]=this.ViewModel.hiddenTotals[n][this.lstGroup.length]}}if(0==this.ViewModel.IsNewGroupIndex&&(this.dblBalanceCum=0),this.StatusID=parseInt(this.drMainRow.StatusID),this.UnPostedDocsInclude&&this.UnPostedDocsSeparately&&369!=this.StatusID&&439!=this.StatusID&&370!=this.StatusID){var a=!0;if(this.ViewModel.Data.length>0&&null!=this.ViewModel.Data[this.ViewModel.Data.length-1].DataRow&&parseInt(this.ViewModel.Data[this.ViewModel.Data.length-1].DataRow.StatusID)==this.StatusID&&(a=!1),a){this.AddSubTotal("",!1,!0);for(var h=0;h<this.tempTotals.length;h++)this.tempTotals[h]=this.ViewModel.totals[h][this.lstGroup.length];for(var c=0;c<this.tempHiddenTotals.length;c++)this.tempHiddenTotals[c]=this.ViewModel.hiddenTotals[c][this.lstGroup.length];this.row=this.NewReportRow_2(r.f.GrossTotal,this.GrossTotalAppearance),this.row.LevelNo=this.ViewModel.lstGroup.length,this.row.Cells[0].ColSpan=this.ViewModel.ReportColumns.length,this.row.Cells[0].Text=this.arrUnPostedStatuses[this.StatusID],this.ViewModel.addRow(this.row)}}var D=!(!this.PDCSeperate||1!=parseInt(this.drMainRow.IsPDC));if(this.PDCSeperate&&D){var d=!0;if(this.ViewModel.Data.length>0&&null!=this.ViewModel.Data[this.ViewModel.Data.length-1].DataRow&&1==parseInt(this.ViewModel.Data[this.ViewModel.Data.length-1].DataRow.IsPDC)&&(d=!1),d){this.ViewModel.Data.length>0&&this.ViewModel.Data[this.ViewModel.Data.length-1].Type==r.f.Detail?(this.AddPDCSubTotal=!0,this.AddSubTotal("",!1,!0)):this.AddPDCSubTotal=!1;for(var C=0;C<this.tempTotals.length;C++)this.tempTotals[C]=this.ViewModel.totals[C][this.lstGroup.length];for(var p=0;p<this.tempHiddenTotals.length;p++)this.tempHiddenTotals[p]=this.ViewModel.hiddenTotals[p][this.lstGroup.length];var T;this.row=this.NewReportRow_2(r.f.GrossTotal,this.GrossTotalAppearance),this.row.LevelNo=this.ViewModel.lstGroup.length,this.row.Cells[0].ColSpan=this.ViewModel.ReportColumns.length,this.row.Cells[0].Text=s.a.GetResource("Reports_PDCList"),this.ViewModel.addRow(this.row),this.dvPDCSeperate=this.dvPDCSeperateTable.filter((function(e){return 1==e.IsPDC})),this.ViewModel.ReportGroups.forEach((function(t){e.ViewModel.ReportGroups.length>1&&e.ViewModel.ReportGroups[1]==t?t.CDGDO.IsForeignKey&&(e.dvPDCSeperate=e.dvPDCSeperate.filter((function(o){return o[t.ID+"_ID"]==e.drMainRow[t.ID+"_ID"]}))):e.dvPDCSeperate=e.dvPDCSeperate.filter((function(o){return o[t.ID+"_ID"]==e.drMainRow[t.ID+"_ID"]}))})),this.dvPDCSeperate.SortBy(["DocNo"]);for(var _=0;_<this.dvPDCSeperate.length;_++)T!=this.dvPDCSeperate[_].DocNo.toString()?(T=this.dvPDCSeperate[_].DocNo.toString(),this.HidePDCAdjustments&&null!=this.dvPDCSeperate[_].AgainstVoucher&&(this.dvPDCSeperate[_].Adjusted=-parseFloat(this.dvPDCSeperate[_].Amount))):(this.HidePDCAdjustments&&(this.dvPDCSeperate[_-1].Adjusted=parseFloat(this.dvPDCSeperate[_-1].Adjusted)-parseFloat(this.dvPDCSeperate[_].Amount)),this.dvPDCSeperate[_-1].Amount=parseFloat(this.dvPDCSeperate[_-1].Amount)+parseFloat(this.dvPDCSeperate[_].Amount),this.dvPDCSeperate[_-1].BillAmount=parseFloat(this.dvPDCSeperate[_-1].BillAmount)+parseFloat(this.dvPDCSeperate[_].BillAmount),null!=this.dvPDCSeperate[_].AgainstVoucher&&(this.dvPDCSeperate[_-1].AgainstVoucher=null==this.dvPDCSeperate[_-1].AgainstVoucher?this.dvPDCSeperate[_].AgainstVoucher:this.dvPDCSeperate[_-1].AgainstVoucher.toString()+", "+this.dvPDCSeperate[_].AgainstVoucher.toString()),this.dvPDCSeperateTable.Remove(this.dvPDCSeperate[_]),this.dsMain.Tables[0].Remove(this.dvPDCSeperate[_]),this.dvPDCSeperate.Remove(this.dvPDCSeperate[_]),_--)}}else this.AddPDCSubTotal=!1;this.dblBalance=parseFloat(this.drMainRow.Amount),this.dblPaidTotal=i.e.Double(this.drMainRow.Adjusted),this.MainRow=this.NewReportRow(),this.MainRow.LevelNo=this.ViewModel.lstGroup.length;var m=0;if(this.ClubByVoucherNo)if(null!=this.drMainRow.RType&&(m=parseInt(this.drMainRow.RType)),2==m){this.drMainRow.DocNo="   "+this.drMainRow.Narration.toString(),this.MainRow.LevelNo=this.ViewModel.lstGroup.length-1,this.MainRow.Visible=!1,this.MainRow.Parent=this.ParentRow;for(var I=0;I<this.ViewModel.ReportColumns.length;I++)this.MainRow.Cells[I].IsNormal=!1,this.MainRow.Cells[I].CellAppearance=this.ViewModel.ReportColumns[I].DataAppearance.Clone(),this.MainRow.Cells[I].CellAppearance.BackColor="#fff8f8f8"}else 1==m&&(this.ParentRow=this.MainRow,this.MainRow.IsGroup=!0,this.MainRow.IsExpanded=!1);if(this.MainRow.DataRow=this.drMainRow,this.dblBalance=this.dblBalance+this.dblPaidTotal,!(10==this.ViewModel.StaticReportType&&Math.abs(this.dblBalance)<this.AdjustmentRoundOff)||this.HidePDCAdjustments&&this.PDCSeperate&&D||this.UnAppsDocsAdjustSeperate&&371==this.StatusID){this.drMainRow.Balance=this.dblBalance,this.dblBalance>0?(this.drMainRow.Credit=null,this.drMainRow.Debit=this.dblBalance):this.dblBalance<0&&(this.drMainRow.Debit=null,this.drMainRow.Credit=-this.dblBalance);for(var R=0;R<this.oColumns.length;R++)if(!Object(u.isUndefined)(this.drMainRow[this.oColumns[R].ID])){if("FLOAT"==this.oColumns[R].ColumnType)try{i.e.IsEmpty(this.drMainRow[this.oColumns[R].ID])||2==m||(t=parseFloat(this.drMainRow[this.oColumns[R].ID]),this.ViewModel.totals[R][this.lstGroup.length]+=t)}catch(w){}this.ViewModel.SetCellValue(this.HidePDCAdjustments&&this.PDCSeperate&&D&&R==this.colBalanceIndex?this.drMainRow.Amount:this.drMainRow[this.oColumns[R].ID],this.oColumns[R].DataFormat,this.oColumns[R].ColumnType,this.MainRow.Cells[R])}for(var S=0;S<this.ViewModel.HiddenNumericColumns.length;S++)if(!Object(u.isUndefined)(this.drMainRow[this.ViewModel.HiddenNumericColumns[S].ID]))try{i.e.IsEmpty(this.drMainRow[this.ViewModel.HiddenNumericColumns[S].ID])||2==m||(t=parseFloat(this.drMainRow[this.ViewModel.HiddenNumericColumns[S].ID]),this.ViewModel.hiddenTotals[S][this.lstGroup.length]+=t)}catch(f){}if(0!=this.dblPaidTotal&&(10==this.ViewModel.StaticReportType||9==this.ViewModel.StaticReportType&&this.DontShowBillAdjustments)&&(-1!=this.colAdjustedIndex?(this.HidePDCAdjustments&&this.PDCSeperate&&D||this.ViewModel.SetCellValue(this.dblPaidTotal,this.oColumns[this.colAdjustedIndex].DataFormat,"FLOAT",this.MainRow.Cells[this.colAdjustedIndex]),2!=m&&(this.ViewModel.totals[this.colAdjustedIndex][this.lstGroup.length]+=this.dblPaidTotal)):-1!=this.colHiddenAdjustedIndex&&2!=m&&(this.ViewModel.hiddenTotals[this.colHiddenAdjustedIndex][this.lstGroup.length]+=this.dblPaidTotal),2!=m&&(this.dblBalanceCum+=this.dblPaidTotal)),2!=m&&(Object(u.isNullOrUndefined)(this.drMainRow.Amount)||(this.dblBalanceCum+=parseFloat(this.drMainRow.Amount)),-1!=this.colBalanceCumIndex&&(this.drMainRow[this.oColumns[this.colBalanceCumIndex].ID+"CUMULATIVE"]=this.dblBalance,this.ViewModel.totals[this.colBalanceCumIndex][this.lstGroup.length]=this.dblBalanceCum,this.HidePDCAdjustments&&this.PDCSeperate&&D||this.ViewModel.SetCellValue(this.dblBalanceCum,this.oColumns[this.colBalanceCumIndex].DataFormat,"FLOAT",this.MainRow.Cells[this.colBalanceCumIndex]))),this.ViewModel.IsSummary||(-1!=this.ViewModel.colSNoIndex&&(this.MainRow.Cells[this.ViewModel.colSNoIndex].Value=++this.ViewModel.SNo,this.MainRow.Cells[this.ViewModel.colSNoIndex].Text=this.ViewModel.SNo.toString()),this.ViewModel.ApplyKPI(this.MainRow),this.ViewModel.addRow(this.MainRow)),9==this.ViewModel.StaticReportType&&!this.DontShowBillAdjustments){this.dvChild=this.dvChildTable.filter((function(t){return t.RefDocNo==e.drMainRow.DocNo.toString().Replace("'","''")&&t.RefDocSeqNo==e.drMainRow.DocSeqNo.toString()})),-1!=this.colPaidByDaysIndex&&(this.AggTotal[this.colPaidByDaysIndex][1]+=this.dvChild.length),this.dblPaidTotal=0;var A=0;for(this.k=0;this.k<this.dvChild.length;this.k++){this.row=this.NewReportRow(),this.row.LevelNo=this.ViewModel.lstGroup.length,this.dblAmount=parseFloat(this.dvChild[this.k].AdjAmount),this.dblPaidTotal+=this.dblAmount,this.dblBalance+=this.dblAmount,this.dblBalanceCum+=this.dblAmount,-1!=this.colAdjustedIndex&&(this.AggTotal[this.colAdjustedIndex][1]+=this.dblAmount,this.ViewModel.totals[this.colAdjustedIndex][this.lstGroup.length]+=this.dblAmount),i.e.IsEmpty(this.drMainRow.BillNo)||i.e.IsEmpty(this.dvChild[this.k].BillNo)||(this.dvChild[this.k].BillNo=this.drMainRow.BillNo);for(var M=0;M<this.oColumns.length;M++)Object(u.isUndefined)(this.dvChild[this.k][this.oColumns[M].ID])?"AgainstVoucher"==this.oColumns[M].ID?this.row.Cells[M].Text=this.drMainRow.DocNo.toString():"AgainstVoucherDate"==this.oColumns[M].ID&&this.ViewModel.SetCellValue(this.drMainRow.DocDate,this.oColumns[M].DataFormat,this.oColumns[M].ColumnType,this.row.Cells[M]):this.ViewModel.SetCellValue(this.dvChild[this.k][this.oColumns[M].ID],this.oColumns[M].DataFormat,this.oColumns[M].ColumnType,this.row.Cells[M]);-1!=this.colPaidByDaysIndex&&null!=this.dvChild[this.k].PaidByDays&&(A+=parseFloat(this.dvChild[this.k].PaidByDays),this.ViewModel.totals[this.colPaidByDaysIndex][1]+=parseFloat(this.dvChild[this.k].PaidByDays)),-1!=this.colBalanceCumIndex&&(this.drMainRow[this.oColumns[this.colBalanceCumIndex].ID+"CUMULATIVE"]=this.dblBalanceCum,this.ViewModel.totals[this.colBalanceCumIndex][this.lstGroup.length]=this.dblBalanceCum,0!=this.dblBalanceCum&&this.ViewModel.SetCellValue(this.dblBalanceCum,this.oColumns[this.colBalanceCumIndex].DataFormat,"FLOAT",this.row.Cells[this.colBalanceCumIndex])),this.ViewModel.IsSummary||this.ViewModel.addRow(this.row)}if(-1!=this.colPaidByDaysIndex&&A>0){this.drMainRow.PaidByDays=A/this.dvChild.length,this.ViewModel.SetCellValue(A/this.dvChild.length,this.oColumns[this.colPaidByDaysIndex].DataFormat,"FLOAT",this.MainRow.Cells[this.colPaidByDaysIndex]);var g=this.ViewModel.Data.indexOf(this.MainRow);g>=0&&(this.ViewModel.Data.RemoveAt(g),this.ViewModel.Data.Insert(g,this.MainRow))}}}}},{key:"LOBSubTotalCallBack",value:function(e){if(this.UnPostedDocsInclude&&!this.AddPDCSubTotal&&369!=this.StatusID&&0!=this.StatusID&&e==this.lstGroup.length&&this.ViewModel.Data.length>0&&this.ViewModel.Data[this.ViewModel.Data.length-1].Type==r.f.Detail&&this.AddSubTotal("",!1,!0),this.PDCSeperate&&this.AddPDCSubTotal&&e==this.lstGroup.length&&this.ViewModel.Data.length>0&&this.ViewModel.Data[this.ViewModel.Data.length-1].Type==r.f.Detail&&(this.AddSubTotal("PDC",!0),this.HidePDCAdjustments)){var t=Math.min.apply(null,this.ViewModel.lstGroup[this.ViewModel.lstGroup.length-1].TotalCols.values);if(t>=0&&(-1!=this.colAmountIndex||-1!=this.colBalanceIndex)){var o,s,i=-1!=this.colAmountIndex?this.colAmountIndex:this.colBalanceIndex;if(-1!=this.colAmountIndex)o=this.ViewModel.totals[this.colAmountIndex][this.lstGroup.length]-this.tempTotals[this.colAmountIndex];else{var l=this.ViewModel.HiddenNumericColumns.indexOf(this.ViewModel.HiddenNumericColumns.find((function(e){return"Amount"==e.ID})));o=this.ViewModel.hiddenTotals[l][this.lstGroup.length]-this.tempHiddenTotals[l]}s=o,s+=-1!=this.colAdjustedIndex?this.ViewModel.totals[this.colAdjustedIndex][this.lstGroup.length]-this.tempTotals[this.colAdjustedIndex]:this.ViewModel.hiddenTotals[this.colHiddenAdjustedIndex][this.lstGroup.length]-this.tempHiddenTotals[this.colHiddenAdjustedIndex],this.GrdRow++,this.row=this.NewReportRow(),this.row.Height+=2,this.row.Type=r.f.GrossTotal,this.row.LevelNo=this.ViewModel.lstGroup.length,this.row.Cells[0].IsNormal=!1,this.row.Cells[0].CellAppearance=this.GrossTotalAppearance,this.row.Cells[0].Text="PostDated Cheques",this.row.Cells[0].ColSpan=t,this.row.Cells[i].IsNormal=!1,this.row.Cells[i].CellAppearance=this.GrossTotalAppearance_Data,this.ViewModel.SetCellValue(o,this.ViewModel.ReportColumns[i].DataFormat,"FLOAT",this.row.Cells[i]),this.ViewModel.addRow(this.row),this.GrdRow++,this.row=this.NewReportRow(),this.row.Height+=2,this.row.Type=r.f.GrossTotal,this.row.LevelNo=this.ViewModel.lstGroup.length,this.row.Cells[0].IsNormal=!1,this.row.Cells[0].CellAppearance=this.GrossTotalAppearance,this.row.Cells[0].Text="Total PostDated New Reference",this.row.Cells[0].ColSpan=t,this.row.Cells[i].IsNormal=!1,this.row.Cells[i].CellAppearance=this.GrossTotalAppearance_Data,this.ViewModel.SetCellValue(s,this.ViewModel.ReportColumns[i].DataFormat,"FLOAT",this.row.Cells[i]),this.ViewModel.addRow(this.row);var n=this.ViewModel.HiddenNumericColumns.indexOf(this.ViewModel.HiddenNumericColumns.find((function(e){return"Balance"==e.ID}))),a=-1!=this.colBalanceIndex?this.ViewModel.totals[this.colBalanceIndex][this.lstGroup.length]:this.ViewModel.hiddenTotals[n][this.lstGroup.length];this.GrdRow++,this.row=this.NewReportRow(),this.row.Height+=2,this.row.Type=r.f.GrossTotal,this.row.LevelNo=this.ViewModel.lstGroup.length,this.row.Cells[0].IsNormal=!1,this.row.Cells[0].CellAppearance=this.GrossTotalAppearance,this.row.Cells[0].Text="Ouststanding Balance",this.row.Cells[0].ColSpan=t,this.row.Cells[i].IsNormal=!1,this.row.Cells[i].CellAppearance=this.GrossTotalAppearance_Data,this.ViewModel.SetCellValue(a,this.ViewModel.ReportColumns[i].DataFormat,"FLOAT",this.row.Cells[i]),this.ViewModel.addRow(this.row),a=-1!=this.colBalanceIndex?this.tempTotals[this.colBalanceIndex]:this.tempHiddenTotals[n],this.GrdRow++,this.row=this.NewReportRow(),this.row.Height+=2,this.row.Type=r.f.GrossTotal,this.row.LevelNo=this.ViewModel.lstGroup.length,this.row.Cells[0].IsNormal=!1,this.row.Cells[0].CellAppearance=this.GrossTotalAppearance,this.row.Cells[0].Text="Total Ouststanding Balance",this.row.Cells[0].ColSpan=t,this.row.Cells[i].IsNormal=!1,this.row.Cells[i].CellAppearance=this.GrossTotalAppearance_Data,this.ViewModel.SetCellValue(a-o+s,this.ViewModel.ReportColumns[i].DataFormat,"FLOAT",this.row.Cells[i]),this.ViewModel.addRow(this.row)}}this.FIFO||"Receivables"!=this.ViewModel.Preferences.IncludeBills&&"Payables"!=this.ViewModel.Preferences.IncludeBills||this.AddUnadjustedReceivablesPayables(e)}},{key:"AddSubTotal",value:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.HideSectionSubTotal){var i=Math.min.apply(null,this.ViewModel.lstGroup[this.ViewModel.lstGroup.length-1].TotalCols.values);if(i>=0){this.GrdRow++,this.row=this.NewReportRow_2(r.f.SubTotal,this.ViewModel.lstGroup[0].SubTotalAppearance),this.row.LevelNo=this.ViewModel.lstGroup.length;for(var l=0;l<this.oColumns.length;l++)this.ViewModel.lstGroup[0].TotalCols.ContainsKey(this.oColumns[l].ID)&&(t?this.HidePDCAdjustments&&this.PDCSeperate&&(l==this.colAdjustedIndex||l==this.colBalanceIndex)||this.ViewModel.SetCellValue(this.ViewModel.totals[l][this.lstGroup.length]-this.tempTotals[l],this.oColumns[l].DataFormat,"FLOAT",this.row.Cells[l]):o&&null!=this.tempTotals?l!=this.colAdjustedIndex&&l!=this.colBalanceIndex&&this.ViewModel.SetCellValue(this.ViewModel.totals[l][this.lstGroup.length]-this.tempTotals[l],this.oColumns[l].DataFormat,"FLOAT",this.row.Cells[l]):this.ViewModel.SetCellValue(this.ViewModel.totals[l][this.lstGroup.length],this.oColumns[l].DataFormat,"FLOAT",this.row.Cells[l]),this.row.Cells[l].CellAppearance.Alignment="Right");var n=this.row.Cells[0];n.Text=e.length>0?s.a.GetResource("Reports_SubTotal")+" ("+e+")":s.a.GetResource("Reports_SubTotal"),n.ColSpan=i,this.ViewModel.addRow(this.row)}}}},{key:"AddUnadjustedReceivablesPayables",value:function(e){if(this.ViewModel.Data.length>0&&this.ViewModel.Data[this.ViewModel.Data.length-1].Type==r.f.Detail&&this.iMainRow>0&&this.lstRecPayUnadjusted.ContainsKey(parseInt(this.dv[this.iMainRow-1].AccountID))){var t=this.lstRecPayUnadjusted[parseInt(this.dv[this.iMainRow-1].AccountID)];this.row=this.NewReportRow_2(r.f.BalanceBF,this.BalanceBFAppearance_Data),this.row.LevelNo=this.ViewModel.lstGroup.length,this.row.Cells[0].Text="Receivables"==this.ViewModel.Preferences.IncludeBills?"Un Adjusted Payable Amount":"Un Adjusted Receivable Amount",this.row.Cells[0].CellAppearance.Alignment="Left";var o=1;-1!=this.colAmountIndex?(o=this.colAmountIndex,this.ViewModel.totals[this.colAmountIndex][this.lstGroup.length]+=t):-1!=this.colBalanceIndex&&(o=this.colBalanceIndex),-1!=this.colBalanceIndex&&(this.ViewModel.totals[this.colBalanceIndex][this.lstGroup.length]+=t,this.ViewModel.SetCellValue(t,this.oColumns[o].DataFormat,this.oColumns[this.colBalanceIndex].ColumnType,this.row.Cells[this.colBalanceIndex])),-1!=this.colBalanceCumIndex&&(this.dblBalanceCum+=t,this.ViewModel.totals[this.colBalanceCumIndex][this.lstGroup.length]=this.dblBalanceCum,this.ViewModel.SetCellValue(this.dblBalanceCum,this.oColumns[o].DataFormat,this.oColumns[this.colBalanceCumIndex].ColumnType,this.row.Cells[this.colBalanceCumIndex])),this.row.Cells[0].ColSpan=o,this.ViewModel.SetCellValue(this.lstRecPayUnadjusted[parseInt(this.dv[this.iMainRow-1].AccountID)],this.oColumns[o].DataFormat,this.oColumns[o].ColumnType,this.row.Cells[o]),this.ViewModel.addRow(this.row)}}},{key:"AddReportTotal",value:function(){this.row=this.NewReportRow_2(r.f.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance),this.ViewModel.GrpReportTotal.Height>0&&(this.row.Height=this.ViewModel.GrpReportTotal.Height),this.row.LevelNo=1;var e=-1;for(this.k=0;this.k<this.oColumns.length;this.k++)this.ViewModel.GrpReportTotal.TotalCols.ContainsKey(this.oColumns[this.k].ID)&&(-1==e&&(e=this.k),this.ViewModel.SetCellValue(this.AggTotal[this.k][0],this.oColumns[this.k].DataFormat,"FLOAT",this.row.Cells[this.k]));this.row.Cells[0].Text=s.a.GetResource("Reports_ReportTotal"),e>0&&(this.row.Cells[0].ColSpan=e,this.ViewModel.addRow(this.row))}},{key:"addBillWiseAgeing",value:function(){var e,t,o=this;if(!this.dsMain.Columns[0].Contains("Balance")){if(this.dsMain.Columns[0].push("Balance"),this.dsMain.Columns[0].push("NetBalance"),-1==this.colUnDueIndex||this.dsMain.Columns[0].Contains("UnDueAmount")||this.dsMain.Columns[0].push("UnDueAmount"),-1!=this.colBalanceCumIndex&&this.dsMain.Columns[0].push(this.oColumns[this.colBalanceCumIndex].ID+"CUMULATIVE"),-1!=this.colSlabIndex){for(var s=1;s<=this.SlabSize;s++)this.dsMain.Columns[0].push("Slab"+s);this.dsMain.Columns[0].push("Slab")}this.Slabs_MMMYY.forEach((function(e){o.dsMain.Columns[0].push(e)}))}for(this.IsPaymentTermWise&&(this.dvPaymentTerms=this.dvPaymentTermsTable=this.dsMain.Tables[1],this.dvPaymentTerms.SortBy(["DueDate"])),this.arrSlabAmounts=new Array(this.Slabs.length+1).fill(0),this.dblBalanceCum=0,this.iMainRow=0;this.iMainRow<this.dv.length;this.iMainRow++){if(this.ViewModel.process.CancellationPending)return void(this.ViewModel.processArgs.Cancel=!0);if(this.drMainRow=this.dv[this.iMainRow],this.ViewModel.AddGroupRows(this.dv,this.iMainRow),this.GroupRowsCount>0){var n=this.ViewModel.Data.length-this.GroupRowsCount;if(n<this.ViewModel.Data.length&&this.ViewModel.Data[n].Type==r.f.Group&&(this.ViewModel.Data[n].NodeID=parseInt(this.drMainRow[this.ViewModel.ReportGroups[0].ID+"_ID"]),0!=this.ViewModel.lstGroupIndex.length&&this.ViewModel.lstGroupIndex[this.ViewModel.lstGroupIndex.length-1]==n||this.ViewModel.lstGroupIndex.push(n)),this.BWAgeingShowOnlyDocs&&-1!=this.ViewModel.IsNewGroupIndex){t=this.dvTable.filter(2==this.lstGroup.length?function(e){return e[o.lstGroup[0].ID+"_ID"]==o.drMainRow[o.lstGroup[0].ID+"_ID"].toString()&&e[o.lstGroup[1].ID+"_ID"]==o.drMainRow[o.lstGroup[1].ID+"_ID"].toString()}:function(e){return e[o.lstGroup[0].ID+"_ID"]==o.drMainRow[o.lstGroup[0].ID+"_ID"].toString()});for(var a=null,h=0;h<t.length;h++)Object(l.j)(t[h].IsInventory)&&null==a&&parseFloat(t[h].AdjAmount)>0&&(a=t[h]);for(var c=0,D=t.length-1;D>=0;D--)Object(l.j)(t[D].IsInventory)||parseFloat(t[D].AdjAmount)>0&&null!=a&&(c=parseFloat(t[D].AdjAmount)-parseFloat(t[D].Paid),null!=a&&c<=Math.abs(parseFloat(a.Paid))&&(a.Paid=parseFloat(a.Paid)+c,this.dvTable.Remove(t[D])));this.drMainRow=this.dv[this.iMainRow]}}if(0==this.ViewModel.IsNewGroupIndex&&(this.dblBalanceCum=0),this.oRow=this.NewReportRow(),this.oRow.LevelNo=this.ViewModel.lstGroup.length,2==this.ViewModel.ReportGroups.length&&2==this.ViewModel.ReportGroups[1].CDGDO.ColumnCostCenterID&&(this.oRow.NodeID=parseInt(this.drMainRow[this.ViewModel.ReportGroups[1].ID+"_ID"])),this.oRow.DataRow=this.drMainRow,this.dblAmount=parseFloat(this.drMainRow.AdjAmount),this.dblPaidTotal=parseFloat(this.drMainRow.Paid),this.dtDocDate=new Date(this.drMainRow.DocDate.toString()),this.dblBalance=this.dblAmount+this.dblPaidTotal,this.dblPaidTotal=Math.abs(this.dblPaidTotal),this.drMainRow.Balance=this.dblBalance,!(Math.abs(this.dblBalance)<.099)){if(this.PDCInclude?(this.drMainRow.NetBalance=this.drMainRow.Balance,-1!=this.colPDCIndex&&this.arrPDCStatus.Contains(parseInt(this.drMainRow.Status))&&(this.drMainRow.TotalPDC=this.drMainRow.Balance)):-1!=this.colPDCIndex?(this.dbl1=i.e.Double(this.drMainRow.TotalPDC),this.drMainRow.NetBalance=Math.abs(this.dblBalance)-this.dbl1):this.drMainRow.NetBalance=this.dblBalance,this.ShowMonthWise&&this.Slabs_MMMYY.forEach((function(e){o.arrMonthSlabAmounts[e]=0})),this.IsPaymentTermWise)if(this.dvPaymentTerms=this.dvPaymentTermsTable.filter((function(e){return e.VoucherNo==o.drMainRow.VoucherNo.toString()})),this.dvPaymentTerms.length>0){for(var d=0;d<this.arrSlabAmounts.length;d++)this.arrSlabAmounts[d]=0;if(this.dvPaymentTerms.forEach((function(t){if(o.dbl1=parseFloat(t.Amount),o.dtDocDate=new Date(t.DueDate),o.dbl1=o.dbl1-o.dblPaidTotal,o.dbl1<0)o.dblPaidTotal=-o.dbl1;else if(o.dbl1>0){if(o.dblPaidTotal=0,-1!=o.colSlabIndex){for(o.i=0;o.i<o.Slabs.length&&!(o.dtDocDate>o.Slabs[o.i]);o.i++);o.arrSlabAmounts[o.i]+=o.dbl1}o.ShowMonthWise&&(e=o.dtDocDate.ToString("MMMyy"),o.arrMonthSlabAmounts.ContainsKey(e)?o.arrMonthSlabAmounts[e]+=o.dbl1:o.arrMonthSlabAmounts.MonthSlab+=o.dbl1)}else o.dblPaidTotal=0})),-1!=this.colSlabIndex)for(var C=0;C<this.arrSlabAmounts.length;C++)this.arrSlabAmounts[C]>0&&(this.dblAmount<0&&(this.arrSlabAmounts[C]=-this.arrSlabAmounts[C]),C==this.SlabSize?this.drMainRow.Slab=this.arrSlabAmounts[C]:this.drMainRow["Slab"+(C+1)]=this.arrSlabAmounts[C])}else{if(-1!=this.colSlabIndex){for(this.i=0;this.i<this.Slabs.length&&!(this.dtDocDate>this.Slabs[this.i]);this.i++);this.i==this.SlabSize?this.drMainRow.Slab=this.dblBalance:this.drMainRow["Slab"+(this.i+1)]=this.dblBalance}this.ShowMonthWise&&(e=this.dtDocDate.ToString("MMMyy"),this.arrMonthSlabAmounts.ContainsKey(e)?this.arrMonthSlabAmounts[e]+=this.dblBalance:this.arrMonthSlabAmounts.MonthSlab+=this.dblBalance)}else{if(-1!=this.colUnDueIndex&&this.dtDocDate>this.ViewModel.ToDatePicker.Date)this.drMainRow.UnDueAmount=this.dblBalance;else if(-1!=this.colSlabIndex){for(this.i=0;this.i<this.Slabs.length&&!(this.dtDocDate>this.Slabs[this.i]);this.i++);this.i==this.SlabSize?this.drMainRow.Slab=this.dblBalance:this.drMainRow["Slab"+(this.i+1)]=this.dblBalance}this.ShowMonthWise&&(e=this.dtDocDate.ToString("MMMyy"),this.arrMonthSlabAmounts.ContainsKey(e)?this.arrMonthSlabAmounts[e]+=this.dblBalance:this.arrMonthSlabAmounts.MonthSlab+=this.dblBalance)}if(this.ShowMonthWise&&this.Slabs_MMMYY.forEach((function(e){o.drMainRow[e]=o.arrMonthSlabAmounts[e]})),this.IgnoreRow=!1,this.ViewModel.FormulaColumns.length>0){for(var p=0;p<this.ViewModel.FormulaColumns.length;p++)if(this.ViewModel.CalculateFormula_2(this.ViewModel.FormulaColumns[p],this.drMainRow)){this.IgnoreRow=!0;break}if(this.IgnoreRow)continue}for(var T=0;T<this.oColumns.length;T++)this.CellValue=null,Object(u.isNullOrUndefined)(this.drMainRow[this.oColumns[T].ID])||(this.CellValue=this.drMainRow[this.oColumns[T].ID]),null!=this.CellValue&&(this.ViewModel.SetCellValue(this.CellValue,this.oColumns[T].DataFormat,this.oColumns[T].ColumnType,this.oRow.Cells[T]),this.ViewModel.TotalCols.Contains(this.oColumns[T].ID)&&i.e.IsNum(this.CellValue)&&(this.ViewModel.totals[T][this.lstGroup.length]+=i.e.Double(this.CellValue)));-1!=this.colBalanceCumIndex&&(this.dblBalanceCum+=this.dblBalance,this.drMainRow[this.oColumns[this.colBalanceCumIndex].ID+"CUMULATIVE"]=this.dblBalance,this.ViewModel.totals[this.colBalanceCumIndex][this.lstGroup.length]=this.dblBalanceCum,this.ViewModel.SetCellValue(this.dblBalanceCum,this.oColumns[this.colBalanceCumIndex].DataFormat,"FLOAT",this.oRow.Cells[this.colBalanceCumIndex])),-1!=this.ViewModel.colSNoIndex&&(this.oRow.Cells[this.ViewModel.colSNoIndex].Value=++this.ViewModel.SNo,this.oRow.Cells[this.ViewModel.colSNoIndex].Text=this.ViewModel.SNo.toString()),this.ViewModel.ApplyKPI(this.oRow),this.ViewModel.addRow(this.oRow)}}this.ViewModel.CheckAndAddTotals(this.dsMain.Tables[0])}},{key:"AddRow_AgeingAnalysis",value:function(){var e=this;if(!this.dsMain.Columns[0].Contains("Balance")){if(this.dsMain.Columns[0].push("Balance"),this.dsMain.Columns[0].push("UnAdjusted"),this.dsMain.Columns[0].push("NetBalance"),-1==this.colUnDueIndex||this.dsMain.Columns[0].Contains("UnDueAmount")||this.dsMain.Columns[0].push("UnDueAmount"),-1!=this.colBillAmtIndex&&this.dsMain.Columns[0].push("BillAmount"),-1!=this.colPDCIndex&&(this.dsMain.Columns[0].Contains("TotalPDC")||this.dsMain.Columns[0].push("TotalPDC"),this.dsMain.Columns[0].push("BalanceInclPDC")),-1!=this.colSlabIndex){for(var t=1;t<=this.SlabSize;t++)this.dsMain.Columns[0].push("Slab"+t),this.dsMain.Columns[0].push("FSlab"+t);this.dsMain.Columns[0].push("Slab"),this.dsMain.Columns[0].push("FSlab")}this.Slabs_MMMYY.forEach((function(t){e.dsMain.Columns[0].push(t)}))}for(this.IsPaymentTermWise&&(this.dvPaymentTerms=this.dvPaymentTerms=this.dsMain.Tables[2],this.dvPaymentTerms.SortBy(["DueDate"]),this.FutureSlabs&&this.dsMain.Tables.length>4&&(this.dvFPaymentTerms=this.dsMain.Tables[4],this.dvFPaymentTerms.SortBy(["DueDate"]))),this.iMainRow=0;this.iMainRow<this.dv.length;this.iMainRow++)if(this.drMainRow=this.dv[this.iMainRow],this.iMainRowAccountID=parseInt(this.drMainRow[this.dsMain.Columns[0][0]]),!this.ShowLevelTree||!Object(l.j)(this.drMainRow.IsGroup)){if(this.FIFO){this.drRows=this.dsMain.Tables[2].filter((function(t){return t.AccountID==e.iMainRowAccountID})),this.dblReceivable=this.dblPayable=0;var o=this.dsMain.Tables[1].filter((function(t){return t.AccountID==e.iMainRowAccountID}));if(o.length>0&&(this.dblReceivable=parseFloat(o[0].Amount),this.dblPayable=parseFloat(o[0].UnAdjustedAmount)),!this.AccountsWithZeroBalance&&parseFloat(Math.abs(this.dblReceivable+this.dblPayable).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount))<this.cmpValue)continue;if(0==this.drRows.length)continue;this.dbl1=this.dblReceivable,this.dbl2=this.dblPayable}else{if(this.drRows=this.dsMain.Tables[1].filter((function(t){return t.AccountID==e.iMainRowAccountID})),!this.AccountsWithOutTransactions&&0==this.drRows.length&&(-1==this.colUnDueIndex||null==this.drMainRow.ActualBill||Math.abs(parseFloat(this.drMainRow.ActualBill))<this.cmpValue)){if(!(-1!=this.colPDCIndex&&null==this.drMainRow.TotalPDC&&Math.abs(parseFloat(this.drMainRow.TotalPDC))>=this.cmpValue))continue;this.drMainRow.ActualBill=0}if(this.UpdateAmounts(),!this.AccountsWithZeroBalance&&parseFloat(Math.abs(this.dblReceivable+this.dblPayable).ToString("N "+s.a.SessionManager.Preferences.DecimalsinAmount))<this.cmpValue&&(this.drMainRow.Balance=0,-1==this.colUnDueIndex||null==this.drMainRow.ActualBill||Math.abs(this.dblAmount_ForUnDue-parseFloat(this.drMainRow.ActualBill))<this.cmpValue)){if(!(-1!=this.colPDCIndex&&null==this.drMainRow.TotalPDC&&Math.abs(parseFloat(this.drMainRow.TotalPDC))>=this.cmpValue))continue;this.drMainRow.ActualBill=0}if("Receivables"==this.ViewModel.Preferences.IncludeBills){if(this.dbl1=this.dblReceivable,this.dbl2=this.dblPayable,this.dblReceivable+this.dblPayable<0)continue}else if("Payables"==this.ViewModel.Preferences.IncludeBills){if(this.dbl1=this.dblPayable,this.dbl2=this.dblReceivable,this.dblReceivable+this.dblPayable>0)continue}else this.dbl1=this.dblReceivable+this.dblPayable,this.dbl2=0}this.drMainRow.Balance=this.dbl1,this.drMainRow.UnAdjusted=this.dbl2,this.drMainRow.NetBalance=this.dblReceivable+this.dblPayable,-1!=this.colUnDueIndex&&null!=this.drMainRow.ActualBill&&(this.drMainRow.UnDueAmount=parseFloat(this.drMainRow.ActualBill)-this.dblAmount_ForUnDue),-1!=this.colBillAmtIndex&&(this.drMainRow.BillAmount=this.dblBillAmount)}var i=this.dv.Copy();this.ShowDrCrSeperately&&(this.dv=i.filter(this.ShowLevelTree?function(e){return e.IsGroup=1}:function(e){return e.Balance<0}),this.row=this.NewReportRow_2(r.f.GrossTotal,this.GrossTotalAppearance),this.row.LevelNo=this.ViewModel.lstGroup.length,this.row.Cells[0].ColSpan=this.oColumns.length,this.row.Cells[0].Text=s.a.GetResource("Reports_Receipts"),this.ViewModel.addRow(this.row)),this.AddRow_AgeingAnalysisSection(),this.ShowDrCrSeperately&&(this.dv=i.filter(this.ShowLevelTree?function(e){return e.IsGroup=1}:function(e){return e.Balance>0}),this.row=this.NewReportRow_2(r.f.GrossTotal,this.GrossTotalAppearance),this.row.LevelNo=this.ViewModel.lstGroup.length,this.row.Cells[0].ColSpan=this.oColumns.length,this.row.Cells[0].Text=s.a.GetResource("Reports_Payments"),this.ViewModel.addRow(this.row),this.AddRow_AgeingAnalysisSection())}},{key:"AddRow_AgeingAnalysisSection",value:function(){var e,t,o,n,a=this;if(this.lstTotal=new Array,this.lstTotal.push(new Array(this.oColumns.length).fill(0)),this.arrSlabAmounts=new Array(this.Slabs.length+1).fill(0),this.arrFSlabAmounts=new Array(this.Slabs.length+1).fill(0),this.ShowLevelTree&&this.dv.length>0)for(var h=0;h<parseInt(this.dv[0].Depth);h++)this.lstParents.push(this.NewReportRow()),this.lstTotal.push(new Array(this.oColumns.length).fill(0));for(this.iMainRow=0;this.iMainRow<this.dv.length;this.iMainRow++){if(this.ViewModel.process.CancellationPending)return void(this.ViewModel.processArgs.Cancel=!0);if(this.IgnoreRow=!1,this.drMainRow=this.dv[this.iMainRow],this.iMainRowAccountID=parseInt(this.drMainRow[this.dsMain.Columns[0][0]]),this.oRow=this.NewReportRow(),this.oRow.Cells[0].Text=this.drMainRow[this.dsMain.Columns[0][1]].toString(),this.oRow.DataRow=this.drMainRow,this.oRow.NodeID=this.iMainRowAccountID,this.ShowLevelTree&&(this.oRow.LevelNo=parseInt(this.drMainRow.Depth)-1,this.UpdateTreeTotals(this.oRow.LevelNo),Object(l.j)(this.drMainRow.IsGroup)&&(this.oRow.Type=r.f.BalanceBF,this.oRow.IsGroup=!0),this.oRow.Cells[0].IsNormal=!1,this.oRow.Cells[0].level=this.oRow.LevelNo,Object(l.j)(this.drMainRow.IsGroup))){if(this.oRow.LevelNo>this.LevelNo)continue;this.lstParents.push(this.oRow),this.lstTotal.push(new Array(this.oColumns.length).fill(0)),this.oRow.Type=r.f.BalanceBF;for(var c=0;c<this.oRow.Cells.length;c++)this.oRow.Cells[c].IsNormal=!1,this.oRow.Cells[c].CellAppearance=this.BalanceBFAppearance_Data;this.oRow.Cells[0].CellAppearance=this.BalanceBFAppearance}if(!this.ShowLevelTree||!Object(l.j)(this.drMainRow.IsGroup)){if(this.FIFO){this.drRows=this.dsMain.Tables[2].filter((function(e){return e.AccountID==a.iMainRowAccountID})),this.FutureSlabs&&this.dsMain.Tables.length>3&&(this.drFRows=this.dsMain.Tables[3].filter((function(e){return e.AccountID==a.iMainRowAccountID}))),this.dblReceivable=this.dblPayable=0;var D=this.dsMain.Tables[1].filter((function(e){return e.AccountID==a.iMainRowAccountID}));if(D.length>0&&(this.dblReceivable=parseFloat(D[0].Amount),this.dblPayable=parseFloat(D[0].UnAdjustedAmount)),!this.AccountsWithZeroBalance&&parseFloat(Math.abs(this.dblReceivable+this.dblPayable).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount))<this.cmpValue)continue;if(0==this.drRows.length)continue;this.dbl1=this.dblReceivable,this.dbl2=this.dblPayable}else{if(this.drRows=this.dsMain.Tables[1].filter((function(e){return e.AccountID==a.iMainRowAccountID})),this.FutureSlabs&&(this.dsMain.Tables.Count>2&&!this.IsPaymentTermWise?this.drFRows=this.dsMain.Tables[2].filter((function(e){return e.AccountID==a.iMainRowAccountID})):this.dsMain.Tables.Count>3&&(this.drFRows=this.dsMain.Tables[3].filter((function(e){return e.AccountID==a.iMainRowAccountID})))),!this.AccountsWithOutTransactions&&0==this.drRows.length&&(-1==this.colUnDueIndex||null==this.drMainRow.UnDueAmount||Math.abs(parseFloat(this.drMainRow.UnDueAmount))<this.cmpValue)&&(-1==this.colPDCIndex||null==this.drMainRow.TotalPDC||Math.abs(parseFloat(this.drMainRow.TotalPDC))<this.cmpValue))continue;if(this.UpdateAmounts(),!this.AccountsWithZeroBalance&&parseFloat(Math.abs(this.dblReceivable+this.dblPayable).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount))<this.cmpValue&&(-1==this.colUnDueIndex||null==this.drMainRow.UnDueAmount||Math.abs(parseFloat(this.drMainRow.UnDueAmount))<this.cmpValue)&&(-1==this.colPDCIndex||null==this.drMainRow.TotalPDC||Math.abs(parseFloat(this.drMainRow.TotalPDC))<this.cmpValue))continue;if("Receivables"==this.ViewModel.Preferences.IncludeBills){if(this.dbl1=this.dblReceivable,this.dbl2=this.dblPayable,this.dblReceivable+this.dblPayable<0)continue}else if("Payables"==this.ViewModel.Preferences.IncludeBills){if(this.dbl1=this.dblPayable,this.dbl2=this.dblReceivable,this.dblReceivable+this.dblPayable>0)continue}else this.dbl1=this.dblReceivable+this.dblPayable,this.dbl2=0}for(this.drMainRow.Balance=this.dbl1,this.drMainRow.UnAdjusted=this.dbl2,this.drMainRow.NetBalance=this.dblReceivable+this.dblPayable,this.k=0;this.k<=this.Slabs.length;this.k++)this.arrSlabAmounts[this.k]=0,this.arrFSlabAmounts[this.k]=0;this.Slabs_MMMYY.forEach((function(e){a.arrMonthSlabAmounts[e]=0})),o=-1!=this.colPDCIndex&&null!=this.drMainRow.TotalPDC?parseFloat(this.drMainRow.TotalPDC):0;for(var d=function(s){var i=a.drRows[s];if(a.IsCQDate=!1,n=new Date(i.DocDate),a.AgeingBasedOnMaturityDate&&a.PDCInclude&&null!=i.CqMaturityDate&&a.arrPDCStatus.Contains(parseInt(i.Status))&&(a.ViewModel.Preferences.ContainsKey("PDCSlabBasedOnMatDate")&&"1"==a.ViewModel.Preferences.PDCSlabBasedOnMatDate&&(a.IsCQDate=!0),n=new Date(i.CqMaturityDate)),a.dblAmount=parseFloat(i.AdjAmount),"Receivables"==a.ViewModel.Preferences.IncludeBills){if(a.dblAmount<0)return"continue"}else if("Payables"==a.ViewModel.Preferences.IncludeBills&&a.dblAmount>0)return"continue";if(a.IsPaymentTermWise)if(a.dvPaymentTerms=a.dvPaymentTermsTable.filter((function(e){return e.VoucherNo==i.DocNo.toString()})),a.dvPaymentTerms.length>0){a.dblPaidTotal=Math.abs(parseFloat(i.Paid));for(var l=0;l<a.dvPaymentTerms.length;l++){var r=a.dvPaymentTerms[l];if(a.dbl2=parseFloat(r.Amount),n=new Date(r.DueDate),a.dbl2=a.dbl2-a.dblPaidTotal,a.dbl2<0)a.dblPaidTotal=-a.dbl2;else if(a.dbl2>0){if(a.dblPaidTotal=0,a.dblAmount<0&&(a.dbl2=-a.dbl2),-1!=a.colSlabIndex){for(a.i=0;a.i<a.Slabs.length&&!(n>a.Slabs[a.i]);a.i++);a.arrSlabAmounts[a.i]=a.arrSlabAmounts[a.i]+a.dbl2}a.ShowMonthWise&&(e=n.ToString("MMMyy"),a.arrMonthSlabAmounts.ContainsKey(e)?a.arrMonthSlabAmounts[e]+=a.dbl2:a.arrMonthSlabAmounts.MonthSlab+=a.dbl2)}else a.dblPaidTotal=0}}else{if(-1!=a.colSlabIndex){for(t=0;t<a.Slabs.length&&!(n>a.Slabs[t]);t++);a.arrSlabAmounts[t]+=a.dblAmount}a.ShowMonthWise&&(e=n.ToString("MMMyy"),a.arrMonthSlabAmounts.ContainsKey(e)?a.arrMonthSlabAmounts[e]+=a.dblAmount:a.arrMonthSlabAmounts.MonthSlab+=a.dblAmount)}else{if(-1!=a.colSlabIndex){if(a.IsCQDate)for(t=0;t<a.cqSlabs.length&&!(n<a.cqSlabs[t]);t++);else for(t=0;t<a.Slabs.length&&!(n>a.Slabs[t]);t++);a.arrSlabAmounts[t]+=a.dblAmount}a.ShowMonthWise&&(e=n.ToString("MMMyy"),a.arrMonthSlabAmounts.ContainsKey(e)?a.arrMonthSlabAmounts[e]+=a.dblAmount:a.arrMonthSlabAmounts.MonthSlab+=a.dblAmount)}-1!=a.colPDCIndex&&(o+=parseFloat(i.TotalPDC),a.PDCInclude&&a.arrPDCStatus.Contains(parseInt(i.Status))&&(o+=a.dblAmount))},C=0;C<this.drRows.length;C++)d(C);if(null!=this.drFRows&&this.drFRows.forEach((function(e){if(n=new Date(e.DocDate),a.dblAmount=parseFloat(e.AdjAmount),"Receivables"==a.ViewModel.Preferences.IncludeBills){if(a.dblAmount<0)return}else if("Payables"==a.ViewModel.Preferences.IncludeBills&&a.dblAmount>0)return;if(a.IsPaymentTermWise){var o=a.dvFPaymentTerms.filter((function(t){return t.VoucherNo==e.DocNo.toString()}));if(o.length>0)a.dblPaidTotal=Math.abs(parseFloat(e.Paid)),o.forEach((function(e){if(a.dbl2=parseFloat(e.Amount),n=new Date(e.DueDate),a.dbl2=a.dbl2-a.dblPaidTotal,a.dbl2<0)a.dblPaidTotal=-a.dbl2;else if(a.dbl2>0){if(a.dblPaidTotal=0,a.dblAmount<0&&(a.dbl2=-a.dbl2),-1!=a.colSlabIndex){for(a.i=0;a.i<a.FSlabs.length&&!(n<a.FSlabs[a.i]);a.i++);a.arrFSlabAmounts[a.i]=a.arrFSlabAmounts[a.i]+a.dbl2}}else a.dblPaidTotal=0}));else if(-1!=a.colSlabIndex){for(t=0;t<a.FSlabs.length&&!(n<a.FSlabs[t]);t++);a.arrFSlabAmounts[t]+=a.dblAmount}}else if(-1!=a.colSlabIndex){for(t=0;t<a.FSlabs.length&&!(n<a.FSlabs[t]);t++);a.arrFSlabAmounts[t]+=a.dblAmount}})),-1!=this.colPDCIndex&&(this.drMainRow.TotalPDC=o,this.drMainRow.BalanceInclPDC=this.PDCInclude?parseFloat(this.drMainRow.Balance):parseFloat(this.drMainRow.Balance)+o),this.ViewModel.FormulaColumns.length>0){for(var p=0;p<this.ViewModel.FormulaColumns.length;p++)if(this.ViewModel.CalculateFormula_2(this.ViewModel.FormulaColumns[p],this.drMainRow)){this.IgnoreRow=!0;break}if(this.IgnoreRow)continue}if(-1!=this.colSlabIndex)for(this.k=0;this.k<=this.Slabs.length;this.k++)this.k==this.SlabSize?(this.drMainRow.Slab=this.arrSlabAmounts[this.k],this.drMainRow.FSlab=this.arrFSlabAmounts[this.k]):(this.drMainRow["Slab"+(this.k+1)]=this.arrSlabAmounts[this.k],this.drMainRow["FSlab"+(this.k+1)]=this.arrFSlabAmounts[this.k]);this.ShowMonthWise&&this.Slabs_MMMYY.forEach((function(e){a.drMainRow[e]=a.arrMonthSlabAmounts[e]}));for(var T=0;T<this.oColumns.length;T++)this.CellValue=null,Object(u.isNullOrUndefined)(this.drMainRow[this.oColumns[T].ID])||(this.CellValue=this.drMainRow[this.oColumns[T].ID]),null!=this.CellValue&&(this.ViewModel.SetCellValue(this.CellValue,this.oColumns[T].DataFormat,this.oColumns[T].ColumnType,this.oRow.Cells[T]),this.ViewModel.TotalCols.Contains(this.oColumns[T].ID)&&i.e.IsNum(this.CellValue)&&(this.lstTotal[this.lstTotal.length-1][T]+=i.e.Double(this.CellValue)))}this.oRow.LevelNo<=this.LevelNo&&(this.oRow.IsGroup||(-1!=this.ViewModel.colSNoIndex&&(this.oRow.Cells[this.ViewModel.colSNoIndex].Value=++this.ViewModel.SNo,this.oRow.Cells[this.ViewModel.colSNoIndex].Text=this.ViewModel.SNo.toString()),this.ViewModel.ApplyKPI(this.oRow)),1==this.lstGroup.length&&this.ViewModel.AddGroupRows(this.dv,this.iMainRow),this.ViewModel.addRow(this.oRow))}this.ShowLevelTree&&this.UpdateTreeTotals(0),1==this.lstGroup.length&&null!=this.ViewModel.ParentReport?this.ViewModel.CheckAndAddTotals(this.dv):this.AddReportTotal_AgeingAnalysis()}},{key:"AddRow_AgeingAnalysisWithGroups",value:function(){var e,t,o,s=this;if(this.lstTotal=new Array,this.lstTotal.push(new Array(this.oColumns.length).fill(0)),this.ViewModel.ReportData=this.dsMain.Tables[0],this.ViewModel.ReportDataColumns=this.dsMain.Columns[0],!this.dsMain.Columns[0].Contains("Balance")){if(!this.AccountsWithZeroBalance)for(var l=this.dsMain.Tables[0].length-1;l>=0;l--)0==parseFloat(this.dsMain.Tables[0][l].AdjAmount)&&this.dsMain.Tables[0].RemoveAt(l);if(-1!=this.colSlabIndex){for(var n=1;n<=this.SlabSize;n++)this.dsMain.Columns[0].push("Slab"+n),this.dsMain.Columns[0].push("FSlab"+n);this.dsMain.Columns[0].push("Slab"),this.dsMain.Columns[0].push("FSlab")}this.dsMain.Columns[0].push("Balance"),this.dsMain.Columns[0].push("UnAdjusted"),this.dsMain.Columns[0].push("NetBalance"),-1!=this.colPDCIndex&&this.dsMain.Columns[0].push("BalanceInclPDC"),this.Slabs_MMMYY.forEach((function(e){s.dsMain.Columns[0].push(e)}))}for(this.IsPaymentTermWise&&(this.dvPaymentTerms=this.dvPaymentTermsTable=this.dsMain.Tables[1],this.dvPaymentTerms.SortBy(["DueDate"])),this.k=0;this.k<this.dv.length;this.k++){if(this.ViewModel.process.CancellationPending)return void(this.ViewModel.processArgs.Cancel=!0);if(this.IgnoreRow=!1,this.ViewModel.AddGroupRows(this.dv,this.k),this.dblAmount=parseFloat(this.dv[this.k].AdjAmount),0!=this.dblAmount){if(this.dblPayable=this.dblReceivable=0,this.dblAmount<0?this.dblPayable=this.dblAmount:this.dblReceivable=this.dblAmount,this.dv[this.k].NetBalance=this.dblAmount,"Receivables"==this.ViewModel.Preferences.IncludeBills?(this.dv[this.k].Balance=this.dblReceivable,this.dv[this.k].UnAdjusted=this.dblPayable):"Payables"==this.ViewModel.Preferences.IncludeBills?(this.dv[this.k].Balance=this.dblPayable,this.dv[this.k].UnAdjusted=this.dblReceivable):(this.dv[this.k].Balance=this.dblAmount,this.dv[this.k].UnAdjusted=0),o=new Date(this.dv[this.k].DocDate),"Receivables"==this.ViewModel.Preferences.IncludeBills&&this.dblAmount<0||"Payables"==this.ViewModel.Preferences.IncludeBills&&this.dblAmount>0);else if(this.IsPaymentTermWise)if(this.dvPaymentTerms=this.dvPaymentTerms.filter((function(e){return e.VoucherNo==s.dv[s.k].DocNo.toString()})),this.dvPaymentTerms.length>0){this.dblPaidTotal=Math.abs(parseFloat(this.dv[this.k].Paid));for(var a=0;a<this.dvPaymentTerms.length;a++){var h=this.dvPaymentTerms[a];if(this.dbl2=parseFloat(h.Amount),o=new Date(h.DueDate),this.dbl2=this.dbl2-this.dblPaidTotal,this.dbl2<0)this.dblPaidTotal=-this.dbl2;else if(this.dbl2>0){if(this.dblPaidTotal=0,parseFloat(this.dv[this.k].Amount)<0&&(this.dbl2=-this.dbl2),-1!=this.colSlabIndex){for(e=0;e<this.Slabs.length;e++)if(o>this.Slabs[e]){this.dbl1=i.e.Double(this.dv[this.k]["Slab"+(e+1)]),this.dv[this.k]["Slab"+(e+1)]=this.dbl1+this.dbl2;break}e==this.Slabs.length&&(this.dbl1=i.e.Double(this.dv[this.k].Slab),this.dv[this.k].Slab=this.dbl1+this.dbl2)}this.ShowMonthWise&&(t=o.ToString("MMMyy"),this.Slabs_MMMYY.Contains(t)?(this.dbl1=i.e.Double(this.dv[this.k][t]),this.dv[this.k][t]=this.dbl1+this.dbl2):(this.dbl1=i.e.Double(this.dv[this.k].MonthSlab),this.dv[this.k].MonthSlab=this.dbl1+this.dbl2))}else this.dblPaidTotal=0}}else{if(-1!=this.colSlabIndex){for(e=0;e<this.Slabs.length;e++)if(o>this.Slabs[e]){this.dv[this.k]["Slab"+(e+1)]=this.dblAmount;break}e==this.Slabs.length&&(this.dv[this.k].Slab=this.dblAmount)}this.ShowMonthWise&&(this.Slabs_MMMYY.Contains(o.ToString("MMMyy"))?this.dv[this.k][o.ToString("MMMyy")]=this.dblAmount:this.dv[this.k].MonthSlab=this.dblAmount)}else{if(-1!=this.colSlabIndex){for(e=0;e<this.Slabs.length;e++)if(o>this.Slabs[e]){this.dv[this.k]["Slab"+(e+1)]=this.dblAmount;break}e==this.Slabs.length&&(this.dv[this.k].Slab=this.dblAmount)}this.ShowMonthWise&&(this.Slabs_MMMYY.Contains(o.ToString("MMMyy"))?this.dv[this.k][o.ToString("MMMyy")]=this.dblAmount:this.dv[this.k].MonthSlab=this.dblAmount)}if(-1!=this.colPDCIndex&&(this.PDCInclude?(this.dv[this.k].BalanceInclPDC=this.dv[this.k].Balance,this.arrPDCStatus.Contains(parseInt(this.dv[this.k].Status))&&(this.dv[this.k].TotalPDC=this.dv[this.k].Balance)):this.dv[this.k].BalanceInclPDC=parseFloat(this.dv[this.k].Balance)+parseFloat(this.dv[this.k].TotalPDC)),this.GroupRowsCount>0){var c=this.ViewModel.Data.length-this.GroupRowsCount;c>=0&&this.ViewModel.Data[c].Type==r.f.Group&&(2==this.ViewModel.ReportGroups[0].CDGDO.ColumnCostCenterID&&(this.ViewModel.Data[c].NodeID=parseInt(this.dv[this.k].AccountID)),this.ViewModel.lstGroupIndex.Contains(c)||this.ViewModel.lstGroupIndex.push(c))}if(this.ViewModel.FormulaColumns.length>0){for(var D=0;D<this.ViewModel.FormulaColumns.length;D++)if(this.ViewModel.CalculateFormula_2(this.ViewModel.FormulaColumns[D],this.dv[this.k])){this.IgnoreRow=!0;break}if(this.IgnoreRow)continue}this.oRow=this.NewReportRow(),this.oRow.LevelNo=this.ViewModel.lstGroup.length,2==this.ViewModel.ReportGroups[1].CDGDO.ColumnCostCenterID&&(this.oRow.NodeID=parseInt(this.dv[this.k].AccountID));for(var d=0;d<this.oColumns.length;d++)this.CellValue=null,Object(u.isNullOrUndefined)(this.dv[this.oColumns[d].ID])||(this.CellValue=this.dv[this.k][this.oColumns[d].ID]),null!=this.CellValue&&(this.ViewModel.SetCellValue(this.CellValue,this.oColumns[d].DataFormat,this.oColumns[d].ColumnType,this.oRow.Cells[d]),d==this.colTotalSaleIndex||d==this.colPrevYearSaleIndex?this.ViewModel.totals[d][this.lstGroup.length]=parseFloat(this.CellValue):this.ViewModel.TotalCols.Contains(this.oColumns[d].ID)&&i.e.IsNum(this.CellValue)&&(0!=this.oColumns[d].UseOnce?this.ViewModel.totals[d][this.lstGroup.length]=parseFloat(this.CellValue):this.ViewModel.totals[d][this.lstGroup.length]+=parseFloat(this.CellValue)));this.ViewModel.IsSummary||(-1!=this.ViewModel.colSNoIndex&&(this.oRow.Cells[this.ViewModel.colSNoIndex].Value=++this.ViewModel.SNo,this.oRow.Cells[this.ViewModel.colSNoIndex].Text=this.ViewModel.SNo.toString()),this.ViewModel.ApplyKPI(this.oRow),this.ViewModel.addRow(this.oRow))}}this.ViewModel.CheckAndAddTotals(this.dv)}},{key:"UpdateTreeTotals",value:function(e){for(var t=this.lstTotal.length-1;t>e;t--){if(t>0)for(var o=0;o<this.lstTotal[t].length;o++)this.lstTotal[t-1][o]+=this.lstTotal[t][o];if(!this.GroupTotalsAtEnd)for(var s=0;s<this.oColumns.length;s++)"FLOAT"==this.oColumns[s].ColumnType&&s!=this.ViewModel.colSNoIndex&&this.ViewModel.SetCellValue(this.lstTotal[t][s],this.oColumns[s].DataFormat,"FLOAT",this.lstParents[t-1].Cells[s]);if(e<=this.LevelNo){if(this.lstParents.length>0){var i=this.ViewModel.Data.indexOf(this.lstParents[this.lstParents.length-1]);if(i>=0&&(this.ViewModel.Data.RemoveAt(i),(0!=this.lstTotal[t][1]||0!=this.lstTotal[t][3]||this.AccountsWithZeroBalance||-1!=this.colBalanceIndex&&0!=this.lstTotal[t][this.colBalanceIndex]||-1!=this.colNetBalanceIndex&&0!=this.lstTotal[t][this.colNetBalanceIndex])&&(this.ViewModel.Data.Insert(i,this.lstParents[this.lstParents.length-1]),this.GroupTotalsAtEnd))){var l=this.NewReportRow();l.Type=r.f.BalanceBF,l.Parent=this.lstParents[t-1].Parent,l.LevelNo=this.lstParents[t-1].LevelNo,l.Cells[0].IsNormal=!1,l.IsGroup=!0,l.Visible=this.lstParents[t-1].Visible,l.Cells[0].level=this.lstParents[t-1].LevelNo,l.Cells[0].Text=this.lstParents[t-1].Cells[0].Text+" - Total ",l.Cells[0].CellAppearance=this.GrossTotalAppearance_Data.Clone(),l.Cells[0].CellAppearance.Alignment=this.oColumns[0].DataAppearance.Alignment;for(var n=0;n<this.oColumns.length;n++)"FLOAT"==this.oColumns[n].ColumnType&&n!=this.ViewModel.colSNoIndex&&(l.Cells[n].IsNormal=!1,l.Cells[n].CellAppearance=this.GrossTotalAppearance_Data.Clone(),l.Cells[n].CellAppearance.Alignment=this.oColumns[n].DataAppearance.Alignment,this.ViewModel.SetCellValue(this.lstTotal[t][n],this.oColumns[n].DataFormat,"FLOAT",l.Cells[n]));this.ViewModel.addRow(l)}this.lstParents.RemoveAt(this.lstParents.length-1)}this.lstTotal.RemoveAt(this.lstTotal.length-1)}}}},{key:"UpdateAmounts",value:function(){for(this.dblReceivable=0,this.dblPayable=0,this.dblAmount_ForUnDue=0,this.dblBillAmount=0,this.i=0;this.i<this.drRows.length;this.i++)this.dblAmount=parseFloat(this.drRows[this.i].AdjAmount),this.dblAmount<0?this.dblPayable+=this.dblAmount:this.dblReceivable+=this.dblAmount,-1!=this.colUnDueIndex&&parseFloat(Math.abs(this.dblAmount).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount))>this.cmpValue&&(this.dblAmount_ForUnDue+=parseFloat(this.drRows[this.i].Amount)),-1!=this.colBillAmtIndex&&(this.dblBillAmount+=parseFloat(this.drRows[this.i].BillAmount))}},{key:"AddReportTotal_AgeingAnalysis",value:function(){this.row=this.NewReportRow_2(r.f.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance_Data),this.row.LevelNo=0;var e=-1;for(this.k=0;this.k<this.oColumns.length;this.k++)(this.ViewModel.GrpReportTotal.TotalCols.ContainsKey(this.oColumns[this.k].ID)||this.oColumns[this.k].ID.startsWith("Slab")&&this.ViewModel.GrpReportTotal.TotalCols.ContainsKey("Slab"))&&(-1==e&&(e=this.k),this.ViewModel.SetCellValue(this.lstTotal[0][this.k],this.oColumns[this.k].DataFormat,"FLOAT",this.row.Cells[this.k]));e>=0&&(e>0&&(this.row.Cells[0].Text=s.a.GetResource("Reports_ReportTotal"),this.row.Cells[0].CellAppearance.Alignment="Left",this.row.Cells[0].ColSpan=e),this.ViewModel.addRow(this.row))}},{key:"AddAgeingData",value:function(e){var t=this;if(e==this.lstGroup.length){if(!this.dsSubAgeing.Columns[0].Contains("Balance")){if(this.dsSubAgeing.Columns[0].push("Balance"),this.dsSubAgeing.Columns[0].push("UnAdjusted"),this.dsSubAgeing.Columns[0].push("NetBalance"),-1!=this.colLOBAgeingPDCIndex&&(this.dsSubAgeing.Columns[0].Contains("TotalPDC")||this.dsSubAgeing.Columns[0].push("TotalPDC"),this.dsSubAgeing.Columns[0].Contains("BalanceInclPDC")||this.dsSubAgeing.Columns[0].push("BalanceInclPDC")),-1!=this.colSlabIndex){for(var o=1;o<=this.SlabSize;o++)this.dsSubAgeing.Columns[0].push("Slab"+o),this.dsSubAgeing.Columns[0].push("FSlab"+o);this.dsSubAgeing.Columns[0].push("Slab"),this.dsSubAgeing.Columns[0].push("FSlab")}this.Slabs_MMMYY.forEach((function(e){t.dsSubAgeing.Columns[0].push(e)}))}this.BlankRowHeight>0&&(this.ViewModel.addRow(this.NewReportRow()),this.ViewModel.Data[this.ViewModel.Data.length-1].Type=r.f.BlankRow,this.ViewModel.Data[this.ViewModel.Data.length-1].Height=this.BlankRowHeight/10),this.row=this.NewReportRow_2(r.f.Header,this.HeaderAppearance),this.row.LevelNo=this.ViewModel.lstGroup.length;for(var s=0;s<this.LOBAgeingColumns.length;s++)this.row.Cells[s].Text=this.LOBAgeingColumns[s].HeaderText;var i;this.ViewModel.addRow(this.row);for(var l=this.dsSubAgeing.Tables[0],n=function(e){l=l.filter((function(o){return o[t.lstGroup[e].ID]==t.ViewModel.Groupstr[t.lstGroup[e].ID]}))},a=0;a<e;a++)n(a);if(0!=l.length&&(this.drRows=this.dsSubAgeing.Tables[1].filter((function(e){return e.AccountID==l[0].AccountID})),0!=this.drRows.length)){this.UpdateAmounts(),"Receivables"==this.ViewModel.Preferences.IncludeBills?(this.dbl1=this.dblReceivable,this.dbl2=this.dblPayable):"Payables"==this.ViewModel.Preferences.IncludeBills?(this.dbl1=this.dblPayable,this.dbl2=this.dblReceivable):(this.dbl1=this.dblReceivable+this.dblPayable,this.dbl2=0),l[0].Balance=this.dbl1,l[0].UnAdjusted=this.dbl2,l[0].NetBalance=this.dblReceivable+this.dblPayable,this.arrSlabAmounts=new Array(this.Slabs.length+1).fill(0),this.arrFSlabAmounts=new Array(this.Slabs.length+1).fill(0);for(var h=0,c=0;c<this.drRows.length;c++){var D=this.drRows[c];if(this.dtDocDate=new Date(D.DocDate),this.dbl1=parseFloat(D.AdjAmount),"Receivables"==this.ViewModel.Preferences.IncludeBills){if(this.dbl1<0)continue}else if("Payables"==this.ViewModel.Preferences.IncludeBills&&this.dbl1>0)continue;for(i=0;i<this.Slabs.length&&!(this.dtDocDate>this.Slabs[i]);i++);this.arrSlabAmounts[i]+=this.dbl1,-1!=this.colLOBAgeingPDCIndex&&(h+=parseFloat(D.TotalPDC),this.PDCInclude&&this.arrPDCStatus.Contains(parseInt(D.Status))&&(h+=this.dblAmount))}if(-1!=this.colLOBAgeingPDCIndex&&(l[0].TotalPDC=h,l[0].BalanceInclPDC=this.PDCInclude?parseFloat(l[0].Balance):parseFloat(l[0].Balance)+h),-1!=this.colSlabIndex)for(this.k=0;this.k<=this.Slabs.length;this.k++)this.k==this.SlabSize?(l[0].Slab=this.arrSlabAmounts[this.k],l[0].FSlab=this.arrFSlabAmounts[this.k]):(l[0]["Slab"+(this.k+1)]=this.arrSlabAmounts[this.k],l[0]["FSlab"+(this.k+1)]=this.arrFSlabAmounts[this.k]);this.row=this.NewReportRow(),this.row.LevelNo=this.ViewModel.lstGroup.length;for(var d=0;d<this.LOBAgeingColumns.length;d++)this.CellValue=null,Object(u.isNullOrUndefined)(l[0][this.LOBAgeingColumns[d].ID])||(this.CellValue=l[0][this.LOBAgeingColumns[d].ID]),null!=this.CellValue&&(this.row.Cells[d].CellAppearance=this.LOBAgeingColumns[d].DataAppearance.Clone(),this.row.Cells[d].IsNormal=!1,this.row.Cells[d].CellAppearance.Alignment="Center",this.ViewModel.SetCellValue(this.CellValue,this.LOBAgeingColumns[d].DataFormat,this.LOBAgeingColumns[d].ColumnType,this.row.Cells[d]));this.ViewModel.addRow(this.row)}}}},{key:"AddARAPRowSet",value:function(){var e=this,t=new a.a,o=this.NewReportRow_2(r.f.GrossTotal,this.GrossTotalAppearance_Data);o.Cells[0].Text="AMOUNT",o.Cells[0].CellAppearance.Alignment="Left",o.LevelNo=1;var s=this.NewReportRow_2(r.f.GrossTotal,this.GrossTotalAppearance_Data);s.Cells[0].Text="Total Collected",s.Cells[0].CellAppearance.Alignment="Left",s.LevelNo=1;var l=this.NewReportRow_2(r.f.GrossTotal,this.GrossTotalAppearance_Data);l.Cells[0].Text="Un Adjusted",l.Cells[0].CellAppearance.Alignment="Left",l.LevelNo=1;var n,h,u=this.NewReportRow_2(r.f.GrossTotal,this.GrossTotalAppearance_Data);u.Cells[0].Text="Net Balance",u.Cells[0].CellAppearance.Alignment="Left",u.LevelNo=1,this.ShowPreviousAdjustment&&(this.row=this.NewReportRow_2(r.f.GrossTotal,this.GrossTotalAppearance_Data),this.row.Cells[0].Text="Adjustments Of Previous Months",this.row.Cells[0].CellAppearance.Alignment="Left",this.row.LevelNo=1,t.push("PreviousAdj",this.row)),this.MonthSlabs.forEach((function(o){e.row=e.NewReportRow(),e.row.Cells[0].Text=o.ToString("MMM-yy").toUpperCase(),e.row.LevelNo=1,t.push(o.ToString("MMMyy"),e.row)})),this.ShowFutureAdjustment&&(this.row=this.NewReportRow_2(r.f.GrossTotal,this.GrossTotalAppearance_Data),this.row.Cells[0].Text="Adjustments Of Future Months",this.row.Cells[0].CellAppearance.Alignment="Left",this.row.LevelNo=1,t.push("FutureAdj",this.row));var c,D,d,C,p=0;if(this.IsConsolidated)this.MonthSlabs.forEach((function(a){D=0,d=0,C=0,n=a.ToString("MMMyy"),e.dvAmt=e.dvAmtTable.filter((function(e){return e.Yr==a.getFullYear()&&e.Mn==a.iMonth()})),e.dvUnAdj=e.dvUnAdjTable.filter((function(e){return e.Yr==a.getFullYear()&&e.Mn==a.iMonth()})),e.dvCollect=e.dvCollectTable.filter((function(e){return e.Yr==a.getFullYear()&&e.Mn==a.iMonth()})),1==e.dvAmt.length&&(D=parseFloat(e.dvAmt[0].Amount),e.ViewModel.SetCellValue(e.dvAmt[0].Amount,e.oColumns[e.colMonthSlabIndex+p].DataFormat,"FLOAT",o.Cells[e.colMonthSlabIndex+p])),1==e.dvUnAdj.length&&(d=parseFloat(e.dvUnAdj[0].Amount),e.ViewModel.SetCellValue(e.dvUnAdj[0].Amount,e.oColumns[e.colMonthSlabIndex+p].DataFormat,"FLOAT",l.Cells[e.colMonthSlabIndex+p])),e.dvCollect.length>0&&e.dvCollect.forEach((function(o){h=new Date(parseInt(o.CYr),parseInt(o.CMn),1),C+=parseFloat(o.Amount),h<e.ViewModel.oReportDialog.FromDate.Date?(c=i.e.Double(t.PreviousAdj.Cells[e.colMonthSlabIndex+p].Value),c+=parseFloat(o.Amount),e.ViewModel.SetCellValue(c,e.oColumns[e.colMonthSlabIndex+p].DataFormat,"FLOAT",t.PreviousAdj.Cells[e.colMonthSlabIndex+p])):h>e.ViewModel.oReportDialog.ToDate.Date?(c=i.e.Double(t.FutureAdj.Cells[e.colMonthSlabIndex+p].Value),c+=parseFloat(o.Amount),e.ViewModel.SetCellValue(c,e.oColumns[e.colMonthSlabIndex+p].DataFormat,"FLOAT",t.FutureAdj.Cells[e.colMonthSlabIndex+p])):e.ViewModel.SetCellValue(o.Amount,e.oColumns[e.colMonthSlabIndex+p].DataFormat,"FLOAT",t[h.ToString("MMMyy")].Cells[e.colMonthSlabIndex+p])})),e.ViewModel.SetCellValue(C,e.oColumns[e.colMonthSlabIndex+p].DataFormat,"FLOAT",s.Cells[e.colMonthSlabIndex+p]),c=D-(C+d),e.ViewModel.SetCellValue(c,e.oColumns[e.colMonthSlabIndex+p].DataFormat,"FLOAT",u.Cells[e.colMonthSlabIndex+p]),e.arrMonthSlabAmounts[n]+=c,p++}));else{this.row=this.NewReportRow_2(r.f.Group,this.ViewModel.lstGroup[0].GroupAppearance),this.ViewModel.lstGroup[0].Height>0&&(this.row.Height=this.ViewModel.lstGroup[0].Height),this.row.PrintVisible=this.ViewModel.lstGroup[0].GroupAppearance.IsPrintVisible,this.row.Cells[0].Text=this.drMainRow.AccountName.toString(),this.row.Cells[0].ColSpan=this.row.Cells.length,this.ViewModel.addRow(this.row);for(var T=function(a){var r=e.MonthSlabs[a];D=0,d=0,C=0,n=r.ToString("MMMyy"),e.arrRows=e.dvCollectTable.filter((function(t){return t.AccountID==e.drMainRow.AccountID.toString()&&t.Yr==r.getFullYear()&&t.Mn==r.iMonth()}));for(var T=0;T<e.dvAmt.length;T++){var _=e.dvAmt[T];if(parseInt(_.Yr)==r.getFullYear()&&parseInt(_.Mn)==r.iMonth()){D=parseFloat(_.Amount),e.ViewModel.SetCellValue(_.Amount,e.oColumns[e.colMonthSlabIndex+p].DataFormat,"FLOAT",o.Cells[e.colMonthSlabIndex+p]);break}}for(var m=0;m<e.dvUnAdj.length;m++){var I=e.dvUnAdj[m];if(parseInt(I.Yr)==r.getFullYear()&&parseInt(I.Mn)==r.iMonth()){d=parseFloat(I.Amount),e.ViewModel.SetCellValue(I.Amount,e.oColumns[e.colMonthSlabIndex+p].DataFormat,"FLOAT",l.Cells[e.colMonthSlabIndex+p]);break}}e.arrRows.length>0&&e.arrRows.forEach((function(o){h=new Date(parseInt(o.CYr),parseInt(o.CMn),1),C+=parseFloat(o.Amount),h<e.ViewModel.oReportDialog.FromDate.Date?(c=i.e.Double(t.PreviousAdj.Cells[e.colMonthSlabIndex+p].Value),c+=parseFloat(o.Amount),e.ViewModel.SetCellValue(c,e.oColumns[e.colMonthSlabIndex+p].DataFormat,"FLOAT",t.PreviousAdj.Cells[e.colMonthSlabIndex+p])):h>e.ViewModel.oReportDialog.ToDate.Date?(c=i.e.Double(t.FutureAdj.Cells[e.colMonthSlabIndex+p].Value),c+=parseFloat(o.Amount),e.ViewModel.SetCellValue(c,e.oColumns[e.colMonthSlabIndex+p].DataFormat,"FLOAT",t.FutureAdj.Cells[e.colMonthSlabIndex+p])):e.ViewModel.SetCellValue(o.Amount,e.oColumns[e.colMonthSlabIndex+p].DataFormat,"FLOAT",t[h.ToString("MMMyy")].Cells[e.colMonthSlabIndex+p])})),e.ViewModel.SetCellValue(C,e.oColumns[e.colMonthSlabIndex+p].DataFormat,"FLOAT",s.Cells[e.colMonthSlabIndex+p]),c=D-(C+d),e.ViewModel.SetCellValue(c,e.oColumns[e.colMonthSlabIndex+p].DataFormat,"FLOAT",u.Cells[e.colMonthSlabIndex+p]),e.arrMonthSlabAmounts[n]+=c,p++},_=0;_<this.MonthSlabs.length;_++)T(_)}this.CalculateARAPRowTotal(o),this.ViewModel.addRow(o),t.forEach((function(t){e.CalculateARAPRowTotal(t.Value),e.ViewModel.addRow(t.Value)})),this.CalculateARAPRowTotal(s),this.CalculateARAPRowTotal(l),this.CalculateARAPRowTotal(u),this.ViewModel.addRow(s),this.ViewModel.addRow(l),this.ViewModel.addRow(u)}},{key:"CalculateARAPRowTotal",value:function(e){for(var t=0,o=1;o<e.Cells.length;o++)t+=i.e.Double(e.Cells[o].Value);this.ViewModel.SetCellValue(t,this.oColumns[e.Cells.length-1].DataFormat,"FLOAT",e.Cells[e.Cells.length-1])}},{key:"GetFutureTransactionDrCrQuery",value:function(e,t){var o=this.GetDimensionFilter("DCC.dcCCNID");this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?o+=" AND 1<>1":o+=" AND DCC.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")");var s,l="";0==this.UnPostedDocsList.length?l=" AND (ACC.StatusID=369 or ACC.StatusID=429)":l+=" AND ACC.StatusID IN (369,429,"+this.UnPostedDocsList+")",s=this.PDCInclude?" AND ACC.DocumentType<>16 AND ((ACC.StatusID=370 OR ACC.StatusID=439"+(this.IncludeTerminatedPDC?" OR ACC.StatusID=452":"")+") OR (ACC.DocumentType<>14 AND ACC.DocumentType<>19"+l+"))":" AND ACC.DocumentType NOT IN (16,14,19)"+l,e.length>0&&(e.Contains(",")?s+=" and ACC.CostCenterID in ("+e+")":s+=" and ACC.CostCenterID="+e);var n="";return n+="declare @AsOnDate float\nSET @AsOnDate=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",n+="\nSELECT AccountID,sum(Dr) Dr,sum(Cr) Cr\nFROM (\nSELECT VoucherNo,AccountID\n,case when sum(Dr)>=sum(Cr) then sum(Dr)-sum(Cr) else null end Dr\n,case when sum(Dr)<sum(Cr) then sum(Cr)-sum(Dr) else null end Cr\nFROM (\nselect A.AccountID,ACC.VoucherNo,Amount Dr,0 Cr\nfrom ACC_DocDetails ACC with(nolock)\ninner join ACC_Accounts A with(nolock) ON ACC.DebitAccount=A.AccountID\ninner join COM_DocCCData DCC with(nolock) ON ACC.AccDocDetailsID=DCC.AccDocDetailsID\nwhere A.AccountID>1 AND (ACC.StatusID=369 or ACC.StatusID=429 or ACC.StatusID=439) AND ACC.DocDate>@AsOnDate"+o+s+"\nUNION ALL\nselect A.AccountID,ACC.VoucherNo,0 Dr,Amount Cr\nfrom ACC_DocDetails ACC with(nolock)\ninner join ACC_Accounts A with(nolock) ON ACC.CreditAccount=A.AccountID\ninner join COM_DocCCData DCC with(nolock) ON ACC.AccDocDetailsID=DCC.AccDocDetailsID\nwhere A.AccountID>1 AND ACC.DocDate>@AsOnDate"+o+s+"\nUNION ALL\nselect A.AccountID,ACC.VoucherNo,Amount Dr,0 Cr\nfrom ACC_DocDetails ACC with(nolock)\ninner join ACC_Accounts A with(nolock) ON ACC.DebitAccount=A.AccountID\ninner join COM_DocCCData DCC with(nolock) ON ACC.InvDocDetailsID=DCC.InvDocDetailsID\nwhere A.AccountID>1 AND (ACC.StatusID=369) AND ACC.DocDate>@AsOnDate"+o+s+"\nUNION ALL\nselect A.AccountID,ACC.VoucherNo,0 Dr,Amount Cr\nfrom ACC_DocDetails ACC with(nolock)\ninner join ACC_Accounts A with(nolock) ON ACC.CreditAccount=A.AccountID\ninner join COM_DocCCData DCC with(nolock) ON ACC.InvDocDetailsID=DCC.InvDocDetailsID"+o+s+"\nwhere A.AccountID>1 AND (ACC.StatusID=369) AND ACC.DocDate>@AsOnDate\n) AS T\nGROUP BY VoucherNo,AccountID\n) AS T\nGROUP BY AccountID",1==t?n+=" HAVING sum(Dr) is not null and sum(Dr)>0":2==t&&(n+=" HAVING sum(Cr) is not null and sum(Cr)>0"),n.toString()}}]),o}(n.b)},"4Moq":function(e,t,o){"use strict";o.d(t,"a",(function(){return r}));var s=o("Do2H"),i=o("Lp6j"),l=o("1xwR"),n=o("vTM8"),a=o("mvPR"),r=function(e){_inherits(o,e);var t=_createSuper(o);function o(e){var s;return _classCallCheck(this,o),(s=t.call(this,e)).DaysCol=0,s.MonthCols=0,s.tempCnt=0,s.UnitTypeID=0,s.Groupname=new Array,s.CurrRowsCount=0,s.FirstRow=new Array,s.PartTotals=new n.c,s.RentTotals=new n.c,s.CashTotals=new n.a,s.PartGroupTotals=new n.c,s.TempCols=new Array,s.index=0,s.rows=new Array,s.StrWhere="",s.ViewModel=e,s.oColumns=e.ReportColumns,s}return _createClass(o,[{key:"GetPropertyProfitSummaryAll",value:function(){var e=this,t="",o=this.ViewModel.GetCostCenterFilter(92,"T0.NodeID");(!this.ViewModel.HideCostCenterTree&&!this.ViewModel.oReportDialog.IsOneSelected||"1"!=s.a.SessionManager.UserID&&"1"!=s.a.SessionManager.RoleID&&s.a.SessionManager.Preferences["Dimension List"].split(",").Contains("92"))&&(t=o),t+=this.ViewModel.GetDimensionFilter("CCD.CCNID"),s.a.report.GetRentalReports(113,this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,t,"").then((function(t){var o,l,n;e.ViewModel.GrpReportTotal.TotalCols.Clear(),e.ViewModel.lstGroup.forEach((function(e){e.TotalCols.Clear()})),e.index=-1;for(var a=0;a<e.ViewModel.ColumnSource.length;a++)e.TempCols.push(e.ViewModel.ColumnSource[a]),"26000"==e.ViewModel.ColumnSource[a].FieldName&&(e.index=a);if(null!=t&&t.Tables.length>0){var r=t.Tables[0];r.length>0&&function(){var i,a;r.Columns.push("ActiveRent");var h,u,c=null,D=e.index;if(-1!=e.index){var d=e.TempCols[e.index];d.ColumnType="FLOAT",s.a.SessionManager.Preferences.DecimalsinAmount.length>0&&(d.DataFormat.DecimalsPoints=parseInt(s.a.SessionManager.Preferences.DecimalsinAmount)),d.DataFormat.Commas="Millions"==s.a.SessionManager.Preferences.Commas?1:2;for(var C=t.Tables[1].ToTable(!0,["PartID"]),p=function(o){var s=t.Tables[2][o];if(0==C.filter((function(e){return e.PartID==s.NodeID})).length)return"continue";h="P"+s.NodeID.toString();var i=d.Clone();i.ID=h,i.HeaderText=s.Name.toString(),e.TempCols.InsertAt(i,++e.index),r.Columns.push(h),e.ViewModel.TotalCols.Contains(i.ID)||e.ViewModel.TotalCols.push(i.ID),e.ViewModel.GrpReportTotal.TotalCols.ContainsKey(i.ID)?(e.ViewModel.GrpReportTotal.TotalCols[i.ID]=e.index-1,e.ViewModel.lstGroup.forEach((function(t){t.TotalCols[i.ID]=e.index-1}))):(e.ViewModel.GrpReportTotal.TotalCols.push(i.ID,e.index-1),e.ViewModel.lstGroup.forEach((function(t){t.TotalCols.push(i.ID,e.index-1)})))},T=0;T<t.Tables[2].length;T++)p(T)}for(var _=0;_<r.length;_++){if(u=r[_],t.Tables.length>1&&t.Tables[1].length>0&&-1!=e.index){a=t.Tables[1].filter((function(e){return e.ContractID==u.ContractID}));for(var m=0;m<a.length;m++){h=a[m].PartID.toString(),i=0;for(var I=0;I<a.length;I++)a[I].PartID.toString()==h&&(i+=parseFloat(a[I].Amount));r[_]["P"+h]=i}}if(r[_].SNO=(_+1).toString(),r[_].ToDate=e.ViewModel.oReportDialog.ToDate.Date.toString(),""!=u.StartDate.toString()&&""!=u.EndDate.toString()){o=r[_].TerminationDate?new Date(r[_].TerminationDate):new Date(r[_].EndDate),(void 0).dtCalCulateRentFrom=l,(void 0).dtCalCulateRentTo=n,r[_].ReportDays=e.GetReportDays(new Date(u.StartDate),o,void 0),l=(void 0).dtCalCulateRentFrom,n=(void 0).dtCalCulateRentTo,r[_].RentDay=parseFloat(u.TotalAmount)/e.CalculateDays(new Date(u.StartDate),new Date(u.EndDate));var R,S=e.CalculateMonths(new Date(u.StartDate),new Date(u.EndDate));if(R=0==S?30*parseFloat(r[_].RentDay):parseFloat(u.TotalAmount)/S,r[_].Rent=e.CalculateRentPaid(l,n,R),parseFloat(u.TotalAmount)<parseFloat(r[_].Rent)&&(r[_].Rent=u.TotalAmount),null!=e.ViewModel.oReportDialog.ToDate.Date){var A;if((A=e.CalculateDays(l>=e.ViewModel.oReportDialog.ToDate.Date?l.AddDays(-1):e.ViewModel.oReportDialog.ToDate.Date,o))>0){r[_].UnearnedDays=A-1;var M=0;l>new Date(r[_].StartDate)&&(M=e.CalculateRentPaid(new Date(r[_].StartDate),l.AddDays(-1),R));var g=parseFloat(u.TotalAmount)-parseFloat(r[_].Rent)-M;g>0&&(r[_].UnearnedAmount=g)}}}c!=r[_].Unit.toString()&&(r[_].ActiveRent=""!=r[_].TerminationDate.toString()?r[_].UnearnedAmount:"450"==r[_].StatusID.toString()||"0"==r[_].StatusID.toString()?0:r[_].TotalAmount,c=r[_].Unit.toString())}D>0&&(e.ViewModel.GrpReportTotal.TotalCols.Remove("Particular"),e.TempCols.RemoveAt(D))}()}e.ViewModel.totals=i.e.NumArray(e.TempCols.length,e.ViewModel.lstGroup.length+1),e.ViewModel.ReportColumns=e.TempCols,e.ViewModel.Refresh_lstSummaryData(),e.ViewModel.GrpReportTotal.TempTotalCols.keys.forEach((function(t){var o=e.TempCols.find((function(e){return e.ID==t}));o&&(e.ViewModel.GrpReportTotal.TotalCols.push(o.ID,e.TempCols.indexOf(o)),e.ViewModel.lstGroup.forEach((function(t){t.TotalCols.push(o.ID,e.TempCols.indexOf(o))})))})),e.ViewModel.LoadDynamicReportFromSP_CallBack(t)}))}},{key:"GetPropertyProfitSummary",value:function(){var e=this,t=this.ViewModel.oReportDialog.GetSeqNosList(),o="";this.ViewModel.HideCostCenterTree||this.ViewModel.oReportDialog.IsOneSelected?"1"!=s.a.SessionManager.UserID&&"1"!=s.a.SessionManager.RoleID&&s.a.SessionManager.Preferences["Dimension List"].split(",").Contains("92")&&t.length>0&&(o+=" AND P.NodeID IN ("+t+")"):t.length>0&&(o+=" AND P.NodeID IN ("+t+")");for(var i="",l=0;l<this.ViewModel.ReportColumns.length;l++)"Unit"==this.ViewModel.ReportColumns[l].ID&&"TREE ASC"==this.ViewModel.ReportColumns[l].DataFormat.Sort.toUpperCase()&&(i+=",U.Lft ASC");s.a.report.GetRentalReportsNew(73,this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,o,"",this.ViewModel.FromTag,this.ViewModel.SelectTag,"",i).then((function(t){var o,s,i;if(null!=t&&t.Tables.length>0){var l=t.Tables[0];if(l.length>0)for(var n=l,a=0;a<n.length;a++){o=l[a].TerminationDate?new Date(l[a].TerminationDate):new Date(l[a].EndDate);var r={dtCalCulateRentFrom:s,dtCalCulateRentTo:i};l[a].ReportDays=e.GetReportDays(new Date(n[a].StartDate),o,r),s=r.dtCalCulateRentFrom,i=r.dtCalCulateRentTo,l[a].RentTotMonths=e.GetReportMonths(new Date(n[a].StartDate),new Date(n[a].EndDate),e.ViewModel.oReportDialog.FromDate.Date,e.ViewModel.oReportDialog.ToDate.Date).split(".")[0];var h=e.CalculateDays(new Date(n[a].StartDate),new Date(n[a].EndDate));l[a].RentDay=h>0?parseFloat(n[a].TotalAmount)/h:0,h=e.CalculateMonths(new Date(n[a].StartDate),new Date(n[a].EndDate)),l[a].RentMonth=h>0?parseFloat(n[a].TotalAmount)/h:0,l[a].Rent=e.CalculateRentPaid(s,i,parseFloat(l[a].RentMonth)),""!=l[a].RentMonth.toString()&&(l[a].RentAmountMonth=Math.round(parseFloat(e.GetReportAmountMonths(new Date(n[a].StartDate),new Date(n[a].EndDate),e.ViewModel.oReportDialog.FromDate.Date,e.ViewModel.oReportDialog.ToDate.Date,parseFloat(l[a].RentMonth)))))}}e.ViewModel.LoadDynamicReportFromSP_CallBack(t)}))}},{key:"GetDailyVacantReport",value:function(){var e=this,t=this.ViewModel.oReportDialog.GetSeqNosList(),o="  SELECT distinct 1 ROWNO, T0.Name AS [Unit] ,T0.UnitID  UnitID,  T1.ContractNumber AS [ContractNumber]  , CONVERT(DATETIME,T1.ContractDate) AS [ContractDate],\n            T2.Name AS [Property] , 0 Occupied ,  T2.NodeId AS PropertyId, ( select count( Unt.UnitID ) from REN_Units Unt with(nolock) join REN_Property Prt with(nolock) on Unt.PropertyID=Prt.NodeID   and Prt.NodeId =  T2.nodeid WHERE  Prt.NodeId =  T2.nodeid and Unt.Unitid= T0.UnitID  GROUP BY Prt.NodeID ) VacantCount\n            FROM REN_Units T0 with(nolock),REN_Contract T1 with(nolock),REN_Property T2 with(nolock)   where T1.UnitID=T0.UnitID AND T1.PropertyID=T2.NodeID  and T0.Name is not null and T0.Name <>'' \n            AND T1.IsGroup <> 1    and T0.ContractID=0  AND CONVERT(DATETIME,T1.ContractDate) <= '"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'\n            AND CONVERT(DATETIME,T1.ContractDate)  >= '"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'";!this.ViewModel.HideCostCenterTree&&t.length>0&&(o+=" AND T0.NodeID IN ("+t+")"),o+=" ORDER BY T2.Name ",s.a.report.DataSetAsyn("RPT022",o).then((function(t){var o=[],s=0;if(null!=t&&t.Tables.length>0&&t.Tables[0].length>0){e.DaysCol=e.ViewModel.oReportDialog.ToDate.Date.Subtract(e.ViewModel.oReportDialog.FromDate.Date).Days;var l=e.ViewModel.oReportDialog.FromDate.Date;o=t.Tables[0];for(var n=0;n<e.ViewModel.ColumnSource.length;n++)e.TempCols.push(e.ViewModel.ColumnSource[n]);for(var a=0;a<=e.DaysCol;a++)e.AddColumns(l.toString(),l.getDate().toString()+"-"+e.GetMonth(l.Month),"Right",80,"",!1),l=l.AddDays(1);for(var r=0;r<o.length;r++){var h=o[r].PropertyId.toString(),u=o[r].UnitID.toString();l=e.ViewModel.oReportDialog.FromDate.Date;for(var c=0;c<=e.DaysCol;c++){var D=e.GetVacantFlatCount(l,h,u);null!=D?D.length>0?null!=o[r].VacantCount&&null!=D[0].Occupied&&(s=parseInt(o[r].VacantCount)-parseInt(D[0].Occupied)):null!=o[r].VacantCount&&(s=parseInt(o[r].VacantCount)):s=null!=o[r].VacantCount?parseInt(o[r].VacantCount):0,o[r][l.toString()]=s,l=l.AddDays(1)}}e.ViewModel.totals=i.e.NumArray(e.TempCols.length,e.ViewModel.lstGroup.length+1),e.ViewModel.ReportColumns=e.TempCols}e.ViewModel.LoadDynamicReportFromSP_CallBack(t)}))}},{key:"GetStatisticalReport",value:function(){var e=this,t=this.ViewModel.oReportDialog.GetSeqNosList(),o="  \tSELECT PROP.NODEID ,PROP.CODE , PROP.NAME  Property ,Lckup.Name  Category    \n            FROM  REN_Contract CONT with(nolock)\n            JOIN REN_PROPERTY PROP with(nolock) ON CONT.PROPERTYID = PROP.NODEID\n            LEFT JOIN COM_LOOKUP LCKUP with(nolock) ON PROP.PROPERTYCATEGORYLOOKUPID = LCKUP.NODEID\n             AND CONT.IsGroup <> 1 AND CONVERT(DATETIME,CONT.ContractDate) <= '"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'\n            AND CONVERT(DATETIME,CONT.ContractDate)  >= '"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"' \n            GROUP BY PROP.PROPERTYCATEGORYLOOKUPID ,PROP.CODE , PROP.NAME ,LCKUP.NAME , PROP.NODEID   ORDER BY Lckup.NAME, PROP.NAME  ";return!this.ViewModel.HideCostCenterTree&&t.length>0&&(o+=" AND T0.NodeID IN ("+t+")"),s.a.report.DataSetAsyn("RPT022",o).then((function(t){o="  DECLARE @TBLNAME NVARCHAR(50) ,@QRY NVARCHAR (MAX)\n                 SELECT @TBLNAME = TABLENAME FROM  dbo.ADM_Features with(nolock) WHERE FEATUREID in ( select value from dbo.ADM_GlobalPreferences with(nolock) where name  = 'UnitLinkDimension')    \n                 IF(@TBLNAME is not null and @TBLNAME <>'')\n                 BEGIN\n                  SET @QRY = ' select NodeID , Name  from ' + @TBLNAME+'  with(nolock)'\n                  EXEC (@QRY)\n                 END ",s.a.report.DataSetAsyn("RPT022",o).then((function(o){if(null!=o&&o.Tables.length>0&&o.Tables[0].length>0)for(var i=0;i<o.Tables[0].length;i++)t.Columns[0].Contains(o.Tables[0][i][1].toString())||(t.Columns[0].push(o.Tables[0][i][0].toString()),t.Columns[0].push(o.Tables[0][i][1].toString()));var l=[];l.push(e.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")),l.push(e.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")),l.push("Stat"),s.a.report.GetStatisticRpt(l).then((function(s){if(null!=t&&t.Tables.length>0&&t.Tables[0].length>0)for(var i=function(e){var o=s.Tables[0].filter((function(o){return o.TowerNodeno==t.Tables[0][e].NODEID}));if(o.length>0)for(var i=0;i<o.length;i++)t.Tables[0][e][o[i].NAME.toString()]=o[i].Occupied.toString()},l=0;l<t.Tables[0].length;l++)i(l);if(null!=t&&t.Tables.length>0&&t.Tables[0].length>0){for(var n=0;n<e.ViewModel.ColumnSource.length;n++)e.TempCols.push(e.ViewModel.ColumnSource[n]);if(null!=o&&o.Tables.length>0&&o.Tables[0].length>0)for(var a=0;a<o.Tables[0].length;a++)e.AddColumns(o.Tables[0][a].Name.toString(),o.Tables[0][a].Name.toString(),"Right",80,"",!1);e.ViewModel.ReportColumns=e.TempCols}e.ViewModel.LoadDynamicReportFromSP_CallBack(t)}))}))}))}},{key:"GetEmailDetails",value:function(){this.ViewModel.oReportDialog.GetSeqNosList();var e=" SELECT CostcenterID , NodeID,  [TO], CC ,[Subject] , [From],\n            ISNULL((SELECT TOP 1 VOUCHERNO FROM INV_DOCDETAILS with(nolock) WHERE COSTCENTERID =  His.CostcenterID AND DOCID  = His.NodeID ),(SELECT TOP 1 VOUCHERNO FROM ACC_DOCDETAILS with(nolock) WHERE COSTCENTERID =  His.CostcenterID AND DOCID  = His.NodeID ) )\n            AS VoucherNo , CONVERT(DATETIME , CREATEDDATE) CREATEDATE  FROM COM_Notif_History His with(nolock) WHERE His.STATUSID = 2 and CONVERT(DATETIME,CREATEDDATE) <= '"+this.ViewModel.oReportDialog.ToDate.Date.AddDays(1).ToString("dd MMM yyyy")+"'\n            AND CONVERT(DATETIME,CREATEDDATE)  >= '"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'  ORDER BY  [From] desc ";return s.a.report.DataSetAsyn("RPT022",e)}},{key:"TowerWisePropertyRpt",value:function(e,t,o,s){var i=this,l=e.Tables[1].ToTable(!0,["PARTNAME"]),n=0;s>0&&(this.CurrRowsCount=t.Tables[0].length-1,this.FirstRow.push(this.CurrRowsCount));for(var a=0;a<5;a++)t.Tables[0].push({});t.Tables[0][0+this.CurrRowsCount][0]=e.Tables[0][0].PropertyName.toString(),t.Tables[0][1+this.CurrRowsCount][0]="Total No of Sold Units",t.Tables[0][2+this.CurrRowsCount][0]="Total No of Rentable Units",t.Tables[0][3+this.CurrRowsCount][0]="Rent",t.Tables[0][4+this.CurrRowsCount][0]="Total Rent",null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&function(){var s,a=e.Tables[0],r=e.Tables[0];if((a=r.filter((function(e){return"Sold"==e.SoldStatus}))).length>0)for(var h=0;h<a.length;h++)""!=a[h].NodeID.toString()&&"0"!=a[h].NodeID.toString()&&(t.Tables[0][1+i.CurrRowsCount][a[h].NodeID.toString()]=a[h].Total.toString());if((a=r.filter((function(e){return"Not Sold"==e.SoldStatus}))).length>0)for(var u=0;u<a.length;u++)""!=a[u].NodeID.toString()&&"0"!=a[u].NodeID.toString()&&t.Columns[0].Contains(a[u].NodeID.toString())&&(t.Tables[0][2+i.CurrRowsCount][a[u].NodeID.toString()]=a[u].Total.toString());for(var c=0;c<a.length;c++)""!=a[c].NodeID.toString()&&"0"!=a[c].NodeID.toString()&&t.Columns[0].Contains(a[c].NodeID.toString())&&(t.Tables[0][3+i.CurrRowsCount][a[c].NodeID.toString()]=a[c].Rent.toString(),t.Tables[0][4+i.CurrRowsCount][a[c].NodeID.toString()]=a[c].Rent.toString(),i.RentTotals.ContainsKey(parseInt(a[c].NodeID))||i.RentTotals.push(parseInt(a[c].NodeID),parseFloat(a[c].Rent)));if(null!=o&&o.Tables.length>0&&o.Tables[0].length>0){a=o.Tables[0];for(var D=function(o){t.Tables[0].push({}),t.Tables[0][5+i.CurrRowsCount+o][0]=l[o].PARTNAME.toString();for(var n=function(n){var r=e.Tables[1].filter((function(e){return e.UnitTypeID==a[n].NodeID&&e.PARTNAME==l[o].PARTNAME.toString()}));r.length>0&&(s=parseInt(r[0].UnitTypeID),i.PartTotals.ContainsKey(s)||i.PartTotals.push(s,0),t.Tables[0][5+i.CurrRowsCount+o][a[n].NodeID.toString()]=r[0].AMOUNT.toString(),i.PartTotals[s]=i.PartTotals[s]+parseFloat(r[0].AMOUNT))},r=0;r<a.length;r++)n(r)},d=0;d<l.length;d++)D(d);if(t.Tables[0].push({}),n=t.Tables[0].length-1,t.Tables[0][n][0]="Total Other Income",t.Tables[0].push({}),t.Tables[0][n+1][0]="Total Net Rent",i.PartTotals.length>0&&i.PartTotals.keys.forEach((function(e){var o={Key:e,Value:i.PartTotals[e]};t.Tables[0][n][o.Key.toString()]=o.Value.toString()})),i.RentTotals.length>0){var C=0;i.RentTotals.keys.forEach((function(e){var o={Key:e,Value:i.PartTotals[e]};C=0,null!=t.Tables[0][n][o.Key.toString()]&&(C=parseFloat(t.Tables[0][n][o.Key.toString()])),null!=t.Tables[0][4+i.CurrRowsCount][o.Key.toString()]&&(t.Tables[0][n+1][o.Key.toString()]=C+parseFloat(o.Value))}))}}}(),null!=e&&e.Tables.length>2&&e.Tables[2].length>0&&(t.Tables[0].push({}),n=t.Tables[0].length-1,t.Tables[0].push({}),t.Tables[0].push({}),t.Tables[0][n][0]="Vacant Units in Nos",t.Tables[0][n+1][0]="Vacant Unit Amount",t.Tables[0][n+2][0]="Total Net Income",null!=o&&o.Tables.length>0&&o.Tables[0].length>0)&&function(){for(var s=o.Tables[0],l=function(o){var l=e.Tables[2].filter((function(e){return e.UnitTypeID==s[o].NodeID}));l.length>0&&(i.PartTotals.ContainsKey(parseInt(s[o].NodeID))||i.PartTotals.push(parseInt(s[o].NodeID),0),t.Tables[0][n][s[o].NodeID.toString()]=l[0].Vacant.toString(),t.Tables[0][n+1][s[o].NodeID.toString()]=l[0].Rent.toString()),(l=e.Tables[0].filter((function(e){return e.UnitTypeID==s[o].NodeID}))).length>0&&(i.PartTotals.ContainsKey(parseInt(s[o].NodeID))||i.PartTotals.push(parseInt(s[o].NodeID),0))},a=0;a<s.length;a++)l(a)}();var r=t.Tables[0].length-1;if(null!=o&&o.Tables.length>0&&o.Tables[0].length>0)for(var h=o.Tables[0],u=0;u<h.length;u++){var c=0,D=0;null!=t.Tables[0][r-3][h[u].NodeID.toString()]&&(c=parseFloat(t.Tables[0][r-3][h[u].NodeID.toString()])),null!=t.Tables[0][r-1][h[u].NodeID.toString()]&&(D=parseFloat(t.Tables[0][r-1][h[u].NodeID.toString()])),t.Tables[0][r][h[u].NodeID.toString()]=c-D}return t.Tables[0].push({}),t}},{key:"GetVacantFlatCount",value:function(e,t,o){var i=s.a.report.DataSet("RPT022","\" SELECT  COUNT(PROP.NodeId) Occupied ,PROP.NodeID PropertID  \n        from  REN_Contract T1 with(nolock)\n        join REN_Property  PROP with(nolock) on PROP.NodeID = T1.PropertyID\n        JOIN REN_Units UNIT with(nolock) ON UNIT.UnitID = T1.UnitID\n        left join   ( SELECT distinct   b.Name,b.NODEID     from REN_Units  a with(nolock)\n        inner join REN_Property  b with(nolock)  on b.NodeId = a.PropertyID \n        where a.Name is not null and a.Name <>''    ) as Tow on  \n        Tow.NODEID = PROP.NodeID WHERE    (Convert(datetime,T1.StartDate) <=  '"+e+"'  AND  CONVERT(DATETIME, T1.ENDDATE) >= '"+e+"') and T1.PropertyID = '"+t+"'  and T1.UnitId = '"+o+"' GROUP BY PROP.NodeID    ");return null!=i&&i.Tables.length>0&&i.Tables[0].length>0?i.Tables[0].AsDataView():null}},{key:"GetFiltersData",value:function(e,t){for(var o="",s=0;s<this.ViewModel.oReportDialog.CostCenterFilters.length;s++){var i=this.ViewModel.oReportDialog.CostCenterFilters[s];if(i.SelectedNodes.length>0||!i.DeleteButtonVisibility)if(50002==i.CostCenterID&&50002==t){this.StrWhere.Contains("WHERE")?o+=" AND ":o+=" WHERE ",o+=e+"   IN (";for(var l=0;l<i.SelectedNodes.length;l++)l>0&&(o+=","),o+=i.SelectedNodes[l].Id;o+=")"}else if(i.CostCenterID>5e4&&t>5e4&&50002!=t)if(this.StrWhere.Contains("WHERE")?o+=" AND ":o+=" WHERE ",1==i.SelectedNodes.length)o+=e+"="+i.SelectedNodes[0].Id;else{o+=e+" IN (";for(var n=0;n<i.SelectedNodes.length;n++)n>0&&(o+=","),o+=i.SelectedNodes[n].Id;o+=")"}else if(92==i.CostCenterID&&92==t){o+="  WHERE "+e+"   IN (";for(var a=0;a<i.SelectedNodes.length;a++)a>0&&(o+=","),o+=i.SelectedNodes[a].Id;o+=")"}}return o.toString()}},{key:"UnitWiseContractExp",value:function(){var e=this,t=" SELECT  VALUE FROM COM_COSTCENTERPREFERENCES with(nolock) WHERE COSTCENTERID = 92 AND NAME  = 'Landlord' ";s.a.report.DataSetAsyn("RPT022",t).then((function(o){t="";var l="",n=!1;l=e.GetFiltersData("UNT.PropertyID",92),e.ViewModel.oReportDialog.CostCenterFilters.forEach((function(t){(t.SelectedNodes.length>0||!t.DeleteButtonVisibility)&&(50002==t.CostCenterID?(n=!0,l+=e.GetFiltersData("UNT.LocationID",50002)):null!=o&&o.Tables.length>0&&o.Tables[0].length>0&&t.CostCenterID==parseInt(o.Tables[0][0][0])&&(l+=e.GetFiltersData("PROP.LandlordID",t.CostCenterID)))})),n||""==s.a.SessionManager.LocationWhere||(l.Contains("WHERE")?l+=" AND ":l+=" WHERE ",l=e.ViewModel.oReportDialog.Locations.Visible&&null!=e.ViewModel.oReportDialog.LocationWhere&&!i.e.IsEmpty(e.ViewModel.oReportDialog.LocationWhere)?l+" UNT.LOCATIONID IN ("+e.ViewModel.oReportDialog.LocationWhere+")":l+" UNT.LOCATIONID   IN ("+s.a.SessionManager.LocationWhere+")"),e.ViewModel.oReportDialog.GetSeqNosList(),e.StrWhere=e.GetFiltersData("UNT.PropertyID",92);var a=!1;e.ViewModel.oReportDialog.CostCenterFilters.forEach((function(t){(t.SelectedNodes.length>0||!t.DeleteButtonVisibility)&&(50002==t.CostCenterID?(a=!0,e.StrWhere=e.StrWhere+e.GetFiltersData("CNT.LOCATIONID",50002)):null!=o&&o.Tables.length>0&&o.Tables[0].length>0&&t.CostCenterID==parseInt(o.Tables[0][0][0])&&(e.StrWhere=e.StrWhere+e.GetFiltersData("PROP.LandlordID",t.CostCenterID)))})),a||""==s.a.SessionManager.LocationWhere||(e.StrWhere=e.StrWhere.Contains("WHERE")?e.StrWhere+" AND ":e.StrWhere+" WHERE ",e.StrWhere=e.ViewModel.oReportDialog.Locations.Visible&&null!=e.ViewModel.oReportDialog.LocationWhere&&!i.e.IsEmpty(e.ViewModel.oReportDialog.LocationWhere)?e.StrWhere+" CNT.LOCATIONID IN ("+e.ViewModel.oReportDialog.LocationWhere+")":e.StrWhere+" CNT.LOCATIONID   IN ("+s.a.SessionManager.LocationWhere+")"),s.a.report.GetRentalReports(140,e.ViewModel.oReportDialog.FromDate.Date,e.ViewModel.oReportDialog.ToDate.Date,l,e.StrWhere).then((function(t){e.ViewModel.LoadDynamicReportFromSP_CallBack(t)}))}))}},{key:"UnitRenewalReport",value:function(){this.ViewModel.oReportDialog.GetSeqNosList();var e="   SELECT P.NAME PROPERTYNAME ,U.NAME UNITNAME ,Te.FirstName ,CONVERT(DATETIME,R.ENDDATE) ENDDATE , R.TOTALAMOUNT Rent FROM REN_Contract R with(nolock)\n        INNER JOIN (\tselect  PROPERTYID , UNITID  , max(ENDDATE) ENDDATE  from REN_Contract with(nolock)\n        GROUP BY PROPERTYID , UNITID HAVING max(CONVERT(DATETIME,ENDDATE))<=  '"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"' and \n        max(CONVERT(DATETIME,ENDDATE))>= '"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"' ) AS T ON R.PROPERTYID=T.PROPERTYID AND R.UNITID=T.UNITID \t\n        AND R.ENDDATE=T.ENDDATE   LEFT JOIN REN_PROPERTY P ON R.PROPERTYID = P.NODEID  LEFT JOIN REN_UNITS  U with(nolock) ON R.UNITID = U.UNITID\n        LEFT JOIN REN_Tenant Te with(nolock) ON R.TENANTID = Te.TENANTID WHERE R.StatusID IN (426,427) ORDER BY P.NAME,CONVERT(DATETIME,R.ENDDATE)";return s.a.report.DataSetAsyn("RPT022",e)}},{key:"UnitVacant",value:function(){var e=this.ViewModel.GetCostCenterFilter(92,"PROP.NodeID");e+=this.ViewModel.GetDimensionFilter("CCD.CCNID");var t="",o=this.ViewModel.oReportDialog.CostCenterFilters.find((function(e){return 44==e.CostCenterID&&46==e.LookupTypeID}));o&&o.SelectedNodes.forEach((function(e){t=t+e.Id+","})),""!=t&&(e+=" AND UNT.UnitStatus IN ("+t.TrimEnd(",")+")");var i="";return this.ViewModel.Preferences.ContainsKey("IncludeUnUsedUnitsAtContract")&&"1"==this.ViewModel.Preferences.IncludeUnUsedUnitsAtContract&&(i="1"),s.a.report.GetRentalReports(127,this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,e,i)}},{key:"GetRentalReportsNew",value:function(){var e=this.ViewModel.oReportDialog.GetSeqNosList(),t="";this.ViewModel.HideCostCenterTree||this.ViewModel.oReportDialog.IsZeroSelected||this.ViewModel.oReportDialog.IsOneSelected?"1"!=s.a.SessionManager.UserID&&"1"!=s.a.SessionManager.RoleID&&!this.ViewModel.oReportDialog.IsZeroSelected&&s.a.SessionManager.Preferences["Dimension List"].split(",").Contains("92")&&e.length>0&&(t+=" AND P.NodeID IN ("+e+")"):e.length>0&&(t+=" AND P.NodeID IN ("+e+")"),e=this.ViewModel.GetCostCenterFilter(93,"U.UnitID"),(e+=this.ViewModel.GetCostCenterFilter(94,"T.TenantID ")).length>0&&(t+=e);for(var o="",l=0;l<this.ViewModel.ReportColumns.length;l++)"Unit"==this.ViewModel.ReportColumns[l].ID&&"TREE ASC"==this.ViewModel.ReportColumns[l].DataFormat.Sort.toUpperCase()&&(o+=",U.Lft ASC");var n=this.ViewModel.GroupSelectTag;if(214==this.ViewModel.StaticReportType)n=this.ViewModel.SelectTagAliasOnly;else if(210==this.ViewModel.StaticReportType&&this.ViewModel.Preferences.ContainsKey("Days")){var a=i.e.Int(this.ViewModel.Preferences.Days);a<=0&&(a=90),n=a.toString()}return s.a.report.GetRentalReportsNew(this.ViewModel.StaticReportType,this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,t,"",this.ViewModel.FromTag,this.ViewModel.SelectTag,n,o)}},{key:"CalculateRentPaid",value:function(e,t,o){var s,i=0,l=0,n=e;for(1!=n.getDate()?(l=n.DaysInMonth(),(s=new Date(n.getFullYear(),n.getMonth(),l))>t&&(s=t),i=o*(1+s.getDate()-n.getDate())/l,s=s.AddDays(1)):s=e;s<=t;)l=s.DaysInMonth(),(s=new Date(s.getFullYear(),s.getMonth(),l))>t?i+=o*(s=t).getDate()/l:i+=o,s=s.AddDays(1);return Math.round(i)}},{key:"GetReportAmountMonths",value:function(e,t,o,s,i){return e>=o?s<=t?this.CalculateReportAmount(e,s,i).toString():this.CalculateReportAmount(e,t,i).toString():s<=t?this.CalculateReportAmount(o,s,i).toString():this.CalculateReportAmount(o,t,i).toString()}},{key:"CalculateReportAmount",value:function(e,t,o){var s=0,i=0,l=e;for(l=(l=l.AddMonths(1)).AddDays(-(l.getDate()-1));t>l;)s+=o,l=l.AddMonths(1);return e.getDate()>1?(i=e.getDate(),s+=o/e.DaysInMonth()*(e.DaysInMonth()-i+1)):1==e.getDate()&&(s+=o),l.Date>t.Date?s-=o/t.DaysInMonth()*(t.DaysInMonth()-t.getDate()):l.Date==t.Date&&(s+=o),s.toString()}},{key:"GetReportDays",value:function(e,t,o){var s=this.ViewModel.oReportDialog.FromDate.Date,i=this.ViewModel.oReportDialog.ToDate.Date;return o.dtCalCulateRentFrom=e>=s?e:s,o.dtCalCulateRentTo=i<=t?i<=e?e.AddDays(-1):i:t,this.CalculateDays(o.dtCalCulateRentFrom,o.dtCalCulateRentTo)}},{key:"GetReportMonths",value:function(e,t,o,s){return e>=o?s<=t?this.CalculateMonths(e,s).toString():this.CalculateMonths(e,t).toString():s<=t?this.CalculateMonths(o,s).toString():this.CalculateMonths(o,t).toString()}},{key:"CalculateMonths",value:function(e,t){try{var o=0,s=e,i=e.DaysInMonth()-e.getDate();if(i<4)for(i+=1;t>s;)o++,s=(s=s.AddMonths(1)).DaysInMonth()>=e.getDate()?new Date(s.getFullYear(),s.getMonth(),e.getDate()-1):new Date(s.getFullYear(),s.getMonth(),s.DaysInMonth()-i);else for(;t>s;)o++,s=s.AddMonths(1);return o}catch(l){return 0}}},{key:"CalculateDays",value:function(e,t){try{return t.Subtract(e).Days+1}catch(o){return 0}}},{key:"GetMonth",value:function(e){switch(e){case 1:return"Jan";case 2:return"Feb";case 3:return"Mar";case 4:return"Apr";case 5:return"May";case 6:return"June";case 7:return"July";case 8:return"Aug";case 9:return"Sep";case 10:return"Oct";case 11:return"Nov";case 12:return"Dec";default:return""}}},{key:"AddColumns",value:function(e,t,o,i,l,n){var a=this.ViewModel.ColumnSource[this.ViewModel.ColumnSource.length-1].Clone();a.ID=e,a.FieldName=e,a.HeaderText=t,a.width=i,"Right"==o?(a.DataAppearance.Alignment="Right",a.DataFormat.DecimalsPoints=null!=s.a.SessionManager.Preferences.DecimalsinAmount&&""!=s.a.SessionManager.Preferences.DecimalsinAmount.toString()?parseInt(s.a.SessionManager.Preferences.DecimalsinAmount):3,a.ColumnType="FLOAT",a.DataFormat.Commas=1):"Left"==o&&(a.DataAppearance.Alignment="Left"),a.Formula="",this.TempCols.Contains(a)||this.TempCols.push(a)}},{key:"AddReportRows",value:function(e,t){this.oColumns[0].DataAppearance.IsBold=!0;for(var o,s=0,i=0;i<e.Tables[0].length;i++){if(o=new a.d(this.oColumns.length),s=0,"CashFlow"==t||"TowerWise"==t||"RentUnits"==t){for(var l=1;l<e.Columns[0].length-1;l++)null!=e.Tables[0][i][l]&&"0"!=e.Tables[0][i][l].toString()&&(s+=parseFloat(e.Tables[0][i][l]));e.Tables[0][i].TotalRow=s.toString()}for(var n=0;n<this.oColumns.length;n++){var r="";if(""!=this.oColumns[n].Formula||e.Columns[0].Contains(this.oColumns[n].ID)&&(r=e.Tables[0][i][this.oColumns[n].ID].toString()),""!=r&&(this.ViewModel.SetCellValue(r,this.oColumns[n].DataFormat,this.oColumns[n].ColumnType,o.Cells[n]),this.FirstRow.Contains(i)&&0==n)){if("RentUnits"==t){o.Cells[0].ColSpan=this.oColumns.length;break}o.Cells[0].ColSpan=this.oColumns.length-1}}"TowerWise"==t&&null!=o.Cells[0].Text&&"Total No of Sold Units"==o.Cells[0].Text.toString()&&this.ViewModel.Preferences.ContainsKey("HideTotalNoofSoleUnits")&&"1"==this.ViewModel.Preferences.HideTotalNoofSoleUnits.toString()||(this.ViewModel.ApplyKPI(o),this.ViewModel.addRow(o))}}},{key:"GetTowerWiseRentAnalysis",value:function(){var e=this,t=this.ViewModel.GetCostCenterFilter(92,"PROP.NodeID");t+=this.ViewModel.GetDimensionFilter("CCD.CCNID");var o=[];o.push(this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")),o.push(this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")),o.push(t),s.a.report.GetTowerwiseRentRpt(o).then((function(t){var o=[];s.a.report.DataSetAsyn("RPT022","  DECLARE @TBLNAME NVARCHAR(50) ,@QRY NVARCHAR (MAX)\n                 SELECT @TBLNAME = TABLENAME FROM  dbo.ADM_Features with(nolock) WHERE FEATUREID in ( select value from dbo.ADM_GlobalPreferences with(nolock) where name  = 'UnitLinkDimension')    \n                 IF(@TBLNAME is not null and @TBLNAME <>'')\n                 BEGIN\n                  SET @QRY = ' select NodeID , Name  from ' + @TBLNAME+'  with(nolock)'\n                  EXEC (@QRY)\n                 END ").then((function(s){if(null!=t&&t.Tables.length>0&&t.Tables[0].length>0)for(var i=0;i<e.ViewModel.ColumnSource.length;i++)e.TempCols.push(e.ViewModel.ColumnSource[i]),"26000"==e.ViewModel.ColumnSource[i].FieldName&&(e.index=i);if(o.Tables.push([]),o.Columns.push([]),o.Columns[0].push("Property"),null!=s&&s.Tables.length>0&&s.Tables[0].length>0)for(var l=0;l<s.Tables[0].length;l++)o.Columns[0].Contains(s.Tables[0][l][0].toString())||o.Columns[0].push(s.Tables[0][l][0].toString()),o.Columns[0].Contains(s.Tables[0][l][1].toString())||o.Columns[0].push(s.Tables[0][l][1].toString());for(var a,r=t.Tables[0].DefaultView.ToTable(!0,"PropertyID"),h=new n.c,u=new Array,c=function(i){a={};var l=t.Tables[0].filter((function(e){return e.PropertyID==r[i].PropertyID}));a.Tables.push(l);var n=t.Tables[1].filter((function(e){return e.PropertyID==r[i].PropertyID}));if(a.Tables.push(n),t.Tables.length>2&&t.Tables[2].length>0){var c=t.Tables[2].filter((function(e){return e.PropertyID==r[i].PropertyID}));a.Tables.push(c)}e.FirstRow.push(0),e.RentTotals.Clear(),e.PartTotals.Clear(),o=e.TowerWisePropertyRpt(a,o,s,i),null!=e.PartTotals&&e.PartTotals.length>0&&(s.Tables[0].forEach((function(e){h.ContainsKey(parseInt(e.NodeId))||h.push(parseInt(e.NodeId),e.Name.toString())})),e.PartTotals.keys.forEach((function(t){u.Contains(t.toString())||(u.push(t.toString()),e.AddColumns(t.toString(),h[t],"Right",80,"",!1))})))},D=0;D<r.length;D++)c(D);e.AddColumns("TotalRow","TOTAL","Right",80,"",!1),o.Columns[0].push("TotalRow"),e.index>0&&(e.ViewModel.GrpReportTotal.TotalCols.Remove("Particular"),e.TempCols.RemoveAt(e.index)),e.ViewModel.ReportColumns=e.TempCols,e.oColumns=e.ViewModel.ReportColumns,e.AddReportRows(o,"TowerWise"),e.ViewModel.process_RunWorkerCompleted()}))}))}},{key:"GetCashFlowTowerwise",value:function(){var e=this;this.FirstRow.Clear(),this.FirstRow.push(0);var t=this.ViewModel.oReportDialog.GetSeqNosList(),o=[];o.push(this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")),o.push(this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")),o.push(t),this.ViewModel.Preferences.ContainsKey("ParticularsDetails")?o.push(this.ViewModel.Preferences.ParticularsDetails):o.push(0),s.a.report.GetCashFlowRpt(o).then((function(t){var o,s={Tables:[],Columns:[]},i=t.Tables[0].ToTable(!0,["PropertyID"]);e.MonthCols=e.CalculateMonths(e.ViewModel.oReportDialog.FromDate.Date,e.ViewModel.oReportDialog.ToDate.Date);var l=e.ViewModel.oReportDialog.FromDate.Date;s.Tables.push([]),s.Columns.push([]),s.Columns[0].push("Property"),s.Columns[0].push("ParticularNodeID");for(var n=0;n<e.ViewModel.ColumnSource.length;n++)e.TempCols.push(e.ViewModel.ColumnSource[n]),"26000"==e.ViewModel.ColumnSource[n].FieldName&&(e.index=n);for(var a=0;a<=e.MonthCols;a++)e.AddColumns(l.toString(),e.GetMonth(l.iMonth())+"-"+l.getFullYear().toString(),"Right",80,"",!1),s.Columns[0].push(l.toString()),l=l.AddMonths(1);e.AddColumns("TotalRow","TOTAL","Right",80,"",!1),s.Columns[0].push("TotalRow");for(var r=function(l){if(e.CashTotals.Clear(),l>0&&(e.CurrRowsCount=s.Tables[0].length-1,e.FirstRow.push(e.CurrRowsCount)),null!=t&&t.Tables.length>0&&t.Tables[0].length>0){o=t.Tables[0].filter((function(e){return e.PropertyID==i[l].PropertyID}));for(var n=0;n<3;n++)s.Tables[0].push({});s.Tables[0][0+e.CurrRowsCount][0]=o[0].PropertyName.toString(),s.Tables[0][1+e.CurrRowsCount][0]="No of Units to be Renewed",s.Tables[0][2+e.CurrRowsCount][0]="Monthwise Rent to be renewed ";var a=o[0].PropertyId.toString();e.MonthCols>0&&e.GetVacantFlat(e.ViewModel.oReportDialog.FromDate.Date,a,t,e.MonthCols,e.CurrRowsCount,s)}s.Tables[0].push({})},h=0;h<i.length;h++)r(h);e.index>0&&(e.ViewModel.GrpReportTotal.TotalCols.Remove("Particular"),e.TempCols.RemoveAt(e.index)),e.ViewModel.ReportColumns=e.TempCols,e.oColumns=e.ViewModel.ReportColumns,e.AddReportRows(s,"CashFlow"),e.ViewModel.process_RunWorkerCompleted()}))}},{key:"GetTigerReconRpt",value:function(e){var t=this;this.FirstRow.Clear(),this.FirstRow.push(0);var o=0,i=0,l=0,a=this.ViewModel.oReportDialog.GetSeqNosList(),r=-1,h=[];h.push(this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")),h.push(this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")),h.push(a),h.push(125==e?1:2),s.a.report.GetTigerReconRpt(h).then((function(e){var s={Tables:[],Columns:[]},a=new n.a;t.MonthCols=t.CalculateMonths(t.ViewModel.oReportDialog.FromDate.Date,t.ViewModel.oReportDialog.ToDate.Date);var h=t.ViewModel.oReportDialog.FromDate.Date;s.Tables.push([]),s.Columns.push([]),s.Columns[0].push("Property"),s.Columns[0].push("ParticularNodeID");for(var u=0;u<t.ViewModel.ColumnSource.length;u++)t.TempCols.push(t.ViewModel.ColumnSource[u]),"26000"==t.ViewModel.ColumnSource[u].FieldName&&(t.index=u);for(var c=0;c<=t.MonthCols;c++)t.AddColumns(h.toString(),t.GetMonth(h.Month)+"-"+h.getFullYear().toString(),"Right",80,"",!1),s.Columns[0].push(h.toString()),t.CashTotals.ContainsKey(h.toString())||t.CashTotals.push(h.toString(),0),a.ContainsKey(h.toString())||a.push(h.toString(),0),h=h.AddMonths(1);t.AddColumns("TowerTotal","Tower Total","Right",80,"",!1),s.Columns[0].push("TowerTotal"),t.AddColumns("TowerCount","Tower Count","Right",80,"",!1),s.Columns[0].push("TowerCount"),null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&function(){for(var l=e.Tables[0].ToTable(!0,["PropertyID","PropertyName","GroupName"]),n=e.Tables[0].ToTable(!0,["PropertyName"]),h=e.Tables[0],u=t.ViewModel.oReportDialog.FromDate.Date,c=function(c){o=0,i=0,t.Groupname.Contains(l[c].GroupName.toString())||(c>0&&(s.Tables[0].push({}),r++,s.Tables[0][r][0]="GROUP TOTAL",t.CashTotals.keys.forEach((function(e){a[e]=a[e]+t.CashTotals[e.toString()],s.Tables[0][r][e.toString()]=t.CashTotals[e.toString()].toString(),i+=parseFloat(t.CashTotals[e.toString()])})),s.Tables[0][r].TowerTotal=i.toString(),t.CashTotals.Clear()),t.Groupname.push(l[c].GroupName.toString()),s.Tables[0].push({}),r++,s.Tables[0][r][0]=l[c].GroupName.toString(),t.FirstRow.push(r)),s.Tables[0].push({}),r++,s.Tables[0][r][0]=n[c].PropertyName.toString(),u=t.ViewModel.oReportDialog.FromDate.Date;for(var D=0;D<=t.MonthCols;D++)t.CashTotals.ContainsKey(u.toString())||t.CashTotals.push(u.toString(),0),(h=e.Tables[0].filter((function(e){return e.PropertyID==l[c].PropertyID&&e.monthdate==u.iMonth()+" - "+u.getFullYear()}))).length>0&&(h.length>0&&null!=h[0].Rent?(s.Tables[0][r][u.toString()]=parseInt(h[0].Rent),t.CashTotals[u.toString()]=t.CashTotals[u.toString()]+parseInt(h[0].Rent),o+=parseInt(h[0].Rent)):s.Tables[0][r][u.toString()]=0),u=u.AddMonths(1);if(s.Tables[0][r].TowerTotal=o,null!=e&&e.Tables.length>1&&e.Tables[1].length>0){var d=e.Tables[1].filter((function(e){return e.PropertyID==l[c].PropertyID}));d.length>0&&(s.Tables[0][r].TowerCount=d[0].UnitCount.toString())}},D=0;D<l.length;D++)c(D);i=0,r>=0&&(s.Tables[0].push({}),r++,s.Tables[0][r][0]="GROUP TOTAL",t.CashTotals.keys.forEach((function(e){a[e]=a[e]+t.CashTotals[e],s.Tables[0][r][e.toString()]=t.CashTotals[e].toString(),i+=parseFloat(t.CashTotals[e.toString()])})),s.Tables[0][r].TowerTotal=i.toString()),s.Tables[0].push({}),r++,s.Tables[0].push({}),r++,s.Tables[0][r][0]="TOTAL"}(),null!=a&&a.length>0&&(a.keys.forEach((function(e){r>=0&&(s.Tables[0][r][e.toString()]=a[e].toString(),l+=parseFloat(a[e]))})),r>=0&&(s.Tables[0][r].TowerTotal=l.toString())),t.index>0&&(t.ViewModel.GrpReportTotal.TotalCols.Remove("Particular"),t.TempCols.RemoveAt(t.index)),t.ViewModel.ReportColumns=t.TempCols,t.oColumns=t.ViewModel.ReportColumns,t.AddReportRows(s,"TigerRecon"),t.ViewModel.process_RunWorkerCompleted()}))}},{key:"GetVacantFlat",value:function(e,t,o,s,i,l){var n=this,a=o.Tables[0],r=o.Tables[1],h=(r=o.Tables[1].filter((function(e){return e.PropertyID==t}))).ToTable(!0,["ParticularName"]),u=r.ToTable(!0,["PARTNODEID"]);r=o.Tables[1];var c,D,d;D=l.Tables[0].length-1;for(var C=0;C<h.length;C++)l.Tables[0].push({}),l.Tables[0][3+i+C][0]=h[C].ParticularName.toString(),l.Tables[0][3+i+C].ParticularNodeID=u[C].PARTNODEID.toString();d=l.Tables[0].length-1;for(var p=0;p<s;p++){if(c=e.toString(),this.CashTotals.ContainsKey(c)||this.CashTotals.push(c,0),(a=o.Tables[0].filter((function(o){return o.PropertyID==t&&o.monthdate==e.iMonth()+" - "+e.getFullYear()}))).length>0&&(l.Tables[0][1+i][e.toString()]=a.length>0&&null!=a[0].UnitCount?parseInt(a[0].UnitCount):0,a.length>0&&null!=a[0].Rent?(l.Tables[0][2+i][e.toString()]=parseInt(a[0].Rent),this.CashTotals[c]=this.CashTotals[c]+parseInt(a[0].Rent)):l.Tables[0][2+i][e.toString()]=0),(r=o.Tables[1].filter((function(o){return o.PropertyID==t&&o.monthdate==e.iMonth()+" - "+e.getFullYear()}))).length>0&&function(){for(var s=0,a=D;a<d;a++)(r=o.Tables[1].filter((function(o){return o.PropertyID==t&&o.monthdate==e.iMonth()+" - "+e.getFullYear()&&o.PARTNODEID==u[s].PARTNODEID}))).length>0&&(l.Tables[0][3+i+s][e.toString()]=r[0].Rent.toString(),n.CashTotals[c]=n.CashTotals[c]+parseInt(r[0].Rent)),s++}(),0==p&&(l.Tables[0].push({}),this.tempCnt=l.Tables[0].length-1,l.Tables[0].push({}),l.Tables[0].push({}),l.Tables[0][this.tempCnt][0]="Total Cash Inflow",l.Tables[0][this.tempCnt+1][0]="Less tiger Against Liabilities",l.Tables[0][this.tempCnt+2][0]="Staff Flat"),l.Tables[0][this.tempCnt][e.toString()]=this.CashTotals[c].toString(),o.Tables[3].length>0){var T=o.Tables[3].filter((function(o){return o.PropertyID==t&&o.monthdate==e.iMonth()+" - "+e.getFullYear()}));T.length>0&&(l.Tables[0][this.tempCnt+1][e.toString()]=T[0].Rent.toString())}if(o.Tables[2].length>0){var _=o.Tables[2].filter((function(o){return o.PropertyID==t&&o.monthdate==e.iMonth()+" - "+e.getFullYear()}));_.length>0&&(l.Tables[0][this.tempCnt+2][e.toString()]=_[0].Rent.toString())}if(0==p&&l.Tables[0].push({}),l.Tables[0][this.tempCnt+3][0]="Vacant Flats",o.Tables[4].length>0){var m=o.Tables[4].filter((function(o){return o.PropertyID==t&&(null==o.monthdate||o.monthdate==e.iMonth()+" - "+e.getFullYear())}));if(m.length>0){var I=0;m.forEach((function(e){null!=e.Rent&&(I+=parseFloat(e.Rent))})),l.Tables[0][this.tempCnt+3][e.toString()]=I.toString()}}0==p&&l.Tables[0].push({}),l.Tables[0][this.tempCnt+4][0]="Net Cash Flow";var R,S,A,M,g;if(R=null!=l.Tables[0][this.tempCnt][e.toString()]&&""!=l.Tables[0][this.tempCnt][e.toString()].toString()?parseFloat(l.Tables[0][this.tempCnt][e.toString()]):0,S=null!=l.Tables[0][this.tempCnt+1][e.toString()]&&""!=l.Tables[0][this.tempCnt+1][e.toString()].toString()?parseFloat(l.Tables[0][this.tempCnt+1][e.toString()]):0,A=null!=l.Tables[0][this.tempCnt+2][e.toString()]&&""!=l.Tables[0][this.tempCnt+2][e.toString()].toString()?parseFloat(l.Tables[0][this.tempCnt+2][e.toString()]):0,l.Tables[0][this.tempCnt+4][e.toString()]=R-S-A,g=R-S-A,0==p&&l.Tables[0].push({}),l.Tables[0][this.tempCnt+5][0]="Last Year Expenses",o.Tables.length>5&&o.Tables[5].length>0){var w=o.Tables[5].filter((function(o){return o.PropertyID==t&&o.monthdate==e.iMonth()+"-"+e.getFullYear()}));w.length>0&&(l.Tables[0][this.tempCnt+5][e.toString()]=w[0].Rent.toString())}M=null!=l.Tables[0][this.tempCnt+5][e.toString()]&&"0"!=l.Tables[0][this.tempCnt+5][e.toString()].toString()?parseFloat(l.Tables[0][this.tempCnt+5][e.toString()]):0,0==p&&l.Tables[0].push({}),l.Tables[0][this.tempCnt+6][0]="TOTAL NET CASH FLOW",l.Tables[0][this.tempCnt+6][e.toString()]=g-M,e=e.AddMonths(1)}}},{key:"GetRentUnitsRpt",value:function(){var e,t=this,o=0,i=this.ViewModel.oReportDialog.GetSeqNosList(),l=[];l.push(1),this.ViewModel.Preferences.ContainsKey("Data")&&"Assigned"==this.ViewModel.Preferences.Data?l.push(2):l.push(1),l.push(this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")),l.push(this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")),l.push(i),s.a.report.GetRentUnitsRpt(l).then((function(s){var i=s.Tables[0],l=s.Tables[1],n=l;if(0!=l.length){var a={Tables:[],Columns:[]};a.Tables.push([]),a.Columns.push([]),a.Columns[0].push("Property"),a.Columns[0].push("ParticularNodeID"),(void 0)[s.Columns[0][0]]=-1,(void 0)[s.Columns[0][1]]="TOTAL",i.push(void 0);for(var r=0;r<i.length;r++)a.Columns[0].Contains(i[r][0].toString())||a.Columns[0].push(i[r][0].toString()),a.Columns[0].Contains(i[r][1].toString())||a.Columns[0].push(i[r][1].toString());for(var h=0;h<t.ViewModel.ColumnSource.length;h++)t.TempCols.push(t.ViewModel.ColumnSource[h]),"26000"==t.ViewModel.ColumnSource[h].FieldName&&(t.index=h);var u=l.ToTable(!0,["PropertyID","GroupName"]),c=l.ToTable(!0,["PropertyName"]);o=-1;for(var D=function(s){t.Groupname.Contains(u[s].GroupName.toString())||(s>0&&(a.Tables[0].push({}),o++,a.Tables[0][o][0]="GROUP TOTAL",t.PartTotals.keys.forEach((function(e){t.PartGroupTotals[e]=t.PartGroupTotals[e]+t.PartTotals[e],a.Tables[0][o][e.toString()]=t.PartTotals[e].toString()})),t.PartTotals.Clear()),t.Groupname.push(u[s].GroupName.toString()),a.Tables[0].push({}),o++,a.Tables[0][o][0]=u[s].GroupName.toString(),t.FirstRow.push(o)),a.Tables[0].push({}),o++,a.Tables[0][o][0]=c[s].PropertyName.toString(),e=0;for(var r=function(r){(n=l.filter((function(e){return e.UnitTypeID==i[r].NodeID&&e.PropertyID==u[s].PropertyID}))).length>0&&(t.UnitTypeID=parseInt(n[0].UnitTypeID),t.PartTotals.ContainsKey(t.UnitTypeID)||t.PartTotals.push(t.UnitTypeID,0),t.PartGroupTotals.ContainsKey(t.UnitTypeID)||t.PartGroupTotals.push(t.UnitTypeID,0),a.Tables[0][o][i[r].NodeID.toString()]=n[0].UnitCount.toString(),t.PartTotals[t.UnitTypeID]=t.PartTotals[t.UnitTypeID]+parseFloat(n[0].UnitCount),e+=parseFloat(n[0].UnitCount))},h=0;h<i.length;h++)r(h);a.Tables[0][o][-1]=e,t.PartTotals.ContainsKey(-1)||t.PartTotals.push(-1,0),t.PartGroupTotals.ContainsKey(-1)||t.PartGroupTotals.push(-1,0),t.PartTotals[-1]=t.PartTotals[-1]+e},d=0;d<u.length;d++)D(d);o>=0&&(a.Tables[0].push({}),o++,a.Tables[0][o][0]="GROUP TOTAL",t.PartTotals.keys.forEach((function(e){t.PartGroupTotals[e]=t.PartGroupTotals[e]+t.PartTotals[e],a.Tables[0][o][e.toString()]=t.PartTotals[e].toString()}))),a.Tables[0].push({}),o++,t.FirstRow.push(o),a.Tables[0].push({}),o++,a.Tables[0][o][0]="TOTAL",null!=t.PartGroupTotals&&t.PartGroupTotals.length>0&&i.forEach((function(e){t.PartGroupTotals.ContainsKey(parseInt(e.NodeId))&&(t.AddColumns(e.NodeId.toString(),e.Name.toString(),"Right",80,"",!1),t.TempCols[t.TempCols.length-1].DataFormat.DecimalsPoints=0,a.Tables[0][o][e.NodeId.toString()]=t.PartGroupTotals[parseInt(e.NodeId)])})),t.index>0&&(t.ViewModel.GrpReportTotal.TotalCols.Remove("Particular"),t.TempCols.RemoveAt(t.index)),t.ViewModel.ReportColumns=t.TempCols,t.oColumns=t.ViewModel.ReportColumns,t.AddReportRows(a,"RentinUnits"),t.ViewModel.process_RunWorkerCompleted()}}))}},{key:"GetRentUnitAmtRpt",value:function(){var e=this,t=0,o=this.ViewModel.oReportDialog.GetSeqNosList(),i=[];i.push(2),this.ViewModel.Preferences.ContainsKey("Data")&&"Assigned"==this.ViewModel.Preferences.Data?i.push(2):i.push(1),i.push(this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")),i.push(this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")),i.push(o),s.a.report.GetRentUnitsRpt(i).then((function(o){var s=o.Tables[0],i=o.Tables[1],l=i;if(0!=i.length){var n={Tables:[],Columns:[]};n.Tables.push([]),n.Columns.push([]),n.Columns[0].push("Property"),n.Columns[0].push("ParticularNodeID");for(var a=0;a<s.length;a++)n.Columns[0].Contains(s[a][0].toString())||n.Columns[0].push(s[a][0].toString()),n.Columns[0].Contains(s[a][1].toString())||n.Columns[0].push(s[a][1].toString());for(var r=0;r<e.ViewModel.ColumnSource.length;r++)e.TempCols.push(e.ViewModel.ColumnSource[r]),"26000"==e.ViewModel.ColumnSource[r].FieldName&&(e.index=r);var h=i.ToTable(!0,["PropertyID","GroupName"]),u=i.ToTable(!0,["PropertyName"]);t=-1;for(var c=function(o){e.Groupname.Contains(h[o].GroupName.toString())||(o>0&&(n.Tables[0].push({}),t++,n.Tables[0][t][0]="GROUP TOTAL",e.PartTotals.keys.forEach((function(o){e.PartGroupTotals[o]=e.PartGroupTotals[o]+e.PartTotals[o],n.Tables[0][t][o.toString()]=e.PartTotals[o].toString()})),e.PartTotals.Clear()),e.Groupname.push(h[o].GroupName.toString()),n.Tables[0].push({}),t++,n.Tables[0][t][0]=h[o].GroupName.toString(),e.FirstRow.push(t)),n.Tables[0].push({}),t++,n.Tables[0][t][0]=u[o].PropertyName.toString();for(var a=function(a){(l=i.filter((function(e){return e.UnitTypeID==s[a].NodeID&&e.PropertyID==h[o].PropertyID}))).length>0&&(e.UnitTypeID=parseInt(l[0].UnitTypeID),e.PartTotals.ContainsKey(e.UnitTypeID)||e.PartTotals.push(e.UnitTypeID,0),e.PartGroupTotals.ContainsKey(e.UnitTypeID)||e.PartGroupTotals.push(e.UnitTypeID,0),n.Tables[0][t][s[a].NodeID.toString()]=l[0].UnitCount.toString(),e.PartTotals[e.UnitTypeID]=e.PartTotals[e.UnitTypeID]+parseFloat(l[0].UnitCount))},r=0;r<s.length;r++)a(r)},D=0;D<h.length;D++)c(D);t>=0&&(n.Tables[0].push({}),t++,n.Tables[0][t][0]="GROUP TOTAL",e.PartTotals.keys.forEach((function(o){e.PartGroupTotals[o]=e.PartGroupTotals[o]+e.PartTotals[o],n.Tables[0][t][o.toString()]=e.PartTotals[o].toString()}))),n.Tables[0].push({}),t++,e.FirstRow.push(t),n.Tables[0].push({}),t++,n.Tables[0][t][0]="TOTAL",null!=e.PartGroupTotals&&e.PartGroupTotals.length>0&&s.forEach((function(o){e.PartGroupTotals.ContainsKey(parseInt(o.NodeId))&&(e.AddColumns(o.NodeId.toString(),o.Name.toString(),"Right",80,"",!1),n.Tables[0][t][o.NodeId.toString()]=e.PartGroupTotals[parseInt(o.NodeId)])})),e.AddColumns("TotalRow","TOTAL","Right",80,"",!1),n.Columns[0].push("TotalRow"),e.index>0&&(e.ViewModel.GrpReportTotal.TotalCols.Remove("Particular"),e.TempCols.RemoveAt(e.index)),e.ViewModel.ReportColumns=e.TempCols,e.oColumns=e.ViewModel.ReportColumns,e.AddReportRows(n,"RentUnits"),e.ViewModel.process_RunWorkerCompleted()}else e.ViewModel.process_RunWorkerCompleted()}))}},{key:"GetShareHolders",value:function(){var e=this,t="";this.ViewModel.Preferences.ContainsKey("PropertyLinkDimension")&&(t=this.GetFilterByDimension_1(parseInt(this.ViewModel.Preferences.PropertyLinkDimension)));var o=this.GetFilterByDimension_1(2);s.a.report.GetRentalReports(168,this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,t,o).then((function(t){for(var o,s,l,n=t.Tables[0],r=t.Tables[1],h=t.Tables[2],u=h.DefaultView.ToTable(!0,["AccountID","AccountName"]),c=null,D=new Array,d=0;d<e.ViewModel.ColumnSource.length;d++)"Share"!=e.ViewModel.ColumnSource[d].ID?D.push(e.ViewModel.ColumnSource[d]):c=e.ViewModel.ColumnSource[d].Clone();e.ViewModel.TotalCols.Clear(),e.ViewModel.GrpReportTotal.TotalCols.Clear(),e.ViewModel.AddTotalColumnsToGroup(e.ViewModel.GrpReportTotal,e.ViewModel.ReportDoc.SelectSingleNode("PactRevenURpts/PactRevenURptDef/ReportTotal/Columns"));for(var C=0;C<u.length;C++){n.Columns.push(u[C].AccountID.toString()),r.Columns.push(u[C].AccountID.toString());var p=c.Clone();p.HeaderText=u[C].AccountName.toString(),p.ID=u[C].AccountID.toString(),e.ViewModel.TotalCols.push(p.ID),e.ViewModel.GrpReportTotal.TotalCols.push(p.ID,D.length-1),D.push(p)}e.ViewModel.ReportColumns=D,e.oColumns=e.ViewModel.ReportColumns;var T=new Array(e.oColumns.length),_=new Array(e.oColumns.length),m=new Array(e.oColumns.length);for((l=e.NewReportRow_2(a.f.BalanceBF,e.GrossTotalAppearance_Data)).LevelNo=0,l.Cells[0].CellAppearance=e.GrossTotalAppearance,l.Cells[0].Text="Opening Balance",o=2;o<e.oColumns.length;o++){var I=h.filter((function(t){return t.AccountID==e.oColumns[o].ID})).Compute("sum","OpBalance");null!=I&&(T[o]=parseFloat(I),e.ViewModel.SetCellValue(I,e.oColumns[o].DataFormat,e.oColumns[o].ColumnType,l.Cells[o]))}for(e.ViewModel.addRow(l),o=0;o<n.length;o++){s=parseFloat(n[o].Balance);for(var R=h.filter((function(e){return e.PID==n[o].PID})),S=0;S<R.length;S++)n[o][R[S].AccountID.toString()]=parseFloat(R[S].Income)*s/100;(l=e.NewReportRow()).DataRow=n[o];for(var A=0;A<e.oColumns.length;A++)e.CellValue=null,n.Columns.Contains(e.oColumns[A].ID)&&(e.CellValue=n[o][e.oColumns[A].ID]),null!=e.CellValue&&(e.ViewModel.SetCellValue(e.CellValue,e.oColumns[A].DataFormat,e.oColumns[A].ColumnType,l.Cells[A]),s=i.e.Double(e.CellValue),T[A]+=s);-1==e.ViewModel.colSNoIndex||l.IsGroup||(l.Cells[e.ViewModel.colSNoIndex].Value=++e.ViewModel.SNo,l.Cells[e.ViewModel.colSNoIndex].Text=e.ViewModel.SNo.toString()),l.IsGroup||e.ViewModel.ApplyKPI(l),e.ViewModel.addRow(l)}for((l=e.NewReportRow_2(a.f.BalanceBF,e.GrossTotalAppearance_Data)).LevelNo=0,l.Cells[0].CellAppearance=e.GrossTotalAppearance,l.Cells[0].Text="Net Income",o=0;o<e.oColumns.length;o++)e.ViewModel.TotalCols.Contains(e.oColumns[o].ID)&&e.ViewModel.SetCellValue(T[o],e.oColumns[o].DataFormat,e.oColumns[o].ColumnType,l.Cells[o]);for(e.ViewModel.addRow(l),o=0;o<r.length;o++){s=parseFloat(r[o].Balance);for(var M=h.filter((function(e){return e.PID==r[o].PID})),g=0;g<M.length;g++)r[o][M[g].AccountID.toString()]=parseFloat(M[g].Expenses)*s/100;for(var w=0;w<e.oColumns.length;w++)"FLOAT"==e.oColumns[w].ColumnType&&n.Columns.Contains(e.oColumns[w].ID)&&null!=r[o][e.oColumns[w].ID]&&(s=i.e.Double(r[o][e.oColumns[w].ID]),_[w]+=s)}for((l=e.NewReportRow()).LevelNo=0,l.Cells[0].CellAppearance=e.GrossTotalAppearance,l.Cells[0].Text="Share of Expense",o=0;o<e.oColumns.length;o++)e.ViewModel.TotalCols.Contains(e.oColumns[o].ID)&&e.ViewModel.SetCellValue(_[o],e.oColumns[o].DataFormat,e.oColumns[o].ColumnType,l.Cells[o]);for(e.ViewModel.addRow(l),(l=e.NewReportRow()).LevelNo=0,l.Cells[0].CellAppearance=e.GrossTotalAppearance,l.Cells[0].Text="Drawings/Payable to Share Holder",o=2;o<e.oColumns.length;o++){var f=h.filter((function(t){return t.AccountID==e.oColumns[o].ID}));f.length>0&&null!=f[0].Balance&&(m[o]=parseFloat(f[0].Balance),e.ViewModel.SetCellValue(f[0].Balance,e.oColumns[o].DataFormat,e.oColumns[o].ColumnType,l.Cells[o]))}for(e.ViewModel.addRow(l),(l=e.NewReportRow_2(a.f.BalanceBF,e.GrossTotalAppearance_Data)).LevelNo=0,l.Cells[0].CellAppearance=e.GrossTotalAppearance,l.Cells[0].Text="Net Payable/Receviable",o=0;o<e.oColumns.length;o++)e.ViewModel.TotalCols.Contains(e.oColumns[o].ID)&&e.ViewModel.SetCellValue(-T[o]+m[o]-_[o],e.oColumns[o].DataFormat,e.oColumns[o].ColumnType,l.Cells[o]);e.ViewModel.addRow(l),e.ViewModel.process_RunWorkerCompleted()}))}},{key:"LoadReportWithPostFilters",value:function(e){}},{key:"LoadReport",value:function(){121==this.ViewModel.StaticReportType?this.GetTowerWiseRentAnalysis():122==this.ViewModel.StaticReportType?this.GetCashFlowTowerwise():123==this.ViewModel.StaticReportType?this.GetRentUnitsRpt():124==this.ViewModel.StaticReportType||124==this.ViewModel.StaticReportType?this.GetRentUnitAmtRpt():125==this.ViewModel.StaticReportType?this.GetTigerReconRpt(125):126==this.ViewModel.StaticReportType?this.GetTigerReconRpt(126):168==this.ViewModel.StaticReportType&&this.GetShareHolders()}}]),o}(l.b)},"8GKY":function(e,t,o){"use strict";o.r(t),o.d(t,"DocumentViewerComponent",(function(){return r}));var s=o("3Pt+"),i=o("fXoL"),l=o("ofXK"),n=o("towX");function a(e,t){if(1&e&&(i.Xb(0),i.Wc(1,"\n            "),i.Vb(2,7),i.Wc(3,"\n        "),i.Wb()),2&e){var o=t.$implicit,s=i.lc();i.Db(2),i.tc("obj",o)("group",s.form)}}var r=function(){var e=function(){function e(){_classCallCheck(this,e),this.form=new s.j({})}return _createClass(e,[{key:"ngOnInit",value:function(){var e;(null===(e=this.params)||void 0===e?void 0:e.obj)&&(this.obj=this.params.obj)}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i.Nb({type:e,selectors:[["app-document-viewer"]],inputs:{obj:"obj"},decls:18,vars:1,consts:[[2,"height","100%"],[2,"position","absolute","left","7px","top","48%","cursor","pointer","background-color","var(--menu-bgcolor)","width","30px","height","30px","border-radius","15px",3,"click"],[1,"fa-light","fa-angle-left",2,"font-size","19px","position","absolute","left","0","top","48%","cursor","pointer","color","#fff","left","10px","top","5px"],[2,"position","absolute","right","7px","top","48%","cursor","pointer","background-color","var(--menu-bgcolor)","width","30px","height","30px","border-radius","15px",3,"click"],[1,"fa-light","fa-angle-right",2,"font-size","19px","position","absolute","left","0","top","48%","cursor","pointer","color","#fff","left","10px","top","5px"],[2,"height","calc(100% - 0px)","width","calc(100% - 40px)","margin","auto"],[4,"ngFor","ngForOf"],["ScreenDirective","",3,"obj","group"]],template:function(e,t){1&e&&(i.Zb(0,"div",0),i.Wc(1,"\n    "),i.Zb(2,"span",1),i.hc("click",(function(){return t.obj.OnButtonClick("PREVIOUS")})),i.Wc(3,"\n        "),i.Ub(4,"i",2),i.Wc(5,"\n    "),i.Yb(),i.Wc(6,"\n    "),i.Zb(7,"span",3),i.hc("click",(function(){return t.obj.OnButtonClick("NEXT")})),i.Wc(8,"\n        "),i.Ub(9,"i",4),i.Wc(10,"\n    "),i.Yb(),i.Wc(11,"\n    \n    "),i.Zb(12,"div",5),i.Wc(13,"\n        "),i.Uc(14,a,4,2,"ng-container",6),i.Wc(15,"\n    "),i.Yb(),i.Wc(16,"\n    "),i.Wc(17,"\n"),i.Yb()),2&e&&(i.Db(14),i.tc("ngForOf",t.obj.Screen))},directives:[l.s,n.a],encapsulation:2}),e}()},"Br+L":function(e,t,o){"use strict";o.d(t,"a",(function(){return c}));var s=o("3Pt+"),i=o("fXoL");function l(e,t){if(1&e){var o=i.ac();i.Zb(0,"button",6),i.hc("click",(function(){return i.Ic(o),i.lc().obj.OnButtonClick("ApproveAll")})),i.Wc(1,"Approve All"),i.Yb()}}function n(e,t){if(1&e){var o=i.ac();i.Zb(0,"button",6),i.hc("click",(function(){return i.Ic(o),i.lc().obj.OnButtonClick("RejectAll")})),i.Wc(1,"Reject All"),i.Yb()}}function a(e,t){if(1&e){var o=i.ac();i.Zb(0,"button",6),i.hc("click",(function(){return i.Ic(o),i.lc().obj.OnButtonClick("ApproveAllforward")})),i.Wc(1,"Approve All & forward"),i.Yb()}}function r(e,t){if(1&e){var o=i.ac();i.Zb(0,"button",6),i.hc("click",(function(){return i.Ic(o),i.lc().obj.OnButtonClick("forward")})),i.Wc(1,"Move forward"),i.Yb()}}function h(e,t){if(1&e){var o=i.ac();i.Zb(0,"button",6),i.hc("click",(function(){return i.Ic(o),i.lc().obj.OnButtonClick("SuspendAll")})),i.Wc(1,"Suspend All"),i.Yb()}}function u(e,t){if(1&e){var o=i.ac();i.Zb(0,"button",6),i.hc("click",(function(){return i.Ic(o),i.lc().obj.OnButtonClick("SuspendPR")})),i.Wc(1,"Suspend PR"),i.Yb()}}var c=function(){var e=function(){function e(){_classCallCheck(this,e),this.form=new s.j({})}return _createClass(e,[{key:"ngOnInit",value:function(){}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i.Nb({type:e,selectors:[["app-approve"]],decls:29,vars:7,consts:[[1,"master-screen",2,"padding-bottom","4px","min-width","400px"],[1,"PACTHeaderFields","dialogSubBody"],[1,"form-group","row","form-row","col-xl-12","col-md-12","col-sm-12","col-xs-12","PACTControl"],["FieldDirective","",3,"obj"],[1,"Pactdailogfooter"],["class","primary-btn-wicon",3,"click",4,"ngIf"],[1,"primary-btn-wicon",3,"click"]],template:function(e,t){1&e&&(i.Zb(0,"div",0),i.Wc(1,"\n    "),i.Zb(2,"div",1),i.Wc(3,"\n        "),i.Zb(4,"div",2),i.Wc(5,"\n            "),i.Vb(6,3),i.Wc(7,"\n        "),i.Yb(),i.Wc(8,"\n    "),i.Yb(),i.Wc(9,"\n    "),i.Zb(10,"div",4),i.Wc(11,"\n      "),i.Zb(12,"div"),i.Wc(13,"\n        "),i.Uc(14,l,2,0,"button",5),i.Wc(15,"\n        "),i.Uc(16,n,2,0,"button",5),i.Wc(17,"\n        "),i.Uc(18,a,2,0,"button",5),i.Wc(19,"\n        "),i.Uc(20,r,2,0,"button",5),i.Wc(21,"\n        "),i.Uc(22,h,2,0,"button",5),i.Wc(23,"\n        "),i.Uc(24,u,2,0,"button",5),i.Wc(25,"\n      "),i.Yb(),i.Wc(26,"\n  "),i.Yb(),i.Wc(27,"\n"),i.Yb(),i.Wc(28,"\n")),2&e&&(i.Db(6),i.tc("obj",t.obj.Remarks),i.Db(8),i.tc("ngIf",t.obj.AppAllVisible),i.Db(2),i.tc("ngIf",t.obj.RejectAllVisible),i.Db(2),i.tc("ngIf",t.obj.ApproveAllforwardVisible),i.Db(2),i.tc("ngIf",t.obj.forwardVisible),i.Db(2),i.tc("ngIf",t.obj.SuspendVisiblity),i.Db(2),i.tc("ngIf",t.obj.SuspendPRVisiblity))},encapsulation:2}),e}()},Cma4:function(e,t,o){"use strict";o.d(t,"a",(function(){return C}));var s=o("Do2H"),i=o("Lp6j"),l=o("eQJW"),n=o("1xwR"),a=o("mvPR"),r=o("vTM8"),h=o("uMy8"),u=o("MCLT"),c=function e(t,o){_classCallCheck(this,e),this.ShowTotal=!1,this.TotalAtEnd=!1,this.TotalBorder=0,this.Row=t,this.Total=new Array(o).fill(0)},D=function(e){return e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal",e[e.Plain=2]="Plain",e}({}),d=function(e){return e[e.None=0]="None",e[e.MonthWise=1]="MonthWise",e[e.YearWise=3]="YearWise",e[e.TagWise=2]="TagWise",e}({}),C=function(e){_inherits(o,e);var t=_createSuper(o);function o(e){var s;return _classCallCheck(this,o),(s=t.call(this,e)).Show=d.None,s.k=0,s.BalIndex=0,s.LevelNo=0,s.CountMonths=0,s.ForeignCurrencyID=0,s.CurrencyType=0,s.InActiveStatusID=0,s.GroupTotalIndex=0,s.YTDIndex=0,s.YTD_LYIndex=0,s.BAL_LYIndex=0,s.TotalBudgetIndex=1,s.VariancePercentIndex=1,s.BAL_LMIndex=-1,s.ColumnSize=0,s.AccNameIndex=0,s.TagID=0,s.dbl=0,s.dblTemp=0,s.dblVariance=0,s.lstLevelGroups=new Array,s.IncludeOpeningStock=!1,s.IncludeClosingStock=!1,s.CumulativeByMn=!1,s.ShowForecast=!1,s.GroupTotalsAtEnd=!1,s.GroupTotalsSeperate=!1,s.DontShowSummaryGroupTotals=!1,s.ShowCarryForward=!1,s.ShowNetProfitBeforeAndAfter=!1,s.ClubIncomeExpenseInPlainReport=!1,s.ShowTotalBudget=!1,s.ShowBudget=!1,s.ShowBudgetVariance=!1,s.ShowBudgetVariancePercent=!1,s.ShowAllAccounts=!1,s.AddGrossToVariance=!1,s.IncludeOpeningBalance=!1,s.IsWEF=!1,s.UseWEFNewCode=!1,s.dvYTD=null,s.dvBAL_LM=null,s.dvBAL_LY=null,s.dvYTD_LY=null,s.dvYTDTable=null,s.dvBAL_LMTable=null,s.dvBAL_LYTable=null,s.dvYTD_LYTable=null,s.sbSpaces="",s.ReportFormat=D.Vertical,s.IncomeExpenseHeader=new a.a,s.GroupRowAppearance=new a.a,s.AccountID=0,s.CurrentBudgetID=0,s.PreviousBudgetID=0,s.LocationWhere="",s.dsTree=null,s.dsBudget=null,s.dtAccount=null,s.dtAccOpening=null,s.dtAccountColumns=null,s.dtAccOpeningColumns=null,s.dvPrevBudget=null,s.dvCurrentBudget=null,s.dvPrevBudgetTable=null,s.dvCurrentBudgetTable=null,s.dvPrevBudgetColumns=null,s.dvCurrentBudgetColumns=null,s.dsList=new Array,s.lstTags=new Array,s.dblClosingStock=0,s.dblOpeningStock=0,s.ShowDetailReport=!1,s.ShowDetailReport_Tree=!1,s.ShowAccountWithZeroBalance=!0,s.LastColumn=null,s.TemplateID=0,s.TemplateCCID=0,s.LevelColsCnt=0,s.dtDetails=null,s.DetailRows=new r.c,s.DetailRowsWEFAccounts=new r.c,s.eval=new h.b,s.fldDict=new r.a,s.YearMonthColIDs=new Array,s.lstBorder=new Array,s.lstCustomCols=new Array,s.HideTagWiseBudget=!1,s.HideEmptyDimensions=!1,s.IsTemplateBudget=!1,s.dtRetainedEarning=new r.a,s.dicPeriods=new r.a,s.IncomeExpenseHeader.IsBold=!0,s.IncomeExpenseHeader.FontSize=14,s.IncomeExpenseHeader.ForeColor="#FF00465A",s.IncomeExpenseHeader.BackColor="White",s.IncomeExpenseHeader.FontFamilyName="Arial",s.GroupRowAppearance.IsBold=!1,s.GroupRowAppearance.FontSize=12,s.GroupRowAppearance.ForeColor="#FF00465A",s.GroupRowAppearance.BackColor="White",s.GroupRowAppearance.FontFamilyName="Arial",s.lstBorder.push("None"),s.lstBorder.push("All Borders"),s.lstBorder.push("Bottom Border"),s.lstBorder.push("Up Border"),s.lstBorder.push("Left Border"),s.lstBorder.push("Right Border"),s.lstBorder.push("Double Border Bottom"),s.lstBorder.push("Top and Bottom Border"),s.lstBorder.push("Top and Double Bottom Border"),s.lstBorder.push("Thick Box Border"),s.lstBorder.push("Thick Bottom Border"),s.lstBorder.push("Double Top and Double Bottom Border"),s}return _createClass(o,[{key:"LoadReport",value:function(){var e=this;if(this.GrdRow=-1,this.CountMonths=0,this.Show=d.None,this.ViewModel.Preferences.ContainsKey("Template")&&s.a.SessionManager.Preferences.ContainsKey("Report Template Dimension")&&parseInt(s.a.SessionManager.Preferences["Report Template Dimension"])>5e4){if(this.TemplateCCID=parseInt(s.a.SessionManager.Preferences["Report Template Dimension"]),this.TemplateID=parseInt(this.ViewModel.Preferences.Template),this.LevelNo=10,this.ReportFormat=D.Plain,this.ViewModel.Preferences.ContainsKey("IncludeStock")&&(this.IncludeOpeningStock=this.ViewModel.Preferences.IncludeStock.Contains("<OpeningStock />"),this.IncludeClosingStock=this.ViewModel.Preferences.IncludeStock.Contains("<ClosingStock />")),this.PDCInclude=!(!this.ViewModel.Preferences.ContainsKey("IncludePDCs")||"1"!=this.ViewModel.Preferences.IncludePDCs),this.IncludeTerminatedPDC=!this.ViewModel.Preferences.ContainsKey("IncludeTerminatedPDC")||"0"!=this.ViewModel.Preferences.IncludeTerminatedPDC,this.UnPostedDocsInclude=!(!this.ViewModel.Preferences.ContainsKey("IncludeUnPostedDocs")||"1"!=this.ViewModel.Preferences.IncludeUnPostedDocs),this.UnPostedDocsList=this.UnPostedDocsInclude&&this.ViewModel.Preferences.ContainsKey("IncludeUnPostedDocsList")?this.ViewModel.Preferences.IncludeUnPostedDocsList:"",this.IncludeOpeningBalance=!(!this.ViewModel.Preferences.ContainsKey("IncludeOpeningBalance")||"1"!=this.ViewModel.Preferences.IncludeOpeningBalance),this.DateFormat=this.ViewModel.Preferences.ContainsKey("DateFormat")?this.ViewModel.Preferences.DateFormat:"",this.CumulativeByMn=!(!this.ViewModel.Preferences.ContainsKey("CumulativeMnWise")||"1"!=this.ViewModel.Preferences.CumulativeMnWise),this.ForeignCurrencyID=0,this.ViewModel.Preferences.ContainsKey("ForeignCurrency")){var t=new i.f;t.LoadXml("<XML>"+this.ViewModel.Preferences.ForeignCurrency+"</XML>");var o=i.f.SelectSingleNode(t.DocumentElement,"IsChecked");null!=o&&"1"==o.innerHTML&&(o=i.f.SelectSingleNode(t.DocumentElement,"Value"),this.ForeignCurrencyID=parseInt(o.innerHTML))}else if(this.ViewModel.Preferences.ContainsKey("Currency")){var n=new i.f;n.LoadXml("<XML>"+this.ViewModel.Preferences.Currency+"</XML>"),this.CurrencyType=parseInt(i.f.SelectSingleNode(n.DocumentElement,"Type").innerHTML),1==this.CurrencyType?(i.e.IsEmpty(s.a.SessionManager.Preferences.DimensionwiseCurrency)||0==parseInt(s.a.SessionManager.Preferences.DimensionwiseCurrency))&&(this.CurrencyType=0):2==this.CurrencyType&&(this.ForeignCurrencyID=parseInt(i.f.SelectSingleNode(n.DocumentElement,"Value").innerHTML))}if(this.GroupTotalsAtEnd=!(!this.ViewModel.Preferences.ContainsKey("GroupTotalsAtEnd")||"1"!=this.ViewModel.Preferences.GroupTotalsAtEnd),this.GroupTotalsSeperate=!(!this.ViewModel.Preferences.ContainsKey("GroupTotalsSeperate")||"1"!=this.ViewModel.Preferences.GroupTotalsSeperate),this.DontShowSummaryGroupTotals=!(!this.ViewModel.Preferences.ContainsKey("DontShowSummaryGroupTotals")||"1"!=this.ViewModel.Preferences.DontShowSummaryGroupTotals),this.ClubIncomeExpenseInPlainReport=!0,this.ShowCarryForward=!(!this.ViewModel.Preferences.ContainsKey("ShowCarryForward")||"1"!=this.ViewModel.Preferences.ShowCarryForward),this.ShowNetProfitBeforeAndAfter=!(!this.ViewModel.Preferences.ContainsKey("ShowNetProfit")||"BeforeAndAfter"!=this.ViewModel.Preferences.ShowNetProfit),this.ShowAllAccounts=!(!this.ViewModel.Preferences.ContainsKey("ShowAllAccounts")||"1"!=this.ViewModel.Preferences.ShowAllAccounts),this.ShowAccountWithZeroBalance=!(!this.ViewModel.Preferences.ContainsKey("WantAccountsWithZeroBalances")||"1"!=this.ViewModel.Preferences.WantAccountsWithZeroBalances),this.ViewModel.Preferences.ContainsKey("ShowDetailReport"))if("0"==this.ViewModel.Preferences.ShowDetailReport)this.ShowDetailReport=!1;else if("1"==this.ViewModel.Preferences.ShowDetailReport)this.ShowDetailReport=!0;else{var c=new i.f;c.LoadXml("<XML>"+this.ViewModel.Preferences.ShowDetailReport+"</XML>"),"1"==i.f.SelectSingleNodeText(c.DocumentElement,"IsChecked")&&("Tree"==i.f.SelectSingleNodeText(c.DocumentElement,"Value")?this.ShowDetailReport_Tree=!0:this.ShowDetailReport=!0)}this.AddGrossToVariance=!(!this.ViewModel.Preferences.ContainsKey("AddGrossToVariance")||"1"!=this.ViewModel.Preferences.AddGrossToVariance),this.IsWEF="TRUE"==s.a.SessionManager.Preferences.WEFINReportTemplate.toString().toUpperCase(),this.UseWEFNewCode=!(!this.ViewModel.Preferences.ContainsKey("UseWEFNewCode")||"1"!=this.ViewModel.Preferences.UseWEFNewCode),this.ShowBudget=!1,this.ShowBudgetVariance=!1,this.CurrentBudgetID=0,this.PreviousBudgetID=0,this.ViewModel.Preferences.ContainsKey("HideTagWiseBudget")&&"1"==this.ViewModel.Preferences.HideTagWiseBudget&&(this.HideTagWiseBudget=!0),this.ViewModel.Preferences.ContainsKey("CurrentBudget")&&(this.CurrentBudgetID=i.e.Int(this.ViewModel.Preferences.CurrentBudget)),this.ViewModel.Preferences.ContainsKey("PreviousBudget")&&(this.PreviousBudgetID=i.e.Int(this.ViewModel.Preferences.PreviousBudget)),this.ViewModel.Preferences.ContainsKey("ShowActualBudget")&&"1"==this.ViewModel.Preferences.ShowActualBudget&&(this.CurrentBudgetID>0||this.PreviousBudgetID>0)&&(this.ShowBudget=!0),this.ViewModel.Preferences.ContainsKey("ShowVariance")&&"1"==this.ViewModel.Preferences.ShowVariance&&(this.CurrentBudgetID>0||this.PreviousBudgetID>0)&&(this.ShowBudgetVariance=!0),this.ViewModel.Preferences.ContainsKey("ShowVariancePercent")&&"1"==this.ViewModel.Preferences.ShowVariancePercent&&(this.VariancePercentIndex=1==this.ShowBudgetVariance?2:1,(this.CurrentBudgetID>0||this.PreviousBudgetID>0)&&(this.ShowBudgetVariancePercent=!0)),this.ViewModel.Preferences.ContainsKey("ShowTotalBudget")&&"1"==this.ViewModel.Preferences.ShowTotalBudget&&(this.TotalBudgetIndex=1==this.ShowBudget?2:1,(this.CurrentBudgetID>0||this.PreviousBudgetID>0)&&(this.ShowTotalBudget=!0)),this.ShowForecast=this.ViewModel.Preferences.ContainsKey("ShowForecast")&&"1"==this.ViewModel.Preferences.ShowForecast,this.ShowForecast&&this.ShowBudget?(this.ShowBudgetVariance=!1,this.ShowBudgetVariancePercent=!1):this.ShowForecast=!1;var C="0";this.ViewModel.Preferences.ContainsKey("FinalReportsShow")&&(C=this.ViewModel.Preferences.FinalReportsShow),"1"==C?(this.Show=d.MonthWise,this.ViewModel.oReportDialog.FromDate.Date.getMonth()!=this.ViewModel.oReportDialog.ToDate.Date.getMonth()||this.ViewModel.oReportDialog.FromDate.Date.getFullYear()!=this.ViewModel.oReportDialog.ToDate.Date.getFullYear()||this.ShowForecast||(this.Show=d.None)):"3"==C?(this.Show=d.YearWise,this.ViewModel.oReportDialog.FromDate.Date.getFullYear()==this.ViewModel.oReportDialog.ToDate.Date.getFullYear()&&(this.Show=d.None)):"2"==C&&(this.Show=d.TagWise,this.TagID=parseInt(this.ViewModel.Preferences.FinalReportsShowTag),this.ViewModel.Preferences.ContainsKey("FinalReportsShowTagHideColumns")&&(this.HideEmptyDimensions=!0),this.TagColumnName="Name",this.ViewModel.Preferences.ContainsKey("FinalReportsShowTagColumn")&&("0"==this.ViewModel.Preferences.FinalReportsShowTagColumn?this.TagColumnName="Code":"2"==this.ViewModel.Preferences.FinalReportsShowTagColumn&&(this.TagColumnName="Code+'-'+Name"))),this.Show!=d.MonthWise&&(this.ShowForecast=!1),this.BalIndex=this.YTDIndex=this.YTD_LYIndex=this.BAL_LYIndex=this.BAL_LMIndex=-1;for(var p=null,T=null,_=null,m=null,I=0;I<this.ViewModel.ColumnSourceALL.length;I++)"Bud_Budget"==this.ViewModel.ColumnSourceALL[I].ID?((_=this.ViewModel.ColumnSourceALL[I].Clone()).HeaderAppearance.IsVisible=_.DataAppearance.IsVisible=!0,this.ViewModel.ColumnSourceALL[I].HeaderAppearance.IsVisible=!1):"Bud_TotalBudget"==this.ViewModel.ColumnSourceALL[I].ID?((m=this.ViewModel.ColumnSourceALL[I].Clone()).HeaderAppearance.IsVisible=m.DataAppearance.IsVisible=!0,this.ViewModel.ColumnSourceALL[I].HeaderAppearance.IsVisible=!1):"Bud_Variance"==this.ViewModel.ColumnSourceALL[I].ID?((p=this.ViewModel.ColumnSourceALL[I].Clone()).HeaderAppearance.IsVisible=p.DataAppearance.IsVisible=!0,this.ViewModel.ColumnSourceALL[I].HeaderAppearance.IsVisible=!1):"Bud_VariancePerc"==this.ViewModel.ColumnSourceALL[I].ID&&((T=this.ViewModel.ColumnSourceALL[I].Clone()).HeaderAppearance.IsVisible=T.DataAppearance.IsVisible=!0,this.ViewModel.ColumnSourceALL[I].HeaderAppearance.IsVisible=!1);for(var R=new Array,S=0;S<this.ViewModel.ColumnSource.length;S++)if(R.push(this.ViewModel.ColumnSource[S].Clone()),"Balance"==this.ViewModel.ColumnSource[S].ID){if(this.BalIndex=R.length-1,this.ShowTotalBudget){var A=null!=m?m.Clone():R[R.length-1].Clone();A.HeaderText="Total Budget",A.ID="TotalBudget",A.DataFormat.NegativeNumber=0,R.Insert(R.length-1,A),this.ViewModel.GrpReportTotal.TotalCols.ContainsKey(A.ID)||this.ViewModel.GrpReportTotal.TotalCols.push(A.ID,this.BalIndex-1),this.BalIndex=this.BalIndex+1}if(this.ShowBudget){var M=null!=_?_.Clone():R[R.length-1].Clone();M.HeaderText="Budget",M.ID="BudgetBalance",M.DataFormat.NegativeNumber=0,R.Insert(R.length-1,M),this.ViewModel.GrpReportTotal.TotalCols.ContainsKey(M.ID)||this.ViewModel.GrpReportTotal.TotalCols.push(M.ID,this.BalIndex-1)}if(this.BalIndex=R.length-1,this.ShowBudgetVariance){var g=null!=p?p.Clone():R[this.BalIndex].Clone();g.HeaderText="Variance",g.ID="VarianceBalance",g.DataFormat.NegativeNumber=0,R.push(g)}if(this.ShowBudgetVariancePercent){var w=null!=T?T.Clone():R[this.BalIndex].Clone();w.DataFormat.PercentageOn="BudgetBalance",w.HeaderText="Variance %",w.ID="PercentVarianceBalance",w.DataFormat.NegativeNumber=0,R.push(w)}}else if("YTD"==this.ViewModel.ColumnSource[S].ID){if(this.ShowBudget){var f=null!=_?_.Clone():R[R.length-1].Clone();f.HeaderText="Budget",f.ID="BudgetYTD",f.DataFormat.NegativeNumber=0,R.Insert(R.length-1,f)}if(this.YTDIndex=R.length-1,this.ShowBudgetVariance){var E=null!=p?p.Clone():R[this.YTDIndex].Clone();E.HeaderText="Variance",E.ID="VarianceYTD",E.DataFormat.NegativeNumber=0,R.push(E)}if(this.ShowBudgetVariancePercent){var P=null!=T?T.Clone():R[this.YTDIndex].Clone();P.DataFormat.PercentageOn="BudgetYTD",P.HeaderText="Variance %",P.ID="PercentVarianceYTD",P.DataFormat.NegativeNumber=0,R.push(P)}}else if("LastMonthBalance"==this.ViewModel.ColumnSource[S].ID)this.BAL_LMIndex=R.length-1;else if("LastYearBalance"==this.ViewModel.ColumnSource[S].ID){if(this.ShowBudget){var y=null!=_?_.Clone():R[R.length-1].Clone();y.HeaderText="Budget",y.ID="BudgetLastYearBalance",y.DataFormat.NegativeNumber=0,R.Insert(R.length-1,y)}if(this.BAL_LYIndex=R.length-1,this.ShowBudgetVariance){var O=null!=p?p.Clone():R[this.BAL_LYIndex].Clone();O.HeaderText="Variance",O.ID="VarianceLastYearBalance",O.DataFormat.NegativeNumber=0,R.push(O)}if(this.ShowBudgetVariancePercent){var b=null!=T?T.Clone():R[this.BAL_LYIndex].Clone();b.DataFormat.PercentageOn="BudgetLastYearBalance",b.HeaderText="Variance %",b.ID="PercentVarianceLastYearBalance",b.DataFormat.NegativeNumber=0,R.push(b)}}else if("LastYearYTD"==this.ViewModel.ColumnSource[S].ID){if(this.ShowBudget){var N=null!=_?_.Clone():R[R.length-1].Clone();N.HeaderText="Budget",N.ID="BudgetLastYearYTD",N.DataFormat.NegativeNumber=0,R.Insert(R.length-1,N)}if(this.YTD_LYIndex=R.length-1,this.ShowBudgetVariance){var V=null!=p?p.Clone():R[this.YTD_LYIndex].Clone();V.HeaderText="Variance",V.ID="VarianceLastYearYTD",V.DataFormat.NegativeNumber=0,R.push(V)}if(this.ShowBudgetVariancePercent){var v=null!=T?T.Clone():R[this.YTD_LYIndex].Clone();v.DataFormat.PercentageOn="BudgetLastYearYTD",v.HeaderText="Variance %",v.ID="PercentVarianceLastYearYTD",v.DataFormat.NegativeNumber=0,R.push(v)}}if(this.AccNameIndex=this.BalIndex>0?this.BalIndex-1:0,this.ShowBudget&&this.AccNameIndex--,this.ReportFormat==D.Plain&&(this.ClubIncomeExpenseInPlainReport?this.GroupTotalIndex=this.ViewModel.ColumnSource.length:(this.GroupTotalIndex=this.ViewModel.ColumnSource.length+1,R.push(this.ViewModel.ColumnSource[this.BalIndex].Clone()))),this.GroupTotalsSeperate){var L=this.ViewModel.ColumnSource[this.BalIndex].Clone();L.HeaderText="TOTAL",R.Insert(this.BalIndex+1,L),-1!=this.YTDIndex&&this.YTDIndex++,-1!=this.BAL_LMIndex&&this.BAL_LMIndex++,-1!=this.BAL_LYIndex&&this.BAL_LYIndex++,-1!=this.YTD_LYIndex&&this.YTD_LYIndex++}this.ColumnSize=R.length;var B=new r.a;if(this.ForeCastStart=this.ViewModel.oReportDialog.FromDate.Date,this.ForeCastEnd=this.ViewModel.oReportDialog.ToDate.Date,this.ShowForecast&&(this.ForeCastStart=new Date(this.ViewModel.oReportDialog.FromDate.Date.getFullYear(),this.ViewModel.oReportDialog.FromDate.Date.getMonth(),1),this.ForeCastEnd=new Date(this.ViewModel.oReportDialog.ToDate.Date.getFullYear(),this.ViewModel.oReportDialog.ToDate.Date.getMonth(),1),this.ForeCastEnd=this.ForeCastEnd.AddMonths(1).AddDays(-1),this.ForeCastEnd<this.ForeCastStart.AddYears(1).AddDays(-1)&&(this.ForeCastEnd=this.ForeCastStart.AddYears(1).AddDays(-1)),this.ForeCastStart=new Date(this.ViewModel.oReportDialog.ToDate.Date.getFullYear(),this.ViewModel.oReportDialog.ToDate.Date.getMonth(),1),this.ForeCastStart=this.ForeCastStart.AddMonths(1)),this.Show==d.MonthWise){var F=new Date(this.ViewModel.oReportDialog.FromDate.Date.getFullYear(),this.ViewModel.oReportDialog.FromDate.Date.getMonth(),1),G=R[R.length-1];for(-1!=this.BalIndex&&(G=R[this.BalIndex]);F<=this.ForeCastEnd;){var x=G.Clone();if(this.Show==d.MonthWise?(x.HeaderText=F.ToString("MMM yy"),x.ID="Y"+F.getFullYear()+"M"+F.iMonth(),this.YearMonthColIDs.push(x.ID)):(x.HeaderText=F.ToString("yyyy"),x.ID="Y"+F.getFullYear()),this.ShowForecast&&F>this.ViewModel.oReportDialog.ToDate.Date&&(x.HeaderAppearance.IsVisible=!1),R.push(x),++this.CountMonths,this.ShowBudget&&!this.HideTagWiseBudget){var W=null!=_?_.Clone():G.Clone();W.HeaderText="Budget-"+x.HeaderText,W.ID="Budget"+x.ID,this.ShowForecast&&F<=this.ViewModel.oReportDialog.ToDate.Date&&(W.HeaderAppearance.IsVisible=!1),R.Insert(R.length-1,W),++this.CountMonths}if(this.ShowBudgetVariance&&!this.HideTagWiseBudget){var k=null!=p?p.Clone():G.Clone();k.HeaderText="Variance-"+x.HeaderText,k.ID="Variance"+x.ID,R.push(k),++this.CountMonths}if(this.ShowBudgetVariancePercent&&!this.HideTagWiseBudget){var U=null!=T?T.Clone():G.Clone();U.DataFormat.PercentageOn=x.ID,U.HeaderText="Variance %-"+x.HeaderText,U.ID="PercentVariance"+x.ID,R.push(U),++this.CountMonths}F=this.Show==d.MonthWise?F.AddMonths(1):F.AddYears(1),B.push(x.ID,F)}}else if(this.Show==d.YearWise){this.HideTagWiseBudget=!0;var K,H,Q=R[R.length-1];-1!=this.BalIndex&&(Q=R[this.BalIndex]),s.a.report.DataSet("RPT022","declare @From float,@To float\nset @From=convert(float,convert(datetime,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))\nset @To=convert(float,convert(datetime,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))\nselect CONVERT(DATETIME,FromDate) FromDate,CONVERT(DATETIME,ToDate) ToDate from ADM_FinancialYears with(nolock)\nwhere (FromDate>=@From and ToDate<=@To) or (@From>=FromDate and @From<=ToDate) or (@To>=FromDate and @To<=ToDate)\norder by FromDate").Tables[0].forEach((function(t){K=new Date(t.FromDate),H=new Date(t.ToDate);var o=Q.Clone();if(K.getFullYear()==H.getFullYear()?(o.ID="Y"+K.getFullYear()+"M"+K.iMonth(),o.HeaderText=K.getFullYear().toString()):(o.ID="Y"+K.getFullYear()+"M"+K.iMonth(),o.HeaderText=i.e.IsEmptySpace(e.DateFormat)?K.getFullYear()+"-"+H.getFullYear().toString().substr(2):K.ToString(e.DateFormat)+"-"+H.ToString(e.DateFormat)),e.YearMonthColIDs.push(o.ID),B.push(o.ID,H),R.push(o),++e.CountMonths,e.ShowBudget&&!e.HideTagWiseBudget){var s=null!=_?_.Clone():o.Clone();s.HeaderText="Budget-"+o.HeaderText,s.ID="Budget"+o.ID,R.Insert(R.length-1,s),++e.CountMonths}if(e.ShowBudgetVariance&&!e.HideTagWiseBudget){var l=null!=p?p.Clone():o.Clone();l.HeaderText="Variance-"+o.HeaderText,l.ID="Variance"+o.ID,R.push(l),++e.CountMonths}if(e.ShowBudgetVariancePercent&&!e.HideTagWiseBudget){var n=null!=T?T.Clone():o.Clone();n.DataFormat.PercentageOn=o.ID,n.HeaderText="Variance %-"+o.HeaderText,n.ID="PercentVariance"+o.ID,R.push(n),++e.CountMonths}e.lstTags.push(o.ID)}))}else if(this.Show==d.TagWise){var j=R[R.length-1];-1!=this.BalIndex&&(j=R[this.BalIndex]);var Y=this.GetTagWiseQuery(this.TagID,this.TagColumnName,"Name");s.a.report.DataSet("RPT022",Y).Tables[0].forEach((function(t){var o=j.Clone();if(o.HeaderText=t.Name.toString(),o.ID=t.NodeID.toString(),R.push(o),++e.CountMonths,e.ShowBudget&&!e.HideTagWiseBudget){var s=null!=_?_.Clone():o.Clone();s.HeaderText="Budget-"+o.HeaderText,s.ID="Budget"+o.ID,R.Insert(R.length-1,s),++e.CountMonths}if(e.ShowBudgetVariance&&!e.HideTagWiseBudget){var i=null!=p?p.Clone():o.Clone();i.HeaderText="Variance-"+o.HeaderText,i.ID="Variance"+o.ID,R.push(i),++e.CountMonths}if(e.ShowBudgetVariancePercent&&!e.HideTagWiseBudget){var l=null!=T?T.Clone():o.Clone();l.DataFormat.PercentageOn=o.ID,l.HeaderText="Variance %-"+o.HeaderText,l.ID="PercentVariance"+o.ID,R.push(l),++e.CountMonths}e.lstTags.push(o.ID)}))}if(this.ViewModel.Preferences.ContainsKey("PLRepeatColsTotal")&&this.Show!=d.None&&-1!=this.BalIndex){var X=this.BalIndex,q=this.BalIndex;this.ShowTotalBudget&&X--,this.ShowBudget&&X--,this.ShowBudgetVariance&&q++,this.ShowBudgetVariancePercent&&q++;for(var z=0;z<=q-X;z++){var J=R[X];R.RemoveAt(X),R.push(J)}this.ColumnSize-=q-X+1}this.oColumns=R,this.LocationWhere="",this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(this.LocationWhere=i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),this.dsList.Clear();var Z="";this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(Z=i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?"-1":this.ViewModel.oReportDialog.LocationWhere),this.arrPromise=new r.a,this.IncludeOpeningStock&&this.arrPromise.push("dblOpeningStock",s.a.report.GetStockBalance(1,Z,this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,this.UnPostedDocsInclude,this.CurrencyType,this.ForeignCurrencyID,this.ViewModel.IsReportDB)),this.IncludeClosingStock&&this.arrPromise.push("dblClosingStock",s.a.report.GetStockBalance(0,Z,this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,this.UnPostedDocsInclude,this.CurrencyType,this.ForeignCurrencyID,this.ViewModel.IsReportDB)),this.SetDataSet().then((function(t){i.e.IsEmptySpace(e.DateFormat)||e.Show!=d.None||(-1!=e.BalIndex&&(e.IncludeOpeningBalance?R[e.BalIndex].HeaderText+=" "+e.ViewModel.oReportDialog.ToDate.Date.ToString(e.DateFormat):(R[e.BalIndex].HeaderText+=" "+e.ViewModel.oReportDialog.FromDate.Date.ToString(e.DateFormat),e.ViewModel.oReportDialog.FromDate.Date.getFullYear()==e.ViewModel.oReportDialog.ToDate.Date.getFullYear()&&e.ViewModel.oReportDialog.FromDate.Date.getMonth()==e.ViewModel.oReportDialog.ToDate.Date.getMonth()||(R[e.BalIndex].HeaderText+="-"+e.ViewModel.oReportDialog.ToDate.Date.ToString(e.DateFormat)))),-1!=e.YTDIndex&&(R[e.YTDIndex].HeaderText+=e.IncludeOpeningBalance?" "+e.ViewModel.oReportDialog.ToDate.Date.ToString(e.DateFormat):" "+e.dtYearStart.ToString(e.DateFormat)+"-"+e.ViewModel.oReportDialog.ToDate.Date.ToString(e.DateFormat)),-1!=e.BAL_LMIndex&&(R[e.BAL_LMIndex].HeaderText+=" "+e.ViewModel.oReportDialog.FromDate.Date.AddMonths(-1).ToString(e.DateFormat)),-1!=e.BAL_LYIndex&&(e.IncludeOpeningBalance?R[e.BAL_LYIndex].HeaderText+=" "+e.ViewModel.oReportDialog.ToDate.Date.AddYears(-1).ToString(e.DateFormat):(R[e.BAL_LYIndex].HeaderText+=" "+e.ViewModel.oReportDialog.FromDate.Date.AddYears(-1).ToString(e.DateFormat),e.ViewModel.oReportDialog.FromDate.Date.getFullYear()==e.ViewModel.oReportDialog.ToDate.Date.getFullYear()&&e.ViewModel.oReportDialog.FromDate.Date.getMonth()==e.ViewModel.oReportDialog.ToDate.Date.getMonth()||(R[e.BAL_LYIndex].HeaderText+="-"+e.ViewModel.oReportDialog.ToDate.Date.AddYears(-1).ToString(e.DateFormat)))),-1!=e.YTD_LYIndex&&(R[e.YTD_LYIndex].HeaderText+=e.IncludeOpeningBalance?" "+e.ViewModel.oReportDialog.ToDate.Date.AddYears(-1).ToString(e.DateFormat):" "+e.dtYearStart.AddYears(-1).ToString(e.DateFormat)+"-"+e.ViewModel.oReportDialog.ToDate.Date.AddYears(-1).ToString(e.DateFormat))),e.ViewModel.ReportColumns=R,e.ShowDetailReport_Tree&&e.dsTree.Tables[0].forEach((function(e){Object(l.j)(e.IsGroup)||(e.ShowDetail=!0)})),e.dsTree.Columns[0].push("Balance"),e.dsTree.Columns[1].push("IsRead");var o=0;for(o=0;o<e.dtAccountColumns.length&&e.dtAccountColumns[o]!=e.LastColumn;o++);for(;o<e.dtAccountColumns.length;o++)e.dsTree.Columns[0].push(e.dtAccountColumns[o]);var s=!1;if(e.oColumns.forEach((function(t){33!=t.ID.length||i.e.IsEmpty(t.Formula)||(s=!0,t.Formula=t.Formula.Replace("Bud_",""),e.dsTree.Columns[0].Contains(t.ID)||(e.dsTree.Columns[0].push(t.ID),e.dsTree.Columns[2].push(t.ID)))})),s){e.ViewModel.ConstructFormulaFields(!1);var n=[];e.ViewModel.fldDict.keys.filter((function(e){return e.startsWith("Bud_")})).forEach((function(t){n.push({Key:t,Value:e.ViewModel.fldDict[t]})}));for(var r=0;r<n.length;r++)e.ViewModel.fldDict.push(n[r].Key.Replace("Bud_",""),n[r].Value),e.ViewModel.fldDict.Remove(n[r].Key);e.ViewModel.fldDict.ContainsKey("BudgetBalance")||e.ViewModel.fldDict.push("BudgetBalance",new h.c("BudgetBalance",0))}var c,D,C,p,T,_,m,I,S=!1,A=!1,M=0,g=0,w=0,f=0;if(e.dtDetails=[],e.eval.ThrowException=!1,e.eval.SetKeyWords("REPORT"),e.IsWEF){var E=new Array(e.oColumns.length).fill(0),P=0;e.dsTree.Columns[1].push("TOWEF"),e.dsTree.Columns[2].push("WEFDate"),e.dsTree.Columns[2].push("WEFBalance"),e.dsTree.Tables[2].forEach((function(t){e.strTemp=t.WEFMn.toString(),t.WEFBalance=t.Balance,e.strTemp.length>0&&(t.WEFDate=new Date(parseInt(e.strTemp.substr(1,4)),parseInt(e.strTemp.substr(6)),1))})),e.dicPeriods.push("Balance",[e.ViewModel.oReportDialog.FromDate.Date,e.ViewModel.oReportDialog.ToDate.Date]),e.dicPeriods.push("YTD",[e.dtYearStart,e.ViewModel.oReportDialog.ToDate.Date]),e.dicPeriods.push("LastYearBalance",[e.ViewModel.oReportDialog.FromDate.Date.AddYears(-1),e.ViewModel.oReportDialog.ToDate.Date.AddYears(-1)]),e.dicPeriods.LastYearBalance[1].Subtract(e.dicPeriods.LastYearBalance[0]).TotalDays>366&&(e.dicPeriods.LastYearBalance[1]=e.ViewModel.oReportDialog.FromDate.Date.AddDays(-1)),e.dicPeriods.push("LastYearYTD",[e.dtYearStart.AddYears(-1),e.ViewModel.oReportDialog.ToDate.Date.AddYears(-1)]);var y=new Date(e.ViewModel.oReportDialog.FromDate.Date.getFullYear(),e.ViewModel.oReportDialog.FromDate.Date.getMonth(),1);if(y=y.AddMonths(-1),e.dicPeriods.push("LastMonthBalance",[y,y.AddMonths(1).AddDays(-1)]),e.UseWEFNewCode){for(var O=0;O<e.dsTree.Tables[1].length;O++)e.AccountID=parseInt(e.dsTree.Tables[1][O].AccountID),e.AccountID!=P?P=e.AccountID:null!=e.dsTree.Tables[1][O].WEF&&e.dsTree.Tables[1][O-1].RTGroup.toString()==e.dsTree.Tables[1][O].RTGroup.toString()&&(e.dsTree.Tables[1][O-1].TOWEF=new Date(e.dsTree.Tables[1][O].WEF).AddDays(-1));e.Show==d.MonthWise?B.keys.forEach((function(t){e.dicPeriods.push(t,[B[t].AddMonths(-1),B[t].AddDays(-1)])})):e.Show==d.YearWise&&B.keys.forEach((function(t){e.dicPeriods.push(t,[B[t].AddYears(-1).AddDays(1),B[t]])}));for(var b=function(t){var o=e.dsTree.Tables[0][t];c=Object(l.j)(o.IsGroup),parseInt(o.Depth),C=o.Name.toString().Replace(" ",""),S="Show Opening"==o.Opening.toString(),D=!e.ShowDetailReport&&"True"==o.ShowDetail.toString();var s=S||e.IncludeOpeningBalance;if(e.fldObj=new h.c,e.fldObj.setFieldDetails(C,3,1,"",0,!1,!1),e.fldDict.ContainsKey(C))return{v:(e.ViewModel.DisplayMessage="Dulpicate Template Node : "+o.Name.toString(),void e.ViewModel.process_RunWorkerCompleted())};if(e.fldDict.push(C,e.fldObj),!c){M=parseInt(o.NodeID);for(var i=e.dsTree.Tables[1].filter((function(e){return Object(u.isNullOrUndefined)(e.IsRead)&&(e.DrNodeID==o.NodeID||e.CrNodeID==o.NodeID)})),n=function(t){var n=i[t];n.IsRead=1,_=Object(l.j)(n.IsGroup)?e.dtAccount.filter((function(e){return e.IsGroup=0})):e.dtAccount.filter((function(e){return e.AccountID==n.AccountID})),g=parseInt(n.DrNodeID);var a=[],r=[];0!=(w=parseInt(n.CrNodeID))&&w!=M?a=e.dsTree.Tables[0].filter((function(e){return e.NodeID==w})):0!=g&&g!=M&&(r=e.dsTree.Tables[0].filter((function(e){return e.NodeID==g})));var h=null,u=null;null!=n.WEF&&(h=new Date(n.WEF)),null!=n.TOWEF&&(u=new Date(n.TOWEF)),P=0;for(var c=0;c<_.length;c++){for(var C=0;C<e.oColumns.length;C++)E[C]=0;var m=_[c];P=parseInt(_[c].AccountID);for(var I=0;c<_.length;c++,I++){var R=_[c];if(e.AccountID=parseInt(R.AccountID),e.AccountID!=P)break;if(null!=R.WEFDate){var S=new Date(R.WEFDate);for(e.k=0;e.k<e.oColumns.length;e.k++){var A=e.oColumns[e.k];if(p=A.ID,"FLOAT"==A.ColumnType&&null!=R.WEFBalance&&0!=parseFloat(R.WEFBalance))if(s){if(e.Show==d.TagWise&&"Balance"!=p&&"LastYearBalance"!=p&&"LastYearYTD"!=p&&"YTD"!=p&&"LastMonthBalance"!=p){if(R.Mn.toString()!=p)continue;p="Balance"}S<e.dicPeriods[p][0]?(!u||u>=e.dicPeriods[p][0]&&e.dicPeriods[p][0]<=e.dicPeriods[p][1])&&(!h||h<=e.dicPeriods[p][0])&&(E[e.k]+=parseFloat(R.WEFBalance)):S<=e.dicPeriods[p][1]&&(h?u?(S>=h||h<=e.dicPeriods[p][0])&&S<=u&&(E[e.k]+=parseFloat(R.WEFBalance)):(S>=h||h<=e.dicPeriods[p][0])&&(E[e.k]+=parseFloat(R.WEFBalance)):u?u>=e.dicPeriods[p][0]&&u<=e.dicPeriods[p][1]&&S<=u&&(E[e.k]+=parseFloat(R.WEFBalance)):E[e.k]+=parseFloat(R.WEFBalance))}else{if(e.Show==d.TagWise&&"Balance"!=p&&"LastYearBalance"!=p&&"LastYearYTD"!=p&&"YTD"!=p&&"LastMonthBalance"!=p){if(R.Mn.toString()!=p)continue;p="Balance"}if(S<e.dicPeriods[p][0])continue;S<=e.dicPeriods[p][1]&&(h?u?(S>=h||h<=e.dicPeriods[p][0])&&S<=u&&(E[e.k]+=parseFloat(R.WEFBalance)):(S>=h||h<=e.dicPeriods[p][0])&&(E[e.k]+=parseFloat(R.WEFBalance)):u?u>=e.dicPeriods[p][0]&&u<=e.dicPeriods[p][1]&&S<=u&&(E[e.k]+=parseFloat(R.WEFBalance)):E[e.k]+=parseFloat(R.WEFBalance))}}}}var y=null,O=!1,b=!1;for(e.k=0;e.k<e.oColumns.length;e.k++)if("FLOAT"==e.oColumns[e.k].ColumnType&&(p=e.oColumns[e.k].ID,(e.ShowAccountWithZeroBalance||0!=parseFloat(E[e.k].ToString("N"+e.oColumns[e.k].DataFormat.DecimalsPoints)))&&(T=null,f=M,b=D,E[e.k]<0&&0!=w&&w!=M?a.length>0&&(T=a[0],f=w,b=!e.ShowDetailReport&&"True"==a[0].ShowDetail.toString()):E[e.k]>0&&0!=g&&g!=M&&r.length>0&&(T=r[0],f=g,b=!e.ShowDetailReport&&"True"==r[0].ShowDetail.toString()),null==T&&(T=o),T[p]=null==T[p]?E[e.k]:parseFloat(T[p])+E[e.k],e.ShowDetailReport||b)))if(e.DetailRows.ContainsKey(f)||(e.DetailRows.push(f,new Array),e.DetailRowsWEFAccounts.push(f,new Array)),e.DetailRowsWEFAccounts[f].Contains(P)){var N=e.DetailRowsWEFAccounts[f].indexOf(P);(y=e.DetailRows[f][N])[p]=O||0==E[e.k]||null==y[p]?E[e.k]:parseFloat(y[p])+E[e.k]}else{y={};for(var V=0;V<e.dtAccountColumns.length;V++)y[e.dtAccountColumns[V]]=m[e.dtAccountColumns[V]];for(var v=0;v<e.oColumns.length;v++)"FLOAT"==e.oColumns[v].ColumnType&&(y[e.oColumns[v].ID]=null);y[p]=E[e.k],O=!0,e.DetailRows[f].push(y),e.DetailRowsWEFAccounts[f].push(P)}}},a=0;a<i.length;a++)n(a)}},N=0;N<e.dsTree.Tables[0].length;N++){var V=b(N);if("object"==typeof V)return V.v}}else{for(var v=0;v<e.dsTree.Tables[1].length;v++)e.AccountID=parseInt(e.dsTree.Tables[1][v].AccountID),e.AccountID!=P?P=e.AccountID:null!=e.dsTree.Tables[1][v].WEF&&(e.dsTree.Tables[1][v-1].TOWEF=new Date(e.dsTree.Tables[1][v].WEF).AddDays(-1));e.Show==d.MonthWise?B.keys.forEach((function(t){e.dicPeriods.push(t,[B[t].AddMonths(-1),B[t].AddDays(-1)])})):e.Show==d.YearWise&&B.keys.forEach((function(t){e.dicPeriods.push(t,[B[t].AddYears(-1),B[t]])}));for(var L=function(t){var o=e.dsTree.Tables[0][t];if(c=Object(l.j)(o.IsGroup),parseInt(o.Depth),C=o.Name.toString().Replace(" ",""),S="Show Opening"==o.Opening.toString(),D=!e.ShowDetailReport&&"True"==o.ShowDetail.toString(),S||e.IncludeOpeningBalance?(e.dicPeriods.Balance[0]=new Date(1900,0,1),e.dicPeriods.YTD[0]=e.dicPeriods.Balance[0],e.dicPeriods.LastYearBalance[0]=e.dicPeriods.Balance[0],e.dicPeriods.LastYearYTD[0]=e.dicPeriods.Balance[0],e.dicPeriods.LastMonthBalance[0]=e.dicPeriods.Balance[0],B.keys.forEach((function(t){e.dicPeriods[t][0]=new Date(1900,0,1)}))):(e.dicPeriods.Balance[0]=e.ViewModel.oReportDialog.FromDate.Date,e.dicPeriods.YTD[0]=e.dtYearStart,e.dicPeriods.LastYearBalance[0]=e.ViewModel.oReportDialog.FromDate.Date.AddYears(-1),e.dicPeriods.LastYearYTD[0]=e.dtYearStart.AddYears(-1),e.dicPeriods.LastMonthBalance[0]=y),e.fldObj=new h.c,e.fldObj.setFieldDetails(C,3,1,"",0,!1,!1),e.fldDict.ContainsKey(C))return{v:void(e.ViewModel.DisplayMessage="Dulpicate Template Node : "+o.Name.toString())};if(e.fldDict.push(C,e.fldObj),!c){M=parseInt(o.NodeID);for(var s=e.dsTree.Tables[1].filter((function(e){return Object(u.isNullOrUndefined)(e.IsRead)&&(e.DrNodeID==o.NodeID||e.CrNodeID==o.NodeID)})),n=function(t){var n=s[t];n.IsRead=1,_=Object(l.j)(n.IsGroup)?e.dtAccount.filter((function(e){return e.IsGroup=0})):e.dtAccount.filter((function(e){return e.AccountID==n.AccountID})),g=parseInt(n.DrNodeID);var a=[],r=[];0!=(w=parseInt(n.CrNodeID))&&w!=M?a=e.dsTree.Tables[0].filter((function(e){return e.NodeID==w})):0!=g&&g!=M&&(r=e.dsTree.Tables[0].filter((function(e){return e.NodeID==g})));var h=null,u=null;null!=n.WEF&&(h=new Date(n.WEF)),null!=n.TOWEF&&(u=new Date(n.TOWEF)),P=0;for(var c=0;c<_.length;c++){for(var C=0;C<e.oColumns.length;C++)E[C]=0;var m=_[c];P=parseInt(_[c].AccountID);for(var I=0;c<_.length;c++,I++){var R=_[c];if(e.AccountID=parseInt(R.AccountID),e.AccountID!=P)break;if(R.WEFDate){var A=new Date(R.WEFDate);for(e.k=0;e.k<e.oColumns.length;e.k++){var y=e.oColumns[e.k];if(p=y.ID,"FLOAT"==y.ColumnType&&R.WEFBalance&&0!=parseFloat(R.WEFBalance))if("LastYearBalance"==p||"LastYearYTD"==p||"YTD"==p||"LastMonthBalance"==p)A<e.dicPeriods[p][0]?(S||e.IncludeOpeningBalance)&&(E[e.k]+=parseFloat(R.WEFBalance)):A<=e.dicPeriods[p][1]&&(h?A>=h&&(!u||A<=u)&&(E[e.k]+=parseFloat(R.WEFBalance)):(!u||A<=u)&&(E[e.k]+=parseFloat(R.WEFBalance)));else{if("Balance"!=p&&e.Show!=d.None)if(R.Mn.toString()!=p){if(!S&&!e.IncludeOpeningBalance||e.Show==d.TagWise)continue}else(S||e.IncludeOpeningBalance)&&e.Show!=d.TagWise||(p="Balance");A<e.dicPeriods[p][0]?(S||e.IncludeOpeningBalance)&&(E[e.k]+=parseFloat(R.WEFBalance)):A<=e.dicPeriods[p][1]&&(h?A>=h&&(!u||A<=u)&&(E[e.k]+=parseFloat(R.WEFBalance)):(!u||A<=u)&&(E[e.k]+=parseFloat(R.WEFBalance)))}}}}var O=null,b=!1,N=!1;for(e.k=0;e.k<e.oColumns.length;e.k++)if("FLOAT"==e.oColumns[e.k].ColumnType&&(p=e.oColumns[e.k].ID,(e.ShowAccountWithZeroBalance||0!=parseFloat(E[e.k].ToString("N"+e.oColumns[e.k].DataFormat.DecimalsPoints)))&&(T=null,f=M,N=D,E[e.k]<0&&0!=w&&w!=M?a.length>0&&(T=a[0],f=w,N=!e.ShowDetailReport&&"True"==a[0].ShowDetail.toString()):E[e.k]>0&&0!=g&&g!=M&&r.length>0&&(T=r[0],f=g,N=!e.ShowDetailReport&&"True"==r[0].ShowDetail.toString()),null==T&&(T=o),T[p]=i.e.Double(T[p])+E[e.k],e.ShowDetailReport||N)))if(e.DetailRows.ContainsKey(f)||(e.DetailRows.push(f,new Array),e.DetailRowsWEFAccounts.push(f,new Array)),e.DetailRowsWEFAccounts[f].Contains(P)){var V=e.DetailRowsWEFAccounts[f].indexOf(P);(O=e.DetailRows[f][V])[p]=b||0==E[e.k]||null==O[p]?E[e.k]:parseFloat(O[p])+E[e.k]}else{O={};for(var v=0;v<e.dtAccountColumns.length;v++)O[e.dtAccountColumns[v]]=m[e.dtAccountColumns[v]];for(var L=0;L<e.oColumns.length;L++)"FLOAT"==e.oColumns[L].ColumnType&&(O[e.oColumns[L].ID]=null);O[p]=E[e.k],b=!0,e.DetailRows[f].push(O),e.DetailRowsWEFAccounts[f].push(P)}}},a=0;a<s.length;a++)n(a)}},F=0;F<e.dsTree.Tables[0].length;F++){var G=L(F);if("object"==typeof G)return G.v}}}else{for(var x=function(t){var o=e.dsTree.Tables[0][t];if(c=Object(l.j)(o.IsGroup),parseInt(o.Depth),C=o.Name.toString().Replace(" ",""),e.IncludeOpeningBalance||(S="Show Opening"==o.Opening.toString(),A="Show Closing"==o.Opening.toString()),D=!e.ShowDetailReport&&"True"==o.ShowDetail.toString(),e.fldObj=new h.c,e.fldObj.setFieldDetails(C,3,1,"",0,!1,!1),e.fldDict.ContainsKey(C))return{v:void(e.ViewModel.DisplayMessage="Dulpicate Template Node : "+o.Name.toString())};if(e.fldDict.push(C,e.fldObj),!c){M=parseInt(o.NodeID);for(var s=e.dsTree.Tables[1].filter((function(e){return Object(u.isNullOrUndefined)(e.IsRead)&&(e.DrNodeID==o.NodeID||e.CrNodeID==o.NodeID)})),n=function(t){var n=s[t];n.IsRead=1,e.IncludeOpeningBalance||!S?function(){var t;m=Object(l.j)(n.IsGroup)?e.dtAccount.filter((function(e){return e.IsGroup=0})):e.dtAccount.filter((function(e){return e.AccountID==n.AccountID})),_=new Array(m.length);for(var o=0;o<m.length;o++){t={};for(var s=0;s<t.ItemArray.length;s++)t[s]=m[o][s];_[o]=t}if(A){I=Object(l.j)(n.IsGroup)?e.dtAccOpening.filter((function(e){return e.IsGroup=0})):e.dtAccOpening.filter((function(e){return e.AccountID==n.AccountID})),m=_,_=new Array(m.length+I.length);for(var i=0;i<m.length;i++)_[i]=m[i];for(var a=function(o){(t=_.find((function(e){return null!=e&&e.AccountID.toString()==I[o].AccountID.toString()})))?(t.Balance=parseFloat(t.Balance)+parseFloat(I[o].Balance),e.Show==d.TagWise&&e.lstTags.forEach((function(e){null!=I[o][e]&&(t[e]=null!=t[e]?parseFloat(t[e])+parseFloat(I[o][e]):parseFloat(I[o][e]))}))):(t={},e.dtAccOpeningColumns.forEach((function(e){t[e]=I[o][e]})),_[m.length+o]=t)},r=0;r<I.length;r++)a(r)}if(e.YearMonthColIDs.length>0&&(e.CumulativeByMn||A))for(var h=0;h<_.length;h++){var u=_[h];if(null!=u){e.dblTemp=0,(e.IncludeOpeningBalance||A)&&null!=u.OpBalance&&(e.dblTemp=parseFloat(u.OpBalance));for(var c=0;c<e.YearMonthColIDs.length;c++)null!=u[e.YearMonthColIDs[c]]?(e.dblTemp+=parseFloat(u[e.YearMonthColIDs[c]]),u[e.YearMonthColIDs[c]]=e.dblTemp):u[e.YearMonthColIDs[c]]=e.dblTemp}}}():e.YearMonthColIDs.length>0?function(){var t,o;t=Object(l.j)(n.IsGroup)?e.dtAccount.filter((function(e){return e.IsGroup=0})):e.dtAccount.filter((function(e){return e.AccountID==n.AccountID}));for(var s=function(o){var s=e.dtAccOpening.filter((function(e){return e.AccountID==t[o].AccountID}));if(0==s.length){var i={};i.Code=t[o].Code,i.Name=t[o].Name,i.Balance=0,i.AccountID=t[o].AccountID,i.IsGroup=t[o].IsGroup,i.lft=t[o].lft,i.rgt=t[o].rgt;for(var l=1;l<e.YearMonthColIDs.length;l++)i[e.YearMonthColIDs[l]]=t[o][e.YearMonthColIDs[l-1]];e.dtAccOpening.push(i)}else for(var n=1;n<e.YearMonthColIDs.length;n++)s[0][e.YearMonthColIDs[n]]=t[o][e.YearMonthColIDs[n-1]]},i=0;i<t.length;i++)s(i);I=Object(l.j)(n.IsGroup)?e.dtAccOpening.filter((function(e){return e.IsGroup=0})):e.dtAccOpening.filter((function(e){return e.AccountID==n.AccountID})),_=new Array(I.length);for(var a=function(t){o={},e.dtAccOpeningColumns.forEach((function(e){o[e]=I[t][e]})),_[t]=o},r=0;r<I.length;r++)a(r);_.forEach((function(t){e.dblTemp=0;for(var o=0;o<e.YearMonthColIDs.length;o++)0==o?(t[e.YearMonthColIDs[0]]=t.Balance,e.dblTemp=null!=t.Balance?parseFloat(t.Balance):0):null!=t[e.YearMonthColIDs[o]]?(e.dblTemp+=parseFloat(t[e.YearMonthColIDs[o]]),t[e.YearMonthColIDs[o]]=e.dblTemp):t[e.YearMonthColIDs[o]]=e.dblTemp}))}():_=Object(l.j)(n.IsGroup)?e.dtAccOpening.filter((function(e){return e.IsGroup=0})):e.dtAccOpening.filter((function(e){return e.AccountID==n.AccountID}));for(var a=0;a<_.length;a++){var r=_[a];if(null!=r){g=parseInt(n.DrNodeID),w=parseInt(n.CrNodeID);for(var h=0;h<e.oColumns.length;h++){var c=e.oColumns[h];if("FLOAT"==c.ColumnType&&(p=c.ID,e.dbl=0,Object(u.isNullOrUndefined)(r[p])||(e.dbl=parseFloat(r[p])),e.ShowAccountWithZeroBalance||0!=parseFloat(e.dbl.ToString("N"+c.DataFormat.DecimalsPoints)))){if(T=null,f=M,e.dbl<0&&0!=w&&w!=M){var C=e.dsTree.Tables[0].filter((function(e){return e.NodeID==w}));C.length>0&&(T=C[0],f=w)}else if(e.dbl>0&&0!=g&&g!=M){var R=e.dsTree.Tables[0].filter((function(e){return e.NodeID==g}));R.length>0&&(T=R[0],f=g)}null==T&&(T=o),T[p]=i.e.Double(T[p])+e.dbl,(e.ShowDetailReport||D)&&(e.DetailRows.ContainsKey(f)||e.DetailRows.push(f,new Array),e.DetailRows[f].Contains(r)||e.DetailRows[f].push(r))}}}}},a=0;a<s.length;a++)n(a)}},W=0;W<e.dsTree.Tables[0].length;W++){var k=x(W);if("object"==typeof k)return k.v}e.IsTemplateBudget&&function(){for(var t,o,s,n=0;n<e.dsTree.Tables[0].length;n++)if(e.drAccount=e.dsTree.Tables[0][n],e.strAccountID=e.drAccount.NodeID.toString(),!Object(l.j)(e.drAccount.IsGroup)&&(t=!1,null!=e.dvCurrentBudget&&(e.dvCurrentBudget=e.dvCurrentBudgetTable.filter((function(t){return t.AccountID==e.strAccountID})),e.dvCurrentBudget.length>0&&(t=!0)),t))if(e.Show==d.MonthWise){if(null!=e.dvCurrentBudget){var a=void 0,r=e.ShowForecast?e.ForeCastStart:new Date(e.ViewModel.oReportDialog.FromDate.Date.getFullYear(),e.ViewModel.oReportDialog.FromDate.Date.getMonth(),1);if(e.dvCurrentBudget.length>0)for(;r<=e.ForeCastEnd;)e.strTemp=r.ToString("MMMyyyy"),a="Y"+r.getFullYear()+"M"+r.iMonth(),e.dvCurrentBudgetColumns.Contains(e.strTemp)&&(o=parseFloat(e.dvCurrentBudget[0][e.strTemp]),e.ShowBudget&&!e.HideTagWiseBudget&&(e.drAccount["Budget"+a]=o),e.ShowBudgetVariance&&!e.HideTagWiseBudget&&(s=i.e.Double(e.drAccount[a]),e.drAccount["Variance"+a]=o-Math.abs(s)),e.ShowBudgetVariancePercent&&!e.HideTagWiseBudget&&(s=i.e.Double(e.drAccount[a]),e.drAccount["PercentVariance"+a]=0!=o?100*(o-Math.abs(s))/o:0)),r=r.AddMonths(1)}}else e.Show==d.TagWise&&null!=e.dvCurrentBudget&&e.lstTags.forEach((function(t){e.dvCurrentBudget=e.dvCurrentBudgetTable.filter((function(t){return t.AccountID==e.strAccountID})),o=e.GetBudgetAmount(e.dvCurrentBudget,e.ViewModel.FromDatePicker.Date,e.ViewModel.ToDatePicker.Date),e.ShowBudget&&!e.HideTagWiseBudget&&(e.drAccount["Budget"+t]=o),e.ShowBudgetVariance&&!e.HideTagWiseBudget&&(s=i.e.Double(e.drAccount[t]),e.drAccount["Variance"+t]=o-Math.abs(s)),e.ShowBudgetVariancePercent&&!e.HideTagWiseBudget&&(s=i.e.Double(e.drAccount[t]),e.drAccount["PercentVariance"+t]=0!=o?100*(o-Math.abs(s))/o:0)}));e.RefreshBudgetData(e.dsTree.Tables[0])}()}if(e.AddRows(e.dsTree.Tables[0]),e.Show==d.TagWise&&e.HideEmptyDimensions)try{var U=!1;if(e.lstTags.forEach((function(t){var o=e.ViewModel.ReportColumns.find((function(e){return e.ID==t})),s=e.ViewModel.ReportColumns.indexOf(o);-1!=s&&null==e.ViewModel.Data.find((function(e){return(e.Type==a.f.Detail||e.Type==a.f.BalanceBF)&&null!=e.Cells[s].Value&&0!=parseFloat(e.Cells[s].Value)}))&&(o.HeaderAppearance.IsVisible=!1,null!=(o=e.ViewModel.ReportColumns.find((function(e){return e.ID=="Budget"+t})))&&(o.HeaderAppearance.IsVisible=!1),null!=(o=e.ViewModel.ReportColumns.find((function(e){return e.ID=="Variance"+t})))&&(o.HeaderAppearance.IsVisible=!1),null!=(o=e.ViewModel.ReportColumns.find((function(e){return e.ID=="PercentVariance"+t})))&&(o.HeaderAppearance.IsVisible=!1),U=!0)})),U){var K=new Array;e.oColumns.forEach((function(e){K.push(e)})),e.ViewModel.ReportColumns=K}}catch(H){}})).then((function(t){e.ViewModel.process_RunWorkerCompleted()}))}}},{key:"SetDataSet",value:function(){var e=this,t="";this.ViewModel.oReportDialog.GetSeqNosList(),this.ViewModel.ReportColumns.filter((function(e){return 33==e.ID.length&&!i.e.IsEmpty(e.Formula)&&e.Formula.Contains(",")})).forEach((function(o){var s,l,n=o.Formula.split(",");2==n.length&&(i.e.isValidDate(n[0])&&i.e.isValidDate(n[1])&&(s=new Date(n[0]),l=new Date(n[1]),t+='<Row ID="'+o.ID+'" From="'+s.ToString("dd MMM yyyy")+'" To="'+l.ToString("dd MMM yyyy")+'"/>',e.lstCustomCols.push(o)))})),t.length>0&&(t="<XML>"+t+"</XML>");var o=this.GetDimensionFilter("DCC.dcCCNID"),l=[];return l.push(this.TemplateID),l.push(n.b.GetTagTableName(this.TemplateCCID)),l.push(this.IsWEF),l.push(this.ViewModel.oReportDialog.FromDate.Date.ToString("dd/MMM/yyyy")),l.push(this.ViewModel.oReportDialog.ToDate.Date.ToString("dd/MMM/yyyy")),l.push(this.IncludeOpeningBalance),l.push(this.Show==d.MonthWise?1:this.Show==d.YearWise?2:this.Show==d.TagWise?this.TagID:0),l.push(this.YTDIndex),l.push(this.BAL_LMIndex),l.push(this.BAL_LYIndex),l.push(this.YTD_LYIndex),l.push(t),l.push(this.UnPostedDocsList),l.push(this.LocationWhere+o),l.push(this.GetAccountWiseLocationWhere("A")),l.push(this.ShowAccountWithZeroBalance),l.push(this.PDCInclude),l.push(this.IncludeTerminatedPDC),l.push(this.CurrencyType),l.push(this.ForeignCurrencyID),l.push(s.a.SessionManager.LanguageID),this.arrPromise.push("dsTree",s.a.report.RPT_PLTemplate(l,this.ViewModel.IsReportDB)),Promise.all(this.arrPromise.values).then((function(t){var s;for(0!=(s=e.arrPromise.keys.indexOf("dblOpeningStock"))&&(e.dblOpeningStock=parseFloat(t[s])),0!=(s=e.arrPromise.keys.indexOf("dblClosingStock"))&&(e.dblClosingStock=parseFloat(t[s])),s=e.arrPromise.keys.indexOf("dsTree"),e.dsTree=t[s],e.dtYearStart=e.dsTree.Tables[7].length>0?new Date(e.dsTree.Tables[7][0].YearStart):e.ViewModel.oReportDialog.FromDate.Date;e.dtYearStart.AddYears(1)<=e.ViewModel.oReportDialog.FromDate.Date;)e.dtYearStart=e.dtYearStart.AddYears(1);e.dtAccount=e.dsTree.Tables[2],e.dtAccountColumns=e.dsTree.Columns[2],e.dv=e.dsTree.Tables[2],e.LastColumn=e.dsTree.Columns[2][e.dtAccountColumns.length-1],e.dsTree.Columns[8].length>1?(e.dtAccOpening=e.dsTree.Tables[8],e.dtAccOpeningColumns=e.dsTree.Columns[8]):e.dtAccOpening=null;for(var i=3;i<7;i++)e.dsTree.Tables[i].forEach((function(t){if(0==e.dtAccount.filter((function(e){return e.AccountID==t.AccountID})).length){for(var o={},s=0;s<e.dtAccountColumns.length;s++)o[e.dtAccountColumns[s]]=t[e.dtAccountColumns[s]];o.Balance=null,e.dtAccount.push(o)}}));-1!=e.YTDIndex&&(e.dvYTD=e.dsTree.Tables[3],e.dtAccountColumns.push("YTD")),-1!=e.BAL_LYIndex&&(e.dvBAL_LY=e.dsTree.Tables[4],e.dtAccountColumns.push("LastYearBalance")),-1!=e.YTD_LYIndex&&(e.dvYTD_LY=e.dsTree.Tables[5],e.dtAccountColumns.push("LastYearYTD")),-1!=e.BAL_LMIndex&&(e.dvBAL_LM=e.dsTree.Tables[6],e.dtAccountColumns.push("LastMonthBalance")),e.lstCustomCols.forEach((function(t){e.dtAccountColumns.push(t.ID)})),e.dsTree.Tables[9].length>0&&(e.InActiveStatusID=parseInt(e.dsTree.Tables[9][0].InActiveStatus)),e.SetBudgetDataSet("",e.LocationWhere+o),e.SetBudgetDataSet_Complete();for(var l=0;l<e.CountMonths;l++)e.dtAccountColumns.push(e.oColumns[e.ColumnSize+l].ID),null!=e.dtAccOpening&&e.dtAccOpeningColumns.push(e.oColumns[e.ColumnSize+l].ID);e.IsWEF?e.RefreshTagWiseData_WEF():e.RefreshTagWiseData(),e.IsTemplateBudget||e.RefreshBudgetData(e.dtAccount)}))}},{key:"SetBudgetDataSet",value:function(e,t){var o=this;if(this.dvPrevBudget=null,this.dvCurrentBudget=null,(this.ShowBudget||this.ShowBudgetVariance||this.ShowBudgetVariancePercent||this.ShowTotalBudget)&&null==this.dsBudget){var i,l="",n="",a="",r=this.ViewModel.oReportDialog.CostCenterFilters.filter((function(e){return e.CostCenterID>5e4&&e.SelectedNodes.length>0}));if(r.length>0){var h="SELECT CostCenterID FROM COM_BudgetDefDims with(nolock) WHERE BudgetDefID="+this.CurrentBudgetID+" and CostCenterID>50000";this.PreviousBudgetID>0&&(-1!=this.BAL_LYIndex||-1!=this.YTD_LYIndex)&&(h+=" SELECT CostCenterID FROM COM_BudgetDefDims with(nolock) WHERE BudgetDefID="+this.PreviousBudgetID+" and CostCenterID>50000");var u=s.a.report.ReportDataSet("RPT022",this.ViewModel.IsReportDB,h);u.Tables[0].forEach((function(e){if(r.find((function(t){return t.CostCenterID==parseInt(e.CostCenterID)}))){var t=o.GetFilterByDimension_1(parseInt(e.CostCenterID));t.length>0&&(n+=" AND CCNID"+(parseInt(e.CostCenterID)-5e4)+" IN ("+t+")")}})),u.Tables.length>1&&u.Tables[1].forEach((function(e){if(r.find((function(t){return t.CostCenterID==parseInt(e.CostCenterID)}))){var t=o.GetFilterByDimension_1(parseInt(e.CostCenterID));t.length>0&&(a+=" AND CCNID"+(parseInt(e.CostCenterID)-5e4)+" IN ("+t+")")}}))}if(this.Show==d.TagWise){l+="SELECT AccountID,CCNID"+(this.TagID-5e4)+" TagID,SUM(AnnualAmount) AnnualAmount",i=this.dtYearStart;for(var c=1;c<=12;c++)l+=",SUM(Month"+c+"Amount) "+i.ToString("MMMyyyy"),i=i.AddMonths(1);if(l+=" FROM COM_BudgetAlloc with(nolock) WHERE BudgetDefID="+this.CurrentBudgetID,l+=n.toString(),l+=" GROUP BY AccountID,CCNID"+(this.TagID-5e4),this.PreviousBudgetID>0&&(-1!=this.BAL_LYIndex||-1!=this.YTD_LYIndex)){l+=" SELECT AccountID,CCNID"+(this.TagID-5e4)+" TagID,SUM(AnnualAmount) AnnualAmount",i=this.dtYearStart;for(var D=1;D<=12;D++)l+=",SUM(Month"+D+"Amount) "+i.ToString("MMMyyyy"),i=i.AddMonths(1);l+=" FROM COM_BudgetAlloc with(nolock) WHERE BudgetDefID="+this.PreviousBudgetID,l+=a.toString(),l+=" GROUP BY AccountID,CCNID"+(this.TagID-5e4)}}else{var C="AccountID";this.dsBudget=s.a.report.ReportDataSet("RPT022",this.ViewModel.IsReportDB,"SELECT CostCenterID FROM COM_BudgetDefDims with(nolock) WHERE BudgetDefID="+this.CurrentBudgetID+" and CostCenterID="+this.TemplateCCID),this.dsBudget.Tables[0].length>0&&(this.IsTemplateBudget=!0,C="CCNID"+(this.TemplateCCID-5e4)),l+="SELECT "+C+" AccountID,SUM(AnnualAmount) AnnualAmount",i=this.dtYearStart;for(var p=1;p<=12;p++)l+=",SUM(Month"+p+"Amount) "+i.ToString("MMMyyyy"),i=i.AddMonths(1);if(l+=" FROM COM_BudgetAlloc with(nolock) WHERE BudgetDefID="+this.CurrentBudgetID,l+=n.toString(),l+=" GROUP BY "+C,this.PreviousBudgetID>0&&(-1!=this.BAL_LYIndex||-1!=this.YTD_LYIndex)){l+=" SELECT "+C+" AccountID,SUM(AnnualAmount) AnnualAmount",i=this.dtYearStart;for(var T=1;T<=12;T++)l+=",SUM(Month"+T+"Amount) "+i.ToString("MMMyyyy"),i=i.AddMonths(1);l+=a.toString(),l+=" GROUP BY "+C}}this.dsBudget=s.a.report.ReportDataSet("RPT022",this.ViewModel.IsReportDB,l.toString())}}},{key:"SetBudgetDataSet_Complete",value:function(){this.dvCurrentBudget=this.dvCurrentBudgetTable=this.dsBudget.Tables[0],this.dvCurrentBudgetColumns=this.dsBudget.Columns[0],this.dsBudget.Tables.length>1&&(this.dvPrevBudget=this.dvPrevBudgetTable=this.dsBudget.Tables[1],this.dvPrevBudgetColumns=this.dsBudget.Columns[1]),this.dsTree.Columns[2].push("BudgetBalance"),this.dsTree.Columns[2].push("VarianceBalance"),this.dsTree.Columns[2].push("PercentVarianceBalance"),this.dsTree.Columns[2].push("TotalBudget"),-1!=this.YTDIndex&&(this.dsTree.Columns[2].push("BudgetYTD"),this.dsTree.Columns[2].push("VarianceYTD"),this.dsTree.Columns[2].push("PercentVarianceYTD")),-1!=this.BAL_LYIndex&&(this.dsTree.Columns[2].push("BudgetLastYearBalance"),this.dsTree.Columns[2].push("VarianceLastYearBalance"),this.dsTree.Columns[2].push("PercentVarianceLastYearBalance")),-1!=this.YTD_LYIndex&&(this.dsTree.Columns[2].push("BudgetLastYearYTD"),this.dsTree.Columns[2].push("VarianceLastYearYTD"),this.dsTree.Columns[2].push("PercentVarianceLastYearYTD")),-1!=this.BAL_LMIndex&&(this.dsTree.Columns[2].push("BudgetLastMonthBalance"),this.dsTree.Columns[2].push("VarianceLastMonthBalance"),this.dsTree.Columns[2].push("PercentVarianceLastMonthBalance"))}},{key:"SetRetainedEarning",value:function(e,t){if("Show Opening"!=t&&"Show Closing"!=t&&(t="Period"),!this.dtRetainedEarning.ContainsKey(t)){var o,i,l="";this.ForeignCurrencyID>0?(o="AmountFC",i=" AND ACC.CurrencyID="+this.ForeignCurrencyID):(o=1==this.CurrencyType?"AmountBC":"Amount",i="");var n,a="",r="",h="",c="",D=this.GetDimensionFilter("DCC.dcCCNID");(this.LocationWhere.length>0||this.Show==d.TagWise||D.length>0)&&(r=" JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.AccDocDetailsID=ACC.AccDocDetailsID ",h=" JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=ACC.InvDocDetailsID ");var C="",p="",T="";this.Show==d.MonthWise?(C="CONVERT(DATETIME,DocDate) DocDate,",p="'Y'+CONVERT(NVARCHAR,YEAR(DocDate))+'M'+ CONVERT(NVARCHAR,Month(DocDate)) Mn,",T="YEAR(DocDate), MONTH(DocDate)"):this.Show==d.YearWise?(C="CONVERT(DATETIME,FY.FromDate) DocDate,",p="'Y'+CONVERT(NVARCHAR,YEAR(DocDate))+'M'+ CONVERT(NVARCHAR,Month(DocDate)) Mn,",T="YEAR(DocDate),Month(DocDate)",c+=" join ADM_FinancialYears FY with(nolock) on ACC.DocDate between FY.FromDate and FY.ToDate"):this.Show==d.TagWise&&(C="DCC.dcCCNID"+(this.TagID-5e4)+" TagID,",p="TagID,",T="TagID"),"";var _="";0==this.UnPostedDocsList.length?_=" AND (ACC.StatusID=369 or ACC.StatusID=429)":_+=" AND ACC.StatusID IN (369,429,"+this.UnPostedDocsList+")";var m="(ACC.StatusID=370 OR ACC.StatusID=439"+(this.IncludeTerminatedPDC?" OR ACC.StatusID=452":"")+")";this.PDCInclude?(l=" AND ACC.DocumentType<>16 AND ("+m+" OR (ACC.DocumentType<>14 AND ACC.DocumentType<>19"+_+"))"," AND ("+m+" OR (ACC.DocumentType<>14 AND ACC.DocumentType<>19"+_+"))"):(l=" AND ACC.DocumentType NOT IN (16,14,19)"+_," AND ACC.DocumentType<>14 AND ACC.DocumentType<>19"+_);var I="";this.PDCInclude&&(I=" OR (DocDate<=@To AND (ACC.DocumentType=14 OR ACC.DocumentType=19) AND "+m+")",l=" AND ACC.DocumentType NOT IN (16,14,19) "+_),n="Show Opening"==t?"DocDate<@From":"Show Closing"==t?"DocDate<=@To":"DocDate BETWEEN @From AND @To",a+="DECLARE @From FLOAT,@To FLOAT\nSET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))\n",a+="\nSELECT "+p+"SUM(TR_Dr)-SUM(TR_Cr) Balance\nFROM (",a+="\n--Transaction Dr\nSELECT ACC.DebitAccount AccountID,"+C+"ACC."+o+" TR_Dr,0 TR_Cr\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+r+c+"\nWHERE ((("+n+")"+l+")"+I+")"+i+this.LocationWhere+D+" AND ACC.DebitAccount>1\nUNION ALL--Transaction Cr\nSELECT ACC.CreditAccount,"+C+"0 TR_Dr,ACC."+o+" TR_Cr\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+r+c+"\nWHERE ((("+n+")"+l+")"+I+")"+i+this.LocationWhere+D+" AND ACC.CreditAccount>1",h.length>0&&(a+="\n--INEVENTORY DATA\nUNION ALL--Transaction Dr\nSELECT ACC.DebitAccount,"+C+"ACC."+o+" TR_Dr,0 TR_Cr\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+h+c+"\nWHERE ("+n+")"+l+i+this.LocationWhere+D+" AND ACC.DebitAccount>1\nUNION ALL--Transaction Cr\nSELECT ACC.CreditAccount,"+C+"0 TR_Dr,ACC."+o+" TR_Cr\nFROM ACC_DocDetails ACC  WITH(NOLOCK)"+h+c+"\nWHERE ("+n+")"+l+i+this.LocationWhere+D+" AND ACC.CreditAccount>1"),a+="\n) AS T1 JOIN ACC_Accounts A WITH(NOLOCK) ON A.AccountID=T1.AccountID\nwhere A.AccountTypeID IN (4,8,11,5,9,12)",a+=this.GetAccountWiseLocationWhere("A"),T.length>0&&(a+=" GROUP BY "+T);var R=s.a.report.ReportDataSet("RPT022",this.ViewModel.IsReportDB,a);this.dtRetainedEarning.push(t,R.Tables[0])}if(this.dtRetainedEarning[t].length>0&&(e.Balance=this.dtRetainedEarning[t].Compute("sum","Balance"),this.Show!=d.None)){var S=0,A=this.Show==d.TagWise?"TagID":"Mn";if(this.dtRetainedEarning[t].forEach((function(o){Object(u.isUndefined)(e[o[A].toString()])?"Show Closing"==t&&(S+=parseFloat(o.Balance)):e[o[A].toString()]=o.Balance})),this.YearMonthColIDs.length>0&&(this.CumulativeByMn||"Show Closing"==t)){this.dblTemp=S;for(var M=0;M<this.YearMonthColIDs.length;M++)null!=e[this.YearMonthColIDs[M]]?(this.dblTemp+=parseFloat(e[this.YearMonthColIDs[M]]),e[this.YearMonthColIDs[M]]=this.dblTemp):e[this.YearMonthColIDs[M]]=this.dblTemp}}}},{key:"LoadReportWithPostFilters",value:function(e){this.GrdRow=-1,this.ViewModel.Data.Clear()}},{key:"RefreshTagWiseData",value:function(){var e=this;if(!this.IsWEF){var t,o=!1,s=0,n=0;if(this.Show!=d.None||-1!=this.YTDIndex||-1!=this.BAL_LMIndex||-1!=this.BAL_LYIndex||-1!=this.YTD_LYIndex){this.Show==d.YearWise&&this.dtAccountColumns.push("Mn"),this.Show!=d.YearWise&&this.Show!=d.MonthWise||(this.dtAccountColumns.push("OpBalance"),null!=this.dtAccOpening&&this.dtAccOpeningColumns.push("OpBalance"));for(var a=0;a<this.dtAccount.length;a++)if(this.drAccount=this.dtAccount[a],this.strAccountID=this.drAccount.AccountID.toString(),Object(l.j)(this.drAccount.IsGroup))this.dbl=0,this.UpdateTableWithPreviousYears();else{if(this.Show!=d.None){this.dblTemp=0;var r=0;if(this.AccountID=parseInt(this.drAccount.AccountID),this.Show==d.YearWise&&this.drAccount.FromDate){var h=new Date(this.drAccount.FromDate);this.drAccount.Mn="Y"+h.getFullYear()+"M"+h.iMonth()}for(this.strTemp=this.drAccount.Mn.toString(),this.strTemp.length>0&&(this.dblTemp=i.e.Double(this.drAccount.Balance),this.dtAccountColumns.Contains(this.strTemp)?this.drAccount[this.strTemp]=this.drAccount.Balance:r+=null!=this.drAccount.Balance?parseFloat(this.drAccount.Balance):0);a+1<this.dv.length&&this.AccountID==parseInt(this.dv[a+1].AccountID);){if(this.Show==d.YearWise){var u=new Date(this.dv[a+1].FromDate);this.dv[a+1].Mn="Y"+u.getFullYear()+"M"+u.iMonth()}this.strTemp=this.dv[a+1].Mn.toString(),this.strTemp.length>0&&(this.dblTemp=this.dblTemp+parseFloat(this.dv[a+1].Balance),this.dtAccountColumns.Contains(this.strTemp)?this.drAccount[this.strTemp]=this.dv[a+1].Balance:r+=null!=this.dv[a+1].Balance?parseFloat(this.dv[a+1].Balance):0),this.dvTable.Remove(this.dv[a+1].Row)}this.drAccount.Balance=this.dblTemp,this.Show!=d.YearWise&&this.Show!=d.MonthWise||(null!=this.dtAccOpening?(t=this.dtAccOpening.filter((function(t){return t.AccountID==e.AccountID}))).length>0&&(this.drAccount.OpBalance=t[0].Balance):this.drAccount.OpBalance=r)}if(o=!1,null==this.dvCurrentBudget||this.IsTemplateBudget||(this.dvCurrentBudget=this.dvCurrentBudgetTable.filter((function(t){return t.AccountID==e.strAccountID})),this.dvCurrentBudget.length>0&&(o=!0)),o)if(this.Show==d.MonthWise){if(null!=this.dvCurrentBudget){var c=void 0,D=this.ShowForecast?this.ForeCastStart:new Date(this.ViewModel.oReportDialog.FromDate.Date.getFullYear(),this.ViewModel.oReportDialog.FromDate.Date.getMonth(),1);if(this.dvCurrentBudget.length>0)for(;D<=this.ForeCastEnd;)this.strTemp=D.ToString("MMMyyyy"),c="Y"+D.getFullYear()+"M"+D.iMonth(),this.dvCurrentBudgetColumns.Contains(this.strTemp)&&(s=parseFloat(this.dvCurrentBudget[0][this.strTemp]),this.ShowBudget&&!this.HideTagWiseBudget&&(this.drAccount["Budget"+c]=s),this.ShowBudgetVariance&&!this.HideTagWiseBudget&&(n=i.e.Double(this.drAccount[c]),this.drAccount["Variance"+c]=s-Math.abs(n)),this.ShowBudgetVariancePercent&&!this.HideTagWiseBudget&&(n=i.e.Double(this.drAccount[c]),this.drAccount["PercentVariance"+c]=0!=s?100*(s-Math.abs(n))/s:0)),D=D.AddMonths(1)}}else this.Show==d.TagWise&&null!=this.dvCurrentBudget&&this.lstTags.forEach((function(t){e.dvCurrentBudget=e.dvCurrentBudgetTable.filter((function(o){return o.AccountID==e.strAccountID&&o.TagID==t})),s=e.GetBudgetAmount(e.dvCurrentBudget,e.ViewModel.FromDatePicker.Date,e.ViewModel.ToDatePicker.Date),e.ShowBudget&&!e.HideTagWiseBudget&&(e.drAccount["Budget"+t]=s),e.ShowBudgetVariance&&!e.HideTagWiseBudget&&(n=i.e.Double(e.drAccount[t]),e.drAccount["Variance"+t]=s-Math.abs(n)),e.ShowBudgetVariancePercent&&!e.HideTagWiseBudget&&(n=i.e.Double(e.drAccount[t]),e.drAccount["PercentVariance"+t]=0!=s?100*(s-Math.abs(n))/s:0)}));this.UpdateTableWithPreviousYears()}if(this.Show==d.TagWise&&null!=this.dtAccOpening)for(var C=0;C<this.dtAccOpening.length;C++)if(this.drAccount=this.dtAccOpening[C],this.strAccountID=this.drAccount.AccountID.toString(),!Object(l.j)(this.drAccount.IsGroup)){for(this.dblTemp=0,this.AccountID=parseInt(this.drAccount.AccountID),this.strTemp=this.drAccount.Mn.toString(),this.strTemp.length>0&&(this.dblTemp=i.e.Double(this.drAccount.Balance),this.dtAccountColumns.Contains(this.strTemp)&&(this.drAccount[this.strTemp]=this.drAccount.Balance));C+1<this.dtAccOpening.length&&this.AccountID==parseInt(this.dtAccOpening[C+1].AccountID);)this.strTemp=this.dtAccOpening[C+1].Mn.toString(),this.strTemp.length>0&&(this.dblTemp=this.dblTemp+parseFloat(this.dtAccOpening[C+1].Balance),this.dtAccountColumns.Contains(this.strTemp)&&(this.drAccount[this.strTemp]=this.dtAccOpening[C+1].Balance)),this.dtAccOpening.RemoveAt(C+1);this.drAccount.Balance=this.dblTemp}}}}},{key:"RefreshTagWiseData_WEF",value:function(){if(this.Show==d.YearWise){this.dtAccountColumns.push("Mn");for(var e=0;e<this.dtAccount.length;e++)if(this.drAccount=this.dtAccount[e],this.strAccountID=this.drAccount.AccountID.toString(),!Object(l.j)(this.drAccount.IsGroup)&&0!=this.Show&&(this.dblTemp=0,this.AccountID=parseInt(this.drAccount.AccountID),this.Show==d.YearWise&&null!=this.drAccount.FromDate)){var t=new Date(this.drAccount.FromDate);this.drAccount.Mn="Y"+t.getFullYear()+"M"+t.iMonth()}}}},{key:"RefreshBudgetData",value:function(e){var t=this;if(null!=this.dvCurrentBudget)for(var o=e==this.dsTree.Tables[0]?"NodeID":"AccountID",s=this.ViewModel.FromDatePicker.Date.AddMonths(-1).ToString("MMMyyyy"),i=0;i<e.length;i++)if(this.drAccount=e[i],this.strAccountID=this.drAccount[o].toString(),!Object(l.j)(this.drAccount.IsGroup)){this.dvCurrentBudget=this.dvCurrentBudgetTable.filter((function(e){return e.AccountID==t.strAccountID}));var n=this.GetBudgetAmount(this.dvCurrentBudget,this.ForeCastStart,this.ForeCastEnd);if(this.ShowBudget&&(this.drAccount.BudgetBalance=n),this.ShowTotalBudget&&(this.dblTemp=this.GetBudgetAmount_dv(this.dvCurrentBudget),this.drAccount.TotalBudget=this.dblTemp),this.ShowBudgetVariance||this.ShowBudgetVariancePercent){this.dbl=null!=this.drAccount.Balance?parseFloat(this.drAccount.Balance):0;var a;a=n-Math.abs(this.dbl),this.drAccount.VarianceBalance=a,this.ShowBudgetVariancePercent&&(this.dblTemp=0!=n?100*a/n:0,this.drAccount.PercentVarianceBalance=this.dblTemp)}if(-1!=this.YTDIndex&&(n=this.GetBudgetAmount(this.dvCurrentBudget,this.dtYearStart,this.ViewModel.ToDatePicker.Date),this.ShowBudget&&(this.drAccount.BudgetYTD=n),this.ShowBudgetVariance||this.ShowBudgetVariancePercent)){this.dbl=null!=this.drAccount.YTD?parseFloat(this.drAccount.YTD):0;var r;r=n-Math.abs(this.dbl),this.drAccount.VarianceYTD=r,this.ShowBudgetVariancePercent&&(this.dblTemp=0!=n?100*r/n:0,this.drAccount.PercentVarianceYTD=this.dblTemp)}if(-1!=this.BAL_LMIndex&&(n=this.dvCurrentBudgetColumns.Contains(s)?this.GetBudgetAmount(this.dvCurrentBudget,this.ViewModel.FromDatePicker.Date.AddMonths(-1),this.ViewModel.FromDatePicker.Date.AddDays(-1)):null!=this.dvPrevBudget&&this.dvPrevBudgetColumns.Contains(s)?this.GetBudgetAmount(this.dvPrevBudget,this.ViewModel.FromDatePicker.Date.AddMonths(-1),this.ViewModel.FromDatePicker.Date.AddDays(-1)):0,this.ShowBudget&&(this.drAccount.BudgetLastMonthBalance=n),this.ShowBudgetVariance||this.ShowBudgetVariancePercent)){this.dbl=null!=this.drAccount.LastMonthBalance?parseFloat(this.drAccount.LastMonthBalance):0;var h;h=n-Math.abs(this.dbl),this.drAccount.VarianceLastMonthBalance=h,this.ShowBudgetVariancePercent&&(this.dblTemp=0!=n?100*h/n:0,this.drAccount.PercentVarianceLastMonthBalance=this.dblTemp)}if(-1!=this.BAL_LYIndex&&(this.dvBAL_LY=this.dvBAL_LYTable.filter((function(e){return e.AccountID==t.strAccountID})),this.dvBAL_LY.length>0&&null!=this.dvPrevBudget&&(this.dvPrevBudget=this.dvPrevBudgetTable.filter((function(e){return e.AccountID==t.strAccountID})),n=this.GetBudgetAmount(this.dvPrevBudget,this.ViewModel.FromDatePicker.Date,this.ViewModel.ToDatePicker.Date),this.ShowBudget&&(this.drAccount.BudgetLastYearBalance=n),this.ShowBudgetVariance||this.ShowBudgetVariancePercent))){this.dbl=null!=this.drAccount.LastYearBalance?parseFloat(this.drAccount.LastYearBalance):0;var u;u=n-Math.abs(this.dbl),this.drAccount.VarianceLastYearBalance=u,this.ShowBudgetVariancePercent&&(this.dblTemp=0!=n?100*u/n:0,this.drAccount.PercentVarianceLastYearBalance=this.dblTemp)}if(-1!=this.YTD_LYIndex&&(this.dvYTD_LY=this.dvYTD_LYTable.filter((function(e){return e.AccountID==t.strAccountID})),this.dvYTD_LY.length>0&&null!=this.dvPrevBudget&&(this.dvPrevBudget=this.dvPrevBudgetTable.filter((function(e){return e.AccountID==t.strAccountID})),n=this.GetBudgetAmount(this.dvPrevBudget,this.dtYearStart,this.ViewModel.ToDatePicker.Date),this.ShowBudget&&(this.drAccount.BudgetLastYearYTD=n),this.ShowBudgetVariance||this.ShowBudgetVariancePercent))){this.dbl=null!=this.drAccount.LastYearYTD?parseFloat(this.drAccount.LastYearYTD):0;var c;c=n-Math.abs(this.dbl),this.drAccount.VarianceLastYearYTD=c,this.ShowBudgetVariancePercent&&(this.dblTemp=0!=n?100*c/n:0,this.drAccount.PercentVarianceLastYearYTD=this.dblTemp)}}}},{key:"UpdateTableWithPreviousYears",value:function(){var e=this;-1!=this.YTDIndex&&(this.dvYTD=this.dvYTDTable.filter((function(t){return t.AccountID==e.strAccountID})),this.dvYTD.length>0&&(this.dblTemp=i.e.Double(this.dvYTD[0].Balance),this.drAccount.YTD=this.dblTemp)),-1!=this.BAL_LMIndex&&(this.dvBAL_LM=this.dvBAL_LMTable.filter((function(t){return t.AccountID==e.strAccountID})),this.dvBAL_LM.length>0&&(this.dblTemp=i.e.Double(this.dvBAL_LM[0].Balance),this.drAccount.LastMonthBalance=this.dblTemp)),-1!=this.BAL_LYIndex&&(this.dvBAL_LY=this.dvBAL_LYTable.filter((function(t){return t.AccountID==e.strAccountID})),this.dvBAL_LY.length>0&&(this.dblTemp=i.e.Double(this.dvBAL_LY[0].Balance),this.drAccount.LastYearBalance=this.dblTemp)),-1!=this.YTD_LYIndex&&(this.dvYTD_LY=this.dvYTD_LYTable.filter((function(t){return t.AccountID==e.strAccountID})),this.dvYTD_LY.length>0&&(this.dblTemp=i.e.Double(this.dvYTD_LY[0].Balance),this.drAccount.LastYearYTD=this.dblTemp));var t=11;this.lstCustomCols.forEach((function(o){var s=e.dsTree.Tables[t]((function(t){return t.AccountID==e.strAccountID}));s.length>0&&(e.dblTemp=i.e.Double(s[0].Balance),e.drAccount[o.ID]=e.dblTemp),t++}))}},{key:"AddRows",value:function(e){var t=this;if(this.lstLevelGroups=new Array,this.lstLevelGroups.push(new c(new a.d(this.oColumns.length,this.ViewModel.RowHeight),this.oColumns.length)),e.length>0)for(var o=0;o<parseInt(e[0].Depth)-1;o++)this.lstLevelGroups.push(new c(new a.d(this.oColumns.length,this.ViewModel.RowHeight),this.oColumns.length));var s,n,r,h,D,d=0,C=this.fldDict,p=!1;for(this.LevelColsCnt=0;this.LevelColsCnt<this.oColumns.length&&"FLOAT"!=this.oColumns[this.LevelColsCnt].ColumnType;this.LevelColsCnt++);for(var T=function(o){if(n=e[o].F.toString().Trim(),(t.ShowAllAccounts||0!=n.length||Object(l.j)(e[o].IsGroup)||t.oColumns.find((function(t){return"FLOAT"==t.ColumnType&&!i.e.IsEmpty(e[o][t.ID])})))&&(t.oRow=new a.d(t.oColumns.length,t.ViewModel.RowHeight),t.oRow.DataRow=e[o],D=parseInt(e[o].StatusID)==t.InActiveStatusID,t.oRow.LevelNo=parseInt(e[o].Depth)-1,t.oRow.IsGroup=Object(l.j)(e[o].IsGroup),t.oRow.NodeID=parseInt(e[o].NodeID),h="True"==e[o].Bold.toString(),p=!1,!t.ShowDetailReport&&t.DetailRows.ContainsKey(t.oRow.NodeID)&&(t.oRow.IsGroup=!0,p=!0),t.ShowAllAccounts||0!=n.length||t.oRow.IsGroup||t.ShowAccountWithZeroBalance||t.oColumns.find((function(t){return"FLOAT"==t.ColumnType&&!i.e.IsEmpty(e[o][t.ID])&&0!=parseFloat(parseFloat(e[o][t.ID]).ToString("N"+t.DataFormat.DecimalsPoints))})))){if(t.UpdateTreeTotals(t.oRow.LevelNo),n.length>0)if(0==i.e.stringCompare(n,"PactRetainedEarning",!0))t.SetRetainedEarning(e[o],e[o].Opening.toString());else for(var T=0;T<t.oColumns.length;T++)if("FLOAT"==t.oColumns[T].ColumnType){for(var _=0;_<o;_++)Object(u.isNullOrUndefined)(e[_][t.oColumns[T].ID])?t.fldDict[e[_].Name.toString().Replace(" ","")].setFieldValue(0):t.fldDict[e[_].Name.toString().Replace(" ","")].setFieldValue(e[_][t.oColumns[T].ID]);try{e[o][t.oColumns[T].ID]=t.eval.EvaluateExpression(n,C)}catch(w){}}if(t.oRow.IsGroup){t.lstLevelGroups.push(new c(t.oRow,t.oColumns.length)),"False"!=e[o].TotShow.toString()&&(t.lstLevelGroups[t.lstLevelGroups.length-1].ShowTotal=!0,"At End"==e[o].TotShow.toString()&&(t.lstLevelGroups[t.lstLevelGroups.length-1].TotalAtEnd=!0,t.lstLevelGroups[t.lstLevelGroups.length-1].TotalCaption=i.e.String(e[o].TotText))),t.lstLevelGroups[t.lstLevelGroups.length-1].TotalBackground="Yes"==e[o].TotalBg.toString(),t.lstLevelGroups[t.lstLevelGroups.length-1].TotalBorder=t.lstBorder.indexOf(e[o].TotalBor.toString()),-1==t.lstLevelGroups[t.lstLevelGroups.length-1].TotalBorder&&(t.lstLevelGroups[t.lstLevelGroups.length-1].TotalBorder=0),"Yes"==e[o].TotalBorRow.toString()&&(t.lstLevelGroups[t.lstLevelGroups.length-1].TotalBorder=-t.lstLevelGroups[t.lstLevelGroups.length-1].TotalBorder);for(var m=0;m<t.oRow.Cells.length;m++)t.oRow.Cells[m].IsNormal=!1,t.oRow.Cells[m].CellAppearance=t.oColumns[m].DataAppearance.Clone(),t.oRow.Cells[m].CellAppearance.ForeColor="#FF0081A6",h&&(t.oRow.Cells[m].CellAppearance.IsBold=!0);if(t.oRow.PrintVisible=t.ViewModel.TreeGroupPrint,t.lstLevelGroups[t.lstLevelGroups.length-1].TotalBackground&&!t.lstLevelGroups[t.lstLevelGroups.length-1].TotalAtEnd)for(var I=0;I<t.oRow.Cells.length;I++)null==t.oRow.Cells[I].CellAppearance&&(t.oRow.Cells[I].IsNormal=!1,t.oRow.Cells[I].CellAppearance=t.oColumns[I].DataAppearance.Clone()),t.oRow.Cells[I].CellAppearance.BackColor="#FFD8D8D8"}else{var R=t.lstBorder.indexOf(e[o].TotalBor.toString());if(-1==R&&(R=0),h||0!=R)for(var S=0;S<t.oRow.Cells.length;S++)t.oRow.Cells[S].IsNormal=!1,t.oRow.Cells[S].CellAppearance=t.oColumns[S].DataAppearance.Clone(),t.oRow.Cells[S].CellAppearance.IsBold=!0,"FLOAT"==t.oColumns[S].ColumnType&&(t.oRow.Cells[S].Border=R)}if(t.ShowDetailReport)for(var A=0;A<t.oRow.Cells.length;A++)t.oRow.Cells[A].IsNormal=!1,t.oRow.Cells[A].CellAppearance=t.ViewModel.lstGroup[0].GroupAppearance;if(!t.ShowDetailReport||!(t.oRow.IsGroup||n.length>0)){for(var M=0;M<t.oColumns.length;M++)if(r=t.oColumns[M],!t.ShowDetailReport&&M<t.LevelColsCnt&&(t.oRow.Cells[M].IsNormal=!1,t.oRow.Cells[M].level=t.oRow.LevelNo-1),!t.ShowBudgetVariancePercent||i.e.IsEmpty(r.DataFormat.PercentageOn))Object(u.isUndefined)(e[o][t.oColumns[M].ID])||(i.e.IsEmpty(t.oColumns[M].Formula)||t.ViewModel.CalculateFormula_2(t.oColumns[M],e[o]),""!=(s=e[o][r.ID].toString())&&("FLOAT"==r.ColumnType&&i.e.IsNum(s)?(d=i.e.Double(s),p||t.ShowDetailReport||t.FormatData(d,t.oRow,M),D||t.lstLevelGroups.length>0&&(t.lstLevelGroups[t.lstLevelGroups.length-1].Total[M]+=d)):t.ViewModel.SetCellValue(s,r.DataFormat,r.ColumnType,t.oRow.Cells[M])));else{var g=t.oColumns[M-t.VariancePercentIndex].ID;t.dbl=null!=e[o]["Budget"+g]?parseFloat(e[o]["Budget"+g]):0,t.ShowBudgetVariance?t.dblVariance=null!=e[o]["Variance"+g]?parseFloat(e[o]["Variance"+g]):0:(t.dblTemp=null!=e[o][g]?parseFloat(e[o][g]):0,t.dblVariance=t.dbl-Math.abs(t.dblTemp)),t.dblTemp=0!=t.dbl?100*t.dblVariance/t.dbl:0,e[o]["PercentVariance"+g]=t.dblTemp,p||t.oRow.IsGroup||t.ShowDetailReport||t.FormatData(t.dblTemp,t.oRow,M),D||t.lstLevelGroups.length>0&&(t.lstLevelGroups[t.lstLevelGroups.length-1].Total[M]+=t.dblVariance)}t.oRow.LevelNo<=t.LevelNo&&(t.lstLevelGroups.length>1&&(t.oRow.IsExpanded=!0,t.oRow.IsExpanded&&(t.oRow.Type=a.f.Detail),t.oRow.IsGroup?t.lstLevelGroups.length>2&&(t.oRow.Parent=t.lstLevelGroups[t.lstLevelGroups.length-2].Row):t.oRow.Parent=t.lstLevelGroups[t.lstLevelGroups.length-1].Row,null==t.oRow.Parent||t.oRow.Parent.IsExpanded&&t.oRow.Parent.Visible||(t.oRow.Visible=!1)),D||(t.ViewModel.addRow(t.oRow),t.ShowDetailReport&&t.DetailRows.ContainsKey(t.oRow.NodeID)&&(t.oRow.Type=a.f.Group,t.oRow.LevelNo=0,t.AddDetailRows(t.oRow)),!t.ShowDetailReport&&t.DetailRows.ContainsKey(t.oRow.NodeID)&&t.AddNodeDetailRows(t.oRow)))}}},_=0;_<e.length;_++)T(_);this.UpdateTreeTotals(0)}},{key:"AddNodeDetailRows",value:function(e){for(var t,o,s,l=0,n=new a.d(this.oColumns.length,this.ViewModel.RowHeight),r=0;r<this.DetailRows[e.NodeID].length;r++){o=this.DetailRows[e.NodeID][r],(n=new a.d(this.oColumns.length,this.ViewModel.RowHeight)).LevelNo=e.LevelNo,n.DataRow=o,this.dtAccountColumns.Contains("Positive")||(this.dtAccountColumns.push("Positive"),this.dtAccountColumns.push("Negative")),o.Positive=e.DataRow.Positive,o.Negative=e.DataRow.Negative;for(var h=0;h<this.oColumns.length;h++)t=this.oColumns[h],!this.ShowDetailReport&&h<this.LevelColsCnt&&(n.Cells[h].IsNormal=!1,n.Cells[h].level=n.LevelNo),this.dtAccountColumns.Contains(this.oColumns[h].ID)&&(i.e.IsEmpty(this.oColumns[h].Formula)||this.ViewModel.CalculateFormula_2(this.oColumns[h],o),""!=(s=i.e.String(o[t.ID]))&&("FLOAT"==t.ColumnType&&i.e.IsNum(s)?(l=i.e.Double(s),this.FormatData(l,n,h)):this.ViewModel.SetCellValue(s,t.DataFormat,t.ColumnType,n.Cells[h])));n.LevelNo<=this.LevelNo&&(this.lstLevelGroups.length>1&&(n.IsExpanded=!0,n.IsExpanded&&(n.Type=a.f.Detail),n.IsGroup?this.lstLevelGroups.length>2&&(n.Parent=this.lstLevelGroups[this.lstLevelGroups.length-2].Row):n.Parent=this.lstLevelGroups[this.lstLevelGroups.length-1].Row,null==n.Parent||n.Parent.IsExpanded&&n.Parent.Visible||(n.Visible=!1)),this.ViewModel.addRow(n))}}},{key:"AddDetailRows",value:function(e){for(var t,o,s,l=0,n=0;n<this.DetailRows[e.NodeID].length;n++){o=this.DetailRows[e.NodeID][n],this.oRow=new a.d(this.oColumns.length,this.ViewModel.RowHeight),this.oRow.LevelNo=1,this.oRow.DataRow=e.DataRow;for(var r=0;r<this.oColumns.length;r++)t=this.oColumns[r],Object(u.isNullOrUndefined)(o[t.ID])||""!=(s=o[t.ID].toString())&&("FLOAT"==t.ColumnType&&i.e.IsNum(s)?(l=i.e.Double(s),this.FormatData(l,this.oRow,r)):this.ViewModel.SetCellValue(s,t.DataFormat,t.ColumnType,this.oRow.Cells[r]));this.ViewModel.addRow(this.oRow)}this.oRow=new a.d(this.oColumns.length,this.ViewModel.RowHeight),this.oRow.Type=a.f.SubTotal,this.oRow.DataRow=e.DataRow,this.oRow.Cells[0].IsNormal=!1,this.oRow.LevelNo=1,this.oRow.Cells[0].Text=this.ViewModel.lstGroup[0].SubTotalPrefix[0],this.oRow.Cells[0].CellAppearance=this.ViewModel.lstGroup[0].GroupAppearance.Clone(),this.oRow.Cells[0].CellAppearance.BackColor="#FFFFFF",this.oRow.Cells[0].ColSpan=this.LevelColsCnt;for(var h=0;h<this.oColumns.length;h++)t=this.oColumns[h],Object(u.isNullOrUndefined)(e.DataRow[t.ID])||""!=(s=e.DataRow[t.ID].toString())&&"FLOAT"==t.ColumnType&&i.e.IsNum(s)&&(l=i.e.Double(s),this.oRow.Cells[h].DataFormat=this.ViewModel.lstGroup[0].SubTotalFormat,this.oRow.Cells[h].CellAppearance=this.ViewModel.lstGroup[0].SubTotalAppearance_Data,this.oRow.Cells[h].Border=this.ViewModel.lstGroup[0].SubTotalBorder,this.oRow.Cells[h].IsNormal=!1,this.FormatData(l,this.oRow,h));this.ViewModel.addRow(this.oRow)}},{key:"UpdateTreeTotals",value:function(e){for(var t=this,o=function(o){if(o>0)for(var s=0;s<t.lstLevelGroups[o].Total.length;s++)t.lstLevelGroups[o-1].Total[s]+=t.lstLevelGroups[o].Total[s],null!=t.lstLevelGroups[o].Row.DataRow&&"FLOAT"==t.oColumns[s].ColumnType&&(t.lstLevelGroups[o].Row.DataRow[t.oColumns[s].ID]=t.lstLevelGroups[o].Total[s]);if(!t.lstLevelGroups[o].TotalAtEnd&&t.lstLevelGroups[o].ShowTotal)for(var l=0;l<t.oColumns.length;l++)if("FLOAT"==t.oColumns[l].ColumnType){if(t.ShowBudgetVariancePercent&&!i.e.IsEmpty(t.oColumns[l].DataFormat.PercentageOn)){var n=l-t.VariancePercentIndex,r=0;t.lstLevelGroups[o].Total[n-1]>0&&0!=t.lstLevelGroups[o].Total[n-1]&&(r=100*t.lstLevelGroups[o].Total[n+t.VariancePercentIndex]/t.lstLevelGroups[o].Total[n-1]),t.FormatData(r,t.lstLevelGroups[o].Row,n+t.VariancePercentIndex);continue}t.FormatData(t.lstLevelGroups[o].Total[l],t.lstLevelGroups[o].Row,l)}if(e<=t.LevelNo){var h=t.ViewModel.Data.indexOf(t.lstLevelGroups[o].Row);if(h>=0)if(t.lstLevelGroups[o].TotalAtEnd){t.oSubTotal=t.NewReportRow(),t.oSubTotal.Type=a.f.BalanceBF,t.oSubTotal.Parent=t.lstLevelGroups[o].Row.Parent,t.oSubTotal.LevelNo=t.lstLevelGroups[o].Row.LevelNo,t.oSubTotal.DataRow=t.lstLevelGroups[o].Row.DataRow,t.oSubTotal.Cells[0].IsNormal=!1,t.oSubTotal.IsGroup=!0,t.oSubTotal.Visible=t.lstLevelGroups[o].Row.Visible,t.oSubTotal.Cells[0].level=t.lstLevelGroups[o].Row.LevelNo,t.oSubTotal.Cells[0].Text=t.lstLevelGroups[o].TotalCaption,t.oSubTotal.Cells[0].CellAppearance=t.ViewModel.ReportColumns[0].DataAppearance.Clone(),t.oSubTotal.Cells[0].CellAppearance.IsBold=!0,t.oSubTotal.Cells[0].CellAppearance.Alignment=t.oColumns[0].DataAppearance.Alignment;for(var u=0;u<t.oColumns.length;u++)"FLOAT"==t.oColumns[u].ColumnType&&(t.oSubTotal.Cells[u].IsNormal=!1,t.oSubTotal.Cells[u].CellAppearance=t.ViewModel.ReportColumns[u].DataAppearance.Clone(),t.oSubTotal.Cells[u].CellAppearance.IsBold=!0,t.oSubTotal.Cells[u].CellAppearance.Alignment=t.oColumns[u].DataAppearance.Alignment,t.oSubTotal.Cells[u].Border=t.ViewModel.TreeTotalBorder,0!=t.lstLevelGroups[o].TotalBorder&&(t.oSubTotal.Cells[u].Border=t.lstLevelGroups[o].TotalBorder),t.FormatData(t.lstLevelGroups[o].Total[u],t.oSubTotal,u)),(t.lstLevelGroups[o].TotalBackground||t.ViewModel.TreeTotalBorder<0||t.lstLevelGroups[o].TotalBorder<0)&&(null==t.oSubTotal.Cells[u].CellAppearance&&(t.oSubTotal.Cells[u].IsNormal=!1,t.oSubTotal.Cells[u].CellAppearance=t.oColumns[u].DataAppearance.Clone()),t.lstLevelGroups[o].TotalBackground&&(t.oSubTotal.Cells[u].CellAppearance.BackColor="#FFD8D8D8"),t.ViewModel.TreeTotalBorder<0&&t.oSubTotal.Cells.forEach((function(e){e.Border=t.ViewModel.TreeTotalBorder})),t.lstLevelGroups[o].TotalBorder<0&&t.oSubTotal.Cells.forEach((function(e){e.Border=t.lstLevelGroups[o].TotalBorder})));if(t.ShowBudgetVariancePercent){var c=0;t.lstLevelGroups[o].Total[t.BalIndex-1]>0&&0!=t.lstLevelGroups[o].Total[t.BalIndex-1]&&(c=100*t.lstLevelGroups[o].Total[t.BalIndex+t.VariancePercentIndex]/t.lstLevelGroups[o].Total[t.BalIndex-1]),t.FormatData(c,t.oSubTotal,t.BalIndex+t.VariancePercentIndex)}t.GrdRow++,t.ViewModel.addRow(t.oSubTotal)}else t.ViewModel.Data.Remove(t.lstLevelGroups[o].Row),t.ViewModel.Data.Insert(h,t.lstLevelGroups[o].Row)}t.lstLevelGroups.RemoveAt(o)},s=this.lstLevelGroups.length-1;s>e;s--)o(s)}},{key:"GetBudgetAmount",value:function(e,t,o){var s,l=0,n=t;return e.forEach((function(e){for(n=t;n<=o;)s=n.ToString("MMMyyyy"),l+=i.e.Double(e[s]),n=n.AddMonths(1)})),l}},{key:"GetBudgetAmount_dv",value:function(e){var t=0;return e.forEach((function(e){t+=parseFloat(e.AnnualAmount)})),t}},{key:"FormatData",value:function(e,t,o){if(null!=t.DataRow){var s=this.oColumns[o].DataFormat;s.ShowDefaultSign=-1,s.NegativeNumber=0,e<0?(this.formatNo=t.DataRow.Negative.toString(),s.NegativeNumber="-"==this.formatNo?0:"+"==this.formatNo?8:"Cr"==this.formatNo?4:"Dr"==this.formatNo?5:"(123)"==this.formatNo?2:12):(this.formatNo=t.DataRow.Positive.toString(),"-"==this.formatNo?(s.NegativeNumber=8,s.ShowDefaultSign=0):"+"==this.formatNo?(s.ShowDefaultSign=0,s.NegativeNumber=6):s.NegativeNumber="Cr"==this.formatNo?4:"Dr"==this.formatNo?5:"(123)"==this.formatNo?2:0),this.ViewModel.SetCellValue(e,s,this.oColumns[o].ColumnType,t.Cells[o])}}}]),o}(n.b)},OHLA:function(e,t,o){"use strict";o.d(t,"a",(function(){return g}));var s=o("Do2H"),i=o("Lp6j"),l=o("eQJW"),n=o("4HhE"),a=o("0/4Q"),r=o("PDNK"),h=o("wlFP"),u=o("n56n"),c=o("6z9j"),D=o("EQd/"),d=o("c9yc"),C=o("JIg3"),p=o("AGpa"),T=o("XPEG"),_=o("w8Sz"),m=o("dH+5"),I=o("8iaB"),R=o("vTM8"),S=o("7JXL"),A=o("MCLT"),M=function(e){_inherits(o,e);var t=_createSuper(o);function o(){var e;return _classCallCheck(this,o),(e=t.call(this)).IsHorizontalOrientation=!1,e.CheckBox=new r.a,e.ComboBox=new a.e(0),e}return o}(n.c),g=function(e){_inherits(o,e);var t=_createSuper(o);function o(e){var n;_classCallCheck(this,o),(n=t.call(this)).DefaultTreeSelectedNodes=null,n.Locations=new a.b,n.LocationWhere="",n.TreeID=0,n.TreeCCID=0,n.StockDimensionID=0,n.IsZeroSelected=!1,n.IsOneSelected=!1,n.IsGroupExists=!1,n.IsUserAllLocationsAssigned=!1,n.TreeVisibility=!1,n.DefaultVisible=!1,n.ParentReportDateFilter=null,n.MrpFromDate=new C.a(0),n.MrpToDate=new C.a(0),n.FromDate=new C.a(0),n.ToDate=new C.a(0),n.IsFirstLoaded=!1,n.FinalReportsShowVisibility=!1,n.FinalReportsShowEnable=!0,n.HideTagWiseBudget=!1,n.ButtonHeaderVis=!0,n.FCVisibility=!1,n.CompanyCurrency=new r.a,n.FCGUID=null,n.TagWiseGUID=null,n.TblProperties={Rows:new R.c},n.LockCheckedChanged=!1,n.ClassName="StaticReportFilterViewModel",n.MrpFromDate.Visible=!1,n.MrpToDate.Visible=!1;var u=i.e.String(e.Reportds.Tables[0][0].TreeXML);if(n.TreeCCID=n.TreeID=0,n.StaticTreeFilter="",n.Locations=new a.b,n.Locations.Height=100,n.ViewModel=e,n.CostCenterFilters=[],n.DefaultVisible=!!s.a.SessionManager.IsActionAssigned(200,"Set Defaults"),u.length>0){var c=new i.f;c.LoadXml(u);var D=c.SelectSingleNode("Tree/CCID");n.TreeCCID=null!=D?parseInt(D.innerHTML):0,D=c.SelectSingleNode("Tree/TreeID"),n.TreeID=null!=D?parseInt(D.innerHTML):0,D=c.SelectSingleNode("Tree/Filter"),n.StaticTreeFilter=null!=D?D.innerHTML:""}if(n.TreeCCID>0){if(e.HideCostCenterTree||(n.TreeVisibility=!0),n.CostCenters=new a.e(0),n.CostCenters.Label=s.a.GetResource("Reports_SelectCostCenter"),n.CostCenters.LblWidth="160",n.CostCenters.SelectionChangedCommand.Subscribe(_assertThisInitialized(n),"OnCostCenterChange"),e.FieldsDialog&&e.FieldsDialog.ReportFilterCostCenterList){var d,p=e.FieldsDialog.ReportFilterCostCenterList;if(e.Preferences.ContainsKey("TreeDimensionsFilter")){var T=[],_=new i.f;_.LoadXml("<XML>"+e.Preferences.TreeDimensionsFilter+"</XML>");for(var m=function(e){var t=_.DocumentElement.children[e],o=p.filter((function(e){return e.FeatureID==t.attributes.CCID.value}));if(o.length>0){var s={};s.Name=o[0].Name,s.FeatureID=o[0].FeatureID,null!=t.attributes.Mandatory&&(s.Mandatory=t.attributes.Mandatory.value),T.push(s)}},I=0;I<_.DocumentElement.children.length;I++)m(I);p=T}if(p.forEach((function(t){d=null;var o=parseInt(t.FeatureID);73==e.StaticReportType||e.StaticReportType>=209&&e.StaticReportType<=215?92==o||93==o||o>5e4?d=a.d.ComboBoxItems_2(s.a.GetResource(t.Name.toString()),t.FeatureID.toString()):94!=o||73!=e.StaticReportType&&209!=e.StaticReportType&&210!=e.StaticReportType&&211!=e.StaticReportType||(d=a.d.ComboBoxItems_2(s.a.GetResource(t.Name.toString()),t.FeatureID.toString())):(2==o||3==o||113==o||o==n.TreeCCID||o>5e4)&&(d=a.d.ComboBoxItems_2(s.a.GetResource(t.Name.toString()),t.FeatureID.toString())),143==e.StaticReportType&&61==o?d=a.d.ComboBoxItems_2(s.a.GetResource(t.Name.toString()),t.FeatureID.toString()):16!=o||81!=e.StaticReportType&&158!=e.StaticReportType?(300==o&&(e.StaticReportType>=9&&e.StaticReportType<=11||e.StaticReportType>=13&&e.StaticReportType<=16||156==e.StaticReportType||171==e.StaticReportType||198==e.StaticReportType||200==e.StaticReportType)||503==o&&e.StaticReportType>=13&&e.StaticReportType<=16||7==o&&150==e.StaticReportType)&&(d=a.d.ComboBoxItems_2(s.a.GetResource(t.Name.toString()),t.FeatureID.toString())):d=a.d.ComboBoxItems_2(s.a.GetResource(t.Name.toString()),t.FeatureID.toString()),null!=d&&(e.Preferences.ContainsKey("TreeDimensionsFilter")&&(d.Aliasname=i.e.String(t.Mandatory)),n.CostCenters.Items.push(d))})),e.Preferences.ContainsKey("ShowLookups")&&e.Preferences.ShowLookups.length>0){var S=new i.f;S.LoadXml("<XML>"+e.Preferences.ShowLookups+"</XML>");for(var A=0;A<S.DocumentElement.children.length;A++){var g=S.DocumentElement.children[A];n.CostCenters.Items.push(a.d.ComboBoxItems_3(g.attributes.Name.value,"44",g.attributes.ID.value))}}}n.CostCenters.Visible=!1,(e.StaticReportType>=1&&e.StaticReportType<=16||[-2,73,81,82,83,84,86,89,90,97,98,99,100,111,115,127,140,143,150,155,156,157,158,160,168,171,190,195,198,200,203,204,209,210,211,212,213,214,215,286,288,289,306,307].Contains(e.StaticReportType))&&(n.CostCenters.Visible=!0),n.LoadTreeData()}else n.TreeVisibility=!1;if(168==e.StaticReportType){var w=s.a.report.DataSet("RPT002","").Tables[0];null!=w&&w.length>0&&e.Preferences.push("PropertyLinkDimension",w[0].value.toString())}if(n.DefaultProperties=[],n.SetDateFilters(),e.StaticReportType>=4&&e.StaticReportType<=8||14==e.StaticReportType||15==e.StaticReportType||97==e.StaticReportType||98==e.StaticReportType&&n.FromDate.Visible)if(n.FinalReportsShowVisibility=!0,n.TagWiseGUID=i.e.NewGuid(),n.FinalReportsShowNone=new r.a("None",0),n.FinalReportsShowNone.Label=s.a.GetResource("DocumentDesigner_None"),n.FinalReportsShowNone.IsChecked=!0,n.FinalReportsShowNone.GroupName="FinalReportsShow",n.FinalReportsShowMonthWise=new r.a("MonthWise",1),n.FinalReportsShowMonthWise.Label=s.a.GetResource("Reports_LblMonthWise"),n.FinalReportsShowMonthWise.Dependantinuse=!1,n.FinalReportsShowMonthWise.GroupName="FinalReportsShow",5!=e.StaticReportType&&6!=e.StaticReportType&&8!=e.StaticReportType||(n.FinalReportsShowMonthWise.Dependantinuse=!0,n.FinalReportsShowMonthWise.IsReadOnly=!1,n.FinalReportsShowMonthWise.Enable=!1,n.FinalReportsShowMonthWise.IsColumnUserDefined=!1),n.FinalReportsShowQtrWise=new r.a("QtrWise",1),n.FinalReportsShowQtrWise.Label=s.a.GetResource("Reports_LblQuarterWise"),n.FinalReportsShowQtrWise.Dependantinuse=!1,n.FinalReportsShowQtrWise.GroupName="FinalReportsShow",5==e.StaticReportType||6==e.StaticReportType||8==e.StaticReportType?(n.FinalReportsShowQtrWise.Dependantinuse=!0,n.FinalReportsShowQtrWise.IsReadOnly=!1,n.FinalReportsShowQtrWise.Enable=!1,n.FinalReportsShowQtrWise.IsColumnUserDefined=!1):98==e.StaticReportType&&n.FromDate.Visible||4==e.StaticReportType||7==e.StaticReportType||(n.FinalReportsShowQtrWise.Visible=!1),n.FinalReportsShowHYWise=new r.a("HYWise",1),n.FinalReportsShowHYWise.Label=s.a.GetResource("Reports_LblHalfYearWise"),n.FinalReportsShowHYWise.Dependantinuse=!1,n.FinalReportsShowHYWise.GroupName="FinalReportsShow",8==e.StaticReportType?(n.FinalReportsShowHYWise.Dependantinuse=!0,n.FinalReportsShowHYWise.IsReadOnly=!1,n.FinalReportsShowHYWise.Enable=!1,n.FinalReportsShowHYWise.IsColumnUserDefined=!1):n.FinalReportsShowHYWise.Visible=!1,n.FinalReportsShowYearWise=new r.a("YearWise",1),n.FinalReportsShowYearWise.Label=s.a.GetResource("Reports_LblYearWise"),n.FinalReportsShowYearWise.Dependantinuse=!1,n.FinalReportsShowYearWise.GroupName="FinalReportsShow",5!=e.StaticReportType&&6!=e.StaticReportType&&8!=e.StaticReportType||(n.FinalReportsShowYearWise.Dependantinuse=!0,n.FinalReportsShowYearWise.IsReadOnly=!1,n.FinalReportsShowYearWise.Enable=!1,n.FinalReportsShowYearWise.IsColumnUserDefined=!1),n.FinalReportsShowTagWise=new M,n.FinalReportsShowTagWise.GroupName="FinalReportsShow",n.FinalReportsShowTagWise.ComboBox.SysTableName="0",14==e.StaticReportType||98==e.StaticReportType&&n.FromDate.Visible?n.FinalReportsShowTagWise.Visible=!1:(n.FinalReportsShowTagWise.CheckBox.Label=s.a.GetResource("Reports_LblTagWise"),n.LoadDropDownData(n.FinalReportsShowTagWise.ComboBox,"TagWise")),4==e.StaticReportType&&(n.FinalReportsShowYearWise.Visible=!1),15==e.StaticReportType&&(n.FinalReportsShowNone.CheckedChangedCommand.Subscribe(_assertThisInitialized(n),"OnRadioChecked"),n.FinalReportsShowMonthWise.CheckedChangedCommand.Subscribe(_assertThisInitialized(n),"OnRadioChecked"),n.FinalReportsShowYearWise.CheckedChangedCommand.Subscribe(_assertThisInitialized(n),"OnRadioChecked")),n.FinalReportsShow={Items:[]},n.FinalReportsShow.Items.push(n.FinalReportsShowNone),n.FinalReportsShow.Items.push(n.FinalReportsShowHYWise),n.FinalReportsShow.Items.push(n.FinalReportsShowMonthWise),n.FinalReportsShow.Items.push(n.FinalReportsShowQtrWise),n.FinalReportsShow.Items.push(n.FinalReportsShowTagWise.CheckBox),n.FinalReportsShow.Items.push(n.FinalReportsShowYearWise),n.FinalReportsShowNone.Group=n.FinalReportsShow,n.FinalReportsShowHYWise.Group=n.FinalReportsShow,n.FinalReportsShowMonthWise.Group=n.FinalReportsShow,n.FinalReportsShowQtrWise.Group=n.FinalReportsShow,n.FinalReportsShowTagWise.CheckBox.Group=n.FinalReportsShow,n.FinalReportsShowYearWise.Group=n.FinalReportsShow,n.CurrentBudget=new a.e(0),8==e.StaticReportType||97==e.StaticReportType&&"TRUE"!=s.a.SessionManager.Preferences.WEFINReportTemplate.toString().toUpperCase()){n.CurrentBudget.Visible=!0,n.CurrentBudget.DBColumnName="CurrentBudgets",n.CurrentBudget.Label=s.a.GetResource("Reports_CurrentYear"),n.PreviousBudget=new a.e(0),n.PreviousBudget.DBColumnName="PreviousBudgets",n.PreviousBudget.Label=s.a.GetResource("Reports_PreviousYear");var f=s.a.report.DataSet("RPT003","");n.CurrentBudget.Items.push(a.d.ComboBoxItems_2(s.a.GetResource("Reports_None"),"0")),n.PreviousBudget.Items.push(a.d.ComboBoxItems_2(s.a.GetResource("Reports_None"),"0")),f.Tables[0].forEach((function(e){n.CurrentBudget.Items.push(a.d.ComboBoxItems_2(e.BudgetName.toString(),e.BudgetDefID.toString())),n.PreviousBudget.Items.push(a.d.ComboBoxItems_2(e.BudgetName.toString(),e.BudgetDefID.toString()))})),n.CurrentBudget.SelectedItem=n.CurrentBudget.Items[0],n.CurrentBudget.SelectedValue=n.CurrentBudget.Items[0].Value,n.PreviousBudget.SelectedItem=n.PreviousBudget.Items[0],n.PreviousBudget.SelectedValue=n.PreviousBudget.Items[0].Value,n.ShowActualBudget=new h.a(0),n.ShowVariance=new h.a(0),n.ShowVariancePercent=new h.a(0),n.ShowTotalBudget=new h.a(0),n.ShowActualBudget.Label=s.a.GetResource("Reports_ShowActualBudget"),n.ShowVariance.Label=s.a.GetResource("Reports_ShowVaraince"),n.ShowVariancePercent.Label=s.a.GetResource("Reports_ShowVaraince%"),n.ShowTotalBudget.Label=s.a.GetResource("Reports_ShowTotalBudget")}else n.CurrentBudget.Visible=!1;else n.FinalReportsShowVisibility=!1;n.Locations.CheckedChangedCommand.Subscribe(_assertThisInitialized(n),"OnCheckedChanged"),n.Locations.Row=15,n.Locations.Visible=!1,n.Locations.Label="Location",n.Locations.Width="320",n.Locations.ColumnSpan=2,n.Locations.DBColumnID=50002,n.Locations.DBColumnName="DEFAULT_LOCATION",(e.StaticReportType>=13&&e.StaticReportType<=16||81==e.StaticReportType||82==e.StaticReportType||83==e.StaticReportType||84==e.StaticReportType||111==e.StaticReportType||114==e.StaticReportType||115==e.StaticReportType||158==e.StaticReportType||159==e.StaticReportType||195==e.StaticReportType)&&s.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&i.e.IsNum(s.a.SessionManager.Preferences["Maintain Dimensionwise stock"])&&(n.StockDimensionID=i.e.Int(s.a.SessionManager.Preferences["Maintain Dimensionwise stock"]),n.StockDimensionID>0&&(n.Locations.DBColumnID=n.StockDimensionID));var E=!1;if("True"==s.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==s.a.SessionManager.Preferences["LW Reports"]&&(E=!0),e.Preferences.ContainsKey("DontApplyLocationFilter")&&"1"==e.Preferences.DontApplyLocationFilter&&(n.StockDimensionID=0,E=!1),E&&50002==n.Locations.DBColumnID){n.StockDimensionID=50002;(e.StaticReportType>=1&&e.StaticReportType<=16||[-2,62,63,65,72,73,81,82,83,84,90,91,92,93,98,99,100,111,114,115,116,117,118,120,129,130,131,133,134,135,136,137,138,139,140,145,150,152,153,155,157,158,159,198,200].Contains(e.StaticReportType))&&(n.Locations.Visible=!0);var P=[];P.push(50002),P.push(s.a.SessionManager.LanguageID);var y=s.a.admin.getLocationRoles(P);n.Locations.Items.push(a.c.CheckedListBoxItem_4("All","All","DEFAULT_LOCATION")),y.Tables[0].SortBy(["Name"]);for(var O=y.Tables[0],b=s.a.SessionManager.LocationWhere.split(","),N=0;N<O.length;N++)b.Contains(O[N].NodeID.toString())&&"86"!=O[N].StatusID.toString()&&(Object(l.j)(O[N].IsGroup)||(n.Locations.Items.push(a.c.CheckedListBoxItem_4(O[N].Name.toString(),O[N].NodeID.toString(),"DEFAULT_LOCATION")),parseInt(n.Locations.Items[n.Locations.Items.length-1].Value)==s.a.SessionManager.LocationID&&(n.Locations.Items[n.Locations.Items.length-1].IsChecked=!0)));var V=s.a.report.DataSet("RPT004",n.Locations.DBColumnID.toString(),s.a.SessionManager.LanguageID);if(n.Locations.Label=V.Tables[0][0].Name.toString(),0==s.a.SessionManager.LocationID)for(var v=0;v<n.Locations.Items.length;v++)n.Locations.Items[v].IsChecked=!0}else if(n.StockDimensionID>0){n.Locations.Visible=!0;var L=!1;if("1"!=s.a.SessionManager.UserID&&"1"!=s.a.SessionManager.RoleID)for(var B=s.a.SessionManager.Preferences["Dimension List"].split(","),F=0;F<B.length;F++)if(B[F]==n.StockDimensionID.toString()){L=!0;break}var G=s.a.report.DataSet("RPT005",n.StockDimensionID.toString(),L?"1":"0",s.a.SessionManager.UserID);null!=G&&G.Tables.length>1&&(n.Locations.Items.push(a.c.CheckedListBoxItem_4("All","All","DEFAULT_LOCATION")),n.Locations.Items[0].IsChecked=!0,G.Tables[1].sort((function(e,t){return e.Name>t.Name?1:-1})),G.Tables[1].forEach((function(e){n.Locations.Items.push(a.c.CheckedListBoxItem_4(e.Name.toString(),e.NodeID.toString(),"DEFAULT_LOCATION")),n.Locations.Items[n.Locations.Items.length-1].IsChecked=!0})),n.Locations.Label=G.Tables[0][0].Name.toString(),L&&G.Tables.length>2&&0==parseInt(G.Tables[2][0].CNT)&&(n.IsUserAllLocationsAssigned=!0))}if(n.Locations.Visible&&e.Preferences.ContainsKey("SelectAllLocations")&&"1"==e.Preferences.SelectAllLocations)for(var x=0;x<n.Locations.Items.length;x++)n.Locations.Items[x].IsChecked=!0;return n.DefaultProperties.push(n.Locations),n.LoadProperties(),n}return _createClass(o,[{key:"GetSeqNosList",value:function(){var e=this;if(this.IsZeroSelected=this.IsOneSelected=!1,null==this.DefaultTreeSelectedNodes)return this.IsZeroSelected=!0,"0";var t="";return this.DefaultTreeSelectedNodes.forEach((function(e){t+=e.Id+","})),t.length>0?(t=t.substr(0,t.length-1),this.DefaultTreeSelectedNodes.filter((function(e){return 1==e.Id})).length>0&&(this.IsOneSelected=!0)):this.CostCenterFilters.find((function(t){return t.SelectedNodes==e.DefaultTreeSelectedNodes&&!t.DeleteButtonVisibility}))?t+="-12345":(this.IsZeroSelected=!0,t+=0),t}},{key:"GetSeqNosListWithRoots",value:function(){var e=this;if(this.IsZeroSelected=this.IsOneSelected=this.IsGroupExists=!1,null==this.DefaultTreeSelectedNodes)return this.IsZeroSelected=!0,"0";this.IsDynamicTree=!1;var t="";return""!=s.a.SessionManager.Preferences.DynamicTrees&&s.a.SessionManager.Preferences.DynamicTrees.split(",").Contains(this.TreeCCID.toString())&&(this.IsDynamicTree=!0),this.DefaultTreeSelectedNodes.forEach(this.IsDynamicTree?function(o){o.IsGroup&&(e.IsGroupExists=!0),t+=o.Id+","}:function(o){null!=o.Parent&&o.Parent.IsSelected?e.IsGroupExists=!0:(o.IsGroup&&(e.IsGroupExists=!0),t+=o.Id+",")}),t.length>0?(t=t.substr(0,t.length-1),this.DefaultTreeSelectedNodes.filter((function(e){return 1==e.Id})).length>0&&(this.IsOneSelected=!0)):(this.IsZeroSelected=!0,t+=0),t.toString()}},{key:"SetDateFilters",value:function(){this.FromDate.Date=this.ViewModel.ReportViewType==m.e.General?s.a.SessionManager.ReportsFromDate:"FinancialYear"==s.a.SessionManager.Preferences.ReportDate?s.a.SessionManager.FinancialYearStartDate:s.a.SessionManager.AccountingDate;for(var e=this.ViewModel.ReportDoc.SelectNodes("PactRevenURpts/Filters/PreDataFetch/FieldFilter/FilterDef"),t=0;t<e.length;t++){var o=e[t];if(23145==parseInt(i.f.SelectSingleNodeText(o,"CCColID"))){var n=i.f.SelectSingleNode(o,"DefaultFromVal");null!=n&&(this.FromDate.Date=T.a.GetDateFromKeyWord(n.innerHTML)),null!=(n=i.f.SelectSingleNode(o,"DefaultToVal"))&&(this.ToDate.Date=T.a.GetDateFromKeyWord(n.innerHTML))}}if(this.FromDate.Label=s.a.GetResource("Reports_LblFromDate"),this.ToDate.Label=s.a.GetResource("Reports_LblToDate"),this.MrpDateRanges=this.DateRanges=_.a.getDateRanges(),this.DateRanges.SelectionChangedCommand.Subscribe(this,"OnDateRangesSelectionChanged"),this.MrpDateRanges.SelectionChangedCommand.Subscribe(this,"OnDateRangesSelectionChanged"),this.MrpDateRanges.Visible=!1,this.ViewModel.StaticReportType>=9&&this.ViewModel.StaticReportType<=12||this.ViewModel.StaticReportType>=81&&this.ViewModel.StaticReportType<=84||16==this.ViewModel.StaticReportType||71==this.ViewModel.StaticReportType||31==this.ViewModel.StaticReportType||87==this.ViewModel.StaticReportType||91==this.ViewModel.StaticReportType||98==this.ViewModel.StaticReportType||127==this.ViewModel.StaticReportType||148==this.ViewModel.StaticReportType||159==this.ViewModel.StaticReportType||168==this.ViewModel.StaticReportType||140==this.ViewModel.StaticReportType||171==this.ViewModel.StaticReportType||195==this.ViewModel.StaticReportType||203==this.ViewModel.StaticReportType||204==this.ViewModel.StaticReportType||212==this.ViewModel.StaticReportType||288==this.ViewModel.StaticReportType||287==this.ViewModel.StaticReportType||303==this.ViewModel.StaticReportType)this.FromDate.Visible=!1,this.ToDate.Visible=!0,this.ToDate.Label=s.a.GetResource("AsOn"),11==this.ViewModel.StaticReportType||12==this.ViewModel.StaticReportType?(this.ViewModel.Preferences.ContainsKey("ShowMonthWiseFromDatePicker")&&"1"==this.ViewModel.Preferences.ShowMonthWiseFromDatePicker&&(this.ToDate.Label=s.a.GetResource("Reports_LblFromDate")),12==this.ViewModel.StaticReportType&&this.ViewModel.ReportColumns.find((function(e){return"PeriodSale"==e.ID}))&&(this.FromDate.Visible=!0)):171==this.ViewModel.StaticReportType?this.ViewModel.Preferences.ContainsKey("ToDateVal")||(this.ToDate.Visible=!1):288==this.ViewModel.StaticReportType||289==this.ViewModel.StaticReportType?(this.ToDate.CustomFormat="MMM-yyyy",this.ToDate.Label="Payroll Month"):190==this.ViewModel.StaticReportType?this.ToDate.Label="Day":212==this.ViewModel.StaticReportType&&(this.ToDate.Label="Date"),this.ViewModel.Preferences.ContainsKey("AllowFromDateFilter")&&"1"==this.ViewModel.Preferences.AllowFromDateFilter&&(this.FromDate.Visible=!0);else if(15==this.ViewModel.StaticReportType)this.ViewModel.Preferences.ContainsKey("SalesDocs")&&this.ViewModel.Preferences.SalesDocs.length>0?(this.FromDate.Visible=!0,this.ToDate.Visible=!0):(this.FromDate.Visible=!1,this.ToDate.Visible=!0,this.ToDate.Label=s.a.GetResource("AsOn"));else if(89==this.ViewModel.StaticReportType)this.FromDate.Date=Date.Today(),this.ToDate.Date=Date.Today();else if(146==this.ViewModel.StaticReportType)this.FromDate.Date=Date.Today().AddMonths(-1),this.ToDate.Date=Date.Today();else if(149==this.ViewModel.StaticReportType)this.FromDate.Date=Date.Today().AddDays(-7),this.ToDate.Date=Date.Today();else if(65==this.ViewModel.StaticReportType||111==this.ViewModel.StaticReportType||120==this.ViewModel.StaticReportType||196==this.ViewModel.StaticReportType||202==this.ViewModel.StaticReportType||210==this.ViewModel.StaticReportType||214==this.ViewModel.StaticReportType||215==this.ViewModel.StaticReportType||287==this.ViewModel.StaticReportType||294==this.ViewModel.StaticReportType||303==this.ViewModel.StaticReportType)this.FromDate.Visible=!1,this.ToDate.Visible=!1;else if(114==this.ViewModel.StaticReportType&&Object(l.j)(s.a.SessionManager.Preferences.OpenCompany)){var a=s.a.report.DataSet("RPT006","");null!=a&&a.length>0&&a.Columns.Contains("ToDate")&&a[0].ToDate&&(this.FromDate.Date=new Date(a[0].ToDate).AddDays(1),this.FromDate.Date>Date.Today()&&(this.FromDate.Date=this.FromDate.Date.AddYears(-1)))}if(this.DateRanges.Visible=!(!this.FromDate.Visible||!this.ToDate.Visible),this.ToDate.Visible&&this.ViewModel.Preferences.ContainsKey("ToDateVal")){var r=new i.f;r.LoadXml("<XML>"+this.ViewModel.Preferences.ToDateVal+"</XML>");var h=r.SelectSingleNodeText("XML/Cond");if("PAST"==h||"FUTURE"==h){var u=i.e.Int(r.SelectSingleNodeText("XML/Days"));"PAST"==h&&(u=-u),this.ToDate.Date=Date.Today().AddDays(u)}else this.ToDate.Date=T.a.GetDateFromKeyWord(h)}if(this.FromDate.Visible&&this.ViewModel.Preferences.ContainsKey("FromDateVal")){var c=new i.f;c.LoadXml("<XML>"+this.ViewModel.Preferences.FromDateVal+"</XML>");var D=c.SelectSingleNodeText("XML/Cond");this.FromDate.Date=T.a.GetDateFromKeyWord(D)}this.FromDate.Visible&&this.ViewModel.Preferences.ContainsKey("ShowDateMonthYear")&&(this.FromDate.ShowMonthYear=!0),this.ToDate.Visible&&this.ViewModel.Preferences.ContainsKey("ShowDateMonthYear")&&(this.ToDate.IsFromDate=!1,this.ToDate.ShowMonthYear=!0),this.ToDate_PropertyChanged(null,null)}},{key:"LoadTreeData",value:function(){var e=this,t=null,o=null;this.tree=[];var l,n=this.ViewModel.ReportDoc.SelectSingleNode("PactRevenURpts/Filters/PreDataFetch/TreeFilter"),a=!1;if(i.f.SelectNodes(n,"FilterDef").forEach((function(t){i.f.SelectSingleNodeText(t,"CCID")==e.TreeCCID.toString()&&(a=!0)})),a||this.ViewModel.ReportDoc.AppendChild(n,"<FilterDef><CCID>"+this.TreeCCID+"</CCID><GridViewID>"+this.TreeID+"</GridViewID><DefaultValues></DefaultValues></FilterDef>"),this.ViewModel.ReportViewType!=m.e.Export&&!s.a.SessionManager.IsWinServiceCall){var r=50002;if((this.ViewModel.StaticReportType>=13&&this.ViewModel.StaticReportType<=16||81==this.ViewModel.StaticReportType||82==this.ViewModel.StaticReportType||83==this.ViewModel.StaticReportType||84==this.ViewModel.StaticReportType||111==this.ViewModel.StaticReportType||114==this.ViewModel.StaticReportType||115==this.ViewModel.StaticReportType||158==this.ViewModel.StaticReportType||159==this.ViewModel.StaticReportType||195==this.ViewModel.StaticReportType)&&s.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&i.e.IsNum(s.a.SessionManager.Preferences["Maintain Dimensionwise stock"])&&(this.StockDimensionID=i.e.Int(s.a.SessionManager.Preferences["Maintain Dimensionwise stock"]),this.StockDimensionID>0&&(r=this.StockDimensionID)),50002!=r&&"True"==s.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==s.a.SessionManager.Preferences["LW Reports"]){var h=this.CostCenters.Items.find((function(e){return"50002"==e.Value}));null!=h&&(h.Aliasname="");var u=null;if(i.f.SelectNodes(n,"FilterDef").forEach((function(e){"50002"!=i.f.SelectSingleNode(e,"CCID").innerHTML||(u=e)})),null==u){var c=0==i.f.SelectNodes(n,"FilterDef").length?"1":"0";c="<FilterDef>"+(c=this.ViewModel.Preferences.ContainsKey("SelectAllLocations")||0==s.a.SessionManager.LocationID?"<CCID>50002</CCID><GridViewID>0</GridViewID><IsDefaultCC>"+c+"</IsDefaultCC><DefaultValues>"+s.a.SessionManager.LocationWhere+"</DefaultValues>":"<CCID>50002</CCID><GridViewID>0</GridViewID><IsDefaultCC>"+c+"</IsDefaultCC><DefaultValues>"+s.a.SessionManager.LocationID+"</DefaultValues>")+"</FilterDef>",i.f.AppendChild(n,c)}else{var D=i.f.SelectSingleNode(u,"DefaultValues");if(null!=D)if(this.ViewModel.Preferences.ContainsKey("SelectAllLocations")&&"1"==this.ViewModel.Preferences.SelectAllLocations)D.innerHTML=s.a.SessionManager.LocationWhere;else if(0==D.innerHTML.length)D.innerHTML=0!=s.a.SessionManager.LocationID?s.a.SessionManager.LocationID.toString():s.a.SessionManager.LocationWhere;else{var d=D.innerHTML.split(","),C=s.a.SessionManager.LocationWhere.split(","),p="";d.forEach((function(e){C.Contains(e)&&(p.length>0&&(p+=","),p+=e)})),D.innerHTML=p}}}}if("1"!=s.a.SessionManager.UserID&&"1"!=s.a.SessionManager.RoleID)for(var T=s.a.SessionManager.Preferences.ContainsKey("Dimension List")?s.a.SessionManager.Preferences["Dimension List"].split(","):[],_=this.CostCenters.Items.filter((function(e){return"1"==e.Aliasname})),I=function(t){var o=_[t],l="";if(T.Contains(o.Value)&&parseInt(o.Value)>5e4){var a=s.a.report.IsGroupNode(parseInt(o.Value),0),r=s.a.report.GetDataTable("RPT027",a.TableName,s.a.SessionManager.UserID,o.Value);l="",r.forEach((function(e){l.length>0&&(l+=","),l+=e.NodeID.toString()}))}for(var h=null,u=i.f.SelectNodes(n,"FilterDef"),c=0;c<u.length;c++){var D=u[c];if(i.f.SelectSingleNodeText(D,"CCID")==o.Value){h=D;break}}if(null==h){var d;d="<FilterDef>"+(d=0==i.f.SelectNodes(n,"FilterDef").length?"<CCID>"+o.Value+"</CCID><GridViewID>0</GridViewID><IsDefaultCC>1</IsDefaultCC><DefaultValues>"+l+"</DefaultValues>":"<CCID>"+o.Value+"</CCID><GridViewID>0</GridViewID><IsDefaultCC>0</IsDefaultCC><DefaultValues>"+l+"</DefaultValues>")+"</FilterDef>",e.ViewModel.ReportDoc.AppendChild(n,d)}else{var C=i.f.SelectSingleNode(h,"DefaultValues");null!=C&&0==C.innerHTML.length&&(C.innerHTML=l)}},R=0;R<_.length;R++)I(R);if(s.a.SessionManager.RoleType>0){var A=null,M="2";1==s.a.SessionManager.RoleType?M="50051":s.a.SessionManager.LoginDimension>0&&(M=s.a.SessionManager.LoginDimension.toString());for(var g=i.f.SelectNodes(n,"FilterDef"),w=0;w<g.length;w++){var f=g[w];if(i.f.SelectSingleNodeText(f,"CCID")==M){A=f;break}}if(null==A){var E;E="<FilterDef>"+(E=0==i.f.SelectNodes(n,"FilterDef").length?"<CCID>"+M+"</CCID><GridViewID>0</GridViewID><IsDefaultCC>1</IsDefaultCC><DefaultValues>"+s.a.SessionManager.ESSID+"</DefaultValues>":"<CCID>"+M+"</CCID><GridViewID>0</GridViewID><IsDefaultCC>0</IsDefaultCC><DefaultValues>"+s.a.SessionManager.ESSID+"</DefaultValues>")+"</FilterDef>",this.ViewModel.ReportDoc.AppendChild(n,E)}else{var P=i.f.SelectSingleNode(A,"DefaultValues");null!=P&&(P.innerHTML=s.a.SessionManager.ESSID.toString())}}this.ViewModel.IgnoreTreeLoad=!(this.ViewModel.ReportViewType==m.e.General&&!this.ViewModel.HideCostCenterTree);for(var y=i.f.SelectNodes(n,"FilterDef"),O=function(s){var n=y[s],a=i.f.SelectSingleNodeText(n,"CCID"),r=e.CostCenters.Items.find((function(e){return e.Value==a}));if(!r)return"continue";if(l="44"==a&&null!=i.f.SelectSingleNode(n,"LookupTypeID")?parseInt(i.f.SelectSingleNodeText(n,"LookupTypeID")):0,"44"==r.Value&&r.Parent!=l.toString())return"continue";var h=new S.a(parseInt(a),l.toString(),r.Name,e);h.SetSelectedNodes(n),h.IsVisible||e.CostCenters.Items.Remove(r);var u=null!=i.f.SelectSingleNode(n,"IsDefaultCC")&&"1"==i.f.SelectSingleNodeText(n,"IsDefaultCC");u&&(r.ExchgRate=1,0==e.TreeCCID&&(e.TreeCCID=parseInt(a))),e.TreeCCID==parseInt(a)&&(e.DefaultTreeSelectedNodes=h.SelectedNodes),e.ViewModel.IgnoreTreeLoad||(u&&(e.CostCenters.SelectedValue=a.toString(),e.CostCenters.SelectedItem=r,e.LoadCostCenterTree(parseInt(a),l,0,h.SelectedNodes),e.tree.length>0&&(t=e.tree[0])),e.TreeCCID==parseInt(a)&&(u||e.LoadCostCenterTree(parseInt(a),l,0,h.SelectedNodes),e.tree.length>0&&(o=e.tree[0]))),"1"==r.Aliasname&&(h.DeleteButtonVisibility=!1),e.CostCenterFilters.push(h)},b=0;b<y.length;b++)O(b);if(null!=t)this.tree[0]!=t&&(this.tree.Clear(),this.tree.push(t),this.SelectedNodes=t.SelectedNodes,this.SelectedNode=t.SelectedNode);else if(null!=o){var N=this.CostCenters.Items.find((function(t){return parseInt(t.Value)==e.TreeCCID}));N&&(this.CostCenters.SelectedValue=this.TreeCCID.toString(),this.CostCenters.SelectedItem=N),this.tree[0]!=o&&(this.tree.Clear(),this.tree.push(o),this.SelectedNodes=o.SelectedNodes,this.SelectedNode=o.SelectedNode)}s.a.SessionManager.RoleType>0&&(this.TreeVisibility=!1,this.CostCenterFilters.map((function(e){return e.IsVisible=!1})))}},{key:"LoadProperties",value:function(){var e=this,t=i.e.StringValue(this.ViewModel.Reportds.Tables[0][0].DefaultPreferences).toString(),o=this.GetPropertiesUIXML();if(o.length>0){var l=new i.f,n=new i.f;if(t.length>0&&l.LoadXml(t),n.LoadXml(o),0!=n.DocumentElement.children.length)for(var c,T=null,_=0;_<n.DocumentElement.children.length;_++){var m=n.DocumentElement.children[_];if(t.length>0&&(T=i.f.SelectSingleNode(l.DocumentElement,m.nodeName)),c=null,"CheckBox"==m.attributes.Type.value){var I=new h.a(0);I.Label=s.a.GetResource("Reports_Lbl"+m.nodeName,m.nodeName),I.DBColumnName=m.nodeName,I.CheckedChangedCommand.Subscribe(this,"OnCheckBoxChecked"),null!=T&&"1"==T.innerHTML&&(I.IsChecked=!0),c=I}else if("TextBox"==m.attributes.Type.value){var R=new D.d(0);R.DisableLbl=!1,R.Label=s.a.GetResource("Reports_Lbl"+m.nodeName,m.nodeName),R.Width=m.attributes.Width.value,null!=m.attributes.IsHorizontal&&"1"==m.attributes.IsHorizontal.value&&(R.IsHorizontalOrientation=!0),null==T||i.e.IsEmpty(T.innerHTML)?null!=m.attributes.Text&&(R.Text=m.attributes.Text.value):R.Text=T.innerHTML,c=R}else if("Radio"==m.attributes.Type.value){var S=new r.b(s.a.GetResource("Reports_Lbl"+m.nodeName,m.nodeName));null!=m.attributes.IsHorizontal&&"1"==m.attributes.IsHorizontal.value&&(S.IsHorizontalOrientation=!0);for(var A=m.attributes.Items.value.split("~"),M=m.attributes.Values.value.split("~"),g=0;g<A.length;g++){var w=new r.a("A",0);w.DBColumnName=M[g],w.Label=s.a.GetResource("Reports_Lbl"+A[g],A[g]),w.CheckedChangedCommand.Subscribe(this,"OnRadioChecked"),w.Group=S,S.Items.push(w),null!=T&&M[g]==T.innerHTML&&(w.IsChecked=!0)}if(null==S.CheckedItem&&null!=m.attributes.DefaultValue)for(var f=0;f<S.Items.length;f++){var E=S.Items[f];if(m.attributes.DefaultValue.value==E.DBColumnName){E.IsChecked=!0;break}}c=S}else if("CheckList"==m.attributes.Type.value){var P=new d.a(s.a.GetResource("Reports_Lbl"+m.nodeName,m.nodeName));null!=m.attributes.IsHorizontal&&"1"==m.attributes.IsHorizontal.value&&(P.IsHorizontalOrientation=!0);for(var y=m.attributes.Items.value.split("~"),O=m.attributes.Values.value.split("~"),b=0;b<y.length;b++){var N=h.a.PactCheckBoxData_1("A",0);N.DBColumnName=O[b],N.Label=s.a.GetResource("Reports_Lbl"+y[b],y[b]),P.Items.push(N),null!=T&&null!=i.f.SelectSingleNode(T,O[b])&&(N.IsChecked=!0)}c=P}else if("TextList"==m.attributes.Type.value){var V=new p.c(s.a.GetResource("Reports_Lbl"+m.nodeName,m.nodeName));if(null!=m.attributes.IsHorizontal&&"1"==m.attributes.IsHorizontal.value&&(V.IsHorizontalOrientation=!0),"Slabs"==m.nodeName){var v=4;this.ViewModel.Preferences.ContainsKey("SlabSize")&&((v=i.e.Int(this.ViewModel.Preferences.SlabSize))<=0&&(v=4));for(var L=1;L<=v;L++){var B=D.d.PactTextBoxData_2("A",0);B.DisableLbl=!1,B.DBColumnName="Slab"+L,B.Label=s.a.GetResource("Reports_LblSlab","Slab")+" "+L,V.Items.push(B),B.Width="40",B.Text=null!=T&&null!=i.f.SelectSingleNode(T,"Slab"+L)?i.f.SelectSingleNodeText(T,"Slab"+L):"0"}}c=V}else if("CheckedTextBox"==m.attributes.Type.value){var F=new p.b;if(F.CheckBox.Label=s.a.GetResource("Reports_Lbl"+m.nodeName,m.nodeName),null!=m.attributes.CheckWidth){var G=i.e.Int(m.attributes.CheckWidth.value)+15;F.CheckBox.Width=G.toString()}if(F.TextBox.Width=m.attributes.TextWidth.value,null!=m.attributes.IsHorizontal&&"1"==m.attributes.IsHorizontal.value&&(F.IsHorizontalOrientation=!0),null!=m.attributes.Text&&(F.TextBox.Text=m.attributes.Text.value),null!=T){var x=i.f.SelectSingleNode(T,"IsChecked");null!=x&&"1"==x.innerHTML&&(F.CheckBox.IsChecked=!0),null==(x=i.f.SelectSingleNode(T,"Text"))||i.e.IsEmpty(x.innerHTML)||(F.TextBox.Text=x.innerHTML)}c=F}else if("CheckedComboBox"==m.attributes.Type.value||"TagWiseComboBox"==m.attributes.Type.value){var W=new p.a;if(W.DataType=m.attributes.Type.value,"TagWiseComboBox"==W.DataType?(W.IsColumnUserDefined=!0,W.ComboBox.SelectedIndex=1,W.ComboBox.IsReadOnly=!1):W.IsColumnUserDefined=!1,W.CheckBox.Label=s.a.GetResource("Reports_Lbl"+m.nodeName,m.nodeName),null!=m.attributes.CheckWidth&&(W.CheckBox.Width=(i.e.Int(m.attributes.CheckWidth.value)+20).toString()),W.ComboBox.Width=m.attributes.ComboWidth.value,null!=m.attributes.IsHorizontal&&"1"==m.attributes.IsHorizontal.value&&(W.IsHorizontalOrientation=!0),this.LoadDropDownData(W.ComboBox,m.nodeName),null!=T){var k=i.f.SelectSingleNode(T,"IsChecked");(null!=k&&"1"==k.innerHTML||"1"==T.innerHTML)&&(W.CheckBox.IsChecked=!0),null==(k=i.f.SelectSingleNode(T,"Value"))||i.e.IsEmpty(k.innerHTML)||(W.ComboBox.SelectedValue=k.innerHTML),"TagWiseComboBox"==W.DataType&&(null==(k=i.f.SelectSingleNode(T,"Column"))||i.e.IsEmpty(k.innerHTML)||(W.ComboBox.SelectedIndex=parseInt(k.innerHTML)),null==(k=i.f.SelectSingleNode(T,"HideColumns"))||i.e.IsEmpty(k.innerHTML)||(W.ComboBox.IsReadOnly=!0))}c=W}else if("ComboBox"==m.attributes.Type.value){var U=new a.e(0);if(U.DisableLbl=!1,U.Label=s.a.GetResource("Reports_Lbl"+m.nodeName,m.nodeName),null!=m.attributes.Width&&(U.Width=m.attributes.Width.value),U.KeyTip=null!=m.attributes.LabelWidth?m.attributes.LabelWidth.value:"",this.LoadDropDownData(U,m.nodeName),null!=m.attributes.Values){for(var K=m.attributes.Items.value.split("~"),H=m.attributes.Values.value.split("~"),Q=0;Q<K.length;Q++){var j=a.d.ComboBoxItems_2(s.a.GetResource("Reports_Lbl"+K[Q],K[Q]),H[Q]);U.Items.push(j),null!=T&&H[Q]==T.innerHTML&&(U.SelectedValue=T.innerHTML)}null==U.SelectedValue&&null!=m.attributes.DefaultValue&&(U.SelectedValue=m.attributes.DefaultValue.value)}c=U}else if("PactListBoxData"==m.attributes.Type.value){var Y=new u.b(0);if(Y.DisableLbl=!1,Y.CCID=parseInt(m.attributes.CostCenter.value),Y.TypeID=parseInt(m.attributes.TypeID.value),null!=m.attributes.CustomWhere&&(Y.CustomWhere=m.attributes.CustomWhere.value),Y.Width="250",Y.Label="EnquiryNo"==m.nodeName?s.a.GetResource("Reports_LblDocNo"):"SerialNo"==m.nodeName?s.a.GetResource("Reports_LblSerialNumber"):s.a.GetResource("Reports_Lbl"+m.nodeName,m.nodeName),Y.Width=m.attributes.Width.value,c=Y,87==this.ViewModel.StaticReportType&&"Property"==m.nodeName&&"1"!=s.a.SessionManager.RoleID&&parseInt(s.a.SessionManager.UserID)>1){var X=s.a.report.ReportDataSet("RPT001",this.ViewModel.IsReportDB,s.a.SessionManager.UserID);t="";for(var q=0;q<X.Tables[0].length;q++)t+=X.Tables[0][q].PropertyID.toString(),q<X.Tables[0].length-1&&(t+=" , ");Y.CustomWhere=t.length>0?" a.NodeID in ( "+t+") ":" 1<>1 "}if("EnquiryNo"==m.nodeName&&this.ViewModel.DocumentFilters.ContainsKey("23148")&&this.ViewModel.DocumentFilters[23148].length>0){var z=void 0;i.e.IsNum(this.ViewModel.DocumentFilters[23148])?(z=i.e.Int(this.ViewModel.DocumentFilters[23148]),Y.SelectedValue=z,this.ViewModel.DocumentFiltersText.ContainsKey("23148")&&(Y.SelectedValueText=Y.Text=this.ViewModel.DocumentFiltersText[23148])):Y.Text=this.ViewModel.DocumentFiltersText.ContainsKey("23148")&&this.ViewModel.DocumentFiltersText[23148].length>0?this.ViewModel.DocumentFiltersText[23148]:this.ViewModel.DocumentFilters[23148]}}else if("CheckedListBox"==m.attributes.Type.value){var J=new a.b;J.Label=s.a.GetResource("Reports_Lbl"+m.nodeName,m.nodeName),J.Width=m.attributes.Width.value,J.DBColumnName=m.nodeName,this.LoadListBoxData(J,m.nodeName),c=J}else if("DatePicker"==m.attributes.Type.value){var Z=new C.a(0);Z.DisableLbl=!1,Z.Label=s.a.GetResource("Reports_Lbl"+m.nodeName,m.nodeName),c=Z}null!=c&&(c.DBColumnName=m.nodeName,c.Column=m.attributes.Column.value,c.Row=m.attributes.Row.value,null!=m.attributes.ColSpan&&(c.ColumnSpan=m.attributes.ColSpan.value),null!=m.attributes.RowSpan&&(c.RowSpan=m.attributes.RowSpan.value),this.DefaultProperties.push(c))}if(this.SetFC(l),this.FCWithExchRate=new p.a,this.FCWithExchRate.Visible=!1,this.ViewModel.StaticReportType>=5&&this.ViewModel.StaticReportType<=8||4==this.ViewModel.StaticReportType){this.FCWithExchRate.Visible=!0,this.LoadDropDownData(this.FCWithExchRate.ComboBox,"ForeignCurrency"),this.FCWithExchRate.ComboBox.Label="1",this.FCWithExchRate.CheckBox.Label=s.a.GetResource("PLTA_ShowAllTransactions");var $=i.f.SelectSingleNode(l.DocumentElement,"FCWithExchRate");if(null!=$){var ee=i.f.SelectSingleNode($,"IsChecked");null!=ee&&"1"==ee.innerHTML&&(this.FCWithExchRate.CheckBox.IsChecked=!0),null==(ee=i.f.SelectSingleNode($,"ComboValue"))||i.e.IsEmpty(ee.innerHTML)||(this.FCWithExchRate.ComboBox.SelectedValue=ee.innerHTML);var te=0;null==(ee=i.f.SelectSingleNode($,"TextValue"))||i.e.IsEmpty(ee.innerHTML)||(te=i.e.Double(ee.innerHTML)),this.FCWithExchRate.ComboBox.Label=te.toString()}}if(this.FinalReportsShowVisibility){this.FinalReportsShowTagWise.ComboBox.SysTableName="1";var oe=null!=l.DocumentElement?i.f.SelectSingleNode(l.DocumentElement,"FinalReportsShow"):null;if(null!=oe)"1"==oe.innerHTML?(this.FinalReportsShowNone.IsChecked=!1,this.FinalReportsShowMonthWise.IsChecked=!0,this.FinalReportsShowMonthWise.Dependantinuse&&(null!=i.f.SelectSingleNode(l.DocumentElement,"FinalReportsShowPrevMn")&&(this.FinalReportsShowMonthWise.IsReadOnly=!0),null!=i.f.SelectSingleNode(l.DocumentElement,"FinalReportsShowDifference")&&(this.FinalReportsShowMonthWise.Enable=!0),null!=i.f.SelectSingleNode(l.DocumentElement,"FinalReportsShowVarPer")&&(this.FinalReportsShowMonthWise.IsColumnUserDefined=!0)),15==this.ViewModel.StaticReportType&&this.OnRadioChecked(this.FinalReportsShowMonthWise)):"4"==oe.innerHTML?(this.FinalReportsShowNone.IsChecked=!1,this.FinalReportsShowQtrWise.IsChecked=!0,this.FinalReportsShowQtrWise.Dependantinuse&&(null!=i.f.SelectSingleNode(l.DocumentElement,"FinalReportsShowPrevMn")&&(this.FinalReportsShowQtrWise.IsReadOnly=!0),null!=i.f.SelectSingleNode(l.DocumentElement,"FinalReportsShowDifference")&&(this.FinalReportsShowQtrWise.Enable=!0),null!=i.f.SelectSingleNode(l.DocumentElement,"FinalReportsShowVarPer")&&(this.FinalReportsShowQtrWise.IsColumnUserDefined=!0))):"5"==oe.innerHTML?(this.FinalReportsShowNone.IsChecked=!1,this.FinalReportsShowHYWise.IsChecked=!0,this.FinalReportsShowHYWise.Dependantinuse&&(null!=i.f.SelectSingleNode(l.DocumentElement,"FinalReportsShowPrevMn")&&(this.FinalReportsShowHYWise.IsReadOnly=!0),null!=i.f.SelectSingleNode(l.DocumentElement,"FinalReportsShowDifference")&&(this.FinalReportsShowHYWise.Enable=!0),null!=i.f.SelectSingleNode(l.DocumentElement,"FinalReportsShowVarPer")&&(this.FinalReportsShowHYWise.IsColumnUserDefined=!0))):"3"==oe.innerHTML?(this.FinalReportsShowNone.IsChecked=!1,this.FinalReportsShowYearWise.IsChecked=!0,this.FinalReportsShowYearWise.Dependantinuse&&(null!=i.f.SelectSingleNode(l.DocumentElement,"FinalReportsShowPrevMn")&&(this.FinalReportsShowYearWise.IsReadOnly=!0),null!=i.f.SelectSingleNode(l.DocumentElement,"FinalReportsShowDifference")&&(this.FinalReportsShowYearWise.Enable=!0),null!=i.f.SelectSingleNode(l.DocumentElement,"FinalReportsShowVarPer")&&(this.FinalReportsShowYearWise.IsColumnUserDefined=!0)),15==this.ViewModel.StaticReportType&&this.OnRadioChecked(this.FinalReportsShowYearWise)):"2"==oe.innerHTML&&(this.FinalReportsShowNone.IsChecked=!1,this.FinalReportsShowTagWise.CheckBox.IsChecked=!0,this.FinalReportsShowTagWise.ComboBox.SelectedValue=i.f.SelectSingleNodeText(l.DocumentElement,"FinalReportsShowTag"),null==(oe=i.f.SelectSingleNode(l.DocumentElement,"FinalReportsShowTagColumn"))||i.e.IsEmpty(oe.innerHTML)||(this.FinalReportsShowTagWise.ComboBox.SysTableName=oe.innerHTML),null==(oe=i.f.SelectSingleNode(l.DocumentElement,"FinalReportsShowTagHideColumns"))||i.e.IsEmpty(oe.innerHTML)||(this.FinalReportsShowTagWise.ComboBox.IsReadOnly=!0));else if(null==oe&&(4==this.ViewModel.StaticReportType||15==this.ViewModel.StaticReportType)&&null!=(oe=i.f.SelectSingleNode(l.DocumentElement,"TagWise"))){var se=i.f.SelectSingleNode(oe,"IsChecked");null!=se&&"1"==se.innerHTML&&(this.FinalReportsShowNone.IsChecked=!1,this.FinalReportsShowTagWise.CheckBox.IsChecked=!0,null==(se=i.f.SelectSingleNode(oe,"Value"))||i.e.IsEmpty(se.innerHTML)||(this.FinalReportsShowTagWise.ComboBox.SelectedValue=se.innerHTML),null==(se=i.f.SelectSingleNode(oe,"Column"))||i.e.IsEmpty(se.innerHTML)||(this.FinalReportsShowTagWise.ComboBox.SysTableName=se.innerHTML),null==(se=i.f.SelectSingleNode(oe,"HideColumns"))||i.e.IsEmpty(se.innerHTML)||(this.FinalReportsShowTagWise.ComboBox.IsReadOnly=!0))}this.CurrentBudget.Visible&&(null!=(oe=i.f.SelectSingleNode(l.DocumentElement,"HideTagWiseBudget"))&&"1"==oe.innerHTML&&(this.HideTagWiseBudget=!0),oe=i.f.SelectSingleNode(l.DocumentElement,"CurrentBudget"),this.CurrentBudget.SelectedValue=null!=oe?oe.innerHTML:"0",oe=i.f.SelectSingleNode(l.DocumentElement,"PreviousBudget"),this.PreviousBudget.SelectedValue=null!=oe?oe.innerHTML:"0",oe=i.f.SelectSingleNode(l.DocumentElement,"ShowActualBudget"),this.ShowActualBudget.IsChecked=null!=oe&&"1"==oe.innerHTML,oe=i.f.SelectSingleNode(l.DocumentElement,"ShowVariance"),this.ShowVariance.IsChecked=null!=oe&&"1"==oe.innerHTML,oe=i.f.SelectSingleNode(l.DocumentElement,"ShowVariancePercent"),this.ShowVariancePercent.IsChecked=null!=oe&&"1"==oe.innerHTML,oe=i.f.SelectSingleNode(l.DocumentElement,"ShowTotalBudget"),this.ShowTotalBudget.IsChecked=null!=oe&&"1"==oe.innerHTML)}this.ViewModel.StaticReportType>=5&&this.ViewModel.StaticReportType<=8&&this.DefaultProperties.forEach((function(t){t instanceof r.b&&e.OnRadioChecked(t.CheckedItem)}))}switch(this.ViewModel.StaticReportType){case 10:case 11:case 12:var ie=this.DefaultProperties.find((function(e){return e instanceof h.a&&"FIFO"==e.DBColumnName}));if(ie&&this.OnCheckBoxChecked(ie),12==this.ViewModel.StaticReportType){var le=this.DefaultProperties.find((function(e){return e instanceof r.b&&"IncludeBills"==e.DBColumnName}));this.OnRadioChecked(le.CheckedItem)}}if(this.ViewModel.Preferences.ContainsKey("DisableDefaults")&&"1"==this.ViewModel.Preferences.DisableDefaults)this.DefaultProperties.filter((function(e){return"DEFAULT_LOCATION"!=e.DBColumnName})).forEach((function(e){e.Enable=!1})),this.FCWithExchRate.Enable=!1,this.FinalReportsShowEnable=!1;else if(this.ViewModel.Preferences.ContainsKey("DisableLevel")&&"1"==this.ViewModel.Preferences.DisableLevel){var ne=this.DefaultProperties.find((function(e){return"Level"==e.DBColumnName||"ShowLevel"==e.DBColumnName}));ne&&(ne.Enable=!1)}this.DefaultProperties.sort((function(e,t){return e.Row>t.Row||e.Row==t.Row&&e.Column>t.Column?1:-1})),this.DefaultProperties.forEach((function(t){t.Visible&&(e.TblProperties.Rows.ContainsKey(t.Row)||e.TblProperties.Rows.Add(t.Row,[null,null]),e.TblProperties.Rows[t.Row][t.Column]=t)}))}},{key:"LoadDropDownData",value:function(e,t){var o=null,i="",l="";"TagWise"==t?(i="NAME",l="FEATUREID",o=s.a.report.DataSet("RPT007",s.a.SessionManager.LanguageID)):"ForeignCurrency"==t?(i="Name",l="CurrencyID",o=s.a.report.DataSet("RPT008","")):"EnquiryNo"==t?(i="VoucherNo",l="VoucherNo",o=s.a.report.DataSet("RPT009",this.ViewModel.Preferences.EnquiryDocument)):"ShowSalesPercentage"==t?(i="Name",l="Name",(o={Tables:[],Columns:[]}).Tables.push([]),o.Columns.push([]),o.Columns[0].push("Name"),o.Tables[0].push({Name:"Repeat None"}),o.Tables[0].push({Name:"Repeat Tag Wise"})):"Budgets"==t?(i="BudgetName",l="BudgetDefID",(o=s.a.report.DataSet("SELECT BudgetDefID,BudgetName FROM COM_BudgetDef WITH(NOLOCK) WHERE StatusID=1 AND IsGroup=0 ORDER BY BudgetName","")).Tables[0].InsertAt({BudgetDefID:0,BudgetName:"None"},0)):"ShowDetailReport"==t?(i="Name",l="Value",(o={Tables:[],Columns:[]}).Tables.push([]),o.Columns.push([]),o.Columns[0].push("Name"),o.Columns[0].push("Value"),o.Tables[0].push({Name:"Group Format",Value:"Group"}),o.Tables[0].push({Name:"Tree Format",Value:"Tree"})):87==this.ViewModel.StaticReportType&&"Status"==t&&(i="Name",l="NodeID",(o=s.a.report.GetReport(1,this.ViewModel.ReportID)).Tables[0].InsertAt({Name:"All",NodeID:"0"},0)),null!=o&&o.Tables[0].forEach((function(t){e.Items.push(a.d.ComboBoxItems_2(t[i].toString(),t[l].toString()))})),e.Items.length>0&&(e.SelectedValue=e.Items[0].Value)}},{key:"LoadListBoxData",value:function(e,t){if("RatioList"!=t);else{var o=new i.f;o.LoadXml(this.ViewModel.Reportds.Tables[0][0].CustomPreferences.toString());var s=i.f.SelectSingleNode(o.DocumentElement,"RatioAnalysisXml/RatiosList");e.Items.push(a.c.CheckedListBoxItem_5("All","All",!0)),e.Items[0].Parent=t;for(var l=0;l<s.childNodes.length;l++){var n=s.childNodes[l];e.Items.push(a.c.CheckedListBoxItem_5(n.attributes.Name.value,n.attributes.Name.value,!0)),e.Items[e.Items.length-1].Parent=t}}}},{key:"GetPropertiesUIXML",value:function(){if(1==this.ViewModel.StaticReportType)return"<XML>\n            <PrintEachAccountOnSeparatePage Type='CheckBox' Row='0' Column='0' ColSpan='2'/>\n<WantAccountsWithoutTransactions Type='CheckBox' Row='1' Column='0' ColSpan='2'/>\n<WantAccountsWithZeroBalances Type='CheckBox' Row='2' Column='0' ColSpan='2'/>\n<WantAccountsWithOnlyOPB Type='CheckBox' Row='3' Column='0' ColSpan='2'/>\n<PrintAccountIndex Type='CheckBox' Row='4' Column='0' ColSpan='2'/>\n<TagWise Type='TagWiseComboBox' Row='5' Column='0' ColSpan='2' CheckWidth='120' ComboWidth='120' IsHorizontal='1'/>\n<CurrencyWise Type='CheckBox' Row='6' Column='0'/><HideEmptyCurrencies Type='CheckBox' Row='6' Column='1'/>\n<ShowDetailReportINV Type='CheckBox' Row='7' Column='0'/>\n<ShowDetailReportACC Type='CheckBox' Row='8' Column='0'/>\n<GroupByParticular Type='CheckBox' Row='8' Column='1'/>\n<TreeSortOn Type='Radio' Column='0' Row='9' ColSpan='2' Items='Code~Name~TreeOrder' Values='Code~Name~TreeOrder' DefaultValue='Name' IsHorizontal='1'/>\n            </XML>";if(2==this.ViewModel.StaticReportType||3==this.ViewModel.StaticReportType){var e="<XML>\n<ShowDetailReportINV Type='CheckBox' Row='7' Column='0'/>\n<ShowDetailReportACC Type='CheckBox' Row='8' Column='0'/>\n<PrintEachAccountOnSeparatePage Type='CheckBox' Row='0' Column='0' ColSpan='2'/>";return 3==this.ViewModel.StaticReportType&&(e+="<DateFilter Type='Radio' Row='9' Column='0' ColSpan='2' Items='VoucherDate~ChequeDate~MaturityDate' Values='DocDate~ChequeDate~MaturityDate' DefaultValue='DocDate' IsHorizontal='1'/>"),e+="</XML>"}if(86==this.ViewModel.StaticReportType)return"<XML>\n            <PrintEachAccountOnSeparatePage Type='CheckBox' Row='0' Column='0' ColSpan='2'/>\n<WantAccountsWithoutTransactions Type='CheckBox' Row='1' Column='0' ColSpan='2'/>\n<WantAccountsWithZeroBalances Type='CheckBox' Row='2' Column='0' ColSpan='2'/>\n<PrintAccountIndex Type='CheckBox' Row='3' Column='0' ColSpan='2'/>\n<ShowTransactionsDrCrSeperately Type='CheckBox' Row='4' Column='0' ColSpan='2'/>\n<TreeSortOn Type='Radio' Column='0' Row='8' ColSpan='2' Items='Code~Name~TreeOrder' Values='Code~Name~TreeOrder' DefaultValue='Name' IsHorizontal='1'/>\n            </XML>";if(156==this.ViewModel.StaticReportType)return"<XML>\n<WantDimensionsWithoutTransactions Type='CheckBox' Row='1' Column='0' ColSpan='2'/>\n<WantDimensionsWithZeroBalances Type='CheckBox' Row='2' Column='0' ColSpan='2'/>\n<ShowDetailReportINV Type='CheckBox' Row='7' Column='0'/>\n<ShowDetailReportACC Type='CheckBox' Row='8' Column='0'/>\n<TreeSortOn Type='Radio' Column='0' Row='9' ColSpan='2' Items='Code~Name~TreeOrder' Values='Code~Name~TreeOrder' DefaultValue='Name' IsHorizontal='1'/>\n            </XML>";if(169==this.ViewModel.StaticReportType)return"<XML>\n<ShowNarration Type='CheckBox' Row='1' Column='0' ColSpan='2'/>\n            </XML>";if(4==this.ViewModel.StaticReportType)return"<XML>\n<WantAccountsWithoutTransactions Type='CheckBox' Row='2' Column='0' ColSpan='2'/>\n<WantAccountsWithZeroBalances Type='CheckBox' Row='3' Column='0' ColSpan='2'/>\n<ShowOpeningDrCrSeperately Type='CheckBox' Row='4' Column='0' ColSpan='2'/>\n<ShowTransactionsDrCrSeperately Type='CheckBox' Row='5' Column='0' ColSpan='2'/>\n<ShowdetailsofControlGroups Type='CheckBox' Row='6' Column='0' ColSpan='2'/>\n<AccountWise Type='CheckBox' Row='8' Column='0' ColSpan='1'/>\n<Level Type='TextBox' Row='8' Column='1' Text='6' Width='35' IsHorizontal='1'/>\n<TreeSortOn Type='Radio' Column='0' Row='9' Items='Code~Name~TreeOrder' Values='Code~Name~TreeOrder' DefaultValue='Name' IsHorizontal='1'/>\n<TType Type='CheckBox' Row='9' Column='1'/>\n            </XML>";if(5==this.ViewModel.StaticReportType||6==this.ViewModel.StaticReportType||7==this.ViewModel.StaticReportType){var t="<XML>                \n<AccountWise Type='CheckBox' Row='0' Column='0' ColSpan='2'/>\n<Level Type='TextBox' Row='0' Column='1' Text='6' Width='35' IsHorizontal='1'/>\n<TreeSortOn Type='Radio' Column='0' Row='1' Items='Code~Name~TreeOrder' Values='Code~Name~TreeOrder' DefaultValue='Name' IsHorizontal='1' ColSpan='2'/>\n<ReportFormat Type='Radio' Row='2' Column='0' Items='Vertical~Horizontal~Plain' Values='Vertical~Horizontal~Plain'/>";return"1"!=s.a.SessionManager.Preferences.StockBasedON&&(t+=7==this.ViewModel.StaticReportType?"<IncludeStock Type='CheckList' Row='2' Column='1' Items='ClosingStock' Values='ClosingStock'/>":"<IncludeStock Type='CheckList' Row='2' Column='1' Items='OpeningStock~ClosingStock' Values='OpeningStock~ClosingStock' IsHorizontal='0'/>"),t+="<ShowAllAccounts Type='CheckBox' Row='3' Column='0' ColSpan='1'/>"+(6==this.ViewModel.StaticReportType?"<ShowSalesPercentage Type='CheckedComboBox' Row='5' Column='0' ColSpan='2' CheckWidth='170' ComboWidth='120' IsHorizontal='1'/>":"")+"</XML>"}if(8==this.ViewModel.StaticReportType){var o="<XML>                \n<AccountWise Type='CheckBox' Row='0' Column='0' ColSpan='2'/>\n<Level Type='TextBox' Row='0' Column='1' Text='6' Width='35' IsHorizontal='1'/>\n<TreeSortOn Type='Radio' Column='0' Row='1' Items='Code~Name~TreeOrder' Values='Code~Name~TreeOrder' DefaultValue='Name' IsHorizontal='1' ColSpan='2'/>\n<ReportFormat Type='Radio' Row='2' Column='0' Items='Vertical~Horizontal' Values='Vertical~Horizontal'/>";return"1"!=s.a.SessionManager.Preferences.StockBasedON&&(o+="<IncludeStock Type='CheckList' Row='2' Column='1' Items='OpeningStock~ClosingStock' Values='OpeningStock~ClosingStock' IsHorizontal='0'/>"),o+="<ShowAllAccounts Type='CheckBox' Row='3' Column='0' ColSpan='1'/>\n<HideZeroBudgetAccounts Type='CheckBox' Row='3' Column='1' ColSpan='1'/>\n<ShowSalesPercentage Type='CheckedComboBox' Row='5' Column='0' ColSpan='2' CheckWidth='170' ComboWidth='120' IsHorizontal='1'/>\n            </XML>"}if(97==this.ViewModel.StaticReportType)return"<XML>\n<ShowDetailReport Type='CheckedComboBox' Row='0' Column='0' ColSpan='2' CheckWidth='130' ComboWidth='105' IsHorizontal='1'/>\n<ShowAllAccounts Type='CheckBox' Row='1' Column='0' ColSpan='1'/>\n<WantAccountsWithZeroBalances Type='CheckBox' Row='2' Column='0' ColSpan='2'/>\n<CumulativeMnWise Type='CheckBox' Row='3' Column='0' ColSpan='2'/>\n</XML>";if(9==this.ViewModel.StaticReportType)return"<XML>\n            <Date Type='Radio' Row='0' Column='0' ColSpan='2' Items='VoucherDate~DueDate' Values='DocDate~DocDueDate' IsHorizontal='1'/>\n            <IncludeBills Type='Radio' Row='1' Column='0' Items='Receivables~Payables~Both' Values='Receivables~Payables~Both'/>\n            <DisplayBills Type='CheckList' Row='1' Column='1' Items='UnAdjusted~SemiAdjusted~Adjusted' Values='UnAdjusted~SemiAdjusted~Adjusted'/>\n            <PrintAccountIndex Type='CheckBox' Row='5' Column='0'/><GroupByDocNo Type='CheckBox' Row='5' Column='1'/>\n            <PrintEachAccountOnSeparatePage Type='CheckBox' Row='6' Column='0' ColSpan='2'/>\n<TreeSortOn Type='Radio' Column='0' Row='9' ColSpan='2' Items='Code~Name~TreeOrder' Values='Code~Name~TreeOrder' DefaultValue='Name' IsHorizontal='1'/>\n           </XML>";if(10==this.ViewModel.StaticReportType)return"<XML>\n            <Date Type='Radio' Row='0' Column='0' ColSpan='2' Items='VoucherDate~DueDate~PaymentTerm' Values='DocDate~DocDueDate~PaymentTerm' IsHorizontal='1'/>\n            <IncludeBills Type='Radio' Row='1' Column='0' Items='Receivables~Payables~Both' Values='Receivables~Payables~Both'/>\n            <DisplayBills Type='CheckList' Row='1' Column='1' Items='UnAdjusted~SemiAdjusted' Values='UnAdjusted~SemiAdjusted'/>\n<FilterPDCOnMaturityDate Type='CheckBox' Row='2' Column='0'/> <FIFO Type='CheckBox' Row='2' Column='1'/>\n            <PrintAccountIndex Type='CheckBox' Row='5' Column='0'/><GroupByDocNo Type='CheckBox' Row='5' Column='1'/>\n            <PrintEachAccountOnSeparatePage Type='CheckBox' Row='6' Column='0' ColSpan='2'/>\n            <PrintAgeingAnalysis Type='CheckBox' Row='7' Column='0' ColSpan='2'/>\n<TreeSortOn Type='Radio' Column='0' Row='9' ColSpan='2' Items='Code~Name~TreeOrder' Values='Code~Name~TreeOrder' DefaultValue='Name' IsHorizontal='1'/>\n            </XML>";if(11==this.ViewModel.StaticReportType)return"<XML>\n            <Date Type='Radio' Row='0' Column='0' ColSpan='2' Items='VoucherDate~DueDate~PaymentTerm' Values='DocDate~DocDueDate~PaymentTerm' IsHorizontal='1'/>\n            <IncludeBills Type='Radio' Row='1' Column='0' Items='Receivables~Payables~Both' Values='Receivables~Payables~Both'/>\n<FIFO Type='CheckBox' Row='1' Column='1'/>\n            <Slabs Type='TextList' Row='2' Column='0' ColSpan='2' IsHorizontal='1'/>\n            <MonthWiseMonths Type='CheckedTextBox' Row='3' Column='0' Text='3' CheckWidth='195' TextWidth='28' IsHorizontal='1'/>\n            <PrintAccountIndex Type='CheckBox' Row='5' Column='0' ColSpan='2'/>\n            <GroupByDocNo Type='CheckBox' Row='5' Column='2' ColSpan='2'/>\n            <PrintEachAccountOnSeparatePage Type='CheckBox' Row='6' Column='0' ColSpan='2'/>\n            </XML>";if(12==this.ViewModel.StaticReportType)return"<XML>\n            <Date Type='Radio' Row='0' Column='0' ColSpan='2' Items='VoucherDate~DueDate~PaymentTerm' Values='DocDate~DocDueDate~PaymentTerm' IsHorizontal='1'/>\n            <IncludeBills Type='Radio' Row='1' Column='0' RowSpan='4' Items='Receivables~Payables~Both' Values='Receivables~Payables~Both'/>\n<FIFO Type='CheckBox' Row='1' Column='1'/>\n<ShowLevel Type='CheckedTextBox' Row='2' Column='1' Text='6' CheckWidth='95' TextWidth='35' IsHorizontal='1'/>\n<MonthWiseMonths Type='CheckedTextBox' Row='3' Column='1' Text='3' CheckWidth='195' TextWidth='28' IsHorizontal='1'/>                \n<ShowRecPaySeperately Type='CheckBox' Row='4' Column='1'/>\n            <Slabs Type='TextList' Row='5' Column='0' ColSpan='2' IsHorizontal='1'/>\n            <PrintAccountIndex Type='CheckBox' Row='6' Column='0'/> <AgeingBasedOnMaturityDate Type='CheckBox' Row='6' Column='1'/>\n            <PrintEachAccountOnSeparatePage Type='CheckBox' Row='7' Column='0'/> <PDCSlabBasedOnMatDate Type='CheckBox' Row='7' Column='2'/>\n            <WantAccountsWithoutTransactions Type='CheckBox' Row='8' Column='0' ColSpan='2'/>\n            <WantAccountsWithZeroBalances Type='CheckBox' Row='9' Column='0' ColSpan='2'/>\n            </XML>";if(13==this.ViewModel.StaticReportType)return"<XML>\n<MultipleUnits Type='ComboBox' Row='0' Column='0' Width='60' Items='None~Both~Max~Min' Values='0~1~2~3' DefaultValue='0' IsHorizontal='1'/>\n<ShowMultipleUnitNames Type='CheckBox' Row='0' Column='1'/>\n<ShowProductsWithoutTransactions Type='CheckBox' Row='1' Column='0' ColSpan='2'/>                \n<ValuationMethod Type='ComboBox' Column='0' Row='2' ColSpan='1' Items='Default~FIFO~LIFO~WeightedAvg~LastPurchaseRate~LastLadingRate~PeriodicMonthly~InvoiceRate' Values='0~1~2~3~4~5~6~7' DefaultValue='0' IsHorizontal='0' Width='130'/>\n<TreeSortOn Type='Radio' Column='0' Row='4' Items='Code~Name~TreeOrder' Values='Code~Name~TreeOrder' DefaultValue='Name' IsHorizontal='0'/>\n            </XML>";if(14==this.ViewModel.StaticReportType)return"<XML>\n            <ShowLevel Type='CheckedTextBox' Row='0' Column='0' Text='6' TextWidth='35' CheckWidth='95' IsHorizontal='1'/>\n<ShowCollapse Type='CheckBox' Row='0' Column='1'/>\n<MultipleUnits Type='ComboBox' Row='1' Column='0' Width='60' Items='None~Both~Max~Min' Values='0~1~2~3' DefaultValue='0' IsHorizontal='1'/>\n<ShowMultipleUnitNames Type='CheckBox' Row='1' Column='1'/>\n<ShowProductsWithoutTransactions Type='CheckBox' Row='2' Column='0' ColSpan='2'/>                \n<ValuationMethod Type='ComboBox' Column='0' Row='3' ColSpan='1' Items='Default~FIFO~LIFO~WeightedAvg~LastPurchaseRate~LastLadingRate~PeriodicMonthly~InvoiceRate' Values='0~1~2~3~4~5~6~7' DefaultValue='0' IsHorizontal='0' Width='130'/>\n<DisplayStock Type='CheckList' Row='4' Column='0' Items='Zero~Positive~Negative' Values='Zero~Positive~Negative'/>\n<TreeSortOn Type='Radio' Column='1' Row='4' Items='Code~Name~TreeOrder' Values='Code~Name~TreeOrder' DefaultValue='Name' IsHorizontal='0'/>\n            </XML>";if(15==this.ViewModel.StaticReportType)return"<XML>\n            <ShowLevel Type='CheckedTextBox' Row='0' Column='0' Text='6' TextWidth='35' CheckWidth='95' IsHorizontal='1'/>\n<ShowCollapse Type='CheckBox' Row='0' Column='1'/>\n<MultipleUnits Type='ComboBox' Row='1' Column='0' Width='60' Items='None~Both~Max~Min' Values='0~1~2~3' DefaultValue='0' IsHorizontal='1'/>\n<ShowMultipleUnitNames Type='CheckBox' Row='1' Column='1'/>\n<ShowAllProducts Type='CheckBox' Row='2' Column='0' ColSpan='2'/>\n<ShowProductsWithoutTransactions Type='CheckBox' Row='3' Column='0' ColSpan='2'/>\n<ValuationMethod Type='ComboBox' Column='0' Row='4' ColSpan='1' Items='Default~FIFO~LIFO~WeightedAvg~LastPurchaseRate~LastLadingRate~PeriodicMonthly~InvoiceRate' Values='0~1~2~3~4~5~6~7' DefaultValue='0' IsHorizontal='0' Width='130'/>\n<DisplayStock Type='CheckList' Row='5' Column='0' Items='Zero~Positive~Negative' Values='Zero~Positive~Negative'/>\n<TreeSortOn Type='Radio' Column='1' Row='5' Items='Code~Name~TreeOrder' Values='Code~Name~TreeOrder' DefaultValue='Name' IsHorizontal='0'/>\n            </XML>";if(16==this.ViewModel.StaticReportType)return"<XML>\n            <ShowLevel Type='CheckedTextBox' Row='0' Column='0' Text='6' TextWidth='35' CheckWidth='95' IsHorizontal='1'/>\n<ShowCollapse Type='CheckBox' Row='0' Column='1'/>\n<MultipleUnits Type='ComboBox' Row='1' Column='0' Width='60' Items='None~Both~Max~Min' Values='0~1~2~3' DefaultValue='0' IsHorizontal='1'/>\n<ShowMultipleUnitNames Type='CheckBox' Row='1' Column='1'/>\n<ShowProductsWithoutTransactions Type='CheckBox' Row='2' Column='0' ColSpan='2'/>\n<TagWise Type='TagWiseComboBox' Row='3' Column='0' ColSpan='2' CheckWidth='125' ComboWidth='120' IsHorizontal='1'/>\n<DisplayStock Type='CheckList' Row='4' Column='0' Items='Zero~Positive~Negative' Values='Zero~Positive~Negative'/>\n<TreeSortOn Type='Radio' Column='1' Row='4' Items='Code~Name~TreeOrder' Values='Code~Name~TreeOrder' DefaultValue='Name' IsHorizontal='0'/>\n            </XML>";if(159==this.ViewModel.StaticReportType)return"<XML>                \n            <ValuationMethod Type='ComboBox' Column='0' Row='3' ColSpan='1' Items='Default~FIFO~LIFO~WeightedAvg' Values='0~1~2~3' DefaultValue='0' IsHorizontal='0' Width='130'/>\n            <TreeSortOn Type='Radio' Column='1' Row='4' Items='Code~Name~TreeOrder' Values='Code~Name~TreeOrder' DefaultValue='Name' IsHorizontal='0'/>\n            </XML>";if(95==this.ViewModel.StaticReportType)return"<XML>\n            <StatusType Type='ComboBox' Column='0' Row='1' ColSpan='2' Items='Pending~Completed~Both' Values='1~2~-1' DefaultValue='1' IsHorizontal='0' Width='130'/>\n            </XML>";if(72==this.ViewModel.StaticReportType)return"<XML>\n<DateWiseDrCr Type='CheckBox' Row='0' Column='0' ColSpan='1'/>\n<ShowReconciledEntries Type='CheckBox' Row='1' Column='0' ColSpan='1'/>\n<ForeignCurrency Type='CheckedComboBox' Row='2' Column='0' ColSpan='2' CheckWidth='110' ComboWidth='120' IsHorizontal='1'/>\n            </XML>";if(81==this.ViewModel.StaticReportType)return"<XML>\n            <ConsolidatedBatches Type='CheckBox' Row='1' Column='0'/>\n            <Filter Type='Radio' Column='0' Row='2' Items='All~Current~Expired' Values='All~Current~Expired' DefaultValue='All' IsHorizontal='0'/>               \n            </XML>";if(82==this.ViewModel.StaticReportType)return"<XML>\n<ConsolidatedBatches Type='CheckBox' Row='0' Column='0'/>\n<BinDetail Type='CheckBox' Row='0' Column='1'/>\n<MonthWiseMonths Type='CheckedTextBox' Row='1' Column='0' Text='4' CheckWidth='175' TextWidth='28' IsHorizontal='1' ColSpan='2'/>\n<Slabs Type='TextList' Row='3' Column='0' ColSpan='2' IsHorizontal='1'/>\n<Filter Type='Radio' Column='0' Row='4' Items='All~Expired~Active~SelectedSlabActive' Values='All~Expired~Active~SelectedSlabActive' DefaultValue='All' IsHorizontal='0'/>\n</XML>";if(83==this.ViewModel.StaticReportType)return"<XML>\n            <Slabs Type='TextList' Row='2' Column='0' ColSpan='2' IsHorizontal='1'/>\n            </XML>";if(84==this.ViewModel.StaticReportType)return"<XML>\n            <ShowLevel Type='CheckedTextBox' Row='0' Column='0' ColSpan='2' Text='6' CheckWidth='90' TextWidth='28' IsHorizontal='1'/>                \n            <ShowYearWise Type='CheckedTextBox' Row='1' Column='0' ColSpan='2' Text='5' CheckWidth='165' TextWidth='28' IsHorizontal='1'/>\n            <ValuationMethod Type='ComboBox' Column='0' Row='2' ColSpan='1' Items='Default~FIFO~LIFO~WeightedAvg~LastPurchaseRate~LastLadingRate~PeriodicMonthly' Values='0~1~2~3~4~5~6' DefaultValue='0' IsHorizontal='0' Width='130'/>\n            <DisplayStock Type='CheckList' Row='3' Column='0' Items='Zero~Positive~Negative' Values='Zero~Positive~Negative'/>                \n            <Slabs Type='TextList' Row='5' Column='0' ColSpan='2' IsHorizontal='1'/>                \n            </XML>";if(87==this.ViewModel.StaticReportType)return"<XML>\n            <Property Type='PactListBoxData' Row='0' Column='0' ColSpan='1' CostCenter='92' TypeID='2' CustomWhere='' IsHorizontal='0' Width='220'/>\n            <Status Type='ComboBox' Column='0' Row='1' ColSpan='1' DefaultValue='0' IsHorizontal='0' Width='130'/>\n            <ExpiryIn Type='TextBox' Column='1' Row='1' ColSpan='1' Text='0' IsHorizontal='1' Width='50'/></XML>";if(98==this.ViewModel.StaticReportType)return"<XML>\n            <RatioList Type='CheckedListBox' Row='5' Column='0' ColSpan='2' Width='160'/>\n<ShowYearWise Type='CheckedTextBox' Row='1' Column='0'  Text='3' CheckWidth='170' TextWidth='28' IsHorizontal='1'/>\n<Sort Type='ComboBox' Column='1' Row='1'  Items='Ascending~Descending' Values='ASC~DESC' DefaultValue='DESC' Width='100'/>\n           </XML>";if(99==this.ViewModel.StaticReportType)return"<XML>\n            <MonthWiseData Type='CheckBox' Row='0' Column='0'/>\n            <ShowProjections Type='CheckBox' Row='1' Column='0'/>\n            </XML>";if(111==this.ViewModel.StaticReportType){var i="<XML>\n<Show Type='Radio' Row='0' Column='0' Items='All~Pending~Executed~Closed' Values='All~Pending~Executed~Closed' DefaultValue='Pending' IsHorizontal='1'/>\n<EnquiryNo Type='PactListBoxData' Row='1' Column='0' ColSpan='1' CostCenter='400' TypeID='2' CustomWhere='CostCenterID="+this.ViewModel.Preferences.EnquiryDocument;return this.ViewModel.Preferences.ContainsKey("PurchaseOrderDocument")&&this.ViewModel.Preferences.PurchaseOrderDocument.length>0&&parseInt(this.ViewModel.Preferences.PurchaseOrderDocument)>0&&(this.ViewModel.Preferences.ContainsKey("Show")&&"Pending"!=this.ViewModel.Preferences.Show?"Executed"==this.ViewModel.Preferences.Show&&(i+=" and Quantity=dbo.[fnRPT_ExeQtyByDoc](a.CostCenterID,a.InvDocDetailsID,"+this.ViewModel.Preferences.PurchaseOrderDocument+",null,0)"):i+=" and Quantity!=dbo.[fnRPT_ExeQtyByDoc](a.CostCenterID,a.InvDocDetailsID,"+this.ViewModel.Preferences.PurchaseOrderDocument+",null,0)"),this.ViewModel.Preferences.ContainsKey("Show")&&"Closed"==this.ViewModel.Preferences.Show?i+=" and LinkStatusID=445'":i+=" and LinkStatusID!=445'",i+=" IsHorizontal='1' Width='220'/>",i+="<ShowLinkedPrds Type='CheckBox' Row='2' Column='0'/>",i+="<ShowPOPendingPrds Type='CheckBox' Row='3' Column='0'/>",i+="</XML>"}if(114==this.ViewModel.StaticReportType)return"<XML><ShowDetailReport Type='CheckBox' Row='1' Column='0'/>\n<Level Type='TextBox' Row='1' Column='1' Text='6' Width='35' IsHorizontal='1'/>\n<ShowMonths Type='TextBox' Row='3' Column='0' Text='0' Width='28' IsHorizontal='1'/>\n</XML>";if(91==this.ViewModel.StaticReportType)return"<XML>\n<DisplayBills Type='Radio' Row='0' Column='0' Items='All~Due~OverDue' Values='All~Due~OverDue'/>\n</XML>";if(120==this.ViewModel.StaticReportType)return"<XML>\n<Status Type='Radio' Column='0' Row='2' Items='All~Active~Dispose' Values='All~Active~Dispose' DefaultValue='All' IsHorizontal='1'/>\n</XML>";if(123==this.ViewModel.StaticReportType||124==this.ViewModel.StaticReportType)return"<XML>\n<Data Type='Radio' Column='0' Row='2' Items='Mapped~Assigned' Values='Mapped~Assigned' DefaultValue='Mapped' IsHorizontal='1'/>\n</XML>";if(150==this.ViewModel.StaticReportType)return"<XML>\n<Filter Type='Radio' Column='0' Row='2' Items='DocDate~ModifiedDate' Values='DocDate~ModifiedDate' DefaultValue='DocDate' IsHorizontal='0'/>\n</XML>";if(202==this.ViewModel.StaticReportType)return"<XML>\n<Filter Type='Radio' Column='0' Row='2' Items='All~Web~Mobile' Values='All~Web~Mobile' DefaultValue='All'/>\n</XML>";if(146==this.ViewModel.StaticReportType||148==this.ViewModel.StaticReportType||149==this.ViewModel.StaticReportType){var l="",n="",a=s.a.report.DataSet("RPT016",s.a.SessionManager.UserID);if(l="ALL~",n="0~",null!=a&&a.Tables.length>0&&a.Tables[0].length>0&&a.Columns[0].Contains("UserName"))for(var r=0;r<a.Tables[0].length;r++)l+=a.Tables[0][r].UserName.toString()+"~",n+=a.Tables[0][r].UserName.toString()+"~";return"<XML>\n<Feature Type='ComboBox' Column='0' Row='0' ColSpan='3' Items='Calendar~Leads~Cases~Opportunity~CRM-Customers~Contacts~FollowUp~Sales Contract' LabelWidth='60' Values='1000~86~73~89~83~65~122~95' DefaultValue='86' IsHorizontal='0' Width='130'/>\n<Status Type='ComboBox' Row='0' Column='1' ColSpan='1' Items='All~Open~Closed~Re-Schedule~Confirmed' Values='0~412~413~414~8' DefaultValue='0' IsHorizontal='0' Width='130' LabelWidth='60'/>\n<CreatedBy Type='ComboBox' Row='1' Column='0' ColSpan='1' Items='"+(l=l.Trim("~"))+"' Values='"+(n=n.Trim("~"))+"' DefaultValue='0' IsHorizontal='0' Width='130' LabelWidth='60'/>\n<Assigned Type='ComboBox' Row='1' Column='1' ColSpan='1' Items='"+l+"' Values='"+n+"' DefaultValue='0' IsHorizontal='0' Width='130' LabelWidth='60'/>\n<Account Type='PactListBoxData' Row='2' Column='0' ColSpan='1' CostCenter='2' TypeID='2' CustomWhere='' IsHorizontal='0' Width='220'/>\n<Location Type='PactListBoxData' Row='2' Column='1' ColSpan='1' CostCenter='50002' TypeID='1' CustomWhere='' IsHorizontal='0' Width='220'/>\n<Customer Type='PactListBoxData' Row='3' Column='0' ColSpan='1' CostCenter='83' TypeID='2' CustomWhere='' IsHorizontal='0' Width='220'/>\n</XML>"}return 154==this.ViewModel.StaticReportType?"<XML>\n<StatusType Type='ComboBox' Column='0' Row='1' Items='All~Pending~Completed~Rejected' Values='0~1~2~-1' DefaultValue='1' IsHorizontal='0' Width='130' LabelWidth='80'/>\n<Show Type='ComboBox' Column='0' Row='2' Items='All~Email~SMS' Values='0~1~2' DefaultValue='0' IsHorizontal='0' Width='130' LabelWidth='80'/>\n<History Type='CheckBox' Row='1' Column='1'/>\n            </XML>":157==this.ViewModel.StaticReportType?"<XML>\n<ShowLevel Type='CheckedTextBox' Row='0' Column='0' Text='6' CheckWidth='95' TextWidth='35' IsHorizontal='1'/>\n<MonthWiseData Type='CheckBox' Row='1' Column='0'/>    \n            </XML>":160==this.ViewModel.StaticReportType?"<XML>\n<Bills Type='Radio' Row='1' Column='0' Items='Receivables~Payables' Values='Receivables~Payables'/>\n<Date Type='Radio' Row='1' Column='1' Items='VoucherDate~MaturityDate' Values='DocDate~ChequeMaturityDate'/>\n<Consolidated Type='CheckBox' Row='2' Column='0'/>\n<ShowPreviousAdjustment Type='CheckBox' Row='3' Column='0'/>\n<ShowFutureAdjustment Type='CheckBox' Row='4' Column='0'/>                \n            </XML>":185==this.ViewModel.StaticReportType?"<XML>\n<SerialNo Type='PactListBoxData' Row='0' Column='0' ColSpan='1' CostCenter='42' TypeID='1' IsHorizontal='1' Width='220'/> </XML>":210==this.ViewModel.StaticReportType?"<XML>\n<Days Type='TextBox' Row='0' Column='0' Text='90' Width='35' IsHorizontal='1'/> </XML>":288==this.ViewModel.StaticReportType?"<XML>                \n<ReportFormat Type='Radio' Row='2' Column='0' Items='Vertical~Horizontal' Values='Vertical~Horizontal'/>\n</XML>":298==this.ViewModel.StaticReportType?"<XML>                \n<ShowFields Type='CheckList' Row='1' Column='0' Items='Common~Numeric~CostCenter~Alpha' Values='Common~Numeric~CostCenter~Alpha'/>\n</XML>":303==this.ViewModel.StaticReportType?"<XML>                \n<CalculateBasedOnLastSalary Type='CheckBox' Row='1' Column='0'/>\n</XML>":this.ViewModel.StaticReportType>=172&&this.ViewModel.StaticReportType<=175||this.ViewModel.StaticReportType>=180&&this.ViewModel.StaticReportType<=183?"<XML>                \n<ProductsNotInBOM Type='CheckBox' Row='1' Column='0'/>\n</XML>":"<XML></XML>"}},{key:"GetPropertiesSaveXML",value:function(){var e="";e+="<XML>";for(var t=0;t<this.DefaultProperties.length;t++){var o=this.DefaultProperties[t];if(!i.e.IsEmpty(o.DBColumnName)){if(e+="<"+o.DBColumnName+">",o instanceof h.a)e+=o.IsChecked?"1":"0";else if(o instanceof r.b)for(var s=o,l=0;l<s.Items.length;l++){var n=s.Items[l];if(n.IsChecked){e+=n.DBColumnName;break}}else if(o instanceof D.d)e+=o.Text;else if(o instanceof d.a)for(var c=o,T=0;T<c.Items.length;T++){var _=c.Items[T];_.IsChecked&&(e+="<"+_.DBColumnName+"/>")}else if(o instanceof p.c)o.Items.forEach((function(t){i.e.IsEmpty(t.Text)||(e+="<"+t.DBColumnName+">",e+=t.Text,e+="</"+t.DBColumnName+">")}));else if(o instanceof p.b)e+="<IsChecked>"+(o.CheckBox.IsChecked?1:0)+"</IsChecked>",e+="<Text>"+o.TextBox.Text+"</Text>";else if(o instanceof u.b)e+="EnquiryNo"==o.DBColumnName?"'"+o.Text+"'":"SerialNo"==o.DBColumnName?o.Text:o.SelectedValue;else if(o instanceof a.e)e+=o.SelectedValue;else if(o instanceof p.a){var m=o;e+="<IsChecked>"+(m.CheckBox.IsChecked?1:0)+"</IsChecked>",e+="<Value>"+m.ComboBox.SelectedValue+"</Value>","TagWiseComboBox"==m.DataType&&(1!=m.ComboBox.SelectedIndex&&-1!=m.ComboBox.SelectedIndex&&(e+="<Column>"+m.ComboBox.SelectedIndex+"</Column>"),m.ComboBox.IsReadOnly&&(e+="<HideColumns>1</HideColumns>"))}else o instanceof C.a&&(e+=o.Date.ToString("dd MMM yyyy"));e+="</"+o.DBColumnName+">"}}if(this.FCVisibility){this.ViewModel.Preferences.ContainsKey("ForeignCurrency")&&this.ViewModel.Preferences.Remove("ForeignCurrency"),e+="<Currency>";var I="";this.CompanyCurrency.IsChecked?I="<Type>1</Type>":this.FCCurrency.Visible&&this.FCCurrency.CheckBox.IsChecked&&!i.e.IsEmpty(this.FCCurrency.ComboBox.SelectedValue)?(I="<Type>2</Type>",I+="<Value>"+this.FCCurrency.ComboBox.SelectedValue+"</Value>"):this.LCCurrency.Visible&&this.LCCurrency.CheckBox.IsChecked&&(I="<Type>3</Type>"),0==I.length&&(I="<Type>1</Type>"),e+=I,e+="</Currency>"}if(this.FCWithExchRate.Visible){if(e+="<FCWithExchRate>",this.FCWithExchRate.CheckBox.IsChecked&&(e+="<IsChecked>1</IsChecked>"),i.e.IsEmpty(this.FCWithExchRate.ComboBox.SelectedValue)||(e+="<ComboValue>"+this.FCWithExchRate.ComboBox.SelectedValue+"</ComboValue>"),!i.e.IsEmpty(this.FCWithExchRate.ComboBox.Label)){var R=i.e.Double(this.FCWithExchRate.ComboBox.Label);R<=0&&(R=1),e+="<TextValue>"+R.toString()+"</TextValue>"}e+="</FCWithExchRate>"}return this.FinalReportsShowVisibility&&(this.FinalReportsShowNone.IsChecked?e+="<FinalReportsShow>0</FinalReportsShow>":this.FinalReportsShowMonthWise.IsChecked?(e+="<FinalReportsShow>1</FinalReportsShow>",this.FinalReportsShowMonthWise.Dependantinuse&&(this.FinalReportsShowMonthWise.IsReadOnly?e+="<FinalReportsShowPrevMn>1</FinalReportsShowPrevMn>":this.ViewModel.Preferences.ContainsKey("FinalReportsShowPrevMn")&&this.ViewModel.Preferences.Remove("FinalReportsShowPrevMn"),this.FinalReportsShowMonthWise.Enable?e+="<FinalReportsShowDifference>1</FinalReportsShowDifference>":this.ViewModel.Preferences.ContainsKey("FinalReportsShowDifference")&&this.ViewModel.Preferences.Remove("FinalReportsShowDifference"),this.FinalReportsShowMonthWise.IsColumnUserDefined?e+="<FinalReportsShowVarPer>1</FinalReportsShowVarPer>":this.ViewModel.Preferences.ContainsKey("FinalReportsShowVarPer")&&this.ViewModel.Preferences.Remove("FinalReportsShowVarPer"))):this.FinalReportsShowQtrWise.IsChecked?(e+="<FinalReportsShow>4</FinalReportsShow>",this.FinalReportsShowQtrWise.Dependantinuse&&(this.FinalReportsShowQtrWise.IsReadOnly?e+="<FinalReportsShowPrevMn>1</FinalReportsShowPrevMn>":this.ViewModel.Preferences.ContainsKey("FinalReportsShowPrevMn")&&this.ViewModel.Preferences.Remove("FinalReportsShowPrevMn"),this.FinalReportsShowQtrWise.Enable?e+="<FinalReportsShowDifference>1</FinalReportsShowDifference>":this.ViewModel.Preferences.ContainsKey("FinalReportsShowDifference")&&this.ViewModel.Preferences.Remove("FinalReportsShowDifference"),this.FinalReportsShowQtrWise.IsColumnUserDefined?e+="<FinalReportsShowVarPer>1</FinalReportsShowVarPer>":this.ViewModel.Preferences.ContainsKey("FinalReportsShowVarPer")&&this.ViewModel.Preferences.Remove("FinalReportsShowVarPer"))):this.FinalReportsShowHYWise.IsChecked?(e+="<FinalReportsShow>5</FinalReportsShow>",this.FinalReportsShowHYWise.Dependantinuse&&(this.FinalReportsShowHYWise.IsReadOnly?e+="<FinalReportsShowPrevMn>1</FinalReportsShowPrevMn>":this.ViewModel.Preferences.ContainsKey("FinalReportsShowPrevMn")&&this.ViewModel.Preferences.Remove("FinalReportsShowPrevMn"),this.FinalReportsShowHYWise.Enable?e+="<FinalReportsShowDifference>1</FinalReportsShowDifference>":this.ViewModel.Preferences.ContainsKey("FinalReportsShowDifference")&&this.ViewModel.Preferences.Remove("FinalReportsShowDifference"),this.FinalReportsShowHYWise.IsColumnUserDefined?e+="<FinalReportsShowVarPer>1</FinalReportsShowVarPer>":this.ViewModel.Preferences.ContainsKey("FinalReportsShowVarPer")&&this.ViewModel.Preferences.Remove("FinalReportsShowVarPer"))):this.FinalReportsShowYearWise.IsChecked?(e+="<FinalReportsShow>3</FinalReportsShow>",this.FinalReportsShowYearWise.Dependantinuse&&(this.FinalReportsShowYearWise.IsReadOnly?e+="<FinalReportsShowPrevMn>1</FinalReportsShowPrevMn>":this.ViewModel.Preferences.ContainsKey("FinalReportsShowPrevMn")&&this.ViewModel.Preferences.Remove("FinalReportsShowPrevMn"),this.FinalReportsShowYearWise.Enable?e+="<FinalReportsShowDifference>1</FinalReportsShowDifference>":this.ViewModel.Preferences.ContainsKey("FinalReportsShowDifference")&&this.ViewModel.Preferences.Remove("FinalReportsShowDifference"),this.FinalReportsShowYearWise.IsColumnUserDefined?e+="<FinalReportsShowVarPer>1</FinalReportsShowVarPer>":this.ViewModel.Preferences.ContainsKey("FinalReportsShowVarPer")&&this.ViewModel.Preferences.Remove("FinalReportsShowVarPer"))):this.FinalReportsShowTagWise.CheckBox.IsChecked&&(i.e.IsEmpty(this.FinalReportsShowTagWise.ComboBox.SelectedValue)?e+="<FinalReportsShow>0</FinalReportsShow>":(e+="<FinalReportsShow>2</FinalReportsShow>",e+="<FinalReportsShowTag>"+this.FinalReportsShowTagWise.ComboBox.SelectedValue+"</FinalReportsShowTag>","1"==this.FinalReportsShowTagWise.ComboBox.SysTableName||Object(A.isNullOrUndefined)(this.FinalReportsShowTagWise.ComboBox.SysTableName)||(e+="<FinalReportsShowTagColumn>"+this.FinalReportsShowTagWise.ComboBox.SysTableName+"</FinalReportsShowTagColumn>"),this.FinalReportsShowTagWise.ComboBox.IsReadOnly?e+="<FinalReportsShowTagHideColumns>1</FinalReportsShowTagHideColumns>":this.ViewModel.Preferences.ContainsKey("FinalReportsShowTagHideColumns")&&this.ViewModel.Preferences.Remove("FinalReportsShowTagHideColumns"))),this.CurrentBudget.Visible&&(e+=this.HideTagWiseBudget&&!this.FinalReportsShowNone.IsChecked?"<HideTagWiseBudget>1</HideTagWiseBudget>":"<HideTagWiseBudget>0</HideTagWiseBudget>",e+="<CurrentBudget>"+this.CurrentBudget.SelectedValue+"</CurrentBudget>",e+="<PreviousBudget>"+this.PreviousBudget.SelectedValue+"</PreviousBudget>",e+="<ShowActualBudget>"+(this.ShowActualBudget.IsChecked?"1":"0")+"</ShowActualBudget>",e+="<ShowVariance>"+(this.ShowVariance.IsChecked?"1":"0")+"</ShowVariance>",e+="<ShowVariancePercent>"+(this.ShowVariancePercent.IsChecked?"1":"0")+"</ShowVariancePercent>",e+="<ShowTotalBudget>"+(this.ShowTotalBudget.IsChecked?"1":"0")+"</ShowTotalBudget>")),(e+="</XML>").toString()}},{key:"SetFC",value:function(e){if(this.CurrencyList=new r.b,this.ViewModel.StaticReportType>=1&&this.ViewModel.StaticReportType<=16||[84,86,97,98,99,156,169].Contains(this.ViewModel.StaticReportType)){this.FCGUID=i.e.NewGuid(),this.FCCurrency=new M,this.FCCurrency.ComboBox.LblWidth="1",this.LCCurrency=new M,this.CompanyCurrency.IsChecked=!0;var t=null!=e.DocumentElement?i.f.SelectSingleNode(e.DocumentElement,"Currency"):null;if(this.CompanyCurrency.Group=this.CurrencyList,this.CurrencyList.Items.push(this.CompanyCurrency),this.FCCurrency.CheckBox.Group=this.CurrencyList,this.CurrencyList.Items.push(this.FCCurrency.CheckBox),this.LCCurrency.CheckBox.Group=this.CurrencyList,this.CurrencyList.Items.push(this.LCCurrency.CheckBox),Object(l.j)(s.a.SessionManager.Preferences["Use Foreign Currency"]))if(this.LoadDropDownData(this.FCCurrency.ComboBox,"ForeignCurrency"),null!=t)"2"==i.f.SelectSingleNodeText(t,"Type")&&(this.CompanyCurrency.IsChecked=!1,this.FCCurrency.CheckBox.IsChecked=!0,this.FCCurrency.ComboBox.SelectedValue=i.f.SelectSingleNodeText(t,"Value"));else{var o=null!=e.DocumentElement?i.f.SelectSingleNode(e.DocumentElement,"ForeignCurrency"):null;null!=o&&null!=i.f.SelectSingleNode(o,"IsChecked")&&"1"==i.f.SelectSingleNodeText(o,"IsChecked")&&(this.FCCurrency.CheckBox.IsChecked=!0,this.FCCurrency.ComboBox.SelectedValue=i.f.SelectSingleNodeText(o,"Value"))}else this.FCCurrency.Visible=!1;!i.e.IsEmpty(s.a.SessionManager.Preferences.DimensionwiseCurrency)&&parseInt(s.a.SessionManager.Preferences.DimensionwiseCurrency)>5e4?null!=t&&"3"==t.SelectSingleNodeText("Type")&&(this.CompanyCurrency.IsChecked=!1,this.LCCurrency.CheckBox.IsChecked=!0):this.LCCurrency.Visible=!1,this.FCVisibility=!(!this.LCCurrency.Visible&&!this.FCCurrency.Visible)}}},{key:"OnChange",value:function(e,t,o){t.CheckBox.IsChecked=!t.CheckBox.IsChecked,t.CheckBox.IsChecked&&(this.CompanyCurrency.IsChecked=!1,o.forEach((function(e){"true"==e.tostring()?e=!1:e instanceof p.a&&(e.CheckBox.IsChecked=!1)})))}},{key:"FromDate_PropertyChanged",value:function(e,t){"Date"==t.PropertyName&&("1"!=s.a.SessionManager.RoleID&&s.a.SessionManager.Preferences.ContainsKey("DoNotAllowFutureDateInReports")&&"True"==s.a.SessionManager.Preferences.DoNotAllowFutureDateInReports&&null!=this.FromDate&&this.FromDate.Date&&this.FromDate.Date>Date.Today()&&(this.FromDate.Date=Date.Today()),s.a.SessionManager.ReportsFromDate=new Date(this.FromDate.Date.getFullYear(),this.FromDate.Date.getMonth(),this.FromDate.Date.getDate()))}},{key:"ToDate_PropertyChanged",value:function(e,t){(null!=t&&"Date"==t.PropertyName||null==e&&null==t)&&"1"!=s.a.SessionManager.RoleID&&s.a.SessionManager.Preferences.ContainsKey("DoNotAllowFutureDateInReports")&&"True"==s.a.SessionManager.Preferences.DoNotAllowFutureDateInReports&&null!=this.ToDate&&this.ToDate.Date&&this.ToDate.Date>Date.Today()&&(this.ToDate.Date=Date.Today())}},{key:"OnCheckedChanged",value:function(e){if(!this.LockCheckedChanged&&e.item instanceof a.c){var t=e.item,o=this.DefaultProperties.find((function(e){return e instanceof a.b&&e.DBColumnName==t.Parent}));if(o instanceof a.b){if("All"==t.Value){this.LockCheckedChanged=!0;for(var s=1;s<o.Items.length;s++)o.Items[s].IsChecked=t.IsChecked;this.LockCheckedChanged=!1}else{if(this.LockCheckedChanged=!0,t.IsChecked){o.Items[0].IsChecked=!0;for(var i=1;i<o.Items.length;i++)if(!o.Items[i].IsChecked){o.Items[0].IsChecked=!1;break}}else o.Items[0].IsChecked=!1;this.LockCheckedChanged=!1}this.LockCheckedChanged=!1}}}},{key:"OnOkClick",value:function(e){if(this.DisplayMessage="",this.FromDate.Visible&&this.ToDate.Visible&&new Date(this.FromDate.Date.getFullYear(),this.FromDate.Date.getMonth(),this.FromDate.Date.getDate())>new Date(this.ToDate.Date.getFullYear(),this.ToDate.Date.getMonth(),this.ToDate.Date.getDate()))return this.MessageVisibility=!0,void(this.DisplayMessage=s.a.GetResource("DateValidation"));this.SetLocationWhere(),this.IsFirstLoaded=!0,this.ViewModel.ShowStaticFilter=!1,this.ViewModel.ShowReport=!0,this.ViewModel.Reportds.Tables[0][0].DefaultPreferences=this.GetPropertiesSaveXML(),this.ViewModel.UpdateDefaultPreferences(),this.ViewModel.SetQueryXMLTags(),this.ViewModel.LoadData()}},{key:"SetLocationWhere",value:function(){if(this.Locations.Items.length>0&&this.Locations.Items[0].IsChecked&&("1"==s.a.SessionManager.RoleID||this.IsUserAllLocationsAssigned))this.LocationWhere=null;else{this.LocationWhere="";for(var e=1;e<this.Locations.Items.length;e++)this.Locations.Items[e].IsChecked&&(this.LocationWhere.length>0&&(this.LocationWhere+=","),this.LocationWhere+=this.Locations.Items[e].Value)}}},{key:"OnCancelClick",value:function(e){this.DisplayMessage="",this.ViewModel.ShowStaticFilter=!1,this.ViewModel.ShowReport=!0}},{key:"OnButtonClick",value:function(e){if("SetDefault"==e){var t=this.GetPropertiesSaveXML(),o=s.a.report.SetReportDefaultProperties(this.ViewModel.ReportID,t),l=i.e.Int(o.obj);o.Tables.length>0&&o.Tables[0].length>0&&(this.DisplayMessage=o.Tables[0][0].ErrorMessage.toString()),l>0&&this.ViewModel.ReportID>0&&(this.ViewModel.Reportds.Tables[0][0].DefaultPreferences=t)}}},{key:"OnRadioChecked",value:function(e){if(e instanceof r.a){var t=e;if(null!=this.ViewModel&&15==this.ViewModel.StaticReportType&&(this.FinalReportsShowMonthWise==t||this.FinalReportsShowYearWise==t?this.FromDate.Visible=!0:this.ViewModel.Preferences.ContainsKey("SalesDocs")&&0!=this.ViewModel.Preferences.SalesDocs.length||(this.FromDate.Visible=!1)),null==t.Group)return;if("ReportFormat"==t.Group.DBColumnName)this.ViewModel.StaticReportType>=5&&this.ViewModel.StaticReportType<=8&&(this.FinalReportsShowEnable="Vertical"==t.Group.CheckedItem.DBColumnName);else if(12==this.ViewModel.StaticReportType&&"IncludeBills"==t.Group.DBColumnName){var o=this.DefaultProperties.find((function(e){return"ShowRecPaySeperately"==e.DBColumnName}));o instanceof h.a&&(o.Enable="Both"==t.Group.CheckedItem.DBColumnName)}else if(111==this.ViewModel.StaticReportType&&"Show"==t.Group.DBColumnName){var s=this.DefaultProperties.find((function(e){return e instanceof u.b&&"EnquiryNo"==e.DBColumnName}));s.CustomWhere="CostCenterID="+this.ViewModel.Preferences.EnquiryDocument,s.CustomWhere+="Closed"==t.Group.CheckedItem.DBColumnName?" and LinkStatusID=445":" and LinkStatusID!=445",this.ViewModel.Preferences.ContainsKey("PurchaseOrderDocument")&&this.ViewModel.Preferences.PurchaseOrderDocument.length>0&&parseInt(this.ViewModel.Preferences.PurchaseOrderDocument)>0&&("Pending"==t.Group.CheckedItem.DBColumnName?s.CustomWhere+=" and Quantity!=dbo.[fnRPT_ExeQtyByDoc](a.CostCenterID,a.InvDocDetailsID,"+this.ViewModel.Preferences.PurchaseOrderDocument+",null,0)":"Executed"==t.Group.CheckedItem.DBColumnName&&(s.CustomWhere+=" and Quantity=dbo.[fnRPT_ExeQtyByDoc](a.CostCenterID,a.InvDocDetailsID,"+this.ViewModel.Preferences.PurchaseOrderDocument+",null,0)"))}}}},{key:"OnCheckBoxChecked",value:function(e){if(e instanceof h.a){var t=e;if("FIFO"==t.DBColumnName&&(10==this.ViewModel.StaticReportType||11==this.ViewModel.StaticReportType||12==this.ViewModel.StaticReportType)){var o=this.DefaultProperties.find((function(e){return e instanceof r.b&&"IncludeBills"==e.DBColumnName}));if(o instanceof r.b){t.IsChecked&&o.Items[2].IsChecked&&(o.Items[0].IsChecked=!0),o.Items[2].Visible=!t.IsChecked;var s=this.DefaultProperties.find((function(e){return"ShowRecPaySeperately"==e.DBColumnName}));s instanceof h.a&&(s.Visible=!t.IsChecked)}var i=this.DefaultProperties.find((function(e){return e instanceof d.a&&"DisplayBills"==e.DBColumnName}));i instanceof d.a&&(i.Visible=!t.IsChecked)}}}},{key:"OnCostCenterChange",value:function(e){if(!i.e.IsEmpty(this.CostCenters.SelectedValue)&&null!=e&&-1!=parseInt(e)){var t=0;null==this.CostCenters.SelectedItem||i.e.IsEmpty(this.CostCenters.SelectedItem.Parent)||(t=i.e.Int(this.CostCenters.SelectedItem.Parent)),this.LoadCostCenterTree(parseInt(this.CostCenters.SelectedValue),t,0,null)}}},{key:"LoadCostCenterTree",value:function(e,t,o,l){if(!(s.a.SessionManager.RoleType>0)){this.tree.Clear();var a,r="";if(e==this.TreeCCID&&(r=this.StaticTreeFilter),300==e&&this.ViewModel.StaticReportType>=13&&this.ViewModel.StaticReportType<=16&&(r="i.IsInventory=1 and exists (select PrefValue from com_documentpreferences with(nolock) where Prefname='DonotupdateInventory' and CostCenterID=i.CostCenterID and PrefValue='False')"),2==e?this.ViewModel.Preferences.ContainsKey("AccountTypesFilter")&&this.ViewModel.Preferences.AccountTypesFilter.length>0&&(r=s.a.SessionManager.Preferences.ContainsKey("IsControlAccounts")&&"TRUE"==s.a.SessionManager.Preferences.IsControlAccounts.toUpperCase()?"6,7"==this.ViewModel.Preferences.AccountTypesFilter||"7,6"==this.ViewModel.Preferences.AccountTypesFilter?"#DEBITORCREDITORTEE#":this.ViewModel.Preferences.AccountTypesFilter.Contains(",")?"A.AccountTypeID IN ("+this.ViewModel.Preferences.AccountTypesFilter+")":"7"==this.ViewModel.Preferences.AccountTypesFilter?"(#DEBTORTEE# or (A.IsDrCr=1 and A.AccountTypeID=6))":"6"==this.ViewModel.Preferences.AccountTypesFilter?"(#CREDITORTEE# or (A.IsDrCr=1 and A.AccountTypeID=7))":"A.AccountTypeID="+this.ViewModel.Preferences.AccountTypesFilter:this.ViewModel.Preferences.AccountTypesFilter.Contains(",")?"A.AccountTypeID IN ("+this.ViewModel.Preferences.AccountTypesFilter+")":"A.AccountTypeID="+this.ViewModel.Preferences.AccountTypesFilter):50002==e&&"1"!=s.a.SessionManager.RoleID&&"True"==s.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==s.a.SessionManager.Preferences["LW Reports"]&&(r=i.e.IsEmpty(s.a.SessionManager.LocationWhere)?"A.NodeID IN (-1234)":"A.NodeID IN ("+s.a.SessionManager.LocationWhere+")"),null==l)for(var h=0;h<this.CostCenterFilters.length;h++){var u=this.CostCenterFilters[h];if(u.CostCenterID==e&&u.LookupTypeID==t){l=u.SelectedNodes;break}}44==e&&t>0&&(r="A.LookupType="+t);var D="";if(null!=this.ViewModel&&this.ViewModel.Preferences.ContainsKey("GridViewFilter")&&this.ViewModel.Preferences.GridViewFilter.length>0){alert("check:2946");var d=new i.f;d.LoadXml("<GridViewFilter>"+this.ViewModel.Preferences.GridViewFilter+"</GridViewFilter>"),i.f.SelectNodes(d.DocumentElement.children[0],"Row").forEach((function(t){t.attributes.CCID.value==e&&(D+=t.attributes.GID.value+",")}))}if(a=new c.a,null==l?a.TreeViewModel_5(e,this,o,r,D):a.TreeViewModel_6(e,this,o,r,l,D),a.LookupTypeID=t,a.HeaderVisiblity=!1,a.OnNodeSelected||(a.OnNodeSelected=new n.b,a.OnNodeSelected.Subscribe(this,"OnNodeSelected")),this.tree.push(a),this.TreeCCID==e&&this.DefaultTreeSelectedNodes!=a.SelectedNodes&&(this.DefaultTreeSelectedNodes=a.SelectedNodes),null!=l&&l.length>0&&null!=a&&null!=a.AllNodes){a.SelectedNode=null;var C=a.AllNodes.find((function(e){return e.Id==l[0].Id}));C&&a.SelectSearchNode(C)}}}},{key:"OnDateRangesSelectionChanged",value:function(e){"MRP"==e&&null!=this.MrpDateRanges.SelectedValue?_.a.SetDateRanges(this.MrpDateRanges.SelectedValue,this.MrpFromDate,this.MrpToDate):null!=this.DateRanges.SelectedValue&&_.a.SetDateRanges(this.DateRanges.SelectedValue,this.FromDate,this.ToDate)}}]),o}(I.a)},RiXB:function(e,t,o){"use strict";o.d(t,"a",(function(){return D}));var s=o("Do2H"),i=o("Lp6j"),l=o("vTM8"),n=o("ScVY"),a=o("0/4Q"),r=o("wlFP"),h=o("dH+5"),u=o("mvPR"),c=function e(){_classCallCheck(this,e),this.Value=null,this.ColSpan=0,this.ReportTotal=-1,this.Children=new Array},D=function(e){_inherits(o,e);var t=_createSuper(o);function o(e,i){var l;return _classCallCheck(this,o),(l=t.call(this)).k=0,l.g=0,l.ColumnGroupsCnt=0,l.lstSb=new Array,l.ActualReportColumns=null,l.flgFirst=!1,l.iCol=0,l.iSameRowsCnt=0,l.iFirst_k=0,l.iCellCounter=0,l.dblTemp=0,l.AllowToSave=!1,l.LockCheckedChanged=!1,l.Report=e,l.ReportViewModel=i,l.MatrixAddTo=new a.e,l.MatrixAddTo.Label=s.a.GetResource("Matrix_AddTo"),l.MatrixAddTo.LblWidth="55",l.MatrixFields=new a.b,l.MatrixFields.LblWidth="0",l.MatrixFields.CheckedChangedCommand.Subscribe(_assertThisInitialized(l),"OnCheckedChanged"),l.MatrixRows=new a.e,l.MatrixRows.OptionsSize=4,l.MatrixRows.Label=s.a.GetResource("Rows"),l.MatrixColumns=new a.e,l.MatrixColumns.OptionsSize=4,l.MatrixColumns.Label=s.a.GetResource("Reports_Columns"),l.MatrixValues=new a.e,l.MatrixValues.OptionsSize=4,l.MatrixValues.Label=s.a.GetResource("Matrix_Values"),l.MatrixColFields=new a.e,l.MatrixColFields.OptionsSize=4,l.MatrixColFields.Label="Row Fields",l.ShowColumnSubTotal=new r.a,l.ShowColumnSubTotal.Label=s.a.GetResource("Matrix_ShowColumnReportTotal"),l.ShowColumnReportTotal=new r.a,l.ShowColumnReportTotal.Label=s.a.GetResource("Matrix_ShowColumnSubTotal"),l.ShowColumnReportTotal.IsChecked=!0,l.MatrixAddTo.Items.push(a.d.ComboBoxItems_2(s.a.GetResource("Rows"),"Rows")),l.MatrixAddTo.Items.push(a.d.ComboBoxItems_2(s.a.GetResource("Reports_Columns"),"Columns")),l.MatrixAddTo.Items.push(a.d.ComboBoxItems_2(s.a.GetResource("Matrix_Values"),"Values")),l.MatrixAddTo.Items.push(a.d.ComboBoxItems_2("Column Fields","ColFields")),l.MatrixAddTo.SelectedValue="Values",l.MatrixAddTo.SelectionChangedCommand.Subscribe(_assertThisInitialized(l),"OnAddToChange"),l}return _createClass(o,[{key:"LoadFields",value:function(e){var t,o=this,s=new Array;this.Report.ColumnSource.forEach((function(e){t=a.c.CheckedListBoxItem_3(e.HeaderText,e.ID),"FLOAT"==e.ColumnType||"INT"==e.ColumnType||"TIME"==e.ColumnType?(t.IsReadOnly=!0,s.push(t)):(t.IsReadOnly=!1,o.MatrixFields.Items.push(t))})),s.forEach((function(e){o.MatrixFields.Items.push(e)}));var l=i.e.String(e.MatrixXML);if(l.length>0){var n=new i.f;n.LoadXml(l),this.LockCheckedChanged=!0;var r=i.f.SelectSingleNodeText(n.DocumentElement,"Rows");i.e.IsEmpty(r)||r.split(",").forEach((function(e){var t=o.MatrixFields.Items.find((function(t){return t.Value==e}));t&&o.MatrixRows.Items.push(a.d.ComboBoxItems_2(t.Name,t.Value))})),r=i.f.SelectSingleNodeText(n.DocumentElement,"Columns"),i.e.IsEmpty(r)||r.split(",").forEach((function(e){var t=o.MatrixFields.Items.find((function(t){return t.Value==e}));t&&o.MatrixColumns.Items.push(a.d.ComboBoxItems_2(t.Name,t.Value))})),r=i.f.SelectSingleNodeText(n.DocumentElement,"Values"),i.e.IsEmpty(r)||r.split(",").forEach((function(e){var t=s.find((function(t){return t.Value==e}));t&&o.MatrixValues.Items.push(a.d.ComboBoxItems_2(t.Name,t.Value))})),r=i.f.SelectSingleNodeText(n.DocumentElement,"ColFields"),i.e.IsEmpty(r)||r.split(",").forEach((function(e){var t=o.MatrixFields.Items.find((function(t){return t.Value==e}));t&&o.MatrixColFields.Items.push(a.d.ComboBoxItems_2(t.Name,t.Value))})),this.ShowColumnSubTotal.IsChecked=null!=i.f.SelectSingleNode(n.DocumentElement,"ColumnTotals"),this.ShowColumnReportTotal.IsChecked=null==i.f.SelectSingleNode(n.DocumentElement,"HideColumnReportTotals"),this.LockCheckedChanged=!1}this.OnAddToChange(null)}},{key:"MoveDirection",value:function(e){var t=-1,o=null;if("RowsUp"==e||"RowsDown"==e?o=this.MatrixRows:"ColumnsUp"==e||"ColumnsDown"==e?o=this.MatrixColumns:"ValuesUp"==e||"ValuesDown"==e?o=this.MatrixValues:"ColFieldsUp"!=e&&"ColFieldsDown"!=e||(o=this.MatrixColFields),e.endsWith("Up")){if(0!=o.SelectedIndex&&-1!=o.SelectedIndex){t=o.SelectedIndex;var s=o.SelectedItem;o.Items.RemoveAt(t),o.Items.InsertAt(s,t-1),o.SelectedIndex=t-1,this.LoadMatrixReportByThread()}}else if(-1!=o.SelectedIndex&&o.SelectedIndex<o.Items.length-1){t=o.SelectedIndex;var i=o.SelectedItem;o.Items.InsertAt(i,t+2),o.Items.RemoveAt(t),o.SelectedIndex=o.Items.indexOf(i),this.LoadMatrixReportByThread()}}},{key:"OnAddToChange",value:function(e){var t=this;this.LockCheckedChanged=!0,this.MatrixFields.Items.forEach((function(e){e.IsChecked=!1,"ColFields"==t.MatrixAddTo.SelectedValue?(e.Enable=!0,t.MatrixColFields.Items.filter((function(t){return t.Value==e.Value})).length>0&&(e.IsChecked=!0)):"Values"==t.MatrixAddTo.SelectedValue?(e.Enable=e.IsReadOnly,t.MatrixValues.Items.filter((function(t){return t.Value==e.Value})).length>0&&(e.IsChecked=!0)):(e.Enable=!e.IsReadOnly,"Rows"==t.MatrixAddTo.SelectedValue?t.MatrixRows.Items.filter((function(t){return t.Value==e.Value})).length>0&&(e.IsChecked=!0):"Columns"==t.MatrixAddTo.SelectedValue&&t.MatrixColumns.Items.filter((function(t){return t.Value==e.Value})).length>0&&(e.IsChecked=!0))}));var o=this.MatrixFields.Items;this.MatrixFields.Items=null,this.MatrixFields.Items=o,this.LockCheckedChanged=!1}},{key:"SaveMatrixReport",value:function(e,t){var o=this,l={};e?(l.ReportID=this.Report.ReportID,l.SaveAsReportID=t.SaveAsID,l.ReportName=t.Name.Text):(l.ReportID=this.Report.ReportID,l.ReportName=this.Report.ScreenName);var n="";if(this.MatrixRows.Items.length>0||this.MatrixColumns.Items.length>0||this.MatrixValues.Items.length>0){n+="<Matrix>",n+="<Rows>";for(var a=0;a<this.MatrixRows.Items.length;a++)a>0&&(n+=","),n+=this.MatrixRows.Items[a].Value;n+="</Rows>",n+="<Columns>";for(var r=0;r<this.MatrixColumns.Items.length;r++)r>0&&(n+=","),n+=this.MatrixColumns.Items[r].Value;n+="</Columns>",n+="<Values>";for(var h=0;h<this.MatrixValues.Items.length;h++)h>0&&(n+=","),n+=this.MatrixValues.Items[h].Value;n+="</Values>",n+="<ColFields>";for(var u=0;u<this.MatrixColFields.Items.length;u++)u>0&&(n+=","),n+=this.MatrixColFields.Items[u].Value;n+="</ColFields>",this.ShowColumnSubTotal.IsChecked&&this.MatrixColumns.Items.length>1&&(n+="<ColumnTotals>"+this.MatrixColumns.Items[0].Value+"</ColumnTotals>"),this.ShowColumnReportTotal.IsChecked||(n+="<HideColumnReportTotals>"+this.MatrixColumns.Items[0].Value+"</HideColumnReportTotals>"),n+="</Matrix>"}l.MatrixXML=n.toString(),l.GUID=i.e.NewGuid(),s.a.report.SetMatrixReport(l,e).subscribe((function(e){o.Report.DisplayMessage=e.Message}))}},{key:"OnCheckedChanged",value:function(e){if(!this.LockCheckedChanged&&null!=e){var t,o=e.item,s=null,i=null;"Values"==this.MatrixAddTo.SelectedValue?s=this.MatrixValues:"ColFields"==this.MatrixAddTo.SelectedValue?s=this.MatrixColFields:"Rows"==this.MatrixAddTo.SelectedValue?(s=this.MatrixRows,i=this.MatrixColumns):"Columns"==this.MatrixAddTo.SelectedValue&&(s=this.MatrixColumns,i=this.MatrixRows),o.IsChecked?(s.Items.push(a.d.ComboBoxItems_2(o.Name,o.Value)),s==this.MatrixColFields?((t=this.MatrixValues.Items.find((function(e){return e.Value==o.Value})))&&this.MatrixValues.Items.Remove(t),(t=this.MatrixRows.Items.find((function(e){return e.Value==o.Value})))&&this.MatrixRows.Items.Remove(t),(t=this.MatrixColumns.Items.find((function(e){return e.Value==o.Value})))&&this.MatrixColumns.Items.Remove(t)):((t=this.MatrixColFields.Items.find((function(e){return e.Value==o.Value})))&&this.MatrixColFields.Items.Remove(t),i&&(t=i.Items.find((function(e){return e.Value==o.Value})))&&i.Items.Remove(t))):(t=s.Items.find((function(e){return e.Value==o.Value})))&&s.Items.Remove(t),this.LoadMatrixReportByThread()}}},{key:"GetColumnObject",value:function(e){return this.Report.ColumnSource.find((function(t){return t.ID==e}))}},{key:"LoadMatrixReportByThread",value:function(){this.process_DoWork(null,null)}},{key:"process_DoWork",value:function(e,t){null!=this.Report.ReportData&&0!=this.Report.ReportData.length?this.LoadMatrixReport(this.Report.ReportData,this.Report.ReportDataColumns):this.Report.DisplayMessage="No data exists."}},{key:"Reset",value:function(){var e=this;if(this.MatrixRows.Items.Clear(),this.MatrixColumns.Items.Clear(),this.MatrixValues.Items.Clear(),this.MatrixColFields.Items.Clear(),this.OnAddToChange(null),null!=this.ActualReportColumns){var t=new Array;this.ActualReportColumns.forEach((function(o){o.HeaderHeight=e.Report.HeaderHeight,t.push(o)})),this.Report.ReportColumns=t,this.Report.FilterorClear("ClearFilter")}}},{key:"LoadMatrixReport",value:function(e,t){var o=this;this.objColGroups=new Array(this.MatrixColumns.Items.length),this.objRowGroups=new Array(this.MatrixRows.Items.length),this.objValueColumns=new Array(this.MatrixValues.Items.length),this.objColFields=new Array(this.MatrixColFields.Items.length),this.arrColGroups=new Array(this.MatrixColumns.Items.length),this.arrRowGroups=new Array(this.MatrixRows.Items.length),this.arrColumns=new Array(this.MatrixValues.Items.length),this.arrColFields=new Array(this.MatrixColFields.Items.length);var s=new Array;if(this.Groupstr=new l.a,this.Report.DisplayMessage="",null==this.ActualReportColumns&&(this.ActualReportColumns=new Array,this.Report.ReportColumns.forEach((function(e){o.ActualReportColumns.push(e)}))),0!=this.objValueColumns.length)if(0!=e.length){this.strColGroups="";for(var n=function(e){o.arrColGroups[e]=o.MatrixColumns.Items[e].Value,o.objColGroups[e]=o.GetColumnObject(o.MatrixColumns.Items[e].Value).Clone(),s.push(o.MatrixColumns.Items[e].Value),o.Groupstr.push(o.MatrixColumns.Items[e].Value,null),o.strColGroups.length>0&&(o.strColGroups+=","),o.objColGroups[e].Formula.Contains("DATENAME")&&(C=o.Report.ColumnSourceALL.find((function(t){return"DATE"==t.ColumnType&&o.objColGroups[e].Formula.Contains(t.ID)})))?o.strColGroups+=C.ID:o.strColGroups+=o.MatrixColumns.Items[e].Value},a=0;a<this.MatrixColumns.Items.length;a++)n(a);var r="";this.strRowGroups="";for(var D=function(e){o.arrRowGroups[e]=o.MatrixRows.Items[e].Value,o.objRowGroups[e]=o.GetColumnObject(o.MatrixRows.Items[e].Value).Clone(),s.push(o.MatrixRows.Items[e].Value),o.Groupstr.push(o.MatrixRows.Items[e].Value,null),o.strRowGroups.length>0&&(o.strRowGroups+=",",r+=","),o.objRowGroups[e].Formula.Contains("DATENAME")&&(C=o.Report.ColumnSourceALL.find((function(t){return"DATE"==t.ColumnType&&o.objRowGroups[e].Formula.Contains(t.ID)})))?(o.strRowGroups+=o.MatrixRows.Items[e].Value,r+=C.ID):(o.strRowGroups+=o.MatrixRows.Items[e].Value,r+=o.MatrixRows.Items[e].Value)},d=0;d<this.MatrixRows.Items.length;d++){var C;D(d)}this.arrColumns=new Array(this.MatrixValues.Items.length);for(var p=0;p<this.MatrixValues.Items.length;p++)this.arrColumns[p]=this.MatrixValues.Items[p].Value,this.objValueColumns[p]=this.GetColumnObject(this.MatrixValues.Items[p].Value).Clone(),this.objValueColumns[p].FieldName=this.objValueColumns[p].ID;for(var T=0;T<this.MatrixColFields.Items.length;T++)this.arrColFields[T]=this.MatrixColFields.Items[T].Value,this.objColFields[T]=this.GetColumnObject(this.MatrixColFields.Items[T].Value).Clone();if(this.Report.SNo=0,this.Report.colSNoIndex=this.Report.ColumnSourceALL.indexOf(this.Report.ColumnSourceALL.find((function(e){return 0==i.e.stringCompare(e.Formula,"SNO",!0)}))),this.lstNodes=new Array,this.stkNodes=new Array,this.stkNodes_Summary=new Array,this.dv=e.Copy(),this.strColGroups.length>0&&this.dv.SortBy(this.strColGroups.split(",")),this.ColumnGroupsCnt=0,this.lstSb.Clear(),this.Report.ClearRows(),this.oColumns=new Array,this.k=0,this.arrColGroups.length>0&&(this.AddColumnNode(0,null),this.ShowColumnReportTotal.IsChecked&&(this.objTempNode=new c,this.objTempNode.Value=this.Report.GrpReportTotal.SubTotalPrefix[0],this.objTempNode.ReportTotal=100,this.lstNodes.push(this.objTempNode))),this.objRowGroups.length>0){var _=this.objRowGroups[0].Clone(),m=0;this.objRowGroups.forEach((function(e){e.width>m&&(m=e.width)})),_.width=m+15*(this.objRowGroups.length-1),_.HeaderText="",_.HeaderHeight=1,_.LinkType=h.a.None,this.oColumns.push(_),this.objColFields.forEach((function(e){(_=e.Clone()).HeaderText="",_.HeaderHeight=1,_.FieldName=_.ID,o.oColumns.push(_)}))}else this.objColFields=[],this.arrColFields=[];if(0==this.arrColGroups.length)this.objValueColumns.forEach((function(e){var t=e.Clone();t.HeaderText="",t.HeaderHeight=1,o.oColumns.push(t)}));else{for(var I=function(e){o.objValueColumns.forEach((function(t){var s=t.Clone();s.HeaderText="",s.ID=s.ID+"_"+e,s.HeaderHeight=1,s.MatixRepeatID=e.toString(),o.oColumns.push(s)}))},R=0;R<this.ColumnGroupsCnt;R++)I(R);this.ShowColumnReportTotal.IsChecked&&this.objValueColumns.forEach((function(e){var t=e.Clone();t.HeaderText="",t.ID=t.ID+"_"+i.e.NewGuid(),t.HeaderHeight=1,t.DataAppearance=o.Report.GrpReportTotal.SubTotalAppearance_Data.Clone(),t.DataAppearance.FontSize=t.DataAppearance.FontSize-1,o.Report.GrpReportTotal.TotalCols.ContainsKey(e.FieldName)||(t.HeaderAppearance.IsVisible=!1),o.oColumns.push(t)}))}this.Report.ReportColumns=this.oColumns;for(var S=0;S<this.arrColGroups.length;S++)this.oRow=new u.d(this.Report.ReportColumns.length),this.Report.RowHeight>0&&(this.oRow.Height=this.Report.RowHeight+4),this.lstSb.push(this.oRow);if(this.oRow=new u.d(this.Report.ReportColumns.length),this.Report.RowHeight>0&&(this.oRow.Height=this.Report.RowHeight+4),this.lstSb.push(this.oRow),0==this.arrColGroups.length)for(var A=0;A<this.objValueColumns.length;A++)this.oCell=this.arrRowGroups.length>0?this.lstSb[0].Cells[1+this.arrColFields.length+A]:this.lstSb[0].Cells[this.arrRowGroups.length+this.arrColFields.length+A],this.oCell.Text=this.objValueColumns[A].HeaderText,this.oCell.Value=this.objValueColumns[A].HeaderText,this.oCell.IsNormal=!1,this.oCell.CellAppearance=this.objValueColumns[A].HeaderAppearance;else{this.lstsbCounter=new Array(this.lstSb.length).fill(0);for(var M=0;M<this.lstsbCounter.length;M++)this.lstsbCounter[M]=this.arrRowGroups.length>0?1+this.arrColFields.length:0+this.arrColFields.length;for(this.k=0;this.k<this.lstNodes.length;this.k++)0==this.lstNodes[this.k].Children.length?this.lstNodes[this.k].ColSpan=this.arrColumns.length:this.SetColumnsSpan(this.lstNodes[this.k]),this.FillColumnsData(this.lstNodes[this.k],0)}for(var g=0;g<this.objColFields.length;g++)this.oCell=this.arrRowGroups.length>0?this.lstSb[this.lstSb.length-1].Cells[1+g]:this.lstSb[this.lstSb.length-1].Cells[g],this.oCell.Text=this.objColFields[g].HeaderText,this.oCell.Value=this.objColFields[g].HeaderText,this.oCell.IsNormal=!1,this.oCell.CellAppearance=this.objColFields[g].HeaderAppearance;this.objRowGroups.length>0&&(this.oCell=this.lstSb[this.lstSb.length-1].Cells[0],this.oCell.Text=this.objRowGroups[0].HeaderText,this.oCell.Value=this.objRowGroups[0].HeaderText,this.oCell.IsNormal=!1,this.oCell.CellAppearance=this.objRowGroups[0].HeaderAppearance,this.oCell.CellAppearance.Alignment="Left");for(var w=0;w<this.lstSb.length;w++)this.lstSb[w].Type=u.f.Header,this.Report.addRow(this.lstSb[w]);this.Report.refreshDataView();var f=this.strRowGroups;f.length>0&&this.strColGroups.length>0&&(f+=","),(f+=this.strColGroups).length>0&&this.dv.SortBy(f.split(","));for(var E=[],P=t.Copy(),y=!1,O=0,b=null,N=new Array(this.objValueColumns.length).fill(0),V=new Array(this.objColFields.length).fill(0),v=function(e){for(y=!1,o.g=0;o.g<s.length;o.g++)o.Groupstr[s[o.g]]!=o.dv[e][s[o.g]].toString()&&(o.Groupstr[s[o.g]]=o.dv[e][s[o.g]].toString(),y=!0);if(y||0==e){for(var t=0;t<o.objValueColumns.length;t++)N[t]=i.e.Double(o.dv[e][o.objValueColumns[t].ID]);for(var l=0;l<o.objColFields.length;l++)"FLOAT"!=o.objColFields[l].ColumnType&&"TIME"!=o.objColFields[l].ColumnType||(V[l]=i.e.Double(o.dv[e][o.objColFields[l].ID]));b={},P.forEach((function(t){b[t]=o.dv[e][t]})),E.push(b)}else{for(var n=0;n<o.objValueColumns.length;n++)O=i.e.Double(o.dv[e][o.objValueColumns[n].ID]),"TIME"==o.objValueColumns[n].DataAppearance.ColumnType||"$TOTALHOURS$"==o.objValueColumns[n].Formula?N[n]=o.ReportViewModel.GetHoursSum(O,N[n]):N[n]+=O,b[o.objValueColumns[n].ID]=N[n];for(var a=0;a<o.objColFields.length;a++)"FLOAT"!=o.objColFields[a].ColumnType&&"TIME"!=o.objColFields[a].ColumnType||(O=i.e.Double(o.dv[e][o.objColFields[a].ID]),"TIME"==o.objColFields[a].DataAppearance.ColumnType||"$TOTALHOURS$"==o.objColFields[a].Formula?V[a]=o.ReportViewModel.GetHoursSum(O,V[a]):V[a]+=O,b[o.objColFields[a].ID]=V[a])}},L=0;L<this.dv.length;L++)v(L);this.dv=E;var B=this.objValueColumns.filter((function(e){return!i.e.IsEmptySpace(e.Formula)&&2==e.EvaluateAtEnd}));if(B.length>0)for(var F=E.length-1;F>=0;F--)for(var G=0;G<B.length;G++)if(this.Report.CalculateFormula_2(B[G],E[F])){E.RemoveAt(F);break}if(this.strRowGroups!=r&&((f=r).length>0&&this.strColGroups.length>0&&(f+=","),f+=this.strColGroups,this.dv.SortBy(f.split(","))),this.k=0,this.g=0,this.iFirst_k=0,this.lstLabels=new Array,this.lstLabels_Summary=new Array,this.RowTotals=new Array(this.oColumns.length).fill(0),this.ColumnTotals=new Array(this.objValueColumns.length).fill(0),this.PrevColumnTotals=new Array(this.objValueColumns.length).fill(0),this.iCellCounter=this.arrColFields.length,this.oRow=null,this.arrRowGroups.length>0){if(this.addData(0),null!=this.oRow&&this.Report.addRow(this.oRow),this.Report.GrpReportTotal.SubTotalAppearance.IsVisible){this.oRow=new u.d(this.oColumns.length),this.oRow.Type=u.f.ReportTotal,this.oRow.Cells[0].Text=this.Report.GrpReportTotal.SubTotalPrefix[0],this.oRow.Cells[0].DataFormat=this.Report.GrpReportTotal.GroupFormat,this.oRow.Cells[0].CellAppearance=this.Report.GrpReportTotal.GroupAppearance,this.oRow.Cells[0].IsNormal=!1,this.Report.GrpReportTotal.SubTotalHeight>0&&(this.oRow.Height=this.Report.GrpReportTotal.SubTotalHeight);for(var x=1;x<this.oColumns.length;x++)if(this.oRow.Cells[x].DataFormat=this.oColumns[x].DataFormat,this.oRow.Cells[x].CellAppearance=this.Report.GrpReportTotal.SubTotalAppearance_Data,this.oRow.Cells[x].Border=this.Report.GrpReportTotal.SubTotalBorder,this.oRow.Cells[x].IsNormal=!1,this.Report.GrpReportTotal.TotalCols.ContainsKey(this.oColumns[x].FieldName))if(i.e.IsEmpty(this.oColumns[x].DataFormat.PercentageOn))this.ReportViewModel.SetCellValue(this.RowTotals[x],this.oColumns[x].DataFormat,this.oColumns[x].ColumnType,-1,this.oRow.Cells[x]);else{var W=0,k=this.RowTotals[x];if("REPORT_TOTAL"==this.oColumns[x].DataFormat.PercentageOn)W=0;else{var U=-1;for(U=x-1;U>=1;U--)if(0==this.arrColGroups.length){if(this.oColumns[U].ID==this.oColumns[x].DataFormat.PercentageOn)break}else if(this.oColumns[U].ID.startsWith(this.oColumns[x].DataFormat.PercentageOn+"_"))break;U>1&&(W=this.RowTotals[U])}if(k<=0||0==W)continue;W=100*k/W,this.ReportViewModel.SetCellValue(W,this.oColumns[x].DataFormat,this.oColumns[x].ColumnType,-1,this.oRow.Cells[x])}this.Report.addRow(this.oRow)}}else this.oRow=new u.d(this.oColumns.length),this.Report.RowHeight>0&&(this.oRow.Height=this.Report.RowHeight),this.k=this.dv.length-1,this.FillData(this.k),this.Report.addRow(this.oRow);this.Report.refreshDataView()}else this.Report.DisplayMessage="No data exists.";else this.Report.DisplayMessage="Please select atleast one value field"}},{key:"AddColumnNode",value:function(e,t){if(e<this.arrColGroups.length-1)this.objTempNode=new c,this.objTempNode.Value=this.dv[this.k][this.arrColGroups[e]].toString(),0==e?this.lstNodes.push(this.objTempNode):t.Children.push(this.objTempNode),this.stkNodes.push(this.objTempNode),this.AddColumnNode(e+1,this.objTempNode);else if(e==this.arrColGroups.length-1){for(var o=0;this.k<this.dv.length;this.k++,o++){if(0==o&&(this.objTempNode=new c,this.objTempNode.Value=this.dv[this.k][this.arrColGroups[e]].toString(),this.ColumnGroupsCnt++,0==e?this.lstNodes.push(this.objTempNode):t.Children.push(this.objTempNode)),this.k!=this.dv.length-1)for(this.g=0;this.g<=e&&this.dv[this.k+1][this.arrColGroups[this.g]].toString()==this.dv[this.k][this.arrColGroups[this.g]].toString();this.g++);if(this.g<e){this.k++;break}this.g==e&&(o=-1)}if(this.ShowColumnSubTotal.IsChecked&&(0==this.g||this.k==this.dv.length)&&this.arrColGroups.length>1){var s=new c;s.Value="TOTAL",s.ReportTotal=99,this.lstNodes.push(s),this.ColumnGroupsCnt++}if(this.k!=this.dv.length){for(var i=this.g;i<e;i++)this.objTempNode=this.stkNodes.pop();0==this.g?this.AddColumnNode(0,null):(this.objTempNode=this.stkNodes.pop(),this.stkNodes.push(this.objTempNode),this.AddColumnNode(this.g,this.objTempNode))}}else this.AddColumnNode(e+1,this.objTempNode)}},{key:"SetColumnsSpan",value:function(e){var t=this;e.Children.forEach((function(o){0==o.Children.length?(o.ColSpan=t.arrColumns.length,e.ColSpan+=t.arrColumns.length):(t.SetColumnsSpan(o),e.ColSpan+=o.ColSpan)}))}},{key:"FillColumnsData",value:function(e,t){var o=this;if(this.oCell=this.lstSb[t].Cells[this.lstsbCounter[t]],this.oCell.Text=e.Value,this.oCell.Value=e.Value,e.ColSpan>1&&(this.oCell.ColSpan=e.ColSpan),e.ReportTotal>0?99==e.ReportTotal?(this.oCell.IsNormal=!1,this.oCell.CellAppearance=this.objColGroups[t].DataAppearance):(t=this.objColGroups.length-1,this.oCell.IsNormal=!1,this.oCell.CellAppearance=this.oColumns[this.lstsbCounter[t]].DataAppearance.Clone(),this.oCell.CellAppearance.Alignment="Left"):(this.oCell.IsNormal=!1,this.oCell.CellAppearance=this.objColGroups[t].DataAppearance,this.objColGroups[t].LinkType==h.a.Document&&(this.oCell.CellAppearance.ColumnType="LINK_DOCUMENT")),t+1==this.arrColGroups.length)for(var s=0;s<this.MatrixValues.Items.length;s++)this.oCell=this.lstSb[t+1].Cells[this.lstsbCounter[t]+s],this.oCell.Text=this.MatrixValues.Items[s].Name,this.oCell.Value=this.MatrixValues.Items[s].Name,this.oCell.IsNormal=!1,this.oCell.CellAppearance=this.objValueColumns[s].HeaderAppearance.Clone();if(this.lstsbCounter[t]+=e.ColSpan,99==e.ReportTotal){for(var i=0;i<this.MatrixValues.Items.length;i++)this.oCell=this.lstSb[this.arrColGroups.length].Cells[this.lstsbCounter[this.arrColGroups.length-1]+i],this.oCell.Text=this.MatrixValues.Items[i].Name,this.oCell.Value=this.MatrixValues.Items[i].Name,this.oCell.IsNormal=!1,this.oCell.CellAppearance=this.objValueColumns[i].HeaderAppearance.Clone();for(var l=1;l<this.lstsbCounter.length;l++)this.lstsbCounter[l]+=e.ColSpan}e.Children.forEach((function(e){o.FillColumnsData(e,t+1)}))}},{key:"addData",value:function(e){if(this.iCellCounter=1+this.objColFields.length,this.oRow=new u.d(this.oColumns.length),this.oRow.LevelNo=e,this.oRow.Cells[0].level=this.oRow.LevelNo,this.oRow.Cells[0].IsNormal=!1,this.Report.RowHeight>0&&(this.oRow.Height=this.Report.RowHeight),this.objRowGroups[e].LinkType==h.a.Document&&e==this.arrRowGroups.length-1&&(null==this.oRow.Cells[0].CellAppearance&&(this.oRow.Cells[0].CellAppearance=this.Report.ReportColumns[0].DataAppearance.Clone()),this.oRow.Cells[0].CellAppearance.ColumnType="LINK_DOCUMENT"),this.ReportViewModel.SetCellValue(this.dv[this.k][this.arrRowGroups[e]],this.objRowGroups[e].DataFormat,this.objRowGroups[e].ColumnType,-1,this.oRow.Cells[0]),e<this.arrRowGroups.length-1&&(this.ApplyGroupStyle(this.oRow),this.objRowGroups[e].LinkType==h.a.Document&&(this.oRow.Cells[0].CellAppearance.ColumnType="LINK_DOCUMENT"),this.oRow.Type=u.f.Group,this.FillData_Summary(e),this.Report.addRow(this.oRow)),e==this.arrRowGroups.length-1){this.flgFirst=0!=e;for(var t=0;this.k<this.dv.length;this.k++,t++){if(0==t)if(this.flgFirst)this.flgFirst=!1,this.ReportViewModel.SetCellValue(this.dv[this.k][this.arrRowGroups[e]],this.objRowGroups[e].DataFormat,this.objRowGroups[e].ColumnType,-1,this.oRow.Cells[0]),-1!=this.Report.colSNoIndex&&(this.oRow.Cells[0].Text=++this.Report.SNo+". "+this.oRow.Cells[0].Text);else{for(this.iCellCounter=1+this.objColFields.length,this.oRow=new u.d(this.oColumns.length),this.oRow.LevelNo=e,this.oRow.Cells[0].IsNormal=!1,this.oRow.Cells[0].level=this.oRow.LevelNo,this.Report.RowHeight>0&&(this.oRow.Height=this.Report.RowHeight),this.iCol=0;this.iCol<=e;this.iCol++)this.iCol==e&&(this.objRowGroups[e].LinkType==h.a.Document&&(null==this.oRow.Cells[0].CellAppearance&&(this.oRow.Cells[0].CellAppearance=this.Report.ReportColumns[0].DataAppearance.Clone()),this.oRow.Cells[0].CellAppearance.ColumnType="LINK_DOCUMENT"),this.ReportViewModel.SetCellValue(this.dv[this.k][this.arrRowGroups[e]],this.objRowGroups[e].DataFormat,this.objRowGroups[e].ColumnType,-1,this.oRow.Cells[0]));-1!=this.Report.colSNoIndex&&e==this.arrRowGroups.length-1&&(this.oRow.Cells[0].Text=++this.Report.SNo+". "+this.oRow.Cells[0].Text)}if(this.k!=this.dv.length-1){for(this.g=0;this.g<=e&&i.e.String(this.dv[this.k+1][this.arrRowGroups[this.g]])==i.e.String(this.dv[this.k][this.arrRowGroups[this.g]]);this.g++);if(this.g<e){this.FillData(t),this.k++,this.Report.addRow(this.oRow);break}this.g==e&&(this.FillData(t),this.Report.addRow(this.oRow),t=-1)}else this.FillData(t)}this.k!=this.dv.length&&(this.iFirst_k=this.g,this.addData(this.g))}else this.addData(e+1)}},{key:"FillData",value:function(e){for(var t=0;t<this.ColumnTotals.length;t++)this.ColumnTotals[t]=0,this.PrevColumnTotals[t]=0;this.iSameRowsCnt=e+1;for(var o=0;o<this.lstNodes.length;o++)this.lstLabels.Clear(),this.FillCellData(this.lstNodes[o],0);var s,l;if(0==this.lstNodes.length)for(s=0;s<this.iSameRowsCnt;s++)for(l=0;l<this.objValueColumns.length;l++,this.iCellCounter++){if(i.e.IsEmpty(this.objValueColumns[l].DataFormat.PercentageOn))this.ReportViewModel.SetCellValue(this.dv[this.k-s][this.objValueColumns[l].ID],this.objValueColumns[l].DataFormat,this.objValueColumns[l].ColumnType,-1,this.oRow.Cells[this.iCellCounter]),this.Report.ApplyKPI_Matrix(this.dv[this.k-s],this.oRow.Cells[this.iCellCounter],this.objValueColumns[l],this.iCellCounter);else{var n,a=0;if(n=i.e.Double(this.dv[this.k-s][this.objValueColumns[l].ID]),a="REPORT_TOTAL"==this.objValueColumns[l].DataFormat.PercentageOn?0:i.e.Double(this.dv[this.k-s][this.objValueColumns[l].DataFormat.PercentageOn]),n<=0||0==a)continue;a=100*n/a,this.ReportViewModel.SetCellValue(a,this.objValueColumns[l].DataFormat,this.objValueColumns[l].ColumnType,-1,this.oRow.Cells[this.iCellCounter])}i.e.IsNum(this.dv[this.k-s][this.objValueColumns[l].ID])&&(this.dblTemp=i.e.Double(this.dv[this.k-s][this.objValueColumns[l].ID]),"TIME"==this.objValueColumns[l].DataAppearance.ColumnType||"$TOTALHOURS$"==this.objValueColumns[l].Formula?(this.RowTotals[this.iCellCounter]=this.ReportViewModel.GetHoursSum(this.dblTemp,this.RowTotals[this.iCellCounter]),this.ColumnTotals[l]=this.ReportViewModel.GetHoursSum(this.dblTemp,this.ColumnTotals[l])):(this.RowTotals[this.iCellCounter]+=this.dblTemp,this.ColumnTotals[l]+=this.dblTemp))}if(this.objColFields.length>0){var r,h,u=new Array(this.objColFields.length).fill(0);for(r=0;r<this.iSameRowsCnt;r++)for(h=0;h<this.objColFields.length;h++)this.ReportViewModel.SetCellValue(this.dv[this.k-r][this.objColFields[h].ID],this.objColFields[h].DataFormat,this.objColFields[h].ColumnType,-1,this.oRow.Cells[1+h]),"FLOAT"==this.objColFields[h].ColumnType?(this.dblTemp=i.e.Double(this.dv[this.k-r][this.objColFields[h].ID]),this.dblTemp=this.Report.RoundOff_2(this.dblTemp,this.objColFields[h].DataFormat),0==this.objColFields[h].UseOnce?(this.RowTotals[1+h]+=this.dblTemp,u[h]+=this.dblTemp,this.ReportViewModel.SetCellValue(u[h],this.objColFields[h].DataFormat,this.objColFields[h].ColumnType,-1,this.oRow.Cells[1+h])):0==r&&(this.RowTotals[1+h]+=this.dblTemp)):"TIME"!=this.objColFields[h].DataAppearance.ColumnType&&"$TOTALHOURS$"!=this.objColFields[h].Formula||i.e.IsNum(this.dv[this.k-r][this.objColFields[h].ID])&&(this.dblTemp=i.e.Double(this.dv[this.k-r][this.objColFields[h].ID]),this.dblTemp=this.Report.RoundOff_2(this.dblTemp,this.objColFields[h].DataFormat),this.RowTotals[1+h]=this.ReportViewModel.GetHoursSum(this.dblTemp,this.RowTotals[1+h]))}}},{key:"FillCellData",value:function(e,t){var o=this;if(100==e.ReportTotal)for(var s=0;s<this.objValueColumns.length;s++,this.iCellCounter++){if(i.e.IsEmpty(this.objValueColumns[s].DataFormat.PercentageOn))this.ReportViewModel.SetCellValue(this.ColumnTotals[s],this.objValueColumns[s].DataFormat,this.objValueColumns[s].ColumnType,-1,this.oRow.Cells[this.iCellCounter]);else{var l=0,n=this.ColumnTotals[s];if("REPORT_TOTAL"==this.objValueColumns[s].DataFormat.PercentageOn)l=0;else{var a=-1;for(a=0;a<this.objValueColumns.length&&this.objValueColumns[a].ID!=this.objValueColumns[s].DataFormat.PercentageOn;a++);a<this.objValueColumns.length&&(l=this.ColumnTotals[a])}if(n<=0||0==l)continue;l=100*n/l,this.ReportViewModel.SetCellValue(l,this.objValueColumns[s].DataFormat,this.objValueColumns[s].ColumnType,-1,this.oRow.Cells[this.iCellCounter])}"TIME"==this.objValueColumns[s].DataAppearance.ColumnType||"$TOTALHOURS$"==this.objValueColumns[s].Formula?this.RowTotals[this.iCellCounter]=this.ReportViewModel.GetHoursSum(this.ColumnTotals[s],this.RowTotals[this.iCellCounter]):this.RowTotals[this.iCellCounter]+=this.ColumnTotals[s]}else if(99==e.ReportTotal)for(var r=0;r<this.objValueColumns.length;r++,this.iCellCounter++)"TIME"==this.objValueColumns[r].DataAppearance.ColumnType||"$TOTALHOURS$"==this.objValueColumns[r].Formula?(this.dblTemp=this.ReportViewModel.GetHoursSum(this.ColumnTotals[r],-this.PrevColumnTotals[r]),this.ReportViewModel.SetCellValue(this.dblTemp,this.objValueColumns[r].DataFormat,this.objValueColumns[r].ColumnType,-1,this.oRow.Cells[this.iCellCounter]),this.RowTotals[this.iCellCounter]=this.ReportViewModel.GetHoursSum(this.dblTemp,this.RowTotals[this.iCellCounter])):(this.ReportViewModel.SetCellValue(this.ColumnTotals[r]-this.PrevColumnTotals[r],this.objValueColumns[r].DataFormat,this.objValueColumns[r].ColumnType,-1,this.oRow.Cells[this.iCellCounter]),this.RowTotals[this.iCellCounter]+=this.ColumnTotals[r]-this.PrevColumnTotals[r]),this.PrevColumnTotals[r]=this.ColumnTotals[r];else{if(this.lstLabels.push(e.Value),0==e.Children.length){var h,u;for(h=0;h<this.iSameRowsCnt;h++){for(u=0;u<this.arrColGroups.length&&this.lstLabels[u]==this.dv[this.k-h][this.arrColGroups[u]].toString();u++);if(u==this.arrColGroups.length)break}if(h!=this.iSameRowsCnt)for(u=0;u<this.objValueColumns.length;u++,this.iCellCounter++){if(i.e.IsEmpty(this.objValueColumns[u].DataFormat.PercentageOn))this.ReportViewModel.SetCellValue(this.dv[this.k-h][this.objValueColumns[u].ID],this.objValueColumns[u].DataFormat,this.objValueColumns[u].ColumnType,-1,this.oRow.Cells[this.iCellCounter]),this.Report.ApplyKPI_Matrix(this.dv[this.k-h],this.oRow.Cells[this.iCellCounter],this.objValueColumns[u],this.iCellCounter);else{var c,D=0;if(c=i.e.Double(this.dv[this.k-h][this.objValueColumns[u].ID]),D="REPORT_TOTAL"==this.objValueColumns[u].DataFormat.PercentageOn?0:i.e.Double(this.dv[this.k-h][this.objValueColumns[u].DataFormat.PercentageOn]),c<=0||0==D)continue;D=100*c/D,this.ReportViewModel.SetCellValue(D,this.objValueColumns[u].DataFormat,this.objValueColumns[u].ColumnType,-1,this.oRow.Cells[this.iCellCounter])}i.e.IsNum(this.dv[this.k-h][this.objValueColumns[u].ID])&&(this.dblTemp=i.e.Double(this.dv[this.k-h][this.objValueColumns[u].ID]),"TIME"==this.objValueColumns[u].DataAppearance.ColumnType||"$TOTALHOURS$"==this.objValueColumns[u].Formula?(this.RowTotals[this.iCellCounter]=this.ReportViewModel.GetHoursSum(this.dblTemp,this.RowTotals[this.iCellCounter]),this.ColumnTotals[u]=this.ReportViewModel.GetHoursSum(this.dblTemp,this.ColumnTotals[u])):(this.dblTemp=this.Report.RoundOff_2(this.dblTemp,this.objValueColumns[u].DataFormat),this.RowTotals[this.iCellCounter]+=this.dblTemp,this.ColumnTotals[u]+=this.dblTemp))}else this.iCellCounter+=this.objValueColumns.length}e.Children.forEach((function(e){o.FillCellData(e,t+1),o.lstLabels.RemoveAt(o.lstLabels.length-1)}))}}},{key:"FillData_Summary",value:function(e){if(0==this.lstNodes.length){var t,o,s=new Array(this.objValueColumns.length).fill(0),l=new Array(this.objColFields.length).fill(0);for(o=0;o<=e;o++)this.Groupstr[this.arrRowGroups[o]]=this.dv[this.k][this.arrRowGroups[o]].toString();for(t=this.k;t<this.dv.length;t++){for(o=0;o<=e&&this.Groupstr[this.arrRowGroups[o]]==this.dv[t][this.arrRowGroups[o]].toString();o++);if(o<=e)break;if(t==this.k){for(var n=0;n<this.objValueColumns.length;n++)s[n]=i.e.Double(this.dv[t][this.objValueColumns[n].ID]);for(var a=0;a<this.objColFields.length;a++)"FLOAT"!=this.objColFields[a].ColumnType&&"TIME"!=this.objColFields[a].ColumnType&&"$TOTALHOURS$"!=this.objColFields[a].Formula||(l[a]=i.e.Double(this.dv[t][this.objColFields[a].ID]))}else{for(var r=0;r<this.objValueColumns.length;r++)this.dblTemp=i.e.Double(this.dv[t][this.objValueColumns[r].ID]),"TIME"==this.objValueColumns[r].ColumnType||"$TOTALHOURS$"==this.objValueColumns[r].Formula?s[r]=this.ReportViewModel.GetHoursSum(this.dblTemp,s[r]):(this.dblTemp=this.Report.RoundOff_2(this.dblTemp,this.objValueColumns[r].DataFormat),s[r]+=this.dblTemp);for(var h=0;h<this.objColFields.length;h++)"FLOAT"==this.objColFields[h].ColumnType?(this.dblTemp=i.e.Double(this.dv[t][this.objColFields[h].ID]),this.dblTemp=this.Report.RoundOff_2(this.dblTemp,this.objColFields[h].DataFormat),l[h]+=this.dblTemp):"TIME"!=this.objColFields[h].ColumnType&&"$TOTALHOURS$"!=this.objColFields[h].Formula||(this.dblTemp=i.e.Double(this.dv[t][this.objColFields[h].ID]),this.dblTemp=this.Report.RoundOff_2(this.dblTemp,this.objColFields[h].DataFormat),l[h]=this.ReportViewModel.GetHoursSum(this.dblTemp,l[h]))}}for(o=0;o<this.objValueColumns.length;o++)if(i.e.IsEmpty(this.objValueColumns[o].DataFormat.PercentageOn))this.ReportViewModel.SetCellValue(s[o],this.objValueColumns[o].DataFormat,this.objValueColumns[o].ColumnType,-1,this.oRow.Cells[o+1+this.arrColFields.length]);else{var u=0,c=s[o];if("REPORT_TOTAL"==this.objValueColumns[o].DataFormat.PercentageOn)u=0;else{var D=-1;for(D=0;D<this.objValueColumns.length&&this.objValueColumns[D].ID!=this.objValueColumns[o].DataFormat.PercentageOn;D++);D<this.objValueColumns.length&&(u=s[D])}if(c<=0||0==u)continue;u=100*c/u,this.ReportViewModel.SetCellValue(u,this.objValueColumns[o].DataFormat,this.objValueColumns[o].ColumnType,-1,this.oRow.Cells[o+1+this.arrColFields.length])}for(o=0;o<this.objColFields.length;o++)if("FLOAT"==this.objColFields[o].ColumnType||"TIME"==this.objColFields[o].ColumnType||"$TOTALHOURS$"==this.objColFields[o].Formula)if(i.e.IsEmpty(this.objColFields[o].DataFormat.PercentageOn))this.ReportViewModel.SetCellValue(l[o],this.objColFields[o].DataFormat,this.objColFields[o].ColumnType,-1,this.oRow.Cells[o+1]);else{var d=0,C=l[o];if("REPORT_TOTAL"==this.objColFields[o].DataFormat.PercentageOn)d=0;else{var p=-1;for(p=0;p<this.objColFields.length&&this.objColFields[p].ID!=this.objColFields[o].DataFormat.PercentageOn;p++);p<this.objColFields.length&&(d=l[p])}if(C<=0||0==d)continue;d=100*C/d,this.ReportViewModel.SetCellValue(d,this.objColFields[o].DataFormat,this.objColFields[o].ColumnType,-1,this.oRow.Cells[o+1])}}else{for(var T=0;T<this.ColumnTotals.length;T++)this.ColumnTotals[T]=0,this.PrevColumnTotals[T]=0;for(var _=0;_<this.lstNodes.length;_++)this.lstLabels_Summary.Clear(),this.FillCellData_Summary(this.lstNodes[_],e,0)}}},{key:"FillCellData_Summary",value:function(e,t,o){var s=this;if(100==e.ReportTotal)for(var l=0;l<this.objValueColumns.length;l++,this.iCellCounter++)if(i.e.IsEmpty(this.objValueColumns[l].DataFormat.PercentageOn))this.ReportViewModel.SetCellValue(this.ColumnTotals[l],this.objValueColumns[l].DataFormat,this.objValueColumns[l].ColumnType,-1,this.oRow.Cells[this.iCellCounter]);else{var n=0,a=this.ColumnTotals[l];if("REPORT_TOTAL"==this.objValueColumns[l].DataFormat.PercentageOn)n=0;else{var r=-1;for(r=0;r<this.objValueColumns.length&&this.objValueColumns[r].ID!=this.objValueColumns[l].DataFormat.PercentageOn;r++);r<this.objValueColumns.length&&(n=this.ColumnTotals[r])}if(a<=0||0==n)continue;n=100*a/n,this.ReportViewModel.SetCellValue(n,this.objValueColumns[l].DataFormat,this.objValueColumns[l].ColumnType,-1,this.oRow.Cells[this.iCellCounter])}else if(99==e.ReportTotal)for(var h=0;h<this.objValueColumns.length;h++,this.iCellCounter++)this.ReportViewModel.SetCellValue(this.ColumnTotals[h]-this.PrevColumnTotals[h],this.objValueColumns[h].DataFormat,this.objValueColumns[h].ColumnType,-1,this.oRow.Cells[this.iCellCounter]),this.PrevColumnTotals[h]=this.ColumnTotals[h];else this.stkNodes_Summary.push(e),this.lstLabels_Summary.push(e.Value),0==e.Children.length&&function(){new Array(s.objValueColumns.length).fill(0);var e,o=s.dv;for(e=0;e<s.lstLabels_Summary.length;e++)o=o.filter((function(t){return t[s.arrColGroups[e]]==s.lstLabels_Summary[e].toString().Replace("'","''")}));for(e=0;e<=t;e++)o=o.filter((function(t){return t[s.arrRowGroups[e]]==s.dv[s.k][s.arrRowGroups[e]].toString().Replace("'","''")}));for(e=0;e<s.objValueColumns.length;e++,s.iCellCounter++){var l=void 0;if("TIME"==s.objValueColumns[e].ColumnType||"$TOTALHOURS$"==s.objValueColumns[e].Formula?function(){var t=0;s.dv.forEach((function(o){null!=o[s.objValueColumns[e].ID]&&(s.dblTemp=i.e.Double(o[s.objValueColumns[e].ID]),t=s.ReportViewModel.GetHoursSum(s.dblTemp,t))})),l=t}():l=o.Compute("sum",s.objValueColumns[e].ID),null!=l){if(i.e.IsEmpty(s.objValueColumns[e].DataFormat.PercentageOn))s.ReportViewModel.SetCellValue(l,s.objValueColumns[e].DataFormat,s.objValueColumns[e].ColumnType,-1,s.oRow.Cells[s.iCellCounter]);else{var n=0,a=parseFloat(l);if("REPORT_TOTAL"==s.objValueColumns[e].DataFormat.PercentageOn)n=0;else{var r=-1;for(r=0;r<s.objValueColumns.length&&s.objValueColumns[r].ID!=s.objValueColumns[e].DataFormat.PercentageOn;r++);if(r<s.objValueColumns.length){r++;var h=s.oRow.Cells[s.iCellCounter-(s.objValueColumns.length-r)].Value;null!=h&&(n=i.e.Double(h))}}if(a<=0||0==n)continue;n=100*a/n,s.ReportViewModel.SetCellValue(n,s.objValueColumns[e].DataFormat,s.objValueColumns[e].ColumnType,-1,s.oRow.Cells[s.iCellCounter])}"TIME"==s.objValueColumns[e].ColumnType||"$TOTALHOURS$"==s.objValueColumns[e].Formula?s.ColumnTotals[e]=s.ReportViewModel.GetHoursSum(parseFloat(l),s.ColumnTotals[e]):s.ColumnTotals[e]+=parseFloat(l)}else s.ReportViewModel.SetCellValue(0,s.objValueColumns[e].DataFormat,s.objValueColumns[e].ColumnType,-1,s.oRow.Cells[s.iCellCounter])}}();e.Children.forEach((function(e){s.FillCellData_Summary(e,t,o+1),s.lstLabels_Summary.RemoveAt(s.lstLabels_Summary.length-1)}))}},{key:"ApplyGroupStyle",value:function(e){var t=new u.a;t.IsBold=!1,t.ForeColor="#FF0081A6",t.BackColor="White",t.FontFamilyName="Arial",t.FontSize=12,t.Alignment="Right",e.Cells.forEach((function(e){e.IsNormal=!1,e.CellAppearance=t.Clone()})),this.objRowGroups.length>0&&(e.Cells[0].CellAppearance.Alignment="Left")}}]),o}(n.b)},ThYU:function ThYU(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"ReportViewModel",(function(){return _ReportViewModel})),__webpack_require__.d(__webpack_exports__,"Group",(function(){return Group}));var tslib__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("mrSG"),_services_base_service__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("Do2H"),_services_formula_service__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("uMy8"),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("Lp6j"),_util_dictionary__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("vTM8"),angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("eQJW"),_IPrefetchFilter__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("/G+I"),_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("mvPR"),_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("dH+5"),_shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("0/4Q"),_shared_models_controls_PactButtonData__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("NkMH"),_shared_models_controls_PactRadioButtonData__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("PDNK"),_shared_models_controls_PactDatePickerData__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("JIg3"),_shared_models_controls_PactControlData__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("4HhE"),_shared_models_controls_PactListBoxData__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("n56n"),_shared_models_controls_PactLinkData__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("FruK"),_shared_models_controls_PactTextBlockData__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("Agar"),_Models_PostDataField__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("x+Dt"),_vptdialog_VPTDialogViewModel__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("ia84"),_add_edit_filter_AddEditFilterViewModel__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("XPEG"),_static_report_filter_StaticReportFilterViewModel__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("OHLA"),_Models_ReportColumnProperties__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("USNh"),_costcenter_picker_CostCenterPicker__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__("ktgv"),_StaticReports_ACC_GeneralLedger__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__("WqAs"),util__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__("MCLT"),util__WEBPACK_IMPORTED_MODULE_24___default=__webpack_require__.n(util__WEBPACK_IMPORTED_MODULE_24__),_shared_models_controls_PactTextBoxData__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__("EQd/"),_services_session_manager_service__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__("7N07"),_shared_controls_tree_TreeNode__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__("ZDA+"),_pages_home_RibbonExtViewModel__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__("CUWK"),_costcenter_filter_CostCenterFilter__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__("7JXL"),_MatrixReport__WEBPACK_IMPORTED_MODULE_30__=__webpack_require__("RiXB"),_document_viewer_DocumentViewerViewModel__WEBPACK_IMPORTED_MODULE_31__=__webpack_require__("RQ5z"),_document_viewer_document_viewer_component__WEBPACK_IMPORTED_MODULE_32__=__webpack_require__("8GKY"),_StaticReports_StaticReportsViewModel__WEBPACK_IMPORTED_MODULE_33__=__webpack_require__("1xwR"),_send_email_sms_send_email_sms_component__WEBPACK_IMPORTED_MODULE_34__=__webpack_require__("7i9q"),_send_email_sms_SendEmailSMSViewModel__WEBPACK_IMPORTED_MODULE_35__=__webpack_require__("wnwj"),_StaticReports_INV_StockLedger__WEBPACK_IMPORTED_MODULE_36__=__webpack_require__("Zgxw"),_StaticReports_REN_Property__WEBPACK_IMPORTED_MODULE_37__=__webpack_require__("4Moq"),_StaticReports_ACC_BillWiseReports__WEBPACK_IMPORTED_MODULE_38__=__webpack_require__("/nZE"),_StaticReportsTemp_ACC_PLTemplate__WEBPACK_IMPORTED_MODULE_39__=__webpack_require__("Cma4"),_re_order_level_ReOrderLevelNewViewModel__WEBPACK_IMPORTED_MODULE_40__=__webpack_require__("BBu9"),_re_order_level_re_order_level_component__WEBPACK_IMPORTED_MODULE_41__=__webpack_require__("TacQ"),_document_document_flow_chart_DocumentFlowChartViewModel__WEBPACK_IMPORTED_MODULE_42__=__webpack_require__("d36O"),_document_document_flow_chart_document_flow_chart_component__WEBPACK_IMPORTED_MODULE_43__=__webpack_require__("oiZC"),_report_view_component__WEBPACK_IMPORTED_MODULE_44__=__webpack_require__("YU11"),_row_details_RowDetailsDialogViewModel__WEBPACK_IMPORTED_MODULE_45__=__webpack_require__("2BcO"),_row_details_row_details_component__WEBPACK_IMPORTED_MODULE_46__=__webpack_require__("7ODK"),_save_as_dialog_SaveAsDialogViewModel__WEBPACK_IMPORTED_MODULE_47__=__webpack_require__("l3BA"),_save_as_dialog_save_as_dialog_component__WEBPACK_IMPORTED_MODULE_48__=__webpack_require__("jp4k"),_approve_approve_component__WEBPACK_IMPORTED_MODULE_49__=__webpack_require__("Br+L"),_approve_ApproveViewModel__WEBPACK_IMPORTED_MODULE_50__=__webpack_require__("zQUM"),_static_report_filter_ReportFilterDialog__WEBPACK_IMPORTED_MODULE_51__=__webpack_require__("8iaB"),_StaticReports_PAY_Reports__WEBPACK_IMPORTED_MODULE_52__=__webpack_require__("nif3"),_send_email_sms_Notifications__WEBPACK_IMPORTED_MODULE_53__=__webpack_require__("/EUh"),_ReportViewModel=function(_IPrefetchFilter__WEB){_inherits(ReportViewModel,_IPrefetchFilter__WEB);var _super7=_createSuper(ReportViewModel);function ReportViewModel(){var e;return _classCallCheck(this,ReportViewModel),(e=_super7.call(this)).Data=[],e.slickrowid=0,e.AgGridEnable=!1,e.HideReportAtLoad=!1,e.RptListShow=!0,e.PrintCallBack=new _shared_models_controls_PactControlData__WEBPACK_IMPORTED_MODULE_13__.b,e.SubTotalCallBack=null,e.SubTotalBeforeCallBack=null,e.ContextMenuItems=[],e.RefreshGridColumns=new _shared_models_controls_PactControlData__WEBPACK_IMPORTED_MODULE_13__.b,e.AllowDrop=!1,e._ShowReportFilter=!1,e._ReportFilterSelectAll=!0,e.ShowMatrixPanel=!1,e.ShowMatrixButtonVisible=!0,e.ShowExport=!1,e.RptHeight=NaN,e.RptWidth=NaN,e.ShowQuery=!1,e.ShowTransactionQuery=!1,e.ShowLinkingQuery=!1,e.SearchVisibility=!0,e.ColumnSpan="4",e._SelectedRow=null,e.SearchColumns=new _shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__.e(0),e.AccountDrillDownObject=null,e.ShowAccountDrillDown=!1,e._LoadingVisibility=!1,e.IsReportLoad=!1,e.OptionIndexObj=new _shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__.e,e.SaveWord=new _shared_models_controls_PactRadioButtonData__WEBPACK_IMPORTED_MODULE_11__.a("LW Document",10,"LW Document"),e.SaveXLS=new _shared_models_controls_PactRadioButtonData__WEBPACK_IMPORTED_MODULE_11__.a("LW Document",10,"LW Document"),e.SaveXLSX=new _shared_models_controls_PactRadioButtonData__WEBPACK_IMPORTED_MODULE_11__.a("LW Document",10,"LW Document"),e.SaveHTML=new _shared_models_controls_PactRadioButtonData__WEBPACK_IMPORTED_MODULE_11__.a("LW Document",10,"LW Document"),e.SavePDF=new _shared_models_controls_PactRadioButtonData__WEBPACK_IMPORTED_MODULE_11__.a("LW Document",10,"LW Document"),e.SaveText=_shared_models_controls_PactTextBoxData__WEBPACK_IMPORTED_MODULE_25__.d.PactTextBoxData_2("LW Document",10),e.SaveToExistXLS=new _shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__.e,e.PreProcessReport=new _shared_models_controls_PactRadioButtonData__WEBPACK_IMPORTED_MODULE_11__.a("LW Document",10,"LW Document"),e.MSAccessExport=new _shared_models_controls_PactRadioButtonData__WEBPACK_IMPORTED_MODULE_11__.a("LW Document",10,"LW Document"),e.ExportList=new _shared_models_controls_PactRadioButtonData__WEBPACK_IMPORTED_MODULE_11__.b,e.hiddenTotals=[],e.PercentTotals=null,e.IsSummary=!1,e.IsReportCollapsable=!0,e.IsTotalColsAdded=!1,e.PercentColumnExists=!1,e.HidePrefetch=!1,e.FormulasCalculated=!1,e.IsTreeDataCalculated=!1,e.IsFilterRendering=!1,e.TreeGroupPrint=!0,e.IsDocMapXMLExists=!1,e.HideRightNavigation=!1,e.IsReportDB=!1,e.CanSelectRows=!1,e.lstGroup=[],e.Groupstr=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a,e.TotalCols=[],e.RowHeight=0,e.SubRowHeight=0,e.HeaderHeight=1,e.ShowGridLines="",e.VerticalAlignment="Bottom",e.ReportID=0,e.ReturnType=0,e.SNo=0,e.colSNoIndex=-1,e.StatusDocID=0,e.TotalRowCount=0,e.MaxRowsUnder=0,e.STMaxRowsUnder=[0,0,0,0,0],e.TopRecords=0,e.CumulativeIndex=-1,e.PrintonLang=0,e.TreeTotalBorder=0,e.GrpReportTotal=new Group,e._ReportData=[],e.ReportDataColumns=[],e.ReportNoDataGroups=null,e.ReportNoDataGroupColumnss=null,e.ReportDoc=null,e.eval=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.b,e.FromDatePicker=null,e.ToDatePicker=null,e.BackTrackType="",e.CumulativeColumn="",e.ReportQuery=null,e.ReportDims="",e.FormulaColumns=[],e.ColumnFilters=[],e.HiddenNumericColumns=[],e.process=new _shared_models_controls_PactControlData__WEBPACK_IMPORTED_MODULE_13__.a,e.processArgs={},e.ShowHeaderButtons=!1,e.HidePostFilters=!1,e.DispayAsPopup=!1,e.QueryProductID=0,e.QueryProductCCWhere="",e.QueryProductCCXML="",e.QueryTimer=null,e.QueryReportPref=null,e.QueryDocumentsVisibility=!1,e.QueryMastersVisibility=!1,e.QueryFieldsVisibility=!1,e.dvQueryFields=null,e.dvQueryFieldsTable=null,e.sbQueryFields="",e.FilterText=[],e.DBPanel=null,e.ComparisonQuotationVisible=!1,e.ComparisonINTERQTN="",e.ComparisonGrid=null,e._RefreshVisibility=!0,e.RegenerateVisibility=!0,e.PriceChartVisibility=!1,e.Chart=null,e.xDocMap=null,e.xMapXML=null,e.ChildReports=[],e.dicColumnIndex=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a,e.kpiList=[],e.kpiListSrc=[],e.dicRepeatColsMap=null,e.IsProductGroupLevel=!1,e.IsSummaryGroupsExists=!1,e.DocumentObject=null,e.sbSummaryDimensions="",e.lstSummaryDistinctNumeric=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a,e.lstSummaryAplha=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a,e.lstSummaryCells=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a,e.lstRepeatSummaryAplha=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a,e.dicSubReportStart=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.c,e.IsDefaultSortColumnExists=!1,e.GrandTotalTextInSubReports="",e.MergeChildReport=!1,e.ShowReportTitleInSubReports=!1,e.ShowGrandTotalInSubReports=!1,e.PrintSeperateInSubReports=!1,e.childReportTitle=null,e.childReportColumnHeader=null,e.POSExitViewModel=null,e.TransferData=null,e.SystemDate=Date.Today(),e.SystemDateTime=new Date,e.CURRENT_MONTHSTART=new Date(Date.Today().getFullYear(),Date.Today().getMonth(),1),e.PRV_MONTHSTART=new Date(Date.Today().getFullYear(),Date.Today().getMonth(),1),e.PRV_MONTHEND=new Date(Date.Today().getFullYear(),Date.Today().getMonth(),1),e.Current_YearStartDate=new Date(Date.Today().getFullYear(),0,1),e.PRV_YEARSTART=new Date(Date.Today().getFullYear(),0,1),e.PRV_YEARFROMDATE=new Date(Date.Today().getFullYear(),0,1),e.PRV_YEARTODATE=new Date(Date.Today().getFullYear(),0,1),e.iCurrGroupDetailRows=0,e.DocsLanding=null,e.IsFirstCall=!1,e.HideCostCenterTree=!1,e.HideEmptyRows=!1,e.lstGroupIndex=[],e.Preferences=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a,e.ColumnSource=null,e.ColumnSourceALL=null,e.StaticReportObject=null,e.callbackDel=new _shared_models_controls_PactControlData__WEBPACK_IMPORTED_MODULE_13__.b,e.childReportIndex=0,e.evalFormula=null,e.dicFieldText=[],e.dicTreeText=[],e.iGroupRowsAdded=0,e.iTopGroupSummaryConsider=!1,e.IsNewGroupIndex=-1,e.LevelNo=0,e.GroupTotalsAtEnd=!1,e.DontShowSummaryGroupTotals=!1,e.lstTotal=null,e.lstParents=[],e.oBody=null,e.PrintEachAccountIDForNotif=0,e.IsSortAscending=!0,e.ClassName="ReportViewModel",e.OptionIndexObj.Items.push(_shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__.d.ComboBoxItems_2(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Com_Equals"),"0")),e.OptionIndexObj.Items.push(_shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__.d.ComboBoxItems_2(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Com_NotEquals"),"1")),e.OptionIndexObj.Items.push(_shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__.d.ComboBoxItems_2(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Com_BeginsWith"),"2")),e.OptionIndexObj.Items.push(_shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__.d.ComboBoxItems_2(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Com_EndsWith"),"3")),e.OptionIndexObj.Items.push(_shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__.d.ComboBoxItems_2(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Com_Contains"),"4")),e.OptionIndexObj.Items.push(_shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__.d.ComboBoxItems_2(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Com_NotContains"),"5")),e.OptionIndexObj.SelectedValue="4",e}return _createClass(ReportViewModel,[{key:"addRow",value:function(e){Object(util__WEBPACK_IMPORTED_MODULE_24__.isUndefined)(e.id)&&(e.id=null==this.ParentReport?++this.slickrowid:++this.ParentReport.slickrowid),this.Data.push(e),this.Data.length%500==0&&this.refreshDataView()}},{key:"addRows",value:function(e){var t=this;e.forEach((function(e){t.addRow(e)}))}},{key:"removeRow",value:function(e){this.Data.Remove(e)}},{key:"removeRowAt",value:function(e){var t;t=this.Data[e],this.Data.Remove(t)}},{key:"insertRowAt",value:function(e,t){Object(util__WEBPACK_IMPORTED_MODULE_24__.isUndefined)(e.id)&&(e.id=++this.slickrowid),this.Data.splice(t,0,e)}},{key:"updateRow",value:function(e){if(this.angularGrid&&this.Data.Contains(e))try{this.angularGrid.gridService.updateItem(e,{highlightRow:!1,triggerEvent:!1})}catch(t){console.log("updateRow")}}},{key:"ClearRows",value:function(){this.Data.Clear(),this.refreshDataView()}},{key:"refreshDataView",value:function(){this.angularGrid&&this.angularGrid.dataView.refresh()}},{key:"refreshUI",value:function(){this.angularGrid&&this.angularGrid.resizerService.resizeGrid()}},{key:"Refresh_lstSummaryData",value:function(){var e=this;this.lstSummaryAplha.Clear(),this.lstSummaryDistinctNumeric.Clear(),this.lstSummaryCells.Clear(),this.ReportColumns.forEach((function(t){e.lstSummaryAplha.push(t.ID,[]),-1==t.UseOnce&&"FLOAT"==t.ColumnType&&e.lstSummaryDistinctNumeric.push(t.ID,[]),e.lstSummaryCells.push(t.ID,[])}))}},{key:"ReportViewModel_1",value:function(e){this.ReportViewModel_2(e,_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.General,null,null,null)}},{key:"ReportViewModel_2",value:function(e,t,o,s,i){var l=this,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;try{if(Logger.InfoLog("ReportViewModel::Entring Constructor"),this.PayrollWidgetEmpID=n,this.ReturnType=0,t!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.ExternalQuery){var a=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetReportType(e);if(112==a||165==a){this.ReturnType=a;var r=new _re_order_level_ReOrderLevelNewViewModel__WEBPACK_IMPORTED_MODULE_40__.ReOrderLevelNewViewModel("",e,null);return void _services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.addNewTab({component:_re_order_level_re_order_level_component__WEBPACK_IMPORTED_MODULE_41__.ReOrderLevelComponent,params:{obj:r}})}if(257==a)return this.ReportID=e,this.ShowReportFilter=!1,void(this.ReportViewType=t)}if(this.ReportID=e,this.ShowReportFilter=!_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.IsMobile,this.ReportViewType=t,this.InitCommands(),this.LoadReportXML(o),this.FieldsDialog=new _costcenter_picker_CostCenterPicker__WEBPACK_IMPORTED_MODULE_22__.CostCenterPicker("Field"),this.FieldsView=this.FieldsViewTbl=this.FieldsDialog.grData.Table,this.Filter=new _add_edit_filter_AddEditFilterViewModel__WEBPACK_IMPORTED_MODULE_19__.a,this.Filter.AddEditFilterViewModel_1(this),null!=this.Reportds&&this.Reportds.Tables.length>0&&this.Reportds.Tables[0].length>0&&this.Filter.LoadXml(this.Reportds.Tables[0][0]),null!=s&&(this.DBPanel=s,this.TopRecords<=0&&s.TopRecords>0&&(this.TopRecords=s.TopRecords)),0==this.StaticReportType||-1==this.StaticReportType){if(this.ShowFilter=!0,!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(i)){var h,u=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f;u.LoadXml(i);for(var c=0;c<this.Filter.Fields.length;c++){var D=this.Filter.Fields[c];if("DATE"==D.CDGDO.DataType){h=D;break}}if(h){var d=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(u.DocumentElement,"Row[ColID='FROMDATE']"),C=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(u.DocumentElement,"Row[ColID='TODATE']"),p=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(u.DocumentElement,"Row[ColID='ASONDATE']");d&&C?(h.Condition.SetSelectedItem("Between"),h.FromDatePicker.Date=new Date(d.attributes.Value.value),h.ToDatePicker.Date=new Date(C.attributes.Value.value)):p&&(h.Condition.SetSelectedItem("LessthanOrEqual"),h.FromDatePicker.Date=new Date(p.attributes.Value.value))}t!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.LandingPage&&this.Filter.OnButtonClick("OK")}if(t==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DashBoard||t==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Export||t==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.LoadDataOnly||t==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.PreProcessQuery||this.HidePrefetch){if(t==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Export||t==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.PreProcessQuery)for(var T=this.Filter.CostCenterFilters.length-1;T>=0;T--)null!=this.Filter.CostCenterFilters[T].SelectedNodes&&0!=this.Filter.CostCenterFilters[T].SelectedNodes.length||this.Filter.CostCenterFilters.RemoveAt(T);t!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DashBoard&&t!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Export&&t!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.LoadDataOnly||(this.ShowHeaderButtons=!1,this.ShowRightPanel=!1,this.ShowReportFilter=!1),this.ShowFilter=!1,this.ShowExport=!1,this.ShowReport=!0,this.SetQueryXMLTags(),t==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.PreProcessQuery?this.Filter.OnButtonClick("PrProcessQuery"):t!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.LoadDataOnly&&this.LoadData()}}else if(110==this.StaticReportType||144==this.StaticReportType);else{if(this.oReportDialog=new _static_report_filter_StaticReportFilterViewModel__WEBPACK_IMPORTED_MODULE_20__.a(this),this.ShowStaticFilter=!0,!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(i)){var _,m=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f;if(m.LoadXml(i),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(m.DocumentElement,"PreDataFetch/DefaultFromVal").length>0&&(this.oReportDialog.FromDate.Date=new Date(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(m.DocumentElement,"PreDataFetch/DefaultFromVal"))),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(m.DocumentElement,"PreDataFetch/DefaultToVal").length>0&&(this.oReportDialog.ToDate.Date=new Date(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(m.DocumentElement,"PreDataFetch/DefaultToVal"))),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(m.DocumentElement,"PreDataFetch/CCSelected").length>0&&(this.oReportDialog.CostCenters.SelectedValue=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(m.DocumentElement,"PreDataFetch/CCSelected")),this.oReportDialog.CostCenterFilters.Clear(),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(m.DocumentElement,"PreDataFetch/TreeFilters/TreeFilter").length>0)for(var I=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(m.DocumentElement,"PreDataFetch/TreeFilters/TreeFilter"),R=0;R<I.length;R++){var S=I[R],A=parseInt(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(S,"CCID")),M=null!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(S,"CCName")?_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(S,"CCName"):"",g=null!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(S,"LookupTypeID")?_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(S,"LookupTypeID"):"",w=new _costcenter_filter_CostCenterFilter__WEBPACK_IMPORTED_MODULE_29__.a(A,g,M,this.Filter);if(null!=w){var f=void 0,E=void 0;null==w.SelectedNodes&&(w.SelectedNodes=[]),f=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(S,"DefaultValues").length>0?_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(S,"DefaultValues").split(","):[];for(var P=0;P<f.length;P++)(E=new _shared_controls_tree_TreeNode__WEBPACK_IMPORTED_MODULE_27__.a).Id=parseInt(f[P]),w.SelectedNodes.push(E);this.oReportDialog.CostCenterFilters.push(w),this.oReportDialog.TreeCCID==w.CostCenterID&&(this.oReportDialog.DefaultTreeSelectedNodes=w.SelectedNodes)}}else this.oReportDialog.DefaultTreeSelectedNodes=[],this.oReportDialog.CostCenterFilters.Clear();if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(m.DocumentElement,"PreDataFetch/FieldFilters/FieldFilter").length>0){for(var y=[],O=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(m.DocumentElement,"PreDataFetch/FieldFilters/FieldFilter"),b=function(e){var t=O[e],o=l.Filter.Fields.find((function(e){return e.CDGDO.FieldValue==parseInt(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(t,"CCColID"))}));if(null!=o){y.push(parseInt(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(t,"CCColID")));var s=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(t,"Condition");if(null!=s&&(o.Condition.SelectedValue=s,o.Condition.SetSelectedItem(o.Condition.SelectedValue),o.OnConditionSelectionChanged(o.Condition.SelectedValue)),"DATE"==o.CDGDO.DataType)"FUTURE"==o.Condition.SelectedValue||"PAST"==o.Condition.SelectedValue?o.FromValue.TextBox.Text=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(t,"DefaultFromVal"):(null!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(t,"DefaultFromVal")&&(o.FromDatePicker.Date=new Date(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(t,"DefaultFromVal"))),null==_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(t,"DefaultToVal")||"Between"!=o.Condition.SelectedValue&&"NotBetween"!=o.Condition.SelectedValue||(o.ToDatePicker.Date=new Date(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(t,"DefaultToVal"))));else{var i;if(o.FromList.Visible)i=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IntTryParse(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(t,"DefaultFromVal")),o.FromList.SelectedValue=i;else o.FromValue.TextBox.Text=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(t,"DefaultFromVal");if("Between"==o.Condition.SelectedValue||"NotBetween"==o.Condition.SelectedValue)if(o.ToList.Visible){var n;n=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IntTryParse(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(t,"DefaultToVal")),o.ToList.SelectedValue=n}else o.ToValue.Text=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(t,"DefaultToVal")}}else"23148"==_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(t,"CCColID")&&(V=l.oReportDialog.DefaultProperties.find((function(e){return"EnquiryNo"==e.DBColumnName})))instanceof _shared_models_controls_PactListBoxData__WEBPACK_IMPORTED_MODULE_14__.b&&(V.Text=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(t,"DefaultFromVal"))},N=0;N<O.length;N++){var V;b(N)}for(var v=function(e){var t=l.Filter.Fields[e];if(0==y.filter((function(e){return e==t.CDGDO.FieldValue})).length){if(l.RepeatEmptyColumns>0&&l.Filter.Fields[e].FromDatePicker.Visible)return"continue";l.Filter.Fields.RemoveAt(e)}},L=this.Filter.Fields.length-1;L>=0;L--)v(L)}else for(var B=this.Filter.Fields.length-1;B>=0;B--)if(this.Filter.Fields[B].IsVisible){if(this.RepeatEmptyColumns>0&&this.Filter.Fields[B].FromDatePicker.Visible)continue;this.Filter.Fields.RemoveAt(B)}_=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(m.DocumentElement,"PreDataFetch/DefaultProperties").length>0?"<DefaultProperties>"+_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(m.DocumentElement,"PreDataFetch/DefaultProperties")+"</DefaultProperties>":this.oReportDialog.GetPropertiesSaveXML();var F="";this.oReportDialog.Locations.Visible&&(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(m.DocumentElement,"PreDataFetch/DefaultProperties/DEFAULT_LOCATION").length>0?(F=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(m.DocumentElement,"PreDataFetch/DefaultProperties/DEFAULT_LOCATION")).Contains("All")&&"1"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.RoleID?this.oReportDialog.LocationWhere=null:(F.Contains("All")&&(F=F.Remove(0,4)),this.oReportDialog.LocationWhere=F):this.oReportDialog.SetLocationWhere()),this.DisplayMessage="",t==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.VPT&&(this.oReportDialog.Locations.Visible=!1,this.oReportDialog.SetLocationWhere()),this.oReportDialog.IsFirstLoaded=!0,this.ShowStaticFilter=!1,this.ShowReport=!0,this.Reportds.Tables[0][0].DefaultPreferences=_,this.UpdateDefaultPreferences(),this.SetQueryXMLTags(),this.LoadData()}(t==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DashBoard||t==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Export||t==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.LoadDataOnly||this.HidePrefetch)&&(t==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Export&&(this.oReportDialog.Locations.Visible=!1),this.oReportDialog.SetLocationWhere(),t!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DashBoard&&t!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Export&&t!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.LoadDataOnly||(this.ShowHeaderButtons=!1,this.ShowRightPanel=!1,this.ShowReportFilter=!1),this.ShowExport=!1,this.ShowReport=!0,this.Reportds.Tables[0][0].DefaultPreferences=this.oReportDialog.GetPropertiesSaveXML(),this.UpdateDefaultPreferences(),this.SetQueryXMLTags(),t!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.LoadDataOnly&&(this.LoadData(),this.oReportDialog.IsFirstLoaded=!0))}Logger.InfoLog("ReportViewModel::Exiting Constructor")}catch(G){Logger.ErrorLog("ReportViewModel::Exiting Error",G)}}},{key:"ReportViewModel_Query",value:function(e,t,o,s,i){var l=this,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(this.IsFirstCall=a,this.DispayAsPopup=n,this.ReportViewType=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Query,this.ShowQuery=!this.IsMobile,this.ShowReport=!0,this.IgnoreTreeLoad=!1,this.RefreshVisibility=!0,this.LabelName=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Reports_LblQuery"),this.InitCommands(),this.QueryReports=[],this.QueryTimer=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.d,this.QueryTimer.Elapsed(this,"QueryTimer_Elapsed"),this.QueryDocuments=[],this.QueryMasterScreen=[],this.QueryMastersVisibility=!1,this.QueryDimension=new _shared_models_controls_PactListBoxData__WEBPACK_IMPORTED_MODULE_14__.b(0),this.QueryDimension.SelectionChangedCommand.Subscribe(this,"OnQueryDimensionSelectionChanged"),this.QueryDimension.CCID=e,this.QueryDimension.SelectedValue=t,this.QueryDimension.SelectedValue=n&&0==t&&3==e?-1:t,2==e)this.QueryDimension.TypeID=100,this.QueryDimension.Label=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("DocumentDesigner_Account");else if(3==e)this.QueryDimension.TypeID=10,this.QueryDimension.Label=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("DocumentDesigner_Product");else if(92==e){if(this.QueryMastersVisibility=!0,this.QueryDimension.TypeID=2,this.DisplayName=this.LabelName=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("REN_RentalConsole"),this.QueryDimension.Label=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Rentals_UnitsProperty"),parseInt(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.UserID)>1){for(var r=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSet("RPT019",this.IsReportDB,_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.UserID),h="",u=0;u<r.Tables[0].length;u++)h+=r.Tables[0][u].PropertyID.toString(),u<r.Tables[0].length-1&&(h+=" , ");this.QueryDimension.CustomWhere=h.length>0?" NodeID in ( "+h+") ":" 1<>1 "}}else this.QueryDimension.TypeID=1,this.QueryDimension.Label=o;this.DocumentFilters.push(e.toString(),""),"TRUE"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["LW  Login"].toString().toUpperCase()&&0!=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID&&this.DocumentFilters.push("50002",_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID.toString());var c=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetQueryDefnScreenDetails(5,e,0);if(null!=c&&c.Tables.length>0&&(c.Tables[0].forEach((function(e){var t=new _shared_models_controls_PactButtonData__WEBPACK_IMPORTED_MODULE_10__.a;t.DBColumnID=parseInt(e.ReportID),t.Label=e.ReportName.toString(),t.Action=parseInt(e.StaticReportType),t.GroupName=Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(e.GroupLevel)?"1":"0",t.IsReadOnly=!0,l.QueryReports.push(t)})),c.Tables[2].forEach((function(e){var t=new _shared_models_controls_PactLinkData__WEBPACK_IMPORTED_MODULE_15__.a(0);t.DBColumnID=parseInt(e.CostCenterID),t.Label=e.DocumentName.toString(),l.QueryDocuments.push(t)})),this.QueryDocumentsVisibility=this.QueryDocuments.length>0,c.Tables[0].length>0)){this.PriceChartVisibility=Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(c.Tables[0][0].ShowPriceChart);var D=parseInt(c.Tables[0][0].ListViewID);if(D>0&&(this.QueryDimension.TypeID=D),this.LoadQueryHeaderFields(c.Tables[1]),null!=i&&null!=this.QueryFilterFields&&null!=i.QueryFilterFields&&this.QueryFilterFields.length==i.QueryFilterFields.length)for(var d=0;d<this.QueryFilterFields.length;d++)this.QueryFilterFields[d].SelectedValue=i.QueryFilterFields[d].SelectedValue}if(this.QueryReports.length>0){var C=this.QueryReports.find((function(e){return s>0&&e.DBColumnID==s}));C?(C.CrFilter=1,this.OnQueryReportClick(C),C.CrFilter=0):(this.QueryReports[0].CrFilter=1,this.OnQueryReportClick(this.QueryReports[0]),this.QueryReports[0].CrFilter=0)}if(this.QueryFieldFilters=new Array,this.Filter){var p=0;this.Filter.Fields.forEach((function(e){e.QuerySearchField.IsChecked&&(e.Row=p/3,e.Column=p%3,l.QueryFieldFilters.push(e),p++,e.IsVisible=!1)}))}}},{key:"ReportViewModel_Document",value:function(e,t,o,s,i,l){var n=this,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;if(this.xMapXML=l,this.DocumentObject=a,i instanceof _ReportViewModel?this.ReportViewFrom=i:null!=i&&"ReOrderLevelNewViewModel"==i.ClassName?this.ReportViewFromReorder=i:null!=i&&"POSExitViewModel"==i.ClassName&&(this.POSExitViewModel=i),this.DispayAsPopup=s,this.ShowReport=!0,e>4e4&&e<5e4?(this.CostCenterID=e,this.ReportViewType=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DocumentQuery,this.ShowQuery=!this.IsMobile,this.IgnoreTreeLoad=!1,this.RefreshVisibility=!0):(this.ReportViewType=50==e?_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DocumentQuery:_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.TransactionQuery,112==e&&(this.CostCenterID=e),this.ShowQuery=!1,this.IgnoreTreeLoad=!1,this.RefreshVisibility=!0,this.OnButtonClick("ShowReportFilter")),this.LabelName=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("DocumentDesigner_DocReports"),this.InitCommands(),this.QueryDimension=new _shared_models_controls_PactListBoxData__WEBPACK_IMPORTED_MODULE_14__.b(0),this.QueryDimension.Visible=!1,this.LoadDocFilterXML(t),(98==e||this.DocumentFilters.ContainsKey("3")&&!this.DocumentFilters[3].startsWith("'")&&!this.DocumentFilters[3].endsWith("'")||null!=this.DocumentObject&&this.DocumentObject.ScreenObject.IsInventory)&&(this.ReportViewType=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DocumentQuery,this.QueryDimension.CCID=3,this.DocumentFilters.ContainsKey("3")&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNum(this.DocumentFilters[3])&&(this.QueryDimension.SelectedValue=parseInt(this.DocumentFilters[3]))),this.QueryReports=[],this.ShowQuery){var r=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetQueryDefnScreenDetails(6,e,0);if(null!=r&&r.Tables.length>0){var h=[];r.Tables[0].forEach((function(e){if(!h.Contains(e.ReportName.toString())){h.push(e.ReportName.toString());var t=new _shared_models_controls_PactButtonData__WEBPACK_IMPORTED_MODULE_10__.a;t.DBColumnID=parseInt(e.ReportID),t.Label=e.ReportName.toString(),t.Action=parseInt(e.StaticReportType),t.IsReadOnly=!1,n.QueryReports.push(t)}}));try{this.LoadQueryHeaderFields(r.Tables[0])}catch(d){}}}if(this.QueryReports.length>0||!this.ShowQuery){var u=this.QueryReports.find((function(e){return o>0&&e.DBColumnID==o}));if(u)u.CrFilter=1,this.OnQueryReportClick(u),u.CrFilter=0;else{if(null!=this.POSExitViewModel&&(this.ReportViewType=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Export),0==this.QueryReports.length){var c=new _shared_models_controls_PactButtonData__WEBPACK_IMPORTED_MODULE_10__.a;c.DBColumnID=o,this.QueryReports.push(c)}this.QueryReports[0].CrFilter=1,this.OnQueryReportClick(this.QueryReports[0]),this.QueryReports[0].CrFilter=0}}if(this.QueryFieldFilters=new Array,null!=this.Filter){var D=0;this.Filter.Fields.forEach((function(e){e.QuerySearchField.IsChecked&&(e.IsVisible=!1,e.Row=D/3,e.Column=D%3,n.QueryFieldFilters.push(e),n.QueryFieldsVisibility=!0,D++)}))}}},{key:"ReportViewModel_SubReport",value:function(e,t,o){try{this.ParentReport=e,this.ReturnType=0,this.ReportID=parseInt(o.Tables[0][0].ReportID),this.ShowReportFilter=!_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.IsMobile,this.ReportViewType=t,this.InitCommands(),this.process=e.process,this.LoadReportXML(o),this.FieldsDialog=new _costcenter_picker_CostCenterPicker__WEBPACK_IMPORTED_MODULE_22__.CostCenterPicker("Field"),this.FieldsView=this.FieldsViewTbl=this.FieldsDialog.grData.Table,this.Filter=new _add_edit_filter_AddEditFilterViewModel__WEBPACK_IMPORTED_MODULE_19__.a,this.Filter.AddEditFilterViewModel_1(this),null!=this.Reportds&&this.Reportds.Tables.length>0&&this.Reportds.Tables[0].length>0&&this.Filter.LoadXml(this.Reportds.Tables[0][0]),this.lstGroup.length>0&&"Detailed"==this.lstGroup[0].DisplayMode&&!this.lstGroup[0].ShowAsColumn&&e.lstGroup.length>0&&"Detailed"==e.lstGroup[0].DisplayMode&&!e.lstGroup[0].ShowAsColumn?this.MergeChildReport=!0:(this.MergeChildReport=!1,this.Data=this.ParentReport.Data,this.angularGrid=this.ParentReport.angularGrid),0==this.StaticReportType||-1==this.StaticReportType||110==this.StaticReportType||144==this.StaticReportType||(this.oReportDialog=new _static_report_filter_StaticReportFilterViewModel__WEBPACK_IMPORTED_MODULE_20__.a(this),this.oReportDialog.Locations.Visible&&this.oReportDialog.Locations.Items.map((function(e){return e.IsChecked=!0})),this.ShowStaticFilter=!0),Logger.InfoLog("ReportViewModel::Exiting Constructor")}catch(s){Logger.ErrorLog("ReportViewModel::Exiting Error",s.stack)}}},{key:"ReportViewModel_MRP",value:function(e){this.ReportID=257,this.MRPFilter=e,this.InitCommands(),this.LoadReportXML(null),this.ShowReport=!0}},{key:"InitCommands",value:function(){this.ShowHeaderButtons=!0,this.ShowRightPanel=!0,this.ShowExport=!1,this.SavePDF.IsChecked=!0,this.SavePDF.Label="PDF",this.SaveXLS.Label="Spreadsheet (xlsx)",this.SaveXLSX.Label="Spreadsheet (Open xlsx)",this.SaveWord.Label="Document (doc)",this.SaveHTML.Label="Web page (html)",this.SavePDF.Group=this.ExportList,this.SaveXLS.Group=this.ExportList,this.SaveXLSX.Group=this.ExportList,this.SaveWord.Group=this.ExportList,this.SaveHTML.Group=this.ExportList,this.ExportList.Items.push(this.SavePDF),this.ExportList.Items.push(this.SaveXLS),this.ExportList.Items.push(this.SaveXLSX),this.ExportList.Items.push(this.SaveWord),this.ExportList.Items.push(this.SaveHTML),this.process.DoWork(this,"process_DoWork"),this.MatrixObject=new _MatrixReport__WEBPACK_IMPORTED_MODULE_30__.a(this,_ReportViewModel),this.ReportID>0&&_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.IsActionAssigned(200,"Update")&&(this.MatrixObject.AllowToSave=!0),this.ButtonPrint=new _shared_models_controls_PactButtonData__WEBPACK_IMPORTED_MODULE_10__.a,this.ButtonExport=new _shared_models_controls_PactButtonData__WEBPACK_IMPORTED_MODULE_10__.a,this.ButtonEmail=new _shared_models_controls_PactButtonData__WEBPACK_IMPORTED_MODULE_10__.a,this.ButtonSMS=new _shared_models_controls_PactButtonData__WEBPACK_IMPORTED_MODULE_10__.a,this.ButtonPost=new _shared_models_controls_PactButtonData__WEBPACK_IMPORTED_MODULE_10__.a,this.ButtonAction=new _shared_models_controls_PactButtonData__WEBPACK_IMPORTED_MODULE_10__.a,this.ButtonSave=new _shared_models_controls_PactButtonData__WEBPACK_IMPORTED_MODULE_10__.a,this.ButtonLoad=new _shared_models_controls_PactButtonData__WEBPACK_IMPORTED_MODULE_10__.a,this.SetButtonsVisibility(!0),this.ProcessdOn=new _shared_models_controls_PactControlData__WEBPACK_IMPORTED_MODULE_13__.c(0),this.ProcessdOn.Visible=!1,this.ReportDims=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("ReportDims")?_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ReportDims:""}},{key:"LoadTransactionQueryData",value:function(){var e=this;this.ShowFilter=!1,this.ShowQuery=!1,this.ShowReportFilter=!1,this.ShowReport=!0,this.RefreshVisibility=!1,this.ShowTransactionQuery=!0,this.ShowLinkingQuery=!1,this.TransactionQueryFields=[],110==this.StaticReportType?(this.ReportViewType=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.TransactionQuery,this.QueryLabel=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Rpt_TransactQry")):144==this.StaticReportType&&(this.ReportViewType=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.LinkingQuery,this.QueryLabel=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Rpt_LinkQry")),this.TQDocumentType=new _shared_models_controls_PactListBoxData__WEBPACK_IMPORTED_MODULE_14__.b(0),this.TQDocumentType.SelectionChangedCommand.Subscribe(this,"OnTQDocumentChange"),this.TQDocumentType.Label="Document",this.TQDocumentType.CCID=300,this.TQDocumentType.Mandatory=!1,110==this.StaticReportType?this.TQDocumentType.TypeID=1:144==this.StaticReportType&&(this.TQDocumentType.TypeID=2),this.TQDocPrefix=new _shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__.e(0),this.TQDocPrefix.Label="Doc Prefix",this.TQDocPrefix.SelectionChangedCommand.Subscribe(this,"OnTQDocPrefixChange"),this.TQDocNo_From=new _shared_models_controls_PactTextBoxData__WEBPACK_IMPORTED_MODULE_25__.d(0),this.TQDocNo_From.Label="Doc No",this.TQDocNo_To=new _shared_models_controls_PactTextBoxData__WEBPACK_IMPORTED_MODULE_25__.d(0),this.TQDocNo_To.Label="To",this.Filter.Fields.forEach((function(t){var o=new _Models_PostDataField__WEBPACK_IMPORTED_MODULE_17__.a;o.PostDataField_2(t),e.TransactionQueryFields.push(o)}))}},{key:"SetButtonsVisibility",value:function(e){if(null==this.ParentReport){var t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.IsActionAssigned(200,"Report Print");t&&!e&&"1"!=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.RoleID&&"1"!=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.UserID&&0==this.Reportds.Tables[1].filter((function(e){return 2==e.ActionType||0==e.ActionType})).length&&(t=!1),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.HideUnathorizedAccess?this.ButtonPrint.Visible=t:this.ButtonPrint.Enable=t,(t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.IsActionAssigned(200,"Report Export"))&&!e&&"1"!=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.RoleID&&"1"!=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.UserID&&0==this.Reportds.Tables[1].filter((function(e){return 3==e.ActionType||0==e.ActionType})).length&&(t=!1),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.HideUnathorizedAccess?this.ButtonExport.Visible=t:this.ButtonExport.Enable=t,(t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.IsActionAssigned(200,"Report Email"))&&!e&&"1"!=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.RoleID&&"1"!=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.UserID&&0==this.Reportds.Tables[1].filter((function(e){return 4==e.ActionType||0==e.ActionType})).length&&(t=!1),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.HideUnathorizedAccess?this.ButtonEmail.Visible=t:this.ButtonEmail.Enable=t,(t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.IsActionAssigned(200,"Report SMS"))&&!e&&"1"!=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.RoleID&&"1"!=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.UserID&&0==this.Reportds.Tables[1].filter((function(e){return 5==e.ActionType||0==e.ActionType})).length&&(t=!1),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.HideUnathorizedAccess?this.ButtonSMS.Visible=t:this.ButtonSMS.Enable=t,this.PreProcessReport.Visible=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.IsActionAssigned(200,"Pre-Process Report"),this.ButtonAction.Visible=!1,this.ButtonPost.Width="36",this.ButtonPost.GroupName="Post",this.ButtonPost.Label=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Post"),111==this.StaticReportType||257==this.StaticReportType||297==this.ReportID||null!=this.Reportds&&this.Reportds.Tables.length>0&&this.Reportds.Columns[0].Contains("DocMapXML")&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(this.Reportds.Tables[0][0].DocMapXML).length>0?(this.Reportds.Columns[0].Contains("DocMapXML")&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(this.Reportds.Tables[0][0].DocMapXML).length>0&&(this.IsDocMapXMLExists=!0),this.ButtonPost.Visible=!0):this.ButtonPost.Visible=!1,this.ButtonSave.Visible=!1,this.ButtonLoad.Visible=!1,this.ButtonSave.Label=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Save"),257==this.StaticReportType?(this.ButtonSave.Visible=!0,this.ButtonLoad.Visible=!0):154==this.StaticReportType&&(this.ButtonSave.Label="Reject")}}},{key:"LoadDocFilterXML",value:function(e){var t=this;if(this.IsProductGroupLevel=!1,this.DocumentFilters.Clear(),this.DocumentFiltersText.Clear(),!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e)){var o=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f;o.LoadXml(e),o.DocumentElement.childNodes.forEach((function(e){var o=e;t.DocumentFilters.ContainsKey(o.attributes.ColID.value)||null==o.attributes.Value||(t.DocumentFilters.push(o.attributes.ColID.value,o.attributes.Value.value),null!=o.attributes.ValueText&&t.DocumentFiltersText.push(o.attributes.ColID.value,_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.EncodeXML(o.attributes.ValueText.value)),null!=o.attributes.LinkedInvDocDetailsIDs&&t.DocumentFiltersIDs.push(o.attributes.ColID.value,_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.EncodeXML(o.attributes.LinkedInvDocDetailsIDs.value)))})),null!=o.DocumentElement.attributes.GroupLevel&&"1"==o.DocumentElement.attributes.GroupLevel.value&&(this.IsProductGroupLevel=!0)}}},{key:"LoadReportXML",value:function(e){var t=this;if(this.RepeatType=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.None,this.Reportds=null==e?_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetReport(0,this.ReportID):e,null!=this.Reportds&&this.Reportds.Tables.length>0&&!this.Reportds.Columns[0].Contains("ErrorMessage")&&this.Reportds.Tables[0].length>0){this.StaticReportType=parseInt(this.Reportds.Tables[0][0].StaticReportType),this.ReportQuery=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(this.Reportds.Tables[0][0].Query),this.ReportDoc=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f;try{this.ReportDoc.LoadXml(this.Reportds.Tables[0][0].ReportDefnXML.toString())}catch(T){return this.DisplayMessage="Invalid report",void(this.MessageVisibility=!0)}this.ScreenName="",2==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LanguageID&&(this.ScreenName=this.ReportDoc.SelectSingleNodeText("PactRevenURpts/PactRevenURptDef/ArabicName")),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.ScreenName)&&(this.ScreenName=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource(this.Reportds.Tables[0][0].ReportName)),null!=this.ReportDoc.SelectSingleNode("PactRevenURpts/PactRevenURptDef/ReportType")&&(this.IsSummaryReportType=!0),this.DisplayName=this.ScreenName,this.ShowGridLines=this.ReportDoc.SelectSingleNodeText("PactRevenURpts/PactRevenURptDef/GridLines"),this.VerticalAlignment=this.ReportDoc.SelectSingleNodeText("PactRevenURpts/PactRevenURptDef/VAlign");var o=this.ReportDoc.SelectSingleNodeText("PactRevenURpts/PactRevenURptDef/PrintonLang");null!=o&&"1"==o&&(this.PrintonLang=1);var s=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(this.ReportDoc.SelectSingleNodeText("PactRevenURpts/PactRevenURptDef/TreeTotalBorder"));if(0!=s&&(this.TreeTotalBorder=""!=this.ReportDoc.SelectSingleNodeText("PactRevenURpts/PactRevenURptDef/TreeTotalBorderRow")?-s:s),this.TreeGroupPrint="0"!=this.ReportDoc.SelectSingleNodeText("PactRevenURpts/PactRevenURptDef/TreeGroupPrint"),this.RepeatType=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.None,this.RepeatStartIndex=-1,this.ReportColumns=this.BuildColumns(this.ReportDoc.SelectSingleNode("PactRevenURpts/PactRevenURptDef/Columns")),this.BuildGroups(this.ReportDoc.SelectSingleNode("PactRevenURpts/PactRevenURptDef/Groups")),null!=this.ReportColumns&&(this.totals=new Array(this.ReportColumns.length).fill(0).map((function(){return new Array(t.lstGroup.length+1).fill(0)})),this.hiddenTotals=new Array(this.HiddenNumericColumns.length).fill(0).map((function(){return new Array(t.lstGroup.length+1).fill(0)})),this.lstSummaryAplha.Clear(),this.lstSummaryDistinctNumeric.Clear(),this.lstSummaryCells.Clear(),this.ReportColumns.forEach((function(e){t.lstSummaryAplha.push(e.ID,new Array),-1==e.UseOnce&&"FLOAT"==e.ColumnType&&t.lstSummaryDistinctNumeric.push(e.ID,new Array),t.lstSummaryCells.push(e.ID,new Array)}))),null!=this.MatrixObject&&this.MatrixObject.LoadFields(this.Reportds.Tables[0][0]),this.kpiList.Clear(),this.kpiListSrc.Clear(),!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.Reportds.Tables[0][0].KPIXML)){var i=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f;i.LoadXml(this.Reportds.Tables[0][0].KPIXML.toString()),i.DocumentElement.childNodes.forEach((function(e){var o=new _StaticReports_StaticReportsViewModel__WEBPACK_IMPORTED_MODULE_33__.a;o.KPI_1(e,t),t.kpiList.push(o),t.kpiListSrc.push(t.kpiList[t.kpiList.length-1])}))}var l=this.ReportDoc.SelectSingleNode("PactRevenURpts/PactRevenURptDef/ReportTotal"),n=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(l,"Identity"),a=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(l,"Appearance");this.GrpReportTotal.ID=this.GetNodeValue(n,"ID"),this.GrpReportTotal.SubTotalPrefix=this.GetNodeValue(n,"Prefix").split("~"),this.GrpReportTotal.SubTotalShowUnder=this.GetNodeValue(a,"ShowUnder"),this.GrpReportTotal.SubTotalAppearance=this.GrpReportTotal.GroupAppearance=this.GetAppearance(a),this.GrpReportTotal.SubTotalAppearance_Data=this.GrpReportTotal.SubTotalAppearance.Clone(),this.GrpReportTotal.SubTotalAppearance_Data.Alignment="Right",this.AddTotalColumnsToGroup(this.GrpReportTotal,_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(l,"Columns"));var r=this.GetNodeValue(n,"ShowCaption");r.length>0&&!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNum(r)&&(this.GrpReportTotal.SubTotalShowCaption=parseInt(r),this.GrpReportTotal.SubTotalCaptionID=r,this.GrpReportTotal.SubTotalShowCaption=10),""!=this.GetNodeValue(a,"Width")&&(this.GrpReportTotal.SubTotalWidth=this.GrpReportTotal.Width=parseFloat(this.GetNodeValue(a," Width"))),""!=this.GetNodeValue(a,"Height").Trim()&&(this.GrpReportTotal.SubTotalHeight=this.GrpReportTotal.Height=parseInt(this.GetNodeValue(a,"Height"))),0!=(s=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(this.GetNodeValue(a,"Border")))&&(this.GrpReportTotal.SubTotalBorder=""!=this.GetNodeValue(a,"BorderRow")?-s:s);var h=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(l,"Appearance");null!=h&&(this.GrpReportTotal.SubTotalFormat=this.GetFormat(h)),this.GrpReportTotal.SubTotalAppearance.IsBold=!1,this.GrpReportTotal.SubTotalAppearance.BackColor="#f1f2f5",this.GrpReportTotal.SubTotalAppearance.ForeColor="#ff9700",this.GrpReportTotal.SubTotalAppearance.Alignment="Right",this.GrpReportTotal.SubTotalAppearance.FontSize=12,this.GrpReportTotal.SubTotalAppearance_Data.IsBold=!1,this.GrpReportTotal.SubTotalAppearance_Data.BackColor="#f1f2f5",this.GrpReportTotal.SubTotalAppearance_Data.ForeColor="#ff9700",this.GrpReportTotal.SubTotalAppearance_Data.Alignment="Right",this.GrpReportTotal.SubTotalAppearance_Data.FontSize=12,this.ChildReports.Clear();for(var u=1;u<this.Reportds.Tables[0].length;u++){var c={Tables:[],Columns:[]};c.Tables.push([]),c.Columns.push(this.Reportds.Columns[0].Copy());for(var D={},d=0;d<this.Reportds.Columns[0].length;d++)D[this.Reportds.Columns[0][d]]=this.Reportds.Tables[0][u][this.Reportds.Columns[0][d]];if(c.Tables[0].push(D),1==u&&this.Reportds.Tables[0][u].MapXML.toString().length>0){var C=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f;C.LoadXml(this.Reportds.Tables[0][u].MapXML.toString()),null!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(C.DocumentElement,"Pref/ShowTitle")&&(this.ShowReportTitleInSubReports=!0),null!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(C.DocumentElement,"Pref/PrintSeperate")&&(this.PrintSeperateInSubReports=!0),null!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(C.DocumentElement,"Pref/ShowGrandTotal")&&(this.ShowGrandTotalInSubReports=!0,this.GrandTotalTextInSubReports=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(C.DocumentElement,"Pref/ShowGrandTotal"),null!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(C.DocumentElement,"Pref/GrandTotalFormula")&&(this.GrandTotalFormulaInSubReports=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(C.DocumentElement,"Pref/GrandTotalFormula")))}var p=new _ReportViewModel;p.ReportViewModel_SubReport(this,_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Export,c),this.ChildReports.push(p)}this.PrintSeperateInSubReports&&1!=this.ChildReports.length&&(this.PrintSeperateInSubReports=!1),this.SetButtonsVisibility(!1),this.ShowMatrixButtonVisible=!!(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.IsActionAssigned(200,"Matrix Report")&&this.StaticReportType<=0)}this.LoadPreferences(),this.Preferences.ContainsKey("PreProcessQuery")&&(this.IsPreProcessQuery=!0),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("ReportsFrom")&&(this.IsReportDB="1"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ReportsFrom,this.Preferences.ContainsKey("ReportsFrom")&&("TrDB"==this.Preferences.ReportsFrom?this.IsReportDB=!1:"RptDB"==this.Preferences.ReportsFrom&&(this.IsReportDB=!0)))}},{key:"BuildGroups",value:function(e){try{Logger.InfoLog("ReportViewModel::Entring BuildGroups"),this.lstGroup.Clear(),this.Groupstr.Clear(),this.ReportGroups.Clear();for(var t=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(e,"GroupDef"),o=0;o<t.length;o++){var s=t[o],i=new Group;i.ID=this.GetNodeValue(s,"Identity/ID"),""!=this.GetNodeValue(s,"Appearance/Width")&&(i.Width=parseFloat(this.GetNodeValue(s,"Appearance/Width"))),i.Prefix=this.GetNodeValue(s,"Identity/Prefix"),i.Type=this.GetNodeValue(s,"Identity/Type").toUpperCase(),i.ShowUnder=this.GetNodeValue(s,"Appearance/ShowUnder"),i.Level=parseInt(this.GetNodeValue(s,"Identity/Level")),i.GroupAppearance=this.GetAppearance(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(s,"Appearance")),i.DisplayMode=null!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(s,"Identity/DisplayMode")?_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(s,"Identity/DisplayMode").Trim():"Detailed","1"==this.GetNodeValue(s,"Identity/ShowAsColumn").Trim()&&(i.ShowAsColumn=!0),""!=this.GetNodeValue(s,"Appearance/Height").Trim()&&(i.Height=parseInt(this.GetNodeValue(s,"Appearance/Height"))),null!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(s,"Format")&&(i.GroupFormat=this.GetFormat(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(s,"Format"))),i.Formula=this.GetNodeValue(s,"Identity/Expression"),i.SubTotalPrefix=this.GetNodeValue(s,"SubTotal/Identity/Prefix").split("~");var l=0;""!=this.GetNodeValue(s,"SubTotal/Appearance/Border")&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNum(this.GetNodeValue(s,"SubTotal/Appearance/Border"))&&(l=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(this.GetNodeValue(s,"SubTotal/Appearance/Border")),i.SubTotalBorder=""!=this.GetNodeValue(s,"SubTotal/Appearance/BorderRow")?-l:l),i.SubTotalShowUnder=this.GetNodeValue(s,"SubTotal/Appearance/ShowUnder"),i.SubTotalLevel=parseInt(this.GetNodeValue(s,"SubTotal/Identity/Level")),this.StaticReportType>0?(i.SubTotalAppearance=this.GetAppearance(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(s,"SubTotal/Appearance")),i.SubTotalAppearance_Data=i.SubTotalAppearance.Clone()):(i.SubTotalAppearance=i.GroupAppearance.Clone(),i.SubTotalAppearance_Data=this.GetAppearance(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(s,"SubTotal/Appearance")),i.SubTotalAppearance.Alignment=i.SubTotalAppearance_Data.Alignment,i.SubTotalAppearance.IsVisible=i.SubTotalAppearance_Data.IsVisible,i.SubTotalAppearance.IsPrintVisible=i.SubTotalAppearance_Data.IsPrintVisible),i.SubTotalAppearance_Data.Alignment="Right",i.SubTotalShowAtCollapse="1"==this.GetNodeValue(s,"SubTotal/Appearance/ShowAtCollapse"),this.AddTotalColumnsToGroup(i,_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(s,"SubTotal/Columns"));var n=this.GetNodeValue(s,"SubTotal/Identity/ShowCaption");if(i.SubTotalShowCaption=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(n),n.length>0&&!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNum(n)&&(i.SubTotalCaptionID=n,i.SubTotalShowCaption=10),""!=this.GetNodeValue(s,"SubTotal/Appearance/Width")&&(i.SubTotalWidth=parseFloat(this.GetNodeValue(s,"Appearance/Width"))),""!=this.GetNodeValue(s,"SubTotal/Appearance/Height").Trim()&&(i.SubTotalHeight=parseInt(this.GetNodeValue(s,"SubTotal/Appearance/Height"))),null!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(s,"SubTotal/Format")&&(i.SubTotalFormat=this.GetFormat(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(s,"SubTotal/Format"))),this.StaticReportType>=9&&this.StaticReportType<=12||31==this.StaticReportType||80==this.StaticReportType){var a=new _Models_ReportColumnProperties__WEBPACK_IMPORTED_MODULE_21__.b(null,!0);a.ID=i.ID,a.CDGDO.CategoryValue=parseInt(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(s,"Identity/Category")),a.CDGDO.FieldValue=parseInt(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(s,"Identity/Field")),null==this.FieldsView&&(this.FieldsDialog=new _costcenter_picker_CostCenterPicker__WEBPACK_IMPORTED_MODULE_22__.CostCenterPicker("Field"),this.FieldsView=this.FieldsViewTbl=this.FieldsDialog.grData.Table);null!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(s,"Identity/SelectedField")&&(n=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(s,"Identity/SelectedField")),this.FieldsDialog.SetCDGDO_ColID(a.CDGDO,""),0==a.CDGDO.FieldValue&&(a.CDGDO.DataType=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(s,"Identity/Type")),a.SetDataType(),this.ReportGroups.push(a)}this.lstGroup.push(i),this.Groupstr.push(this.GetNodeValue(s,"Identity/ID"),null)}this.IsSummaryGroupsExists=!1,this.lstGroup.find((function(e){return"Summary"==e.DisplayMode}))&&(this.IsSummaryGroupsExists=!0);for(var r=0;r<this.lstGroup.length;r++)this.lstGroup[r].GroupAppearance.IsBold=!1,this.lstGroup[r].GroupAppearance.BackColor="#3498FB",this.lstGroup[r].GroupAppearance.ForeColor="white",this.lstGroup[r].GroupAppearance.FontSize=12,this.lstGroup[r].SubTotalAppearance.IsBold=!1,this.lstGroup[r].SubTotalAppearance.BackColor="#f1f2f5",this.lstGroup[r].SubTotalAppearance.ForeColor="#ff9700",this.lstGroup[r].SubTotalAppearance.Alignment="Right",this.lstGroup[r].SubTotalAppearance.FontSize=12,this.lstGroup[r].SubTotalAppearance_Data.IsBold=!1,this.lstGroup[r].SubTotalAppearance_Data.BackColor="#f1f2f5",this.lstGroup[r].SubTotalAppearance_Data.ForeColor="#ff9700",this.lstGroup[r].SubTotalAppearance_Data.FontSize=12;Logger.InfoLog("ReportViewModel::Exiting BuildGroups")}catch(h){Logger.ErrorLog("ReportViewModel::Error BuildGroups",h.stack)}}},{key:"BuildColumns",value:function(e){var t=this;this.ColumnSource=[],this.ColumnSourceALL=[],this.DisplayedCols=[],this.HiddenNumericColumns=[],this.SearchColumns.Items.Clear(),this.SearchColumns.Items.push(_shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__.d.ComboBoxItems_3(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Tree_Fulltext"),"FullText","String")),this.SearchColumns.SelectedValue="FullText",this.SearchColumns.SelectedIndex=0,this.PostDataFetchFilterFields=[];var o=null;_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(this.Reportds.Tables[0][0].RowColumnReportsMap).length>0&&(o=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f).LoadXml(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(this.Reportds.Tables[0][0].RowColumnReportsMap));try{Logger.InfoLog("ReportViewModel::Entring BuildColumns"),""!=this.GetNodeValue(e,"HeaderHeight")&&(this.HeaderHeight=parseFloat(this.GetNodeValue(e,"HeaderHeight"))),""!=this.GetNodeValue(e,"RowHeight")&&(this.RowHeight=parseFloat(this.GetNodeValue(e,"RowHeight"))),this.SubRowHeight=""!=this.GetNodeValue(e,"SubRowHeight")?parseFloat(this.GetNodeValue(e,"SubRowHeight")):this.RowHeight;for(var s=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(e,"ColumnDef"),i=function(e){var i=s[e],l=new _Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.b;""!=t.ShowGridLines&&(l.gridLines=parseInt(t.ShowGridLines)),l.VAlign="Top"==t.VerticalAlignment?"Top":"Center"==t.VerticalAlignment?"Center":"Bottom",l.ID=t.GetNodeValue(i,"Identity/ID"),l.FieldName=t.GetNodeValue(i,"Identity/Field"),l.HeaderText="2"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LangID?""!=t.GetNodeValue(i,"Identity/ArabicCaption")?t.GetNodeValue(i,"Identity/ArabicCaption"):_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource(t.GetNodeValue(i,"Identity/Caption")):t.GetNodeValue(i,"Identity/Caption"),l.HeaderAppearance=t.GetAppearance(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(i,"HeaderAppearance")),l.DataAppearance=t.GetAppearance(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(i,"DataAppearance")),l.HeaderHeight=t.HeaderHeight,l.Row=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(t.GetNodeValue(i,"HeaderAppearance/Row")),l.Column=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(t.GetNodeValue(i,"HeaderAppearance/Column")),""!=t.GetNodeValue(i,"Width")&&(l.width=parseFloat(t.GetNodeValue(i,"Width"))),null!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(i,"Format")&&(l.DataFormat=t.GetFormat(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(i,"Format"))),l.ColumnType=t.GetNodeValue(i,"Identity/Type").toUpperCase(),null!=l.DataAppearance&&(l.DataAppearance.ColumnType=l.ColumnType),l.Formula=t.GetNodeValue(i,"Identity/Expression"),"LATEST"!=l.Formula&&"OLDEST"!=l.Formula||(l.Formula="");var n=t.GetNodeValue(i,"Identity/FormulaEvaluateAtEnd");l.EvaluateAtEnd="0"==n?0:"2"==n?2:"3"==n?3:1,l.ColumnFilterExpression=t.GetNodeValue(i,"Format/ColumnFilterExpression");var a=t.GetNodeValue(i,"Identity/FiltersXML");_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(a)||(l.ColumnFilters=_Models_ReportColumnProperties__WEBPACK_IMPORTED_MODULE_21__.d.GetColumnFilter(a,t.IncludeLFTColumn)),l.PrintChars=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(t.GetNodeValue(i,"Format/PrintChars")),l.RepeatOn=t.GetNodeValue(i,"Identity/RepeatOn"),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(l.RepeatOn)||(l.RepeatType=parseInt(t.GetNodeValue(i,"Identity/RepeatType")),l.RepeatNext=parseInt(t.GetNodeValue(i,"Identity/RepeatNext")),l.RepeatEmptyColumns=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(t.GetNodeValue(i,"Identity/RepeatEmptyColumns")),l.RepeatType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Monthly&&l.RepeatType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Yearly||l.HeaderAppearance.IsVisible&&t.GetNodeValue(i,"Identity/RepeatPrevData").length>0&&(t.RepeatShowPrevMn=!0,t.RepeatPrevData=parseInt(t.GetNodeValue(i,"Identity/RepeatPrevData")),t.RepeatPrevNextCols=t.RepeatPrevData+1,"1"==t.GetNodeValue(i,"Identity/RepeatPrevDataFull")&&(t.RepeatPrevDataFull=!0),"1"==t.GetNodeValue(i,"Identity/RepeatPrevDiff")&&(t.RepeatPrevNextCols++,t.RepeatPrevDiff=!0),"1"==t.GetNodeValue(i,"Identity/RepeatPrevPercent")&&(""==t.GetNodeValue(i,"Identity/RepeatPrevDiff")&&t.RepeatPrevNextCols++,t.RepeatPrevNextCols++,t.RepeatPrevPercent=!0),"1"==t.GetNodeValue(i,"Identity/RepeatPrevDataSeperately")&&(t.RepeatPrevDataSeperately=!0),l.RepeatType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Yearly&&"1"==t.GetNodeValue(i,"Identity/RepeatPrevDataOfCurrYr")&&(t.RepeatPrevDataOfCurrYr=!0)));var r=t.GetNodeValue(i,"Identity/UseOnce");l.UseOnce="1"==r?1:"2"==r?2:"-1"==r?-1:0;var h=t.GetNodeValue(i,"Identity/ShowLevel");if("1"!=h&&"2"!=h||(l.ShowLevel=!0,"2"==h&&(t.GroupTotalsAtEnd=!0)),null!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(i,"Linking/Type"))try{l.LinkType=parseInt(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(i,"Linking/Type")),l.LinkType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.Document||l.MenuItems.ContainsKey("Map")||l.MenuItems.push("Map","Map"),null!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(i,"Linking/Dimension")?l.LinkDimension=parseInt(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(i,"Linking/Dimension")):l.LinkType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.Report&&null!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(i,"Linking/Report")&&(l.LinkDimension=parseInt(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(i,"Linking/Report"))),null!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(i,"Linking/DimensionView")&&(l.LinkDimensionView=parseInt(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(i,"Linking/DimensionView")))}catch(D){}if(l.HeaderAppearance.BackColor="#E4F1FF",l.HeaderAppearance.ForeColor="#033D6F",l.HeaderAppearance.FontSize=12,l.HeaderAppearance.IsBold=!0,l.DataAppearance.BackColor="#ffffff",l.DataAppearance.FontSize=12,l.DataAppearance.IsBold=!1,l.LinkType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.Document&&l.LinkType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.Dimension&&l.LinkType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.Attachment||(l.DataAppearance.ForeColor="#017EFA"),l.HeaderAppearance.IsVisible){l.RepeatType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.None&&-1==t.RepeatStartIndex&&(t.RepeatStartIndex=t.ColumnSource.length,t.RepeatNextCols=l.RepeatNext,t.RepeatType=l.RepeatType,t.RepeatOn=l.RepeatOn,t.RepeatEmptyColumns=l.RepeatEmptyColumns),t.ColumnSource.push(l),t.SearchColumns.Items.push(_shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__.d.ComboBoxItems_3(l.HeaderText,l.ID,l.ColumnType)),t.DisplayedCols.push(_shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__.c.CheckedListBoxItem_5(l.HeaderText,l.ID,!0));var u=new _Models_PostDataField__WEBPACK_IMPORTED_MODULE_17__.a;if(u.PostDataField_1(l,t),t.PostDataFetchFilterFields.push(u),l.Row>0&&l.Column>=0&&(l.HeaderAppearance.IsVisible=!1),null!=o){var c=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(o.DocumentElement,"Column").filter((function(e){return e.attributes.ID.value==l.ID}));c.length>0&&(l.MappedColumnReports=c),(c=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(o.DocumentElement,"RowReport")).length>0&&(l.MappedRowReports=c)}}t.ColumnSourceALL.push(l),l.HeaderAppearance.IsVisible||"FLOAT"!=l.ColumnType||t.HiddenNumericColumns.push(l)},l=0;l<s.length;l++)i(l);-1!=this.RepeatStartIndex&&this.RepeatNextCols>this.ColumnSource.length-(this.RepeatStartIndex+1)&&(this.RepeatNextCols=this.ColumnSource.length-(this.RepeatStartIndex+1)),Logger.InfoLog("ReportViewModel::Exiting BuildColumns")}catch(c){Logger.ErrorLog("ReportViewModel::Error BuildColumns",c.stack)}if(null!=this.ParentReport&&!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.Reportds.Tables[0][0].MapXML)){this.xDocMap=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f,this.xDocMap.LoadXml(this.Reportds.Tables[0][0].MapXML.toString());var n=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(this.xDocMap.DocumentElement,"Columns/Field");if(n.length>0){var a=new Array(this.ParentReport.ColumnSource.length);n.forEach((function(e){var o=t.ParentReport.ColumnSource.find((function(t){return t.ID==e.attributes.PID.value})),s=t.ColumnSource.find((function(t){return t.ID==e.attributes.CID.value}));o&&s&&(a[t.ParentReport.ColumnSource.indexOf(o)]=t.ColumnSource[t.ColumnSource.indexOf(s)])}));for(var r=[],h=0;h<a.length;h++)null!=a[h]?r.push(a[h]):(r.push(h<this.ColumnSource.length?this.ColumnSource[h].Clone():this.ParentReport.ColumnSource[h].Clone()),r[h].ID="MT"+r[h].ID+"MT",r[h].DataFormat.DateType="TEXT",r[h].HeaderText="");this.ColumnSource=r}else if(this.ParentReport.ColumnSource.length>this.ColumnSource.length)for(var u=this.ColumnSource.length;u<this.ParentReport.ColumnSource.length;u++)this.ColumnSource.push(this.ParentReport.ColumnSource[u].Clone()),this.ColumnSource[u].ID="MT"+this.ColumnSource[u].ID+"MT",this.ColumnSource[u].DataFormat.DateType="TEXT",this.ColumnSource[u].HeaderText=""}return this.ColumnSource}},{key:"RefreshChildReportColumns",value:function(){if(this.ParentReport.RepeatType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.None||190==this.ParentReport.StaticReportType)for(var e=this.ColumnSource.length-1;e>=0;e--)this.ColumnSource[e].ID.startsWith("MT")&&this.ColumnSource[e].ID.endsWith("MT")&&this.ColumnSource.RemoveAt(e);if(this.ParentReport.ReportColumns.length>this.ReportColumns.length){if(this.StaticReportType==this.ParentReport.StaticReportType&&this.StaticReportType>0)return;for(var t=this.ColumnSource.length;t<this.ParentReport.ReportColumns.length;t++)this.ColumnSource.push(this.ParentReport.ReportColumns[t].Clone()),this.ColumnSource[t].ID="MT"+this.ColumnSource[t].ID+"MT",this.ColumnSource[t].DataFormat.DateType="TEXT",this.ColumnSource[t].HeaderText="";this.ReportColumns!=this.ColumnSource&&(this.ReportColumns=this.ColumnSource)}else this.ParentReport.ReportColumns.length<this.ColumnSource.length&&this.ReportColumns!=this.ColumnSource&&(this.ReportColumns=this.ColumnSource)}},{key:"RefreshPostFilters",value:function(){var e,t,o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.IsWebApplication)if(o){for(e=0;e<this.PostDataFetchFilterFields.length&&e<this.ReportColumns.length&&this.PostDataFetchFilterFields[e].ColumnName==this.ReportColumns[e].ID&&this.PostDataFetchFilterFields[e].Header==this.ReportColumns[e].HeaderText;e++);for(t=this.PostDataFetchFilterFields.length-1;t>=e;t--)this.PostDataFetchFilterFields.RemoveAt(t);for(t=e;t<this.ReportColumns.length;t++){var s=new _Models_PostDataField__WEBPACK_IMPORTED_MODULE_17__.a;s.PostDataField_1(this.ReportColumns[t],this),this.PostDataFetchFilterFields.push(s)}}else{var i=this.ReportColumns.filter((function(e){return e.HeaderAppearance.IsVisible}));for(e=0;e<this.PostDataFetchFilterFields.length&&e<i.length&&this.PostDataFetchFilterFields[e].ColumnName==i[e].ID&&this.PostDataFetchFilterFields[e].Header==i[e].HeaderText;e++);for(t=this.PostDataFetchFilterFields.length-1;t>=e;t--)this.PostDataFetchFilterFields.RemoveAt(t);for(t=e;t<i.length;t++){var l=new _Models_PostDataField__WEBPACK_IMPORTED_MODULE_17__.a;l.PostDataField_1(i[t],this),this.PostDataFetchFilterFields.push(l)}}}},{key:"RefreshReportTotals",value:function(e){var t=this;this.totals=new Array(e.length).fill(0).map((function(){return new Array(t.lstGroup.length+1).fill(0)})),this.GrpReportTotal.TotalCols.Clear(),this.TotalCols.Clear(),this.lstGroup.forEach((function(e){e.TotalCols.Clear()})),this.GrpReportTotal.TempTotalCols.keys.forEach((function(o){var s={Key:o},i=e.find((function(e){return e.ID==s.Key}));if(i){var l=e.indexOf(i);t.TotalCols.Contains(s.Key)||t.TotalCols.push(s.Key),t.GrpReportTotal.TotalCols.push(s.Key,l)}})),this.lstGroup.forEach((function(o){o.TempTotalCols.keys.forEach((function(s){var i=e.find((function(e){return e.ID==s}));if(i){var l=e.indexOf(i);t.TotalCols.Contains(s)||t.TotalCols.push(s),o.TotalCols.push(s,l)}}))})),this.totals=new Array(e.length).fill(0).map((function(){return new Array(t.lstGroup.length+1).fill(0)})),this.ReportColumns=e}},{key:"AddTotalColumnsToGroup",value:function(e,t){var o=this;try{e.TotalCols=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a,e.TempTotalCols=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a,_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(t,"Column").forEach((function(t){var s=o.ReportColumns.find((function(e){return e.ID==t.innerHTML}));null!=s?(e.TotalCols.push(s.ID,o.ReportColumns.indexOf(s)),e.TempTotalCols.push(s.ID,o.ReportColumns.indexOf(s)),o.TotalCols.Contains(t.innerHTML)||o.TotalCols.push(t.innerHTML)):(s=o.HiddenNumericColumns.find((function(e){return e.ID==t.innerHTML})))&&s.Row>0&&(e.TotalCols.push(s.ID,o.HiddenNumericColumns.indexOf(s)),e.TempTotalCols.push(s.ID,o.HiddenNumericColumns.indexOf(s)),o.TotalCols.Contains(t.innerHTML)||o.TotalCols.push(t.innerHTML))}))}catch(s){Logger.ErrorLog("ReportViewModel::Error AddTotalColumnsToGroup",s.stack)}}},{key:"GetNodeValue",value:function(e,t){if(null==e)return"";var o=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(e,t);return o.length>0&&(o.Contains("&amp;")&&(o=o.Replace("&amp;","&")),o.Contains("&gt;")&&(o=o.Replace("&gt;",">")),o.Contains("&lt;")&&(o=o.Replace("&lt;","<")),o.Contains("&quot;")&&(o=o.Replace("&quot;",'"')),o.Contains("&apos;")&&(o=o.Replace("&apos;","'"))),o}},{key:"GetFormat",value:function(e){var t=this,o=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.b;try{var s=this.GetNodeValue(e,"Decimals").Trim();if(""!=s&&(o.DecimalsPoints=parseInt(s),-1==o.DecimalsPoints&&(o.DecimalsPoints=parseInt(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.DecimalsinAmount))),""!=(s=this.GetNodeValue(e,"RoundOff").Trim())&&(o.RoundOff=parseFloat(s)),""!=(s=this.GetNodeValue(e,"RoundOff_RT"))&&(o.RoundOff_RT=parseFloat(s)),""!=(s=this.GetNodeValue(e,"RoundOff_ST"))){var i,l=s.split(";");o.RoundOff_ST=new Array(l.length).fill(0);for(var n=0;n<l.length;n++)i=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(l[n]),o.RoundOff_ST[n]=i}else o.RoundOff_ST=[];var a=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNode(e,"SubTotalUnder");if(null!=a){o.STUnder=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.c;var r=0;a.childNodes.forEach((function(e){r=parseInt(e.attributes.ID.value);var s=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.e;s.Row=parseInt(e.attributes.R.value),s.Column=parseInt(e.attributes.C.value),s.Caption=e.innerHTML,o.STUnder.push(r,s),t.STMaxRowsUnder[r]<parseInt(e.attributes.R.value)&&(t.STMaxRowsUnder[r]=parseInt(e.attributes.R.value))}))}""!=this.GetNodeValue(e,"Commas").Trim()&&(o.Commas=parseInt(this.GetNodeValue(e,"Commas")),-1==o.Commas&&(o.Commas=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("Commas")&&"Lakhs"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.Commas?2:1)),"1"==this.GetNodeValue(e,"Currency").Trim()&&(o.Currency=!0),""!=this.GetNodeValue(e,"NegativeNumber").Trim()&&(o.NegativeNumber=parseInt(this.GetNodeValue(e,"NegativeNumber"))),o.Sort=this.GetNodeValue(e,"Sort"),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.GetNodeValue(e,"SuppressZero"))||(o.SuppressZero=!0),"1"==this.GetNodeValue(e,"WrapText")&&(o.WrapText=!0),"0"==this.GetNodeValue(e,"WrapTextPrint")&&(o.WrapTextPrint=!1),"1"==this.GetNodeValue(e,"PrintOnce")&&(o.PrintOnce=!0),o.PercentageOn=this.GetNodeValue(e,"PercentageOn");var h=this.GetNodeValue(e,"CumulativeTotals");o.CumTotal=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(h)?-1:parseInt(h),o.PrevRowValue=this.GetNodeValue(e,"PrevRowValue"),o.DateType=this.GetNodeValue(e,"DateType"),o.Expression=this.GetNodeValue(e,"Expression"),o.NumberFormat=this.GetNodeValue(e,"NumberFormat").Trim(),"1"==this.GetNodeValue(e,"ShowAvg")&&(o.ShowAvg=!0)}catch(u){Logger.ErrorLog("ReportViewModel::Error GetFormat",u.stack)}return o}},{key:"GetAppearance",value:function(e){var t=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.a;try{if(Logger.InfoLog("ReportViewModel::Entring GetAppearance"),t.Alignment=this.GetNodeValue(e,"Alignment"),t.FontFamilyName=this.GetNodeValue(e,"Font"),""!=this.GetNodeValue(e,"FontSize").Trim()){var o=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(this.GetNodeValue(e,"FontSize"));o<=0&&(o=12),t.FontSize=o}"1"!=this.GetNodeValue(e,"FontBold")&&"True"!=this.GetNodeValue(e,"FontBold")&&"True"!=this.GetNodeValue(e,"FontBold_Header")&&"True"!=this.GetNodeValue(e,"FontBold_Group")&&"True"!=this.GetNodeValue(e,"FontBold_Report")||(t.IsBold=!0),"True"==this.GetNodeValue(e,"FontItalics")&&(t.IsItalics=!0),"True"==this.GetNodeValue(e,"Underline")&&(t.IsUnderline=!0),""!=this.GetNodeValue(e,"BackGrndColor").Trim()&&(t.BackColor=this.GetNodeValue(e,"BackGrndColor")),""!=this.GetNodeValue(e,"ForeGrndColor").Trim()&&(t.ForeColor=this.GetNodeValue(e,"ForeGrndColor")),t.IsVisible="0"!=this.GetNodeValue(e,"Visibility").Trim(),t.IsPrintVisible="0"!=this.GetNodeValue(e,"PrintVisibility").Trim(),Logger.InfoLog("ReportViewModel::Exiting GetAppearance")}catch(s){Logger.ErrorLog("ReportViewModel::Error GetAppearance",s.stack)}return t}},{key:"LoadPreferences",value:function(){var e=this;this.Preferences.Clear();var t=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f,o=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(this.Reportds.Tables[0][0].CustomPreferences);if(o.length>0&&(t.LoadXml(o),t.DocumentElement.childNodes.forEach((function(t){e.Preferences.ContainsKey(t.nodeName)||e.Preferences.push(t.nodeName,_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.getNodeData(t))}))),(o=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(this.Reportds.Tables[0][0].DefaultPreferences)).length>0&&(t.LoadXml(o),t.DocumentElement.childNodes.forEach((function(t){e.Preferences.ContainsKey(t.nodeName)||e.Preferences.push(t.nodeName,_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.getNodeData(t))}))),this.HideCostCenterTree=!(!this.Preferences.ContainsKey("HideCostCenterTree")||"1"!=this.Preferences.HideCostCenterTree),this.DontApplyDateFilter=!(!this.Preferences.ContainsKey("DontApplyDateFilter")||"1"!=this.Preferences.DontApplyDateFilter),this.HideEmptyRows=!(!this.Preferences.ContainsKey("HideEmptyRows")||"1"!=this.Preferences.HideEmptyRows),this.HidePrefetch=!(!this.Preferences.ContainsKey("HidePrefetch")||"1"!=this.Preferences.HidePrefetch),this.HideRightNavigation=!(!this.Preferences.ContainsKey("HideRightNavigation")||"1"!=this.Preferences.HideRightNavigation),this.HidePostFilters=!(!this.Preferences.ContainsKey("HidePostFilters")||"1"!=this.Preferences.HidePostFilters),this.HideReportAtLoad=!(!this.Preferences.ContainsKey("HideReportAtLoad")||"1"!=this.Preferences.HideReportAtLoad),this.HidePostFilters&&(this.ShowReportFilter=!1,this.HideRightNavigation=!0),this.Preferences.ContainsKey("SelectTOP")){this.TopRecords=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(this.Preferences.SelectTOP);for(var s=0;s<this.lstGroup.length;s++)if("Summary"==this.lstGroup[s].DisplayMode){s-1,this.iTopGroupSummaryConsider=!0;break}}else this.TopRecords=0;this.PDCInclude=!(!this.Preferences.ContainsKey("IncludePDCs")||"1"!=this.Preferences.IncludePDCs),this.UnPostedDocsInclude=!(!this.Preferences.ContainsKey("IncludeUnPostedDocs")||"1"!=this.Preferences.IncludeUnPostedDocs),this.UnPostedDocsList=this.UnPostedDocsInclude&&this.Preferences.ContainsKey("IncludeUnPostedDocsList")?this.Preferences.IncludeUnPostedDocsList:"",this.UnPostedDocsReserveQtyInclude=!(!this.Preferences.ContainsKey("IncludeUnPostedDocsReserveQty")||"1"!=this.Preferences.IncludeUnPostedDocsReserveQty),this.UnPostedDocsHoldQtyInclude=!(!this.Preferences.ContainsKey("IncludeUnPostedDocsHoldQty")||"1"!=this.Preferences.IncludeUnPostedDocsHoldQty),this.IsDefaultSortColumnExists=!(!this.Preferences.ContainsKey("DefaultSortColumn")||_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(this.Preferences.DefaultSortColumn)),this.ShowOnlyAccountingData=!(!this.Preferences.ContainsKey("ShowOnlyAccountingData")||_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(this.Preferences.ShowOnlyAccountingData)),this.Preferences.ContainsKey("IncludeNonAccDocs")&&(this.IncludeNonAccDocs=this.Preferences.IncludeNonAccDocs.split(",")),this.ShowUnAppDocsToApprove=!(!this.Preferences.ContainsKey("ShowUnAppDocsToApprove")||_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(this.Preferences.ShowUnAppDocsToApprove)),this.ShowUnAppDocsToApprove&&(this.ShowUnAppDocsToApprove_UseFuncCall=!(!this.Preferences.ContainsKey("UnAppDocs_UseFunc")||_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(this.Preferences.UnAppDocs_UseFunc))),this.ShowMyUnAppDocsToBeApproved=!(!this.Preferences.ContainsKey("ShowMyUnAppDocsToBeApproved")||_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(this.Preferences.ShowMyUnAppDocsToBeApproved)),111==this.StaticReportType&&this.Preferences.ContainsKey("QuotationComparisonDocument")&&this.Preferences.QuotationComparisonDocument.length>0&&parseInt(this.Preferences.QuotationComparisonDocument)>4e4&&(this.ComparisonQuotationVisible=!0),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("SSRSServerURL")&&!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.SSRSServerURL)&&this.Preferences.ContainsKey("SSRSReport")&&(this.IsSSRS=!0,this.SSRSReportName=this.Preferences.SSRSReport)}},{key:"UpdateDefaultPreferences",value:function(){var e=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(this.Reportds.Tables[0][0].DefaultPreferences);if(e.length>0){var t=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f;t.LoadXml(e);for(var o=0;o<t.DocumentElement.children.length;o++){var s=t.DocumentElement.children[o];this.Preferences.ContainsKey(s.nodeName)?this.Preferences[s.nodeName]=s.innerHTML:this.Preferences.push(s.nodeName,s.innerHTML)}}}},{key:"LoadData",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.HideReportAtLoad&&(this.RptListShow=!1),!this.IsSSRS&&t&&this.ReportViewType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Export&&this.ReportViewType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.LoadDataOnly&&this.ReportViewType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.VPT&&null==this.BulkEdit?((this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DashBoard||this.DispayAsPopup)&&(this.LoadingVisibility=!0),null!=this.PrefetchReportTreeFilter&&(this.PrefetchReportTreeFilter.ReportLoaded=!1),this.DisplayName=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Loading"),this.IsReportLoad=!0,this.Clear(),this.PostDataFetchFilterFields.forEach((function(e){e.Clear()})),310==this.ReportID?this.process_DoWork(null,null):setTimeout((function(){e.process_DoWork(null,null),306!=e.ReportID&&307!=e.ReportID||(e.LoadingVisibility=!1)}),50)):this.IsSSRS||(this.IsReportLoad=!0,this.LoadingVisibility=!0,this.Clear(),this.process_DoWork(null,null))}},{key:"LoadChildReportData",value:function(e,t){this.MergeChildReport&&this.Data.Clear(),null!=this.oReportDialog&&null!=this.ParentReport.oReportDialog&&"APPLYDATEFILTER"==this.oReportDialog.FromDate.ExternExpression&&(this.oReportDialog.FromDate.Date=this.ParentReport.oReportDialog.FromDate.Date,this.oReportDialog.ToDate.Date=this.ParentReport.oReportDialog.ToDate.Date),Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(this.Reportds.Tables[0][0].ShowTitle)&&this.AddReportTitleRow(this.Reportds.Tables[0][0].ReportTitle.toString(),!0),Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(this.Reportds.Tables[0][0].ShowColumns)&&this.AddReportColumnRow(!0),0==this.StaticReportType||-1==this.StaticReportType?(this.ShowFilter=!1,this.ShowReportFilter=!1,this.ShowExport=!1,this.ShowHeaderButtons=!1,this.ShowRightPanel=!1,this.ShowReport=!0,this.SetQueryXMLTags(),this.process_DoWork(e,t)):110==this.StaticReportType||144==this.StaticReportType||(this.oReportDialog.SetLocationWhere(),this.SetQueryXMLTags(),this.process_DoWork(e,t))}},{key:"LoadChildReportCall",value:function(e){e.refreshDataView(),e.childReportIndex++,e.ChildReports[e.childReportIndex-1].LoadChildReportData(null,null)}},{key:"process_RunWorkerCompleted",value:function(e,t){var o=this;if(this.RptListShow=!0,null!=this.ParentReport){if(this.ParentReport.childReportIndex<this.ParentReport.ChildReports.length)return void this.LoadChildReportCall(this.ParentReport);if(this.childReportIndex>=this.ChildReports.length)return void this.ParentReport.process_RunWorkerCompleted()}else if(this.childReportIndex<this.ChildReports.length)return void this.LoadChildReportCall(this);if(this.process_DoWork_Complete(),this.refreshDataView(),null!=this.ReportSummaryData&&(113!=this.StaticReportType&&(this.ReportData=this.ReportSummaryData,this.ReportDataColumns=this.ReportSummaryDataColumns),this.ReportSummaryData=null,this.ReportSummaryDataColumns=null),null!=this.Chart)return this.Chart.RefreshChart(),void(this.LoadingVisibility=!1);if(this.ApplyDefaultSort(),this.DisplayName=this.ScreenName,this.LoadingVisibility=!1,this.IsReportLoad=!1,this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DashBoard&&this.ShowRightPanel&&this.ShowReportFilter&&(this.FilterorClear("FILTER"),this.MessageVisibility=!1),null!=this.BulkEdit&&this.BulkEdit.RefreshData(),null!=this.PrefetchReportTreeFilter){this.PrefetchReportTreeFilter.ReportLoaded=!0;var s=this.PrefetchReportTreeFilter.CostCenterFilters.find((function(e){return 50==e.CostCenterID&&e.LookupTypeID==o.ReportID}));s&&s.OnButtonClick("Delete")}304!=this.ReportID&&305!=this.ReportID||this.Data.forEach((function(e){var t,o;_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(null===(t=e.DataRow)||void 0===t?void 0:t.EmpImg)?e.DataRow.imgUrl=".\\assets\\images\\BlankProfileImage.png":(null==e?void 0:e.DataRow)&&(e.DataRow.imgUrl=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.GetPath(null===(o=e.DataRow)||void 0===o?void 0:o.EmpImg))})),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.EnableMat&&this.callbackDel.IsSubscribed&&this.callbackDel.Call()}},{key:"process_DoWork",value:function(e,t){return Object(tslib__WEBPACK_IMPORTED_MODULE_0__.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,o,s,i,l,n,a,r,h,u,c,D,d,C,p,T;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Logger.InfoLog("ReportViewModel::Entering process_DoWork"),this.IsFilterRendering=!1,this.ReportSummaryData=null,this.ReportSummaryDataColumns=null,this.PostFilterData=null,this.dicSubReportStart.Clear(),this.SetDatePickers(),this.RecordCount="",this.childReportIndex=0,this.ColumnSourceALL.filter((function(e){return!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Formula)&&e.Formula.toUpperCase().Contains("SYSTEMDATE")})).length>0||this.lstGroup.filter((function(e){return!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Formula)&&e.Formula.toUpperCase().Contains("SYSTEMDATE")})).length>0)try{this.SystemDate=new Date(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetDataTable("RPT023","")[0].date),this.SystemDateTime=this.SystemDate,this.SystemDate=new Date(this.SystemDate.getFullYear(),this.SystemDate.getMonth(),this.SystemDate.getDate())}catch(_){Logger.ErrorLog("Year:"+this.SystemDate.getFullYear()+",Mn:"+this.SystemDate.getMonth()+",Day:"+this.SystemDate.getDate()),Logger.ErrorLog("Date Error",_),this.SystemDateTime=new Date,this.SystemDate=Date.Today()}if(this.Current_YearStartDate=new Date(this.ToDatePicker.Date.getFullYear(),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.AccountingFromMonth-1,1),this.Current_YearStartDate>this.ToDatePicker.Date&&(this.Current_YearStartDate=this.Current_YearStartDate.AddYears(-1)),this.PRV_YEARSTART=this.Current_YearStartDate.AddYears(-1),1!=this.ToDatePicker.Date.getFullYear()&&(this.PRV_YEARTODATE=this.ToDatePicker.Date.AddYears(-1)),1!=this.FromDatePicker.Date.getFullYear()?this.PRV_YEARFROMDATE=this.FromDatePicker.Date.AddYears(-1):1!=this.PRV_YEARTODATE.getFullYear()&&(this.PRV_YEARFROMDATE=this.PRV_YEARTODATE.AddYears(-1)),this.CURRENT_MONTHSTART=new Date(this.ToDatePicker.Date.getFullYear(),this.ToDatePicker.Date.getMonth(),1),this.PRV_MONTHSTART=this.CURRENT_MONTHSTART.AddMonths(-1),this.PRV_MONTHEND=this.CURRENT_MONTHSTART.AddDays(-1),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("ReportsFrom")&&(this.IsReportDB="1"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ReportsFrom,this.Preferences.ContainsKey("ReportsFrom")&&("TrDB"==this.Preferences.ReportsFrom?this.IsReportDB=!1:"RptDB"==this.Preferences.ReportsFrom&&(this.IsReportDB=!0))),this.ShowReportTitleInSubReports&&null==this.ParentReport&&!this.MergeChildReport&&this.AddReportTitleRow(this.Reportds.Tables[0][0].ReportName.toString(),!0),!(this.StaticReportType>=1&&this.StaticReportType<=4||86==this.StaticReportType||156==this.StaticReportType||157==this.StaticReportType||169==this.StaticReportType||200==this.StaticReportType)){e.next=5;break}this.BackTrackType="Account",this.StaticReportObject=new _StaticReports_ACC_GeneralLedger__WEBPACK_IMPORTED_MODULE_23__.a(this),this.StaticReportObject.LoadReport(),e.next=94;break;case 5:if(!(this.StaticReportType>=5&&this.StaticReportType<=8)){e.next=13;break}return e.next=8,__webpack_require__.e(81).then(__webpack_require__.bind(null,"0T9g"));case 8:t=e.sent,o=t.ACC_TradingReports,this.BackTrackType="Account",this.StaticReportObject=new o(this),this.StaticReportObject.LoadReport(),e.next=94;break;case 13:if(97!=this.StaticReportType){e.next=17;break}this.StaticReportObject=new _StaticReportsTemp_ACC_PLTemplate__WEBPACK_IMPORTED_MODULE_39__.a(this),this.StaticReportObject.LoadReport(),e.next=94;break;case 17:if(!(this.StaticReportType>=9&&this.StaticReportType<=12||160==this.StaticReportType)){e.next=21;break}this.StaticReportType>=9&&this.StaticReportType<=12&&(this.BackTrackType="Account"),this.StaticReportObject=new _StaticReports_ACC_BillWiseReports__WEBPACK_IMPORTED_MODULE_38__.a(this),this.StaticReportObject.LoadReport(),e.next=94;break;case 21:if(!(this.StaticReportType>=13&&this.StaticReportType<=16||159==this.StaticReportType)){e.next=25;break}this.BackTrackType="Product",this.StaticReportObject=new _StaticReports_INV_StockLedger__WEBPACK_IMPORTED_MODULE_36__.a(this),this.StaticReportObject.LoadReport(),e.next=94;break;case 25:if(72!=this.StaticReportType){e.next=33;break}return e.next=28,__webpack_require__.e(58).then(__webpack_require__.bind(null,"8mzQ"));case 28:s=e.sent,i=s.ACC_BRSReport,this.StaticReportObject=new i(this),this.StaticReportObject.LoadReport(),e.next=94;break;case 33:if(!(this.StaticReportType>=82&&this.StaticReportType<=84||88==this.StaticReportType||114==this.StaticReportType||115==this.StaticReportType)){e.next=41;break}return e.next=36,__webpack_require__.e(82).then(__webpack_require__.bind(null,"Pi/L"));case 36:l=e.sent,n=l.INV_Ageing,this.BackTrackType="Product",this.StaticReportObject=new n(this),this.StaticReportObject.LoadReport(),e.next=94;break;case 41:if(87!=this.StaticReportType){e.next=49;break}return e.next=44,__webpack_require__.e(84).then(__webpack_require__.bind(null,"eoN1"));case 44:a=e.sent,r=a.REN_FloorWiseExpiry,this.StaticReportObject=new r(this),this.StaticReportObject.LoadReport(),e.next=94;break;case 49:if(111!=this.StaticReportType){e.next=57;break}return e.next=52,Promise.all([__webpack_require__.e(0),__webpack_require__.e(83)]).then(__webpack_require__.bind(null,"2Ofj"));case 52:h=e.sent,u=h.INV_ComparisonReport,this.StaticReportObject=new u(this),this.StaticReportObject.LoadReport(),e.next=94;break;case 57:if(116!=this.StaticReportType&&117!=this.StaticReportType&&118!=this.StaticReportType&&120!=this.StaticReportType){e.next=65;break}return e.next=60,__webpack_require__.e(79).then(__webpack_require__.bind(null,"g9Ew"));case 60:c=e.sent,D=c.ACC_Asset,this.StaticReportObject=new D(this),this.StaticReportObject.LoadReport(),e.next=94;break;case 65:if(98!=this.StaticReportType&&99!=this.StaticReportType){e.next=73;break}return e.next=68,__webpack_require__.e(80).then(__webpack_require__.bind(null,"LOar"));case 68:d=e.sent,C=d.ACC_CashFlow,this.BackTrackType="Account",this.StaticReportObject=new C(this),this.StaticReportObject.LoadReport(),e.next=94;break;case 73:if(121!=this.StaticReportType){e.next=77;break}this.StaticReportObject=new _StaticReports_REN_Property__WEBPACK_IMPORTED_MODULE_37__.a(this),this.StaticReportObject.LoadReport(),e.next=94;break;case 77:if(122!=this.StaticReportType&&123!=this.StaticReportType&&124!=this.StaticReportType&&125!=this.StaticReportType&&126!=this.StaticReportType&&168!=this.StaticReportType){e.next=81;break}this.StaticReportObject=new _StaticReports_REN_Property__WEBPACK_IMPORTED_MODULE_37__.a(this),this.StaticReportObject.LoadReport(),e.next=94;break;case 81:if(286!=this.StaticReportType&&306!=this.StaticReportType&&307!=this.StaticReportType){e.next=85;break}this.StaticReportObject=new _StaticReports_PAY_Reports__WEBPACK_IMPORTED_MODULE_52__.a(this),this.StaticReportObject.LoadReport(),e.next=94;break;case 85:if(!(this.StaticReportType>=5&&this.StaticReportType<=8)){e.next=93;break}return e.next=88,__webpack_require__.e(81).then(__webpack_require__.bind(null,"0T9g"));case 88:p=e.sent,T=p.ACC_TradingReports,this.BackTrackType="Account",this.StaticReportObject=new T(this),this.StaticReportObject.LoadReport(),e.next=94;break;case 93:-2==this.StaticReportType||0!=this.StaticReportType&&-1!=this.StaticReportType&&this.ReportViewType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.TransactionQuery&&this.ReportViewType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.LinkingQuery?this.LoadDynmicReportFromSP():this.LoadDynamicReport();case 94:case"end":return e.stop()}}),e,this)})))}},{key:"process_DoWork_Complete",value:function(){var e=this;if(this.ShowGrandTotalInSubReports&&null==this.ParentReport&&0!=this.ChildReports.length)try{if(!this.MergeChildReport){if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(this.GrandTotalFormulaInSubReports))this.ChildReports.forEach((function(t){e.GrpReportTotal.TotalCols.keys.forEach((function(o){var s=e.GrpReportTotal.TotalCols[o];if(null!=t.StaticReportObject){if(t.Data.length>0&&t.Data[t.Data.length-1].Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.ReportTotal){var i=t.Data[t.Data.length-1];i.Cells.length>s&&null!=i.Cells[s].Value&&(e.totals[s][0]+=parseFloat(i.Cells[s].Value))}}else t.totals.length>=s&&(e.totals[s][0]+=t.totals[s][0])}))}));else{var t=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a,o=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("R","");t.push("R",o);for(var s=0;s<this.ChildReports.length;s++)o=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("R"+(s+1),""),t.push("R"+(s+1),o);this.GrpReportTotal.TotalCols.keys.forEach((function(o){var s=e.GrpReportTotal.TotalCols[o];t.R.setFieldValue(e.totals[s][0]);var i=1;e.ChildReports.forEach((function(e){if(t["R"+i].setFieldValue(0),null!=e.StaticReportObject){if(e.Data.length>0&&e.Data[e.Data.length-1].Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.ReportTotal){var o=e.Data[e.Data.length-1];o.Cells.length>s&&null!=o.Cells[s].Value&&t["R"+i].setFieldValue(parseFloat(o.Cells[s].Value))}}else e.totals.length>=s&&t["R"+i].setFieldValue(e.totals[s][0]);i++}));var l=e.eval.EvaluateExpression(e.GrandTotalFormulaInSubReports,t).toString();try{var n=parseFloat(l);e.totals[s][0]=n}catch(a){e.totals[s][0]=0}}))}this.AddSubtotals_RT(this.GrpReportTotal,-100)}}catch(i){Logger.ErrorLog("Sub Report Totals: ",i)}this.RecordCount=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Displaying")+" "+this.Data.length.toString()+" "+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Rows"),this.IsReportLoad=!1,Logger.InfoLog("ReportViewModel::Exiting process_DoWork")}},{key:"LoadDynmicReportFromSP",value:function(){var e=this,t=null,o=null,s="",i="";if(-2==this.StaticReportType){for(var l=0,n=0,a=!1,r=!0,h=0;h<this.ReportColumns.length;h++){var u=this.ReportColumns[h];if(u.HeaderAppearance.IsVisible&&u.ID.startsWith("Ref")){a=!0;break}}switch(this.ReportID){case 25:l=40009,n=-1;break;case 26:l=40009,n=1;break;case 27:l=40009,n=0;break;case 66:l=40009,n=2;break;case 106:l=40027,n=-1,r=!1;break;case 107:l=40027,n=1,r=!1;break;case 108:l=40027,n=0,r=!1;break;case 109:l=40027,n=2,r=!1;break;case 28:l=40007,n=-1;break;case 29:l=40007,n=1;break;case 30:l=40007,n=0;break;case 67:l=40007,n=2;break;case 32:l=40012,n=-1;break;case 33:l=40012,n=1;break;case 34:l=40012,n=0;break;case 68:l=40012,n=2;break;case 35:l=40002,n=-1,r=!1;break;case 36:l=40002,n=1,r=!1;break;case 37:l=40002,n=0,r=!1;break;case 69:l=40002,n=2,r=!1;break;case 38:l=40004,n=-1,r=!1;break;case 39:l=40004,n=1,r=!1;break;case 40:l=40004,n=0,r=!1;break;case 70:l=40004,n=2,r=!1;break;case 101:l=40025,n=-1,r=!1;break;case 102:l=40025,n=1,r=!1;break;case 103:l=40025,n=0,r=!1;break;case 104:l=40025,n=2,r=!1;break;case 105:l=40025,n=3,r=!1}var c=[],D=this.oReportDialog.GetSeqNosList();if(""==D){var d=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSet("RPT038",this.IsReportDB,l.toString());null!=d&&d.Tables.length>0&&(d.Tables[0].forEach((function(e){D+=e.CostCenterID.toString()+","})),D.length>0&&(D=D.substr(0,D.length-1))),0==D.length&&(D=l.toString())}c.push(D),c.push(n),c.push(this.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")),c.push(this.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")),c.push(a),this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere?_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?c.push("-1"):c.push(this.oReportDialog.LocationWhere):c.push(null),c.push(this.SelectTag),c.push(this.FromTag),c.push(this.SelectTagAliasOnly);var C="",p=this.oReportDialog.CostCenterFilters.find((function(e){return 3==e.CostCenterID}));if(p&&null!=p.SelectedNodes&&p.SelectedNodes.length>0){var T=p.GetSeqNosListWithRoots();p.IsOneSelected||(p.IsGroupExists?(i=" AND D.ProductID=GTP.GTID",s=T.Contains(",")?",(select T.ProductID GTID from INV_Product T with(nolock),INV_Product GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.ProductID IN ("+T+") group by T.ProductID) AS GTP ":",(select T.ProductID GTID from INV_Product T with(nolock),INV_Product GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.ProductID="+T+" group by T.ProductID) AS GTP "):i=T.Contains(",")?" AND D.ProductID IN ("+T+")":" AND D.ProductID="+T)}C+=this.GetCostCenterFilter(2,r?"D.DebitAccount":"D.CreditAccount"),C+=this.GetDimensionFilter_Str("DCC.dcCCNID"),c.push(C.toString()),c.push(s),c.push(i),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ListOfQuotations(c,this.IsReportDB).then((function(t){if(o=t,a&&null!=o&&o.Tables.length>1&&!o.Columns[0].Contains("ErrorMessage")&&o.Tables[0].length>0)for(var s,i=o.Tables[1],l=function(e){for(var t=(i=o.Tables[1].filter((function(t){return t.LinkedInvDocDetailsID==o.Tables[0][e].InvDocDetailsID}))).length-1;t>=0;t--)(s=0==t?o.Tables[0][e]:{}).RefDocDate=i[t].RefDocDate,s.RefDocNo=i[t].RefDocNo,s.RefQty=i[t].RefQty,s.RefRate=i[t].RefRate,s.RefAccount1=i[t].RefAccount1,0!=t&&o.Tables[0].InsertAt(s,e+1)},n=o.Tables[0].length-1;n>=0;n--)l(n);e.LoadDynamicReportFromSP_CallBack(o)}))}else if(100==this.StaticReportType){for(var _=0,m=this.oReportDialog.GetSeqNosList(),I=0;I<this.ColumnSource.length;I++)"MissingDocuments"==this.ColumnSource[I].ID&&(_=1);var R="",S="";this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(R=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?" AND 1<>1":" AND def.dcCCNID2 IN ("+this.oReportDialog.LocationWhere+")"),S=" D.COSTCENTERID IN ("+m+")  AND CONVERT(DATETIME, D.DocDate) BETWEEN '"+this.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"' AND '"+this.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'",S+=R+this.GetDimensionFilter_Str("def.dcCCNID"),t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPTST_001",this.IsReportDB,_.toString(),S)}else if(65==this.StaticReportType){var A="";this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(A+=" AND ",_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?A+=" 1<>1":A+=" L.NodeID IN ("+this.oReportDialog.LocationWhere+")"),A+=" GROUP BY L.Name) AS T",t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPTST_65",this.IsReportDB,A)}else if(71==this.StaticReportType){var M=this.oReportDialog.GetSeqNosListWithRoots();this.oReportDialog.IsZeroSelected||this.oReportDialog.IsOneSelected||(this.oReportDialog.IsGroupExists?(i=" AND A.AccountID=GTP.GTID",s=M.Contains(",")?",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID IN ("+M+") group by T.AccountID) AS GTP ":",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID="+M+" group by T.AccountID) AS GTP "):i=M.Contains(",")?" AND A.AccountID IN ("+M+")":" AND A.AccountID="+M),t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPTST_71",this.IsReportDB,s,i,this.oReportDialog.ToDate.Date.ToString("dd MMM yyyy"))}else if(113==this.StaticReportType)t=new _StaticReports_REN_Property__WEBPACK_IMPORTED_MODULE_37__.a(this).GetPropertyProfitSummaryAll();else if(73==this.StaticReportType||this.StaticReportType>=209&&this.StaticReportType<=215)t=new _StaticReports_REN_Property__WEBPACK_IMPORTED_MODULE_37__.a(this).GetRentalReportsNew();else if(79==this.StaticReportType)o=new _StaticReports_REN_Property__WEBPACK_IMPORTED_MODULE_37__.a(this).GetDailyVacantReport();else if(85==this.StaticReportType)o=new _StaticReports_REN_Property__WEBPACK_IMPORTED_MODULE_37__.a(this).GetStatisticalReport();else if(89==this.StaticReportType){var g=this.Preferences.SalesDocs,w=this.Preferences.SalesReturnDocs;if(g.length>0||w.length>0){0==g.length&&(g="-1"),0==w.length&&(w="-1");var f="",E=this.GetDimensionFilter_Str("DCC.dcCCNID");E.length>0&&(f=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID"),t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPTST_89",this.IsReportDB,this.FromDatePicker.Date.ToString("dd MMM yyyy")+"~"+this.ToDatePicker.Date.ToString("dd MMM yyyy"),g+"~"+w+"~"+f,E)}}else if(90==this.StaticReportType){var P=this.oReportDialog.GetSeqNosList();P=P.length>2?" AND D.CostCenterID IN ("+P+")":"";var y="",O="",b="";this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(b=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID"+(this.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.oReportDialog.LocationWhere+")"),(O+=b+this.GetDimensionFilter_Str("DCC.dcCCNID")).length>0&&(y=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID "),t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPTST_90",this.IsReportDB,this.FromDatePicker.Date.ToString("dd MMM yyyy")+"~"+this.ToDatePicker.Date.AddDays(1).ToString("dd MMM yyyy")+"~"+P,y,O)}else if(150==this.StaticReportType){var N=this.oReportDialog.GetSeqNosList();N=N.length>2?" AND Acc.CostCenterID IN ("+N+")":"";var V="",v="",L="";this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(L=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID"+(this.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.oReportDialog.LocationWhere+")"),((v+=L+this.GetDimensionFilter_Str("DCC.dcCCNID")).length>0||this.FromTag.Contains("DCC."))&&(V=" INNER JOIN COM_DocCCData_History DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=ACC.InvDocDetailsID AND ACC.ModifiedDate=DCC.ModifiedDate "),V+=this.FromTag,(v+=this.GetCostCenterFilter(7,"MU.UserID")).Contains("MU.UserID")&&(V+=" LEFT JOIN ADM_Users MU WITH(NOLOCK) ON MU.UserName=ACC.ModifiedBy");var B=[];B.push(this.oReportDialog.FromDate.Date.ToString("dd/MMM/yyyy")),B.push(this.oReportDialog.ToDate.Date.ToString("dd/MMM/yyyy")),B.push(this.StaticReportType),B.push(N),B.push(this.SelectTag),B.push(this.DbSelectTag),B.push(V),B.push(v),B.push(this.Preferences.ContainsKey("Filter")?this.Preferences.Filter:""),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetCommonReport(B).then((function(t){null!=(o=t)&&function(){if(!e.ReportColumns.find((function(e){return e.ID.endsWith("_OLD")}))){for(var t=new Array,s=0;s<e.ColumnSource.length;s++)if(33==e.ColumnSource[s].ID.length){var i=e.ColumnSource[s].Clone();i.ID=i.ID+"_OLD",i.HeaderText="["+i.HeaderText+"]",t.push(i),t.push(e.ColumnSource[s])}else t.push(e.ColumnSource[s]);e.ReportColumns=t}var l=new Array;e.ReportColumns.forEach((function(e){33==e.ID.length&&(o.Tables[0].Columns.push(e.ID+"_OLD"),l.push(e.ID))}));var n="",a="",r="";o.Tables.length>0&&o.Tables[0].length>0&&function(){for(var e,t=function(t){if(n=o.Tables[0][t].DOCID.toString(),0==t&&"Add"!=o.Tables[0][t].HistoryStatus.toString()&&(a=o.Tables[0][t].DOCID.toString()),n==a){if("Add"!=o.Tables[0][t].HistoryStatus.toString()){r=o.Tables[0][t].docseqno.toString();var s=(e=o.Tables[0].filter((function(e){return e.DocID==n&&e.DocSeqNo==r&&e.SLNO<t+1}))).length-1;e.length>0&&(o.Columns[0].Contains("NewProductCode")&&(o.Tables[0][t].OldProductCode=e[s].NewProductCode),o.Columns[0].Contains("NewProductName")&&(o.Tables[0][t].OldProductName=e[s].NewProductName),o.Tables[0][t].DebitAccountNameOldvalue=e[s].DebitAccountNamenewvalue,o.Tables[0][t].DebitAccountOldvalue=e[s].DebitAccountnewvalue,o.Tables[0][t].OldAmount=e[s].NewAmount,o.Tables[0][t].OldQuantity=e[s].NewQuantity,o.Tables[0][t].CreditAccountNameOldvalue=e[s].CreditAccountNamenewvalue,o.Tables[0][t].CreditAccountOldvalue=e[s].CreditAccountnewvalue,l.forEach((function(i){o.Tables[0][t][i+"_OLD"]=e[s][i]})))}}else a=o.Tables[0][t].DOCID.toString()},s=0;s<o.Tables[0].length;s++)t(s)}()}(),e.LoadDynamicReportFromSP_CallBack(o)}))}else if(151==this.StaticReportType)_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.document.GetDocumentDrafts(0,0,2,!0).subscribe((function(t){var s=t[0].Copy();(o={Tables:[]}).Tables.push(s),e.LoadDynamicReportFromSP_CallBack(o)}));else if(91==this.StaticReportType){var F="",G=this.oReportDialog.GetSeqNosListWithRoots();this.oReportDialog.IsZeroSelected||this.oReportDialog.IsOneSelected||(this.oReportDialog.IsGroupExists?(i=" AND A.AccountID=GTP.GTID",s=G.Contains(",")?",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID IN ("+G+") group by T.AccountID) AS GTP ":",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID="+G+" group by T.AccountID) AS GTP "):i=G.Contains(",")?" AND A.AccountID IN ("+G+")":" AND A.AccountID="+G),F=" WHERE B.IsNewReference=1 AND B.DocDate<=@To ",F+=i,this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?F+=" AND 1<>1":F+=" AND B.dcCCNID"+(this.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.oReportDialog.LocationWhere+")"),F+="\n) AS T  \nWHERE (Adjusted IS NULL OR Amount<>-Adjusted) ","Due"==this.Preferences.DisplayBills?F+=" AND OverDue<=0":"OverDue"==this.Preferences.DisplayBills&&(F+=" AND OverDue>0"),F+=" --AND  (StatusID=370 OR (DocType<>14 AND DocType<>19) ) \nORDER BY AccountName,DocDate,Amount",t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPTST_91",this.IsReportDB,this.ToDatePicker.Date.ToString("dd MMM yyyy"),s,F)}else if(92==this.StaticReportType){var x=this.GetDimensionFilter_Str("DCC.dcCCNID");this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?x+=" AND 1<>1":x+=" AND DCC.dcCCNID"+(this.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.oReportDialog.LocationWhere+")"),t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPTST_92",this.IsReportDB,this.FromDatePicker.Date.ToString("dd MMM yyyy"),x,this.ToDatePicker.Date.ToString("dd MMM yyyy"))}else if(143==this.StaticReportType){var W="",k=this.GetDimensionFilter_Str("POCC.dcCCNID"),U="";if("2"==this.oReportDialog.CostCenters.SelectedValue||"3"==this.oReportDialog.CostCenters.SelectedValue||"61"==this.oReportDialog.CostCenters.SelectedValue)for(var K=0;K<this.oReportDialog.CostCenterFilters.length;K++){var H=this.oReportDialog.CostCenterFilters[K];if((H.SelectedNodes.length>0||!H.DeleteButtonVisibility)&&(2==H.CostCenterID||3==H.CostCenterID||61==H.CostCenterID)&&(2==H.CostCenterID?U="PO.CreditAccount":3==H.CostCenterID?U="PO.ProductID":61==H.CostCenterID&&(U="POCC.VehicleID"),H.SelectedNodes.length>0))if(W+=" AND ",1==H.SelectedNodes.length)W+=U+"="+H.SelectedNodes[0].Id;else{W+=U+" IN (";for(var Q=0;Q<H.SelectedNodes.length;Q++)Q>0&&(W+=","),W+=H.SelectedNodes[Q].Id;W+=")"}}k=k+" "+W.toString(),this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?k+=" AND 1<>1":k+=" AND POLoc.NodeID IN ("+this.oReportDialog.LocationWhere+")");var j=[];j.push(this.FromDatePicker.Date.ToString("dd/MMM/yyyy")),j.push(this.ToDatePicker.Date.ToString("dd/MMM/yyyy")),j.push(k),j.push(143),""!=this.oReportDialog.CostCenters.SelectedValue&&j.push(this.oReportDialog.CostCenters.SelectedValue)}else if(94==this.StaticReportType)_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPTST_94",this.IsReportDB,this.FromDatePicker.Date.ToString("dd MMM yyyy")+"~"+this.ToDatePicker.Date.ToString("dd MMM yyyy")+"~"+(this.IsReportDB?"1":"0"),this.SelectTag,this.FromTag).then((function(t){var o,s=t.Tables[0],i=[],l=[];s.Sort="DocNo";for(var n=null,a=0;a<s.length;)n==s[a].DocNo.toString()?(s[a-1].Amount=parseFloat(s[a-1].Amount)+parseFloat(s[a].Amount),(o=s[a].DebitAccount.toString()).length>0&&(i.Contains(o)||(s[a-1].DebitAccount=0==i.length?s[a].DebitAccount.toString():s[a-1].DebitAccount.toString()+","+s[a].DebitAccount.toString(),i.push(o))),(o=s[a].CreditAccount.toString()).length>0&&(l.Contains(o)||(s[a-1].CreditAccount=0==l.length?s[a].CreditAccount.toString():s[a-1].CreditAccount.toString()+","+s[a].CreditAccount.toString(),l.push(o))),t.Tables[0].Remove(s[a])):(i.Clear(),l.Clear(),n=s[a].DocNo.toString(),(o=s[a].DebitAccount.toString()).length>0&&i.push(o),(o=s[a].CreditAccount.toString()).length>0&&l.push(o),a++);e.LoadDynamicReportFromSP_CallBack(t)}));else if(95==this.StaticReportType)t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPTST_95",this.IsReportDB,this.FromTag,this.Preferences.StatusType+"~"+(this.IsReportDB?"1":"0")+"~"+this.FromDatePicker.Date.ToString("dd MMM yyyy")+"~"+this.ToDatePicker.Date.AddDays(1).ToString("dd MMM yyyy"),this.SelectTag);else if(127==this.StaticReportType)t=new _StaticReports_REN_Property__WEBPACK_IMPORTED_MODULE_37__.a(this).UnitVacant();else if(140==this.StaticReportType)new _StaticReports_REN_Property__WEBPACK_IMPORTED_MODULE_37__.a(this).UnitWiseContractExp();else if(141==this.StaticReportType)t=new _StaticReports_REN_Property__WEBPACK_IMPORTED_MODULE_37__.a(this).GetEmailDetails();else if(142==this.StaticReportType)t=new _StaticReports_REN_Property__WEBPACK_IMPORTED_MODULE_37__.a(this).UnitRenewalReport();else if(31==this.StaticReportType){var Y=this.oReportDialog.GetSeqNosListWithRoots();this.oReportDialog.IsZeroSelected||this.oReportDialog.IsOneSelected||(this.oReportDialog.IsGroupExists?(i=" AND A.AccountID=GTP.GTID",s=Y.Contains(",")?",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID IN ("+Y+") group by T.AccountID) AS GTP ":",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID="+Y+" group by T.AccountID) AS GTP "):i=Y.Contains(",")?" AND A.AccountID IN ("+Y+")":" AND A.AccountID="+Y);var X="",q="",z="";this.ReportGroups.find((function(e){return e.CDGDO.ColumnCostCenterID>5e4}))&&(q+=" INNER JOIN COM_DocCCData AS CCMAP with(nolock) ON CCMAP.AccDocDetailsID=ACC.AccDocDetailsID"),this.ReportGroups.forEach((function(e){(2==e.CDGDO.ColumnCostCenterID||e.CDGDO.ColumnCostCenterID>5e4)&&(e.CDGDO.ParentTableAlias="C"+e.CDGDO.ColumnCostCenterID,X+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+" AS "+e.ID+",",z+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+",",q+=" INNER JOIN "+e.CDGDO.ParentCostCenterSysName+" AS "+e.CDGDO.ParentTableAlias,q+=2==e.CDGDO.ColumnCostCenterID?" with(nolock) ON "+e.CDGDO.ParentTableAlias+".AccountID=ACC.AccountID":" with(nolock) ON "+e.CDGDO.ParentTableAlias+".NodeID=CCMAP."+e.CDGDO.ParentColumn)}));var J="SELECT AccDocDetailsID,DebitAccount AccountID,Amount DebitAmount,0 CreditAmount FROM ACC_DocDetails WITH(NOLOCK)"+s;J+=" WHERE DocumentType = 16 AND DebitAccount>0 AND CONVERT(DATETIME, DocDate)<='"+this.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'",i.length>0&&(J+=i.Replace("A.AccountID","DebitAccount")),J+=" UNION ALL ",J+="SELECT AccDocDetailsID,CreditAccount AccountID,0 DebitAmount,Amount CreditAmount FROM ACC_DocDetails WITH(NOLOCK)"+s,J+=" WHERE DocumentType = 16 AND CreditAccount>0 AND CONVERT(DATETIME, DocDate)<='"+this.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'",i.length>0&&(J+=i.Replace("A.AccountID","CreditAccount")),J="SELECT "+X+"SUM(DebitAmount) DebitAmount,SUM(CreditAmount) CreditAmount FROM ("+J+") AS ACC",J+=q,z.length>0&&(J+=" GROUP BY "+z.TrimEnd(",")),t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPT022",this.IsReportDB,J)}else if(80==this.StaticReportType){var Z=this.oReportDialog.GetSeqNosListWithRoots();this.oReportDialog.IsZeroSelected||this.oReportDialog.IsOneSelected||(this.oReportDialog.IsGroupExists?(i=" AND A.AccountID=GTP.GTID",s=Z.Contains(",")?",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID IN ("+Z+") group by T.AccountID) AS GTP ":",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID="+Z+" group by T.AccountID) AS GTP "):i=Z.Contains(",")?" AND A.AccountID IN ("+Z+")":" AND A.AccountID="+Z);var $="",ee="",te="";this.ReportGroups.find((function(e){return e.CDGDO.ColumnCostCenterID>5e4}))&&(ee+=" INNER JOIN COM_DocCCData AS CCMAP with(nolock) ON CCMAP.AccDocDetailsID=ACC.AccDocDetailsID");var oe=[];this.ReportGroups.forEach((function(e){(2==e.CDGDO.ColumnCostCenterID||e.CDGDO.ColumnCostCenterID>5e4)&&(e.CDGDO.ParentTableAlias="C"+e.CDGDO.ColumnCostCenterID,$+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+" AS "+e.ID+",",te+=e.CDGDO.ParentTableAlias+"."+e.CDGDO.Column+",",oe.Contains(e.CDGDO.ColumnCostCenterID)||(oe.push(e.CDGDO.ColumnCostCenterID),ee+=" INNER JOIN "+e.CDGDO.ParentCostCenterSysName+" AS "+e.CDGDO.ParentTableAlias,ee+=2==e.CDGDO.ColumnCostCenterID?" with(nolock) ON "+e.CDGDO.ParentTableAlias+".AccountID=ACC.AccountID":" with(nolock) ON "+e.CDGDO.ParentTableAlias+".NodeID=CCMAP."+e.CDGDO.ParentColumn))}));var se="SELECT AccDocDetailsID,DebitAccount AccountID,VoucherNo DocNo,DocDate,DueDate,Amount DebitAmount,0 CreditAmount FROM ACC_DocDetails WITH(NOLOCK)"+s;se+=" WHERE DocumentType = 16 AND DebitAccount>0 AND CONVERT(DATETIME, DocDate)<='"+this.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'",i.length>0&&(se+=i.Replace("A.AccountID","DebitAccount")),se+=" UNION ALL ",se+="SELECT AccDocDetailsID,CreditAccount AccountID,VoucherNo DocNo,DocDate,DueDate,0 DebitAmount,Amount CreditAmount FROM ACC_DocDetails WITH(NOLOCK)"+s,se+=" WHERE DocumentType = 16 AND CreditAccount>0 AND CONVERT(DATETIME, DocDate)<='"+this.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'",i.length>0&&(se+=i.Replace("A.AccountID","CreditAccount")),se="SELECT "+$+"DocNo,CONVERT(DATETIME,DocDate) DocDate,CONVERT(DATETIME,DueDate) DueDate,SUM(DebitAmount) DebitAmount,SUM(CreditAmount) CreditAmount FROM ("+se+") AS ACC",se+=ee,(te+="DocNo,DocDate,DueDate").length>0&&(se+=" GROUP BY "+te),t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPT022",this.IsReportDB,se)}else if(81==this.StaticReportType){var ie,le=this.oReportDialog.GetSeqNosListWithRoots();this.oReportDialog.IsZeroSelected||this.oReportDialog.IsOneSelected||(this.oReportDialog.IsGroupExists?(i=" AND B.ProductID=GTP.GTID",s=le.Contains(",")?",(select T.ProductID GTID from INV_Product T with(nolock),INV_Product GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.ProductID IN ("+le+") group by T.ProductID) AS GTP ":",(select T.ProductID GTID from INV_Product T with(nolock),INV_Product GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.ProductID="+le+" group by T.ProductID) AS GTP "):i=le.Contains(",")?" AND B.ProductID IN ("+le+")":" AND B.ProductID="+le);var ne="TRUE"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataTable("RPT039",this.IsReportDB,"")[0].Value.toString().toUpperCase(),ae="",re="",he="",ue="",ce="";this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(ce=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID"+(this.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.oReportDialog.LocationWhere+")"),((ae+=ce+this.GetDimensionFilter_Str("DCC.dcCCNID")).length>0||this.FromTag.Contains("DCC."))&&(re=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID "),ae+=this.GetCostCenterFilter(16,"D.BatchID"),this.ReportGroups.forEach((function(e){33==e.ID.length&&(400==e.CDGDO.CategoryValue&&e.CDGDO.ColumnCostCenterID>5e4&&0==re.length&&(re=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID "),ue+=e.ID+",")})),0==(he=this.GetCostCenterFilter(113,"D.StatusID")).length&&(he=" and D.StatusID=369"),ie="\ndeclare @To float\nset @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))\n            SELECT P.ProductID,P.ProductName,B.BatchNumber,B.BatchID"+(ne?"":",D.InvDocDetailsID")+",CONVERT(DATETIME,B.ExpiryDate) ExpDate,CONVERT(DATETIME,B.MfgDate) MfgDate,D.UOMConvertedQty Quantity,D.Rate,D.VoucherNo DocNo,CONVERT(DATETIME,D.DocDate) DocDate"+this.SelectTag+this.GroupSelectTag+"\nFROM [INV_DocDetails] D with(nolock)\nINNER JOIN INV_Batches B with(nolock) ON D.BatchID=B.BatchID\nINNER JOIN [INV_Product] P with(nolock) ON B.ProductID=P.ProductID"+re+this.FromTag+this.GroupFromTag+s+"\nWHERE D.BatchID>1 and D.VoucherType=1 AND D.IsQtyIgnored=0",ie+=i,ie+=he,ae.length>0&&(ie+=ae.toString()),"Current"==this.Preferences.Filter?ie+=" AND B.ExpiryDate>=@To":"Expired"==this.Preferences.Filter&&(ie+=" AND B.ExpiryDate<@To"),ie+=" AND D.DocDate<=@To",ie+=" Order By "+ue+"P.ProductName,BatchNumber,B.BatchID,B.MfgDate,D.DocDate,D.Rate";var De="";i.length>0&&(De=" inner join INV_Batches B with(nolock) on B.BatchID=D.BatchID "),ae.length>0&&(De+=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID "),ne?(ie+="\tselect D.BatchID,sum(D.UOMConvertedQty) Qty from INV_DocDetails D with(nolock)"+De+s+" where D.BatchID>1 and D.VoucherType=-1 AND D.IsQtyIgnored=0"+he+ae.toString()+i,ie+=" AND D.DocDate<=@To",ie+=" group by D.BatchID"):(ie+="\tselect D.RefInvDocDetailsID,sum(D.UOMConvertedQty) Qty from INV_DocDetails D with(nolock)"+De+s+" where D.BatchID>1 and D.VoucherType=-1 AND D.IsQtyIgnored=0"+he+ae.toString()+i,ie+=" AND D.DocDate<=@To",ie+=" group by D.RefInvDocDetailsID"),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPTST_81",this.IsReportDB,ie,(ne?"1":"0")+"~"+this.Preferences.ConsolidatedBatches).then((function(t){if(t.Tables[0].length>0&&e.ColumnSource.find((function(e){return"AvgRate"==e.ID&&e.HeaderAppearance.IsVisible}))){var o=t.Tables[0].ToTable(!0,["ProductID"]),s=[];s.push(""),s.push(0),s.push(""),s.push(e.oReportDialog.StockDimensionID),e.oReportDialog.Locations.Visible&&null!=e.oReportDialog.LocationWhere?_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.oReportDialog.LocationWhere)?s.push(-1):s.push(e.oReportDialog.LocationWhere):s.push(null),s.push(ce+e.GetDimensionFilter_Str("DCC.dcCCNID")),s.push(""),s.push(e.oReportDialog.ToDate.Date),s.push(e.UnPostedDocsInclude),s.push(0),s.push(0),s.push(0),s.push(""),s.push(""),s.push(0),s.push(0),s.push(""),s.push(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.UserID),s.push(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LanguageID);for(var i=null,l="",n=0;n<o.length;n+=25){l="";for(var a=n;a<o.length&&a-n<25;a++)l.length>0&&(l+=","),l+=o[a].ProductID.toString();s[0]=l.toString();var r=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetStockValuation(s,e.IsReportDB);null==i?i=r:i.Merge(r)}t.Tables[0].Columns.push("AvgRate");var h=i.Tables[0];t.Tables[0].forEach((function(e){h.RowFilter!="ProductID="+e.ProductID.toString()&&(h.RowFilter="ProductID="+e.ProductID.toString()),e.AvgRate=0==h.length?0:h[0].AvgRate}))}e.LoadDynamicReportFromSP_CallBack(t)}))}else if(146==this.StaticReportType||148==this.StaticReportType||149==this.StaticReportType){var de=[];de.push(this.StaticReportType),de.push(this.Preferences.Location.toString()),de.push(this.oReportDialog.FromDate.Date),de.push(this.oReportDialog.ToDate.Date),de.push(this.Preferences.Feature.toString()),de.push(this.Preferences.Account.toString()),de.push(this.Preferences.Customer.toString()),de.push(this.Preferences.CreatedBy.toString()),de.push(this.Preferences.Assigned.toString()),de.push(this.Preferences.Status.toString()),t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetFeatureWiseCalendar(de)}else if(154==this.StaticReportType){var Ce="";this.ButtonSave.Visible=!1;var pe=this.Preferences.ContainsKey("History")&&"1"==this.Preferences.History;"1"==this.Preferences.StatusType?pe?Ce=" AND H.StatusID=1":(Ce=" AND E.StatusID=1 and E.FailureCount<5",this.ButtonSave.Visible=!0):"2"==this.Preferences.StatusType?Ce=pe?" AND H.StatusID=2":" AND E.StatusID=2":"-1"==this.Preferences.StatusType&&(Ce=pe?" AND H.StatusID=3":" AND (E.StatusID=3 or (E.StatusID=1 and E.FailureCount>=5))"),!this.Preferences.ContainsKey("Show")||"1"!=this.Preferences.Show&&"2"!=this.Preferences.Show||(Ce+=pe?" AND H.TemplateType="+this.Preferences.Show:" AND T.TemplateType="+this.Preferences.Show),"1"!=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.RoleID&&"TRUE"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.EnableLocationWise.toUpperCase()&&_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("LWEmailSMS")&&"TRUE"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.LWEmailSMS.toUpperCase()&&(Ce+=" AND TL.NodeID in ("+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationWhere+",0)"),t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPTST_154",this.IsReportDB,this.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"~"+this.oReportDialog.ToDate.Date.AddDays(1).ToString("dd MMM yyyy"),pe?"1":"0",Ce)}else if(158==this.StaticReportType){var Te=this.oReportDialog.GetSeqNosListWithRoots();this.oReportDialog.IsZeroSelected||this.oReportDialog.IsOneSelected||(this.oReportDialog.IsGroupExists?(i=" AND B.ProductID=GTP.GTID",s=Te.Contains(",")?",(select T.ProductID GTID from INV_Product T with(nolock),INV_Product GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.ProductID IN ("+Te+") group by T.ProductID) AS GTP ":",(select T.ProductID GTID from INV_Product T with(nolock),INV_Product GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.ProductID="+Te+" group by T.ProductID) AS GTP "):i=Te.Contains(",")?" AND B.ProductID IN ("+Te+")":" AND B.ProductID="+Te);var _e="",me="",Ie="",Re="";this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(Re=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID"+(this.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.oReportDialog.LocationWhere+")"),((me+=Re+this.GetDimensionFilter_Str("DCC.dcCCNID")).length>0||this.FromTag.Contains("DCC."))&&(Ie=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID ");var Se=_StaticReports_StaticReportsViewModel__WEBPACK_IMPORTED_MODULE_33__.b.GetFilterByDimension_3(16,this.oReportDialog.CostCenterFilters);Se.length>0&&(Se.Contains(",")?me+=" AND B.BatchID IN ("+Se+")":me+=" AND B.BatchID="+Se);var Ae=this.GetCostCenterFilter(113,"D.StatusID");0==Ae.length&&(Ae=" and D.StatusID=369"),me+=Ae,me+=" AND D.IsQtyIgnored=0 AND D.DocDate BETWEEN @From AND @To",me+=i,_e+="DECLARE @From FLOAT,@To FLOAT SET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",_e+="\nSELECT B.ProductID,B.BatchID,P.ProductName, B.BatchNumber,D.VoucherNo DocNo,'' AdjustedDocNo,CONVERT(DATETIME,D.DocDate) DocDate,A.AccountName CustomerName,CONVERT(DATETIME,B.ExpiryDate) ExpDate,CONVERT(DATETIME,B.MfgDate) MfgDate,D.UOMConvertedQty RecQty,null IssQty\n,D.VoucherType,case when D.DocumentType=5 then 1 else 2 end ST"+this.SelectTag+this.GroupSelectTag+"\nFROM [INV_DocDetails] D with(nolock) \nINNER JOIN INV_Batches B with(nolock) ON B.BatchID=D.BatchID\nINNER JOIN [INV_Product] P with(nolock) ON B.ProductID=P.ProductID\nINNER JOIN ACC_Accounts A WITH(NOLOCK) ON A.AccountID=D.CreditAccount"+Ie+this.FromTag+this.GroupFromTag+s+"\nWHERE D.BatchID>1 AND D.VoucherType=1 AND D.IsQtyIgnored=0"+me.toString()+"\nUNION ALL\nSELECT B.ProductID,B.BatchID,P.ProductName, B.BatchNumber,D.VoucherNo DocNo,S.VoucherNo AdjustedDocNo,CONVERT(DATETIME,D.DocDate) DocDate,A.AccountName CustomerName,CONVERT(DATETIME,B.ExpiryDate) ExpDate,CONVERT(DATETIME,B.MfgDate) MfgDate,null RecQty,D.UOMConvertedQty IssQty\n,D.VoucherType,case when D.DocumentType=5 then 1 else 0 end ST"+this.SelectTag+this.GroupSelectTag+"\nFROM [INV_DocDetails] D with(nolock) \nINNER JOIN INV_Batches B with(nolock) ON B.BatchID=D.BatchID\nINNER JOIN [INV_Product] P with(nolock) ON B.ProductID=P.ProductID\nINNER JOIN ACC_Accounts A WITH(NOLOCK) ON A.AccountID=D.DebitAccount"+Ie+this.FromTag+this.GroupFromTag+s+"\nLEFT JOIN [INV_DocDetails] S with(nolock) ON S.InvDocDetailsID=D.RefInvDocDetailsID\nWHERE D.BatchID>1 AND D.VoucherType=-1 AND D.IsQtyIgnored=0"+me.toString()+"\nORDER BY ProductID,BatchID,DocDate,ST DESC,VoucherNo,VoucherType DESC",t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPT022",this.IsReportDB,_e)}else if(171==this.StaticReportType){var Me,ge=this.oReportDialog.GetSeqNosListWithRoots(),we="",fe="",Ee="",Pe="";this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(Pe=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID"+(this.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.oReportDialog.LocationWhere+")"),fe+=Pe+this.GetDimensionFilter_Str("DCC.dcCCNID"),Me=this.GetCostCenterFilter(300,"D.CostCenterID"),(fe.length>0||this.FromTag.Contains("DCC."))&&(Ee=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID ");var ye="",Oe="";0==this.UnPostedDocsList.length?ye=" AND (D.StatusID=369)":ye+=" AND D.StatusID IN (369,"+this.UnPostedDocsList+")",Oe=ye,Oe=this.PDCInclude?" AND D.DocumentType<>16 AND ((D.StatusID=370 or D.StatusID=439) OR (D.DocumentType<>14 AND D.DocumentType<>19"+Oe+"))":" AND D.DocumentType NOT IN (16,14,19)"+Oe,!this.oReportDialog.IsZeroSelected&&!this.oReportDialog.IsOneSelected&&ge.length>0&&(this.oReportDialog.IsGroupExists?(i="=GTP.GTID",s=ge.Contains(",")?",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID IN ("+ge+") group by T.AccountID) AS GTP ":",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID="+ge+" group by T.AccountID) AS GTP "):i=ge.Contains(",")?" IN ("+ge+")":"="+ge),we+="select A.AccountName,A.AccountID,P.Remarts Description,P.Amount,convert(datetime,P.DueDate) DueDate,P.VoucherNo PTVoucherNo,P.Percentage",this.SelectTag.length>0&&(we+=this.SelectTag),we+="\nfrom COM_DocPayTerms P with(nolock)\ninner join acc_accounts A with(nolock) on P.AccountID=A.AccountID",(Ee.length>0||fe.length>0||this.SelectTag.length>0||Me.length>0)&&(we+=" inner join INV_DocDetails D with(nolock) ON D.VoucherNo=P.VoucherNo and D.DocSeqNo=1 "+Ee+this.FromTag),we+=s,we+="\nwhere 1=1",this.oReportDialog.ToDate.Visible&&(we+=" AND P.DueDate<=convert(float,convert(datetime,'"+this.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))"),i.length>0&&(we+=" AND A.AccountID"+i),fe.length>0&&(we+=fe.toString()),Me.length>0&&(we+=Me),we+=ye,we+="\nORDER BY AccountName,P.DueDate\n\nselect CreditAccount AccountID,VoucherNo,convert(datetime,D.DocDate) DocDate,Amount,A.AccountName Particulars,D.ChequeNumber,convert(datetime,D.ChequeDate) ChequeDate,convert(datetime,D.ChequeMaturityDate) ChequeMaturityDate\nfrom Acc_DocDetails D with(nolock)\ninner join acc_accounts A with(nolock) on D.DebitAccount=A.AccountID\n",fe.toString().Contains("DCC.")&&(we+=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.AccDocDetailsID=D.AccDocDetailsID"),we+=s,we+="\nWHERE 1=1",i.length>0&&(we+=" AND D.CreditAccount"+i),we+=fe.toString(),we+=Oe,we+="\nORDER BY DocDate,DocPrefix,DocNumber",we+="\nselect D.DebitAccount AccountID,sum(D.Amount) Amount from acc_docdetails D with(nolock)",fe.toString().Contains("DCC.")&&(we+=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.AccDocDetailsID=D.AccDocDetailsID"),we+=s,we+="\nWHERE documenttype=16 ",i.length>0&&(we+=" AND D.DebitAccount"+i),we+=fe.toString(),we+=" GROUP BY D.DebitAccount HAVING sum(D.Amount)>0",t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSet("RPT022",this.IsReportDB,we)}else if(this.StaticReportType>=172&&this.StaticReportType<=175||this.StaticReportType>=180&&this.StaticReportType<=183){var be=this.StaticReportType>=180&&this.StaticReportType<=183,Ne="",Ve="",ve=this.oReportDialog.GetSeqNosListWithRoots();be?this.oReportDialog.IsZeroSelected||this.oReportDialog.IsGroupExists&&"1"==ve||(ve.Contains(",")?Ve+=" AND JO.ProductID IN ("+ve+")":Ve+=" AND JO.ProductID="+ve):this.oReportDialog.IsZeroSelected||this.oReportDialog.IsGroupExists&&"2"==ve||(ve.Contains(",")?Ve+=" AND JO.NodeID IN ("+ve+")":Ve+=" AND JO.NodeID="+ve);var Le="";this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(Le=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID"+(this.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.oReportDialog.LocationWhere+")"),Ne+=Le+this.GetDimensionFilter_Str("DCC.dcCCNID");var Be=33,Fe=1;switch(this.StaticReportType){case 172:case 180:Be=33,Fe=1;break;case 173:case 181:Be=33,Fe=2;break;case 174:case 182:Be=34,Fe=1;break;case 175:case 183:Be=34,Fe=2}var Ge=[];Ge.push(Be),Ge.push(Fe),Ge.push(be),Ge.push(Ne.toString()),Ge.push(Ve.toString()),Ge.push(this.Preferences.ContainsKey("ProductsNotInBOM")&&"1"==this.Preferences.ProductsNotInBOM?1:0),Ge.push(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LanguageID),t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.PRDJobWiseVariance(Ge)}else if(185==this.StaticReportType){var xe=this.oReportDialog.GetSeqNosListWithRoots();this.oReportDialog.IsZeroSelected||this.oReportDialog.IsOneSelected||(this.oReportDialog.IsGroupExists?(i=" AND P.ProductID=GTP.GTID",s=xe.Contains(",")?",(select T.ProductID GTID from INV_Product T with(nolock),INV_Product GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.ProductID IN ("+xe+") group by T.ProductID) AS GTP ":",(select T.ProductID GTID from INV_Product T with(nolock),INV_Product GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.ProductID="+xe+" group by T.ProductID) AS GTP "):i=xe.Contains(",")?" AND P.ProductID IN ("+xe+")":" AND P.ProductID="+xe);var We="",ke="",Ue="",Ke="";this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(Ke=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID"+(this.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.oReportDialog.LocationWhere+")"),((ke+=Ke+this.GetDimensionFilter_Str("DCC.dcCCNID")).length>0||this.FromTag.Contains("DCC."))&&(Ue=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID "),ke+=" WHERE D.DocDate BETWEEN @From AND @To",this.Preferences.ContainsKey("SerialNo")&&!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(this.Preferences.SerialNo)&&(ke+=" AND S.SerialNumber='"+this.Preferences.SerialNo.Replace("'","''")+"'"),ke+=i,We+="DECLARE @From FLOAT,@To FLOAT SET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",We+="\nselect S.SerialNumber,P.ProductCode,P.ProductName,convert(datetime,DocDate) DocDate,D.VoucherNo,D.Rate,'Receipt' VType,D.VoucherType,1 IssQty,null RecQty\n"+this.SelectTag+this.GroupSelectTag+"\nfrom INV_SerialStockProduct S with(nolock)\ninner join Inv_DocDetails D with(nolock) on D.InvDocDetailsID=S.InvDocDetailsID\ninner join Inv_Product P with(nolock) on P.ProductID=D.ProductID",this.GroupSelectTag.Contains("A.")&&(We+=" INNER JOIN ACC_Accounts A WITH(NOLOCK) ON A.AccountID=D.CreditAccount"),We+=Ue+this.FromTag+s,We+=ke.toString()+" and D.VoucherType=1",We+="\nunion all\nselect S.SerialNumber,P.ProductCode,P.ProductName,convert(datetime,DocDate) DocDate,D.VoucherNo,D.Rate,'Issue' VType,D.VoucherType,null IssQty,1 RecQty\n"+this.SelectTag+this.GroupSelectTag+"\nfrom INV_SerialStockProduct S with(nolock)\ninner join Inv_DocDetails D with(nolock) on D.InvDocDetailsID=S.InvDocDetailsID\ninner join Inv_Product P with(nolock) on P.ProductID=D.ProductID",this.GroupSelectTag.Contains("A.")&&(We+=" INNER JOIN ACC_Accounts A WITH(NOLOCK) ON A.AccountID=D.DebitAccount"),We+=Ue+this.FromTag+s,We+=ke.toString()+" and D.VoucherType=-1\norder by ProductName,SerialNumber,DocDate,VoucherType desc",t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPT022",this.IsReportDB,We)}else{if(190==this.StaticReportType){var He;He=null!=this.POSExitViewModel?this.POSExitViewModel.GetReportDataTable():_pages_home_RibbonExtViewModel__WEBPACK_IMPORTED_MODULE_28__.RibbonExtViewModel.GetposDayclose(this);for(var Qe=[],je=[],Ye=0;Ye<this.ColumnSource.length;Ye++)if("StyleIsBold"!=this.ColumnSource[Ye].ID)if("Value"==this.ColumnSource[Ye].ID)for(var Xe=this.oReportDialog.FromDate.Date;Xe<=this.oReportDialog.ToDate.Date;){var qe=this.ColumnSource[Ye].Clone();qe.HeaderText=Xe.ToString("dd-MMM-yy"),qe.ID=Xe.ToString("ddMMMyyyy"),Qe.push(qe),Xe=Xe.AddDays(1)}else Qe.push(this.ColumnSource[Ye].Clone());for(var ze=0;ze<Qe.length;ze++)je.push(Qe[ze].ID);return this.ReportColumns=Qe,(o={Tables:[],Columns:[]}).Columns.push(je),o.Tables.push(He),void this.LoadDynamicReportFromSP_CallBack(o)}if(195==this.StaticReportType){var Je="",Ze="";this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(Ze=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID"+(this.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.oReportDialog.LocationWhere+")"),Je+=Ze+this.GetDimensionFilter_Str("DCC.dcCCNID");var $e=this.GetCostCenterFilter(3,"P.ProductID"),et=_StaticReports_StaticReportsViewModel__WEBPACK_IMPORTED_MODULE_33__.b.GetFilterByDimension_3(300,this.oReportDialog.CostCenterFilters),tt="";tt+='<XML ToDate="'+this.oReportDialog.ToDate.Date.ToString("dd MMM yyyy"),tt+='" POFilter="'+(this.Preferences.ContainsKey("POConsiderDueDate")&&"1"==this.Preferences.POConsiderDueDate?"DueDate":"DocDate"),tt+='" PODocs="'+(this.Preferences.ContainsKey("ExpectedDocs")?this.Preferences.ExpectedDocs:""),tt+='">',tt+="<Select>"+this.SelectTag+"</Select>",tt+="<Join>"+this.FromTag+"</Join>",tt+="<CCWhere>"+Je.toString()+"</CCWhere>",$e.length>0&&(tt+="<ProductWhere>"+$e+"</ProductWhere>"),tt+="</XML>";var ot=this.Preferences.ContainsKey("POConsiderInQOH")&&"1"==this.Preferences.POConsiderInQOH?"1":"0";t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetMRP_Param195(11,0,tt.toString(),et,null,ot)}else if(198==this.StaticReportType){var st=this.oReportDialog.GetSeqNosListWithRoots();this.oReportDialog.IsZeroSelected||this.oReportDialog.IsOneSelected||(this.oReportDialog.IsGroupExists?(i=" AND B.AccountID=GTP.GTID",s=st.Contains(",")?",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID IN ("+st+") group by T.AccountID) AS GTP ":",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID="+st+" group by T.AccountID) AS GTP "):i=st.Contains(",")?" AND B.AccountID IN ("+st+")":" AND B.AccountID="+st);var it="",lt="",nt="";this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(nt=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?" AND 1<>1":" AND B.dcCCNID"+(this.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.oReportDialog.LocationWhere+")"),lt+=nt+this.GetDimensionFilter_Str("B.dcCCNID");var at=this.GetCostCenterFilter(300,"CostCenterID"),rt="";this.ReportGroups.forEach((function(e){rt+=e.ID+","})),it+="DECLARE @From FLOAT,@To FLOAT SET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+'\'))\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,\'" + oReportDialog.ToDate.Date.ToString("dd MMM yyyy") + "\'))";\n\n            sb+=@"\nselect A.AccountID,0 IsAdjustment,B.DocNo MainDocNo,B.DocSeqNo MainDocSeqNo,convert(datetime,B.DocDate) DocDate,abs(B.AdjAmount) Amount,CONVERT(FLOAT,null) AdjAmount,A.AccountName\n,case when B.BillNo is not null then  B.BillNo else (select Top 1 BillNo from INV_DocDetails where VoucherNo=B.RefDocNo) end BillNo\n,convert(datetime,(case when B.BillDate is not null then  B.BillDate else (select Top 1 BillDate from INV_DocDetails where VoucherNo=B.RefDocNo) end)) BillDate\n,B.RefDocNo,convert(datetime,B.RefDocDate) RefDocDate\n'+this.SelectTag+"from com_billwise B with(nolock) \ninner join ACC_Accounts A with(nolock) on B.AccountID=A.AccountID\ninner join (select VoucherNo,DocPrefix,DocNumber from acc_docdetails with(nolock) where 1=1 "+at+" Group by VoucherNo,DocPrefix,DocNumber) as T on T.VoucherNo=B.Docno\n"+this.FromTag+s+"\n--where (B.Docno='PMT-600')\nwhere B.DocDate between @From and @To "+lt.toString()+i+"\norder by "+rt+"T.DocPrefix,convert(int,T.DocNumber),MainDocSeqNo,A.AccountID\n\nselect A.AccountID,1 IsAdjustment,B.RefDocNo MainDocNo,B.RefDocSeqNo MainDocSeqNo,null DocDate,abs(B.AdjAmount) Amount,abs(B.AdjAmount) AdjAmount,A.AccountName\n,case when B.BillNo is not null then  B.BillNo else (select Top 1 BillNo from INV_DocDetails where VoucherNo=B.RefDocNo) end BillNo\n,convert(datetime,(case when B.BillDate is not null then  B.BillDate else (select Top 1 BillDate from INV_DocDetails where VoucherNo=B.RefDocNo) end)) BillDate\n,B.DocNo RefDocNo,convert(datetime,B.DocDate) RefDocDate\n"+this.SelectTag+"\nfrom com_billwise B with(nolock) \ninner join ACC_Accounts A with(nolock) on B.AccountID=A.AccountID\ninner join (select VoucherNo from acc_docdetails with(nolock) where 1=1 "+at+" Group by VoucherNo) as T on T.VoucherNo=B.RefDocno\n"+this.FromTag+s+"\n--where (B.RefDocno='PMT-600')\nwhere B.RefDocDate between @From and @To "+i;var ht="";this.ReportGroups.forEach((function(e){ht+=e.ID+","})),ht=ht.TrimEnd(","),t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPTST_198",this.IsReportDB,it,ht)}else if(202==this.StaticReportType)t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPTST_202",this.IsReportDB,this.Preferences.Filter);else if(207==this.StaticReportType){var ut="",ct="",Dt="";this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(Dt=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID"+(this.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.oReportDialog.LocationWhere+")"),((ct+=Dt+this.GetDimensionFilter_Str("DCC.dcCCNID")).length>0||this.FromTag.Contains("DCC."))&&(ut=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.AccDocDetailsID=D.AccDocDetailsID"),ut+=this.FromTag;var dt=this.GetCostCenterFilter(300,"CostCenterID"),Ct=[];Ct.push(this.FromDatePicker.Date),Ct.push(this.ToDatePicker.Date),Ct.push(this.StaticReportType),Ct.push(dt),Ct.push(this.SelectTag),Ct.push(""),Ct.push(ut),Ct.push(ct),Ct.push(""),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetCommonReport(Ct).then((function(t){t.Tables[0].Columns.push("AccountName"),t.Tables[0].Columns.push("DrAccName"),t.Tables[0].Columns.push("CrAccName"),t.Tables[0].Columns.push("Amount"),e.TotalCols.Clear(),e.GrpReportTotal.TotalCols.Clear(),e.ReportParams.ContainsKey("TotalAmountIndex")||e.ReportParams.push("TotalAmountIndex","");for(var o=[],s=0;s<e.ColumnSource.length;s++)"Slab"!=e.ColumnSource[s].ID&&(o.push(e.ColumnSource[s].Clone()),e.GrpReportTotal.TempTotalCols.ContainsKey(e.ColumnSource[s].ID)&&(e.TotalCols.push(e.ColumnSource[s].ID),e.GrpReportTotal.TotalCols.push(e.ColumnSource[s].ID,s),"Amount"!=e.ColumnSource[s].ID&&"TotalAmount"!=e.ColumnSource[s].ID||(e.ReportParams.TotalAmountIndex=s.toString())));var i=e.ColumnSource.find((function(e){return"Slab"==e.ID}));t.Tables[0].length>0&&null!=i&&function(){e.ReportParams.ContainsKey("SlabIndex")||e.ReportParams.push("SlabIndex",""),e.ReportParams.SlabIndex=o.length.toString();var s=Math.min.apply(Math,t.Tables[0].map((function(e){return e.StartDate}))),l=new Date(s);s=Math.min.apply(Math,t.Tables[0].map((function(e){return e.EndDate})));for(var n,a=new Date(s),r=new Date(l.getFullYear(),l.getMonth(),1);r<=a;){var h=i.Clone();h.HeaderText=r.ToString("MMM-yyyy"),h.ID=r.ToString("yyyy-MM"),o.push(h),r=r.AddMonths(1),t.Tables[0].Columns.push(h.ID),e.TotalCols.push(h.ID),e.GrpReportTotal.TotalCols.push(h.ID,o.length-1)}for(var u,c,D,d,C=!1,p=0,T=null,_=null,m=0;m<t.Tables[0].length;m++)if(c=t.Tables[0][m],C=18==(n=parseInt(c.DocumentType))||22==n,c.AccountName=C?c.CrMainAccName.toString():c.DrMainAccName.toString(),(d=t.Tables[1].filter((function(e){return e.AccDocDetailsID==c.AccDocDetailsID}))).length>0)for(var I=0;I<d.length;I++)T==(D=d[I]).DrAccName.toString()&&_==D.CrAccName.toString()||(I>0&&(c=t.Tables[0].NewRow(),m++,t.Tables[0].InsertAt(c,m)),T=D.DrAccName.toString(),_=D.CrAccName.toString(),c.DrAccName=T,c.CrAccName=_,p=0),u=new Date(D.DocDate).ToString("yyyy-MM"),null==c[u]&&(c[u]=D.Amount),p+=parseFloat(D.Amount),c.Amount=p}(),e.totals=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.NumArray(o.length,e.lstGroup.length+1),e.ReportColumns=o,e.LoadDynamicReportFromSP_CallBack(t)}))}else if(203==this.StaticReportType||204==this.StaticReportType){var pt=this.oReportDialog.GetSeqNosListWithRoots();this.oReportDialog.IsZeroSelected||this.oReportDialog.IsOneSelected||(this.oReportDialog.IsGroupExists?(i=" AND D.ProductID=GTP.GTID",s=pt.Contains(",")?",(select T.ProductID GTID from INV_Product T with(nolock),INV_Product GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.ProductID IN ("+pt+") group by T.ProductID) AS GTP ":",(select T.ProductID GTID from INV_Product T with(nolock),INV_Product GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.ProductID="+pt+" group by T.ProductID) AS GTP "):i=pt.Contains(",")?" AND D.ProductID IN ("+pt+")":" AND D.ProductID="+pt);var Tt="",_t="",mt="";this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(mt=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID"+(this.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.oReportDialog.LocationWhere+")"),((_t+=mt+this.GetDimensionFilter_Str("DCC.dcCCNID")).length>0||this.FromTag.Contains("DCC."))&&(Tt=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID"),Tt+=this.FromTag;var It=this.GetCostCenterFilter(113,"D.StatusID");0==It.length&&(It=" and D.StatusID=369"),_t+=It;var Rt="";this.ReportGroups.forEach((function(e){Rt.length>0&&(Rt+=","),Rt+=e.ID}));var St=[];St.push(this.FromDatePicker.Date),St.push(this.ToDatePicker.Date),St.push(this.StaticReportType),St.push(""),St.push(this.SelectTag+this.GroupSelectTag),St.push(this.DbSelectTag+this.DbGroupSelectTag),St.push(Tt+s+this.GroupFromTag),St.push(i+_t),St.push(Rt),t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetCommonReport(St)}else if(294==this.StaticReportType){var At=this.oReportDialog.GetSeqNosList(),Mt="";At.length>0&&!this.oReportDialog.IsZeroSelected&&!this.oReportDialog.IsOneSelected&&(Mt+=" and B.BOMID IN ("+At+")");var gt=[];gt.push(this.StaticReportType),gt.push(""),gt.push(s),gt.push(i+Mt),t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetProductionReport(gt,this.IsReportDB)}else if(296==this.StaticReportType){if(this.oReportDialog.CostCenterFilters.length>0)for(var wt=0;wt<this.oReportDialog.CostCenterFilters.length;wt++)if(50051==this.oReportDialog.CostCenterFilters[wt].CostCenterID){for(var ft="",Et=0;Et<this.oReportDialog.CostCenterFilters[wt].SelectedNodes.length;Et++)ft.length>0&&(ft+=","),ft+=this.oReportDialog.CostCenterFilters[wt].SelectedNodes[Et].Id.toString();ft.length>0&&_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPTST_296",this.IsReportDB,ft,this.oReportDialog.FromDate.Date.ToString("dd/MMM/yyyy"),this.oReportDialog.ToDate.Date.ToString("dd/MMM/yyyy"))}}else if(298==this.StaticReportType){var Pt=this.oReportDialog.GetSeqNosList();if(Pt=Pt.length>2?" AND Curr.CostCenterID IN ("+Pt+")":"",this.Preferences.ContainsKey("ShowFields")&&!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.Preferences.ShowFields)){Pt+=" AND (";var yt=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f;yt.LoadXml("<XML>"+this.Preferences.ShowFields+"</XML>"),yt.DocumentElement.childNodes.forEach((function(e){"Common"==e.nodeName?Pt+=" ([Nxt].SysTableName='INV_DocDetails' OR [Nxt].SysTableName='ACC_DocDetails') OR ":"Numeric"==e.nodeName?Pt+=" [Nxt].SysColumnName LIKE 'dcNum%' OR ":"CostCenter"==e.nodeName?Pt+=" [Nxt].SysColumnName LIKE 'dcCCNID%' OR ":"Alpha"==e.nodeName&&(Pt+=" [Nxt].SysColumnName LIKE 'dcAlpha%' OR ")})),Pt=Pt.Remove(Pt.length-3)+" )"}var Ot=[];Ot.push(400),Ot.push(Pt),Ot.push(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.UserID),Ot.push(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.RoleID),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetAuditData(Ot,this.IsReportDB).then((function(t){for(var o=null,s=[],i=0;i<e.ColumnSource.length;i++)"RepeatCol"==e.ColumnSource[i].ID?o=e.ColumnSource[i].Clone():s.push(e.ColumnSource[i].Clone());for(var l="",n=function(e){t.Tables[0].Columns[e].Caption.startsWith("diff")&&(0==t.Tables[0].filter((function(t){return t.ds.Tables[0].Columns[e].Caption+"=1"})).length?(t.Tables[0].Columns.RemoveAt(e),t.Tables[0].Columns.RemoveAt(e-1),t.Tables[0].Columns.RemoveAt(e-2),e--):(s.push(o.Clone()),s[s.length-1].HeaderText="Old "+t.Tables[0].Columns[e].Caption.substr(4),s[s.length-1].ID="old"+t.Tables[0].Columns[e].Caption.substr(4),s.push(o.Clone()),s[s.length-1].HeaderText="New "+t.Tables[0].Columns[e].Caption.substr(4),s[s.length-1].ID="new"+t.Tables[0].Columns[e].Caption.substr(4),l+='<Row ID="old'+t.Tables[0].Columns[e].Caption.substr(4)+'" Formula="if('+t.Tables[0].Columns[e].Caption+'==1) 1 else 0" Expression=" if ('+t.Tables[0].Columns[e].Caption+'==1)1 else 0" BackColor="#FFFFB5B6" ForeColor="" Img="" Text="" />',l+='<Row ID="new'+t.Tables[0].Columns[e].Caption.substr(4)+'" Formula="if('+t.Tables[0].Columns[e].Caption+'==1) 1 else 0" Expression=" if ('+t.Tables[0].Columns[e].Caption+'==1)1 else 0" BackColor="#FFFFB5B6" ForeColor="" Img="" Text="" />',e+=2)),a=e},a=0;a<t.Tables[0].Columns.length;a++)n(a);if(e.ReportColumns=s,e.kpiList.Clear(),e.kpiListSrc.Clear(),l.length>0){l="<XML>"+l,l+="</XML>";var r=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f;r.LoadXml(l.toString()),r.DocumentElement.childNodes.forEach((function(t){var o=new _StaticReports_StaticReportsViewModel__WEBPACK_IMPORTED_MODULE_33__.a;o.KPI_1(t,e),e.kpiList.push(o),e.kpiListSrc.push(e.kpiList[e.kpiList.length-1])}))}e.LoadDynamicReportFromSP_CallBack(t)}))}else if(299==this.StaticReportType){var bt=this.GetCostCenterFilter(300,"C.CostCenterID"),Nt=[];Nt.push(this.FromDatePicker.Date),Nt.push(this.ToDatePicker.Date),Nt.push(this.StaticReportType),Nt.push(""),Nt.push(null),Nt.push(null),Nt.push(null),Nt.push(bt),Nt.push(null),t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetCommonReport(Nt)}}t&&t.then((function(t){e.LoadDynamicReportFromSP_CallBack(t)}),(function(e){}))}},{key:"LoadDynamicReportFromSP_CallBack",value:function(e){this.ClearRows();for(var t=this.totals.length-1;t>=0;t--)for(var o=this.totals[0].length-1;o>=0;o--)this.totals[t][o]=0;this.hiddenTotals=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.NumArray(this.HiddenNumericColumns.length,this.lstGroup.length+1);var s=null;if(null!=e&&e.Tables.length>0&&!e.Columns[0].Contains("ErrorMessage")&&e.Tables[0].length>0){if(this.ReportData=e.Tables[0],this.ReportDataColumns=e.Columns[0],this.ConstructFormulaFields(!0),this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.LoadDataOnly||null!=this.Chart)return;if(this.SNo=0,this.colSNoIndex=this.ReportColumns.indexOf(this.ReportColumns.find((function(e){return 0==_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.stringCompare(e.Formula,"SNO",!0)}))),null!=this.MatrixObject&&(this.MatrixObject.MatrixRows.Items.length>0||this.MatrixObject.MatrixColumns.Items.length>0||this.MatrixObject.MatrixValues.Items.length>0))return void this.MatrixObject.LoadMatrixReport(e.Tables[0],e.Columns[0]);this.RenderData(e.Tables[0],e.Columns[0]),e.Tables[0].length>0&&(s=e.Tables[0][e.Tables[0].length-1])}for(var i=this.lstGroup.length;i>0;i--)null!=s&&this.AddSubtotals(s,this.lstGroup[i-1],i),this.Groupstr[this.lstGroup[i-1].ID]=null;if(this.GrpReportTotal.SubTotalAppearance.IsVisible&&(this.AddSubtotals_RT(this.GrpReportTotal,0),207==this.StaticReportType)){var l=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(this.ReportColumns.length),n=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.a;n.IsBold=!0,n.ForeColor="#FF000000",n.BackColor="White",n.FontFamilyName="Arial",n.FontSize=12,n.Alignment="Right",l.Cells[0].ColSpan=parseInt(this.ReportParams.SlabIndex),l.Cells[0].Text=" Closing balance",l.Cells[0].CellAppearance=n,l.Cells[0].DataFormat=this.GrpReportTotal.SubTotalFormat,l.Cells[0].IsNormal=!1,this.GrpReportTotal.SubTotalHeight>0&&(l.Cells[0].height=this.GrpReportTotal.SubTotalHeight);for(var a=this.totals[parseInt(this.ReportParams.TotalAmountIndex)][0],r=parseInt(this.ReportParams.SlabIndex);r<this.ReportColumns.length;r++)a-=this.totals[r][0],_ReportViewModel.SetCellValue(a,this.ReportColumns[r].DataFormat,"FLOAT",0,l.Cells[r]),l.Cells[r].CellAppearance=n,l.Cells[r].DataFormat=this.GrpReportTotal.SubTotalFormat,l.Cells[r].IsNormal=!1,this.GrpReportTotal.SubTotalHeight>0&&(l.Cells[r].height=this.GrpReportTotal.SubTotalHeight);this.addRow(l)}this.process_RunWorkerCompleted(null,null)}},{key:"LoadAPIReportData",value:function(e,t){if(-1==this.StaticReportType&&this.Reportds.Tables.length>2&&this.Reportds.Tables[2].length>0){for(var o="",s="",i="",l="",n=null,a=null,r=0;r<this.Reportds.Tables[2].length;r++)try{if(s="1"==this.Reportds.Tables[2][r].Format.toString()?"XML":"2"==this.Reportds.Tables[2][r].Format.toString()||"3"==this.Reportds.Tables[2][r].Format.toString()?"JSON":"",l="",o=this.Reportds.Tables[2][r].Params.toString(),!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(o)&&(n=o.split(",")).length>0)for(var h=0;h<n.length-1;h++)if((a=n[h].split("~")).length>1)if(a.length>2&&"ARRAY"==a[2])for(var u=0;u<e.length;u++)l+=a[0]+"~",t.Contains(a[1])?l+=e[u][a[1]].toString():l+=a[1],l+=",";else l+=a[0]+"~",t.Contains(a[1])?l+=e[0][a[1]].toString():l+=a[1],l+=",";if(i="",o=this.Reportds.Tables[2][r].Body.toString(),!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(o)&&(n=o.split(",")).length>0){"JSON"==s&&("2"==this.Reportds.Tables[2][r].Format.toString()&&(i+="["),i+="{");for(var c=0;c<n.length-1;c++){if(i+='"'+(a=n[c].split("~"))[0]+'":',a.length>1)if(a.length>2&&"ARRAY"==a[2]){i+="[";for(var D=0;D<e.length;D++)i+='"',t.Contains(a[1])?i+=e[D][a[1]].toString():i+=a[1],i+='"',D!=e.length-1&&(i+=",");i+="]"}else i+='"',t.Contains(a[1])?i+=e[0][a[1]].toString():i+=a[1],i+='"';c!=n.length-2&&(i+=",")}"JSON"==s&&(i+="}","2"==this.Reportds.Tables[2][r].Format.toString()&&(i+="]"))}o="";var d=o=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.common.InvokeWebAPI(this.Reportds.Tables[2][r].ActionType.toString(),this.Reportds.Tables[2][r].Url.toString(),l.toString(),this.Reportds.Tables[2][r].Headers.toString(),"",i.toString(),s,this.Reportds.Tables[2][r].Client.toString(),!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.Reportds.Tables[2][r].Audit.toString())&&"YES"==this.Reportds.Tables[2][r].Audit.toString(),50,this.ReportID,parseInt(this.Reportds.Tables[2][r].MapID.toString()));_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(o)||(console.log("APIResponse "),console.log(d.Tables[0]),this.ReportData=d.Tables[0],this.ReportDataColumns=d.Columns[0])}catch(C){return!1}return!0}return!1}},{key:"LoadDynamicReport",value:function(){var e=this;Logger.DebugLog("ReportViewModel::LoadDynamicReport::Query :::: \r\n"+this.FinalQuery+"\r\n\r\n"),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSetAsync("RPT022",this.IsReportDB,this.FinalQuery,this.ReportID.toString()).then((function(t){var o=t;if(null!=o&&o.Tables.length>0&&!o.Columns[0].Contains("ErrorMessage")&&(o.Tables[0].length>0||e.IsNoDataGroups||null!=e.LevelColumn)){if(e.LoadAPIReportData(o.Tables[0],o.Columns[0])||(e.ReportData=o.Tables[0],e.ReportDataColumns=o.Columns[0]),e.IsRevision)for(var s=e.ReportData,i=null,l=null,n=null,a=s.length-1;a>=0;a--)i!=s[a].RevDocNo.toString()||l!=s[a].RevVersionNo.toString()?(i=s[a].RevDocNo.toString(),l=s[a].RevVersionNo.toString(),n=s[a].RevModDate.toString()):n!=s[a].RevModDate.toString()&&e.ReportData.Remove(s[a]);if(null!=e.earningfields&&e.earningfields.length>0){var r=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a;e.BaseReportColumns.forEach((function(t){e.earningfields.find((function(e){return e==t.CDGDO}))&&(405==t.CDGDO.ColumnCostCenterID?t.CDGDO.Column.startsWith("dcNum")||t.CDGDO.Column.startsWith("dcCalcNum")||t.CDGDO.Column.startsWith("dcExchRT")?t.CDGDO.Column.startsWith("dcNum")?r.push(t.ID,"Earning"+t.CDGDO.Column.Replace("dcNum","")):t.CDGDO.Column.startsWith("dcCalcNum")?r.push(t.ID,"Earning"+t.CDGDO.Column.Replace("dcCalcNum","")):t.CDGDO.Column.startsWith("dcCalcNumFC")?r.push(t.ID,"EarEarning"+t.CDGDO.Column.Replace("dcCalcNumFC","")):r.push(t.ID,"Earning"+t.CDGDO.Column.Replace("dcExchRT","")):r.push("DATE"==t.CDGDO.DataType?t.ID+"_DATE":t.ID,t.CDGDO.Column):406==t.CDGDO.ColumnCostCenterID?(t.CDGDO.Column.startsWith("dcNum")||t.CDGDO.Column.startsWith("dcCalcNum")||t.CDGDO.Column.startsWith("dcExchRT"))&&(t.CDGDO.Column.startsWith("dcNum")?r.push(t.ID,"Deduction"+t.CDGDO.Column.Replace("dcNum","")):t.CDGDO.Column.startsWith("dcCalcNum")?r.push(t.ID,"Deduction"+t.CDGDO.Column.Replace("dcCalcNum","")):t.CDGDO.Column.startsWith("dcCalcNumFC")?r.push(t.ID,"EarDeduction"+t.CDGDO.Column.Replace("dcCalcNumFC","")):r.push(t.ID,"Deduction"+t.CDGDO.Column.Replace("dcExchRT",""))):410==t.CDGDO.ColumnCostCenterID&&r.push(t.ID,t.CDGDO.Column),e.ReportDataColumns.push(t.ID))}));for(var h,u=null,c=null,D=null,d="",C=0;C<e.ReportData.length;C++)d.length>0&&(d+=","),d+=e.ReportData[C].XEmpIDX;if(d.length>0){var p=new Date;if(null!=e.Filter)for(var T=0;T<e.Filter.Fields.length;T++){var _=e.Filter.Fields[T];"DATE"==_.CDGDO.DataType&&50051==_.CDGDO.CategoryValue&&-601==_.CDGDO.FieldValue&&(p=_.FromDatePicker.Date)}D=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetDataTable("RPT051",d,p.ToString("dd MMM yyyy"))}for(var m=0;m<o.Tables.length;m++)o.Columns[m].Contains("BasicMonthly")&&(c=o.Tables[m]);e.ReportData.forEach((function(e){(h=c.filter((function(t){return t.EmployeeID==e.XEmpIDX}))).length>0&&r.keys.forEach((function(t){var o={Key:t,Value:r[t]};o.Key.Contains("_DATE")?e[o.Key.Replace("_DATE","")]=new Date(h[0][o.Value].toString()):null!=D&&D.length>0?(u=null,o.Value.Contains("Earning")||o.Value.Contains("dcAlpha")?u=D.filter((function(t){return t.EmployeeID==e.XEmpIDX.toString()&&11==t.VoucherType})):o.Value.Contains("Deduction")&&(u=D.filter((function(t){return t.EmployeeID==e.XEmpIDX.toString()&&12==t.VoucherType}))),null!=u&&u.length>0?e[o.Key]=o.Value.startsWith("EarEarning")?u[0]["dcCalcNum"+o.Value.Replace("EarEarning","")]:o.Value.startsWith("EarDeduction")?u[0]["dcCalcNum"+o.Value.Replace("EarDeduction","")]:o.Value.startsWith("Earning")?u[0]["dcNum"+o.Value.Replace("Earning","")]:o.Value.startsWith("Deduction")?u[0]["dcNum"+o.Value.Replace("Deduction","")]:o.Value.startsWith("dcAlpha")?u[0][o.Value]:h[0][o.Value]:o.Value.startsWith("EarEarning")||o.Value.startsWith("EarDeduction")||o.Value.startsWith("dcAlpha")||(e[o.Key]=h[0][o.Value])):o.Value.startsWith("EarEarning")||o.Value.startsWith("EarDeduction")||o.Value.startsWith("dcAlpha")||(e[o.Key]=h[0][o.Value])}))}))}if(null!=e.Vacationfields&&e.Vacationfields.length>0){var I=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a;e.BaseReportColumns.forEach((function(t){null!=e.Vacationfields.find((function(e){return e==t.CDGDO}))&&(411==t.CDGDO.ColumnCostCenterID&&I.push(t.ID,t.CDGDO.Column),e.ReportDataColumns.push(t.ID))}));for(var R="",S=0;S<e.ReportData.length;S++)R.length>0&&(R+=","),R+=e.ReportData[S].XEmpIDX;if(R.length>0){var A=new Date;if(null!=e.Filter)for(var M=0;M<e.Filter.Fields.length;M++)"DATE"==(void 0).CDGDO.DataType&&50051==(void 0).CDGDO.CategoryValue&&-601==(void 0).CDGDO.FieldValue&&(A=(void 0).FromDatePicker.Date);var g="'"+A.ToString("dd MMM yyyy")+"','"+R+"',2,1,1",w=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.DataSet("RPT116",g);e.ReportData.forEach((function(e){var t=w.Tables[0].filter((function(t){return t.EmployeeID==e.XEmpIDX}));if(t.length>0)for(var o in I)"keys"!=o&&"values"!=o&&(e[o]=t[0][I[o]])}))}}var f=e.BaseReportColumns.find((function(e){return-602==e.CDGDO.FieldValue}));if(null!=f&&e.ReportDataColumns.Contains(f.ID)){var E=0;e.ReportData.forEach((function(e){E=0;var t=e[f.ID].toString().Trim().split(";");if(t.length>0)for(var o=0;o<t.length;o++)""!=t[o].toString().Trim()&&(E+=parseFloat(t[o]));e[f.ID]=E}))}var P=e.BaseReportColumns.find((function(e){return 400==e.CDGDO.CategoryValue&&202==e.CDGDO.FieldValue}));if(null!=P&&e.ReportDataColumns.Contains(P.ID)){var y,O,b,N="N"+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.DecimalsinAmount;e.ReportData.forEach((function(e){if(null!=e[P.ID]&&e[P.ID].toString().length>0){b="",y=e[P.ID].toString().split(",");for(var t=0;t<y.length;t++)3==(O=y[t].split("~")).length&&(b.length>0&&(b+=", "),b+="["+O[0]+", "+new Date(O[1]).ToString(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Date Format"])+", "+parseFloat(O[2]).ToString(N)+"]");e[P.ID]=b}}))}if(e.IsBudgetFound&&e.UpdateBudgetUtilized(),e.IsAuthLevelReport&&e.UpdateLevelFields(o),e.CheckAndAddStockBalances(),e.ReportNoDataGroups=e.IsNoDataGroups?o.Tables[o.Tables.length-1]:null,e.ConstructFormulaFields(!0),e.IsKANBAN?e.CheckAndUpdateKANBAN(e.ReportData):e.CheckAndUpdateRepeatData(e.ReportData,e.ReportDataColumns),null!=e.LevelColumn&&(e.IsTreeDataCalculated=!1,e.RepeatType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.None?(e.ReportTransactionData=e.ReportData,e.ReportTransactionDataColumns=e.ReportDataColumns,e.ReportData=o.Tables[1],e.ReportDataColumns=o.Columns[1]):(e.ReportData=o.Tables[1],e.ReportDataColumns=o.Columns[1],e.ReportTransactionData=o.Tables[0],e.ReportTransactionDataColumns=o.Columns[0]),e.LevelSubGroup.length>0)){e.ReportDataColumns.Contains(e.LevelSubGroup)||e.ReportDataColumns.push(e.LevelSubGroup);for(var V=e.ReportTransactionData.ToTable(!0,["TreeNodeID",e.LevelSubGroup]),v=function(t){if(Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(e.ReportData[t].IsGroup))return L=t,"continue";e.ReportData[t].IsGroup=!0;var o=V.filter((function(o){return o.TreeNodeID==e.ReportData[t].TreeNodeID}));if(o.length>0)for(var s=parseInt(e.ReportData[t].Depth),i=0;i<o.length;i++){var l={};l.TreeNodeID=e.ReportData[t].TreeNodeID,l.IsGroup=!1,l.Depth=s+1,l.ParentID=e.ReportData[t].TreeNodeID,l[e.LevelSubGroup]=o[i][e.LevelSubGroup],l[e.LevelColumn.ID]=o[i][e.LevelSubGroup],e.ReportData.InsertAt(l,t+1),t++}L=t},L=0;L<e.ReportData.length;L++)v(L)}if((e.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.LoadDataOnly||null!=e.Chart)&&0==e.lstGroup.filter((function(e){return"Summary"==e.DisplayMode})).length&&"KPIViewViewModel"!=e.Chart.ClassName)return;if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.ReportData)||(e.TotalRowCount=e.ReportData.length),e.RecordCount=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Displaying")+" "+e.TotalRowCount.toString()+" "+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Rows"),null!=e.ReportColumns&&(e.totals=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.NumArray(e.ReportColumns.length,e.lstGroup.length+1),e.hiddenTotals=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.NumArray(e.HiddenNumericColumns.length,e.lstGroup.length+1)),e.SNo=0,e.colSNoIndex=e.ReportColumns.indexOf(e.ReportColumns.find((function(e){return 0==_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.stringCompare(e.Formula,"SNO",!0)}))),null!=e.MatrixObject&&(e.MatrixObject.MatrixRows.Items.length>0||e.MatrixObject.MatrixColumns.Items.length>0||e.MatrixObject.MatrixValues.Items.length>0))return void e.MatrixObject.LoadMatrixReport(e.ReportData,e.ReportDataColumns);if(e.RenderData(e.ReportData,e.ReportDataColumns),null!=e.LevelColumn){if(e.UpdateTreeTotals(0),e.GrpReportTotal.SubTotalAppearance.IsVisible&&e.lstTotal.length>0){e.totals=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.NumArray(e.lstTotal[0].length,1);for(var B=0;B<e.lstTotal[0].length;B++)e.totals[B][0]=e.lstTotal[0][B];e.AddSubtotals_RT(e.GrpReportTotal,0)}}else e.CheckAndAddTotals(e.ReportData)}else null!=o&&o.Tables.Count>0&&!o.Tables[0].Columns.Contains("ErrorMessage")&&(e.LoadAPIReportData(o.Tables[0],o.Columns[0])||(e.ReportData=o.Tables[0],e.ReportDataColumns=o.Columns[0])),null!=e.ReportColumns&&(e.totals=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.NumArray(e.ReportColumns.length,e.lstGroup.length+1),e.hiddenTotals=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.NumArray(e.HiddenNumericColumns.length,e.lstGroup.length+1)),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.ReportData)&&(e.ReportData=[])}),(function(e){})).then((function(t){e.process_RunWorkerCompleted(null,null)}))}},{key:"ConstructFormulaFields",value:function ConstructFormulaFields(IncludeEvaluation){var _this72=this,ExcludeFormulaKeywords=["LATEST","OLDEST","H","$TOTALHOURS$"];this.eval=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.b,this.eval.ThrowException=!1,this.eval.SetKeyWords("REPORT"),this.fldDict=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a;var fldObj=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c;if(Object(util__WEBPACK_IMPORTED_MODULE_24__.isNullOrUndefined)(this.ReportData)?this.ColumnSourceALL.forEach((function(e){_this72.fldDict.ContainsKey(e.ID)||((fldObj=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c).setFieldDetails(e.ID,3,1,"",0,!1,!1),_this72.fldDict.push(e.ID,fldObj))})):(this.ReportDataColumns.forEach((function(e){_this72.fldDict.ContainsKey(e)||((fldObj=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c).setFieldDetails(e,3,1,"",0,!1,!1),_this72.fldDict.push(e,fldObj))})),null==this.ParentReport?this.ReportColumns.forEach((function(e){_this72.fldDict.ContainsKey(e.ID)||((fldObj=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c).setFieldDetails(e.ID,3,1,"",0,!1,!1),_this72.fldDict.push(e.ID,fldObj))})):this.ColumnSourceALL.forEach((function(e){_this72.fldDict.ContainsKey(e.ID)||((fldObj=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c).setFieldDetails(e.ID,3,1,"",0,!1,!1),_this72.fldDict.push(e.ID,fldObj))}))),this.lstGroup.forEach((function(e){_this72.fldDict.ContainsKey(e.ID)||((fldObj=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c).setFieldDetails(e.ID,3,1,"",0,!1,!1),_this72.fldDict.push(e.ID,fldObj))})),this.PercentColumnExists=!1,this.ReportColumns.forEach((function(e){"REPORT_TOTAL"==e.DataFormat.PercentageOn||"SUB_TOTAL"==e.DataFormat.PercentageOn?_this72.PercentColumnExists=!0:_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.DataFormat.PercentageOn)||0==_this72.ReportColumns.filter((function(t){return t.ID==e.DataFormat.PercentageOn})).length&&0==_this72.HiddenNumericColumns.filter((function(t){return t.ID==e.DataFormat.PercentageOn})).length&&(e.DataFormat.PercentageOn="")})),this.IsAvgRateExists&&null!=this.ReportData){var avgcol=this.BaseReportColumns.find((function(e){return 11511==e.CDGDO.FieldValue})),OpQtycol=this.BaseReportColumns.find((function(e){return 11512==e.CDGDO.FieldValue})),OpValuecol=this.BaseReportColumns.find((function(e){return 11513==e.CDGDO.FieldValue})),OpStockcol=this.BaseReportColumns.find((function(e){return 11512==e.CDGDO.FieldValue||11513==e.CDGDO.FieldValue}));null==avgcol&&null==OpStockcol||function(){var e,t,o="",s="",i=new Array;e=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Maintain Dimensionwise AverageRate"]),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise AverageRate")&&e>5e4&&i.push(parseInt(e)),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.EnableLocationWise)&&_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("Location AverageRate")&&Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Location AverageRate"])&&i.push(50002),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.EnableDivisionWise)&&_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("Division AverageRate")&&Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Division AverageRate"])&&i.push(50001),e=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Maintain Dimensionwise stock"]),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&e>5e4&&i.push(parseInt(e)),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.EnableLocationWise)&&_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("Location Stock")&&Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Location Stock"])&&i.push(50002),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.EnableDivisionWise)&&_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("Division Stock")&&Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Division Stock"])&&i.push(50001),i.forEach((function(e){var t=_StaticReports_StaticReportsViewModel__WEBPACK_IMPORTED_MODULE_33__.b.GetFilterByDimension_3(e,_this72.Filter.CostCenterFilters);t.length>0&&(s+=" AND DCC.dcCCNID"+(e-5e4),t.Contains(",")?s+=" IN ("+t+")":s+="="+t)}));var l,n=[],a=0,r=0,h=[];h.AddRange(_this72.ReportData),h.sort((function(e,t){return e.AvgRateOpStkDate>t.AvgRateOpStkDate?1:-1}));var u=[];for(u.push(""),u.push(0),u.push(s),u.push(!1),u.push(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.UserID),u.push(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LanguageID),a=0;a<h.length;){for(r=a,l=0,n.Clear(),o="";a<h.length&&50!=l;a++)t=h[a].AvgRateOpStkPID+"~"+h[a].AvgRateOpStkDate,n.Contains(t)||(l>0&&(o+=","),o+=t,n.push(t),l++);if(u[0]=o.toString(),null!=avgcol){u[1]=0;for(var c=r;c<a;c++){t=h[c].AvgRateOpStkPID+"~"+h[c].AvgRateOpStkDate;var D=(void 0).Tables[0].filter((function(e){return e.Product==t}));D.length>0&&(h[c][avgcol.ID]=D[0].AvgRate)}}if(null!=OpStockcol){u[1]=1;for(var d=r;d<a;d++){t=h[d].AvgRateOpStkPID+"~"+h[d].AvgRateOpStkDate;var C=(void 0).Tables[0].filter((function(e){return e.Product==t}));C.length>0&&(null!=OpQtycol&&(h[d][OpQtycol.ID]=C[0].BalQty),null!=OpValuecol&&(h[d][OpValuecol.ID]=C[0].BalValue))}}}}()}this.FormulaColumns.Clear(),this.ColumnFilters.Clear();for(var i=0;i<this.ColumnSourceALL.length;i++)_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.ColumnSourceALL[i].Formula)||ExcludeFormulaKeywords.Contains(this.ColumnSourceALL[i].Formula)||this.ColumnSourceALL[i].Formula.startsWith("LEVEL")||this.ColumnSourceALL[i].Formula.startsWith("SNO")||(this.FormulaColumns.push(this.ColumnSourceALL[i]),null==this.ReportData||this.ReportDataColumns.Contains(this.ColumnSourceALL[i].ID)||(this.ReportDataColumns.push(this.ColumnSourceALL[i].ID),this.fldDict.ContainsKey(this.ColumnSourceALL[i].ID)||(fldObj=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c,fldObj.setFieldDetails(this.ColumnSourceALL[i].ID,3,1,"",0,!1,!1),this.fldDict.push(this.ColumnSourceALL[i].ID,fldObj)))),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.ColumnSourceALL[i].ColumnFilterExpression)||(this.FormulaColumns.Contains(this.ColumnSourceALL[i])||this.FormulaColumns.push(this.ColumnSourceALL[i]),null==this.ReportData||this.ReportDataColumns.Contains("COLFILTER"+this.ColumnSourceALL[i].ID)||this.ReportDataColumns.push("COLFILTER"+this.ColumnSourceALL[i].ID)),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.ColumnSourceALL[i].ColumnFilters)||this.ColumnFilters.Contains(this.ColumnSourceALL[i])||this.ColumnFilters.push(this.ColumnSourceALL[i]),-1==this.ColumnSourceALL[i].UseOnce&&"FLOAT"==this.ColumnSourceALL[i].ColumnType&&(null==this.ReportData||this.ReportDataColumns.Contains("DISTINCT"+this.ColumnSourceALL[i].ID)||this.ReportDataColumns.push("DISTINCT"+this.ColumnSourceALL[i].ID)),-1==this.ColumnSourceALL[i].UseOnce&&"FLOAT"==this.ColumnSourceALL[i].ColumnType&&(null==this.ReportData||this.ReportDataColumns.Contains("DISTINCT"+this.ColumnSourceALL[i].ID)||this.ReportDataColumns.push("DISTINCT"+this.ColumnSourceALL[i].ID)),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.ColumnSourceALL[i].DataFormat.PrevRowValue)||null==this.ReportData||this.ReportDataColumns.Contains(this.ColumnSourceALL[i].ID)||this.ReportDataColumns.push(this.ColumnSourceALL[i].ID);if(null!=this.ReportData)for(var _loop44=function(e){_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(_this72.lstGroup[e].Formula)||(_this72.ReportDataColumns.Contains(_this72.lstGroup[e].ID)||_this72.ReportDataColumns.push(_this72.lstGroup[e].ID),0==_this72.FormulaColumns.filter((function(t){return t.ID==_this72.lstGroup[e].ID})).length&&_this72.FormulaColumns.push(_this72.lstGroup[e]))},_i61=0;_i61<this.lstGroup.length;_i61++)_loop44(_i61);if(fldObj=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("FROMDATE",""),this.fldDict.push("FROMDATE",fldObj),fldObj=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("TODATE",""),this.fldDict.push("TODATE",fldObj),fldObj=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("SYSTEMDATE",""),this.fldDict.push("SYSTEMDATE",fldObj),fldObj=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("SYSTEMDATETIME",""),this.fldDict.push("SYSTEMDATETIME",fldObj),fldObj=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("CURRENT_YEARSTART",""),this.fldDict.push("CURRENT_YEARSTART",fldObj),this.fldDict.push("PRV_YEARSTART",new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("PRV_YEARSTART","")),this.fldDict.push("PRV_YEARFROMDATE",new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("PRV_YEARFROMDATE","")),this.fldDict.push("PRV_YEARTODATE",new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("PRV_YEARTODATE","")),this.fldDict.push("CURRENT_MONTHSTART",new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("CURRENT_MONTHSTART","")),this.fldDict.push("PRV_MONTHSTART",new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("PRV_MONTHSTART","")),this.fldDict.push("PRV_MONTHEND",new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("PRV_MONTHEND","")),fldObj=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("LOGIN_USER",""),this.fldDict.push("LOGIN_USER",fldObj),IncludeEvaluation){if(this.FormulasCalculated=!0,this.IsBudgetNewFound&&(this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Monthly||this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Quaterly||this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.HalfYearly||this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Yearly)){var dtTemp,BudgetStartYear=new Date(this.ReportDataDataSet.Tables[1][0].StartDate),lstDef=new Array;this.ReportDataDataSet.Tables[1].forEach((function(e){lstDef.push(parseInt(e.CostCenterID))}));var obj=this.BaseReportColumns.find((function(e){return 11406==e.CDGDO.FieldValue})),objRate=this.BaseReportColumns.find((function(e){return 11408==e.CDGDO.FieldValue})),objExtra=this.BaseReportColumns.filter((function(e){return e.CDGDO.FieldValue>=11485&&e.CDGDO.FieldValue<=11489}));if(objExtra.forEach((function(e){11485==e.CDGDO.FieldValue?e.CDGDO.Column="dcNumField1":11486==e.CDGDO.FieldValue?e.CDGDO.Column="dcNumField2":11487==e.CDGDO.FieldValue?e.CDGDO.Column="dcNumField3":11488==e.CDGDO.FieldValue?e.CDGDO.Column="dcNumField4":11489==e.CDGDO.FieldValue&&(e.CDGDO.Column="dcNumField5")})),null!=obj){obj=this.BaseReportColumns.find((function(e){return 11406==e.CDGDO.FieldValue&&"0"!=e.RepeatType.SelectedValue}));var objBudgetAmount=this.BaseReportColumns.find((function(e){return 11406==e.CDGDO.FieldValue&&"0"==e.RepeatType.SelectedValue}));null!=objBudgetAmount&&null!=obj&&objBudgetAmount.ID==obj.ID&&(objBudgetAmount=null),this.ReportDataDataSet.Tables[2].forEach((function(e){for(var t=_this72.ReportData,o=function(o){t=t.filter(2==lstDef[o]?function(t){return t.BUD_2==e.AccountID}:3==lstDef[o]?function(t){return t.BUD_3==e.ProductID}:function(t){return t["BUD_"+lstDef[o]]==e["CCNID"+(lstDef[o]-5e4)]})},s=0;s<lstDef.length;s++)o(s);if(t.length>0&&(null!=objRate&&t.forEach((function(t){t[objRate.ID]=e.Rate})),objExtra.length>0&&objExtra.forEach((function(o){t[0][o.ID]=e[o.CDGDO.Column]})),null!=objBudgetAmount&&(t[0][objBudgetAmount.ID]=e.AnnualAmount),null!=obj))if(_this72.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Monthly){dtTemp=BudgetStartYear;for(var i=1;i<=12;i++){var l=t.filter((function(e){return e[_this72.RepeatOn]>=dtTemp&&e[_this72.RepeatOn]<dtTemp.AddMonths(1)}));l.length>0&&(l[0][obj.ID]=e["Month"+i+"Amount"]),dtTemp=dtTemp.AddMonths(1)}}else if(_this72.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Quaterly){dtTemp=BudgetStartYear;for(var n=1;n<=4;n++){var a=t.filter((function(e){return e[_this72.RepeatOn]>=dtTemp&&e[_this72.RepeatOn]<dtTemp.AddMonths(3)}));a.length>0&&(a[0][obj.ID]=e["Qtr"+n+"Amount"]),dtTemp=dtTemp.AddMonths(3)}}else if(_this72.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.HalfYearly){dtTemp=BudgetStartYear;for(var r=1;r<=2;r++){var h=t.filter((function(e){return e[_this72.RepeatOn]>=dtTemp&&e[_this72.RepeatOn]<dtTemp.AddMonths(6)}));h.length>0&&(h[0][obj.ID]=e["YearH"+r+"Amount"]),dtTemp=dtTemp.AddMonths(6)}}else _this72.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Yearly&&t.length>0&&(t[0][obj.ID]=e.AnnualAmount)}))}}if(null!=this.ReportNoDataGroups){var grpind=0;this.lstGroup.length>1&&"Summary"==this.lstGroup[1].DisplayMode&&(grpind=1);var strPKID=this.lstGroup[0].ID+"_ID";this.ReportNoDataGroups.forEach((function(e){if(0==_this72.ReportData.filter(_this72.lstGroup[grpind].ID=e[0].toString().Replace("'","''")).length){var t={};t[_this72.lstGroup[grpind].ID]=e[0].toString(),Object(util__WEBPACK_IMPORTED_MODULE_24__.isUndefined)(e[strPKID])||(t[strPKID]=e[strPKID].toString()),1==grpind&&_this72.ReportData.length>0&&(t[_this72.lstGroup[0].ID]=_this72.ReportData[_this72.ReportData.length-1][_this72.lstGroup[0].ID].ToString()),_this72.ReportData.push(t)}}))}if(this.ColumnFilters.length>0)for(var _loop46=function _loop46(p){var c=_this72.ColumnFilters[p];if(_this72.ReportDataColumns.Contains(c.ID))try{var strFilter=c.ColumnFilters,ind=0,endInd;do{if(ind=strFilter.indexOf("@XTODATEX_",ind),ind>=0){endInd=strFilter.indexOf("@",ind+10);var num=parseInt(strFilter.substr(ind+10,endInd-(ind+10)));strFilter=strFilter.Remove(ind,endInd+1-ind),strFilter=strFilter.Insert(ind,_this72.ToDatePicker.Date.AddDays(-num).ToString("dd MMM yyyy"))}}while(-1!=ind);if(strFilter=strFilter.Replace("@TODATE@",_this72.ToDatePicker.Date.ToString("dd MMM yyyy")),strFilter=strFilter.Replace("@FROMDATE@",_this72.FromDatePicker.Date.ToString("dd MMM yyyy")),strFilter.Contains("CURRENT_YEARSTART")&&(strFilter=strFilter.Replace("CURRENT_YEARSTART",_this72.Current_YearStartDate.ToString("dd MMM yyyy"))),strFilter.Contains("PRV_YEARSTART")&&(strFilter=strFilter.Replace("PRV_YEARSTART",_this72.PRV_YEARSTART.ToString("dd MMM yyyy"))),strFilter.Contains("PRV_YEARFROMDATE")&&(strFilter=strFilter.Replace("PRV_YEARFROMDATE",_this72.PRV_YEARFROMDATE.ToString("dd MMM yyyy"))),strFilter.Contains("PRV_YEARTODATE")&&(strFilter=strFilter.Replace("PRV_YEARTODATE",_this72.PRV_YEARTODATE.ToString("dd MMM yyyy"))),strFilter.Contains("CURRENT_MONTHSTART")&&(strFilter=strFilter.Replace("CURRENT_MONTHSTART",_this72.CURRENT_MONTHSTART.ToString("dd MMM yyyy"))),strFilter.Contains("PRV_MONTHSTART")&&(strFilter=strFilter.Replace("PRV_MONTHSTART",_this72.PRV_MONTHSTART.ToString("dd MMM yyyy"))),strFilter.Contains("PRV_MONTHEND")&&(strFilter=strFilter.Replace("PRV_MONTHEND",_this72.PRV_MONTHEND.ToString("dd MMM yyyy"))),strFilter.length>0){var drr=_this72.ReportData.filter(eval("x=>"+strFilter));drr.map((function(e){return e[c.ID]=null}))}}catch(exf){Logger.ErrorLog("Column Filters Error",exf)}},p=0;p<this.ColumnFilters.length;p++)_loop46(p);if(this.FormulaColumns.length>0){for(var iIndex=this.ReportData.length-1;iIndex>=0;iIndex--)for(var q=0;q<this.FormulaColumns.length;q++){var c=this.FormulaColumns[q];if(this.CalculateFormula_2(c,this.ReportData[iIndex])){this.ReportData.RemoveAt(iIndex);break}}if(this.ReportGroups.filter((function(e){return 0==_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.FormulaExpression)})).length>0){var OrderByObj=[],IsDesc=!1;this.ReportGroups.forEach((function(e){IsDesc=!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Sort.SelectedValue)&&("DESC"==e.Sort.SelectedValue||e.Sort.SelectedValue.startsWith("DESC")),e.Sort.SelectedValue.startsWith("NUM")?OrderByObj.push({name:e.ID,parser:parseFloat,desc:IsDesc}):0==_this72.StaticReportType&&"VoucherNo"==e.CDGDO.Column&&0==e.CDGDO.IsForeignKey?(OrderByObj.push({name:e.ID+"Abr",desc:IsDesc}),OrderByObj.push({name:e.ID+"prf",desc:IsDesc}),OrderByObj.push({name:e.ID+"dno",desc:IsDesc})):_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.FormulaExpression)?OrderByObj.push({name:e.ID,desc:IsDesc}):OrderByObj.push({name:_this72.GetSortColumnForFormula(e),desc:IsDesc})})),this.BaseReportColumns.forEach((function(e){if(!e.IsGroup&&!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Sort.SelectedValue))if(IsDesc=!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Sort.SelectedValue)&&("DESC"==e.Sort.SelectedValue||e.Sort.SelectedValue.startsWith("DESC")),e.Sort.SelectedValue.startsWith("NUM"))OrderByObj.push({name:e.ID,parser:parseFloat,desc:IsDesc});else if(0==_this72.StaticReportType&&"VoucherNo"==e.CDGDO.Column&&0==e.CDGDO.IsForeignKey&&""!=e.Sort.SelectedValue)OrderByObj.push({name:e.ID+"Abr",desc:IsDesc}),OrderByObj.push({name:e.ID+"prf",desc:IsDesc}),OrderByObj.push({name:e.ID+"dno",desc:IsDesc});else{var t=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.FormulaExpression)?e.ID:_this72.GetSortColumnForFormula(e);_this72.ReportDataColumns.Contains(t)&&OrderByObj.push({name:t,desc:IsDesc})}})),OrderByObj.length>0&&this.ReportData.SortBy(OrderByObj)}}}}},{key:"Clear",value:function(){this.ClearRows()}},{key:"UpdateBudgetUtilized",value:function(){var e,t=this,o=0,s="",i=this.ReportData.ToTable(!0,["BudgetDefID"]),l=[],n=[],a=[],r=[],h=[],u=[],c=[],D=[],d=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.c,C=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.c;this.BaseReportColumns.filter((function(e){return 11342==e.CDGDO.FieldValue})).forEach((function(e){l.push(e.ID)})),this.BaseReportColumns.filter((function(e){return 11343==e.CDGDO.FieldValue})).forEach((function(e){n.push(e.ID)})),this.BaseReportColumns.filter((function(e){return 11344==e.CDGDO.FieldValue})).forEach((function(e){a.push(e.ID)})),this.BaseReportColumns.filter((function(e){return 11345==e.CDGDO.FieldValue})).forEach((function(e){r.push(e.ID)})),this.BaseReportColumns.filter((function(e){return 11346==e.CDGDO.FieldValue})).forEach((function(e){h.push(e.ID)})),this.BaseReportColumns.filter((function(e){return 11347==e.CDGDO.FieldValue})).forEach((function(e){u.push(e.ID)})),this.BaseReportColumns.filter((function(e){return 11348==e.CDGDO.FieldValue})).forEach((function(e){c.push(e.ID)}));for(var p=function(e,o){(S=t.BaseReportColumns.filter((function(t){return t.CDGDO.FieldValue==e}))).length>0&&d.push(o,S[0].ID)},T=11349,_=1;T<=11360;T++,_++)p(T,_);this.BaseReportColumns.filter((function(e){return 11617==e.CDGDO.FieldValue})).forEach((function(e){D.push(e.ID)}));for(var m=function(e,o){(S=t.BaseReportColumns.filter((function(t){return t.CDGDO.FieldValue==e}))).length>0&&C.push(o,S[0].ID)},I=11618,R=1;I<=11629;I++,R++){var S;m(I,R)}for(var A=0;A<i.length;A++){e=parseInt(i[A].BudgetDefID);var M=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetBudgetUtilized(e,this.IsReportDB);null!=M&&M.Tables.length>1&&M.Columns[1].Contains("BudgetAllocID")&&function(){M.Columns[1].push("Month");for(var i=void 0,p=void 0,T=void 0,_=t.ReportData.filter((function(t){return t.BudgetDefID==e})),m=new Date(M.Tables[0][0].WEF),I=function(e){var I=_[e];if((i=p=M.Tables[1].filter((function(e){return e.BudgetAllocID==I.BudgetAllocID}))).length>0){if(i.forEach((function(e){e.Month=new Date(parseInt(e.YYYY),parseInt(e.MM),1)})),l.length>0&&(o=t.GetBudgetTotal(i),l.forEach((function(e){I[e]=o}))),n.length>0&&(T=m.AddMonths(6),i=p.filter((function(e){return e.Month<T})),o=t.GetBudgetTotal(i),n.forEach((function(e){I[e]=o}))),a.length>0&&(T=m.AddMonths(6),i=p.filter((function(e){return e.Month>=T})),o=t.GetBudgetTotal(i),a.forEach((function(e){I[e]=o}))),r.length>0&&(T=m.AddMonths(3),i=p.filter((function(e){return e.Month<T})),o=t.GetBudgetTotal(i),r.forEach((function(e){I[e]=o}))),h.length>0&&(T=m.AddMonths(3),i=p.filter((function(e){return e.Month>=T&&e.Month<T.AddMonths(3)})),o=t.GetBudgetTotal(i),h.forEach((function(e){I[e]=o}))),u.length>0&&(T=m.AddMonths(6),i=p.filter((function(e){return e.Month>=T&&e.Month<T.AddMonths(3)})),o=t.GetBudgetTotal(i),u.forEach((function(e){I[e]=o}))),c.length>0&&(T=m.AddMonths(9),i=p.filter((function(e){return e.Month>=T.AddMonths(3)})),o=t.GetBudgetTotal(i),c.forEach((function(e){I[e]=o}))),d.length>0){T=m;for(var R=1;R<=12;R++)d.ContainsKey(R)&&(i=p.filter((function(e){return e.Month>=T&&e.Month<T.AddMonths(1)})),I[d[R]]=t.GetBudgetTotal(i)),T=T.AddMonths(1)}if(M.Columns[1].Contains("BudgetTransfer0")){if(l.length>0){i=p;for(var S=0;S<=4;S++)s="BudgetTransfer"+S,M.Columns[1].Contains(s)&&(o=t.GetBudgetTotal(i,s),t.ReportDataColumns.Contains(s)||t.ReportDataColumns.push(s),I[s]=o)}if(d.length>0){T=m;for(var A=1;A<=12;A++){if(d.ContainsKey(A)){i=p.filter((function(e){return e.Month>=T&&e.Month<T.AddMonths(1)}));for(var g=0;g<=4;g++)s="BudgetTransfer"+g,M.Columns[1].Contains(s)&&(o=t.GetBudgetTotal(i,s),s="M"+A+s,t.ReportDataColumns.Contains(s)||t.ReportDataColumns.push(s),I[s]=o)}T=T.AddMonths(1)}}}if(M.Columns[1].Contains("NonAccBalance")){if(D.length>0){i=p,o=t.GetBudgetTotal(i,"NonAccBalance"),D.forEach((function(e){I[e]=o}));for(var w=1;w<=2;w++)s="D"+w+"NonAccBalance",M.Columns[1].Contains(s)&&(o=t.GetBudgetTotal(i,s),t.ReportDataColumns.Contains(s)||t.ReportDataColumns.push(s),I[s]=o)}if(C.length>0){T=m;for(var f=1;f<=12;f++){if(C.ContainsKey(f)){i=p.filter((function(e){return e.Month>=T&&e.Month<T.AddMonths(1)})),I[C[f]]=t.GetBudgetTotal(i,"NonAccBalance");for(var E=1;E<=2;E++)s="D"+E+"NonAccBalance",M.Columns[1].Contains(s)&&(o=t.GetBudgetTotal(i,s),s="M"+f+s,t.ReportDataColumns.Contains(s)||t.ReportDataColumns.push(s),I[s]=o)}T=T.AddMonths(1)}}}}},R=0;R<_.length;R++)I(R)}()}}},{key:"GetBudgetTotal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Balance",o=0;return e.forEach((function(e){o+=parseFloat(e[t])})),o}},{key:"CheckAndAddStockBalances",value:function(){var e=this;if(this.IsOpeningStockExists||this.IsClosingStockExists){for(var t=null,o=null,s="",i="",l=0;l<this.Filter.CostCenterFilters.length;l++){var n=this.Filter.CostCenterFilters[l];if(n.SelectedNodes.length>0||!n.DeleteButtonVisibility)if(3==n.CostCenterID)for(var a=0;a<n.SelectedNodes.length;a++)a>0&&(s+=","),s+=n.SelectedNodes[a].Id;else if(50002==n.CostCenterID)if(i+=" AND ",1==n.SelectedNodes.length)i+="DCC.DCCCNID2="+n.SelectedNodes[0].Id;else{i+="DCC.DCCCNID2 IN (";for(var r=0;r<n.SelectedNodes.length;r++)r>0&&(i+=","),i+=n.SelectedNodes[r].Id;0==n.SelectedNodes.length&&(i+="-123"),i+=")"}}var h=[];h.push(1),h.push(s.toString()),h.push(i.toString()),h.push(this.FromDatePicker.Date),h.push(this.ToDatePicker.Date),h.push(0),this.IsOpeningStockExists&&(t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetStockOpeingClosing(h,this.IsReportDB)),this.IsClosingStockExists&&(h[0]=0,o=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetStockOpeingClosing(h,this.IsReportDB)),this.BaseReportColumns.forEach((function(s){11371==s.CDGDO.FieldValue?e.ReportDataColumns.Contains(s.ID)&&e.ReportData.forEach((function(e){e[s.ID]=t[0].Qty})):11372==s.CDGDO.FieldValue?e.ReportDataColumns.Contains(s.ID)&&e.ReportData.forEach((function(e){e[s.ID]=t[0].Value})):11373==s.CDGDO.FieldValue?e.ReportDataColumns.Contains(s.ID)&&e.ReportData.forEach((function(e){e[s.ID]=o[0].Qty})):11374==s.CDGDO.FieldValue&&e.ReportDataColumns.Contains(s.ID)&&e.ReportData.forEach((function(e){e[s.ID]=o[0].Value}))}))}}},{key:"GetDimensionFilter_Str",value:function(e){for(var t="",o=0;o<this.oReportDialog.CostCenterFilters.length;o++){var s=this.oReportDialog.CostCenterFilters[o];if((s.SelectedNodes.length>0||!s.DeleteButtonVisibility)&&s.CostCenterID>5e4)if(s.SelectedNodes.length>0)if(t+=" AND ",1==s.SelectedNodes.length)t+=e+(s.CostCenterID-5e4)+"="+s.SelectedNodes[0].Id;else{t+=e+(s.CostCenterID-5e4)+" IN (";for(var i=0;i<s.SelectedNodes.length;i++)i>0&&(t+=","),t+=s.SelectedNodes[i].Id;t+=")"}else t+=" AND ",t+=e+(s.CostCenterID-5e4)+"=-12912"}return t}},{key:"GetCostCenterFilter",value:function(e,t){var o="",s=this.oReportDialog.CostCenterFilters.find((function(t){return t.CostCenterID==e}));if(!s)return"";if(s.SelectedNodes.length>0||!s.DeleteButtonVisibility)if(s.SelectedNodes.length>0)if(o+=" AND ",1==s.SelectedNodes.length)o+=t+"="+s.SelectedNodes[0].Id;else{o+=t+" IN (";for(var i=0;i<s.SelectedNodes.length;i++)i>0&&(o+=","),o+=s.SelectedNodes[i].Id;o+=")"}else o+=" AND ",o+=t+"=-12912";return o.toString()}},{key:"GetSortColumnForFormula",value:function(e){var t=!1,o="",s=[];this.evalFormula||(this.evalFormula=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.a,this.evalFormula.SetKeyWords("REPORT")),this.evalFormula.ParseFormula(e.FormulaExpression,s);for(var i=0;i<s.length;i++){var l=s[i];if(t){if(l.getTokenType()==_services_formula_service__WEBPACK_IMPORTED_MODULE_2__.e.REFERENCE&&this.ReportDataColumns.Contains(l.getTokenValue().toString())){o=l.getTokenValue().toString();break}}else l.getTokenType()==_services_formula_service__WEBPACK_IMPORTED_MODULE_2__.e.KEYWORD&&"DATENAME"==l.getTokenName()&&(t=!0)}return""!=o?o:e.ID}},{key:"UpdateLevelFields",value:function(e){for(var t,o=this,s=0,i=0,l=[],n=[],a=0;a<this.ColumnSourceALL.length;a++)if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.ColumnSourceALL[a].Formula)&&this.ColumnSourceALL[a].Formula.startsWith("LEVEL")){var r=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(this.ColumnSourceALL[a].Formula.substr(5));_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNum(this.ColumnSourceALL[a].Formula.substr(5))&&(n.push(r),l.push(this.ColumnSourceALL[a].ID),this.ReportDataColumns.push(this.ColumnSourceALL[a].ID))}for(var h=function(a){if((t=e.Tables[1].filter((function(e){return e.WorkFlowID==o.ReportData[a].WorkFlowID}))).length>0){s=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(o.ReportData[a].WorkFlowLevel),i=parseInt(t[0].Levels);for(var r=0;r<l.length;r++)n[r]<=s?o.ReportData[a][l[r]]="YES":n[r]<=i&&(o.ReportData[a][l[r]]="NO")}},u=this.ReportData.length-1;u>=0;u--)h(u)}},{key:"CheckAndUpdateRepeatData",value:function(e,t){var o=this;if(this.RepeatType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.None){var s,i,l,n=null;this.dtRepeatColumns=[];var a=e.Copy();this.dtTempColumnsRepeat=t.Copy();var r=_toConsumableArray(a),h=new Array;this.lstRepeatSummaryAplha.Clear();var u=this.BaseReportColumns.find((function(e){return e.ID==o.RepeatOn}));if(this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Daily||this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Dimension||(this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Monthly?(this.dtTempColumnsRepeat.push("RPTYR"),this.dtTempColumnsRepeat.push("RPTMN"),a.forEach((function(e){if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e[o.RepeatOn]))e.RPTYR=0,e.RPTMN=0;else{var t=new Date(e[o.RepeatOn]);e.RPTYR=t.getFullYear(),e.RPTMN=t.getMonth()}}))):this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Hourly12||this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Hourly24?(this.dtTempColumnsRepeat.push("RPTHr"),a.forEach((function(e){if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e[o.RepeatOn]))e.RPTHr=0;else{var t=new Date(e[o.RepeatOn]);e.RPTHr=t.getHours()}}))):this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Yearly&&(this.dtTempColumnsRepeat.push("RPTYR"),a.forEach((function(e){var t=new Date(e[o.RepeatOn]);e.RPTYR=t.getFullYear()})))),(this.RepeatShowPrevMn||this.PrevDateColumsUsed)&&(r=a.filter((function(e){return e[o.RepeatOn].ToServerDate()>=o.FromDatePicker.Date&&e[o.RepeatOn].ToServerDate()<=o.ToDatePicker.Date}))),this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Dimension){var c=this.RepeatOn;null!=u&&u.Sort.SelectedValue.startsWith("TREE")&&(c=this.RepeatOn+"SORT"),r.sort((function(e,t){return e[c]>t[c]?1:-1}));var D=0,d=null;if(0!=this.RepeatEmptyColumns&&null!=u&&(u.CDGDO.IsForeignKey?D=u.CDGDO.ColumnCostCenterID:(D=u.CDGDO.CategoryValue,u.CDGDO.ParentCostCenterSysName=u.CDGDO.Table,this.FieldsDialog.drrCT=this.FieldsDialog.CostCenterTables.filter((function(e){return e.FeatureID==u.CDGDO.CategoryValue})),u.CDGDO.ParentCostCenterColSysName=this.FieldsDialog.drrCT[0].PK.toString()),D>5e4)){var C="SELECT";u.Sort.SelectedValue.startsWith("TREE")||(C+=" DISTINCT"),C+=" LT."+u.CDGDO.Column+" AS "+u.ID+" FROM "+u.CDGDO.ParentCostCenterSysName+" LT WITH(NOLOCK)",C+=" WHERE 1=1",2==this.RepeatEmptyColumns&&(C+=" AND LT.IsGroup=0");var p=this.Filter.CostCenterFilters.find((function(e){return e.CostCenterID==D}));if(p&&(p.SelectedNodes.length>0||!p.DeleteButtonVisibility)){C+=" AND "+u.CDGDO.ParentCostCenterColSysName+" IN (";for(var T=0;T<p.SelectedNodes.length;T++)T>0&&(C+=","),C+=p.SelectedNodes[T].Id;0==p.SelectedNodes.length&&(C+=-12912),C+=")"}C+=" ORDER BY ",u.Sort.SelectedValue.startsWith("TREE")?C+="LT.lft ASC":u.Sort.SelectedValue.Contains("DESC")?C+=u.ID+" DESC":C+=u.ID;try{if(d=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataTable("RPT022",this.IsReportDB,C),u.Sort.SelectedValue.startsWith("TREE"))for(s=d.length-1;s>0;s--){var _=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(d[s][u.ID]);for(i=s-1;i>=0;i--)if(0==_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.stringCompare(_,_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(d[i][u.ID]),!0)){d.RemoveAt(s);break}}}catch(ue){Logger.ErrorLog("REPEAT EMPTY COL QRY: "+C)}}null==d?(this.dtRepeatColumns.push(this.RepeatOn),n=r.ToTable(!0,[this.RepeatOn])):(this.dtRepeatColumns.push(u.ID),n=d)}else if(this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Daily)r=r.sort((function(e,t){return e[o.RepeatOn]>t[o.RepeatOn]?1:-1})),n=r.ToTable(!0,[this.RepeatOn]),this.dtRepeatColumns.push(this.RepeatOn),0!=this.RepeatEmptyColumns&&function(){for(var e=!1,t=o.FromDatePicker.Date;t<=o.ToDatePicker.Date;){if(0==n.filter((function(e){return e[o.RepeatOn]==t})).length){var s={};s[o.RepeatOn]=t,n.push(s),e=!0}t=t.AddDays(1)}e&&(n=n.sort((function(e,t){return e[o.RepeatOn]>t[o.RepeatOn]?1:-1})))}();else if(this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Monthly)r=r.sort((function(e,t){return e.RPTYR>t.RPTYR||e.RPTYR==t.RPTYR&&e.RPTMN>t.RPTMN?1:-1})),n=r.ToTable(!0,["RPTYR","RPTMN"]),this.dtRepeatColumns.push("RPTYR"),this.dtRepeatColumns.push("RPTMN"),0!=this.RepeatEmptyColumns&&(this.RepeatShowPrevMn?function(){var e,t=1;o.dtRepeatColumns.push("Sno"),o.dtRepeatColumns.push("PrevMonth"),o.dtRepeatColumns.push("ColID");for(var s=new Date(o.FromDatePicker.Date.getFullYear(),o.FromDatePicker.Date.getMonth(),1);s<=o.ToDatePicker.Date;){var i=n.filter((function(e){return e.RPTYR==s.getFullYear()&&e.RPTMN==s.getMonth()}));0==i.length?((e={}).RPTYR=s.getFullYear(),e.RPTMN=s.getMonth(),e.Sno=t,e.PrevMonth=0,n.push(e)):(i[0].Sno=t,i[0].PrevMonth=0),o.AddPrevMnInfo(n,t,s),s=s.AddMonths(1),t++}n=null!=u.Sort.SelectedValue&&u.Sort.SelectedValue.Contains("ASC")?n.sort((function(e,t){return e.Sno>t.Sno||e.Sno==t.Sno&&e.PrevMonth>t.PrevMonth?1:-1})):n.sort((function(e,t){return e.Sno>t.Sno||e.Sno==t.Sno&&e.PrevMonth<t.PrevMonth?1:-1}))}():function(){for(var e=!1,t=new Date(o.FromDatePicker.Date.getFullYear(),o.FromDatePicker.Date.getMonth(),1);t<=o.ToDatePicker.Date;){if(0==n.filter((function(e){return e.RPTYR==t.getFullYear()&&e.RPTMN==t.getMonth()})).length){var s={};s.RPTYR=t.getFullYear(),s.RPTMN=t.getMonth(),n.push(s),e=!0}t=t.AddMonths(1)}e&&(n=n.sort((function(e,t){return e.RPTYR>t.RPTYR||e.RPTYR==t.RPTYR&&e.RPTMN>t.RPTMN?1:-1})))}());else if(this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Quaterly){n=[],this.dtRepeatColumns.push("ID"),this.dtRepeatColumns.push("Name"),this.dtRepeatColumns.push("No"),this.dtRepeatColumns.push("StDate"),this.dtRepeatColumns.push("EndDate");var m,I=new Date(this.FromDatePicker.Date.getFullYear(),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.AccountingFromMonth-1,1);I>this.FromDatePicker.Date&&(I=I.AddYears(-1));for(var R=1,S=I.getFullYear();I.AddMonths(3)<=this.FromDatePicker.Date;)R++,S=I.getFullYear(),I=I.AddMonths(3);for(h.push(I),m=1==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.AccountingFromMonth?I.getFullYear().toString():I.iMonth()>=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.AccountingFromMonth?I.getFullYear().toString()+"-"+((I.getFullYear()+1)%100).toString():(I.getFullYear()-1).toString()+"-"+(I.getFullYear()%100).toString(),n.push({}),n[n.length-1].ID="Q"+R+S,n[n.length-1].No=R,n[n.length-1].Name="Q"+R+" "+m,n[n.length-1].StDate=I.ToString("dd MMM yyyy"),n[n.length-1].EndDate=I.AddMonths(3).AddDays(-1).ToString("dd MMM yyyy");I.AddMonths(3)<=this.ToDatePicker.Date;)5==++R&&(R=1),I=I.AddMonths(3),h.push(I),m=1==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.AccountingFromMonth?I.getFullYear().toString():I.iMonth()>=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.AccountingFromMonth?I.getFullYear().toString()+"-"+((I.getFullYear()+1)%100).toString():(I.getFullYear()-1).toString()+"-"+(I.getFullYear()%100).toString(),n.push({}),n[n.length-1].ID="Q"+R+I.getFullYear(),n[n.length-1].No=R,n[n.length-1].Name="Q"+R+" "+m,n[n.length-1].StDate=I.ToString("dd MMM yyyy"),n[n.length-1].EndDate=I.AddMonths(3).AddDays(-1).ToString("dd MMM yyyy")}else if(this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.HalfYearly){n=[],this.dtRepeatColumns.push("ID"),this.dtRepeatColumns.push("Name"),this.dtRepeatColumns.push("No"),this.dtRepeatColumns.push("StDate"),this.dtRepeatColumns.push("EndDate");var A,M=new Date(this.FromDatePicker.Date.getFullYear(),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.AccountingFromMonth-1,1);M>this.FromDatePicker.Date&&(M=M.AddYears(-1));for(var g=1,w=M.getFullYear();M.AddMonths(6)<=this.FromDatePicker.Date;)g++,w=M.getFullYear(),M=M.AddMonths(6);for(h.push(M),A=1==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.AccountingFromMonth?M.getFullYear().toString():M.iMonth()>=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.AccountingFromMonth?M.getFullYear().toString()+"-"+((M.getFullYear()+1)%100).toString():(M.getFullYear()-1).toString()+"-"+(M.getFullYear()%100).toString(),n.push({}),n[n.length-1].ID="H"+g+w,n[n.length-1].No=g,n[n.length-1].Name="H"+g+" "+A,n[n.length-1].StDate=M.ToString("dd MMM yyyy"),n[n.length-1].EndDate=M.AddMonths(6).AddDays(-1).ToString("dd MMM yyyy");M.AddMonths(6)<=this.ToDatePicker.Date;)3==++g&&(g=1),M=M.AddMonths(6),h.push(M),A=1==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.AccountingFromMonth?M.getFullYear().toString():M.iMonth()>=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.AccountingFromMonth?M.getFullYear().toString()+"-"+((M.getFullYear()+1)%100).toString():(M.getFullYear()-1).toString()+"-"+(M.getFullYear()%100).toString(),n.push({}),n[n.length-1].ID="H"+g+M.getFullYear(),n[n.length-1].No=g,n[n.length-1].Name="H"+g+" "+A,n[n.length-1].StDate=M.ToString("dd MMM yyyy"),n[n.length-1].EndDate=M.AddMonths(6).AddDays(-1).ToString("dd MMM yyyy")}else if(this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Weekly){n=[],this.dtRepeatColumns.push("ID"),this.dtRepeatColumns.push("Name"),this.dtRepeatColumns.push("No"),this.dtRepeatColumns.push("StDate"),this.dtRepeatColumns.push("EndDate");var f,E,P=new Array,y=this.FromDatePicker.Date,O=this.ToDatePicker.Date;f=new Date(y.getFullYear(),y.getMonth(),1);do{var b=f.DaysInMonth();for(E=new Date(f.getFullYear(),f.getMonth(),b);f<=E;)P.push(new Array(2));for(s=0;s<P.length;s++)P[s][1]>=y&&P[s][0]<=O&&(n.push({}),h.push(P[s][0]),n[n.length-1].ID="W"+(s+1)+E.ToString("MMMyy"),n[n.length-1].No=s+1,n[n.length-1].Name="W"+(s+1)+" "+E.ToString("MMM"),n[n.length-1].StDate=P[s][0].ToString("dd MMM yyyy"),n[n.length-1].EndDate=P[s][1].ToString("dd MMM yyyy"));f=E.AddDays(1),P.Clear()}while(f<=O)}else this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Yearly?(r=r.sort((function(e,t){return e.RPTYR>t.RPTYR?1:-1})),n=r.ToTable(!0,["RPTYR"]),this.dtRepeatColumns.push("RPTYR"),0!=this.RepeatEmptyColumns&&(this.RepeatShowPrevMn?function(){var e,t=1;o.dtRepeatColumns.push("Sno"),o.dtRepeatColumns.push("PrevMonth"),o.dtRepeatColumns.push("ColID");for(var s=0,i=new Date(o.FromDatePicker.Date.getFullYear(),o.FromDatePicker.Date.getMonth(),1);i<=o.ToDatePicker.Date;)if(s!=i.getFullYear()){var l=n.filter((function(e){return e.RPTYR==i.getFullYear()}));0==l.length?((e={}).RPTYR=i.getFullYear(),e.Sno=t,e.PrevMonth=0,n.push(e)):(l[0].Sno=t,l[0].PrevMonth=0),o.AddPrevMnInfo(n,t,i),s=i.getFullYear(),i=i.AddMonths(1),t++}else i=i.AddMonths(1);n=null!=u.Sort.SelectedValue&&u.Sort.SelectedValue.Contains("ASC")?n.sort((function(e,t){return e.RPTYR>t.RPTYR?1:-1})):n.sort((function(e,t){return e.Sno>t.Sno||e.Sno==t.Sno&&e.PrevMonth<t.PrevMonth?1:-1}))}():function(){for(var e=!1,t=new Date(o.FromDatePicker.Date.getFullYear(),o.FromDatePicker.Date.getMonth(),1);t<=o.ToDatePicker.Date;){if(0==n.filter((function(e){return e.RPTYR==t.getFullYear()})).length){var s={};s.RPTYR=t.getFullYear(),n.push(s),e=!0}t=t.AddMonths(1)}e&&(n=n.sort((function(e,t){return e.RPTYR>t.RPTYR?1:-1})))}())):(this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Hourly12||this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Hourly24)&&(r=r.sort((function(e,t){return e.RPTHr>t.RPTHr?1:-1})),n=r.ToTable(!0,["RPTHr"]),this.dtRepeatColumns.push("RPTHr"),0!=this.RepeatEmptyColumns&&n.length>0)&&function(){var e=!1,t=0,o=0,s=n.Compute("min","RPTHr");if(null!=s){for(t=parseInt(s),o=0,s=n.Compute("max","RPTHr"),o=parseInt(s);t<o;){if(0==n.filter((function(e){return e.RPTHr==t})).length){var i={};i.RPTHr=t,n.push(i),e=!0}t++}e&&(n=n.sort((function(e,t){return e.RPTHr>t.RPTHr?1:-1})))}}();if(n.length>0&&0==_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(n[0][this.dtRepeatColumns[0]]).length&&n.RemoveAt(0),0!=n.length){var N=[],V=[],v=new Array,L=new Array;for(null==this.dicRepeatColsMap?this.dicRepeatColsMap=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a:this.dicRepeatColsMap.Clear(),this.GrpReportTotal.TotalCols.Clear(),this.lstGroup.forEach((function(e){e.TotalCols.Clear()})),s=0;s<this.RepeatStartIndex;s++)N.push(this.ColumnSource[s]),"FLOAT"!=this.ColumnSource[s].ColumnType&&"INT"!=this.ColumnSource[s].ColumnType?V.push(this.ColumnSource[s].ID):L.push(this.ColumnSource[s]),this.GrpReportTotal.TempTotalCols.ContainsKey(this.ColumnSource[s].ID)&&this.GrpReportTotal.TotalCols.push(this.ColumnSource[s].ID,s),this.lstGroup.forEach((function(e){e.TempTotalCols.ContainsKey(o.ColumnSource[s].ID)&&e.TotalCols.push(o.ColumnSource[s].ID,s)}));for(s=this.RepeatStartIndex+1,i=1;i<=this.RepeatNextCols;s++,i++)if(this.ColumnSource.length<=s){this.RepeatNextCols=i-1;break}l=n.length-1,this.RepeatSets=n.length-1;var B=!1,F=new Array;for(null!=u&&("ASC"==u.Sort.SelectedValue||"NUM ASC"==u.Sort.SelectedValue||"TREE ASC"==u.Sort.SelectedValue||this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Dimension&&""==u.Sort.SelectedValue)&&(B=!0,l=0),s=this.RepeatStartIndex,i=0;i<=this.RepeatNextCols;s++,i++)this.dicRepeatColsMap.push(this.ColumnSource[s].ID,[]);if(this.RepeatShowPrevMn&&this.RepeatPrevDataSeperately)for(var G="",x=null,W=0;W<=this.RepeatPrevData;W++)for(W>0&&(G=(x=n.filter((function(e){return e.Sno=0==e.PrevMonth})))[0].ColID.toString().substr(x[0].ColID.toString().indexOf("_")+1)),s=this.RepeatStartIndex,i=0;i<=this.RepeatNextCols;s++,i++)0==W?this.AddRepeatCol(s,l,n,a,r,N,v,L):(x[0].ColID="R"+s+"_"+G,this.AddRepeatCol(s,B?l+W:l-W,n,a,r,N,v,L));else for(;;){if(B){if(l>n.length-1)break}else if(l<0)break;for(s=this.RepeatStartIndex,i=0;i<=this.RepeatNextCols;s++,i++)if(this.AddRepeatCol(s,l,n,a,r,N,v,L),this.RepeatShowPrevMn){for(var k=0,U=1;U<=this.RepeatPrevData;U++)k=B?l+U:l-U,this.AddRepeatCol(s,k,n,a,r,N,v,L);if(this.RepeatPrevDiff||this.RepeatPrevPercent){var K=void 0;k=B?l+this.RepeatPrevData+1:l-(this.RepeatPrevData+1),K=this.AddRepeatCol(s,k,n,a,r,N,v,L),this.RepeatPrevDiff||(K.HeaderAppearance.IsVisible=!1),F.push(K)}this.RepeatPrevPercent&&(k=B?l+this.RepeatPrevData+2:l-(this.RepeatPrevData+2),this.AddRepeatCol(s,k,n,a,r,N,v,L))}B?l+=this.RepeatPrevNextCols:l-=this.RepeatPrevNextCols}var H=N.length-1;for(s=this.RepeatStartIndex+this.RepeatNextCols+1;s<this.ColumnSource.length;s++)N.push(this.ColumnSource[s]),this.ColumnSource[s].ID.startsWith("MT")&&this.ColumnSource[s].ID.endsWith("MT")||("FLOAT"!=this.ColumnSource[s].ColumnType&&"INT"!=this.ColumnSource[s].ColumnType?V.push(this.ColumnSource[s].ID):L.push(this.ColumnSource[s]),this.GrpReportTotal.TempTotalCols.ContainsKey(this.ColumnSource[s].ID)&&this.GrpReportTotal.TotalCols.push(this.ColumnSource[s].ID,N.length-1),this.lstGroup.forEach((function(e){e.TempTotalCols.ContainsKey(o.ColumnSource[s].ID)&&e.TotalCols.push(o.ColumnSource[s].ID,N.length-1)})));this.lstGroup.forEach((function(e){V.Contains(e.ID)||V.push(e.ID)})),this.ReportColumns=N,this.RefreshPostFilters();var Q,j=0,Y=!1,X=0,q=0,z=new Array,J=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.c,Z=[];for(i=V.length-1;i>=0;i--)Z.push(V[i]);if((r=_toConsumableArray(a)).SortBy(Z),r.length>0)for(i=0;i<L.length;i++)-1==L[i].UseOnce&&(Q=L[i].ID,Object(util__WEBPACK_IMPORTED_MODULE_24__.isNullOrUndefined)(r[0][Q])||(q=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(r[0][Q]),this.lstSummaryDistinctNumeric["DISTINCT"+Q].push(q),this.SetCellValue(q,L[i].DataFormat,"FLOAT",J),r[0]["DISTINCT"+Q]=J.Text));for(s=1;s<r.length;s++){for(Y=!1,i=0;i<V.length;i++)if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(r[s][V[i]])!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(r[s-1][V[i]])){Y=!0;break}if(Y)for(j=s,i=0;i<L.length;i++)-1==L[i].UseOnce&&(Q=L[i].ID,this.lstSummaryDistinctNumeric["DISTINCT"+Q].Clear(),Object(util__WEBPACK_IMPORTED_MODULE_24__.isNullOrUndefined)(r[s][Q])||(q=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(r[s][Q]),this.lstSummaryDistinctNumeric["DISTINCT"+Q].push(q),this.SetCellValue(q,L[i].DataFormat,"FLOAT",J),r[s]["DISTINCT"+Q]=J.Text));else{for(i=0;i<L.length;i++)if(Q=L[i].ID,0==L[i].UseOnce)Object(util__WEBPACK_IMPORTED_MODULE_24__.isNullOrUndefined)(r[s][Q])||(q=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(r[s][Q]),X=0,Object(util__WEBPACK_IMPORTED_MODULE_24__.isNullOrUndefined)(r[j][Q])||(X=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(r[j][Q])),r[j][Q]=X+q);else if(-1==L[i].UseOnce){if(!Object(util__WEBPACK_IMPORTED_MODULE_24__.isNullOrUndefined)(r[s][Q])&&(q=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(r[s][Q]),Q="DISTINCT"+Q,!this.lstSummaryDistinctNumeric[Q].Contains(q))){this.lstSummaryDistinctNumeric[Q].push(q);var $="";Object(util__WEBPACK_IMPORTED_MODULE_24__.isNullOrUndefined)(r[j][Q])||($=r[j][Q].toString()+","),this.SetCellValue(q,L[i].DataFormat,"FLOAT",J),r[j][Q]=$+J.Text}}else Object(util__WEBPACK_IMPORTED_MODULE_24__.isNullOrUndefined)(r[j][Q])&&!Object(util__WEBPACK_IMPORTED_MODULE_24__.isNullOrUndefined)(r[s][Q])&&(r[j][Q]=r[s][Q]);for(i=0;i<v.length;i++)Q=v[i].ID,Object(util__WEBPACK_IMPORTED_MODULE_24__.isNullOrUndefined)(r[j][Q])&&!Object(util__WEBPACK_IMPORTED_MODULE_24__.isNullOrUndefined)(r[s][Q])&&(r[j][Q]=r[s][Q]);z.push(r[s])}}z.forEach((function(e){a.Remove(e)}));var ee=this.FormulaColumns.filter((function(e){return 2==e.EvaluateAtEnd}));if(ee.length>0){var te=new Array;for(s=0;s<ee.length;s++)if(this.dicRepeatColsMap.ContainsKey(ee[s].ID))for(i=0;i<this.dicRepeatColsMap[ee[s].ID].length;i++){var oe=N.find((function(e){return e.ID==o.dicRepeatColsMap[ee[s].ID][i]}));this.dicRepeatColsMap.keys.forEach((function(e){oe.Formula.Contains(e)&&(oe.Formula=oe.Formula.Replace(e,o.dicRepeatColsMap[e][i]),o.fldDict.ContainsKey(o.dicRepeatColsMap[e][i])||o.fldDict.push(o.dicRepeatColsMap[e][i],new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c(o.dicRepeatColsMap[e][i],0)))})),te.push(oe)}else te.push(ee[s]);for(var se=a.length-1;se>=0;se--)for(var ie=0;ie<te.length;ie++)if(this.CalculateFormulaForSummary(te[ie],a[se])){a.RemoveAt(se);break}}if(F.length>0)for(var le=function(e){F.forEach((function(t){null==a[e][t.Formula]&&null==a[e][t.ColumnFilterExpression]||(q=X=0,null!=a[e][t.Formula]&&(q=parseFloat(a[e][t.Formula])),null!=a[e][t.ColumnFilterExpression]&&(X=parseFloat(a[e][t.ColumnFilterExpression])),q-=X,a[e][t.ID]=q,o.RepeatPrevPercent&&(a[e][t.Formula+"_30"]=q))}))},ne=a.length-1;ne>=0;ne--)le(ne);if(L.find((function(e){return-2==e.DataFormat.CumTotal}))){var ae=new Array(this.RepeatNextCols+1);for(s=0;s<r.length;s++)for(var re=this.RepeatStartIndex,he=0;re<=this.RepeatStartIndex+this.RepeatNextCols;re++,he++)if(-2==N[re].DataFormat.CumTotal)for(ae[he]=0,i=re;i<=H;i=i+this.RepeatNextCols+1)X=0,Object(util__WEBPACK_IMPORTED_MODULE_24__.isNullOrUndefined)(r[s][N[i].ID])||(X=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(r[s][N[i].ID])),ae[he]+=X,r[s][N[i].ID]=ae[he]}this.ReportData=a,this.ReportDataColumns=this.dtTempColumnsRepeat}}}},{key:"AddPrevMnInfo",value:function(e,t,o){for(var s,i=1;i<=this.RepeatPrevData;i++)s={},this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Yearly?s.RPTYR=o.AddYears(-i).getFullYear():this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Monthly&&(this.RepeatPrevDataOfCurrYr?(s.RPTYR=o.AddMonths(-i).getFullYear(),s.RPTMN=o.AddMonths(-i).getMonth()):(s.RPTYR=o.AddYears(-i).getFullYear(),s.RPTMN=o.AddYears(-i).getMonth())),s.Sno=t,s.PrevMonth=i,e.push(s);(this.RepeatPrevDiff||this.RepeatPrevPercent)&&(s={},this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Yearly?s.RPTYR=o.AddYears(-1).getFullYear():this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Monthly&&(s.RPTYR=o.AddYears(-1).getFullYear(),s.RPTMN=o.AddYears(-1).getMonth()),s.Sno=t,s.PrevMonth=20,e.push(s),this.RepeatPrevPercent&&(s={},this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Yearly?s.RPTYR=o.AddYears(-1).getFullYear():this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Monthly&&(this.RepeatPrevDataOfCurrYr?(s.RPTYR=o.AddMonths(-1).getFullYear(),s.RPTMN=o.AddMonths(-1).getMonth()):(s.RPTYR=o.AddYears(-1).getFullYear(),s.RPTMN=o.AddYears(-1).getMonth())),s.Sno=t,s.PrevMonth=30,e.push(s)))}},{key:"AddRepeatCol",value:function(e,t,o,s,i,l,n,a){var r,h,u=this,c=this.dtRepeatColumns[0],D=this.dtRepeatColumns[1],d=this.RepeatShowPrevMn?parseInt(o[t].PrevMonth):0;d<20&&(this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Daily?h=s.filter((function(e){return e[u.RepeatOn]=new Date(o[t][c])})):this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Monthly?h=s.filter((function(e){return e.RPTYR==o[t][c]&&e.RPTMN==o[t][D]})):this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Weekly||this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Quaterly||this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.HalfYearly?h=s.filter((function(e){return e[u.RepeatOn]>=o[t].StDate&&e[u.RepeatOn]<=o[t].EndDate})):this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Yearly?h=s.filter((function(e){return e.RPTYR==o[t][c]})):this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Dimension?h=s.filter((function(e){return e[u.RepeatOn]==o[t][c]})):this.RepeatType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Hourly12&&this.RepeatType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Hourly24||(h=s.filter((function(e){return e.RPTHr==o[t][c]}))));var C=this.ColumnSource[e].Clone();if(l.push(C),this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Daily)r=new Date(o[t][c]),C.ID="R"+e+"_"+r.ToString("ddMMMyy"),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(C.HeaderText)||(C.HeaderText+="\r\n"),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(C.DataFormat.DateType)?C.HeaderText+=r.ToString(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Date Format"]):C.HeaderText+=r.ToString(C.DataFormat.DateType);else if(this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Monthly)if(0!=parseInt(o[t][c])){var p="MMM-yy",T=this.BaseReportColumns.find((function(e){return e.ID==u.RepeatOn}));T&&""!=T.DateType.Text&&T.DateType.Text.length>0&&!T.DateType.Text.Contains("dd")&&!T.DateType.Text.Contains("hh")&&(p=T.DateType.Text),r=new Date(parseInt(o[t][c]),parseInt(o[t][D]),1),C.ID="R"+e+"_"+r.ToString("ddMMMyy"),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(C.HeaderText)||(C.HeaderText+="\r\n"),C.HeaderText+=r.ToString(p)}else C.ID="R"+e+"_NULL",_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(C.HeaderText)||(C.HeaderText+="\r\n"),C.HeaderText+="";else if(this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Weekly||this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Quaterly||this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.HalfYearly)C.ID="R"+e+"_"+o[t].ID.toString(),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(C.HeaderText)||(C.HeaderText+="\r\n"),C.HeaderText+=o[t].Name.toString();else if(this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Yearly)r=new Date(parseInt(o[t][c]),0,1),C.ID="R"+e+"_"+r.ToString("ddMMMyy"),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(C.HeaderText)||(C.HeaderText+="\r\n"),C.HeaderText+=r.ToString("yyyy");else if(this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Hourly12||this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Hourly24){var _=parseInt(o[t][c]);C.ID="R"+e+"_"+o[t][c].toString(),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(C.HeaderText)||(C.HeaderText+="\r\n"),C.HeaderText+=this.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.Hourly12?_<11?_+"AM - "+(_+1)+"AM":11==_?_+"AM - 12PM":12==_?_+"PM - 1PM":23==_?_+"PM - "+(_+1)+"AM":_-12+"PM - "+(_+1-12)+"PM":_.ToString("00")+":00 - "+(_+1).ToString("00")+":00"}else C.ID="R"+e+"_"+o[t][c].toString(),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(C.HeaderText)||(C.HeaderText+="\r\n"),C.HeaderText+=o[t][c].toString();if(d>0&&!this.RepeatPrevDataSeperately){var m=o.filter((function(e){return e.Sno==o[t].Sno&&0==e.PrevMonth}));C.ID=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.StringValue(m[0].ColID).toString()+"_"+d,20==d?(C.HeaderText="Diff",C.Formula=m[0].ColID.toString(),C.ColumnFilterExpression=m[0].ColID.toString()+"_1"):30==d&&(C.HeaderText="%",C.DataFormat.PercentageOn=m[0].ColID.toString()+"_1")}return this.RepeatShowPrevMn&&(o[t].ColID=C.ID),"FLOAT"==C.ColumnType||"INT"==C.ColumnType?this.dtTempColumnsRepeat.Contains(C.ID)||(this.dtTempColumnsRepeat.push(C.ID),-1==C.UseOnce&&(this.dtTempColumnsRepeat.Contains("DISTINCT"+C.ID)||this.dtTempColumnsRepeat.push("DISTINCT"+C.ID),this.lstSummaryDistinctNumeric.ContainsKey("DISTINCT"+C.ID)?this.lstSummaryDistinctNumeric["DISTINCT"+C.ID].Clear():this.lstSummaryDistinctNumeric.push("DISTINCT"+C.ID,new Array)),this.TotalCols.Contains(this.ColumnSource[e].ID)&&this.TotalCols.push(C.ID),this.GrpReportTotal.TempTotalCols.ContainsKey(this.ColumnSource[e].ID)&&this.GrpReportTotal.TotalCols.push(C.ID,l.length-1),this.lstGroup.forEach((function(t){t.TempTotalCols.ContainsKey(u.ColumnSource[e].ID)&&t.TotalCols.push(C.ID,l.length-1)})),a.push(C)):(this.dtTempColumnsRepeat.push(C.ID),n.push(C)),d<20&&h.forEach((function(t){t[C.ID]=t[u.ColumnSource[e].ID]})),!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(C.DataFormat.PercentageOn)&&this.dicRepeatColsMap.ContainsKey(C.DataFormat.PercentageOn)&&this.dicRepeatColsMap[C.DataFormat.PercentageOn].length>0&&(C.DataFormat.PercentageOn=this.dicRepeatColsMap[C.DataFormat.PercentageOn].Last()),this.dicRepeatColsMap[this.ColumnSource[e].ID].push(C.ID),this.lstRepeatSummaryAplha.push(C.ID,[]),C}},{key:"GetBudgetIndex",value:function(e,t){var o=0;if(e.Subtract(t).TotalDays<=0)for(var s=new Date(e.getFullYear(),e.getMonth(),e.getDate());s<=t&&o<=13;)s=s.AddMonths(1),o++;return o>12&&(o=0),o}},{key:"CheckAndUpdateKANBAN",value:function(e){var t,o,s,i=this,l=null,n=[],a=[];new Array,this.RepeatOn=this.BaseReportColumns[0].ID;var r=this.BaseReportColumns.find((function(e){return e.ID==i.RepeatOn}));a.push(this.RepeatOn);var h=e.Copy();h=h.sort((function(e,t){return e[i.RepeatOn]>t[i.RepeatOn]?1:-1})),l=h.ToTable(!0,[this.RepeatOn]);var u=this.RepeatOn,c=[];this.GrpReportTotal.TotalCols.Clear();var D=new Array,d=new Array;null==this.dicRepeatColsMap?this.dicRepeatColsMap=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a:this.dicRepeatColsMap.Clear(),this.RepeatSets=l.length-1;var C=!0;for(new Array,s=0,"DESC"==r.Sort.SelectedValue&&(C=!1,s=l.length-1),o=1;o<this.ColumnSource.length;o++)this.dicRepeatColsMap.push(this.ColumnSource[o].ID,[]);this.RepeatStartIndex=1,this.RepeatNextCols=this.ColumnSource.length-2;for(var p,T=1;;){if(C){if(s>l.length-1)break}else if(s<0)break;for(t=this.RepeatStartIndex,o=0;o<=this.RepeatNextCols;t++,o++){var _=this.ColumnSource[t].Clone();c.push(_),_.ID="KAN"+this.ColumnSource[t].ID+"_"+l[s][u].toString(),o>0?(_.Row=o,_.Column=T,_.HeaderAppearance.IsVisible=!1):T=c.length-1,_.HeaderText=l[s][u].toString(),a.Contains(_.ID)||("FLOAT"==_.ColumnType||"INT"==_.ColumnType?(a.push(_.ID),d.push(_)):(a.push(_.ID),D.push(_))),this.dicRepeatColsMap[this.ColumnSource[t].ID].push(_.ID)}C?s+=1:s-=1}var m=function(){if(C){if(s>l.length-1)return"break"}else if(s<0)return"break";var o=e.filter((function(e){return e[i.RepeatOn]==l[s][u].toString()}));I=c.find((function(e){return e.ID=="KAN"+i.ColumnSource[1].ID+"_"+l[s][u].toString()}));var a=void 0;for(I&&(I.HeaderText+=" ("+o.length+")"),t=0;t<o.length;t++)n.length<=t?(a={},n.push(a)):a=n[t],i.dicRepeatColsMap.keys.forEach((function(e){p="KAN"+e+"_"+l[s][u].toString(),a[p]=o[t][e]}));C?s+=1:s-=1};for(s=0,"DESC"==r.Sort.SelectedValue&&(C=!1,s=l.length-1);;){var I;if("break"===m())break}console.log(c),console.log(a),this.ReportColumns=c,this.ReportDataColumns=a,this.RefreshPostFilters(!1),this.ReportData=n}},{key:"SetDatePickers",value:function(){var e=!1;if(this.FromDatePicker=new _shared_models_controls_PactDatePickerData__WEBPACK_IMPORTED_MODULE_12__.a(0),this.FromDatePicker.Visible=!1,this.ToDatePicker=new _shared_models_controls_PactDatePickerData__WEBPACK_IMPORTED_MODULE_12__.a(0),this.ToDatePicker.Visible=!1,this.oReportDialog instanceof _static_report_filter_StaticReportFilterViewModel__WEBPACK_IMPORTED_MODULE_20__.a)this.FromDatePicker=this.oReportDialog.FromDate,this.ToDatePicker=this.oReportDialog.ToDate;else if(null!=this.MRPFilter)this.FromDatePicker=this.MRPFilter.FromDate,this.ToDatePicker=this.MRPFilter.ToDate;else if(null!=this.Filter)for(var t=0;t<this.Filter.Fields.length;t++){var o=this.Filter.Fields[t];if("DATE"==o.CDGDO.DataType){"FUTURE"!=o.Condition.SelectedValue&&"PAST"!=o.Condition.SelectedValue||(e=!0),this.FromDatePicker=o.FromDatePicker,this.ToDatePicker=o.ToDatePicker,this.FromDatePicker.Dependantinuse=!0,this.ToDatePicker.Dependantinuse=!0;break}}this.DateFilter="",this.FromDatePicker.Visible&&this.ToDatePicker.Visible||e?_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("Hijri Date")&&""!=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Hijri Date"]&&Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Hijri Date"])?(this.DateFilter=_services_session_manager_service__WEBPACK_IMPORTED_MODULE_26__.a.ConvertGregtoHijri(this.FromDatePicker.Date),this.DateFilter+=" "+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("To")+" "+_services_session_manager_service__WEBPACK_IMPORTED_MODULE_26__.a.ConvertGregtoHijri(this.ToDatePicker.Date)):(this.DateFilter=this.FromDatePicker.Date.ToString(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Date Format"]),this.DateFilter+=" "+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("To")+" "+this.ToDatePicker.Date.ToString(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Date Format"])):this.ToDatePicker.Visible?this.DateFilter=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("Hijri Date")&&""!=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Hijri Date"]&&Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Hijri Date"])?this.ToDatePicker.Label+"  "+_services_session_manager_service__WEBPACK_IMPORTED_MODULE_26__.a.ConvertGregtoHijri(this.ToDatePicker.Date):this.ToDatePicker.Label+"  "+this.ToDatePicker.Date.ToString(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Date Format"]):this.FromDatePicker.Visible&&(this.DateFilter=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("Hijri Date")&&""!=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Hijri Date"]&&Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Hijri Date"])?_services_session_manager_service__WEBPACK_IMPORTED_MODULE_26__.a.ConvertGregtoHijri(this.FromDatePicker.Date):this.FromDatePicker.Date.ToString(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Date Format"])),this.SetFilterText()}},{key:"SetFilterText",value:function(){var e=this;if(this.Preferences.ContainsKey("ShowFilterText")){var t;if(0==this.dicFieldText.length&&0==this.dicTreeText.length){var o=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f;o.LoadXml("<XML>"+this.Preferences.ShowFilterText+"</XML>");for(var s=0;s<o.DocumentElement.children.length;s++){var i=o.DocumentElement.children[s];i.attributes.Filter.value.startsWith("CC_")?this.dicTreeText.push(i.attributes.Filter.value.substr(3)):this.dicFieldText.push(i.attributes.Filter.value)}}if(this.dicFieldText.length>0)if(this.StaticReportType>0)null!=this.DBPanel&&((t=this.FilterText.find((function(e){return"xDATEFILTER"==e.DBColumnName})))||((t=new _shared_models_controls_PactTextBlockData__WEBPACK_IMPORTED_MODULE_16__.a).Label="Date Filter",t.DBColumnName="xDATEFILTER",this.FilterText.push(t)),t.Text=this.DateFilter);else for(var l=function(o){var s=e.Filter.Fields[o];if(e.dicFieldText.Contains(s.ID))if((t=e.FilterText.find((function(e){return e.DBColumnName==s.ID})))||((t=new _shared_models_controls_PactTextBlockData__WEBPACK_IMPORTED_MODULE_16__.a).Label=s.Caption.Text,t.DBColumnName=s.ID,e.FilterText.push(t)),"DATE"==s.CDGDO.DataType)t.Text="Between"==s.Condition.SelectedValue?s.FromDatePicker.Date.ToString(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Date Format"])+" To "+s.ToDatePicker.Date.ToString(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Date Format"]):"NotBetween"==s.Condition.SelectedValue?"Not Between"+s.FromDatePicker.Date.ToString(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Date Format"])+" And "+s.ToDatePicker.Date.ToString(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Date Format"]):"FUTURE"==s.Condition.SelectedValue||"PAST"==s.Condition.SelectedValue?s.FromDatePicker.Date.ToString(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Date Format"])+" And "+s.ToDatePicker.Date.ToString(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Date Format"]):s.FromDatePicker.Date.ToString(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Date Format"]);else if("Between"==s.Condition.SelectedValue||"NotBetween"==s.Condition.SelectedValue)if(s.FromValue.Visible){if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(s.FromValue.TextBox.Text)&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(s.ToValue.Text))return"continue";t.Text=s.Condition.SelectedItem.Name+" "+s.FromValue.TextBox.Text+" And "+s.ToValue.Text}else{if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(s.FromList.Text)&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(s.ToList.Text))return"continue";t.Text=s.Condition.SelectedItem.Name+" "+s.FromList.Text+" And "+s.ToList.Text}else if("Contains"==s.Condition.SelectedValue||"NotContain"==s.Condition.SelectedValue){if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(s.FromValue.TextBox.Text))return"continue";t.Text=s.Condition.SelectedItem.Name+" "+s.FromValue.TextBox.Text}else if(s.FromValue.Visible){if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(s.FromValue.TextBox.Text))return"continue";t.Text=s.Condition.SelectedItem.Name+" "+s.FromValue.TextBox.Text}else if(s.FromList.CCID>0&&0==s.FromList.SelectedValue&&3!=s.FromList.CCID)return"continue"},n=0;n<this.Filter.Fields.length;n++)l(n);if(this.dicTreeText.length>0){var a,r=0;if(null!=this.oReportDialog&&this.oReportDialog.Locations.Visible&&this.dicTreeText.Contains(this.oReportDialog.Locations.DBColumnID.toString())){for(var h="",u=1;u<this.oReportDialog.Locations.Items.length;u++)this.oReportDialog.Locations.Items[u].IsChecked&&(h.length>0&&(h+=","),h+=this.oReportDialog.Locations.Items[u].Name);r=this.oReportDialog.Locations.DBColumnID,(t=new _shared_models_controls_PactTextBlockData__WEBPACK_IMPORTED_MODULE_16__.a).Label=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Location"),t.Text=h.toString(),this.FilterText.push(t)}a=null!=this.oReportDialog?this.oReportDialog.CostCenterFilters:this.Filter.CostCenterFilters;for(var c=function(o){var s=a[o];if(t=e.FilterText.find((function(e){return e.DBColumnName=="CC"+s.CostCenterID})),s.SelectedNodes.length>0&&s.CostCenterID!=r){if(!(e.dicTreeText.Contains(s.CostCenterID.toString())||44==s.CostCenterID&&e.dicTreeText.Contains("44_"+s.LookupTypeID.toString())))return"continue";if(null==t&&((t=new _shared_models_controls_PactTextBlockData__WEBPACK_IMPORTED_MODULE_16__.a).Label=s._CostCenter,t.DBColumnName="CC"+s.CostCenterID,e.FilterText.push(t)),"[FILTER]"==s.SelectedNodesTag){for(var i="",l=0;l<s.SelectedNodes.length&&l<15;l++)i.length>0&&(i+=","),i+=s.SelectedNodes[l].Id.toString();var n=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetNodeNames(s.CostCenterID,i);if(null!=n&&n.length>0){i="";for(var h=0;h<n.length;h++)i.length>0&&(i+=", "),i+=n[h].Name.toString();s.SelectedNodes.length>15&&(i+=",..."),t.Text=i}}else t.Text=s.SelectedNodesTag}else null!=t&&e.FilterText.Remove(t)},D=0;D<a.length;D++)c(D)}}}},{key:"AddReportTitleRow",value:function(e,t){var o=null==this.ParentReport?this.ReportColumns.length:this.ParentReport.ReportColumns.length;this.childReportTitle=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(o,this.RowHeight+4),this.childReportTitle.LevelNo=-2,this.childReportTitle.Cells[0].IsNormal=!1,this.childReportTitle.Type=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Header,this.childReportTitle.Cells[0].Text=e,this.childReportTitle.Cells[0].CellAppearance=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.a,this.childReportTitle.Cells[0].CellAppearance.IsBold=!0,this.childReportTitle.Cells[0].CellAppearance.FontSize=14,this.childReportTitle.Cells[0].CellAppearance.ForeColor="#FF00465A",this.childReportTitle.Cells[0].CellAppearance.BackColor="#FFD5D5D5",this.childReportTitle.Cells[0].CellAppearance.FontFamilyName="Arial",this.childReportTitle.Cells[0].CellAppearance.Alignment="Left",this.childReportTitle.Cells[0].ColSpan=o,t&&(this.MergeChildReport||this.addRow(this.childReportTitle))}},{key:"AddReportColumnRow",value:function(e){this.childReportColumnHeader=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(this.ReportColumns.length,this.ReportColumns[0].HeaderHeight),this.childReportColumnHeader.LevelNo=-1,this.childReportColumnHeader.Type=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Header;for(var t=0;t<this.ReportColumns.length;t++)this.childReportColumnHeader.Cells[t].IsNormal=!1,this.childReportColumnHeader.Cells[t].Text=this.ReportColumns[t].HeaderText,this.childReportColumnHeader.Cells[t].CellAppearance=this.ReportColumns[t].HeaderAppearance;e&&(this.MergeChildReport||this.addRow(this.childReportColumnHeader))}},{key:"RenderData",value:function(e,t){var o=this;try{var s;!function(){Logger.InfoLog("ReportViewModel::Entring RenderData");var i,l=0,n=0,a=[],r=0,h=0,u="";if(o.iGroupRowsAdded=0,o.iCurrGroupDetailRows=0,null==o.ReportSummaryData&&!o.IsFilterRendering)for(var c=0;c<o.lstGroup.length;c++)if("Summary"==o.lstGroup[c].DisplayMode){o.ReportSummaryData=[],o.ReportSummaryDataColumns=o.ReportDataColumns.Copy();break}for(var D=function(e){var t=o.ReportColumns[e];_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(t.DataFormat.PrevRowValue)||(t.PrevRowValueInd=-1,(s=o.ReportColumns.find((function(e){return e.ID==t.DataFormat.PrevRowValue})))&&(t.PrevRowValueInd=o.ReportColumns.indexOf(s)))},d=0;d<o.ReportColumns.length;d++)D(d);if(null==o.LevelColumn){if(o.PercentColumnExists){o.PercentTotals=new Array(o.ReportColumns.length).fill(0);for(var C=function(t){if(o.PercentTotals[t]=0,"FLOAT"==o.ReportColumns[t].ColumnType||"INT"==o.ReportColumns[t].ColumnType||!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(o.ReportColumns[t].Formula))try{_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(o.ReportColumns[t].Formula)?o.PercentTotals[t]=parseFloat(void 0):e.forEach((function(e){l=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(e[o.ReportColumns[t].ID]),o.PercentTotals[t]+=l}))}catch(s){}},p=0;p<o.ReportColumns.length;p++)C(p)}for(var T=0;T<e.length;T++)if(o.AddGroupRows(e,T),!(o.TopRecords>0&&!o.IsDefaultSortColumnExists&&o.iGroupRowsAdded>=o.TopRecords)){a.Clear(),a.push(new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(o.ReportColumns.length,o.RowHeight)),a[0].DataRow=e[T];for(var _=0;_<o.ReportColumns.length;_++){if((i=o.ReportColumns[_]).Row>0){if(a.length-1<i.Row)for(var m=0;m<=i.Row;m++)a.length-1<m&&(a.push(new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(o.ReportColumns.length,o.SubRowHeight)),a[a.length-1].Type=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.SubDetail);r=i.Row,h=i.Column}else r=0,h=_;if(t.Contains(i.ID)){if(-1==i.UseOnce){o.RepeatType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.None?_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNum(e[T][i.ID])&&(l=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(e[T][i.ID]),o.lstSummaryDistinctNumeric[i.ID].Contains(l)||o.lstSummaryDistinctNumeric[i.ID].push(l)):(u=e[T]["DISTINCT"+i.ID].toString(),o.SetCellValue(u,i.DataFormat,"",a[r].Cells[h]));continue}if(-1!=i.PrevRowValueInd)if(0==o.Data.length)e[T][i.ID]="0";else if(o.Data[o.Data.length-1].Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Detail)e[T][i.ID]=o.Data[o.Data.length-1].Cells[i.PrevRowValueInd].Value;else if(e[T][i.ID]="0",0==o.ReportColumns[i.PrevRowValueInd].DataFormat.CumTotal)for(var I=o.Data.length-2;I>=0;I--)if(o.Data[I].Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Detail){e[T][i.ID]=o.Data[I].Cells[i.PrevRowValueInd].Value;break}if(u=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(e[T][i.ID]),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(i.DataFormat.PercentageOn)){if(o.TotalCols.Contains(i.ID)&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNum(u))if(l=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(u),1==i.UseOnce)o.totals[_][o.lstGroup.length]=l;else if(2==i.UseOnce)o.totals[_][o.lstGroup.length]+=l;else if(i.DataFormat.CumTotal>-1)for(var R=0;R<=o.lstGroup.length;R++)o.totals[_][R]+=l;else"$TOTALHOURS$"==i.Formula?o.totals[_][o.lstGroup.length]=_ReportViewModel.GetHoursSum(o.totals[_][o.lstGroup.length],l):o.totals[_][o.lstGroup.length]+=l;i.DataFormat.CumTotal>-1&&(u=o.totals[_][o.lstGroup.length].toString())}else{if(l=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(u),n="REPORT_TOTAL"==o.ReportColumns[_].DataFormat.PercentageOn?o.PercentTotals[_]:_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(e[T][i.DataFormat.PercentageOn]),0==l||0==n)continue;u=(n=100*l/n).toString(),o.TotalCols.Contains(o.ReportColumns[_].ID)&&(o.totals[_][o.lstGroup.length]+=l)}""!=u&&(o.SetCellValue(u,i.DataFormat,i.ColumnType,a[r].Cells[h]),r>0&&h<o.ReportColumns.length&&(o.IsKANBAN||o.ReportColumns[h].ColumnType!=i.ColumnType)&&(a[r].Cells[h].IsNormal=!1,a[r].Cells[h].CellAppearance=i.DataAppearance.Clone()),i.DataFormat.PrintOnce&&!o.IsSummary&&o.Data.length>0&&o.iGroupRowsAdded>0&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(a[r].Cells[h].Value)==_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(o.Data[o.Data.length-1].Cells[h].Value)&&(a[r].Cells[h].Text=""),o.IsSummary&&"FLOAT"!=i.ColumnType&&"INT"!=i.ColumnType&&("DATE"==i.ColumnType?_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(a[r].Cells[h].Text)||0!=o.lstSummaryCells[i.ID].filter((function(e){return e.Text==a[r].Cells[h].Text})).length||o.lstSummaryCells[i.ID].push(a[r].Cells[h]):o.lstSummaryAplha.ContainsKey(i.ID)&&!o.lstSummaryAplha[i.ID].Contains(u)?o.lstSummaryAplha[i.ID].push(u):o.lstRepeatSummaryAplha.ContainsKey(i.ID)&&!o.lstRepeatSummaryAplha[i.ID].Contains(u)&&o.lstRepeatSummaryAplha[i.ID].push(u)))}}for(var S=0;S<o.HiddenNumericColumns.length;S++)if(i=o.HiddenNumericColumns[S],t.Contains(i.ID)&&(""!=(u=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(e[T][i.ID]))&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNum(u)))if(l=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(u),1==i.UseOnce)o.hiddenTotals[S][o.lstGroup.length]=l;else if(2==i.UseOnce)o.hiddenTotals[S][o.lstGroup.length]+=l;else if(i.DataFormat.CumTotal>-1)for(var A=0;A<=o.lstGroup.length;A++)o.hiddenTotals[S][A]+=l;else o.hiddenTotals[S][o.lstGroup.length]+=l;if(!o.IsSummary){-1!=o.colSNoIndex&&(a[0].Cells[o.colSNoIndex].Value=++o.SNo,a[0].Cells[o.colSNoIndex].Text=o.SNo.toString()),o.ApplyKPI(a[0]);for(var M=0;M<a.length;M++){var g=a[M];g.LevelNo=o.lstGroup.length,o.HideEmptyRows&&!g.Cells.find((function(e){return!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(e.Text)}))||o.IsNoDataGroups&&!g.Cells.find((function(e){return!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(e.Text)}))||o.addRow(g)}o.IsKANBAN&&(o.addRow(new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(o.ReportColumns.length,o.RowHeight)),o.Data[o.Data.length-1].Cells[0].ColSpan=o.ReportColumns.length),o.iGroupRowsAdded++,o.iCurrGroupDetailRows++}}}else!function(){if(!o.IsTreeDataCalculated){for(var s=0;s<o.ReportColumns.length;s++)t.Contains(o.ReportColumns[s].ID)||s==o.colSNoIndex||t.push(o.ReportColumns[s].ID);for(var c=0;c<o.HiddenNumericColumns.length;c++)t.Contains(o.HiddenNumericColumns[c].ID)||t.push(o.HiddenNumericColumns[c].ID)}if(o.PercentColumnExists){o.PercentTotals=new Array(o.ReportColumns.length).fill(0);for(var D=function(e){if(o.PercentTotals[e]=0,"FLOAT"==o.ReportColumns[e].ColumnType||"INT"==o.ReportColumns[e].ColumnType||!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(o.ReportColumns[e].Formula))try{var t;_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(o.ReportColumns[e].Formula)?(t=o.ReportTransactionData.Compute("sum",o.ReportColumns[e].ID),o.PercentTotals[e]=parseFloat(t)):o.ReportTransactionData.forEach((function(t){l=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(t[o.ReportColumns[e].ID]),o.PercentTotals[e]+=l}))}catch(s){}},d=0;d<o.ReportColumns.length;d++)D(d)}var C=0,p=0,T=[];if(o.LevelNo=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(o.Filter.ShowLevel.Text),-1==o.LevelNo?o.LevelNo=50:-2==o.LevelNo&&(o.LevelNo=51),o.lstParents=[],o.lstTotal=[],o.lstParents.push(new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(o.ReportColumns.length,o.RowHeight)),o.lstTotal.push(new Array(o.ReportColumns.length+o.HiddenNumericColumns.length).fill(0)),e.length>0)for(var _=0;_<parseInt(e[0].Depth);_++)o.lstParents.push(new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(o.ReportColumns.length,o.RowHeight)),o.lstTotal.push(new Array(o.ReportColumns.length+o.HiddenNumericColumns.length).fill(0));for(var m=0,I=function(s){if(a.Clear(),a.push(new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(o.ReportColumns.length,o.RowHeight)),o.RowHeight>0&&(a[0].Height=o.RowHeight),a[0].DataRow=e[s],a[0].LevelNo=parseInt(e[s].Depth),a[0].IsGroup=Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(e[s].IsGroup),o.UpdateTreeTotals(a[0].LevelNo),a[0].IsGroup){for(o.lstParents.push(a[0]),o.lstTotal.push(new Array(o.ReportColumns.length+o.HiddenNumericColumns.length).fill(0)),m=0;m<a[0].Cells.length;m++)a[0].Cells[m].IsNormal=!1,a[0].Cells[m].CellAppearance=o.ReportColumns[m].DataAppearance.Clone(),a[0].Cells[m].CellAppearance.ForeColor="#FF0081A6";a[0].PrintVisible=o.TreeGroupPrint}else if(T=o.ReportTransactionData.filter(o.LevelSubGroup.length>0?function(t){return t.TreeNodeID==e[s].TreeNodeID&&t.LevelSubGroup==e[s][o.LevelSubGroup].toString().Replace("'","''")}:function(t){return t.TreeNodeID==e[s].TreeNodeID}),!o.Filter.ShowAllTreeData.IsChecked&&0==T.length)return"continue";for(var c=0;c<o.HiddenNumericColumns.length;c++)i=o.HiddenNumericColumns[c],t.Contains(i.ID)&&(a[0].IsGroup||T.length>0&&(C=0,"FLOAT"!=i.ColumnType&&"INT"!=i.ColumnType||(T.forEach((function(e){_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNum(e[i.ID])&&(p=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(e[i.ID]),C+=p)})),e[s][i.ID]=C)),""!=(u=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(e[s][i.ID]))&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNum(u)&&(l=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(u),o.lstTotal[o.lstTotal.length-1][o.ReportColumns.length+c]+=l));for(m=0;m<o.ReportColumns.length;m++)if(i=o.ReportColumns[m],!a[0].IsGroup&&t.Contains(o.ReportColumns[m].ID)){if(T.length>0){if(-1==o.ReportColumns[m].UseOnce)continue;if(C=0,"FLOAT"==i.ColumnType||"INT"==i.ColumnType)i.UseOnce>0?C=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(T[0][i.ID]):T.forEach((function(e){_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNum(e[i.ID])&&(p=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(e[i.ID]),"$TOTALHOURS$"==i.Formula?C=_ReportViewModel.GetHoursSum(C,p):C+=p)})),e[s][i.ID]=C;else if("DATE"==i.ColumnType)try{e[s][i.ID]=T[0][i.ID]}catch(d){}else e[s][i.ID]=T[0][i.ID]}if(3==i.EvaluateAtEnd&&(""!=i.Formula||""!=i.ColumnFilterExpression)&&o.CalculateFormula_2(i,e[s],!0))break}if(!(m<o.ReportColumns.length)){for(m=0;m<o.ReportColumns.length;m++){if((i=o.ReportColumns[m]).Row>0){if(a.length-1<o.ReportColumns[m].Row)for(var D=0;D<=o.ReportColumns[m].Row;D++)a.length-1<D&&a.push(new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(o.ReportColumns.length,o.SubRowHeight));r=o.ReportColumns[m].Row,h=o.ReportColumns[m].Column}else r=0,h=m;if(i.ID==o.LevelColumn.ID&&(a[r].Cells[h].IsNormal=!1,a[r].Cells[h].level=a[0].LevelNo,o.LevelSubGroup.length>0&&!a[0].IsGroup))o.SetCellValue(e[s][o.ReportColumns[m].ID],i.DataFormat,i.ColumnType,a[r].Cells[h]);else if(t.Contains(o.ReportColumns[m].ID)){if(!a[0].IsGroup&&T.length>0&&-1==o.ReportColumns[m].UseOnce){o.sbSummaryDimensions="",o.lstSummaryDistinctNumeric.ContainsKey(i.ID)&&function(){var e=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.c;o.lstSummaryDistinctNumeric[i.ID].Clear(),T.forEach((function(t){_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNum(t[i.ID])&&(p=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(t[i.ID]),o.lstSummaryDistinctNumeric[i.ID].Contains(p)||(o.lstSummaryDistinctNumeric[i.ID].push(p),o.SetCellValue(p,i.DataFormat,"FLOAT",e),o.sbSummaryDimensions.length>0&&(o.sbSummaryDimensions+=","),o.sbSummaryDimensions+=e.Text))})),o.SetCellValue(o.sbSummaryDimensions.toString(),i.DataFormat,"",a[r].Cells[h])}();continue}if(""!=i.Formula&&2==i.EvaluateAtEnd&&o.CalculateFormula_2(i,e[s]),""!=(u=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(e[s][i.ID]))){if(a[0].IsGroup&&("FLOAT"==i.ColumnType||"INT"==i.ColumnType))continue;if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(o.ReportColumns[m].DataFormat.PercentageOn))o.TotalCols.Contains(i.ID)&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNum(u)&&(l=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(u),o.lstTotal.length>0&&("$TOTALHOURS$"==i.Formula?o.lstTotal[o.lstTotal.length-1][m]=_ReportViewModel.GetHoursSum(o.lstTotal[o.lstTotal.length-1][m],l):o.lstTotal[o.lstTotal.length-1][m]+=l));else{if(l=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(u),n="REPORT_TOTAL"==o.ReportColumns[m].DataFormat.PercentageOn?o.PercentTotals[m]:_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(e[s][o.ReportColumns[m].DataFormat.PercentageOn]),0==l||0==n)continue;u=(n=100*l/n).toString(),o.TotalCols.Contains(o.ReportColumns[m].ID)&&(o.lstTotal[o.lstTotal.length-1][m]+=l)}o.SetCellValue(u,i.DataFormat,i.ColumnType,a[r].Cells[h])}}}a[0].LevelNo<=o.LevelNo&&(o.lstParents.length>1&&(a[0].IsExpanded=!0,a[0].IsExpanded&&(a[0].Type=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Detail),a[0].IsGroup?o.lstParents.length>2&&(a[0].Parent=o.lstParents[o.lstParents.length-2]):a[0].Parent=o.lstParents[o.lstParents.length-1],null==a[0].Parent||a[0].Parent.IsExpanded&&a[0].Parent.Visible||(a[0].Visible=!1)),-1!=o.colSNoIndex&&(a[0].IsGroup||(a[0].Cells[o.colSNoIndex].Value=++o.SNo,a[0].Cells[o.colSNoIndex].Text=o.SNo.toString())),a[0].IsGroup||o.ApplyKPI(a[0]),a[0].IsGroup||50!=o.LevelNo||(a[0].Visible=!1),o.addRow(a[0]))}},R=0;R<e.length;R++)I(R);if(50==o.LevelNo)for(var S=o.Data.length-1;S>=0;S--)o.Data[S].Visible||o.Data[S].IsGroup||o.removeRowAt(S)}();Logger.InfoLog("ReportViewModel::Exiting RenderData")}()}catch(i){Logger.ErrorLog("ReportViewModel::Error RenderData",i.stack)}}},{key:"AddGroupRows",value:function(e,t){var o=this,s=!1;this.IsNewGroupIndex=-1;for(var i=function(i){if(!Object(util__WEBPACK_IMPORTED_MODULE_24__.isUndefined)(e[t][o.lstGroup[i].ID])&&o.Groupstr[o.lstGroup[i].ID]!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(e[t][o.lstGroup[i].ID])){if(o.IsNewGroupIndex=i,t>0&&!s){s=!0;for(var l=o.lstGroup.length;l>=i+1;l--)o.AddSubtotals(e[t-1],o.lstGroup[l-1],l),o.Groupstr[o.lstGroup[l-1].ID]=null}o.IsSummary="Summary"==o.lstGroup[i].DisplayMode;var a=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(o.ReportColumns.length,o.RowHeight);o.lstGroup[i].Height>0&&(a.Height=o.lstGroup[i].Height),a.Type=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Group,a.LevelNo=i;var r=0;if((n=o.ReportColumns.find((function(e){return e.ID==o.lstGroup[i].ShowUnder})))&&-1==o.lstGroup[i].Width&&(r=o.ReportColumns.indexOf(n)),-1==o.lstGroup[i].Width&&null==n&&(a.Cells[0].ColSpan=o.ReportColumns.length),null!=o.lstGroup[i].Type&&""!=o.lstGroup[i].Type&&"DATE"==o.lstGroup[i].Type)try{o.SetCellValue(o.lstGroup[i].Prefix+new Date(e[t][o.lstGroup[i].ID]).ToString(o.lstGroup[i].GroupFormat.DateType),o.lstGroup[i].GroupFormat,o.lstGroup[i].Type,a.Cells[r])}catch(h){o.SetCellValue(o.lstGroup[i].Prefix+e[t][o.lstGroup[i].ID].toString(),o.lstGroup[i].GroupFormat,o.lstGroup[i].Type,a.Cells[r])}else o.SetCellValue(o.lstGroup[i].Prefix+e[t][o.lstGroup[i].ID].toString(),o.lstGroup[i].GroupFormat,o.lstGroup[i].Type,a.Cells[r]);a.Cells[r].DataFormat=o.lstGroup[i].GroupFormat,o.Groupstr[o.lstGroup[i].ID]=e[t][o.lstGroup[i].ID].toString(),a.Cells[r].CellAppearance=o.lstGroup[i].GroupAppearance,a.Cells[r].IsNormal=!1,a.Cells[r].level=0,o.lstGroup[i].Height>0&&(a.Cells[r].height=o.lstGroup[i].Height),a.PrintVisible=o.lstGroup[i].GroupAppearance.IsPrintVisible,o.lstGroup[i].ShowAsColumn||(o.iGroupRowsAdded=0,o.lstGroup[i].GroupAppearance.IsVisible&&o.addRow(a)),o.iTopGroupSummaryConsider||(o.iGroupRowsAdded=0)}},l=0;l<this.lstGroup.length;l++){var n;i(l)}}},{key:"CheckAndAddSubTotals",value:function(e){for(var t=this.lstGroup.length;t>0;t--)e.length>0&&this.AddSubtotals(e[e.length-1],this.lstGroup[t-1],t),this.Groupstr[this.lstGroup[t-1].ID]=null}},{key:"CheckAndAddTotals",value:function(e){for(var t=this.lstGroup.length;t>0;t--)e.length>0&&this.AddSubtotals(e[e.length-1],this.lstGroup[t-1],t),this.Groupstr[this.lstGroup[t-1].ID]=null;this.GrpReportTotal.SubTotalAppearance.IsVisible&&this.AddSubtotals_RT(this.GrpReportTotal,0)}},{key:"UpdateTreeTotals",value:function(e){for(var t=this,o=this.lstTotal.length-1;o>e;o--){if(this.FormulaColumns.length>0&&null!=this.lstParents[o].DataRow)for(var s=0;s<this.ReportColumns.length;s++)"FLOAT"==this.ReportColumns[s].ColumnType&&s!=this.colSNoIndex&&Object.keys(this.lstParents[o].DataRow).Contains(this.ReportColumns[s].ID)&&(this.lstParents[o].DataRow[this.ReportColumns[s].ID]=this.lstTotal[o][s]);if(o>0)for(var i=0;i<this.lstTotal[o].length;i++)this.lstTotal[o-1][i]+=this.lstTotal[o][i];if(!this.GroupTotalsAtEnd||this.DontShowSummaryGroupTotals&&!this.lstParents[o].IsExpanded)for(var l=function(e){if("FLOAT"==t.ReportColumns[e].ColumnType&&e!=t.colSNoIndex)if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(t.ReportColumns[e].DataFormat.PercentageOn))t.SetCellValue(2==t.ReportColumns[e].EvaluateAtEnd&&""!=t.ReportColumns[e].Formula&&t.FormulaColumns.length>0&&null!=t.lstParents[o].DataRow?t.CalculateFormula_1(t.ReportColumns[e].Formula,t.lstParents[o].DataRow,[]):t.lstTotal[o][e],t.ReportColumns[e].DataFormat,"FLOAT",t.lstParents[o].Cells[e]);else{var s=0,i=t.lstTotal[o][e];if("REPORT_TOTAL"==t.ReportColumns[e].DataFormat.PercentageOn?s=t.PercentTotals[e]:t.GrpReportTotal.TotalCols.ContainsKey(t.ReportColumns[e].DataFormat.PercentageOn)?s=t.lstTotal[o][t.GrpReportTotal.TotalCols[t.ReportColumns[e].DataFormat.PercentageOn]]:(a=t.HiddenNumericColumns.find((function(o){return o.ID==t.ReportColumns[e].DataFormat.PercentageOn})))&&(s=t.lstTotal[o][t.ReportColumns.length+t.HiddenNumericColumns.indexOf(a)]),0==i||0==s)return"continue";s=100*i/s,null!=t.lstParents[o].DataRow&&Object.keys(t.lstParents[o].DataRow).Contains(t.ReportColumns[e].ID)&&(t.lstParents[o].DataRow[t.ReportColumns[e].ID]=s),t.SetCellValue(s,t.ReportColumns[e].DataFormat,"FLOAT",t.lstParents[o].Cells[e])}},n=0;n<this.ReportColumns.length;n++){var a;l(n)}if(e<=this.LevelNo){var r=!1;if(!this.Filter.ShowAllTreeData.IsChecked){var h=void 0;for(h=0;h<this.ReportColumns.length&&0==this.lstTotal[o][h];h++);h==this.ReportColumns.length&&(r=!0,this.removeRow(this.lstParents[o]))}if(!r){var u=this.Data.indexOf(this.lstParents[o]);if(u>=0)if(!this.GroupTotalsAtEnd||this.DontShowSummaryGroupTotals&&!this.lstParents[o].IsExpanded)this.removeRow(this.lstParents[o]),this.insertRowAt(this.lstParents[o],u);else{var c=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(this.ReportColumns.length,this.RowHeight);this.RowHeight>0&&(c.Height=this.RowHeight);for(var D=0;D<c.Cells.length;D++)c.Cells[D].IsNormal=!1,c.Cells[D].CellAppearance=this.ReportColumns[D].DataAppearance.Clone(),c.Cells[D].CellAppearance.IsBold=!0;c.Type=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.BalanceBF,c.Parent=this.lstParents[o].Parent,c.LevelNo=this.lstParents[o].LevelNo,c.Cells[1].IsNormal=!1,c.IsGroup=!0,c.Visible=this.lstParents[o].Visible,c.Cells[0].level=this.lstParents[o].LevelNo,c.Cells[0].Text=this.lstParents[o].Cells[1].Text+" - Total ",c.Cells[0].CellAppearance.Alignment="Right",c.Cells[0].ColSpan=0,this.TreeTotalBorder<0&&c.Cells.map((function(e){return e.Border=t.TreeTotalBorder}));for(var d=0;d<this.ReportColumns.length;d++)"FLOAT"==this.ReportColumns[d].ColumnType&&(0==c.Cells[0].ColSpan&&(c.Cells[0].ColSpan=d),c.Cells[d].IsNormal=!1,c.Cells[d].Border=this.TreeTotalBorder,this.SetCellValue(2==this.ReportColumns[d].EvaluateAtEnd&&""!=this.ReportColumns[d].Formula&&this.FormulaColumns.length>0&&null!=this.lstParents[o].DataRow?this.CalculateFormula_1(this.ReportColumns[d].Formula,this.lstParents[o].DataRow,[]):this.lstTotal[o][d],this.ReportColumns[d].DataFormat,"FLOAT",c.Cells[d]));0==c.Cells[0].ColSpan&&(c.Cells[0].ColSpan=1),this.addRow(c)}}}this.lstParents.RemoveAt(o),this.lstTotal.RemoveAt(o)}}},{key:"CalculateFormula_1",value:function(e,t,o){var s=this;try{for(var i=function(e){var i=s.fldDict.keys[e];if(Object(util__WEBPACK_IMPORTED_MODULE_24__.isNullOrUndefined)(t[i]))if(n=s.ReportColumns.find((function(e){return e.ID==i}))){var l=0;n.Row>0&&o.length>=n.Row&&(l=n.Row),l<o.length&&!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(o[l].Cells[s.ReportColumns.indexOf(n)].Text)?s.fldDict[i].setFieldValue(o[l].Cells[s.ReportColumns.indexOf(n)].Text):s.fldDict[i].setFieldValue("FLOAT"==n.ColumnType?0:"")}else s.fldDict[i].setFieldValue("");else s.fldDict[i].setFieldValue(t[i])},l=0;l<this.fldDict.keys.length;l++){var n;i(l)}return this.fldDict.FROMDATE.setFieldValue(this.FromDatePicker.Date),this.fldDict.TODATE.setFieldValue(this.ToDatePicker.Date),this.fldDict.SYSTEMDATE.setFieldValue(this.SystemDate),this.fldDict.SYSTEMDATETIME.setFieldValue(this.SystemDateTime),this.fldDict.CURRENT_YEARSTART.setFieldValue(this.Current_YearStartDate),this.fldDict.PRV_YEARSTART.setFieldValue(this.PRV_YEARSTART),this.fldDict.PRV_YEARFROMDATE.setFieldValue(this.PRV_YEARFROMDATE),this.fldDict.PRV_YEARTODATE.setFieldValue(this.PRV_YEARTODATE),this.fldDict.CURRENT_MONTHSTART.setFieldValue(this.CURRENT_MONTHSTART),this.fldDict.PRV_MONTHSTART.setFieldValue(this.PRV_MONTHSTART),this.fldDict.PRV_MONTHEND.setFieldValue(this.PRV_MONTHEND),this.fldDict.LOGIN_USER.setFieldValue(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.UserName),this.eval.EvaluateExpression(e,this.fldDict).toString()}catch(a){Logger.ErrorLog("ReportViewModel::Error CalculateFormula",a)}return""}},{key:"CalculateFormula_2",value:function(e,t){for(var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=this.fldDict,i=0;i<this.fldDict.keys.length;i++){var l={Key:this.fldDict.keys[i]};Object.keys(t).Contains(l.Key)?this.fldDict[l.Key].setFieldValue(null!=t[l.Key]?t[l.Key]:""):this.fldDict[l.Key].setFieldValue(0)}if(this.fldDict.FROMDATE.setFieldValue(this.FromDatePicker.Date),this.fldDict.TODATE.setFieldValue(this.ToDatePicker.Date),this.fldDict.SYSTEMDATE.setFieldValue(this.SystemDate),this.fldDict.SYSTEMDATETIME.setFieldValue(this.SystemDateTime),this.fldDict.CURRENT_YEARSTART.setFieldValue(this.Current_YearStartDate),this.fldDict.PRV_YEARSTART.setFieldValue(this.PRV_YEARSTART),this.fldDict.PRV_YEARFROMDATE.setFieldValue(this.PRV_YEARFROMDATE),this.fldDict.PRV_YEARTODATE.setFieldValue(this.PRV_YEARTODATE),this.fldDict.CURRENT_MONTHSTART.setFieldValue(this.CURRENT_MONTHSTART),this.fldDict.PRV_MONTHSTART.setFieldValue(this.PRV_MONTHSTART),this.fldDict.PRV_MONTHEND.setFieldValue(this.PRV_MONTHEND),this.fldDict.LOGIN_USER.setFieldValue(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.UserName),!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Formula))try{t[e.ID]=this.eval.EvaluateExpression(e.Formula,s).toString()}catch(n){console.log("Formula Error: ",n)}if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.ColumnFilterExpression)&&(o||(!this.IsSummaryGroupsExists||0==e.EvaluateAtEnd)&&2!=e.EvaluateAtEnd&&3!=e.EvaluateAtEnd)){this.fldDict.ContainsKey(e.ID)&&this.fldDict[e.ID].setFieldValue(t[e.ID]);try{if("0"==this.eval.EvaluateExpression(e.ColumnFilterExpression,s).toString())return!0}catch(n){console.log("Formula Column expr Error: ",n)}}return!1}},{key:"CalculateFormulaForSummary",value:function(e,t){for(var o=this.fldDict,s=0;s<this.fldDict.keys.length;s++){var i={Key:this.fldDict.keys[s]};Object(util__WEBPACK_IMPORTED_MODULE_24__.isUndefined)(t[i.Key])?this.fldDict[i.Key].setFieldValue(0):this.fldDict[i.Key].setFieldValue(null!=t[i.Key]?t[i.Key]:"")}if(this.fldDict.FROMDATE.setFieldValue(this.FromDatePicker.Date),this.fldDict.TODATE.setFieldValue(this.ToDatePicker.Date),this.fldDict.SYSTEMDATE.setFieldValue(this.SystemDate),this.fldDict.SYSTEMDATETIME.setFieldValue(this.SystemDateTime),this.fldDict.CURRENT_YEARSTART.setFieldValue(this.Current_YearStartDate),this.fldDict.PRV_YEARSTART.setFieldValue(this.PRV_YEARSTART),this.fldDict.PRV_YEARFROMDATE.setFieldValue(this.PRV_YEARFROMDATE),this.fldDict.PRV_YEARTODATE.setFieldValue(this.PRV_YEARTODATE),this.fldDict.CURRENT_MONTHSTART.setFieldValue(this.CURRENT_MONTHSTART),this.fldDict.PRV_MONTHSTART.setFieldValue(this.PRV_MONTHSTART),this.fldDict.PRV_MONTHEND.setFieldValue(this.PRV_MONTHEND),this.fldDict.LOGIN_USER.setFieldValue(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.UserName),!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Formula))try{t[e.ID]=this.eval.EvaluateExpression(e.Formula,o).toString()}catch(l){}if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.ColumnFilterExpression)){this.fldDict.ContainsKey(e.ID)&&this.fldDict[e.ID].setFieldValue(t[e.ID]);try{if("0"==this.eval.EvaluateExpression(e.ColumnFilterExpression,o).toString())return!0}catch(n){}}return!1}},{key:"CalculateFormula_out_int",value:function(e,t,o){var s=this.fldDict;o.result=0;for(var i=0;i<this.fldDict.keys.length;i++){var l={Key:this.fldDict.keys[i]};t.ContainsKey(l.Key)?this.fldDict[l.Key].setFieldValue(t[l.Key]):this.fldDict[l.Key].setFieldValue(0)}if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Formula))try{o.result=parseFloat(this.eval.EvaluateExpression(e.Formula,s)),this.fldDict.ContainsKey(e.ID)&&this.fldDict[e.ID].setFieldValue(o.result)}catch(n){}if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.ColumnFilterExpression))try{if("0"==this.eval.EvaluateExpression(e.ColumnFilterExpression,s).toString())return!0}catch(a){}return!1}},{key:"CalculateFormula_out_obj",value:function(e,t,o){var s=this.fldDict;o.result=null;for(var i=0;i<this.fldDict.keys.length;i++){var l={Key:this.fldDict.keys[i]};t.ContainsKey(l.Key)?this.fldDict[l.Key].setFieldValue(t[l.Key]):this.fldDict[l.Key].setFieldValue(0)}if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Formula)||(o.result=this.eval.EvaluateExpression(e.Formula,s),this.fldDict.ContainsKey(e.ID)&&this.fldDict[e.ID].setFieldValue(o.result)),!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.ColumnFilterExpression))try{if("0"==this.eval.EvaluateExpression(e.ColumnFilterExpression,s).toString())return!0}catch(n){}return!1}},{key:"SetCellValue",value:function(e,t,o,s){_ReportViewModel.SetCellValue(e,t,o,-1,s)}},{key:"RoundOff_2",value:function(e,t){return 0==e?e:this.RoundOff_3(e,t,-1)}},{key:"RoundOff_3",value:function(e,t,o){if(0==e)return e;var s;if((s=-1==o?t.RoundOff:0==o?t.RoundOff_RT:t.RoundOff_ST.length>=o?t.RoundOff_ST[o-1]:0)>0){var i=e%s;i<s/2?e-=i:e=e+s-i}return t.NumberFormat.length>0?e:e=t.DecimalsPoints>0?parseFloat(e.ToString("N"+t.DecimalsPoints.toString())):parseFloat(e.ToString("N0"))}},{key:"AddSubtotals",value:function(e,t,o){var s=this;try{var i,l,n=0,a=0,r=0,h=0,u="";_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(t.SubTotalCaptionID)?_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e[t.ID])||(u=e[t.ID].toString()):(t.SubTotalShowCaption=10,_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e[t.SubTotalCaptionID])||(u=e[t.SubTotalCaptionID].toString())),null!=this.SubTotalBeforeCallBack&&this.SubTotalBeforeCallBack.Call(o),l=new Array(o-1<this.STMaxRowsUnder.length&&this.MaxRowsUnder<this.STMaxRowsUnder[o-1]?this.STMaxRowsUnder[o-1]+1:this.MaxRowsUnder+1);var c=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(this.ReportColumns.length,t.SubTotalHeight);if(t.SubTotalBorder<0&&c.Cells.forEach((function(e){e.Border=t.SubTotalBorder})),c.LevelNo=o,l[0]=c,"Detailed"==t.DisplayMode){t.SubTotalShowAtCollapse&&c.LevelNo--;var D=this.ReportColumns.find((function(e){return e.ID==t.SubTotalShowUnder}));if(D&&(n=this.ReportColumns.indexOf(D)),t.TotalCols.length>0){var d=Math.min.apply(null,t.TotalCols.values);c.Cells[n].ColSpan=d-n,c.Cells[n].ColSpan<=0&&(c.Cells[n].ColSpan=1)}for(var C=0;C<=this.MaxRowsUnder;C++)null==l[C]&&(l[C]=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(this.ReportColumns.length,t.SubTotalHeight),t.SubTotalBorder<0&&l[C].Cells.forEach((function(e){e.Border=t.SubTotalBorder})),l[C].Type=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.SubTotal,l[C].LevelNo=o,l[C].Cells[n].ColSpan=c.Cells[n].ColSpan,t.SubTotalShowAtCollapse&&l[C].LevelNo--),(i=l[C]).Type=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.SubTotal,0!=t.SubTotalShowCaption&&C<t.SubTotalPrefix.length&&(1==t.SubTotalShowCaption?(this.SetCellValue(u,t.GroupFormat,t.Type,i.Cells[n]),i.Cells[n].Text=t.SubTotalPrefix[C]+i.Cells[n].Text):2==t.SubTotalShowCaption?i.Cells[n].Text=t.SubTotalPrefix[C]:10==t.SubTotalShowCaption&&this.SetCellValue(u,t.GroupFormat,t.Type,i.Cells[n]),i.Cells[n].DataFormat=t.GroupFormat,i.Cells[n].CellAppearance=t.SubTotalAppearance,i.Cells[n].IsNormal=!1,i.Cells[n].level=o);for(var p=function(e){var u={Key:t.TotalCols.keys[e],Value:t.TotalCols.values[e]};if((_=s.ReportColumns.find((function(e){return e.ID==u.Key})))?r=s.totals[u.Value][o]:(_=s.HiddenNumericColumns.find((function(e){return e.ID==u.Key})),r=s.hiddenTotals[u.Value][o]),!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(_.DataFormat.PercentageOn)){if(h=0,"REPORT_TOTAL"==_.DataFormat.PercentageOn?h=s.PercentTotals[u.Value]:t.TotalCols.ContainsKey(_.DataFormat.PercentageOn)&&(h=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(s.totals[t.TotalCols[_.DataFormat.PercentageOn]][o])),0==r||0==h)return"continue";r=100*r/h}if(null!=_.DataFormat.STUnder&&_.DataFormat.STUnder.ContainsKey(o-1)?(a=_.DataFormat.STUnder[o-1].Row,n=_.DataFormat.STUnder[o-1].Column):(a=_.Row,n=0==_.Row?u.Value:_.Column),null==l[a]&&(l[a]=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(s.ReportColumns.length,t.SubTotalHeight),t.SubTotalBorder<0&&l[a].Cells.forEach((function(e){e.Border=t.SubTotalBorder})),l[a].Type=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.SubTotal,l[a].LevelNo=o,null!=_.DataFormat.STUnder&&_.DataFormat.STUnder.ContainsKey(o-1)&&_ReportViewModel.SetCellValue(_.DataFormat.STUnder[o-1].Caption,_.DataFormat,"STRING",o,l[a].Cells[n-1])),_.DataFormat.ShowAvg){if(!(s.iCurrGroupDetailRows>0))return"continue";r/=s.iCurrGroupDetailRows}i=l[a],_ReportViewModel.SetCellValue(r,_.DataFormat,"FLOAT",o,i.Cells[n]),i.Cells[n].DataFormat=t.SubTotalFormat,s.ReportColumns[n].DataAppearance.Alignment==t.SubTotalAppearance_Data.Alignment?i.Cells[n].CellAppearance=t.SubTotalAppearance_Data:(i.Cells[n].CellAppearance=t.SubTotalAppearance_Data.Clone(),i.Cells[n].CellAppearance.Alignment=s.ReportColumns[n].DataAppearance.Alignment),i.Cells[n].Border=t.SubTotalBorder,i.Cells[n].IsNormal=!1,t.SubTotalHeight>0&&(i.Cells[n].height=t.SubTotalHeight)},T=0;T<t.TotalCols.keys.length;T++){var _;p(T)}this.iCurrGroupDetailRows=0}else{if(this.TopRecords>0&&!this.IsDefaultSortColumnExists&&this.iGroupRowsAdded>=this.TopRecords){for(var m=0;m<this.ReportColumns.length;m++)this.totals[m][o-1]+=this.totals[m][o],this.totals[m][o]=0;for(var I=0;I<this.HiddenNumericColumns.length;I++)this.hiddenTotals[I][o-1]+=this.hiddenTotals[I][o],this.hiddenTotals[I][o]=0;return this.lstSummaryAplha.values.map((function(e){return e.Clear()})),this.lstSummaryDistinctNumeric.values.map((function(e){return e.Clear()})),void this.lstSummaryCells.values.map((function(e){return e.Clear()}))}var R;c.Type=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Detail;var S=null;if(null!=this.ReportSummaryData){S={};for(var A=0;A<this.lstGroup.length;A++)Object(util__WEBPACK_IMPORTED_MODULE_24__.isUndefined)(e[this.lstGroup[A].ID])||(S[this.lstGroup[A].ID]=e[this.lstGroup[A].ID]);this.ColumnSourceALL.forEach((function(t){"FLOAT"==t.ColumnType||Object(util__WEBPACK_IMPORTED_MODULE_24__.isUndefined)(e[t.ID])||(S[t.ID]=e[t.ID],Object(util__WEBPACK_IMPORTED_MODULE_24__.isUndefined)(e[t.ID+"_ID"])||(S[t.ID+"_ID"]=e[t.ID+"_ID"]),Object(util__WEBPACK_IMPORTED_MODULE_24__.isUndefined)(e[t.ID+"_DID"])||(S[t.ID+"_DID"]=e[t.ID+"_DID"]))}))}if(!this.IsFilterRendering&&this.FormulaColumns.length>0)for(var M=0;M<this.FormulaColumns.length;M++){var g=this.FormulaColumns[M];if((""!=g.Formula||""!=g.ColumnFilterExpression)&&1==g.EvaluateAtEnd){r=0,null;for(var w=0;w<this.ReportColumns.length;w++)(t.TotalCols.ContainsKey(this.ReportColumns[w].ID)||"FLOAT"==this.ReportColumns[w].ColumnType||"INT"==this.ReportColumns[w].ColumnType)&&(Object(util__WEBPACK_IMPORTED_MODULE_24__.isUndefined)(e[this.ReportColumns[w].ID])||(e[this.ReportColumns[w].ID]=this.totals[w][o]));for(var f=0;f<this.HiddenNumericColumns.length;f++)e[this.HiddenNumericColumns[f].ID]=this.hiddenTotals[f][o];if(this.CalculateFormulaForSummary(g,e)){for(var E=0;E<this.ReportColumns.length;E++)this.totals[E][o]=0;for(var P=0;P<this.HiddenNumericColumns.length;P++)this.hiddenTotals[P][o]=0;return this.lstSummaryAplha.values.map((function(e){return e.Clear()})),this.lstSummaryDistinctNumeric.values.map((function(e){return e.Clear()})),void this.lstSummaryCells.values.map((function(e){return e.Clear()}))}_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(g.Formula)||t.TotalCols.ContainsKey(g.ID)&&(r=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(e[g.ID]),this.totals[t.TotalCols[g.ID]][o]=r)}}for(var y=0;y<this.ReportColumns.length;y++){if(null==l[this.ReportColumns[y].Row]&&(l[this.ReportColumns[y].Row]=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(this.ReportColumns.length,t.SubTotalHeight),l[this.ReportColumns[y].Row].Type=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.SubTotal,l[this.ReportColumns[y].Row].LevelNo=o),i=l[this.ReportColumns[y].Row],n=0==this.ReportColumns[y].Row?y:this.ReportColumns[y].Column,R=null,t.TotalCols.ContainsKey(this.ReportColumns[y].ID)?R=this.totals[t.TotalCols[this.ReportColumns[y].ID]][o]:Object(util__WEBPACK_IMPORTED_MODULE_24__.isUndefined)(e[this.ReportColumns[y].ID])||(R=e[this.ReportColumns[y].ID]),"DATE"==this.ReportColumns[y].ColumnType){if(this.lstSummaryCells.ContainsKey(this.ReportColumns[y].ID)&&this.lstSummaryCells[this.ReportColumns[y].ID].length>0&&(0==this.ReportColumns[y].EvaluateAtEnd||_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.ReportColumns[y].Formula))){if(R=this.lstSummaryCells[this.ReportColumns[y].ID][0].Value,this.lstSummaryCells[this.ReportColumns[y].ID].Count>1){null!=S&&(S[this.ReportColumns[y].ID]=R),this.sbSummaryDimensions="";for(var O=0;O<this.lstSummaryCells[this.ReportColumns[y].ID].length;O++)O>0&&(this.sbSummaryDimensions+=","),this.sbSummaryDimensions+=this.lstSummaryCells[this.ReportColumns[y].ID][O].Value.toString();this.lstSummaryCells[this.ReportColumns[y].ID].Clear(),R=this.sbSummaryDimensions.toString(),_ReportViewModel.SetCellValue(R,this.ReportColumns[y].DataFormat,this.ReportColumns[y].ColumnType,o,i.Cells[n]);continue}this.lstSummaryCells[this.ReportColumns[y].ID].Clear()}}else if(this.lstSummaryAplha.ContainsKey(this.ReportColumns[y].ID)&&this.lstSummaryAplha[this.ReportColumns[y].ID].length>0||this.lstRepeatSummaryAplha.ContainsKey(this.ReportColumns[y].ID)&&this.lstRepeatSummaryAplha[this.ReportColumns[y].ID].length>0){var b=void 0;if(b=this.lstSummaryAplha.ContainsKey(this.ReportColumns[y].ID)&&this.lstSummaryAplha[this.ReportColumns[y].ID].length>0?this.lstSummaryAplha[this.ReportColumns[y].ID]:this.lstRepeatSummaryAplha[this.ReportColumns[y].ID],"FLOAT"!=this.ReportColumns[y].ColumnType&&"INT"!=this.ReportColumns[y].ColumnType&&(0==this.ReportColumns[y].EvaluateAtEnd||_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.ReportColumns[y].Formula))){this.sbSummaryDimensions="";for(var N=0;N<b.length;N++)N>0&&(this.sbSummaryDimensions+=","),this.sbSummaryDimensions+=b[N];R=this.sbSummaryDimensions.toString(),b.Clear()}}else if(-1==this.ReportColumns[y].UseOnce&&this.lstSummaryDistinctNumeric.ContainsKey(this.ReportColumns[y].ID)&&this.lstSummaryDistinctNumeric[this.ReportColumns[y].ID].length>0&&(0==this.ReportColumns[y].EvaluateAtEnd||_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.ReportColumns[y].Formula))){this.sbSummaryDimensions="";for(var V=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.c,v=0;v<this.lstSummaryDistinctNumeric[this.ReportColumns[y].ID].length;v++)v>0&&(this.sbSummaryDimensions+=","),this.SetCellValue(this.lstSummaryDistinctNumeric[this.ReportColumns[y].ID][v],this.ReportColumns[y].DataFormat,"FLOAT",V),this.sbSummaryDimensions+=V.Text;R=this.sbSummaryDimensions.toString(),this.lstSummaryDistinctNumeric[this.ReportColumns[y].ID].Clear()}if(-1!=this.ReportColumns[y].DataFormat.CumTotal){var L;L=this.totals[t.TotalCols[this.ReportColumns[y].ID]][o-1],r=L,R=L}if(-1!=this.ReportColumns[y].PrevRowValueInd&&(R=0==this.Data.length||this.Data[this.Data.length-1].Type!=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Detail?"0.0":this.Data[this.Data.length-1].Cells[this.ReportColumns[y].PrevRowValueInd].Value),null!=R&&null!=R){if(-1==this.ReportColumns[y].UseOnce){null!=S&&(S["DISTINCT"+this.ReportColumns[y].ID]=R),_ReportViewModel.SetCellValue(R,this.ReportColumns[y].DataFormat,"",o,i.Cells[n]);continue}_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.ReportColumns[y].DataFormat.PercentageOn)||(r=this.totals[t.TotalCols[this.ReportColumns[y].ID]][o],h="REPORT_TOTAL"==this.ReportColumns[y].DataFormat.PercentageOn?this.PercentTotals[y]:_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(this.totals[t.TotalCols[this.ReportColumns[y].DataFormat.PercentageOn]][o]),0!=r&&0!=h?this.IsFilterRendering?(R=r,r=h*this.totals[t.TotalCols[this.ReportColumns[y].ID]][o]/100,this.totals[t.TotalCols[this.ReportColumns[y].ID]][o]=r):R=r=100*r/h:R=null),null!=S&&(S[this.ReportColumns[y].ID]=R),_ReportViewModel.SetCellValue(R,this.ReportColumns[y].DataFormat,this.ReportColumns[y].ColumnType,o,i.Cells[n]),this.ReportColumns[y].DataFormat.PrintOnce&&this.Data.length>0&&this.Data[this.Data.length-1].LevelNo==i.LevelNo&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(i.Cells[n].Value)==_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(this.Data[this.Data.length-1].Cells[y].Value)&&(i.Cells[n].Text="")}}null!=S?(l[0].DataRow=S,t.SubTotalAppearance.IsVisible&&this.ReportSummaryData.push(S)):null!=e&&(l[0].DataRow=e)}if(this.Data.length>0&&this.Data[this.Data.length-1].Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Group&&"Detailed"==t.DisplayMode)this.IsNoDataGroups||this.removeRowAt(this.Data.length-1);else{if(t.SubTotalAppearance.IsVisible&&(this.iGroupRowsAdded++,"Summary"==t.DisplayMode&&(this.iCurrGroupDetailRows++,-1!=this.colSNoIndex&&(l[0].Cells[this.colSNoIndex].Value=++this.SNo,l[0].Cells[this.colSNoIndex].Text=this.SNo.toString()),this.ApplyKPI(l[0])),-1!=t.SubTotalHeight&&(1==l.length?null!=l[0]&&(l[0].PrintVisible=t.SubTotalAppearance.IsPrintVisible,this.addRow(l[0])):l.forEach((function(e){e&&e.Cells.find((function(e){return!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Text)}))&&(e.PrintVisible=t.SubTotalAppearance.IsPrintVisible,s.addRow(e))})))),this.MergeChildReport&&this.Data[0].Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Group&&"Summary"!=t.DisplayMode&&1==o){var B=this.ParentReport.Data.find((function(e){return e.Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Group&&e.Cells[0].Text==s.Data[0].Cells[0].Text}));if(null!=this.childReportColumnHeader&&(this.childReportColumnHeader.LevelNo=this.Data[0].LevelNo+1,this.insertRowAt(this.childReportColumnHeader,1)),null!=this.childReportTitle&&(this.childReportTitle.LevelNo=this.Data[0].LevelNo+1,this.insertRowAt(this.childReportTitle,1)),null!=B){this.removeRow(this.Data[0]);for(var F=this.ParentReport.Data.indexOf(B)+1;F<this.ParentReport.Data.length&&!(this.ParentReport.Data[F].LevelNo<=B.LevelNo);F++);this.ParentReport.PrintSeperateInSubReports&&this.ParentReport.dicSubReportStart.push(F,this.Data.length),this.Data.forEach((function(e){e.Parent=B,s.ParentReport.insertRowAt(e,F),F++}))}else if(this.ParentReport.GrpReportTotal.SubTotalAppearance.IsVisible){var G=this.ParentReport.Data.length-1;G>=0&&this.Data.forEach((function(e){s.ParentReport.insertRowAt(e,G),G++}))}else this.Data.forEach((function(e){s.ParentReport.addRow(e)}));this.Data.Clear()}null!=this.SubTotalCallBack&&this.SubTotalCallBack.Call(o)}if(this.IsSummary=!1,o>0){for(var x=0;x<this.ReportColumns.length;x++)this.ReportColumns[x].DataFormat.CumTotal<0?("$TOTALHOURS$"==this.ReportColumns[x].Formula&&0!=this.totals[x][o-1]?this.totals[x][o-1]=_ReportViewModel.GetHoursSum(this.totals[x][o-1],this.totals[x][o]):this.totals[x][o-1]+=this.totals[x][o],this.totals[x][o]=0):(o==this.ReportColumns[x].DataFormat.CumTotal&&(this.totals[x][this.lstGroup.length]=0),o==this.ReportColumns[x].DataFormat.CumTotal-1&&(this.totals[x][o]=0));for(var W=0;W<this.HiddenNumericColumns.length;W++)this.HiddenNumericColumns[W].DataFormat.CumTotal<0?(this.hiddenTotals[W][o-1]+=this.hiddenTotals[W][o],this.hiddenTotals[W][o]=0):(o==this.HiddenNumericColumns[W].DataFormat.CumTotal&&(this.hiddenTotals[W][this.lstGroup.length]=0),o==this.HiddenNumericColumns[W].DataFormat.CumTotal-1&&(this.hiddenTotals[W][o]=0))}}catch(k){Logger.ErrorLog("ReportViewModel::Error AddSubtotals",k.stack)}}},{key:"AddSubtotals_RT",value:function(e,t){var o=this;try{var s,i=!1,l=0,n=0;-100==t&&(t=0,i=!0);var a=new Array(this.MaxRowsUnder+1),r=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(this.ReportColumns.length,24);a[0]=r,e.SubTotalBorder<0&&r.Cells.map((function(t){return t.Border=e.SubTotalBorder}));var h=this.ReportColumns.find((function(t){return t.ID==e.SubTotalShowUnder})),u=0;if(h&&(u=this.ReportColumns.indexOf(h)),e.TotalCols.length>0){var c=Math.min.apply(null,e.TotalCols.values);r.Cells[u].ColSpan=c-u,r.Cells[u].ColSpan<=0&&(r.Cells[u].ColSpan=1)}for(var D=0;D<=this.MaxRowsUnder;D++)null==a[D]&&(a[D]=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(this.ReportColumns.length,24),a[D].Type=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.SubTotal,a[D].LevelNo=t+1,a[D].Cells[u].ColSpan=r.Cells[u].ColSpan,e.SubTotalBorder<0&&a[D].Cells.map((function(t){return t.Border=e.SubTotalBorder}))),s=a[D],e.SubTotalHeight>0&&(a[D].Height=e.SubTotalHeight),s.Type=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.ReportTotal,i?(s.Cells[u].Text=this.GrandTotalTextInSubReports,s.Cells[u].DataFormat=e.GroupFormat,s.Cells[u].CellAppearance=e.GroupAppearance,s.Cells[u].IsNormal=!1,s.Cells[u].level=0):D<e.SubTotalPrefix.length&&(s.Cells[u].Text=e.SubTotalPrefix[D],s.Cells[u].DataFormat=e.GroupFormat,s.Cells[u].CellAppearance=e.GroupAppearance,s.Cells[u].IsNormal=!1,s.Cells[u].level=0);for(var d=function(i){var r={Key:e.TotalCols.keys[i],Value:e.TotalCols.values[i]};if((p=o.ReportColumns.find((function(e){return e.ID==r.Key})))?l=o.totals[r.Value][t]:(p=o.HiddenNumericColumns.find((function(e){return e.ID==r.Key})),l=o.hiddenTotals[r.Value][t]),!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(p.DataFormat.PercentageOn))if("REPORT_TOTAL"==p.DataFormat.PercentageOn)l=100;else{if(n=0,e.TotalCols.ContainsKey(p.DataFormat.PercentageOn))n=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(o.totals[e.TotalCols[p.DataFormat.PercentageOn]][t]);else if(T=o.HiddenNumericColumns.find((function(e){return e.ID==p.DataFormat.PercentageOn})))try{n=o.totals[o.ReportColumns.length+o.HiddenNumericColumns.indexOf(T)][t]}catch(h){}if(0==l||0==n)return"continue";l=100*l/n}if(null==a[p.Row]&&(a[p.Row]=new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(o.ReportColumns.length,e.SubTotalHeight),e.SubTotalBorder<0&&a[p.Row].Cells.map((function(t){return t.Border=e.SubTotalBorder})),a[p.Row].Type=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.ReportTotal,a[p.Row].LevelNo=0),s=a[p.Row],u=0==p.Row?r.Value:p.Column,p.DataFormat.ShowAvg){if(!(o.iCurrGroupDetailRows>0))return"continue";l/=o.iCurrGroupDetailRows}_ReportViewModel.SetCellValue(l,p.DataFormat,"FLOAT",0,s.Cells[u]),s.Cells[u].DataFormat=e.SubTotalFormat,o.ReportColumns[u].DataAppearance.Alignment==e.SubTotalAppearance_Data.Alignment?s.Cells[u].CellAppearance=e.SubTotalAppearance_Data:(s.Cells[u].CellAppearance=e.SubTotalAppearance_Data.Clone(),s.Cells[u].CellAppearance.Alignment=o.ReportColumns[u].DataAppearance.Alignment),s.Cells[u].Border=e.SubTotalBorder,s.Cells[u].IsNormal=!1,e.SubTotalHeight>0&&(s.Cells[u].height=e.SubTotalHeight)},C=0;C<e.TotalCols.length;C++){var p,T;d(C)}if((e.SubTotalAppearance.IsVisible||i)&&(null==this.ParentReport||Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(this.Reportds.Tables[0][0].ShowTotals))&&(0==this.MaxRowsUnder?(r.PrintVisible=e.SubTotalAppearance.IsPrintVisible,this.addRow(r)):a.forEach((function(t){t&&t.Cells.find((function(e){return!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Text)}))&&(t.PrintVisible=e.SubTotalAppearance.IsPrintVisible,o.addRow(t))}))),this.IsSummary=!1,t>0)for(var _=0;_<this.ReportColumns.length;_++)this.totals[_][t-1]+=this.totals[_][t],this.totals[_][t]=0;return r}catch(m){return Logger.ErrorLog("ReportViewModel::Error Report Totals",m.stack),null}}},{key:"ApplyKPI",value:function(e){0!=this.kpiList.length&&this.kpiList.forEach((function(t){t.Apply(e)}))}},{key:"ApplyKPI_Matrix",value:function(e,t,o,s){var i=this;0!=this.kpiList.length&&this.kpiList.forEach((function(l){l.ID==o.ID&&l.Apply_Matrix(e,t,o,i.ReportColumns[s])}))}},{key:"OnButtonClick",value:function(e){return Object(tslib__WEBPACK_IMPORTED_MODULE_0__.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var o,s,i,l,n,a,r,h,u,c=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.DisplayMessage="","Refresh"!=e){t.next=4;break}this.Refresh(),t.next=109;break;case 4:if("OK_CLICK"!=e){t.next=8;break}null!=this.oReportDialog?this.oReportDialog.OnOkClick("OK"):this.Filter.OnButtonClick("OK"),t.next=109;break;case 8:if("Regenerate"!=e){t.next=12;break}null!=this.MRPFilter?this.MRPFilter.OnButtonClick("BACK"):this.RefreshVisibility&&(0==this.StaticReportType||-1==this.StaticReportType?this.ShowFilter=!0:this.ShowStaticFilter=!0),t.next=109;break;case 12:if("ShowReportFilter"!=e){t.next=16;break}this.ShowExport=!1,this.ShowQuery=!1,this.ShowTransactionQuery=!1,this.ShowLinkingQuery=!1,this.ShowMatrixPanel=!1,this.ShowReportFilter=!0,t.next=109;break;case 16:if("CancelFilter"!=e){t.next=20;break}this.ShowReportFilter=!1,this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Query||this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DocumentQuery?this.ShowQuery=!this.IsMobile:this.ReportViewType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.TransactionQuery&&this.ReportViewType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.LinkingQuery||(this.ShowTransactionQuery=!0),t.next=109;break;case 20:if("Filter"!=e&&"ClearFilter"!=e){t.next=24;break}null!=this.PostDataFetchFilterFields&&this.FilterorClear(e),t.next=109;break;case 24:if("TransactionQuery"!=e){t.next=28;break}t.next=109;break;case 28:if("CancelLinkingSubQuery"!=e){t.next=32;break}this.ShowLinkingQuery=!1,this.ShowTransactionQuery=!0,t.next=109;break;case 32:if("ShowExportScreen"!=e){t.next=36;break}this.ButtonExport.Visible&&this.ButtonExport.Enable&&(this.ShowReportFilter=!1,this.ShowQuery=!1,this.ShowTransactionQuery=!1,this.ShowLinkingQuery=!1,this.ShowMatrixPanel=!1,this.ShowExport=!0,""==this.SaveText.Text&&(this.SaveText.Text=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.PersonalSettings.ContainsKey("ReportTxtDelimiter")?"\t"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.PersonalSettings.ReportTxtDelimiter?"\\t":_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.PersonalSettings.ReportTxtDelimiter:",")),t.next=109;break;case 36:if("Export"!=e){t.next=40;break}this.Export(),t.next=109;break;case 40:if("Print"!=e){t.next=44;break}this.ExportFile("Print"),t.next=109;break;case 44:if("Email"!=e){t.next=48;break}this.Data.length>0&&((o=new _send_email_sms_SendEmailSMSViewModel__WEBPACK_IMPORTED_MODULE_35__.SendEmailSMSViewModel(!0,50,this.ReportID,this)).Subject.Text=this.ScreenName,_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.ShowDialog(o,_send_email_sms_send_email_sms_component__WEBPACK_IMPORTED_MODULE_34__.SendEmailSMSComponent)),t.next=109;break;case 48:if("SMS"!=e){t.next=52;break}this.Data.length>0&&((s=new _send_email_sms_SendEmailSMSViewModel__WEBPACK_IMPORTED_MODULE_35__.SendEmailSMSViewModel(!1,50,this.ReportID,this)).Template.Items.length>0?(s.Subject.Text=this.ScreenName,_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.ShowDialog(s,_send_email_sms_send_email_sms_component__WEBPACK_IMPORTED_MODULE_34__.SendEmailSMSComponent)):this.DisplayMessage="No SMS Templates Defined."),t.next=109;break;case 52:if("ShowMatrix"!=e){t.next=56;break}this.ShowExport=!1,this.ShowQuery=!1,this.ShowTransactionQuery=!1,this.ShowLinkingQuery=!1,this.ShowReportFilter=!1,this.ShowMatrixPanel=!0,t.next=109;break;case 56:if("SaveMatrix"!=e){t.next=60;break}this.MatrixObject.SaveMatrixReport(!1,null),t.next=109;break;case 60:if("SaveAsMatrix"!=e){t.next=65;break}i=new _save_as_dialog_SaveAsDialogViewModel__WEBPACK_IMPORTED_MODULE_47__.a(this),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.ShowDialog(i,_save_as_dialog_save_as_dialog_component__WEBPACK_IMPORTED_MODULE_48__.a,{ShowCenter:!0}).subscribe((function(e){i.IsOkClick&&c.MatrixObject.SaveMatrixReport(!0,i)})),t.next=109;break;case 65:if("ResetMatrix"!=e){t.next=69;break}this.MatrixObject.Reset(),t.next=109;break;case 69:if("CancelExport"!=e&&"CancelMatrix"!=e){t.next=73;break}this.ShowExport=!1,this.ShowMatrixPanel=!1,this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Query||this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DocumentQuery?this.ShowQuery=!this.IsMobile:this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.TransactionQuery||this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.LinkingQuery?this.ShowTransactionQuery=!0:this.ReportViewType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DashBoard&&(this.ShowReportFilter=!_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.IsMobile),t.next=109;break;case 73:if("Post"!=e){t.next=93;break}if(111!=this.StaticReportType){t.next=78;break}this.StaticReportObject.Post(),t.next=91;break;case 78:if(297!=this.ReportID){t.next=90;break}if(null!=this.TransferData){t.next=83;break}t.next=88;break;case 83:return t.next=85,__webpack_require__.e(0).then(__webpack_require__.bind(null,"Uj+z"));case 85:l=t.sent,n=l.TransferaccountComponent,_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.ShowDialog(this.TransferData,n,{Title:this.TransferData.lblText});case 88:t.next=91;break;case 90:this.IsDocMapXMLExists?(!1,(a=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f).LoadXml(this.Reportds.Tables[0][0].DocMapXML.toString()),null!=(r=a.SelectNodes("xml/AccMapPayJV"))&&r.length>0&&null!=r[0].attributes.IsMapAccForPayrollJV&&"TRUE"==r[0].attributes.IsMapAccForPayrollJV.value.toUpperCase()&&!0):this.CanSelectRows&&(this.ReturnType=1,_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.HideDialog());case 91:t.next=109;break;case 93:if("SLReconcile"!=e){t.next=97;break}this.StaticReportObject.Reconcile(),t.next=109;break;case 97:if("Approve"!=e){t.next=101;break}_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.ShowDialog(new _approve_ApproveViewModel__WEBPACK_IMPORTED_MODULE_50__.a(this),_approve_approve_component__WEBPACK_IMPORTED_MODULE_49__.a,{Title:_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("ApproveReject"),ShowCenter:!0}),t.next=109;break;case 101:if(154!=this.StaticReportType){t.next=108;break}if(confirm("Do you really want to reject notification events.")){t.next=104;break}return t.abrupt("return");case 104:h="",this.Data.forEach((function(e){h.length>0&&(h+=","),h+=e.DataRow.SchEventID.toString()})),h.length>0&&(u=_send_email_sms_Notifications__WEBPACK_IMPORTED_MODULE_53__.a.GetEmailSMS(10,0,h.toString()),this.DisplayMessage=u.Tables.length>0&&u.Tables[u.Tables.length-1].Columns.Contains("Saved")?"Rejected Successfully.":"Error in reject."),t.next=109;break;case 108:"Close"==e?(null!=this.QueryTimer&&(this.QueryTimer.Enabled=!1,this.QueryTimer=null),this.process.IsBusy&&(this.process.Cancel=!0),this.CanSelectRows&&(this.ReturnType=2),_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.HideDialog()):"ComparisonINTERQTN"==e?_pages_home_RibbonExtViewModel__WEBPACK_IMPORTED_MODULE_28__.RibbonExtViewModel.LoadDocument_VoucherNo(this.ComparisonINTERQTN):"QueryFieldRefresh"==e&&(this.QueryDimension.SelectedValue=-1,this.QueryTimer_Elapsed());case 109:case"end":return t.stop()}}),t,this)})))}},{key:"Refresh",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];0==this.StaticReportType||-1==this.StaticReportType||257==this.StaticReportType?this.LoadData(e):110==this.StaticReportType||this.oReportDialog.OnOkClick(null)}},{key:"FilterorClear_NewCode",value:function(e){var t=this;try{this.MessageVisibility=!1;var o="";if(this.IsFilterRendering=!0,this.PostFilterData=null,"ClearFilter"!=e){for(var s=function(e){var s=t.PostDataFetchFilterFields[e];if("None"!=s.Condition.SelectedValue)if("DATE"==s.DataType)"Between"==s.Condition.SelectedValue||"NotBetween"==s.Condition.SelectedValue?("NotBetween"==s.Condition.SelectedValue&&(o+=" not ("),o+="["+s.ColumnName+"] >=  convert('"+s.FromDate.Date.ToString("dd MMM yyyy")+"',System.DateTime) and  ["+s.ColumnName+"] <=  convert('"+s.ToDate.Date.ToString("dd MMM yyyy")+"',System.DateTime) ","NotBetween"==s.Condition.SelectedValue&&(o+=" ) "),o+=" and "):o+="["+s.ColumnName+"]"+s.Condition.SelectedItem.Parent+" convert('"+s.FromDate.Date.ToString("dd MMM yyyy")+"',System.DateTime) and ";else if("Between"==s.Condition.SelectedValue||"NotBetween"==s.Condition.SelectedValue)o+=t.strGetFilterText(s);else if(s.FromDropDown.Visible)if(s.FromDropDown.Items[0].IsChecked)o+=" 1=1 and ";else{var i="";i+="(",s.FromDropDown.Items.forEach((function(e){e.IsChecked&&("Equal"==s.Condition.SelectedValue?(i.length>1&&(i+=" OR "),i+=""==e.Name?"(["+s.ColumnName+"] is null or ["+s.ColumnName+"]='')":"["+s.ColumnName+"]='"+t.EscapeCharsInText(e.Name)+"'"):(i.length>1&&(i+=" and "),i+="[NULL]"==e.Name?"(["+s.ColumnName+"] is not null and ["+s.ColumnName+"]<>'')":"["+s.ColumnName+"]<>'"+t.EscapeCharsInText(e.Name)+"'"))})),1==i.length&&(i+="1!=1"),o+=(i+=") and ").toString()}else null!=s.FromValue.TextBox.Text&&""!=s.FromValue.TextBox.Text.Trim()&&(o+="Contains"==s.Condition.SelectedValue||"NotContain"==s.Condition.SelectedValue?"["+s.ColumnName+"]"+s.Condition.SelectedItem.Parent+" '%"+t.EscapeCharsInText(s.FromValue.TextBox.Text)+"%'  and ":"BeginsWith"==s.Condition.SelectedValue?"["+s.ColumnName+"] LIKE '"+t.EscapeCharsInText(s.FromValue.TextBox.Text)+"%'  and ":"EndsWith"==s.Condition.SelectedValue?"["+s.ColumnName+"] LIKE '%"+t.EscapeCharsInText(s.FromValue.TextBox.Text)+"'  and ":t.strGetFilterText(s))},i=0;i<this.PostDataFetchFilterFields.length;i++)s(i);0==o.length&&(this.MessageVisibility=!0,this.DisplayMessage="Please choose at least one condition to filter")}if(""!=o&&o.length>4||"ClearFilter"==e)if(null==this.StaticReportObject){if(null==this.ReportData)return;this.PostFilterData=this.ReportData.Copy(),"ClearFilter"==e?(this.PostDataFetchFilterFields.map((function(e){return e.Clear()})),this.PostFilterData=this.ReportData):(o=o.substr(0,o.length-4),null!=this.LevelColumn&&(o="("+o+") or IsGroup=1"),this.PostFilterData=_static_report_filter_ReportFilterDialog__WEBPACK_IMPORTED_MODULE_51__.a.FilterData(this.PostFilterData,this.PostDataFetchFilterFields),o=o.substr(0,o.length-4),null!=this.LevelColumn&&(o="("+o+") or IsGroup=1"),this.PostFilterData=_static_report_filter_ReportFilterDialog__WEBPACK_IMPORTED_MODULE_51__.a.FilterData(this.PostFilterData,this.PostDataFetchFilterFields)),this.RecordCount="Displaying "+this.PostFilterData.length.toString()+" of "+this.TotalRowCount.toString()+" Rows",this.Data.Clear(),this.totals=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.NumArray(this.ReportColumns.length,this.lstGroup.length+1),this.hiddenTotals=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.NumArray(this.HiddenNumericColumns.length,this.lstGroup.length+1);for(var l=this.lstGroup.length;l>0;l--)this.Groupstr[this.lstGroup[l-1].ID]=null;if(this.FormulasCalculated=!0,this.SNo=0,null!=this.MatrixObject&&(this.MatrixObject.MatrixRows.Items.length>0||this.MatrixObject.MatrixColumns.Items.length>0||this.MatrixObject.MatrixValues.Items.length>0))return void this.MatrixObject.LoadMatrixReport(this.PostFilterData,this.ReportDataColumns);if(this.RenderData(this.PostFilterData,this.ReportDataColumns),null!=this.LevelColumn){if(this.UpdateTreeTotals(0),this.GrpReportTotal.SubTotalAppearance.IsVisible&&this.lstTotal.length>0){this.totals=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.NumArray(this.lstTotal[0].length,1);for(var n=0;n<this.lstTotal[0].length;n++)this.totals[n][0]=this.lstTotal[0][n];this.AddSubtotals_RT(this.GrpReportTotal,0)}}else{for(var a=this.lstGroup.length;a>0;a--)this.PostFilterData.length>0&&this.AddSubtotals(this.PostFilterData[this.PostFilterData.length-1],this.lstGroup[a-1],a),this.Groupstr[this.lstGroup[a-1].ID]=null;this.GrpReportTotal.SubTotalAppearance.IsVisible&&this.AddSubtotals_RT(this.GrpReportTotal,0)}this.ApplyDefaultSort(),this.refreshDataView()}else{"ClearFilter"==e?(this.PostDataFetchFilterFields.map((function(e){return e.Clear()})),o=""):o=o.substr(0,o.length-4),this.SNo=0;try{this.StaticReportObject.LoadReportWithPostFilters(o),this.RecordCount=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Displaying")+" "+this.Data.length.toString()+" "+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Rows")}catch(r){this.DisplayMessage="Post Filter Error",Logger.ErrorLog("PostFilter Error::",r)}}}catch(r){this.DisplayMessage="Post Filter Error",Logger.ErrorLog("PostFilter Error::",r)}}},{key:"FilterorClear",value:function(e){var t=this;this.MessageVisibility=!1;var o="";if(this.IsFilterRendering=!0,this.PostFilterData=null,"ClearFilter"!=e){for(var s=function(e){var s=t.PostDataFetchFilterFields[e];if("None"!=s.Condition.SelectedValue)if("DATE"==s.DataType)"Between"==s.Condition.SelectedValue||"NotBetween"==s.Condition.SelectedValue?("NotBetween"==s.Condition.SelectedValue&&(o+=" not ("),o+="["+s.ColumnName+"] >=  convert('"+s.FromDate.Date.ToString("dd MMM yyyy")+"',System.DateTime) and  ["+s.ColumnName+"] <=  convert('"+s.ToDate.Date.ToString("dd MMM yyyy")+"',System.DateTime) ","NotBetween"==s.Condition.SelectedValue&&(o+=" ) "),o+=" and "):o+="["+s.ColumnName+"]"+s.Condition.SelectedItem.Parent+" convert('"+s.FromDate.Date.ToString("dd MMM yyyy")+"',System.DateTime) and ";else if("Between"==s.Condition.SelectedValue||"NotBetween"==s.Condition.SelectedValue)o+=t.strGetFilterText(s);else if(s.FromDropDown.Visible)if(s.FromDropDown.Items[0].IsChecked)o+=" 1=1 and ";else{var i="";i+="(",s.FromDropDown.Items.forEach((function(e){e.IsChecked&&("Equal"==s.Condition.SelectedValue?(i.length>1&&(i+=" OR "),i+=""==e.Name?"(["+s.ColumnName+"] is null or ["+s.ColumnName+"]='')":"["+s.ColumnName+"]='"+t.EscapeCharsInText(e.Name)+"'"):(i.length>1&&(i+=" and "),i+="[NULL]"==e.Name?"(["+s.ColumnName+"] is not null and ["+s.ColumnName+"]<>'')":"["+s.ColumnName+"]<>'"+t.EscapeCharsInText(e.Name)+"'"))})),1==i.length&&(i+="1!=1"),o+=(i+=") and ").toString()}else null!=s.FromValue.TextBox.Text&&""!=s.FromValue.TextBox.Text.Trim()&&(o+="Contains"==s.Condition.SelectedValue||"NotContain"==s.Condition.SelectedValue?"["+s.ColumnName+"]"+s.Condition.SelectedItem.Parent+" '%"+t.EscapeCharsInText(s.FromValue.TextBox.Text)+"%'  and ":"BeginsWith"==s.Condition.SelectedValue?"["+s.ColumnName+"] LIKE '"+t.EscapeCharsInText(s.FromValue.TextBox.Text)+"%'  and ":"EndsWith"==s.Condition.SelectedValue?"["+s.ColumnName+"] LIKE '%"+t.EscapeCharsInText(s.FromValue.TextBox.Text)+"'  and ":t.strGetFilterText(s))},i=0;i<this.PostDataFetchFilterFields.length;i++)s(i);0==o.length&&(this.MessageVisibility=!0,this.DisplayMessage="Please choose at least one condition to filter")}if(""!=o&&o.length>4||"ClearFilter"==e)if(null==this.StaticReportObject){if(null==this.ReportData)return;this.PostFilterData=this.ReportData.Copy(),"ClearFilter"==e?this.PostDataFetchFilterFields.map((function(e){return e.Clear()})):(o=o.substr(0,o.length-4),null!=this.LevelColumn&&(o="("+o+") or IsGroup=1"),this.PostFilterData=_static_report_filter_ReportFilterDialog__WEBPACK_IMPORTED_MODULE_51__.a.FilterData(this.PostFilterData,this.PostDataFetchFilterFields)),this.RecordCount="Displaying "+this.PostFilterData.length.toString()+" of "+this.TotalRowCount.toString()+" Rows",this.Data.Clear(),this.totals=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.NumArray(this.ReportColumns.length,this.lstGroup.length+1),this.hiddenTotals=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.NumArray(this.HiddenNumericColumns.length,this.lstGroup.length+1);for(var l=this.lstGroup.length;l>0;l--)this.Groupstr[this.lstGroup[l-1].ID]=null;if(this.FormulasCalculated=!0,this.SNo=0,null!=this.MatrixObject&&(this.MatrixObject.MatrixRows.Items.length>0||this.MatrixObject.MatrixColumns.Items.length>0||this.MatrixObject.MatrixValues.Items.length>0))return void this.MatrixObject.LoadMatrixReport(this.PostFilterData,this.ReportDataColumns);if(this.RenderData(this.PostFilterData,this.ReportDataColumns),null!=this.LevelColumn){if(this.UpdateTreeTotals(0),this.GrpReportTotal.SubTotalAppearance.IsVisible&&this.lstTotal.length>0){this.totals=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.NumArray(this.lstTotal[0].length,1);for(var n=0;n<this.lstTotal[0].length;n++)this.totals[n][0]=this.lstTotal[0][n];this.AddSubtotals_RT(this.GrpReportTotal,0)}}else{for(var a=this.lstGroup.length;a>0;a--)this.PostFilterData.length>0&&this.AddSubtotals(this.PostFilterData[this.PostFilterData.length-1],this.lstGroup[a-1],a),this.Groupstr[this.lstGroup[a-1].ID]=null;this.GrpReportTotal.SubTotalAppearance.IsVisible&&this.AddSubtotals_RT(this.GrpReportTotal,0)}this.ApplyDefaultSort(),this.refreshDataView()}else{"ClearFilter"==e?(this.PostDataFetchFilterFields.map((function(e){return e.Clear()})),o=""):o=o.substr(0,o.length-4),this.SNo=0;try{this.StaticReportObject.LoadReportWithPostFilters(o),this.RecordCount=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Displaying")+" "+this.Data.length.toString()+" "+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("Rows")}catch(r){this.DisplayMessage="Post Filter Error",Logger.ErrorLog("PostFilter Error::",r)}}}},{key:"strGetFilterText",value:function(e){var t=e.FromValue.TextBox.Text;"FLOAT"==e.DataType||"INT"==e.DataType?"FLOAT"!=e.DataType||t.Contains(".")||(t+=".0"):t="'"+t+"' ";var o="["+e.ColumnName+"]",s="";if("Between"==e.Condition.SelectedValue||"NotBetween"==e.Condition.SelectedValue){var i=e.ToValue.Text;"FLOAT"==e.DataType||"INT"==e.DataType?"FLOAT"!=e.DataType||i.Contains(".")||(i+=".0"):i="'"+i+"' ","NotBetween"==e.Condition.SelectedValue&&(s+=" not ("),null!=e.FromValue.TextBox.Text&&""!=e.FromValue.TextBox.Text.Trim()&&(s+=o+">=",s+=t),null!=e.ToValue.Text&&""!=e.ToValue.Text.Trim()&&(null!=e.FromValue.TextBox.Text&&""!=e.FromValue.TextBox.Text.Trim()&&(s+=" and "),s+=o+"<=",s+=i),"NotBetween"==e.Condition.SelectedValue&&(s+=" ) "),s+=" and "}else s+=o+e.Condition.SelectedItem.Parent+" ",s+=t,s+=" and ";return s}},{key:"EscapeCharsInText",value:function(e){return e.Replace("'","''")}},{key:"onColumnCheckedChanged",value:function(e){try{if(null!=e){var t=this.ReportColumns.find((function(t){return t.ID==e.ColumnName}));null!=t&&(t.HeaderAppearance.IsVisible=!!e.ShowColumn,this.Column==t&&(this.Column=null),this.Column=t,this.RefreshGridColumns.Call())}}catch(o){Logger.ErrorLog("ReportViewModel::Error onColumnCheckedChanged",o.stack)}}},{key:"onsearch",value:function(e){try{Logger.InfoLog("ReportViewModel::Entering onsearch"),null!=e&&(e.keyCode!=angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.g.ENTER&&"F3"!=e.key||""==this.SerachValue||this.Search()),Logger.InfoLog("ReportViewModel::Exiting onsearch")}catch(t){Logger.ErrorLog("ReportViewModel::Error onsearch",t.stack)}}},{key:"Search",value:function(){var e=this;try{var t=function(){Logger.InfoLog("ReportViewModel::Entring Search");var t=e.SerachValue.toLowerCase(),o=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(e.OptionIndexObj.SelectedValue),s=0;null!=e.SelectedRow&&(s=e.Data.indexOf(e.SelectedRow)),-1==s&&(s=0);for(var i=0;i<e.Data.length;i++)if(s<e.Data.length-1?s++:s=0,e.SearchColumns.SelectedIndex>0)switch(o){case 0:if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Data[s].Cells[e.SearchColumns.SelectedIndex-1].Text)&&e.Data[s].Cells[e.SearchColumns.SelectedIndex-1].Text.toLowerCase()==t)return{v:void e.SelectSearchNode(e.Data[s],e.SearchColumns.SelectedIndex-1)};break;case 1:if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Data[s].Cells[e.SearchColumns.SelectedIndex-1].Text)&&e.Data[s].Cells[e.SearchColumns.SelectedIndex-1].Text.toLowerCase()!=t)return{v:void e.SelectSearchNode(e.Data[s],e.SearchColumns.SelectedIndex-1)};break;case 2:if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Data[s].Cells[e.SearchColumns.SelectedIndex-1].Text)&&e.Data[s].Cells[e.SearchColumns.SelectedIndex-1].Text.toLowerCase().startsWith(t))return{v:void e.SelectSearchNode(e.Data[s],e.SearchColumns.SelectedIndex-1)};break;case 3:if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Data[s].Cells[e.SearchColumns.SelectedIndex-1].Text)&&e.Data[s].Cells[e.SearchColumns.SelectedIndex-1].Text.toLowerCase().endsWith(t))return{v:void e.SelectSearchNode(e.Data[s],e.SearchColumns.SelectedIndex-1)};break;case 4:if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Data[s].Cells[e.SearchColumns.SelectedIndex-1].Text)&&e.Data[s].Cells[e.SearchColumns.SelectedIndex-1].Text.toLowerCase().Contains(t))return{v:void e.SelectSearchNode(e.Data[s],e.SearchColumns.SelectedIndex-1)};break;case 5:if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Data[s].Cells[e.SearchColumns.SelectedIndex-1].Text)&&!e.Data[s].Cells[e.SearchColumns.SelectedIndex-1].Text.toLowerCase().Contains(t))return{v:void e.SelectSearchNode(e.Data[s],e.SearchColumns.SelectedIndex-1)}}else switch(o){case 0:if(e.Data[s].Cells.find((function(e){return!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Text)&&e.Text.toLowerCase()==t}))){for(var l=0;l<e.Data[s].Cells.length;l++)if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Data[s].Cells[l].Text)&&e.Data[s].Cells[l].Text.toLowerCase()==t){e.SelectSearchNode(e.Data[s],l);break}return{v:void 0}}break;case 1:if(e.Data[s].Cells.find((function(e){return!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Text)&&e.Text.toLowerCase()!=t}))){for(var n=0;n<e.Data[s].Cells.length;n++)if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Data[s].Cells[n].Text)&&e.Data[s].Cells[n].Text.toLowerCase()!=t){e.SelectSearchNode(e.Data[s],n);break}return{v:void 0}}break;case 2:if(e.Data[s].Cells.find((function(e){return!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Text)&&e.Text.toLowerCase().startsWith(t)}))){for(var a=0;a<e.Data[s].Cells.length;a++)if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Data[s].Cells[a].Text)&&e.Data[s].Cells[a].Text.toLowerCase().startsWith(t)){e.SelectSearchNode(e.Data[s],a);break}return{v:void 0}}break;case 3:if(e.Data[s].Cells.find((function(e){return!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Text)&&e.Text.toLowerCase().endsWith(t)}))){for(var r=0;r<e.Data[s].Cells.length;r++)if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Data[s].Cells[r].Text)&&e.Data[s].Cells[r].Text.toLowerCase().endsWith(t)){e.SelectSearchNode(e.Data[s],r);break}return{v:void 0}}break;case 4:if(e.Data[s].Cells.find((function(e){return!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Text)&&e.Text.toLowerCase().Contains(t)}))){for(var h=0;h<e.Data[s].Cells.length;h++)if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Data[s].Cells[h].Text)&&e.Data[s].Cells[h].Text.toLowerCase().Contains(t)){e.SelectSearchNode(e.Data[s],h);break}return{v:void 0}}break;case 5:if(!e.Data[s].Cells.find((function(e){return!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Text)&&e.Text.toLowerCase().Contains(t)}))){for(var u=0;u<e.Data[s].Cells.length;u++)if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Data[s].Cells[u].Text)&&e.Data[s].Cells[u].Text.toLowerCase().Contains(t)){e.SelectSearchNode(e.Data[s],u);break}return{v:void 0}}}Logger.InfoLog("ReportViewModel::Exiting Search")}();if("object"==typeof t)return t.v}catch(o){Logger.ErrorLog("ReportViewModel::Error Search",o)}}},{key:"SelectSearchNode",value:function(e,t){this.AllowDrop=!0,e.Cells[t].IsSelected=!0,this.SelectedRow=e;var o=this.Data.indexOf(e);this.angularGrid&&this.angularGrid.slickGrid.setActiveCell(o,t)}},{key:"Export",value:function(){this.DisplayMessage="",this.Reportds.Tables[0][0].ReportName=this.ScreenName,this.SaveXLS.IsChecked?this.ExportFile("Excel"):this.SaveXLSX.IsChecked?this.ExportFile("OpenXML"):this.SavePDF.IsChecked&&this.ExportFile("PDF")}},{key:"AuditLog",value:function(e){}},{key:"ExportFile",value:function(e){var t=this;this.DisplayMessage="Print"==e?"Printing data please wait...":"Exporting data please wait...";var o,s={};this.InitPrintOrExport(s),s.Type=e,s.PrintDataOnSeperatePageBy=this.Preferences.ContainsKey("PrintDataOnSeperatePageBy")?this.Preferences.PrintDataOnSeperatePageBy:"","PDF"==e?s.lst=this.Get_lstGroupIndex():"Print"==e?(s.lst=this.Get_lstGroupIndex(),s.Type="PDF"):"Excel"!=e&&"OpenXML"!=e||(s.lst=this.lstGroupIndex),this.ReportColumns.forEach((function(e){t.angularGrid.slickGrid.getColumns().filter((function(t){return t.id==e.ID})).length>0&&(e.width=t.angularGrid.slickGrid.getColumns().find((function(t){return t.id==e.ID})).width)}));var i=[];if(this.Data.filter((function(e){return null!=e.DataRow})).length>0){o=this.Data.filter((function(e){return null!=e.DataRow}));for(var l=0;l<o.length;l++)i.push(o[l].DataRow),i[l].Row_Seq=o[l].id}_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ExportReport(this.Data.filter((function(e){return e.Visible})),this.ReportColumns,s,this.ScreenName,this.ColumnSourceALL,i).subscribe((function(o){console.log(o),"Print"==e?_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.printTab(o.FileName):(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Download(o.FileName,"khasim"),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(o.Message)&&!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(o.FileName)&&(t.DisplayMessage="Exported Successfully","OpenXML"==e&&(e="Excel"),t.AuditLog(e)))}),(function(e){console.log(e)}))}},{key:"EmailSMSReport",value:function(e){var t=this;this.DisplayMessage="Sending "+e.Type+" please wait...",this.InitPrintOrExport(e),e.ReportID=this.Reportds.Tables[0][0].ReportID,e.PrintDataOnSeperatePageBy=this.Preferences.ContainsKey("PrintDataOnSeperatePageBy")?this.Preferences.PrintDataOnSeperatePageBy:"",e.lst=this.lstGroupIndex,_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.EmailSMSReport(this.Data.filter((function(e){return e.Visible})),this.ReportColumns,e).subscribe((function(e){console.log(e),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Message)||(t.DisplayMessage=e.Message),e.IsSuccess&&_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.HideDialog()}),(function(e){console.log(e)}))}},{key:"InitPrintOrExport",value:function(e){e.ReportID=this.Reportds.Tables[0][0].ReportID,1==this.PrintonLang&&2==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LanguageID&&(e.IsRTL=!0);var t=null;t=this.oReportDialog instanceof _static_report_filter_StaticReportFilterViewModel__WEBPACK_IMPORTED_MODULE_20__.a?this.oReportDialog:null!=this.MRPFilter?this.MRPFilter:this.Filter;var o=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.c;if(null!=this.Filter&&t.CostCenterFilters.forEach((function(e){if(e.SelectedNodes.length>0&&e.CostCenterID>5e4){for(var t="",s=0;s<e.SelectedNodes.length;s++)s>0&&(t+=","),t+=e.SelectedNodes[s].Id;o.Add(e.CostCenterID,t)}})),e.DimensionFiltersKeys=o.keys,e.DimensionFiltersValues=o.values,this.oReportDialog instanceof _static_report_filter_StaticReportFilterViewModel__WEBPACK_IMPORTED_MODULE_20__.a){if(e.FromDate=this.oReportDialog.FromDate.Date.ToString("dd/MMM/yyyy"),e.ToDate=this.oReportDialog.ToDate.Date.ToString("dd/MMM/yyyy"),this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere){if(e.DimensionFiltersKeys.Contains(this.oReportDialog.Locations.DBColumnID)){var s;s=o.keys.indexOf(this.oReportDialog.Locations.DBColumnID),e.DimensionFiltersKeys.Remove(this.oReportDialog.Locations.DBColumnID),e.DimensionFiltersValues.RemoveAt(s),o.keys.Remove(this.oReportDialog.Locations.DBColumnID),o.values.RemoveAt(s)}_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.oReportDialog.LocationWhere)?o.Add(this.oReportDialog.Locations.DBColumnID,"-1"):o.Add(this.oReportDialog.Locations.DBColumnID,this.oReportDialog.LocationWhere),e.DimensionFiltersKeys=o.keys,e.DimensionFiltersValues=o.values}}else if("MRPViewModel"==(null==t?void 0:t.ClassName))e.FromDate=this.MRPFilter.FromDate.Date.ToString("dd/MMM/yyyy"),e.ToDate=this.MRPFilter.ToDate.Date.ToString("dd/MMM/yyyy");else if(null!=this.Filter)for(var i=0;i<this.Filter.Fields.length;i++){var l=this.Filter.Fields[i];if("DATE"==l.CDGDO.DataType){l.FromDatePicker.Visible&&(e.FromDate=l.FromDatePicker.Date.ToString("dd/MMM/yyyy")),l.ToDatePicker.Visible&&(e.ToDate=l.ToDatePicker.Date.ToString("dd/MMM/yyyy"));break}}if(this.Preferences.ContainsKey("PrintEachAccountOnSeparatePage")&&"1"==this.Preferences.PrintEachAccountOnSeparatePage){e.PrintAccountOnSeperatePage=!0;var n=null==t?void 0:t.CostCenterFilters.find((function(e){return 2==e.CostCenterID}));n&&1==n.SelectedNodes.length&&(e.DimensionFiltersKeys.push(n.CostCenterID),e.DimensionFiltersValues.push(n.SelectedNodes[0].Id.toString()))}this.Preferences.ContainsKey("PrintAccountIndex")&&"1"==this.Preferences.PrintAccountIndex&&(e.PrintPageIndex=!0),this.MatrixObject&&this.MatrixObject.MatrixValues.Items.length>0&&(e.MatrixValuesCount=this.MatrixObject.MatrixValues.Items.length,this.MatrixObject.MatrixColumns.Items.length>0&&(e.MatrixColumnsCount=this.MatrixObject.MatrixColumns.Items.length))}},{key:"Get_lstGroupIndex",value:function(){var e=[],t=this.Preferences.ContainsKey("PrintDataOnSeperatePageBy")?this.Preferences.PrintDataOnSeperatePageBy:"";if("ROW"==t)for(var o=0;o<this.Data.length;o++)this.Data[o].Visible&&this.Data[o].PrintVisible&&e.push(o);else if("GROUP"==t||"GROUP2"==t)for(var s="GROUP2"==t?1:0,i=0;i<this.Data.length;i++)this.Data[i].Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Group&&this.Data[i].LevelNo==s&&this.Data[i].Visible&&this.Data[i].PrintVisible&&e.push(i);else for(var l=0;l<this.lstGroupIndex.length;l++)e.push(this.lstGroupIndex[l]);return e}},{key:"OnQueryReportClick",value:function(e){if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNum(e)&&(e=this.QueryReports.find((function(t){return t.DBColumnID==parseInt(e)}))),e instanceof _shared_models_controls_PactButtonData__WEBPACK_IMPORTED_MODULE_10__.a){var t=e;this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Query&&(this.IsProductGroupLevel="1"==t.GroupName),112==t.Action||165==t.Action?(this.ReportID=t.DBColumnID,this.StaticReportType=t.Action,this.DisplayName=t.Label,this.ShowReorderReportFromQuery(t.DBColumnID)):1!=t.CrFilter&&null!=this.QueryReportPref&&this.QueryReportPref.ContainsKey(t.DBColumnID)?this.QueryReportPref[t.DBColumnID].ContainsKey("OpenIn")&&"1"==this.QueryReportPref[t.DBColumnID].OpenIn?this.ShowInPopup(t):this.QueryReportPref[t.DBColumnID].ContainsKey("OpenIn")&&"2"==this.QueryReportPref[t.DBColumnID].OpenIn?this.ShowInNewTab(t):this.OnReportClick(t.DBColumnID,t.Action):this.OnReportClick(t.DBColumnID,t.Action)}}},{key:"ShowInPopup",value:function(e){}},{key:"ShowInNewTab",value:function(e){}},{key:"QueryTimer_Elapsed",value:function(){var e=this;if(null!=this.QueryReports){var t=this.QueryReports.find((function(t){return t.DBColumnID==e.ReportID}));t&&(t.CrFilter=1,this.OnQueryReportClick(t),t.CrFilter=0)}}},{key:"ShowReorderReportFromQuery",value:function(e){var t;null==this.QueryMasterScreen&&(this.QueryMasterScreen=new Array),1==this.QueryMasterScreen.length&&this.QueryMasterScreen[0]instanceof _re_order_level_ReOrderLevelNewViewModel__WEBPACK_IMPORTED_MODULE_40__.ReOrderLevelNewViewModel?t=this.QueryMasterScreen[0]:(t=new _re_order_level_ReOrderLevelNewViewModel__WEBPACK_IMPORTED_MODULE_40__.ReOrderLevelNewViewModel("",e,null),this.QueryMasterScreen.push(t)),this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Query&&(this.QueryDimension.LocationID=this.QueryDimension.SelectedValue,this.DocumentFilters[this.QueryDimension.CCID.toString()]=this.QueryDimension.SelectedValue.toString()),this.ShowMasters=!0}},{key:"OnReportClick",value:function(e,t){var o=this;if(this.ReportVisibility=!0,this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Query&&(this.DocumentFilters.Clear(),this.DocumentFilters.push(this.QueryDimension.CCID.toString(),""),"TRUE"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["LW  Login"].toString().toUpperCase()&&0!=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID&&this.DocumentFilters.push("50002",_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID.toString()),this.QueryDimension.LocationID=this.QueryDimension.SelectedValue,3==this.QueryDimension.CCID?0!=this.QueryDimension.SelectedValue&&(this.DocumentFilters[this.QueryDimension.CCID.toString()]=this.QueryDimension.SelectedValue.toString()):this.DocumentFilters[this.QueryDimension.CCID.toString()]=this.QueryDimension.SelectedValue.toString(),null!=this.QueryFilterFields&&this.QueryFilterFields.length>0&&this.QueryReportPref.ContainsKey(parseInt(e))&&this.QueryFilterFields.forEach((function(t){0!=t.SelectedValue&&o.QueryReportPref[parseInt(e)].ContainsKey("D"+t.CCID)&&(o.DocumentFilters.ContainsKey(t.CCID.toString())?o.DocumentFilters[t.CCID.toString()]=t.SelectedValue.toString():o.DocumentFilters.push(t.CCID.toString(),t.SelectedValue.toString()))}))),parseInt(e)!=this.ReportID){if(this.DisplayMessage="",null!=this.MatrixObject&&this.MatrixObject.Reset(),null!=this.QueryTimer&&(this.QueryTimer.Enabled=!1),null!=this.DocumentObject){var s={strXML:""};if(this.DisplayMessage=this.DocumentObject.GetReportFilterXML(e,s),this.DisplayMessage.length>0)return;this.LoadDocFilterXML(s.strXML)}this.ReportID=parseInt(e),this.ReportData=null,this.oReportDialog=null,this.LoadReportXML(null),this.Preferences.ContainsKey("SelectAllLocations")&&this.DocumentFilters.ContainsKey("50002")&&this.DocumentFilters.Remove("50002"),null==this.FieldsDialog&&(this.FieldsDialog=new _costcenter_picker_CostCenterPicker__WEBPACK_IMPORTED_MODULE_22__.CostCenterPicker("Field"),this.FieldsView=this.FieldsViewTbl=this.FieldsDialog.grData.Table),(this.StaticReportType>0||-2==this.StaticReportType)&&(this.oReportDialog=new _static_report_filter_StaticReportFilterViewModel__WEBPACK_IMPORTED_MODULE_20__.a(this)),this.Filter=new _add_edit_filter_AddEditFilterViewModel__WEBPACK_IMPORTED_MODULE_19__.a,this.Filter.AddEditFilterViewModel_1(this),null!=this.Reportds&&this.Reportds.Tables.length>0&&this.Reportds.Tables[0].length>0&&this.Filter.LoadXml(this.Reportds.Tables[0][0]);var i=this.ReportDoc.SelectSingleNode("PactRevenURpts/Filters/PreDataFetch/TreeFilter");if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(i,"FilterDef").forEach((function(e){o.QueryDimension.CCID.toString()==_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(e,"CCID")&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectSingleNodeText(e,"DefaultValues")})),0==this.StaticReportType||-1==this.StaticReportType){if(this.ShowFilter=!1,this.StaticReportObject=null,"1"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.RoleID&&50002!=this.QueryDimension.CCID&&!this.DocumentFilters.ContainsKey("50002"))for(var l=this.Filter.CostCenterFilters.length-1;l>=0;l--)if(50002==this.Filter.CostCenterFilters[l].CostCenterID){this.Filter.CostCenterFilters.RemoveAt(l);break}}else{if(this.oReportDialog.Locations.Visible&&50002==this.oReportDialog.Locations.DBColumnID)if(this.DocumentFilters.ContainsKey("50002")){this.oReportDialog.Locations.Items.map((function(e){return e.IsChecked=!1}));for(var n=0;n<this.oReportDialog.Locations.Items.length;n++){var a=this.oReportDialog.Locations.Items[n];if(a.Value==this.DocumentFilters[50002]){a.IsChecked=!0;break}}}else this.oReportDialog.Locations.Items.map((function(e){return e.IsChecked=!0}));this.DocumentFilters.ContainsKey("FROMDATE")&&(this.oReportDialog.FromDate.Date=new Date(this.DocumentFilters.FROMDATE)),this.DocumentFilters.ContainsKey("TODATE")&&(this.oReportDialog.ToDate.Date=new Date(this.DocumentFilters.TODATE)),null==this.ReportViewFrom&&(this.HideCostCenterTree=!this.DocumentFilters.ContainsKey(this.oReportDialog.TreeCCID.toString()))}null!=this.QueryTimer&&null!=this.QueryReportPref&&this.QueryReportPref.ContainsKey(this.ReportID)&&this.QueryReportPref[this.ReportID].ContainsKey("Refresh")&&(this.QueryTimer.Interval=60*parseFloat(this.QueryReportPref[this.ReportID].Refresh)*1e3,this.QueryTimer.Enabled=!0)}else this.Preferences.ContainsKey("SelectAllLocations")&&this.DocumentFilters.ContainsKey("50002")&&this.DocumentFilters.Remove("50002"),null!=this.oReportDialog?this.oReportDialog.CostCenterFilters.forEach((function(e){3==e.CostCenterID&&o.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DocumentQuery&&(e.IsGroupLevel=!1)})):this.Filter.CostCenterFilters.forEach((function(e){3==e.CostCenterID&&o.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DocumentQuery&&(e.IsGroupLevel=!1)}));if(0!=this.ReportID)if(this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Query?(this.QueryProductID=0,this.QueryProductCCWhere="",this.LoadQueryHeaderData(this.QueryDimension.SelectedValue),3==this.QueryDimension.CCID&&this.QueryDimension.SelectedValue>0&&!this.DispayAsPopup?(this.ScreenName=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetProductParentCode(this.QueryDimension.SelectedValue),this.ScreenName=this.ScreenName.length>0?this.ScreenName+" - "+this.Reportds.Tables[0][0].ReportName.toString():this.Reportds.Tables[0][0].ReportName.toString()):this.ScreenName=this.Reportds.Tables[0][0].ReportName.toString()):this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DocumentQuery&&3==this.QueryDimension.CCID&&(this.QueryProductID=0,this.QueryProductCCWhere="",this.LoadQueryHeaderData(this.QueryDimension.SelectedValue)),null!=this.QueryFilterFields&&this.QueryFilterFields.length>0&&this.QueryReportPref.ContainsKey(parseInt(e))&&this.DocumentFilters.keys.forEach((function(e){var t=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(e);t>0&&(o.StaticReportType>0||-2==o.StaticReportType?null==o.oReportDialog||o.oReportDialog.CostCenterFilters.find((function(e){return e.CostCenterID==t}))||o.oReportDialog.AddCostCenterFilter(t):null==o.Filter||o.Filter.CostCenterFilters.find((function(e){return e.CostCenterID==t}))||o.Filter.AddCostCenterFilter(t))})),0==this.StaticReportType||-1==this.StaticReportType)this.Filter.CostCenterFilters.forEach((function(e){if(o.DocumentFilters.ContainsKey(e.CostCenterID.toString())){null==e.SelectedNodes?e.SelectedNodes=[]:e.SelectedNodes.Clear();var t=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetNames(e.CostCenterID,o.DocumentFilters[e.CostCenterID.toString()]);if(null!=t){var s="",i=null;if(!o.DocumentFilters[e.CostCenterID.toString()].Contains(",")){var l=t.filter((function(t){return t.PK==o.DocumentFilters[e.CostCenterID.toString()]}));l.length>0&&((i=new _shared_controls_tree_TreeNode__WEBPACK_IMPORTED_MODULE_27__.a).Id=parseInt(l[0].PK),i.Text.push(l[0].Name.toString()),i.IsSelected=!0,e.SelectedNodesTag=i.Text[0],e.SelectedNodes.push(i),s=i.Text[0],t.Remove(l[0]))}t.forEach((function(t){var o=new _shared_controls_tree_TreeNode__WEBPACK_IMPORTED_MODULE_27__.a;o.Id=parseInt(t.PK),o.Text.push(t.Name.toString()),o.IsSelected=!0,o.Parent=i,e.SelectedNodesTag=o.Text[0],e.SelectedNodes.push(o),s.length<146&&(s.length>0&&(s+=", "),(s+=t.Name.toString()).length>140&&(s+=" . . ."))})),e.SelectedNodesTag=s}3!=e.CostCenterID||o.ReportViewType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DocumentQuery&&o.ReportViewType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Query||(e.IsGroupLevelVisible=!0,e.IsGroupLevel=o.IsProductGroupLevel)}})),this.AssignStaticFiletersFromQuery(),this.IsFirstCall||(this.SetQueryXMLTags(),this.LoadData()),this.IsFirstCall=!1;else if(110==this.StaticReportType||144==this.StaticReportType)this.LoadTransactionQueryData(),this.TQDocumentType.Refresh(),this.TQDocumentType.SelectedValue=this.CostCenterID;else{if(this.DocumentFilters.ContainsKey(this.oReportDialog.TreeCCID.toString())){var r=this.oReportDialog.CostCenterFilters.find((function(e){return e.CostCenterID==o.oReportDialog.TreeCCID}));null==this.oReportDialog.DefaultTreeSelectedNodes?(this.oReportDialog.DefaultTreeSelectedNodes=[],null!=r&&(r.SelectedNodes=this.oReportDialog.DefaultTreeSelectedNodes)):this.oReportDialog.DefaultTreeSelectedNodes.Clear();var h=null;if(null!=this.oReportDialog.tree&&this.oReportDialog.tree.length>0){var u=this.oReportDialog.tree[0].AllNodes.filter((function(e){return e.Id==parseInt(o.DocumentFilters[o.oReportDialog.TreeCCID.toString()])}));u.length>0&&(h=u[0])}null==h&&(this.DocumentFilters[this.oReportDialog.TreeCCID.toString()].startsWith("'")&&this.DocumentFilters[this.oReportDialog.TreeCCID.toString()].endsWith("'")?(this.DocumentFilters[this.oReportDialog.TreeCCID.toString()].Replace("'","").split(",").forEach((function(e){(h=new _shared_controls_tree_TreeNode__WEBPACK_IMPORTED_MODULE_27__.a).Id=parseInt(e),o.oReportDialog.DefaultTreeSelectedNodes.push(h)})),h.Text.push("[FILTER]")):((h=new _shared_controls_tree_TreeNode__WEBPACK_IMPORTED_MODULE_27__.a).Id=parseInt(this.DocumentFilters[this.oReportDialog.TreeCCID.toString()]),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.QueryDimension.Text)?h.Text.push("[FILTER]"):h.Text.push(this.QueryDimension.Text))),h.IsSelected=!0,this.oReportDialog.DefaultTreeSelectedNodes.push(h),null!=this.oReportDialog.tree&&this.oReportDialog.tree.length>0?this.oReportDialog.OnNodeSelected():null!=r&&(r.SelectedNodesTag=h.Text[0])}for(var c=function(e){var t=o.oReportDialog.CostCenterFilters[e];if(o.DocumentFilters.ContainsKey(t.CostCenterID.toString())){if(3!=t.CostCenterID||o.ReportViewType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DocumentQuery&&o.ReportViewType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Query||(t.IsGroupLevelVisible=!0,t.IsGroupLevel=o.IsProductGroupLevel),t.CostCenterID==o.oReportDialog.TreeCCID)return"continue";null==t.SelectedNodes?t.SelectedNodes=[]:t.SelectedNodes.Clear();var s=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetNames(t.CostCenterID,o.DocumentFilters[t.CostCenterID.toString()]);if(null!=s){var i="",l=null;if(!o.DocumentFilters[t.CostCenterID.toString()].Contains(",")){var n=s.filter((function(e){return e.PK==o.DocumentFilters[t.CostCenterID.toString()]}));n.length>0&&((l=new _shared_controls_tree_TreeNode__WEBPACK_IMPORTED_MODULE_27__.a).Id=parseInt(n[0].PK),l.Text.push(n[0].Name.toString()),l.IsSelected=!0,t.SelectedNodesTag=l.Text[0],t.SelectedNodes.push(l),i=l.Text[0],s.Remove(n[0]))}s.forEach((function(e){var o=new _shared_controls_tree_TreeNode__WEBPACK_IMPORTED_MODULE_27__.a;o.Id=parseInt(e.PK),o.Text.push(e.Name.toString()),o.IsSelected=!0,o.Parent=l,t.SelectedNodesTag=o.Text[0],t.SelectedNodes.push(o),i.length<146&&(i.length>0&&(i+=", "),(i+=e.Name.toString()).length>140&&(i+=" . . ."))})),t.SelectedNodesTag=i}}},D=0;D<this.oReportDialog.CostCenterFilters.length;D++)c(D);this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Query&&50002==this.QueryDimension.CCID&&(this.oReportDialog.Locations.Visible=!0,this.oReportDialog.Locations.Items.Clear(),this.oReportDialog.Locations.Items.push(_shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__.c.CheckedListBoxItem_5(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.GetResource("All"),"0",!1)),this.oReportDialog.Locations.Items.push(_shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__.c.CheckedListBoxItem_5(this.QueryDimension.Text,this.QueryDimension.SelectedValue.toString(),!0))),this.oReportDialog.OnOkClick(null)}}},{key:"AssignStaticFiletersFromQuery",value:function(){var e=this;this.Filter.Fields.forEach((function(t){if(e.DocumentFilters.ContainsKey(t.CDGDO.FieldValue.toString()))if("DATE"==t.CDGDO.DataType)t.FromDatePicker.Date=new Date(e.DocumentFilters[t.CDGDO.FieldValue.toString()]),t.ToDatePicker.Date=new Date(e.DocumentFilters[t.CDGDO.FieldValue.toString()]);else if(t.FromValue.Visible&&(t.FromValue.TextBox.Text=e.DocumentFilters[t.CDGDO.FieldValue.toString()]),t.ToValue.Visible&&(t.ToValue.Text=e.DocumentFilters[t.CDGDO.FieldValue.toString()]),t.FromList.Visible){var o=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(e.DocumentFilters[t.CDGDO.FieldValue.toString()]);o>0&&(t.FromList.SelectedValue=o)}}))}},{key:"OnQueryMasterClick",value:function(e){var t;if((t=e instanceof _shared_models_controls_PactLinkData__WEBPACK_IMPORTED_MODULE_15__.a?e.DBColumnID:parseInt(e))>=4e4&&t<5e4){var o={};_pages_home_RibbonExtViewModel__WEBPACK_IMPORTED_MODULE_28__.RibbonExtViewModel.DocumentObj(o,t,e.Label).then((function(e){_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.addNewTab(o)}))}else 41==t&&this.QueryTimer_Elapsed()}},{key:"LoadQueryHeaderFields",value:function(e){var t=this,o=e.filter((function(e){return!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.ReportXML)}));if(o.length>0){var s=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f;s.LoadXml(o[0].ReportXML.toString());var i=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(s.DocumentElement,"Row");if(i.length>0){this.QueryReportPref=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.c;for(var l=0;l<i.length;l++){var n=parseInt(i[l].attributes.ReportID.value);this.QueryReportPref.ContainsKey(n)||this.QueryReportPref.push(n,new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a)}}if((i=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(s.DocumentElement,"Filter")).length>0){this.QueryFilterFields=new Array,this.QueryFieldsVisibility=!0;for(var a=0,r=0,h=0;a<i.length;a++){var u=new _vptdialog_VPTDialogViewModel__WEBPACK_IMPORTED_MODULE_18__.PactQueryListBoxData(parseInt(i[a].attributes.CostCenter.value));u.Label=i[a].attributes.Caption.value,h+1>3&&(r++,h=0),u.CCID=parseInt(i[a].attributes.CostCenter.value),u.TypeID=parseInt(i[a].attributes.TypeID.value),u.Row=r,u.Column=h,null!=i[a].attributes.PickBasedOn&&(u.DependantOn=i[a].attributes.PickBasedOn.value),u.OnPactListBoxValueChanged.Subscribe(this,"OnFilterSelectionChanged"),u.LblWidth="110",this.QueryFilterFields.push(u),h+=1}this.QueryFilterFields.forEach((function(e){t.RefreshQueryFiltersWhere(e)}))}}if(3==this.QueryDimension.CCID){var c="",D=e.filter((function(e){return!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.HeaderFields)}));D.length>0&&(c=D[0].HeaderFields.toString()),c.length>0&&function(){t.dvQueryFieldsTable=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetReportFields(t.QueryDimension.CCID,0).Tables[0],t.dvQueryFields=t.dvQueryFieldsTable;var e=0,o=new _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f;o.LoadXml(c),3==t.QueryDimension.CCID&&function(){for(var s=null,i=function(i){if("26428"==o.DocumentElement.children[i].attributes.FIELDNAME.value&&null!=o.DocumentElement.children[i].attributes.VoucherXML&&o.DocumentElement.children[i].attributes.VoucherXML.value.Contains(",")){if(null==s&&(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&(e=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Maintain Dimensionwise stock"])),e>0)){var l=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetTableColumns(e);s=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataTable("RPT028",t.IsReportDB,l.TableName)}o.DocumentElement.children[i].attributes.VoucherXML.value.split(",").forEach((function(e){var t=o.DocumentElement.children[i].cloneNode(!0);t.attributes.VoucherXML.value=e;var l="#";if(null!=s){var n=s.filter((function(t){return t.NodeID==e}));n.length>0&&(l=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(n[0].Name))}t.setAttribute("DimName",l),i+1<o.DocumentElement.children.length?o.DocumentElement.insertBefore(t,o.DocumentElement.children[i+1]):o.DocumentElement.appendChild(t)})),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.RemoveChild(o.DocumentElement,o.DocumentElement.children[i])}},l=o.DocumentElement.children.length-1;l>=0;l--)i(l)}(),t.QueryFields=new Array,t.QueryFieldsVisibility=!0;for(var s=o.SelectNodes("XML/Row"),i=0,l=function(o,l,n){var h=new _shared_models_controls_PactComboBoxData__WEBPACK_IMPORTED_MODULE_9__.e(parseInt(s[o].attributes.FIELDNAME.value));h.Label=s[o].attributes.Header.value,3==t.QueryDimension.CCID&&26428==h.DBColumnID&&null!=s[o].attributes.VoucherXML&&s[o].attributes.VoucherXML.value.length>0&&(h.Label.length>0&&(h.Label+=" "),h.Label+=s[o].attributes.DimName.value,h.Dependancy=e),0==(i=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(s[o].attributes.ColSpan.value))?i=1:i>4&&(i=3),n+i>3&&(l++,n=0),h.Row=l,h.Column=n,h.ColumnSpan=i,h.IsReadOnly=!0,h.DBColumnName="C"+o.toString(),h.GroupName=s[o].attributes.VoucherXML.value,null!=s[o].attributes.DimensionsXML&&(h.DependantOn=s[o].attributes.DimensionsXML.value),null!=s[o].attributes.ExcludeUnApprovedQty&&(h.Dependantinuse=!0),t.dvQueryFields=t.dvQueryFieldsTable.filter((function(e){return e.CostCenterColID==h.DBColumnID})),h.DataType=t.dvQueryFields.length>0?_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(t.dvQueryFields[0].ColumnDataType).toUpperCase():"FLOAT","FLOAT"==h.DataType&&(h.Align="Right"),268==h.DBColumnID?(h.Visible=!1,h.IsColumnUserDefined=!1,h.Enable=!0,h.SelectionChangedCommand.Subscribe(t,"OnQueryHeaderUOMChange","Condition")):"IMAGE"==h.DataType?(h.Visible=!1,h.IsColumnUserDefined=!0,h.Enable=!1):(h.Visible=!0,h.IsColumnUserDefined=!1,h.Enable=!1),h.LblWidth="110",t.QueryFields.push(h),a=l,r=n+=i},n=0,a=0,r=0;n<s.length;n++)l(n,a,r)}(),console.log(this.QueryFields)}}},{key:"RefreshQueryFiltersWhere",value:function(e){var t=this,o=null;this.QueryFilterFields.filter((function(t){return t.DependantOn==e.CCID.toString()})).forEach((function(s){var i="";if(e.SelectedValue>0)if(s.CCID>5e4){if(null==o&&(o=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataTable("RPT029",t.IsReportDB,e.CCID.toString(),e.SelectedValue.toString())),i="(",i+=2==e.CCID?"CC.AccountID="+e.SelectedValue.toString():"CC.CCNID"+(e.CCID-5e4)+"="+e.SelectedValue.toString(),i+=" or a.NodeID IN (select CCNID"+(s.CCID-5e4)+" from COM_CCCCData WHERE CostCenterID="+e.CCID+" and NodeID="+e.SelectedValue+") ",i+=" or a.NodeID in (select NodeID from COM_CostCenterCostCenterMap with(nolock) where CostCenterID="+s.CCID+" and ParentCostCenterID="+e.CCID+" and ParentNodeID="+e.SelectedValue.toString()+")",i+=" or a.NodeID in (select ParentNodeID from COM_CostCenterCostCenterMap with(nolock) where ParentCostCenterID="+s.CCID+" and CostCenterID="+e.CCID+" and NodeID="+e.SelectedValue.toString()+")",i+=")",o.length>0&&(s.SelectedValue=parseInt(o[0]["CCNID"+(s.CCID-5e4)]),1==s.SelectedValue)){var l=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSet("RPT030",t.IsReportDB,s.CCID.toString(),e.CCID.toString(),e.SelectedValue.toString());(1==l.Tables[0].length||1==l.Tables[1].length)&&(s.SelectedValue=parseInt(o[0].NodeID))}}else 2==s.CCID&&(i="(",i+="CC.CCNID"+(e.CCID-5e4)+"="+e.SelectedValue.toString(),i+=" or a.NodeID IN (select CCNID"+(s.CCID-5e4)+" from COM_CCCCData WHERE CostCenterID="+e.CCID+" and NodeID="+e.SelectedValue+")",i+=" or (a.NodeID in (select NodeID from COM_CostCenterCostCenterMap with(nolock) where CostCenterID="+s.CCID+" and ParentCostCenterID="+e.CCID+" and ParentNodeID="+e.SelectedValue.toString()+"))",i+=" or (a.NodeID in (select ParentNodeID from COM_CostCenterCostCenterMap with(nolock) where ParentCostCenterID="+s.CCID+" and CostCenterID="+e.CCID+" and NodeID="+e.SelectedValue.toString()+"))",i+=")");s.CustomWhere=i}))}},{key:"LoadQueryHeaderData",value:function(e){var t=this,o="",s="",i=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.c;if(this.QueryFieldsVisibility&&null!=this.QueryFields&&this.QueryFields.length>0&&null!=this.dvQueryFieldsTable){var l=0;if(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&(l=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Maintain Dimensionwise stock"])),0==l&&"True"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["LW Reports"]&&(l=50002),0==l&&"True"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.EnableDivisionWise.toString()&&"True"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["DW Reports"]&&(l=50001),l>0&&i.push(l,""),this.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Query)if(0==this.StaticReportType){var n=null!=this.QueryFilterFields&&this.QueryFilterFields.length>0&&this.QueryReportPref.ContainsKey(this.ReportID)?this.QueryFilterFields.find((function(e){return e.CCID==l})):null;null!=n?(o=" AND DCC.dcCCNID"+(l-5e4)+"="+n.SelectedValue,s='<Row CostCenterID="'+l+'" NODEID="'+n.SelectedValue+'"/>'):(r=this.Filter.CostCenterFilters.find((function(e){return e.CostCenterID==l})))?(r.SelectedNodes.forEach((function(e){o.length>0&&(o+=","),o+=e.Id})),o.length>0&&(o=" AND DCC.dcCCNID"+(l-5e4)+" IN ("+o+")")):50002==l&&_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID>0?(o=" AND DCC.dcCCNID2="+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID,s='<Row CostCenterID="50002" NODEID="'+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID+'"/>'):50001==l&&_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.DivisionID>0&&(o=" AND DCC.dcCCNID1="+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.DivisionID,s='<Row CostCenterID="50001" NODEID="'+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.DivisionID+'"/>')}else 50002==l&&_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID>0?(o=" AND DCC.dcCCNID2="+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID,s='<Row CostCenterID="50002" NODEID="'+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID+'"/>'):50001==l&&_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.DivisionID>0&&(o=" AND DCC.dcCCNID1="+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.DivisionID,s='<Row CostCenterID="50001" NODEID="'+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.DivisionID+'"/>');else this.DocumentFilters.ContainsKey(l.toString())?(o=this.DocumentFilters[l.toString()]).length>0&&(o=" AND DCC.dcCCNID"+(l-5e4)+" IN ("+o+")"):50002==l&&_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID>0?(o=" AND DCC.dcCCNID2="+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID,s='<Row CostCenterID="50002" NODEID="'+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID+'"/>'):50001==l&&_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.DivisionID>0&&(o=" AND DCC.dcCCNID1="+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.DivisionID,s='<Row CostCenterID="50001" NODEID="'+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.DivisionID+'"/>');l>0&&(i[l]=o),null!=this.QueryFilterFields&&this.QueryFilterFields.length>0&&this.QueryReportPref.ContainsKey(this.ReportID)&&this.QueryFilterFields.forEach((function(e){e.CCID>5e4&&e.CCID!=l?e.SelectedValue>0?(t.QueryReportPref[t.ReportID].ContainsKey("D"+e.CCID)&&(o+=" AND DCC.dcCCNID"+(e.CCID-5e4)+"="+e.SelectedValue,s+='<Row CostCenterID="'+e.CCID+'" NODEID="'+e.SelectedValue+'"/>'),i.ContainsKey(e.CCID)||i.push(e.CCID,""),i[e.CCID]=" AND DCC.dcCCNID"+(e.CCID-5e4)+"="+e.SelectedValue):50002==e.CCID&&"True"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["LW Reports"]?_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID>0&&(t.QueryReportPref[t.ReportID].ContainsKey("D"+e.CCID)&&(o+=" AND DCC.dcCCNID2="+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID,s='<Row CostCenterID="50002" NODEID="'+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID+'"/>'),i.ContainsKey(50002)||i.push(50002,""),i[50002]=" AND DCC.dcCCNID2="+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID):50001==e.CCID&&"True"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.EnableDivisionWise.toString()&&"True"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["DW Reports"]&&_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.DivisionID>0&&(t.QueryReportPref[t.ReportID].ContainsKey("D"+e.CCID)&&(o+=" AND DCC.dcCCNID1="+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.DivisionID,s='<Row CostCenterID="50001" NODEID="'+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.DivisionID+'"/>'),i.ContainsKey(50001)||i.push(50001,""),i[50001]=" AND DCC.dcCCNID1="+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.DivisionID):2==e.CCID&&e.SelectedValue>0&&(t.QueryReportPref[t.ReportID].ContainsKey("D"+e.CCID)&&(s+='<Row CostCenterID="'+e.CCID+'" NODEID="'+e.SelectedValue+'"/>'),i.ContainsKey(2)||i.push(2,""),i[2]=e.SelectedValue.toString())}))}if(this.QueryProductID!=e||o!=this.QueryProductCCWhere)if(this.QueryProductID=e,this.QueryProductCCWhere=o,this.QueryProductCCXML=s,null==this.QueryFields||0!=e&&-1!=e){var a,r;if(this.QueryFieldsVisibility&&null!=this.QueryFields&&this.QueryFields.length>0&&null!=this.dvQueryFields)!function(){(a=t.QueryFields.find((function(e){return 268==e.DBColumnID})))&&a.GroupName!=e.toString()&&(a.ToolTipFooterDescription="IGNORE",a.Items.Clear(),a.GroupName=e.toString());var o,l,n,h=null==a||_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(a.SelectedValue)?"1":a.SelectedValue,u="",c="",D="";t.sbQueryFields="",t.sbQueryFields+="DECLARE @ID BIGINT,@Query NVARCHAR(MAX),@CCWHERE NVARCHAR(MAX),@ToDate DATETIME,@AvgRate FLOAT,@Temp1 FLOAT,@Temp2 FLOAT,@Temp3 FLOAT\nDECLARE @TblPendingOrders AS TABLE(ProductID BIGINT,Qty FLOAT)\nset @ToDate=getdate()\nset @ID="+e+"\n",t.sbQueryFields+=t.QueryProductCCWhere.length>0?" set @CCWHERE=' INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON A.InvDocDetailsID=DCC.InvDocDetailsID "+t.QueryProductCCWhere+"'":" set @CCWHERE=''",D+="\nSELECT 1 QRYDONE",c+="INV_Product P",null==t.Entities?t.Entities=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a:t.Entities.Clear(),t.Entities.push("Product","P");for(var d=0,C=0,p=null,T=null,_=null,m=function(e){var a=t.QueryFields[e];if(11387!=a.DBColumnID){if(11388!=a.DBColumnID)if(11389!=a.DBColumnID)if(25900!=a.DBColumnID)if(26428!=a.DBColumnID)if(11393==a.DBColumnID||a.DBColumnID>=11398&&a.DBColumnID<=11402){if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(a.GroupName)){var m="";_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(a.DependantOn)||a.DependantOn.split(",").forEach((function(e){i.ContainsKey(parseInt(e))&&(m+=i[parseInt(e)])})),t.sbQueryFields+="\nDECLARE @"+a.DBColumnName+" FLOAT,@"+a.DBColumnName+"WHERE NVARCHAR(MAX) ",t.sbQueryFields+=m.length>0?" set @"+a.DBColumnName+"WHERE=' INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON A.InvDocDetailsID=DCC.InvDocDetailsID "+m+"'":" set @"+a.DBColumnName+"WHERE=''",t.sbQueryFields+="\ndelete from @TblPendingOrders\nSET @Query=dbo.fnGetPendingOrders('"+a.GroupName+"',@ID,@"+a.DBColumnName+"WHERE,'',"+(a.Dependantinuse?"1":"0")+") \nINSERT INTO @TblPendingOrders(ProductID,Qty)\nEXEC(@Query)\nselect @"+a.DBColumnName+"=sum(Qty) from @TblPendingOrders ",D+=",@"+a.DBColumnName+" "+a.DBColumnName}}else if(283!=a.DBColumnID)if(268!=a.DBColumnID){if(a.DBColumnID<0&&(Math.abs(a.DBColumnID)>=22786&&Math.abs(a.DBColumnID)<=22821||-276==a.DBColumnID||-277==a.DBColumnID)){if(t.dvQueryFields=t.dvQueryFieldsTable.filter((function(e){return e.CostCenterColID==Math.abs(a.DBColumnID)})),0==t.dvQueryFields.length)return"continue";var I=null,R="<XML>"+s+"</XML>";-276==a.DBColumnID||-277==a.DBColumnID?(R=h+"~3#"+R,null==_&&(_=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.inventory.GetPriceChart(8,t.QueryProductID,R)),I=_):Math.abs(a.DBColumnID)>=22793&&Math.abs(a.DBColumnID)<=22799||22821==Math.abs(a.DBColumnID)?(R=h+"~1#"+R,null==p&&(p=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.inventory.GetPriceChart(8,t.QueryProductID,R)),I=p):(R=h+"~2#"+R,null==T&&(T=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.inventory.GetPriceChart(8,t.QueryProductID,R)),I=T);var S=t.dvQueryFields[0].SysColumnName.toString();I.Tables.length>1&&I.Columns[1].Contains(S)&&I.Tables[1].length>0?(C=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(I.Tables[1][0][S]),D+=0!=C?","+C.ToString("N"+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.DecimalsinRate)+" "+a.DBColumnName:",P."+S+" "+a.DBColumnName):D+=",P."+S+" "+a.DBColumnName}else if(t.dvQueryFields=t.dvQueryFieldsTable.filter((function(e){return e.CostCenterColID==a.DBColumnID})),0!=t.dvQueryFields.length)if(o=t.dvQueryFields[0].SysTableName.toString(),l=t.dvQueryFields[0].SysColumnName.toString(),"INV_ProductExtended"==t.dvQueryFields[0].SysTableName.toString())if(t.Entities.ContainsKey(o)||(t.Entities.push(o,"PRODEXT"),c+=" LEFT JOIN INV_ProductExtended AS "+t.Entities[o]+" ON P.ProductID=PRODEXT.ProductID"),Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(t.dvQueryFields[0].IsForeignKey)){if(n=t.dvQueryFields[0].CostCenterName.toString()+"."+t.dvQueryFields[0].UserColumnName.toString(),!t.Entities.ContainsKey(n)){if(t.Entities.push(n,"T"+ ++d),c+=" LEFT JOIN "+t.dvQueryFields[0].ParentCostCenterSysName.toString()+" AS "+t.Entities[n]+" ON "+t.Entities[n]+"."+t.dvQueryFields[0].ParentCostCenterColSysName.toString()+"=PRODEXT."+t.dvQueryFields[0].SysColumnName.toString(),t.dvQueryFields=t.dvQueryFieldsTable.filter((function(e){return e.CostCenterColID==t.dvQueryFields[0].ParentCCDefaultColID})),0==t.dvQueryFields.length)return"continue";l=t.dvQueryFields[0].SysColumnName.toString(),D+=","+t.Entities[n]+"."+l+" "+a.DBColumnName}}else D+=",PRODEXT."+t.dvQueryFields[0].SysColumnName.toString()+" "+a.DBColumnName;else if(Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(t.dvQueryFields[0].IsForeignKey)){if(n=t.dvQueryFields[0].CostCenterName.toString()+"."+t.dvQueryFields[0].UserColumnName.toString(),t.Entities.ContainsKey(n)||(t.Entities.push(n,"T"+ ++d),0==_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.stringCompare(o,"COM_CCCCData",!0)?(t.Entities.ContainsKey("CC")||(t.Entities.push("CC","CC"),c+=" LEFT JOIN COM_CCCCData CC WITH(NOLOCK) ON CC.NodeID=P.ProductID AND CC.CostCenterID="+t.QueryDimension.CCID),c+=" LEFT JOIN "+t.dvQueryFields[0].ParentCostCenterSysName.toString()+" "+t.Entities[n]+" ON "+t.Entities[n]+"."+t.dvQueryFields[0].ParentCostCenterColSysName.toString()+"=CC."+t.dvQueryFields[0].SysColumnName.toString()):c+=" LEFT JOIN "+t.dvQueryFields[0].ParentCostCenterSysName.toString()+" AS "+t.Entities[n]+" ON "+t.Entities[n]+"."+t.dvQueryFields[0].ParentCostCenterColSysName.toString()+"="+t.Entities.Product+"."+t.dvQueryFields[0].SysColumnName.toString()),0==_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.stringCompare(o,"COM_CCCCData",!0))l="Name";else{if(t.dvQueryFields=t.dvQueryFieldsTable.filter((function(e){return e.CostCenterColID==t.dvQueryFields[0].ParentCCDefaultColID})),0==t.dvQueryFields.length)return"continue";l=t.dvQueryFields[0].SysColumnName.toString()}D+=","+t.Entities[n]+"."+l+" "+a.DBColumnName}else D+="DATE"==a.DataType?",convert(datetime,P."+l+") "+a.DBColumnName:",P."+l+" "+a.DBColumnName}else D+=",P.UOMID "+a.DBColumnName;else D+=",(SELECT top 1 [GUID]+'.'+FileExtension FROM  COM_Files WITH(NOLOCK) WHERE FeatureID=3 and  FeaturePK=@ID and IsProductImage=1) "+a.DBColumnName;else _shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(a.GroupName)||0==a.Dependancy?D+=",(SELECT ISNULL(SUM(UOMConvertedQty*VoucherType),0) FROM INV_DocDetails A WITH(NOLOCK) WHERE A.ProductID=@ID AND (VoucherType=1 OR VoucherType=-1) AND IsQtyIgnored=0) "+a.DBColumnName:D+=",(SELECT ISNULL(SUM(UOMConvertedQty*VoucherType),0) FROM INV_DocDetails A WITH(NOLOCK) \njoin COM_DocCCDATA ADCC with(nolock) on ADCC.InvDocDetailsID=A.InvDocDetailsID\nWHERE A.ProductID=@ID AND (VoucherType=1 OR VoucherType=-1) AND IsQtyIgnored=0 and ADCC.dcCCNID"+(a.Dependancy-5e4)+"="+a.GroupName+") "+a.DBColumnName;else{var A="";t.QueryProductCCWhere.length>0&&(A=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON A.InvDocDetailsID=DCC.InvDocDetailsID "+t.QueryProductCCWhere),D+=",(SELECT ISNULL(SUM(A.UOMConvertedQty*A.VoucherType),0) FROM INV_DocDetails A WITH(NOLOCK)"+A+"\nWHERE A.ProductID=@ID AND (A.VoucherType=1 OR A.VoucherType=-1) AND A.IsQtyIgnored=0) "+a.DBColumnName}else{var M=0;"TRUE"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Division AverageRate"].toUpperCase()?M=50001:"TRUE"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Location AverageRate"].toUpperCase()?M=50002:_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Maintain Dimensionwise AverageRate"].length>0&&(M=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Maintain Dimensionwise AverageRate"])),t.ReportViewType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.Query?0==t.StaticReportType?(r=t.Filter.CostCenterFilters.find((function(e){return e.CostCenterID==M})))?(r.SelectedNodes.forEach((function(e){u.length>0&&(u+=","),u+=e.Id})),u.length>0&&(u=" AND DCC.dcCCNID"+(M-5e4)+" IN ("+u+")")):50002==M&&(u=" AND DCC.dcCCNID2="+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID):"TRUE"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Division AverageRate"].toUpperCase()&&50001==t.oReportDialog.Locations.DBColumnID?u=" AND DCC.dcCCNID2="+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.DivisionID:"TRUE"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Location AverageRate"].toUpperCase()&&50002==M?u=" AND DCC.dcCCNID2="+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID:"50001"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Maintain Dimensionwise AverageRate"]?u=" AND DCC.dcCCNID2="+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.DivisionID:"50002"==_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Maintain Dimensionwise AverageRate"]&&(u=" AND DCC.dcCCNID2="+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.LocationID):t.DocumentFilters.ContainsKey(M.toString())&&((u=t.DocumentFilters[M.toString()]).length>0&&(u=" AND DCC.dcCCNID"+(M-5e4)+" IN ("+u+")")),t.sbQueryFields+="\nEXEC [spRPT_AvgRate] 0,@ID,'"+u+"','',@ToDate,@ToDate,0,0,0,0,'',0,@Temp1 OUTPUT,@AvgRate OUTPUT,@Temp2 OUTPUT,@Temp3 OUTPUT",D+=",@AvgRate "+a.DBColumnName}else if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(a.GroupName)){var g="";_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(a.DependantOn)||a.DependantOn.split(",").forEach((function(e){i.ContainsKey(parseInt(e))&&(g+="2"==e?" AND A.DebitAccount="+i[parseInt(e)]:i[parseInt(e)])})),D+=",(select TOP 1 Rate/UOMConversion from inv_docdetails A with(nolock)",g.Contains("DCC.dcCCNID")&&(D+=" inner join COM_DocCCData DCC WITH(NOLOCK) ON A.InvDocDetailsID=DCC.InvDocDetailsID"),D+=" where A.productid= @ID AND A.costcenterid IN ("+a.GroupName+") "+g+" order by A.DocDate desc) "+a.DBColumnName}}else if(!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(a.GroupName)){var w="";_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(a.DependantOn)||a.DependantOn.split(",").forEach((function(e){i.ContainsKey(parseInt(e))&&(w+="2"==e?" AND A.CreditAccount="+i[parseInt(e)]:i[parseInt(e)])})),D+=",(select TOP 1 Rate/UOMConversion from inv_docdetails A with(nolock)",w.Contains("DCC.dcCCNID")&&(D+=" inner join COM_DocCCData DCC WITH(NOLOCK) ON A.InvDocDetailsID=DCC.InvDocDetailsID"),D+=" where A.productid= @ID AND A.costcenterid IN ("+a.GroupName+") order by A.DocDate desc) "+a.DBColumnName}},I=0;I<t.QueryFields.length;I++)m(I);t.sbQueryFields+=D.toString()+" FROM "+c.toString(),t.sbQueryFields+=" WHERE P.ProductID="+e;var R=[11387,11388,11389],S=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataSet("RPT022",t.IsReportDB,t.sbQueryFields);null!=S&&S.Tables.length>0&&S.Columns[0].Contains("QRYDONE")&&S.Tables[0].length>0?t.QueryFields.forEach((function(e){if(S.Columns[0].Contains(e.DBColumnName)&&!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(S.Tables[0][0][e.DBColumnName]))if(268==e.DBColumnID);else if("FLOAT"==e.DataType&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNum(S.Tables[0][0][e.DBColumnName]))C=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(S.Tables[0][0][e.DBColumnName]),e.Text=R.Contains(e.DBColumnID)||Math.abs(e.DBColumnID)>=22786&&Math.abs(e.DBColumnID)<=22821||-276==e.DBColumnID||-277==e.DBColumnID?C.ToString("N"+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.DecimalsinRate):C.ToString("N"+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.DecimalsinQty);else if("DATE"==e.DataType)try{e.Text=new Date(S.Tables[0][0][e.DBColumnName]).ToString(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Date Format"])}catch(t){e.Text=S.Tables[0][0][e.DBColumnName].toString()}else"IMAGE"==e.DataType?e.ToolTipDescription=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.b.GetLogPath(S.Tables[0][0][e.DBColumnName].toString()):e.Text=S.Tables[0][0][e.DBColumnName].toString();else"IMAGE"==e.DataType?e.ToolTipDescription="":e.Text=""})):t.QueryFields.forEach((function(e){e.Text="#"}))}()}else this.QueryFields.forEach((function(e){"IMAGE"==e.DataType?e.ToolTipDescription="":e.Text=""}))}},{key:"LoadQueryDataOnRowSelection",value:function(){var e=this;if(this.QueryFieldsVisibility&&null!=this._SelectedRow&&null!=this._SelectedRow.DataRow)if(null!=this.QueryReportPref&&this.QueryReportPref.ContainsKey(this.ReportID)){var t="";if(Object.keys(this._SelectedRow.DataRow).Contains("ProductID"))t="ProductID";else{var o=this.BaseReportColumns.find((function(e){return("3"==e.LinkType.SelectedValue||"4"==e.LinkType.SelectedValue)&&3==(e.CDGDO.IsForeignKey?e.CDGDO.ParentCostCenterID:e.CDGDO.CategoryValue)}));o&&(t=o.ID+"_ID")}if(t.length>0&&Object.keys(this._SelectedRow.DataRow).Contains(t)&&null!=this._SelectedRow.DataRow[t]){var s=parseInt(this._SelectedRow.DataRow[t]);this.QueryReportPref[this.ReportID].ContainsKey("RefreshHeader")&&(null!=this.QueryFilterFields&&this.QueryFilterFields.length>0&&this.QueryReportPref.ContainsKey(this.ReportID)&&null!=this.QueryFilterFields&&this.QueryFilterFields.length>0&&this.QueryFilterFields.forEach((function(o){if(e.QueryReportPref[e.ReportID].ContainsKey("D"+o.CCID)){var s=e.BaseReportColumns.find((function(e){return("3"==e.LinkType.SelectedValue||"4"==e.LinkType.SelectedValue)&&(e.CDGDO.IsForeignKey?e.CDGDO.ParentCostCenterID:e.CDGDO.CategoryValue)==o.CCID}));if(null!=s){t=s.ID+"_ID";var i=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(e._SelectedRow.DataRow[t]);i>0&&o.SelectedValue!=i&&(o.SelectedValue=i)}}})),null!=this.QueryFields&&this.QueryFields.length>0&&this.LoadQueryHeaderData(s)),this.QueryReportPref[this.ReportID].ContainsKey("ProductFromReport")&&(this.QueryDimension.IsAutoLoad=!0,this.QueryDimension.SelectedValue=s)}}else if(null!=this.DocumentObject&&null!=this.QueryFields&&this.QueryFields.length>0){var i="";if(Object.keys(this._SelectedRow.DataRow).Contains("ProductID"))i="ProductID";else{var l=this.BaseReportColumns.find((function(e){return("3"==e.LinkType.SelectedValue||"4"==e.LinkType.SelectedValue)&&3==(e.CDGDO.IsForeignKey?e.CDGDO.ParentCostCenterID:e.CDGDO.CategoryValue)}));null!=l&&(i=l.ID+"_ID")}if(i.length>0&&Object.keys(this._SelectedRow.DataRow).Contains(i)){var n=parseInt(this._SelectedRow.DataRow[i]);this.LoadQueryHeaderData(n)}}}},{key:"OnQueryHeaderUOMChange",value:function(e){var t=this,o=this.QueryFields.find((function(e){return 268==e.DBColumnID}));if("IGNORE"!=o.ToolTipFooterDescription&&0!=this.QueryProductID)for(var s=0,i=null,l=null,n=null,a=function(e){var a=t.QueryFields[e];if(a.DBColumnID<0&&(Math.abs(a.DBColumnID)>=22786&&Math.abs(a.DBColumnID)<=22821||-276==a.DBColumnID||-277==a.DBColumnID)){if(t.dvQueryFields=t.dvQueryFieldsTable.filter((function(e){return e.CostCenterColID==Math.abs(a.DBColumnID)})),0==t.dvQueryFields.length)return"continue";var r=null,h="<XML>"+t.QueryProductCCXML+"</XML>";-276==a.DBColumnID||-277==a.DBColumnID?(h=o.SelectedValue+"~3#"+h,null==n&&(n=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.inventory.GetPriceChart(8,t.QueryProductID,h)),r=n):Math.abs(a.DBColumnID)>=22793&&Math.abs(a.DBColumnID)<=22799||22821==Math.abs(a.DBColumnID)?(h=o.SelectedValue+"~1#"+h,null==i&&(i=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.inventory.GetPriceChart(8,t.QueryProductID,h)),r=i):(h=o.SelectedValue+"~2#"+h,null==l&&(l=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.inventory.GetPriceChart(8,t.QueryProductID,h)),r=l);var u=t.dvQueryFields[0].SysColumnName.toString();if(r.Tables.length>1&&r.Columns[1].Contains(u)&&r.Tables[1].length>0&&0!=(s=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(r.Tables[1][0][u])))return a.Text=s.ToString("N"+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.DecimalsinRate),"continue";r.Tables.length>0&&r.Columns[0].Contains(u)&&r.Tables[0].length>0&&(s=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(r.Tables[0][0][u]),a.Text=s.ToString("N"+_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.DecimalsinRate))}},r=0;r<this.QueryFields.length;r++)a(r)}},{key:"OnDataClick",value:function(e){return Object(tslib__WEBPACK_IMPORTED_MODULE_0__.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var o,s,i,l,n,a,r,h,u,c,D,d,C,p,T,_,m,I,R,S,A,M,g,w,f=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.Column.LinkType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.Document&&e.Column.LinkType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.DocumentID&&e.Column.LinkType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.DocumentDetailID&&(null==e.Row.Cells[e.ColumnIndex].CellAppearance||"LINK_DOCUMENT"!=e.Row.Cells[e.ColumnIndex].CellAppearance.ColumnType)){t.next=4;break}-1==e.Column.LinkDimension?null==e.Row.DataRow||Object(util__WEBPACK_IMPORTED_MODULE_24__.isUndefined)(e.Row.DataRow[e.Column.ID+"_ID"])||(this.StatusDocID=parseInt(e.Row.DataRow[e.Column.ID+"_ID"])):-4==e.Column.LinkDimension?e.Row.DataRow&&!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.StringIsNullOrEmpty(e.Row.DataRow[e.Column.ID])&&_pages_home_RibbonExtViewModel__WEBPACK_IMPORTED_MODULE_28__.RibbonExtViewModel.PrintVoucher(this,e.Row.DataRow[e.Column.ID].toString()):(this._SelectedRow=e.Row,(o=new _document_viewer_DocumentViewerViewModel__WEBPACK_IMPORTED_MODULE_31__.DocumentViewerViewModel).DocumentViewerViewModel_Report(this,e,0),o.IsDocumentFound&&(-3==e.Column.LinkDimension?_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.ShowDialog(o,_document_viewer_document_viewer_component__WEBPACK_IMPORTED_MODULE_32__.DocumentViewerComponent):_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.addNewTab({component:_document_viewer_document_viewer_component__WEBPACK_IMPORTED_MODULE_32__.DocumentViewerComponent,params:{obj:o}}))),t.next=70;break;case 4:if(e.Column.LinkType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.Attachment&&(null==e.Row.Cells[e.ColumnIndex].CellAppearance||"LINK_ATTACHMENT"!=e.Row.Cells[e.ColumnIndex].CellAppearance.ColumnType)){t.next=10;break}if(this.DisplayMessage="",s="",_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmptySpace(e.Content)?e.Row.DataRow&&!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.StringIsNullOrEmpty(e.Row.DataRow[e.Column.ID+"_ID"])?s=e.Row.DataRow[e.Column.ID+"_ID"].toString():e.Row.Cells[e.ColumnIndex].Value&&(s=e.Row.Cells[e.ColumnIndex].Value.toString()):s=e.Content,s.length>0)if((i=this.BaseReportColumns.find((function(t){return t.ID==e.Column.ID})))&&11691==i.CDGDO.FieldValue){if(s.length>1){for(l="",n=s.split("*"),0,0,a=0;a<n.length;a++)(r=n[a].split("~")).length>0&&(0==a?(parseInt(r[0]),parseInt(r[1])):(l.length>0&&(l+=" and "),l+="ccnid"+(parseInt(r[0])-5e4)+"_Key="+r[1]));h=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.c,this.ReportColumns.forEach((function(t){var o;(i=f.BaseReportColumns.find((function(e){return e.ID==t.ID})))&&((o=null!=i.CDGDO.ChildCDGDO&&i.CDGDO.ChildCDGDO.IsForeignKey?i.CDGDO.ChildCDGDO.ParentCostCenterID:i.CDGDO.IsForeignKey?i.CDGDO.ParentCostCenterID:i.CDGDO.CategoryValue)>0&&!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Row.DataRow[t.ID+"_ID"])&&o>5e4&&!h.ContainsKey(o)&&h.push(o,parseInt(e.Row.DataRow[t.ID+"_ID"].toString())))}))}}else s.Contains(",")||(u=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.GetPath(s),window.open(u));t.next=69;break;case 10:if(e.Column.LinkType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.Dimension){t.next=14;break}(null!=e.Row.DataRow||e.Column.LinkDimension>0)&&(c=this.BaseReportColumns.find((function(t){return t.ID==e.Column.ID})))&&(D=null!=c.CDGDO.ChildCDGDO&&c.CDGDO.ChildCDGDO.IsForeignKey?c.CDGDO.ChildCDGDO.ParentCostCenterID:c.CDGDO.IsForeignKey?c.CDGDO.ParentCostCenterID:c.CDGDO.CategoryValue,(d=new _document_viewer_DocumentViewerViewModel__WEBPACK_IMPORTED_MODULE_31__.DocumentViewerViewModel).DocumentViewerViewModel_Report(this,e,D),d.IsDocumentFound&&(-4==e.Column.LinkDimensionView?_pages_home_RibbonExtViewModel__WEBPACK_IMPORTED_MODULE_28__.RibbonExtViewModel.PrintMaster(this,"Preview",D,d.NodeID,0,!1):_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.addNewTab({component:_document_viewer_document_viewer_component__WEBPACK_IMPORTED_MODULE_32__.DocumentViewerComponent,params:{obj:d}}))),t.next=69;break;case 14:if(e.Column.LinkType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.Report){t.next=39;break}if(this._SelectedRow=e.Row,!(null!=e.Row.DataRow&&e.Column.LinkDimension>0)){t.next=37;break}if(C=!1,null==e.Column.MappedColumnReports){t.next=27;break}p=0;case 19:if(!(p<e.Column.MappedColumnReports.length)){t.next=27;break}if(T=e.Column.MappedColumnReports[p],e.Column.LinkDimension.toString()!=T.attributes.ReportID.value){t.next=24;break}return this.OnContextMenuClick(e.Column.ID,T,e.Column),C=!0,t.abrupt("break",27);case 24:p++,t.next=19;break;case 27:if(C||null==e.Column.MappedRowReports){t.next=37;break}_=0;case 29:if(!(_<e.Column.MappedRowReports.length)){t.next=37;break}if(m=e.Column.MappedRowReports[_],e.Column.LinkDimension.toString()!=m.attributes.ReportID.value){t.next=34;break}return this.OnContextMenuClick(e.Column.ID,m,e.Column),C=!0,t.abrupt("break",37);case 34:_++,t.next=29;break;case 37:t.next=69;break;case 39:if(!(e.Column.LinkType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.Add&&e.Column.LinkDimension>0)){t.next=56;break}if(I=0,R=0,S=this.ReportColumns.find((function(e){return e.LinkType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.Document})),null!=e&&null!=e.Row&&null!=e.Row.DataRow&&""!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(e.Row.DataRow[S.ID])&&(A=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetDocumentDetailsByVoucherNo(e.Row.DataRow[S.ID].toString()),(R=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(A.obj))>0&&(A.Columns[0].Contains("CostCenterID")&&A.Tables[0].length>0?(I=parseInt(A.Tables[0][0].CostCenterID.toString()),R=parseInt(A.Tables[0][0].DocID.toString())):A.Tables.length>1&&A.Columns[1].Contains("CostCenterID")&&A.Tables[1].length>0&&(I=parseInt(A.Tables[1][0].CostCenterID.toString()),R=parseInt(A.Tables[1][0].DocID.toString())))),!(I>0&&R>0)){t.next=54;break}if(1!=e.Column.LinkDimension){t.next=48;break}M=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.c,this.ReportColumns.forEach((function(t){var o,s=f.BaseReportColumns.find((function(e){return e.ID==t.ID}));null!=s&&((o=null!=s.CDGDO.ChildCDGDO&&s.CDGDO.ChildCDGDO.IsForeignKey?s.CDGDO.ChildCDGDO.ParentCostCenterID:s.CDGDO.IsForeignKey?s.CDGDO.ParentCostCenterID:s.CDGDO.CategoryValue)>0&&""!=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(e.Row.DataRow[t.ID+"_ID"])&&o>5e4&&!M.ContainsKey(o)&&M.push(o,parseInt(e.Row.DataRow[t.ID+"_ID"].toString())))})),t.next=54;break;case 48:if(2!=e.Column.LinkDimension){t.next=54;break}return t.next=51,Promise.resolve().then(__webpack_require__.bind(null,"OvA8"));case 51:g=t.sent,(new(0,g.ReportAttachmentViewModel)).ReportAttachmentViewModel(I,R,e.Row.DataRow,this.ReportColumns);case 54:t.next=69;break;case 56:if(e.Column.LinkType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.Url){t.next=60;break}_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNullOrWhiteSpace(e.Row.Cells[e.ColumnIndex].Text)||window.open(e.Row.Cells[e.ColumnIndex].Text),t.next=69;break;case 60:if(null==e.Row.Cells[e.ColumnIndex].CellAppearance){t.next=64;break}t.next=69;break;case 64:if("LEAVE_BAR"!=e.Column.ColumnType||_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(e.Content)){t.next=69;break}if(w=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.GetDocumentDetailsByVoucherNo(e.Content),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(w.obj)>0){t.next=68;break}return t.abrupt("return");case 68:w.Tables[0].length>0?_pages_home_RibbonExtViewModel__WEBPACK_IMPORTED_MODULE_28__.RibbonExtViewModel.LoadDocument(w.Tables[0][0]):w.Tables[1].length>0&&_pages_home_RibbonExtViewModel__WEBPACK_IMPORTED_MODULE_28__.RibbonExtViewModel.LoadDocument(w.Tables[1][0]);case 69:this.SelectedRow=e.Row;case 70:case"end":return t.stop()}}),t,this)})))}},{key:"OnRowDoubleClick",value:function(e,t){var o;return Object(tslib__WEBPACK_IMPORTED_MODULE_0__.b)(this,void 0,void 0,regeneratorRuntime.mark((function s(){var i,l,n,a,r,h,u,c,D,d,C,p,T,_,m,I,R,S,A,M,g,w,f,E=this;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(null==this.DocumentObject){s.next=4;break}if(!(i=this.DocumentObject.ReportsList.find((function(e){return e.DBColumnID==E.ReportID})))||_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(i.ToolTipFooterDescription)){s.next=4;break}return s.abrupt("return",(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.HideDialog(),!0));case 4:if(!(e.NodeID>0)||e.IsGroup||_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.BackTrackType)){s.next=14;break}if(null!=this.AccountDrillDownObject){s.next=11;break}return s.next=8,__webpack_require__.e(59).then(__webpack_require__.bind(null,"APT5"));case 8:l=s.sent,n=l.AccountDrillDownViewModel,this.AccountDrillDownObject=new n(this),this.AccountDrillDownObject.Parent=this;case 11:return a=0,r="",h="","ACC_TradingReports"==this.StaticReportObject.ClassName&&1==(u=this.StaticReportObject).ReportFormat&&null!=e.Tag&&(a=parseInt(e.Tag),r=e.Cells[u.AccNameIndex].Text,h=e.Cells[u.ColumnSize+u.AccNameIndex].Text),s.abrupt("return",(this.AccountDrillDownObject.ReLoadData(e.NodeID,a,r,h),this.ShowAccountDrillDown=!0,!0));case 14:if(111!=this.StaticReportType){s.next=19;break}if(null==e.DataRow){s.next=17;break}return s.abrupt("return",(this.StaticReportObject.RowDblClick(e,t),!0));case 17:s.next=37;break;case 19:if(!this.IsDocMapXMLExists&&!this.CanSelectRows){s.next=21;break}return s.abrupt("return",(this.Reorder_DoubleClick_Index(t,e,null,null,null),!0));case 21:if(null==this.PrefetchReportTreeFilter){s.next=33;break}if(c=this.PrefetchReportTreeFilter,D=this.BaseReportColumns.find((function(e){return"VoucherNo"==e.CDGDO.Column})),d=this.BaseReportColumns.find((function(e){return"VoucherNo"==e.CDGDO.Column&&"8"==e.LinkType.SelectedValue})),112!=this.PrefetchReportTreeFilter.PrefetchReportType&&257!=this.PrefetchReportTreeFilter.PrefetchReportType){s.next=28;break}C=this.BaseReportColumns.find((function(e){return!("3"!=e.LinkType.SelectedValue&&"4"!=e.LinkType.SelectedValue||3!=e.CDGDO.ColumnCostCenterID&&3!=e.CDGDO.CategoryValue)})),s.next=31;break;case 28:if(null!=(C=this.BaseReportColumns.find((function(e){return("3"==e.LinkType.SelectedValue||"4"==e.LinkType.SelectedValue)&&(e.CDGDO.ColumnCostCenterID==c.CostCenters.SelectedItem.Seq||e.CDGDO.CategoryValue==c.CostCenters.SelectedItem.Seq||null!=e.CDGDO.ChildCDGDO&&e.CDGDO.ChildCDGDO.ColumnCostCenterID==c.CostCenters.SelectedItem.Seq)})))){s.next=31;break}return p=c.CostCenters.Items.find((function(e){return e.Value==c.CostCenters.SelectedItem.Seq.toString()})),s.abrupt("return",(this.DisplayMessage=null!=p?"Please Set '"+p.Name+"' Column As 'Link Column' in report - "+c.CostCenters.SelectedItem.Name:"'Link Column' not found in report-"+c.CostCenters.SelectedItem.Name,!0));case 31:if(C||d){if(T=null!=C?this.ReportColumns.find((function(e){return e.ID==C.ID})):null,_=null!=D?this.ReportColumns.find((function(e){return e.ID==D.ID})):null,m=null!=d?this.ReportColumns.find((function(e){return e.ID==d.ID})):null,T||m){if(!(I=c.CostCenterFilters.find((function(e){return 50==e.CostCenterID&&e.LookupTypeID==E.ReportID})))){if(I=new _costcenter_filter_CostCenterFilter__WEBPACK_IMPORTED_MODULE_29__.a(50,this.ReportID.toString(),null!=c.CostCenters?c.CostCenters.SelectedItem.Name:"",c),!(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(c.CostCenters.SelectedItem.Aliasname)||112!=this.PrefetchReportTreeFilter.PrefetchReportType&&257!=this.PrefetchReportTreeFilter.PrefetchReportType||_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.StringIsNullOrEmpty(c.CostCenters.SelectedItem.Aliasname)))for(R=c.CostCenters.SelectedItem.Aliasname.split("\x11"),S=new Array(R.length),I.Tag=S,A=function(e){var t=R[e].split("~"),o=E.ReportColumns.find((function(e){return e.ID==t[0]}));S[e]=new _re_order_level_ReOrderLevelNewViewModel__WEBPACK_IMPORTED_MODULE_40__.PrefetchReportCells,S[e].indReport=E.ReportColumns.indexOf(o),S[e].ROColID=t.length>1?t[1]:t[0]},M=0;M<R.length;M++)A(M);I.SelectedNodes=new Array,c.CostCenterFilters.push(I)}this.Reorder_DoubleClick_Index(t,e,T,null!=m?m:_,I)}}else this.DisplayMessage="Product Column Not Found. Please Set Product Column As 'Link Column'";return s.abrupt("return",!0);case 33:if(null==this.MRPII||!(null===(o=this.MRPII)||void 0===o?void 0:o.ShowAllRows)){s.next=37;break}return D=this.BaseReportColumns.find((function(e){return"VoucherNo"==e.CDGDO.Column})),d=this.BaseReportColumns.find((function(e){return"VoucherNo"==e.CDGDO.Column&&"8"==e.LinkType.SelectedValue})),g=this.BaseReportColumns.find((function(e){return!("3"!=e.LinkType.SelectedValue&&"4"!=e.LinkType.SelectedValue||3!=e.CDGDO.ColumnCostCenterID&&3!=e.CDGDO.CategoryValue)})),s.abrupt("return",(null==g?this.DisplayMessage="Product Column Not Found. Please Set Product Column As 'Link Column'":(T=this.ReportColumns.find((function(e){return e.ID==g.ID})),_=null!=D?this.ReportColumns.find((function(e){return e.ID==D.ID})):null,m=null!=d?this.ReportColumns.find((function(e){return e.ID==d.ID})):null,null==T&&null==m||this.Reorder_DoubleClick_Index(t,e,T,null!=m?m:_,null)),e.IsSelected?this.MRPII.selectedRows.push(e):this.MRPII.selectedRows.Contains(e)&&this.MRPII.selectedRows.Remove(e),!0));case 37:if(!this.IsReportCollapsable){s.next=42;break}if(!this.IsReportLoad){s.next=40;break}return s.abrupt("return",(this.OnRowDoubleClick_false(t),!1));case 40:if(e.IsGroup)e.IsExpanded?(e.IsExpanded=!1,this.CollapseGroup(e)):(e.IsExpanded=!0,this.ExpandGroup(e));else if(e.Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Group)if(e.IsExpanded)for(e.IsExpanded=!1,w=this.Data.indexOf(e)+1;w<this.Data.length&&this.Data[w].LevelNo>e.LevelNo;w++)this.Data[w].Visible=!1;else for(e.IsExpanded=!0,f=this.Data.indexOf(e)+1;f<this.Data.length&&this.Data[f].LevelNo>e.LevelNo;f++)this.Data[f].Visible=!0;this.refreshDataView();case 42:return s.abrupt("return",(this.OnRowDoubleClick_false(t),!1));case 43:case"end":return s.stop()}}),s,this)})))}},{key:"OnRowDoubleClick_false",value:function(e){var t=this;if(-1!=e){var o=this.ReportColumns[e],s=null!=o.MappedColumnReports?o.MappedColumnReports.length:0;1==(s+=null!=o.MappedRowReports?o.MappedRowReports.length:0)&&this.ContextMenuItems.forEach((function(e){var s;(null===(s=e.Tag)||void 0===s?void 0:s.attributes)&&o.ID==e.colID&&t.OnContextMenuClick(o.ID,e.Tag,o)}))}}},{key:"CollapseGroup",value:function(e){var t=this;this.Data.filter((function(t){return t.Parent==e})).forEach((function(e){e.Visible=!1,e.IsGroup&&t.CollapseGroup(e)}))}},{key:"ExpandGroup",value:function(e){var t=this;this.Data.filter((function(t){return t.Parent==e})).forEach((function(e){e.Visible=!0,e.IsGroup&&e.IsExpanded&&t.ExpandGroup(e)}))}},{key:"Reorder_DoubleClick_Index",value:function(e,t,o,s,i){var l=this;if(-100==e||-101==e||-102==e)if(-100==e){var n=this.Data.filter((function(e){return e.Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Detail&&e.IsSelected}));if(n.length>0)n.forEach((function(e){l.Reorder_DoubleClick(e,o,s,i,!0)}));else for(var a=0;a<this.Data.length;a++)this.Data[a].Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Detail&&this.Reorder_DoubleClick(this.Data[a],o,s,i,!0)}else-101==e?this.Data.forEach((function(e){e.IsSelected||e.Type!=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Detail||l.Reorder_DoubleClick(e,o,s,i,!0)})):-102==e&&this.Data.forEach((function(e){e.IsSelected&&e.Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Detail&&l.Reorder_DoubleClick(e,o,s,i,!0)}));else if(t.Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Detail)this.Reorder_DoubleClick(t,o,s,i);else if(t.Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Group){var r=this.Data.indexOf(t)+1;for(this.Reorder_DoubleClick(t,o,s,i);r<this.Data.length&&this.Data[r].LevelNo>t.LevelNo&&this.Data[r].Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Detail;r++)this.Reorder_DoubleClick(this.Data[r],o,s,i);return void(this.angularGrid&&this.angularGrid.slickGrid.invalidate())}this.angularGrid&&this.angularGrid.slickGrid.invalidate()}},{key:"Reorder_DoubleClick",value:function(e,t,o,s){var i,l=this,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=!1,r=null!=t?this.ReportColumns.indexOf(t):-1,h=null!=o?this.ReportColumns.indexOf(o):-1;if(e.IsSelected)null!=s&&(i=s.SelectedNodes.find((function(t){return t.Tag==e})),s.SelectedNodes.Remove(i)),e.IsSelected=!1,a=!0;else if(null==s)e.IsSelected=!0,a=!0;else if(!(i=s.SelectedNodes.find((function(t){return t.Tag==e})))){var u=new _shared_controls_tree_TreeNode__WEBPACK_IMPORTED_MODULE_27__.a;if(u.Tag=e,u.IsGroup=e.Type!=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Detail,!u.IsGroup&&(-1!=r?(u.Id=parseInt(e.DataRow[t.ID+"_ID"]),u.Text.push(e.Cells[r].Text)):(s.IsGroupExists=!0,u.Id=parseInt(e.DataRow[o.ID+"_DID"]),u.Text.push(e.Cells[h].Text)),u.Text.push(-1!=h?e.Cells[h].Text:null),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.hasprop(e.DataRow,"ReorderDetailsID")&&e.DataRow.ReorderDetailsID.toString().length>0?u.Text.push(e.DataRow.ReorderDetailsID.toString()):u.Text.push("0"),null!=s.Tag)){var c=s.Tag,D=new Array;c.forEach((function(t){if(t.indReport>=0){var o=new _re_order_level_ReOrderLevelNewViewModel__WEBPACK_IMPORTED_MODULE_40__.PrefetchReportCells;if(o.ROColID=t.ROColID,o.value=e.Cells[t.indReport].Value,o.Type=l.ReportColumns[t.indReport].ColumnType,l.ReportColumns[t.indReport].LinkType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.Dimension||l.ReportColumns[t.indReport].LinkType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.DimensionNode)try{o.IsDimension=!0,_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.hasprop(e.DataRow,l.ReportColumns[t.indReport].ID+"_ID")&&(o.DimensionID=parseInt(e.DataRow[l.ReportColumns[t.indReport].ID+"_ID"]))}catch(s){}D.push(o)}})),D.length>0&&(u.Tree=D)}s.SelectedNodes.push(u),e.IsSelected=!0,a=!0}if(a){null!=s&&s.RefreshSelectedNodesText();for(var d=0;d<e.Cells.length;d++)null==e.Cells[d].CellAppearance&&(e.Cells[d].CellAppearance=this.ReportColumns[d].DataAppearance.Clone()),e.Cells[d].IsNormal=!1,e.Cells[d].CellAppearance.IsBold=!!e.IsSelected;if(!n){var C=this.Data.indexOf(e);C>=0&&(this.removeRowAt(C),this.insertRowAt(e,C),this.SelectedRow=null,this.SelectedRow=e)}}}},{key:"OnContextMenuClick",value:function(e,t,o){var s=this;switch(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(t)){case"Map":return void(null!=this.SelectedRow&&null!=this.SelectedRow.DataRow&&(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.SelectedRow.DataRow[e])||_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.ShowDialog(new _document_document_flow_chart_DocumentFlowChartViewModel__WEBPACK_IMPORTED_MODULE_42__.DocumentFlowChartViewModel(!0,this.SelectedRow.DataRow[e].toString()),_document_document_flow_chart_document_flow_chart_component__WEBPACK_IMPORTED_MODULE_43__.DocumentFlowChartComponent)));case"RowDetails":if(null==this.SelectedRow||this.SelectedRow.Type!=_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Detail)return;return void _services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.ShowDialog(new _row_details_RowDetailsDialogViewModel__WEBPACK_IMPORTED_MODULE_45__.a(this),_row_details_row_details_component__WEBPACK_IMPORTED_MODULE_46__.a);case"SelectAll":return void(111==this.StaticReportType?this.StaticReportObject.SelectAllRows(o):this.OnRowDoubleClick(new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(1),-101));case"UnSelectAll":return void this.OnRowDoubleClick(new _Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.d(1),-102);case"export-excel":case"EditCreatedDate":return}if(null!=this.SelectedRow&&null!=this.SelectedRow.DataRow){var i=t,l="";l+="<XML",this.SelectedRow.IsGroup&&(l+=' GroupLevel="1"'),l+=">";var n,a=0,r=!1;if("Column"==i.tagName){if(a=parseInt(i.attributes.ReportID.value),null!=i.attributes.IsPopup&&(r="1"==i.attributes.IsPopup.value),i.attributes.MapFilter.value.length>0)if(n=e+"_ID",Object.keys(this.SelectedRow.DataRow).Contains(n)||(this.StaticReportType>0&&("AccountCode"==e||"AccountName"==e)?n="AccountID":this.StaticReportType>0&&("ProductCode"==e||"ProductName"==e)&&(n="ProductID")),"EnquiryNo"==i.attributes.MapFilter.value){var h=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.report.ReportDataTable("RPT022",this.IsReportDB,"select ID from COM_DocID with(nolock) where Docno='"+this.SelectedRow.DataRow[e].toString()+"'");h.length>0&&(l+="<Row ColID='23148' Value='"+h[0].ID.toString()+"' ValueText='"+this.SelectedRow.DataRow[e].toString()+"'/>")}else Object.keys(this.SelectedRow.DataRow).Contains(n)?l+="<Row ColID='"+i.attributes.MapFilter.value+"' Value='"+_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(this.SelectedRow.DataRow[n])+"'/>":Object.keys(this.SelectedRow.DataRow).Contains(e)&&(l+="<Row ColID='"+i.attributes.MapFilter.value+"' Value='"+_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(this.SelectedRow.DataRow[e])+"'/>")}else"RowReport"==i.tagName&&(a=parseInt(i.attributes.ID.value),null!=i.attributes.IsPopup&&(r="1"==i.attributes.IsPopup.value),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.f.SelectNodes(i,"Filters/ColumnFilter").forEach((function(e){n=e.attributes.PID.value+"_ID",_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.hasprop(s.SelectedRow.DataRow,n)||s.StaticReportType>0&&("AccountCode"==e.attributes.PID.value||"AccountName"==e.attributes.PID.value?n="AccountID":"ProductCode"==e.attributes.PID.value||"ProductName"==e.attributes.PID.value?n="ProductID":"DocumentName"==e.attributes.PID.value&&(n="TAG")),Object(util__WEBPACK_IMPORTED_MODULE_24__.isNullOrUndefined)(s.SelectedRow.DataRow[n])?Object(util__WEBPACK_IMPORTED_MODULE_24__.isNullOrUndefined)(s.SelectedRow.DataRow[e.attributes.PID.value])||(l+="<Row ColID='"+e.attributes.CID.value+"' Value='"+s.SelectedRow.DataRow[e.attributes.PID.value].toString()+"'/>"):l+="<Row ColID='"+e.attributes.CID.value+"' Value='"+s.SelectedRow.DataRow[n].toString()+"'/>"})));l+="</XML>";var u=new _ReportViewModel;u.ReportViewModel_Document(50,l.toString(),a,r,this,i),r?_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.ShowDialog(u,_report_view_component__WEBPACK_IMPORTED_MODULE_44__.ReportViewComponent,{ShowCenter:!0,HideHeader:!0}):_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.page.addNewTab({component:_report_view_component__WEBPACK_IMPORTED_MODULE_44__.ReportViewComponent,params:{obj:u}})}}},{key:"SortList",value:function(e,t){var o=this;this.IsReportLoad||([9,11,121,122,123,124,125,126,127,257].Contains(this.StaticReportType)||null!=this.LevelColumn||function(){var s=new Array,i=new Array;o.Data.forEach((function(e){i.push(e)})),o.Data.Clear();var l,n=0,a=0,r=null,h=!1,u=!1,c=!1,D=0,d=0,C=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.NumArray(o.ReportColumns.length,2),p=new Date(1900,1,1);if("FLOAT"==o.ReportColumns[e].ColumnType?h=!0:"DATE"==o.ReportColumns[e].ColumnType&&(u=!0),o.SNo=0,10==o.StaticReportType)"DocNo"==o.ReportColumns[e].ID&&(c=!0);else if(o.ReportColumns[e].LinkType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.Document||o.ReportColumns[e].LinkType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.DocumentID||o.ReportColumns[e].LinkType==_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.a.DocumentDetailID)c=!0;else{var T=o.BaseReportColumns.find((function(t){return t.ID==o.ReportColumns[e].ID}));null!=T&&"VoucherNo"==T.CDGDO.Column&&0==T.CDGDO.IsForeignKey&&(c=!0)}c&&(r=o.ReportColumns[e].ID+"Ver");for(var _=0;_<i.length;_++){var m=i[_];if(m.Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.Detail)s.push(m);else{if(s.length>0){var I=void 0;if(h)try{s.map((function(t){return t.SortData=Object(util__WEBPACK_IMPORTED_MODULE_24__.isUndefined)(t.Cells[e].Value)?0:t.Cells[e].Value})),s.SortBy([{name:"SortData",parser:parseFloat,desc:!o.IsSortAscending}]),I=s}catch(b){s.map((function(t){return t.SortData=t.Cells[e].Text})),s.SortBy([{name:"SortData",desc:!o.IsSortAscending}]),I=s}else if(u)try{s.map((function(t){return t.SortData=Object(util__WEBPACK_IMPORTED_MODULE_24__.isUndefined)(t.Cells[e].Value)?p:t.Cells[e].Value})),s.SortBy([{name:"SortData",desc:!o.IsSortAscending}]),I=s}catch(N){s.map((function(t){return t.SortData=t.Cells[e].Text})),s.SortBy([{name:"SortData",desc:!o.IsSortAscending}]),I=s}else if(c){for(var R=new Array,S=0;S<s.length;S++){var A=s[S],M=new SortVouchers;if(M.Row=A,!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(A.Cells[e].Text)){for(l=A.Cells[e].Text,null!=A.DataRow&&(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(A.DataRow[r])>1&&!l.Contains(",")&&((a=l.LastIndexOf("/"))>0&&(l=l.substr(0,a)))),n=l.length-1;n>=0&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsDigit(l[n]);n--);M.Prefix=l.substr(0,n+1),n<l.length-1&&(M.no=parseInt(l.substr(n+1)))}R.push(M)}for(R.SortBy([{name:"Prefix",desc:!o.IsSortAscending},{name:"no",desc:!o.IsSortAscending}]),I=new Array(R.length),n=0;n<R.length;n++)I[n]=R[n].Row}else s.map((function(t){return t.SortData=t.Cells[e].Text})),s.SortBy([{name:"SortData",desc:!o.IsSortAscending}]),I=s;if(-1!=o.colSNoIndex&&I.forEach((function(e){e.Cells[o.colSNoIndex].Value=++o.SNo,e.Cells[o.colSNoIndex].Text=o.SNo.toString()})),-1!=o.CumulativeIndex&&(10==o.StaticReportType&&(d=0),I.forEach((function(e){null!=e.DataRow&&Object.keys(e.DataRow).Contains(o.CumulativeColumn)&&(D=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(e.DataRow[o.CumulativeColumn]),d+=D,o.SetCellValue(d,o.ReportColumns[o.CumulativeIndex].DataFormat,"FLOAT",e.Cells[o.CumulativeIndex]))}))),o.TopRecords>0&&o.IsDefaultSortColumnExists&&!t&&o.TopRecords<I.length){for(n=0;n<o.ReportColumns.length;n++)C[n][1]=0;for(var g=0;g<o.TopRecords&&g<I.length;g++)if(o.addRow(I[g]),m.Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.SubTotal||m.Type==_Models_ReportRow__WEBPACK_IMPORTED_MODULE_7__.f.ReportTotal){for(n=0;n<o.ReportColumns.length;n++)o.TotalCols.Contains(o.ReportColumns[n].ID)&&null!=I[g].Cells[n].Value&&(C[n][1]+=parseFloat(I[g].Cells[n].Value));for(n=0;n<o.ReportColumns.length;n++)o.TotalCols.Contains(o.ReportColumns[n].ID)&&null!=m.Cells[n].Value&&_ReportViewModel.SetCellValue(C[n][1],o.ReportColumns[n].DataFormat,"FLOAT",n,m.Cells[n])}for(n=0;n<o.ReportColumns.length;n++)C[n][0]+=C[n][1]}else t||o.ReportViewType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DashBoard&&o.ReportViewType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.LoadDataOnly?o.Data.InsertRange(o.Data.length,I):I.forEach((function(e){o.addRow(e)}));s.Clear()}o.addRow(m)}}if(s.length>0){var w;if(h)try{s.map((function(t){return t.SortData=Object(util__WEBPACK_IMPORTED_MODULE_24__.isUndefined)(t.Cells[e].Value)?0:t.Cells[e].Value})),s.SortBy([{name:"SortData",parser:parseFloat,desc:!o.IsSortAscending}]),w=s}catch(V){s.map((function(t){return t.SortData=t.Cells[e].Text})),s.SortBy([{name:"SortData",desc:!o.IsSortAscending}]),w=s}else if(u)try{s.map((function(t){return t.SortData=Object(util__WEBPACK_IMPORTED_MODULE_24__.isUndefined)(t.Cells[e].Value)?0:t.Cells[e].Value})),s.SortBy([{name:"SortData",desc:!o.IsSortAscending}]),w=s}catch(v){s.map((function(t){return t.SortData=t.Cells[e].Text})),s.SortBy([{name:"SortData",desc:!o.IsSortAscending}]),w=s}else if(c){for(var f=new Array,E=0;E<s.length;E++){var P=s[E],y=new SortVouchers;if(y.Row=P,!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(P.Cells[e].Text)){for(l=P.Cells[e].Text,null!=P.DataRow&&(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Int(P.DataRow[r])>1&&!l.Contains(",")&&((a=l.LastIndexOf("/"))>0&&(l=l.substr(0,a)))),n=l.length-1;n>=0&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsDigit(l[n]);n--);y.Prefix=l.substr(0,n+1),n<l.length-1&&(y.no=parseInt(l.substr(n+1)))}f.push(y)}for(f.SortBy([{name:"Prefix",desc:!o.IsSortAscending},{name:"no",desc:!o.IsSortAscending}]),w=new Array(f.length),n=0;n<f.length;n++)w[n]=f[n].Row}else s.map((function(t){return t.SortData=t.Cells[e].Text})),s.SortBy([{name:"SortData",desc:!o.IsSortAscending}]),w=s;if(-1!=o.colSNoIndex&&w.forEach((function(e){e.Cells[o.colSNoIndex].Value=++o.SNo,e.Cells[o.colSNoIndex].Text=o.SNo.toString()})),-1!=o.CumulativeIndex&&(10==o.StaticReportType&&(d=0),w.forEach((function(e){null!=e.DataRow&&(D=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(e.DataRow[o.CumulativeColumn]),d+=D,o.SetCellValue(d,o.ReportColumns[o.CumulativeIndex].DataFormat,"FLOAT",e.Cells[o.CumulativeIndex]))}))),o.TopRecords>0&&o.IsDefaultSortColumnExists&&!t)for(var O=0;O<o.TopRecords&&O<w.length;O++)o.addRow(w[O]);else t||o.ReportViewType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.DashBoard&&o.ReportViewType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.e.LoadDataOnly?o.Data.InsertRange(o.Data.length,w):w.forEach((function(e){o.addRow(e)}));s.Clear()}}(),this.refreshDataView())}},{key:"ApplyDefaultSort",value:function(){if(this.Preferences.ContainsKey("DefaultSortColumn")&&!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(this.Preferences.DefaultSortColumn))for(var e=0;e<this.ReportColumns.length;e++)if(this.ReportColumns[e].ID==this.Preferences.DefaultSortColumn){this.IsSortAscending="DESC"!=this.Preferences.DefaultSortOrder,this.SortList(e,!1);break}}},{key:"ReportColumns",get:function(){return this._ReportColumns},set:function(e){var t=this;null!=this.PostDataFetchFilterFields&&this.PostDataFetchFilterFields.filter((function(e){return!e.ShowColumn})).forEach((function(t){var o=e.find((function(e){return e.ID==t.ColumnName}));o&&(o.HeaderAppearance.IsVisible=!1)})),this._ReportColumns=e,this.RefreshGridColumns.Call(),this._ReportColumns.forEach((function(e){e.DataFormat.CumTotal>=0&&!t.TotalCols.Contains(e.ID)&&t.TotalCols.push(e.ID)}));for(var o=0;o<this._ReportColumns.length;o++)this._ReportColumns[o].Index=o;if(this.RepeatType!=_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.d.None&&null!=this.dicRepeatColsMap&&(this.kpiList.Clear(),this.kpiListSrc.forEach((function(e){if(t.dicRepeatColsMap.keys.Contains(e.ID)){var o=0;t.dicRepeatColsMap[e.ID].forEach((function(s){var i=new _StaticReports_StaticReportsViewModel__WEBPACK_IMPORTED_MODULE_33__.a;i.KPI_2(e,o),t.kpiList.push(i),o++}))}else t.kpiList.push(e)}))),this.kpiList.forEach((function(e){e.RefreshColumnIndex()})),this.HiddenNumericColumns.length>0){var s=Math.max.apply(Math,e.map((function(e){return e.Row}))),i=Math.max.apply(Math,this.HiddenNumericColumns.map((function(e){return e.Row})));this.MaxRowsUnder=Math.max(s,i)}else e.length>0&&(this.MaxRowsUnder=Math.max.apply(Math,e.map((function(e){return e.Row}))));if(null!=this.childReportTitle&&null==this.ParentReport){var l=this.Data.indexOf(this.childReportTitle);this.AddReportTitleRow(this.Reportds.Tables[0][0].ReportName.toString(),!1),-1!=l&&(this.removeRowAt(l),this.insertRowAt(this.childReportTitle,l))}if(null!=this.childReportColumnHeader&&null!=this.ParentReport){var n=this.Data.indexOf(this.childReportColumnHeader);this.AddReportColumnRow(!1),-1!=n&&(this.removeRowAt(n),this.insertRowAt(this.childReportColumnHeader,n))}this.ChildReports.forEach((function(e){e.RefreshChildReportColumns()}))}},{key:"ShowReportFilter",get:function(){return this._ShowReportFilter},set:function(e){e!=(this._ShowReportFilter||this.HidePostFilters)&&(this._ShowReportFilter=e)}},{key:"ReportFilterSelectAll",get:function(){return this._ReportFilterSelectAll},set:function(e){var t=this;e!=this._ReportFilterSelectAll&&(this._ReportFilterSelectAll=e,this.PostDataFetchFilterFields.forEach((function(o){o.ShowColumn=e,t.onColumnCheckedChanged(o)})))}},{key:"SerachValue",get:function(){return this._SerachValue},set:function(e){e!=this._SerachValue&&(this._SerachValue=e,this.Search())}},{key:"SelectedRow",get:function(){return this._SelectedRow},set:function(e){e!=this._SelectedRow&&(this._SelectedRow=e,this.LoadQueryDataOnRowSelection())}},{key:"LoadingVisibility",get:function(){return this._LoadingVisibility},set:function(e){e!=this._LoadingVisibility&&(null!=this.Chart&&(this.Chart.LoadingVisibility=e),this._LoadingVisibility=e)}},{key:"ReportData",get:function(){return this._ReportData},set:function(e){this._ReportData=e,null==e&&(this.ReportDataColumns=null)}},{key:"RefreshVisibility",get:function(){return this._RefreshVisibility},set:function(e){e!=this._RefreshVisibility&&(this._RefreshVisibility=e,this.RegenerateVisibility=e)}}],[{key:"ReportViewModel",value:function(){_ReportViewModel.evalNumFormat=new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.b,_ReportViewModel.evalNumFormat.ThrowException=!1,_ReportViewModel.evalNumFormat.SetKeyWords("REPORT"),_ReportViewModel.fldDictNumFormat=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a,_ReportViewModel.fldDictNumFormat.push("value",new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("value",0)),_ReportViewModel.fldDictNumFormat.push("Value",new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("Value",0)),_ReportViewModel.fldDictNumFormat.push("VALUE",new _services_formula_service__WEBPACK_IMPORTED_MODULE_2__.c("VALUE",0))}},{key:"SetCellValue",value:function(e,t,o,s,i){try{var l;i.IsNegativeRed=!1;var n=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.String(e);if("FLOAT"!=o&&"INT"!=o||!_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsNum(n))if(0==n.length||n.startsWith("<FlowDocument"))i.Text=n,i.Value=n;else if("DATE"==o)if(_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.isValidDate(n)&&_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.isDateOrNum(n))i.Value=new Date(n),i.Text=_ReportViewModel.GetFormattedDate(i.Value,t.DateType);else if(n.Contains(",")){var a=n.split(",");i.Text="",i.Value=n;for(var r=0;r<a.length;r++){var h=a[r];0!=h.length&&(i.Text.length>0&&(i.Text+=", "),_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.isValidDate(h)?i.Text+=_ReportViewModel.GetFormattedDate(new Date(h),t.DateType):i.Text+=h)}}else i.Text=n,i.Value=n;else i.Text=n,i.Value=n;else{var u;if(l=_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.Double(n),(u=-1==s?t.RoundOff:0==s?t.RoundOff_RT:t.RoundOff_ST.length>=s?t.RoundOff_ST[s-1]:0)>0){var c=l%u;c<u/2?l-=c:l=l+u-c}if(t.SuppressZero&&0==l)return i.Text=null,void(i.Value=0);var D="";if(t.NumberFormat.length>0)if(D=_ReportViewModel.NumbetFormatted(l,t),l<0)switch(t.NegativeNumber){case 1:i.IsNegativeRed=!0;break;case 2:D="("+D+")";break;case 3:i.IsNegativeRed=!0,D="("+D+")";break;case 4:case 7:D+=" Cr";break;case 5:D+=" Dr";break;case 8:D="+"+D}else if(0!=t.ShowDefaultSign)switch(t.NegativeNumber){case 4:D+=" Dr";break;case 5:D+=" Cr"}else switch(t.NegativeNumber){case 2:D="("+D+")";break;case 6:D="+"+D;break;case 7:D+=" Dr";break;case 8:D="-"+D}else{var d;if(d=t.DecimalsPoints>0?"N"+t.DecimalsPoints.toString():"N0",l<0)switch(t.NegativeNumber){case 1:i.IsNegativeRed=!0,D=l.Commas(d).Replace("-","");break;case 2:D="("+l.Commas(d).Replace("-","")+")";break;case 3:i.IsNegativeRed=!0,D="("+l.Commas(d).Replace("-","")+")";break;case 4:case 7:D=(-l).Commas(d)+"Cr";break;case 5:D=(-l).Commas(d)+"Dr";break;case 8:D="+"+(-l).Commas(d);break;case 12:D=(-l).Commas(d)}else if(0!=t.ShowDefaultSign)switch(t.NegativeNumber){case 4:D=l.Commas(d)+"Dr";break;case 5:D=l.Commas(d)+"Cr"}else switch(t.NegativeNumber){case 2:D="("+l.Commas(d)+")";break;case 6:D="+"+l.Commas(d);break;case 7:D=l.Commas(d)+"Dr";break;case 8:D="-"+l.Commas(d)}_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(D)&&(D=l.Commas(d))}i.Value=l,_shared_models_Util__WEBPACK_IMPORTED_MODULE_3__.e.IsEmpty(t.PercentageOn)||(D+="%"),i.Text=D}}catch(C){Logger.ErrorLog("ReportViewModel::Error GetFormattedData",C.stack)}}},{key:"NumbetFormatted",value:function(e,t){_ReportViewModel.fldDictNumFormat||_ReportViewModel.ReportViewModel();var o=_ReportViewModel.fldDictNumFormat,s=e;e<0&&(t.NegativeNumber>=1&&t.NegativeNumber<=5||7==t.NegativeNumber||8==t.NegativeNumber||12==t.NegativeNumber)&&(s=-s),_ReportViewModel.fldDictNumFormat.value.setFieldValue(s),_ReportViewModel.fldDictNumFormat.Value.setFieldValue(s),_ReportViewModel.fldDictNumFormat.VALUE.setFieldValue(s);try{return _ReportViewModel.evalNumFormat.EvaluateExpression(t.NumberFormat,o).toString()}catch(i){return"#"}}},{key:"GetFormattedDate",value:function(e,t){return _services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences.ContainsKey("Hijri Date")&&""!=_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Hijri Date"]&&Object(angular_slickgrid__WEBPACK_IMPORTED_MODULE_5__.j)(_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Hijri Date"])?_services_session_manager_service__WEBPACK_IMPORTED_MODULE_26__.a.ConvertGregtoHijri(e):e.ToString(""!=t?t:_services_base_service__WEBPACK_IMPORTED_MODULE_1__.a.SessionManager.Preferences["Date Format"])}},{key:"GetHoursSum",value:function(e,t){if(0==e)return t;var o=0,s=e.ToString("0.00").split(".");s.length>1&&(o=parseInt(s[1]));var i=t.ToString("0.00").split(".");return i.length>1&&(o+=parseInt(i[1])),parseFloat(s[0])+parseFloat(i[0])+o/60+parseFloat("0."+(o%60).ToString("00"))}}]),ReportViewModel}(_IPrefetchFilter__WEBPACK_IMPORTED_MODULE_6__.IPrefetchFilter),SortVouchers=function e(){_classCallCheck(this,e)},Group=function(e){_inherits(o,e);var t=_createSuper(o);function o(){var e;return _classCallCheck(this,o),(e=t.apply(this,arguments)).ShowAsColumn=!1,e.Level=0,e.Width=0,e.Height=0,e.Row=0,e.Column=0,e.SubTotalShowCaption=1,e.SubTotalLevel=0,e.SubTotalWidth=0,e.SubTotalHeight=0,e.SubTotalBorder=0,e.SubTotalShowAtCollapse=!1,e.TotalCols=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a,e.TempTotalCols=new _util_dictionary__WEBPACK_IMPORTED_MODULE_4__.a,e}return o}(_Models_ReportGridColumns__WEBPACK_IMPORTED_MODULE_8__.c)},WqAs:function(e,t,o){"use strict";o.d(t,"a",(function(){return d}));var s=o("Do2H"),i=o("Lp6j"),l=o("eQJW"),n=o("dH+5"),a=o("mvPR"),r=o("vTM8"),h=o("MCLT"),u=o("1xwR"),c=o("8iaB"),D=function(e){return e[e.None=0]="None",e[e.MonthWise=1]="MonthWise",e[e.QtrWise=4]="QtrWise",e[e.HalfYearWise=5]="HalfYearWise",e[e.YearWise=3]="YearWise",e[e.TagWise=2]="TagWise",e}({}),d=function(e){_inherits(o,e);var t=_createSuper(o);function o(e){var s;return _classCallCheck(this,o),(s=t.call(this,e)).Show=D.None,s.i=0,s.k=0,s.jAccount=0,s.GLClubTranBy=0,s.dsAccount=null,s.Balance=0,s.OpBalance=0,s.exchRate=0,s.IsSalesContractLedger=!1,s.ShowMonthWise=!1,s.IsRetainedEarning=!1,s.colBalanceIndex=-1,s.colDebitIndex=-1,s.colCreditIndex=-1,s.colSpanBF=-1,s.colSubTotalStartIndex=0,s.GroupTotalIndex=0,s.colLocalAmtInd=-1,s.colPDCInd=-1,s.colTBOp_DrIndex=-1,s.colTBOp_CrIndex=-1,s.colTBTr_DrIndex=-1,s.colTBTr_CrIndex=-1,s.colTBCl_DrIndex=-1,s.colTBCl_CrIndex=-1,s.colOpBalanceIndex=-1,s.colParticularIndex=-1,s.IncludeBFInTotals=!1,s.AccountsWithOutTransactions=!1,s.AccountsWithZeroBalance=!1,s.HideEmptyDimensions=!1,s.PDCSeperate=!1,s.PDCDrCrSeperate=!1,s.STAccountWise=!1,s.STMonthWise=!1,s.STDayWise=!1,s.ShowGL_INVDetailReport=!1,s.AccountsWithOnlyOPB=!1,s.TBIsAccountWise=!1,s.TBOpeningDrCrSeperately=!1,s.TBTransactionsDrCrSeperately=!1,s.OpenCompany=!1,s.ShowTagWise=!1,s.DontShowREforPeriodInAssignedAccount=!1,s.TBShowdetailsofControlGroups=!1,s.UnPostedDocsSeparately=!1,s.UnPostedDocsSeparatelyByStatus=!1,s.AllowAddRows=!1,s.GLJVDetails=!1,s.HideSectionSubTotal=!1,s.ShowUnInvoicedAmount=!1,s.GroupTotalsAtEnd=!1,s.GroupTotalsSeperate=!1,s.DontShowSummaryGroupTotals=!1,s.GLSortTransactions=!1,s.ExcludeOpBalance=!1,s.ShowGroupHighLowValues=!1,s.ExcludeClBalance=!1,s.OpDrCrInOpDr=!1,s.IsFCClosingDebitExists=!1,s.TagID=0,s.ForeignCurrencyID=0,s.CurrencyType=0,s.YTDIndex=0,s.YTD_LYIndex=0,s.BAL_LYIndex=0,s.BalIndex=0,s.TTColumnSize=0,s.TTReportTotalIndex=0,s.TTAccNameIndex=0,s.ShowGL_ACCDetailReport=0,s.TagTableName=null,s.GLSortTransactionsBy="",s.dvYTD=null,s.dvBAL_LY=null,s.dvYTD_LY=null,s.dvYTDTable=null,s.dvBAL_LYTable=null,s.dvYTD_LYTable=null,s.dtOpenCompanyYearStart=null,s.CountMonths=0,s.CADimension=0,s.strRetainedAccounts="",s.GLRetainedAccounts=new r.a,s.IsNewAccount=!0,s.HideOpeningProfitAndLoss=!1,s.HideOpeningBalanceDifference=!1,s.IsTTypeTB=!1,s.IsControlAccounts=!1,s.IsCurrentControlAccount=!1,s.ShowPDCPaymentsFirst=!1,s.dec="",s.LocationWhere="",s.filter="",s.oLocalAmount=null,s.TagCols=[],s.dbl=0,s.Row=0,s.Col=0,s.rows=[],s.arrUnPostedStatusesID=[],s.arrUnPostedStatuses=[],s.colIndex=new r.c,s.GTPQuery="",s.GTPWhere="",s.strOrder="",s.TBGroupID="",s.ExcludeTreeTotalCols=[],s.lstTags=[],s.lstParticularID=[],s.dtParticulars=null,s.dtParticularsColumns=null,s.iDataSetCollection=[],s.dicInvRows=new r.a,s.al=[],s.aldim=[],s.TempChunkSize=0,s.iLoop=0,s.oCBCell=new a.c,s.oCBFormat=new a.b,s.dblCBMin=0,s.dblCBMax=0,s.LevelNo=0,s.dsOpenCompany=null,s.dvOpenCompany=null,s.dvOpenCompanyTable=null,s.lstTotal=null,s.arrTBTotals=null,s.dblDrOpenCompany=0,s.dblCrOpenCompany=0,s.dblMissingOpeningDr=0,s.dblMissingOpeningCr=0,s.lstParents=[],s.IsFirstCall=!1,s.FirstTypeEndIndex=0,s.CellStartPos=0,s.CallFrom=0,s}return _createClass(o,[{key:"LoadReport",value:function(){var e=this;new Promise((function(t,o){e.resolve=t,e.LoadReport_Promise()})).then((function(){e.ViewModel.process_RunWorkerCompleted()}))}},{key:"LoadReport_Promise",value:function(){var e=this;if(!(this.ViewModel.StaticReportType>=1||this.ViewModel.StaticReportType<=4)||"True"!=s.a.SessionManager.Preferences.EnableLocationWise.toString()||"True"!=s.a.SessionManager.Preferences["LW Reports"]||"True"!=s.a.SessionManager.Preferences.LWAccPeriod||(1==this.ViewModel.StaticReportType&&this.ViewModel.Preferences.ContainsKey("ExcludeOpBalance")&&"1"==this.ViewModel.Preferences.ExcludeOpBalance||this.CheckLWAccountingDate(),i.e.IsEmpty(this.ViewModel.DisplayMessage))){this.promiseRE=null,this.GrdRow=-1,this.GroupTotalIndex=-1,this.colSubTotalStartIndex=-1,this.YTDIndex=this.YTD_LYIndex=this.BAL_LYIndex=-1,this.IsSalesContractLedger=!1,this.oColumns=this.ViewModel.ColumnSource,2==this.ViewModel.StaticReportType||3==this.ViewModel.StaticReportType?this.AggTotal=i.e.NumArray(this.oColumns.length+1,2):1!=this.ViewModel.StaticReportType&&86!=this.ViewModel.StaticReportType||(this.AggTotal=i.e.NumArray(this.oColumns.length,5)),this.lstTotal=new Array,this.DataSetCollection.Clear(),this.iDataSetCollection.Clear(),this.ViewModel.lstGroupIndex.Clear(),this.ViewModel.SNo=0,this.OpenCompany=Object(l.j)(s.a.SessionManager.Preferences.OpenCompany);for(var t=0;t<this.oColumns.length;t++)if("Debit"==this.oColumns[t].ID||"Credit"==this.oColumns[t].ID||"Balance"==this.oColumns[t].ID){this.colSpanBF=t;break}if(this.ViewModel.lstGroup.length>0)for(this.k=0;this.k<this.oColumns.length;this.k++)if(this.ViewModel.lstGroup[0].TotalCols.ContainsKey(this.oColumns[this.k].ID)){this.colSubTotalStartIndex=this.k;break}for(var r=this.oColumns.length-1;r>=0;r--)"Balance"==this.oColumns[r].ID||"NetBalance"==this.oColumns[r].ID?this.colBalanceIndex=r:"Debit"==this.oColumns[r].ID?this.colDebitIndex=r:"Credit"==this.oColumns[r].ID?this.colCreditIndex=r:"LastYearBalance"==this.oColumns[r].ID?this.BAL_LYIndex=r:"LastYearYTD"==this.oColumns[r].ID?this.YTD_LYIndex=r:"OP_Dr"==this.oColumns[r].ID?this.colTBOp_DrIndex=r:"OP_Cr"==this.oColumns[r].ID?this.colTBOp_CrIndex=r:"TR_Dr"==this.oColumns[r].ID?this.colTBTr_DrIndex=r:"TR_Cr"==this.oColumns[r].ID?this.colTBTr_CrIndex=r:"CL_Dr"==this.oColumns[r].ID?this.colTBCl_DrIndex=r:"CL_Cr"==this.oColumns[r].ID?this.colTBCl_CrIndex=r:"OpBalance"==this.oColumns[r].ID?this.colOpBalanceIndex=r:"TotalPDC"==this.oColumns[r].ID?this.colPDCInd=r:0==i.e.stringCompare(this.oColumns[r].Formula,"SNO",!0)&&(this.ViewModel.colSNoIndex=r);var h="",c=this.ViewModel.oReportDialog.GetSeqNosList();if(this.LocationWhere="",this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(this.LocationWhere=i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?" AND 1!=1":" AND DCC.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),this.ChunkSize=this.ViewModel.Preferences.ContainsKey("ChunkSize")?parseInt(this.ViewModel.Preferences.ChunkSize):1,this.CurrencyType=0,this.ForeignCurrencyID=0,this.ViewModel.Preferences.ContainsKey("ForeignCurrency")){var d=new i.f;d.LoadXml("<XML>"+this.ViewModel.Preferences.ForeignCurrency+"</XML>");var C=i.f.SelectSingleNode(d.DocumentElement,"IsChecked");null!=C&&"1"==C.innerHTML&&(this.ForeignCurrencyID=parseInt(i.f.SelectSingleNodeText(d.DocumentElement,"Value")))}else if(this.ViewModel.Preferences.ContainsKey("Currency")){var p=new i.f;p.LoadXml("<XML>"+this.ViewModel.Preferences.Currency+"</XML>"),this.CurrencyType=parseInt(i.f.SelectSingleNodeText(p.DocumentElement,"Type")),1==this.CurrencyType?(i.e.IsEmpty(s.a.SessionManager.Preferences.DimensionwiseCurrency)||0==parseInt(s.a.SessionManager.Preferences.DimensionwiseCurrency))&&(this.CurrencyType=0):2==this.CurrencyType&&(this.ForeignCurrencyID=parseInt(i.f.SelectSingleNodeText(p.DocumentElement,"Value")))}if(this.ViewModel.ConstructFormulaFields(!1),this.ViewModel.FormulasCalculated=!1,this.ShowGL_INVDetailReport=!(!this.ViewModel.Preferences.ContainsKey("ShowDetailReportINV")||"1"!=this.ViewModel.Preferences.ShowDetailReportINV),this.ShowGL_ACCDetailReport=this.ViewModel.Preferences.ContainsKey("ShowDetailReportACC")&&"1"==this.ViewModel.Preferences.ShowDetailReportACC?1:0,1==this.ShowGL_ACCDetailReport&&this.ViewModel.Preferences.ContainsKey("GroupByParticular")&&"1"==this.ViewModel.Preferences.GroupByParticular&&(this.ShowGL_ACCDetailReport=2),this.UnPostedDocsInclude=!(!this.ViewModel.Preferences.ContainsKey("IncludeUnPostedDocs")||"1"!=this.ViewModel.Preferences.IncludeUnPostedDocs),this.UnPostedDocsList=this.UnPostedDocsInclude&&this.ViewModel.Preferences.ContainsKey("IncludeUnPostedDocsList")?this.ViewModel.Preferences.IncludeUnPostedDocsList:"",this.IncludeUnApprovedPDC=!(!this.ViewModel.Preferences.ContainsKey("IncludeUnApprovedPDC")||"1"!=this.ViewModel.Preferences.IncludeUnApprovedPDC),this.IncludeTerminatedPDC=!this.ViewModel.Preferences.ContainsKey("IncludeTerminatedPDC")||"0"!=this.ViewModel.Preferences.IncludeTerminatedPDC,this.HideOpeningProfitAndLoss=!(!this.ViewModel.Preferences.ContainsKey("HideOpeningProfitAndLoss")||"1"!=this.ViewModel.Preferences.HideOpeningProfitAndLoss),this.HideOpeningBalanceDifference=!(!this.ViewModel.Preferences.ContainsKey("HideOpeningBalanceDifference")||"1"!=this.ViewModel.Preferences.HideOpeningBalanceDifference),this.DontShowREforPeriodInAssignedAccount=!(!this.ViewModel.Preferences.ContainsKey("DontShowREforPeriodInAssignedAccount")||"1"!=this.ViewModel.Preferences.DontShowREforPeriodInAssignedAccount),this.GLSortTransactions=!(!this.ViewModel.Preferences.ContainsKey("SortTransactions")||"1"!=this.ViewModel.Preferences.SortTransactions),this.GLSortTransactionsBy=this.ViewModel.Preferences.ContainsKey("SortTransactionsBy")?this.ViewModel.Preferences.SortTransactionsBy:"",this.HideSectionSubTotal=!!this.ViewModel.Preferences.ContainsKey("HideSectionSubTotal"),this.DontApplyLocationWiseAccountsFilter=!(!this.ViewModel.Preferences.ContainsKey("DontApplyLocationWiseAccountsFilter")||"1"!=this.ViewModel.Preferences.DontApplyLocationWiseAccountsFilter),this.DontApplyLocationWiseAccountsFilter||(this.ApplyLWAccountLFilterWhenIgnoreLoc=!(!this.ViewModel.Preferences.ContainsKey("ApplyLWAccountLFilterWhenIgnoreLoc")||"1"!=this.ViewModel.Preferences.ApplyLWAccountLFilterWhenIgnoreLoc)),this.ShowGroupHighLowValues=!(!this.ViewModel.Preferences.ContainsKey("ShowGroupHighLowValues")||"1"!=this.ViewModel.Preferences.ShowGroupHighLowValues),this.ShowGroupHighLowValues&&("Monthly"==this.ViewModel.Preferences.Balancing&&(this.ShowGroupHighLowValues=!1),this.oCBFormat.DecimalsPoints=parseInt(s.a.SessionManager.Preferences.DecimalsinAmount),this.oCBFormat.NegativeNumber=4,this.oCBFormat.ShowDefaultSign=0,"Millions"==s.a.SessionManager.Preferences.Commas?this.oCBFormat.Commas=1:"Lakhs"==s.a.SessionManager.Preferences.Commas&&(this.oCBFormat.Commas=2)),this.TagCols.Clear(),156!=this.ViewModel.StaticReportType&&c.length>0&&(this.ViewModel.oReportDialog.IsZeroSelected||this.ViewModel.oReportDialog.IsOneSelected||(c=this.ViewModel.oReportDialog.GetSeqNosListWithRoots(),this.ViewModel.oReportDialog.IsGroupExists?(this.GTPWhere="A1.AccountID=GTP.GTID",this.GTPQuery=c.Contains(",")?",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID IN ("+c+") group by T.AccountID) AS GTP ":",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID="+c+" group by T.AccountID) AS GTP "):this.GTPWhere=c.Contains(",")?"A1.AccountID IN ("+c+")":"A1.AccountID="+c),0!=this.GTPWhere.length&&this.OpenCompany)){this.OpenCompany=!1;var T=this.ViewModel.oReportDialog.FromDate.Date;if(this.DontShowREforPeriodInAssignedAccount&&((T=new Date(this.ViewModel.oReportDialog.FromDate.Date.getFullYear(),this.AccountingFromMonth-1,1))>this.ViewModel.oReportDialog.FromDate.Date&&(T=T.AddYears(-1))),null!=this.ViewModel.oReportDialog.DefaultTreeSelectedNodes)for(var _=s.a.report.ReportDataTable("RPT021",this.ViewModel.IsReportDB,T.ToString("dd MMM yyyy")),m=function(t){var o=_[t];if(e.ViewModel.oReportDialog.DefaultTreeSelectedNodes.find((function(e){return e.Id==parseInt(o.AccountID)})))return e.OpenCompany=!0,"break"},I=0;I<_.length;I++){if("break"===m(I))break}4!=this.ViewModel.StaticReportType||this.OpenCompany||(this.OpenCompany=!0,this.DontShowREforPeriodInAssignedAccount=!0)}if(1==this.ViewModel.StaticReportType)!function(){if(e.STAccountWise=e.ViewModel.Preferences.SubTotals.Contains("AccountWise"),e.STMonthWise=e.ViewModel.Preferences.SubTotals.Contains("MonthWise"),e.STDayWise=e.ViewModel.Preferences.SubTotals.Contains("DayWise"),e.IncludeBFInTotals="1"==e.ViewModel.Preferences.AddOpeningBalance,e.ExcludeOpBalance=!(!e.ViewModel.Preferences.ContainsKey("ExcludeOpBalance")||"1"!=e.ViewModel.Preferences.ExcludeOpBalance),e.AccountsWithOutTransactions="1"==e.ViewModel.Preferences.WantAccountsWithoutTransactions,e.AccountsWithOnlyOPB=!(!e.ViewModel.Preferences.ContainsKey("WantAccountsWithOnlyOPB")||"1"!=e.ViewModel.Preferences.WantAccountsWithOnlyOPB),e.AccountsWithZeroBalance="1"==e.ViewModel.Preferences.WantAccountsWithZeroBalances,e.PDCInclude="1"==e.ViewModel.Preferences.IncludePDCs,e.PDCSeperate="1"==e.ViewModel.Preferences.PDCsSeparately,e.ShowPDCPaymentsFirst=!(!e.ViewModel.Preferences.ContainsKey("PDCPaymentsFirst")||"1"!=e.ViewModel.Preferences.PDCPaymentsFirst),e.PDCDrCrSeperate="1"==e.ViewModel.Preferences.ShowDebitCreditSeparated,e.UnPostedDocsSeparately=!(!e.ViewModel.Preferences.ContainsKey("UnPostedDocsSeparately")||"1"!=e.ViewModel.Preferences.UnPostedDocsSeparately),e.UnPostedDocsSeparatelyByStatus=!(!e.ViewModel.Preferences.ContainsKey("UnPostedDocsSeparatelyByStatus")||"1"!=e.ViewModel.Preferences.UnPostedDocsSeparatelyByStatus),e.GLJVDetails=!(!e.ViewModel.Preferences.ContainsKey("GLJVDetails")||"1"!=e.ViewModel.Preferences.GLJVDetails),e.ViewModel.DocumentFilters.ContainsKey("CONTRACTNODEID")&&(e.ShowUnInvoicedAmount=!(!e.ViewModel.Preferences.ContainsKey("ShowUnInvoicedAmount")||"1"!=e.ViewModel.Preferences.ShowUnInvoicedAmount)),e.UnPostedDocsSeparatelyByStatus&&e.UnPostedDocsList.length>0){var t=e.UnPostedDocsList.split(",");new Array(t.length);for(var l=0;l<t.length;l++)e.arrUnPostedStatusesID.push(t[l]),e.arrUnPostedStatuses.push("371"==t[l]?"Un-Approved Documents":"376"==t[l]?"Cancelled Documents":"372"==t[l]?"Rejected Documents":"441"==t[l]?"Approved Documents":"Other Status("+t[l]+") Documents");e.PDCInclude&&!e.PDCSeperate&&(e.arrUnPostedStatusesID.push("370"),e.arrUnPostedStatuses.push("PDC Documents"),e.arrUnPostedStatusesID.push("439"),e.arrUnPostedStatuses.push("PDC Discounted"),e.IncludeTerminatedPDC&&(e.arrUnPostedStatusesID.push("452"),e.arrUnPostedStatuses.push("Terminated PDC Documents")))}if(e.TagID=0,e.ShowTagWise=!1,2==e.ViewModel.lstGroup.length){if(e.ViewModel.ReportGroups[1].CDGDO.ColumnCostCenterID>5e4&&(e.TagID=e.ViewModel.ReportGroups[1].CDGDO.ColumnCostCenterID),e.ViewModel.Preferences.ContainsKey("TagWise")){var r=new i.f;r.LoadXml("<XML>"+e.ViewModel.Preferences.TagWise+"</XML>");var c=i.f.SelectSingleNode(r.DocumentElement,"IsChecked");null!=c&&"1"==c.innerHTML&&(c=i.f.SelectSingleNode(r.DocumentElement,"Value"),e.TagID=parseInt(c.innerHTML))}}else if(e.ViewModel.Preferences.ContainsKey("TagWise")){var D=new i.f;D.LoadXml("<XML>"+e.ViewModel.Preferences.TagWise+"</XML>");var d=i.f.SelectSingleNode(D.DocumentElement,"IsChecked");null!=d&&"1"==d.innerHTML&&(e.ShowTagWise=!0,d=i.f.SelectSingleNode(D.DocumentElement,"Value"),e.TagID=parseInt(d.innerHTML),e.TagTableName=o.GetTagTableName(e.TagID),e.HideEmptyDimensions=null!=i.f.SelectSingleNode(D.DocumentElement,"HideColumns"),e.TagColumnName="Name",null!=(d=i.f.SelectSingleNode(D.DocumentElement,"Column"))&&("0"==d.innerHTML?e.TagColumnName="Code":"2"==d.innerHTML&&(e.TagColumnName="Code+'-'+Name")))}if(e.ViewModel.Preferences.ContainsKey("CurrencyWise")&&"1"==e.ViewModel.Preferences.CurrencyWise&&(e.CurrencyType=-1,e.ViewModel.Preferences.ContainsKey("HideEmptyCurrencies")&&"1"==e.ViewModel.Preferences.HideEmptyCurrencies&&(e.HideEmptyDimensions=!0)),1==e.ViewModel.StaticReportType&&!e.ViewModel.DocumentFilters.ContainsKey("CONTRACTNODEID")&&s.a.SessionManager.Preferences.ContainsKey("IsControlAccounts")&&"TRUE"==s.a.SessionManager.Preferences.IsControlAccounts.toUpperCase()&&e.ViewModel.Preferences.ContainsKey("AccountTypesFilter")&&e.ViewModel.Preferences.AccountTypesFilter.length>0&&e.ViewModel.Preferences.AccountTypesFilter.Contains(",")){var C=e.ViewModel.Preferences.AccountTypesFilter.split(",");C.Contains("6")||C.Contains("7")||(e.IsControlAccounts=!0)}if(h="SELECT A1.AccountID,A1.AccountTypeID,A1.AccountName,A1.GLClubTranBy"+e.ViewModel.GroupSelectTag,e.IsControlAccounts&&("Code"==e.ViewModel.Preferences.TreeSortOn?h+=",A1.AccountCode":"TreeOrder"==e.ViewModel.Preferences.TreeSortOn&&(h+=",A1.lft"),s.a.SessionManager.Preferences.ContainsKey("ControlAccDimension")&&(e.CADimension=i.e.Int(s.a.SessionManager.Preferences.ControlAccDimension)),h+=0==e.CADimension?",0 IsControl":",A1CC.CCNID"+(e.CADimension-5e4)+" CAD"),h+="",e.ShowUnInvoicedAmount&&(h+=",dbo.fnREN_UnInvoicedAmount("+e.ViewModel.DocumentFilters.CONTRACTNODEID+",A1.AccountID) UnInvoicedAmount"),h+=" FROM ACC_Accounts A1 with(nolock)",e.CADimension>0&&(h+=" join COM_CCCCDATA A1CC with(nolock) on A1CC.CostCenterID=2 and A1CC.NodeID=A1.AccountID"),h+=e.ViewModel.GroupFromTag+e.GTPQuery,h+=" WHERE (A1.IsGroup=0 and A1.AccountID>1 ",e.ViewModel.Preferences.ContainsKey("IncludeIntPDCsInBank")){e.ViewModel.kpiList.Clear(),e.ViewModel.kpiListSrc.Clear();var p="";p+='<Row ID="ROW_KPI" Formula="if(StatusID==-1) 1 else 0" Expression=" if (StatusID==-1)1 else 0" BackColor="#FFEEF7EA" ForeColor="" Img="" Text="" />',p="<XML>"+(p+='<Row ID="ROW_KPI" Formula="if(StatusID==-2) 1 else 0" Expression=" if (StatusID==-2)1 else 0" BackColor="#FFE9EFF4" ForeColor="" Img="" Text="" />'),p+="</XML>";var T=new i.f;T.LoadXml(p.toString()),T.DocumentElement.childNodes.forEach((function(t){var o=new u.a;o.KPI_1(t,e.ViewModel),e.ViewModel.kpiList.push(o),e.ViewModel.kpiListSrc.push(e.ViewModel.kpiList[e.ViewModel.kpiList.length-1])})),h+=" and A1.AccountTypeID=2"}else h+=e.GetAccountTypeWhere("A1");h+=e.GetAccountWiseLocationWhere("A1"),e.GTPWhere.length>0&&(h+=" AND "+e.GTPWhere);var _="",m="",I="";e.ViewModel.DocumentFilters.ContainsKey("CONTRACTNODEID")?(_=" D.RefCCID= "+e.ViewModel.DocumentFilters.CONTRACTRefCCID+" AND D.RefNodeid="+e.ViewModel.DocumentFilters.CONTRACTNODEID,h+=" AND A1.AccountID IN (select DebitAccount from ACC_DocDetails D with(nolock) where "+_+"\nunion select CreditAccount from ACC_DocDetails D with(nolock) where "+_+"\nunion select DebitAccount from ACC_DocDetails D with(nolock)\ninner join (select AccDocDetailsID from ACC_DocDetails D with(nolock) where "+_+") t on t.AccDocDetailsID=D.RefNodeid and  D.RefCCID=400 \nunion select CreditAccount from ACC_DocDetails D with(nolock)\ninner join (select AccDocDetailsID from ACC_DocDetails D with(nolock) where "+_+") t on t.AccDocDetailsID=D.RefNodeid and  D.RefCCID=400)"):(e.SetRetainedEarnings(),e.LocationWhere.length>0&&(m=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.AccDocDetailsID=ACC.AccDocDetailsID "+e.LocationWhere,I=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=ACC.InvDocDetailsID "+e.LocationWhere),_=" WHERE DocDate BETWEEN CONVERT(FLOAT,CONVERT(DATETIME,'"+e.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"')) AND CONVERT(FLOAT,CONVERT(DATETIME,'"+e.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",h+=" AND (",e.AccountsWithOutTransactions||e.AccountsWithOnlyOPB?(e.CADimension>0&&(h+="A1CC.CCNID"+(e.CADimension-5e4)+">1 or "),h+="A1.AccountID IN (SELECT CreditAccount FROM ACC_DocDetails AS Cr with(nolock) UNION SELECT DebitAccount FROM ACC_DocDetails AS Dr with(nolock))"):(e.CADimension>0&&(h+="A1CC.CCNID"+(e.CADimension-5e4)+">1 or "),h+="A1.AccountID IN (SELECT CreditAccount FROM ACC_DocDetails ACC WITH(NOLOCK) "+m+_,h+=" UNION SELECT DebitAccount FROM ACC_DocDetails ACC WITH(NOLOCK) "+m+_,I.length>0&&(h+=" UNION SELECT CreditAccount FROM ACC_DocDetails ACC WITH(NOLOCK) "+I+_,h+=" UNION SELECT DebitAccount FROM ACC_DocDetails ACC WITH(NOLOCK) "+I+_),h+=")"),h+=")"),h+=")",e.ViewModel.DocumentFilters.ContainsKey("CONTRACTNODEID")||(h+="^strRetainedAccounts^"),e.IsControlAccounts&&0==e.CADimension&&(h+="\nunion all\nSELECT A1.AccountID,A1.AccountTypeID,A1.AccountName,A1.GLClubTranBy"+e.ViewModel.GroupSelectTag,e.IsControlAccounts&&("Code"==e.ViewModel.Preferences.TreeSortOn?h+=",A1.AccountCode":"TreeOrder"==e.ViewModel.Preferences.TreeSortOn&&(h+=",A1.lft"),h+=",1 IsControl"),h+=" FROM ACC_Accounts A1 with(nolock) join ACC_Accounts CA with(nolock) on A1.lft between CA.lft and CA.rgt\njoin (select ParentID from ACC_Accounts with(nolock) where AccountTypeID in (6,7) group by ParentID) as DCA on DCA.ParentID=A1.AccountID"+e.ViewModel.GroupFromTag+e.GTPQuery+"\nWHERE A1.IsGroup=1 and A1.AccountID>1 and (CA.AccountID="+s.a.SessionManager.Preferences.DebtorsControlGroup+" or CA.AccountID="+s.a.SessionManager.Preferences.CreditorsControlGroup+")",h+=e.GetAccountTypeWhere("A1"),e.GTPWhere.length>0&&(h+=" AND "+e.GTPWhere)),h+="Code"==e.ViewModel.Preferences.TreeSortOn?" Order By A1.AccountCode":"TreeOrder"==e.ViewModel.Preferences.TreeSortOn?" Order By A1.lft":" Order By A1.AccountName";for(var R=new Array,S=0;S<e.ViewModel.ColumnSource.length;S++)R.push(e.ViewModel.ColumnSource[S].Clone());if(e.ShowTagWise){var A;e.ViewModel.TotalCols.Clear(),e.ViewModel.GrpReportTotal.TotalCols.Clear(),e.ViewModel.AddTotalColumnsToGroup(e.ViewModel.GrpReportTotal,e.ViewModel.ReportDoc.SelectSingleNode("PactRevenURpts/PactRevenURptDef/ReportTotal/Columns")),e.ViewModel.lstGroup.forEach((function(t){t.TotalCols.Clear(),e.ViewModel.AddTotalColumnsToGroup(t,e.ViewModel.ReportDoc.SelectSingleNode("PactRevenURpts/PactRevenURptDef/ReportTotal/Columns"))})),-1!=e.colBalanceIndex?A=R[e.colBalanceIndex].Clone():-1!=e.colDebitIndex?A=R[e.colDebitIndex].Clone():-1!=e.colCreditIndex?A=R[e.colCreditIndex].Clone():(A=new n.b).DataFormat=new a.b,A.DataFormat.NegativeNumber=4,A.DataFormat.ShowDefaultSign=0;var M=e.GetTagWiseQuery(e.TagID,e.TagColumnName,"Name");s.a.report.DataSet("RPT022",M).Tables[0].forEach((function(t){var o=A.Clone();o.HeaderText=t.Name.toString(),o.ID="TAG"+t.NodeID.toString(),R.push(o),++e.CountMonths,e.TagCols.push(o),e.ViewModel.TotalCols.push(o.ID),e.ViewModel.GrpReportTotal.TotalCols.push(o.ID,e.TagCols.length-1),e.ViewModel.lstGroup[0].TotalCols.push(o.ID,e.TagCols.length-1)}))}else if(-1==e.CurrencyType&&-1!=e.colBalanceIndex){R.Clear(),e.ViewModel.TotalCols.Clear(),e.ViewModel.GrpReportTotal.TotalCols.Clear(),e.ViewModel.AddTotalColumnsToGroup(e.ViewModel.GrpReportTotal,e.ViewModel.ReportDoc.SelectSingleNode("PactRevenURpts/PactRevenURptDef/ReportTotal/Columns")),e.ViewModel.lstGroup.forEach((function(t){t.TotalCols.Clear(),e.ViewModel.AddTotalColumnsToGroup(t,e.ViewModel.ReportDoc.SelectSingleNode("PactRevenURpts/PactRevenURptDef/ReportTotal/Columns"))}));for(var g=0;g<e.ViewModel.ColumnSource.length;g++)R.push(e.ViewModel.ColumnSource[g].Clone()),e.colBalanceIndex==g&&function(){var t=void 0;s.a.report.DataSet("ACC101","").Tables[0].forEach((function(o){-1!=e.colDebitIndex&&((t=R[e.colDebitIndex].Clone()).HeaderText=o.Name.ToString()+"\r\n"+t.HeaderText,t.ID="CURRDR"+o.NodeID.ToString(),R.push(t),e.TagCols.push(t),e.ViewModel.TotalCols.push(t.ID),e.ViewModel.GrpReportTotal.TotalCols.push(t.ID,e.TagCols.length-1),e.ViewModel.lstGroup[0].TotalCols.push(t.ID,e.TagCols.length-1)),-1!=e.colCreditIndex&&((t=R[e.colCreditIndex].Clone()).HeaderText=o.Name.ToString()+"\r\n"+t.HeaderText,t.ID="CURRCR"+o.NodeID.ToString(),R.push(t),e.TagCols.push(t),e.ViewModel.TotalCols.push(t.ID),e.ViewModel.GrpReportTotal.TotalCols.push(t.ID,e.TagCols.length-1),e.ViewModel.lstGroup[0].TotalCols.push(t.ID,e.TagCols.length-1)),-1!=e.colBalanceIndex&&((t=R[e.colBalanceIndex].Clone()).HeaderText=o.Name.ToString()+"\r\n"+t.HeaderText,t.ID="CURRBL"+o.NodeID.ToString(),R.push(t),e.TagCols.push(t),e.ViewModel.TotalCols.push(t.ID),e.ViewModel.GrpReportTotal.TotalCols.push(t.ID,e.TagCols.length-1),e.ViewModel.lstGroup[0].TotalCols.push(t.ID,e.TagCols.length-1))})),-1!=e.colDebitIndex&&(R[e.colDebitIndex].HeaderAppearance.IsVisible=!1),-1!=e.colCreditIndex&&(R[e.colCreditIndex].HeaderAppearance.IsVisible=!1),-1!=e.colBalanceIndex&&(R[e.colBalanceIndex].HeaderAppearance.IsVisible=!1)}();R[0].HeaderHeight<40&&R.forEach((function(e){return e.HeaderHeight=45}))}e.oLocalAmount=R.find((function(e){return"LocalAmount"==e.ID})),e.oLocalAmount&&(0==e.ForeignCurrencyID?e.oLocalAmount.HeaderAppearance.IsVisible=!1:(e.colLocalAmtInd=R.indexOf(e.oLocalAmount),e.ViewModel.ColumnSource.find((function(e){return"LocalAmount"==e.ID&&e.HeaderAppearance.IsVisible}))&&(e.oLocalAmount.HeaderAppearance.IsVisible=!0))),e.ViewModel.ReportColumns=R,e.oColumns=e.ViewModel.ReportColumns,e.AggTotal=i.e.NumArray(e.oColumns.length,5)}();else if(2==this.ViewModel.StaticReportType||3==this.ViewModel.StaticReportType)this.IncludeBFInTotals=!this.ViewModel.Preferences.ContainsKey("AddOpeningBalance")||"0"!=this.ViewModel.Preferences.AddOpeningBalance,this.GLJVDetails=!(!this.ViewModel.Preferences.ContainsKey("GLJVDetails")||"1"!=this.ViewModel.Preferences.GLJVDetails),2==this.ViewModel.StaticReportType?this.strAccountType="AND A1.AccountTypeID=1":3==this.ViewModel.StaticReportType&&(this.strAccountType="AND (A1.AccountTypeID=2 OR A1.AccountTypeID=3)"),h="SELECT A1.AccountID,A1.AccountTypeID,A1.AccountName,A1.GLClubTranBy"+this.ViewModel.GroupSelectTag+" FROM ACC_Accounts A1 with(nolock)"+this.ViewModel.GroupFromTag+this.GTPQuery+" WHERE A1.IsGroup=0 "+this.strAccountType,h+=this.GetAccountWiseLocationWhere("A1"),this.GTPWhere.length>0&&(h+=" AND "+this.GTPWhere),h+=" Order By A1.AccountName";else if(4==this.ViewModel.StaticReportType){if(-1!=this.colBalanceIndex?this.oColumns[this.colBalanceIndex].DataFormat.DecimalsPoints>0&&(this.dec="N"+this.oColumns[this.colBalanceIndex].DataFormat.DecimalsPoints.toString()):this.dec="N"+s.a.SessionManager.Preferences.DecimalsinAmount,this.Show=D.None,this.ViewModel.Preferences.ContainsKey("FinalReportsShow")){var R=this.ViewModel.Preferences.FinalReportsShow;"1"==R?(this.Show=D.MonthWise,this.ViewModel.oReportDialog.FromDate.Date.getMonth()==this.ViewModel.oReportDialog.ToDate.Date.getMonth()&&(this.ViewModel.oReportDialog.FromDate.Date.getFullYear(),this.ViewModel.oReportDialog.ToDate.Date.getFullYear()),-1!=this.colTBTr_CrIndex&&-1!=this.colTBTr_DrIndex&&-1!=this.colTBOp_DrIndex&&-1!=this.colBalanceIndex||(this.Show=D.None)):"2"==R&&(this.Show=D.TagWise,this.TagID=parseInt(this.ViewModel.Preferences.FinalReportsShowTag),this.ViewModel.Preferences.ContainsKey("FinalReportsShowTagHideColumns")&&(this.HideEmptyDimensions=!0),this.TagColumnName="Name",this.ViewModel.Preferences.ContainsKey("FinalReportsShowTagColumn")&&("0"==this.ViewModel.Preferences.FinalReportsShowTagColumn?this.TagColumnName="Code":"2"==this.ViewModel.Preferences.FinalReportsShowTagColumn&&(this.TagColumnName="Code+'-'+Name")))}else if(this.ViewModel.Preferences.ContainsKey("TagWise")){var S=new i.f;S.LoadXml("<XML>"+this.ViewModel.Preferences.TagWise+"</XML>");var A=i.f.SelectSingleNode(S.DocumentElement,"IsChecked");null!=A&&"1"==A.innerHTML&&(this.Show=D.TagWise,A=i.f.SelectSingleNode(S.DocumentElement,"Value"),this.TagID=parseInt(A.innerHTML),this.TagTableName=o.GetTagTableName(this.TagID),this.HideEmptyDimensions=null!=i.f.SelectSingleNode(S.DocumentElement,"HideColumns"),this.TagColumnName="Name",null!=(A=i.f.SelectSingleNode(S.DocumentElement,"Column"))&&("0"==A.innerHTML?this.TagColumnName="Code":"2"==A.innerHTML&&(this.TagColumnName="Code+'-'+Name")))}this.AccountsWithOutTransactions="1"==this.ViewModel.Preferences.WantAccountsWithoutTransactions,this.AccountsWithZeroBalance="1"==this.ViewModel.Preferences.WantAccountsWithZeroBalances,this.TBIsAccountWise="1"==this.ViewModel.Preferences.AccountWise,this.TBOpeningDrCrSeperately="1"==this.ViewModel.Preferences.ShowOpeningDrCrSeperately,this.TBTransactionsDrCrSeperately="1"==this.ViewModel.Preferences.ShowTransactionsDrCrSeperately,this.TBShowdetailsofControlGroups=!(!this.ViewModel.Preferences.ContainsKey("ShowdetailsofControlGroups")||"1"!=this.ViewModel.Preferences.ShowdetailsofControlGroups),this.LevelNo=parseInt(this.ViewModel.Preferences.Level),this.PDCInclude=!(!this.ViewModel.Preferences.ContainsKey("IncludePDCs")||"1"!=this.ViewModel.Preferences.IncludePDCs),this.GroupTotalsAtEnd=!(!this.ViewModel.Preferences.ContainsKey("GroupTotalsAtEnd")||"1"!=this.ViewModel.Preferences.GroupTotalsAtEnd),this.GroupTotalsSeperate=!(!this.ViewModel.Preferences.ContainsKey("GroupTotalsSeperate")||"1"!=this.ViewModel.Preferences.GroupTotalsSeperate),this.DontShowSummaryGroupTotals=!(!this.ViewModel.Preferences.ContainsKey("DontShowSummaryGroupTotals")||"1"!=this.ViewModel.Preferences.DontShowSummaryGroupTotals),this.IsTTypeTB=!(!this.ViewModel.Preferences.ContainsKey("TType")||"1"!=this.ViewModel.Preferences.TType),this.IsTTypeTB||(this.OpDrCrInOpDr=!(!this.ViewModel.Preferences.ContainsKey("OpDrCrInOpDr")||"1"!=this.ViewModel.Preferences.OpDrCrInOpDr)),this.dtYearStartMonth=new Date((new Date).getFullYear(),this.AccountingFromMonth-1,1),this.dtYearStartMonth>Date.Today()&&(this.dtYearStartMonth=this.dtYearStartMonth.AddYears(-1))}else if(86==this.ViewModel.StaticReportType){this.STAccountWise=!0,this.STMonthWise=!1,this.STDayWise=!1,this.IncludeBFInTotals=!(!this.ViewModel.Preferences.ContainsKey("AddOpeningBalance")||"1"!=this.ViewModel.Preferences.AddOpeningBalance),this.AccountsWithOutTransactions="1"==this.ViewModel.Preferences.WantAccountsWithoutTransactions,this.AccountsWithZeroBalance="1"==this.ViewModel.Preferences.WantAccountsWithZeroBalances,this.TBTransactionsDrCrSeperately=!(!this.ViewModel.Preferences.ContainsKey("ShowTransactionsDrCrSeperately")||"1"!=this.ViewModel.Preferences.ShowTransactionsDrCrSeperately),this.PDCInclude=!(!this.ViewModel.Preferences.ContainsKey("IncludeUnPostedDocsList")||"1"!=this.ViewModel.Preferences.IncludePDCs),this.PDCSeperate=!1,this.PDCDrCrSeperate=!1,this.UnPostedDocsSeparately=!1,this.ExcludeOpBalance=!(!this.ViewModel.Preferences.ContainsKey("ExcludeOpBalance")||"1"!=this.ViewModel.Preferences.ExcludeOpBalance),this.TagID=0;var M=this.ViewModel.BaseReportColumns.find((function(e){return"DocumentName"==e.ID}));if(M)if(M.CDGDO.ColumnCostCenterID>5e4)this.TagID=M.CDGDO.ColumnCostCenterID,this.TagTableName=o.GetTagTableName(this.TagID);else if(400==M.CDGDO.CategoryValue&&"DocDate"==M.CDGDO.Column&&null!=M.CDGDO.Formula&&(M.CDGDO.Formula.toUpperCase().Contains("MMM")||M.CDGDO.Formula.toUpperCase().Contains("MONTH"))){this.TagID=-100;var g=this.oColumns.find((function(e){return"DocumentName"==e.ID}));g&&(g.Formula="")}h="SELECT A1.AccountID,A1.AccountTypeID,A1.AccountName"+this.ViewModel.GroupSelectTag+" FROM ACC_Accounts A1 with(nolock)"+this.ViewModel.GroupFromTag+this.GTPQuery+" WHERE A1.IsGroup=0 and A1.AccountID>1 ",h+=this.GetAccountWiseLocationWhere("A1"),this.GTPWhere.length>0&&(h+=" AND "+this.GTPWhere);var w,f="",E="";this.LocationWhere.length>0&&(f=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.AccDocDetailsID=ACC.AccDocDetailsID "+this.LocationWhere,E=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=ACC.InvDocDetailsID "+this.LocationWhere),w=" WHERE DocDate BETWEEN CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"')) AND CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",this.AccountsWithOutTransactions?h+=" AND A1.AccountID IN (SELECT CreditAccount FROM ACC_DocDetails AS Cr with(nolock) UNION SELECT DebitAccount FROM ACC_DocDetails AS Dr with(nolock))":(h+=" AND A1.AccountID IN (SELECT CreditAccount FROM ACC_DocDetails ACC WITH(NOLOCK) "+f+w,h+=" UNION SELECT DebitAccount FROM ACC_DocDetails ACC WITH(NOLOCK) "+f+w,E.length>0&&(h+=" UNION SELECT CreditAccount FROM ACC_DocDetails ACC WITH(NOLOCK) "+E+w,h+=" UNION SELECT DebitAccount FROM ACC_DocDetails ACC WITH(NOLOCK) "+E+w),h+=")"),this.SetRetainedEarnings(),h+="^strRetainedAccounts^",h+="Code"==this.ViewModel.Preferences.TreeSortOn?" Order By A1.AccountCode":"TreeOrder"==this.ViewModel.Preferences.TreeSortOn?" Order By A1.lft":" Order By A1.AccountName"}else if(156==this.ViewModel.StaticReportType){if(this.STAccountWise=this.ViewModel.Preferences.SubTotals.Contains("AccountWise"),this.STMonthWise=this.ViewModel.Preferences.SubTotals.Contains("MonthWise"),this.STDayWise=this.ViewModel.Preferences.SubTotals.Contains("DayWise"),this.IncludeBFInTotals="1"==this.ViewModel.Preferences.AddOpeningBalance,this.AccountsWithOutTransactions="1"==this.ViewModel.Preferences.WantDimensionsWithoutTransactions,this.AccountsWithZeroBalance=!(!this.ViewModel.Preferences.ContainsKey("WantDimensionsWithZeroBalances")||"1"!=this.ViewModel.Preferences.WantDimensionsWithZeroBalances),this.PDCInclude="1"==this.ViewModel.Preferences.IncludePDCs,this.PDCSeperate="1"==this.ViewModel.Preferences.PDCsSeparately,this.PDCDrCrSeperate="1"==this.ViewModel.Preferences.ShowDebitCreditSeparated,this.UnPostedDocsSeparately=!(!this.ViewModel.Preferences.ContainsKey("UnPostedDocsSeparately")||"1"!=this.ViewModel.Preferences.UnPostedDocsSeparately),this.TagID=0,this.ShowTagWise=!1,1==this.ViewModel.lstGroup.length&&this.ViewModel.ReportGroups[0].CDGDO.ColumnCostCenterID>5e4&&(this.TagID=this.ViewModel.ReportGroups[0].CDGDO.ColumnCostCenterID,this.TagTableName=o.GetTagTableName(this.TagID)),h="SELECT A1.NodeID,A1.Name TagName"+this.ViewModel.GroupSelectTag+" FROM "+this.TagTableName+" A1 with(nolock)"+this.ViewModel.GroupFromTag+" WHERE A1.IsGroup=0 ",!this.ViewModel.HideCostCenterTree)if(this.TagID<5e4||this.TagID==this.ViewModel.oReportDialog.TreeCCID){var P=c.split(",");P.Contains("1")||P.Contains("0")||(h+=" AND A1.NodeID IN ("+c+")")}else{var y=this.GetFilterByDimension_1(this.TagID);y.length>0&&(h+=" AND A1.NodeID IN ("+y+")")}h+="Code"==this.ViewModel.Preferences.TreeSortOn?" Order By A1.Code":"TreeOrder"==this.ViewModel.Preferences.TreeSortOn?" Order By A1.lft":" Order By A1.Name",this.AggTotal=i.e.NumArray(this.oColumns.length,5)}else 169==this.ViewModel.StaticReportType&&(this.GLJVDetails=!(!this.ViewModel.Preferences.ContainsKey("GLJVDetails")||"1"!=this.ViewModel.Preferences.GLJVDetails),h="SELECT A1.AccountID,A1.AccountName FROM ACC_Accounts A1 with(nolock)"+this.GTPQuery+" WHERE A1.IsGroup=0 ",h+=this.GetAccountTypeWhere("A1"),h+=this.GetAccountWiseLocationWhere("A1"),this.GTPWhere.length>0&&(h+=" AND "+this.GTPWhere),h+=" Order By A1.AccountName");if(1==this.ViewModel.StaticReportType)this.promiseRE?this.promiseRE.then((function(){e.GLStart(h)})):this.GLStart(h);else if(2==this.ViewModel.StaticReportType||3==this.ViewModel.StaticReportType)s.a.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,h).then((function(t){e.dsAccount=t,e.al=[],e.al.push(""),e.al.push(""),e.al.push(null),e.al.push(0),e.al.push(e.GLClubTranBy),e.al.push(e.ViewModel.oReportDialog.FromDate.Date),e.al.push(e.ViewModel.oReportDialog.ToDate.Date),e.al.push(e.UnPostedDocsList),e.al.push(e.PDCInclude),e.al.push(!1),e.al.push(!0),e.al.push(!1),e.al.push(!1),e.al.push(""),e.al.push(""),e.al.push(0),e.al.push(e.ViewModel.StaticReportType),e.al.push(""),e.al.push(3!=e.ViewModel.StaticReportType||"ChequeDate"!=e.ViewModel.Preferences.DateFilter&&"MaturityDate"!=e.ViewModel.Preferences.DateFilter?"":e.ViewModel.Preferences.DateFilter),e.al.push(e.RoundOff),e.al.push(0),e.al.push(""),e.al.push(0),e.al.push(e.LocationWhere+e.GetDimensionFilter("DCC.dcCCNID")),e.al.push(e.ShowGL_INVDetailReport),e.al.push(e.ShowGL_ACCDetailReport),e.al.push(e.CurrencyType),e.al.push(e.ForeignCurrencyID),e.al.push(e.GLJVDetails),e.al.push(""),e.al.push(e.ViewModel.SelectTag+e.ViewModel.GroupSelectTag),e.al.push(e.ViewModel.FromTag+e.ViewModel.GroupFromTag);var o=e.ViewModel.SelectTagAliasOnly+e.ViewModel.GroupSelectTagAlias;if(o.length>0&&!e.ShowGL_INVDetailReport&&0==e.ShowGL_ACCDetailReport){var i=o.Trim(",").split(",");o="";for(var l=0;l<i.length;l++)o+=",MAX("+i[l]+") "+i[l]}e.al.push(o),e.al.push(s.a.SessionManager.LanguageID),e.ViewModel.DisplayMessage="",e.TempChunkSize=0,e.GLClubTranBy=0,e.iLoop=0,e.CBCallBack()}));else if(4==this.ViewModel.StaticReportType)this.IsTTypeTB?(this.YTDIndex=-1,this.BAL_LYIndex=-1,this.YTD_LYIndex=-1,this.Show=D.None,this.GroupTotalsSeperate=!1,this.GroupTotalsAtEnd=!1,this.TBOpeningDrCrSeperately=!1,this.TBTransactionsDrCrSeperately=!1,this.ViewModel.IsReportCollapsable=!1):this.ViewModel.IsReportCollapsable=!0,this.SetTrialBalanceDataSet(c).then((function(t){e.dv=e.ds.Tables[0],e.dvTable=e.ds.Tables[0],e.dvColumns=e.ds.Columns[0],e.ds.Columns[0].push("CL_Dr"),e.ds.Columns[0].push("CL_Cr"),e.ds.Columns[0].push("NetBalance"),e.IsFCClosingDebitExists&&(e.ds.Columns[0].push("FCClosingDebit"),e.ds.Columns[0].push("FCClosingCredit"));var o=new Array;if(e.IsTTypeTB){e.BalIndex=-1,e.CellStartPos=0;for(var i=0;i<e.ViewModel.ColumnSource.length;i++)"AccountCode"==e.ViewModel.ColumnSource[i].ID?o.push(e.ViewModel.ColumnSource[i]):"AccountName"==e.ViewModel.ColumnSource[i].ID&&(o.push(e.ViewModel.ColumnSource[i]),e.TTAccNameIndex=o.length-1);if(-1==e.colTBCl_DrIndex)return void(e.ViewModel.DisplayMessage="Please Enable Closing Debit Column");if(-1==e.colTBCl_CrIndex)return void(e.ViewModel.DisplayMessage="Please Enable Closing Credit Column");o.push(e.ViewModel.ColumnSource[e.colTBCl_DrIndex].Clone()),e.BalIndex=o.length-1,e.TTColumnSize=o.length;for(var l=0;l<e.TTColumnSize-1;l++)o.push(o[l].Clone());o.push(e.ViewModel.ColumnSource[e.colTBCl_CrIndex].Clone())}else{for(var n=0;n<e.ViewModel.ColumnSource.length;n++)o.push(e.ViewModel.ColumnSource[n]);if(e.GroupTotalsSeperate){var a=e.ViewModel.ColumnSource[e.ViewModel.ColumnSource.length-1].Clone();a.HeaderText="TOTAL",a.ID="GroupTotal",o.push(a),e.GroupTotalIndex=o.length-1}if(e.ViewModel.lstGroup.length>0&&(e.ViewModel.GrpReportTotal.TotalCols.Clear(),e.ViewModel.TotalCols.Clear(),e.ViewModel.lstGroup.forEach((function(e){e.TotalCols.Clear()})),e.ViewModel.GrpReportTotal.TempTotalCols.keys.forEach((function(t){var s=o.find((function(e){return e.ID==t}));if(s){var i=o.indexOf(s);e.ViewModel.TotalCols.Contains(t)||e.ViewModel.TotalCols.push(t),e.ViewModel.GrpReportTotal.TotalCols.push(t,i)}})),e.ViewModel.lstGroup.forEach((function(t){t.TempTotalCols.forEach((function(s){var i=o.find((function(e){return e.ID==s.Key}));if(i){var l=o.indexOf(i);e.ViewModel.TotalCols.Contains(s.Key)||e.ViewModel.TotalCols.push(s.Key),t.TotalCols.push(s.Key,l)}}))}))),e.Show!=D.None){var r=o.length,h=o[o.length-1].Clone();if(e.Show==D.TagWise){var u=e.GetTagWiseQuery(e.TagID,e.TagColumnName,"Name");s.a.report.DataSet("RPT022",u).Tables[0].forEach((function(t){if(e.dv=e.dvTable.filter((function(e){return e.Tag==t.NodeID})),e.dv.length>0){var s=h.Clone();s.HeaderText=t.Name.toString(),s.ID=t.NodeID.toString(),o.push(s),++e.CountMonths,e.ds.Columns[0].push(s.ID)}})),e.dv=e.dvTable}else if(e.Show==D.MonthWise){for(var c=new Date(e.ViewModel.oReportDialog.FromDate.Date.getFullYear(),e.ViewModel.oReportDialog.FromDate.Date.getMonth(),1);c<=e.ViewModel.oReportDialog.ToDate.Date;){var d=void 0;(d=h.Clone()).HeaderText=c.ToString(" MMM-yy")+"\r\n"+e.ViewModel.ReportColumns[e.colTBOp_DrIndex].HeaderText,d.ID="OpDr"+c.getFullYear()+"-"+c.iMonth(),o.push(d),e.ds.Columns[0].push(d.ID),(d=h.Clone()).HeaderText=c.ToString(" MMM-yy")+"\r\n"+e.ViewModel.ReportColumns[e.colTBTr_DrIndex].HeaderText,d.ID="TrDr"+c.getFullYear()+"-"+c.iMonth(),d.DataFormat.NegativeNumber=0,o.push(d),e.ds.Columns[0].push(d.ID),(d=h.Clone()).HeaderText=c.ToString(" MMM-yy")+"\r\n"+e.ViewModel.ReportColumns[e.colTBTr_CrIndex].HeaderText,d.ID="TrCr"+c.getFullYear()+"-"+c.iMonth(),d.DataFormat.NegativeNumber=0,o.push(d),e.ds.Columns[0].push(d.ID),(d=h.Clone()).HeaderText=c.ToString(" MMM-yy")+"\r\n"+e.ViewModel.ReportColumns[e.colBalanceIndex].HeaderText,d.ID="Net"+c.getFullYear()+"-"+c.iMonth(),o.push(d),e.ds.Columns[0].push(d.ID),e.lstTags.push(c.getFullYear()+"-"+c.iMonth()),++e.CountMonths,c=e.Show==D.MonthWise?c.AddMonths(1):c.AddYears(1)}o[0].HeaderHeight<40&&(o.forEach((function(e){e.HeaderHeight=45})),h.HeaderHeight=45)}if(e.ViewModel.lstGroup.length>0)for(var C=function(t){"FLOAT"==o[t].ColumnType&&(e.ViewModel.TotalCols.Contains(o[t].ID)||e.ViewModel.TotalCols.push(o[t].ID),e.ViewModel.GrpReportTotal.TotalCols.ContainsKey(o[t].ID)||e.ViewModel.GrpReportTotal.TotalCols.push(o[t].ID,t),e.ViewModel.lstGroup.forEach((function(e){e.TotalCols.ContainsKey(o[t].ID)||e.TotalCols.push(o[t].ID,t)})))},p=r;p<o.length;p++)C(p)}}e.ViewModel.ReportColumns=o,e.oColumns=e.ViewModel.ReportColumns,e.TBIsAccountWise&&e.UpdateDataTableWithGroups(),e.IsTTypeTB?e.addTrialBalanceTType():e.addTrialBalance(),e.LoadReportComplete()}));else if(86==this.ViewModel.StaticReportType)this.promiseRE?this.promiseRE.then((function(){e.GLSummaryStart(h)})):this.GLSummaryStart(h);else if(156==this.ViewModel.StaticReportType)s.a.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,h).then((function(t){e.dsAccount=t,e.al=[],e.al.push(e.ViewModel.Preferences.ContainsKey("AccountTypesFilter")?e.ViewModel.Preferences.AccountTypesFilter:""),e.al.push(e.ViewModel.oReportDialog.FromDate.Date),e.al.push(e.ViewModel.oReportDialog.ToDate.Date),e.al.push(e.UnPostedDocsList),e.al.push(e.PDCInclude),e.al.push(e.IncludeUnApprovedPDC),e.al.push(e.IncludeTerminatedPDC),e.al.push(e.PDCSeperate),e.al.push(e.PDCDrCrSeperate),e.al.push(e.ViewModel.Preferences.FilterOn),e.al.push(e.ViewModel.Preferences.SortOn),e.al.push(e.TagID),e.al.push(o.GetTagTableName(e.TagID));var i,l=e.LocationWhere+e.GetDimensionFilter("DCC.dcCCNID");(i=e.GetFilterByDimension_1(300)).length>0&&(l+=" AND D.CostCenterID IN ("+i+")"),(i=e.GetFilterByDimension_1(2)).length>0&&(l+=" AND A.AccountID IN ("+i+")"),e.al.push(l),e.al.push(e.ShowGL_INVDetailReport),e.al.push(e.ShowGL_ACCDetailReport),e.al.push(e.CurrencyType),e.al.push(e.ForeignCurrencyID),e.al.push(e.ViewModel.SelectTag+e.ViewModel.GroupSelectTag),e.ViewModel.DocumentFilters.ContainsKey("CONTRACTNODEID")?(e.IsSalesContractLedger=!0,e.al.push("AND D.RefCCID="+e.ViewModel.DocumentFilters.CONTRACTRefCCID+" AND D.RefNodeid='"+e.ViewModel.DocumentFilters.CONTRACTNODEID+"' "+e.ViewModel.FromTag+e.ViewModel.GroupFromTag)):e.al.push(e.ViewModel.FromTag+e.ViewModel.GroupFromTag);var n=e.ViewModel.SelectTagAliasOnly+e.ViewModel.GroupSelectTagAlias;if(n.length>0&&!e.ShowGL_INVDetailReport&&0==e.ShowGL_ACCDetailReport){var a=n.Trim(",").split(",");n="";for(var r=0;r<a.length;r++)n+=",MAX("+a[r]+") "+a[r]}e.al.push(n),e.al.push(0),e.al.push(s.a.SessionManager.LanguageID),e.ViewModel.DisplayMessage="",s.a.report.GetGLOnlyDimension(e.al,e.ViewModel.IsReportDB).then((function(t){for(e.ds=t,e.DataSetCollection.push(e.ds),e.dvAccount=e.ds.Tables[0],e.dvAccountTable=e.ds.Tables[0],e.dvAccountColumns=e.ds.Columns[0],e.jAccount=0;e.jAccount<e.dsAccount.Tables[0].length;e.jAccount++){if(e.ViewModel.process.CancellationPending)return void(e.ViewModel.processArgs.Cancel=!0);e.strAccountID=e.dsAccount.Tables[0][e.jAccount].NodeID.toString(),e.strAccountFilterObj={},e.strAccountFilterObj.TAG=e.strAccountID,e.strAccountName=e.dsAccount.Tables[0][e.jAccount].TagName.toString(),e.dv=e.ds.Tables[1],e.dvTable=e.ds.Tables[1],e.dvColumns=e.ds.Columns[1],e.dvAccount=e.dvAccountTable.fill((function(t){return t.TAG==e.strAccountID})),e.dv=e.dvTable.fill((function(t){return t.TAG==e.strAccountID})),e.ds.Tables.length>2&&(e.dvTbl2=e.ds.Tables[2].filter((function(t){return t.TAG==e.strAccountID})),e.dvTbl2Table=e.ds.Tables[2],e.dvTbl2Columns=e.ds.Columns[2]),e.AllowAddRows=!!(e.dv.length>0||e.AccountsWithOutTransactions||e.ds.Tables.length>2&&e.dvTbl2.length>0),e.UnPostedDocsInclude&&e.UnPostedDocsSeparately&&(e.strAccountFilterObj.StatusID=[369,429],e.dv=e.dv.filter((function(e){return 369==e.StatusID||429==e.StatusID}))),e.OpBalance=e.dvAccount.length>0?parseFloat(e.dvAccount[0].BF):0,e.AllowAddRows&&(e.AccountsWithZeroBalance||0!=e.GetBalance())&&(e.IsNewAccount=!0,e.addGeneralLedger())}})).then((function(t){e.LoadReportComplete()}))}));else if(157==this.ViewModel.StaticReportType&&this.ViewModel.Preferences.ContainsKey("VerticalReport")){this.PDCInclude="1"==this.ViewModel.Preferences.IncludePDCs,this.ShowMonthWise="1"==this.ViewModel.Preferences.MonthWiseData,this.ExcludeOpBalance=!(!this.ViewModel.Preferences.ContainsKey("ExcludeOpBalance")||"1"!=this.ViewModel.Preferences.ExcludeOpBalance),this.PDCSeperate=!(!this.ViewModel.Preferences.ContainsKey("PDCsSeparately")||"1"!=this.ViewModel.Preferences.PDCsSeparately),this.ExcludeClBalance=!(!this.ViewModel.Preferences.ContainsKey("ExcludeClBalance")||"1"!=this.ViewModel.Preferences.ExcludeClBalance),this.LevelNo=0;this.ViewModel.HideCostCenterTree||(this.ViewModel.oReportDialog.IsOneSelected||this.ViewModel.oReportDialog.IsZeroSelected)&&(c="");var O=[];O.push(!0),O.push(this.GTPQuery),O.push(this.GTPWhere),O.push(this.ViewModel.oReportDialog.FromDate.Date),O.push(this.ViewModel.oReportDialog.ToDate.Date),O.push(this.UnPostedDocsList),O.push(this.PDCSeperate),O.push(this.PDCInclude),O.push(this.IncludeTerminatedPDC),O.push(this.LocationWhere+this.GetDimensionFilter("DCC.dcCCNID")),O.push(!1),O.push(this.ShowMonthWise),O.push(s.a.SessionManager.LanguageID),s.a.report.GetReceiptsPayments(O,this.ViewModel.IsReportDB).then((function(t){e.ds=t;var o=0,l=[],n=new Array,r=e.ViewModel.ColumnSource.find((function(e){return"Rec_Name"==e.ID})).Clone(),h=e.ViewModel.ColumnSource.find((function(e){return"Rec_Amount"==e.ID})).Clone();if(r.ID="Account",r.HeaderText="",h.ID="Amount",n.push(r),n.push(h),1,e.ShowMonthWise){h.HeaderText="TOTAL";for(var u,c=new Date(e.ViewModel.FromDatePicker.Date.getFullYear(),e.ViewModel.FromDatePicker.Date.getMonth(),1);c<=e.ViewModel.ToDatePicker.Date;){o++;var D=h.Clone();D.HeaderText=c.ToString("MMM yyyy"),D.ID=c.getFullYear()+"_"+c.getMonth(),l.push(D.ID),e.ds.Columns[0].push(D.ID),e.ds.Columns[1].push(D.ID),e.ds.Columns[2].push(D.ID),n.InsertAt(D,o),c=c.AddMonths(1)}for(var d,C=null,p=0;p<e.ds.Tables[1].length;p++)u=(d=e.ds.Tables[1][p]).YM.toString(),C!=d.AccountID.toString()?(C=d.AccountID.toString(),u.length>0&&e.ds.Columns[1].Contains(u)&&(d[u]=d.Amount)):(u.length>0&&e.ds.Columns[1].Contains(u)&&(e.ds.Tables[1][p-1][u]=d.Amount,null!=d.Amount&&(e.ds.Tables[1][p-1].Amount=null!=e.ds.Tables[1][p-1][u]?parseFloat(e.ds.Tables[1][p-1].Amount)+parseFloat(d.Amount):parseFloat(d.Amount))),e.ds.Tables[1].RemoveAt(p),p--);for(var T=0;T<e.ds.Tables[2].length;T++)(u=(d=e.ds.Tables[2][T]).YM.toString()).length>0&&e.ds.Columns[2].Contains(u)&&(T>0?(e.ds.Tables[2][0][u]=d.Amount,e.ds.Tables[2].RemoveAt(T),T--):d[u]=d.Amount)}if(e.ViewModel.ReportColumns=n,e.oColumns=e.ViewModel.ReportColumns,e.AggTotal=i.e.NumArray(e.oColumns.length,6),e.ds.Columns[0].push("Amount"),!e.ExcludeOpBalance){e.oRow=e.NewReportRow_2(a.f.BalanceBF,e.GrossTotalAppearance_Data),e.oRow.Cells[0].Text=s.a.GetResource("Reports_OpeningBalance"),e.oRow.Cells[0].CellAppearance.Alignment="Left",e.ViewModel.addRow(e.oRow);var _=0;if(e.ds.Tables[0].length>0&&e.ds.Columns[0].Contains("OpAmount")&&null!=e.ds.Tables[0][0].OpAmount&&(_=parseFloat(e.ds.Tables[0][0].OpAmount)),e.ShowMonthWise){for(var m=_,I=0;I<l.length;I++)e.AggTotal[1+I][0]=m,e.ds.Tables[0][0][l[I]]=m,null!=e.ds.Tables[2][0][l[I]]&&(m+=parseFloat(e.ds.Tables[2][0][l[I]])),e.ds.Tables[2][0][l[I]]=m;e.AggTotal[1+l.length][0]=_}else e.AggTotal[1][0]=_;for(var R=0;R<e.oColumns.length;R++)"FLOAT"==e.oColumns[R].ColumnType&&e.ViewModel.SetCellValue(e.AggTotal[R][0],e.oColumns[R].DataFormat,e.oColumns[R].ColumnType,e.oRow.Cells[R])}e.dv=e.ds.Tables[1],e.dvTable=e.ds.Tables[1],e.dvColumns=e.ds.Columns[1],e.dv=e.dvTable.filter(e.PDCSeperate?function(e){return e.Amount>0&&370!=e.StatusID&&439!=e.StatusID}:function(e){return e.Amount>0}),e.AddSection_RPVertical(1),e.PDCSeperate&&(e.dv=e.dvTable.filter((function(e){return e.Amount>0&&(370==e.StatusID||439==e.StatusID)})),e.AddSection_RPVertical(3)),e.dv=e.dvTable.filter(e.PDCSeperate?function(e){return e.Amount<0&&370!=e.StatusID&&439!=e.StatusID}:function(e){return e.Amount<0}),e.AddSection_RPVertical(2),e.PDCSeperate&&(e.dv=e.dvTable.filter((function(e){return e.Amount<0&&(370==e.StatusID||439==e.StatusID)})),e.AddSection_RPVertical(4)),e.oRow=e.NewReportRow_2(a.f.BalanceBF,e.GrossTotalAppearance_Data),e.oRow.Cells[0].Text=s.a.GetResource("Reports_ClosingBalance"),e.oRow.Cells[0].CellAppearance.Alignment="Left",e.ViewModel.addRow(e.oRow);for(var S=0;S<e.oColumns.length;S++)"FLOAT"==e.oColumns[S].ColumnType&&e.ViewModel.SetCellValue(e.AggTotal[S][0]+e.AggTotal[S][1]+e.AggTotal[S][3]+e.AggTotal[S][2]+e.AggTotal[S][4],e.oColumns[S].DataFormat,e.oColumns[S].ColumnType,e.oRow.Cells[S])})).then((function(t){e.LoadReportComplete()}))}else if(157==this.ViewModel.StaticReportType){this.PDCInclude="1"==this.ViewModel.Preferences.IncludePDCs,this.ExcludeClBalance=!(!this.ViewModel.Preferences.ContainsKey("ExcludeClBalance")||"1"!=this.ViewModel.Preferences.ExcludeClBalance),this.ShowMonthWise="1"==this.ViewModel.Preferences.MonthWiseData,this.ShowMonthWise=!1,this.LevelNo=0;var b=!1;if(this.ViewModel.Preferences.ContainsKey("ShowLevel")){var N=new i.f;N.LoadXml("<XML>"+this.ViewModel.Preferences.ShowLevel+"</XML>");var V=i.f.SelectSingleNode(N.DocumentElement,"IsChecked");null!=V&&"1"==V.innerHTML&&(b=!0,V=i.f.SelectSingleNode(N.DocumentElement,"Text"),this.LevelNo=i.e.Int(V.innerHTML))}this.ViewModel.HideCostCenterTree||(this.ViewModel.oReportDialog.IsOneSelected||this.ViewModel.oReportDialog.IsZeroSelected)&&(c="");var v=[];v.push(!1),v.push(this.GTPQuery),v.push(this.GTPWhere),v.push(this.ViewModel.oReportDialog.FromDate.Date),v.push(this.ViewModel.oReportDialog.ToDate.Date),v.push(this.UnPostedDocsList),v.push(!1),v.push(this.PDCInclude),v.push(this.IncludeTerminatedPDC),v.push(this.LocationWhere+this.GetDimensionFilter("DCC.dcCCNID")),v.push(b),v.push(this.ShowMonthWise),v.push(s.a.SessionManager.LanguageID),s.a.report.GetReceiptsPayments(v,this.ViewModel.IsReportDB).then((function(t){e.ds=t;for(var o,l,n,r=0,h=[],u=e.ViewModel.ColumnSource[1],c=new Array,D=0;D<e.ViewModel.ColumnSource.length;D++)c.push(e.ViewModel.ColumnSource[D]);if(e.ShowMonthWise)for(var d=new Date(e.ViewModel.FromDatePicker.Date.getFullYear(),e.ViewModel.FromDatePicker.Date.getMonth(),1);d<=e.ViewModel.ToDatePicker.Date;){h.push("R"+d.getMonth()+"_"+d.getFullYear()),r++;var C=u.Clone();C.HeaderText=d.ToString("MMM yyyy"),C.ID="R"+d.getFullYear()+"_"+d.getMonth(),e.ds.Columns[0].push(C.ID),e.ds.Columns[1].push(C.ID),e.ds.Columns[2].push(C.ID),c.InsertAt(C,r),(C=u.Clone()).HeaderText=d.ToString("MMM yyyy"),C.ID="P"+d.getFullYear()+"_"+d.getMonth(),e.ds.Columns[0].push(C.ID),e.ds.Columns[1].push(C.ID),e.ds.Columns[2].push(C.ID),c.InsertAt(C,c.length-1),d=d.AddMonths(1)}if(e.ViewModel.ReportColumns=c,e.oColumns=e.ViewModel.ReportColumns,e.AggTotal=i.e.NumArray(e.oColumns.length,4),e.ds.Columns[0].push("Rec_Amount"),e.ds.Columns[0].push("Pay_Amount"),e.oRow=e.NewReportRow_2(a.f.BalanceBF,e.GrossTotalAppearance),e.oRow.Cells[0].ColSpan=e.oColumns.length,e.oRow.Cells[0].Text=s.a.GetResource("Reports_OpeningBalance"),e.ViewModel.addRow(e.oRow),e.ShowMonthWise)!function(){for(var t,o,s=e.ds.Tables[0],i=null,l=e.ds.Tables[2].length-1;l>=0;l--){if(o=(t=e.ds.Tables[2][l]).YM.toString(),e.dbl=parseFloat(t.Amount),i!=t.AccountID.toString()){if(i=t.AccountID.toString(),0==(s=e.ds.Tables[0].filter((function(e){return e.AccountID==i}))).length){var n={};n.AccountID=t.AccountID,n.Rec_Name=t.Rec_Name.toString(),n.Amount=0,s.push(n)}}else e.ds.Tables[2].RemoveAt(l),t=e.ds.Tables[2][l+1];e.dbl>0?(t["R"+o]=e.dbl,t.Rec_Amount=e.dbl):(t["P"+o]=-e.dbl,t.Pay_Amount=-e.dbl)}i=null;for(var a=0;a<e.ds.Tables[0].length;a++)o=(t=e.ds.Tables[0][a]).YM.toString(),e.dbl=parseFloat(t.Amount),i!=t.AccountID.toString()?(t.AccountID.toString(),i=t.AccountID.toString()):(e.ds.Tables[2].RemoveAt(a),t=e.ds.Tables[2][a+1]),e.dbl>0?(t["R"+o]=e.dbl,t.Rec_Amount=e.dbl):(t["P"+o]=-e.dbl,t.Pay_Amount=-e.dbl)}();else if(b){e.CallFrom=1,e.GrdRow=e.ViewModel.Data.length-1;var p=e.ds.Tables[0];p.Columns=e.ds.Columns,p.Columns.Rec_Name.ColumnName="Account",p.Merge(e.ds.Tables[3]),e.dv=p.AsDataView(),e.dv.SortBy(["lft"]),e.IsFirstCall=!0,e.FirstTypeEndIndex=0,e.CellStartPos=0,e.GrdRow=e.ViewModel.Data.length-1,e.dv.forEach((function(t){e.AddRow_RP(t)})),e.UpdateTreeTotals_RP(0)}else e.ds.Tables[0].forEach((function(t){e.dbl=parseInt(t.Amount),Math.abs(e.dbl)>=.001&&(e.oRow=new a.d(e.oColumns.length,e.ViewModel.RowHeight),e.oRow.Type=a.f.Detail,e.oRow.DataRow=t,e.oRow.NodeID=parseInt(t.AccountID),e.ViewModel.SetCellValue(t.Rec_Name,e.oColumns[0].DataFormat,e.oColumns[0].ColumnType,e.oRow.Cells[0]),e.dbl>0?o=r+1:(e.dbl=-e.dbl,o=r+3),e.AggTotal[o][1]+=e.dbl,e.ViewModel.SetCellValue(e.dbl,e.oColumns[o].DataFormat,e.oColumns[o].ColumnType,e.oRow.Cells[o]),e.ViewModel.addRow(e.oRow))}));if(e.oRow=e.NewReportRow_2(a.f.BalanceBF,e.GrossTotalAppearance),e.oRow.Cells[0].ColSpan=e.oColumns.length,e.ViewModel.addRow(e.oRow),b){e.CallFrom=2,e.dv=e.ds.Tables[1],e.dvTable=e.ds.Tables[1],e.dv=e.dvTable.filter((function(e){return e.Amount>0||1==e.IsGroup})),e.IsFirstCall=!0,e.FirstTypeEndIndex=0,e.CellStartPos=0;var T=e.ViewModel.Data.length;e.GrdRow=e.ViewModel.Data.length-1,e.dv.forEach((function(t){e.AddRow_RP(t)})),e.UpdateTreeTotals_RP(0),e.dv=e.dvTable.filter((function(e){return e.Amount<0||1==e.IsGroup})),e.IsFirstCall=!1,e.FirstTypeEndIndex=e.ViewModel.Data.length,e.CellStartPos=2,e.GrdRow=T-1,e.dv.forEach((function(t){e.AddRow_RP(t)})),e.GrdRow+1<e.ViewModel.Data.length&&(e.ViewModel.Data[e.GrdRow+1].Cells[e.CellStartPos].Text="",e.ViewModel.Data[e.GrdRow+1].Cells[e.CellStartPos+1].Text=""),e.UpdateTreeTotals_RP(0)}else{var _=new Array;e.dv=e.ds.Tables[1],e.dvTable=e.ds.Tables[1],e.dv=e.dvTable.filter((function(e){return e.Amount>0})),e.dv.forEach((function(t){e.oRow=new a.d(e.oColumns.length,e.ViewModel.RowHeight),e.oRow.Type=a.f.Detail,e.oRow.DataRow=t,e.oRow.NodeID=parseInt(t.AccountID),e.dbl=parseFloat(t.Amount),e.ViewModel.SetCellValue(t.Account,e.oColumns[0].DataFormat,e.oColumns[0].ColumnType,e.oRow.Cells[0]),e.ViewModel.SetCellValue(e.dbl,e.oColumns[1].DataFormat,e.oColumns[1].ColumnType,e.oRow.Cells[1]),e.AggTotal[1][2]+=e.dbl,_.push(e.oRow)})),e.dv=e.dvTable.filter((function(e){return e.Amount<0})),e.GrdRow=0,e.dv.forEach((function(t){e.GrdRow>=_.length?(e.oRow=new a.d(e.oColumns.length,e.ViewModel.RowHeight),e.oRow.Type=a.f.Detail,e.oRow.DataRow=t,e.oRow.NodeID=parseInt(t.AccountID),_.push(e.oRow)):e.oRow=_[e.GrdRow],e.dbl=parseFloat(t.Amount),e.dbl=-e.dbl,e.ViewModel.SetCellValue(t.Account,e.oColumns[2].DataFormat,e.oColumns[2].ColumnType,e.oRow.Cells[2]),e.ViewModel.SetCellValue(e.dbl,e.oColumns[3].DataFormat,e.oColumns[1].ColumnType,e.oRow.Cells[3]),e.dbl=e.ViewModel.RoundOff(e.dbl,e.oColumns[3].DataFormat),e.AggTotal[3][2]+=e.dbl,e.GrdRow++})),_.forEach((function(t){e.ViewModel.addRow(t)}))}(e.oRow=e.NewReportRow_2(a.f.BalanceBF,e.GrossTotalAppearance),e.oRow.Cells[0].Text="Receipts & Payments Total",e.oRow.Cells[1].CellAppearance=e.GrossTotalAppearance_Data,e.oRow.Cells[3].CellAppearance=e.GrossTotalAppearance_Data,e.ViewModel.SetCellValue(e.AggTotal[1][2],e.oColumns[1].DataFormat,e.oColumns[1].ColumnType,e.oRow.Cells[1]),e.ViewModel.SetCellValue(e.AggTotal[3][2],e.oColumns[3].DataFormat,e.oColumns[1].ColumnType,e.oRow.Cells[3]),e.ViewModel.addRow(e.oRow),e.ExcludeClBalance)||(e.oRow=e.NewReportRow_2(a.f.BalanceBF,e.GrossTotalAppearance),e.oRow.Cells[0].ColSpan=e.oColumns.length,e.oRow.Cells[0].Text=s.a.GetResource("Reports_ClosingBalance"),e.ViewModel.addRow(e.oRow),e.ds.Tables[0].length>e.ds.Tables[2].length?(l=e.ds.Tables[0],n=e.ds.Tables[2]):(l=e.ds.Tables[2],n=e.ds.Tables[0]),e.dv=l,e.dvTable=l,n.forEach((function(t){if(e.dv=e.dvTable.filter((function(e){return e.AccountID==t.AccountID})),e.dv.length>0)e.dv[0].Amount=parseFloat(e.dv[0].Amount)+parseFloat(t.Amount);else{var o={};o.AccountID=t.AccountID,o.Rec_Name=t.Rec_Name.toString(),o.Amount=parseFloat(t.Amount),b&&(o.Depth=t.Depth,o.lft=t.lft,o.IsGroup=t.IsGroup),e.dvTable.push(o)}})),l.forEach((function(t){e.dbl=parseFloat(t.Amount),Math.abs(e.dbl)>=.001&&(e.oRow=new a.d(e.oColumns.length,e.ViewModel.RowHeight),e.oRow.Type=a.f.Detail,e.oRow.DataRow=t,e.oRow.NodeID=parseInt(t.AccountID),e.ViewModel.SetCellValue(t.Rec_Name,e.oColumns[0].DataFormat,e.oColumns[0].ColumnType,e.oRow.Cells[0]),e.dbl>0?(e.ViewModel.SetCellValue(e.dbl,e.oColumns[1].DataFormat,e.oColumns[1].ColumnType,e.oRow.Cells[3]),e.AggTotal[3][3]+=e.dbl):(e.dbl=-e.dbl,e.ViewModel.SetCellValue(e.dbl,e.oColumns[3].DataFormat,e.oColumns[3].ColumnType,e.oRow.Cells[1]),e.AggTotal[1][3]+=e.dbl),e.ViewModel.addRow(e.oRow))})),b?(e.CallFrom=3,e.GrdRow=e.ViewModel.Data.length-1,l.Columns.Rec_Name.ColumnName="Account",l.Merge(e.ds.Tables[3]),e.dv=l.AsDataView(),e.dv.SortBy(["lft"]),e.IsFirstCall=!0,e.FirstTypeEndIndex=0,e.CellStartPos=0,e.GrdRow=e.ViewModel.Data.length-1,e.dv.forEach((function(t){e.AddRow_RP(t)})),e.UpdateTreeTotals_RP(0)):l.forEach((function(t){e.dbl=parseFloat(t.Amount),Math.abs(e.dbl)>=.001&&(e.oRow=new a.d(e.oColumns.length,e.ViewModel.RowHeight),e.oRow.Type=a.f.Detail,e.oRow.DataRow=t,e.oRow.NodeID=parseInt(t.AccountID),e.ViewModel.SetCellValue(t.Rec_Name,e.oColumns[0].DataFormat,e.oColumns[0].ColumnType,e.oRow.Cells[0]),e.dbl>0?(e.ViewModel.SetCellValue(e.dbl,e.oColumns[1].DataFormat,e.oColumns[1].ColumnType,e.oRow.Cells[3]),e.AggTotal[3][3]+=e.dbl):(e.dbl=-e.dbl,e.ViewModel.SetCellValue(e.dbl,e.oColumns[3].DataFormat,e.oColumns[3].ColumnType,e.oRow.Cells[1]),e.AggTotal[1][3]+=e.dbl),e.ViewModel.addRow(e.oRow))})));e.AggTotal[1][0]=e.AggTotal[1][1]+e.AggTotal[1][2]+e.AggTotal[1][3],e.AggTotal[3][0]=e.AggTotal[3][1]+e.AggTotal[3][2]+e.AggTotal[3][3]})).then((function(t){e.LoadReportComplete()}))}else if(169==this.ViewModel.StaticReportType)s.a.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,h).then((function(t){e.dsAccount=t,e.sbChunks="";for(var o=e.i;o<e.dsAccount.Tables[0].length;o++)e.sbChunks.length>0&&(e.sbChunks+=","),e.sbChunks+=e.dsAccount.Tables[0][o][e.dsAccount.Columns[0][0]].toString();if(e.ViewModel.Preferences.ContainsKey("ShowNarration")&&"1"==e.ViewModel.Preferences.ShowNarration){e.ViewModel.SelectTag=",D.CommonNarration AS CommonNarration",e.ViewModel.SelectTagAliasOnly=",CommonNarration";var i=e.ViewModel.ColumnSource.find((function(e){return"Particular"==e.ID}));e.colParticularIndex=null!=i?e.ViewModel.ColumnSource.indexOf(i):e.ViewModel.ColumnSource.length-2}e.ShowGL_INVDetailReport=!1,e.ShowGL_ACCDetailReport=1;var l=[];l.push(e.sbChunks.toString()),l.push(""),l.push(null),l.push(0),l.push(e.GLClubTranBy),l.push(e.ViewModel.oReportDialog.FromDate.Date),l.push(e.ViewModel.oReportDialog.ToDate.Date),l.push(e.UnPostedDocsList),l.push(e.PDCInclude),l.push(e.IncludeUnApprovedPDC),l.push(e.IncludeTerminatedPDC),l.push(!1),l.push(!1),l.push(""),l.push(""),l.push(0),l.push(e.ViewModel.StaticReportType),l.push(""),l.push(""),l.push(e.RoundOff),l.push(0),l.push(""),l.push(0),l.push(e.LocationWhere+e.GetDimensionFilter("DCC.dcCCNID")),l.push(e.ShowGL_INVDetailReport),l.push(e.ShowGL_ACCDetailReport),l.push(e.CurrencyType),l.push(e.ForeignCurrencyID),l.push(e.GLJVDetails),l.push(""),l.push(e.ViewModel.SelectTag+e.ViewModel.GroupSelectTag),l.push(e.ViewModel.FromTag+e.ViewModel.GroupFromTag);var n=e.ViewModel.SelectTagAliasOnly+e.ViewModel.GroupSelectTagAlias;if(n.length>0&&!e.ShowGL_INVDetailReport&&0==e.ShowGL_ACCDetailReport){var a=n.Trim(",").split(",");n="";for(var r=0;r<a.length;r++)n+=",MAX("+a[r]+") "+a[r]}l.push(n),l.push(s.a.SessionManager.LanguageID),e.ViewModel.DisplayMessage="",l[0]=e.sbChunks.toString(),s.a.report.GetGeneralLedger(l,e.ViewModel.IsReportDB).then((function(t){e.ds=t;for(var o=new Array,s=0;s<e.ViewModel.ColumnSource.length-1;s++)o.push(e.ViewModel.ColumnSource[s].Clone());for(var i=0;i<e.ViewModel.ColumnSource.length-1;i++)o.push(e.ViewModel.ColumnSource[i].Clone());for(var l,n=e.ViewModel.ColumnSource[e.ViewModel.ColumnSource.length-1],a=0;a<e.dsAccount.Tables[0].length;a++)(l=n.Clone()).HeaderText=e.dsAccount.Tables[0][a].AccountName.toString(),l.ID="R_"+e.dsAccount.Tables[0][a].AccountID.toString(),o.InsertAt(l,e.ViewModel.ColumnSource.length+a-1),e.colIndex.push(parseInt(e.dsAccount.Tables[0][a].AccountID),e.ViewModel.ColumnSource.length+a-1),(l=n.Clone()).HeaderText=e.dsAccount.Tables[0][a].AccountName.toString(),l.ID="P_"+e.dsAccount.Tables[0][a].AccountID.toString(),o.push(l);e.ViewModel.ReportColumns=o,e.oColumns=e.ViewModel.ReportColumns,e.ColumnnarCashBank()})).then((function(t){e.LoadReportComplete()}))}));else if(200==this.ViewModel.StaticReportType){var L,B="",F=this.ViewModel.SelectTagAliasOnly+this.ViewModel.GroupSelectTagAlias;if(F.length>0)!function(){var t=F.Trim(",").split(",");B="";for(var o=function(o){L=e.ViewModel.BaseReportColumns.find((function(e){return e.ID==t[o]})),B+=null==L||400!=L.CDGDO.CategoryValue||"Amount"!=L.CDGDO.Column&&"AmountFC"!=L.CDGDO.Column?",MAX("+t[o]+") "+t[o]:",SUM("+t[o]+") "+t[o]},s=0;s<t.length;s++)o(s)}();var G="",x="",W=this.GetDimensionFilter("DCC.dcCCNID");(this.LocationWhere.length>0||W.length>0||this.ViewModel.FromTag.Contains("DCC."))&&(G=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.AccDocDetailsID=D.AccDocDetailsID "+this.LocationWhere+W,x=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID "+this.LocationWhere+W);var k="",U="",K="";0==this.UnPostedDocsList.length?K=" AND (D.StatusID=369 or D.StatusID=429)":K+=" AND D.StatusID IN (369,429,"+this.UnPostedDocsList+")",k+="DECLARE @From FLOAT,@To FLOAT\nSET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))\n",k+="\nSELECT isnull(SUM(TR_Dr)-SUM(TR_Cr),0) this.Balance\nFROM (",k+="\n--Opening Dr\nSELECT VoucherNo,DebitAccount AccountID,D.Amount TR_Dr,0 TR_Cr\nFROM ACC_DocDetails D WITH(NOLOCK)"+G+"\ninner join ACC_Accounts A with(nolock) on A.AccountID=D.DebitAccount\nWHERE A.AccountID>1 and (A.AccountTypeID=1 or A.AccountTypeID=10) and (DocDate<@From or DocumentType=16)"+K+U+"\nUNION ALL--Opening Cr\nSELECT VoucherNo,CreditAccount AccountID,0 TR_Dr,D.Amount TR_Cr\nFROM ACC_DocDetails D WITH(NOLOCK)"+G+"\ninner join ACC_Accounts A with(nolock) on A.AccountID=D.CreditAccount\nWHERE A.AccountID>1 and (A.AccountTypeID=1 or A.AccountTypeID=10) and (DocDate<@From or DocumentType=16)"+K+U,x.length>0&&(k+="\n--INEVENTORY DATA\nUNION ALL--Opening Dr\nSELECT VoucherNo,DebitAccount AccountID,D.Amount TR_Dr,0 TR_Cr\nFROM ACC_DocDetails D WITH(NOLOCK)"+x+"\ninner join ACC_Accounts A with(nolock) on A.AccountID=D.DebitAccount\nWHERE A.AccountID>1 and (A.AccountTypeID=1 or A.AccountTypeID=10) and DocDate<@From"+K+U+"\nUNION ALL--Opening Cr\nSELECT VoucherNo,CreditAccount AccountID,0 TR_Dr,D.Amount TR_Cr\nFROM ACC_DocDetails D WITH(NOLOCK)"+x+"\ninner join ACC_Accounts A with(nolock) on A.AccountID=D.CreditAccount\nWHERE A.AccountID>1 and (A.AccountTypeID=1 or A.AccountTypeID=10) and DocDate<@From"+K+U),k+=") AS T\n",k+="\nSELECT convert(datetime,DocDate) DocDate,VoucherNo,AccountID,AccountName,this.Balance, case when this.Balance<=0 then -this.Balance else null end Debit, case when this.Balance>0 then this.Balance else null end Credit\n,VoucherNoAbr,VoucherNoprf,VoucherNodno\n"+F+"\nfrom(\nSELECT DocDate,VoucherNo,max(VoucherNoAbr) VoucherNoAbr,max(VoucherNoprf) VoucherNoprf,max(VoucherNodno) VoucherNodno,T.AccountID,T.AccountName,SUM(TR_Dr)-SUM(TR_Cr) this.Balance"+B+"\nFROM (";var H=this.GetFilterByDimension_1(300);H.length>0&&(U+=" AND D.CostCenterID IN ("+H+")"),k+="\n--Tr Dr\nSELECT DocDate,VoucherNo,D.DocAbbr VoucherNoAbr,D.DocPrefix VoucherNoprf,CONVERT(BIGINT,D.DocNumber) VoucherNodno,DebitAccount AccountID,A1.AccountName,D.Amount TR_Dr,0 TR_Cr"+this.ViewModel.SelectTag+this.ViewModel.GroupSelectTag+"\nFROM ACC_DocDetails D WITH(NOLOCK)"+G+"\ninner join ACC_Accounts A1 with(nolock) on A1.AccountID=D.DebitAccount"+this.ViewModel.FromTag+this.ViewModel.GroupFromTag+"\nWHERE DocDate BETWEEN @From AND @To and A1.AccountID>1 and A1.AccountTypeID!=1 and A1.AccountTypeID!=10"+K+U+"\nUNION ALL--Tr Cr\nSELECT DocDate,VoucherNo,D.DocAbbr VoucherNoAbr,D.DocPrefix VoucherNoprf,CONVERT(BIGINT,D.DocNumber) VoucherNodno,CreditAccount AccountID,A1.AccountName,0 TR_Dr,D.Amount TR_Cr"+this.ViewModel.SelectTag+this.ViewModel.GroupSelectTag+"\nFROM ACC_DocDetails D WITH(NOLOCK)"+G+"\ninner join ACC_Accounts A1 with(nolock) on A1.AccountID=D.CreditAccount"+this.ViewModel.FromTag+this.ViewModel.GroupFromTag+"\nWHERE DocDate BETWEEN @From AND @To and A1.AccountID>1 and A1.AccountTypeID!=1 and A1.AccountTypeID!=10"+K+U,x.length>0&&(k+="\n--INEVENTORY DATA\nUNION ALL--Tr Dr\nSELECT AD.DocDate,AD.VoucherNo,D.DocAbbr VoucherNoAbr,D.DocPrefix VoucherNoprf,CONVERT(BIGINT,D.DocNumber) VoucherNodno,AD.DebitAccount AccountID,A1.AccountName,AD.Amount TR_Dr,0 TR_Cr"+this.ViewModel.SelectTag+this.ViewModel.GroupSelectTag+"\nFROM ACC_DocDetails AD with(nolock)\nINNER JOIN INV_DocDetails D with(nolock) ON D.InvDocDetailsID=AD.InvDocDetailsID"+x+"\ninner join ACC_Accounts A1 with(nolock) on A1.AccountID=AD.DebitAccount"+this.ViewModel.FromTag+this.ViewModel.GroupFromTag+"\nWHERE AD.DocDate BETWEEN @From AND @To and A1.AccountID>1 and A1.AccountTypeID!=1 and A1.AccountTypeID!=10"+K+U+"\nUNION ALL--Tr Cr\nSELECT AD.DocDate,AD.VoucherNo,D.DocAbbr VoucherNoAbr,D.DocPrefix VoucherNoprf,CONVERT(BIGINT,D.DocNumber) VoucherNodno,AD.CreditAccount AccountID,A1.AccountName,0 TR_Dr,AD.Amount TR_Cr"+this.ViewModel.SelectTag+this.ViewModel.GroupSelectTag+"\nFROM ACC_DocDetails AD with(nolock)\nINNER JOIN INV_DocDetails D with(nolock) ON D.InvDocDetailsID=AD.InvDocDetailsID"+x+"\ninner join ACC_Accounts A1 with(nolock) on A1.AccountID=AD.CreditAccount"+this.ViewModel.FromTag+this.ViewModel.GroupFromTag+"\nWHERE AD.DocDate BETWEEN @From AND @To and A1.AccountID>1 and A1.AccountTypeID!=1 and A1.AccountTypeID!=10"+K+U),k+=") AS T\nwhere 1=1\nGROUP BY DocDate,VoucherNo,AccountID,AccountName\n) AS T\n--order by DocDate,VoucherNo,AccountName,this.Balance desc",s.a.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,k).then((function(t){e.ds=t,e.ds.Tables[1].SortBy(["DocDate","VoucherNoAbr","VoucherNoprf","VoucherNodno",{name:"Credit",desc:!0},{name:"Debit",desc:!0}]),e.AddDayBook(),e.LoadReportComplete()}))}}}},{key:"LoadReportComplete",value:function(){this.AddReportTotals(),this.ViewModel.FormulasCalculated=!0,this.ViewModel.process_RunWorkerCompleted()}},{key:"GLStart",value:function(e){var t=this;e=e.replace("^strRetainedAccounts^",this.strRetainedAccounts.length>0?" OR A1.AccountID IN ("+this.strRetainedAccounts+")":""),s.a.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,e).then((function(e){t.dsAccount=e,t.al=[],t.IncomeExpAccounts=["4","8","11","5","9","12"],t.ProductQuery="",t.ViewModel.ReportParams.ContainsKey("ProductSelect")&&t.ViewModel.ReportParams.ProductSelect.length>0&&(t.ProductQuery="Select D.VoucherNo"+t.ViewModel.ReportParams.ProductSelect+" from INV_DocDetails D with(nolock) LEFT JOIN INV_Product P with(nolock) ON P.ProductID=D.ProductID"+t.ViewModel.ReportParams.ProductFrom,t.ViewModel.SelectTag+=",convert(int,DT.IsInventory) IsInvDoc",t.ViewModel.FromTag+=" left join ADM_DocumentTypes DT with(nolock) on DT.CostCenterID=D.CostCenterID",t.ViewModel.SelectTagAliasOnly+=",IsInvDoc"),t.al.push(""),t.al.push(""),t.al.push(t.dtOpenCompanyYearStart?t.dtOpenCompanyYearStart:null),t.al.push(0),1==t.ViewModel.lstGroup.length&&t.al.push(t.GLClubTranBy),t.al.push(t.ViewModel.oReportDialog.FromDate.Date),t.al.push(t.ViewModel.oReportDialog.ToDate.Date),t.al.push(t.UnPostedDocsList),t.al.push(t.PDCInclude),t.al.push(t.IncludeUnApprovedPDC),t.al.push(t.IncludeTerminatedPDC),t.al.push(t.PDCSeperate),t.al.push(t.PDCDrCrSeperate),t.al.push(t.ViewModel.Preferences.FilterOn),t.al.push(t.ViewModel.Preferences.SortOn),2==t.ViewModel.lstGroup.length?(t.al.push(t.TagID),t.al.push(o.GetTagTableName(t.TagID))):(t.al.push(t.TagID),t.al.push(t.ViewModel.StaticReportType),t.ViewModel.DocumentFilters.ContainsKey("CONTRACTNODEID")?(t.IsSalesContractLedger=!0,t.al.push(" AND ((D.RefCCID="+t.ViewModel.DocumentFilters.CONTRACTRefCCID+"  AND D.RefNodeid='"+t.ViewModel.DocumentFilters.CONTRACTNODEID+"') \nor (D.RefCCID=400 and D.RefNodeid IN (select AccDocDetailsID from Acc_DocDetails DS where D.RefCCID= "+t.ViewModel.DocumentFilters.CONTRACTRefCCID+" AND DS.RefNodeid='"+t.ViewModel.DocumentFilters.CONTRACTNODEID+"')))")):t.al.push(""),t.al.push(""),t.al.push(t.RoundOff),t.al.push(t.ViewModel.Preferences.ContainsKey("IncludeIntPDCsInBank")),t.al.push(t.ViewModel.Preferences.ContainsKey("NonAccDocs")?t.ViewModel.Preferences.NonAccDocs:""),t.al.push(t.ViewModel.Preferences.ContainsKey("IncludePDCsInOPB"))),t.al.push(t.LocationWhere+t.GetDimensionFilter("DCC.dcCCNID")),t.al.push(t.ShowGL_INVDetailReport),t.al.push(t.ShowGL_ACCDetailReport),t.al.push(t.CurrencyType),t.al.push(t.ForeignCurrencyID),t.al.push(t.GLJVDetails),t.al.push(i.e.IsEmpty(t.GLSortTransactionsBy)?"":",D."+t.GLSortTransactionsBy+"  SortDate"),t.al.push(t.ViewModel.SelectTag+t.ViewModel.GroupSelectTag),t.al.push(t.ViewModel.FromTag+t.ViewModel.GroupFromTag);var l,n,a=t.ViewModel.SelectTagAliasOnly+t.ViewModel.GroupSelectTagAlias;a.length>0&&!t.ShowGL_INVDetailReport&&0==t.ShowGL_ACCDetailReport&&function(){var e=a.Trim(",").split(",");a="";for(var o=function(o){l=t.ViewModel.BaseReportColumns.find((function(t){return t.ID==e[o]})),a+=null==l||400!=l.CDGDO.CategoryValue||"Amount"!=l.CDGDO.Column&&"AmountFC"!=l.CDGDO.Column?",MAX("+e[o]+") "+e[o]:",SUM("+e[o]+") "+e[o]},s=0;s<e.length;s++)o(s)}();(t.al.push(a),t.al.push(s.a.SessionManager.LanguageID),t.CADimension)&&(t.aldim=[],t.aldim.push("6,7"),t.aldim.push(t.ViewModel.oReportDialog.FromDate.Date),t.aldim.push(t.ViewModel.oReportDialog.ToDate.Date),t.aldim.push(t.UnPostedDocsList),t.aldim.push(t.PDCInclude),t.aldim.push(t.IncludeUnApprovedPDC),t.aldim.push(t.IncludeTerminatedPDC),t.aldim.push(t.PDCSeperate),t.aldim.push(t.PDCDrCrSeperate),t.aldim.push(t.ViewModel.Preferences.FilterOn),t.aldim.push(t.ViewModel.Preferences.SortOn),t.aldim.push(t.CADimension),t.aldim.push(o.GetTagTableName(t.CADimension)),t.aldimWHERE=t.LocationWhere+t.GetDimensionFilter("DCC.dcCCNID"),(n=t.GetFilterByDimension_1(300)).length>0&&(t.aldimWHERE+=" AND D.CostCenterID IN ("+n+")"),t.aldimWHERE+="  AND DCC.dcCCNID"+(t.CADimension-5e4)+"=",n=t.GetFilterByDimension_1(2),t.aldim.push("aldim"),t.aldim.push(t.ShowGL_INVDetailReport),t.aldim.push(t.ShowGL_ACCDetailReport),t.aldim.push(t.CurrencyType),t.aldim.push(t.ForeignCurrencyID),t.aldim.push(t.ViewModel.SelectTag.Replace("A1.","A.")+t.ViewModel.GroupSelectTag.Replace("A1.","A.")),t.ViewModel.DocumentFilters.ContainsKey("CONTRACTNODEID")?(t.IsSalesContractLedger=!0,t.aldim.push("AND D.RefCCID="+t.ViewModel.DocumentFilters.CONTRACTRefCCID+" AND D.RefNodeid='"+t.ViewModel.DocumentFilters.CONTRACTNODEID+"' "+t.ViewModel.FromTag+t.ViewModel.GroupFromTag)):t.aldim.push(t.ViewModel.FromTag.Replace("A1.","A.")+t.ViewModel.GroupFromTag.Replace("A1.","A.")),t.aldim.push(a),t.aldim.push(1),t.aldim.push(s.a.SessionManager.LanguageID));t.ViewModel.DisplayMessage="",t.GLClubTranBy=0,t.iLoop=0,t.GLCallBack()}))}},{key:"GLCallBack",value:function(){var e,t,o=this,l="",n=[];if(this.iLoop>=this.dsAccount.Tables[0].length)this.GLCallBack_Complete();else if(this.ViewModel.process.CancellationPending)this.ViewModel.processArgs.Cancel=!0;else{if(this.sbChunks="",this.IsCurrentControlAccount=!1,this.TempChunkSize=0,null==this.dtOpenCompanyYearStart)for(var a=this.iLoop;a<this.dsAccount.Tables[0].length&&a-this.iLoop<this.ChunkSize;a++){if(1==this.ViewModel.lstGroup.length){if(this.sbChunks.length>0&&this.GLClubTranBy!=parseInt(this.dsAccount.Tables[0][a].GLClubTranBy))break;this.GLClubTranBy=parseInt(this.dsAccount.Tables[0][a].GLClubTranBy)}if(this.IsControlAccounts){if(0==this.CADimension&&1==parseInt(this.dsAccount.Tables[0][a].IsControl)){if(this.sbChunks.length>0)break;this.IsCurrentControlAccount=!0,this.sbChunks+=this.dsAccount.Tables[0][a][this.dsAccount.Columns[0][0]].toString(),this.TempChunkSize++;break}if(0!=this.CADimension&&1!=parseInt(this.dsAccount.Tables[0][a].CAD)){if(this.sbChunks.length>0)break;this.IsCurrentControlAccount=!0,this.sbChunks+=this.dsAccount.Tables[0][a][this.dsAccount.Columns[0][0]].toString(),this.TempChunkSize++;break}}this.sbChunks.length>0&&(this.sbChunks+=","),this.sbChunks+=this.dsAccount.Tables[0][a][this.dsAccount.Columns[0][0]].toString(),this.TempChunkSize++}else{l="";for(var r=this.iLoop;r<this.dsAccount.Tables[0].length&&r-this.iLoop<this.ChunkSize;r++){if(1==this.ViewModel.lstGroup.length){if(this.sbChunks.length>0&&this.GLClubTranBy!=parseInt(this.dsAccount.Tables[0][r].GLClubTranBy))break;this.GLClubTranBy=parseInt(this.dsAccount.Tables[0][r].GLClubTranBy)}if(this.IsControlAccounts){if(0==this.CADimension&&1==parseInt(this.dsAccount.Tables[0][r].IsControl)){if(this.sbChunks.length>0||l.length>0)break;this.IsCurrentControlAccount=!0,this.sbChunks+=this.dsAccount.Tables[0][r][this.dsAccount.Columns[0][0]].toString(),this.TempChunkSize++;break}if(0!=this.CADimension&&1!=parseInt(this.dsAccount.Tables[0][r].CAD)){if(this.sbChunks.length>0||l.length>0)break;this.IsCurrentControlAccount=!0,this.sbChunks+=this.dsAccount.Tables[0][r][this.dsAccount.Columns[0][0]].toString(),this.TempChunkSize++;break}}this.strAccountType=i.e.StringValue(this.dsAccount.Tables[0][r].AccountTypeID),this.IncomeExpAccounts.Contains(this.strAccountType)?(l.length>0&&(l+=","),l+=this.dsAccount.Tables[0][r][this.dsAccount.Columns[0][0]].toString()):(this.sbChunks.length>0&&(this.sbChunks+=","),this.sbChunks+=this.dsAccount.Tables[0][r][this.dsAccount.Columns[0][0]].toString()),this.TempChunkSize++}}var h;if(this.al[0]=this.sbChunks.toString(),this.al[1]=l.toString(),this.al[3]=this.IsCurrentControlAccount,1==this.ViewModel.lstGroup.length&&(this.al[4]=this.GLClubTranBy),1==this.ViewModel.lstGroup.length)this.IsCurrentControlAccount?(this.aldim[13]=this.aldimWHERE+this.dsAccount.Tables[0][this.iLoop].CAD.toString(),h=s.a.report.GetGLOnlyDimension(this.aldim,this.ViewModel.IsReportDB)):h=s.a.report.GetGeneralLedger(this.al,this.ViewModel.IsReportDB),h.then((function(l){if(o.ds=l,o.IsCurrentControlAccount&&(o.ds.Tables[0].forEach((function(e){e.AccountID=e.TAG,e.AccountName=e.Name})),o.ds.Tables[1].forEach((function(e){e.ParticularID=e.AccountID,e.Particular=e.AccountName,e.AccountID=e.TAG,e.AccountName=e.Name})),o.ds.Tables.Count>2&&o.ds.Tables[2].forEach((function(e){e.ParticularID=e.AccountID,e.Particular=e.AccountName,e.AccountID=e.TAG,e.AccountName=e.Name})),o.ds.Tables.forEach((function(e){e.forEach((function(e){e.AccountID=o.dsAccount.Tables[0][o.iLoop].AccountID}))}))),o.SetParticularsData(o.ds),o.DataSetCollection.push(o.ds),o.ProductQuery.length>0&&(e="",n.Clear(),o.ds.Tables[1].filter((function(e){return 1==e.IsInvDoc})).forEach((function(s){t=s.VoucherNo.toString(),o.dicInvRows.ContainsKey(t)||n.Contains(t)||(e.length>0&&(e+=","),e+="'"+t+"'",n.push(t))})),e.length>0)){var a=s.a.report.GetDataTable("RPT022",o.ProductQuery+" WHERE D.VoucherNo in ("+e+")");n.forEach((function(e){o.dicInvRows.push(e,a.filter((function(t){return t.VoucherNo==e})))}))}if(o.ViewModel.FormulaColumns.length>0&&o.ViewModel.FormulaColumns.forEach((function(e){o.ds.Columns[1].Contains(e.ID)||o.ds.Columns[1].push(e.ID),o.ds.Tables.length>2&&!o.ds.Columns[2].Contains(e.ID)&&o.ds.Columns[2].push(e.ID)})),o.ShowTagWise||-1==o.CurrencyType)for(var r=function(e){o.TagCols.forEach((function(t){o.ds.Columns[e].push(t.ID)}))},h=0;h<o.ds.Tables.length;h++)r(h);for(o.dvAccount=o.ds.Tables[0],o.dvAccountTable=o.ds.Tables[0],o.dvAccountColumns=o.ds.Columns[0],o.jAccount=o.iLoop;o.jAccount<o.dsAccount.Tables[0].length&&o.jAccount-o.iLoop<o.TempChunkSize;o.jAccount++){if(o.strAccountID=o.dsAccount.Tables[0][o.jAccount].AccountID.toString(),o.dvAccount=o.dvAccountTable.filter((function(e){return e.AccountID==o.strAccountID})),o.dv=o.ds.Tables[1],o.dvTable=o.ds.Tables[1],o.dvColumns=o.ds.Columns[1],o.strAccountFilterObj={},o.strAccountName=o.dsAccount.Tables[0][o.jAccount].AccountName.toString(),o.IsCurrentControlAccount?o.dv=o.dv:(o.strAccountFilterObj.AccountID=o.strAccountID,o.dv=o.dv.filter((function(e){return e.AccountID==o.strAccountID}))),o.ds.Tables.length>2&&(o.dvTbl2=o.IsCurrentControlAccount?o.ds.Tables[2]:o.ds.Tables[2].filter((function(e){return e.AccountID==o.strAccountFilterObj.AccountID})),o.dvTbl2Table=o.ds.Tables[2],o.dvTbl2Columns=o.ds.Columns[2]),o.strAccountType=o.dsAccount.Tables[0][o.jAccount].AccountTypeID.toString(),o.AllowAddRows=o.dv.length>0||o.ds.Tables.length>2&&o.dvTbl2.length>0,o.IsRetainedEarning=!1,o.OpenCompany&&o.GLRetainedAccounts.ContainsKey(o.strAccountID)&&(o.AllowAddRows=!0,o.IsRetainedEarning=!0),o.UnPostedDocsInclude&&o.UnPostedDocsSeparately&&(o.strAccountFilterObj.StatusID=[369,429],o.dv=o.dv.filter((function(e){return 369==e.StatusID||429==e.StatusID}))),o.ShowTagWise){var u=void 0,c=0,D=0;for((u=i.e.String(o.dvAccount[0].TagID)).length>0&&(c=i.e.Double(o.dvAccount[0].BF),o.dvAccount[0]["TAG"+u]=c,D=c);1<o.dvAccount.length;)(u=i.e.String(o.dvAccount[1].TagID)).length>0&&(D+=c=i.e.Double(o.dvAccount[1].BF),o.dvAccount[0]["TAG"+u]=c),o.dvAccount.Remove(o.dvAccount[1]),o.dvAccountTable.Remove(o.dvAccount[1]);o.dvAccount[0].BF=D}else if(-1==o.CurrencyType){var d=void 0,C=0,p=0;for((d=o.dvAccount[0].CurrencyID.ToString()).Length>0&&(C=o.dvAccount[0].BF.ToString(),o.dvAccount[0]["CURRBL"+d]=C,p=C);1<o.dvAccount.length;)(d=o.dvAccount[1].CurrencyID.ToString()).Length>0&&(p+=C=o.dvAccount[1].BF.ToString(),o.dvAccount[0]["CURRBL"+d]=C),o.dvAccount.Remove(o.dvAccount[1]);o.dvAccount[0].BF=p}o.OpenCompany&&null==o.dtOpenCompanyYearStart&&o.IncomeExpAccounts.Contains(o.strAccountType)&&(o.dvAccount[0].BF=0),o.OpBalance=parseFloat(o.dvAccount[0].BF),o.AllowAddRows||(o.AccountsWithOutTransactions||o.AccountsWithOnlyOPB&&0!=o.OpBalance)&&(o.AllowAddRows=!0),o.ExcludeOpBalance&&(o.OpBalance=0),0==o.OpBalance&&-1!=o.colLocalAmtInd&&o.dvAccountColumns.Contains("LocalAmount")&&(o.dvAccount[0].LocalAmount=0),o.AllowAddRows&&(o.AccountsWithZeroBalance||0!=o.GetBalance()||o.IsRetainedEarning)&&(o.IsNewAccount=!0,o.addGeneralLedger())}o.ViewModel.refreshDataView(),o.iLoop+=o.TempChunkSize,o.GLCallBack()}),(function(e){o.GLCallBack_Complete()}));else s.a.report.GetGLDimensionWise(this.al,this.ViewModel.IsReportDB).then((function(e){var t;for(o.ds=e,o.SetParticularsData(o.ds),o.DataSetCollection.push(o.ds),o.iDataSetCollection.push(o.TempChunkSize),o.ViewModel.FormulaColumns.length>0&&o.ViewModel.FormulaColumns.forEach((function(e){o.ds.Columns[1].Contains(e.ID)||o.ds.Columns[1].push(e.ID),o.ds.Tables.length>2&&!o.ds.Columns[2].Contains(e.ID)&&o.ds.Columns[2].push(e.ID)})),o.dvAccount=o.ds.Tables[0],o.dvAccountTable=o.ds.Tables[0],o.dvAccountColumns=o.ds.Columns[0],o.jAccount=o.iLoop;o.jAccount<o.dsAccount.Tables[0].length&&o.jAccount-o.iLoop<o.TempChunkSize;o.jAccount++){if(o.strAccountID=o.dsAccount.Tables[0][o.jAccount][o.dsAccount.Columns[0][0]].toString(),o.dv=o.ds.Tables[1],o.dvTable=o.ds.Tables[1],o.dvColumns=o.ds.Columns[1],o.strAccountFilter="AccountID="+o.strAccountID,o.strAccountFilterObj={AccountID:o.strAccountID},o.IsCurrentControlAccount&&(o.strAccountFilter="1=1"),o.dv=o.dvTable.filter((function(e){return e.AccountID==o.strAccountID})),o.dvAccount=o.dvAccountTable.filter((function(e){return e.AccountID==o.strAccountID})),o.ds.Tables.length>2&&(o.dvTbl2=o.ds.Tables[2].filter((function(e){return e.AccountID==o.strAccountID})),o.dvTbl2Table=o.ds.Tables[2],o.dvTbl2Columns=o.ds.Columns[2]),0==o.dvAccount.length&&0==o.dv.length){if(2==o.ds.Tables.length)continue;if(o.ds.Tables.length>2&&0==o.dvTbl2.length)continue}for(var s=0;s<o.oColumns.length;s++)o.AggTotal[s][4]=0;o.dvAccount.sort((function(e,t){return e.Name>t.Name?1:-1})),t=o.dv.ToTable(!0,["TAG","Name"]),o.ds.Tables.length>2&&(o.dvTbl2=o.dvTbl2Table.filter((function(e){return e.AccountID==o.strAccountID})),o.dvTbl2.length>0&&o.dvTbl2.ToTable(!0,["TAG","Name"]).forEach((function(e){0==t.filter((function(t){return t.TAG==e.TAG})).length&&t.push([e.TAG.toString(),e.Name.toString()])}))),t.forEach((function(e){if(0==o.dvAccount.filter((function(t){return t.Name==i.e.String(e.Name)})).length){var t={};o.dvAccount.length>0?(t.AccountID=o.dvAccount[0].AccountID.toString(),t.AccountName=o.dvAccount[0].AccountName.toString(),t.AccountTypeID=o.dvAccount[0].AccountTypeID.toString()):(t.AccountName=o.dv.length>0?o.dv[0].AccountName.toString():o.dvTbl2[0].AccountName.toString(),t.AccountID=o.dsAccount.Tables[0][o.jAccount].AccountID.toString(),t.AccountTypeID=o.dsAccount.Tables[0][o.jAccount].AccountTypeID.toString()),t.TAG=i.e.StringValue(e.TAG),t.Name=i.e.StringValue(e.Name),t.BF=0,o.dvAccount.push(t),o.dvAccountTable.push(t)}})),o.IsNewAccount=!0,o.dvAccount.forEach((function(e){o.strTagID=e.TAG.toString(),o.strTagName=e.Name.toString(),o.strAccountType=o.dsAccount.Tables[0][o.jAccount].AccountTypeID.toString(),o.strAccountName=o.dsAccount.Tables[0][o.jAccount].AccountName.toString(),o.strAccountFilterObj={},o.IsCurrentControlAccount?o.strAccountFilterObj.TAG=o.strTagID:(o.strAccountFilterObj.TAG=o.strTagID,o.strAccountFilterObj.AccountID=o.strAccountID),o.dv=o.ds.Tables[1],o.dvTable=o.ds.Tables[1],o.dvColumns=o.ds.Columns[1],o.dv=o.dv.filter((function(e){return e.TAG==o.strTagID})),o.IsCurrentControlAccount||(o.dv=o.dv.filter((function(e){return e.AccountID==o.strAccountID}))),o.ds.Tables.length>2&&(o.dvTbl2=o.ds.Tables[2],o.dvTbl2Table=o.ds.Tables[2],o.dvTbl2Columns=o.ds.Columns[2],o.dv=o.dv.filter((function(e){return e.TAG==o.strTagID})),o.IsCurrentControlAccount||(o.dvTbl2=o.dvTbl2.filter((function(e){return e.AccountID==o.strAccountID}))),o.IsCurrentControlAccount||(o.dvTbl2=o.dvTbl2.filter((function(e){return e.AccountID==o.strAccountID})))),o.OpenCompany&&null==o.dtOpenCompanyYearStart&&o.IncomeExpAccounts.Contains(o.strAccountType)&&(e.BF=0),o.OpBalance=parseFloat(e.BF),o.ExcludeOpBalance&&(o.OpBalance=0),o.AllowAddRows=!!(o.dv.length>0||o.AccountsWithOutTransactions||o.AccountsWithOnlyOPB&&0!=o.OpBalance||o.ds.Tables.length>2&&o.dvTbl2.length>0),o.UnPostedDocsInclude&&o.UnPostedDocsSeparately&&(o.strAccountFilterObj.StatusID=[369,429],o.dv=o.dv.filter((function(e){return 369==e.StatusID||429==e.StatusID}))),o.AllowAddRows&&(o.AccountsWithZeroBalance||0!=o.GetBalance())&&o.addGeneralLedger()})),o.ViewModel.lstGroup[0].SubTotalAppearance.IsVisible&&o.AddSubTotal(o.strAccountName,4)}o.ViewModel.refreshDataView(),o.iLoop+=o.TempChunkSize,o.GLCallBack()}),(function(e){o.GLCallBack_Complete()}))}}},{key:"GLCallBack_Complete",value:function(){var e=this;if(1==this.ViewModel.lstGroup.length&&this.HideEmptyDimensions&&(this.ShowTagWise||-1==this.CurrencyType)){try{var t=!1,o=-1;if(this.ShowTagWise?this.TagCols.forEach((function(s){-1!=(o=e.ViewModel.ReportColumns.IndexOf(s))&&null==e.ViewModel.Data.find((function(e){return(e.Type==a.f.Detail||e.Type==a.f.BalanceBF)&&null!=e.Cells[o].Value&&0!=parseInt(e.Cells[o].Value)}))&&(s.HeaderAppearance.IsVisible=!1,t=!0)})):-1==this.CurrencyType&&this.TagCols.forEach((function(s){if(s.ID.startsWith("CURRBL")&&(-1!=(o=e.ViewModel.ReportColumns.IndexOf(s))&&null==e.ViewModel.Data.find((function(e){return(e.Type==a.f.Detail||e.Type==a.f.BalanceBF)&&null!=e.Cells[o].Value&&0!=parseInt(e.Cells[o].Value)})))){s.HeaderAppearance.IsVisible=!1;var i=e.TagCols.find((function(e){return e.ID==s.ID.Replace("CURRBL","CURRDR")}));null!=i&&(i.HeaderAppearance.IsVisible=!1),null!=(i=e.TagCols.find((function(e){return e.ID==s.ID.Replace("CURRBL","CURRCR")})))&&(i.HeaderAppearance.IsVisible=!1),t=!0}})),t){var s=[];this.oColumns.forEach((function(e){s.push(e)})),this.ViewModel.ReportColumns=s}}catch(i){}this.ViewModel.RefreshPostFilters(!1)}else this.ViewModel.RefreshPostFilters();this.LoadReportComplete()}},{key:"CBCallBack",value:function(){var e=this;if(this.iLoop>=this.dsAccount.Tables[0].length)this.LoadReportComplete();else if(this.ViewModel.process.CancellationPending)this.ViewModel.processArgs.Cancel=!0;else{this.sbChunks="",this.TempChunkSize=0;for(var t=this.iLoop;t<this.dsAccount.Tables[0].length&&t-this.iLoop<this.ChunkSize&&!(this.sbChunks.length>0&&this.GLClubTranBy!=parseInt(this.dsAccount.Tables[0][t].GLClubTranBy));t++)this.GLClubTranBy=parseInt(this.dsAccount.Tables[0][t].GLClubTranBy),this.sbChunks.length>0&&(this.sbChunks+=","),this.sbChunks+=this.dsAccount.Tables[0][t][this.dsAccount.Columns[0][0]].toString(),this.TempChunkSize++;this.al[0]=this.sbChunks.toString(),this.al[4]=this.GLClubTranBy,s.a.report.GetGeneralLedger(this.al,this.ViewModel.IsReportDB).then((function(t){e.ds=t,e.SetParticularsData(e.ds),e.DataSetCollection.push(e.ds),e.dvAccount=e.ds.Tables[0],e.dvAccountTable=e.ds.Tables[0],e.dvAccountColumns=e.ds.Columns[0],e.dv=e.ds.Tables[1],e.dvTable=e.ds.Tables[1],e.dvColumns=e.ds.Columns[1];for(var o=e.iLoop;o<e.dsAccount.Tables[0].length&&o-e.iLoop<e.TempChunkSize;o++)e.strAccountID=e.dsAccount.Tables[0][o][e.dsAccount.Columns[0][0]].toString(),e.strAccountFilterObj={AccountID:e.strAccountID},e.dvAccount=e.dvAccountTable.filter((function(t){return t.AccountID==e.strAccountID})),e.strAccountName=e.dsAccount.Tables[0][o].AccountName.toString(),e.strAccountType=e.dsAccount.Tables[0][o].AccountTypeID.toString(),e.dv=e.dvTable.filter((function(t){return t.AccountID==e.strAccountID})),e.OpBalance=parseFloat(e.dvAccount[0].BF),(e.dv.length>0||0!=e.OpBalance)&&(i.e.IsEmpty(e.ViewModel.lstGroup[0].Formula)||(e.ViewModel.CalculateFormula_2(e.ViewModel.lstGroup[0],e.dsAccount.Tables[0][o]),e.strAccountName=i.e.String(e.dsAccount.Tables[0][o][e.ViewModel.lstGroup[0].ID])),e.addCashBookAndBankBook());e.ViewModel.refreshDataView(),e.iLoop+=e.TempChunkSize,e.CBCallBack()}),(function(t){e.LoadReportComplete()}))}}},{key:"GLSummaryCallBack",value:function(){var e=this;if(this.iLoop>=this.dsAccount.Tables[0].length)this.LoadReportComplete();else if(this.ViewModel.process.CancellationPending)this.ViewModel.processArgs.Cancel=!0;else{var t="";if(this.sbChunks="",null==this.dtOpenCompanyYearStart)for(var o=this.iLoop;o<this.dsAccount.Tables[0].length&&o-this.iLoop<this.ChunkSize;o++)this.sbChunks.length>0&&(this.sbChunks+=","),this.sbChunks+=this.dsAccount.Tables[0][o][this.dsAccount.Columns[0][0]].toString();else{t="";for(var i=this.iLoop;i<this.dsAccount.Tables[0].length&&i-this.iLoop<this.ChunkSize;i++)this.strAccountType=this.dsAccount.Tables[0][i].AccountTypeID.toString(),this.IncomeExpAccounts.Contains(this.strAccountType)?(t.length>0&&(t+=","),t+=this.dsAccount.Tables[0][i][this.dsAccount.Columns[0][0]].toString()):(this.sbChunks.length>0&&(this.sbChunks+=","),this.sbChunks+=this.dsAccount.Tables[0][i][this.dsAccount.Columns[0][0]].toString())}this.al[0]=this.sbChunks.toString(),this.al[1]=t.toString(),s.a.report.GetGeneralLedgerSummary(this.al,this.ViewModel.IsReportDB).then((function(t){if(e.ds=t,e.DataSetCollection.push(e.ds),-1!=e.colOpBalanceIndex&&e.ds.Columns[1].Contains("Balance")&&!e.AccountsWithZeroBalance){var o=1e-4;e.colBalanceIndex>=0&&(2==e.oColumns[e.colBalanceIndex].DataFormat.DecimalsPoints?o=.0099:3==e.oColumns[e.colBalanceIndex].DataFormat.DecimalsPoints&&(o=99e-5));for(var s=e.ds.Tables[1].length-1;s>=0;s--)(null==e.ds.Tables[1][s].Balance||Math.abs(parseFloat(e.ds.Tables[1][s].Balance))<o)&&e.ds.Tables[1].RemoveAt(s)}for(e.dvAccount=e.ds.Tables[0],e.dvAccountTable=e.ds.Tables[0],e.dvAccountColumns=e.ds.Columns[0],e.jAccount=e.iLoop;e.jAccount<e.dsAccount.Tables[0].length&&e.jAccount-e.iLoop<e.ChunkSize;e.jAccount++)e.strAccountID=e.dsAccount.Tables[0][e.jAccount][e.dsAccount.Columns[0][0]].toString(),e.dvAccount=e.dvAccountTable.filter((function(t){return t.AccountID==e.strAccountID})),e.strAccountFilter="AccountID="+e.strAccountID,e.dv=e.ds.Tables[1],e.dvTable=e.ds.Tables[1],e.dvColumns=e.ds.Columns[1],e.strAccountFilterObj={AccountID:e.strAccountID},e.dv=e.dv.filter((function(t){return t.AccountID==e.strAccountID})),e.ds.Tables.length>2&&(e.dvTbl2=e.ds.Tables[2].filter((function(t){return t.AccountID==e.strAccountFilterObj.AccountID})),e.dvTbl2Table=e.ds.Tables[2],e.dvTbl2Columns=e.ds.Columns[2]),e.strAccountType=e.dsAccount.Tables[0][e.jAccount].AccountTypeID.toString(),e.strAccountName=e.dsAccount.Tables[0][e.jAccount].AccountName.toString(),e.OpenCompany&&null!=e.dtOpenCompanyYearStart&&e.IncomeExpAccounts.Contains(e.strAccountType)&&(e.dvAccount[0].BF=0),e.OpBalance=parseFloat(e.dvAccount[0].BF),e.ExcludeOpBalance&&(e.OpBalance=0),e.AllowAddRows=!!(e.dv.length>0||e.AccountsWithOutTransactions&&0!=e.OpBalance||e.ds.Tables.length>2&&e.dvTbl2.length>0),e.UnPostedDocsInclude&&e.UnPostedDocsSeparately&&(e.strAccountFilterObj.StatusID=[369,429],e.dv=e.dv.filter((function(e){return 369==e.StatusID||429==e.StatusID}))),e.AllowAddRows&&(-1==e.colOpBalanceIndex?(e.AccountsWithZeroBalance||0!=e.GetBalance())&&(e.IsNewAccount=!0,e.addGeneralLedger()):(e.AccountsWithZeroBalance||0!=e.GetBalance_GLSummary())&&(e.IsNewAccount=!0,e.addGL_DimWiseSummary()));e.ViewModel.refreshDataView(),e.iLoop+=e.ChunkSize,e.GLSummaryCallBack()}),(function(t){e.LoadReportComplete()}))}}},{key:"GLSummaryStart",value:function(e){var t=this;e=e.replace("^strRetainedAccounts^",this.strRetainedAccounts.length>0?" OR A1.AccountID IN ("+this.strRetainedAccounts+")":""),s.a.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,e).then((function(e){t.dsAccount=e,t.IncomeExpAccounts=["4","8","11","5","9","12"],t.al=[],t.al.push(""),t.al.push(""),t.al.push(t.dtOpenCompanyYearStart?t.dtOpenCompanyYearStart:null),t.al.push(t.ViewModel.oReportDialog.FromDate.Date),t.al.push(t.ViewModel.oReportDialog.ToDate.Date),t.al.push(t.UnPostedDocsList),t.al.push(t.PDCInclude),t.al.push(t.IncludeTerminatedPDC),t.al.push(t.TagID),t.al.push(t.TagTableName),t.al.push(t.LocationWhere+t.GetDimensionFilter("DCC.dcCCNID")),t.al.push(-1==t.colOpBalanceIndex?0:1),t.al.push(t.CurrencyType),t.al.push(t.ForeignCurrencyID),t.al.push(t.ViewModel.SelectTag+t.ViewModel.GroupSelectTag),t.al.push(t.ViewModel.FromTag+t.ViewModel.GroupFromTag),t.al.push(t.ViewModel.SelectTagAliasOnly+t.ViewModel.GroupSelectTagAlias),t.al.push(s.a.SessionManager.LanguageID),t.ViewModel.DisplayMessage="",t.iLoop=0,t.GLSummaryCallBack()}))}},{key:"SetTrialBalanceDataSet",value:function(e){var t,o,l,n,a=this,h="",u="",c="",d="",C="",p="",T="",_="",m="",I="",R="",S="",A="",M="",g="",w="",f="",E="",P="";this.strOrder="";var y=s.a.report.GetCloseDate(this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.IsReportDB);if(this.exchRate=0,this.ForeignCurrencyID>0)o="AmountFC",l=" AND ACC.CurrencyID="+this.ForeignCurrencyID;else if(o=1==this.CurrencyType?"AmountBC":"Amount",l="",this.ViewModel.Preferences.ContainsKey("FCWithExchRate")){var O=new i.f;O.LoadXml("<XML>"+this.ViewModel.Preferences.FCWithExchRate+"</XML>");var b=i.f.SelectSingleNode(O.DocumentElement,"IsChecked");null!=b&&"1"==b.innerHTML&&(b=i.f.SelectSingleNode(O.DocumentElement,"TextValue"),this.exchRate=i.e.Double(b.innerHTML),this.exchRate<=0&&(this.exchRate=1),o="Amount/"+this.exchRate.toString())}"Amount"==o&&null!=this.ViewModel.ReportColumns.find((function(e){return"FCClosingDebit"==e.ID&&e.HeaderAppearance.IsVisible}))&&(this.IsFCClosingDebitExists=!0,this.ExcludeTreeTotalCols.push("FCClosingDebit"),this.ExcludeTreeTotalCols.push("FCClosingCredit"),u=",sum(ACC.AmountFC) FCOP_Dr,0 FCOP_Cr,0 FCTR_Dr,0 FCTR_Cr,ACC.CurrencyID",c=",0 FCOP_Dr,sum(ACC.AmountFC) FCOP_Cr,0 FCTR_Dr,0 FCTR_Cr,ACC.CurrencyID",d=",0 FCOP_Dr,0 FCOP_Cr,sum(ACC.AmountFC) FCTR_Dr,0 FCTR_Cr,ACC.CurrencyID",C=",0 FCOP_Dr,0 FCOP_Cr,0 FCTR_Dr,sum(ACC.AmountFC) FCTR_Cr,ACC.CurrencyID",p=",CASE WHEN SUM(FCOP_Dr)-SUM(FCOP_Cr)>0 THEN SUM(FCOP_Dr)-SUM(FCOP_Cr) ELSE 0 END FCOP_Dr,\nCASE WHEN SUM(FCOP_Dr)-SUM(FCOP_Cr)<0 THEN SUM(FCOP_Cr)-SUM(FCOP_Dr) ELSE 0 END FCOP_Cr,\nCASE WHEN SUM(FCTR_Dr)-SUM(FCTR_Cr)>0 THEN SUM(FCTR_Dr)-SUM(FCTR_Cr) ELSE 0 END FCTR_Dr,\nCASE WHEN SUM(FCTR_Dr)-SUM(FCTR_Cr)<0 THEN SUM(FCTR_Cr)-SUM(FCTR_Dr) ELSE 0 END FCTR_Cr,\nmax(CurrencyID) CurrencyID",T=",SUM(FCOP_Dr) FCOP_Dr,SUM(FCTR_Dr) FCTR_Dr,SUM(FCOP_Cr) FCOP_Cr,SUM(FCTR_Cr) FCTR_Cr,max(CurrencyID) CurrencyID",_=",FCOP_Dr,FCOP_Cr,FCTR_Dr,FCTR_Cr,C.Name Currency",m+=",ACC.CurrencyID");for(var N=0;N<this.ViewModel.ReportGroups.length;N++){var V=this.ViewModel.ReportGroups[N];if(V.CDGDO.ColumnCostCenterID>5e4){this.TBIsAccountWise=!0,this.TBGroupID=V.ID,V.CDGDO.ParentTableAlias="C"+V.CDGDO.ColumnCostCenterID,V.CDGDO.ActualColumn=V.CDGDO.ParentTableAlias+V.CDGDO.Column,g+=","+V.CDGDO.ParentTableAlias+"."+V.CDGDO.Column+" "+V.ID,w+=",DCC.dcCCNID"+(V.CDGDO.ColumnCostCenterID-5e4)+" AS "+V.ID+"_ID",m+=",DCC.dcCCNID"+(V.CDGDO.ColumnCostCenterID-5e4),E+=","+V.ID+"_ID",this.strOrder+=V.ID+",",P+=" INNER JOIN "+V.CDGDO.ParentCostCenterSysName+" AS "+V.CDGDO.ParentTableAlias,P+=" WITH(NOLOCK) ON "+V.CDGDO.ParentTableAlias+".NodeID=ACC."+V.ID+"_ID";break}}var v=this.GetDimensionFilter_2("DCC.dcCCNID","ACC.CNID");f=w,I=m,this.Show==D.TagWise?(g+=",TagID Tag",E+=",TagID",this.ViewModel.ReportDims.Contains(this.TagID.toString())?(w+=",ACC.CNID"+(this.TagID-5e4)+" TagID",m+=",ACC.CNID"+(this.TagID-5e4)):(w+=",DCC.dcCCNID"+(this.TagID-5e4)+" TagID",m+=",DCC.dcCCNID"+(this.TagID-5e4)),f=w,I=m):this.Show==D.MonthWise&&(g+=",CONVERT(NVARCHAR,YEAR(TagID))+'-'+ CONVERT(NVARCHAR,Month(TagID)) Tag",w+=",convert(datetime,DocDate+1-day(convert(datetime,DocDate))) TagID",f+=",convert(datetime,convert(int,@From)+1-day(@From)) TagID",E+=",TagID",m+=",convert(datetime,DocDate+1-day(convert(datetime,DocDate)))"),s.a.SessionManager.Preferences.ContainsKey("ControlAccDimension")&&(this.CADimension=i.e.Int(s.a.SessionManager.Preferences.ControlAccDimension)),this.CADimension>0&&(g+=",CADID,A1CC.CCNID"+(this.CADimension-5e4)+" CAD",E+=",CADID",w+=",DCC.dcCCNID"+(this.CADimension-5e4)+" CADID",m+=",DCC.dcCCNID"+(this.CADimension-5e4),this.Show==D.MonthWise?(f+=",DCC.dcCCNID"+(this.CADimension-5e4)+" CADID",I+=",DCC.dcCCNID"+(this.CADimension-5e4)):(f=w,I=m)),(this.LocationWhere.length>0||w.Contains("dcCCNID")||v.Contains("dcCCNID"))&&(R=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.AccDocDetailsID=ACC.AccDocDetailsID",S=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=ACC.InvDocDetailsID"),l+=v+this.LocationWhere,M="DocDate<@From",y&&y.AddDays(1)<this.ViewModel.oReportDialog.FromDate.Date&&(M+=" and DocDate>@Close");var L="";if(0==this.UnPostedDocsList.length?L=" AND (ACC.StatusID=369 or ACC.StatusID=429)":L+=" AND ACC.StatusID IN (369,429,"+this.UnPostedDocsList+")",this.PDCInclude){var B="(ACC.StatusID=370 OR ACC.StatusID=439"+(this.IncludeTerminatedPDC?" OR ACC.StatusID=452":"")+(this.IncludeUnApprovedPDC?" OR ACC.StatusID=371 OR ACC.StatusID=441":"")+")";A=" AND ACC.DocumentType!=16 AND ("+B+" OR (ACC.DocumentType!=14 AND ACC.DocumentType!=19"+L+"))",M+=" AND ("+B+" OR (ACC.DocumentType!=14 AND ACC.DocumentType!=19"+L+"))"}else A=" AND ACC.DocumentType NOT IN (16,14,19)"+L,M+=" AND ACC.DocumentType!=14 AND ACC.DocumentType!=19"+L;n=y&&y.AddDays(1)<this.ViewModel.oReportDialog.FromDate.Date?M:"((ACC.DocumentType=16"+L+") OR ("+M+"))";var F=!1,G="",x="",W="",k="",U="",K="",H=this.ViewModel.oReportDialog.FromDate.Date;this.OpenCompany&&this.DontShowREforPeriodInAssignedAccount&&(F=!0,(H=new Date(this.ViewModel.oReportDialog.FromDate.Date.getFullYear(),this.AccountingFromMonth-1,1))>this.ViewModel.oReportDialog.FromDate.Date&&(H=H.AddYears(-1)),H==this.ViewModel.oReportDialog.FromDate.Date&&(F=!1)),h+="DECLARE @From FLOAT,@To FLOAT\nSET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",y&&(h+="\nDECLARE @Close FLOAT\nSET @Close=CONVERT(FLOAT,CONVERT(DATETIME,'"+y.ToString("dd MMM yyyy")+"'))"),F&&(h+="\nDECLARE @YrStart FLOAT\nSET @YrStart=CONVERT(FLOAT,CONVERT(DATETIME,'"+H.ToString("dd MMM yyyy")+"'))",G=",sum(case when ACC.DocDate>=@YrStart and ACC.DocDate<@From then ACC."+o+" else 0 end) PeriodOpDr,0 PeriodOpCr",x=",0,sum(case when ACC.DocDate>=@YrStart and ACC.DocDate<@From then ACC."+o+" else 0 end)",W=",0.0,0.0",k=",CASE WHEN SUM(PeriodOpDr)-SUM(PeriodOpCr)>0 THEN SUM(PeriodOpDr)-SUM(PeriodOpCr) ELSE 0 END PeriodOpDr,\nCASE WHEN SUM(PeriodOpDr)-SUM(PeriodOpCr)<0 THEN SUM(PeriodOpCr)-SUM(PeriodOpDr) ELSE 0 END PeriodOpCr",U=",SUM(PeriodOpDr) PeriodOpDr,SUM(PeriodOpCr) PeriodOpCr",K=",PeriodOpDr,PeriodOpCr"),t="",-1!=this.colPDCInd&&(t+=",(select sum(Amount) from(\nSELECT sum(Amount) Amount FROM ACC_DocDetails ACC WITH(NOLOCK)"+R+" WHERE DebitAccount=A1.AccountID and DocDate<=@To and (ACC.StatusID=370 OR ACC.StatusID=439)"+l+"\nunion all\nSELECT -sum(Amount) FROM ACC_DocDetails ACC WITH(NOLOCK)"+R+"\nWHERE CreditAccount=A1.AccountID and DocDate<=@To and (ACC.StatusID=370 OR ACC.StatusID=439"+(this.IncludeUnApprovedPDC?" OR ACC.StatusID=371 OR ACC.StatusID=441":"")+")"+l,t+=") AS TPDC) TotalPDC"),h+="\nSELECT A1.AccountCode,A1.AccountName,OP_Dr,OP_Cr,TR_Dr,TR_Cr,A1.AccountID"+g+this.ViewModel.SelectTag+_+K+t+",A1.IsGroup,A1.lft,A1.rgt,A1.AccountTypeID,A1.Depth,A1.ParentID,A1.TB_INT IsSummary\nFROM (\nSELECT AccountID"+E+",SUM(OP_Dr) OP_Dr,SUM(OP_Cr) OP_Cr,SUM(TR_Dr) TR_Dr,SUM(TR_Cr) TR_Cr"+T+U+"\nFROM(\nSELECT T1.AccountID,VoucherNo"+E.Replace(",CADID",",case when CA.AccountTypeID=6 or CA.AccountTypeID=7 then CADID else 1 end CADID")+",",h+=this.RoundOff.length>0?"\nCASE WHEN SUM(OP_Dr)-SUM(OP_Cr)>0 THEN round(convert(decimal(18,5),SUM(OP_Dr)-SUM(OP_Cr)),"+this.RoundOff+") ELSE 0 END OP_Dr,\nCASE WHEN SUM(OP_Dr)-SUM(OP_Cr)<0 THEN round(convert(decimal(18,5),SUM(OP_Cr)-SUM(OP_Dr)),"+this.RoundOff+") ELSE 0 END OP_Cr,\nCASE WHEN SUM(TR_Dr)-SUM(TR_Cr)>0 THEN round(convert(decimal(18,5),SUM(TR_Dr)-SUM(TR_Cr)),"+this.RoundOff+") ELSE 0 END TR_Dr,\nCASE WHEN SUM(TR_Dr)-SUM(TR_Cr)<0 THEN round(convert(decimal(18,5),SUM(TR_Cr)-SUM(TR_Dr)),"+this.RoundOff+") ELSE 0 END TR_Cr":"CASE WHEN SUM(OP_Dr)-SUM(OP_Cr)>0 THEN SUM(OP_Dr)-SUM(OP_Cr) ELSE 0 END OP_Dr,\nCASE WHEN SUM(OP_Dr)-SUM(OP_Cr)<0 THEN SUM(OP_Cr)-SUM(OP_Dr) ELSE 0 END OP_Cr,\nCASE WHEN SUM(TR_Dr)-SUM(TR_Cr)>0 THEN SUM(TR_Dr)-SUM(TR_Cr) ELSE 0 END TR_Dr,\nCASE WHEN SUM(TR_Dr)-SUM(TR_Cr)<0 THEN SUM(TR_Cr)-SUM(TR_Dr) ELSE 0 END TR_Cr",h+=p+k+"\nFROM (",y&&(h+="\n--Opening Dr Close\nSELECT AccountID AccountID,'' VoucherNo\n,CASE WHEN sum(DCC."+o+")>0 then sum(DCC."+o+") else 0.0 end OP_Dr,CASE WHEN sum(DCC."+o+")<0 then -sum(DCC."+o+") else 0.0 end OP_Cr\n,0 TR_Dr,0 TR_Cr",u.length>0&&(h+=",CASE WHEN sum(DCC.AmountFC)>0 then sum(DCC.AmountFC) else 0.0 end FCOP_Dr,CASE WHEN sum(DCC.AmountFC)<0 then -sum(DCC.AmountFC) else 0.0 end FCOP_Cr,0 FCTR_Dr,0 FCTR_Cr,1 CurrencyID"),F&&(h+=",0.0 PeriodOpDr,0.0 PeriodOpCr"),h+="\nFROM ACC_AccountsClose DCC WITH(NOLOCK)\nWHERE CloseDate=@Close "+v+this.LocationWhere,this.ForeignCurrencyID>0&&(h+=" and CurrencyID="+this.ForeignCurrencyID),h+="\ngroup by AccountID"),y&&y.AddDays(1)==this.ViewModel.oReportDialog.FromDate.Date||(y&&(h+="\nUNION ALL"),h+="\n--Opening Dr\nSELECT DebitAccount AccountID,VoucherNo"+f+",sum(ACC."+o+") OP_Dr,0 OP_Cr,0 TR_Dr,0 TR_Cr"+u+G+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+R+"\nWHERE "+n+l+"\ngroup by DebitAccount,VoucherNo"+I+"\nUNION ALL--Opening Cr\nSELECT CreditAccount AccountID,VoucherNo"+f+",0 OP_Dr,sum(ACC."+o+") OP_Cr,0 TR_Dr, 0 TR_Cr"+c+x+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+R+"\nWHERE "+n+l+"\ngroup by CreditAccount,VoucherNo"+I),h+="\nUNION ALL--Transaction Dr\nSELECT DebitAccount AccountID,VoucherNo"+w+",0 OP_Dr,0 OP_Cr,sum("+o+") TR_Dr,0 TR_Cr"+d+W+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+R+"\nWHERE (DocDate BETWEEN @From AND @To)"+A+l+"\ngroup by DebitAccount,VoucherNo"+m+"\nUNION ALL--Transaction Cr\nSELECT CreditAccount AccountID,VoucherNo"+w+",0 OP_Dr,0 OP_Cr,0 TR_Dr,sum("+o+") TR_Cr"+C+W+"\nFROM ACC_DocDetails ACC  WITH(NOLOCK)"+R+"\nWHERE (DocDate BETWEEN @From AND @To)"+A+l+"\ngroup by CreditAccount,VoucherNo"+m,S.length>0&&(y&&y.AddDays(1)==this.ViewModel.oReportDialog.FromDate.Date||(h+="\n--INEVENTORY DATA\nUNION ALL--Opening Dr\nSELECT DebitAccount AccountID,VoucherNo"+f+",sum(ACC."+o+") OP_Dr,0 OP_Cr,0 TR_Dr,0 TR_Cr"+u+G+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+S+"\nWHERE "+n+l+"\ngroup by DebitAccount,VoucherNo"+I+"\nUNION ALL--Opening Cr\nSELECT CreditAccount AccountID,VoucherNo"+f+",0 OP_Dr,sum(ACC."+o+") OP_Cr,0 TR_Dr, 0 TR_Cr"+c+x+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+S+"\nWHERE "+n+l+"\ngroup by CreditAccount,VoucherNo"+I),h+="\nUNION ALL--Transaction Dr\nSELECT DebitAccount AccountID,VoucherNo"+w+",0 OP_Dr,0 OP_Cr,sum("+o+") TR_Dr,0 TR_Cr"+d+W+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+S+"\nWHERE (DocDate BETWEEN @From AND @To)"+A+l+"\ngroup by DebitAccount,VoucherNo"+m+"\nUNION ALL--Transaction Cr\nSELECT CreditAccount AccountID,VoucherNo"+w+",0 OP_Dr,0 OP_Cr,0 TR_Dr,sum("+o+") TR_Cr"+C+W+"\nFROM ACC_DocDetails ACC  WITH(NOLOCK)"+S+"\nWHERE (DocDate BETWEEN @From AND @To)"+A+l+"\ngroup by CreditAccount,VoucherNo"+m),h+="\n) AS T1 "+(this.CADimension>0?" JOIN ACC_Accounts CA WITH(NOLOCK) ON CA.AccountID=T1.AccountID":"")+" GROUP BY T1.AccountID,VoucherNo"+E+(this.CADimension>0?",CA.AccountTypeID":"")+"\n) AS T2 GROUP BY AccountID"+E+"\n) AS ACC",u.length>0&&(h+=" inner join COM_Currency C with(nolock) on C.CurrencyID=ACC.CurrencyID"),h+=" RIGHT JOIN ACC_Accounts A1 WITH(NOLOCK) ON A1.AccountID=ACC.AccountID\n"+this.ViewModel.FromTag,this.CADimension>0&&(h+=" left JOIN COM_CCCCDATA A1CC WITH(NOLOCK) ON A1CC.CostCenterID=2 and A1CC.NodeID=A1.AccountID"),h+=P+this.GTPQuery+"\nWHERE A1.AccountID>1",h+=this.GetAccountTypeWhere("A1"),h+=this.GetAccountWiseLocationWhere("A1"),this.GTPWhere.length>0&&(h+=" AND "+this.GTPWhere),this.TBIsAccountWise?(h+=" AND A1.IsGroup=0",this.strOrder+="Code"==this.ViewModel.Preferences.TreeSortOn?"A1.AccountCode":"TreeOrder"==this.ViewModel.Preferences.TreeSortOn?"A1.lft":"A1.AccountName",h+=" Order By "+this.strOrder,this.Show==D.MonthWise&&(h+=",TagID"),h+=" select AccountID,AccountCode,AccountName,AccountTypeID,TB_INT TB,lft,Depth,ParentID from acc_accounts with(nolock) where IsGroup=1 Order By Depth"):(h+=" Order By A1.lft",this.Show==D.MonthWise&&(h+=",TagID"));var Q=new r.a;if(Q.push("ds",s.a.report.ReportDataSet("RPT022",this.ViewModel.IsReportDB,h.toString())),-1!=this.YTDIndex||-1!=this.BAL_LYIndex||-1!=this.YTD_LYIndex){if(h="",h+="\nSELECT AccountID,ISNULL(SUM(DR),0)-IsNULL(SUM(CR),0) Balance FROM (",h+="\n--Opening Dr\nSELECT DebitAccount AccountID,ACC."+o+" DR,0 CR\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+R+"\nWHERE ((ACC.DocumentType=16"+L+" AND DocDate<=@To) OR ((DocDate BETWEEN @From AND @To) "+A+"))"+l+"\nUNION ALL--Opening Cr\nSELECT CreditAccount AccountID,0 DR,ACC."+o+" CR\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+R+"\nWHERE ((ACC.DocumentType=16"+L+" AND DocDate<=@To) OR ((DocDate BETWEEN @From AND @To) "+A+"))"+l,S.length>0&&(h+="\n--INEVENTORY DATA\nUNION ALL--Opening Dr\nSELECT DebitAccount AccountID,ACC."+o+" DR,0 CR\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+S+"\nWHERE ((ACC.DocumentType=16"+L+" AND DocDate<=@To) OR ((DocDate BETWEEN @From AND @To) "+A+"))"+l+"\nUNION ALL--Opening Cr\nSELECT CreditAccount AccountID,0 DR,ACC."+o+" CR\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+S+"\nWHERE ((ACC.DocumentType=16"+L+" AND DocDate<=@To) OR ((DocDate BETWEEN @From AND @To) "+A+"))"+l),h+=") AS T1 GROUP BY AccountID",!i.e.IsEmpty(e)){var j=e.split(",");j.Contains("1")||j.Contains("0")||(h+=" HAVING AccountID IN ("+e+")")}-1!=this.BAL_LYIndex&&Q.push("dvBAL_LYTable",s.a.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,"DECLARE @From FLOAT,@To FLOAT\nSET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.AddYears(-1).ToString("dd MMM yyyy")+"'))\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.AddYears(-1).ToString("dd MMM yyyy")+"'))\n"+h)),-1!=this.YTD_LYIndex&&Q.push("dvYTD_LY",s.a.report.ReportDataTable("RPT022",this.ViewModel.IsReportDB,"DECLARE @From FLOAT,@To FLOAT\nSET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.dtYearStartMonth.AddYears(-1).ToString("dd MMM yyyy")+"'))\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.AddYears(-1).ToString("dd MMM yyyy")+"'))\n"+h))}return this.dvOpenCompany=null,this.dvOpenCompanyTable=null,this.dsOpenCompany=null,0==this.TBGroupID.length&&this.OpenCompany?Q.push("dsOpenCompany",s.a.report.GetOpenCompanyData(this.ViewModel.StaticReportType,H,this.ViewModel.oReportDialog.ToDate.Date,this.TagID,this.LocationWhere+v,!0,this.UnPostedDocsList,this.PDCInclude,this.IncludeTerminatedPDC,"",this.CurrencyType,this.ForeignCurrencyID,this.exchRate,this.ViewModel.IsReportDB)):this.OpenCompany=!1,Promise.all(Q.values).then((function(e){var t;if(a.ds=e[0],Q.ContainsKey("dvBAL_LYTable")&&(t=Q.keys.indexOf("dvBAL_LYTable"),a.dvBAL_LYTable=e[t].Tables[0],a.ds.Columns[0].push("LastYearBalance")),Q.ContainsKey("dvYTD_LY")&&(t=Q.keys.indexOf("dvYTD_LY"),a.dvYTD_LY=e[t].Tables[0],a.ds.Columns[0].push("LastYearYTD")),Q.ContainsKey("dsOpenCompany")&&(t=Q.keys.indexOf("dsOpenCompany"),a.dsOpenCompany=e[t],a.dvOpenCompany=a.dvOpenCompanyTable=a.dsOpenCompany.Tables[0]),a.CADimension>0)for(var o=new r.c,s=a.ds.Tables[0],i=s.length-1;i>=0;i--)null!=s[i].CADID&&parseInt(s[i].CADID)>1&&function(){var e=parseInt(s[i].CADID);if(!o.ContainsKey(e)){var t=s.filter((function(t){return t.CAD==e}));t.length>0&&o.push(e,t[0])}o.ContainsKey(e)&&(null!=s[i].OP_Dr&&(o[e].OP_Dr=null==o[e].OP_Dr?s[i].OP_Dr:parseFloat(o[e].OP_Dr)+parseFloat(s[i].OP_Dr)),null!=s[i].OP_Cr&&(o[e].OP_Cr=null==o[e].OP_Cr?s[i].OP_Cr:parseFloat(o[e].OP_Cr)+parseFloat(s[i].OP_Cr)),null!=s[i].TR_Dr&&(o[e].TR_Dr=null==o[e].TR_Dr?s[i].TR_Dr:parseFloat(o[e].TR_Dr)+parseFloat(s[i].TR_Dr)),null!=s[i].TR_Cr&&(o[e].TR_Cr=null==o[e].TR_Cr?s[i].TR_Cr:parseFloat(o[e].TR_Cr)+parseFloat(s[i].TR_Cr)),o.values.Contains(s[i])||s.RemoveAt(i))}()}))}},{key:"AddReportTotals",value:function(){if(4==this.ViewModel.StaticReportType){var e=0,t=0;if(this.IsTTypeTB){if(!this.HideOpeningProfitAndLoss&&this.OpenCompany){var o=this.dsOpenCompany.Tables[0].Compute("sum","Dr");e=null!=o?parseFloat(o):0,t=null!=(o=this.dsOpenCompany.Tables[0].Compute("sum","Cr"))?parseFloat(o):0,e>0&&((e-=this.dblDrOpenCompany)<0&&(e=0)),t>0&&((t-=this.dblCrOpenCompany)<0&&(t=0)),0==e&&0==t||(this.row=this.NewReportRow_2(a.f.BalanceBF,this.GrossTotalAppearance_Data),this.row.LevelNo=0,this.row.Cells[0].CellAppearance=this.GrossTotalAppearance,this.row.Cells[0].ColSpan=this.BalIndex,this.row.Cells[0].Text=s.a.GetResource("Reports_OpeningProfitAndLossBalance"),e>t?(this.dbl=e-t,this.dbl=this.ViewModel.RoundOff(this.dbl,this.oColumns[this.BalIndex].DataFormat),this.ReportTotal[0]+=this.dbl,this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.row.Cells[this.BalIndex])):(this.dbl=t-e,this.dbl=this.ViewModel.RoundOff(this.dbl,this.oColumns[this.CellStartPos+this.BalIndex].DataFormat),this.ReportTotal[1]+=this.dbl,this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.CellStartPos+this.BalIndex].DataFormat,"FLOAT",this.row.Cells[this.CellStartPos+this.BalIndex])),this.GrdRow++,this.ViewModel.addRow(this.row))}this.HideOpeningBalanceDifference||(e=this.arrTBTotals[0]+this.dblMissingOpeningDr,t=this.arrTBTotals[1]+this.dblMissingOpeningCr,parseFloat(Math.abs(t-e).ToString("N1"))>.1&&(this.row=this.NewReportRow_2(a.f.BalanceBF,this.GrossTotalAppearance_Data),this.row.LevelNo=0,this.row.Cells[0].CellAppearance=this.GrossTotalAppearance,this.row.Cells[0].ColSpan=this.BalIndex,this.row.Cells[0].Text=s.a.GetResource("Reports_OpeningBalanceDifference"),e>t?(this.dbl=e-t,this.dbl=this.ViewModel.RoundOff(this.dbl,this.oColumns[this.CellStartPos+this.BalIndex].DataFormat),this.ReportTotal[1]+=this.dbl,this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.CellStartPos+this.BalIndex].DataFormat,"FLOAT",this.row.Cells[this.CellStartPos+this.BalIndex])):(this.dbl=t-e,this.dbl=this.ViewModel.RoundOff(this.dbl,this.oColumns[this.BalIndex].DataFormat),this.ReportTotal[0]+=this.dbl,this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.row.Cells[this.BalIndex])),this.GrdRow++,this.ViewModel.addRow(this.row))),this.row=this.NewReportRow_2(a.f.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance),this.ViewModel.GrpReportTotal.Height>0&&(this.row.Height=this.ViewModel.GrpReportTotal.Height),this.row.LevelNo=0,this.row.Cells[this.BalIndex].CellAppearance.Alignment="Right",this.row.Cells[this.BalIndex+this.TTColumnSize].CellAppearance.Alignment="Right",this.ViewModel.SetCellValue(this.ReportTotal[0],this.oColumns[this.BalIndex].DataFormat,this.oColumns[this.BalIndex].ColumnType,this.row.Cells[this.BalIndex]),this.ViewModel.SetCellValue(this.ReportTotal[1],this.oColumns[this.BalIndex].DataFormat,this.oColumns[this.BalIndex+this.TTColumnSize].ColumnType,this.row.Cells[this.BalIndex+this.TTColumnSize]),this.row.Cells[0].Text=s.a.GetResource("Reports_ReportTotal"),this.BalIndex>0&&(this.row.Cells[0].ColSpan=this.BalIndex),this.GrdRow++,this.ViewModel.addRow(this.row)}else{if(this.UpdateTreeTotals(0),!this.HideOpeningProfitAndLoss&&this.OpenCompany){var i=this.dsOpenCompany.Tables[0].Compute("sum","Dr");e=null!=i?parseFloat(i):0,t=null!=(i=this.dsOpenCompany.Tables[0].Compute("sum","Cr"))?parseFloat(i):0,e>0&&(((e-=this.dblDrOpenCompany)<0||e<1e-4)&&(e=0)),t>0&&((t-=this.dblCrOpenCompany)<0&&(t=0)),0==e&&0==t||(this.row=this.NewReportRow_2(a.f.BalanceBF,this.GrossTotalAppearance_Data),this.row.LevelNo=0,this.row.Cells[0].CellAppearance=this.GrossTotalAppearance,this.row.Cells[0].ColSpan=2,this.row.Cells[0].Text=s.a.GetResource("Reports_OpeningProfitAndLossBalance"),!this.OpDrCrInOpDr&&e>t?(this.dbl=e-t,-1!=this.colTBOp_DrIndex&&(this.lstTotal[0][this.colTBOp_DrIndex]+=this.dbl,this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.colTBOp_DrIndex].DataFormat,"FLOAT",this.row.Cells[this.colTBOp_DrIndex])),-1!=this.colTBCl_DrIndex&&(this.lstTotal[0][this.colTBCl_DrIndex]+=this.dbl,this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.colTBCl_DrIndex].DataFormat,"FLOAT",this.row.Cells[this.colTBCl_DrIndex]))):(this.dbl=t-e,-1!=this.colTBOp_CrIndex&&(this.lstTotal[0][this.colTBOp_CrIndex]+=this.dbl,this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.colTBOp_CrIndex].DataFormat,"FLOAT",this.row.Cells[this.colTBOp_CrIndex])),-1!=this.colTBCl_CrIndex&&(this.lstTotal[0][this.colTBCl_CrIndex]+=this.dbl,this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.colTBCl_CrIndex].DataFormat,"FLOAT",this.row.Cells[this.colTBCl_CrIndex]))),-1!=this.colBalanceIndex&&(this.lstTotal[0][this.colBalanceIndex]+=e-t,this.ViewModel.SetCellValue(e-t,this.oColumns[this.colBalanceIndex].DataFormat,"FLOAT",this.row.Cells[this.colBalanceIndex])),this.GrdRow++,this.ViewModel.addRow(this.row))}this.HideOpeningBalanceDifference||(e=this.arrTBTotals[0]+this.dblMissingOpeningDr,t=this.arrTBTotals[1]+this.dblMissingOpeningCr,parseFloat(Math.abs(t-e).ToString("N1"))>.1&&(this.row=this.NewReportRow_2(a.f.BalanceBF,this.GrossTotalAppearance_Data),this.row.LevelNo=0,this.row.Cells[0].CellAppearance=this.GrossTotalAppearance,this.row.Cells[0].ColSpan=2,this.row.Cells[0].Text=s.a.GetResource("Reports_OpeningBalanceDifference"),!this.OpDrCrInOpDr&&e>t?(this.dbl=e-t,-1!=this.colTBOp_CrIndex&&(this.lstTotal[0][this.colTBOp_CrIndex]+=this.dbl,this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.colTBOp_CrIndex].DataFormat,"FLOAT",this.row.Cells[this.colTBOp_CrIndex])),-1!=this.colTBCl_CrIndex&&(this.lstTotal[0][this.colTBCl_CrIndex]+=this.dbl,this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.colTBCl_CrIndex].DataFormat,"FLOAT",this.row.Cells[this.colTBCl_CrIndex]))):(this.dbl=t-e,-1!=this.colTBOp_DrIndex&&(this.lstTotal[0][this.colTBOp_DrIndex]+=this.dbl,this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.colTBOp_DrIndex].DataFormat,"FLOAT",this.row.Cells[this.colTBOp_DrIndex])),-1!=this.colTBCl_DrIndex&&(this.lstTotal[0][this.colTBCl_DrIndex]+=this.dbl,this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.colTBCl_DrIndex].DataFormat,"FLOAT",this.row.Cells[this.colTBCl_DrIndex]))),-1!=this.colBalanceIndex&&(this.lstTotal[0][this.colBalanceIndex]+=t-e,this.ViewModel.SetCellValue(t-e,this.oColumns[this.colBalanceIndex].DataFormat,"FLOAT",this.row.Cells[this.colBalanceIndex])),this.GrdRow++,this.ViewModel.addRow(this.row))),this.row=this.NewReportRow_2(a.f.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance),this.ViewModel.GrpReportTotal.Height>0&&(this.row.Height=this.ViewModel.GrpReportTotal.Height),this.row.LevelNo=0;var l=-1;for(this.k=0;this.k<this.ViewModel.ColumnSource.length;this.k++)this.ViewModel.GrpReportTotal.TotalCols.ContainsKey(this.oColumns[this.k].ID)&&(-1==l&&(l=this.k),this.row.Cells[this.k].CellAppearance.Alignment="Right",this.ViewModel.SetCellValue(this.lstTotal[0][this.k].toString(),this.oColumns[this.k].DataFormat,this.oColumns[this.k].ColumnType,this.row.Cells[this.k]));for(this.k=this.ViewModel.ColumnSource.length;this.k<this.oColumns.length;this.k++)-1==l&&(l=this.k),this.row.Cells[this.k].CellAppearance.Alignment="Right",this.ViewModel.SetCellValue(this.lstTotal[0][this.k].toString(),this.oColumns[this.k].DataFormat,this.oColumns[this.k].ColumnType,this.row.Cells[this.k]);this.row.Cells[0].Text=s.a.GetResource("Reports_ReportTotal"),l>0&&(this.GrdRow++,this.row.Cells[0].ColSpan=l,this.ViewModel.addRow(this.row))}}else if(169==this.ViewModel.StaticReportType);else if(this.ViewModel.totals=this.AggTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance.IsVisible){this.GrdRow++,this.row=this.NewReportRow_2(a.f.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance),this.ViewModel.GrpReportTotal.Height>0&&(this.row.Height=this.ViewModel.GrpReportTotal.Height),this.row.LevelNo=0;var n=-1;for(this.k=0;this.k<this.oColumns.length;this.k++)this.ViewModel.GrpReportTotal.TotalCols.ContainsKey(this.oColumns[this.k].ID)&&(-1==n&&(n=this.k),this.row.Cells[this.k].CellAppearance.Alignment="Right",this.ViewModel.SetCellValue(this.AggTotal[this.k][0].toString(),this.oColumns[this.k].DataFormat,"FLOAT",this.row.Cells[this.k]));this.row.Cells[0].Text=s.a.GetResource("Reports_ReportTotal"),n>0&&(this.row.Cells[0].ColSpan=n,this.ViewModel.addRow(this.row))}}},{key:"LoadReportWithPostFilters",value:function(e){var t=this;if(this.GrdRow=-1,this.IsRetainedEarning=!1,2==this.ViewModel.StaticReportType||3==this.ViewModel.StaticReportType?this.AggTotal=new Array(this.oColumns.length).fill(0).map((function(){return new Array(2).fill(0)})):1!=this.ViewModel.StaticReportType&&86!=this.ViewModel.StaticReportType||(this.AggTotal=new Array(this.oColumns.length).fill(0).map((function(){return new Array(5).fill(0)}))),this.ViewModel.ClearRows(),this.ViewModel.lstGroupIndex.Clear(),1==this.ViewModel.StaticReportType||86==this.ViewModel.StaticReportType){if(null==this.dsAccount)return;if(e.length>0?(e=" AND "+e,this.AccountsWithOutTransactions=!1):this.AccountsWithOutTransactions="1"==this.ViewModel.Preferences.WantAccountsWithoutTransactions,this.filter=e,1==this.ViewModel.StaticReportType&&2==this.ViewModel.lstGroup.length){var o,s=this.ChunkSize;for(this.iLoop=0,o=0;this.iLoop<this.dsAccount.Tables[0].length;this.iLoop+=s,o++)for(this.ds=this.DataSetCollection[o],this.dvAccount=this.ds.Tables[0],this.IsControlAccounts?(this.IsCurrentControlAccount=!1,s=this.iDataSetCollection[o],1==parseInt(this.dsAccount.Tables[0][this.iLoop].IsControl)&&(this.IsCurrentControlAccount=!0)):s=this.ChunkSize,this.jAccount=this.iLoop;this.jAccount<this.dsAccount.Tables[0].length&&this.jAccount-this.iLoop<s;this.jAccount++)if(this.strAccountID=this.dsAccount.Tables[0][this.jAccount][this.dsAccount.Columns[0][0]].toString(),this.dv=this.ds.Tables[1],this.dvTable=this.ds.Tables[1],this.dvColumns=this.ds.Columns[1],this.strAccountFilter="AccountID="+this.strAccountID,this.strAccountFilterObj={AccountID:this.strAccountID},this.IsCurrentControlAccount&&(this.strAccountFilter="1=1"),this.dv=this.dvTable.filter((function(e){return e.AccountID==t.strAccountID})),this.dv=c.a.FilterData(this.dv,this.ViewModel.PostDataFetchFilterFields),this.dvAccount=this.dvAccountTable.filter((function(e){return e.AccountID==t.strAccountID})),this.ds.Tables.length>2&&(this.dvTbl2=this.ds.Tables[2].filter((function(e){return e.AccountID==t.strAccountID})),this.dvTbl2=c.a.FilterData(this.dvTbl2,this.ViewModel.PostDataFetchFilterFields),this.dvTbl2Table=this.ds.Tables[2],this.dvTbl2Columns=this.ds.Columns[2]),0!=this.dvAccount.length||0!=this.dv.length){for(var i=0;i<this.oColumns.length;i++)this.AggTotal[i][4]=0;this.IsNewAccount=!0,this.dvAccount.forEach((function(e){t.strTagID=e.TAG.toString(),t.strTagName=e.Name.toString(),t.strAccountType=t.dsAccount.Tables[0][t.jAccount].AccountTypeID.toString(),t.strAccountName=t.dsAccount.Tables[0][t.jAccount].AccountName.toString(),t.strAccountFilterObj={},t.IsCurrentControlAccount?t.strAccountFilterObj.TAG=t.strTagID:(t.strAccountFilterObj.TAG=t.strTagID,t.strAccountFilterObj.AccountID=t.strAccountID),t.dv=t.ds.Tables[1],t.dvTable=t.ds.Tables[1],t.dvColumns=t.ds.Columns[1],t.dv=t.dv.filter((function(e){return e.TAG==t.strTagID})),t.IsCurrentControlAccount||(t.dv=t.dv.filter((function(e){return e.AccountID==t.strAccountID}))),t.dv=c.a.FilterData(t.dv,t.ViewModel.PostDataFetchFilterFields),t.ds.Tables.length>2&&(t.dvTbl2=t.ds.Tables[2].filter((function(e){return e.TAG==t.strAccountID})),t.dvTbl2=c.a.FilterData(t.dvTbl2,t.ViewModel.PostDataFetchFilterFields)),t.OpBalance=parseFloat(e.BF),t.ExcludeOpBalance&&(t.OpBalance=0),t.AllowAddRows=!!(t.dv.length>0||t.AccountsWithOutTransactions||t.ds.Tables.length>2&&t.dvTbl2.length>0),t.UnPostedDocsInclude&&t.UnPostedDocsSeparately&&(t.strAccountFilterObj.StatusID=[369,429],t.dv=t.dv.filter((function(e){return 369==e.StatusID||429==e.StatusID}))),t.AllowAddRows&&(t.AccountsWithZeroBalance||0!=t.GetBalance())&&t.addGeneralLedger()})),this.ViewModel.lstGroup[0].SubTotalAppearance.IsVisible&&this.AddSubTotal(this.strAccountName,4)}}else{var l,n=0;for(this.iLoop=0,l=0;this.iLoop<this.dsAccount.Tables[0].length;this.iLoop+=n,l++)for(this.ds=this.DataSetCollection[l],this.dvAccount=this.ds.Tables[0],this.IsControlAccounts?(this.IsCurrentControlAccount=!1,n=this.ds.Tables[0].length,1==parseInt(this.dsAccount.Tables[0][this.iLoop].IsControl)&&(this.IsCurrentControlAccount=!0)):n=this.ChunkSize,this.jAccount=this.iLoop;this.jAccount<this.dsAccount.Tables[0].length&&this.jAccount-this.iLoop<n;this.jAccount++)this.strAccountID=this.dsAccount.Tables[0][this.jAccount].AccountID.toString(),this.dvAccount=this.ds.Tables[0].filter((function(e){return e.AccountID==t.strAccountID})),this.dv=this.ds.Tables[1],this.dvTable=this.ds.Tables[1],this.dvColumns=this.ds.Columns[1],this.strAccountFilterObj={},this.strAccountName=this.dsAccount.Tables[0][this.jAccount].AccountName.toString(),this.IsCurrentControlAccount?this.dv=this.dv:(this.strAccountFilterObj.AccountID=this.strAccountID,this.dv=this.dv.filter((function(e){return e.AccountID==t.strAccountID}))),this.dv=c.a.FilterData(this.dv,this.ViewModel.PostDataFetchFilterFields),this.OpBalance=parseFloat(this.dvAccount[0].BF),this.strAccountType=this.dsAccount.Tables[0][this.jAccount].AccountTypeID.toString(),this.strAccountName=this.dsAccount.Tables[0][this.jAccount].AccountName.toString(),this.AllowAddRows=!!(this.dv.length>0||this.AccountsWithOutTransactions||this.ds.Tables.length>2&&this.dvTbl2.length>0),this.ExcludeOpBalance&&(this.OpBalance=0),this.UnPostedDocsInclude&&this.UnPostedDocsSeparately&&(this.strAccountFilterObj.StatusID=[369,429],this.dv=this.dv.filter((function(e){return 369==e.StatusID||429==e.StatusID}))),this.AllowAddRows&&(this.AccountsWithZeroBalance||0!=this.GetBalance())&&(this.IsNewAccount=!0,-1==this.colOpBalanceIndex?this.addGeneralLedger():this.addGL_DimWiseSummary())}}else if(2==this.ViewModel.StaticReportType||3==this.ViewModel.StaticReportType){if(null==this.dsAccount)return;var a;for(e.length>0&&(e=" AND "+e),this.filter=e,this.iLoop=0,a=0;this.iLoop<this.dsAccount.Tables[0].length;this.iLoop+=this.ChunkSize,a++){this.ds=this.DataSetCollection[a],this.dvAccount=this.ds.Tables[0].DefaultView;for(var r=this.iLoop;r<this.dsAccount.Tables[0].length&&r-this.iLoop<this.ChunkSize;r++)this.strAccountID=this.dsAccount.Tables[0][r][this.dsAccount.Columns[0][0]].toString(),this.strAccountFilterObj={AccountID:this.strAccountID},this.dvAccount=this.dvAccountTable.filter((function(e){return e.AccountID==t.strAccountID})),this.strAccountName=this.dsAccount.Tables[0][r].AccountName.toString(),this.strAccountType=this.dsAccount.Tables[0][r].AccountTypeID.toString(),this.dv=this.dvTable.filter((function(e){return e.AccountID==t.strAccountID})),this.dv=c.a.FilterData(this.dv,this.ViewModel.PostDataFetchFilterFields),this.OpBalance=parseFloat(this.dvAccount[0].BF),(this.dv.length>0||0!=this.OpBalance)&&this.addCashBookAndBankBook()}}else if(156==this.ViewModel.StaticReportType){if(null==this.dsAccount)return;e.length>0&&(e=" AND "+e),this.filter=e,this.ds=this.DataSetCollection[0],this.dvAccount=this.ds.Tables[0];for(var h=this.i;h<this.dsAccount.Tables[0].length;h++)this.strAccountID=this.dsAccount.Tables[0][this.jAccount].NodeID.toString(),this.strAccountFilterObj={},this.strAccountFilterObj.TAG=this.strAccountID,this.strAccountName=this.dsAccount.Tables[0][this.jAccount].TagName.toString(),this.dvAccount=this.dvAccountTable.fill((function(e){return e.TAG==t.strAccountID})),this.dv=this.dvTable.fill((function(e){return e.TAG==t.strAccountID})),this.dv=c.a.FilterData(this.dv,this.ViewModel.PostDataFetchFilterFields),this.ds.Tables.length>2&&(this.dvTbl2=this.ds.Tables[2].filter((function(e){return e.TAG==t.strAccountID})),this.dvTbl2=c.a.FilterData(this.dvTbl2,this.ViewModel.PostDataFetchFilterFields)),this.OpBalance=this.dvAccount.length>0?parseFloat(this.dvAccount[0].BF):0,this.strAccountName=this.dsAccount.Tables[0][h].TagName.toString(),this.AllowAddRows=!!(this.dv.length>0||this.AccountsWithOutTransactions||this.ds.Tables.length>2&&this.dvTbl2.length>0),this.UnPostedDocsInclude&&this.UnPostedDocsSeparately&&(this.strAccountFilterObj.StatusID=[369,429],this.dv=this.dv.filter((function(e){return 369==e.StatusID||429==e.StatusID}))),this.AllowAddRows&&(this.AccountsWithZeroBalance||0!=this.GetBalance())&&(this.IsNewAccount=!0,this.addGeneralLedger())}else this.filter=e,this.IsTTypeTB?this.addTrialBalanceTType():(this.dv=c.a.FilterData(this.ds.Tables[0],this.ViewModel.PostDataFetchFilterFields),this.addTrialBalance());this.LoadReportComplete()}},{key:"addGeneralLedger",value:function(){for(var e,t,o,l=this,n=0;n<this.oColumns.length;n++)this.AggTotal[n][1]=0,this.AggTotal[n][2]=0,this.AggTotal[n][3]=0;(this.k=0,this.IsNewAccount&&this.ViewModel.lstGroup.length>0&&this.ViewModel.lstGroup[0].GroupAppearance.IsVisible&&(this.GrdRow++,this.ViewModel.lstGroupIndex.push(this.GrdRow),this.row=this.NewReportRow_2(a.f.Group,this.ViewModel.lstGroup[0].GroupAppearance),this.ViewModel.lstGroup[0].Height>0&&(this.row.Height=this.ViewModel.lstGroup[0].Height),this.row.PrintVisible=this.ViewModel.lstGroup[0].GroupAppearance.IsPrintVisible,this.row.NodeID=parseInt(this.strAccountID),this.ViewModel.FormulasCalculated||i.e.IsEmpty(this.ViewModel.lstGroup[0].Formula)||(this.ViewModel.CalculateFormula_2(this.ViewModel.lstGroup[0],this.dsAccount.Tables[0][this.jAccount]),this.strAccountName=i.e.String(this.dsAccount.Tables[0][this.jAccount][this.ViewModel.lstGroup[0].ID])),this.row.Cells[0].Text=this.strAccountName,this.row.Cells[0].ColSpan=this.row.Cells.length,this.row.LevelNo=0,this.Balance=0,this.ViewModel.addRow(this.row),this.IsNewAccount=!1),this.ViewModel.lstGroup.length>1&&(this.GrdRow++,this.row=this.NewReportRow_2(a.f.Group,this.ViewModel.lstGroup[1].GroupAppearance),this.ViewModel.lstGroup[1].Height>0&&(this.row.Height=this.ViewModel.lstGroup[1].Height),this.row.PrintVisible=this.ViewModel.lstGroup[1].GroupAppearance.IsPrintVisible,this.row.Cells[0].Text=this.ViewModel.lstGroup[1].Prefix+this.strTagName,this.row.Cells[0].ColSpan=this.row.Cells.length,this.row.LevelNo=1,this.Balance=0,this.ViewModel.addRow(this.row)),this.Balance=0,0!=this.OpBalance)&&(this.GrdRow++,this.Balance=this.OpBalance,this.row=this.NewReportRow_2(a.f.BalanceBF,this.BalanceBFAppearance),this.row.LevelNo=this.ViewModel.lstGroup.length,(e=this.row.Cells[0]).ColSpan=this.colSpanBF,e.Text=s.a.GetResource("Reports_OpeningBalance"),-1!=this.colBalanceIndex?(this.AggTotal[this.colBalanceIndex][1]=this.OpBalance,this.row.Cells[this.colBalanceIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(this.Balance,this.oColumns[this.colBalanceIndex].DataFormat,"FLOAT",this.row.Cells[this.colBalanceIndex])):this.AggTotal[this.AggTotal.length-1][1]=this.OpBalance,this.colDebitIndex>-1&&this.OpBalance>0&&(this.row.Cells[this.colDebitIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(this.OpBalance,this.oColumns[this.colDebitIndex].DataFormat,"FLOAT",this.row.Cells[this.colDebitIndex]),this.IncludeBFInTotals&&(this.AggTotal[this.colDebitIndex][1]=this.OpBalance)),this.colCreditIndex>-1&&this.OpBalance<0&&(this.row.Cells[this.colCreditIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(-this.OpBalance,this.oColumns[this.colCreditIndex].DataFormat,"FLOAT",this.row.Cells[this.colCreditIndex]),this.IncludeBFInTotals&&(this.AggTotal[this.colCreditIndex][1]=-this.OpBalance)),-1!=this.colLocalAmtInd&&this.dvAccount.length>0&&!i.e.IsEmpty(this.dvAccount[0].LocalAmount)&&(this.dbl=parseFloat(this.dvAccount[0].LocalAmount),this.AggTotal[this.colLocalAmtInd][1]=this.dbl,this.row.Cells[this.colLocalAmtInd].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.colLocalAmtInd].DataFormat,"FLOAT",this.row.Cells[this.colLocalAmtInd])),this.ShowTagWise?this.TagCols.forEach((function(e){var t=l.oColumns.indexOf(e);l.dvAccount[0][e.ID]&&(l.dbl=parseFloat(l.dvAccount[0][e.ID]),l.row.Cells[t].CellAppearance=l.BalanceBFAppearance_Data,l.ViewModel.SetCellValue(l.dbl,l.oColumns[t].DataFormat,"FLOAT",l.row.Cells[t]),l.IncludeBFInTotals&&(l.AggTotal[t][1]=l.dbl))})):-1==this.CurrencyType&&this.TagCols.forEach((function(e){var t=l.oColumns.indexOf(e);null!=l.dvAccount[0][e.ID]&&(l.dbl=parseInt(l.dvAccount[0][e.ID]),l.dbl=l.ViewModel.RoundOff(l.dbl,l.oColumns[t].DataFormat),l.row.Cells[t].CellAppearance=l.BalanceBFAppearance_Data,l.ViewModel.SetCellValue(l.dbl,l.oColumns[t].DataFormat,"FLOAT",l.row.Cells[t]),l.IncludeBFInTotals&&(l.AggTotal[t][1]=l.dbl),l.dbl>0&&(t-=2,l.dbl=l.ViewModel.RoundOff(l.dbl,l.oColumns[t].DataFormat),l.row.Cells[t].CellAppearance=l.BalanceBFAppearance_Data,l.ViewModel.SetCellValue(l.dbl,l.oColumns[t].DataFormat,"FLOAT",l.row.Cells[t]),l.IncludeBFInTotals&&(l.AggTotal[t][1]=l.dbl)),l.dbl<0&&(t-=1,l.dbl=l.ViewModel.RoundOff(l.dbl,l.oColumns[t].DataFormat),l.row.Cells[t].CellAppearance=l.BalanceBFAppearance_Data,l.ViewModel.SetCellValue(-l.dbl,l.oColumns[t].DataFormat,"FLOAT",l.row.Cells[t]),l.IncludeBFInTotals&&(l.AggTotal[t][1]=-l.dbl)))})),this.ViewModel.addRow(this.row));if(1==this.ViewModel.StaticReportType&&(this.UnPostedDocsInclude&&this.UnPostedDocsSeparately||this.PDCInclude&&this.PDCSeperate)?this.dv.length>0&&this.AddRowsWithSubTotal(""):this.AddRows(),this.UnPostedDocsInclude&&this.UnPostedDocsSeparately)if(this.UnPostedDocsSeparatelyByStatus)for(var r=function(e){l.dv=l.dvTable.filter((function(t){return(Object(h.isUndefined)(l.strAccountFilterObj.AccountID)||t.AccountID==l.strAccountFilterObj.AccountID)&&t.StatusID==l.arrUnPostedStatusesID[e]})),l.dv.length>0&&(l.GrdRow++,l.row=l.NewReportRow_2(a.f.GrossTotal,l.GrossTotalAppearance),l.row.LevelNo=l.ViewModel.lstGroup.length,l.row.Cells[0].ColSpan=l.ViewModel.ReportColumns.length,l.row.Cells[0].Text=l.arrUnPostedStatuses[e],l.ViewModel.addRow(l.row),l.AddRowsWithSubTotal(l.row.Cells[0].Text))},u=0;u<this.arrUnPostedStatuses.length;u++)r(u);else this.dv=this.dvTable.filter((function(e){return(Object(h.isUndefined)(l.strAccountFilterObj.AccountID)||e.AccountID==l.strAccountFilterObj.AccountID)&&369!=e.StatusID&&429!=e.StatusID})),this.dv.length>0&&(this.GrdRow++,this.row=this.NewReportRow_2(a.f.GrossTotal,this.GrossTotalAppearance),this.row.LevelNo=this.ViewModel.lstGroup.length,this.row.Cells[0].ColSpan=this.ViewModel.ReportColumns.length,this.row.Cells[0].Text=s.a.GetResource("Reports_LblUnPostedDocs"),this.ViewModel.addRow(this.row),this.AddRowsWithSubTotal(this.row.Cells[0].Text));(this.PDCInclude&&this.PDCSeperate&&(this.AddPDCRows(370),this.IncludeTerminatedPDC&&this.AddPDCRows(452)),this.Balance=0,this.IsRetainedEarning)&&(this.GrdRow++,this.row=this.NewReportRow_2(a.f.BalanceBF,this.BalanceBFAppearance),this.row.LevelNo=this.ViewModel.lstGroup.length,(t=this.row.Cells[0]).ColSpan=this.colSpanBF,t.Text="Retained Earning For The Priod",-1!=this.colBalanceIndex?(this.AggTotal[this.colBalanceIndex][1]+=this.GLRetainedAccounts[this.strAccountID],this.row.Cells[this.colBalanceIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(this.AggTotal[this.colBalanceIndex][1],this.oColumns[this.colBalanceIndex].DataFormat,"FLOAT",this.row.Cells[this.colBalanceIndex])):this.AggTotal[this.AggTotal.length-1][1]+=this.GLRetainedAccounts[this.strAccountID],this.colDebitIndex>-1&&this.GLRetainedAccounts[this.strAccountID]>0&&(this.row.Cells[this.colDebitIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(this.GLRetainedAccounts[this.strAccountID],this.oColumns[this.colDebitIndex].DataFormat,"FLOAT",this.row.Cells[this.colDebitIndex]),this.AggTotal[this.colDebitIndex][1]+=this.GLRetainedAccounts[this.strAccountID]),this.colCreditIndex>-1&&this.GLRetainedAccounts[this.strAccountID]<0&&(this.row.Cells[this.colCreditIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(-this.GLRetainedAccounts[this.strAccountID],this.oColumns[this.colCreditIndex].DataFormat,"FLOAT",this.row.Cells[this.colCreditIndex]),this.AggTotal[this.colCreditIndex][1]=this.AggTotal[this.colCreditIndex][1]-this.GLRetainedAccounts[this.strAccountID]),this.ViewModel.addRow(this.row));this.ShowUnInvoicedAmount&&null!=this.dsAccount.Tables[0][this.jAccount].UnInvoicedAmount&&(this.GrdRow++,this.row=this.NewReportRow_2(a.f.BalanceBF,this.BalanceBFAppearance),this.row.LevelNo=this.ViewModel.lstGroup.length,(o=this.row.Cells[0]).ColSpan=this.colSpanBF,o.Text="Un-Invoiced Amount",this.dbl=parseFloat(this.dsAccount.Tables[0][this.jAccount].UnInvoicedAmount),this.colDebitIndex>-1&&(this.row.Cells[this.colDebitIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.colDebitIndex].DataFormat,"FLOAT",this.row.Cells[this.colDebitIndex])),this.ViewModel.addRow(this.row));for(var c=0;c<this.oColumns.length;c++)"INT"!=this.oColumns[c].ColumnType&&"FLOAT"!=this.oColumns[c].ColumnType||(this.AggTotal[c][0]+=this.AggTotal[c][1],this.AggTotal[c][4]+=this.AggTotal[c][1]);return 2==this.ViewModel.lstGroup.length?this.ViewModel.lstGroup[1].SubTotalAppearance.IsVisible&&this.AddSubTotal(this.strTagName,1):this.STAccountWise&&this.AddSubTotal(this.strAccountName,1),0}},{key:"addGL_DimWiseSummary",value:function(){for(var e=0;e<this.oColumns.length;e++)this.AggTotal[e][1]=0,this.AggTotal[e][2]=0,this.AggTotal[e][3]=0;for(this.k=0,this.IsNewAccount&&this.ViewModel.lstGroup.length>0&&this.ViewModel.lstGroup[0].GroupAppearance.IsVisible&&(this.GrdRow++,this.ViewModel.lstGroupIndex.push(this.GrdRow),this.row=this.NewReportRow_2(a.f.Group,this.ViewModel.lstGroup[0].GroupAppearance),this.row.PrintVisible=this.ViewModel.lstGroup[0].GroupAppearance.IsPrintVisible,this.row.NodeID=parseInt(this.strAccountID),this.ViewModel.FormulasCalculated||i.e.IsEmpty(this.ViewModel.lstGroup[0].Formula)||(this.ViewModel.CalculateFormula_2(this.ViewModel.lstGroup[0],this.dsAccount.Tables[0][this.jAccount]),this.strAccountName=i.e.String(this.dsAccount.Tables[0][this.jAccount][this.ViewModel.lstGroup[0].ID])),this.row.Cells[0].Text=this.strAccountName,this.row.Cells[0].ColSpan=this.row.Cells.length,this.row.LevelNo=0,this.Balance=0,this.ViewModel.addRow(this.row),this.IsNewAccount=!1),this.ViewModel.lstGroup.length>1&&(this.GrdRow++,this.row=this.NewReportRow_2(a.f.Group,this.ViewModel.lstGroup[1].GroupAppearance),this.row.PrintVisible=this.ViewModel.lstGroup[1].GroupAppearance.IsPrintVisible,this.row.Cells[0].Text=this.ViewModel.lstGroup[1].Prefix+this.strTagName,this.row.Cells[0].ColSpan=this.row.Cells.length,this.row.LevelNo=1,this.Balance=0,this.ViewModel.addRow(this.row)),this.k=0;this.k<this.dv.length;this.k++){this.TBTransactionsDrCrSeperately||this.dvColumns.Contains("Debit")&&this.dvColumns.Contains("Credit")&&(i.e.IsNum(this.dv[this.k].Debit)&&(this.dbl=i.e.Double(this.dv[this.k].Debit),this.dbl<0&&(this.dv[this.k].Debit=null,this.dv[this.k].Credit=-this.dbl)),i.e.IsNum(this.dv[this.k].Credit)&&(this.dbl=i.e.Double(this.dv[this.k].Credit),this.dbl<0&&(this.dv[this.k].Debit=-this.dbl,this.dv[this.k].Credit=null))),this.rows.Clear(),this.GrdRow++,this.rows.push(new a.d(this.oColumns.length,this.ViewModel.RowHeight)),this.rows[this.rows.length-1].Type=a.f.Detail,this.rows[0].DataRow=this.dv[this.k],this.rows[0].NodeID=86==this.ViewModel.StaticReportType?parseInt(this.dv[this.k].AccountID):parseInt(this.dv[this.k].ParticularID);for(var t=0;t<this.oColumns.length;t++){if(this.oColumns[t].Row>0){if(this.rows.length-1<this.oColumns[t].Row)for(var o=0;o<=this.oColumns[t].Row;o++)this.rows.length-1<o&&(this.GrdRow++,this.rows.push(new a.d(this.oColumns.length,this.ViewModel.RowHeight)),this.rows[this.rows.length-1].Type=a.f.Detail);this.Row=this.oColumns[t].Row,this.Col=this.oColumns[t].Column}else this.Row=0,this.Col=t;var s="";""!=this.oColumns[t].Formula?s=this.ViewModel.CalculateFormula_1(this.oColumns[t].Formula,this.dv[this.k],this.rows):this.dvColumns.Contains(this.oColumns[t].ID)&&(s=i.e.String(this.dv[this.k][this.oColumns[t].ID])),""!=s&&(this.ViewModel.SetCellValue(s,this.oColumns[t].DataFormat,this.oColumns[t].ColumnType,this.rows[this.Row].Cells[this.Col]),this.ViewModel.TotalCols.Contains(this.oColumns[t].ID)&&i.e.IsNum(s)&&(this.dbl=i.e.Double(s),this.AggTotal[t][1]+=this.dbl,this.AggTotal[t][2]+=this.dbl,this.AggTotal[t][3]+=this.dbl))}-1!=this.ViewModel.colSNoIndex&&(this.rows[0].Cells[this.ViewModel.colSNoIndex].Value=++this.ViewModel.SNo,this.rows[0].Cells[this.ViewModel.colSNoIndex].Text=this.ViewModel.SNo.toString()),this.ViewModel.ApplyKPI(this.rows[0]);for(var l=0;l<this.rows.length;l++){var n=this.rows[l];this.ViewModel.HideEmptyRows&&!n.Cells.find((function(e){return!i.e.IsEmptySpace(e.Text)}))||(n.LevelNo=this.ViewModel.lstGroup.length,this.ViewModel.addRow(n))}}for(var r=0;r<this.oColumns.length;r++)"INT"!=this.oColumns[r].ColumnType&&"FLOAT"!=this.oColumns[r].ColumnType||(this.AggTotal[r][0]+=this.AggTotal[r][1],this.AggTotal[r][4]+=this.AggTotal[r][1]);return this.STAccountWise&&this.AddSubTotal(this.strAccountName,1),0}},{key:"AddRows",value:function(){var e,t=this,o=Date.Today();if(86==this.ViewModel.StaticReportType&&-100==this.TagID)this.dv.SortBy(["DocumentName"]);else if(!this.GLSortTransactions&&0==this.GLClubTranBy){var n;"6"==this.strAccountType?this.dvColumns.Contains("IsDr")?(n=["DocDate",{name:"IsDr",parser:l.j},"VoucherNo"],this.dvColumns.Contains("DocSeqNo")&&n.push("DocSeqNo")):n=["DocDate","DiffDrCr"]:"1"!=this.strAccountType&&"2"!=this.strAccountType&&"3"!=this.strAccountType&&"7"!=this.strAccountType&&"10"!=this.strAccountType&&"13"!=this.strAccountType||(this.dvColumns.Contains("IsDr")?(n=["DocDate",{name:"IsDr",parser:l.j,desc:!0},"VoucherNo"],this.dvColumns.Contains("DocSeqNo")&&n.push("DocSeqNo")):n=["DocDate",{name:"DiffDrCr",desc:!0}]),n&&this.dv.SortBy(n)}var r="";for(this.k=0;this.k<this.dv.length;this.k++){if(this.dv[this.k].DocDate?(e=new Date(this.dv[this.k].DocDate),1==this.GLClubTranBy?this.dv[this.k].Particular=e.ToString("dd-MMM-yyyy"):2==this.GLClubTranBy&&(this.dv[this.k].Particular=e.ToString("MMM-yyyy"))):e=new Date(1900,0,1),this.k>0&&(this.STDayWise&&e!=o&&this.AddSubTotal(o.ToString(s.a.SessionManager.Preferences["Date Format"]),3),this.STMonthWise&&(e.getMonth()==o.getMonth()&&e.getFullYear()==o.getFullYear()||this.AddSubTotal(o.ToString("MMM yy"),2))),o=e,this.dbl=i.e.Double(this.dv[this.k].DiffDrCr),this.ShowTagWise)try{this.dv[this.k]["TAG"+i.e.String(this.dv[this.k].TagID)]=this.dbl}catch(_){}else if(-1==this.CurrencyType)try{this.dbl>0?(this.dv[this.k]["CURRDR"+this.dv[this.k].CurrencyID.ToString()]=this.dbl,this.dv[this.k]["CURRCR"+this.dv[this.k].CurrencyID.ToString()]=null):(this.dv[this.k]["CURRDR"+this.dv[this.k].CurrencyID.ToString()]=null,this.dv[this.k]["CURRCR"+this.dv[this.k].CurrencyID.ToString()]=-this.dbl),this.TagCols.forEach((function(e){var o=t.oColumns.indexOf(e);e.ID=="CURRBL"+t.dv[t.k].CurrencyID.ToString()?(t.dv[t.k][e.ID]=t.AggTotal[o][1]+t.dbl,t.AggTotal[o][1]=t.AggTotal[o][1]+t.dbl,t.AggTotal[o][2]=t.AggTotal[o][2]+t.dbl,t.AggTotal[o][3]=t.AggTotal[o][3]+t.dbl):e.ID.startsWith("CURRBL")&&(t.dv[t.k][e.ID]=t.AggTotal[o][1])}))}catch(m){}this.TBTransactionsDrCrSeperately||(this.dbl>0?(this.dv[this.k].Debit=this.dbl,this.dv[this.k].Credit=null):(this.dv[this.k].Debit=null,this.dv[this.k].Credit=-this.dbl)),this.Balance=this.Balance+this.dbl,this.colBalanceIndex>=0&&(this.dv[this.k].Balance=this.Balance,this.AggTotal[this.colBalanceIndex][1]=this.Balance,this.AggTotal[this.colBalanceIndex][2]=this.Balance,this.AggTotal[this.colBalanceIndex][3]=this.Balance),this.rows.Clear(),this.GrdRow++,this.rows.push(new a.d(this.oColumns.length,this.ViewModel.RowHeight)),this.rows[this.rows.length-1].Type=a.f.Detail,this.rows[0].DataRow=this.dv[this.k],86==this.ViewModel.StaticReportType||156==this.ViewModel.StaticReportType?this.rows[0].NodeID=parseInt(this.dv[this.k].AccountID):null!=this.dv[this.k].ParticularID&&(this.rows[0].NodeID=parseInt(this.dv[this.k].ParticularID));for(var h=0;h<this.oColumns.length;h++){if(this.oColumns[h].Row>0){if(this.rows.length-1<this.oColumns[h].Row)for(var u=0;u<=this.oColumns[h].Row;u++)this.rows.length-1<u&&(this.GrdRow++,this.rows.push(new a.d(this.oColumns.length,this.ViewModel.SubRowHeight)),this.rows[this.rows.length-1].Type=a.f.Detail);this.Row=this.oColumns[h].Row,this.Col=this.oColumns[h].Column}else this.Row=0,this.Col=h;r="",""!=this.oColumns[h].Formula?""!=(r=this.ViewModel.CalculateFormula_1(this.oColumns[h].Formula,this.dv[this.k],this.rows))&&this.dvColumns.Contains(this.oColumns[h].ID)&&(this.dv[this.k][this.oColumns[h].ID]=r):this.dvColumns.Contains(this.oColumns[h].ID)&&(r=i.e.String(this.dv[this.k][this.oColumns[h].ID])),""!=r&&("Balance"!=this.oColumns[h].ID&&!this.oColumns[h].ID.startsWith("CURRBL")&&this.ViewModel.TotalCols.Contains(this.oColumns[h].ID)&&i.e.IsNum(r)&&(this.dbl=i.e.Double(r),this.AggTotal[h][1]+=this.dbl,this.AggTotal[h][2]+=this.dbl,this.AggTotal[h][3]+=this.dbl),-1!=this.oColumns[h].DataFormat.CumTotal&&(r=this.AggTotal[h][1].toString()),this.ViewModel.SetCellValue(r,this.oColumns[h].DataFormat,this.oColumns[h].ColumnType,this.rows[this.Row].Cells[this.Col]))}if(-1!=this.ViewModel.colSNoIndex&&(this.rows[0].Cells[this.ViewModel.colSNoIndex].Value=++this.ViewModel.SNo,this.rows[0].Cells[this.ViewModel.colSNoIndex].Text=this.ViewModel.SNo.toString()),this.ViewModel.ApplyKPI(this.rows[0]),1==this.ViewModel.StaticReportType&&this.dicInvRows.length>0&&this.dicInvRows.ContainsKey(this.dv[this.k].VoucherNo.toString()))for(var c=this.dicInvRows[this.dv[this.k].VoucherNo.toString()],D=0;D<c.length;D++){D>=this.rows.length&&(this.GrdRow++,this.rows.push(new a.d(this.oColumns.length,this.ViewModel.SubRowHeight)),this.rows[this.rows.length-1].Type=a.f.Detail);for(var d=0;d<this.oColumns.length;d++){var C="";"VoucherNo"!=this.oColumns[d].ID&&(C=i.e.String(c[D][this.oColumns[d].ID])),""!=C&&this.ViewModel.SetCellValue(C,this.oColumns[d].DataFormat,this.oColumns[d].ColumnType,this.rows[D].Cells[d])}}for(var p=0;p<this.rows.length;p++){var T=this.rows[p];!this.ViewModel.HideEmptyRows||T.Cells.find((function(e){return!i.e.IsEmptySpace(e.Text)}))?(T.LevelNo=this.ViewModel.lstGroup.length,this.ViewModel.addRow(T)):this.GrdRow--}}this.dv.length>0&&(this.STMonthWise||this.STDayWise)&&(this.STDayWise&&this.AddSubTotal(o.ToString(s.a.SessionManager.Preferences["Date Format"]),3),this.STMonthWise&&this.AddSubTotal(o.ToString("MMM yy"),2))}},{key:"GetBalance",value:function(){var e=this.OpBalance;if(this.dv.length>0){var t=this.dv.Compute("sum","Debit");null!=t&&(e+=parseFloat(t)),null!=(t=this.dv.Compute("sum","Credit"))&&(e-=parseFloat(t))}if(this.dvTbl2&&this.dvTbl2.length>0){var o=this.dvTbl2.Compute("sum","Debit");null!=o&&(e+=parseFloat(o)),null!=(o=this.dvTbl2.Compute("sum","Credit"))&&(e-=parseFloat(o))}return parseFloat(Math.abs(e).ToString("N2"))<.01&&(e=0),e}},{key:"GetBalance_GLSummary",value:function(){for(var e=0,t=1;t<this.ds.Tables.length;t++){var o=this.ds.Tables[t].Compute("sum","Balance",this.strAccountFilter);null!=o&&(e+=parseFloat(o))}return parseFloat(Math.abs(e).ToString("N2"))<.01&&(e=0),e}},{key:"AddSubTotal",value:function(e,t){if(this.colSubTotalStartIndex>=0&&this.ViewModel.lstGroup[0].SubTotalAppearance.IsVisible){this.GrdRow++,this.row=this.NewReportRow_2(a.f.SubTotal,this.ViewModel.lstGroup[0].SubTotalAppearance),this.row.LevelNo=1;for(var o=0;o<this.oColumns.length;o++)this.ViewModel.lstGroup[0].TotalCols.ContainsKey(this.oColumns[o].ID)&&(this.ViewModel.SetCellValue(this.AggTotal[o][t],this.oColumns[o].DataFormat,"FLOAT",this.row.Cells[o]),this.row.Cells[o].CellAppearance.Alignment="Right",this.AggTotal[o][t]=0);var i=this.row.Cells[0];1==t&&this.ViewModel.lstGroup.length>0?1==this.ViewModel.lstGroup[0].SubTotalShowCaption?i.Text=s.a.GetResource("Reports_SubTotal")+" ("+e+")":2==this.ViewModel.lstGroup[0].SubTotalShowCaption?i.Text=s.a.GetResource("Reports_SubTotal"):10==this.ViewModel.lstGroup[0].SubTotalShowCaption&&(i.Text=e):i.Text=s.a.GetResource("Reports_SubTotal")+" ("+e+")",this.colSubTotalStartIndex>=0&&(i.ColSpan=this.colSubTotalStartIndex),this.ViewModel.addRow(this.row)}}},{key:"SetRetainedEarnings",value:function(){var e=this;if(this.strRetainedAccounts="",this.OpenCompany){for(var t=0;t<this.ViewModel.oReportDialog.CostCenterFilters.length;t++){var o=this.ViewModel.oReportDialog.CostCenterFilters[t];if(o.CostCenterID>5e4&&50002!=o.CostCenterID&&o.SelectedNodes.length>0&&0==o.SelectedNodes.filter((function(e){return 0==e.Id||1==e.Id})).length)return}var i=this.ViewModel.oReportDialog.FromDate.Date;this.DontShowREforPeriodInAssignedAccount&&((i=new Date(this.ViewModel.oReportDialog.FromDate.Date.getFullYear(),this.AccountingFromMonth-1,1))>this.ViewModel.oReportDialog.FromDate.Date&&(i=i.AddYears(-1))),this.promiseRE=s.a.report.GetOpenCompanyData(this.ViewModel.StaticReportType,i,this.ViewModel.oReportDialog.ToDate.Date,0,this.LocationWhere,!1,this.UnPostedDocsList,this.PDCInclude,this.IncludeTerminatedPDC,"",this.CurrencyType,this.ForeignCurrencyID,this.exchRate,this.ViewModel.IsReportDB).then((function(t){if(e.dsOpenCompany=t,e.dsOpenCompany.Columns[e.dsOpenCompany.Tables.length-1].Contains("PreviousYearEndDate")&&e.dsOpenCompany.Tables[e.dsOpenCompany.Tables.length-1].length>0&&e.dsOpenCompany.Tables[e.dsOpenCompany.Tables.length-1][0].PreviousYearEndDate&&(e.dtOpenCompanyYearStart=new Date(e.dsOpenCompany.Tables[e.dsOpenCompany.Tables.length-1][0].PreviousYearEndDate),e.dtOpenCompanyYearStart=e.dtOpenCompanyYearStart.AddDays(1),e.ViewModel.oReportDialog.FromDate.Date.Subtract(e.dtOpenCompanyYearStart).Days<1&&(e.dtOpenCompanyYearStart=null)),e.dsOpenCompany.Tables[0].forEach((function(t){e.strAccountID=t.AccountID.toString(),e.dbl=parseFloat(t.Dr)-parseFloat(t.Cr),e.GLRetainedAccounts.ContainsKey(e.strAccountID)?e.GLRetainedAccounts[e.strAccountID]+=e.dbl:e.GLRetainedAccounts.push(e.strAccountID,e.dbl)})),!e.ViewModel.oReportDialog.IsZeroSelected&&!e.ViewModel.oReportDialog.IsOneSelected&&null!=e.ViewModel.oReportDialog.DefaultTreeSelectedNodes)for(var o=function(t){0==e.ViewModel.oReportDialog.DefaultTreeSelectedNodes.filter((function(o){return o.Id==parseInt(e.GLRetainedAccounts.keys[t])})).length&&e.GLRetainedAccounts.Remove(e.GLRetainedAccounts.keys[t])},s=e.GLRetainedAccounts.keys.length-1;s>=0;s--)o(s);for(var i=e.GLRetainedAccounts.keys.length-1;i>=0;i--)e.strRetainedAccounts.length>0&&(e.strRetainedAccounts+=","),e.strRetainedAccounts+=e.GLRetainedAccounts.keys[i]}))}else Object(l.j)(s.a.SessionManager.Preferences.OpenCompany)&&(this.dtOpenCompanyYearStart=new Date(this.ViewModel.oReportDialog.FromDate.Date.getFullYear(),this.AccountingFromMonth-1,1),this.dtOpenCompanyYearStart>this.ViewModel.oReportDialog.FromDate.Date&&(this.dtOpenCompanyYearStart=this.dtOpenCompanyYearStart.AddYears(-1)))}},{key:"AddPDCRows",value:function(e){var t=this;this.dvTbl2=this.ds.Tables[2].filter(370==e?function(e){return(Object(h.isUndefined)(t.strAccountFilterObj.AccountID)||e.AccountID==t.strAccountFilterObj.AccountID)&&452!=e.StatusID}:function(o){return(Object(h.isUndefined)(t.strAccountFilterObj.AccountID)||o.AccountID==t.strAccountFilterObj.AccountID)&&o.StatusID==e}),this.dvTbl2.length>0&&(this.GrdRow++,this.row=this.NewReportRow_2(a.f.GrossTotal,this.GrossTotalAppearance),this.row.LevelNo=this.ViewModel.lstGroup.length,this.row.Cells[0].ColSpan=this.ViewModel.ReportColumns.length,this.row.Cells[0].Text=s.a.GetResource(452==e?"Reports_TerminatedPDCList":"Reports_PDCList"),this.ViewModel.addRow(this.row),this.dv=this.dvTbl2,this.dvColumns=this.dvTbl2Columns,this.PDCDrCrSeperate?(this.ShowPDCPaymentsFirst?["Payments","Receipts"]:["Receipts","Payments"]).forEach((function(e){t.dv=t.dvTbl2.filter("Receipts"==e?function(e){return 19==e.VType}:function(e){return 14==e.VType}),t.dv.length>0&&(t.GrdRow++,t.row=t.NewReportRow_2(a.f.GrossTotal,t.GrossTotalAppearance),t.row.LevelNo=t.ViewModel.lstGroup.length,t.row.Cells[0].ColSpan=t.oColumns.length,t.row.Cells[0].Text=s.a.GetResource("Reports_"+e),t.ViewModel.addRow(t.row),t.AddRowsWithSubTotal(s.a.GetResource("Reports_PDC"+e)))})):this.AddRowsWithSubTotal(this.row.Cells[0].Text))}},{key:"AddRowsWithSubTotal",value:function(e){if(this.HideSectionSubTotal)this.AddRows();else{for(var t=new Array(this.AggTotal.length).fill(0),o=0;o<t.length;o++)t[o]=this.AggTotal[o][1];this.AddRows();for(var i=0;i<t.length;i++)t[i]=this.AggTotal[i][1]-t[i];if(this.colSubTotalStartIndex>=0){this.GrdRow++,this.row=this.NewReportRow_2(a.f.SubTotal,this.ViewModel.lstGroup[0].SubTotalAppearance),this.row.LevelNo=1;for(var l=0;l<this.oColumns.length;l++)this.ViewModel.lstGroup[0].TotalCols.ContainsKey(this.oColumns[l].ID)&&(this.ViewModel.SetCellValue("Balance"==this.oColumns[l].ID?this.Balance:t[l],this.oColumns[l].DataFormat,"FLOAT",this.row.Cells[l]),this.row.Cells[l].CellAppearance.Alignment="Right");this.row.Cells[0].Text=e.length>0?s.a.GetResource("Reports_SubTotal")+" ("+e+")":s.a.GetResource("Reports_SubTotal"),this.colSubTotalStartIndex>=0&&(this.row.Cells[0].ColSpan=this.colSubTotalStartIndex),this.ViewModel.addRow(this.row)}}}},{key:"SetParticularsData",value:function(e){var t=this;e.Tables.length>1&&e.Columns[1].Contains("Debit")&&e.Columns[1].Contains("DiffDrCr")&&(e.Columns[1].push("IsDr"),e.Tables[1].forEach((function(e){t.dbl=i.e.Double(e.DiffDrCr),e.IsDr=t.dbl>0}))),e.Tables.length>2&&e.Columns[2].Contains("Debit")&&e.Columns[2].Contains("DiffDrCr")&&(e.Columns[2].push("IsDr"),e.Tables[2].forEach((function(e){t.dbl=i.e.Double(e.DiffDrCr),e.IsDr=t.dbl>0})));try{if(!this.ViewModel.DocumentFilters.ContainsKey("GLParticularSelect")||0==this.ViewModel.DocumentFilters.GLParticularSelect.length)return;var o="";if(e.Tables[1].forEach((function(e){t.lstParticularID.Contains(parseInt(e.ParticularID))||(o.length>0&&(o+=","),o+=e.ParticularID.toString(),t.lstParticularID.push(parseInt(e.ParticularID)))})),e.Tables.length>2&&e.Tables[2].forEach((function(e){t.lstParticularID.Contains(parseInt(e.ParticularID))||(o.length>0&&(o+=","),o+=e.ParticularID.toString(),t.lstParticularID.push(parseInt(e.ParticularID)))})),o.length>0){var l=s.a.report.ReportDataSet("RTP022",this.ViewModel.IsReportDB,"select "+this.ViewModel.DocumentFilters.GLParticularSelect+" from "+this.ViewModel.DocumentFilters.GLParticularFrom+" where A.accountid in ("+o+")");null==this.dtParticulars?(this.dtParticulars=l.Tables[0],this.dtParticularsColumns=l.Columns[0]):this.dtParticulars.AddRange(l.Tables[0])}if(null!=this.dtParticulars){for(var n=1;n<this.dtParticularsColumns.length;n++)e.Columns[1].Contains(this.dtParticularsColumns[n])||e.Columns[1].push(this.dtParticularsColumns[n]),e.Tables.length>2&&(e.Columns[2].Contains(this.dtParticularsColumns[n])||e.Columns[2].push(this.dtParticularsColumns[n]));var a;e.Tables[1].forEach((function(e){if((a=t.dtParticulars.filter((function(t){return t.AccountID==e.ParticularID}))).length>0)for(var o=1;o<t.dtParticularsColumns.length;o++)e[t.dtParticularsColumns[o]]=a[0][t.dtParticularsColumns[o]]})),e.Tables.length>2&&e.Tables[2].forEach((function(e){if((a=t.dtParticulars.filter((function(t){return t.AccountID==e.ParticularID}))).length>0)for(var o=1;o<t.dtParticularsColumns.length;o++)e[t.dtParticularsColumns[o]]=a[0][t.dtParticularsColumns[o]]}))}}catch(r){Logger.ErrorLog("SetParticularsData: ",r)}}},{key:"addCashBookAndBankBook",value:function(){try{for(var e=0;e<this.oColumns.length;e++)this.AggTotal[e][1]=0;"Monthly"==this.ViewModel.Preferences.Balancing&&this.UpdateCashBookDateByMonthly();var t,o=-1;if(this.ViewModel.lstGroup.length>0&&(this.GrdRow++,this.ViewModel.lstGroupIndex.push(this.ViewModel.Data.length),this.row=this.NewReportRow_2(a.f.Group,this.ViewModel.lstGroup[0].GroupAppearance),this.ViewModel.lstGroup[0].Height>0&&(this.row.Height=this.ViewModel.lstGroup[0].Height),this.row.LevelNo=0,this.row.Cells[0].Text=this.strAccountName,this.row.NodeID=parseInt(this.strAccountID),this.row.Cells[0].ColSpan=5,this.ViewModel.addRow(this.row),o=this.ViewModel.Data.length-1,this.Balance=0),this.Balance=0,0!=this.OpBalance&&(this.GrdRow++,this.Balance=this.OpBalance,this.row=this.NewReportRow_2(a.f.BalanceBF,this.BalanceBFAppearance),this.row.LevelNo=1,this.row.Cells[0].ColSpan=this.colSpanBF,this.row.Cells[0].Text=s.a.GetResource("Reports_OpeningBalance"),-1!=this.colBalanceIndex?(this.AggTotal[this.colBalanceIndex][1]=this.OpBalance,this.row.Cells[this.colBalanceIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(this.Balance,this.oColumns[this.colBalanceIndex].DataFormat,"FLOAT",this.row.Cells[this.colBalanceIndex])):this.AggTotal[this.AggTotal.length-1][1]=this.OpBalance,this.colDebitIndex>-1&&this.OpBalance>0&&(this.row.Cells[this.colDebitIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(this.OpBalance,this.oColumns[this.colDebitIndex].DataFormat,"FLOAT",this.row.Cells[this.colDebitIndex]),this.IncludeBFInTotals&&(this.AggTotal[this.colDebitIndex][1]=this.OpBalance)),this.colCreditIndex>-1&&this.OpBalance<0&&(this.row.Cells[this.colCreditIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(-this.OpBalance,this.oColumns[this.colCreditIndex].DataFormat,"FLOAT",this.row.Cells[this.colCreditIndex]),this.IncludeBFInTotals&&(this.AggTotal[this.colCreditIndex][1]=-this.OpBalance)),this.ViewModel.addRow(this.row)),this.k=0,!this.GLSortTransactions&&0==this.GLClubTranBy)"6"==this.strAccountType?this.dvColumns.Contains("IsDr")?(t=["DocDate",{name:"IsDr",parser:l.j},"VoucherNo"],this.dvColumns.Contains("DocSeqNo")&&t.push("DocSeqNo")):t=["DocDate","DiffDrCr"]:"1"!=this.strAccountType&&"2"!=this.strAccountType&&"3"!=this.strAccountType&&"7"!=this.strAccountType&&"10"!=this.strAccountType&&"13"!=this.strAccountType||(this.dvColumns.Contains("IsDr")?(t=["DocDate",{name:"IsDr",parser:l.j,desc:!0},"VoucherNo"],this.dvColumns.Contains("DocSeqNo")&&t.push("DocSeqNo")):t=["DocDate",{name:"DiffDrCr",desc:!0}]),t&&this.dv.SortBy(t);do{this.addCashBankRecords()}while(this.k<this.dv.length);if(this.ShowGroupHighLowValues&&this.dv.length>0&&o>=0){this.row=this.ViewModel.Data[o];var i=this.row.Cells[0].Text+"   [Low: ";this.ViewModel.SetCellValue(this.dblCBMin,this.oCBFormat,"FLOAT",this.oCBCell),i+=this.oCBCell.Text,i+=" ("+this.dtCBMin.ToString(s.a.SessionManager.Preferences["Date Format"])+")",i+=",   High: ",this.ViewModel.SetCellValue(this.dblCBMax,this.oCBFormat,"FLOAT",this.oCBCell),i+=this.oCBCell.Text,i+=" ("+this.dtCBMax.ToString(s.a.SessionManager.Preferences["Date Format"])+")",i+="]",this.row.Cells[0].Text=i,this.ViewModel.Data.RemoveAt(o),this.ViewModel.insertRowAt(this.row,o)}for(var n=0;n<this.oColumns.length;n++)"FLOAT"==this.oColumns[n].ColumnType&&(this.AggTotal[n][0]+=this.AggTotal[n][1]);return 0}catch(r){return Logger.ErrorLog("ACC_GeneralLedger::Error addCashBookAndBankBook",r),0}}},{key:"addCashBankRecords",value:function(){for(;this.k<this.dv.length;this.k++){if(0==this.k)this.dtDocDate=new Date(this.dv[this.k].DocDate);else if("Daily"==this.ViewModel.Preferences.Balancing){if(+this.dtDocDate!=+new Date(this.dv[this.k].DocDate)){this.dtDocDate=new Date(this.dv[this.k].DocDate);break}}else if("MonthlyDetail"==this.ViewModel.Preferences.Balancing&&+this.dtDocDate.getMonth()!=+new Date(this.dv[this.k].DocDate).getMonth()){this.dtDocDate=new Date(this.dv[this.k].DocDate);break}if(this.GLClubTranBy>0&&(1==this.GLClubTranBy?this.dv[this.k].Particular=this.dtDocDate.ToString("dd-MMM-yyyy"):2==this.GLClubTranBy&&(this.dv[this.k].Particular=this.dtDocDate.ToString("MMM-yyyy"))),this.GrdRow++,"Monthly"==this.ViewModel.Preferences.Balancing){var e;this.dbl=i.e.Double(this.dv[this.k].Debit),e=i.e.Double(this.dv[this.k].Credit),this.dbl=this.dbl-e}else this.dbl=i.e.Double(this.dv[this.k].DiffDrCr);this.dbl>0?(this.dv[this.k].Debit=this.dbl,this.dv[this.k].Credit=null):(this.dv[this.k].Debit=null,this.dv[this.k].Credit=-this.dbl),this.Balance=this.Balance+this.dbl,this.dv[this.k].Balance=this.Balance,this.ShowGroupHighLowValues&&(0==this.k?(this.dblCBMin=this.dblCBMax=this.Balance,this.dtCBMin=this.dtCBMax=this.dtDocDate):(this.dblCBMin>this.Balance&&(this.dblCBMin=this.Balance,this.dtCBMin=new Date(this.dv[this.k].DocDate)),this.dblCBMax<this.Balance&&(this.dblCBMax=this.Balance,this.dtCBMax=new Date(this.dv[this.k].DocDate)))),this.rows.Clear(),this.GrdRow++,this.rows.push(new a.d(this.oColumns.length,this.ViewModel.RowHeight)),this.rows[this.rows.length-1].Type=a.f.Detail,this.rows[this.rows.length-1].DataRow=this.dv[this.k],null!=this.dv[this.k].ParticularID&&(this.rows[this.rows.length-1].NodeID=parseInt(this.dv[this.k].ParticularID));for(var t=0;t<this.oColumns.length;t++){if(this.oColumns[t].Row>0&&this.rows.length-1<this.oColumns[t].Row){for(var o=0;o<=this.oColumns[t].Row;o++)this.rows.length-1<o&&(this.GrdRow++,this.rows.push(new a.d(this.oColumns.length,this.ViewModel.SubRowHeight)),this.rows[this.rows.length-1].Type=a.f.Detail,this.rows[this.rows.length-1].DataRow=this.dv[this.k]);this.Row=this.oColumns[t].Row,this.Col=this.oColumns[t].Column}else this.Row=0,this.Col=t;var l="";""!=this.oColumns[t].Formula?l=this.ViewModel.CalculateFormula_1(this.oColumns[t].Formula,this.dv[this.k],this.rows):this.dvColumns.Contains(this.oColumns[t].ID)&&(l=i.e.String(this.dv[this.k][this.oColumns[t].ID])),""!=l&&(this.ViewModel.SetCellValue(l,this.oColumns[t].DataFormat,this.oColumns[t].ColumnType,this.rows[this.Row].Cells[this.Col]),"Balance"!=this.oColumns[t].ID&&this.ViewModel.TotalCols.Contains(this.oColumns[t].ID)&&(this.dbl=i.e.Double(l),this.AggTotal[t][1]+=this.dbl))}-1!=this.ViewModel.colSNoIndex&&(this.rows[0].Cells[this.ViewModel.colSNoIndex].Value=++this.ViewModel.SNo,this.rows[0].Cells[this.ViewModel.colSNoIndex].Text=this.ViewModel.SNo.toString()),this.ViewModel.ApplyKPI(this.rows[0]);for(var n=0;n<this.rows.length;n++){var r=this.rows[n];this.ViewModel.HideEmptyRows&&!r.Cells.find((function(e){return!i.e.IsEmptySpace(e.Text)}))||(r.LevelNo=1,this.ViewModel.addRow(r))}this.AggTotal[this.colBalanceIndex][1]=this.Balance}if(this.colSubTotalStartIndex>=0){for(this.GrdRow++,this.row=this.NewReportRow_2(a.f.SubTotal,this.ViewModel.lstGroup[0].SubTotalAppearance),this.row.LevelNo=1,this.i=0;this.i<this.oColumns.length;this.i++)this.ViewModel.lstGroup[0].TotalCols.ContainsKey(this.oColumns[this.i].ID)&&(this.ViewModel.SetCellValue(this.AggTotal[this.i][1],this.oColumns[this.i].DataFormat,"FLOAT",this.row.Cells[this.i]),this.row.Cells[this.i].CellAppearance.Alignment="Right",this.IncludeBFInTotals||(this.AggTotal[this.i][1]=0));this.row.Cells[0].Text=s.a.GetResource("Reports_SubTotal"),this.row.Cells[0].ColSpan=4,this.colSubTotalStartIndex>=0&&(this.row.Cells[0].ColSpan=this.colSubTotalStartIndex),this.ViewModel.addRow(this.row)}2!=this.ViewModel.StaticReportType&&3!=this.ViewModel.StaticReportType||0==this.Balance||(this.GrdRow++,this.row=this.NewReportRow_2(a.f.BalanceBF,this.BalanceBFAppearance),this.row.LevelNo=1,this.row.Cells[0].ColSpan=this.colSpanBF,this.row.Cells[0].Text=s.a.GetResource("Reports_BalanceCF"),this.Balance<0&&(this.row.Cells[0].Text+="*******"),this.colDebitIndex>-1&&this.Balance<0&&(this.row.Cells[this.colDebitIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(-this.Balance,this.oColumns[this.colDebitIndex].DataFormat,"FLOAT",this.row.Cells[this.colDebitIndex])),this.colCreditIndex>-1&&this.Balance>0&&(this.row.Cells[this.colCreditIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(this.Balance,this.oColumns[this.colCreditIndex].DataFormat,"FLOAT",this.row.Cells[this.colCreditIndex])),this.ViewModel.addRow(this.row)),2!=this.ViewModel.StaticReportType&&3!=this.ViewModel.StaticReportType||0==this.Balance||(this.GrdRow++,this.row=this.NewReportRow_2(a.f.BalanceBF,this.BalanceBFAppearance),this.row.LevelNo=1,this.row.Cells[0].ColSpan=this.colSpanBF,this.row.Cells[0].Text=s.a.GetResource("Reports_BalanceBF"),this.colDebitIndex>-1&&this.Balance>0&&(this.row.Cells[this.colDebitIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(this.Balance,this.oColumns[this.colDebitIndex].DataFormat,"FLOAT",this.row.Cells[this.colDebitIndex])),this.colCreditIndex>-1&&this.Balance<0&&(this.row.Cells[this.colCreditIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(-this.Balance,this.oColumns[this.colCreditIndex].DataFormat,"FLOAT",this.row.Cells[this.colCreditIndex])),this.ViewModel.addRow(this.row))}},{key:"UpdateCashBookDateByMonthly",value:function(){var e,t=null;this.dv.length>0&&(this.dtDocDate=new Date(this.dv[this.dv.length-1].DocDate),this.dv[this.dv.length-1].Particular=this.dtDocDate.ToString("MMM-yyyy"),t=new Array(this.oColumns.length).fill(0));for(var o=this.dv.length-2;o>=0;o--)if(e=new Date(this.dv[o].DocDate),this.dtDocDate.getMonth()==e.getMonth()&&e.getFullYear()==this.dtDocDate.getFullYear()){for(var s=0;s<this.oColumns.length;s++)if("FLOAT"==this.oColumns[s].ColumnType)try{this.CellValue=i.e.String(this.dv[o][this.oColumns[s].ID]),""!=this.CellValue&&(t[s]=t[s]+parseFloat(this.CellValue),this.dv[o+1][this.oColumns[s].ID]=t[s])}catch(n){}this.ds.Tables[1].Remove(this.dv[o])}else{this.dtDocDate=e,this.dv[o].Particular=this.dtDocDate.ToString("MMM-yyyy");for(var l=0;l<this.oColumns.length;l++)t[l]=0,"FLOAT"==this.oColumns[l].ColumnType&&(this.CellValue=i.e.String(this.dv[o][this.oColumns[l].ID]),""!=this.CellValue&&(t[l]=parseFloat(this.CellValue)))}}},{key:"addTrialBalance",value:function(){var e,t,o,s,n,r,h,u,c,d,C=this,p=0,T=null,_=!1,m=0;for(this.dblMissingOpeningDr=0,this.dblMissingOpeningCr=0,this.lstParents.Clear(),this.lstTotal.Clear(),this.lstParents.push(this.NewReportRow()),this.lstTotal.push(new Array(this.oColumns.length).fill(0)),this.arrTBTotals=new Array(6).fill(0),this.ViewModel.totals=i.e.NumArray(this.oColumns.length,this.ViewModel.lstGroup.length+1),this.k=0;this.k<this.dv.length;this.k++){if(this.strAccountType=this.dv[this.k].AccountTypeID.toString(),!Object(l.j)(this.dv[this.k].IsGroup))if(this.Show==D.TagWise){if(r=0,p=parseInt(this.dv[this.k].AccountID),e=i.e.String(this.dv[this.k].Tag),this.TBGroupID.length>0&&(T=i.e.String(this.dv[this.k][this.TBGroupID])),_=!0,this.TBIsAccountWise&&"-999"==e&&(_=!1,e="",this.dv[this.k].Tag=null),_){for(h=u=c=d=0,e.length>0&&(h=i.e.Double(this.dv[this.k].OP_Dr),u=i.e.Double(this.dv[this.k].OP_Cr),r=h+(c=i.e.Double(this.dv[this.k].TR_Dr))-(u+(d=i.e.Double(this.dv[this.k].TR_Cr))),this.dvColumns.Contains(e)&&(this.dv[this.k][e]=r,this.OpenCompany&&("4"!=this.strAccountType&&"5"!=this.strAccountType&&"8"!=this.strAccountType&&"9"!=this.strAccountType&&"11"!=this.strAccountType&&"12"!=this.strAccountType||(this.dv[this.k][e]=c-d))));this.k+1<this.dv.length&&p==parseInt(this.dv[this.k+1].AccountID)&&(0==this.TBGroupID.length||T==this.dv[this.k+1][this.TBGroupID].toString());)(e=this.dv[this.k+1].Tag.toString()).length>0&&(t=i.e.Double(this.dv[this.k+1].OP_Dr),o=i.e.Double(this.dv[this.k+1].OP_Cr),s=i.e.Double(this.dv[this.k+1].TR_Dr),n=i.e.Double(this.dv[this.k+1].TR_Cr),r=t+s-(o+n),this.dvColumns.Contains(e)&&(this.dv[this.k][e]=r,this.OpenCompany&&("4"!=this.strAccountType&&"5"!=this.strAccountType&&"8"!=this.strAccountType&&"9"!=this.strAccountType&&"11"!=this.strAccountType&&"12"!=this.strAccountType||(this.dv[this.k][e]=s-n))),h+=t,u+=o,c+=s,d+=n),this.dvTable.Remove(this.dv[this.k+1]);this.dv[this.k].OP_Dr=h,this.dv[this.k].OP_Cr=u,this.dv[this.k].TR_Dr=c,this.dv[this.k].TR_Cr=d}}else if(this.Show==D.MonthWise&&(r=0,p=parseInt(this.dv[this.k].AccountID),e=i.e.String(this.dv[this.k].Tag),this.TBGroupID.length>0&&(T=i.e.String(this.dv[this.k][this.TBGroupID])),_=!0,this.TBIsAccountWise&&"-999"==e&&(_=!1,e="",this.dv[this.k].Tag=null),_)){h=u=c=d=0;var I=0,R=this.lstTags.length-1;for(e.length>0&&(h=i.e.Double(this.dv[this.k].OP_Dr),u=i.e.Double(this.dv[this.k].OP_Cr),r=h+(c=i.e.Double(this.dv[this.k].TR_Dr))-(u+(d=i.e.Double(this.dv[this.k].TR_Cr))),this.dv[this.k]["OPDr"+e]=h-u,this.dv[this.k]["TRDr"+e]=this.dv[this.k].TR_Dr,this.dv[this.k]["TRCr"+e]=this.dv[this.k].TR_Cr,this.OpenCompany&&("4"!=this.strAccountType&&"5"!=this.strAccountType&&"8"!=this.strAccountType&&"9"!=this.strAccountType&&"11"!=this.strAccountType&&"12"!=this.strAccountType||(r=c-d,this.dv[this.k]["OPDr"+e]=null)),this.dv[this.k]["Net"+e]=r,I=r,R=this.lstTags.indexOf(e));this.k+1<this.dv.length&&p==parseInt(this.dv[this.k+1].AccountID)&&(0==this.TBGroupID.length||T==this.dv[this.k+1][this.TBGroupID].toString());){if(e=this.dv[this.k+1].Tag.toString(),R+1<this.lstTags.indexOf(e))for(var S=R+1;S<this.lstTags.indexOf(e);S++)t=I,o=0,this.dv[this.k]["OPDr"+this.lstTags[S]]=t,!this.OpenCompany||"4"!=this.strAccountType&&"5"!=this.strAccountType&&"8"!=this.strAccountType&&"9"!=this.strAccountType&&"11"!=this.strAccountType&&"12"!=this.strAccountType||(this.dv[this.k]["OPDr"+this.lstTags[S]]=null),this.dv[this.k]["Net"+this.lstTags[S]]=I;e.length>0&&(t=I,o=0,s=i.e.Double(this.dv[this.k+1].TR_Dr),n=i.e.Double(this.dv[this.k+1].TR_Cr),this.dv[this.k]["OPDr"+e]=t,this.dv[this.k]["TRDr"+e]=this.dv[this.k+1].TR_Dr,this.dv[this.k]["TRCr"+e]=this.dv[this.k+1].TR_Cr,r=t+s-(o+n),this.dv[this.k]["Net"+e]=r,I=r,c+=s,d+=n,R=this.lstTags.indexOf(e)),this.dvTable.Remove(this.dv[this.k+1])}this.dv[this.k].TR_Dr=c,this.dv[this.k].TR_Cr=d,this.dv[this.k].NetBalance=I;for(var A=R+1;A<this.lstTags.length;A++)t=I,o=0,this.dv[this.k]["OPDr"+this.lstTags[A]]=t,this.dv[this.k]["Net"+this.lstTags[A]]=I}if(-1!=this.YTDIndex&&(this.dvYTD=this.dvYTDTable.filter((function(e){return e.AccountID==C.dv[C.k].AccountID})),this.dvYTD.length>0&&(r=i.e.Double(this.dvYTD[0].Balance),this.dv[this.k].YTD=r)),-1!=this.BAL_LYIndex&&(this.dvBAL_LY=this.dvBAL_LYTable.filter((function(e){return e.AccountID==C.dv[C.k].AccountID})),this.dvBAL_LY.length>0&&(r=i.e.Double(this.dvBAL_LY[0].Balance),this.dv[this.k].LastYearBalance=r)),-1!=this.YTD_LYIndex&&(this.dvYTD_LY=this.dvYTD_LYTable.filter((function(e){return e.AccountID==C.dv[C.k].AccountID})),this.dvYTD_LY.length>0&&(r=i.e.Double(this.dvYTD_LY[0].Balance),this.dv[this.k].LastYearYTD=r)),!Object(l.j)(this.dv[this.k].IsGroup)){if(t=i.e.Double(this.dv[this.k].OP_Dr),o=i.e.Double(this.dv[this.k].OP_Cr),s=i.e.Double(this.dv[this.k].TR_Dr),n=i.e.Double(this.dv[this.k].TR_Cr),this.OpenCompany&&("4"!=this.strAccountType&&"5"!=this.strAccountType&&"8"!=this.strAccountType&&"9"!=this.strAccountType&&"11"!=this.strAccountType&&"12"!=this.strAccountType||(this.dvColumns.Contains("PeriodOpDr")?(t=i.e.Double(this.dv[this.k].PeriodOpDr),o=i.e.Double(this.dv[this.k].PeriodOpCr)):(t=0,o=0,this.dv[this.k].OP_Dr=null,this.dv[this.k].OP_Cr=null,this.IsFCClosingDebitExists&&(this.dv[this.k].FCOP_Dr=null,this.dv[this.k].FCOP_Cr=null))),null!=this.dvOpenCompanyTable&&(this.dvOpenCompany=this.dvOpenCompanyTable.filter((function(e){return e.AccountID==C.dv[C.k].AccountID})),this.dvOpenCompany.length>0&&(this.Show==D.TagWise?this.dvOpenCompany.forEach((function(e){C.dbl=parseFloat(e.Dr),C.dblDrOpenCompany+=C.dbl,t+=C.dbl,C.dbl=parseFloat(e.Cr),C.dblCrOpenCompany+=C.dbl,o+=C.dbl,C.dvColumns.Contains(e.TagID.toString())&&(C.dbl=i.e.Double(C.dv[C.k][e.TagID.toString()]),C.dv[C.k][e.TagID.toString()]=C.dbl+parseFloat(e.Dr)-parseFloat(e.Cr))})):(this.dbl=parseFloat(this.dvOpenCompany[0].Dr)-parseFloat(this.dvOpenCompany[0].Cr),this.dbl>0?(this.dblDrOpenCompany+=this.dbl,t+=this.dbl):(this.dblCrOpenCompany+=-this.dbl,o+=-this.dbl)),this.dv[this.k].OP_Dr=t,this.dv[this.k].OP_Cr=o))),this.OpDrCrInOpDr?(this.dv[this.k].OP_Cr=null,this.dv[this.k].OP_Dr=t-o):(this.TBOpeningDrCrSeperately||(t>o?(t-=o,o=0,this.dv[this.k].OP_Dr=t):(o-=t,t=0,this.dv[this.k].OP_Cr=o)),0==t&&(this.dv[this.k].OP_Dr=null),0==o&&(this.dv[this.k].OP_Cr=null)),this.TBTransactionsDrCrSeperately||(s>n?(s-=n,n=0,this.dv[this.k].TR_Dr=s):(n-=s,s=0,this.dv[this.k].TR_Cr=n)),0==s&&(this.dv[this.k].TR_Dr=null),0==n&&(this.dv[this.k].TR_Cr=null),0==this.AccountsWithOutTransactions&&0==t&&0==o&&0==s&&0==n)continue;if(this.arrTBTotals[0]+=t,this.arrTBTotals[1]+=o,this.arrTBTotals[2]+=s,this.arrTBTotals[3]+=n,this.arrTBTotals[4]+=m,this.arrTBTotals[5]+=o,m=t+s-(o+n),(m=parseFloat(m.ToString(this.dec)))>0?(this.dv[this.k].CL_Dr=m,this.arrTBTotals[4]+=m):m<0&&(this.dv[this.k].CL_Cr=-m,this.arrTBTotals[5]+=-m),this.dv[this.k].NetBalance=m,!this.AccountsWithZeroBalance&&0==m){this.dblMissingOpeningDr+=t,this.dblMissingOpeningCr+=o;continue}this.IsFCClosingDebitExists&&(this.dbl=0,null!=this.dv[this.k].FCOP_Dr&&(this.dbl=parseFloat(this.dv[this.k].FCOP_Dr)),null!=this.dv[this.k].FCOP_Cr&&(this.dbl-=parseFloat(this.dv[this.k].FCOP_Cr)),null!=this.dv[this.k].FCTR_Dr&&(this.dbl+=parseFloat(this.dv[this.k].FCTR_Dr)),null!=this.dv[this.k].FCTR_Cr&&(this.dbl-=parseFloat(this.dv[this.k].FCTR_Cr)),this.dbl>0?this.dv[this.k].FCClosingDebit=this.dbl:this.dbl<0&&(this.dv[this.k].FCClosingCredit=-this.dbl))}if(this.TBGroupID.length>0&&this.ViewModel.AddGroupRows(this.dv,this.k),this.oRow=this.NewReportRow(),this.oRow.LevelNo=parseInt(this.dv[this.k].Depth)-1,this.oRow.Cells[1].IsNormal=!1,this.oRow.IsGroup=Object(l.j)(this.dv[this.k].IsGroup),this.oRow.DataRow=this.dv[this.k],this.oRow.NodeID=parseInt(this.dv[this.k].AccountID),!this.TBIsAccountWise&&(this.oRow.Cells[1].level=this.oRow.LevelNo,this.UpdateTreeTotals(this.oRow.LevelNo),Object(l.j)(this.dv[this.k].IsGroup))){this.lstParents.push(this.oRow),this.lstTotal.push(new Array(this.oColumns.length).fill(0));for(var M=this.lstTotal.length-1;M<=this.oRow.LevelNo;M++)this.lstParents.InsertAt(this.NewReportRow(),0),this.lstTotal.InsertAt(new Array(this.oColumns.length).fill(0),0);this.oRow.Type=a.f.BalanceBF,this.oRow.PrintVisible=this.ViewModel.TreeGroupPrint;for(var g=0;g<this.oRow.Cells.length;g++)this.oRow.Cells[g].IsNormal=!1,this.oRow.Cells[g].CellAppearance=this.BalanceBFAppearance_Data.Clone(),this.oRow.Cells[g].CellAppearance.Alignment=this.oColumns[g].DataAppearance.Alignment}for(var w=0;w<this.oColumns.length;w++){var f="";""!=this.oColumns[w].Formula?(f=this.ViewModel.CalculateFormula_1(this.oColumns[w].Formula,this.dv[this.k],this.rows),this.oRow.IsGroup&&this.GroupTotalsAtEnd&&"FLOAT"==this.oColumns[w].ColumnType&&(f="")):this.dvColumns.Contains(this.oColumns[w].ID)&&(f=i.e.String(this.dv[this.k][this.oColumns[w].ID])),""!=f&&(this.ViewModel.SetCellValue(f,this.oColumns[w].DataFormat,this.oColumns[w].ColumnType,this.oRow.Cells[w]),i.e.IsNum(f)&&(this.dbl=i.e.Double(f),this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][w]+=this.dbl,this.ViewModel.totals[w][this.ViewModel.lstGroup.length]+=this.dbl)))}this.oRow.LevelNo<=this.LevelNo&&(!this.TBShowdetailsofControlGroups&&this.lstParents.length>1&&(this.oRow.IsExpanded=!Object(l.j)(this.dv[this.k].IsSummary),Object(l.j)(this.dv[this.k].IsSummary)&&(this.oRow.Type=a.f.Detail),this.oRow.IsGroup?this.lstParents.length>2&&(this.oRow.Parent=this.lstParents[this.lstParents.length-2]):this.oRow.Parent=this.lstParents[this.lstParents.length-1],null==this.oRow.Parent||this.oRow.Parent.IsExpanded&&this.oRow.Parent.Visible||(this.oRow.Visible=!1)),-1==this.ViewModel.colSNoIndex||this.oRow.IsGroup||(this.oRow.Cells[this.ViewModel.colSNoIndex].Value=++this.ViewModel.SNo,this.oRow.Cells[this.ViewModel.colSNoIndex].Text=this.ViewModel.SNo.toString()),this.oRow.IsGroup||this.ViewModel.ApplyKPI(this.oRow),this.GrdRow++,this.ViewModel.addRow(this.oRow))}if(this.TBGroupID.length>0)for(var E=this.ViewModel.lstGroup.length;E>0;E--)this.ViewModel.AddSubtotals(this.dv[this.dv.length-1],this.ViewModel.lstGroup[E-1],E),this.ViewModel.Groupstr[this.ViewModel.lstGroup[E-1].ID]=null}},{key:"UpdateTreeTotals",value:function(e){for(var t=this,o=this.lstTotal.length-1;o>e;o--){if(this.ViewModel.FormulaColumns.length>0&&null!=this.lstParents[o].DataRow){2==parseInt(this.lstParents[o].DataRow.IsSummary)&&-1!=this.colTBCl_DrIndex&&-1!=this.colTBCl_CrIndex&&(this.lstTotal[o][this.colTBCl_DrIndex]>=this.lstTotal[o][this.colTBCl_CrIndex]?(this.lstTotal[o][this.colTBCl_DrIndex]=this.lstTotal[o][this.colTBCl_DrIndex]-this.lstTotal[o][this.colTBCl_CrIndex],this.lstTotal[o][this.colTBCl_CrIndex]=0):(this.lstTotal[o][this.colTBCl_CrIndex]=this.lstTotal[o][this.colTBCl_CrIndex]-this.lstTotal[o][this.colTBCl_DrIndex],this.lstTotal[o][this.colTBCl_DrIndex]=0));for(var s=0;s<this.oColumns.length;s++)"FLOAT"==this.oColumns[s].ColumnType&&s!=this.ViewModel.colSNoIndex&&i.e.hasprop(this.lstParents[o].DataRow,this.oColumns[s].ID)&&(this.lstParents[o].DataRow[this.oColumns[s].ID]=this.lstTotal[o][s])}if(o>0)for(var l=0;l<this.lstTotal[o].length;l++)this.lstTotal[o-1][l]+=this.lstTotal[o][l];if(!this.GroupTotalsAtEnd||this.DontShowSummaryGroupTotals&&!this.lstParents[o].IsExpanded)for(var n=0;n<this.oColumns.length;n++)"FLOAT"!=this.oColumns[n].ColumnType||n==this.ViewModel.colSNoIndex||this.ExcludeTreeTotalCols.Contains(this.oColumns[n].ID)||this.ViewModel.SetCellValue(""!=this.oColumns[n].Formula&&1==this.oColumns[n].EvaluateAtEnd&&this.ViewModel.FormulaColumns.length>0&&null!=this.lstParents[o].DataRow?this.ViewModel.CalculateFormula_1(this.oColumns[n].Formula,this.lstParents[o].DataRow,[]):this.lstTotal[o][n],this.oColumns[n].DataFormat,"FLOAT",this.lstParents[o].Cells[n]);if(e<=this.LevelNo){var r=!1;if(0==this.AccountsWithOutTransactions&&(-1!=this.colTBOp_DrIndex&&-1!=this.colTBOp_CrIndex&&-1!=this.colTBTr_DrIndex&&-1!=this.colTBTr_CrIndex?0==this.lstTotal[o][this.colTBOp_DrIndex]&&0==this.lstTotal[o][this.colTBOp_CrIndex]&&0==this.lstTotal[o][this.colTBTr_DrIndex]&&0==this.lstTotal[o][this.colTBTr_CrIndex]&&(this.GrdRow--,r=!0,this.ViewModel.removeRow(this.lstParents[o])):-1!=this.colTBCl_DrIndex&&-1!=this.colTBCl_CrIndex?0==this.lstTotal[o][this.colTBCl_DrIndex]&&0==this.lstTotal[o][this.colTBCl_CrIndex]&&(this.GrdRow--,r=!0,this.ViewModel.removeRow(this.lstParents[o])):-1!=this.colBalanceIndex&&0==this.lstTotal[o][this.colBalanceIndex]&&(this.GrdRow--,r=!0,this.ViewModel.removeRow(this.lstParents[o]))),this.AccountsWithZeroBalance||r||(-1!=this.colTBCl_DrIndex&&-1!=this.colTBCl_CrIndex?0==this.lstTotal[o][this.colTBCl_DrIndex]&&0==this.lstTotal[o][this.colTBCl_CrIndex]&&(this.GrdRow--,r=!0,this.ViewModel.removeRow(this.lstParents[o])):-1!=this.colBalanceIndex&&0==this.lstTotal[o][this.colBalanceIndex]&&(this.GrdRow--,r=!0,this.ViewModel.removeRow(this.lstParents[o]))),!r){var h=this.ViewModel.Data.indexOf(this.lstParents[o]);if(h>=0)if(!this.GroupTotalsAtEnd||this.DontShowSummaryGroupTotals&&!this.lstParents[o].IsExpanded)this.GroupTotalsSeperate&&-1!=this.colBalanceIndex&&(this.lstParents[o].Cells[this.GroupTotalIndex].Text=this.lstParents[o].Cells[this.colBalanceIndex].Text,this.lstParents[o].Cells[this.colBalanceIndex].Text=""),this.ViewModel.removeRow(this.lstParents[o]),this.ViewModel.insertRowAt(this.lstParents[o],h);else{this.oSubTotal=this.NewReportRow(),this.oSubTotal.Type=a.f.BalanceBF,this.oSubTotal.Parent=this.lstParents[o].Parent,this.oSubTotal.LevelNo=this.lstParents[o].LevelNo,this.oSubTotal.Cells[1].IsNormal=!1,this.oSubTotal.IsGroup=!0,this.oSubTotal.Visible=this.lstParents[o].Visible,this.oSubTotal.Cells[1].level=this.lstParents[o].LevelNo,this.oSubTotal.Cells[1].Text=this.lstParents[o].Cells[0].Text+"-"+this.lstParents[o].Cells[1].Text+" - Total ",this.oSubTotal.Cells[1].CellAppearance=this.GrossTotalAppearance_Data.Clone(),this.oSubTotal.Cells[1].CellAppearance.Alignment=this.oColumns[1].DataAppearance.Alignment,this.ViewModel.TreeTotalBorder<0&&this.oSubTotal.Cells.forEach((function(e){e.Border=t.ViewModel.TreeTotalBorder}));for(var u=0;u<this.oColumns.length;u++)"FLOAT"!=this.oColumns[u].ColumnType||u==this.ViewModel.colSNoIndex||this.ExcludeTreeTotalCols.Contains(this.oColumns[u].ID)||(this.oSubTotal.Cells[u].IsNormal=!1,this.oSubTotal.Cells[u].CellAppearance=this.GrossTotalAppearance_Data.Clone(),this.oSubTotal.Cells[u].CellAppearance.Alignment=this.oColumns[u].DataAppearance.Alignment,this.oSubTotal.Cells[u].Border=this.ViewModel.TreeTotalBorder,this.ViewModel.SetCellValue(""!=this.oColumns[u].Formula&&1==this.oColumns[u].EvaluateAtEnd&&this.ViewModel.FormulaColumns.length>0&&null!=this.lstParents[o].DataRow?this.ViewModel.CalculateFormula_1(this.oColumns[u].Formula,this.lstParents[o].DataRow,[]):this.lstTotal[o][u],this.oColumns[u].DataFormat,"FLOAT",this.oSubTotal.Cells[u]));this.GroupTotalsSeperate&&-1!=this.colBalanceIndex&&(this.oSubTotal.Cells[this.GroupTotalIndex].IsNormal=!1,this.oSubTotal.Cells[this.GroupTotalIndex].CellAppearance=this.GrossTotalAppearance_Data.Clone(),this.oSubTotal.Cells[this.GroupTotalIndex].CellAppearance.Alignment=this.oColumns[this.GroupTotalIndex].DataAppearance.Alignment,this.oSubTotal.Cells[this.GroupTotalIndex].Border=this.ViewModel.TreeTotalBorder,this.oSubTotal.Cells[this.GroupTotalIndex].Text=this.oSubTotal.Cells[this.colBalanceIndex].Text,this.oSubTotal.Cells[this.colBalanceIndex].Text=""),this.GrdRow++,this.ViewModel.addRow(this.oSubTotal)}}}this.lstParents.RemoveAt(o),this.lstTotal.RemoveAt(o)}}},{key:"UpdateDataTableWithGroups",value:function(){var e,t,o,s,n,a,r,h,u,c,d,C=this,p=this.ds.Tables[1],T=this.ds.Columns[1],_=this.ds.Tables[1],m=this.ds.Tables[1];T.push("OP_Dr"),T.push("OP_Cr"),T.push("TR_Dr"),T.push("TR_Cr");for(var I=function(e){Object(l.j)(p[e].TB)?(_=m.filter((function(t){return t.ParentID==p[e].AccountID}))).forEach((function(e){e.TB=1})):(p.RemoveAt(e),e--),R=e},R=0;R<p.length;R++)I(R);for(var S=0;S<this.CountMonths;S++)T.push(this.oColumns[this.ViewModel.ColumnSource.length+S].ID);for(var A=function(l){(_=m.filter((function(e){return e.AccountID==C.ds.Tables[0][l].ParentID&&1==e.TB}))).length>0&&(t=C.ds.Tables[0][l],o=i.e.Double(t.OP_Dr),s=i.e.Double(t.OP_Cr),n=i.e.Double(t.TR_Dr),a=i.e.Double(t.TR_Cr),C.OpenCompany&&(C.strAccountType=t.AccountTypeID.toString(),"4"!=C.strAccountType&&"5"!=C.strAccountType&&"8"!=C.strAccountType&&"9"!=C.strAccountType&&"11"!=C.strAccountType&&"12"!=C.strAccountType||(o=0,s=0,t.OP_Dr=null,t.OP_Cr=null),null!=C.dvOpenCompany&&(C.dvOpenCompany=C.dvOpenCompanyTable.filter((function(e){return e.AccountID==t.AccountID})),C.dvOpenCompany.length>0&&(C.dbl=parseFloat(C.dvOpenCompany[0].Dr),C.dblDrOpenCompany+=C.dbl,o+=C.dbl,t.OP_Dr=o,C.dbl=parseFloat(C.dvOpenCompany[0].Cr),C.dblCrOpenCompany+=C.dbl,s+=C.dbl,t.OP_Cr=s))),r=o+n-(s+a),r=parseFloat(r.ToString(C.dec)),(C.AccountsWithZeroBalance||r>0)&&(h=i.e.Double(_[0].OP_Dr),u=i.e.Double(_[0].OP_Cr),c=i.e.Double(_[0].TR_Dr),d=i.e.Double(_[0].TR_Cr),_[0].OP_Dr=h+o,_[0].OP_Cr=u+s,_[0].TR_Dr=c+n,_[0].TR_Cr=d+a,C.Show==D.TagWise&&((e=C.ds.Tables[0][l].Tag.toString()).length>0&&(C.dbl=i.e.Double(_[0][e]),_[0][e]=r+C.dbl))),C.ds.Tables[0].RemoveAt(l))},M=this.ds.Tables[0].length-1;M>=0;M--)A(M);for(var g=function(t){if((_=m.filter((function(e){return e.AccountID==p[t].ParentID}))).length>0)o=i.e.Double(p[t].OP_Dr),s=i.e.Double(p[t].OP_Cr),n=i.e.Double(p[t].TR_Dr),a=i.e.Double(p[t].TR_Cr),h=i.e.Double(_[0].OP_Dr),u=i.e.Double(_[0].OP_Cr),c=i.e.Double(_[0].TR_Dr),d=i.e.Double(_[0].TR_Cr),_[0].OP_Dr=h+o,_[0].OP_Cr=u+s,_[0].TR_Dr=c+n,_[0].TR_Cr=d+a,p.RemoveAt(t);else{var l={};if(l.AccountCode=p[t].AccountCode,l.AccountName=p[t].AccountName,l.AccountID=p[t].AccountID,l.AccountTypeID=0,l.OP_Dr=p[t].OP_Dr,l.OP_Cr=p[t].OP_Cr,l.TR_Dr=p[t].TR_Dr,l.TR_Cr=p[t].TR_Cr,l.lft=p[t].lft,l.Depth=p[t].Depth,l.IsGroup=!1,C.Show==D.TagWise){l.Tag="-999";for(var r=0;r<C.CountMonths;r++)l[e=C.oColumns[C.ViewModel.ColumnSource.length+r].ID]=p[t][e]}C.ds.Tables[0].push(l)}},w=p.length-1;w>=0;w--)g(w)}},{key:"addTrialBalanceTType",value:function(){var e,t,o,s,n=this,a=0;for(this.dblMissingOpeningDr=0,this.dblMissingOpeningCr=0,this.lstParents.Clear(),this.lstTotal.Clear(),this.lstParents.push(this.NewReportRow()),this.lstTotal.push(new Array(this.oColumns.length).fill(0)),this.arrTBTotals=new Array(6).fill(0),this.ViewModel.totals=i.e.NumArray(this.oColumns.length,this.ViewModel.lstGroup.length+1),this.k=0;this.k<this.dv.length;this.k++)if(this.strAccountType=this.dv[this.k].AccountTypeID.toString(),!Object(l.j)(this.dv[this.k].IsGroup)){if(e=i.e.Double(this.dv[this.k].OP_Dr),t=i.e.Double(this.dv[this.k].OP_Cr),o=i.e.Double(this.dv[this.k].TR_Dr),s=i.e.Double(this.dv[this.k].TR_Cr),this.OpenCompany&&("4"!=this.strAccountType&&"5"!=this.strAccountType&&"8"!=this.strAccountType&&"9"!=this.strAccountType&&"11"!=this.strAccountType&&"12"!=this.strAccountType||(e=0,t=0,this.dv[this.k].OP_Dr=null,this.dv[this.k].OP_Cr=null),null!=this.dvOpenCompanyTable&&(this.dvOpenCompany=this.dvOpenCompanyTable.filter((function(e){return e.AccountID==n.dv[n.k].AccountID})),this.dvOpenCompany.length>0&&(this.dbl=parseFloat(this.dvOpenCompany[0].Dr),this.dblDrOpenCompany+=this.dbl,e+=this.dbl,this.dv[this.k].OP_Dr=e,this.dbl=parseFloat(this.dvOpenCompany[0].Cr),this.dblCrOpenCompany+=this.dbl,t+=this.dbl,this.dv[this.k].OP_Cr=t))),this.TBOpeningDrCrSeperately||(e>t?(e-=t,t=0,this.dv[this.k].OP_Dr=e):(t-=e,e=0,this.dv[this.k].OP_Cr=t)),0==e&&(this.dv[this.k].OP_Dr=null),0==t&&(this.dv[this.k].OP_Cr=null),this.TBTransactionsDrCrSeperately||(o>s?(o-=s,s=0,this.dv[this.k].TR_Dr=o):(s-=o,o=0,this.dv[this.k].TR_Cr=s)),0==o&&(this.dv[this.k].TR_Dr=null),0==s&&(this.dv[this.k].TR_Cr=null),0==this.AccountsWithOutTransactions&&0==e&&0==t&&0==o&&0==s)continue;if(this.arrTBTotals[0]+=e,this.arrTBTotals[1]+=t,this.arrTBTotals[2]+=o,this.arrTBTotals[3]+=s,this.arrTBTotals[4]+=a,this.arrTBTotals[5]+=t,a=e+o-(t+s),(a=parseFloat(a.ToString(this.dec)))>0?(this.dv[this.k].CL_Dr=a,this.arrTBTotals[4]+=a):a<0&&(this.dv[this.k].CL_Cr=-a,this.arrTBTotals[5]+=-a),this.dv[this.k].NetBalance=a,!this.AccountsWithZeroBalance&&0==a){this.dblMissingOpeningDr+=e,this.dblMissingOpeningCr+=t;continue}}this.ReportTotal=new Array(2).fill(0),this.CellStartPos=0,this.AddSection(!0,!0),this.AddSection(!1,!1)}},{key:"AddSection",value:function(e,t){this.IsFirstCall=t,this.lstParents.Clear(),this.lstTotal.Clear(),t||(this.FirstTypeEndIndex=this.GrdRow,this.GrdRow=-1,this.CellStartPos=this.CellStartPos+this.TTColumnSize),e?(this.dv=this.dvTable.filter(this.TBIsAccountWise?function(e){return i.e.Double(e.NetBalance)>=0}:function(e){return e.IsGroup=1}),this.TTReportTotalIndex=0):(this.dv=this.dvTable.filter(this.TBIsAccountWise?function(e){return e.NetBalance<0}:function(e){return e.IsGroup=1}),this.TTReportTotalIndex=1);for(var o=!1,s=!1,n=0;n<this.dv.length;n++)this.drAccount=this.dv[n],this.strAccountID=this.drAccount.AccountID.toString(),s=!1,Object(l.j)(this.drAccount.IsGroup)?(this.dbl=0,this.AddRow()):(this.dbl=i.e.Double(this.drAccount.NetBalance),this.dbl<0&&(this.dbl=-this.dbl),o=!1,(Math.abs(this.dbl)>.01||this.AccountsWithOutTransactions||o||s)&&this.AddRow());!t&&this.GrdRow+1<this.ViewModel.Data.length&&(this.ViewModel.Data[this.GrdRow+1].Cells[this.CellStartPos].Text="",this.ViewModel.Data[this.GrdRow+1].Cells[this.CellStartPos+1].Text="",this.ViewModel.ColumnSource.length>2&&(this.ViewModel.Data[this.GrdRow+1].Cells[this.CellStartPos+2].Text="")),this.TTUpdateTreeTotals(0)}},{key:"AddRow",value:function(){if(this.IsAddRow=0,this.oRow=this.NewReportRow(),this.oRow.LevelNo=parseInt(this.drAccount.Depth)-1,this.TBIsAccountWise||this.TTUpdateTreeTotals(this.oRow.LevelNo),this.oRow.NodeID=parseInt(this.drAccount.AccountID),this.oRow.LevelNo<=this.LevelNo&&(this.GrdRow++,this.IsFirstCall||this.GrdRow>this.FirstTypeEndIndex?this.IsAddRow=1:(this.IsAddRow=2,this.oRow=this.ViewModel.Data[this.GrdRow])),this.IsFirstCall||(this.oRow.Tag=parseInt(this.drAccount.AccountID)),this.oRow.IsGroup=Object(l.j)(this.drAccount.IsGroup),this.TBIsAccountWise||(this.oRow.Cells[this.CellStartPos+this.TTAccNameIndex].level=parseInt(this.drAccount.Depth)-1),Object(l.j)(this.drAccount.IsGroup)){this.lstParents.push(this.oRow),this.lstTotal.push(new Array(this.oColumns.length).fill(0));for(var e=this.CellStartPos;e<this.CellStartPos+this.TTColumnSize;e++)this.oRow.Cells[e].IsNormal=!1,this.oRow.Cells[e].CellAppearance=this.BalanceBFAppearance.Clone(),this.oRow.Cells[e].CellAppearance.Alignment=this.ViewModel.ReportColumns[e].DataAppearance.Alignment;this.oRow.Type=a.f.BalanceBF}else{this.ReportTotal[this.TTReportTotalIndex]+=this.dbl;for(var t=this.CellStartPos;t<this.CellStartPos+this.TTColumnSize;t++)this.oRow.Cells[t].IsNormal=!0,this.oRow.Cells[t].CellAppearance=null}if(this.oRow.Cells[this.CellStartPos].Text=this.drAccount.AccountCode.toString(),this.oRow.Cells[this.CellStartPos].Value=this.oRow.Cells[this.CellStartPos].Text,this.oRow.Cells[this.CellStartPos+this.TTAccNameIndex].Text=this.drAccount.AccountName.toString(),this.oRow.Cells[this.CellStartPos+this.TTAccNameIndex].Value=this.oRow.Cells[this.CellStartPos+this.TTAccNameIndex].Text,this.oRow.Cells[this.CellStartPos+this.TTAccNameIndex].IsNormal=!1,this.oRow.IsGroup||(this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.CellStartPos+this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.BalIndex]+=this.dbl),this.ViewModel.ApplyKPI(this.oRow)),1==this.IsAddRow){if(!(this.TBShowdetailsofControlGroups||(this.oRow.IsExpanded=!Object(l.j)(this.drAccount.IsSummary),Object(l.j)(this.drAccount.IsSummary)&&(this.oRow.Type=a.f.Detail),this.oRow.IsGroup?this.lstParents.length>1&&(this.oRow.Parent=this.lstParents[this.lstParents.length-2]):this.lstParents.length>0&&(this.oRow.Parent=this.lstParents[this.lstParents.length-1]),null==this.oRow.Parent||this.oRow.Parent.IsExpanded&&this.oRow.Parent.Visible)))return this.oRow.Visible=!1,void this.GrdRow--;this.ViewModel.addRow(this.oRow)}else if(2==this.IsAddRow){if(!this.TBShowdetailsofControlGroups){this.oRow.IsExpanded=!Object(l.j)(this.drAccount.IsSummary),this.oRow.IsGroup?this.lstParents.length>1&&(this.oRow.Parent=this.lstParents[this.lstParents.length-2]):this.lstParents.length>0&&(this.oRow.Parent=this.lstParents[this.lstParents.length-1]);for(var o=0;o<this.lstParents.length;o++){var s=this.lstParents[o];if(!s.IsExpanded&&s!=this.oRow)return void this.GrdRow--}}this.ViewModel.removeRow(this.oRow),this.ViewModel.insertRowAt(this.oRow,this.GrdRow)}}},{key:"TTUpdateTreeTotals",value:function(e){for(var t=this.lstTotal.length-1;t>=e;t--){if(t>0)for(var o=0;o<this.lstTotal[t].length;o++)this.lstTotal[t-1][o]+=this.lstTotal[t][o];if((!this.GroupTotalsAtEnd||this.DontShowSummaryGroupTotals&&!this.lstParents[t].IsExpanded)&&this.ViewModel.SetCellValue(this.lstTotal[t][this.BalIndex],this.oColumns[this.CellStartPos+this.BalIndex].DataFormat,"FLOAT",this.GroupTotalsSeperate?this.lstParents[t].Cells[this.CellStartPos+this.BalIndex+1]:this.lstParents[t].Cells[this.CellStartPos+this.BalIndex]),e<=this.LevelNo){var s=this.ViewModel.Data.indexOf(this.lstParents[t]);if(s>=0)if(this.ViewModel.Data.RemoveAt(s),this.IsValueExists(this.lstTotal[t])||(0==this.CellStartPos||this.FirstTypeEndIndex<s?s=-1:this.GrdRow--),-1!=s){if(this.ViewModel.insertRowAt(this.lstParents[t],s),this.IsValueExists(this.lstTotal[t]))if(!this.GroupTotalsAtEnd||this.DontShowSummaryGroupTotals&&!this.lstParents[t].IsExpanded);else{this.GrdRow++,this.oSubTotal=this.ViewModel.Data.length<=this.GrdRow?this.NewReportRow():this.ViewModel.Data[this.GrdRow],this.oSubTotal.Type=a.f.BalanceBF,this.oSubTotal.Parent=this.lstParents[t].Parent,this.oSubTotal.LevelNo=this.lstParents[t].LevelNo,this.oSubTotal.IsGroup=!0,this.oSubTotal.Visible=this.lstParents[t].Visible,this.oSubTotal.Cells[this.CellStartPos].Text="";var i=this.oSubTotal.Cells[this.CellStartPos+this.TTAccNameIndex];i.IsNormal=!1,i.level=this.lstParents[t].LevelNo,i.Text=this.lstParents[t].Cells[this.CellStartPos+this.TTAccNameIndex].Text+" - TOTAL",i.CellAppearance=this.GrossTotalAppearance_Data.Clone(),i.CellAppearance.Alignment=this.oColumns[this.TTAccNameIndex].DataAppearance.Alignment,this.GroupTotalsSeperate?(this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+1].IsNormal=!1,this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+1].CellAppearance=this.GrossTotalAppearance_Data.Clone(),this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+1].CellAppearance.Alignment=this.oColumns[this.BalIndex].DataAppearance.Alignment,this.ViewModel.SetCellValue(this.lstTotal[t][this.BalIndex],this.oColumns[this.CellStartPos+this.BalIndex].DataFormat,"FLOAT",this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+1])):(this.oSubTotal.Cells[this.CellStartPos+this.BalIndex].IsNormal=!1,this.oSubTotal.Cells[this.CellStartPos+this.BalIndex].CellAppearance=this.GrossTotalAppearance_Data.Clone(),this.oSubTotal.Cells[this.CellStartPos+this.BalIndex].CellAppearance.Alignment=this.oColumns[this.BalIndex].DataAppearance.Alignment,this.ViewModel.SetCellValue(this.lstTotal[t][this.BalIndex],this.oColumns[this.CellStartPos+this.BalIndex].DataFormat,"FLOAT",this.oSubTotal.Cells[this.CellStartPos+this.BalIndex])),this.ViewModel.Data.length<=this.GrdRow?this.ViewModel.addRow(this.oSubTotal):(this.ViewModel.Data.RemoveAt(this.GrdRow),this.ViewModel.insertRowAt(this.oSubTotal,this.GrdRow))}}else this.GrdRow--}this.lstParents.RemoveAt(t),this.lstTotal.RemoveAt(t)}}},{key:"IsValueExists",value:function(e){return!!e.find((function(e){return 0!=e}))}},{key:"AddRow_RP",value:function(e){if(this.IsAddRow=0,this.oRow=this.NewReportRow(),this.oRow.LevelNo=parseInt(e.Depth)-1,this.UpdateTreeTotals_RP(this.oRow.LevelNo),this.oRow.NodeID=parseInt(e.AccountID),this.oRow.LevelNo<=this.LevelNo&&(this.GrdRow++,this.IsFirstCall||this.GrdRow>=this.FirstTypeEndIndex?this.IsAddRow=1:(this.IsAddRow=2,this.oRow=this.ViewModel.Data[this.GrdRow])),this.oRow.IsGroup=Object(l.j)(e.IsGroup),this.oRow.Cells[this.CellStartPos+0].level=parseInt(e.Depth)-1,this.oRow.IsGroup){this.lstParents.push(this.oRow),this.lstTotal.push(new Array(this.oColumns.length).fill(0));for(var t=this.CellStartPos;t<this.CellStartPos+2;t++)this.oRow.Cells[t].IsNormal=!1,this.oRow.Cells[t].CellAppearance=this.BalanceBFAppearance.Clone(),this.oRow.Cells[t].CellAppearance.Alignment=this.ViewModel.ReportColumns[t].DataAppearance.Alignment;this.oRow.Type=a.f.BalanceBF}else for(var o=this.CellStartPos;o<this.oRow.Cells.length;o++)this.oRow.Cells[o].IsNormal=!0,this.oRow.Cells[o].CellAppearance=null;if(this.ViewModel.SetCellValue(e.Account,this.oColumns[this.CellStartPos+0].DataFormat,this.oColumns[this.CellStartPos+0].ColumnType,this.oRow.Cells[this.CellStartPos+0]),this.oRow.Cells[this.CellStartPos].IsNormal=!1,!this.oRow.IsGroup)if(this.dbl=parseInt(e.Amount),1==this.CallFrom||3==this.CallFrom)if(this.dbl>0){var s=1==this.CallFrom?1:3;this.ViewModel.SetCellValue(this.dbl,this.oColumns[s].DataFormat,this.oColumns[s].ColumnType,this.oRow.Cells[s]),this.AggTotal[this.CallFrom]+=this.dbl,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][s]+=this.dbl)}else{this.dbl=-this.dbl;var i=1==this.CallFrom?3:1;this.ViewModel.SetCellValue(this.dbl,this.oColumns[i].DataFormat,this.oColumns[i].ColumnType,this.oRow.Cells[i]),this.AggTotal[this.CallFrom]+=this.dbl,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][i]+=this.dbl)}else this.IsFirstCall||(this.dbl=-this.dbl),this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.CellStartPos+1].DataFormat,this.oColumns[this.CellStartPos+1].ColumnType,this.oRow.Cells[this.CellStartPos+1]),this.dbl=this.ViewModel.RoundOff(this.dbl,this.oColumns[this.CellStartPos+1].DataFormat),this.AggTotal[2]+=this.dbl,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.CellStartPos+1]+=this.dbl);1==this.IsAddRow?this.ViewModel.addRow(this.oRow):2==this.IsAddRow&&(this.ViewModel.removeRow(this.oRow),this.ViewModel.insertRowAt(this.oRow,this.GrdRow))}},{key:"UpdateTreeTotals_RP",value:function(e){if(!(e<0))for(var t=this.lstTotal.length-1;t>=e;t--){if(t>0)for(var o=0;o<this.lstTotal[t].length;o++)this.lstTotal[t-1][o]+=this.lstTotal[t][o];if(this.ViewModel.SetCellValue(this.lstTotal[t][this.CellStartPos+1],this.oColumns[this.CellStartPos+1].DataFormat,"FLOAT",this.lstParents[t].Cells[this.CellStartPos+1]),e<=this.LevelNo){var s=this.ViewModel.Data.indexOf(this.lstParents[t]);s>=0&&(this.ViewModel.Data.RemoveAt(s),0==this.lstTotal[t][this.CellStartPos+1]&&(0==this.CellStartPos||this.FirstTypeEndIndex<s?s=-1:this.GrdRow--),-1!=s?this.ViewModel.insertRowAt(this.lstParents[t],s):this.GrdRow--)}this.lstParents.RemoveAt(t),this.lstTotal.RemoveAt(t)}}},{key:"AddSection_RPVertical",value:function(e){if(0!=this.dv.length){for(this.oRow=this.NewReportRow_2(a.f.SubReportHeader,this.GrossTotalAppearance),this.oRow.Cells[0].CellAppearance.BackColor="#FFF0EEF9",this.oRow.Cells[0].ColSpan=this.oColumns.length,1==e?this.oRow.Cells[0].Text="RECEIPTS":2==e?this.oRow.Cells[0].Text="PAYMENTS":3==e?this.oRow.Cells[0].Text="PDC Receipts":4==e&&(this.oRow.Cells[0].Text="PDC Payments"),this.ViewModel.addRow(this.oRow),this.k=0;this.k<this.dv.length;this.k++){this.oRow=new a.d(this.oColumns.length,this.ViewModel.RowHeight),this.oRow.Type=a.f.Detail,this.oRow.DataRow=this.dv[this.k],this.oRow.NodeID=parseInt(this.dv[this.k].AccountID);for(var t=0;t<this.oColumns.length;t++){var o="";this.dvColumns.Contains(this.oColumns[t].ID)&&(o=i.e.String(this.dv[this.k][this.oColumns[t].ID])),""!=o&&("FLOAT"==this.oColumns[t].ColumnType&&(this.dbl=i.e.Double(o),this.AggTotal[t][e]+=this.dbl),this.ViewModel.SetCellValue(o,this.oColumns[t].DataFormat,this.oColumns[t].ColumnType,this.oRow.Cells[t]))}this.ViewModel.addRow(this.oRow)}this.oRow=this.NewReportRow_2(a.f.SubTotal,this.GrossTotalAppearance_Data),this.oRow.Cells[0].Text="Total",this.oRow.Cells[0].CellAppearance.Alignment="Left";for(var s=0;s<this.oColumns.length;s++)"FLOAT"==this.oColumns[s].ColumnType&&this.ViewModel.SetCellValue(this.AggTotal[s][e],this.oColumns[s].DataFormat,this.oColumns[s].ColumnType,this.oRow.Cells[s]),this.oRow.Cells[s].CellAppearance.ForeColor="Red",this.oRow.Cells[s].CellAppearance.IsBold=!1;this.ViewModel.addRow(this.oRow)}}},{key:"ColumnnarCashBank",value:function(){var e=this,t=this.ViewModel.ColumnSource.length-1+this.colIndex.length,o=!(!this.ViewModel.Preferences.ContainsKey("ShowNarration")||"1"!=this.ViewModel.Preferences.ShowNarration);this.AggTotal=i.e.NumArray(this.oColumns.length,2);var l=new a.a;l.IsBold=!0,l.FontSize=14,l.ForeColor="#FF00465A",l.BackColor="White",l.FontFamilyName="Arial",l.Alignment="Center",this.oRow=this.NewReportRow_2(a.f.Header,l),this.ViewModel.RowHeight<30&&(this.oRow.Height=30),this.oRow.Cells[0].ColSpan=t,this.oRow.Cells[0].Text="Receipts",this.oRow.Cells[t].Text="Payments",this.oRow.Cells[t].ColSpan=t,this.ViewModel.addRow(this.oRow),this.oRow=this.NewReportRow_2(a.f.BalanceBF,this.GrossTotalAppearance_Data),this.oRow.Cells[0].ColSpan=this.ViewModel.ColumnSource.length-1,this.oRow.Cells[0].CellAppearance.Alignment="Left",this.oRow.Cells[0].Text=s.a.GetResource("Reports_OpeningBalance");var n=0;this.ds.Tables[0].forEach((function(o){e.dbl=parseFloat(o.BF),0!=e.dbl&&(n=e.colIndex[parseInt(o.AccountID)],e.dbl<0&&(n+=t),e.AggTotal[n][0]=Math.abs(e.dbl),e.ViewModel.SetCellValue(e.AggTotal[n][0],e.oColumns[n].DataFormat,e.oColumns[n].ColumnType,e.oRow.Cells[n]))})),this.ViewModel.addRow(this.oRow);var r=this.ds.Tables[1].filter((function(e){return e.DiffDrCr>0})),h=this.ds.Tables[1].filter((function(e){return e.DiffDrCr<0})),u=Math.max(r.length,h.length),c=null;for(this.i=0;this.i<u;this.i++)this.oRow=new a.d(this.oColumns.length,this.ViewModel.RowHeight),this.oRow.Type=a.f.Detail,o&&((c=new a.d(this.oColumns.length,this.ViewModel.RowHeight)).Type=a.f.Detail),this.i<r.length&&(n=this.colIndex[parseInt(r[this.i].AccountID)],this.AddRow_ColumnnarCashBank(r[this.i],0,this.oRow,c)),this.i<h.length&&(n=this.colIndex[parseInt(h[this.i].AccountID)]+t,this.AddRow_ColumnnarCashBank(h[this.i],t,this.oRow,c)),this.ViewModel.addRow(this.oRow),o&&this.ViewModel.addRow(c);for(this.oRow=this.NewReportRow_2(a.f.BalanceBF,this.GrossTotalAppearance_Data),this.oRow.Cells[0].ColSpan=this.ViewModel.ColumnSource.length-1,this.oRow.Cells[0].CellAppearance.Alignment="Left",this.oRow.Cells[0].Text=s.a.GetResource("Reports_ReportTotal"),this.i=this.ViewModel.ColumnSource.length-1;this.i<t;this.i++)this.ViewModel.SetCellValue(this.AggTotal[this.i][1],this.oColumns[this.i].DataFormat,this.oColumns[this.i].ColumnType,this.oRow.Cells[this.i]),this.ViewModel.SetCellValue(this.AggTotal[this.i+t][1],this.oColumns[this.i].DataFormat,this.oColumns[this.i].ColumnType,this.oRow.Cells[this.i+t]);for(this.ViewModel.addRow(this.oRow),this.oRow=this.NewReportRow_2(a.f.BalanceBF,this.GrossTotalAppearance_Data),this.oRow.Cells[0].ColSpan=this.ViewModel.ColumnSource.length-1,this.oRow.Cells[0].CellAppearance.Alignment="Left",this.oRow.Cells[0].Text=s.a.GetResource("Reports_ClosingBalance"),this.i=this.ViewModel.ColumnSource.length-1;this.i<t;this.i++)this.ViewModel.SetCellValue(this.AggTotal[this.i][0]+this.AggTotal[this.i][1],this.oColumns[this.i].DataFormat,this.oColumns[this.i].ColumnType,this.oRow.Cells[this.i]),this.ViewModel.SetCellValue(this.AggTotal[this.i+t][0]+this.AggTotal[this.i+t][1],this.oColumns[this.i].DataFormat,this.oColumns[this.i].ColumnType,this.oRow.Cells[this.i+t]);for(this.ViewModel.addRow(this.oRow),this.oRow=this.NewReportRow_2(a.f.BalanceBF,this.GrossTotalAppearance_Data),this.oRow.Cells[0].ColSpan=t+this.ViewModel.ColumnSource.length-1,this.oRow.Cells[0].CellAppearance.Alignment="Left",this.oRow.Cells[0].Text="Net Balance",this.i=this.ViewModel.ColumnSource.length-1;this.i<t;this.i++)this.ViewModel.SetCellValue(this.AggTotal[this.i][0]+this.AggTotal[this.i][1]-(this.AggTotal[this.i+t][0]+this.AggTotal[this.i+t][1]),this.oColumns[this.i].DataFormat,this.oColumns[this.i].ColumnType,this.oRow.Cells[this.i+t]);this.ViewModel.addRow(this.oRow)}},{key:"AddRow_ColumnnarCashBank",value:function(e,t,o,s){for(var i=0;i<this.ViewModel.ColumnSource.length-1;i++)this.CellValue=null,this.Col=i+t,Object(h.isUndefined)(e[this.oColumns[i].ID])||(this.CellValue=e[this.oColumns[i].ID]),null!=this.CellValue&&this.ViewModel.SetCellValue(this.CellValue,this.oColumns[i].DataFormat,this.oColumns[i].ColumnType,o.Cells[this.Col]);var l=this.colIndex[parseInt(e.AccountID)]+t;this.dbl=Math.abs(parseFloat(e.DiffDrCr)),this.AggTotal[l][1]+=Math.abs(this.dbl),this.ViewModel.SetCellValue(this.dbl,this.oColumns[l].DataFormat,this.oColumns[l].ColumnType,o.Cells[l]),null!=s&&(s.Cells[this.colParticularIndex+t].Text=e.CommonNarration.toString(),s.Cells[this.colParticularIndex+t].Value=e.CommonNarration.toString())}},{key:"AddDayBook",value:function(){if(this.AggTotal=i.e.NumArray(this.oColumns.length,this.ViewModel.lstGroup.length+1),this.ViewModel.totals=i.e.NumArray(this.oColumns.length,this.ViewModel.lstGroup.length+1),this.OpBalance=parseFloat(this.ds.Tables[0][0].Balance),0!=this.OpBalance){this.Balance=this.OpBalance,this.row=this.NewReportRow_2(a.f.BalanceBF,this.BalanceBFAppearance),this.row.LevelNo=this.ViewModel.lstGroup.length;var e=this.row.Cells[0];e.ColSpan=this.colSpanBF,e.Text=s.a.GetResource("Reports_OpeningBalance"),this.colDebitIndex>-1&&this.OpBalance>0&&(this.row.Cells[this.colDebitIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(this.OpBalance,this.oColumns[this.colDebitIndex].DataFormat,"FLOAT",this.row.Cells[this.colDebitIndex]),this.AggTotal[0]=this.OpBalance),this.colCreditIndex>-1&&this.OpBalance<0&&(this.row.Cells[this.colCreditIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(-this.OpBalance,this.oColumns[this.colCreditIndex].DataFormat,"FLOAT",this.row.Cells[this.colCreditIndex]),this.AggTotal[0]=-this.OpBalance),this.ViewModel.addRow(this.row)}this.ViewModel.RenderData(this.ds.Tables[1].DefaultView);for(var t=0;t<this.oColumns.length;t++)this.AggTotal[t][0]+=this.ViewModel.totals[t][0];if(-1!=this.colDebitIndex&&-1!=this.colCreditIndex&&(this.Balance=this.AggTotal[0]-this.AggTotal[0],0!=this.Balance)){this.row=this.NewReportRow_2(a.f.BalanceBF,this.BalanceBFAppearance),this.row.LevelNo=this.ViewModel.lstGroup.length;var o=this.row.Cells[0];o.ColSpan=this.colSpanBF,o.Text=s.a.GetResource("Reports_ClosingBalance"),this.Balance<0?(this.Balance=-this.Balance,this.row.Cells[this.colDebitIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(this.Balance,this.oColumns[this.colDebitIndex].DataFormat,"FLOAT",this.row.Cells[this.colDebitIndex]),this.AggTotal[0]+=this.Balance):this.Balance>0&&(this.row.Cells[this.colCreditIndex].CellAppearance=this.BalanceBFAppearance_Data,this.ViewModel.SetCellValue(this.Balance,this.oColumns[this.colCreditIndex].DataFormat,"FLOAT",this.row.Cells[this.colCreditIndex]),this.AggTotal[0]+=this.Balance),this.ViewModel.addRow(this.row)}}}]),o}(u.b)},XPEG:function(e,t,o){"use strict";o.d(t,"a",(function(){return I}));var s=o("mrSG"),i=o("Do2H"),l=o("Lp6j"),n=o("eQJW"),a=o("wlFP"),r=o("w8Sz"),h=o("dH+5"),u=o("EQd/"),c=o("0/4Q"),D=o("USNh"),d=o("VxiT"),C=o("8iaB"),p=o("6z9j"),T=o("4HhE"),_=o("7JXL"),m=o("vTM8"),I=function(e){_inherits(C,e);var t=_createSuper(C);function C(){var e;return _classCallCheck(this,C),(e=t.call(this)).SelectAll=!1,e.IsReportViewScreen=!1,e.oReport=null,e.DefaultVisibility=!1,e.OKVisibility=!1,e.TreeVisibility=!0,e.RowFiltersVisible=!1,e.IsPreProcessQueryVisible=!1,e.IsEnable=!0,e.MaxDlgWidth=0,e.lstPreFetchReportCC=new m.c,e.GridViewID=0,e.TreeCCID=0,e.LookupTypeID=0,e.ClassName="AddEditFilterViewModel",e}return _createClass(C,[{key:"AddEditFilterViewModel_1",value:function(e){var t=this;if(this.ParentViewModel=e,"ReportViewModel"==e.ClassName?(this.oReport=e,this.IsReportViewScreen=!0,this.OKVisibility=!0,this.DefaultVisibility=!1,this.TreeVisibility=!this.oReport.HideCostCenterTree,this.DisplayName=this.Title=this.oReport.ScreenName,e.IsPreProcessQuery&&i.a.SessionManager.IsActionAssigned(200,"Pre-Process Query")&&(this.IsPreProcessQueryVisible=!0),this.MaxDlgWidth=900,this.DynamicGroup=[]):(this.SelectAllDocVisible=!1,this.IsReportViewScreen=!1,this.OKVisibility=!1,this.DefaultVisibility=!0,this.MaxDlgWidth=790,this.DisplayName=this.Title=i.a.GetResource("Reports_Filters")),this.QuickSearch=new u.d,this.QuickSearch.Text="",this.QuickSearch.Visible=!1,this.ShowLevel=new u.d(0),this.ShowLevel.Visible=!1,this.ShowLevel.Text="7",this.ShowLevel.LblWidth="70",this.ShowLevel.Label=i.a.GetResource("Reports_LblShowLevel"),this.ShowAllTreeData=new a.a(0),this.ShowAllTreeData.Visible=!1,this.ShowAllTreeData.IsChecked=!0,this.ShowAllTreeData.Label=i.a.GetResource("Reports_LblShowAll"),this.ShowArchive=new a.a(0),this.ShowArchive.Visible=!1,this.ShowArchive.IsChecked=!0,this.ShowArchive.Label="Archive Data",this.Budget=new c.e(0),this.Budget.Visible=!1,this.Budget.Label="Budget",this.Budget.LblWidth="60",this.ActivityTypes=new c.b(0),this.ActivityTypes.Visible=!1,this.ActivityTypes.Label="Activity Features",this.UsersList=new c.b(0),this.UsersList.Visible=!1,this.UsersList.Label="Users",this.Fields=[],this.CostCenterFilters=[],this.tree=[],this.DisplayMessage="",this.TreeFilter="",this.ParentViewModel.StaticReportType<=0&&(this.CostCenters=new c.e(0),this.CostCenters.Label=i.a.GetResource("Reports_SelectCostCenter"),this.CostCenters.LblWidth="160",this.CostCenters.SelectionChangedCommand.Subscribe(this,"OnCostCenterChange"),null!=this.ParentViewModel.FieldsDialog&&null!=this.ParentViewModel.FieldsDialog.ReportFilterCostCenterList)){var o=this.ParentViewModel.FieldsDialog.ReportFilterCostCenterList,s={FeatureID:-100,Name:"Bill Of Material Documents"};o.push(s),o.sort((function(e,t){return e.Name>t.Name?1:-1}));var n=new m.c;if(this.IsReportViewScreen&&this.oReport.Preferences.ContainsKey("TreeDimensionsFilter")){var r=[],D=new l.f;D.LoadXml("<XML>"+this.oReport.Preferences.TreeDimensionsFilter+"</XML>");for(var d=function(e){var l=D.DocumentElement.childNodes[e],a=o.filter((function(e){return e.FeatureID==l.attributes.CCID.value}));a.length>0&&((s={}).Name=a[0].Name,s.FeatureID=a[0].FeatureID,null!=l.attributes.Mandatory&&(s.Mandatory="1"!=i.a.SessionManager.UserID&&"1"!=i.a.SessionManager.RoleID||t.ParentViewModel.ReportViewType!=h.e.DashBoard&&t.ParentViewModel.ReportViewType!=h.e.Export?l.attributes.Mandatory.value:null),null!=l.attributes.PRID&&(n.push(parseInt(s.FeatureID),l),t.lstPreFetchReportCC.ContainsKey(parseInt(l.attributes.PRID.value))||t.lstPreFetchReportCC.push(parseInt(l.attributes.PRID.value),parseInt(s.FeatureID))),r.push(s))},C=0;C<D.DocumentElement.childNodes.length;C++)d(C);o=r}if(this.IsReportViewScreen&&-1==this.oReport.StaticReportType){if(this.oReport.Preferences.Filters.length>0){var p=new l.f;p.LoadXml("<XML>"+this.oReport.Preferences.Filters+"</XML>");for(var T=0;T<p.DocumentElement.childNodes.length;T++)for(var _=l.f.SelectNodes(p.DocumentElement.childNodes[T],"Filter"),I=function(e){var s=_[e];if(s.attributes.MapField.value.startsWith("CC_")){var i=0;if(s.attributes.MapField.value.startsWith("CC_44_")?(i=44,l.e.Int(s.attributes.MapField.value.substr(6))):i=l.e.Int(s.attributes.MapField.value.substr(3)),i>0&&44!=i){if(0==t.CostCenters.Items.filter((function(e){return e.Value==i.toString()})).length){var n=o.filter((function(e){return e.FeatureID==i}));n.length>0&&(t.CostCenters.Items.push(c.d.ComboBoxItems_2(n[0].Name.toString(),n[0].FeatureID.toString())),t.IsReportViewScreen&&t.oReport.Preferences.ContainsKey("TreeDimensionsFilter")&&(t.CostCenters.Items[t.CostCenters.Items.length-1].Aliasname=l.e.String(n[0].Mandatory)))}if(null!=s.attributes.PRID){null==t.Report&&(t.Report=[]);var a=t.CostCenters.Items.find((function(e){return"50"==e.Value&&e.Parent==s.attributes.PRID.value}));null!=a||((a=c.d.ComboBoxItems_3(s.attributes.PRName.value,"50",s.attributes.PRID.value)).Seq=i,t.CostCenters.Items.push(a))}}}},R=0;R<_.length;R++)I(R)}}else n.keys.forEach((function(e){null==t.Report&&(t.Report=[]);var o=t.CostCenters.Items.find((function(t){return"50"==t.Value&&t.Parent==n[e].attributes.PRID.value}));null!=o||((o=c.d.ComboBoxItems_3(n[e].attributes.PRName.value,"50",n[e].attributes.PRID.value)).Seq=e,t.CostCenters.Items.push(o))})),o.forEach((function(e){t.CostCenters.Items.push(c.d.ComboBoxItems_2(i.a.GetResource(e.Name.toString()),e.FeatureID.toString())),t.IsReportViewScreen&&t.oReport.Preferences.ContainsKey("TreeDimensionsFilter")&&(t.CostCenters.Items[t.CostCenters.Items.length-1].Aliasname=l.e.String(e.Mandatory))}))}}},{key:"LoadEditData",value:function(e){var t=this,o=null,s=l.f.SelectSingleNode(e,"TreeFilter");if(this.IsReportViewScreen&&(0==this.ParentViewModel.StaticReportType||-1==this.ParentViewModel.StaticReportType)&&this.ParentViewModel.ReportViewType!=h.e.Export&&!i.a.SessionManager.IsWinServiceCall){if("True"==i.a.SessionManager.Preferences.EnableDivisionWise.toString()&&"True"==i.a.SessionManager.Preferences["DW Reports"]){var n=this.CostCenters.Items.find((function(e){return"50001"==e.Value}));n&&(n.Aliasname="");for(var a=null,u=l.f.SelectNodes(e,"TreeFilter/FilterDef"),c=0;c<u.length;c++){var d=u[c];if("50001"==l.f.SelectSingleNodeText(d,"CCID")){a=d;break}}if(null==a){var p=0==l.f.SelectNodes(s,"FilterDef").length?"1":"0";p="<FilterDef>"+(p=0==i.a.SessionManager.DivisionID?"<CCID>50001</CCID><GridViewID>0</GridViewID><IsDefaultCC>"+p+"</IsDefaultCC><DefaultValues>"+i.a.SessionManager.DivisionWhere+"</DefaultValues>":"<CCID>50001</CCID><GridViewID>0</GridViewID><IsDefaultCC>"+p+"</IsDefaultCC><DefaultValues>"+i.a.SessionManager.DivisionID+"</DefaultValues>")+"</FilterDef>",l.f.AppendChild(s,p)}else{var T=l.f.SelectSingleNode(a,"DefaultValues");if(null!=T)if(0==T.innerHTML.length)T.innerHTML=0!=i.a.SessionManager.DivisionID?i.a.SessionManager.DivisionID.toString():i.a.SessionManager.DivisionWhere;else{var m=T.innerHTML.split(","),I=i.a.SessionManager.DivisionWhere.split(","),R="";m.forEach((function(e){I.Contains(e)&&(R.length>0&&(R+=","),R+=e)})),T.innerHTML=R}}}if("True"==i.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==i.a.SessionManager.Preferences["LW Reports"]){var S=this.CostCenters.Items.find((function(e){return"50002"==e.Value}));S&&(S.Aliasname="");for(var A=null,M=l.f.SelectNodes(e,"TreeFilter/FilterDef"),g=0;g<M.length;g++){var w=M[g];if("50002"==l.f.SelectSingleNodeText(w,"CCID")){A=w;break}}if(null==A){var f=0==l.f.SelectNodes(s,"FilterDef").length?"1":"0";f="<FilterDef>"+(f=this.ParentViewModel.Preferences.ContainsKey("SelectAllLocations")||0==i.a.SessionManager.LocationID?"<CCID>50002</CCID><GridViewID>0</GridViewID><IsDefaultCC>"+f+"</IsDefaultCC><DefaultValues>"+i.a.SessionManager.LocationWhere+"</DefaultValues>":"<CCID>50002</CCID><GridViewID>0</GridViewID><IsDefaultCC>"+f+"</IsDefaultCC><DefaultValues>"+i.a.SessionManager.LocationID+"</DefaultValues>")+"</FilterDef>",l.f.AppendChild(s,f)}else{var E=l.f.SelectSingleNode(A,"DefaultValues");if(null!=E)if(this.ParentViewModel.Preferences.ContainsKey("SelectAllLocations")&&"1"==this.ParentViewModel.Preferences.SelectAllLocations)E.innerHTML=i.a.SessionManager.LocationWhere;else if(0==E.innerHTML.length)E.innerHTML=0!=i.a.SessionManager.LocationID?i.a.SessionManager.LocationID.toString():i.a.SessionManager.LocationWhere;else{var P=E.innerHTML.split(","),y=i.a.SessionManager.LocationWhere.split(","),O="";P.forEach((function(e){y.Contains(e)&&(O.length>0&&(O+=","),O+=e)})),E.innerHTML=O}}}}if(this.IsReportViewScreen&&"1"!=i.a.SessionManager.UserID&&"1"!=i.a.SessionManager.RoleID&&null!=this.CostCenters)for(var b=i.a.SessionManager.Preferences.ContainsKey("Dimension List")?i.a.SessionManager.Preferences["Dimension List"].split(","):[],N=this.CostCenters.Items.filter((function(e){return"1"==e.Aliasname})),V=function(t){var o=N[t],n="";if(b.Contains(o.Value)&&parseInt(o.Value)>5e4){var a=i.a.report.IsGroupNode(parseInt(o.Value),0),r=i.a.report.DataSet("RPT017",a.TableName,o.Value,i.a.SessionManager.UserID);n="",r.Tables[0].forEach((function(e){n.length>0&&(n+=","),n+=e.NodeID.toString()}))}for(var h=null,u=l.f.SelectNodes(e,"TreeFilter/FilterDef"),c=0;c<u.length;c++){var D=u[c];if(l.f.SelectSingleNodeText(D,"CCID")==o.Value){h=D;break}}if(null==h){var d;d="<FilterDef>"+(d=0==l.f.SelectNodes(s,"FilterDef").length?"<CCID>"+o.Value+"</CCID><GridViewID>0</GridViewID><IsDefaultCC>1</IsDefaultCC><DefaultValues>"+n+"</DefaultValues>":"<CCID>"+o.Value+"</CCID><GridViewID>0</GridViewID><IsDefaultCC>0</IsDefaultCC><DefaultValues>"+n+"</DefaultValues>")+"</FilterDef>",l.f.AppendChild(s,d)}else{var C=l.f.SelectSingleNode(h,"DefaultValues");null!=C&&0==C.innerHTML.length&&(C.innerHTML=n)}},v=0;v<N.length;v++)V(v);if(i.a.SessionManager.LoginDimension>0){var L=null,B="2";i.a.SessionManager.LoginDimension>0&&(B=i.a.SessionManager.LoginDimension.toString());for(var F=l.f.SelectNodes(s,"FilterDef"),G=0;G<F.length;G++){var x=F[G];if(l.f.SelectSingleNodeText(x,"CCID")==B){L=x;break}}if(null==L){var W;W="<FilterDef>"+(W=0==l.f.SelectNodes(s,"FilterDef").length?"<CCID>"+B+"</CCID><GridViewID>0</GridViewID><IsDefaultCC>1</IsDefaultCC><DefaultValues>"+i.a.SessionManager.ESSID+"</DefaultValues>":"<CCID>"+B+"</CCID><GridViewID>0</GridViewID><IsDefaultCC>0</IsDefaultCC><DefaultValues>"+i.a.SessionManager.ESSID+"</DefaultValues>")+"</FilterDef>",l.f.AppendChild(s,W)}else{var k=l.f.SelectSingleNode(L,"DefaultValues");null!=k&&(k.innerHTML=i.a.SessionManager.ESSID.toString())}}if(this.IsReportViewScreen&&this.oReport.Preferences.ContainsKey("SelectAllWFDocs")){var U=i.a.report.GetDataTable("RPT018",this.oReport.Preferences.SelectAllWFDocs,i.a.SessionManager.RoleID,i.a.SessionManager.UserID),K="";U.forEach((function(e){K.length>0&&(K+=","),K+=e.CostCenterID.toString()}));for(var H=null,Q=l.f.SelectNodes(e,"TreeFilter/FilterDef"),j=0;j<Q.length;j++){var Y=Q[j];if("300"==l.f.SelectSingleNodeText(Y,"CCID")){H=Y;break}}if(null==H)l.f.AppendChild(s,"<FilterDef><CCID>300</CCID><GridViewID>0</GridViewID><IsDefaultCC>0</IsDefaultCC><DefaultValues>"+K+"</DefaultValues></FilterDef>");else{var X=H.SelectSingleNode("DefaultValues");null!=X&&(X.innerHTML=K)}}this.CostCenterFilters.Clear(),this.ParentViewModel.IgnoreTreeLoad=this.ParentViewModel.ReportViewType!=h.e.General&&this.ParentViewModel.ReportViewType!=h.e.LoadWebReport;var q=!1,z=l.f.SelectNodes(e,"TreeFilter/FilterDef/IsDefaultCC");if(z.length>0){for(var J=0;J<z.length;J++)if("1"==z[J].innerHTML){q=!0;break}q||(z[0].innerHTML="1")}for(var Z=l.f.SelectNodes(e,"TreeFilter/FilterDef"),$=function(e){var s=Z[e],i=l.f.SelectSingleNodeText(s,"CCID"),n=t.CostCenters.Items.find((function(e){return e.Value==i}));if(!n)return"continue";if(t.LookupTypeID="44"==i&&null!=l.f.SelectSingleNode(s,"LookupTypeID")?parseInt(l.f.SelectSingleNodeText(s,"LookupTypeID")):0,"44"==n.Value&&n.Parent!=t.LookupTypeID.toString())return"continue";var a=new _.a(parseInt(i),t.LookupTypeID.toString(),n.Name,t);a.SetSelectedNodes(s),a.IsVisible||t.CostCenters.Items.Remove(n),"1"==l.f.SelectSingleNodeText(s,"IsDefaultCC")&&(n.ExchgRate=1,t.TreeCCID=parseInt(i),t.GridViewID=null!=l.f.SelectSingleNode(s,"GridViewID")?parseInt(l.f.SelectSingleNodeText(s,"GridViewID")):0),t.ParentViewModel.IgnoreTreeLoad||"1"==l.f.SelectSingleNodeText(s,"IsDefaultCC")&&(t.CostCenters.SelectedValue=i,t.CostCenters.SelectedItem=n,t.LoadCostCenterTree(t.TreeCCID,t.LookupTypeID,t.GridViewID,a.SelectedNodes),t.tree.length>0&&(o=t.tree[0])),"1"==n.Aliasname&&(a.DeleteButtonVisibility=!1),t.CostCenterFilters.push(a)},ee=0;ee<Z.length;ee++)$(ee);null!=o&&this.tree[0]!=o&&(this.tree.Clear(),this.tree.push(o),this.SelectedNodes=o.SelectedNodes,this.SelectedNode=o.SelectedNode);for(var te=l.f.SelectNodes(e,"FieldFilter/FilterDef"),oe=0;oe<te.length;oe++){var se=te[oe],ie=new r.a(this);ie.ID=null!=l.f.SelectSingleNode(se,"ID")?l.f.SelectSingleNodeText(se,"ID"):"F"+l.e.NewGuid().Replace("-","");var le=new D.a;le.CategoryValue=parseInt(l.f.SelectSingleNodeText(se,"CCID")),le.FieldValue=parseInt(l.f.SelectSingleNodeText(se,"CCColID"));var ne="";null!=l.f.SelectSingleNode(se,"SelectedField")&&(ne=l.f.SelectSingleNodeText(se,"SelectedField")),this.ParentViewModel.FieldsDialog.SetCDGDO_ColID(le,ne),ie.CallBackFieldSelection(le),null!=l.f.SelectSingleNode(se,"Caption")&&(ie.Caption.Text=i.a.GetResource(l.f.SelectSingleNodeText(se,"Caption")));var ae=l.f.SelectSingleNode(se,"Condition");if(null==ae&&(ae=l.f.SelectSingleNode(se,"IsRange")),ie.Condition.SelectedValue=ae.innerHTML,ie.Condition.SetSelectedItem(ie.Condition.SelectedValue),ie.OnConditionSelectionChanged(ie.Condition.SelectedValue),null!=l.f.SelectSingleNode(se,"HideInReport")&&"1"==l.f.SelectSingleNodeText(se,"HideInReport")?(ie.HideFilter.IsChecked=!0,this.IsReportViewScreen&&(ie.IsVisible=!1)):ie.HideFilter.IsChecked=!1,this.IsReportViewScreen?this.ParentViewModel.IsPreProcessQuery&&(null!=l.f.SelectSingleNode(se,"IsPrePocessFilter")?ie.IsPrePocessFilter=!0:ie.IsVisible=!1):null!=l.f.SelectSingleNode(se,"IsPrePocessFilter")&&(ie.IsPrePocessFilter=!0),null!=l.f.SelectSingleNode(se,"QuickSearchField")?(ie.QuickSearchField.IsChecked=!0,this.IsReportViewScreen&&(ie.IsVisible=!1)):ie.QuickSearchField.IsChecked=!1,ie.QuerySearchField.IsChecked=null!=l.f.SelectSingleNode(se,"QuerySearchField"),"DATE"==ie.CDGDO.DataType)"FUTURE"==ae.innerHTML||"PAST"==ae.innerHTML?(ie.FromValue.TextBox.Text=l.f.SelectSingleNodeText(se,"DefaultFromVal"),ie.FromValue.ComboBox.SelectedValue=null!=l.f.SelectSingleNode(se,"DefaultFromDateVal")?l.f.SelectSingleNodeText(se,"DefaultFromDateVal"):"Days",304!=this.oReport.ReportID&&305!=this.oReport.ReportID||!i.a.IsMobile||(ie.FromValue.TextBox.Text="1",ie.FromValue.ComboBox.SelectedValue="Weeks")):this.IsReportViewScreen?(ie.FromDatePicker.Date=C.GetDateFromKeyWord(l.f.SelectSingleNodeText(se,"DefaultFromVal")),"Between"!=ae.innerHTML&&"NotBetween"!=ae.innerHTML||(ie.ToDatePicker.Date=C.GetDateFromKeyWord(l.f.SelectSingleNodeText(se,"DefaultToVal"))),ie.FromDatePicker.Visible&&null!=l.f.SelectSingleNode(se,"ShowDateMonthYear")&&(ie.FromDatePicker.ShowMonthYear=!0),ie.ToDatePicker.Visible&&null!=l.f.SelectSingleNode(se,"ShowDateMonthYear")&&(ie.ToDatePicker.IsFromDate=!1,ie.ToDatePicker.ShowMonthYear=!0)):(ie.FromDate.SelectedValue=l.f.SelectSingleNodeText(se,"DefaultFromVal"),"Between"!=ae.innerHTML&&"NotBetween"!=ae.innerHTML||(ie.ToDate.SelectedValue=l.f.SelectSingleNodeText(se,"DefaultToVal")),ie.FromDate.Visible&&null!=l.f.SelectSingleNode(se,"ShowDateMonthYear")&&(ie.FromDate.IsColumnUserDefined=!0));else{if(ie.FromList.Visible){var re=l.e.Int(l.f.SelectSingleNodeText(se,"DefaultFromVal"));ie.FromList.SelectedValue=re}else ie.FromValue.TextBox.Text=l.f.SelectSingleNodeText(se,"DefaultFromVal");if("Between"==ae.innerHTML||"NotBetween"==ae.innerHTML)if(ie.ToList.Visible){var he=l.e.Int(l.f.SelectSingleNodeText(se,"DefaultToVal"));ie.ToList.SelectedValue=he}else ie.ToValue.Text=l.f.SelectSingleNodeText(se,"DefaultToVal")}this.IsReportViewScreen&&ie.QuickSearchField.IsChecked&&(this.QuickSearch.Visible=!0,ie.FromValue.TextBox=this.QuickSearch),this.Fields.push(ie)}i.a.SessionManager.RoleType>0&&(this.TreeVisibility=!1,this.CostCenterFilters.map((function(e){return e.IsVisible=!1})))}},{key:"LoadXml",value:function(e){var t=this,o=new l.f;if(o.LoadXml(e.ReportDefnXML.toString()),this.ParentViewModel.BaseReportColumns.Clear(),this.ParentViewModel.ReportGroups.Clear(),this.IsReportViewScreen&&null!=this.CostCenters&&this.oReport.Preferences.ContainsKey("ShowLookups")&&this.oReport.Preferences.ShowLookups.length>0){var s=new l.f;s.LoadXml("<XML>"+this.oReport.Preferences.ShowLookups+"</XML>");for(var a=0;a<s.DocumentElement.children.length;a++){var r=s.DocumentElement.children[a];this.CostCenters.Items.push(c.d.ComboBoxItems_3(r.attributes.Name.value,"44",r.attributes.ID.value))}}if(null!=o.SelectSingleNode("PactRevenURpts/PactRevenURptDef/ShowLevel")){this.ShowLevel.Text=o.SelectSingleNodeText("PactRevenURpts/PactRevenURptDef/ShowLevel"),this.ShowLevel.Visible=!0;var h=o.SelectSingleNode("PactRevenURpts/PactRevenURptDef/ShowAllTreeData");this.ShowAllTreeData.IsChecked=!(!h||"1"!=h.innerHTML),this.ShowAllTreeData.Visible=!0}null!=o.SelectSingleNode("PactRevenURpts/PactRevenURptDef/ShowArchive")&&(this.ShowArchive.Visible=!0,this.ShowArchive.IsChecked="1"==o.SelectSingleNodeText("PactRevenURpts/PactRevenURptDef/ShowArchive")),null!=o.SelectSingleNode("PactRevenURpts/PactRevenURptDef/BudgetReport")&&this.ShowBudgetData(o.SelectSingleNodeText("PactRevenURpts/PactRevenURptDef/BudgetReport"));for(var u=o.SelectNodes("PactRevenURpts/PactRevenURptDef/Columns/ColumnDef"),C=function(e){var o=u[e],s=new D.b(null,!1);s.Caption.Text=l.f.SelectSingleNodeText(o,"Identity/Caption"),s.ID=l.f.SelectSingleNodeText(o,"Identity/ID"),s.CDGDO.CategoryValue=parseInt(l.f.SelectSingleNodeText(o,"Identity/Category")),s.CDGDO.FieldValue=parseInt(l.f.SelectSingleNodeText(o,"Identity/Field")),null!=l.f.SelectSingleNode(o,"Identity/Formula")&&(s.Formula.Text=l.f.SelectSingleNodeText(o,"Identity/Formula")),null!=l.f.SelectSingleNode(o,"Identity/Expression")&&(s.FormulaExpression=l.f.SelectSingleNodeText(o,"Identity/Expression")),null!=l.f.SelectSingleNode(o,"Identity/FormulaEvaluateAtEnd")&&(s.FormulaEvaluateAtEnd.SelectedValue=l.f.SelectSingleNodeText(o,"Identity/FormulaEvaluateAtEnd")),null!=l.f.SelectSingleNode(o,"Identity/ShowAssigned")&&(s.ShowAssigned.SelectedValue=l.f.SelectSingleNodeText(o,"Identity/ShowAssigned"),s.CDGDO.AssignedDimID=l.e.Int(s.ShowAssigned.SelectedValue));var i="";if(null!=l.f.SelectSingleNode(o,"Identity/SelectedField")&&(i=l.f.SelectSingleNodeText(o,"Identity/SelectedField")),t.ParentViewModel.FieldsDialog.SetCDGDO_ColID(s.CDGDO,i),0==s.CDGDO.FieldValue&&(s.CDGDO.DataType=l.f.SelectSingleNodeText(o,"Identity/Type")),s.SetDataType(),s.ALLOtherDocsVisible&&null!=l.f.SelectSingleNode(o,"Identity/ALLOtherDocuments")&&(s.CDGDO.ALLOtherDocuments=l.f.SelectSingleNodeText(o,"Identity/ALLOtherDocuments")),s.ExecutedDocument.Visible&&null!=l.f.SelectSingleNode(o,"Identity/ExecutedDocument")){s.CDGDO.ExecutedDocument=l.f.SelectSingleNodeText(o,"Identity/ExecutedDocument"),"0"==s.CDGDO.ExecutedDocument&&(s.CDGDO.ExecutedDocument="");var a=s.CDGDO.ExecutedDocument.split(",");s.ExecutedDocument.Items.forEach((function(e){e.IsChecked=!!a.Contains(e.Value)}))}if(s.DimensionsFilterVisible&&null!=l.f.SelectSingleNode(o,"Identity/DimensionsFilter")&&(s.CDGDO.DimensionsFilter=l.f.SelectSingleNodeText(o,"Identity/DimensionsFilter")),s.AccountingDocument.Visible&&null!=l.f.SelectSingleNode(o,"Identity/AccountingDocument")){s.CDGDO.ExecutedDocument=l.f.SelectSingleNodeText(o,"Identity/AccountingDocument"),"0"==s.CDGDO.ExecutedDocument&&(s.CDGDO.ExecutedDocument="");var r=s.CDGDO.ExecutedDocument.split(",");s.AccountingDocument.Items.forEach((function(e){e.IsChecked=!!r.Contains(e.Value)}))}if(null!=l.f.SelectSingleNode(o,"Identity/RepeatType")&&(s.RepeatType.SelectedValue=l.f.SelectSingleNodeText(o,"Identity/RepeatType"),null!=s.RepeatType.SelectedValue&&(s.RepeatNext.Text=l.f.SelectSingleNodeText(o,"Identity/RepeatNext"),s.RepeatOn.SelectedValue=l.f.SelectSingleNodeText(o,"Identity/RepeatOn"),s.RepeatEmptyColumns.SelectedValue=null!=l.f.SelectSingleNode(o,"Identity/RepeatEmptyColumns")&&"1"==l.f.SelectSingleNodeText(o,"Identity/RepeatEmptyColumns")?"1":"0",null!=l.f.SelectSingleNode(o,"Identity/RepeatPrevData")&&(s.RepeatPrevData.SelectedValue=l.f.SelectSingleNodeText(o,"Identity/RepeatPrevData"),null!=l.f.SelectSingleNode(o,"Identity/RepeatPrevDataFull")&&(s.RepeatPrevDataFull=!0),null!=l.f.SelectSingleNode(o,"Identity/RepeatPrevDiff")&&(s.RepeatPrevDiff=!0),null!=l.f.SelectSingleNode(o,"Identity/RepeatPrevPercent")&&(s.RepeatPrevPercent=!0),null!=l.f.SelectSingleNode(o,"Identity/RepeatPrevDataSeperately")&&(s.RepeatPrevDataSeperately=!0),null!=l.f.SelectSingleNode(o,"Identity/RepeatPrevDataOfCurrYr")&&(s.RepeatPrevDataOfCurrYr=!0)))),null!=l.f.SelectSingleNode(o,"Identity/UseOnce")&&(s.UseOnce.SelectedValue=l.f.SelectSingleNodeText(o,"Identity/UseOnce")),null!=l.f.SelectSingleNode(o,"Identity/ShowLevel")&&(s.ShowLevel.SelectedValue=l.f.SelectSingleNodeText(o,"Identity/ShowLevel")),t.IsReportViewScreen){var h=t.oReport.ColumnSourceALL.find((function(e){return e.ID==s.ID}));if(h)if(null!=h.MappedColumnReports)s.IsReportMappingFilter=!0;else if(null!=h.MappedRowReports)for(var c=0;c<h.MappedRowReports.length;c++)if(l.f.SelectNodes(h.MappedRowReports[c],"Filters/ColumnFilter").find((function(e){return e.attributes.PID.value==s.ID}))){s.IsReportMappingFilter=!0;break}}s.Width.Text=l.f.SelectSingleNodeText(o,"Width"),""!=l.f.SelectSingleNodeText(o,"HeaderAppearance/Alignment").Trim()&&(s.Alignment_Header.SelectedValue=l.f.SelectSingleNodeText(o,"HeaderAppearance/Alignment")),s.Font_Header.SelectedValue=l.f.SelectSingleNodeText(o,"HeaderAppearance/Font"),""!=l.f.SelectSingleNodeText(o,"HeaderAppearance/FontSize").Trim()&&(s.FontSize_Header.Text=l.f.SelectSingleNodeText(o,"HeaderAppearance/FontSize")),null!=l.f.SelectSingleNode(o,"HeaderAppearance/BackGrndColor")&&(s.BackgroundClr_Header.Text=l.f.SelectSingleNodeText(o,"HeaderAppearance/BackGrndColor")),null!=l.f.SelectSingleNode(o,"HeaderAppearance/ForeGrndColor")&&(s.ForegroundClr_Header.Text=l.f.SelectSingleNodeText(o,"HeaderAppearance/ForeGrndColor")),null!=l.f.SelectSingleNode(o,"HeaderAppearance/Visibility")&&(s.Visibility.SelectedValue=l.f.SelectSingleNodeText(o,"HeaderAppearance/Visibility")),null!=l.f.SelectSingleNode(o,"HeaderAppearance/PrintVisibility")&&(s.PrintVisibility.SelectedValue=l.f.SelectSingleNodeText(o,"HeaderAppearance/PrintVisibility")),null!=l.f.SelectSingleNode(o,"HeaderAppearance/Row")&&(s.Row.Text=l.f.SelectSingleNodeText(o,"HeaderAppearance/Row"),s.Column.Text=l.f.SelectSingleNodeText(o,"HeaderAppearance/Column")),s.Bold_Header.Enable=null!=l.f.SelectSingleNode(o,"HeaderAppearance/FontBold")&&Object(n.j)(l.f.SelectSingleNodeText(o,"HeaderAppearance/FontBold")),s.Italic_Header.Enable=null!=l.f.SelectSingleNode(o,"HeaderAppearance/FontItalics")&&Object(n.j)(l.f.SelectSingleNodeText(o,"HeaderAppearance/FontItalics")),s.Underline_Header.Enable=null!=l.f.SelectSingleNode(o,"HeaderAppearance/Underline")&&Object(n.j)(l.f.SelectSingleNodeText(o,"HeaderAppearance/Underline")),""!=l.f.SelectSingleNodeText(o,"DataAppearance/Alignment")&&(s.Alignment.SelectedValue=l.f.SelectSingleNodeText(o,"DataAppearance/Alignment")),""!=l.f.SelectSingleNodeText(o,"DataAppearance/FontSize")&&(s.FontSize.Text=l.f.SelectSingleNodeText(o,"DataAppearance/FontSize")),s.Font.SelectedValue=l.f.SelectSingleNodeText(o,"DataAppearance/Font"),null!=l.f.SelectSingleNode(o,"DataAppearance/BackGrndColor")&&(s.BackgroundClr.Text=l.f.SelectSingleNodeText(o,"DataAppearance/BackGrndColor")),null!=l.f.SelectSingleNode(o,"DataAppearance/ForeGrndColor")&&(s.ForegroundClr.Text=l.f.SelectSingleNodeText(o,"DataAppearance/ForeGrndColor")),s.Bold.Enable=null!=l.f.SelectSingleNode(o,"DataAppearance/FontBold")&&Object(n.j)(l.f.SelectSingleNodeText(o,"DataAppearance/FontBold")),s.Italic.Enable=null!=l.f.SelectSingleNode(o,"DataAppearance/FontItalics")&&Object(n.j)(l.f.SelectSingleNodeText(o,"DataAppearance/FontItalics")),s.Underline.Enable=null!=l.f.SelectSingleNode(o,"DataAppearance/Underline")&&Object(n.j)(l.f.SelectSingleNodeText(o,"DataAppearance/Underline")),null!=l.f.SelectSingleNode(o,"Format/Decimals")&&(s.Decimals.SelectedValue=l.f.SelectSingleNodeText(o,"Format/Decimals")),null!=l.f.SelectSingleNode(o,"Format/RoundOff")&&(s.RoundOff.Text=l.f.SelectSingleNodeText(o,"Format/RoundOff")),null!=l.f.SelectSingleNode(o,"Format/RoundOff_RT")&&(s.RoundOff_RT.Text=l.f.SelectSingleNodeText(o,"Format/RoundOff_RT")),null!=l.f.SelectSingleNode(o,"Format/RoundOff_ST")&&(s.SubTotalRoundOffs=l.f.SelectSingleNodeText(o,"Format/RoundOff_ST").split(";")),null!=l.f.SelectSingleNode(o,"Format/Commas")&&(s.Commas.SelectedValue=l.f.SelectSingleNodeText(o,"Format/Commas")),null!=l.f.SelectSingleNode(o,"Format/Currency")&&(s.Currency.SelectedValue=l.f.SelectSingleNodeText(o,"Format/Currency")),null!=l.f.SelectSingleNode(o,"Format/NegativeNumber")&&(s.NegativeNumber.SelectedIndex=parseInt(l.f.SelectSingleNodeText(o,"Format/NegativeNumber"))),null!=l.f.SelectSingleNode(o,"Format/PercentageOn")&&(s.PercentageOn.SelectedValue=l.f.SelectSingleNodeText(o,"Format/PercentageOn")),null!=l.f.SelectSingleNode(o,"Format/PrevRowValue")&&(s.PrevRowValue.SelectedValue=l.f.SelectSingleNodeText(o,"Format/PrevRowValue")),null!=l.f.SelectSingleNode(o,"Format/Sort")&&(s.Sort.SelectedValue=l.f.SelectSingleNodeText(o,"Format/Sort")),null!=l.f.SelectSingleNode(o,"Format/SuppressZero")&&(s.SuppressZero.SelectedValue=l.f.SelectSingleNodeText(o,"Format/SuppressZero")),null!=l.f.SelectSingleNode(o,"Format/Expression")&&(s.Expression.Text=l.f.SelectSingleNodeText(o,"Format/Expression")),null!=l.f.SelectSingleNode(o,"Format/ColumnFilterExpression")&&(s.ColumnFilterExpression=l.f.SelectSingleNodeText(o,"Format/ColumnFilterExpression")),null!=l.f.SelectSingleNode(o,"Format/WrapText")&&(s.WrapText.SelectedValue=l.f.SelectSingleNodeText(o,"Format/WrapText")),null!=l.f.SelectSingleNode(o,"Format/WrapTextPrint")&&(s.WrapTextPrint.SelectedValue=l.f.SelectSingleNodeText(o,"Format/WrapTextPrint")),null!=l.f.SelectSingleNode(o,"Format/DateType")&&(s.DateType.Text=l.f.SelectSingleNodeText(o,"Format/DateType")),null!=l.f.SelectSingleNode(o,"Format/PrintChars")&&(s.PrintChars.Text=l.f.SelectSingleNodeText(o,"Format/PrintChars")),null!=l.f.SelectSingleNode(o,"Format/PrintOnce")&&(s.PrintOnce.SelectedValue=l.f.SelectSingleNodeText(o,"Format/PrintOnce")),null!=l.f.SelectSingleNode(o,"Linking/Type")&&(s.LinkType.SelectedValue=l.f.SelectSingleNodeText(o,"Linking/Type")),s.OnSelectionChanged("LinkType"),null!=l.f.SelectSingleNode(o,"Linking/Dimension")?s.LinkDimension.SelectedValue=l.f.SelectSingleNodeText(o,"Linking/Dimension"):"6"==s.LinkType.SelectedValue&&(s.LinkReport.Visible=!0,null!=l.f.SelectSingleNode(o,"Linking/Report")&&(s.LinkReport.SelectedValue=l.f.SelectSingleNodeText(o,"Linking/Report"))),t.ParentViewModel.BaseReportColumns.push(s)},p=0;p<u.length;p++)C(p);for(var T=o.SelectNodes("PactRevenURpts/PactRevenURptDef/Groups/GroupDef"),_=0;_<T.length;_++){var m=T[_],I=null;if("1"==l.f.SelectSingleNodeText(m,"Identity/ShowAsColumn"))for(var R=0;R<this.ParentViewModel.BaseReportColumns.length;R++){var S=this.ParentViewModel.BaseReportColumns[R];if(S.ID==l.f.SelectSingleNodeText(m,"Identity/ID")){(I=S).IsGroup=!0,I.ShowAsColumn.SelectedValue="1";break}}null==I&&((I=new D.b(null,!0)).ShowAsColumn.SelectedValue="0"),I.ID=l.f.SelectSingleNodeText(m,"Identity/ID"),I.Type.Text="Group",I.CDGDO.CategoryValue=parseInt(l.f.SelectSingleNodeText(m,"Identity/Category")),I.CDGDO.FieldValue=parseInt(l.f.SelectSingleNodeText(m,"Identity/Field"));var A="";if(null!=l.f.SelectSingleNode(m,"Identity/SelectedField")&&(A=l.f.SelectSingleNodeText(m,"Identity/SelectedField")),this.ParentViewModel.FieldsDialog.SetCDGDO_ColID(I.CDGDO,A),0==I.CDGDO.FieldValue&&(I.CDGDO.DataType=l.f.SelectSingleNodeText(m,"Identity/Type")),I.SetDataType(),""!=l.f.SelectSingleNodeText(m,"Identity/Prefix").Trim()&&(I.Prefix.Text=l.f.SelectSingleNodeText(m,"Identity/Prefix")),null!=l.f.SelectSingleNode(m,"Identity/Formula")&&(I.Formula.Text=l.f.SelectSingleNodeText(m,"Identity/Formula")),null!=l.f.SelectSingleNode(m,"Identity/Expression")&&(I.FormulaExpression=l.f.SelectSingleNodeText(m,"Identity/Expression")),""!=l.f.SelectSingleNodeText(m,"Appearance/Alignment").Trim()&&(I.Alignment.SelectedValue=l.f.SelectSingleNodeText(m,"Appearance/Alignment")),""!=l.f.SelectSingleNodeText(m,"Appearance/FontSize").Trim()&&(I.FontSize.Text=l.f.SelectSingleNodeText(m,"Appearance/FontSize")),null!=l.f.SelectSingleNode(m,"Appearance/BackGrndColor")&&(I.BackgroundClr.Text=l.f.SelectSingleNodeText(m,"Appearance/BackGrndColor")),null!=l.f.SelectSingleNode(m,"Appearance/ForeGrndColor")&&(I.ForegroundClr.Text=l.f.SelectSingleNodeText(m,"Appearance/ForeGrndColor")),null!=l.f.SelectSingleNode(m,"Appearance/Visibility")&&(I.Visibility.SelectedValue=l.f.SelectSingleNodeText(m,"Appearance/Visibility")),null!=l.f.SelectSingleNode(m,"Appearance/PrintVisibility")&&(I.PrintVisibility.SelectedValue=l.f.SelectSingleNodeText(m,"Appearance/PrintVisibility")),""!=l.f.SelectSingleNodeText(m,"Appearance/Width").Trim()&&(I.Width.Text=l.f.SelectSingleNodeText(m,"Appearance/Width")),""!=l.f.SelectSingleNodeText(m,"Appearance/Height").Trim()&&(I.Height.Text=l.f.SelectSingleNodeText(m,"Appearance/Height")),null!=l.f.SelectSingleNode(m,"Appearance/FontBold")&&(I.Bold.Enable=Object(n.j)(l.f.SelectSingleNodeText(m,"Appearance/FontBold"))),null!=l.f.SelectSingleNode(m,"Appearance/FontItalics")&&(I.Italic.Enable=Object(n.j)(l.f.SelectSingleNodeText(m,"Appearance/FontItalics"))),null!=l.f.SelectSingleNode(m,"Appearance/Underline")&&(I.Underline.Enable=Object(n.j)(l.f.SelectSingleNodeText(m,"Appearance/Underline"))),I.Font.SelectedValue=l.f.SelectSingleNodeText(m,"Appearance/Font"),null!=l.f.SelectSingleNode(m,"Format/Decimals")&&(I.Decimals.SelectedValue=l.f.SelectSingleNodeText(m,"Format/Decimals")),null!=l.f.SelectSingleNode(m,"Format/RoundOff")&&(I.RoundOff.Text=l.f.SelectSingleNodeText(m,"Format/RoundOff")),null!=l.f.SelectSingleNode(m,"Format/Commas")&&(I.Commas.SelectedValue=l.f.SelectSingleNodeText(m,"Format/Commas")),null!=l.f.SelectSingleNode(m,"Format/Currency")&&(I.Currency.SelectedValue=l.f.SelectSingleNodeText(m,"Format/Currency")),null!=l.f.SelectSingleNode(m,"Format/NegativeNumber")&&(I.NegativeNumber.SelectedIndex=parseInt(l.f.SelectSingleNodeText(m,"Format/NegativeNumber"))),null!=l.f.SelectSingleNode(m,"Format/Expression")&&(I.Expression.Text=l.f.SelectSingleNodeText(m,"Format/Expression")),null!=l.f.SelectSingleNode(m,"Format/ColumnFilterExpression")&&(I.ColumnFilterExpression=l.f.SelectSingleNodeText(m,"Format/ColumnFilterExpression")),null!=l.f.SelectSingleNode(m,"Format/Sort")&&(I.Sort.SelectedValue=l.f.SelectSingleNodeText(m,"Format/Sort")),null!=l.f.SelectSingleNode(m,"Format/WrapText")&&(I.WrapText.SelectedValue=l.f.SelectSingleNodeText(m,"Format/WrapText")),null!=l.f.SelectSingleNode(m,"Format/WrapTextPrint")&&(I.WrapTextPrint.SelectedValue=l.f.SelectSingleNodeText(m,"Format/WrapTextPrint")),null!=l.f.SelectSingleNode(m,"Format/SuppressZero")&&(I.SuppressZero.SelectedValue=l.f.SelectSingleNodeText(m,"Format/SuppressZero")),null!=l.f.SelectSingleNode(m,"Format/DateType")&&(I.DateType.Text=l.f.SelectSingleNodeText(m,"Format/DateType")),null!=l.f.SelectSingleNode(m,"Linking/Type")&&(I.LinkType.SelectedValue=l.f.SelectSingleNodeText(m,"Linking/Type")),this.ParentViewModel.ReportGroups.push(I),this.oReport.Preferences.ContainsKey("AllowGroupChange")){var M=new D.c(this.oReport,I);M.Caption="Group "+(this.DynamicGroup.length+1),this.DynamicGroup.push(M)}}if((this.ParentViewModel.BaseReportColumns.filter((function(e){return 144==e.CDGDO.CategoryValue})).length>0||this.ParentViewModel.ReportGroups.filter((function(e){return 144==e.CDGDO.CategoryValue})).length>0)&&function(){var o=(new d.a).GetScreenInfo(1e3);t.ActivityTypes.Visible=!0;var s=null;if(null!=o&&o.Tables.length>4){var i=o.Tables[4].filter((function(e){return"CalendarFeaturesList"==e.Name}));if(i.length>0){for(var n=null,a=8;a<o.Tables.length;a++)if(o.Columns[a].Contains("DocumentName")&&o.Columns[a].Contains("CostCenterID")){n=o.Tables[a];break}if(t.ActivityTypes.Items.push(c.c.CheckedListBoxItem_3("Calendar","1000")),""!=i[0].Value.toString()&&(null!=(s=i[0].Value.toString().split(";"))&&s.length>0))for(var r=function(e){if("86"==s[e].toString())t.ActivityTypes.Items.push(c.c.CheckedListBoxItem_3("Leads","86"));else if("73"==s[e].toString())t.ActivityTypes.Items.push(c.c.CheckedListBoxItem_3("Cases","73"));else if("88"==s[e].toString())t.ActivityTypes.Items.push(c.c.CheckedListBoxItem_3("Campaign","88"));else if("89"==s[e].toString())t.ActivityTypes.Items.push(c.c.CheckedListBoxItem_3("Opportunity","89"));else if("83"==s[e].toString())t.ActivityTypes.Items.push(c.c.CheckedListBoxItem_3("CRM-Customers","83"));else if("65"==s[e].toString())t.ActivityTypes.Items.push(c.c.CheckedListBoxItem_3("Contacts","65"));else if("122"==s[e].toString())t.ActivityTypes.Items.push(c.c.CheckedListBoxItem_3("FollowUp","122"));else if("95"==s[e].toString())t.ActivityTypes.Items.push(c.c.CheckedListBoxItem_3("Sales Contract","95"));else if("128"==s[e].toString())t.ActivityTypes.Items.push(c.c.CheckedListBoxItem_3("Campaign Events","128"));else if(null!=n){var o=n.filter((function(t){return t.CostCenterID==s[e]}));o.length>0&&t.ActivityTypes.Items.push(c.c.CheckedListBoxItem_3(o[0].DocumentName.toString(),o[0].CostCenterID.toString()))}},h=0;h<s.length;h++)r(h)}if(t.ActivityTypes.Visible){var u=new l.f;if(""!=e.DefaultPreferences.toString()&&(u.LoadXml(e.DefaultPreferences.toString()),!l.e.IsEmpty(u.SelectSingleNodeText("XML/ActivityTypes")))){var D=l.f.SelectSingleNode(u,"XML/ActivityTypes");null!=D&&D.length>0&&function(){for(var e=D.split(","),o=function(o){var s=t.ActivityTypes.Items.find((function(t){return t.Value==e[o].toString().Trim()}));s&&(s.IsChecked=!0)},s=0;s<e.length;s++)o(s)}()}}}}(),this.ParentViewModel.BaseReportColumns.filter((function(e){return 25144==e.CDGDO.FieldValue})).length>0||this.ParentViewModel.BaseReportColumns.filter((function(e){return 25144==e.CDGDO.ParentCCDefaultColID})).length>0||this.ParentViewModel.ReportGroups.filter((function(e){return 25144==e.CDGDO.FieldValue})).length>0||this.ParentViewModel.ReportGroups.filter((function(e){return 25144==e.CDGDO.ParentCCDefaultColID})).length>0){var g=null;if(g="1"==i.a.SessionManager.UserID?i.a.report.DataSet("RPT012",""):i.a.report.DataSet("RPT013",i.a.SessionManager.UserID),"1"!=i.a.SessionManager.UserID&&this.UsersList.Items.push(c.c.CheckedListBoxItem_3(i.a.SessionManager.UserName,i.a.SessionManager.UserID.toString())),null!=g&&g.Tables.length>0&&g.Tables[0].length>0&&g.Columns[0].Contains("UserName"))for(var w=0;w<g.Tables[0].length;w++)i.a.SessionManager.UserID.toString(),g.Tables[0][w].UserID.toString(),this.UsersList.Items.push(c.c.CheckedListBoxItem_5(g.Tables[0][w].UserName.toString(),g.Tables[0][w].UserID.toString(),!0));this.UsersList.Visible=!0}if((this.ParentViewModel.StaticReportType<=0||110==this.ParentViewModel.StaticReportType||144==this.ParentViewModel.StaticReportType)&&this.LoadEditData(o.SelectSingleNode("PactRevenURpts/Filters/PreDataFetch")),this.IsReportViewScreen){var f=o.SelectSingleNode("PactRevenURpts/Filters/PreDataFetch/RowFiltersXML");null!=f&&(this.ParentViewModel.RowFiltersXML=f.OuterXml,this.ParentViewModel.RowFiltersWhere=D.d.GetRowFilter(this.ParentViewModel.RowFiltersXML,this.ParentViewModel.StaticReportType))}if(this.IsReportViewScreen){for(var E=0;E<this.oReport.ChildReports.length;E++){var P=this.oReport.ChildReports[E];if(null!=P.xDocMap){if(null==this.ParentViewModel.oReportDialog)for(var y=l.f.SelectNodes(P.xDocMap.DocumentElement,"Filters/FieldFilter"),O=function(e){var o=y[e],s=P.ParentReport.Filter.Fields.find((function(e){return e.CDGDO.FieldValue==parseInt(o.attributes.PID.value)}));if(s)if(null!=P.oReportDialog)"1"==o.attributes.CID.value&&(P.oReportDialog.ParentReportDateFilter=s);else{var i=P.Filter.Fields.find((function(e){return e.CDGDO.FieldValue==parseInt(o.attributes.CID.value)}));i&&(i.ParentReportFilter=s,i.Condition=i.ParentReportFilter.Condition,i.FromValue=i.ParentReportFilter.FromValue,i.ToValue=i.ParentReportFilter.ToValue,i.FromDate=i.ParentReportFilter.FromDate,i.ToDate=i.ParentReportFilter.ToDate,i.FromDatePicker=i.ParentReportFilter.FromDatePicker,i.ToDatePicker=i.ParentReportFilter.ToDatePicker,i.FromList=i.ParentReportFilter.FromList,i.ToList=i.ParentReportFilter.ToList)}else if("1"==o.attributes.PID.value&&t.ParentViewModel.StaticReportType>0){null!=P.oReportDialog&&(P.oReportDialog.FromDate.ExternExpression="APPLYDATEFILTER");var l=P.Filter.Fields.find((function(e){return e.CDGDO.FieldValue==parseInt(o.attributes.CID.value)}));l&&(l.Temp="STATIC DATE FILTER")}},b=0;b<y.length;b++)O(b);else for(var N=l.f.SelectNodes(P.xDocMap.DocumentElement,"Filters/FieldFilter"),V=function(e){var o=N[e];if(null!=P.oReportDialog)P.oReportDialog.FromDate=t.ParentViewModel.oReportDialog.FromDate,P.oReportDialog.ToDate=t.ParentViewModel.oReportDialog.ToDate;else{var s=P.Filter.Fields.find((function(e){return e.CDGDO.FieldValue==parseInt(o.attributes.CID.value)}));s&&(s.FromDatePicker=t.ParentViewModel.oReportDialog.FromDate,s.ToDatePicker=t.ParentViewModel.oReportDialog.ToDate)}},v=0;v<N.length;v++)V(v);null!=P.oReportDialog&&(P.Filter.CostCenterFilters=P.oReportDialog.CostCenterFilters);for(var L=l.f.SelectNodes(P.xDocMap.DocumentElement,"Filters/TreeFilter"),B=function(e){var t=L[e],o=P.Filter.CostCenterFilters.find((function(e){return e.CostCenterID==parseInt(t.attributes.CID.value)}));o&&(o.ParentReportFilterCostCenterID=parseInt(t.attributes.PID.value))},F=0;F<L.length;F++)B(F)}}if(null!=this.oReport.ReportViewFrom){if(null==this.oReport.ReportViewFrom.oReportDialog)for(var G=l.f.SelectNodes(this.oReport.xMapXML,"Filters/FieldFilter"),x=function(e){var o=G[e],s=t.oReport.ReportViewFrom.Filter.Fields.find((function(e){return e.CDGDO.FieldValue==parseInt(o.attributes.PID.value)}));if(s)if(null!=t.oReport.oReportDialog)"1"==o.attributes.CID.value&&(t.oReport.oReportDialog.FromDate.Date=s.FromDatePicker.Date,t.oReport.oReportDialog.ToDate.Date=s.ToDatePicker.Date);else{var i=t.oReport.Filter.Fields.find((function(e){return e.CDGDO.FieldValue==parseInt(o.attributes.CID.value)}));i&&(i.Condition.SelectedValue=s.Condition.SelectedValue,i.Condition.SelectedItem=s.Condition.SelectedItem,i.OnConditionSelectionChanged(null),i.FromValue.TextBox.Text=s.FromValue.TextBox.Text,i.ToValue.Text=s.ToValue.Text,i.FromDatePicker.Date=s.FromDatePicker.Date,i.ToDatePicker.Date=s.ToDatePicker.Date,i.FromList.SelectedValue=s.FromList.SelectedValue,i.ToList.SelectedValue=s.ToList.SelectedValue)}},W=0;W<G.length;W++)x(W);else{null!=this.oReport.oReportDialog&&(this.oReport.oReportDialog.FromDate=this.oReport.ReportViewFrom.oReportDialog.FromDate,this.oReport.oReportDialog.ToDate=this.oReport.ReportViewFrom.oReportDialog.ToDate);for(var k=l.f.SelectNodes(this.oReport.xMapXML,"Filters/FieldFilter"),U=function(e){var o=k[e];if(null!=t.oReport.oReportDialog)t.oReport.oReportDialog.FromDate=t.oReport.ReportViewFrom.oReportDialog.FromDate,t.oReport.oReportDialog.ToDate=t.oReport.ReportViewFrom.oReportDialog.ToDate;else{var s=t.oReport.ReportViewFrom.Filter.Fields.FIND((function(e){return e.CDGDO.FieldValue==parseInt(o.attributes.CID.value)}));s&&(s.FromDatePicker=t.oReport.ReportViewFrom.oReportDialog.FromDate,s.ToDatePicker=t.oReport.ReportViewFrom.oReportDialog.ToDate)}},K=0;K<k.length;K++)U(K)}null!=this.oReport.oReportDialog&&(this.oReport.Filter.CostCenterFilters=this.oReport.oReportDialog.CostCenterFilters);for(var H=l.f.SelectNodes(this.oReport.xMapXML,"Filters/TreeFilter"),Q=function(e){var o=H[e],s=t.oReport.ReportViewFrom.Filter.CostCenterFilters.find((function(e){return e.CostCenterID==parseInt(o.attributes.PID.value)}));null==s&&null!=t.oReport.ReportViewFrom.oReportDialog&&(s=t.oReport.ReportViewFrom.oReportDialog.CostCenterFilters.find((function(e){return e.CostCenterID==parseInt(o.attributes.PID.value)})));var i=t.oReport.Filter.CostCenterFilters.find((function(e){return e.CostCenterID==parseInt(o.attributes.CID.value)}));s&&i&&(i.SelectedNodes=s.SelectedNodes,i.SelectedNodesTag=s.SelectedNodesTag,null!=t.oReport.oReportDialog&&t.oReport.oReportDialog.TreeCCID==i.CostCenterID&&(t.oReport.oReportDialog.DefaultTreeSelectedNodes=i.SelectedNodes))},j=0;j<H.length;j++)Q(j)}else if(null!=this.oReport.ReportViewFromReorder){null!=this.oReport.oReportDialog&&(this.oReport.Filter.CostCenterFilters=this.oReport.oReportDialog.CostCenterFilters);for(var Y=l.f.SelectNodes(this.oReport.xMapXML,"Filters/TreeFilter"),X=function(e){var o=Y[e],s=t.oReport.ReportViewFromReorder.CostCenterFilters.find((function(e){return e.CostCenterID==parseInt(o.attributes.PID.value)})),i=t.oReport.Filter.CostCenterFilters.find((function(e){return e.CostCenterID==parseInt(o.attributes.CID.value)}));s&&i&&(i.SelectedNodes=s.SelectedNodes,i.SelectedNodesTag=s.SelectedNodesTag,null!=t.oReport.oReportDialog&&t.oReport.oReportDialog.TreeCCID==i.CostCenterID&&(t.oReport.oReportDialog.DefaultTreeSelectedNodes=i.SelectedNodes))},q=0;q<Y.length;q++)X(q)}}}},{key:"ShowBudgetData",value:function(e){var t=this;this.Budget.Visible=!0,0==this.Budget.Items.length&&(i.a.report.DataSet("RPT014","").Tables[0].forEach((function(o){t.Budget.Items.push(c.d.ComboBoxItems_2(o.BudgetName.toString(),o.BudgetDefID.toString())),e==o.BudgetDefID.toString()&&(t.Budget.SelectedItem=t.Budget.Items[t.Budget.Items.length-1],t.Budget.SelectedValue=e)})),this.Budget.Items.length>0&&l.e.IsEmpty(this.Budget.SelectedValue)&&(this.Budget.SelectedItem=this.Budget.Items[0],this.Budget.SelectedValue=this.Budget.Items[0].Value))}},{key:"GetPropertiesSaveXML",value:function(){var e="",t=this.ActivityTypes.GetSelectedSting();return t.length>0?(e="<XML><ActivityTypes>"+(t=t.substr(0,t.length-1))+"</ActivityTypes></XML>"+e).toString():""}},{key:"OnButtonClick",value:function(e){var t=this;if(this.DisplayMessage="","Cancel"==e)this.ParentViewModel.ShowStaticFilter=!1,null!=this.ParentViewModel.BulkEdit?this.ParentViewModel.BulkEdit.ShowEditGrid():this.ParentViewModel.ShowReport=!0;else if("BACK"==e){for(var o=0;o<this.Fields.length;o++){var s=this.Fields[o];if(0==s.CDGDO.FieldValue)return void(this.DisplayMessage="Select "+s.Member.Label)}null!=this.ParentViewModel.BulkEdit?this.ParentViewModel.BulkEdit.ShowEditGrid():this.ParentViewModel.ShowReport=!0}else if("OK"==e)this.ParentViewModel.SetQueryXMLTags(),this.ParentViewModel.ShowReport=!0,this.ParentViewModel.DocsLanding?this.ParentViewModel.DocsLanding.OnButtonClick("Refresh"):this.ParentViewModel.LoadData();else if("PrProcessQuery"==e)this.ParentViewModel.IsPreProcessQueryClick=!0,this.ParentViewModel.SetQueryXMLTags(),this.ParentViewModel.IsPreProcessQueryClick=!1,Logger.DebugLog("ReportViewModel::LoadDynamicReport::Query :::: \r\n"+this.ParentViewModel.FinalQuery+"\r\n\r\n"),this.IsEnable=!1,this.DisplayMessage="Pre-process executing, Please wait...",i.a.report.PreProcessQuery(this.ParentViewModel.ReportID,this.ParentViewModel.FinalQuery).subscribe((function(e){t.IsEnable=!0,t.DisplayMessage=e.Message}));else if("Default"==e){if(this.ActivityTypes.Visible){var n=this.GetPropertiesSaveXML(),a=i.a.report.SetReportDefaultProperties(this.oReport.ReportID,n),h=l.e.Int(a.obj);a.Tables.length>0&&a.Tables[0].length>0&&(this.DisplayMessage=a.Tables[0][0].ErrorMessage.toString()),h>0&&this.oReport.ReportID>0&&(this.oReport.Reportds.Tables[0][0].DefaultPreferences=n)}}else if("SetDefault"==e)1==this.CostCenters.SelectedItem.ExchgRate?(this.CostCenters.SelectedItem.ExchgRate=0,this.DisplayMessage='"'+this.CostCenters.SelectedItem.Name+'" Removed As Default',this.TreeCCID=0,this.LookupTypeID=0,this.GridViewID=0):(this.CostCenters.Items.map((function(e){return e.ExchgRate=0})),this.CostCenters.SelectedItem.ExchgRate=1,this.DisplayMessage='"'+this.CostCenters.SelectedItem.Name+'" Set As Default',this.TreeCCID=parseInt(this.CostCenters.SelectedValue),this.LookupTypeID=null==this.CostCenters.SelectedItem||l.e.IsEmpty(this.CostCenters.SelectedItem.Parent)?0:parseInt(this.CostCenters.SelectedItem.Parent),this.GridViewID=50==this.TreeCCID?this.LookupTypeID:this.tree[0].GridViewID);else if("SelectFilter"==e){if(null==this.tree||0==this.tree.length)return;var u=this.CostCenterFilters.find((function(e){return e.CostCenterID==t.tree[0].CostCenterID&&e.LookupTypeID==t.tree[0].LookupTypeID}));null==u?(u=new _.a(parseInt(this.CostCenters.SelectedItem.Value),this.CostCenters.SelectedItem.Parent,this.CostCenters.SelectedItem.Name,this),null==this.tree[0].SelectedNodes&&(this.tree[0].SelectedNodes=[]),u.SelectedNodes=this.tree[0].SelectedNodes,this.CostCenterFilters.push(u)):null==u.SelectedNodes||0==u.SelectedNodes.length?this.CostCenterFilters.Remove(u):u.OnButtonClick("Delete")}else"AddFilterField"==e&&this.Fields.push(new r.a(this))}},{key:"OnCostCenterChange",value:function(e){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var s,i,n,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(l.e.IsEmpty(this.CostCenters.SelectedValue)||null==e||-1==parseInt(e)){t.next=16;break}if(null==this.CostCenters.SelectedItem||50!=parseInt(this.CostCenters.SelectedValue)){t.next=13;break}if(this.ReportWidth="450",this.ReportHeight="400",0!=this.Report.length&&this.Report[0].ReportID==parseInt(this.CostCenters.SelectedItem.Parent)){t.next=10;break}return this.ReportLoaded=!1,t.next=6,Promise.resolve().then(o.bind(null,"ThYU"));case 6:s=t.sent,i=s.ReportViewModel,(n=new i).ReportViewModel_Document(112,"<XML></XML>",parseInt(this.CostCenters.SelectedItem.Parent),!1,null,null),n.ShowHeaderButtons=!1,n.ShowRightPanel=!1,n.SearchVisibility=!1,n.PrefetchReportTreeFilter=this,n.PrefetchReportTreeFilter.PrefetchReportType=this.oReport.StaticReportType,this.Report.Clear(),this.Report.push(n);case 10:this.TreeVisibility=!1,t.next=16;break;case 13:this.TreeVisibility=!0,a=0,null==this.CostCenters.SelectedItem||l.e.IsEmpty(this.CostCenters.SelectedItem.Parent)||(a=l.e.Int(this.CostCenters.SelectedItem.Parent)),this.LoadCostCenterTree(parseInt(this.CostCenters.SelectedValue),a,0,null);case 16:case"end":return t.stop()}}),t,this)})))}},{key:"LoadCostCenterTree",value:function(e,t,o,s){if(!(i.a.SessionManager.RoleType>0)){if(this.tree.Clear(),this.TreeFilter="",300==e&&"AddEditReportViewModel"==this.ParentViewModel.ClassName){var n=this.ParentViewModel.StaticReportType;n>=13&&n<=16&&(this.TreeFilter="i.IsInventory=1 and exists (select PrefValue from com_documentpreferences with(nolock) where Prefname='DonotupdateInventory' and CostCenterID=i.CostCenterID and PrefValue='False')")}if(this.IsReportViewScreen){if(2==e){var a=this.ParentViewModel;a.Preferences.ContainsKey("AccountTypesFilter")&&a.Preferences.AccountTypesFilter.length>0&&(this.TreeFilter=i.a.SessionManager.Preferences.ContainsKey("IsControlAccounts")&&"TRUE"==i.a.SessionManager.Preferences.IsControlAccounts.toUpperCase()?"6,7"==a.Preferences.AccountTypesFilter||"7,6"==a.Preferences.AccountTypesFilter?"#DEBITORCREDITORTEE#":a.Preferences.AccountTypesFilter.Contains(",")?"A.AccountTypeID IN ("+a.Preferences.AccountTypesFilter+")":"7"==a.Preferences.AccountTypesFilter?"(#DEBTORTEE# or (A.IsDrCr=1 and A.AccountTypeID=6))":"6"==a.Preferences.AccountTypesFilter?"(#CREDITORTEE# or (A.IsDrCr=1 and A.AccountTypeID=7))":"A.AccountTypeID="+a.Preferences.AccountTypesFilter:a.Preferences.AccountTypesFilter.Contains(",")?"A.AccountTypeID IN ("+a.Preferences.AccountTypesFilter+")":"A.AccountTypeID="+a.Preferences.AccountTypesFilter)}50002==e&&"1"!=i.a.SessionManager.RoleID&&"True"==i.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==i.a.SessionManager.Preferences["LW Reports"]&&(this.TreeFilter=l.e.IsEmpty(i.a.SessionManager.LocationWhere)?"A.NodeID IN (-1234)":"A.NodeID IN ("+i.a.SessionManager.LocationWhere+")")}var r;if(null==s)for(var h=0;h<this.CostCenterFilters.length;h++){var u=this.CostCenterFilters[h];if(u.CostCenterID==e&&u.LookupTypeID==t){s=u.SelectedNodes;break}}44==e&&t>0&&(this.TreeFilter="A.LookupType="+t);var c="";if(null!=this.oReport&&this.oReport.Preferences.ContainsKey("GridViewFilter")&&this.oReport.Preferences.GridViewFilter.length>0){var D=new l.f;D.LoadXml("<GridViewFilter>"+this.oReport.Preferences.GridViewFilter+"</GridViewFilter>"),l.f.SelectNodes(D.DocumentElement.children[0],"Row").forEach((function(t){t.attributes.CCID.value==e&&(c+=t.attributes.GID.value+",")}))}if(r=new p.a,null==s?r.TreeViewModel_5(e,this,o,this.TreeFilter,c):r.TreeViewModel_6(e,this,o,this.TreeFilter,s,c),r.LookupTypeID=t,r.HeaderVisiblity=!1,r.OnNodeSelected||(r.OnNodeSelected=new T.b,r.OnNodeSelected.Subscribe(this,"OnNodeSelected")),this.tree.push(r),null!=s&&s.length>0&&null!=r&&null!=r.AllNodes){r.SelectedNode=null;var d=r.AllNodes.find((function(e){return e.Id==s[0].Id}));null!=d&&r.SelectSearchNode(d)}}}}],[{key:"GetDateFromKeyWord",value:function(e){var t=Date.Today();switch(t.getDay(),new Date,e){case"DEFAULT_DATE":t=i.a.SessionManager.ReportsFromDate;break;case"YESTERDAY":t=t.AddDays(-1);break;case"ACCOUNTING_DATE":t=i.a.SessionManager.AccountingDate;break;case"WEEK_START":case"WEEK_END":break;case"MONTH_START":t=new Date(t.getFullYear(),t.getMonth(),1);break;case"MONTH_END":t=(t=new Date(t.getFullYear(),t.getMonth(),1)).AddMonths(1).AddDays(-1);break;case"QUARTER_START":t=new Date(t.getFullYear(),t.getMonth()-(t.getMonth()-1)%3,1);break;case"QUARTER_END":t=(t=new Date(t.getFullYear(),t.getMonth()-(t.getMonth()-1)%3,1)).AddMonths(3).AddDays(-1);break;case"YEAR_START":t=new Date(t.getFullYear(),0,1);break;case"YEAR_END":t=new Date(t.getFullYear(),11,31);break;case"FISCAL_YEAR_START":(t=new Date(Date.Today().getFullYear(),i.a.SessionManager.AccountingFromMonth-1,1))>Date.Today()&&(t=t.AddYears(-1));break;case"FISCAL_YEAR_END":(t=new Date(Date.Today().getFullYear(),i.a.SessionManager.AccountingFromMonth-1,1))>Date.Today()&&(t=t.AddYears(-1)),t=t.AddYears(1).AddDays(-1);break;case"YEAR_END(DEFAULT_DATE)":(t=new Date(i.a.SessionManager.ReportsFromDate.getFullYear(),i.a.SessionManager.AccountingFromMonth-1,1))>i.a.SessionManager.ReportsFromDate&&(t=t.AddYears(-1)),t=t.AddYears(1).AddDays(-1);break;case"PAYROLL_MONTH":t=new Date(i.a.SessionManager.PayrollMonth.getFullYear(),i.a.SessionManager.PayrollMonth.getMonth(),1);break;case"PAYROLL_MONTH_START":t=i.a.SessionManager.PayrollMonthStart;break;case"PAYROLL_MONTH_END":t=i.a.SessionManager.PayrollMonthEnd}return t}}]),C}(C.a)},Zgxw:function(e,t,o){"use strict";o.d(t,"a",(function(){return D}));var s=o("Do2H"),i=o("Lp6j"),l=o("eQJW"),n=o("1xwR"),a=o("mvPR"),r=o("vTM8"),h=o("8iaB"),u=function(e){return e[e.None=0]="None",e[e.MonthWise=1]="MonthWise",e[e.YearWise=3]="YearWise",e[e.TagWise=2]="TagWise",e}({}),c=function(e){return e[e.None=0]="None",e[e.Both=1]="Both",e[e.Max=2]="Max",e[e.Min=3]="Min",e}({}),D=function(e){_inherits(o,e);var t=_createSuper(o);function o(e){var s;return _classCallCheck(this,o),(s=t.call(this,e)).Show=u.None,s.MultipleUnitType=c.Both,s.dtBins=null,s.k=0,s.drMain=null,s.OpBalanceQty=0,s.OpBalanceValue=0,s.colCOGSIndex=-1,s.colBalanceQtyIndex=-1,s.colBalanceRateIndex=-1,s.colBalanceValueIndex=-1,s.colGLCOGSIndex=-1,s.colSpanBF=-1,s.colBalanceQtyMaxIndex=-1,s.colBalanceQtyMinIndex=-1,s.Display_Positive=!1,s.Display_Negative=!1,s.Display_Zero=!1,s.ExcludeReserveQty=!1,s.IsReconcile=!1,s.ShowSLasSV=!1,s.dblQty=0,s.dblValue=0,s.dblAvgRate=0,s.dblBalQty=0,s.ShowLevelTree=!1,s.ShowCollapse=!1,s.ShowProductsWithoutTransactions=!1,s.ShowProductsWithZeroBalances=!1,s.HideEmptyDimensions=!1,s.ProductGroupFirst=!1,s.ShowGroupHighLowValues=!1,s.ShowMultipleUnitNames=!1,s.SortTransactions=!1,s.DimWiseRepeatQty=!0,s.DimWiseRepeatRate=!1,s.DimWiseRepeatReserveQty=!1,s.DimWiseRepeatHoldQty=!1,s.DimWiseRepeatValue=!1,s.IsSaleQty=!1,s.IsSaleValue=!1,s.IsMultipleUnits=!1,s.LevelNo=0,s.TagWiseColStart=0,s.DefValuation=0,s.ValuationID=0,s.TagID=0,s.ForeignCurrencyID=0,s.CurrencyType=0,s.CountMonths=0,s.RepeatCols=1,s.strProductID=null,s.TagTableName=null,s.TagColumnName=null,s.TagsList=null,s.strProductName=null,s.SortTransactionsBy="",s.Valuation=null,s.ExtraColumns=new Array,s.TemporaryTableName="",s.DocumentTypesWhere="",s.dicPeriodicAvgRate=new r.a,s.dtNonInvDocs=null,s.iLoop=0,s.MultipleUnitSelect="",s.MultipleUnitJoin="",s.dbl=0,s.dblUOMRate=0,s.dblCOGS=0,s.dblMaxConv=0,s.dblMinConv=0,s.Row=0,s.Col=0,s.GroupRowIndex=0,s.rows=new Array,s.lstRecQty=new Array,s.lstRecRate=new Array,s.oCBCell=new a.c,s.oCBFormat=new a.b,s.dblCBMin=0,s.dblCBMax=0,s.lstTotal=null,s.lstParents=new Array,s.R=0,s}return _createClass(o,[{key:"LoadReport",value:function(){var e=this;this.iLoop=0,this.GrdRow=-1,this.TagID=0,this.TagsList=null,this.dtBins=null,this.colSubTotalStartIndex=-1,this.AggTotal=i.e.NumArray(this.oColumns.length,2),this.ViewModel.totals=i.e.NumArray(this.oColumns.length,this.ViewModel.lstGroup.length+1),this.ViewModel.SNo=0;for(var t=0;t<this.oColumns.length;t++)if("FLOAT"==this.oColumns[t].ColumnType){this.colSpanBF=t;break}if(this.ViewModel.lstGroup.length>0)for(this.k=0;this.k<this.oColumns.length;this.k++)if(this.ViewModel.lstGroup[0].TotalCols.ContainsKey(this.oColumns[this.k].ID)){this.colSubTotalStartIndex=this.k;break}this.RefreshColumnIndexes();var n="";if(this.lstPCRates=new Array,this.ViewModel.BaseReportColumns.filter((function(e){return 33==e.ID.length})).forEach((function(t){40==t.CDGDO.ParentCostCenterID&&(n.length>0&&(n+=","),n+=t.CDGDO.Column,e.lstPCRates.push(t.ID))})),this.LevelNo=0,this.ShowLevelTree=!1,this.ViewModel.Preferences.ContainsKey("ShowLevel")){var r=new i.f;r.LoadXml("<XML>"+this.ViewModel.Preferences.ShowLevel+"</XML>");var h=i.f.SelectSingleNode(r.DocumentElement,"IsChecked");null!=h&&"1"==h.innerHTML&&(this.ShowLevelTree=!0,this.LevelNo=parseInt(i.f.SelectSingleNodeText(r.DocumentElement,"Text")),-1==this.LevelNo&&(this.LevelNo=50),this.ShowCollapse=!(!this.ViewModel.Preferences.ContainsKey("ShowCollapse")||"1"!=this.ViewModel.Preferences.ShowCollapse))}if(this.DefValuation=0,this.ViewModel.Preferences.ContainsKey("ValuationMethod")&&(this.DefValuation=i.e.Int(this.ViewModel.Preferences.ValuationMethod)),this.UnPostedDocsInclude=!(!this.ViewModel.Preferences.ContainsKey("IncludeUnPostedDocs")||"1"!=this.ViewModel.Preferences.IncludeUnPostedDocs),this.UnPostedDocsReserveQtyInclude=!(!this.ViewModel.Preferences.ContainsKey("IncludeUnPostedDocsReserveQty")||"1"!=this.ViewModel.Preferences.IncludeUnPostedDocsReserveQty),this.UnPostedDocsHoldQtyInclude=!(!this.ViewModel.Preferences.ContainsKey("IncludeUnPostedDocsHoldQty")||"1"!=this.ViewModel.Preferences.IncludeUnPostedDocsHoldQty),this.ShowProductsWithoutTransactions=!(!this.ViewModel.Preferences.ContainsKey("ShowProductsWithoutTransactions")||"1"!=this.ViewModel.Preferences.ShowProductsWithoutTransactions),this.ShowProductsWithZeroBalances=!(!this.ViewModel.Preferences.ContainsKey("ShowProductsWithZeroBalances")||"1"!=this.ViewModel.Preferences.ShowProductsWithZeroBalances),this.SortTransactions=!(!this.ViewModel.Preferences.ContainsKey("SortTransactions")||"1"!=this.ViewModel.Preferences.SortTransactions),this.SortTransactionsBy=this.ViewModel.Preferences.ContainsKey("SortTransactionsBy")?this.ViewModel.Preferences.SortTransactionsBy:"",this.IsReconcile=this.ViewModel.Preferences.ContainsKey("Reconcile"),this.ShowSLasSV=this.ViewModel.Preferences.ContainsKey("ShowSLasSV"),this.ViewModel.Preferences.ContainsKey("DisplayStock")&&(this.ViewModel.Preferences.DisplayStock.Contains("Zero")&&(this.Display_Zero=!0),this.ViewModel.Preferences.DisplayStock.Contains("Positive")&&(this.Display_Positive=!0),this.ViewModel.Preferences.DisplayStock.Contains("Negative")&&(this.Display_Negative=!0),this.Display_Positive||this.Display_Negative||this.Display_Zero||(this.Display_Positive=this.Display_Negative=this.Display_Zero=!0)),this.ViewModel.Preferences.ContainsKey("FinalReportsShow")){var D=this.ViewModel.Preferences.FinalReportsShow;"1"==D?this.Show=u.MonthWise:"3"==D?this.Show=u.YearWise:"2"==D&&(this.Show=u.TagWise,this.TagID=parseInt(this.ViewModel.Preferences.FinalReportsShowTag),this.ViewModel.Preferences.ContainsKey("FinalReportsShowTagHideColumns")&&(this.HideEmptyDimensions=!0),this.TagColumnName="Name",this.ViewModel.Preferences.ContainsKey("FinalReportsShowTagColumn")&&("0"==this.ViewModel.Preferences.FinalReportsShowTagColumn?this.TagColumnName="Code":"2"==this.ViewModel.Preferences.FinalReportsShowTagColumn&&(this.TagColumnName="Code+'-'+Name")))}else if(this.ViewModel.Preferences.ContainsKey("TagWise")){var d=new i.f;d.LoadXml("<XML>"+this.ViewModel.Preferences.TagWise+"</XML>");var C=i.f.SelectSingleNode(d.DocumentElement,"IsChecked");null!=C&&"1"==C.innerHTML&&(this.Show=u.TagWise,C=i.f.SelectSingleNode(d.DocumentElement,"Value"),this.TagID=parseInt(C.innerHTML),this.TagTableName=o.GetTagTableName(this.TagID),(null!=(C=i.f.SelectSingleNode(d.DocumentElement,"HideColumns"))||this.ViewModel.Preferences.ContainsKey("HideEmptyDimensions")&&"1"==this.ViewModel.Preferences.HideEmptyDimensions)&&(this.HideEmptyDimensions=!0),this.TagColumnName=14==this.ViewModel.StaticReportType||15==this.ViewModel.StaticReportType?"T.Name":"Name",null!=(C=i.f.SelectSingleNode(d.DocumentElement,"Column"))&&("0"==C.innerHTML?this.TagColumnName=14==this.ViewModel.StaticReportType||15==this.ViewModel.StaticReportType?"T.Code":"Code":"2"==C.innerHTML&&(this.TagColumnName=14==this.ViewModel.StaticReportType||15==this.ViewModel.StaticReportType?"T.Code+'-'+T.Name":"Code+'-'+Name")))}if(this.ChunkSize=this.ViewModel.Preferences.ContainsKey("ChunkSize")?parseInt(this.ViewModel.Preferences.ChunkSize):1,this.CurrencyType=0,this.ForeignCurrencyID=0,this.ViewModel.Preferences.ContainsKey("ForeignCurrency")){var p=new i.f;p.LoadXml("<XML>"+this.ViewModel.Preferences.ForeignCurrency+"</XML>");var T=i.f.SelectSingleNode(p.DocumentElement,"IsChecked");null!=T&&"1"==T.innerHTML&&(this.ForeignCurrencyID=parseInt(i.f.SelectSingleNodeText(p.DocumentElement,"Value")))}else if(this.ViewModel.Preferences.ContainsKey("Currency")){var _=new i.f;_.LoadXml("<XML>"+this.ViewModel.Preferences.Currency+"</XML>"),this.CurrencyType=parseInt(i.f.SelectSingleNodeText(_.DocumentElement,"Type")),1==this.CurrencyType?(i.e.IsEmpty(s.a.SessionManager.Preferences.DimensionwiseCurrency)||0==parseInt(s.a.SessionManager.Preferences.DimensionwiseCurrency))&&(this.CurrencyType=0):2==this.CurrencyType&&(this.ForeignCurrencyID=parseInt(i.f.SelectSingleNodeText(_.DocumentElement,"Value")))}if(this.ExcludeReserveQty=!(!this.ViewModel.Preferences.ContainsKey("ExcludeReserveQty")||"1"!=this.ViewModel.Preferences.ExcludeReserveQty),this.ShowGroupHighLowValues=!(!this.ViewModel.Preferences.ContainsKey("ShowGroupHighLowValues")||"1"!=this.ViewModel.Preferences.ShowGroupHighLowValues),this.ShowGroupHighLowValues&&(this.oCBFormat.DecimalsPoints=parseInt(s.a.SessionManager.Preferences.DecimalsinAmount),this.oCBFormat.ShowDefaultSign=0,"Millions"==s.a.SessionManager.Preferences.Commas?this.oCBFormat.Commas=1:"Lakhs"==s.a.SessionManager.Preferences.Commas&&(this.oCBFormat.Commas=2)),this.IsMultipleUnits=!1,this.MultipleUnitType=c.None,this.ViewModel.Preferences.ContainsKey("MultipleUnits")&&"0"!=this.ViewModel.Preferences.MultipleUnits&&(this.IsMultipleUnits=!0,this.MultipleUnitType=parseInt(this.ViewModel.Preferences.MultipleUnits)),this.IsMultipleUnits&&-1==this.colBalanceQtyIndex&&(this.IsMultipleUnits=!1),this.IsMultipleUnits&&(this.ShowMultipleUnitNames=!(!this.ViewModel.Preferences.ContainsKey("ShowMultipleUnitNames")||"1"!=this.ViewModel.Preferences.ShowMultipleUnitNames),this.SetMultipleUnitsQry()),this.Show==u.TagWise&&14==this.ViewModel.StaticReportType)this.RepeatCols=1;else if(this.Show!=u.None&&(14==this.ViewModel.StaticReportType||15==this.ViewModel.StaticReportType)&&(this.RepeatCols=3,this.DimWiseRepeatQty=!0,this.DimWiseRepeatRate=!0,this.DimWiseRepeatValue=!0,this.ViewModel.Preferences.ContainsKey("DimensionWiseRepeat"))){this.RepeatCols=0,this.DimWiseRepeatQty=!1,this.DimWiseRepeatRate=!1,this.DimWiseRepeatValue=!1;var m=this.ViewModel.Preferences.DimensionWiseRepeat.split(",");m.Contains("Qty")&&(this.DimWiseRepeatQty=!0,this.RepeatCols++),m.Contains("Rate")&&(this.DimWiseRepeatRate=!0,this.RepeatCols++),m.Contains("Value")&&(this.DimWiseRepeatValue=!0,this.RepeatCols++)}try{var I="",R="",S="",A=this.ViewModel.oReportDialog.GetSeqNosListWithRoots();if(this.ViewModel.oReportDialog.IsZeroSelected||this.ViewModel.oReportDialog.IsOneSelected||(this.ViewModel.oReportDialog.IsGroupExists?(S="P.ProductID=GTP.GTID",R=A.Contains(",")?",(select T.ProductID GTID from INV_Product T with(nolock),INV_Product GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.ProductID IN ("+A+") group by T.ProductID) AS GTP ":",(select T.ProductID GTID from INV_Product T with(nolock),INV_Product GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.ProductID="+A+" group by T.ProductID) AS GTP "):S=A.Contains(",")?"P.ProductID IN ("+A+")":"P.ProductID="+A),0==S.length&&this.ViewModel.Preferences.ContainsKey("ProductGroupIds")&&!i.e.IsEmpty(this.ViewModel.Preferences.ProductGroupIds)&&(S="P.ProductID=GTP.GTID",R=this.ViewModel.Preferences.ProductGroupIds.Contains(",")?",(select T.ProductID GTID from INV_Product T with(nolock),INV_Product GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.ProductID IN ("+this.ViewModel.Preferences.ProductGroupIds+") group by T.ProductID) AS GTP ":",(select T.ProductID GTID from INV_Product T with(nolock),INV_Product GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.ProductID="+this.ViewModel.Preferences.ProductGroupIds+" group by T.ProductID) AS GTP "),13==this.ViewModel.StaticReportType){if(I="SELECT P.ProductID,P.ProductName,P.ValuationID"+this.ViewModel.GroupSelectTag+this.MultipleUnitSelect,I+=" FROM INV_Product P WITH(NOLOCK)",I+=this.MultipleUnitJoin+this.ViewModel.GroupFromTag+R,I+=" WHERE P.IsGroup=0 AND P.ProductTypeId<>6 AND P.ProductTypeId!=10",S.length>0&&(I+=" AND "+S),I+=this.GetProductWiseLocationWhere("P",!1),I+=" AND P.ProductID IN ("+this.GetUsedProductsQuery()+")",I+="Code"==this.ViewModel.Preferences.TreeSortOn?" Order By P.ProductCode":"TreeOrder"==this.ViewModel.Preferences.TreeSortOn?" Order By P.lft":" Order By P.ProductName",this.IsMultipleUnits){for(var M=new Array,g=0;g<this.ViewModel.ColumnSource.length;g++)M.push(this.ViewModel.ColumnSource[g]);this.AddMultipleUnitCols(M),this.ViewModel.RefreshReportTotals(M),this.ViewModel.RefreshPostFilters(),this.oColumns=this.ViewModel.ReportColumns,this.AggTotal=i.e.NumArray(this.oColumns.length,2),this.RefreshColumnIndexes()}if(this.ViewModel.Preferences.ContainsKey("EditCreatedDate")&&!this.oColumns[0].MenuItems.ContainsKey("EditCreatedDate")){var w=new Array;this.oColumns.forEach((function(e){e.MenuItems.ContainsKey("EditCreatedDate")||e.MenuItems.push("EditCreatedDate","Edit Date"),w.push(e)})),this.ViewModel.RefreshReportTotals(w),this.ViewModel.RefreshPostFilters(),this.oColumns=this.ViewModel.ReportColumns,this.AggTotal=i.e.NumArray(this.oColumns.length,2),this.RefreshColumnIndexes(),this.oColumns.forEach((function(e){e.MenuItems.ContainsKey("EditCreatedDate")||e.MenuItems.push("EditCreatedDate","Edit Date")}))}}else if(14==this.ViewModel.StaticReportType||15==this.ViewModel.StaticReportType){if(0==this.ViewModel.ReportGroups.length){for(var f=new Array,E=0;E<this.ViewModel.ColumnSource.length;E++)f.push(this.ViewModel.ColumnSource[E]);if(this.Show!=u.None){this.TagsList="";var P,y=this.ViewModel.ColumnSource.IndexOf(this.ViewModel.ColumnSource.find((function(e){return"RecQty"==e.ID}))),O=this.ViewModel.ColumnSource.IndexOf(this.ViewModel.ColumnSource.find((function(e){return"IssQty"==e.ID}))),b=this.ViewModel.ColumnSource.indexOf(this.ViewModel.ColumnSource.find((function(e){return"BalQty"==e.ID})));if(this.Show==u.TagWise){var N=this.HideEmptyDimensions?this.GetUsedProductsByTagQuery(R,S,this.TagColumnName):this.GetTagWiseQuery(this.TagID,this.TagColumnName.Replace("T.",""),"Name");P=s.a.report.GetDataTable("RPT022",N)}else{P=[];var V=1;if(this.TagsList='<R D="'+this.ViewModel.oReportDialog.FromDate.Date.AddDays(-1).ToString("dd MMM yyyy")+'"/>',this.Show==u.MonthWise)for(var v=this.ViewModel.oReportDialog.FromDate.Date.MonthsFirst();v<=this.ViewModel.oReportDialog.ToDate.Date;)P.push({NodeID:V.toString(),Name:v.Date.ToString("MMM yy"),Tag:v.Date.AddMonths(1).AddDays(-1).ToString("dd MMM yyyy")}),v=v.AddMonths(1),V++;else{var L=new Date(this.ViewModel.oReportDialog.FromDate.Date.getFullYear(),this.AccountingFromMonth-1,1);for(L>this.ViewModel.oReportDialog.FromDate.Date&&(L=L.AddYears(-1));L<=this.ViewModel.oReportDialog.ToDate.Date;)P.push(1==this.AccountingFromMonth?{NodeID:V.toString(),Name:L.getFullYear().toString(),Tag:L.AddYears(1).AddDays(-1).ToString("dd MMM yyyy")}:{NodeID:V.toString(),Name:L.getFullYear().toString()+"-"+L.AddYears(1).ToString("yy"),Tag:L.AddYears(1).AddDays(-1).ToString("dd MMM yyyy")}),L=L.AddYears(1),V++}}P.forEach((function(t){if(14==e.ViewModel.StaticReportType){if(e.DimWiseRepeatQty){var o=e.ViewModel.ColumnSource[y].Clone();o.HeaderText=o.HeaderText+"\n"+t.Name.toString(),o.ID=o.ID+t.NodeID.toString(),f.push(o),e.ViewModel.GrpReportTotal.TempTotalCols.ContainsKey(o.ID)||(e.ViewModel.GrpReportTotal.TempTotalCols.push(o.ID,f.length-1),e.ViewModel.lstGroup.forEach((function(e){return e.TempTotalCols.push(o.ID,f.length-1)})))}if(e.DimWiseRepeatValue){var s=e.ViewModel.ColumnSource[y+1].Clone();s.HeaderText=s.HeaderText+"\n"+t.Name.toString(),s.ID=s.ID+t.NodeID.toString(),f.push(s),e.ViewModel.GrpReportTotal.TempTotalCols.ContainsKey(s.ID)||(e.ViewModel.GrpReportTotal.TempTotalCols.push(s.ID,f.length-1),e.ViewModel.lstGroup.forEach((function(e){return e.TempTotalCols.push(s.ID,f.length-1)})))}if(e.DimWiseRepeatQty){var i=e.ViewModel.ColumnSource[O].Clone();i.HeaderText=i.HeaderText+"\n"+t.Name.toString(),i.ID=i.ID+t.NodeID.toString(),f.push(i),e.ViewModel.GrpReportTotal.TempTotalCols.ContainsKey(i.ID)||(e.ViewModel.GrpReportTotal.TempTotalCols.push(i.ID,f.length-1),e.ViewModel.lstGroup.forEach((function(e){return e.TempTotalCols.push(i.ID,f.length-1)})))}if(e.DimWiseRepeatValue){var l=e.ViewModel.ColumnSource[O+1].Clone();l.HeaderText=l.HeaderText+"\n"+t.Name.toString(),l.ID=l.ID+t.NodeID.toString(),f.push(l),e.ViewModel.GrpReportTotal.TempTotalCols.ContainsKey(l.ID)||(e.ViewModel.GrpReportTotal.TempTotalCols.push(l.ID,f.length-1),e.ViewModel.lstGroup.forEach((function(e){return e.TempTotalCols.push(l.ID,f.length-1)})))}}if(e.DimWiseRepeatQty){var n=e.ViewModel.ColumnSource[b].Clone();n.HeaderText=n.HeaderText+"\r\n"+t.Name.toString(),n.ID=n.ID+t.NodeID.toString(),f.push(n),e.ViewModel.GrpReportTotal.TempTotalCols.ContainsKey(n.ID)||(e.ViewModel.GrpReportTotal.TempTotalCols.push(n.ID,f.length-1),e.ViewModel.lstGroup.forEach((function(e){e.TempTotalCols.push(n.ID,f.length-1)})))}if(e.DimWiseRepeatRate){var a=e.ViewModel.ColumnSource[b+1].Clone();a.HeaderText=a.HeaderText+"\r\n"+t.Name.toString(),a.ID=a.ID+t.NodeID.toString(),f.push(a),e.ViewModel.GrpReportTotal.TempTotalCols.ContainsKey(a.ID)||(e.ViewModel.GrpReportTotal.TempTotalCols.push(a.ID,f.length-1),e.ViewModel.lstGroup.forEach((function(e){e.TempTotalCols.push(a.ID,f.length-1)})))}if(e.DimWiseRepeatValue){var r=e.ViewModel.ColumnSource[b+2].Clone();r.HeaderText=r.HeaderText+"\r\n"+t.Name.toString(),r.ID=r.ID+t.NodeID.toString(),f.push(r),e.ViewModel.GrpReportTotal.TempTotalCols.ContainsKey(r.ID)||(e.ViewModel.GrpReportTotal.TempTotalCols.push(r.ID,f.length-1),e.ViewModel.lstGroup.forEach((function(e){e.TempTotalCols.push(r.ID,f.length-1)})))}e.TagsList+=e.Show==u.TagWise?t.NodeID.toString()+",":'<R D="'+t.Tag.toString()+'"/>',++e.CountMonths})),this.TagsList=this.Show==u.TagWise?this.TagsList.TrimEnd(","):"<X>"+this.TagsList+"</X>"}this.IsMultipleUnits&&this.AddMultipleUnitCols(f),f.forEach((function(e){e.HeaderHeight<44&&(e.HeaderHeight=44)})),this.ViewModel.RefreshReportTotals(f),this.ViewModel.RefreshPostFilters(),this.oColumns=this.ViewModel.ReportColumns,this.ViewModel.IsTotalColsAdded=!0,this.lstTotal=new Array,this.lstTotal.push(new Array(this.oColumns.length).fill(0)),this.lstParents.push(new a.d(this.oColumns.length,this.ViewModel.RowHeight));var B=this.ViewModel.Preferences.ContainsKey("SalesDocs")?this.ViewModel.Preferences.SalesDocs:"";if(B.length>0){var F=this.GetDimensionFilterForStock("DCC.dcCCNID"),G="";this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?F+=" AND 1<>1":F+=" AND DCC.dcCCNID"+(this.ViewModel.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),F.length>0&&(G=" join COM_DocCCDATA DCC with(nolock) on D.InvDocDetailsID=DCC.InvDocDetailsID"),f.find((function(e){return"SaleQty"==e.ID}))&&(this.IsSaleQty=!0,this.ViewModel.SelectTag+=",(SELECT SUM(D.UOMConvertedQty*-D.VoucherType) FROM INV_DocDetails D WITH(NOLOCK)"+G+"\nWHERE D.ProductID=P.ProductID and D.CostCenterID IN("+B+") AND D.DocDate BETWEEN CONVERT(float,CONVERT(datetime,'"+this.ViewModel.FromDatePicker.Date.ToString("dd MMM yyyy")+"')) and CONVERT(float,CONVERT(datetime,'"+this.ViewModel.ToDatePicker.Date.ToString("dd MMM yyyy")+"')) AND D.StatusID=369"+F+") SaleQty"),f.find((function(e){return"SaleValue"==e.ID}))&&(this.IsSaleValue=!0,this.ViewModel.SelectTag+=",(SELECT SUM(D.StockValue*-D.VoucherType) FROM INV_DocDetails D WITH(NOLOCK)"+G+"\nWHERE D.ProductID=P.ProductID and D.CostCenterID IN("+B+") AND D.DocDate BETWEEN CONVERT(float,CONVERT(datetime,'"+this.ViewModel.FromDatePicker.Date.ToString("dd MMM yyyy")+"')) and CONVERT(float,CONVERT(datetime,'"+this.ViewModel.ToDatePicker.Date.ToString("dd MMM yyyy")+"')) AND D.StatusID=369"+F+") SaleValue")}this.ShowLevelTree?(I="SELECT P.ProductID,P.ProductCode,P.ProductName,P.lft,P.rgt,P.IsGroup,P.Depth"+this.ViewModel.SelectTag+this.MultipleUnitSelect,I+=" FROM INV_Product P WITH(NOLOCK)",I+=this.MultipleUnitJoin+this.ViewModel.FromTag+R,I+=" WHERE P.Depth>0 AND P.ProductTypeId<>6 AND P.ProductTypeId!=10",S.length>0&&(I+=" AND "+S),I+=this.GetProductWiseLocationWhere("P",!1),this.ViewModel.Preferences.ContainsKey("ShowAllProducts")&&"0"!=this.ViewModel.Preferences.ShowAllProducts||(I+=" AND (P.IsGroup=1 OR P.ProductID IN ("+this.GetUsedProductsQuery()+"))"),I+=" UNION ALL \nSELECT P.ProductID,P.ProductCode,P.ProductName,P.lft,P.rgt,P.IsGroup,P.Depth"+this.ViewModel.SelectTag,this.IsMultipleUnits&&(I+=",1 MaxConv,1 MinConv",this.ShowMultipleUnitNames&&(I+=",null,null")),I+=" FROM INV_Product P WITH(NOLOCK)"+this.ViewModel.FromTag+" WHERE P.IsGroup=1",I+=" Order By lft"):(I="SELECT P.ProductID,P.ProductCode,P.ProductName"+this.ViewModel.SelectTag+this.MultipleUnitSelect,I+=" FROM INV_Product P WITH(NOLOCK)",I+=this.MultipleUnitJoin+this.ViewModel.FromTag+R,I+=" WHERE P.IsGroup=0 AND P.ProductTypeId<>6 AND P.ProductTypeId!=10",S.length>0&&(I+=" AND "+S),I+=this.GetProductWiseLocationWhere("P",!1),this.ViewModel.Preferences.ContainsKey("ShowAllProducts")&&"0"!=this.ViewModel.Preferences.ShowAllProducts||(I+=" AND P.ProductID IN ("+this.GetUsedProductsQuery()+")"),I+="Code"==this.ViewModel.Preferences.TreeSortOn?" Order By P.ProductCode":"TreeOrder"==this.ViewModel.Preferences.TreeSortOn?" Order By P.lft":" Order By P.ProductName")}else if(2==this.ViewModel.ReportGroups.length){3==this.ViewModel.ReportGroups[0].CDGDO.ColumnCostCenterID?(this.ProductGroupFirst=!0,this.ViewModel.ReportGroups[1].CDGDO.ColumnCostCenterID>5e4&&(this.TagID=this.ViewModel.ReportGroups[1].CDGDO.ColumnCostCenterID)):(this.ProductGroupFirst=!1,this.ViewModel.ReportGroups[0].CDGDO.ColumnCostCenterID>5e4&&(this.TagID=this.ViewModel.ReportGroups[0].CDGDO.ColumnCostCenterID)),I="SELECT P.ProductID,DCC.dcCCNID"+(this.TagID-5e4)+" TagID,max(P.ProductCode) ProductCode,max(P.ProductName) ProductName",I+=this.ViewModel.GroupSelectTag+this.MultipleUnitSelect,"TreeOrder"==this.ViewModel.Preferences.TreeSortOn&&(I+=",max(P.lft) lft"),I+=" FROM INV_Product P WITH(NOLOCK)",I+=this.MultipleUnitJoin+this.ViewModel.FromTag;var x="";if(50002==this.TagID&&this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(x=i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID"+(this.TagID-5e4)+" IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),""==x){var W=this.ViewModel.oReportDialog.CostCenterFilters.find((function(t){return t.CostCenterID==e.TagID}));if(null!=W&&W.SelectedNodes.length>0)if(1==W.SelectedNodes.length)x=" AND DCC.dcCCNID"+(this.TagID-5e4)+"="+W.SelectedNodes[0].Id;else{x=" AND DCC.dcCCNID"+(this.TagID-5e4)+" IN (";for(var k=0;k<W.SelectedNodes.length;k++)k>0&&(x+=","),x+=W.SelectedNodes[k].Id;x+=")"}}if(I+=" INNER JOIN Inv_DocDetails D WITH(NOLOCK) ON P.ProductID=D.ProductID AND D.IsQtyIgnored=0 INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID",I+=x,I+=R,I+=" WHERE P.IsGroup=0 AND P.ProductTypeId<>6 AND P.ProductTypeId!=10 and DCC.dcCCNID"+(this.TagID-5e4)+" is not null",S.length>0&&(I+=" AND "+S),I+=this.GetProductWiseLocationWhere("P",!1),I+=" GROUP BY P.ProductID,DCC.dcCCNID"+(this.TagID-5e4),this.ProductGroupFirst?I+="Code"==this.ViewModel.Preferences.TreeSortOn?" Order By ProductCode":"TreeOrder"==this.ViewModel.Preferences.TreeSortOn?" Order By lft":" Order By ProductName":(I+=" Order By ",I+="TagID,",I+="Code"==this.ViewModel.Preferences.TreeSortOn?"ProductCode":"TreeOrder"==this.ViewModel.Preferences.TreeSortOn?"lft":"ProductName"),this.TagID>0&&(I+="\r\n "+this.GetTagWiseQuery(this.TagID),this.ViewModel.ReportParams.ContainsKey("BinDimension")&&(I+="\r\n SELECT NodeID,Location,BinNodeID FROM [INV_ProductBins] WITH(NOLOCK)"+R,I+=" WHERE CostCenterID=3",R.length>0?I+=" AND NodeID=GTP.GTID ":S.length>0&&(I+=" AND "+S.Replace("P.ProductID","NodeID")),I+="\r\n SELECT Value FROM COM_CostCenterPreferences WITH(NOLOCK) WHERE CostCenterID=3 AND Name='BinsDimension'")),this.IsMultipleUnits){for(var U=new Array,K=0;K<this.ViewModel.ColumnSource.length;K++)U.push(this.ViewModel.ColumnSource[K]);this.AddMultipleUnitCols(U),this.ViewModel.RefreshReportTotals(U),this.ViewModel.RefreshPostFilters(),this.oColumns=this.ViewModel.ReportColumns,this.AggTotal=i.e.NumArray(this.oColumns.length,2)}}}else if(16==this.ViewModel.StaticReportType){if(0==this.ViewModel.ReportGroups.length){for(var H=new Array,Q=0;Q<this.ViewModel.ColumnSource.length;Q++)H.push(this.ViewModel.ColumnSource[Q]);if(this.IsMultipleUnits&&this.AddMultipleUnitCols(H),this.TagWiseColStart=H.length,this.Show==u.TagWise){if(this.DimWiseRepeatQty=!0,this.RepeatCols=1,this.ViewModel.Preferences.ContainsKey("DimensionWiseRepeat")){var j=this.ViewModel.Preferences.DimensionWiseRepeat.split(",");j.Contains("ReserveQty")&&(this.DimWiseRepeatReserveQty=!0,this.RepeatCols++),j.Contains("HoldQty")&&(this.DimWiseRepeatHoldQty=!0,this.RepeatCols++)}var Y=this.ViewModel.ColumnSource.indexOf(this.ViewModel.ColumnSource.find((function(e){return"BalQty"==e.ID})));this.TagsList="";var X=this.GetTagWiseQuery(this.TagID,this.TagColumnName,"Name");s.a.report.DataSet("RPT022",X).Tables[0].forEach((function(t){var o=e.ViewModel.ColumnSource[Y].Clone();o.HeaderText=o.HeaderText+"\r\n"+t.Name.toString(),o.ID=o.ID+t.NodeID.toString(),H.push(o),e.ViewModel.GrpReportTotal.TempTotalCols.ContainsKey(o.ID)||(e.ViewModel.GrpReportTotal.TempTotalCols.push(o.ID,H.length-1),e.ViewModel.lstGroup.forEach((function(e){e.TempTotalCols.push(o.ID,H.length-1)}))),e.DimWiseRepeatReserveQty&&((o=e.ViewModel.ColumnSource[Y].Clone()).HeaderText="Reserve Qty\r\n"+t.Name.toString(),o.ID="ReserveQty"+t.NodeID.toString(),H.push(o),e.ViewModel.GrpReportTotal.TempTotalCols.ContainsKey(o.ID)||(e.ViewModel.GrpReportTotal.TempTotalCols.push(o.ID,H.length-1),e.ViewModel.lstGroup.forEach((function(e){e.TempTotalCols.push(o.ID,H.length-1)})))),e.DimWiseRepeatHoldQty&&((o=e.ViewModel.ColumnSource[Y].Clone()).HeaderText="Hold Qty\r\n"+t.Name.toString(),o.ID="HoldQty"+t.NodeID.toString(),H.push(o),e.ViewModel.GrpReportTotal.TempTotalCols.ContainsKey(o.ID)||(e.ViewModel.GrpReportTotal.TempTotalCols.push(o.ID,H.length-1),e.ViewModel.lstGroup.forEach((function(e){e.TempTotalCols.push(o.ID,H.length-1)})))),e.TagsList+=t.NodeID.toString()+",",++e.CountMonths})),H.forEach((function(e){e.HeaderHeight<44&&(e.HeaderHeight=44)})),this.TagsList.length>0&&(this.TagsList=this.TagsList.TrimEnd(","))}this.ViewModel.RefreshReportTotals(H),H.length<50&&this.ViewModel.RefreshPostFilters(),this.oColumns=this.ViewModel.ReportColumns,this.ViewModel.IsTotalColsAdded=!0,this.lstTotal=new Array,this.lstTotal.push(new Array(this.oColumns.length).fill(0)),this.lstParents.push(new a.d(this.oColumns.length,this.ViewModel.RowHeight)),this.ShowLevelTree?(I="SELECT P.ProductID,P.ProductCode,P.ProductName,P.lft,P.rgt,P.IsGroup,P.Depth"+this.ViewModel.SelectTag+this.MultipleUnitSelect,I+=" FROM INV_Product P WITH(NOLOCK)",I+=this.MultipleUnitJoin+this.ViewModel.FromTag+R,I+=" WHERE P.Depth>0 AND P.ProductTypeId<>6 AND P.ProductTypeId!=10",S.length>0&&(I+=" AND "+S),I+=this.GetProductWiseLocationWhere("P",!1),I+=" and  P.IsGroup=0 AND P.ProductID IN ("+this.GetUsedProductsQuery()+")",I+="\nUNION all\nSELECT P.ProductID,P.ProductCode,P.ProductName,P.lft,P.rgt,P.IsGroup,P.Depth"+this.ViewModel.SelectTag,this.IsMultipleUnits&&(I+=",1 MaxConv,1 MinConv",this.ShowMultipleUnitNames&&(I+=",null,null")),I+=" FROM INV_Product P WITH(NOLOCK)"+this.ViewModel.FromTag+" WHERE P.IsGroup=1",I+=" Order By lft"):(I="SELECT P.ProductID,P.ProductCode,P.ProductName"+this.ViewModel.SelectTag+this.MultipleUnitSelect,I+=" FROM INV_Product P WITH(NOLOCK)",I+=this.MultipleUnitJoin+this.ViewModel.FromTag+R,I+=" WHERE P.IsGroup=0 AND P.ProductTypeId<>6 AND P.ProductTypeId!=10",S.length>0&&(I+=" AND "+S),I+=this.GetProductWiseLocationWhere("P",!1),this.ShowProductsWithoutTransactions||(I+=" AND P.ProductID IN ("+this.GetUsedProductsQuery()+")"),I+="Code"==this.ViewModel.Preferences.TreeSortOn?" Order By P.ProductCode":"TreeOrder"==this.ViewModel.Preferences.TreeSortOn?" Order By P.lft":" Order By P.ProductName")}else if(2==this.ViewModel.ReportGroups.length&&(this.Show=u.None,3==this.ViewModel.ReportGroups[0].CDGDO.ColumnCostCenterID?(this.ProductGroupFirst=!0,this.ViewModel.ReportGroups[1].CDGDO.ColumnCostCenterID>5e4&&(this.TagID=this.ViewModel.ReportGroups[1].CDGDO.ColumnCostCenterID)):(this.ProductGroupFirst=!1,this.ViewModel.ReportGroups[0].CDGDO.ColumnCostCenterID>5e4&&(this.TagID=this.ViewModel.ReportGroups[0].CDGDO.ColumnCostCenterID)),I="SELECT P.ProductID,P.ProductCode,P.ProductName"+this.ViewModel.SelectTag+this.MultipleUnitSelect,I+=" FROM INV_Product P WITH(NOLOCK)",I+=this.MultipleUnitJoin+this.ViewModel.FromTag+R,I+=" WHERE P.IsGroup=0 AND P.ProductTypeId<>6 AND P.ProductTypeId!=10",S.length>0&&(I+=" AND "+S),I+=this.GetProductWiseLocationWhere("P",!1),this.ShowProductsWithoutTransactions||(I+=" AND P.ProductID IN (SELECT ProductID FROM Inv_DocDetails WITH(NOLOCK) WHERE (VoucherType=1 OR VoucherType=-1) AND IsQtyIgnored=0 GROUP BY ProductID)"),I+="Code"==this.ViewModel.Preferences.TreeSortOn?" Order By P.ProductCode":"TreeOrder"==this.ViewModel.Preferences.TreeSortOn?" Order By P.lft":" Order By P.ProductName",this.TagID>0&&(I+="\r\n "+this.GetTagWiseQuery(this.TagID),this.ViewModel.ReportParams.ContainsKey("BinDimension")&&(I+="\r\n SELECT NodeID,Location,BinNodeID FROM [INV_ProductBins] WITH(NOLOCK)"+R,I+=" WHERE CostCenterID=3",R.length>0?I+=" AND NodeID=GTP.GTID ":S.length>0&&(I+=" AND "+S.Replace("P.ProductID","NodeID")),I+="\r\n SELECT Value FROM COM_CostCenterPreferences WITH(NOLOCK) WHERE CostCenterID=3 AND Name='BinsDimension'")),this.IsMultipleUnits)){for(var q=new Array,z=0;z<this.ViewModel.ColumnSource.length;z++)q.push(this.ViewModel.ColumnSource[z]);this.AddMultipleUnitCols(q),this.ViewModel.RefreshReportTotals(q),this.ViewModel.RefreshPostFilters(),this.oColumns=this.ViewModel.ReportColumns,this.AggTotal=i.e.NumArray(this.oColumns.length,2)}}else if(159==this.ViewModel.StaticReportType){this.lstTotal=new Array,this.lstTotal.push(new Array(this.oColumns.length).fill(0)),this.lstParents.push(new a.d(this.oColumns.length,this.ViewModel.RowHeight));var J=this.ViewModel.BaseReportColumns.find((function(e){return("Code"==e.ID||"Name"==e.ID)&&"1"==e.Visibility.SelectedValue}));if(J&&(this.TagID=J.CDGDO.CategoryValue>5e4?J.CDGDO.CategoryValue:J.CDGDO.ColumnCostCenterID),this.TagID<5e4)return void Logger.ErrorLog("LoadReport: Tag Column Not Found");if(this.TagTableName=o.GetTagTableName(this.TagID),I="SELECT T.NodeID,T.Code,T.Name"+this.ViewModel.SelectTag+" FROM "+this.TagTableName+" T WITH(NOLOCK)"+this.ViewModel.FromTag,I+=" WHERE T.IsGroup=0",!this.ViewModel.HideCostCenterTree){var Z=this.ViewModel.oReportDialog.CostCenterFilters.find((function(t){return t.CostCenterID==e.TagID}));if(null!=Z){var $="";Z.SelectedNodes.forEach((function(e){$+=e.Id+","})),$.length>0&&(I+=" AND T.NodeID IN ("+($=$.Remove($.length-1,1)).toString()+")")}}var ee=null;this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(ee=i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?"-1":this.ViewModel.oReportDialog.LocationWhere,this.TagID==this.ViewModel.oReportDialog.Locations.DBColumnID&&(I+=" AND T.NodeID IN ("+ee+")")),I+="Code"==this.ViewModel.Preferences.TreeSortOn?" Order By T.Code":"TreeOrder"==this.ViewModel.Preferences.TreeSortOn?" Order By T.lft":" Order By T.Name"}if(I.Contains("@CCWHERE@")){var te="";this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(te=i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?" AND dcCCNID"+(this.ViewModel.oReportDialog.Locations.DBColumnID-5e4)+" IN (-1)":" AND dcCCNID"+(this.ViewModel.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),I=I.Replace("@CCWHERE@",te)}s.a.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,I).then((function(t){if(e.dsMain=t,null!=e.Valuation){var a="Default",r=e.ViewModel.oReportDialog.DefaultProperties.find((function(e){return"ValuationMethod"==e.DBColumnName}));r&&(a=r.GetText()),e.dsMain.Tables[0].forEach((function(e){e.Valuation=a}))}e.ViewModel.ConstructFormulaFields(!1),e.ViewModel.FormulasCalculated=!1;new Date;if(13==e.ViewModel.StaticReportType){var h="";if(-1!=e.colGLCOGSIndex&&e.ViewModel.Preferences.ContainsKey("COGS")&&e.ViewModel.Preferences.COGS.length>0){var D=e.ViewModel.Preferences.COGS;h=",case when D.VoucherType=-1 or D.DocumentType=6 then (select top 1 sum(Dr)-sum(Cr) Bal from (\n        select sum(Amount) Dr,0 Cr from Acc_docDetails COGSD with(nolock) where COGSD.InvDocDetailsID=D.InvDocDetailsID and COGSD.DebitAccount"+(D=D.Contains(",")?" in ("+D+")":"="+D)+"\n        union all\n        select 0 Dr,sum(Amount) Cr from Acc_docDetails COGSD with(nolock) where COGSD.InvDocDetailsID=D.InvDocDetailsID and COGSD.CreditAccount"+D+")AS T) else null end GLCOGS",e.ViewModel.ReportColumns.find((function(e){return"GLCOGSAccount"==e.ID}))&&(h+=",case when D.VoucherType=-1 or D.DocumentType=6 then (\n        select AccountName from ACC_accounts with(nolock) where AccountID IN (\n        select top 1 AccountID from (\n        select COGSD.DebitAccount AccountID from Acc_docDetails COGSD with(nolock) where COGSD.InvDocDetailsID=D.InvDocDetailsID and COGSD.DebitAccount"+D+"\n        union all\n        select COGSD.CreditAccount from Acc_docDetails COGSD with(nolock) where COGSD.InvDocDetailsID=D.InvDocDetailsID and COGSD.CreditAccount"+D+"\n        )AS T) ) else null end GLCOGSAccount"),e.IsReconcile&&(e.ViewModel.ButtonPost.Width="54",e.ViewModel.ButtonPost.GroupName="SLReconcile",e.ViewModel.ButtonPost.Label="Reconcile",e.ViewModel.ButtonPost.Visible=!0,h+=",D.CostCenterID,D.DocID")}else e.IsReconcile=!1;e.al=[],e.al.push(""),e.al.push(e.ViewModel.oReportDialog.StockDimensionID),e.ViewModel.oReportDialog.Locations.Visible&&null!=e.ViewModel.oReportDialog.LocationWhere?i.e.IsEmpty(e.ViewModel.oReportDialog.LocationWhere)?e.al.push(-1):e.al.push(e.ViewModel.oReportDialog.LocationWhere):e.al.push(null),e.al.push(e.GetDimensionFilterForStock("DCC.dcCCNID")),e.al.push(o.GetExcludeStockTransfer(e.ViewModel)),e.al.push(e.ViewModel.oReportDialog.FromDate.Date),e.al.push(e.ViewModel.oReportDialog.ToDate.Date),e.al.push(e.UnPostedDocsInclude),e.al.push(e.DefValuation),e.al.push(e.CurrencyType),e.al.push(e.ForeignCurrencyID),e.al.push(e.ViewModel.SelectTag+h),e.al.push(e.ViewModel.FromTag),e.al.push(e.SortTransactionsBy),e.al.push(s.a.SessionManager.UserID),e.al.push(s.a.SessionManager.LanguageID),e.dsMain.Columns[0].Contains(e.ViewModel.lstGroup[0].ID)||e.dsMain.Columns[0].push(e.ViewModel.lstGroup[0].ID),e.oColumns.forEach((function(t){33==t.ID.length&&e.dsMain.Columns[0].Contains(t.ID)&&e.ExtraColumns.push(t)})),e.SLCallBack()}else if(14==e.ViewModel.StaticReportType||15==e.ViewModel.StaticReportType)if(0==e.ViewModel.ReportGroups.length){if(e.al=[],e.al.push(""),e.al.push(e.TagID),e.al.push(e.TagsList),e.al.push(e.ViewModel.oReportDialog.StockDimensionID),e.ViewModel.oReportDialog.Locations.Visible&&null!=e.ViewModel.oReportDialog.LocationWhere?i.e.IsEmpty(e.ViewModel.oReportDialog.LocationWhere)?e.al.push(-1):e.al.push(e.ViewModel.oReportDialog.LocationWhere):e.al.push(null),e.al.push(e.GetDimensionFilterForStock("DCC.dcCCNID")),e.al.push(o.GetExcludeStockTransfer(e.ViewModel)),14==e.ViewModel.StaticReportType&&e.al.push(e.ViewModel.oReportDialog.FromDate.Date),e.al.push(e.ViewModel.oReportDialog.ToDate.Date),e.al.push(e.UnPostedDocsInclude),e.al.push(e.DefValuation),15==e.ViewModel.StaticReportType){var d=i.e.Int(s.a.SessionManager.Preferences["Maintain Dimensionwise AverageRate"]);e.al.push(e.Show==u.TagWise?1:0),e.al.push(e.Show==u.TagWise&&!e.DimWiseRepeatRate&&!e.DimWiseRepeatValue||0==d)}e.al.push(n),e.al.push(n.length>0?e.GetPriceFilter():""),e.al.push(e.CurrencyType),e.al.push(e.ForeignCurrencyID),e.al.push(e.SortTransactionsBy),e.al.push(s.a.SessionManager.UserID),e.al.push(s.a.SessionManager.LanguageID),e.oColumns.forEach((function(t){33==t.ID.length&&e.dsMain.Columns[0].Contains(t.ID)&&e.ExtraColumns.push(t)})),e.SV0CallBack()}else{if(e.ViewModel.ReportParams.ContainsKey("BinDimension")&&e.dsMain.Tables[3].length>0){var C=i.e.Int(e.dsMain.Tables[3][0].Value);if(C>0){o.GetTagTableName(C);var p=s.a.report.ReportDataSet("RPT022",e.ViewModel.IsReportDB,"SELECT NodeID,Name FROM "+o.GetTagTableName(C)+" with(nolock) where IsGroup=0 ");p.Tables.length>0&&p.Columns[0].Contains("Name")&&(e.dtBins=p.Tables[0])}}var T=[];if(T.push(""),T.push(e.TagID),T.push(""),T.push(e.ViewModel.oReportDialog.StockDimensionID),e.ViewModel.oReportDialog.Locations.Visible&&null!=e.ViewModel.oReportDialog.LocationWhere?i.e.IsEmpty(e.ViewModel.oReportDialog.LocationWhere)?T.push(-1):T.push(e.ViewModel.oReportDialog.LocationWhere):T.push(null),T.push(e.GetDimensionFilterForStock("DCC.dcCCNID")),T.push(o.GetExcludeStockTransfer(e.ViewModel)),14==e.ViewModel.StaticReportType&&T.push(e.ViewModel.oReportDialog.FromDate.Date),T.push(e.ViewModel.oReportDialog.ToDate.Date),T.push(e.UnPostedDocsInclude),T.push(e.DefValuation),15==e.ViewModel.StaticReportType&&T.push(e.Show==u.TagWise?1:0),14==e.ViewModel.StaticReportType&&(T.push(n),T.push(n.length>0?e.GetPriceFilter():"")),T.push(e.CurrencyType),T.push(e.ForeignCurrencyID),T.push(e.SortTransactionsBy),T.push(s.a.SessionManager.UserID),T.push(s.a.SessionManager.LanguageID),0==e.dsMain.Tables[0].length||0==e.dsMain.Tables[1].length)return;e.dsMerge=null,e.R=0,e.SV1CallBack()}else if(16==e.ViewModel.StaticReportType)e.GetStockListQuery(R,S).then((function(t){if(e.ds=t,new Date,0==e.ViewModel.ReportGroups.length){if(e.oColumns.forEach((function(t){33==t.ID.length&&e.dsMain.Columns[0].Contains(t.ID)&&e.ExtraColumns.push(t)})),e.ExtraColumns.forEach((function(t){e.dsMain.Columns[0].Contains(t.ID),e.ds.Columns[0].push(t.ID)})),e.Show==u.TagWise){for(var n=new Array,a=!1,r=function(t){e.ds.Columns[0].push(e.oColumns[t].ID),e.oColumns[t].ID.startsWith("BalQty")&&e.HideEmptyDimensions&&0==e.ds.Tables[0].filter((function(o){return o.TagID==e.oColumns[t].ID.Replace("BalQty","")})).length&&(e.oColumns[t].HeaderAppearance.IsVisible=!1,a=!0)},h=e.TagWiseColStart;h<e.oColumns.length;h++)r(h);a&&(e.oColumns.forEach((function(e){n.push(e)})),e.ViewModel.ReportColumns=n)}e.ds.Columns[0].Contains("BalQty_Max")||(e.ds.Columns[0].push("BalQty_Max"),e.ds.Columns[0].push("BalQty_Min")),e.DataSetCollection.push(e.ds),e.dsSource=e.dsMain.Tables[0].length-e.ds.Tables[0].length>1e4&&e.ShowProductsWithoutTransactions?{Tables:[],Columns:e.ds.Columns.Copy()}:e.ds;for(var D=0;D<e.dsMain.Tables[0].length;D++)if(e.drMain=e.dsMain.Tables[0][D],e.strProductID=e.drMain[e.dsMain.Columns[0][0]].toString(),e.ShowLevelTree&&Object(l.j)(e.drMain.IsGroup))e.drRecord={},e.drRecord.ProductCode=e.drMain.ProductCode.toString(),e.drRecord.ProductName=e.drMain.ProductName.toString(),e.ExtraColumns.forEach((function(t){e.drRecord[t.ID]=e.drMain[t.ID]})),e.addStockList(!1);else{if(e.drr=e.dsSource.Tables[0].filter((function(t){return t.ProductID==e.strProductID})),0==e.drr.length&&e.ShowProductsWithoutTransactions){var d={};d.ProductID=e.strProductID,d.ProductCode=e.drMain.ProductCode.toString(),d.ProductName=e.drMain.ProductName.toString(),e.ds.Tables[0].push(d),e.drr=[d]}if(e.drr.length>0){for(var C=new Array,p=0;p<e.drr.length;p++){if(e.dblBalQty=e.GetAbsoluteQty(e.drr[p].BalQty),0==e.dblBalQty){if(!e.Display_Zero)continue}else if(e.dblBalQty>=0){if(!e.Display_Positive)continue}else if(!e.Display_Negative)continue;C.push(e.drr[p])}if(e.drr=C,0==e.drr.length)continue;e.drRecord=e.drr[0],e.ExtraColumns.forEach((function(t){i.e.IsEmpty(e.drMain[t.ID])||(e.drr[0][t.ID]=e.drMain[t.ID])})),e.IsMultipleUnits&&(e.dblMaxConv=parseFloat(e.drMain.MaxConv),e.dblMinConv=parseFloat(e.drMain.MinConv),e.MultipleUnitType==c.Max?e.drRecord.BalQty_Max=e.dblBalQty/e.dblMaxConv:e.MultipleUnitType==c.Min?e.drRecord.BalQty_Min=e.dblBalQty/e.dblMinConv:e.dblBalQty>=0?(e.drRecord.BalQty_Max=Math.floor(e.dblBalQty/e.dblMaxConv),e.drRecord.BalQty_Min=Math.floor(e.dblBalQty%e.dblMaxConv/e.dblMinConv)):(e.drRecord.BalQty_Max=Math.ceil(e.dblBalQty/e.dblMaxConv),e.drRecord.BalQty_Min=Math.ceil(e.dblBalQty%e.dblMaxConv/e.dblMinConv))),e.addStockList(!1),e.Show==u.TagWise&&(e.drRecord.TagID=null)}}if(e.AddReportTotal_StockMovement(),50==e.LevelNo)for(var T=e.ViewModel.Data.length-1;T>=0;T--)e.ViewModel.Data[T].Visible||e.ViewModel.Data[T].IsGroup||e.ViewModel.Data.RemoveAt(T);e.LoadReportComplete()}else{if(e.ViewModel.ReportParams.ContainsKey("BinDimension")&&e.dsMain.Tables[3].length>0){var _=i.e.Int(e.dsMain.Tables[3][0].Value);if(_>0){o.GetTagTableName(_);var m=s.a.report.ReportDataSet("RPT022",e.ViewModel.IsReportDB,"SELECT NodeID,Name FROM "+o.GetTagTableName(_)+" with(nolock) where IsGroup=0 ");m.Tables.length>0&&m.Columns[0].Contains("Name")&&(e.dtBins=m.Tables[0])}}var I,R;if(e.ProductGroupFirst?(I=e.dsMain.Tables[0],R=e.dsMain.Tables[1]):(I=e.dsMain.Tables[1],R=e.dsMain.Tables[0]),0==I.length||0==R.length)return;e.dsMerge=null,e.R=0,e.ds.Columns[0].push(e.ViewModel.ReportGroups[0].ID),e.ds.Columns[0].push(e.ViewModel.ReportGroups[1].ID),null!=e.dtBins&&e.ds.Columns[0].push(e.ViewModel.ReportParams.BinDimension),e.dsMain.Columns[0].forEach((function(t){e.ds.Columns[0].Contains(t)||e.ds.Columns[0].push(t)})),e.IsMultipleUnits&&!e.ds.Columns[0].Contains("BalQty_Max")&&(e.ds.Columns[0].push("BalQty_Max"),e.ds.Columns[0].push("BalQty_Min")),null==e.dsMerge?e.dsMerge=e.ds:e.dsMerge.Merge(e.ds),e.DataSetCollection.push(e.ds),e.RenderData(e.dsMerge.Tables[0]),e.ViewModel.CheckAndAddTotals(e.dsMerge.Tables[0]),e.LoadReportComplete()}}));else if(159==e.ViewModel.StaticReportType){e.al=[],e.al.push(0),e.al.push(""),e.al.push(e.TagID),e.al.push(" inner join com_docccdata DCC with(nolock) on DCC.InvDocDetailsID=D.InvDocDetailsID");var _="";if(!e.ViewModel.HideCostCenterTree){var m=e.ViewModel.oReportDialog.CostCenterFilters.find((function(t){return t.CostCenterID==e.TagID}));if(null!=m){var I="";m.SelectedNodes.forEach((function(e){I+=e.Id+","})),I.length>0&&(I=I.Remove(I.length-1,1),_+=" AND DCC.DCCCNID"+(m.CostCenterID-5e4)+" IN ("+I.toString()+")")}}var A=null;e.ViewModel.oReportDialog.Locations.Visible&&null!=e.ViewModel.oReportDialog.LocationWhere&&(A=i.e.IsEmpty(e.ViewModel.oReportDialog.LocationWhere)?"-1":e.ViewModel.oReportDialog.LocationWhere,_+=" AND DCC.DCCCNID"+(e.ViewModel.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+A+")"),e.al.push(_),e.al.push(e.ViewModel.oReportDialog.FromDate.Date),e.al.push(e.ViewModel.oReportDialog.ToDate.Date),e.al.push(e.UnPostedDocsInclude),e.al.push(s.a.SessionManager.UserName),s.a.report.SetAvgRateTempTable(e.al,e.ViewModel.IsReportDB).then((function(t){if(e.TemporaryTableName=t.Tables.length>0&&t.Tables[0].length>0&&t.Columns[0].Contains("TABLENAME")?t.Tables[0][0].TABLENAME.toString():"",0==e.TemporaryTableName.length)return e.ViewModel.DisplayMessage="Setting Temporary Table Error.",void e.LoadReportComplete();e.al=[],e.al.push(e.TemporaryTableName),e.al.push(e.TagID),e.al.push(""),e.al.push(e.ViewModel.oReportDialog.StockDimensionID),e.ViewModel.oReportDialog.Locations.Visible&&null!=e.ViewModel.oReportDialog.LocationWhere?i.e.IsEmpty(e.ViewModel.oReportDialog.LocationWhere)?e.al.push(-1):e.al.push(e.ViewModel.oReportDialog.LocationWhere):e.al.push(null),e.al.push(e.ViewModel.oReportDialog.ToDate.Date),e.al.push(e.DefValuation),e.al.push(s.a.SessionManager.LanguageID),e.oColumns.forEach((function(t){33==t.ID.length&&e.dsMain.Columns[0].Contains(t.ID)&&e.ExtraColumns.push(t)})),e.SBCallBack()}))}}))}catch(oe){Logger.ErrorLog("INV_StockLedger:: LoadReport",oe)}}},{key:"LoadReportComplete",value:function(){this.TemporaryTableName.length>0&&s.a.report.ReportDataSet("RPT022",this.ViewModel.IsReportDB,"USE PACT2C\n            IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].["+this.TemporaryTableName+"]') AND type in (N'U'))\nDROP TABLE "+this.TemporaryTableName+"\nDELETE FROM RPT_TempTables WHERE TempTableName='"+this.TemporaryTableName+"'"),this.ViewModel.FormulasCalculated=!0,this.ViewModel.process_RunWorkerCompleted()}},{key:"SLCallBack",value:function(){var e=this;if(this.iLoop>=this.dsMain.Tables[0].length)this.SLCallBack_Complete();else if(this.ViewModel.process.CancellationPending)this.ViewModel.processArgs.Cancel=!0;else{this.sbChunks="";for(var t=this.iLoop;t<this.dsMain.Tables[0].length&&t-this.iLoop<this.ChunkSize;t++)this.sbChunks.length>0&&(this.sbChunks+=","),this.sbChunks+=this.dsMain.Tables[0][t][this.dsMain.Columns[0][0]].toString();this.al[0]=this.sbChunks.toString(),s.a.report.GetStockLedger(this.al,this.ViewModel.IsReportDB).then((function(t){e.ds=t,e.DataSetCollection.push(e.ds),e.ExtraColumns.forEach((function(t){e.dsMain.Columns[0].Contains(t.ID),e.ds.Columns[0].push(t.ID)})),e.ds.Columns[0].Contains("BalanceQty")||(e.ds.Columns[0].push("BalanceQty"),e.ds.Columns[0].push("AvgRate"),e.ds.Columns[0].push("BalanceValue"),e.ds.Columns[0].push("COGS"),e.IsMultipleUnits&&(e.ds.Columns[0].push("BalanceQty_Max"),e.ds.Columns[0].push("BalanceQty_Min"))),e.dv=e.dvTable=e.ds.Tables[0],e.dvOpen=e.dvOpenTable=e.ds.Tables[1],e.dvOpenTrans=e.dvOpenTransTable=e.ds.Tables[2];for(var o=e.iLoop;o<e.dsMain.Tables[0].length&&o-e.iLoop<e.ChunkSize;o++)if(e.drMain=e.dsMain.Tables[0][o],e.strProductID=e.drMain[e.dsMain.Columns[0][0]].toString(),e.strProductName=e.drMain.ProductName.toString(),e.ValuationID=0==e.DefValuation?parseInt(e.drMain.ValuationID):e.DefValuation,e.IsMultipleUnits&&(e.dblMaxConv=parseFloat(e.drMain.MaxConv),e.dblMinConv=parseFloat(e.drMain.MinConv)),e.dv=e.dvTable.filter((function(t){return t.ProductID==e.strProductID})),e.dvOpen=e.dvOpenTable.filter((function(t){return t.ProductID==e.strProductID})),e.dvOpenTrans=e.dvOpenTransTable.filter((function(t){return t.ProductID==e.strProductID})),(0!=e.dv.length||e.ShowProductsWithoutTransactions)&&(e.dv.length>0||e.dvOpen.length>0)){if(0==e.dv.length&&e.dvOpen.length>0&&null!=e.dvOpen[0].OpQty&&0==parseFloat(e.dvOpen[0].OpQty))continue;e.ExtraColumns.forEach((function(t){for(e.k=0;e.k<e.dv.length;e.k++)e.dv[e.k][t.ID]=e.drMain[t.ID]})),e.addRows()}e.ViewModel.refreshDataView(),e.iLoop+=e.ChunkSize,e.SLCallBack()}),(function(t){e.LoadReportComplete()}))}}},{key:"SLCallBack_Complete",value:function(){var e=this;if(this.AddReportTotal(),this.IsReconcile){var t=this.ViewModel.Preferences.COGS;t=t.Contains(",")?" in ("+t+")":"="+t,this.sbChunks="",this.sbChunks+="DECLARE @From FLOAT,@To FLOAT\n        SET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))\n        SET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))\n        select VoucherNo,convert(datetime,DocDate) DocDate,sum(Dr)-sum(Cr) GLCOGS\n        from\n        (\n        select VoucherNo,DocDate,sum(Amount) Dr,0 Cr\n        from Acc_docDetails D with(nolock)\n        where D.InvDocDetailsID is null and  DocDate BETWEEN @From AND @To AND (D.DocumentType<>14 AND D.DocumentType<>19 AND (D.StatusID=369 or D.StatusID=429))\n        and D.DebitAccount"+t+"\n        group by VoucherNo,DocDate\n        union all\n        select VoucherNo,DocDate,0 Dr,sum(Amount) Cr from Acc_docDetails D with(nolock)\n        where D.InvDocDetailsID is null and  DocDate BETWEEN @From AND @To AND (D.DocumentType<>14 AND D.DocumentType<>19 AND (D.StatusID=369 or D.StatusID=429))\n        and D.CreditAccount"+t+"\n        group by VoucherNo,DocDate\n        ) AS T\n        group by VoucherNo,DocDate\n        order by DocDate,VoucherNo";var o=s.a.report.ReportDataTable("RPT022",this.ViewModel.IsReportDB,this.sbChunks);if(o.length>0){this.row=this.NewReportRow_2(a.f.Group,this.GrossTotalAppearance),this.row.LevelNo=1,this.row.Cells[0].ColSpan=this.row.Cells.length,this.row.Cells[0].Text="Non-Inventory Documents",this.ViewModel.addRow(this.row);var l=this.oColumns.find((function(e){return"VoucherNo"==e.ID})),n=null!=l?this.oColumns.indexOf(l):0,r=null!=(l=this.oColumns.find((function(e){return"DocDate"==e.ID})))?this.oColumns.indexOf(l):-1;this.AggTotal[this.colGLCOGSIndex][1]=0,this.AggTotal[this.colGLCOGSIndex][0]=0,o.forEach((function(t){e.row=e.NewReportRow(),e.dbl=i.e.Double(t.GLCOGS),e.AggTotal[e.colGLCOGSIndex][1]+=e.dbl,e.AggTotal[e.colGLCOGSIndex][0]+=e.dbl,-1!=r&&e.ViewModel.SetCellValue(t.DocDate,e.oColumns[r].DataFormat,e.oColumns[r].ColumnType,e.row.Cells[r]),e.ViewModel.SetCellValue(t.VoucherNo,e.oColumns[n].DataFormat,e.oColumns[n].ColumnType,e.row.Cells[n]),e.ViewModel.SetCellValue(t.GLCOGS,e.oColumns[e.colGLCOGSIndex].DataFormat,e.oColumns[e.colGLCOGSIndex].ColumnType,e.row.Cells[e.colGLCOGSIndex]),-1!=e.ViewModel.colSNoIndex&&(e.row.Cells[e.ViewModel.colSNoIndex].Value=++e.ViewModel.SNo,e.row.Cells[e.ViewModel.colSNoIndex].Text=e.ViewModel.SNo.toString()),e.ViewModel.addRow(e.row)})),this.row=this.NewReportRow_2(a.f.SubTotal,this.GrossTotalAppearance_Data),this.row.Cells[0].Text="Non-Inventory Documents Total",this.row.Cells[0].ColSpan=this.colGLCOGSIndex,this.row.Cells[0].CellAppearance.Alignment="Left",this.ViewModel.SetCellValue(this.AggTotal[this.colGLCOGSIndex][0],this.oColumns[this.colGLCOGSIndex].DataFormat,this.oColumns[this.colGLCOGSIndex].ColumnType,this.row.Cells[this.colGLCOGSIndex]),this.ViewModel.addRow(this.row)}}this.LoadReportComplete()}},{key:"SV0CallBack",value:function(){var e=this;if(this.iLoop>=this.dsMain.Tables[0].length)this.SV0CallBack_Complete();else if(this.ViewModel.process.CancellationPending)this.ViewModel.processArgs.Cancel=!0;else{this.sbChunks="";for(var t=this.iLoop;t<this.dsMain.Tables[0].length&&t-this.iLoop<this.ChunkSize;t++)this.ShowLevelTree&&Object(l.j)(this.dsMain.Tables[0][t].IsGroup)||(this.sbChunks.length>0&&(this.sbChunks+=","),this.sbChunks+=this.dsMain.Tables[0][t][this.dsMain.Columns[0][0]].toString());var o;0==this.sbChunks.length&&(0==this.DataSetCollection.length?this.sbChunks+=this.dsMain.Tables[0][this.iLoop][this.dsMain.Columns[0][0]].toString():(this.ds={Tables:[],Columns:this.DataSetCollection[this.DataSetCollection.length-1].Columns.Copy()},o=new Promise((function(t,o){t(e.ds)})))),this.sbChunks.length>0&&(this.al[0]=this.sbChunks.toString(),14==this.ViewModel.StaticReportType?o=s.a.report.GetStockMovement(this.al,this.ViewModel.IsReportDB):15==this.ViewModel.StaticReportType&&(o=s.a.report.GetStockValuation(this.al,this.ViewModel.IsReportDB))),o&&o.then((function(t){if(e.ds=t,e.ds.Columns[0].Contains("ProductCode")||(e.ds.Columns[0].push("ProductCode"),e.ds.Tables[0].push("ProductName")),e.ds.Columns[0].Contains("BalQty_Max")||(e.ds.Columns[0].push("BalQty_Max"),e.ds.Columns[0].push("BalQty_Min")),e.ExtraColumns.forEach((function(t){e.ds.Columns[0].Contains(t.ID)||(e.dsMain.Columns[0].Contains(t.ID),e.ds.Columns[0].push(t.ID))})),e.ViewModel.FormulaColumns.forEach((function(t){e.ds.Columns[0].Contains(t.ID)||e.ds.Columns[0].push(t.ID)})),e.lstPCRates.length>0&&e.ds.Columns[0].Contains("PCxml")){var o;e.lstPCRates.forEach((function(t){e.ds.Columns[0].Contains(t)||e.ds.Columns[0].push(t)}));for(var s=0;s<e.ds.Tables[0].length;s++){o=e.ds.Tables[0][s].PCxml.toString().split(",");for(var i=0;i<e.lstPCRates.length&&i<o.length;i++)e.ds.Tables[0][s][e.lstPCRates[i]]=o[i]}}if(e.IsSaleQty&&!e.ds.Columns[0].Contains("SaleQty")&&e.ds.Columns[0].push("SaleQty"),e.IsSaleValue&&!e.ds.Columns[0].Contains("SaleValue")&&e.ds.Columns[0].push("SaleValue"),e.Show!=u.None)for(var n=e.ViewModel.ColumnSource.length;n<e.oColumns.length;n++)e.ds.Columns[0].Contains(e.oColumns[n].ID)||e.ds.Columns[0].push(e.oColumns[n].ID);e.DataSetCollection.push(e.ds),e.dv=e.ds.Tables[0],e.dvTable=e.ds.Tables[0];for(var a=e.iLoop;a<e.dsMain.Tables[0].length&&a-e.iLoop<e.ChunkSize;a++)if(e.drMain=e.dsMain.Tables[0][a],e.strProductID=e.drMain[e.dsMain.Columns[0][0]].toString(),e.ShowLevelTree&&Object(l.j)(e.drMain.IsGroup))e.drRecord={},e.drRecord.ProductCode=e.drMain.ProductCode.toString(),e.drRecord.ProductName=e.drMain.ProductName.toString(),e.ExtraColumns.forEach((function(t){e.drRecord[t.ID]=e.drMain[t.ID]})),e.addStockMovement();else{if(e.dv=e.dvTable.filter((function(t){return t.ProductID==e.strProductID})),0==e.dv.length&&e.ShowProductsWithoutTransactions){var r={};r.ProductID=e.strProductID,e.ds.Tables[0].push(r)}if(e.dv.length>0){if(e.drRecord=e.dv[0],e.drRecord.ProductCode=e.drMain.ProductCode.toString(),e.drRecord.ProductName=e.drMain.ProductName.toString(),e.ExtraColumns.forEach((function(t){e.drRecord[t.ID]=e.drMain[t.ID]})),e.IsSaleQty&&(e.drRecord.SaleQty=e.drMain.SaleQty),e.IsSaleValue&&(e.drRecord.SaleValue=e.drMain.SaleValue),e.dblBalQty=e.GetAbsoluteQty(e.dv[0].BalQty),0==e.dblBalQty){if(!e.Display_Zero)continue}else if(e.dblBalQty>=0){if(!e.Display_Positive)continue}else if(!e.Display_Negative)continue;e.IsMultipleUnits&&(e.dblMaxConv=parseFloat(e.drMain.MaxConv),e.dblMinConv=parseFloat(e.drMain.MinConv)),e.addStockMovement()}}e.ViewModel.refreshDataView(),e.iLoop+=e.ChunkSize,e.SV0CallBack()}),(function(t){e.LoadReportComplete()}))}}},{key:"SV0CallBack_Complete",value:function(){this.AddReportTotal_StockMovement(),this.LoadReportComplete()}},{key:"SV1CallBack",value:function(){var e=this;if(this.iLoop>=this.dsMain.Tables[0].length)this.SV0CallBack_Complete();else if(this.ViewModel.process.CancellationPending)this.ViewModel.processArgs.Cancel=!0;else{this.sbChunks="";for(var t=this.iLoop;t<this.dsMain.Tables[0].length&&t-this.iLoop<this.ChunkSize;t++)this.sbChunks.length>0&&(this.sbChunks+=","),this.sbChunks+=this.dsMain.Tables[0][t].ProductID.toString()+"~"+this.dsMain.Tables[0][t].TagID.toString();var o;this.al[2]=this.sbChunks.toString(),14==this.ViewModel.StaticReportType?o=s.a.report.GetStockMovement(this.al,this.ViewModel.IsReportDB):15==this.ViewModel.StaticReportType&&(o=s.a.report.GetStockValuation2(this.al,this.ViewModel.IsReportDB)),o.then((function(t){e.ds=t,e.ds.Columns[0].push(e.ViewModel.ReportGroups[0].ID),e.ds.Columns[0].push(e.ViewModel.ReportGroups[1].ID),null!=e.dtBins&&e.ds.Columns[0].push(e.ViewModel.ReportParams.BinDimension),e.dsMain.Columns[0].forEach((function(t){e.ds.Columns[0].Contains(t)||e.ds.Columns[0].push(t)})),e.IsMultipleUnits&&!e.ds.Columns[0].Contains("BalQty_Max")&&(e.ds.Columns[0].push("BalQty_Max"),e.ds.Columns[0].push("BalQty_Min")),null==e.dsMerge?e.dsMerge=e.ds:e.dsMerge.Merge(e.ds),e.DataSetCollection.push(e.ds),e.RenderData(e.dsMerge.Tables[0]),e.ViewModel.refreshDataView(),e.iLoop+=e.ChunkSize,e.SV1CallBack()}),(function(t){e.LoadReportComplete()}))}}},{key:"SV1CallBack_Complete",value:function(){this.ViewModel.CheckAndAddTotals(this.dsMerge.Tables[0]),this.LoadReportComplete()}},{key:"SBCallBack",value:function(){var e=this;if(this.iLoop>=this.dsMain.Tables[0].length)this.SBCallBack_Complete();else if(this.ViewModel.process.CancellationPending)this.ViewModel.processArgs.Cancel=!0;else{this.sbChunks="";for(var t=this.iLoop;t<this.dsMain.Tables[0].length&&t-this.iLoop<this.ChunkSize;t++)this.ShowLevelTree&&Object(l.j)(this.dsMain.Tables[0][t].IsGroup)||(this.sbChunks.length>0&&(this.sbChunks+=","),this.sbChunks+=this.dsMain.Tables[0][t][this.dsMain.Columns[0][0]].toString());this.al[2]=this.sbChunks.toString(),s.a.report.GetStockBalancesTagWise(this.al,this.ViewModel.IsReportDB).then((function(t){e.ds=t,e.ds.Columns[0].push("Code"),e.ds.Columns[0].push("Name"),e.ExtraColumns.forEach((function(t){e.dsMain.Columns[0].Contains(t.ID),e.ds.Columns[0].push(t.ID)})),e.DataSetCollection.push(e.ds),e.dv=e.ds.Tables[0],e.dvTable=e.ds.Tables[0];for(var o=e.iLoop;o<e.dsMain.Tables[0].length&&o-e.iLoop<e.ChunkSize;o++)e.drMain=e.dsMain.Tables[0][o],e.strProductID=e.drMain[e.dsMain.Columns[0][0]].toString(),e.ShowLevelTree&&Object(l.j)(e.drMain.IsGroup)?(e.drRecord={},e.drRecord.Code=e.drMain.Code.toString(),e.drRecord.Name=e.drMain.Name.toString(),e.ExtraColumns.forEach((function(t){e.drRecord[t.ID]=e.drMain[t.ID]})),e.addStockMovement()):(e.dv=e.dvTable.filter((function(t){return t.TagID==e.strProductID})),e.dv.length>0&&(e.drRecord=e.dv[0],e.drRecord.Code=e.drMain.Code.toString(),e.drRecord.Name=e.drMain.Name.toString(),e.ExtraColumns.forEach((function(t){e.drRecord[t.ID]=e.drMain[t.ID]})),e.addStockMovement()));e.ViewModel.refreshDataView(),e.iLoop+=e.ChunkSize,e.SV1CallBack()}),(function(t){e.LoadReportComplete()}))}}},{key:"SBCallBack_Complete",value:function(){this.AddReportTotal_StockMovement(),this.LoadReportComplete()}},{key:"RefreshColumnIndexes",value:function(){for(var e=this.oColumns.length-1;e>=0;e--)"BalanceQty"==this.oColumns[e].ID||"BalQty"==this.oColumns[e].ID?this.colBalanceQtyIndex=e:"AvgRate"==this.oColumns[e].ID?this.colBalanceRateIndex=e:"BalanceValue"==this.oColumns[e].ID?this.colBalanceValueIndex=e:"COGS"==this.oColumns[e].ID?this.colCOGSIndex=e:"GLCOGS"==this.oColumns[e].ID?this.colGLCOGSIndex=e:0==i.e.stringCompare(this.oColumns[e].Formula,"SNO",!0)?this.ViewModel.colSNoIndex=e:"Valuation"==this.oColumns[e].ID&&(this.Valuation=this.oColumns[e],this.ExtraColumns.push(this.Valuation))}},{key:"SetMultipleUnitsQry",value:function(){var e=!1;14!=this.ViewModel.StaticReportType&&15!=this.ViewModel.StaticReportType||2!=this.ViewModel.ReportGroups.length||(e=!0),this.MultipleUnitSelect=this.MultipleUnitJoin="",e?this.IsMultipleUnits&&(this.MultipleUnitSelect=",max(MU.MaxConv) MaxConv,max(MU.MinConv) MinConv",this.ShowMultipleUnitNames&&(this.MultipleUnitSelect+=",max(MU.MaxUnit) C693051cdb2b34db6aca385c6aMaxUnit,max(MU.MinUnit) C693051cdb2b34db6aca385c6aMinUnit")):this.IsMultipleUnits&&(this.MultipleUnitSelect=",MU.MaxConv,MU.MinConv",this.ShowMultipleUnitNames&&(this.MultipleUnitSelect+=",MU.MaxUnit C693051cdb2b34db6aca385c6aMaxUnit,MU.MinUnit C693051cdb2b34db6aca385c6aMinUnit")),this.IsMultipleUnits&&(this.MultipleUnitJoin=this.ShowMultipleUnitNames?" inner join COM_UOM PU with(nolock) ON P.UOMID=PU.UOMID\ninner join (select BaseID,max(MaxUnit) MaxUnit,max(MaxConv) MaxConv,max(MinUnit) MinUnit,max(MinConv) MinConv from\n(\nselect X1.BaseID,X1.UnitName MaxUnit,XT1.MaxConv,null MinUnit,null MinConv from COM_UOM X1\njoin (select BaseID,max(Conversion) MaxConv from COM_UOM group by BaseID) as XT1 on XT1.BaseID=X1.BaseID and XT1.MaxConv=X1.Conversion\nunion all\nselect X1.BaseID,null MaxUnit,null MaxConv,X1.UnitName MinUnit,XT1.MinConv from COM_UOM X1\njoin (select BaseID,min(Conversion) MinConv from COM_UOM group by BaseID) as XT1 on XT1.BaseID=X1.BaseID and XT1.MinConv=X1.Conversion\n) AS MT\ngroup by BaseID\n) as MU on PU.BaseID=MU.BaseID":" inner join COM_UOM PU with(nolock) ON P.UOMID=PU.UOMID\ninner join (select BaseID,max(Conversion) MaxConv,min(Conversion) MinConv from COM_UOM group by BaseID) as MU on PU.BaseID=MU.BaseID")}},{key:"AddMultipleUnitCols",value:function(e){var t=this;try{var o=!1;13!=this.ViewModel.StaticReportType&&16!=this.ViewModel.StaticReportType||(o=!0);var s,i=0;this.MultipleUnitType!=c.Both&&this.MultipleUnitType!=c.Max||((s=this.ViewModel.ColumnSource[this.colBalanceQtyIndex].Clone()).HeaderText="Max. "+s.HeaderText,s.ID=s.ID+"_Max",o?(e.InsertAt(s,this.colBalanceQtyIndex+ ++i),this.colBalanceQtyMaxIndex=this.colBalanceQtyIndex+i,this.ViewModel.GrpReportTotal.TempTotalCols.ContainsKey(s.ID)||this.ViewModel.lstGroup.forEach((function(e){t.ViewModel.GrpReportTotal.TempTotalCols.Add(s.ID,t.colBalanceQtyMaxIndex),e.TempTotalCols.ContainsKey(s.ID)||e.TempTotalCols.push(s.ID,t.colBalanceQtyMaxIndex)}))):(e.push(s),this.colBalanceQtyMaxIndex=e.length,this.ViewModel.GrpReportTotal.TempTotalCols.ContainsKey(s.ID)||(this.ViewModel.GrpReportTotal.TempTotalCols.push(s.ID,e.length-1),this.ViewModel.lstGroup.forEach((function(t){t.TempTotalCols.ContainsKey(s.ID)||t.TempTotalCols.push(s.ID,e.length-1)})))),this.ShowMultipleUnitNames&&((s=this.ViewModel.ColumnSource[this.colBalanceQtyIndex].Clone()).ColumnType="",s.width=80,s.HeaderText="Max Unit",s.DataAppearance.Alignment="Left",s.ID="C693051cdb2b34db6aca385c6aMaxUnit",o?e.InsertAt(s,this.colBalanceQtyIndex+ ++i):e.push(s))),this.MultipleUnitType!=c.Both&&this.MultipleUnitType!=c.Min||((s=this.ViewModel.ColumnSource[this.colBalanceQtyIndex].Clone()).HeaderText="Min. "+s.HeaderText,s.ID=s.ID+"_Min",o?(e.InsertAt(s,this.colBalanceQtyIndex+ ++i),this.colBalanceQtyMinIndex=this.colBalanceQtyIndex+i,this.ViewModel.GrpReportTotal.TempTotalCols.ContainsKey(s.ID)||this.ViewModel.lstGroup.forEach((function(t){t.TempTotalCols.ContainsKey(s.ID)||t.TempTotalCols.push(s.ID,e.length-1)}))):(e.push(s),this.colBalanceQtyMinIndex=e.length,this.ViewModel.GrpReportTotal.TempTotalCols.ContainsKey(s.ID)||(this.ViewModel.GrpReportTotal.TempTotalCols.push(s.ID,e.length-1),this.ViewModel.lstGroup.forEach((function(t){t.TempTotalCols.ContainsKey(s.ID)||t.TempTotalCols.push(s.ID,e.length-1)})))),this.ShowMultipleUnitNames&&((s=this.ViewModel.ColumnSource[this.colBalanceQtyIndex].Clone()).ColumnType="",s.width=80,s.HeaderText="Min Unit",s.DataAppearance.Alignment="Left",s.ID="C693051cdb2b34db6aca385c6aMinUnit",o?e.InsertAt(s,this.colBalanceQtyIndex+ ++i):e.push(s)))}catch(l){}}},{key:"GetAbsoluteQty",value:function(e){var t=i.e.Double(e);return 0!=t&&Math.abs(t)<=1e-6&&(t=0),t}},{key:"LoadReportWithPostFilters",value:function(e){var t=this;if(this.GrdRow=-1,this.AggTotal=i.e.NumArray(this.oColumns.length,2),this.ViewModel.ClearRows(),null!=this.lstTotal&&(this.lstTotal.Clear(),this.lstParents.Clear(),this.lstParents.push(this.NewReportRow()),this.lstTotal.push(new Array(this.oColumns.length).fill(0))),13==this.ViewModel.StaticReportType){e.length>0&&(e=" AND "+e);for(var o=0,s=0;o<this.dsMain.Tables[0].length;o+=this.ChunkSize,s++){this.ds=this.DataSetCollection[s],this.dv=this.dvTable=this.ds.Tables[0],this.dvOpen=this.dvOpenTable=this.ds.Tables[1];for(var n=o;n<this.dsMain.Tables[0].length&&n-o<this.ChunkSize;n++)this.drMain=this.dsMain.Tables[0][n],this.strProductID=this.drMain[this.dsMain.Columns[0][0]].toString(),this.strProductName=this.drMain.ProductName.toString(),this.ValuationID=0==this.DefValuation?parseInt(this.drMain.ValuationID):this.DefValuation,this.dv=this.dvTable.filter((function(e){return e.ProductID==t.strProductID})),this.dvOpen=this.dvOpenTable.filter((function(e){return e.ProductID==t.strProductID})),this.dv=h.a.FilterData(this.dv,this.ViewModel.PostDataFetchFilterFields),this.dvOpen=h.a.FilterData(this.dvOpen,this.ViewModel.PostDataFetchFilterFields),(0!=this.dv.length||this.ShowProductsWithoutTransactions)&&(this.dv.length>0||this.dvOpen.length>0)&&this.addRows()}}else if(16==this.ViewModel.StaticReportType){e.length>0&&(e=" AND "+e),this.ds=this.DataSetCollection[0],this.dv=this.ds.Tables[0];for(var a=0;a<this.dsMain.Tables[0].length;a++)this.drMain=this.dsMain.Tables[0][a],this.strProductID=this.drMain[this.dsMain.Columns[0][0]].toString(),this.ShowLevelTree&&Object(l.j)(this.drMain.IsGroup)?(this.drRecord={},this.drRecord.ProductCode=this.drMain.ProductCode.toString(),this.drRecord.ProductName=this.drMain.ProductName.toString(),this.addStockList(!0)):(this.drr=this.ds.Tables[0].filter((function(e){return e.ProductID==t.strProductID})),this.drr=h.a.FilterData(this.drr,this.ViewModel.PostDataFetchFilterFields),this.drr.length>0&&(this.drRecord=this.drr[0],this.drRecord.ProductCode=this.drMain.ProductCode.toString(),this.drRecord.ProductName=this.drMain.ProductName.toString(),this.addStockList(!0)))}else for(var r=0,u=0;r<this.dsMain.Tables[0].length;r+=this.ChunkSize,u++){this.ds=this.DataSetCollection[u],this.dv=this.dvTable=this.ds.Tables[0];for(var c=r;c<this.dsMain.Tables[0].length&&c-r<this.ChunkSize;c++)this.drMain=this.dsMain.Tables[0][c],this.strProductID=this.drMain[this.dsMain.Columns[0][0]].toString(),this.ShowLevelTree&&Object(l.j)(this.drMain.IsGroup)?(this.drRecord={},this.drRecord.ProductCode=this.drMain.ProductCode.toString(),this.drRecord.ProductName=this.drMain.ProductName.toString(),this.addStockMovement()):(this.dv=this.dvTable.filter((function(e){return e.ProductID==t.strProductID})),this.dv=h.a.FilterData(this.dv,this.ViewModel.PostDataFetchFilterFields),this.dv.length>0&&(this.drRecord=this.dv[0],this.drRecord.ProductCode=this.drMain.ProductCode.toString(),this.drRecord.ProductName=this.drMain.ProductName.toString(),this.addStockMovement()))}13==this.ViewModel.StaticReportType?this.AddReportTotal():14!=this.ViewModel.StaticReportType&&15!=this.ViewModel.StaticReportType&&16!=this.ViewModel.StaticReportType||this.AddReportTotal_StockMovement(),this.ViewModel.process_RunWorkerCompleted()}},{key:"GetStockListQuery",value:function(e,t){var n=0;s.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&(n=i.e.Int(s.a.SessionManager.Preferences["Maintain Dimensionwise stock"])),0==n&&"True"==s.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==s.a.SessionManager.Preferences["LW Reports"]&&(n=50002),0==n&&(n=50002);var a,r,h="",c="",D="";this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(h=i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?"-1":this.ViewModel.oReportDialog.LocationWhere);var d=this.GetDimensionFilterForStock("DCC.dcCCNID");""==h&&""==d||(c=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID",""!=h&&(c+=" AND DCC.DCCCNID"+(n-5e4)+" IN ("+h+") "),""!=d&&(c+=d)),a=this.UnPostedDocsInclude?" AND D.StatusID<>376 and D.StatusID<>372":" AND D.StatusID=369",r=!i.e.IsEmpty(s.a.SessionManager.Preferences.ConsiderUnAppInHold)&&Object(l.j)(s.a.SessionManager.Preferences.ConsiderUnAppInHold)?" AND DX.StatusID in (371,441,369)":this.UnPostedDocsInclude?" AND DX.StatusID<>376 and DX.StatusID<>372":" AND DX.StatusID=369",this.ForeignCurrencyID>0&&(D=" AND D.CurrencyID="+this.ForeignCurrencyID);var C=o.GetExcludeStockTransfer(this.ViewModel),p="",T="",_="",m="";if(p+="DECLARE @TODATE FLOAT\nSET @TODATE=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",this.TagID>0){if(i.e.IsEmpty(this.TagsList)){this.TagsList="";for(var I=0;I<this.dsMain.Tables[1].length;I++)this.TagsList.length>0&&(this.TagsList+=","),this.TagsList+=this.dsMain.Tables[1][I][0].toString()}p+="\nDECLARE @TblTags AS TABLE(ID INT IDENTITY(1,1) NOT NULL,NodeID BIGINT)\nINSERT INTO @TblTags(NodeID)\nEXEC SPSplitString '"+this.TagsList+"',','",0==c.length&&(c=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID"),T=",T.NodeID AS TagID",_="INNER JOIN @TblTags T ON DCC.DCCCNID"+(this.TagID-5e4)+"=T.NodeID ",m=",T.NodeID"}var R="",S="",A="",M="",g="",w="",f=this.ViewModel.BaseReportColumns.find((function(e){return 26419==e.CDGDO.FieldValue})),E=this.ViewModel.BaseReportColumns.find((function(e){return 26420==e.CDGDO.FieldValue}));(this.DimWiseRepeatReserveQty&&this.Show==u.TagWise||null!=E&&this.TagID>0&&this.Show!=u.TagWise)&&(g="case when D.IsQtyIgnored=1 then -D.ReserveQuantity+(select case when release>D.ReserveQuantity then D.ReserveQuantity else release end from (\nSELECT isnull(sum(case when DCCXL.InvDocDetailsID is not null and "+(i.e.IsEmpty(s.a.SessionManager.Preferences.HoldResCancelledDocs)?"l.IsQtyIgnored=0":"(l.IsQtyIgnored=0 or l.Costcenterid in("+s.a.SessionManager.Preferences.HoldResCancelledDocs+"))")+" then l.UOMConvertedQty when DCCXL.InvDocDetailsID is not null THEN l.ReserveQuantity else 0 end),0) release\nFROM INV_DocDetails l WITH(NOLOCK)\nleft JOIN COM_DocCCData DCCXL WITH(NOLOCK)  ON DCCXL.InvDocDetailsID=l.InvDocDetailsID AND DCCXL.dcCCNID"+(this.TagID-5e4)+"=DCC.dcCCNID"+(this.TagID-5e4)+"\nwhere D.InvDocDetailsID=l.LinkedInvDocDetailsID and l.DocDate<=@TODATE\n) as T )\nelse 0 end");if(g.length>0){this.ExcludeReserveQty&&(M="+"+g);var P=E.ID;this.DimWiseRepeatReserveQty&&this.Show==u.TagWise&&(P="ReserveQty"),p+="\nselect ProductID,MAX(ProductName) ProductName,MAX(ProductCode) ProductCode,TagID,sum(BalQty) BalQty,sum(abs("+P+")) "+P+"\nFROM (\nselect P.ProductID,P.ProductName,ProductCode"+T+",case when ReserveQuantity=0 then ISNULL(D.UOMConvertedQty*D.VoucherType,0) else 0 end"+M+" BalQty,"+g+" "+P+"\nFROM INV_DocDetails D WITH(NOLOCK)"+c+"\nINNER JOIN INV_Product P WITH(NOLOCK) ON P.ProductID=D.ProductID\n"+_+e+"\nWHERE D.ProductID=P.ProductID AND (D.VoucherType=1 OR D.VoucherType=-1)",p+=" AND (D.IsQtyIgnored=0 or (D.ReserveQuantity>0 and D.IsQtyIgnored=1 and D.VoucherType=-1  and D.DocumentType in (7,9,11,12,24)))",p+=" AND D.DocDate<=@TODATE"+a+D+C,p+=" AND P.ProductTypeId<>6 AND P.ProductTypeId!=10",t.length>0&&(p+=" AND "+t),p+=") AS T\nGROUP BY ProductID,TagID",this.HideEmptyDimensions&&this.Show==u.TagWise&&(p+=" having sum(BalQty)!=0 or sum("+P+")!=0"),m.length>0&&(m=",TagID",p+=this.ProductGroupFirst?" Order BY ProductID"+m:" Order BY "+m.Trim(",")+",ProductID")}else{var y=this.ViewModel.BaseReportColumns.find((function(e){return 148==e.CDGDO.FieldValue}));null!=y&&(R=",STUFF(\n(select ', '+B.BatchNumber+'-'+convert(nvarchar,sum(D.Quantity*D.VoucherType))\nfrom INV_DocDetails D with(nolock)"+c+"\ninner join INV_Batches B with(nolock) on B.BatchID=D.BatchID \nwhere D.ProductID=P.ProductID and D.IsQtyIgnored=0 and D.BatchID>1 and D.DocDate<=@TODATE"+a+D+C+"\ngroup by B.BatchNumber \nhaving sum(Quantity*VoucherType)>0\nFOR XML PATH('')\n)\n,1,2,'') as ["+y.ID+"]");var O=this.ViewModel.BaseReportColumns.find((function(e){return 181==e.CDGDO.FieldValue}));if(null!=O){var b="Code"==O.CDGDO.Column?"Code":"Name";S=",STUFF(\n(select ', '+B."+b,"2"!=O.FormulaEvaluateAtEnd.SelectedValue&&(S+="+'-'+convert(nvarchar,sum(BD.Quantity*D.VoucherType))"),S+=" \nfrom INV_DocDetails D with(nolock)"+c+"\ninner join INV_BinDetails BD with(nolock) on BD.InvDocDetailsID=D.InvDocDetailsID \ninner join "+O.CDGDO.ParentCostCenterSysName+" B with(nolock) ON B.NodeID=BD.BinID\nwhere D.ProductID=P.ProductID and D.IsQtyIgnored=0 and D.DocDate<=@TODATE"+a+D+C,_.length>0&&this.Show!=u.TagWise&&(S+=" and DCC.DCCCNID"+(this.TagID-5e4)+"=T.NodeID"),S+=" group by B."+b+" \nhaving sum(BD.Quantity*D.VoucherType)>0\nFOR XML PATH('')\n)\n,1,2,'') as ["+O.ID+"]"}var N,V=this.ViewModel.BaseReportColumns.find((function(e){return 204==e.CDGDO.FieldValue}));if(null!=V&&(A=",STUFF(\n(\nselect ', '+[SerialNumber] from INV_SerialStockProduct a with(nolock)\njoin INV_DocDetails d with(nolock) on a.InvDocDetailsID=d.InvDocDetailsID"+c+"\nwhere a.productid=P.ProductID and D.IsQtyIgnored=0 and D.DocDate<=@TODATE"+a+D+C,_.length>0&&(A+=" and DCC.DCCCNID"+(this.TagID-5e4)+"=T.NodeID"),A+="\ngroup by [SerialNumber]\nhaving sum(voucherType)>0\nFOR XML PATH('')\n)\n,1,2,'') as ["+V.ID+"]"),this.DimWiseRepeatHoldQty){var v=f.ID;this.Show==u.TagWise&&(v="HoldQty"),w=",(select isnull(sum(HoldQuantity-rel),0)  Qty\nfrom (\nselect HoldQuantity,case when release>HoldQuantity then HoldQuantity else release end rel from \n(\n    SELECT DX.HoldQuantity\n       ,isnull((select sum(case when l.IsQtyIgnored=0 then l.UOMConvertedQty else l.ReserveQuantity end) from INV_DocDetails l WITH(NOLOCK) where DX.InvDocDetailsID=l.LinkedInvDocDetailsID ),0) release\n    FROM INV_DocDetails DX WITH(NOLOCK)\n    left join COM_DocCCDATA dccX  WITH(NOLOCK) on DX.InvDocDetailsID=dccX.InvDocDetailsID \n    WHERE DX.ProductID=P.ProductID and dccX.DCCCNID"+(this.TagID-5e4)+"=T.NodeID and DX.IsQtyIgnored=1"+r+" and DX.DocumentType in (7,9,11,12,24) and DX.VoucherType=-1  \n) as t\n)as temp) "+v}if(this.ExcludeReserveQty)N=i.e.IsEmpty(s.a.SessionManager.Preferences.HoldResCancelledDocs)?"l.IsQtyIgnored=0":"(l.IsQtyIgnored=0 or l.Costcenterid in("+s.a.SessionManager.Preferences.HoldResCancelledDocs+"))",M=this.TagID>5e4?"-(select isnull(sum(HoldQuantity-rel),0) from (select HoldQuantity,case when release>HoldQuantity then HoldQuantity else release end rel from\n    (SELECT DX.ReserveQuantity HoldQuantity\n,isnull((select sum(case when "+N+" then l.UOMConvertedQty else l.ReserveQuantity end) from INV_DocDetails l WITH(NOLOCK) where DX.InvDocDetailsID=l.LinkedInvDocDetailsID and l.DocDate<=@TODATE),0) release\nFROM INV_DocDetails DX WITH(NOLOCK) INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=DX.InvDocDetailsID\nWHERE DX.ProductID=P.ProductID and DCC.DCCCNID"+(this.TagID-5e4)+"=T.NodeID and DX.DocDate<=@TODATE AND DX.IsQtyIgnored=1"+r+" and DX.DocumentType in (7,9,11,12,24) and DX.VoucherType=-1  \n) as t)as temp)":"-(select isnull(sum(HoldQuantity-rel),0) from (select HoldQuantity,case when release>HoldQuantity then HoldQuantity else release end rel from\n    (SELECT DX.ReserveQuantity HoldQuantity\n,isnull((select sum(case when "+N+" then l.UOMConvertedQty else l.ReserveQuantity end) from INV_DocDetails l WITH(NOLOCK) where DX.InvDocDetailsID=l.LinkedInvDocDetailsID and l.DocDate<=@TODATE),0) release\nFROM INV_DocDetails DX WITH(NOLOCK)\nWHERE DX.ProductID=P.ProductID and DX.DocDate<=@TODATE AND DX.IsQtyIgnored=1"+r+"  and DX.DocumentType in (7,9,11,12,24) and DX.VoucherType=-1  \n) as t)as temp)";p+="\nselect P.ProductID,MAX(P.ProductName) ProductName,MAX(ProductCode) ProductCode"+T+",ISNULL(SUM(D.UOMConvertedQty*D.VoucherType),0)"+M+" BalQty"+g+w+R+S+A+"\nFROM INV_DocDetails D WITH(NOLOCK)"+c+"\nINNER JOIN INV_Product P WITH(NOLOCK) ON P.ProductID=D.ProductID\n"+_+e+"\nWHERE D.ProductID=P.ProductID AND D.IsQtyIgnored=0 AND (D.VoucherType=1 OR D.VoucherType=-1)",p+=" AND D.DocDate<=@TODATE"+a+D+C,p+=" AND P.ProductTypeId<>6 AND P.ProductTypeId!=10",t.length>0&&(p+=" AND "+t),p+=" GROUP BY P.ProductID"+m,this.HideEmptyDimensions&&this.Show==u.TagWise&&(p+=" having ISNULL(SUM(D.UOMConvertedQty*D.VoucherType),0)!=0"),m.length>0&&(p+=this.ProductGroupFirst?" Order BY P.ProductID"+m:" Order BY "+m.Trim(",")+",P.ProductID")}return s.a.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,p)}},{key:"GetUsedProductsQuery",value:function(){var e="",t="";return this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(t=" AND DCC.dcCCNID"+(this.ViewModel.oReportDialog.Locations.DBColumnID-5e4),i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?t+="=-1":this.ViewModel.oReportDialog.LocationWhere.Contains(",")?t+=" IN ("+this.ViewModel.oReportDialog.LocationWhere+")":t+="="+this.ViewModel.oReportDialog.LocationWhere),e+="SELECT D.ProductID FROM Inv_DocDetails D WITH(NOLOCK)",(t+=this.GetDimensionFilterForStock("DCC.dcCCNID")).length>0&&(e+="inner join COM_DocCCDATA DCC with(nolock) on DCC.InvDocDetailsID=D.InvDocDetailsID"),e+=" WHERE (D.VoucherType=1 OR D.VoucherType=-1) AND D.IsQtyIgnored=0",e+=" AND D.DocDate<=convert(float,convert(datetime,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",e+=t,e+=o.GetExcludeStockTransfer(this.ViewModel),(e+=" GROUP BY D.ProductID").toString()}},{key:"GetUsedProductsByTagQuery",value:function(e,t,s){var l="";t=t.Replace("P.ProductID","D.ProductID");var n="";return this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(n=" AND DCC.dcCCNID"+(this.ViewModel.oReportDialog.Locations.DBColumnID-5e4),i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?n+="=-1":this.ViewModel.oReportDialog.LocationWhere.Contains(",")?n+=" IN ("+this.ViewModel.oReportDialog.LocationWhere+")":n+="="+this.ViewModel.oReportDialog.LocationWhere),n+=this.GetDimensionFilterForStock("DCC.dcCCNID"),l+="SELECT DCC.dcCCNID"+(this.TagID-5e4)+" NodeID,max("+s+") Name FROM Inv_DocDetails D WITH(NOLOCK)",l+=" inner join COM_DocCCDATA DCC with(nolock) on DCC.InvDocDetailsID=D.InvDocDetailsID",l+=" inner join "+o.GetTagTableName(this.TagID)+" T with(nolock) on T.NodeID=DCC.dcCCNID"+(this.TagID-5e4),l+=" inner join INV_Product P with(nolock) on P.ProductID=D.ProductID",l+=e,l+=" WHERE (D.VoucherType=1 OR D.VoucherType=-1) AND D.IsQtyIgnored=0",l+=" AND D.DocDate<=convert(float,convert(datetime,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))",l+=n,t.length>0&&(l+=" AND "+t),l+=o.GetExcludeStockTransfer(this.ViewModel),l+=this.GetProductWiseLocationWhere("P",!1),(l+=" GROUP BY DCC.dcCCNID"+(this.TagID-5e4)).toString()}},{key:"addRows",value:function(){for(var e=this,t="",o=0;o<this.oColumns.length;o++)this.AggTotal[o][1]=0;this.k=0,this.lstRecQty.Clear(),this.lstRecRate.Clear(),this.dblAvgRate=0,this.OpBalanceQty=0,this.OpBalanceValue=0,this.dvOpen.length>0&&(this.OpBalanceQty=parseFloat(this.dvOpen[0].OpQty),null!=this.dvOpen[0].OpValue&&(this.OpBalanceValue=parseFloat(this.dvOpen[0].OpValue)),null!=this.dvOpen[0].AvgRate&&(this.dblAvgRate=parseFloat(this.dvOpen[0].AvgRate))),this.IsReconcile||this.ShowSLasSV||(this.GrdRow++,this.row=this.NewReportRow_2(a.f.Group,this.ViewModel.lstGroup[0].GroupAppearance),this.ViewModel.lstGroup[0].Height>0&&(this.row.Height=this.ViewModel.lstGroup[0].Height),this.row.LevelNo=0,this.ViewModel.FormulasCalculated||i.e.IsEmpty(this.ViewModel.lstGroup[0].Formula)||(this.ViewModel.CalculateFormula_2(this.ViewModel.lstGroup[0],this.drMain),this.strProductName=this.drMain[this.ViewModel.lstGroup[0].ID].toString()),this.row.Cells[0].Text=this.strProductName,this.row.Cells[0].ColSpan=this.ViewModel.ColumnSource.length,this.ViewModel.addRow(this.row),this.GroupRowIndex=this.ViewModel.Data.length-1),0!=this.OpBalanceQty&&(this.GrdRow++,this.row=this.NewReportRow_2(a.f.BalanceBF,this.BalanceBFAppearance_Data),this.row.LevelNo=1,this.row.Cells[0].ColSpan=this.colSpanBF,this.row.Cells[0].Text=s.a.GetResource("Reports_BalanceBF"),this.row.Cells[0].CellAppearance.Alignment="Left",-1!=this.colBalanceQtyIndex&&(this.IsReconcile||(this.AggTotal[this.colBalanceQtyIndex][1]=this.OpBalanceQty),this.ViewModel.SetCellValue(this.OpBalanceQty,this.oColumns[this.colBalanceQtyIndex].DataFormat,"FLOAT",this.row.Cells[this.colBalanceQtyIndex])),null!=this.dvOpen[0].AvgRate&&(this.dblAvgRate=parseFloat(this.dvOpen[0].AvgRate)),-1!=this.colBalanceRateIndex&&(this.AggTotal[this.colBalanceRateIndex][1]=this.dblAvgRate,this.ViewModel.SetCellValue(this.dblAvgRate,this.oColumns[this.colBalanceRateIndex].DataFormat,"FLOAT",this.row.Cells[this.colBalanceRateIndex])),-1!=this.colBalanceValueIndex&&(this.IsReconcile||(this.AggTotal[this.colBalanceValueIndex][1]=this.OpBalanceValue),this.ViewModel.SetCellValue(this.OpBalanceValue,this.oColumns[this.colBalanceValueIndex].DataFormat,"FLOAT",this.row.Cells[this.colBalanceValueIndex])),this.IsMultipleUnits&&(this.MultipleUnitType==c.Max?this.ViewModel.SetCellValue(this.OpBalanceQty/this.dblMaxConv,this.oColumns[this.colBalanceQtyIndex].DataFormat,"FLOAT",this.row.Cells[this.colBalanceQtyIndex+1]):this.MultipleUnitType==c.Min?this.ViewModel.SetCellValue(this.OpBalanceQty/this.dblMinConv,this.oColumns[this.colBalanceQtyIndex].DataFormat,"FLOAT",this.row.Cells[this.colBalanceQtyIndex+1]):this.OpBalanceQty>=0?(this.ViewModel.SetCellValue(Math.floor(this.OpBalanceQty/this.dblMaxConv),this.oColumns[this.colBalanceQtyIndex].DataFormat,"FLOAT",this.row.Cells[this.colBalanceQtyIndex+1]),this.ViewModel.SetCellValue(Math.floor(this.OpBalanceQty%this.dblMaxConv/this.dblMinConv),this.oColumns[this.colBalanceQtyIndex].DataFormat,"FLOAT",this.row.Cells[this.colBalanceQtyIndex+(this.ShowMultipleUnitNames?3:2)])):(this.ViewModel.SetCellValue(Math.ceil(this.OpBalanceQty/this.dblMaxConv),this.oColumns[this.colBalanceQtyIndex].DataFormat,"FLOAT",this.row.Cells[this.colBalanceQtyIndex+1]),this.ViewModel.SetCellValue(Math.ceil(this.OpBalanceQty%this.dblMaxConv/this.dblMinConv),this.oColumns[this.colBalanceQtyIndex].DataFormat,"FLOAT",this.row.Cells[this.colBalanceQtyIndex+(this.ShowMultipleUnitNames?3:2)]))),this.IsReconcile||this.ShowSLasSV||this.ViewModel.addRow(this.row),1!=this.ValuationID&&2!=this.ValuationID||this.dvOpenTrans.forEach((function(t){e.lstRecQty.InsertAt(0,parseFloat(t.Qty)),e.lstRecRate.InsertAt(0,parseFloat(t.Rate))})));var l=!(!s.a.SessionManager.Preferences.ContainsKey("ShowNegativeStockInReports")||"TRUE"!=s.a.SessionManager.Preferences.ShowNegativeStockInReports.toUpperCase());if(4==this.ValuationID||5==this.ValuationID){for(this.k=this.dv.length-1;this.k>=0;this.k--)if(1==parseInt(this.dv[this.k].VoucherType)&&(this.dblQty=i.e.Double(this.dv[this.k].UOMConvertedQty),this.dblQty>0)){4==this.ValuationID?this.dblValue=parseFloat(this.dv[this.k].Gross):5==this.ValuationID&&(this.dblValue=parseFloat(this.dv[this.k].RecValue)),this.dblAvgRate=this.dblValue/this.dblQty;break}}else if(6==this.ValuationID){var n=null;this.dicPeriodicAvgRate.Clear();var r=0,h=0,u=this.dblAvgRate;for(this.dblQty=this.OpBalanceQty,r=this.OpBalanceValue,this.k=0;this.k<this.dv.length;this.k++)n!=(t=new Date(this.dv[this.k].DocDate).ToString("MMMyyyy"))&&(this.k>0&&(this.dblQty>0?(u=(r+this.dblValue)/this.dblQty,this.dicPeriodicAvgRate.push(n,u)):this.dicPeriodicAvgRate.push(n,u),this.dblQty=this.dblQty-h,r=this.dblQty*this.dicPeriodicAvgRate[n]),n=t,h=0,this.dblValue=0),i.e.String(this.dv[this.k].RecQty).length>0?6!=parseInt(this.dv[this.k].DocumentType)&&39!=parseInt(this.dv[this.k].DocumentType)&&(this.dblQty+=parseFloat(this.dv[this.k].UOMConvertedQty),this.dblValue+=parseFloat(this.dv[this.k].RecValue)):h+=parseFloat(this.dv[this.k].UOMConvertedQty);this.dv.length>0&&this.dicPeriodicAvgRate.push(n,this.dblQty>0?(r+this.dblValue)/this.dblQty:u)}for(this.k=0;this.k<this.dv.length;this.k++){if(this.GrdRow++,this.row=this.NewReportRow(),this.row.DataRow=this.dv[this.k],this.row.LevelNo=0,this.dblQty=i.e.Double(this.dv[this.k].UOMConvertedQty),i.e.String(this.dv[this.k].RecQty).length>0)this.dblValue=parseFloat(this.dv[this.k].RecValue),this.dblUOMRate=this.dblValue/this.dblQty,this.OpBalanceQty<0?(this.OpBalanceQty=this.dblQty+this.OpBalanceQty,Math.abs(this.OpBalanceQty)<1e-8&&(this.OpBalanceQty=0),l||(this.dblQty=this.OpBalanceQty>0?this.OpBalanceQty:0)):this.OpBalanceQty+=this.dblQty,4==this.ValuationID||5==this.ValuationID?this.dblUOMRate=this.dblAvgRate:6==this.ValuationID&&(t=new Date(this.dv[this.k].DocDate).ToString("MMMyyyy"),this.dblUOMRate=this.dblAvgRate=this.dicPeriodicAvgRate[t]),this.dblQty>0&&(6!=parseInt(this.dv[this.k].DocumentType)&&39!=parseInt(this.dv[this.k].DocumentType)||(7==this.ValuationID?this.dblAvgRate=this.dblUOMRate:this.dblUOMRate=this.dblAvgRate,this.dv[this.k].COGS=this.dblQty*this.dblAvgRate),l||this.OpBalanceValue<0&&(this.OpBalanceValue=0),this.OpBalanceValue+=this.dblQty*this.dblUOMRate),4!=this.ValuationID&&5!=this.ValuationID&&6!=this.ValuationID&&(l?0!=this.OpBalanceQty&&(this.dblAvgRate=this.OpBalanceValue/this.OpBalanceQty):this.OpBalanceQty>0?this.dblAvgRate=this.OpBalanceValue/this.OpBalanceQty:(this.dblAvgRate=0,this.OpBalanceValue=0)),this.dblQty>0&&(1==this.ValuationID?(this.lstRecQty.InsertAt(0,this.dblQty),this.lstRecRate.InsertAt(0,this.dblUOMRate)):2==this.ValuationID&&(this.lstRecQty.push(this.dblQty),this.lstRecRate.push(this.dblUOMRate)));else if(this.OpBalanceQty-=this.dblQty,3==this.ValuationID||4==this.ValuationID||5==this.ValuationID)this.OpBalanceValue=this.dblAvgRate*this.OpBalanceQty,this.dv[this.k].COGS=this.dblQty*this.dblAvgRate;else if(6==this.ValuationID)t=new Date(this.dv[this.k].DocDate).ToString("MMMyyyy"),this.dblUOMRate=this.dblAvgRate=this.dicPeriodicAvgRate[t],this.OpBalanceValue=this.dblAvgRate*this.OpBalanceQty,this.dv[this.k].COGS=this.dblQty*this.dblAvgRate;else if(7==this.ValuationID)this.OpBalanceValue=this.OpBalanceValue-parseFloat(this.dv[this.k].IssValue),this.OpBalanceValue<0&&(this.OpBalanceValue=0),0==this.OpBalanceQty?(this.dblAvgRate=0,this.OpBalanceValue=0):this.dblAvgRate=this.OpBalanceValue/this.OpBalanceQty,this.dv[this.k].COGS=this.dv[this.k].IssValue;else if(1==this.ValuationID||2==this.ValuationID){this.dblCOGS=0;for(var D=this.lstRecQty.length-1;D>=0;D--){if(this.dblQty=this.dblQty-this.lstRecQty[D],this.dblQty<0){this.dblCOGS+=(this.lstRecQty[D]+this.dblQty)*this.lstRecRate[D],this.lstRecQty[D]=-this.dblQty;break}if(this.dblCOGS+=this.lstRecQty[D]*this.lstRecRate[D],this.lstRecQty.RemoveAt(D),this.lstRecRate.RemoveAt(D),0==this.dblQty)break}this.OpBalanceValue=this.OpBalanceValue-this.dblCOGS,this.OpBalanceValue<0&&(this.OpBalanceValue=0),this.dv[this.k].COGS=this.dblCOGS}if(0==this.OpBalanceQty&&(this.OpBalanceValue=0),this.dv[this.k].BalanceQty=this.OpBalanceQty,this.dv[this.k].AvgRate=this.dblAvgRate,this.dv[this.k].BalanceValue=this.OpBalanceValue,this.IsMultipleUnits&&(this.MultipleUnitType==c.Max?this.dv[this.k].BalanceQty_Max=this.OpBalanceQty/this.dblMaxConv:this.MultipleUnitType==c.Min?this.dv[this.k].BalanceQty_Min=this.OpBalanceQty/this.dblMinConv:this.OpBalanceQty>=0?(this.dv[this.k].BalanceQty_Max=Math.floor(this.OpBalanceQty/this.dblMaxConv),this.dv[this.k].BalanceQty_Min=Math.floor(this.OpBalanceQty%this.dblMaxConv/this.dblMinConv)):(this.dv[this.k].BalanceQty_Max=Math.ceil(this.OpBalanceQty/this.dblMaxConv),this.dv[this.k].BalanceQty_Min=Math.ceil(this.OpBalanceQty%this.dblMaxConv/this.dblMinConv))),this.ShowGroupHighLowValues&&(0==this.k?(this.dblCBMin=this.dblCBMax=this.OpBalanceQty,this.dtCBMin=this.dtCBMax=new Date(this.dv[this.k].DocDate)):(this.dblCBMin>this.OpBalanceQty&&(this.dblCBMin=this.OpBalanceQty,this.dtCBMin=new Date(this.dv[this.k].DocDate)),this.dblCBMax<this.OpBalanceQty&&(this.dblCBMax=this.OpBalanceQty,this.dtCBMax=new Date(this.dv[this.k].DocDate)))),!this.IsReconcile||null!=this.dv[this.k].GLCOGS&&null!=this.dv[this.k].COGS&&Math.abs(Math.abs(parseFloat(this.dv[this.k].GLCOGS))-parseFloat(this.dv[this.k].COGS))>.01){this.rows.Clear(),this.GrdRow++,this.rows.push(new a.d(this.oColumns.length,this.ViewModel.RowHeight)),this.rows[this.rows.length-1].Type=a.f.Detail;for(var d=0;d<this.oColumns.length;d++)if(!(this.oColumns[d].DataFormat.PrintOnce&&this.k>0)){if(this.oColumns[d].Row>0&&this.rows.length-1<this.oColumns[d].Row){for(var C=0;C<=this.oColumns[d].Row;C++)this.rows.length-1<C&&(this.GrdRow++,this.rows.push(new a.d(this.oColumns.length,this.ViewModel.SubRowHeight)),this.rows[this.rows.length-1].Type=a.f.Detail);this.Row=this.oColumns[d].Row,this.Col=this.oColumns[d].Column}else this.Row=0,this.Col=d;this.CellValue="",this.CellValue=""!=this.oColumns[d].Formula?this.ViewModel.CalculateFormula_1(this.oColumns[d].Formula,this.dv[this.k],this.rows):i.e.String(this.dv[this.k][this.oColumns[d].ID]),""!=this.CellValue&&((this.IsReconcile||!this.oColumns[d].ID.startsWith("Balance"))&&this.ViewModel.TotalCols.Contains(this.oColumns[d].ID)&&i.e.IsNum(this.CellValue)&&(this.dbl=i.e.Double(this.CellValue),this.AggTotal[d][1]+=this.dbl),this.oColumns[d].DataFormat.CumTotal>-1&&(this.CellValue=this.AggTotal[d][1].toString()),this.ViewModel.SetCellValue(this.CellValue,this.oColumns[d].DataFormat,this.oColumns[d].ColumnType,this.rows[this.Row].Cells[this.Col]))}-1!=this.ViewModel.colSNoIndex&&(this.rows[0].Cells[this.ViewModel.colSNoIndex].Value=++this.ViewModel.SNo,this.rows[0].Cells[this.ViewModel.colSNoIndex].Text=this.ViewModel.SNo.toString()),this.ViewModel.ApplyKPI(this.rows[0]);for(var p=0;p<this.rows.length;p++){var T=this.rows[p];this.ViewModel.HideEmptyRows&&!T.Cells.find((function(e){return!i.e.IsEmptySpace(e.Text)}))||(T.LevelNo=this.ViewModel.lstGroup.length,T.DataRow=this.dv[this.k],this.ShowSLasSV||this.ViewModel.addRow(T))}}}if(this.IsReconcile||(-1!=this.colBalanceQtyIndex&&(this.AggTotal[this.colBalanceQtyIndex][1]=this.OpBalanceQty),-1!=this.colBalanceValueIndex&&(this.AggTotal[this.colBalanceValueIndex][1]=this.OpBalanceValue),-1!=this.colBalanceQtyMaxIndex&&(this.AggTotal[this.colBalanceQtyMaxIndex][1]=parseFloat(this.rows[0].Cells[this.colBalanceQtyMaxIndex].Value)),-1!=this.colBalanceQtyMinIndex&&(this.AggTotal[this.colBalanceQtyMinIndex][1]=parseFloat(this.rows[0].Cells[this.colBalanceQtyMinIndex].Value))),this.ShowGroupHighLowValues&&this.dv.length>0){this.row=this.ViewModel.Data[this.GroupRowIndex];var _=this.strProductName+"   [Low: ";this.ViewModel.SetCellValue(this.dblCBMin,this.oCBFormat,"FLOAT",this.oCBCell),_+=this.oCBCell.Text,_+=" ("+this.dtCBMin.ToString(s.a.SessionManager.Preferences["Date Format"])+")",_+=",   High: ",this.ViewModel.SetCellValue(this.dblCBMax,this.oCBFormat,"FLOAT",this.oCBCell),_+=this.oCBCell.Text,_+=" ("+this.dtCBMax.ToString(s.a.SessionManager.Preferences["Date Format"])+")",_+="]",this.row.Cells[0].Text=_,this.ViewModel.Data.RemoveAt(this.GroupRowIndex),this.ViewModel.Data.Insert(this.GroupRowIndex,this.row)}return this.AddSubTotal(),0}},{key:"AddSubTotal",value:function(){if(!this.IsReconcile&&this.colSubTotalStartIndex>=0){for(this.GrdRow++,this.row=this.NewReportRow_2(a.f.SubTotal,this.ViewModel.lstGroup[0].SubTotalAppearance_Data),this.row.LevelNo=this.ViewModel.lstGroup.length,this.row.Cells[0].CellAppearance=this.ViewModel.lstGroup[0].SubTotalAppearance,this.row.Cells[0].Text=this.ShowSLasSV?this.strProductName:s.a.GetResource("Reports_SubTotal"),this.row.Cells[0].ColSpan=this.colSubTotalStartIndex,this.k=0;this.k<this.oColumns.length;this.k++)this.ViewModel.lstGroup[0].TotalCols.ContainsKey(this.oColumns[this.k].ID)&&this.ViewModel.SetCellValue(this.AggTotal[this.k][1],this.oColumns[this.k].DataFormat,"FLOAT",this.row.Cells[this.k]);this.ViewModel.addRow(this.row)}for(var e=0;e<this.AggTotal.length;e++)this.AggTotal[e][0]+=this.AggTotal[e][1],this.AggTotal[e][1]=0}},{key:"AddReportTotal",value:function(){this.GrdRow++,this.row=this.NewReportRow_2(a.f.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance_Data);var e=-1;for(this.k=0;this.k<this.oColumns.length;this.k++)this.ViewModel.GrpReportTotal.TotalCols.ContainsKey(this.oColumns[this.k].ID)&&(-1==e&&(e=this.k),this.ViewModel.SetCellValue(this.AggTotal[this.k][0],this.oColumns[this.k].DataFormat,"FLOAT",this.row.Cells[this.k]));this.row.Cells[0].CellAppearance=this.ViewModel.GrpReportTotal.SubTotalAppearance,this.row.Cells[0].Text=s.a.GetResource("Reports_ReportTotal"),e>0&&(this.GrdRow++,this.row.Cells[0].ColSpan=e,this.ViewModel.addRow(this.row))}},{key:"Reconcile",value:function(){var e=[],t=new Array;this.ViewModel.Data.forEach((function(o){null!=o.DataRow&&i.e.IsNum(o.DataRow.DocID)&&(t.Contains(parseInt(o.DataRow.DocID))||(t.push(parseInt(o.DataRow.DocID)),e.push({CostCenterID:parseInt(o.DataRow.CostCenterID),DocID:parseInt(o.DataRow.DocID)})))}))}},{key:"addStockMovement",value:function(){if(this.oRow=this.NewReportRow(),this.oRow.NodeID=parseInt(this.strProductID),this.oRow.DataRow=this.drMain,this.ShowLevelTree&&(this.oRow.LevelNo=parseInt(this.drMain.Depth)-1,this.oRow.Cells[1].level=this.oRow.LevelNo+1,this.oRow.Cells[1].IsNormal=!1,this.UpdateTreeTotals(this.oRow.LevelNo),this.RemoveGroups(this.oRow.LevelNo),Object(l.j)(this.drMain.IsGroup))){this.lstParents.push(this.oRow);var e=new Array(this.oColumns.length);e.fill(0),this.lstTotal.push(e),this.oRow.Type=a.f.BalanceBF,this.oRow.IsGroup=!0;for(var t=0;t<this.oRow.Cells.length;t++)this.oRow.Cells[t].IsNormal=!1,this.oRow.Cells[t].CellAppearance=this.BalanceBFAppearance_Data.Clone(),this.oRow.Cells[t].CellAppearance.Alignment=this.oColumns[t].DataAppearance.Alignment}if(this.Show!=u.None&&!this.oRow.IsGroup){var o=0,s=0,n=0,r=0,h=this.dv[0].TagID.toString();if(this.Show==u.MonthWise||this.Show==u.YearWise)for(this.k=2;this.k<this.dv.length;)null==this.dv[this.k].BalQty&&null!=this.dv[this.k-1].BalQty&&(this.dv[this.k].BalQty=this.dv[this.k-1].BalQty,this.dv[this.k].AvgRate=this.dv[this.k-1].AvgRate,this.dv[this.k].BalValue=this.dv[this.k-1].BalValue),2==this.k&&"0"==i.e.String(this.dv[this.k-1].TagID)?this.dvTable.Remove(this.dv[this.k-1]):this.k++;for(this.k=-1;this.k+1<this.dv.length;)(h=i.e.String(this.dv[this.k+1].TagID)).length>0&&(o=i.e.Double(this.dv[this.k+1].BalQty),this.DimWiseRepeatQty&&(this.dv[0]["RecQty"+h]=i.e.String(this.dv[this.k+1].RecQty),this.dv[0]["IssQty"+h]=i.e.String(this.dv[this.k+1].IssQty),this.dv[0]["BalQty"+h]=o),r+=o,this.DimWiseRepeatRate&&(s=i.e.Double(this.dv[this.k+1].AvgRate),this.dv[0]["AvgRate"+h]=s),this.DimWiseRepeatValue&&(this.dv[0]["RecValue"+h]=i.e.String(this.dv[this.k+1].RecValue),this.dv[0]["IssValue"+h]=i.e.String(this.dv[this.k+1].IssValue),n=i.e.Double(this.dv[this.k+1].BalValue),this.dv[0]["BalValue"+h]=n)),-1==this.k?this.k=0:this.dvTable.Remove(this.dv[this.k+1]);16==this.ViewModel.StaticReportType&&this.dv.length>0&&(this.dv[0].BalQty=r)}this.IsMultipleUnits&&this.dv.length>0&&(this.dblQty=parseFloat(this.dv[0].BalQty),this.MultipleUnitType==c.Max?this.dv[this.k].BalQty_Max=this.dblQty/this.dblMaxConv:this.MultipleUnitType==c.Min?this.dv[this.k].BalQty_Min=this.dblQty/this.dblMinConv:this.dblQty>=0?(this.dv[this.k].BalQty_Max=Math.floor(this.dblQty/this.dblMaxConv),this.dv[this.k].BalQty_Min=Math.floor(this.dblQty%this.dblMaxConv/this.dblMinConv)):(this.dv[this.k].BalQty_Max=Math.ceil(this.dblQty/this.dblMaxConv),this.dv[this.k].BalQty_Min=Math.ceil(this.dblQty%this.dblMaxConv/this.dblMinConv)));for(var D=0;D<this.oColumns.length;D++){if(this.CellValue="",""!=this.oColumns[D].Formula?(this.CellValue=this.ViewModel.CalculateFormula_1(this.oColumns[D].Formula,this.drRecord,this.rows),this.drRecord[this.oColumns[D].ID]=this.CellValue):this.CellValue=i.e.String(this.drRecord[this.oColumns[D].ID]),!i.e.IsEmpty(this.oColumns[D].ColumnFilterExpression)&&"0"==this.ViewModel.CalculateFormula_1(this.oColumns[D].ColumnFilterExpression,this.drRecord,this.rows).toString())return;""!=this.CellValue&&(this.ViewModel.SetCellValue(this.CellValue,this.oColumns[D].DataFormat,this.oColumns[D].ColumnType,this.oRow.Cells[D]),"Balance"!=this.oColumns[D].ID&&this.ViewModel.TotalCols.Contains(this.oColumns[D].ID)&&i.e.IsNum(this.CellValue)&&(this.dbl=i.e.Double(this.CellValue),this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][D]+=this.dbl)))}if(this.oRow.LevelNo<=this.LevelNo)if(this.GrdRow++,this.lstParents.length>1&&(this.oRow.IsExpanded=!0,this.oRow.IsGroup?this.lstParents.length>2&&(this.oRow.Parent=this.lstParents[this.lstParents.length-2]):this.oRow.Parent=this.lstParents[this.lstParents.length-1]),this.ShowCollapse&&(0==this.oRow.LevelNo&&(this.oRow.IsExpanded=!1),null==this.oRow.Parent||this.oRow.Parent.IsExpanded&&this.oRow.Parent.Visible||(this.oRow.IsExpanded=!1,this.oRow.Visible=!1)),-1==this.ViewModel.colSNoIndex||this.oRow.IsGroup||(this.oRow.Cells[this.ViewModel.colSNoIndex].Value=++this.ViewModel.SNo,this.oRow.Cells[this.ViewModel.colSNoIndex].Text=this.ViewModel.SNo.toString()),this.oRow.IsGroup||this.ViewModel.ApplyKPI(this.oRow),this.oRow.IsGroup||50!=this.LevelNo)this.ViewModel.addRow(this.oRow);else if(this.oRow.Visible=!1,this.ViewModel.addRow(this.oRow),null!=this.oRow.Parent&&this.oRow.Parent.Type!=a.f.Detail){for(var d=0;d<this.oRow.Parent.Cells.length;d++)this.oRow.Parent.Cells[d].CellAppearance=this.oColumns[d].DataAppearance.Clone();this.oRow.Parent.Type=a.f.Detail}}},{key:"UpdateTreeTotals",value:function(e){for(var t=this.lstTotal.length-1;t>e;t--){if(t>0)for(var o=0;o<this.lstTotal[t].length;o++)this.lstTotal[t-1][o]+=this.lstTotal[t][o];for(var s=0;s<this.oColumns.length;s++)"FLOAT"==this.oColumns[s].ColumnType&&s!=this.ViewModel.colSNoIndex&&this.ViewModel.SetCellValue(this.lstTotal[t][s],this.oColumns[s].DataFormat,"FLOAT",this.lstParents[t].Cells[s]);e<=this.LevelNo&&this.RefreshRow(this.lstParents[t]),this.lstParents.RemoveAt(t),this.lstTotal.RemoveAt(t)}}},{key:"RefreshRow",value:function(e){var t=this.ViewModel.Data.indexOf(e);t>=0&&(this.ViewModel.Data.Remove(e),this.ViewModel.Data.Insert(t,e))}},{key:"RemoveGroups",value:function(e){if(-1==e||Object(l.j)(this.drMain.IsGroup)){if(this.GrdRow>-1&&this.ViewModel.Data[this.GrdRow].Level>=e)for(var t=this.ViewModel.Data[this.GrdRow].Level;t>=e&&this.ViewModel.Data[this.GrdRow].Type==a.f.BalanceBF;t--){for(var o=0;o<this.oColumns.length;o++)if("FLOAT"==this.oColumns[o].ColumnType&&!i.e.IsEmpty(this.ViewModel.Data[this.GrdRow].Cells[o].Text)&&0!=parseFloat(this.ViewModel.Data[this.GrdRow].Cells[o].Text))return;if(this.ViewModel.Data.RemoveAt(this.GrdRow),this.GrdRow--,-1==this.GrdRow)break}}else for(;this.GrdRow>=0&&this.ViewModel.Data[this.GrdRow].Type==a.f.BalanceBF&&this.ViewModel.Data[this.GrdRow].Level>=e;){for(var s=0;s<this.oColumns.length;s++)if("FLOAT"==this.oColumns[s].ColumnType&&!i.e.IsEmpty(this.ViewModel.Data[this.GrdRow].Cells[s].Text)&&0!=parseFloat(this.ViewModel.Data[this.GrdRow].Cells[s].Text))return;this.ViewModel.Data.RemoveAt(this.GrdRow),this.GrdRow--}}},{key:"AddReportTotal_StockMovement",value:function(){this.UpdateTreeTotals(0),this.RemoveGroups(-1),this.row=this.NewReportRow_2(a.f.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance_Data),this.row.LevelNo=0;var e=-1;for(this.k=0;this.k<this.oColumns.length;this.k++)this.ViewModel.GrpReportTotal.TotalCols.ContainsKey(this.oColumns[this.k].ID)&&(-1==e&&(e=this.k),this.ViewModel.SetCellValue(this.lstTotal[0][this.k],this.oColumns[this.k].DataFormat,"FLOAT",this.row.Cells[this.k]));this.row.Cells[0].Text=s.a.GetResource("Reports_ReportTotal"),this.row.Cells[0].CellAppearance.Alignment="Left",e>0&&(this.GrdRow++,this.row.Cells[0].ColSpan=e,this.ViewModel.addRow(this.row))}},{key:"addStockList",value:function(e){if(this.oRow=this.NewReportRow(),this.oRow.NodeID=parseInt(this.strProductID),this.oRow.DataRow=this.drMain,this.ShowLevelTree&&(this.oRow.LevelNo=parseInt(this.drMain.Depth)-1,this.oRow.Cells[1].level=this.oRow.LevelNo+1,this.oRow.Cells[1].IsNormal=!1,this.UpdateTreeTotals(this.oRow.LevelNo),this.RemoveGroups(this.oRow.LevelNo),Object(l.j)(this.drMain.IsGroup))){this.lstParents.push(this.oRow),this.lstTotal.push(new Array(this.oColumns.length).fill(0)),this.oRow.Type=a.f.BalanceBF,this.oRow.IsGroup=!0;for(var t=0;t<this.oRow.Cells.length;t++)this.oRow.Cells[t].IsNormal=!1,this.oRow.Cells[t].CellAppearance=this.BalanceBFAppearance_Data.Clone(),this.oRow.Cells[t].CellAppearance.Alignment=this.oColumns[t].DataAppearance.Alignment}if(this.Show==u.TagWise&&!this.oRow.IsGroup){var o,s,n=i.e.String(this.drr[0].TagID);for(o=s=0,this.k=0;this.k<this.drr.length;this.k++)(n=i.e.String(this.drr[this.k].TagID)).length>0&&(o=i.e.Double(this.drr[this.k].BalQty),this.drr[0]["BalQty"+n]=o,s+=o,this.DimWiseRepeatReserveQty&&(o=i.e.Double(this.drr[this.k].ReserveQty),this.drr[0]["ReserveQty"+n]=o),this.DimWiseRepeatHoldQty&&(o=i.e.Double(this.drr[this.k].HoldQty),this.drr[0]["HoldQty"+n]=o)),this.k>0&&this.dsSource.Tables[0].Remove(this.drr[this.k]);e||this.drr.length>0&&(this.drr[0].BalQty=s)}for(var r=0;r<this.oColumns.length;r++){if(this.CellValue="",this.CellValue=""!=this.oColumns[r].Formula?this.ViewModel.CalculateFormula_1(this.oColumns[r].Formula,this.drRecord,this.rows):i.e.String(this.drRecord[this.oColumns[r].ID]),!i.e.IsEmpty(this.oColumns[r].ColumnFilterExpression)&&"0"==this.ViewModel.CalculateFormula_1(this.oColumns[r].ColumnFilterExpression,this.drRecord,this.rows).toString())return;""!=this.CellValue&&(this.ViewModel.SetCellValue(this.CellValue,this.oColumns[r].DataFormat,this.oColumns[r].ColumnType,this.oRow.Cells[r]),"Balance"!=this.oColumns[r].ID&&this.ViewModel.TotalCols.Contains(this.oColumns[r].ID)&&i.e.IsNum(this.CellValue)&&(this.dbl=i.e.Double(this.CellValue),this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][r]+=this.dbl)))}if(this.oRow.LevelNo<=this.LevelNo)if(this.GrdRow++,this.lstParents.length>1&&(this.oRow.IsExpanded=!0,this.oRow.IsGroup?this.lstParents.length>2&&(this.oRow.Parent=this.lstParents[this.lstParents.length-2]):this.oRow.Parent=this.lstParents[this.lstParents.length-1]),this.ShowCollapse&&(0==this.oRow.LevelNo&&(this.oRow.IsExpanded=!1),null==this.oRow.Parent||this.oRow.Parent.IsExpanded&&this.oRow.Parent.Visible||(this.oRow.IsExpanded=!1,this.oRow.Visible=!1)),-1==this.ViewModel.colSNoIndex||this.oRow.IsGroup||(this.oRow.Cells[this.ViewModel.colSNoIndex].Value=++this.ViewModel.SNo,this.oRow.Cells[this.ViewModel.colSNoIndex].Text=this.ViewModel.SNo.toString()),this.oRow.IsGroup||this.ViewModel.ApplyKPI(this.oRow),this.oRow.IsGroup||50!=this.LevelNo)this.ViewModel.addRow(this.oRow);else if(this.oRow.Visible=!1,this.ViewModel.addRow(this.oRow),null!=this.oRow.Parent&&this.oRow.Parent.Type!=a.f.Detail){for(var h=0;h<this.oRow.Parent.Cells.length;h++)this.oRow.Parent.Cells[h].CellAppearance=this.oColumns[h].DataAppearance.Clone();this.oRow.Parent.Type=a.f.Detail}}},{key:"RenderData",value:function(e){for(var t=this;this.R<e.length;this.R++){if(this.dblBalQty=this.GetAbsoluteQty(e[this.R].BalQty),0==this.dblBalQty){if(!this.Display_Zero)continue}else if(this.dblBalQty>=0){if(!this.Display_Positive)continue}else if(!this.Display_Negative)continue;if(0!=i.e.String(e[this.R].TagID).length&&(this.drr0=this.dsMain.Tables[0].filter((function(o){return o.ProductID==e[t.R].ProductID})),0!=this.drr0.length)){this.drr1=this.dsMain.Tables[1].filter((function(o){return o.NodeID==e[t.R].TagID})),this.ProductGroupFirst?(e[this.R][this.ViewModel.ReportGroups[0].ID]="ProductCode"==this.ViewModel.ReportGroups[0].CDGDO.Column?this.drr0[0].ProductCode.toString():this.drr0[0].ProductName.toString(),this.drr1.length>0&&(e[this.R][this.ViewModel.ReportGroups[1].ID]=i.e.String(this.drr1[0].Name))):(e[this.R][this.ViewModel.ReportGroups[1].ID]="ProductCode"==this.ViewModel.ReportGroups[1].CDGDO.Column?this.drr0[0].ProductCode.toString():this.drr0[0].ProductName.toString(),this.drr1.length>0&&(e[this.R][this.ViewModel.ReportGroups[0].ID]=i.e.String(this.drr1[0].Name))),this.IsMultipleUnits&&(this.dblMaxConv=parseFloat(this.drr0[0].MaxConv),this.dblMinConv=parseFloat(this.drr0[0].MinConv),this.MultipleUnitType==c.Max?e[this.R].BalQty_Max=this.dblBalQty/this.dblMaxConv:this.MultipleUnitType==c.Min?e[this.R].BalQty_Min=this.dblBalQty/this.dblMinConv:this.dblBalQty>=0?(e[this.R].BalQty_Max=Math.floor(this.dblBalQty/this.dblMaxConv),e[this.R].BalQty_Min=Math.floor(this.dblBalQty%this.dblMaxConv/this.dblMinConv)):(e[this.R].BalQty_Max=Math.ceil(this.dblBalQty/this.dblMaxConv),e[this.R].BalQty_Min=Math.ceil(this.dblBalQty%this.dblMaxConv/this.dblMinConv))),null!=this.dtBins&&(this.drr2=this.dsMain.Tables[2].filter((function(o){return o.Location==e[t.R].TagID&&o.NodeID==e[t.R].ProductID})),this.drr2.length>0&&(this.drrBin=this.dtBins.filter((function(e){return e.NodeID==t.drr2[0].BinNodeID})),this.drrBin.length>0&&(e[this.R][this.ViewModel.ReportParams.BinDimension]=this.drrBin[0].Name.toString()))),this.dsMain.Columns[0].forEach((function(o){t.ds.Columns[0].Contains(o)&&(e[t.R][o]=t.drr0[0][o])})),this.ViewModel.AddGroupRows(e,this.R),this.oRow=this.NewReportRow(),this.oRow.LevelNo=this.ViewModel.lstGroup.length,this.oRow.DataRow=e[this.R];for(var o=0;o<this.oColumns.length;o++)this.CellValue="",""!=this.oColumns[o].Formula?this.CellValue=this.ViewModel.CalculateFormula_1(this.oColumns[o].Formula,e[this.R],this.rows):i.e.IsEmpty(e[this.R][this.oColumns[o].ID])||(this.CellValue=e[this.R][this.oColumns[o].ID].toString()),""!=this.CellValue&&(this.ViewModel.SetCellValue(this.CellValue,this.oColumns[o].DataFormat,this.oColumns[o].ColumnType,this.oRow.Cells[o]),this.ViewModel.TotalCols.Contains(this.oColumns[o].ID)&&i.e.IsNum(this.CellValue)&&(this.ViewModel.totals[o][this.ViewModel.lstGroup.length]+=parseFloat(this.CellValue)));this.ViewModel.ApplyKPI(this.oRow),this.ViewModel.addRow(this.oRow)}}}},{key:"GetDimensionFilterForStock",value:function(e){for(var t="",o=0;o<this.ViewModel.oReportDialog.CostCenterFilters.length;o++){var i=this.ViewModel.oReportDialog.CostCenterFilters[o];if((i.CostCenterID!=this.ViewModel.oReportDialog.StockDimensionID||0!=i.SelectedNodes.length)&&i.CostCenterID>5e4&&(i.SelectedNodes.length>0||!i.DeleteButtonVisibility))if(i.SelectedNodes.length>0)if(1==i.SelectedNodes.length)t+=" AND ",t+=e+(i.CostCenterID-5e4)+"="+i.SelectedNodes[0].Id;else{var l="1"==s.a.SessionManager.UserID||"1"==s.a.SessionManager.RoleID;if(null==(i.DeleteButtonVisibility||l?i.SelectedNodes.find((function(e){return 2==e.Id&&e.IsGroup})):null)){t+=" AND ",t+=e+(i.CostCenterID-5e4)+" IN (";for(var n=0;n<i.SelectedNodes.length;n++)n>0&&(t+=","),t+=i.SelectedNodes[n].Id;t+=")"}}else i.DeleteButtonVisibility||(t+=" AND ",t+=e+(i.CostCenterID-5e4)+"=-12912")}return t.toString()}}],[{key:"GetExcludeStockTransfer",value:function(e){var t="";if(e.Preferences.ContainsKey("ExcludeStockTransfer")&&e.Preferences.ExcludeStockTransfer.length>0){var o=!1;if(e.oReportDialog.Locations.Visible&&!i.e.IsEmpty(e.oReportDialog.LocationWhere)&&(o=!0),e.oReportDialog.StockDimensionID>0){var s=e.oReportDialog.CostCenterFilters.find((function(t){return t.CostCenterID==e.oReportDialog.StockDimensionID}));s&&null!=s.SelectedNodes&&s.SelectedNodes.length>0&&s.SelectedNodes.find((function(e){return 2==e.Id}))&&(o=!0)}t=o?"":" and D.CostCenterID NOT IN ("+e.Preferences.ExcludeStockTransfer+")"}var l=n.b.GetFilterByDimension_3(300,e.oReportDialog.CostCenterFilters);return i.e.IsEmpty(l)||(t+=" and D.CostCenterID IN ("+l+")"),t}}]),o}(n.b)},jp4k:function(e,t,o){"use strict";o.d(t,"a",(function(){return r}));var s=o("3Pt+"),i=o("fXoL");function l(e,t){if(1&e&&(i.Zb(0,"div",8),i.Wc(1,"\n            "),i.Vb(2,9),i.Wc(3,"\n        "),i.Yb()),2&e){var o=i.lc();i.Db(2),i.tc("obj",o.obj.Name)}}function n(e,t){if(1&e&&(i.Zb(0,"div",8),i.Wc(1,"\n            "),i.Vb(2,9),i.Wc(3,"\n        "),i.Yb()),2&e){var o=i.lc();i.Db(2),i.tc("obj",o.obj.List)}}function a(e,t){if(1&e&&(i.Zb(0,"div",10),i.Wc(1,"\n            "),i.Ub(2,"app-PactGridView",11),i.Wc(3,"  \n        "),i.Yb()),2&e){var o=i.lc();i.Db(2),i.tc("obj",o.obj.OpenGrid)("group",o.form)}}var r=function(){var e=function(){function e(){_classCallCheck(this,e),this.foorm=new s.j({})}return _createClass(e,[{key:"ngOnInit",value:function(){}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i.Nb({type:e,selectors:[["app-save-as-dialog"]],decls:26,vars:9,consts:[[1,"master-screen"],[1,"PACTHeaderFields","dialogSubBody"],["class","form-group col PACTControl",4,"ngIf"],["class","documentgrid row form-row","style","width: 100%;",4,"ngIf"],[1,"Pactdailogfooter"],[1,"primary-btn-wicon",3,"click"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-rectangle-xmark"],[1,"form-group","col","PACTControl"],["FieldDirective","",3,"obj"],[1,"documentgrid","row","form-row",2,"width","100%"],[2,"width","100%",3,"obj","group"]],template:function(e,t){1&e&&(i.Zb(0,"div",0),i.Wc(1,"\n    "),i.Zb(2,"div",1),i.Wc(3,"\n        "),i.Uc(4,l,4,1,"div",2),i.Wc(5,"\n        "),i.Uc(6,n,4,1,"div",2),i.Wc(7,"\n        "),i.Uc(8,a,4,2,"div",3),i.Wc(9,"\n  "),i.Yb(),i.Wc(10,"\n\n  "),i.Zb(11,"div",4),i.Wc(12,"\n    "),i.Zb(13,"div"),i.Wc(14,"\n        "),i.Zb(15,"button",5),i.hc("click",(function(){return t.obj.OnButtonClick("AddDeclinedJobs")})),i.Wc(16),i.mc(17,"translate"),i.Yb(),i.Wc(18,"\n        "),i.Zb(19,"button",6),i.hc("click",(function(){return t.obj.OnButtonClick("Cancel")})),i.Ub(20,"i",7),i.Wc(21),i.mc(22,"translate"),i.Yb(),i.Wc(23,"\n    "),i.Yb(),i.Wc(24,"      \n  "),i.Yb(),i.Wc(25,"\n"),i.Yb()),2&e&&(i.Db(4),i.tc("ngIf",t.obj.Name.Visible),i.Db(2),i.tc("ngIf",t.obj.List.Visible),i.Db(2),i.tc("ngIf",t.obj.GridVisibility),i.Db(8),i.Xc(i.nc(17,5,"Com_OK")),i.Db(5),i.Xc(i.nc(22,7,"Cancel")))},encapsulation:2}),e}()},l3BA:function(e,t,o){"use strict";o.d(t,"a",(function(){return u}));var s=o("Do2H"),i=o("Lp6j"),l=o("ScVY"),n=o("EQd/"),a=o("0/4Q"),r=o("8B8H"),h=o("ockk"),u=function(e){_inherits(o,e);var t=_createSuper(o);function o(e){var i;return _classCallCheck(this,o),(i=t.call(this)).IsOkClick=!1,i.SaveAsID=0,i.DeleteButtonVisibility=!1,i.GridVisibility=!1,i.Parent=e,i.Title=s.a.GetResource("SaveAs"),i.List=new a.e(0),i.List.Label="Over write existing",i.List.LblWidth="130",i.List.Items.push(a.d.ComboBoxItems_2("","0")),i.List.SelectionChangedCommand.Subscribe(_assertThisInitialized(i),"OnListChange"),"ReportViewModel"==e.ClassName?(i.Name=new n.d(0),i.Name.Text=e.ScreenName,i.Name.Enable=!0,i.Name.LblWidth="130",s.a.report.GetReportData(1,e.StaticReportType,null).Tables[0].forEach((function(e){i.List.Items.push(a.d.ComboBoxItems_2(e.ReportName.toString(),e.ReportID.toString()))}))):"ReOrderLevelNewViewModel"==e.ClassName&&(i.Name=new n.d(0),i.Name.Text=e.Title,i.Name.Enable=!0,i.Name.LblWidth="130","Open"==e.DialogAction?(i.GridVisibility=!0,i.Name.Visible=!1,i.List.Visible=!1,i.DeleteButtonVisibility=!0,i.Title=s.a.GetResource("CRMOpportunity_Open"),i.InitOpenGrid(e.ReportID)):s.a.report.GetReportData(4,e.ReportID,null).Tables[0].forEach((function(e){i.List.Items.push(a.d.ComboBoxItems_3(e.FileDescription.toString(),e.FileID.toString(),e.GUID.toString()))}))),i.Name.Label=s.a.GetResource("AccountCreate_Name"),i}return _createClass(o,[{key:"InitOpenGrid",value:function(e){this.OpenGrid=new r.a,this.OpenGrid.Width="",this.OpenGrid.SearchVisible=!0,this.OpenGrid.FilterVisible=!0,this.OpenGrid.SearchOptions.Width="110",this.OpenGrid.SearchText.Width="100";var t=s.a.report.GetReportData(4,e,null);t.Columns[0].push("Delete"),t.Tables[0].forEach((function(e){e.Delete="Delete"})),this.OpenGrid.Table=t.Tables[0];var o=new Array,i=new h.a;i.Header="Profile Name",i.DisplayMember="FileDescription",i.Width=220,i.ReadOnly=!0,o.push(i),(i=new h.a).Header="Action",i.DisplayMember="Delete",i.Width=70,i.DataType="LINK",i.ReadOnly=!0,o.push(i),this.OpenGrid.Columns=o,this.OpenGrid.SearchCols.SelectedValue="FileDescription",this.OpenGrid.SearchCols.Visible=!1,this.OpenGrid.OnLinkClick.Subscribe(this,"OnOpenGridLinkClick")}},{key:"OnOpenGridLinkClick",value:function(e,t,o){confirm("Do you really want to Delete?")&&(s.a.report.GetReportData(6,parseInt(e.FileID),null),this.DisplayMessage="Deleted Successfully",this.OpenGrid.removeRow(e))}},{key:"OnButtonClick",value:function(e){var t,o=this;if("Cancel"==e.toString())s.a.page.HideDialog();else if("Delete"==e.toString())null!=this.List.SelectedValue&&parseInt(this.List.SelectedValue);else try{if(this.IsOkClick=!0,"ReOrderLevelNewViewModel"==this.Parent.ClassName){if(null!=this.OpenGrid){if(null==this.OpenGrid.SelectedItem)return void(this.DisplayMessage="Please select profile");this.SaveAsID=parseInt(this.OpenGrid.SelectedItem.FileID),this.Name.Text=this.OpenGrid.SelectedItem.FileDescription.toString()}else if(null!=this.List.SelectedValue&&parseInt(this.List.SelectedValue)>0)this.SaveAsID=parseInt(this.List.SelectedValue),this.Name.Text=this.List.SelectedItem.Name;else if("ReOrderLevelNewViewModel"==this.Parent.ClassName&&this.List.Items.find((function(e){return 0==i.e.stringCompare(e.Name,o.Name.Text,!0)})))return void(this.DisplayMessage="Duplicate Name");this.Name.Enable=!0}else if("AddEditReportViewModel"==this.Parent.ClassName||"ReportViewModel"==this.Parent.ClassName||"AddEmailSMSViewModel"==(null===(t=this.Parent)||void 0===t?void 0:t.ClassName)){if(null!=this.List.SelectedValue&&parseInt(this.List.SelectedValue)>0)this.SaveAsID=parseInt(this.List.SelectedValue),this.Name.Text=this.List.SelectedItem.Name;else if("ReOrderLevelNewViewModel"==this.Parent.ClassName&&this.List.Items.find((function(e){return 0==i.e.stringCompare(e.Name,o.Name.Text,!0)})))return void(this.DisplayMessage="Duplicate Name");this.Name.Enable=!0}s.a.page.HideDialog()}catch(l){}}},{key:"OnListChange",value:function(e){this.Name.Enable=null==this.List.SelectedValue||"0"==this.List.SelectedValue}}]),o}(l.b)},nif3:function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var s=o("1xwR"),i=o("Lp6j"),l=o("Do2H"),n=function(e){_inherits(o,e);var t=_createSuper(o);function o(e){var s;return _classCallCheck(this,o),(s=t.call(this,e)).ds=null,s}return _createClass(o,[{key:"LoadReport",value:function(){var e="",t="",o="";(o=this.ViewModel.PayrollWidgetEmpID>0&&(307==this.ViewModel.ReportID||306==this.ViewModel.ReportID)?this.ViewModel.PayrollWidgetEmpID.toString():this.ViewModel.oReportDialog.GetSeqNosList()).length>0&&(this.ViewModel.oReportDialog.IsZeroSelected||this.ViewModel.oReportDialog.IsOneSelected||(o=this.ViewModel.PayrollWidgetEmpID>0&&(307==this.ViewModel.ReportID||306==this.ViewModel.ReportID)?this.ViewModel.PayrollWidgetEmpID.toString():this.ViewModel.oReportDialog.GetSeqNosListWithRoots(),this.ViewModel.oReportDialog.IsGroupExists?(e="C51.NodeID=GTP.GTID",t=o.Contains(",")?",(select T.NodeID GTID from COM_CC50051 T with(nolock),COM_CC50051 GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.NodeID IN ("+o+") group by T.NodeID) AS GTP ":",(select T.NodeID GTID from COM_CC50051 T with(nolock),COM_CC50051 GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.NodeID="+o+" group by T.NodeID) AS GTP "):e=o.Contains(",")?"C51.NodeID IN ("+o+")":"C51.NodeID="+o));var s="";this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(s=i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),this.ChunkSize=this.ViewModel.Preferences.ContainsKey("ChunkSize")?parseInt(this.ViewModel.Preferences.ChunkSize):1;var n=null;if(286==this.ViewModel.StaticReportType){var a="\nSELECT C51.NODEID\n ,C51.CODE\n ,C51.NAME\n ,CASE \n     WHEN convert(DATETIME, OPLeavesAsOn) <> '01 Jan 1900'\n         THEN convert(DATETIME, OPLeavesAsOn)\n     ELSE CONVERT(DATETIME, C51.DOJ)\n     END\n ,CC.CCNID53\n ,DATEDIFF(D, CONVERT(DATETIME, C51.DOJ), CONVERT(DATETIME, '"+this.ViewModel.FromDatePicker.Date.ToString("dd MMM yyyy")+"'))\n ,DATEDIFF(MONTH, CONVERT(DATETIME, CASE \n             WHEN convert(DATETIME, OPLeavesAsOn) <> '01 Jan 1900'\n                 THEN convert(DATETIME, OPLeavesAsOn)\n             ELSE CONVERT(DATETIME, C51.DOJ)\n             END), CONVERT(DATETIME, '"+this.ViewModel.ToDatePicker.Date.ToString("dd MMM yyyy")+"'))\n ,0\n ,ISNULL(C51.OpVacationDays, 0)\n ,convert(DATETIME, OPLeavesAsOn)\n ,CONVERT(DATETIME, C51.DOJ)\n ,C51.VACDAYSPERIOD\n ,C51.VACDAYSPERMONTH\nFROM COM_CC50051 C51 WITH (NOLOCK)\nJOIN COM_CCCCDATA CC WITH (NOLOCK) ON CC.NODEID = C51.NODEID\n"+t+" \nWHERE CC.COSTCENTERID = 50051\n AND C51.IsGroup=0 AND C51.NODEID > 2 ";e.length>0&&(a+="AND "+e),n=l.a.report.DataSet("RPT022",a),this.ViewModel.totals=i.e.NumArray(this.ViewModel.ReportColumns.length,this.ViewModel.lstGroup.length+1),this.ViewModel.hiddenTotals=i.e.NumArray(this.ViewModel.HiddenNumericColumns.length,this.ViewModel.lstGroup.length+1);var r=[];r.push(""),r.push(this.ViewModel.FromDatePicker.Date.ToString("dd MMM yyyy")),r.push(this.ViewModel.ToDatePicker.Date.ToString("dd MMM yyyy")),r.push(s+this.GetDimensionFilter("CC.CCNID",[50051]));for(var h=0;h<n.Tables[0].length;h+=this.ChunkSize){if(this.ViewModel.process.CancellationPending)return void(this.ViewModel.processArgs.Cancel=!0);this.sbChunks="";for(var u=h;u<n.Tables[0].length&&u-h<this.ChunkSize;u++)this.sbChunks.length>0&&(this.sbChunks+=","),this.sbChunks+=n.Tables[0][u][n.Columns[0][0]].toString();r[0]=this.sbChunks.toString(),this.ds=l.a.empService.GetData(r,"spPAY_RptGetVacationLedger"),this.DataSetCollection.push(this.ds),this.ViewModel.ReportData=this.ds.Tables[0],this.ViewModel.ReportDataSet=this.ds.Tables[0],this.ViewModel.ReportDataColumns=this.ds.Columns[0],this.ViewModel.ConstructFormulaFields(!0),this.ViewModel.RenderData(this.ds.Tables[0],this.ViewModel.ReportDataColumns),this.ViewModel.CheckAndAddSubTotals(this.ds.Tables[0])}this.ViewModel.GrpReportTotal.SubTotalAppearance.IsVisible&&this.ViewModel.AddSubtotals_RT(this.ViewModel.GrpReportTotal,0),this.ViewModel.ReportData=null}else if(306==this.ViewModel.StaticReportType){var c="\n\nSELECT C51.NODEID,C51.CODE,C51.NAME FROM \nCOM_CC50051 C51 WITH(NOLOCK) \nLEFT JOIN COM_CCCCDATA CC WITH (NOLOCK) ON CC.NodeID=C51.NodeID AND CC.CostCenterID=50051\n"+t+" \nWHERE C51.IsGroup=0 AND C51.NodeID>1 AND C51.StatusID=250 \nAND DATEDIFF(day,ISNULL(CONVERT(DATETIME,C51.DORelieve),'01-Jan-2200'),CONVERT(DATETIME, '"+this.ViewModel.ToDatePicker.Date.ToString("dd MMM yyyy")+"'))<=0  ";e.length>0&&(c+="AND "+e),n=l.a.report.DataSet("RPT022",c),this.ViewModel.totals=i.e.NumArray(this.ViewModel.ReportColumns.length,this.ViewModel.lstGroup.length+1),this.ViewModel.hiddenTotals=i.e.NumArray(this.ViewModel.HiddenNumericColumns.length,this.ViewModel.lstGroup.length+1);var D=[];D.push(""),D.push(this.ViewModel.FromDatePicker.Date.ToString("dd MMM yyyy")),D.push(this.ViewModel.ToDatePicker.Date.ToString("dd MMM yyyy")),D.push(s+this.GetDimensionFilter("CC.CCNID",[50051]));for(var d=0;d<n.Tables[0].length;d+=this.ChunkSize){if(this.ViewModel.process.CancellationPending)return void(this.ViewModel.processArgs.Cancel=!0);this.sbChunks="";for(var C=d;C<n.Tables[0].length&&C-d<this.ChunkSize;C++)this.sbChunks.length>0&&(this.sbChunks+=","),this.sbChunks+=n.Tables[0][C][n.Columns[0][0]].toString();D[0]=this.sbChunks.toString(),this.ds=l.a.empService.GetData(D,"spPAY_RptGetAttendanceCalendar"),this.DataSetCollection.push(this.ds),this.ViewModel.ReportData=this.ds.Tables[0],this.ViewModel.ReportDataSet=JSON.parse(JSON.stringify(this.ds.Tables[0])),this.ViewModel.ReportDataColumns=this.ds.Columns[0],this.ViewModel.ConstructFormulaFields(!0),this.ViewModel.CheckAndUpdateRepeatData(this.ViewModel.ReportData,this.ViewModel.ReportDataColumns),this.ViewModel.RenderData(this.ViewModel.ReportData,this.ViewModel.ReportDataColumns),this.ViewModel.CheckAndAddSubTotals(this.ViewModel.ReportData)}this.ViewModel.GrpReportTotal.SubTotalAppearance.IsVisible&&this.ViewModel.AddSubtotals_RT(this.ViewModel.GrpReportTotal,0),this.ViewModel.ReportData=null}else if(307==this.ViewModel.StaticReportType){var p="\n\nSELECT C51.NODEID,C51.CODE,C51.NAME FROM \nCOM_CC50051 C51 WITH(NOLOCK) \nLEFT JOIN COM_CCCCDATA CC WITH (NOLOCK) ON CC.NodeID=C51.NodeID AND CC.CostCenterID=50051\n"+t+" \nWHERE C51.IsGroup=0 AND C51.NodeID>1 AND C51.StatusID=250 \nAND DATEDIFF(day,ISNULL(CONVERT(DATETIME,C51.DORelieve),'01-Jan-2200'),CONVERT(DATETIME, '"+this.ViewModel.ToDatePicker.Date.ToString("dd MMM yyyy")+"'))<=0  ";e.length>0&&(p+="AND "+e),n=l.a.report.DataSet("RPT022",p),this.ViewModel.totals=i.e.NumArray(this.ViewModel.ReportColumns.length,this.ViewModel.lstGroup.length+1),this.ViewModel.hiddenTotals=i.e.NumArray(this.ViewModel.HiddenNumericColumns.length,this.ViewModel.lstGroup.length+1);var T=[];T.push(""),T.push(this.ViewModel.FromDatePicker.Date.ToString("dd MMM yyyy")),T.push(this.ViewModel.ToDatePicker.Date.ToString("dd MMM yyyy")),T.push(s+this.GetDimensionFilter("CC.CCNID",[50051]));for(var _=0;_<n.Tables[0].length;_+=this.ChunkSize){if(this.ViewModel.process.CancellationPending)return void(this.ViewModel.processArgs.Cancel=!0);this.sbChunks="";for(var m=_;m<n.Tables[0].length&&m-_<this.ChunkSize;m++)this.sbChunks.length>0&&(this.sbChunks+=","),this.sbChunks+=n.Tables[0][m][n.Columns[0][0]].toString();T[0]=this.sbChunks.toString(),this.ds=l.a.empService.GetData(T,"spPAY_RptGetDailyAttendanceCalendar"),this.DataSetCollection.push(this.ds),this.ViewModel.ReportData=this.ds.Tables[0],this.ViewModel.ReportDataSet=[],this.ViewModel.ReportDataSet=JSON.parse(JSON.stringify(this.ds.Tables[0])),this.ViewModel.ReportDataColumns=this.ds.Columns[0],this.ViewModel.ConstructFormulaFields(!0),this.ViewModel.CheckAndUpdateRepeatData(this.ViewModel.ReportData,this.ViewModel.ReportDataColumns),this.ViewModel.RenderData(this.ViewModel.ReportData,this.ViewModel.ReportDataColumns),this.ViewModel.CheckAndAddSubTotals(this.ViewModel.ReportData)}this.ViewModel.GrpReportTotal.SubTotalAppearance.IsVisible&&this.ViewModel.AddSubtotals_RT(this.ViewModel.GrpReportTotal,0),this.ViewModel.ReportData=null}}},{key:"LoadReportWithPostFilters",value:function(e){}}]),o}(s.b)},zQUM:function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var s=o("Do2H"),i=o("ScVY"),l=o("EQd/"),n=function(e){_inherits(o,e);var t=_createSuper(o);function o(e){var i;_classCallCheck(this,o),(i=t.call(this)).SuspendVisiblity=!1,i.AppAllVisible=!1,i.SuspendPRVisiblity=!1,i.forwardVisible=!1,i.ApproveAllforwardVisible=!1,i.RejectAllVisible=!1,i.Remarks=new l.d(0),i.RemarksApprove=!1,i.RemarksReject=!1,i.RemarksSuspend=!1,i.Parent=e;var n=e;return n.StaticReportObject.CanApproveAll&&(i.AppAllVisible=s.a.SessionManager.IsActionAssigned(200,"Approve all"),i.RejectAllVisible=s.a.SessionManager.IsActionAssigned(200,"Reject All"),i.ApproveAllforwardVisible=s.a.SessionManager.IsActionAssigned(200,"Approve all and forward")),i.forwardVisible=s.a.SessionManager.IsActionAssigned(200,"Move forward"),s.a.SessionManager.IsActionAssigned(n.StaticReportObject.QuotationDocument,"Suspend")&&(i.SuspendVisiblity=s.a.SessionManager.IsActionAssigned(200,"Suspend All"),i.SuspendPRVisiblity=s.a.SessionManager.IsActionAssigned(200,"Suspend PR")),i}return _createClass(o,[{key:"OnButtonClick",value:function(e){var t=this;if(this.DisplayMessage="","Close"==e)s.a.page.HideDialog();else{var o=0;"ApproveAll"==e?o=1:"RejectAll"==e?o=2:"ApproveAllforward"==e?o=3:"forward"==e?o=4:"SuspendAll"==e?o=5:"SuspendPR"==e&&(o=6);var i=this.Parent;s.a.report.SaveApprovals(i.StaticReportObject.ccid,i.StaticReportObject.QuotationDocument,i.StaticReportObject.docid,new Date,this.Remarks.Text,o,i.StaticReportObject.Userlevel,i.StaticReportObject.WID,i.StaticReportObject.QtnIDs).then((function(e){t.DisplayMessage=e.Message,e.RetValue>0&&(i.DisplayMessage=t.DisplayMessage,1!=o&&(i.ButtonAction.Visible=!1),s.a.page.HideDialog())}))}}}]),o}(i.b)}}]);